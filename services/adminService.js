'use strict';function a33_0x302a(_0x273772,_0x2dcf46){const _0x3fff37=a33_0x3fff();return a33_0x302a=function(_0x302a50,_0xb9fe86){_0x302a50=_0x302a50-0x144;let _0x23e8e1=_0x3fff37[_0x302a50];return _0x23e8e1;},a33_0x302a(_0x273772,_0x2dcf46);}const a33_0x11458d=a33_0x302a;(function(_0xcff5cd,_0xa94699){const _0x5417df=a33_0x302a,_0x5bd6e2=_0xcff5cd();while(!![]){try{const _0x4ce44e=parseInt(_0x5417df(0x147))/0x1+parseInt(_0x5417df(0x184))/0x2+-parseInt(_0x5417df(0x1ac))/0x3+-parseInt(_0x5417df(0x16a))/0x4+parseInt(_0x5417df(0x1d6))/0x5+-parseInt(_0x5417df(0x168))/0x6*(parseInt(_0x5417df(0x1f7))/0x7)+-parseInt(_0x5417df(0x1ff))/0x8;if(_0x4ce44e===_0xa94699)break;else _0x5bd6e2['push'](_0x5bd6e2['shift']());}catch(_0x4d268f){_0x5bd6e2['push'](_0x5bd6e2['shift']());}}}(a33_0x3fff,0x635c1));var __importDefault=this&&this[a33_0x11458d(0x171)]||function(_0x1861f2){const _0x14af31=a33_0x11458d;return _0x1861f2&&_0x1861f2[_0x14af31(0x19f)]?_0x1861f2:{'default':_0x1861f2};};Object[a33_0x11458d(0x163)](exports,a33_0x11458d(0x19f),{'value':!![]}),exports[a33_0x11458d(0x20d)]=void 0x0;const database_1=__importDefault(require(a33_0x11458d(0x16e))),currencyService_1=require('./currencyService'),userService_1=require(a33_0x11458d(0x1c5)),telegramBotService_1=require(a33_0x11458d(0x1b8)),gateway_1=require(a33_0x11458d(0x210));class AdminService{constructor(){const _0x248cc1=a33_0x11458d;this[_0x248cc1(0x162)]=new userService_1[(_0x248cc1(0x1c2))]();}[a33_0x11458d(0x1fd)](_0x55d934){const _0x4ad5f7=a33_0x11458d;switch(_0x55d934){case'7d':return 0x7;case _0x4ad5f7(0x1ed):return 0x1e;case _0x4ad5f7(0x1c0):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x11458d(0x1e0)](_0x13eb98,_0x5b5bfb){const _0x170f20=a33_0x11458d,_0x3dc37d=[],_0xe3d12d=new Date(_0x13eb98);while(_0xe3d12d<=_0x5b5bfb){_0x3dc37d[_0x170f20(0x1a8)](_0xe3d12d[_0x170f20(0x16b)]()[_0x170f20(0x1dc)]('T')[0x0]),_0xe3d12d[_0x170f20(0x177)](_0xe3d12d[_0x170f20(0x1f1)]()+0x1);}return _0x3dc37d;}[a33_0x11458d(0x1a6)](_0x3cd400,_0xf2ecd8){const _0x59f690=a33_0x11458d;if(!_0x3cd400[_0x59f690(0x1ce)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x1efc46=JSON['parse'](_0x3cd400[_0x59f690(0x1ce)]),_0x5c84f9=_0xf2ecd8[_0x59f690(0x16f)](0x0)[_0x59f690(0x198)]()+_0xf2ecd8['slice'](0x1)[_0x59f690(0x187)]();if(_0x1efc46&&_0x1efc46[_0x5c84f9])return{'commission':_0x1efc46[_0x5c84f9][_0x59f690(0x17e)]||0x0,'payoutDelay':_0x1efc46[_0x5c84f9][_0x59f690(0x15d)]||0x0};}catch(_0x26ec74){console[_0x59f690(0x1ba)](_0x59f690(0x18c),_0x26ec74);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x2a2053){const _0x327803=a33_0x11458d;if(_0x2a2053[_0x327803(0x1ec)]!==_0x327803(0x166)||_0x2a2053[_0x327803(0x19a)]||!_0x2a2053['paidAt'])return![];const _0x668144=this['getGatewaySettings'](_0x2a2053[_0x327803(0x1d8)],_0x2a2053['gateway']),_0x2cf2e6=_0x668144['payoutDelay']*0x18*0x3c*0x3c*0x3e8,_0x2375b8=new Date(_0x2a2053[_0x327803(0x1a4)]['getTime']()+_0x2cf2e6);return new Date()>_0x2375b8;}[a33_0x11458d(0x174)](_0x3ce862,_0x3e3530){return _0x3ce862*(0x1-_0x3e3530/0x64);}[a33_0x11458d(0x18d)](_0x29db90){const _0x2e3a09=a33_0x11458d;switch(_0x29db90[_0x2e3a09(0x1ec)]){case _0x2e3a09(0x166):return _0x29db90[_0x2e3a09(0x146)];case'CHARGEBACK':return-(_0x29db90['chargebackAmount']||0x0);case _0x2e3a09(0x189):return 0x0;default:return 0x0;}}async[a33_0x11458d(0x14e)](_0x5ce5a2){const _0x529e93=a33_0x11458d,{shopId:_0x19bda8,amount:_0x37455d,network:_0x44677a,notes:_0x511ef7}=_0x5ce5a2;console[_0x529e93(0x1b0)](_0x529e93(0x176)+_0x19bda8+':\x20'+_0x37455d+_0x529e93(0x1fc)+_0x44677a);const _0x5d48ab=await database_1[_0x529e93(0x1be)][_0x529e93(0x1d8)][_0x529e93(0x191)]({'where':{'id':_0x19bda8},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x5d48ab)throw new Error('Shop\x20not\x20found');if(_0x5d48ab[_0x529e93(0x1ec)]!==_0x529e93(0x1dd))throw new Error(_0x529e93(0x205));const _0x459545=await database_1[_0x529e93(0x1be)][_0x529e93(0x1e9)][_0x529e93(0x181)]({'data':{'shopId':_0x19bda8,'amount':_0x37455d,'network':_0x44677a,'status':_0x529e93(0x20b),'notes':_0x511ef7||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x529e93(0x150)](_0x19bda8,_0x37455d);try{await telegramBotService_1[_0x529e93(0x155)]['sendPayoutNotification'](_0x19bda8,_0x459545,'completed');}catch(_0x21eb6f){console[_0x529e93(0x1ba)](_0x529e93(0x1c9),_0x21eb6f);}return console[_0x529e93(0x1b0)]('✅\x20Payout\x20created\x20successfully:\x20'+_0x459545['id']),{'id':_0x459545['id'],'shopId':_0x459545[_0x529e93(0x1b9)],'shopName':_0x459545[_0x529e93(0x1d8)][_0x529e93(0x1a2)],'shopUsername':_0x459545[_0x529e93(0x1d8)][_0x529e93(0x1ae)],'amount':_0x459545[_0x529e93(0x146)],'network':_0x459545[_0x529e93(0x1b6)],'status':_0x459545[_0x529e93(0x1ec)],'txid':_0x459545[_0x529e93(0x1d9)],'notes':_0x459545[_0x529e93(0x1f9)],'createdAt':_0x459545['createdAt'],'paidAt':_0x459545[_0x529e93(0x1a4)]};}async[a33_0x11458d(0x150)](_0x16a8bd,_0x399f47){const _0x4101ff=a33_0x11458d;console['log']('🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20'+_0x16a8bd+',\x20amount:\x20'+_0x399f47+'\x20USDT');const _0x45fab0=await database_1[_0x4101ff(0x1be)]['payment']['findMany']({'where':{'shopId':_0x16a8bd,'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x4101ff(0x17c)}});let _0x5505f4=_0x399f47;const _0x806fa4=[];for(const _0x3970b0 of _0x45fab0){const _0x378cce={..._0x3970b0,'status':_0x4101ff(0x166),'merchantPaid':![],'shop':{'gatewaySettings':_0x3970b0[_0x4101ff(0x1d8)][_0x4101ff(0x1ce)]}};if(!this[_0x4101ff(0x16d)](_0x378cce))continue;const _0x551bd0=await currencyService_1[_0x4101ff(0x1eb)][_0x4101ff(0x1b4)](_0x3970b0[_0x4101ff(0x146)],_0x3970b0[_0x4101ff(0x178)]),_0x4ad57c=this['getGatewaySettings'](_0x3970b0[_0x4101ff(0x1d8)],_0x3970b0['gateway']),_0x24901c=this['calculateAmountAfterCommission'](_0x551bd0,_0x4ad57c[_0x4101ff(0x17e)]);if(_0x24901c<=_0x5505f4){_0x806fa4[_0x4101ff(0x1a8)](_0x3970b0['id']),_0x5505f4-=_0x24901c;if(_0x5505f4<=0.01)break;}}_0x806fa4[_0x4101ff(0x148)]>0x0&&(await database_1[_0x4101ff(0x1be)][_0x4101ff(0x1fe)][_0x4101ff(0x212)]({'where':{'id':{'in':_0x806fa4}},'data':{'merchantPaid':!![]}}),console['log'](_0x4101ff(0x1fb)+_0x806fa4[_0x4101ff(0x148)]+_0x4101ff(0x154)));}async[a33_0x11458d(0x182)](_0x300887){const _0x42cfff=a33_0x11458d,{page:_0x5f4f42,limit:_0x536754,shopId:_0x2b8c60,network:_0x4d077b,dateFrom:_0x476870,dateTo:_0x238d67,search:_0x22ca4e}=_0x300887,_0x2da68f=(_0x5f4f42-0x1)*_0x536754;console['log']('📋\x20Getting\x20payouts\x20with\x20filters:',_0x300887);const _0x3fa7a5={};_0x2b8c60&&(_0x3fa7a5[_0x42cfff(0x1b9)]=_0x2b8c60);_0x4d077b&&(_0x3fa7a5[_0x42cfff(0x1b6)]=_0x4d077b);(_0x476870||_0x238d67)&&(_0x3fa7a5[_0x42cfff(0x206)]={},_0x476870&&(_0x3fa7a5[_0x42cfff(0x206)][_0x42cfff(0x144)]=new Date(_0x476870)),_0x238d67&&(_0x3fa7a5[_0x42cfff(0x206)][_0x42cfff(0x14a)]=new Date(_0x238d67)));_0x22ca4e&&(_0x3fa7a5['OR']=[{'txid':{'contains':_0x22ca4e,'mode':_0x42cfff(0x197)}},{'notes':{'contains':_0x22ca4e,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x22ca4e,'mode':_0x42cfff(0x197)}}},{'shop':{'username':{'contains':_0x22ca4e,'mode':_0x42cfff(0x197)}}}]);const [_0x1132b7,_0x18fccb]=await Promise[_0x42cfff(0x1e6)]([database_1['default'][_0x42cfff(0x1e9)][_0x42cfff(0x1f8)]({'where':_0x3fa7a5,'skip':_0x2da68f,'take':_0x536754,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x42cfff(0x1be)][_0x42cfff(0x1e9)][_0x42cfff(0x1ca)]({'where':_0x3fa7a5})]);console[_0x42cfff(0x1b0)](_0x42cfff(0x1b3)+_0x1132b7[_0x42cfff(0x148)]+_0x42cfff(0x1c6)+_0x18fccb+_0x42cfff(0x149));const _0x1f53ae=_0x1132b7['map'](_0x1de6e0=>({'id':_0x1de6e0['id'],'shopId':_0x1de6e0['shopId'],'shopName':_0x1de6e0[_0x42cfff(0x1d8)][_0x42cfff(0x1a2)],'shopUsername':_0x1de6e0[_0x42cfff(0x1d8)][_0x42cfff(0x1ae)],'amount':_0x1de6e0[_0x42cfff(0x146)],'network':_0x1de6e0['network'],'status':_0x1de6e0['status'],'txid':_0x1de6e0['txid'],'notes':_0x1de6e0[_0x42cfff(0x1f9)],'createdAt':_0x1de6e0[_0x42cfff(0x206)],'paidAt':_0x1de6e0['paidAt']}));return{'payouts':_0x1f53ae,'pagination':{'page':_0x5f4f42,'limit':_0x536754,'total':_0x18fccb,'totalPages':Math['ceil'](_0x18fccb/_0x536754)}};}async['getPayoutById'](_0x496245){const _0x136c5c=a33_0x11458d;console['log'](_0x136c5c(0x20a)+_0x496245);const _0x528fa0=await database_1[_0x136c5c(0x1be)]['payout']['findUnique']({'where':{'id':_0x496245},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x528fa0)return console[_0x136c5c(0x1b0)](_0x136c5c(0x19d)+_0x496245),null;return console[_0x136c5c(0x1b0)](_0x136c5c(0x1f3)+_0x528fa0[_0x136c5c(0x146)]+'\x20USDT\x20via\x20'+_0x528fa0[_0x136c5c(0x1b6)]),{'id':_0x528fa0['id'],'shopId':_0x528fa0[_0x136c5c(0x1b9)],'shopName':_0x528fa0[_0x136c5c(0x1d8)][_0x136c5c(0x1a2)],'shopUsername':_0x528fa0['shop'][_0x136c5c(0x1ae)],'amount':_0x528fa0[_0x136c5c(0x146)],'network':_0x528fa0[_0x136c5c(0x1b6)],'status':_0x528fa0[_0x136c5c(0x1ec)],'txid':_0x528fa0[_0x136c5c(0x1d9)],'notes':_0x528fa0[_0x136c5c(0x1f9)],'createdAt':_0x528fa0[_0x136c5c(0x206)],'paidAt':_0x528fa0[_0x136c5c(0x1a4)]};}async[a33_0x11458d(0x1de)](_0x59ae3a){const _0x3e6089=a33_0x11458d;console[_0x3e6089(0x1b0)](_0x3e6089(0x185)+_0x59ae3a);const _0x321f49=await database_1[_0x3e6089(0x1be)]['payout']['findUnique']({'where':{'id':_0x59ae3a},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x321f49)throw new Error(_0x3e6089(0x19e));await database_1[_0x3e6089(0x1be)][_0x3e6089(0x1e9)]['delete']({'where':{'id':_0x59ae3a}}),console[_0x3e6089(0x1b0)](_0x3e6089(0x1cb)+_0x59ae3a+_0x3e6089(0x165));}async[a33_0x11458d(0x1ab)](_0x767cc6){const _0xb06c0a=a33_0x11458d,{page:_0x109e1d,limit:_0x264719,minAmount:_0x26b885,search:_0x12c541}=_0x767cc6;console[_0xb06c0a(0x1b0)](_0xb06c0a(0x190),_0x767cc6);const _0x26ecf0=await database_1[_0xb06c0a(0x1be)][_0xb06c0a(0x1fe)][_0xb06c0a(0x1f8)]({'where':{'status':_0xb06c0a(0x166),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0xb06c0a(0x1b0)](_0xb06c0a(0x1e3)+_0x26ecf0[_0xb06c0a(0x148)]+_0xb06c0a(0x1d7));const _0x284a36=new Map();for(const _0x291476 of _0x26ecf0){const _0x4dfebd={..._0x291476,'status':_0xb06c0a(0x166),'merchantPaid':![],'shop':{'gatewaySettings':_0x291476[_0xb06c0a(0x1d8)][_0xb06c0a(0x1ce)]}},_0x10e441=this[_0xb06c0a(0x16d)](_0x4dfebd);if(!_0x10e441)continue;const _0x5c1a85=await currencyService_1['currencyService'][_0xb06c0a(0x1b4)](_0x291476[_0xb06c0a(0x146)],_0x291476[_0xb06c0a(0x178)]),_0xa49aa7=this[_0xb06c0a(0x1a6)](_0x291476[_0xb06c0a(0x1d8)],_0x291476[_0xb06c0a(0x145)]),_0x59ebb4=this['calculateAmountAfterCommission'](_0x5c1a85,_0xa49aa7['commission']),_0x49e103=_0x291476[_0xb06c0a(0x1b9)];!_0x284a36['has'](_0x49e103)&&_0x284a36['set'](_0x49e103,{'shop':_0x291476[_0xb06c0a(0x1d8)],'payments':[]}),_0x284a36[_0xb06c0a(0x1c8)](_0x49e103)[_0xb06c0a(0x1da)][_0xb06c0a(0x1a8)]({'id':_0x291476['id'],'amount':_0x291476[_0xb06c0a(0x146)],'currency':_0x291476[_0xb06c0a(0x178)],'gateway':_0x291476[_0xb06c0a(0x145)],'paidAt':_0x291476[_0xb06c0a(0x1a4)],'createdAt':_0x291476[_0xb06c0a(0x206)],'amountUSDT':_0x5c1a85,'commission':_0xa49aa7[_0xb06c0a(0x17e)],'amountAfterCommissionUSDT':_0x59ebb4,'isEligible':!![]});}console[_0xb06c0a(0x1b0)]('🏪\x20Found\x20'+_0x284a36[_0xb06c0a(0x1a1)]+'\x20merchants\x20with\x20eligible\x20PAID\x20payments');const _0x3a52f6=[];for(const [_0x56e3b0,_0x3849c7]of _0x284a36){const {shop:_0x519ca8,payments:_0x231445}=_0x3849c7,_0x737fa6=_0x231445[_0xb06c0a(0x1e8)]((_0x1eabfb,_0x1c4f41)=>_0x1eabfb+_0x1c4f41[_0xb06c0a(0x18f)],0x0),_0x17fe6d=_0x231445['reduce']((_0x34a2f0,_0x1414f8)=>_0x34a2f0+_0x1414f8['amountAfterCommissionUSDT'],0x0);if(_0x26b885&&_0x17fe6d<_0x26b885)continue;if(_0x12c541){const _0x19b303=_0x12c541[_0xb06c0a(0x187)](),_0x51a567=_0x519ca8[_0xb06c0a(0x1a2)]['toLowerCase']()[_0xb06c0a(0x164)](_0x19b303)||_0x519ca8[_0xb06c0a(0x1ae)][_0xb06c0a(0x187)]()['includes'](_0x19b303)||_0x519ca8[_0xb06c0a(0x167)]&&_0x519ca8[_0xb06c0a(0x167)][_0xb06c0a(0x187)]()[_0xb06c0a(0x164)](_0x19b303);if(!_0x51a567)continue;}const _0x3429bb=new Map();for(const _0x540cc9 of _0x231445){const _0xdeaca5=_0x540cc9['gateway'];!_0x3429bb[_0xb06c0a(0x151)](_0xdeaca5)&&_0x3429bb[_0xb06c0a(0x1e4)](_0xdeaca5,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x540cc9[_0xb06c0a(0x17e)]});const _0xee714=_0x3429bb[_0xb06c0a(0x1c8)](_0xdeaca5);_0xee714['count']++,_0xee714[_0xb06c0a(0x18f)]+=_0x540cc9[_0xb06c0a(0x18f)],_0xee714[_0xb06c0a(0x1ea)]+=_0x540cc9['amountAfterCommissionUSDT'];}const _0x4afdfd=Array[_0xb06c0a(0x207)](_0x3429bb['entries']())[_0xb06c0a(0x17f)](([_0x92173d,_0x3d9c02])=>({'gateway':_0x92173d[_0xb06c0a(0x16f)](0x0)['toUpperCase']()+_0x92173d[_0xb06c0a(0x15a)](0x1),'count':_0x3d9c02[_0xb06c0a(0x1ca)],'amountUSDT':Math[_0xb06c0a(0x1f2)](_0x3d9c02[_0xb06c0a(0x18f)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0xb06c0a(0x1f2)](_0x3d9c02[_0xb06c0a(0x1ea)]*0x64)/0x64,'commission':_0x3d9c02['commission']})),_0x388dc4=_0x231445[_0xb06c0a(0x1e8)]((_0x3a4423,_0x14f6a5)=>{const _0x4d7758=_0xb06c0a;return _0x14f6a5[_0x4d7758(0x1a4)]<_0x3a4423?_0x14f6a5[_0x4d7758(0x1a4)]:_0x3a4423;},_0x231445[0x0][_0xb06c0a(0x1a4)]);_0x3a52f6[_0xb06c0a(0x1a8)]({'id':_0x519ca8['id'],'fullName':_0x519ca8[_0xb06c0a(0x1a2)],'username':_0x519ca8[_0xb06c0a(0x1ae)],'telegramId':_0x519ca8[_0xb06c0a(0x167)],'merchantUrl':_0x519ca8[_0xb06c0a(0x1bf)],'wallets':{'usdtPolygonWallet':_0x519ca8[_0xb06c0a(0x1c4)],'usdtTrcWallet':_0x519ca8[_0xb06c0a(0x195)],'usdtErcWallet':_0x519ca8[_0xb06c0a(0x17d)],'usdcPolygonWallet':_0x519ca8[_0xb06c0a(0x183)]},'totalAmountUSDT':Math[_0xb06c0a(0x1f2)](_0x737fa6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xb06c0a(0x1f2)](_0x17fe6d*0x64)/0x64,'paymentsCount':_0x231445[_0xb06c0a(0x148)],'oldestPaymentDate':_0x388dc4,'gatewayBreakdown':_0x4afdfd});}_0x3a52f6['sort']((_0x1a7bcb,_0x33c4e6)=>_0x33c4e6[_0xb06c0a(0x161)]-_0x1a7bcb[_0xb06c0a(0x161)]);const _0x2f8a14=_0x3a52f6[_0xb06c0a(0x148)],_0x4193c4=_0x3a52f6[_0xb06c0a(0x1e8)]((_0x3195ed,_0x2638d9)=>_0x3195ed+_0x2638d9['totalAmountUSDT'],0x0),_0x418de4=_0x3a52f6[_0xb06c0a(0x1e8)]((_0x2bc916,_0xa95454)=>_0x2bc916+_0xa95454['totalAmountAfterCommissionUSDT'],0x0),_0x188d81=(_0x109e1d-0x1)*_0x264719,_0x37be2f=_0x3a52f6[_0xb06c0a(0x15a)](_0x188d81,_0x188d81+_0x264719);return console['log']('✅\x20Returning\x20'+_0x37be2f[_0xb06c0a(0x148)]+'\x20merchants\x20out\x20of\x20'+_0x2f8a14+_0xb06c0a(0x149)),console[_0xb06c0a(0x1b0)]('💰\x20Total\x20amount:\x20'+_0x4193c4[_0xb06c0a(0x1e2)](0x2)+'\x20USDT\x20('+_0x418de4[_0xb06c0a(0x1e2)](0x2)+_0xb06c0a(0x1ad)),{'merchants':_0x37be2f,'pagination':{'page':_0x109e1d,'limit':_0x264719,'total':_0x2f8a14,'totalPages':Math[_0xb06c0a(0x17b)](_0x2f8a14/_0x264719)},'summary':{'totalMerchants':_0x2f8a14,'totalAmountUSDT':Math[_0xb06c0a(0x1f2)](_0x4193c4*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xb06c0a(0x1f2)](_0x418de4*0x64)/0x64}};}async[a33_0x11458d(0x1b2)](){const _0x366e7a=a33_0x11458d;console[_0x366e7a(0x1b0)]('📊\x20Calculating\x20admin\x20payout\x20statistics...');const _0x47d324=await database_1['default']['payment'][_0x366e7a(0x1f8)]({'where':{'status':{'in':[_0x366e7a(0x166),_0x366e7a(0x189),_0x366e7a(0x1c1)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x366e7a(0x1b0)]('💰\x20Found\x20'+_0x47d324[_0x366e7a(0x148)]+_0x366e7a(0x179));const _0x2e11e3=new Date(),_0x2dcd63=new Date(_0x2e11e3[_0x366e7a(0x1e1)](),_0x2e11e3[_0x366e7a(0x18a)](),0x1),_0x288e90=new Date(_0x2e11e3[_0x366e7a(0x1e1)](),_0x2e11e3[_0x366e7a(0x18a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x3257fe=0x0,_0x2cae55=0x0,_0x57b949=0x0,_0xe1e619=0x0;for(const _0x2820b1 of _0x47d324){const _0x43becf=this[_0x366e7a(0x18d)](_0x2820b1);if(_0x43becf===0x0)continue;let _0x4d087d,_0x56f6b9;if(_0x2820b1[_0x366e7a(0x1ec)]==='CHARGEBACK')_0x4d087d=Math[_0x366e7a(0x1e7)](_0x43becf),_0x56f6b9=-_0x4d087d;else{_0x4d087d=await currencyService_1[_0x366e7a(0x1eb)][_0x366e7a(0x1b4)](_0x2820b1['amount'],_0x2820b1[_0x366e7a(0x178)]);const _0x2416f0=this[_0x366e7a(0x1a6)](_0x2820b1[_0x366e7a(0x1d8)],_0x2820b1[_0x366e7a(0x145)]);_0x56f6b9=this[_0x366e7a(0x174)](_0x4d087d,_0x2416f0[_0x366e7a(0x17e)]);}_0x2820b1[_0x366e7a(0x19a)]&&(_0x3257fe+=_0x56f6b9,_0x2820b1[_0x366e7a(0x1a4)]&&_0x2820b1['paidAt']>=_0x2dcd63&&_0x2820b1[_0x366e7a(0x1a4)]<=_0x288e90&&(_0x57b949+=_0x56f6b9)),_0x2820b1[_0x366e7a(0x1ec)]===_0x366e7a(0x166)&&this[_0x366e7a(0x16d)](_0x2820b1)&&(_0x2cae55+=_0x56f6b9,_0xe1e619+=_0x4d087d);}const _0x4b53e0={'totalPayout':Math[_0x366e7a(0x1f2)](_0x3257fe*0x64)/0x64,'awaitingPayout':Math[_0x366e7a(0x1f2)](_0x2cae55*0x64)/0x64,'thisMonth':Math['round'](_0x57b949*0x64)/0x64,'availableBalance':Math[_0x366e7a(0x1f2)](_0xe1e619*0x64)/0x64};return console['log'](_0x366e7a(0x14b)),console[_0x366e7a(0x1b0)](_0x366e7a(0x1d3)+_0x4b53e0[_0x366e7a(0x201)]+_0x366e7a(0x172)),console[_0x366e7a(0x1b0)](_0x366e7a(0x1ef)+_0x4b53e0['awaitingPayout']+'\x20USDT\x20(только\x20PAID\x20платежи)'),console[_0x366e7a(0x1b0)](_0x366e7a(0x1ee)+_0x4b53e0[_0x366e7a(0x196)]+_0x366e7a(0x1f5)),console['log']('💰\x20Available\x20Balance:\x20'+_0x4b53e0[_0x366e7a(0x1f4)]+_0x366e7a(0x1f5)),_0x4b53e0;}async['getSystemStatistics'](_0x262580){const _0x2727ce=a33_0x11458d,_0x478775=this[_0x2727ce(0x1fd)](_0x262580),_0x5fe52e=new Date();_0x5fe52e[_0x2727ce(0x177)](_0x5fe52e[_0x2727ce(0x1f1)]()-_0x478775),console[_0x2727ce(0x1b0)](_0x2727ce(0x188)+_0x262580+'\x20('+_0x478775+_0x2727ce(0x1cf));const _0x3ac525=await database_1[_0x2727ce(0x1be)][_0x2727ce(0x1d8)][_0x2727ce(0x1ca)]({'where':{'status':_0x2727ce(0x1dd)}}),_0x4a4204=await database_1[_0x2727ce(0x1be)][_0x2727ce(0x1fe)][_0x2727ce(0x1ca)](),_0x5be8d0=await database_1[_0x2727ce(0x1be)][_0x2727ce(0x1fe)][_0x2727ce(0x1f8)]({'where':{'status':{'in':[_0x2727ce(0x166),'REFUND',_0x2727ce(0x1c1)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console['log'](_0x2727ce(0x1e3)+_0x5be8d0[_0x2727ce(0x148)]+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x5e98fc=await Promise[_0x2727ce(0x1e6)](_0x5be8d0[_0x2727ce(0x17f)](async _0x17b0a8=>{const _0x5d64ab=_0x2727ce,_0xfabffb=this[_0x5d64ab(0x18d)](_0x17b0a8);if(_0xfabffb===0x0)return{'amount':0x0,'createdAt':_0x17b0a8[_0x5d64ab(0x206)]};let _0x5306f2;return _0x17b0a8[_0x5d64ab(0x1ec)]===_0x5d64ab(0x1c1)?_0x5306f2=-Math[_0x5d64ab(0x1e7)](_0xfabffb):_0x5306f2=await currencyService_1[_0x5d64ab(0x1eb)][_0x5d64ab(0x1b4)](_0x17b0a8['amount'],_0x17b0a8[_0x5d64ab(0x178)]),{'amount':_0x5306f2,'createdAt':_0x17b0a8[_0x5d64ab(0x206)]};})),_0x1d1c5e=_0x5e98fc[_0x2727ce(0x1e8)]((_0x1bb3bb,_0x3dadc2)=>_0x1bb3bb+_0x3dadc2['amount'],0x0),_0x32f05b=_0x4a4204>0x0?_0x1d1c5e/_0x4a4204:0x0;console[_0x2727ce(0x1b0)](_0x2727ce(0x192)+_0x1d1c5e[_0x2727ce(0x1e2)](0x2)+_0x2727ce(0x172)),console[_0x2727ce(0x1b0)]('📈\x20Average\x20payment:\x20'+_0x32f05b[_0x2727ce(0x1e2)](0x2)+_0x2727ce(0x1f5));const _0x465d0c=await database_1[_0x2727ce(0x1be)][_0x2727ce(0x17a)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x5fe52e}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x2727ce(0x1b0)](_0x2727ce(0x1b7)+_0x465d0c['length']+_0x2727ce(0x1c3));const _0x18a787=await Promise[_0x2727ce(0x1e6)](_0x465d0c[_0x2727ce(0x17f)](async _0xde7a4d=>{const _0x26085b=_0x2727ce,_0x48789f=await Promise[_0x26085b(0x1e6)](_0xde7a4d['payments'][_0x26085b(0x17f)](async _0x3392cd=>{const _0x58d842=_0x26085b,_0x4b2c6f=this[_0x58d842(0x18d)](_0x3392cd);if(_0x4b2c6f===0x0)return 0x0;return _0x3392cd[_0x58d842(0x1ec)]===_0x58d842(0x1c1)?-Math[_0x58d842(0x1e7)](_0x4b2c6f):await currencyService_1[_0x58d842(0x1eb)][_0x58d842(0x1b4)](_0x3392cd[_0x58d842(0x146)],_0x3392cd['currency']);})),_0x521007=_0x48789f['reduce']((_0x1ea8ff,_0x42b56d)=>_0x1ea8ff+_0x42b56d,0x0);return{'date':_0xde7a4d[_0x26085b(0x1a9)][_0x26085b(0x16b)]()[_0x26085b(0x1dc)]('T')[0x0],'amount':_0x521007};})),_0x491368=this[_0x2727ce(0x1e0)](_0x5fe52e,new Date()),_0x34ef2f=new Map(_0x18a787[_0x2727ce(0x17f)](_0xe939a3=>[_0xe939a3[_0x2727ce(0x1a9)],_0xe939a3[_0x2727ce(0x146)]])),_0x389ffc=_0x491368[_0x2727ce(0x17f)](_0x57200c=>({'date':_0x57200c,'amount':_0x34ef2f[_0x2727ce(0x1c8)](_0x57200c)||0x0}));return console['log'](_0x2727ce(0x153)),console[_0x2727ce(0x1b0)](_0x2727ce(0x1b5)+_0x3ac525),console[_0x2727ce(0x1b0)]('💳\x20Total\x20payments:\x20'+_0x4a4204),console[_0x2727ce(0x1b0)]('📊\x20Daily\x20revenue\x20entries:\x20'+_0x389ffc[_0x2727ce(0x148)]),{'totalRevenue':Math[_0x2727ce(0x1f2)](_0x1d1c5e*0x64)/0x64,'totalUsers':_0x3ac525,'totalPayments':_0x4a4204,'averagePayment':Math[_0x2727ce(0x1f2)](_0x32f05b*0x64)/0x64,'dailyRevenue':_0x389ffc};}async[a33_0x11458d(0x156)](_0x920dc){const _0x570d2a=a33_0x11458d,{page:_0x463244,limit:_0x170381,status:_0x387c07,gateway:_0x3d3734,shopId:_0x839d8b,dateFrom:_0x20d2b9,dateTo:_0x17c229,search:_0x76f685}=_0x920dc,_0x35fb2e=(_0x463244-0x1)*_0x170381;console[_0x570d2a(0x1b0)](_0x570d2a(0x158),_0x920dc);const _0xcd6c58={};_0x387c07&&(_0xcd6c58[_0x570d2a(0x1ec)]=_0x387c07[_0x570d2a(0x198)]());if(_0x3d3734){if((0x0,gateway_1[_0x570d2a(0x186)])(_0x3d3734)){const _0x243b54=(0x0,gateway_1[_0x570d2a(0x1b1)])(_0x3d3734);_0x243b54&&(_0xcd6c58['gateway']=_0x243b54);}else _0xcd6c58['gateway']=_0x3d3734[_0x570d2a(0x187)]();}_0x839d8b&&(_0xcd6c58[_0x570d2a(0x1b9)]=_0x839d8b);(_0x20d2b9||_0x17c229)&&(_0xcd6c58[_0x570d2a(0x206)]={},_0x20d2b9&&(_0xcd6c58[_0x570d2a(0x206)][_0x570d2a(0x144)]=new Date(_0x20d2b9)),_0x17c229&&(_0xcd6c58[_0x570d2a(0x206)][_0x570d2a(0x14a)]=new Date(_0x17c229)));_0x76f685&&(_0xcd6c58['OR']=[{'orderId':{'contains':_0x76f685,'mode':_0x570d2a(0x197)}},{'gatewayOrderId':{'contains':_0x76f685,'mode':_0x570d2a(0x197)}},{'gatewayPaymentId':{'contains':_0x76f685,'mode':_0x570d2a(0x197)}},{'customerEmail':{'contains':_0x76f685,'mode':_0x570d2a(0x197)}},{'customerName':{'contains':_0x76f685,'mode':_0x570d2a(0x197)}},{'shop':{'name':{'contains':_0x76f685,'mode':_0x570d2a(0x197)}}},{'shop':{'username':{'contains':_0x76f685,'mode':_0x570d2a(0x197)}}}]);const [_0x47ecec,_0x8163e4]=await Promise[_0x570d2a(0x1e6)]([database_1[_0x570d2a(0x1be)][_0x570d2a(0x1fe)][_0x570d2a(0x1f8)]({'where':_0xcd6c58,'skip':_0x35fb2e,'take':_0x170381,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x570d2a(0x1be)][_0x570d2a(0x1fe)]['count']({'where':_0xcd6c58})]);console[_0x570d2a(0x1b0)](_0x570d2a(0x1b3)+_0x47ecec['length']+_0x570d2a(0x1f0)+_0x8163e4+'\x20total');const _0x595e3d=_0x47ecec[_0x570d2a(0x17f)](_0xd96146=>({'id':_0xd96146['id'],'shopId':_0xd96146[_0x570d2a(0x1b9)],'shopName':_0xd96146[_0x570d2a(0x1d8)][_0x570d2a(0x1a2)],'shopUsername':_0xd96146['shop'][_0x570d2a(0x1ae)],'gateway':_0xd96146[_0x570d2a(0x145)],'orderId':_0xd96146[_0x570d2a(0x1db)],'gatewayOrderId':_0xd96146[_0x570d2a(0x169)],'amount':_0xd96146['amount'],'currency':_0xd96146['currency'],'sourceCurrency':_0xd96146[_0x570d2a(0x14d)],'status':_0xd96146[_0x570d2a(0x1ec)],'usage':_0xd96146[_0x570d2a(0x1fa)],'externalPaymentUrl':_0xd96146[_0x570d2a(0x1d2)],'gatewayPaymentId':_0xd96146['gatewayPaymentId'],'customerEmail':_0xd96146[_0x570d2a(0x1cd)],'customerName':_0xd96146[_0x570d2a(0x209)],'cardLast4':_0xd96146[_0x570d2a(0x1a3)],'paymentMethod':_0xd96146[_0x570d2a(0x1e5)],'bankId':_0xd96146[_0x570d2a(0x1cc)],'remitterIban':_0xd96146[_0x570d2a(0x170)],'remitterName':_0xd96146[_0x570d2a(0x1aa)],'chargebackAmount':_0xd96146['chargebackAmount'],'adminNotes':_0xd96146[_0x570d2a(0x199)],'statusChangedBy':_0xd96146['statusChangedBy'],'statusChangedAt':_0xd96146[_0x570d2a(0x16c)],'createdAt':_0xd96146[_0x570d2a(0x206)],'updatedAt':_0xd96146['updatedAt'],'expiresAt':_0xd96146[_0x570d2a(0x157)]}));return{'payments':_0x595e3d,'pagination':{'page':_0x463244,'limit':_0x170381,'total':_0x8163e4,'totalPages':Math['ceil'](_0x8163e4/_0x170381)}};}async[a33_0x11458d(0x15c)](_0x1fab64){const _0x2a4bd4=a33_0x11458d;console[_0x2a4bd4(0x1b0)](_0x2a4bd4(0x15e)+_0x1fab64);const _0x5ba38d=await database_1[_0x2a4bd4(0x1be)][_0x2a4bd4(0x1fe)][_0x2a4bd4(0x191)]({'where':{'id':_0x1fab64},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x5ba38d)return console[_0x2a4bd4(0x1b0)]('❌\x20Payment\x20not\x20found:\x20'+_0x1fab64),null;return console[_0x2a4bd4(0x1b0)](_0x2a4bd4(0x15f)+_0x5ba38d[_0x2a4bd4(0x1db)]+'\x20('+_0x5ba38d[_0x2a4bd4(0x1ec)]+')'),{'id':_0x5ba38d['id'],'shopId':_0x5ba38d[_0x2a4bd4(0x1b9)],'shopName':_0x5ba38d[_0x2a4bd4(0x1d8)]['name'],'shopUsername':_0x5ba38d[_0x2a4bd4(0x1d8)][_0x2a4bd4(0x1ae)],'gateway':_0x5ba38d[_0x2a4bd4(0x145)],'orderId':_0x5ba38d[_0x2a4bd4(0x1db)],'gatewayOrderId':_0x5ba38d[_0x2a4bd4(0x169)],'amount':_0x5ba38d[_0x2a4bd4(0x146)],'currency':_0x5ba38d[_0x2a4bd4(0x178)],'sourceCurrency':_0x5ba38d[_0x2a4bd4(0x14d)],'status':_0x5ba38d['status'],'usage':_0x5ba38d[_0x2a4bd4(0x1fa)],'externalPaymentUrl':_0x5ba38d['externalPaymentUrl'],'gatewayPaymentId':_0x5ba38d[_0x2a4bd4(0x152)],'customerEmail':_0x5ba38d[_0x2a4bd4(0x1cd)],'customerName':_0x5ba38d[_0x2a4bd4(0x209)],'cardLast4':_0x5ba38d[_0x2a4bd4(0x1a3)],'paymentMethod':_0x5ba38d['paymentMethod'],'bankId':_0x5ba38d[_0x2a4bd4(0x1cc)],'remitterIban':_0x5ba38d[_0x2a4bd4(0x170)],'remitterName':_0x5ba38d[_0x2a4bd4(0x1aa)],'chargebackAmount':_0x5ba38d[_0x2a4bd4(0x208)],'adminNotes':_0x5ba38d[_0x2a4bd4(0x199)],'statusChangedBy':_0x5ba38d[_0x2a4bd4(0x19c)],'statusChangedAt':_0x5ba38d[_0x2a4bd4(0x16c)],'createdAt':_0x5ba38d[_0x2a4bd4(0x206)],'updatedAt':_0x5ba38d[_0x2a4bd4(0x15b)],'expiresAt':_0x5ba38d[_0x2a4bd4(0x157)],'webhookLogs':_0x5ba38d[_0x2a4bd4(0x173)]};}async[a33_0x11458d(0x211)](_0x13fbdb,_0x5e5822,_0x536d7a,_0x2bc12b){const _0x1a7ec8=a33_0x11458d;console[_0x1a7ec8(0x1b0)](_0x1a7ec8(0x14c)+_0x13fbdb+'\x20status\x20to:\x20'+_0x5e5822);const _0x12b3c8=[_0x1a7ec8(0x1bc),_0x1a7ec8(0x18e),_0x1a7ec8(0x166),'EXPIRED','FAILED','REFUND',_0x1a7ec8(0x1c1)];if(!_0x12b3c8[_0x1a7ec8(0x164)](_0x5e5822['toUpperCase']()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x12b3c8[_0x1a7ec8(0x160)](',\x20'));const _0x24649b=await database_1[_0x1a7ec8(0x1be)][_0x1a7ec8(0x1fe)][_0x1a7ec8(0x191)]({'where':{'id':_0x13fbdb},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x24649b)throw new Error(_0x1a7ec8(0x202));if(_0x5e5822[_0x1a7ec8(0x198)]()==='CHARGEBACK'){if(!_0x2bc12b||_0x2bc12b<=0x0)throw new Error(_0x1a7ec8(0x14f));console['log'](_0x1a7ec8(0x194)+_0x2bc12b+_0x1a7ec8(0x213));}const _0x1c21d6={'status':_0x5e5822[_0x1a7ec8(0x198)](),'updatedAt':new Date()};_0x536d7a&&(_0x1c21d6[_0x1a7ec8(0x199)]=_0x536d7a);_0x5e5822['toUpperCase']()===_0x1a7ec8(0x1c1)&&_0x2bc12b&&(_0x1c21d6['chargebackAmount']=_0x2bc12b);const _0x5e6adc=await database_1[_0x1a7ec8(0x1be)][_0x1a7ec8(0x1fe)][_0x1a7ec8(0x1f6)]({'where':{'id':_0x13fbdb},'data':_0x1c21d6,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x1a7ec8(0x1be)][_0x1a7ec8(0x1a7)]['create']({'data':{'paymentId':_0x13fbdb,'shopId':_0x5e6adc['shopId'],'event':_0x1a7ec8(0x1bb),'statusCode':0xc8,'responseBody':JSON[_0x1a7ec8(0x20e)]({'oldStatus':_0x24649b['status'],'newStatus':_0x5e5822[_0x1a7ec8(0x198)](),'notes':_0x536d7a||null,'chargebackAmount':_0x2bc12b||null,'timestamp':new Date()[_0x1a7ec8(0x16b)]()})}}),console[_0x1a7ec8(0x1b0)](_0x1a7ec8(0x1d4)+_0x24649b['orderId']+'\x20status\x20updated\x20from\x20'+_0x24649b[_0x1a7ec8(0x1ec)]+_0x1a7ec8(0x1d0)+_0x5e5822[_0x1a7ec8(0x198)]()),_0x5e5822[_0x1a7ec8(0x198)]()===_0x1a7ec8(0x1c1)&&console[_0x1a7ec8(0x1b0)]('💸\x20Chargeback\x20penalty:\x20'+_0x2bc12b+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0x5e6adc['id'],'shopId':_0x5e6adc['shopId'],'shopName':_0x5e6adc[_0x1a7ec8(0x1d8)][_0x1a7ec8(0x1a2)],'shopUsername':_0x5e6adc[_0x1a7ec8(0x1d8)][_0x1a7ec8(0x1ae)],'gateway':_0x5e6adc[_0x1a7ec8(0x145)],'orderId':_0x5e6adc['orderId'],'gatewayOrderId':_0x5e6adc[_0x1a7ec8(0x169)],'amount':_0x5e6adc[_0x1a7ec8(0x146)],'currency':_0x5e6adc[_0x1a7ec8(0x178)],'sourceCurrency':_0x5e6adc['sourceCurrency'],'status':_0x5e6adc[_0x1a7ec8(0x1ec)],'usage':_0x5e6adc[_0x1a7ec8(0x1fa)],'externalPaymentUrl':_0x5e6adc['externalPaymentUrl'],'gatewayPaymentId':_0x5e6adc[_0x1a7ec8(0x152)],'customerEmail':_0x5e6adc['customerEmail'],'customerName':_0x5e6adc[_0x1a7ec8(0x209)],'cardLast4':_0x5e6adc[_0x1a7ec8(0x1a3)],'paymentMethod':_0x5e6adc[_0x1a7ec8(0x1e5)],'bankId':_0x5e6adc['bankId'],'remitterIban':_0x5e6adc['remitterIban'],'remitterName':_0x5e6adc['remitterName'],'chargebackAmount':_0x5e6adc['chargebackAmount'],'adminNotes':_0x5e6adc[_0x1a7ec8(0x199)],'statusChangedBy':_0x5e6adc[_0x1a7ec8(0x19c)],'statusChangedAt':_0x5e6adc[_0x1a7ec8(0x16c)],'createdAt':_0x5e6adc['createdAt'],'updatedAt':_0x5e6adc['updatedAt'],'expiresAt':_0x5e6adc[_0x1a7ec8(0x157)]};}async[a33_0x11458d(0x203)](_0x463ca2){const _0x555290=a33_0x11458d,{page:_0x29a922,limit:_0x6e127a,status:_0x99e9a1}=_0x463ca2,_0xa12ccb=(_0x29a922-0x1)*_0x6e127a,_0x1b9a02={};_0x99e9a1&&(_0x1b9a02['status']=_0x99e9a1['toUpperCase']());console['log']('📋\x20Getting\x20users\x20with\x20filters:',{'page':_0x29a922,'limit':_0x6e127a,'status':_0x99e9a1,'where':_0x1b9a02});const [_0x3259e3,_0x34e523]=await Promise['all']([database_1['default'][_0x555290(0x1d8)][_0x555290(0x1f8)]({'where':_0x1b9a02,'skip':_0xa12ccb,'take':_0x6e127a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x555290(0x18b)}}),database_1[_0x555290(0x1be)][_0x555290(0x1d8)][_0x555290(0x1ca)]({'where':_0x1b9a02})]);console['log'](_0x555290(0x1b3)+_0x3259e3[_0x555290(0x148)]+_0x555290(0x175)+_0x34e523+'\x20total');const _0x198d86=_0x3259e3[_0x555290(0x17f)](_0x35ee25=>({'id':_0x35ee25['id'],'fullName':_0x35ee25[_0x555290(0x1a2)],'username':_0x35ee25[_0x555290(0x1ae)],'telegramId':_0x35ee25[_0x555290(0x167)],'merchantUrl':_0x35ee25[_0x555290(0x1bf)],'gateways':_0x35ee25[_0x555290(0x19b)]?JSON[_0x555290(0x204)](_0x35ee25[_0x555290(0x19b)]):null,'gatewaySettings':_0x35ee25['gatewaySettings']?JSON[_0x555290(0x204)](_0x35ee25[_0x555290(0x1ce)]):null,'publicKey':_0x35ee25[_0x555290(0x1a5)],'wallets':{'usdtPolygonWallet':_0x35ee25[_0x555290(0x1c4)],'usdtTrcWallet':_0x35ee25[_0x555290(0x195)],'usdtErcWallet':_0x35ee25[_0x555290(0x17d)],'usdcPolygonWallet':_0x35ee25[_0x555290(0x183)]},'status':_0x35ee25[_0x555290(0x1ec)],'createdAt':_0x35ee25[_0x555290(0x206)]}));return{'users':_0x198d86,'pagination':{'page':_0x29a922,'limit':_0x6e127a,'total':_0x34e523,'totalPages':Math[_0x555290(0x17b)](_0x34e523/_0x6e127a)}};}async['getUserById'](_0x221ef0){const _0x6893ed=a33_0x11458d;return await this[_0x6893ed(0x162)]['getUserById'](_0x221ef0);}async[a33_0x11458d(0x20c)](_0x2992b5){const _0x31d3ee=a33_0x11458d;return await this[_0x31d3ee(0x162)][_0x31d3ee(0x20c)](_0x2992b5);}async[a33_0x11458d(0x1df)](_0x4eadc9,_0x132305){const _0x194a2d=a33_0x11458d;return await this['userService'][_0x194a2d(0x1df)](_0x4eadc9,_0x132305);}async[a33_0x11458d(0x159)](_0x1fdb7f){const _0xaad0a=a33_0x11458d;return await this['userService'][_0xaad0a(0x159)](_0x1fdb7f);}async[a33_0x11458d(0x180)](_0x5e6aa4){const _0x378860=a33_0x11458d;console[_0x378860(0x1b0)]('🚫\x20Suspending\x20user:\x20'+_0x5e6aa4);const _0x1fe1f4=await database_1[_0x378860(0x1be)]['shop'][_0x378860(0x191)]({'where':{'id':_0x5e6aa4},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x1fe1f4)throw new Error(_0x378860(0x1a0));if(_0x1fe1f4[_0x378860(0x1ec)]==='SUSPENDED')throw new Error(_0x378860(0x1af));const _0x26f048=await this[_0x378860(0x162)][_0x378860(0x1df)](_0x5e6aa4,{'status':_0x378860(0x1c7)});return console[_0x378860(0x1b0)]('✅\x20User\x20'+_0x1fe1f4[_0x378860(0x1ae)]+_0x378860(0x20f)),_0x26f048;}async[a33_0x11458d(0x1d1)](_0x20bb85){const _0xa164f5=a33_0x11458d;console['log'](_0xa164f5(0x193)+_0x20bb85);const _0x102be8=await database_1[_0xa164f5(0x1be)][_0xa164f5(0x1d8)][_0xa164f5(0x191)]({'where':{'id':_0x20bb85},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x102be8)throw new Error(_0xa164f5(0x1a0));if(_0x102be8[_0xa164f5(0x1ec)]===_0xa164f5(0x1dd))throw new Error(_0xa164f5(0x1d5));const _0x36228b=await this['userService'][_0xa164f5(0x1df)](_0x20bb85,{'status':_0xa164f5(0x1dd)});return console[_0xa164f5(0x1b0)](_0xa164f5(0x1bd)+_0x102be8[_0xa164f5(0x1ae)]+_0xa164f5(0x200)),_0x36228b;}}exports['AdminService']=AdminService;function a33_0x3fff(){const _0x56b3e7=['gte','gateway','amount','812960IwbIyD','length','\x20total','lte','✅\x20Payout\x20statistics\x20calculated:','🔄\x20Updating\x20payment\x20','sourceCurrency','createPayout','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','markPaymentsAsPaidOut','has','gatewayPaymentId','✅\x20Admin\x20statistics\x20generated\x20successfully','\x20payments\x20as\x20paid\x20out','telegramBotService','getAllPayments','expiresAt','📋\x20Getting\x20payments\x20with\x20filters:','deleteUser','slice','updatedAt','getPaymentById','payoutDelay','🔍\x20Getting\x20payment\x20by\x20ID:\x20','✅\x20Found\x20payment:\x20','join','totalAmountAfterCommissionUSDT','userService','defineProperty','includes','\x20deleted\x20successfully','PAID','telegram','6qNrQVV','gatewayOrderId','27428YMVTtG','toISOString','statusChangedAt','isEligibleForPayout','../config/database','charAt','remitterIban','__importDefault','\x20USDT\x20(включая\x20штрафы\x20chargeback)','webhookLogs','calculateAmountAfterCommission','\x20users\x20out\x20of\x20','💸\x20Creating\x20payout\x20for\x20shop\x20','setDate','currency','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','$queryRaw','ceil','asc','usdtErcWallet','commission','map','suspendUser','create','getAllPayouts','usdcPolygonWallet','1477180vNbqlw','🗑️\x20Deleting\x20payout:\x20','isValidGatewayId','toLowerCase','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','REFUND','getMonth','desc','Error\x20parsing\x20gateway\x20settings:','calculateEffectiveAmount','PROCESSING','amountUSDT','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','findUnique','💵\x20Total\x20revenue:\x20','✅\x20Activating\x20user:\x20','💸\x20Chargeback\x20amount:\x20','usdtTrcWallet','thisMonth','insensitive','toUpperCase','adminNotes','merchantPaid','paymentGateways','statusChangedBy','❌\x20Payout\x20not\x20found:\x20','Payout\x20not\x20found','__esModule','User\x20not\x20found','size','name','cardLast4','paidAt','publicKey','getGatewaySettings','webhookLog','push','date','remitterName','getMerchantsAwaitingPayout','1443630tKyalj','\x20USDT\x20after\x20commission)','username','User\x20is\x20already\x20suspended','log','getGatewayNameById','getPayoutStats','📊\x20Found\x20','convertToUSDT','👥\x20Total\x20users:\x20','network','📅\x20Processing\x20daily\x20stats\x20for\x20','./telegramBotService','shopId','error','status_update','PENDING','✅\x20User\x20','default','shopUrl','90d','CHARGEBACK','UserService','\x20days','usdtPolygonWallet','./userService','\x20payouts\x20out\x20of\x20','SUSPENDED','get','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','count','✅\x20Payout\x20','bankId','customerEmail','gatewaySettings','\x20days)','\x20to\x20','activateUser','externalPaymentUrl','💸\x20Total\x20Payout:\x20','✅\x20Payment\x20','User\x20is\x20already\x20active','3279535GOcAYy','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','shop','txid','payments','orderId','split','ACTIVE','deletePayout','updateUser','generateDateRange','getFullYear','toFixed','💰\x20Found\x20','set','paymentMethod','all','abs','reduce','payout','amountAfterCommissionUSDT','currencyService','status','30d','📅\x20This\x20Month:\x20','⏳\x20Awaiting\x20Payout:\x20','\x20payments\x20out\x20of\x20','getDate','round','✅\x20Found\x20payout:\x20','availableBalance','\x20USDT','update','4228441BkHBlp','findMany','notes','usage','✅\x20Marked\x20','\x20USDT\x20via\x20','getPeriodDays','payment','5666800pHKmGI','\x20activated\x20successfully','totalPayout','Payment\x20not\x20found','getAllUsers','parse','Shop\x20is\x20not\x20active','createdAt','from','chargebackAmount','customerName','🔍\x20Getting\x20payout\x20by\x20ID:\x20','COMPLETED','createUser','AdminService','stringify','\x20suspended\x20successfully','../types/gateway','updatePaymentStatus','updateMany','\x20USDT\x20(penalty\x20amount)'];a33_0x3fff=function(){return _0x56b3e7;};return a33_0x3fff();}