'use strict';const a35_0xbba01f=a35_0x3f14;function a35_0x3f14(_0x515e5b,_0x39a62f){const _0x113719=a35_0x1137();return a35_0x3f14=function(_0x3f1410,_0x48269d){_0x3f1410=_0x3f1410-0xf9;let _0x30fbd0=_0x113719[_0x3f1410];return _0x30fbd0;},a35_0x3f14(_0x515e5b,_0x39a62f);}(function(_0x15498f,_0x3d9b9a){const _0x317154=a35_0x3f14,_0x4d0694=_0x15498f();while(!![]){try{const _0x14701a=-parseInt(_0x317154(0x110))/0x1+-parseInt(_0x317154(0x1d4))/0x2+-parseInt(_0x317154(0x11c))/0x3+parseInt(_0x317154(0x12b))/0x4+parseInt(_0x317154(0x135))/0x5*(parseInt(_0x317154(0x1fe))/0x6)+-parseInt(_0x317154(0x1a3))/0x7*(-parseInt(_0x317154(0x1ee))/0x8)+-parseInt(_0x317154(0x182))/0x9*(parseInt(_0x317154(0x1d2))/0xa);if(_0x14701a===_0x3d9b9a)break;else _0x4d0694['push'](_0x4d0694['shift']());}catch(_0x21890f){_0x4d0694['push'](_0x4d0694['shift']());}}}(a35_0x1137,0xccc2e));var __importDefault=this&&this[a35_0xbba01f(0x146)]||function(_0x1fae2f){const _0x50f7e4=a35_0xbba01f;return _0x1fae2f&&_0x1fae2f[_0x50f7e4(0x1b4)]?_0x1fae2f:{'default':_0x1fae2f};};Object[a35_0xbba01f(0x1bf)](exports,a35_0xbba01f(0x1b4),{'value':!![]}),exports[a35_0xbba01f(0x1ce)]=void 0x0;const database_1=__importDefault(require(a35_0xbba01f(0x16e))),bcryptjs_1=__importDefault(require(a35_0xbba01f(0x174))),crypto_1=__importDefault(require(a35_0xbba01f(0x18a))),currencyService_1=require(a35_0xbba01f(0x186)),gateway_1=require(a35_0xbba01f(0x1e7));function a35_0x1137(){const _0x21a282=['totalPayout','fullName','period','toString','pk_','SUSPENDED','\x20USDT\x20(with\x20commission\x20deducted)','\x20\x20\x20💰\x20Total\x20payout:\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20Payout\x20amount:\x20','publicKey','insensitive','1169VeGLET','join','%\x20commission)','randomBytes','not\x20specified','amount','not\x20set','\x27\x20to\x20name\x20\x27','getDate','✅\x20Using\x20gateway\x20filter:\x20\x27','📊\x20Sorting\x20payments\x20by\x20','\x20USDT\x20(without\x20commission)','🔄\x20Converted\x20gateway\x20name\x20\x27','PAID','whiteUrl','\x20merchants\x20with\x20positive\x20balance','dateFrom','__esModule','periodFrom','usdtPolygonWallet','\x27\x20(from\x20\x27','averageCheckUSDT','🔍\x20Using\x20gateway\x20\x27','totalAmountAfterCommissionUSDT','some','statusChangedAt','createUser','\x20USDT\x20(after\x20payouts)','defineProperty','polygon','\x20USDT\x20(actual\x20balances)','dailyRevenue','Telegram\x20username\x20already\x20exists','\x20USDT\x20(+','\x20USDT\x20(after\x20','_sum','KLYME\x20GB','getPayoutById','Rapyd','groupBy','usdtTrcWallet','ACTIVE','default','AdminService','\x20balance\x20updated:\x20','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20Total\x20paid\x20out:\x20','320aqtvNt','\x20\x20\x20🖥️\x20User\x20Agent:\x20','38428RPLGOS','usdcPolygonWallet','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','telegram','getGatewayNameById','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20USDT\x20(gross\x20revenue)','paidOutUSDT','revenue','📊\x20Merchants\x20awaiting\x20payout:\x20','hex','\x20PAID\x20payments','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','💰\x20Found\x20','getPaymentById','availableBalance','\x20for\x20shop\x20','💰\x20[PAYOUT]\x20Gateway\x20','Plisio','../types/gateway','set','localeCompare','currencyService','getGatewayIdByName','paymentsCount','includes','80312QwzmIK','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','💳\x20Payout\x20wallet\x20for\x20',',\x20Commission:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','thisMonth','averageCommissionRate','failureMessage','getMerchantsSelection','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','findMany','totalPaidOut','notes','setDate','chargebackAmount','5795778iNyotf','telegramId','\x20became\x20PAID:','dateTo','REFUND','✅\x20Payout\x20created:\x20','failUrl','Noda','\x27\x20->\x20ID\x20\x27','📊\x20Gateway\x20filter\x20applied:','getGatewayDisplayName','📊\x20Calculating\x20payout\x20statistics...','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','ceil','📊\x20Merchant\x20statistics\x20calculated:','updatedAt','📊\x20Payout\x20statistics\x20calculated:','values','erc20','orderId','\x20\x20\x20🌍\x20Country:\x20','gte','gatewaySettings','periodTo','test_gateway','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','password','stringify','\x20\x20\x20Added\x20to\x20balance:\x20+','getAllPayouts','getMonth','awaitingPayout','updateUser','gatewayOrderId','round','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','adminNotes','customerCountry','findFirst','📋\x20Getting\x20merchants\x20selection\x20list...',':\x20commission\x20=\x20','map','push','deleteUser','\x20USDT','entries','COMPLETED','commissionUSDT','polygon_usdc','\x20paid\x20payments\x20for\x20analysis','\x20\x20\x20📅\x20This\x20month:\x20','findUnique','912489EzsFhX','gateways','successUrl','aggregate','desc','week','error','customerIp','suspendUser','getSystemStatistics','merchantEarningsUSDT','txid','3199689LuYLNh','getUserById','\x20\x20\x20💳\x20Total\x20payments:\x20','amountAfterCommissionUSDT','getAllPayments','getMerchantsAwaitingPayout','Username\x20already\x20exists','💱\x20Currency\x20filter\x20applied:\x20','update','username','💰\x20Current\x20shop\x20balance:\x20','KLYME\x20EU','💰\x20Payment\x20','parse','split','6114288XKMfEM','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','turnover','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','reduce','custom','getFullYear','date','\x20USDT\x20from\x20balance','CHARGEBACK','5GkcyEO','usdtErcWallet','\x20order','\x20\x20\x20Transaction\x20hash:\x20','summary','\x20\x20\x20Gateway:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','shopId','\x20\x20\x20Full\x20amount:\x20','network','shop','convertToUSDT','\x20->\x20','customerName','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20in\x20','\x20status:\x20','__importDefault','customerEmail','turnoverUSDT','paidAt','name','lte','90d','2020-01-01','$transaction','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','shopUrl','📅\x20Period:\x20','pendingUrl','🔄\x20Converted\x20gateway\x20ID\x20\x27','getTime','wallets','\x20balance\x20updated:','toUpperCase','createdAt','totalPayments','trc20','payout','\x20USDT\x20(same\x20as\x20awaiting)','balance','payment','\x20merchants','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','Payment\x20not\x20found','Insufficient\x20balance.\x20Available:\x20','30d','📊\x20Available\x20gateways\x20in\x20database:','\x20USDT)',',\x20successful:\x20','merchantEarnings','⚠️\x20Gateway\x20\x27','Test\x20Gateway','customerUa','paymentGateways','../config/database','externalPaymentUrl','\x20\x20\x20🌐\x20IP:\x20','💰\x20Shop\x20','⚠️\x20Requested\x20gateway\x20\x27','\x20active\x20merchants\x20for\x20selection','bcryptjs','delete','forEach','KLYME\x20DE','\x20USDT,\x20Requested:\x20','💰\x20[PAYOUT]\x20Merchant\x20','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','toISOString','toLowerCase','\x20\x20\x20Balance:\x20','toFixed','commission','currency','\x20USDT\x20(theoretical\x20net)','375210OwvRtK','status','length','hash','./currencyService','all','\x20\x20\x20📊\x20Total\x20payments:\x20','\x20USDT\x20(-','crypto','merchantUrl','count','admin','createPayout','amountUSDT','📊\x20Getting\x20payments\x20with\x20filters:','log','totalCommissionRate','CoinToPay','gateway','asc','_count'];a35_0x1137=function(){return _0x21a282;};return a35_0x1137();}class AdminService{async['getPayoutStats'](){const _0x323b93=a35_0xbba01f;console[_0x323b93(0x191)](_0x323b93(0x209));const _0x366cc9=await database_1['default'][_0x323b93(0x13f)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x323b93(0x1cc)}}),_0x1d5853=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0xfdf6ef=await database_1['default'][_0x323b93(0x160)]['count']({'where':{'status':_0x323b93(0x1b0),'gateway':{'not':_0x323b93(0x217)}}}),_0x29acc0=new Date(),_0x310fff=new Date(_0x29acc0[_0x323b93(0x131)](),_0x29acc0['getMonth'](),0x1),_0x7be7af=new Date(_0x29acc0[_0x323b93(0x131)](),_0x29acc0[_0x323b93(0xfa)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3b30ab=await database_1['default'][_0x323b93(0x15d)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x310fff,'lte':_0x7be7af},'status':'COMPLETED'}}),_0x320cb2=_0x366cc9[_0x323b93(0x1c6)][_0x323b93(0x1fa)]||0x0,_0x13b2a0=_0x1d5853[_0x323b93(0x139)][_0x323b93(0x1ba)],_0x85df0a=_0x3b30ab['_sum']['amount']||0x0,_0x2e462b={'totalPayout':Math[_0x323b93(0xfe)](_0x320cb2*0x64)/0x64,'awaitingPayout':Math[_0x323b93(0xfe)](_0x13b2a0*0x64)/0x64,'thisMonth':Math[_0x323b93(0xfe)](_0x85df0a*0x64)/0x64,'availableBalance':Math[_0x323b93(0xfe)](_0x13b2a0*0x64)/0x64,'totalPayments':_0xfdf6ef};return console['log'](_0x323b93(0x20f)),console[_0x323b93(0x191)](_0x323b93(0x19e)+_0x2e462b['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x323b93(0x191)](_0x323b93(0x20b)+_0x2e462b[_0x323b93(0xfb)]+_0x323b93(0x19d)),console[_0x323b93(0x191)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x2e462b[_0x323b93(0x1e3)]+_0x323b93(0x15e)),console[_0x323b93(0x191)](_0x323b93(0x10e)+_0x2e462b['thisMonth']+_0x323b93(0x108)),console['log'](_0x323b93(0x11e)+_0x2e462b[_0x323b93(0x15b)]+_0x323b93(0x1df)),console['log'](_0x323b93(0x1d6)+(_0x366cc9['_sum'][_0x323b93(0x15f)]||0x0)['toFixed'](0x2)+_0x323b93(0x1ae)),console[_0x323b93(0x191)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x366cc9[_0x323b93(0x1c6)][_0x323b93(0x15f)]||0x0)-_0x13b2a0)[_0x323b93(0x17e)](0x2)+_0x323b93(0x108)),_0x2e462b;}async['updateCustomerData'](_0x3f0a8e,_0x216863){const _0xe7f265=a35_0xbba01f;console[_0xe7f265(0x191)](_0xe7f265(0x19f)+_0x3f0a8e+':',_0x216863);const _0x318651=await database_1['default'][_0xe7f265(0x160)][_0xe7f265(0x10f)]({'where':{'id':_0x3f0a8e},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x318651)throw new Error(_0xe7f265(0x163));const _0xec340={};_0x216863['customerCountry']!==undefined&&(_0xec340[_0xe7f265(0x101)]=_0x216863['customerCountry']||null);_0x216863['customerIp']!==undefined&&(_0xec340[_0xe7f265(0x117)]=_0x216863[_0xe7f265(0x117)]||null);_0x216863[_0xe7f265(0x16c)]!==undefined&&(_0xec340[_0xe7f265(0x16c)]=_0x216863[_0xe7f265(0x16c)]||null);const _0x1e8a83=await database_1[_0xe7f265(0x1cd)]['payment'][_0xe7f265(0x124)]({'where':{'id':_0x3f0a8e},'data':{..._0xec340,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xe7f265(0x191)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x3f0a8e),console['log'](_0xe7f265(0x213)+_0x318651['customerCountry']+'\x20->\x20'+_0x1e8a83[_0xe7f265(0x101)]),console[_0xe7f265(0x191)](_0xe7f265(0x170)+_0x318651[_0xe7f265(0x117)]+_0xe7f265(0x141)+_0x1e8a83[_0xe7f265(0x117)]),console[_0xe7f265(0x191)](_0xe7f265(0x1d3)+(_0x318651['customerUa']?_0xe7f265(0x1e8):_0xe7f265(0x1a9))+'\x20->\x20'+(_0x1e8a83[_0xe7f265(0x16c)]?_0xe7f265(0x1e8):_0xe7f265(0x1a9))),_0x1e8a83;}async[a35_0xbba01f(0x119)](_0xdc8fb0){const _0x1c3f4f=a35_0xbba01f,_0x4d041c=new Date();let _0x378b37;switch(_0xdc8fb0){case'7d':_0x378b37=new Date(_0x4d041c[_0x1c3f4f(0x156)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1c3f4f(0x165):_0x378b37=new Date(_0x4d041c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1c3f4f(0x14c):_0x378b37=new Date(_0x4d041c[_0x1c3f4f(0x156)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x1c3f4f(0x187):const _0xd97e51=await database_1['default']['payment'][_0x1c3f4f(0x102)]({'where':{'gateway':{'not':_0x1c3f4f(0x217)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x378b37=_0xd97e51?_0xd97e51[_0x1c3f4f(0x15a)]:new Date(_0x1c3f4f(0x14d)),console[_0x1c3f4f(0x191)]('📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x378b37[_0x1c3f4f(0x17b)]());break;default:_0x378b37=new Date(_0x4d041c[_0x1c3f4f(0x156)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xa80ff7,_0x3c8b8d,_0xae95ed,_0x5b1548,_0x327a45,_0x5b7c03,_0x56a432]=await Promise[_0x1c3f4f(0x187)]([database_1[_0x1c3f4f(0x1cd)][_0x1c3f4f(0x13f)]['count'](),database_1[_0x1c3f4f(0x1cd)][_0x1c3f4f(0x13f)]['count']({'where':{'status':_0x1c3f4f(0x1cc)}}),database_1[_0x1c3f4f(0x1cd)]['payment']['count']({'where':{'createdAt':{'gte':_0x378b37},'gateway':{'not':_0x1c3f4f(0x217)}}}),database_1[_0x1c3f4f(0x1cd)]['payment'][_0x1c3f4f(0x18c)]({'where':{'status':_0x1c3f4f(0x1b0),'createdAt':{'gte':_0x378b37},'gateway':{'not':_0x1c3f4f(0x217)}}}),database_1[_0x1c3f4f(0x1cd)][_0x1c3f4f(0x160)][_0x1c3f4f(0x1f9)]({'where':{'status':_0x1c3f4f(0x1b0),'createdAt':{'gte':_0x378b37},'gateway':{'not':_0x1c3f4f(0x217)}},'select':{'amount':!![],'currency':!![]}}),database_1['default']['payment']['findMany']({'where':{'gateway':{'not':_0x1c3f4f(0x217)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x1c3f4f(0x160)][_0x1c3f4f(0x1f9)]({'where':{'createdAt':{'gte':_0x378b37},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x43737c=0x0;for(const _0x4d67bf of _0x327a45){const _0xe8c598=await currencyService_1[_0x1c3f4f(0x1ea)]['convertToUSDT'](_0x4d67bf[_0x1c3f4f(0x1a8)],_0x4d67bf['currency']);_0x43737c+=_0xe8c598;}const _0x14999f=this['generateDailyStatistics'](_0x56a432,_0x378b37,_0x4d041c),_0xd91b53=_0xae95ed>0x0?_0x5b1548/_0xae95ed*0x64:0x0;return{'totalShops':_0xa80ff7,'activeShops':_0x3c8b8d,'totalPayments':_0xae95ed,'successfulPayments':_0x5b1548,'totalRevenue':Math[_0x1c3f4f(0xfe)](_0x43737c*0x64)/0x64,'conversionRate':Math['round'](_0xd91b53*0x64)/0x64,'dailyRevenue':_0x14999f[_0x1c3f4f(0x1c2)],'dailyPayments':_0x14999f['dailyPayments'],'recentPayments':_0x5b7c03[_0x1c3f4f(0x105)](_0x2e21b2=>({'id':_0x2e21b2['id'],'amount':_0x2e21b2['amount'],'currency':_0x2e21b2[_0x1c3f4f(0x180)],'status':_0x2e21b2['status'],'gateway':_0x2e21b2[_0x1c3f4f(0x194)],'shop':_0x2e21b2[_0x1c3f4f(0x13f)],'createdAt':_0x2e21b2[_0x1c3f4f(0x15a)]}))};}async['getMerchantStatistics'](_0x4d64f3){const _0x432c56=a35_0xbba01f;console['log']('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x4d64f3);let _0x5ec7bd,_0x15dbf2=new Date();if(_0x4d64f3[_0x432c56(0x199)]===_0x432c56(0x130)&&_0x4d64f3[_0x432c56(0x1b3)]&&_0x4d64f3[_0x432c56(0x201)])_0x5ec7bd=new Date(_0x4d64f3[_0x432c56(0x1b3)]),_0x15dbf2=new Date(_0x4d64f3[_0x432c56(0x201)]);else{const _0x39b215=new Date();switch(_0x4d64f3[_0x432c56(0x199)]){case _0x432c56(0x115):_0x5ec7bd=new Date(_0x39b215[_0x432c56(0x156)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x5ec7bd=new Date(_0x39b215['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x5ec7bd=new Date(_0x39b215[_0x432c56(0x156)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x432c56(0x187):default:_0x5ec7bd=new Date('2020-01-01');break;}}console[_0x432c56(0x191)](_0x432c56(0x153)+_0x5ec7bd[_0x432c56(0x17b)]()+'\x20to\x20'+_0x15dbf2[_0x432c56(0x17b)]());const _0x2b27b1={'status':_0x432c56(0x1b0),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x5ec7bd,'lte':_0x15dbf2}};_0x4d64f3[_0x432c56(0x13c)]&&(_0x2b27b1[_0x432c56(0x13c)]=_0x4d64f3['shopId']);const _0x488a3f=await database_1[_0x432c56(0x1cd)][_0x432c56(0x160)][_0x432c56(0x1f9)]({'where':_0x2b27b1,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x432c56(0x191)](_0x432c56(0x1e1)+_0x488a3f[_0x432c56(0x184)]+_0x432c56(0x10d));const _0x33889d={'gateway':{'not':_0x432c56(0x217)},'createdAt':{'gte':_0x5ec7bd,'lte':_0x15dbf2}};_0x4d64f3[_0x432c56(0x13c)]&&(_0x33889d[_0x432c56(0x13c)]=_0x4d64f3['shopId']);const _0x256cd7=await database_1[_0x432c56(0x1cd)][_0x432c56(0x160)][_0x432c56(0x18c)]({'where':_0x33889d});console[_0x432c56(0x191)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x256cd7+_0x432c56(0x168)+_0x488a3f['length']);let _0xcebe25=0x0,_0xe842a0=0x0,_0x68cccb=0x0;const _0x160267={},_0x538356={},_0xa3b554={};for(const _0x35641b of _0x488a3f){try{const _0x15e3c3=await currencyService_1[_0x432c56(0x1ea)][_0x432c56(0x140)](_0x35641b[_0x432c56(0x1a8)],_0x35641b['currency']);let _0x499cd7={};if(_0x35641b[_0x432c56(0x13f)][_0x432c56(0x215)])try{_0x499cd7=JSON[_0x432c56(0x129)](_0x35641b['shop'][_0x432c56(0x215)]);}catch(_0x4d8f78){console[_0x432c56(0x116)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x35641b[_0x432c56(0x13c)]+':',_0x4d8f78);}let _0x115028={},_0x2a22f6=0xa;for(const [_0xe287f1,_0x66c094]of Object[_0x432c56(0x109)](_0x499cd7)){if(_0xe287f1['toLowerCase']()===_0x35641b['gateway']['toLowerCase']()){_0x115028=_0x66c094,_0x2a22f6=_0x66c094['commission']||0xa;break;}}const _0x1e000e=_0x15e3c3*(_0x2a22f6/0x64),_0x2f0d0e=_0x15e3c3-_0x1e000e;_0xcebe25+=_0x15e3c3,_0xe842a0+=_0x2f0d0e,_0x68cccb+=_0x1e000e;!_0x160267[_0x35641b[_0x432c56(0x194)]]&&(_0x160267[_0x35641b[_0x432c56(0x194)]]={'gateway':_0x35641b[_0x432c56(0x194)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x35641b[_0x432c56(0x194)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x160267[_0x35641b[_0x432c56(0x194)]][_0x432c56(0x1ec)]++,_0x160267[_0x35641b[_0x432c56(0x194)]]['turnoverUSDT']+=_0x15e3c3,_0x160267[_0x35641b['gateway']]['commissionUSDT']+=_0x1e000e,_0x160267[_0x35641b[_0x432c56(0x194)]][_0x432c56(0x11a)]+=_0x2f0d0e,_0x160267[_0x35641b['gateway']][_0x432c56(0x192)]+=_0x2a22f6;!_0x4d64f3[_0x432c56(0x13c)]&&(!_0x538356[_0x35641b[_0x432c56(0x13c)]]&&(_0x538356[_0x35641b[_0x432c56(0x13c)]]={'shopId':_0x35641b[_0x432c56(0x13c)],'shopName':_0x35641b[_0x432c56(0x13f)][_0x432c56(0x14a)],'shopUsername':_0x35641b[_0x432c56(0x13f)][_0x432c56(0x125)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x538356[_0x35641b['shopId']][_0x432c56(0x1ec)]++,_0x538356[_0x35641b[_0x432c56(0x13c)]][_0x432c56(0x148)]+=_0x15e3c3,_0x538356[_0x35641b['shopId']][_0x432c56(0x10b)]+=_0x1e000e,_0x538356[_0x35641b[_0x432c56(0x13c)]]['merchantEarningsUSDT']+=_0x2f0d0e);const _0xcb3b57=_0x35641b[_0x432c56(0x149)]['toISOString']()['split']('T')[0x0];!_0xa3b554[_0xcb3b57]&&(_0xa3b554[_0xcb3b57]={'date':_0xcb3b57,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xa3b554[_0xcb3b57][_0x432c56(0x12d)]+=_0x15e3c3,_0xa3b554[_0xcb3b57]['merchantEarnings']+=_0x2f0d0e,_0xa3b554[_0xcb3b57]['gatewayEarnings']+=_0x1e000e,_0xa3b554[_0xcb3b57][_0x432c56(0x1ec)]++;}catch(_0x2911b7){console[_0x432c56(0x116)]('Error\x20processing\x20payment\x20'+_0x35641b['id']+':',_0x2911b7);}}Object[_0x432c56(0x210)](_0x160267)[_0x432c56(0x176)](_0x338652=>{const _0x27b903=_0x432c56;_0x338652[_0x27b903(0x1f5)]=_0x338652[_0x27b903(0x1ec)]>0x0?_0x338652[_0x27b903(0x192)]/_0x338652[_0x27b903(0x1ec)]:0x0,delete _0x338652[_0x27b903(0x192)];}),Object[_0x432c56(0x210)](_0x538356)[_0x432c56(0x176)](_0x573b9f=>{const _0x5005ef=_0x432c56;_0x573b9f[_0x5005ef(0x1b8)]=_0x573b9f[_0x5005ef(0x1ec)]>0x0?_0x573b9f[_0x5005ef(0x148)]/_0x573b9f['paymentsCount']:0x0;});let _0x4ef22b=0x0;if(_0x4d64f3[_0x432c56(0x13c)]){const _0x5d8d8a=await database_1[_0x432c56(0x1cd)][_0x432c56(0x15d)][_0x432c56(0x1f9)]({'where':{'shopId':_0x4d64f3[_0x432c56(0x13c)],'status':'COMPLETED','createdAt':{'gte':_0x5ec7bd,'lte':_0x15dbf2}},'select':{'amount':!![]}});_0x4ef22b=_0x5d8d8a[_0x432c56(0x12f)]((_0x158fc3,_0x10b692)=>_0x158fc3+_0x10b692['amount'],0x0);}const _0x577a7e=_0x256cd7,_0x3f2450=_0x488a3f[_0x432c56(0x184)],_0x2dd607=_0x3f2450>0x0?_0xcebe25/_0x3f2450:0x0,_0x483734=_0x577a7e>0x0?Math[_0x432c56(0xfe)](_0x3f2450/_0x577a7e*0x2710)/0x64:0x0,_0x582302=Math[_0x432c56(0x20c)]((_0x15dbf2['getTime']()-_0x5ec7bd[_0x432c56(0x156)]())/(0x3e8*0x3c*0x3c*0x18)),_0x16c54a={'totalTurnover':Math[_0x432c56(0xfe)](_0xcebe25*0x64)/0x64,'merchantEarnings':Math[_0x432c56(0xfe)](_0xe842a0*0x64)/0x64,'gatewayEarnings':Math[_0x432c56(0xfe)](_0x68cccb*0x64)/0x64,'totalPaidOut':Math[_0x432c56(0xfe)](_0x4ef22b*0x64)/0x64,'averageCheck':Math[_0x432c56(0xfe)](_0x2dd607*0x64)/0x64,'totalPayments':_0x577a7e,'successfulPayments':_0x3f2450,'conversionRate':_0x483734,'gatewayBreakdown':Object['values'](_0x160267)['map'](_0x16e471=>({..._0x16e471,'turnoverUSDT':Math[_0x432c56(0xfe)](_0x16e471['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x432c56(0xfe)](_0x16e471[_0x432c56(0x10b)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x432c56(0xfe)](_0x16e471[_0x432c56(0x11a)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x16e471[_0x432c56(0x1f5)]*0x64)/0x64})),'merchantBreakdown':_0x4d64f3[_0x432c56(0x13c)]?undefined:Object['values'](_0x538356)['map'](_0x10bad7=>({..._0x10bad7,'turnoverUSDT':Math['round'](_0x10bad7['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x10bad7[_0x432c56(0x10b)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x432c56(0xfe)](_0x10bad7[_0x432c56(0x11a)]*0x64)/0x64,'paidOutUSDT':Math[_0x432c56(0xfe)](_0x10bad7[_0x432c56(0x1db)]*0x64)/0x64,'averageCheckUSDT':Math[_0x432c56(0xfe)](_0x10bad7[_0x432c56(0x1b8)]*0x64)/0x64})),'dailyData':Object[_0x432c56(0x210)](_0xa3b554)[_0x432c56(0x105)](_0x5cbaf1=>({..._0x5cbaf1,'turnover':Math[_0x432c56(0xfe)](_0x5cbaf1['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x432c56(0xfe)](_0x5cbaf1[_0x432c56(0x169)]*0x64)/0x64,'gatewayEarnings':Math[_0x432c56(0xfe)](_0x5cbaf1['gatewayEarnings']*0x64)/0x64}))['sort']((_0x179b40,_0x19aead)=>_0x179b40[_0x432c56(0x132)][_0x432c56(0x1e9)](_0x19aead[_0x432c56(0x132)])),'periodInfo':{'from':_0x5ec7bd,'to':_0x15dbf2,'periodType':_0x4d64f3[_0x432c56(0x199)]||_0x432c56(0x130),'daysCount':_0x582302}};return console[_0x432c56(0x191)](_0x432c56(0x20d)),console['log'](_0x432c56(0x143)+_0x16c54a['totalTurnover']+_0x432c56(0x108)),console['log']('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x16c54a[_0x432c56(0x169)]+_0x432c56(0x108)),console[_0x432c56(0x191)](_0x432c56(0x162)+_0x16c54a['gatewayEarnings']+_0x432c56(0x108)),console['log'](_0x432c56(0x188)+_0x16c54a[_0x432c56(0x15b)]),_0x16c54a;}async[a35_0xbba01f(0x1f7)](){const _0x80c55c=a35_0xbba01f;console[_0x80c55c(0x191)](_0x80c55c(0x103));const _0x377b15=await database_1[_0x80c55c(0x1cd)][_0x80c55c(0x13f)][_0x80c55c(0x1f9)]({'where':{'status':_0x80c55c(0x1cc)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x80c55c(0x195)}});return console[_0x80c55c(0x191)]('📋\x20Found\x20'+_0x377b15['length']+_0x80c55c(0x173)),_0x377b15[_0x80c55c(0x105)](_0x1312f3=>({'id':_0x1312f3['id'],'username':_0x1312f3['username'],'name':_0x1312f3[_0x80c55c(0x14a)]}));}[a35_0xbba01f(0x208)](_0x544d95){const _0x145427=a35_0xbba01f,_0x2edb68={'test_gateway':_0x145427(0x16b),'plisio':_0x145427(0x1e6),'rapyd':_0x145427(0x1c9),'noda':_0x145427(0x205),'cointopay':_0x145427(0x193),'klyme_eu':_0x145427(0x127),'klyme_gb':_0x145427(0x1c7),'klyme_de':_0x145427(0x177)};return _0x2edb68[_0x544d95]||_0x544d95;}async[a35_0xbba01f(0x121)](_0x88a985){const _0x3357a9=a35_0xbba01f,{page:_0x5389d1,limit:_0xf9e4e7,minAmount:_0x463343,search:_0x419966}=_0x88a985,_0x29b6b6=(_0x5389d1-0x1)*_0xf9e4e7;console[_0x3357a9(0x191)](_0x3357a9(0xff),_0x88a985);const _0x544e52={'balance':{'gt':0x0},'status':_0x3357a9(0x1cc)};_0x463343&&(_0x544e52[_0x3357a9(0x15f)][_0x3357a9(0x214)]=_0x463343);_0x419966&&(_0x544e52['OR']=[{'name':{'contains':_0x419966,'mode':_0x3357a9(0x1a2)}},{'username':{'contains':_0x419966,'mode':_0x3357a9(0x1a2)}}]);const [_0x21e0c5,_0x263e36]=await Promise['all']([database_1['default']['shop'][_0x3357a9(0x1f9)]({'where':_0x544e52,'skip':_0x29b6b6,'take':_0xf9e4e7,'orderBy':{'balance':_0x3357a9(0x114)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x3357a9(0x1cd)][_0x3357a9(0x13f)][_0x3357a9(0x18c)]({'where':_0x544e52})]);console['log'](_0x3357a9(0x1e1)+_0x21e0c5[_0x3357a9(0x184)]+_0x3357a9(0x1b2));const _0x428e4f=await Promise[_0x3357a9(0x187)](_0x21e0c5['map'](async _0x3e3cc2=>{const _0x245128=_0x3357a9,[_0x5dea3a,_0x5d6920,_0x4dd88e]=await Promise[_0x245128(0x187)]([database_1[_0x245128(0x1cd)][_0x245128(0x160)][_0x245128(0x18c)]({'where':{'shopId':_0x3e3cc2['id'],'status':_0x245128(0x1b0),'gateway':{'not':_0x245128(0x217)}}}),database_1['default'][_0x245128(0x160)][_0x245128(0x102)]({'where':{'shopId':_0x3e3cc2['id'],'status':'PAID','gateway':{'not':_0x245128(0x217)}},'orderBy':{'paidAt':_0x245128(0x195)},'select':{'paidAt':!![]}}),database_1[_0x245128(0x1cd)]['payment'][_0x245128(0x1ca)]({'by':[_0x245128(0x194)],'where':{'shopId':_0x3e3cc2['id'],'status':_0x245128(0x1b0),'gateway':{'not':_0x245128(0x217)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2ffb82=new Date(),_0x700aef=new Date(_0x2ffb82[_0x245128(0x131)](),_0x2ffb82['getMonth'](),0x1),_0x2dc0f2=new Date(_0x2ffb82[_0x245128(0x131)](),_0x2ffb82[_0x245128(0xfa)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x115f22,_0x147df1]=await Promise[_0x245128(0x187)]([database_1[_0x245128(0x1cd)][_0x245128(0x15d)][_0x245128(0x113)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3e3cc2['id'],'status':_0x245128(0x10a)}}),database_1['default'][_0x245128(0x15d)][_0x245128(0x113)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3e3cc2['id'],'status':_0x245128(0x10a),'createdAt':{'gte':_0x700aef,'lte':_0x2dc0f2}}})]),_0x40effc=_0x115f22['_sum']['amount']||0x0,_0x4d418d=_0x147df1['_sum'][_0x245128(0x1a8)]||0x0,_0x4ee1e9=await Promise[_0x245128(0x187)](_0x4dd88e[_0x245128(0x105)](async _0xb7216e=>{const _0x1fb1e6=_0x245128;let _0x408ba7=0xa;if(_0x3e3cc2[_0x1fb1e6(0x215)])try{const _0x23a44e=JSON[_0x1fb1e6(0x129)](_0x3e3cc2[_0x1fb1e6(0x215)]);for(const [_0x2f8e45,_0x362059]of Object[_0x1fb1e6(0x109)](_0x23a44e)){if(_0x2f8e45[_0x1fb1e6(0x17c)]()===_0xb7216e[_0x1fb1e6(0x194)]['toLowerCase']()){_0x408ba7=_0x362059['commission']||0xa,console[_0x1fb1e6(0x191)](_0x1fb1e6(0x1e5)+_0xb7216e[_0x1fb1e6(0x194)]+'\x20for\x20shop\x20'+_0x3e3cc2['id']+_0x1fb1e6(0x104)+_0x408ba7+'%');break;}}}catch(_0x3de2f4){console[_0x1fb1e6(0x116)](_0x1fb1e6(0x150)+_0x3e3cc2['id']+':',_0x3de2f4);}const _0x196571=_0xb7216e[_0x1fb1e6(0x1c6)][_0x1fb1e6(0x18f)]||0x0,_0x3eb562=_0x196571*(0x1-_0x408ba7/0x64);return{'gateway':_0xb7216e[_0x1fb1e6(0x194)],'count':_0xb7216e[_0x1fb1e6(0x196)]['id'],'amountUSDT':Math[_0x1fb1e6(0xfe)](_0x196571*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x1fb1e6(0xfe)](_0x3eb562*0x64)/0x64,'commission':_0x408ba7};})),_0x399fba=_0x4ee1e9[_0x245128(0x12f)]((_0x31991d,_0x2544de)=>_0x31991d+_0x2544de[_0x245128(0x18f)],0x0),_0x1c60b2=_0x3e3cc2[_0x245128(0x15f)];return console['log'](_0x245128(0x179)+_0x3e3cc2[_0x245128(0x125)]+':'),console[_0x245128(0x191)](_0x245128(0x20a)+_0x399fba[_0x245128(0x17e)](0x2)+_0x245128(0x1da)),console[_0x245128(0x191)](_0x245128(0x1d9)+_0x4ee1e9[_0x245128(0x12f)]((_0x9d5657,_0x1e2cd6)=>_0x9d5657+_0x1e2cd6[_0x245128(0x11f)],0x0)[_0x245128(0x17e)](0x2)+_0x245128(0x181)),console[_0x245128(0x191)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x1c60b2[_0x245128(0x17e)](0x2)+_0x245128(0x1be)),{'id':_0x3e3cc2['id'],'fullName':_0x3e3cc2[_0x245128(0x14a)],'username':_0x3e3cc2['username'],'telegramId':_0x3e3cc2['telegram'],'merchantUrl':_0x3e3cc2[_0x245128(0x152)],'wallets':{'usdtPolygonWallet':_0x3e3cc2[_0x245128(0x1b6)],'usdtTrcWallet':_0x3e3cc2[_0x245128(0x1cb)],'usdtErcWallet':_0x3e3cc2[_0x245128(0x136)],'usdcPolygonWallet':_0x3e3cc2[_0x245128(0x1d5)]},'totalAmountUSDT':Math[_0x245128(0xfe)](_0x399fba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x245128(0xfe)](_0x1c60b2*0x64)/0x64,'totalPayout':Math[_0x245128(0xfe)](_0x40effc*0x64)/0x64,'thisMonth':Math[_0x245128(0xfe)](_0x4d418d*0x64)/0x64,'paymentsCount':_0x5dea3a,'oldestPaymentDate':_0x5d6920?.[_0x245128(0x149)]||_0x3e3cc2['createdAt'],'gatewayBreakdown':_0x4ee1e9};})),_0x21a1c1=_0x428e4f[_0x3357a9(0x12f)]((_0x1435fc,_0x2e6ef8)=>_0x1435fc+_0x2e6ef8['totalAmountUSDT'],0x0),_0x568f54=_0x428e4f[_0x3357a9(0x12f)]((_0x2a4aed,_0x4eaeac)=>_0x2a4aed+_0x4eaeac[_0x3357a9(0x1ba)],0x0),_0x5ca84e=_0x428e4f['reduce']((_0x393fb0,_0x5fd1b)=>_0x393fb0+_0x5fd1b[_0x3357a9(0x197)],0x0),_0x49a7ef=_0x428e4f[_0x3357a9(0x12f)]((_0x1d425e,_0x23bc32)=>_0x1d425e+_0x23bc32[_0x3357a9(0x1f4)],0x0);return console[_0x3357a9(0x191)](_0x3357a9(0x1dd)+_0x263e36+_0x3357a9(0x161)),console[_0x3357a9(0x191)](_0x3357a9(0x12e)+Math['round'](_0x21a1c1*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x3357a9(0x191)]('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math['round'](_0x568f54*0x64)/0x64+_0x3357a9(0x1c1)),console[_0x3357a9(0x191)](_0x3357a9(0x151)+Math[_0x3357a9(0xfe)](_0x5ca84e*0x64)/0x64+_0x3357a9(0x108)),console['log'](_0x3357a9(0x1f0)+Math[_0x3357a9(0xfe)](_0x49a7ef*0x64)/0x64+_0x3357a9(0x108)),{'merchants':_0x428e4f,'pagination':{'page':_0x5389d1,'limit':_0xf9e4e7,'total':_0x263e36,'totalPages':Math['ceil'](_0x263e36/_0xf9e4e7)},'summary':{'totalMerchants':_0x263e36,'totalAmountUSDT':Math[_0x3357a9(0xfe)](_0x21a1c1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x568f54*0x64)/0x64,'totalPayout':Math[_0x3357a9(0xfe)](_0x5ca84e*0x64)/0x64,'thisMonth':Math[_0x3357a9(0xfe)](_0x49a7ef*0x64)/0x64}};}async[a35_0xbba01f(0x18e)](_0x5851f5){const _0x228701=a35_0xbba01f,{shopId:_0x31f4d9,amount:_0x55e6e2,network:_0x5db09c,wallet:_0x31a053,notes:_0x50dcd,txid:_0x1bcf1b,periodFrom:_0x4ae84a,periodTo:_0x2f5e57}=_0x5851f5,_0x4d553c=await database_1['default'][_0x228701(0x14e)](async _0x1a11ed=>{const _0xd3e695=_0x228701,_0x372ca4=await _0x1a11ed[_0xd3e695(0x13f)][_0xd3e695(0x10f)]({'where':{'id':_0x31f4d9},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x372ca4)throw new Error('Shop\x20not\x20found');console[_0xd3e695(0x191)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x372ca4[_0xd3e695(0x125)]+':'),console[_0xd3e695(0x191)]('\x20\x20\x20Current\x20balance:\x20'+_0x372ca4['balance']['toFixed'](0x6)+_0xd3e695(0x108)),console[_0xd3e695(0x191)](_0xd3e695(0x1a0)+_0x55e6e2[_0xd3e695(0x17e)](0x6)+_0xd3e695(0x108)),console['log'](_0xd3e695(0x14f)+_0x372ca4['totalPaidOut'][_0xd3e695(0x17e)](0x6)+'\x20USDT');if(_0x1bcf1b)console[_0xd3e695(0x191)](_0xd3e695(0x138)+_0x1bcf1b);if(_0x372ca4[_0xd3e695(0x15f)]<_0x55e6e2)throw new Error(_0xd3e695(0x164)+_0x372ca4[_0xd3e695(0x15f)][_0xd3e695(0x17e)](0x6)+_0xd3e695(0x178)+_0x55e6e2[_0xd3e695(0x17e)](0x6)+_0xd3e695(0x108));let _0x40e466=_0x31a053;if(!_0x40e466){const _0x1bbb30=await _0x1a11ed[_0xd3e695(0x13f)][_0xd3e695(0x10f)]({'where':{'id':_0x31f4d9},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x1bbb30)switch(_0x5db09c){case _0xd3e695(0x1c0):_0x40e466=_0x1bbb30[_0xd3e695(0x1b6)]||undefined;break;case _0xd3e695(0x15c):_0x40e466=_0x1bbb30['usdtTrcWallet']||undefined;break;case _0xd3e695(0x211):_0x40e466=_0x1bbb30[_0xd3e695(0x136)]||undefined;break;case _0xd3e695(0x10c):_0x40e466=_0x1bbb30[_0xd3e695(0x1d5)]||undefined;break;}}console[_0xd3e695(0x191)](_0xd3e695(0x1f1)+_0x5db09c+':\x20'+(_0x40e466||_0xd3e695(0x1a7)));const _0x9f776f=await _0x1a11ed[_0xd3e695(0x15d)]['create']({'data':{'shopId':_0x31f4d9,'amount':_0x55e6e2,'network':_0x5db09c,'status':_0xd3e695(0x10a),'txid':_0x1bcf1b,'notes':_0x50dcd,'periodFrom':_0x4ae84a?new Date(_0x4ae84a):null,'periodTo':_0x2f5e57?new Date(_0x2f5e57):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x40adbb=_0x372ca4[_0xd3e695(0x15f)]-_0x55e6e2,_0x3dd0e1=_0x372ca4[_0xd3e695(0x1fa)]+_0x55e6e2;return await _0x1a11ed['shop'][_0xd3e695(0x124)]({'where':{'id':_0x31f4d9},'data':{'balance':_0x40adbb,'totalPaidOut':_0x3dd0e1}}),console['log'](_0xd3e695(0x171)+_0x372ca4[_0xd3e695(0x125)]+_0xd3e695(0x158)),console[_0xd3e695(0x191)](_0xd3e695(0x17d)+_0x372ca4[_0xd3e695(0x15f)][_0xd3e695(0x17e)](0x6)+_0xd3e695(0x141)+_0x40adbb['toFixed'](0x6)+_0xd3e695(0x189)+_0x55e6e2[_0xd3e695(0x17e)](0x6)+')'),console['log'](_0xd3e695(0x1d1)+_0x372ca4[_0xd3e695(0x1fa)][_0xd3e695(0x17e)](0x6)+_0xd3e695(0x141)+_0x3dd0e1[_0xd3e695(0x17e)](0x6)+_0xd3e695(0x1c4)+_0x55e6e2[_0xd3e695(0x17e)](0x6)+')'),{'payout':_0x9f776f,'shop':_0x372ca4};});return console[_0x228701(0x191)](_0x228701(0x203)+_0x4d553c[_0x228701(0x15d)]['id']+_0x228701(0x1e4)+_0x4d553c[_0x228701(0x13f)]['username']+'\x20('+_0x55e6e2+_0x228701(0x167)),{'id':_0x4d553c['payout']['id'],'shopId':_0x4d553c[_0x228701(0x15d)][_0x228701(0x13c)],'shopName':_0x4d553c['shop'][_0x228701(0x14a)],'shopUsername':_0x4d553c[_0x228701(0x13f)][_0x228701(0x125)],'amount':_0x4d553c[_0x228701(0x15d)]['amount'],'network':_0x4d553c[_0x228701(0x15d)][_0x228701(0x13e)],'status':_0x4d553c[_0x228701(0x15d)]['status'],'txid':_0x4d553c[_0x228701(0x15d)][_0x228701(0x11b)],'notes':_0x4d553c[_0x228701(0x15d)][_0x228701(0x1fb)],'periodFrom':_0x4d553c[_0x228701(0x15d)][_0x228701(0x1b5)],'periodTo':_0x4d553c[_0x228701(0x15d)][_0x228701(0x216)],'createdAt':_0x4d553c[_0x228701(0x15d)][_0x228701(0x15a)],'paidAt':_0x4d553c[_0x228701(0x15d)][_0x228701(0x149)]};}async[a35_0xbba01f(0xf9)](_0x5c8be7){const _0x205fe4=a35_0xbba01f,{page:_0x5dfdfd,limit:_0x4c5b5f,shopId:_0x2a64bc,network:_0x27689e,dateFrom:_0x37297f,dateTo:_0x1db2f6,search:_0x5f4d6b}=_0x5c8be7,_0x978bfb=(_0x5dfdfd-0x1)*_0x4c5b5f,_0x1487f4={};_0x2a64bc&&(_0x1487f4[_0x205fe4(0x13c)]=_0x2a64bc);_0x27689e&&(_0x1487f4[_0x205fe4(0x13e)]=_0x27689e);(_0x37297f||_0x1db2f6)&&(_0x1487f4[_0x205fe4(0x15a)]={},_0x37297f&&(_0x1487f4[_0x205fe4(0x15a)][_0x205fe4(0x214)]=new Date(_0x37297f)),_0x1db2f6&&(_0x1487f4[_0x205fe4(0x15a)][_0x205fe4(0x14b)]=new Date(_0x1db2f6)));_0x5f4d6b&&(_0x1487f4['OR']=[{'shop':{'name':{'contains':_0x5f4d6b,'mode':_0x205fe4(0x1a2)}}},{'shop':{'username':{'contains':_0x5f4d6b,'mode':'insensitive'}}},{'notes':{'contains':_0x5f4d6b,'mode':_0x205fe4(0x1a2)}}]);const [_0x4f1cbf,_0x39de32]=await Promise[_0x205fe4(0x187)]([database_1[_0x205fe4(0x1cd)][_0x205fe4(0x15d)][_0x205fe4(0x1f9)]({'where':_0x1487f4,'skip':_0x978bfb,'take':_0x4c5b5f,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x205fe4(0x1cd)][_0x205fe4(0x15d)]['count']({'where':_0x1487f4})]);return{'payouts':_0x4f1cbf[_0x205fe4(0x105)](_0x269f52=>({'id':_0x269f52['id'],'shopId':_0x269f52[_0x205fe4(0x13c)],'shopName':_0x269f52['shop'][_0x205fe4(0x14a)],'shopUsername':_0x269f52['shop'][_0x205fe4(0x125)],'amount':_0x269f52[_0x205fe4(0x1a8)],'network':_0x269f52[_0x205fe4(0x13e)],'status':_0x269f52[_0x205fe4(0x183)],'txid':_0x269f52[_0x205fe4(0x11b)],'notes':_0x269f52[_0x205fe4(0x1fb)],'periodFrom':_0x269f52['periodFrom'],'periodTo':_0x269f52['periodTo'],'createdAt':_0x269f52[_0x205fe4(0x15a)],'paidAt':_0x269f52[_0x205fe4(0x149)]})),'pagination':{'page':_0x5dfdfd,'limit':_0x4c5b5f,'total':_0x39de32,'totalPages':Math['ceil'](_0x39de32/_0x4c5b5f)}};}async[a35_0xbba01f(0x1c8)](_0x3dc31b){const _0x13dc04=a35_0xbba01f,_0x226791=await database_1[_0x13dc04(0x1cd)][_0x13dc04(0x15d)]['findUnique']({'where':{'id':_0x3dc31b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x226791)return null;return{'id':_0x226791['id'],'shopId':_0x226791['shopId'],'shopName':_0x226791[_0x13dc04(0x13f)][_0x13dc04(0x14a)],'shopUsername':_0x226791[_0x13dc04(0x13f)][_0x13dc04(0x125)],'amount':_0x226791['amount'],'network':_0x226791[_0x13dc04(0x13e)],'status':_0x226791[_0x13dc04(0x183)],'txid':_0x226791[_0x13dc04(0x11b)],'notes':_0x226791['notes'],'periodFrom':_0x226791['periodFrom'],'periodTo':_0x226791[_0x13dc04(0x216)],'createdAt':_0x226791[_0x13dc04(0x15a)],'paidAt':_0x226791[_0x13dc04(0x149)]};}async['deletePayout'](_0xae32e9){const _0x2173e9=a35_0xbba01f;await database_1['default']['payout'][_0x2173e9(0x175)]({'where':{'id':_0xae32e9}});}async[a35_0xbba01f(0x120)](_0x41f50c){const _0xf38c2d=a35_0xbba01f,{page:_0x25a011,limit:_0x481d57,status:_0x2a6905,gateway:_0xc80edb,shopId:_0x5e0dfc,dateFrom:_0x58cf97,dateTo:_0x21ec3a,search:_0x3bdd6f,currency:_0x34783f,sortBy:_0x38c601,sortOrder:_0x26c015}=_0x41f50c,_0x56f349=(_0x25a011-0x1)*_0x481d57;console['log'](_0xf38c2d(0x190),_0x41f50c);const _0x48096c=await database_1[_0xf38c2d(0x1cd)]['payment'][_0xf38c2d(0x1ca)]({'by':[_0xf38c2d(0x194)],'_count':{'gateway':!![]}});console['log'](_0xf38c2d(0x166),_0x48096c['map'](_0x3c0ded=>_0x3c0ded[_0xf38c2d(0x194)]+'\x20('+_0x3c0ded[_0xf38c2d(0x196)][_0xf38c2d(0x194)]+'\x20payments)'));if(_0xc80edb){const _0x1a423f=_0x48096c[_0xf38c2d(0x1bb)](_0x25d1d1=>_0x25d1d1[_0xf38c2d(0x194)]['toLowerCase']()===_0xc80edb[_0xf38c2d(0x17c)]());!_0x1a423f&&_0xc80edb[_0xf38c2d(0x17c)]()!==_0xf38c2d(0x217)&&console[_0xf38c2d(0x191)](_0xf38c2d(0x172)+_0xc80edb+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x48096c['map'](_0x2f0dc9=>_0x2f0dc9[_0xf38c2d(0x194)])[_0xf38c2d(0x1a4)](',\x20'));}const _0x564fa0={};_0x2a6905&&(_0x564fa0[_0xf38c2d(0x183)]=_0x2a6905[_0xf38c2d(0x159)]());if(!_0xc80edb)_0x564fa0[_0xf38c2d(0x194)]={'not':_0xf38c2d(0x217)};else{if(_0xc80edb&&(_0xc80edb['toLowerCase']()==='test_gateway'||_0xc80edb==='0000'))_0x564fa0[_0xf38c2d(0x194)]=_0xf38c2d(0x217);else{let _0x48694d=_0xc80edb;const _0x17557d=(0x0,gateway_1['getGatewayNameById'])(_0xc80edb);if(_0x17557d)_0x48694d=_0x17557d,console[_0xf38c2d(0x191)](_0xf38c2d(0x155)+_0xc80edb+_0xf38c2d(0x1aa)+_0x48694d+'\x27');else{const _0x5041d3=(0x0,gateway_1[_0xf38c2d(0x1eb)])(_0xc80edb);if(_0x5041d3){const _0x31e29e=(0x0,gateway_1[_0xf38c2d(0x1d8)])(_0x5041d3);_0x31e29e&&(_0x48694d=_0x31e29e,console[_0xf38c2d(0x191)](_0xf38c2d(0x1af)+_0xc80edb+_0xf38c2d(0x206)+_0x5041d3+'\x27\x20->\x20name\x20\x27'+_0x48694d+'\x27'));}else console[_0xf38c2d(0x191)](_0xf38c2d(0x1b9)+_0xc80edb+_0xf38c2d(0x12c));}const _0x2997f6=await database_1['default'][_0xf38c2d(0x160)][_0xf38c2d(0x18c)]({'where':{'gateway':_0x48694d[_0xf38c2d(0x17c)]()},'take':0x1});_0x2997f6===0x0?(console['log'](_0xf38c2d(0x16a)+_0x48694d+_0xf38c2d(0x1b7)+_0xc80edb+_0xf38c2d(0x1f8)),_0x564fa0[_0xf38c2d(0x194)]=_0xf38c2d(0x1d0)):(_0x564fa0[_0xf38c2d(0x194)]=_0x48694d[_0xf38c2d(0x17c)](),console[_0xf38c2d(0x191)](_0xf38c2d(0x1ac)+_0x48694d+_0xf38c2d(0x1b7)+_0xc80edb+'\x27)'));}}console[_0xf38c2d(0x191)](_0xf38c2d(0x207),_0x564fa0['gateway']);_0x5e0dfc&&(_0x564fa0[_0xf38c2d(0x13c)]=_0x5e0dfc);_0x34783f&&(_0x564fa0[_0xf38c2d(0x180)]=_0x34783f[_0xf38c2d(0x159)](),console[_0xf38c2d(0x191)](_0xf38c2d(0x123)+_0x34783f[_0xf38c2d(0x159)]()));(_0x58cf97||_0x21ec3a)&&(_0x564fa0[_0xf38c2d(0x15a)]={},_0x58cf97&&(_0x564fa0[_0xf38c2d(0x15a)][_0xf38c2d(0x214)]=new Date(_0x58cf97)),_0x21ec3a&&(_0x564fa0[_0xf38c2d(0x15a)][_0xf38c2d(0x14b)]=new Date(_0x21ec3a)));_0x3bdd6f&&(_0x564fa0['OR']=[{'id':{'contains':_0x3bdd6f,'mode':_0xf38c2d(0x1a2)}},{'orderId':{'contains':_0x3bdd6f,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x3bdd6f,'mode':_0xf38c2d(0x1a2)}},{'customerEmail':{'contains':_0x3bdd6f,'mode':_0xf38c2d(0x1a2)}},{'shop':{'name':{'contains':_0x3bdd6f,'mode':_0xf38c2d(0x1a2)}}},{'shop':{'username':{'contains':_0x3bdd6f,'mode':_0xf38c2d(0x1a2)}}}]);console[_0xf38c2d(0x191)]('📊\x20Final\x20WHERE\x20conditions:',JSON[_0xf38c2d(0x21a)](_0x564fa0,null,0x2));let _0x2e1f93={'createdAt':_0xf38c2d(0x114)};if(_0x38c601){const _0x4057c5=[_0xf38c2d(0x1a8),_0xf38c2d(0x15a),_0xf38c2d(0x20e),'status',_0xf38c2d(0x194),_0xf38c2d(0x180)],_0xfd657c=[_0xf38c2d(0x195),'desc'];if(_0x4057c5[_0xf38c2d(0x1ed)](_0x38c601)){const _0x26a2dc=_0xfd657c[_0xf38c2d(0x1ed)](_0x26c015)?_0x26c015:_0xf38c2d(0x114);_0x2e1f93={[_0x38c601]:_0x26a2dc},console[_0xf38c2d(0x191)](_0xf38c2d(0x1ad)+_0x38c601+_0xf38c2d(0x144)+_0x26a2dc+_0xf38c2d(0x137));}}const [_0x542316,_0x6d4e84]=await Promise[_0xf38c2d(0x187)]([database_1['default'][_0xf38c2d(0x160)][_0xf38c2d(0x1f9)]({'where':_0x564fa0,'skip':_0x56f349,'take':_0x481d57,'orderBy':_0x2e1f93,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xf38c2d(0x1cd)][_0xf38c2d(0x160)][_0xf38c2d(0x18c)]({'where':_0x564fa0})]);return{'payments':_0x542316,'pagination':{'page':_0x25a011,'limit':_0x481d57,'total':_0x6d4e84,'totalPages':Math['ceil'](_0x6d4e84/_0x481d57)}};}async[a35_0xbba01f(0x1e2)](_0x3fdd5d){const _0x1cb067=a35_0xbba01f,_0x40a714=await database_1[_0x1cb067(0x1cd)][_0x1cb067(0x160)][_0x1cb067(0x10f)]({'where':{'id':_0x3fdd5d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x40a714)return null;return{'id':_0x40a714['id'],'shopId':_0x40a714[_0x1cb067(0x13c)],'gateway':_0x40a714[_0x1cb067(0x194)],'amount':_0x40a714[_0x1cb067(0x1a8)],'currency':_0x40a714['currency'],'status':_0x40a714[_0x1cb067(0x183)],'orderId':_0x40a714['orderId'],'gatewayOrderId':_0x40a714[_0x1cb067(0xfd)],'customerEmail':_0x40a714[_0x1cb067(0x147)],'customerName':_0x40a714[_0x1cb067(0x142)],'customerCountry':_0x40a714[_0x1cb067(0x101)],'customerIp':_0x40a714[_0x1cb067(0x117)],'customerUa':_0x40a714[_0x1cb067(0x16c)],'failureMessage':_0x40a714[_0x1cb067(0x1f6)],'externalPaymentUrl':_0x40a714[_0x1cb067(0x16f)],'successUrl':_0x40a714[_0x1cb067(0x112)],'failUrl':_0x40a714[_0x1cb067(0x204)],'pendingUrl':_0x40a714[_0x1cb067(0x154)],'whiteUrl':_0x40a714[_0x1cb067(0x1b1)],'createdAt':_0x40a714[_0x1cb067(0x15a)],'updatedAt':_0x40a714[_0x1cb067(0x20e)],'shop':_0x40a714['shop']};}async['updatePaymentStatus'](_0x209eec,_0x2cdf32,_0x56bf24,_0x47f93a){const _0x520116=a35_0xbba01f,_0x1624c9=await database_1[_0x520116(0x1cd)][_0x520116(0x14e)](async _0x544103=>{const _0x597af9=_0x520116,_0x73f242=await _0x544103['payment'][_0x597af9(0x10f)]({'where':{'id':_0x209eec},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x73f242)throw new Error('Payment\x20not\x20found');const _0x2d758f=_0x73f242['status'],_0x1e101e=_0x2cdf32[_0x597af9(0x159)]();console[_0x597af9(0x191)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x209eec+_0x597af9(0x145)+_0x2d758f+_0x597af9(0x141)+_0x1e101e),console[_0x597af9(0x191)](_0x597af9(0x126)+_0x73f242[_0x597af9(0x13f)][_0x597af9(0x15f)]+_0x597af9(0x108));const _0x5a9bef={'status':_0x1e101e,'updatedAt':new Date(),'statusChangedBy':_0x597af9(0x18d),'statusChangedAt':new Date()};_0x56bf24&&(_0x5a9bef[_0x597af9(0x100)]=_0x56bf24);_0x1e101e===_0x597af9(0x134)&&_0x47f93a&&(_0x5a9bef[_0x597af9(0x1fd)]=_0x47f93a);let _0xa1b3a7=0x0,_0x383f73=_0x73f242[_0x597af9(0x13f)][_0x597af9(0x15f)];if(_0x1e101e===_0x597af9(0x1b0)&&_0x2d758f!=='PAID'){_0x5a9bef[_0x597af9(0x149)]=new Date();const _0x26ff16=await currencyService_1[_0x597af9(0x1ea)][_0x597af9(0x140)](_0x73f242['amount'],_0x73f242[_0x597af9(0x180)]);_0x5a9bef[_0x597af9(0x18f)]=_0x26ff16;let _0xe5a7da=0xa;const _0x311e14=await _0x544103[_0x597af9(0x13f)]['findUnique']({'where':{'id':_0x73f242[_0x597af9(0x13c)]},'select':{'gatewaySettings':!![]}});if(_0x311e14?.['gatewaySettings'])try{const _0xb08f30=JSON[_0x597af9(0x129)](_0x311e14[_0x597af9(0x215)]);for(const [_0x3488e4,_0x1af9b1]of Object[_0x597af9(0x109)](_0xb08f30)){if(_0x3488e4['toLowerCase']()===_0x73f242[_0x597af9(0x194)][_0x597af9(0x17c)]()){_0xe5a7da=_0x1af9b1['commission']||0xa;break;}}}catch(_0x36ec2a){console[_0x597af9(0x116)](_0x597af9(0x1f3)+_0x209eec+':',_0x36ec2a);}const _0x4ce77b=_0x26ff16*(0x1-_0xe5a7da/0x64);_0xa1b3a7=_0x4ce77b,_0x383f73+=_0x4ce77b,console[_0x597af9(0x191)](_0x597af9(0x128)+_0x209eec+_0x597af9(0x200)),console['log'](_0x597af9(0x13d)+_0x26ff16[_0x597af9(0x17e)](0x6)+_0x597af9(0x108)),console['log']('\x20\x20\x20Gateway:\x20'+_0x73f242['gateway']+_0x597af9(0x1f2)+_0xe5a7da+'%'),console[_0x597af9(0x191)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x4ce77b['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0xe5a7da+_0x597af9(0x1a5)),console[_0x597af9(0x191)](_0x597af9(0x21b)+_0x4ce77b[_0x597af9(0x17e)](0x6)+'\x20USDT');}else{if(_0x2d758f===_0x597af9(0x1b0)&&_0x1e101e!==_0x597af9(0x1b0)){if(_0x73f242[_0x597af9(0x18f)]){let _0x45a5be=0xa;const _0x84a574=await _0x544103[_0x597af9(0x13f)][_0x597af9(0x10f)]({'where':{'id':_0x73f242['shopId']},'select':{'gatewaySettings':!![]}});if(_0x84a574?.[_0x597af9(0x215)])try{const _0x5c8bab=JSON[_0x597af9(0x129)](_0x84a574[_0x597af9(0x215)]);for(const [_0x1eda69,_0x16aa0c]of Object[_0x597af9(0x109)](_0x5c8bab)){if(_0x1eda69[_0x597af9(0x17c)]()===_0x73f242['gateway'][_0x597af9(0x17c)]()){_0x45a5be=_0x16aa0c[_0x597af9(0x17f)]||0xa;break;}}}catch(_0xc013f8){console[_0x597af9(0x116)](_0x597af9(0x1f3)+_0x209eec+':',_0xc013f8);}const _0x26635b=_0x73f242[_0x597af9(0x18f)]*(0x1-_0x45a5be/0x64);_0xa1b3a7=-_0x26635b,_0x383f73-=_0x26635b,_0x5a9bef['amountUSDT']=null,console[_0x597af9(0x191)](_0x597af9(0x128)+_0x209eec+'\x20no\x20longer\x20PAID:'),console[_0x597af9(0x191)](_0x597af9(0x13d)+_0x73f242[_0x597af9(0x18f)][_0x597af9(0x17e)](0x6)+_0x597af9(0x108)),console[_0x597af9(0x191)](_0x597af9(0x13a)+_0x73f242['gateway']+',\x20Commission:\x20'+_0x45a5be+'%'),console[_0x597af9(0x191)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x26635b[_0x597af9(0x17e)](0x6)+_0x597af9(0x1c5)+_0x45a5be+_0x597af9(0x1a5)),console[_0x597af9(0x191)](_0x597af9(0x1e0)+_0x26635b[_0x597af9(0x17e)](0x6)+_0x597af9(0x108));}}}_0x1e101e===_0x597af9(0x134)&&(_0x2d758f===_0x597af9(0x1b0)&&_0x73f242[_0x597af9(0x18f)]&&console[_0x597af9(0x191)](_0x597af9(0x17a)),_0x47f93a&&_0x47f93a>0x0&&(_0xa1b3a7-=_0x47f93a,_0x383f73-=_0x47f93a,console[_0x597af9(0x191)](_0x597af9(0x13b)+_0x47f93a['toFixed'](0x6)+_0x597af9(0x133))));_0x1e101e===_0x597af9(0x202)&&_0x2d758f===_0x597af9(0x1b0)&&console[_0x597af9(0x191)](_0x597af9(0x218));const _0x4abbbe=await _0x544103[_0x597af9(0x160)][_0x597af9(0x124)]({'where':{'id':_0x209eec},'data':_0x5a9bef,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xa1b3a7!==0x0&&(await _0x544103[_0x597af9(0x13f)][_0x597af9(0x124)]({'where':{'id':_0x73f242['shopId']},'data':{'balance':_0x383f73}}),console[_0x597af9(0x191)](_0x597af9(0x171)+_0x73f242[_0x597af9(0x13c)]+_0x597af9(0x1cf)+_0x73f242['shop']['balance'][_0x597af9(0x17e)](0x6)+_0x597af9(0x141)+_0x383f73[_0x597af9(0x17e)](0x6)+'\x20USDT\x20('+(_0xa1b3a7>0x0?'+':'')+_0xa1b3a7['toFixed'](0x6)+')')),_0x4abbbe;});return{'id':_0x1624c9['id'],'shopId':_0x1624c9[_0x520116(0x13c)],'gateway':_0x1624c9[_0x520116(0x194)],'amount':_0x1624c9['amount'],'currency':_0x1624c9[_0x520116(0x180)],'status':_0x1624c9[_0x520116(0x183)],'orderId':_0x1624c9[_0x520116(0x212)],'gatewayOrderId':_0x1624c9[_0x520116(0xfd)],'customerEmail':_0x1624c9[_0x520116(0x147)],'customerName':_0x1624c9[_0x520116(0x142)],'customerCountry':_0x1624c9[_0x520116(0x101)],'customerIp':_0x1624c9[_0x520116(0x117)],'customerUa':_0x1624c9[_0x520116(0x16c)],'failureMessage':_0x1624c9[_0x520116(0x1f6)],'adminNotes':_0x1624c9[_0x520116(0x100)],'chargebackAmount':_0x1624c9[_0x520116(0x1fd)],'statusChangedBy':_0x1624c9['statusChangedBy'],'statusChangedAt':_0x1624c9[_0x520116(0x1bc)],'createdAt':_0x1624c9[_0x520116(0x15a)],'updatedAt':_0x1624c9[_0x520116(0x20e)],'shop':_0x1624c9[_0x520116(0x13f)]};}async[a35_0xbba01f(0xfc)](_0x5ee368,_0x5ee6b6){const _0x4f6bb1=a35_0xbba01f,_0x229678={..._0x5ee6b6};_0x5ee6b6[_0x4f6bb1(0x219)]&&(_0x229678[_0x4f6bb1(0x219)]=await bcryptjs_1['default'][_0x4f6bb1(0x185)](_0x5ee6b6[_0x4f6bb1(0x219)],0xc));_0x5ee6b6['fullName']&&(_0x229678[_0x4f6bb1(0x14a)]=_0x5ee6b6['fullName'],delete _0x229678[_0x4f6bb1(0x198)]);_0x5ee6b6[_0x4f6bb1(0x1ff)]&&(_0x229678[_0x4f6bb1(0x1d7)]=_0x5ee6b6[_0x4f6bb1(0x1ff)],delete _0x229678[_0x4f6bb1(0x1ff)]);_0x5ee6b6[_0x4f6bb1(0x18b)]&&(_0x229678[_0x4f6bb1(0x152)]=_0x5ee6b6[_0x4f6bb1(0x18b)],delete _0x229678[_0x4f6bb1(0x18b)]);_0x5ee6b6[_0x4f6bb1(0x111)]&&(_0x229678[_0x4f6bb1(0x16d)]=JSON[_0x4f6bb1(0x21a)](_0x5ee6b6[_0x4f6bb1(0x111)]),delete _0x229678[_0x4f6bb1(0x111)]);_0x5ee6b6[_0x4f6bb1(0x215)]&&(_0x229678[_0x4f6bb1(0x215)]=JSON[_0x4f6bb1(0x21a)](_0x5ee6b6[_0x4f6bb1(0x215)]),delete _0x229678[_0x4f6bb1(0x215)]);_0x5ee6b6[_0x4f6bb1(0x157)]&&(_0x5ee6b6[_0x4f6bb1(0x157)][_0x4f6bb1(0x1b6)]!==undefined&&(_0x229678[_0x4f6bb1(0x1b6)]=_0x5ee6b6[_0x4f6bb1(0x157)][_0x4f6bb1(0x1b6)]||null),_0x5ee6b6[_0x4f6bb1(0x157)][_0x4f6bb1(0x1cb)]!==undefined&&(_0x229678[_0x4f6bb1(0x1cb)]=_0x5ee6b6[_0x4f6bb1(0x157)][_0x4f6bb1(0x1cb)]||null),_0x5ee6b6['wallets'][_0x4f6bb1(0x136)]!==undefined&&(_0x229678[_0x4f6bb1(0x136)]=_0x5ee6b6[_0x4f6bb1(0x157)][_0x4f6bb1(0x136)]||null),_0x5ee6b6[_0x4f6bb1(0x157)]['usdcPolygonWallet']!==undefined&&(_0x229678[_0x4f6bb1(0x1d5)]=_0x5ee6b6[_0x4f6bb1(0x157)][_0x4f6bb1(0x1d5)]||null),delete _0x229678[_0x4f6bb1(0x157)]);const _0x3f3fb1=await database_1[_0x4f6bb1(0x1cd)]['shop'][_0x4f6bb1(0x124)]({'where':{'id':_0x5ee368},'data':_0x229678,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3f3fb1['id'],'fullName':_0x3f3fb1[_0x4f6bb1(0x14a)],'username':_0x3f3fb1[_0x4f6bb1(0x125)],'telegramId':_0x3f3fb1[_0x4f6bb1(0x1d7)],'merchantUrl':_0x3f3fb1[_0x4f6bb1(0x152)],'gateways':_0x3f3fb1[_0x4f6bb1(0x16d)]?JSON[_0x4f6bb1(0x129)](_0x3f3fb1['paymentGateways']):null,'gatewaySettings':_0x3f3fb1[_0x4f6bb1(0x215)]?JSON['parse'](_0x3f3fb1[_0x4f6bb1(0x215)]):null,'publicKey':_0x3f3fb1[_0x4f6bb1(0x1a1)],'wallets':{'usdtPolygonWallet':_0x3f3fb1[_0x4f6bb1(0x1b6)],'usdtTrcWallet':_0x3f3fb1[_0x4f6bb1(0x1cb)],'usdtErcWallet':_0x3f3fb1['usdtErcWallet'],'usdcPolygonWallet':_0x3f3fb1[_0x4f6bb1(0x1d5)]},'status':_0x3f3fb1[_0x4f6bb1(0x183)],'createdAt':_0x3f3fb1['createdAt']};}async[a35_0xbba01f(0x118)](_0x40b078){const _0x1b3100=a35_0xbba01f,_0x4cbdbe=await database_1['default'][_0x1b3100(0x13f)][_0x1b3100(0x124)]({'where':{'id':_0x40b078},'data':{'status':_0x1b3100(0x19c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4cbdbe['id'],'fullName':_0x4cbdbe[_0x1b3100(0x14a)],'username':_0x4cbdbe[_0x1b3100(0x125)],'telegramId':_0x4cbdbe[_0x1b3100(0x1d7)],'merchantUrl':_0x4cbdbe[_0x1b3100(0x152)],'gateways':_0x4cbdbe['paymentGateways']?JSON[_0x1b3100(0x129)](_0x4cbdbe[_0x1b3100(0x16d)]):null,'gatewaySettings':_0x4cbdbe[_0x1b3100(0x215)]?JSON[_0x1b3100(0x129)](_0x4cbdbe[_0x1b3100(0x215)]):null,'publicKey':_0x4cbdbe[_0x1b3100(0x1a1)],'wallets':{'usdtPolygonWallet':_0x4cbdbe[_0x1b3100(0x1b6)],'usdtTrcWallet':_0x4cbdbe['usdtTrcWallet'],'usdtErcWallet':_0x4cbdbe['usdtErcWallet'],'usdcPolygonWallet':_0x4cbdbe[_0x1b3100(0x1d5)]},'status':_0x4cbdbe[_0x1b3100(0x183)],'createdAt':_0x4cbdbe['createdAt']};}async['activateUser'](_0x5e34ec){const _0x2386e5=a35_0xbba01f,_0x7b5ab6=await database_1[_0x2386e5(0x1cd)][_0x2386e5(0x13f)][_0x2386e5(0x124)]({'where':{'id':_0x5e34ec},'data':{'status':_0x2386e5(0x1cc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x7b5ab6['id'],'fullName':_0x7b5ab6['name'],'username':_0x7b5ab6['username'],'telegramId':_0x7b5ab6[_0x2386e5(0x1d7)],'merchantUrl':_0x7b5ab6[_0x2386e5(0x152)],'gateways':_0x7b5ab6[_0x2386e5(0x16d)]?JSON[_0x2386e5(0x129)](_0x7b5ab6[_0x2386e5(0x16d)]):null,'gatewaySettings':_0x7b5ab6[_0x2386e5(0x215)]?JSON[_0x2386e5(0x129)](_0x7b5ab6[_0x2386e5(0x215)]):null,'publicKey':_0x7b5ab6[_0x2386e5(0x1a1)],'wallets':{'usdtPolygonWallet':_0x7b5ab6[_0x2386e5(0x1b6)],'usdtTrcWallet':_0x7b5ab6[_0x2386e5(0x1cb)],'usdtErcWallet':_0x7b5ab6[_0x2386e5(0x136)],'usdcPolygonWallet':_0x7b5ab6[_0x2386e5(0x1d5)]},'status':_0x7b5ab6['status'],'createdAt':_0x7b5ab6['createdAt']};}async['getAllUsers'](_0x43a824){const _0x3d9cb7=a35_0xbba01f,{page:_0xe01534,limit:_0x48ce49,status:_0x3f7b25}=_0x43a824,_0x596871=(_0xe01534-0x1)*_0x48ce49,_0x45c3be={};_0x3f7b25&&(_0x45c3be[_0x3d9cb7(0x183)]=_0x3f7b25[_0x3d9cb7(0x159)]());const [_0x56c3a2,_0xf026b0]=await Promise[_0x3d9cb7(0x187)]([database_1[_0x3d9cb7(0x1cd)][_0x3d9cb7(0x13f)][_0x3d9cb7(0x1f9)]({'where':_0x45c3be,'skip':_0x596871,'take':_0x48ce49,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x3d9cb7(0x13f)]['count']({'where':_0x45c3be})]);return{'users':_0x56c3a2['map'](_0x4daafa=>({'id':_0x4daafa['id'],'fullName':_0x4daafa[_0x3d9cb7(0x14a)],'username':_0x4daafa[_0x3d9cb7(0x125)],'telegramId':_0x4daafa['telegram'],'merchantUrl':_0x4daafa[_0x3d9cb7(0x152)],'gateways':_0x4daafa[_0x3d9cb7(0x16d)]?JSON['parse'](_0x4daafa[_0x3d9cb7(0x16d)]):null,'gatewaySettings':_0x4daafa[_0x3d9cb7(0x215)]?JSON[_0x3d9cb7(0x129)](_0x4daafa[_0x3d9cb7(0x215)]):null,'publicKey':_0x4daafa[_0x3d9cb7(0x1a1)],'wallets':{'usdtPolygonWallet':_0x4daafa[_0x3d9cb7(0x1b6)],'usdtTrcWallet':_0x4daafa[_0x3d9cb7(0x1cb)],'usdtErcWallet':_0x4daafa['usdtErcWallet'],'usdcPolygonWallet':_0x4daafa[_0x3d9cb7(0x1d5)]},'status':_0x4daafa[_0x3d9cb7(0x183)],'createdAt':_0x4daafa[_0x3d9cb7(0x15a)]})),'pagination':{'page':_0xe01534,'limit':_0x48ce49,'total':_0xf026b0,'totalPages':Math[_0x3d9cb7(0x20c)](_0xf026b0/_0x48ce49)}};}async[a35_0xbba01f(0x11d)](_0x528232){const _0x1179ae=a35_0xbba01f,_0x478734=await database_1['default'][_0x1179ae(0x13f)]['findUnique']({'where':{'id':_0x528232},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x478734)return null;return{'id':_0x478734['id'],'fullName':_0x478734[_0x1179ae(0x14a)],'username':_0x478734[_0x1179ae(0x125)],'telegramId':_0x478734[_0x1179ae(0x1d7)],'merchantUrl':_0x478734[_0x1179ae(0x152)],'gateways':_0x478734[_0x1179ae(0x16d)]?JSON[_0x1179ae(0x129)](_0x478734[_0x1179ae(0x16d)]):null,'gatewaySettings':_0x478734['gatewaySettings']?JSON[_0x1179ae(0x129)](_0x478734[_0x1179ae(0x215)]):null,'publicKey':_0x478734['publicKey'],'wallets':{'usdtPolygonWallet':_0x478734[_0x1179ae(0x1b6)],'usdtTrcWallet':_0x478734[_0x1179ae(0x1cb)],'usdtErcWallet':_0x478734[_0x1179ae(0x136)],'usdcPolygonWallet':_0x478734[_0x1179ae(0x1d5)]},'status':_0x478734[_0x1179ae(0x183)],'createdAt':_0x478734['createdAt']};}async[a35_0xbba01f(0x1bd)](_0x40adfd){const _0x49bd76=a35_0xbba01f,{fullName:_0x23cdd0,username:_0x275dc9,password:_0x17084a,telegramId:_0x451171,merchantUrl:_0x426aec,gateways:_0x22a9d6,gatewaySettings:_0xc08d59,wallets:_0x3e357f}=_0x40adfd,_0x3104f9=await database_1[_0x49bd76(0x1cd)][_0x49bd76(0x13f)][_0x49bd76(0x10f)]({'where':{'username':_0x275dc9}});if(_0x3104f9)throw new Error(_0x49bd76(0x122));if(_0x451171){const _0x54d3d6=await database_1['default']['shop']['findUnique']({'where':{'telegram':_0x451171}});if(_0x54d3d6)throw new Error(_0x49bd76(0x1c3));}const _0x35940=await bcryptjs_1[_0x49bd76(0x1cd)]['hash'](_0x17084a,0xc),_0x49b3b1=_0x49bd76(0x19b)+crypto_1[_0x49bd76(0x1cd)][_0x49bd76(0x1a6)](0x20)['toString']('hex'),_0x1acde6='sk_'+crypto_1[_0x49bd76(0x1cd)]['randomBytes'](0x20)[_0x49bd76(0x19a)](_0x49bd76(0x1de)),_0x2a2f3b=await database_1[_0x49bd76(0x1cd)]['shop']['create']({'data':{'name':_0x23cdd0,'username':_0x275dc9,'password':_0x35940,'telegram':_0x451171,'shopUrl':_0x426aec,'paymentGateways':_0x22a9d6?JSON[_0x49bd76(0x21a)](_0x22a9d6):null,'gatewaySettings':_0xc08d59?JSON[_0x49bd76(0x21a)](_0xc08d59):null,'usdtPolygonWallet':_0x3e357f?.[_0x49bd76(0x1b6)]||null,'usdtTrcWallet':_0x3e357f?.['usdtTrcWallet']||null,'usdtErcWallet':_0x3e357f?.[_0x49bd76(0x136)]||null,'usdcPolygonWallet':_0x3e357f?.[_0x49bd76(0x1d5)]||null,'publicKey':_0x49b3b1,'secretKey':_0x1acde6,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2a2f3b['id'],'fullName':_0x2a2f3b[_0x49bd76(0x14a)],'username':_0x2a2f3b[_0x49bd76(0x125)],'telegramId':_0x2a2f3b[_0x49bd76(0x1d7)],'merchantUrl':_0x2a2f3b['shopUrl'],'gateways':_0x2a2f3b[_0x49bd76(0x16d)]?JSON[_0x49bd76(0x129)](_0x2a2f3b[_0x49bd76(0x16d)]):null,'gatewaySettings':_0x2a2f3b['gatewaySettings']?JSON[_0x49bd76(0x129)](_0x2a2f3b[_0x49bd76(0x215)]):null,'publicKey':_0x2a2f3b[_0x49bd76(0x1a1)],'wallets':{'usdtPolygonWallet':_0x2a2f3b[_0x49bd76(0x1b6)],'usdtTrcWallet':_0x2a2f3b[_0x49bd76(0x1cb)],'usdtErcWallet':_0x2a2f3b[_0x49bd76(0x136)],'usdcPolygonWallet':_0x2a2f3b[_0x49bd76(0x1d5)]},'status':_0x2a2f3b[_0x49bd76(0x183)],'createdAt':_0x2a2f3b['createdAt']};}async[a35_0xbba01f(0x107)](_0x465933){const _0x330bdd=a35_0xbba01f;await database_1[_0x330bdd(0x1cd)][_0x330bdd(0x13f)][_0x330bdd(0x175)]({'where':{'id':_0x465933}});}['generateDailyStatistics'](_0x37fc5e,_0x272a87,_0x4353f4){const _0x1c5ceb=a35_0xbba01f,_0xe8aac6=new Map(),_0x7bab12=new Date(_0x272a87);while(_0x7bab12<=_0x4353f4){const _0x3d0a0d=_0x7bab12[_0x1c5ceb(0x17b)]()[_0x1c5ceb(0x12a)]('T')[0x0];_0xe8aac6['set'](_0x3d0a0d,{'revenue':0x0,'count':0x0}),_0x7bab12[_0x1c5ceb(0x1fc)](_0x7bab12[_0x1c5ceb(0x1ab)]()+0x1);}for(const _0x3cb2f3 of _0x37fc5e){const _0x5b46b2=_0x3cb2f3['createdAt'][_0x1c5ceb(0x17b)]()[_0x1c5ceb(0x12a)]('T')[0x0],_0x31ff3f=_0xe8aac6['get'](_0x5b46b2);_0x31ff3f&&(_0x31ff3f[_0x1c5ceb(0x18c)]+=0x1,_0x3cb2f3[_0x1c5ceb(0x183)]===_0x1c5ceb(0x1b0)&&(_0x3cb2f3['amountUSDT']?_0x31ff3f[_0x1c5ceb(0x1dc)]+=_0x3cb2f3[_0x1c5ceb(0x18f)]:console[_0x1c5ceb(0x191)]('⚠️\x20Payment\x20'+_0x3cb2f3['id']+_0x1c5ceb(0x1ef))));}const _0x126923=[],_0x480a0f=[];for(const [_0x5a22c6,_0x258af7]of _0xe8aac6){_0x126923[_0x1c5ceb(0x106)]({'date':_0x5a22c6,'amount':Math[_0x1c5ceb(0xfe)](_0x258af7['revenue']*0x64)/0x64}),_0x480a0f[_0x1c5ceb(0x106)]({'date':_0x5a22c6,'count':_0x258af7[_0x1c5ceb(0x18c)]});}return{'dailyRevenue':_0x126923,'dailyPayments':_0x480a0f};}}exports[a35_0xbba01f(0x1ce)]=AdminService;