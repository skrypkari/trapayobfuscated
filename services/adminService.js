'use strict';const a35_0x27b8ef=a35_0x3a1f;(function(_0x4cec14,_0x4afde1){const _0x3d60fc=a35_0x3a1f,_0xa0f812=_0x4cec14();while(!![]){try{const _0x496bbc=-parseInt(_0x3d60fc(0x179))/0x1*(-parseInt(_0x3d60fc(0x1e7))/0x2)+-parseInt(_0x3d60fc(0x206))/0x3*(-parseInt(_0x3d60fc(0x1e1))/0x4)+-parseInt(_0x3d60fc(0x142))/0x5+parseInt(_0x3d60fc(0x146))/0x6+-parseInt(_0x3d60fc(0x12b))/0x7*(-parseInt(_0x3d60fc(0x165))/0x8)+-parseInt(_0x3d60fc(0x131))/0x9*(parseInt(_0x3d60fc(0x113))/0xa)+-parseInt(_0x3d60fc(0x18b))/0xb;if(_0x496bbc===_0x4afde1)break;else _0xa0f812['push'](_0xa0f812['shift']());}catch(_0x3528d0){_0xa0f812['push'](_0xa0f812['shift']());}}}(a35_0x6b4e,0xc6975));function a35_0x3a1f(_0x4d153f,_0x26cf52){const _0x6b4e6a=a35_0x6b4e();return a35_0x3a1f=function(_0x3a1f7f,_0x38ac8b){_0x3a1f7f=_0x3a1f7f-0xf2;let _0x3d8c79=_0x6b4e6a[_0x3a1f7f];return _0x3d8c79;},a35_0x3a1f(_0x4d153f,_0x26cf52);}var __importDefault=this&&this[a35_0x27b8ef(0x1cb)]||function(_0x42b8ba){const _0x5f15bb=a35_0x27b8ef;return _0x42b8ba&&_0x42b8ba[_0x5f15bb(0x137)]?_0x42b8ba:{'default':_0x42b8ba};};Object[a35_0x27b8ef(0x12e)](exports,a35_0x27b8ef(0x137),{'value':!![]}),exports[a35_0x27b8ef(0x126)]=void 0x0;const database_1=__importDefault(require(a35_0x27b8ef(0x1d8))),bcryptjs_1=__importDefault(require(a35_0x27b8ef(0x11c))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x27b8ef(0x1d9)),gateway_1=require(a35_0x27b8ef(0x1f5));function a35_0x6b4e(){const _0x32a644=['getMerchantStatistics','💰\x20Creating\x20payout\x20for\x20shop\x20','amount','\x20\x20\x20Transaction\x20hash:\x20','cointopay','Rapyd','hex','\x20USDT\x20(same\x20as\x20awaiting)','failUrl','paidOutUSDT','\x20merchants','not\x20set','create','klyme_de','getGatewayIdByName','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','totalPayments','totalPayout','not\x20specified','polygon_usdc','hash','\x20in\x20','_sum','payout','updatePaymentStatus','ceil','💱\x20Currency\x20filter\x20applied:\x20','\x20payments)','currencyService','KLYME\x20GB','setDate','status','getTime','Noda','gte','commission','0000','values','📊\x20Getting\x20payments\x20with\x20filters:','📊\x20Final\x20WHERE\x20conditions:','count','externalPaymentUrl','\x20USDT\x20from\x20balance','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','110cXAzuk','🔄\x20Converted\x20gateway\x20name\x20\x27','\x20USDT,\x20Requested:\x20','createPayout','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','PAID','paymentsCount','usdtErcWallet','rapyd','bcryptjs','💰\x20[PAYOUT]\x20Merchant\x20','suspendUser','dailyPayments','asc','📊\x20Merchants\x20awaiting\x20payout:\x20','set','usdtTrcWallet','gatewayEarnings','sk_','AdminService','📋\x20Getting\x20merchants\x20selection\x20list...','gateways','week','merchantEarnings','235711wEFWih','all','\x20USDT\x20(','defineProperty','\x20USDT\x20(actual\x20balances)','telegramId','487287qRiTEP','🔄\x20Gateway\x20mapping\x20(get):','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','toUpperCase','💰\x20Current\x20shop\x20balance:\x20','\x20balance\x20updated:','__esModule','💰\x20Found\x20','REFUND','\x20\x20\x20📊\x20Commission\x20difference:\x20','\x20USDT)','createdAt','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','localeCompare','💰\x20Shop\x20','aggregate','getAllPayments','3797020AMBoMM','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','merchantEarningsUSDT','MasterCard','4135950PmjWru','30d','reduce','gatewayOrderId','%\x20commission)','split','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','createUser','toFixed','💰\x20Payment\x20','Test\x20Gateway','commissionUSDT','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','getAllPayouts','paymentGateways','network','customerName','totalPaidOut','customerUa','delete','ACTIVE','💸\x20CHARGEBACK\x20penalty:\x20-','erc20','📊\x20Gateway\x20filter\x20applied:','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','_count','turnover','sort','\x27\x20not\x20found.\x20Available\x20gateways:\x20','shop','getGatewayNameById','104RPeqyY','customerEmail','\x20->\x20','periodTo','stringify','deletePayout','totalAmountAfterCommissionUSDT','💳\x20Payout\x20wallet\x20for\x20','Shop\x20not\x20found','date','name','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20Gateway:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','customerIp','shopId','usdcPolygonWallet','convertToUSDT','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','findMany','14128OPCXbu','availableBalance','parse','amountAfterCommissionUSDT','\x20\x20\x20🌐\x20IP:\x20','gatewaySettings','chargebackAmount','\x20balance\x20updated:\x20','\x20USDT\x20(gross\x20revenue)','shopUrl','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','whiteUrl','test_gateway','insensitive','\x20to\x20','\x20USDT\x20(theoretical\x20net)','admin','⚠️\x20Gateway\x20\x27','1085612TseRXh','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20🖥️\x20User\x20Agent:\x20','Payment\x20not\x20found','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','updatedAt','txid','map',',\x20Commission:\x20','getGatewayDisplayName','Insufficient\x20balance.\x20Available:\x20','adminNotes','getPaymentById','getFullYear','forEach','month','totalAmountUSDT','custom','\x27\x20to\x20name\x20\x27','Plisio','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Merchant\x20loses:\x20','generateDailyStatistics','\x20USDT\x20(after\x20','usdtPolygonWallet','error','📊\x20Calculating\x20payout\x20statistics...','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x27\x20(from\x20\x27','Username\x20already\x20exists','totalCommissionRate','period','\x20\x20\x20Current\x20balance:\x20','🔄\x20Admin\x20updating\x20payment\x20','\x20for\x20shop\x20','\x20USDT','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','$transaction','cointopay2','publicKey','customerCountry','revenue','klyme_eu','currency','balance','paidAt','successUrl','\x27\x20->\x20name\x20\x27','\x20status:\x20','getGatewayInternalName','✅\x20Using\x20gateway\x20filter:\x20\x27','thisMonth','fullName','updateCustomerData','randomBytes',',\x20successful:\x20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','\x20USDT\x20(without\x20commission)','⚠️\x20Requested\x20gateway\x20\x27','entries','deleteUser','summary','\x20order','\x20\x20\x20Total\x20paid\x20out:\x20','__importDefault','length',':\x20commission\x20=\x20','getDate','SUSPENDED','toString','2020-01-01','dateFrom','Open\x20Banking\x202','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','payment','desc','\x20USDT\x20(with\x20commission\x20deducted)','../config/database','./currencyService','failureMessage','notes','getUserById','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','wallets','toLowerCase','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','4bqAELd','lte','username','🔄\x20Gateway\x20mapping:','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20\x20\x20Balance:\x20','34DQBoAq','klyme_gb','periodFrom','turnoverUSDT','toISOString','CoinToPay','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','groupBy','update','\x20\x20\x20Payout\x20amount:\x20','telegram','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','password','../types/gateway','round','getMonth','pk_','totalTurnover','amountUSDT','default','COMPLETED','\x20USDT\x20(+','log','dateTo','\x20\x20\x20🌍\x20Country:\x20','\x20USDT\x20(-','averageCheckUSDT','\x20USDT\x20(after\x20payouts)','findUnique','gateway','2699544RiDAMF','findFirst','push','includes','📊\x20Available\x20gateways\x20in\x20database:','pendingUrl','📊\x20Sorting\x20payments\x20by\x20','\x20no\x20longer\x20PAID:','Error\x20processing\x20payment\x20','orderId','getAllUsers','\x20\x20\x20Merchant\x20gets:\x20','\x20\x20\x20📅\x20This\x20month:\x20','merchantUrl'];a35_0x6b4e=function(){return _0x32a644;};return a35_0x6b4e();}class AdminService{async['getPayoutStats'](){const _0x308450=a35_0x27b8ef;console['log'](_0x308450(0x1a5));const _0x448e3f=await database_1[_0x308450(0x1fb)][_0x308450(0x163)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x4bf257=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x47615d=await database_1['default'][_0x308450(0x1d5)]['count']({'where':{'status':_0x308450(0x118),'gateway':{'not':_0x308450(0x185)}}}),_0x5656ba=new Date(),_0x1bed77=new Date(_0x5656ba[_0x308450(0x198)](),_0x5656ba[_0x308450(0x1f7)](),0x1),_0x2cf73a=new Date(_0x5656ba[_0x308450(0x198)](),_0x5656ba['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x33db8c=await database_1[_0x308450(0x1fb)][_0x308450(0xfe)][_0x308450(0x140)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1bed77,'lte':_0x2cf73a},'status':_0x308450(0x1fc)}}),_0x25d736=_0x448e3f[_0x308450(0xfd)][_0x308450(0x157)]||0x0,_0x572659=_0x4bf257[_0x308450(0x1c8)][_0x308450(0x16b)],_0x5a88ce=_0x33db8c[_0x308450(0xfd)][_0x308450(0x216)]||0x0,_0x4496e2={'totalPayout':Math['round'](_0x25d736*0x64)/0x64,'awaitingPayout':Math['round'](_0x572659*0x64)/0x64,'thisMonth':Math['round'](_0x5a88ce*0x64)/0x64,'availableBalance':Math[_0x308450(0x1f6)](_0x572659*0x64)/0x64,'totalPayments':_0x47615d};return console[_0x308450(0x1fe)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x308450(0x1fe)](_0x308450(0x1e5)+_0x4496e2['totalPayout']+_0x308450(0x19f)),console[_0x308450(0x1fe)](_0x308450(0x1a6)+_0x4496e2['awaitingPayout']+_0x308450(0x1d7)),console[_0x308450(0x1fe)](_0x308450(0x1f2)+_0x4496e2[_0x308450(0x17a)]+_0x308450(0x21b)),console[_0x308450(0x1fe)](_0x308450(0x212)+_0x4496e2['thisMonth']+_0x308450(0x1ae)),console[_0x308450(0x1fe)]('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x4496e2[_0x308450(0xf7)]+'\x20PAID\x20payments'),console[_0x308450(0x1fe)](_0x308450(0x152)+(_0x448e3f['_sum'][_0x308450(0x1b7)]||0x0)[_0x308450(0x14e)](0x2)+_0x308450(0x1c4)),console[_0x308450(0x1fe)](_0x308450(0x13a)+((_0x448e3f[_0x308450(0xfd)][_0x308450(0x1b7)]||0x0)-_0x572659)[_0x308450(0x14e)](0x2)+_0x308450(0x1ae)),_0x4496e2;}async[a35_0x27b8ef(0x1c0)](_0x5cea9c,_0x5bbed4){const _0x58f36f=a35_0x27b8ef;console[_0x58f36f(0x1fe)](_0x58f36f(0x1dd)+_0x5cea9c+':',_0x5bbed4);const _0xeb0d60=await database_1[_0x58f36f(0x1fb)][_0x58f36f(0x1d5)][_0x58f36f(0x204)]({'where':{'id':_0x5cea9c},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xeb0d60)throw new Error(_0x58f36f(0x18e));const _0x8a3289={};_0x5bbed4[_0x58f36f(0x1b3)]!==undefined&&(_0x8a3289[_0x58f36f(0x1b3)]=_0x5bbed4[_0x58f36f(0x1b3)]||null);_0x5bbed4[_0x58f36f(0x173)]!==undefined&&(_0x8a3289[_0x58f36f(0x173)]=_0x5bbed4['customerIp']||null);_0x5bbed4['customerUa']!==undefined&&(_0x8a3289[_0x58f36f(0x158)]=_0x5bbed4['customerUa']||null);const _0x2a253e=await database_1['default'][_0x58f36f(0x1d5)][_0x58f36f(0x1ef)]({'where':{'id':_0x5cea9c},'data':{..._0x8a3289,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x58f36f(0x1fe)](_0x58f36f(0x13d)+_0x5cea9c),console['log'](_0x58f36f(0x200)+_0xeb0d60['customerCountry']+_0x58f36f(0x167)+_0x2a253e['customerCountry']),console[_0x58f36f(0x1fe)](_0x58f36f(0x17d)+_0xeb0d60[_0x58f36f(0x173)]+_0x58f36f(0x167)+_0x2a253e['customerIp']),console[_0x58f36f(0x1fe)](_0x58f36f(0x18d)+(_0xeb0d60[_0x58f36f(0x158)]?'set':_0x58f36f(0xf2))+_0x58f36f(0x167)+(_0x2a253e[_0x58f36f(0x158)]?_0x58f36f(0x122):_0x58f36f(0xf2))),_0x2a253e;}async['getSystemStatistics'](_0x4d1328){const _0x3d0a67=a35_0x27b8ef,_0x59c99c=new Date();let _0x4facca;switch(_0x4d1328){case'7d':_0x4facca=new Date(_0x59c99c[_0x3d0a67(0x107)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3d0a67(0x147):_0x4facca=new Date(_0x59c99c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x4facca=new Date(_0x59c99c[_0x3d0a67(0x107)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x3f14a0=await database_1[_0x3d0a67(0x1fb)][_0x3d0a67(0x1d5)][_0x3d0a67(0x207)]({'where':{'gateway':{'not':_0x3d0a67(0x185)}},'orderBy':{'createdAt':_0x3d0a67(0x120)},'select':{'createdAt':!![]}});_0x4facca=_0x3f14a0?_0x3f14a0[_0x3d0a67(0x13c)]:new Date('2020-01-01'),console['log'](_0x3d0a67(0x183)+_0x4facca['toISOString']());break;default:_0x4facca=new Date(_0x59c99c[_0x3d0a67(0x107)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xef0996,_0x32a17b,_0x3fa09d,_0x2e13c0,_0x30ff3b,_0x51d970,_0x256e3a]=await Promise['all']([database_1[_0x3d0a67(0x1fb)]['shop'][_0x3d0a67(0x10f)](),database_1['default'][_0x3d0a67(0x163)][_0x3d0a67(0x10f)]({'where':{'status':'ACTIVE'}}),database_1[_0x3d0a67(0x1fb)][_0x3d0a67(0x1d5)][_0x3d0a67(0x10f)]({'where':{'createdAt':{'gte':_0x4facca},'gateway':{'not':'test_gateway'}}}),database_1[_0x3d0a67(0x1fb)][_0x3d0a67(0x1d5)][_0x3d0a67(0x10f)]({'where':{'status':'PAID','createdAt':{'gte':_0x4facca},'gateway':{'not':_0x3d0a67(0x185)}}}),database_1[_0x3d0a67(0x1fb)][_0x3d0a67(0x1d5)][_0x3d0a67(0x178)]({'where':{'status':_0x3d0a67(0x118),'createdAt':{'gte':_0x4facca},'gateway':{'not':_0x3d0a67(0x185)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x3d0a67(0x1fb)]['payment']['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment']['findMany']({'where':{'createdAt':{'gte':_0x4facca},'gateway':{'not':_0x3d0a67(0x185)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x293461=0x0;for(const _0x20e8af of _0x30ff3b){const _0x2d69b2=await currencyService_1[_0x3d0a67(0x103)][_0x3d0a67(0x176)](_0x20e8af[_0x3d0a67(0x216)],_0x20e8af[_0x3d0a67(0x1b6)]);_0x293461+=_0x2d69b2;}const _0x510f7b=this[_0x3d0a67(0x1a1)](_0x256e3a,_0x4facca,_0x59c99c),_0xa0f4d1=_0x3fa09d>0x0?_0x2e13c0/_0x3fa09d*0x64:0x0;return{'totalShops':_0xef0996,'activeShops':_0x32a17b,'totalPayments':_0x3fa09d,'successfulPayments':_0x2e13c0,'totalRevenue':Math[_0x3d0a67(0x1f6)](_0x293461*0x64)/0x64,'conversionRate':Math[_0x3d0a67(0x1f6)](_0xa0f4d1*0x64)/0x64,'dailyRevenue':_0x510f7b['dailyRevenue'],'dailyPayments':_0x510f7b[_0x3d0a67(0x11f)],'recentPayments':_0x51d970[_0x3d0a67(0x192)](_0x4ac916=>({'id':_0x4ac916['id'],'amount':_0x4ac916[_0x3d0a67(0x216)],'currency':_0x4ac916[_0x3d0a67(0x1b6)],'status':_0x4ac916[_0x3d0a67(0x106)],'gateway':_0x4ac916['gateway'],'shop':_0x4ac916[_0x3d0a67(0x163)],'createdAt':_0x4ac916[_0x3d0a67(0x13c)]}))};}async[a35_0x27b8ef(0x214)](_0x404128){const _0x839c31=a35_0x27b8ef;console[_0x839c31(0x1fe)](_0x839c31(0x133),_0x404128);let _0xaa3f8,_0x32ffd1=new Date();if(_0x404128[_0x839c31(0x1aa)]==='custom'&&_0x404128[_0x839c31(0x1d2)]&&_0x404128['dateTo'])_0xaa3f8=new Date(_0x404128['dateFrom']),_0x32ffd1=new Date(_0x404128[_0x839c31(0x1ff)]);else{const _0x257f38=new Date();switch(_0x404128[_0x839c31(0x1aa)]){case _0x839c31(0x129):_0xaa3f8=new Date(_0x257f38[_0x839c31(0x107)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x839c31(0x19a):_0xaa3f8=new Date(_0x257f38[_0x839c31(0x107)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0xaa3f8=new Date(_0x257f38[_0x839c31(0x107)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0xaa3f8=new Date(_0x839c31(0x1d1));break;}}console[_0x839c31(0x1fe)]('📅\x20Period:\x20'+_0xaa3f8[_0x839c31(0x1eb)]()+_0x839c31(0x187)+_0x32ffd1['toISOString']());const _0x51888d={'status':'PAID','gateway':{'not':_0x839c31(0x185)},'paidAt':{'gte':_0xaa3f8,'lte':_0x32ffd1}};_0x404128[_0x839c31(0x174)]&&(_0x51888d[_0x839c31(0x174)]=_0x404128[_0x839c31(0x174)]);const _0x2041aa=await database_1[_0x839c31(0x1fb)][_0x839c31(0x1d5)]['findMany']({'where':_0x51888d,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x839c31(0x1fe)](_0x839c31(0x138)+_0x2041aa[_0x839c31(0x1cc)]+'\x20paid\x20payments\x20for\x20analysis');const _0x44712b={'gateway':{'not':_0x839c31(0x185)},'createdAt':{'gte':_0xaa3f8,'lte':_0x32ffd1}};_0x404128[_0x839c31(0x174)]&&(_0x44712b[_0x839c31(0x174)]=_0x404128[_0x839c31(0x174)]);const _0x17c6f7=await database_1[_0x839c31(0x1fb)][_0x839c31(0x1d5)][_0x839c31(0x10f)]({'where':_0x44712b});console[_0x839c31(0x1fe)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x17c6f7+_0x839c31(0x1c2)+_0x2041aa[_0x839c31(0x1cc)]);let _0x1164b4=0x0,_0x40c612=0x0,_0x16d9e6=0x0;const _0x16e727={},_0xbeb67b={},_0x18401c={};for(const _0x22c1cc of _0x2041aa){try{const _0x10b3f0=await currencyService_1[_0x839c31(0x103)]['convertToUSDT'](_0x22c1cc[_0x839c31(0x216)],_0x22c1cc[_0x839c31(0x1b6)]);let _0x5c3570={};if(_0x22c1cc[_0x839c31(0x163)][_0x839c31(0x17e)])try{_0x5c3570=JSON[_0x839c31(0x17b)](_0x22c1cc[_0x839c31(0x163)][_0x839c31(0x17e)]);}catch(_0x29fa92){console[_0x839c31(0x1a4)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x22c1cc[_0x839c31(0x174)]+':',_0x29fa92);}let _0x445477={},_0x2025d8=0xa;for(const [_0x150d1b,_0x10cb5b]of Object[_0x839c31(0x1c6)](_0x5c3570)){if(_0x150d1b['toLowerCase']()===_0x22c1cc[_0x839c31(0x205)][_0x839c31(0x1df)]()){_0x445477=_0x10cb5b,_0x2025d8=_0x10cb5b[_0x839c31(0x10a)]||0xa;break;}}const _0x369e0b=_0x10b3f0*(_0x2025d8/0x64),_0x3313fa=_0x10b3f0-_0x369e0b;_0x1164b4+=_0x10b3f0,_0x40c612+=_0x3313fa,_0x16d9e6+=_0x369e0b;!_0x16e727[_0x22c1cc[_0x839c31(0x205)]]&&(_0x16e727[_0x22c1cc[_0x839c31(0x205)]]={'gateway':_0x22c1cc[_0x839c31(0x205)],'gatewayDisplayName':this[_0x839c31(0x194)](_0x22c1cc[_0x839c31(0x205)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x16e727[_0x22c1cc['gateway']]['paymentsCount']++,_0x16e727[_0x22c1cc[_0x839c31(0x205)]][_0x839c31(0x1ea)]+=_0x10b3f0,_0x16e727[_0x22c1cc['gateway']][_0x839c31(0x151)]+=_0x369e0b,_0x16e727[_0x22c1cc[_0x839c31(0x205)]][_0x839c31(0x144)]+=_0x3313fa,_0x16e727[_0x22c1cc[_0x839c31(0x205)]][_0x839c31(0x1a9)]+=_0x2025d8;!_0x404128[_0x839c31(0x174)]&&(!_0xbeb67b[_0x22c1cc['shopId']]&&(_0xbeb67b[_0x22c1cc['shopId']]={'shopId':_0x22c1cc[_0x839c31(0x174)],'shopName':_0x22c1cc[_0x839c31(0x163)][_0x839c31(0x16f)],'shopUsername':_0x22c1cc[_0x839c31(0x163)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xbeb67b[_0x22c1cc[_0x839c31(0x174)]][_0x839c31(0x119)]++,_0xbeb67b[_0x22c1cc[_0x839c31(0x174)]][_0x839c31(0x1ea)]+=_0x10b3f0,_0xbeb67b[_0x22c1cc[_0x839c31(0x174)]]['commissionUSDT']+=_0x369e0b,_0xbeb67b[_0x22c1cc[_0x839c31(0x174)]][_0x839c31(0x144)]+=_0x3313fa);const _0x18a624=_0x22c1cc[_0x839c31(0x1b8)][_0x839c31(0x1eb)]()[_0x839c31(0x14b)]('T')[0x0];!_0x18401c[_0x18a624]&&(_0x18401c[_0x18a624]={'date':_0x18a624,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x18401c[_0x18a624][_0x839c31(0x160)]+=_0x10b3f0,_0x18401c[_0x18a624][_0x839c31(0x12a)]+=_0x3313fa,_0x18401c[_0x18a624][_0x839c31(0x124)]+=_0x369e0b,_0x18401c[_0x18a624]['paymentsCount']++;}catch(_0x40f69e){console['error'](_0x839c31(0x20e)+_0x22c1cc['id']+':',_0x40f69e);}}Object[_0x839c31(0x10c)](_0x16e727)['forEach'](_0x32183a=>{const _0x18c763=_0x839c31;_0x32183a['averageCommissionRate']=_0x32183a[_0x18c763(0x119)]>0x0?_0x32183a[_0x18c763(0x1a9)]/_0x32183a[_0x18c763(0x119)]:0x0,delete _0x32183a[_0x18c763(0x1a9)];}),Object['values'](_0xbeb67b)[_0x839c31(0x199)](_0x5c218c=>{const _0x4a5330=_0x839c31;_0x5c218c[_0x4a5330(0x202)]=_0x5c218c['paymentsCount']>0x0?_0x5c218c[_0x4a5330(0x1ea)]/_0x5c218c[_0x4a5330(0x119)]:0x0;});let _0x7abe70=0x0;if(_0x404128[_0x839c31(0x174)]){const _0xb744cb=await database_1['default'][_0x839c31(0xfe)][_0x839c31(0x178)]({'where':{'shopId':_0x404128[_0x839c31(0x174)],'status':_0x839c31(0x1fc),'createdAt':{'gte':_0xaa3f8,'lte':_0x32ffd1}},'select':{'amount':!![]}});_0x7abe70=_0xb744cb['reduce']((_0x25405c,_0x2b4ef7)=>_0x25405c+_0x2b4ef7['amount'],0x0);}const _0x391b0e=_0x17c6f7,_0x257470=_0x2041aa[_0x839c31(0x1cc)],_0x597d87=_0x257470>0x0?_0x1164b4/_0x257470:0x0,_0x5e4f2d=_0x391b0e>0x0?Math['round'](_0x257470/_0x391b0e*0x2710)/0x64:0x0,_0x30dae7=Math['ceil']((_0x32ffd1[_0x839c31(0x107)]()-_0xaa3f8[_0x839c31(0x107)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3807b4={'totalTurnover':Math[_0x839c31(0x1f6)](_0x1164b4*0x64)/0x64,'merchantEarnings':Math[_0x839c31(0x1f6)](_0x40c612*0x64)/0x64,'gatewayEarnings':Math[_0x839c31(0x1f6)](_0x16d9e6*0x64)/0x64,'totalPaidOut':Math['round'](_0x7abe70*0x64)/0x64,'averageCheck':Math[_0x839c31(0x1f6)](_0x597d87*0x64)/0x64,'totalPayments':_0x391b0e,'successfulPayments':_0x257470,'conversionRate':_0x5e4f2d,'gatewayBreakdown':Object[_0x839c31(0x10c)](_0x16e727)[_0x839c31(0x192)](_0x126734=>({..._0x126734,'turnoverUSDT':Math[_0x839c31(0x1f6)](_0x126734[_0x839c31(0x1ea)]*0x64)/0x64,'commissionUSDT':Math[_0x839c31(0x1f6)](_0x126734[_0x839c31(0x151)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x839c31(0x1f6)](_0x126734[_0x839c31(0x144)]*0x64)/0x64,'averageCommissionRate':Math[_0x839c31(0x1f6)](_0x126734['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x404128[_0x839c31(0x174)]?undefined:Object[_0x839c31(0x10c)](_0xbeb67b)[_0x839c31(0x192)](_0x44e07a=>({..._0x44e07a,'turnoverUSDT':Math[_0x839c31(0x1f6)](_0x44e07a[_0x839c31(0x1ea)]*0x64)/0x64,'commissionUSDT':Math[_0x839c31(0x1f6)](_0x44e07a['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x839c31(0x1f6)](_0x44e07a[_0x839c31(0x144)]*0x64)/0x64,'paidOutUSDT':Math[_0x839c31(0x1f6)](_0x44e07a[_0x839c31(0x21d)]*0x64)/0x64,'averageCheckUSDT':Math[_0x839c31(0x1f6)](_0x44e07a[_0x839c31(0x202)]*0x64)/0x64})),'dailyData':Object['values'](_0x18401c)['map'](_0x4ffa69=>({..._0x4ffa69,'turnover':Math['round'](_0x4ffa69[_0x839c31(0x160)]*0x64)/0x64,'merchantEarnings':Math[_0x839c31(0x1f6)](_0x4ffa69[_0x839c31(0x12a)]*0x64)/0x64,'gatewayEarnings':Math[_0x839c31(0x1f6)](_0x4ffa69['gatewayEarnings']*0x64)/0x64}))[_0x839c31(0x161)]((_0x1e8924,_0x1c635c)=>_0x1e8924[_0x839c31(0x16e)][_0x839c31(0x13e)](_0x1c635c[_0x839c31(0x16e)])),'periodInfo':{'from':_0xaa3f8,'to':_0x32ffd1,'periodType':_0x404128[_0x839c31(0x1aa)]||_0x839c31(0x19c),'daysCount':_0x30dae7}};return console[_0x839c31(0x1fe)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x839c31(0x1fe)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x3807b4[_0x839c31(0x1f9)]+_0x839c31(0x1ae)),console[_0x839c31(0x1fe)](_0x839c31(0x1f3)+_0x3807b4[_0x839c31(0x12a)]+_0x839c31(0x1ae)),console[_0x839c31(0x1fe)](_0x839c31(0x1ed)+_0x3807b4[_0x839c31(0x124)]+_0x839c31(0x1ae)),console[_0x839c31(0x1fe)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x3807b4['totalPayments']),_0x3807b4;}async['getMerchantsSelection'](){const _0x5ca886=a35_0x27b8ef;console[_0x5ca886(0x1fe)](_0x5ca886(0x127));const _0x16a82b=await database_1['default'][_0x5ca886(0x163)][_0x5ca886(0x178)]({'where':{'status':_0x5ca886(0x15a)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x5ca886(0x120)}});return console[_0x5ca886(0x1fe)]('📋\x20Found\x20'+_0x16a82b[_0x5ca886(0x1cc)]+'\x20active\x20merchants\x20for\x20selection'),_0x16a82b[_0x5ca886(0x192)](_0x5e06b2=>({'id':_0x5e06b2['id'],'username':_0x5e06b2[_0x5ca886(0x1e3)],'name':_0x5e06b2[_0x5ca886(0x16f)]}));}[a35_0x27b8ef(0x194)](_0x231f1c){const _0x5645a4=a35_0x27b8ef,_0xce2fd2={'test_gateway':_0x5645a4(0x150),'plisio':_0x5645a4(0x19e),'rapyd':_0x5645a4(0x219),'noda':_0x5645a4(0x108),'cointopay':_0x5645a4(0x1ec),'cointopay2':_0x5645a4(0x1d3),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x5645a4(0x104),'klyme_de':'KLYME\x20DE','mastercard':_0x5645a4(0x145)};return _0xce2fd2[_0x231f1c]||_0x231f1c;}[a35_0x27b8ef(0x1bc)](_0x4b43a0){const _0x12aba2=a35_0x27b8ef,_0x336b2d={'Test\x20Gateway':_0x12aba2(0x185),'Plisio':'plisio','Rapyd':_0x12aba2(0x11b),'Noda':'noda','CoinToPay':_0x12aba2(0x218),'CoinToPay2':_0x12aba2(0x1b1),'KLYME\x20EU':_0x12aba2(0x1b5),'KLYME\x20GB':_0x12aba2(0x1e8),'KLYME\x20DE':_0x12aba2(0xf4),'MasterCard':'mastercard'};return _0x336b2d[_0x4b43a0]||_0x4b43a0[_0x12aba2(0x1df)]();}async['getMerchantsAwaitingPayout'](_0x485e3c){const _0x492d66=a35_0x27b8ef,{page:_0xeaa87b,limit:_0x599bb5,minAmount:_0x131211,search:_0x3ee38d}=_0x485e3c,_0x4e4568=(_0xeaa87b-0x1)*_0x599bb5;console[_0x492d66(0x1fe)](_0x492d66(0x18c),_0x485e3c);const _0x365be8={'balance':{'gt':0x0},'status':'ACTIVE'};_0x131211&&(_0x365be8[_0x492d66(0x1b7)][_0x492d66(0x109)]=_0x131211);_0x3ee38d&&(_0x365be8['OR']=[{'name':{'contains':_0x3ee38d,'mode':'insensitive'}},{'username':{'contains':_0x3ee38d,'mode':_0x492d66(0x186)}}]);const [_0x5f4f5e,_0x5f1949]=await Promise[_0x492d66(0x12c)]([database_1['default'][_0x492d66(0x163)][_0x492d66(0x178)]({'where':_0x365be8,'skip':_0x4e4568,'take':_0x599bb5,'orderBy':{'balance':_0x492d66(0x1d6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x492d66(0x1fb)][_0x492d66(0x163)]['count']({'where':_0x365be8})]);console[_0x492d66(0x1fe)](_0x492d66(0x138)+_0x5f4f5e['length']+'\x20merchants\x20with\x20positive\x20balance');const _0x59a65f=await Promise[_0x492d66(0x12c)](_0x5f4f5e['map'](async _0x2de937=>{const _0x36055d=_0x492d66,[_0x2a8207,_0x417b57,_0x3ad79e]=await Promise[_0x36055d(0x12c)]([database_1['default'][_0x36055d(0x1d5)][_0x36055d(0x10f)]({'where':{'shopId':_0x2de937['id'],'status':'PAID','gateway':{'not':_0x36055d(0x185)}}}),database_1['default']['payment']['findFirst']({'where':{'shopId':_0x2de937['id'],'status':'PAID','gateway':{'not':_0x36055d(0x185)}},'orderBy':{'paidAt':_0x36055d(0x120)},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x36055d(0x1ee)]({'by':['gateway'],'where':{'shopId':_0x2de937['id'],'status':_0x36055d(0x118),'gateway':{'not':_0x36055d(0x185)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x387bd7=new Date(),_0xee2149=new Date(_0x387bd7[_0x36055d(0x198)](),_0x387bd7[_0x36055d(0x1f7)](),0x1),_0x53f219=new Date(_0x387bd7[_0x36055d(0x198)](),_0x387bd7['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x4ef66c,_0x3a5044]=await Promise[_0x36055d(0x12c)]([database_1[_0x36055d(0x1fb)][_0x36055d(0xfe)][_0x36055d(0x140)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2de937['id'],'status':_0x36055d(0x1fc)}}),database_1[_0x36055d(0x1fb)][_0x36055d(0xfe)][_0x36055d(0x140)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2de937['id'],'status':_0x36055d(0x1fc),'createdAt':{'gte':_0xee2149,'lte':_0x53f219}}})]),_0x1defb6=_0x4ef66c[_0x36055d(0xfd)][_0x36055d(0x216)]||0x0,_0x25077f=_0x3a5044[_0x36055d(0xfd)][_0x36055d(0x216)]||0x0,_0x51ed1e=await Promise[_0x36055d(0x12c)](_0x3ad79e[_0x36055d(0x192)](async _0x1b74ac=>{const _0x3580cb=_0x36055d;let _0x4055b6=0xa;if(_0x2de937[_0x3580cb(0x17e)])try{const _0x358659=JSON['parse'](_0x2de937[_0x3580cb(0x17e)]);for(const [_0x45741d,_0x17c1b6]of Object[_0x3580cb(0x1c6)](_0x358659)){if(_0x45741d['toLowerCase']()===_0x1b74ac['gateway'][_0x3580cb(0x1df)]()){_0x4055b6=_0x17c1b6[_0x3580cb(0x10a)]||0xa,console['log']('💰\x20[PAYOUT]\x20Gateway\x20'+_0x1b74ac[_0x3580cb(0x205)]+_0x3580cb(0x1ad)+_0x2de937['id']+_0x3580cb(0x1cd)+_0x4055b6+'%');break;}}}catch(_0x170002){console[_0x3580cb(0x1a4)](_0x3580cb(0x117)+_0x2de937['id']+':',_0x170002);}const _0x582c38=_0x1b74ac[_0x3580cb(0xfd)][_0x3580cb(0x1fa)]||0x0,_0x3f6502=_0x582c38*(0x1-_0x4055b6/0x64);return{'gateway':_0x1b74ac['gateway'],'count':_0x1b74ac[_0x3580cb(0x15f)]['id'],'amountUSDT':Math[_0x3580cb(0x1f6)](_0x582c38*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x3580cb(0x1f6)](_0x3f6502*0x64)/0x64,'commission':_0x4055b6};})),_0x47ea5d=_0x51ed1e[_0x36055d(0x148)]((_0x3bf226,_0x3dfdc1)=>_0x3bf226+_0x3dfdc1[_0x36055d(0x1fa)],0x0),_0x81f1d=_0x2de937[_0x36055d(0x1b7)];return console[_0x36055d(0x1fe)](_0x36055d(0x11d)+_0x2de937[_0x36055d(0x1e3)]+':'),console['log'](_0x36055d(0xf6)+_0x47ea5d['toFixed'](0x2)+_0x36055d(0x181)),console[_0x36055d(0x1fe)](_0x36055d(0x177)+_0x51ed1e[_0x36055d(0x148)]((_0x1be442,_0x57dd66)=>_0x1be442+_0x57dd66[_0x36055d(0x17c)],0x0)['toFixed'](0x2)+_0x36055d(0x188)),console[_0x36055d(0x1fe)](_0x36055d(0x143)+_0x81f1d[_0x36055d(0x14e)](0x2)+_0x36055d(0x203)),{'id':_0x2de937['id'],'fullName':_0x2de937['name'],'username':_0x2de937[_0x36055d(0x1e3)],'telegramId':_0x2de937[_0x36055d(0x1f1)],'merchantUrl':_0x2de937[_0x36055d(0x182)],'wallets':{'usdtPolygonWallet':_0x2de937[_0x36055d(0x1a3)],'usdtTrcWallet':_0x2de937[_0x36055d(0x123)],'usdtErcWallet':_0x2de937[_0x36055d(0x11a)],'usdcPolygonWallet':_0x2de937[_0x36055d(0x175)]},'totalAmountUSDT':Math[_0x36055d(0x1f6)](_0x47ea5d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x36055d(0x1f6)](_0x81f1d*0x64)/0x64,'totalPayout':Math['round'](_0x1defb6*0x64)/0x64,'thisMonth':Math[_0x36055d(0x1f6)](_0x25077f*0x64)/0x64,'paymentsCount':_0x2a8207,'oldestPaymentDate':_0x417b57?.[_0x36055d(0x1b8)]||_0x2de937['createdAt'],'gatewayBreakdown':_0x51ed1e};})),_0x23de72=_0x59a65f[_0x492d66(0x148)]((_0x2514e9,_0x4da10c)=>_0x2514e9+_0x4da10c[_0x492d66(0x19b)],0x0),_0x4da6c5=_0x59a65f[_0x492d66(0x148)]((_0x365c2c,_0x5f40c7)=>_0x365c2c+_0x5f40c7[_0x492d66(0x16b)],0x0),_0x1eb416=_0x59a65f[_0x492d66(0x148)]((_0x27bed1,_0x5b8e55)=>_0x27bed1+_0x5b8e55[_0x492d66(0xf8)],0x0),_0xd7c963=_0x59a65f['reduce']((_0xa2cab2,_0x53c606)=>_0xa2cab2+_0x53c606[_0x492d66(0x1be)],0x0);return console[_0x492d66(0x1fe)](_0x492d66(0x121)+_0x5f1949+_0x492d66(0x21e)),console[_0x492d66(0x1fe)]('\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20'+Math[_0x492d66(0x1f6)](_0x23de72*0x64)/0x64+_0x492d66(0x181)),console[_0x492d66(0x1fe)](_0x492d66(0x1c3)+Math[_0x492d66(0x1f6)](_0x4da6c5*0x64)/0x64+_0x492d66(0x12f)),console[_0x492d66(0x1fe)](_0x492d66(0x1af)+Math[_0x492d66(0x1f6)](_0x1eb416*0x64)/0x64+_0x492d66(0x1ae)),console[_0x492d66(0x1fe)]('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math['round'](_0xd7c963*0x64)/0x64+_0x492d66(0x1ae)),{'merchants':_0x59a65f,'pagination':{'page':_0xeaa87b,'limit':_0x599bb5,'total':_0x5f1949,'totalPages':Math[_0x492d66(0x100)](_0x5f1949/_0x599bb5)},'summary':{'totalMerchants':_0x5f1949,'totalAmountUSDT':Math[_0x492d66(0x1f6)](_0x23de72*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x492d66(0x1f6)](_0x4da6c5*0x64)/0x64,'totalPayout':Math[_0x492d66(0x1f6)](_0x1eb416*0x64)/0x64,'thisMonth':Math[_0x492d66(0x1f6)](_0xd7c963*0x64)/0x64}};}async[a35_0x27b8ef(0x116)](_0x299a57){const _0x28286f=a35_0x27b8ef,{shopId:_0x388729,amount:_0x2520fe,network:_0x430d3a,wallet:_0x210b61,notes:_0x453382,txid:_0x55ca09,periodFrom:_0x22187f,periodTo:_0x793e40}=_0x299a57,_0xf3ce7d=await database_1[_0x28286f(0x1fb)][_0x28286f(0x1b0)](async _0x1d09a4=>{const _0xa57b65=_0x28286f,_0x17c04d=await _0x1d09a4['shop'][_0xa57b65(0x204)]({'where':{'id':_0x388729},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x17c04d)throw new Error(_0xa57b65(0x16d));console['log'](_0xa57b65(0x215)+_0x17c04d[_0xa57b65(0x1e3)]+':'),console[_0xa57b65(0x1fe)](_0xa57b65(0x1ab)+_0x17c04d[_0xa57b65(0x1b7)][_0xa57b65(0x14e)](0x6)+_0xa57b65(0x1ae)),console[_0xa57b65(0x1fe)](_0xa57b65(0x1f0)+_0x2520fe['toFixed'](0x6)+_0xa57b65(0x1ae)),console[_0xa57b65(0x1fe)](_0xa57b65(0x172)+_0x17c04d['totalPaidOut'][_0xa57b65(0x14e)](0x6)+_0xa57b65(0x1ae));if(_0x55ca09)console['log'](_0xa57b65(0x217)+_0x55ca09);if(_0x17c04d[_0xa57b65(0x1b7)]<_0x2520fe)throw new Error(_0xa57b65(0x195)+_0x17c04d[_0xa57b65(0x1b7)][_0xa57b65(0x14e)](0x6)+_0xa57b65(0x115)+_0x2520fe[_0xa57b65(0x14e)](0x6)+_0xa57b65(0x1ae));let _0x334ac6=_0x210b61;if(!_0x334ac6){const _0x41ebc1=await _0x1d09a4[_0xa57b65(0x163)][_0xa57b65(0x204)]({'where':{'id':_0x388729},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x41ebc1)switch(_0x430d3a){case'polygon':_0x334ac6=_0x41ebc1[_0xa57b65(0x1a3)]||undefined;break;case'trc20':_0x334ac6=_0x41ebc1['usdtTrcWallet']||undefined;break;case _0xa57b65(0x15c):_0x334ac6=_0x41ebc1[_0xa57b65(0x11a)]||undefined;break;case _0xa57b65(0xfa):_0x334ac6=_0x41ebc1[_0xa57b65(0x175)]||undefined;break;}}console['log'](_0xa57b65(0x16c)+_0x430d3a+':\x20'+(_0x334ac6||_0xa57b65(0xf9)));const _0x106d6d=await _0x1d09a4['payout'][_0xa57b65(0xf3)]({'data':{'shopId':_0x388729,'amount':_0x2520fe,'network':_0x430d3a,'status':_0xa57b65(0x1fc),'txid':_0x55ca09,'notes':_0x453382,'periodFrom':_0x22187f?new Date(_0x22187f):null,'periodTo':_0x793e40?new Date(_0x793e40):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x843c3=_0x17c04d[_0xa57b65(0x1b7)]-_0x2520fe,_0xb89418=_0x17c04d[_0xa57b65(0x157)]+_0x2520fe;return await _0x1d09a4[_0xa57b65(0x163)]['update']({'where':{'id':_0x388729},'data':{'balance':_0x843c3,'totalPaidOut':_0xb89418}}),console[_0xa57b65(0x1fe)]('💰\x20Shop\x20'+_0x17c04d[_0xa57b65(0x1e3)]+_0xa57b65(0x136)),console[_0xa57b65(0x1fe)](_0xa57b65(0x1e6)+_0x17c04d[_0xa57b65(0x1b7)][_0xa57b65(0x14e)](0x6)+_0xa57b65(0x167)+_0x843c3[_0xa57b65(0x14e)](0x6)+_0xa57b65(0x201)+_0x2520fe[_0xa57b65(0x14e)](0x6)+')'),console[_0xa57b65(0x1fe)](_0xa57b65(0x1ca)+_0x17c04d[_0xa57b65(0x157)]['toFixed'](0x6)+_0xa57b65(0x167)+_0xb89418[_0xa57b65(0x14e)](0x6)+_0xa57b65(0x1fd)+_0x2520fe['toFixed'](0x6)+')'),{'payout':_0x106d6d,'shop':_0x17c04d};});return console[_0x28286f(0x1fe)]('✅\x20Payout\x20created:\x20'+_0xf3ce7d[_0x28286f(0xfe)]['id']+'\x20for\x20shop\x20'+_0xf3ce7d[_0x28286f(0x163)][_0x28286f(0x1e3)]+'\x20('+_0x2520fe+_0x28286f(0x13b)),{'id':_0xf3ce7d[_0x28286f(0xfe)]['id'],'shopId':_0xf3ce7d[_0x28286f(0xfe)][_0x28286f(0x174)],'shopName':_0xf3ce7d[_0x28286f(0x163)]['name'],'shopUsername':_0xf3ce7d[_0x28286f(0x163)][_0x28286f(0x1e3)],'amount':_0xf3ce7d['payout'][_0x28286f(0x216)],'network':_0xf3ce7d['payout']['network'],'status':_0xf3ce7d[_0x28286f(0xfe)][_0x28286f(0x106)],'txid':_0xf3ce7d['payout'][_0x28286f(0x191)],'notes':_0xf3ce7d[_0x28286f(0xfe)][_0x28286f(0x1db)],'periodFrom':_0xf3ce7d[_0x28286f(0xfe)]['periodFrom'],'periodTo':_0xf3ce7d[_0x28286f(0xfe)][_0x28286f(0x168)],'createdAt':_0xf3ce7d[_0x28286f(0xfe)][_0x28286f(0x13c)],'paidAt':_0xf3ce7d['payout'][_0x28286f(0x1b8)]};}async[a35_0x27b8ef(0x153)](_0x3d68fc){const _0x4e97a3=a35_0x27b8ef,{page:_0x4886ae,limit:_0x15bcd9,shopId:_0xbd9d2e,network:_0x3ae89a,dateFrom:_0xed04b7,dateTo:_0x11beed,search:_0x3800d5}=_0x3d68fc,_0x4e3ecc=(_0x4886ae-0x1)*_0x15bcd9,_0xc63c26={};_0xbd9d2e&&(_0xc63c26[_0x4e97a3(0x174)]=_0xbd9d2e);_0x3ae89a&&(_0xc63c26['network']=_0x3ae89a);(_0xed04b7||_0x11beed)&&(_0xc63c26['createdAt']={},_0xed04b7&&(_0xc63c26[_0x4e97a3(0x13c)][_0x4e97a3(0x109)]=new Date(_0xed04b7)),_0x11beed&&(_0xc63c26['createdAt']['lte']=new Date(_0x11beed)));_0x3800d5&&(_0xc63c26['OR']=[{'shop':{'name':{'contains':_0x3800d5,'mode':_0x4e97a3(0x186)}}},{'shop':{'username':{'contains':_0x3800d5,'mode':_0x4e97a3(0x186)}}},{'notes':{'contains':_0x3800d5,'mode':'insensitive'}}]);const [_0x4667e0,_0x2e2a17]=await Promise[_0x4e97a3(0x12c)]([database_1[_0x4e97a3(0x1fb)][_0x4e97a3(0xfe)][_0x4e97a3(0x178)]({'where':_0xc63c26,'skip':_0x4e3ecc,'take':_0x15bcd9,'orderBy':{'createdAt':_0x4e97a3(0x1d6)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4e97a3(0xfe)][_0x4e97a3(0x10f)]({'where':_0xc63c26})]);return{'payouts':_0x4667e0[_0x4e97a3(0x192)](_0x1bb1ff=>({'id':_0x1bb1ff['id'],'shopId':_0x1bb1ff[_0x4e97a3(0x174)],'shopName':_0x1bb1ff[_0x4e97a3(0x163)]['name'],'shopUsername':_0x1bb1ff['shop'][_0x4e97a3(0x1e3)],'amount':_0x1bb1ff[_0x4e97a3(0x216)],'network':_0x1bb1ff[_0x4e97a3(0x155)],'status':_0x1bb1ff['status'],'txid':_0x1bb1ff[_0x4e97a3(0x191)],'notes':_0x1bb1ff[_0x4e97a3(0x1db)],'periodFrom':_0x1bb1ff[_0x4e97a3(0x1e9)],'periodTo':_0x1bb1ff['periodTo'],'createdAt':_0x1bb1ff[_0x4e97a3(0x13c)],'paidAt':_0x1bb1ff['paidAt']})),'pagination':{'page':_0x4886ae,'limit':_0x15bcd9,'total':_0x2e2a17,'totalPages':Math['ceil'](_0x2e2a17/_0x15bcd9)}};}async['getPayoutById'](_0x23dcec){const _0x4d26a5=a35_0x27b8ef,_0x2b3dd2=await database_1['default'][_0x4d26a5(0xfe)][_0x4d26a5(0x204)]({'where':{'id':_0x23dcec},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2b3dd2)return null;return{'id':_0x2b3dd2['id'],'shopId':_0x2b3dd2['shopId'],'shopName':_0x2b3dd2[_0x4d26a5(0x163)]['name'],'shopUsername':_0x2b3dd2[_0x4d26a5(0x163)]['username'],'amount':_0x2b3dd2[_0x4d26a5(0x216)],'network':_0x2b3dd2[_0x4d26a5(0x155)],'status':_0x2b3dd2[_0x4d26a5(0x106)],'txid':_0x2b3dd2[_0x4d26a5(0x191)],'notes':_0x2b3dd2[_0x4d26a5(0x1db)],'periodFrom':_0x2b3dd2[_0x4d26a5(0x1e9)],'periodTo':_0x2b3dd2[_0x4d26a5(0x168)],'createdAt':_0x2b3dd2['createdAt'],'paidAt':_0x2b3dd2[_0x4d26a5(0x1b8)]};}async[a35_0x27b8ef(0x16a)](_0x9a09c8){const _0xe8f926=a35_0x27b8ef;await database_1[_0xe8f926(0x1fb)]['payout'][_0xe8f926(0x159)]({'where':{'id':_0x9a09c8}});}async[a35_0x27b8ef(0x141)](_0x33470e){const _0x2766b1=a35_0x27b8ef,{page:_0x4dba36,limit:_0x395aa8,status:_0x135284,gateway:_0x4c3224,shopId:_0x23ea22,dateFrom:_0x498a07,dateTo:_0x27f40f,search:_0xa75bd6,currency:_0x5af93b,sortBy:_0x25941b,sortOrder:_0x13408c}=_0x33470e,_0x275b90=(_0x4dba36-0x1)*_0x395aa8;console[_0x2766b1(0x1fe)](_0x2766b1(0x10d),_0x33470e);const _0x3bef29=await database_1[_0x2766b1(0x1fb)][_0x2766b1(0x1d5)][_0x2766b1(0x1ee)]({'by':[_0x2766b1(0x205)],'_count':{'gateway':!![]}});console[_0x2766b1(0x1fe)](_0x2766b1(0x20a),_0x3bef29[_0x2766b1(0x192)](_0x2ab293=>_0x2ab293[_0x2766b1(0x205)]+'\x20('+_0x2ab293['_count'][_0x2766b1(0x205)]+_0x2766b1(0x102)));if(_0x4c3224){const _0x185a6f=_0x3bef29['some'](_0x5ad819=>_0x5ad819[_0x2766b1(0x205)][_0x2766b1(0x1df)]()===_0x4c3224[_0x2766b1(0x1df)]());!_0x185a6f&&_0x4c3224[_0x2766b1(0x1df)]()!=='test_gateway'&&console[_0x2766b1(0x1fe)](_0x2766b1(0x1c5)+_0x4c3224+_0x2766b1(0x162)+_0x3bef29[_0x2766b1(0x192)](_0x1abe54=>_0x1abe54[_0x2766b1(0x205)])['join'](',\x20'));}const _0x499532={};_0x135284&&(_0x499532[_0x2766b1(0x106)]=_0x135284[_0x2766b1(0x134)]());if(!_0x4c3224)_0x499532[_0x2766b1(0x205)]={'not':_0x2766b1(0x185)};else{if(_0x4c3224&&(_0x4c3224[_0x2766b1(0x1df)]()==='test_gateway'||_0x4c3224===_0x2766b1(0x10b)))_0x499532[_0x2766b1(0x205)]=_0x2766b1(0x185);else{let _0x5b47a6=_0x4c3224;const _0x4e9b05=(0x0,gateway_1['getGatewayNameById'])(_0x4c3224);if(_0x4e9b05)_0x5b47a6=_0x4e9b05,console[_0x2766b1(0x1fe)]('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x4c3224+_0x2766b1(0x19d)+_0x5b47a6+'\x27');else{const _0x561b96=(0x0,gateway_1[_0x2766b1(0xf5)])(_0x4c3224);if(_0x561b96){const _0x179d19=(0x0,gateway_1[_0x2766b1(0x164)])(_0x561b96);_0x179d19&&(_0x5b47a6=_0x179d19,console[_0x2766b1(0x1fe)](_0x2766b1(0x114)+_0x4c3224+'\x27\x20->\x20ID\x20\x27'+_0x561b96+_0x2766b1(0x1ba)+_0x5b47a6+'\x27'));}else console[_0x2766b1(0x1fe)]('🔍\x20Using\x20gateway\x20\x27'+_0x4c3224+_0x2766b1(0x18f));}const _0x6d294b=await database_1[_0x2766b1(0x1fb)][_0x2766b1(0x1d5)]['count']({'where':{'gateway':_0x5b47a6[_0x2766b1(0x1df)]()},'take':0x1});_0x6d294b===0x0?(console[_0x2766b1(0x1fe)](_0x2766b1(0x18a)+_0x5b47a6+_0x2766b1(0x1a7)+_0x4c3224+_0x2766b1(0x14c)),_0x499532[_0x2766b1(0x205)]='NONEXISTENT_GATEWAY_FILTER'):(_0x499532[_0x2766b1(0x205)]=_0x5b47a6[_0x2766b1(0x1df)](),console[_0x2766b1(0x1fe)](_0x2766b1(0x1bd)+_0x5b47a6+_0x2766b1(0x1a7)+_0x4c3224+'\x27)'));}}console['log'](_0x2766b1(0x15d),_0x499532[_0x2766b1(0x205)]);_0x23ea22&&(_0x499532[_0x2766b1(0x174)]=_0x23ea22);_0x5af93b&&(_0x499532[_0x2766b1(0x1b6)]=_0x5af93b[_0x2766b1(0x134)](),console[_0x2766b1(0x1fe)](_0x2766b1(0x101)+_0x5af93b[_0x2766b1(0x134)]()));(_0x498a07||_0x27f40f)&&(_0x499532[_0x2766b1(0x13c)]={},_0x498a07&&(_0x499532['createdAt'][_0x2766b1(0x109)]=new Date(_0x498a07)),_0x27f40f&&(_0x499532[_0x2766b1(0x13c)][_0x2766b1(0x1e2)]=new Date(_0x27f40f)));_0xa75bd6&&(_0x499532['OR']=[{'id':{'contains':_0xa75bd6,'mode':_0x2766b1(0x186)}},{'orderId':{'contains':_0xa75bd6,'mode':_0x2766b1(0x186)}},{'gatewayOrderId':{'contains':_0xa75bd6,'mode':_0x2766b1(0x186)}},{'customerEmail':{'contains':_0xa75bd6,'mode':_0x2766b1(0x186)}},{'shop':{'name':{'contains':_0xa75bd6,'mode':_0x2766b1(0x186)}}},{'shop':{'username':{'contains':_0xa75bd6,'mode':_0x2766b1(0x186)}}}]);console[_0x2766b1(0x1fe)](_0x2766b1(0x10e),JSON['stringify'](_0x499532,null,0x2));let _0x2d5c31={'createdAt':_0x2766b1(0x1d6)};if(_0x25941b){const _0xf1b031=[_0x2766b1(0x216),_0x2766b1(0x13c),'updatedAt',_0x2766b1(0x106),_0x2766b1(0x205),_0x2766b1(0x1b6)],_0x425b0e=[_0x2766b1(0x120),_0x2766b1(0x1d6)];if(_0xf1b031[_0x2766b1(0x209)](_0x25941b)){const _0x3e567b=_0x425b0e['includes'](_0x13408c)?_0x13408c:_0x2766b1(0x1d6);_0x2d5c31={[_0x25941b]:_0x3e567b},console['log'](_0x2766b1(0x20c)+_0x25941b+_0x2766b1(0xfc)+_0x3e567b+_0x2766b1(0x1c9));}}const [_0x10e72a,_0xd96b7]=await Promise['all']([database_1[_0x2766b1(0x1fb)]['payment'][_0x2766b1(0x178)]({'where':_0x499532,'skip':_0x275b90,'take':_0x395aa8,'orderBy':_0x2d5c31,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2766b1(0x1fb)][_0x2766b1(0x1d5)][_0x2766b1(0x10f)]({'where':_0x499532})]);return{'payments':_0x10e72a,'pagination':{'page':_0x4dba36,'limit':_0x395aa8,'total':_0xd96b7,'totalPages':Math['ceil'](_0xd96b7/_0x395aa8)}};}async[a35_0x27b8ef(0x197)](_0x492c5d){const _0x4ff18d=a35_0x27b8ef,_0x60dbee=await database_1[_0x4ff18d(0x1fb)][_0x4ff18d(0x1d5)][_0x4ff18d(0x204)]({'where':{'id':_0x492c5d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x60dbee)return null;return{'id':_0x60dbee['id'],'shopId':_0x60dbee[_0x4ff18d(0x174)],'gateway':_0x60dbee[_0x4ff18d(0x205)],'amount':_0x60dbee[_0x4ff18d(0x216)],'currency':_0x60dbee[_0x4ff18d(0x1b6)],'status':_0x60dbee[_0x4ff18d(0x106)],'orderId':_0x60dbee[_0x4ff18d(0x20f)],'gatewayOrderId':_0x60dbee['gatewayOrderId'],'customerEmail':_0x60dbee[_0x4ff18d(0x166)],'customerName':_0x60dbee[_0x4ff18d(0x156)],'customerCountry':_0x60dbee['customerCountry'],'customerIp':_0x60dbee['customerIp'],'customerUa':_0x60dbee[_0x4ff18d(0x158)],'failureMessage':_0x60dbee['failureMessage'],'externalPaymentUrl':_0x60dbee[_0x4ff18d(0x110)],'successUrl':_0x60dbee[_0x4ff18d(0x1b9)],'failUrl':_0x60dbee[_0x4ff18d(0x21c)],'pendingUrl':_0x60dbee[_0x4ff18d(0x20b)],'whiteUrl':_0x60dbee[_0x4ff18d(0x184)],'createdAt':_0x60dbee['createdAt'],'updatedAt':_0x60dbee[_0x4ff18d(0x190)],'shop':_0x60dbee['shop']};}async[a35_0x27b8ef(0xff)](_0xff8632,_0x11d0c0,_0x1da68a,_0x34a0c0){const _0x3e9f5e=a35_0x27b8ef,_0x1d30bf=await database_1[_0x3e9f5e(0x1fb)][_0x3e9f5e(0x1b0)](async _0x70a661=>{const _0x596e70=_0x3e9f5e,_0x2de7b5=await _0x70a661[_0x596e70(0x1d5)]['findUnique']({'where':{'id':_0xff8632},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2de7b5)throw new Error('Payment\x20not\x20found');const _0x249ee5=_0x2de7b5[_0x596e70(0x106)],_0x430b81=_0x11d0c0['toUpperCase']();console[_0x596e70(0x1fe)](_0x596e70(0x1ac)+_0xff8632+_0x596e70(0x1bb)+_0x249ee5+_0x596e70(0x167)+_0x430b81),console[_0x596e70(0x1fe)](_0x596e70(0x135)+_0x2de7b5['shop'][_0x596e70(0x1b7)]+_0x596e70(0x1ae));const _0x104906={'status':_0x430b81,'updatedAt':new Date(),'statusChangedBy':_0x596e70(0x189),'statusChangedAt':new Date()};_0x1da68a&&(_0x104906[_0x596e70(0x196)]=_0x1da68a);_0x430b81==='CHARGEBACK'&&_0x34a0c0&&(_0x104906[_0x596e70(0x17f)]=_0x34a0c0);let _0x5111ef=0x0,_0x64fdad=_0x2de7b5['shop'][_0x596e70(0x1b7)];if(_0x430b81===_0x596e70(0x118)&&_0x249ee5!=='PAID'){_0x104906[_0x596e70(0x1b8)]=new Date();const _0x3e6788=await currencyService_1['currencyService'][_0x596e70(0x176)](_0x2de7b5[_0x596e70(0x216)],_0x2de7b5[_0x596e70(0x1b6)]);_0x104906[_0x596e70(0x1fa)]=_0x3e6788;let _0x5949d1=0xa;const _0xf9c2a0=await _0x70a661[_0x596e70(0x163)][_0x596e70(0x204)]({'where':{'id':_0x2de7b5[_0x596e70(0x174)]},'select':{'gatewaySettings':!![]}});if(_0xf9c2a0?.['gatewaySettings'])try{const _0x84bf3a=JSON[_0x596e70(0x17b)](_0xf9c2a0[_0x596e70(0x17e)]);for(const [_0x24dea6,_0x33768f]of Object['entries'](_0x84bf3a)){if(_0x24dea6['toLowerCase']()===_0x2de7b5['gateway'][_0x596e70(0x1df)]()){_0x5949d1=_0x33768f[_0x596e70(0x10a)]||0xa;break;}}}catch(_0x42f4e4){console[_0x596e70(0x1a4)](_0x596e70(0x1d4)+_0xff8632+':',_0x42f4e4);}const _0x5b0af3=_0x3e6788*(0x1-_0x5949d1/0x64);_0x5111ef=_0x5b0af3,_0x64fdad+=_0x5b0af3,console[_0x596e70(0x1fe)](_0x596e70(0x14f)+_0xff8632+'\x20became\x20PAID:'),console[_0x596e70(0x1fe)](_0x596e70(0x170)+_0x3e6788['toFixed'](0x6)+_0x596e70(0x1ae)),console['log'](_0x596e70(0x171)+_0x2de7b5[_0x596e70(0x205)]+_0x596e70(0x193)+_0x5949d1+'%'),console['log'](_0x596e70(0x211)+_0x5b0af3[_0x596e70(0x14e)](0x6)+_0x596e70(0x1a2)+_0x5949d1+_0x596e70(0x14a)),console[_0x596e70(0x1fe)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x5b0af3[_0x596e70(0x14e)](0x6)+_0x596e70(0x1ae));}else{if(_0x249ee5==='PAID'&&_0x430b81!==_0x596e70(0x118)){if(_0x2de7b5[_0x596e70(0x1fa)]){let _0x41f7c1=0xa;const _0x6d6f0d=await _0x70a661[_0x596e70(0x163)][_0x596e70(0x204)]({'where':{'id':_0x2de7b5[_0x596e70(0x174)]},'select':{'gatewaySettings':!![]}});if(_0x6d6f0d?.[_0x596e70(0x17e)])try{const _0x128711=JSON[_0x596e70(0x17b)](_0x6d6f0d['gatewaySettings']);for(const [_0x3e0a11,_0x55d4cc]of Object['entries'](_0x128711)){if(_0x3e0a11[_0x596e70(0x1df)]()===_0x2de7b5[_0x596e70(0x205)]['toLowerCase']()){_0x41f7c1=_0x55d4cc['commission']||0xa;break;}}}catch(_0x202f27){console[_0x596e70(0x1a4)](_0x596e70(0x1d4)+_0xff8632+':',_0x202f27);}const _0x5171f2=_0x2de7b5[_0x596e70(0x1fa)]*(0x1-_0x41f7c1/0x64);_0x5111ef=-_0x5171f2,_0x64fdad-=_0x5171f2,_0x104906['amountUSDT']=null,console[_0x596e70(0x1fe)](_0x596e70(0x14f)+_0xff8632+_0x596e70(0x20d)),console['log'](_0x596e70(0x170)+_0x2de7b5[_0x596e70(0x1fa)][_0x596e70(0x14e)](0x6)+_0x596e70(0x1ae)),console['log'](_0x596e70(0x171)+_0x2de7b5[_0x596e70(0x205)]+_0x596e70(0x193)+_0x41f7c1+'%'),console['log'](_0x596e70(0x1a0)+_0x5171f2[_0x596e70(0x14e)](0x6)+_0x596e70(0x1a2)+_0x41f7c1+_0x596e70(0x14a)),console[_0x596e70(0x1fe)](_0x596e70(0x15e)+_0x5171f2[_0x596e70(0x14e)](0x6)+_0x596e70(0x1ae));}}}_0x430b81==='CHARGEBACK'&&(_0x249ee5==='PAID'&&_0x2de7b5[_0x596e70(0x1fa)]&&console[_0x596e70(0x1fe)](_0x596e70(0x112)),_0x34a0c0&&_0x34a0c0>0x0&&(_0x5111ef-=_0x34a0c0,_0x64fdad-=_0x34a0c0,console[_0x596e70(0x1fe)](_0x596e70(0x15b)+_0x34a0c0['toFixed'](0x6)+_0x596e70(0x111))));_0x430b81===_0x596e70(0x139)&&_0x249ee5===_0x596e70(0x118)&&console[_0x596e70(0x1fe)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x55dde1=await _0x70a661[_0x596e70(0x1d5)][_0x596e70(0x1ef)]({'where':{'id':_0xff8632},'data':_0x104906,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5111ef!==0x0&&(await _0x70a661[_0x596e70(0x163)][_0x596e70(0x1ef)]({'where':{'id':_0x2de7b5['shopId']},'data':{'balance':_0x64fdad}}),console['log'](_0x596e70(0x13f)+_0x2de7b5['shopId']+_0x596e70(0x180)+_0x2de7b5[_0x596e70(0x163)][_0x596e70(0x1b7)]['toFixed'](0x6)+_0x596e70(0x167)+_0x64fdad[_0x596e70(0x14e)](0x6)+_0x596e70(0x12d)+(_0x5111ef>0x0?'+':'')+_0x5111ef[_0x596e70(0x14e)](0x6)+')')),_0x55dde1;});return{'id':_0x1d30bf['id'],'shopId':_0x1d30bf['shopId'],'gateway':_0x1d30bf[_0x3e9f5e(0x205)],'amount':_0x1d30bf[_0x3e9f5e(0x216)],'currency':_0x1d30bf[_0x3e9f5e(0x1b6)],'status':_0x1d30bf[_0x3e9f5e(0x106)],'orderId':_0x1d30bf[_0x3e9f5e(0x20f)],'gatewayOrderId':_0x1d30bf[_0x3e9f5e(0x149)],'customerEmail':_0x1d30bf['customerEmail'],'customerName':_0x1d30bf[_0x3e9f5e(0x156)],'customerCountry':_0x1d30bf['customerCountry'],'customerIp':_0x1d30bf[_0x3e9f5e(0x173)],'customerUa':_0x1d30bf[_0x3e9f5e(0x158)],'failureMessage':_0x1d30bf[_0x3e9f5e(0x1da)],'adminNotes':_0x1d30bf[_0x3e9f5e(0x196)],'chargebackAmount':_0x1d30bf[_0x3e9f5e(0x17f)],'statusChangedBy':_0x1d30bf['statusChangedBy'],'statusChangedAt':_0x1d30bf['statusChangedAt'],'createdAt':_0x1d30bf[_0x3e9f5e(0x13c)],'updatedAt':_0x1d30bf[_0x3e9f5e(0x190)],'shop':_0x1d30bf[_0x3e9f5e(0x163)]};}async['updateUser'](_0x31ce1e,_0x33a36f){const _0x288eb7=a35_0x27b8ef,_0x5ec212={..._0x33a36f};_0x33a36f[_0x288eb7(0x1f4)]&&(_0x5ec212[_0x288eb7(0x1f4)]=await bcryptjs_1[_0x288eb7(0x1fb)]['hash'](_0x33a36f[_0x288eb7(0x1f4)],0xc));_0x33a36f[_0x288eb7(0x1bf)]&&(_0x5ec212['name']=_0x33a36f[_0x288eb7(0x1bf)],delete _0x5ec212[_0x288eb7(0x1bf)]);_0x33a36f[_0x288eb7(0x130)]&&(_0x5ec212[_0x288eb7(0x1f1)]=_0x33a36f[_0x288eb7(0x130)],delete _0x5ec212['telegramId']);_0x33a36f[_0x288eb7(0x213)]&&(_0x5ec212[_0x288eb7(0x182)]=_0x33a36f[_0x288eb7(0x213)],delete _0x5ec212['merchantUrl']);if(_0x33a36f[_0x288eb7(0x128)]){const _0x121c06=_0x33a36f['gateways']['map'](_0x1aba51=>this[_0x288eb7(0x1bc)](_0x1aba51));console[_0x288eb7(0x1fe)](_0x288eb7(0x1e4),_0x33a36f[_0x288eb7(0x128)],'->',_0x121c06),_0x5ec212['paymentGateways']=JSON[_0x288eb7(0x169)](_0x121c06),delete _0x5ec212['gateways'];}_0x33a36f[_0x288eb7(0x17e)]&&(_0x5ec212[_0x288eb7(0x17e)]=JSON[_0x288eb7(0x169)](_0x33a36f[_0x288eb7(0x17e)]),delete _0x5ec212[_0x288eb7(0x17e)]);_0x33a36f[_0x288eb7(0x1de)]&&(_0x33a36f[_0x288eb7(0x1de)][_0x288eb7(0x1a3)]!==undefined&&(_0x5ec212['usdtPolygonWallet']=_0x33a36f[_0x288eb7(0x1de)][_0x288eb7(0x1a3)]||null),_0x33a36f[_0x288eb7(0x1de)][_0x288eb7(0x123)]!==undefined&&(_0x5ec212[_0x288eb7(0x123)]=_0x33a36f[_0x288eb7(0x1de)][_0x288eb7(0x123)]||null),_0x33a36f[_0x288eb7(0x1de)][_0x288eb7(0x11a)]!==undefined&&(_0x5ec212[_0x288eb7(0x11a)]=_0x33a36f['wallets'][_0x288eb7(0x11a)]||null),_0x33a36f[_0x288eb7(0x1de)]['usdcPolygonWallet']!==undefined&&(_0x5ec212[_0x288eb7(0x175)]=_0x33a36f[_0x288eb7(0x1de)]['usdcPolygonWallet']||null),delete _0x5ec212[_0x288eb7(0x1de)]);const _0x388460=await database_1[_0x288eb7(0x1fb)]['shop'][_0x288eb7(0x1ef)]({'where':{'id':_0x31ce1e},'data':_0x5ec212,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x388460['id'],'fullName':_0x388460[_0x288eb7(0x16f)],'username':_0x388460[_0x288eb7(0x1e3)],'telegramId':_0x388460[_0x288eb7(0x1f1)],'merchantUrl':_0x388460['shopUrl'],'gateways':_0x388460[_0x288eb7(0x154)]?JSON[_0x288eb7(0x17b)](_0x388460[_0x288eb7(0x154)]):null,'gatewaySettings':_0x388460['gatewaySettings']?JSON[_0x288eb7(0x17b)](_0x388460[_0x288eb7(0x17e)]):null,'publicKey':_0x388460[_0x288eb7(0x1b2)],'wallets':{'usdtPolygonWallet':_0x388460[_0x288eb7(0x1a3)],'usdtTrcWallet':_0x388460[_0x288eb7(0x123)],'usdtErcWallet':_0x388460['usdtErcWallet'],'usdcPolygonWallet':_0x388460[_0x288eb7(0x175)]},'status':_0x388460['status'],'createdAt':_0x388460['createdAt']};}async[a35_0x27b8ef(0x11e)](_0x3bfab2){const _0x11f38e=a35_0x27b8ef,_0x373d2a=await database_1[_0x11f38e(0x1fb)][_0x11f38e(0x163)][_0x11f38e(0x1ef)]({'where':{'id':_0x3bfab2},'data':{'status':_0x11f38e(0x1cf)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x373d2a['id'],'fullName':_0x373d2a[_0x11f38e(0x16f)],'username':_0x373d2a[_0x11f38e(0x1e3)],'telegramId':_0x373d2a[_0x11f38e(0x1f1)],'merchantUrl':_0x373d2a['shopUrl'],'gateways':_0x373d2a[_0x11f38e(0x154)]?JSON[_0x11f38e(0x17b)](_0x373d2a[_0x11f38e(0x154)]):null,'gatewaySettings':_0x373d2a[_0x11f38e(0x17e)]?JSON[_0x11f38e(0x17b)](_0x373d2a[_0x11f38e(0x17e)]):null,'publicKey':_0x373d2a[_0x11f38e(0x1b2)],'wallets':{'usdtPolygonWallet':_0x373d2a[_0x11f38e(0x1a3)],'usdtTrcWallet':_0x373d2a[_0x11f38e(0x123)],'usdtErcWallet':_0x373d2a[_0x11f38e(0x11a)],'usdcPolygonWallet':_0x373d2a[_0x11f38e(0x175)]},'status':_0x373d2a['status'],'createdAt':_0x373d2a[_0x11f38e(0x13c)]};}async['activateUser'](_0x299618){const _0x59b386=a35_0x27b8ef,_0x4f7dec=await database_1['default'][_0x59b386(0x163)][_0x59b386(0x1ef)]({'where':{'id':_0x299618},'data':{'status':_0x59b386(0x15a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4f7dec['id'],'fullName':_0x4f7dec[_0x59b386(0x16f)],'username':_0x4f7dec[_0x59b386(0x1e3)],'telegramId':_0x4f7dec['telegram'],'merchantUrl':_0x4f7dec['shopUrl'],'gateways':_0x4f7dec[_0x59b386(0x154)]?JSON[_0x59b386(0x17b)](_0x4f7dec[_0x59b386(0x154)]):null,'gatewaySettings':_0x4f7dec[_0x59b386(0x17e)]?JSON[_0x59b386(0x17b)](_0x4f7dec[_0x59b386(0x17e)]):null,'publicKey':_0x4f7dec['publicKey'],'wallets':{'usdtPolygonWallet':_0x4f7dec[_0x59b386(0x1a3)],'usdtTrcWallet':_0x4f7dec[_0x59b386(0x123)],'usdtErcWallet':_0x4f7dec[_0x59b386(0x11a)],'usdcPolygonWallet':_0x4f7dec[_0x59b386(0x175)]},'status':_0x4f7dec[_0x59b386(0x106)],'createdAt':_0x4f7dec[_0x59b386(0x13c)]};}async[a35_0x27b8ef(0x210)](_0x2a019e){const _0x287d8b=a35_0x27b8ef,{page:_0x168e65,limit:_0x4d7fbb,status:_0x2b7070}=_0x2a019e,_0x356ddb=(_0x168e65-0x1)*_0x4d7fbb,_0x4f02fd={};_0x2b7070&&(_0x4f02fd[_0x287d8b(0x106)]=_0x2b7070['toUpperCase']());const [_0x49834b,_0x2412bb]=await Promise[_0x287d8b(0x12c)]([database_1[_0x287d8b(0x1fb)][_0x287d8b(0x163)]['findMany']({'where':_0x4f02fd,'skip':_0x356ddb,'take':_0x4d7fbb,'orderBy':{'createdAt':_0x287d8b(0x1d6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop']['count']({'where':_0x4f02fd})]);return{'users':_0x49834b[_0x287d8b(0x192)](_0x2c5beb=>{const _0xf0b18=_0x287d8b,_0xa48b8e=_0x2c5beb['paymentGateways']?JSON[_0xf0b18(0x17b)](_0x2c5beb[_0xf0b18(0x154)]):null,_0x3189aa=_0xa48b8e?_0xa48b8e['map'](_0x37a460=>this[_0xf0b18(0x194)](_0x37a460)):null;return{'id':_0x2c5beb['id'],'fullName':_0x2c5beb[_0xf0b18(0x16f)],'username':_0x2c5beb[_0xf0b18(0x1e3)],'telegramId':_0x2c5beb[_0xf0b18(0x1f1)],'merchantUrl':_0x2c5beb[_0xf0b18(0x182)],'gateways':_0x3189aa,'gatewaySettings':_0x2c5beb['gatewaySettings']?JSON['parse'](_0x2c5beb[_0xf0b18(0x17e)]):null,'publicKey':_0x2c5beb[_0xf0b18(0x1b2)],'wallets':{'usdtPolygonWallet':_0x2c5beb[_0xf0b18(0x1a3)],'usdtTrcWallet':_0x2c5beb[_0xf0b18(0x123)],'usdtErcWallet':_0x2c5beb['usdtErcWallet'],'usdcPolygonWallet':_0x2c5beb['usdcPolygonWallet']},'status':_0x2c5beb[_0xf0b18(0x106)],'createdAt':_0x2c5beb[_0xf0b18(0x13c)]};}),'pagination':{'page':_0x168e65,'limit':_0x4d7fbb,'total':_0x2412bb,'totalPages':Math[_0x287d8b(0x100)](_0x2412bb/_0x4d7fbb)}};}async[a35_0x27b8ef(0x1dc)](_0x19e522){const _0x20e37c=a35_0x27b8ef,_0x17f964=await database_1[_0x20e37c(0x1fb)][_0x20e37c(0x163)][_0x20e37c(0x204)]({'where':{'id':_0x19e522},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x17f964)return null;const _0x5511a5=_0x17f964[_0x20e37c(0x154)]?JSON[_0x20e37c(0x17b)](_0x17f964[_0x20e37c(0x154)]):null,_0x2c6597=_0x5511a5?_0x5511a5[_0x20e37c(0x192)](_0x359db8=>this[_0x20e37c(0x194)](_0x359db8)):null;return _0x5511a5&&_0x2c6597&&console[_0x20e37c(0x1fe)](_0x20e37c(0x132),_0x5511a5,'->',_0x2c6597),{'id':_0x17f964['id'],'fullName':_0x17f964[_0x20e37c(0x16f)],'username':_0x17f964[_0x20e37c(0x1e3)],'telegramId':_0x17f964[_0x20e37c(0x1f1)],'merchantUrl':_0x17f964[_0x20e37c(0x182)],'gateways':_0x2c6597,'gatewaySettings':_0x17f964[_0x20e37c(0x17e)]?JSON['parse'](_0x17f964[_0x20e37c(0x17e)]):null,'publicKey':_0x17f964[_0x20e37c(0x1b2)],'wallets':{'usdtPolygonWallet':_0x17f964[_0x20e37c(0x1a3)],'usdtTrcWallet':_0x17f964[_0x20e37c(0x123)],'usdtErcWallet':_0x17f964[_0x20e37c(0x11a)],'usdcPolygonWallet':_0x17f964[_0x20e37c(0x175)]},'status':_0x17f964['status'],'createdAt':_0x17f964[_0x20e37c(0x13c)]};}async[a35_0x27b8ef(0x14d)](_0x5e3acf){const _0x9442e=a35_0x27b8ef,{fullName:_0x2c8407,username:_0x3ce02b,password:_0x3a887b,telegramId:_0x45cfcb,merchantUrl:_0x16c186,gateways:_0x1b94db,gatewaySettings:_0x13f325,wallets:_0x102c3d}=_0x5e3acf,_0x5e6c54=await database_1[_0x9442e(0x1fb)][_0x9442e(0x163)][_0x9442e(0x204)]({'where':{'username':_0x3ce02b}});if(_0x5e6c54)throw new Error(_0x9442e(0x1a8));if(_0x45cfcb){const _0x55d50c=await database_1[_0x9442e(0x1fb)][_0x9442e(0x163)]['findUnique']({'where':{'telegram':_0x45cfcb}});if(_0x55d50c)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x368855=await bcryptjs_1[_0x9442e(0x1fb)][_0x9442e(0xfb)](_0x3a887b,0xc),_0x2b9bf2=_0x9442e(0x1f8)+crypto_1[_0x9442e(0x1fb)]['randomBytes'](0x20)[_0x9442e(0x1d0)](_0x9442e(0x21a)),_0xa43716=_0x9442e(0x125)+crypto_1[_0x9442e(0x1fb)][_0x9442e(0x1c1)](0x20)[_0x9442e(0x1d0)]('hex'),_0x1218c2=_0x1b94db?_0x1b94db[_0x9442e(0x192)](_0x48e93d=>this[_0x9442e(0x1bc)](_0x48e93d)):null;_0x1b94db&&_0x1218c2&&console['log']('🔄\x20Gateway\x20mapping\x20(create):',_0x1b94db,'->',_0x1218c2);const _0x2c3dd8=await database_1[_0x9442e(0x1fb)][_0x9442e(0x163)]['create']({'data':{'name':_0x2c8407,'username':_0x3ce02b,'password':_0x368855,'telegram':_0x45cfcb,'shopUrl':_0x16c186,'paymentGateways':_0x1218c2?JSON[_0x9442e(0x169)](_0x1218c2):null,'gatewaySettings':_0x13f325?JSON['stringify'](_0x13f325):null,'usdtPolygonWallet':_0x102c3d?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x102c3d?.[_0x9442e(0x123)]||null,'usdtErcWallet':_0x102c3d?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x102c3d?.['usdcPolygonWallet']||null,'publicKey':_0x2b9bf2,'secretKey':_0xa43716,'status':_0x9442e(0x15a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2c3dd8['id'],'fullName':_0x2c3dd8[_0x9442e(0x16f)],'username':_0x2c3dd8[_0x9442e(0x1e3)],'telegramId':_0x2c3dd8[_0x9442e(0x1f1)],'merchantUrl':_0x2c3dd8['shopUrl'],'gateways':_0x2c3dd8[_0x9442e(0x154)]?JSON[_0x9442e(0x17b)](_0x2c3dd8[_0x9442e(0x154)]):null,'gatewaySettings':_0x2c3dd8['gatewaySettings']?JSON['parse'](_0x2c3dd8[_0x9442e(0x17e)]):null,'publicKey':_0x2c3dd8[_0x9442e(0x1b2)],'wallets':{'usdtPolygonWallet':_0x2c3dd8[_0x9442e(0x1a3)],'usdtTrcWallet':_0x2c3dd8[_0x9442e(0x123)],'usdtErcWallet':_0x2c3dd8[_0x9442e(0x11a)],'usdcPolygonWallet':_0x2c3dd8['usdcPolygonWallet']},'status':_0x2c3dd8['status'],'createdAt':_0x2c3dd8[_0x9442e(0x13c)]};}async[a35_0x27b8ef(0x1c7)](_0x253ba5){const _0x564c16=a35_0x27b8ef;await database_1[_0x564c16(0x1fb)][_0x564c16(0x163)][_0x564c16(0x159)]({'where':{'id':_0x253ba5}});}['generateDailyStatistics'](_0xb1a94b,_0x3f2b49,_0x1e54c8){const _0x161b68=a35_0x27b8ef,_0x49bf1d=new Map(),_0xd00c50=new Date(_0x3f2b49);while(_0xd00c50<=_0x1e54c8){const _0x54ca40=_0xd00c50[_0x161b68(0x1eb)]()[_0x161b68(0x14b)]('T')[0x0];_0x49bf1d[_0x161b68(0x122)](_0x54ca40,{'revenue':0x0,'count':0x0}),_0xd00c50[_0x161b68(0x105)](_0xd00c50[_0x161b68(0x1ce)]()+0x1);}for(const _0x1e7cf8 of _0xb1a94b){const _0x163303=_0x1e7cf8['createdAt'][_0x161b68(0x1eb)]()['split']('T')[0x0],_0xe8fd3e=_0x49bf1d['get'](_0x163303);_0xe8fd3e&&(_0xe8fd3e['count']+=0x1,_0x1e7cf8[_0x161b68(0x106)]==='PAID'&&(_0x1e7cf8[_0x161b68(0x1fa)]?_0xe8fd3e[_0x161b68(0x1b4)]+=_0x1e7cf8[_0x161b68(0x1fa)]:console[_0x161b68(0x1fe)]('⚠️\x20Payment\x20'+_0x1e7cf8['id']+_0x161b68(0x1e0))));}const _0x1bad1c=[],_0x1b2180=[];for(const [_0x1ac03c,_0x25cfa5]of _0x49bf1d){_0x1bad1c[_0x161b68(0x208)]({'date':_0x1ac03c,'amount':Math[_0x161b68(0x1f6)](_0x25cfa5[_0x161b68(0x1b4)]*0x64)/0x64}),_0x1b2180[_0x161b68(0x208)]({'date':_0x1ac03c,'count':_0x25cfa5[_0x161b68(0x10f)]});}return{'dailyRevenue':_0x1bad1c,'dailyPayments':_0x1b2180};}}exports[a35_0x27b8ef(0x126)]=AdminService;