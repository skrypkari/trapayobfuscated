'use strict';function a35_0x50c8(){const _0x582597=['defineProperty','toString','_count','AdminService','📊\x20Calculating\x20payout\x20statistics...','\x20\x20\x20💰\x20Total\x20payout:\x20','💰\x20Payment\x20','chargebackAmount','gte','\x20USDT\x20(total\x20merchant\x20balances)','string','custom','merchantEarningsUSDT','dateFrom','createPayout','\x20no\x20longer\x20PAID:\x20-','SUSPENDED','error','whiteUrl','\x20\x20\x20💰\x20Total\x20turnover:\x20','localeCompare','\x20became\x20PAID:\x20+','getFullYear','default','1233396VnWVCD','averageCommissionRate','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','amountUSDT','shop','10834096siTEfw','getGatewayDisplayName','\x20balance\x20updated:\x20','turnover','totalPayout','KLYME\x20EU','adminNotes','Plisio','turnoverUSDT','periodFrom','gatewaySettings','getMerchantsAwaitingPayout','paidOutUSDT','$transaction','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','findFirst','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','forEach','📊\x20Payout\x20statistics\x20calculated:','gatewayOrderId','fullName','getPaymentById','Telegram\x20username\x20already\x20exists','getPayoutStats','Insufficient\x20balance.\x20Available:\x20','hash','shopUrl','crypto','publicKey','totalTurnover','convertToUSDT','shopId','./currencyService','\x20USDT\x20(total\x20paid\x20to\x20merchants)','merchantEarnings','usdtTrcWallet','customerName','date','round','name','REFUND','orderId','network','log','5166728IhWOtA','\x20\x20\x20Balance:\x20','gateway','💰\x20Shop\x20','__esModule','\x20\x20\x20🌐\x20IP:\x20','merchantUrl','usdtErcWallet','getMerchantStatistics','\x20\x20\x20📅\x20This\x20month:\x20','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20USDT\x20from\x20balance','\x20to\x20','pendingUrl','Rapyd','set','getUserById','_sum','create','paidAt','suspendUser','insensitive','../config/database','findMany','successUrl','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','failUrl','30d','usdcPolygonWallet','updatePaymentStatus','usdtPolygonWallet','56Nafrcn','payment','randomBytes','customerIp','not\x20set','📅\x20Period:\x20','totalPayments','getAllPayouts','commissionUSDT','wallets','password','telegramId','\x20USDT','KLYME\x20DE','status','Payment\x20not\x20found','\x20USDT\x20(same\x20as\x20awaiting)','\x20USDT\x20(+','findUnique','\x20USDT)','amount','groupBy','parse','failureMessage','customerEmail','desc','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','thisMonth','\x20USDT\x20to\x20balance','3scLXKd','90d','62442LqDlgx','reduce','getAllUsers','all','month','\x20->\x20','currency','payout','💰\x20Found\x20','141415lSfShx','\x20balance\x20updated:','__importDefault','Error\x20processing\x20payment\x20','hex','customerUa','CHARGEBACK','period','username','toISOString','createdAt','update','statusChangedAt','dateTo','615862BLKClb','telegram','notes','ACTIVE','gatewayEarnings','🔄\x20Admin\x20updating\x20payment\x20','paymentGateways','\x20USDT\x20(-','stringify','\x20USDT\x20(','delete','getMonth','updateUser','sort','\x20\x20\x20Current\x20balance:\x20','toFixed','updateCustomerData','totalCommissionRate','gateways','PAID','week','lte','aggregate','getTime','\x20for\x20shop\x20','\x20USDT,\x20Requested:\x20','currencyService','test_gateway','\x20\x20\x20🌍\x20Country:\x20','\x20\x20\x20Payout\x20amount:\x20','txid','14972643paYVNJ','\x20\x20\x20Total\x20paid\x20out:\x20','map','\x20USDT\x20total','COMPLETED','balance','getSystemStatistics','asc','availableBalance','toUpperCase','paymentsCount','length','periodTo','ceil','totalPaidOut','updatedAt','commission','\x20paid\x20payments\x20for\x20analysis','count','\x20merchants\x20with\x20positive\x20balance','💸\x20CHARGEBACK\x20penalty:\x20-','bcryptjs','values','customerCountry'];a35_0x50c8=function(){return _0x582597;};return a35_0x50c8();}const a35_0x671f87=a35_0x3f8b;(function(_0x57b852,_0x544565){const _0x31c558=a35_0x3f8b,_0x12b0b7=_0x57b852();while(!![]){try{const _0x278ee8=-parseInt(_0x31c558(0x27f))/0x1+-parseInt(_0x31c558(0x1c1))/0x2*(-parseInt(_0x31c558(0x27d))/0x3)+-parseInt(_0x31c558(0x260))/0x4*(-parseInt(_0x31c558(0x288))/0x5)+-parseInt(_0x31c558(0x210))/0x6+parseInt(_0x31c558(0x241))/0x7+parseInt(_0x31c558(0x215))/0x8+-parseInt(_0x31c558(0x1e0))/0x9;if(_0x278ee8===_0x544565)break;else _0x12b0b7['push'](_0x12b0b7['shift']());}catch(_0xf8267b){_0x12b0b7['push'](_0x12b0b7['shift']());}}}(a35_0x50c8,0xd3170));function a35_0x3f8b(_0x421523,_0x1f9f70){const _0x50c872=a35_0x50c8();return a35_0x3f8b=function(_0x3f8b58,_0x3290c6){_0x3f8b58=_0x3f8b58-0x1bb;let _0x3fb8ca=_0x50c872[_0x3f8b58];return _0x3fb8ca;},a35_0x3f8b(_0x421523,_0x1f9f70);}var __importDefault=this&&this[a35_0x671f87(0x28a)]||function(_0x2971e9){const _0x1d8575=a35_0x671f87;return _0x2971e9&&_0x2971e9[_0x1d8575(0x245)]?_0x2971e9:{'default':_0x2971e9};};Object[a35_0x671f87(0x1f8)](exports,'__esModule',{'value':!![]}),exports[a35_0x671f87(0x1fb)]=void 0x0;const database_1=__importDefault(require(a35_0x671f87(0x257))),bcryptjs_1=__importDefault(require(a35_0x671f87(0x1f5))),crypto_1=__importDefault(require(a35_0x671f87(0x230))),currencyService_1=require(a35_0x671f87(0x235));class AdminService{async[a35_0x671f87(0x22c)](){const _0x52a0e9=a35_0x671f87;console['log'](_0x52a0e9(0x1fc));const _0x3ac089=await database_1['default']['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x52a0e9(0x1c4)}}),_0x220548=new Date(),_0x36e67b=new Date(_0x220548['getFullYear'](),_0x220548[_0x52a0e9(0x1cc)](),0x1),_0x3ea8b4=new Date(_0x220548[_0x52a0e9(0x20e)](),_0x220548['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5eb928=await database_1['default'][_0x52a0e9(0x286)][_0x52a0e9(0x1d7)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x36e67b,'lte':_0x3ea8b4},'status':_0x52a0e9(0x1e4)}}),_0x491d3f=_0x3ac089[_0x52a0e9(0x252)][_0x52a0e9(0x1ee)]||0x0,_0x2d92cc=_0x3ac089[_0x52a0e9(0x252)]['balance']||0x0,_0x198339=_0x5eb928[_0x52a0e9(0x252)][_0x52a0e9(0x274)]||0x0,_0x592257={'totalPayout':Math[_0x52a0e9(0x23b)](_0x491d3f*0x64)/0x64,'awaitingPayout':Math['round'](_0x2d92cc*0x64)/0x64,'thisMonth':Math[_0x52a0e9(0x23b)](_0x198339*0x64)/0x64,'availableBalance':Math[_0x52a0e9(0x23b)](_0x2d92cc*0x64)/0x64};return console['log'](_0x52a0e9(0x227)),console['log'](_0x52a0e9(0x1fd)+_0x592257[_0x52a0e9(0x219)]+_0x52a0e9(0x236)),console[_0x52a0e9(0x240)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x592257['awaitingPayout']+_0x52a0e9(0x201)),console[_0x52a0e9(0x240)](_0x52a0e9(0x24b)+_0x592257[_0x52a0e9(0x1e8)]+_0x52a0e9(0x270)),console[_0x52a0e9(0x240)](_0x52a0e9(0x24a)+_0x592257[_0x52a0e9(0x27b)]+_0x52a0e9(0x26c)),_0x592257;}async[a35_0x671f87(0x1d1)](_0x37d7eb,_0xf02350){const _0x4a7d8b=a35_0x671f87;console[_0x4a7d8b(0x240)](_0x4a7d8b(0x212)+_0x37d7eb+':',_0xf02350);const _0x2d044b=await database_1['default'][_0x4a7d8b(0x261)][_0x4a7d8b(0x272)]({'where':{'id':_0x37d7eb},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2d044b)throw new Error(_0x4a7d8b(0x26f));const _0x9dfbaf={};_0xf02350[_0x4a7d8b(0x1f7)]!==undefined&&(_0x9dfbaf[_0x4a7d8b(0x1f7)]=_0xf02350[_0x4a7d8b(0x1f7)]||null);_0xf02350[_0x4a7d8b(0x263)]!==undefined&&(_0x9dfbaf[_0x4a7d8b(0x263)]=_0xf02350[_0x4a7d8b(0x263)]||null);_0xf02350[_0x4a7d8b(0x28d)]!==undefined&&(_0x9dfbaf['customerUa']=_0xf02350[_0x4a7d8b(0x28d)]||null);const _0x2032d9=await database_1[_0x4a7d8b(0x20f)][_0x4a7d8b(0x261)][_0x4a7d8b(0x1be)]({'where':{'id':_0x37d7eb},'data':{..._0x9dfbaf,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x4a7d8b(0x240)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x37d7eb),console['log'](_0x4a7d8b(0x1dd)+_0x2d044b['customerCountry']+_0x4a7d8b(0x284)+_0x2032d9['customerCountry']),console[_0x4a7d8b(0x240)](_0x4a7d8b(0x246)+_0x2d044b['customerIp']+_0x4a7d8b(0x284)+_0x2032d9[_0x4a7d8b(0x263)]),console['log']('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x2d044b[_0x4a7d8b(0x28d)]?_0x4a7d8b(0x250):_0x4a7d8b(0x264))+_0x4a7d8b(0x284)+(_0x2032d9['customerUa']?_0x4a7d8b(0x250):'not\x20set')),_0x2032d9;}async[a35_0x671f87(0x1e6)](_0x2fad6c){const _0x1dd58d=a35_0x671f87,_0x289b9b=new Date();let _0x18e706;switch(_0x2fad6c){case'7d':_0x18e706=new Date(_0x289b9b[_0x1dd58d(0x1d8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1dd58d(0x25c):_0x18e706=new Date(_0x289b9b[_0x1dd58d(0x1d8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1dd58d(0x27e):_0x18e706=new Date(_0x289b9b[_0x1dd58d(0x1d8)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x18e706=new Date(_0x289b9b[_0x1dd58d(0x1d8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x46168d,_0x2183b1,_0x4b3d73,_0x5e98c8,_0x595909,_0x570fc8]=await Promise[_0x1dd58d(0x282)]([database_1['default'][_0x1dd58d(0x214)]['count'](),database_1['default'][_0x1dd58d(0x214)][_0x1dd58d(0x1f2)]({'where':{'status':_0x1dd58d(0x1c4)}}),database_1[_0x1dd58d(0x20f)][_0x1dd58d(0x261)][_0x1dd58d(0x1f2)]({'where':{'createdAt':{'gte':_0x18e706},'gateway':{'not':_0x1dd58d(0x1dc)}}}),database_1[_0x1dd58d(0x20f)][_0x1dd58d(0x261)][_0x1dd58d(0x1f2)]({'where':{'status':'PAID','createdAt':{'gte':_0x18e706},'gateway':{'not':_0x1dd58d(0x1dc)}}}),database_1[_0x1dd58d(0x20f)]['payment'][_0x1dd58d(0x258)]({'where':{'status':_0x1dd58d(0x1d4),'createdAt':{'gte':_0x18e706},'gateway':{'not':_0x1dd58d(0x1dc)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x1dd58d(0x20f)][_0x1dd58d(0x261)][_0x1dd58d(0x258)]({'where':{'gateway':{'not':_0x1dd58d(0x1dc)}},'take':0xa,'orderBy':{'createdAt':_0x1dd58d(0x279)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x3b4d18=0x0;for(const _0xc3cdee of _0x595909){const _0x3c3579=await currencyService_1[_0x1dd58d(0x1db)][_0x1dd58d(0x233)](_0xc3cdee[_0x1dd58d(0x274)],_0xc3cdee[_0x1dd58d(0x285)]);_0x3b4d18+=_0x3c3579;}const _0x5c795c=_0x4b3d73>0x0?_0x5e98c8/_0x4b3d73*0x64:0x0;return{'totalShops':_0x46168d,'activeShops':_0x2183b1,'totalPayments':_0x4b3d73,'successfulPayments':_0x5e98c8,'totalRevenue':Math[_0x1dd58d(0x23b)](_0x3b4d18*0x64)/0x64,'conversionRate':Math[_0x1dd58d(0x23b)](_0x5c795c*0x64)/0x64,'recentPayments':_0x570fc8['map'](_0x5db859=>({'id':_0x5db859['id'],'amount':_0x5db859['amount'],'currency':_0x5db859[_0x1dd58d(0x285)],'status':_0x5db859[_0x1dd58d(0x26e)],'gateway':_0x5db859[_0x1dd58d(0x243)],'shop':_0x5db859[_0x1dd58d(0x214)],'createdAt':_0x5db859[_0x1dd58d(0x1bd)]}))};}async[a35_0x671f87(0x249)](_0x5dadc5){const _0x433ef8=a35_0x671f87;console[_0x433ef8(0x240)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x5dadc5);let _0x29d45c,_0x18578d=new Date();if(_0x5dadc5[_0x433ef8(0x28f)]===_0x433ef8(0x203)&&_0x5dadc5[_0x433ef8(0x205)]&&_0x5dadc5[_0x433ef8(0x1c0)])_0x29d45c=new Date(_0x5dadc5[_0x433ef8(0x205)]),_0x18578d=new Date(_0x5dadc5[_0x433ef8(0x1c0)]);else{const _0x54a091=new Date();switch(_0x5dadc5['period']){case _0x433ef8(0x1d5):_0x29d45c=new Date(_0x54a091[_0x433ef8(0x1d8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x433ef8(0x283):_0x29d45c=new Date(_0x54a091[_0x433ef8(0x1d8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x29d45c=new Date(_0x54a091[_0x433ef8(0x1d8)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x433ef8(0x282):default:_0x29d45c=new Date('2020-01-01');break;}}console[_0x433ef8(0x240)](_0x433ef8(0x265)+_0x29d45c[_0x433ef8(0x1bc)]()+_0x433ef8(0x24d)+_0x18578d[_0x433ef8(0x1bc)]());const _0x104c0f={'status':_0x433ef8(0x1d4),'gateway':{'not':_0x433ef8(0x1dc)},'paidAt':{'gte':_0x29d45c,'lte':_0x18578d}};_0x5dadc5[_0x433ef8(0x234)]&&(_0x104c0f[_0x433ef8(0x234)]=_0x5dadc5[_0x433ef8(0x234)]);const _0x51c722=await database_1[_0x433ef8(0x20f)]['payment']['findMany']({'where':_0x104c0f,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x433ef8(0x240)](_0x433ef8(0x287)+_0x51c722[_0x433ef8(0x1eb)]+_0x433ef8(0x1f1));let _0x1e0ad0=0x0,_0x58debb=0x0,_0x3e2e48=0x0;const _0x610116={},_0x4a3dd1={},_0x37e011={};for(const _0x437eea of _0x51c722){try{const _0x55eb23=await currencyService_1[_0x433ef8(0x1db)][_0x433ef8(0x233)](_0x437eea['amount'],_0x437eea['currency']);let _0x4e0dbf={};if(_0x437eea[_0x433ef8(0x214)][_0x433ef8(0x21f)])try{_0x4e0dbf=JSON[_0x433ef8(0x276)](_0x437eea[_0x433ef8(0x214)][_0x433ef8(0x21f)]);}catch(_0x8f5870){console[_0x433ef8(0x209)](_0x433ef8(0x223)+_0x437eea[_0x433ef8(0x234)]+':',_0x8f5870);}const _0x4879fa=_0x4e0dbf[_0x433ef8(0x1f0)]||0xa,_0x587c02=_0x55eb23*(_0x4879fa/0x64),_0xa091e3=_0x55eb23-_0x587c02;_0x1e0ad0+=_0x55eb23,_0x58debb+=_0xa091e3,_0x3e2e48+=_0x587c02;!_0x610116[_0x437eea[_0x433ef8(0x243)]]&&(_0x610116[_0x437eea[_0x433ef8(0x243)]]={'gateway':_0x437eea[_0x433ef8(0x243)],'gatewayDisplayName':this[_0x433ef8(0x216)](_0x437eea[_0x433ef8(0x243)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x610116[_0x437eea[_0x433ef8(0x243)]]['paymentsCount']++,_0x610116[_0x437eea[_0x433ef8(0x243)]][_0x433ef8(0x21d)]+=_0x55eb23,_0x610116[_0x437eea[_0x433ef8(0x243)]][_0x433ef8(0x268)]+=_0x587c02,_0x610116[_0x437eea[_0x433ef8(0x243)]]['merchantEarningsUSDT']+=_0xa091e3,_0x610116[_0x437eea['gateway']][_0x433ef8(0x1d2)]+=_0x4879fa;!_0x5dadc5[_0x433ef8(0x234)]&&(!_0x4a3dd1[_0x437eea['shopId']]&&(_0x4a3dd1[_0x437eea[_0x433ef8(0x234)]]={'shopId':_0x437eea[_0x433ef8(0x234)],'shopName':_0x437eea['shop'][_0x433ef8(0x23c)],'shopUsername':_0x437eea[_0x433ef8(0x214)][_0x433ef8(0x1bb)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4a3dd1[_0x437eea[_0x433ef8(0x234)]][_0x433ef8(0x1ea)]++,_0x4a3dd1[_0x437eea[_0x433ef8(0x234)]][_0x433ef8(0x21d)]+=_0x55eb23,_0x4a3dd1[_0x437eea[_0x433ef8(0x234)]]['commissionUSDT']+=_0x587c02,_0x4a3dd1[_0x437eea[_0x433ef8(0x234)]][_0x433ef8(0x204)]+=_0xa091e3);const _0x1af0bc=_0x437eea[_0x433ef8(0x254)][_0x433ef8(0x1bc)]()['split']('T')[0x0];!_0x37e011[_0x1af0bc]&&(_0x37e011[_0x1af0bc]={'date':_0x1af0bc,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x37e011[_0x1af0bc]['turnover']+=_0x55eb23,_0x37e011[_0x1af0bc][_0x433ef8(0x237)]+=_0xa091e3,_0x37e011[_0x1af0bc][_0x433ef8(0x1c5)]+=_0x587c02,_0x37e011[_0x1af0bc]['paymentsCount']++;}catch(_0x3181a0){console[_0x433ef8(0x209)](_0x433ef8(0x28b)+_0x437eea['id']+':',_0x3181a0);}}Object[_0x433ef8(0x1f6)](_0x610116)[_0x433ef8(0x226)](_0xe42ee=>{const _0x478926=_0x433ef8;_0xe42ee[_0x478926(0x211)]=_0xe42ee[_0x478926(0x1ea)]>0x0?_0xe42ee[_0x478926(0x1d2)]/_0xe42ee[_0x478926(0x1ea)]:0x0,delete _0xe42ee['totalCommissionRate'];}),Object['values'](_0x4a3dd1)[_0x433ef8(0x226)](_0x40711d=>{const _0x3728e6=_0x433ef8;_0x40711d['averageCheckUSDT']=_0x40711d[_0x3728e6(0x1ea)]>0x0?_0x40711d[_0x3728e6(0x21d)]/_0x40711d['paymentsCount']:0x0;});let _0x234017=0x0;if(_0x5dadc5[_0x433ef8(0x234)]){const _0x1ccca3=await database_1['default']['payout'][_0x433ef8(0x258)]({'where':{'shopId':_0x5dadc5[_0x433ef8(0x234)],'status':_0x433ef8(0x1e4),'createdAt':{'gte':_0x29d45c,'lte':_0x18578d}},'select':{'amount':!![]}});_0x234017=_0x1ccca3[_0x433ef8(0x280)]((_0x4fb19a,_0x238be5)=>_0x4fb19a+_0x238be5[_0x433ef8(0x274)],0x0);}const _0x359384=_0x51c722[_0x433ef8(0x1eb)],_0x435ea5=_0x51c722[_0x433ef8(0x1eb)],_0x1af8b8=_0x359384>0x0?_0x1e0ad0/_0x359384:0x0,_0x47535a=0x64,_0x387a3d=Math[_0x433ef8(0x1ed)]((_0x18578d['getTime']()-_0x29d45c[_0x433ef8(0x1d8)]())/(0x3e8*0x3c*0x3c*0x18)),_0x13fbf0={'totalTurnover':Math['round'](_0x1e0ad0*0x64)/0x64,'merchantEarnings':Math[_0x433ef8(0x23b)](_0x58debb*0x64)/0x64,'gatewayEarnings':Math[_0x433ef8(0x23b)](_0x3e2e48*0x64)/0x64,'totalPaidOut':Math[_0x433ef8(0x23b)](_0x234017*0x64)/0x64,'averageCheck':Math[_0x433ef8(0x23b)](_0x1af8b8*0x64)/0x64,'totalPayments':_0x359384,'successfulPayments':_0x435ea5,'conversionRate':_0x47535a,'gatewayBreakdown':Object[_0x433ef8(0x1f6)](_0x610116)[_0x433ef8(0x1e2)](_0x39da73=>({..._0x39da73,'turnoverUSDT':Math[_0x433ef8(0x23b)](_0x39da73[_0x433ef8(0x21d)]*0x64)/0x64,'commissionUSDT':Math[_0x433ef8(0x23b)](_0x39da73[_0x433ef8(0x268)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x433ef8(0x23b)](_0x39da73[_0x433ef8(0x204)]*0x64)/0x64,'averageCommissionRate':Math[_0x433ef8(0x23b)](_0x39da73[_0x433ef8(0x211)]*0x64)/0x64})),'merchantBreakdown':_0x5dadc5[_0x433ef8(0x234)]?undefined:Object['values'](_0x4a3dd1)[_0x433ef8(0x1e2)](_0x5553b7=>({..._0x5553b7,'turnoverUSDT':Math[_0x433ef8(0x23b)](_0x5553b7[_0x433ef8(0x21d)]*0x64)/0x64,'commissionUSDT':Math[_0x433ef8(0x23b)](_0x5553b7['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x433ef8(0x23b)](_0x5553b7[_0x433ef8(0x204)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x5553b7[_0x433ef8(0x221)]*0x64)/0x64,'averageCheckUSDT':Math[_0x433ef8(0x23b)](_0x5553b7['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x433ef8(0x1f6)](_0x37e011)[_0x433ef8(0x1e2)](_0x193e6f=>({..._0x193e6f,'turnover':Math[_0x433ef8(0x23b)](_0x193e6f[_0x433ef8(0x218)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x193e6f[_0x433ef8(0x237)]*0x64)/0x64,'gatewayEarnings':Math[_0x433ef8(0x23b)](_0x193e6f['gatewayEarnings']*0x64)/0x64}))[_0x433ef8(0x1ce)]((_0x2ad493,_0xca2bc6)=>_0x2ad493[_0x433ef8(0x23a)][_0x433ef8(0x20c)](_0xca2bc6['date'])),'periodInfo':{'from':_0x29d45c,'to':_0x18578d,'periodType':_0x5dadc5[_0x433ef8(0x28f)]||'custom','daysCount':_0x387a3d}};return console[_0x433ef8(0x240)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x433ef8(0x240)](_0x433ef8(0x20b)+_0x13fbf0[_0x433ef8(0x232)]+'\x20USDT'),console[_0x433ef8(0x240)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x13fbf0[_0x433ef8(0x237)]+_0x433ef8(0x26c)),console[_0x433ef8(0x240)](_0x433ef8(0x25a)+_0x13fbf0[_0x433ef8(0x1c5)]+'\x20USDT'),console[_0x433ef8(0x240)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x13fbf0[_0x433ef8(0x266)]),_0x13fbf0;}[a35_0x671f87(0x216)](_0x52fe01){const _0x475954=a35_0x671f87,_0x573254={'test_gateway':'Test\x20Gateway','plisio':_0x475954(0x21c),'rapyd':_0x475954(0x24f),'noda':'Noda','cointopay':'CoinToPay','klyme_eu':_0x475954(0x21a),'klyme_gb':'KLYME\x20GB','klyme_de':_0x475954(0x26d)};return _0x573254[_0x52fe01]||_0x52fe01;}async[a35_0x671f87(0x220)](_0x472e41){const _0x2be9f8=a35_0x671f87,{page:_0x581329,limit:_0x47ce94,minAmount:_0x3892fa,search:_0x2c8fc7}=_0x472e41,_0x45dccc=(_0x581329-0x1)*_0x47ce94;console['log'](_0x2be9f8(0x225),_0x472e41);const _0x4651e0={'balance':{'gt':0x0},'status':_0x2be9f8(0x1c4)};_0x3892fa&&(_0x4651e0[_0x2be9f8(0x1e5)][_0x2be9f8(0x200)]=_0x3892fa);_0x2c8fc7&&(_0x4651e0['OR']=[{'name':{'contains':_0x2c8fc7,'mode':'insensitive'}},{'username':{'contains':_0x2c8fc7,'mode':_0x2be9f8(0x256)}}]);const [_0x3443ad,_0x31d8a8]=await Promise[_0x2be9f8(0x282)]([database_1[_0x2be9f8(0x20f)][_0x2be9f8(0x214)][_0x2be9f8(0x258)]({'where':_0x4651e0,'skip':_0x45dccc,'take':_0x47ce94,'orderBy':{'balance':_0x2be9f8(0x279)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x2be9f8(0x20f)][_0x2be9f8(0x214)][_0x2be9f8(0x1f2)]({'where':_0x4651e0})]);console['log'](_0x2be9f8(0x287)+_0x3443ad['length']+_0x2be9f8(0x1f3));const _0x35473f=await Promise[_0x2be9f8(0x282)](_0x3443ad['map'](async _0x422c2b=>{const _0x37efe0=_0x2be9f8,[_0x368814,_0x57b312,_0x53aae9]=await Promise[_0x37efe0(0x282)]([database_1[_0x37efe0(0x20f)][_0x37efe0(0x261)][_0x37efe0(0x1f2)]({'where':{'shopId':_0x422c2b['id'],'status':_0x37efe0(0x1d4),'amountUSDT':{'not':null}}}),database_1[_0x37efe0(0x20f)][_0x37efe0(0x261)][_0x37efe0(0x224)]({'where':{'shopId':_0x422c2b['id'],'status':_0x37efe0(0x1d4),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x37efe0(0x1e7)},'select':{'paidAt':!![]}}),database_1[_0x37efe0(0x20f)]['payment'][_0x37efe0(0x275)]({'by':[_0x37efe0(0x243)],'where':{'shopId':_0x422c2b['id'],'status':_0x37efe0(0x1d4),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2fc304=_0x53aae9[_0x37efe0(0x1e2)](_0x40a0de=>({'gateway':_0x40a0de[_0x37efe0(0x243)],'count':_0x40a0de[_0x37efe0(0x1fa)]['id'],'amountUSDT':_0x40a0de[_0x37efe0(0x252)][_0x37efe0(0x213)]||0x0,'amountAfterCommissionUSDT':_0x40a0de[_0x37efe0(0x252)][_0x37efe0(0x213)]||0x0,'commission':0x0}));return{'id':_0x422c2b['id'],'fullName':_0x422c2b[_0x37efe0(0x23c)],'username':_0x422c2b['username'],'telegramId':_0x422c2b[_0x37efe0(0x1c2)],'merchantUrl':_0x422c2b[_0x37efe0(0x22f)],'wallets':{'usdtPolygonWallet':_0x422c2b[_0x37efe0(0x25f)],'usdtTrcWallet':_0x422c2b[_0x37efe0(0x238)],'usdtErcWallet':_0x422c2b[_0x37efe0(0x248)],'usdcPolygonWallet':_0x422c2b[_0x37efe0(0x25d)]},'totalAmountUSDT':_0x422c2b[_0x37efe0(0x1e5)],'totalAmountAfterCommissionUSDT':_0x422c2b['balance'],'paymentsCount':_0x368814,'oldestPaymentDate':_0x57b312?.[_0x37efe0(0x254)]||_0x422c2b['createdAt'],'gatewayBreakdown':_0x2fc304};})),_0x6ad948=_0x3443ad[_0x2be9f8(0x280)]((_0x19bac2,_0x34252f)=>_0x19bac2+_0x34252f[_0x2be9f8(0x1e5)],0x0),_0xe445b0=_0x6ad948;return console['log']('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x31d8a8+'\x20merchants,\x20'+Math[_0x2be9f8(0x23b)](_0xe445b0*0x64)/0x64+_0x2be9f8(0x1e3)),{'merchants':_0x35473f,'pagination':{'page':_0x581329,'limit':_0x47ce94,'total':_0x31d8a8,'totalPages':Math['ceil'](_0x31d8a8/_0x47ce94)},'summary':{'totalMerchants':_0x31d8a8,'totalAmountUSDT':Math[_0x2be9f8(0x23b)](_0x6ad948*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2be9f8(0x23b)](_0xe445b0*0x64)/0x64}};}async[a35_0x671f87(0x206)](_0xc240b8){const _0x1da068=a35_0x671f87,{shopId:_0x472860,amount:_0x17849b,network:_0x47da21,notes:_0x26253f,periodFrom:_0x136014,periodTo:_0xd9178}=_0xc240b8,_0x17bdc7=await database_1['default'][_0x1da068(0x222)](async _0x36f542=>{const _0x3c4a7b=_0x1da068,_0xd427a7=await _0x36f542[_0x3c4a7b(0x214)][_0x3c4a7b(0x272)]({'where':{'id':_0x472860},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xd427a7)throw new Error('Shop\x20not\x20found');console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0xd427a7[_0x3c4a7b(0x1bb)]+':'),console[_0x3c4a7b(0x240)](_0x3c4a7b(0x1cf)+_0xd427a7[_0x3c4a7b(0x1e5)][_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x26c)),console['log'](_0x3c4a7b(0x1de)+_0x17849b[_0x3c4a7b(0x1d0)](0x6)+'\x20USDT'),console[_0x3c4a7b(0x240)](_0x3c4a7b(0x27a)+_0xd427a7['totalPaidOut'][_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x26c));if(_0xd427a7['balance']<_0x17849b)throw new Error(_0x3c4a7b(0x22d)+_0xd427a7[_0x3c4a7b(0x1e5)][_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x1da)+_0x17849b[_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x26c));const _0x471d0e=await _0x36f542[_0x3c4a7b(0x286)][_0x3c4a7b(0x253)]({'data':{'shopId':_0x472860,'amount':_0x17849b,'network':_0x47da21,'status':_0x3c4a7b(0x1e4),'notes':_0x26253f,'periodFrom':_0x136014?new Date(_0x136014):null,'periodTo':_0xd9178?new Date(_0xd9178):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x5b5fc5=_0xd427a7[_0x3c4a7b(0x1e5)]-_0x17849b,_0xc685a9=_0xd427a7['totalPaidOut']+_0x17849b;return await _0x36f542[_0x3c4a7b(0x214)]['update']({'where':{'id':_0x472860},'data':{'balance':_0x5b5fc5,'totalPaidOut':_0xc685a9}}),console[_0x3c4a7b(0x240)]('💰\x20Shop\x20'+_0xd427a7[_0x3c4a7b(0x1bb)]+_0x3c4a7b(0x289)),console['log'](_0x3c4a7b(0x242)+_0xd427a7[_0x3c4a7b(0x1e5)][_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x284)+_0x5b5fc5[_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x1c8)+_0x17849b[_0x3c4a7b(0x1d0)](0x6)+')'),console[_0x3c4a7b(0x240)](_0x3c4a7b(0x1e1)+_0xd427a7[_0x3c4a7b(0x1ee)][_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x284)+_0xc685a9[_0x3c4a7b(0x1d0)](0x6)+_0x3c4a7b(0x271)+_0x17849b[_0x3c4a7b(0x1d0)](0x6)+')'),{'payout':_0x471d0e,'shop':_0xd427a7};});return console['log']('✅\x20Payout\x20created:\x20'+_0x17bdc7['payout']['id']+_0x1da068(0x1d9)+_0x17bdc7['shop'][_0x1da068(0x1bb)]+'\x20('+_0x17849b+_0x1da068(0x273)),{'id':_0x17bdc7['payout']['id'],'shopId':_0x17bdc7['payout'][_0x1da068(0x234)],'shopName':_0x17bdc7[_0x1da068(0x214)][_0x1da068(0x23c)],'shopUsername':_0x17bdc7['shop']['username'],'amount':_0x17bdc7[_0x1da068(0x286)]['amount'],'network':_0x17bdc7[_0x1da068(0x286)][_0x1da068(0x23f)],'status':_0x17bdc7[_0x1da068(0x286)][_0x1da068(0x26e)],'txid':_0x17bdc7[_0x1da068(0x286)]['txid'],'notes':_0x17bdc7[_0x1da068(0x286)][_0x1da068(0x1c3)],'periodFrom':_0x17bdc7[_0x1da068(0x286)][_0x1da068(0x21e)],'periodTo':_0x17bdc7[_0x1da068(0x286)][_0x1da068(0x1ec)],'createdAt':_0x17bdc7[_0x1da068(0x286)][_0x1da068(0x1bd)],'paidAt':_0x17bdc7[_0x1da068(0x286)]['paidAt']};}async[a35_0x671f87(0x267)](_0x289dae){const _0x538b72=a35_0x671f87,{page:_0x3073de,limit:_0x170d7a,shopId:_0x39b1ac,network:_0x4eafad,dateFrom:_0x27fa8d,dateTo:_0x3ce237,search:_0x216cdc}=_0x289dae,_0x5ba708=(_0x3073de-0x1)*_0x170d7a,_0x269e63={};_0x39b1ac&&(_0x269e63[_0x538b72(0x234)]=_0x39b1ac);_0x4eafad&&(_0x269e63[_0x538b72(0x23f)]=_0x4eafad);(_0x27fa8d||_0x3ce237)&&(_0x269e63[_0x538b72(0x1bd)]={},_0x27fa8d&&(_0x269e63[_0x538b72(0x1bd)][_0x538b72(0x200)]=new Date(_0x27fa8d)),_0x3ce237&&(_0x269e63['createdAt'][_0x538b72(0x1d6)]=new Date(_0x3ce237)));_0x216cdc&&(_0x269e63['OR']=[{'shop':{'name':{'contains':_0x216cdc,'mode':_0x538b72(0x256)}}},{'shop':{'username':{'contains':_0x216cdc,'mode':_0x538b72(0x256)}}},{'notes':{'contains':_0x216cdc,'mode':_0x538b72(0x256)}}]);const [_0x217684,_0x584077]=await Promise[_0x538b72(0x282)]([database_1['default'][_0x538b72(0x286)][_0x538b72(0x258)]({'where':_0x269e63,'skip':_0x5ba708,'take':_0x170d7a,'orderBy':{'createdAt':_0x538b72(0x279)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x538b72(0x286)]['count']({'where':_0x269e63})]);return{'payouts':_0x217684[_0x538b72(0x1e2)](_0x5c6e21=>({'id':_0x5c6e21['id'],'shopId':_0x5c6e21['shopId'],'shopName':_0x5c6e21[_0x538b72(0x214)]['name'],'shopUsername':_0x5c6e21[_0x538b72(0x214)][_0x538b72(0x1bb)],'amount':_0x5c6e21[_0x538b72(0x274)],'network':_0x5c6e21[_0x538b72(0x23f)],'status':_0x5c6e21[_0x538b72(0x26e)],'txid':_0x5c6e21[_0x538b72(0x1df)],'notes':_0x5c6e21[_0x538b72(0x1c3)],'periodFrom':_0x5c6e21[_0x538b72(0x21e)],'periodTo':_0x5c6e21[_0x538b72(0x1ec)],'createdAt':_0x5c6e21[_0x538b72(0x1bd)],'paidAt':_0x5c6e21[_0x538b72(0x254)]})),'pagination':{'page':_0x3073de,'limit':_0x170d7a,'total':_0x584077,'totalPages':Math[_0x538b72(0x1ed)](_0x584077/_0x170d7a)}};}async['getPayoutById'](_0xf76325){const _0x359172=a35_0x671f87,_0x27299f=await database_1[_0x359172(0x20f)][_0x359172(0x286)][_0x359172(0x272)]({'where':{'id':_0xf76325},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x27299f)return null;return{'id':_0x27299f['id'],'shopId':_0x27299f[_0x359172(0x234)],'shopName':_0x27299f['shop']['name'],'shopUsername':_0x27299f[_0x359172(0x214)][_0x359172(0x1bb)],'amount':_0x27299f[_0x359172(0x274)],'network':_0x27299f[_0x359172(0x23f)],'status':_0x27299f[_0x359172(0x26e)],'txid':_0x27299f[_0x359172(0x1df)],'notes':_0x27299f[_0x359172(0x1c3)],'periodFrom':_0x27299f[_0x359172(0x21e)],'periodTo':_0x27299f[_0x359172(0x1ec)],'createdAt':_0x27299f['createdAt'],'paidAt':_0x27299f[_0x359172(0x254)]};}async['deletePayout'](_0x5017fa){const _0x3c82bb=a35_0x671f87;await database_1[_0x3c82bb(0x20f)][_0x3c82bb(0x286)][_0x3c82bb(0x1cb)]({'where':{'id':_0x5017fa}});}async['getAllPayments'](_0x35a164){const _0x5a713c=a35_0x671f87,{page:_0x29947d,limit:_0x1a5433,status:_0x59828d,gateway:_0x2cda06,shopId:_0x3edf69,dateFrom:_0x5df7e1,dateTo:_0x45bf70,search:_0x531c4f}=_0x35a164,_0x3cc5aa=(_0x29947d-0x1)*_0x1a5433,_0x4b2fce={};_0x59828d&&(_0x4b2fce[_0x5a713c(0x26e)]=_0x59828d[_0x5a713c(0x1e9)]());_0x2cda06&&(_0x4b2fce['gateway']=_0x2cda06['toLowerCase']());_0x4b2fce[_0x5a713c(0x243)]=_0x4b2fce[_0x5a713c(0x243)]?_0x4b2fce[_0x5a713c(0x243)]:{'not':_0x5a713c(0x1dc)};if(typeof _0x4b2fce[_0x5a713c(0x243)]===_0x5a713c(0x202)&&_0x4b2fce[_0x5a713c(0x243)]!=='test_gateway'){}else{if(typeof _0x4b2fce[_0x5a713c(0x243)]===_0x5a713c(0x202)&&_0x4b2fce[_0x5a713c(0x243)]==='test_gateway'){}else _0x4b2fce[_0x5a713c(0x243)]={'not':_0x5a713c(0x1dc)};}_0x3edf69&&(_0x4b2fce[_0x5a713c(0x234)]=_0x3edf69);(_0x5df7e1||_0x45bf70)&&(_0x4b2fce[_0x5a713c(0x1bd)]={},_0x5df7e1&&(_0x4b2fce[_0x5a713c(0x1bd)][_0x5a713c(0x200)]=new Date(_0x5df7e1)),_0x45bf70&&(_0x4b2fce[_0x5a713c(0x1bd)][_0x5a713c(0x1d6)]=new Date(_0x45bf70)));_0x531c4f&&(_0x4b2fce['OR']=[{'orderId':{'contains':_0x531c4f,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x531c4f,'mode':_0x5a713c(0x256)}},{'customerEmail':{'contains':_0x531c4f,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x531c4f,'mode':_0x5a713c(0x256)}}},{'shop':{'username':{'contains':_0x531c4f,'mode':_0x5a713c(0x256)}}}]);const [_0xedf686,_0x11dd59]=await Promise['all']([database_1['default'][_0x5a713c(0x261)]['findMany']({'where':_0x4b2fce,'skip':_0x3cc5aa,'take':_0x1a5433,'orderBy':{'createdAt':_0x5a713c(0x279)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x5a713c(0x1f2)]({'where':_0x4b2fce})]);return{'payments':_0xedf686[_0x5a713c(0x1e2)](_0x3b363d=>({'id':_0x3b363d['id'],'shopId':_0x3b363d[_0x5a713c(0x234)],'gateway':_0x3b363d[_0x5a713c(0x243)],'amount':_0x3b363d['amount'],'currency':_0x3b363d[_0x5a713c(0x285)],'status':_0x3b363d[_0x5a713c(0x26e)],'orderId':_0x3b363d[_0x5a713c(0x23e)],'gatewayOrderId':_0x3b363d[_0x5a713c(0x228)],'customerEmail':_0x3b363d['customerEmail'],'customerName':_0x3b363d['customerName'],'customerCountry':_0x3b363d['customerCountry'],'customerIp':_0x3b363d[_0x5a713c(0x263)],'customerUa':_0x3b363d[_0x5a713c(0x28d)],'failureMessage':_0x3b363d['failureMessage'],'createdAt':_0x3b363d[_0x5a713c(0x1bd)],'updatedAt':_0x3b363d[_0x5a713c(0x1ef)],'shop':_0x3b363d[_0x5a713c(0x214)]})),'pagination':{'page':_0x29947d,'limit':_0x1a5433,'total':_0x11dd59,'totalPages':Math[_0x5a713c(0x1ed)](_0x11dd59/_0x1a5433)}};}async[a35_0x671f87(0x22a)](_0x11ecc0){const _0x41a236=a35_0x671f87,_0x464710=await database_1[_0x41a236(0x20f)][_0x41a236(0x261)][_0x41a236(0x272)]({'where':{'id':_0x11ecc0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x464710)return null;return{'id':_0x464710['id'],'shopId':_0x464710['shopId'],'gateway':_0x464710[_0x41a236(0x243)],'amount':_0x464710[_0x41a236(0x274)],'currency':_0x464710[_0x41a236(0x285)],'status':_0x464710[_0x41a236(0x26e)],'orderId':_0x464710[_0x41a236(0x23e)],'gatewayOrderId':_0x464710[_0x41a236(0x228)],'customerEmail':_0x464710[_0x41a236(0x278)],'customerName':_0x464710[_0x41a236(0x239)],'customerCountry':_0x464710[_0x41a236(0x1f7)],'customerIp':_0x464710[_0x41a236(0x263)],'customerUa':_0x464710[_0x41a236(0x28d)],'failureMessage':_0x464710[_0x41a236(0x277)],'externalPaymentUrl':_0x464710['externalPaymentUrl'],'successUrl':_0x464710[_0x41a236(0x259)],'failUrl':_0x464710[_0x41a236(0x25b)],'pendingUrl':_0x464710[_0x41a236(0x24e)],'whiteUrl':_0x464710[_0x41a236(0x20a)],'createdAt':_0x464710[_0x41a236(0x1bd)],'updatedAt':_0x464710[_0x41a236(0x1ef)],'shop':_0x464710[_0x41a236(0x214)]};}async[a35_0x671f87(0x25e)](_0x543595,_0x4b8a29,_0x239486,_0x481713){const _0x53b650=a35_0x671f87,_0x33f412=await database_1[_0x53b650(0x20f)][_0x53b650(0x222)](async _0xb5c0d6=>{const _0x233bbd=_0x53b650,_0x15407b=await _0xb5c0d6['payment'][_0x233bbd(0x272)]({'where':{'id':_0x543595},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x15407b)throw new Error(_0x233bbd(0x26f));const _0x182fe5=_0x15407b[_0x233bbd(0x26e)],_0x4cc935=_0x4b8a29['toUpperCase']();console[_0x233bbd(0x240)](_0x233bbd(0x1c6)+_0x543595+'\x20status:\x20'+_0x182fe5+_0x233bbd(0x284)+_0x4cc935),console[_0x233bbd(0x240)]('💰\x20Current\x20shop\x20balance:\x20'+_0x15407b[_0x233bbd(0x214)][_0x233bbd(0x1e5)]+_0x233bbd(0x26c));const _0x1b45d6={'status':_0x4cc935,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x239486&&(_0x1b45d6[_0x233bbd(0x21b)]=_0x239486);_0x4cc935===_0x233bbd(0x28e)&&_0x481713&&(_0x1b45d6[_0x233bbd(0x1ff)]=_0x481713);let _0xa9c80=0x0,_0x4b99bb=_0x15407b['shop'][_0x233bbd(0x1e5)];if(_0x4cc935===_0x233bbd(0x1d4)&&_0x182fe5!==_0x233bbd(0x1d4)){_0x1b45d6[_0x233bbd(0x254)]=new Date();const _0x55ed13=await currencyService_1[_0x233bbd(0x1db)][_0x233bbd(0x233)](_0x15407b[_0x233bbd(0x274)],_0x15407b[_0x233bbd(0x285)]);_0x1b45d6['amountUSDT']=_0x55ed13,_0xa9c80=_0x55ed13,_0x4b99bb+=_0x55ed13,console[_0x233bbd(0x240)]('💰\x20Payment\x20'+_0x543595+_0x233bbd(0x20d)+_0x55ed13[_0x233bbd(0x1d0)](0x6)+_0x233bbd(0x27c));}else _0x182fe5===_0x233bbd(0x1d4)&&_0x4cc935!==_0x233bbd(0x1d4)&&(_0x15407b[_0x233bbd(0x213)]&&(_0xa9c80=-_0x15407b[_0x233bbd(0x213)],_0x4b99bb-=_0x15407b[_0x233bbd(0x213)],_0x1b45d6[_0x233bbd(0x213)]=null,console[_0x233bbd(0x240)](_0x233bbd(0x1fe)+_0x543595+_0x233bbd(0x207)+_0x15407b[_0x233bbd(0x213)][_0x233bbd(0x1d0)](0x6)+_0x233bbd(0x24c))));if(_0x4cc935===_0x233bbd(0x28e)){if(_0x182fe5===_0x233bbd(0x1d4)&&_0x15407b[_0x233bbd(0x213)]){}_0x481713&&_0x481713>0x0&&(_0xa9c80-=_0x481713,_0x4b99bb-=_0x481713,console['log'](_0x233bbd(0x1f4)+_0x481713[_0x233bbd(0x1d0)](0x6)+_0x233bbd(0x24c)));}_0x4cc935===_0x233bbd(0x23d)&&_0x182fe5==='PAID'&&console[_0x233bbd(0x240)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x3a3804=await _0xb5c0d6[_0x233bbd(0x261)]['update']({'where':{'id':_0x543595},'data':_0x1b45d6,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xa9c80!==0x0&&(await _0xb5c0d6[_0x233bbd(0x214)][_0x233bbd(0x1be)]({'where':{'id':_0x15407b[_0x233bbd(0x234)]},'data':{'balance':_0x4b99bb}}),console[_0x233bbd(0x240)](_0x233bbd(0x244)+_0x15407b[_0x233bbd(0x234)]+_0x233bbd(0x217)+_0x15407b['shop'][_0x233bbd(0x1e5)]['toFixed'](0x6)+'\x20->\x20'+_0x4b99bb[_0x233bbd(0x1d0)](0x6)+_0x233bbd(0x1ca)+(_0xa9c80>0x0?'+':'')+_0xa9c80[_0x233bbd(0x1d0)](0x6)+')')),_0x3a3804;});return{'id':_0x33f412['id'],'shopId':_0x33f412[_0x53b650(0x234)],'gateway':_0x33f412['gateway'],'amount':_0x33f412['amount'],'currency':_0x33f412[_0x53b650(0x285)],'status':_0x33f412[_0x53b650(0x26e)],'orderId':_0x33f412[_0x53b650(0x23e)],'gatewayOrderId':_0x33f412[_0x53b650(0x228)],'customerEmail':_0x33f412[_0x53b650(0x278)],'customerName':_0x33f412[_0x53b650(0x239)],'customerCountry':_0x33f412[_0x53b650(0x1f7)],'customerIp':_0x33f412[_0x53b650(0x263)],'customerUa':_0x33f412[_0x53b650(0x28d)],'failureMessage':_0x33f412[_0x53b650(0x277)],'adminNotes':_0x33f412[_0x53b650(0x21b)],'chargebackAmount':_0x33f412[_0x53b650(0x1ff)],'statusChangedBy':_0x33f412['statusChangedBy'],'statusChangedAt':_0x33f412[_0x53b650(0x1bf)],'createdAt':_0x33f412[_0x53b650(0x1bd)],'updatedAt':_0x33f412[_0x53b650(0x1ef)],'shop':_0x33f412[_0x53b650(0x214)]};}async[a35_0x671f87(0x1cd)](_0x1069d4,_0x3c6340){const _0x18d5f3=a35_0x671f87,_0x44ea61={..._0x3c6340};_0x3c6340[_0x18d5f3(0x26a)]&&(_0x44ea61[_0x18d5f3(0x26a)]=await bcryptjs_1[_0x18d5f3(0x20f)]['hash'](_0x3c6340[_0x18d5f3(0x26a)],0xc));_0x3c6340[_0x18d5f3(0x229)]&&(_0x44ea61[_0x18d5f3(0x23c)]=_0x3c6340['fullName'],delete _0x44ea61['fullName']);_0x3c6340['telegramId']&&(_0x44ea61[_0x18d5f3(0x1c2)]=_0x3c6340['telegramId'],delete _0x44ea61[_0x18d5f3(0x26b)]);_0x3c6340['merchantUrl']&&(_0x44ea61[_0x18d5f3(0x22f)]=_0x3c6340[_0x18d5f3(0x247)],delete _0x44ea61[_0x18d5f3(0x247)]);_0x3c6340[_0x18d5f3(0x1d3)]&&(_0x44ea61[_0x18d5f3(0x1c7)]=JSON[_0x18d5f3(0x1c9)](_0x3c6340[_0x18d5f3(0x1d3)]),delete _0x44ea61[_0x18d5f3(0x1d3)]);_0x3c6340[_0x18d5f3(0x21f)]&&(_0x44ea61[_0x18d5f3(0x21f)]=JSON[_0x18d5f3(0x1c9)](_0x3c6340[_0x18d5f3(0x21f)]),delete _0x44ea61[_0x18d5f3(0x21f)]);_0x3c6340[_0x18d5f3(0x269)]&&(_0x3c6340['wallets']['usdtPolygonWallet']!==undefined&&(_0x44ea61[_0x18d5f3(0x25f)]=_0x3c6340['wallets'][_0x18d5f3(0x25f)]||null),_0x3c6340[_0x18d5f3(0x269)][_0x18d5f3(0x238)]!==undefined&&(_0x44ea61[_0x18d5f3(0x238)]=_0x3c6340[_0x18d5f3(0x269)][_0x18d5f3(0x238)]||null),_0x3c6340['wallets'][_0x18d5f3(0x248)]!==undefined&&(_0x44ea61[_0x18d5f3(0x248)]=_0x3c6340[_0x18d5f3(0x269)]['usdtErcWallet']||null),_0x3c6340[_0x18d5f3(0x269)][_0x18d5f3(0x25d)]!==undefined&&(_0x44ea61[_0x18d5f3(0x25d)]=_0x3c6340['wallets'][_0x18d5f3(0x25d)]||null),delete _0x44ea61[_0x18d5f3(0x269)]);const _0x4bb63a=await database_1['default'][_0x18d5f3(0x214)][_0x18d5f3(0x1be)]({'where':{'id':_0x1069d4},'data':_0x44ea61,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4bb63a['id'],'fullName':_0x4bb63a['name'],'username':_0x4bb63a['username'],'telegramId':_0x4bb63a[_0x18d5f3(0x1c2)],'merchantUrl':_0x4bb63a[_0x18d5f3(0x22f)],'gateways':_0x4bb63a[_0x18d5f3(0x1c7)]?JSON[_0x18d5f3(0x276)](_0x4bb63a['paymentGateways']):null,'gatewaySettings':_0x4bb63a['gatewaySettings']?JSON[_0x18d5f3(0x276)](_0x4bb63a[_0x18d5f3(0x21f)]):null,'publicKey':_0x4bb63a[_0x18d5f3(0x231)],'wallets':{'usdtPolygonWallet':_0x4bb63a[_0x18d5f3(0x25f)],'usdtTrcWallet':_0x4bb63a[_0x18d5f3(0x238)],'usdtErcWallet':_0x4bb63a[_0x18d5f3(0x248)],'usdcPolygonWallet':_0x4bb63a['usdcPolygonWallet']},'status':_0x4bb63a[_0x18d5f3(0x26e)],'createdAt':_0x4bb63a[_0x18d5f3(0x1bd)]};}async[a35_0x671f87(0x255)](_0x432edd){const _0x2016e5=a35_0x671f87,_0x37a189=await database_1['default'][_0x2016e5(0x214)][_0x2016e5(0x1be)]({'where':{'id':_0x432edd},'data':{'status':_0x2016e5(0x208)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x37a189['id'],'fullName':_0x37a189['name'],'username':_0x37a189[_0x2016e5(0x1bb)],'telegramId':_0x37a189[_0x2016e5(0x1c2)],'merchantUrl':_0x37a189[_0x2016e5(0x22f)],'gateways':_0x37a189[_0x2016e5(0x1c7)]?JSON[_0x2016e5(0x276)](_0x37a189[_0x2016e5(0x1c7)]):null,'gatewaySettings':_0x37a189[_0x2016e5(0x21f)]?JSON[_0x2016e5(0x276)](_0x37a189['gatewaySettings']):null,'publicKey':_0x37a189[_0x2016e5(0x231)],'wallets':{'usdtPolygonWallet':_0x37a189[_0x2016e5(0x25f)],'usdtTrcWallet':_0x37a189[_0x2016e5(0x238)],'usdtErcWallet':_0x37a189[_0x2016e5(0x248)],'usdcPolygonWallet':_0x37a189[_0x2016e5(0x25d)]},'status':_0x37a189[_0x2016e5(0x26e)],'createdAt':_0x37a189['createdAt']};}async['activateUser'](_0x1b1ffa){const _0x1c793b=a35_0x671f87,_0x55d11a=await database_1[_0x1c793b(0x20f)][_0x1c793b(0x214)][_0x1c793b(0x1be)]({'where':{'id':_0x1b1ffa},'data':{'status':_0x1c793b(0x1c4)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x55d11a['id'],'fullName':_0x55d11a[_0x1c793b(0x23c)],'username':_0x55d11a[_0x1c793b(0x1bb)],'telegramId':_0x55d11a[_0x1c793b(0x1c2)],'merchantUrl':_0x55d11a[_0x1c793b(0x22f)],'gateways':_0x55d11a[_0x1c793b(0x1c7)]?JSON['parse'](_0x55d11a[_0x1c793b(0x1c7)]):null,'gatewaySettings':_0x55d11a[_0x1c793b(0x21f)]?JSON[_0x1c793b(0x276)](_0x55d11a[_0x1c793b(0x21f)]):null,'publicKey':_0x55d11a['publicKey'],'wallets':{'usdtPolygonWallet':_0x55d11a[_0x1c793b(0x25f)],'usdtTrcWallet':_0x55d11a[_0x1c793b(0x238)],'usdtErcWallet':_0x55d11a['usdtErcWallet'],'usdcPolygonWallet':_0x55d11a[_0x1c793b(0x25d)]},'status':_0x55d11a['status'],'createdAt':_0x55d11a[_0x1c793b(0x1bd)]};}async[a35_0x671f87(0x281)](_0x1ee5f1){const _0x4f119e=a35_0x671f87,{page:_0x104dbd,limit:_0x526ff0,status:_0x12f6b9}=_0x1ee5f1,_0x20c480=(_0x104dbd-0x1)*_0x526ff0,_0x2fd3c2={};_0x12f6b9&&(_0x2fd3c2[_0x4f119e(0x26e)]=_0x12f6b9[_0x4f119e(0x1e9)]());const [_0x2e3005,_0x3939fc]=await Promise[_0x4f119e(0x282)]([database_1['default']['shop'][_0x4f119e(0x258)]({'where':_0x2fd3c2,'skip':_0x20c480,'take':_0x526ff0,'orderBy':{'createdAt':_0x4f119e(0x279)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x4f119e(0x1f2)]({'where':_0x2fd3c2})]);return{'users':_0x2e3005[_0x4f119e(0x1e2)](_0x226098=>({'id':_0x226098['id'],'fullName':_0x226098[_0x4f119e(0x23c)],'username':_0x226098[_0x4f119e(0x1bb)],'telegramId':_0x226098['telegram'],'merchantUrl':_0x226098['shopUrl'],'gateways':_0x226098['paymentGateways']?JSON[_0x4f119e(0x276)](_0x226098[_0x4f119e(0x1c7)]):null,'gatewaySettings':_0x226098[_0x4f119e(0x21f)]?JSON[_0x4f119e(0x276)](_0x226098[_0x4f119e(0x21f)]):null,'publicKey':_0x226098[_0x4f119e(0x231)],'wallets':{'usdtPolygonWallet':_0x226098[_0x4f119e(0x25f)],'usdtTrcWallet':_0x226098[_0x4f119e(0x238)],'usdtErcWallet':_0x226098['usdtErcWallet'],'usdcPolygonWallet':_0x226098[_0x4f119e(0x25d)]},'status':_0x226098[_0x4f119e(0x26e)],'createdAt':_0x226098['createdAt']})),'pagination':{'page':_0x104dbd,'limit':_0x526ff0,'total':_0x3939fc,'totalPages':Math[_0x4f119e(0x1ed)](_0x3939fc/_0x526ff0)}};}async[a35_0x671f87(0x251)](_0x540a2b){const _0x10e41e=a35_0x671f87,_0x34ce58=await database_1[_0x10e41e(0x20f)][_0x10e41e(0x214)]['findUnique']({'where':{'id':_0x540a2b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x34ce58)return null;return{'id':_0x34ce58['id'],'fullName':_0x34ce58['name'],'username':_0x34ce58[_0x10e41e(0x1bb)],'telegramId':_0x34ce58[_0x10e41e(0x1c2)],'merchantUrl':_0x34ce58[_0x10e41e(0x22f)],'gateways':_0x34ce58[_0x10e41e(0x1c7)]?JSON['parse'](_0x34ce58[_0x10e41e(0x1c7)]):null,'gatewaySettings':_0x34ce58[_0x10e41e(0x21f)]?JSON[_0x10e41e(0x276)](_0x34ce58[_0x10e41e(0x21f)]):null,'publicKey':_0x34ce58[_0x10e41e(0x231)],'wallets':{'usdtPolygonWallet':_0x34ce58[_0x10e41e(0x25f)],'usdtTrcWallet':_0x34ce58[_0x10e41e(0x238)],'usdtErcWallet':_0x34ce58['usdtErcWallet'],'usdcPolygonWallet':_0x34ce58[_0x10e41e(0x25d)]},'status':_0x34ce58[_0x10e41e(0x26e)],'createdAt':_0x34ce58[_0x10e41e(0x1bd)]};}async['createUser'](_0x2e4bd3){const _0x288e12=a35_0x671f87,{fullName:_0x340b7a,username:_0x372587,password:_0x2c070d,telegramId:_0x527509,merchantUrl:_0x56977a,gateways:_0x32aa78,gatewaySettings:_0x2ea0a8,wallets:_0x2b3e9a}=_0x2e4bd3,_0x1b135d=await database_1['default'][_0x288e12(0x214)][_0x288e12(0x272)]({'where':{'username':_0x372587}});if(_0x1b135d)throw new Error('Username\x20already\x20exists');if(_0x527509){const _0x5b681d=await database_1['default'][_0x288e12(0x214)][_0x288e12(0x272)]({'where':{'telegram':_0x527509}});if(_0x5b681d)throw new Error(_0x288e12(0x22b));}const _0x5455dd=await bcryptjs_1[_0x288e12(0x20f)][_0x288e12(0x22e)](_0x2c070d,0xc),_0x2b04f9='pk_'+crypto_1[_0x288e12(0x20f)][_0x288e12(0x262)](0x20)[_0x288e12(0x1f9)](_0x288e12(0x28c)),_0x3ac1a3='sk_'+crypto_1['default'][_0x288e12(0x262)](0x20)[_0x288e12(0x1f9)](_0x288e12(0x28c)),_0x45911a=await database_1[_0x288e12(0x20f)]['shop'][_0x288e12(0x253)]({'data':{'name':_0x340b7a,'username':_0x372587,'password':_0x5455dd,'telegram':_0x527509,'shopUrl':_0x56977a,'paymentGateways':_0x32aa78?JSON[_0x288e12(0x1c9)](_0x32aa78):null,'gatewaySettings':_0x2ea0a8?JSON[_0x288e12(0x1c9)](_0x2ea0a8):null,'usdtPolygonWallet':_0x2b3e9a?.[_0x288e12(0x25f)]||null,'usdtTrcWallet':_0x2b3e9a?.['usdtTrcWallet']||null,'usdtErcWallet':_0x2b3e9a?.[_0x288e12(0x248)]||null,'usdcPolygonWallet':_0x2b3e9a?.[_0x288e12(0x25d)]||null,'publicKey':_0x2b04f9,'secretKey':_0x3ac1a3,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x45911a['id'],'fullName':_0x45911a[_0x288e12(0x23c)],'username':_0x45911a['username'],'telegramId':_0x45911a['telegram'],'merchantUrl':_0x45911a['shopUrl'],'gateways':_0x45911a[_0x288e12(0x1c7)]?JSON[_0x288e12(0x276)](_0x45911a[_0x288e12(0x1c7)]):null,'gatewaySettings':_0x45911a[_0x288e12(0x21f)]?JSON[_0x288e12(0x276)](_0x45911a[_0x288e12(0x21f)]):null,'publicKey':_0x45911a['publicKey'],'wallets':{'usdtPolygonWallet':_0x45911a[_0x288e12(0x25f)],'usdtTrcWallet':_0x45911a[_0x288e12(0x238)],'usdtErcWallet':_0x45911a[_0x288e12(0x248)],'usdcPolygonWallet':_0x45911a['usdcPolygonWallet']},'status':_0x45911a[_0x288e12(0x26e)],'createdAt':_0x45911a[_0x288e12(0x1bd)]};}async['deleteUser'](_0x4b3397){const _0x4e3da1=a35_0x671f87;await database_1[_0x4e3da1(0x20f)][_0x4e3da1(0x214)][_0x4e3da1(0x1cb)]({'where':{'id':_0x4b3397}});}}exports[a35_0x671f87(0x1fb)]=AdminService;