'use strict';const a35_0x40782a=a35_0x5664;(function(_0xa7e1e6,_0x33a5a2){const _0x2e06aa=a35_0x5664,_0x3ff6ea=_0xa7e1e6();while(!![]){try{const _0x24be1d=parseInt(_0x2e06aa(0x122))/0x1*(-parseInt(_0x2e06aa(0xf4))/0x2)+-parseInt(_0x2e06aa(0x13f))/0x3+-parseInt(_0x2e06aa(0x111))/0x4+-parseInt(_0x2e06aa(0x141))/0x5*(-parseInt(_0x2e06aa(0xfb))/0x6)+-parseInt(_0x2e06aa(0xbf))/0x7*(-parseInt(_0x2e06aa(0xbe))/0x8)+-parseInt(_0x2e06aa(0xb9))/0x9+parseInt(_0x2e06aa(0xe3))/0xa;if(_0x24be1d===_0x33a5a2)break;else _0x3ff6ea['push'](_0x3ff6ea['shift']());}catch(_0x3112d3){_0x3ff6ea['push'](_0x3ff6ea['shift']());}}}(a35_0x20db,0x2a4b0));var __importDefault=this&&this['__importDefault']||function(_0x3dbf59){return _0x3dbf59&&_0x3dbf59['__esModule']?_0x3dbf59:{'default':_0x3dbf59};};Object[a35_0x40782a(0x100)](exports,a35_0x40782a(0x12d),{'value':!![]}),exports[a35_0x40782a(0x12f)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x40782a(0x98))),crypto_1=__importDefault(require(a35_0x40782a(0x140))),currencyService_1=require(a35_0x40782a(0x150));class AdminService{async[a35_0x40782a(0xa7)](){const _0x59f1bc=a35_0x40782a;console['log'](_0x59f1bc(0x97));const _0x36fffa=await database_1[_0x59f1bc(0x112)][_0x59f1bc(0x124)]['findMany']({'where':{'status':_0x59f1bc(0xff),'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x59f1bc(0xe5)+_0x36fffa[_0x59f1bc(0xd7)]+'\x20paid\x20payments');let _0x35e5f6=0x0,_0x1cab29=0x0,_0xd1175a=0x0;for(const _0x38798c of _0x36fffa){try{const _0x2f076d=await currencyService_1[_0x59f1bc(0xad)]['convertToUSDT'](_0x38798c[_0x59f1bc(0x10e)],_0x38798c[_0x59f1bc(0xc4)]);let _0x47f396={};if(_0x38798c[_0x59f1bc(0x144)][_0x59f1bc(0xc2)])try{_0x47f396=JSON['parse'](_0x38798c[_0x59f1bc(0x144)][_0x59f1bc(0xc2)]);}catch(_0x2fcb4b){console[_0x59f1bc(0x9c)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x38798c[_0x59f1bc(0xd3)]+':',_0x2fcb4b);}const _0x13d85d=_0x47f396[_0x59f1bc(0xf3)]||0xa,_0x210bc4=_0x2f076d*(0x1-_0x13d85d/0x64);_0x38798c[_0x59f1bc(0x139)]?(_0x35e5f6+=_0x210bc4,console[_0x59f1bc(0xda)]('✅\x20Payment\x20'+_0x38798c['id']+':\x20'+_0x210bc4[_0x59f1bc(0xae)](0x2)+_0x59f1bc(0x13e))):(_0x1cab29+=_0x210bc4,_0xd1175a+=_0x2f076d,console[_0x59f1bc(0xda)](_0x59f1bc(0xbc)+_0x38798c['id']+':\x20'+_0x210bc4[_0x59f1bc(0xae)](0x2)+_0x59f1bc(0xee)));}catch(_0x1e490a){console[_0x59f1bc(0x9c)]('Error\x20processing\x20payment\x20'+_0x38798c['id']+':',_0x1e490a);}}const _0x134c03=new Date(),_0x34a877=new Date(_0x134c03[_0x59f1bc(0xc6)](),_0x134c03[_0x59f1bc(0x123)](),0x1),_0x3d0bc2=new Date(_0x134c03['getFullYear'](),_0x134c03[_0x59f1bc(0x123)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1ca727=await database_1[_0x59f1bc(0x112)][_0x59f1bc(0xe9)][_0x59f1bc(0x12c)]({'where':{'createdAt':{'gte':_0x34a877,'lte':_0x3d0bc2},'status':_0x59f1bc(0xfc)},'select':{'amount':!![]}}),_0x17960f=_0x1ca727['reduce']((_0x4096d1,_0x1aa49b)=>_0x4096d1+_0x1aa49b[_0x59f1bc(0x10e)],0x0),_0x151f39={'totalPayout':Math[_0x59f1bc(0x147)](_0x35e5f6*0x64)/0x64,'awaitingPayout':Math[_0x59f1bc(0x147)](_0x1cab29*0x64)/0x64,'thisMonth':Math[_0x59f1bc(0x147)](_0x17960f*0x64)/0x64,'availableBalance':Math[_0x59f1bc(0x147)](_0xd1175a*0x64)/0x64};return console['log'](_0x59f1bc(0x108)),console[_0x59f1bc(0xda)](_0x59f1bc(0x94)+_0x151f39[_0x59f1bc(0xab)]+_0x59f1bc(0x114)),console[_0x59f1bc(0xda)](_0x59f1bc(0xe6)+_0x151f39[_0x59f1bc(0x99)]+'\x20USDT\x20(after\x20commission)'),console[_0x59f1bc(0xda)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x151f39[_0x59f1bc(0x9a)]+_0x59f1bc(0xb1)),console[_0x59f1bc(0xda)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x151f39[_0x59f1bc(0xcd)]+_0x59f1bc(0x84)),_0x151f39;}async[a35_0x40782a(0xec)](_0x16f729,_0x38784a){const _0x26492c=a35_0x40782a;console[_0x26492c(0xda)](_0x26492c(0x8d)+_0x16f729+':',_0x38784a);const _0xf04f32=await database_1[_0x26492c(0x112)][_0x26492c(0x124)][_0x26492c(0x142)]({'where':{'id':_0x16f729},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xf04f32)throw new Error(_0x26492c(0x8e));const _0x5d19c8={};_0x38784a[_0x26492c(0xcf)]!==undefined&&(_0x5d19c8[_0x26492c(0xcf)]=_0x38784a[_0x26492c(0xcf)]||null);_0x38784a[_0x26492c(0xf7)]!==undefined&&(_0x5d19c8[_0x26492c(0xf7)]=_0x38784a[_0x26492c(0xf7)]||null);_0x38784a[_0x26492c(0x130)]!==undefined&&(_0x5d19c8[_0x26492c(0x130)]=_0x38784a[_0x26492c(0x130)]||null);const _0x2e6822=await database_1[_0x26492c(0x112)]['payment'][_0x26492c(0x105)]({'where':{'id':_0x16f729},'data':{..._0x5d19c8,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x26492c(0xda)](_0x26492c(0x12e)+_0x16f729),console[_0x26492c(0xda)](_0x26492c(0xde)+_0xf04f32[_0x26492c(0xcf)]+_0x26492c(0x116)+_0x2e6822[_0x26492c(0xcf)]),console['log'](_0x26492c(0xc7)+_0xf04f32[_0x26492c(0xf7)]+_0x26492c(0x116)+_0x2e6822[_0x26492c(0xf7)]),console[_0x26492c(0xda)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0xf04f32['customerUa']?_0x26492c(0x151):_0x26492c(0x95))+_0x26492c(0x116)+(_0x2e6822[_0x26492c(0x130)]?_0x26492c(0x151):'not\x20set')),_0x2e6822;}async[a35_0x40782a(0x126)](_0x29349f){const _0x5c398e=a35_0x40782a,_0x5454ba=new Date();let _0x565f60;switch(_0x29349f){case'7d':_0x565f60=new Date(_0x5454ba[_0x5c398e(0x96)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5c398e(0xa3):_0x565f60=new Date(_0x5454ba[_0x5c398e(0x96)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x565f60=new Date(_0x5454ba['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x565f60=new Date(_0x5454ba[_0x5c398e(0x96)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xa0bb,_0x5c9043,_0x207398,_0x15437f,_0x3c5314,_0x3bcb41]=await Promise[_0x5c398e(0x14d)]([database_1['default'][_0x5c398e(0x144)][_0x5c398e(0xc9)](),database_1[_0x5c398e(0x112)][_0x5c398e(0x144)][_0x5c398e(0xc9)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x5c398e(0x124)][_0x5c398e(0xc9)]({'where':{'createdAt':{'gte':_0x565f60},'gateway':{'not':_0x5c398e(0x137)}}}),database_1['default'][_0x5c398e(0x124)][_0x5c398e(0xc9)]({'where':{'status':_0x5c398e(0xff),'createdAt':{'gte':_0x565f60},'gateway':{'not':_0x5c398e(0x137)}}}),database_1['default'][_0x5c398e(0x124)]['findMany']({'where':{'status':_0x5c398e(0xff),'createdAt':{'gte':_0x565f60},'gateway':{'not':_0x5c398e(0x137)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x5c398e(0x124)][_0x5c398e(0x12c)]({'where':{'gateway':{'not':_0x5c398e(0x137)}},'take':0xa,'orderBy':{'createdAt':_0x5c398e(0xb7)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x309c8b=0x0;for(const _0x3fe842 of _0x3c5314){const _0x16d921=await currencyService_1[_0x5c398e(0xad)][_0x5c398e(0xe4)](_0x3fe842[_0x5c398e(0x10e)],_0x3fe842['currency']);_0x309c8b+=_0x16d921;}const _0x2738ce=_0x207398>0x0?_0x15437f/_0x207398*0x64:0x0;return{'totalShops':_0xa0bb,'activeShops':_0x5c9043,'totalPayments':_0x207398,'successfulPayments':_0x15437f,'totalRevenue':Math[_0x5c398e(0x147)](_0x309c8b*0x64)/0x64,'conversionRate':Math['round'](_0x2738ce*0x64)/0x64,'recentPayments':_0x3bcb41[_0x5c398e(0x91)](_0x2e134d=>({'id':_0x2e134d['id'],'amount':_0x2e134d['amount'],'currency':_0x2e134d['currency'],'status':_0x2e134d[_0x5c398e(0xed)],'gateway':_0x2e134d['gateway'],'shop':_0x2e134d[_0x5c398e(0x144)],'createdAt':_0x2e134d[_0x5c398e(0xe0)]}))};}async[a35_0x40782a(0x10c)](_0x2d4556){const _0x49101f=a35_0x40782a;console[_0x49101f(0xda)](_0x49101f(0x131),_0x2d4556);let _0x110e5c,_0x313af4=new Date();if(_0x2d4556[_0x49101f(0xca)]===_0x49101f(0xd5)&&_0x2d4556[_0x49101f(0x92)]&&_0x2d4556['dateTo'])_0x110e5c=new Date(_0x2d4556[_0x49101f(0x92)]),_0x313af4=new Date(_0x2d4556[_0x49101f(0x127)]);else{const _0x579aed=new Date();switch(_0x2d4556['period']){case _0x49101f(0xa4):_0x110e5c=new Date(_0x579aed[_0x49101f(0x96)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x49101f(0x145):_0x110e5c=new Date(_0x579aed[_0x49101f(0x96)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x49101f(0x121):_0x110e5c=new Date(_0x579aed[_0x49101f(0x96)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x49101f(0x14d):default:_0x110e5c=new Date(_0x49101f(0xd2));break;}}console[_0x49101f(0xda)](_0x49101f(0xba)+_0x110e5c['toISOString']()+_0x49101f(0x146)+_0x313af4[_0x49101f(0xd1)]());const _0x48a518={'status':'PAID','gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x110e5c,'lte':_0x313af4}};_0x2d4556[_0x49101f(0xd3)]&&(_0x48a518[_0x49101f(0xd3)]=_0x2d4556[_0x49101f(0xd3)]);const _0x27e7d8=await database_1[_0x49101f(0x112)][_0x49101f(0x124)][_0x49101f(0x12c)]({'where':_0x48a518,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x49101f(0xda)]('💰\x20Found\x20'+_0x27e7d8[_0x49101f(0xd7)]+'\x20paid\x20payments\x20for\x20analysis');let _0x132c9d=0x0,_0x2c3197=0x0,_0x58da45=0x0;const _0x3a4fd5={},_0x4728b2={},_0x52cea1={};for(const _0x3cd1e9 of _0x27e7d8){try{const _0x3c3e75=await currencyService_1['currencyService'][_0x49101f(0xe4)](_0x3cd1e9[_0x49101f(0x10e)],_0x3cd1e9['currency']);let _0x45f6b4={};if(_0x3cd1e9[_0x49101f(0x144)][_0x49101f(0xc2)])try{_0x45f6b4=JSON[_0x49101f(0x104)](_0x3cd1e9['shop'][_0x49101f(0xc2)]);}catch(_0x12e73e){console[_0x49101f(0x9c)](_0x49101f(0xe1)+_0x3cd1e9['shopId']+':',_0x12e73e);}const _0x408093=_0x45f6b4[_0x49101f(0xf3)]||0xa,_0x58bd1d=_0x3c3e75*(_0x408093/0x64),_0x2c1eeb=_0x3c3e75-_0x58bd1d;_0x132c9d+=_0x3c3e75,_0x2c3197+=_0x2c1eeb,_0x58da45+=_0x58bd1d;!_0x3a4fd5[_0x3cd1e9[_0x49101f(0xf2)]]&&(_0x3a4fd5[_0x3cd1e9['gateway']]={'gateway':_0x3cd1e9[_0x49101f(0xf2)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x3cd1e9[_0x49101f(0xf2)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3a4fd5[_0x3cd1e9[_0x49101f(0xf2)]][_0x49101f(0x133)]++,_0x3a4fd5[_0x3cd1e9[_0x49101f(0xf2)]][_0x49101f(0xea)]+=_0x3c3e75,_0x3a4fd5[_0x3cd1e9[_0x49101f(0xf2)]][_0x49101f(0xd6)]+=_0x58bd1d,_0x3a4fd5[_0x3cd1e9[_0x49101f(0xf2)]]['merchantEarningsUSDT']+=_0x2c1eeb,_0x3a4fd5[_0x3cd1e9['gateway']][_0x49101f(0x118)]+=_0x408093;!_0x2d4556[_0x49101f(0xd3)]&&(!_0x4728b2[_0x3cd1e9['shopId']]&&(_0x4728b2[_0x3cd1e9[_0x49101f(0xd3)]]={'shopId':_0x3cd1e9[_0x49101f(0xd3)],'shopName':_0x3cd1e9[_0x49101f(0x144)][_0x49101f(0x89)],'shopUsername':_0x3cd1e9[_0x49101f(0x144)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4728b2[_0x3cd1e9[_0x49101f(0xd3)]][_0x49101f(0x133)]++,_0x4728b2[_0x3cd1e9[_0x49101f(0xd3)]][_0x49101f(0xea)]+=_0x3c3e75,_0x4728b2[_0x3cd1e9[_0x49101f(0xd3)]][_0x49101f(0xd6)]+=_0x58bd1d,_0x4728b2[_0x3cd1e9[_0x49101f(0xd3)]][_0x49101f(0x14e)]+=_0x2c1eeb);const _0xe1b021=_0x3cd1e9[_0x49101f(0x8b)]['toISOString']()[_0x49101f(0x102)]('T')[0x0];!_0x52cea1[_0xe1b021]&&(_0x52cea1[_0xe1b021]={'date':_0xe1b021,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x52cea1[_0xe1b021][_0x49101f(0x11e)]+=_0x3c3e75,_0x52cea1[_0xe1b021]['merchantEarnings']+=_0x2c1eeb,_0x52cea1[_0xe1b021][_0x49101f(0xc3)]+=_0x58bd1d,_0x52cea1[_0xe1b021][_0x49101f(0x133)]++;}catch(_0x22b428){console[_0x49101f(0x9c)](_0x49101f(0xe7)+_0x3cd1e9['id']+':',_0x22b428);}}Object[_0x49101f(0xc0)](_0x3a4fd5)[_0x49101f(0x103)](_0x22ebff=>{const _0xfd3fbb=_0x49101f;_0x22ebff[_0xfd3fbb(0x10f)]=_0x22ebff[_0xfd3fbb(0x133)]>0x0?_0x22ebff[_0xfd3fbb(0x118)]/_0x22ebff[_0xfd3fbb(0x133)]:0x0,delete _0x22ebff[_0xfd3fbb(0x118)];}),Object[_0x49101f(0xc0)](_0x4728b2)[_0x49101f(0x103)](_0x115c41=>{const _0x1d5779=_0x49101f;_0x115c41[_0x1d5779(0xfa)]=_0x115c41[_0x1d5779(0x133)]>0x0?_0x115c41[_0x1d5779(0xea)]/_0x115c41[_0x1d5779(0x133)]:0x0;});let _0x28d0a8=0x0;if(_0x2d4556[_0x49101f(0xd3)]){const _0x51a14d=await database_1[_0x49101f(0x112)][_0x49101f(0xe9)]['findMany']({'where':{'shopId':_0x2d4556[_0x49101f(0xd3)],'status':_0x49101f(0xfc),'createdAt':{'gte':_0x110e5c,'lte':_0x313af4}},'select':{'amount':!![]}});_0x28d0a8=_0x51a14d[_0x49101f(0xb0)]((_0x81af77,_0x53ce58)=>_0x81af77+_0x53ce58[_0x49101f(0x10e)],0x0);}const _0x477bc0=_0x27e7d8[_0x49101f(0xd7)],_0x181770=_0x27e7d8[_0x49101f(0xd7)],_0x4fe1b4=_0x477bc0>0x0?_0x132c9d/_0x477bc0:0x0,_0x4c7a20=0x64,_0x22ceb7=Math['ceil']((_0x313af4['getTime']()-_0x110e5c['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x53669d={'totalTurnover':Math[_0x49101f(0x147)](_0x132c9d*0x64)/0x64,'merchantEarnings':Math['round'](_0x2c3197*0x64)/0x64,'gatewayEarnings':Math[_0x49101f(0x147)](_0x58da45*0x64)/0x64,'totalPaidOut':Math[_0x49101f(0x147)](_0x28d0a8*0x64)/0x64,'averageCheck':Math[_0x49101f(0x147)](_0x4fe1b4*0x64)/0x64,'totalPayments':_0x477bc0,'successfulPayments':_0x181770,'conversionRate':_0x4c7a20,'gatewayBreakdown':Object['values'](_0x3a4fd5)[_0x49101f(0x91)](_0x18aaac=>({..._0x18aaac,'turnoverUSDT':Math['round'](_0x18aaac[_0x49101f(0xea)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x18aaac[_0x49101f(0xd6)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x49101f(0x147)](_0x18aaac[_0x49101f(0x14e)]*0x64)/0x64,'averageCommissionRate':Math[_0x49101f(0x147)](_0x18aaac['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x2d4556[_0x49101f(0xd3)]?undefined:Object[_0x49101f(0xc0)](_0x4728b2)[_0x49101f(0x91)](_0x5a40d4=>({..._0x5a40d4,'turnoverUSDT':Math[_0x49101f(0x147)](_0x5a40d4['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x49101f(0x147)](_0x5a40d4[_0x49101f(0xd6)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x49101f(0x147)](_0x5a40d4['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x49101f(0x147)](_0x5a40d4[_0x49101f(0xf8)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x5a40d4[_0x49101f(0xfa)]*0x64)/0x64})),'dailyData':Object[_0x49101f(0xc0)](_0x52cea1)['map'](_0x14841a=>({..._0x14841a,'turnover':Math[_0x49101f(0x147)](_0x14841a[_0x49101f(0x11e)]*0x64)/0x64,'merchantEarnings':Math[_0x49101f(0x147)](_0x14841a[_0x49101f(0x117)]*0x64)/0x64,'gatewayEarnings':Math[_0x49101f(0x147)](_0x14841a[_0x49101f(0xc3)]*0x64)/0x64}))[_0x49101f(0xd4)]((_0x247b6b,_0x1b9898)=>_0x247b6b['date'][_0x49101f(0x134)](_0x1b9898[_0x49101f(0xcb)])),'periodInfo':{'from':_0x110e5c,'to':_0x313af4,'periodType':_0x2d4556[_0x49101f(0xca)]||'custom','daysCount':_0x22ceb7}};return console[_0x49101f(0xda)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x49101f(0xda)](_0x49101f(0x135)+_0x53669d['totalTurnover']+_0x49101f(0x84)),console['log']('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x53669d[_0x49101f(0x117)]+_0x49101f(0x84)),console[_0x49101f(0xda)](_0x49101f(0x9b)+_0x53669d[_0x49101f(0xc3)]+_0x49101f(0x84)),console[_0x49101f(0xda)](_0x49101f(0xa6)+_0x53669d[_0x49101f(0xc5)]),_0x53669d;}[a35_0x40782a(0x136)](_0x17756b){const _0x520171=a35_0x40782a,_0xc01bf={'test_gateway':_0x520171(0x13d),'plisio':_0x520171(0x12a),'rapyd':_0x520171(0xd9),'noda':_0x520171(0x14c),'cointopay':_0x520171(0xbd),'klyme_eu':_0x520171(0x119),'klyme_gb':_0x520171(0xdb),'klyme_de':_0x520171(0xeb)};return _0xc01bf[_0x17756b]||_0x17756b;}async['getMerchantsAwaitingPayout'](_0x42849a){const _0x3d9ecd=a35_0x40782a,{page:_0x1ca936,limit:_0x58a8b7,minAmount:_0x4a3c23,search:_0x264f62}=_0x42849a,_0x1a0f4c=(_0x1ca936-0x1)*_0x58a8b7;console[_0x3d9ecd(0xda)](_0x3d9ecd(0xaf),_0x42849a);const _0x53a140=await database_1[_0x3d9ecd(0x112)]['payment'][_0x3d9ecd(0x12c)]({'where':{'status':_0x3d9ecd(0xff),'merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x3d9ecd(0xda)](_0x3d9ecd(0xe5)+_0x53a140[_0x3d9ecd(0xd7)]+_0x3d9ecd(0x85));const _0x35609f={};for(const _0x49423b of _0x53a140){const _0x27eb1c=_0x49423b['shopId'];!_0x35609f[_0x27eb1c]&&(_0x35609f[_0x27eb1c]={'id':_0x49423b[_0x3d9ecd(0x144)]['id'],'fullName':_0x49423b['shop'][_0x3d9ecd(0x89)],'username':_0x49423b['shop'][_0x3d9ecd(0xb2)],'telegramId':_0x49423b[_0x3d9ecd(0x144)]['telegram'],'merchantUrl':_0x49423b[_0x3d9ecd(0x144)]['shopUrl'],'wallets':{'usdtPolygonWallet':_0x49423b[_0x3d9ecd(0x144)][_0x3d9ecd(0x12b)],'usdtTrcWallet':_0x49423b[_0x3d9ecd(0x144)]['usdtTrcWallet'],'usdtErcWallet':_0x49423b[_0x3d9ecd(0x144)][_0x3d9ecd(0xfe)],'usdcPolygonWallet':_0x49423b[_0x3d9ecd(0x144)][_0x3d9ecd(0x138)]},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x49423b['paidAt'],'gatewayBreakdown':{},'gatewaySettings':_0x49423b[_0x3d9ecd(0x144)][_0x3d9ecd(0xc2)]});try{const _0xefa20a=await currencyService_1[_0x3d9ecd(0xad)][_0x3d9ecd(0xe4)](_0x49423b[_0x3d9ecd(0x10e)],_0x49423b[_0x3d9ecd(0xc4)]);let _0x21abe7={};if(_0x49423b[_0x3d9ecd(0x144)][_0x3d9ecd(0xc2)])try{_0x21abe7=JSON['parse'](_0x49423b[_0x3d9ecd(0x144)][_0x3d9ecd(0xc2)]);}catch(_0x4a63e6){console[_0x3d9ecd(0x9c)](_0x3d9ecd(0xe1)+_0x27eb1c+':',_0x4a63e6);}const _0x2eb563=_0x21abe7[_0x3d9ecd(0xf3)]||0xa,_0x3b88d6=_0xefa20a*(0x1-_0x2eb563/0x64);_0x35609f[_0x27eb1c]['totalAmountUSDT']+=_0xefa20a,_0x35609f[_0x27eb1c][_0x3d9ecd(0xb3)]+=_0x3b88d6,_0x35609f[_0x27eb1c][_0x3d9ecd(0x133)]++,_0x49423b[_0x3d9ecd(0x8b)]<_0x35609f[_0x27eb1c]['oldestPaymentDate']&&(_0x35609f[_0x27eb1c][_0x3d9ecd(0x13a)]=_0x49423b[_0x3d9ecd(0x8b)]),!_0x35609f[_0x27eb1c][_0x3d9ecd(0xa1)][_0x49423b[_0x3d9ecd(0xf2)]]&&(_0x35609f[_0x27eb1c][_0x3d9ecd(0xa1)][_0x49423b[_0x3d9ecd(0xf2)]]={'gateway':_0x49423b['gateway'],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x2eb563}),_0x35609f[_0x27eb1c]['gatewayBreakdown'][_0x49423b[_0x3d9ecd(0xf2)]][_0x3d9ecd(0xc9)]++,_0x35609f[_0x27eb1c][_0x3d9ecd(0xa1)][_0x49423b[_0x3d9ecd(0xf2)]]['amountUSDT']+=_0xefa20a,_0x35609f[_0x27eb1c][_0x3d9ecd(0xa1)][_0x49423b[_0x3d9ecd(0xf2)]][_0x3d9ecd(0x129)]+=_0x3b88d6;}catch(_0xa6b461){console[_0x3d9ecd(0x9c)](_0x3d9ecd(0xe7)+_0x49423b['id']+':',_0xa6b461);}}let _0xc63510=Object[_0x3d9ecd(0xc0)](_0x35609f)[_0x3d9ecd(0x91)](_0x2ad92e=>({..._0x2ad92e,'totalAmountUSDT':Math[_0x3d9ecd(0x147)](_0x2ad92e[_0x3d9ecd(0xf5)]*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3d9ecd(0x147)](_0x2ad92e['totalAmountAfterCommissionUSDT']*0x64)/0x64,'gatewayBreakdown':Object['values'](_0x2ad92e['gatewayBreakdown'])['map'](_0x4bedd3=>({..._0x4bedd3,'amountUSDT':Math[_0x3d9ecd(0x147)](_0x4bedd3[_0x3d9ecd(0x14b)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x3d9ecd(0x147)](_0x4bedd3['amountAfterCommissionUSDT']*0x64)/0x64}))}));_0x4a3c23&&(_0xc63510=_0xc63510[_0x3d9ecd(0x10b)](_0x2ba4ea=>_0x2ba4ea['totalAmountAfterCommissionUSDT']>=_0x4a3c23));if(_0x264f62){const _0x2d8c83=_0x264f62[_0x3d9ecd(0x132)]();_0xc63510=_0xc63510['filter'](_0x1e20a4=>_0x1e20a4['fullName']['toLowerCase']()[_0x3d9ecd(0xce)](_0x2d8c83)||_0x1e20a4[_0x3d9ecd(0xb2)][_0x3d9ecd(0x132)]()[_0x3d9ecd(0xce)](_0x2d8c83));}_0xc63510[_0x3d9ecd(0xd4)]((_0x2889f4,_0x2e223b)=>_0x2e223b[_0x3d9ecd(0xb3)]-_0x2889f4['totalAmountAfterCommissionUSDT']);const _0x41c454=_0xc63510[_0x3d9ecd(0xd7)],_0x4101aa=_0xc63510['slice'](_0x1a0f4c,_0x1a0f4c+_0x58a8b7),_0x4b95fe=_0xc63510[_0x3d9ecd(0xb0)]((_0x1978d0,_0x1b4233)=>_0x1978d0+_0x1b4233[_0x3d9ecd(0xf5)],0x0),_0x4eb7fb=_0xc63510[_0x3d9ecd(0xb0)]((_0x8ff62b,_0x1d026e)=>_0x8ff62b+_0x1d026e[_0x3d9ecd(0xb3)],0x0);return console[_0x3d9ecd(0xda)](_0x3d9ecd(0x10d)+_0x41c454+_0x3d9ecd(0xac)+Math[_0x3d9ecd(0x147)](_0x4eb7fb*0x64)/0x64+_0x3d9ecd(0x82)),{'merchants':_0x4101aa,'pagination':{'page':_0x1ca936,'limit':_0x58a8b7,'total':_0x41c454,'totalPages':Math['ceil'](_0x41c454/_0x58a8b7)},'summary':{'totalMerchants':_0x41c454,'totalAmountUSDT':Math[_0x3d9ecd(0x147)](_0x4b95fe*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3d9ecd(0x147)](_0x4eb7fb*0x64)/0x64}};}async[a35_0x40782a(0x11c)](_0x5600be){const _0x4b64fa=a35_0x40782a,{shopId:_0x32151d,amount:_0x3ef66e,network:_0x950b45,notes:_0x2474fd,periodFrom:_0x564680,periodTo:_0x901691}=_0x5600be,_0x15594c=await database_1[_0x4b64fa(0x112)]['shop'][_0x4b64fa(0x142)]({'where':{'id':_0x32151d},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x15594c)throw new Error(_0x4b64fa(0xb4));const _0x384360=await database_1['default'][_0x4b64fa(0xe9)][_0x4b64fa(0x88)]({'data':{'shopId':_0x32151d,'amount':_0x3ef66e,'network':_0x950b45,'status':_0x4b64fa(0xfc),'notes':_0x2474fd,'periodFrom':_0x564680?new Date(_0x564680):null,'periodTo':_0x901691?new Date(_0x901691):null,'createdAt':new Date(),'paidAt':new Date()}});return console[_0x4b64fa(0xda)](_0x4b64fa(0x106)+_0x384360['id']+_0x4b64fa(0x115)+_0x15594c[_0x4b64fa(0xb2)]+'\x20('+_0x3ef66e+_0x4b64fa(0x101)),{'id':_0x384360['id'],'shopId':_0x384360[_0x4b64fa(0xd3)],'shopName':_0x15594c[_0x4b64fa(0x89)],'shopUsername':_0x15594c[_0x4b64fa(0xb2)],'amount':_0x384360['amount'],'network':_0x384360[_0x4b64fa(0x9d)],'status':_0x384360['status'],'txid':_0x384360['txid'],'notes':_0x384360['notes'],'periodFrom':_0x384360[_0x4b64fa(0xe2)],'periodTo':_0x384360[_0x4b64fa(0x109)],'createdAt':_0x384360[_0x4b64fa(0xe0)],'paidAt':_0x384360[_0x4b64fa(0x8b)]};}async[a35_0x40782a(0x11f)](_0x443f4b){const _0x49e50d=a35_0x40782a,{page:_0x3dd07a,limit:_0x44606c,shopId:_0x454470,network:_0xc6f753,dateFrom:_0x1ac4ff,dateTo:_0x5352dd,search:_0x57e778}=_0x443f4b,_0x3903f9=(_0x3dd07a-0x1)*_0x44606c,_0x45a0e0={};_0x454470&&(_0x45a0e0['shopId']=_0x454470);_0xc6f753&&(_0x45a0e0[_0x49e50d(0x9d)]=_0xc6f753);(_0x1ac4ff||_0x5352dd)&&(_0x45a0e0[_0x49e50d(0xe0)]={},_0x1ac4ff&&(_0x45a0e0[_0x49e50d(0xe0)][_0x49e50d(0xbb)]=new Date(_0x1ac4ff)),_0x5352dd&&(_0x45a0e0[_0x49e50d(0xe0)][_0x49e50d(0x125)]=new Date(_0x5352dd)));_0x57e778&&(_0x45a0e0['OR']=[{'shop':{'name':{'contains':_0x57e778,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x57e778,'mode':_0x49e50d(0x8a)}}},{'notes':{'contains':_0x57e778,'mode':_0x49e50d(0x8a)}}]);const [_0x222e33,_0x1a7c4a]=await Promise[_0x49e50d(0x14d)]([database_1[_0x49e50d(0x112)]['payout']['findMany']({'where':_0x45a0e0,'skip':_0x3903f9,'take':_0x44606c,'orderBy':{'createdAt':_0x49e50d(0xb7)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x49e50d(0x112)][_0x49e50d(0xe9)][_0x49e50d(0xc9)]({'where':_0x45a0e0})]);return{'payouts':_0x222e33[_0x49e50d(0x91)](_0x43f99a=>({'id':_0x43f99a['id'],'shopId':_0x43f99a[_0x49e50d(0xd3)],'shopName':_0x43f99a[_0x49e50d(0x144)][_0x49e50d(0x89)],'shopUsername':_0x43f99a['shop'][_0x49e50d(0xb2)],'amount':_0x43f99a[_0x49e50d(0x10e)],'network':_0x43f99a[_0x49e50d(0x9d)],'status':_0x43f99a['status'],'txid':_0x43f99a[_0x49e50d(0x83)],'notes':_0x43f99a['notes'],'periodFrom':_0x43f99a['periodFrom'],'periodTo':_0x43f99a[_0x49e50d(0x109)],'createdAt':_0x43f99a[_0x49e50d(0xe0)],'paidAt':_0x43f99a[_0x49e50d(0x8b)]})),'pagination':{'page':_0x3dd07a,'limit':_0x44606c,'total':_0x1a7c4a,'totalPages':Math[_0x49e50d(0x128)](_0x1a7c4a/_0x44606c)}};}async[a35_0x40782a(0xa5)](_0x14ed46){const _0xff0e94=a35_0x40782a,_0x308bd2=await database_1[_0xff0e94(0x112)]['payout'][_0xff0e94(0x142)]({'where':{'id':_0x14ed46},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x308bd2)return null;return{'id':_0x308bd2['id'],'shopId':_0x308bd2[_0xff0e94(0xd3)],'shopName':_0x308bd2['shop'][_0xff0e94(0x89)],'shopUsername':_0x308bd2[_0xff0e94(0x144)]['username'],'amount':_0x308bd2['amount'],'network':_0x308bd2['network'],'status':_0x308bd2[_0xff0e94(0xed)],'txid':_0x308bd2[_0xff0e94(0x83)],'notes':_0x308bd2[_0xff0e94(0x14a)],'periodFrom':_0x308bd2[_0xff0e94(0xe2)],'periodTo':_0x308bd2[_0xff0e94(0x109)],'createdAt':_0x308bd2[_0xff0e94(0xe0)],'paidAt':_0x308bd2[_0xff0e94(0x8b)]};}async[a35_0x40782a(0x14f)](_0x2cfb7c){const _0x16d2bc=a35_0x40782a;await database_1['default'][_0x16d2bc(0xe9)]['delete']({'where':{'id':_0x2cfb7c}});}async[a35_0x40782a(0xfd)](_0x3392e6){const _0x22cda2=a35_0x40782a,{page:_0x55eb11,limit:_0x402d67,status:_0x7e575a,gateway:_0x25d89c,shopId:_0x3f5c15,dateFrom:_0x1741cf,dateTo:_0x5e9e0d,search:_0x351197}=_0x3392e6,_0x54818a=(_0x55eb11-0x1)*_0x402d67,_0x273cbd={};_0x7e575a&&(_0x273cbd[_0x22cda2(0xed)]=_0x7e575a[_0x22cda2(0xe8)]());_0x25d89c&&(_0x273cbd[_0x22cda2(0xf2)]=_0x25d89c['toLowerCase']());_0x273cbd[_0x22cda2(0xf2)]=_0x273cbd[_0x22cda2(0xf2)]?_0x273cbd['gateway']:{'not':'test_gateway'};if(typeof _0x273cbd[_0x22cda2(0xf2)]===_0x22cda2(0xb6)&&_0x273cbd[_0x22cda2(0xf2)]!=='test_gateway'){}else{if(typeof _0x273cbd[_0x22cda2(0xf2)]==='string'&&_0x273cbd[_0x22cda2(0xf2)]===_0x22cda2(0x137)){}else _0x273cbd['gateway']={'not':_0x22cda2(0x137)};}_0x3f5c15&&(_0x273cbd[_0x22cda2(0xd3)]=_0x3f5c15);(_0x1741cf||_0x5e9e0d)&&(_0x273cbd['createdAt']={},_0x1741cf&&(_0x273cbd['createdAt']['gte']=new Date(_0x1741cf)),_0x5e9e0d&&(_0x273cbd[_0x22cda2(0xe0)][_0x22cda2(0x125)]=new Date(_0x5e9e0d)));_0x351197&&(_0x273cbd['OR']=[{'orderId':{'contains':_0x351197,'mode':_0x22cda2(0x8a)}},{'gatewayOrderId':{'contains':_0x351197,'mode':_0x22cda2(0x8a)}},{'customerEmail':{'contains':_0x351197,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x351197,'mode':_0x22cda2(0x8a)}}},{'shop':{'username':{'contains':_0x351197,'mode':'insensitive'}}}]);const [_0x461205,_0x2135b4]=await Promise[_0x22cda2(0x14d)]([database_1[_0x22cda2(0x112)][_0x22cda2(0x124)][_0x22cda2(0x12c)]({'where':_0x273cbd,'skip':_0x54818a,'take':_0x402d67,'orderBy':{'createdAt':_0x22cda2(0xb7)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x22cda2(0x112)]['payment'][_0x22cda2(0xc9)]({'where':_0x273cbd})]);return{'payments':_0x461205['map'](_0x39f795=>({'id':_0x39f795['id'],'shopId':_0x39f795[_0x22cda2(0xd3)],'gateway':_0x39f795[_0x22cda2(0xf2)],'amount':_0x39f795[_0x22cda2(0x10e)],'currency':_0x39f795[_0x22cda2(0xc4)],'status':_0x39f795[_0x22cda2(0xed)],'orderId':_0x39f795[_0x22cda2(0x107)],'gatewayOrderId':_0x39f795[_0x22cda2(0x11a)],'customerEmail':_0x39f795[_0x22cda2(0xef)],'customerName':_0x39f795[_0x22cda2(0xb8)],'customerCountry':_0x39f795[_0x22cda2(0xcf)],'customerIp':_0x39f795[_0x22cda2(0xf7)],'customerUa':_0x39f795[_0x22cda2(0x130)],'failureMessage':_0x39f795['failureMessage'],'createdAt':_0x39f795[_0x22cda2(0xe0)],'updatedAt':_0x39f795['updatedAt'],'shop':_0x39f795[_0x22cda2(0x144)]})),'pagination':{'page':_0x55eb11,'limit':_0x402d67,'total':_0x2135b4,'totalPages':Math[_0x22cda2(0x128)](_0x2135b4/_0x402d67)}};}async[a35_0x40782a(0xa9)](_0x27ea6e){const _0x244f7d=a35_0x40782a,_0x7ce9de=await database_1[_0x244f7d(0x112)][_0x244f7d(0x124)][_0x244f7d(0x142)]({'where':{'id':_0x27ea6e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x7ce9de)return null;return{'id':_0x7ce9de['id'],'shopId':_0x7ce9de['shopId'],'gateway':_0x7ce9de[_0x244f7d(0xf2)],'amount':_0x7ce9de[_0x244f7d(0x10e)],'currency':_0x7ce9de[_0x244f7d(0xc4)],'status':_0x7ce9de[_0x244f7d(0xed)],'orderId':_0x7ce9de[_0x244f7d(0x107)],'gatewayOrderId':_0x7ce9de[_0x244f7d(0x11a)],'customerEmail':_0x7ce9de[_0x244f7d(0xef)],'customerName':_0x7ce9de[_0x244f7d(0xb8)],'customerCountry':_0x7ce9de['customerCountry'],'customerIp':_0x7ce9de[_0x244f7d(0xf7)],'customerUa':_0x7ce9de['customerUa'],'failureMessage':_0x7ce9de[_0x244f7d(0xd8)],'externalPaymentUrl':_0x7ce9de[_0x244f7d(0xdc)],'successUrl':_0x7ce9de[_0x244f7d(0x8f)],'failUrl':_0x7ce9de['failUrl'],'pendingUrl':_0x7ce9de[_0x244f7d(0x11d)],'whiteUrl':_0x7ce9de['whiteUrl'],'createdAt':_0x7ce9de[_0x244f7d(0xe0)],'updatedAt':_0x7ce9de['updatedAt'],'shop':_0x7ce9de[_0x244f7d(0x144)]};}async['updatePaymentStatus'](_0x4d6711,_0x214a80,_0x18aeab,_0x20edf9){const _0x3c07af=a35_0x40782a,_0x219672={'status':_0x214a80[_0x3c07af(0xe8)](),'updatedAt':new Date(),'statusChangedBy':_0x3c07af(0x93),'statusChangedAt':new Date()};_0x18aeab&&(_0x219672['adminNotes']=_0x18aeab);_0x214a80[_0x3c07af(0xe8)]()==='CHARGEBACK'&&_0x20edf9&&(_0x219672[_0x3c07af(0x9e)]=_0x20edf9);_0x214a80[_0x3c07af(0xe8)]()==='PAID'&&(_0x219672[_0x3c07af(0x8b)]=new Date());const _0x346177=await database_1[_0x3c07af(0x112)][_0x3c07af(0x124)][_0x3c07af(0x105)]({'where':{'id':_0x4d6711},'data':_0x219672,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x346177['id'],'shopId':_0x346177['shopId'],'gateway':_0x346177['gateway'],'amount':_0x346177[_0x3c07af(0x10e)],'currency':_0x346177[_0x3c07af(0xc4)],'status':_0x346177['status'],'orderId':_0x346177[_0x3c07af(0x107)],'gatewayOrderId':_0x346177['gatewayOrderId'],'customerEmail':_0x346177[_0x3c07af(0xef)],'customerName':_0x346177[_0x3c07af(0xb8)],'customerCountry':_0x346177[_0x3c07af(0xcf)],'customerIp':_0x346177['customerIp'],'customerUa':_0x346177['customerUa'],'failureMessage':_0x346177['failureMessage'],'adminNotes':_0x346177[_0x3c07af(0x87)],'chargebackAmount':_0x346177['chargebackAmount'],'statusChangedBy':_0x346177[_0x3c07af(0x143)],'statusChangedAt':_0x346177['statusChangedAt'],'createdAt':_0x346177[_0x3c07af(0xe0)],'updatedAt':_0x346177[_0x3c07af(0xd0)],'shop':_0x346177[_0x3c07af(0x144)]};}async[a35_0x40782a(0xa2)](_0x422042,_0x4de7f4){const _0x5af3bf=a35_0x40782a,_0x19632a={..._0x4de7f4};_0x4de7f4[_0x5af3bf(0x8c)]&&(_0x19632a[_0x5af3bf(0x8c)]=await bcryptjs_1[_0x5af3bf(0x112)]['hash'](_0x4de7f4[_0x5af3bf(0x8c)],0xc));_0x4de7f4[_0x5af3bf(0xf6)]&&(_0x19632a['name']=_0x4de7f4[_0x5af3bf(0xf6)],delete _0x19632a[_0x5af3bf(0xf6)]);_0x4de7f4['telegramId']&&(_0x19632a['telegram']=_0x4de7f4[_0x5af3bf(0x113)],delete _0x19632a['telegramId']);_0x4de7f4[_0x5af3bf(0xdf)]&&(_0x19632a[_0x5af3bf(0xf1)]=_0x4de7f4[_0x5af3bf(0xdf)],delete _0x19632a['merchantUrl']);_0x4de7f4['gateways']&&(_0x19632a['paymentGateways']=JSON[_0x5af3bf(0x9f)](_0x4de7f4[_0x5af3bf(0x86)]),delete _0x19632a[_0x5af3bf(0x86)]);_0x4de7f4[_0x5af3bf(0xc2)]&&(_0x19632a[_0x5af3bf(0xc2)]=JSON[_0x5af3bf(0x9f)](_0x4de7f4['gatewaySettings']),delete _0x19632a[_0x5af3bf(0xc2)]);_0x4de7f4[_0x5af3bf(0xa0)]&&(_0x4de7f4[_0x5af3bf(0xa0)][_0x5af3bf(0x12b)]!==undefined&&(_0x19632a[_0x5af3bf(0x12b)]=_0x4de7f4[_0x5af3bf(0xa0)]['usdtPolygonWallet']||null),_0x4de7f4['wallets'][_0x5af3bf(0xb5)]!==undefined&&(_0x19632a[_0x5af3bf(0xb5)]=_0x4de7f4['wallets'][_0x5af3bf(0xb5)]||null),_0x4de7f4[_0x5af3bf(0xa0)][_0x5af3bf(0xfe)]!==undefined&&(_0x19632a[_0x5af3bf(0xfe)]=_0x4de7f4[_0x5af3bf(0xa0)]['usdtErcWallet']||null),_0x4de7f4[_0x5af3bf(0xa0)][_0x5af3bf(0x138)]!==undefined&&(_0x19632a[_0x5af3bf(0x138)]=_0x4de7f4['wallets'][_0x5af3bf(0x138)]||null),delete _0x19632a[_0x5af3bf(0xa0)]);const _0x588eab=await database_1[_0x5af3bf(0x112)][_0x5af3bf(0x144)][_0x5af3bf(0x105)]({'where':{'id':_0x422042},'data':_0x19632a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x588eab['id'],'fullName':_0x588eab['name'],'username':_0x588eab[_0x5af3bf(0xb2)],'telegramId':_0x588eab[_0x5af3bf(0x13c)],'merchantUrl':_0x588eab[_0x5af3bf(0xf1)],'gateways':_0x588eab[_0x5af3bf(0xf0)]?JSON[_0x5af3bf(0x104)](_0x588eab['paymentGateways']):null,'gatewaySettings':_0x588eab[_0x5af3bf(0xc2)]?JSON[_0x5af3bf(0x104)](_0x588eab[_0x5af3bf(0xc2)]):null,'publicKey':_0x588eab['publicKey'],'wallets':{'usdtPolygonWallet':_0x588eab['usdtPolygonWallet'],'usdtTrcWallet':_0x588eab['usdtTrcWallet'],'usdtErcWallet':_0x588eab[_0x5af3bf(0xfe)],'usdcPolygonWallet':_0x588eab[_0x5af3bf(0x138)]},'status':_0x588eab['status'],'createdAt':_0x588eab[_0x5af3bf(0xe0)]};}async['suspendUser'](_0x19682f){const _0x4ad36d=a35_0x40782a,_0x23bf34=await database_1[_0x4ad36d(0x112)][_0x4ad36d(0x144)][_0x4ad36d(0x105)]({'where':{'id':_0x19682f},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x23bf34['id'],'fullName':_0x23bf34[_0x4ad36d(0x89)],'username':_0x23bf34['username'],'telegramId':_0x23bf34['telegram'],'merchantUrl':_0x23bf34[_0x4ad36d(0xf1)],'gateways':_0x23bf34['paymentGateways']?JSON['parse'](_0x23bf34[_0x4ad36d(0xf0)]):null,'gatewaySettings':_0x23bf34[_0x4ad36d(0xc2)]?JSON['parse'](_0x23bf34['gatewaySettings']):null,'publicKey':_0x23bf34[_0x4ad36d(0xf9)],'wallets':{'usdtPolygonWallet':_0x23bf34[_0x4ad36d(0x12b)],'usdtTrcWallet':_0x23bf34[_0x4ad36d(0xb5)],'usdtErcWallet':_0x23bf34['usdtErcWallet'],'usdcPolygonWallet':_0x23bf34[_0x4ad36d(0x138)]},'status':_0x23bf34[_0x4ad36d(0xed)],'createdAt':_0x23bf34['createdAt']};}async[a35_0x40782a(0x149)](_0x2e856c){const _0x838b4f=a35_0x40782a,_0x4952fd=await database_1[_0x838b4f(0x112)][_0x838b4f(0x144)]['update']({'where':{'id':_0x2e856c},'data':{'status':_0x838b4f(0xcc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4952fd['id'],'fullName':_0x4952fd['name'],'username':_0x4952fd[_0x838b4f(0xb2)],'telegramId':_0x4952fd['telegram'],'merchantUrl':_0x4952fd[_0x838b4f(0xf1)],'gateways':_0x4952fd[_0x838b4f(0xf0)]?JSON[_0x838b4f(0x104)](_0x4952fd['paymentGateways']):null,'gatewaySettings':_0x4952fd[_0x838b4f(0xc2)]?JSON['parse'](_0x4952fd[_0x838b4f(0xc2)]):null,'publicKey':_0x4952fd[_0x838b4f(0xf9)],'wallets':{'usdtPolygonWallet':_0x4952fd[_0x838b4f(0x12b)],'usdtTrcWallet':_0x4952fd['usdtTrcWallet'],'usdtErcWallet':_0x4952fd[_0x838b4f(0xfe)],'usdcPolygonWallet':_0x4952fd[_0x838b4f(0x138)]},'status':_0x4952fd[_0x838b4f(0xed)],'createdAt':_0x4952fd['createdAt']};}async[a35_0x40782a(0x10a)](_0xe41446){const _0x1042e7=a35_0x40782a,{page:_0x2a4e34,limit:_0x13d059,status:_0x5eb649}=_0xe41446,_0xe9489=(_0x2a4e34-0x1)*_0x13d059,_0xee064c={};_0x5eb649&&(_0xee064c['status']=_0x5eb649[_0x1042e7(0xe8)]());const [_0x38ca62,_0x2ae374]=await Promise[_0x1042e7(0x14d)]([database_1['default'][_0x1042e7(0x144)]['findMany']({'where':_0xee064c,'skip':_0xe9489,'take':_0x13d059,'orderBy':{'createdAt':_0x1042e7(0xb7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x1042e7(0x144)][_0x1042e7(0xc9)]({'where':_0xee064c})]);return{'users':_0x38ca62['map'](_0x4a594e=>({'id':_0x4a594e['id'],'fullName':_0x4a594e[_0x1042e7(0x89)],'username':_0x4a594e['username'],'telegramId':_0x4a594e[_0x1042e7(0x13c)],'merchantUrl':_0x4a594e[_0x1042e7(0xf1)],'gateways':_0x4a594e[_0x1042e7(0xf0)]?JSON[_0x1042e7(0x104)](_0x4a594e['paymentGateways']):null,'gatewaySettings':_0x4a594e[_0x1042e7(0xc2)]?JSON[_0x1042e7(0x104)](_0x4a594e[_0x1042e7(0xc2)]):null,'publicKey':_0x4a594e[_0x1042e7(0xf9)],'wallets':{'usdtPolygonWallet':_0x4a594e['usdtPolygonWallet'],'usdtTrcWallet':_0x4a594e[_0x1042e7(0xb5)],'usdtErcWallet':_0x4a594e[_0x1042e7(0xfe)],'usdcPolygonWallet':_0x4a594e[_0x1042e7(0x138)]},'status':_0x4a594e[_0x1042e7(0xed)],'createdAt':_0x4a594e[_0x1042e7(0xe0)]})),'pagination':{'page':_0x2a4e34,'limit':_0x13d059,'total':_0x2ae374,'totalPages':Math[_0x1042e7(0x128)](_0x2ae374/_0x13d059)}};}async['getUserById'](_0x31d00f){const _0xccd7e7=a35_0x40782a,_0x5b6c76=await database_1['default'][_0xccd7e7(0x144)][_0xccd7e7(0x142)]({'where':{'id':_0x31d00f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5b6c76)return null;return{'id':_0x5b6c76['id'],'fullName':_0x5b6c76[_0xccd7e7(0x89)],'username':_0x5b6c76['username'],'telegramId':_0x5b6c76[_0xccd7e7(0x13c)],'merchantUrl':_0x5b6c76[_0xccd7e7(0xf1)],'gateways':_0x5b6c76[_0xccd7e7(0xf0)]?JSON[_0xccd7e7(0x104)](_0x5b6c76[_0xccd7e7(0xf0)]):null,'gatewaySettings':_0x5b6c76[_0xccd7e7(0xc2)]?JSON['parse'](_0x5b6c76['gatewaySettings']):null,'publicKey':_0x5b6c76[_0xccd7e7(0xf9)],'wallets':{'usdtPolygonWallet':_0x5b6c76[_0xccd7e7(0x12b)],'usdtTrcWallet':_0x5b6c76[_0xccd7e7(0xb5)],'usdtErcWallet':_0x5b6c76['usdtErcWallet'],'usdcPolygonWallet':_0x5b6c76[_0xccd7e7(0x138)]},'status':_0x5b6c76[_0xccd7e7(0xed)],'createdAt':_0x5b6c76[_0xccd7e7(0xe0)]};}async[a35_0x40782a(0x120)](_0x3a764d){const _0x2de6ef=a35_0x40782a,{fullName:_0x3a0479,username:_0x25bf27,password:_0x264322,telegramId:_0x41970a,merchantUrl:_0xfbf66e,gateways:_0x46c773,gatewaySettings:_0x12b398,wallets:_0x5110c4}=_0x3a764d,_0x5a6c36=await database_1['default'][_0x2de6ef(0x144)]['findUnique']({'where':{'username':_0x25bf27}});if(_0x5a6c36)throw new Error(_0x2de6ef(0xc8));if(_0x41970a){const _0x5c9e2a=await database_1[_0x2de6ef(0x112)][_0x2de6ef(0x144)][_0x2de6ef(0x142)]({'where':{'telegram':_0x41970a}});if(_0x5c9e2a)throw new Error(_0x2de6ef(0xc1));}const _0x2853d8=await bcryptjs_1[_0x2de6ef(0x112)][_0x2de6ef(0x11b)](_0x264322,0xc),_0x4f2376=_0x2de6ef(0x90)+crypto_1[_0x2de6ef(0x112)][_0x2de6ef(0x13b)](0x20)[_0x2de6ef(0x110)](_0x2de6ef(0xdd)),_0x49ffe7=_0x2de6ef(0xaa)+crypto_1[_0x2de6ef(0x112)][_0x2de6ef(0x13b)](0x20)['toString'](_0x2de6ef(0xdd)),_0x1ac624=await database_1[_0x2de6ef(0x112)][_0x2de6ef(0x144)][_0x2de6ef(0x88)]({'data':{'name':_0x3a0479,'username':_0x25bf27,'password':_0x2853d8,'telegram':_0x41970a,'shopUrl':_0xfbf66e,'paymentGateways':_0x46c773?JSON[_0x2de6ef(0x9f)](_0x46c773):null,'gatewaySettings':_0x12b398?JSON['stringify'](_0x12b398):null,'usdtPolygonWallet':_0x5110c4?.[_0x2de6ef(0x12b)]||null,'usdtTrcWallet':_0x5110c4?.['usdtTrcWallet']||null,'usdtErcWallet':_0x5110c4?.[_0x2de6ef(0xfe)]||null,'usdcPolygonWallet':_0x5110c4?.['usdcPolygonWallet']||null,'publicKey':_0x4f2376,'secretKey':_0x49ffe7,'status':_0x2de6ef(0xcc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1ac624['id'],'fullName':_0x1ac624[_0x2de6ef(0x89)],'username':_0x1ac624[_0x2de6ef(0xb2)],'telegramId':_0x1ac624['telegram'],'merchantUrl':_0x1ac624['shopUrl'],'gateways':_0x1ac624[_0x2de6ef(0xf0)]?JSON[_0x2de6ef(0x104)](_0x1ac624[_0x2de6ef(0xf0)]):null,'gatewaySettings':_0x1ac624[_0x2de6ef(0xc2)]?JSON['parse'](_0x1ac624['gatewaySettings']):null,'publicKey':_0x1ac624[_0x2de6ef(0xf9)],'wallets':{'usdtPolygonWallet':_0x1ac624[_0x2de6ef(0x12b)],'usdtTrcWallet':_0x1ac624[_0x2de6ef(0xb5)],'usdtErcWallet':_0x1ac624['usdtErcWallet'],'usdcPolygonWallet':_0x1ac624[_0x2de6ef(0x138)]},'status':_0x1ac624[_0x2de6ef(0xed)],'createdAt':_0x1ac624[_0x2de6ef(0xe0)]};}async[a35_0x40782a(0xa8)](_0x1bd353){const _0x12dd1f=a35_0x40782a;await database_1[_0x12dd1f(0x112)]['shop'][_0x12dd1f(0x148)]({'where':{'id':_0x1bd353}});}}function a35_0x20db(){const _0x45884e=['year','222435JwhZga','getMonth','payment','lte','getSystemStatistics','dateTo','ceil','amountAfterCommissionUSDT','Plisio','usdtPolygonWallet','findMany','__esModule','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','AdminService','customerUa','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','toLowerCase','paymentsCount','localeCompare','\x20\x20\x20💰\x20Total\x20turnover:\x20','getGatewayDisplayName','test_gateway','usdcPolygonWallet','merchantPaid','oldestPaymentDate','randomBytes','telegram','Test\x20Gateway','\x20USDT\x20(paid\x20out)','855906sZVgpO','crypto','560QpisBD','findUnique','statusChangedBy','shop','month','\x20to\x20','round','delete','activateUser','notes','amountUSDT','Noda','all','merchantEarningsUSDT','deletePayout','./currencyService','set','\x20USDT\x20total','txid','\x20USDT','\x20payments\x20awaiting\x20payout','gateways','adminNotes','create','name','insensitive','paidAt','password','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','Payment\x20not\x20found','successUrl','pk_','map','dateFrom','admin','\x20\x20\x20💰\x20Total\x20payout:\x20','not\x20set','getTime','📊\x20Calculating\x20payout\x20statistics...','bcryptjs','awaitingPayout','availableBalance','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','error','network','chargebackAmount','stringify','wallets','gatewayBreakdown','updateUser','30d','week','getPayoutById','\x20\x20\x20📊\x20Total\x20payments:\x20','getPayoutStats','deleteUser','getPaymentById','sk_','totalPayout','\x20merchants,\x20','currencyService','toFixed','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','reduce','\x20USDT\x20(before\x20commission)','username','totalAmountAfterCommissionUSDT','Shop\x20not\x20found','usdtTrcWallet','string','desc','customerName','451251bzZqAz','📅\x20Period:\x20','gte','⏳\x20Payment\x20','CoinToPay','8HgKZaE','321608XIGoaF','values','Telegram\x20username\x20already\x20exists','gatewaySettings','gatewayEarnings','currency','totalPayments','getFullYear','\x20\x20\x20🌐\x20IP:\x20','Username\x20already\x20exists','count','period','date','ACTIVE','thisMonth','includes','customerCountry','updatedAt','toISOString','2020-01-01','shopId','sort','custom','commissionUSDT','length','failureMessage','Rapyd','log','KLYME\x20GB','externalPaymentUrl','hex','\x20\x20\x20🌍\x20Country:\x20','merchantUrl','createdAt','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','periodFrom','4066360FUCtIw','convertToUSDT','💰\x20Found\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','Error\x20processing\x20payment\x20','toUpperCase','payout','turnoverUSDT','KLYME\x20DE','updateCustomerData','status','\x20USDT\x20(pending\x20payout)','customerEmail','paymentGateways','shopUrl','gateway','commission','2ZZnRlF','totalAmountUSDT','fullName','customerIp','paidOutUSDT','publicKey','averageCheckUSDT','15744znAHoW','COMPLETED','getAllPayments','usdtErcWallet','PAID','defineProperty','\x20USDT)','split','forEach','parse','update','✅\x20Payout\x20created:\x20','orderId','📊\x20Payout\x20statistics\x20calculated:','periodTo','getAllUsers','filter','getMerchantStatistics','📊\x20Merchants\x20awaiting\x20payout:\x20','amount','averageCommissionRate','toString','61440ObJJFq','default','telegramId','\x20USDT\x20(paid\x20to\x20merchants)','\x20for\x20shop\x20','\x20->\x20','merchantEarnings','totalCommissionRate','KLYME\x20EU','gatewayOrderId','hash','createPayout','pendingUrl','turnover','getAllPayouts','createUser'];a35_0x20db=function(){return _0x45884e;};return a35_0x20db();}function a35_0x5664(_0xde3d8a,_0x397801){const _0x20dbcf=a35_0x20db();return a35_0x5664=function(_0x5664e2,_0x2a41f7){_0x5664e2=_0x5664e2-0x82;let _0x3dca9f=_0x20dbcf[_0x5664e2];return _0x3dca9f;},a35_0x5664(_0xde3d8a,_0x397801);}exports['AdminService']=AdminService;