'use strict';function a35_0x1499(){const _0x3232de=['amountUSDT','externalPaymentUrl',',\x20Commission:\x20','getGatewayDisplayName','\x20USDT\x20from\x20balance','5306010ZgGuCr','convertToUSDT','aggregate','push','\x20\x20\x20Full\x20amount:\x20','dailyRevenue','amountAfterCommissionUSDT','\x20for\x20shop\x20','Username\x20already\x20exists','telegramId','findMany','defineProperty','\x20\x20\x20Added\x20to\x20balance:\x20+','🔍\x20Using\x20gateway\x20\x27','commissionUSDT','💳\x20Payout\x20wallet\x20for\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','gatewayEarnings','forEach','chargebackAmount','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','values','deleteUser','\x20USDT\x20(gross\x20revenue)','pk_','toUpperCase','0000','failureMessage',']\x20Gateway\x20settings\x20JSON\x20string:','\x20USDT','\x20\x20\x20Merchant\x20loses:\x20','ceil','paymentsCount','⚠️\x20Requested\x20gateway\x20\x27','getAllPayouts','customerIp','some','set','turnoverUSDT','\x20USDT\x20(with\x20commission\x20deducted)','merchantUrl','parse','\x20USDT\x20(actual\x20balances)','findUnique','random','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','REFUND','usdtTrcWallet','usdcPolygonWallet','\x20\x20\x20Gateway:\x20','📋\x20Getting\x20merchants\x20selection\x20list...','sk_','KLYME\x20EU','error','toISOString','AdminService','getMerchantsAwaitingPayout','getFullYear','month','averageCheckUSDT','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','SUSPENDED','\x20\x20\x20Balance:\x20','delete','currency','getGatewayIdByName','184492jNJZqi','totalCommissionRate','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','getAllPayments','activateUser','notes','reduce','join','password','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20📊\x20Total\x20payments:\x20','publicKey','\x20status:\x20','updatedAt','\x27\x20->\x20name\x20\x27','pendingUrl','%\x20commission)','totalPayments','not\x20set','substr','343685IoDyIg','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','default','includes','status','log','cointopay','fullName','⚠️\x20Gateway\x20\x27','🔧\x20[','usdtErcWallet','\x20USDT\x20(after\x20','commission','period','createUser','__importDefault','28KyJiDl','polygon_usdc','all','totalPayout','\x27\x20to\x20name\x20\x27','insensitive','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','groupBy','🔄\x20Gateway\x20mapping\x20(get):','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','shopUrl','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','erc20','rapyd','round','\x20USDT\x20(-','📊\x20Final\x20WHERE\x20conditions:','periodFrom','getGatewayNameById',',\x20successful:\x20','createPayout','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','payment','updatePaymentStatus','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','toFixed','klyme_de','lte','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','📊\x20Calculating\x20payout\x20statistics...','💰\x20Shop\x20','txid','ACTIVE','getMonth','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','custom','$transaction','MasterCard','username','dateTo','name','gatewaySettings','awaitingPayout','customerEmail','\x27\x20not\x20found.\x20Available\x20gateways:\x20','thisMonth','gateway','Open\x20Banking\x202','\x20paid\x20payments\x20for\x20analysis','💰\x20Current\x20shop\x20balance:\x20','📊\x20Payout\x20statistics\x20calculated:','_count','💸\x20CHARGEBACK\x20penalty:\x20-','2SBueAm','90d','wallets','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','stringify','admin','📊\x20Gateway\x20filter\x20applied:','updateUser','getAllUsers','⚠️\x20Payment\x20','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','36WslpNe','💰\x20Found\x20','__esModule','../types/gateway','\x20\x20\x20💵\x20Available\x20balance:\x20',',\x20userId:\x20','getDate','localeCompare','\x20\x20\x20📊\x20Commission\x20difference:\x20','gte','💰\x20[PAYOUT]\x20Gateway\x20','Insufficient\x20balance.\x20Available:\x20','getTime','split','222324LhlapX','merchantEarningsUSDT','hash',']\x20Gateway\x20settings\x20before\x20saving:','\x20payments)','\x20\x20\x20🖥️\x20User\x20Agent:\x20','🔄\x20Converted\x20gateway\x20name\x20\x27','entries','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','\x20merchants','\x20USDT\x20(after\x20payouts)','2020-01-01','554995iJmPKn','desc','\x20merchants\x20with\x20positive\x20balance','asc','\x20no\x20longer\x20PAID:','\x20balance\x20updated:','🔄\x20Gateway\x20mapping:','shop','KLYME\x20GB','hex','\x20USDT,\x20Requested:\x20','bcryptjs','Shop\x20not\x20found','periodTo','828usPtKn','toLowerCase','getUserById','✅\x20Using\x20gateway\x20filter:\x20\x27','successUrl','Error\x20processing\x20payment\x20','getSystemStatistics','trc20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','\x20in\x20','usdtPolygonWallet','paidOutUSDT','🔄\x20Converted\x20gateway\x20ID\x20\x27','balance','paidAt','network','map','\x20active\x20merchants\x20for\x20selection','gateways','create','CHARGEBACK','gatewayOrderId','paymentGateways','getPaymentById','CoinToPay','mastercard','📋\x20Found\x20','klyme_eu','merchantEarnings','../config/database','\x20balance\x20updated:\x20','turnover','🔄\x20Admin\x20updating\x20payment\x20','week','customerUa','KLYME\x20DE','totalAmountAfterCommissionUSDT','Payment\x20not\x20found','not\x20specified','totalAmountUSDT','152gxxLGI','getPayoutStats','\x20\x20\x20🌍\x20Country:\x20','3679950rVvYDI','amount','telegram','getGatewayInternalName','summary','count','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','createdAt','\x27\x20(from\x20\x27','_sum','orderId','currencyService','totalTurnover','\x20\x20\x20💳\x20Total\x20payments:\x20','dailyPayments','\x20became\x20PAID:','generateDailyStatistics','test_gateway','statusChangedBy','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20Payout\x20amount:\x20','payout','Telegram\x20username\x20already\x20exists','dateFrom','length','📊\x20Merchants\x20awaiting\x20payout:\x20',':\x20commission\x20=\x20','Plisio','\x20to\x20','PAID','toString','💰\x20Payment\x20','\x20\x20\x20📅\x20This\x20month:\x20','totalPaidOut','\x20\x20\x20Merchant\x20gets:\x20','findFirst','customerCountry','\x20->\x20','suspendUser','COMPLETED','update','4164475KntJsK','🎯\x20updateUser\x20called\x20with\x20ID:\x20','revenue','customerName','💱\x20Currency\x20filter\x20applied:\x20','polygon','getPayoutById','availableBalance','\x20PAID\x20payments','\x20USDT\x20(without\x20commission)','📊\x20Sorting\x20payments\x20by\x20','shopId','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','NONEXISTENT_GATEWAY_FILTER',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','klyme_gb','\x20USDT\x20(+'];a35_0x1499=function(){return _0x3232de;};return a35_0x1499();}const a35_0x554eae=a35_0x3184;(function(_0x517530,_0x2dee8b){const _0x114618=a35_0x3184,_0x91275d=_0x517530();while(!![]){try{const _0x2880a6=parseInt(_0x114618(0x2d8))/0x1*(parseInt(_0x114618(0x1e4))/0x2)+-parseInt(_0x114618(0x1fd))/0x3*(-parseInt(_0x114618(0x2e8))/0x4)+parseInt(_0x114618(0x26b))/0x5+parseInt(_0x114618(0x281))/0x6+-parseInt(_0x114618(0x209))/0x7*(parseInt(_0x114618(0x23f))/0x8)+parseInt(_0x114618(0x1ef))/0x9*(-parseInt(_0x114618(0x242))/0xa)+parseInt(_0x114618(0x2c4))/0xb*(parseInt(_0x114618(0x217))/0xc);if(_0x2880a6===_0x2dee8b)break;else _0x91275d['push'](_0x91275d['shift']());}catch(_0x2f3ed9){_0x91275d['push'](_0x91275d['shift']());}}}(a35_0x1499,0xb9310));var __importDefault=this&&this[a35_0x554eae(0x2e7)]||function(_0x9c92ea){return _0x9c92ea&&_0x9c92ea['__esModule']?_0x9c92ea:{'default':_0x9c92ea};};Object[a35_0x554eae(0x28c)](exports,a35_0x554eae(0x1f1),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x554eae(0x234))),bcryptjs_1=__importDefault(require(a35_0x554eae(0x214))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService'),gateway_1=require(a35_0x554eae(0x1f2));function a35_0x3184(_0x4e0944,_0x1cf500){const _0x149989=a35_0x1499();return a35_0x3184=function(_0x318470,_0x4b226a){_0x318470=_0x318470-0x1d5;let _0x556c65=_0x149989[_0x318470];return _0x556c65;},a35_0x3184(_0x4e0944,_0x1cf500);}class AdminService{async[a35_0x554eae(0x240)](){const _0x2d27cf=a35_0x554eae;console[_0x2d27cf(0x2dd)](_0x2d27cf(0x305));const _0x2a6b9e=await database_1['default'][_0x2d27cf(0x210)][_0x2d27cf(0x283)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x2d27cf(0x308)}}),_0x34a5d0=await this[_0x2d27cf(0x2ba)]({'page':0x1,'limit':0x3e8}),_0x44b391=await database_1[_0x2d27cf(0x2da)][_0x2d27cf(0x2fe)][_0x2d27cf(0x247)]({'where':{'status':_0x2d27cf(0x25f),'gateway':{'not':_0x2d27cf(0x253)}}}),_0x4e3fc1=new Date(),_0x2f38c4=new Date(_0x4e3fc1['getFullYear'](),_0x4e3fc1['getMonth'](),0x1),_0x3f5134=new Date(_0x4e3fc1[_0x2d27cf(0x2bb)](),_0x4e3fc1[_0x2d27cf(0x309)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x48c670=await database_1[_0x2d27cf(0x2da)][_0x2d27cf(0x257)][_0x2d27cf(0x283)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2f38c4,'lte':_0x3f5134},'status':_0x2d27cf(0x269)}}),_0x4376b3=_0x2a6b9e[_0x2d27cf(0x24b)][_0x2d27cf(0x263)]||0x0,_0x30e7b1=_0x34a5d0[_0x2d27cf(0x246)][_0x2d27cf(0x23b)],_0xc9ffdd=_0x48c670[_0x2d27cf(0x24b)][_0x2d27cf(0x243)]||0x0,_0x26f8ad={'totalPayout':Math[_0x2d27cf(0x2f6)](_0x4376b3*0x64)/0x64,'awaitingPayout':Math[_0x2d27cf(0x2f6)](_0x30e7b1*0x64)/0x64,'thisMonth':Math['round'](_0xc9ffdd*0x64)/0x64,'availableBalance':Math[_0x2d27cf(0x2f6)](_0x30e7b1*0x64)/0x64,'totalPayments':_0x44b391};return console[_0x2d27cf(0x2dd)](_0x2d27cf(0x1e1)),console[_0x2d27cf(0x2dd)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x26f8ad['totalPayout']+_0x2d27cf(0x2cd)),console[_0x2d27cf(0x2dd)](_0x2d27cf(0x2ee)+_0x26f8ad[_0x2d27cf(0x1d9)]+_0x2d27cf(0x2a9)),console['log'](_0x2d27cf(0x1f3)+_0x26f8ad[_0x2d27cf(0x272)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x2d27cf(0x2dd)](_0x2d27cf(0x262)+_0x26f8ad[_0x2d27cf(0x1dc)]+_0x2d27cf(0x29f)),console[_0x2d27cf(0x2dd)](_0x2d27cf(0x24f)+_0x26f8ad[_0x2d27cf(0x2d5)]+_0x2d27cf(0x273)),console['log']('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x2a6b9e['_sum']['balance']||0x0)['toFixed'](0x2)+_0x2d27cf(0x274)),console['log'](_0x2d27cf(0x1f7)+((_0x2a6b9e['_sum'][_0x2d27cf(0x224)]||0x0)-_0x30e7b1)[_0x2d27cf(0x301)](0x2)+_0x2d27cf(0x29f)),_0x26f8ad;}async['updateCustomerData'](_0x2c12a9,_0x488891){const _0x2d41b7=a35_0x554eae;console['log'](_0x2d41b7(0x300)+_0x2c12a9+':',_0x488891);const _0x8253aa=await database_1[_0x2d41b7(0x2da)][_0x2d41b7(0x2fe)][_0x2d41b7(0x2ad)]({'where':{'id':_0x2c12a9},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x8253aa)throw new Error(_0x2d41b7(0x23c));const _0x581b18={};_0x488891[_0x2d41b7(0x266)]!==undefined&&(_0x581b18[_0x2d41b7(0x266)]=_0x488891[_0x2d41b7(0x266)]||null);_0x488891['customerIp']!==undefined&&(_0x581b18[_0x2d41b7(0x2a5)]=_0x488891['customerIp']||null);_0x488891[_0x2d41b7(0x239)]!==undefined&&(_0x581b18[_0x2d41b7(0x239)]=_0x488891[_0x2d41b7(0x239)]||null);const _0x371904=await database_1[_0x2d41b7(0x2da)]['payment']['update']({'where':{'id':_0x2c12a9},'data':{..._0x581b18,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x2d41b7(0x1e7)+_0x2c12a9),console[_0x2d41b7(0x2dd)](_0x2d41b7(0x241)+_0x8253aa[_0x2d41b7(0x266)]+_0x2d41b7(0x267)+_0x371904['customerCountry']),console[_0x2d41b7(0x2dd)]('\x20\x20\x20🌐\x20IP:\x20'+_0x8253aa['customerIp']+'\x20->\x20'+_0x371904[_0x2d41b7(0x2a5)]),console['log'](_0x2d41b7(0x202)+(_0x8253aa['customerUa']?_0x2d41b7(0x2a7):_0x2d41b7(0x2d6))+_0x2d41b7(0x267)+(_0x371904[_0x2d41b7(0x239)]?'set':'not\x20set')),_0x371904;}async[a35_0x554eae(0x21d)](_0x428a3){const _0xc7c71e=a35_0x554eae,_0xe89a2c=new Date();let _0x5d7402;switch(_0x428a3){case'7d':_0x5d7402=new Date(_0xe89a2c['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5d7402=new Date(_0xe89a2c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xc7c71e(0x1e5):_0x5d7402=new Date(_0xe89a2c['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0xc7c71e(0x2ea):const _0x4c7409=await database_1[_0xc7c71e(0x2da)][_0xc7c71e(0x2fe)][_0xc7c71e(0x265)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x5d7402=_0x4c7409?_0x4c7409[_0xc7c71e(0x249)]:new Date(_0xc7c71e(0x208)),console[_0xc7c71e(0x2dd)](_0xc7c71e(0x2f3)+_0x5d7402[_0xc7c71e(0x2b8)]());break;default:_0x5d7402=new Date(_0xe89a2c[_0xc7c71e(0x1fb)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4115a8,_0x3d50fe,_0x57bc55,_0x2a5f3b,_0x57acd5,_0x424915,_0x3f4324]=await Promise[_0xc7c71e(0x2ea)]([database_1[_0xc7c71e(0x2da)][_0xc7c71e(0x210)][_0xc7c71e(0x247)](),database_1[_0xc7c71e(0x2da)][_0xc7c71e(0x210)][_0xc7c71e(0x247)]({'where':{'status':'ACTIVE'}}),database_1[_0xc7c71e(0x2da)][_0xc7c71e(0x2fe)][_0xc7c71e(0x247)]({'where':{'createdAt':{'gte':_0x5d7402},'gateway':{'not':_0xc7c71e(0x253)}}}),database_1['default'][_0xc7c71e(0x2fe)][_0xc7c71e(0x247)]({'where':{'status':_0xc7c71e(0x25f),'createdAt':{'gte':_0x5d7402},'gateway':{'not':_0xc7c71e(0x253)}}}),database_1[_0xc7c71e(0x2da)][_0xc7c71e(0x2fe)][_0xc7c71e(0x28b)]({'where':{'status':_0xc7c71e(0x25f),'createdAt':{'gte':_0x5d7402},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0xc7c71e(0x2da)]['payment'][_0xc7c71e(0x28b)]({'where':{'gateway':{'not':_0xc7c71e(0x253)}},'take':0xa,'orderBy':{'createdAt':_0xc7c71e(0x20a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xc7c71e(0x2da)]['payment']['findMany']({'where':{'createdAt':{'gte':_0x5d7402},'gateway':{'not':_0xc7c71e(0x253)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x31cb0f=0x0;for(const _0x145a4f of _0x57acd5){const _0x3b16c2=await currencyService_1[_0xc7c71e(0x24d)][_0xc7c71e(0x282)](_0x145a4f[_0xc7c71e(0x243)],_0x145a4f['currency']);_0x31cb0f+=_0x3b16c2;}const _0x1e7f48=this['generateDailyStatistics'](_0x3f4324,_0x5d7402,_0xe89a2c),_0x19bb7f=_0x57bc55>0x0?_0x2a5f3b/_0x57bc55*0x64:0x0;return{'totalShops':_0x4115a8,'activeShops':_0x3d50fe,'totalPayments':_0x57bc55,'successfulPayments':_0x2a5f3b,'totalRevenue':Math[_0xc7c71e(0x2f6)](_0x31cb0f*0x64)/0x64,'conversionRate':Math[_0xc7c71e(0x2f6)](_0x19bb7f*0x64)/0x64,'dailyRevenue':_0x1e7f48[_0xc7c71e(0x286)],'dailyPayments':_0x1e7f48[_0xc7c71e(0x250)],'recentPayments':_0x424915[_0xc7c71e(0x227)](_0x3824dd=>({'id':_0x3824dd['id'],'amount':_0x3824dd[_0xc7c71e(0x243)],'currency':_0x3824dd[_0xc7c71e(0x2c2)],'status':_0x3824dd[_0xc7c71e(0x2dc)],'gateway':_0x3824dd[_0xc7c71e(0x1dd)],'shop':_0x3824dd[_0xc7c71e(0x210)],'createdAt':_0x3824dd[_0xc7c71e(0x249)]}))};}async['getMerchantStatistics'](_0x4d062b){const _0x8257d9=a35_0x554eae;console[_0x8257d9(0x2dd)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x4d062b);let _0xb0c704,_0x341f9d=new Date();if(_0x4d062b[_0x8257d9(0x2e5)]===_0x8257d9(0x30b)&&_0x4d062b[_0x8257d9(0x259)]&&_0x4d062b['dateTo'])_0xb0c704=new Date(_0x4d062b[_0x8257d9(0x259)]),_0x341f9d=new Date(_0x4d062b[_0x8257d9(0x1d6)]);else{const _0x27346b=new Date();switch(_0x4d062b[_0x8257d9(0x2e5)]){case _0x8257d9(0x238):_0xb0c704=new Date(_0x27346b[_0x8257d9(0x1fb)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x8257d9(0x2bc):_0xb0c704=new Date(_0x27346b[_0x8257d9(0x1fb)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0xb0c704=new Date(_0x27346b['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0xb0c704=new Date(_0x8257d9(0x208));break;}}console[_0x8257d9(0x2dd)]('📅\x20Period:\x20'+_0xb0c704['toISOString']()+_0x8257d9(0x25e)+_0x341f9d[_0x8257d9(0x2b8)]());const _0xc0ca18={'status':_0x8257d9(0x25f),'gateway':{'not':_0x8257d9(0x253)},'paidAt':{'gte':_0xb0c704,'lte':_0x341f9d}};_0x4d062b['shopId']&&(_0xc0ca18[_0x8257d9(0x276)]=_0x4d062b[_0x8257d9(0x276)]);const _0x5807f2=await database_1[_0x8257d9(0x2da)][_0x8257d9(0x2fe)][_0x8257d9(0x28b)]({'where':_0xc0ca18,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x8257d9(0x1f0)+_0x5807f2['length']+_0x8257d9(0x1df));const _0x389e9a={'gateway':{'not':_0x8257d9(0x253)},'createdAt':{'gte':_0xb0c704,'lte':_0x341f9d}};_0x4d062b[_0x8257d9(0x276)]&&(_0x389e9a[_0x8257d9(0x276)]=_0x4d062b[_0x8257d9(0x276)]);const _0x47caed=await database_1[_0x8257d9(0x2da)][_0x8257d9(0x2fe)]['count']({'where':_0x389e9a});console['log']('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x47caed+_0x8257d9(0x2fb)+_0x5807f2['length']);let _0x3ee972=0x0,_0x42485f=0x0,_0xefeee1=0x0;const _0x5be06e={},_0x32229f={},_0x52f8e3={};for(const _0x994d4a of _0x5807f2){try{const _0x35e453=await currencyService_1[_0x8257d9(0x24d)][_0x8257d9(0x282)](_0x994d4a[_0x8257d9(0x243)],_0x994d4a['currency']);let _0x41df80={};if(_0x994d4a['shop']['gatewaySettings'])try{_0x41df80=JSON['parse'](_0x994d4a[_0x8257d9(0x210)][_0x8257d9(0x1d8)]);}catch(_0x1d1ce1){console[_0x8257d9(0x2b7)](_0x8257d9(0x2f1)+_0x994d4a[_0x8257d9(0x276)]+':',_0x1d1ce1);}let _0x5bd3db={},_0x238aa7=0xa;for(const [_0x45b3fc,_0x3b43c0]of Object[_0x8257d9(0x204)](_0x41df80)){if(_0x45b3fc[_0x8257d9(0x218)]()===_0x994d4a[_0x8257d9(0x1dd)][_0x8257d9(0x218)]()){_0x5bd3db=_0x3b43c0,_0x238aa7=_0x3b43c0[_0x8257d9(0x2e4)]||0xa;break;}}const _0x2c5ef5=_0x35e453*(_0x238aa7/0x64),_0x5e62b4=_0x35e453-_0x2c5ef5;_0x3ee972+=_0x35e453,_0x42485f+=_0x5e62b4,_0xefeee1+=_0x2c5ef5;!_0x5be06e[_0x994d4a[_0x8257d9(0x1dd)]]&&(_0x5be06e[_0x994d4a['gateway']]={'gateway':_0x994d4a['gateway'],'gatewayDisplayName':this[_0x8257d9(0x27f)](_0x994d4a[_0x8257d9(0x1dd)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5be06e[_0x994d4a['gateway']][_0x8257d9(0x2a2)]++,_0x5be06e[_0x994d4a[_0x8257d9(0x1dd)]]['turnoverUSDT']+=_0x35e453,_0x5be06e[_0x994d4a['gateway']]['commissionUSDT']+=_0x2c5ef5,_0x5be06e[_0x994d4a['gateway']][_0x8257d9(0x1fe)]+=_0x5e62b4,_0x5be06e[_0x994d4a[_0x8257d9(0x1dd)]]['totalCommissionRate']+=_0x238aa7;!_0x4d062b[_0x8257d9(0x276)]&&(!_0x32229f[_0x994d4a[_0x8257d9(0x276)]]&&(_0x32229f[_0x994d4a['shopId']]={'shopId':_0x994d4a['shopId'],'shopName':_0x994d4a[_0x8257d9(0x210)][_0x8257d9(0x1d7)],'shopUsername':_0x994d4a[_0x8257d9(0x210)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x32229f[_0x994d4a['shopId']][_0x8257d9(0x2a2)]++,_0x32229f[_0x994d4a[_0x8257d9(0x276)]][_0x8257d9(0x2a8)]+=_0x35e453,_0x32229f[_0x994d4a[_0x8257d9(0x276)]][_0x8257d9(0x28f)]+=_0x2c5ef5,_0x32229f[_0x994d4a[_0x8257d9(0x276)]][_0x8257d9(0x1fe)]+=_0x5e62b4);const _0x363d5b=_0x994d4a[_0x8257d9(0x225)][_0x8257d9(0x2b8)]()[_0x8257d9(0x1fc)]('T')[0x0];!_0x52f8e3[_0x363d5b]&&(_0x52f8e3[_0x363d5b]={'date':_0x363d5b,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x52f8e3[_0x363d5b][_0x8257d9(0x236)]+=_0x35e453,_0x52f8e3[_0x363d5b]['merchantEarnings']+=_0x5e62b4,_0x52f8e3[_0x363d5b][_0x8257d9(0x293)]+=_0x2c5ef5,_0x52f8e3[_0x363d5b][_0x8257d9(0x2a2)]++;}catch(_0x88bc63){console[_0x8257d9(0x2b7)](_0x8257d9(0x21c)+_0x994d4a['id']+':',_0x88bc63);}}Object['values'](_0x5be06e)[_0x8257d9(0x294)](_0x1b2c48=>{const _0x308ed5=_0x8257d9;_0x1b2c48['averageCommissionRate']=_0x1b2c48[_0x308ed5(0x2a2)]>0x0?_0x1b2c48[_0x308ed5(0x2c5)]/_0x1b2c48[_0x308ed5(0x2a2)]:0x0,delete _0x1b2c48[_0x308ed5(0x2c5)];}),Object['values'](_0x32229f)[_0x8257d9(0x294)](_0x2ec54f=>{const _0x2be575=_0x8257d9;_0x2ec54f[_0x2be575(0x2bd)]=_0x2ec54f['paymentsCount']>0x0?_0x2ec54f[_0x2be575(0x2a8)]/_0x2ec54f['paymentsCount']:0x0;});let _0x3744a9=0x0;if(_0x4d062b[_0x8257d9(0x276)]){const _0x3f1b27=await database_1['default'][_0x8257d9(0x257)][_0x8257d9(0x28b)]({'where':{'shopId':_0x4d062b[_0x8257d9(0x276)],'status':_0x8257d9(0x269),'createdAt':{'gte':_0xb0c704,'lte':_0x341f9d}},'select':{'amount':!![]}});_0x3744a9=_0x3f1b27[_0x8257d9(0x2ca)]((_0x495594,_0xdd55a3)=>_0x495594+_0xdd55a3['amount'],0x0);}const _0x496eaa=_0x47caed,_0x389a01=_0x5807f2[_0x8257d9(0x25a)],_0x1b32b6=_0x389a01>0x0?_0x3ee972/_0x389a01:0x0,_0x8715e0=_0x496eaa>0x0?Math[_0x8257d9(0x2f6)](_0x389a01/_0x496eaa*0x2710)/0x64:0x0,_0x48df68=Math['ceil']((_0x341f9d[_0x8257d9(0x1fb)]()-_0xb0c704[_0x8257d9(0x1fb)]())/(0x3e8*0x3c*0x3c*0x18)),_0x453f62={'totalTurnover':Math[_0x8257d9(0x2f6)](_0x3ee972*0x64)/0x64,'merchantEarnings':Math[_0x8257d9(0x2f6)](_0x42485f*0x64)/0x64,'gatewayEarnings':Math['round'](_0xefeee1*0x64)/0x64,'totalPaidOut':Math['round'](_0x3744a9*0x64)/0x64,'averageCheck':Math[_0x8257d9(0x2f6)](_0x1b32b6*0x64)/0x64,'totalPayments':_0x496eaa,'successfulPayments':_0x389a01,'conversionRate':_0x8715e0,'gatewayBreakdown':Object['values'](_0x5be06e)[_0x8257d9(0x227)](_0x38f1ca=>({..._0x38f1ca,'turnoverUSDT':Math[_0x8257d9(0x2f6)](_0x38f1ca[_0x8257d9(0x2a8)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x38f1ca[_0x8257d9(0x28f)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x38f1ca['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x38f1ca['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x4d062b[_0x8257d9(0x276)]?undefined:Object[_0x8257d9(0x297)](_0x32229f)['map'](_0x82b329=>({..._0x82b329,'turnoverUSDT':Math[_0x8257d9(0x2f6)](_0x82b329['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x8257d9(0x2f6)](_0x82b329['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x8257d9(0x2f6)](_0x82b329[_0x8257d9(0x1fe)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x82b329[_0x8257d9(0x222)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x82b329[_0x8257d9(0x2bd)]*0x64)/0x64})),'dailyData':Object[_0x8257d9(0x297)](_0x52f8e3)['map'](_0x41333e=>({..._0x41333e,'turnover':Math[_0x8257d9(0x2f6)](_0x41333e[_0x8257d9(0x236)]*0x64)/0x64,'merchantEarnings':Math[_0x8257d9(0x2f6)](_0x41333e['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x41333e[_0x8257d9(0x293)]*0x64)/0x64}))['sort']((_0x46927c,_0x4df1c7)=>_0x46927c['date'][_0x8257d9(0x1f6)](_0x4df1c7['date'])),'periodInfo':{'from':_0xb0c704,'to':_0x341f9d,'periodType':_0x4d062b['period']||'custom','daysCount':_0x48df68}};return console['log']('📊\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x8257d9(0x292)+_0x453f62[_0x8257d9(0x24e)]+_0x8257d9(0x29f)),console['log']('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x453f62[_0x8257d9(0x233)]+_0x8257d9(0x29f)),console['log'](_0x8257d9(0x296)+_0x453f62[_0x8257d9(0x293)]+_0x8257d9(0x29f)),console[_0x8257d9(0x2dd)](_0x8257d9(0x2ce)+_0x453f62[_0x8257d9(0x2d5)]),_0x453f62;}async['getMerchantsSelection'](){const _0x3aeffe=a35_0x554eae;console[_0x3aeffe(0x2dd)](_0x3aeffe(0x2b4));const _0x2446a5=await database_1['default'][_0x3aeffe(0x210)]['findMany']({'where':{'status':_0x3aeffe(0x308)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x3aeffe(0x2dd)](_0x3aeffe(0x231)+_0x2446a5[_0x3aeffe(0x25a)]+_0x3aeffe(0x228)),_0x2446a5['map'](_0x1c33aa=>({'id':_0x1c33aa['id'],'username':_0x1c33aa[_0x3aeffe(0x1d5)],'name':_0x1c33aa[_0x3aeffe(0x1d7)]}));}['getGatewayDisplayName'](_0x1adb82){const _0x19a532=a35_0x554eae,_0x562a39={'test_gateway':'Test\x20Gateway','plisio':_0x19a532(0x25d),'rapyd':'Rapyd','noda':'Noda','cointopay':_0x19a532(0x22f),'cointopay2':_0x19a532(0x1de),'klyme_eu':_0x19a532(0x2b6),'klyme_gb':_0x19a532(0x211),'klyme_de':_0x19a532(0x23a),'mastercard':_0x19a532(0x30d)};return _0x562a39[_0x1adb82]||_0x1adb82;}[a35_0x554eae(0x245)](_0x400013){const _0x458e03=a35_0x554eae,_0xee1a17={'Test\x20Gateway':'test_gateway','Plisio':'plisio','Rapyd':_0x458e03(0x2f5),'Noda':'noda','CoinToPay':_0x458e03(0x2de),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x458e03(0x232),'KLYME\x20GB':_0x458e03(0x27a),'KLYME\x20DE':_0x458e03(0x302),'MasterCard':_0x458e03(0x230)};return _0xee1a17[_0x400013]||_0x400013[_0x458e03(0x218)]();}async[a35_0x554eae(0x2ba)](_0x4a83e6){const _0x2d8d89=a35_0x554eae,{page:_0xfe1c1c,limit:_0x3219df,minAmount:_0x50dced,search:_0x308c7f}=_0x4a83e6,_0x45e510=(_0xfe1c1c-0x1)*_0x3219df;console[_0x2d8d89(0x2dd)](_0x2d8d89(0x304),_0x4a83e6);const _0x53ef42={'balance':{'gt':0x0},'status':_0x2d8d89(0x308)};_0x50dced&&(_0x53ef42[_0x2d8d89(0x224)][_0x2d8d89(0x1f8)]=_0x50dced);_0x308c7f&&(_0x53ef42['OR']=[{'name':{'contains':_0x308c7f,'mode':'insensitive'}},{'username':{'contains':_0x308c7f,'mode':_0x2d8d89(0x2ed)}}]);const [_0x330be4,_0x4d10ba]=await Promise[_0x2d8d89(0x2ea)]([database_1[_0x2d8d89(0x2da)][_0x2d8d89(0x210)][_0x2d8d89(0x28b)]({'where':_0x53ef42,'skip':_0x45e510,'take':_0x3219df,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x2d8d89(0x210)]['count']({'where':_0x53ef42})]);console[_0x2d8d89(0x2dd)]('💰\x20Found\x20'+_0x330be4[_0x2d8d89(0x25a)]+_0x2d8d89(0x20b));const _0x2a3aef=await Promise[_0x2d8d89(0x2ea)](_0x330be4[_0x2d8d89(0x227)](async _0x5e2026=>{const _0x41cebe=_0x2d8d89,[_0x483fed,_0x46e768,_0x4e8684]=await Promise[_0x41cebe(0x2ea)]([database_1[_0x41cebe(0x2da)][_0x41cebe(0x2fe)]['count']({'where':{'shopId':_0x5e2026['id'],'status':'PAID','gateway':{'not':'test_gateway'}}}),database_1[_0x41cebe(0x2da)]['payment']['findFirst']({'where':{'shopId':_0x5e2026['id'],'status':_0x41cebe(0x25f),'gateway':{'not':_0x41cebe(0x253)}},'orderBy':{'paidAt':_0x41cebe(0x20c)},'select':{'paidAt':!![]}}),database_1[_0x41cebe(0x2da)][_0x41cebe(0x2fe)][_0x41cebe(0x2ef)]({'by':[_0x41cebe(0x1dd)],'where':{'shopId':_0x5e2026['id'],'status':'PAID','gateway':{'not':_0x41cebe(0x253)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x17fbb7=new Date(),_0x364259=new Date(_0x17fbb7[_0x41cebe(0x2bb)](),_0x17fbb7[_0x41cebe(0x309)](),0x1),_0x36d8ea=new Date(_0x17fbb7[_0x41cebe(0x2bb)](),_0x17fbb7[_0x41cebe(0x309)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5ed1ce,_0xa562c0]=await Promise['all']([database_1[_0x41cebe(0x2da)][_0x41cebe(0x257)][_0x41cebe(0x283)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5e2026['id'],'status':_0x41cebe(0x269)}}),database_1[_0x41cebe(0x2da)][_0x41cebe(0x257)][_0x41cebe(0x283)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5e2026['id'],'status':_0x41cebe(0x269),'createdAt':{'gte':_0x364259,'lte':_0x36d8ea}}})]),_0x2888e8=_0x5ed1ce[_0x41cebe(0x24b)][_0x41cebe(0x243)]||0x0,_0x30c476=_0xa562c0[_0x41cebe(0x24b)][_0x41cebe(0x243)]||0x0,_0x167e5e=await Promise['all'](_0x4e8684[_0x41cebe(0x227)](async _0x387a61=>{const _0x164584=_0x41cebe;let _0xc960d3=0xa;if(_0x5e2026['gatewaySettings'])try{const _0x5dbe65=JSON[_0x164584(0x2ab)](_0x5e2026[_0x164584(0x1d8)]);for(const [_0x12a7e2,_0x29ec42]of Object['entries'](_0x5dbe65)){if(_0x12a7e2[_0x164584(0x218)]()===_0x387a61[_0x164584(0x1dd)][_0x164584(0x218)]()){_0xc960d3=_0x29ec42['commission']||0xa,console[_0x164584(0x2dd)](_0x164584(0x1f9)+_0x387a61[_0x164584(0x1dd)]+_0x164584(0x288)+_0x5e2026['id']+_0x164584(0x25c)+_0xc960d3+'%');break;}}}catch(_0x133ffb){console[_0x164584(0x2b7)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x5e2026['id']+':',_0x133ffb);}const _0x5c84aa=_0x387a61[_0x164584(0x24b)]['amountUSDT']||0x0,_0x134900=_0x5c84aa*(0x1-_0xc960d3/0x64);return{'gateway':_0x387a61['gateway'],'count':_0x387a61[_0x164584(0x1e2)]['id'],'amountUSDT':Math[_0x164584(0x2f6)](_0x5c84aa*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x164584(0x2f6)](_0x134900*0x64)/0x64,'commission':_0xc960d3};})),_0xeab3ca=_0x167e5e[_0x41cebe(0x2ca)]((_0x2cbecc,_0x20e721)=>_0x2cbecc+_0x20e721[_0x41cebe(0x27c)],0x0),_0x255ae2=_0x5e2026['balance'];return console[_0x41cebe(0x2dd)]('💰\x20[PAYOUT]\x20Merchant\x20'+_0x5e2026[_0x41cebe(0x1d5)]+':'),console[_0x41cebe(0x2dd)](_0x41cebe(0x255)+_0xeab3ca[_0x41cebe(0x301)](0x2)+_0x41cebe(0x299)),console['log'](_0x41cebe(0x2be)+_0x167e5e['reduce']((_0x31140d,_0x10ea7b)=>_0x31140d+_0x10ea7b[_0x41cebe(0x287)],0x0)[_0x41cebe(0x301)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x41cebe(0x2dd)](_0x41cebe(0x291)+_0x255ae2[_0x41cebe(0x301)](0x2)+_0x41cebe(0x207)),{'id':_0x5e2026['id'],'fullName':_0x5e2026['name'],'username':_0x5e2026[_0x41cebe(0x1d5)],'telegramId':_0x5e2026['telegram'],'merchantUrl':_0x5e2026[_0x41cebe(0x2f2)],'wallets':{'usdtPolygonWallet':_0x5e2026[_0x41cebe(0x221)],'usdtTrcWallet':_0x5e2026[_0x41cebe(0x2b1)],'usdtErcWallet':_0x5e2026['usdtErcWallet'],'usdcPolygonWallet':_0x5e2026[_0x41cebe(0x2b2)]},'totalAmountUSDT':Math[_0x41cebe(0x2f6)](_0xeab3ca*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x41cebe(0x2f6)](_0x255ae2*0x64)/0x64,'totalPayout':Math[_0x41cebe(0x2f6)](_0x2888e8*0x64)/0x64,'thisMonth':Math[_0x41cebe(0x2f6)](_0x30c476*0x64)/0x64,'paymentsCount':_0x483fed,'oldestPaymentDate':_0x46e768?.['paidAt']||_0x5e2026['createdAt'],'gatewayBreakdown':_0x167e5e};})),_0x310182=_0x2a3aef[_0x2d8d89(0x2ca)]((_0x38f924,_0x4c43bb)=>_0x38f924+_0x4c43bb[_0x2d8d89(0x23e)],0x0),_0x46e7d6=_0x2a3aef[_0x2d8d89(0x2ca)]((_0x3aafa2,_0x5068ed)=>_0x3aafa2+_0x5068ed['totalAmountAfterCommissionUSDT'],0x0),_0x454021=_0x2a3aef[_0x2d8d89(0x2ca)]((_0x49fa89,_0x2c728e)=>_0x49fa89+_0x2c728e[_0x2d8d89(0x2eb)],0x0),_0x58429d=_0x2a3aef[_0x2d8d89(0x2ca)]((_0xdbbe70,_0x4e4dd6)=>_0xdbbe70+_0x4e4dd6[_0x2d8d89(0x1dc)],0x0);return console['log'](_0x2d8d89(0x25b)+_0x4d10ba+_0x2d8d89(0x206)),console[_0x2d8d89(0x2dd)](_0x2d8d89(0x1ee)+Math[_0x2d8d89(0x2f6)](_0x310182*0x64)/0x64+_0x2d8d89(0x299)),console['log'](_0x2d8d89(0x21f)+Math[_0x2d8d89(0x2f6)](_0x46e7d6*0x64)/0x64+_0x2d8d89(0x2ac)),console[_0x2d8d89(0x2dd)](_0x2d8d89(0x248)+Math['round'](_0x454021*0x64)/0x64+'\x20USDT'),console['log'](_0x2d8d89(0x205)+Math[_0x2d8d89(0x2f6)](_0x58429d*0x64)/0x64+_0x2d8d89(0x29f)),{'merchants':_0x2a3aef,'pagination':{'page':_0xfe1c1c,'limit':_0x3219df,'total':_0x4d10ba,'totalPages':Math[_0x2d8d89(0x2a1)](_0x4d10ba/_0x3219df)},'summary':{'totalMerchants':_0x4d10ba,'totalAmountUSDT':Math[_0x2d8d89(0x2f6)](_0x310182*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2d8d89(0x2f6)](_0x46e7d6*0x64)/0x64,'totalPayout':Math['round'](_0x454021*0x64)/0x64,'thisMonth':Math[_0x2d8d89(0x2f6)](_0x58429d*0x64)/0x64}};}async[a35_0x554eae(0x2fc)](_0x9adfb){const _0x4d200b=a35_0x554eae,{shopId:_0x189756,amount:_0x52870e,network:_0x42fd8d,wallet:_0x205ce0,notes:_0xdedd27,txid:_0x505f52,periodFrom:_0x6c57d8,periodTo:_0x403af1}=_0x9adfb,_0x52d116=await database_1['default']['$transaction'](async _0x76d008=>{const _0x3b4bf3=a35_0x3184,_0x23ad52=await _0x76d008[_0x3b4bf3(0x210)]['findUnique']({'where':{'id':_0x189756},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x23ad52)throw new Error(_0x3b4bf3(0x215));console[_0x3b4bf3(0x2dd)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x23ad52[_0x3b4bf3(0x1d5)]+':'),console['log']('\x20\x20\x20Current\x20balance:\x20'+_0x23ad52[_0x3b4bf3(0x224)][_0x3b4bf3(0x301)](0x6)+_0x3b4bf3(0x29f)),console[_0x3b4bf3(0x2dd)](_0x3b4bf3(0x256)+_0x52870e['toFixed'](0x6)+_0x3b4bf3(0x29f)),console[_0x3b4bf3(0x2dd)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x23ad52[_0x3b4bf3(0x263)][_0x3b4bf3(0x301)](0x6)+_0x3b4bf3(0x29f));if(_0x505f52)console[_0x3b4bf3(0x2dd)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x505f52);if(_0x23ad52['balance']<_0x52870e)throw new Error(_0x3b4bf3(0x1fa)+_0x23ad52['balance'][_0x3b4bf3(0x301)](0x6)+_0x3b4bf3(0x213)+_0x52870e['toFixed'](0x6)+_0x3b4bf3(0x29f));let _0x5d4185=_0x205ce0;if(!_0x5d4185){const _0x28071d=await _0x76d008['shop'][_0x3b4bf3(0x2ad)]({'where':{'id':_0x189756},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x28071d)switch(_0x42fd8d){case _0x3b4bf3(0x270):_0x5d4185=_0x28071d[_0x3b4bf3(0x221)]||undefined;break;case _0x3b4bf3(0x21e):_0x5d4185=_0x28071d[_0x3b4bf3(0x2b1)]||undefined;break;case _0x3b4bf3(0x2f4):_0x5d4185=_0x28071d[_0x3b4bf3(0x2e2)]||undefined;break;case _0x3b4bf3(0x2e9):_0x5d4185=_0x28071d[_0x3b4bf3(0x2b2)]||undefined;break;}}console[_0x3b4bf3(0x2dd)](_0x3b4bf3(0x290)+_0x42fd8d+':\x20'+(_0x5d4185||_0x3b4bf3(0x23d)));const _0x229f97=await _0x76d008[_0x3b4bf3(0x257)][_0x3b4bf3(0x22a)]({'data':{'shopId':_0x189756,'amount':_0x52870e,'network':_0x42fd8d,'status':_0x3b4bf3(0x269),'txid':_0x505f52,'notes':_0xdedd27,'periodFrom':_0x6c57d8?new Date(_0x6c57d8):null,'periodTo':_0x403af1?new Date(_0x403af1):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x42fc95=_0x23ad52[_0x3b4bf3(0x224)]-_0x52870e,_0x53048e=_0x23ad52['totalPaidOut']+_0x52870e;return await _0x76d008[_0x3b4bf3(0x210)][_0x3b4bf3(0x26a)]({'where':{'id':_0x189756},'data':{'balance':_0x42fc95,'totalPaidOut':_0x53048e}}),console[_0x3b4bf3(0x2dd)](_0x3b4bf3(0x306)+_0x23ad52[_0x3b4bf3(0x1d5)]+_0x3b4bf3(0x20e)),console[_0x3b4bf3(0x2dd)](_0x3b4bf3(0x2c0)+_0x23ad52[_0x3b4bf3(0x224)][_0x3b4bf3(0x301)](0x6)+'\x20->\x20'+_0x42fc95[_0x3b4bf3(0x301)](0x6)+_0x3b4bf3(0x2f7)+_0x52870e[_0x3b4bf3(0x301)](0x6)+')'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x23ad52[_0x3b4bf3(0x263)][_0x3b4bf3(0x301)](0x6)+'\x20->\x20'+_0x53048e['toFixed'](0x6)+_0x3b4bf3(0x27b)+_0x52870e[_0x3b4bf3(0x301)](0x6)+')'),{'payout':_0x229f97,'shop':_0x23ad52};});return console[_0x4d200b(0x2dd)]('✅\x20Payout\x20created:\x20'+_0x52d116[_0x4d200b(0x257)]['id']+_0x4d200b(0x288)+_0x52d116[_0x4d200b(0x210)][_0x4d200b(0x1d5)]+'\x20('+_0x52870e+'\x20USDT)'),{'id':_0x52d116[_0x4d200b(0x257)]['id'],'shopId':_0x52d116[_0x4d200b(0x257)][_0x4d200b(0x276)],'shopName':_0x52d116['shop']['name'],'shopUsername':_0x52d116[_0x4d200b(0x210)][_0x4d200b(0x1d5)],'amount':_0x52d116[_0x4d200b(0x257)]['amount'],'network':_0x52d116['payout'][_0x4d200b(0x226)],'status':_0x52d116['payout'][_0x4d200b(0x2dc)],'txid':_0x52d116['payout'][_0x4d200b(0x307)],'notes':_0x52d116[_0x4d200b(0x257)][_0x4d200b(0x2c9)],'periodFrom':_0x52d116[_0x4d200b(0x257)][_0x4d200b(0x2f9)],'periodTo':_0x52d116[_0x4d200b(0x257)][_0x4d200b(0x216)],'createdAt':_0x52d116['payout'][_0x4d200b(0x249)],'paidAt':_0x52d116[_0x4d200b(0x257)][_0x4d200b(0x225)]};}async[a35_0x554eae(0x2a4)](_0x4079eb){const _0x5ab60b=a35_0x554eae,{page:_0x2271bb,limit:_0x2a398e,shopId:_0x4636f2,network:_0x304abe,dateFrom:_0xa06e47,dateTo:_0x28dbfa,search:_0xe44ddf}=_0x4079eb,_0x4ed0fe=(_0x2271bb-0x1)*_0x2a398e,_0x12aa5f={};_0x4636f2&&(_0x12aa5f['shopId']=_0x4636f2);_0x304abe&&(_0x12aa5f[_0x5ab60b(0x226)]=_0x304abe);(_0xa06e47||_0x28dbfa)&&(_0x12aa5f[_0x5ab60b(0x249)]={},_0xa06e47&&(_0x12aa5f[_0x5ab60b(0x249)][_0x5ab60b(0x1f8)]=new Date(_0xa06e47)),_0x28dbfa&&(_0x12aa5f['createdAt'][_0x5ab60b(0x303)]=new Date(_0x28dbfa)));_0xe44ddf&&(_0x12aa5f['OR']=[{'shop':{'name':{'contains':_0xe44ddf,'mode':_0x5ab60b(0x2ed)}}},{'shop':{'username':{'contains':_0xe44ddf,'mode':_0x5ab60b(0x2ed)}}},{'notes':{'contains':_0xe44ddf,'mode':_0x5ab60b(0x2ed)}}]);const [_0x111504,_0x18c281]=await Promise[_0x5ab60b(0x2ea)]([database_1[_0x5ab60b(0x2da)][_0x5ab60b(0x257)][_0x5ab60b(0x28b)]({'where':_0x12aa5f,'skip':_0x4ed0fe,'take':_0x2a398e,'orderBy':{'createdAt':_0x5ab60b(0x20a)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5ab60b(0x2da)][_0x5ab60b(0x257)][_0x5ab60b(0x247)]({'where':_0x12aa5f})]);return{'payouts':_0x111504['map'](_0x41dd35=>({'id':_0x41dd35['id'],'shopId':_0x41dd35['shopId'],'shopName':_0x41dd35[_0x5ab60b(0x210)][_0x5ab60b(0x1d7)],'shopUsername':_0x41dd35[_0x5ab60b(0x210)]['username'],'amount':_0x41dd35[_0x5ab60b(0x243)],'network':_0x41dd35[_0x5ab60b(0x226)],'status':_0x41dd35[_0x5ab60b(0x2dc)],'txid':_0x41dd35[_0x5ab60b(0x307)],'notes':_0x41dd35[_0x5ab60b(0x2c9)],'periodFrom':_0x41dd35[_0x5ab60b(0x2f9)],'periodTo':_0x41dd35[_0x5ab60b(0x216)],'createdAt':_0x41dd35[_0x5ab60b(0x249)],'paidAt':_0x41dd35[_0x5ab60b(0x225)]})),'pagination':{'page':_0x2271bb,'limit':_0x2a398e,'total':_0x18c281,'totalPages':Math[_0x5ab60b(0x2a1)](_0x18c281/_0x2a398e)}};}async[a35_0x554eae(0x271)](_0x42092d){const _0xc2a5b2=a35_0x554eae,_0x2f5534=await database_1[_0xc2a5b2(0x2da)][_0xc2a5b2(0x257)][_0xc2a5b2(0x2ad)]({'where':{'id':_0x42092d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2f5534)return null;return{'id':_0x2f5534['id'],'shopId':_0x2f5534[_0xc2a5b2(0x276)],'shopName':_0x2f5534[_0xc2a5b2(0x210)][_0xc2a5b2(0x1d7)],'shopUsername':_0x2f5534[_0xc2a5b2(0x210)][_0xc2a5b2(0x1d5)],'amount':_0x2f5534[_0xc2a5b2(0x243)],'network':_0x2f5534[_0xc2a5b2(0x226)],'status':_0x2f5534[_0xc2a5b2(0x2dc)],'txid':_0x2f5534[_0xc2a5b2(0x307)],'notes':_0x2f5534['notes'],'periodFrom':_0x2f5534[_0xc2a5b2(0x2f9)],'periodTo':_0x2f5534[_0xc2a5b2(0x216)],'createdAt':_0x2f5534[_0xc2a5b2(0x249)],'paidAt':_0x2f5534[_0xc2a5b2(0x225)]};}async['deletePayout'](_0x193fe5){const _0x479f51=a35_0x554eae;await database_1[_0x479f51(0x2da)][_0x479f51(0x257)][_0x479f51(0x2c1)]({'where':{'id':_0x193fe5}});}async[a35_0x554eae(0x2c7)](_0x559f8a){const _0x29753c=a35_0x554eae,{page:_0x2cddb0,limit:_0x3e94f0,status:_0x5a4407,gateway:_0x241932,shopId:_0x527eb1,dateFrom:_0x4fa948,dateTo:_0x45fda2,search:_0xfdb988,currency:_0x37e8fa,sortBy:_0x49c9da,sortOrder:_0xfea5e0}=_0x559f8a,_0x59df26=(_0x2cddb0-0x1)*_0x3e94f0;console[_0x29753c(0x2dd)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x559f8a);const _0x1047f5=await database_1[_0x29753c(0x2da)][_0x29753c(0x2fe)][_0x29753c(0x2ef)]({'by':[_0x29753c(0x1dd)],'_count':{'gateway':!![]}});console[_0x29753c(0x2dd)]('📊\x20Available\x20gateways\x20in\x20database:',_0x1047f5[_0x29753c(0x227)](_0x5cf781=>_0x5cf781['gateway']+'\x20('+_0x5cf781[_0x29753c(0x1e2)][_0x29753c(0x1dd)]+_0x29753c(0x201)));if(_0x241932){const _0x542052=_0x1047f5[_0x29753c(0x2a6)](_0x192e17=>_0x192e17[_0x29753c(0x1dd)][_0x29753c(0x218)]()===_0x241932[_0x29753c(0x218)]());!_0x542052&&_0x241932[_0x29753c(0x218)]()!==_0x29753c(0x253)&&console[_0x29753c(0x2dd)](_0x29753c(0x2a3)+_0x241932+_0x29753c(0x1db)+_0x1047f5[_0x29753c(0x227)](_0x4fe6fb=>_0x4fe6fb[_0x29753c(0x1dd)])[_0x29753c(0x2cb)](',\x20'));}const _0x21bcc6={};_0x5a4407&&(_0x21bcc6[_0x29753c(0x2dc)]=_0x5a4407[_0x29753c(0x29b)]());if(!_0x241932)_0x21bcc6['gateway']={'not':_0x29753c(0x253)};else{if(_0x241932&&(_0x241932['toLowerCase']()===_0x29753c(0x253)||_0x241932===_0x29753c(0x29c)))_0x21bcc6[_0x29753c(0x1dd)]=_0x29753c(0x253);else{let _0xffd72e=_0x241932;const _0x3b0986=(0x0,gateway_1['getGatewayNameById'])(_0x241932);if(_0x3b0986)_0xffd72e=_0x3b0986,console[_0x29753c(0x2dd)](_0x29753c(0x223)+_0x241932+_0x29753c(0x2ec)+_0xffd72e+'\x27');else{const _0x1671d7=(0x0,gateway_1[_0x29753c(0x2c3)])(_0x241932);if(_0x1671d7){const _0x37f7e6=(0x0,gateway_1[_0x29753c(0x2fa)])(_0x1671d7);_0x37f7e6&&(_0xffd72e=_0x37f7e6,console[_0x29753c(0x2dd)](_0x29753c(0x203)+_0x241932+'\x27\x20->\x20ID\x20\x27'+_0x1671d7+_0x29753c(0x2d2)+_0xffd72e+'\x27'));}else console['log'](_0x29753c(0x28e)+_0x241932+_0x29753c(0x277));}const _0x3e2c67=await database_1[_0x29753c(0x2da)][_0x29753c(0x2fe)]['count']({'where':{'gateway':_0xffd72e['toLowerCase']()},'take':0x1});_0x3e2c67===0x0?(console[_0x29753c(0x2dd)](_0x29753c(0x2e0)+_0xffd72e+_0x29753c(0x24a)+_0x241932+_0x29753c(0x2d9)),_0x21bcc6['gateway']=_0x29753c(0x278)):(_0x21bcc6[_0x29753c(0x1dd)]=_0xffd72e[_0x29753c(0x218)](),console['log'](_0x29753c(0x21a)+_0xffd72e+'\x27\x20(from\x20\x27'+_0x241932+'\x27)'));}}console[_0x29753c(0x2dd)](_0x29753c(0x1ea),_0x21bcc6['gateway']);_0x527eb1&&(_0x21bcc6[_0x29753c(0x276)]=_0x527eb1);_0x37e8fa&&(_0x21bcc6[_0x29753c(0x2c2)]=_0x37e8fa[_0x29753c(0x29b)](),console[_0x29753c(0x2dd)](_0x29753c(0x26f)+_0x37e8fa[_0x29753c(0x29b)]()));(_0x4fa948||_0x45fda2)&&(_0x21bcc6[_0x29753c(0x249)]={},_0x4fa948&&(_0x21bcc6[_0x29753c(0x249)][_0x29753c(0x1f8)]=new Date(_0x4fa948)),_0x45fda2&&(_0x21bcc6['createdAt'][_0x29753c(0x303)]=new Date(_0x45fda2)));_0xfdb988&&(_0x21bcc6['OR']=[{'id':{'contains':_0xfdb988,'mode':_0x29753c(0x2ed)}},{'orderId':{'contains':_0xfdb988,'mode':_0x29753c(0x2ed)}},{'gatewayOrderId':{'contains':_0xfdb988,'mode':'insensitive'}},{'customerEmail':{'contains':_0xfdb988,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xfdb988,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0xfdb988,'mode':'insensitive'}}}]);console[_0x29753c(0x2dd)](_0x29753c(0x2f8),JSON['stringify'](_0x21bcc6,null,0x2));let _0x5c3b2a={'createdAt':'desc'};if(_0x49c9da){const _0x54623f=[_0x29753c(0x243),_0x29753c(0x249),'updatedAt',_0x29753c(0x2dc),'gateway',_0x29753c(0x2c2)],_0x427de4=[_0x29753c(0x20c),_0x29753c(0x20a)];if(_0x54623f['includes'](_0x49c9da)){const _0xfac65a=_0x427de4[_0x29753c(0x2db)](_0xfea5e0)?_0xfea5e0:_0x29753c(0x20a);_0x5c3b2a={[_0x49c9da]:_0xfac65a},console[_0x29753c(0x2dd)](_0x29753c(0x275)+_0x49c9da+_0x29753c(0x220)+_0xfac65a+'\x20order');}}const [_0x30e5a3,_0x5cef10]=await Promise['all']([database_1[_0x29753c(0x2da)][_0x29753c(0x2fe)][_0x29753c(0x28b)]({'where':_0x21bcc6,'skip':_0x59df26,'take':_0x3e94f0,'orderBy':_0x5c3b2a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x29753c(0x2da)][_0x29753c(0x2fe)][_0x29753c(0x247)]({'where':_0x21bcc6})]);return{'payments':_0x30e5a3,'pagination':{'page':_0x2cddb0,'limit':_0x3e94f0,'total':_0x5cef10,'totalPages':Math['ceil'](_0x5cef10/_0x3e94f0)}};}async[a35_0x554eae(0x22e)](_0x4b4804){const _0x2d4514=a35_0x554eae,_0xe89275=await database_1[_0x2d4514(0x2da)][_0x2d4514(0x2fe)][_0x2d4514(0x2ad)]({'where':{'id':_0x4b4804},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xe89275)return null;return{'id':_0xe89275['id'],'shopId':_0xe89275[_0x2d4514(0x276)],'gateway':_0xe89275[_0x2d4514(0x1dd)],'amount':_0xe89275['amount'],'currency':_0xe89275[_0x2d4514(0x2c2)],'status':_0xe89275[_0x2d4514(0x2dc)],'orderId':_0xe89275[_0x2d4514(0x24c)],'gatewayOrderId':_0xe89275[_0x2d4514(0x22c)],'customerEmail':_0xe89275[_0x2d4514(0x1da)],'customerName':_0xe89275[_0x2d4514(0x26e)],'customerCountry':_0xe89275[_0x2d4514(0x266)],'customerIp':_0xe89275[_0x2d4514(0x2a5)],'customerUa':_0xe89275[_0x2d4514(0x239)],'failureMessage':_0xe89275[_0x2d4514(0x29d)],'externalPaymentUrl':_0xe89275[_0x2d4514(0x27d)],'successUrl':_0xe89275[_0x2d4514(0x21b)],'failUrl':_0xe89275['failUrl'],'pendingUrl':_0xe89275[_0x2d4514(0x2d3)],'whiteUrl':_0xe89275['whiteUrl'],'createdAt':_0xe89275[_0x2d4514(0x249)],'updatedAt':_0xe89275[_0x2d4514(0x2d1)],'shop':_0xe89275[_0x2d4514(0x210)]};}async[a35_0x554eae(0x2ff)](_0x112df9,_0x574a64,_0x11574e,_0x5ea613){const _0x1e75c1=a35_0x554eae,_0x231b05=await database_1[_0x1e75c1(0x2da)][_0x1e75c1(0x30c)](async _0x3e61c1=>{const _0x4e59fc=_0x1e75c1,_0x434d46=await _0x3e61c1['payment'][_0x4e59fc(0x2ad)]({'where':{'id':_0x112df9},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x434d46)throw new Error(_0x4e59fc(0x23c));const _0x53131c=_0x434d46[_0x4e59fc(0x2dc)],_0x1ee278=_0x574a64[_0x4e59fc(0x29b)]();console[_0x4e59fc(0x2dd)](_0x4e59fc(0x237)+_0x112df9+_0x4e59fc(0x2d0)+_0x53131c+_0x4e59fc(0x267)+_0x1ee278),console['log'](_0x4e59fc(0x1e0)+_0x434d46[_0x4e59fc(0x210)][_0x4e59fc(0x224)]+_0x4e59fc(0x29f));const _0x2ea8eb={'status':_0x1ee278,'updatedAt':new Date(),'statusChangedBy':_0x4e59fc(0x1e9),'statusChangedAt':new Date()};_0x11574e&&(_0x2ea8eb['adminNotes']=_0x11574e);_0x1ee278===_0x4e59fc(0x22b)&&_0x5ea613&&(_0x2ea8eb[_0x4e59fc(0x295)]=_0x5ea613);let _0x5a4ce6=0x0,_0x3e3525=_0x434d46[_0x4e59fc(0x210)][_0x4e59fc(0x224)];if(_0x1ee278===_0x4e59fc(0x25f)&&_0x53131c!==_0x4e59fc(0x25f)){_0x2ea8eb['paidAt']=new Date();const _0x2e7cf0=await currencyService_1[_0x4e59fc(0x24d)][_0x4e59fc(0x282)](_0x434d46[_0x4e59fc(0x243)],_0x434d46['currency']);_0x2ea8eb[_0x4e59fc(0x27c)]=_0x2e7cf0;let _0x503279=0xa;const _0x406d8b=await _0x3e61c1[_0x4e59fc(0x210)][_0x4e59fc(0x2ad)]({'where':{'id':_0x434d46[_0x4e59fc(0x276)]},'select':{'gatewaySettings':!![]}});if(_0x406d8b?.['gatewaySettings'])try{const _0x170c85=JSON[_0x4e59fc(0x2ab)](_0x406d8b['gatewaySettings']);for(const [_0x274039,_0x50d4e9]of Object[_0x4e59fc(0x204)](_0x170c85)){if(_0x274039['toLowerCase']()===_0x434d46['gateway'][_0x4e59fc(0x218)]()){_0x503279=_0x50d4e9['commission']||0xa;break;}}}catch(_0x39dcc0){console[_0x4e59fc(0x2b7)](_0x4e59fc(0x30a)+_0x112df9+':',_0x39dcc0);}const _0x22aaeb=_0x2e7cf0*(0x1-_0x503279/0x64);_0x5a4ce6=_0x22aaeb,_0x3e3525+=_0x22aaeb,console[_0x4e59fc(0x2dd)](_0x4e59fc(0x261)+_0x112df9+_0x4e59fc(0x251)),console[_0x4e59fc(0x2dd)]('\x20\x20\x20Full\x20amount:\x20'+_0x2e7cf0[_0x4e59fc(0x301)](0x6)+_0x4e59fc(0x29f)),console[_0x4e59fc(0x2dd)]('\x20\x20\x20Gateway:\x20'+_0x434d46[_0x4e59fc(0x1dd)]+_0x4e59fc(0x27e)+_0x503279+'%'),console['log'](_0x4e59fc(0x264)+_0x22aaeb['toFixed'](0x6)+_0x4e59fc(0x2e3)+_0x503279+_0x4e59fc(0x2d4)),console[_0x4e59fc(0x2dd)](_0x4e59fc(0x28d)+_0x22aaeb[_0x4e59fc(0x301)](0x6)+_0x4e59fc(0x29f));}else{if(_0x53131c===_0x4e59fc(0x25f)&&_0x1ee278!==_0x4e59fc(0x25f)){if(_0x434d46['amountUSDT']){let _0x4877c0=0xa;const _0xfa62d=await _0x3e61c1[_0x4e59fc(0x210)]['findUnique']({'where':{'id':_0x434d46[_0x4e59fc(0x276)]},'select':{'gatewaySettings':!![]}});if(_0xfa62d?.[_0x4e59fc(0x1d8)])try{const _0x4da889=JSON[_0x4e59fc(0x2ab)](_0xfa62d[_0x4e59fc(0x1d8)]);for(const [_0x44cb79,_0x451dda]of Object[_0x4e59fc(0x204)](_0x4da889)){if(_0x44cb79[_0x4e59fc(0x218)]()===_0x434d46['gateway'][_0x4e59fc(0x218)]()){_0x4877c0=_0x451dda['commission']||0xa;break;}}}catch(_0x4f7587){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x112df9+':',_0x4f7587);}const _0x13da4d=_0x434d46[_0x4e59fc(0x27c)]*(0x1-_0x4877c0/0x64);_0x5a4ce6=-_0x13da4d,_0x3e3525-=_0x13da4d,_0x2ea8eb[_0x4e59fc(0x27c)]=null,console[_0x4e59fc(0x2dd)](_0x4e59fc(0x261)+_0x112df9+_0x4e59fc(0x20d)),console['log'](_0x4e59fc(0x285)+_0x434d46[_0x4e59fc(0x27c)]['toFixed'](0x6)+'\x20USDT'),console['log'](_0x4e59fc(0x2b3)+_0x434d46[_0x4e59fc(0x1dd)]+_0x4e59fc(0x27e)+_0x4877c0+'%'),console[_0x4e59fc(0x2dd)](_0x4e59fc(0x2a0)+_0x13da4d[_0x4e59fc(0x301)](0x6)+_0x4e59fc(0x2e3)+_0x4877c0+_0x4e59fc(0x2d4)),console[_0x4e59fc(0x2dd)](_0x4e59fc(0x2af)+_0x13da4d[_0x4e59fc(0x301)](0x6)+_0x4e59fc(0x29f));}}}_0x1ee278===_0x4e59fc(0x22b)&&(_0x53131c==='PAID'&&_0x434d46[_0x4e59fc(0x27c)]&&console[_0x4e59fc(0x2dd)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x5ea613&&_0x5ea613>0x0&&(_0x5a4ce6-=_0x5ea613,_0x3e3525-=_0x5ea613,console[_0x4e59fc(0x2dd)](_0x4e59fc(0x1e3)+_0x5ea613[_0x4e59fc(0x301)](0x6)+_0x4e59fc(0x280))));_0x1ee278===_0x4e59fc(0x2b0)&&_0x53131c===_0x4e59fc(0x25f)&&console['log'](_0x4e59fc(0x2c6));const _0x513df4=await _0x3e61c1[_0x4e59fc(0x2fe)][_0x4e59fc(0x26a)]({'where':{'id':_0x112df9},'data':_0x2ea8eb,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5a4ce6!==0x0&&(await _0x3e61c1[_0x4e59fc(0x210)][_0x4e59fc(0x26a)]({'where':{'id':_0x434d46['shopId']},'data':{'balance':_0x3e3525}}),console[_0x4e59fc(0x2dd)](_0x4e59fc(0x306)+_0x434d46[_0x4e59fc(0x276)]+_0x4e59fc(0x235)+_0x434d46['shop'][_0x4e59fc(0x224)][_0x4e59fc(0x301)](0x6)+_0x4e59fc(0x267)+_0x3e3525['toFixed'](0x6)+'\x20USDT\x20('+(_0x5a4ce6>0x0?'+':'')+_0x5a4ce6[_0x4e59fc(0x301)](0x6)+')')),_0x513df4;});return{'id':_0x231b05['id'],'shopId':_0x231b05['shopId'],'gateway':_0x231b05[_0x1e75c1(0x1dd)],'amount':_0x231b05['amount'],'currency':_0x231b05[_0x1e75c1(0x2c2)],'status':_0x231b05[_0x1e75c1(0x2dc)],'orderId':_0x231b05['orderId'],'gatewayOrderId':_0x231b05['gatewayOrderId'],'customerEmail':_0x231b05[_0x1e75c1(0x1da)],'customerName':_0x231b05[_0x1e75c1(0x26e)],'customerCountry':_0x231b05[_0x1e75c1(0x266)],'customerIp':_0x231b05[_0x1e75c1(0x2a5)],'customerUa':_0x231b05['customerUa'],'failureMessage':_0x231b05['failureMessage'],'adminNotes':_0x231b05['adminNotes'],'chargebackAmount':_0x231b05['chargebackAmount'],'statusChangedBy':_0x231b05[_0x1e75c1(0x254)],'statusChangedAt':_0x231b05['statusChangedAt'],'createdAt':_0x231b05[_0x1e75c1(0x249)],'updatedAt':_0x231b05[_0x1e75c1(0x2d1)],'shop':_0x231b05[_0x1e75c1(0x210)]};}async[a35_0x554eae(0x1eb)](_0x3637f3,_0x3aa471){const _0x19d2bf=a35_0x554eae,_0x4e80cf=Math[_0x19d2bf(0x2ae)]()['toString'](0x24)[_0x19d2bf(0x2d7)](0x2,0x9);console[_0x19d2bf(0x2dd)](_0x19d2bf(0x26c)+_0x4e80cf+_0x19d2bf(0x1f4)+_0x3637f3);const _0x412610={..._0x3aa471};_0x3aa471[_0x19d2bf(0x2cc)]&&(_0x412610[_0x19d2bf(0x2cc)]=await bcryptjs_1[_0x19d2bf(0x2da)][_0x19d2bf(0x1ff)](_0x3aa471[_0x19d2bf(0x2cc)],0xc));_0x3aa471['fullName']&&(_0x412610[_0x19d2bf(0x1d7)]=_0x3aa471[_0x19d2bf(0x2df)],delete _0x412610[_0x19d2bf(0x2df)]);_0x3aa471[_0x19d2bf(0x28a)]&&(_0x412610[_0x19d2bf(0x244)]=_0x3aa471['telegramId'],delete _0x412610['telegramId']);_0x3aa471['merchantUrl']&&(_0x412610['shopUrl']=_0x3aa471[_0x19d2bf(0x2aa)],delete _0x412610[_0x19d2bf(0x2aa)]);if(_0x3aa471[_0x19d2bf(0x229)]){const _0x1fe49d=_0x3aa471[_0x19d2bf(0x229)][_0x19d2bf(0x227)](_0x2981c6=>this[_0x19d2bf(0x245)](_0x2981c6));console[_0x19d2bf(0x2dd)](_0x19d2bf(0x20f),_0x3aa471[_0x19d2bf(0x229)],'->',_0x1fe49d),_0x412610[_0x19d2bf(0x22d)]=JSON[_0x19d2bf(0x1e8)](_0x1fe49d),delete _0x412610['gateways'];}_0x3aa471[_0x19d2bf(0x1d8)]&&(console['log']('🔧\x20['+_0x4e80cf+_0x19d2bf(0x200),_0x3aa471['gatewaySettings']),_0x412610['gatewaySettings']=JSON[_0x19d2bf(0x1e8)](_0x3aa471[_0x19d2bf(0x1d8)]),console[_0x19d2bf(0x2dd)](_0x19d2bf(0x2e1)+_0x4e80cf+_0x19d2bf(0x29e),_0x412610['gatewaySettings']));_0x3aa471[_0x19d2bf(0x1e6)]&&(_0x3aa471[_0x19d2bf(0x1e6)]['usdtPolygonWallet']!==undefined&&(_0x412610[_0x19d2bf(0x221)]=_0x3aa471[_0x19d2bf(0x1e6)][_0x19d2bf(0x221)]||null),_0x3aa471[_0x19d2bf(0x1e6)]['usdtTrcWallet']!==undefined&&(_0x412610['usdtTrcWallet']=_0x3aa471[_0x19d2bf(0x1e6)]['usdtTrcWallet']||null),_0x3aa471[_0x19d2bf(0x1e6)][_0x19d2bf(0x2e2)]!==undefined&&(_0x412610['usdtErcWallet']=_0x3aa471['wallets'][_0x19d2bf(0x2e2)]||null),_0x3aa471[_0x19d2bf(0x1e6)]['usdcPolygonWallet']!==undefined&&(_0x412610[_0x19d2bf(0x2b2)]=_0x3aa471[_0x19d2bf(0x1e6)]['usdcPolygonWallet']||null),delete _0x412610[_0x19d2bf(0x1e6)]);const _0xff2672=await database_1[_0x19d2bf(0x2da)][_0x19d2bf(0x210)][_0x19d2bf(0x26a)]({'where':{'id':_0x3637f3},'data':_0x412610,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x19d2bf(0x2dd)]('🎯\x20['+_0x4e80cf+_0x19d2bf(0x279),_0xff2672['gatewaySettings']),{'id':_0xff2672['id'],'fullName':_0xff2672['name'],'username':_0xff2672[_0x19d2bf(0x1d5)],'telegramId':_0xff2672['telegram'],'merchantUrl':_0xff2672['shopUrl'],'gateways':_0xff2672['paymentGateways']?JSON[_0x19d2bf(0x2ab)](_0xff2672[_0x19d2bf(0x22d)]):null,'gatewaySettings':_0xff2672['gatewaySettings']?JSON[_0x19d2bf(0x2ab)](_0xff2672[_0x19d2bf(0x1d8)]):null,'publicKey':_0xff2672[_0x19d2bf(0x2cf)],'wallets':{'usdtPolygonWallet':_0xff2672['usdtPolygonWallet'],'usdtTrcWallet':_0xff2672[_0x19d2bf(0x2b1)],'usdtErcWallet':_0xff2672['usdtErcWallet'],'usdcPolygonWallet':_0xff2672[_0x19d2bf(0x2b2)]},'status':_0xff2672[_0x19d2bf(0x2dc)],'createdAt':_0xff2672['createdAt']};}async[a35_0x554eae(0x268)](_0x4ef84f){const _0xab1bbe=a35_0x554eae,_0x42da3f=await database_1[_0xab1bbe(0x2da)][_0xab1bbe(0x210)]['update']({'where':{'id':_0x4ef84f},'data':{'status':_0xab1bbe(0x2bf)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x42da3f['id'],'fullName':_0x42da3f[_0xab1bbe(0x1d7)],'username':_0x42da3f[_0xab1bbe(0x1d5)],'telegramId':_0x42da3f[_0xab1bbe(0x244)],'merchantUrl':_0x42da3f[_0xab1bbe(0x2f2)],'gateways':_0x42da3f[_0xab1bbe(0x22d)]?JSON[_0xab1bbe(0x2ab)](_0x42da3f[_0xab1bbe(0x22d)]):null,'gatewaySettings':_0x42da3f['gatewaySettings']?JSON[_0xab1bbe(0x2ab)](_0x42da3f[_0xab1bbe(0x1d8)]):null,'publicKey':_0x42da3f['publicKey'],'wallets':{'usdtPolygonWallet':_0x42da3f[_0xab1bbe(0x221)],'usdtTrcWallet':_0x42da3f[_0xab1bbe(0x2b1)],'usdtErcWallet':_0x42da3f[_0xab1bbe(0x2e2)],'usdcPolygonWallet':_0x42da3f[_0xab1bbe(0x2b2)]},'status':_0x42da3f[_0xab1bbe(0x2dc)],'createdAt':_0x42da3f[_0xab1bbe(0x249)]};}async[a35_0x554eae(0x2c8)](_0x8b7b37){const _0x1a9014=a35_0x554eae,_0x54e5ca=await database_1['default'][_0x1a9014(0x210)][_0x1a9014(0x26a)]({'where':{'id':_0x8b7b37},'data':{'status':_0x1a9014(0x308)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x54e5ca['id'],'fullName':_0x54e5ca[_0x1a9014(0x1d7)],'username':_0x54e5ca[_0x1a9014(0x1d5)],'telegramId':_0x54e5ca[_0x1a9014(0x244)],'merchantUrl':_0x54e5ca['shopUrl'],'gateways':_0x54e5ca[_0x1a9014(0x22d)]?JSON[_0x1a9014(0x2ab)](_0x54e5ca[_0x1a9014(0x22d)]):null,'gatewaySettings':_0x54e5ca[_0x1a9014(0x1d8)]?JSON[_0x1a9014(0x2ab)](_0x54e5ca[_0x1a9014(0x1d8)]):null,'publicKey':_0x54e5ca[_0x1a9014(0x2cf)],'wallets':{'usdtPolygonWallet':_0x54e5ca[_0x1a9014(0x221)],'usdtTrcWallet':_0x54e5ca[_0x1a9014(0x2b1)],'usdtErcWallet':_0x54e5ca[_0x1a9014(0x2e2)],'usdcPolygonWallet':_0x54e5ca['usdcPolygonWallet']},'status':_0x54e5ca['status'],'createdAt':_0x54e5ca[_0x1a9014(0x249)]};}async[a35_0x554eae(0x1ec)](_0x29165e){const _0x11d512=a35_0x554eae,{page:_0x2e930c,limit:_0x1beb94,status:_0x731cc7}=_0x29165e,_0x4fce07=(_0x2e930c-0x1)*_0x1beb94,_0x42ba25={};_0x731cc7&&(_0x42ba25[_0x11d512(0x2dc)]=_0x731cc7[_0x11d512(0x29b)]());const [_0x32488f,_0x5b4217]=await Promise[_0x11d512(0x2ea)]([database_1[_0x11d512(0x2da)]['shop'][_0x11d512(0x28b)]({'where':_0x42ba25,'skip':_0x4fce07,'take':_0x1beb94,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x11d512(0x2da)]['shop'][_0x11d512(0x247)]({'where':_0x42ba25})]);return{'users':_0x32488f[_0x11d512(0x227)](_0x22337a=>{const _0x3cadff=_0x11d512,_0x5d091a=_0x22337a['paymentGateways']?JSON[_0x3cadff(0x2ab)](_0x22337a[_0x3cadff(0x22d)]):null,_0x35c964=_0x5d091a?_0x5d091a['map'](_0x110bf9=>this[_0x3cadff(0x27f)](_0x110bf9)):null;return{'id':_0x22337a['id'],'fullName':_0x22337a[_0x3cadff(0x1d7)],'username':_0x22337a['username'],'telegramId':_0x22337a[_0x3cadff(0x244)],'merchantUrl':_0x22337a['shopUrl'],'gateways':_0x35c964,'gatewaySettings':_0x22337a['gatewaySettings']?JSON[_0x3cadff(0x2ab)](_0x22337a[_0x3cadff(0x1d8)]):null,'publicKey':_0x22337a[_0x3cadff(0x2cf)],'wallets':{'usdtPolygonWallet':_0x22337a[_0x3cadff(0x221)],'usdtTrcWallet':_0x22337a[_0x3cadff(0x2b1)],'usdtErcWallet':_0x22337a[_0x3cadff(0x2e2)],'usdcPolygonWallet':_0x22337a[_0x3cadff(0x2b2)]},'status':_0x22337a[_0x3cadff(0x2dc)],'createdAt':_0x22337a['createdAt']};}),'pagination':{'page':_0x2e930c,'limit':_0x1beb94,'total':_0x5b4217,'totalPages':Math[_0x11d512(0x2a1)](_0x5b4217/_0x1beb94)}};}async[a35_0x554eae(0x219)](_0x4a93d5){const _0x1c678c=a35_0x554eae,_0x5e896e=await database_1[_0x1c678c(0x2da)][_0x1c678c(0x210)][_0x1c678c(0x2ad)]({'where':{'id':_0x4a93d5},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5e896e)return null;const _0x125a44=_0x5e896e[_0x1c678c(0x22d)]?JSON[_0x1c678c(0x2ab)](_0x5e896e[_0x1c678c(0x22d)]):null,_0x4db148=_0x125a44?_0x125a44[_0x1c678c(0x227)](_0x3df90c=>this['getGatewayDisplayName'](_0x3df90c)):null;return _0x125a44&&_0x4db148&&console[_0x1c678c(0x2dd)](_0x1c678c(0x2f0),_0x125a44,'->',_0x4db148),{'id':_0x5e896e['id'],'fullName':_0x5e896e['name'],'username':_0x5e896e[_0x1c678c(0x1d5)],'telegramId':_0x5e896e['telegram'],'merchantUrl':_0x5e896e[_0x1c678c(0x2f2)],'gateways':_0x4db148,'gatewaySettings':_0x5e896e[_0x1c678c(0x1d8)]?JSON['parse'](_0x5e896e[_0x1c678c(0x1d8)]):null,'publicKey':_0x5e896e['publicKey'],'wallets':{'usdtPolygonWallet':_0x5e896e[_0x1c678c(0x221)],'usdtTrcWallet':_0x5e896e[_0x1c678c(0x2b1)],'usdtErcWallet':_0x5e896e[_0x1c678c(0x2e2)],'usdcPolygonWallet':_0x5e896e[_0x1c678c(0x2b2)]},'status':_0x5e896e[_0x1c678c(0x2dc)],'createdAt':_0x5e896e[_0x1c678c(0x249)]};}async[a35_0x554eae(0x2e6)](_0x2dcda2){const _0x5518c2=a35_0x554eae,{fullName:_0x46046f,username:_0x4b85c1,password:_0x473454,telegramId:_0x45e4db,merchantUrl:_0x1d726a,gateways:_0xe6150e,gatewaySettings:_0x296bd5,wallets:_0xfef088}=_0x2dcda2,_0xbe0b0=await database_1[_0x5518c2(0x2da)]['shop']['findUnique']({'where':{'username':_0x4b85c1}});if(_0xbe0b0)throw new Error(_0x5518c2(0x289));if(_0x45e4db){const _0x56eb63=await database_1['default'][_0x5518c2(0x210)][_0x5518c2(0x2ad)]({'where':{'telegram':_0x45e4db}});if(_0x56eb63)throw new Error(_0x5518c2(0x258));}const _0x5dd513=await bcryptjs_1[_0x5518c2(0x2da)][_0x5518c2(0x1ff)](_0x473454,0xc),_0x38af83=_0x5518c2(0x29a)+crypto_1[_0x5518c2(0x2da)]['randomBytes'](0x20)[_0x5518c2(0x260)](_0x5518c2(0x212)),_0x2a967d=_0x5518c2(0x2b5)+crypto_1[_0x5518c2(0x2da)]['randomBytes'](0x20)[_0x5518c2(0x260)](_0x5518c2(0x212)),_0x22c3bc=_0xe6150e?_0xe6150e[_0x5518c2(0x227)](_0x15d243=>this['getGatewayInternalName'](_0x15d243)):null;_0xe6150e&&_0x22c3bc&&console[_0x5518c2(0x2dd)]('🔄\x20Gateway\x20mapping\x20(create):',_0xe6150e,'->',_0x22c3bc);const _0x4b3325=await database_1['default'][_0x5518c2(0x210)][_0x5518c2(0x22a)]({'data':{'name':_0x46046f,'username':_0x4b85c1,'password':_0x5dd513,'telegram':_0x45e4db,'shopUrl':_0x1d726a,'paymentGateways':_0x22c3bc?JSON[_0x5518c2(0x1e8)](_0x22c3bc):null,'gatewaySettings':_0x296bd5?JSON[_0x5518c2(0x1e8)](_0x296bd5):null,'usdtPolygonWallet':_0xfef088?.[_0x5518c2(0x221)]||null,'usdtTrcWallet':_0xfef088?.[_0x5518c2(0x2b1)]||null,'usdtErcWallet':_0xfef088?.[_0x5518c2(0x2e2)]||null,'usdcPolygonWallet':_0xfef088?.[_0x5518c2(0x2b2)]||null,'publicKey':_0x38af83,'secretKey':_0x2a967d,'status':_0x5518c2(0x308)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4b3325['id'],'fullName':_0x4b3325[_0x5518c2(0x1d7)],'username':_0x4b3325['username'],'telegramId':_0x4b3325[_0x5518c2(0x244)],'merchantUrl':_0x4b3325[_0x5518c2(0x2f2)],'gateways':_0x4b3325[_0x5518c2(0x22d)]?JSON[_0x5518c2(0x2ab)](_0x4b3325[_0x5518c2(0x22d)]):null,'gatewaySettings':_0x4b3325['gatewaySettings']?JSON['parse'](_0x4b3325[_0x5518c2(0x1d8)]):null,'publicKey':_0x4b3325[_0x5518c2(0x2cf)],'wallets':{'usdtPolygonWallet':_0x4b3325[_0x5518c2(0x221)],'usdtTrcWallet':_0x4b3325[_0x5518c2(0x2b1)],'usdtErcWallet':_0x4b3325[_0x5518c2(0x2e2)],'usdcPolygonWallet':_0x4b3325[_0x5518c2(0x2b2)]},'status':_0x4b3325[_0x5518c2(0x2dc)],'createdAt':_0x4b3325[_0x5518c2(0x249)]};}async[a35_0x554eae(0x298)](_0x1a37cf){const _0x31308f=a35_0x554eae;await database_1['default']['shop'][_0x31308f(0x2c1)]({'where':{'id':_0x1a37cf}});}[a35_0x554eae(0x252)](_0xb77b7c,_0x5ec84b,_0x5c37cd){const _0x9d6c22=a35_0x554eae,_0x43eb50=new Map(),_0x58a8cd=new Date(_0x5ec84b);while(_0x58a8cd<=_0x5c37cd){const _0xc1b24b=_0x58a8cd[_0x9d6c22(0x2b8)]()[_0x9d6c22(0x1fc)]('T')[0x0];_0x43eb50['set'](_0xc1b24b,{'revenue':0x0,'count':0x0}),_0x58a8cd['setDate'](_0x58a8cd[_0x9d6c22(0x1f5)]()+0x1);}for(const _0x3743fd of _0xb77b7c){const _0xc69bb9=_0x3743fd['createdAt'][_0x9d6c22(0x2b8)]()['split']('T')[0x0],_0x2eaea8=_0x43eb50['get'](_0xc69bb9);_0x2eaea8&&(_0x2eaea8['count']+=0x1,_0x3743fd[_0x9d6c22(0x2dc)]===_0x9d6c22(0x25f)&&(_0x3743fd[_0x9d6c22(0x27c)]?_0x2eaea8[_0x9d6c22(0x26d)]+=_0x3743fd[_0x9d6c22(0x27c)]:console[_0x9d6c22(0x2dd)](_0x9d6c22(0x1ed)+_0x3743fd['id']+_0x9d6c22(0x2fd))));}const _0x54fa66=[],_0xed8551=[];for(const [_0x4f01fd,_0x300aa3]of _0x43eb50){_0x54fa66['push']({'date':_0x4f01fd,'amount':Math[_0x9d6c22(0x2f6)](_0x300aa3['revenue']*0x64)/0x64}),_0xed8551[_0x9d6c22(0x284)]({'date':_0x4f01fd,'count':_0x300aa3[_0x9d6c22(0x247)]});}return{'dailyRevenue':_0x54fa66,'dailyPayments':_0xed8551};}}exports[a35_0x554eae(0x2b9)]=AdminService;