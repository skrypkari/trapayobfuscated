'use strict';const a46_0x57cbd5=a46_0x23f4;(function(_0x323868,_0x4ee1c9){const _0x1f0027=a46_0x23f4,_0x228c85=_0x323868();while(!![]){try{const _0x38b0cf=parseInt(_0x1f0027(0x1e6))/0x1+-parseInt(_0x1f0027(0x17e))/0x2*(parseInt(_0x1f0027(0x9b))/0x3)+-parseInt(_0x1f0027(0x15d))/0x4*(parseInt(_0x1f0027(0x13e))/0x5)+parseInt(_0x1f0027(0x18f))/0x6*(parseInt(_0x1f0027(0x147))/0x7)+-parseInt(_0x1f0027(0xde))/0x8+parseInt(_0x1f0027(0xc5))/0x9*(parseInt(_0x1f0027(0x1b5))/0xa)+-parseInt(_0x1f0027(0xec))/0xb;if(_0x38b0cf===_0x4ee1c9)break;else _0x228c85['push'](_0x228c85['shift']());}catch(_0x40268e){_0x228c85['push'](_0x228c85['shift']());}}}(a46_0x5d73,0x57adf));var __importDefault=this&&this[a46_0x57cbd5(0xd2)]||function(_0x380103){const _0x34af21=a46_0x57cbd5;return _0x380103&&_0x380103[_0x34af21(0x1d9)]?_0x380103:{'default':_0x380103};};Object[a46_0x57cbd5(0xfd)](exports,'__esModule',{'value':!![]}),exports[a46_0x57cbd5(0xb8)]=void 0x0;const database_1=__importDefault(require(a46_0x57cbd5(0x8a))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a46_0x57cbd5(0x14a))),currencyService_1=require(a46_0x57cbd5(0x10b)),telegramBotService_1=require(a46_0x57cbd5(0xff)),gateway_1=require('../types/gateway');class AdminService{async[a46_0x57cbd5(0x14d)](){const _0x4cf859=a46_0x57cbd5;console['log'](_0x4cf859(0xb6));const _0x3d1bf8=await database_1['default'][_0x4cf859(0x1cb)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x4f9150=await database_1[_0x4cf859(0xa3)][_0x4cf859(0x96)][_0x4cf859(0x1bb)]({'where':{'status':_0x4cf859(0x158),'gateway':{'not':_0x4cf859(0x82)}}}),_0x101e8c=new Date(),_0x276c2a=new Date(_0x101e8c['getFullYear'](),_0x101e8c[_0x4cf859(0x98)](),0x1),_0x271a18=new Date(_0x101e8c[_0x4cf859(0x12a)](),_0x101e8c[_0x4cf859(0x98)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x349a7b=await database_1[_0x4cf859(0xa3)][_0x4cf859(0xc8)][_0x4cf859(0x1af)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x276c2a,'lte':_0x271a18},'status':'COMPLETED'}}),_0x46b769=_0x3d1bf8[_0x4cf859(0x103)][_0x4cf859(0x155)]||0x0,_0x4fe492=_0x3d1bf8[_0x4cf859(0x103)][_0x4cf859(0xca)]||0x0,_0x44de9b=_0x349a7b['_sum'][_0x4cf859(0x1be)]||0x0,_0x5c4826={'totalPayout':Math[_0x4cf859(0xeb)](_0x46b769*0x64)/0x64,'awaitingPayout':Math[_0x4cf859(0xeb)](_0x4fe492*0x64)/0x64,'thisMonth':Math[_0x4cf859(0xeb)](_0x44de9b*0x64)/0x64,'availableBalance':Math[_0x4cf859(0xeb)](_0x4fe492*0x64)/0x64,'totalPayments':_0x4f9150};return console['log']('üìä\x20Payout\x20statistics\x20calculated:'),console[_0x4cf859(0x179)](_0x4cf859(0x16b)+_0x5c4826['totalPayout']+_0x4cf859(0xe6)),console[_0x4cf859(0x179)](_0x4cf859(0x190)+_0x5c4826['awaitingPayout']+_0x4cf859(0x1e7)),console[_0x4cf859(0x179)](_0x4cf859(0xf9)+_0x5c4826[_0x4cf859(0x13c)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x4cf859(0x8f)+_0x5c4826[_0x4cf859(0xe9)]+_0x4cf859(0x83)),console[_0x4cf859(0x179)](_0x4cf859(0x136)+_0x5c4826[_0x4cf859(0x17c)]+_0x4cf859(0x130)),_0x5c4826;}async['updateCustomerData'](_0x3dbbd5,_0x4f91aa){const _0xd9f013=a46_0x57cbd5;console[_0xd9f013(0x179)]('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x3dbbd5+':',_0x4f91aa);const _0x3e5c51=await database_1[_0xd9f013(0xa3)][_0xd9f013(0x96)][_0xd9f013(0x1c3)]({'where':{'id':_0x3dbbd5},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3e5c51)throw new Error(_0xd9f013(0x116));const _0xf06fc1={};_0x4f91aa[_0xd9f013(0x1eb)]!==undefined&&(_0xf06fc1[_0xd9f013(0x1eb)]=_0x4f91aa[_0xd9f013(0x1eb)]||null);_0x4f91aa[_0xd9f013(0x172)]!==undefined&&(_0xf06fc1['customerIp']=_0x4f91aa[_0xd9f013(0x172)]||null);_0x4f91aa['customerUa']!==undefined&&(_0xf06fc1['customerUa']=_0x4f91aa[_0xd9f013(0xe4)]||null);const _0xafecfd=await database_1[_0xd9f013(0xa3)]['payment'][_0xd9f013(0x15f)]({'where':{'id':_0x3dbbd5},'data':{..._0xf06fc1,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xd9f013(0x179)](_0xd9f013(0xda)+_0x3dbbd5),console[_0xd9f013(0x179)](_0xd9f013(0x87)+_0x3e5c51[_0xd9f013(0x1eb)]+_0xd9f013(0x1ae)+_0xafecfd[_0xd9f013(0x1eb)]),console[_0xd9f013(0x179)](_0xd9f013(0x118)+_0x3e5c51[_0xd9f013(0x172)]+_0xd9f013(0x1ae)+_0xafecfd['customerIp']),console[_0xd9f013(0x179)](_0xd9f013(0xdf)+(_0x3e5c51[_0xd9f013(0xe4)]?_0xd9f013(0x1b8):'not\x20set')+_0xd9f013(0x1ae)+(_0xafecfd[_0xd9f013(0xe4)]?_0xd9f013(0x1b8):_0xd9f013(0x10e))),_0xafecfd;}async['getSystemStatistics'](_0x4f65d4,_0xd82d91){const _0xbdf9df=a46_0x57cbd5,_0x2dfb0b=_0xd82d91?new Date(_0xd82d91):new Date();let _0x394cd1,_0x4d6138;if(_0x4f65d4[_0xbdf9df(0x1d6)](_0xbdf9df(0xe8))){const _0x2d75c0=_0x4f65d4[_0xbdf9df(0x1ab)](_0xbdf9df(0xe8),'')['split']('_');_0x2d75c0[_0xbdf9df(0x18a)]===0x2?(_0x394cd1=new Date(_0x2d75c0[0x0]),_0x394cd1['setHours'](0x0,0x0,0x0,0x0),_0x4d6138=new Date(_0x2d75c0[0x1]),_0x4d6138[_0xbdf9df(0x1a9)](0x17,0x3b,0x3b,0x3e7)):(_0x394cd1=new Date(_0x2dfb0b[_0xbdf9df(0x1b2)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x394cd1[_0xbdf9df(0x1a9)](0x0,0x0,0x0,0x0),_0x4d6138=new Date(),_0x4d6138[_0xbdf9df(0x1a9)](0x17,0x3b,0x3b,0x3e7));}else switch(_0x4f65d4['toLowerCase']()){case _0xbdf9df(0x1ec):_0x394cd1=new Date(Date[_0xbdf9df(0xc6)](_0x2dfb0b[_0xbdf9df(0x156)](),_0x2dfb0b[_0xbdf9df(0xb7)](),_0x2dfb0b['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4d6138=new Date(Date[_0xbdf9df(0xc6)](_0x2dfb0b[_0xbdf9df(0x156)](),_0x2dfb0b['getUTCMonth'](),_0x2dfb0b['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0xbdf9df(0x1de):const _0x455bad=new Date(_0x2dfb0b);_0x455bad[_0xbdf9df(0x165)](_0x455bad[_0xbdf9df(0x149)]()-0x1),_0x394cd1=new Date(Date[_0xbdf9df(0xc6)](_0x455bad[_0xbdf9df(0x156)](),_0x455bad[_0xbdf9df(0xb7)](),_0x455bad['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4d6138=new Date(Date[_0xbdf9df(0xc6)](_0x455bad['getUTCFullYear'](),_0x455bad[_0xbdf9df(0xb7)](),_0x455bad[_0xbdf9df(0x149)](),0x17,0x3b,0x3b,0x3e7));break;case _0xbdf9df(0x18e):const _0x1d4d97=_0x2dfb0b[_0xbdf9df(0xe7)](),_0x49237f=_0x1d4d97===0x0?-0x6:0x1-_0x1d4d97;_0x394cd1=new Date(_0x2dfb0b),_0x394cd1['setDate'](_0x2dfb0b['getDate']()+_0x49237f),_0x394cd1[_0xbdf9df(0x1a9)](0x0,0x0,0x0,0x0),_0x4d6138=new Date(_0x2dfb0b['getFullYear'](),_0x2dfb0b[_0xbdf9df(0x98)](),_0x2dfb0b[_0xbdf9df(0x14e)](),0x17,0x3b,0x3b,0x3e7);break;case _0xbdf9df(0x187):const _0x1e4754=new Date(_0x2dfb0b);_0x1e4754['setDate'](_0x2dfb0b[_0xbdf9df(0x14e)]()-0x7);const _0x4f3f0b=_0x1e4754['getDay'](),_0x562b8d=_0x4f3f0b===0x0?-0x6:0x1-_0x4f3f0b;_0x394cd1=new Date(_0x1e4754),_0x394cd1[_0xbdf9df(0x133)](_0x1e4754[_0xbdf9df(0x14e)]()+_0x562b8d),_0x394cd1[_0xbdf9df(0x1a9)](0x0,0x0,0x0,0x0),_0x4d6138=new Date(_0x394cd1),_0x4d6138['setDate'](_0x394cd1[_0xbdf9df(0x14e)]()+0x6),_0x4d6138[_0xbdf9df(0x1a9)](0x17,0x3b,0x3b,0x3e7);break;case'this_month':_0x394cd1=new Date(Date[_0xbdf9df(0xc6)](_0x2dfb0b[_0xbdf9df(0x156)](),_0x2dfb0b['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x4d6138=new Date(Date['UTC'](_0x2dfb0b[_0xbdf9df(0x156)](),_0x2dfb0b[_0xbdf9df(0xb7)](),_0x2dfb0b[_0xbdf9df(0x149)](),0x17,0x3b,0x3b,0x3e7));break;case _0xbdf9df(0xfb):_0x394cd1=new Date(Date[_0xbdf9df(0xc6)](_0x2dfb0b['getUTCFullYear'](),_0x2dfb0b[_0xbdf9df(0xb7)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x4d6138=new Date(Date['UTC'](_0x2dfb0b[_0xbdf9df(0x156)](),_0x2dfb0b[_0xbdf9df(0xb7)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x394cd1=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x4d6138=new Date(Date[_0xbdf9df(0xc6)](_0x2dfb0b['getUTCFullYear'](),_0x2dfb0b[_0xbdf9df(0xb7)](),_0x2dfb0b[_0xbdf9df(0x149)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x394cd1=new Date(_0x2dfb0b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x394cd1[_0xbdf9df(0x1a9)](0x0,0x0,0x0,0x0),_0x4d6138=new Date(_0x2dfb0b[_0xbdf9df(0x12a)](),_0x2dfb0b[_0xbdf9df(0x98)](),_0x2dfb0b[_0xbdf9df(0x14e)](),0x17,0x3b,0x3b,0x3e7);}const _0x20ead1={'gte':_0x394cd1,'lte':_0x4d6138},[_0x1adec0,_0x1a67c2,_0x22ed8f,_0x34ed18,_0x19c495,_0x57caef,_0x555b5e,_0x11de0e]=await Promise[_0xbdf9df(0xfc)]([database_1[_0xbdf9df(0xa3)][_0xbdf9df(0x1cb)][_0xbdf9df(0x1bb)](),database_1[_0xbdf9df(0xa3)][_0xbdf9df(0x1cb)][_0xbdf9df(0x1bb)]({'where':{'status':_0xbdf9df(0xd7)}}),database_1['default'][_0xbdf9df(0x96)][_0xbdf9df(0x1bb)]({'where':{'status':'PAID','createdAt':_0x20ead1,'gateway':{'not':_0xbdf9df(0x82)}}}),database_1[_0xbdf9df(0xa3)][_0xbdf9df(0x96)][_0xbdf9df(0x1bb)]({'where':{'status':_0xbdf9df(0x166),'createdAt':_0x20ead1,'gateway':{'not':_0xbdf9df(0x82)}}}),database_1[_0xbdf9df(0xa3)][_0xbdf9df(0x96)][_0xbdf9df(0x1bb)]({'where':{'status':_0xbdf9df(0x91),'createdAt':_0x20ead1,'gateway':{'not':_0xbdf9df(0x82)}}}),database_1[_0xbdf9df(0xa3)]['payment'][_0xbdf9df(0x14f)]({'where':{'status':_0xbdf9df(0x158),'createdAt':_0x20ead1,'gateway':{'not':_0xbdf9df(0x82)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0xbdf9df(0xa3)]['payment'][_0xbdf9df(0x14f)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0xbdf9df(0x16c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xbdf9df(0xa3)]['payment'][_0xbdf9df(0x14f)]({'where':{'createdAt':_0x20ead1,'gateway':{'not':_0xbdf9df(0x82)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0xa49fd8=0x0,_0x18c1f2=0x0;for(const _0x4c0ece of _0x57caef){const _0x125302=_0x4c0ece[_0xbdf9df(0x134)]||0x0;_0xa49fd8+=_0x125302;if(_0x4c0ece[_0xbdf9df(0x1b7)]&&_0x4c0ece['amountUSDT']){const _0x7a1f93=_0x4c0ece['amountUSDT']-_0x4c0ece[_0xbdf9df(0x1b7)];_0x18c1f2+=_0x7a1f93;}}const _0x28362a=_0x22ed8f>0x0?_0xa49fd8/_0x22ed8f:0x0,_0x409260=this['generateDailyStatistics'](_0x11de0e,_0x394cd1,_0x4d6138),_0x8627ec=await database_1[_0xbdf9df(0xa3)]['payment']['count']({'where':{'createdAt':_0x20ead1,'gateway':{'not':'test_gateway'},'status':{'notIn':[_0xbdf9df(0x140),'EXPIRED']}}}),_0x4e3286=_0x8627ec>0x0?_0x22ed8f/_0x8627ec*0x64:0x0;return{'totalShops':_0x1adec0,'activeShops':_0x1a67c2,'totalPayments':_0x8627ec,'successfulPayments':_0x22ed8f,'totalAttempts':_0x8627ec,'chargebacks':_0x34ed18,'refunds':_0x19c495,'totalRevenue':Math[_0xbdf9df(0xeb)](_0xa49fd8*0x64)/0x64,'trapayEarnings':Math[_0xbdf9df(0xeb)](_0x18c1f2*0x64)/0x64,'averagePaymentAmount':Math[_0xbdf9df(0xeb)](_0x28362a*0x64)/0x64,'conversionRate':Math[_0xbdf9df(0xeb)](_0x4e3286*0x64)/0x64,'dailyRevenue':_0x409260[_0xbdf9df(0x12f)],'dailyPayments':_0x409260[_0xbdf9df(0x121)],'recentPayments':_0x555b5e[_0xbdf9df(0xcc)](_0x34112b=>({'id':_0x34112b['id'],'amount':_0x34112b['amount'],'currency':_0x34112b[_0xbdf9df(0x132)],'status':_0x34112b[_0xbdf9df(0x1ed)],'gateway':_0x34112b['gateway'],'shop':_0x34112b[_0xbdf9df(0x1cb)],'createdAt':_0x34112b[_0xbdf9df(0x127)]}))};}async['getMerchantStatistics'](_0x353f27){const _0x241443=a46_0x57cbd5;console['log'](_0x241443(0x163),_0x353f27);let _0x5b8372,_0x3afff4=new Date();if(_0x353f27[_0x241443(0x143)]==='custom'&&_0x353f27[_0x241443(0x94)]&&_0x353f27[_0x241443(0x9c)])_0x5b8372=new Date(_0x353f27[_0x241443(0x94)]),_0x3afff4=new Date(_0x353f27[_0x241443(0x9c)]),_0x5b8372[_0x241443(0x1a9)](0x0,0x0,0x0,0x0),_0x3afff4[_0x241443(0x1a9)](0x17,0x3b,0x3b,0x3e7);else{const _0x5a77ff=new Date();switch(_0x353f27[_0x241443(0x143)]){case'week':_0x5b8372=new Date(_0x5a77ff[_0x241443(0x1b2)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x5b8372=new Date(_0x5a77ff[_0x241443(0x1b2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x241443(0x9f):_0x5b8372=new Date(_0x5a77ff[_0x241443(0x1b2)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x5b8372=new Date(_0x241443(0x15b));break;}_0x5b8372[_0x241443(0x1a9)](0x0,0x0,0x0,0x0),_0x3afff4[_0x241443(0x1a9)](0x17,0x3b,0x3b,0x3e7);}console['log']('üìÖ\x20Period:\x20'+_0x5b8372['toISOString']()+_0x241443(0x106)+_0x3afff4['toISOString']());const _0x239835={'status':'PAID','gateway':{'not':_0x241443(0x82)},'paidAt':{'gte':_0x5b8372,'lte':_0x3afff4}};_0x353f27['shopId']&&(_0x239835[_0x241443(0x16e)]=_0x353f27[_0x241443(0x16e)]);const _0x42137e=await database_1['default']['payment'][_0x241443(0x14f)]({'where':_0x239835,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x241443(0x179)](_0x241443(0x92)+_0x42137e['length']+_0x241443(0x188));const _0xb078d0={'gateway':{'not':_0x241443(0x82)},'status':{'notIn':[_0x241443(0x140),_0x241443(0x1ac)]},'createdAt':{'gte':_0x5b8372,'lte':_0x3afff4}};_0x353f27[_0x241443(0x16e)]&&(_0xb078d0[_0x241443(0x16e)]=_0x353f27[_0x241443(0x16e)]);const _0x4ce6a8=await database_1[_0x241443(0xa3)]['payment'][_0x241443(0x1bb)]({'where':_0xb078d0}),_0x546f83={..._0xb078d0,'status':_0x241443(0x166)},_0x1eab55={..._0xb078d0,'status':'REFUND'},[_0x140a57,_0x3a8abb]=await Promise['all']([database_1[_0x241443(0xa3)][_0x241443(0x96)][_0x241443(0x1bb)]({'where':_0x546f83}),database_1['default'][_0x241443(0x96)][_0x241443(0x1bb)]({'where':_0x1eab55})]);console[_0x241443(0x179)]('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0x4ce6a8+_0x241443(0x1e3)+_0x42137e['length']+_0x241443(0xa8)+_0x140a57+_0x241443(0x169)+_0x3a8abb);let _0x5e6592=0x0,_0x231d39=0x0,_0x56a1cd=0x0;const _0x5f4371={},_0x411bf2={},_0xba77c={};for(const _0x331ca3 of _0x42137e){try{const _0xd88ad8=_0x331ca3[_0x241443(0x134)]||0x0;if(_0xd88ad8<=0x0){console[_0x241443(0xbc)](_0x241443(0xdb)+_0x331ca3['id']+_0x241443(0x1c9));continue;}let _0x126034,_0x4a6155;if(_0x331ca3[_0x241443(0x1b7)]!==null&&_0x331ca3[_0x241443(0x1b7)]!==undefined)_0x126034=_0x331ca3[_0x241443(0x1b7)],_0x4a6155=_0xd88ad8-_0x126034,console[_0x241443(0x179)](_0x241443(0x81)+_0x331ca3['id']+':\x20'+_0xd88ad8['toFixed'](0x6)+'\x20USDT,\x20merchant:\x20'+_0x126034[_0x241443(0x119)](0x6)+_0x241443(0x83));else{let _0x5cf9a0={};if(_0x331ca3[_0x241443(0x1cb)][_0x241443(0xa9)])try{_0x5cf9a0=JSON[_0x241443(0xb1)](_0x331ca3['shop']['gatewaySettings']);}catch(_0x13c95f){console[_0x241443(0x129)](_0x241443(0x197)+_0x331ca3[_0x241443(0x16e)]+':',_0x13c95f);}let _0x4c1078=0x2d;for(const [_0x56d7fd,_0x5ab519]of Object[_0x241443(0x1c2)](_0x5cf9a0)){if(_0x56d7fd[_0x241443(0x1b0)]()===_0x331ca3['gateway'][_0x241443(0x1b0)]()){_0x4c1078=_0x5ab519['commission']||0x2d;break;}}_0x4a6155=_0xd88ad8*(_0x4c1078/0x64),_0x126034=_0xd88ad8-_0x4a6155,console['log']('üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x331ca3['id']+':\x20'+_0x4c1078+_0x241443(0x117)+_0xd88ad8['toFixed'](0x6)+_0x241443(0x83));}_0x5e6592+=_0xd88ad8,_0x231d39+=_0x126034,_0x56a1cd+=_0x4a6155;let _0x492e8f;_0x331ca3['gatewayCommissionRate']!==null&&_0x331ca3[_0x241443(0x100)]!==undefined?(_0x492e8f=_0x331ca3[_0x241443(0x100)],console[_0x241443(0x179)](_0x241443(0x167)+_0x331ca3['id']+':\x20'+_0x492e8f+'%')):(_0x492e8f=_0xd88ad8>0x0?_0x4a6155/_0xd88ad8*0x64:0x0,console[_0x241443(0x179)]('üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x331ca3['id']+':\x20'+_0x492e8f[_0x241443(0x119)](0x2)+'%'));!_0x5f4371[_0x331ca3['gateway']]&&(_0x5f4371[_0x331ca3[_0x241443(0xab)]]={'gateway':_0x331ca3['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x331ca3[_0x241443(0xab)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5f4371[_0x331ca3[_0x241443(0xab)]][_0x241443(0x1a4)]++,_0x5f4371[_0x331ca3[_0x241443(0xab)]][_0x241443(0xc0)]+=_0xd88ad8,_0x5f4371[_0x331ca3['gateway']][_0x241443(0x164)]+=_0x4a6155,_0x5f4371[_0x331ca3[_0x241443(0xab)]]['merchantEarningsUSDT']+=_0x126034,_0x5f4371[_0x331ca3[_0x241443(0xab)]]['totalCommissionRate']+=_0x492e8f;!_0x353f27[_0x241443(0x16e)]&&(!_0x411bf2[_0x331ca3['shopId']]&&(_0x411bf2[_0x331ca3['shopId']]={'shopId':_0x331ca3[_0x241443(0x16e)],'shopName':_0x331ca3[_0x241443(0x1cb)][_0x241443(0x1b1)],'shopUsername':_0x331ca3['shop'][_0x241443(0xa7)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x411bf2[_0x331ca3['shopId']]['paymentsCount']++,_0x411bf2[_0x331ca3[_0x241443(0x16e)]][_0x241443(0xc0)]+=_0xd88ad8,_0x411bf2[_0x331ca3[_0x241443(0x16e)]][_0x241443(0x164)]+=_0x4a6155,_0x411bf2[_0x331ca3[_0x241443(0x16e)]][_0x241443(0x131)]+=_0x126034);const _0x40c9af=_0x331ca3[_0x241443(0xe3)][_0x241443(0x1db)]()[_0x241443(0xed)]('T')[0x0];!_0xba77c[_0x40c9af]&&(_0xba77c[_0x40c9af]={'date':_0x40c9af,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xba77c[_0x40c9af][_0x241443(0xd1)]+=_0xd88ad8,_0xba77c[_0x40c9af][_0x241443(0xb2)]+=_0x126034,_0xba77c[_0x40c9af][_0x241443(0x19d)]+=_0x4a6155,_0xba77c[_0x40c9af][_0x241443(0x1a4)]++;}catch(_0xa3de37){console[_0x241443(0x129)](_0x241443(0x186)+_0x331ca3['id']+':',_0xa3de37);}}Object[_0x241443(0x19f)](_0x5f4371)[_0x241443(0xa5)](_0x4284dc=>{const _0xfd3bc9=_0x241443;_0x4284dc[_0xfd3bc9(0x1dd)]=_0x4284dc['paymentsCount']>0x0?_0x4284dc[_0xfd3bc9(0x181)]/_0x4284dc['paymentsCount']:0x0,delete _0x4284dc[_0xfd3bc9(0x181)];}),Object['values'](_0x411bf2)[_0x241443(0xa5)](_0xae1270=>{const _0x4389a7=_0x241443;_0xae1270[_0x4389a7(0xe2)]=_0xae1270['paymentsCount']>0x0?_0xae1270[_0x4389a7(0xc0)]/_0xae1270[_0x4389a7(0x1a4)]:0x0;});let _0x5d42d8=0x0,_0x1f62d6=0x0;if(_0x353f27[_0x241443(0x16e)]){const _0x1aef17=await database_1[_0x241443(0xa3)][_0x241443(0xc8)][_0x241443(0x14f)]({'where':{'shopId':_0x353f27[_0x241443(0x16e)],'status':_0x241443(0x120),'createdAt':{'gte':_0x5b8372,'lte':_0x3afff4}},'select':{'amount':!![]}});_0x5d42d8=_0x1aef17[_0x241443(0x1aa)]((_0x111042,_0x343358)=>_0x111042+_0x343358[_0x241443(0x1be)],0x0);const _0x1ce9ae=await database_1[_0x241443(0xa3)]['payout'][_0x241443(0x14f)]({'where':{'shopId':_0x353f27[_0x241443(0x16e)],'status':_0x241443(0x140),'createdAt':{'gte':_0x5b8372,'lte':_0x3afff4}},'select':{'amount':!![]}});_0x1f62d6=_0x1ce9ae['reduce']((_0x14c79d,_0xe91ff8)=>_0x14c79d+_0xe91ff8['amount'],0x0);}const _0x54d70f=_0x4ce6a8,_0x5a37b1=_0x42137e['length'],_0x1e464b=_0x5a37b1>0x0?_0x5e6592/_0x5a37b1:0x0,_0x1f2f2b=_0x54d70f>0x0?Math[_0x241443(0xeb)](_0x5a37b1/_0x54d70f*0x2710)/0x64:0x0,_0x563fc6=Math[_0x241443(0xce)]((_0x3afff4['getTime']()-_0x5b8372['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x176391={'totalTurnover':Math[_0x241443(0xeb)](_0x5e6592*0x64)/0x64,'merchantEarnings':Math[_0x241443(0xeb)](_0x231d39*0x64)/0x64,'gatewayEarnings':Math[_0x241443(0xeb)](_0x56a1cd*0x64)/0x64,'totalPaidOut':Math[_0x241443(0xeb)](_0x5d42d8*0x64)/0x64,'pendingPayout':Math[_0x241443(0xeb)](_0x1f62d6*0x64)/0x64,'averageCheck':Math[_0x241443(0xeb)](_0x1e464b*0x64)/0x64,'totalPayments':_0x54d70f,'successfulPayments':_0x5a37b1,'conversionRate':_0x1f2f2b,'chargebacks':_0x140a57,'refunds':_0x3a8abb,'gatewayBreakdown':Object['values'](_0x5f4371)['map'](_0x398252=>({..._0x398252,'turnoverUSDT':Math[_0x241443(0xeb)](_0x398252['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x398252[_0x241443(0x164)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x398252[_0x241443(0x131)]*0x64)/0x64,'averageCommissionRate':Math[_0x241443(0xeb)](_0x398252[_0x241443(0x1dd)]*0x64)/0x64})),'merchantBreakdown':_0x353f27[_0x241443(0x16e)]?undefined:Object[_0x241443(0x19f)](_0x411bf2)['map'](_0x164ad5=>({..._0x164ad5,'turnoverUSDT':Math['round'](_0x164ad5[_0x241443(0xc0)]*0x64)/0x64,'commissionUSDT':Math[_0x241443(0xeb)](_0x164ad5[_0x241443(0x164)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x241443(0xeb)](_0x164ad5['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x241443(0xeb)](_0x164ad5[_0x241443(0xfe)]*0x64)/0x64,'averageCheckUSDT':Math[_0x241443(0xeb)](_0x164ad5['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x241443(0x19f)](_0xba77c)[_0x241443(0xcc)](_0x1afaeb=>({..._0x1afaeb,'turnover':Math[_0x241443(0xeb)](_0x1afaeb['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x241443(0xeb)](_0x1afaeb[_0x241443(0xb2)]*0x64)/0x64,'gatewayEarnings':Math[_0x241443(0xeb)](_0x1afaeb['gatewayEarnings']*0x64)/0x64}))[_0x241443(0x11a)]((_0x1d0051,_0x26f483)=>_0x1d0051['date'][_0x241443(0x128)](_0x26f483[_0x241443(0x1d8)])),'periodInfo':{'from':_0x5b8372,'to':_0x3afff4,'periodType':_0x353f27[_0x241443(0x143)]||'custom','daysCount':_0x563fc6}};return console['log']('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x241443(0x179)](_0x241443(0xad)+_0x176391[_0x241443(0x13a)]+_0x241443(0x83)),console['log'](_0x241443(0x11e)+_0x176391[_0x241443(0xb2)]+'\x20USDT'),console[_0x241443(0x179)](_0x241443(0x1a7)+_0x176391[_0x241443(0x19d)]+_0x241443(0x83)),console[_0x241443(0x179)](_0x241443(0x1b3)+_0x176391['totalPaidOut']+'\x20USDT'),console[_0x241443(0x179)]('\x20\x20\x20‚è≥\x20Pending\x20payout:\x20'+_0x176391[_0x241443(0xa2)]+_0x241443(0x83)),console['log'](_0x241443(0x151)+_0x176391[_0x241443(0x17c)]),_0x176391;}async[a46_0x57cbd5(0x1e4)](_0xba2a55){const _0x367d2c=a46_0x57cbd5;console[_0x367d2c(0x179)]('üìã\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0xba2a55});let _0x434a50={};_0xba2a55&&(_0x434a50[_0x367d2c(0x145)]={'some':{}});const _0x177d99=await database_1['default'][_0x367d2c(0x1cb)]['findMany']({'where':_0x434a50,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console['log'](_0x367d2c(0x16f)+_0x177d99['length']+_0x367d2c(0x95)+(_0xba2a55?_0x367d2c(0xc4):'')),_0x177d99[_0x367d2c(0xcc)](_0x43bea7=>({'id':_0x43bea7['id'],'username':_0x43bea7[_0x367d2c(0xa7)],'name':_0x43bea7['name']}));}[a46_0x57cbd5(0x1cf)](_0x2b5637){const _0x39323a=a46_0x57cbd5,_0x3398d0={'test_gateway':_0x39323a(0xbf),'plisio':_0x39323a(0x89),'rapyd':'Rapyd','noda':_0x39323a(0xba),'cointopay':'CoinToPay','cointopay2':_0x39323a(0xb0),'klyme_eu':_0x39323a(0x154),'klyme_gb':_0x39323a(0xe1),'klyme_de':_0x39323a(0x1bd),'mastercard':_0x39323a(0xaa)};return _0x3398d0[_0x2b5637]||_0x2b5637;}['getGatewayInternalName'](_0x14096d){const _0x41d393=a46_0x57cbd5,_0x5a10f5={'Test\x20Gateway':_0x41d393(0x82),'Plisio':'plisio','Rapyd':_0x41d393(0xb5),'Noda':'noda','CoinToPay':_0x41d393(0x142),'CoinToPay2':_0x41d393(0x126),'KLYME\x20EU':_0x41d393(0x1c7),'KLYME\x20GB':_0x41d393(0x115),'KLYME\x20DE':_0x41d393(0x13f),'MasterCard':'mastercard'};return _0x5a10f5[_0x14096d]||_0x14096d[_0x41d393(0x1b0)]();}async[a46_0x57cbd5(0x109)](_0x50a948){const _0xba0c19=a46_0x57cbd5,{page:_0x4e2795,limit:_0x46dd89,minAmount:_0x426f06,search:_0x5ef4fa}=_0x50a948;console[_0xba0c19(0x179)](_0xba0c19(0x1a8),_0x50a948);let _0x23bc56={};_0x5ef4fa&&(_0x23bc56[_0xba0c19(0x1b1)]={'contains':_0x5ef4fa,'mode':'insensitive'});const _0x433f74=await database_1[_0xba0c19(0xa3)][_0xba0c19(0x1cb)][_0xba0c19(0x14f)]({'where':_0x23bc56,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x5f08d3=_0x433f74[_0xba0c19(0xae)](_0xedade3=>{const _0x51dac9=_0xba0c19,_0x1af837=Math['floor'](_0xedade3[_0x51dac9(0xca)]*0x64)/0x64;if(_0x426f06&&_0x1af837<_0x426f06)return![];return _0x1af837!==0x0;});_0x5f08d3[_0xba0c19(0x11a)]((_0x523a6f,_0x202707)=>_0x202707[_0xba0c19(0xca)]-_0x523a6f[_0xba0c19(0xca)]);const _0x47cbc4=_0x5f08d3[_0xba0c19(0x18a)],_0x34faa9=(_0x4e2795-0x1)*_0x46dd89,_0x1c865e=_0x5f08d3[_0xba0c19(0x194)](_0x34faa9,_0x34faa9+_0x46dd89);console[_0xba0c19(0x179)]('üí∞\x20Found\x20'+_0x1c865e[_0xba0c19(0x18a)]+_0xba0c19(0xb9));const _0x193913=await Promise[_0xba0c19(0xfc)](_0x1c865e[_0xba0c19(0xcc)](async _0x1b2c7b=>{const _0xff235a=_0xba0c19,[_0x311d1a,_0x24d285,_0x3be7b7]=await Promise['all']([database_1['default'][_0xff235a(0x96)]['count']({'where':{'shopId':_0x1b2c7b['id'],'status':_0xff235a(0x158),'gateway':{'not':_0xff235a(0x82)}}}),database_1['default'][_0xff235a(0x96)][_0xff235a(0xb4)]({'where':{'shopId':_0x1b2c7b['id'],'status':_0xff235a(0x158),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0xff235a(0x1a6)},'select':{'paidAt':!![]}}),database_1[_0xff235a(0xa3)][_0xff235a(0x96)][_0xff235a(0xbe)]({'by':[_0xff235a(0xab)],'where':{'shopId':_0x1b2c7b['id'],'status':_0xff235a(0x158),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3e7b45=new Date(),_0x31e579=new Date(_0x3e7b45[_0xff235a(0x12a)](),_0x3e7b45['getMonth'](),0x1),_0x38ddbd=new Date(_0x3e7b45['getFullYear'](),_0x3e7b45[_0xff235a(0x98)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x415a91,_0x1fb18b]=await Promise[_0xff235a(0xfc)]([database_1[_0xff235a(0xa3)][_0xff235a(0xc8)][_0xff235a(0x1af)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1b2c7b['id'],'status':'COMPLETED'}}),database_1[_0xff235a(0xa3)]['payout'][_0xff235a(0x1af)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1b2c7b['id'],'status':'COMPLETED','createdAt':{'gte':_0x31e579,'lte':_0x38ddbd}}})]),_0x246ddc=_0x415a91[_0xff235a(0x103)][_0xff235a(0x1be)]||0x0,_0x3f0d6d=_0x1fb18b['_sum'][_0xff235a(0x1be)]||0x0,_0x2ce9df=await Promise[_0xff235a(0xfc)](_0x3be7b7[_0xff235a(0xcc)](async _0x1869e3=>{const _0x16df55=_0xff235a;let _0x3d755a=0x2d;if(_0x1b2c7b[_0x16df55(0xa9)])try{const _0x452a79=JSON[_0x16df55(0xb1)](_0x1b2c7b[_0x16df55(0xa9)]);for(const [_0x10c9ab,_0x45535f]of Object[_0x16df55(0x1c2)](_0x452a79)){if(_0x10c9ab[_0x16df55(0x1b0)]()===_0x1869e3[_0x16df55(0xab)][_0x16df55(0x1b0)]()){_0x3d755a=_0x45535f[_0x16df55(0x19a)]||0xa,console[_0x16df55(0x179)](_0x16df55(0xb3)+_0x1869e3['gateway']+'\x20for\x20shop\x20'+_0x1b2c7b['id']+':\x20commission\x20=\x20'+_0x3d755a+'%');break;}}}catch(_0xd662ac){console[_0x16df55(0x129)](_0x16df55(0x197)+_0x1b2c7b['id']+':',_0xd662ac);}const _0x115c53=_0x1869e3[_0x16df55(0x103)]?.[_0x16df55(0x134)]||0x0,_0x3ff373=_0x115c53*(0x1-_0x3d755a/0x64);return{'gateway':_0x1869e3[_0x16df55(0xab)],'count':_0x1869e3[_0x16df55(0xd4)]?.['id']||0x0,'amountUSDT':Math[_0x16df55(0xeb)](_0x115c53*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x16df55(0xeb)](_0x3ff373*0x64)/0x64,'commission':_0x3d755a};})),_0xa2ce61=_0x2ce9df['reduce']((_0x253411,_0x9b47ca)=>_0x253411+_0x9b47ca[_0xff235a(0x134)],0x0),_0x64b09=_0x2ce9df['reduce']((_0x385c89,_0x1ecffe)=>_0x385c89+_0x1ecffe['amountAfterCommissionUSDT'],0x0),_0x38fb34=_0x1b2c7b['balance'];return console[_0xff235a(0x179)](_0xff235a(0x198)+_0x1b2c7b[_0xff235a(0xa7)]+':'),console[_0xff235a(0x179)](_0xff235a(0x153)+_0xa2ce61[_0xff235a(0x119)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console['log'](_0xff235a(0xf6)+_0x64b09['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0xff235a(0x179)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x38fb34[_0xff235a(0x119)](0x2)+_0xff235a(0x1d3)),console['log'](_0xff235a(0x17f)+_0x246ddc[_0xff235a(0x119)](0x2)+_0xff235a(0x108)),console[_0xff235a(0x179)](_0xff235a(0x7f)+(_0x64b09-_0x246ddc-_0x38fb34)[_0xff235a(0x119)](0x2)+_0xff235a(0xf0)),{'id':_0x1b2c7b['id'],'fullName':_0x1b2c7b['name'],'username':_0x1b2c7b[_0xff235a(0xa7)],'telegramId':_0x1b2c7b['telegram'],'merchantUrl':_0x1b2c7b[_0xff235a(0x182)],'wallets':{'usdtPolygonWallet':_0x1b2c7b[_0xff235a(0x13d)],'usdtTrcWallet':_0x1b2c7b[_0xff235a(0x1c4)],'usdtErcWallet':_0x1b2c7b[_0xff235a(0x139)],'usdcPolygonWallet':_0x1b2c7b[_0xff235a(0x19c)],'usdcErcWallet':_0x1b2c7b[_0xff235a(0x159)]},'totalAmountUSDT':Math[_0xff235a(0xeb)](_0xa2ce61*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xff235a(0xeb)](_0x64b09*0x64)/0x64,'currentBalance':Math[_0xff235a(0xe0)](_0x38fb34*0x64)/0x64,'totalPayout':Math[_0xff235a(0xeb)](_0x246ddc*0x64)/0x64,'thisMonth':Math[_0xff235a(0xeb)](_0x3f0d6d*0x64)/0x64,'paymentsCount':_0x311d1a,'oldestPaymentDate':_0x24d285?.[_0xff235a(0xe3)]||_0x1b2c7b[_0xff235a(0x127)],'gatewayBreakdown':_0x2ce9df};})),_0x152441=_0x193913['reduce']((_0x209b1a,_0x1093d5)=>_0x209b1a+_0x1093d5[_0xba0c19(0x1a1)],0x0),_0x1bac31=_0x193913[_0xba0c19(0x1aa)]((_0x171a37,_0x3d1d5f)=>_0x171a37+_0x3d1d5f[_0xba0c19(0xd8)],0x0),_0xb4d95e=_0x193913[_0xba0c19(0x1aa)]((_0x132607,_0x57cd88)=>_0x132607+_0x57cd88[_0xba0c19(0x135)],0x0),_0x57f745=_0x193913[_0xba0c19(0x1aa)]((_0x39a471,_0x358670)=>_0x39a471+_0x358670[_0xba0c19(0xe9)],0x0);return console[_0xba0c19(0x179)]('üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x47cbc4+_0xba0c19(0x113)),console['log'](_0xba0c19(0x180)+Math[_0xba0c19(0xeb)](_0x152441*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0xba0c19(0x179)](_0xba0c19(0x1a2)+Math[_0xba0c19(0xeb)](_0x1bac31*0x64)/0x64+_0xba0c19(0xf1)),console[_0xba0c19(0x179)](_0xba0c19(0x1dc)+Math[_0xba0c19(0xeb)](_0xb4d95e*0x64)/0x64+_0xba0c19(0x83)),console['log'](_0xba0c19(0xee)+Math[_0xba0c19(0xeb)](_0x57f745*0x64)/0x64+_0xba0c19(0x83)),{'merchants':_0x193913,'pagination':{'page':_0x4e2795,'limit':_0x46dd89,'total':_0x47cbc4,'totalPages':Math[_0xba0c19(0xce)](_0x47cbc4/_0x46dd89)},'summary':{'totalMerchants':_0x47cbc4,'totalAmountUSDT':Math[_0xba0c19(0xeb)](_0x152441*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xba0c19(0xeb)](_0x1bac31*0x64)/0x64,'totalPayout':Math[_0xba0c19(0xeb)](_0xb4d95e*0x64)/0x64,'thisMonth':Math[_0xba0c19(0xeb)](_0x57f745*0x64)/0x64}};}async['createPayout'](_0x41ae9f){const _0x411b54=a46_0x57cbd5,{shopId:_0x2ca0e5,amount:_0x13de3d,network:_0x1f26c8,wallet:_0x1abc34,notes:_0xdc797b,txid:_0x525329,periodFrom:_0x5aa87a,periodTo:_0x4a613c}=_0x41ae9f,_0x39d9f9=await database_1[_0x411b54(0xa3)][_0x411b54(0x1e8)](async _0x3f565b=>{const _0x3a78c7=_0x411b54,_0x114c28=await _0x3f565b[_0x3a78c7(0x1cb)][_0x3a78c7(0x1c3)]({'where':{'id':_0x2ca0e5},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x114c28)throw new Error(_0x3a78c7(0x18b));console[_0x3a78c7(0x179)](_0x3a78c7(0x196)+_0x114c28[_0x3a78c7(0xa7)]+':'),console[_0x3a78c7(0x179)](_0x3a78c7(0xef)+_0x114c28[_0x3a78c7(0xca)][_0x3a78c7(0x119)](0x6)+_0x3a78c7(0x83)),console['log'](_0x3a78c7(0xd0)+_0x13de3d[_0x3a78c7(0x119)](0x6)+'\x20USDT'),console[_0x3a78c7(0x179)](_0x3a78c7(0x170)+_0x114c28['totalPaidOut'][_0x3a78c7(0x119)](0x6)+'\x20USDT');if(_0x525329)console[_0x3a78c7(0x179)](_0x3a78c7(0x150)+_0x525329);const _0x20adcc=0.000001,_0x1080dc=Number(_0x114c28[_0x3a78c7(0xca)]),_0xb41824=Number(_0x13de3d);console[_0x3a78c7(0x179)]('üîç\x20Balance\x20check\x20details:'),console[_0x3a78c7(0x179)](_0x3a78c7(0xf4)+_0x114c28[_0x3a78c7(0xca)]),console[_0x3a78c7(0x179)](_0x3a78c7(0x176)+_0x1080dc),console[_0x3a78c7(0x179)](_0x3a78c7(0x1b9)+_0xb41824),console[_0x3a78c7(0x179)](_0x3a78c7(0x10a)+(_0x1080dc-_0xb41824)),console[_0x3a78c7(0x179)](_0x3a78c7(0xd6)+_0x20adcc);if(_0x1080dc<_0xb41824-_0x20adcc)throw new Error(_0x3a78c7(0x161)+_0x1080dc[_0x3a78c7(0x119)](0x6)+_0x3a78c7(0x1df)+_0xb41824[_0x3a78c7(0x119)](0x6)+_0x3a78c7(0x1a0)+(_0x1080dc-_0xb41824)[_0x3a78c7(0x119)](0x8)+_0x3a78c7(0x83));console[_0x3a78c7(0x179)](_0x3a78c7(0x11b));const _0x38898f=Math['min'](_0x1080dc,_0xb41824);let _0x37eb4b=_0x1abc34;console[_0x3a78c7(0x179)](_0x3a78c7(0x1c8)+(_0x1abc34||'not\x20provided'));if(!_0x37eb4b){console[_0x3a78c7(0x179)](_0x3a78c7(0x1d5));const _0x2188af=await _0x3f565b[_0x3a78c7(0x1cb)][_0x3a78c7(0x1c3)]({'where':{'id':_0x2ca0e5},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log']('üîç\x20Shop\x20wallets:',_0x2188af);if(_0x2188af)switch(_0x1f26c8){case'polygon':_0x37eb4b=_0x2188af[_0x3a78c7(0x13d)]||undefined,console[_0x3a78c7(0x179)](_0x3a78c7(0x1d4)+_0x37eb4b);break;case _0x3a78c7(0x8e):_0x37eb4b=_0x2188af[_0x3a78c7(0x1c4)]||undefined,console['log'](_0x3a78c7(0x124)+_0x37eb4b);break;case _0x3a78c7(0x11c):_0x37eb4b=_0x2188af['usdtErcWallet']||undefined,console[_0x3a78c7(0x179)](_0x3a78c7(0x168)+_0x37eb4b);break;case _0x3a78c7(0x10d):_0x37eb4b=_0x2188af['usdcPolygonWallet']||undefined,console[_0x3a78c7(0x179)]('üîç\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x37eb4b);break;case _0x3a78c7(0xa4):_0x37eb4b=_0x2188af[_0x3a78c7(0x159)]||undefined,console[_0x3a78c7(0x179)](_0x3a78c7(0x178)+_0x37eb4b);break;}}else console[_0x3a78c7(0x179)]('‚úÖ\x20Using\x20wallet\x20from\x20request:\x20'+_0x37eb4b);console['log'](_0x3a78c7(0x90)+_0x1f26c8+':\x20'+(_0x37eb4b||_0x3a78c7(0x148))),console[_0x3a78c7(0x179)]('üîç\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x2ca0e5,'amount':_0x38898f,'network':_0x1f26c8,'wallet':_0x37eb4b,'status':'COMPLETED','txid':_0x525329,'notes':_0xdc797b,'periodFrom':_0x5aa87a?new Date(_0x5aa87a):null,'periodTo':_0x4a613c?new Date(_0x4a613c):null});const _0x549c94=await _0x3f565b[_0x3a78c7(0xc8)][_0x3a78c7(0xbb)]({'data':{'shopId':_0x2ca0e5,'amount':_0x38898f,'network':_0x1f26c8,'wallet':_0x37eb4b,'status':_0x3a78c7(0x120),'txid':_0x525329,'notes':_0xdc797b,'periodFrom':_0x5aa87a?new Date(_0x5aa87a):null,'periodTo':_0x4a613c?new Date(_0x4a613c):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x3a78c7(0x179)]('‚úÖ\x20Payout\x20created\x20in\x20DB:',{'id':_0x549c94['id'],'wallet':_0x549c94[_0x3a78c7(0x15a)],'network':_0x549c94['network'],'amount':_0x549c94['amount']});const _0x5d6b75=_0x1080dc-_0x38898f,_0x115909=Number(_0x114c28['totalPaidOut'])+_0x38898f;return await _0x3f565b[_0x3a78c7(0x1cb)][_0x3a78c7(0x15f)]({'where':{'id':_0x2ca0e5},'data':{'balance':_0x5d6b75,'totalPaidOut':_0x115909}}),console[_0x3a78c7(0x179)]('üí∞\x20Shop\x20'+_0x114c28['username']+_0x3a78c7(0x144)),console['log'](_0x3a78c7(0x1c5)+_0x1080dc[_0x3a78c7(0x119)](0x6)+_0x3a78c7(0x1ae)+_0x5d6b75[_0x3a78c7(0x119)](0x6)+_0x3a78c7(0x114)+_0x38898f[_0x3a78c7(0x119)](0x6)+')'),console['log'](_0x3a78c7(0x17b)+_0x114c28[_0x3a78c7(0x155)][_0x3a78c7(0x119)](0x6)+_0x3a78c7(0x1ae)+_0x115909[_0x3a78c7(0x119)](0x6)+_0x3a78c7(0xc3)+_0x38898f[_0x3a78c7(0x119)](0x6)+')'),console['log'](_0x3a78c7(0xf5)+_0x38898f[_0x3a78c7(0x119)](0x6)+_0x3a78c7(0x83)),{'payout':_0x549c94,'shop':_0x114c28};});console[_0x411b54(0x179)](_0x411b54(0x193)+_0x39d9f9[_0x411b54(0xc8)]['id']+'\x20for\x20shop\x20'+_0x39d9f9['shop'][_0x411b54(0xa7)]+'\x20('+_0x39d9f9[_0x411b54(0xc8)]['amount'][_0x411b54(0x119)](0x6)+_0x411b54(0xc7));try{let _0x4ffa67='–ù–µ\x20—É–∫–∞–∑–∞–Ω';if(_0x39d9f9['payout'][_0x411b54(0x18d)]&&_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x171)]){const _0x11cf8c=new Date(_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x18d)])['toLocaleDateString'](_0x411b54(0x1ce)),_0x3a7015=new Date(_0x39d9f9['payout'][_0x411b54(0x171)])[_0x411b54(0xc9)](_0x411b54(0x1ce));_0x4ffa67=_0x11cf8c+_0x411b54(0x1e5)+_0x3a7015;}await telegramBotService_1[_0x411b54(0x14c)][_0x411b54(0x123)](_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x16e)],{'id':_0x39d9f9[_0x411b54(0xc8)]['id'],'amount':_0x39d9f9['payout'][_0x411b54(0x1be)],'network':_0x39d9f9['payout'][_0x411b54(0x125)],'wallet':_0x39d9f9['payout'][_0x411b54(0x15a)],'period':_0x4ffa67,'createdAt':_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x127)],'txid':_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x122)]}),console[_0x411b54(0x179)](_0x411b54(0x185)+_0x39d9f9['payout']['id']);}catch(_0x75a353){console[_0x411b54(0x129)](_0x411b54(0x97)+_0x39d9f9[_0x411b54(0xc8)]['id']+':',_0x75a353);}return{'id':_0x39d9f9['payout']['id'],'shopId':_0x39d9f9['payout'][_0x411b54(0x16e)],'shopName':_0x39d9f9[_0x411b54(0x1cb)][_0x411b54(0x1b1)],'shopUsername':_0x39d9f9[_0x411b54(0x1cb)][_0x411b54(0xa7)],'amount':_0x39d9f9[_0x411b54(0xc8)]['amount'],'network':_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x125)],'wallet':_0x39d9f9[_0x411b54(0xc8)]['wallet'],'status':_0x39d9f9['payout'][_0x411b54(0x1ed)],'txid':_0x39d9f9[_0x411b54(0xc8)]['txid'],'notes':_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x1b6)],'periodFrom':_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x18d)],'periodTo':_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x171)],'createdAt':_0x39d9f9[_0x411b54(0xc8)][_0x411b54(0x127)],'paidAt':_0x39d9f9[_0x411b54(0xc8)]['paidAt']};}async[a46_0x57cbd5(0x11f)](_0x429b20){const _0x22afc6=a46_0x57cbd5,{page:_0x4e6a29,limit:_0x1aa16f,shopId:_0x2e2d9d,network:_0x1c6c96,dateFrom:_0x20aefb,dateTo:_0x1e7e4b,search:_0x3f1d3d}=_0x429b20,_0x5b79a3=(_0x4e6a29-0x1)*_0x1aa16f,_0x13e8d6={};_0x2e2d9d&&(_0x13e8d6['shopId']=_0x2e2d9d);_0x1c6c96&&(_0x13e8d6[_0x22afc6(0x125)]=_0x1c6c96);if(_0x20aefb||_0x1e7e4b){_0x13e8d6['createdAt']={};if(_0x20aefb){const _0x559c50=new Date(_0x20aefb);_0x559c50['setHours'](0x0,0x0,0x0,0x1),_0x13e8d6[_0x22afc6(0x127)][_0x22afc6(0x1a5)]=_0x559c50,console[_0x22afc6(0x179)]('üìÖ\x20Payout\x20date\x20from\x20filter:\x20'+_0x559c50[_0x22afc6(0x1db)]());}if(_0x1e7e4b){const _0x24e9af=new Date(_0x1e7e4b);_0x24e9af[_0x22afc6(0x1a9)](0x17,0x3b,0x3b,0x3e7),_0x13e8d6[_0x22afc6(0x127)][_0x22afc6(0x9d)]=_0x24e9af,console[_0x22afc6(0x179)](_0x22afc6(0xcf)+_0x24e9af['toISOString']());}}_0x3f1d3d&&(_0x13e8d6['OR']=[{'shop':{'name':{'contains':_0x3f1d3d,'mode':_0x22afc6(0x111)}}},{'shop':{'username':{'contains':_0x3f1d3d,'mode':_0x22afc6(0x111)}}},{'notes':{'contains':_0x3f1d3d,'mode':_0x22afc6(0x111)}}]);const [_0x3bec0d,_0x2ab86b]=await Promise[_0x22afc6(0xfc)]([database_1[_0x22afc6(0xa3)][_0x22afc6(0xc8)][_0x22afc6(0x14f)]({'where':_0x13e8d6,'skip':_0x5b79a3,'take':_0x1aa16f,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x22afc6(0xa3)][_0x22afc6(0xc8)][_0x22afc6(0x1bb)]({'where':_0x13e8d6})]);return{'payouts':_0x3bec0d[_0x22afc6(0xcc)](_0x222c74=>({'id':_0x222c74['id'],'shopId':_0x222c74[_0x22afc6(0x16e)],'shopName':_0x222c74['shop'][_0x22afc6(0x1b1)],'shopUsername':_0x222c74[_0x22afc6(0x1cb)][_0x22afc6(0xa7)],'amount':_0x222c74[_0x22afc6(0x1be)],'network':_0x222c74[_0x22afc6(0x125)],'wallet':_0x222c74['wallet'],'status':_0x222c74[_0x22afc6(0x1ed)],'txid':_0x222c74[_0x22afc6(0x122)],'notes':_0x222c74[_0x22afc6(0x1b6)],'periodFrom':_0x222c74[_0x22afc6(0x18d)],'periodTo':_0x222c74[_0x22afc6(0x171)],'createdAt':_0x222c74[_0x22afc6(0x127)],'paidAt':_0x222c74[_0x22afc6(0xe3)]})),'pagination':{'page':_0x4e6a29,'limit':_0x1aa16f,'total':_0x2ab86b,'totalPages':Math[_0x22afc6(0xce)](_0x2ab86b/_0x1aa16f)}};}async['getPayoutById'](_0xea47fc){const _0x1307bf=a46_0x57cbd5,_0xff131c=await database_1[_0x1307bf(0xa3)]['payout'][_0x1307bf(0x1c3)]({'where':{'id':_0xea47fc},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xff131c)return null;return{'id':_0xff131c['id'],'shopId':_0xff131c[_0x1307bf(0x16e)],'shopName':_0xff131c[_0x1307bf(0x1cb)][_0x1307bf(0x1b1)],'shopUsername':_0xff131c[_0x1307bf(0x1cb)][_0x1307bf(0xa7)],'amount':_0xff131c['amount'],'network':_0xff131c['network'],'wallet':_0xff131c[_0x1307bf(0x15a)],'status':_0xff131c['status'],'txid':_0xff131c[_0x1307bf(0x122)],'notes':_0xff131c['notes'],'periodFrom':_0xff131c[_0x1307bf(0x18d)],'periodTo':_0xff131c['periodTo'],'createdAt':_0xff131c[_0x1307bf(0x127)],'paidAt':_0xff131c[_0x1307bf(0xe3)]};}async[a46_0x57cbd5(0x1cc)](_0x5593a9){const _0x23e47c=a46_0x57cbd5;await database_1[_0x23e47c(0xa3)]['payout'][_0x23e47c(0x160)]({'where':{'id':_0x5593a9}});}async['getAllPayments'](_0x323b1d){const _0x37a6ee=a46_0x57cbd5,{page:_0xf07d8b,limit:_0x183136,status:_0x2338d1,gateway:_0xd28dcc,shopId:_0x36de51,dateFrom:_0x561f31,dateTo:_0x460164,search:_0x121ea0,currency:_0x24a4d5,sortBy:_0x4262c2,sortOrder:_0x27ef80}=_0x323b1d,_0x4ae5cb=(_0xf07d8b-0x1)*_0x183136;console[_0x37a6ee(0x179)]('üìä\x20Getting\x20payments\x20with\x20filters:',_0x323b1d);const _0x28fdca=await database_1['default'][_0x37a6ee(0x96)][_0x37a6ee(0xbe)]({'by':[_0x37a6ee(0xab)],'_count':{'gateway':!![]}});console[_0x37a6ee(0x179)]('üìä\x20Available\x20gateways\x20in\x20database:',_0x28fdca[_0x37a6ee(0xcc)](_0x4d985f=>_0x4d985f[_0x37a6ee(0xab)]+'\x20('+_0x4d985f['_count'][_0x37a6ee(0xab)]+_0x37a6ee(0xdd)));if(_0xd28dcc){const _0x1b959a=_0x28fdca[_0x37a6ee(0xc2)](_0x488d7d=>_0x488d7d['gateway'][_0x37a6ee(0x1b0)]()===_0xd28dcc[_0x37a6ee(0x1b0)]());!_0x1b959a&&_0xd28dcc[_0x37a6ee(0x1b0)]()!==_0x37a6ee(0x82)&&console['log']('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0xd28dcc+_0x37a6ee(0x1d2)+_0x28fdca[_0x37a6ee(0xcc)](_0x1e7e7b=>_0x1e7e7b[_0x37a6ee(0xab)])[_0x37a6ee(0x110)](',\x20'));}const _0x24ecea={};_0x2338d1&&(_0x24ecea['status']=_0x2338d1[_0x37a6ee(0x17a)]());if(!_0xd28dcc)_0x24ecea[_0x37a6ee(0xab)]={'not':_0x37a6ee(0x82)};else{if(_0xd28dcc&&(_0xd28dcc[_0x37a6ee(0x1b0)]()===_0x37a6ee(0x82)||_0xd28dcc===_0x37a6ee(0x10f)))_0x24ecea[_0x37a6ee(0xab)]=_0x37a6ee(0x82);else{let _0x495082=_0xd28dcc;const _0x434725=(0x0,gateway_1['getGatewayNameById'])(_0xd28dcc);if(_0x434725)_0x495082=_0x434725,console[_0x37a6ee(0x179)](_0x37a6ee(0x189)+_0xd28dcc+_0x37a6ee(0xd5)+_0x495082+'\x27');else{const _0x131eef=(0x0,gateway_1['getGatewayIdByName'])(_0xd28dcc);if(_0x131eef){const _0x2f8aa1=(0x0,gateway_1[_0x37a6ee(0x12e)])(_0x131eef);_0x2f8aa1&&(_0x495082=_0x2f8aa1,console[_0x37a6ee(0x179)]('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0xd28dcc+_0x37a6ee(0x10c)+_0x131eef+'\x27\x20->\x20name\x20\x27'+_0x495082+'\x27'));}else console[_0x37a6ee(0x179)](_0x37a6ee(0x1b4)+_0xd28dcc+_0x37a6ee(0x1e2));}const _0x5d59dd=await database_1[_0x37a6ee(0xa3)][_0x37a6ee(0x96)]['count']({'where':{'gateway':_0x495082['toLowerCase']()},'take':0x1});_0x5d59dd===0x0?(console[_0x37a6ee(0x179)](_0x37a6ee(0x137)+_0x495082+_0x37a6ee(0x9e)+_0xd28dcc+_0x37a6ee(0xf3)),_0x24ecea[_0x37a6ee(0xab)]=_0x37a6ee(0x85)):(_0x24ecea[_0x37a6ee(0xab)]=_0x495082[_0x37a6ee(0x1b0)](),console[_0x37a6ee(0x179)](_0x37a6ee(0x15c)+_0x495082+_0x37a6ee(0x9e)+_0xd28dcc+'\x27)'));}}console['log']('üìä\x20Gateway\x20filter\x20applied:',_0x24ecea['gateway']);_0x36de51&&(_0x24ecea['shopId']=_0x36de51);_0x24a4d5&&(_0x24ecea['currency']=_0x24a4d5[_0x37a6ee(0x17a)](),console['log'](_0x37a6ee(0x175)+_0x24a4d5[_0x37a6ee(0x17a)]()));if(_0x561f31||_0x460164){_0x24ecea[_0x37a6ee(0x127)]={};if(_0x561f31){const _0x2ecb2b=new Date(_0x561f31);_0x2ecb2b[_0x37a6ee(0x1a9)](0x0,0x0,0x0,0x1),_0x24ecea[_0x37a6ee(0x127)][_0x37a6ee(0x1a5)]=_0x2ecb2b,console[_0x37a6ee(0x179)](_0x37a6ee(0x15e)+_0x2ecb2b[_0x37a6ee(0x1db)]());}if(_0x460164){const _0x3f760a=new Date(_0x460164);_0x3f760a[_0x37a6ee(0x1a9)](0x17,0x3b,0x3b,0x3e7),_0x24ecea[_0x37a6ee(0x127)]['lte']=_0x3f760a,console[_0x37a6ee(0x179)](_0x37a6ee(0xaf)+_0x3f760a[_0x37a6ee(0x1db)]());}}_0x121ea0&&(_0x24ecea['OR']=[{'id':{'contains':_0x121ea0,'mode':'insensitive'}},{'orderId':{'contains':_0x121ea0,'mode':_0x37a6ee(0x111)}},{'gatewayOrderId':{'contains':_0x121ea0,'mode':'insensitive'}},{'customerEmail':{'contains':_0x121ea0,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x121ea0,'mode':_0x37a6ee(0x111)}}},{'shop':{'username':{'contains':_0x121ea0,'mode':'insensitive'}}}]);console[_0x37a6ee(0x179)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x37a6ee(0x84)](_0x24ecea,null,0x2));let _0x48f8ce={'createdAt':_0x37a6ee(0x16c)};if(_0x4262c2){const _0x7e369c=[_0x37a6ee(0x1be),_0x37a6ee(0x127),_0x37a6ee(0x19e),_0x37a6ee(0x1ed),_0x37a6ee(0xab),'currency'],_0x1d5463=[_0x37a6ee(0x1a6),'desc'];if(_0x7e369c[_0x37a6ee(0x192)](_0x4262c2)){const _0x438cb7=_0x1d5463[_0x37a6ee(0x192)](_0x27ef80)?_0x27ef80:_0x37a6ee(0x16c);_0x48f8ce={[_0x4262c2]:_0x438cb7},console['log']('üìä\x20Sorting\x20payments\x20by\x20'+_0x4262c2+_0x37a6ee(0xa6)+_0x438cb7+_0x37a6ee(0x1ad));}}const [_0x3b4bf6,_0x34bf7c]=await Promise[_0x37a6ee(0xfc)]([database_1[_0x37a6ee(0xa3)]['payment'][_0x37a6ee(0x14f)]({'where':_0x24ecea,'skip':_0x4ae5cb,'take':_0x183136,'orderBy':_0x48f8ce,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x37a6ee(0x96)][_0x37a6ee(0x1bb)]({'where':_0x24ecea})]);return{'payments':_0x3b4bf6,'pagination':{'page':_0xf07d8b,'limit':_0x183136,'total':_0x34bf7c,'totalPages':Math[_0x37a6ee(0xce)](_0x34bf7c/_0x183136)}};}async[a46_0x57cbd5(0x174)](_0x42c195){const _0x6df8f7=a46_0x57cbd5,_0x5b3cc7=await database_1[_0x6df8f7(0xa3)][_0x6df8f7(0x96)][_0x6df8f7(0x1c3)]({'where':{'id':_0x42c195},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5b3cc7)return null;return{'id':_0x5b3cc7['id'],'shopId':_0x5b3cc7[_0x6df8f7(0x16e)],'gateway':_0x5b3cc7[_0x6df8f7(0xab)],'amount':_0x5b3cc7[_0x6df8f7(0x1be)],'currency':_0x5b3cc7[_0x6df8f7(0x132)],'status':_0x5b3cc7['status'],'orderId':_0x5b3cc7[_0x6df8f7(0x191)],'gatewayOrderId':_0x5b3cc7[_0x6df8f7(0x1ca)],'customerEmail':_0x5b3cc7[_0x6df8f7(0x173)],'customerName':_0x5b3cc7[_0x6df8f7(0x13b)],'customerCountry':_0x5b3cc7[_0x6df8f7(0x1eb)],'customerIp':_0x5b3cc7[_0x6df8f7(0x172)],'customerUa':_0x5b3cc7[_0x6df8f7(0xe4)],'failureMessage':_0x5b3cc7[_0x6df8f7(0x1da)],'externalPaymentUrl':_0x5b3cc7[_0x6df8f7(0x99)],'successUrl':_0x5b3cc7['successUrl'],'failUrl':_0x5b3cc7[_0x6df8f7(0x16a)],'pendingUrl':_0x5b3cc7['pendingUrl'],'whiteUrl':_0x5b3cc7[_0x6df8f7(0x1e0)],'createdAt':_0x5b3cc7[_0x6df8f7(0x127)],'updatedAt':_0x5b3cc7[_0x6df8f7(0x19e)],'shop':_0x5b3cc7['shop']};}async['updatePaymentStatus'](_0x36fd83,_0x11a945,_0xc138ae,_0x5b6ac7){const _0x547ea9=a46_0x57cbd5,_0x5832a7=await database_1[_0x547ea9(0xa3)][_0x547ea9(0x1e8)](async _0xa0b2f2=>{const _0x5225e8=_0x547ea9,_0x1a675a=await _0xa0b2f2[_0x5225e8(0x96)][_0x5225e8(0x1c3)]({'where':{'id':_0x36fd83},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1a675a)throw new Error(_0x5225e8(0x116));const _0x2ee174=_0x1a675a[_0x5225e8(0x1ed)],_0x5abce8=_0x11a945['toUpperCase']();console[_0x5225e8(0x179)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x36fd83+_0x5225e8(0x86)+_0x2ee174+_0x5225e8(0x1ae)+_0x5abce8),console[_0x5225e8(0x179)](_0x5225e8(0x1a3)+_0x1a675a['shop'][_0x5225e8(0xca)]+_0x5225e8(0x83));const _0x33994a={'status':_0x5abce8,'updatedAt':new Date(),'statusChangedBy':_0x5225e8(0x101),'statusChangedAt':new Date()};_0xc138ae&&(_0x33994a['adminNotes']=_0xc138ae);_0x5abce8===_0x5225e8(0x166)&&_0x5b6ac7&&(_0x33994a[_0x5225e8(0xc1)]=_0x5b6ac7);let _0x28cc61=0x0,_0x5912f4=_0x1a675a['shop']['balance'];if(_0x5abce8===_0x5225e8(0x158)&&_0x2ee174!=='PAID'){_0x33994a[_0x5225e8(0xe3)]=new Date();const _0x389053=await currencyService_1['currencyService'][_0x5225e8(0x195)](_0x1a675a[_0x5225e8(0x1be)],_0x1a675a[_0x5225e8(0x132)]);_0x33994a[_0x5225e8(0x134)]=_0x389053;let _0x2b9823=0x2d;const _0x4cf87c=await _0xa0b2f2[_0x5225e8(0x1cb)][_0x5225e8(0x1c3)]({'where':{'id':_0x1a675a[_0x5225e8(0x16e)]},'select':{'gatewaySettings':!![]}});if(_0x4cf87c?.[_0x5225e8(0xa9)])try{const _0x51642a=JSON[_0x5225e8(0xb1)](_0x4cf87c[_0x5225e8(0xa9)]);for(const [_0x451f03,_0x3c0af2]of Object[_0x5225e8(0x1c2)](_0x51642a)){if(_0x451f03[_0x5225e8(0x1b0)]()===_0x1a675a[_0x5225e8(0xab)][_0x5225e8(0x1b0)]()){_0x2b9823=_0x3c0af2['commission']||0xa;break;}}}catch(_0x2db6d9){console[_0x5225e8(0x129)](_0x5225e8(0x184)+_0x36fd83+':',_0x2db6d9);}let _0xb289c2;_0x1a675a[_0x5225e8(0x1b7)]!==null&&_0x1a675a[_0x5225e8(0x1b7)]!==undefined?(_0xb289c2=_0x1a675a[_0x5225e8(0x1b7)],console[_0x5225e8(0x179)]('üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0xb289c2[_0x5225e8(0x119)](0x6)+_0x5225e8(0x93)+_0x36fd83)):(_0xb289c2=_0x389053*(0x1-_0x2b9823/0x64),console[_0x5225e8(0x179)](_0x5225e8(0x88)+_0x36fd83+':\x20'+_0x2b9823+_0x5225e8(0x117)+_0x389053[_0x5225e8(0x119)](0x6)+_0x5225e8(0x83)),_0x33994a[_0x5225e8(0x1b7)]=_0xb289c2,_0x33994a[_0x5225e8(0x100)]=_0x2b9823),_0x28cc61=_0xb289c2,_0x5912f4+=_0xb289c2,console['log']('üí∞\x20Payment\x20'+_0x36fd83+_0x5225e8(0xbd)),console['log'](_0x5225e8(0x1c0)+_0x389053[_0x5225e8(0x119)](0x6)+_0x5225e8(0x83)),console['log'](_0x5225e8(0x17d)+_0x1a675a[_0x5225e8(0xab)]+',\x20Commission:\x20'+_0x2b9823+'%'),console[_0x5225e8(0x179)](_0x5225e8(0x12d)+_0xb289c2[_0x5225e8(0x119)](0x6)+'\x20USDT\x20(after\x20'+_0x2b9823+_0x5225e8(0x141)),console[_0x5225e8(0x179)](_0x5225e8(0x1ea)+_0xb289c2[_0x5225e8(0x119)](0x6)+_0x5225e8(0x83));}else{if(_0x2ee174===_0x5225e8(0x158)&&_0x5abce8!=='PAID'&&_0x5abce8!==_0x5225e8(0x166)){if(_0x1a675a[_0x5225e8(0x134)]){let _0xf16bc=0x2d;const _0x55024d=await _0xa0b2f2[_0x5225e8(0x1cb)][_0x5225e8(0x1c3)]({'where':{'id':_0x1a675a['shopId']},'select':{'gatewaySettings':!![]}});if(_0x55024d?.[_0x5225e8(0xa9)])try{const _0x2139c4=JSON['parse'](_0x55024d['gatewaySettings']);for(const [_0x4dfe8e,_0x3898c6]of Object['entries'](_0x2139c4)){if(_0x4dfe8e[_0x5225e8(0x1b0)]()===_0x1a675a[_0x5225e8(0xab)][_0x5225e8(0x1b0)]()){_0xf16bc=_0x3898c6[_0x5225e8(0x19a)]||0xa;break;}}}catch(_0x2771f0){console[_0x5225e8(0x129)](_0x5225e8(0x184)+_0x36fd83+':',_0x2771f0);}const _0x37e515=_0x1a675a[_0x5225e8(0x134)]*(0x1-_0xf16bc/0x64);_0x28cc61=-_0x37e515,_0x5912f4-=_0x37e515,console[_0x5225e8(0x179)](_0x5225e8(0x1c0)+_0x1a675a[_0x5225e8(0x134)][_0x5225e8(0x119)](0x6)+_0x5225e8(0x83)),console['log'](_0x5225e8(0x17d)+_0x1a675a[_0x5225e8(0xab)]+_0x5225e8(0xac)+_0xf16bc+'%'),console[_0x5225e8(0x179)](_0x5225e8(0xa1)+_0x37e515[_0x5225e8(0x119)](0x6)+'\x20USDT\x20(after\x20'+_0xf16bc+_0x5225e8(0x141)),console[_0x5225e8(0x179)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x37e515[_0x5225e8(0x119)](0x6)+_0x5225e8(0x83));}}}_0x5abce8===_0x5225e8(0x166)&&(console[_0x5225e8(0x179)](_0x5225e8(0x1ba)),_0x5b6ac7&&_0x5b6ac7>0x0?(_0x28cc61=-_0x5b6ac7,_0x5912f4-=_0x5b6ac7,console['log'](_0x5225e8(0x1e9)+_0x5b6ac7[_0x5225e8(0x119)](0x6)+_0x5225e8(0x16d)),console[_0x5225e8(0x179)](_0x5225e8(0x112))):console[_0x5225e8(0x179)](_0x5225e8(0x105)),_0x33994a[_0x5225e8(0xc1)]=_0x5b6ac7||0x0);_0x5abce8===_0x5225e8(0x91)&&_0x2ee174===_0x5225e8(0x158)&&console[_0x5225e8(0x179)](_0x5225e8(0x8c));const _0x3944ee=await _0xa0b2f2[_0x5225e8(0x96)][_0x5225e8(0x15f)]({'where':{'id':_0x36fd83},'data':_0x33994a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x28cc61!==0x0&&(await _0xa0b2f2[_0x5225e8(0x1cb)][_0x5225e8(0x15f)]({'where':{'id':_0x1a675a[_0x5225e8(0x16e)]},'data':{'balance':_0x5912f4}}),console[_0x5225e8(0x179)](_0x5225e8(0xfa)+_0x1a675a[_0x5225e8(0x16e)]+_0x5225e8(0x14b)+_0x1a675a[_0x5225e8(0x1cb)]['balance'][_0x5225e8(0x119)](0x6)+_0x5225e8(0x1ae)+_0x5912f4[_0x5225e8(0x119)](0x6)+_0x5225e8(0x8b)+(_0x28cc61>0x0?'+':'')+_0x28cc61[_0x5225e8(0x119)](0x6)+')')),_0x3944ee;});return{'id':_0x5832a7['id'],'shopId':_0x5832a7['shopId'],'gateway':_0x5832a7['gateway'],'amount':_0x5832a7[_0x547ea9(0x1be)],'currency':_0x5832a7[_0x547ea9(0x132)],'status':_0x5832a7[_0x547ea9(0x1ed)],'orderId':_0x5832a7['orderId'],'gatewayOrderId':_0x5832a7['gatewayOrderId'],'customerEmail':_0x5832a7[_0x547ea9(0x173)],'customerName':_0x5832a7[_0x547ea9(0x13b)],'customerCountry':_0x5832a7['customerCountry'],'customerIp':_0x5832a7['customerIp'],'customerUa':_0x5832a7[_0x547ea9(0xe4)],'failureMessage':_0x5832a7['failureMessage'],'adminNotes':_0x5832a7[_0x547ea9(0x102)],'chargebackAmount':_0x5832a7[_0x547ea9(0xc1)],'statusChangedBy':_0x5832a7[_0x547ea9(0x1cd)],'statusChangedAt':_0x5832a7[_0x547ea9(0x8d)],'createdAt':_0x5832a7[_0x547ea9(0x127)],'updatedAt':_0x5832a7[_0x547ea9(0x19e)],'shop':_0x5832a7[_0x547ea9(0x1cb)]};}async['updateUser'](_0x5a7e90,_0xa2b647){const _0x59421b=a46_0x57cbd5,_0x1a6443=Math['random']()['toString'](0x24)[_0x59421b(0x19b)](0x2,0x9);console[_0x59421b(0x179)](_0x59421b(0x11d)+_0x1a6443+_0x59421b(0x138)+_0x5a7e90);const _0x4fe300={..._0xa2b647};_0xa2b647['password']&&_0xa2b647[_0x59421b(0x1e1)]['trim']()!==''?(console[_0x59421b(0x179)](_0x59421b(0x1c1)+_0x1a6443+']\x20Updating\x20password\x20for\x20user\x20'+_0x5a7e90),_0x4fe300[_0x59421b(0x1e1)]=await bcryptjs_1[_0x59421b(0xa3)][_0x59421b(0xdc)](_0xa2b647['password'],0xc)):(console['log'](_0x59421b(0x1c1)+_0x1a6443+_0x59421b(0x183)),delete _0x4fe300[_0x59421b(0x1e1)]);_0xa2b647[_0x59421b(0xcb)]&&(_0x4fe300[_0x59421b(0x1b1)]=_0xa2b647[_0x59421b(0xcb)],delete _0x4fe300[_0x59421b(0xcb)]);_0xa2b647[_0x59421b(0x80)]&&(_0x4fe300[_0x59421b(0x1bc)]=_0xa2b647[_0x59421b(0x80)],delete _0x4fe300[_0x59421b(0x80)]);_0xa2b647[_0x59421b(0x104)]&&(_0x4fe300[_0x59421b(0x182)]=_0xa2b647[_0x59421b(0x104)],delete _0x4fe300['merchantUrl']);if(_0xa2b647['gateways']){const _0xae7e28=_0xa2b647[_0x59421b(0xcd)][_0x59421b(0xcc)](_0x4684c5=>this[_0x59421b(0x162)](_0x4684c5));console[_0x59421b(0x179)]('üîÑ\x20Gateway\x20mapping:',_0xa2b647[_0x59421b(0xcd)],'->',_0xae7e28),_0x4fe300[_0x59421b(0x1d7)]=JSON['stringify'](_0xae7e28),delete _0x4fe300[_0x59421b(0xcd)];}_0xa2b647[_0x59421b(0xa9)]&&(console['log'](_0x59421b(0xe5)+_0x1a6443+_0x59421b(0x1bf),_0xa2b647[_0x59421b(0xa9)]),_0x4fe300[_0x59421b(0xa9)]=JSON[_0x59421b(0x84)](_0xa2b647[_0x59421b(0xa9)]),console[_0x59421b(0x179)]('üîß\x20['+_0x1a6443+']\x20Gateway\x20settings\x20JSON\x20string:',_0x4fe300[_0x59421b(0xa9)]));_0xa2b647['wallets']&&(_0xa2b647[_0x59421b(0xea)]['usdtPolygonWallet']!==undefined&&(_0x4fe300[_0x59421b(0x13d)]=_0xa2b647[_0x59421b(0xea)][_0x59421b(0x13d)]||null),_0xa2b647['wallets'][_0x59421b(0x1c4)]!==undefined&&(_0x4fe300[_0x59421b(0x1c4)]=_0xa2b647[_0x59421b(0xea)][_0x59421b(0x1c4)]||null),_0xa2b647[_0x59421b(0xea)][_0x59421b(0x139)]!==undefined&&(_0x4fe300[_0x59421b(0x139)]=_0xa2b647[_0x59421b(0xea)]['usdtErcWallet']||null),_0xa2b647[_0x59421b(0xea)]['usdcPolygonWallet']!==undefined&&(_0x4fe300[_0x59421b(0x19c)]=_0xa2b647['wallets'][_0x59421b(0x19c)]||null),delete _0x4fe300[_0x59421b(0xea)]);const _0x16c67c=await database_1[_0x59421b(0xa3)][_0x59421b(0x1cb)]['update']({'where':{'id':_0x5a7e90},'data':_0x4fe300,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x59421b(0x179)](_0x59421b(0x12c)+_0x1a6443+_0x59421b(0x146),_0x16c67c[_0x59421b(0xa9)]),{'id':_0x16c67c['id'],'fullName':_0x16c67c[_0x59421b(0x1b1)],'username':_0x16c67c[_0x59421b(0xa7)],'telegramId':_0x16c67c[_0x59421b(0x1bc)],'merchantUrl':_0x16c67c['shopUrl'],'gateways':_0x16c67c[_0x59421b(0x1d7)]?JSON[_0x59421b(0xb1)](_0x16c67c[_0x59421b(0x1d7)]):null,'gatewaySettings':_0x16c67c[_0x59421b(0xa9)]?JSON[_0x59421b(0xb1)](_0x16c67c[_0x59421b(0xa9)]):null,'publicKey':_0x16c67c[_0x59421b(0x107)],'wallets':{'usdtPolygonWallet':_0x16c67c[_0x59421b(0x13d)],'usdtTrcWallet':_0x16c67c[_0x59421b(0x1c4)],'usdtErcWallet':_0x16c67c[_0x59421b(0x139)],'usdcPolygonWallet':_0x16c67c[_0x59421b(0x19c)]},'status':_0x16c67c[_0x59421b(0x1ed)],'createdAt':_0x16c67c[_0x59421b(0x127)]};}async[a46_0x57cbd5(0xf8)](_0xe2e107){const _0x7138cd=a46_0x57cbd5,_0x4ddde5=await database_1[_0x7138cd(0xa3)][_0x7138cd(0x1cb)]['update']({'where':{'id':_0xe2e107},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4ddde5['id'],'fullName':_0x4ddde5[_0x7138cd(0x1b1)],'username':_0x4ddde5[_0x7138cd(0xa7)],'telegramId':_0x4ddde5[_0x7138cd(0x1bc)],'merchantUrl':_0x4ddde5['shopUrl'],'gateways':_0x4ddde5[_0x7138cd(0x1d7)]?JSON[_0x7138cd(0xb1)](_0x4ddde5['paymentGateways']):null,'gatewaySettings':_0x4ddde5[_0x7138cd(0xa9)]?JSON[_0x7138cd(0xb1)](_0x4ddde5[_0x7138cd(0xa9)]):null,'publicKey':_0x4ddde5[_0x7138cd(0x107)],'wallets':{'usdtPolygonWallet':_0x4ddde5[_0x7138cd(0x13d)],'usdtTrcWallet':_0x4ddde5[_0x7138cd(0x1c4)],'usdtErcWallet':_0x4ddde5['usdtErcWallet'],'usdcPolygonWallet':_0x4ddde5['usdcPolygonWallet']},'status':_0x4ddde5[_0x7138cd(0x1ed)],'createdAt':_0x4ddde5['createdAt']};}async[a46_0x57cbd5(0x152)](_0x38cbf7){const _0x5c952a=a46_0x57cbd5,_0x192f99=await database_1[_0x5c952a(0xa3)][_0x5c952a(0x1cb)]['update']({'where':{'id':_0x38cbf7},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x192f99['id'],'fullName':_0x192f99[_0x5c952a(0x1b1)],'username':_0x192f99[_0x5c952a(0xa7)],'telegramId':_0x192f99['telegram'],'merchantUrl':_0x192f99[_0x5c952a(0x182)],'gateways':_0x192f99[_0x5c952a(0x1d7)]?JSON[_0x5c952a(0xb1)](_0x192f99[_0x5c952a(0x1d7)]):null,'gatewaySettings':_0x192f99['gatewaySettings']?JSON[_0x5c952a(0xb1)](_0x192f99[_0x5c952a(0xa9)]):null,'publicKey':_0x192f99[_0x5c952a(0x107)],'wallets':{'usdtPolygonWallet':_0x192f99[_0x5c952a(0x13d)],'usdtTrcWallet':_0x192f99['usdtTrcWallet'],'usdtErcWallet':_0x192f99['usdtErcWallet'],'usdcPolygonWallet':_0x192f99[_0x5c952a(0x19c)]},'status':_0x192f99[_0x5c952a(0x1ed)],'createdAt':_0x192f99['createdAt']};}async[a46_0x57cbd5(0x18c)](_0x1c2591){const _0x47fe0f=a46_0x57cbd5,{page:_0x3abf30,limit:_0x58138a,status:_0x31072b}=_0x1c2591,_0x13c6bb=(_0x3abf30-0x1)*_0x58138a,_0x52da55={};_0x31072b&&(_0x52da55['status']=_0x31072b[_0x47fe0f(0x17a)]());const [_0x5907ff,_0x1dca4d]=await Promise[_0x47fe0f(0xfc)]([database_1['default']['shop'][_0x47fe0f(0x14f)]({'where':_0x52da55,'skip':_0x13c6bb,'take':_0x58138a,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x47fe0f(0xa3)]['shop']['count']({'where':_0x52da55})]);return{'users':_0x5907ff[_0x47fe0f(0xcc)](_0x13b2f0=>{const _0x128f3a=_0x47fe0f,_0x515038=_0x13b2f0[_0x128f3a(0x1d7)]?JSON[_0x128f3a(0xb1)](_0x13b2f0[_0x128f3a(0x1d7)]):null,_0x382c6b=_0x515038?_0x515038['map'](_0x5b65b2=>this[_0x128f3a(0x1cf)](_0x5b65b2)):null;return{'id':_0x13b2f0['id'],'fullName':_0x13b2f0[_0x128f3a(0x1b1)],'username':_0x13b2f0['username'],'telegramId':_0x13b2f0[_0x128f3a(0x1bc)],'merchantUrl':_0x13b2f0[_0x128f3a(0x182)],'gateways':_0x382c6b,'gatewaySettings':_0x13b2f0[_0x128f3a(0xa9)]?JSON['parse'](_0x13b2f0[_0x128f3a(0xa9)]):null,'publicKey':_0x13b2f0['publicKey'],'wallets':{'usdtPolygonWallet':_0x13b2f0[_0x128f3a(0x13d)],'usdtTrcWallet':_0x13b2f0[_0x128f3a(0x1c4)],'usdtErcWallet':_0x13b2f0['usdtErcWallet'],'usdcPolygonWallet':_0x13b2f0[_0x128f3a(0x19c)]},'status':_0x13b2f0[_0x128f3a(0x1ed)],'createdAt':_0x13b2f0[_0x128f3a(0x127)]};}),'pagination':{'page':_0x3abf30,'limit':_0x58138a,'total':_0x1dca4d,'totalPages':Math[_0x47fe0f(0xce)](_0x1dca4d/_0x58138a)}};}async[a46_0x57cbd5(0x1c6)](_0x2071f1){const _0x333213=a46_0x57cbd5,_0x4f7071=await database_1[_0x333213(0xa3)][_0x333213(0x1cb)][_0x333213(0x1c3)]({'where':{'id':_0x2071f1},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4f7071)return null;const _0x2229a5=_0x4f7071[_0x333213(0x1d7)]?JSON[_0x333213(0xb1)](_0x4f7071[_0x333213(0x1d7)]):null,_0x229a3b=_0x2229a5?_0x2229a5[_0x333213(0xcc)](_0x467b79=>this[_0x333213(0x1cf)](_0x467b79)):null;return _0x2229a5&&_0x229a3b&&console['log'](_0x333213(0xd9),_0x2229a5,'->',_0x229a3b),{'id':_0x4f7071['id'],'fullName':_0x4f7071[_0x333213(0x1b1)],'username':_0x4f7071[_0x333213(0xa7)],'telegramId':_0x4f7071[_0x333213(0x1bc)],'merchantUrl':_0x4f7071[_0x333213(0x182)],'gateways':_0x229a3b,'gatewaySettings':_0x4f7071['gatewaySettings']?JSON[_0x333213(0xb1)](_0x4f7071[_0x333213(0xa9)]):null,'publicKey':_0x4f7071['publicKey'],'wallets':{'usdtPolygonWallet':_0x4f7071[_0x333213(0x13d)],'usdtTrcWallet':_0x4f7071[_0x333213(0x1c4)],'usdtErcWallet':_0x4f7071[_0x333213(0x139)],'usdcPolygonWallet':_0x4f7071[_0x333213(0x19c)]},'status':_0x4f7071['status'],'createdAt':_0x4f7071[_0x333213(0x127)]};}async[a46_0x57cbd5(0xa0)](_0x498bfb){const _0x3bafbe=a46_0x57cbd5,{fullName:_0x54fbfa,username:_0x6aeade,password:_0x5d91f0,telegramId:_0x4fa367,merchantUrl:_0x5c913c,gateways:_0x4bad57,gatewaySettings:_0x459193,wallets:_0x924734}=_0x498bfb,_0x27f876=await database_1['default'][_0x3bafbe(0x1cb)]['findUnique']({'where':{'username':_0x6aeade}});if(_0x27f876)throw new Error('Username\x20already\x20exists');if(_0x4fa367){const _0xb67b1f=await database_1[_0x3bafbe(0xa3)][_0x3bafbe(0x1cb)][_0x3bafbe(0x1c3)]({'where':{'telegram':_0x4fa367}});if(_0xb67b1f)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x15358f=await bcryptjs_1[_0x3bafbe(0xa3)][_0x3bafbe(0xdc)](_0x5d91f0,0xc),_0xca22ce=_0x3bafbe(0x1d0)+crypto_1[_0x3bafbe(0xa3)][_0x3bafbe(0xf2)](0x20)[_0x3bafbe(0x12b)](_0x3bafbe(0x9a)),_0xe3a876='sk_'+crypto_1['default'][_0x3bafbe(0xf2)](0x20)[_0x3bafbe(0x12b)](_0x3bafbe(0x9a)),_0x430ee2=_0x4bad57?_0x4bad57[_0x3bafbe(0xcc)](_0x47fada=>this['getGatewayInternalName'](_0x47fada)):null;_0x4bad57&&_0x430ee2&&console[_0x3bafbe(0x179)](_0x3bafbe(0x157),_0x4bad57,'->',_0x430ee2);const _0x3a4c9e=await database_1[_0x3bafbe(0xa3)][_0x3bafbe(0x1cb)][_0x3bafbe(0xbb)]({'data':{'name':_0x54fbfa,'username':_0x6aeade,'password':_0x15358f,'telegram':_0x4fa367,'shopUrl':_0x5c913c,'paymentGateways':_0x430ee2?JSON['stringify'](_0x430ee2):null,'gatewaySettings':_0x459193?JSON['stringify'](_0x459193):null,'usdtPolygonWallet':_0x924734?.[_0x3bafbe(0x13d)]||null,'usdtTrcWallet':_0x924734?.[_0x3bafbe(0x1c4)]||null,'usdtErcWallet':_0x924734?.[_0x3bafbe(0x139)]||null,'usdcPolygonWallet':_0x924734?.['usdcPolygonWallet']||null,'publicKey':_0xca22ce,'secretKey':_0xe3a876,'status':_0x3bafbe(0xd7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3a4c9e['id'],'fullName':_0x3a4c9e[_0x3bafbe(0x1b1)],'username':_0x3a4c9e[_0x3bafbe(0xa7)],'telegramId':_0x3a4c9e['telegram'],'merchantUrl':_0x3a4c9e['shopUrl'],'gateways':_0x3a4c9e[_0x3bafbe(0x1d7)]?JSON[_0x3bafbe(0xb1)](_0x3a4c9e[_0x3bafbe(0x1d7)]):null,'gatewaySettings':_0x3a4c9e['gatewaySettings']?JSON[_0x3bafbe(0xb1)](_0x3a4c9e['gatewaySettings']):null,'publicKey':_0x3a4c9e[_0x3bafbe(0x107)],'wallets':{'usdtPolygonWallet':_0x3a4c9e[_0x3bafbe(0x13d)],'usdtTrcWallet':_0x3a4c9e[_0x3bafbe(0x1c4)],'usdtErcWallet':_0x3a4c9e[_0x3bafbe(0x139)],'usdcPolygonWallet':_0x3a4c9e[_0x3bafbe(0x19c)]},'status':_0x3a4c9e['status'],'createdAt':_0x3a4c9e['createdAt']};}async[a46_0x57cbd5(0x1d1)](_0x46e581){const _0x5c069d=a46_0x57cbd5;await database_1['default'][_0x5c069d(0x1cb)][_0x5c069d(0x160)]({'where':{'id':_0x46e581}});}[a46_0x57cbd5(0x199)](_0x53176c,_0x59b64a,_0x1d0904){const _0x3e23ff=a46_0x57cbd5,_0x27cd22=new Map(),_0x3aaab1=new Date(_0x59b64a);while(_0x3aaab1<=_0x1d0904){const _0x4d984e=_0x3aaab1[_0x3e23ff(0x1db)]()[_0x3e23ff(0xed)]('T')[0x0];_0x27cd22[_0x3e23ff(0x1b8)](_0x4d984e,{'revenue':0x0,'count':0x0}),_0x3aaab1[_0x3e23ff(0x133)](_0x3aaab1['getDate']()+0x1);}for(const _0x419296 of _0x53176c){const _0x20de29=_0x419296['createdAt'][_0x3e23ff(0x1db)]()[_0x3e23ff(0xed)]('T')[0x0],_0x944397=_0x27cd22[_0x3e23ff(0xd3)](_0x20de29);_0x944397&&(_0x944397[_0x3e23ff(0x1bb)]+=0x1,_0x419296[_0x3e23ff(0x1ed)]==='PAID'&&(_0x419296[_0x3e23ff(0x134)]?_0x944397[_0x3e23ff(0x177)]+=_0x419296['amountUSDT']:console[_0x3e23ff(0x179)](_0x3e23ff(0xdb)+_0x419296['id']+_0x3e23ff(0xf7))));}const _0x479400=[],_0x3fd4bd=[];for(const [_0x40bd99,_0x3b19dc]of _0x27cd22){_0x479400['push']({'date':_0x40bd99,'amount':Math[_0x3e23ff(0xeb)](_0x3b19dc[_0x3e23ff(0x177)]*0x64)/0x64}),_0x3fd4bd['push']({'date':_0x40bd99,'count':_0x3b19dc[_0x3e23ff(0x1bb)]});}return{'dailyRevenue':_0x479400,'dailyPayments':_0x3fd4bd};}}exports[a46_0x57cbd5(0xb8)]=AdminService;function a46_0x23f4(_0x3db4b8,_0x54ff34){_0x3db4b8=_0x3db4b8-0x7f;const _0x5d73c9=a46_0x5d73();let _0x23f4f5=_0x5d73c9[_0x3db4b8];return _0x23f4f5;}function a46_0x5d73(){const _0x229c60=['klyme_de','PENDING','%\x20commission)','cointopay','period','\x20balance\x20updated:','payouts',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','1228262TBxRGU','not\x20specified','getUTCDate','crypto','\x20balance\x20updated:\x20','telegramBotService','getPayoutStats','getDate','findMany','\x20\x20\x20Transaction\x20hash:\x20','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','activateUser','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','KLYME\x20EU','totalPaidOut','getUTCFullYear','üîÑ\x20Gateway\x20mapping\x20(create):','PAID','usdcErcWallet','wallet','2020-01-01','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','128992wVbJVO','üìÖ\x20Date\x20from\x20filter:\x20','update','delete','Insufficient\x20balance.\x20Available:\x20','getGatewayInternalName','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','commissionUSDT','setUTCDate','CHARGEBACK','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','üîç\x20Selected\x20erc20\x20wallet:\x20',',\x20refunds:\x20','failUrl','\x20\x20\x20üí∞\x20Total\x20payout:\x20','desc','\x20USDT\x20from\x20balance','shopId','üìã\x20Found\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','periodTo','customerIp','customerEmail','getPaymentById','üí±\x20Currency\x20filter\x20applied:\x20','\x20\x20\x20Available\x20(number):\x20','revenue','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','log','toUpperCase','\x20\x20\x20Total\x20paid\x20out:\x20','totalPayments','\x20\x20\x20Gateway:\x20','36WweuUe','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','totalCommissionRate','shopUrl',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','Error\x20processing\x20payment\x20','last_week','\x20paid\x20payments\x20for\x20analysis','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','length','Shop\x20not\x20found','getAllUsers','periodFrom','this_week','18wlzdCB','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','orderId','includes','‚úÖ\x20Payout\x20created:\x20','slice','convertToUSDT','üí∞\x20Creating\x20payout\x20for\x20shop\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','generateDailyStatistics','commission','substr','usdcPolygonWallet','gatewayEarnings','updatedAt','values','\x20USDT,\x20Difference:\x20','totalAmountUSDT','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','üí∞\x20Current\x20shop\x20balance:\x20','paymentsCount','gte','asc','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','setHours','reduce','replace','EXPIRED','\x20order','\x20->\x20','aggregate','toLowerCase','name','getTime','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','üîç\x20Using\x20gateway\x20\x27','24120WZXIeJ','notes','amountAfterGatewayCommissionUSDT','set','\x20\x20\x20Requested\x20(number):\x20','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','count','telegram','KLYME\x20DE','amount',']\x20Gateway\x20settings\x20before\x20saving:','\x20\x20\x20Full\x20amount:\x20','üîê\x20[','entries','findUnique','usdtTrcWallet','\x20\x20\x20Balance:\x20','getUserById','klyme_eu','üîç\x20Initial\x20wallet\x20from\x20request:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','gatewayOrderId','shop','deletePayout','statusChangedBy','ru-RU','getGatewayDisplayName','pk_','deleteUser','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20USDT\x20(current\x20balance\x20in\x20DB)','üîç\x20Selected\x20polygon\x20wallet:\x20','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','startsWith','paymentGateways','date','__esModule','failureMessage','toISOString','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','averageCommissionRate','yesterday','\x20USDT,\x20Requested:\x20','whiteUrl','password','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)',',\x20successful:\x20','getMerchantsSelection','\x20-\x20','236919sxInhe','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','$transaction','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','\x20\x20\x20Added\x20to\x20balance:\x20+','customerCountry','today','status','\x20\x20\x20ü§î\x20Difference:\x20','telegramId','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','test_gateway','\x20USDT','stringify','NONEXISTENT_GATEWAY_FILTER','\x20status:\x20','\x20\x20\x20üåç\x20Country:\x20','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','Plisio','../config/database','\x20USDT\x20(','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','statusChangedAt','trc20','\x20\x20\x20üìÖ\x20This\x20month:\x20','üí≥\x20Final\x20payout\x20wallet\x20for\x20','REFUND','üí∞\x20Found\x20','\x20USDT\x20for\x20payment\x20','dateFrom','\x20merchants\x20for\x20selection','payment','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','getMonth','externalPaymentUrl','hex','46665FgGGav','dateTo','lte','\x27\x20(from\x20\x27','year','createUser','\x20\x20\x20Merchant\x20loses:\x20','pendingPayout','default','erc20_usdc','forEach','\x20in\x20','username',',\x20chargebacks:\x20','gatewaySettings','MasterCard','gateway',',\x20Commission:\x20','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','filter','üìÖ\x20Date\x20to\x20filter:\x20','Open\x20Banking\x202','parse','merchantEarnings','üí∞\x20[PAYOUT]\x20Gateway\x20','findFirst','rapyd','üìä\x20Calculating\x20payout\x20statistics...','getUTCMonth','AdminService','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','Noda','create','warn','\x20became\x20PAID:','groupBy','Test\x20Gateway','turnoverUSDT','chargebackAmount','some','\x20USDT\x20(+','\x20with\x20payout\x20history','2655uDufmK','UTC','\x20USDT)','payout','toLocaleDateString','balance','fullName','map','gateways','ceil','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','\x20\x20\x20Payout\x20amount:\x20','turnover','__importDefault','get','_count','\x27\x20to\x20name\x20\x27','\x20\x20\x20Tolerance:\x20','ACTIVE','totalAmountAfterCommissionUSDT','üîÑ\x20Gateway\x20mapping\x20(get):','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','‚ö†Ô∏è\x20Payment\x20','hash','\x20payments)','4030320mndNaW','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','floor','KLYME\x20GB','averageCheckUSDT','paidAt','customerUa','üîß\x20[','\x20USDT\x20(total\x20paid\x20to\x20merchants)','getDay','custom_','thisMonth','wallets','round','2232450btAsIZ','split','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','\x20\x20\x20Current\x20balance:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','randomBytes','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20Available\x20(raw):\x20','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','suspendUser','\x20\x20\x20üíµ\x20Available\x20balance:\x20','üí∞\x20Shop\x20','last_month','all','defineProperty','paidOutUSDT','./telegramBotService','gatewayCommissionRate','admin','adminNotes','_sum','merchantUrl','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','\x20to\x20','publicKey','\x20USDT\x20(already\x20paid\x20out)','getMerchantsAwaitingPayout','\x20\x20\x20Difference:\x20','./currencyService','\x27\x20->\x20ID\x20\x27','polygon_usdc','not\x20set','0000','join','insensitive','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20merchants','\x20USDT\x20(-','klyme_gb','Payment\x20not\x20found','%\x20from\x20','\x20\x20\x20üåê\x20IP:\x20','toFixed','sort','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','erc20','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','getAllPayouts','COMPLETED','dailyPayments','txid','sendPayoutNotification','üîç\x20Selected\x20trc20\x20wallet:\x20','network','cointopay2','createdAt','localeCompare','error','getFullYear','toString','üéØ\x20[','\x20\x20\x20Merchant\x20gets:\x20','getGatewayNameById','dailyRevenue','\x20PAID\x20payments','merchantEarningsUSDT','currency','setDate','amountUSDT','totalPayout','\x20\x20\x20üí≥\x20Total\x20payments:\x20','‚ö†Ô∏è\x20Gateway\x20\x27',',\x20userId:\x20','usdtErcWallet','totalTurnover','customerName','availableBalance','usdtPolygonWallet','20iGTliB'];a46_0x5d73=function(){return _0x229c60;};return a46_0x5d73();}