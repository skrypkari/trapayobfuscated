'use strict';function a35_0x5e52(){const _0x11eca8=['dateFrom','username','pk_','turnover','commissionUSDT','7709165uRbzgA','create','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20USDT)','üìä\x20Calculating\x20commission\x20for\x20legacy\x20payment\x20','currencyService','\x20\x20\x20üíµ\x20Available\x20balance:\x20','telegramId','sort','map','name','merchantUrl','ceil','\x20USDT\x20(','__importDefault','\x20USDT,\x20Requested:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20PAID\x20payments','Plisio','üí∞\x20Found\x20','split','week','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20\x20\x20Current\x20balance:\x20','averageCheckUSDT','_count','\x20\x20\x20üí∞\x20Total\x20payout:\x20','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','usdtTrcWallet','getGatewayNameById','gatewayEarnings','\x27\x20->\x20ID\x20\x27','\x20to\x20','üîß\x20[','merchantEarnings','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','getPayoutById','deletePayout','summary',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','usdtPolygonWallet','substr','localeCompare','updateCustomerData','suspendUser','createdAt','periodFrom','getMerchantsSelection','period','createPayout','PAID','\x20merchants\x20with\x20positive\x20balance','KLYME\x20GB','\x20\x20\x20Gateway:\x20','Noda','year','publicKey','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','dailyPayments','join','klyme_eu','getUserById','\x20status:\x20','setDate','CHARGEBACK','toUpperCase','üí∞\x20Payment\x20','%\x20from\x20','getPayoutStats','üí∞\x20Current\x20shop\x20balance:\x20','hash','8cZoufI','KLYME\x20EU','8529493rvNhSx','getTime',']\x20Gateway\x20settings\x20before\x20saving:','customerName','failureMessage','successUrl','trc20','amount','\x20USDT\x20(same\x20as\x20awaiting)','üîê\x20[','usdcPolygonWallet','üí∏\x20CHARGEBACK\x20penalty:\x20-','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','payout','error','üîÑ\x20Admin\x20updating\x20payment\x20','üìä\x20Payout\x20statistics\x20calculated:','shopId','all','parse','üîÑ\x20Gateway\x20mapping:','includes','CoinToPay','log','asc','adminNotes','\x20\x20\x20Balance:\x20','desc','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','toString',',\x20successful:\x20','\x20\x20\x20üìÖ\x20This\x20month:\x20','statusChangedBy','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','setHours','getPaymentById','revenue','\x20order','getGatewayIdByName','get','gatewayOrderId','findUnique','\x20USDT\x20(gross\x20revenue)','üîÑ\x20Gateway\x20mapping\x20(get):','2751458FlLzYq','balance','orderId','üìã\x20Found\x20','randomBytes','activateUser','getAllPayments','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','üìä\x20Available\x20gateways\x20in\x20database:','toISOString','getDate','MasterCard','\x20->\x20','fullName','customerUa','aggregate','%\x20commission)','random','paidAt','pendingPayout','../types/gateway','\x20USDT\x20(-','amountAfterGatewayCommissionUSDT','stringify','deleteUser','üìä\x20Getting\x20payments\x20with\x20filters:','shopUrl','Insufficient\x20balance.\x20Available:\x20','customerIp','\x20balance\x20updated:','$transaction','2020-01-01','sk_','values','gte','\x27\x20(from\x20\x27','\x20\x20\x20üåê\x20IP:\x20','Open\x20Banking\x202','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','trim','paymentGateways','üí∞\x20Shop\x20','awaitingPayout','\x20USDT\x20(theoretical\x20net)','delete','\x20\x20\x20Merchant\x20gets:\x20','payment','72121761BPMSyE','network','default','custom','\x20\x20\x20üí≥\x20Total\x20payments:\x20','üí±\x20Currency\x20filter\x20applied:\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','customerEmail','REFUND','üìä\x20Calculating\x20payout\x20statistics...','üí∞\x20[PAYOUT]\x20Merchant\x20','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','üìÖ\x20Period:\x20','AdminService','_sum','\x20\x20\x20Full\x20amount:\x20','SUSPENDED','thisMonth','‚ö†Ô∏è\x20Payment\x20','getAllPayouts','./currencyService','amountUSDT','shop','update','forEach','klyme_gb','üîç\x20Using\x20gateway\x20\x27','ACTIVE','\x27\x20->\x20name\x20\x27','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','whiteUrl','0000','findFirst','length','totalCommissionRate','averageCommissionRate','customerCountry','set','2625579rMocTg','getMonth','Username\x20already\x20exists','\x20\x20\x20üåç\x20Country:\x20','\x27\x20to\x20name\x20\x27','wallets','status','getGatewayDisplayName','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','txid','date','\x20active\x20merchants\x20for\x20selection','getAllUsers','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','entries','\x20USDT\x20(without\x20commission)','telegram','bcryptjs','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','COMPLETED','amountAfterCommissionUSDT','commission','cointopay','Rapyd',']\x20Updating\x20password\x20for\x20user\x20','üîÑ\x20Converted\x20gateway\x20name\x20\x27','polygon','reduce','‚ö†Ô∏è\x20Gateway\x20\x27','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','üìä\x20Using\x20saved\x20historical\x20commission:\x20','totalPaidOut','Shop\x20not\x20found','7157424MzZoCa','PENDING','üéØ\x20[','üí∞\x20Creating\x20payout\x20for\x20shop\x20','count','mastercard','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','../config/database','getGatewayInternalName','toFixed','\x20no\x20longer\x20PAID:',',\x20Commission:\x20','groupBy','insensitive','totalAmountAfterCommissionUSDT','dateTo','currency','updatePaymentStatus','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','periodTo','\x20balance\x20updated:\x20','merchantEarningsUSDT','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','90d','\x20USDT\x20(after\x20payouts)','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','\x20\x20\x20Transaction\x20hash:\x20','updateUser','chargebackAmount','gateways','updatedAt','1Jtonjx','defineProperty','totalAmountUSDT','usdtErcWallet','üí≥\x20Payout\x20wallet\x20for\x20','crypto','getDay','üìä\x20Final\x20WHERE\x20conditions:','gatewaySettings','getMerchantsAwaitingPayout','getSystemStatistics','not\x20set','klyme_de','dailyRevenue','password','totalPayout','turnoverUSDT','totalPayments','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','push','\x20USDT\x20(actual\x20balances)','getFullYear','\x20USDT','paymentsCount','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','‚úÖ\x20Payout\x20created:\x20','\x20USDT\x20(with\x20commission\x20deducted)','toLowerCase','test_gateway','noda','3315780IXVQmZ','not\x20specified','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20USDT\x20(+','üìã\x20Getting\x20merchants\x20selection\x20list...','convertToUSDT','failUrl','gateway','findMany','round','hex','notes'];a35_0x5e52=function(){return _0x11eca8;};return a35_0x5e52();}const a35_0x42240e=a35_0x5df5;(function(_0x2e6ff6,_0x1ab111){const _0x70b8ce=a35_0x5df5,_0x2885c6=_0x2e6ff6();while(!![]){try{const _0x58656f=parseInt(_0x70b8ce(0x146))/0x1*(-parseInt(_0x70b8ce(0x1ea))/0x2)+-parseInt(_0x70b8ce(0x241))/0x3+-parseInt(_0x70b8ce(0x164))/0x4+-parseInt(_0x70b8ce(0x175))/0x5+-parseInt(_0x70b8ce(0x262))/0x6+-parseInt(_0x70b8ce(0x1be))/0x7+parseInt(_0x70b8ce(0x1bc))/0x8*(parseInt(_0x70b8ce(0x21a))/0x9);if(_0x58656f===_0x1ab111)break;else _0x2885c6['push'](_0x2885c6['shift']());}catch(_0x383d4d){_0x2885c6['push'](_0x2885c6['shift']());}}}(a35_0x5e52,0xef5ca));var __importDefault=this&&this[a35_0x42240e(0x183)]||function(_0x5c247f){return _0x5c247f&&_0x5c247f['__esModule']?_0x5c247f:{'default':_0x5c247f};};Object[a35_0x42240e(0x147)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x42240e(0x269))),bcryptjs_1=__importDefault(require(a35_0x42240e(0x252))),crypto_1=__importDefault(require(a35_0x42240e(0x14b))),currencyService_1=require(a35_0x42240e(0x22e)),gateway_1=require(a35_0x42240e(0x1fe));function a35_0x5df5(_0x1c2e47,_0x4140db){const _0x5e5248=a35_0x5e52();return a35_0x5df5=function(_0x5df52d,_0x30c9c3){_0x5df52d=_0x5df52d-0x145;let _0x3e823b=_0x5e5248[_0x5df52d];return _0x3e823b;},a35_0x5df5(_0x1c2e47,_0x4140db);}class AdminService{async[a35_0x42240e(0x1b9)](){const _0x1cc737=a35_0x42240e;console['log'](_0x1cc737(0x223));const _0x44c25c=await database_1['default'][_0x1cc737(0x230)][_0x1cc737(0x1f9)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x13d471=await this[_0x1cc737(0x14f)]({'page':0x1,'limit':0x3e8}),_0x58cc7b=await database_1[_0x1cc737(0x21c)][_0x1cc737(0x219)]['count']({'where':{'status':_0x1cc737(0x1a7),'gateway':{'not':'test_gateway'}}}),_0x565df0=new Date(),_0x50aa50=new Date(_0x565df0['getFullYear'](),_0x565df0[_0x1cc737(0x242)](),0x1),_0x1685ba=new Date(_0x565df0['getFullYear'](),_0x565df0[_0x1cc737(0x242)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x13e261=await database_1[_0x1cc737(0x21c)][_0x1cc737(0x1cb)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x50aa50,'lte':_0x1685ba},'status':_0x1cc737(0x254)}}),_0x4bc259=_0x44c25c[_0x1cc737(0x228)][_0x1cc737(0x260)]||0x0,_0x45effc=_0x13d471[_0x1cc737(0x19b)][_0x1cc737(0x270)],_0x5d7fae=_0x13e261[_0x1cc737(0x228)]['amount']||0x0,_0x113c90={'totalPayout':Math[_0x1cc737(0x16d)](_0x4bc259*0x64)/0x64,'awaitingPayout':Math['round'](_0x45effc*0x64)/0x64,'thisMonth':Math[_0x1cc737(0x16d)](_0x5d7fae*0x64)/0x64,'availableBalance':Math['round'](_0x45effc*0x64)/0x64,'totalPayments':_0x58cc7b};return console[_0x1cc737(0x1d5)](_0x1cc737(0x1ce)),console[_0x1cc737(0x1d5)](_0x1cc737(0x18f)+_0x113c90[_0x1cc737(0x155)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x1cc737(0x1d5)](_0x1cc737(0x268)+_0x113c90[_0x1cc737(0x215)]+_0x1cc737(0x160)),console[_0x1cc737(0x1d5)](_0x1cc737(0x17b)+_0x113c90['availableBalance']+_0x1cc737(0x1c6)),console['log'](_0x1cc737(0x1dd)+_0x113c90['thisMonth']+_0x1cc737(0x15c)),console[_0x1cc737(0x1d5)](_0x1cc737(0x21e)+_0x113c90[_0x1cc737(0x157)]+_0x1cc737(0x186)),console[_0x1cc737(0x1d5)](_0x1cc737(0x278)+(_0x44c25c[_0x1cc737(0x228)][_0x1cc737(0x1eb)]||0x0)[_0x1cc737(0x26b)](0x2)+_0x1cc737(0x250)),console[_0x1cc737(0x1d5)]('\x20\x20\x20üìä\x20Commission\x20difference:\x20'+((_0x44c25c[_0x1cc737(0x228)][_0x1cc737(0x1eb)]||0x0)-_0x45effc)[_0x1cc737(0x26b)](0x2)+'\x20USDT'),_0x113c90;}async[a35_0x42240e(0x1a0)](_0x59734a,_0x56abd6){const _0x18b6c8=a35_0x42240e;console['log'](_0x18b6c8(0x211)+_0x59734a+':',_0x56abd6);const _0x3880d8=await database_1[_0x18b6c8(0x21c)][_0x18b6c8(0x219)]['findUnique']({'where':{'id':_0x59734a},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3880d8)throw new Error('Payment\x20not\x20found');const _0x1471df={};_0x56abd6[_0x18b6c8(0x23f)]!==undefined&&(_0x1471df[_0x18b6c8(0x23f)]=_0x56abd6[_0x18b6c8(0x23f)]||null);_0x56abd6['customerIp']!==undefined&&(_0x1471df[_0x18b6c8(0x206)]=_0x56abd6[_0x18b6c8(0x206)]||null);_0x56abd6[_0x18b6c8(0x1f8)]!==undefined&&(_0x1471df['customerUa']=_0x56abd6[_0x18b6c8(0x1f8)]||null);const _0x37488a=await database_1[_0x18b6c8(0x21c)]['payment'][_0x18b6c8(0x231)]({'where':{'id':_0x59734a},'data':{..._0x1471df,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x18b6c8(0x1d5)](_0x18b6c8(0x225)+_0x59734a),console[_0x18b6c8(0x1d5)](_0x18b6c8(0x244)+_0x3880d8[_0x18b6c8(0x23f)]+_0x18b6c8(0x1f6)+_0x37488a['customerCountry']),console['log'](_0x18b6c8(0x20e)+_0x3880d8['customerIp']+'\x20->\x20'+_0x37488a[_0x18b6c8(0x206)]),console[_0x18b6c8(0x1d5)](_0x18b6c8(0x210)+(_0x3880d8[_0x18b6c8(0x1f8)]?_0x18b6c8(0x240):_0x18b6c8(0x151))+'\x20->\x20'+(_0x37488a[_0x18b6c8(0x1f8)]?_0x18b6c8(0x240):'not\x20set')),_0x37488a;}async[a35_0x42240e(0x150)](_0xbdc9d1){const _0x2ad266=a35_0x42240e,_0x4d1de2=new Date();let _0x2d24f5;switch(_0xbdc9d1){case'7d':_0x2d24f5=new Date(_0x4d1de2['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2d24f5=new Date(_0x4d1de2[_0x2ad266(0x1bf)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2ad266(0x279):_0x2d24f5=new Date(_0x4d1de2['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x16bed7=await database_1[_0x2ad266(0x21c)][_0x2ad266(0x219)][_0x2ad266(0x23b)]({'where':{'gateway':{'not':_0x2ad266(0x162)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x2d24f5=_0x16bed7?_0x16bed7[_0x2ad266(0x1a2)]:new Date(_0x2ad266(0x209)),console[_0x2ad266(0x1d5)](_0x2ad266(0x190)+_0x2d24f5[_0x2ad266(0x1f3)]());break;default:_0x2d24f5=new Date(_0x4d1de2[_0x2ad266(0x1bf)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x20e6bb,_0x1edf10,_0x50e2b9,_0xec55d7,_0xb5696,_0x4bd163,_0xe0c8ac]=await Promise[_0x2ad266(0x1d0)]([database_1[_0x2ad266(0x21c)][_0x2ad266(0x230)][_0x2ad266(0x266)](),database_1['default']['shop'][_0x2ad266(0x266)]({'where':{'status':_0x2ad266(0x235)}}),database_1['default'][_0x2ad266(0x219)][_0x2ad266(0x266)]({'where':{'createdAt':{'gte':_0x2d24f5},'gateway':{'not':'test_gateway'}}}),database_1[_0x2ad266(0x21c)]['payment']['count']({'where':{'status':_0x2ad266(0x1a7),'createdAt':{'gte':_0x2d24f5},'gateway':{'not':_0x2ad266(0x162)}}}),database_1[_0x2ad266(0x21c)][_0x2ad266(0x219)][_0x2ad266(0x16c)]({'where':{'status':_0x2ad266(0x1a7),'createdAt':{'gte':_0x2d24f5},'gateway':{'not':_0x2ad266(0x162)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x2ad266(0x21c)]['payment'][_0x2ad266(0x16c)]({'where':{'gateway':{'not':_0x2ad266(0x162)}},'take':0xa,'orderBy':{'createdAt':_0x2ad266(0x1d9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2ad266(0x21c)][_0x2ad266(0x219)][_0x2ad266(0x16c)]({'where':{'createdAt':{'gte':_0x2d24f5},'gateway':{'not':_0x2ad266(0x162)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x5ee915=0x0;for(const _0x1b91bd of _0xb5696){const _0x59a66e=await currencyService_1[_0x2ad266(0x17a)][_0x2ad266(0x169)](_0x1b91bd[_0x2ad266(0x1c5)],_0x1b91bd[_0x2ad266(0x272)]);_0x5ee915+=_0x59a66e;}const _0x2797e6=this['generateDailyStatistics'](_0xe0c8ac,_0x2d24f5,_0x4d1de2),_0xc29061=_0x50e2b9>0x0?_0xec55d7/_0x50e2b9*0x64:0x0;return{'totalShops':_0x20e6bb,'activeShops':_0x1edf10,'totalPayments':_0x50e2b9,'successfulPayments':_0xec55d7,'totalRevenue':Math['round'](_0x5ee915*0x64)/0x64,'conversionRate':Math[_0x2ad266(0x16d)](_0xc29061*0x64)/0x64,'dailyRevenue':_0x2797e6[_0x2ad266(0x153)],'dailyPayments':_0x2797e6[_0x2ad266(0x1af)],'recentPayments':_0x4bd163[_0x2ad266(0x17e)](_0x28cabf=>({'id':_0x28cabf['id'],'amount':_0x28cabf[_0x2ad266(0x1c5)],'currency':_0x28cabf[_0x2ad266(0x272)],'status':_0x28cabf['status'],'gateway':_0x28cabf['gateway'],'shop':_0x28cabf[_0x2ad266(0x230)],'createdAt':_0x28cabf['createdAt']}))};}async['getMerchantStatistics'](_0xc93cf2){const _0x430293=a35_0x42240e;console['log']('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0xc93cf2);let _0x11b5a6,_0x47a596=new Date();if(_0xc93cf2[_0x430293(0x1a5)]===_0x430293(0x21d)&&_0xc93cf2[_0x430293(0x170)]&&_0xc93cf2[_0x430293(0x271)])_0x11b5a6=new Date(_0xc93cf2[_0x430293(0x170)]),_0x47a596=new Date(_0xc93cf2[_0x430293(0x271)]);else{const _0xbcb002=new Date();switch(_0xc93cf2[_0x430293(0x1a5)]){case _0x430293(0x18a):const _0x40717d=_0xbcb002[_0x430293(0x14c)](),_0xc9b815=_0x40717d===0x0?0x6:_0x40717d-0x1;_0x11b5a6=new Date(_0xbcb002[_0x430293(0x1bf)]()-_0xc9b815*0x18*0x3c*0x3c*0x3e8),_0x11b5a6[_0x430293(0x1e0)](0x0,0x0,0x0,0x0);break;case'month':_0x11b5a6=new Date(_0xbcb002[_0x430293(0x15b)](),_0xbcb002['getMonth'](),0x1);break;case _0x430293(0x1ac):_0x11b5a6=new Date(_0xbcb002[_0x430293(0x15b)](),0x0,0x1);break;case _0x430293(0x1d0):default:_0x11b5a6=new Date(_0x430293(0x209));break;}}console[_0x430293(0x1d5)](_0x430293(0x226)+_0x11b5a6['toISOString']()+_0x430293(0x195)+_0x47a596[_0x430293(0x1f3)]());const _0x46cb1d={'status':_0x430293(0x1a7),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x11b5a6,'lte':_0x47a596}};_0xc93cf2[_0x430293(0x1cf)]&&(_0x46cb1d[_0x430293(0x1cf)]=_0xc93cf2[_0x430293(0x1cf)]);const _0x6b1f9f=await database_1[_0x430293(0x21c)][_0x430293(0x219)][_0x430293(0x16c)]({'where':_0x46cb1d,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x430293(0x1d5)](_0x430293(0x188)+_0x6b1f9f['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x25afd4={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x11b5a6,'lte':_0x47a596}};_0xc93cf2[_0x430293(0x1cf)]&&(_0x25afd4['shopId']=_0xc93cf2['shopId']);const _0x459dc6=await database_1[_0x430293(0x21c)][_0x430293(0x219)]['count']({'where':_0x25afd4});console['log']('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0x459dc6+_0x430293(0x1dc)+_0x6b1f9f[_0x430293(0x23c)]);let _0x4b29df=0x0,_0x331c57=0x0,_0x144305=0x0;const _0x139d60={},_0x5dbe51={},_0x4d6481={};for(const _0x54249e of _0x6b1f9f){try{const _0x51a46b=await currencyService_1[_0x430293(0x17a)][_0x430293(0x169)](_0x54249e['amount'],_0x54249e['currency']);let _0x540e42={};if(_0x54249e[_0x430293(0x230)][_0x430293(0x14e)])try{_0x540e42=JSON['parse'](_0x54249e[_0x430293(0x230)][_0x430293(0x14e)]);}catch(_0x396e17){console[_0x430293(0x1cc)](_0x430293(0x177)+_0x54249e[_0x430293(0x1cf)]+':',_0x396e17);}let _0xca3788={},_0x168aa3=0xa;for(const [_0x1d228a,_0x36b25b]of Object[_0x430293(0x24f)](_0x540e42)){if(_0x1d228a[_0x430293(0x161)]()===_0x54249e[_0x430293(0x16b)][_0x430293(0x161)]()){_0xca3788=_0x36b25b,_0x168aa3=_0x36b25b[_0x430293(0x256)]||0xa;break;}}let _0x5718e4,_0x336b4e;_0x54249e[_0x430293(0x200)]!==null&&_0x54249e[_0x430293(0x200)]!==undefined?(_0x5718e4=_0x54249e['amountAfterGatewayCommissionUSDT'],_0x336b4e=_0x51a46b-_0x5718e4,console[_0x430293(0x1d5)](_0x430293(0x25f)+_0x5718e4[_0x430293(0x26b)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x54249e['id'])):(_0x336b4e=_0x51a46b*(_0x168aa3/0x64),_0x5718e4=_0x51a46b-_0x336b4e,console[_0x430293(0x1d5)](_0x430293(0x179)+_0x54249e['id']+':\x20'+_0x168aa3+_0x430293(0x1b8)+_0x51a46b['toFixed'](0x6)+_0x430293(0x15c)));_0x4b29df+=_0x51a46b,_0x331c57+=_0x5718e4,_0x144305+=_0x336b4e;!_0x139d60[_0x54249e[_0x430293(0x16b)]]&&(_0x139d60[_0x54249e[_0x430293(0x16b)]]={'gateway':_0x54249e[_0x430293(0x16b)],'gatewayDisplayName':this[_0x430293(0x248)](_0x54249e['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x139d60[_0x54249e[_0x430293(0x16b)]][_0x430293(0x15d)]++,_0x139d60[_0x54249e[_0x430293(0x16b)]][_0x430293(0x156)]+=_0x51a46b,_0x139d60[_0x54249e[_0x430293(0x16b)]][_0x430293(0x174)]+=_0x336b4e,_0x139d60[_0x54249e['gateway']]['merchantEarningsUSDT']+=_0x5718e4,_0x139d60[_0x54249e[_0x430293(0x16b)]][_0x430293(0x23d)]+=_0x168aa3;!_0xc93cf2[_0x430293(0x1cf)]&&(!_0x5dbe51[_0x54249e[_0x430293(0x1cf)]]&&(_0x5dbe51[_0x54249e[_0x430293(0x1cf)]]={'shopId':_0x54249e[_0x430293(0x1cf)],'shopName':_0x54249e[_0x430293(0x230)][_0x430293(0x17f)],'shopUsername':_0x54249e[_0x430293(0x230)][_0x430293(0x171)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x5dbe51[_0x54249e[_0x430293(0x1cf)]][_0x430293(0x15d)]++,_0x5dbe51[_0x54249e[_0x430293(0x1cf)]][_0x430293(0x156)]+=_0x51a46b,_0x5dbe51[_0x54249e[_0x430293(0x1cf)]]['commissionUSDT']+=_0x336b4e,_0x5dbe51[_0x54249e[_0x430293(0x1cf)]][_0x430293(0x277)]+=_0x5718e4);const _0x478bb7=_0x54249e['paidAt'][_0x430293(0x1f3)]()[_0x430293(0x189)]('T')[0x0];!_0x4d6481[_0x478bb7]&&(_0x4d6481[_0x478bb7]={'date':_0x478bb7,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4d6481[_0x478bb7][_0x430293(0x173)]+=_0x51a46b,_0x4d6481[_0x478bb7]['merchantEarnings']+=_0x5718e4,_0x4d6481[_0x478bb7]['gatewayEarnings']+=_0x336b4e,_0x4d6481[_0x478bb7][_0x430293(0x15d)]++;}catch(_0x57b8ab){console[_0x430293(0x1cc)]('Error\x20processing\x20payment\x20'+_0x54249e['id']+':',_0x57b8ab);}}Object['values'](_0x139d60)['forEach'](_0x4796fa=>{const _0x33f70b=_0x430293;_0x4796fa[_0x33f70b(0x23e)]=_0x4796fa['paymentsCount']>0x0?_0x4796fa[_0x33f70b(0x23d)]/_0x4796fa[_0x33f70b(0x15d)]:0x0,delete _0x4796fa[_0x33f70b(0x23d)];}),Object[_0x430293(0x20b)](_0x5dbe51)[_0x430293(0x232)](_0x390105=>{const _0x31f970=_0x430293;_0x390105[_0x31f970(0x18d)]=_0x390105[_0x31f970(0x15d)]>0x0?_0x390105[_0x31f970(0x156)]/_0x390105['paymentsCount']:0x0;});let _0x2b6e92=0x0,_0xa607d0=0x0;if(_0xc93cf2[_0x430293(0x1cf)]){const _0x161327=await database_1[_0x430293(0x21c)][_0x430293(0x1cb)][_0x430293(0x16c)]({'where':{'shopId':_0xc93cf2[_0x430293(0x1cf)],'status':'COMPLETED','createdAt':{'gte':_0x11b5a6,'lte':_0x47a596}},'select':{'amount':!![]}});_0x2b6e92=_0x161327['reduce']((_0x57b143,_0x48e60a)=>_0x57b143+_0x48e60a['amount'],0x0);const _0x3d4490=await database_1[_0x430293(0x21c)][_0x430293(0x1cb)][_0x430293(0x16c)]({'where':{'shopId':_0xc93cf2[_0x430293(0x1cf)],'status':_0x430293(0x263),'createdAt':{'gte':_0x11b5a6,'lte':_0x47a596}},'select':{'amount':!![]}});_0xa607d0=_0x3d4490['reduce']((_0x3512d3,_0x1420c3)=>_0x3512d3+_0x1420c3[_0x430293(0x1c5)],0x0);}const _0x2d5c63=_0x459dc6,_0x204376=_0x6b1f9f[_0x430293(0x23c)],_0xee0e89=_0x204376>0x0?_0x4b29df/_0x204376:0x0,_0x1b846b=_0x2d5c63>0x0?Math[_0x430293(0x16d)](_0x204376/_0x2d5c63*0x2710)/0x64:0x0,_0x209125=Math[_0x430293(0x181)]((_0x47a596[_0x430293(0x1bf)]()-_0x11b5a6[_0x430293(0x1bf)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3c50be={'totalTurnover':Math[_0x430293(0x16d)](_0x4b29df*0x64)/0x64,'merchantEarnings':Math['round'](_0x331c57*0x64)/0x64,'gatewayEarnings':Math[_0x430293(0x16d)](_0x144305*0x64)/0x64,'totalPaidOut':Math['round'](_0x2b6e92*0x64)/0x64,'pendingPayout':Math['round'](_0xa607d0*0x64)/0x64,'averageCheck':Math[_0x430293(0x16d)](_0xee0e89*0x64)/0x64,'totalPayments':_0x2d5c63,'successfulPayments':_0x204376,'conversionRate':_0x1b846b,'gatewayBreakdown':Object[_0x430293(0x20b)](_0x139d60)[_0x430293(0x17e)](_0x246e78=>({..._0x246e78,'turnoverUSDT':Math[_0x430293(0x16d)](_0x246e78[_0x430293(0x156)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x246e78[_0x430293(0x174)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x430293(0x16d)](_0x246e78[_0x430293(0x277)]*0x64)/0x64,'averageCommissionRate':Math[_0x430293(0x16d)](_0x246e78[_0x430293(0x23e)]*0x64)/0x64})),'merchantBreakdown':_0xc93cf2[_0x430293(0x1cf)]?undefined:Object[_0x430293(0x20b)](_0x5dbe51)['map'](_0x512819=>({..._0x512819,'turnoverUSDT':Math[_0x430293(0x16d)](_0x512819[_0x430293(0x156)]*0x64)/0x64,'commissionUSDT':Math[_0x430293(0x16d)](_0x512819['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x512819['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x430293(0x16d)](_0x512819['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x512819[_0x430293(0x18d)]*0x64)/0x64})),'dailyData':Object[_0x430293(0x20b)](_0x4d6481)[_0x430293(0x17e)](_0x39aee5=>({..._0x39aee5,'turnover':Math[_0x430293(0x16d)](_0x39aee5[_0x430293(0x173)]*0x64)/0x64,'merchantEarnings':Math[_0x430293(0x16d)](_0x39aee5['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x430293(0x16d)](_0x39aee5[_0x430293(0x193)]*0x64)/0x64}))[_0x430293(0x17d)]((_0x6e79ce,_0x57bfab)=>_0x6e79ce[_0x430293(0x24b)][_0x430293(0x19f)](_0x57bfab[_0x430293(0x24b)])),'periodInfo':{'from':_0x11b5a6,'to':_0x47a596,'periodType':_0xc93cf2[_0x430293(0x1a5)]||'custom','daysCount':_0x209125}};return console[_0x430293(0x1d5)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x430293(0x1d5)](_0x430293(0x1da)+_0x3c50be['totalTurnover']+'\x20USDT'),console[_0x430293(0x1d5)](_0x430293(0x237)+_0x3c50be[_0x430293(0x197)]+_0x430293(0x15c)),console[_0x430293(0x1d5)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x3c50be['gatewayEarnings']+'\x20USDT'),console[_0x430293(0x1d5)]('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x3c50be[_0x430293(0x260)]+_0x430293(0x15c)),console[_0x430293(0x1d5)](_0x430293(0x15e)+_0x3c50be[_0x430293(0x1fd)]+_0x430293(0x15c)),console['log'](_0x430293(0x253)+_0x3c50be[_0x430293(0x157)]),_0x3c50be;}async[a35_0x42240e(0x1a4)](){const _0x33d5d9=a35_0x42240e;console[_0x33d5d9(0x1d5)](_0x33d5d9(0x168));const _0x3f4475=await database_1['default']['shop'][_0x33d5d9(0x16c)]({'where':{'status':_0x33d5d9(0x235)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x33d5d9(0x1d5)](_0x33d5d9(0x1ed)+_0x3f4475[_0x33d5d9(0x23c)]+_0x33d5d9(0x24c)),_0x3f4475[_0x33d5d9(0x17e)](_0x1de96a=>({'id':_0x1de96a['id'],'username':_0x1de96a[_0x33d5d9(0x171)],'name':_0x1de96a['name']}));}[a35_0x42240e(0x248)](_0xfa3b2e){const _0x348877=a35_0x42240e,_0x31254e={'test_gateway':'Test\x20Gateway','plisio':_0x348877(0x187),'rapyd':_0x348877(0x258),'noda':_0x348877(0x1ab),'cointopay':_0x348877(0x1d4),'cointopay2':_0x348877(0x20f),'klyme_eu':_0x348877(0x1bd),'klyme_gb':_0x348877(0x1a9),'klyme_de':'KLYME\x20DE','mastercard':_0x348877(0x1f5)};return _0x31254e[_0xfa3b2e]||_0xfa3b2e;}[a35_0x42240e(0x26a)](_0x3773d7){const _0x17a19=a35_0x42240e,_0x11b0df={'Test\x20Gateway':_0x17a19(0x162),'Plisio':'plisio','Rapyd':'rapyd','Noda':_0x17a19(0x163),'CoinToPay':_0x17a19(0x257),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x17a19(0x1b1),'KLYME\x20GB':_0x17a19(0x233),'KLYME\x20DE':_0x17a19(0x152),'MasterCard':_0x17a19(0x267)};return _0x11b0df[_0x3773d7]||_0x3773d7[_0x17a19(0x161)]();}async[a35_0x42240e(0x14f)](_0x1923c7){const _0x23e9ee=a35_0x42240e,{page:_0x2d5651,limit:_0x44dfea,minAmount:_0x55b800,search:_0x1890a1}=_0x1923c7,_0x3b45af=(_0x2d5651-0x1)*_0x44dfea;console[_0x23e9ee(0x1d5)](_0x23e9ee(0x1ca),_0x1923c7);const _0x3f88b4={'balance':{'gt':0x0},'status':_0x23e9ee(0x235)};_0x55b800&&(_0x3f88b4['balance'][_0x23e9ee(0x20c)]=_0x55b800);_0x1890a1&&(_0x3f88b4['OR']=[{'name':{'contains':_0x1890a1,'mode':_0x23e9ee(0x26f)}},{'username':{'contains':_0x1890a1,'mode':'insensitive'}}]);const [_0x28de2d,_0x18c4b4]=await Promise[_0x23e9ee(0x1d0)]([database_1['default'][_0x23e9ee(0x230)][_0x23e9ee(0x16c)]({'where':_0x3f88b4,'skip':_0x3b45af,'take':_0x44dfea,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x23e9ee(0x21c)][_0x23e9ee(0x230)][_0x23e9ee(0x266)]({'where':_0x3f88b4})]);console[_0x23e9ee(0x1d5)](_0x23e9ee(0x188)+_0x28de2d['length']+_0x23e9ee(0x1a8));const _0x317604=await Promise['all'](_0x28de2d[_0x23e9ee(0x17e)](async _0x12775a=>{const _0xc3ffe1=_0x23e9ee,[_0xca7ba7,_0x52d9cb,_0x452439]=await Promise['all']([database_1[_0xc3ffe1(0x21c)][_0xc3ffe1(0x219)]['count']({'where':{'shopId':_0x12775a['id'],'status':_0xc3ffe1(0x1a7),'gateway':{'not':_0xc3ffe1(0x162)}}}),database_1[_0xc3ffe1(0x21c)]['payment'][_0xc3ffe1(0x23b)]({'where':{'shopId':_0x12775a['id'],'status':_0xc3ffe1(0x1a7),'gateway':{'not':_0xc3ffe1(0x162)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0xc3ffe1(0x26e)]({'by':[_0xc3ffe1(0x16b)],'where':{'shopId':_0x12775a['id'],'status':_0xc3ffe1(0x1a7),'gateway':{'not':_0xc3ffe1(0x162)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3624ec=new Date(),_0x506bbe=new Date(_0x3624ec[_0xc3ffe1(0x15b)](),_0x3624ec[_0xc3ffe1(0x242)](),0x1),_0x1fa30f=new Date(_0x3624ec[_0xc3ffe1(0x15b)](),_0x3624ec[_0xc3ffe1(0x242)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x186782,_0x342637]=await Promise[_0xc3ffe1(0x1d0)]([database_1[_0xc3ffe1(0x21c)][_0xc3ffe1(0x1cb)][_0xc3ffe1(0x1f9)]({'_sum':{'amount':!![]},'where':{'shopId':_0x12775a['id'],'status':_0xc3ffe1(0x254)}}),database_1[_0xc3ffe1(0x21c)]['payout'][_0xc3ffe1(0x1f9)]({'_sum':{'amount':!![]},'where':{'shopId':_0x12775a['id'],'status':'COMPLETED','createdAt':{'gte':_0x506bbe,'lte':_0x1fa30f}}})]),_0x441d63=_0x186782['_sum']['amount']||0x0,_0x284823=_0x342637['_sum'][_0xc3ffe1(0x1c5)]||0x0,_0x5d2603=await Promise[_0xc3ffe1(0x1d0)](_0x452439[_0xc3ffe1(0x17e)](async _0x2c25b5=>{const _0xff862a=_0xc3ffe1;let _0x3f9325=0xa;if(_0x12775a['gatewaySettings'])try{const _0x2d574e=JSON[_0xff862a(0x1d1)](_0x12775a[_0xff862a(0x14e)]);for(const [_0x28f1ce,_0xa63c9c]of Object[_0xff862a(0x24f)](_0x2d574e)){if(_0x28f1ce[_0xff862a(0x161)]()===_0x2c25b5[_0xff862a(0x16b)][_0xff862a(0x161)]()){_0x3f9325=_0xa63c9c[_0xff862a(0x256)]||0xa,console[_0xff862a(0x1d5)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x2c25b5['gateway']+'\x20for\x20shop\x20'+_0x12775a['id']+':\x20commission\x20=\x20'+_0x3f9325+'%');break;}}}catch(_0x5543cc){console[_0xff862a(0x1cc)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x12775a['id']+':',_0x5543cc);}const _0x216540=_0x2c25b5[_0xff862a(0x228)]?.[_0xff862a(0x22f)]||0x0,_0xbb1cdb=_0x216540*(0x1-_0x3f9325/0x64);return{'gateway':_0x2c25b5[_0xff862a(0x16b)],'count':_0x2c25b5[_0xff862a(0x18e)]?.['id']||0x0,'amountUSDT':Math[_0xff862a(0x16d)](_0x216540*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0xff862a(0x16d)](_0xbb1cdb*0x64)/0x64,'commission':_0x3f9325};})),_0x268ee9=_0x5d2603[_0xc3ffe1(0x25c)]((_0x48e22d,_0x4eb059)=>_0x48e22d+_0x4eb059[_0xc3ffe1(0x22f)],0x0),_0x121927=_0x12775a['balance'];return console[_0xc3ffe1(0x1d5)](_0xc3ffe1(0x224)+_0x12775a['username']+':'),console[_0xc3ffe1(0x1d5)]('\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20'+_0x268ee9['toFixed'](0x2)+_0xc3ffe1(0x1e8)),console['log'](_0xc3ffe1(0x1f1)+_0x5d2603['reduce']((_0x416094,_0x2986da)=>_0x416094+_0x2986da[_0xc3ffe1(0x255)],0x0)[_0xc3ffe1(0x26b)](0x2)+_0xc3ffe1(0x216)),console[_0xc3ffe1(0x1d5)](_0xc3ffe1(0x1df)+_0x121927[_0xc3ffe1(0x26b)](0x2)+_0xc3ffe1(0x27a)),{'id':_0x12775a['id'],'fullName':_0x12775a['name'],'username':_0x12775a[_0xc3ffe1(0x171)],'telegramId':_0x12775a[_0xc3ffe1(0x251)],'merchantUrl':_0x12775a['shopUrl'],'wallets':{'usdtPolygonWallet':_0x12775a['usdtPolygonWallet'],'usdtTrcWallet':_0x12775a[_0xc3ffe1(0x191)],'usdtErcWallet':_0x12775a[_0xc3ffe1(0x149)],'usdcPolygonWallet':_0x12775a['usdcPolygonWallet']},'totalAmountUSDT':Math[_0xc3ffe1(0x16d)](_0x268ee9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xc3ffe1(0x16d)](_0x121927*0x64)/0x64,'totalPayout':Math[_0xc3ffe1(0x16d)](_0x441d63*0x64)/0x64,'thisMonth':Math['round'](_0x284823*0x64)/0x64,'paymentsCount':_0xca7ba7,'oldestPaymentDate':_0x52d9cb?.[_0xc3ffe1(0x1fc)]||_0x12775a[_0xc3ffe1(0x1a2)],'gatewayBreakdown':_0x5d2603};})),_0x1784b3=_0x317604[_0x23e9ee(0x25c)]((_0x2e9ef1,_0x3549f4)=>_0x2e9ef1+_0x3549f4[_0x23e9ee(0x148)],0x0),_0x3e472d=_0x317604[_0x23e9ee(0x25c)]((_0x400574,_0x6eb6d6)=>_0x400574+_0x6eb6d6[_0x23e9ee(0x270)],0x0),_0x567440=_0x317604[_0x23e9ee(0x25c)]((_0x287155,_0x2f9652)=>_0x287155+_0x2f9652[_0x23e9ee(0x155)],0x0),_0x2dbb74=_0x317604['reduce']((_0xa8f25b,_0x345929)=>_0xa8f25b+_0x345929[_0x23e9ee(0x22b)],0x0);return console[_0x23e9ee(0x1d5)]('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x18c4b4+'\x20merchants'),console[_0x23e9ee(0x1d5)](_0x23e9ee(0x274)+Math['round'](_0x1784b3*0x64)/0x64+_0x23e9ee(0x1e8)),console['log']('\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x23e9ee(0x16d)](_0x3e472d*0x64)/0x64+_0x23e9ee(0x15a)),console[_0x23e9ee(0x1d5)](_0x23e9ee(0x198)+Math[_0x23e9ee(0x16d)](_0x567440*0x64)/0x64+_0x23e9ee(0x15c)),console[_0x23e9ee(0x1d5)]('\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20'+Math['round'](_0x2dbb74*0x64)/0x64+_0x23e9ee(0x15c)),{'merchants':_0x317604,'pagination':{'page':_0x2d5651,'limit':_0x44dfea,'total':_0x18c4b4,'totalPages':Math[_0x23e9ee(0x181)](_0x18c4b4/_0x44dfea)},'summary':{'totalMerchants':_0x18c4b4,'totalAmountUSDT':Math['round'](_0x1784b3*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x23e9ee(0x16d)](_0x3e472d*0x64)/0x64,'totalPayout':Math[_0x23e9ee(0x16d)](_0x567440*0x64)/0x64,'thisMonth':Math['round'](_0x2dbb74*0x64)/0x64}};}async[a35_0x42240e(0x1a6)](_0x1534a7){const _0x32d949=a35_0x42240e,{shopId:_0x130a39,amount:_0xdb2039,network:_0x9597bd,wallet:_0x380be5,notes:_0x21195a,txid:_0x44ce8d,periodFrom:_0x535dfb,periodTo:_0x1b43e8}=_0x1534a7,_0x112a47=await database_1[_0x32d949(0x21c)][_0x32d949(0x208)](async _0x284ab5=>{const _0x221b7f=_0x32d949,_0x37cf94=await _0x284ab5[_0x221b7f(0x230)]['findUnique']({'where':{'id':_0x130a39},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x37cf94)throw new Error(_0x221b7f(0x261));console['log'](_0x221b7f(0x265)+_0x37cf94[_0x221b7f(0x171)]+':'),console['log'](_0x221b7f(0x18c)+_0x37cf94['balance'][_0x221b7f(0x26b)](0x6)+'\x20USDT'),console[_0x221b7f(0x1d5)]('\x20\x20\x20Payout\x20amount:\x20'+_0xdb2039[_0x221b7f(0x26b)](0x6)+_0x221b7f(0x15c)),console[_0x221b7f(0x1d5)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x37cf94['totalPaidOut'][_0x221b7f(0x26b)](0x6)+_0x221b7f(0x15c));if(_0x44ce8d)console[_0x221b7f(0x1d5)](_0x221b7f(0x27c)+_0x44ce8d);if(_0x37cf94[_0x221b7f(0x1eb)]<_0xdb2039)throw new Error(_0x221b7f(0x205)+_0x37cf94[_0x221b7f(0x1eb)][_0x221b7f(0x26b)](0x6)+_0x221b7f(0x184)+_0xdb2039[_0x221b7f(0x26b)](0x6)+_0x221b7f(0x15c));let _0x79120c=_0x380be5;if(!_0x79120c){const _0x2ba442=await _0x284ab5[_0x221b7f(0x230)]['findUnique']({'where':{'id':_0x130a39},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x2ba442)switch(_0x9597bd){case _0x221b7f(0x25b):_0x79120c=_0x2ba442[_0x221b7f(0x19d)]||undefined;break;case _0x221b7f(0x1c4):_0x79120c=_0x2ba442[_0x221b7f(0x191)]||undefined;break;case'erc20':_0x79120c=_0x2ba442[_0x221b7f(0x149)]||undefined;break;case'polygon_usdc':_0x79120c=_0x2ba442['usdcPolygonWallet']||undefined;break;}}console['log'](_0x221b7f(0x14a)+_0x9597bd+':\x20'+(_0x79120c||_0x221b7f(0x165)));const _0x35b769=await _0x284ab5[_0x221b7f(0x1cb)][_0x221b7f(0x176)]({'data':{'shopId':_0x130a39,'amount':_0xdb2039,'network':_0x9597bd,'status':'COMPLETED','txid':_0x44ce8d,'notes':_0x21195a,'periodFrom':_0x535dfb?new Date(_0x535dfb):null,'periodTo':_0x1b43e8?new Date(_0x1b43e8):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3b6aed=_0x37cf94[_0x221b7f(0x1eb)]-_0xdb2039,_0x13c3bf=_0x37cf94[_0x221b7f(0x260)]+_0xdb2039;return await _0x284ab5['shop'][_0x221b7f(0x231)]({'where':{'id':_0x130a39},'data':{'balance':_0x3b6aed,'totalPaidOut':_0x13c3bf}}),console[_0x221b7f(0x1d5)](_0x221b7f(0x214)+_0x37cf94[_0x221b7f(0x171)]+_0x221b7f(0x207)),console['log'](_0x221b7f(0x1d8)+_0x37cf94[_0x221b7f(0x1eb)][_0x221b7f(0x26b)](0x6)+_0x221b7f(0x1f6)+_0x3b6aed['toFixed'](0x6)+_0x221b7f(0x1ff)+_0xdb2039['toFixed'](0x6)+')'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x37cf94[_0x221b7f(0x260)][_0x221b7f(0x26b)](0x6)+_0x221b7f(0x1f6)+_0x13c3bf[_0x221b7f(0x26b)](0x6)+_0x221b7f(0x167)+_0xdb2039[_0x221b7f(0x26b)](0x6)+')'),{'payout':_0x35b769,'shop':_0x37cf94};});return console[_0x32d949(0x1d5)](_0x32d949(0x15f)+_0x112a47['payout']['id']+'\x20for\x20shop\x20'+_0x112a47['shop'][_0x32d949(0x171)]+'\x20('+_0xdb2039+_0x32d949(0x178)),{'id':_0x112a47[_0x32d949(0x1cb)]['id'],'shopId':_0x112a47[_0x32d949(0x1cb)][_0x32d949(0x1cf)],'shopName':_0x112a47[_0x32d949(0x230)][_0x32d949(0x17f)],'shopUsername':_0x112a47[_0x32d949(0x230)]['username'],'amount':_0x112a47[_0x32d949(0x1cb)]['amount'],'network':_0x112a47[_0x32d949(0x1cb)][_0x32d949(0x21b)],'status':_0x112a47[_0x32d949(0x1cb)][_0x32d949(0x247)],'txid':_0x112a47[_0x32d949(0x1cb)]['txid'],'notes':_0x112a47[_0x32d949(0x1cb)]['notes'],'periodFrom':_0x112a47[_0x32d949(0x1cb)][_0x32d949(0x1a3)],'periodTo':_0x112a47[_0x32d949(0x1cb)][_0x32d949(0x275)],'createdAt':_0x112a47[_0x32d949(0x1cb)]['createdAt'],'paidAt':_0x112a47[_0x32d949(0x1cb)][_0x32d949(0x1fc)]};}async[a35_0x42240e(0x22d)](_0x7e2169){const _0x513956=a35_0x42240e,{page:_0x1d5c6b,limit:_0x18f036,shopId:_0x5dc71f,network:_0x224d80,dateFrom:_0x5cdd8b,dateTo:_0x13b350,search:_0xef29e5}=_0x7e2169,_0x2ff06c=(_0x1d5c6b-0x1)*_0x18f036,_0xde4018={};_0x5dc71f&&(_0xde4018[_0x513956(0x1cf)]=_0x5dc71f);_0x224d80&&(_0xde4018['network']=_0x224d80);(_0x5cdd8b||_0x13b350)&&(_0xde4018[_0x513956(0x1a2)]={},_0x5cdd8b&&(_0xde4018[_0x513956(0x1a2)][_0x513956(0x20c)]=new Date(_0x5cdd8b)),_0x13b350&&(_0xde4018['createdAt']['lte']=new Date(_0x13b350)));_0xef29e5&&(_0xde4018['OR']=[{'shop':{'name':{'contains':_0xef29e5,'mode':_0x513956(0x26f)}}},{'shop':{'username':{'contains':_0xef29e5,'mode':_0x513956(0x26f)}}},{'notes':{'contains':_0xef29e5,'mode':_0x513956(0x26f)}}]);const [_0x15d0a2,_0x153a12]=await Promise[_0x513956(0x1d0)]([database_1[_0x513956(0x21c)][_0x513956(0x1cb)][_0x513956(0x16c)]({'where':_0xde4018,'skip':_0x2ff06c,'take':_0x18f036,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x513956(0x21c)][_0x513956(0x1cb)][_0x513956(0x266)]({'where':_0xde4018})]);return{'payouts':_0x15d0a2['map'](_0x50ea74=>({'id':_0x50ea74['id'],'shopId':_0x50ea74['shopId'],'shopName':_0x50ea74[_0x513956(0x230)][_0x513956(0x17f)],'shopUsername':_0x50ea74['shop'][_0x513956(0x171)],'amount':_0x50ea74[_0x513956(0x1c5)],'network':_0x50ea74[_0x513956(0x21b)],'status':_0x50ea74[_0x513956(0x247)],'txid':_0x50ea74['txid'],'notes':_0x50ea74[_0x513956(0x16f)],'periodFrom':_0x50ea74[_0x513956(0x1a3)],'periodTo':_0x50ea74[_0x513956(0x275)],'createdAt':_0x50ea74[_0x513956(0x1a2)],'paidAt':_0x50ea74[_0x513956(0x1fc)]})),'pagination':{'page':_0x1d5c6b,'limit':_0x18f036,'total':_0x153a12,'totalPages':Math[_0x513956(0x181)](_0x153a12/_0x18f036)}};}async[a35_0x42240e(0x199)](_0x5e0da0){const _0x524865=a35_0x42240e,_0x419bad=await database_1[_0x524865(0x21c)]['payout'][_0x524865(0x1e7)]({'where':{'id':_0x5e0da0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x419bad)return null;return{'id':_0x419bad['id'],'shopId':_0x419bad[_0x524865(0x1cf)],'shopName':_0x419bad[_0x524865(0x230)]['name'],'shopUsername':_0x419bad[_0x524865(0x230)][_0x524865(0x171)],'amount':_0x419bad['amount'],'network':_0x419bad[_0x524865(0x21b)],'status':_0x419bad[_0x524865(0x247)],'txid':_0x419bad[_0x524865(0x24a)],'notes':_0x419bad[_0x524865(0x16f)],'periodFrom':_0x419bad[_0x524865(0x1a3)],'periodTo':_0x419bad['periodTo'],'createdAt':_0x419bad[_0x524865(0x1a2)],'paidAt':_0x419bad[_0x524865(0x1fc)]};}async[a35_0x42240e(0x19a)](_0x5c00aa){const _0x55d821=a35_0x42240e;await database_1[_0x55d821(0x21c)]['payout'][_0x55d821(0x217)]({'where':{'id':_0x5c00aa}});}async[a35_0x42240e(0x1f0)](_0x2d336a){const _0x119967=a35_0x42240e,{page:_0x1f7c64,limit:_0x59e97c,status:_0x3ef518,gateway:_0xefcaec,shopId:_0x55286c,dateFrom:_0x315d10,dateTo:_0x3301f2,search:_0x40a512,currency:_0x5f08a3,sortBy:_0x43f629,sortOrder:_0x306f72}=_0x2d336a,_0x684a90=(_0x1f7c64-0x1)*_0x59e97c;console[_0x119967(0x1d5)](_0x119967(0x203),_0x2d336a);const _0x4e3639=await database_1[_0x119967(0x21c)][_0x119967(0x219)]['groupBy']({'by':[_0x119967(0x16b)],'_count':{'gateway':!![]}});console[_0x119967(0x1d5)](_0x119967(0x1f2),_0x4e3639[_0x119967(0x17e)](_0x2182d4=>_0x2182d4[_0x119967(0x16b)]+'\x20('+_0x2182d4[_0x119967(0x18e)]['gateway']+'\x20payments)'));if(_0xefcaec){const _0x239c46=_0x4e3639['some'](_0x279230=>_0x279230[_0x119967(0x16b)][_0x119967(0x161)]()===_0xefcaec[_0x119967(0x161)]());!_0x239c46&&_0xefcaec[_0x119967(0x161)]()!==_0x119967(0x162)&&console[_0x119967(0x1d5)](_0x119967(0x27b)+_0xefcaec+_0x119967(0x220)+_0x4e3639['map'](_0x5273bb=>_0x5273bb[_0x119967(0x16b)])[_0x119967(0x1b0)](',\x20'));}const _0x1f1d98={};_0x3ef518&&(_0x1f1d98[_0x119967(0x247)]=_0x3ef518[_0x119967(0x1b6)]());if(!_0xefcaec)_0x1f1d98[_0x119967(0x16b)]={'not':_0x119967(0x162)};else{if(_0xefcaec&&(_0xefcaec[_0x119967(0x161)]()===_0x119967(0x162)||_0xefcaec===_0x119967(0x23a)))_0x1f1d98['gateway']=_0x119967(0x162);else{let _0x257858=_0xefcaec;const _0x22c413=(0x0,gateway_1[_0x119967(0x192)])(_0xefcaec);if(_0x22c413)_0x257858=_0x22c413,console[_0x119967(0x1d5)](_0x119967(0x25e)+_0xefcaec+_0x119967(0x245)+_0x257858+'\x27');else{const _0x90c3a7=(0x0,gateway_1[_0x119967(0x1e4)])(_0xefcaec);if(_0x90c3a7){const _0x29312b=(0x0,gateway_1[_0x119967(0x192)])(_0x90c3a7);_0x29312b&&(_0x257858=_0x29312b,console[_0x119967(0x1d5)](_0x119967(0x25a)+_0xefcaec+_0x119967(0x194)+_0x90c3a7+_0x119967(0x236)+_0x257858+'\x27'));}else console[_0x119967(0x1d5)](_0x119967(0x234)+_0xefcaec+_0x119967(0x166));}const _0x18c5e8=await database_1[_0x119967(0x21c)]['payment'][_0x119967(0x266)]({'where':{'gateway':_0x257858[_0x119967(0x161)]()},'take':0x1});_0x18c5e8===0x0?(console[_0x119967(0x1d5)](_0x119967(0x25d)+_0x257858+_0x119967(0x20d)+_0xefcaec+_0x119967(0x1ae)),_0x1f1d98[_0x119967(0x16b)]='NONEXISTENT_GATEWAY_FILTER'):(_0x1f1d98[_0x119967(0x16b)]=_0x257858[_0x119967(0x161)](),console['log'](_0x119967(0x249)+_0x257858+_0x119967(0x20d)+_0xefcaec+'\x27)'));}}console['log']('üìä\x20Gateway\x20filter\x20applied:',_0x1f1d98[_0x119967(0x16b)]);_0x55286c&&(_0x1f1d98[_0x119967(0x1cf)]=_0x55286c);_0x5f08a3&&(_0x1f1d98[_0x119967(0x272)]=_0x5f08a3[_0x119967(0x1b6)](),console[_0x119967(0x1d5)](_0x119967(0x21f)+_0x5f08a3[_0x119967(0x1b6)]()));(_0x315d10||_0x3301f2)&&(_0x1f1d98['createdAt']={},_0x315d10&&(_0x1f1d98['createdAt']['gte']=new Date(_0x315d10)),_0x3301f2&&(_0x1f1d98[_0x119967(0x1a2)]['lte']=new Date(_0x3301f2)));_0x40a512&&(_0x1f1d98['OR']=[{'id':{'contains':_0x40a512,'mode':_0x119967(0x26f)}},{'orderId':{'contains':_0x40a512,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x40a512,'mode':'insensitive'}},{'customerEmail':{'contains':_0x40a512,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x40a512,'mode':_0x119967(0x26f)}}},{'shop':{'username':{'contains':_0x40a512,'mode':_0x119967(0x26f)}}}]);console[_0x119967(0x1d5)](_0x119967(0x14d),JSON['stringify'](_0x1f1d98,null,0x2));let _0x40c496={'createdAt':'desc'};if(_0x43f629){const _0xeea35a=[_0x119967(0x1c5),_0x119967(0x1a2),'updatedAt',_0x119967(0x247),_0x119967(0x16b),_0x119967(0x272)],_0x5916a9=[_0x119967(0x1d6),_0x119967(0x1d9)];if(_0xeea35a[_0x119967(0x1d3)](_0x43f629)){const _0x47a902=_0x5916a9['includes'](_0x306f72)?_0x306f72:_0x119967(0x1d9);_0x40c496={[_0x43f629]:_0x47a902},console[_0x119967(0x1d5)]('üìä\x20Sorting\x20payments\x20by\x20'+_0x43f629+'\x20in\x20'+_0x47a902+_0x119967(0x1e3));}}const [_0x38f113,_0x4c86bb]=await Promise[_0x119967(0x1d0)]([database_1['default'][_0x119967(0x219)][_0x119967(0x16c)]({'where':_0x1f1d98,'skip':_0x684a90,'take':_0x59e97c,'orderBy':_0x40c496,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x119967(0x266)]({'where':_0x1f1d98})]);return{'payments':_0x38f113,'pagination':{'page':_0x1f7c64,'limit':_0x59e97c,'total':_0x4c86bb,'totalPages':Math[_0x119967(0x181)](_0x4c86bb/_0x59e97c)}};}async[a35_0x42240e(0x1e1)](_0x250ae6){const _0xbd0f8b=a35_0x42240e,_0x11adf7=await database_1[_0xbd0f8b(0x21c)][_0xbd0f8b(0x219)][_0xbd0f8b(0x1e7)]({'where':{'id':_0x250ae6},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x11adf7)return null;return{'id':_0x11adf7['id'],'shopId':_0x11adf7['shopId'],'gateway':_0x11adf7['gateway'],'amount':_0x11adf7[_0xbd0f8b(0x1c5)],'currency':_0x11adf7[_0xbd0f8b(0x272)],'status':_0x11adf7[_0xbd0f8b(0x247)],'orderId':_0x11adf7[_0xbd0f8b(0x1ec)],'gatewayOrderId':_0x11adf7[_0xbd0f8b(0x1e6)],'customerEmail':_0x11adf7[_0xbd0f8b(0x221)],'customerName':_0x11adf7[_0xbd0f8b(0x1c1)],'customerCountry':_0x11adf7[_0xbd0f8b(0x23f)],'customerIp':_0x11adf7['customerIp'],'customerUa':_0x11adf7[_0xbd0f8b(0x1f8)],'failureMessage':_0x11adf7[_0xbd0f8b(0x1c2)],'externalPaymentUrl':_0x11adf7['externalPaymentUrl'],'successUrl':_0x11adf7[_0xbd0f8b(0x1c3)],'failUrl':_0x11adf7[_0xbd0f8b(0x16a)],'pendingUrl':_0x11adf7['pendingUrl'],'whiteUrl':_0x11adf7[_0xbd0f8b(0x239)],'createdAt':_0x11adf7[_0xbd0f8b(0x1a2)],'updatedAt':_0x11adf7[_0xbd0f8b(0x145)],'shop':_0x11adf7['shop']};}async[a35_0x42240e(0x273)](_0xf3f190,_0x453949,_0x4720af,_0x596249){const _0x258395=a35_0x42240e,_0x23bd5e=await database_1[_0x258395(0x21c)]['$transaction'](async _0x19b6c8=>{const _0x2aeccb=_0x258395,_0x5b2ea9=await _0x19b6c8[_0x2aeccb(0x219)][_0x2aeccb(0x1e7)]({'where':{'id':_0xf3f190},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5b2ea9)throw new Error('Payment\x20not\x20found');const _0x3737d8=_0x5b2ea9[_0x2aeccb(0x247)],_0x49078b=_0x453949['toUpperCase']();console['log'](_0x2aeccb(0x1cd)+_0xf3f190+_0x2aeccb(0x1b3)+_0x3737d8+_0x2aeccb(0x1f6)+_0x49078b),console[_0x2aeccb(0x1d5)](_0x2aeccb(0x1ba)+_0x5b2ea9[_0x2aeccb(0x230)][_0x2aeccb(0x1eb)]+'\x20USDT');const _0x332366={'status':_0x49078b,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x4720af&&(_0x332366[_0x2aeccb(0x1d7)]=_0x4720af);_0x49078b==='CHARGEBACK'&&_0x596249&&(_0x332366['chargebackAmount']=_0x596249);let _0x1a8362=0x0,_0x6cab01=_0x5b2ea9[_0x2aeccb(0x230)]['balance'];if(_0x49078b===_0x2aeccb(0x1a7)&&_0x3737d8!==_0x2aeccb(0x1a7)){_0x332366[_0x2aeccb(0x1fc)]=new Date();const _0x434e4e=await currencyService_1['currencyService']['convertToUSDT'](_0x5b2ea9[_0x2aeccb(0x1c5)],_0x5b2ea9['currency']);_0x332366[_0x2aeccb(0x22f)]=_0x434e4e;let _0x426ffe=0xa;const _0x148c8a=await _0x19b6c8['shop'][_0x2aeccb(0x1e7)]({'where':{'id':_0x5b2ea9[_0x2aeccb(0x1cf)]},'select':{'gatewaySettings':!![]}});if(_0x148c8a?.[_0x2aeccb(0x14e)])try{const _0x340359=JSON[_0x2aeccb(0x1d1)](_0x148c8a[_0x2aeccb(0x14e)]);for(const [_0x453b7d,_0x58e47d]of Object['entries'](_0x340359)){if(_0x453b7d['toLowerCase']()===_0x5b2ea9[_0x2aeccb(0x16b)]['toLowerCase']()){_0x426ffe=_0x58e47d[_0x2aeccb(0x256)]||0xa;break;}}}catch(_0x154334){console[_0x2aeccb(0x1cc)](_0x2aeccb(0x18b)+_0xf3f190+':',_0x154334);}let _0x38a998;_0x5b2ea9['amountAfterGatewayCommissionUSDT']!==null&&_0x5b2ea9['amountAfterGatewayCommissionUSDT']!==undefined?(_0x38a998=_0x5b2ea9[_0x2aeccb(0x200)],console[_0x2aeccb(0x1d5)]('üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x38a998['toFixed'](0x6)+'\x20USDT\x20for\x20payment\x20'+_0xf3f190)):(_0x38a998=_0x434e4e*(0x1-_0x426ffe/0x64),console[_0x2aeccb(0x1d5)]('üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0xf3f190+':\x20'+_0x426ffe+'%\x20from\x20'+_0x434e4e[_0x2aeccb(0x26b)](0x6)+_0x2aeccb(0x15c)),_0x332366['amountAfterGatewayCommissionUSDT']=_0x38a998),_0x1a8362=_0x38a998,_0x6cab01+=_0x38a998,console[_0x2aeccb(0x1d5)](_0x2aeccb(0x1b7)+_0xf3f190+'\x20became\x20PAID:'),console['log'](_0x2aeccb(0x229)+_0x434e4e[_0x2aeccb(0x26b)](0x6)+_0x2aeccb(0x15c)),console['log'](_0x2aeccb(0x1aa)+_0x5b2ea9['gateway']+_0x2aeccb(0x26d)+_0x426ffe+'%'),console[_0x2aeccb(0x1d5)](_0x2aeccb(0x218)+_0x38a998[_0x2aeccb(0x26b)](0x6)+'\x20USDT\x20(after\x20'+_0x426ffe+'%\x20commission)'),console[_0x2aeccb(0x1d5)](_0x2aeccb(0x238)+_0x38a998['toFixed'](0x6)+'\x20USDT');}else{if(_0x3737d8==='PAID'&&_0x49078b!=='PAID'){if(_0x5b2ea9[_0x2aeccb(0x22f)]){let _0x330baf=0xa;const _0x5cdabe=await _0x19b6c8[_0x2aeccb(0x230)][_0x2aeccb(0x1e7)]({'where':{'id':_0x5b2ea9[_0x2aeccb(0x1cf)]},'select':{'gatewaySettings':!![]}});if(_0x5cdabe?.['gatewaySettings'])try{const _0x1524e4=JSON['parse'](_0x5cdabe['gatewaySettings']);for(const [_0x12acf4,_0xf77e7e]of Object[_0x2aeccb(0x24f)](_0x1524e4)){if(_0x12acf4[_0x2aeccb(0x161)]()===_0x5b2ea9[_0x2aeccb(0x16b)]['toLowerCase']()){_0x330baf=_0xf77e7e['commission']||0xa;break;}}}catch(_0xadb179){console[_0x2aeccb(0x1cc)](_0x2aeccb(0x18b)+_0xf3f190+':',_0xadb179);}const _0x346ddd=_0x5b2ea9[_0x2aeccb(0x22f)]*(0x1-_0x330baf/0x64);_0x1a8362=-_0x346ddd,_0x6cab01-=_0x346ddd,_0x332366[_0x2aeccb(0x22f)]=null,_0x332366[_0x2aeccb(0x200)]=null,console['log'](_0x2aeccb(0x1b7)+_0xf3f190+_0x2aeccb(0x26c)),console[_0x2aeccb(0x1d5)]('\x20\x20\x20Full\x20amount:\x20'+_0x5b2ea9[_0x2aeccb(0x22f)][_0x2aeccb(0x26b)](0x6)+_0x2aeccb(0x15c)),console[_0x2aeccb(0x1d5)](_0x2aeccb(0x1aa)+_0x5b2ea9['gateway']+_0x2aeccb(0x26d)+_0x330baf+'%'),console[_0x2aeccb(0x1d5)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x346ddd[_0x2aeccb(0x26b)](0x6)+'\x20USDT\x20(after\x20'+_0x330baf+_0x2aeccb(0x1fa)),console[_0x2aeccb(0x1d5)](_0x2aeccb(0x185)+_0x346ddd['toFixed'](0x6)+_0x2aeccb(0x15c));}}}_0x49078b===_0x2aeccb(0x1b5)&&(_0x3737d8===_0x2aeccb(0x1a7)&&_0x5b2ea9[_0x2aeccb(0x22f)]&&console[_0x2aeccb(0x1d5)](_0x2aeccb(0x24e)),_0x596249&&_0x596249>0x0&&(_0x1a8362-=_0x596249,_0x6cab01-=_0x596249,console['log'](_0x2aeccb(0x1c9)+_0x596249[_0x2aeccb(0x26b)](0x6)+'\x20USDT\x20from\x20balance')));_0x49078b===_0x2aeccb(0x222)&&_0x3737d8===_0x2aeccb(0x1a7)&&console[_0x2aeccb(0x1d5)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x53855f=await _0x19b6c8['payment']['update']({'where':{'id':_0xf3f190},'data':_0x332366,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1a8362!==0x0&&(await _0x19b6c8[_0x2aeccb(0x230)][_0x2aeccb(0x231)]({'where':{'id':_0x5b2ea9[_0x2aeccb(0x1cf)]},'data':{'balance':_0x6cab01}}),console[_0x2aeccb(0x1d5)]('üí∞\x20Shop\x20'+_0x5b2ea9['shopId']+_0x2aeccb(0x276)+_0x5b2ea9[_0x2aeccb(0x230)][_0x2aeccb(0x1eb)][_0x2aeccb(0x26b)](0x6)+'\x20->\x20'+_0x6cab01['toFixed'](0x6)+_0x2aeccb(0x182)+(_0x1a8362>0x0?'+':'')+_0x1a8362[_0x2aeccb(0x26b)](0x6)+')')),_0x53855f;});return{'id':_0x23bd5e['id'],'shopId':_0x23bd5e[_0x258395(0x1cf)],'gateway':_0x23bd5e[_0x258395(0x16b)],'amount':_0x23bd5e['amount'],'currency':_0x23bd5e['currency'],'status':_0x23bd5e['status'],'orderId':_0x23bd5e[_0x258395(0x1ec)],'gatewayOrderId':_0x23bd5e[_0x258395(0x1e6)],'customerEmail':_0x23bd5e[_0x258395(0x221)],'customerName':_0x23bd5e['customerName'],'customerCountry':_0x23bd5e[_0x258395(0x23f)],'customerIp':_0x23bd5e[_0x258395(0x206)],'customerUa':_0x23bd5e[_0x258395(0x1f8)],'failureMessage':_0x23bd5e['failureMessage'],'adminNotes':_0x23bd5e['adminNotes'],'chargebackAmount':_0x23bd5e[_0x258395(0x27e)],'statusChangedBy':_0x23bd5e[_0x258395(0x1de)],'statusChangedAt':_0x23bd5e['statusChangedAt'],'createdAt':_0x23bd5e[_0x258395(0x1a2)],'updatedAt':_0x23bd5e[_0x258395(0x145)],'shop':_0x23bd5e[_0x258395(0x230)]};}async[a35_0x42240e(0x27d)](_0x3f0ca1,_0xb8910c){const _0x5a1a52=a35_0x42240e,_0x342132=Math[_0x5a1a52(0x1fb)]()['toString'](0x24)[_0x5a1a52(0x19e)](0x2,0x9);console[_0x5a1a52(0x1d5)](_0x5a1a52(0x158)+_0x342132+',\x20userId:\x20'+_0x3f0ca1);const _0x1e3d80={..._0xb8910c};_0xb8910c[_0x5a1a52(0x154)]&&_0xb8910c['password'][_0x5a1a52(0x212)]()!==''?(console[_0x5a1a52(0x1d5)](_0x5a1a52(0x1c7)+_0x342132+_0x5a1a52(0x259)+_0x3f0ca1),_0x1e3d80[_0x5a1a52(0x154)]=await bcryptjs_1[_0x5a1a52(0x21c)][_0x5a1a52(0x1bb)](_0xb8910c[_0x5a1a52(0x154)],0xc)):(console[_0x5a1a52(0x1d5)](_0x5a1a52(0x1c7)+_0x342132+_0x5a1a52(0x19c)),delete _0x1e3d80[_0x5a1a52(0x154)]);_0xb8910c[_0x5a1a52(0x1f7)]&&(_0x1e3d80[_0x5a1a52(0x17f)]=_0xb8910c[_0x5a1a52(0x1f7)],delete _0x1e3d80['fullName']);_0xb8910c[_0x5a1a52(0x17c)]&&(_0x1e3d80['telegram']=_0xb8910c[_0x5a1a52(0x17c)],delete _0x1e3d80[_0x5a1a52(0x17c)]);_0xb8910c[_0x5a1a52(0x180)]&&(_0x1e3d80[_0x5a1a52(0x204)]=_0xb8910c[_0x5a1a52(0x180)],delete _0x1e3d80['merchantUrl']);if(_0xb8910c[_0x5a1a52(0x27f)]){const _0x206b28=_0xb8910c[_0x5a1a52(0x27f)][_0x5a1a52(0x17e)](_0x208c7f=>this[_0x5a1a52(0x26a)](_0x208c7f));console[_0x5a1a52(0x1d5)](_0x5a1a52(0x1d2),_0xb8910c[_0x5a1a52(0x27f)],'->',_0x206b28),_0x1e3d80[_0x5a1a52(0x213)]=JSON[_0x5a1a52(0x201)](_0x206b28),delete _0x1e3d80[_0x5a1a52(0x27f)];}_0xb8910c[_0x5a1a52(0x14e)]&&(console[_0x5a1a52(0x1d5)](_0x5a1a52(0x196)+_0x342132+_0x5a1a52(0x1c0),_0xb8910c[_0x5a1a52(0x14e)]),_0x1e3d80[_0x5a1a52(0x14e)]=JSON[_0x5a1a52(0x201)](_0xb8910c[_0x5a1a52(0x14e)]),console[_0x5a1a52(0x1d5)]('üîß\x20['+_0x342132+']\x20Gateway\x20settings\x20JSON\x20string:',_0x1e3d80[_0x5a1a52(0x14e)]));_0xb8910c[_0x5a1a52(0x246)]&&(_0xb8910c[_0x5a1a52(0x246)]['usdtPolygonWallet']!==undefined&&(_0x1e3d80[_0x5a1a52(0x19d)]=_0xb8910c[_0x5a1a52(0x246)][_0x5a1a52(0x19d)]||null),_0xb8910c[_0x5a1a52(0x246)][_0x5a1a52(0x191)]!==undefined&&(_0x1e3d80[_0x5a1a52(0x191)]=_0xb8910c[_0x5a1a52(0x246)][_0x5a1a52(0x191)]||null),_0xb8910c['wallets'][_0x5a1a52(0x149)]!==undefined&&(_0x1e3d80[_0x5a1a52(0x149)]=_0xb8910c['wallets']['usdtErcWallet']||null),_0xb8910c[_0x5a1a52(0x246)]['usdcPolygonWallet']!==undefined&&(_0x1e3d80[_0x5a1a52(0x1c8)]=_0xb8910c[_0x5a1a52(0x246)]['usdcPolygonWallet']||null),delete _0x1e3d80['wallets']);const _0x5b7231=await database_1['default'][_0x5a1a52(0x230)][_0x5a1a52(0x231)]({'where':{'id':_0x3f0ca1},'data':_0x1e3d80,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x5a1a52(0x264)+_0x342132+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x5b7231[_0x5a1a52(0x14e)]),{'id':_0x5b7231['id'],'fullName':_0x5b7231[_0x5a1a52(0x17f)],'username':_0x5b7231[_0x5a1a52(0x171)],'telegramId':_0x5b7231[_0x5a1a52(0x251)],'merchantUrl':_0x5b7231[_0x5a1a52(0x204)],'gateways':_0x5b7231['paymentGateways']?JSON[_0x5a1a52(0x1d1)](_0x5b7231['paymentGateways']):null,'gatewaySettings':_0x5b7231[_0x5a1a52(0x14e)]?JSON[_0x5a1a52(0x1d1)](_0x5b7231[_0x5a1a52(0x14e)]):null,'publicKey':_0x5b7231[_0x5a1a52(0x1ad)],'wallets':{'usdtPolygonWallet':_0x5b7231[_0x5a1a52(0x19d)],'usdtTrcWallet':_0x5b7231['usdtTrcWallet'],'usdtErcWallet':_0x5b7231['usdtErcWallet'],'usdcPolygonWallet':_0x5b7231[_0x5a1a52(0x1c8)]},'status':_0x5b7231[_0x5a1a52(0x247)],'createdAt':_0x5b7231[_0x5a1a52(0x1a2)]};}async[a35_0x42240e(0x1a1)](_0x2bff38){const _0xc51247=a35_0x42240e,_0x559a19=await database_1[_0xc51247(0x21c)][_0xc51247(0x230)][_0xc51247(0x231)]({'where':{'id':_0x2bff38},'data':{'status':_0xc51247(0x22a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x559a19['id'],'fullName':_0x559a19['name'],'username':_0x559a19[_0xc51247(0x171)],'telegramId':_0x559a19[_0xc51247(0x251)],'merchantUrl':_0x559a19[_0xc51247(0x204)],'gateways':_0x559a19[_0xc51247(0x213)]?JSON['parse'](_0x559a19['paymentGateways']):null,'gatewaySettings':_0x559a19[_0xc51247(0x14e)]?JSON[_0xc51247(0x1d1)](_0x559a19[_0xc51247(0x14e)]):null,'publicKey':_0x559a19[_0xc51247(0x1ad)],'wallets':{'usdtPolygonWallet':_0x559a19[_0xc51247(0x19d)],'usdtTrcWallet':_0x559a19[_0xc51247(0x191)],'usdtErcWallet':_0x559a19['usdtErcWallet'],'usdcPolygonWallet':_0x559a19[_0xc51247(0x1c8)]},'status':_0x559a19[_0xc51247(0x247)],'createdAt':_0x559a19[_0xc51247(0x1a2)]};}async[a35_0x42240e(0x1ef)](_0x40c2c9){const _0x4250b9=a35_0x42240e,_0x14c122=await database_1[_0x4250b9(0x21c)][_0x4250b9(0x230)][_0x4250b9(0x231)]({'where':{'id':_0x40c2c9},'data':{'status':_0x4250b9(0x235)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x14c122['id'],'fullName':_0x14c122[_0x4250b9(0x17f)],'username':_0x14c122[_0x4250b9(0x171)],'telegramId':_0x14c122['telegram'],'merchantUrl':_0x14c122[_0x4250b9(0x204)],'gateways':_0x14c122[_0x4250b9(0x213)]?JSON[_0x4250b9(0x1d1)](_0x14c122[_0x4250b9(0x213)]):null,'gatewaySettings':_0x14c122[_0x4250b9(0x14e)]?JSON[_0x4250b9(0x1d1)](_0x14c122[_0x4250b9(0x14e)]):null,'publicKey':_0x14c122[_0x4250b9(0x1ad)],'wallets':{'usdtPolygonWallet':_0x14c122[_0x4250b9(0x19d)],'usdtTrcWallet':_0x14c122[_0x4250b9(0x191)],'usdtErcWallet':_0x14c122[_0x4250b9(0x149)],'usdcPolygonWallet':_0x14c122[_0x4250b9(0x1c8)]},'status':_0x14c122[_0x4250b9(0x247)],'createdAt':_0x14c122[_0x4250b9(0x1a2)]};}async[a35_0x42240e(0x24d)](_0x1df108){const _0x26de12=a35_0x42240e,{page:_0x46f968,limit:_0x130481,status:_0x526d22}=_0x1df108,_0x473729=(_0x46f968-0x1)*_0x130481,_0x5e7d04={};_0x526d22&&(_0x5e7d04['status']=_0x526d22[_0x26de12(0x1b6)]());const [_0x3997ff,_0x4cc9aa]=await Promise[_0x26de12(0x1d0)]([database_1[_0x26de12(0x21c)][_0x26de12(0x230)][_0x26de12(0x16c)]({'where':_0x5e7d04,'skip':_0x473729,'take':_0x130481,'orderBy':{'createdAt':_0x26de12(0x1d9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x26de12(0x21c)][_0x26de12(0x230)][_0x26de12(0x266)]({'where':_0x5e7d04})]);return{'users':_0x3997ff[_0x26de12(0x17e)](_0x280f37=>{const _0x2f110f=_0x26de12,_0x438df2=_0x280f37[_0x2f110f(0x213)]?JSON[_0x2f110f(0x1d1)](_0x280f37['paymentGateways']):null,_0x4e0961=_0x438df2?_0x438df2[_0x2f110f(0x17e)](_0x38b235=>this[_0x2f110f(0x248)](_0x38b235)):null;return{'id':_0x280f37['id'],'fullName':_0x280f37['name'],'username':_0x280f37[_0x2f110f(0x171)],'telegramId':_0x280f37[_0x2f110f(0x251)],'merchantUrl':_0x280f37[_0x2f110f(0x204)],'gateways':_0x4e0961,'gatewaySettings':_0x280f37[_0x2f110f(0x14e)]?JSON[_0x2f110f(0x1d1)](_0x280f37['gatewaySettings']):null,'publicKey':_0x280f37['publicKey'],'wallets':{'usdtPolygonWallet':_0x280f37['usdtPolygonWallet'],'usdtTrcWallet':_0x280f37[_0x2f110f(0x191)],'usdtErcWallet':_0x280f37[_0x2f110f(0x149)],'usdcPolygonWallet':_0x280f37[_0x2f110f(0x1c8)]},'status':_0x280f37['status'],'createdAt':_0x280f37[_0x2f110f(0x1a2)]};}),'pagination':{'page':_0x46f968,'limit':_0x130481,'total':_0x4cc9aa,'totalPages':Math[_0x26de12(0x181)](_0x4cc9aa/_0x130481)}};}async[a35_0x42240e(0x1b2)](_0x292ea8){const _0x81ace=a35_0x42240e,_0x2b39e3=await database_1['default'][_0x81ace(0x230)][_0x81ace(0x1e7)]({'where':{'id':_0x292ea8},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2b39e3)return null;const _0x5e4bc2=_0x2b39e3[_0x81ace(0x213)]?JSON[_0x81ace(0x1d1)](_0x2b39e3[_0x81ace(0x213)]):null,_0x5adac8=_0x5e4bc2?_0x5e4bc2[_0x81ace(0x17e)](_0x109fc1=>this['getGatewayDisplayName'](_0x109fc1)):null;return _0x5e4bc2&&_0x5adac8&&console[_0x81ace(0x1d5)](_0x81ace(0x1e9),_0x5e4bc2,'->',_0x5adac8),{'id':_0x2b39e3['id'],'fullName':_0x2b39e3[_0x81ace(0x17f)],'username':_0x2b39e3[_0x81ace(0x171)],'telegramId':_0x2b39e3[_0x81ace(0x251)],'merchantUrl':_0x2b39e3[_0x81ace(0x204)],'gateways':_0x5adac8,'gatewaySettings':_0x2b39e3[_0x81ace(0x14e)]?JSON[_0x81ace(0x1d1)](_0x2b39e3['gatewaySettings']):null,'publicKey':_0x2b39e3[_0x81ace(0x1ad)],'wallets':{'usdtPolygonWallet':_0x2b39e3[_0x81ace(0x19d)],'usdtTrcWallet':_0x2b39e3['usdtTrcWallet'],'usdtErcWallet':_0x2b39e3['usdtErcWallet'],'usdcPolygonWallet':_0x2b39e3[_0x81ace(0x1c8)]},'status':_0x2b39e3[_0x81ace(0x247)],'createdAt':_0x2b39e3[_0x81ace(0x1a2)]};}async['createUser'](_0x14eaaf){const _0x8b24bc=a35_0x42240e,{fullName:_0x3ccc7a,username:_0x22bb26,password:_0x1f0b8f,telegramId:_0x14051f,merchantUrl:_0x401d1b,gateways:_0x8f23f0,gatewaySettings:_0x5389f1,wallets:_0x241581}=_0x14eaaf,_0x28e162=await database_1[_0x8b24bc(0x21c)][_0x8b24bc(0x230)][_0x8b24bc(0x1e7)]({'where':{'username':_0x22bb26}});if(_0x28e162)throw new Error(_0x8b24bc(0x243));if(_0x14051f){const _0x8a4179=await database_1[_0x8b24bc(0x21c)]['shop'][_0x8b24bc(0x1e7)]({'where':{'telegram':_0x14051f}});if(_0x8a4179)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x15bafc=await bcryptjs_1['default'][_0x8b24bc(0x1bb)](_0x1f0b8f,0xc),_0xca5e1e=_0x8b24bc(0x172)+crypto_1[_0x8b24bc(0x21c)][_0x8b24bc(0x1ee)](0x20)[_0x8b24bc(0x1db)](_0x8b24bc(0x16e)),_0x4681c0=_0x8b24bc(0x20a)+crypto_1[_0x8b24bc(0x21c)][_0x8b24bc(0x1ee)](0x20)['toString'](_0x8b24bc(0x16e)),_0x515c46=_0x8f23f0?_0x8f23f0['map'](_0x1230f7=>this[_0x8b24bc(0x26a)](_0x1230f7)):null;_0x8f23f0&&_0x515c46&&console[_0x8b24bc(0x1d5)]('üîÑ\x20Gateway\x20mapping\x20(create):',_0x8f23f0,'->',_0x515c46);const _0x4b4711=await database_1[_0x8b24bc(0x21c)]['shop']['create']({'data':{'name':_0x3ccc7a,'username':_0x22bb26,'password':_0x15bafc,'telegram':_0x14051f,'shopUrl':_0x401d1b,'paymentGateways':_0x515c46?JSON[_0x8b24bc(0x201)](_0x515c46):null,'gatewaySettings':_0x5389f1?JSON[_0x8b24bc(0x201)](_0x5389f1):null,'usdtPolygonWallet':_0x241581?.[_0x8b24bc(0x19d)]||null,'usdtTrcWallet':_0x241581?.[_0x8b24bc(0x191)]||null,'usdtErcWallet':_0x241581?.[_0x8b24bc(0x149)]||null,'usdcPolygonWallet':_0x241581?.['usdcPolygonWallet']||null,'publicKey':_0xca5e1e,'secretKey':_0x4681c0,'status':_0x8b24bc(0x235)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4b4711['id'],'fullName':_0x4b4711[_0x8b24bc(0x17f)],'username':_0x4b4711[_0x8b24bc(0x171)],'telegramId':_0x4b4711[_0x8b24bc(0x251)],'merchantUrl':_0x4b4711[_0x8b24bc(0x204)],'gateways':_0x4b4711[_0x8b24bc(0x213)]?JSON[_0x8b24bc(0x1d1)](_0x4b4711[_0x8b24bc(0x213)]):null,'gatewaySettings':_0x4b4711['gatewaySettings']?JSON[_0x8b24bc(0x1d1)](_0x4b4711[_0x8b24bc(0x14e)]):null,'publicKey':_0x4b4711[_0x8b24bc(0x1ad)],'wallets':{'usdtPolygonWallet':_0x4b4711[_0x8b24bc(0x19d)],'usdtTrcWallet':_0x4b4711[_0x8b24bc(0x191)],'usdtErcWallet':_0x4b4711[_0x8b24bc(0x149)],'usdcPolygonWallet':_0x4b4711[_0x8b24bc(0x1c8)]},'status':_0x4b4711[_0x8b24bc(0x247)],'createdAt':_0x4b4711['createdAt']};}async[a35_0x42240e(0x202)](_0x232b97){const _0x35fb02=a35_0x42240e;await database_1[_0x35fb02(0x21c)][_0x35fb02(0x230)][_0x35fb02(0x217)]({'where':{'id':_0x232b97}});}['generateDailyStatistics'](_0x439565,_0x401082,_0x16381f){const _0x375e19=a35_0x42240e,_0x2efd08=new Map(),_0x592c2c=new Date(_0x401082);while(_0x592c2c<=_0x16381f){const _0x382699=_0x592c2c[_0x375e19(0x1f3)]()['split']('T')[0x0];_0x2efd08[_0x375e19(0x240)](_0x382699,{'revenue':0x0,'count':0x0}),_0x592c2c[_0x375e19(0x1b4)](_0x592c2c[_0x375e19(0x1f4)]()+0x1);}for(const _0x28ba59 of _0x439565){const _0x5ae985=_0x28ba59['createdAt'][_0x375e19(0x1f3)]()[_0x375e19(0x189)]('T')[0x0],_0x575ce1=_0x2efd08[_0x375e19(0x1e5)](_0x5ae985);_0x575ce1&&(_0x575ce1[_0x375e19(0x266)]+=0x1,_0x28ba59['status']===_0x375e19(0x1a7)&&(_0x28ba59[_0x375e19(0x22f)]?_0x575ce1[_0x375e19(0x1e2)]+=_0x28ba59[_0x375e19(0x22f)]:console[_0x375e19(0x1d5)](_0x375e19(0x22c)+_0x28ba59['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x554c1a=[],_0x7d4c5a=[];for(const [_0x230c8a,_0x57cd4f]of _0x2efd08){_0x554c1a[_0x375e19(0x159)]({'date':_0x230c8a,'amount':Math[_0x375e19(0x16d)](_0x57cd4f[_0x375e19(0x1e2)]*0x64)/0x64}),_0x7d4c5a[_0x375e19(0x159)]({'date':_0x230c8a,'count':_0x57cd4f['count']});}return{'dailyRevenue':_0x554c1a,'dailyPayments':_0x7d4c5a};}}exports[a35_0x42240e(0x227)]=AdminService;