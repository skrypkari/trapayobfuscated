'use strict';const a50_0x22c744=a50_0x5784;(function(_0x1c4f30,_0x2a03f4){const _0x5c3c29=a50_0x5784,_0x484856=_0x1c4f30();while(!![]){try{const _0x20ada7=parseInt(_0x5c3c29(0xea))/0x1*(parseInt(_0x5c3c29(0xe1))/0x2)+parseInt(_0x5c3c29(0x1d2))/0x3*(parseInt(_0x5c3c29(0x1dc))/0x4)+parseInt(_0x5c3c29(0x1fe))/0x5*(parseInt(_0x5c3c29(0x188))/0x6)+-parseInt(_0x5c3c29(0x116))/0x7+-parseInt(_0x5c3c29(0x172))/0x8+parseInt(_0x5c3c29(0x202))/0x9*(-parseInt(_0x5c3c29(0x25a))/0xa)+parseInt(_0x5c3c29(0x10b))/0xb;if(_0x20ada7===_0x2a03f4)break;else _0x484856['push'](_0x484856['shift']());}catch(_0x503ae0){_0x484856['push'](_0x484856['shift']());}}}(a50_0x49ea,0x36ce4));var __importDefault=this&&this[a50_0x22c744(0x209)]||function(_0x4bb21b){const _0x453fec=a50_0x22c744;return _0x4bb21b&&_0x4bb21b[_0x453fec(0x15e)]?_0x4bb21b:{'default':_0x4bb21b};};function a50_0x49ea(){const _0x24de25=['17LmASff','orderId','AmPay','utf8','activateUser','getGatewayNameById','NONEXISTENT_GATEWAY_FILTER','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','successUrl','\x20\x20\x20üí≥\x20Total\x20payments:\x20','\x20USDT\x20(after\x20','Sepa','\x20status:\x20','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','not\x20provided','revenue','currencyService','PENDING','availableBalance','getUTCFullYear','üìã\x20Found\x20','qrcode','sort','üìÖ\x20Date\x20from\x20filter:\x20','\x20backup\x20codes','customerEmail','totalPaidOut','\x20USDT\x20(gross\x20revenue)','AmPay\x20TRY','join','getAllPayments','dateTo','generateSecret','769571EpQvyw',':\x20commission\x20=\x20','reduce','turnoverUSDT','Shop\x20not\x20found','\x20PAID\x20payments','custom','base32','noda','wallet','getGatewayIdByName','310660byIDfe','totp','%\x20commission)','REFUND','\x27\x20->\x20ID\x20\x27','KLYME\x20GB','forEach','totalAmount','get2FASettings','amountAfterCommissionUSDT','toUpperCase','warn','Interac','TrapaPay\x20Admin','shop','chargebackAmount','telegramUsers','balance','findUnique','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','\x20\x20\x20Merchant\x20gets:\x20','round','totalAmountUSDT','erc20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20Tolerance:\x20','totalPayout','klyme_de','ACTIVE','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','test_gateway','\x20paid\x20payments\x20for\x20gateway\x20','getPayoutById','üîç\x20Creating\x20payout\x20with\x20data:','\x20\x20\x20New\x20amount:\x20','2020-01-01','setUTCDate','payouts','Error\x20parsing\x20backup\x20codes:','\x27\x20to\x20name\x20\x27','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','getFullYear','telegramBotService','CRYPTO','\x20USDC\x20to\x20merchant\x20','üìä\x20Final\x20WHERE\x20conditions:','Invalid\x202FA\x20token\x20or\x20backup\x20code','map','cwd','getShopWallets','üìä\x20Generated\x20reports\x20for\x20','erc20_usdc','gte','log','telegramId','getMerchantStatistics','setupAdmin2FA',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','plisio','error','default','dailyPayments','sk_','üîÑ\x20Gateway\x20mapping\x20(get):','enableAdmin2FA','üí∞\x20Current\x20shop\x20balance:\x20','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','not\x20set','paidAt','getGatewayDisplayName','randomBytes','totalCommissionRate','__esModule','wallets','\x20\x20\x20üåç\x20Country:\x20','\x20USDT\x20(already\x20paid\x20out)','turnover','suspendUser','periodFrom','pendingPayout','_count','twoFactorSecret','lastMonth','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','\x20\x20\x20Shop\x20totalPaidOut:\x20','üìä\x20Payout\x20statistics\x20calculated:','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20USDT\x20(current\x20balance\x20in\x20DB)','getMonth','\x20for\x20shop\x20',']\x20Updating\x20password\x20for\x20user\x20','üìä\x20Statistics\x20PAID\x20payments\x20count:\x20','3101912AfBQQS','notes','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','EXPIRED','desc','üéØ\x20[','OxaPay','startsWith','awaitingPayout','payout','\x20\x20\x20Difference:\x20','amountUSDT','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','gatewaySettings','setDate','month','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20Current\x20network:\x20','commissionUSDT','password','updatedAt','üîê\x20Admin\x202FA\x20disabled','6hriITr','üîç\x20Selected\x20polygon\x20wallet:\x20','floor','Deposit','verify','\x20became\x20PAID:',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','cointopay2','toFixed','createPayout','Visa/MasterCard','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','UTC','custom_','yesterday','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','existsSync','get','getPayoutReports','ADMIN_2FA_ENABLED=','‚ö†Ô∏è\x20Payment\x20','‚úÖ\x20Deposited\x20','üìä\x20Getting\x20payout\x20reports\x20with\x20filters:','deleteUser','shopUrl','üîê\x20Admin\x20password\x20changed\x20successfully','üîç\x20Selected\x20trc20\x20wallet:\x20','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','amount','totalTurnover','‚úÖ\x20Payout\x20','\x20\x20\x20Amount\x20difference:\x20','hex','_sum','generateBackupCodes','includes','COMPLETED','dailyRevenue','\x20USDT\x20(-','commission','InstaXchange','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','TrapaPay\x20Admin\x20(','merchantUrl','\x20->\x20','getMerchantsAwaitingPayout','ADMIN_PASSWORD_HASH=','count','usdcPolygonWallet','klyme_gb','groupBy','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','statusChangedAt','usdtPolygonWallet','üîÑ\x20Gateway\x20mapping\x20(create):','Payment\x20not\x20found',',\x20successful:\x20','defineProperty','findMany','Plisio','\x20\x20\x20Added\x20to\x20balance:\x20+','üìä\x20Gateway\x20filter\x20applied:','readFileSync','compare','\x20merchants\x20for\x20selection','today','Insufficient\x20balance.\x20Available:\x20','‚úÖ\x20Payout\x20created:\x20','stringify','status','\x20\x20\x20üíµ\x20Available\x20balance:\x20','publicKey','./telegramBotService','üìä\x20Statistics\x20date\x20range:\x20','55833RzicXo','this_week','substr','\x20to\x20','bcryptjs','üìä\x20Getting\x20payments\x20with\x20filters:','username','gatewayCommissionRate','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','trim','92PPPILv','Noda','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','\x20USDT,\x20Requested:\x20','\x20USDT\x20for\x20payment\x20','\x20USDT,\x20merchant:\x20','\x20balance\x20updated:','./currencyService','üí≥\x20Final\x20payout\x20wallet\x20for\x20','KLYME\x20DE','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','generateDailyStatistics','random','passwordHash','parse','\x20USDT\x20-\x20will\x20return\x20to\x20balance','\x20\x20\x20üí∞\x20Total\x20payout:\x20','dateFrom','Merchant\x20not\x20found','convertToUSDT','Username\x20already\x20exists','üí±\x20Currency\x20filter\x20applied:\x20','insensitive','üí∞\x20Creating\x20payout\x20for\x20shop\x20','$transaction','averageCommissionRate','üîê\x202FA\x20enabled\x20for\x20shop:\x20','getAllPayouts','gateway','üìä\x20Status\x20filter\x20is\x20not\x20PAID,\x20returning\x20empty\x20statistics','paidOutUSDT','failureMessage','ADMIN_2FA_SECRET=','getTime','1293835dmzksX','%\x20from\x20','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','Test\x20Gateway','9wgFiDw','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','getUTCDate','getPaymentById','paymentGateways','setHours','update','__importDefault','averageCheckUSDT','otpauth_url','createdAt','üí∞\x20[PAYOUT]\x20Gateway\x20','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','toISOString','createUser','../config/config','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20Gateway:\x20','findFirst','length','üîå\x20Gateway:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','üìä\x20Calculating\x20payout\x20statistics...','gatewayEarnings','updateCustomerData','ADMIN_2FA_ENABLED=true','merchantId','\x20updated\x20successfully','this_month','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','push','sendPayoutNotification',',\x20userId:\x20','üí∞\x20Found\x20','usdtErcWallet','\x20USDT\x20(theoretical\x20net)','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','customerUa','fullName',',\x20Commission:\x20','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','\x20\x20\x20Shop\x20balance:\x20','enable2FA','\x20\x20\x20Amount\x20decreased\x20by\x20','toDataURL','setup2FA','thisMonth','\x20in\x20','has','period','customerCountry','TrapaPay','\x20\x20\x20Payout\x20amount:\x20','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','totalAmountAfterCommissionUSDT','week','lastLoginAt','merchantUsername','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','\x27\x20(from\x20\x27','currency','\x20USDT\x20(+','getGatewayInternalName','\x20order','\x20USDT\x20(same\x20as\x20awaiting)','–ù–µ\x20—É–∫–∞–∑–∞–Ω','SquirrelPay','CHARGEBACK','customerIp','mastercard','klyme_eu','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','updatePayout','speakeasy','amountAfterGatewayCommissionUSDT','from','network','\x20\x20\x20Full\x20amount:\x20','getUTCMonth','split','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','customerName','USDC','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','.env','Current\x20password\x20is\x20incorrect','writeFileSync','üìä\x20Statistics\x20WHERE\x20conditions:','3115730OAzepB','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','üîç\x20Initial\x20wallet\x20from\x20request:\x20','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','telegram','all','AdminService','TrapaPay\x20(','values','depositBalance','üìä\x20Available\x20gateways\x20in\x20database:','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','üîê\x20[','date','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','config','shopId','usdtTrcWallet','Error\x20processing\x20payment\x20','year','paymentsCount','disable2FA','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','Rapyd','üìÖ\x20Period:\x20','toString','gatewayOrderId','merchantEarnings','\x20\x20\x20Current\x20amount:\x20','ceil','usdcErcWallet','ru-RU','ADMIN_BACKUP_CODES=','hash','aggregate','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','üîê\x20Admin\x202FA\x20enabled','\x20\x20\x20Available\x20(raw):\x20','merchantEarningsUSDT','localeCompare','pendingUrl','\x20\x20\x20ü§î\x20Difference:\x20','\x20\x20\x20Merchant\x20loses:\x20','getUTCDay','whiteUrl','\x20USDT)','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','deletePayout','\x20merchants','üí∞\x20Shop\x20','set','periodTo','üìÖ\x20Date\x20to\x20filter:\x20','\x20-\x20','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','name','üîß\x20[','adminNotes','create','merchantName','all_time','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','trc20','polygon','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','Invalid\x202FA\x20token','getDate','gateways','üîë\x20Generated\x20','../types/gateway','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','txid','\x27\x20->\x20name\x20\x27','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','lte','2FA\x20token\x20is\x20required','\x20USDT\x20(total\x20paid\x20to\x20merchants)','toLowerCase','\x20\x20\x20Balance:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','backupCodes','admin','PAID',',\x20chargebacks:\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','getSystemStatistics','üîÑ\x20Admin\x20updating\x20payment\x20','splice','\x20USDT','24870aLgEup','CoinToPay2','entries','twoFactorEnabled','payment','changeAdminPassword','\x20payments)','Telegram\x20username\x20already\x20exists','0000'];a50_0x49ea=function(){return _0x24de25;};return a50_0x49ea();}Object[a50_0x22c744(0x1c1)](exports,a50_0x22c744(0x15e),{'value':!![]}),exports[a50_0x22c744(0x260)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a50_0x22c744(0x1d6))),crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),speakeasy_1=__importDefault(require(a50_0x22c744(0x24b))),qrcode_1=__importDefault(require(a50_0x22c744(0xff))),config_1=require(a50_0x22c744(0x211)),currencyService_1=require(a50_0x22c744(0x1e3)),telegramBotService_1=require(a50_0x22c744(0x1d0)),gateway_1=require(a50_0x22c744(0xcd));class AdminService{async['getPayoutStats'](){const _0x48b905=a50_0x22c744;console[_0x48b905(0x14b)](_0x48b905(0x218));const _0xda71d9=await database_1[_0x48b905(0x152)][_0x48b905(0x124)][_0x48b905(0x27c)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x75940a=await database_1[_0x48b905(0x152)]['payment'][_0x48b905(0x1b7)]({'where':{'status':_0x48b905(0xda),'gateway':{'not':_0x48b905(0x134)}}}),_0x1e8fbb=new Date(),_0x145ee5=new Date(_0x1e8fbb['getFullYear'](),_0x1e8fbb[_0x48b905(0x16e)](),0x1),_0x1e015f=new Date(_0x1e8fbb[_0x48b905(0x13f)](),_0x1e8fbb[_0x48b905(0x16e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5999cd=await database_1[_0x48b905(0x152)][_0x48b905(0x17b)][_0x48b905(0x27c)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x145ee5,'lte':_0x1e015f},'status':'COMPLETED'}}),_0x486e04=_0xda71d9[_0x48b905(0x1a9)]['totalPaidOut']||0x0,_0x4bdab1=_0xda71d9[_0x48b905(0x1a9)]['balance']||0x0,_0x2a6285=_0x5999cd[_0x48b905(0x1a9)][_0x48b905(0x1a4)]||0x0,_0x2550c9={'totalPayout':Math['round'](_0x486e04*0x64)/0x64,'awaitingPayout':Math['round'](_0x4bdab1*0x64)/0x64,'thisMonth':Math[_0x48b905(0x12b)](_0x2a6285*0x64)/0x64,'availableBalance':Math['round'](_0x4bdab1*0x64)/0x64,'totalPayments':_0x75940a};return console[_0x48b905(0x14b)](_0x48b905(0x16b)),console[_0x48b905(0x14b)](_0x48b905(0x1ec)+_0x2550c9[_0x48b905(0x130)]+_0x48b905(0xd4)),console[_0x48b905(0x14b)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x2550c9[_0x48b905(0x17a)]+_0x48b905(0xf1)),console[_0x48b905(0x14b)](_0x48b905(0x1ce)+_0x2550c9[_0x48b905(0xfc)]+_0x48b905(0x242)),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x2550c9[_0x48b905(0x230)]+'\x20USDT'),console[_0x48b905(0x14b)](_0x48b905(0xf3)+_0x2550c9['totalPayments']+_0x48b905(0x110)),_0x2550c9;}async[a50_0x22c744(0x21a)](_0x4ea80c,_0x11ab6d){const _0x30f1c0=a50_0x22c744;console[_0x30f1c0(0x14b)](_0x30f1c0(0xc8)+_0x4ea80c+':',_0x11ab6d);const _0x154b52=await database_1[_0x30f1c0(0x152)][_0x30f1c0(0xe5)][_0x30f1c0(0x128)]({'where':{'id':_0x4ea80c},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x154b52)throw new Error(_0x30f1c0(0x1bf));const _0x2e991e={};_0x11ab6d['customerCountry']!==undefined&&(_0x2e991e[_0x30f1c0(0x234)]=_0x11ab6d[_0x30f1c0(0x234)]||null);_0x11ab6d[_0x30f1c0(0x246)]!==undefined&&(_0x2e991e[_0x30f1c0(0x246)]=_0x11ab6d[_0x30f1c0(0x246)]||null);_0x11ab6d['customerUa']!==undefined&&(_0x2e991e[_0x30f1c0(0x227)]=_0x11ab6d[_0x30f1c0(0x227)]||null);const _0x5f1176=await database_1[_0x30f1c0(0x152)][_0x30f1c0(0xe5)][_0x30f1c0(0x208)]({'where':{'id':_0x4ea80c},'data':{..._0x2e991e,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x30f1c0(0x14b)](_0x30f1c0(0x200)+_0x4ea80c),console[_0x30f1c0(0x14b)](_0x30f1c0(0x160)+_0x154b52[_0x30f1c0(0x234)]+_0x30f1c0(0x1b4)+_0x5f1176[_0x30f1c0(0x234)]),console[_0x30f1c0(0x14b)]('\x20\x20\x20üåê\x20IP:\x20'+_0x154b52[_0x30f1c0(0x246)]+_0x30f1c0(0x1b4)+_0x5f1176['customerIp']),console[_0x30f1c0(0x14b)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x154b52['customerUa']?_0x30f1c0(0xba):_0x30f1c0(0x159))+'\x20->\x20'+(_0x5f1176['customerUa']?_0x30f1c0(0xba):_0x30f1c0(0x159))),_0x5f1176;}async[a50_0x22c744(0xdd)](_0x15ec44,_0x188008){const _0x5626c0=a50_0x22c744,_0x3d1fa9=_0x188008?new Date(_0x188008):new Date();let _0x2e4a7e,_0x2d368e;if(_0x15ec44['startsWith'](_0x5626c0(0x195))){const _0x202f42=_0x15ec44['replace'](_0x5626c0(0x195),'')[_0x5626c0(0x251)]('_');if(_0x202f42[_0x5626c0(0x215)]===0x2){const _0x1a31f8=new Date(_0x202f42[0x0]),_0x3e8072=new Date(_0x202f42[0x1]);_0x2e4a7e=new Date(Date[_0x5626c0(0x194)](_0x1a31f8[_0x5626c0(0xfd)](),_0x1a31f8[_0x5626c0(0x250)](),_0x1a31f8[_0x5626c0(0x204)](),0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date[_0x5626c0(0x194)](_0x3e8072[_0x5626c0(0xfd)](),_0x3e8072[_0x5626c0(0x250)](),_0x3e8072[_0x5626c0(0x204)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x48513a=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9['getUTCFullYear'](),_0x3d1fa9['getUTCMonth'](),_0x3d1fa9['getUTCDate']()-0x1e));_0x2e4a7e=new Date(Date[_0x5626c0(0x194)](_0x48513a['getUTCFullYear'](),_0x48513a[_0x5626c0(0x250)](),_0x48513a[_0x5626c0(0x204)](),0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)](),_0x3d1fa9[_0x5626c0(0x204)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x15ec44[_0x5626c0(0xd5)]()){case _0x5626c0(0x1c9):_0x2e4a7e=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)](),_0x3d1fa9[_0x5626c0(0x204)](),0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date['UTC'](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)](),_0x3d1fa9['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x5626c0(0x196):const _0x442e3f=new Date(_0x3d1fa9);_0x442e3f['setUTCDate'](_0x442e3f['getUTCDate']()-0x1),_0x2e4a7e=new Date(Date['UTC'](_0x442e3f[_0x5626c0(0xfd)](),_0x442e3f['getUTCMonth'](),_0x442e3f[_0x5626c0(0x204)](),0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date[_0x5626c0(0x194)](_0x442e3f[_0x5626c0(0xfd)](),_0x442e3f[_0x5626c0(0x250)](),_0x442e3f[_0x5626c0(0x204)](),0x17,0x3b,0x3b,0x3e7));break;case _0x5626c0(0x1d3):const _0xdc0c97=_0x3d1fa9[_0x5626c0(0x285)](),_0x260372=_0xdc0c97===0x0?-0x6:0x1-_0xdc0c97,_0x138897=_0x3d1fa9['getUTCDate']()+_0x260372;_0x2e4a7e=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)](),_0x138897,0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date['UTC'](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9['getUTCMonth'](),_0x3d1fa9[_0x5626c0(0x204)](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0x13b4cf=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9['getUTCMonth'](),_0x3d1fa9[_0x5626c0(0x204)]()-0x7)),_0x11bee6=_0x13b4cf[_0x5626c0(0x285)](),_0x58c91f=_0x11bee6===0x0?-0x6:0x1-_0x11bee6,_0x3f5391=_0x13b4cf[_0x5626c0(0x204)]()+_0x58c91f;_0x2e4a7e=new Date(Date[_0x5626c0(0x194)](_0x13b4cf[_0x5626c0(0xfd)](),_0x13b4cf[_0x5626c0(0x250)](),_0x3f5391,0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date['UTC'](_0x13b4cf[_0x5626c0(0xfd)](),_0x13b4cf['getUTCMonth'](),_0x3f5391+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x5626c0(0x21e):_0x2e4a7e=new Date(Date['UTC'](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)](),0x1,0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)](),_0x3d1fa9[_0x5626c0(0x204)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x2e4a7e=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x5626c0(0xc4):_0x2e4a7e=new Date(Date[_0x5626c0(0x194)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9['getUTCFullYear'](),_0x3d1fa9['getUTCMonth'](),_0x3d1fa9[_0x5626c0(0x204)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x2e4a7e=new Date(_0x3d1fa9[_0x5626c0(0x1fd)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x35b2ee=new Date(Date[_0x5626c0(0x194)](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9[_0x5626c0(0x250)](),_0x3d1fa9['getUTCDate']()-0x1e));_0x2e4a7e=new Date(Date['UTC'](_0x35b2ee['getUTCFullYear'](),_0x35b2ee[_0x5626c0(0x250)](),_0x35b2ee[_0x5626c0(0x204)](),0x0,0x0,0x0,0x0)),_0x2d368e=new Date(Date['UTC'](_0x3d1fa9[_0x5626c0(0xfd)](),_0x3d1fa9['getUTCMonth'](),_0x3d1fa9[_0x5626c0(0x204)](),0x17,0x3b,0x3b,0x3e7));}const _0x1df2fc={'gte':_0x2e4a7e,'lte':_0x2d368e};console[_0x5626c0(0x14b)](_0x5626c0(0x1d1)+_0x2e4a7e[_0x5626c0(0x20f)]()+_0x5626c0(0x1d5)+_0x2d368e[_0x5626c0(0x20f)]());const [_0x5e0205,_0x9d57bd,_0x5966ac,_0x970f7,_0x17a64d,_0x10952e,_0x59aa45,_0x1ddb5b,_0x35f894]=await Promise[_0x5626c0(0x25f)]([database_1[_0x5626c0(0x152)][_0x5626c0(0x124)][_0x5626c0(0x1b7)](),database_1[_0x5626c0(0x152)][_0x5626c0(0x124)]['count']({'where':{'status':_0x5626c0(0x132)}}),database_1[_0x5626c0(0x152)][_0x5626c0(0xe5)][_0x5626c0(0x1b7)]({'where':{'status':_0x5626c0(0xda),'createdAt':_0x1df2fc,'gateway':{'not':_0x5626c0(0x134)}}}),database_1[_0x5626c0(0x152)][_0x5626c0(0xe5)][_0x5626c0(0x1b7)]({'where':{'status':'CHARGEBACK','createdAt':_0x1df2fc,'gateway':{'not':'test_gateway'}}}),database_1[_0x5626c0(0x152)][_0x5626c0(0xe5)][_0x5626c0(0x1b7)]({'where':{'status':'REFUND','createdAt':_0x1df2fc,'gateway':{'not':'test_gateway'}}}),database_1[_0x5626c0(0x152)][_0x5626c0(0xe5)][_0x5626c0(0x1c2)]({'where':{'status':_0x5626c0(0xda),'createdAt':_0x1df2fc,'gateway':{'not':_0x5626c0(0x134)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x5626c0(0x152)][_0x5626c0(0xe5)][_0x5626c0(0x1c2)]({'where':{'gateway':{'not':_0x5626c0(0x134)}},'take':0xa,'orderBy':{'createdAt':_0x5626c0(0x176)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5626c0(0x152)][_0x5626c0(0xe5)]['findMany']({'where':{'createdAt':_0x1df2fc,'gateway':{'not':_0x5626c0(0x134)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x5626c0(0x152)][_0x5626c0(0xe5)]['findMany']({'where':{'status':_0x5626c0(0xda),'gateway':{'not':_0x5626c0(0x134)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x5626c0(0x14b)](_0x5626c0(0x171)+_0x5966ac);let _0x30bdb4=0x0,_0x5d444=0x0;for(const _0x52994a of _0x10952e){const _0xb46758=_0x52994a[_0x5626c0(0x17d)]||0x0;_0x30bdb4+=_0xb46758;if(_0x52994a[_0x5626c0(0x24c)]&&_0x52994a[_0x5626c0(0x17d)]){const _0x48e176=_0x52994a[_0x5626c0(0x17d)]-_0x52994a[_0x5626c0(0x24c)];_0x5d444+=_0x48e176;}}let _0x3a350c=0x0;for(const _0x18117d of _0x35f894){if(_0x18117d['amountAfterGatewayCommissionUSDT']&&_0x18117d['amountUSDT']){const _0x5aa0e9=_0x18117d[_0x5626c0(0x17d)]-_0x18117d[_0x5626c0(0x24c)];_0x3a350c+=_0x5aa0e9;}}const _0x12ef5b=_0x5966ac>0x0?_0x30bdb4/_0x5966ac:0x0,_0x47b963=this[_0x5626c0(0x1e7)](_0x1ddb5b,_0x2e4a7e,_0x2d368e),_0x553c0f=await database_1['default'][_0x5626c0(0xe5)][_0x5626c0(0x1b7)]({'where':{'createdAt':_0x1df2fc,'gateway':{'not':_0x5626c0(0x134)},'status':{'notIn':['PENDING',_0x5626c0(0x175)]}}}),_0x4929ea=_0x553c0f>0x0?_0x5966ac/_0x553c0f*0x64:0x0;return{'totalShops':_0x5e0205,'activeShops':_0x9d57bd,'totalPayments':_0x553c0f,'successfulPayments':_0x5966ac,'totalAttempts':_0x553c0f,'chargebacks':_0x970f7,'refunds':_0x17a64d,'totalRevenue':Math[_0x5626c0(0x12b)](_0x30bdb4*0x64)/0x64,'trapayEarnings':Math['round'](_0x5d444*0x64)/0x64,'trapayEarningsAllTime':Math[_0x5626c0(0x12b)](_0x3a350c*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x12ef5b*0x64)/0x64,'conversionRate':Math['round'](_0x4929ea*0x64)/0x64,'dailyRevenue':_0x47b963[_0x5626c0(0x1ad)],'dailyPayments':_0x47b963[_0x5626c0(0x153)],'recentPayments':_0x59aa45[_0x5626c0(0x145)](_0x65eb1c=>({'id':_0x65eb1c['id'],'amount':_0x65eb1c['amount'],'currency':_0x65eb1c['currency'],'status':_0x65eb1c[_0x5626c0(0x1cd)],'gateway':_0x65eb1c[_0x5626c0(0x1f8)],'shop':_0x65eb1c['shop'],'createdAt':_0x65eb1c[_0x5626c0(0x20c)]}))};}}async[a50_0x22c744(0x14d)](_0x417da0){const _0x539ee1=a50_0x22c744;console[_0x539ee1(0x14b)](_0x539ee1(0x265),_0x417da0);let _0x430108,_0x1afc67=new Date();if(_0x417da0[_0x539ee1(0x233)]===_0x539ee1(0x111)&&_0x417da0['dateFrom']&&_0x417da0[_0x539ee1(0x109)]){const _0x49008c=new Date(_0x417da0[_0x539ee1(0x1ed)]),_0x1d1b3f=new Date(_0x417da0['dateTo']);_0x430108=new Date(Date[_0x539ee1(0x194)](_0x49008c['getUTCFullYear'](),_0x49008c[_0x539ee1(0x250)](),_0x49008c['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1afc67=new Date(Date[_0x539ee1(0x194)](_0x1d1b3f[_0x539ee1(0xfd)](),_0x1d1b3f[_0x539ee1(0x250)](),_0x1d1b3f['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x10b6a6=new Date();switch(_0x417da0[_0x539ee1(0x233)]){case _0x539ee1(0x239):_0x430108=new Date(_0x10b6a6[_0x539ee1(0x1fd)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x430108['setHours'](0x0,0x0,0x0,0x0),_0x1afc67['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x539ee1(0x181):_0x430108=new Date(Date[_0x539ee1(0x194)](_0x10b6a6[_0x539ee1(0xfd)](),_0x10b6a6[_0x539ee1(0x250)](),0x1,0x0,0x0,0x0,0x0)),_0x1afc67=new Date(Date[_0x539ee1(0x194)](_0x10b6a6[_0x539ee1(0xfd)](),_0x10b6a6[_0x539ee1(0x250)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x539ee1(0x168):_0x430108=new Date(Date[_0x539ee1(0x194)](_0x10b6a6[_0x539ee1(0xfd)](),_0x10b6a6[_0x539ee1(0x250)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1afc67=new Date(Date[_0x539ee1(0x194)](_0x10b6a6[_0x539ee1(0xfd)](),_0x10b6a6['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x539ee1(0x26d):_0x430108=new Date(_0x10b6a6['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x430108['setHours'](0x0,0x0,0x0,0x0),_0x1afc67[_0x539ee1(0x207)](0x17,0x3b,0x3b,0x3e7);break;case _0x539ee1(0x25f):default:_0x430108=new Date(_0x539ee1(0x139)),_0x430108[_0x539ee1(0x207)](0x0,0x0,0x0,0x0),_0x1afc67[_0x539ee1(0x207)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x539ee1(0x14b)](_0x539ee1(0x272)+_0x430108['toISOString']()+_0x539ee1(0x1d5)+_0x1afc67['toISOString']());const _0x8ccfdc={'status':'PAID','gateway':{'not':_0x539ee1(0x134)},'createdAt':{'gte':_0x430108,'lte':_0x1afc67}};_0x417da0[_0x539ee1(0x26a)]&&(_0x8ccfdc['shopId']=_0x417da0['shopId']);const _0x36b65b=await database_1[_0x539ee1(0x152)][_0x539ee1(0xe5)]['findMany']({'where':_0x8ccfdc,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x539ee1(0x14b)](_0x539ee1(0x223)+_0x36b65b[_0x539ee1(0x215)]+'\x20paid\x20payments\x20for\x20analysis');const _0xd9703c={'gateway':{'not':_0x539ee1(0x134)},'status':{'notIn':[_0x539ee1(0xfb),_0x539ee1(0x175)]},'createdAt':{'gte':_0x430108,'lte':_0x1afc67}};_0x417da0[_0x539ee1(0x26a)]&&(_0xd9703c['shopId']=_0x417da0[_0x539ee1(0x26a)]);const _0x836d06=await database_1[_0x539ee1(0x152)][_0x539ee1(0xe5)][_0x539ee1(0x1b7)]({'where':_0xd9703c}),_0x2037a7={..._0xd9703c,'status':_0x539ee1(0x245)},_0x196292={..._0xd9703c,'status':_0x539ee1(0x119)},[_0x34981c,_0x45f682]=await Promise['all']([database_1['default'][_0x539ee1(0xe5)][_0x539ee1(0x1b7)]({'where':_0x2037a7}),database_1[_0x539ee1(0x152)][_0x539ee1(0xe5)]['count']({'where':_0x196292})]);console[_0x539ee1(0x14b)](_0x539ee1(0xdc)+_0x836d06+_0x539ee1(0x1c0)+_0x36b65b[_0x539ee1(0x215)]+_0x539ee1(0xdb)+_0x34981c+',\x20refunds:\x20'+_0x45f682);let _0x1f0b26=0x0,_0x1ee001=0x0,_0x5df8eb=0x0;const _0x164981={},_0x4d35d4={},_0x13fb42={},_0x55d69b=new Date(_0x430108);while(_0x55d69b<=_0x1afc67){const _0x5da74b=_0x55d69b[_0x539ee1(0x20f)]()[_0x539ee1(0x251)]('T')[0x0];_0x13fb42[_0x5da74b]={'date':_0x5da74b,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x55d69b[_0x539ee1(0x13a)](_0x55d69b[_0x539ee1(0x204)]()+0x1);}for(const _0x57a951 of _0x36b65b){try{const _0x1fb48e=_0x57a951[_0x539ee1(0x17d)]||0x0;if(_0x1fb48e<=0x0){console['warn'](_0x539ee1(0x19c)+_0x57a951['id']+_0x539ee1(0x249));continue;}let _0x1aff91,_0x1c0e52;if(_0x57a951['amountAfterGatewayCommissionUSDT']!==null&&_0x57a951[_0x539ee1(0x24c)]!==undefined)_0x1aff91=_0x57a951['amountAfterGatewayCommissionUSDT'],_0x1c0e52=_0x1fb48e-_0x1aff91,console[_0x539ee1(0x14b)]('üìä\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x57a951['id']+':\x20'+_0x1fb48e[_0x539ee1(0x190)](0x6)+_0x539ee1(0x1e1)+_0x1aff91[_0x539ee1(0x190)](0x6)+_0x539ee1(0xe0));else{let _0x151221={};if(_0x57a951[_0x539ee1(0x124)]['gatewaySettings'])try{_0x151221=JSON[_0x539ee1(0x1ea)](_0x57a951[_0x539ee1(0x124)][_0x539ee1(0x17f)]);}catch(_0x45a8fb){console[_0x539ee1(0x151)](_0x539ee1(0x193)+_0x57a951['shopId']+':',_0x45a8fb);}let _0x1bacc6=0x2d;for(const [_0x447a83,_0x223f56]of Object[_0x539ee1(0xe3)](_0x151221)){if(_0x447a83[_0x539ee1(0xd5)]()===_0x57a951['gateway']['toLowerCase']()){_0x1bacc6=_0x223f56[_0x539ee1(0x1af)]||0x2d;break;}}_0x1c0e52=_0x1fb48e*(_0x1bacc6/0x64),_0x1aff91=_0x1fb48e-_0x1c0e52,console['log']('üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x57a951['id']+':\x20'+_0x1bacc6+_0x539ee1(0x1ff)+_0x1fb48e[_0x539ee1(0x190)](0x6)+_0x539ee1(0xe0));}_0x1f0b26+=_0x1fb48e,_0x1ee001+=_0x1aff91,_0x5df8eb+=_0x1c0e52;let _0x5be8df;_0x57a951[_0x539ee1(0x1d9)]!==null&&_0x57a951['gatewayCommissionRate']!==undefined?(_0x5be8df=_0x57a951[_0x539ee1(0x1d9)],console['log'](_0x539ee1(0xd1)+_0x57a951['id']+':\x20'+_0x5be8df+'%')):(_0x5be8df=_0x1fb48e>0x0?_0x1c0e52/_0x1fb48e*0x64:0x0,console[_0x539ee1(0x14b)]('üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x57a951['id']+':\x20'+_0x5be8df[_0x539ee1(0x190)](0x2)+'%'));!_0x164981[_0x57a951[_0x539ee1(0x1f8)]]&&(_0x164981[_0x57a951[_0x539ee1(0x1f8)]]={'gateway':_0x57a951['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x57a951[_0x539ee1(0x1f8)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x164981[_0x57a951[_0x539ee1(0x1f8)]][_0x539ee1(0x26e)]++,_0x164981[_0x57a951['gateway']][_0x539ee1(0x10e)]+=_0x1fb48e,_0x164981[_0x57a951[_0x539ee1(0x1f8)]][_0x539ee1(0x184)]+=_0x1c0e52,_0x164981[_0x57a951[_0x539ee1(0x1f8)]]['merchantEarningsUSDT']+=_0x1aff91,_0x164981[_0x57a951['gateway']][_0x539ee1(0x15d)]+=_0x5be8df;!_0x417da0[_0x539ee1(0x26a)]&&(!_0x4d35d4[_0x57a951['shopId']]&&(_0x4d35d4[_0x57a951[_0x539ee1(0x26a)]]={'shopId':_0x57a951[_0x539ee1(0x26a)],'shopName':_0x57a951[_0x539ee1(0x124)]['name'],'shopUsername':_0x57a951['shop'][_0x539ee1(0x1d8)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4d35d4[_0x57a951[_0x539ee1(0x26a)]][_0x539ee1(0x26e)]++,_0x4d35d4[_0x57a951['shopId']][_0x539ee1(0x10e)]+=_0x1fb48e,_0x4d35d4[_0x57a951['shopId']]['commissionUSDT']+=_0x1c0e52,_0x4d35d4[_0x57a951[_0x539ee1(0x26a)]][_0x539ee1(0x280)]+=_0x1aff91);const _0x391c44=_0x57a951[_0x539ee1(0x15a)][_0x539ee1(0x20f)]()[_0x539ee1(0x251)]('T')[0x0];_0x13fb42[_0x391c44]&&(_0x13fb42[_0x391c44][_0x539ee1(0x162)]+=_0x1fb48e,_0x13fb42[_0x391c44][_0x539ee1(0x275)]+=_0x1aff91,_0x13fb42[_0x391c44][_0x539ee1(0x219)]+=_0x1c0e52,_0x13fb42[_0x391c44][_0x539ee1(0x26e)]++);}catch(_0x2894a8){console['error'](_0x539ee1(0x26c)+_0x57a951['id']+':',_0x2894a8);}}Object['values'](_0x164981)[_0x539ee1(0x11c)](_0x42389e=>{const _0x43599f=_0x539ee1;_0x42389e[_0x43599f(0x1f5)]=_0x42389e[_0x43599f(0x26e)]>0x0?_0x42389e['totalCommissionRate']/_0x42389e['paymentsCount']:0x0,delete _0x42389e[_0x43599f(0x15d)];}),Object[_0x539ee1(0x262)](_0x4d35d4)[_0x539ee1(0x11c)](_0x9e0a4c=>{const _0x418c2e=_0x539ee1;_0x9e0a4c[_0x418c2e(0x20a)]=_0x9e0a4c[_0x418c2e(0x26e)]>0x0?_0x9e0a4c['turnoverUSDT']/_0x9e0a4c[_0x418c2e(0x26e)]:0x0;});let _0xed628=0x0,_0x4c1caf=0x0;if(_0x417da0[_0x539ee1(0x26a)]){const _0x67ad00=await database_1['default'][_0x539ee1(0x17b)]['findMany']({'where':{'shopId':_0x417da0[_0x539ee1(0x26a)],'status':_0x539ee1(0x1ac),'createdAt':{'gte':_0x430108,'lte':_0x1afc67}},'select':{'amount':!![]}});_0xed628=_0x67ad00[_0x539ee1(0x10d)]((_0x4ae06a,_0x4b91d8)=>_0x4ae06a+_0x4b91d8[_0x539ee1(0x1a4)],0x0);const _0x44ff1d=await database_1['default'][_0x539ee1(0x17b)][_0x539ee1(0x1c2)]({'where':{'shopId':_0x417da0[_0x539ee1(0x26a)],'status':_0x539ee1(0xfb),'createdAt':{'gte':_0x430108,'lte':_0x1afc67}},'select':{'amount':!![]}});_0x4c1caf=_0x44ff1d[_0x539ee1(0x10d)]((_0x432b0f,_0x4922d8)=>_0x432b0f+_0x4922d8[_0x539ee1(0x1a4)],0x0);}const _0x5027af=_0x836d06,_0x1160af=_0x36b65b['length'],_0x288599=_0x1160af>0x0?_0x1f0b26/_0x1160af:0x0,_0x3f3ab2=_0x5027af>0x0?Math[_0x539ee1(0x12b)](_0x1160af/_0x5027af*0x2710)/0x64:0x0,_0x243b4b=Math[_0x539ee1(0x277)]((_0x1afc67[_0x539ee1(0x1fd)]()-_0x430108[_0x539ee1(0x1fd)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1475ee={'totalTurnover':Math[_0x539ee1(0x12b)](_0x1f0b26*0x64)/0x64,'merchantEarnings':Math[_0x539ee1(0x12b)](_0x1ee001*0x64)/0x64,'gatewayEarnings':Math[_0x539ee1(0x12b)](_0x5df8eb*0x64)/0x64,'totalPaidOut':Math[_0x539ee1(0x12b)](_0xed628*0x64)/0x64,'pendingPayout':Math['round'](_0x4c1caf*0x64)/0x64,'averageCheck':Math[_0x539ee1(0x12b)](_0x288599*0x64)/0x64,'totalPayments':_0x5027af,'successfulPayments':_0x1160af,'conversionRate':_0x3f3ab2,'chargebacks':_0x34981c,'refunds':_0x45f682,'gatewayBreakdown':Object[_0x539ee1(0x262)](_0x164981)['map'](_0x14b9de=>({..._0x14b9de,'turnoverUSDT':Math[_0x539ee1(0x12b)](_0x14b9de[_0x539ee1(0x10e)]*0x64)/0x64,'commissionUSDT':Math[_0x539ee1(0x12b)](_0x14b9de[_0x539ee1(0x184)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x539ee1(0x12b)](_0x14b9de[_0x539ee1(0x280)]*0x64)/0x64,'averageCommissionRate':Math[_0x539ee1(0x12b)](_0x14b9de[_0x539ee1(0x1f5)]*0x64)/0x64})),'merchantBreakdown':_0x417da0['shopId']?undefined:Object['values'](_0x4d35d4)[_0x539ee1(0x145)](_0xadef85=>({..._0xadef85,'turnoverUSDT':Math[_0x539ee1(0x12b)](_0xadef85[_0x539ee1(0x10e)]*0x64)/0x64,'commissionUSDT':Math[_0x539ee1(0x12b)](_0xadef85[_0x539ee1(0x184)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x539ee1(0x12b)](_0xadef85[_0x539ee1(0x280)]*0x64)/0x64,'paidOutUSDT':Math[_0x539ee1(0x12b)](_0xadef85[_0x539ee1(0x1fa)]*0x64)/0x64,'averageCheckUSDT':Math[_0x539ee1(0x12b)](_0xadef85[_0x539ee1(0x20a)]*0x64)/0x64})),'dailyData':Object[_0x539ee1(0x262)](_0x13fb42)['map'](_0x23fae5=>({..._0x23fae5,'turnover':Math[_0x539ee1(0x12b)](_0x23fae5[_0x539ee1(0x162)]*0x64)/0x64,'merchantEarnings':Math[_0x539ee1(0x12b)](_0x23fae5['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x23fae5[_0x539ee1(0x219)]*0x64)/0x64}))[_0x539ee1(0x100)]((_0x24a32f,_0x537d8a)=>_0x24a32f[_0x539ee1(0x267)][_0x539ee1(0x281)](_0x537d8a[_0x539ee1(0x267)])),'periodInfo':{'from':_0x430108,'to':_0x1afc67,'periodType':_0x417da0[_0x539ee1(0x233)]||_0x539ee1(0x111),'daysCount':_0x243b4b}};return console[_0x539ee1(0x14b)]('üìä\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x539ee1(0x25d)+_0x1475ee[_0x539ee1(0x1a5)]+'\x20USDT'),console['log']('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x1475ee[_0x539ee1(0x275)]+_0x539ee1(0xe0)),console[_0x539ee1(0x14b)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x1475ee[_0x539ee1(0x219)]+_0x539ee1(0xe0)),console[_0x539ee1(0x14b)](_0x539ee1(0x197)+_0x1475ee['totalPaidOut']+_0x539ee1(0xe0)),console['log'](_0x539ee1(0x1de)+_0x1475ee[_0x539ee1(0x165)]+'\x20USDT'),console[_0x539ee1(0x14b)]('\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20'+_0x1475ee['totalPayments']),_0x1475ee;}async['getMerchantsSelection'](_0x54be64){const _0x7817e1=a50_0x22c744;console['log']('üìã\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x54be64});let _0x513985={};_0x54be64&&(_0x513985[_0x7817e1(0x13b)]={'some':{}});const _0x188e9a=await database_1[_0x7817e1(0x152)][_0x7817e1(0x124)][_0x7817e1(0x1c2)]({'where':_0x513985,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x7817e1(0x14b)](_0x7817e1(0xfe)+_0x188e9a[_0x7817e1(0x215)]+_0x7817e1(0x1c8)+(_0x54be64?'\x20with\x20payout\x20history':'')),_0x188e9a[_0x7817e1(0x145)](_0x22b4e0=>({'id':_0x22b4e0['id'],'username':_0x22b4e0[_0x7817e1(0x1d8)],'name':_0x22b4e0[_0x7817e1(0xbf)]}));}[a50_0x22c744(0x15b)](_0x1ded3a){const _0x45942f=a50_0x22c744,_0x2b8a10={'test_gateway':_0x45942f(0x201),'plisio':_0x45942f(0x1c3),'rapyd':_0x45942f(0x271),'noda':_0x45942f(0x1dd),'cointopay':'CoinToPay','cointopay2':_0x45942f(0xe2),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x45942f(0x11b),'klyme_de':_0x45942f(0x1e5),'mastercard':'MasterCard','visa/mastercard':_0x45942f(0x192),'amer':'Amer','myxspend':'MyXSpend','ampay':_0x45942f(0xec),'ampay_try':_0x45942f(0x106),'sepa':_0x45942f(0xf5),'interac':_0x45942f(0x122),'onramp':'OnRamp','squirrelpay':_0x45942f(0x244),'maxpara':'MaxPara','instaxchange':_0x45942f(0x1b0),'oxapay':_0x45942f(0x178)};return _0x2b8a10[_0x1ded3a]||_0x1ded3a;}['getGatewayInternalName'](_0x5dc7a2){const _0x56d3ad=a50_0x22c744,_0x3a543b={'Test\x20Gateway':_0x56d3ad(0x134),'Plisio':_0x56d3ad(0x150),'Rapyd':'rapyd','Noda':_0x56d3ad(0x113),'CoinToPay':'cointopay','CoinToPay2':_0x56d3ad(0x18f),'KLYME\x20EU':_0x56d3ad(0x248),'KLYME\x20GB':_0x56d3ad(0x1b9),'KLYME\x20DE':_0x56d3ad(0x131),'MasterCard':_0x56d3ad(0x247)};return _0x3a543b[_0x5dc7a2]||_0x5dc7a2[_0x56d3ad(0xd5)]();}async[a50_0x22c744(0x1b5)](_0x27f4be){const _0x135ba6=a50_0x22c744,{page:_0x15c1d6,limit:_0x406a6a,minAmount:_0x2c1f88,search:_0x5b9b6d}=_0x27f4be;console[_0x135ba6(0x14b)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x27f4be);let _0x4142b0={};_0x5b9b6d&&(_0x4142b0[_0x135ba6(0xbf)]={'contains':_0x5b9b6d,'mode':'insensitive'});const _0x57896c=await database_1[_0x135ba6(0x152)][_0x135ba6(0x124)][_0x135ba6(0x1c2)]({'where':_0x4142b0,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x1d3d97=_0x57896c['filter'](_0x5771ce=>{const _0x13c211=_0x135ba6,_0x1702b1=Math[_0x13c211(0x18a)](_0x5771ce[_0x13c211(0x127)]*0x64)/0x64;if(_0x2c1f88&&_0x1702b1<_0x2c1f88)return![];return _0x1702b1!==0x0;});_0x1d3d97[_0x135ba6(0x100)]((_0x1cefca,_0x2996d3)=>_0x2996d3[_0x135ba6(0x127)]-_0x1cefca[_0x135ba6(0x127)]);const _0x390dcc=_0x1d3d97['length'],_0x32deb9=(_0x15c1d6-0x1)*_0x406a6a,_0x2b2062=_0x1d3d97['slice'](_0x32deb9,_0x32deb9+_0x406a6a);console['log'](_0x135ba6(0x223)+_0x2b2062[_0x135ba6(0x215)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x4b1ac0=await Promise[_0x135ba6(0x25f)](_0x2b2062[_0x135ba6(0x145)](async _0x4a5d28=>{const _0x55acab=_0x135ba6,[_0x5d2e31,_0x495c5b,_0x195080]=await Promise[_0x55acab(0x25f)]([database_1['default'][_0x55acab(0xe5)][_0x55acab(0x1b7)]({'where':{'shopId':_0x4a5d28['id'],'status':_0x55acab(0xda),'gateway':{'not':'test_gateway'}}}),database_1[_0x55acab(0x152)][_0x55acab(0xe5)][_0x55acab(0x214)]({'where':{'shopId':_0x4a5d28['id'],'status':_0x55acab(0xda),'gateway':{'not':_0x55acab(0x134)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default'][_0x55acab(0xe5)]['groupBy']({'by':['gateway'],'where':{'shopId':_0x4a5d28['id'],'status':_0x55acab(0xda),'gateway':{'not':_0x55acab(0x134)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x492baf=new Date(),_0x28de7a=new Date(_0x492baf[_0x55acab(0x13f)](),_0x492baf['getMonth'](),0x1),_0x54f79d=new Date(_0x492baf[_0x55acab(0x13f)](),_0x492baf[_0x55acab(0x16e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x8a8ee2,_0xe4a764]=await Promise['all']([database_1[_0x55acab(0x152)][_0x55acab(0x17b)][_0x55acab(0x27c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4a5d28['id'],'status':_0x55acab(0x1ac)}}),database_1[_0x55acab(0x152)][_0x55acab(0x17b)][_0x55acab(0x27c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4a5d28['id'],'status':_0x55acab(0x1ac),'createdAt':{'gte':_0x28de7a,'lte':_0x54f79d}}})]),_0xcda471=_0x8a8ee2[_0x55acab(0x1a9)][_0x55acab(0x1a4)]||0x0,_0x12346a=_0xe4a764[_0x55acab(0x1a9)][_0x55acab(0x1a4)]||0x0,_0x3854ad=await Promise[_0x55acab(0x25f)](_0x195080['map'](async _0x5eacf9=>{const _0x516d04=_0x55acab;let _0x4192de=0x2d;if(_0x4a5d28['gatewaySettings'])try{const _0x3767c5=JSON[_0x516d04(0x1ea)](_0x4a5d28['gatewaySettings']);for(const [_0x595802,_0x10f171]of Object[_0x516d04(0xe3)](_0x3767c5)){if(_0x595802[_0x516d04(0xd5)]()===_0x5eacf9[_0x516d04(0x1f8)][_0x516d04(0xd5)]()){_0x4192de=_0x10f171['commission']||0xa,console[_0x516d04(0x14b)](_0x516d04(0x20d)+_0x5eacf9[_0x516d04(0x1f8)]+_0x516d04(0x16f)+_0x4a5d28['id']+_0x516d04(0x10c)+_0x4192de+'%');break;}}}catch(_0x99326e){console['error'](_0x516d04(0x193)+_0x4a5d28['id']+':',_0x99326e);}const _0x387552=_0x5eacf9['_sum']?.[_0x516d04(0x17d)]||0x0,_0x166417=_0x387552*(0x1-_0x4192de/0x64);return{'gateway':_0x5eacf9[_0x516d04(0x1f8)],'count':_0x5eacf9[_0x516d04(0x166)]?.['id']||0x0,'amountUSDT':Math[_0x516d04(0x12b)](_0x387552*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x516d04(0x12b)](_0x166417*0x64)/0x64,'commission':_0x4192de};})),_0x34f3ba=_0x3854ad[_0x55acab(0x10d)]((_0x2600bd,_0x223be7)=>_0x2600bd+_0x223be7['amountUSDT'],0x0),_0x59c052=_0x3854ad[_0x55acab(0x10d)]((_0x152ce5,_0x27bf77)=>_0x152ce5+_0x27bf77[_0x55acab(0x11f)],0x0),_0x4fe502=_0x4a5d28[_0x55acab(0x127)];return console[_0x55acab(0x14b)]('üí∞\x20[PAYOUT]\x20Merchant\x20'+_0x4a5d28[_0x55acab(0x1d8)]+':'),console[_0x55acab(0x14b)](_0x55acab(0x1e6)+_0x34f3ba[_0x55acab(0x190)](0x2)+_0x55acab(0x105)),console[_0x55acab(0x14b)](_0x55acab(0xb6)+_0x59c052[_0x55acab(0x190)](0x2)+_0x55acab(0x225)),console[_0x55acab(0x14b)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x4fe502[_0x55acab(0x190)](0x2)+_0x55acab(0x16d)),console[_0x55acab(0x14b)](_0x55acab(0x23c)+_0xcda471[_0x55acab(0x190)](0x2)+_0x55acab(0x161)),console[_0x55acab(0x14b)](_0x55acab(0x283)+(_0x59c052-_0xcda471-_0x4fe502)[_0x55acab(0x190)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x4a5d28['id'],'fullName':_0x4a5d28[_0x55acab(0xbf)],'username':_0x4a5d28[_0x55acab(0x1d8)],'telegramId':_0x4a5d28[_0x55acab(0x25e)],'merchantUrl':_0x4a5d28[_0x55acab(0x1a0)],'wallets':{'usdtPolygonWallet':_0x4a5d28[_0x55acab(0x1bd)],'usdtTrcWallet':_0x4a5d28[_0x55acab(0x26b)],'usdtErcWallet':_0x4a5d28[_0x55acab(0x224)],'usdcPolygonWallet':_0x4a5d28[_0x55acab(0x1b8)],'usdcErcWallet':_0x4a5d28['usdcErcWallet']},'totalAmountUSDT':Math['round'](_0x34f3ba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x55acab(0x12b)](_0x59c052*0x64)/0x64,'currentBalance':Math[_0x55acab(0x18a)](_0x4fe502*0x64)/0x64,'totalPayout':Math[_0x55acab(0x12b)](_0xcda471*0x64)/0x64,'thisMonth':Math[_0x55acab(0x12b)](_0x12346a*0x64)/0x64,'paymentsCount':_0x5d2e31,'oldestPaymentDate':_0x495c5b?.['paidAt']||_0x4a5d28['createdAt'],'gatewayBreakdown':_0x3854ad};})),_0x3fec20=_0x4b1ac0['reduce']((_0x32fc5d,_0x4bfb6e)=>_0x32fc5d+_0x4bfb6e[_0x135ba6(0x12c)],0x0),_0x1cf1ca=_0x4b1ac0[_0x135ba6(0x10d)]((_0x101e0a,_0x313171)=>_0x101e0a+_0x313171[_0x135ba6(0x238)],0x0),_0x42540f=_0x4b1ac0[_0x135ba6(0x10d)]((_0x5cd35b,_0x94e014)=>_0x5cd35b+_0x94e014[_0x135ba6(0x130)],0x0),_0x3f53c4=_0x4b1ac0[_0x135ba6(0x10d)]((_0x32bc76,_0x5f2bec)=>_0x32bc76+_0x5f2bec[_0x135ba6(0x230)],0x0);return console[_0x135ba6(0x14b)](_0x135ba6(0x1bb)+_0x390dcc+_0x135ba6(0xb8)),console['log']('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math[_0x135ba6(0x12b)](_0x3fec20*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console['log'](_0x135ba6(0x25b)+Math['round'](_0x1cf1ca*0x64)/0x64+_0x135ba6(0x20e)),console[_0x135ba6(0x14b)]('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math['round'](_0x42540f*0x64)/0x64+_0x135ba6(0xe0)),console[_0x135ba6(0x14b)](_0x135ba6(0x203)+Math[_0x135ba6(0x12b)](_0x3f53c4*0x64)/0x64+_0x135ba6(0xe0)),{'merchants':_0x4b1ac0,'pagination':{'page':_0x15c1d6,'limit':_0x406a6a,'total':_0x390dcc,'totalPages':Math['ceil'](_0x390dcc/_0x406a6a)},'summary':{'totalMerchants':_0x390dcc,'totalAmountUSDT':Math[_0x135ba6(0x12b)](_0x3fec20*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x135ba6(0x12b)](_0x1cf1ca*0x64)/0x64,'totalPayout':Math['round'](_0x42540f*0x64)/0x64,'thisMonth':Math[_0x135ba6(0x12b)](_0x3f53c4*0x64)/0x64}};}async[a50_0x22c744(0x191)](_0x4c35d1){const _0x5be1b1=a50_0x22c744,{shopId:_0x5aff8a,amount:_0x4cc9c5,network:_0x140a54,wallet:_0x106710,notes:_0xabecac,txid:_0x45de7e,periodFrom:_0x4ab5a4,periodTo:_0x250dc9}=_0x4c35d1,_0x42097b=await database_1[_0x5be1b1(0x152)]['$transaction'](async _0x1e399e=>{const _0x2cdb7e=_0x5be1b1,_0x1014b2=await _0x1e399e[_0x2cdb7e(0x124)][_0x2cdb7e(0x128)]({'where':{'id':_0x5aff8a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1014b2)throw new Error('Shop\x20not\x20found');console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x1f3)+_0x1014b2[_0x2cdb7e(0x1d8)]+':'),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x182)+_0x1014b2[_0x2cdb7e(0x127)]['toFixed'](0x6)+_0x2cdb7e(0xe0)),console['log'](_0x2cdb7e(0x236)+_0x4cc9c5[_0x2cdb7e(0x190)](0x6)+_0x2cdb7e(0xe0)),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0xd7)+_0x1014b2[_0x2cdb7e(0x104)][_0x2cdb7e(0x190)](0x6)+_0x2cdb7e(0xe0));if(_0x45de7e)console[_0x2cdb7e(0x14b)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x45de7e);const _0x349c2d=0.000001,_0x59914a=Number(_0x1014b2[_0x2cdb7e(0x127)]),_0x3f2a3a=Number(_0x4cc9c5);console['log']('üîç\x20Balance\x20check\x20details:'),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x27f)+_0x1014b2[_0x2cdb7e(0x127)]),console[_0x2cdb7e(0x14b)]('\x20\x20\x20Available\x20(number):\x20'+_0x59914a),console[_0x2cdb7e(0x14b)]('\x20\x20\x20Requested\x20(number):\x20'+_0x3f2a3a),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x17c)+(_0x59914a-_0x3f2a3a)),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x12f)+_0x349c2d);if(_0x59914a<_0x3f2a3a-_0x349c2d)throw new Error(_0x2cdb7e(0x1ca)+_0x59914a[_0x2cdb7e(0x190)](0x6)+_0x2cdb7e(0x1df)+_0x3f2a3a[_0x2cdb7e(0x190)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x59914a-_0x3f2a3a)[_0x2cdb7e(0x190)](0x8)+_0x2cdb7e(0xe0));console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x169));const _0x575edf=Math['min'](_0x59914a,_0x3f2a3a);let _0x495980=_0x106710;console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x25c)+(_0x106710||_0x2cdb7e(0xf8)));if(!_0x495980){console[_0x2cdb7e(0x14b)](_0x2cdb7e(0xf7));const _0x3a99d0=await _0x1e399e[_0x2cdb7e(0x124)][_0x2cdb7e(0x128)]({'where':{'id':_0x5aff8a},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x2cdb7e(0x14b)]('üîç\x20Shop\x20wallets:',_0x3a99d0);if(_0x3a99d0)switch(_0x140a54){case _0x2cdb7e(0xc7):_0x495980=_0x3a99d0[_0x2cdb7e(0x1bd)]||undefined,console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x189)+_0x495980);break;case _0x2cdb7e(0xc6):_0x495980=_0x3a99d0['usdtTrcWallet']||undefined,console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x1a2)+_0x495980);break;case _0x2cdb7e(0x12d):_0x495980=_0x3a99d0[_0x2cdb7e(0x224)]||undefined,console['log']('üîç\x20Selected\x20erc20\x20wallet:\x20'+_0x495980);break;case'polygon_usdc':_0x495980=_0x3a99d0['usdcPolygonWallet']||undefined,console['log'](_0x2cdb7e(0x158)+_0x495980);break;case _0x2cdb7e(0x149):_0x495980=_0x3a99d0['usdcErcWallet']||undefined,console['log']('üîç\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x495980);break;}}else console['log'](_0x2cdb7e(0x1b1)+_0x495980);console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x1e4)+_0x140a54+':\x20'+(_0x495980||'not\x20specified')),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0x137),{'shopId':_0x5aff8a,'amount':_0x575edf,'network':_0x140a54,'wallet':_0x495980,'status':'COMPLETED','txid':_0x45de7e,'notes':_0xabecac,'periodFrom':_0x4ab5a4?new Date(_0x4ab5a4):null,'periodTo':_0x250dc9?new Date(_0x250dc9):null});const _0x152ea1=await _0x1e399e[_0x2cdb7e(0x17b)][_0x2cdb7e(0xc2)]({'data':{'shopId':_0x5aff8a,'amount':_0x575edf,'network':_0x140a54,'wallet':_0x495980,'status':_0x2cdb7e(0x1ac),'txid':_0x45de7e,'notes':_0xabecac,'periodFrom':_0x4ab5a4?new Date(_0x4ab5a4):null,'periodTo':_0x250dc9?new Date(_0x250dc9):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x2cdb7e(0x14b)]('‚úÖ\x20Payout\x20created\x20in\x20DB:',{'id':_0x152ea1['id'],'wallet':_0x152ea1[_0x2cdb7e(0x114)],'network':_0x152ea1[_0x2cdb7e(0x24e)],'amount':_0x152ea1[_0x2cdb7e(0x1a4)]});const _0x4dff9e=_0x59914a-_0x575edf,_0x970465=Number(_0x1014b2[_0x2cdb7e(0x104)])+_0x575edf;return await _0x1e399e[_0x2cdb7e(0x124)]['update']({'where':{'id':_0x5aff8a},'data':{'balance':_0x4dff9e,'totalPaidOut':_0x970465}}),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0xb9)+_0x1014b2[_0x2cdb7e(0x1d8)]+_0x2cdb7e(0x1e2)),console[_0x2cdb7e(0x14b)](_0x2cdb7e(0xd6)+_0x59914a[_0x2cdb7e(0x190)](0x6)+'\x20->\x20'+_0x4dff9e[_0x2cdb7e(0x190)](0x6)+_0x2cdb7e(0x1ae)+_0x575edf[_0x2cdb7e(0x190)](0x6)+')'),console[_0x2cdb7e(0x14b)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x1014b2[_0x2cdb7e(0x104)][_0x2cdb7e(0x190)](0x6)+_0x2cdb7e(0x1b4)+_0x970465[_0x2cdb7e(0x190)](0x6)+_0x2cdb7e(0x23f)+_0x575edf[_0x2cdb7e(0x190)](0x6)+')'),console['log'](_0x2cdb7e(0x252)+_0x575edf['toFixed'](0x6)+_0x2cdb7e(0xe0)),{'payout':_0x152ea1,'shop':_0x1014b2};});console[_0x5be1b1(0x14b)](_0x5be1b1(0x1cb)+_0x42097b['payout']['id']+_0x5be1b1(0x16f)+_0x42097b[_0x5be1b1(0x124)]['username']+'\x20('+_0x42097b['payout']['amount']['toFixed'](0x6)+_0x5be1b1(0xb5));try{let _0xe96dfb=_0x5be1b1(0x243);if(_0x42097b[_0x5be1b1(0x17b)]['periodFrom']&&_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0xbb)]){const _0x4c87d9=new Date(_0x42097b[_0x5be1b1(0x17b)]['periodFrom'])['toLocaleDateString'](_0x5be1b1(0x279)),_0x8cbf5c=new Date(_0x42097b[_0x5be1b1(0x17b)]['periodTo'])['toLocaleDateString'](_0x5be1b1(0x279));_0xe96dfb=_0x4c87d9+_0x5be1b1(0xbd)+_0x8cbf5c;}await telegramBotService_1[_0x5be1b1(0x140)][_0x5be1b1(0x221)](_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0x26a)],{'id':_0x42097b[_0x5be1b1(0x17b)]['id'],'amount':_0x42097b['payout'][_0x5be1b1(0x1a4)],'network':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0x24e)],'wallet':_0x42097b['payout']['wallet'],'period':_0xe96dfb,'createdAt':_0x42097b['payout'][_0x5be1b1(0x20c)],'txid':_0x42097b[_0x5be1b1(0x17b)]['txid']}),console['log'](_0x5be1b1(0xbe)+_0x42097b[_0x5be1b1(0x17b)]['id']);}catch(_0x3ad00f){console[_0x5be1b1(0x151)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x42097b[_0x5be1b1(0x17b)]['id']+':',_0x3ad00f);}return{'id':_0x42097b['payout']['id'],'shopId':_0x42097b[_0x5be1b1(0x17b)]['shopId'],'shopName':_0x42097b[_0x5be1b1(0x124)][_0x5be1b1(0xbf)],'shopUsername':_0x42097b['shop'][_0x5be1b1(0x1d8)],'amount':_0x42097b['payout'][_0x5be1b1(0x1a4)],'network':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0x24e)],'wallet':_0x42097b['payout']['wallet'],'status':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0x1cd)],'txid':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0xcf)],'notes':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0x173)],'periodFrom':_0x42097b[_0x5be1b1(0x17b)]['periodFrom'],'periodTo':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0xbb)],'createdAt':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0x20c)],'paidAt':_0x42097b[_0x5be1b1(0x17b)][_0x5be1b1(0x15a)]};}async[a50_0x22c744(0x1f7)](_0x374880){const _0x483e4b=a50_0x22c744,{page:_0x79034f,limit:_0x2b9e28,shopId:_0x45d5ed,network:_0x24b5b8,dateFrom:_0x977b72,dateTo:_0x249ed6,search:_0x1df0f0}=_0x374880,_0x5cafc5=(_0x79034f-0x1)*_0x2b9e28,_0x314391={};_0x45d5ed&&(_0x314391['shopId']=_0x45d5ed);_0x24b5b8&&(_0x314391[_0x483e4b(0x24e)]=_0x24b5b8);if(_0x977b72||_0x249ed6){_0x314391[_0x483e4b(0x20c)]={};if(_0x977b72){const _0x20926a=new Date(_0x977b72);_0x20926a[_0x483e4b(0x207)](0x0,0x0,0x0,0x1),_0x314391[_0x483e4b(0x20c)][_0x483e4b(0x14a)]=_0x20926a,console[_0x483e4b(0x14b)](_0x483e4b(0x174)+_0x20926a[_0x483e4b(0x20f)]());}if(_0x249ed6){const _0x8bc27b=new Date(_0x249ed6);_0x8bc27b['setHours'](0x17,0x3b,0x3b,0x3e7),_0x314391['createdAt'][_0x483e4b(0xd2)]=_0x8bc27b,console[_0x483e4b(0x14b)](_0x483e4b(0x133)+_0x8bc27b[_0x483e4b(0x20f)]());}}_0x1df0f0&&(_0x314391['OR']=[{'shop':{'name':{'contains':_0x1df0f0,'mode':_0x483e4b(0x1f2)}}},{'shop':{'username':{'contains':_0x1df0f0,'mode':_0x483e4b(0x1f2)}}},{'notes':{'contains':_0x1df0f0,'mode':_0x483e4b(0x1f2)}}]);const [_0x540ac9,_0x2bef6b]=await Promise[_0x483e4b(0x25f)]([database_1[_0x483e4b(0x152)][_0x483e4b(0x17b)][_0x483e4b(0x1c2)]({'where':_0x314391,'skip':_0x5cafc5,'take':_0x2b9e28,'orderBy':{'createdAt':_0x483e4b(0x176)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x483e4b(0x152)][_0x483e4b(0x17b)][_0x483e4b(0x1b7)]({'where':_0x314391})]);return{'payouts':_0x540ac9[_0x483e4b(0x145)](_0x5ebab7=>({'id':_0x5ebab7['id'],'shopId':_0x5ebab7[_0x483e4b(0x26a)],'shopName':_0x5ebab7['shop'][_0x483e4b(0xbf)],'shopUsername':_0x5ebab7['shop'][_0x483e4b(0x1d8)],'amount':_0x5ebab7['amount'],'network':_0x5ebab7['network'],'wallet':_0x5ebab7[_0x483e4b(0x114)],'status':_0x5ebab7[_0x483e4b(0x1cd)],'txid':_0x5ebab7['txid'],'notes':_0x5ebab7[_0x483e4b(0x173)],'periodFrom':_0x5ebab7[_0x483e4b(0x164)],'periodTo':_0x5ebab7[_0x483e4b(0xbb)],'createdAt':_0x5ebab7[_0x483e4b(0x20c)],'paidAt':_0x5ebab7[_0x483e4b(0x15a)]})),'pagination':{'page':_0x79034f,'limit':_0x2b9e28,'total':_0x2bef6b,'totalPages':Math[_0x483e4b(0x277)](_0x2bef6b/_0x2b9e28)}};}async[a50_0x22c744(0x136)](_0x2f549c){const _0x4bdc14=a50_0x22c744,_0x480909=await database_1[_0x4bdc14(0x152)][_0x4bdc14(0x17b)][_0x4bdc14(0x128)]({'where':{'id':_0x2f549c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x480909)return null;return{'id':_0x480909['id'],'shopId':_0x480909[_0x4bdc14(0x26a)],'shopName':_0x480909[_0x4bdc14(0x124)][_0x4bdc14(0xbf)],'shopUsername':_0x480909[_0x4bdc14(0x124)][_0x4bdc14(0x1d8)],'amount':_0x480909[_0x4bdc14(0x1a4)],'network':_0x480909['network'],'wallet':_0x480909[_0x4bdc14(0x114)],'status':_0x480909[_0x4bdc14(0x1cd)],'txid':_0x480909[_0x4bdc14(0xcf)],'notes':_0x480909[_0x4bdc14(0x173)],'periodFrom':_0x480909['periodFrom'],'periodTo':_0x480909[_0x4bdc14(0xbb)],'createdAt':_0x480909['createdAt'],'paidAt':_0x480909[_0x4bdc14(0x15a)]};}async[a50_0x22c744(0xb7)](_0x4cfafc){const _0xc73071=a50_0x22c744;await database_1[_0xc73071(0x152)][_0xc73071(0x17b)]['delete']({'where':{'id':_0x4cfafc}});}async[a50_0x22c744(0x24a)](_0x5b0939,_0x2f3806){const _0x460ae2=a50_0x22c744,_0x214436=await database_1[_0x460ae2(0x152)][_0x460ae2(0x1f4)](async _0x53b39a=>{const _0x427a1f=_0x460ae2,_0x247e82=await _0x53b39a['payout'][_0x427a1f(0x128)]({'where':{'id':_0x5b0939},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x247e82)throw new Error('Payout\x20not\x20found');console[_0x427a1f(0x14b)]('üí∞\x20Updating\x20payout\x20'+_0x5b0939+_0x427a1f(0x16f)+_0x247e82['shop'][_0x427a1f(0x1d8)]+':'),console[_0x427a1f(0x14b)](_0x427a1f(0x276)+_0x247e82[_0x427a1f(0x1a4)][_0x427a1f(0x190)](0x6)+_0x427a1f(0xe0)),console[_0x427a1f(0x14b)](_0x427a1f(0x183)+_0x247e82[_0x427a1f(0x24e)]),console[_0x427a1f(0x14b)](_0x427a1f(0x22b)+_0x247e82['shop'][_0x427a1f(0x127)][_0x427a1f(0x190)](0x6)+_0x427a1f(0xe0)),console[_0x427a1f(0x14b)](_0x427a1f(0x16a)+_0x247e82[_0x427a1f(0x124)][_0x427a1f(0x104)]['toFixed'](0x6)+_0x427a1f(0xe0));let _0x37c590=0x0;if(_0x2f3806[_0x427a1f(0x1a4)]!==undefined){const _0x24e67d=Number(_0x247e82['amount']),_0x18f2be=Number(_0x2f3806[_0x427a1f(0x1a4)]);_0x37c590=_0x18f2be-_0x24e67d,console['log'](_0x427a1f(0x138)+_0x18f2be['toFixed'](0x6)+_0x427a1f(0xe0)),console[_0x427a1f(0x14b)](_0x427a1f(0x1a7)+_0x37c590[_0x427a1f(0x190)](0x6)+_0x427a1f(0xe0));if(_0x37c590<0x0)console['log'](_0x427a1f(0x22d)+Math['abs'](_0x37c590)[_0x427a1f(0x190)](0x6)+_0x427a1f(0x1eb));else{if(_0x37c590>0x0){const _0x3d4d7d=Number(_0x247e82[_0x427a1f(0x124)][_0x427a1f(0x127)]);console[_0x427a1f(0x14b)]('\x20\x20\x20Amount\x20increased\x20by\x20'+_0x37c590[_0x427a1f(0x190)](0x6)+_0x427a1f(0xce));if(_0x3d4d7d<_0x37c590)throw new Error(_0x427a1f(0x17e)+_0x3d4d7d['toFixed'](0x6)+'\x20USDT,\x20Required:\x20'+_0x37c590[_0x427a1f(0x190)](0x6)+_0x427a1f(0xe0));}}}const _0x20c62b={};if(_0x2f3806[_0x427a1f(0x1a4)]!==undefined)_0x20c62b['amount']=_0x2f3806[_0x427a1f(0x1a4)];if(_0x2f3806[_0x427a1f(0x24e)]!==undefined)_0x20c62b[_0x427a1f(0x24e)]=_0x2f3806[_0x427a1f(0x24e)];if(_0x2f3806[_0x427a1f(0x114)]!==undefined)_0x20c62b[_0x427a1f(0x114)]=_0x2f3806[_0x427a1f(0x114)]||null;if(_0x2f3806['notes']!==undefined)_0x20c62b[_0x427a1f(0x173)]=_0x2f3806[_0x427a1f(0x173)]||null;if(_0x2f3806['txid']!==undefined)_0x20c62b[_0x427a1f(0xcf)]=_0x2f3806[_0x427a1f(0xcf)]||null;if(_0x2f3806['periodFrom']!==undefined)_0x20c62b[_0x427a1f(0x164)]=_0x2f3806['periodFrom']?new Date(_0x2f3806['periodFrom']):null;if(_0x2f3806[_0x427a1f(0xbb)]!==undefined)_0x20c62b[_0x427a1f(0xbb)]=_0x2f3806['periodTo']?new Date(_0x2f3806[_0x427a1f(0xbb)]):null;const _0x2bbc5c=await _0x53b39a[_0x427a1f(0x17b)][_0x427a1f(0x208)]({'where':{'id':_0x5b0939},'data':_0x20c62b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x37c590!==0x0){const _0x308c2a=Number(_0x247e82[_0x427a1f(0x124)][_0x427a1f(0x127)]),_0x4274c3=Number(_0x247e82[_0x427a1f(0x124)]['totalPaidOut']),_0x45d0d1=_0x308c2a-_0x37c590,_0x135ba9=_0x4274c3+_0x37c590;await _0x53b39a[_0x427a1f(0x124)][_0x427a1f(0x208)]({'where':{'id':_0x247e82[_0x427a1f(0x26a)]},'data':{'balance':_0x45d0d1,'totalPaidOut':_0x135ba9}}),console[_0x427a1f(0x14b)]('üí∞\x20Shop\x20'+_0x247e82[_0x427a1f(0x124)][_0x427a1f(0x1d8)]+_0x427a1f(0x1e2)),console['log']('\x20\x20\x20Balance:\x20'+_0x308c2a[_0x427a1f(0x190)](0x6)+'\x20->\x20'+_0x45d0d1['toFixed'](0x6)+_0x427a1f(0xe0)),console[_0x427a1f(0x14b)](_0x427a1f(0x212)+_0x4274c3[_0x427a1f(0x190)](0x6)+_0x427a1f(0x1b4)+_0x135ba9['toFixed'](0x6)+'\x20USDT');}return console['log'](_0x427a1f(0x1a6)+_0x5b0939+_0x427a1f(0x21d)),_0x2bbc5c;});return{'id':_0x214436['id'],'shopId':_0x214436[_0x460ae2(0x26a)],'shopName':_0x214436[_0x460ae2(0x124)][_0x460ae2(0xbf)],'shopUsername':_0x214436['shop']['username'],'amount':Number(_0x214436[_0x460ae2(0x1a4)]),'network':_0x214436[_0x460ae2(0x24e)],'wallet':_0x214436[_0x460ae2(0x114)],'status':_0x214436[_0x460ae2(0x1cd)],'txid':_0x214436[_0x460ae2(0xcf)],'notes':_0x214436[_0x460ae2(0x173)],'periodFrom':_0x214436[_0x460ae2(0x164)],'periodTo':_0x214436[_0x460ae2(0xbb)],'createdAt':_0x214436[_0x460ae2(0x20c)],'paidAt':_0x214436[_0x460ae2(0x15a)]};}async[a50_0x22c744(0x108)](_0x37f41c){const _0x1c7250=a50_0x22c744,{page:_0x47b4a5,limit:_0x4978ad,status:_0x2b1ec5,gateway:_0x4b4deb,shopId:_0x4c5c09,dateFrom:_0x365772,dateTo:_0x54bb92,search:_0xbe5b7,currency:_0x29edbf,sortBy:_0x8d3c76,sortOrder:_0x5ec1ea}=_0x37f41c,_0x4b7787=(_0x47b4a5-0x1)*_0x4978ad;console[_0x1c7250(0x14b)](_0x1c7250(0x1d7),_0x37f41c);const _0x9a0a94=await database_1[_0x1c7250(0x152)][_0x1c7250(0xe5)][_0x1c7250(0x1ba)]({'by':[_0x1c7250(0x1f8)],'_count':{'gateway':!![]}});console['log'](_0x1c7250(0x264),_0x9a0a94[_0x1c7250(0x145)](_0x9c9936=>_0x9c9936[_0x1c7250(0x1f8)]+'\x20('+_0x9c9936[_0x1c7250(0x166)][_0x1c7250(0x1f8)]+_0x1c7250(0xe7)));if(_0x4b4deb){const _0x162ca7=_0x9a0a94['some'](_0x2f3853=>_0x2f3853[_0x1c7250(0x1f8)]['toLowerCase']()===_0x4b4deb[_0x1c7250(0xd5)]());!_0x162ca7&&_0x4b4deb['toLowerCase']()!==_0x1c7250(0x134)&&console[_0x1c7250(0x14b)](_0x1c7250(0x255)+_0x4b4deb+_0x1c7250(0x16c)+_0x9a0a94[_0x1c7250(0x145)](_0xac221b=>_0xac221b[_0x1c7250(0x1f8)])[_0x1c7250(0x107)](',\x20'));}const _0x1afd22={};_0x2b1ec5&&(_0x1afd22[_0x1c7250(0x1cd)]=_0x2b1ec5[_0x1c7250(0x120)]());if(!_0x4b4deb)_0x1afd22['gateway']={'not':'test_gateway'};else{if(_0x4b4deb&&(_0x4b4deb[_0x1c7250(0xd5)]()===_0x1c7250(0x134)||_0x4b4deb===_0x1c7250(0xe9)))_0x1afd22['gateway']=_0x1c7250(0x134);else{let _0x4c7e6a=_0x4b4deb;const _0x140f98=(0x0,gateway_1[_0x1c7250(0xef)])(_0x4b4deb);if(_0x140f98)_0x4c7e6a=_0x140f98,console[_0x1c7250(0x14b)](_0x1c7250(0x226)+_0x4b4deb+_0x1c7250(0x13d)+_0x4c7e6a+'\x27');else{const _0x9bc82d=(0x0,gateway_1[_0x1c7250(0x115)])(_0x4b4deb);if(_0x9bc82d){const _0x449318=(0x0,gateway_1[_0x1c7250(0xef)])(_0x9bc82d);_0x449318&&(_0x4c7e6a=_0x449318,console[_0x1c7250(0x14b)]('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0x4b4deb+_0x1c7250(0x11a)+_0x9bc82d+_0x1c7250(0xd0)+_0x4c7e6a+'\x27'));}else console[_0x1c7250(0x14b)]('üîç\x20Using\x20gateway\x20\x27'+_0x4b4deb+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x4d5c48=await database_1[_0x1c7250(0x152)][_0x1c7250(0xe5)][_0x1c7250(0x1b7)]({'where':{'gateway':_0x4c7e6a[_0x1c7250(0xd5)]()},'take':0x1});_0x4d5c48===0x0?(console[_0x1c7250(0x14b)]('‚ö†Ô∏è\x20Gateway\x20\x27'+_0x4c7e6a+_0x1c7250(0x23d)+_0x4b4deb+_0x1c7250(0x217)),_0x1afd22[_0x1c7250(0x1f8)]=_0x1c7250(0xf0)):(_0x1afd22[_0x1c7250(0x1f8)]=_0x4c7e6a[_0x1c7250(0xd5)](),console[_0x1c7250(0x14b)]('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0x4c7e6a+_0x1c7250(0x23d)+_0x4b4deb+'\x27)'));}}console['log'](_0x1c7250(0x1c5),_0x1afd22[_0x1c7250(0x1f8)]);_0x4c5c09&&(_0x1afd22['shopId']=_0x4c5c09);_0x29edbf&&(_0x1afd22[_0x1c7250(0x23e)]=_0x29edbf['toUpperCase'](),console['log'](_0x1c7250(0x1f1)+_0x29edbf['toUpperCase']()));if(_0x365772||_0x54bb92){_0x1afd22[_0x1c7250(0x20c)]={};if(_0x365772){const _0x5b43b8=new Date(_0x365772),_0x94cf9f=new Date(Date[_0x1c7250(0x194)](_0x5b43b8[_0x1c7250(0xfd)](),_0x5b43b8[_0x1c7250(0x250)](),_0x5b43b8[_0x1c7250(0x204)](),0x0,0x0,0x0,0x0));_0x1afd22[_0x1c7250(0x20c)][_0x1c7250(0x14a)]=_0x94cf9f,console['log'](_0x1c7250(0x101)+_0x94cf9f['toISOString']());}if(_0x54bb92){const _0x4b9791=new Date(_0x54bb92),_0x156424=new Date(Date[_0x1c7250(0x194)](_0x4b9791[_0x1c7250(0xfd)](),_0x4b9791['getUTCMonth'](),_0x4b9791[_0x1c7250(0x204)](),0x17,0x3b,0x3b,0x3e7));_0x1afd22[_0x1c7250(0x20c)][_0x1c7250(0xd2)]=_0x156424,console[_0x1c7250(0x14b)](_0x1c7250(0xbc)+_0x156424['toISOString']());}}_0xbe5b7&&(_0x1afd22['OR']=[{'id':{'contains':_0xbe5b7,'mode':_0x1c7250(0x1f2)}},{'orderId':{'contains':_0xbe5b7,'mode':_0x1c7250(0x1f2)}},{'gatewayOrderId':{'contains':_0xbe5b7,'mode':_0x1c7250(0x1f2)}},{'customerEmail':{'contains':_0xbe5b7,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xbe5b7,'mode':_0x1c7250(0x1f2)}}},{'shop':{'username':{'contains':_0xbe5b7,'mode':_0x1c7250(0x1f2)}}}]);console['log'](_0x1c7250(0x143),JSON[_0x1c7250(0x1cc)](_0x1afd22,null,0x2));const _0x311861=await database_1['default'][_0x1c7250(0xe5)][_0x1c7250(0x1b7)]({'where':_0x1afd22});console[_0x1c7250(0x14b)]('üîç\x20Total\x20payments\x20matching\x20filters:\x20'+_0x311861);let _0x273fe3={'createdAt':'desc'};if(_0x8d3c76){const _0xbbd970=[_0x1c7250(0x1a4),_0x1c7250(0x20c),_0x1c7250(0x186),_0x1c7250(0x1cd),_0x1c7250(0x1f8),_0x1c7250(0x23e)],_0x1023d5=['asc','desc'];if(_0xbbd970['includes'](_0x8d3c76)){const _0x30f5e1=_0x1023d5[_0x1c7250(0x1ab)](_0x5ec1ea)?_0x5ec1ea:'desc';_0x273fe3={[_0x8d3c76]:_0x30f5e1},console[_0x1c7250(0x14b)]('üìä\x20Sorting\x20payments\x20by\x20'+_0x8d3c76+_0x1c7250(0x231)+_0x30f5e1+_0x1c7250(0x241));}}const [_0x250a01,_0x410fae]=await Promise['all']([database_1[_0x1c7250(0x152)][_0x1c7250(0xe5)][_0x1c7250(0x1c2)]({'where':_0x1afd22,'skip':_0x4b7787,'take':_0x4978ad,'orderBy':_0x273fe3,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1c7250(0x152)]['payment'][_0x1c7250(0x1b7)]({'where':_0x1afd22})]);let _0x440b3c,_0x9637cc;if(_0x365772){const _0x2c02a1=new Date(_0x365772);_0x440b3c=new Date(Date[_0x1c7250(0x194)](_0x2c02a1[_0x1c7250(0xfd)](),_0x2c02a1['getUTCMonth'](),_0x2c02a1['getUTCDate'](),0x0,0x0,0x0,0x0));}else{const _0x34f7d6=new Date();_0x440b3c=new Date(Date['UTC'](_0x34f7d6[_0x1c7250(0xfd)](),_0x34f7d6[_0x1c7250(0x250)](),_0x34f7d6[_0x1c7250(0x204)](),0x0,0x0,0x0,0x0));}if(_0x54bb92){const _0x1a3ec8=new Date(_0x54bb92);_0x9637cc=new Date(Date[_0x1c7250(0x194)](_0x1a3ec8['getUTCFullYear'](),_0x1a3ec8[_0x1c7250(0x250)](),_0x1a3ec8['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x365772){const _0x4cf990=new Date(_0x365772);_0x9637cc=new Date(Date[_0x1c7250(0x194)](_0x4cf990[_0x1c7250(0xfd)](),_0x4cf990[_0x1c7250(0x250)](),_0x4cf990[_0x1c7250(0x204)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x116955=new Date();_0x9637cc=new Date(Date[_0x1c7250(0x194)](_0x116955[_0x1c7250(0xfd)](),_0x116955[_0x1c7250(0x250)](),_0x116955['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}const _0x31a0b7={};if(_0x2b1ec5&&_0x2b1ec5[_0x1c7250(0x120)]()!==_0x1c7250(0xda))console[_0x1c7250(0x14b)](_0x1c7250(0x1f9));else{const _0x38be37={'status':'PAID','createdAt':{'gte':_0x440b3c,'lte':_0x9637cc}};_0x4b4deb?_0x38be37[_0x1c7250(0x1f8)]=_0x1afd22[_0x1c7250(0x1f8)]:_0x38be37[_0x1c7250(0x1f8)]={'not':_0x1c7250(0x134)};_0x4c5c09&&(_0x38be37[_0x1c7250(0x26a)]=_0x4c5c09);_0x29edbf&&(_0x38be37['currency']=_0x29edbf['toUpperCase']());console[_0x1c7250(0x14b)](_0x1c7250(0x259),JSON['stringify'](_0x38be37,null,0x2));const _0x11f861=await database_1['default'][_0x1c7250(0xe5)][_0x1c7250(0x1c2)]({'where':_0x38be37,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x17f970=0x0;_0x11f861['forEach'](_0x3f18fa=>{const _0x429a8f=_0x1c7250;_0x3f18fa['amountUSDT']&&(_0x17f970+=_0x3f18fa[_0x429a8f(0x17d)]);if(_0x3f18fa['currency']){const _0x48ec2c=_0x3f18fa[_0x429a8f(0x23e)][_0x429a8f(0x120)]();!_0x31a0b7[_0x48ec2c]&&(_0x31a0b7[_0x48ec2c]=0x0),_0x31a0b7[_0x48ec2c]+=_0x3f18fa[_0x429a8f(0x1a4)];}}),_0x17f970>0x0&&(_0x31a0b7['USDT']=_0x17f970);}return{'payments':_0x250a01,'pagination':{'page':_0x47b4a5,'limit':_0x4978ad,'total':_0x410fae,'totalPages':Math[_0x1c7250(0x277)](_0x410fae/_0x4978ad)},'statistics':_0x31a0b7};}async[a50_0x22c744(0x205)](_0x28f32a){const _0x1d9268=a50_0x22c744,_0x32404e=await database_1['default'][_0x1d9268(0xe5)][_0x1d9268(0x128)]({'where':{'id':_0x28f32a},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x32404e)return null;return{'id':_0x32404e['id'],'shopId':_0x32404e[_0x1d9268(0x26a)],'gateway':_0x32404e[_0x1d9268(0x1f8)],'amount':_0x32404e['amount'],'currency':_0x32404e[_0x1d9268(0x23e)],'status':_0x32404e[_0x1d9268(0x1cd)],'orderId':_0x32404e['orderId'],'gatewayOrderId':_0x32404e[_0x1d9268(0x274)],'customerEmail':_0x32404e[_0x1d9268(0x103)],'customerName':_0x32404e[_0x1d9268(0x253)],'customerCountry':_0x32404e[_0x1d9268(0x234)],'customerIp':_0x32404e[_0x1d9268(0x246)],'customerUa':_0x32404e[_0x1d9268(0x227)],'failureMessage':_0x32404e[_0x1d9268(0x1fb)],'externalPaymentUrl':_0x32404e['externalPaymentUrl'],'successUrl':_0x32404e[_0x1d9268(0xf2)],'failUrl':_0x32404e['failUrl'],'pendingUrl':_0x32404e[_0x1d9268(0x282)],'whiteUrl':_0x32404e[_0x1d9268(0x286)],'createdAt':_0x32404e['createdAt'],'updatedAt':_0x32404e[_0x1d9268(0x186)],'shop':_0x32404e['shop']};}async['updatePaymentStatus'](_0x552672,_0xd0285,_0x113a25,_0x3bbe68){const _0x100b5e=a50_0x22c744,_0x4de711=await database_1[_0x100b5e(0x152)][_0x100b5e(0x1f4)](async _0x47c275=>{const _0x351f7b=_0x100b5e,_0x7d9b19=await _0x47c275[_0x351f7b(0xe5)][_0x351f7b(0x128)]({'where':{'id':_0x552672},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x7d9b19)throw new Error(_0x351f7b(0x1bf));const _0x1f0e0f=_0x7d9b19[_0x351f7b(0x1cd)],_0x5cda01=_0xd0285['toUpperCase']();console['log'](_0x351f7b(0xde)+_0x552672+_0x351f7b(0xf6)+_0x1f0e0f+_0x351f7b(0x1b4)+_0x5cda01),console[_0x351f7b(0x14b)](_0x351f7b(0x157)+_0x7d9b19[_0x351f7b(0x124)][_0x351f7b(0x127)]+_0x351f7b(0xe0));const _0x2e2ba0={'status':_0x5cda01,'updatedAt':new Date(),'statusChangedBy':_0x351f7b(0xd9),'statusChangedAt':new Date()};_0x113a25&&(_0x2e2ba0[_0x351f7b(0xc1)]=_0x113a25);_0x5cda01===_0x351f7b(0x245)&&_0x3bbe68&&(_0x2e2ba0[_0x351f7b(0x125)]=_0x3bbe68);let _0x55bfe7=0x0,_0x322213=_0x7d9b19[_0x351f7b(0x124)][_0x351f7b(0x127)];if(_0x5cda01==='PAID'&&_0x1f0e0f!=='PAID'){_0x2e2ba0[_0x351f7b(0x15a)]=new Date();const _0x50d6fa=await currencyService_1[_0x351f7b(0xfa)][_0x351f7b(0x1ef)](_0x7d9b19[_0x351f7b(0x1a4)],_0x7d9b19[_0x351f7b(0x23e)]);_0x2e2ba0[_0x351f7b(0x17d)]=_0x50d6fa;let _0x41bdd9=0x2d;const _0x24c13d=await _0x47c275[_0x351f7b(0x124)][_0x351f7b(0x128)]({'where':{'id':_0x7d9b19[_0x351f7b(0x26a)]},'select':{'gatewaySettings':!![]}});if(_0x24c13d?.[_0x351f7b(0x17f)])try{const _0x2d35e6=JSON[_0x351f7b(0x1ea)](_0x24c13d[_0x351f7b(0x17f)]);for(const [_0x46c2e9,_0x5b54b3]of Object['entries'](_0x2d35e6)){if(_0x46c2e9['toLowerCase']()===_0x7d9b19[_0x351f7b(0x1f8)][_0x351f7b(0xd5)]()){_0x41bdd9=_0x5b54b3[_0x351f7b(0x1af)]||0xa;break;}}}catch(_0x56aa09){console[_0x351f7b(0x151)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x552672+':',_0x56aa09);}let _0x3f6d42;_0x7d9b19[_0x351f7b(0x24c)]!==null&&_0x7d9b19[_0x351f7b(0x24c)]!==undefined?(_0x3f6d42=_0x7d9b19['amountAfterGatewayCommissionUSDT'],console[_0x351f7b(0x14b)](_0x351f7b(0x270)+_0x3f6d42[_0x351f7b(0x190)](0x6)+_0x351f7b(0x1e0)+_0x552672)):(_0x3f6d42=_0x50d6fa*(0x1-_0x41bdd9/0x64),console[_0x351f7b(0x14b)](_0x351f7b(0x237)+_0x552672+':\x20'+_0x41bdd9+_0x351f7b(0x1ff)+_0x50d6fa[_0x351f7b(0x190)](0x6)+_0x351f7b(0xe0)),_0x2e2ba0[_0x351f7b(0x24c)]=_0x3f6d42,_0x2e2ba0['gatewayCommissionRate']=_0x41bdd9),_0x55bfe7=_0x3f6d42,_0x322213+=_0x3f6d42,console[_0x351f7b(0x14b)]('üí∞\x20Payment\x20'+_0x552672+_0x351f7b(0x18d)),console[_0x351f7b(0x14b)](_0x351f7b(0x24f)+_0x50d6fa['toFixed'](0x6)+_0x351f7b(0xe0)),console[_0x351f7b(0x14b)](_0x351f7b(0x213)+_0x7d9b19[_0x351f7b(0x1f8)]+_0x351f7b(0x229)+_0x41bdd9+'%'),console[_0x351f7b(0x14b)](_0x351f7b(0x12a)+_0x3f6d42['toFixed'](0x6)+_0x351f7b(0xf4)+_0x41bdd9+_0x351f7b(0x118)),console[_0x351f7b(0x14b)](_0x351f7b(0x1c4)+_0x3f6d42['toFixed'](0x6)+_0x351f7b(0xe0));}else{if(_0x1f0e0f==='PAID'&&_0x5cda01!==_0x351f7b(0xda)&&_0x5cda01!=='CHARGEBACK'){if(_0x7d9b19[_0x351f7b(0x17d)]){let _0x519c61=0x2d;const _0xaa9895=await _0x47c275[_0x351f7b(0x124)][_0x351f7b(0x128)]({'where':{'id':_0x7d9b19[_0x351f7b(0x26a)]},'select':{'gatewaySettings':!![]}});if(_0xaa9895?.['gatewaySettings'])try{const _0x30ae13=JSON['parse'](_0xaa9895['gatewaySettings']);for(const [_0x1a83b6,_0x3524a1]of Object[_0x351f7b(0xe3)](_0x30ae13)){if(_0x1a83b6[_0x351f7b(0xd5)]()===_0x7d9b19[_0x351f7b(0x1f8)][_0x351f7b(0xd5)]()){_0x519c61=_0x3524a1[_0x351f7b(0x1af)]||0xa;break;}}}catch(_0x87f00d){console[_0x351f7b(0x151)](_0x351f7b(0x27d)+_0x552672+':',_0x87f00d);}const _0x25f8f7=_0x7d9b19[_0x351f7b(0x17d)]*(0x1-_0x519c61/0x64);_0x55bfe7=-_0x25f8f7,_0x322213-=_0x25f8f7,console[_0x351f7b(0x14b)](_0x351f7b(0x24f)+_0x7d9b19['amountUSDT'][_0x351f7b(0x190)](0x6)+'\x20USDT'),console[_0x351f7b(0x14b)]('\x20\x20\x20Gateway:\x20'+_0x7d9b19[_0x351f7b(0x1f8)]+_0x351f7b(0x229)+_0x519c61+'%'),console[_0x351f7b(0x14b)](_0x351f7b(0x284)+_0x25f8f7[_0x351f7b(0x190)](0x6)+_0x351f7b(0xf4)+_0x519c61+_0x351f7b(0x118)),console[_0x351f7b(0x14b)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x25f8f7[_0x351f7b(0x190)](0x6)+_0x351f7b(0xe0));}}}_0x5cda01===_0x351f7b(0x245)&&(console[_0x351f7b(0x14b)](_0x351f7b(0x21f)),_0x3bbe68&&_0x3bbe68>0x0?(_0x55bfe7=-_0x3bbe68,_0x322213-=_0x3bbe68,console['log'](_0x351f7b(0x1a3)+_0x3bbe68[_0x351f7b(0x190)](0x6)+'\x20USDT\x20from\x20balance'),console[_0x351f7b(0x14b)](_0x351f7b(0x1da))):console[_0x351f7b(0x14b)]('‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x2e2ba0['chargebackAmount']=_0x3bbe68||0x0);_0x5cda01===_0x351f7b(0x119)&&_0x1f0e0f===_0x351f7b(0xda)&&console[_0x351f7b(0x14b)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x1215b2=await _0x47c275['payment'][_0x351f7b(0x208)]({'where':{'id':_0x552672},'data':_0x2e2ba0,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x55bfe7!==0x0&&(await _0x47c275[_0x351f7b(0x124)][_0x351f7b(0x208)]({'where':{'id':_0x7d9b19[_0x351f7b(0x26a)]},'data':{'balance':_0x322213}}),console['log'](_0x351f7b(0xb9)+_0x7d9b19[_0x351f7b(0x26a)]+'\x20balance\x20updated:\x20'+_0x7d9b19[_0x351f7b(0x124)]['balance'][_0x351f7b(0x190)](0x6)+_0x351f7b(0x1b4)+_0x322213[_0x351f7b(0x190)](0x6)+'\x20USDT\x20('+(_0x55bfe7>0x0?'+':'')+_0x55bfe7[_0x351f7b(0x190)](0x6)+')')),_0x1215b2;});return{'id':_0x4de711['id'],'shopId':_0x4de711[_0x100b5e(0x26a)],'gateway':_0x4de711['gateway'],'amount':_0x4de711[_0x100b5e(0x1a4)],'currency':_0x4de711[_0x100b5e(0x23e)],'status':_0x4de711[_0x100b5e(0x1cd)],'orderId':_0x4de711[_0x100b5e(0xeb)],'gatewayOrderId':_0x4de711['gatewayOrderId'],'customerEmail':_0x4de711[_0x100b5e(0x103)],'customerName':_0x4de711[_0x100b5e(0x253)],'customerCountry':_0x4de711[_0x100b5e(0x234)],'customerIp':_0x4de711[_0x100b5e(0x246)],'customerUa':_0x4de711[_0x100b5e(0x227)],'failureMessage':_0x4de711[_0x100b5e(0x1fb)],'adminNotes':_0x4de711[_0x100b5e(0xc1)],'chargebackAmount':_0x4de711[_0x100b5e(0x125)],'statusChangedBy':_0x4de711['statusChangedBy'],'statusChangedAt':_0x4de711[_0x100b5e(0x1bc)],'createdAt':_0x4de711[_0x100b5e(0x20c)],'updatedAt':_0x4de711['updatedAt'],'shop':_0x4de711[_0x100b5e(0x124)]};}async['updateUser'](_0x13343f,_0x231d61){const _0x4b3455=a50_0x22c744,_0x357146=Math[_0x4b3455(0x1e8)]()[_0x4b3455(0x273)](0x24)[_0x4b3455(0x1d4)](0x2,0x9);console[_0x4b3455(0x14b)](_0x4b3455(0xc5)+_0x357146+_0x4b3455(0x222)+_0x13343f);const _0x477474={..._0x231d61};_0x231d61['password']&&_0x231d61['password'][_0x4b3455(0x1db)]()!==''?(console[_0x4b3455(0x14b)](_0x4b3455(0x266)+_0x357146+_0x4b3455(0x170)+_0x13343f),_0x477474[_0x4b3455(0x185)]=await bcryptjs_1['default'][_0x4b3455(0x27b)](_0x231d61[_0x4b3455(0x185)],0xc)):(console[_0x4b3455(0x14b)]('üîê\x20['+_0x357146+_0x4b3455(0x18e)),delete _0x477474[_0x4b3455(0x185)]);_0x231d61['fullName']&&(_0x477474['name']=_0x231d61[_0x4b3455(0x228)],delete _0x477474[_0x4b3455(0x228)]);_0x231d61[_0x4b3455(0x14c)]&&(_0x477474['telegram']=_0x231d61[_0x4b3455(0x14c)],delete _0x477474['telegramId']);_0x231d61[_0x4b3455(0x1b3)]&&(_0x477474[_0x4b3455(0x1a0)]=_0x231d61[_0x4b3455(0x1b3)],delete _0x477474['merchantUrl']);if(_0x231d61['gateways']){const _0x26a945=_0x231d61[_0x4b3455(0xcb)][_0x4b3455(0x145)](_0x47f15b=>this['getGatewayInternalName'](_0x47f15b));console[_0x4b3455(0x14b)]('üîÑ\x20Gateway\x20mapping:',_0x231d61[_0x4b3455(0xcb)],'->',_0x26a945),_0x477474['paymentGateways']=JSON[_0x4b3455(0x1cc)](_0x26a945),delete _0x477474['gateways'];}_0x231d61['gatewaySettings']&&(console[_0x4b3455(0x14b)](_0x4b3455(0xc0)+_0x357146+']\x20Gateway\x20settings\x20before\x20saving:',_0x231d61['gatewaySettings']),_0x477474[_0x4b3455(0x17f)]=JSON[_0x4b3455(0x1cc)](_0x231d61['gatewaySettings']),console[_0x4b3455(0x14b)]('üîß\x20['+_0x357146+']\x20Gateway\x20settings\x20JSON\x20string:',_0x477474['gatewaySettings']));_0x231d61[_0x4b3455(0x15f)]&&(_0x231d61[_0x4b3455(0x15f)][_0x4b3455(0x1bd)]!==undefined&&(_0x477474[_0x4b3455(0x1bd)]=_0x231d61['wallets'][_0x4b3455(0x1bd)]||null),_0x231d61['wallets'][_0x4b3455(0x26b)]!==undefined&&(_0x477474[_0x4b3455(0x26b)]=_0x231d61['wallets'][_0x4b3455(0x26b)]||null),_0x231d61[_0x4b3455(0x15f)][_0x4b3455(0x224)]!==undefined&&(_0x477474[_0x4b3455(0x224)]=_0x231d61['wallets'][_0x4b3455(0x224)]||null),_0x231d61[_0x4b3455(0x15f)][_0x4b3455(0x1b8)]!==undefined&&(_0x477474[_0x4b3455(0x1b8)]=_0x231d61[_0x4b3455(0x15f)]['usdcPolygonWallet']||null),delete _0x477474[_0x4b3455(0x15f)]);const _0x5a025b=await database_1['default'][_0x4b3455(0x124)][_0x4b3455(0x208)]({'where':{'id':_0x13343f},'data':_0x477474,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4b3455(0x14b)](_0x4b3455(0x177)+_0x357146+_0x4b3455(0x14f),_0x5a025b['gatewaySettings']),{'id':_0x5a025b['id'],'fullName':_0x5a025b[_0x4b3455(0xbf)],'username':_0x5a025b[_0x4b3455(0x1d8)],'telegramId':_0x5a025b[_0x4b3455(0x25e)],'merchantUrl':_0x5a025b[_0x4b3455(0x1a0)],'gateways':_0x5a025b[_0x4b3455(0x206)]?JSON['parse'](_0x5a025b[_0x4b3455(0x206)]):null,'gatewaySettings':_0x5a025b[_0x4b3455(0x17f)]?JSON[_0x4b3455(0x1ea)](_0x5a025b[_0x4b3455(0x17f)]):null,'publicKey':_0x5a025b[_0x4b3455(0x1cf)],'wallets':{'usdtPolygonWallet':_0x5a025b[_0x4b3455(0x1bd)],'usdtTrcWallet':_0x5a025b[_0x4b3455(0x26b)],'usdtErcWallet':_0x5a025b['usdtErcWallet'],'usdcPolygonWallet':_0x5a025b[_0x4b3455(0x1b8)]},'status':_0x5a025b[_0x4b3455(0x1cd)],'createdAt':_0x5a025b['createdAt']};}async[a50_0x22c744(0x163)](_0x1fdb3e){const _0x5c08fa=a50_0x22c744,_0x268877=await database_1[_0x5c08fa(0x152)][_0x5c08fa(0x124)][_0x5c08fa(0x208)]({'where':{'id':_0x1fdb3e},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x268877['id'],'fullName':_0x268877['name'],'username':_0x268877[_0x5c08fa(0x1d8)],'telegramId':_0x268877['telegram'],'merchantUrl':_0x268877['shopUrl'],'gateways':_0x268877[_0x5c08fa(0x206)]?JSON[_0x5c08fa(0x1ea)](_0x268877[_0x5c08fa(0x206)]):null,'gatewaySettings':_0x268877[_0x5c08fa(0x17f)]?JSON[_0x5c08fa(0x1ea)](_0x268877[_0x5c08fa(0x17f)]):null,'publicKey':_0x268877[_0x5c08fa(0x1cf)],'wallets':{'usdtPolygonWallet':_0x268877[_0x5c08fa(0x1bd)],'usdtTrcWallet':_0x268877[_0x5c08fa(0x26b)],'usdtErcWallet':_0x268877['usdtErcWallet'],'usdcPolygonWallet':_0x268877[_0x5c08fa(0x1b8)]},'status':_0x268877[_0x5c08fa(0x1cd)],'createdAt':_0x268877[_0x5c08fa(0x20c)]};}async[a50_0x22c744(0xee)](_0x1c47ed){const _0x572aae=a50_0x22c744,_0x35ffe=await database_1[_0x572aae(0x152)][_0x572aae(0x124)]['update']({'where':{'id':_0x1c47ed},'data':{'status':_0x572aae(0x132)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x35ffe['id'],'fullName':_0x35ffe[_0x572aae(0xbf)],'username':_0x35ffe['username'],'telegramId':_0x35ffe[_0x572aae(0x25e)],'merchantUrl':_0x35ffe[_0x572aae(0x1a0)],'gateways':_0x35ffe['paymentGateways']?JSON[_0x572aae(0x1ea)](_0x35ffe['paymentGateways']):null,'gatewaySettings':_0x35ffe[_0x572aae(0x17f)]?JSON[_0x572aae(0x1ea)](_0x35ffe[_0x572aae(0x17f)]):null,'publicKey':_0x35ffe['publicKey'],'wallets':{'usdtPolygonWallet':_0x35ffe[_0x572aae(0x1bd)],'usdtTrcWallet':_0x35ffe['usdtTrcWallet'],'usdtErcWallet':_0x35ffe[_0x572aae(0x224)],'usdcPolygonWallet':_0x35ffe['usdcPolygonWallet']},'status':_0x35ffe[_0x572aae(0x1cd)],'createdAt':_0x35ffe[_0x572aae(0x20c)]};}async['getAllUsers'](_0x482e51){const _0x566aec=a50_0x22c744,{page:_0x432874,limit:_0x23a0cb,status:_0x2146e3,search:_0x10e229}=_0x482e51,_0x9aedb9=(_0x432874-0x1)*_0x23a0cb,_0x47f427={};_0x2146e3&&(_0x47f427[_0x566aec(0x1cd)]=_0x2146e3['toUpperCase']());_0x10e229&&(_0x47f427['OR']=[{'name':{'contains':_0x10e229,'mode':_0x566aec(0x1f2)}},{'username':{'contains':_0x10e229,'mode':_0x566aec(0x1f2)}},{'telegram':{'contains':_0x10e229,'mode':_0x566aec(0x1f2)}},{'shopUrl':{'contains':_0x10e229,'mode':_0x566aec(0x1f2)}}]);const [_0x282bff,_0x445e98]=await Promise['all']([database_1[_0x566aec(0x152)][_0x566aec(0x124)]['findMany']({'where':_0x47f427,'skip':_0x9aedb9,'take':_0x23a0cb,'orderBy':{'createdAt':_0x566aec(0x176)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x566aec(0x152)][_0x566aec(0x124)][_0x566aec(0x1b7)]({'where':_0x47f427})]);return{'users':_0x282bff[_0x566aec(0x145)](_0x29b1f8=>{const _0xa648cf=_0x566aec,_0x841a26=_0x29b1f8[_0xa648cf(0x206)]?JSON[_0xa648cf(0x1ea)](_0x29b1f8[_0xa648cf(0x206)]):null,_0x3c0978=_0x841a26?_0x841a26[_0xa648cf(0x145)](_0x4b88ca=>this[_0xa648cf(0x15b)](_0x4b88ca)):null;return{'id':_0x29b1f8['id'],'fullName':_0x29b1f8[_0xa648cf(0xbf)],'username':_0x29b1f8[_0xa648cf(0x1d8)],'telegramId':_0x29b1f8[_0xa648cf(0x25e)],'merchantUrl':_0x29b1f8[_0xa648cf(0x1a0)],'gateways':_0x3c0978,'gatewaySettings':_0x29b1f8[_0xa648cf(0x17f)]?JSON[_0xa648cf(0x1ea)](_0x29b1f8['gatewaySettings']):null,'publicKey':_0x29b1f8[_0xa648cf(0x1cf)],'wallets':{'usdtPolygonWallet':_0x29b1f8[_0xa648cf(0x1bd)],'usdtTrcWallet':_0x29b1f8[_0xa648cf(0x26b)],'usdtErcWallet':_0x29b1f8[_0xa648cf(0x224)],'usdcPolygonWallet':_0x29b1f8[_0xa648cf(0x1b8)],'usdcErcWallet':_0x29b1f8['usdcErcWallet']},'status':_0x29b1f8[_0xa648cf(0x1cd)],'twoFactorEnabled':_0x29b1f8[_0xa648cf(0xe4)]||![],'telegramUsersCount':_0x29b1f8[_0xa648cf(0x166)][_0xa648cf(0x126)],'createdAt':_0x29b1f8['createdAt'],'lastLoginAt':_0x29b1f8[_0xa648cf(0x23a)]};}),'pagination':{'page':_0x432874,'limit':_0x23a0cb,'total':_0x445e98,'totalPages':Math['ceil'](_0x445e98/_0x23a0cb)}};}async['getUserById'](_0x3e564f){const _0x5f3d75=a50_0x22c744,_0x141dc9=await database_1[_0x5f3d75(0x152)]['shop'][_0x5f3d75(0x128)]({'where':{'id':_0x3e564f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x141dc9)return null;const _0x4fa545=_0x141dc9['paymentGateways']?JSON[_0x5f3d75(0x1ea)](_0x141dc9[_0x5f3d75(0x206)]):null,_0x2aa340=_0x4fa545?_0x4fa545[_0x5f3d75(0x145)](_0x5e4d83=>this[_0x5f3d75(0x15b)](_0x5e4d83)):null;return _0x4fa545&&_0x2aa340&&console[_0x5f3d75(0x14b)](_0x5f3d75(0x155),_0x4fa545,'->',_0x2aa340),{'id':_0x141dc9['id'],'fullName':_0x141dc9[_0x5f3d75(0xbf)],'username':_0x141dc9['username'],'telegramId':_0x141dc9['telegram'],'merchantUrl':_0x141dc9[_0x5f3d75(0x1a0)],'gateways':_0x2aa340,'gatewaySettings':_0x141dc9[_0x5f3d75(0x17f)]?JSON[_0x5f3d75(0x1ea)](_0x141dc9[_0x5f3d75(0x17f)]):null,'publicKey':_0x141dc9[_0x5f3d75(0x1cf)],'wallets':{'usdtPolygonWallet':_0x141dc9[_0x5f3d75(0x1bd)],'usdtTrcWallet':_0x141dc9[_0x5f3d75(0x26b)],'usdtErcWallet':_0x141dc9[_0x5f3d75(0x224)],'usdcPolygonWallet':_0x141dc9[_0x5f3d75(0x1b8)],'usdcErcWallet':_0x141dc9[_0x5f3d75(0x278)]},'status':_0x141dc9[_0x5f3d75(0x1cd)],'createdAt':_0x141dc9[_0x5f3d75(0x20c)]};}async[a50_0x22c744(0x210)](_0x13684e){const _0x4b035c=a50_0x22c744,{fullName:_0xf9aa80,username:_0x46f51c,password:_0x1b11e8,telegramId:_0x5dbe45,merchantUrl:_0x1bb5fd,gateways:_0x11776d,gatewaySettings:_0x60cfa8,wallets:_0x273691}=_0x13684e,_0x2fde65=await database_1[_0x4b035c(0x152)]['shop'][_0x4b035c(0x128)]({'where':{'username':_0x46f51c}});if(_0x2fde65)throw new Error(_0x4b035c(0x1f0));if(_0x5dbe45){const _0x58647a=await database_1[_0x4b035c(0x152)][_0x4b035c(0x124)][_0x4b035c(0x128)]({'where':{'telegram':_0x5dbe45}});if(_0x58647a)throw new Error(_0x4b035c(0xe8));}const _0x3165d7=await bcryptjs_1[_0x4b035c(0x152)][_0x4b035c(0x27b)](_0x1b11e8,0xc),_0xa3a782='pk_'+crypto_1['default'][_0x4b035c(0x15c)](0x20)[_0x4b035c(0x273)](_0x4b035c(0x1a8)),_0x13e618=_0x4b035c(0x154)+crypto_1[_0x4b035c(0x152)][_0x4b035c(0x15c)](0x20)[_0x4b035c(0x273)](_0x4b035c(0x1a8)),_0x3074dd=_0x11776d?_0x11776d[_0x4b035c(0x145)](_0x49e665=>this[_0x4b035c(0x240)](_0x49e665)):null;_0x11776d&&_0x3074dd&&console[_0x4b035c(0x14b)](_0x4b035c(0x1be),_0x11776d,'->',_0x3074dd);const _0x40f33f=await database_1['default'][_0x4b035c(0x124)][_0x4b035c(0xc2)]({'data':{'name':_0xf9aa80,'username':_0x46f51c,'password':_0x3165d7,'telegram':_0x5dbe45,'shopUrl':_0x1bb5fd,'paymentGateways':_0x3074dd?JSON[_0x4b035c(0x1cc)](_0x3074dd):null,'gatewaySettings':_0x60cfa8?JSON[_0x4b035c(0x1cc)](_0x60cfa8):null,'usdtPolygonWallet':_0x273691?.[_0x4b035c(0x1bd)]||null,'usdtTrcWallet':_0x273691?.[_0x4b035c(0x26b)]||null,'usdtErcWallet':_0x273691?.[_0x4b035c(0x224)]||null,'usdcPolygonWallet':_0x273691?.[_0x4b035c(0x1b8)]||null,'publicKey':_0xa3a782,'secretKey':_0x13e618,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x40f33f['id'],'fullName':_0x40f33f[_0x4b035c(0xbf)],'username':_0x40f33f[_0x4b035c(0x1d8)],'telegramId':_0x40f33f[_0x4b035c(0x25e)],'merchantUrl':_0x40f33f['shopUrl'],'gateways':_0x40f33f[_0x4b035c(0x206)]?JSON[_0x4b035c(0x1ea)](_0x40f33f['paymentGateways']):null,'gatewaySettings':_0x40f33f[_0x4b035c(0x17f)]?JSON[_0x4b035c(0x1ea)](_0x40f33f[_0x4b035c(0x17f)]):null,'publicKey':_0x40f33f[_0x4b035c(0x1cf)],'wallets':{'usdtPolygonWallet':_0x40f33f['usdtPolygonWallet'],'usdtTrcWallet':_0x40f33f['usdtTrcWallet'],'usdtErcWallet':_0x40f33f[_0x4b035c(0x224)],'usdcPolygonWallet':_0x40f33f[_0x4b035c(0x1b8)]},'status':_0x40f33f[_0x4b035c(0x1cd)],'createdAt':_0x40f33f[_0x4b035c(0x20c)]};}async[a50_0x22c744(0x19f)](_0x2bb3f2,_0x493e98){const _0x3aa45a=a50_0x22c744;if(config_1[_0x3aa45a(0x269)][_0x3aa45a(0xd9)][_0x3aa45a(0xe4)]){if(!_0x493e98)throw new Error(_0x3aa45a(0xd3));const _0x41c5f0=speakeasy_1['default'][_0x3aa45a(0x117)][_0x3aa45a(0x18c)]({'secret':config_1['config'][_0x3aa45a(0xd9)][_0x3aa45a(0x167)],'encoding':_0x3aa45a(0x112),'token':_0x493e98,'window':0x2});if(!_0x41c5f0){let _0x110b48=![];if(config_1[_0x3aa45a(0x269)][_0x3aa45a(0xd9)]['backupCodes']){const _0x2ff8d7=JSON[_0x3aa45a(0x1ea)](config_1[_0x3aa45a(0x269)][_0x3aa45a(0xd9)][_0x3aa45a(0xd8)]);for(let _0x6c15da=0x0;_0x6c15da<_0x2ff8d7[_0x3aa45a(0x215)];_0x6c15da++){const _0x345537=await bcryptjs_1['default'][_0x3aa45a(0x1c7)](_0x493e98,_0x2ff8d7[_0x6c15da]);if(_0x345537){_0x110b48=!![],_0x2ff8d7['splice'](_0x6c15da,0x1),config_1[_0x3aa45a(0x269)][_0x3aa45a(0xd9)]['backupCodes']=JSON['stringify'](_0x2ff8d7);const _0x1d94be=path_1[_0x3aa45a(0x152)][_0x3aa45a(0x107)](process[_0x3aa45a(0x146)](),_0x3aa45a(0x256));if(fs_1[_0x3aa45a(0x152)]['existsSync'](_0x1d94be)){let _0x455a44=fs_1[_0x3aa45a(0x152)][_0x3aa45a(0x1c6)](_0x1d94be,_0x3aa45a(0xed));const _0x117246=_0x455a44['split']('\x0a');for(let _0x299e2b=0x0;_0x299e2b<_0x117246[_0x3aa45a(0x215)];_0x299e2b++){if(_0x117246[_0x299e2b][_0x3aa45a(0x179)](_0x3aa45a(0x27a))){_0x117246[_0x299e2b]=_0x3aa45a(0x27a)+JSON[_0x3aa45a(0x1cc)](_0x2ff8d7);break;}}fs_1[_0x3aa45a(0x152)]['writeFileSync'](_0x1d94be,_0x117246[_0x3aa45a(0x107)]('\x0a'),'utf8');}break;}}}if(!_0x110b48)throw new Error(_0x3aa45a(0x144));}}await database_1[_0x3aa45a(0x152)][_0x3aa45a(0x124)]['delete']({'where':{'id':_0x2bb3f2}});}async[a50_0x22c744(0x147)](_0x4122b8){const _0x56dce8=a50_0x22c744,_0x252166=await database_1[_0x56dce8(0x152)][_0x56dce8(0x124)][_0x56dce8(0x128)]({'where':{'id':_0x4122b8},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x252166)throw new Error(_0x56dce8(0x10f));return{'usdtPolygonWallet':_0x252166[_0x56dce8(0x1bd)],'usdtTrcWallet':_0x252166[_0x56dce8(0x26b)],'usdtErcWallet':_0x252166[_0x56dce8(0x224)],'usdcPolygonWallet':_0x252166['usdcPolygonWallet'],'usdcErcWallet':_0x252166[_0x56dce8(0x278)]};}['generateBackupCodes'](_0x1945f4=0x8){const _0xe19439=a50_0x22c744,_0x4bad11=[];for(let _0x1f31a7=0x0;_0x1f31a7<_0x1945f4;_0x1f31a7++){const _0x575371=crypto_1[_0xe19439(0x152)][_0xe19439(0x15c)](0x4)[_0xe19439(0x273)](_0xe19439(0x1a8))['toUpperCase']();_0x4bad11[_0xe19439(0x220)](_0x575371);}return _0x4bad11;}async[a50_0x22c744(0x22f)](_0x3421c2){const _0x44ba50=a50_0x22c744,_0xebbb28=await database_1[_0x44ba50(0x152)]['shop'][_0x44ba50(0x128)]({'where':{'id':_0x3421c2},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0xebbb28)throw new Error(_0x44ba50(0x10f));const _0x46b452=speakeasy_1['default'][_0x44ba50(0x10a)]({'name':_0x44ba50(0x261)+_0xebbb28[_0x44ba50(0x1d8)]+')','issuer':_0x44ba50(0x235),'length':0x20}),_0x217810=await qrcode_1[_0x44ba50(0x152)]['toDataURL'](_0x46b452[_0x44ba50(0x20b)]),_0xcce405=this[_0x44ba50(0x1aa)](0x8),_0x5bdad7=await Promise[_0x44ba50(0x25f)](_0xcce405['map'](_0x3618ba=>bcryptjs_1[_0x44ba50(0x152)][_0x44ba50(0x27b)](_0x3618ba,0xa)));return await database_1[_0x44ba50(0x152)][_0x44ba50(0x124)][_0x44ba50(0x208)]({'where':{'id':_0x3421c2},'data':{'twoFactorSecret':_0x46b452[_0x44ba50(0x112)],'backupCodes':JSON[_0x44ba50(0x1cc)](_0x5bdad7)}}),console['log'](_0x44ba50(0x268)+_0xebbb28[_0x44ba50(0x1d8)]),console['log'](_0x44ba50(0xcc)+_0xcce405[_0x44ba50(0x215)]+_0x44ba50(0x102)),{'secret':_0x46b452[_0x44ba50(0x112)],'qrCode':_0x217810,'manualEntryKey':_0x46b452[_0x44ba50(0x112)],'backupCodes':_0xcce405};}async[a50_0x22c744(0x22c)](_0x1b2762,_0x5e686e){const _0x5c3273=a50_0x22c744,_0x28c364=await database_1[_0x5c3273(0x152)][_0x5c3273(0x124)][_0x5c3273(0x128)]({'where':{'id':_0x1b2762},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x28c364)throw new Error(_0x5c3273(0x10f));if(!_0x28c364[_0x5c3273(0x167)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x28c364[_0x5c3273(0xe4)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x18d21f=speakeasy_1[_0x5c3273(0x152)]['totp'][_0x5c3273(0x18c)]({'secret':_0x28c364[_0x5c3273(0x167)],'encoding':_0x5c3273(0x112),'token':_0x5e686e,'window':0x2});if(!_0x18d21f)throw new Error('Invalid\x202FA\x20token');return await database_1[_0x5c3273(0x152)][_0x5c3273(0x124)][_0x5c3273(0x208)]({'where':{'id':_0x1b2762},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x5c3273(0x1f6)+_0x28c364['username']),{'enabled':!![]};}async[a50_0x22c744(0x26f)](_0x540acc){const _0x845d69=a50_0x22c744,_0x370178=await database_1[_0x845d69(0x152)][_0x845d69(0x124)][_0x845d69(0x128)]({'where':{'id':_0x540acc},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x370178)throw new Error('Shop\x20not\x20found');await database_1['default'][_0x845d69(0x124)][_0x845d69(0x208)]({'where':{'id':_0x540acc},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x845d69(0x14b)]('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x370178[_0x845d69(0x1d8)]);}async[a50_0x22c744(0xe6)](_0xb71ecc,_0x164305,_0x3b0766,_0x35e5d8){const _0x1459f7=a50_0x22c744;if(_0x164305!==_0x3b0766)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x164305[_0x1459f7(0x215)]<0x6)throw new Error(_0x1459f7(0x22a));const _0x3bf243=await bcryptjs_1[_0x1459f7(0x152)][_0x1459f7(0x1c7)](_0xb71ecc,config_1[_0x1459f7(0x269)][_0x1459f7(0xd9)][_0x1459f7(0x1e9)]);if(!_0x3bf243)throw new Error(_0x1459f7(0x257));if(config_1[_0x1459f7(0x269)][_0x1459f7(0xd9)][_0x1459f7(0xe4)]){if(!_0x35e5d8)throw new Error('2FA\x20token\x20is\x20required');const _0x795158=speakeasy_1[_0x1459f7(0x152)]['totp'][_0x1459f7(0x18c)]({'secret':config_1[_0x1459f7(0x269)][_0x1459f7(0xd9)][_0x1459f7(0x167)],'encoding':_0x1459f7(0x112),'token':_0x35e5d8,'window':0x2});if(!_0x795158){let _0x506244=![];if(config_1[_0x1459f7(0x269)]['admin'][_0x1459f7(0xd8)]){const _0x46bde3=JSON[_0x1459f7(0x1ea)](config_1['config']['admin']['backupCodes']);for(let _0x1f9343=0x0;_0x1f9343<_0x46bde3[_0x1459f7(0x215)];_0x1f9343++){const _0x9bf7c3=await bcryptjs_1[_0x1459f7(0x152)][_0x1459f7(0x1c7)](_0x35e5d8,_0x46bde3[_0x1f9343]);if(_0x9bf7c3){_0x506244=!![],_0x46bde3[_0x1459f7(0xdf)](_0x1f9343,0x1),config_1[_0x1459f7(0x269)]['admin'][_0x1459f7(0xd8)]=JSON[_0x1459f7(0x1cc)](_0x46bde3);const _0x38fad3=path_1[_0x1459f7(0x152)][_0x1459f7(0x107)](process[_0x1459f7(0x146)](),_0x1459f7(0x256));if(fs_1[_0x1459f7(0x152)]['existsSync'](_0x38fad3)){let _0x223ec5=fs_1[_0x1459f7(0x152)]['readFileSync'](_0x38fad3,_0x1459f7(0xed));const _0x501c15=_0x223ec5['split']('\x0a');for(let _0x282b38=0x0;_0x282b38<_0x501c15['length'];_0x282b38++){if(_0x501c15[_0x282b38]['startsWith'](_0x1459f7(0x27a))){_0x501c15[_0x282b38]=_0x1459f7(0x27a)+JSON[_0x1459f7(0x1cc)](_0x46bde3);break;}}fs_1[_0x1459f7(0x152)]['writeFileSync'](_0x38fad3,_0x501c15['join']('\x0a'),_0x1459f7(0xed));}break;}}}if(!_0x506244)throw new Error(_0x1459f7(0x144));}}const _0x43438b=await bcryptjs_1[_0x1459f7(0x152)]['hash'](_0x164305,0xc);config_1[_0x1459f7(0x269)][_0x1459f7(0xd9)][_0x1459f7(0x1e9)]=_0x43438b;const _0x489fb7=path_1[_0x1459f7(0x152)][_0x1459f7(0x107)](process['cwd'](),_0x1459f7(0x256));let _0x2a6644='';if(fs_1[_0x1459f7(0x152)]['existsSync'](_0x489fb7)){_0x2a6644=fs_1[_0x1459f7(0x152)][_0x1459f7(0x1c6)](_0x489fb7,_0x1459f7(0xed));const _0x41d513=_0x2a6644[_0x1459f7(0x251)]('\x0a');let _0xbabb89=![];for(let _0x1c3abd=0x0;_0x1c3abd<_0x41d513['length'];_0x1c3abd++){if(_0x41d513[_0x1c3abd][_0x1459f7(0x179)](_0x1459f7(0x1b6))){_0x41d513[_0x1c3abd]=_0x1459f7(0x1b6)+_0x43438b,_0xbabb89=!![];break;}}!_0xbabb89&&_0x41d513[_0x1459f7(0x220)]('ADMIN_PASSWORD_HASH='+_0x43438b),_0x2a6644=_0x41d513['join']('\x0a'),fs_1['default'][_0x1459f7(0x258)](_0x489fb7,_0x2a6644,_0x1459f7(0xed));}console[_0x1459f7(0x14b)](_0x1459f7(0x1a1));}async[a50_0x22c744(0x11e)](){const _0x171741=a50_0x22c744;let _0x476408=0x0;if(config_1[_0x171741(0x269)][_0x171741(0xd9)][_0x171741(0xd8)])try{const _0x107090=JSON[_0x171741(0x1ea)](config_1[_0x171741(0x269)][_0x171741(0xd9)][_0x171741(0xd8)]);_0x476408=_0x107090['length'];}catch(_0x20cac1){console[_0x171741(0x151)](_0x171741(0x13c),_0x20cac1);}return{'twoFactorEnabled':config_1[_0x171741(0x269)][_0x171741(0xd9)]['twoFactorEnabled'],'backupCodesCount':_0x476408};}async[a50_0x22c744(0x14e)](){const _0x10747d=a50_0x22c744,_0x5055f4=speakeasy_1['default'][_0x10747d(0x10a)]({'name':_0x10747d(0x1b2)+config_1[_0x10747d(0x269)]['admin'][_0x10747d(0x1d8)]+')','issuer':_0x10747d(0x123),'length':0x20}),_0x6cdaad=await qrcode_1[_0x10747d(0x152)][_0x10747d(0x22e)](_0x5055f4[_0x10747d(0x20b)]),_0xe06e17=[];for(let _0xea320=0x0;_0xea320<0x8;_0xea320++){const _0x3e810f=crypto_1[_0x10747d(0x152)][_0x10747d(0x15c)](0x4)[_0x10747d(0x273)](_0x10747d(0x1a8))[_0x10747d(0x120)]();_0xe06e17[_0x10747d(0x220)](_0x3e810f);}const _0x2928ae=await Promise[_0x10747d(0x25f)](_0xe06e17[_0x10747d(0x145)](_0x227f70=>bcryptjs_1['default'][_0x10747d(0x27b)](_0x227f70,0xa)));config_1[_0x10747d(0x269)]['admin']['twoFactorSecret']=_0x5055f4['base32'],config_1[_0x10747d(0x269)][_0x10747d(0xd9)][_0x10747d(0xd8)]=JSON[_0x10747d(0x1cc)](_0x2928ae);const _0x4e5fac=path_1[_0x10747d(0x152)][_0x10747d(0x107)](process[_0x10747d(0x146)](),_0x10747d(0x256));if(fs_1[_0x10747d(0x152)]['existsSync'](_0x4e5fac)){let _0x3a0097=fs_1['default'][_0x10747d(0x1c6)](_0x4e5fac,_0x10747d(0xed));const _0x23c6aa=_0x3a0097['split']('\x0a');let _0x28a180=![],_0x35840a=![];for(let _0x2647e8=0x0;_0x2647e8<_0x23c6aa[_0x10747d(0x215)];_0x2647e8++){_0x23c6aa[_0x2647e8]['startsWith']('ADMIN_2FA_SECRET=')&&(_0x23c6aa[_0x2647e8]='ADMIN_2FA_SECRET='+_0x5055f4['base32'],_0x28a180=!![]),_0x23c6aa[_0x2647e8][_0x10747d(0x179)](_0x10747d(0x27a))&&(_0x23c6aa[_0x2647e8]=_0x10747d(0x27a)+JSON[_0x10747d(0x1cc)](_0x2928ae),_0x35840a=!![]);}if(!_0x28a180)_0x23c6aa[_0x10747d(0x220)]('ADMIN_2FA_SECRET='+_0x5055f4[_0x10747d(0x112)]);if(!_0x35840a)_0x23c6aa[_0x10747d(0x220)]('ADMIN_BACKUP_CODES='+JSON[_0x10747d(0x1cc)](_0x2928ae));fs_1[_0x10747d(0x152)]['writeFileSync'](_0x4e5fac,_0x23c6aa['join']('\x0a'),_0x10747d(0xed));}return console[_0x10747d(0x14b)]('üîê\x20Admin\x202FA\x20setup\x20initiated'),console[_0x10747d(0x14b)]('üîë\x20Generated\x20'+_0xe06e17['length']+_0x10747d(0x102)),{'secret':_0x5055f4[_0x10747d(0x112)],'qrCode':_0x6cdaad,'manualEntryKey':_0x5055f4[_0x10747d(0x112)],'backupCodes':_0xe06e17};}async[a50_0x22c744(0x156)](_0x48d79c){const _0x206337=a50_0x22c744;if(!config_1[_0x206337(0x269)]['admin'][_0x206337(0x167)])throw new Error(_0x206337(0x13e));if(config_1['config'][_0x206337(0xd9)]['twoFactorEnabled'])throw new Error('2FA\x20is\x20already\x20enabled');const _0x5ec6ce=speakeasy_1[_0x206337(0x152)][_0x206337(0x117)][_0x206337(0x18c)]({'secret':config_1['config'][_0x206337(0xd9)][_0x206337(0x167)],'encoding':_0x206337(0x112),'token':_0x48d79c,'window':0x2});if(!_0x5ec6ce)throw new Error(_0x206337(0xc9));config_1[_0x206337(0x269)][_0x206337(0xd9)]['twoFactorEnabled']=!![];const _0x353dbe=path_1[_0x206337(0x152)][_0x206337(0x107)](process['cwd'](),_0x206337(0x256));if(fs_1['default'][_0x206337(0x198)](_0x353dbe)){let _0x5e6cf7=fs_1[_0x206337(0x152)][_0x206337(0x1c6)](_0x353dbe,_0x206337(0xed));const _0x424428=_0x5e6cf7[_0x206337(0x251)]('\x0a');let _0x2f2fad=![];for(let _0x4d179a=0x0;_0x4d179a<_0x424428[_0x206337(0x215)];_0x4d179a++){if(_0x424428[_0x4d179a]['startsWith'](_0x206337(0x19b))){_0x424428[_0x4d179a]='ADMIN_2FA_ENABLED=true',_0x2f2fad=!![];break;}}if(!_0x2f2fad)_0x424428['push'](_0x206337(0x21b));fs_1['default'][_0x206337(0x258)](_0x353dbe,_0x424428[_0x206337(0x107)]('\x0a'),_0x206337(0xed));}return console[_0x206337(0x14b)](_0x206337(0x27e)),{'enabled':!![]};}async['disableAdmin2FA'](){const _0x2998a9=a50_0x22c744;config_1[_0x2998a9(0x269)][_0x2998a9(0xd9)]['twoFactorEnabled']=![],config_1[_0x2998a9(0x269)][_0x2998a9(0xd9)][_0x2998a9(0x167)]='',config_1[_0x2998a9(0x269)]['admin'][_0x2998a9(0xd8)]='';const _0x193925=path_1['default'][_0x2998a9(0x107)](process[_0x2998a9(0x146)](),_0x2998a9(0x256));if(fs_1[_0x2998a9(0x152)][_0x2998a9(0x198)](_0x193925)){let _0x4a6a81=fs_1[_0x2998a9(0x152)]['readFileSync'](_0x193925,_0x2998a9(0xed));const _0x4eb4b1=_0x4a6a81[_0x2998a9(0x251)]('\x0a');for(let _0x25ae21=0x0;_0x25ae21<_0x4eb4b1[_0x2998a9(0x215)];_0x25ae21++){_0x4eb4b1[_0x25ae21][_0x2998a9(0x179)](_0x2998a9(0x19b))&&(_0x4eb4b1[_0x25ae21]='ADMIN_2FA_ENABLED=false'),_0x4eb4b1[_0x25ae21][_0x2998a9(0x179)](_0x2998a9(0x1fc))&&(_0x4eb4b1[_0x25ae21]='ADMIN_2FA_SECRET='),_0x4eb4b1[_0x25ae21]['startsWith'](_0x2998a9(0x27a))&&(_0x4eb4b1[_0x25ae21]='ADMIN_BACKUP_CODES=');}fs_1[_0x2998a9(0x152)][_0x2998a9(0x258)](_0x193925,_0x4eb4b1[_0x2998a9(0x107)]('\x0a'),_0x2998a9(0xed));}console[_0x2998a9(0x14b)](_0x2998a9(0x187));}[a50_0x22c744(0x1e7)](_0x939b24,_0x4e1356,_0x363e93){const _0x32a72c=a50_0x22c744,_0x21973c=new Map(),_0x22b675=new Date(_0x4e1356);while(_0x22b675<=_0x363e93){const _0x41b431=_0x22b675[_0x32a72c(0x20f)]()[_0x32a72c(0x251)]('T')[0x0];_0x21973c[_0x32a72c(0xba)](_0x41b431,{'revenue':0x0,'count':0x0}),_0x22b675[_0x32a72c(0x180)](_0x22b675[_0x32a72c(0xca)]()+0x1);}for(const _0x26a698 of _0x939b24){const _0x3e8ba4=_0x26a698[_0x32a72c(0x20c)][_0x32a72c(0x20f)]()[_0x32a72c(0x251)]('T')[0x0],_0x58ad8f=_0x21973c[_0x32a72c(0x199)](_0x3e8ba4);_0x58ad8f&&(_0x58ad8f['count']+=0x1,_0x26a698['status']===_0x32a72c(0xda)&&(_0x26a698[_0x32a72c(0x17d)]?_0x58ad8f[_0x32a72c(0xf9)]+=_0x26a698[_0x32a72c(0x17d)]:console[_0x32a72c(0x14b)](_0x32a72c(0x19c)+_0x26a698['id']+_0x32a72c(0x12e))));}const _0x341d0c=[],_0x11cd08=[];for(const [_0x1b7b3f,_0x1e28b1]of _0x21973c){_0x341d0c[_0x32a72c(0x220)]({'date':_0x1b7b3f,'amount':Math[_0x32a72c(0x12b)](_0x1e28b1[_0x32a72c(0xf9)]*0x64)/0x64}),_0x11cd08[_0x32a72c(0x220)]({'date':_0x1b7b3f,'count':_0x1e28b1['count']});}return{'dailyRevenue':_0x341d0c,'dailyPayments':_0x11cd08};}async[a50_0x22c744(0x19a)](_0x55386f){const _0x407e0f=a50_0x22c744;console['log'](_0x407e0f(0x19e),_0x55386f);const _0x50b80e=new Date(_0x55386f[_0x407e0f(0x164)]),_0x3f4731=new Date(_0x55386f['periodTo']),_0x17fe78=new Date(Date[_0x407e0f(0x194)](_0x50b80e[_0x407e0f(0xfd)](),_0x50b80e[_0x407e0f(0x250)](),_0x50b80e['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4784ce=new Date(Date[_0x407e0f(0x194)](_0x3f4731['getUTCFullYear'](),_0x3f4731[_0x407e0f(0x250)](),_0x3f4731[_0x407e0f(0x204)](),0x17,0x3b,0x3b,0x3e7));console[_0x407e0f(0x14b)](_0x407e0f(0x272)+_0x17fe78[_0x407e0f(0x20f)]()+_0x407e0f(0x1d5)+_0x4784ce['toISOString']()),console[_0x407e0f(0x14b)](_0x407e0f(0x216)+_0x55386f[_0x407e0f(0x1f8)]);const _0x1e0f98=await database_1[_0x407e0f(0x152)][_0x407e0f(0xe5)]['findMany']({'where':{'status':_0x407e0f(0xda),'gateway':_0x55386f[_0x407e0f(0x1f8)]['toLowerCase'](),'createdAt':{'gte':_0x17fe78,'lte':_0x4784ce}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x407e0f(0x14b)](_0x407e0f(0x223)+_0x1e0f98[_0x407e0f(0x215)]+_0x407e0f(0x135)+_0x55386f['gateway']);const _0x242077=new Map();for(const _0x277727 of _0x1e0f98){const _0x280f1c=_0x277727[_0x407e0f(0x24c)]||0x0;if(_0x280f1c<=0x0){console[_0x407e0f(0x121)](_0x407e0f(0x19c)+_0x277727['id']+_0x407e0f(0x129));continue;}if(_0x242077[_0x407e0f(0x232)](_0x277727['shopId'])){const _0x14501a=_0x242077[_0x407e0f(0x199)](_0x277727['shopId']);_0x14501a[_0x407e0f(0x11d)]+=_0x280f1c;}else _0x242077[_0x407e0f(0xba)](_0x277727['shopId'],{'merchantId':_0x277727[_0x407e0f(0x124)]['id'],'merchantName':_0x277727[_0x407e0f(0x124)][_0x407e0f(0xbf)],'merchantUsername':_0x277727[_0x407e0f(0x124)][_0x407e0f(0x1d8)],'totalAmount':_0x280f1c});}const _0x4caa4c=Array[_0x407e0f(0x24d)](_0x242077[_0x407e0f(0x262)]())['map'](_0x12d980=>({'merchantId':_0x12d980[_0x407e0f(0x21c)],'merchantName':_0x12d980[_0x407e0f(0xc3)],'merchantUsername':_0x12d980[_0x407e0f(0x23b)],'gateway':_0x55386f['gateway'],'periodFrom':_0x55386f['periodFrom'],'periodTo':_0x55386f[_0x407e0f(0xbb)],'totalAmount':Math['round'](_0x12d980[_0x407e0f(0x11d)]*0x64)/0x64}));return _0x4caa4c[_0x407e0f(0x100)]((_0x34f599,_0x421a58)=>_0x421a58[_0x407e0f(0x11d)]-_0x34f599['totalAmount']),console[_0x407e0f(0x14b)](_0x407e0f(0x148)+_0x4caa4c[_0x407e0f(0x215)]+_0x407e0f(0xb8)),_0x4caa4c;}async[a50_0x22c744(0x263)](_0x30f973,_0x377a10,_0x3a000e){const _0x591474=a50_0x22c744,_0x45a8ee=await database_1['default'][_0x591474(0x124)][_0x591474(0x128)]({'where':{'id':_0x30f973}});if(!_0x45a8ee)throw new Error(_0x591474(0x1ee));await database_1[_0x591474(0x152)]['$transaction'](async _0x4b411e=>{const _0x334a0e=_0x591474;await _0x4b411e[_0x334a0e(0xe5)]['create']({'data':{'shopId':_0x45a8ee['id'],'amount':_0x377a10,'amountUSDT':_0x377a10,'amountAfterGatewayCommissionUSDT':_0x377a10,'sourceCurrency':_0x334a0e(0x254),'currency':_0x334a0e(0x254),'status':'PAID','gateway':_0x334a0e(0x18b),'customerName':_0x45a8ee[_0x334a0e(0x1d8)],'customerEmail':'@'+_0x45a8ee['telegram'],'paymentMethod':_0x334a0e(0x141),'adminNotes':_0x3a000e||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x4b411e[_0x334a0e(0x124)][_0x334a0e(0x208)]({'where':{'id':_0x45a8ee['id']},'data':{'balance':{'increment':_0x377a10}}});}),console[_0x591474(0x14b)](_0x591474(0x19d)+_0x377a10+_0x591474(0x142)+_0x45a8ee[_0x591474(0x1d8)]);}}function a50_0x5784(_0x2f0b52,_0x2d808b){_0x2f0b52=_0x2f0b52-0xb5;const _0x49eab9=a50_0x49ea();let _0x578497=_0x49eab9[_0x2f0b52];return _0x578497;}exports['AdminService']=AdminService;