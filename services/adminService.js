'use strict';const a46_0x38be63=a46_0x1e23;(function(_0x3e1106,_0xfd019f){const _0x44e691=a46_0x1e23,_0xfed573=_0x3e1106();while(!![]){try{const _0x16ff02=parseInt(_0x44e691(0x17a))/0x1*(-parseInt(_0x44e691(0x201))/0x2)+parseInt(_0x44e691(0x10e))/0x3*(-parseInt(_0x44e691(0x14e))/0x4)+parseInt(_0x44e691(0x116))/0x5+-parseInt(_0x44e691(0x1f5))/0x6*(-parseInt(_0x44e691(0x19c))/0x7)+parseInt(_0x44e691(0x113))/0x8+-parseInt(_0x44e691(0x18c))/0x9*(parseInt(_0x44e691(0x16a))/0xa)+parseInt(_0x44e691(0x1ea))/0xb;if(_0x16ff02===_0xfd019f)break;else _0xfed573['push'](_0xfed573['shift']());}catch(_0x364ac6){_0xfed573['push'](_0xfed573['shift']());}}}(a46_0xdef2,0x30eba));function a46_0x1e23(_0x58c974,_0x2fee5e){_0x58c974=_0x58c974-0x89;const _0xdef274=a46_0xdef2();let _0x1e23ba=_0xdef274[_0x58c974];return _0x1e23ba;}var __importDefault=this&&this[a46_0x38be63(0xed)]||function(_0x4ccebe){const _0x33dc6f=a46_0x38be63;return _0x4ccebe&&_0x4ccebe[_0x33dc6f(0x172)]?_0x4ccebe:{'default':_0x4ccebe};};Object[a46_0x38be63(0x1e1)](exports,a46_0x38be63(0x172),{'value':!![]}),exports[a46_0x38be63(0xd6)]=void 0x0;function a46_0xdef2(){const _0x12b29c=['hash','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','üí±\x20Currency\x20filter\x20applied:\x20','findFirst','%\x20commission)','sort','all','getPayoutStats','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','üìä\x20Getting\x20payments\x20with\x20filters:','payment','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','length','some','publicKey','totalCommissionRate','custom_','klyme_gb','Payment\x20not\x20found','rapyd','test_gateway','totalAmountAfterCommissionUSDT','üí∞\x20Payment\x20','gatewayCommissionRate','averageCheckUSDT','usdtTrcWallet','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','\x20\x20\x20Available\x20(raw):\x20','createUser','usdtErcWallet','./currencyService','set','üîç\x20Initial\x20wallet\x20from\x20request:\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','Telegram\x20username\x20already\x20exists','defineProperty','Insufficient\x20balance.\x20Available:\x20','currencyService','\x20USDT\x20(after\x20','\x20with\x20payout\x20history','üéØ\x20[',',\x20chargebacks:\x20','\x20became\x20PAID:','updateUser','111276zNzKgq','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','merchantEarningsUSDT','deleteUser','\x20USDT\x20(total\x20paid\x20to\x20merchants)','last_week','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','\x20order','customerUa','values','create','475734xzBTpb','sendPayoutNotification','üìä\x20Total\x20payments\x20(including\x20failed):\x20','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20merchants','getSystemStatistics','replace','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','customerCountry','\x20\x20\x20Available\x20(number):\x20','setUTCDate','105086aqRkfu','üìä\x20Merchant\x20statistics\x20calculated:','getUTCDate','\x20\x20\x20üíµ\x20Available\x20balance:\x20','totalPayments','fullName','NONEXISTENT_GATEWAY_FILTER','balance','generateDailyStatistics','customerEmail','sk_','commission','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','randomBytes','\x20\x20\x20Tolerance:\x20','startsWith','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','pendingPayout','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','findMany','update','\x20\x20\x20Merchant\x20loses:\x20','aggregate','usdcPolygonWallet','\x20\x20\x20üåç\x20Country:\x20','filter','UTC','\x20USDT\x20(current\x20balance\x20in\x20DB)','error','üí∞\x20Creating\x20payout\x20for\x20shop\x20','mastercard','\x20\x20\x20Requested\x20(number):\x20','totalAmountUSDT','forEach','log','entries','username','insensitive','getUserById','wallet','‚úÖ\x20Payout\x20created\x20in\x20DB:','\x20\x20\x20Payout\x20amount:\x20','CoinToPay','localeCompare','\x20\x20\x20Difference:\x20','week','year','üìÖ\x20Date\x20to\x20filter:\x20','totalPaidOut','üîÑ\x20Gateway\x20mapping:','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','failUrl','password','getGatewayInternalName','\x20USDT\x20(gross\x20revenue)','\x20payments)','_sum','getUTCMonth','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','getTime','getMerchantStatistics','\x20\x20\x20üí≥\x20Total\x20payments:\x20','getGatewayNameById','revenue','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','orderId','üìÖ\x20Date\x20from\x20filter:\x20','date','thisMonth','last_month','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','this_week',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','get','updatedAt','Noda','dailyRevenue','custom','customerIp','üìä\x20Gateway\x20filter\x20applied:','AdminService','polygon','createPayout','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','this_month','desc','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','noda','gatewaySettings',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','üìä\x20Available\x20gateways\x20in\x20database:','getGatewayDisplayName','üîç\x20Selected\x20polygon\x20wallet:\x20','üìä\x20Sorting\x20payments\x20by\x20','Open\x20Banking\x202','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','\x27\x20->\x20name\x20\x27','reduce','Shop\x20not\x20found','commissionUSDT','adminNotes','payout','__importDefault','period','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','\x20for\x20shop\x20','\x20USDT\x20(already\x20paid\x20out)','includes','telegram','\x20\x20\x20Merchant\x20gets:\x20','setHours',',\x20refunds:\x20','not\x20set','getPaymentById','\x20USDT','\x20\x20\x20Balance:\x20','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','‚úÖ\x20Payout\x20created:\x20','MasterCard','ru-RU','merchantEarnings','externalPaymentUrl','notes','paymentsCount','network','üí≥\x20Final\x20payout\x20wallet\x20for\x20','whiteUrl','\x20-\x20','2020-01-01','delete','getUTCFullYear','asc','\x20balance\x20updated:','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','3vhRaoT','groupBy','totalTurnover','\x20USDT\x20(-','\x20\x20\x20Added\x20to\x20balance:\x20+','1875376HWohmV','\x20->\x20','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','1728775ZyoABb','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','ACTIVE','toLowerCase','getFullYear','hex','gateway','_count','gateways','pk_','üìÖ\x20Period:\x20','totalPayout','\x20\x20\x20Full\x20amount:\x20','klyme_eu','round','Error\x20processing\x20payment\x20','count','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','klyme_de','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','getGatewayIdByName','\x27\x20(from\x20\x27','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','failureMessage','dateTo','split','gatewayOrderId','getAllUsers',',\x20successful:\x20','not\x20specified','crypto','merchantUrl','Plisio','map','bcryptjs','üí∞\x20Found\x20','\x27\x20to\x20name\x20\x27','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','default','push','PAID','\x20PAID\x20payments','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','turnover','shop','\x20\x20\x20üåê\x20IP:\x20',',\x20Commission:\x20','averageCommissionRate','periodFrom','toString','\x20USDT,\x20Difference:\x20','üîÑ\x20Gateway\x20mapping\x20(get):','../types/gateway','updatePaymentStatus','lte','1569196wknOqf','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','%\x20from\x20','\x20USDT,\x20Requested:\x20','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','\x20USDT\x20from\x20balance','\x20to\x20',',\x20userId:\x20','customerName','turnoverUSDT','\x20USDT\x20(theoretical\x20net)','\x20merchants\x20for\x20selection','shopId','trim','Rapyd','üîç\x20Selected\x20erc20\x20wallet:\x20','üí∞\x20[PAYOUT]\x20Gateway\x20','wallets','\x20balance\x20updated:\x20','toUpperCase','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','dailyPayments','\x20\x20\x20Current\x20balance:\x20','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','PENDING','üí∞\x20Shop\x20','üîß\x20[','getPayoutById','121810XMIHWW','üîê\x20[',']\x20Gateway\x20settings\x20before\x20saving:','today','pendingUrl','paidAt','usdtPolygonWallet','status','__esModule','slice','getDay','warn','üîÑ\x20Converted\x20gateway\x20name\x20\x27','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','\x20\x20\x20Gateway:\x20','getAllPayouts','1runfYd','\x20USDT)','getMerchantsSelection','ceil','currency','month','telegramId','setDate','amountAfterGatewayCommissionUSDT','gatewayEarnings','findUnique','CHARGEBACK','periodTo','toISOString','name','üìã\x20Found\x20','shopUrl','floor','18gSYoon','COMPLETED','erc20_usdc','\x20\x20\x20Total\x20paid\x20out:\x20','getMonth','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','üìä\x20Payout\x20statistics\x20calculated:','activateUser','\x20status:\x20','paidOutUSDT','üìã\x20Getting\x20merchants\x20selection\x20list...','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','erc20','suspendUser','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','statusChangedAt','7bMgrfa','$transaction','admin','\x27\x20->\x20ID\x20\x27','gte','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','‚ö†Ô∏è\x20Payment\x20','usdcErcWallet','getDate','üîç\x20Balance\x20check\x20details:','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','amountUSDT','toLocaleDateString','getAllPayments','createdAt','toFixed','min','txid','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','\x20\x20\x20ü§î\x20Difference:\x20','trc20','chargebackAmount','stringify','parse','\x20USDT,\x20merchant:\x20','paymentGateways','\x20USDT\x20(','amount','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','‚ö†Ô∏è\x20Gateway\x20\x27','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','REFUND','KLYME\x20GB'];a46_0xdef2=function(){return _0x12b29c;};return a46_0xdef2();}const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a46_0x38be63(0x139))),crypto_1=__importDefault(require(a46_0x38be63(0x135))),currencyService_1=require(a46_0x38be63(0x1dc)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a46_0x38be63(0x14b));class AdminService{async[a46_0x38be63(0x1c4)](){const _0x396284=a46_0x38be63;console[_0x396284(0xa8)]('üìä\x20Calculating\x20payout\x20statistics...');const _0x108dd1=await database_1[_0x396284(0x13d)][_0x396284(0x143)][_0x396284(0x9c)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x2b900c=await database_1[_0x396284(0x13d)][_0x396284(0x1c7)][_0x396284(0x126)]({'where':{'status':_0x396284(0x13f),'gateway':{'not':_0x396284(0x1d1)}}}),_0x1c4da9=new Date(),_0x31a83d=new Date(_0x1c4da9[_0x396284(0x11a)](),_0x1c4da9[_0x396284(0x190)](),0x1),_0x3efc42=new Date(_0x1c4da9[_0x396284(0x11a)](),_0x1c4da9[_0x396284(0x190)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x148692=await database_1[_0x396284(0x13d)][_0x396284(0xec)][_0x396284(0x9c)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x31a83d,'lte':_0x3efc42},'status':_0x396284(0x18d)}}),_0x5ad290=_0x108dd1[_0x396284(0xbe)]['totalPaidOut']||0x0,_0x47bddc=_0x108dd1['_sum'][_0x396284(0x8c)]||0x0,_0x3c0d5f=_0x148692[_0x396284(0xbe)][_0x396284(0x1b7)]||0x0,_0x1a8ace={'totalPayout':Math['round'](_0x5ad290*0x64)/0x64,'awaitingPayout':Math[_0x396284(0x124)](_0x47bddc*0x64)/0x64,'thisMonth':Math[_0x396284(0x124)](_0x3c0d5f*0x64)/0x64,'availableBalance':Math[_0x396284(0x124)](_0x47bddc*0x64)/0x64,'totalPayments':_0x2b900c};return console[_0x396284(0xa8)](_0x396284(0x192)),console[_0x396284(0xa8)](_0x396284(0xfc)+_0x1a8ace[_0x396284(0x121)]+_0x396284(0x1ee)),console[_0x396284(0xa8)](_0x396284(0x1a6)+_0x1a8ace['awaitingPayout']+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x396284(0xa8)](_0x396284(0x204)+_0x1a8ace['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x396284(0xa8)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x1a8ace[_0x396284(0xca)]+'\x20USDT'),console[_0x396284(0xa8)](_0x396284(0xc3)+_0x1a8ace[_0x396284(0x89)]+_0x396284(0x140)),_0x1a8ace;}async['updateCustomerData'](_0x939bb8,_0x13338d){const _0x196725=a46_0x38be63;console[_0x196725(0xa8)](_0x196725(0x197)+_0x939bb8+':',_0x13338d);const _0x5e093a=await database_1[_0x196725(0x13d)]['payment'][_0x196725(0x184)]({'where':{'id':_0x939bb8},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5e093a)throw new Error('Payment\x20not\x20found');const _0x595934={};_0x13338d['customerCountry']!==undefined&&(_0x595934[_0x196725(0x1fe)]=_0x13338d[_0x196725(0x1fe)]||null);_0x13338d[_0x196725(0xd4)]!==undefined&&(_0x595934['customerIp']=_0x13338d[_0x196725(0xd4)]||null);_0x13338d[_0x196725(0x1f2)]!==undefined&&(_0x595934[_0x196725(0x1f2)]=_0x13338d['customerUa']||null);const _0x805bba=await database_1['default']['payment'][_0x196725(0x9a)]({'where':{'id':_0x939bb8},'data':{..._0x595934,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x196725(0xcc)+_0x939bb8),console[_0x196725(0xa8)](_0x196725(0x9e)+_0x5e093a[_0x196725(0x1fe)]+_0x196725(0x114)+_0x805bba[_0x196725(0x1fe)]),console[_0x196725(0xa8)](_0x196725(0x144)+_0x5e093a[_0x196725(0xd4)]+'\x20->\x20'+_0x805bba[_0x196725(0xd4)]),console[_0x196725(0xa8)](_0x196725(0x1d8)+(_0x5e093a[_0x196725(0x1f2)]?_0x196725(0x1dd):_0x196725(0xf7))+_0x196725(0x114)+(_0x805bba[_0x196725(0x1f2)]?_0x196725(0x1dd):_0x196725(0xf7))),_0x805bba;}async[a46_0x38be63(0x1fb)](_0x4affbb,_0x501de4){const _0x47483b=a46_0x38be63,_0x4e3715=_0x501de4?new Date(_0x501de4):new Date();let _0x36dbee,_0x1573a0;if(_0x4affbb[_0x47483b(0x94)](_0x47483b(0x1cd))){const _0xe6c14c=_0x4affbb[_0x47483b(0x1fc)](_0x47483b(0x1cd),'')[_0x47483b(0x130)]('_');_0xe6c14c[_0x47483b(0x1c9)]===0x2?(_0x36dbee=new Date(_0xe6c14c[0x0]),_0x36dbee[_0x47483b(0xf5)](0x0,0x0,0x0,0x0),_0x1573a0=new Date(_0xe6c14c[0x1]),_0x1573a0[_0x47483b(0xf5)](0x17,0x3b,0x3b,0x3e7)):(_0x36dbee=new Date(_0x4e3715[_0x47483b(0xc1)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x36dbee[_0x47483b(0xf5)](0x0,0x0,0x0,0x0),_0x1573a0=new Date(),_0x1573a0[_0x47483b(0xf5)](0x17,0x3b,0x3b,0x3e7));}else switch(_0x4affbb[_0x47483b(0x119)]()){case _0x47483b(0x16d):_0x36dbee=new Date(Date[_0x47483b(0xa0)](_0x4e3715['getUTCFullYear'](),_0x4e3715[_0x47483b(0xbf)](),_0x4e3715[_0x47483b(0x203)](),0x0,0x0,0x0,0x0)),_0x1573a0=new Date(Date[_0x47483b(0xa0)](_0x4e3715[_0x47483b(0x10a)](),_0x4e3715['getUTCMonth'](),_0x4e3715[_0x47483b(0x203)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x419d1b=new Date(_0x4e3715);_0x419d1b[_0x47483b(0x200)](_0x419d1b[_0x47483b(0x203)]()-0x1),_0x36dbee=new Date(Date[_0x47483b(0xa0)](_0x419d1b[_0x47483b(0x10a)](),_0x419d1b[_0x47483b(0xbf)](),_0x419d1b[_0x47483b(0x203)](),0x0,0x0,0x0,0x0)),_0x1573a0=new Date(Date['UTC'](_0x419d1b[_0x47483b(0x10a)](),_0x419d1b[_0x47483b(0xbf)](),_0x419d1b[_0x47483b(0x203)](),0x17,0x3b,0x3b,0x3e7));break;case _0x47483b(0xcd):const _0x446139=_0x4e3715[_0x47483b(0x174)](),_0x4e7a09=_0x446139===0x0?-0x6:0x1-_0x446139;_0x36dbee=new Date(_0x4e3715),_0x36dbee[_0x47483b(0x181)](_0x4e3715[_0x47483b(0x1a4)]()+_0x4e7a09),_0x36dbee[_0x47483b(0xf5)](0x0,0x0,0x0,0x0),_0x1573a0=new Date(_0x4e3715[_0x47483b(0x11a)](),_0x4e3715[_0x47483b(0x190)](),_0x4e3715[_0x47483b(0x1a4)](),0x17,0x3b,0x3b,0x3e7);break;case _0x47483b(0x1ef):const _0x470f24=new Date(_0x4e3715);_0x470f24['setDate'](_0x4e3715[_0x47483b(0x1a4)]()-0x7);const _0x2c3a4d=_0x470f24[_0x47483b(0x174)](),_0x3e05b8=_0x2c3a4d===0x0?-0x6:0x1-_0x2c3a4d;_0x36dbee=new Date(_0x470f24),_0x36dbee['setDate'](_0x470f24[_0x47483b(0x1a4)]()+_0x3e05b8),_0x36dbee[_0x47483b(0xf5)](0x0,0x0,0x0,0x0),_0x1573a0=new Date(_0x36dbee),_0x1573a0[_0x47483b(0x181)](_0x36dbee['getDate']()+0x6),_0x1573a0['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x47483b(0xda):_0x36dbee=new Date(Date['UTC'](_0x4e3715[_0x47483b(0x10a)](),_0x4e3715[_0x47483b(0xbf)](),0x1,0x0,0x0,0x0,0x0)),_0x1573a0=new Date(Date[_0x47483b(0xa0)](_0x4e3715[_0x47483b(0x10a)](),_0x4e3715[_0x47483b(0xbf)](),_0x4e3715['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x47483b(0xcb):_0x36dbee=new Date(Date['UTC'](_0x4e3715[_0x47483b(0x10a)](),_0x4e3715[_0x47483b(0xbf)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1573a0=new Date(Date[_0x47483b(0xa0)](_0x4e3715['getUTCFullYear'](),_0x4e3715['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;default:_0x36dbee=new Date(_0x4e3715['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x36dbee['setHours'](0x0,0x0,0x0,0x0),_0x1573a0=new Date(_0x4e3715['getFullYear'](),_0x4e3715['getMonth'](),_0x4e3715['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x3c0392={'gte':_0x36dbee,'lte':_0x1573a0},[_0x33b056,_0x448197,_0x2c9864,_0x495d8f,_0x726ed5,_0x5f1cdd,_0x53e612,_0x579740]=await Promise[_0x47483b(0x1c3)]([database_1[_0x47483b(0x13d)]['shop'][_0x47483b(0x126)](),database_1[_0x47483b(0x13d)][_0x47483b(0x143)][_0x47483b(0x126)]({'where':{'status':_0x47483b(0x118)}}),database_1[_0x47483b(0x13d)][_0x47483b(0x1c7)][_0x47483b(0x126)]({'where':{'status':_0x47483b(0x13f),'createdAt':_0x3c0392,'gateway':{'not':_0x47483b(0x1d1)}}}),database_1[_0x47483b(0x13d)][_0x47483b(0x1c7)]['count']({'where':{'status':_0x47483b(0x185),'createdAt':_0x3c0392,'gateway':{'not':_0x47483b(0x1d1)}}}),database_1[_0x47483b(0x13d)][_0x47483b(0x1c7)][_0x47483b(0x126)]({'where':{'status':_0x47483b(0x1bb),'createdAt':_0x3c0392,'gateway':{'not':_0x47483b(0x1d1)}}}),database_1[_0x47483b(0x13d)][_0x47483b(0x1c7)][_0x47483b(0x99)]({'where':{'status':'PAID','createdAt':_0x3c0392,'gateway':{'not':_0x47483b(0x1d1)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x47483b(0x13d)]['payment']['findMany']({'where':{'gateway':{'not':_0x47483b(0x1d1)}},'take':0xa,'orderBy':{'createdAt':_0x47483b(0xdb)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x47483b(0x13d)][_0x47483b(0x1c7)][_0x47483b(0x99)]({'where':{'createdAt':_0x3c0392,'gateway':{'not':_0x47483b(0x1d1)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x532c0d=0x0,_0x5e4383=0x0;for(const _0x1d171a of _0x5f1cdd){const _0x224f21=_0x1d171a[_0x47483b(0x1a7)]||0x0;_0x532c0d+=_0x224f21;if(_0x1d171a[_0x47483b(0x182)]&&_0x1d171a[_0x47483b(0x1a7)]){const _0x524e9b=_0x1d171a['amountUSDT']-_0x1d171a['amountAfterGatewayCommissionUSDT'];_0x5e4383+=_0x524e9b;}}const _0x343441=_0x2c9864>0x0?_0x532c0d/_0x2c9864:0x0,_0x4a43a0=this[_0x47483b(0x8d)](_0x579740,_0x36dbee,_0x1573a0),_0x539f25=await database_1[_0x47483b(0x13d)][_0x47483b(0x1c7)][_0x47483b(0x126)]({'where':{'createdAt':_0x3c0392,'gateway':{'not':_0x47483b(0x1d1)},'status':{'not':_0x47483b(0x166)}}}),_0x3c9900=_0x539f25>0x0?_0x2c9864/_0x539f25*0x64:0x0;return{'totalShops':_0x33b056,'activeShops':_0x448197,'totalPayments':_0x539f25,'successfulPayments':_0x2c9864,'totalAttempts':_0x539f25,'chargebacks':_0x495d8f,'refunds':_0x726ed5,'totalRevenue':Math[_0x47483b(0x124)](_0x532c0d*0x64)/0x64,'trapayEarnings':Math[_0x47483b(0x124)](_0x5e4383*0x64)/0x64,'averagePaymentAmount':Math[_0x47483b(0x124)](_0x343441*0x64)/0x64,'conversionRate':Math[_0x47483b(0x124)](_0x3c9900*0x64)/0x64,'dailyRevenue':_0x4a43a0[_0x47483b(0xd2)],'dailyPayments':_0x4a43a0[_0x47483b(0x163)],'recentPayments':_0x53e612[_0x47483b(0x138)](_0x4dfffa=>({'id':_0x4dfffa['id'],'amount':_0x4dfffa[_0x47483b(0x1b7)],'currency':_0x4dfffa['currency'],'status':_0x4dfffa[_0x47483b(0x171)],'gateway':_0x4dfffa[_0x47483b(0x11c)],'shop':_0x4dfffa[_0x47483b(0x143)],'createdAt':_0x4dfffa[_0x47483b(0x1aa)]}))};}async[a46_0x38be63(0xc2)](_0x1510a9){const _0x3fa4b4=a46_0x38be63;console['log']('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x1510a9);let _0x69eb42,_0x42e888=new Date();if(_0x1510a9[_0x3fa4b4(0xee)]==='custom'&&_0x1510a9['dateFrom']&&_0x1510a9[_0x3fa4b4(0x12f)])_0x69eb42=new Date(_0x1510a9['dateFrom']),_0x42e888=new Date(_0x1510a9[_0x3fa4b4(0x12f)]),_0x69eb42['setHours'](0x0,0x0,0x0,0x0),_0x42e888[_0x3fa4b4(0xf5)](0x17,0x3b,0x3b,0x3e7);else{const _0x3b0fe6=new Date();switch(_0x1510a9[_0x3fa4b4(0xee)]){case _0x3fa4b4(0xb3):_0x69eb42=new Date(_0x3b0fe6[_0x3fa4b4(0xc1)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3fa4b4(0x17f):_0x69eb42=new Date(_0x3b0fe6['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3fa4b4(0xb4):_0x69eb42=new Date(_0x3b0fe6['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x3fa4b4(0x1c3):default:_0x69eb42=new Date(_0x3fa4b4(0x108));break;}_0x69eb42['setHours'](0x0,0x0,0x0,0x0),_0x42e888[_0x3fa4b4(0xf5)](0x17,0x3b,0x3b,0x3e7);}console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x120)+_0x69eb42[_0x3fa4b4(0x187)]()+_0x3fa4b4(0x154)+_0x42e888[_0x3fa4b4(0x187)]());const _0x28da86={'status':_0x3fa4b4(0x13f),'gateway':{'not':_0x3fa4b4(0x1d1)},'paidAt':{'gte':_0x69eb42,'lte':_0x42e888}};_0x1510a9['shopId']&&(_0x28da86[_0x3fa4b4(0x15a)]=_0x1510a9[_0x3fa4b4(0x15a)]);const _0x54f363=await database_1[_0x3fa4b4(0x13d)][_0x3fa4b4(0x1c7)][_0x3fa4b4(0x99)]({'where':_0x28da86,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x3fa4b4(0x13a)+_0x54f363[_0x3fa4b4(0x1c9)]+'\x20paid\x20payments\x20for\x20analysis');const _0x4d6cb3={'gateway':{'not':_0x3fa4b4(0x1d1)},'status':{'not':'PENDING'},'createdAt':{'gte':_0x69eb42,'lte':_0x42e888}};_0x1510a9[_0x3fa4b4(0x15a)]&&(_0x4d6cb3[_0x3fa4b4(0x15a)]=_0x1510a9[_0x3fa4b4(0x15a)]);const _0x2cf21f=await database_1[_0x3fa4b4(0x13d)][_0x3fa4b4(0x1c7)][_0x3fa4b4(0x126)]({'where':_0x4d6cb3}),_0x211722={..._0x4d6cb3,'status':_0x3fa4b4(0x185)},_0x567b62={..._0x4d6cb3,'status':_0x3fa4b4(0x1bb)},[_0x583335,_0x2901dd]=await Promise[_0x3fa4b4(0x1c3)]([database_1[_0x3fa4b4(0x13d)][_0x3fa4b4(0x1c7)][_0x3fa4b4(0x126)]({'where':_0x211722}),database_1['default'][_0x3fa4b4(0x1c7)][_0x3fa4b4(0x126)]({'where':_0x567b62})]);console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x1f7)+_0x2cf21f+_0x3fa4b4(0x133)+_0x54f363[_0x3fa4b4(0x1c9)]+_0x3fa4b4(0x1e7)+_0x583335+_0x3fa4b4(0xf6)+_0x2901dd);let _0x75e49c=0x0,_0x3e252a=0x0,_0x2562dd=0x0;const _0x139434={},_0x40f26a={},_0x30bc87={};for(const _0x29f67f of _0x54f363){try{const _0x4240a4=_0x29f67f[_0x3fa4b4(0x1a7)]||0x0;if(_0x4240a4<=0x0){console[_0x3fa4b4(0x175)]('‚ö†Ô∏è\x20Payment\x20'+_0x29f67f['id']+_0x3fa4b4(0x162));continue;}let _0x101370,_0x5ae671;if(_0x29f67f[_0x3fa4b4(0x182)]!==null&&_0x29f67f[_0x3fa4b4(0x182)]!==undefined)_0x101370=_0x29f67f[_0x3fa4b4(0x182)],_0x5ae671=_0x4240a4-_0x101370,console[_0x3fa4b4(0xa8)]('üìä\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x29f67f['id']+':\x20'+_0x4240a4[_0x3fa4b4(0x1ab)](0x6)+_0x3fa4b4(0x1b4)+_0x101370[_0x3fa4b4(0x1ab)](0x6)+_0x3fa4b4(0xf9));else{let _0x10b5af={};if(_0x29f67f[_0x3fa4b4(0x143)][_0x3fa4b4(0xdf)])try{_0x10b5af=JSON[_0x3fa4b4(0x1b3)](_0x29f67f['shop'][_0x3fa4b4(0xdf)]);}catch(_0x2657c2){console['error'](_0x3fa4b4(0x98)+_0x29f67f['shopId']+':',_0x2657c2);}let _0x407ed1=0x2d;for(const [_0xfcca12,_0x4a2fb6]of Object['entries'](_0x10b5af)){if(_0xfcca12[_0x3fa4b4(0x119)]()===_0x29f67f[_0x3fa4b4(0x11c)]['toLowerCase']()){_0x407ed1=_0x4a2fb6[_0x3fa4b4(0x90)]||0x2d;break;}}_0x5ae671=_0x4240a4*(_0x407ed1/0x64),_0x101370=_0x4240a4-_0x5ae671,console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x1d7)+_0x29f67f['id']+':\x20'+_0x407ed1+_0x3fa4b4(0x150)+_0x4240a4[_0x3fa4b4(0x1ab)](0x6)+_0x3fa4b4(0xf9));}_0x75e49c+=_0x4240a4,_0x3e252a+=_0x101370,_0x2562dd+=_0x5ae671;let _0x271d5d;_0x29f67f['gatewayCommissionRate']!==null&&_0x29f67f[_0x3fa4b4(0x1d4)]!==undefined?(_0x271d5d=_0x29f67f[_0x3fa4b4(0x1d4)],console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x129)+_0x29f67f['id']+':\x20'+_0x271d5d+'%')):(_0x271d5d=_0x4240a4>0x0?_0x5ae671/_0x4240a4*0x64:0x0,console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x95)+_0x29f67f['id']+':\x20'+_0x271d5d[_0x3fa4b4(0x1ab)](0x2)+'%'));!_0x139434[_0x29f67f[_0x3fa4b4(0x11c)]]&&(_0x139434[_0x29f67f[_0x3fa4b4(0x11c)]]={'gateway':_0x29f67f[_0x3fa4b4(0x11c)],'gatewayDisplayName':this[_0x3fa4b4(0xe2)](_0x29f67f[_0x3fa4b4(0x11c)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x139434[_0x29f67f[_0x3fa4b4(0x11c)]]['paymentsCount']++,_0x139434[_0x29f67f[_0x3fa4b4(0x11c)]][_0x3fa4b4(0x157)]+=_0x4240a4,_0x139434[_0x29f67f[_0x3fa4b4(0x11c)]][_0x3fa4b4(0xea)]+=_0x5ae671,_0x139434[_0x29f67f[_0x3fa4b4(0x11c)]]['merchantEarningsUSDT']+=_0x101370,_0x139434[_0x29f67f[_0x3fa4b4(0x11c)]][_0x3fa4b4(0x1cc)]+=_0x271d5d;!_0x1510a9[_0x3fa4b4(0x15a)]&&(!_0x40f26a[_0x29f67f[_0x3fa4b4(0x15a)]]&&(_0x40f26a[_0x29f67f[_0x3fa4b4(0x15a)]]={'shopId':_0x29f67f[_0x3fa4b4(0x15a)],'shopName':_0x29f67f[_0x3fa4b4(0x143)][_0x3fa4b4(0x188)],'shopUsername':_0x29f67f[_0x3fa4b4(0x143)][_0x3fa4b4(0xaa)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x40f26a[_0x29f67f[_0x3fa4b4(0x15a)]][_0x3fa4b4(0x103)]++,_0x40f26a[_0x29f67f['shopId']][_0x3fa4b4(0x157)]+=_0x4240a4,_0x40f26a[_0x29f67f[_0x3fa4b4(0x15a)]][_0x3fa4b4(0xea)]+=_0x5ae671,_0x40f26a[_0x29f67f[_0x3fa4b4(0x15a)]][_0x3fa4b4(0x1ec)]+=_0x101370);const _0x4eee61=_0x29f67f[_0x3fa4b4(0x16f)]['toISOString']()[_0x3fa4b4(0x130)]('T')[0x0];!_0x30bc87[_0x4eee61]&&(_0x30bc87[_0x4eee61]={'date':_0x4eee61,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x30bc87[_0x4eee61][_0x3fa4b4(0x142)]+=_0x4240a4,_0x30bc87[_0x4eee61][_0x3fa4b4(0x100)]+=_0x101370,_0x30bc87[_0x4eee61]['gatewayEarnings']+=_0x5ae671,_0x30bc87[_0x4eee61][_0x3fa4b4(0x103)]++;}catch(_0x2087d8){console[_0x3fa4b4(0xa2)](_0x3fa4b4(0x125)+_0x29f67f['id']+':',_0x2087d8);}}Object[_0x3fa4b4(0x1f3)](_0x139434)[_0x3fa4b4(0xa7)](_0x1c4eb5=>{const _0x1f82c0=_0x3fa4b4;_0x1c4eb5[_0x1f82c0(0x146)]=_0x1c4eb5[_0x1f82c0(0x103)]>0x0?_0x1c4eb5[_0x1f82c0(0x1cc)]/_0x1c4eb5[_0x1f82c0(0x103)]:0x0,delete _0x1c4eb5[_0x1f82c0(0x1cc)];}),Object[_0x3fa4b4(0x1f3)](_0x40f26a)[_0x3fa4b4(0xa7)](_0x4ee74c=>{const _0x10c413=_0x3fa4b4;_0x4ee74c['averageCheckUSDT']=_0x4ee74c[_0x10c413(0x103)]>0x0?_0x4ee74c['turnoverUSDT']/_0x4ee74c['paymentsCount']:0x0;});let _0x151c6a=0x0,_0x28353d=0x0;if(_0x1510a9[_0x3fa4b4(0x15a)]){const _0x55c05a=await database_1[_0x3fa4b4(0x13d)][_0x3fa4b4(0xec)][_0x3fa4b4(0x99)]({'where':{'shopId':_0x1510a9[_0x3fa4b4(0x15a)],'status':_0x3fa4b4(0x18d),'createdAt':{'gte':_0x69eb42,'lte':_0x42e888}},'select':{'amount':!![]}});_0x151c6a=_0x55c05a[_0x3fa4b4(0xe8)]((_0x56f4a0,_0x3f9dd0)=>_0x56f4a0+_0x3f9dd0['amount'],0x0);const _0x48494a=await database_1[_0x3fa4b4(0x13d)][_0x3fa4b4(0xec)][_0x3fa4b4(0x99)]({'where':{'shopId':_0x1510a9['shopId'],'status':_0x3fa4b4(0x166),'createdAt':{'gte':_0x69eb42,'lte':_0x42e888}},'select':{'amount':!![]}});_0x28353d=_0x48494a[_0x3fa4b4(0xe8)]((_0x473eb9,_0x1becc7)=>_0x473eb9+_0x1becc7[_0x3fa4b4(0x1b7)],0x0);}const _0x1c7035=_0x2cf21f,_0x140dcd=_0x54f363['length'],_0x24ce1c=_0x140dcd>0x0?_0x75e49c/_0x140dcd:0x0,_0x4f9eab=_0x1c7035>0x0?Math[_0x3fa4b4(0x124)](_0x140dcd/_0x1c7035*0x2710)/0x64:0x0,_0x53ba51=Math[_0x3fa4b4(0x17d)]((_0x42e888['getTime']()-_0x69eb42[_0x3fa4b4(0xc1)]())/(0x3e8*0x3c*0x3c*0x18)),_0x33009b={'totalTurnover':Math[_0x3fa4b4(0x124)](_0x75e49c*0x64)/0x64,'merchantEarnings':Math[_0x3fa4b4(0x124)](_0x3e252a*0x64)/0x64,'gatewayEarnings':Math[_0x3fa4b4(0x124)](_0x2562dd*0x64)/0x64,'totalPaidOut':Math['round'](_0x151c6a*0x64)/0x64,'pendingPayout':Math['round'](_0x28353d*0x64)/0x64,'averageCheck':Math[_0x3fa4b4(0x124)](_0x24ce1c*0x64)/0x64,'totalPayments':_0x1c7035,'successfulPayments':_0x140dcd,'conversionRate':_0x4f9eab,'chargebacks':_0x583335,'refunds':_0x2901dd,'gatewayBreakdown':Object[_0x3fa4b4(0x1f3)](_0x139434)['map'](_0x38526a=>({..._0x38526a,'turnoverUSDT':Math[_0x3fa4b4(0x124)](_0x38526a[_0x3fa4b4(0x157)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x38526a['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3fa4b4(0x124)](_0x38526a[_0x3fa4b4(0x1ec)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x38526a['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x1510a9[_0x3fa4b4(0x15a)]?undefined:Object[_0x3fa4b4(0x1f3)](_0x40f26a)[_0x3fa4b4(0x138)](_0x59be6e=>({..._0x59be6e,'turnoverUSDT':Math['round'](_0x59be6e[_0x3fa4b4(0x157)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x59be6e[_0x3fa4b4(0xea)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3fa4b4(0x124)](_0x59be6e[_0x3fa4b4(0x1ec)]*0x64)/0x64,'paidOutUSDT':Math[_0x3fa4b4(0x124)](_0x59be6e[_0x3fa4b4(0x195)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x59be6e[_0x3fa4b4(0x1d5)]*0x64)/0x64})),'dailyData':Object[_0x3fa4b4(0x1f3)](_0x30bc87)[_0x3fa4b4(0x138)](_0x3457b8=>({..._0x3457b8,'turnover':Math[_0x3fa4b4(0x124)](_0x3457b8['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x3fa4b4(0x124)](_0x3457b8[_0x3fa4b4(0x100)]*0x64)/0x64,'gatewayEarnings':Math[_0x3fa4b4(0x124)](_0x3457b8[_0x3fa4b4(0x183)]*0x64)/0x64}))[_0x3fa4b4(0x1c2)]((_0x488d21,_0x43ee35)=>_0x488d21[_0x3fa4b4(0xc9)][_0x3fa4b4(0xb1)](_0x43ee35[_0x3fa4b4(0xc9)])),'periodInfo':{'from':_0x69eb42,'to':_0x42e888,'periodType':_0x1510a9[_0x3fa4b4(0xee)]||_0x3fa4b4(0xd3),'daysCount':_0x53ba51}};return console['log'](_0x3fa4b4(0x202)),console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x13c)+_0x33009b[_0x3fa4b4(0x110)]+_0x3fa4b4(0xf9)),console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x1ba)+_0x33009b[_0x3fa4b4(0x100)]+_0x3fa4b4(0xf9)),console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x1ae)+_0x33009b['gatewayEarnings']+'\x20USDT'),console[_0x3fa4b4(0xa8)]('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x33009b['totalPaidOut']+'\x20USDT'),console[_0x3fa4b4(0xa8)](_0x3fa4b4(0x191)+_0x33009b[_0x3fa4b4(0x97)]+'\x20USDT'),console[_0x3fa4b4(0xa8)](_0x3fa4b4(0xc0)+_0x33009b['totalPayments']),_0x33009b;}async[a46_0x38be63(0x17c)](_0x56027c){const _0x44ab60=a46_0x38be63;console[_0x44ab60(0xa8)](_0x44ab60(0x196),{'hasPayoutHistory':_0x56027c});let _0x2fd282={};_0x56027c&&(_0x2fd282['payouts']={'some':{}});const _0x5243dd=await database_1[_0x44ab60(0x13d)][_0x44ab60(0x143)][_0x44ab60(0x99)]({'where':_0x2fd282,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x44ab60(0xa8)](_0x44ab60(0x189)+_0x5243dd[_0x44ab60(0x1c9)]+_0x44ab60(0x159)+(_0x56027c?_0x44ab60(0x1e5):'')),_0x5243dd[_0x44ab60(0x138)](_0x88e6bc=>({'id':_0x88e6bc['id'],'username':_0x88e6bc[_0x44ab60(0xaa)],'name':_0x88e6bc[_0x44ab60(0x188)]}));}['getGatewayDisplayName'](_0x16948e){const _0x2eaaa4=a46_0x38be63,_0x5a361c={'test_gateway':'Test\x20Gateway','plisio':_0x2eaaa4(0x137),'rapyd':_0x2eaaa4(0x15c),'noda':_0x2eaaa4(0xd1),'cointopay':_0x2eaaa4(0xb0),'cointopay2':_0x2eaaa4(0xe5),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x2eaaa4(0x1bc),'klyme_de':'KLYME\x20DE','mastercard':_0x2eaaa4(0xfe)};return _0x5a361c[_0x16948e]||_0x16948e;}[a46_0x38be63(0xbb)](_0x9ca909){const _0x294802=a46_0x38be63,_0xbd84be={'Test\x20Gateway':_0x294802(0x1d1),'Plisio':'plisio','Rapyd':_0x294802(0x1d0),'Noda':_0x294802(0xde),'CoinToPay':'cointopay','CoinToPay2':'cointopay2','KLYME\x20EU':_0x294802(0x123),'KLYME\x20GB':_0x294802(0x1ce),'KLYME\x20DE':_0x294802(0x128),'MasterCard':_0x294802(0xa4)};return _0xbd84be[_0x9ca909]||_0x9ca909[_0x294802(0x119)]();}async['getMerchantsAwaitingPayout'](_0x4d4b71){const _0x1446af=a46_0x38be63,{page:_0x1c077d,limit:_0x4312cf,minAmount:_0xc04f34,search:_0x4bdf27}=_0x4d4b71;console[_0x1446af(0xa8)](_0x1446af(0x91),_0x4d4b71);let _0x575977={};_0x4bdf27&&(_0x575977[_0x1446af(0x188)]={'contains':_0x4bdf27,'mode':_0x1446af(0xab)});const _0xf47b0f=await database_1[_0x1446af(0x13d)][_0x1446af(0x143)][_0x1446af(0x99)]({'where':_0x575977,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x3c04b3=_0xf47b0f[_0x1446af(0x9f)](_0x4f1382=>{const _0x114d99=_0x1446af,_0x1ffaa8=Math[_0x114d99(0x18b)](_0x4f1382[_0x114d99(0x8c)]*0x64)/0x64;if(_0xc04f34&&_0x1ffaa8<_0xc04f34)return![];return _0x1ffaa8!==0x0;});_0x3c04b3[_0x1446af(0x1c2)]((_0x5c3a9d,_0x2e036a)=>_0x2e036a['balance']-_0x5c3a9d[_0x1446af(0x8c)]);const _0x1ee8f7=_0x3c04b3[_0x1446af(0x1c9)],_0x51fc91=(_0x1c077d-0x1)*_0x4312cf,_0x4a4cc5=_0x3c04b3[_0x1446af(0x173)](_0x51fc91,_0x51fc91+_0x4312cf);console[_0x1446af(0xa8)](_0x1446af(0x13a)+_0x4a4cc5['length']+_0x1446af(0x141));const _0x4373d6=await Promise['all'](_0x4a4cc5['map'](async _0x5ea163=>{const _0x4cf17d=_0x1446af,[_0x204469,_0x218386,_0x31ce4b]=await Promise[_0x4cf17d(0x1c3)]([database_1[_0x4cf17d(0x13d)][_0x4cf17d(0x1c7)]['count']({'where':{'shopId':_0x5ea163['id'],'status':_0x4cf17d(0x13f),'gateway':{'not':'test_gateway'}}}),database_1[_0x4cf17d(0x13d)]['payment'][_0x4cf17d(0x1c0)]({'where':{'shopId':_0x5ea163['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x4cf17d(0x13d)][_0x4cf17d(0x1c7)][_0x4cf17d(0x10f)]({'by':['gateway'],'where':{'shopId':_0x5ea163['id'],'status':_0x4cf17d(0x13f),'gateway':{'not':_0x4cf17d(0x1d1)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4d36a4=new Date(),_0x1d8fa6=new Date(_0x4d36a4[_0x4cf17d(0x11a)](),_0x4d36a4['getMonth'](),0x1),_0x28ee5e=new Date(_0x4d36a4[_0x4cf17d(0x11a)](),_0x4d36a4[_0x4cf17d(0x190)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x157942,_0x10bb29]=await Promise[_0x4cf17d(0x1c3)]([database_1[_0x4cf17d(0x13d)][_0x4cf17d(0xec)][_0x4cf17d(0x9c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5ea163['id'],'status':'COMPLETED'}}),database_1[_0x4cf17d(0x13d)]['payout'][_0x4cf17d(0x9c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5ea163['id'],'status':_0x4cf17d(0x18d),'createdAt':{'gte':_0x1d8fa6,'lte':_0x28ee5e}}})]),_0x548b5f=_0x157942[_0x4cf17d(0xbe)][_0x4cf17d(0x1b7)]||0x0,_0x1a73b3=_0x10bb29[_0x4cf17d(0xbe)][_0x4cf17d(0x1b7)]||0x0,_0x2c68fc=await Promise[_0x4cf17d(0x1c3)](_0x31ce4b['map'](async _0x25c242=>{const _0x55bfb4=_0x4cf17d;let _0x29f5c4=0x2d;if(_0x5ea163['gatewaySettings'])try{const _0xdbf5fc=JSON[_0x55bfb4(0x1b3)](_0x5ea163[_0x55bfb4(0xdf)]);for(const [_0x5daed9,_0x532c63]of Object[_0x55bfb4(0xa9)](_0xdbf5fc)){if(_0x5daed9[_0x55bfb4(0x119)]()===_0x25c242[_0x55bfb4(0x11c)][_0x55bfb4(0x119)]()){_0x29f5c4=_0x532c63['commission']||0xa,console[_0x55bfb4(0xa8)](_0x55bfb4(0x15e)+_0x25c242[_0x55bfb4(0x11c)]+_0x55bfb4(0xf0)+_0x5ea163['id']+':\x20commission\x20=\x20'+_0x29f5c4+'%');break;}}}catch(_0x36cad6){console[_0x55bfb4(0xa2)](_0x55bfb4(0x98)+_0x5ea163['id']+':',_0x36cad6);}const _0x1da3d8=_0x25c242[_0x55bfb4(0xbe)]?.['amountUSDT']||0x0,_0x4d1f1a=_0x1da3d8*(0x1-_0x29f5c4/0x64);return{'gateway':_0x25c242['gateway'],'count':_0x25c242['_count']?.['id']||0x0,'amountUSDT':Math[_0x55bfb4(0x124)](_0x1da3d8*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x55bfb4(0x124)](_0x4d1f1a*0x64)/0x64,'commission':_0x29f5c4};})),_0x34121a=_0x2c68fc[_0x4cf17d(0xe8)]((_0x556841,_0x2351d9)=>_0x556841+_0x2351d9[_0x4cf17d(0x1a7)],0x0),_0x2ce553=_0x2c68fc[_0x4cf17d(0xe8)]((_0x204082,_0xe22ab1)=>_0x204082+_0xe22ab1['amountAfterCommissionUSDT'],0x0),_0x46f1b6=_0x5ea163[_0x4cf17d(0x8c)];return console['log'](_0x4cf17d(0x1df)+_0x5ea163[_0x4cf17d(0xaa)]+':'),console[_0x4cf17d(0xa8)](_0x4cf17d(0xb8)+_0x34121a['toFixed'](0x2)+_0x4cf17d(0xbc)),console[_0x4cf17d(0xa8)](_0x4cf17d(0x1f8)+_0x2ce553['toFixed'](0x2)+_0x4cf17d(0x158)),console[_0x4cf17d(0xa8)](_0x4cf17d(0x12d)+_0x46f1b6[_0x4cf17d(0x1ab)](0x2)+_0x4cf17d(0xa1)),console[_0x4cf17d(0xa8)](_0x4cf17d(0x96)+_0x548b5f['toFixed'](0x2)+_0x4cf17d(0xf1)),console[_0x4cf17d(0xa8)](_0x4cf17d(0x1af)+(_0x2ce553-_0x548b5f-_0x46f1b6)[_0x4cf17d(0x1ab)](0x2)+_0x4cf17d(0x1eb)),{'id':_0x5ea163['id'],'fullName':_0x5ea163[_0x4cf17d(0x188)],'username':_0x5ea163[_0x4cf17d(0xaa)],'telegramId':_0x5ea163['telegram'],'merchantUrl':_0x5ea163[_0x4cf17d(0x18a)],'wallets':{'usdtPolygonWallet':_0x5ea163[_0x4cf17d(0x170)],'usdtTrcWallet':_0x5ea163['usdtTrcWallet'],'usdtErcWallet':_0x5ea163[_0x4cf17d(0x1db)],'usdcPolygonWallet':_0x5ea163[_0x4cf17d(0x9d)],'usdcErcWallet':_0x5ea163[_0x4cf17d(0x1a3)]},'totalAmountUSDT':Math[_0x4cf17d(0x124)](_0x34121a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4cf17d(0x124)](_0x2ce553*0x64)/0x64,'currentBalance':Math['floor'](_0x46f1b6*0x64)/0x64,'totalPayout':Math[_0x4cf17d(0x124)](_0x548b5f*0x64)/0x64,'thisMonth':Math[_0x4cf17d(0x124)](_0x1a73b3*0x64)/0x64,'paymentsCount':_0x204469,'oldestPaymentDate':_0x218386?.['paidAt']||_0x5ea163[_0x4cf17d(0x1aa)],'gatewayBreakdown':_0x2c68fc};})),_0x313845=_0x4373d6[_0x1446af(0xe8)]((_0x312acf,_0x5c258c)=>_0x312acf+_0x5c258c[_0x1446af(0xa6)],0x0),_0x238963=_0x4373d6[_0x1446af(0xe8)]((_0xa14ab3,_0x30016b)=>_0xa14ab3+_0x30016b[_0x1446af(0x1d2)],0x0),_0x33a40b=_0x4373d6['reduce']((_0x46fad8,_0x19eb1d)=>_0x46fad8+_0x19eb1d[_0x1446af(0x121)],0x0),_0x5bd088=_0x4373d6[_0x1446af(0xe8)]((_0x432b2f,_0x1733dc)=>_0x432b2f+_0x1733dc[_0x1446af(0xca)],0x0);return console['log'](_0x1446af(0x165)+_0x1ee8f7+_0x1446af(0x1fa)),console[_0x1446af(0xa8)](_0x1446af(0x19a)+Math[_0x1446af(0x124)](_0x313845*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x1446af(0xa8)](_0x1446af(0xdd)+Math[_0x1446af(0x124)](_0x238963*0x64)/0x64+_0x1446af(0x177)),console[_0x1446af(0xa8)](_0x1446af(0xfb)+Math['round'](_0x33a40b*0x64)/0x64+_0x1446af(0xf9)),console[_0x1446af(0xa8)](_0x1446af(0x12a)+Math['round'](_0x5bd088*0x64)/0x64+_0x1446af(0xf9)),{'merchants':_0x4373d6,'pagination':{'page':_0x1c077d,'limit':_0x4312cf,'total':_0x1ee8f7,'totalPages':Math['ceil'](_0x1ee8f7/_0x4312cf)},'summary':{'totalMerchants':_0x1ee8f7,'totalAmountUSDT':Math[_0x1446af(0x124)](_0x313845*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1446af(0x124)](_0x238963*0x64)/0x64,'totalPayout':Math[_0x1446af(0x124)](_0x33a40b*0x64)/0x64,'thisMonth':Math[_0x1446af(0x124)](_0x5bd088*0x64)/0x64}};}async[a46_0x38be63(0xd8)](_0x8d2a2c){const _0xff7d39=a46_0x38be63,{shopId:_0x2607c3,amount:_0x3fb48b,network:_0xa98982,wallet:_0x32e907,notes:_0x3780ae,txid:_0x9a52c4,periodFrom:_0x11c27f,periodTo:_0x5ecc7c}=_0x8d2a2c,_0x5a2daf=await database_1[_0xff7d39(0x13d)][_0xff7d39(0x19d)](async _0x2f9c02=>{const _0x50899e=_0xff7d39,_0x43ef55=await _0x2f9c02[_0x50899e(0x143)][_0x50899e(0x184)]({'where':{'id':_0x2607c3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x43ef55)throw new Error(_0x50899e(0xe9));console[_0x50899e(0xa8)](_0x50899e(0xa3)+_0x43ef55[_0x50899e(0xaa)]+':'),console[_0x50899e(0xa8)](_0x50899e(0x164)+_0x43ef55[_0x50899e(0x8c)]['toFixed'](0x6)+_0x50899e(0xf9)),console[_0x50899e(0xa8)](_0x50899e(0xaf)+_0x3fb48b['toFixed'](0x6)+_0x50899e(0xf9)),console['log'](_0x50899e(0x1c5)+_0x43ef55[_0x50899e(0xb6)][_0x50899e(0x1ab)](0x6)+'\x20USDT');if(_0x9a52c4)console[_0x50899e(0xa8)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x9a52c4);const _0x33ea28=0.000001,_0x43f7bb=Number(_0x43ef55[_0x50899e(0x8c)]),_0xfdbfb6=Number(_0x3fb48b);console[_0x50899e(0xa8)](_0x50899e(0x1a5)),console[_0x50899e(0xa8)](_0x50899e(0x1d9)+_0x43ef55['balance']),console[_0x50899e(0xa8)](_0x50899e(0x1ff)+_0x43f7bb),console[_0x50899e(0xa8)](_0x50899e(0xa5)+_0xfdbfb6),console[_0x50899e(0xa8)](_0x50899e(0xb2)+(_0x43f7bb-_0xfdbfb6)),console[_0x50899e(0xa8)](_0x50899e(0x93)+_0x33ea28);if(_0x43f7bb<_0xfdbfb6-_0x33ea28)throw new Error(_0x50899e(0x1e2)+_0x43f7bb[_0x50899e(0x1ab)](0x6)+_0x50899e(0x151)+_0xfdbfb6[_0x50899e(0x1ab)](0x6)+_0x50899e(0x149)+(_0x43f7bb-_0xfdbfb6)['toFixed'](0x8)+_0x50899e(0xf9));console[_0x50899e(0xa8)](_0x50899e(0xd9));const _0x389146=Math[_0x50899e(0x1ac)](_0x43f7bb,_0xfdbfb6);let _0x30ff70=_0x32e907;console['log'](_0x50899e(0x1de)+(_0x32e907||'not\x20provided'));if(!_0x30ff70){console[_0x50899e(0xa8)]('üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x275d02=await _0x2f9c02[_0x50899e(0x143)][_0x50899e(0x184)]({'where':{'id':_0x2607c3},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x50899e(0xa8)]('üîç\x20Shop\x20wallets:',_0x275d02);if(_0x275d02)switch(_0xa98982){case _0x50899e(0xd7):_0x30ff70=_0x275d02['usdtPolygonWallet']||undefined,console[_0x50899e(0xa8)](_0x50899e(0xe3)+_0x30ff70);break;case _0x50899e(0x1b0):_0x30ff70=_0x275d02[_0x50899e(0x1d6)]||undefined,console[_0x50899e(0xa8)]('üîç\x20Selected\x20trc20\x20wallet:\x20'+_0x30ff70);break;case _0x50899e(0x198):_0x30ff70=_0x275d02['usdtErcWallet']||undefined,console[_0x50899e(0xa8)](_0x50899e(0x15d)+_0x30ff70);break;case'polygon_usdc':_0x30ff70=_0x275d02[_0x50899e(0x9d)]||undefined,console[_0x50899e(0xa8)](_0x50899e(0xc6)+_0x30ff70);break;case _0x50899e(0x18e):_0x30ff70=_0x275d02['usdcErcWallet']||undefined,console['log']('üîç\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x30ff70);break;}}else console[_0x50899e(0xa8)](_0x50899e(0x115)+_0x30ff70);console[_0x50899e(0xa8)](_0x50899e(0x105)+_0xa98982+':\x20'+(_0x30ff70||_0x50899e(0x134))),console[_0x50899e(0xa8)]('üîç\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x2607c3,'amount':_0x389146,'network':_0xa98982,'wallet':_0x30ff70,'status':_0x50899e(0x18d),'txid':_0x9a52c4,'notes':_0x3780ae,'periodFrom':_0x11c27f?new Date(_0x11c27f):null,'periodTo':_0x5ecc7c?new Date(_0x5ecc7c):null});const _0x1c0af9=await _0x2f9c02['payout']['create']({'data':{'shopId':_0x2607c3,'amount':_0x389146,'network':_0xa98982,'wallet':_0x30ff70,'status':_0x50899e(0x18d),'txid':_0x9a52c4,'notes':_0x3780ae,'periodFrom':_0x11c27f?new Date(_0x11c27f):null,'periodTo':_0x5ecc7c?new Date(_0x5ecc7c):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x50899e(0xa8)](_0x50899e(0xae),{'id':_0x1c0af9['id'],'wallet':_0x1c0af9[_0x50899e(0xad)],'network':_0x1c0af9['network'],'amount':_0x1c0af9[_0x50899e(0x1b7)]});const _0x35bf6e=_0x43f7bb-_0x389146,_0x206533=Number(_0x43ef55[_0x50899e(0xb6)])+_0x389146;return await _0x2f9c02[_0x50899e(0x143)]['update']({'where':{'id':_0x2607c3},'data':{'balance':_0x35bf6e,'totalPaidOut':_0x206533}}),console['log'](_0x50899e(0x167)+_0x43ef55['username']+_0x50899e(0x10c)),console['log'](_0x50899e(0xfa)+_0x43f7bb[_0x50899e(0x1ab)](0x6)+_0x50899e(0x114)+_0x35bf6e['toFixed'](0x6)+_0x50899e(0x111)+_0x389146[_0x50899e(0x1ab)](0x6)+')'),console[_0x50899e(0xa8)](_0x50899e(0x18f)+_0x43ef55['totalPaidOut'][_0x50899e(0x1ab)](0x6)+_0x50899e(0x114)+_0x206533[_0x50899e(0x1ab)](0x6)+'\x20USDT\x20(+'+_0x389146[_0x50899e(0x1ab)](0x6)+')'),console[_0x50899e(0xa8)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x389146['toFixed'](0x6)+_0x50899e(0xf9)),{'payout':_0x1c0af9,'shop':_0x43ef55};});console['log'](_0xff7d39(0xfd)+_0x5a2daf[_0xff7d39(0xec)]['id']+'\x20for\x20shop\x20'+_0x5a2daf[_0xff7d39(0x143)][_0xff7d39(0xaa)]+'\x20('+_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x1b7)][_0xff7d39(0x1ab)](0x6)+_0xff7d39(0x17b));try{let _0x24012f='–ù–µ\x20—É–∫–∞–∑–∞–Ω';if(_0x5a2daf['payout']['periodFrom']&&_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x186)]){const _0x2b60ee=new Date(_0x5a2daf['payout']['periodFrom'])['toLocaleDateString'](_0xff7d39(0xff)),_0x2ad23a=new Date(_0x5a2daf[_0xff7d39(0xec)]['periodTo'])[_0xff7d39(0x1a8)]('ru-RU');_0x24012f=_0x2b60ee+_0xff7d39(0x107)+_0x2ad23a;}await telegramBotService_1['telegramBotService'][_0xff7d39(0x1f6)](_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x15a)],{'id':_0x5a2daf['payout']['id'],'amount':_0x5a2daf['payout'][_0xff7d39(0x1b7)],'network':_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x104)],'wallet':_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0xad)],'period':_0x24012f,'createdAt':_0x5a2daf[_0xff7d39(0xec)]['createdAt'],'txid':_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x1ad)]}),console[_0xff7d39(0xa8)]('üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x5a2daf[_0xff7d39(0xec)]['id']);}catch(_0x8a0fc8){console[_0xff7d39(0xa2)](_0xff7d39(0x1a1)+_0x5a2daf[_0xff7d39(0xec)]['id']+':',_0x8a0fc8);}return{'id':_0x5a2daf[_0xff7d39(0xec)]['id'],'shopId':_0x5a2daf[_0xff7d39(0xec)]['shopId'],'shopName':_0x5a2daf[_0xff7d39(0x143)][_0xff7d39(0x188)],'shopUsername':_0x5a2daf[_0xff7d39(0x143)][_0xff7d39(0xaa)],'amount':_0x5a2daf['payout'][_0xff7d39(0x1b7)],'network':_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x104)],'wallet':_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0xad)],'status':_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x171)],'txid':_0x5a2daf['payout'][_0xff7d39(0x1ad)],'notes':_0x5a2daf['payout']['notes'],'periodFrom':_0x5a2daf['payout'][_0xff7d39(0x147)],'periodTo':_0x5a2daf['payout'][_0xff7d39(0x186)],'createdAt':_0x5a2daf['payout'][_0xff7d39(0x1aa)],'paidAt':_0x5a2daf[_0xff7d39(0xec)][_0xff7d39(0x16f)]};}async[a46_0x38be63(0x179)](_0x49e8d3){const _0x5bcc5e=a46_0x38be63,{page:_0x549ebc,limit:_0x459abb,shopId:_0x4d31f4,network:_0x362eff,dateFrom:_0x600404,dateTo:_0x31c0bb,search:_0x243b2e}=_0x49e8d3,_0x150515=(_0x549ebc-0x1)*_0x459abb,_0x321b4d={};_0x4d31f4&&(_0x321b4d[_0x5bcc5e(0x15a)]=_0x4d31f4);_0x362eff&&(_0x321b4d[_0x5bcc5e(0x104)]=_0x362eff);if(_0x600404||_0x31c0bb){_0x321b4d[_0x5bcc5e(0x1aa)]={};if(_0x600404){const _0x2e16cc=new Date(_0x600404);_0x2e16cc['setHours'](0x0,0x0,0x0,0x1),_0x321b4d[_0x5bcc5e(0x1aa)]['gte']=_0x2e16cc,console[_0x5bcc5e(0xa8)](_0x5bcc5e(0x152)+_0x2e16cc['toISOString']());}if(_0x31c0bb){const _0x24ccd5=new Date(_0x31c0bb);_0x24ccd5[_0x5bcc5e(0xf5)](0x17,0x3b,0x3b,0x3e7),_0x321b4d['createdAt'][_0x5bcc5e(0x14d)]=_0x24ccd5,console['log'](_0x5bcc5e(0xe6)+_0x24ccd5['toISOString']());}}_0x243b2e&&(_0x321b4d['OR']=[{'shop':{'name':{'contains':_0x243b2e,'mode':_0x5bcc5e(0xab)}}},{'shop':{'username':{'contains':_0x243b2e,'mode':'insensitive'}}},{'notes':{'contains':_0x243b2e,'mode':_0x5bcc5e(0xab)}}]);const [_0x339b55,_0x113ecc]=await Promise[_0x5bcc5e(0x1c3)]([database_1[_0x5bcc5e(0x13d)]['payout'][_0x5bcc5e(0x99)]({'where':_0x321b4d,'skip':_0x150515,'take':_0x459abb,'orderBy':{'createdAt':_0x5bcc5e(0xdb)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5bcc5e(0x13d)][_0x5bcc5e(0xec)][_0x5bcc5e(0x126)]({'where':_0x321b4d})]);return{'payouts':_0x339b55['map'](_0xf499f0=>({'id':_0xf499f0['id'],'shopId':_0xf499f0[_0x5bcc5e(0x15a)],'shopName':_0xf499f0[_0x5bcc5e(0x143)]['name'],'shopUsername':_0xf499f0[_0x5bcc5e(0x143)]['username'],'amount':_0xf499f0['amount'],'network':_0xf499f0[_0x5bcc5e(0x104)],'wallet':_0xf499f0[_0x5bcc5e(0xad)],'status':_0xf499f0[_0x5bcc5e(0x171)],'txid':_0xf499f0[_0x5bcc5e(0x1ad)],'notes':_0xf499f0[_0x5bcc5e(0x102)],'periodFrom':_0xf499f0['periodFrom'],'periodTo':_0xf499f0['periodTo'],'createdAt':_0xf499f0[_0x5bcc5e(0x1aa)],'paidAt':_0xf499f0[_0x5bcc5e(0x16f)]})),'pagination':{'page':_0x549ebc,'limit':_0x459abb,'total':_0x113ecc,'totalPages':Math[_0x5bcc5e(0x17d)](_0x113ecc/_0x459abb)}};}async[a46_0x38be63(0x169)](_0x427578){const _0x39eea1=a46_0x38be63,_0x4f8213=await database_1[_0x39eea1(0x13d)][_0x39eea1(0xec)][_0x39eea1(0x184)]({'where':{'id':_0x427578},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4f8213)return null;return{'id':_0x4f8213['id'],'shopId':_0x4f8213[_0x39eea1(0x15a)],'shopName':_0x4f8213[_0x39eea1(0x143)]['name'],'shopUsername':_0x4f8213[_0x39eea1(0x143)]['username'],'amount':_0x4f8213[_0x39eea1(0x1b7)],'network':_0x4f8213[_0x39eea1(0x104)],'wallet':_0x4f8213[_0x39eea1(0xad)],'status':_0x4f8213[_0x39eea1(0x171)],'txid':_0x4f8213[_0x39eea1(0x1ad)],'notes':_0x4f8213[_0x39eea1(0x102)],'periodFrom':_0x4f8213[_0x39eea1(0x147)],'periodTo':_0x4f8213['periodTo'],'createdAt':_0x4f8213[_0x39eea1(0x1aa)],'paidAt':_0x4f8213[_0x39eea1(0x16f)]};}async['deletePayout'](_0x456ead){const _0x35c526=a46_0x38be63;await database_1[_0x35c526(0x13d)][_0x35c526(0xec)][_0x35c526(0x109)]({'where':{'id':_0x456ead}});}async[a46_0x38be63(0x1a9)](_0x20d413){const _0x3d3800=a46_0x38be63,{page:_0x4ed104,limit:_0x3c12a0,status:_0x1c21d3,gateway:_0x17ae48,shopId:_0x49ae2a,dateFrom:_0x32891c,dateTo:_0x359877,search:_0x47fe63,currency:_0x9397f7,sortBy:_0x410a6a,sortOrder:_0x3803fc}=_0x20d413,_0x449483=(_0x4ed104-0x1)*_0x3c12a0;console[_0x3d3800(0xa8)](_0x3d3800(0x1c6),_0x20d413);const _0x23fd72=await database_1['default'][_0x3d3800(0x1c7)][_0x3d3800(0x10f)]({'by':[_0x3d3800(0x11c)],'_count':{'gateway':!![]}});console[_0x3d3800(0xa8)](_0x3d3800(0xe1),_0x23fd72[_0x3d3800(0x138)](_0x4ec0aa=>_0x4ec0aa[_0x3d3800(0x11c)]+'\x20('+_0x4ec0aa[_0x3d3800(0x11d)]['gateway']+_0x3d3800(0xbd)));if(_0x17ae48){const _0x288aff=_0x23fd72[_0x3d3800(0x1ca)](_0x77920e=>_0x77920e['gateway']['toLowerCase']()===_0x17ae48[_0x3d3800(0x119)]());!_0x288aff&&_0x17ae48[_0x3d3800(0x119)]()!==_0x3d3800(0x1d1)&&console[_0x3d3800(0xa8)](_0x3d3800(0x10d)+_0x17ae48+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x23fd72[_0x3d3800(0x138)](_0x39f341=>_0x39f341['gateway'])['join'](',\x20'));}const _0x48b623={};_0x1c21d3&&(_0x48b623['status']=_0x1c21d3['toUpperCase']());if(!_0x17ae48)_0x48b623[_0x3d3800(0x11c)]={'not':_0x3d3800(0x1d1)};else{if(_0x17ae48&&(_0x17ae48[_0x3d3800(0x119)]()===_0x3d3800(0x1d1)||_0x17ae48==='0000'))_0x48b623[_0x3d3800(0x11c)]='test_gateway';else{let _0x297975=_0x17ae48;const _0x5b8872=(0x0,gateway_1[_0x3d3800(0xc4)])(_0x17ae48);if(_0x5b8872)_0x297975=_0x5b8872,console[_0x3d3800(0xa8)](_0x3d3800(0xef)+_0x17ae48+_0x3d3800(0x13b)+_0x297975+'\x27');else{const _0x5724e9=(0x0,gateway_1[_0x3d3800(0x12b)])(_0x17ae48);if(_0x5724e9){const _0x5b812c=(0x0,gateway_1[_0x3d3800(0xc4)])(_0x5724e9);_0x5b812c&&(_0x297975=_0x5b812c,console[_0x3d3800(0xa8)](_0x3d3800(0x176)+_0x17ae48+_0x3d3800(0x19f)+_0x5724e9+_0x3d3800(0xe7)+_0x297975+'\x27'));}else console[_0x3d3800(0xa8)]('üîç\x20Using\x20gateway\x20\x27'+_0x17ae48+_0x3d3800(0x1f9));}const _0x261892=await database_1[_0x3d3800(0x13d)][_0x3d3800(0x1c7)][_0x3d3800(0x126)]({'where':{'gateway':_0x297975[_0x3d3800(0x119)]()},'take':0x1});_0x261892===0x0?(console[_0x3d3800(0xa8)](_0x3d3800(0x1b9)+_0x297975+_0x3d3800(0x12c)+_0x17ae48+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x48b623[_0x3d3800(0x11c)]=_0x3d3800(0x8b)):(_0x48b623[_0x3d3800(0x11c)]=_0x297975[_0x3d3800(0x119)](),console[_0x3d3800(0xa8)]('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0x297975+_0x3d3800(0x12c)+_0x17ae48+'\x27)'));}}console['log'](_0x3d3800(0xd5),_0x48b623[_0x3d3800(0x11c)]);_0x49ae2a&&(_0x48b623[_0x3d3800(0x15a)]=_0x49ae2a);_0x9397f7&&(_0x48b623[_0x3d3800(0x17e)]=_0x9397f7[_0x3d3800(0x161)](),console['log'](_0x3d3800(0x1bf)+_0x9397f7[_0x3d3800(0x161)]()));if(_0x32891c||_0x359877){_0x48b623[_0x3d3800(0x1aa)]={};if(_0x32891c){const _0x239ce0=new Date(_0x32891c);_0x239ce0[_0x3d3800(0xf5)](0x0,0x0,0x0,0x1),_0x48b623['createdAt'][_0x3d3800(0x1a0)]=_0x239ce0,console['log'](_0x3d3800(0xc8)+_0x239ce0[_0x3d3800(0x187)]());}if(_0x359877){const _0x4f9d5a=new Date(_0x359877);_0x4f9d5a['setHours'](0x17,0x3b,0x3b,0x3e7),_0x48b623[_0x3d3800(0x1aa)][_0x3d3800(0x14d)]=_0x4f9d5a,console[_0x3d3800(0xa8)](_0x3d3800(0xb5)+_0x4f9d5a[_0x3d3800(0x187)]());}}_0x47fe63&&(_0x48b623['OR']=[{'id':{'contains':_0x47fe63,'mode':'insensitive'}},{'orderId':{'contains':_0x47fe63,'mode':_0x3d3800(0xab)}},{'gatewayOrderId':{'contains':_0x47fe63,'mode':'insensitive'}},{'customerEmail':{'contains':_0x47fe63,'mode':_0x3d3800(0xab)}},{'shop':{'name':{'contains':_0x47fe63,'mode':_0x3d3800(0xab)}}},{'shop':{'username':{'contains':_0x47fe63,'mode':_0x3d3800(0xab)}}}]);console[_0x3d3800(0xa8)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x3d3800(0x1b2)](_0x48b623,null,0x2));let _0x5e61d2={'createdAt':_0x3d3800(0xdb)};if(_0x410a6a){const _0x2ac344=[_0x3d3800(0x1b7),'createdAt','updatedAt',_0x3d3800(0x171),_0x3d3800(0x11c),_0x3d3800(0x17e)],_0x5e0eb9=[_0x3d3800(0x10b),_0x3d3800(0xdb)];if(_0x2ac344[_0x3d3800(0xf2)](_0x410a6a)){const _0x4b5243=_0x5e0eb9['includes'](_0x3803fc)?_0x3803fc:'desc';_0x5e61d2={[_0x410a6a]:_0x4b5243},console[_0x3d3800(0xa8)](_0x3d3800(0xe4)+_0x410a6a+'\x20in\x20'+_0x4b5243+_0x3d3800(0x1f1));}}const [_0x4776a4,_0x16994a]=await Promise[_0x3d3800(0x1c3)]([database_1['default'][_0x3d3800(0x1c7)][_0x3d3800(0x99)]({'where':_0x48b623,'skip':_0x449483,'take':_0x3c12a0,'orderBy':_0x5e61d2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x3d3800(0x1c7)][_0x3d3800(0x126)]({'where':_0x48b623})]);return{'payments':_0x4776a4,'pagination':{'page':_0x4ed104,'limit':_0x3c12a0,'total':_0x16994a,'totalPages':Math[_0x3d3800(0x17d)](_0x16994a/_0x3c12a0)}};}async[a46_0x38be63(0xf8)](_0x50bd13){const _0x16f2f0=a46_0x38be63,_0x3213a8=await database_1[_0x16f2f0(0x13d)]['payment']['findUnique']({'where':{'id':_0x50bd13},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3213a8)return null;return{'id':_0x3213a8['id'],'shopId':_0x3213a8[_0x16f2f0(0x15a)],'gateway':_0x3213a8[_0x16f2f0(0x11c)],'amount':_0x3213a8[_0x16f2f0(0x1b7)],'currency':_0x3213a8[_0x16f2f0(0x17e)],'status':_0x3213a8[_0x16f2f0(0x171)],'orderId':_0x3213a8[_0x16f2f0(0xc7)],'gatewayOrderId':_0x3213a8['gatewayOrderId'],'customerEmail':_0x3213a8[_0x16f2f0(0x8e)],'customerName':_0x3213a8[_0x16f2f0(0x156)],'customerCountry':_0x3213a8[_0x16f2f0(0x1fe)],'customerIp':_0x3213a8[_0x16f2f0(0xd4)],'customerUa':_0x3213a8['customerUa'],'failureMessage':_0x3213a8[_0x16f2f0(0x12e)],'externalPaymentUrl':_0x3213a8[_0x16f2f0(0x101)],'successUrl':_0x3213a8['successUrl'],'failUrl':_0x3213a8[_0x16f2f0(0xb9)],'pendingUrl':_0x3213a8[_0x16f2f0(0x16e)],'whiteUrl':_0x3213a8[_0x16f2f0(0x106)],'createdAt':_0x3213a8[_0x16f2f0(0x1aa)],'updatedAt':_0x3213a8[_0x16f2f0(0xd0)],'shop':_0x3213a8[_0x16f2f0(0x143)]};}async[a46_0x38be63(0x14c)](_0x48b30d,_0x213596,_0x9f81fb,_0x16bc59){const _0x54ee53=a46_0x38be63,_0x2bf2a5=await database_1[_0x54ee53(0x13d)][_0x54ee53(0x19d)](async _0x5e6e66=>{const _0xe6c483=_0x54ee53,_0x123b58=await _0x5e6e66[_0xe6c483(0x1c7)][_0xe6c483(0x184)]({'where':{'id':_0x48b30d},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x123b58)throw new Error(_0xe6c483(0x1cf));const _0x5a250f=_0x123b58['status'],_0x2802fb=_0x213596[_0xe6c483(0x161)]();console[_0xe6c483(0xa8)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x48b30d+_0xe6c483(0x194)+_0x5a250f+_0xe6c483(0x114)+_0x2802fb),console[_0xe6c483(0xa8)]('üí∞\x20Current\x20shop\x20balance:\x20'+_0x123b58[_0xe6c483(0x143)][_0xe6c483(0x8c)]+_0xe6c483(0xf9));const _0xd65158={'status':_0x2802fb,'updatedAt':new Date(),'statusChangedBy':_0xe6c483(0x19e),'statusChangedAt':new Date()};_0x9f81fb&&(_0xd65158[_0xe6c483(0xeb)]=_0x9f81fb);_0x2802fb==='CHARGEBACK'&&_0x16bc59&&(_0xd65158['chargebackAmount']=_0x16bc59);let _0x30938d=0x0,_0x358d9d=_0x123b58[_0xe6c483(0x143)][_0xe6c483(0x8c)];if(_0x2802fb===_0xe6c483(0x13f)&&_0x5a250f!==_0xe6c483(0x13f)){_0xd65158[_0xe6c483(0x16f)]=new Date();const _0x61cc78=await currencyService_1[_0xe6c483(0x1e3)]['convertToUSDT'](_0x123b58[_0xe6c483(0x1b7)],_0x123b58[_0xe6c483(0x17e)]);_0xd65158['amountUSDT']=_0x61cc78;let _0x58a5aa=0x2d;const _0x4ccf52=await _0x5e6e66['shop'][_0xe6c483(0x184)]({'where':{'id':_0x123b58[_0xe6c483(0x15a)]},'select':{'gatewaySettings':!![]}});if(_0x4ccf52?.[_0xe6c483(0xdf)])try{const _0x51b437=JSON[_0xe6c483(0x1b3)](_0x4ccf52[_0xe6c483(0xdf)]);for(const [_0x22acd4,_0x58c0eb]of Object['entries'](_0x51b437)){if(_0x22acd4['toLowerCase']()===_0x123b58[_0xe6c483(0x11c)][_0xe6c483(0x119)]()){_0x58a5aa=_0x58c0eb[_0xe6c483(0x90)]||0xa;break;}}}catch(_0x598bfc){console['error'](_0xe6c483(0x1fd)+_0x48b30d+':',_0x598bfc);}let _0x61c633;_0x123b58[_0xe6c483(0x182)]!==null&&_0x123b58['amountAfterGatewayCommissionUSDT']!==undefined?(_0x61c633=_0x123b58[_0xe6c483(0x182)],console['log'](_0xe6c483(0x117)+_0x61c633[_0xe6c483(0x1ab)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x48b30d)):(_0x61c633=_0x61cc78*(0x1-_0x58a5aa/0x64),console[_0xe6c483(0xa8)]('üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x48b30d+':\x20'+_0x58a5aa+_0xe6c483(0x150)+_0x61cc78[_0xe6c483(0x1ab)](0x6)+_0xe6c483(0xf9)),_0xd65158[_0xe6c483(0x182)]=_0x61c633,_0xd65158[_0xe6c483(0x1d4)]=_0x58a5aa),_0x30938d=_0x61c633,_0x358d9d+=_0x61c633,console[_0xe6c483(0xa8)](_0xe6c483(0x1d3)+_0x48b30d+_0xe6c483(0x1e8)),console[_0xe6c483(0xa8)](_0xe6c483(0x122)+_0x61cc78[_0xe6c483(0x1ab)](0x6)+'\x20USDT'),console[_0xe6c483(0xa8)]('\x20\x20\x20Gateway:\x20'+_0x123b58[_0xe6c483(0x11c)]+_0xe6c483(0x145)+_0x58a5aa+'%'),console[_0xe6c483(0xa8)](_0xe6c483(0xf4)+_0x61c633[_0xe6c483(0x1ab)](0x6)+_0xe6c483(0x1e4)+_0x58a5aa+_0xe6c483(0x1c1)),console[_0xe6c483(0xa8)](_0xe6c483(0x112)+_0x61c633[_0xe6c483(0x1ab)](0x6)+_0xe6c483(0xf9));}else{if(_0x5a250f===_0xe6c483(0x13f)&&_0x2802fb!=='PAID'&&_0x2802fb!=='CHARGEBACK'){if(_0x123b58['amountUSDT']){let _0x406daf=0x2d;const _0x3285ce=await _0x5e6e66[_0xe6c483(0x143)][_0xe6c483(0x184)]({'where':{'id':_0x123b58[_0xe6c483(0x15a)]},'select':{'gatewaySettings':!![]}});if(_0x3285ce?.[_0xe6c483(0xdf)])try{const _0x290c66=JSON[_0xe6c483(0x1b3)](_0x3285ce['gatewaySettings']);for(const [_0x4a3484,_0x3b7959]of Object['entries'](_0x290c66)){if(_0x4a3484[_0xe6c483(0x119)]()===_0x123b58[_0xe6c483(0x11c)]['toLowerCase']()){_0x406daf=_0x3b7959[_0xe6c483(0x90)]||0xa;break;}}}catch(_0x5ca865){console[_0xe6c483(0xa2)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x48b30d+':',_0x5ca865);}const _0x4f9f72=_0x123b58['amountUSDT']*(0x1-_0x406daf/0x64);_0x30938d=-_0x4f9f72,_0x358d9d-=_0x4f9f72,console[_0xe6c483(0xa8)](_0xe6c483(0x122)+_0x123b58[_0xe6c483(0x1a7)][_0xe6c483(0x1ab)](0x6)+_0xe6c483(0xf9)),console[_0xe6c483(0xa8)](_0xe6c483(0x178)+_0x123b58['gateway']+',\x20Commission:\x20'+_0x406daf+'%'),console[_0xe6c483(0xa8)](_0xe6c483(0x9b)+_0x4f9f72[_0xe6c483(0x1ab)](0x6)+_0xe6c483(0x1e4)+_0x406daf+_0xe6c483(0x1c1)),console[_0xe6c483(0xa8)](_0xe6c483(0x1be)+_0x4f9f72['toFixed'](0x6)+_0xe6c483(0xf9));}}}_0x2802fb===_0xe6c483(0x185)&&(console[_0xe6c483(0xa8)](_0xe6c483(0x127)),_0x16bc59&&_0x16bc59>0x0?(_0x30938d=-_0x16bc59,_0x358d9d-=_0x16bc59,console[_0xe6c483(0xa8)](_0xe6c483(0xdc)+_0x16bc59[_0xe6c483(0x1ab)](0x6)+_0xe6c483(0x153)),console['log'](_0xe6c483(0x1b8))):console[_0xe6c483(0xa8)](_0xe6c483(0x14f)),_0xd65158['chargebackAmount']=_0x16bc59||0x0);_0x2802fb===_0xe6c483(0x1bb)&&_0x5a250f==='PAID'&&console[_0xe6c483(0xa8)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x481210=await _0x5e6e66[_0xe6c483(0x1c7)]['update']({'where':{'id':_0x48b30d},'data':_0xd65158,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x30938d!==0x0&&(await _0x5e6e66['shop'][_0xe6c483(0x9a)]({'where':{'id':_0x123b58[_0xe6c483(0x15a)]},'data':{'balance':_0x358d9d}}),console[_0xe6c483(0xa8)](_0xe6c483(0x167)+_0x123b58['shopId']+_0xe6c483(0x160)+_0x123b58['shop']['balance'][_0xe6c483(0x1ab)](0x6)+_0xe6c483(0x114)+_0x358d9d['toFixed'](0x6)+_0xe6c483(0x1b6)+(_0x30938d>0x0?'+':'')+_0x30938d[_0xe6c483(0x1ab)](0x6)+')')),_0x481210;});return{'id':_0x2bf2a5['id'],'shopId':_0x2bf2a5['shopId'],'gateway':_0x2bf2a5[_0x54ee53(0x11c)],'amount':_0x2bf2a5[_0x54ee53(0x1b7)],'currency':_0x2bf2a5[_0x54ee53(0x17e)],'status':_0x2bf2a5[_0x54ee53(0x171)],'orderId':_0x2bf2a5[_0x54ee53(0xc7)],'gatewayOrderId':_0x2bf2a5[_0x54ee53(0x131)],'customerEmail':_0x2bf2a5[_0x54ee53(0x8e)],'customerName':_0x2bf2a5[_0x54ee53(0x156)],'customerCountry':_0x2bf2a5[_0x54ee53(0x1fe)],'customerIp':_0x2bf2a5[_0x54ee53(0xd4)],'customerUa':_0x2bf2a5[_0x54ee53(0x1f2)],'failureMessage':_0x2bf2a5[_0x54ee53(0x12e)],'adminNotes':_0x2bf2a5[_0x54ee53(0xeb)],'chargebackAmount':_0x2bf2a5[_0x54ee53(0x1b1)],'statusChangedBy':_0x2bf2a5['statusChangedBy'],'statusChangedAt':_0x2bf2a5[_0x54ee53(0x19b)],'createdAt':_0x2bf2a5[_0x54ee53(0x1aa)],'updatedAt':_0x2bf2a5['updatedAt'],'shop':_0x2bf2a5[_0x54ee53(0x143)]};}async[a46_0x38be63(0x1e9)](_0x5e713a,_0x3e35c1){const _0x38c7ef=a46_0x38be63,_0x2766cd=Math['random']()[_0x38c7ef(0x148)](0x24)['substr'](0x2,0x9);console['log'](_0x38c7ef(0x1f0)+_0x2766cd+_0x38c7ef(0x155)+_0x5e713a);const _0x1170a6={..._0x3e35c1};_0x3e35c1[_0x38c7ef(0xba)]&&_0x3e35c1['password'][_0x38c7ef(0x15b)]()!==''?(console[_0x38c7ef(0xa8)](_0x38c7ef(0x16b)+_0x2766cd+']\x20Updating\x20password\x20for\x20user\x20'+_0x5e713a),_0x1170a6['password']=await bcryptjs_1[_0x38c7ef(0x13d)][_0x38c7ef(0x1bd)](_0x3e35c1[_0x38c7ef(0xba)],0xc)):(console[_0x38c7ef(0xa8)](_0x38c7ef(0x16b)+_0x2766cd+_0x38c7ef(0xe0)),delete _0x1170a6[_0x38c7ef(0xba)]);_0x3e35c1['fullName']&&(_0x1170a6[_0x38c7ef(0x188)]=_0x3e35c1[_0x38c7ef(0x8a)],delete _0x1170a6[_0x38c7ef(0x8a)]);_0x3e35c1[_0x38c7ef(0x180)]&&(_0x1170a6['telegram']=_0x3e35c1[_0x38c7ef(0x180)],delete _0x1170a6[_0x38c7ef(0x180)]);_0x3e35c1[_0x38c7ef(0x136)]&&(_0x1170a6[_0x38c7ef(0x18a)]=_0x3e35c1[_0x38c7ef(0x136)],delete _0x1170a6[_0x38c7ef(0x136)]);if(_0x3e35c1[_0x38c7ef(0x11e)]){const _0x308b5c=_0x3e35c1[_0x38c7ef(0x11e)][_0x38c7ef(0x138)](_0x215f12=>this[_0x38c7ef(0xbb)](_0x215f12));console[_0x38c7ef(0xa8)](_0x38c7ef(0xb7),_0x3e35c1[_0x38c7ef(0x11e)],'->',_0x308b5c),_0x1170a6[_0x38c7ef(0x1b5)]=JSON['stringify'](_0x308b5c),delete _0x1170a6[_0x38c7ef(0x11e)];}_0x3e35c1[_0x38c7ef(0xdf)]&&(console['log']('üîß\x20['+_0x2766cd+_0x38c7ef(0x16c),_0x3e35c1[_0x38c7ef(0xdf)]),_0x1170a6[_0x38c7ef(0xdf)]=JSON[_0x38c7ef(0x1b2)](_0x3e35c1[_0x38c7ef(0xdf)]),console[_0x38c7ef(0xa8)](_0x38c7ef(0x168)+_0x2766cd+']\x20Gateway\x20settings\x20JSON\x20string:',_0x1170a6[_0x38c7ef(0xdf)]));_0x3e35c1['wallets']&&(_0x3e35c1['wallets']['usdtPolygonWallet']!==undefined&&(_0x1170a6[_0x38c7ef(0x170)]=_0x3e35c1[_0x38c7ef(0x15f)][_0x38c7ef(0x170)]||null),_0x3e35c1['wallets'][_0x38c7ef(0x1d6)]!==undefined&&(_0x1170a6['usdtTrcWallet']=_0x3e35c1[_0x38c7ef(0x15f)]['usdtTrcWallet']||null),_0x3e35c1[_0x38c7ef(0x15f)][_0x38c7ef(0x1db)]!==undefined&&(_0x1170a6[_0x38c7ef(0x1db)]=_0x3e35c1[_0x38c7ef(0x15f)]['usdtErcWallet']||null),_0x3e35c1[_0x38c7ef(0x15f)]['usdcPolygonWallet']!==undefined&&(_0x1170a6[_0x38c7ef(0x9d)]=_0x3e35c1[_0x38c7ef(0x15f)]['usdcPolygonWallet']||null),delete _0x1170a6[_0x38c7ef(0x15f)]);const _0x46dfdf=await database_1[_0x38c7ef(0x13d)][_0x38c7ef(0x143)][_0x38c7ef(0x9a)]({'where':{'id':_0x5e713a},'data':_0x1170a6,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x38c7ef(0xa8)](_0x38c7ef(0x1e6)+_0x2766cd+_0x38c7ef(0xce),_0x46dfdf[_0x38c7ef(0xdf)]),{'id':_0x46dfdf['id'],'fullName':_0x46dfdf['name'],'username':_0x46dfdf['username'],'telegramId':_0x46dfdf['telegram'],'merchantUrl':_0x46dfdf[_0x38c7ef(0x18a)],'gateways':_0x46dfdf[_0x38c7ef(0x1b5)]?JSON[_0x38c7ef(0x1b3)](_0x46dfdf['paymentGateways']):null,'gatewaySettings':_0x46dfdf[_0x38c7ef(0xdf)]?JSON['parse'](_0x46dfdf[_0x38c7ef(0xdf)]):null,'publicKey':_0x46dfdf[_0x38c7ef(0x1cb)],'wallets':{'usdtPolygonWallet':_0x46dfdf[_0x38c7ef(0x170)],'usdtTrcWallet':_0x46dfdf['usdtTrcWallet'],'usdtErcWallet':_0x46dfdf['usdtErcWallet'],'usdcPolygonWallet':_0x46dfdf['usdcPolygonWallet']},'status':_0x46dfdf[_0x38c7ef(0x171)],'createdAt':_0x46dfdf[_0x38c7ef(0x1aa)]};}async[a46_0x38be63(0x199)](_0x5783bd){const _0x27ba8e=a46_0x38be63,_0x45bbb2=await database_1[_0x27ba8e(0x13d)][_0x27ba8e(0x143)]['update']({'where':{'id':_0x5783bd},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x45bbb2['id'],'fullName':_0x45bbb2[_0x27ba8e(0x188)],'username':_0x45bbb2[_0x27ba8e(0xaa)],'telegramId':_0x45bbb2['telegram'],'merchantUrl':_0x45bbb2[_0x27ba8e(0x18a)],'gateways':_0x45bbb2['paymentGateways']?JSON[_0x27ba8e(0x1b3)](_0x45bbb2[_0x27ba8e(0x1b5)]):null,'gatewaySettings':_0x45bbb2[_0x27ba8e(0xdf)]?JSON[_0x27ba8e(0x1b3)](_0x45bbb2[_0x27ba8e(0xdf)]):null,'publicKey':_0x45bbb2['publicKey'],'wallets':{'usdtPolygonWallet':_0x45bbb2[_0x27ba8e(0x170)],'usdtTrcWallet':_0x45bbb2[_0x27ba8e(0x1d6)],'usdtErcWallet':_0x45bbb2['usdtErcWallet'],'usdcPolygonWallet':_0x45bbb2[_0x27ba8e(0x9d)]},'status':_0x45bbb2[_0x27ba8e(0x171)],'createdAt':_0x45bbb2[_0x27ba8e(0x1aa)]};}async[a46_0x38be63(0x193)](_0x441c26){const _0x35d80a=a46_0x38be63,_0x253bf6=await database_1[_0x35d80a(0x13d)][_0x35d80a(0x143)]['update']({'where':{'id':_0x441c26},'data':{'status':_0x35d80a(0x118)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x253bf6['id'],'fullName':_0x253bf6[_0x35d80a(0x188)],'username':_0x253bf6['username'],'telegramId':_0x253bf6[_0x35d80a(0xf3)],'merchantUrl':_0x253bf6[_0x35d80a(0x18a)],'gateways':_0x253bf6['paymentGateways']?JSON[_0x35d80a(0x1b3)](_0x253bf6[_0x35d80a(0x1b5)]):null,'gatewaySettings':_0x253bf6[_0x35d80a(0xdf)]?JSON[_0x35d80a(0x1b3)](_0x253bf6[_0x35d80a(0xdf)]):null,'publicKey':_0x253bf6[_0x35d80a(0x1cb)],'wallets':{'usdtPolygonWallet':_0x253bf6[_0x35d80a(0x170)],'usdtTrcWallet':_0x253bf6[_0x35d80a(0x1d6)],'usdtErcWallet':_0x253bf6[_0x35d80a(0x1db)],'usdcPolygonWallet':_0x253bf6['usdcPolygonWallet']},'status':_0x253bf6[_0x35d80a(0x171)],'createdAt':_0x253bf6[_0x35d80a(0x1aa)]};}async[a46_0x38be63(0x132)](_0x30dede){const _0x13e730=a46_0x38be63,{page:_0x56b483,limit:_0x559b41,status:_0x4a8b38}=_0x30dede,_0x34dcf0=(_0x56b483-0x1)*_0x559b41,_0x50df7a={};_0x4a8b38&&(_0x50df7a[_0x13e730(0x171)]=_0x4a8b38['toUpperCase']());const [_0x11640f,_0x1854b9]=await Promise[_0x13e730(0x1c3)]([database_1[_0x13e730(0x13d)][_0x13e730(0x143)][_0x13e730(0x99)]({'where':_0x50df7a,'skip':_0x34dcf0,'take':_0x559b41,'orderBy':{'createdAt':_0x13e730(0xdb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x13e730(0x126)]({'where':_0x50df7a})]);return{'users':_0x11640f['map'](_0x4ac7d3=>{const _0x299bf2=_0x13e730,_0x34f357=_0x4ac7d3['paymentGateways']?JSON[_0x299bf2(0x1b3)](_0x4ac7d3[_0x299bf2(0x1b5)]):null,_0x1f4ef2=_0x34f357?_0x34f357['map'](_0x43aca5=>this[_0x299bf2(0xe2)](_0x43aca5)):null;return{'id':_0x4ac7d3['id'],'fullName':_0x4ac7d3[_0x299bf2(0x188)],'username':_0x4ac7d3['username'],'telegramId':_0x4ac7d3[_0x299bf2(0xf3)],'merchantUrl':_0x4ac7d3[_0x299bf2(0x18a)],'gateways':_0x1f4ef2,'gatewaySettings':_0x4ac7d3[_0x299bf2(0xdf)]?JSON[_0x299bf2(0x1b3)](_0x4ac7d3[_0x299bf2(0xdf)]):null,'publicKey':_0x4ac7d3['publicKey'],'wallets':{'usdtPolygonWallet':_0x4ac7d3[_0x299bf2(0x170)],'usdtTrcWallet':_0x4ac7d3[_0x299bf2(0x1d6)],'usdtErcWallet':_0x4ac7d3['usdtErcWallet'],'usdcPolygonWallet':_0x4ac7d3['usdcPolygonWallet']},'status':_0x4ac7d3[_0x299bf2(0x171)],'createdAt':_0x4ac7d3[_0x299bf2(0x1aa)]};}),'pagination':{'page':_0x56b483,'limit':_0x559b41,'total':_0x1854b9,'totalPages':Math[_0x13e730(0x17d)](_0x1854b9/_0x559b41)}};}async[a46_0x38be63(0xac)](_0x6c421f){const _0x5ab3d0=a46_0x38be63,_0x2f5106=await database_1[_0x5ab3d0(0x13d)][_0x5ab3d0(0x143)]['findUnique']({'where':{'id':_0x6c421f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2f5106)return null;const _0x346f6b=_0x2f5106[_0x5ab3d0(0x1b5)]?JSON[_0x5ab3d0(0x1b3)](_0x2f5106[_0x5ab3d0(0x1b5)]):null,_0x5b2fea=_0x346f6b?_0x346f6b['map'](_0x49be81=>this[_0x5ab3d0(0xe2)](_0x49be81)):null;return _0x346f6b&&_0x5b2fea&&console[_0x5ab3d0(0xa8)](_0x5ab3d0(0x14a),_0x346f6b,'->',_0x5b2fea),{'id':_0x2f5106['id'],'fullName':_0x2f5106['name'],'username':_0x2f5106[_0x5ab3d0(0xaa)],'telegramId':_0x2f5106[_0x5ab3d0(0xf3)],'merchantUrl':_0x2f5106[_0x5ab3d0(0x18a)],'gateways':_0x5b2fea,'gatewaySettings':_0x2f5106[_0x5ab3d0(0xdf)]?JSON[_0x5ab3d0(0x1b3)](_0x2f5106[_0x5ab3d0(0xdf)]):null,'publicKey':_0x2f5106[_0x5ab3d0(0x1cb)],'wallets':{'usdtPolygonWallet':_0x2f5106[_0x5ab3d0(0x170)],'usdtTrcWallet':_0x2f5106[_0x5ab3d0(0x1d6)],'usdtErcWallet':_0x2f5106[_0x5ab3d0(0x1db)],'usdcPolygonWallet':_0x2f5106[_0x5ab3d0(0x9d)]},'status':_0x2f5106[_0x5ab3d0(0x171)],'createdAt':_0x2f5106[_0x5ab3d0(0x1aa)]};}async[a46_0x38be63(0x1da)](_0x1aac22){const _0x4e71ae=a46_0x38be63,{fullName:_0x40ae70,username:_0x32ce22,password:_0x57b5de,telegramId:_0x51879e,merchantUrl:_0x15ce34,gateways:_0x2eb9f2,gatewaySettings:_0x5373e2,wallets:_0x23f4ab}=_0x1aac22,_0x49dce8=await database_1['default']['shop'][_0x4e71ae(0x184)]({'where':{'username':_0x32ce22}});if(_0x49dce8)throw new Error('Username\x20already\x20exists');if(_0x51879e){const _0x3b3073=await database_1[_0x4e71ae(0x13d)]['shop'][_0x4e71ae(0x184)]({'where':{'telegram':_0x51879e}});if(_0x3b3073)throw new Error(_0x4e71ae(0x1e0));}const _0x2e41ea=await bcryptjs_1[_0x4e71ae(0x13d)][_0x4e71ae(0x1bd)](_0x57b5de,0xc),_0x226dd5=_0x4e71ae(0x11f)+crypto_1[_0x4e71ae(0x13d)]['randomBytes'](0x20)[_0x4e71ae(0x148)]('hex'),_0x17861e=_0x4e71ae(0x8f)+crypto_1[_0x4e71ae(0x13d)][_0x4e71ae(0x92)](0x20)[_0x4e71ae(0x148)](_0x4e71ae(0x11b)),_0x5caa78=_0x2eb9f2?_0x2eb9f2[_0x4e71ae(0x138)](_0x10ea44=>this[_0x4e71ae(0xbb)](_0x10ea44)):null;_0x2eb9f2&&_0x5caa78&&console['log']('üîÑ\x20Gateway\x20mapping\x20(create):',_0x2eb9f2,'->',_0x5caa78);const _0x57de49=await database_1['default'][_0x4e71ae(0x143)][_0x4e71ae(0x1f4)]({'data':{'name':_0x40ae70,'username':_0x32ce22,'password':_0x2e41ea,'telegram':_0x51879e,'shopUrl':_0x15ce34,'paymentGateways':_0x5caa78?JSON[_0x4e71ae(0x1b2)](_0x5caa78):null,'gatewaySettings':_0x5373e2?JSON[_0x4e71ae(0x1b2)](_0x5373e2):null,'usdtPolygonWallet':_0x23f4ab?.[_0x4e71ae(0x170)]||null,'usdtTrcWallet':_0x23f4ab?.[_0x4e71ae(0x1d6)]||null,'usdtErcWallet':_0x23f4ab?.[_0x4e71ae(0x1db)]||null,'usdcPolygonWallet':_0x23f4ab?.[_0x4e71ae(0x9d)]||null,'publicKey':_0x226dd5,'secretKey':_0x17861e,'status':_0x4e71ae(0x118)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x57de49['id'],'fullName':_0x57de49[_0x4e71ae(0x188)],'username':_0x57de49['username'],'telegramId':_0x57de49[_0x4e71ae(0xf3)],'merchantUrl':_0x57de49[_0x4e71ae(0x18a)],'gateways':_0x57de49[_0x4e71ae(0x1b5)]?JSON['parse'](_0x57de49['paymentGateways']):null,'gatewaySettings':_0x57de49['gatewaySettings']?JSON['parse'](_0x57de49[_0x4e71ae(0xdf)]):null,'publicKey':_0x57de49[_0x4e71ae(0x1cb)],'wallets':{'usdtPolygonWallet':_0x57de49['usdtPolygonWallet'],'usdtTrcWallet':_0x57de49[_0x4e71ae(0x1d6)],'usdtErcWallet':_0x57de49[_0x4e71ae(0x1db)],'usdcPolygonWallet':_0x57de49[_0x4e71ae(0x9d)]},'status':_0x57de49[_0x4e71ae(0x171)],'createdAt':_0x57de49['createdAt']};}async[a46_0x38be63(0x1ed)](_0x543fd5){const _0x95f6cc=a46_0x38be63;await database_1[_0x95f6cc(0x13d)][_0x95f6cc(0x143)][_0x95f6cc(0x109)]({'where':{'id':_0x543fd5}});}[a46_0x38be63(0x8d)](_0x29a928,_0x1abf02,_0x24238c){const _0x38e7b0=a46_0x38be63,_0x23fee0=new Map(),_0x5bc79d=new Date(_0x1abf02);while(_0x5bc79d<=_0x24238c){const _0x415e8a=_0x5bc79d[_0x38e7b0(0x187)]()[_0x38e7b0(0x130)]('T')[0x0];_0x23fee0[_0x38e7b0(0x1dd)](_0x415e8a,{'revenue':0x0,'count':0x0}),_0x5bc79d[_0x38e7b0(0x181)](_0x5bc79d[_0x38e7b0(0x1a4)]()+0x1);}for(const _0x866463 of _0x29a928){const _0x1494e6=_0x866463[_0x38e7b0(0x1aa)][_0x38e7b0(0x187)]()['split']('T')[0x0],_0xb0d13c=_0x23fee0[_0x38e7b0(0xcf)](_0x1494e6);_0xb0d13c&&(_0xb0d13c[_0x38e7b0(0x126)]+=0x1,_0x866463[_0x38e7b0(0x171)]===_0x38e7b0(0x13f)&&(_0x866463[_0x38e7b0(0x1a7)]?_0xb0d13c['revenue']+=_0x866463[_0x38e7b0(0x1a7)]:console[_0x38e7b0(0xa8)](_0x38e7b0(0x1a2)+_0x866463['id']+_0x38e7b0(0x1c8))));}const _0x12f159=[],_0x11a9e0=[];for(const [_0x42e1ea,_0x497b6d]of _0x23fee0){_0x12f159[_0x38e7b0(0x13e)]({'date':_0x42e1ea,'amount':Math[_0x38e7b0(0x124)](_0x497b6d[_0x38e7b0(0xc5)]*0x64)/0x64}),_0x11a9e0[_0x38e7b0(0x13e)]({'date':_0x42e1ea,'count':_0x497b6d[_0x38e7b0(0x126)]});}return{'dailyRevenue':_0x12f159,'dailyPayments':_0x11a9e0};}}exports[a46_0x38be63(0xd6)]=AdminService;