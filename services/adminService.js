'use strict';const a46_0x2977f1=a46_0x141b;(function(_0x4bfaae,_0x3cc83d){const _0x3d5102=a46_0x141b,_0x25beb4=_0x4bfaae();while(!![]){try{const _0x30ba40=-parseInt(_0x3d5102(0xfa))/0x1*(parseInt(_0x3d5102(0x10b))/0x2)+-parseInt(_0x3d5102(0x215))/0x3*(-parseInt(_0x3d5102(0x1c6))/0x4)+-parseInt(_0x3d5102(0x1ed))/0x5*(-parseInt(_0x3d5102(0x1f0))/0x6)+-parseInt(_0x3d5102(0x13c))/0x7+parseInt(_0x3d5102(0x257))/0x8+parseInt(_0x3d5102(0x16c))/0x9+parseInt(_0x3d5102(0x179))/0xa;if(_0x30ba40===_0x3cc83d)break;else _0x25beb4['push'](_0x25beb4['shift']());}catch(_0x82058){_0x25beb4['push'](_0x25beb4['shift']());}}}(a46_0x528d,0xed3f1));var __importDefault=this&&this[a46_0x2977f1(0x141)]||function(_0x187a11){const _0x28bbe1=a46_0x2977f1;return _0x187a11&&_0x187a11[_0x28bbe1(0x125)]?_0x187a11:{'default':_0x187a11};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;function a46_0x141b(_0xc79a07,_0x1f4bd7){_0xc79a07=_0xc79a07-0xf4;const _0x528df5=a46_0x528d();let _0x141b7e=_0x528df5[_0xc79a07];return _0x141b7e;}function a46_0x528d(){const _0x3f5fda=['averageCommissionRate','740ajYfDc','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','../config/database','revenue','totalCommissionRate','min','\x20USDT','ðŸ”\x20Balance\x20check\x20details:','plisio','%\x20commission)','\x20\x20\x20Available\x20(number):\x20','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','createPayout','not\x20set','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','yesterday','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','rapyd','Payment\x20not\x20found','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','balance','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','trim','statusChangedAt','merchantEarnings','getUTCFullYear','gatewayCommissionRate','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','map','CoinToPay','totalAmountUSDT','publicKey','averageCheckUSDT','notes','usdtTrcWallet','failureMessage','pk_','5593970SEfDXY','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','localeCompare','6ksQeLK','Shop\x20not\x20found',',\x20chargebacks:\x20','findUnique','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','setHours','toISOString','ðŸ”\x20[','toUpperCase','payout','round','ðŸ“Š\x20Calculating\x20payout\x20statistics...','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','ðŸ’°\x20Shop\x20','desc','length','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','generateDailyStatistics','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','usdcErcWallet','telegramBotService','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20Gateway:\x20','merchantEarningsUSDT','split','merchantUrl','âœ…\x20Payout\x20created\x20in\x20DB:','REFUND','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','crypto','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','today','week','deletePayout','customerEmail','1038xofGiB','./telegramBotService','createdAt','\x27\x20->\x20ID\x20\x27','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','values','sort','erc20','\x20USDT\x20(','usdcPolygonWallet','paidAt','\x20USDT,\x20Difference:\x20','\x20USDT)','activateUser','\x20->\x20','gateway','\x20USDT\x20for\x20payment\x20','getFullYear','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','toLocaleDateString','some','./currencyService','\x20USDT\x20(gross\x20revenue)','Noda','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','PENDING','status','asc','update','_sum','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','telegramId','getGatewayNameById','ðŸ’°\x20Payment\x20','Open\x20Banking\x202','forEach','deleteUser','\x20\x20\x20Requested\x20(number):\x20','âš ï¸\x20Payment\x20','wallets','ðŸ“…\x20Date\x20to\x20filter:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20with\x20payout\x20history','paymentGateways','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','whiteUrl','get','ðŸ“Š\x20Statistics\x20date\x20range:\x20','findMany','cointopay2','\x20USDT,\x20Requested:\x20','amountAfterGatewayCommissionUSDT','totalPayout','\x20\x20\x20Added\x20to\x20balance:\x20+','getSystemStatistics','customerIp','successUrl','\x27\x20->\x20name\x20\x27','turnoverUSDT','\x20balance\x20updated:','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','telegram','\x20\x20\x20Current\x20balance:\x20','replace','14433304tDZKKi','currencyService','\x20to\x20','externalPaymentUrl','ðŸ”„\x20Gateway\x20mapping\x20(get):','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','ACTIVE','toLowerCase','_count',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','wallet',',\x20userId:\x20','\x20\x20\x20ðŸ¤”\x20Difference:\x20','join','\x20\x20\x20Difference:\x20','toFixed','getTime','network','âœ…\x20Using\x20gateway\x20filter:\x20\x27','212339tLTGRc','adminNotes','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','hash','getGatewayIdByName','CHARGEBACK','ðŸ“…\x20Date\x20from\x20filter:\x20','\x20order','\x20PAID\x20payments','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','availableBalance','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','payment','dateTo','orderId','ðŸŽ¯\x20[','12JEECCc','period','ðŸ’°\x20Found\x20','\x27\x20(from\x20\x27','Rapyd','setDate','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20',']\x20Updating\x20password\x20for\x20user\x20','thisMonth','gateways','totalPaidOut','pendingPayout','getUTCDate',',\x20Commission:\x20','periodFrom','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','password','polygon_usdc','filter','updatedAt','\x20for\x20shop\x20','aggregate','getGatewayInternalName','periodTo','customerCountry','__esModule','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','noda','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','totalPayments','usdtErcWallet','\x20USDT\x20(-','includes',':\x20commission\x20=\x20','ðŸ“Š\x20Gateway\x20filter\x20applied:','gte','\x20\x20\x20ðŸŒ\x20IP:\x20','commission','count','updatePaymentStatus','payouts','\x20in\x20','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','$transaction','slice','currency','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','Insufficient\x20balance.\x20Available:\x20','11530505YAbvgy','2020-01-01','log','findFirst','ceil','__importDefault','entries','customerUa','KLYME\x20DE','dateFrom','commissionUSDT','AdminService','not\x20provided','delete','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','default','parse','groupBy','customerName','ðŸ“Š\x20Final\x20WHERE\x20conditions:','this_month','Error\x20processing\x20payment\x20','NONEXISTENT_GATEWAY_FILTER','startsWith','\x20USDT\x20from\x20balance','shop','ðŸ“Š\x20Sorting\x20payments\x20by\x20','erc20_usdc','turnover','usdtPolygonWallet','PAID','hex','txid','custom_','shopId','lastMonth','suspendUser','\x20\x20\x20â³\x20Pending\x20payout:\x20','setUTCDate','amountAfterCommissionUSDT','create','\x20became\x20PAID:',',\x20successful:\x20','ðŸ”§\x20[','Username\x20already\x20exists','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x27\x20to\x20name\x20\x27','638361jnbxop','test_gateway','getUTCDay','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','gatewayEarnings','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','sk_','gatewaySettings','getMerchantsSelection','ðŸ”„\x20Gateway\x20mapping\x20(create):','SUSPENDED','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','8351140snDEfQ','getUserById','awaitingPayout','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','cointopay','date','all','UTC','getDate','%\x20from\x20','\x20USDT\x20(after\x20','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','getUTCMonth','chargebackAmount','\x20\x20\x20Transaction\x20hash:\x20','getMonth','reduce','\x20USDT\x20(same\x20as\x20awaiting)','shopUrl','ðŸ’°\x20Current\x20shop\x20balance:\x20','\x20paid\x20payments\x20for\x20analysis','insensitive','âœ…\x20Payout\x20created:\x20','lte','error','\x20USDT\x20(theoretical\x20net)','sendPayoutNotification','username','\x20\x20\x20Available\x20(raw):\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','amount','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20\x20\x20Tolerance:\x20','admin','\x20USDT\x20(total\x20paid\x20to\x20merchants)','ðŸ“Š\x20Payout\x20statistics\x20calculated:','not\x20specified','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','Test\x20Gateway','paymentsCount','../types/gateway','Telegram\x20username\x20already\x20exists','this_week','warn','set','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','name','createUser','push','floor',']\x20Gateway\x20settings\x20before\x20saving:','getAllPayments','amountUSDT','\x20\x20\x20Balance:\x20','year','custom','mastercard','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','COMPLETED','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','last_month','getPayoutById','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','\x20payments)','getAllPayouts','fullName','ðŸ“‹\x20Found\x20','klyme_eu','getGatewayDisplayName','totalTurnover','updateCustomerData','stringify','\x20merchants\x20for\x20selection','getPayoutStats','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20','statusChangedBy'];a46_0x528d=function(){return _0x3f5fda;};return a46_0x528d();}const database_1=__importDefault(require(a46_0x2977f1(0x1c8))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a46_0x2977f1(0x20f))),currencyService_1=require(a46_0x2977f1(0x22b)),telegramBotService_1=require(a46_0x2977f1(0x216)),gateway_1=require(a46_0x2977f1(0x1a1));class AdminService{async[a46_0x2977f1(0x1c2)](){const _0x220edb=a46_0x2977f1;console[_0x220edb(0x13e)](_0x220edb(0x1fb));const _0xbe9906=await database_1[_0x220edb(0x14c)][_0x220edb(0x156)][_0x220edb(0x121)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x5e83db=await database_1['default'][_0x220edb(0x107)][_0x220edb(0x132)]({'where':{'status':_0x220edb(0x15b),'gateway':{'not':_0x220edb(0x16d)}}}),_0x155886=new Date(),_0x3057a8=new Date(_0x155886['getFullYear'](),_0x155886['getMonth'](),0x1),_0x2b7f07=new Date(_0x155886['getFullYear'](),_0x155886[_0x220edb(0x188)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x112932=await database_1[_0x220edb(0x14c)][_0x220edb(0x1f9)][_0x220edb(0x121)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3057a8,'lte':_0x2b7f07},'status':_0x220edb(0x1b3)}}),_0x16f951=_0xbe9906[_0x220edb(0x233)][_0x220edb(0x116)]||0x0,_0x196028=_0xbe9906[_0x220edb(0x233)][_0x220edb(0x1db)]||0x0,_0x3e67f3=_0x112932[_0x220edb(0x233)]['amount']||0x0,_0x539374={'totalPayout':Math['round'](_0x16f951*0x64)/0x64,'awaitingPayout':Math[_0x220edb(0x1fa)](_0x196028*0x64)/0x64,'thisMonth':Math[_0x220edb(0x1fa)](_0x3e67f3*0x64)/0x64,'availableBalance':Math[_0x220edb(0x1fa)](_0x196028*0x64)/0x64,'totalPayments':_0x5e83db};return console['log'](_0x220edb(0x19c)),console[_0x220edb(0x13e)]('\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20'+_0x539374[_0x220edb(0x24b)]+_0x220edb(0x19b)),console[_0x220edb(0x13e)](_0x220edb(0x104)+_0x539374[_0x220edb(0x17b)]+_0x220edb(0x201)),console['log']('\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20'+_0x539374[_0x220edb(0x105)]+_0x220edb(0x18a)),console[_0x220edb(0x13e)](_0x220edb(0x136)+_0x539374[_0x220edb(0x114)]+_0x220edb(0x1cc)),console[_0x220edb(0x13e)](_0x220edb(0x103)+_0x539374['totalPayments']+_0x220edb(0x102)),_0x539374;}async[a46_0x2977f1(0x1bf)](_0x50aff7,_0x118d50){const _0xf6ecbf=a46_0x2977f1;console[_0xf6ecbf(0x13e)](_0xf6ecbf(0x210)+_0x50aff7+':',_0x118d50);const _0x280e34=await database_1[_0xf6ecbf(0x14c)]['payment']['findUnique']({'where':{'id':_0x50aff7},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x280e34)throw new Error(_0xf6ecbf(0x1d9));const _0x561d41={};_0x118d50[_0xf6ecbf(0x124)]!==undefined&&(_0x561d41[_0xf6ecbf(0x124)]=_0x118d50[_0xf6ecbf(0x124)]||null);_0x118d50[_0xf6ecbf(0x24e)]!==undefined&&(_0x561d41['customerIp']=_0x118d50[_0xf6ecbf(0x24e)]||null);_0x118d50[_0xf6ecbf(0x143)]!==undefined&&(_0x561d41[_0xf6ecbf(0x143)]=_0x118d50[_0xf6ecbf(0x143)]||null);const _0x368102=await database_1[_0xf6ecbf(0x14c)][_0xf6ecbf(0x107)]['update']({'where':{'id':_0x50aff7},'data':{..._0x561d41,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xf6ecbf(0x13e)](_0xf6ecbf(0x16a)+_0x50aff7),console[_0xf6ecbf(0x13e)]('\x20\x20\x20ðŸŒ\x20Country:\x20'+_0x280e34[_0xf6ecbf(0x124)]+'\x20->\x20'+_0x368102[_0xf6ecbf(0x124)]),console[_0xf6ecbf(0x13e)](_0xf6ecbf(0x130)+_0x280e34['customerIp']+'\x20->\x20'+_0x368102[_0xf6ecbf(0x24e)]),console['log'](_0xf6ecbf(0x234)+(_0x280e34[_0xf6ecbf(0x143)]?'set':_0xf6ecbf(0x1d3))+_0xf6ecbf(0x223)+(_0x368102['customerUa']?_0xf6ecbf(0x1a5):_0xf6ecbf(0x1d3))),_0x368102;}async[a46_0x2977f1(0x24d)](_0x54c0b7,_0x51d4a4){const _0xa6c982=a46_0x2977f1,_0x149d21=_0x51d4a4?new Date(_0x51d4a4):new Date();let _0x518d0c,_0x4aeaa1;if(_0x54c0b7[_0xa6c982(0x154)](_0xa6c982(0x15e))){const _0x51964b=_0x54c0b7[_0xa6c982(0x256)](_0xa6c982(0x15e),'')[_0xa6c982(0x20a)]('_');if(_0x51964b[_0xa6c982(0x200)]===0x2){const _0x45aba3=new Date(_0x51964b[0x0]),_0x52b2fb=new Date(_0x51964b[0x1]);_0x518d0c=new Date(Date[_0xa6c982(0x180)](_0x45aba3[_0xa6c982(0x1e1)](),_0x45aba3[_0xa6c982(0x185)](),_0x45aba3[_0xa6c982(0x118)](),0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date['UTC'](_0x52b2fb[_0xa6c982(0x1e1)](),_0x52b2fb[_0xa6c982(0x185)](),_0x52b2fb['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x33ac6e=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21['getUTCMonth'](),_0x149d21['getUTCDate']()-0x1e));_0x518d0c=new Date(Date[_0xa6c982(0x180)](_0x33ac6e[_0xa6c982(0x1e1)](),_0x33ac6e['getUTCMonth'](),_0x33ac6e['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date['UTC'](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x54c0b7[_0xa6c982(0x25f)]()){case _0xa6c982(0x211):_0x518d0c=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21[_0xa6c982(0x118)](),0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0xa6c982(0x1d5):const _0x1b1f2a=new Date(_0x149d21);_0x1b1f2a[_0xa6c982(0x163)](_0x1b1f2a['getUTCDate']()-0x1),_0x518d0c=new Date(Date[_0xa6c982(0x180)](_0x1b1f2a['getUTCFullYear'](),_0x1b1f2a[_0xa6c982(0x185)](),_0x1b1f2a[_0xa6c982(0x118)](),0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date[_0xa6c982(0x180)](_0x1b1f2a['getUTCFullYear'](),_0x1b1f2a[_0xa6c982(0x185)](),_0x1b1f2a[_0xa6c982(0x118)](),0x17,0x3b,0x3b,0x3e7));break;case _0xa6c982(0x1a3):const _0x2383c5=_0x149d21[_0xa6c982(0x16e)](),_0x2b287e=_0x2383c5===0x0?-0x6:0x1-_0x2383c5,_0x4c713c=_0x149d21[_0xa6c982(0x118)]()+_0x2b287e;_0x518d0c=new Date(Date['UTC'](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x4c713c,0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21[_0xa6c982(0x118)](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0x2702da=new Date(Date['UTC'](_0x149d21['getUTCFullYear'](),_0x149d21[_0xa6c982(0x185)](),_0x149d21[_0xa6c982(0x118)]()-0x7)),_0x261d07=_0x2702da['getUTCDay'](),_0x1d72d3=_0x261d07===0x0?-0x6:0x1-_0x261d07,_0x5a04d1=_0x2702da[_0xa6c982(0x118)]()+_0x1d72d3;_0x518d0c=new Date(Date['UTC'](_0x2702da[_0xa6c982(0x1e1)](),_0x2702da['getUTCMonth'](),_0x5a04d1,0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date['UTC'](_0x2702da[_0xa6c982(0x1e1)](),_0x2702da['getUTCMonth'](),_0x5a04d1+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0xa6c982(0x151):_0x518d0c=new Date(Date[_0xa6c982(0x180)](_0x149d21['getUTCFullYear'](),_0x149d21[_0xa6c982(0x185)](),0x1,0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date['UTC'](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21[_0xa6c982(0x118)](),0x17,0x3b,0x3b,0x3e7));break;case _0xa6c982(0x1b5):_0x518d0c=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x518d0c=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21[_0xa6c982(0x118)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x518d0c=new Date(_0x149d21[_0xa6c982(0xf7)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x2bc63e=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21[_0xa6c982(0x118)]()-0x1e));_0x518d0c=new Date(Date[_0xa6c982(0x180)](_0x2bc63e[_0xa6c982(0x1e1)](),_0x2bc63e['getUTCMonth'](),_0x2bc63e['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4aeaa1=new Date(Date[_0xa6c982(0x180)](_0x149d21[_0xa6c982(0x1e1)](),_0x149d21[_0xa6c982(0x185)](),_0x149d21[_0xa6c982(0x118)](),0x17,0x3b,0x3b,0x3e7));}const _0x7baaab={'gte':_0x518d0c,'lte':_0x4aeaa1};console[_0xa6c982(0x13e)](_0xa6c982(0x246)+_0x518d0c['toISOString']()+_0xa6c982(0x259)+_0x4aeaa1[_0xa6c982(0x1f6)]());const [_0x243684,_0x1fddb7,_0x262970,_0x47e6cb,_0x3cf0b8,_0x678fbf,_0xdfd053,_0x26e125,_0x24ca07]=await Promise[_0xa6c982(0x17f)]([database_1['default'][_0xa6c982(0x156)][_0xa6c982(0x132)](),database_1[_0xa6c982(0x14c)][_0xa6c982(0x156)][_0xa6c982(0x132)]({'where':{'status':_0xa6c982(0x25e)}}),database_1[_0xa6c982(0x14c)][_0xa6c982(0x107)][_0xa6c982(0x132)]({'where':{'status':'PAID','createdAt':_0x7baaab,'gateway':{'not':_0xa6c982(0x16d)}}}),database_1[_0xa6c982(0x14c)]['payment'][_0xa6c982(0x132)]({'where':{'status':_0xa6c982(0xff),'createdAt':_0x7baaab,'gateway':{'not':_0xa6c982(0x16d)}}}),database_1[_0xa6c982(0x14c)][_0xa6c982(0x107)]['count']({'where':{'status':_0xa6c982(0x20d),'createdAt':_0x7baaab,'gateway':{'not':_0xa6c982(0x16d)}}}),database_1[_0xa6c982(0x14c)][_0xa6c982(0x107)][_0xa6c982(0x247)]({'where':{'status':'PAID','createdAt':_0x7baaab,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0xa6c982(0x14c)][_0xa6c982(0x107)][_0xa6c982(0x247)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0xa6c982(0x1ff)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xa6c982(0x14c)][_0xa6c982(0x107)][_0xa6c982(0x247)]({'where':{'createdAt':_0x7baaab,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0xa6c982(0x14c)][_0xa6c982(0x107)][_0xa6c982(0x247)]({'where':{'status':'PAID','gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0xa6c982(0x13e)](_0xa6c982(0x1c3)+_0x262970);let _0x275ef5=0x0,_0x269eac=0x0;for(const _0xe9b3a8 of _0x678fbf){const _0x4c42b2=_0xe9b3a8[_0xa6c982(0x1ad)]||0x0;_0x275ef5+=_0x4c42b2;if(_0xe9b3a8[_0xa6c982(0x24a)]&&_0xe9b3a8[_0xa6c982(0x1ad)]){const _0x37e3df=_0xe9b3a8['amountUSDT']-_0xe9b3a8[_0xa6c982(0x24a)];_0x269eac+=_0x37e3df;}}let _0x1e17fc=0x0;for(const _0xb64613 of _0x24ca07){if(_0xb64613[_0xa6c982(0x24a)]&&_0xb64613[_0xa6c982(0x1ad)]){const _0x3e01f6=_0xb64613[_0xa6c982(0x1ad)]-_0xb64613[_0xa6c982(0x24a)];_0x1e17fc+=_0x3e01f6;}}const _0x253444=_0x262970>0x0?_0x275ef5/_0x262970:0x0,_0x4143c9=this['generateDailyStatistics'](_0x26e125,_0x518d0c,_0x4aeaa1),_0xd9ec35=await database_1[_0xa6c982(0x14c)]['payment'][_0xa6c982(0x132)]({'where':{'createdAt':_0x7baaab,'gateway':{'not':_0xa6c982(0x16d)},'status':{'notIn':[_0xa6c982(0x22f),'EXPIRED']}}}),_0x39ffa3=_0xd9ec35>0x0?_0x262970/_0xd9ec35*0x64:0x0;return{'totalShops':_0x243684,'activeShops':_0x1fddb7,'totalPayments':_0xd9ec35,'successfulPayments':_0x262970,'totalAttempts':_0xd9ec35,'chargebacks':_0x47e6cb,'refunds':_0x3cf0b8,'totalRevenue':Math[_0xa6c982(0x1fa)](_0x275ef5*0x64)/0x64,'trapayEarnings':Math['round'](_0x269eac*0x64)/0x64,'trapayEarningsAllTime':Math[_0xa6c982(0x1fa)](_0x1e17fc*0x64)/0x64,'averagePaymentAmount':Math[_0xa6c982(0x1fa)](_0x253444*0x64)/0x64,'conversionRate':Math[_0xa6c982(0x1fa)](_0x39ffa3*0x64)/0x64,'dailyRevenue':_0x4143c9['dailyRevenue'],'dailyPayments':_0x4143c9['dailyPayments'],'recentPayments':_0xdfd053[_0xa6c982(0x1e4)](_0x4a9487=>({'id':_0x4a9487['id'],'amount':_0x4a9487[_0xa6c982(0x197)],'currency':_0x4a9487[_0xa6c982(0x139)],'status':_0x4a9487[_0xa6c982(0x230)],'gateway':_0x4a9487[_0xa6c982(0x224)],'shop':_0x4a9487['shop'],'createdAt':_0x4a9487[_0xa6c982(0x217)]}))};}}async['getMerchantStatistics'](_0x14cb2c){const _0x4f2779=a46_0x2977f1;console['log'](_0x4f2779(0x235),_0x14cb2c);let _0x11a23c,_0x495d9b=new Date();if(_0x14cb2c['period']===_0x4f2779(0x1b0)&&_0x14cb2c[_0x4f2779(0x145)]&&_0x14cb2c[_0x4f2779(0x108)])_0x11a23c=new Date(_0x14cb2c[_0x4f2779(0x145)]),_0x495d9b=new Date(_0x14cb2c[_0x4f2779(0x108)]),_0x11a23c[_0x4f2779(0x1f5)](0x0,0x0,0x0,0x0),_0x495d9b['setHours'](0x17,0x3b,0x3b,0x3e7);else{const _0x27a524=new Date();switch(_0x14cb2c['period']){case _0x4f2779(0x212):_0x11a23c=new Date(_0x27a524[_0x4f2779(0xf7)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x11a23c[_0x4f2779(0x1f5)](0x0,0x0,0x0,0x0),_0x495d9b['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'month':_0x11a23c=new Date(Date[_0x4f2779(0x180)](_0x27a524[_0x4f2779(0x1e1)](),_0x27a524['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x495d9b=new Date(Date[_0x4f2779(0x180)](_0x27a524[_0x4f2779(0x1e1)](),_0x27a524[_0x4f2779(0x185)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4f2779(0x160):_0x11a23c=new Date(Date['UTC'](_0x27a524[_0x4f2779(0x1e1)](),_0x27a524[_0x4f2779(0x185)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x495d9b=new Date(Date['UTC'](_0x27a524[_0x4f2779(0x1e1)](),_0x27a524[_0x4f2779(0x185)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4f2779(0x1af):_0x11a23c=new Date(_0x27a524['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x11a23c[_0x4f2779(0x1f5)](0x0,0x0,0x0,0x0),_0x495d9b[_0x4f2779(0x1f5)](0x17,0x3b,0x3b,0x3e7);break;case _0x4f2779(0x17f):default:_0x11a23c=new Date(_0x4f2779(0x13d)),_0x11a23c['setHours'](0x0,0x0,0x0,0x0),_0x495d9b[_0x4f2779(0x1f5)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x4f2779(0x13e)]('ðŸ“…\x20Period:\x20'+_0x11a23c['toISOString']()+_0x4f2779(0x259)+_0x495d9b[_0x4f2779(0x1f6)]());const _0x498acf={'status':_0x4f2779(0x15b),'gateway':{'not':_0x4f2779(0x16d)},'paidAt':{'gte':_0x11a23c,'lte':_0x495d9b}};_0x14cb2c[_0x4f2779(0x15f)]&&(_0x498acf[_0x4f2779(0x15f)]=_0x14cb2c[_0x4f2779(0x15f)]);const _0x170b45=await database_1[_0x4f2779(0x14c)][_0x4f2779(0x107)]['findMany']({'where':_0x498acf,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4f2779(0x13e)](_0x4f2779(0x10d)+_0x170b45[_0x4f2779(0x200)]+_0x4f2779(0x18d));const _0x3759cb={'gateway':{'not':_0x4f2779(0x16d)},'status':{'notIn':['PENDING','EXPIRED']},'createdAt':{'gte':_0x11a23c,'lte':_0x495d9b}};_0x14cb2c['shopId']&&(_0x3759cb[_0x4f2779(0x15f)]=_0x14cb2c[_0x4f2779(0x15f)]);const _0x548f89=await database_1[_0x4f2779(0x14c)][_0x4f2779(0x107)]['count']({'where':_0x3759cb}),_0x6883ea={..._0x3759cb,'status':_0x4f2779(0xff)},_0x53fd5a={..._0x3759cb,'status':_0x4f2779(0x20d)},[_0xe57a8b,_0x43a373]=await Promise[_0x4f2779(0x17f)]([database_1['default'][_0x4f2779(0x107)][_0x4f2779(0x132)]({'where':_0x6883ea}),database_1[_0x4f2779(0x14c)][_0x4f2779(0x107)]['count']({'where':_0x53fd5a})]);console['log'](_0x4f2779(0x1d4)+_0x548f89+_0x4f2779(0x167)+_0x170b45['length']+_0x4f2779(0x1f2)+_0xe57a8b+',\x20refunds:\x20'+_0x43a373);let _0x5c7fe7=0x0,_0x1114da=0x0,_0x3447ef=0x0;const _0x3b6137={},_0x3692a7={},_0x586fd6={};for(const _0xa25cc2 of _0x170b45){try{const _0x4ec242=_0xa25cc2[_0x4f2779(0x1ad)]||0x0;if(_0x4ec242<=0x0){console[_0x4f2779(0x1a4)](_0x4f2779(0x23d)+_0xa25cc2['id']+_0x4f2779(0x25c));continue;}let _0x19845e,_0x32b951;if(_0xa25cc2[_0x4f2779(0x24a)]!==null&&_0xa25cc2[_0x4f2779(0x24a)]!==undefined)_0x19845e=_0xa25cc2[_0x4f2779(0x24a)],_0x32b951=_0x4ec242-_0x19845e,console['log'](_0x4f2779(0x253)+_0xa25cc2['id']+':\x20'+_0x4ec242['toFixed'](0x6)+'\x20USDT,\x20merchant:\x20'+_0x19845e[_0x4f2779(0xf6)](0x6)+_0x4f2779(0x1cc));else{let _0x4deed8={};if(_0xa25cc2[_0x4f2779(0x156)][_0x4f2779(0x173)])try{_0x4deed8=JSON[_0x4f2779(0x14d)](_0xa25cc2[_0x4f2779(0x156)][_0x4f2779(0x173)]);}catch(_0x310be8){console[_0x4f2779(0x191)](_0x4f2779(0x240)+_0xa25cc2['shopId']+':',_0x310be8);}let _0x1bef7e=0x2d;for(const [_0x4845e8,_0x4141a6]of Object['entries'](_0x4deed8)){if(_0x4845e8[_0x4f2779(0x25f)]()===_0xa25cc2[_0x4f2779(0x224)]['toLowerCase']()){_0x1bef7e=_0x4141a6['commission']||0x2d;break;}}_0x32b951=_0x4ec242*(_0x1bef7e/0x64),_0x19845e=_0x4ec242-_0x32b951,console[_0x4f2779(0x13e)](_0x4f2779(0x25d)+_0xa25cc2['id']+':\x20'+_0x1bef7e+_0x4f2779(0x182)+_0x4ec242['toFixed'](0x6)+_0x4f2779(0x1cc));}_0x5c7fe7+=_0x4ec242,_0x1114da+=_0x19845e,_0x3447ef+=_0x32b951;let _0x16f360;_0xa25cc2[_0x4f2779(0x1e2)]!==null&&_0xa25cc2['gatewayCommissionRate']!==undefined?(_0x16f360=_0xa25cc2[_0x4f2779(0x1e2)],console[_0x4f2779(0x13e)](_0x4f2779(0x1fc)+_0xa25cc2['id']+':\x20'+_0x16f360+'%')):(_0x16f360=_0x4ec242>0x0?_0x32b951/_0x4ec242*0x64:0x0,console[_0x4f2779(0x13e)](_0x4f2779(0x13a)+_0xa25cc2['id']+':\x20'+_0x16f360[_0x4f2779(0xf6)](0x2)+'%'));!_0x3b6137[_0xa25cc2['gateway']]&&(_0x3b6137[_0xa25cc2['gateway']]={'gateway':_0xa25cc2[_0x4f2779(0x224)],'gatewayDisplayName':this[_0x4f2779(0x1bd)](_0xa25cc2[_0x4f2779(0x224)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3b6137[_0xa25cc2[_0x4f2779(0x224)]][_0x4f2779(0x1a0)]++,_0x3b6137[_0xa25cc2['gateway']][_0x4f2779(0x251)]+=_0x4ec242,_0x3b6137[_0xa25cc2[_0x4f2779(0x224)]][_0x4f2779(0x146)]+=_0x32b951,_0x3b6137[_0xa25cc2['gateway']][_0x4f2779(0x209)]+=_0x19845e,_0x3b6137[_0xa25cc2[_0x4f2779(0x224)]][_0x4f2779(0x1ca)]+=_0x16f360;!_0x14cb2c[_0x4f2779(0x15f)]&&(!_0x3692a7[_0xa25cc2[_0x4f2779(0x15f)]]&&(_0x3692a7[_0xa25cc2[_0x4f2779(0x15f)]]={'shopId':_0xa25cc2[_0x4f2779(0x15f)],'shopName':_0xa25cc2['shop']['name'],'shopUsername':_0xa25cc2[_0x4f2779(0x156)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3692a7[_0xa25cc2['shopId']][_0x4f2779(0x1a0)]++,_0x3692a7[_0xa25cc2['shopId']][_0x4f2779(0x251)]+=_0x4ec242,_0x3692a7[_0xa25cc2[_0x4f2779(0x15f)]][_0x4f2779(0x146)]+=_0x32b951,_0x3692a7[_0xa25cc2['shopId']][_0x4f2779(0x209)]+=_0x19845e);const _0x34bd00=_0xa25cc2[_0x4f2779(0x21f)][_0x4f2779(0x1f6)]()[_0x4f2779(0x20a)]('T')[0x0];!_0x586fd6[_0x34bd00]&&(_0x586fd6[_0x34bd00]={'date':_0x34bd00,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x586fd6[_0x34bd00]['turnover']+=_0x4ec242,_0x586fd6[_0x34bd00][_0x4f2779(0x1e0)]+=_0x19845e,_0x586fd6[_0x34bd00]['gatewayEarnings']+=_0x32b951,_0x586fd6[_0x34bd00][_0x4f2779(0x1a0)]++;}catch(_0xeb1663){console[_0x4f2779(0x191)](_0x4f2779(0x152)+_0xa25cc2['id']+':',_0xeb1663);}}Object['values'](_0x3b6137)[_0x4f2779(0x23a)](_0x3f785b=>{const _0x35a4f0=_0x4f2779;_0x3f785b[_0x35a4f0(0x1c5)]=_0x3f785b['paymentsCount']>0x0?_0x3f785b[_0x35a4f0(0x1ca)]/_0x3f785b[_0x35a4f0(0x1a0)]:0x0,delete _0x3f785b[_0x35a4f0(0x1ca)];}),Object[_0x4f2779(0x21a)](_0x3692a7)[_0x4f2779(0x23a)](_0x452057=>{const _0x363485=_0x4f2779;_0x452057['averageCheckUSDT']=_0x452057['paymentsCount']>0x0?_0x452057['turnoverUSDT']/_0x452057[_0x363485(0x1a0)]:0x0;});let _0x5ce5c8=0x0,_0x5d3eba=0x0;if(_0x14cb2c[_0x4f2779(0x15f)]){const _0x5ded1e=await database_1[_0x4f2779(0x14c)][_0x4f2779(0x1f9)][_0x4f2779(0x247)]({'where':{'shopId':_0x14cb2c[_0x4f2779(0x15f)],'status':'COMPLETED','createdAt':{'gte':_0x11a23c,'lte':_0x495d9b}},'select':{'amount':!![]}});_0x5ce5c8=_0x5ded1e[_0x4f2779(0x189)]((_0x1077db,_0x35fcab)=>_0x1077db+_0x35fcab[_0x4f2779(0x197)],0x0);const _0x4596a7=await database_1[_0x4f2779(0x14c)]['payout'][_0x4f2779(0x247)]({'where':{'shopId':_0x14cb2c[_0x4f2779(0x15f)],'status':_0x4f2779(0x22f),'createdAt':{'gte':_0x11a23c,'lte':_0x495d9b}},'select':{'amount':!![]}});_0x5d3eba=_0x4596a7[_0x4f2779(0x189)]((_0x4807b8,_0x127ec)=>_0x4807b8+_0x127ec['amount'],0x0);}const _0x18855c=_0x548f89,_0x8f0789=_0x170b45[_0x4f2779(0x200)],_0x3f6393=_0x8f0789>0x0?_0x5c7fe7/_0x8f0789:0x0,_0x16fc11=_0x18855c>0x0?Math['round'](_0x8f0789/_0x18855c*0x2710)/0x64:0x0,_0x5ac999=Math[_0x4f2779(0x140)]((_0x495d9b[_0x4f2779(0xf7)]()-_0x11a23c['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x35d516={'totalTurnover':Math[_0x4f2779(0x1fa)](_0x5c7fe7*0x64)/0x64,'merchantEarnings':Math[_0x4f2779(0x1fa)](_0x1114da*0x64)/0x64,'gatewayEarnings':Math['round'](_0x3447ef*0x64)/0x64,'totalPaidOut':Math[_0x4f2779(0x1fa)](_0x5ce5c8*0x64)/0x64,'pendingPayout':Math['round'](_0x5d3eba*0x64)/0x64,'averageCheck':Math[_0x4f2779(0x1fa)](_0x3f6393*0x64)/0x64,'totalPayments':_0x18855c,'successfulPayments':_0x8f0789,'conversionRate':_0x16fc11,'chargebacks':_0xe57a8b,'refunds':_0x43a373,'gatewayBreakdown':Object[_0x4f2779(0x21a)](_0x3b6137)[_0x4f2779(0x1e4)](_0x8325aa=>({..._0x8325aa,'turnoverUSDT':Math[_0x4f2779(0x1fa)](_0x8325aa[_0x4f2779(0x251)]*0x64)/0x64,'commissionUSDT':Math[_0x4f2779(0x1fa)](_0x8325aa[_0x4f2779(0x146)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x8325aa[_0x4f2779(0x209)]*0x64)/0x64,'averageCommissionRate':Math[_0x4f2779(0x1fa)](_0x8325aa[_0x4f2779(0x1c5)]*0x64)/0x64})),'merchantBreakdown':_0x14cb2c[_0x4f2779(0x15f)]?undefined:Object[_0x4f2779(0x21a)](_0x3692a7)[_0x4f2779(0x1e4)](_0x5f2d03=>({..._0x5f2d03,'turnoverUSDT':Math[_0x4f2779(0x1fa)](_0x5f2d03['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x5f2d03[_0x4f2779(0x146)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4f2779(0x1fa)](_0x5f2d03[_0x4f2779(0x209)]*0x64)/0x64,'paidOutUSDT':Math[_0x4f2779(0x1fa)](_0x5f2d03['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x4f2779(0x1fa)](_0x5f2d03[_0x4f2779(0x1e8)]*0x64)/0x64})),'dailyData':Object['values'](_0x586fd6)[_0x4f2779(0x1e4)](_0x5ed678=>({..._0x5ed678,'turnover':Math[_0x4f2779(0x1fa)](_0x5ed678[_0x4f2779(0x159)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x5ed678[_0x4f2779(0x1e0)]*0x64)/0x64,'gatewayEarnings':Math[_0x4f2779(0x1fa)](_0x5ed678[_0x4f2779(0x170)]*0x64)/0x64}))[_0x4f2779(0x21b)]((_0x51af80,_0x153549)=>_0x51af80[_0x4f2779(0x17e)][_0x4f2779(0x1ef)](_0x153549[_0x4f2779(0x17e)])),'periodInfo':{'from':_0x11a23c,'to':_0x495d9b,'periodType':_0x14cb2c[_0x4f2779(0x10c)]||'custom','daysCount':_0x5ac999}};return console[_0x4f2779(0x13e)](_0x4f2779(0x1f4)),console[_0x4f2779(0x13e)](_0x4f2779(0x11b)+_0x35d516[_0x4f2779(0x1be)]+'\x20USDT'),console[_0x4f2779(0x13e)](_0x4f2779(0x219)+_0x35d516[_0x4f2779(0x1e0)]+_0x4f2779(0x1cc)),console[_0x4f2779(0x13e)](_0x4f2779(0x184)+_0x35d516['gatewayEarnings']+_0x4f2779(0x1cc)),console[_0x4f2779(0x13e)](_0x4f2779(0x20e)+_0x35d516[_0x4f2779(0x116)]+'\x20USDT'),console[_0x4f2779(0x13e)](_0x4f2779(0x162)+_0x35d516[_0x4f2779(0x117)]+_0x4f2779(0x1cc)),console[_0x4f2779(0x13e)]('\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20'+_0x35d516[_0x4f2779(0x129)]),_0x35d516;}async[a46_0x2977f1(0x174)](_0x2e487b){const _0x36f9e7=a46_0x2977f1;console[_0x36f9e7(0x13e)](_0x36f9e7(0x1dc),{'hasPayoutHistory':_0x2e487b});let _0x3a4e5f={};_0x2e487b&&(_0x3a4e5f[_0x36f9e7(0x134)]={'some':{}});const _0x316f50=await database_1[_0x36f9e7(0x14c)][_0x36f9e7(0x156)][_0x36f9e7(0x247)]({'where':_0x3a4e5f,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x36f9e7(0x13e)](_0x36f9e7(0x1bb)+_0x316f50[_0x36f9e7(0x200)]+_0x36f9e7(0x1c1)+(_0x2e487b?_0x36f9e7(0x241):'')),_0x316f50[_0x36f9e7(0x1e4)](_0x30e8c8=>({'id':_0x30e8c8['id'],'username':_0x30e8c8[_0x36f9e7(0x194)],'name':_0x30e8c8[_0x36f9e7(0x1a7)]}));}[a46_0x2977f1(0x1bd)](_0x2f25ae){const _0x3afceb=a46_0x2977f1,_0x1a7390={'test_gateway':_0x3afceb(0x19f),'plisio':'Plisio','rapyd':_0x3afceb(0x10f),'noda':_0x3afceb(0x22d),'cointopay':_0x3afceb(0x1e5),'cointopay2':_0x3afceb(0x239),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x3afceb(0x144),'mastercard':'MasterCard'};return _0x1a7390[_0x2f25ae]||_0x2f25ae;}[a46_0x2977f1(0x122)](_0x508dd2){const _0x781e79=a46_0x2977f1,_0x3f6d57={'Test\x20Gateway':'test_gateway','Plisio':_0x781e79(0x1ce),'Rapyd':_0x781e79(0x1d8),'Noda':_0x781e79(0x127),'CoinToPay':_0x781e79(0x17d),'CoinToPay2':_0x781e79(0x248),'KLYME\x20EU':_0x781e79(0x1bc),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':'klyme_de','MasterCard':_0x781e79(0x1b1)};return _0x3f6d57[_0x508dd2]||_0x508dd2[_0x781e79(0x25f)]();}async['getMerchantsAwaitingPayout'](_0x3a22e4){const _0x5375d9=a46_0x2977f1,{page:_0x306354,limit:_0x55756a,minAmount:_0x37fc4a,search:_0x367025}=_0x3a22e4;console['log'](_0x5375d9(0x1b2),_0x3a22e4);let _0x432740={};_0x367025&&(_0x432740['name']={'contains':_0x367025,'mode':_0x5375d9(0x18e)});const _0xed8002=await database_1[_0x5375d9(0x14c)][_0x5375d9(0x156)][_0x5375d9(0x247)]({'where':_0x432740,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x39d188=_0xed8002[_0x5375d9(0x11e)](_0x3b11fc=>{const _0x243c81=_0x5375d9,_0x2046e7=Math[_0x243c81(0x1aa)](_0x3b11fc['balance']*0x64)/0x64;if(_0x37fc4a&&_0x2046e7<_0x37fc4a)return![];return _0x2046e7!==0x0;});_0x39d188[_0x5375d9(0x21b)]((_0xc320a1,_0x1d74df)=>_0x1d74df[_0x5375d9(0x1db)]-_0xc320a1['balance']);const _0x42e88e=_0x39d188['length'],_0xb55739=(_0x306354-0x1)*_0x55756a,_0x26daa5=_0x39d188[_0x5375d9(0x138)](_0xb55739,_0xb55739+_0x55756a);console[_0x5375d9(0x13e)](_0x5375d9(0x10d)+_0x26daa5['length']+_0x5375d9(0x14b));const _0x1b1bed=await Promise['all'](_0x26daa5['map'](async _0xc76404=>{const _0x31ea8f=_0x5375d9,[_0x16a1ba,_0x1ca556,_0x2dc96a]=await Promise[_0x31ea8f(0x17f)]([database_1[_0x31ea8f(0x14c)][_0x31ea8f(0x107)]['count']({'where':{'shopId':_0xc76404['id'],'status':'PAID','gateway':{'not':_0x31ea8f(0x16d)}}}),database_1['default'][_0x31ea8f(0x107)][_0x31ea8f(0x13f)]({'where':{'shopId':_0xc76404['id'],'status':_0x31ea8f(0x15b),'gateway':{'not':_0x31ea8f(0x16d)}},'orderBy':{'paidAt':_0x31ea8f(0x231)},'select':{'paidAt':!![]}}),database_1[_0x31ea8f(0x14c)][_0x31ea8f(0x107)][_0x31ea8f(0x14e)]({'by':['gateway'],'where':{'shopId':_0xc76404['id'],'status':_0x31ea8f(0x15b),'gateway':{'not':_0x31ea8f(0x16d)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x124b4a=new Date(),_0x341896=new Date(_0x124b4a['getFullYear'](),_0x124b4a[_0x31ea8f(0x188)](),0x1),_0x710b54=new Date(_0x124b4a[_0x31ea8f(0x226)](),_0x124b4a[_0x31ea8f(0x188)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x31aaa4,_0x41cd26]=await Promise[_0x31ea8f(0x17f)]([database_1[_0x31ea8f(0x14c)][_0x31ea8f(0x1f9)][_0x31ea8f(0x121)]({'_sum':{'amount':!![]},'where':{'shopId':_0xc76404['id'],'status':'COMPLETED'}}),database_1[_0x31ea8f(0x14c)][_0x31ea8f(0x1f9)][_0x31ea8f(0x121)]({'_sum':{'amount':!![]},'where':{'shopId':_0xc76404['id'],'status':'COMPLETED','createdAt':{'gte':_0x341896,'lte':_0x710b54}}})]),_0xecc048=_0x31aaa4['_sum'][_0x31ea8f(0x197)]||0x0,_0x29e46c=_0x41cd26[_0x31ea8f(0x233)][_0x31ea8f(0x197)]||0x0,_0x25a6f1=await Promise[_0x31ea8f(0x17f)](_0x2dc96a['map'](async _0x1bdfc8=>{const _0x336285=_0x31ea8f;let _0x378803=0x2d;if(_0xc76404['gatewaySettings'])try{const _0x5ed1df=JSON['parse'](_0xc76404[_0x336285(0x173)]);for(const [_0x325e09,_0x33f44c]of Object['entries'](_0x5ed1df)){if(_0x325e09[_0x336285(0x25f)]()===_0x1bdfc8[_0x336285(0x224)][_0x336285(0x25f)]()){_0x378803=_0x33f44c['commission']||0xa,console[_0x336285(0x13e)](_0x336285(0x17c)+_0x1bdfc8[_0x336285(0x224)]+'\x20for\x20shop\x20'+_0xc76404['id']+_0x336285(0x12d)+_0x378803+'%');break;}}}catch(_0x4f1b43){console[_0x336285(0x191)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0xc76404['id']+':',_0x4f1b43);}const _0x504064=_0x1bdfc8[_0x336285(0x233)]?.[_0x336285(0x1ad)]||0x0,_0x22492e=_0x504064*(0x1-_0x378803/0x64);return{'gateway':_0x1bdfc8[_0x336285(0x224)],'count':_0x1bdfc8['_count']?.['id']||0x0,'amountUSDT':Math[_0x336285(0x1fa)](_0x504064*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x336285(0x1fa)](_0x22492e*0x64)/0x64,'commission':_0x378803};})),_0x349e4a=_0x25a6f1['reduce']((_0x5771d4,_0x46726c)=>_0x5771d4+_0x46726c[_0x31ea8f(0x1ad)],0x0),_0x45b5e5=_0x25a6f1[_0x31ea8f(0x189)]((_0x8761c8,_0xf22dc3)=>_0x8761c8+_0xf22dc3[_0x31ea8f(0x164)],0x0),_0x43964d=_0xc76404['balance'];return console[_0x31ea8f(0x13e)](_0x31ea8f(0x16f)+_0xc76404['username']+':'),console[_0x31ea8f(0x13e)](_0x31ea8f(0x14a)+_0x349e4a[_0x31ea8f(0xf6)](0x2)+_0x31ea8f(0x22c)),console[_0x31ea8f(0x13e)]('\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20'+_0x45b5e5[_0x31ea8f(0xf6)](0x2)+_0x31ea8f(0x192)),console[_0x31ea8f(0x13e)](_0x31ea8f(0x1d1)+_0x43964d[_0x31ea8f(0xf6)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x31ea8f(0x13e)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0xecc048[_0x31ea8f(0xf6)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0x31ea8f(0x13e)](_0x31ea8f(0x264)+(_0x45b5e5-_0xecc048-_0x43964d)[_0x31ea8f(0xf6)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0xc76404['id'],'fullName':_0xc76404['name'],'username':_0xc76404[_0x31ea8f(0x194)],'telegramId':_0xc76404[_0x31ea8f(0x254)],'merchantUrl':_0xc76404[_0x31ea8f(0x18b)],'wallets':{'usdtPolygonWallet':_0xc76404[_0x31ea8f(0x15a)],'usdtTrcWallet':_0xc76404[_0x31ea8f(0x1ea)],'usdtErcWallet':_0xc76404[_0x31ea8f(0x12a)],'usdcPolygonWallet':_0xc76404[_0x31ea8f(0x21e)],'usdcErcWallet':_0xc76404['usdcErcWallet']},'totalAmountUSDT':Math[_0x31ea8f(0x1fa)](_0x349e4a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x31ea8f(0x1fa)](_0x45b5e5*0x64)/0x64,'currentBalance':Math[_0x31ea8f(0x1aa)](_0x43964d*0x64)/0x64,'totalPayout':Math[_0x31ea8f(0x1fa)](_0xecc048*0x64)/0x64,'thisMonth':Math[_0x31ea8f(0x1fa)](_0x29e46c*0x64)/0x64,'paymentsCount':_0x16a1ba,'oldestPaymentDate':_0x1ca556?.['paidAt']||_0xc76404[_0x31ea8f(0x217)],'gatewayBreakdown':_0x25a6f1};})),_0x4802bd=_0x1b1bed[_0x5375d9(0x189)]((_0x375940,_0x1a1966)=>_0x375940+_0x1a1966[_0x5375d9(0x1e6)],0x0),_0x5b3043=_0x1b1bed[_0x5375d9(0x189)]((_0x2566fd,_0x38cc50)=>_0x2566fd+_0x38cc50['totalAmountAfterCommissionUSDT'],0x0),_0x3a86be=_0x1b1bed[_0x5375d9(0x189)]((_0x3976af,_0x192743)=>_0x3976af+_0x192743[_0x5375d9(0x24b)],0x0),_0x389b8b=_0x1b1bed[_0x5375d9(0x189)]((_0x1dfc10,_0x2f5026)=>_0x1dfc10+_0x2f5026[_0x5375d9(0x114)],0x0);return console[_0x5375d9(0x13e)](_0x5375d9(0x1b7)+_0x42e88e+'\x20merchants'),console['log'](_0x5375d9(0x1c7)+Math['round'](_0x4802bd*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x5375d9(0x13e)](_0x5375d9(0x178)+Math[_0x5375d9(0x1fa)](_0x5b3043*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x5375d9(0x13e)](_0x5375d9(0x1ee)+Math[_0x5375d9(0x1fa)](_0x3a86be*0x64)/0x64+_0x5375d9(0x1cc)),console[_0x5375d9(0x13e)](_0x5375d9(0x19e)+Math['round'](_0x389b8b*0x64)/0x64+_0x5375d9(0x1cc)),{'merchants':_0x1b1bed,'pagination':{'page':_0x306354,'limit':_0x55756a,'total':_0x42e88e,'totalPages':Math[_0x5375d9(0x140)](_0x42e88e/_0x55756a)},'summary':{'totalMerchants':_0x42e88e,'totalAmountUSDT':Math['round'](_0x4802bd*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5375d9(0x1fa)](_0x5b3043*0x64)/0x64,'totalPayout':Math['round'](_0x3a86be*0x64)/0x64,'thisMonth':Math[_0x5375d9(0x1fa)](_0x389b8b*0x64)/0x64}};}async[a46_0x2977f1(0x1d2)](_0x4401f4){const _0x2130a2=a46_0x2977f1,{shopId:_0x2ef74a,amount:_0x1a8f7a,network:_0x368dac,wallet:_0x365b9b,notes:_0x78349c,txid:_0x50b4c3,periodFrom:_0x13f47a,periodTo:_0x2215ad}=_0x4401f4,_0x313b29=await database_1['default'][_0x2130a2(0x137)](async _0x9ce636=>{const _0x131f35=_0x2130a2,_0x5480ee=await _0x9ce636[_0x131f35(0x156)][_0x131f35(0x1f3)]({'where':{'id':_0x2ef74a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5480ee)throw new Error(_0x131f35(0x1f1));console[_0x131f35(0x13e)](_0x131f35(0x1d6)+_0x5480ee[_0x131f35(0x194)]+':'),console[_0x131f35(0x13e)](_0x131f35(0x255)+_0x5480ee['balance'][_0x131f35(0xf6)](0x6)+_0x131f35(0x1cc)),console[_0x131f35(0x13e)]('\x20\x20\x20Payout\x20amount:\x20'+_0x1a8f7a[_0x131f35(0xf6)](0x6)+'\x20USDT'),console['log'](_0x131f35(0x1d7)+_0x5480ee[_0x131f35(0x116)][_0x131f35(0xf6)](0x6)+_0x131f35(0x1cc));if(_0x50b4c3)console[_0x131f35(0x13e)](_0x131f35(0x187)+_0x50b4c3);const _0x268adf=0.000001,_0x25e379=Number(_0x5480ee[_0x131f35(0x1db)]),_0x31e2ac=Number(_0x1a8f7a);console[_0x131f35(0x13e)](_0x131f35(0x1cd)),console[_0x131f35(0x13e)](_0x131f35(0x195)+_0x5480ee[_0x131f35(0x1db)]),console[_0x131f35(0x13e)](_0x131f35(0x1d0)+_0x25e379),console[_0x131f35(0x13e)](_0x131f35(0x23c)+_0x31e2ac),console[_0x131f35(0x13e)](_0x131f35(0xf5)+(_0x25e379-_0x31e2ac)),console[_0x131f35(0x13e)](_0x131f35(0x199)+_0x268adf);if(_0x25e379<_0x31e2ac-_0x268adf)throw new Error(_0x131f35(0x13b)+_0x25e379[_0x131f35(0xf6)](0x6)+_0x131f35(0x249)+_0x31e2ac[_0x131f35(0xf6)](0x6)+_0x131f35(0x220)+(_0x25e379-_0x31e2ac)['toFixed'](0x8)+'\x20USDT');console[_0x131f35(0x13e)](_0x131f35(0xfc));const _0x19d9db=Math[_0x131f35(0x1cb)](_0x25e379,_0x31e2ac);let _0x54e88e=_0x365b9b;console[_0x131f35(0x13e)]('ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20'+(_0x365b9b||_0x131f35(0x148)));if(!_0x54e88e){console[_0x131f35(0x13e)](_0x131f35(0x171));const _0x42215a=await _0x9ce636[_0x131f35(0x156)]['findUnique']({'where':{'id':_0x2ef74a},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log']('ðŸ”\x20Shop\x20wallets:',_0x42215a);if(_0x42215a)switch(_0x368dac){case'polygon':_0x54e88e=_0x42215a[_0x131f35(0x15a)]||undefined,console[_0x131f35(0x13e)](_0x131f35(0x228)+_0x54e88e);break;case'trc20':_0x54e88e=_0x42215a[_0x131f35(0x1ea)]||undefined,console[_0x131f35(0x13e)](_0x131f35(0x1da)+_0x54e88e);break;case _0x131f35(0x21c):_0x54e88e=_0x42215a[_0x131f35(0x12a)]||undefined,console[_0x131f35(0x13e)](_0x131f35(0x126)+_0x54e88e);break;case _0x131f35(0x11d):_0x54e88e=_0x42215a[_0x131f35(0x21e)]||undefined,console[_0x131f35(0x13e)](_0x131f35(0x106)+_0x54e88e);break;case _0x131f35(0x158):_0x54e88e=_0x42215a[_0x131f35(0x205)]||undefined,console[_0x131f35(0x13e)](_0x131f35(0x1a6)+_0x54e88e);break;}}else console[_0x131f35(0x13e)]('âœ…\x20Using\x20wallet\x20from\x20request:\x20'+_0x54e88e);console['log'](_0x131f35(0x1e3)+_0x368dac+':\x20'+(_0x54e88e||_0x131f35(0x19d))),console[_0x131f35(0x13e)]('ðŸ”\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x2ef74a,'amount':_0x19d9db,'network':_0x368dac,'wallet':_0x54e88e,'status':_0x131f35(0x1b3),'txid':_0x50b4c3,'notes':_0x78349c,'periodFrom':_0x13f47a?new Date(_0x13f47a):null,'periodTo':_0x2215ad?new Date(_0x2215ad):null});const _0x5285e5=await _0x9ce636['payout']['create']({'data':{'shopId':_0x2ef74a,'amount':_0x19d9db,'network':_0x368dac,'wallet':_0x54e88e,'status':_0x131f35(0x1b3),'txid':_0x50b4c3,'notes':_0x78349c,'periodFrom':_0x13f47a?new Date(_0x13f47a):null,'periodTo':_0x2215ad?new Date(_0x2215ad):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x131f35(0x20c),{'id':_0x5285e5['id'],'wallet':_0x5285e5['wallet'],'network':_0x5285e5[_0x131f35(0xf8)],'amount':_0x5285e5['amount']});const _0x1fd982=_0x25e379-_0x19d9db,_0x35fbf4=Number(_0x5480ee[_0x131f35(0x116)])+_0x19d9db;return await _0x9ce636[_0x131f35(0x156)][_0x131f35(0x232)]({'where':{'id':_0x2ef74a},'data':{'balance':_0x1fd982,'totalPaidOut':_0x35fbf4}}),console[_0x131f35(0x13e)](_0x131f35(0x1fe)+_0x5480ee[_0x131f35(0x194)]+_0x131f35(0x252)),console[_0x131f35(0x13e)](_0x131f35(0x1ae)+_0x25e379[_0x131f35(0xf6)](0x6)+_0x131f35(0x223)+_0x1fd982[_0x131f35(0xf6)](0x6)+_0x131f35(0x12b)+_0x19d9db[_0x131f35(0xf6)](0x6)+')'),console[_0x131f35(0x13e)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x5480ee[_0x131f35(0x116)][_0x131f35(0xf6)](0x6)+_0x131f35(0x223)+_0x35fbf4[_0x131f35(0xf6)](0x6)+'\x20USDT\x20(+'+_0x19d9db[_0x131f35(0xf6)](0x6)+')'),console[_0x131f35(0x13e)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x19d9db[_0x131f35(0xf6)](0x6)+_0x131f35(0x1cc)),{'payout':_0x5285e5,'shop':_0x5480ee};});console[_0x2130a2(0x13e)](_0x2130a2(0x18f)+_0x313b29['payout']['id']+_0x2130a2(0x120)+_0x313b29[_0x2130a2(0x156)]['username']+'\x20('+_0x313b29['payout'][_0x2130a2(0x197)][_0x2130a2(0xf6)](0x6)+_0x2130a2(0x221));try{let _0x333f37='ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½';if(_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x11a)]&&_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x123)]){const _0x28f404=new Date(_0x313b29['payout'][_0x2130a2(0x11a)])['toLocaleDateString']('ru-RU'),_0x15494c=new Date(_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x123)])[_0x2130a2(0x229)]('ru-RU');_0x333f37=_0x28f404+'\x20-\x20'+_0x15494c;}await telegramBotService_1[_0x2130a2(0x206)][_0x2130a2(0x193)](_0x313b29['payout']['shopId'],{'id':_0x313b29[_0x2130a2(0x1f9)]['id'],'amount':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x197)],'network':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0xf8)],'wallet':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x262)],'period':_0x333f37,'createdAt':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x217)],'txid':_0x313b29[_0x2130a2(0x1f9)]['txid']}),console[_0x2130a2(0x13e)](_0x2130a2(0x203)+_0x313b29[_0x2130a2(0x1f9)]['id']);}catch(_0x47afe1){console[_0x2130a2(0x191)](_0x2130a2(0x112)+_0x313b29[_0x2130a2(0x1f9)]['id']+':',_0x47afe1);}return{'id':_0x313b29[_0x2130a2(0x1f9)]['id'],'shopId':_0x313b29[_0x2130a2(0x1f9)]['shopId'],'shopName':_0x313b29[_0x2130a2(0x156)][_0x2130a2(0x1a7)],'shopUsername':_0x313b29['shop']['username'],'amount':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x197)],'network':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0xf8)],'wallet':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x262)],'status':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x230)],'txid':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x15d)],'notes':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x1e9)],'periodFrom':_0x313b29['payout'][_0x2130a2(0x11a)],'periodTo':_0x313b29[_0x2130a2(0x1f9)]['periodTo'],'createdAt':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x217)],'paidAt':_0x313b29[_0x2130a2(0x1f9)][_0x2130a2(0x21f)]};}async[a46_0x2977f1(0x1b9)](_0x534801){const _0x2eb929=a46_0x2977f1,{page:_0xf5ef98,limit:_0x1b1126,shopId:_0x1e51bc,network:_0x17fdac,dateFrom:_0x2e61c7,dateTo:_0x5b8a5e,search:_0x1d600c}=_0x534801,_0x2719a5=(_0xf5ef98-0x1)*_0x1b1126,_0x18639c={};_0x1e51bc&&(_0x18639c['shopId']=_0x1e51bc);_0x17fdac&&(_0x18639c[_0x2eb929(0xf8)]=_0x17fdac);if(_0x2e61c7||_0x5b8a5e){_0x18639c[_0x2eb929(0x217)]={};if(_0x2e61c7){const _0x115228=new Date(_0x2e61c7);_0x115228[_0x2eb929(0x1f5)](0x0,0x0,0x0,0x1),_0x18639c[_0x2eb929(0x217)]['gte']=_0x115228,console[_0x2eb929(0x13e)]('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x115228['toISOString']());}if(_0x5b8a5e){const _0x589885=new Date(_0x5b8a5e);_0x589885[_0x2eb929(0x1f5)](0x17,0x3b,0x3b,0x3e7),_0x18639c[_0x2eb929(0x217)][_0x2eb929(0x190)]=_0x589885,console[_0x2eb929(0x13e)]('ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20'+_0x589885[_0x2eb929(0x1f6)]());}}_0x1d600c&&(_0x18639c['OR']=[{'shop':{'name':{'contains':_0x1d600c,'mode':_0x2eb929(0x18e)}}},{'shop':{'username':{'contains':_0x1d600c,'mode':_0x2eb929(0x18e)}}},{'notes':{'contains':_0x1d600c,'mode':_0x2eb929(0x18e)}}]);const [_0x2fc6ec,_0xee481c]=await Promise[_0x2eb929(0x17f)]([database_1[_0x2eb929(0x14c)]['payout'][_0x2eb929(0x247)]({'where':_0x18639c,'skip':_0x2719a5,'take':_0x1b1126,'orderBy':{'createdAt':_0x2eb929(0x1ff)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2eb929(0x14c)]['payout'][_0x2eb929(0x132)]({'where':_0x18639c})]);return{'payouts':_0x2fc6ec['map'](_0x4cd9d1=>({'id':_0x4cd9d1['id'],'shopId':_0x4cd9d1['shopId'],'shopName':_0x4cd9d1[_0x2eb929(0x156)][_0x2eb929(0x1a7)],'shopUsername':_0x4cd9d1[_0x2eb929(0x156)][_0x2eb929(0x194)],'amount':_0x4cd9d1['amount'],'network':_0x4cd9d1[_0x2eb929(0xf8)],'wallet':_0x4cd9d1[_0x2eb929(0x262)],'status':_0x4cd9d1['status'],'txid':_0x4cd9d1['txid'],'notes':_0x4cd9d1['notes'],'periodFrom':_0x4cd9d1['periodFrom'],'periodTo':_0x4cd9d1[_0x2eb929(0x123)],'createdAt':_0x4cd9d1['createdAt'],'paidAt':_0x4cd9d1[_0x2eb929(0x21f)]})),'pagination':{'page':_0xf5ef98,'limit':_0x1b1126,'total':_0xee481c,'totalPages':Math[_0x2eb929(0x140)](_0xee481c/_0x1b1126)}};}async[a46_0x2977f1(0x1b6)](_0x581f2f){const _0x163269=a46_0x2977f1,_0x1f6ed6=await database_1['default'][_0x163269(0x1f9)][_0x163269(0x1f3)]({'where':{'id':_0x581f2f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1f6ed6)return null;return{'id':_0x1f6ed6['id'],'shopId':_0x1f6ed6[_0x163269(0x15f)],'shopName':_0x1f6ed6[_0x163269(0x156)][_0x163269(0x1a7)],'shopUsername':_0x1f6ed6['shop'][_0x163269(0x194)],'amount':_0x1f6ed6[_0x163269(0x197)],'network':_0x1f6ed6[_0x163269(0xf8)],'wallet':_0x1f6ed6[_0x163269(0x262)],'status':_0x1f6ed6[_0x163269(0x230)],'txid':_0x1f6ed6[_0x163269(0x15d)],'notes':_0x1f6ed6[_0x163269(0x1e9)],'periodFrom':_0x1f6ed6[_0x163269(0x11a)],'periodTo':_0x1f6ed6[_0x163269(0x123)],'createdAt':_0x1f6ed6[_0x163269(0x217)],'paidAt':_0x1f6ed6[_0x163269(0x21f)]};}async[a46_0x2977f1(0x213)](_0x4c3cdf){const _0x3b2094=a46_0x2977f1;await database_1[_0x3b2094(0x14c)][_0x3b2094(0x1f9)]['delete']({'where':{'id':_0x4c3cdf}});}async[a46_0x2977f1(0x1ac)](_0x28da39){const _0x3b02b8=a46_0x2977f1,{page:_0x49895e,limit:_0x3987a4,status:_0x49a7eb,gateway:_0x5b210f,shopId:_0x27e15b,dateFrom:_0x2536f2,dateTo:_0x23a6d4,search:_0x28b46e,currency:_0x26327b,sortBy:_0x2cb4ce,sortOrder:_0x4a8553}=_0x28da39,_0x11d19e=(_0x49895e-0x1)*_0x3987a4;console[_0x3b02b8(0x13e)]('ðŸ“Š\x20Getting\x20payments\x20with\x20filters:',_0x28da39);const _0x100333=await database_1[_0x3b02b8(0x14c)][_0x3b02b8(0x107)][_0x3b02b8(0x14e)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x3b02b8(0x13e)]('ðŸ“Š\x20Available\x20gateways\x20in\x20database:',_0x100333['map'](_0x2bae73=>_0x2bae73[_0x3b02b8(0x224)]+'\x20('+_0x2bae73[_0x3b02b8(0x260)][_0x3b02b8(0x224)]+_0x3b02b8(0x1b8)));if(_0x5b210f){const _0x17207e=_0x100333[_0x3b02b8(0x22a)](_0x14fc61=>_0x14fc61[_0x3b02b8(0x224)]['toLowerCase']()===_0x5b210f['toLowerCase']());!_0x17207e&&_0x5b210f[_0x3b02b8(0x25f)]()!==_0x3b02b8(0x16d)&&console[_0x3b02b8(0x13e)]('âš ï¸\x20Requested\x20gateway\x20\x27'+_0x5b210f+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x100333['map'](_0x419eae=>_0x419eae['gateway'])[_0x3b02b8(0xf4)](',\x20'));}const _0x3d8946={};_0x49a7eb&&(_0x3d8946[_0x3b02b8(0x230)]=_0x49a7eb[_0x3b02b8(0x1f8)]());if(!_0x5b210f)_0x3d8946['gateway']={'not':_0x3b02b8(0x16d)};else{if(_0x5b210f&&(_0x5b210f[_0x3b02b8(0x25f)]()==='test_gateway'||_0x5b210f==='0000'))_0x3d8946['gateway']=_0x3b02b8(0x16d);else{let _0x2791ed=_0x5b210f;const _0x48898d=(0x0,gateway_1[_0x3b02b8(0x237)])(_0x5b210f);if(_0x48898d)_0x2791ed=_0x48898d,console[_0x3b02b8(0x13e)](_0x3b02b8(0x1fd)+_0x5b210f+_0x3b02b8(0x16b)+_0x2791ed+'\x27');else{const _0x1dfcef=(0x0,gateway_1[_0x3b02b8(0xfe)])(_0x5b210f);if(_0x1dfcef){const _0x3e0a8c=(0x0,gateway_1[_0x3b02b8(0x237)])(_0x1dfcef);_0x3e0a8c&&(_0x2791ed=_0x3e0a8c,console['log']('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0x5b210f+_0x3b02b8(0x218)+_0x1dfcef+_0x3b02b8(0x250)+_0x2791ed+'\x27'));}else console[_0x3b02b8(0x13e)]('ðŸ”\x20Using\x20gateway\x20\x27'+_0x5b210f+_0x3b02b8(0x198));}const _0x4ba507=await database_1[_0x3b02b8(0x14c)][_0x3b02b8(0x107)][_0x3b02b8(0x132)]({'where':{'gateway':_0x2791ed[_0x3b02b8(0x25f)]()},'take':0x1});_0x4ba507===0x0?(console['log']('âš ï¸\x20Gateway\x20\x27'+_0x2791ed+'\x27\x20(from\x20\x27'+_0x5b210f+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x3d8946[_0x3b02b8(0x224)]=_0x3b02b8(0x153)):(_0x3d8946['gateway']=_0x2791ed[_0x3b02b8(0x25f)](),console[_0x3b02b8(0x13e)](_0x3b02b8(0xf9)+_0x2791ed+_0x3b02b8(0x10e)+_0x5b210f+'\x27)'));}}console[_0x3b02b8(0x13e)](_0x3b02b8(0x12e),_0x3d8946['gateway']);_0x27e15b&&(_0x3d8946['shopId']=_0x27e15b);_0x26327b&&(_0x3d8946['currency']=_0x26327b['toUpperCase'](),console['log']('ðŸ’±\x20Currency\x20filter\x20applied:\x20'+_0x26327b[_0x3b02b8(0x1f8)]()));if(_0x2536f2||_0x23a6d4){_0x3d8946[_0x3b02b8(0x217)]={};if(_0x2536f2){const _0x184e5d=new Date(_0x2536f2),_0x57b784=new Date(Date[_0x3b02b8(0x180)](_0x184e5d[_0x3b02b8(0x1e1)](),_0x184e5d[_0x3b02b8(0x185)](),_0x184e5d[_0x3b02b8(0x118)](),0x0,0x0,0x0,0x0));_0x3d8946[_0x3b02b8(0x217)][_0x3b02b8(0x12f)]=_0x57b784,console['log'](_0x3b02b8(0x100)+_0x57b784[_0x3b02b8(0x1f6)]());}if(_0x23a6d4){const _0x51e335=new Date(_0x23a6d4),_0x516057=new Date(Date[_0x3b02b8(0x180)](_0x51e335[_0x3b02b8(0x1e1)](),_0x51e335['getUTCMonth'](),_0x51e335[_0x3b02b8(0x118)](),0x17,0x3b,0x3b,0x3e7));_0x3d8946[_0x3b02b8(0x217)]['lte']=_0x516057,console['log'](_0x3b02b8(0x23f)+_0x516057['toISOString']());}}_0x28b46e&&(_0x3d8946['OR']=[{'id':{'contains':_0x28b46e,'mode':_0x3b02b8(0x18e)}},{'orderId':{'contains':_0x28b46e,'mode':_0x3b02b8(0x18e)}},{'gatewayOrderId':{'contains':_0x28b46e,'mode':_0x3b02b8(0x18e)}},{'customerEmail':{'contains':_0x28b46e,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x28b46e,'mode':_0x3b02b8(0x18e)}}},{'shop':{'username':{'contains':_0x28b46e,'mode':_0x3b02b8(0x18e)}}}]);console[_0x3b02b8(0x13e)](_0x3b02b8(0x150),JSON['stringify'](_0x3d8946,null,0x2));const _0x345926=await database_1['default'][_0x3b02b8(0x107)][_0x3b02b8(0x132)]({'where':_0x3d8946});console[_0x3b02b8(0x13e)](_0x3b02b8(0x227)+_0x345926);let _0xac4510={'createdAt':_0x3b02b8(0x1ff)};if(_0x2cb4ce){const _0x468cc5=[_0x3b02b8(0x197),_0x3b02b8(0x217),'updatedAt',_0x3b02b8(0x230),_0x3b02b8(0x224),'currency'],_0x3760a8=[_0x3b02b8(0x231),_0x3b02b8(0x1ff)];if(_0x468cc5['includes'](_0x2cb4ce)){const _0x4dc9ba=_0x3760a8[_0x3b02b8(0x12c)](_0x4a8553)?_0x4a8553:_0x3b02b8(0x1ff);_0xac4510={[_0x2cb4ce]:_0x4dc9ba},console[_0x3b02b8(0x13e)](_0x3b02b8(0x157)+_0x2cb4ce+_0x3b02b8(0x135)+_0x4dc9ba+_0x3b02b8(0x101));}}const [_0x2386ae,_0x106c9a]=await Promise['all']([database_1[_0x3b02b8(0x14c)][_0x3b02b8(0x107)][_0x3b02b8(0x247)]({'where':_0x3d8946,'skip':_0x11d19e,'take':_0x3987a4,'orderBy':_0xac4510,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3b02b8(0x14c)]['payment']['count']({'where':_0x3d8946})]);return{'payments':_0x2386ae,'pagination':{'page':_0x49895e,'limit':_0x3987a4,'total':_0x106c9a,'totalPages':Math[_0x3b02b8(0x140)](_0x106c9a/_0x3987a4)}};}async['getPaymentById'](_0x946136){const _0x5bfff5=a46_0x2977f1,_0x433d2a=await database_1[_0x5bfff5(0x14c)]['payment'][_0x5bfff5(0x1f3)]({'where':{'id':_0x946136},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x433d2a)return null;return{'id':_0x433d2a['id'],'shopId':_0x433d2a[_0x5bfff5(0x15f)],'gateway':_0x433d2a['gateway'],'amount':_0x433d2a[_0x5bfff5(0x197)],'currency':_0x433d2a[_0x5bfff5(0x139)],'status':_0x433d2a[_0x5bfff5(0x230)],'orderId':_0x433d2a[_0x5bfff5(0x109)],'gatewayOrderId':_0x433d2a['gatewayOrderId'],'customerEmail':_0x433d2a[_0x5bfff5(0x214)],'customerName':_0x433d2a[_0x5bfff5(0x14f)],'customerCountry':_0x433d2a[_0x5bfff5(0x124)],'customerIp':_0x433d2a['customerIp'],'customerUa':_0x433d2a[_0x5bfff5(0x143)],'failureMessage':_0x433d2a[_0x5bfff5(0x1eb)],'externalPaymentUrl':_0x433d2a[_0x5bfff5(0x25a)],'successUrl':_0x433d2a[_0x5bfff5(0x24f)],'failUrl':_0x433d2a['failUrl'],'pendingUrl':_0x433d2a['pendingUrl'],'whiteUrl':_0x433d2a[_0x5bfff5(0x244)],'createdAt':_0x433d2a[_0x5bfff5(0x217)],'updatedAt':_0x433d2a[_0x5bfff5(0x11f)],'shop':_0x433d2a[_0x5bfff5(0x156)]};}async[a46_0x2977f1(0x133)](_0x13749b,_0x6197d5,_0x1ff0c2,_0x1bacc0){const _0x557186=a46_0x2977f1,_0x4aa32a=await database_1[_0x557186(0x14c)][_0x557186(0x137)](async _0x218249=>{const _0x120c53=_0x557186,_0x14bd41=await _0x218249[_0x120c53(0x107)][_0x120c53(0x1f3)]({'where':{'id':_0x13749b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x14bd41)throw new Error(_0x120c53(0x1d9));const _0x345be5=_0x14bd41['status'],_0x312f10=_0x6197d5[_0x120c53(0x1f8)]();console[_0x120c53(0x13e)]('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0x13749b+'\x20status:\x20'+_0x345be5+'\x20->\x20'+_0x312f10),console['log'](_0x120c53(0x18c)+_0x14bd41[_0x120c53(0x156)][_0x120c53(0x1db)]+_0x120c53(0x1cc));const _0x100e71={'status':_0x312f10,'updatedAt':new Date(),'statusChangedBy':_0x120c53(0x19a),'statusChangedAt':new Date()};_0x1ff0c2&&(_0x100e71[_0x120c53(0xfb)]=_0x1ff0c2);_0x312f10===_0x120c53(0xff)&&_0x1bacc0&&(_0x100e71[_0x120c53(0x186)]=_0x1bacc0);let _0x146c20=0x0,_0x484472=_0x14bd41['shop'][_0x120c53(0x1db)];if(_0x312f10===_0x120c53(0x15b)&&_0x345be5!=='PAID'){_0x100e71['paidAt']=new Date();const _0x48f67e=await currencyService_1[_0x120c53(0x258)]['convertToUSDT'](_0x14bd41[_0x120c53(0x197)],_0x14bd41[_0x120c53(0x139)]);_0x100e71[_0x120c53(0x1ad)]=_0x48f67e;let _0x39c7ff=0x2d;const _0x291e37=await _0x218249[_0x120c53(0x156)]['findUnique']({'where':{'id':_0x14bd41['shopId']},'select':{'gatewaySettings':!![]}});if(_0x291e37?.[_0x120c53(0x173)])try{const _0x5142a4=JSON['parse'](_0x291e37['gatewaySettings']);for(const [_0x5da2dc,_0x2767d7]of Object[_0x120c53(0x142)](_0x5142a4)){if(_0x5da2dc['toLowerCase']()===_0x14bd41['gateway']['toLowerCase']()){_0x39c7ff=_0x2767d7[_0x120c53(0x131)]||0xa;break;}}}catch(_0x42a2e4){console[_0x120c53(0x191)](_0x120c53(0x1dd)+_0x13749b+':',_0x42a2e4);}let _0x5e9592;_0x14bd41['amountAfterGatewayCommissionUSDT']!==null&&_0x14bd41[_0x120c53(0x24a)]!==undefined?(_0x5e9592=_0x14bd41[_0x120c53(0x24a)],console[_0x120c53(0x13e)]('ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x5e9592[_0x120c53(0xf6)](0x6)+_0x120c53(0x225)+_0x13749b)):(_0x5e9592=_0x48f67e*(0x1-_0x39c7ff/0x64),console['log']('ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x13749b+':\x20'+_0x39c7ff+'%\x20from\x20'+_0x48f67e[_0x120c53(0xf6)](0x6)+_0x120c53(0x1cc)),_0x100e71['amountAfterGatewayCommissionUSDT']=_0x5e9592,_0x100e71[_0x120c53(0x1e2)]=_0x39c7ff),_0x146c20=_0x5e9592,_0x484472+=_0x5e9592,console[_0x120c53(0x13e)](_0x120c53(0x238)+_0x13749b+_0x120c53(0x166)),console[_0x120c53(0x13e)](_0x120c53(0x207)+_0x48f67e[_0x120c53(0xf6)](0x6)+_0x120c53(0x1cc)),console[_0x120c53(0x13e)](_0x120c53(0x208)+_0x14bd41[_0x120c53(0x224)]+_0x120c53(0x119)+_0x39c7ff+'%'),console[_0x120c53(0x13e)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x5e9592[_0x120c53(0xf6)](0x6)+_0x120c53(0x183)+_0x39c7ff+'%\x20commission)'),console[_0x120c53(0x13e)](_0x120c53(0x24c)+_0x5e9592['toFixed'](0x6)+_0x120c53(0x1cc));}else{if(_0x345be5===_0x120c53(0x15b)&&_0x312f10!=='PAID'&&_0x312f10!=='CHARGEBACK'){if(_0x14bd41[_0x120c53(0x1ad)]){let _0x43fbe3=0x2d;const _0x465a7d=await _0x218249[_0x120c53(0x156)][_0x120c53(0x1f3)]({'where':{'id':_0x14bd41[_0x120c53(0x15f)]},'select':{'gatewaySettings':!![]}});if(_0x465a7d?.['gatewaySettings'])try{const _0x1fa84e=JSON['parse'](_0x465a7d[_0x120c53(0x173)]);for(const [_0x20a3e0,_0xc2b3dc]of Object[_0x120c53(0x142)](_0x1fa84e)){if(_0x20a3e0[_0x120c53(0x25f)]()===_0x14bd41['gateway']['toLowerCase']()){_0x43fbe3=_0xc2b3dc[_0x120c53(0x131)]||0xa;break;}}}catch(_0xb7a501){console[_0x120c53(0x191)](_0x120c53(0x1dd)+_0x13749b+':',_0xb7a501);}const _0x49ac73=_0x14bd41[_0x120c53(0x1ad)]*(0x1-_0x43fbe3/0x64);_0x146c20=-_0x49ac73,_0x484472-=_0x49ac73,console[_0x120c53(0x13e)](_0x120c53(0x207)+_0x14bd41[_0x120c53(0x1ad)][_0x120c53(0xf6)](0x6)+_0x120c53(0x1cc)),console[_0x120c53(0x13e)](_0x120c53(0x208)+_0x14bd41['gateway']+',\x20Commission:\x20'+_0x43fbe3+'%'),console[_0x120c53(0x13e)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x49ac73[_0x120c53(0xf6)](0x6)+_0x120c53(0x183)+_0x43fbe3+_0x120c53(0x1cf)),console[_0x120c53(0x13e)](_0x120c53(0x128)+_0x49ac73['toFixed'](0x6)+_0x120c53(0x1cc));}}}_0x312f10===_0x120c53(0xff)&&(console[_0x120c53(0x13e)](_0x120c53(0x1b4)),_0x1bacc0&&_0x1bacc0>0x0?(_0x146c20=-_0x1bacc0,_0x484472-=_0x1bacc0,console[_0x120c53(0x13e)](_0x120c53(0x177)+_0x1bacc0[_0x120c53(0xf6)](0x6)+_0x120c53(0x155)),console[_0x120c53(0x13e)](_0x120c53(0x22e))):console[_0x120c53(0x13e)]('âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x100e71[_0x120c53(0x186)]=_0x1bacc0||0x0);_0x312f10===_0x120c53(0x20d)&&_0x345be5===_0x120c53(0x15b)&&console[_0x120c53(0x13e)](_0x120c53(0x111));const _0x10492d=await _0x218249['payment'][_0x120c53(0x232)]({'where':{'id':_0x13749b},'data':_0x100e71,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x146c20!==0x0&&(await _0x218249[_0x120c53(0x156)][_0x120c53(0x232)]({'where':{'id':_0x14bd41[_0x120c53(0x15f)]},'data':{'balance':_0x484472}}),console[_0x120c53(0x13e)]('ðŸ’°\x20Shop\x20'+_0x14bd41['shopId']+'\x20balance\x20updated:\x20'+_0x14bd41[_0x120c53(0x156)][_0x120c53(0x1db)][_0x120c53(0xf6)](0x6)+_0x120c53(0x223)+_0x484472['toFixed'](0x6)+_0x120c53(0x21d)+(_0x146c20>0x0?'+':'')+_0x146c20[_0x120c53(0xf6)](0x6)+')')),_0x10492d;});return{'id':_0x4aa32a['id'],'shopId':_0x4aa32a[_0x557186(0x15f)],'gateway':_0x4aa32a[_0x557186(0x224)],'amount':_0x4aa32a[_0x557186(0x197)],'currency':_0x4aa32a[_0x557186(0x139)],'status':_0x4aa32a[_0x557186(0x230)],'orderId':_0x4aa32a[_0x557186(0x109)],'gatewayOrderId':_0x4aa32a['gatewayOrderId'],'customerEmail':_0x4aa32a[_0x557186(0x214)],'customerName':_0x4aa32a[_0x557186(0x14f)],'customerCountry':_0x4aa32a[_0x557186(0x124)],'customerIp':_0x4aa32a[_0x557186(0x24e)],'customerUa':_0x4aa32a[_0x557186(0x143)],'failureMessage':_0x4aa32a['failureMessage'],'adminNotes':_0x4aa32a[_0x557186(0xfb)],'chargebackAmount':_0x4aa32a[_0x557186(0x186)],'statusChangedBy':_0x4aa32a[_0x557186(0x1c4)],'statusChangedAt':_0x4aa32a[_0x557186(0x1df)],'createdAt':_0x4aa32a[_0x557186(0x217)],'updatedAt':_0x4aa32a[_0x557186(0x11f)],'shop':_0x4aa32a[_0x557186(0x156)]};}async['updateUser'](_0x518d2e,_0x143230){const _0x64d65f=a46_0x2977f1,_0xa5d6b5=Math['random']()['toString'](0x24)['substr'](0x2,0x9);console['log'](_0x64d65f(0x243)+_0xa5d6b5+_0x64d65f(0x263)+_0x518d2e);const _0x12a61d={..._0x143230};_0x143230['password']&&_0x143230['password'][_0x64d65f(0x1de)]()!==''?(console[_0x64d65f(0x13e)](_0x64d65f(0x1f7)+_0xa5d6b5+_0x64d65f(0x113)+_0x518d2e),_0x12a61d['password']=await bcryptjs_1[_0x64d65f(0x14c)][_0x64d65f(0xfd)](_0x143230[_0x64d65f(0x11c)],0xc)):(console['log']('ðŸ”\x20['+_0xa5d6b5+_0x64d65f(0x204)),delete _0x12a61d['password']);_0x143230[_0x64d65f(0x1ba)]&&(_0x12a61d[_0x64d65f(0x1a7)]=_0x143230[_0x64d65f(0x1ba)],delete _0x12a61d[_0x64d65f(0x1ba)]);_0x143230['telegramId']&&(_0x12a61d[_0x64d65f(0x254)]=_0x143230[_0x64d65f(0x236)],delete _0x12a61d['telegramId']);_0x143230['merchantUrl']&&(_0x12a61d['shopUrl']=_0x143230[_0x64d65f(0x20b)],delete _0x12a61d[_0x64d65f(0x20b)]);if(_0x143230[_0x64d65f(0x115)]){const _0x15e06f=_0x143230[_0x64d65f(0x115)][_0x64d65f(0x1e4)](_0x9794f0=>this[_0x64d65f(0x122)](_0x9794f0));console[_0x64d65f(0x13e)]('ðŸ”„\x20Gateway\x20mapping:',_0x143230['gateways'],'->',_0x15e06f),_0x12a61d[_0x64d65f(0x242)]=JSON['stringify'](_0x15e06f),delete _0x12a61d[_0x64d65f(0x115)];}_0x143230[_0x64d65f(0x173)]&&(console['log']('ðŸ”§\x20['+_0xa5d6b5+_0x64d65f(0x1ab),_0x143230['gatewaySettings']),_0x12a61d[_0x64d65f(0x173)]=JSON[_0x64d65f(0x1c0)](_0x143230[_0x64d65f(0x173)]),console[_0x64d65f(0x13e)](_0x64d65f(0x168)+_0xa5d6b5+']\x20Gateway\x20settings\x20JSON\x20string:',_0x12a61d[_0x64d65f(0x173)]));_0x143230['wallets']&&(_0x143230[_0x64d65f(0x23e)][_0x64d65f(0x15a)]!==undefined&&(_0x12a61d[_0x64d65f(0x15a)]=_0x143230[_0x64d65f(0x23e)][_0x64d65f(0x15a)]||null),_0x143230[_0x64d65f(0x23e)][_0x64d65f(0x1ea)]!==undefined&&(_0x12a61d[_0x64d65f(0x1ea)]=_0x143230[_0x64d65f(0x23e)][_0x64d65f(0x1ea)]||null),_0x143230[_0x64d65f(0x23e)][_0x64d65f(0x12a)]!==undefined&&(_0x12a61d[_0x64d65f(0x12a)]=_0x143230[_0x64d65f(0x23e)][_0x64d65f(0x12a)]||null),_0x143230[_0x64d65f(0x23e)][_0x64d65f(0x21e)]!==undefined&&(_0x12a61d[_0x64d65f(0x21e)]=_0x143230['wallets'][_0x64d65f(0x21e)]||null),delete _0x12a61d['wallets']);const _0x27842d=await database_1[_0x64d65f(0x14c)]['shop'][_0x64d65f(0x232)]({'where':{'id':_0x518d2e},'data':_0x12a61d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x64d65f(0x13e)](_0x64d65f(0x10a)+_0xa5d6b5+_0x64d65f(0x261),_0x27842d[_0x64d65f(0x173)]),{'id':_0x27842d['id'],'fullName':_0x27842d[_0x64d65f(0x1a7)],'username':_0x27842d[_0x64d65f(0x194)],'telegramId':_0x27842d[_0x64d65f(0x254)],'merchantUrl':_0x27842d['shopUrl'],'gateways':_0x27842d[_0x64d65f(0x242)]?JSON[_0x64d65f(0x14d)](_0x27842d[_0x64d65f(0x242)]):null,'gatewaySettings':_0x27842d['gatewaySettings']?JSON[_0x64d65f(0x14d)](_0x27842d[_0x64d65f(0x173)]):null,'publicKey':_0x27842d[_0x64d65f(0x1e7)],'wallets':{'usdtPolygonWallet':_0x27842d[_0x64d65f(0x15a)],'usdtTrcWallet':_0x27842d[_0x64d65f(0x1ea)],'usdtErcWallet':_0x27842d[_0x64d65f(0x12a)],'usdcPolygonWallet':_0x27842d[_0x64d65f(0x21e)]},'status':_0x27842d['status'],'createdAt':_0x27842d[_0x64d65f(0x217)]};}async[a46_0x2977f1(0x161)](_0x24a6cd){const _0x3df887=a46_0x2977f1,_0x572ac1=await database_1[_0x3df887(0x14c)]['shop'][_0x3df887(0x232)]({'where':{'id':_0x24a6cd},'data':{'status':_0x3df887(0x176)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x572ac1['id'],'fullName':_0x572ac1[_0x3df887(0x1a7)],'username':_0x572ac1['username'],'telegramId':_0x572ac1[_0x3df887(0x254)],'merchantUrl':_0x572ac1[_0x3df887(0x18b)],'gateways':_0x572ac1[_0x3df887(0x242)]?JSON[_0x3df887(0x14d)](_0x572ac1[_0x3df887(0x242)]):null,'gatewaySettings':_0x572ac1[_0x3df887(0x173)]?JSON[_0x3df887(0x14d)](_0x572ac1['gatewaySettings']):null,'publicKey':_0x572ac1[_0x3df887(0x1e7)],'wallets':{'usdtPolygonWallet':_0x572ac1[_0x3df887(0x15a)],'usdtTrcWallet':_0x572ac1[_0x3df887(0x1ea)],'usdtErcWallet':_0x572ac1[_0x3df887(0x12a)],'usdcPolygonWallet':_0x572ac1[_0x3df887(0x21e)]},'status':_0x572ac1[_0x3df887(0x230)],'createdAt':_0x572ac1['createdAt']};}async[a46_0x2977f1(0x222)](_0x11a891){const _0x7d90b0=a46_0x2977f1,_0x3c9f9d=await database_1[_0x7d90b0(0x14c)][_0x7d90b0(0x156)][_0x7d90b0(0x232)]({'where':{'id':_0x11a891},'data':{'status':_0x7d90b0(0x25e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3c9f9d['id'],'fullName':_0x3c9f9d['name'],'username':_0x3c9f9d[_0x7d90b0(0x194)],'telegramId':_0x3c9f9d[_0x7d90b0(0x254)],'merchantUrl':_0x3c9f9d['shopUrl'],'gateways':_0x3c9f9d[_0x7d90b0(0x242)]?JSON[_0x7d90b0(0x14d)](_0x3c9f9d[_0x7d90b0(0x242)]):null,'gatewaySettings':_0x3c9f9d['gatewaySettings']?JSON['parse'](_0x3c9f9d[_0x7d90b0(0x173)]):null,'publicKey':_0x3c9f9d[_0x7d90b0(0x1e7)],'wallets':{'usdtPolygonWallet':_0x3c9f9d[_0x7d90b0(0x15a)],'usdtTrcWallet':_0x3c9f9d['usdtTrcWallet'],'usdtErcWallet':_0x3c9f9d[_0x7d90b0(0x12a)],'usdcPolygonWallet':_0x3c9f9d['usdcPolygonWallet']},'status':_0x3c9f9d[_0x7d90b0(0x230)],'createdAt':_0x3c9f9d[_0x7d90b0(0x217)]};}async['getAllUsers'](_0x1deb81){const _0xb3ffa1=a46_0x2977f1,{page:_0x31eb25,limit:_0x34c47e,status:_0x342f0c}=_0x1deb81,_0x53ad05=(_0x31eb25-0x1)*_0x34c47e,_0x41b971={};_0x342f0c&&(_0x41b971[_0xb3ffa1(0x230)]=_0x342f0c[_0xb3ffa1(0x1f8)]());const [_0x4b21a9,_0x5c3cf4]=await Promise[_0xb3ffa1(0x17f)]([database_1[_0xb3ffa1(0x14c)][_0xb3ffa1(0x156)]['findMany']({'where':_0x41b971,'skip':_0x53ad05,'take':_0x34c47e,'orderBy':{'createdAt':_0xb3ffa1(0x1ff)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0xb3ffa1(0x156)][_0xb3ffa1(0x132)]({'where':_0x41b971})]);return{'users':_0x4b21a9[_0xb3ffa1(0x1e4)](_0x4705d0=>{const _0x1a0429=_0xb3ffa1,_0x5b4fb8=_0x4705d0[_0x1a0429(0x242)]?JSON[_0x1a0429(0x14d)](_0x4705d0['paymentGateways']):null,_0xfac3d4=_0x5b4fb8?_0x5b4fb8[_0x1a0429(0x1e4)](_0x2c9d02=>this[_0x1a0429(0x1bd)](_0x2c9d02)):null;return{'id':_0x4705d0['id'],'fullName':_0x4705d0[_0x1a0429(0x1a7)],'username':_0x4705d0['username'],'telegramId':_0x4705d0['telegram'],'merchantUrl':_0x4705d0[_0x1a0429(0x18b)],'gateways':_0xfac3d4,'gatewaySettings':_0x4705d0[_0x1a0429(0x173)]?JSON[_0x1a0429(0x14d)](_0x4705d0[_0x1a0429(0x173)]):null,'publicKey':_0x4705d0[_0x1a0429(0x1e7)],'wallets':{'usdtPolygonWallet':_0x4705d0['usdtPolygonWallet'],'usdtTrcWallet':_0x4705d0[_0x1a0429(0x1ea)],'usdtErcWallet':_0x4705d0[_0x1a0429(0x12a)],'usdcPolygonWallet':_0x4705d0[_0x1a0429(0x21e)]},'status':_0x4705d0[_0x1a0429(0x230)],'createdAt':_0x4705d0[_0x1a0429(0x217)]};}),'pagination':{'page':_0x31eb25,'limit':_0x34c47e,'total':_0x5c3cf4,'totalPages':Math[_0xb3ffa1(0x140)](_0x5c3cf4/_0x34c47e)}};}async[a46_0x2977f1(0x17a)](_0x303c22){const _0x52d1a9=a46_0x2977f1,_0xc00474=await database_1['default'][_0x52d1a9(0x156)]['findUnique']({'where':{'id':_0x303c22},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xc00474)return null;const _0x16a5a6=_0xc00474[_0x52d1a9(0x242)]?JSON[_0x52d1a9(0x14d)](_0xc00474[_0x52d1a9(0x242)]):null,_0x5a54ba=_0x16a5a6?_0x16a5a6[_0x52d1a9(0x1e4)](_0x399398=>this['getGatewayDisplayName'](_0x399398)):null;return _0x16a5a6&&_0x5a54ba&&console[_0x52d1a9(0x13e)](_0x52d1a9(0x25b),_0x16a5a6,'->',_0x5a54ba),{'id':_0xc00474['id'],'fullName':_0xc00474[_0x52d1a9(0x1a7)],'username':_0xc00474[_0x52d1a9(0x194)],'telegramId':_0xc00474[_0x52d1a9(0x254)],'merchantUrl':_0xc00474[_0x52d1a9(0x18b)],'gateways':_0x5a54ba,'gatewaySettings':_0xc00474['gatewaySettings']?JSON[_0x52d1a9(0x14d)](_0xc00474[_0x52d1a9(0x173)]):null,'publicKey':_0xc00474['publicKey'],'wallets':{'usdtPolygonWallet':_0xc00474[_0x52d1a9(0x15a)],'usdtTrcWallet':_0xc00474[_0x52d1a9(0x1ea)],'usdtErcWallet':_0xc00474['usdtErcWallet'],'usdcPolygonWallet':_0xc00474['usdcPolygonWallet']},'status':_0xc00474[_0x52d1a9(0x230)],'createdAt':_0xc00474[_0x52d1a9(0x217)]};}async[a46_0x2977f1(0x1a8)](_0x20b65e){const _0x2144e3=a46_0x2977f1,{fullName:_0x2ec96f,username:_0x2874f3,password:_0x273c0f,telegramId:_0xed7691,merchantUrl:_0x15407e,gateways:_0x219235,gatewaySettings:_0x2f0ac4,wallets:_0x57b980}=_0x20b65e,_0x564c5f=await database_1[_0x2144e3(0x14c)][_0x2144e3(0x156)]['findUnique']({'where':{'username':_0x2874f3}});if(_0x564c5f)throw new Error(_0x2144e3(0x169));if(_0xed7691){const _0x447e51=await database_1['default'][_0x2144e3(0x156)][_0x2144e3(0x1f3)]({'where':{'telegram':_0xed7691}});if(_0x447e51)throw new Error(_0x2144e3(0x1a2));}const _0x28296d=await bcryptjs_1['default'][_0x2144e3(0xfd)](_0x273c0f,0xc),_0x205d7a=_0x2144e3(0x1ec)+crypto_1[_0x2144e3(0x14c)]['randomBytes'](0x20)['toString'](_0x2144e3(0x15c)),_0x2eb090=_0x2144e3(0x172)+crypto_1[_0x2144e3(0x14c)]['randomBytes'](0x20)['toString'](_0x2144e3(0x15c)),_0x2f6b2c=_0x219235?_0x219235[_0x2144e3(0x1e4)](_0x431d99=>this[_0x2144e3(0x122)](_0x431d99)):null;_0x219235&&_0x2f6b2c&&console[_0x2144e3(0x13e)](_0x2144e3(0x175),_0x219235,'->',_0x2f6b2c);const _0x2d6d71=await database_1[_0x2144e3(0x14c)]['shop'][_0x2144e3(0x165)]({'data':{'name':_0x2ec96f,'username':_0x2874f3,'password':_0x28296d,'telegram':_0xed7691,'shopUrl':_0x15407e,'paymentGateways':_0x2f6b2c?JSON[_0x2144e3(0x1c0)](_0x2f6b2c):null,'gatewaySettings':_0x2f0ac4?JSON[_0x2144e3(0x1c0)](_0x2f0ac4):null,'usdtPolygonWallet':_0x57b980?.[_0x2144e3(0x15a)]||null,'usdtTrcWallet':_0x57b980?.[_0x2144e3(0x1ea)]||null,'usdtErcWallet':_0x57b980?.[_0x2144e3(0x12a)]||null,'usdcPolygonWallet':_0x57b980?.[_0x2144e3(0x21e)]||null,'publicKey':_0x205d7a,'secretKey':_0x2eb090,'status':_0x2144e3(0x25e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2d6d71['id'],'fullName':_0x2d6d71[_0x2144e3(0x1a7)],'username':_0x2d6d71[_0x2144e3(0x194)],'telegramId':_0x2d6d71[_0x2144e3(0x254)],'merchantUrl':_0x2d6d71[_0x2144e3(0x18b)],'gateways':_0x2d6d71[_0x2144e3(0x242)]?JSON[_0x2144e3(0x14d)](_0x2d6d71[_0x2144e3(0x242)]):null,'gatewaySettings':_0x2d6d71[_0x2144e3(0x173)]?JSON['parse'](_0x2d6d71[_0x2144e3(0x173)]):null,'publicKey':_0x2d6d71['publicKey'],'wallets':{'usdtPolygonWallet':_0x2d6d71['usdtPolygonWallet'],'usdtTrcWallet':_0x2d6d71[_0x2144e3(0x1ea)],'usdtErcWallet':_0x2d6d71[_0x2144e3(0x12a)],'usdcPolygonWallet':_0x2d6d71['usdcPolygonWallet']},'status':_0x2d6d71[_0x2144e3(0x230)],'createdAt':_0x2d6d71['createdAt']};}async[a46_0x2977f1(0x23b)](_0x35af4f){const _0x173779=a46_0x2977f1;await database_1[_0x173779(0x14c)][_0x173779(0x156)][_0x173779(0x149)]({'where':{'id':_0x35af4f}});}[a46_0x2977f1(0x202)](_0x4d4466,_0x250f7e,_0x325a7c){const _0x5b34e9=a46_0x2977f1,_0x1e6793=new Map(),_0x45e10e=new Date(_0x250f7e);while(_0x45e10e<=_0x325a7c){const _0x27d469=_0x45e10e['toISOString']()[_0x5b34e9(0x20a)]('T')[0x0];_0x1e6793[_0x5b34e9(0x1a5)](_0x27d469,{'revenue':0x0,'count':0x0}),_0x45e10e[_0x5b34e9(0x110)](_0x45e10e[_0x5b34e9(0x181)]()+0x1);}for(const _0x330aa0 of _0x4d4466){const _0x158eda=_0x330aa0[_0x5b34e9(0x217)]['toISOString']()['split']('T')[0x0],_0x1ef7d4=_0x1e6793[_0x5b34e9(0x245)](_0x158eda);_0x1ef7d4&&(_0x1ef7d4['count']+=0x1,_0x330aa0[_0x5b34e9(0x230)]===_0x5b34e9(0x15b)&&(_0x330aa0['amountUSDT']?_0x1ef7d4[_0x5b34e9(0x1c9)]+=_0x330aa0[_0x5b34e9(0x1ad)]:console[_0x5b34e9(0x13e)]('âš ï¸\x20Payment\x20'+_0x330aa0['id']+_0x5b34e9(0x196))));}const _0x5aecf1=[],_0x5505df=[];for(const [_0x134c25,_0x3e563d]of _0x1e6793){_0x5aecf1['push']({'date':_0x134c25,'amount':Math[_0x5b34e9(0x1fa)](_0x3e563d['revenue']*0x64)/0x64}),_0x5505df[_0x5b34e9(0x1a9)]({'date':_0x134c25,'count':_0x3e563d['count']});}return{'dailyRevenue':_0x5aecf1,'dailyPayments':_0x5505df};}}exports[a46_0x2977f1(0x147)]=AdminService;