'use strict';const a35_0x2103e9=a35_0x719b;(function(_0x2d4add,_0x476120){const _0x3bff85=a35_0x719b,_0x9bb9f2=_0x2d4add();while(!![]){try{const _0x6b563=parseInt(_0x3bff85(0x18b))/0x1*(-parseInt(_0x3bff85(0xc7))/0x2)+parseInt(_0x3bff85(0xdb))/0x3+-parseInt(_0x3bff85(0x134))/0x4*(-parseInt(_0x3bff85(0x124))/0x5)+-parseInt(_0x3bff85(0x15d))/0x6+-parseInt(_0x3bff85(0xca))/0x7+-parseInt(_0x3bff85(0x10f))/0x8*(parseInt(_0x3bff85(0x18d))/0x9)+-parseInt(_0x3bff85(0x102))/0xa*(-parseInt(_0x3bff85(0x114))/0xb);if(_0x6b563===_0x476120)break;else _0x9bb9f2['push'](_0x9bb9f2['shift']());}catch(_0x1cee93){_0x9bb9f2['push'](_0x9bb9f2['shift']());}}}(a35_0x3a99,0x21956));var __importDefault=this&&this['__importDefault']||function(_0x1e9347){const _0x26c076=a35_0x719b;return _0x1e9347&&_0x1e9347[_0x26c076(0x199)]?_0x1e9347:{'default':_0x1e9347};};Object[a35_0x2103e9(0xed)](exports,a35_0x2103e9(0x199),{'value':!![]}),exports[a35_0x2103e9(0xee)]=void 0x0;function a35_0x3a99(){const _0x199603=['paidAt','default','year','\x20balance\x20updated:\x20','1HRrXku','gateway','6579THtDwA','update','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','getFullYear','pendingUrl','gatewayEarnings','getAllUsers','Shop\x20not\x20found','totalTurnover','Rapyd','amountUSDT','\x20USDT)','__esModule','getPayoutById','findFirst','\x20USDT,\x20Requested:\x20','delete','\x20\x20\x20Current\x20balance:\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','createUser','452258VHVgmD','split','custom','475545eSZven','\x20\x20\x20Payout\x20amount:\x20','usdtPolygonWallet','telegram','$transaction','totalCommissionRate','pk_','\x20\x20\x20📅\x20This\x20month:\x20','values','\x20USDT\x20(','PAID','deletePayout','fullName','\x20USDT\x20(total\x20merchant\x20balances)','Plisio','week','getMerchantsAwaitingPayout','353721wiKZRM','admin','adminNotes','notes','\x20USDT\x20(-','getMerchantStatistics','shopUrl','lte','periodTo','amount','hash','forEach','statusChangedAt','getGatewayDisplayName','gateways','name','getPaymentById','ACTIVE','defineProperty','AdminService','toISOString','stringify','network','\x20became\x20PAID:\x20+','publicKey','\x20USDT\x20(same\x20as\x20awaiting)','KLYME\x20EU','gatewaySettings','suspendUser','\x20USDT\x20(+','all','\x20merchants\x20with\x20positive\x20balance','gte','Insufficient\x20balance.\x20Available:\x20','merchantEarnings','\x20\x20\x20🖥️\x20User\x20Agent:\x20','periodFrom','getPayoutStats','desc','8006150djmLMl','\x20\x20\x20📊\x20Total\x20payments:\x20','\x20status:\x20','\x20merchants,\x20','SUSPENDED','orderId','paidOutUSDT','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','count','randomBytes','convertToUSDT','Noda','findUnique','2456yNLNot','ceil','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','currency','Test\x20Gateway','11WUqAOo','Payment\x20not\x20found','payout','getAllPayments','customerUa','aggregate','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','./currencyService','\x20\x20\x20Total\x20paid\x20out:\x20','💰\x20Current\x20shop\x20balance:\x20','updateCustomerData','error','commissionUSDT','getSystemStatistics','💰\x20Shop\x20','5SsmnnT','activateUser','telegramId','customerCountry','payment','password','customerEmail','insensitive','\x20for\x20shop\x20','string','txid','bcryptjs','createdAt','toFixed','💰\x20Payment\x20','\x20balance\x20updated:','47188iBcqYg','getTime','merchantUrl','not\x20set','💰\x20Found\x20','localeCompare','toLowerCase','toString','date','📊\x20Calculating\x20payout\x20statistics...','customerIp','chargebackAmount','failUrl','sort','status','2020-01-01','\x20USDT','\x20USDT\x20total','_count','length','COMPLETED','wallets','map','\x20USDT\x20to\x20balance','turnover','month','currencyService','shop','🔄\x20Admin\x20updating\x20payment\x20','paymentsCount','averageCommissionRate','dateTo','balance','toUpperCase','30d','hex','test_gateway','getAllPayouts','usdtErcWallet','updateUser','findMany','1645680FjVePN','✅\x20Payout\x20created:\x20','totalPayout','📊\x20Merchants\x20awaiting\x20payout:\x20','failureMessage','getMonth','round','totalPayments','parse','\x20USDT\x20from\x20balance','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','customerName','groupBy','usdtTrcWallet','KLYME\x20DE','90d','username','asc','CHARGEBACK','period','\x20USDT\x20(total\x20paid\x20to\x20merchants)','dateFrom','\x20\x20\x20💰\x20Total\x20payout:\x20','log','shopId','updatedAt','whiteUrl','gatewayOrderId','\x20->\x20','reduce','merchantEarningsUSDT','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','successUrl','totalPaidOut','turnoverUSDT','usdcPolygonWallet','_sum','paymentGateways','thisMonth','crypto','KLYME\x20GB','availableBalance'];a35_0x3a99=function(){return _0x199603;};return a35_0x3a99();}const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x2103e9(0x12f))),crypto_1=__importDefault(require(a35_0x2103e9(0x184))),currencyService_1=require(a35_0x2103e9(0x11c));function a35_0x719b(_0x155696,_0x2de685){const _0x3a9919=a35_0x3a99();return a35_0x719b=function(_0x719b01,_0x3fd75a){_0x719b01=_0x719b01-0xc7;let _0x5c1a45=_0x3a9919[_0x719b01];return _0x5c1a45;},a35_0x719b(_0x155696,_0x2de685);}class AdminService{async[a35_0x2103e9(0x100)](){const _0x5e1bf9=a35_0x2103e9;console['log'](_0x5e1bf9(0x13d));const _0x1dfcb8=await database_1[_0x5e1bf9(0x188)][_0x5e1bf9(0x14f)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x5e1bf9(0xec)}}),_0x362740=new Date(),_0x308537=new Date(_0x362740[_0x5e1bf9(0x190)](),_0x362740[_0x5e1bf9(0x162)](),0x1),_0x6273c0=new Date(_0x362740['getFullYear'](),_0x362740['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x44c2dc=await database_1[_0x5e1bf9(0x188)][_0x5e1bf9(0x116)][_0x5e1bf9(0x119)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x308537,'lte':_0x6273c0},'status':_0x5e1bf9(0x148)}}),_0x55e37a=_0x1dfcb8[_0x5e1bf9(0x181)][_0x5e1bf9(0x17e)]||0x0,_0x11457f=_0x1dfcb8[_0x5e1bf9(0x181)]['balance']||0x0,_0x19ac7f=_0x44c2dc[_0x5e1bf9(0x181)][_0x5e1bf9(0xe4)]||0x0,_0x50ed45={'totalPayout':Math[_0x5e1bf9(0x163)](_0x55e37a*0x64)/0x64,'awaitingPayout':Math[_0x5e1bf9(0x163)](_0x11457f*0x64)/0x64,'thisMonth':Math[_0x5e1bf9(0x163)](_0x19ac7f*0x64)/0x64,'availableBalance':Math[_0x5e1bf9(0x163)](_0x11457f*0x64)/0x64};return console[_0x5e1bf9(0x174)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x5e1bf9(0x174)](_0x5e1bf9(0x173)+_0x50ed45[_0x5e1bf9(0x15f)]+_0x5e1bf9(0x171)),console[_0x5e1bf9(0x174)](_0x5e1bf9(0x11b)+_0x50ed45['awaitingPayout']+_0x5e1bf9(0xd7)),console[_0x5e1bf9(0x174)](_0x5e1bf9(0x11a)+_0x50ed45[_0x5e1bf9(0x186)]+_0x5e1bf9(0xf4)),console[_0x5e1bf9(0x174)](_0x5e1bf9(0xd1)+_0x50ed45[_0x5e1bf9(0x183)]+_0x5e1bf9(0x144)),_0x50ed45;}async[a35_0x2103e9(0x11f)](_0x1a4f17,_0x5082e1){const _0x53c4f5=a35_0x2103e9;console[_0x53c4f5(0x174)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x1a4f17+':',_0x5082e1);const _0x34344e=await database_1['default'][_0x53c4f5(0x128)]['findUnique']({'where':{'id':_0x1a4f17},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x34344e)throw new Error(_0x53c4f5(0x115));const _0xb73b71={};_0x5082e1[_0x53c4f5(0x127)]!==undefined&&(_0xb73b71[_0x53c4f5(0x127)]=_0x5082e1['customerCountry']||null);_0x5082e1[_0x53c4f5(0x13e)]!==undefined&&(_0xb73b71[_0x53c4f5(0x13e)]=_0x5082e1['customerIp']||null);_0x5082e1[_0x53c4f5(0x118)]!==undefined&&(_0xb73b71['customerUa']=_0x5082e1[_0x53c4f5(0x118)]||null);const _0x4ba30e=await database_1[_0x53c4f5(0x188)][_0x53c4f5(0x128)][_0x53c4f5(0x18e)]({'where':{'id':_0x1a4f17},'data':{..._0xb73b71,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x53c4f5(0x174)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x1a4f17),console[_0x53c4f5(0x174)]('\x20\x20\x20🌍\x20Country:\x20'+_0x34344e['customerCountry']+_0x53c4f5(0x179)+_0x4ba30e[_0x53c4f5(0x127)]),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x34344e[_0x53c4f5(0x13e)]+'\x20->\x20'+_0x4ba30e[_0x53c4f5(0x13e)]),console['log'](_0x53c4f5(0xfe)+(_0x34344e[_0x53c4f5(0x118)]?'set':_0x53c4f5(0x137))+_0x53c4f5(0x179)+(_0x4ba30e[_0x53c4f5(0x118)]?'set':'not\x20set')),_0x4ba30e;}async[a35_0x2103e9(0x122)](_0x40029f){const _0x5012ed=a35_0x2103e9,_0x5af68e=new Date();let _0xbd31b4;switch(_0x40029f){case'7d':_0xbd31b4=new Date(_0x5af68e['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5012ed(0x156):_0xbd31b4=new Date(_0x5af68e[_0x5012ed(0x135)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5012ed(0x16c):_0xbd31b4=new Date(_0x5af68e[_0x5012ed(0x135)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xbd31b4=new Date(_0x5af68e[_0x5012ed(0x135)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x25b2ff,_0x1fe936,_0x29c4c4,_0x1e4aa5,_0x472953,_0x503b3a]=await Promise[_0x5012ed(0xf9)]([database_1[_0x5012ed(0x188)][_0x5012ed(0x14f)][_0x5012ed(0x10a)](),database_1[_0x5012ed(0x188)][_0x5012ed(0x14f)][_0x5012ed(0x10a)]({'where':{'status':'ACTIVE'}}),database_1[_0x5012ed(0x188)][_0x5012ed(0x128)][_0x5012ed(0x10a)]({'where':{'createdAt':{'gte':_0xbd31b4},'gateway':{'not':_0x5012ed(0x158)}}}),database_1[_0x5012ed(0x188)][_0x5012ed(0x128)]['count']({'where':{'status':_0x5012ed(0xd4),'createdAt':{'gte':_0xbd31b4},'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x5012ed(0x128)][_0x5012ed(0x15c)]({'where':{'status':'PAID','createdAt':{'gte':_0xbd31b4},'gateway':{'not':_0x5012ed(0x158)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x5012ed(0x188)][_0x5012ed(0x128)][_0x5012ed(0x15c)]({'where':{'gateway':{'not':_0x5012ed(0x158)}},'take':0xa,'orderBy':{'createdAt':_0x5012ed(0x101)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x38a525=0x0;for(const _0x3fafd7 of _0x472953){const _0x17695c=await currencyService_1[_0x5012ed(0x14e)][_0x5012ed(0x10c)](_0x3fafd7[_0x5012ed(0xe4)],_0x3fafd7[_0x5012ed(0x112)]);_0x38a525+=_0x17695c;}const _0x8194b4=_0x29c4c4>0x0?_0x1e4aa5/_0x29c4c4*0x64:0x0;return{'totalShops':_0x25b2ff,'activeShops':_0x1fe936,'totalPayments':_0x29c4c4,'successfulPayments':_0x1e4aa5,'totalRevenue':Math['round'](_0x38a525*0x64)/0x64,'conversionRate':Math[_0x5012ed(0x163)](_0x8194b4*0x64)/0x64,'recentPayments':_0x503b3a[_0x5012ed(0x14a)](_0x33a81f=>({'id':_0x33a81f['id'],'amount':_0x33a81f[_0x5012ed(0xe4)],'currency':_0x33a81f[_0x5012ed(0x112)],'status':_0x33a81f[_0x5012ed(0x142)],'gateway':_0x33a81f[_0x5012ed(0x18c)],'shop':_0x33a81f[_0x5012ed(0x14f)],'createdAt':_0x33a81f[_0x5012ed(0x130)]}))};}async[a35_0x2103e9(0xe0)](_0x475de1){const _0x2a8334=a35_0x2103e9;console[_0x2a8334(0x174)](_0x2a8334(0x109),_0x475de1);let _0x6f3eb9,_0x42220c=new Date();if(_0x475de1[_0x2a8334(0x170)]===_0x2a8334(0xc9)&&_0x475de1[_0x2a8334(0x172)]&&_0x475de1[_0x2a8334(0x153)])_0x6f3eb9=new Date(_0x475de1[_0x2a8334(0x172)]),_0x42220c=new Date(_0x475de1[_0x2a8334(0x153)]);else{const _0x523f84=new Date();switch(_0x475de1[_0x2a8334(0x170)]){case _0x2a8334(0xd9):_0x6f3eb9=new Date(_0x523f84['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2a8334(0x14d):_0x6f3eb9=new Date(_0x523f84[_0x2a8334(0x135)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2a8334(0x189):_0x6f3eb9=new Date(_0x523f84[_0x2a8334(0x135)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2a8334(0xf9):default:_0x6f3eb9=new Date(_0x2a8334(0x143));break;}}console[_0x2a8334(0x174)]('📅\x20Period:\x20'+_0x6f3eb9[_0x2a8334(0xef)]()+'\x20to\x20'+_0x42220c[_0x2a8334(0xef)]());const _0x4167f3={'status':_0x2a8334(0xd4),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x6f3eb9,'lte':_0x42220c}};_0x475de1['shopId']&&(_0x4167f3['shopId']=_0x475de1[_0x2a8334(0x175)]);const _0x370d9c=await database_1[_0x2a8334(0x188)][_0x2a8334(0x128)]['findMany']({'where':_0x4167f3,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2a8334(0x174)](_0x2a8334(0x138)+_0x370d9c[_0x2a8334(0x147)]+'\x20paid\x20payments\x20for\x20analysis');let _0x3ecd3b=0x0,_0x55d140=0x0,_0x1f6b61=0x0;const _0x3aefbc={},_0x56e11e={},_0x7649f1={};for(const _0x287f12 of _0x370d9c){try{const _0x1cc0dd=await currencyService_1[_0x2a8334(0x14e)][_0x2a8334(0x10c)](_0x287f12['amount'],_0x287f12[_0x2a8334(0x112)]);let _0x4295d2={};if(_0x287f12[_0x2a8334(0x14f)][_0x2a8334(0xf6)])try{_0x4295d2=JSON[_0x2a8334(0x165)](_0x287f12['shop']['gatewaySettings']);}catch(_0x369699){console[_0x2a8334(0x120)](_0x2a8334(0x111)+_0x287f12[_0x2a8334(0x175)]+':',_0x369699);}const _0x56e2d0=_0x4295d2['commission']||0xa,_0x23c03f=_0x1cc0dd*(_0x56e2d0/0x64),_0x5c8ed4=_0x1cc0dd-_0x23c03f;_0x3ecd3b+=_0x1cc0dd,_0x55d140+=_0x5c8ed4,_0x1f6b61+=_0x23c03f;!_0x3aefbc[_0x287f12['gateway']]&&(_0x3aefbc[_0x287f12[_0x2a8334(0x18c)]]={'gateway':_0x287f12['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x287f12[_0x2a8334(0x18c)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3aefbc[_0x287f12['gateway']][_0x2a8334(0x151)]++,_0x3aefbc[_0x287f12[_0x2a8334(0x18c)]]['turnoverUSDT']+=_0x1cc0dd,_0x3aefbc[_0x287f12['gateway']][_0x2a8334(0x121)]+=_0x23c03f,_0x3aefbc[_0x287f12[_0x2a8334(0x18c)]]['merchantEarningsUSDT']+=_0x5c8ed4,_0x3aefbc[_0x287f12[_0x2a8334(0x18c)]][_0x2a8334(0xcf)]+=_0x56e2d0;!_0x475de1[_0x2a8334(0x175)]&&(!_0x56e11e[_0x287f12[_0x2a8334(0x175)]]&&(_0x56e11e[_0x287f12[_0x2a8334(0x175)]]={'shopId':_0x287f12['shopId'],'shopName':_0x287f12[_0x2a8334(0x14f)]['name'],'shopUsername':_0x287f12[_0x2a8334(0x14f)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x56e11e[_0x287f12['shopId']][_0x2a8334(0x151)]++,_0x56e11e[_0x287f12[_0x2a8334(0x175)]][_0x2a8334(0x17f)]+=_0x1cc0dd,_0x56e11e[_0x287f12['shopId']]['commissionUSDT']+=_0x23c03f,_0x56e11e[_0x287f12[_0x2a8334(0x175)]][_0x2a8334(0x17b)]+=_0x5c8ed4);const _0x4572bb=_0x287f12[_0x2a8334(0x187)]['toISOString']()[_0x2a8334(0xc8)]('T')[0x0];!_0x7649f1[_0x4572bb]&&(_0x7649f1[_0x4572bb]={'date':_0x4572bb,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x7649f1[_0x4572bb][_0x2a8334(0x14c)]+=_0x1cc0dd,_0x7649f1[_0x4572bb][_0x2a8334(0xfd)]+=_0x5c8ed4,_0x7649f1[_0x4572bb][_0x2a8334(0x192)]+=_0x23c03f,_0x7649f1[_0x4572bb][_0x2a8334(0x151)]++;}catch(_0x239154){console['error']('Error\x20processing\x20payment\x20'+_0x287f12['id']+':',_0x239154);}}Object['values'](_0x3aefbc)['forEach'](_0xe51906=>{const _0x327327=_0x2a8334;_0xe51906['averageCommissionRate']=_0xe51906[_0x327327(0x151)]>0x0?_0xe51906[_0x327327(0xcf)]/_0xe51906[_0x327327(0x151)]:0x0,delete _0xe51906[_0x327327(0xcf)];}),Object[_0x2a8334(0xd2)](_0x56e11e)[_0x2a8334(0xe6)](_0x43ee6a=>{const _0x5e8833=_0x2a8334;_0x43ee6a['averageCheckUSDT']=_0x43ee6a['paymentsCount']>0x0?_0x43ee6a[_0x5e8833(0x17f)]/_0x43ee6a['paymentsCount']:0x0;});let _0x52d70d=0x0;if(_0x475de1['shopId']){const _0x35eae4=await database_1['default'][_0x2a8334(0x116)][_0x2a8334(0x15c)]({'where':{'shopId':_0x475de1[_0x2a8334(0x175)],'status':_0x2a8334(0x148),'createdAt':{'gte':_0x6f3eb9,'lte':_0x42220c}},'select':{'amount':!![]}});_0x52d70d=_0x35eae4[_0x2a8334(0x17a)]((_0x3287f4,_0x3f768e)=>_0x3287f4+_0x3f768e[_0x2a8334(0xe4)],0x0);}const _0x14bcb5=_0x370d9c[_0x2a8334(0x147)],_0x3674f3=_0x370d9c[_0x2a8334(0x147)],_0x32690a=_0x14bcb5>0x0?_0x3ecd3b/_0x14bcb5:0x0,_0x22155d=0x64,_0x4d2cf2=Math['ceil']((_0x42220c[_0x2a8334(0x135)]()-_0x6f3eb9[_0x2a8334(0x135)]())/(0x3e8*0x3c*0x3c*0x18)),_0x10ea2a={'totalTurnover':Math[_0x2a8334(0x163)](_0x3ecd3b*0x64)/0x64,'merchantEarnings':Math[_0x2a8334(0x163)](_0x55d140*0x64)/0x64,'gatewayEarnings':Math[_0x2a8334(0x163)](_0x1f6b61*0x64)/0x64,'totalPaidOut':Math[_0x2a8334(0x163)](_0x52d70d*0x64)/0x64,'averageCheck':Math['round'](_0x32690a*0x64)/0x64,'totalPayments':_0x14bcb5,'successfulPayments':_0x3674f3,'conversionRate':_0x22155d,'gatewayBreakdown':Object[_0x2a8334(0xd2)](_0x3aefbc)[_0x2a8334(0x14a)](_0x2fdd25=>({..._0x2fdd25,'turnoverUSDT':Math[_0x2a8334(0x163)](_0x2fdd25[_0x2a8334(0x17f)]*0x64)/0x64,'commissionUSDT':Math[_0x2a8334(0x163)](_0x2fdd25[_0x2a8334(0x121)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2fdd25['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x2a8334(0x163)](_0x2fdd25[_0x2a8334(0x152)]*0x64)/0x64})),'merchantBreakdown':_0x475de1[_0x2a8334(0x175)]?undefined:Object[_0x2a8334(0xd2)](_0x56e11e)[_0x2a8334(0x14a)](_0x48b8df=>({..._0x48b8df,'turnoverUSDT':Math['round'](_0x48b8df[_0x2a8334(0x17f)]*0x64)/0x64,'commissionUSDT':Math[_0x2a8334(0x163)](_0x48b8df[_0x2a8334(0x121)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2a8334(0x163)](_0x48b8df[_0x2a8334(0x17b)]*0x64)/0x64,'paidOutUSDT':Math[_0x2a8334(0x163)](_0x48b8df[_0x2a8334(0x108)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2a8334(0x163)](_0x48b8df['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x2a8334(0xd2)](_0x7649f1)[_0x2a8334(0x14a)](_0x5234a3=>({..._0x5234a3,'turnover':Math[_0x2a8334(0x163)](_0x5234a3['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x2a8334(0x163)](_0x5234a3[_0x2a8334(0xfd)]*0x64)/0x64,'gatewayEarnings':Math[_0x2a8334(0x163)](_0x5234a3['gatewayEarnings']*0x64)/0x64}))[_0x2a8334(0x141)]((_0x533ff7,_0x109710)=>_0x533ff7[_0x2a8334(0x13c)][_0x2a8334(0x139)](_0x109710[_0x2a8334(0x13c)])),'periodInfo':{'from':_0x6f3eb9,'to':_0x42220c,'periodType':_0x475de1[_0x2a8334(0x170)]||_0x2a8334(0xc9),'daysCount':_0x4d2cf2}};return console[_0x2a8334(0x174)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x2a8334(0x174)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x10ea2a[_0x2a8334(0x195)]+_0x2a8334(0x144)),console[_0x2a8334(0x174)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x10ea2a['merchantEarnings']+'\x20USDT'),console[_0x2a8334(0x174)](_0x2a8334(0x17c)+_0x10ea2a[_0x2a8334(0x192)]+_0x2a8334(0x144)),console['log'](_0x2a8334(0x103)+_0x10ea2a[_0x2a8334(0x164)]),_0x10ea2a;}[a35_0x2103e9(0xe8)](_0x5425d5){const _0x274982=a35_0x2103e9,_0x303538={'test_gateway':_0x274982(0x113),'plisio':_0x274982(0xd8),'rapyd':_0x274982(0x196),'noda':_0x274982(0x10d),'cointopay':'CoinToPay','klyme_eu':_0x274982(0xf5),'klyme_gb':_0x274982(0x185),'klyme_de':_0x274982(0x16b)};return _0x303538[_0x5425d5]||_0x5425d5;}async[a35_0x2103e9(0xda)](_0x2c1975){const _0x3845ba=a35_0x2103e9,{page:_0x79705f,limit:_0x306284,minAmount:_0x4238b7,search:_0x114bdc}=_0x2c1975,_0x1433fe=(_0x79705f-0x1)*_0x306284;console[_0x3845ba(0x174)](_0x3845ba(0x167),_0x2c1975);const _0x5aa4bf={'balance':{'gt':0x0},'status':_0x3845ba(0xec)};_0x4238b7&&(_0x5aa4bf['balance'][_0x3845ba(0xfb)]=_0x4238b7);_0x114bdc&&(_0x5aa4bf['OR']=[{'name':{'contains':_0x114bdc,'mode':_0x3845ba(0x12b)}},{'username':{'contains':_0x114bdc,'mode':'insensitive'}}]);const [_0x9f3394,_0x39fe58]=await Promise[_0x3845ba(0xf9)]([database_1[_0x3845ba(0x188)][_0x3845ba(0x14f)][_0x3845ba(0x15c)]({'where':_0x5aa4bf,'skip':_0x1433fe,'take':_0x306284,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x3845ba(0x188)][_0x3845ba(0x14f)][_0x3845ba(0x10a)]({'where':_0x5aa4bf})]);console[_0x3845ba(0x174)]('💰\x20Found\x20'+_0x9f3394[_0x3845ba(0x147)]+_0x3845ba(0xfa));const _0x3608d9=await Promise['all'](_0x9f3394[_0x3845ba(0x14a)](async _0xe4d126=>{const _0x5600ad=_0x3845ba,[_0x1d7732,_0x4188cd,_0x299cfb]=await Promise[_0x5600ad(0xf9)]([database_1['default']['payment'][_0x5600ad(0x10a)]({'where':{'shopId':_0xe4d126['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x5600ad(0x188)][_0x5600ad(0x128)][_0x5600ad(0x19b)]({'where':{'shopId':_0xe4d126['id'],'status':_0x5600ad(0xd4),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x5600ad(0x16e)},'select':{'paidAt':!![]}}),database_1[_0x5600ad(0x188)]['payment'][_0x5600ad(0x169)]({'by':[_0x5600ad(0x18c)],'where':{'shopId':_0xe4d126['id'],'status':_0x5600ad(0xd4),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x464c46=_0x299cfb['map'](_0x1a669b=>({'gateway':_0x1a669b[_0x5600ad(0x18c)],'count':_0x1a669b[_0x5600ad(0x146)]['id'],'amountUSDT':_0x1a669b['_sum'][_0x5600ad(0x197)]||0x0,'amountAfterCommissionUSDT':_0x1a669b[_0x5600ad(0x181)][_0x5600ad(0x197)]||0x0,'commission':0x0}));return{'id':_0xe4d126['id'],'fullName':_0xe4d126[_0x5600ad(0xea)],'username':_0xe4d126['username'],'telegramId':_0xe4d126[_0x5600ad(0xcd)],'merchantUrl':_0xe4d126[_0x5600ad(0xe1)],'wallets':{'usdtPolygonWallet':_0xe4d126['usdtPolygonWallet'],'usdtTrcWallet':_0xe4d126['usdtTrcWallet'],'usdtErcWallet':_0xe4d126['usdtErcWallet'],'usdcPolygonWallet':_0xe4d126[_0x5600ad(0x180)]},'totalAmountUSDT':_0xe4d126[_0x5600ad(0x154)],'totalAmountAfterCommissionUSDT':_0xe4d126['balance'],'paymentsCount':_0x1d7732,'oldestPaymentDate':_0x4188cd?.['paidAt']||_0xe4d126[_0x5600ad(0x130)],'gatewayBreakdown':_0x464c46};})),_0x59b4f4=_0x9f3394[_0x3845ba(0x17a)]((_0x1ac7b8,_0x5c2f0b)=>_0x1ac7b8+_0x5c2f0b['balance'],0x0),_0x4eb293=_0x59b4f4;return console['log'](_0x3845ba(0x160)+_0x39fe58+_0x3845ba(0x105)+Math[_0x3845ba(0x163)](_0x4eb293*0x64)/0x64+_0x3845ba(0x145)),{'merchants':_0x3608d9,'pagination':{'page':_0x79705f,'limit':_0x306284,'total':_0x39fe58,'totalPages':Math['ceil'](_0x39fe58/_0x306284)},'summary':{'totalMerchants':_0x39fe58,'totalAmountUSDT':Math[_0x3845ba(0x163)](_0x59b4f4*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3845ba(0x163)](_0x4eb293*0x64)/0x64}};}async['createPayout'](_0x45a28c){const _0x4899e7=a35_0x2103e9,{shopId:_0x3c3118,amount:_0x15808e,network:_0x31a61d,notes:_0x165546,periodFrom:_0x10f033,periodTo:_0x4b2048}=_0x45a28c,_0x89aa60=await database_1[_0x4899e7(0x188)][_0x4899e7(0xce)](async _0x51e4c7=>{const _0x54c1d5=_0x4899e7,_0xeb3e21=await _0x51e4c7[_0x54c1d5(0x14f)]['findUnique']({'where':{'id':_0x3c3118},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xeb3e21)throw new Error(_0x54c1d5(0x194));console['log'](_0x54c1d5(0x19f)+_0xeb3e21['username']+':'),console[_0x54c1d5(0x174)](_0x54c1d5(0x19e)+_0xeb3e21[_0x54c1d5(0x154)][_0x54c1d5(0x131)](0x6)+'\x20USDT'),console[_0x54c1d5(0x174)](_0x54c1d5(0xcb)+_0x15808e[_0x54c1d5(0x131)](0x6)+_0x54c1d5(0x144)),console[_0x54c1d5(0x174)](_0x54c1d5(0x18f)+_0xeb3e21[_0x54c1d5(0x17e)][_0x54c1d5(0x131)](0x6)+_0x54c1d5(0x144));if(_0xeb3e21[_0x54c1d5(0x154)]<_0x15808e)throw new Error(_0x54c1d5(0xfc)+_0xeb3e21[_0x54c1d5(0x154)][_0x54c1d5(0x131)](0x6)+_0x54c1d5(0x19c)+_0x15808e[_0x54c1d5(0x131)](0x6)+_0x54c1d5(0x144));const _0x37972f=await _0x51e4c7[_0x54c1d5(0x116)]['create']({'data':{'shopId':_0x3c3118,'amount':_0x15808e,'network':_0x31a61d,'status':_0x54c1d5(0x148),'notes':_0x165546,'periodFrom':_0x10f033?new Date(_0x10f033):null,'periodTo':_0x4b2048?new Date(_0x4b2048):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x33329a=_0xeb3e21[_0x54c1d5(0x154)]-_0x15808e,_0x33041e=_0xeb3e21['totalPaidOut']+_0x15808e;return await _0x51e4c7['shop']['update']({'where':{'id':_0x3c3118},'data':{'balance':_0x33329a,'totalPaidOut':_0x33041e}}),console['log'](_0x54c1d5(0x123)+_0xeb3e21[_0x54c1d5(0x16d)]+_0x54c1d5(0x133)),console['log']('\x20\x20\x20Balance:\x20'+_0xeb3e21[_0x54c1d5(0x154)][_0x54c1d5(0x131)](0x6)+'\x20->\x20'+_0x33329a['toFixed'](0x6)+_0x54c1d5(0xdf)+_0x15808e['toFixed'](0x6)+')'),console[_0x54c1d5(0x174)](_0x54c1d5(0x11d)+_0xeb3e21[_0x54c1d5(0x17e)]['toFixed'](0x6)+'\x20->\x20'+_0x33041e['toFixed'](0x6)+_0x54c1d5(0xf8)+_0x15808e[_0x54c1d5(0x131)](0x6)+')'),{'payout':_0x37972f,'shop':_0xeb3e21};});return console[_0x4899e7(0x174)](_0x4899e7(0x15e)+_0x89aa60[_0x4899e7(0x116)]['id']+_0x4899e7(0x12c)+_0x89aa60[_0x4899e7(0x14f)]['username']+'\x20('+_0x15808e+_0x4899e7(0x198)),{'id':_0x89aa60[_0x4899e7(0x116)]['id'],'shopId':_0x89aa60['payout'][_0x4899e7(0x175)],'shopName':_0x89aa60['shop']['name'],'shopUsername':_0x89aa60[_0x4899e7(0x14f)][_0x4899e7(0x16d)],'amount':_0x89aa60[_0x4899e7(0x116)][_0x4899e7(0xe4)],'network':_0x89aa60['payout'][_0x4899e7(0xf1)],'status':_0x89aa60[_0x4899e7(0x116)][_0x4899e7(0x142)],'txid':_0x89aa60[_0x4899e7(0x116)][_0x4899e7(0x12e)],'notes':_0x89aa60['payout'][_0x4899e7(0xde)],'periodFrom':_0x89aa60[_0x4899e7(0x116)]['periodFrom'],'periodTo':_0x89aa60[_0x4899e7(0x116)][_0x4899e7(0xe3)],'createdAt':_0x89aa60['payout'][_0x4899e7(0x130)],'paidAt':_0x89aa60[_0x4899e7(0x116)]['paidAt']};}async[a35_0x2103e9(0x159)](_0x43ebb6){const _0x5ad601=a35_0x2103e9,{page:_0x56f36e,limit:_0x351777,shopId:_0x438064,network:_0x1b2d68,dateFrom:_0x5e2319,dateTo:_0x504419,search:_0xb0cc5c}=_0x43ebb6,_0x22e24a=(_0x56f36e-0x1)*_0x351777,_0x353f28={};_0x438064&&(_0x353f28[_0x5ad601(0x175)]=_0x438064);_0x1b2d68&&(_0x353f28[_0x5ad601(0xf1)]=_0x1b2d68);(_0x5e2319||_0x504419)&&(_0x353f28[_0x5ad601(0x130)]={},_0x5e2319&&(_0x353f28['createdAt']['gte']=new Date(_0x5e2319)),_0x504419&&(_0x353f28[_0x5ad601(0x130)][_0x5ad601(0xe2)]=new Date(_0x504419)));_0xb0cc5c&&(_0x353f28['OR']=[{'shop':{'name':{'contains':_0xb0cc5c,'mode':_0x5ad601(0x12b)}}},{'shop':{'username':{'contains':_0xb0cc5c,'mode':_0x5ad601(0x12b)}}},{'notes':{'contains':_0xb0cc5c,'mode':_0x5ad601(0x12b)}}]);const [_0x919ff5,_0x31aab8]=await Promise[_0x5ad601(0xf9)]([database_1['default'][_0x5ad601(0x116)][_0x5ad601(0x15c)]({'where':_0x353f28,'skip':_0x22e24a,'take':_0x351777,'orderBy':{'createdAt':_0x5ad601(0x101)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5ad601(0x188)][_0x5ad601(0x116)][_0x5ad601(0x10a)]({'where':_0x353f28})]);return{'payouts':_0x919ff5[_0x5ad601(0x14a)](_0x138ab9=>({'id':_0x138ab9['id'],'shopId':_0x138ab9[_0x5ad601(0x175)],'shopName':_0x138ab9[_0x5ad601(0x14f)]['name'],'shopUsername':_0x138ab9[_0x5ad601(0x14f)][_0x5ad601(0x16d)],'amount':_0x138ab9[_0x5ad601(0xe4)],'network':_0x138ab9[_0x5ad601(0xf1)],'status':_0x138ab9[_0x5ad601(0x142)],'txid':_0x138ab9[_0x5ad601(0x12e)],'notes':_0x138ab9[_0x5ad601(0xde)],'periodFrom':_0x138ab9[_0x5ad601(0xff)],'periodTo':_0x138ab9['periodTo'],'createdAt':_0x138ab9[_0x5ad601(0x130)],'paidAt':_0x138ab9[_0x5ad601(0x187)]})),'pagination':{'page':_0x56f36e,'limit':_0x351777,'total':_0x31aab8,'totalPages':Math[_0x5ad601(0x110)](_0x31aab8/_0x351777)}};}async[a35_0x2103e9(0x19a)](_0x34d82b){const _0x3f86af=a35_0x2103e9,_0x213f11=await database_1['default'][_0x3f86af(0x116)][_0x3f86af(0x10e)]({'where':{'id':_0x34d82b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x213f11)return null;return{'id':_0x213f11['id'],'shopId':_0x213f11[_0x3f86af(0x175)],'shopName':_0x213f11[_0x3f86af(0x14f)][_0x3f86af(0xea)],'shopUsername':_0x213f11['shop']['username'],'amount':_0x213f11[_0x3f86af(0xe4)],'network':_0x213f11['network'],'status':_0x213f11[_0x3f86af(0x142)],'txid':_0x213f11[_0x3f86af(0x12e)],'notes':_0x213f11[_0x3f86af(0xde)],'periodFrom':_0x213f11[_0x3f86af(0xff)],'periodTo':_0x213f11[_0x3f86af(0xe3)],'createdAt':_0x213f11[_0x3f86af(0x130)],'paidAt':_0x213f11[_0x3f86af(0x187)]};}async[a35_0x2103e9(0xd5)](_0x324720){const _0x24f95d=a35_0x2103e9;await database_1[_0x24f95d(0x188)]['payout'][_0x24f95d(0x19d)]({'where':{'id':_0x324720}});}async[a35_0x2103e9(0x117)](_0x160f9d){const _0x8903a6=a35_0x2103e9,{page:_0x80878b,limit:_0x364ed9,status:_0x48b619,gateway:_0x417ac4,shopId:_0x414e30,dateFrom:_0xe13e1b,dateTo:_0x4584b2,search:_0x56a9b2}=_0x160f9d,_0x450a02=(_0x80878b-0x1)*_0x364ed9,_0x252aeb={};_0x48b619&&(_0x252aeb['status']=_0x48b619[_0x8903a6(0x155)]());_0x417ac4&&(_0x252aeb[_0x8903a6(0x18c)]=_0x417ac4[_0x8903a6(0x13a)]());_0x252aeb['gateway']=_0x252aeb[_0x8903a6(0x18c)]?_0x252aeb[_0x8903a6(0x18c)]:{'not':_0x8903a6(0x158)};if(typeof _0x252aeb['gateway']===_0x8903a6(0x12d)&&_0x252aeb[_0x8903a6(0x18c)]!=='test_gateway'){}else{if(typeof _0x252aeb[_0x8903a6(0x18c)]===_0x8903a6(0x12d)&&_0x252aeb['gateway']===_0x8903a6(0x158)){}else _0x252aeb[_0x8903a6(0x18c)]={'not':_0x8903a6(0x158)};}_0x414e30&&(_0x252aeb['shopId']=_0x414e30);(_0xe13e1b||_0x4584b2)&&(_0x252aeb[_0x8903a6(0x130)]={},_0xe13e1b&&(_0x252aeb[_0x8903a6(0x130)]['gte']=new Date(_0xe13e1b)),_0x4584b2&&(_0x252aeb[_0x8903a6(0x130)]['lte']=new Date(_0x4584b2)));_0x56a9b2&&(_0x252aeb['OR']=[{'orderId':{'contains':_0x56a9b2,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x56a9b2,'mode':'insensitive'}},{'customerEmail':{'contains':_0x56a9b2,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x56a9b2,'mode':_0x8903a6(0x12b)}}},{'shop':{'username':{'contains':_0x56a9b2,'mode':_0x8903a6(0x12b)}}}]);const [_0x408f20,_0x47547e]=await Promise[_0x8903a6(0xf9)]([database_1['default']['payment']['findMany']({'where':_0x252aeb,'skip':_0x450a02,'take':_0x364ed9,'orderBy':{'createdAt':_0x8903a6(0x101)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x8903a6(0x188)][_0x8903a6(0x128)][_0x8903a6(0x10a)]({'where':_0x252aeb})]);return{'payments':_0x408f20[_0x8903a6(0x14a)](_0x3d763a=>({'id':_0x3d763a['id'],'shopId':_0x3d763a[_0x8903a6(0x175)],'gateway':_0x3d763a[_0x8903a6(0x18c)],'amount':_0x3d763a[_0x8903a6(0xe4)],'currency':_0x3d763a[_0x8903a6(0x112)],'status':_0x3d763a[_0x8903a6(0x142)],'orderId':_0x3d763a[_0x8903a6(0x107)],'gatewayOrderId':_0x3d763a[_0x8903a6(0x178)],'customerEmail':_0x3d763a[_0x8903a6(0x12a)],'customerName':_0x3d763a['customerName'],'customerCountry':_0x3d763a['customerCountry'],'customerIp':_0x3d763a[_0x8903a6(0x13e)],'customerUa':_0x3d763a['customerUa'],'failureMessage':_0x3d763a[_0x8903a6(0x161)],'createdAt':_0x3d763a[_0x8903a6(0x130)],'updatedAt':_0x3d763a['updatedAt'],'shop':_0x3d763a[_0x8903a6(0x14f)]})),'pagination':{'page':_0x80878b,'limit':_0x364ed9,'total':_0x47547e,'totalPages':Math[_0x8903a6(0x110)](_0x47547e/_0x364ed9)}};}async[a35_0x2103e9(0xeb)](_0x55c904){const _0x42cfe9=a35_0x2103e9,_0x529054=await database_1[_0x42cfe9(0x188)][_0x42cfe9(0x128)][_0x42cfe9(0x10e)]({'where':{'id':_0x55c904},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x529054)return null;return{'id':_0x529054['id'],'shopId':_0x529054[_0x42cfe9(0x175)],'gateway':_0x529054['gateway'],'amount':_0x529054[_0x42cfe9(0xe4)],'currency':_0x529054[_0x42cfe9(0x112)],'status':_0x529054[_0x42cfe9(0x142)],'orderId':_0x529054[_0x42cfe9(0x107)],'gatewayOrderId':_0x529054[_0x42cfe9(0x178)],'customerEmail':_0x529054['customerEmail'],'customerName':_0x529054[_0x42cfe9(0x168)],'customerCountry':_0x529054[_0x42cfe9(0x127)],'customerIp':_0x529054[_0x42cfe9(0x13e)],'customerUa':_0x529054[_0x42cfe9(0x118)],'failureMessage':_0x529054[_0x42cfe9(0x161)],'externalPaymentUrl':_0x529054['externalPaymentUrl'],'successUrl':_0x529054[_0x42cfe9(0x17d)],'failUrl':_0x529054[_0x42cfe9(0x140)],'pendingUrl':_0x529054[_0x42cfe9(0x191)],'whiteUrl':_0x529054[_0x42cfe9(0x177)],'createdAt':_0x529054[_0x42cfe9(0x130)],'updatedAt':_0x529054[_0x42cfe9(0x176)],'shop':_0x529054['shop']};}async['updatePaymentStatus'](_0x1d6721,_0x284866,_0x1e7133,_0x3d4461){const _0x5601be=a35_0x2103e9,_0x1b13f1=await database_1[_0x5601be(0x188)][_0x5601be(0xce)](async _0x4536e3=>{const _0x404ad4=_0x5601be,_0x1a9ad8=await _0x4536e3['payment'][_0x404ad4(0x10e)]({'where':{'id':_0x1d6721},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1a9ad8)throw new Error(_0x404ad4(0x115));const _0x572c90=_0x1a9ad8[_0x404ad4(0x142)],_0x19db5c=_0x284866[_0x404ad4(0x155)]();console[_0x404ad4(0x174)](_0x404ad4(0x150)+_0x1d6721+_0x404ad4(0x104)+_0x572c90+_0x404ad4(0x179)+_0x19db5c),console[_0x404ad4(0x174)](_0x404ad4(0x11e)+_0x1a9ad8[_0x404ad4(0x14f)][_0x404ad4(0x154)]+'\x20USDT');const _0x1ca600={'status':_0x19db5c,'updatedAt':new Date(),'statusChangedBy':_0x404ad4(0xdc),'statusChangedAt':new Date()};_0x1e7133&&(_0x1ca600[_0x404ad4(0xdd)]=_0x1e7133);_0x19db5c===_0x404ad4(0x16f)&&_0x3d4461&&(_0x1ca600[_0x404ad4(0x13f)]=_0x3d4461);let _0x4b1bdb=0x0,_0x350a6d=_0x1a9ad8[_0x404ad4(0x14f)]['balance'];if(_0x19db5c===_0x404ad4(0xd4)&&_0x572c90!==_0x404ad4(0xd4)){_0x1ca600[_0x404ad4(0x187)]=new Date();const _0x2d8d5d=await currencyService_1[_0x404ad4(0x14e)][_0x404ad4(0x10c)](_0x1a9ad8['amount'],_0x1a9ad8[_0x404ad4(0x112)]);_0x1ca600[_0x404ad4(0x197)]=_0x2d8d5d,_0x4b1bdb=_0x2d8d5d,_0x350a6d+=_0x2d8d5d,console['log'](_0x404ad4(0x132)+_0x1d6721+_0x404ad4(0xf2)+_0x2d8d5d[_0x404ad4(0x131)](0x6)+_0x404ad4(0x14b));}else _0x572c90==='PAID'&&_0x19db5c!==_0x404ad4(0xd4)&&(_0x1a9ad8[_0x404ad4(0x197)]&&(_0x4b1bdb=-_0x1a9ad8[_0x404ad4(0x197)],_0x350a6d-=_0x1a9ad8[_0x404ad4(0x197)],_0x1ca600[_0x404ad4(0x197)]=null,console[_0x404ad4(0x174)](_0x404ad4(0x132)+_0x1d6721+'\x20no\x20longer\x20PAID:\x20-'+_0x1a9ad8[_0x404ad4(0x197)][_0x404ad4(0x131)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x19db5c===_0x404ad4(0x16f)){if(_0x572c90===_0x404ad4(0xd4)&&_0x1a9ad8[_0x404ad4(0x197)]){}_0x3d4461&&_0x3d4461>0x0&&(_0x4b1bdb-=_0x3d4461,_0x350a6d-=_0x3d4461,console[_0x404ad4(0x174)]('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x3d4461[_0x404ad4(0x131)](0x6)+_0x404ad4(0x166)));}_0x19db5c==='REFUND'&&_0x572c90===_0x404ad4(0xd4)&&console[_0x404ad4(0x174)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x48017b=await _0x4536e3[_0x404ad4(0x128)][_0x404ad4(0x18e)]({'where':{'id':_0x1d6721},'data':_0x1ca600,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4b1bdb!==0x0&&(await _0x4536e3[_0x404ad4(0x14f)][_0x404ad4(0x18e)]({'where':{'id':_0x1a9ad8['shopId']},'data':{'balance':_0x350a6d}}),console['log'](_0x404ad4(0x123)+_0x1a9ad8[_0x404ad4(0x175)]+_0x404ad4(0x18a)+_0x1a9ad8[_0x404ad4(0x14f)]['balance'][_0x404ad4(0x131)](0x6)+_0x404ad4(0x179)+_0x350a6d[_0x404ad4(0x131)](0x6)+_0x404ad4(0xd3)+(_0x4b1bdb>0x0?'+':'')+_0x4b1bdb[_0x404ad4(0x131)](0x6)+')')),_0x48017b;});return{'id':_0x1b13f1['id'],'shopId':_0x1b13f1[_0x5601be(0x175)],'gateway':_0x1b13f1[_0x5601be(0x18c)],'amount':_0x1b13f1[_0x5601be(0xe4)],'currency':_0x1b13f1[_0x5601be(0x112)],'status':_0x1b13f1[_0x5601be(0x142)],'orderId':_0x1b13f1['orderId'],'gatewayOrderId':_0x1b13f1[_0x5601be(0x178)],'customerEmail':_0x1b13f1[_0x5601be(0x12a)],'customerName':_0x1b13f1[_0x5601be(0x168)],'customerCountry':_0x1b13f1[_0x5601be(0x127)],'customerIp':_0x1b13f1[_0x5601be(0x13e)],'customerUa':_0x1b13f1[_0x5601be(0x118)],'failureMessage':_0x1b13f1[_0x5601be(0x161)],'adminNotes':_0x1b13f1['adminNotes'],'chargebackAmount':_0x1b13f1[_0x5601be(0x13f)],'statusChangedBy':_0x1b13f1['statusChangedBy'],'statusChangedAt':_0x1b13f1[_0x5601be(0xe7)],'createdAt':_0x1b13f1[_0x5601be(0x130)],'updatedAt':_0x1b13f1[_0x5601be(0x176)],'shop':_0x1b13f1[_0x5601be(0x14f)]};}async[a35_0x2103e9(0x15b)](_0x4ca2d7,_0x8120fc){const _0x34240d=a35_0x2103e9,_0xe2bf6b={..._0x8120fc};_0x8120fc[_0x34240d(0x129)]&&(_0xe2bf6b[_0x34240d(0x129)]=await bcryptjs_1[_0x34240d(0x188)]['hash'](_0x8120fc[_0x34240d(0x129)],0xc));_0x8120fc[_0x34240d(0xd6)]&&(_0xe2bf6b[_0x34240d(0xea)]=_0x8120fc[_0x34240d(0xd6)],delete _0xe2bf6b[_0x34240d(0xd6)]);_0x8120fc[_0x34240d(0x126)]&&(_0xe2bf6b[_0x34240d(0xcd)]=_0x8120fc[_0x34240d(0x126)],delete _0xe2bf6b['telegramId']);_0x8120fc['merchantUrl']&&(_0xe2bf6b['shopUrl']=_0x8120fc[_0x34240d(0x136)],delete _0xe2bf6b['merchantUrl']);_0x8120fc[_0x34240d(0xe9)]&&(_0xe2bf6b['paymentGateways']=JSON[_0x34240d(0xf0)](_0x8120fc[_0x34240d(0xe9)]),delete _0xe2bf6b[_0x34240d(0xe9)]);_0x8120fc[_0x34240d(0xf6)]&&(_0xe2bf6b[_0x34240d(0xf6)]=JSON[_0x34240d(0xf0)](_0x8120fc['gatewaySettings']),delete _0xe2bf6b['gatewaySettings']);_0x8120fc[_0x34240d(0x149)]&&(_0x8120fc[_0x34240d(0x149)][_0x34240d(0xcc)]!==undefined&&(_0xe2bf6b[_0x34240d(0xcc)]=_0x8120fc[_0x34240d(0x149)][_0x34240d(0xcc)]||null),_0x8120fc[_0x34240d(0x149)][_0x34240d(0x16a)]!==undefined&&(_0xe2bf6b[_0x34240d(0x16a)]=_0x8120fc[_0x34240d(0x149)][_0x34240d(0x16a)]||null),_0x8120fc[_0x34240d(0x149)][_0x34240d(0x15a)]!==undefined&&(_0xe2bf6b[_0x34240d(0x15a)]=_0x8120fc['wallets'][_0x34240d(0x15a)]||null),_0x8120fc[_0x34240d(0x149)][_0x34240d(0x180)]!==undefined&&(_0xe2bf6b[_0x34240d(0x180)]=_0x8120fc[_0x34240d(0x149)][_0x34240d(0x180)]||null),delete _0xe2bf6b[_0x34240d(0x149)]);const _0x43737a=await database_1[_0x34240d(0x188)]['shop'][_0x34240d(0x18e)]({'where':{'id':_0x4ca2d7},'data':_0xe2bf6b,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x43737a['id'],'fullName':_0x43737a[_0x34240d(0xea)],'username':_0x43737a[_0x34240d(0x16d)],'telegramId':_0x43737a['telegram'],'merchantUrl':_0x43737a[_0x34240d(0xe1)],'gateways':_0x43737a[_0x34240d(0x182)]?JSON[_0x34240d(0x165)](_0x43737a[_0x34240d(0x182)]):null,'gatewaySettings':_0x43737a['gatewaySettings']?JSON[_0x34240d(0x165)](_0x43737a[_0x34240d(0xf6)]):null,'publicKey':_0x43737a[_0x34240d(0xf3)],'wallets':{'usdtPolygonWallet':_0x43737a[_0x34240d(0xcc)],'usdtTrcWallet':_0x43737a['usdtTrcWallet'],'usdtErcWallet':_0x43737a[_0x34240d(0x15a)],'usdcPolygonWallet':_0x43737a['usdcPolygonWallet']},'status':_0x43737a[_0x34240d(0x142)],'createdAt':_0x43737a[_0x34240d(0x130)]};}async[a35_0x2103e9(0xf7)](_0x2a619b){const _0x124ae5=a35_0x2103e9,_0x2a01c7=await database_1['default'][_0x124ae5(0x14f)][_0x124ae5(0x18e)]({'where':{'id':_0x2a619b},'data':{'status':_0x124ae5(0x106)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2a01c7['id'],'fullName':_0x2a01c7['name'],'username':_0x2a01c7[_0x124ae5(0x16d)],'telegramId':_0x2a01c7[_0x124ae5(0xcd)],'merchantUrl':_0x2a01c7['shopUrl'],'gateways':_0x2a01c7[_0x124ae5(0x182)]?JSON[_0x124ae5(0x165)](_0x2a01c7['paymentGateways']):null,'gatewaySettings':_0x2a01c7['gatewaySettings']?JSON[_0x124ae5(0x165)](_0x2a01c7['gatewaySettings']):null,'publicKey':_0x2a01c7[_0x124ae5(0xf3)],'wallets':{'usdtPolygonWallet':_0x2a01c7[_0x124ae5(0xcc)],'usdtTrcWallet':_0x2a01c7[_0x124ae5(0x16a)],'usdtErcWallet':_0x2a01c7[_0x124ae5(0x15a)],'usdcPolygonWallet':_0x2a01c7['usdcPolygonWallet']},'status':_0x2a01c7[_0x124ae5(0x142)],'createdAt':_0x2a01c7[_0x124ae5(0x130)]};}async[a35_0x2103e9(0x125)](_0x565647){const _0x2bbe16=a35_0x2103e9,_0x1d764d=await database_1[_0x2bbe16(0x188)][_0x2bbe16(0x14f)][_0x2bbe16(0x18e)]({'where':{'id':_0x565647},'data':{'status':_0x2bbe16(0xec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1d764d['id'],'fullName':_0x1d764d['name'],'username':_0x1d764d[_0x2bbe16(0x16d)],'telegramId':_0x1d764d['telegram'],'merchantUrl':_0x1d764d['shopUrl'],'gateways':_0x1d764d[_0x2bbe16(0x182)]?JSON[_0x2bbe16(0x165)](_0x1d764d[_0x2bbe16(0x182)]):null,'gatewaySettings':_0x1d764d['gatewaySettings']?JSON[_0x2bbe16(0x165)](_0x1d764d[_0x2bbe16(0xf6)]):null,'publicKey':_0x1d764d['publicKey'],'wallets':{'usdtPolygonWallet':_0x1d764d[_0x2bbe16(0xcc)],'usdtTrcWallet':_0x1d764d[_0x2bbe16(0x16a)],'usdtErcWallet':_0x1d764d[_0x2bbe16(0x15a)],'usdcPolygonWallet':_0x1d764d[_0x2bbe16(0x180)]},'status':_0x1d764d[_0x2bbe16(0x142)],'createdAt':_0x1d764d[_0x2bbe16(0x130)]};}async[a35_0x2103e9(0x193)](_0x875612){const _0x53efcc=a35_0x2103e9,{page:_0x2b0556,limit:_0x24ec63,status:_0x458334}=_0x875612,_0x3de0c4=(_0x2b0556-0x1)*_0x24ec63,_0x548c1f={};_0x458334&&(_0x548c1f[_0x53efcc(0x142)]=_0x458334['toUpperCase']());const [_0xa387a1,_0x166ce5]=await Promise['all']([database_1[_0x53efcc(0x188)][_0x53efcc(0x14f)][_0x53efcc(0x15c)]({'where':_0x548c1f,'skip':_0x3de0c4,'take':_0x24ec63,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x53efcc(0x188)]['shop'][_0x53efcc(0x10a)]({'where':_0x548c1f})]);return{'users':_0xa387a1[_0x53efcc(0x14a)](_0x3b8338=>({'id':_0x3b8338['id'],'fullName':_0x3b8338['name'],'username':_0x3b8338[_0x53efcc(0x16d)],'telegramId':_0x3b8338[_0x53efcc(0xcd)],'merchantUrl':_0x3b8338[_0x53efcc(0xe1)],'gateways':_0x3b8338[_0x53efcc(0x182)]?JSON[_0x53efcc(0x165)](_0x3b8338[_0x53efcc(0x182)]):null,'gatewaySettings':_0x3b8338['gatewaySettings']?JSON[_0x53efcc(0x165)](_0x3b8338[_0x53efcc(0xf6)]):null,'publicKey':_0x3b8338[_0x53efcc(0xf3)],'wallets':{'usdtPolygonWallet':_0x3b8338[_0x53efcc(0xcc)],'usdtTrcWallet':_0x3b8338[_0x53efcc(0x16a)],'usdtErcWallet':_0x3b8338[_0x53efcc(0x15a)],'usdcPolygonWallet':_0x3b8338[_0x53efcc(0x180)]},'status':_0x3b8338[_0x53efcc(0x142)],'createdAt':_0x3b8338[_0x53efcc(0x130)]})),'pagination':{'page':_0x2b0556,'limit':_0x24ec63,'total':_0x166ce5,'totalPages':Math[_0x53efcc(0x110)](_0x166ce5/_0x24ec63)}};}async['getUserById'](_0x5e1e29){const _0x47ca2d=a35_0x2103e9,_0x3a501e=await database_1['default'][_0x47ca2d(0x14f)][_0x47ca2d(0x10e)]({'where':{'id':_0x5e1e29},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3a501e)return null;return{'id':_0x3a501e['id'],'fullName':_0x3a501e[_0x47ca2d(0xea)],'username':_0x3a501e[_0x47ca2d(0x16d)],'telegramId':_0x3a501e[_0x47ca2d(0xcd)],'merchantUrl':_0x3a501e['shopUrl'],'gateways':_0x3a501e[_0x47ca2d(0x182)]?JSON[_0x47ca2d(0x165)](_0x3a501e[_0x47ca2d(0x182)]):null,'gatewaySettings':_0x3a501e[_0x47ca2d(0xf6)]?JSON[_0x47ca2d(0x165)](_0x3a501e[_0x47ca2d(0xf6)]):null,'publicKey':_0x3a501e[_0x47ca2d(0xf3)],'wallets':{'usdtPolygonWallet':_0x3a501e[_0x47ca2d(0xcc)],'usdtTrcWallet':_0x3a501e[_0x47ca2d(0x16a)],'usdtErcWallet':_0x3a501e[_0x47ca2d(0x15a)],'usdcPolygonWallet':_0x3a501e[_0x47ca2d(0x180)]},'status':_0x3a501e['status'],'createdAt':_0x3a501e[_0x47ca2d(0x130)]};}async[a35_0x2103e9(0x1a0)](_0x5d98b2){const _0x52e140=a35_0x2103e9,{fullName:_0x2ee628,username:_0x1ec496,password:_0x1cbb79,telegramId:_0xbbb5f2,merchantUrl:_0xb2af9d,gateways:_0x181850,gatewaySettings:_0x53c8e0,wallets:_0x15ee23}=_0x5d98b2,_0x3fd9c1=await database_1[_0x52e140(0x188)][_0x52e140(0x14f)][_0x52e140(0x10e)]({'where':{'username':_0x1ec496}});if(_0x3fd9c1)throw new Error('Username\x20already\x20exists');if(_0xbbb5f2){const _0x580895=await database_1[_0x52e140(0x188)]['shop']['findUnique']({'where':{'telegram':_0xbbb5f2}});if(_0x580895)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x108393=await bcryptjs_1['default'][_0x52e140(0xe5)](_0x1cbb79,0xc),_0x271582=_0x52e140(0xd0)+crypto_1['default']['randomBytes'](0x20)['toString'](_0x52e140(0x157)),_0x3abca3='sk_'+crypto_1[_0x52e140(0x188)][_0x52e140(0x10b)](0x20)[_0x52e140(0x13b)]('hex'),_0x5e5411=await database_1[_0x52e140(0x188)][_0x52e140(0x14f)]['create']({'data':{'name':_0x2ee628,'username':_0x1ec496,'password':_0x108393,'telegram':_0xbbb5f2,'shopUrl':_0xb2af9d,'paymentGateways':_0x181850?JSON['stringify'](_0x181850):null,'gatewaySettings':_0x53c8e0?JSON['stringify'](_0x53c8e0):null,'usdtPolygonWallet':_0x15ee23?.[_0x52e140(0xcc)]||null,'usdtTrcWallet':_0x15ee23?.[_0x52e140(0x16a)]||null,'usdtErcWallet':_0x15ee23?.[_0x52e140(0x15a)]||null,'usdcPolygonWallet':_0x15ee23?.[_0x52e140(0x180)]||null,'publicKey':_0x271582,'secretKey':_0x3abca3,'status':_0x52e140(0xec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5e5411['id'],'fullName':_0x5e5411[_0x52e140(0xea)],'username':_0x5e5411[_0x52e140(0x16d)],'telegramId':_0x5e5411[_0x52e140(0xcd)],'merchantUrl':_0x5e5411[_0x52e140(0xe1)],'gateways':_0x5e5411[_0x52e140(0x182)]?JSON[_0x52e140(0x165)](_0x5e5411['paymentGateways']):null,'gatewaySettings':_0x5e5411[_0x52e140(0xf6)]?JSON[_0x52e140(0x165)](_0x5e5411[_0x52e140(0xf6)]):null,'publicKey':_0x5e5411[_0x52e140(0xf3)],'wallets':{'usdtPolygonWallet':_0x5e5411[_0x52e140(0xcc)],'usdtTrcWallet':_0x5e5411[_0x52e140(0x16a)],'usdtErcWallet':_0x5e5411[_0x52e140(0x15a)],'usdcPolygonWallet':_0x5e5411[_0x52e140(0x180)]},'status':_0x5e5411[_0x52e140(0x142)],'createdAt':_0x5e5411[_0x52e140(0x130)]};}async['deleteUser'](_0x22f497){const _0x40802a=a35_0x2103e9;await database_1[_0x40802a(0x188)]['shop'][_0x40802a(0x19d)]({'where':{'id':_0x22f497}});}}exports['AdminService']=AdminService;