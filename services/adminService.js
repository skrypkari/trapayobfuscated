'use strict';const a35_0x3d81be=a35_0x408b;(function(_0x42d522,_0x1abfcc){const _0x123243=a35_0x408b,_0x18938d=_0x42d522();while(!![]){try{const _0x38f3a3=parseInt(_0x123243(0x146))/0x1*(parseInt(_0x123243(0x1fa))/0x2)+parseInt(_0x123243(0x112))/0x3*(-parseInt(_0x123243(0x1c7))/0x4)+parseInt(_0x123243(0x1ea))/0x5*(parseInt(_0x123243(0x1a7))/0x6)+parseInt(_0x123243(0x137))/0x7+-parseInt(_0x123243(0x122))/0x8+-parseInt(_0x123243(0x1da))/0x9+parseInt(_0x123243(0x189))/0xa;if(_0x38f3a3===_0x1abfcc)break;else _0x18938d['push'](_0x18938d['shift']());}catch(_0x146030){_0x18938d['push'](_0x18938d['shift']());}}}(a35_0x4e56,0x2fefc));function a35_0x4e56(){const _0x5aa53c=['gateways','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','turnover','telegram','customerUa','create','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20USDT','\x20\x20\x20üåê\x20IP:\x20','CHARGEBACK','asc','month','\x20for\x20shop\x20','getUserById','üîß\x20Gateway\x20settings\x20JSON\x20string:','pendingUrl','gte','updatedAt','currencyService','averageCheckUSDT','getGatewayIdByName','forEach','getGatewayDisplayName','all','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','set','createPayout','üí∞\x20Current\x20shop\x20balance:\x20','lte','CoinToPay','üí∞\x20[PAYOUT]\x20Merchant\x20','totalTurnover','dateFrom','paymentsCount','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','totalPayments','desc','awaitingPayout','\x20\x20\x20üìÖ\x20This\x20month:\x20','4151510BZJrss','delete','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','orderId','\x20->\x20','AdminService','Telegram\x20username\x20already\x20exists','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','dateTo','Username\x20already\x20exists','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','ceil','NONEXISTENT_GATEWAY_FILTER','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','periodFrom','failureMessage','üí∞\x20Found\x20','__esModule','\x20\x20\x20Balance:\x20','update','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Added\x20to\x20balance:\x20+','90d','publicKey','averageCommissionRate','getPayoutStats','hex','telegramId','gatewayEarnings','hash','38796pMHWhW','getPayoutById','\x20\x20\x20üí≥\x20Total\x20payments:\x20','convertToUSDT','‚ö†Ô∏è\x20Gateway\x20\x27','getAllPayments','0000','txid','entries','getGatewayNameById','toFixed','length','shop','fullName','paymentGateways','successUrl','\x20no\x20longer\x20PAID:','createdAt','_sum','\x20in\x20','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','\x20order','deletePayout','groupBy','balance','üìä\x20Payout\x20statistics\x20calculated:','\x20merchants','default','updatePaymentStatus','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','revenue','üí∞\x20Shop\x20','556uGfNdx','summary','\x20balance\x20updated:\x20','\x20\x20\x20üåç\x20Country:\x20','username','shopId','toUpperCase','gatewaySettings','PAID','findUnique','klyme_de','pk_','wallets','randomBytes','amountAfterCommissionUSDT','usdtTrcWallet','push','\x20\x20\x20üíµ\x20Available\x20balance:\x20','customerEmail','1987641IePfaG','usdtPolygonWallet','paidAt','gateway','üîÑ\x20Gateway\x20mapping:','period','\x20USDT\x20(','custom','insensitive','toLowerCase','bcryptjs','notes','stringify','Test\x20Gateway','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','totalPaidOut','60wvGvVa','\x20\x20\x20Current\x20balance:\x20','sk_','üí∞\x20Creating\x20payout\x20for\x20shop\x20','merchantEarningsUSDT','paidOutUSDT','activateUser','turnoverUSDT','Open\x20Banking\x202','values','currency','Plisio','\x27\x20not\x20found.\x20Available\x20gateways:\x20','totalCommissionRate','totalAmountUSDT','aggregate','2naiMGq','\x20active\x20merchants\x20for\x20selection','\x20became\x20PAID:','not\x20specified','setDate','\x20\x20\x20Merchant\x20gets:\x20','getMerchantsAwaitingPayout','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','map','üìã\x20Found\x20','‚úÖ\x20Payout\x20created:\x20','\x27\x20to\x20name\x20\x27','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','generateDailyStatistics','usdcPolygonWallet','log','üìä\x20Calculating\x20payout\x20statistics...','localeCompare','merchantEarnings','count','usdtErcWallet','cointopay','getMonth','whiteUrl','toString',':\x20commission\x20=\x20','\x20\x20\x20Merchant\x20loses:\x20','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20status:\x20','\x20USDT\x20(-','deleteUser','%\x20commission)','\x20USDT\x20(+','polygon','getGatewayInternalName','üîç\x20Using\x20gateway\x20\x27','payout','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','üìÖ\x20Period:\x20','KLYME\x20GB','\x20to\x20','__importDefault','trc20','password','getDate','thisMonth','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','payment','parse','includes','\x20USDT\x20(after\x20','name','üîÑ\x20Admin\x20updating\x20payment\x20','\x20\x20\x20üìä\x20Commission\x20difference:\x20','updateCustomerData','error','customerIp','6135OxkBRp','getPaymentById','amountUSDT','üí∞\x20Payment\x20','2020-01-01','klyme_gb','createUser','round','_count','\x27\x20->\x20name\x20\x27','\x20USDT\x20(after\x20payouts)','dailyRevenue',',\x20Commission:\x20','erc20','customerName','\x27\x20(from\x20\x27','1937256VCnNei','adminNotes','Rapyd','date','shopUrl','status','findMany','KLYME\x20EU','Error\x20processing\x20payment\x20','sort','\x20\x20\x20Gateway:\x20','not\x20set','network','\x20USDT\x20(theoretical\x20net)','\x20USDT)','üí∏\x20CHARGEBACK\x20penalty:\x20-','Noda','getAllPayouts','\x20USDT,\x20Requested:\x20','amount','getFullYear','1359365rdszVz','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','split','customerCountry','\x20payments)','periodTo','plisio','noda','\x27\x20->\x20ID\x20\x27','30d','üìä\x20Sorting\x20payments\x20by\x20','üîÑ\x20Converted\x20gateway\x20name\x20\x27','toISOString','getSystemStatistics','ACTIVE','256671HzoKZG','klyme_eu','getTime','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','test_gateway','\x20USDT\x20(with\x20commission\x20deducted)','üîß\x20Gateway\x20settings\x20before\x20saving:','crypto','COMPLETED','merchantUrl','failUrl','\x20\x20\x20Transaction\x20hash:\x20','\x20\x20\x20üìä\x20Total\x20payments:\x20','reduce','commission','\x20paid\x20payments\x20for\x20analysis','commissionUSDT','year','join','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','REFUND','totalAmountAfterCommissionUSDT','MasterCard','findFirst','Payment\x20not\x20found','polygon_usdc','chargebackAmount','totalPayout'];a35_0x4e56=function(){return _0x5aa53c;};return a35_0x4e56();}function a35_0x408b(_0x3b1f03,_0x55e8c3){const _0x4e56a8=a35_0x4e56();return a35_0x408b=function(_0x408bf2,_0x307164){_0x408bf2=_0x408bf2-0x10e;let _0x392874=_0x4e56a8[_0x408bf2];return _0x392874;},a35_0x408b(_0x3b1f03,_0x55e8c3);}var __importDefault=this&&this[a35_0x3d81be(0x223)]||function(_0x3d418e){return _0x3d418e&&_0x3d418e['__esModule']?_0x3d418e:{'default':_0x3d418e};};Object['defineProperty'](exports,a35_0x3d81be(0x19a),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x3d81be(0x1e4))),crypto_1=__importDefault(require(a35_0x3d81be(0x14d))),currencyService_1=require('./currencyService'),gateway_1=require('../types/gateway');class AdminService{async[a35_0x3d81be(0x1a2)](){const _0x4e4bf6=a35_0x3d81be;console['log'](_0x4e4bf6(0x20a));const _0x36541d=await database_1['default'][_0x4e4bf6(0x1b3)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x5f25f3=await this[_0x4e4bf6(0x200)]({'page':0x1,'limit':0x3e8}),_0x1d0bde=await database_1[_0x4e4bf6(0x1c2)][_0x4e4bf6(0x229)][_0x4e4bf6(0x20d)]({'where':{'status':'PAID','gateway':{'not':_0x4e4bf6(0x14a)}}}),_0x43ad6f=new Date(),_0x5eccdb=new Date(_0x43ad6f[_0x4e4bf6(0x136)](),_0x43ad6f[_0x4e4bf6(0x210)](),0x1),_0x3a97bd=new Date(_0x43ad6f[_0x4e4bf6(0x136)](),_0x43ad6f[_0x4e4bf6(0x210)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1f7567=await database_1[_0x4e4bf6(0x1c2)][_0x4e4bf6(0x21e)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5eccdb,'lte':_0x3a97bd},'status':'COMPLETED'}}),_0x5856a0=_0x36541d[_0x4e4bf6(0x1b9)]['totalPaidOut']||0x0,_0x57bf2d=_0x5f25f3[_0x4e4bf6(0x1c8)]['totalAmountAfterCommissionUSDT'],_0x5b489e=_0x1f7567[_0x4e4bf6(0x1b9)]['amount']||0x0,_0x20eb49={'totalPayout':Math['round'](_0x5856a0*0x64)/0x64,'awaitingPayout':Math['round'](_0x57bf2d*0x64)/0x64,'thisMonth':Math[_0x4e4bf6(0x119)](_0x5b489e*0x64)/0x64,'availableBalance':Math[_0x4e4bf6(0x119)](_0x57bf2d*0x64)/0x64,'totalPayments':_0x1d0bde};return console[_0x4e4bf6(0x209)](_0x4e4bf6(0x1c0)),console['log']('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x20eb49[_0x4e4bf6(0x161)]+_0x4e4bf6(0x19d)),console[_0x4e4bf6(0x209)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x20eb49[_0x4e4bf6(0x187)]+_0x4e4bf6(0x14b)),console[_0x4e4bf6(0x209)](_0x4e4bf6(0x1d8)+_0x20eb49['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x4e4bf6(0x209)](_0x4e4bf6(0x188)+_0x20eb49['thisMonth']+'\x20USDT'),console['log'](_0x4e4bf6(0x1a9)+_0x20eb49[_0x4e4bf6(0x185)]+'\x20PAID\x20payments'),console[_0x4e4bf6(0x209)](_0x4e4bf6(0x163)+(_0x36541d['_sum'][_0x4e4bf6(0x1bf)]||0x0)['toFixed'](0x2)+'\x20USDT\x20(without\x20commission)'),console['log'](_0x4e4bf6(0x10e)+((_0x36541d['_sum']['balance']||0x0)-_0x57bf2d)[_0x4e4bf6(0x1b1)](0x2)+_0x4e4bf6(0x169)),_0x20eb49;}async[a35_0x3d81be(0x10f)](_0x208a5b,_0x3cf396){const _0x2350b9=a35_0x3d81be;console[_0x2350b9(0x209)](_0x2350b9(0x215)+_0x208a5b+':',_0x3cf396);const _0x4dd138=await database_1[_0x2350b9(0x1c2)][_0x2350b9(0x229)][_0x2350b9(0x1d0)]({'where':{'id':_0x208a5b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4dd138)throw new Error('Payment\x20not\x20found');const _0x343f0f={};_0x3cf396[_0x2350b9(0x13a)]!==undefined&&(_0x343f0f[_0x2350b9(0x13a)]=_0x3cf396[_0x2350b9(0x13a)]||null);_0x3cf396[_0x2350b9(0x111)]!==undefined&&(_0x343f0f[_0x2350b9(0x111)]=_0x3cf396[_0x2350b9(0x111)]||null);_0x3cf396[_0x2350b9(0x166)]!==undefined&&(_0x343f0f[_0x2350b9(0x166)]=_0x3cf396[_0x2350b9(0x166)]||null);const _0xfb9239=await database_1[_0x2350b9(0x1c2)][_0x2350b9(0x229)]['update']({'where':{'id':_0x208a5b},'data':{..._0x343f0f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2350b9(0x209)](_0x2350b9(0x21f)+_0x208a5b),console[_0x2350b9(0x209)](_0x2350b9(0x1ca)+_0x4dd138['customerCountry']+_0x2350b9(0x18d)+_0xfb9239['customerCountry']),console[_0x2350b9(0x209)](_0x2350b9(0x16a)+_0x4dd138[_0x2350b9(0x111)]+_0x2350b9(0x18d)+_0xfb9239[_0x2350b9(0x111)]),console[_0x2350b9(0x209)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x4dd138[_0x2350b9(0x166)]?'set':_0x2350b9(0x12d))+'\x20->\x20'+(_0xfb9239[_0x2350b9(0x166)]?_0x2350b9(0x17b):_0x2350b9(0x12d))),_0xfb9239;}async[a35_0x3d81be(0x144)](_0x35a2ba){const _0x637446=a35_0x3d81be,_0x4235c9=new Date();let _0x1d9d30;switch(_0x35a2ba){case'7d':_0x1d9d30=new Date(_0x4235c9[_0x637446(0x148)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x637446(0x140):_0x1d9d30=new Date(_0x4235c9['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x637446(0x19f):_0x1d9d30=new Date(_0x4235c9[_0x637446(0x148)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0xe3f2bd=await database_1['default'][_0x637446(0x229)][_0x637446(0x15d)]({'where':{'gateway':{'not':_0x637446(0x14a)}},'orderBy':{'createdAt':_0x637446(0x16c)},'select':{'createdAt':!![]}});_0x1d9d30=_0xe3f2bd?_0xe3f2bd['createdAt']:new Date(_0x637446(0x116)),console['log']('üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x1d9d30[_0x637446(0x143)]());break;default:_0x1d9d30=new Date(_0x4235c9[_0x637446(0x148)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5a60be,_0x1d782f,_0x2a0904,_0x4693fe,_0x33bf0a,_0x519596,_0x202d79]=await Promise[_0x637446(0x179)]([database_1['default'][_0x637446(0x1b3)][_0x637446(0x20d)](),database_1[_0x637446(0x1c2)][_0x637446(0x1b3)][_0x637446(0x20d)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x637446(0x229)][_0x637446(0x20d)]({'where':{'createdAt':{'gte':_0x1d9d30},'gateway':{'not':'test_gateway'}}}),database_1[_0x637446(0x1c2)][_0x637446(0x229)]['count']({'where':{'status':_0x637446(0x1cf),'createdAt':{'gte':_0x1d9d30},'gateway':{'not':_0x637446(0x14a)}}}),database_1['default']['payment'][_0x637446(0x128)]({'where':{'status':_0x637446(0x1cf),'createdAt':{'gte':_0x1d9d30},'gateway':{'not':_0x637446(0x14a)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x637446(0x229)]['findMany']({'where':{'gateway':{'not':_0x637446(0x14a)}},'take':0xa,'orderBy':{'createdAt':_0x637446(0x186)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x637446(0x229)]['findMany']({'where':{'createdAt':{'gte':_0x1d9d30},'gateway':{'not':_0x637446(0x14a)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4130bf=0x0;for(const _0x189375 of _0x33bf0a){const _0x465308=await currencyService_1['currencyService']['convertToUSDT'](_0x189375[_0x637446(0x135)],_0x189375[_0x637446(0x1f4)]);_0x4130bf+=_0x465308;}const _0x33426c=this[_0x637446(0x207)](_0x202d79,_0x1d9d30,_0x4235c9),_0xc295c8=_0x2a0904>0x0?_0x4693fe/_0x2a0904*0x64:0x0;return{'totalShops':_0x5a60be,'activeShops':_0x1d782f,'totalPayments':_0x2a0904,'successfulPayments':_0x4693fe,'totalRevenue':Math[_0x637446(0x119)](_0x4130bf*0x64)/0x64,'conversionRate':Math[_0x637446(0x119)](_0xc295c8*0x64)/0x64,'dailyRevenue':_0x33426c[_0x637446(0x11d)],'dailyPayments':_0x33426c['dailyPayments'],'recentPayments':_0x519596[_0x637446(0x202)](_0x4b674c=>({'id':_0x4b674c['id'],'amount':_0x4b674c[_0x637446(0x135)],'currency':_0x4b674c[_0x637446(0x1f4)],'status':_0x4b674c['status'],'gateway':_0x4b674c[_0x637446(0x1dd)],'shop':_0x4b674c['shop'],'createdAt':_0x4b674c[_0x637446(0x1b8)]}))};}async['getMerchantStatistics'](_0x25c6e1){const _0x3fc70a=a35_0x3d81be;console[_0x3fc70a(0x209)](_0x3fc70a(0x18b),_0x25c6e1);let _0x398c63,_0x40c683=new Date();if(_0x25c6e1[_0x3fc70a(0x1df)]===_0x3fc70a(0x1e1)&&_0x25c6e1[_0x3fc70a(0x182)]&&_0x25c6e1[_0x3fc70a(0x191)])_0x398c63=new Date(_0x25c6e1[_0x3fc70a(0x182)]),_0x40c683=new Date(_0x25c6e1[_0x3fc70a(0x191)]);else{const _0xc813de=new Date();switch(_0x25c6e1[_0x3fc70a(0x1df)]){case'week':_0x398c63=new Date(_0xc813de[_0x3fc70a(0x148)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3fc70a(0x16d):_0x398c63=new Date(_0xc813de['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3fc70a(0x157):_0x398c63=new Date(_0xc813de[_0x3fc70a(0x148)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x3fc70a(0x179):default:_0x398c63=new Date(_0x3fc70a(0x116));break;}}console[_0x3fc70a(0x209)](_0x3fc70a(0x220)+_0x398c63[_0x3fc70a(0x143)]()+_0x3fc70a(0x222)+_0x40c683[_0x3fc70a(0x143)]());const _0xbefd87={'status':_0x3fc70a(0x1cf),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x398c63,'lte':_0x40c683}};_0x25c6e1['shopId']&&(_0xbefd87[_0x3fc70a(0x1cc)]=_0x25c6e1['shopId']);const _0x1bad2f=await database_1['default']['payment']['findMany']({'where':_0xbefd87,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3fc70a(0x209)](_0x3fc70a(0x199)+_0x1bad2f[_0x3fc70a(0x1b2)]+_0x3fc70a(0x155));const _0x24ac4b={'gateway':{'not':_0x3fc70a(0x14a)},'createdAt':{'gte':_0x398c63,'lte':_0x40c683}};_0x25c6e1[_0x3fc70a(0x1cc)]&&(_0x24ac4b['shopId']=_0x25c6e1['shopId']);const _0x313854=await database_1[_0x3fc70a(0x1c2)][_0x3fc70a(0x229)][_0x3fc70a(0x20d)]({'where':_0x24ac4b});console['log']('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0x313854+',\x20successful:\x20'+_0x1bad2f[_0x3fc70a(0x1b2)]);let _0x14375f=0x0,_0x396f60=0x0,_0x1fd122=0x0;const _0x3d2f51={},_0x466d9f={},_0x4eb691={};for(const _0x394d7b of _0x1bad2f){try{const _0x122216=await currencyService_1[_0x3fc70a(0x174)]['convertToUSDT'](_0x394d7b['amount'],_0x394d7b[_0x3fc70a(0x1f4)]);let _0x29df7f={};if(_0x394d7b['shop']['gatewaySettings'])try{_0x29df7f=JSON[_0x3fc70a(0x22a)](_0x394d7b['shop'][_0x3fc70a(0x1ce)]);}catch(_0x8772eb){console[_0x3fc70a(0x110)](_0x3fc70a(0x190)+_0x394d7b[_0x3fc70a(0x1cc)]+':',_0x8772eb);}let _0x48512c={},_0x49412e=0xa;for(const [_0xc740bd,_0x4fad62]of Object[_0x3fc70a(0x1af)](_0x29df7f)){if(_0xc740bd[_0x3fc70a(0x1e3)]()===_0x394d7b[_0x3fc70a(0x1dd)]['toLowerCase']()){_0x48512c=_0x4fad62,_0x49412e=_0x4fad62[_0x3fc70a(0x154)]||0xa;break;}}const _0x4d4539=_0x122216*(_0x49412e/0x64),_0x174917=_0x122216-_0x4d4539;_0x14375f+=_0x122216,_0x396f60+=_0x174917,_0x1fd122+=_0x4d4539;!_0x3d2f51[_0x394d7b[_0x3fc70a(0x1dd)]]&&(_0x3d2f51[_0x394d7b['gateway']]={'gateway':_0x394d7b[_0x3fc70a(0x1dd)],'gatewayDisplayName':this[_0x3fc70a(0x178)](_0x394d7b[_0x3fc70a(0x1dd)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3d2f51[_0x394d7b[_0x3fc70a(0x1dd)]][_0x3fc70a(0x183)]++,_0x3d2f51[_0x394d7b[_0x3fc70a(0x1dd)]][_0x3fc70a(0x1f1)]+=_0x122216,_0x3d2f51[_0x394d7b[_0x3fc70a(0x1dd)]][_0x3fc70a(0x156)]+=_0x4d4539,_0x3d2f51[_0x394d7b[_0x3fc70a(0x1dd)]][_0x3fc70a(0x1ee)]+=_0x174917,_0x3d2f51[_0x394d7b['gateway']][_0x3fc70a(0x1f7)]+=_0x49412e;!_0x25c6e1[_0x3fc70a(0x1cc)]&&(!_0x466d9f[_0x394d7b[_0x3fc70a(0x1cc)]]&&(_0x466d9f[_0x394d7b['shopId']]={'shopId':_0x394d7b[_0x3fc70a(0x1cc)],'shopName':_0x394d7b['shop']['name'],'shopUsername':_0x394d7b[_0x3fc70a(0x1b3)][_0x3fc70a(0x1cb)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x466d9f[_0x394d7b[_0x3fc70a(0x1cc)]][_0x3fc70a(0x183)]++,_0x466d9f[_0x394d7b[_0x3fc70a(0x1cc)]][_0x3fc70a(0x1f1)]+=_0x122216,_0x466d9f[_0x394d7b['shopId']][_0x3fc70a(0x156)]+=_0x4d4539,_0x466d9f[_0x394d7b[_0x3fc70a(0x1cc)]][_0x3fc70a(0x1ee)]+=_0x174917);const _0x5cf07a=_0x394d7b[_0x3fc70a(0x1dc)][_0x3fc70a(0x143)]()[_0x3fc70a(0x139)]('T')[0x0];!_0x4eb691[_0x5cf07a]&&(_0x4eb691[_0x5cf07a]={'date':_0x5cf07a,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4eb691[_0x5cf07a][_0x3fc70a(0x164)]+=_0x122216,_0x4eb691[_0x5cf07a][_0x3fc70a(0x20c)]+=_0x174917,_0x4eb691[_0x5cf07a][_0x3fc70a(0x1a5)]+=_0x4d4539,_0x4eb691[_0x5cf07a][_0x3fc70a(0x183)]++;}catch(_0x47ee2b){console[_0x3fc70a(0x110)](_0x3fc70a(0x12a)+_0x394d7b['id']+':',_0x47ee2b);}}Object[_0x3fc70a(0x1f3)](_0x3d2f51)[_0x3fc70a(0x177)](_0x4165a5=>{const _0x3a8a58=_0x3fc70a;_0x4165a5[_0x3a8a58(0x1a1)]=_0x4165a5['paymentsCount']>0x0?_0x4165a5[_0x3a8a58(0x1f7)]/_0x4165a5['paymentsCount']:0x0,delete _0x4165a5['totalCommissionRate'];}),Object['values'](_0x466d9f)[_0x3fc70a(0x177)](_0x495614=>{const _0x5b9466=_0x3fc70a;_0x495614[_0x5b9466(0x175)]=_0x495614[_0x5b9466(0x183)]>0x0?_0x495614[_0x5b9466(0x1f1)]/_0x495614[_0x5b9466(0x183)]:0x0;});let _0x3fe34b=0x0;if(_0x25c6e1[_0x3fc70a(0x1cc)]){const _0x557953=await database_1[_0x3fc70a(0x1c2)][_0x3fc70a(0x21e)][_0x3fc70a(0x128)]({'where':{'shopId':_0x25c6e1['shopId'],'status':_0x3fc70a(0x14e),'createdAt':{'gte':_0x398c63,'lte':_0x40c683}},'select':{'amount':!![]}});_0x3fe34b=_0x557953[_0x3fc70a(0x153)]((_0x32eca6,_0x3de42e)=>_0x32eca6+_0x3de42e['amount'],0x0);}const _0x52704b=_0x313854,_0x43033c=_0x1bad2f[_0x3fc70a(0x1b2)],_0x2bf9f4=_0x43033c>0x0?_0x14375f/_0x43033c:0x0,_0x1ee17e=_0x52704b>0x0?Math[_0x3fc70a(0x119)](_0x43033c/_0x52704b*0x2710)/0x64:0x0,_0x36ab35=Math[_0x3fc70a(0x194)]((_0x40c683['getTime']()-_0x398c63[_0x3fc70a(0x148)]())/(0x3e8*0x3c*0x3c*0x18)),_0x30ceca={'totalTurnover':Math[_0x3fc70a(0x119)](_0x14375f*0x64)/0x64,'merchantEarnings':Math['round'](_0x396f60*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1fd122*0x64)/0x64,'totalPaidOut':Math[_0x3fc70a(0x119)](_0x3fe34b*0x64)/0x64,'averageCheck':Math['round'](_0x2bf9f4*0x64)/0x64,'totalPayments':_0x52704b,'successfulPayments':_0x43033c,'conversionRate':_0x1ee17e,'gatewayBreakdown':Object[_0x3fc70a(0x1f3)](_0x3d2f51)[_0x3fc70a(0x202)](_0x23f23f=>({..._0x23f23f,'turnoverUSDT':Math[_0x3fc70a(0x119)](_0x23f23f[_0x3fc70a(0x1f1)]*0x64)/0x64,'commissionUSDT':Math[_0x3fc70a(0x119)](_0x23f23f[_0x3fc70a(0x156)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x23f23f['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x23f23f[_0x3fc70a(0x1a1)]*0x64)/0x64})),'merchantBreakdown':_0x25c6e1[_0x3fc70a(0x1cc)]?undefined:Object[_0x3fc70a(0x1f3)](_0x466d9f)[_0x3fc70a(0x202)](_0x117515=>({..._0x117515,'turnoverUSDT':Math[_0x3fc70a(0x119)](_0x117515['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x117515['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x117515[_0x3fc70a(0x1ee)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x117515[_0x3fc70a(0x1ef)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x117515[_0x3fc70a(0x175)]*0x64)/0x64})),'dailyData':Object['values'](_0x4eb691)[_0x3fc70a(0x202)](_0x553aff=>({..._0x553aff,'turnover':Math[_0x3fc70a(0x119)](_0x553aff[_0x3fc70a(0x164)]*0x64)/0x64,'merchantEarnings':Math[_0x3fc70a(0x119)](_0x553aff['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x553aff[_0x3fc70a(0x1a5)]*0x64)/0x64}))[_0x3fc70a(0x12b)]((_0x3f3662,_0x20136d)=>_0x3f3662[_0x3fc70a(0x125)][_0x3fc70a(0x20b)](_0x20136d[_0x3fc70a(0x125)])),'periodInfo':{'from':_0x398c63,'to':_0x40c683,'periodType':_0x25c6e1[_0x3fc70a(0x1df)]||_0x3fc70a(0x1e1),'daysCount':_0x36ab35}};return console[_0x3fc70a(0x209)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x3fc70a(0x209)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x30ceca[_0x3fc70a(0x181)]+_0x3fc70a(0x169)),console[_0x3fc70a(0x209)](_0x3fc70a(0x1c4)+_0x30ceca[_0x3fc70a(0x20c)]+_0x3fc70a(0x169)),console[_0x3fc70a(0x209)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x30ceca[_0x3fc70a(0x1a5)]+_0x3fc70a(0x169)),console[_0x3fc70a(0x209)](_0x3fc70a(0x152)+_0x30ceca[_0x3fc70a(0x185)]),_0x30ceca;}async['getMerchantsSelection'](){const _0x2ed06c=a35_0x3d81be;console['log']('üìã\x20Getting\x20merchants\x20selection\x20list...');const _0x1bf948=await database_1[_0x2ed06c(0x1c2)][_0x2ed06c(0x1b3)][_0x2ed06c(0x128)]({'where':{'status':_0x2ed06c(0x145)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x2ed06c(0x209)](_0x2ed06c(0x203)+_0x1bf948[_0x2ed06c(0x1b2)]+_0x2ed06c(0x1fb)),_0x1bf948[_0x2ed06c(0x202)](_0x555b47=>({'id':_0x555b47['id'],'username':_0x555b47['username'],'name':_0x555b47[_0x2ed06c(0x22d)]}));}['getGatewayDisplayName'](_0x210618){const _0x54107b=a35_0x3d81be,_0x58db51={'test_gateway':_0x54107b(0x1e7),'plisio':_0x54107b(0x1f5),'rapyd':_0x54107b(0x124),'noda':_0x54107b(0x132),'cointopay':_0x54107b(0x17f),'cointopay2':_0x54107b(0x1f2),'klyme_eu':_0x54107b(0x129),'klyme_gb':_0x54107b(0x221),'klyme_de':'KLYME\x20DE','mastercard':_0x54107b(0x15c)};return _0x58db51[_0x210618]||_0x210618;}[a35_0x3d81be(0x21c)](_0xece439){const _0x1778f0=a35_0x3d81be,_0x42e015={'Test\x20Gateway':_0x1778f0(0x14a),'Plisio':_0x1778f0(0x13d),'Rapyd':'rapyd','Noda':_0x1778f0(0x13e),'CoinToPay':_0x1778f0(0x20f),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x1778f0(0x147),'KLYME\x20GB':_0x1778f0(0x117),'KLYME\x20DE':_0x1778f0(0x1d1),'MasterCard':'mastercard'};return _0x42e015[_0xece439]||_0xece439[_0x1778f0(0x1e3)]();}async[a35_0x3d81be(0x200)](_0x383dc2){const _0x8c1843=a35_0x3d81be,{page:_0x515537,limit:_0x37ff96,minAmount:_0x4d399a,search:_0x50ab77}=_0x383dc2,_0x1d16a9=(_0x515537-0x1)*_0x37ff96;console[_0x8c1843(0x209)](_0x8c1843(0x193),_0x383dc2);const _0x3bd8c2={'balance':{'gt':0x0},'status':_0x8c1843(0x145)};_0x4d399a&&(_0x3bd8c2[_0x8c1843(0x1bf)][_0x8c1843(0x172)]=_0x4d399a);_0x50ab77&&(_0x3bd8c2['OR']=[{'name':{'contains':_0x50ab77,'mode':'insensitive'}},{'username':{'contains':_0x50ab77,'mode':_0x8c1843(0x1e2)}}]);const [_0x5d2d56,_0x41e9f2]=await Promise[_0x8c1843(0x179)]([database_1[_0x8c1843(0x1c2)]['shop'][_0x8c1843(0x128)]({'where':_0x3bd8c2,'skip':_0x1d16a9,'take':_0x37ff96,'orderBy':{'balance':_0x8c1843(0x186)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x8c1843(0x1b3)][_0x8c1843(0x20d)]({'where':_0x3bd8c2})]);console['log']('üí∞\x20Found\x20'+_0x5d2d56[_0x8c1843(0x1b2)]+'\x20merchants\x20with\x20positive\x20balance');const _0x36d2ae=await Promise[_0x8c1843(0x179)](_0x5d2d56[_0x8c1843(0x202)](async _0x3ed2fc=>{const _0x582490=_0x8c1843,[_0x50e434,_0x37f480,_0x485bb6]=await Promise['all']([database_1[_0x582490(0x1c2)][_0x582490(0x229)][_0x582490(0x20d)]({'where':{'shopId':_0x3ed2fc['id'],'status':_0x582490(0x1cf),'gateway':{'not':'test_gateway'}}}),database_1[_0x582490(0x1c2)][_0x582490(0x229)][_0x582490(0x15d)]({'where':{'shopId':_0x3ed2fc['id'],'status':_0x582490(0x1cf),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x582490(0x16c)},'select':{'paidAt':!![]}}),database_1[_0x582490(0x1c2)][_0x582490(0x229)]['groupBy']({'by':[_0x582490(0x1dd)],'where':{'shopId':_0x3ed2fc['id'],'status':'PAID','gateway':{'not':_0x582490(0x14a)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xb608f9=new Date(),_0x25a531=new Date(_0xb608f9[_0x582490(0x136)](),_0xb608f9[_0x582490(0x210)](),0x1),_0x51dfe1=new Date(_0xb608f9[_0x582490(0x136)](),_0xb608f9[_0x582490(0x210)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x53b7d4,_0x4c23f6]=await Promise[_0x582490(0x179)]([database_1[_0x582490(0x1c2)][_0x582490(0x21e)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x3ed2fc['id'],'status':'COMPLETED'}}),database_1[_0x582490(0x1c2)][_0x582490(0x21e)][_0x582490(0x1f9)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3ed2fc['id'],'status':_0x582490(0x14e),'createdAt':{'gte':_0x25a531,'lte':_0x51dfe1}}})]),_0x234d09=_0x53b7d4[_0x582490(0x1b9)][_0x582490(0x135)]||0x0,_0x2bda15=_0x4c23f6[_0x582490(0x1b9)]['amount']||0x0,_0x771472=await Promise[_0x582490(0x179)](_0x485bb6[_0x582490(0x202)](async _0x2714c1=>{const _0x5ca64b=_0x582490;let _0x2ec2a0=0xa;if(_0x3ed2fc[_0x5ca64b(0x1ce)])try{const _0x5a23b9=JSON[_0x5ca64b(0x22a)](_0x3ed2fc[_0x5ca64b(0x1ce)]);for(const [_0x14772a,_0x2d1e34]of Object[_0x5ca64b(0x1af)](_0x5a23b9)){if(_0x14772a['toLowerCase']()===_0x2714c1[_0x5ca64b(0x1dd)][_0x5ca64b(0x1e3)]()){_0x2ec2a0=_0x2d1e34[_0x5ca64b(0x154)]||0xa,console[_0x5ca64b(0x209)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x2714c1[_0x5ca64b(0x1dd)]+_0x5ca64b(0x16e)+_0x3ed2fc['id']+_0x5ca64b(0x213)+_0x2ec2a0+'%');break;}}}catch(_0x4fd542){console[_0x5ca64b(0x110)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x3ed2fc['id']+':',_0x4fd542);}const _0x2e3f8b=_0x2714c1['_sum'][_0x5ca64b(0x114)]||0x0,_0x468fb0=_0x2e3f8b*(0x1-_0x2ec2a0/0x64);return{'gateway':_0x2714c1[_0x5ca64b(0x1dd)],'count':_0x2714c1['_count']['id'],'amountUSDT':Math['round'](_0x2e3f8b*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5ca64b(0x119)](_0x468fb0*0x64)/0x64,'commission':_0x2ec2a0};})),_0x1d5334=_0x771472[_0x582490(0x153)]((_0x813d43,_0x31f562)=>_0x813d43+_0x31f562[_0x582490(0x114)],0x0),_0x164680=_0x3ed2fc[_0x582490(0x1bf)];return console[_0x582490(0x209)](_0x582490(0x180)+_0x3ed2fc[_0x582490(0x1cb)]+':'),console[_0x582490(0x209)]('\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20'+_0x1d5334[_0x582490(0x1b1)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x582490(0x209)](_0x582490(0x17a)+_0x771472[_0x582490(0x153)]((_0x7159b3,_0x4f6f32)=>_0x7159b3+_0x4f6f32[_0x582490(0x1d5)],0x0)[_0x582490(0x1b1)](0x2)+_0x582490(0x12f)),console[_0x582490(0x209)](_0x582490(0x149)+_0x164680['toFixed'](0x2)+_0x582490(0x11c)),{'id':_0x3ed2fc['id'],'fullName':_0x3ed2fc[_0x582490(0x22d)],'username':_0x3ed2fc[_0x582490(0x1cb)],'telegramId':_0x3ed2fc['telegram'],'merchantUrl':_0x3ed2fc[_0x582490(0x126)],'wallets':{'usdtPolygonWallet':_0x3ed2fc[_0x582490(0x1db)],'usdtTrcWallet':_0x3ed2fc[_0x582490(0x1d6)],'usdtErcWallet':_0x3ed2fc[_0x582490(0x20e)],'usdcPolygonWallet':_0x3ed2fc[_0x582490(0x208)]},'totalAmountUSDT':Math[_0x582490(0x119)](_0x1d5334*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x582490(0x119)](_0x164680*0x64)/0x64,'totalPayout':Math[_0x582490(0x119)](_0x234d09*0x64)/0x64,'thisMonth':Math['round'](_0x2bda15*0x64)/0x64,'paymentsCount':_0x50e434,'oldestPaymentDate':_0x37f480?.[_0x582490(0x1dc)]||_0x3ed2fc[_0x582490(0x1b8)],'gatewayBreakdown':_0x771472};})),_0x29c785=_0x36d2ae[_0x8c1843(0x153)]((_0xfd0015,_0x1e2ab3)=>_0xfd0015+_0x1e2ab3[_0x8c1843(0x1f8)],0x0),_0x5b5f8f=_0x36d2ae[_0x8c1843(0x153)]((_0x170b28,_0x51354d)=>_0x170b28+_0x51354d[_0x8c1843(0x15b)],0x0),_0x56f2fc=_0x36d2ae[_0x8c1843(0x153)]((_0x4deee0,_0x374b21)=>_0x4deee0+_0x374b21[_0x8c1843(0x161)],0x0),_0x134e67=_0x36d2ae[_0x8c1843(0x153)]((_0x328cdb,_0x1aaffe)=>_0x328cdb+_0x1aaffe[_0x8c1843(0x227)],0x0);return console[_0x8c1843(0x209)]('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x41e9f2+_0x8c1843(0x1c1)),console[_0x8c1843(0x209)]('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math[_0x8c1843(0x119)](_0x29c785*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x8c1843(0x209)]('\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20'+Math['round'](_0x5b5f8f*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console['log']('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x8c1843(0x119)](_0x56f2fc*0x64)/0x64+'\x20USDT'),console[_0x8c1843(0x209)](_0x8c1843(0x1bb)+Math[_0x8c1843(0x119)](_0x134e67*0x64)/0x64+_0x8c1843(0x169)),{'merchants':_0x36d2ae,'pagination':{'page':_0x515537,'limit':_0x37ff96,'total':_0x41e9f2,'totalPages':Math[_0x8c1843(0x194)](_0x41e9f2/_0x37ff96)},'summary':{'totalMerchants':_0x41e9f2,'totalAmountUSDT':Math[_0x8c1843(0x119)](_0x29c785*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x8c1843(0x119)](_0x5b5f8f*0x64)/0x64,'totalPayout':Math[_0x8c1843(0x119)](_0x56f2fc*0x64)/0x64,'thisMonth':Math[_0x8c1843(0x119)](_0x134e67*0x64)/0x64}};}async[a35_0x3d81be(0x17c)](_0x47befa){const _0x331a6d=a35_0x3d81be,{shopId:_0x57ee35,amount:_0x590747,network:_0x2feee7,wallet:_0x2adcad,notes:_0x4dd8c8,txid:_0x465897,periodFrom:_0x5e248d,periodTo:_0x41bb84}=_0x47befa,_0x205a42=await database_1['default']['$transaction'](async _0x88b673=>{const _0x9913e9=a35_0x408b,_0x57417a=await _0x88b673['shop'][_0x9913e9(0x1d0)]({'where':{'id':_0x57ee35},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x57417a)throw new Error('Shop\x20not\x20found');console[_0x9913e9(0x209)](_0x9913e9(0x1ed)+_0x57417a[_0x9913e9(0x1cb)]+':'),console['log'](_0x9913e9(0x1eb)+_0x57417a[_0x9913e9(0x1bf)][_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x169)),console[_0x9913e9(0x209)]('\x20\x20\x20Payout\x20amount:\x20'+_0x590747[_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x169)),console[_0x9913e9(0x209)](_0x9913e9(0x159)+_0x57417a['totalPaidOut'][_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x169));if(_0x465897)console[_0x9913e9(0x209)](_0x9913e9(0x151)+_0x465897);if(_0x57417a[_0x9913e9(0x1bf)]<_0x590747)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x57417a[_0x9913e9(0x1bf)][_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x134)+_0x590747[_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x169));let _0x5be8c2=_0x2adcad;if(!_0x5be8c2){const _0x4b9d43=await _0x88b673[_0x9913e9(0x1b3)][_0x9913e9(0x1d0)]({'where':{'id':_0x57ee35},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4b9d43)switch(_0x2feee7){case _0x9913e9(0x21b):_0x5be8c2=_0x4b9d43[_0x9913e9(0x1db)]||undefined;break;case _0x9913e9(0x224):_0x5be8c2=_0x4b9d43['usdtTrcWallet']||undefined;break;case _0x9913e9(0x11f):_0x5be8c2=_0x4b9d43[_0x9913e9(0x20e)]||undefined;break;case _0x9913e9(0x15f):_0x5be8c2=_0x4b9d43[_0x9913e9(0x208)]||undefined;break;}}console['log']('üí≥\x20Payout\x20wallet\x20for\x20'+_0x2feee7+':\x20'+(_0x5be8c2||_0x9913e9(0x1fd)));const _0x2aa13e=await _0x88b673[_0x9913e9(0x21e)][_0x9913e9(0x167)]({'data':{'shopId':_0x57ee35,'amount':_0x590747,'network':_0x2feee7,'status':_0x9913e9(0x14e),'txid':_0x465897,'notes':_0x4dd8c8,'periodFrom':_0x5e248d?new Date(_0x5e248d):null,'periodTo':_0x41bb84?new Date(_0x41bb84):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4efb95=_0x57417a[_0x9913e9(0x1bf)]-_0x590747,_0x198e60=_0x57417a[_0x9913e9(0x1e9)]+_0x590747;return await _0x88b673[_0x9913e9(0x1b3)][_0x9913e9(0x19c)]({'where':{'id':_0x57ee35},'data':{'balance':_0x4efb95,'totalPaidOut':_0x198e60}}),console[_0x9913e9(0x209)]('üí∞\x20Shop\x20'+_0x57417a['username']+'\x20balance\x20updated:'),console[_0x9913e9(0x209)](_0x9913e9(0x19b)+_0x57417a['balance']['toFixed'](0x6)+_0x9913e9(0x18d)+_0x4efb95[_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x217)+_0x590747[_0x9913e9(0x1b1)](0x6)+')'),console[_0x9913e9(0x209)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x57417a[_0x9913e9(0x1e9)][_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x18d)+_0x198e60[_0x9913e9(0x1b1)](0x6)+_0x9913e9(0x21a)+_0x590747[_0x9913e9(0x1b1)](0x6)+')'),{'payout':_0x2aa13e,'shop':_0x57417a};});return console['log'](_0x331a6d(0x204)+_0x205a42[_0x331a6d(0x21e)]['id']+_0x331a6d(0x16e)+_0x205a42['shop'][_0x331a6d(0x1cb)]+'\x20('+_0x590747+_0x331a6d(0x130)),{'id':_0x205a42[_0x331a6d(0x21e)]['id'],'shopId':_0x205a42[_0x331a6d(0x21e)][_0x331a6d(0x1cc)],'shopName':_0x205a42[_0x331a6d(0x1b3)][_0x331a6d(0x22d)],'shopUsername':_0x205a42[_0x331a6d(0x1b3)][_0x331a6d(0x1cb)],'amount':_0x205a42[_0x331a6d(0x21e)][_0x331a6d(0x135)],'network':_0x205a42['payout'][_0x331a6d(0x12e)],'status':_0x205a42[_0x331a6d(0x21e)][_0x331a6d(0x127)],'txid':_0x205a42['payout']['txid'],'notes':_0x205a42[_0x331a6d(0x21e)][_0x331a6d(0x1e5)],'periodFrom':_0x205a42['payout'][_0x331a6d(0x197)],'periodTo':_0x205a42[_0x331a6d(0x21e)][_0x331a6d(0x13c)],'createdAt':_0x205a42[_0x331a6d(0x21e)][_0x331a6d(0x1b8)],'paidAt':_0x205a42[_0x331a6d(0x21e)][_0x331a6d(0x1dc)]};}async[a35_0x3d81be(0x133)](_0x3640e1){const _0x184763=a35_0x3d81be,{page:_0x4d667c,limit:_0x25ce1d,shopId:_0x5ab05c,network:_0x5a7487,dateFrom:_0x16cb95,dateTo:_0x82de11,search:_0x319378}=_0x3640e1,_0x73e376=(_0x4d667c-0x1)*_0x25ce1d,_0x17d4a6={};_0x5ab05c&&(_0x17d4a6[_0x184763(0x1cc)]=_0x5ab05c);_0x5a7487&&(_0x17d4a6[_0x184763(0x12e)]=_0x5a7487);(_0x16cb95||_0x82de11)&&(_0x17d4a6['createdAt']={},_0x16cb95&&(_0x17d4a6[_0x184763(0x1b8)][_0x184763(0x172)]=new Date(_0x16cb95)),_0x82de11&&(_0x17d4a6[_0x184763(0x1b8)][_0x184763(0x17e)]=new Date(_0x82de11)));_0x319378&&(_0x17d4a6['OR']=[{'shop':{'name':{'contains':_0x319378,'mode':_0x184763(0x1e2)}}},{'shop':{'username':{'contains':_0x319378,'mode':_0x184763(0x1e2)}}},{'notes':{'contains':_0x319378,'mode':'insensitive'}}]);const [_0xced153,_0x4c2826]=await Promise['all']([database_1['default'][_0x184763(0x21e)][_0x184763(0x128)]({'where':_0x17d4a6,'skip':_0x73e376,'take':_0x25ce1d,'orderBy':{'createdAt':_0x184763(0x186)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout']['count']({'where':_0x17d4a6})]);return{'payouts':_0xced153[_0x184763(0x202)](_0x1f18fc=>({'id':_0x1f18fc['id'],'shopId':_0x1f18fc['shopId'],'shopName':_0x1f18fc[_0x184763(0x1b3)][_0x184763(0x22d)],'shopUsername':_0x1f18fc[_0x184763(0x1b3)][_0x184763(0x1cb)],'amount':_0x1f18fc[_0x184763(0x135)],'network':_0x1f18fc['network'],'status':_0x1f18fc[_0x184763(0x127)],'txid':_0x1f18fc[_0x184763(0x1ae)],'notes':_0x1f18fc['notes'],'periodFrom':_0x1f18fc['periodFrom'],'periodTo':_0x1f18fc[_0x184763(0x13c)],'createdAt':_0x1f18fc['createdAt'],'paidAt':_0x1f18fc[_0x184763(0x1dc)]})),'pagination':{'page':_0x4d667c,'limit':_0x25ce1d,'total':_0x4c2826,'totalPages':Math[_0x184763(0x194)](_0x4c2826/_0x25ce1d)}};}async[a35_0x3d81be(0x1a8)](_0x3841db){const _0x2eefbb=a35_0x3d81be,_0x38bd3d=await database_1[_0x2eefbb(0x1c2)][_0x2eefbb(0x21e)]['findUnique']({'where':{'id':_0x3841db},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x38bd3d)return null;return{'id':_0x38bd3d['id'],'shopId':_0x38bd3d[_0x2eefbb(0x1cc)],'shopName':_0x38bd3d[_0x2eefbb(0x1b3)][_0x2eefbb(0x22d)],'shopUsername':_0x38bd3d[_0x2eefbb(0x1b3)][_0x2eefbb(0x1cb)],'amount':_0x38bd3d[_0x2eefbb(0x135)],'network':_0x38bd3d[_0x2eefbb(0x12e)],'status':_0x38bd3d[_0x2eefbb(0x127)],'txid':_0x38bd3d['txid'],'notes':_0x38bd3d[_0x2eefbb(0x1e5)],'periodFrom':_0x38bd3d[_0x2eefbb(0x197)],'periodTo':_0x38bd3d['periodTo'],'createdAt':_0x38bd3d[_0x2eefbb(0x1b8)],'paidAt':_0x38bd3d[_0x2eefbb(0x1dc)]};}async[a35_0x3d81be(0x1bd)](_0x13dd5e){const _0x3993b4=a35_0x3d81be;await database_1[_0x3993b4(0x1c2)][_0x3993b4(0x21e)][_0x3993b4(0x18a)]({'where':{'id':_0x13dd5e}});}async[a35_0x3d81be(0x1ac)](_0x2f9bd8){const _0x7068b3=a35_0x3d81be,{page:_0x2175aa,limit:_0x4788ac,status:_0x111fec,gateway:_0x243ec2,shopId:_0x1ee52f,dateFrom:_0x2563de,dateTo:_0x124874,search:_0x41b087,currency:_0x158e29,sortBy:_0x287808,sortOrder:_0x267a74}=_0x2f9bd8,_0x41db54=(_0x2175aa-0x1)*_0x4788ac;console[_0x7068b3(0x209)]('üìä\x20Getting\x20payments\x20with\x20filters:',_0x2f9bd8);const _0x52668c=await database_1['default']['payment'][_0x7068b3(0x1be)]({'by':[_0x7068b3(0x1dd)],'_count':{'gateway':!![]}});console[_0x7068b3(0x209)]('üìä\x20Available\x20gateways\x20in\x20database:',_0x52668c[_0x7068b3(0x202)](_0xf7680a=>_0xf7680a['gateway']+'\x20('+_0xf7680a[_0x7068b3(0x11a)][_0x7068b3(0x1dd)]+_0x7068b3(0x13b)));if(_0x243ec2){const _0x3f2c35=_0x52668c['some'](_0x4195d2=>_0x4195d2[_0x7068b3(0x1dd)][_0x7068b3(0x1e3)]()===_0x243ec2[_0x7068b3(0x1e3)]());!_0x3f2c35&&_0x243ec2[_0x7068b3(0x1e3)]()!==_0x7068b3(0x14a)&&console[_0x7068b3(0x209)](_0x7068b3(0x206)+_0x243ec2+_0x7068b3(0x1f6)+_0x52668c['map'](_0x3e5517=>_0x3e5517['gateway'])[_0x7068b3(0x158)](',\x20'));}const _0x4088a8={};_0x111fec&&(_0x4088a8[_0x7068b3(0x127)]=_0x111fec[_0x7068b3(0x1cd)]());if(!_0x243ec2)_0x4088a8[_0x7068b3(0x1dd)]={'not':'test_gateway'};else{if(_0x243ec2&&(_0x243ec2['toLowerCase']()===_0x7068b3(0x14a)||_0x243ec2===_0x7068b3(0x1ad)))_0x4088a8[_0x7068b3(0x1dd)]=_0x7068b3(0x14a);else{let _0x133d5c=_0x243ec2;const _0x2b2141=(0x0,gateway_1[_0x7068b3(0x1b0)])(_0x243ec2);if(_0x2b2141)_0x133d5c=_0x2b2141,console[_0x7068b3(0x209)](_0x7068b3(0x138)+_0x243ec2+_0x7068b3(0x205)+_0x133d5c+'\x27');else{const _0xd98575=(0x0,gateway_1[_0x7068b3(0x176)])(_0x243ec2);if(_0xd98575){const _0x213677=(0x0,gateway_1[_0x7068b3(0x1b0)])(_0xd98575);_0x213677&&(_0x133d5c=_0x213677,console[_0x7068b3(0x209)](_0x7068b3(0x142)+_0x243ec2+_0x7068b3(0x13f)+_0xd98575+_0x7068b3(0x11b)+_0x133d5c+'\x27'));}else console[_0x7068b3(0x209)](_0x7068b3(0x21d)+_0x243ec2+_0x7068b3(0x168));}const _0xcfd655=await database_1['default'][_0x7068b3(0x229)][_0x7068b3(0x20d)]({'where':{'gateway':_0x133d5c['toLowerCase']()},'take':0x1});_0xcfd655===0x0?(console[_0x7068b3(0x209)](_0x7068b3(0x1ab)+_0x133d5c+_0x7068b3(0x121)+_0x243ec2+_0x7068b3(0x184)),_0x4088a8[_0x7068b3(0x1dd)]=_0x7068b3(0x195)):(_0x4088a8[_0x7068b3(0x1dd)]=_0x133d5c['toLowerCase'](),console['log'](_0x7068b3(0x1e8)+_0x133d5c+_0x7068b3(0x121)+_0x243ec2+'\x27)'));}}console[_0x7068b3(0x209)]('üìä\x20Gateway\x20filter\x20applied:',_0x4088a8[_0x7068b3(0x1dd)]);_0x1ee52f&&(_0x4088a8[_0x7068b3(0x1cc)]=_0x1ee52f);_0x158e29&&(_0x4088a8[_0x7068b3(0x1f4)]=_0x158e29['toUpperCase'](),console[_0x7068b3(0x209)]('üí±\x20Currency\x20filter\x20applied:\x20'+_0x158e29['toUpperCase']()));(_0x2563de||_0x124874)&&(_0x4088a8['createdAt']={},_0x2563de&&(_0x4088a8[_0x7068b3(0x1b8)]['gte']=new Date(_0x2563de)),_0x124874&&(_0x4088a8[_0x7068b3(0x1b8)][_0x7068b3(0x17e)]=new Date(_0x124874)));_0x41b087&&(_0x4088a8['OR']=[{'id':{'contains':_0x41b087,'mode':_0x7068b3(0x1e2)}},{'orderId':{'contains':_0x41b087,'mode':_0x7068b3(0x1e2)}},{'gatewayOrderId':{'contains':_0x41b087,'mode':_0x7068b3(0x1e2)}},{'customerEmail':{'contains':_0x41b087,'mode':_0x7068b3(0x1e2)}},{'shop':{'name':{'contains':_0x41b087,'mode':_0x7068b3(0x1e2)}}},{'shop':{'username':{'contains':_0x41b087,'mode':_0x7068b3(0x1e2)}}}]);console[_0x7068b3(0x209)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x7068b3(0x1e6)](_0x4088a8,null,0x2));let _0x10994b={'createdAt':_0x7068b3(0x186)};if(_0x287808){const _0x6cee0b=[_0x7068b3(0x135),_0x7068b3(0x1b8),_0x7068b3(0x173),_0x7068b3(0x127),_0x7068b3(0x1dd),'currency'],_0x288bfc=[_0x7068b3(0x16c),_0x7068b3(0x186)];if(_0x6cee0b['includes'](_0x287808)){const _0x3c62e4=_0x288bfc[_0x7068b3(0x22b)](_0x267a74)?_0x267a74:'desc';_0x10994b={[_0x287808]:_0x3c62e4},console['log'](_0x7068b3(0x141)+_0x287808+_0x7068b3(0x1ba)+_0x3c62e4+_0x7068b3(0x1bc));}}const [_0x164fcd,_0x5bf893]=await Promise['all']([database_1['default'][_0x7068b3(0x229)][_0x7068b3(0x128)]({'where':_0x4088a8,'skip':_0x41db54,'take':_0x4788ac,'orderBy':_0x10994b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x7068b3(0x229)]['count']({'where':_0x4088a8})]);return{'payments':_0x164fcd,'pagination':{'page':_0x2175aa,'limit':_0x4788ac,'total':_0x5bf893,'totalPages':Math['ceil'](_0x5bf893/_0x4788ac)}};}async[a35_0x3d81be(0x113)](_0x6d10c9){const _0x4b3616=a35_0x3d81be,_0x3651c8=await database_1[_0x4b3616(0x1c2)]['payment'][_0x4b3616(0x1d0)]({'where':{'id':_0x6d10c9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3651c8)return null;return{'id':_0x3651c8['id'],'shopId':_0x3651c8[_0x4b3616(0x1cc)],'gateway':_0x3651c8[_0x4b3616(0x1dd)],'amount':_0x3651c8[_0x4b3616(0x135)],'currency':_0x3651c8['currency'],'status':_0x3651c8[_0x4b3616(0x127)],'orderId':_0x3651c8[_0x4b3616(0x18c)],'gatewayOrderId':_0x3651c8['gatewayOrderId'],'customerEmail':_0x3651c8[_0x4b3616(0x1d9)],'customerName':_0x3651c8['customerName'],'customerCountry':_0x3651c8[_0x4b3616(0x13a)],'customerIp':_0x3651c8[_0x4b3616(0x111)],'customerUa':_0x3651c8[_0x4b3616(0x166)],'failureMessage':_0x3651c8[_0x4b3616(0x198)],'externalPaymentUrl':_0x3651c8['externalPaymentUrl'],'successUrl':_0x3651c8[_0x4b3616(0x1b6)],'failUrl':_0x3651c8[_0x4b3616(0x150)],'pendingUrl':_0x3651c8[_0x4b3616(0x171)],'whiteUrl':_0x3651c8[_0x4b3616(0x211)],'createdAt':_0x3651c8[_0x4b3616(0x1b8)],'updatedAt':_0x3651c8[_0x4b3616(0x173)],'shop':_0x3651c8[_0x4b3616(0x1b3)]};}async[a35_0x3d81be(0x1c3)](_0x25de35,_0x5aa1f1,_0x54cd97,_0x1696f4){const _0x44d198=a35_0x3d81be,_0x4b49a7=await database_1['default']['$transaction'](async _0x5df102=>{const _0x1b9ae0=a35_0x408b,_0xeeaa0e=await _0x5df102['payment'][_0x1b9ae0(0x1d0)]({'where':{'id':_0x25de35},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xeeaa0e)throw new Error(_0x1b9ae0(0x15e));const _0x29ccd2=_0xeeaa0e[_0x1b9ae0(0x127)],_0x3747a0=_0x5aa1f1[_0x1b9ae0(0x1cd)]();console[_0x1b9ae0(0x209)](_0x1b9ae0(0x22e)+_0x25de35+_0x1b9ae0(0x216)+_0x29ccd2+_0x1b9ae0(0x18d)+_0x3747a0),console['log'](_0x1b9ae0(0x17d)+_0xeeaa0e[_0x1b9ae0(0x1b3)][_0x1b9ae0(0x1bf)]+'\x20USDT');const _0x5815ab={'status':_0x3747a0,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x54cd97&&(_0x5815ab[_0x1b9ae0(0x123)]=_0x54cd97);_0x3747a0===_0x1b9ae0(0x16b)&&_0x1696f4&&(_0x5815ab[_0x1b9ae0(0x160)]=_0x1696f4);let _0x3fb819=0x0,_0x526230=_0xeeaa0e[_0x1b9ae0(0x1b3)][_0x1b9ae0(0x1bf)];if(_0x3747a0==='PAID'&&_0x29ccd2!=='PAID'){_0x5815ab['paidAt']=new Date();const _0x50d1c6=await currencyService_1['currencyService'][_0x1b9ae0(0x1aa)](_0xeeaa0e['amount'],_0xeeaa0e[_0x1b9ae0(0x1f4)]);_0x5815ab[_0x1b9ae0(0x114)]=_0x50d1c6;let _0x594b98=0xa;const _0x168082=await _0x5df102['shop'][_0x1b9ae0(0x1d0)]({'where':{'id':_0xeeaa0e[_0x1b9ae0(0x1cc)]},'select':{'gatewaySettings':!![]}});if(_0x168082?.[_0x1b9ae0(0x1ce)])try{const _0x5b6784=JSON[_0x1b9ae0(0x22a)](_0x168082[_0x1b9ae0(0x1ce)]);for(const [_0x5bd87f,_0x157512]of Object[_0x1b9ae0(0x1af)](_0x5b6784)){if(_0x5bd87f[_0x1b9ae0(0x1e3)]()===_0xeeaa0e[_0x1b9ae0(0x1dd)][_0x1b9ae0(0x1e3)]()){_0x594b98=_0x157512['commission']||0xa;break;}}}catch(_0x5929fe){console[_0x1b9ae0(0x110)](_0x1b9ae0(0x196)+_0x25de35+':',_0x5929fe);}const _0x39dcf2=_0x50d1c6*(0x1-_0x594b98/0x64);_0x3fb819=_0x39dcf2,_0x526230+=_0x39dcf2,console[_0x1b9ae0(0x209)](_0x1b9ae0(0x115)+_0x25de35+_0x1b9ae0(0x1fc)),console[_0x1b9ae0(0x209)]('\x20\x20\x20Full\x20amount:\x20'+_0x50d1c6[_0x1b9ae0(0x1b1)](0x6)+_0x1b9ae0(0x169)),console[_0x1b9ae0(0x209)](_0x1b9ae0(0x12c)+_0xeeaa0e[_0x1b9ae0(0x1dd)]+_0x1b9ae0(0x11e)+_0x594b98+'%'),console[_0x1b9ae0(0x209)](_0x1b9ae0(0x1ff)+_0x39dcf2[_0x1b9ae0(0x1b1)](0x6)+_0x1b9ae0(0x22c)+_0x594b98+_0x1b9ae0(0x219)),console[_0x1b9ae0(0x209)](_0x1b9ae0(0x19e)+_0x39dcf2[_0x1b9ae0(0x1b1)](0x6)+_0x1b9ae0(0x169));}else{if(_0x29ccd2===_0x1b9ae0(0x1cf)&&_0x3747a0!=='PAID'){if(_0xeeaa0e[_0x1b9ae0(0x114)]){let _0x200e10=0xa;const _0x34f3d1=await _0x5df102[_0x1b9ae0(0x1b3)][_0x1b9ae0(0x1d0)]({'where':{'id':_0xeeaa0e[_0x1b9ae0(0x1cc)]},'select':{'gatewaySettings':!![]}});if(_0x34f3d1?.[_0x1b9ae0(0x1ce)])try{const _0x3f669a=JSON['parse'](_0x34f3d1[_0x1b9ae0(0x1ce)]);for(const [_0x30ace8,_0x2afb0f]of Object[_0x1b9ae0(0x1af)](_0x3f669a)){if(_0x30ace8[_0x1b9ae0(0x1e3)]()===_0xeeaa0e[_0x1b9ae0(0x1dd)][_0x1b9ae0(0x1e3)]()){_0x200e10=_0x2afb0f['commission']||0xa;break;}}}catch(_0x3f959e){console[_0x1b9ae0(0x110)](_0x1b9ae0(0x196)+_0x25de35+':',_0x3f959e);}const _0x207e55=_0xeeaa0e['amountUSDT']*(0x1-_0x200e10/0x64);_0x3fb819=-_0x207e55,_0x526230-=_0x207e55,_0x5815ab['amountUSDT']=null,console[_0x1b9ae0(0x209)](_0x1b9ae0(0x115)+_0x25de35+_0x1b9ae0(0x1b7)),console[_0x1b9ae0(0x209)]('\x20\x20\x20Full\x20amount:\x20'+_0xeeaa0e['amountUSDT']['toFixed'](0x6)+_0x1b9ae0(0x169)),console['log'](_0x1b9ae0(0x12c)+_0xeeaa0e[_0x1b9ae0(0x1dd)]+_0x1b9ae0(0x11e)+_0x200e10+'%'),console['log'](_0x1b9ae0(0x214)+_0x207e55[_0x1b9ae0(0x1b1)](0x6)+_0x1b9ae0(0x22c)+_0x200e10+_0x1b9ae0(0x219)),console[_0x1b9ae0(0x209)](_0x1b9ae0(0x201)+_0x207e55['toFixed'](0x6)+_0x1b9ae0(0x169));}}}_0x3747a0==='CHARGEBACK'&&(_0x29ccd2===_0x1b9ae0(0x1cf)&&_0xeeaa0e[_0x1b9ae0(0x114)]&&console[_0x1b9ae0(0x209)]('üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x1696f4&&_0x1696f4>0x0&&(_0x3fb819-=_0x1696f4,_0x526230-=_0x1696f4,console['log'](_0x1b9ae0(0x131)+_0x1696f4['toFixed'](0x6)+'\x20USDT\x20from\x20balance')));_0x3747a0===_0x1b9ae0(0x15a)&&_0x29ccd2===_0x1b9ae0(0x1cf)&&console[_0x1b9ae0(0x209)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x184029=await _0x5df102[_0x1b9ae0(0x229)][_0x1b9ae0(0x19c)]({'where':{'id':_0x25de35},'data':_0x5815ab,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3fb819!==0x0&&(await _0x5df102[_0x1b9ae0(0x1b3)][_0x1b9ae0(0x19c)]({'where':{'id':_0xeeaa0e[_0x1b9ae0(0x1cc)]},'data':{'balance':_0x526230}}),console['log'](_0x1b9ae0(0x1c6)+_0xeeaa0e[_0x1b9ae0(0x1cc)]+_0x1b9ae0(0x1c9)+_0xeeaa0e[_0x1b9ae0(0x1b3)]['balance'][_0x1b9ae0(0x1b1)](0x6)+_0x1b9ae0(0x18d)+_0x526230['toFixed'](0x6)+_0x1b9ae0(0x1e0)+(_0x3fb819>0x0?'+':'')+_0x3fb819[_0x1b9ae0(0x1b1)](0x6)+')')),_0x184029;});return{'id':_0x4b49a7['id'],'shopId':_0x4b49a7[_0x44d198(0x1cc)],'gateway':_0x4b49a7[_0x44d198(0x1dd)],'amount':_0x4b49a7['amount'],'currency':_0x4b49a7[_0x44d198(0x1f4)],'status':_0x4b49a7[_0x44d198(0x127)],'orderId':_0x4b49a7[_0x44d198(0x18c)],'gatewayOrderId':_0x4b49a7['gatewayOrderId'],'customerEmail':_0x4b49a7['customerEmail'],'customerName':_0x4b49a7[_0x44d198(0x120)],'customerCountry':_0x4b49a7['customerCountry'],'customerIp':_0x4b49a7[_0x44d198(0x111)],'customerUa':_0x4b49a7[_0x44d198(0x166)],'failureMessage':_0x4b49a7[_0x44d198(0x198)],'adminNotes':_0x4b49a7[_0x44d198(0x123)],'chargebackAmount':_0x4b49a7[_0x44d198(0x160)],'statusChangedBy':_0x4b49a7['statusChangedBy'],'statusChangedAt':_0x4b49a7['statusChangedAt'],'createdAt':_0x4b49a7['createdAt'],'updatedAt':_0x4b49a7['updatedAt'],'shop':_0x4b49a7[_0x44d198(0x1b3)]};}async['updateUser'](_0x418c75,_0x5d7a64){const _0x3f5de8=a35_0x3d81be,_0x3d2a58={..._0x5d7a64};_0x5d7a64[_0x3f5de8(0x225)]&&(_0x3d2a58[_0x3f5de8(0x225)]=await bcryptjs_1[_0x3f5de8(0x1c2)]['hash'](_0x5d7a64[_0x3f5de8(0x225)],0xc));_0x5d7a64[_0x3f5de8(0x1b4)]&&(_0x3d2a58[_0x3f5de8(0x22d)]=_0x5d7a64[_0x3f5de8(0x1b4)],delete _0x3d2a58[_0x3f5de8(0x1b4)]);_0x5d7a64[_0x3f5de8(0x1a4)]&&(_0x3d2a58[_0x3f5de8(0x165)]=_0x5d7a64[_0x3f5de8(0x1a4)],delete _0x3d2a58[_0x3f5de8(0x1a4)]);_0x5d7a64['merchantUrl']&&(_0x3d2a58['shopUrl']=_0x5d7a64['merchantUrl'],delete _0x3d2a58[_0x3f5de8(0x14f)]);if(_0x5d7a64[_0x3f5de8(0x162)]){const _0x2e1285=_0x5d7a64[_0x3f5de8(0x162)][_0x3f5de8(0x202)](_0x1e9157=>this[_0x3f5de8(0x21c)](_0x1e9157));console[_0x3f5de8(0x209)](_0x3f5de8(0x1de),_0x5d7a64[_0x3f5de8(0x162)],'->',_0x2e1285),_0x3d2a58[_0x3f5de8(0x1b5)]=JSON['stringify'](_0x2e1285),delete _0x3d2a58[_0x3f5de8(0x162)];}_0x5d7a64['gatewaySettings']&&(console[_0x3f5de8(0x209)](_0x3f5de8(0x14c),_0x5d7a64['gatewaySettings']),_0x3d2a58[_0x3f5de8(0x1ce)]=JSON['stringify'](_0x5d7a64[_0x3f5de8(0x1ce)]),console['log'](_0x3f5de8(0x170),_0x3d2a58[_0x3f5de8(0x1ce)]),delete _0x3d2a58[_0x3f5de8(0x1ce)]);_0x5d7a64[_0x3f5de8(0x1d3)]&&(_0x5d7a64[_0x3f5de8(0x1d3)][_0x3f5de8(0x1db)]!==undefined&&(_0x3d2a58[_0x3f5de8(0x1db)]=_0x5d7a64[_0x3f5de8(0x1d3)][_0x3f5de8(0x1db)]||null),_0x5d7a64['wallets'][_0x3f5de8(0x1d6)]!==undefined&&(_0x3d2a58[_0x3f5de8(0x1d6)]=_0x5d7a64[_0x3f5de8(0x1d3)][_0x3f5de8(0x1d6)]||null),_0x5d7a64[_0x3f5de8(0x1d3)]['usdtErcWallet']!==undefined&&(_0x3d2a58[_0x3f5de8(0x20e)]=_0x5d7a64[_0x3f5de8(0x1d3)]['usdtErcWallet']||null),_0x5d7a64['wallets']['usdcPolygonWallet']!==undefined&&(_0x3d2a58[_0x3f5de8(0x208)]=_0x5d7a64[_0x3f5de8(0x1d3)][_0x3f5de8(0x208)]||null),delete _0x3d2a58[_0x3f5de8(0x1d3)]);const _0x426146=await database_1['default'][_0x3f5de8(0x1b3)][_0x3f5de8(0x19c)]({'where':{'id':_0x418c75},'data':_0x3d2a58,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x426146['id'],'fullName':_0x426146[_0x3f5de8(0x22d)],'username':_0x426146['username'],'telegramId':_0x426146['telegram'],'merchantUrl':_0x426146[_0x3f5de8(0x126)],'gateways':_0x426146[_0x3f5de8(0x1b5)]?JSON[_0x3f5de8(0x22a)](_0x426146[_0x3f5de8(0x1b5)]):null,'gatewaySettings':_0x426146[_0x3f5de8(0x1ce)]?JSON[_0x3f5de8(0x22a)](_0x426146[_0x3f5de8(0x1ce)]):null,'publicKey':_0x426146[_0x3f5de8(0x1a0)],'wallets':{'usdtPolygonWallet':_0x426146[_0x3f5de8(0x1db)],'usdtTrcWallet':_0x426146['usdtTrcWallet'],'usdtErcWallet':_0x426146[_0x3f5de8(0x20e)],'usdcPolygonWallet':_0x426146[_0x3f5de8(0x208)]},'status':_0x426146[_0x3f5de8(0x127)],'createdAt':_0x426146['createdAt']};}async['suspendUser'](_0x571e8b){const _0x4c1ada=a35_0x3d81be,_0x347413=await database_1[_0x4c1ada(0x1c2)]['shop'][_0x4c1ada(0x19c)]({'where':{'id':_0x571e8b},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x347413['id'],'fullName':_0x347413[_0x4c1ada(0x22d)],'username':_0x347413['username'],'telegramId':_0x347413[_0x4c1ada(0x165)],'merchantUrl':_0x347413['shopUrl'],'gateways':_0x347413[_0x4c1ada(0x1b5)]?JSON[_0x4c1ada(0x22a)](_0x347413[_0x4c1ada(0x1b5)]):null,'gatewaySettings':_0x347413[_0x4c1ada(0x1ce)]?JSON[_0x4c1ada(0x22a)](_0x347413['gatewaySettings']):null,'publicKey':_0x347413[_0x4c1ada(0x1a0)],'wallets':{'usdtPolygonWallet':_0x347413[_0x4c1ada(0x1db)],'usdtTrcWallet':_0x347413[_0x4c1ada(0x1d6)],'usdtErcWallet':_0x347413[_0x4c1ada(0x20e)],'usdcPolygonWallet':_0x347413[_0x4c1ada(0x208)]},'status':_0x347413[_0x4c1ada(0x127)],'createdAt':_0x347413[_0x4c1ada(0x1b8)]};}async[a35_0x3d81be(0x1f0)](_0x2d94c5){const _0xfd2129=a35_0x3d81be,_0x17dc1b=await database_1[_0xfd2129(0x1c2)]['shop'][_0xfd2129(0x19c)]({'where':{'id':_0x2d94c5},'data':{'status':_0xfd2129(0x145)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x17dc1b['id'],'fullName':_0x17dc1b[_0xfd2129(0x22d)],'username':_0x17dc1b[_0xfd2129(0x1cb)],'telegramId':_0x17dc1b[_0xfd2129(0x165)],'merchantUrl':_0x17dc1b[_0xfd2129(0x126)],'gateways':_0x17dc1b[_0xfd2129(0x1b5)]?JSON[_0xfd2129(0x22a)](_0x17dc1b['paymentGateways']):null,'gatewaySettings':_0x17dc1b[_0xfd2129(0x1ce)]?JSON[_0xfd2129(0x22a)](_0x17dc1b[_0xfd2129(0x1ce)]):null,'publicKey':_0x17dc1b[_0xfd2129(0x1a0)],'wallets':{'usdtPolygonWallet':_0x17dc1b['usdtPolygonWallet'],'usdtTrcWallet':_0x17dc1b[_0xfd2129(0x1d6)],'usdtErcWallet':_0x17dc1b[_0xfd2129(0x20e)],'usdcPolygonWallet':_0x17dc1b[_0xfd2129(0x208)]},'status':_0x17dc1b[_0xfd2129(0x127)],'createdAt':_0x17dc1b[_0xfd2129(0x1b8)]};}async['getAllUsers'](_0x29ad2b){const _0x4a98a2=a35_0x3d81be,{page:_0x3abdcc,limit:_0x51fbd5,status:_0xcb4a80}=_0x29ad2b,_0x2234b0=(_0x3abdcc-0x1)*_0x51fbd5,_0x5b73d7={};_0xcb4a80&&(_0x5b73d7[_0x4a98a2(0x127)]=_0xcb4a80[_0x4a98a2(0x1cd)]());const [_0xd7cc2f,_0x13924f]=await Promise[_0x4a98a2(0x179)]([database_1['default'][_0x4a98a2(0x1b3)][_0x4a98a2(0x128)]({'where':_0x5b73d7,'skip':_0x2234b0,'take':_0x51fbd5,'orderBy':{'createdAt':_0x4a98a2(0x186)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop']['count']({'where':_0x5b73d7})]);return{'users':_0xd7cc2f[_0x4a98a2(0x202)](_0x4cc03e=>{const _0x1ba0b9=_0x4a98a2,_0x4fd4e1=_0x4cc03e['paymentGateways']?JSON[_0x1ba0b9(0x22a)](_0x4cc03e[_0x1ba0b9(0x1b5)]):null,_0x428e3e=_0x4fd4e1?_0x4fd4e1[_0x1ba0b9(0x202)](_0x5bc40f=>this[_0x1ba0b9(0x178)](_0x5bc40f)):null;return{'id':_0x4cc03e['id'],'fullName':_0x4cc03e[_0x1ba0b9(0x22d)],'username':_0x4cc03e[_0x1ba0b9(0x1cb)],'telegramId':_0x4cc03e[_0x1ba0b9(0x165)],'merchantUrl':_0x4cc03e[_0x1ba0b9(0x126)],'gateways':_0x428e3e,'gatewaySettings':_0x4cc03e[_0x1ba0b9(0x1ce)]?JSON['parse'](_0x4cc03e['gatewaySettings']):null,'publicKey':_0x4cc03e[_0x1ba0b9(0x1a0)],'wallets':{'usdtPolygonWallet':_0x4cc03e[_0x1ba0b9(0x1db)],'usdtTrcWallet':_0x4cc03e['usdtTrcWallet'],'usdtErcWallet':_0x4cc03e['usdtErcWallet'],'usdcPolygonWallet':_0x4cc03e[_0x1ba0b9(0x208)]},'status':_0x4cc03e[_0x1ba0b9(0x127)],'createdAt':_0x4cc03e[_0x1ba0b9(0x1b8)]};}),'pagination':{'page':_0x3abdcc,'limit':_0x51fbd5,'total':_0x13924f,'totalPages':Math[_0x4a98a2(0x194)](_0x13924f/_0x51fbd5)}};}async[a35_0x3d81be(0x16f)](_0x3d72a1){const _0x500654=a35_0x3d81be,_0x104294=await database_1[_0x500654(0x1c2)][_0x500654(0x1b3)]['findUnique']({'where':{'id':_0x3d72a1},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x104294)return null;const _0x53da43=_0x104294['paymentGateways']?JSON[_0x500654(0x22a)](_0x104294['paymentGateways']):null,_0x3807d2=_0x53da43?_0x53da43[_0x500654(0x202)](_0x58cb69=>this['getGatewayDisplayName'](_0x58cb69)):null;return _0x53da43&&_0x3807d2&&console['log']('üîÑ\x20Gateway\x20mapping\x20(get):',_0x53da43,'->',_0x3807d2),{'id':_0x104294['id'],'fullName':_0x104294[_0x500654(0x22d)],'username':_0x104294[_0x500654(0x1cb)],'telegramId':_0x104294['telegram'],'merchantUrl':_0x104294['shopUrl'],'gateways':_0x3807d2,'gatewaySettings':_0x104294[_0x500654(0x1ce)]?JSON['parse'](_0x104294[_0x500654(0x1ce)]):null,'publicKey':_0x104294['publicKey'],'wallets':{'usdtPolygonWallet':_0x104294['usdtPolygonWallet'],'usdtTrcWallet':_0x104294['usdtTrcWallet'],'usdtErcWallet':_0x104294[_0x500654(0x20e)],'usdcPolygonWallet':_0x104294[_0x500654(0x208)]},'status':_0x104294[_0x500654(0x127)],'createdAt':_0x104294[_0x500654(0x1b8)]};}async[a35_0x3d81be(0x118)](_0x1c32d9){const _0x6808f3=a35_0x3d81be,{fullName:_0x3381dd,username:_0x40f16b,password:_0x336908,telegramId:_0x538fc1,merchantUrl:_0x3572c4,gateways:_0xe5a39f,gatewaySettings:_0x42a053,wallets:_0x123c08}=_0x1c32d9,_0x26ef4d=await database_1[_0x6808f3(0x1c2)]['shop'][_0x6808f3(0x1d0)]({'where':{'username':_0x40f16b}});if(_0x26ef4d)throw new Error(_0x6808f3(0x192));if(_0x538fc1){const _0x3938c0=await database_1[_0x6808f3(0x1c2)][_0x6808f3(0x1b3)][_0x6808f3(0x1d0)]({'where':{'telegram':_0x538fc1}});if(_0x3938c0)throw new Error(_0x6808f3(0x18f));}const _0x187978=await bcryptjs_1[_0x6808f3(0x1c2)][_0x6808f3(0x1a6)](_0x336908,0xc),_0x29e02a=_0x6808f3(0x1d2)+crypto_1[_0x6808f3(0x1c2)]['randomBytes'](0x20)[_0x6808f3(0x212)](_0x6808f3(0x1a3)),_0x523458=_0x6808f3(0x1ec)+crypto_1[_0x6808f3(0x1c2)][_0x6808f3(0x1d4)](0x20)[_0x6808f3(0x212)](_0x6808f3(0x1a3)),_0x1eab3a=_0xe5a39f?_0xe5a39f['map'](_0x193908=>this[_0x6808f3(0x21c)](_0x193908)):null;_0xe5a39f&&_0x1eab3a&&console[_0x6808f3(0x209)]('üîÑ\x20Gateway\x20mapping\x20(create):',_0xe5a39f,'->',_0x1eab3a);const _0x3ce2c9=await database_1[_0x6808f3(0x1c2)][_0x6808f3(0x1b3)][_0x6808f3(0x167)]({'data':{'name':_0x3381dd,'username':_0x40f16b,'password':_0x187978,'telegram':_0x538fc1,'shopUrl':_0x3572c4,'paymentGateways':_0x1eab3a?JSON[_0x6808f3(0x1e6)](_0x1eab3a):null,'gatewaySettings':_0x42a053?JSON[_0x6808f3(0x1e6)](_0x42a053):null,'usdtPolygonWallet':_0x123c08?.[_0x6808f3(0x1db)]||null,'usdtTrcWallet':_0x123c08?.[_0x6808f3(0x1d6)]||null,'usdtErcWallet':_0x123c08?.[_0x6808f3(0x20e)]||null,'usdcPolygonWallet':_0x123c08?.[_0x6808f3(0x208)]||null,'publicKey':_0x29e02a,'secretKey':_0x523458,'status':_0x6808f3(0x145)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3ce2c9['id'],'fullName':_0x3ce2c9[_0x6808f3(0x22d)],'username':_0x3ce2c9['username'],'telegramId':_0x3ce2c9[_0x6808f3(0x165)],'merchantUrl':_0x3ce2c9['shopUrl'],'gateways':_0x3ce2c9[_0x6808f3(0x1b5)]?JSON[_0x6808f3(0x22a)](_0x3ce2c9['paymentGateways']):null,'gatewaySettings':_0x3ce2c9[_0x6808f3(0x1ce)]?JSON['parse'](_0x3ce2c9['gatewaySettings']):null,'publicKey':_0x3ce2c9[_0x6808f3(0x1a0)],'wallets':{'usdtPolygonWallet':_0x3ce2c9[_0x6808f3(0x1db)],'usdtTrcWallet':_0x3ce2c9[_0x6808f3(0x1d6)],'usdtErcWallet':_0x3ce2c9[_0x6808f3(0x20e)],'usdcPolygonWallet':_0x3ce2c9['usdcPolygonWallet']},'status':_0x3ce2c9[_0x6808f3(0x127)],'createdAt':_0x3ce2c9[_0x6808f3(0x1b8)]};}async[a35_0x3d81be(0x218)](_0x397d5a){const _0x6ed8fa=a35_0x3d81be;await database_1['default'][_0x6ed8fa(0x1b3)][_0x6ed8fa(0x18a)]({'where':{'id':_0x397d5a}});}[a35_0x3d81be(0x207)](_0x15fbd1,_0x10cc0f,_0x1c741c){const _0x5b6bcb=a35_0x3d81be,_0x4d1ec7=new Map(),_0x3d9c04=new Date(_0x10cc0f);while(_0x3d9c04<=_0x1c741c){const _0x362161=_0x3d9c04[_0x5b6bcb(0x143)]()[_0x5b6bcb(0x139)]('T')[0x0];_0x4d1ec7[_0x5b6bcb(0x17b)](_0x362161,{'revenue':0x0,'count':0x0}),_0x3d9c04[_0x5b6bcb(0x1fe)](_0x3d9c04[_0x5b6bcb(0x226)]()+0x1);}for(const _0x38221c of _0x15fbd1){const _0x42004c=_0x38221c[_0x5b6bcb(0x1b8)][_0x5b6bcb(0x143)]()[_0x5b6bcb(0x139)]('T')[0x0],_0x32afa8=_0x4d1ec7['get'](_0x42004c);_0x32afa8&&(_0x32afa8[_0x5b6bcb(0x20d)]+=0x1,_0x38221c['status']==='PAID'&&(_0x38221c[_0x5b6bcb(0x114)]?_0x32afa8[_0x5b6bcb(0x1c5)]+=_0x38221c[_0x5b6bcb(0x114)]:console['log']('‚ö†Ô∏è\x20Payment\x20'+_0x38221c['id']+_0x5b6bcb(0x228))));}const _0x42f4f7=[],_0xefb174=[];for(const [_0x58884c,_0x298925]of _0x4d1ec7){_0x42f4f7[_0x5b6bcb(0x1d7)]({'date':_0x58884c,'amount':Math['round'](_0x298925[_0x5b6bcb(0x1c5)]*0x64)/0x64}),_0xefb174[_0x5b6bcb(0x1d7)]({'date':_0x58884c,'count':_0x298925['count']});}return{'dailyRevenue':_0x42f4f7,'dailyPayments':_0xefb174};}}exports[a35_0x3d81be(0x18e)]=AdminService;