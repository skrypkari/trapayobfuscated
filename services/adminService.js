'use strict';const a53_0x19793e=a53_0x2238;function a53_0x4816(){const _0x43dace=['join','cointopay','amountUSDT','‚ö†Ô∏è\x20Gateway\x20\x27','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','../types/gateway',',\x20userId:\x20','findFirst','all_time','totalAmount','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','telegramId','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','totalAmountUSDT','shopUrl','compare','KLYME\x20GB','thisMonth','\x20\x20\x20Balance:\x20','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','depositBalance','generateDailyStatistics','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','\x20merchants\x20for\x20selection','%\x20from\x20','\x20USDT,\x20Difference:\x20','findUnique','suspendUser','PAID','üîç\x20Selected\x20trc20\x20wallet:\x20','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','network','üí∞\x20Found\x20','\x20USDT,\x20Requested:\x20','Insufficient\x20balance.\x20Available:\x20','ru-RU','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','min','usdtPolygonWallet','fullName','\x20\x20\x20üí∞\x20Total\x20payout:\x20','\x20USDT\x20(','merchantEarnings','üìä\x20Getting\x20payout\x20reports\x20with\x20filters:','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','toFixed','\x20\x20\x20Payout\x20amount:\x20','base32','desc','194164iEGPaA',',\x20refunds:\x20','REFUND','getPayoutReports','\x20\x20\x20Merchant\x20gets:\x20','includes','sk_','all','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','UTC','üìÖ\x20Period:\x20','CHARGEBACK','statusChangedAt','üéØ\x20[','merchantName','stringify','cointopay2','dailyRevenue','week','getMonth','sendPayoutNotification','\x27\x20->\x20name\x20\x27','usdtTrcWallet','\x20USDT\x20(gross\x20revenue)','üîß\x20[','ADMIN_2FA_ENABLED=true','customerUa','\x27\x20to\x20name\x20\x27','\x20\x20\x20Transaction\x20hash:\x20','\x20updated\x20successfully','2FA\x20token\x20is\x20required','\x20\x20\x20Merchant\x20loses:\x20','balance','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','polygon_usdc','gatewayCommissionRate','commissionUSDT','amountAfterCommissionUSDT','amount','TrapaPay\x20Admin','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','admin','1594232KmSxyn','üìä\x20Generated\x20reports\x20for\x20','usdtErcWallet','telegram','üîÑ\x20Gateway\x20mapping\x20(get):','abs','getAllPayments','üìä\x20Statistics\x20date\x20range:\x20','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','ADMIN_BACKUP_CODES=','periodTo','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','TrapaPay\x20Admin\x20(','reduce','\x20\x20\x20Tolerance:\x20','getGatewayDisplayName',',\x20chargebacks:\x20','\x20\x20\x20Available\x20(raw):\x20','../config/database','totalPaidOut','createdAt','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','pendingPayout','wallet','.env','currencyService','findMany','getPayoutById','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','\x20backup\x20codes','\x20became\x20PAID:','deletePayout','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','Payout\x20not\x20found','merchantId','revenue','getTime','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x20USDT\x20(-','shop','Visa/MasterCard','split','\x20USDT,\x20Required:\x20','dateFrom','splice','üîÑ\x20Converted\x20gateway\x20name\x20\x27','\x20USDT\x20(+','today','‚úÖ\x20Payout\x20','üîê\x20Admin\x202FA\x20enabled','erc20','customerName','SquirrelPay','_count','üîê\x20Admin\x20password\x20changed\x20successfully','\x20payments)','3197850rkdxYu','\x20USDT\x20(after\x20','getUTCDay','Payment\x20not\x20found','2020-01-01','getGatewayInternalName','whiteUrl','ADMIN_2FA_ENABLED=','üîê\x20Admin\x202FA\x20disabled','paymentsCount','\x20\x20\x20Shop\x20balance:\x20','toISOString','custom_','üí∞\x20Shop\x20','update','paidAt','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','password','pk_','toLowerCase','üí∞\x20Updating\x20payout\x20','üîê\x20Admin\x202FA\x20setup\x20initiated','customerEmail','verify','plisio','warn','otpauth_url','üîÑ\x20Admin\x20updating\x20payment\x20','561354XKlYoy','aggregate','log','9XtPWNM','Username\x20already\x20exists','existsSync','üîê\x20[','üí∞\x20Creating\x20payout\x20for\x20shop\x20','CRYPTO','\x20USDT\x20(current\x20balance\x20in\x20DB)','toLocaleDateString','replace','gte','totalPayout','üîç\x20Selected\x20erc20\x20wallet:\x20','\x20\x20\x20Current\x20network:\x20','updatedAt','toString','‚úÖ\x20Payout\x20created:\x20','\x20\x20\x20Amount\x20increased\x20by\x20','‚ö†Ô∏è\x20Payment\x20','entries','USDT','paidOutUSDT','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','averageCheckUSDT','this_week','üîç\x20Selected\x20polygon\x20wallet:\x20','totalAmountAfterCommissionUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','period','\x20\x20\x20Requested\x20(number):\x20','setUTCDate','floor','push','setup2FA','turnoverUSDT','KLYME\x20DE','disable2FA','\x20\x20\x20ü§î\x20Difference:\x20','NONEXISTENT_GATEWAY_FILTER','Amer','getUTCDate','üîç\x20Total\x20payments\x20matching\x20filters:\x20','randomBytes','Plisio','usdcPolygonWallet','rapyd','hex','\x20with\x20payout\x20history','forEach','\x20\x20\x20üí≥\x20Total\x20payments:\x20','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','get','gateways','txid','date','__importDefault','paymentGateways','merchantUrl','üìä\x20Calculating\x20payout\x20statistics...','not\x20set','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','insensitive','name','cwd','ceil','year','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','AmPay','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20Difference:\x20','startsWith','backupCodes','payout','last_week','Shop\x20not\x20found','getGatewayIdByName','\x20USDT,\x20merchant:\x20','updatePayout','payment','successUrl','customerIp','periodFrom','telegramBotService','getDate','polygon','createPayout','81681wJDPYh','amountAfterGatewayCommissionUSDT','__esModule','pendingUrl','asc','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','twoFactorEnabled','delete','getUTCFullYear','\x20USDC\x20to\x20merchant\x20','orderId',':\x20commission\x20=\x20','toUpperCase','\x20merchants','test_gateway','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','gatewayEarnings','üìä\x20Statistics\x20PAID\x20payments\x20count:\x20','enableAdmin2FA','crypto','map','noda','üí±\x20Currency\x20filter\x20applied:\x20','\x20USDT\x20-\x20will\x20return\x20to\x20balance','adminNotes','üìä\x20Statistics\x20WHERE\x20conditions:','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','COMPLETED','USDC','_sum','status','2FA\x20is\x20already\x20enabled','üîç\x20Creating\x20payout\x20with\x20data:','6cGqxgp','length','convertToUSDT','\x20\x20\x20Shop\x20totalPaidOut:\x20','241275aomOFs','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','EXPIRED','custom','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','count','\x20\x20\x20üåê\x20IP:\x20','‚úÖ\x20Deposited\x20','changeAdminPassword','üîç\x20Initial\x20wallet\x20from\x20request:\x20','üìä\x20Merchant\x20statistics\x20calculated:','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','totalCommissionRate','trc20','../config/config','\x20\x20\x20üåç\x20Country:\x20','passwordHash','Merchant\x20not\x20found','ADMIN_2FA_SECRET=','\x20USDT\x20(theoretical\x20net)','üîç\x20Shop\x20wallets:','getMerchantsSelection','erc20_usdc','hash','config','set','\x20PAID\x20payments','\x20\x20\x20Gateway:\x20','Current\x20password\x20is\x20incorrect','averageCommissionRate','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','getUTCMonth','default','substr','totalPayments','slice','sort','error','$transaction','wallets','toDataURL','üîå\x20Gateway:\x20','speakeasy','random','usdcErcWallet','failUrl','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','üí∞\x20[PAYOUT]\x20Gateway\x20','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','getPayoutStats','getUserById','totp','groupBy','enable2FA','commission','path',',\x20successful:\x20','ACTIVE','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','qrcode','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','klyme_de','username','yesterday','failureMessage','\x20USDT','PENDING','üìÖ\x20Date\x20to\x20filter:\x20','CoinToPay2','\x20\x20\x20üíµ\x20Available\x20balance:\x20','lte','last_month','has','chargebackAmount','createUser','lastLoginAt','round','getPaymentById','KLYME\x20EU','localeCompare','Sepa','0000','generateSecret','writeFileSync','klyme_eu','gateway','Test\x20Gateway','\x20\x20\x20Current\x20amount:\x20','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','getSystemStatistics','%\x20commission)','\x20for\x20shop\x20','parse','\x27\x20->\x20ID\x20\x27','AdminService',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','üîÑ\x20Gateway\x20mapping\x20(create):','CoinToPay','\x20\x20\x20Full\x20amount:\x20','payouts','Invalid\x202FA\x20token\x20or\x20backup\x20code','üîê\x202FA\x20disabled\x20for\x20shop:\x20','\x20->\x20','not\x20specified','\x27\x20(from\x20\x27','InstaXchange','values','Error\x20parsing\x20backup\x20codes:','Error\x20processing\x20payment\x20','Invalid\x202FA\x20token','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','readFileSync','\x20paid\x20payments\x20for\x20analysis','211448CTHOKV','currency','üîë\x20Generated\x20','ADMIN_PASSWORD_HASH=','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','./currencyService','üìä\x20Getting\x20payments\x20with\x20filters:','twoFactorSecret','create','generateBackupCodes','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','gatewayOrderId','üìã\x20Getting\x20merchants\x20selection\x20list...','gatewaySettings','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','Rapyd','7NEqRMW','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','get2FASettings','Deposit','merchantEarningsUSDT','\x20status:\x20','OnRamp','getFullYear','getMerchantsAwaitingPayout','setHours','totalTurnover','deleteUser','üìä\x20Final\x20WHERE\x20conditions:','üìã\x20Found\x20','‚úÖ\x20Payout\x20created\x20in\x20DB:','dailyPayments','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','\x20to\x20','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20balance\x20updated:\x20','dateTo','getMerchantStatistics','customerCountry','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','SUSPENDED','notes','üí∞\x20[PAYOUT]\x20Merchant\x20','shopId','turnover','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','mastercard','utf8','publicKey'];a53_0x4816=function(){return _0x43dace;};return a53_0x4816();}(function(_0x664f99,_0x3fef35){const _0x26306c=a53_0x2238,_0x4b4129=_0x664f99();while(!![]){try{const _0x50dd2b=-parseInt(_0x26306c(0x1fd))/0x1+-parseInt(_0x26306c(0x2f6))/0x2*(-parseInt(_0x26306c(0x2d4))/0x3)+parseInt(_0x26306c(0x197))/0x4+-parseInt(_0x26306c(0x2fa))/0x5+parseInt(_0x26306c(0x27c))/0x6+-parseInt(_0x26306c(0x1a7))/0x7*(parseInt(_0x26306c(0x227))/0x8)+parseInt(_0x26306c(0x27f))/0x9*(parseInt(_0x26306c(0x260))/0xa);if(_0x50dd2b===_0x3fef35)break;else _0x4b4129['push'](_0x4b4129['shift']());}catch(_0x459190){_0x4b4129['push'](_0x4b4129['shift']());}}}(a53_0x4816,0x19ecd));function a53_0x2238(_0x2fc8c8,_0x3ddfa9){_0x2fc8c8=_0x2fc8c8-0x17a;const _0x481651=a53_0x4816();let _0x2238e4=_0x481651[_0x2fc8c8];return _0x2238e4;}var __importDefault=this&&this[a53_0x19793e(0x2b5)]||function(_0x542e1f){const _0x3bb5bb=a53_0x19793e;return _0x542e1f&&_0x542e1f[_0x3bb5bb(0x2d6)]?_0x542e1f:{'default':_0x542e1f};};Object['defineProperty'](exports,a53_0x19793e(0x2d6),{'value':!![]}),exports[a53_0x19793e(0x184)]=void 0x0;const database_1=__importDefault(require(a53_0x19793e(0x239))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x19793e(0x2e8))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x19793e(0x332))),speakeasy_1=__importDefault(require(a53_0x19793e(0x325))),qrcode_1=__importDefault(require(a53_0x19793e(0x336))),config_1=require(a53_0x19793e(0x308)),currencyService_1=require(a53_0x19793e(0x19c)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a53_0x19793e(0x1d0));class AdminService{async[a53_0x19793e(0x32c)](){const _0x549124=a53_0x19793e;console[_0x549124(0x27e)](_0x549124(0x2b8));const _0x42d887=await database_1[_0x549124(0x31b)][_0x549124(0x24f)][_0x549124(0x27d)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x2f2a53=await database_1['default'][_0x549124(0x2cc)][_0x549124(0x2ff)]({'where':{'status':_0x549124(0x1e7),'gateway':{'not':'test_gateway'}}}),_0x34f17a=new Date(),_0x38af2f=new Date(_0x34f17a['getFullYear'](),_0x34f17a['getMonth'](),0x1),_0x3b9496=new Date(_0x34f17a[_0x549124(0x1b0)](),_0x34f17a[_0x549124(0x210)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5c7bef=await database_1[_0x549124(0x31b)][_0x549124(0x2c6)][_0x549124(0x27d)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x38af2f,'lte':_0x3b9496},'status':'COMPLETED'}}),_0x126032=_0x42d887['_sum'][_0x549124(0x23a)]||0x0,_0x285548=_0x42d887[_0x549124(0x2f2)]['balance']||0x0,_0x35b687=_0x5c7bef[_0x549124(0x2f2)][_0x549124(0x223)]||0x0,_0x18201d={'totalPayout':Math['round'](_0x126032*0x64)/0x64,'awaitingPayout':Math[_0x549124(0x348)](_0x285548*0x64)/0x64,'thisMonth':Math['round'](_0x35b687*0x64)/0x64,'availableBalance':Math['round'](_0x285548*0x64)/0x64,'totalPayments':_0x2f2a53};return console[_0x549124(0x27e)]('üìä\x20Payout\x20statistics\x20calculated:'),console[_0x549124(0x27e)](_0x549124(0x1f4)+_0x18201d[_0x549124(0x289)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x549124(0x27e)](_0x549124(0x1c0)+_0x18201d['awaitingPayout']+_0x549124(0x1a9)),console[_0x549124(0x27e)](_0x549124(0x341)+_0x18201d['availableBalance']+_0x549124(0x2c2)),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x18201d[_0x549124(0x1dc)]+_0x549124(0x33d)),console[_0x549124(0x27e)](_0x549124(0x2af)+_0x18201d[_0x549124(0x31d)]+_0x549124(0x314)),_0x18201d;}async['updateCustomerData'](_0x42e26c,_0x402144){const _0x20503e=a53_0x19793e;console[_0x20503e(0x27e)](_0x20503e(0x194)+_0x42e26c+':',_0x402144);const _0x52460f=await database_1[_0x20503e(0x31b)][_0x20503e(0x2cc)]['findUnique']({'where':{'id':_0x42e26c},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x52460f)throw new Error(_0x20503e(0x263));const _0x5a6ee4={};_0x402144[_0x20503e(0x1bf)]!==undefined&&(_0x5a6ee4[_0x20503e(0x1bf)]=_0x402144[_0x20503e(0x1bf)]||null);_0x402144[_0x20503e(0x2ce)]!==undefined&&(_0x5a6ee4['customerIp']=_0x402144['customerIp']||null);_0x402144['customerUa']!==undefined&&(_0x5a6ee4[_0x20503e(0x217)]=_0x402144['customerUa']||null);const _0x2007a0=await database_1[_0x20503e(0x31b)][_0x20503e(0x2cc)][_0x20503e(0x26e)]({'where':{'id':_0x42e26c},'data':{..._0x5a6ee4,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x20503e(0x225)+_0x42e26c),console[_0x20503e(0x27e)](_0x20503e(0x309)+_0x52460f[_0x20503e(0x1bf)]+_0x20503e(0x18c)+_0x2007a0[_0x20503e(0x1bf)]),console[_0x20503e(0x27e)](_0x20503e(0x300)+_0x52460f['customerIp']+_0x20503e(0x18c)+_0x2007a0[_0x20503e(0x2ce)]),console['log'](_0x20503e(0x294)+(_0x52460f['customerUa']?'set':_0x20503e(0x2b9))+_0x20503e(0x18c)+(_0x2007a0[_0x20503e(0x217)]?_0x20503e(0x313):_0x20503e(0x2b9))),_0x2007a0;}async[a53_0x19793e(0x17f)](_0x1eca51,_0x1b4ebc){const _0x2197a6=a53_0x19793e,_0x536e4a=_0x1b4ebc?new Date(_0x1b4ebc):new Date();let _0x94dd92,_0x2e2736;if(_0x1eca51[_0x2197a6(0x2c4)]('custom_')){const _0x41cf1f=_0x1eca51[_0x2197a6(0x287)](_0x2197a6(0x26c),'')[_0x2197a6(0x251)]('_');if(_0x41cf1f[_0x2197a6(0x2f7)]===0x2){const _0x555e02=new Date(_0x41cf1f[0x0]),_0x5734c1=new Date(_0x41cf1f[0x1]);_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x555e02[_0x2197a6(0x2dd)](),_0x555e02[_0x2197a6(0x31a)](),_0x555e02['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date[_0x2197a6(0x206)](_0x5734c1['getUTCFullYear'](),_0x5734c1[_0x2197a6(0x31a)](),_0x5734c1[_0x2197a6(0x2a6)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x3dc5f7=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),_0x536e4a[_0x2197a6(0x2a6)]()-0x1e));_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x3dc5f7[_0x2197a6(0x2dd)](),_0x3dc5f7[_0x2197a6(0x31a)](),_0x3dc5f7[_0x2197a6(0x2a6)](),0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date['UTC'](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),_0x536e4a[_0x2197a6(0x2a6)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x1eca51[_0x2197a6(0x273)]()){case _0x2197a6(0x257):_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x536e4a['getUTCFullYear'](),_0x536e4a['getUTCMonth'](),_0x536e4a[_0x2197a6(0x2a6)](),0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),_0x536e4a['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x2197a6(0x33b):const _0x568784=new Date(_0x536e4a);_0x568784['setUTCDate'](_0x568784[_0x2197a6(0x2a6)]()-0x1),_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x568784[_0x2197a6(0x2dd)](),_0x568784['getUTCMonth'](),_0x568784['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date[_0x2197a6(0x206)](_0x568784[_0x2197a6(0x2dd)](),_0x568784[_0x2197a6(0x31a)](),_0x568784['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x2197a6(0x296):const _0x3842cb=_0x536e4a['getUTCDay'](),_0x567b9b=_0x3842cb===0x0?-0x6:0x1-_0x3842cb,_0x3f50ad=_0x536e4a['getUTCDate']()+_0x567b9b;_0x94dd92=new Date(Date['UTC'](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),_0x3f50ad,0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a['getUTCMonth'](),_0x536e4a[_0x2197a6(0x2a6)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2197a6(0x2c7):const _0x62ef1b=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a['getUTCMonth'](),_0x536e4a[_0x2197a6(0x2a6)]()-0x7)),_0x1ae0b0=_0x62ef1b[_0x2197a6(0x262)](),_0x417a22=_0x1ae0b0===0x0?-0x6:0x1-_0x1ae0b0,_0x22c808=_0x62ef1b[_0x2197a6(0x2a6)]()+_0x417a22;_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x62ef1b[_0x2197a6(0x2dd)](),_0x62ef1b[_0x2197a6(0x31a)](),_0x22c808,0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date['UTC'](_0x62ef1b[_0x2197a6(0x2dd)](),_0x62ef1b['getUTCMonth'](),_0x22c808+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),0x1,0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date['UTC'](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),_0x536e4a['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x2197a6(0x343):_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date[_0x2197a6(0x206)](_0x536e4a['getUTCFullYear'](),_0x536e4a[_0x2197a6(0x31a)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2197a6(0x1d3):_0x94dd92=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),_0x536e4a['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x94dd92=new Date(_0x536e4a[_0x2197a6(0x24c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x17c127=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a['getUTCMonth'](),_0x536e4a['getUTCDate']()-0x1e));_0x94dd92=new Date(Date[_0x2197a6(0x206)](_0x17c127[_0x2197a6(0x2dd)](),_0x17c127[_0x2197a6(0x31a)](),_0x17c127[_0x2197a6(0x2a6)](),0x0,0x0,0x0,0x0)),_0x2e2736=new Date(Date[_0x2197a6(0x206)](_0x536e4a[_0x2197a6(0x2dd)](),_0x536e4a[_0x2197a6(0x31a)](),_0x536e4a[_0x2197a6(0x2a6)](),0x17,0x3b,0x3b,0x3e7));}const _0x3229fb={'gte':_0x94dd92,'lte':_0x2e2736};console[_0x2197a6(0x27e)](_0x2197a6(0x22e)+_0x94dd92[_0x2197a6(0x26b)]()+'\x20to\x20'+_0x2e2736[_0x2197a6(0x26b)]());const [_0x8aa74e,_0x45ae23,_0x450e4b,_0xad447d,_0x16a8e8,_0x1eb4e7,_0x227ad8,_0x4c750b,_0x2dc77b]=await Promise['all']([database_1[_0x2197a6(0x31b)]['shop'][_0x2197a6(0x2ff)](),database_1['default'][_0x2197a6(0x24f)]['count']({'where':{'status':_0x2197a6(0x334)}}),database_1[_0x2197a6(0x31b)][_0x2197a6(0x2cc)][_0x2197a6(0x2ff)]({'where':{'status':_0x2197a6(0x1e7),'createdAt':_0x3229fb,'gateway':{'not':_0x2197a6(0x2e3)}}}),database_1[_0x2197a6(0x31b)]['payment']['count']({'where':{'status':_0x2197a6(0x208),'createdAt':_0x3229fb,'gateway':{'not':_0x2197a6(0x2e3)}}}),database_1['default'][_0x2197a6(0x2cc)]['count']({'where':{'status':_0x2197a6(0x1ff),'createdAt':_0x3229fb,'gateway':{'not':_0x2197a6(0x2e3)}}}),database_1['default'][_0x2197a6(0x2cc)][_0x2197a6(0x242)]({'where':{'status':_0x2197a6(0x1e7),'createdAt':_0x3229fb,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x2197a6(0x2cc)][_0x2197a6(0x242)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x2197a6(0x1fc)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2197a6(0x31b)][_0x2197a6(0x2cc)][_0x2197a6(0x242)]({'where':{'createdAt':_0x3229fb,'gateway':{'not':_0x2197a6(0x2e3)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x2197a6(0x31b)][_0x2197a6(0x2cc)]['findMany']({'where':{'status':_0x2197a6(0x1e7),'gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x2197a6(0x27e)](_0x2197a6(0x2e6)+_0x450e4b);let _0x2dde55=0x0,_0x587f6a=0x0;for(const _0x358523 of _0x1eb4e7){const _0x2eb4c6=_0x358523[_0x2197a6(0x1cd)]||0x0;_0x2dde55+=_0x2eb4c6;if(_0x358523[_0x2197a6(0x2d5)]&&_0x358523[_0x2197a6(0x1cd)]){const _0x445e3c=_0x358523[_0x2197a6(0x1cd)]-_0x358523[_0x2197a6(0x2d5)];_0x587f6a+=_0x445e3c;}}let _0x839bd0=0x0;for(const _0x24a35a of _0x2dc77b){if(_0x24a35a['amountAfterGatewayCommissionUSDT']&&_0x24a35a['amountUSDT']){const _0x35164f=_0x24a35a[_0x2197a6(0x1cd)]-_0x24a35a[_0x2197a6(0x2d5)];_0x839bd0+=_0x35164f;}}const _0x307136=_0x450e4b>0x0?_0x2dde55/_0x450e4b:0x0,_0x2a714d=this[_0x2197a6(0x1e0)](_0x4c750b,_0x94dd92,_0x2e2736),_0x140c30=await database_1[_0x2197a6(0x31b)][_0x2197a6(0x2cc)][_0x2197a6(0x2ff)]({'where':{'createdAt':_0x3229fb,'gateway':{'not':_0x2197a6(0x2e3)},'status':{'notIn':[_0x2197a6(0x33e),_0x2197a6(0x2fc)]}}}),_0x19403e=_0x140c30>0x0?_0x450e4b/_0x140c30*0x64:0x0;return{'totalShops':_0x8aa74e,'activeShops':_0x45ae23,'totalPayments':_0x140c30,'successfulPayments':_0x450e4b,'totalAttempts':_0x140c30,'chargebacks':_0xad447d,'refunds':_0x16a8e8,'totalRevenue':Math['round'](_0x2dde55*0x64)/0x64,'trapayEarnings':Math[_0x2197a6(0x348)](_0x587f6a*0x64)/0x64,'trapayEarningsAllTime':Math[_0x2197a6(0x348)](_0x839bd0*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x307136*0x64)/0x64,'conversionRate':Math[_0x2197a6(0x348)](_0x19403e*0x64)/0x64,'dailyRevenue':_0x2a714d[_0x2197a6(0x20e)],'dailyPayments':_0x2a714d[_0x2197a6(0x1b8)],'recentPayments':_0x227ad8[_0x2197a6(0x2e9)](_0x10a8e7=>({'id':_0x10a8e7['id'],'amount':_0x10a8e7['amount'],'currency':_0x10a8e7[_0x2197a6(0x198)],'status':_0x10a8e7[_0x2197a6(0x2f3)],'gateway':_0x10a8e7[_0x2197a6(0x17b)],'shop':_0x10a8e7[_0x2197a6(0x24f)],'createdAt':_0x10a8e7[_0x2197a6(0x23b)]}))};}}async[a53_0x19793e(0x1be)](_0x52e3ac){const _0x186550=a53_0x19793e;console['log'](_0x186550(0x22f),_0x52e3ac);let _0x5cf076,_0x1f5691=new Date();if(_0x52e3ac[_0x186550(0x29a)]===_0x186550(0x2fd)&&_0x52e3ac['dateFrom']&&_0x52e3ac['dateTo']){const _0x7b7f1a=new Date(_0x52e3ac[_0x186550(0x253)]),_0x177515=new Date(_0x52e3ac[_0x186550(0x1bd)]);_0x5cf076=new Date(Date[_0x186550(0x206)](_0x7b7f1a['getUTCFullYear'](),_0x7b7f1a['getUTCMonth'](),_0x7b7f1a[_0x186550(0x2a6)](),0x0,0x0,0x0,0x0)),_0x1f5691=new Date(Date[_0x186550(0x206)](_0x177515[_0x186550(0x2dd)](),_0x177515[_0x186550(0x31a)](),_0x177515[_0x186550(0x2a6)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x2a2d4c=new Date();switch(_0x52e3ac[_0x186550(0x29a)]){case _0x186550(0x20f):_0x5cf076=new Date(_0x2a2d4c[_0x186550(0x24c)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x5cf076['setHours'](0x0,0x0,0x0,0x0),_0x1f5691[_0x186550(0x1b2)](0x17,0x3b,0x3b,0x3e7);break;case'month':_0x5cf076=new Date(Date['UTC'](_0x2a2d4c[_0x186550(0x2dd)](),_0x2a2d4c['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x1f5691=new Date(Date[_0x186550(0x206)](_0x2a2d4c[_0x186550(0x2dd)](),_0x2a2d4c[_0x186550(0x31a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case'lastMonth':_0x5cf076=new Date(Date[_0x186550(0x206)](_0x2a2d4c[_0x186550(0x2dd)](),_0x2a2d4c[_0x186550(0x31a)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1f5691=new Date(Date[_0x186550(0x206)](_0x2a2d4c[_0x186550(0x2dd)](),_0x2a2d4c[_0x186550(0x31a)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x186550(0x2bf):_0x5cf076=new Date(_0x2a2d4c[_0x186550(0x24c)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x5cf076['setHours'](0x0,0x0,0x0,0x0),_0x1f5691[_0x186550(0x1b2)](0x17,0x3b,0x3b,0x3e7);break;case _0x186550(0x204):default:_0x5cf076=new Date(_0x186550(0x264)),_0x5cf076[_0x186550(0x1b2)](0x0,0x0,0x0,0x0),_0x1f5691[_0x186550(0x1b2)](0x17,0x3b,0x3b,0x3e7);break;}}console['log'](_0x186550(0x207)+_0x5cf076[_0x186550(0x26b)]()+_0x186550(0x1ba)+_0x1f5691[_0x186550(0x26b)]());const _0x30a148={'status':_0x186550(0x1e7),'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x5cf076,'lte':_0x1f5691}};_0x52e3ac[_0x186550(0x1c5)]&&(_0x30a148[_0x186550(0x1c5)]=_0x52e3ac[_0x186550(0x1c5)]);const _0x4c3b46=await database_1[_0x186550(0x31b)][_0x186550(0x2cc)][_0x186550(0x242)]({'where':_0x30a148,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x186550(0x1eb)+_0x4c3b46['length']+_0x186550(0x196));const _0x1fce98={'gateway':{'not':_0x186550(0x2e3)},'status':{'notIn':['PENDING',_0x186550(0x2fc)]},'createdAt':{'gte':_0x5cf076,'lte':_0x1f5691}};_0x52e3ac[_0x186550(0x1c5)]&&(_0x1fce98[_0x186550(0x1c5)]=_0x52e3ac[_0x186550(0x1c5)]);const _0xc6f5f8=await database_1[_0x186550(0x31b)][_0x186550(0x2cc)][_0x186550(0x2ff)]({'where':_0x1fce98}),_0x427073={..._0x1fce98,'status':'CHARGEBACK'},_0x4c20c6={..._0x1fce98,'status':_0x186550(0x1ff)},[_0x2eda95,_0x3b3d51]=await Promise[_0x186550(0x204)]([database_1[_0x186550(0x31b)][_0x186550(0x2cc)]['count']({'where':_0x427073}),database_1[_0x186550(0x31b)][_0x186550(0x2cc)][_0x186550(0x2ff)]({'where':_0x4c20c6})]);console[_0x186550(0x27e)](_0x186550(0x2da)+_0xc6f5f8+_0x186550(0x333)+_0x4c3b46[_0x186550(0x2f7)]+_0x186550(0x237)+_0x2eda95+_0x186550(0x1fe)+_0x3b3d51);let _0x561c85=0x0,_0x15606e=0x0,_0x42e5f3=0x0;const _0x3ac52b={},_0x3f1a5e={},_0x280ccd={},_0x2ce949=new Date(_0x5cf076);while(_0x2ce949<=_0x1f5691){const _0xf682d5=_0x2ce949[_0x186550(0x26b)]()[_0x186550(0x251)]('T')[0x0];_0x280ccd[_0xf682d5]={'date':_0xf682d5,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x2ce949[_0x186550(0x29c)](_0x2ce949['getUTCDate']()+0x1);}for(const _0x21f6bb of _0x4c3b46){try{const _0x4616cd=_0x21f6bb[_0x186550(0x1cd)]||0x0;if(_0x4616cd<=0x0){console[_0x186550(0x279)]('‚ö†Ô∏è\x20Payment\x20'+_0x21f6bb['id']+_0x186550(0x1b9));continue;}let _0x2c1ea3,_0x7522c5;if(_0x21f6bb[_0x186550(0x2d5)]!==null&&_0x21f6bb[_0x186550(0x2d5)]!==undefined)_0x2c1ea3=_0x21f6bb[_0x186550(0x2d5)],_0x7522c5=_0x4616cd-_0x2c1ea3,console[_0x186550(0x27e)]('üìä\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x21f6bb['id']+':\x20'+_0x4616cd[_0x186550(0x1f9)](0x6)+_0x186550(0x2ca)+_0x2c1ea3[_0x186550(0x1f9)](0x6)+_0x186550(0x33d));else{let _0x1819e1={};if(_0x21f6bb[_0x186550(0x24f)][_0x186550(0x1a4)])try{_0x1819e1=JSON['parse'](_0x21f6bb[_0x186550(0x24f)]['gatewaySettings']);}catch(_0x1257e4){console['error'](_0x186550(0x1a8)+_0x21f6bb['shopId']+':',_0x1257e4);}let _0x4249af=0x2d;for(const [_0x69eb55,_0x202f09]of Object[_0x186550(0x291)](_0x1819e1)){if(_0x69eb55[_0x186550(0x273)]()===_0x21f6bb[_0x186550(0x17b)][_0x186550(0x273)]()){_0x4249af=_0x202f09[_0x186550(0x331)]||0x2d;break;}}_0x7522c5=_0x4616cd*(_0x4249af/0x64),_0x2c1ea3=_0x4616cd-_0x7522c5,console['log'](_0x186550(0x1cf)+_0x21f6bb['id']+':\x20'+_0x4249af+_0x186550(0x1e3)+_0x4616cd[_0x186550(0x1f9)](0x6)+_0x186550(0x33d));}_0x561c85+=_0x4616cd,_0x15606e+=_0x2c1ea3,_0x42e5f3+=_0x7522c5;let _0x223c06;_0x21f6bb[_0x186550(0x220)]!==null&&_0x21f6bb['gatewayCommissionRate']!==undefined?(_0x223c06=_0x21f6bb['gatewayCommissionRate'],console[_0x186550(0x27e)]('üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x21f6bb['id']+':\x20'+_0x223c06+'%')):(_0x223c06=_0x4616cd>0x0?_0x7522c5/_0x4616cd*0x64:0x0,console[_0x186550(0x27e)](_0x186550(0x1c1)+_0x21f6bb['id']+':\x20'+_0x223c06[_0x186550(0x1f9)](0x2)+'%'));!_0x3ac52b[_0x21f6bb[_0x186550(0x17b)]]&&(_0x3ac52b[_0x21f6bb[_0x186550(0x17b)]]={'gateway':_0x21f6bb['gateway'],'gatewayDisplayName':this[_0x186550(0x236)](_0x21f6bb[_0x186550(0x17b)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3ac52b[_0x21f6bb[_0x186550(0x17b)]][_0x186550(0x269)]++,_0x3ac52b[_0x21f6bb['gateway']][_0x186550(0x2a0)]+=_0x4616cd,_0x3ac52b[_0x21f6bb['gateway']][_0x186550(0x221)]+=_0x7522c5,_0x3ac52b[_0x21f6bb[_0x186550(0x17b)]][_0x186550(0x1ad)]+=_0x2c1ea3,_0x3ac52b[_0x21f6bb[_0x186550(0x17b)]][_0x186550(0x306)]+=_0x223c06;!_0x52e3ac['shopId']&&(!_0x3f1a5e[_0x21f6bb[_0x186550(0x1c5)]]&&(_0x3f1a5e[_0x21f6bb[_0x186550(0x1c5)]]={'shopId':_0x21f6bb[_0x186550(0x1c5)],'shopName':_0x21f6bb['shop'][_0x186550(0x2bc)],'shopUsername':_0x21f6bb[_0x186550(0x24f)][_0x186550(0x33a)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3f1a5e[_0x21f6bb[_0x186550(0x1c5)]]['paymentsCount']++,_0x3f1a5e[_0x21f6bb[_0x186550(0x1c5)]][_0x186550(0x2a0)]+=_0x4616cd,_0x3f1a5e[_0x21f6bb[_0x186550(0x1c5)]]['commissionUSDT']+=_0x7522c5,_0x3f1a5e[_0x21f6bb[_0x186550(0x1c5)]][_0x186550(0x1ad)]+=_0x2c1ea3);const _0x24142d=_0x21f6bb['paidAt'][_0x186550(0x26b)]()[_0x186550(0x251)]('T')[0x0];_0x280ccd[_0x24142d]&&(_0x280ccd[_0x24142d]['turnover']+=_0x4616cd,_0x280ccd[_0x24142d]['merchantEarnings']+=_0x2c1ea3,_0x280ccd[_0x24142d][_0x186550(0x2e5)]+=_0x7522c5,_0x280ccd[_0x24142d][_0x186550(0x269)]++);}catch(_0x4e394f){console[_0x186550(0x320)](_0x186550(0x192)+_0x21f6bb['id']+':',_0x4e394f);}}Object[_0x186550(0x190)](_0x3ac52b)[_0x186550(0x2ae)](_0x4f1cbc=>{const _0x4e8ebf=_0x186550;_0x4f1cbc[_0x4e8ebf(0x317)]=_0x4f1cbc['paymentsCount']>0x0?_0x4f1cbc[_0x4e8ebf(0x306)]/_0x4f1cbc[_0x4e8ebf(0x269)]:0x0,delete _0x4f1cbc[_0x4e8ebf(0x306)];}),Object['values'](_0x3f1a5e)[_0x186550(0x2ae)](_0x39784e=>{const _0x514b9d=_0x186550;_0x39784e[_0x514b9d(0x295)]=_0x39784e[_0x514b9d(0x269)]>0x0?_0x39784e['turnoverUSDT']/_0x39784e[_0x514b9d(0x269)]:0x0;});let _0x3d76af=0x0,_0x56cd22=0x0;if(_0x52e3ac[_0x186550(0x1c5)]){const _0x3cb7b7=await database_1[_0x186550(0x31b)]['payout'][_0x186550(0x242)]({'where':{'shopId':_0x52e3ac[_0x186550(0x1c5)],'status':'COMPLETED','createdAt':{'gte':_0x5cf076,'lte':_0x1f5691}},'select':{'amount':!![]}});_0x3d76af=_0x3cb7b7[_0x186550(0x234)]((_0x551a63,_0x55e15c)=>_0x551a63+_0x55e15c[_0x186550(0x223)],0x0);const _0xeb2124=await database_1[_0x186550(0x31b)][_0x186550(0x2c6)][_0x186550(0x242)]({'where':{'shopId':_0x52e3ac[_0x186550(0x1c5)],'status':_0x186550(0x33e),'createdAt':{'gte':_0x5cf076,'lte':_0x1f5691}},'select':{'amount':!![]}});_0x56cd22=_0xeb2124['reduce']((_0x577fb6,_0x16c63f)=>_0x577fb6+_0x16c63f[_0x186550(0x223)],0x0);}const _0xc926c2=_0xc6f5f8,_0x1037b4=_0x4c3b46['length'],_0x3f186d=_0x1037b4>0x0?_0x561c85/_0x1037b4:0x0,_0x5ad6dd=_0xc926c2>0x0?Math['round'](_0x1037b4/_0xc926c2*0x2710)/0x64:0x0,_0x4dbb74=Math['ceil']((_0x1f5691['getTime']()-_0x5cf076[_0x186550(0x24c)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5e1d2c={'totalTurnover':Math[_0x186550(0x348)](_0x561c85*0x64)/0x64,'merchantEarnings':Math['round'](_0x15606e*0x64)/0x64,'gatewayEarnings':Math[_0x186550(0x348)](_0x42e5f3*0x64)/0x64,'totalPaidOut':Math[_0x186550(0x348)](_0x3d76af*0x64)/0x64,'pendingPayout':Math[_0x186550(0x348)](_0x56cd22*0x64)/0x64,'averageCheck':Math[_0x186550(0x348)](_0x3f186d*0x64)/0x64,'totalPayments':_0xc926c2,'successfulPayments':_0x1037b4,'conversionRate':_0x5ad6dd,'chargebacks':_0x2eda95,'refunds':_0x3b3d51,'gatewayBreakdown':Object[_0x186550(0x190)](_0x3ac52b)[_0x186550(0x2e9)](_0x198415=>({..._0x198415,'turnoverUSDT':Math[_0x186550(0x348)](_0x198415['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x186550(0x348)](_0x198415['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x198415[_0x186550(0x1ad)]*0x64)/0x64,'averageCommissionRate':Math[_0x186550(0x348)](_0x198415[_0x186550(0x317)]*0x64)/0x64})),'merchantBreakdown':_0x52e3ac['shopId']?undefined:Object[_0x186550(0x190)](_0x3f1a5e)[_0x186550(0x2e9)](_0x1972ab=>({..._0x1972ab,'turnoverUSDT':Math[_0x186550(0x348)](_0x1972ab[_0x186550(0x2a0)]*0x64)/0x64,'commissionUSDT':Math[_0x186550(0x348)](_0x1972ab['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x186550(0x348)](_0x1972ab[_0x186550(0x1ad)]*0x64)/0x64,'paidOutUSDT':Math[_0x186550(0x348)](_0x1972ab[_0x186550(0x293)]*0x64)/0x64,'averageCheckUSDT':Math[_0x186550(0x348)](_0x1972ab[_0x186550(0x295)]*0x64)/0x64})),'dailyData':Object[_0x186550(0x190)](_0x280ccd)[_0x186550(0x2e9)](_0x4f5ee7=>({..._0x4f5ee7,'turnover':Math[_0x186550(0x348)](_0x4f5ee7[_0x186550(0x1c6)]*0x64)/0x64,'merchantEarnings':Math[_0x186550(0x348)](_0x4f5ee7['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x186550(0x348)](_0x4f5ee7[_0x186550(0x2e5)]*0x64)/0x64}))[_0x186550(0x31f)]((_0x91441,_0x2ec650)=>_0x91441[_0x186550(0x2b4)][_0x186550(0x34b)](_0x2ec650['date'])),'periodInfo':{'from':_0x5cf076,'to':_0x1f5691,'periodType':_0x52e3ac[_0x186550(0x29a)]||_0x186550(0x2fd),'daysCount':_0x4dbb74}};return console['log'](_0x186550(0x304)),console[_0x186550(0x27e)](_0x186550(0x1a5)+_0x5e1d2c[_0x186550(0x1b3)]+'\x20USDT'),console[_0x186550(0x27e)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x5e1d2c[_0x186550(0x1f6)]+_0x186550(0x33d)),console['log'](_0x186550(0x329)+_0x5e1d2c[_0x186550(0x2e5)]+_0x186550(0x33d)),console[_0x186550(0x27e)](_0x186550(0x205)+_0x5e1d2c[_0x186550(0x23a)]+_0x186550(0x33d)),console[_0x186550(0x27e)](_0x186550(0x244)+_0x5e1d2c[_0x186550(0x23e)]+_0x186550(0x33d)),console[_0x186550(0x27e)]('\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20'+_0x5e1d2c[_0x186550(0x31d)]),_0x5e1d2c;}async[a53_0x19793e(0x30f)](_0x431088){const _0x2150e0=a53_0x19793e;console['log'](_0x2150e0(0x1a3),{'hasPayoutHistory':_0x431088});let _0x5565c7={};_0x431088&&(_0x5565c7[_0x2150e0(0x189)]={'some':{}});const _0xf3c1e8=await database_1[_0x2150e0(0x31b)][_0x2150e0(0x24f)][_0x2150e0(0x242)]({'where':_0x5565c7,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2150e0(0x2d8)}});return console[_0x2150e0(0x27e)](_0x2150e0(0x1b6)+_0xf3c1e8[_0x2150e0(0x2f7)]+_0x2150e0(0x1e2)+(_0x431088?_0x2150e0(0x2ad):'')),_0xf3c1e8[_0x2150e0(0x2e9)](_0xe37f60=>({'id':_0xe37f60['id'],'username':_0xe37f60[_0x2150e0(0x33a)],'name':_0xe37f60[_0x2150e0(0x2bc)]}));}[a53_0x19793e(0x236)](_0x50fbfb){const _0x2d4e40=a53_0x19793e,_0x247a01={'test_gateway':_0x2d4e40(0x17c),'plisio':_0x2d4e40(0x2a9),'rapyd':_0x2d4e40(0x1a6),'noda':'Noda','cointopay':_0x2d4e40(0x187),'cointopay2':_0x2d4e40(0x340),'klyme_eu':_0x2d4e40(0x34a),'klyme_gb':_0x2d4e40(0x1db),'klyme_de':_0x2d4e40(0x2a1),'mastercard':'MasterCard','visa/mastercard':_0x2d4e40(0x250),'amer':_0x2d4e40(0x2a5),'myxspend':'MyXSpend','ampay':_0x2d4e40(0x2c1),'ampay_try':'AmPay\x20TRY','sepa':_0x2d4e40(0x34c),'interac':'Interac','onramp':_0x2d4e40(0x1af),'squirrelpay':_0x2d4e40(0x25c),'maxpara':'MaxPara','instaxchange':_0x2d4e40(0x18f),'oxapay':'OxaPay'};return _0x247a01[_0x50fbfb]||_0x50fbfb;}[a53_0x19793e(0x265)](_0x324555){const _0x3d5740=a53_0x19793e,_0x2ca6d5={'Test\x20Gateway':_0x3d5740(0x2e3),'Plisio':_0x3d5740(0x278),'Rapyd':_0x3d5740(0x2ab),'Noda':_0x3d5740(0x2ea),'CoinToPay':_0x3d5740(0x1cc),'CoinToPay2':_0x3d5740(0x20d),'KLYME\x20EU':_0x3d5740(0x17a),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x3d5740(0x339),'MasterCard':_0x3d5740(0x1c8)};return _0x2ca6d5[_0x324555]||_0x324555[_0x3d5740(0x273)]();}async[a53_0x19793e(0x1b1)](_0x1e0937){const _0x85fc1a=a53_0x19793e,{page:_0x4c7982,limit:_0x1ae4b1,minAmount:_0x189e32,search:_0x2c64d6}=_0x1e0937;console[_0x85fc1a(0x27e)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x1e0937);let _0x391977={};_0x2c64d6&&(_0x391977[_0x85fc1a(0x2bc)]={'contains':_0x2c64d6,'mode':_0x85fc1a(0x2bb)});const _0x3de317=await database_1[_0x85fc1a(0x31b)][_0x85fc1a(0x24f)][_0x85fc1a(0x242)]({'where':_0x391977,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x2c7c0d=_0x3de317['filter'](_0x3c10d0=>{const _0x1e7d7a=_0x85fc1a,_0x2c9e75=Math[_0x1e7d7a(0x29d)](_0x3c10d0[_0x1e7d7a(0x21d)]*0x64)/0x64;if(_0x189e32&&_0x2c9e75<_0x189e32)return![];return _0x2c9e75!==0x0;});_0x2c7c0d[_0x85fc1a(0x31f)]((_0x2277bd,_0x3dc0a5)=>_0x3dc0a5[_0x85fc1a(0x21d)]-_0x2277bd['balance']);const _0x979421=_0x2c7c0d['length'],_0x5290be=(_0x4c7982-0x1)*_0x1ae4b1,_0x235a85=_0x2c7c0d[_0x85fc1a(0x31e)](_0x5290be,_0x5290be+_0x1ae4b1);console[_0x85fc1a(0x27e)](_0x85fc1a(0x1eb)+_0x235a85['length']+_0x85fc1a(0x19b));const _0x4e8c0b=await Promise[_0x85fc1a(0x204)](_0x235a85['map'](async _0x186400=>{const _0x31c3fc=_0x85fc1a,[_0x62e058,_0x2f4f70,_0x233d4e]=await Promise['all']([database_1[_0x31c3fc(0x31b)][_0x31c3fc(0x2cc)]['count']({'where':{'shopId':_0x186400['id'],'status':_0x31c3fc(0x1e7),'gateway':{'not':'test_gateway'}}}),database_1[_0x31c3fc(0x31b)][_0x31c3fc(0x2cc)][_0x31c3fc(0x1d2)]({'where':{'shopId':_0x186400['id'],'status':_0x31c3fc(0x1e7),'gateway':{'not':_0x31c3fc(0x2e3)}},'orderBy':{'paidAt':_0x31c3fc(0x2d8)},'select':{'paidAt':!![]}}),database_1[_0x31c3fc(0x31b)]['payment'][_0x31c3fc(0x32f)]({'by':[_0x31c3fc(0x17b)],'where':{'shopId':_0x186400['id'],'status':_0x31c3fc(0x1e7),'gateway':{'not':_0x31c3fc(0x2e3)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3aa1eb=new Date(),_0x55b78d=new Date(_0x3aa1eb['getFullYear'](),_0x3aa1eb['getMonth'](),0x1),_0xf1b42=new Date(_0x3aa1eb[_0x31c3fc(0x1b0)](),_0x3aa1eb[_0x31c3fc(0x210)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5eee0c,_0x5ba1f4]=await Promise[_0x31c3fc(0x204)]([database_1[_0x31c3fc(0x31b)][_0x31c3fc(0x2c6)][_0x31c3fc(0x27d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x186400['id'],'status':_0x31c3fc(0x2f0)}}),database_1[_0x31c3fc(0x31b)][_0x31c3fc(0x2c6)][_0x31c3fc(0x27d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x186400['id'],'status':_0x31c3fc(0x2f0),'createdAt':{'gte':_0x55b78d,'lte':_0xf1b42}}})]),_0x470e5d=_0x5eee0c[_0x31c3fc(0x2f2)][_0x31c3fc(0x223)]||0x0,_0x5253d9=_0x5ba1f4[_0x31c3fc(0x2f2)][_0x31c3fc(0x223)]||0x0,_0x5841eb=await Promise[_0x31c3fc(0x204)](_0x233d4e[_0x31c3fc(0x2e9)](async _0x6926ee=>{const _0x412f0e=_0x31c3fc,_0x153987=await database_1[_0x412f0e(0x31b)][_0x412f0e(0x2cc)]['findMany']({'where':{'shopId':_0x186400['id'],'status':_0x412f0e(0x1e7),'gateway':_0x6926ee[_0x412f0e(0x17b)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0xd6df2a=0x2d;if(_0x186400[_0x412f0e(0x1a4)])try{const _0x35ca2d=JSON[_0x412f0e(0x182)](_0x186400[_0x412f0e(0x1a4)]);for(const [_0x7926f2,_0x4f3b98]of Object[_0x412f0e(0x291)](_0x35ca2d)){if(_0x7926f2[_0x412f0e(0x273)]()===_0x6926ee[_0x412f0e(0x17b)][_0x412f0e(0x273)]()){_0xd6df2a=_0x4f3b98[_0x412f0e(0x331)]||0xa,console[_0x412f0e(0x27e)](_0x412f0e(0x32a)+_0x6926ee[_0x412f0e(0x17b)]+_0x412f0e(0x181)+_0x186400['id']+_0x412f0e(0x2e0)+_0xd6df2a+'%');break;}}}catch(_0x53ec3f){console[_0x412f0e(0x320)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x186400['id']+':',_0x53ec3f);}const _0x2b4fa3=_0x6926ee[_0x412f0e(0x2f2)]?.['amountUSDT']||0x0;let _0x5c30df=0x0;for(const _0x52b492 of _0x153987){if(_0x52b492[_0x412f0e(0x2d5)]!==null&&_0x52b492[_0x412f0e(0x2d5)]!==undefined)_0x5c30df+=_0x52b492['amountAfterGatewayCommissionUSDT'];else{const _0x446b5e=_0x52b492[_0x412f0e(0x1cd)]||0x0;_0x5c30df+=_0x446b5e*(0x1-_0xd6df2a/0x64);}}return{'gateway':_0x6926ee[_0x412f0e(0x17b)],'count':_0x6926ee[_0x412f0e(0x25d)]?.['id']||0x0,'amountUSDT':Math[_0x412f0e(0x348)](_0x2b4fa3*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x5c30df*0x64)/0x64,'commission':_0xd6df2a};})),_0xabcd03=_0x5841eb[_0x31c3fc(0x234)]((_0x335207,_0x2a0ac3)=>_0x335207+_0x2a0ac3['amountUSDT'],0x0),_0x344b30=_0x5841eb['reduce']((_0x55904f,_0x1c9bdc)=>_0x55904f+_0x1c9bdc[_0x31c3fc(0x222)],0x0),_0x55d6ec=_0x186400[_0x31c3fc(0x21d)];return console[_0x31c3fc(0x27e)](_0x31c3fc(0x1c4)+_0x186400[_0x31c3fc(0x33a)]+':'),console[_0x31c3fc(0x27e)](_0x31c3fc(0x2fe)+_0xabcd03[_0x31c3fc(0x1f9)](0x2)+_0x31c3fc(0x214)),console[_0x31c3fc(0x27e)](_0x31c3fc(0x248)+_0x344b30['toFixed'](0x2)+_0x31c3fc(0x30d)),console['log'](_0x31c3fc(0x2c0)+_0x55d6ec['toFixed'](0x2)+_0x31c3fc(0x285)),console[_0x31c3fc(0x27e)](_0x31c3fc(0x1de)+_0x470e5d[_0x31c3fc(0x1f9)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console['log'](_0x31c3fc(0x2a3)+(_0x344b30-_0x470e5d-_0x55d6ec)[_0x31c3fc(0x1f9)](0x2)+_0x31c3fc(0x1a1)),{'id':_0x186400['id'],'fullName':_0x186400['name'],'username':_0x186400['username'],'telegramId':_0x186400['telegram'],'merchantUrl':_0x186400['shopUrl'],'wallets':{'usdtPolygonWallet':_0x186400['usdtPolygonWallet'],'usdtTrcWallet':_0x186400['usdtTrcWallet'],'usdtErcWallet':_0x186400[_0x31c3fc(0x229)],'usdcPolygonWallet':_0x186400[_0x31c3fc(0x2aa)],'usdcErcWallet':_0x186400[_0x31c3fc(0x327)]},'totalAmountUSDT':Math[_0x31c3fc(0x348)](_0xabcd03*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x31c3fc(0x348)](_0x344b30*0x64)/0x64,'currentBalance':Math[_0x31c3fc(0x29d)](_0x55d6ec*0x64)/0x64,'totalPayout':Math[_0x31c3fc(0x348)](_0x470e5d*0x64)/0x64,'thisMonth':Math[_0x31c3fc(0x348)](_0x5253d9*0x64)/0x64,'paymentsCount':_0x62e058,'oldestPaymentDate':_0x2f4f70?.[_0x31c3fc(0x26f)]||_0x186400[_0x31c3fc(0x23b)],'gatewayBreakdown':_0x5841eb};})),_0xdf0b67=_0x4e8c0b[_0x85fc1a(0x234)]((_0x4721ee,_0x5563b9)=>_0x4721ee+_0x5563b9[_0x85fc1a(0x1d8)],0x0),_0x5a7796=_0x4e8c0b[_0x85fc1a(0x234)]((_0x10d5a8,_0x5decfc)=>_0x10d5a8+_0x5decfc[_0x85fc1a(0x298)],0x0),_0x1c07c8=_0x4e8c0b[_0x85fc1a(0x234)]((_0x2a9e3f,_0x37ef76)=>_0x2a9e3f+_0x37ef76[_0x85fc1a(0x289)],0x0),_0x2d4c32=_0x4e8c0b['reduce']((_0xaf49b5,_0x457edc)=>_0xaf49b5+_0x457edc[_0x85fc1a(0x1dc)],0x0);return console[_0x85fc1a(0x27e)](_0x85fc1a(0x338)+_0x979421+_0x85fc1a(0x2e2)),console[_0x85fc1a(0x27e)](_0x85fc1a(0x1aa)+Math[_0x85fc1a(0x348)](_0xdf0b67*0x64)/0x64+_0x85fc1a(0x214)),console[_0x85fc1a(0x27e)](_0x85fc1a(0x319)+Math[_0x85fc1a(0x348)](_0x5a7796*0x64)/0x64+_0x85fc1a(0x1f8)),console[_0x85fc1a(0x27e)]('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x85fc1a(0x348)](_0x1c07c8*0x64)/0x64+_0x85fc1a(0x33d)),console[_0x85fc1a(0x27e)](_0x85fc1a(0x337)+Math[_0x85fc1a(0x348)](_0x2d4c32*0x64)/0x64+_0x85fc1a(0x33d)),{'merchants':_0x4e8c0b,'pagination':{'page':_0x4c7982,'limit':_0x1ae4b1,'total':_0x979421,'totalPages':Math[_0x85fc1a(0x2be)](_0x979421/_0x1ae4b1)},'summary':{'totalMerchants':_0x979421,'totalAmountUSDT':Math[_0x85fc1a(0x348)](_0xdf0b67*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x85fc1a(0x348)](_0x5a7796*0x64)/0x64,'totalPayout':Math[_0x85fc1a(0x348)](_0x1c07c8*0x64)/0x64,'thisMonth':Math['round'](_0x2d4c32*0x64)/0x64}};}async[a53_0x19793e(0x2d3)](_0x3634a1){const _0x442915=a53_0x19793e,{shopId:_0x265c9f,amount:_0x22838e,network:_0xd5d354,wallet:_0x1987d1,notes:_0x294ba0,txid:_0x5f2534,periodFrom:_0x3f59ce,periodTo:_0x24d5cd}=_0x3634a1,_0x4fc07d=await database_1[_0x442915(0x31b)][_0x442915(0x321)](async _0x28a073=>{const _0x16f0d3=_0x442915,_0x1462a7=await _0x28a073[_0x16f0d3(0x24f)]['findUnique']({'where':{'id':_0x265c9f},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1462a7)throw new Error(_0x16f0d3(0x2c8));console[_0x16f0d3(0x27e)](_0x16f0d3(0x283)+_0x1462a7[_0x16f0d3(0x33a)]+':'),console[_0x16f0d3(0x27e)]('\x20\x20\x20Current\x20balance:\x20'+_0x1462a7[_0x16f0d3(0x21d)]['toFixed'](0x6)+_0x16f0d3(0x33d)),console[_0x16f0d3(0x27e)](_0x16f0d3(0x1fa)+_0x22838e['toFixed'](0x6)+'\x20USDT'),console[_0x16f0d3(0x27e)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x1462a7['totalPaidOut'][_0x16f0d3(0x1f9)](0x6)+_0x16f0d3(0x33d));if(_0x5f2534)console[_0x16f0d3(0x27e)](_0x16f0d3(0x219)+_0x5f2534);const _0x2643af=0.000001,_0x36c908=Number(_0x1462a7[_0x16f0d3(0x21d)]),_0x42afee=Number(_0x22838e);console[_0x16f0d3(0x27e)]('üîç\x20Balance\x20check\x20details:'),console[_0x16f0d3(0x27e)](_0x16f0d3(0x238)+_0x1462a7[_0x16f0d3(0x21d)]),console['log']('\x20\x20\x20Available\x20(number):\x20'+_0x36c908),console[_0x16f0d3(0x27e)](_0x16f0d3(0x29b)+_0x42afee),console[_0x16f0d3(0x27e)](_0x16f0d3(0x2c3)+(_0x36c908-_0x42afee)),console[_0x16f0d3(0x27e)](_0x16f0d3(0x235)+_0x2643af);if(_0x36c908<_0x42afee-_0x2643af)throw new Error(_0x16f0d3(0x1ed)+_0x36c908['toFixed'](0x6)+_0x16f0d3(0x1ec)+_0x42afee[_0x16f0d3(0x1f9)](0x6)+_0x16f0d3(0x1e4)+(_0x36c908-_0x42afee)['toFixed'](0x8)+_0x16f0d3(0x33d));console[_0x16f0d3(0x27e)](_0x16f0d3(0x1d7));const _0x474555=Math[_0x16f0d3(0x1f1)](_0x36c908,_0x42afee);let _0x54f773=_0x1987d1;console['log'](_0x16f0d3(0x303)+(_0x1987d1||'not\x20provided'));if(!_0x54f773){console['log']('üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0xf223a5=await _0x28a073['shop']['findUnique']({'where':{'id':_0x265c9f},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x16f0d3(0x27e)](_0x16f0d3(0x30e),_0xf223a5);if(_0xf223a5)switch(_0xd5d354){case _0x16f0d3(0x2d2):_0x54f773=_0xf223a5['usdtPolygonWallet']||undefined,console['log'](_0x16f0d3(0x297)+_0x54f773);break;case _0x16f0d3(0x307):_0x54f773=_0xf223a5[_0x16f0d3(0x213)]||undefined,console[_0x16f0d3(0x27e)](_0x16f0d3(0x1e8)+_0x54f773);break;case _0x16f0d3(0x25a):_0x54f773=_0xf223a5[_0x16f0d3(0x229)]||undefined,console[_0x16f0d3(0x27e)](_0x16f0d3(0x28a)+_0x54f773);break;case _0x16f0d3(0x21f):_0x54f773=_0xf223a5[_0x16f0d3(0x2aa)]||undefined,console[_0x16f0d3(0x27e)](_0x16f0d3(0x23d)+_0x54f773);break;case _0x16f0d3(0x310):_0x54f773=_0xf223a5['usdcErcWallet']||undefined,console[_0x16f0d3(0x27e)](_0x16f0d3(0x1e9)+_0x54f773);break;}}else console[_0x16f0d3(0x27e)](_0x16f0d3(0x2ba)+_0x54f773);console[_0x16f0d3(0x27e)]('üí≥\x20Final\x20payout\x20wallet\x20for\x20'+_0xd5d354+':\x20'+(_0x54f773||_0x16f0d3(0x18d))),console[_0x16f0d3(0x27e)](_0x16f0d3(0x2f5),{'shopId':_0x265c9f,'amount':_0x474555,'network':_0xd5d354,'wallet':_0x54f773,'status':_0x16f0d3(0x2f0),'txid':_0x5f2534,'notes':_0x294ba0,'periodFrom':_0x3f59ce?new Date(_0x3f59ce):null,'periodTo':_0x24d5cd?new Date(_0x24d5cd):null});const _0xbbba1e=await _0x28a073[_0x16f0d3(0x2c6)][_0x16f0d3(0x19f)]({'data':{'shopId':_0x265c9f,'amount':_0x474555,'network':_0xd5d354,'wallet':_0x54f773,'status':_0x16f0d3(0x2f0),'txid':_0x5f2534,'notes':_0x294ba0,'periodFrom':_0x3f59ce?new Date(_0x3f59ce):null,'periodTo':_0x24d5cd?new Date(_0x24d5cd):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x16f0d3(0x1b7),{'id':_0xbbba1e['id'],'wallet':_0xbbba1e[_0x16f0d3(0x23f)],'network':_0xbbba1e['network'],'amount':_0xbbba1e[_0x16f0d3(0x223)]});const _0x46b768=_0x36c908-_0x474555,_0x38a241=Number(_0x1462a7[_0x16f0d3(0x23a)])+_0x474555;return await _0x28a073[_0x16f0d3(0x24f)]['update']({'where':{'id':_0x265c9f},'data':{'balance':_0x46b768,'totalPaidOut':_0x38a241}}),console[_0x16f0d3(0x27e)]('üí∞\x20Shop\x20'+_0x1462a7[_0x16f0d3(0x33a)]+'\x20balance\x20updated:'),console[_0x16f0d3(0x27e)](_0x16f0d3(0x1dd)+_0x36c908['toFixed'](0x6)+_0x16f0d3(0x18c)+_0x46b768['toFixed'](0x6)+_0x16f0d3(0x24e)+_0x474555[_0x16f0d3(0x1f9)](0x6)+')'),console[_0x16f0d3(0x27e)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x1462a7['totalPaidOut'][_0x16f0d3(0x1f9)](0x6)+'\x20->\x20'+_0x38a241[_0x16f0d3(0x1f9)](0x6)+_0x16f0d3(0x256)+_0x474555[_0x16f0d3(0x1f9)](0x6)+')'),console[_0x16f0d3(0x27e)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x474555['toFixed'](0x6)+_0x16f0d3(0x33d)),{'payout':_0xbbba1e,'shop':_0x1462a7};});console[_0x442915(0x27e)](_0x442915(0x28e)+_0x4fc07d[_0x442915(0x2c6)]['id']+_0x442915(0x181)+_0x4fc07d['shop'][_0x442915(0x33a)]+'\x20('+_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x223)][_0x442915(0x1f9)](0x6)+'\x20USDT)');try{let _0x25cf27='–ù–µ\x20—É–∫–∞–∑–∞–Ω';if(_0x4fc07d[_0x442915(0x2c6)]['periodFrom']&&_0x4fc07d['payout'][_0x442915(0x231)]){const _0x360ca3=new Date(_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x2cf)])[_0x442915(0x286)](_0x442915(0x1ee)),_0x13028a=new Date(_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x231)])['toLocaleDateString'](_0x442915(0x1ee));_0x25cf27=_0x360ca3+'\x20-\x20'+_0x13028a;}await telegramBotService_1[_0x442915(0x2d0)][_0x442915(0x211)](_0x4fc07d['payout'][_0x442915(0x1c5)],{'id':_0x4fc07d[_0x442915(0x2c6)]['id'],'amount':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x223)],'network':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x1ea)],'wallet':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x23f)],'period':_0x25cf27,'createdAt':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x23b)],'txid':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x2b3)]}),console[_0x442915(0x27e)]('üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x4fc07d[_0x442915(0x2c6)]['id']);}catch(_0x443a56){console[_0x442915(0x320)](_0x442915(0x2d9)+_0x4fc07d[_0x442915(0x2c6)]['id']+':',_0x443a56);}return{'id':_0x4fc07d[_0x442915(0x2c6)]['id'],'shopId':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x1c5)],'shopName':_0x4fc07d[_0x442915(0x24f)]['name'],'shopUsername':_0x4fc07d[_0x442915(0x24f)][_0x442915(0x33a)],'amount':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x223)],'network':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x1ea)],'wallet':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x23f)],'status':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x2f3)],'txid':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x2b3)],'notes':_0x4fc07d['payout']['notes'],'periodFrom':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x2cf)],'periodTo':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x231)],'createdAt':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x23b)],'paidAt':_0x4fc07d[_0x442915(0x2c6)][_0x442915(0x26f)]};}async['getAllPayouts'](_0x2f86da){const _0x5d2847=a53_0x19793e,{page:_0x4b87ec,limit:_0x5099bb,shopId:_0x17526c,network:_0x3c7668,dateFrom:_0x264df8,dateTo:_0x217df1,search:_0x1c0f23}=_0x2f86da,_0x151776=(_0x4b87ec-0x1)*_0x5099bb,_0x7be086={};_0x17526c&&(_0x7be086['shopId']=_0x17526c);_0x3c7668&&(_0x7be086[_0x5d2847(0x1ea)]=_0x3c7668);if(_0x264df8||_0x217df1){_0x7be086[_0x5d2847(0x23b)]={};if(_0x264df8){const _0x3bb618=new Date(_0x264df8);_0x3bb618[_0x5d2847(0x1b2)](0x0,0x0,0x0,0x1),_0x7be086[_0x5d2847(0x23b)][_0x5d2847(0x288)]=_0x3bb618,console[_0x5d2847(0x27e)](_0x5d2847(0x2e4)+_0x3bb618[_0x5d2847(0x26b)]());}if(_0x217df1){const _0x20fbd=new Date(_0x217df1);_0x20fbd[_0x5d2847(0x1b2)](0x17,0x3b,0x3b,0x3e7),_0x7be086[_0x5d2847(0x23b)][_0x5d2847(0x342)]=_0x20fbd,console[_0x5d2847(0x27e)](_0x5d2847(0x270)+_0x20fbd[_0x5d2847(0x26b)]());}}_0x1c0f23&&(_0x7be086['OR']=[{'shop':{'name':{'contains':_0x1c0f23,'mode':_0x5d2847(0x2bb)}}},{'shop':{'username':{'contains':_0x1c0f23,'mode':_0x5d2847(0x2bb)}}},{'notes':{'contains':_0x1c0f23,'mode':_0x5d2847(0x2bb)}}]);const [_0x560b56,_0x56ac5c]=await Promise[_0x5d2847(0x204)]([database_1['default'][_0x5d2847(0x2c6)][_0x5d2847(0x242)]({'where':_0x7be086,'skip':_0x151776,'take':_0x5099bb,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5d2847(0x31b)][_0x5d2847(0x2c6)][_0x5d2847(0x2ff)]({'where':_0x7be086})]);return{'payouts':_0x560b56[_0x5d2847(0x2e9)](_0x173e0b=>({'id':_0x173e0b['id'],'shopId':_0x173e0b[_0x5d2847(0x1c5)],'shopName':_0x173e0b[_0x5d2847(0x24f)][_0x5d2847(0x2bc)],'shopUsername':_0x173e0b[_0x5d2847(0x24f)][_0x5d2847(0x33a)],'amount':_0x173e0b['amount'],'network':_0x173e0b[_0x5d2847(0x1ea)],'wallet':_0x173e0b['wallet'],'status':_0x173e0b[_0x5d2847(0x2f3)],'txid':_0x173e0b[_0x5d2847(0x2b3)],'notes':_0x173e0b[_0x5d2847(0x1c3)],'periodFrom':_0x173e0b[_0x5d2847(0x2cf)],'periodTo':_0x173e0b['periodTo'],'createdAt':_0x173e0b[_0x5d2847(0x23b)],'paidAt':_0x173e0b[_0x5d2847(0x26f)]})),'pagination':{'page':_0x4b87ec,'limit':_0x5099bb,'total':_0x56ac5c,'totalPages':Math['ceil'](_0x56ac5c/_0x5099bb)}};}async[a53_0x19793e(0x243)](_0x340826){const _0x57b1e9=a53_0x19793e,_0x28febd=await database_1['default']['payout'][_0x57b1e9(0x1e5)]({'where':{'id':_0x340826},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x28febd)return null;return{'id':_0x28febd['id'],'shopId':_0x28febd[_0x57b1e9(0x1c5)],'shopName':_0x28febd['shop'][_0x57b1e9(0x2bc)],'shopUsername':_0x28febd[_0x57b1e9(0x24f)][_0x57b1e9(0x33a)],'amount':_0x28febd[_0x57b1e9(0x223)],'network':_0x28febd[_0x57b1e9(0x1ea)],'wallet':_0x28febd[_0x57b1e9(0x23f)],'status':_0x28febd[_0x57b1e9(0x2f3)],'txid':_0x28febd['txid'],'notes':_0x28febd[_0x57b1e9(0x1c3)],'periodFrom':_0x28febd[_0x57b1e9(0x2cf)],'periodTo':_0x28febd[_0x57b1e9(0x231)],'createdAt':_0x28febd['createdAt'],'paidAt':_0x28febd[_0x57b1e9(0x26f)]};}async[a53_0x19793e(0x247)](_0x2d2e55){const _0xd0bb63=a53_0x19793e;await database_1[_0xd0bb63(0x31b)][_0xd0bb63(0x2c6)]['delete']({'where':{'id':_0x2d2e55}});}async[a53_0x19793e(0x2cb)](_0x497a45,_0x244ee9){const _0x52a7c8=a53_0x19793e,_0xf90775=await database_1[_0x52a7c8(0x31b)]['$transaction'](async _0x1eaeaa=>{const _0x3bc6e5=_0x52a7c8,_0x3572f7=await _0x1eaeaa[_0x3bc6e5(0x2c6)]['findUnique']({'where':{'id':_0x497a45},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x3572f7)throw new Error(_0x3bc6e5(0x249));console['log'](_0x3bc6e5(0x274)+_0x497a45+_0x3bc6e5(0x181)+_0x3572f7['shop'][_0x3bc6e5(0x33a)]+':'),console[_0x3bc6e5(0x27e)](_0x3bc6e5(0x17d)+_0x3572f7[_0x3bc6e5(0x223)]['toFixed'](0x6)+_0x3bc6e5(0x33d)),console[_0x3bc6e5(0x27e)](_0x3bc6e5(0x28b)+_0x3572f7['network']),console[_0x3bc6e5(0x27e)](_0x3bc6e5(0x26a)+_0x3572f7['shop'][_0x3bc6e5(0x21d)][_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x33d)),console[_0x3bc6e5(0x27e)](_0x3bc6e5(0x2f9)+_0x3572f7[_0x3bc6e5(0x24f)]['totalPaidOut'][_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x33d));let _0x4f3926=0x0;if(_0x244ee9[_0x3bc6e5(0x223)]!==undefined){const _0x518ad3=Number(_0x3572f7[_0x3bc6e5(0x223)]),_0x7a9e4a=Number(_0x244ee9['amount']);_0x4f3926=_0x7a9e4a-_0x518ad3,console[_0x3bc6e5(0x27e)]('\x20\x20\x20New\x20amount:\x20'+_0x7a9e4a['toFixed'](0x6)+'\x20USDT'),console[_0x3bc6e5(0x27e)]('\x20\x20\x20Amount\x20difference:\x20'+_0x4f3926[_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x33d));if(_0x4f3926<0x0)console[_0x3bc6e5(0x27e)]('\x20\x20\x20Amount\x20decreased\x20by\x20'+Math[_0x3bc6e5(0x22c)](_0x4f3926)['toFixed'](0x6)+_0x3bc6e5(0x2ec));else{if(_0x4f3926>0x0){const _0x4d7d55=Number(_0x3572f7[_0x3bc6e5(0x24f)]['balance']);console[_0x3bc6e5(0x27e)](_0x3bc6e5(0x28f)+_0x4f3926[_0x3bc6e5(0x1f9)](0x6)+'\x20USDT\x20-\x20will\x20deduct\x20from\x20balance');if(_0x4d7d55<_0x4f3926)throw new Error(_0x3bc6e5(0x2fb)+_0x4d7d55[_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x252)+_0x4f3926[_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x33d));}}}const _0x2382de={};if(_0x244ee9[_0x3bc6e5(0x223)]!==undefined)_0x2382de[_0x3bc6e5(0x223)]=_0x244ee9[_0x3bc6e5(0x223)];if(_0x244ee9[_0x3bc6e5(0x1ea)]!==undefined)_0x2382de['network']=_0x244ee9[_0x3bc6e5(0x1ea)];if(_0x244ee9[_0x3bc6e5(0x23f)]!==undefined)_0x2382de[_0x3bc6e5(0x23f)]=_0x244ee9[_0x3bc6e5(0x23f)]||null;if(_0x244ee9['notes']!==undefined)_0x2382de[_0x3bc6e5(0x1c3)]=_0x244ee9['notes']||null;if(_0x244ee9[_0x3bc6e5(0x2b3)]!==undefined)_0x2382de['txid']=_0x244ee9[_0x3bc6e5(0x2b3)]||null;if(_0x244ee9[_0x3bc6e5(0x2cf)]!==undefined)_0x2382de[_0x3bc6e5(0x2cf)]=_0x244ee9[_0x3bc6e5(0x2cf)]?new Date(_0x244ee9[_0x3bc6e5(0x2cf)]):null;if(_0x244ee9['periodTo']!==undefined)_0x2382de[_0x3bc6e5(0x231)]=_0x244ee9[_0x3bc6e5(0x231)]?new Date(_0x244ee9[_0x3bc6e5(0x231)]):null;const _0x4e3603=await _0x1eaeaa[_0x3bc6e5(0x2c6)][_0x3bc6e5(0x26e)]({'where':{'id':_0x497a45},'data':_0x2382de,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x4f3926!==0x0){const _0x57e3d8=Number(_0x3572f7[_0x3bc6e5(0x24f)][_0x3bc6e5(0x21d)]),_0x3b34dd=Number(_0x3572f7[_0x3bc6e5(0x24f)][_0x3bc6e5(0x23a)]),_0x1e887d=_0x57e3d8-_0x4f3926,_0x516c0b=_0x3b34dd+_0x4f3926;await _0x1eaeaa[_0x3bc6e5(0x24f)]['update']({'where':{'id':_0x3572f7[_0x3bc6e5(0x1c5)]},'data':{'balance':_0x1e887d,'totalPaidOut':_0x516c0b}}),console['log'](_0x3bc6e5(0x26d)+_0x3572f7[_0x3bc6e5(0x24f)]['username']+'\x20balance\x20updated:'),console['log'](_0x3bc6e5(0x1dd)+_0x57e3d8[_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x18c)+_0x1e887d[_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x33d)),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x3b34dd[_0x3bc6e5(0x1f9)](0x6)+_0x3bc6e5(0x18c)+_0x516c0b[_0x3bc6e5(0x1f9)](0x6)+'\x20USDT');}return console[_0x3bc6e5(0x27e)](_0x3bc6e5(0x258)+_0x497a45+_0x3bc6e5(0x21a)),_0x4e3603;});return{'id':_0xf90775['id'],'shopId':_0xf90775['shopId'],'shopName':_0xf90775[_0x52a7c8(0x24f)][_0x52a7c8(0x2bc)],'shopUsername':_0xf90775['shop'][_0x52a7c8(0x33a)],'amount':Number(_0xf90775[_0x52a7c8(0x223)]),'network':_0xf90775['network'],'wallet':_0xf90775['wallet'],'status':_0xf90775['status'],'txid':_0xf90775[_0x52a7c8(0x2b3)],'notes':_0xf90775[_0x52a7c8(0x1c3)],'periodFrom':_0xf90775[_0x52a7c8(0x2cf)],'periodTo':_0xf90775['periodTo'],'createdAt':_0xf90775['createdAt'],'paidAt':_0xf90775[_0x52a7c8(0x26f)]};}async[a53_0x19793e(0x22d)](_0x3b7a9b){const _0x4eea82=a53_0x19793e,{page:_0x513b7f,limit:_0x3a3e52,status:_0x4e392b,gateway:_0x50f4bc,shopId:_0x5ea0ea,dateFrom:_0x4d9465,dateTo:_0x448477,search:_0x3e5a19,currency:_0x1a02af,sortBy:_0x267b92,sortOrder:_0x287d8a}=_0x3b7a9b,_0x32b6ab=(_0x513b7f-0x1)*_0x3a3e52;console[_0x4eea82(0x27e)](_0x4eea82(0x19d),_0x3b7a9b);const _0x5b7498=await database_1[_0x4eea82(0x31b)][_0x4eea82(0x2cc)][_0x4eea82(0x32f)]({'by':[_0x4eea82(0x17b)],'_count':{'gateway':!![]}});console[_0x4eea82(0x27e)]('üìä\x20Available\x20gateways\x20in\x20database:',_0x5b7498[_0x4eea82(0x2e9)](_0x118033=>_0x118033[_0x4eea82(0x17b)]+'\x20('+_0x118033['_count'][_0x4eea82(0x17b)]+_0x4eea82(0x25f)));if(_0x50f4bc){const _0x389f57=_0x5b7498['some'](_0x2aec23=>_0x2aec23['gateway'][_0x4eea82(0x273)]()===_0x50f4bc[_0x4eea82(0x273)]());!_0x389f57&&_0x50f4bc['toLowerCase']()!==_0x4eea82(0x2e3)&&console[_0x4eea82(0x27e)](_0x4eea82(0x2b0)+_0x50f4bc+_0x4eea82(0x1ef)+_0x5b7498[_0x4eea82(0x2e9)](_0x17765a=>_0x17765a[_0x4eea82(0x17b)])[_0x4eea82(0x1cb)](',\x20'));}const _0x1f1714={};_0x4e392b&&(_0x1f1714['status']=_0x4e392b[_0x4eea82(0x2e1)]());if(!_0x50f4bc)_0x1f1714[_0x4eea82(0x17b)]={'not':_0x4eea82(0x2e3)};else{if(_0x50f4bc&&(_0x50f4bc[_0x4eea82(0x273)]()===_0x4eea82(0x2e3)||_0x50f4bc===_0x4eea82(0x34d)))_0x1f1714[_0x4eea82(0x17b)]='test_gateway';else{let _0x210434=_0x50f4bc;const _0x328ee6=(0x0,gateway_1['getGatewayNameById'])(_0x50f4bc);if(_0x328ee6)_0x210434=_0x328ee6,console[_0x4eea82(0x27e)]('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0x50f4bc+_0x4eea82(0x218)+_0x210434+'\x27');else{const _0x4dcce4=(0x0,gateway_1[_0x4eea82(0x2c9)])(_0x50f4bc);if(_0x4dcce4){const _0x22ccec=(0x0,gateway_1['getGatewayNameById'])(_0x4dcce4);_0x22ccec&&(_0x210434=_0x22ccec,console[_0x4eea82(0x27e)](_0x4eea82(0x255)+_0x50f4bc+_0x4eea82(0x183)+_0x4dcce4+_0x4eea82(0x212)+_0x210434+'\x27'));}else console['log']('üîç\x20Using\x20gateway\x20\x27'+_0x50f4bc+_0x4eea82(0x23c));}const _0x2ae38d=await database_1[_0x4eea82(0x31b)][_0x4eea82(0x2cc)]['count']({'where':{'gateway':_0x210434[_0x4eea82(0x273)]()},'take':0x1});_0x2ae38d===0x0?(console['log'](_0x4eea82(0x1ce)+_0x210434+_0x4eea82(0x18e)+_0x50f4bc+_0x4eea82(0x335)),_0x1f1714['gateway']=_0x4eea82(0x2a4)):(_0x1f1714[_0x4eea82(0x17b)]=_0x210434[_0x4eea82(0x273)](),console[_0x4eea82(0x27e)](_0x4eea82(0x1e1)+_0x210434+_0x4eea82(0x18e)+_0x50f4bc+'\x27)'));}}console['log']('üìä\x20Gateway\x20filter\x20applied:',_0x1f1714[_0x4eea82(0x17b)]);_0x5ea0ea&&(_0x1f1714['shopId']=_0x5ea0ea);_0x1a02af&&(_0x1f1714[_0x4eea82(0x198)]=_0x1a02af[_0x4eea82(0x2e1)](),console['log'](_0x4eea82(0x2eb)+_0x1a02af[_0x4eea82(0x2e1)]()));if(_0x4d9465||_0x448477){_0x1f1714[_0x4eea82(0x23b)]={};if(_0x4d9465){const _0x16ea0d=new Date(_0x4d9465),_0x23c38d=new Date(Date['UTC'](_0x16ea0d[_0x4eea82(0x2dd)](),_0x16ea0d['getUTCMonth'](),_0x16ea0d[_0x4eea82(0x2a6)](),0x0,0x0,0x0,0x0));_0x1f1714[_0x4eea82(0x23b)][_0x4eea82(0x288)]=_0x23c38d,console[_0x4eea82(0x27e)]('üìÖ\x20Date\x20from\x20filter:\x20'+_0x23c38d[_0x4eea82(0x26b)]());}if(_0x448477){const _0x4028d5=new Date(_0x448477),_0x50ba9e=new Date(Date[_0x4eea82(0x206)](_0x4028d5[_0x4eea82(0x2dd)](),_0x4028d5[_0x4eea82(0x31a)](),_0x4028d5['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));_0x1f1714[_0x4eea82(0x23b)][_0x4eea82(0x342)]=_0x50ba9e,console[_0x4eea82(0x27e)](_0x4eea82(0x33f)+_0x50ba9e['toISOString']());}}_0x3e5a19&&(_0x1f1714['OR']=[{'id':{'contains':_0x3e5a19,'mode':_0x4eea82(0x2bb)}},{'orderId':{'contains':_0x3e5a19,'mode':_0x4eea82(0x2bb)}},{'gatewayOrderId':{'contains':_0x3e5a19,'mode':'insensitive'}},{'customerEmail':{'contains':_0x3e5a19,'mode':_0x4eea82(0x2bb)}},{'shop':{'name':{'contains':_0x3e5a19,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3e5a19,'mode':_0x4eea82(0x2bb)}}}]);console['log'](_0x4eea82(0x1b5),JSON[_0x4eea82(0x20c)](_0x1f1714,null,0x2));const _0x3a39ea=await database_1['default']['payment'][_0x4eea82(0x2ff)]({'where':_0x1f1714});console['log'](_0x4eea82(0x2a7)+_0x3a39ea);let _0x45e926={'createdAt':'desc'};if(_0x267b92){const _0x4e0aa5=[_0x4eea82(0x223),_0x4eea82(0x23b),_0x4eea82(0x28c),'status',_0x4eea82(0x17b),_0x4eea82(0x198)],_0x3a1f66=[_0x4eea82(0x2d8),_0x4eea82(0x1fc)];if(_0x4e0aa5['includes'](_0x267b92)){const _0x3f4e2e=_0x3a1f66[_0x4eea82(0x202)](_0x287d8a)?_0x287d8a:_0x4eea82(0x1fc);_0x45e926={[_0x267b92]:_0x3f4e2e},console[_0x4eea82(0x27e)]('üìä\x20Sorting\x20payments\x20by\x20'+_0x267b92+'\x20in\x20'+_0x3f4e2e+'\x20order');}}const [_0x5a4baf,_0x460882]=await Promise[_0x4eea82(0x204)]([database_1[_0x4eea82(0x31b)][_0x4eea82(0x2cc)][_0x4eea82(0x242)]({'where':_0x1f1714,'skip':_0x32b6ab,'take':_0x3a3e52,'orderBy':_0x45e926,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4eea82(0x2cc)][_0x4eea82(0x2ff)]({'where':_0x1f1714})]);let _0x3af7fe,_0x2a1791;if(_0x4d9465){const _0x5dcb13=new Date(_0x4d9465);_0x3af7fe=new Date(Date[_0x4eea82(0x206)](_0x5dcb13[_0x4eea82(0x2dd)](),_0x5dcb13['getUTCMonth'](),_0x5dcb13['getUTCDate'](),0x0,0x0,0x0,0x0));}else{const _0x5623ff=new Date();_0x3af7fe=new Date(Date['UTC'](_0x5623ff[_0x4eea82(0x2dd)](),_0x5623ff['getUTCMonth'](),_0x5623ff[_0x4eea82(0x2a6)](),0x0,0x0,0x0,0x0));}if(_0x448477){const _0xe38d5f=new Date(_0x448477);_0x2a1791=new Date(Date[_0x4eea82(0x206)](_0xe38d5f[_0x4eea82(0x2dd)](),_0xe38d5f['getUTCMonth'](),_0xe38d5f[_0x4eea82(0x2a6)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x4d9465){const _0x573eb5=new Date(_0x4d9465);_0x2a1791=new Date(Date[_0x4eea82(0x206)](_0x573eb5['getUTCFullYear'](),_0x573eb5['getUTCMonth'](),_0x573eb5[_0x4eea82(0x2a6)](),0x17,0x3b,0x3b,0x3e7));}else{const _0xb7c5c3=new Date();_0x2a1791=new Date(Date['UTC'](_0xb7c5c3['getUTCFullYear'](),_0xb7c5c3[_0x4eea82(0x31a)](),_0xb7c5c3[_0x4eea82(0x2a6)](),0x17,0x3b,0x3b,0x3e7));}}const _0x90a425={};{const _0x37ff53={'status':_0x4e392b?_0x4e392b[_0x4eea82(0x2e1)]():_0x4eea82(0x1e7),'createdAt':{'gte':_0x3af7fe,'lte':_0x2a1791}};_0x50f4bc?_0x37ff53['gateway']=_0x1f1714[_0x4eea82(0x17b)]:_0x37ff53['gateway']={'not':_0x4eea82(0x2e3)};_0x5ea0ea&&(_0x37ff53['shopId']=_0x5ea0ea);_0x1a02af&&(_0x37ff53[_0x4eea82(0x198)]=_0x1a02af[_0x4eea82(0x2e1)]());console[_0x4eea82(0x27e)](_0x4eea82(0x2ee),JSON[_0x4eea82(0x20c)](_0x37ff53,null,0x2));const _0x37c8d9=await database_1[_0x4eea82(0x31b)][_0x4eea82(0x2cc)][_0x4eea82(0x242)]({'where':_0x37ff53,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x1bc2b7=0x0;_0x37c8d9[_0x4eea82(0x2ae)](_0x1b1c4d=>{const _0x52eb71=_0x4eea82;_0x1b1c4d['amountUSDT']&&(_0x1bc2b7+=_0x1b1c4d[_0x52eb71(0x1cd)]);if(_0x1b1c4d['currency']){const _0x35819f=_0x1b1c4d[_0x52eb71(0x198)]['toUpperCase']();!_0x90a425[_0x35819f]&&(_0x90a425[_0x35819f]=0x0),_0x90a425[_0x35819f]+=_0x1b1c4d[_0x52eb71(0x223)];}}),_0x1bc2b7>0x0&&(_0x90a425[_0x4eea82(0x292)]=_0x1bc2b7);}return{'payments':_0x5a4baf,'pagination':{'page':_0x513b7f,'limit':_0x3a3e52,'total':_0x460882,'totalPages':Math[_0x4eea82(0x2be)](_0x460882/_0x3a3e52)},'statistics':_0x90a425};}async[a53_0x19793e(0x349)](_0x223d4f){const _0x62ea25=a53_0x19793e,_0x4bede9=await database_1[_0x62ea25(0x31b)][_0x62ea25(0x2cc)][_0x62ea25(0x1e5)]({'where':{'id':_0x223d4f},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4bede9)return null;return{'id':_0x4bede9['id'],'shopId':_0x4bede9[_0x62ea25(0x1c5)],'gateway':_0x4bede9[_0x62ea25(0x17b)],'amount':_0x4bede9['amount'],'currency':_0x4bede9[_0x62ea25(0x198)],'status':_0x4bede9[_0x62ea25(0x2f3)],'orderId':_0x4bede9[_0x62ea25(0x2df)],'gatewayOrderId':_0x4bede9['gatewayOrderId'],'customerEmail':_0x4bede9[_0x62ea25(0x276)],'customerName':_0x4bede9[_0x62ea25(0x25b)],'customerCountry':_0x4bede9[_0x62ea25(0x1bf)],'customerIp':_0x4bede9[_0x62ea25(0x2ce)],'customerUa':_0x4bede9[_0x62ea25(0x217)],'failureMessage':_0x4bede9[_0x62ea25(0x33c)],'externalPaymentUrl':_0x4bede9['externalPaymentUrl'],'successUrl':_0x4bede9[_0x62ea25(0x2cd)],'failUrl':_0x4bede9[_0x62ea25(0x328)],'pendingUrl':_0x4bede9[_0x62ea25(0x2d7)],'whiteUrl':_0x4bede9[_0x62ea25(0x266)],'createdAt':_0x4bede9[_0x62ea25(0x23b)],'updatedAt':_0x4bede9[_0x62ea25(0x28c)],'shop':_0x4bede9[_0x62ea25(0x24f)]};}async['updatePaymentStatus'](_0x22d854,_0x1c4537,_0x322ccb,_0x148f48){const _0x1106ab=a53_0x19793e,_0x3bfeb6=await database_1[_0x1106ab(0x31b)]['$transaction'](async _0x17c26c=>{const _0x4ec0f8=_0x1106ab,_0x3ac566=await _0x17c26c[_0x4ec0f8(0x2cc)][_0x4ec0f8(0x1e5)]({'where':{'id':_0x22d854},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3ac566)throw new Error('Payment\x20not\x20found');const _0x29b270=_0x3ac566[_0x4ec0f8(0x2f3)],_0x36a491=_0x1c4537[_0x4ec0f8(0x2e1)]();console['log'](_0x4ec0f8(0x27b)+_0x22d854+_0x4ec0f8(0x1ae)+_0x29b270+_0x4ec0f8(0x18c)+_0x36a491),console['log']('üí∞\x20Current\x20shop\x20balance:\x20'+_0x3ac566[_0x4ec0f8(0x24f)]['balance']+_0x4ec0f8(0x33d));const _0x4b9e8f={'status':_0x36a491,'updatedAt':new Date(),'statusChangedBy':_0x4ec0f8(0x226),'statusChangedAt':new Date()};_0x322ccb&&(_0x4b9e8f[_0x4ec0f8(0x2ed)]=_0x322ccb);_0x36a491==='CHARGEBACK'&&_0x148f48&&(_0x4b9e8f['chargebackAmount']=_0x148f48);let _0xc0009a=0x0,_0x5295d=_0x3ac566[_0x4ec0f8(0x24f)]['balance'];if(_0x36a491===_0x4ec0f8(0x1e7)&&_0x29b270!==_0x4ec0f8(0x1e7)){_0x4b9e8f[_0x4ec0f8(0x26f)]=new Date();const _0x2ad0e0=await currencyService_1[_0x4ec0f8(0x241)][_0x4ec0f8(0x2f8)](_0x3ac566['amount'],_0x3ac566[_0x4ec0f8(0x198)]);_0x4b9e8f[_0x4ec0f8(0x1cd)]=_0x2ad0e0;let _0x19fa28=0x2d;const _0x3fb78e=await _0x17c26c[_0x4ec0f8(0x24f)][_0x4ec0f8(0x1e5)]({'where':{'id':_0x3ac566[_0x4ec0f8(0x1c5)]},'select':{'gatewaySettings':!![]}});if(_0x3fb78e?.['gatewaySettings'])try{const _0x231f08=JSON[_0x4ec0f8(0x182)](_0x3fb78e[_0x4ec0f8(0x1a4)]);for(const [_0x49c38b,_0x1143b2]of Object[_0x4ec0f8(0x291)](_0x231f08)){if(_0x49c38b['toLowerCase']()===_0x3ac566[_0x4ec0f8(0x17b)]['toLowerCase']()){_0x19fa28=_0x1143b2[_0x4ec0f8(0x331)]||0xa;break;}}}catch(_0x390cb0){console['error'](_0x4ec0f8(0x299)+_0x22d854+':',_0x390cb0);}let _0x5a17b9;_0x3ac566['amountAfterGatewayCommissionUSDT']!==null&&_0x3ac566['amountAfterGatewayCommissionUSDT']!==undefined?(_0x5a17b9=_0x3ac566[_0x4ec0f8(0x2d5)],console[_0x4ec0f8(0x27e)]('üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x5a17b9[_0x4ec0f8(0x1f9)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x22d854)):(_0x5a17b9=_0x2ad0e0*(0x1-_0x19fa28/0x64),console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x232)+_0x22d854+':\x20'+_0x19fa28+_0x4ec0f8(0x1e3)+_0x2ad0e0['toFixed'](0x6)+'\x20USDT'),_0x4b9e8f[_0x4ec0f8(0x2d5)]=_0x5a17b9,_0x4b9e8f[_0x4ec0f8(0x220)]=_0x19fa28),_0xc0009a=_0x5a17b9,_0x5295d+=_0x5a17b9,console[_0x4ec0f8(0x27e)]('üí∞\x20Payment\x20'+_0x22d854+_0x4ec0f8(0x246)),console[_0x4ec0f8(0x27e)]('\x20\x20\x20Full\x20amount:\x20'+_0x2ad0e0[_0x4ec0f8(0x1f9)](0x6)+_0x4ec0f8(0x33d)),console[_0x4ec0f8(0x27e)]('\x20\x20\x20Gateway:\x20'+_0x3ac566[_0x4ec0f8(0x17b)]+',\x20Commission:\x20'+_0x19fa28+'%'),console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x201)+_0x5a17b9[_0x4ec0f8(0x1f9)](0x6)+_0x4ec0f8(0x261)+_0x19fa28+_0x4ec0f8(0x180)),console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x1f0)+_0x5a17b9[_0x4ec0f8(0x1f9)](0x6)+_0x4ec0f8(0x33d));}else{if(_0x29b270===_0x4ec0f8(0x1e7)&&_0x36a491!=='PAID'&&_0x36a491!=='CHARGEBACK'){if(_0x3ac566[_0x4ec0f8(0x1cd)]){let _0x1504d6=0x2d;const _0x543d5d=await _0x17c26c[_0x4ec0f8(0x24f)][_0x4ec0f8(0x1e5)]({'where':{'id':_0x3ac566[_0x4ec0f8(0x1c5)]},'select':{'gatewaySettings':!![]}});if(_0x543d5d?.[_0x4ec0f8(0x1a4)])try{const _0x3b63e9=JSON[_0x4ec0f8(0x182)](_0x543d5d['gatewaySettings']);for(const [_0x2c2f23,_0x5b6f6f]of Object[_0x4ec0f8(0x291)](_0x3b63e9)){if(_0x2c2f23[_0x4ec0f8(0x273)]()===_0x3ac566[_0x4ec0f8(0x17b)]['toLowerCase']()){_0x1504d6=_0x5b6f6f['commission']||0xa;break;}}}catch(_0x55b67d){console[_0x4ec0f8(0x320)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x22d854+':',_0x55b67d);}const _0x297a94=_0x3ac566[_0x4ec0f8(0x1cd)]*(0x1-_0x1504d6/0x64);_0xc0009a=-_0x297a94,_0x5295d-=_0x297a94,console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x188)+_0x3ac566[_0x4ec0f8(0x1cd)][_0x4ec0f8(0x1f9)](0x6)+_0x4ec0f8(0x33d)),console['log'](_0x4ec0f8(0x315)+_0x3ac566[_0x4ec0f8(0x17b)]+',\x20Commission:\x20'+_0x1504d6+'%'),console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x21c)+_0x297a94[_0x4ec0f8(0x1f9)](0x6)+_0x4ec0f8(0x261)+_0x1504d6+_0x4ec0f8(0x180)),console[_0x4ec0f8(0x27e)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x297a94[_0x4ec0f8(0x1f9)](0x6)+_0x4ec0f8(0x33d));}}}_0x36a491===_0x4ec0f8(0x208)&&(console['log']('üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x148f48&&_0x148f48>0x0?(_0xc0009a=-_0x148f48,_0x5295d-=_0x148f48,console['log'](_0x4ec0f8(0x1c7)+_0x148f48['toFixed'](0x6)+'\x20USDT\x20from\x20balance'),console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x1bb))):console['log'](_0x4ec0f8(0x1d5)),_0x4b9e8f['chargebackAmount']=_0x148f48||0x0);_0x36a491===_0x4ec0f8(0x1ff)&&_0x29b270===_0x4ec0f8(0x1e7)&&console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x2ef));const _0x2e1b6c=await _0x17c26c[_0x4ec0f8(0x2cc)]['update']({'where':{'id':_0x22d854},'data':_0x4b9e8f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xc0009a!==0x0&&(await _0x17c26c['shop'][_0x4ec0f8(0x26e)]({'where':{'id':_0x3ac566[_0x4ec0f8(0x1c5)]},'data':{'balance':_0x5295d}}),console[_0x4ec0f8(0x27e)](_0x4ec0f8(0x26d)+_0x3ac566[_0x4ec0f8(0x1c5)]+_0x4ec0f8(0x1bc)+_0x3ac566[_0x4ec0f8(0x24f)][_0x4ec0f8(0x21d)]['toFixed'](0x6)+_0x4ec0f8(0x18c)+_0x5295d[_0x4ec0f8(0x1f9)](0x6)+_0x4ec0f8(0x1f5)+(_0xc0009a>0x0?'+':'')+_0xc0009a[_0x4ec0f8(0x1f9)](0x6)+')')),_0x2e1b6c;});return{'id':_0x3bfeb6['id'],'shopId':_0x3bfeb6[_0x1106ab(0x1c5)],'gateway':_0x3bfeb6['gateway'],'amount':_0x3bfeb6['amount'],'currency':_0x3bfeb6[_0x1106ab(0x198)],'status':_0x3bfeb6[_0x1106ab(0x2f3)],'orderId':_0x3bfeb6[_0x1106ab(0x2df)],'gatewayOrderId':_0x3bfeb6[_0x1106ab(0x1a2)],'customerEmail':_0x3bfeb6['customerEmail'],'customerName':_0x3bfeb6[_0x1106ab(0x25b)],'customerCountry':_0x3bfeb6['customerCountry'],'customerIp':_0x3bfeb6[_0x1106ab(0x2ce)],'customerUa':_0x3bfeb6[_0x1106ab(0x217)],'failureMessage':_0x3bfeb6[_0x1106ab(0x33c)],'adminNotes':_0x3bfeb6[_0x1106ab(0x2ed)],'chargebackAmount':_0x3bfeb6[_0x1106ab(0x345)],'statusChangedBy':_0x3bfeb6['statusChangedBy'],'statusChangedAt':_0x3bfeb6[_0x1106ab(0x209)],'createdAt':_0x3bfeb6[_0x1106ab(0x23b)],'updatedAt':_0x3bfeb6[_0x1106ab(0x28c)],'shop':_0x3bfeb6['shop']};}async['updateUser'](_0x3924ba,_0x801e4e){const _0x45806b=a53_0x19793e,_0x2ddc14=Math[_0x45806b(0x326)]()['toString'](0x24)[_0x45806b(0x31c)](0x2,0x9);console[_0x45806b(0x27e)](_0x45806b(0x21e)+_0x2ddc14+_0x45806b(0x1d1)+_0x3924ba);const _0x3bd54e={..._0x801e4e};_0x801e4e[_0x45806b(0x271)]&&_0x801e4e['password']['trim']()!==''?(console[_0x45806b(0x27e)]('üîê\x20['+_0x2ddc14+']\x20Updating\x20password\x20for\x20user\x20'+_0x3924ba),_0x3bd54e[_0x45806b(0x271)]=await bcryptjs_1[_0x45806b(0x31b)]['hash'](_0x801e4e[_0x45806b(0x271)],0xc)):(console[_0x45806b(0x27e)](_0x45806b(0x282)+_0x2ddc14+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x3bd54e[_0x45806b(0x271)]);_0x801e4e[_0x45806b(0x1f3)]&&(_0x3bd54e[_0x45806b(0x2bc)]=_0x801e4e[_0x45806b(0x1f3)],delete _0x3bd54e['fullName']);_0x801e4e[_0x45806b(0x1d6)]&&(_0x3bd54e[_0x45806b(0x22a)]=_0x801e4e[_0x45806b(0x1d6)],delete _0x3bd54e[_0x45806b(0x1d6)]);_0x801e4e[_0x45806b(0x2b7)]&&(_0x3bd54e[_0x45806b(0x1d9)]=_0x801e4e[_0x45806b(0x2b7)],delete _0x3bd54e[_0x45806b(0x2b7)]);if(_0x801e4e['gateways']){const _0x484f27=_0x801e4e[_0x45806b(0x2b2)][_0x45806b(0x2e9)](_0x5922b5=>this['getGatewayInternalName'](_0x5922b5));console[_0x45806b(0x27e)]('üîÑ\x20Gateway\x20mapping:',_0x801e4e[_0x45806b(0x2b2)],'->',_0x484f27),_0x3bd54e[_0x45806b(0x2b6)]=JSON[_0x45806b(0x20c)](_0x484f27),delete _0x3bd54e[_0x45806b(0x2b2)];}_0x801e4e[_0x45806b(0x1a4)]&&(console[_0x45806b(0x27e)](_0x45806b(0x215)+_0x2ddc14+']\x20Gateway\x20settings\x20before\x20saving:',_0x801e4e[_0x45806b(0x1a4)]),_0x3bd54e[_0x45806b(0x1a4)]=JSON[_0x45806b(0x20c)](_0x801e4e[_0x45806b(0x1a4)]),console['log'](_0x45806b(0x215)+_0x2ddc14+']\x20Gateway\x20settings\x20JSON\x20string:',_0x3bd54e[_0x45806b(0x1a4)]));_0x801e4e[_0x45806b(0x322)]&&(_0x801e4e['wallets'][_0x45806b(0x1f2)]!==undefined&&(_0x3bd54e['usdtPolygonWallet']=_0x801e4e[_0x45806b(0x322)]['usdtPolygonWallet']||null),_0x801e4e['wallets'][_0x45806b(0x213)]!==undefined&&(_0x3bd54e[_0x45806b(0x213)]=_0x801e4e[_0x45806b(0x322)]['usdtTrcWallet']||null),_0x801e4e[_0x45806b(0x322)]['usdtErcWallet']!==undefined&&(_0x3bd54e[_0x45806b(0x229)]=_0x801e4e[_0x45806b(0x322)][_0x45806b(0x229)]||null),_0x801e4e[_0x45806b(0x322)][_0x45806b(0x2aa)]!==undefined&&(_0x3bd54e[_0x45806b(0x2aa)]=_0x801e4e[_0x45806b(0x322)][_0x45806b(0x2aa)]||null),delete _0x3bd54e[_0x45806b(0x322)]);const _0xd2e258=await database_1['default'][_0x45806b(0x24f)][_0x45806b(0x26e)]({'where':{'id':_0x3924ba},'data':_0x3bd54e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x45806b(0x27e)](_0x45806b(0x20a)+_0x2ddc14+_0x45806b(0x185),_0xd2e258[_0x45806b(0x1a4)]),{'id':_0xd2e258['id'],'fullName':_0xd2e258['name'],'username':_0xd2e258['username'],'telegramId':_0xd2e258['telegram'],'merchantUrl':_0xd2e258[_0x45806b(0x1d9)],'gateways':_0xd2e258['paymentGateways']?JSON[_0x45806b(0x182)](_0xd2e258[_0x45806b(0x2b6)]):null,'gatewaySettings':_0xd2e258['gatewaySettings']?JSON[_0x45806b(0x182)](_0xd2e258[_0x45806b(0x1a4)]):null,'publicKey':_0xd2e258[_0x45806b(0x1ca)],'wallets':{'usdtPolygonWallet':_0xd2e258['usdtPolygonWallet'],'usdtTrcWallet':_0xd2e258['usdtTrcWallet'],'usdtErcWallet':_0xd2e258['usdtErcWallet'],'usdcPolygonWallet':_0xd2e258['usdcPolygonWallet']},'status':_0xd2e258[_0x45806b(0x2f3)],'createdAt':_0xd2e258[_0x45806b(0x23b)]};}async[a53_0x19793e(0x1e6)](_0x34843d){const _0x15c3f6=a53_0x19793e,_0xb3ec8c=await database_1[_0x15c3f6(0x31b)]['shop'][_0x15c3f6(0x26e)]({'where':{'id':_0x34843d},'data':{'status':_0x15c3f6(0x1c2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xb3ec8c['id'],'fullName':_0xb3ec8c[_0x15c3f6(0x2bc)],'username':_0xb3ec8c['username'],'telegramId':_0xb3ec8c[_0x15c3f6(0x22a)],'merchantUrl':_0xb3ec8c[_0x15c3f6(0x1d9)],'gateways':_0xb3ec8c['paymentGateways']?JSON[_0x15c3f6(0x182)](_0xb3ec8c['paymentGateways']):null,'gatewaySettings':_0xb3ec8c[_0x15c3f6(0x1a4)]?JSON['parse'](_0xb3ec8c[_0x15c3f6(0x1a4)]):null,'publicKey':_0xb3ec8c[_0x15c3f6(0x1ca)],'wallets':{'usdtPolygonWallet':_0xb3ec8c[_0x15c3f6(0x1f2)],'usdtTrcWallet':_0xb3ec8c[_0x15c3f6(0x213)],'usdtErcWallet':_0xb3ec8c['usdtErcWallet'],'usdcPolygonWallet':_0xb3ec8c['usdcPolygonWallet']},'status':_0xb3ec8c['status'],'createdAt':_0xb3ec8c['createdAt']};}async['activateUser'](_0x5cee74){const _0x5bde1a=a53_0x19793e,_0x4a896f=await database_1[_0x5bde1a(0x31b)]['shop']['update']({'where':{'id':_0x5cee74},'data':{'status':_0x5bde1a(0x334)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4a896f['id'],'fullName':_0x4a896f[_0x5bde1a(0x2bc)],'username':_0x4a896f[_0x5bde1a(0x33a)],'telegramId':_0x4a896f['telegram'],'merchantUrl':_0x4a896f[_0x5bde1a(0x1d9)],'gateways':_0x4a896f[_0x5bde1a(0x2b6)]?JSON[_0x5bde1a(0x182)](_0x4a896f[_0x5bde1a(0x2b6)]):null,'gatewaySettings':_0x4a896f[_0x5bde1a(0x1a4)]?JSON[_0x5bde1a(0x182)](_0x4a896f[_0x5bde1a(0x1a4)]):null,'publicKey':_0x4a896f['publicKey'],'wallets':{'usdtPolygonWallet':_0x4a896f[_0x5bde1a(0x1f2)],'usdtTrcWallet':_0x4a896f[_0x5bde1a(0x213)],'usdtErcWallet':_0x4a896f[_0x5bde1a(0x229)],'usdcPolygonWallet':_0x4a896f[_0x5bde1a(0x2aa)]},'status':_0x4a896f[_0x5bde1a(0x2f3)],'createdAt':_0x4a896f[_0x5bde1a(0x23b)]};}async['getAllUsers'](_0x45f85e){const _0x42fc9f=a53_0x19793e,{page:_0x1b093f,limit:_0x5591c8,status:_0x1be199,search:_0x551386}=_0x45f85e,_0x41558d=(_0x1b093f-0x1)*_0x5591c8,_0x2f63d8={};_0x1be199&&(_0x2f63d8[_0x42fc9f(0x2f3)]=_0x1be199[_0x42fc9f(0x2e1)]());_0x551386&&(_0x2f63d8['OR']=[{'name':{'contains':_0x551386,'mode':_0x42fc9f(0x2bb)}},{'username':{'contains':_0x551386,'mode':_0x42fc9f(0x2bb)}},{'telegram':{'contains':_0x551386,'mode':_0x42fc9f(0x2bb)}},{'shopUrl':{'contains':_0x551386,'mode':'insensitive'}}]);const [_0x2345d7,_0x5d7f12]=await Promise['all']([database_1['default'][_0x42fc9f(0x24f)]['findMany']({'where':_0x2f63d8,'skip':_0x41558d,'take':_0x5591c8,'orderBy':{'createdAt':_0x42fc9f(0x1fc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x42fc9f(0x31b)]['shop'][_0x42fc9f(0x2ff)]({'where':_0x2f63d8})]);return{'users':_0x2345d7[_0x42fc9f(0x2e9)](_0x2b6e1c=>{const _0x12a40c=_0x42fc9f,_0x12c5fb=_0x2b6e1c['paymentGateways']?JSON[_0x12a40c(0x182)](_0x2b6e1c[_0x12a40c(0x2b6)]):null,_0x1b74d8=_0x12c5fb?_0x12c5fb[_0x12a40c(0x2e9)](_0x4d44b1=>this[_0x12a40c(0x236)](_0x4d44b1)):null;return{'id':_0x2b6e1c['id'],'fullName':_0x2b6e1c['name'],'username':_0x2b6e1c['username'],'telegramId':_0x2b6e1c[_0x12a40c(0x22a)],'merchantUrl':_0x2b6e1c[_0x12a40c(0x1d9)],'gateways':_0x1b74d8,'gatewaySettings':_0x2b6e1c[_0x12a40c(0x1a4)]?JSON[_0x12a40c(0x182)](_0x2b6e1c[_0x12a40c(0x1a4)]):null,'publicKey':_0x2b6e1c[_0x12a40c(0x1ca)],'wallets':{'usdtPolygonWallet':_0x2b6e1c[_0x12a40c(0x1f2)],'usdtTrcWallet':_0x2b6e1c[_0x12a40c(0x213)],'usdtErcWallet':_0x2b6e1c[_0x12a40c(0x229)],'usdcPolygonWallet':_0x2b6e1c[_0x12a40c(0x2aa)],'usdcErcWallet':_0x2b6e1c[_0x12a40c(0x327)]},'status':_0x2b6e1c[_0x12a40c(0x2f3)],'twoFactorEnabled':_0x2b6e1c[_0x12a40c(0x2db)]||![],'telegramUsersCount':_0x2b6e1c['_count']['telegramUsers'],'createdAt':_0x2b6e1c[_0x12a40c(0x23b)],'lastLoginAt':_0x2b6e1c[_0x12a40c(0x347)]};}),'pagination':{'page':_0x1b093f,'limit':_0x5591c8,'total':_0x5d7f12,'totalPages':Math[_0x42fc9f(0x2be)](_0x5d7f12/_0x5591c8)}};}async[a53_0x19793e(0x32d)](_0x108a41){const _0xcf93c3=a53_0x19793e,_0x196c2f=await database_1[_0xcf93c3(0x31b)][_0xcf93c3(0x24f)][_0xcf93c3(0x1e5)]({'where':{'id':_0x108a41},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x196c2f)return null;const _0x356ad2=_0x196c2f[_0xcf93c3(0x2b6)]?JSON['parse'](_0x196c2f[_0xcf93c3(0x2b6)]):null,_0x55a6d9=_0x356ad2?_0x356ad2[_0xcf93c3(0x2e9)](_0x1984ed=>this[_0xcf93c3(0x236)](_0x1984ed)):null;return _0x356ad2&&_0x55a6d9&&console[_0xcf93c3(0x27e)](_0xcf93c3(0x22b),_0x356ad2,'->',_0x55a6d9),{'id':_0x196c2f['id'],'fullName':_0x196c2f[_0xcf93c3(0x2bc)],'username':_0x196c2f[_0xcf93c3(0x33a)],'telegramId':_0x196c2f[_0xcf93c3(0x22a)],'merchantUrl':_0x196c2f[_0xcf93c3(0x1d9)],'gateways':_0x55a6d9,'gatewaySettings':_0x196c2f[_0xcf93c3(0x1a4)]?JSON[_0xcf93c3(0x182)](_0x196c2f[_0xcf93c3(0x1a4)]):null,'publicKey':_0x196c2f[_0xcf93c3(0x1ca)],'wallets':{'usdtPolygonWallet':_0x196c2f[_0xcf93c3(0x1f2)],'usdtTrcWallet':_0x196c2f[_0xcf93c3(0x213)],'usdtErcWallet':_0x196c2f[_0xcf93c3(0x229)],'usdcPolygonWallet':_0x196c2f[_0xcf93c3(0x2aa)],'usdcErcWallet':_0x196c2f['usdcErcWallet']},'status':_0x196c2f[_0xcf93c3(0x2f3)],'createdAt':_0x196c2f['createdAt']};}async[a53_0x19793e(0x346)](_0x5ad957){const _0x465e88=a53_0x19793e,{fullName:_0x3b3c69,username:_0x5c6d45,password:_0x5a5c2c,telegramId:_0x2b8f7b,merchantUrl:_0x211b08,gateways:_0x28101c,gatewaySettings:_0x50bd70,wallets:_0x4fd422}=_0x5ad957,_0x390214=await database_1['default'][_0x465e88(0x24f)][_0x465e88(0x1e5)]({'where':{'username':_0x5c6d45}});if(_0x390214)throw new Error(_0x465e88(0x280));if(_0x2b8f7b){const _0x26e7bd=await database_1[_0x465e88(0x31b)][_0x465e88(0x24f)][_0x465e88(0x1e5)]({'where':{'telegram':_0x2b8f7b}});if(_0x26e7bd)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x14b4e2=await bcryptjs_1[_0x465e88(0x31b)][_0x465e88(0x311)](_0x5a5c2c,0xc),_0x20f95d=_0x465e88(0x272)+crypto_1[_0x465e88(0x31b)][_0x465e88(0x2a8)](0x20)[_0x465e88(0x28d)](_0x465e88(0x2ac)),_0x653b40=_0x465e88(0x203)+crypto_1[_0x465e88(0x31b)]['randomBytes'](0x20)[_0x465e88(0x28d)](_0x465e88(0x2ac)),_0x2e72f7=_0x28101c?_0x28101c[_0x465e88(0x2e9)](_0x26500b=>this[_0x465e88(0x265)](_0x26500b)):null;_0x28101c&&_0x2e72f7&&console[_0x465e88(0x27e)](_0x465e88(0x186),_0x28101c,'->',_0x2e72f7);const _0xde9369=await database_1[_0x465e88(0x31b)]['shop'][_0x465e88(0x19f)]({'data':{'name':_0x3b3c69,'username':_0x5c6d45,'password':_0x14b4e2,'telegram':_0x2b8f7b,'shopUrl':_0x211b08,'paymentGateways':_0x2e72f7?JSON[_0x465e88(0x20c)](_0x2e72f7):null,'gatewaySettings':_0x50bd70?JSON['stringify'](_0x50bd70):null,'usdtPolygonWallet':_0x4fd422?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x4fd422?.['usdtTrcWallet']||null,'usdtErcWallet':_0x4fd422?.[_0x465e88(0x229)]||null,'usdcPolygonWallet':_0x4fd422?.[_0x465e88(0x2aa)]||null,'publicKey':_0x20f95d,'secretKey':_0x653b40,'status':_0x465e88(0x334)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xde9369['id'],'fullName':_0xde9369[_0x465e88(0x2bc)],'username':_0xde9369[_0x465e88(0x33a)],'telegramId':_0xde9369[_0x465e88(0x22a)],'merchantUrl':_0xde9369['shopUrl'],'gateways':_0xde9369['paymentGateways']?JSON[_0x465e88(0x182)](_0xde9369[_0x465e88(0x2b6)]):null,'gatewaySettings':_0xde9369[_0x465e88(0x1a4)]?JSON[_0x465e88(0x182)](_0xde9369['gatewaySettings']):null,'publicKey':_0xde9369[_0x465e88(0x1ca)],'wallets':{'usdtPolygonWallet':_0xde9369[_0x465e88(0x1f2)],'usdtTrcWallet':_0xde9369[_0x465e88(0x213)],'usdtErcWallet':_0xde9369[_0x465e88(0x229)],'usdcPolygonWallet':_0xde9369[_0x465e88(0x2aa)]},'status':_0xde9369[_0x465e88(0x2f3)],'createdAt':_0xde9369[_0x465e88(0x23b)]};}async[a53_0x19793e(0x1b4)](_0x1a851b,_0x3c51fd){const _0x1b7335=a53_0x19793e;if(config_1['config'][_0x1b7335(0x226)][_0x1b7335(0x2db)]){if(!_0x3c51fd)throw new Error(_0x1b7335(0x21b));const _0x5b0f1d=speakeasy_1['default']['totp'][_0x1b7335(0x277)]({'secret':config_1[_0x1b7335(0x312)]['admin']['twoFactorSecret'],'encoding':'base32','token':_0x3c51fd,'window':0x2});if(!_0x5b0f1d){let _0x38024f=![];if(config_1['config'][_0x1b7335(0x226)][_0x1b7335(0x2c5)]){const _0x4cd86e=JSON[_0x1b7335(0x182)](config_1[_0x1b7335(0x312)][_0x1b7335(0x226)][_0x1b7335(0x2c5)]);for(let _0x3edbd9=0x0;_0x3edbd9<_0x4cd86e[_0x1b7335(0x2f7)];_0x3edbd9++){const _0x49f533=await bcryptjs_1['default'][_0x1b7335(0x1da)](_0x3c51fd,_0x4cd86e[_0x3edbd9]);if(_0x49f533){_0x38024f=!![],_0x4cd86e[_0x1b7335(0x254)](_0x3edbd9,0x1),config_1[_0x1b7335(0x312)][_0x1b7335(0x226)][_0x1b7335(0x2c5)]=JSON[_0x1b7335(0x20c)](_0x4cd86e);const _0xbab250=path_1[_0x1b7335(0x31b)]['join'](process[_0x1b7335(0x2bd)](),_0x1b7335(0x240));if(fs_1['default'][_0x1b7335(0x281)](_0xbab250)){let _0x267b4=fs_1['default'][_0x1b7335(0x195)](_0xbab250,_0x1b7335(0x1c9));const _0x7bd8f5=_0x267b4[_0x1b7335(0x251)]('\x0a');for(let _0x32217e=0x0;_0x32217e<_0x7bd8f5['length'];_0x32217e++){if(_0x7bd8f5[_0x32217e][_0x1b7335(0x2c4)]('ADMIN_BACKUP_CODES=')){_0x7bd8f5[_0x32217e]=_0x1b7335(0x230)+JSON[_0x1b7335(0x20c)](_0x4cd86e);break;}}fs_1[_0x1b7335(0x31b)][_0x1b7335(0x34f)](_0xbab250,_0x7bd8f5[_0x1b7335(0x1cb)]('\x0a'),_0x1b7335(0x1c9));}break;}}}if(!_0x38024f)throw new Error(_0x1b7335(0x18a));}}await database_1[_0x1b7335(0x31b)][_0x1b7335(0x24f)][_0x1b7335(0x2dc)]({'where':{'id':_0x1a851b}});}async['getShopWallets'](_0x323890){const _0x5bf397=a53_0x19793e,_0x37f32e=await database_1[_0x5bf397(0x31b)]['shop'][_0x5bf397(0x1e5)]({'where':{'id':_0x323890},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x37f32e)throw new Error(_0x5bf397(0x2c8));return{'usdtPolygonWallet':_0x37f32e[_0x5bf397(0x1f2)],'usdtTrcWallet':_0x37f32e[_0x5bf397(0x213)],'usdtErcWallet':_0x37f32e['usdtErcWallet'],'usdcPolygonWallet':_0x37f32e[_0x5bf397(0x2aa)],'usdcErcWallet':_0x37f32e[_0x5bf397(0x327)]};}[a53_0x19793e(0x1a0)](_0x2b3d44=0x8){const _0x1ced73=a53_0x19793e,_0x56cb91=[];for(let _0x4e672c=0x0;_0x4e672c<_0x2b3d44;_0x4e672c++){const _0x343aa4=crypto_1[_0x1ced73(0x31b)][_0x1ced73(0x2a8)](0x4)['toString'](_0x1ced73(0x2ac))[_0x1ced73(0x2e1)]();_0x56cb91['push'](_0x343aa4);}return _0x56cb91;}async[a53_0x19793e(0x29f)](_0x491acf){const _0x25f90d=a53_0x19793e,_0x394da9=await database_1[_0x25f90d(0x31b)][_0x25f90d(0x24f)][_0x25f90d(0x1e5)]({'where':{'id':_0x491acf},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x394da9)throw new Error(_0x25f90d(0x2c8));const _0xde8d96=speakeasy_1[_0x25f90d(0x31b)]['generateSecret']({'name':'TrapaPay\x20('+_0x394da9['username']+')','issuer':'TrapaPay','length':0x20}),_0x279033=await qrcode_1[_0x25f90d(0x31b)]['toDataURL'](_0xde8d96['otpauth_url']),_0x1cfd6f=this[_0x25f90d(0x1a0)](0x8),_0x164b52=await Promise['all'](_0x1cfd6f[_0x25f90d(0x2e9)](_0x57bd50=>bcryptjs_1[_0x25f90d(0x31b)][_0x25f90d(0x311)](_0x57bd50,0xa)));return await database_1[_0x25f90d(0x31b)][_0x25f90d(0x24f)][_0x25f90d(0x26e)]({'where':{'id':_0x491acf},'data':{'twoFactorSecret':_0xde8d96[_0x25f90d(0x1fb)],'backupCodes':JSON[_0x25f90d(0x20c)](_0x164b52)}}),console['log'](_0x25f90d(0x24d)+_0x394da9['username']),console[_0x25f90d(0x27e)](_0x25f90d(0x199)+_0x1cfd6f[_0x25f90d(0x2f7)]+'\x20backup\x20codes'),{'secret':_0xde8d96[_0x25f90d(0x1fb)],'qrCode':_0x279033,'manualEntryKey':_0xde8d96[_0x25f90d(0x1fb)],'backupCodes':_0x1cfd6f};}async[a53_0x19793e(0x330)](_0x286266,_0x588f19){const _0xb6ccd7=a53_0x19793e,_0x413d82=await database_1[_0xb6ccd7(0x31b)][_0xb6ccd7(0x24f)][_0xb6ccd7(0x1e5)]({'where':{'id':_0x286266},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x413d82)throw new Error(_0xb6ccd7(0x2c8));if(!_0x413d82[_0xb6ccd7(0x19e)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x413d82[_0xb6ccd7(0x2db)])throw new Error(_0xb6ccd7(0x2f4));const _0x555022=speakeasy_1['default'][_0xb6ccd7(0x32e)][_0xb6ccd7(0x277)]({'secret':_0x413d82['twoFactorSecret'],'encoding':'base32','token':_0x588f19,'window':0x2});if(!_0x555022)throw new Error(_0xb6ccd7(0x193));return await database_1['default'][_0xb6ccd7(0x24f)][_0xb6ccd7(0x26e)]({'where':{'id':_0x286266},'data':{'twoFactorEnabled':!![]}}),console[_0xb6ccd7(0x27e)]('üîê\x202FA\x20enabled\x20for\x20shop:\x20'+_0x413d82['username']),{'enabled':!![]};}async[a53_0x19793e(0x2a2)](_0x254918){const _0x5eeb4e=a53_0x19793e,_0x12b191=await database_1[_0x5eeb4e(0x31b)][_0x5eeb4e(0x24f)][_0x5eeb4e(0x1e5)]({'where':{'id':_0x254918},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x12b191)throw new Error(_0x5eeb4e(0x2c8));await database_1[_0x5eeb4e(0x31b)][_0x5eeb4e(0x24f)]['update']({'where':{'id':_0x254918},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x5eeb4e(0x27e)](_0x5eeb4e(0x18b)+_0x12b191[_0x5eeb4e(0x33a)]);}async[a53_0x19793e(0x302)](_0x40875f,_0x5bc1a4,_0x426a73,_0x28452a){const _0x18e03f=a53_0x19793e;if(_0x5bc1a4!==_0x426a73)throw new Error(_0x18e03f(0x32b));if(_0x5bc1a4[_0x18e03f(0x2f7)]<0x6)throw new Error(_0x18e03f(0x305));const _0xf41c30=await bcryptjs_1[_0x18e03f(0x31b)][_0x18e03f(0x1da)](_0x40875f,config_1[_0x18e03f(0x312)][_0x18e03f(0x226)][_0x18e03f(0x30a)]);if(!_0xf41c30)throw new Error(_0x18e03f(0x316));if(config_1[_0x18e03f(0x312)]['admin'][_0x18e03f(0x2db)]){if(!_0x28452a)throw new Error(_0x18e03f(0x21b));const _0x31359b=speakeasy_1['default'][_0x18e03f(0x32e)][_0x18e03f(0x277)]({'secret':config_1['config'][_0x18e03f(0x226)]['twoFactorSecret'],'encoding':_0x18e03f(0x1fb),'token':_0x28452a,'window':0x2});if(!_0x31359b){let _0xa95ee5=![];if(config_1[_0x18e03f(0x312)][_0x18e03f(0x226)][_0x18e03f(0x2c5)]){const _0x53b319=JSON['parse'](config_1['config']['admin'][_0x18e03f(0x2c5)]);for(let _0x5a5290=0x0;_0x5a5290<_0x53b319[_0x18e03f(0x2f7)];_0x5a5290++){const _0x48d12b=await bcryptjs_1[_0x18e03f(0x31b)][_0x18e03f(0x1da)](_0x28452a,_0x53b319[_0x5a5290]);if(_0x48d12b){_0xa95ee5=!![],_0x53b319[_0x18e03f(0x254)](_0x5a5290,0x1),config_1[_0x18e03f(0x312)][_0x18e03f(0x226)][_0x18e03f(0x2c5)]=JSON[_0x18e03f(0x20c)](_0x53b319);const _0x18a6a8=path_1[_0x18e03f(0x31b)][_0x18e03f(0x1cb)](process[_0x18e03f(0x2bd)](),_0x18e03f(0x240));if(fs_1[_0x18e03f(0x31b)]['existsSync'](_0x18a6a8)){let _0x12529f=fs_1['default'][_0x18e03f(0x195)](_0x18a6a8,_0x18e03f(0x1c9));const _0x3be088=_0x12529f['split']('\x0a');for(let _0x3fbc2b=0x0;_0x3fbc2b<_0x3be088['length'];_0x3fbc2b++){if(_0x3be088[_0x3fbc2b][_0x18e03f(0x2c4)]('ADMIN_BACKUP_CODES=')){_0x3be088[_0x3fbc2b]=_0x18e03f(0x230)+JSON[_0x18e03f(0x20c)](_0x53b319);break;}}fs_1[_0x18e03f(0x31b)]['writeFileSync'](_0x18a6a8,_0x3be088['join']('\x0a'),_0x18e03f(0x1c9));}break;}}}if(!_0xa95ee5)throw new Error(_0x18e03f(0x18a));}}const _0x2475b3=await bcryptjs_1[_0x18e03f(0x31b)][_0x18e03f(0x311)](_0x5bc1a4,0xc);config_1['config'][_0x18e03f(0x226)][_0x18e03f(0x30a)]=_0x2475b3;const _0x38dfdd=path_1[_0x18e03f(0x31b)]['join'](process['cwd'](),'.env');let _0x2fdd6f='';if(fs_1[_0x18e03f(0x31b)][_0x18e03f(0x281)](_0x38dfdd)){_0x2fdd6f=fs_1[_0x18e03f(0x31b)][_0x18e03f(0x195)](_0x38dfdd,_0x18e03f(0x1c9));const _0xe51c4d=_0x2fdd6f['split']('\x0a');let _0x317741=![];for(let _0x21f433=0x0;_0x21f433<_0xe51c4d[_0x18e03f(0x2f7)];_0x21f433++){if(_0xe51c4d[_0x21f433]['startsWith']('ADMIN_PASSWORD_HASH=')){_0xe51c4d[_0x21f433]='ADMIN_PASSWORD_HASH='+_0x2475b3,_0x317741=!![];break;}}!_0x317741&&_0xe51c4d[_0x18e03f(0x29e)](_0x18e03f(0x19a)+_0x2475b3),_0x2fdd6f=_0xe51c4d[_0x18e03f(0x1cb)]('\x0a'),fs_1[_0x18e03f(0x31b)][_0x18e03f(0x34f)](_0x38dfdd,_0x2fdd6f,_0x18e03f(0x1c9));}console[_0x18e03f(0x27e)](_0x18e03f(0x25e));}async[a53_0x19793e(0x1ab)](){const _0x4f3406=a53_0x19793e;let _0x110fb9=0x0;if(config_1['config'][_0x4f3406(0x226)]['backupCodes'])try{const _0x50a69f=JSON[_0x4f3406(0x182)](config_1['config'][_0x4f3406(0x226)][_0x4f3406(0x2c5)]);_0x110fb9=_0x50a69f[_0x4f3406(0x2f7)];}catch(_0x4d43e0){console['error'](_0x4f3406(0x191),_0x4d43e0);}return{'twoFactorEnabled':config_1[_0x4f3406(0x312)]['admin'][_0x4f3406(0x2db)],'backupCodesCount':_0x110fb9};}async['setupAdmin2FA'](){const _0x2b934e=a53_0x19793e,_0xace84=speakeasy_1[_0x2b934e(0x31b)][_0x2b934e(0x34e)]({'name':_0x2b934e(0x233)+config_1['config'][_0x2b934e(0x226)][_0x2b934e(0x33a)]+')','issuer':_0x2b934e(0x224),'length':0x20}),_0x2bf1a9=await qrcode_1[_0x2b934e(0x31b)][_0x2b934e(0x323)](_0xace84[_0x2b934e(0x27a)]),_0xa61824=[];for(let _0x193763=0x0;_0x193763<0x8;_0x193763++){const _0x1a4f9c=crypto_1[_0x2b934e(0x31b)][_0x2b934e(0x2a8)](0x4)[_0x2b934e(0x28d)](_0x2b934e(0x2ac))['toUpperCase']();_0xa61824[_0x2b934e(0x29e)](_0x1a4f9c);}const _0x386865=await Promise['all'](_0xa61824[_0x2b934e(0x2e9)](_0x34d021=>bcryptjs_1[_0x2b934e(0x31b)]['hash'](_0x34d021,0xa)));config_1[_0x2b934e(0x312)][_0x2b934e(0x226)][_0x2b934e(0x19e)]=_0xace84[_0x2b934e(0x1fb)],config_1['config'][_0x2b934e(0x226)][_0x2b934e(0x2c5)]=JSON[_0x2b934e(0x20c)](_0x386865);const _0x36fb17=path_1[_0x2b934e(0x31b)][_0x2b934e(0x1cb)](process[_0x2b934e(0x2bd)](),_0x2b934e(0x240));if(fs_1[_0x2b934e(0x31b)][_0x2b934e(0x281)](_0x36fb17)){let _0x4d9d74=fs_1['default'][_0x2b934e(0x195)](_0x36fb17,_0x2b934e(0x1c9));const _0x39b12e=_0x4d9d74['split']('\x0a');let _0x8d0000=![],_0x23519a=![];for(let _0x2f9e37=0x0;_0x2f9e37<_0x39b12e[_0x2b934e(0x2f7)];_0x2f9e37++){_0x39b12e[_0x2f9e37][_0x2b934e(0x2c4)](_0x2b934e(0x30c))&&(_0x39b12e[_0x2f9e37]=_0x2b934e(0x30c)+_0xace84['base32'],_0x8d0000=!![]),_0x39b12e[_0x2f9e37][_0x2b934e(0x2c4)](_0x2b934e(0x230))&&(_0x39b12e[_0x2f9e37]='ADMIN_BACKUP_CODES='+JSON[_0x2b934e(0x20c)](_0x386865),_0x23519a=!![]);}if(!_0x8d0000)_0x39b12e[_0x2b934e(0x29e)](_0x2b934e(0x30c)+_0xace84[_0x2b934e(0x1fb)]);if(!_0x23519a)_0x39b12e[_0x2b934e(0x29e)](_0x2b934e(0x230)+JSON[_0x2b934e(0x20c)](_0x386865));fs_1[_0x2b934e(0x31b)][_0x2b934e(0x34f)](_0x36fb17,_0x39b12e[_0x2b934e(0x1cb)]('\x0a'),'utf8');}return console[_0x2b934e(0x27e)](_0x2b934e(0x275)),console[_0x2b934e(0x27e)](_0x2b934e(0x199)+_0xa61824[_0x2b934e(0x2f7)]+_0x2b934e(0x245)),{'secret':_0xace84[_0x2b934e(0x1fb)],'qrCode':_0x2bf1a9,'manualEntryKey':_0xace84['base32'],'backupCodes':_0xa61824};}async[a53_0x19793e(0x2e7)](_0x45b2a3){const _0x102a14=a53_0x19793e;if(!config_1[_0x102a14(0x312)][_0x102a14(0x226)][_0x102a14(0x19e)])throw new Error(_0x102a14(0x17e));if(config_1['config'][_0x102a14(0x226)]['twoFactorEnabled'])throw new Error(_0x102a14(0x2f4));const _0x46063a=speakeasy_1[_0x102a14(0x31b)][_0x102a14(0x32e)][_0x102a14(0x277)]({'secret':config_1[_0x102a14(0x312)][_0x102a14(0x226)][_0x102a14(0x19e)],'encoding':_0x102a14(0x1fb),'token':_0x45b2a3,'window':0x2});if(!_0x46063a)throw new Error(_0x102a14(0x193));config_1[_0x102a14(0x312)]['admin'][_0x102a14(0x2db)]=!![];const _0x3cbcd4=path_1[_0x102a14(0x31b)][_0x102a14(0x1cb)](process[_0x102a14(0x2bd)](),_0x102a14(0x240));if(fs_1[_0x102a14(0x31b)]['existsSync'](_0x3cbcd4)){let _0x3e3cf5=fs_1[_0x102a14(0x31b)][_0x102a14(0x195)](_0x3cbcd4,_0x102a14(0x1c9));const _0x2917e4=_0x3e3cf5['split']('\x0a');let _0x40b097=![];for(let _0x438209=0x0;_0x438209<_0x2917e4[_0x102a14(0x2f7)];_0x438209++){if(_0x2917e4[_0x438209][_0x102a14(0x2c4)](_0x102a14(0x267))){_0x2917e4[_0x438209]='ADMIN_2FA_ENABLED=true',_0x40b097=!![];break;}}if(!_0x40b097)_0x2917e4['push'](_0x102a14(0x216));fs_1[_0x102a14(0x31b)][_0x102a14(0x34f)](_0x3cbcd4,_0x2917e4[_0x102a14(0x1cb)]('\x0a'),'utf8');}return console[_0x102a14(0x27e)](_0x102a14(0x259)),{'enabled':!![]};}async['disableAdmin2FA'](){const _0x3e8622=a53_0x19793e;config_1[_0x3e8622(0x312)][_0x3e8622(0x226)][_0x3e8622(0x2db)]=![],config_1['config']['admin'][_0x3e8622(0x19e)]='',config_1['config'][_0x3e8622(0x226)][_0x3e8622(0x2c5)]='';const _0x1b4284=path_1[_0x3e8622(0x31b)][_0x3e8622(0x1cb)](process[_0x3e8622(0x2bd)](),_0x3e8622(0x240));if(fs_1[_0x3e8622(0x31b)][_0x3e8622(0x281)](_0x1b4284)){let _0x42d0b5=fs_1['default']['readFileSync'](_0x1b4284,_0x3e8622(0x1c9));const _0x44a049=_0x42d0b5['split']('\x0a');for(let _0x2f1e19=0x0;_0x2f1e19<_0x44a049[_0x3e8622(0x2f7)];_0x2f1e19++){_0x44a049[_0x2f1e19][_0x3e8622(0x2c4)](_0x3e8622(0x267))&&(_0x44a049[_0x2f1e19]='ADMIN_2FA_ENABLED=false'),_0x44a049[_0x2f1e19][_0x3e8622(0x2c4)](_0x3e8622(0x30c))&&(_0x44a049[_0x2f1e19]='ADMIN_2FA_SECRET='),_0x44a049[_0x2f1e19][_0x3e8622(0x2c4)](_0x3e8622(0x230))&&(_0x44a049[_0x2f1e19]='ADMIN_BACKUP_CODES=');}fs_1[_0x3e8622(0x31b)]['writeFileSync'](_0x1b4284,_0x44a049[_0x3e8622(0x1cb)]('\x0a'),_0x3e8622(0x1c9));}console[_0x3e8622(0x27e)](_0x3e8622(0x268));}['generateDailyStatistics'](_0x172da3,_0x531bde,_0x10257e){const _0x24438c=a53_0x19793e,_0x599db3=new Map(),_0x558bcf=new Date(_0x531bde);while(_0x558bcf<=_0x10257e){const _0xdfa331=_0x558bcf['toISOString']()['split']('T')[0x0];_0x599db3[_0x24438c(0x313)](_0xdfa331,{'revenue':0x0,'count':0x0}),_0x558bcf['setDate'](_0x558bcf[_0x24438c(0x2d1)]()+0x1);}for(const _0xa190f9 of _0x172da3){const _0x4f67ba=_0xa190f9[_0x24438c(0x23b)]['toISOString']()[_0x24438c(0x251)]('T')[0x0],_0x4ab7eb=_0x599db3[_0x24438c(0x2b1)](_0x4f67ba);_0x4ab7eb&&(_0x4ab7eb[_0x24438c(0x2ff)]+=0x1,_0xa190f9[_0x24438c(0x2f3)]===_0x24438c(0x1e7)&&(_0xa190f9[_0x24438c(0x1cd)]?_0x4ab7eb[_0x24438c(0x24b)]+=_0xa190f9[_0x24438c(0x1cd)]:console[_0x24438c(0x27e)](_0x24438c(0x290)+_0xa190f9['id']+_0x24438c(0x318))));}const _0x2c38f5=[],_0x2370b9=[];for(const [_0x2bef5d,_0x4066f6]of _0x599db3){_0x2c38f5[_0x24438c(0x29e)]({'date':_0x2bef5d,'amount':Math[_0x24438c(0x348)](_0x4066f6[_0x24438c(0x24b)]*0x64)/0x64}),_0x2370b9[_0x24438c(0x29e)]({'date':_0x2bef5d,'count':_0x4066f6[_0x24438c(0x2ff)]});}return{'dailyRevenue':_0x2c38f5,'dailyPayments':_0x2370b9};}async[a53_0x19793e(0x200)](_0x581234){const _0x1309aa=a53_0x19793e;console['log'](_0x1309aa(0x1f7),_0x581234);const _0x4c8fd5=new Date(_0x581234[_0x1309aa(0x2cf)]),_0xf979c8=new Date(_0x581234['periodTo']),_0x5bcfcb=new Date(Date['UTC'](_0x4c8fd5[_0x1309aa(0x2dd)](),_0x4c8fd5[_0x1309aa(0x31a)](),_0x4c8fd5[_0x1309aa(0x2a6)](),0x0,0x0,0x0,0x0)),_0xca0e70=new Date(Date['UTC'](_0xf979c8[_0x1309aa(0x2dd)](),_0xf979c8['getUTCMonth'](),_0xf979c8[_0x1309aa(0x2a6)](),0x17,0x3b,0x3b,0x3e7));console[_0x1309aa(0x27e)](_0x1309aa(0x207)+_0x5bcfcb[_0x1309aa(0x26b)]()+_0x1309aa(0x1ba)+_0xca0e70[_0x1309aa(0x26b)]()),console[_0x1309aa(0x27e)](_0x1309aa(0x324)+_0x581234['gateway']);const _0xc9338b=await database_1[_0x1309aa(0x31b)][_0x1309aa(0x2cc)][_0x1309aa(0x242)]({'where':{'status':_0x1309aa(0x1e7),'gateway':_0x581234[_0x1309aa(0x17b)][_0x1309aa(0x273)](),'createdAt':{'gte':_0x5bcfcb,'lte':_0xca0e70}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x1309aa(0x27e)](_0x1309aa(0x1eb)+_0xc9338b[_0x1309aa(0x2f7)]+'\x20paid\x20payments\x20for\x20gateway\x20'+_0x581234[_0x1309aa(0x17b)]);const _0x348b69=new Map();for(const _0x5529d0 of _0xc9338b){const _0xfdb5cb=_0x5529d0[_0x1309aa(0x2d5)]||0x0;if(_0xfdb5cb<=0x0){console[_0x1309aa(0x279)](_0x1309aa(0x290)+_0x5529d0['id']+'\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...');continue;}if(_0x348b69[_0x1309aa(0x344)](_0x5529d0[_0x1309aa(0x1c5)])){const _0x1ce621=_0x348b69[_0x1309aa(0x2b1)](_0x5529d0[_0x1309aa(0x1c5)]);_0x1ce621[_0x1309aa(0x1d4)]+=_0xfdb5cb;}else _0x348b69[_0x1309aa(0x313)](_0x5529d0[_0x1309aa(0x1c5)],{'merchantId':_0x5529d0[_0x1309aa(0x24f)]['id'],'merchantName':_0x5529d0[_0x1309aa(0x24f)][_0x1309aa(0x2bc)],'merchantUsername':_0x5529d0[_0x1309aa(0x24f)]['username'],'totalAmount':_0xfdb5cb});}const _0x2f993c=Array['from'](_0x348b69['values']())[_0x1309aa(0x2e9)](_0x166789=>({'merchantId':_0x166789[_0x1309aa(0x24a)],'merchantName':_0x166789[_0x1309aa(0x20b)],'merchantUsername':_0x166789['merchantUsername'],'gateway':_0x581234[_0x1309aa(0x17b)],'periodFrom':_0x581234[_0x1309aa(0x2cf)],'periodTo':_0x581234[_0x1309aa(0x231)],'totalAmount':Math[_0x1309aa(0x348)](_0x166789['totalAmount']*0x64)/0x64}));return _0x2f993c['sort']((_0x317a66,_0x5cf767)=>_0x5cf767[_0x1309aa(0x1d4)]-_0x317a66[_0x1309aa(0x1d4)]),console['log'](_0x1309aa(0x228)+_0x2f993c[_0x1309aa(0x2f7)]+'\x20merchants'),_0x2f993c;}async[a53_0x19793e(0x1df)](_0x2f55cd,_0x4d49ed,_0x35431e){const _0x456bdb=a53_0x19793e,_0x590314=await database_1[_0x456bdb(0x31b)][_0x456bdb(0x24f)][_0x456bdb(0x1e5)]({'where':{'id':_0x2f55cd}});if(!_0x590314)throw new Error(_0x456bdb(0x30b));await database_1['default'][_0x456bdb(0x321)](async _0x294f5f=>{const _0x5afad9=_0x456bdb;await _0x294f5f[_0x5afad9(0x2cc)]['create']({'data':{'shopId':_0x590314['id'],'amount':_0x4d49ed,'amountUSDT':_0x4d49ed,'amountAfterGatewayCommissionUSDT':_0x4d49ed,'sourceCurrency':_0x5afad9(0x2f1),'currency':_0x5afad9(0x2f1),'status':'PAID','gateway':_0x5afad9(0x1ac),'customerName':_0x590314[_0x5afad9(0x33a)],'customerEmail':'@'+_0x590314[_0x5afad9(0x22a)],'paymentMethod':_0x5afad9(0x284),'adminNotes':_0x35431e||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x294f5f[_0x5afad9(0x24f)][_0x5afad9(0x26e)]({'where':{'id':_0x590314['id']},'data':{'balance':{'increment':_0x4d49ed}}});}),console[_0x456bdb(0x27e)](_0x456bdb(0x301)+_0x4d49ed+_0x456bdb(0x2de)+_0x590314['username']);}}exports[a53_0x19793e(0x184)]=AdminService;