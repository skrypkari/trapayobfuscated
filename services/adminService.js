'use strict';const a35_0x3d76d5=a35_0x3d98;(function(_0x3b2602,_0x1e6d32){const _0x120a7d=a35_0x3d98,_0x2a045d=_0x3b2602();while(!![]){try{const _0x1bcefe=-parseInt(_0x120a7d(0x21f))/0x1*(parseInt(_0x120a7d(0x241))/0x2)+-parseInt(_0x120a7d(0x2b5))/0x3*(parseInt(_0x120a7d(0x205))/0x4)+-parseInt(_0x120a7d(0x299))/0x5*(parseInt(_0x120a7d(0x28d))/0x6)+-parseInt(_0x120a7d(0x27a))/0x7*(-parseInt(_0x120a7d(0x27b))/0x8)+parseInt(_0x120a7d(0x231))/0x9*(-parseInt(_0x120a7d(0x2c2))/0xa)+parseInt(_0x120a7d(0x24b))/0xb+parseInt(_0x120a7d(0x28e))/0xc;if(_0x1bcefe===_0x1e6d32)break;else _0x2a045d['push'](_0x2a045d['shift']());}catch(_0x4da413){_0x2a045d['push'](_0x2a045d['shift']());}}}(a35_0x49db,0xb948e));function a35_0x3d98(_0x3be176,_0x30ddc3){const _0x49dbe8=a35_0x49db();return a35_0x3d98=function(_0x3d988e,_0x1822cd){_0x3d988e=_0x3d988e-0x1ee;let _0x58d484=_0x49dbe8[_0x3d988e];return _0x58d484;},a35_0x3d98(_0x3be176,_0x30ddc3);}var __importDefault=this&&this[a35_0x3d76d5(0x25b)]||function(_0x567974){const _0x28c016=a35_0x3d76d5;return _0x567974&&_0x567974[_0x28c016(0x266)]?_0x567974:{'default':_0x567974};};Object['defineProperty'](exports,a35_0x3d76d5(0x266),{'value':!![]}),exports[a35_0x3d76d5(0x285)]=void 0x0;const database_1=__importDefault(require(a35_0x3d76d5(0x275))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x3d76d5(0x2b6))),currencyService_1=require('./currencyService');class AdminService{async[a35_0x3d76d5(0x27c)](){const _0x31e41=a35_0x3d76d5;console[_0x31e41(0x269)](_0x31e41(0x2ba));const _0xbcf6fb=await database_1['default'][_0x31e41(0x256)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x31e41(0x25a)}}),_0x13e76e=new Date(),_0x193d4f=new Date(_0x13e76e[_0x31e41(0x23d)](),_0x13e76e[_0x31e41(0x21c)](),0x1),_0x357722=new Date(_0x13e76e[_0x31e41(0x23d)](),_0x13e76e[_0x31e41(0x21c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3af612=await database_1[_0x31e41(0x24f)][_0x31e41(0x2af)][_0x31e41(0x2bf)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x193d4f,'lte':_0x357722},'status':'COMPLETED'}}),_0x6d5e51=_0xbcf6fb[_0x31e41(0x270)][_0x31e41(0x242)]||0x0,_0x325153=_0xbcf6fb[_0x31e41(0x270)][_0x31e41(0x296)]||0x0,_0x55668d=_0x3af612['_sum'][_0x31e41(0x27f)]||0x0,_0x103c36={'totalPayout':Math[_0x31e41(0x2a9)](_0x6d5e51*0x64)/0x64,'awaitingPayout':Math['round'](_0x325153*0x64)/0x64,'thisMonth':Math[_0x31e41(0x2a9)](_0x55668d*0x64)/0x64,'availableBalance':Math[_0x31e41(0x2a9)](_0x325153*0x64)/0x64};return console[_0x31e41(0x269)](_0x31e41(0x1fe)),console['log']('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x103c36[_0x31e41(0x25d)]+_0x31e41(0x293)),console[_0x31e41(0x269)](_0x31e41(0x1f4)+_0x103c36['awaitingPayout']+_0x31e41(0x287)),console[_0x31e41(0x269)](_0x31e41(0x1ee)+_0x103c36[_0x31e41(0x288)]+_0x31e41(0x209)),console[_0x31e41(0x269)](_0x31e41(0x2a8)+_0x103c36[_0x31e41(0x2ac)]+'\x20USDT'),_0x103c36;}async['updateCustomerData'](_0x3c9bf2,_0x48ce65){const _0x5877eb=a35_0x3d76d5;console[_0x5877eb(0x269)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x3c9bf2+':',_0x48ce65);const _0x14b0f0=await database_1[_0x5877eb(0x24f)][_0x5877eb(0x25f)]['findUnique']({'where':{'id':_0x3c9bf2},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x14b0f0)throw new Error(_0x5877eb(0x262));const _0x21e67f={};_0x48ce65[_0x5877eb(0x213)]!==undefined&&(_0x21e67f[_0x5877eb(0x213)]=_0x48ce65[_0x5877eb(0x213)]||null);_0x48ce65[_0x5877eb(0x24e)]!==undefined&&(_0x21e67f[_0x5877eb(0x24e)]=_0x48ce65['customerIp']||null);_0x48ce65[_0x5877eb(0x216)]!==undefined&&(_0x21e67f[_0x5877eb(0x216)]=_0x48ce65['customerUa']||null);const _0x599949=await database_1[_0x5877eb(0x24f)][_0x5877eb(0x25f)][_0x5877eb(0x22c)]({'where':{'id':_0x3c9bf2},'data':{..._0x21e67f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5877eb(0x269)](_0x5877eb(0x297)+_0x3c9bf2),console[_0x5877eb(0x269)](_0x5877eb(0x22d)+_0x14b0f0[_0x5877eb(0x213)]+_0x5877eb(0x234)+_0x599949[_0x5877eb(0x213)]),console[_0x5877eb(0x269)](_0x5877eb(0x20a)+_0x14b0f0['customerIp']+_0x5877eb(0x234)+_0x599949[_0x5877eb(0x24e)]),console[_0x5877eb(0x269)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x14b0f0[_0x5877eb(0x216)]?_0x5877eb(0x2b4):_0x5877eb(0x227))+'\x20->\x20'+(_0x599949['customerUa']?_0x5877eb(0x2b4):'not\x20set')),_0x599949;}async['getSystemStatistics'](_0x315e89){const _0x454139=a35_0x3d76d5,_0x3336c6=new Date();let _0x591d2c;switch(_0x315e89){case'7d':_0x591d2c=new Date(_0x3336c6['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x454139(0x1f9):_0x591d2c=new Date(_0x3336c6[_0x454139(0x263)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x454139(0x203):_0x591d2c=new Date(_0x3336c6[_0x454139(0x263)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x591d2c=new Date(_0x3336c6[_0x454139(0x263)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4792be,_0x56f065,_0x4e146d,_0x250378,_0x43db87,_0x238123]=await Promise[_0x454139(0x259)]([database_1[_0x454139(0x24f)]['shop'][_0x454139(0x257)](),database_1[_0x454139(0x24f)][_0x454139(0x256)][_0x454139(0x257)]({'where':{'status':_0x454139(0x25a)}}),database_1['default'][_0x454139(0x25f)][_0x454139(0x257)]({'where':{'createdAt':{'gte':_0x591d2c},'gateway':{'not':_0x454139(0x208)}}}),database_1['default']['payment'][_0x454139(0x257)]({'where':{'status':_0x454139(0x2ab),'createdAt':{'gte':_0x591d2c},'gateway':{'not':'test_gateway'}}}),database_1[_0x454139(0x24f)][_0x454139(0x25f)][_0x454139(0x255)]({'where':{'status':_0x454139(0x2ab),'createdAt':{'gte':_0x591d2c},'gateway':{'not':_0x454139(0x208)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x454139(0x24f)]['payment'][_0x454139(0x255)]({'where':{'gateway':{'not':_0x454139(0x208)}},'take':0xa,'orderBy':{'createdAt':_0x454139(0x2c5)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x211d1d=0x0;for(const _0x5a0853 of _0x43db87){const _0xbd993d=await currencyService_1[_0x454139(0x253)]['convertToUSDT'](_0x5a0853[_0x454139(0x27f)],_0x5a0853['currency']);_0x211d1d+=_0xbd993d;}const _0x2d1d78=_0x4e146d>0x0?_0x250378/_0x4e146d*0x64:0x0;return{'totalShops':_0x4792be,'activeShops':_0x56f065,'totalPayments':_0x4e146d,'successfulPayments':_0x250378,'totalRevenue':Math['round'](_0x211d1d*0x64)/0x64,'conversionRate':Math[_0x454139(0x2a9)](_0x2d1d78*0x64)/0x64,'recentPayments':_0x238123[_0x454139(0x225)](_0x409aa3=>({'id':_0x409aa3['id'],'amount':_0x409aa3[_0x454139(0x27f)],'currency':_0x409aa3['currency'],'status':_0x409aa3[_0x454139(0x254)],'gateway':_0x409aa3['gateway'],'shop':_0x409aa3[_0x454139(0x256)],'createdAt':_0x409aa3[_0x454139(0x261)]}))};}async[a35_0x3d76d5(0x2a4)](_0xc30112){const _0x49a218=a35_0x3d76d5;console[_0x49a218(0x269)](_0x49a218(0x235),_0xc30112);let _0x5aa6f3,_0x431358=new Date();if(_0xc30112[_0x49a218(0x290)]==='custom'&&_0xc30112[_0x49a218(0x29d)]&&_0xc30112[_0x49a218(0x226)])_0x5aa6f3=new Date(_0xc30112[_0x49a218(0x29d)]),_0x431358=new Date(_0xc30112['dateTo']);else{const _0x1e4b77=new Date();switch(_0xc30112[_0x49a218(0x290)]){case _0x49a218(0x1f6):_0x5aa6f3=new Date(_0x1e4b77[_0x49a218(0x263)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x49a218(0x249):_0x5aa6f3=new Date(_0x1e4b77[_0x49a218(0x263)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x49a218(0x22a):_0x5aa6f3=new Date(_0x1e4b77[_0x49a218(0x263)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x5aa6f3=new Date('2020-01-01');break;}}console[_0x49a218(0x269)]('📅\x20Period:\x20'+_0x5aa6f3[_0x49a218(0x23f)]()+'\x20to\x20'+_0x431358[_0x49a218(0x23f)]());const _0x5d719b={'status':_0x49a218(0x2ab),'gateway':{'not':_0x49a218(0x208)},'paidAt':{'gte':_0x5aa6f3,'lte':_0x431358}};_0xc30112[_0x49a218(0x204)]&&(_0x5d719b[_0x49a218(0x204)]=_0xc30112['shopId']);const _0x21e5b1=await database_1[_0x49a218(0x24f)]['payment'][_0x49a218(0x255)]({'where':_0x5d719b,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x49a218(0x2b2)+_0x21e5b1[_0x49a218(0x1fb)]+_0x49a218(0x2a3));let _0x37d967=0x0,_0x371381=0x0,_0x35cbd6=0x0;const _0x464a4d={},_0xd3f529={},_0x19b51f={};for(const _0x42e2c1 of _0x21e5b1){try{const _0x1682ba=await currencyService_1[_0x49a218(0x253)][_0x49a218(0x2c3)](_0x42e2c1[_0x49a218(0x27f)],_0x42e2c1[_0x49a218(0x24c)]);let _0x1258e8={};if(_0x42e2c1[_0x49a218(0x256)][_0x49a218(0x29a)])try{_0x1258e8=JSON[_0x49a218(0x282)](_0x42e2c1[_0x49a218(0x256)][_0x49a218(0x29a)]);}catch(_0x1e6dff){console[_0x49a218(0x219)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x42e2c1[_0x49a218(0x204)]+':',_0x1e6dff);}const _0x4b3d24=_0x1258e8[_0x49a218(0x1fc)]||0xa,_0x580eb5=_0x1682ba*(_0x4b3d24/0x64),_0x54523d=_0x1682ba-_0x580eb5;_0x37d967+=_0x1682ba,_0x371381+=_0x54523d,_0x35cbd6+=_0x580eb5;!_0x464a4d[_0x42e2c1[_0x49a218(0x271)]]&&(_0x464a4d[_0x42e2c1[_0x49a218(0x271)]]={'gateway':_0x42e2c1[_0x49a218(0x271)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x42e2c1[_0x49a218(0x271)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x464a4d[_0x42e2c1[_0x49a218(0x271)]][_0x49a218(0x26a)]++,_0x464a4d[_0x42e2c1['gateway']][_0x49a218(0x236)]+=_0x1682ba,_0x464a4d[_0x42e2c1[_0x49a218(0x271)]]['commissionUSDT']+=_0x580eb5,_0x464a4d[_0x42e2c1[_0x49a218(0x271)]][_0x49a218(0x243)]+=_0x54523d,_0x464a4d[_0x42e2c1[_0x49a218(0x271)]][_0x49a218(0x244)]+=_0x4b3d24;!_0xc30112[_0x49a218(0x204)]&&(!_0xd3f529[_0x42e2c1[_0x49a218(0x204)]]&&(_0xd3f529[_0x42e2c1[_0x49a218(0x204)]]={'shopId':_0x42e2c1[_0x49a218(0x204)],'shopName':_0x42e2c1[_0x49a218(0x256)]['name'],'shopUsername':_0x42e2c1[_0x49a218(0x256)][_0x49a218(0x28f)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xd3f529[_0x42e2c1[_0x49a218(0x204)]][_0x49a218(0x26a)]++,_0xd3f529[_0x42e2c1[_0x49a218(0x204)]]['turnoverUSDT']+=_0x1682ba,_0xd3f529[_0x42e2c1[_0x49a218(0x204)]][_0x49a218(0x2c0)]+=_0x580eb5,_0xd3f529[_0x42e2c1[_0x49a218(0x204)]][_0x49a218(0x243)]+=_0x54523d);const _0x8e7fac=_0x42e2c1[_0x49a218(0x27d)][_0x49a218(0x23f)]()[_0x49a218(0x237)]('T')[0x0];!_0x19b51f[_0x8e7fac]&&(_0x19b51f[_0x8e7fac]={'date':_0x8e7fac,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x19b51f[_0x8e7fac][_0x49a218(0x20f)]+=_0x1682ba,_0x19b51f[_0x8e7fac][_0x49a218(0x212)]+=_0x54523d,_0x19b51f[_0x8e7fac][_0x49a218(0x28c)]+=_0x580eb5,_0x19b51f[_0x8e7fac][_0x49a218(0x26a)]++;}catch(_0x1ca720){console[_0x49a218(0x219)]('Error\x20processing\x20payment\x20'+_0x42e2c1['id']+':',_0x1ca720);}}Object[_0x49a218(0x1f0)](_0x464a4d)[_0x49a218(0x278)](_0x115288=>{const _0x462645=_0x49a218;_0x115288[_0x462645(0x252)]=_0x115288[_0x462645(0x26a)]>0x0?_0x115288[_0x462645(0x244)]/_0x115288[_0x462645(0x26a)]:0x0,delete _0x115288[_0x462645(0x244)];}),Object[_0x49a218(0x1f0)](_0xd3f529)[_0x49a218(0x278)](_0x34ae22=>{const _0xfc119=_0x49a218;_0x34ae22[_0xfc119(0x26f)]=_0x34ae22[_0xfc119(0x26a)]>0x0?_0x34ae22[_0xfc119(0x236)]/_0x34ae22[_0xfc119(0x26a)]:0x0;});let _0x51d5e3=0x0;if(_0xc30112[_0x49a218(0x204)]){const _0x4420d6=await database_1['default'][_0x49a218(0x2af)][_0x49a218(0x255)]({'where':{'shopId':_0xc30112[_0x49a218(0x204)],'status':_0x49a218(0x247),'createdAt':{'gte':_0x5aa6f3,'lte':_0x431358}},'select':{'amount':!![]}});_0x51d5e3=_0x4420d6['reduce']((_0xfd770f,_0x3a7a3b)=>_0xfd770f+_0x3a7a3b[_0x49a218(0x27f)],0x0);}const _0x36565f=_0x21e5b1[_0x49a218(0x1fb)],_0x32ee5f=_0x21e5b1['length'],_0x3771ff=_0x36565f>0x0?_0x37d967/_0x36565f:0x0,_0x34c41b=0x64,_0x383206=Math['ceil']((_0x431358['getTime']()-_0x5aa6f3[_0x49a218(0x263)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1d0ed8={'totalTurnover':Math[_0x49a218(0x2a9)](_0x37d967*0x64)/0x64,'merchantEarnings':Math[_0x49a218(0x2a9)](_0x371381*0x64)/0x64,'gatewayEarnings':Math[_0x49a218(0x2a9)](_0x35cbd6*0x64)/0x64,'totalPaidOut':Math[_0x49a218(0x2a9)](_0x51d5e3*0x64)/0x64,'averageCheck':Math[_0x49a218(0x2a9)](_0x3771ff*0x64)/0x64,'totalPayments':_0x36565f,'successfulPayments':_0x32ee5f,'conversionRate':_0x34c41b,'gatewayBreakdown':Object[_0x49a218(0x1f0)](_0x464a4d)[_0x49a218(0x225)](_0x49a724=>({..._0x49a724,'turnoverUSDT':Math[_0x49a218(0x2a9)](_0x49a724[_0x49a218(0x236)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x49a724['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x49a724['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x49a218(0x2a9)](_0x49a724[_0x49a218(0x252)]*0x64)/0x64})),'merchantBreakdown':_0xc30112[_0x49a218(0x204)]?undefined:Object[_0x49a218(0x1f0)](_0xd3f529)[_0x49a218(0x225)](_0x2ef621=>({..._0x2ef621,'turnoverUSDT':Math[_0x49a218(0x2a9)](_0x2ef621[_0x49a218(0x236)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x2ef621['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x49a218(0x2a9)](_0x2ef621[_0x49a218(0x243)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x2ef621[_0x49a218(0x222)]*0x64)/0x64,'averageCheckUSDT':Math[_0x49a218(0x2a9)](_0x2ef621[_0x49a218(0x26f)]*0x64)/0x64})),'dailyData':Object[_0x49a218(0x1f0)](_0x19b51f)['map'](_0x48129c=>({..._0x48129c,'turnover':Math['round'](_0x48129c[_0x49a218(0x20f)]*0x64)/0x64,'merchantEarnings':Math[_0x49a218(0x2a9)](_0x48129c['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x48129c[_0x49a218(0x28c)]*0x64)/0x64}))[_0x49a218(0x295)]((_0x2d25a6,_0x33276a)=>_0x2d25a6[_0x49a218(0x202)]['localeCompare'](_0x33276a[_0x49a218(0x202)])),'periodInfo':{'from':_0x5aa6f3,'to':_0x431358,'periodType':_0xc30112[_0x49a218(0x290)]||_0x49a218(0x2c4),'daysCount':_0x383206}};return console[_0x49a218(0x269)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x49a218(0x269)](_0x49a218(0x25c)+_0x1d0ed8['totalTurnover']+'\x20USDT'),console[_0x49a218(0x269)](_0x49a218(0x217)+_0x1d0ed8['merchantEarnings']+_0x49a218(0x22b)),console[_0x49a218(0x269)](_0x49a218(0x1fd)+_0x1d0ed8['gatewayEarnings']+_0x49a218(0x22b)),console[_0x49a218(0x269)](_0x49a218(0x273)+_0x1d0ed8[_0x49a218(0x2a5)]),_0x1d0ed8;}['getGatewayDisplayName'](_0x3e6ff8){const _0x3ce18f=a35_0x3d76d5,_0x3f4a3f={'test_gateway':_0x3ce18f(0x2ad),'plisio':_0x3ce18f(0x23e),'rapyd':_0x3ce18f(0x21a),'noda':_0x3ce18f(0x2a6),'cointopay':_0x3ce18f(0x28a),'klyme_eu':_0x3ce18f(0x215),'klyme_gb':_0x3ce18f(0x264),'klyme_de':_0x3ce18f(0x2bd)};return _0x3f4a3f[_0x3e6ff8]||_0x3e6ff8;}async[a35_0x3d76d5(0x20c)](_0x5191b6){const _0x15daa2=a35_0x3d76d5,{page:_0x3b8d20,limit:_0x357733,minAmount:_0x3f886b,search:_0x3e771}=_0x5191b6,_0x4193b0=(_0x3b8d20-0x1)*_0x357733;console['log'](_0x15daa2(0x258),_0x5191b6);const _0x5a6282={'balance':{'gt':0x0},'status':_0x15daa2(0x25a)};_0x3f886b&&(_0x5a6282[_0x15daa2(0x296)][_0x15daa2(0x280)]=_0x3f886b);_0x3e771&&(_0x5a6282['OR']=[{'name':{'contains':_0x3e771,'mode':_0x15daa2(0x2b0)}},{'username':{'contains':_0x3e771,'mode':'insensitive'}}]);const [_0x2c097a,_0x3fcaa5]=await Promise['all']([database_1[_0x15daa2(0x24f)][_0x15daa2(0x256)][_0x15daa2(0x255)]({'where':_0x5a6282,'skip':_0x4193b0,'take':_0x357733,'orderBy':{'balance':_0x15daa2(0x2c5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x15daa2(0x24f)][_0x15daa2(0x256)]['count']({'where':_0x5a6282})]);console[_0x15daa2(0x269)](_0x15daa2(0x2b2)+_0x2c097a[_0x15daa2(0x1fb)]+_0x15daa2(0x279));const _0x31d24a=await Promise[_0x15daa2(0x259)](_0x2c097a[_0x15daa2(0x225)](async _0x2b1b7c=>{const _0xd82bae=_0x15daa2,[_0x23526f,_0x2690ed,_0x9b3584]=await Promise[_0xd82bae(0x259)]([database_1[_0xd82bae(0x24f)][_0xd82bae(0x25f)][_0xd82bae(0x257)]({'where':{'shopId':_0x2b1b7c['id'],'status':_0xd82bae(0x2ab),'amountUSDT':{'not':null}}}),database_1[_0xd82bae(0x24f)][_0xd82bae(0x25f)]['findFirst']({'where':{'shopId':_0x2b1b7c['id'],'status':_0xd82bae(0x2ab),'amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0xd82bae(0x24f)][_0xd82bae(0x25f)]['groupBy']({'by':[_0xd82bae(0x271)],'where':{'shopId':_0x2b1b7c['id'],'status':_0xd82bae(0x2ab),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x18e491=_0x9b3584[_0xd82bae(0x225)](_0x591b4a=>({'gateway':_0x591b4a[_0xd82bae(0x271)],'count':_0x591b4a['_count']['id'],'amountUSDT':_0x591b4a[_0xd82bae(0x270)][_0xd82bae(0x27e)]||0x0,'amountAfterCommissionUSDT':_0x591b4a['_sum'][_0xd82bae(0x27e)]||0x0,'commission':0x0}));return{'id':_0x2b1b7c['id'],'fullName':_0x2b1b7c[_0xd82bae(0x260)],'username':_0x2b1b7c[_0xd82bae(0x28f)],'telegramId':_0x2b1b7c[_0xd82bae(0x1f3)],'merchantUrl':_0x2b1b7c[_0xd82bae(0x2a1)],'wallets':{'usdtPolygonWallet':_0x2b1b7c[_0xd82bae(0x276)],'usdtTrcWallet':_0x2b1b7c[_0xd82bae(0x289)],'usdtErcWallet':_0x2b1b7c[_0xd82bae(0x24a)],'usdcPolygonWallet':_0x2b1b7c[_0xd82bae(0x292)]},'totalAmountUSDT':_0x2b1b7c[_0xd82bae(0x296)],'totalAmountAfterCommissionUSDT':_0x2b1b7c[_0xd82bae(0x296)],'paymentsCount':_0x23526f,'oldestPaymentDate':_0x2690ed?.['paidAt']||_0x2b1b7c[_0xd82bae(0x261)],'gatewayBreakdown':_0x18e491};})),_0x8f5e1e=_0x2c097a[_0x15daa2(0x229)]((_0x271de6,_0x43b5a6)=>_0x271de6+_0x43b5a6['balance'],0x0),_0x1ba279=_0x8f5e1e;return console[_0x15daa2(0x269)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x3fcaa5+_0x15daa2(0x1ff)+Math[_0x15daa2(0x2a9)](_0x1ba279*0x64)/0x64+_0x15daa2(0x29e)),{'merchants':_0x31d24a,'pagination':{'page':_0x3b8d20,'limit':_0x357733,'total':_0x3fcaa5,'totalPages':Math['ceil'](_0x3fcaa5/_0x357733)},'summary':{'totalMerchants':_0x3fcaa5,'totalAmountUSDT':Math['round'](_0x8f5e1e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x15daa2(0x2a9)](_0x1ba279*0x64)/0x64}};}async[a35_0x3d76d5(0x24d)](_0x4e142a){const _0x52b7a0=a35_0x3d76d5,{shopId:_0x3e02f7,amount:_0x46e8c9,network:_0x5e65b3,notes:_0x3c3151,periodFrom:_0x4b9c87,periodTo:_0xbf4e6f}=_0x4e142a,_0x4f1c9d=await database_1[_0x52b7a0(0x24f)][_0x52b7a0(0x211)](async _0x2fcb84=>{const _0x4a2cd6=_0x52b7a0,_0x30adbb=await _0x2fcb84['shop'][_0x4a2cd6(0x298)]({'where':{'id':_0x3e02f7},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x30adbb)throw new Error(_0x4a2cd6(0x1f1));console['log'](_0x4a2cd6(0x22f)+_0x30adbb['username']+':'),console[_0x4a2cd6(0x269)]('\x20\x20\x20Current\x20balance:\x20'+_0x30adbb[_0x4a2cd6(0x296)]['toFixed'](0x6)+'\x20USDT'),console['log'](_0x4a2cd6(0x2a2)+_0x46e8c9[_0x4a2cd6(0x246)](0x6)+_0x4a2cd6(0x22b)),console[_0x4a2cd6(0x269)](_0x4a2cd6(0x214)+_0x30adbb[_0x4a2cd6(0x242)][_0x4a2cd6(0x246)](0x6)+_0x4a2cd6(0x22b));if(_0x30adbb[_0x4a2cd6(0x296)]<_0x46e8c9)throw new Error(_0x4a2cd6(0x228)+_0x30adbb[_0x4a2cd6(0x296)][_0x4a2cd6(0x246)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x46e8c9[_0x4a2cd6(0x246)](0x6)+_0x4a2cd6(0x22b));const _0x3f57fc=await _0x2fcb84[_0x4a2cd6(0x2af)][_0x4a2cd6(0x26c)]({'data':{'shopId':_0x3e02f7,'amount':_0x46e8c9,'network':_0x5e65b3,'status':_0x4a2cd6(0x247),'notes':_0x3c3151,'periodFrom':_0x4b9c87?new Date(_0x4b9c87):null,'periodTo':_0xbf4e6f?new Date(_0xbf4e6f):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xf4a7d7=_0x30adbb['balance']-_0x46e8c9,_0x510050=_0x30adbb[_0x4a2cd6(0x242)]+_0x46e8c9;return await _0x2fcb84[_0x4a2cd6(0x256)]['update']({'where':{'id':_0x3e02f7},'data':{'balance':_0xf4a7d7,'totalPaidOut':_0x510050}}),console[_0x4a2cd6(0x269)]('💰\x20Shop\x20'+_0x30adbb['username']+_0x4a2cd6(0x1f2)),console[_0x4a2cd6(0x269)]('\x20\x20\x20Balance:\x20'+_0x30adbb[_0x4a2cd6(0x296)][_0x4a2cd6(0x246)](0x6)+_0x4a2cd6(0x234)+_0xf4a7d7['toFixed'](0x6)+_0x4a2cd6(0x250)+_0x46e8c9[_0x4a2cd6(0x246)](0x6)+')'),console['log'](_0x4a2cd6(0x21b)+_0x30adbb['totalPaidOut']['toFixed'](0x6)+_0x4a2cd6(0x234)+_0x510050[_0x4a2cd6(0x246)](0x6)+'\x20USDT\x20(+'+_0x46e8c9[_0x4a2cd6(0x246)](0x6)+')'),{'payout':_0x3f57fc,'shop':_0x30adbb};});return console[_0x52b7a0(0x269)]('✅\x20Payout\x20created:\x20'+_0x4f1c9d['payout']['id']+_0x52b7a0(0x239)+_0x4f1c9d['shop']['username']+'\x20('+_0x46e8c9+_0x52b7a0(0x2b3)),{'id':_0x4f1c9d[_0x52b7a0(0x2af)]['id'],'shopId':_0x4f1c9d[_0x52b7a0(0x2af)][_0x52b7a0(0x204)],'shopName':_0x4f1c9d[_0x52b7a0(0x256)][_0x52b7a0(0x260)],'shopUsername':_0x4f1c9d[_0x52b7a0(0x256)][_0x52b7a0(0x28f)],'amount':_0x4f1c9d[_0x52b7a0(0x2af)]['amount'],'network':_0x4f1c9d[_0x52b7a0(0x2af)][_0x52b7a0(0x2b7)],'status':_0x4f1c9d['payout'][_0x52b7a0(0x254)],'txid':_0x4f1c9d[_0x52b7a0(0x2af)]['txid'],'notes':_0x4f1c9d[_0x52b7a0(0x2af)]['notes'],'periodFrom':_0x4f1c9d[_0x52b7a0(0x2af)][_0x52b7a0(0x294)],'periodTo':_0x4f1c9d[_0x52b7a0(0x2af)][_0x52b7a0(0x291)],'createdAt':_0x4f1c9d['payout'][_0x52b7a0(0x261)],'paidAt':_0x4f1c9d['payout'][_0x52b7a0(0x27d)]};}async[a35_0x3d76d5(0x1f5)](_0x5580f7){const _0x3430fe=a35_0x3d76d5,{page:_0x1fe451,limit:_0x421e5d,shopId:_0xcbdb75,network:_0x4eb527,dateFrom:_0x248074,dateTo:_0x4599b2,search:_0x4b5bdb}=_0x5580f7,_0x30c00d=(_0x1fe451-0x1)*_0x421e5d,_0x13aaa9={};_0xcbdb75&&(_0x13aaa9[_0x3430fe(0x204)]=_0xcbdb75);_0x4eb527&&(_0x13aaa9[_0x3430fe(0x2b7)]=_0x4eb527);(_0x248074||_0x4599b2)&&(_0x13aaa9[_0x3430fe(0x261)]={},_0x248074&&(_0x13aaa9['createdAt'][_0x3430fe(0x280)]=new Date(_0x248074)),_0x4599b2&&(_0x13aaa9['createdAt'][_0x3430fe(0x23b)]=new Date(_0x4599b2)));_0x4b5bdb&&(_0x13aaa9['OR']=[{'shop':{'name':{'contains':_0x4b5bdb,'mode':_0x3430fe(0x2b0)}}},{'shop':{'username':{'contains':_0x4b5bdb,'mode':'insensitive'}}},{'notes':{'contains':_0x4b5bdb,'mode':'insensitive'}}]);const [_0x452904,_0x55911b]=await Promise[_0x3430fe(0x259)]([database_1['default'][_0x3430fe(0x2af)][_0x3430fe(0x255)]({'where':_0x13aaa9,'skip':_0x30c00d,'take':_0x421e5d,'orderBy':{'createdAt':_0x3430fe(0x2c5)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3430fe(0x24f)][_0x3430fe(0x2af)]['count']({'where':_0x13aaa9})]);return{'payouts':_0x452904[_0x3430fe(0x225)](_0xa7b309=>({'id':_0xa7b309['id'],'shopId':_0xa7b309[_0x3430fe(0x204)],'shopName':_0xa7b309['shop'][_0x3430fe(0x260)],'shopUsername':_0xa7b309[_0x3430fe(0x256)]['username'],'amount':_0xa7b309[_0x3430fe(0x27f)],'network':_0xa7b309[_0x3430fe(0x2b7)],'status':_0xa7b309[_0x3430fe(0x254)],'txid':_0xa7b309[_0x3430fe(0x207)],'notes':_0xa7b309[_0x3430fe(0x224)],'periodFrom':_0xa7b309[_0x3430fe(0x294)],'periodTo':_0xa7b309['periodTo'],'createdAt':_0xa7b309[_0x3430fe(0x261)],'paidAt':_0xa7b309[_0x3430fe(0x27d)]})),'pagination':{'page':_0x1fe451,'limit':_0x421e5d,'total':_0x55911b,'totalPages':Math[_0x3430fe(0x201)](_0x55911b/_0x421e5d)}};}async[a35_0x3d76d5(0x218)](_0x332c66){const _0x54949c=a35_0x3d76d5,_0xfa171e=await database_1[_0x54949c(0x24f)][_0x54949c(0x2af)]['findUnique']({'where':{'id':_0x332c66},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xfa171e)return null;return{'id':_0xfa171e['id'],'shopId':_0xfa171e['shopId'],'shopName':_0xfa171e['shop'][_0x54949c(0x260)],'shopUsername':_0xfa171e['shop']['username'],'amount':_0xfa171e[_0x54949c(0x27f)],'network':_0xfa171e[_0x54949c(0x2b7)],'status':_0xfa171e[_0x54949c(0x254)],'txid':_0xfa171e[_0x54949c(0x207)],'notes':_0xfa171e['notes'],'periodFrom':_0xfa171e[_0x54949c(0x294)],'periodTo':_0xfa171e[_0x54949c(0x291)],'createdAt':_0xfa171e[_0x54949c(0x261)],'paidAt':_0xfa171e[_0x54949c(0x27d)]};}async[a35_0x3d76d5(0x29b)](_0xe85f10){const _0x2fc089=a35_0x3d76d5;await database_1['default']['payout'][_0x2fc089(0x21d)]({'where':{'id':_0xe85f10}});}async[a35_0x3d76d5(0x2aa)](_0xf135ab){const _0x241c81=a35_0x3d76d5,{page:_0x212023,limit:_0x5b7df2,status:_0x2dc7f0,gateway:_0x597441,shopId:_0xb7383f,dateFrom:_0x10b2f4,dateTo:_0x248949,search:_0x3acc07}=_0xf135ab,_0x18be53=(_0x212023-0x1)*_0x5b7df2,_0x551876={};_0x2dc7f0&&(_0x551876[_0x241c81(0x254)]=_0x2dc7f0[_0x241c81(0x2b8)]());_0x597441&&(_0x551876[_0x241c81(0x271)]=_0x597441[_0x241c81(0x277)]());_0x551876[_0x241c81(0x271)]=_0x551876[_0x241c81(0x271)]?_0x551876[_0x241c81(0x271)]:{'not':'test_gateway'};if(typeof _0x551876[_0x241c81(0x271)]===_0x241c81(0x272)&&_0x551876[_0x241c81(0x271)]!=='test_gateway'){}else{if(typeof _0x551876[_0x241c81(0x271)]===_0x241c81(0x272)&&_0x551876[_0x241c81(0x271)]===_0x241c81(0x208)){}else _0x551876[_0x241c81(0x271)]={'not':'test_gateway'};}_0xb7383f&&(_0x551876['shopId']=_0xb7383f);(_0x10b2f4||_0x248949)&&(_0x551876[_0x241c81(0x261)]={},_0x10b2f4&&(_0x551876['createdAt'][_0x241c81(0x280)]=new Date(_0x10b2f4)),_0x248949&&(_0x551876[_0x241c81(0x261)]['lte']=new Date(_0x248949)));_0x3acc07&&(_0x551876['OR']=[{'orderId':{'contains':_0x3acc07,'mode':_0x241c81(0x2b0)}},{'gatewayOrderId':{'contains':_0x3acc07,'mode':_0x241c81(0x2b0)}},{'customerEmail':{'contains':_0x3acc07,'mode':_0x241c81(0x2b0)}},{'shop':{'name':{'contains':_0x3acc07,'mode':_0x241c81(0x2b0)}}},{'shop':{'username':{'contains':_0x3acc07,'mode':'insensitive'}}}]);const [_0x5d6a04,_0x4898f2]=await Promise[_0x241c81(0x259)]([database_1[_0x241c81(0x24f)][_0x241c81(0x25f)][_0x241c81(0x255)]({'where':_0x551876,'skip':_0x18be53,'take':_0x5b7df2,'orderBy':{'createdAt':_0x241c81(0x2c5)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x241c81(0x24f)]['payment'][_0x241c81(0x257)]({'where':_0x551876})]);return{'payments':_0x5d6a04[_0x241c81(0x225)](_0x1b9d55=>({'id':_0x1b9d55['id'],'shopId':_0x1b9d55[_0x241c81(0x204)],'gateway':_0x1b9d55['gateway'],'amount':_0x1b9d55[_0x241c81(0x27f)],'currency':_0x1b9d55[_0x241c81(0x24c)],'status':_0x1b9d55[_0x241c81(0x254)],'orderId':_0x1b9d55['orderId'],'gatewayOrderId':_0x1b9d55[_0x241c81(0x221)],'customerEmail':_0x1b9d55[_0x241c81(0x284)],'customerName':_0x1b9d55[_0x241c81(0x2a0)],'customerCountry':_0x1b9d55['customerCountry'],'customerIp':_0x1b9d55['customerIp'],'customerUa':_0x1b9d55[_0x241c81(0x216)],'failureMessage':_0x1b9d55[_0x241c81(0x223)],'createdAt':_0x1b9d55['createdAt'],'updatedAt':_0x1b9d55[_0x241c81(0x22e)],'shop':_0x1b9d55['shop']})),'pagination':{'page':_0x212023,'limit':_0x5b7df2,'total':_0x4898f2,'totalPages':Math['ceil'](_0x4898f2/_0x5b7df2)}};}async['getPaymentById'](_0xaec55a){const _0x163ada=a35_0x3d76d5,_0xf6866=await database_1[_0x163ada(0x24f)][_0x163ada(0x25f)][_0x163ada(0x298)]({'where':{'id':_0xaec55a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xf6866)return null;return{'id':_0xf6866['id'],'shopId':_0xf6866[_0x163ada(0x204)],'gateway':_0xf6866[_0x163ada(0x271)],'amount':_0xf6866['amount'],'currency':_0xf6866[_0x163ada(0x24c)],'status':_0xf6866['status'],'orderId':_0xf6866[_0x163ada(0x200)],'gatewayOrderId':_0xf6866['gatewayOrderId'],'customerEmail':_0xf6866[_0x163ada(0x284)],'customerName':_0xf6866[_0x163ada(0x2a0)],'customerCountry':_0xf6866['customerCountry'],'customerIp':_0xf6866[_0x163ada(0x24e)],'customerUa':_0xf6866[_0x163ada(0x216)],'failureMessage':_0xf6866[_0x163ada(0x223)],'externalPaymentUrl':_0xf6866[_0x163ada(0x23c)],'successUrl':_0xf6866[_0x163ada(0x25e)],'failUrl':_0xf6866[_0x163ada(0x20b)],'pendingUrl':_0xf6866[_0x163ada(0x2bc)],'whiteUrl':_0xf6866[_0x163ada(0x281)],'createdAt':_0xf6866[_0x163ada(0x261)],'updatedAt':_0xf6866[_0x163ada(0x22e)],'shop':_0xf6866['shop']};}async['updatePaymentStatus'](_0x167ad9,_0x239e94,_0x2f7f2a,_0x4958dd){const _0x2e2922=a35_0x3d76d5,_0x285a59=await database_1[_0x2e2922(0x24f)]['$transaction'](async _0x16c517=>{const _0x25393f=_0x2e2922,_0x483072=await _0x16c517[_0x25393f(0x25f)][_0x25393f(0x298)]({'where':{'id':_0x167ad9},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x483072)throw new Error(_0x25393f(0x262));const _0x4d5449=_0x483072[_0x25393f(0x254)],_0x138dc1=_0x239e94[_0x25393f(0x2b8)]();console[_0x25393f(0x269)](_0x25393f(0x240)+_0x167ad9+_0x25393f(0x21e)+_0x4d5449+_0x25393f(0x234)+_0x138dc1),console[_0x25393f(0x269)](_0x25393f(0x26d)+_0x483072[_0x25393f(0x256)][_0x25393f(0x296)]+_0x25393f(0x22b));const _0x291558={'status':_0x138dc1,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x2f7f2a&&(_0x291558[_0x25393f(0x28b)]=_0x2f7f2a);_0x138dc1==='CHARGEBACK'&&_0x4958dd&&(_0x291558[_0x25393f(0x26e)]=_0x4958dd);let _0x5bd331=0x0,_0x453294=_0x483072[_0x25393f(0x256)]['balance'];if(_0x138dc1===_0x25393f(0x2ab)&&_0x4d5449!=='PAID'){_0x291558[_0x25393f(0x27d)]=new Date();const _0x5e1768=await currencyService_1[_0x25393f(0x253)][_0x25393f(0x2c3)](_0x483072[_0x25393f(0x27f)],_0x483072[_0x25393f(0x24c)]);_0x291558['amountUSDT']=_0x5e1768,_0x5bd331=_0x5e1768,_0x453294+=_0x5e1768,console[_0x25393f(0x269)](_0x25393f(0x248)+_0x167ad9+_0x25393f(0x251)+_0x5e1768[_0x25393f(0x246)](0x6)+'\x20USDT\x20to\x20balance');}else _0x4d5449===_0x25393f(0x2ab)&&_0x138dc1!==_0x25393f(0x2ab)&&(_0x483072['amountUSDT']&&(_0x5bd331=-_0x483072[_0x25393f(0x27e)],_0x453294-=_0x483072[_0x25393f(0x27e)],_0x291558[_0x25393f(0x27e)]=null,console[_0x25393f(0x269)]('💰\x20Payment\x20'+_0x167ad9+'\x20no\x20longer\x20PAID:\x20-'+_0x483072[_0x25393f(0x27e)][_0x25393f(0x246)](0x6)+_0x25393f(0x268))));if(_0x138dc1==='CHARGEBACK'){if(_0x4d5449===_0x25393f(0x2ab)&&_0x483072[_0x25393f(0x27e)]){}_0x4958dd&&_0x4958dd>0x0&&(_0x5bd331-=_0x4958dd,_0x453294-=_0x4958dd,console[_0x25393f(0x269)](_0x25393f(0x23a)+_0x4958dd['toFixed'](0x6)+'\x20USDT\x20from\x20balance'));}_0x138dc1===_0x25393f(0x2a7)&&_0x4d5449===_0x25393f(0x2ab)&&console[_0x25393f(0x269)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x195414=await _0x16c517['payment'][_0x25393f(0x22c)]({'where':{'id':_0x167ad9},'data':_0x291558,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5bd331!==0x0&&(await _0x16c517[_0x25393f(0x256)][_0x25393f(0x22c)]({'where':{'id':_0x483072[_0x25393f(0x204)]},'data':{'balance':_0x453294}}),console[_0x25393f(0x269)](_0x25393f(0x26b)+_0x483072[_0x25393f(0x204)]+_0x25393f(0x1f8)+_0x483072[_0x25393f(0x256)][_0x25393f(0x296)][_0x25393f(0x246)](0x6)+_0x25393f(0x234)+_0x453294[_0x25393f(0x246)](0x6)+_0x25393f(0x20d)+(_0x5bd331>0x0?'+':'')+_0x5bd331[_0x25393f(0x246)](0x6)+')')),_0x195414;});return{'id':_0x285a59['id'],'shopId':_0x285a59[_0x2e2922(0x204)],'gateway':_0x285a59[_0x2e2922(0x271)],'amount':_0x285a59['amount'],'currency':_0x285a59[_0x2e2922(0x24c)],'status':_0x285a59[_0x2e2922(0x254)],'orderId':_0x285a59[_0x2e2922(0x200)],'gatewayOrderId':_0x285a59[_0x2e2922(0x221)],'customerEmail':_0x285a59[_0x2e2922(0x284)],'customerName':_0x285a59[_0x2e2922(0x2a0)],'customerCountry':_0x285a59[_0x2e2922(0x213)],'customerIp':_0x285a59[_0x2e2922(0x24e)],'customerUa':_0x285a59[_0x2e2922(0x216)],'failureMessage':_0x285a59['failureMessage'],'adminNotes':_0x285a59['adminNotes'],'chargebackAmount':_0x285a59[_0x2e2922(0x26e)],'statusChangedBy':_0x285a59['statusChangedBy'],'statusChangedAt':_0x285a59[_0x2e2922(0x2ae)],'createdAt':_0x285a59['createdAt'],'updatedAt':_0x285a59['updatedAt'],'shop':_0x285a59['shop']};}async[a35_0x3d76d5(0x265)](_0x4f3de4,_0x591a6b){const _0x162aef=a35_0x3d76d5,_0x2473c6={..._0x591a6b};_0x591a6b[_0x162aef(0x233)]&&(_0x2473c6[_0x162aef(0x233)]=await bcryptjs_1[_0x162aef(0x24f)]['hash'](_0x591a6b['password'],0xc));_0x591a6b[_0x162aef(0x1fa)]&&(_0x2473c6[_0x162aef(0x260)]=_0x591a6b['fullName'],delete _0x2473c6[_0x162aef(0x1fa)]);_0x591a6b[_0x162aef(0x286)]&&(_0x2473c6[_0x162aef(0x1f3)]=_0x591a6b[_0x162aef(0x286)],delete _0x2473c6[_0x162aef(0x286)]);_0x591a6b['merchantUrl']&&(_0x2473c6[_0x162aef(0x2a1)]=_0x591a6b[_0x162aef(0x206)],delete _0x2473c6[_0x162aef(0x206)]);_0x591a6b[_0x162aef(0x274)]&&(_0x2473c6[_0x162aef(0x2be)]=JSON[_0x162aef(0x1f7)](_0x591a6b[_0x162aef(0x274)]),delete _0x2473c6[_0x162aef(0x274)]);_0x591a6b[_0x162aef(0x29a)]&&(_0x2473c6[_0x162aef(0x29a)]=JSON['stringify'](_0x591a6b[_0x162aef(0x29a)]),delete _0x2473c6[_0x162aef(0x29a)]);_0x591a6b['wallets']&&(_0x591a6b[_0x162aef(0x267)][_0x162aef(0x276)]!==undefined&&(_0x2473c6[_0x162aef(0x276)]=_0x591a6b[_0x162aef(0x267)][_0x162aef(0x276)]||null),_0x591a6b[_0x162aef(0x267)][_0x162aef(0x289)]!==undefined&&(_0x2473c6[_0x162aef(0x289)]=_0x591a6b['wallets']['usdtTrcWallet']||null),_0x591a6b[_0x162aef(0x267)]['usdtErcWallet']!==undefined&&(_0x2473c6[_0x162aef(0x24a)]=_0x591a6b[_0x162aef(0x267)][_0x162aef(0x24a)]||null),_0x591a6b['wallets'][_0x162aef(0x292)]!==undefined&&(_0x2473c6[_0x162aef(0x292)]=_0x591a6b[_0x162aef(0x267)][_0x162aef(0x292)]||null),delete _0x2473c6[_0x162aef(0x267)]);const _0x1e54ee=await database_1['default'][_0x162aef(0x256)][_0x162aef(0x22c)]({'where':{'id':_0x4f3de4},'data':_0x2473c6,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1e54ee['id'],'fullName':_0x1e54ee[_0x162aef(0x260)],'username':_0x1e54ee[_0x162aef(0x28f)],'telegramId':_0x1e54ee['telegram'],'merchantUrl':_0x1e54ee['shopUrl'],'gateways':_0x1e54ee['paymentGateways']?JSON[_0x162aef(0x282)](_0x1e54ee[_0x162aef(0x2be)]):null,'gatewaySettings':_0x1e54ee[_0x162aef(0x29a)]?JSON[_0x162aef(0x282)](_0x1e54ee[_0x162aef(0x29a)]):null,'publicKey':_0x1e54ee['publicKey'],'wallets':{'usdtPolygonWallet':_0x1e54ee[_0x162aef(0x276)],'usdtTrcWallet':_0x1e54ee['usdtTrcWallet'],'usdtErcWallet':_0x1e54ee[_0x162aef(0x24a)],'usdcPolygonWallet':_0x1e54ee[_0x162aef(0x292)]},'status':_0x1e54ee[_0x162aef(0x254)],'createdAt':_0x1e54ee['createdAt']};}async[a35_0x3d76d5(0x210)](_0x2800ee){const _0x124105=a35_0x3d76d5,_0x4222f2=await database_1['default'][_0x124105(0x256)][_0x124105(0x22c)]({'where':{'id':_0x2800ee},'data':{'status':_0x124105(0x29f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4222f2['id'],'fullName':_0x4222f2[_0x124105(0x260)],'username':_0x4222f2[_0x124105(0x28f)],'telegramId':_0x4222f2[_0x124105(0x1f3)],'merchantUrl':_0x4222f2['shopUrl'],'gateways':_0x4222f2[_0x124105(0x2be)]?JSON['parse'](_0x4222f2['paymentGateways']):null,'gatewaySettings':_0x4222f2[_0x124105(0x29a)]?JSON[_0x124105(0x282)](_0x4222f2['gatewaySettings']):null,'publicKey':_0x4222f2['publicKey'],'wallets':{'usdtPolygonWallet':_0x4222f2[_0x124105(0x276)],'usdtTrcWallet':_0x4222f2[_0x124105(0x289)],'usdtErcWallet':_0x4222f2[_0x124105(0x24a)],'usdcPolygonWallet':_0x4222f2[_0x124105(0x292)]},'status':_0x4222f2[_0x124105(0x254)],'createdAt':_0x4222f2['createdAt']};}async[a35_0x3d76d5(0x1ef)](_0x60001d){const _0x374618=a35_0x3d76d5,_0x3888d4=await database_1[_0x374618(0x24f)][_0x374618(0x256)][_0x374618(0x22c)]({'where':{'id':_0x60001d},'data':{'status':_0x374618(0x25a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3888d4['id'],'fullName':_0x3888d4[_0x374618(0x260)],'username':_0x3888d4[_0x374618(0x28f)],'telegramId':_0x3888d4[_0x374618(0x1f3)],'merchantUrl':_0x3888d4[_0x374618(0x2a1)],'gateways':_0x3888d4[_0x374618(0x2be)]?JSON[_0x374618(0x282)](_0x3888d4[_0x374618(0x2be)]):null,'gatewaySettings':_0x3888d4[_0x374618(0x29a)]?JSON[_0x374618(0x282)](_0x3888d4[_0x374618(0x29a)]):null,'publicKey':_0x3888d4['publicKey'],'wallets':{'usdtPolygonWallet':_0x3888d4[_0x374618(0x276)],'usdtTrcWallet':_0x3888d4['usdtTrcWallet'],'usdtErcWallet':_0x3888d4[_0x374618(0x24a)],'usdcPolygonWallet':_0x3888d4[_0x374618(0x292)]},'status':_0x3888d4[_0x374618(0x254)],'createdAt':_0x3888d4['createdAt']};}async[a35_0x3d76d5(0x283)](_0x1e9712){const _0x2f348a=a35_0x3d76d5,{page:_0x56690b,limit:_0x531840,status:_0x512490}=_0x1e9712,_0x4e1d65=(_0x56690b-0x1)*_0x531840,_0x560c29={};_0x512490&&(_0x560c29[_0x2f348a(0x254)]=_0x512490['toUpperCase']());const [_0x279a29,_0x11999f]=await Promise[_0x2f348a(0x259)]([database_1[_0x2f348a(0x24f)]['shop'][_0x2f348a(0x255)]({'where':_0x560c29,'skip':_0x4e1d65,'take':_0x531840,'orderBy':{'createdAt':_0x2f348a(0x2c5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x2f348a(0x24f)][_0x2f348a(0x256)][_0x2f348a(0x257)]({'where':_0x560c29})]);return{'users':_0x279a29[_0x2f348a(0x225)](_0x1f7268=>({'id':_0x1f7268['id'],'fullName':_0x1f7268[_0x2f348a(0x260)],'username':_0x1f7268[_0x2f348a(0x28f)],'telegramId':_0x1f7268[_0x2f348a(0x1f3)],'merchantUrl':_0x1f7268[_0x2f348a(0x2a1)],'gateways':_0x1f7268['paymentGateways']?JSON[_0x2f348a(0x282)](_0x1f7268[_0x2f348a(0x2be)]):null,'gatewaySettings':_0x1f7268['gatewaySettings']?JSON[_0x2f348a(0x282)](_0x1f7268[_0x2f348a(0x29a)]):null,'publicKey':_0x1f7268[_0x2f348a(0x20e)],'wallets':{'usdtPolygonWallet':_0x1f7268[_0x2f348a(0x276)],'usdtTrcWallet':_0x1f7268['usdtTrcWallet'],'usdtErcWallet':_0x1f7268[_0x2f348a(0x24a)],'usdcPolygonWallet':_0x1f7268[_0x2f348a(0x292)]},'status':_0x1f7268[_0x2f348a(0x254)],'createdAt':_0x1f7268[_0x2f348a(0x261)]})),'pagination':{'page':_0x56690b,'limit':_0x531840,'total':_0x11999f,'totalPages':Math[_0x2f348a(0x201)](_0x11999f/_0x531840)}};}async[a35_0x3d76d5(0x220)](_0x31fdca){const _0x4e107a=a35_0x3d76d5,_0x4f34b4=await database_1[_0x4e107a(0x24f)][_0x4e107a(0x256)][_0x4e107a(0x298)]({'where':{'id':_0x31fdca},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4f34b4)return null;return{'id':_0x4f34b4['id'],'fullName':_0x4f34b4[_0x4e107a(0x260)],'username':_0x4f34b4[_0x4e107a(0x28f)],'telegramId':_0x4f34b4[_0x4e107a(0x1f3)],'merchantUrl':_0x4f34b4[_0x4e107a(0x2a1)],'gateways':_0x4f34b4['paymentGateways']?JSON[_0x4e107a(0x282)](_0x4f34b4[_0x4e107a(0x2be)]):null,'gatewaySettings':_0x4f34b4['gatewaySettings']?JSON[_0x4e107a(0x282)](_0x4f34b4[_0x4e107a(0x29a)]):null,'publicKey':_0x4f34b4[_0x4e107a(0x20e)],'wallets':{'usdtPolygonWallet':_0x4f34b4['usdtPolygonWallet'],'usdtTrcWallet':_0x4f34b4[_0x4e107a(0x289)],'usdtErcWallet':_0x4f34b4['usdtErcWallet'],'usdcPolygonWallet':_0x4f34b4[_0x4e107a(0x292)]},'status':_0x4f34b4[_0x4e107a(0x254)],'createdAt':_0x4f34b4[_0x4e107a(0x261)]};}async[a35_0x3d76d5(0x230)](_0x5ea184){const _0x27a8d5=a35_0x3d76d5,{fullName:_0x1daa2d,username:_0x355803,password:_0x24dd8f,telegramId:_0x3ebfa4,merchantUrl:_0x4ea829,gateways:_0x43b05d,gatewaySettings:_0x5dd3c5,wallets:_0x47fcd4}=_0x5ea184,_0x120efa=await database_1[_0x27a8d5(0x24f)][_0x27a8d5(0x256)][_0x27a8d5(0x298)]({'where':{'username':_0x355803}});if(_0x120efa)throw new Error(_0x27a8d5(0x2bb));if(_0x3ebfa4){const _0x276f44=await database_1[_0x27a8d5(0x24f)]['shop'][_0x27a8d5(0x298)]({'where':{'telegram':_0x3ebfa4}});if(_0x276f44)throw new Error(_0x27a8d5(0x2c1));}const _0x3ef078=await bcryptjs_1[_0x27a8d5(0x24f)][_0x27a8d5(0x2b1)](_0x24dd8f,0xc),_0x3bc398=_0x27a8d5(0x245)+crypto_1[_0x27a8d5(0x24f)]['randomBytes'](0x20)[_0x27a8d5(0x232)](_0x27a8d5(0x29c)),_0x3d2664=_0x27a8d5(0x238)+crypto_1[_0x27a8d5(0x24f)][_0x27a8d5(0x2b9)](0x20)[_0x27a8d5(0x232)](_0x27a8d5(0x29c)),_0x5a1a57=await database_1[_0x27a8d5(0x24f)][_0x27a8d5(0x256)][_0x27a8d5(0x26c)]({'data':{'name':_0x1daa2d,'username':_0x355803,'password':_0x3ef078,'telegram':_0x3ebfa4,'shopUrl':_0x4ea829,'paymentGateways':_0x43b05d?JSON[_0x27a8d5(0x1f7)](_0x43b05d):null,'gatewaySettings':_0x5dd3c5?JSON[_0x27a8d5(0x1f7)](_0x5dd3c5):null,'usdtPolygonWallet':_0x47fcd4?.[_0x27a8d5(0x276)]||null,'usdtTrcWallet':_0x47fcd4?.[_0x27a8d5(0x289)]||null,'usdtErcWallet':_0x47fcd4?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x47fcd4?.[_0x27a8d5(0x292)]||null,'publicKey':_0x3bc398,'secretKey':_0x3d2664,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a1a57['id'],'fullName':_0x5a1a57[_0x27a8d5(0x260)],'username':_0x5a1a57[_0x27a8d5(0x28f)],'telegramId':_0x5a1a57[_0x27a8d5(0x1f3)],'merchantUrl':_0x5a1a57[_0x27a8d5(0x2a1)],'gateways':_0x5a1a57[_0x27a8d5(0x2be)]?JSON[_0x27a8d5(0x282)](_0x5a1a57['paymentGateways']):null,'gatewaySettings':_0x5a1a57[_0x27a8d5(0x29a)]?JSON[_0x27a8d5(0x282)](_0x5a1a57['gatewaySettings']):null,'publicKey':_0x5a1a57['publicKey'],'wallets':{'usdtPolygonWallet':_0x5a1a57[_0x27a8d5(0x276)],'usdtTrcWallet':_0x5a1a57[_0x27a8d5(0x289)],'usdtErcWallet':_0x5a1a57[_0x27a8d5(0x24a)],'usdcPolygonWallet':_0x5a1a57['usdcPolygonWallet']},'status':_0x5a1a57['status'],'createdAt':_0x5a1a57['createdAt']};}async['deleteUser'](_0x77bb16){const _0x3eb799=a35_0x3d76d5;await database_1[_0x3eb799(0x24f)][_0x3eb799(0x256)][_0x3eb799(0x21d)]({'where':{'id':_0x77bb16}});}}function a35_0x49db(){const _0x4465f9=['custom','desc','\x20\x20\x20💵\x20Available\x20balance:\x20','activateUser','values','Shop\x20not\x20found','\x20balance\x20updated:','telegram','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','getAllPayouts','week','stringify','\x20balance\x20updated:\x20','30d','fullName','length','commission','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','📊\x20Payout\x20statistics\x20calculated:','\x20merchants,\x20','orderId','ceil','date','90d','shopId','1231412qppWay','merchantUrl','txid','test_gateway','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20🌐\x20IP:\x20','failUrl','getMerchantsAwaitingPayout','\x20USDT\x20(','publicKey','turnover','suspendUser','$transaction','merchantEarnings','customerCountry','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','KLYME\x20EU','customerUa','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','getPayoutById','error','Rapyd','\x20\x20\x20Total\x20paid\x20out:\x20','getMonth','delete','\x20status:\x20','21170kxeigP','getUserById','gatewayOrderId','paidOutUSDT','failureMessage','notes','map','dateTo','not\x20set','Insufficient\x20balance.\x20Available:\x20','reduce','year','\x20USDT','update','\x20\x20\x20🌍\x20Country:\x20','updatedAt','💰\x20Creating\x20payout\x20for\x20shop\x20','createUser','5674941vXoETC','toString','password','\x20->\x20','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','turnoverUSDT','split','sk_','\x20for\x20shop\x20','💸\x20CHARGEBACK\x20penalty:\x20-','lte','externalPaymentUrl','getFullYear','Plisio','toISOString','🔄\x20Admin\x20updating\x20payment\x20','78RxLrCe','totalPaidOut','merchantEarningsUSDT','totalCommissionRate','pk_','toFixed','COMPLETED','💰\x20Payment\x20','month','usdtErcWallet','10846682GqUFWw','currency','createPayout','customerIp','default','\x20USDT\x20(-','\x20became\x20PAID:\x20+','averageCommissionRate','currencyService','status','findMany','shop','count','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','all','ACTIVE','__importDefault','\x20\x20\x20💰\x20Total\x20turnover:\x20','totalPayout','successUrl','payment','name','createdAt','Payment\x20not\x20found','getTime','KLYME\x20GB','updateUser','__esModule','wallets','\x20USDT\x20from\x20balance','log','paymentsCount','💰\x20Shop\x20','create','💰\x20Current\x20shop\x20balance:\x20','chargebackAmount','averageCheckUSDT','_sum','gateway','string','\x20\x20\x20📊\x20Total\x20payments:\x20','gateways','../config/database','usdtPolygonWallet','toLowerCase','forEach','\x20merchants\x20with\x20positive\x20balance','959FnxIRF','66008EiHmBS','getPayoutStats','paidAt','amountUSDT','amount','gte','whiteUrl','parse','getAllUsers','customerEmail','AdminService','telegramId','\x20USDT\x20(total\x20merchant\x20balances)','availableBalance','usdtTrcWallet','CoinToPay','adminNotes','gatewayEarnings','1225902szRuyJ','38238228FlBIJM','username','period','periodTo','usdcPolygonWallet','\x20USDT\x20(total\x20paid\x20to\x20merchants)','periodFrom','sort','balance','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','findUnique','30wcVDBi','gatewaySettings','deletePayout','hex','dateFrom','\x20USDT\x20total','SUSPENDED','customerName','shopUrl','\x20\x20\x20Payout\x20amount:\x20','\x20paid\x20payments\x20for\x20analysis','getMerchantStatistics','totalPayments','Noda','REFUND','\x20\x20\x20📅\x20This\x20month:\x20','round','getAllPayments','PAID','thisMonth','Test\x20Gateway','statusChangedAt','payout','insensitive','hash','💰\x20Found\x20','\x20USDT)','set','12QdfSUZ','crypto','network','toUpperCase','randomBytes','📊\x20Calculating\x20payout\x20statistics...','Username\x20already\x20exists','pendingUrl','KLYME\x20DE','paymentGateways','aggregate','commissionUSDT','Telegram\x20username\x20already\x20exists','20wxptyY','convertToUSDT'];a35_0x49db=function(){return _0x4465f9;};return a35_0x49db();}exports[a35_0x3d76d5(0x285)]=AdminService;