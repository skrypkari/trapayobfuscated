'use strict';const a38_0x1e9c56=a38_0x4270;(function(_0x46d1db,_0x3b4c9b){const _0x101eb1=a38_0x4270,_0x7bf37e=_0x46d1db();while(!![]){try{const _0x248a87=parseInt(_0x101eb1(0xb5))/0x1*(-parseInt(_0x101eb1(0xeb))/0x2)+-parseInt(_0x101eb1(0xec))/0x3*(parseInt(_0x101eb1(0x175))/0x4)+parseInt(_0x101eb1(0xf5))/0x5*(parseInt(_0x101eb1(0x159))/0x6)+-parseInt(_0x101eb1(0x13b))/0x7*(-parseInt(_0x101eb1(0x138))/0x8)+-parseInt(_0x101eb1(0x17e))/0x9+parseInt(_0x101eb1(0x18e))/0xa+-parseInt(_0x101eb1(0x128))/0xb*(-parseInt(_0x101eb1(0xbb))/0xc);if(_0x248a87===_0x3b4c9b)break;else _0x7bf37e['push'](_0x7bf37e['shift']());}catch(_0x5c0445){_0x7bf37e['push'](_0x7bf37e['shift']());}}}(a38_0x1a83,0xa0401));function a38_0x4270(_0x28dd04,_0x150e76){const _0x1a834c=a38_0x1a83();return a38_0x4270=function(_0x427011,_0x31a0d9){_0x427011=_0x427011-0xb2;let _0x260d87=_0x1a834c[_0x427011];return _0x260d87;},a38_0x4270(_0x28dd04,_0x150e76);}function a38_0x1a83(){const _0x155eac=['statusChangedAt','\x27\x20not\x20found.\x20Available\x20gateways:\x20','556964SIyFgf','generateDailyStatistics','📅\x20Period:\x20','toLowerCase','amountAfterCommissionUSDT','\x20\x20\x20Balance:\x20','getTime','CHARGEBACK','\x20in\x20','9117360DXLonl','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','MasterCard','month','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','failUrl','successUrl','📋\x20Getting\x20merchants\x20selection\x20list...','📊\x20Merchant\x20statistics\x20calculated:','💰\x20Creating\x20payout\x20for\x20shop\x20','txid','entries','Noda','randomBytes','insensitive','⚠️\x20Payment\x20','339920qtDhUH','\x20for\x20shop\x20','customerUa','chargebackAmount','hash',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','turnover',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','forEach','ACTIVE','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','name','year','shopUrl','amountAfterGatewayCommissionUSDT','✅\x20Using\x20gateway\x20filter:\x20\x27','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','dailyRevenue','\x20\x20\x20⏳\x20Pending\x20payout:\x20','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','failureMessage','findUnique','🔄\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','network','PENDING','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','🔐\x20[','getPayoutStats','\x20to\x20','\x20\x20\x20�📊\x20Total\x20payments:\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','trim','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','pendingPayout','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','count','localeCompare','\x20USDT\x20(','turnoverUSDT','📊\x20Payout\x20statistics\x20calculated:','split','createUser','findFirst','amount','\x20\x20\x20Merchant\x20gets:\x20','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','🎯\x20[','paidOutUSDT','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','desc','\x20USDT\x20(-','dateTo','customerName','./currencyService','trc20','log','updateCustomerData','📊\x20Merchants\x20awaiting\x20payout:\x20','currency','\x20USDT\x20(theoretical\x20net)','\x20\x20\x20Current\x20balance:\x20','Plisio','Open\x20Banking\x202','balance','cointopay2','_count','dateFrom','0000','commissionUSDT','toString','delete','\x20became\x20PAID:','\x20order','customerCountry','amountUSDT','\x20\x20\x20Gateway:\x20','getFullYear','gatewaySettings','usdtErcWallet','gatewayCommissionRate','\x20\x20\x20📅\x20This\x20month:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','all','\x20\x20\x20💵\x20Available\x20balance:\x20','fullName','telegram','30d','merchantEarningsUSDT','\x20\x20\x20Transaction\x20hash:\x20','2020-01-01','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','commission','\x20active\x20merchants\x20for\x20selection','getDate','totalAmountUSDT','\x20USDT','💰\x20[PAYOUT]\x20Gateway\x20','📊\x20Available\x20gateways\x20in\x20database:','\x27\x20(from\x20\x27','updateUser','getGatewayInternalName','test_gateway','Shop\x20not\x20found','paymentsCount','createdAt','635wzQbqo','90d','convertToUSDT','setDate','day','\x20PAID\x20payments','904920oFKPMJ','values','KLYME\x20GB','payout','\x20USDT\x20(+','🔧\x20[','externalPaymentUrl','activateUser','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20',']\x20Updating\x20password\x20for\x20user\x20','telegramId','paymentGateways','gatewayEarnings','💰\x20Payment\x20','totalPayout','deletePayout','getGatewayNameById','🔍\x20Using\x20gateway\x20\x27','pendingUrl','asc','getMerchantsSelection','totalPaidOut',']\x20Gateway\x20settings\x20JSON\x20string:','\x20no\x20longer\x20PAID:','thisMonth','yesterday','\x20merchants','create','\x20USDT\x20(total\x20paid\x20to\x20merchants)','publicKey','gatewayOrderId','\x20\x20\x20Merchant\x20loses:\x20','orderId','plisio','toUpperCase','📊\x20Final\x20WHERE\x20conditions:','revenue','password','groupBy','\x27\x20->\x20ID\x20\x27','gateways','polygon','noda','toFixed','customerIp','_sum','status','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','70JhAppj','3YNiqpN','Telegram\x20username\x20already\x20exists','substr','📊\x20Sorting\x20payments\x20by\x20','getMerchantsAwaitingPayout','cointopay','gateway','push','admin','13820NkoUYE','setHours','date','rapyd','periodTo','🔄\x20Gateway\x20mapping\x20(get):','getGatewayDisplayName','update','\x27\x20to\x20name\x20\x27','\x20balance\x20updated:','totalPayments','getSystemStatistics','error','\x20status:\x20','gte','ceil','\x20\x20\x20🌍\x20Country:\x20','\x20\x20\x20Full\x20amount:\x20','shop','\x20USDT\x20(gross\x20revenue)','\x20\x20\x20🌐\x20IP:\x20','\x20payments)','getUserById','📊\x20Calculating\x20payout\x20statistics...','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20USDT\x20(current\x20balance\x20in\x20DB)','erc20','round','reduce','get','__esModule','💰\x20[PAYOUT]\x20Merchant\x20','payment','aggregate','merchantEarnings','random','📊\x20Getting\x20payments\x20with\x20filters:','💰\x20Shop\x20','periodFrom','customerEmail','klyme_gb','length','Rapyd','usdtTrcWallet','updatedAt','paidAt','adminNotes','join','klyme_eu','\x20merchants\x20with\x20positive\x20balance','getMonth','11ySQQMZ','username','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','lte','usdcErcWallet',',\x20Commission:\x20','COMPLETED','\x20\x20\x20💳\x20Total\x20payments:\x20','custom','wallets','../types/gateway','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','💸\x20CHARGEBACK\x20penalty:\x20-','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','5126120PTqNwo','hex','currencyService','7yMUriu','includes',',\x20successful:\x20','whiteUrl','PAID','sort','default','statusChangedBy','⚠️\x20Requested\x20gateway\x20\x27','map','usdtPolygonWallet','deleteUser','week','Username\x20already\x20exists','stringify','mastercard','findMany','getGatewayIdByName','not\x20set','notes','not\x20specified','getMerchantStatistics','period','%\x20from\x20','../config/database','erc20_usdc','\x20->\x20','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','klyme_de','averageCheckUSDT','2346pxNxkC','toISOString','✅\x20Payout\x20created:\x20','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','parse','shopId','getAllPayouts','totalCommissionRate','set','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','Insufficient\x20balance.\x20Available:\x20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','crypto','\x20USDT\x20for\x20payment\x20','usdcPolygonWallet','merchantUrl','🔄\x20Gateway\x20mapping\x20(create):','Test\x20Gateway','\x20balance\x20updated:\x20','📊\x20Total\x20payments\x20(including\x20failed):\x20','📊\x20Gateway\x20filter\x20applied:','💱\x20Currency\x20filter\x20applied:\x20','REFUND','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','💰\x20Current\x20shop\x20balance:\x20'];a38_0x1a83=function(){return _0x155eac;};return a38_0x1a83();}var __importDefault=this&&this['__importDefault']||function(_0x3a7b37){const _0x2eec04=a38_0x4270;return _0x3a7b37&&_0x3a7b37[_0x2eec04(0x113)]?_0x3a7b37:{'default':_0x3a7b37};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a38_0x1e9c56(0x153))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a38_0x1e9c56(0x166))),currencyService_1=require(a38_0x1e9c56(0x1c6)),gateway_1=require(a38_0x1e9c56(0x132));class AdminService{async[a38_0x1e9c56(0x1ab)](){const _0x17e0b4=a38_0x1e9c56;console[_0x17e0b4(0x1c8)](_0x17e0b4(0x10c));const _0x58e22b=await database_1['default']['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x17e0b4(0x197)}}),_0x48a373=await database_1[_0x17e0b4(0x141)][_0x17e0b4(0x115)][_0x17e0b4(0x1b3)]({'where':{'status':_0x17e0b4(0x13f),'gateway':{'not':_0x17e0b4(0x1f7)}}}),_0x47fe75=new Date(),_0x1a407f=new Date(_0x47fe75[_0x17e0b4(0x1dd)](),_0x47fe75['getMonth'](),0x1),_0x502919=new Date(_0x47fe75[_0x17e0b4(0x1dd)](),_0x47fe75[_0x17e0b4(0x127)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3c69f0=await database_1[_0x17e0b4(0x141)]['payout'][_0x17e0b4(0x116)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1a407f,'lte':_0x502919},'status':'COMPLETED'}}),_0x3b6ec7=_0x58e22b[_0x17e0b4(0xe8)][_0x17e0b4(0xd0)]||0x0,_0x2ec100=_0x58e22b[_0x17e0b4(0xe8)][_0x17e0b4(0x1d0)]||0x0,_0xdf9e8=_0x3c69f0[_0x17e0b4(0xe8)][_0x17e0b4(0x1bb)]||0x0,_0x11eaec={'totalPayout':Math['round'](_0x3b6ec7*0x64)/0x64,'awaitingPayout':Math[_0x17e0b4(0x110)](_0x2ec100*0x64)/0x64,'thisMonth':Math['round'](_0xdf9e8*0x64)/0x64,'availableBalance':Math[_0x17e0b4(0x110)](_0x2ec100*0x64)/0x64,'totalPayments':_0x48a373};return console[_0x17e0b4(0x1c8)](_0x17e0b4(0x1b7)),console['log'](_0x17e0b4(0x162)+_0x11eaec['totalPayout']+_0x17e0b4(0xd7)),console['log'](_0x17e0b4(0x17f)+_0x11eaec['awaitingPayout']+_0x17e0b4(0x163)),console[_0x17e0b4(0x1c8)](_0x17e0b4(0x1e5)+_0x11eaec['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x17e0b4(0x1e1)+_0x11eaec[_0x17e0b4(0xd3)]+_0x17e0b4(0x1f1)),console[_0x17e0b4(0x1c8)](_0x17e0b4(0x12f)+_0x11eaec[_0x17e0b4(0xff)]+_0x17e0b4(0xba)),_0x11eaec;}async[a38_0x1e9c56(0x1c9)](_0x1293b8,_0x5bd69a){const _0x5db0e2=a38_0x1e9c56;console[_0x5db0e2(0x1c8)](_0x5db0e2(0xc3)+_0x1293b8+':',_0x5bd69a);const _0x56668c=await database_1[_0x5db0e2(0x141)][_0x5db0e2(0x115)][_0x5db0e2(0x1a4)]({'where':{'id':_0x1293b8},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x56668c)throw new Error('Payment\x20not\x20found');const _0x415c4f={};_0x5bd69a['customerCountry']!==undefined&&(_0x415c4f[_0x5db0e2(0x1da)]=_0x5bd69a[_0x5db0e2(0x1da)]||null);_0x5bd69a[_0x5db0e2(0xe7)]!==undefined&&(_0x415c4f['customerIp']=_0x5bd69a[_0x5db0e2(0xe7)]||null);_0x5bd69a[_0x5db0e2(0x190)]!==undefined&&(_0x415c4f[_0x5db0e2(0x190)]=_0x5bd69a[_0x5db0e2(0x190)]||null);const _0x2800d8=await database_1['default']['payment'][_0x5db0e2(0xfc)]({'where':{'id':_0x1293b8},'data':{..._0x415c4f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5db0e2(0x1c8)](_0x5db0e2(0x137)+_0x1293b8),console[_0x5db0e2(0x1c8)](_0x5db0e2(0x105)+_0x56668c['customerCountry']+_0x5db0e2(0x155)+_0x2800d8['customerCountry']),console[_0x5db0e2(0x1c8)](_0x5db0e2(0x109)+_0x56668c[_0x5db0e2(0xe7)]+_0x5db0e2(0x155)+_0x2800d8[_0x5db0e2(0xe7)]),console['log'](_0x5db0e2(0x1a2)+(_0x56668c['customerUa']?'set':_0x5db0e2(0x14d))+_0x5db0e2(0x155)+(_0x2800d8[_0x5db0e2(0x190)]?_0x5db0e2(0x161):'not\x20set')),_0x2800d8;}async[a38_0x1e9c56(0x100)](_0x4ba6e3){const _0x9ef4f6=a38_0x1e9c56,_0x52a5ab=new Date();let _0x349ee9;switch(_0x4ba6e3[_0x9ef4f6(0x178)]()){case _0x9ef4f6(0xb9):_0x349ee9=new Date(_0x52a5ab[_0x9ef4f6(0x1dd)](),_0x52a5ab[_0x9ef4f6(0x127)](),_0x52a5ab[_0x9ef4f6(0x1ef)](),0x0,0x0,0x0,0x0);break;case _0x9ef4f6(0xd4):const _0x21a5c5=new Date(_0x52a5ab);_0x21a5c5[_0x9ef4f6(0xb8)](_0x21a5c5[_0x9ef4f6(0x1ef)]()-0x1),_0x349ee9=new Date(_0x21a5c5[_0x9ef4f6(0x1dd)](),_0x21a5c5['getMonth'](),_0x21a5c5['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x349ee9=new Date(_0x52a5ab[_0x9ef4f6(0x17b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x9ef4f6(0x1e8):_0x349ee9=new Date(_0x52a5ab[_0x9ef4f6(0x17b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x9ef4f6(0xb6):_0x349ee9=new Date(_0x52a5ab[_0x9ef4f6(0x17b)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x9ef4f6(0x1e4):const _0x5dc41c=await database_1['default'][_0x9ef4f6(0x115)][_0x9ef4f6(0x1ba)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x349ee9=_0x5dc41c?_0x5dc41c[_0x9ef4f6(0xb4)]:new Date(_0x9ef4f6(0x1eb));break;default:_0x349ee9=new Date(_0x52a5ab[_0x9ef4f6(0x17b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x349ee9['setHours'](0x0,0x0,0x0,0x0);let _0x35e1bc;if(_0x4ba6e3['toLowerCase']()===_0x9ef4f6(0xd4)){const _0x504021=new Date(_0x52a5ab);_0x504021[_0x9ef4f6(0xb8)](_0x504021['getDate']()-0x1),_0x35e1bc=new Date(_0x504021[_0x9ef4f6(0x1dd)](),_0x504021[_0x9ef4f6(0x127)](),_0x504021['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x555430={'gte':_0x349ee9};_0x35e1bc&&(_0x555430[_0x9ef4f6(0x12b)]=_0x35e1bc);const [_0x38d7ff,_0x168ae6,_0x2cc257,_0x348645,_0x474b96,_0x2803b8]=await Promise[_0x9ef4f6(0x1e4)]([database_1[_0x9ef4f6(0x141)]['shop'][_0x9ef4f6(0x1b3)](),database_1[_0x9ef4f6(0x141)][_0x9ef4f6(0x107)][_0x9ef4f6(0x1b3)]({'where':{'status':_0x9ef4f6(0x197)}}),database_1[_0x9ef4f6(0x141)][_0x9ef4f6(0x115)]['count']({'where':{'status':'PAID','createdAt':_0x555430,'gateway':{'not':_0x9ef4f6(0x1f7)}}}),database_1[_0x9ef4f6(0x141)][_0x9ef4f6(0x115)][_0x9ef4f6(0x14b)]({'where':{'status':_0x9ef4f6(0x13f),'createdAt':_0x555430,'gateway':{'not':_0x9ef4f6(0x1f7)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x9ef4f6(0x141)][_0x9ef4f6(0x115)]['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x9ef4f6(0x1c2)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x9ef4f6(0x115)][_0x9ef4f6(0x14b)]({'where':{'createdAt':_0x555430,'gateway':{'not':_0x9ef4f6(0x1f7)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x9ade1=0x0,_0x5205ad=0x0;for(const _0x2e8db6 of _0x348645){const _0x2e7e0e=await currencyService_1[_0x9ef4f6(0x13a)][_0x9ef4f6(0xb7)](_0x2e8db6[_0x9ef4f6(0x1bb)],_0x2e8db6[_0x9ef4f6(0x1cb)]);_0x9ade1+=_0x2e7e0e;if(_0x2e8db6[_0x9ef4f6(0x19c)]){const _0x2e6312=await currencyService_1['currencyService'][_0x9ef4f6(0xb7)](_0x2e8db6[_0x9ef4f6(0x1bb)],_0x2e8db6[_0x9ef4f6(0x1cb)]),_0x21b67d=_0x2e8db6[_0x9ef4f6(0x19c)],_0x5d87dd=_0x2e6312-_0x21b67d;_0x5205ad+=_0x5d87dd;}}const _0x3f92ad=_0x2cc257>0x0?_0x9ade1/_0x2cc257:0x0,_0x43d74c=this['generateDailyStatistics'](_0x2803b8,_0x349ee9,_0x35e1bc||_0x52a5ab),_0x1f104e=await database_1[_0x9ef4f6(0x141)][_0x9ef4f6(0x115)][_0x9ef4f6(0x1b3)]({'where':{'createdAt':_0x555430,'gateway':{'not':'test_gateway'}}}),_0x1a20c0=_0x1f104e>0x0?_0x2cc257/_0x1f104e*0x64:0x0;return{'totalShops':_0x38d7ff,'activeShops':_0x168ae6,'totalPayments':_0x2cc257,'successfulPayments':_0x2cc257,'totalAttempts':_0x1f104e,'totalRevenue':Math[_0x9ef4f6(0x110)](_0x9ade1*0x64)/0x64,'trapayEarnings':Math['round'](_0x5205ad*0x64)/0x64,'averagePaymentAmount':Math[_0x9ef4f6(0x110)](_0x3f92ad*0x64)/0x64,'conversionRate':Math[_0x9ef4f6(0x110)](_0x1a20c0*0x64)/0x64,'dailyRevenue':_0x43d74c[_0x9ef4f6(0x19f)],'dailyPayments':_0x43d74c['dailyPayments'],'recentPayments':_0x474b96[_0x9ef4f6(0x144)](_0x5e8b28=>({'id':_0x5e8b28['id'],'amount':_0x5e8b28[_0x9ef4f6(0x1bb)],'currency':_0x5e8b28[_0x9ef4f6(0x1cb)],'status':_0x5e8b28['status'],'gateway':_0x5e8b28[_0x9ef4f6(0xf2)],'shop':_0x5e8b28['shop'],'createdAt':_0x5e8b28[_0x9ef4f6(0xb4)]}))};}async[a38_0x1e9c56(0x150)](_0x2954d3){const _0x39bc70=a38_0x1e9c56;console[_0x39bc70(0x1c8)](_0x39bc70(0x12a),_0x2954d3);let _0x43d84d,_0x36379d=new Date();if(_0x2954d3[_0x39bc70(0x151)]===_0x39bc70(0x130)&&_0x2954d3[_0x39bc70(0x1d3)]&&_0x2954d3[_0x39bc70(0x1c4)])_0x43d84d=new Date(_0x2954d3['dateFrom']),_0x36379d=new Date(_0x2954d3['dateTo']),_0x43d84d['setHours'](0x0,0x0,0x0,0x0),_0x36379d[_0x39bc70(0xf6)](0x17,0x3b,0x3b,0x3e7);else{const _0x4fcc50=new Date();switch(_0x2954d3[_0x39bc70(0x151)]){case _0x39bc70(0x147):_0x43d84d=new Date(_0x4fcc50[_0x39bc70(0x17b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x39bc70(0x181):_0x43d84d=new Date(_0x4fcc50[_0x39bc70(0x17b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x39bc70(0x19a):_0x43d84d=new Date(_0x4fcc50[_0x39bc70(0x17b)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x43d84d=new Date(_0x39bc70(0x1eb));break;}_0x43d84d[_0x39bc70(0xf6)](0x0,0x0,0x0,0x0),_0x36379d[_0x39bc70(0xf6)](0x17,0x3b,0x3b,0x3e7);}console[_0x39bc70(0x1c8)](_0x39bc70(0x177)+_0x43d84d['toISOString']()+_0x39bc70(0x1ac)+_0x36379d[_0x39bc70(0x15a)]());const _0x214a1e={'status':_0x39bc70(0x13f),'gateway':{'not':_0x39bc70(0x1f7)},'paidAt':{'gte':_0x43d84d,'lte':_0x36379d}};_0x2954d3[_0x39bc70(0x15e)]&&(_0x214a1e['shopId']=_0x2954d3['shopId']);const _0x3474f6=await database_1['default'][_0x39bc70(0x115)][_0x39bc70(0x14b)]({'where':_0x214a1e,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('💰\x20Found\x20'+_0x3474f6['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x16ce02={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x43d84d,'lte':_0x36379d}};_0x2954d3[_0x39bc70(0x15e)]&&(_0x16ce02[_0x39bc70(0x15e)]=_0x2954d3[_0x39bc70(0x15e)]);const _0x238565=await database_1[_0x39bc70(0x141)][_0x39bc70(0x115)]['count']({'where':_0x16ce02});console[_0x39bc70(0x1c8)](_0x39bc70(0x16d)+_0x238565+_0x39bc70(0x13d)+_0x3474f6[_0x39bc70(0x11e)]);let _0x2c3d45=0x0,_0x255b18=0x0,_0x1a61f3=0x0;const _0x12fa6b={},_0x1bed58={},_0x12cc77={};for(const _0x4e3ad8 of _0x3474f6){try{const _0x4157ce=_0x4e3ad8[_0x39bc70(0x1db)]||0x0;if(_0x4157ce<=0x0){console['warn'](_0x39bc70(0x18d)+_0x4e3ad8['id']+_0x39bc70(0x1a9));continue;}let _0x13ac65,_0x71d9e3;if(_0x4e3ad8['amountAfterGatewayCommissionUSDT']!==null&&_0x4e3ad8['amountAfterGatewayCommissionUSDT']!==undefined)_0x13ac65=_0x4e3ad8['amountAfterGatewayCommissionUSDT'],_0x71d9e3=_0x4157ce-_0x13ac65,console[_0x39bc70(0x1c8)]('📊\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x4e3ad8['id']+':\x20'+_0x4157ce[_0x39bc70(0xe6)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x13ac65[_0x39bc70(0xe6)](0x6)+'\x20USDT');else{let _0x3bb75c={};if(_0x4e3ad8[_0x39bc70(0x107)][_0x39bc70(0x1de)])try{_0x3bb75c=JSON[_0x39bc70(0x15d)](_0x4e3ad8[_0x39bc70(0x107)][_0x39bc70(0x1de)]);}catch(_0x3079a6){console[_0x39bc70(0x101)](_0x39bc70(0x1b0)+_0x4e3ad8[_0x39bc70(0x15e)]+':',_0x3079a6);}let _0x3542aa=0x2d;for(const [_0x219d84,_0x36f78f]of Object[_0x39bc70(0x189)](_0x3bb75c)){if(_0x219d84[_0x39bc70(0x178)]()===_0x4e3ad8[_0x39bc70(0xf2)][_0x39bc70(0x178)]()){_0x3542aa=_0x36f78f['commission']||0x2d;break;}}_0x71d9e3=_0x4157ce*(_0x3542aa/0x64),_0x13ac65=_0x4157ce-_0x71d9e3,console[_0x39bc70(0x1c8)](_0x39bc70(0x1a1)+_0x4e3ad8['id']+':\x20'+_0x3542aa+_0x39bc70(0x152)+_0x4157ce['toFixed'](0x6)+'\x20USDT');}_0x2c3d45+=_0x4157ce,_0x255b18+=_0x13ac65,_0x1a61f3+=_0x71d9e3;let _0x27731c;_0x4e3ad8[_0x39bc70(0x1e0)]!==null&&_0x4e3ad8[_0x39bc70(0x1e0)]!==undefined?(_0x27731c=_0x4e3ad8[_0x39bc70(0x1e0)],console[_0x39bc70(0x1c8)](_0x39bc70(0x15c)+_0x4e3ad8['id']+':\x20'+_0x27731c+'%')):(_0x27731c=_0x4157ce>0x0?_0x71d9e3/_0x4157ce*0x64:0x0,console[_0x39bc70(0x1c8)](_0x39bc70(0x136)+_0x4e3ad8['id']+':\x20'+_0x27731c[_0x39bc70(0xe6)](0x2)+'%'));!_0x12fa6b[_0x4e3ad8[_0x39bc70(0xf2)]]&&(_0x12fa6b[_0x4e3ad8[_0x39bc70(0xf2)]]={'gateway':_0x4e3ad8['gateway'],'gatewayDisplayName':this[_0x39bc70(0xfb)](_0x4e3ad8[_0x39bc70(0xf2)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x12fa6b[_0x4e3ad8['gateway']][_0x39bc70(0xb3)]++,_0x12fa6b[_0x4e3ad8[_0x39bc70(0xf2)]][_0x39bc70(0x1b6)]+=_0x4157ce,_0x12fa6b[_0x4e3ad8['gateway']]['commissionUSDT']+=_0x71d9e3,_0x12fa6b[_0x4e3ad8[_0x39bc70(0xf2)]][_0x39bc70(0x1e9)]+=_0x13ac65,_0x12fa6b[_0x4e3ad8['gateway']][_0x39bc70(0x160)]+=_0x27731c;!_0x2954d3['shopId']&&(!_0x1bed58[_0x4e3ad8[_0x39bc70(0x15e)]]&&(_0x1bed58[_0x4e3ad8[_0x39bc70(0x15e)]]={'shopId':_0x4e3ad8[_0x39bc70(0x15e)],'shopName':_0x4e3ad8[_0x39bc70(0x107)][_0x39bc70(0x199)],'shopUsername':_0x4e3ad8[_0x39bc70(0x107)][_0x39bc70(0x129)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1bed58[_0x4e3ad8[_0x39bc70(0x15e)]][_0x39bc70(0xb3)]++,_0x1bed58[_0x4e3ad8[_0x39bc70(0x15e)]][_0x39bc70(0x1b6)]+=_0x4157ce,_0x1bed58[_0x4e3ad8[_0x39bc70(0x15e)]]['commissionUSDT']+=_0x71d9e3,_0x1bed58[_0x4e3ad8[_0x39bc70(0x15e)]]['merchantEarningsUSDT']+=_0x13ac65);const _0x5bab62=_0x4e3ad8['paidAt'][_0x39bc70(0x15a)]()[_0x39bc70(0x1b8)]('T')[0x0];!_0x12cc77[_0x5bab62]&&(_0x12cc77[_0x5bab62]={'date':_0x5bab62,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x12cc77[_0x5bab62][_0x39bc70(0x194)]+=_0x4157ce,_0x12cc77[_0x5bab62][_0x39bc70(0x117)]+=_0x13ac65,_0x12cc77[_0x5bab62]['gatewayEarnings']+=_0x71d9e3,_0x12cc77[_0x5bab62][_0x39bc70(0xb3)]++;}catch(_0x30f737){console['error']('Error\x20processing\x20payment\x20'+_0x4e3ad8['id']+':',_0x30f737);}}Object[_0x39bc70(0xbc)](_0x12fa6b)['forEach'](_0x1a9b29=>{const _0x24447b=_0x39bc70;_0x1a9b29['averageCommissionRate']=_0x1a9b29[_0x24447b(0xb3)]>0x0?_0x1a9b29[_0x24447b(0x160)]/_0x1a9b29[_0x24447b(0xb3)]:0x0,delete _0x1a9b29['totalCommissionRate'];}),Object[_0x39bc70(0xbc)](_0x1bed58)[_0x39bc70(0x196)](_0x5b73a7=>{const _0x37d1c4=_0x39bc70;_0x5b73a7[_0x37d1c4(0x158)]=_0x5b73a7[_0x37d1c4(0xb3)]>0x0?_0x5b73a7[_0x37d1c4(0x1b6)]/_0x5b73a7['paymentsCount']:0x0;});let _0x397f79=0x0,_0x179cb3=0x0;if(_0x2954d3[_0x39bc70(0x15e)]){const _0x4ed01d=await database_1[_0x39bc70(0x141)][_0x39bc70(0xbe)][_0x39bc70(0x14b)]({'where':{'shopId':_0x2954d3['shopId'],'status':_0x39bc70(0x12e),'createdAt':{'gte':_0x43d84d,'lte':_0x36379d}},'select':{'amount':!![]}});_0x397f79=_0x4ed01d[_0x39bc70(0x111)]((_0xb6ad70,_0x1b9b33)=>_0xb6ad70+_0x1b9b33[_0x39bc70(0x1bb)],0x0);const _0x42d5bf=await database_1[_0x39bc70(0x141)][_0x39bc70(0xbe)]['findMany']({'where':{'shopId':_0x2954d3[_0x39bc70(0x15e)],'status':_0x39bc70(0x1a8),'createdAt':{'gte':_0x43d84d,'lte':_0x36379d}},'select':{'amount':!![]}});_0x179cb3=_0x42d5bf[_0x39bc70(0x111)]((_0x2628bb,_0x24360e)=>_0x2628bb+_0x24360e[_0x39bc70(0x1bb)],0x0);}const _0x514b66=_0x238565,_0x40ba32=_0x3474f6[_0x39bc70(0x11e)],_0x43e1cb=_0x40ba32>0x0?_0x2c3d45/_0x40ba32:0x0,_0x4328a5=_0x514b66>0x0?Math[_0x39bc70(0x110)](_0x40ba32/_0x514b66*0x2710)/0x64:0x0,_0x24c02b=Math['ceil']((_0x36379d[_0x39bc70(0x17b)]()-_0x43d84d[_0x39bc70(0x17b)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5b4df8={'totalTurnover':Math['round'](_0x2c3d45*0x64)/0x64,'merchantEarnings':Math[_0x39bc70(0x110)](_0x255b18*0x64)/0x64,'gatewayEarnings':Math[_0x39bc70(0x110)](_0x1a61f3*0x64)/0x64,'totalPaidOut':Math[_0x39bc70(0x110)](_0x397f79*0x64)/0x64,'pendingPayout':Math[_0x39bc70(0x110)](_0x179cb3*0x64)/0x64,'averageCheck':Math[_0x39bc70(0x110)](_0x43e1cb*0x64)/0x64,'totalPayments':_0x514b66,'successfulPayments':_0x40ba32,'conversionRate':_0x4328a5,'gatewayBreakdown':Object[_0x39bc70(0xbc)](_0x12fa6b)['map'](_0x41f1c9=>({..._0x41f1c9,'turnoverUSDT':Math['round'](_0x41f1c9[_0x39bc70(0x1b6)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x41f1c9[_0x39bc70(0x1d5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x39bc70(0x110)](_0x41f1c9[_0x39bc70(0x1e9)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x41f1c9['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x2954d3['shopId']?undefined:Object[_0x39bc70(0xbc)](_0x1bed58)['map'](_0x561cc8=>({..._0x561cc8,'turnoverUSDT':Math[_0x39bc70(0x110)](_0x561cc8[_0x39bc70(0x1b6)]*0x64)/0x64,'commissionUSDT':Math[_0x39bc70(0x110)](_0x561cc8[_0x39bc70(0x1d5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x39bc70(0x110)](_0x561cc8['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x561cc8[_0x39bc70(0x1c0)]*0x64)/0x64,'averageCheckUSDT':Math[_0x39bc70(0x110)](_0x561cc8[_0x39bc70(0x158)]*0x64)/0x64})),'dailyData':Object[_0x39bc70(0xbc)](_0x12cc77)['map'](_0x1ec08f=>({..._0x1ec08f,'turnover':Math[_0x39bc70(0x110)](_0x1ec08f[_0x39bc70(0x194)]*0x64)/0x64,'merchantEarnings':Math[_0x39bc70(0x110)](_0x1ec08f[_0x39bc70(0x117)]*0x64)/0x64,'gatewayEarnings':Math[_0x39bc70(0x110)](_0x1ec08f[_0x39bc70(0xc7)]*0x64)/0x64}))[_0x39bc70(0x140)]((_0x16209d,_0x148a2b)=>_0x16209d[_0x39bc70(0xf7)][_0x39bc70(0x1b4)](_0x148a2b['date'])),'periodInfo':{'from':_0x43d84d,'to':_0x36379d,'periodType':_0x2954d3[_0x39bc70(0x151)]||_0x39bc70(0x130),'daysCount':_0x24c02b}};return console[_0x39bc70(0x1c8)](_0x39bc70(0x186)),console[_0x39bc70(0x1c8)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x5b4df8['totalTurnover']+_0x39bc70(0x1f1)),console[_0x39bc70(0x1c8)](_0x39bc70(0x198)+_0x5b4df8[_0x39bc70(0x117)]+_0x39bc70(0x1f1)),console[_0x39bc70(0x1c8)](_0x39bc70(0x1ec)+_0x5b4df8[_0x39bc70(0xc7)]+_0x39bc70(0x1f1)),console[_0x39bc70(0x1c8)](_0x39bc70(0x1be)+_0x5b4df8['totalPaidOut']+_0x39bc70(0x1f1)),console[_0x39bc70(0x1c8)](_0x39bc70(0x1a0)+_0x5b4df8[_0x39bc70(0x1b1)]+_0x39bc70(0x1f1)),console[_0x39bc70(0x1c8)](_0x39bc70(0x1ad)+_0x5b4df8[_0x39bc70(0xff)]),_0x5b4df8;}async[a38_0x1e9c56(0xcf)](){const _0x57e6a9=a38_0x1e9c56;console['log'](_0x57e6a9(0x185));const _0x49341b=await database_1['default'][_0x57e6a9(0x107)]['findMany']({'where':{'status':_0x57e6a9(0x197)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x57e6a9(0xce)}});return console[_0x57e6a9(0x1c8)]('📋\x20Found\x20'+_0x49341b[_0x57e6a9(0x11e)]+_0x57e6a9(0x1ee)),_0x49341b[_0x57e6a9(0x144)](_0x55398a=>({'id':_0x55398a['id'],'username':_0x55398a[_0x57e6a9(0x129)],'name':_0x55398a['name']}));}[a38_0x1e9c56(0xfb)](_0x3221ee){const _0x525d4f=a38_0x1e9c56,_0x5ca57c={'test_gateway':_0x525d4f(0x16b),'plisio':_0x525d4f(0x1ce),'rapyd':_0x525d4f(0x11f),'noda':_0x525d4f(0x18a),'cointopay':'CoinToPay','cointopay2':_0x525d4f(0x1cf),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x525d4f(0xbd),'klyme_de':'KLYME\x20DE','mastercard':_0x525d4f(0x180)};return _0x5ca57c[_0x3221ee]||_0x3221ee;}[a38_0x1e9c56(0x1f6)](_0x231e84){const _0xbdbfa6=a38_0x1e9c56,_0x197f31={'Test\x20Gateway':_0xbdbfa6(0x1f7),'Plisio':_0xbdbfa6(0xdc),'Rapyd':_0xbdbfa6(0xf8),'Noda':_0xbdbfa6(0xe5),'CoinToPay':_0xbdbfa6(0xf1),'CoinToPay2':_0xbdbfa6(0x1d1),'KLYME\x20EU':_0xbdbfa6(0x125),'KLYME\x20GB':_0xbdbfa6(0x11d),'KLYME\x20DE':_0xbdbfa6(0x157),'MasterCard':_0xbdbfa6(0x14a)};return _0x197f31[_0x231e84]||_0x231e84[_0xbdbfa6(0x178)]();}async[a38_0x1e9c56(0xf0)](_0x9926f0){const _0x43972c=a38_0x1e9c56,{page:_0x1bdfd4,limit:_0x42efdc,minAmount:_0x489a55,search:_0x31def7}=_0x9926f0,_0x43ef09=(_0x1bdfd4-0x1)*_0x42efdc;console[_0x43972c(0x1c8)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x9926f0);const _0x2d18ea={'balance':{'gt':0x0},'status':_0x43972c(0x197)};_0x489a55&&(_0x2d18ea[_0x43972c(0x1d0)][_0x43972c(0x103)]=_0x489a55);_0x31def7&&(_0x2d18ea['name']={'contains':_0x31def7,'mode':_0x43972c(0x18c)});const [_0x2ecbc9,_0x35a0f1]=await Promise[_0x43972c(0x1e4)]([database_1[_0x43972c(0x141)][_0x43972c(0x107)][_0x43972c(0x14b)]({'where':_0x2d18ea,'skip':_0x43ef09,'take':_0x42efdc,'orderBy':{'balance':_0x43972c(0x1c2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x43972c(0x141)][_0x43972c(0x107)]['count']({'where':_0x2d18ea})]);console[_0x43972c(0x1c8)]('💰\x20Found\x20'+_0x2ecbc9[_0x43972c(0x11e)]+_0x43972c(0x126));const _0x44a42d=await Promise[_0x43972c(0x1e4)](_0x2ecbc9[_0x43972c(0x144)](async _0x499e45=>{const _0x4ebe0e=_0x43972c,[_0x2d1cd3,_0x5d8a09,_0x4f7a29]=await Promise[_0x4ebe0e(0x1e4)]([database_1['default'][_0x4ebe0e(0x115)][_0x4ebe0e(0x1b3)]({'where':{'shopId':_0x499e45['id'],'status':'PAID','gateway':{'not':_0x4ebe0e(0x1f7)}}}),database_1[_0x4ebe0e(0x141)][_0x4ebe0e(0x115)][_0x4ebe0e(0x1ba)]({'where':{'shopId':_0x499e45['id'],'status':_0x4ebe0e(0x13f),'gateway':{'not':_0x4ebe0e(0x1f7)}},'orderBy':{'paidAt':_0x4ebe0e(0xce)},'select':{'paidAt':!![]}}),database_1[_0x4ebe0e(0x141)][_0x4ebe0e(0x115)][_0x4ebe0e(0xe1)]({'by':['gateway'],'where':{'shopId':_0x499e45['id'],'status':_0x4ebe0e(0x13f),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x129990=new Date(),_0x571aab=new Date(_0x129990[_0x4ebe0e(0x1dd)](),_0x129990[_0x4ebe0e(0x127)](),0x1),_0x434107=new Date(_0x129990[_0x4ebe0e(0x1dd)](),_0x129990[_0x4ebe0e(0x127)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x4654bd,_0x3f118f]=await Promise[_0x4ebe0e(0x1e4)]([database_1['default']['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x499e45['id'],'status':_0x4ebe0e(0x12e)}}),database_1[_0x4ebe0e(0x141)]['payout'][_0x4ebe0e(0x116)]({'_sum':{'amount':!![]},'where':{'shopId':_0x499e45['id'],'status':_0x4ebe0e(0x12e),'createdAt':{'gte':_0x571aab,'lte':_0x434107}}})]),_0x195e68=_0x4654bd[_0x4ebe0e(0xe8)][_0x4ebe0e(0x1bb)]||0x0,_0x53e22b=_0x3f118f['_sum']['amount']||0x0,_0x89b52e=await Promise['all'](_0x4f7a29['map'](async _0x24b9d4=>{const _0x16e1fa=_0x4ebe0e;let _0xf05541=0x2d;if(_0x499e45['gatewaySettings'])try{const _0x1e8631=JSON[_0x16e1fa(0x15d)](_0x499e45[_0x16e1fa(0x1de)]);for(const [_0x4fe34a,_0x4e251b]of Object['entries'](_0x1e8631)){if(_0x4fe34a['toLowerCase']()===_0x24b9d4[_0x16e1fa(0xf2)]['toLowerCase']()){_0xf05541=_0x4e251b[_0x16e1fa(0x1ed)]||0xa,console[_0x16e1fa(0x1c8)](_0x16e1fa(0x1f2)+_0x24b9d4[_0x16e1fa(0xf2)]+_0x16e1fa(0x18f)+_0x499e45['id']+':\x20commission\x20=\x20'+_0xf05541+'%');break;}}}catch(_0x4a6bb0){console[_0x16e1fa(0x101)](_0x16e1fa(0x1b0)+_0x499e45['id']+':',_0x4a6bb0);}const _0x1a76c1=_0x24b9d4['_sum']?.['amountUSDT']||0x0,_0x255d7d=_0x1a76c1*(0x1-_0xf05541/0x64);return{'gateway':_0x24b9d4[_0x16e1fa(0xf2)],'count':_0x24b9d4[_0x16e1fa(0x1d2)]?.['id']||0x0,'amountUSDT':Math[_0x16e1fa(0x110)](_0x1a76c1*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x255d7d*0x64)/0x64,'commission':_0xf05541};})),_0x4c8906=_0x89b52e[_0x4ebe0e(0x111)]((_0x84f7c0,_0x30a52b)=>_0x84f7c0+_0x30a52b[_0x4ebe0e(0x1db)],0x0),_0x3792d6=_0x89b52e['reduce']((_0x13e07c,_0x1c3b6e)=>_0x13e07c+_0x1c3b6e[_0x4ebe0e(0x179)],0x0),_0x1a2dd5=_0x499e45[_0x4ebe0e(0x1d0)];return console[_0x4ebe0e(0x1c8)](_0x4ebe0e(0x114)+_0x499e45[_0x4ebe0e(0x129)]+':'),console[_0x4ebe0e(0x1c8)]('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x4c8906['toFixed'](0x2)+_0x4ebe0e(0x108)),console[_0x4ebe0e(0x1c8)](_0x4ebe0e(0x1e3)+_0x3792d6[_0x4ebe0e(0xe6)](0x2)+_0x4ebe0e(0x1cc)),console[_0x4ebe0e(0x1c8)](_0x4ebe0e(0x1a6)+_0x1a2dd5[_0x4ebe0e(0xe6)](0x2)+_0x4ebe0e(0x10e)),console[_0x4ebe0e(0x1c8)]('\x20\x20\x20💸\x20Total\x20payouts:\x20'+_0x195e68[_0x4ebe0e(0xe6)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0x4ebe0e(0x1c8)]('\x20\x20\x20🤔\x20Difference:\x20'+(_0x3792d6-_0x195e68-_0x1a2dd5)[_0x4ebe0e(0xe6)](0x2)+_0x4ebe0e(0x19e)),{'id':_0x499e45['id'],'fullName':_0x499e45[_0x4ebe0e(0x199)],'username':_0x499e45[_0x4ebe0e(0x129)],'telegramId':_0x499e45['telegram'],'merchantUrl':_0x499e45[_0x4ebe0e(0x19b)],'wallets':{'usdtPolygonWallet':_0x499e45[_0x4ebe0e(0x145)],'usdtTrcWallet':_0x499e45['usdtTrcWallet'],'usdtErcWallet':_0x499e45[_0x4ebe0e(0x1df)],'usdcPolygonWallet':_0x499e45[_0x4ebe0e(0x168)],'usdcErcWallet':_0x499e45[_0x4ebe0e(0x12c)]},'totalAmountUSDT':Math[_0x4ebe0e(0x110)](_0x4c8906*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4ebe0e(0x110)](_0x3792d6*0x64)/0x64,'currentBalance':Math['round'](_0x1a2dd5*0x64)/0x64,'totalPayout':Math[_0x4ebe0e(0x110)](_0x195e68*0x64)/0x64,'thisMonth':Math[_0x4ebe0e(0x110)](_0x53e22b*0x64)/0x64,'paymentsCount':_0x2d1cd3,'oldestPaymentDate':_0x5d8a09?.[_0x4ebe0e(0x122)]||_0x499e45[_0x4ebe0e(0xb4)],'gatewayBreakdown':_0x89b52e};})),_0x58e91b=_0x44a42d[_0x43972c(0x111)]((_0x41a8aa,_0x4749b6)=>_0x41a8aa+_0x4749b6[_0x43972c(0x1f0)],0x0),_0x459535=_0x44a42d[_0x43972c(0x111)]((_0x37a56a,_0x37d359)=>_0x37a56a+_0x37d359['totalAmountAfterCommissionUSDT'],0x0),_0x41bbd6=_0x44a42d[_0x43972c(0x111)]((_0x2dcfae,_0x23225b)=>_0x2dcfae+_0x23225b[_0x43972c(0xc9)],0x0),_0x3f849d=_0x44a42d['reduce']((_0x230e12,_0x5f46b5)=>_0x230e12+_0x5f46b5[_0x43972c(0xd3)],0x0);return console[_0x43972c(0x1c8)](_0x43972c(0x1ca)+_0x35a0f1+_0x43972c(0xd5)),console[_0x43972c(0x1c8)](_0x43972c(0x1b2)+Math[_0x43972c(0x110)](_0x58e91b*0x64)/0x64+_0x43972c(0x108)),console['log'](_0x43972c(0x165)+Math['round'](_0x459535*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0x43972c(0x1c8)](_0x43972c(0xea)+Math[_0x43972c(0x110)](_0x41bbd6*0x64)/0x64+_0x43972c(0x1f1)),console['log'](_0x43972c(0x182)+Math[_0x43972c(0x110)](_0x3f849d*0x64)/0x64+_0x43972c(0x1f1)),{'merchants':_0x44a42d,'pagination':{'page':_0x1bdfd4,'limit':_0x42efdc,'total':_0x35a0f1,'totalPages':Math[_0x43972c(0x104)](_0x35a0f1/_0x42efdc)},'summary':{'totalMerchants':_0x35a0f1,'totalAmountUSDT':Math[_0x43972c(0x110)](_0x58e91b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x43972c(0x110)](_0x459535*0x64)/0x64,'totalPayout':Math['round'](_0x41bbd6*0x64)/0x64,'thisMonth':Math[_0x43972c(0x110)](_0x3f849d*0x64)/0x64}};}async['createPayout'](_0x8a16d4){const _0x217082=a38_0x1e9c56,{shopId:_0x4cc4d9,amount:_0x4e4602,network:_0x4a8aab,wallet:_0x33b896,notes:_0x34ea24,txid:_0x4945d5,periodFrom:_0xd0d954,periodTo:_0x1b2219}=_0x8a16d4,_0x37b42f=await database_1[_0x217082(0x141)]['$transaction'](async _0x29b07e=>{const _0x560d2d=_0x217082,_0x41d8fe=await _0x29b07e[_0x560d2d(0x107)][_0x560d2d(0x1a4)]({'where':{'id':_0x4cc4d9},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x41d8fe)throw new Error(_0x560d2d(0xb2));console[_0x560d2d(0x1c8)](_0x560d2d(0x187)+_0x41d8fe[_0x560d2d(0x129)]+':'),console[_0x560d2d(0x1c8)](_0x560d2d(0x1cd)+_0x41d8fe[_0x560d2d(0x1d0)][_0x560d2d(0xe6)](0x6)+_0x560d2d(0x1f1)),console['log'](_0x560d2d(0x1bd)+_0x4e4602[_0x560d2d(0xe6)](0x6)+_0x560d2d(0x1f1)),console[_0x560d2d(0x1c8)](_0x560d2d(0x133)+_0x41d8fe[_0x560d2d(0xd0)]['toFixed'](0x6)+_0x560d2d(0x1f1));if(_0x4945d5)console[_0x560d2d(0x1c8)](_0x560d2d(0x1ea)+_0x4945d5);if(_0x41d8fe[_0x560d2d(0x1d0)]<_0x4e4602)throw new Error(_0x560d2d(0x164)+_0x41d8fe['balance'][_0x560d2d(0xe6)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x4e4602[_0x560d2d(0xe6)](0x6)+_0x560d2d(0x1f1));let _0x85f5a9=_0x33b896;if(!_0x85f5a9){const _0x1f2d0d=await _0x29b07e[_0x560d2d(0x107)][_0x560d2d(0x1a4)]({'where':{'id':_0x4cc4d9},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x1f2d0d)switch(_0x4a8aab){case _0x560d2d(0xe4):_0x85f5a9=_0x1f2d0d[_0x560d2d(0x145)]||undefined;break;case _0x560d2d(0x1c7):_0x85f5a9=_0x1f2d0d['usdtTrcWallet']||undefined;break;case _0x560d2d(0x10f):_0x85f5a9=_0x1f2d0d[_0x560d2d(0x1df)]||undefined;break;case'polygon_usdc':_0x85f5a9=_0x1f2d0d[_0x560d2d(0x168)]||undefined;break;case _0x560d2d(0x154):_0x85f5a9=_0x1f2d0d[_0x560d2d(0x12c)]||undefined;break;}}console[_0x560d2d(0x1c8)]('💳\x20Payout\x20wallet\x20for\x20'+_0x4a8aab+':\x20'+(_0x85f5a9||_0x560d2d(0x14f)));const _0xc316a8=await _0x29b07e[_0x560d2d(0xbe)][_0x560d2d(0xd6)]({'data':{'shopId':_0x4cc4d9,'amount':_0x4e4602,'network':_0x4a8aab,'status':_0x560d2d(0x12e),'txid':_0x4945d5,'notes':_0x34ea24,'periodFrom':_0xd0d954?new Date(_0xd0d954):null,'periodTo':_0x1b2219?new Date(_0x1b2219):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x1e436e=_0x41d8fe['balance']-_0x4e4602,_0x384435=_0x41d8fe[_0x560d2d(0xd0)]+_0x4e4602;return await _0x29b07e[_0x560d2d(0x107)][_0x560d2d(0xfc)]({'where':{'id':_0x4cc4d9},'data':{'balance':_0x1e436e,'totalPaidOut':_0x384435}}),console[_0x560d2d(0x1c8)](_0x560d2d(0x11a)+_0x41d8fe[_0x560d2d(0x129)]+_0x560d2d(0xfe)),console[_0x560d2d(0x1c8)](_0x560d2d(0x17a)+_0x41d8fe[_0x560d2d(0x1d0)][_0x560d2d(0xe6)](0x6)+'\x20->\x20'+_0x1e436e[_0x560d2d(0xe6)](0x6)+_0x560d2d(0x1c3)+_0x4e4602['toFixed'](0x6)+')'),console[_0x560d2d(0x1c8)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x41d8fe[_0x560d2d(0xd0)][_0x560d2d(0xe6)](0x6)+'\x20->\x20'+_0x384435[_0x560d2d(0xe6)](0x6)+_0x560d2d(0xbf)+_0x4e4602[_0x560d2d(0xe6)](0x6)+')'),{'payout':_0xc316a8,'shop':_0x41d8fe};});return console[_0x217082(0x1c8)](_0x217082(0x15b)+_0x37b42f[_0x217082(0xbe)]['id']+_0x217082(0x18f)+_0x37b42f[_0x217082(0x107)][_0x217082(0x129)]+'\x20('+_0x4e4602+'\x20USDT)'),{'id':_0x37b42f['payout']['id'],'shopId':_0x37b42f[_0x217082(0xbe)]['shopId'],'shopName':_0x37b42f[_0x217082(0x107)][_0x217082(0x199)],'shopUsername':_0x37b42f[_0x217082(0x107)]['username'],'amount':_0x37b42f[_0x217082(0xbe)]['amount'],'network':_0x37b42f[_0x217082(0xbe)][_0x217082(0x1a7)],'status':_0x37b42f[_0x217082(0xbe)][_0x217082(0xe9)],'txid':_0x37b42f[_0x217082(0xbe)][_0x217082(0x188)],'notes':_0x37b42f[_0x217082(0xbe)][_0x217082(0x14e)],'periodFrom':_0x37b42f['payout'][_0x217082(0x11b)],'periodTo':_0x37b42f[_0x217082(0xbe)][_0x217082(0xf9)],'createdAt':_0x37b42f[_0x217082(0xbe)][_0x217082(0xb4)],'paidAt':_0x37b42f[_0x217082(0xbe)]['paidAt']};}async[a38_0x1e9c56(0x15f)](_0x337875){const _0x2d2e8c=a38_0x1e9c56,{page:_0x1a0cbf,limit:_0x46658f,shopId:_0xd9447a,network:_0x22bb95,dateFrom:_0x32066a,dateTo:_0x272475,search:_0x3d0904}=_0x337875,_0x2d6afa=(_0x1a0cbf-0x1)*_0x46658f,_0x13bea0={};_0xd9447a&&(_0x13bea0[_0x2d2e8c(0x15e)]=_0xd9447a);_0x22bb95&&(_0x13bea0[_0x2d2e8c(0x1a7)]=_0x22bb95);(_0x32066a||_0x272475)&&(_0x13bea0['createdAt']={},_0x32066a&&(_0x13bea0['createdAt'][_0x2d2e8c(0x103)]=new Date(_0x32066a)),_0x272475&&(_0x13bea0[_0x2d2e8c(0xb4)]['lte']=new Date(_0x272475)));_0x3d0904&&(_0x13bea0['OR']=[{'shop':{'name':{'contains':_0x3d0904,'mode':_0x2d2e8c(0x18c)}}},{'shop':{'username':{'contains':_0x3d0904,'mode':_0x2d2e8c(0x18c)}}},{'notes':{'contains':_0x3d0904,'mode':_0x2d2e8c(0x18c)}}]);const [_0x465ea1,_0x5b88c2]=await Promise[_0x2d2e8c(0x1e4)]([database_1[_0x2d2e8c(0x141)][_0x2d2e8c(0xbe)]['findMany']({'where':_0x13bea0,'skip':_0x2d6afa,'take':_0x46658f,'orderBy':{'createdAt':_0x2d2e8c(0x1c2)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2d2e8c(0x141)][_0x2d2e8c(0xbe)][_0x2d2e8c(0x1b3)]({'where':_0x13bea0})]);return{'payouts':_0x465ea1[_0x2d2e8c(0x144)](_0x551c78=>({'id':_0x551c78['id'],'shopId':_0x551c78['shopId'],'shopName':_0x551c78[_0x2d2e8c(0x107)][_0x2d2e8c(0x199)],'shopUsername':_0x551c78[_0x2d2e8c(0x107)][_0x2d2e8c(0x129)],'amount':_0x551c78[_0x2d2e8c(0x1bb)],'network':_0x551c78[_0x2d2e8c(0x1a7)],'status':_0x551c78['status'],'txid':_0x551c78[_0x2d2e8c(0x188)],'notes':_0x551c78[_0x2d2e8c(0x14e)],'periodFrom':_0x551c78['periodFrom'],'periodTo':_0x551c78[_0x2d2e8c(0xf9)],'createdAt':_0x551c78[_0x2d2e8c(0xb4)],'paidAt':_0x551c78['paidAt']})),'pagination':{'page':_0x1a0cbf,'limit':_0x46658f,'total':_0x5b88c2,'totalPages':Math[_0x2d2e8c(0x104)](_0x5b88c2/_0x46658f)}};}async['getPayoutById'](_0x4a909b){const _0x2deaf5=a38_0x1e9c56,_0x295761=await database_1[_0x2deaf5(0x141)]['payout'][_0x2deaf5(0x1a4)]({'where':{'id':_0x4a909b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x295761)return null;return{'id':_0x295761['id'],'shopId':_0x295761['shopId'],'shopName':_0x295761[_0x2deaf5(0x107)][_0x2deaf5(0x199)],'shopUsername':_0x295761[_0x2deaf5(0x107)][_0x2deaf5(0x129)],'amount':_0x295761[_0x2deaf5(0x1bb)],'network':_0x295761[_0x2deaf5(0x1a7)],'status':_0x295761[_0x2deaf5(0xe9)],'txid':_0x295761['txid'],'notes':_0x295761[_0x2deaf5(0x14e)],'periodFrom':_0x295761['periodFrom'],'periodTo':_0x295761[_0x2deaf5(0xf9)],'createdAt':_0x295761[_0x2deaf5(0xb4)],'paidAt':_0x295761[_0x2deaf5(0x122)]};}async[a38_0x1e9c56(0xca)](_0x1d2fa1){const _0x3d144f=a38_0x1e9c56;await database_1['default'][_0x3d144f(0xbe)]['delete']({'where':{'id':_0x1d2fa1}});}async['getAllPayments'](_0x138f8c){const _0x1e12d9=a38_0x1e9c56,{page:_0x3df759,limit:_0x37a559,status:_0x53c4f6,gateway:_0xc19b2d,shopId:_0x35093c,dateFrom:_0x43c1fb,dateTo:_0x25012f,search:_0x10dcbf,currency:_0x2f5755,sortBy:_0xbcc98,sortOrder:_0xf745ce}=_0x138f8c,_0x37a4eb=(_0x3df759-0x1)*_0x37a559;console[_0x1e12d9(0x1c8)](_0x1e12d9(0x119),_0x138f8c);const _0x108f4d=await database_1[_0x1e12d9(0x141)]['payment']['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x1e12d9(0x1c8)](_0x1e12d9(0x1f3),_0x108f4d[_0x1e12d9(0x144)](_0x1f3f91=>_0x1f3f91[_0x1e12d9(0xf2)]+'\x20('+_0x1f3f91['_count'][_0x1e12d9(0xf2)]+_0x1e12d9(0x10a)));if(_0xc19b2d){const _0x48179e=_0x108f4d['some'](_0x2c19be=>_0x2c19be[_0x1e12d9(0xf2)][_0x1e12d9(0x178)]()===_0xc19b2d[_0x1e12d9(0x178)]());!_0x48179e&&_0xc19b2d[_0x1e12d9(0x178)]()!==_0x1e12d9(0x1f7)&&console[_0x1e12d9(0x1c8)](_0x1e12d9(0x143)+_0xc19b2d+_0x1e12d9(0x174)+_0x108f4d[_0x1e12d9(0x144)](_0x34975f=>_0x34975f[_0x1e12d9(0xf2)])[_0x1e12d9(0x124)](',\x20'));}const _0x579c8b={};_0x53c4f6&&(_0x579c8b[_0x1e12d9(0xe9)]=_0x53c4f6['toUpperCase']());if(!_0xc19b2d)_0x579c8b[_0x1e12d9(0xf2)]={'not':_0x1e12d9(0x1f7)};else{if(_0xc19b2d&&(_0xc19b2d[_0x1e12d9(0x178)]()===_0x1e12d9(0x1f7)||_0xc19b2d===_0x1e12d9(0x1d4)))_0x579c8b['gateway']='test_gateway';else{let _0x4e7711=_0xc19b2d;const _0x26683d=(0x0,gateway_1['getGatewayNameById'])(_0xc19b2d);if(_0x26683d)_0x4e7711=_0x26683d,console[_0x1e12d9(0x1c8)](_0x1e12d9(0x1a5)+_0xc19b2d+_0x1e12d9(0xfd)+_0x4e7711+'\x27');else{const _0x4b7e85=(0x0,gateway_1[_0x1e12d9(0x14c)])(_0xc19b2d);if(_0x4b7e85){const _0x29bf91=(0x0,gateway_1[_0x1e12d9(0xcb)])(_0x4b7e85);_0x29bf91&&(_0x4e7711=_0x29bf91,console[_0x1e12d9(0x1c8)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0xc19b2d+_0x1e12d9(0xe2)+_0x4b7e85+'\x27\x20->\x20name\x20\x27'+_0x4e7711+'\x27'));}else console[_0x1e12d9(0x1c8)](_0x1e12d9(0xcc)+_0xc19b2d+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x16bf2f=await database_1[_0x1e12d9(0x141)][_0x1e12d9(0x115)][_0x1e12d9(0x1b3)]({'where':{'gateway':_0x4e7711[_0x1e12d9(0x178)]()},'take':0x1});_0x16bf2f===0x0?(console[_0x1e12d9(0x1c8)]('⚠️\x20Gateway\x20\x27'+_0x4e7711+_0x1e12d9(0x1f4)+_0xc19b2d+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x579c8b[_0x1e12d9(0xf2)]='NONEXISTENT_GATEWAY_FILTER'):(_0x579c8b[_0x1e12d9(0xf2)]=_0x4e7711[_0x1e12d9(0x178)](),console[_0x1e12d9(0x1c8)](_0x1e12d9(0x19d)+_0x4e7711+'\x27\x20(from\x20\x27'+_0xc19b2d+'\x27)'));}}console[_0x1e12d9(0x1c8)](_0x1e12d9(0x16e),_0x579c8b[_0x1e12d9(0xf2)]);_0x35093c&&(_0x579c8b[_0x1e12d9(0x15e)]=_0x35093c);_0x2f5755&&(_0x579c8b[_0x1e12d9(0x1cb)]=_0x2f5755['toUpperCase'](),console[_0x1e12d9(0x1c8)](_0x1e12d9(0x16f)+_0x2f5755[_0x1e12d9(0xdd)]()));(_0x43c1fb||_0x25012f)&&(_0x579c8b[_0x1e12d9(0xb4)]={},_0x43c1fb&&(_0x579c8b['createdAt']['gte']=new Date(_0x43c1fb)),_0x25012f&&(_0x579c8b['createdAt'][_0x1e12d9(0x12b)]=new Date(_0x25012f)));_0x10dcbf&&(_0x579c8b['OR']=[{'id':{'contains':_0x10dcbf,'mode':'insensitive'}},{'orderId':{'contains':_0x10dcbf,'mode':_0x1e12d9(0x18c)}},{'gatewayOrderId':{'contains':_0x10dcbf,'mode':_0x1e12d9(0x18c)}},{'customerEmail':{'contains':_0x10dcbf,'mode':_0x1e12d9(0x18c)}},{'shop':{'name':{'contains':_0x10dcbf,'mode':_0x1e12d9(0x18c)}}},{'shop':{'username':{'contains':_0x10dcbf,'mode':'insensitive'}}}]);console[_0x1e12d9(0x1c8)](_0x1e12d9(0xde),JSON['stringify'](_0x579c8b,null,0x2));let _0x247c8e={'createdAt':_0x1e12d9(0x1c2)};if(_0xbcc98){const _0x4eb25b=[_0x1e12d9(0x1bb),'createdAt','updatedAt',_0x1e12d9(0xe9),'gateway',_0x1e12d9(0x1cb)],_0x330557=[_0x1e12d9(0xce),_0x1e12d9(0x1c2)];if(_0x4eb25b[_0x1e12d9(0x13c)](_0xbcc98)){const _0xcf2528=_0x330557[_0x1e12d9(0x13c)](_0xf745ce)?_0xf745ce:_0x1e12d9(0x1c2);_0x247c8e={[_0xbcc98]:_0xcf2528},console[_0x1e12d9(0x1c8)](_0x1e12d9(0xef)+_0xbcc98+_0x1e12d9(0x17d)+_0xcf2528+_0x1e12d9(0x1d9));}}const [_0x2f99e9,_0xd677ad]=await Promise['all']([database_1['default'][_0x1e12d9(0x115)][_0x1e12d9(0x14b)]({'where':_0x579c8b,'skip':_0x37a4eb,'take':_0x37a559,'orderBy':_0x247c8e,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1e12d9(0x141)][_0x1e12d9(0x115)][_0x1e12d9(0x1b3)]({'where':_0x579c8b})]);return{'payments':_0x2f99e9,'pagination':{'page':_0x3df759,'limit':_0x37a559,'total':_0xd677ad,'totalPages':Math[_0x1e12d9(0x104)](_0xd677ad/_0x37a559)}};}async['getPaymentById'](_0x302934){const _0x2e6f21=a38_0x1e9c56,_0x5f0a3a=await database_1[_0x2e6f21(0x141)][_0x2e6f21(0x115)][_0x2e6f21(0x1a4)]({'where':{'id':_0x302934},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5f0a3a)return null;return{'id':_0x5f0a3a['id'],'shopId':_0x5f0a3a[_0x2e6f21(0x15e)],'gateway':_0x5f0a3a[_0x2e6f21(0xf2)],'amount':_0x5f0a3a[_0x2e6f21(0x1bb)],'currency':_0x5f0a3a[_0x2e6f21(0x1cb)],'status':_0x5f0a3a['status'],'orderId':_0x5f0a3a[_0x2e6f21(0xdb)],'gatewayOrderId':_0x5f0a3a[_0x2e6f21(0xd9)],'customerEmail':_0x5f0a3a['customerEmail'],'customerName':_0x5f0a3a[_0x2e6f21(0x1c5)],'customerCountry':_0x5f0a3a[_0x2e6f21(0x1da)],'customerIp':_0x5f0a3a['customerIp'],'customerUa':_0x5f0a3a[_0x2e6f21(0x190)],'failureMessage':_0x5f0a3a['failureMessage'],'externalPaymentUrl':_0x5f0a3a[_0x2e6f21(0xc1)],'successUrl':_0x5f0a3a[_0x2e6f21(0x184)],'failUrl':_0x5f0a3a[_0x2e6f21(0x183)],'pendingUrl':_0x5f0a3a[_0x2e6f21(0xcd)],'whiteUrl':_0x5f0a3a[_0x2e6f21(0x13e)],'createdAt':_0x5f0a3a[_0x2e6f21(0xb4)],'updatedAt':_0x5f0a3a[_0x2e6f21(0x121)],'shop':_0x5f0a3a[_0x2e6f21(0x107)]};}async['updatePaymentStatus'](_0x3836ce,_0x21ba2a,_0x1587b5,_0x2fc826){const _0x519151=a38_0x1e9c56,_0x3faeec=await database_1[_0x519151(0x141)]['$transaction'](async _0x1b380e=>{const _0x22dfaf=_0x519151,_0x5c1a85=await _0x1b380e[_0x22dfaf(0x115)][_0x22dfaf(0x1a4)]({'where':{'id':_0x3836ce},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5c1a85)throw new Error('Payment\x20not\x20found');const _0x3da34d=_0x5c1a85['status'],_0x297b8d=_0x21ba2a[_0x22dfaf(0xdd)]();console[_0x22dfaf(0x1c8)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x3836ce+_0x22dfaf(0x102)+_0x3da34d+'\x20->\x20'+_0x297b8d),console[_0x22dfaf(0x1c8)](_0x22dfaf(0x172)+_0x5c1a85[_0x22dfaf(0x107)][_0x22dfaf(0x1d0)]+_0x22dfaf(0x1f1));const _0x55fce1={'status':_0x297b8d,'updatedAt':new Date(),'statusChangedBy':_0x22dfaf(0xf4),'statusChangedAt':new Date()};_0x1587b5&&(_0x55fce1[_0x22dfaf(0x123)]=_0x1587b5);_0x297b8d===_0x22dfaf(0x17c)&&_0x2fc826&&(_0x55fce1['chargebackAmount']=_0x2fc826);let _0x316db0=0x0,_0x277885=_0x5c1a85['shop'][_0x22dfaf(0x1d0)];if(_0x297b8d===_0x22dfaf(0x13f)&&_0x3da34d!==_0x22dfaf(0x13f)){_0x55fce1['paidAt']=new Date();const _0x1b9bc4=await currencyService_1[_0x22dfaf(0x13a)][_0x22dfaf(0xb7)](_0x5c1a85[_0x22dfaf(0x1bb)],_0x5c1a85['currency']);_0x55fce1[_0x22dfaf(0x1db)]=_0x1b9bc4;let _0x26f8b4=0x2d;const _0x37744a=await _0x1b380e['shop'][_0x22dfaf(0x1a4)]({'where':{'id':_0x5c1a85[_0x22dfaf(0x15e)]},'select':{'gatewaySettings':!![]}});if(_0x37744a?.['gatewaySettings'])try{const _0x20fe9e=JSON[_0x22dfaf(0x15d)](_0x37744a[_0x22dfaf(0x1de)]);for(const [_0x2eec5b,_0x336e5e]of Object[_0x22dfaf(0x189)](_0x20fe9e)){if(_0x2eec5b[_0x22dfaf(0x178)]()===_0x5c1a85[_0x22dfaf(0xf2)][_0x22dfaf(0x178)]()){_0x26f8b4=_0x336e5e[_0x22dfaf(0x1ed)]||0xa;break;}}}catch(_0x31e13d){console[_0x22dfaf(0x101)](_0x22dfaf(0x134)+_0x3836ce+':',_0x31e13d);}let _0x2e429f;_0x5c1a85[_0x22dfaf(0x19c)]!==null&&_0x5c1a85[_0x22dfaf(0x19c)]!==undefined?(_0x2e429f=_0x5c1a85[_0x22dfaf(0x19c)],console['log'](_0x22dfaf(0x1c1)+_0x2e429f[_0x22dfaf(0xe6)](0x6)+_0x22dfaf(0x167)+_0x3836ce)):(_0x2e429f=_0x1b9bc4*(0x1-_0x26f8b4/0x64),console['log'](_0x22dfaf(0x10d)+_0x3836ce+':\x20'+_0x26f8b4+'%\x20from\x20'+_0x1b9bc4[_0x22dfaf(0xe6)](0x6)+_0x22dfaf(0x1f1)),_0x55fce1[_0x22dfaf(0x19c)]=_0x2e429f,_0x55fce1['gatewayCommissionRate']=_0x26f8b4),_0x316db0=_0x2e429f,_0x277885+=_0x2e429f,console[_0x22dfaf(0x1c8)](_0x22dfaf(0xc8)+_0x3836ce+_0x22dfaf(0x1d8)),console[_0x22dfaf(0x1c8)]('\x20\x20\x20Full\x20amount:\x20'+_0x1b9bc4[_0x22dfaf(0xe6)](0x6)+_0x22dfaf(0x1f1)),console[_0x22dfaf(0x1c8)](_0x22dfaf(0x1dc)+_0x5c1a85['gateway']+_0x22dfaf(0x12d)+_0x26f8b4+'%'),console[_0x22dfaf(0x1c8)](_0x22dfaf(0x1bc)+_0x2e429f['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0x26f8b4+'%\x20commission)'),console[_0x22dfaf(0x1c8)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x2e429f['toFixed'](0x6)+_0x22dfaf(0x1f1));}else{if(_0x3da34d==='PAID'&&_0x297b8d!=='PAID'){if(_0x5c1a85['amountUSDT']){let _0x411cc2=0x2d;const _0x19b5d8=await _0x1b380e[_0x22dfaf(0x107)][_0x22dfaf(0x1a4)]({'where':{'id':_0x5c1a85['shopId']},'select':{'gatewaySettings':!![]}});if(_0x19b5d8?.[_0x22dfaf(0x1de)])try{const _0x4808f6=JSON['parse'](_0x19b5d8[_0x22dfaf(0x1de)]);for(const [_0x31e184,_0xf087d9]of Object[_0x22dfaf(0x189)](_0x4808f6)){if(_0x31e184[_0x22dfaf(0x178)]()===_0x5c1a85[_0x22dfaf(0xf2)][_0x22dfaf(0x178)]()){_0x411cc2=_0xf087d9[_0x22dfaf(0x1ed)]||0xa;break;}}}catch(_0x4060ce){console[_0x22dfaf(0x101)](_0x22dfaf(0x134)+_0x3836ce+':',_0x4060ce);}const _0x1dfa37=_0x5c1a85['amountUSDT']*(0x1-_0x411cc2/0x64);_0x316db0=-_0x1dfa37,_0x277885-=_0x1dfa37,_0x55fce1[_0x22dfaf(0x1db)]=null,_0x55fce1[_0x22dfaf(0x19c)]=null,console[_0x22dfaf(0x1c8)]('💰\x20Payment\x20'+_0x3836ce+_0x22dfaf(0xd2)),console['log'](_0x22dfaf(0x106)+_0x5c1a85[_0x22dfaf(0x1db)][_0x22dfaf(0xe6)](0x6)+_0x22dfaf(0x1f1)),console['log'](_0x22dfaf(0x1dc)+_0x5c1a85[_0x22dfaf(0xf2)]+_0x22dfaf(0x12d)+_0x411cc2+'%'),console[_0x22dfaf(0x1c8)](_0x22dfaf(0xda)+_0x1dfa37[_0x22dfaf(0xe6)](0x6)+'\x20USDT\x20(after\x20'+_0x411cc2+'%\x20commission)'),console[_0x22dfaf(0x1c8)](_0x22dfaf(0x171)+_0x1dfa37[_0x22dfaf(0xe6)](0x6)+_0x22dfaf(0x1f1));}}}_0x297b8d===_0x22dfaf(0x17c)&&(_0x3da34d==='PAID'&&_0x5c1a85[_0x22dfaf(0x1db)]&&console['log'](_0x22dfaf(0x156)),_0x2fc826&&_0x2fc826>0x0&&(_0x316db0-=_0x2fc826,_0x277885-=_0x2fc826,console[_0x22dfaf(0x1c8)](_0x22dfaf(0x135)+_0x2fc826[_0x22dfaf(0xe6)](0x6)+'\x20USDT\x20from\x20balance')));_0x297b8d===_0x22dfaf(0x170)&&_0x3da34d===_0x22dfaf(0x13f)&&console[_0x22dfaf(0x1c8)](_0x22dfaf(0x1ae));const _0x255344=await _0x1b380e[_0x22dfaf(0x115)][_0x22dfaf(0xfc)]({'where':{'id':_0x3836ce},'data':_0x55fce1,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x316db0!==0x0&&(await _0x1b380e[_0x22dfaf(0x107)]['update']({'where':{'id':_0x5c1a85[_0x22dfaf(0x15e)]},'data':{'balance':_0x277885}}),console[_0x22dfaf(0x1c8)]('💰\x20Shop\x20'+_0x5c1a85[_0x22dfaf(0x15e)]+_0x22dfaf(0x16c)+_0x5c1a85[_0x22dfaf(0x107)][_0x22dfaf(0x1d0)]['toFixed'](0x6)+_0x22dfaf(0x155)+_0x277885[_0x22dfaf(0xe6)](0x6)+_0x22dfaf(0x1b5)+(_0x316db0>0x0?'+':'')+_0x316db0[_0x22dfaf(0xe6)](0x6)+')')),_0x255344;});return{'id':_0x3faeec['id'],'shopId':_0x3faeec['shopId'],'gateway':_0x3faeec[_0x519151(0xf2)],'amount':_0x3faeec['amount'],'currency':_0x3faeec[_0x519151(0x1cb)],'status':_0x3faeec[_0x519151(0xe9)],'orderId':_0x3faeec[_0x519151(0xdb)],'gatewayOrderId':_0x3faeec[_0x519151(0xd9)],'customerEmail':_0x3faeec[_0x519151(0x11c)],'customerName':_0x3faeec[_0x519151(0x1c5)],'customerCountry':_0x3faeec['customerCountry'],'customerIp':_0x3faeec[_0x519151(0xe7)],'customerUa':_0x3faeec[_0x519151(0x190)],'failureMessage':_0x3faeec[_0x519151(0x1a3)],'adminNotes':_0x3faeec[_0x519151(0x123)],'chargebackAmount':_0x3faeec[_0x519151(0x191)],'statusChangedBy':_0x3faeec[_0x519151(0x142)],'statusChangedAt':_0x3faeec[_0x519151(0x173)],'createdAt':_0x3faeec[_0x519151(0xb4)],'updatedAt':_0x3faeec[_0x519151(0x121)],'shop':_0x3faeec[_0x519151(0x107)]};}async[a38_0x1e9c56(0x1f5)](_0x41079d,_0x211851){const _0x4e3da6=a38_0x1e9c56,_0x541ab4=Math[_0x4e3da6(0x118)]()[_0x4e3da6(0x1d6)](0x24)[_0x4e3da6(0xee)](0x2,0x9);console[_0x4e3da6(0x1c8)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x541ab4+',\x20userId:\x20'+_0x41079d);const _0x34702a={..._0x211851};_0x211851['password']&&_0x211851[_0x4e3da6(0xe0)][_0x4e3da6(0x1af)]()!==''?(console[_0x4e3da6(0x1c8)](_0x4e3da6(0x1aa)+_0x541ab4+_0x4e3da6(0xc4)+_0x41079d),_0x34702a[_0x4e3da6(0xe0)]=await bcryptjs_1['default'][_0x4e3da6(0x192)](_0x211851[_0x4e3da6(0xe0)],0xc)):(console[_0x4e3da6(0x1c8)](_0x4e3da6(0x1aa)+_0x541ab4+_0x4e3da6(0x195)),delete _0x34702a[_0x4e3da6(0xe0)]);_0x211851[_0x4e3da6(0x1e6)]&&(_0x34702a['name']=_0x211851[_0x4e3da6(0x1e6)],delete _0x34702a[_0x4e3da6(0x1e6)]);_0x211851[_0x4e3da6(0xc5)]&&(_0x34702a[_0x4e3da6(0x1e7)]=_0x211851[_0x4e3da6(0xc5)],delete _0x34702a[_0x4e3da6(0xc5)]);_0x211851['merchantUrl']&&(_0x34702a[_0x4e3da6(0x19b)]=_0x211851[_0x4e3da6(0x169)],delete _0x34702a[_0x4e3da6(0x169)]);if(_0x211851['gateways']){const _0x5a79a0=_0x211851[_0x4e3da6(0xe3)][_0x4e3da6(0x144)](_0x4cbbba=>this[_0x4e3da6(0x1f6)](_0x4cbbba));console[_0x4e3da6(0x1c8)]('🔄\x20Gateway\x20mapping:',_0x211851['gateways'],'->',_0x5a79a0),_0x34702a['paymentGateways']=JSON[_0x4e3da6(0x149)](_0x5a79a0),delete _0x34702a[_0x4e3da6(0xe3)];}_0x211851[_0x4e3da6(0x1de)]&&(console['log'](_0x4e3da6(0xc0)+_0x541ab4+']\x20Gateway\x20settings\x20before\x20saving:',_0x211851[_0x4e3da6(0x1de)]),_0x34702a[_0x4e3da6(0x1de)]=JSON[_0x4e3da6(0x149)](_0x211851[_0x4e3da6(0x1de)]),console[_0x4e3da6(0x1c8)](_0x4e3da6(0xc0)+_0x541ab4+_0x4e3da6(0xd1),_0x34702a['gatewaySettings']));_0x211851['wallets']&&(_0x211851[_0x4e3da6(0x131)][_0x4e3da6(0x145)]!==undefined&&(_0x34702a['usdtPolygonWallet']=_0x211851[_0x4e3da6(0x131)][_0x4e3da6(0x145)]||null),_0x211851[_0x4e3da6(0x131)]['usdtTrcWallet']!==undefined&&(_0x34702a[_0x4e3da6(0x120)]=_0x211851[_0x4e3da6(0x131)][_0x4e3da6(0x120)]||null),_0x211851['wallets'][_0x4e3da6(0x1df)]!==undefined&&(_0x34702a[_0x4e3da6(0x1df)]=_0x211851[_0x4e3da6(0x131)][_0x4e3da6(0x1df)]||null),_0x211851[_0x4e3da6(0x131)][_0x4e3da6(0x168)]!==undefined&&(_0x34702a['usdcPolygonWallet']=_0x211851[_0x4e3da6(0x131)]['usdcPolygonWallet']||null),delete _0x34702a[_0x4e3da6(0x131)]);const _0x42cc2f=await database_1[_0x4e3da6(0x141)][_0x4e3da6(0x107)][_0x4e3da6(0xfc)]({'where':{'id':_0x41079d},'data':_0x34702a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4e3da6(0x1c8)](_0x4e3da6(0x1bf)+_0x541ab4+_0x4e3da6(0x193),_0x42cc2f[_0x4e3da6(0x1de)]),{'id':_0x42cc2f['id'],'fullName':_0x42cc2f[_0x4e3da6(0x199)],'username':_0x42cc2f[_0x4e3da6(0x129)],'telegramId':_0x42cc2f[_0x4e3da6(0x1e7)],'merchantUrl':_0x42cc2f[_0x4e3da6(0x19b)],'gateways':_0x42cc2f[_0x4e3da6(0xc6)]?JSON['parse'](_0x42cc2f['paymentGateways']):null,'gatewaySettings':_0x42cc2f[_0x4e3da6(0x1de)]?JSON[_0x4e3da6(0x15d)](_0x42cc2f[_0x4e3da6(0x1de)]):null,'publicKey':_0x42cc2f[_0x4e3da6(0xd8)],'wallets':{'usdtPolygonWallet':_0x42cc2f[_0x4e3da6(0x145)],'usdtTrcWallet':_0x42cc2f[_0x4e3da6(0x120)],'usdtErcWallet':_0x42cc2f['usdtErcWallet'],'usdcPolygonWallet':_0x42cc2f[_0x4e3da6(0x168)]},'status':_0x42cc2f[_0x4e3da6(0xe9)],'createdAt':_0x42cc2f[_0x4e3da6(0xb4)]};}async['suspendUser'](_0x19f6a6){const _0x37863b=a38_0x1e9c56,_0x2d8abf=await database_1['default']['shop']['update']({'where':{'id':_0x19f6a6},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2d8abf['id'],'fullName':_0x2d8abf['name'],'username':_0x2d8abf[_0x37863b(0x129)],'telegramId':_0x2d8abf[_0x37863b(0x1e7)],'merchantUrl':_0x2d8abf[_0x37863b(0x19b)],'gateways':_0x2d8abf['paymentGateways']?JSON['parse'](_0x2d8abf[_0x37863b(0xc6)]):null,'gatewaySettings':_0x2d8abf[_0x37863b(0x1de)]?JSON[_0x37863b(0x15d)](_0x2d8abf[_0x37863b(0x1de)]):null,'publicKey':_0x2d8abf[_0x37863b(0xd8)],'wallets':{'usdtPolygonWallet':_0x2d8abf[_0x37863b(0x145)],'usdtTrcWallet':_0x2d8abf['usdtTrcWallet'],'usdtErcWallet':_0x2d8abf['usdtErcWallet'],'usdcPolygonWallet':_0x2d8abf[_0x37863b(0x168)]},'status':_0x2d8abf[_0x37863b(0xe9)],'createdAt':_0x2d8abf['createdAt']};}async[a38_0x1e9c56(0xc2)](_0x42c702){const _0x4afe30=a38_0x1e9c56,_0x2c9777=await database_1['default'][_0x4afe30(0x107)][_0x4afe30(0xfc)]({'where':{'id':_0x42c702},'data':{'status':_0x4afe30(0x197)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2c9777['id'],'fullName':_0x2c9777[_0x4afe30(0x199)],'username':_0x2c9777[_0x4afe30(0x129)],'telegramId':_0x2c9777['telegram'],'merchantUrl':_0x2c9777['shopUrl'],'gateways':_0x2c9777['paymentGateways']?JSON[_0x4afe30(0x15d)](_0x2c9777['paymentGateways']):null,'gatewaySettings':_0x2c9777['gatewaySettings']?JSON[_0x4afe30(0x15d)](_0x2c9777['gatewaySettings']):null,'publicKey':_0x2c9777[_0x4afe30(0xd8)],'wallets':{'usdtPolygonWallet':_0x2c9777[_0x4afe30(0x145)],'usdtTrcWallet':_0x2c9777[_0x4afe30(0x120)],'usdtErcWallet':_0x2c9777['usdtErcWallet'],'usdcPolygonWallet':_0x2c9777['usdcPolygonWallet']},'status':_0x2c9777[_0x4afe30(0xe9)],'createdAt':_0x2c9777[_0x4afe30(0xb4)]};}async['getAllUsers'](_0x4e0aef){const _0x28980e=a38_0x1e9c56,{page:_0x4963d0,limit:_0x54fe95,status:_0x2b5f2f}=_0x4e0aef,_0x10b4fb=(_0x4963d0-0x1)*_0x54fe95,_0x4bfac7={};_0x2b5f2f&&(_0x4bfac7[_0x28980e(0xe9)]=_0x2b5f2f[_0x28980e(0xdd)]());const [_0x5af6e7,_0x397588]=await Promise['all']([database_1[_0x28980e(0x141)][_0x28980e(0x107)][_0x28980e(0x14b)]({'where':_0x4bfac7,'skip':_0x10b4fb,'take':_0x54fe95,'orderBy':{'createdAt':_0x28980e(0x1c2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x28980e(0x141)][_0x28980e(0x107)][_0x28980e(0x1b3)]({'where':_0x4bfac7})]);return{'users':_0x5af6e7['map'](_0x104306=>{const _0x104f83=_0x28980e,_0xe6f11f=_0x104306[_0x104f83(0xc6)]?JSON[_0x104f83(0x15d)](_0x104306[_0x104f83(0xc6)]):null,_0x33e250=_0xe6f11f?_0xe6f11f[_0x104f83(0x144)](_0x77fe31=>this[_0x104f83(0xfb)](_0x77fe31)):null;return{'id':_0x104306['id'],'fullName':_0x104306['name'],'username':_0x104306[_0x104f83(0x129)],'telegramId':_0x104306[_0x104f83(0x1e7)],'merchantUrl':_0x104306['shopUrl'],'gateways':_0x33e250,'gatewaySettings':_0x104306['gatewaySettings']?JSON[_0x104f83(0x15d)](_0x104306[_0x104f83(0x1de)]):null,'publicKey':_0x104306['publicKey'],'wallets':{'usdtPolygonWallet':_0x104306[_0x104f83(0x145)],'usdtTrcWallet':_0x104306['usdtTrcWallet'],'usdtErcWallet':_0x104306[_0x104f83(0x1df)],'usdcPolygonWallet':_0x104306[_0x104f83(0x168)]},'status':_0x104306[_0x104f83(0xe9)],'createdAt':_0x104306[_0x104f83(0xb4)]};}),'pagination':{'page':_0x4963d0,'limit':_0x54fe95,'total':_0x397588,'totalPages':Math[_0x28980e(0x104)](_0x397588/_0x54fe95)}};}async[a38_0x1e9c56(0x10b)](_0x2da92b){const _0x39906b=a38_0x1e9c56,_0x3cd28a=await database_1['default'][_0x39906b(0x107)][_0x39906b(0x1a4)]({'where':{'id':_0x2da92b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3cd28a)return null;const _0xc03bb2=_0x3cd28a[_0x39906b(0xc6)]?JSON[_0x39906b(0x15d)](_0x3cd28a['paymentGateways']):null,_0x358cb0=_0xc03bb2?_0xc03bb2[_0x39906b(0x144)](_0x112d78=>this[_0x39906b(0xfb)](_0x112d78)):null;return _0xc03bb2&&_0x358cb0&&console[_0x39906b(0x1c8)](_0x39906b(0xfa),_0xc03bb2,'->',_0x358cb0),{'id':_0x3cd28a['id'],'fullName':_0x3cd28a[_0x39906b(0x199)],'username':_0x3cd28a[_0x39906b(0x129)],'telegramId':_0x3cd28a[_0x39906b(0x1e7)],'merchantUrl':_0x3cd28a['shopUrl'],'gateways':_0x358cb0,'gatewaySettings':_0x3cd28a[_0x39906b(0x1de)]?JSON[_0x39906b(0x15d)](_0x3cd28a[_0x39906b(0x1de)]):null,'publicKey':_0x3cd28a[_0x39906b(0xd8)],'wallets':{'usdtPolygonWallet':_0x3cd28a[_0x39906b(0x145)],'usdtTrcWallet':_0x3cd28a[_0x39906b(0x120)],'usdtErcWallet':_0x3cd28a[_0x39906b(0x1df)],'usdcPolygonWallet':_0x3cd28a[_0x39906b(0x168)]},'status':_0x3cd28a[_0x39906b(0xe9)],'createdAt':_0x3cd28a['createdAt']};}async[a38_0x1e9c56(0x1b9)](_0x169d53){const _0x3aa579=a38_0x1e9c56,{fullName:_0x5af9ef,username:_0x3d97bf,password:_0x41be06,telegramId:_0x32accf,merchantUrl:_0x5458d0,gateways:_0x516d5a,gatewaySettings:_0x22747d,wallets:_0x2562b5}=_0x169d53,_0x29956d=await database_1[_0x3aa579(0x141)][_0x3aa579(0x107)]['findUnique']({'where':{'username':_0x3d97bf}});if(_0x29956d)throw new Error(_0x3aa579(0x148));if(_0x32accf){const _0x4c6dca=await database_1[_0x3aa579(0x141)][_0x3aa579(0x107)][_0x3aa579(0x1a4)]({'where':{'telegram':_0x32accf}});if(_0x4c6dca)throw new Error(_0x3aa579(0xed));}const _0x5e370b=await bcryptjs_1[_0x3aa579(0x141)]['hash'](_0x41be06,0xc),_0x4db3e4='pk_'+crypto_1[_0x3aa579(0x141)][_0x3aa579(0x18b)](0x20)['toString'](_0x3aa579(0x139)),_0x4de757='sk_'+crypto_1[_0x3aa579(0x141)][_0x3aa579(0x18b)](0x20)[_0x3aa579(0x1d6)]('hex'),_0x12069e=_0x516d5a?_0x516d5a[_0x3aa579(0x144)](_0x2f5792=>this[_0x3aa579(0x1f6)](_0x2f5792)):null;_0x516d5a&&_0x12069e&&console[_0x3aa579(0x1c8)](_0x3aa579(0x16a),_0x516d5a,'->',_0x12069e);const _0x4c48a5=await database_1['default'][_0x3aa579(0x107)][_0x3aa579(0xd6)]({'data':{'name':_0x5af9ef,'username':_0x3d97bf,'password':_0x5e370b,'telegram':_0x32accf,'shopUrl':_0x5458d0,'paymentGateways':_0x12069e?JSON[_0x3aa579(0x149)](_0x12069e):null,'gatewaySettings':_0x22747d?JSON['stringify'](_0x22747d):null,'usdtPolygonWallet':_0x2562b5?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x2562b5?.[_0x3aa579(0x120)]||null,'usdtErcWallet':_0x2562b5?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x2562b5?.[_0x3aa579(0x168)]||null,'publicKey':_0x4db3e4,'secretKey':_0x4de757,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4c48a5['id'],'fullName':_0x4c48a5[_0x3aa579(0x199)],'username':_0x4c48a5['username'],'telegramId':_0x4c48a5[_0x3aa579(0x1e7)],'merchantUrl':_0x4c48a5[_0x3aa579(0x19b)],'gateways':_0x4c48a5['paymentGateways']?JSON['parse'](_0x4c48a5[_0x3aa579(0xc6)]):null,'gatewaySettings':_0x4c48a5['gatewaySettings']?JSON[_0x3aa579(0x15d)](_0x4c48a5[_0x3aa579(0x1de)]):null,'publicKey':_0x4c48a5['publicKey'],'wallets':{'usdtPolygonWallet':_0x4c48a5[_0x3aa579(0x145)],'usdtTrcWallet':_0x4c48a5[_0x3aa579(0x120)],'usdtErcWallet':_0x4c48a5[_0x3aa579(0x1df)],'usdcPolygonWallet':_0x4c48a5[_0x3aa579(0x168)]},'status':_0x4c48a5[_0x3aa579(0xe9)],'createdAt':_0x4c48a5[_0x3aa579(0xb4)]};}async[a38_0x1e9c56(0x146)](_0x411e6f){const _0x226214=a38_0x1e9c56;await database_1['default'][_0x226214(0x107)][_0x226214(0x1d7)]({'where':{'id':_0x411e6f}});}[a38_0x1e9c56(0x176)](_0xa74a76,_0xb8b54c,_0x4b55bb){const _0x1bb47f=a38_0x1e9c56,_0x1fede4=new Map(),_0x23674a=new Date(_0xb8b54c);while(_0x23674a<=_0x4b55bb){const _0x5ba83d=_0x23674a[_0x1bb47f(0x15a)]()[_0x1bb47f(0x1b8)]('T')[0x0];_0x1fede4['set'](_0x5ba83d,{'revenue':0x0,'count':0x0}),_0x23674a[_0x1bb47f(0xb8)](_0x23674a[_0x1bb47f(0x1ef)]()+0x1);}for(const _0x2d89db of _0xa74a76){const _0x3963f5=_0x2d89db['createdAt']['toISOString']()['split']('T')[0x0],_0x398047=_0x1fede4[_0x1bb47f(0x112)](_0x3963f5);_0x398047&&(_0x398047[_0x1bb47f(0x1b3)]+=0x1,_0x2d89db[_0x1bb47f(0xe9)]===_0x1bb47f(0x13f)&&(_0x2d89db['amountUSDT']?_0x398047[_0x1bb47f(0xdf)]+=_0x2d89db[_0x1bb47f(0x1db)]:console[_0x1bb47f(0x1c8)](_0x1bb47f(0x18d)+_0x2d89db['id']+_0x1bb47f(0x1e2))));}const _0x5623cb=[],_0x3a7a15=[];for(const [_0x54709e,_0x489600]of _0x1fede4){_0x5623cb['push']({'date':_0x54709e,'amount':Math[_0x1bb47f(0x110)](_0x489600[_0x1bb47f(0xdf)]*0x64)/0x64}),_0x3a7a15[_0x1bb47f(0xf3)]({'date':_0x54709e,'count':_0x489600[_0x1bb47f(0x1b3)]});}return{'dailyRevenue':_0x5623cb,'dailyPayments':_0x3a7a15};}}exports['AdminService']=AdminService;