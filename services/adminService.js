'use strict';const a35_0x55f94f=a35_0x2aa2;function a35_0x2aa2(_0x4c6798,_0x49f678){const _0x108db3=a35_0x108d();return a35_0x2aa2=function(_0x2aa203,_0x12682e){_0x2aa203=_0x2aa203-0xb1;let _0x480589=_0x108db3[_0x2aa203];return _0x480589;},a35_0x2aa2(_0x4c6798,_0x49f678);}(function(_0x132f44,_0x516fb6){const _0x2659a1=a35_0x2aa2,_0x3875d9=_0x132f44();while(!![]){try{const _0x1c6e8b=-parseInt(_0x2659a1(0x11a))/0x1+-parseInt(_0x2659a1(0x19e))/0x2+parseInt(_0x2659a1(0x135))/0x3*(-parseInt(_0x2659a1(0xbb))/0x4)+parseInt(_0x2659a1(0x16f))/0x5*(parseInt(_0x2659a1(0xc4))/0x6)+-parseInt(_0x2659a1(0x15a))/0x7*(parseInt(_0x2659a1(0x153))/0x8)+parseInt(_0x2659a1(0x1b3))/0x9*(-parseInt(_0x2659a1(0x10e))/0xa)+parseInt(_0x2659a1(0x114))/0xb;if(_0x1c6e8b===_0x516fb6)break;else _0x3875d9['push'](_0x3875d9['shift']());}catch(_0x1bc153){_0x3875d9['push'](_0x3875d9['shift']());}}}(a35_0x108d,0xab7a9));function a35_0x108d(){const _0xe61469=['sort','Telegram\x20username\x20already\x20exists','üîÑ\x20Converted\x20gateway\x20name\x20\x27','getAllUsers','activateUser','log','defineProperty','getMerchantsAwaitingPayout','10iCjUey','findFirst','entries','Insufficient\x20balance.\x20Available:\x20','üí∞\x20Creating\x20payout\x20for\x20shop\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','üí∞\x20Current\x20shop\x20balance:\x20','getSystemStatistics','usdcPolygonWallet','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','insensitive','paymentsCount','parse','\x20USDT\x20(same\x20as\x20awaiting)','gateways','shopUrl','%\x20commission)','‚ö†Ô∏è\x20Gateway\x20\x27','totalTurnover','\x20USDT','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','merchantEarningsUSDT','values','./currencyService','join','password','stringify','amount','\x27\x20to\x20name\x20\x27','hex','some','usdtPolygonWallet','paidAt','suspendUser','$transaction','update','revenue',':\x20commission\x20=\x20','KLYME\x20GB','name','gatewayOrderId','length','AdminService','amountUSDT','round','hash','month','491768ilwXSr','gte','commission','\x20USDT\x20(total\x20paid\x20to\x20merchants)','externalPaymentUrl','üìä\x20Sorting\x20payments\x20by\x20','turnover','‚ö†Ô∏è\x20Payment\x20','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','averageCheckUSDT','not\x20specified','\x20\x20\x20Balance:\x20','üìä\x20Getting\x20payments\x20with\x20filters:','telegram','default','getAllPayments','aggregate','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20payments)','_sum','updatedAt','9BVuOeJ','getUserById','dateFrom','toString','averageCommissionRate','toFixed','__esModule','customerCountry','chargebackAmount','usdtTrcWallet','\x20balance\x20updated:\x20','not\x20set',',\x20Commission:\x20','\x20USDT\x20(after\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','turnoverUSDT','2020-01-01','shopId','toISOString','\x20USDT\x20(gross\x20revenue)','currency','createPayout','üí∞\x20Shop\x20','\x27\x20(from\x20\x27','ceil','üìä\x20Calculating\x20payout\x20statistics...','notes','polygon','\x20\x20\x20üìÖ\x20This\x20month:\x20','../types/gateway','\x20\x20\x20Total\x20paid\x20out:\x20','split','error','reduce','getPayoutById','randomBytes','commissionUSDT','\x20paid\x20payments\x20for\x20analysis','\x20balance\x20updated:','0000','gateway','\x20USDT\x20(actual\x20balances)','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','generateDailyStatistics','\x20\x20\x20Full\x20amount:\x20','Rapyd','getMerchantsSelection','46348DqnSWd','üí∞\x20Payment\x20','merchantEarnings','\x20\x20\x20üåç\x20Country:\x20','wallets','toUpperCase','usdtErcWallet','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','getGatewayDisplayName','78072dSJBOM','createdAt','\x20\x20\x20Current\x20balance:\x20','\x20to\x20','orderId','\x27\x20->\x20name\x20\x27','\x20order','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','push','desc','payment','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','year','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','üí∞\x20Found\x20','CoinToPay','getMonth','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','shop','üìä\x20Payout\x20statistics\x20calculated:','dateTo','localeCompare','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','statusChangedBy','date','periodTo','getGatewayIdByName','getAllPayouts','txid','network','\x20no\x20longer\x20PAID:','erc20','publicKey','totalCommissionRate','_count','getTime','\x20->\x20','\x20\x20\x20üìä\x20Total\x20payments:\x20','üìã\x20Found\x20','customerEmail','\x20for\x20shop\x20','username','\x20merchants\x20with\x20positive\x20balance','updateCustomerData','\x20USDT\x20(after\x20payouts)','currencyService','Noda','dailyPayments','merchantUrl','totalAmountUSDT','totalPayments','test_gateway','\x20\x20\x20Transaction\x20hash:\x20','\x20merchants','toLowerCase','getMerchantStatistics','gatewaySettings','üìä\x20Gateway\x20filter\x20applied:','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','PAID','statusChangedAt','30d','status','telegramId','\x20became\x20PAID:','totalPaidOut','üìä\x20Total\x20payments\x20(including\x20failed):\x20','\x20USDT\x20(+','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','createUser','\x20USDT\x20(-','Payment\x20not\x20found','count','1826690Szaift','customerName','successUrl','\x20USDT\x20(with\x20commission\x20deducted)','\x20PAID\x20payments','__importDefault','44279917buPDho','90d','KLYME\x20DE','all','create','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','711745udHmex','set','\x20\x20\x20üìä\x20Commission\x20difference:\x20','totalAmountAfterCommissionUSDT','KLYME\x20EU','awaitingPayout','thisMonth','Username\x20already\x20exists','\x20\x20\x20Payout\x20amount:\x20','paymentGateways','whiteUrl','payout','map','\x20USDT\x20(without\x20commission)','get','REFUND','\x20\x20\x20üí∞\x20Total\x20payout:\x20','getPaymentById','asc','period','üìã\x20Getting\x20merchants\x20selection\x20list...','üìä\x20Available\x20gateways\x20in\x20database:','pendingUrl','delete','ACTIVE','customerUa','customerIp','288QEQceH','\x20\x20\x20üåê\x20IP:\x20','findUnique','\x20active\x20merchants\x20for\x20selection','üìä\x20Final\x20WHERE\x20conditions:','failureMessage','getFullYear','availableBalance','findMany','Plisio','updateUser','getGatewayNameById','gatewayEarnings','getDate','includes','groupBy','polygon_usdc','\x20in\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','trc20','pk_','COMPLETED','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20Merchant\x20loses:\x20','adminNotes','üí∞\x20[PAYOUT]\x20Merchant\x20','failUrl','Error\x20processing\x20payment\x20','totalPayout','Shop\x20not\x20found','8CmkMIr','summary','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','üí≥\x20Payout\x20wallet\x20for\x20','SUSPENDED','lte','\x20USDT\x20(theoretical\x20net)','7675108nlNvZX','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','forEach','convertToUSDT','updatePaymentStatus','periodFrom','balance','\x27\x20->\x20ID\x20\x27','getPayoutStats','\x20status:\x20','\x20\x20\x20Gateway:\x20','fullName','paidOutUSDT'];a35_0x108d=function(){return _0xe61469;};return a35_0x108d();}var __importDefault=this&&this[a35_0x55f94f(0x113)]||function(_0x3f1f0f){return _0x3f1f0f&&_0x3f1f0f['__esModule']?_0x3f1f0f:{'default':_0x3f1f0f};};Object[a35_0x55f94f(0x16d)](exports,a35_0x55f94f(0x1b9),{'value':!![]}),exports[a35_0x55f94f(0x199)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x55f94f(0x186)),gateway_1=require(a35_0x55f94f(0x1d0));class AdminService{async[a35_0x55f94f(0x162)](){const _0x205405=a35_0x55f94f;console[_0x205405(0x16c)](_0x205405(0x1cc));const _0x447e96=await database_1['default'][_0x205405(0xd7)][_0x205405(0x1ae)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x205405(0x132)}}),_0x449a91=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x36b48b=await database_1[_0x205405(0x1ac)][_0x205405(0xce)]['count']({'where':{'status':_0x205405(0x100),'gateway':{'not':_0x205405(0xf8)}}}),_0x384876=new Date(),_0x4c789f=new Date(_0x384876[_0x205405(0x13b)](),_0x384876[_0x205405(0xd4)](),0x1),_0x34560d=new Date(_0x384876['getFullYear'](),_0x384876[_0x205405(0xd4)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5773b8=await database_1[_0x205405(0x1ac)][_0x205405(0x125)][_0x205405(0x1ae)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4c789f,'lte':_0x34560d},'status':_0x205405(0x14a)}}),_0x42049b=_0x447e96[_0x205405(0x1b1)][_0x205405(0x106)]||0x0,_0x3948ce=_0x449a91[_0x205405(0x154)][_0x205405(0x11d)],_0x1b46b8=_0x5773b8[_0x205405(0x1b1)]['amount']||0x0,_0xe1655d={'totalPayout':Math['round'](_0x42049b*0x64)/0x64,'awaitingPayout':Math[_0x205405(0x19b)](_0x3948ce*0x64)/0x64,'thisMonth':Math[_0x205405(0x19b)](_0x1b46b8*0x64)/0x64,'availableBalance':Math['round'](_0x3948ce*0x64)/0x64,'totalPayments':_0x36b48b};return console[_0x205405(0x16c)](_0x205405(0xd8)),console[_0x205405(0x16c)](_0x205405(0x12a)+_0xe1655d[_0x205405(0x151)]+_0x205405(0x1a1)),console['log']('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0xe1655d[_0x205405(0x11f)]+_0x205405(0x111)),console[_0x205405(0x16c)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0xe1655d[_0x205405(0x13c)]+_0x205405(0x17c)),console[_0x205405(0x16c)](_0x205405(0x1cf)+_0xe1655d[_0x205405(0x120)]+_0x205405(0x182)),console[_0x205405(0x16c)]('\x20\x20\x20üí≥\x20Total\x20payments:\x20'+_0xe1655d['totalPayments']+_0x205405(0x112)),console['log'](_0x205405(0xb6)+(_0x447e96[_0x205405(0x1b1)][_0x205405(0x160)]||0x0)[_0x205405(0x1b8)](0x2)+_0x205405(0x127)),console[_0x205405(0x16c)](_0x205405(0x11c)+((_0x447e96['_sum'][_0x205405(0x160)]||0x0)-_0x3948ce)[_0x205405(0x1b8)](0x2)+'\x20USDT'),_0xe1655d;}async[a35_0x55f94f(0xf0)](_0x42a757,_0x16eca9){const _0x5e38e2=a35_0x55f94f;console[_0x5e38e2(0x16c)]('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x42a757+':',_0x16eca9);const _0x4217ff=await database_1[_0x5e38e2(0x1ac)]['payment'][_0x5e38e2(0x137)]({'where':{'id':_0x42a757},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4217ff)throw new Error(_0x5e38e2(0x10c));const _0x4b924b={};_0x16eca9[_0x5e38e2(0x1ba)]!==undefined&&(_0x4b924b[_0x5e38e2(0x1ba)]=_0x16eca9[_0x5e38e2(0x1ba)]||null);_0x16eca9[_0x5e38e2(0x134)]!==undefined&&(_0x4b924b['customerIp']=_0x16eca9[_0x5e38e2(0x134)]||null);_0x16eca9[_0x5e38e2(0x133)]!==undefined&&(_0x4b924b[_0x5e38e2(0x133)]=_0x16eca9['customerUa']||null);const _0x663ae9=await database_1[_0x5e38e2(0x1ac)][_0x5e38e2(0xce)]['update']({'where':{'id':_0x42a757},'data':{..._0x4b924b,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5e38e2(0x16c)](_0x5e38e2(0x14b)+_0x42a757),console[_0x5e38e2(0x16c)](_0x5e38e2(0xbe)+_0x4217ff[_0x5e38e2(0x1ba)]+_0x5e38e2(0xe9)+_0x663ae9[_0x5e38e2(0x1ba)]),console['log'](_0x5e38e2(0x136)+_0x4217ff[_0x5e38e2(0x134)]+_0x5e38e2(0xe9)+_0x663ae9['customerIp']),console['log'](_0x5e38e2(0xd6)+(_0x4217ff[_0x5e38e2(0x133)]?'set':_0x5e38e2(0x1be))+_0x5e38e2(0xe9)+(_0x663ae9[_0x5e38e2(0x133)]?'set':'not\x20set')),_0x663ae9;}async[a35_0x55f94f(0x176)](_0x21c69a){const _0x348b7f=a35_0x55f94f,_0x3f134a=new Date();let _0x4344b4;switch(_0x21c69a){case'7d':_0x4344b4=new Date(_0x3f134a[_0x348b7f(0xe8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x348b7f(0x102):_0x4344b4=new Date(_0x3f134a[_0x348b7f(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x348b7f(0x115):_0x4344b4=new Date(_0x3f134a[_0x348b7f(0xe8)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x348b7f(0x117):const _0x524596=await database_1[_0x348b7f(0x1ac)]['payment']['findFirst']({'where':{'gateway':{'not':_0x348b7f(0xf8)}},'orderBy':{'createdAt':_0x348b7f(0x12c)},'select':{'createdAt':!![]}});_0x4344b4=_0x524596?_0x524596[_0x348b7f(0xc5)]:new Date(_0x348b7f(0x1c3)),console[_0x348b7f(0x16c)](_0x348b7f(0xd5)+_0x4344b4[_0x348b7f(0x1c5)]());break;default:_0x4344b4=new Date(_0x3f134a[_0x348b7f(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x480125,_0x3d72ff,_0x981965,_0x1daffb,_0x2d0c38,_0x14d48b,_0x5dcccd]=await Promise[_0x348b7f(0x117)]([database_1['default'][_0x348b7f(0xd7)][_0x348b7f(0x10d)](),database_1['default'][_0x348b7f(0xd7)][_0x348b7f(0x10d)]({'where':{'status':'ACTIVE'}}),database_1[_0x348b7f(0x1ac)][_0x348b7f(0xce)]['count']({'where':{'createdAt':{'gte':_0x4344b4},'gateway':{'not':_0x348b7f(0xf8)}}}),database_1[_0x348b7f(0x1ac)][_0x348b7f(0xce)]['count']({'where':{'status':_0x348b7f(0x100),'createdAt':{'gte':_0x4344b4},'gateway':{'not':_0x348b7f(0xf8)}}}),database_1[_0x348b7f(0x1ac)]['payment'][_0x348b7f(0x13d)]({'where':{'status':'PAID','createdAt':{'gte':_0x4344b4},'gateway':{'not':_0x348b7f(0xf8)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x348b7f(0x1ac)][_0x348b7f(0xce)][_0x348b7f(0x13d)]({'where':{'gateway':{'not':_0x348b7f(0xf8)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x348b7f(0x1ac)][_0x348b7f(0xce)][_0x348b7f(0x13d)]({'where':{'createdAt':{'gte':_0x4344b4},'gateway':{'not':_0x348b7f(0xf8)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x257607=0x0;for(const _0x14680b of _0x2d0c38){const _0x311bc8=await currencyService_1[_0x348b7f(0xf2)][_0x348b7f(0x15d)](_0x14680b[_0x348b7f(0x18a)],_0x14680b['currency']);_0x257607+=_0x311bc8;}const _0x73cbfe=this[_0x348b7f(0xb7)](_0x5dcccd,_0x4344b4,_0x3f134a),_0x448458=_0x981965>0x0?_0x1daffb/_0x981965*0x64:0x0;return{'totalShops':_0x480125,'activeShops':_0x3d72ff,'totalPayments':_0x981965,'successfulPayments':_0x1daffb,'totalRevenue':Math[_0x348b7f(0x19b)](_0x257607*0x64)/0x64,'conversionRate':Math[_0x348b7f(0x19b)](_0x448458*0x64)/0x64,'dailyRevenue':_0x73cbfe['dailyRevenue'],'dailyPayments':_0x73cbfe[_0x348b7f(0xf4)],'recentPayments':_0x14d48b['map'](_0x508720=>({'id':_0x508720['id'],'amount':_0x508720[_0x348b7f(0x18a)],'currency':_0x508720['currency'],'status':_0x508720[_0x348b7f(0x103)],'gateway':_0x508720[_0x348b7f(0xb4)],'shop':_0x508720['shop'],'createdAt':_0x508720[_0x348b7f(0xc5)]}))};}async[a35_0x55f94f(0xfc)](_0x1df684){const _0x4fb7d5=a35_0x55f94f;console[_0x4fb7d5(0x16c)](_0x4fb7d5(0xcb),_0x1df684);let _0x45251f,_0x5626df=new Date();if(_0x1df684[_0x4fb7d5(0x12d)]==='custom'&&_0x1df684[_0x4fb7d5(0x1b5)]&&_0x1df684[_0x4fb7d5(0xd9)])_0x45251f=new Date(_0x1df684['dateFrom']),_0x5626df=new Date(_0x1df684[_0x4fb7d5(0xd9)]);else{const _0x9c2fb=new Date();switch(_0x1df684[_0x4fb7d5(0x12d)]){case'week':_0x45251f=new Date(_0x9c2fb[_0x4fb7d5(0xe8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4fb7d5(0x19d):_0x45251f=new Date(_0x9c2fb[_0x4fb7d5(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4fb7d5(0xd0):_0x45251f=new Date(_0x9c2fb[_0x4fb7d5(0xe8)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x45251f=new Date(_0x4fb7d5(0x1c3));break;}}console[_0x4fb7d5(0x16c)]('üìÖ\x20Period:\x20'+_0x45251f['toISOString']()+_0x4fb7d5(0xc7)+_0x5626df['toISOString']());const _0x20d6c0={'status':_0x4fb7d5(0x100),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x45251f,'lte':_0x5626df}};_0x1df684[_0x4fb7d5(0x1c4)]&&(_0x20d6c0[_0x4fb7d5(0x1c4)]=_0x1df684['shopId']);const _0x4bd8fc=await database_1[_0x4fb7d5(0x1ac)]['payment']['findMany']({'where':_0x20d6c0,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4fb7d5(0x16c)](_0x4fb7d5(0xd2)+_0x4bd8fc['length']+_0x4fb7d5(0xb1));const _0x5e4bd0={'gateway':{'not':_0x4fb7d5(0xf8)},'createdAt':{'gte':_0x45251f,'lte':_0x5626df}};_0x1df684[_0x4fb7d5(0x1c4)]&&(_0x5e4bd0[_0x4fb7d5(0x1c4)]=_0x1df684[_0x4fb7d5(0x1c4)]);const _0x2cb2f1=await database_1[_0x4fb7d5(0x1ac)][_0x4fb7d5(0xce)]['count']({'where':_0x5e4bd0});console[_0x4fb7d5(0x16c)](_0x4fb7d5(0x107)+_0x2cb2f1+',\x20successful:\x20'+_0x4bd8fc['length']);let _0x2cdaba=0x0,_0x500f22=0x0,_0x1c8c8f=0x0;const _0x12f081={},_0x567915={},_0x3dd1c6={};for(const _0x1d86b9 of _0x4bd8fc){try{const _0x189fa3=await currencyService_1[_0x4fb7d5(0xf2)]['convertToUSDT'](_0x1d86b9[_0x4fb7d5(0x18a)],_0x1d86b9[_0x4fb7d5(0x1c7)]);let _0x2b7202={};if(_0x1d86b9['shop'][_0x4fb7d5(0xfd)])try{_0x2b7202=JSON[_0x4fb7d5(0x17b)](_0x1d86b9[_0x4fb7d5(0xd7)][_0x4fb7d5(0xfd)]);}catch(_0x207ad4){console[_0x4fb7d5(0x1d3)](_0x4fb7d5(0xdb)+_0x1d86b9[_0x4fb7d5(0x1c4)]+':',_0x207ad4);}let _0x59e14b={},_0x2942f8=0xa;for(const [_0x3e9a7d,_0x1a626e]of Object[_0x4fb7d5(0x171)](_0x2b7202)){if(_0x3e9a7d[_0x4fb7d5(0xfb)]()===_0x1d86b9[_0x4fb7d5(0xb4)][_0x4fb7d5(0xfb)]()){_0x59e14b=_0x1a626e,_0x2942f8=_0x1a626e[_0x4fb7d5(0x1a0)]||0xa;break;}}const _0x11f441=_0x189fa3*(_0x2942f8/0x64),_0x2e01ef=_0x189fa3-_0x11f441;_0x2cdaba+=_0x189fa3,_0x500f22+=_0x2e01ef,_0x1c8c8f+=_0x11f441;!_0x12f081[_0x1d86b9['gateway']]&&(_0x12f081[_0x1d86b9[_0x4fb7d5(0xb4)]]={'gateway':_0x1d86b9['gateway'],'gatewayDisplayName':this[_0x4fb7d5(0xc3)](_0x1d86b9[_0x4fb7d5(0xb4)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x12f081[_0x1d86b9['gateway']][_0x4fb7d5(0x17a)]++,_0x12f081[_0x1d86b9['gateway']][_0x4fb7d5(0x1c2)]+=_0x189fa3,_0x12f081[_0x1d86b9[_0x4fb7d5(0xb4)]][_0x4fb7d5(0x1d7)]+=_0x11f441,_0x12f081[_0x1d86b9['gateway']]['merchantEarningsUSDT']+=_0x2e01ef,_0x12f081[_0x1d86b9[_0x4fb7d5(0xb4)]][_0x4fb7d5(0xe6)]+=_0x2942f8;!_0x1df684[_0x4fb7d5(0x1c4)]&&(!_0x567915[_0x1d86b9[_0x4fb7d5(0x1c4)]]&&(_0x567915[_0x1d86b9['shopId']]={'shopId':_0x1d86b9[_0x4fb7d5(0x1c4)],'shopName':_0x1d86b9[_0x4fb7d5(0xd7)][_0x4fb7d5(0x196)],'shopUsername':_0x1d86b9[_0x4fb7d5(0xd7)][_0x4fb7d5(0xee)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x567915[_0x1d86b9[_0x4fb7d5(0x1c4)]][_0x4fb7d5(0x17a)]++,_0x567915[_0x1d86b9[_0x4fb7d5(0x1c4)]][_0x4fb7d5(0x1c2)]+=_0x189fa3,_0x567915[_0x1d86b9[_0x4fb7d5(0x1c4)]][_0x4fb7d5(0x1d7)]+=_0x11f441,_0x567915[_0x1d86b9[_0x4fb7d5(0x1c4)]][_0x4fb7d5(0x184)]+=_0x2e01ef);const _0x5d5c40=_0x1d86b9[_0x4fb7d5(0x18f)][_0x4fb7d5(0x1c5)]()['split']('T')[0x0];!_0x3dd1c6[_0x5d5c40]&&(_0x3dd1c6[_0x5d5c40]={'date':_0x5d5c40,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3dd1c6[_0x5d5c40][_0x4fb7d5(0x1a4)]+=_0x189fa3,_0x3dd1c6[_0x5d5c40][_0x4fb7d5(0xbd)]+=_0x2e01ef,_0x3dd1c6[_0x5d5c40][_0x4fb7d5(0x141)]+=_0x11f441,_0x3dd1c6[_0x5d5c40][_0x4fb7d5(0x17a)]++;}catch(_0x7fc0f8){console[_0x4fb7d5(0x1d3)](_0x4fb7d5(0x150)+_0x1d86b9['id']+':',_0x7fc0f8);}}Object[_0x4fb7d5(0x185)](_0x12f081)['forEach'](_0x13c590=>{const _0x293ff8=_0x4fb7d5;_0x13c590[_0x293ff8(0x1b7)]=_0x13c590['paymentsCount']>0x0?_0x13c590[_0x293ff8(0xe6)]/_0x13c590[_0x293ff8(0x17a)]:0x0,delete _0x13c590[_0x293ff8(0xe6)];}),Object[_0x4fb7d5(0x185)](_0x567915)[_0x4fb7d5(0x15c)](_0x4bb079=>{const _0x16e836=_0x4fb7d5;_0x4bb079[_0x16e836(0x1a7)]=_0x4bb079[_0x16e836(0x17a)]>0x0?_0x4bb079['turnoverUSDT']/_0x4bb079['paymentsCount']:0x0;});let _0x3406f7=0x0;if(_0x1df684[_0x4fb7d5(0x1c4)]){const _0x28ff1a=await database_1['default']['payout']['findMany']({'where':{'shopId':_0x1df684[_0x4fb7d5(0x1c4)],'status':_0x4fb7d5(0x14a),'createdAt':{'gte':_0x45251f,'lte':_0x5626df}},'select':{'amount':!![]}});_0x3406f7=_0x28ff1a[_0x4fb7d5(0x1d4)]((_0x17420c,_0xbf6e1b)=>_0x17420c+_0xbf6e1b['amount'],0x0);}const _0x12739c=_0x2cb2f1,_0x37eaae=_0x4bd8fc[_0x4fb7d5(0x198)],_0xfaee96=_0x37eaae>0x0?_0x2cdaba/_0x37eaae:0x0,_0x560797=_0x12739c>0x0?Math[_0x4fb7d5(0x19b)](_0x37eaae/_0x12739c*0x2710)/0x64:0x0,_0x18003c=Math[_0x4fb7d5(0x1cb)]((_0x5626df[_0x4fb7d5(0xe8)]()-_0x45251f[_0x4fb7d5(0xe8)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4ffe8f={'totalTurnover':Math['round'](_0x2cdaba*0x64)/0x64,'merchantEarnings':Math[_0x4fb7d5(0x19b)](_0x500f22*0x64)/0x64,'gatewayEarnings':Math[_0x4fb7d5(0x19b)](_0x1c8c8f*0x64)/0x64,'totalPaidOut':Math[_0x4fb7d5(0x19b)](_0x3406f7*0x64)/0x64,'averageCheck':Math[_0x4fb7d5(0x19b)](_0xfaee96*0x64)/0x64,'totalPayments':_0x12739c,'successfulPayments':_0x37eaae,'conversionRate':_0x560797,'gatewayBreakdown':Object[_0x4fb7d5(0x185)](_0x12f081)[_0x4fb7d5(0x126)](_0x49888f=>({..._0x49888f,'turnoverUSDT':Math[_0x4fb7d5(0x19b)](_0x49888f['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x4fb7d5(0x19b)](_0x49888f['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x49888f[_0x4fb7d5(0x184)]*0x64)/0x64,'averageCommissionRate':Math[_0x4fb7d5(0x19b)](_0x49888f[_0x4fb7d5(0x1b7)]*0x64)/0x64})),'merchantBreakdown':_0x1df684['shopId']?undefined:Object[_0x4fb7d5(0x185)](_0x567915)['map'](_0x156262=>({..._0x156262,'turnoverUSDT':Math['round'](_0x156262[_0x4fb7d5(0x1c2)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x156262[_0x4fb7d5(0x1d7)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4fb7d5(0x19b)](_0x156262[_0x4fb7d5(0x184)]*0x64)/0x64,'paidOutUSDT':Math[_0x4fb7d5(0x19b)](_0x156262[_0x4fb7d5(0x166)]*0x64)/0x64,'averageCheckUSDT':Math[_0x4fb7d5(0x19b)](_0x156262[_0x4fb7d5(0x1a7)]*0x64)/0x64})),'dailyData':Object['values'](_0x3dd1c6)[_0x4fb7d5(0x126)](_0x225c29=>({..._0x225c29,'turnover':Math[_0x4fb7d5(0x19b)](_0x225c29['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x4fb7d5(0x19b)](_0x225c29[_0x4fb7d5(0xbd)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x225c29[_0x4fb7d5(0x141)]*0x64)/0x64}))[_0x4fb7d5(0x167)]((_0x1ee1dd,_0x54bdc1)=>_0x1ee1dd[_0x4fb7d5(0xdd)][_0x4fb7d5(0xda)](_0x54bdc1[_0x4fb7d5(0xdd)])),'periodInfo':{'from':_0x45251f,'to':_0x5626df,'periodType':_0x1df684['period']||'custom','daysCount':_0x18003c}};return console[_0x4fb7d5(0x16c)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x4fb7d5(0x16c)](_0x4fb7d5(0x178)+_0x4ffe8f[_0x4fb7d5(0x181)]+'\x20USDT'),console[_0x4fb7d5(0x16c)](_0x4fb7d5(0xd1)+_0x4ffe8f[_0x4fb7d5(0xbd)]+_0x4fb7d5(0x182)),console[_0x4fb7d5(0x16c)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x4ffe8f[_0x4fb7d5(0x141)]+_0x4fb7d5(0x182)),console[_0x4fb7d5(0x16c)](_0x4fb7d5(0xea)+_0x4ffe8f[_0x4fb7d5(0xf7)]),_0x4ffe8f;}async[a35_0x55f94f(0xba)](){const _0x289032=a35_0x55f94f;console[_0x289032(0x16c)](_0x289032(0x12e));const _0xa868f7=await database_1[_0x289032(0x1ac)][_0x289032(0xd7)]['findMany']({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x289032(0x12c)}});return console['log'](_0x289032(0xeb)+_0xa868f7[_0x289032(0x198)]+_0x289032(0x138)),_0xa868f7[_0x289032(0x126)](_0x147f4a=>({'id':_0x147f4a['id'],'username':_0x147f4a[_0x289032(0xee)],'name':_0x147f4a[_0x289032(0x196)]}));}[a35_0x55f94f(0xc3)](_0x30cbfd){const _0x4a8578=a35_0x55f94f,_0x5ba5c5={'test_gateway':'Test\x20Gateway','plisio':_0x4a8578(0x13e),'rapyd':_0x4a8578(0xb9),'noda':_0x4a8578(0xf3),'cointopay':_0x4a8578(0xd3),'klyme_eu':_0x4a8578(0x11e),'klyme_gb':_0x4a8578(0x195),'klyme_de':_0x4a8578(0x116)};return _0x5ba5c5[_0x30cbfd]||_0x30cbfd;}async[a35_0x55f94f(0x16e)](_0x3f60c4){const _0x8112ef=a35_0x55f94f,{page:_0x49ca33,limit:_0x56ee84,minAmount:_0x39bae4,search:_0x217100}=_0x3f60c4,_0x30bdfa=(_0x49ca33-0x1)*_0x56ee84;console['log']('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x3f60c4);const _0xb21728={'balance':{'gt':0x0},'status':'ACTIVE'};_0x39bae4&&(_0xb21728[_0x8112ef(0x160)][_0x8112ef(0x19f)]=_0x39bae4);_0x217100&&(_0xb21728['OR']=[{'name':{'contains':_0x217100,'mode':_0x8112ef(0x179)}},{'username':{'contains':_0x217100,'mode':_0x8112ef(0x179)}}]);const [_0x5a3661,_0x12be49]=await Promise['all']([database_1[_0x8112ef(0x1ac)][_0x8112ef(0xd7)][_0x8112ef(0x13d)]({'where':_0xb21728,'skip':_0x30bdfa,'take':_0x56ee84,'orderBy':{'balance':_0x8112ef(0xcd)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop']['count']({'where':_0xb21728})]);console[_0x8112ef(0x16c)]('üí∞\x20Found\x20'+_0x5a3661[_0x8112ef(0x198)]+_0x8112ef(0xef));const _0x4e0e20=await Promise['all'](_0x5a3661[_0x8112ef(0x126)](async _0x226bb4=>{const _0x2223c7=_0x8112ef,[_0x1ae084,_0x54879f,_0x33b688]=await Promise['all']([database_1[_0x2223c7(0x1ac)][_0x2223c7(0xce)][_0x2223c7(0x10d)]({'where':{'shopId':_0x226bb4['id'],'status':_0x2223c7(0x100),'gateway':{'not':'test_gateway'}}}),database_1[_0x2223c7(0x1ac)][_0x2223c7(0xce)][_0x2223c7(0x170)]({'where':{'shopId':_0x226bb4['id'],'status':_0x2223c7(0x100),'gateway':{'not':_0x2223c7(0xf8)}},'orderBy':{'paidAt':_0x2223c7(0x12c)},'select':{'paidAt':!![]}}),database_1[_0x2223c7(0x1ac)][_0x2223c7(0xce)][_0x2223c7(0x144)]({'by':['gateway'],'where':{'shopId':_0x226bb4['id'],'status':_0x2223c7(0x100),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2b1a0f=new Date(),_0x1a676f=new Date(_0x2b1a0f[_0x2223c7(0x13b)](),_0x2b1a0f[_0x2223c7(0xd4)](),0x1),_0x41eacd=new Date(_0x2b1a0f[_0x2223c7(0x13b)](),_0x2b1a0f['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x32dd5f,_0x36183c]=await Promise[_0x2223c7(0x117)]([database_1[_0x2223c7(0x1ac)][_0x2223c7(0x125)][_0x2223c7(0x1ae)]({'_sum':{'amount':!![]},'where':{'shopId':_0x226bb4['id'],'status':_0x2223c7(0x14a)}}),database_1[_0x2223c7(0x1ac)][_0x2223c7(0x125)][_0x2223c7(0x1ae)]({'_sum':{'amount':!![]},'where':{'shopId':_0x226bb4['id'],'status':_0x2223c7(0x14a),'createdAt':{'gte':_0x1a676f,'lte':_0x41eacd}}})]),_0x57a63f=_0x32dd5f['_sum']['amount']||0x0,_0x3e85f9=_0x36183c[_0x2223c7(0x1b1)][_0x2223c7(0x18a)]||0x0,_0x38c79d=await Promise[_0x2223c7(0x117)](_0x33b688[_0x2223c7(0x126)](async _0x4665d9=>{const _0x135cfd=_0x2223c7;let _0x420fc0=0xa;if(_0x226bb4[_0x135cfd(0xfd)])try{const _0x2364b1=JSON['parse'](_0x226bb4[_0x135cfd(0xfd)]);for(const [_0x3f261c,_0x1c0d69]of Object[_0x135cfd(0x171)](_0x2364b1)){if(_0x3f261c[_0x135cfd(0xfb)]()===_0x4665d9[_0x135cfd(0xb4)][_0x135cfd(0xfb)]()){_0x420fc0=_0x1c0d69[_0x135cfd(0x1a0)]||0xa,console[_0x135cfd(0x16c)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x4665d9[_0x135cfd(0xb4)]+_0x135cfd(0xed)+_0x226bb4['id']+_0x135cfd(0x194)+_0x420fc0+'%');break;}}}catch(_0x2b124a){console[_0x135cfd(0x1d3)](_0x135cfd(0xdb)+_0x226bb4['id']+':',_0x2b124a);}const _0x4b8916=_0x4665d9['_sum'][_0x135cfd(0x19a)]||0x0,_0x510dde=_0x4b8916*(0x1-_0x420fc0/0x64);return{'gateway':_0x4665d9['gateway'],'count':_0x4665d9[_0x135cfd(0xe7)]['id'],'amountUSDT':Math['round'](_0x4b8916*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x135cfd(0x19b)](_0x510dde*0x64)/0x64,'commission':_0x420fc0};})),_0x5443d8=_0x38c79d['reduce']((_0x56328e,_0x1163ee)=>_0x56328e+_0x1163ee[_0x2223c7(0x19a)],0x0),_0x516605=_0x226bb4[_0x2223c7(0x160)];return console[_0x2223c7(0x16c)](_0x2223c7(0x14e)+_0x226bb4[_0x2223c7(0xee)]+':'),console[_0x2223c7(0x16c)](_0x2223c7(0x1a6)+_0x5443d8['toFixed'](0x2)+_0x2223c7(0x1c6)),console[_0x2223c7(0x16c)]('\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20'+_0x38c79d[_0x2223c7(0x1d4)]((_0xe418a7,_0x36f1e9)=>_0xe418a7+_0x36f1e9['amountAfterCommissionUSDT'],0x0)[_0x2223c7(0x1b8)](0x2)+_0x2223c7(0x159)),console[_0x2223c7(0x16c)](_0x2223c7(0x15b)+_0x516605[_0x2223c7(0x1b8)](0x2)+_0x2223c7(0xf1)),{'id':_0x226bb4['id'],'fullName':_0x226bb4[_0x2223c7(0x196)],'username':_0x226bb4[_0x2223c7(0xee)],'telegramId':_0x226bb4['telegram'],'merchantUrl':_0x226bb4[_0x2223c7(0x17e)],'wallets':{'usdtPolygonWallet':_0x226bb4[_0x2223c7(0x18e)],'usdtTrcWallet':_0x226bb4['usdtTrcWallet'],'usdtErcWallet':_0x226bb4[_0x2223c7(0xc1)],'usdcPolygonWallet':_0x226bb4[_0x2223c7(0x177)]},'totalAmountUSDT':Math[_0x2223c7(0x19b)](_0x5443d8*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x516605*0x64)/0x64,'totalPayout':Math[_0x2223c7(0x19b)](_0x57a63f*0x64)/0x64,'thisMonth':Math[_0x2223c7(0x19b)](_0x3e85f9*0x64)/0x64,'paymentsCount':_0x1ae084,'oldestPaymentDate':_0x54879f?.[_0x2223c7(0x18f)]||_0x226bb4[_0x2223c7(0xc5)],'gatewayBreakdown':_0x38c79d};})),_0xf4779=_0x4e0e20[_0x8112ef(0x1d4)]((_0xf7ba1e,_0x2fd375)=>_0xf7ba1e+_0x2fd375[_0x8112ef(0xf6)],0x0),_0x294bf3=_0x4e0e20['reduce']((_0x187627,_0x419737)=>_0x187627+_0x419737[_0x8112ef(0x11d)],0x0),_0x3bf62b=_0x4e0e20[_0x8112ef(0x1d4)]((_0x6b9a5a,_0x4cb399)=>_0x6b9a5a+_0x4cb399[_0x8112ef(0x151)],0x0),_0xd5df67=_0x4e0e20[_0x8112ef(0x1d4)]((_0x18f5c3,_0x49e673)=>_0x18f5c3+_0x49e673['thisMonth'],0x0);return console[_0x8112ef(0x16c)]('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x12be49+_0x8112ef(0xfa)),console[_0x8112ef(0x16c)]('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math['round'](_0xf4779*0x64)/0x64+_0x8112ef(0x1c6)),console[_0x8112ef(0x16c)]('\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x8112ef(0x19b)](_0x294bf3*0x64)/0x64+_0x8112ef(0xb5)),console[_0x8112ef(0x16c)](_0x8112ef(0x183)+Math['round'](_0x3bf62b*0x64)/0x64+_0x8112ef(0x182)),console['log'](_0x8112ef(0x119)+Math[_0x8112ef(0x19b)](_0xd5df67*0x64)/0x64+_0x8112ef(0x182)),{'merchants':_0x4e0e20,'pagination':{'page':_0x49ca33,'limit':_0x56ee84,'total':_0x12be49,'totalPages':Math[_0x8112ef(0x1cb)](_0x12be49/_0x56ee84)},'summary':{'totalMerchants':_0x12be49,'totalAmountUSDT':Math[_0x8112ef(0x19b)](_0xf4779*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x294bf3*0x64)/0x64,'totalPayout':Math[_0x8112ef(0x19b)](_0x3bf62b*0x64)/0x64,'thisMonth':Math[_0x8112ef(0x19b)](_0xd5df67*0x64)/0x64}};}async[a35_0x55f94f(0x1c8)](_0x192935){const _0x14cf84=a35_0x55f94f,{shopId:_0x309c23,amount:_0xccc9c7,network:_0x4fc33a,wallet:_0x5c179d,notes:_0x5e207d,txid:_0x3db19d,periodFrom:_0x50cbd6,periodTo:_0x2e749a}=_0x192935,_0x10b442=await database_1[_0x14cf84(0x1ac)][_0x14cf84(0x191)](async _0x383b7e=>{const _0x31027b=_0x14cf84,_0xb01577=await _0x383b7e[_0x31027b(0xd7)]['findUnique']({'where':{'id':_0x309c23},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xb01577)throw new Error(_0x31027b(0x152));console[_0x31027b(0x16c)](_0x31027b(0x173)+_0xb01577[_0x31027b(0xee)]+':'),console['log'](_0x31027b(0xc6)+_0xb01577[_0x31027b(0x160)][_0x31027b(0x1b8)](0x6)+'\x20USDT'),console[_0x31027b(0x16c)](_0x31027b(0x122)+_0xccc9c7['toFixed'](0x6)+_0x31027b(0x182)),console[_0x31027b(0x16c)](_0x31027b(0x174)+_0xb01577[_0x31027b(0x106)][_0x31027b(0x1b8)](0x6)+_0x31027b(0x182));if(_0x3db19d)console[_0x31027b(0x16c)](_0x31027b(0xf9)+_0x3db19d);if(_0xb01577[_0x31027b(0x160)]<_0xccc9c7)throw new Error(_0x31027b(0x172)+_0xb01577[_0x31027b(0x160)][_0x31027b(0x1b8)](0x6)+'\x20USDT,\x20Requested:\x20'+_0xccc9c7['toFixed'](0x6)+'\x20USDT');let _0x164ec7=_0x5c179d;if(!_0x164ec7){const _0x20451f=await _0x383b7e[_0x31027b(0xd7)]['findUnique']({'where':{'id':_0x309c23},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x20451f)switch(_0x4fc33a){case _0x31027b(0x1ce):_0x164ec7=_0x20451f[_0x31027b(0x18e)]||undefined;break;case _0x31027b(0x148):_0x164ec7=_0x20451f['usdtTrcWallet']||undefined;break;case _0x31027b(0xe4):_0x164ec7=_0x20451f['usdtErcWallet']||undefined;break;case _0x31027b(0x145):_0x164ec7=_0x20451f[_0x31027b(0x177)]||undefined;break;}}console[_0x31027b(0x16c)](_0x31027b(0x156)+_0x4fc33a+':\x20'+(_0x164ec7||_0x31027b(0x1a8)));const _0x190ffa=await _0x383b7e[_0x31027b(0x125)]['create']({'data':{'shopId':_0x309c23,'amount':_0xccc9c7,'network':_0x4fc33a,'status':'COMPLETED','txid':_0x3db19d,'notes':_0x5e207d,'periodFrom':_0x50cbd6?new Date(_0x50cbd6):null,'periodTo':_0x2e749a?new Date(_0x2e749a):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x1ca1ff=_0xb01577['balance']-_0xccc9c7,_0x141480=_0xb01577[_0x31027b(0x106)]+_0xccc9c7;return await _0x383b7e['shop']['update']({'where':{'id':_0x309c23},'data':{'balance':_0x1ca1ff,'totalPaidOut':_0x141480}}),console[_0x31027b(0x16c)](_0x31027b(0x1c9)+_0xb01577[_0x31027b(0xee)]+_0x31027b(0xb2)),console[_0x31027b(0x16c)](_0x31027b(0x1a9)+_0xb01577[_0x31027b(0x160)][_0x31027b(0x1b8)](0x6)+'\x20->\x20'+_0x1ca1ff[_0x31027b(0x1b8)](0x6)+_0x31027b(0x10b)+_0xccc9c7[_0x31027b(0x1b8)](0x6)+')'),console[_0x31027b(0x16c)](_0x31027b(0x1d1)+_0xb01577[_0x31027b(0x106)][_0x31027b(0x1b8)](0x6)+'\x20->\x20'+_0x141480[_0x31027b(0x1b8)](0x6)+_0x31027b(0x108)+_0xccc9c7[_0x31027b(0x1b8)](0x6)+')'),{'payout':_0x190ffa,'shop':_0xb01577};});return console[_0x14cf84(0x16c)]('‚úÖ\x20Payout\x20created:\x20'+_0x10b442['payout']['id']+_0x14cf84(0xed)+_0x10b442[_0x14cf84(0xd7)][_0x14cf84(0xee)]+'\x20('+_0xccc9c7+'\x20USDT)'),{'id':_0x10b442['payout']['id'],'shopId':_0x10b442[_0x14cf84(0x125)]['shopId'],'shopName':_0x10b442['shop']['name'],'shopUsername':_0x10b442[_0x14cf84(0xd7)]['username'],'amount':_0x10b442[_0x14cf84(0x125)][_0x14cf84(0x18a)],'network':_0x10b442[_0x14cf84(0x125)][_0x14cf84(0xe2)],'status':_0x10b442[_0x14cf84(0x125)]['status'],'txid':_0x10b442[_0x14cf84(0x125)]['txid'],'notes':_0x10b442['payout'][_0x14cf84(0x1cd)],'periodFrom':_0x10b442[_0x14cf84(0x125)][_0x14cf84(0x15f)],'periodTo':_0x10b442[_0x14cf84(0x125)][_0x14cf84(0xde)],'createdAt':_0x10b442[_0x14cf84(0x125)][_0x14cf84(0xc5)],'paidAt':_0x10b442['payout'][_0x14cf84(0x18f)]};}async[a35_0x55f94f(0xe0)](_0x4a9ec3){const _0x21b928=a35_0x55f94f,{page:_0x145d28,limit:_0xd5c1fd,shopId:_0x157dea,network:_0xfe39ae,dateFrom:_0x4c98ba,dateTo:_0x1a75ef,search:_0x23ed0b}=_0x4a9ec3,_0x142f36=(_0x145d28-0x1)*_0xd5c1fd,_0x5317f5={};_0x157dea&&(_0x5317f5[_0x21b928(0x1c4)]=_0x157dea);_0xfe39ae&&(_0x5317f5[_0x21b928(0xe2)]=_0xfe39ae);(_0x4c98ba||_0x1a75ef)&&(_0x5317f5[_0x21b928(0xc5)]={},_0x4c98ba&&(_0x5317f5['createdAt'][_0x21b928(0x19f)]=new Date(_0x4c98ba)),_0x1a75ef&&(_0x5317f5['createdAt'][_0x21b928(0x158)]=new Date(_0x1a75ef)));_0x23ed0b&&(_0x5317f5['OR']=[{'shop':{'name':{'contains':_0x23ed0b,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x23ed0b,'mode':_0x21b928(0x179)}}},{'notes':{'contains':_0x23ed0b,'mode':'insensitive'}}]);const [_0x1c5c9c,_0x356ab6]=await Promise[_0x21b928(0x117)]([database_1[_0x21b928(0x1ac)][_0x21b928(0x125)][_0x21b928(0x13d)]({'where':_0x5317f5,'skip':_0x142f36,'take':_0xd5c1fd,'orderBy':{'createdAt':_0x21b928(0xcd)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x21b928(0x1ac)][_0x21b928(0x125)]['count']({'where':_0x5317f5})]);return{'payouts':_0x1c5c9c[_0x21b928(0x126)](_0x1efeb2=>({'id':_0x1efeb2['id'],'shopId':_0x1efeb2['shopId'],'shopName':_0x1efeb2[_0x21b928(0xd7)]['name'],'shopUsername':_0x1efeb2['shop'][_0x21b928(0xee)],'amount':_0x1efeb2[_0x21b928(0x18a)],'network':_0x1efeb2[_0x21b928(0xe2)],'status':_0x1efeb2[_0x21b928(0x103)],'txid':_0x1efeb2[_0x21b928(0xe1)],'notes':_0x1efeb2[_0x21b928(0x1cd)],'periodFrom':_0x1efeb2[_0x21b928(0x15f)],'periodTo':_0x1efeb2['periodTo'],'createdAt':_0x1efeb2[_0x21b928(0xc5)],'paidAt':_0x1efeb2[_0x21b928(0x18f)]})),'pagination':{'page':_0x145d28,'limit':_0xd5c1fd,'total':_0x356ab6,'totalPages':Math[_0x21b928(0x1cb)](_0x356ab6/_0xd5c1fd)}};}async[a35_0x55f94f(0x1d5)](_0x862a09){const _0x5ceaf9=a35_0x55f94f,_0x1bba20=await database_1['default']['payout'][_0x5ceaf9(0x137)]({'where':{'id':_0x862a09},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1bba20)return null;return{'id':_0x1bba20['id'],'shopId':_0x1bba20[_0x5ceaf9(0x1c4)],'shopName':_0x1bba20[_0x5ceaf9(0xd7)][_0x5ceaf9(0x196)],'shopUsername':_0x1bba20[_0x5ceaf9(0xd7)][_0x5ceaf9(0xee)],'amount':_0x1bba20[_0x5ceaf9(0x18a)],'network':_0x1bba20[_0x5ceaf9(0xe2)],'status':_0x1bba20[_0x5ceaf9(0x103)],'txid':_0x1bba20[_0x5ceaf9(0xe1)],'notes':_0x1bba20[_0x5ceaf9(0x1cd)],'periodFrom':_0x1bba20['periodFrom'],'periodTo':_0x1bba20[_0x5ceaf9(0xde)],'createdAt':_0x1bba20[_0x5ceaf9(0xc5)],'paidAt':_0x1bba20[_0x5ceaf9(0x18f)]};}async['deletePayout'](_0x1c95cb){const _0x5f357c=a35_0x55f94f;await database_1['default']['payout'][_0x5f357c(0x131)]({'where':{'id':_0x1c95cb}});}async[a35_0x55f94f(0x1ad)](_0x2f438a){const _0x21a411=a35_0x55f94f,{page:_0x19246c,limit:_0x3448a5,status:_0x29524a,gateway:_0x4e6bb6,shopId:_0x18919e,dateFrom:_0x15e637,dateTo:_0x3faabb,search:_0x46ba1f,currency:_0x134b88,sortBy:_0x3268df,sortOrder:_0x134690}=_0x2f438a,_0x166a88=(_0x19246c-0x1)*_0x3448a5;console[_0x21a411(0x16c)](_0x21a411(0x1aa),_0x2f438a);const _0x55714e=await database_1[_0x21a411(0x1ac)][_0x21a411(0xce)][_0x21a411(0x144)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x21a411(0x16c)](_0x21a411(0x12f),_0x55714e[_0x21a411(0x126)](_0x425192=>_0x425192[_0x21a411(0xb4)]+'\x20('+_0x425192[_0x21a411(0xe7)][_0x21a411(0xb4)]+_0x21a411(0x1b0)));if(_0x4e6bb6){const _0x7998ad=_0x55714e[_0x21a411(0x18d)](_0x166c10=>_0x166c10[_0x21a411(0xb4)]['toLowerCase']()===_0x4e6bb6[_0x21a411(0xfb)]());!_0x7998ad&&_0x4e6bb6[_0x21a411(0xfb)]()!=='test_gateway'&&console[_0x21a411(0x16c)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x4e6bb6+_0x21a411(0x147)+_0x55714e[_0x21a411(0x126)](_0x28644b=>_0x28644b[_0x21a411(0xb4)])[_0x21a411(0x187)](',\x20'));}const _0x33754b={};_0x29524a&&(_0x33754b[_0x21a411(0x103)]=_0x29524a[_0x21a411(0xc0)]());if(!_0x4e6bb6)_0x33754b[_0x21a411(0xb4)]={'not':_0x21a411(0xf8)};else{if(_0x4e6bb6&&(_0x4e6bb6[_0x21a411(0xfb)]()===_0x21a411(0xf8)||_0x4e6bb6===_0x21a411(0xb3)))_0x33754b[_0x21a411(0xb4)]='test_gateway';else{let _0x283fd6=_0x4e6bb6;const _0x372155=(0x0,gateway_1[_0x21a411(0x140)])(_0x4e6bb6);if(_0x372155)_0x283fd6=_0x372155,console['log'](_0x21a411(0xc2)+_0x4e6bb6+_0x21a411(0x18b)+_0x283fd6+'\x27');else{const _0x1a8397=(0x0,gateway_1[_0x21a411(0xdf)])(_0x4e6bb6);if(_0x1a8397){const _0x16e24b=(0x0,gateway_1[_0x21a411(0x140)])(_0x1a8397);_0x16e24b&&(_0x283fd6=_0x16e24b,console['log'](_0x21a411(0x169)+_0x4e6bb6+_0x21a411(0x161)+_0x1a8397+_0x21a411(0xc9)+_0x283fd6+'\x27'));}else console[_0x21a411(0x16c)]('üîç\x20Using\x20gateway\x20\x27'+_0x4e6bb6+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x564701=await database_1[_0x21a411(0x1ac)]['payment']['count']({'where':{'gateway':_0x283fd6['toLowerCase']()},'take':0x1});_0x564701===0x0?(console[_0x21a411(0x16c)](_0x21a411(0x180)+_0x283fd6+'\x27\x20(from\x20\x27'+_0x4e6bb6+_0x21a411(0x1c1)),_0x33754b[_0x21a411(0xb4)]='NONEXISTENT_GATEWAY_FILTER'):(_0x33754b[_0x21a411(0xb4)]=_0x283fd6[_0x21a411(0xfb)](),console[_0x21a411(0x16c)](_0x21a411(0xcf)+_0x283fd6+_0x21a411(0x1ca)+_0x4e6bb6+'\x27)'));}}console[_0x21a411(0x16c)](_0x21a411(0xfe),_0x33754b[_0x21a411(0xb4)]);_0x18919e&&(_0x33754b['shopId']=_0x18919e);_0x134b88&&(_0x33754b['currency']=_0x134b88['toUpperCase'](),console[_0x21a411(0x16c)]('üí±\x20Currency\x20filter\x20applied:\x20'+_0x134b88[_0x21a411(0xc0)]()));(_0x15e637||_0x3faabb)&&(_0x33754b[_0x21a411(0xc5)]={},_0x15e637&&(_0x33754b[_0x21a411(0xc5)][_0x21a411(0x19f)]=new Date(_0x15e637)),_0x3faabb&&(_0x33754b['createdAt'][_0x21a411(0x158)]=new Date(_0x3faabb)));_0x46ba1f&&(_0x33754b['OR']=[{'id':{'contains':_0x46ba1f,'mode':_0x21a411(0x179)}},{'orderId':{'contains':_0x46ba1f,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x46ba1f,'mode':_0x21a411(0x179)}},{'customerEmail':{'contains':_0x46ba1f,'mode':_0x21a411(0x179)}},{'shop':{'name':{'contains':_0x46ba1f,'mode':_0x21a411(0x179)}}},{'shop':{'username':{'contains':_0x46ba1f,'mode':_0x21a411(0x179)}}}]);console[_0x21a411(0x16c)](_0x21a411(0x139),JSON[_0x21a411(0x189)](_0x33754b,null,0x2));let _0x290d8d={'createdAt':_0x21a411(0xcd)};if(_0x3268df){const _0x34684e=['amount',_0x21a411(0xc5),_0x21a411(0x1b2),_0x21a411(0x103),_0x21a411(0xb4),_0x21a411(0x1c7)],_0x72f021=[_0x21a411(0x12c),_0x21a411(0xcd)];if(_0x34684e['includes'](_0x3268df)){const _0x1864a6=_0x72f021[_0x21a411(0x143)](_0x134690)?_0x134690:_0x21a411(0xcd);_0x290d8d={[_0x3268df]:_0x1864a6},console['log'](_0x21a411(0x1a3)+_0x3268df+_0x21a411(0x146)+_0x1864a6+_0x21a411(0xca));}}const [_0x17bdd3,_0x20da99]=await Promise['all']([database_1[_0x21a411(0x1ac)][_0x21a411(0xce)]['findMany']({'where':_0x33754b,'skip':_0x166a88,'take':_0x3448a5,'orderBy':_0x290d8d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x21a411(0x1ac)][_0x21a411(0xce)][_0x21a411(0x10d)]({'where':_0x33754b})]);return{'payments':_0x17bdd3[_0x21a411(0x126)](_0x499f75=>({'id':_0x499f75['id'],'shopId':_0x499f75[_0x21a411(0x1c4)],'gateway':_0x499f75[_0x21a411(0xb4)],'amount':_0x499f75['amount'],'currency':_0x499f75[_0x21a411(0x1c7)],'status':_0x499f75['status'],'orderId':_0x499f75[_0x21a411(0xc8)],'gatewayOrderId':_0x499f75[_0x21a411(0x197)],'customerEmail':_0x499f75[_0x21a411(0xec)],'customerName':_0x499f75['customerName'],'customerCountry':_0x499f75[_0x21a411(0x1ba)],'customerIp':_0x499f75[_0x21a411(0x134)],'customerUa':_0x499f75[_0x21a411(0x133)],'failureMessage':_0x499f75[_0x21a411(0x13a)],'createdAt':_0x499f75[_0x21a411(0xc5)],'updatedAt':_0x499f75[_0x21a411(0x1b2)],'shop':_0x499f75[_0x21a411(0xd7)]})),'pagination':{'page':_0x19246c,'limit':_0x3448a5,'total':_0x20da99,'totalPages':Math[_0x21a411(0x1cb)](_0x20da99/_0x3448a5)}};}async[a35_0x55f94f(0x12b)](_0x2752cc){const _0x499ff2=a35_0x55f94f,_0x3cf953=await database_1[_0x499ff2(0x1ac)][_0x499ff2(0xce)][_0x499ff2(0x137)]({'where':{'id':_0x2752cc},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3cf953)return null;return{'id':_0x3cf953['id'],'shopId':_0x3cf953[_0x499ff2(0x1c4)],'gateway':_0x3cf953[_0x499ff2(0xb4)],'amount':_0x3cf953[_0x499ff2(0x18a)],'currency':_0x3cf953['currency'],'status':_0x3cf953[_0x499ff2(0x103)],'orderId':_0x3cf953[_0x499ff2(0xc8)],'gatewayOrderId':_0x3cf953[_0x499ff2(0x197)],'customerEmail':_0x3cf953[_0x499ff2(0xec)],'customerName':_0x3cf953[_0x499ff2(0x10f)],'customerCountry':_0x3cf953[_0x499ff2(0x1ba)],'customerIp':_0x3cf953['customerIp'],'customerUa':_0x3cf953[_0x499ff2(0x133)],'failureMessage':_0x3cf953['failureMessage'],'externalPaymentUrl':_0x3cf953[_0x499ff2(0x1a2)],'successUrl':_0x3cf953[_0x499ff2(0x110)],'failUrl':_0x3cf953[_0x499ff2(0x14f)],'pendingUrl':_0x3cf953[_0x499ff2(0x130)],'whiteUrl':_0x3cf953[_0x499ff2(0x124)],'createdAt':_0x3cf953[_0x499ff2(0xc5)],'updatedAt':_0x3cf953[_0x499ff2(0x1b2)],'shop':_0x3cf953[_0x499ff2(0xd7)]};}async[a35_0x55f94f(0x15e)](_0x107153,_0x75dc83,_0x12b902,_0x482f34){const _0x163011=a35_0x55f94f,_0xb05562=await database_1[_0x163011(0x1ac)]['$transaction'](async _0x387d23=>{const _0x503c18=_0x163011,_0x335120=await _0x387d23[_0x503c18(0xce)][_0x503c18(0x137)]({'where':{'id':_0x107153},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x335120)throw new Error('Payment\x20not\x20found');const _0xe78143=_0x335120[_0x503c18(0x103)],_0x41db41=_0x75dc83['toUpperCase']();console[_0x503c18(0x16c)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x107153+_0x503c18(0x163)+_0xe78143+_0x503c18(0xe9)+_0x41db41),console['log'](_0x503c18(0x175)+_0x335120[_0x503c18(0xd7)][_0x503c18(0x160)]+_0x503c18(0x182));const _0x3f242c={'status':_0x41db41,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x12b902&&(_0x3f242c[_0x503c18(0x14d)]=_0x12b902);_0x41db41==='CHARGEBACK'&&_0x482f34&&(_0x3f242c[_0x503c18(0x1bb)]=_0x482f34);let _0x3eb964=0x0,_0x2f2678=_0x335120[_0x503c18(0xd7)][_0x503c18(0x160)];if(_0x41db41===_0x503c18(0x100)&&_0xe78143!=='PAID'){_0x3f242c[_0x503c18(0x18f)]=new Date();const _0x563cc1=await currencyService_1['currencyService']['convertToUSDT'](_0x335120[_0x503c18(0x18a)],_0x335120[_0x503c18(0x1c7)]);_0x3f242c[_0x503c18(0x19a)]=_0x563cc1;let _0x6ccefc=0xa;const _0x599b5b=await _0x387d23[_0x503c18(0xd7)]['findUnique']({'where':{'id':_0x335120['shopId']},'select':{'gatewaySettings':!![]}});if(_0x599b5b?.[_0x503c18(0xfd)])try{const _0x32e919=JSON[_0x503c18(0x17b)](_0x599b5b[_0x503c18(0xfd)]);for(const [_0x3cb70c,_0x1c895d]of Object[_0x503c18(0x171)](_0x32e919)){if(_0x3cb70c[_0x503c18(0xfb)]()===_0x335120['gateway']['toLowerCase']()){_0x6ccefc=_0x1c895d[_0x503c18(0x1a0)]||0xa;break;}}}catch(_0x82722b){console[_0x503c18(0x1d3)](_0x503c18(0x1af)+_0x107153+':',_0x82722b);}const _0x51dd7b=_0x563cc1*(0x1-_0x6ccefc/0x64);_0x3eb964=_0x51dd7b,_0x2f2678+=_0x51dd7b,console[_0x503c18(0x16c)](_0x503c18(0xbc)+_0x107153+_0x503c18(0x105)),console[_0x503c18(0x16c)](_0x503c18(0xb8)+_0x563cc1[_0x503c18(0x1b8)](0x6)+'\x20USDT'),console[_0x503c18(0x16c)]('\x20\x20\x20Gateway:\x20'+_0x335120['gateway']+_0x503c18(0x1bf)+_0x6ccefc+'%'),console[_0x503c18(0x16c)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x51dd7b[_0x503c18(0x1b8)](0x6)+_0x503c18(0x1c0)+_0x6ccefc+_0x503c18(0x17f)),console['log']('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x51dd7b[_0x503c18(0x1b8)](0x6)+_0x503c18(0x182));}else{if(_0xe78143===_0x503c18(0x100)&&_0x41db41!==_0x503c18(0x100)){if(_0x335120['amountUSDT']){let _0x3ab7e5=0xa;const _0x135716=await _0x387d23[_0x503c18(0xd7)]['findUnique']({'where':{'id':_0x335120[_0x503c18(0x1c4)]},'select':{'gatewaySettings':!![]}});if(_0x135716?.[_0x503c18(0xfd)])try{const _0x4c2b18=JSON[_0x503c18(0x17b)](_0x135716[_0x503c18(0xfd)]);for(const [_0x5eeb6c,_0x596dd9]of Object[_0x503c18(0x171)](_0x4c2b18)){if(_0x5eeb6c[_0x503c18(0xfb)]()===_0x335120[_0x503c18(0xb4)]['toLowerCase']()){_0x3ab7e5=_0x596dd9['commission']||0xa;break;}}}catch(_0x1ce30d){console[_0x503c18(0x1d3)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x107153+':',_0x1ce30d);}const _0x276f43=_0x335120[_0x503c18(0x19a)]*(0x1-_0x3ab7e5/0x64);_0x3eb964=-_0x276f43,_0x2f2678-=_0x276f43,_0x3f242c[_0x503c18(0x19a)]=null,console[_0x503c18(0x16c)](_0x503c18(0xbc)+_0x107153+_0x503c18(0xe3)),console[_0x503c18(0x16c)](_0x503c18(0xb8)+_0x335120[_0x503c18(0x19a)][_0x503c18(0x1b8)](0x6)+_0x503c18(0x182)),console[_0x503c18(0x16c)](_0x503c18(0x164)+_0x335120[_0x503c18(0xb4)]+',\x20Commission:\x20'+_0x3ab7e5+'%'),console[_0x503c18(0x16c)](_0x503c18(0x14c)+_0x276f43[_0x503c18(0x1b8)](0x6)+'\x20USDT\x20(after\x20'+_0x3ab7e5+'%\x20commission)'),console[_0x503c18(0x16c)](_0x503c18(0x155)+_0x276f43[_0x503c18(0x1b8)](0x6)+'\x20USDT');}}}_0x41db41==='CHARGEBACK'&&(_0xe78143===_0x503c18(0x100)&&_0x335120['amountUSDT']&&console['log']('üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x482f34&&_0x482f34>0x0&&(_0x3eb964-=_0x482f34,_0x2f2678-=_0x482f34,console['log']('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0x482f34[_0x503c18(0x1b8)](0x6)+'\x20USDT\x20from\x20balance')));_0x41db41===_0x503c18(0x129)&&_0xe78143===_0x503c18(0x100)&&console[_0x503c18(0x16c)](_0x503c18(0xff));const _0x274b5d=await _0x387d23[_0x503c18(0xce)][_0x503c18(0x192)]({'where':{'id':_0x107153},'data':_0x3f242c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3eb964!==0x0&&(await _0x387d23[_0x503c18(0xd7)][_0x503c18(0x192)]({'where':{'id':_0x335120[_0x503c18(0x1c4)]},'data':{'balance':_0x2f2678}}),console[_0x503c18(0x16c)](_0x503c18(0x1c9)+_0x335120['shopId']+_0x503c18(0x1bd)+_0x335120[_0x503c18(0xd7)][_0x503c18(0x160)][_0x503c18(0x1b8)](0x6)+_0x503c18(0xe9)+_0x2f2678[_0x503c18(0x1b8)](0x6)+'\x20USDT\x20('+(_0x3eb964>0x0?'+':'')+_0x3eb964[_0x503c18(0x1b8)](0x6)+')')),_0x274b5d;});return{'id':_0xb05562['id'],'shopId':_0xb05562['shopId'],'gateway':_0xb05562['gateway'],'amount':_0xb05562[_0x163011(0x18a)],'currency':_0xb05562[_0x163011(0x1c7)],'status':_0xb05562[_0x163011(0x103)],'orderId':_0xb05562['orderId'],'gatewayOrderId':_0xb05562[_0x163011(0x197)],'customerEmail':_0xb05562[_0x163011(0xec)],'customerName':_0xb05562['customerName'],'customerCountry':_0xb05562[_0x163011(0x1ba)],'customerIp':_0xb05562[_0x163011(0x134)],'customerUa':_0xb05562[_0x163011(0x133)],'failureMessage':_0xb05562['failureMessage'],'adminNotes':_0xb05562[_0x163011(0x14d)],'chargebackAmount':_0xb05562[_0x163011(0x1bb)],'statusChangedBy':_0xb05562[_0x163011(0xdc)],'statusChangedAt':_0xb05562[_0x163011(0x101)],'createdAt':_0xb05562[_0x163011(0xc5)],'updatedAt':_0xb05562[_0x163011(0x1b2)],'shop':_0xb05562[_0x163011(0xd7)]};}async[a35_0x55f94f(0x13f)](_0x2d694c,_0x43e05f){const _0x459deb=a35_0x55f94f,_0x7f64d7={..._0x43e05f};_0x43e05f[_0x459deb(0x188)]&&(_0x7f64d7[_0x459deb(0x188)]=await bcryptjs_1[_0x459deb(0x1ac)][_0x459deb(0x19c)](_0x43e05f[_0x459deb(0x188)],0xc));_0x43e05f[_0x459deb(0x165)]&&(_0x7f64d7['name']=_0x43e05f[_0x459deb(0x165)],delete _0x7f64d7[_0x459deb(0x165)]);_0x43e05f[_0x459deb(0x104)]&&(_0x7f64d7[_0x459deb(0x1ab)]=_0x43e05f[_0x459deb(0x104)],delete _0x7f64d7[_0x459deb(0x104)]);_0x43e05f[_0x459deb(0xf5)]&&(_0x7f64d7[_0x459deb(0x17e)]=_0x43e05f[_0x459deb(0xf5)],delete _0x7f64d7['merchantUrl']);_0x43e05f[_0x459deb(0x17d)]&&(_0x7f64d7[_0x459deb(0x123)]=JSON[_0x459deb(0x189)](_0x43e05f[_0x459deb(0x17d)]),delete _0x7f64d7[_0x459deb(0x17d)]);_0x43e05f['gatewaySettings']&&(_0x7f64d7[_0x459deb(0xfd)]=JSON['stringify'](_0x43e05f[_0x459deb(0xfd)]),delete _0x7f64d7['gatewaySettings']);_0x43e05f[_0x459deb(0xbf)]&&(_0x43e05f[_0x459deb(0xbf)][_0x459deb(0x18e)]!==undefined&&(_0x7f64d7[_0x459deb(0x18e)]=_0x43e05f[_0x459deb(0xbf)][_0x459deb(0x18e)]||null),_0x43e05f[_0x459deb(0xbf)][_0x459deb(0x1bc)]!==undefined&&(_0x7f64d7[_0x459deb(0x1bc)]=_0x43e05f[_0x459deb(0xbf)][_0x459deb(0x1bc)]||null),_0x43e05f[_0x459deb(0xbf)][_0x459deb(0xc1)]!==undefined&&(_0x7f64d7[_0x459deb(0xc1)]=_0x43e05f[_0x459deb(0xbf)][_0x459deb(0xc1)]||null),_0x43e05f[_0x459deb(0xbf)][_0x459deb(0x177)]!==undefined&&(_0x7f64d7[_0x459deb(0x177)]=_0x43e05f[_0x459deb(0xbf)][_0x459deb(0x177)]||null),delete _0x7f64d7[_0x459deb(0xbf)]);const _0x4257a3=await database_1[_0x459deb(0x1ac)][_0x459deb(0xd7)][_0x459deb(0x192)]({'where':{'id':_0x2d694c},'data':_0x7f64d7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4257a3['id'],'fullName':_0x4257a3[_0x459deb(0x196)],'username':_0x4257a3['username'],'telegramId':_0x4257a3[_0x459deb(0x1ab)],'merchantUrl':_0x4257a3['shopUrl'],'gateways':_0x4257a3[_0x459deb(0x123)]?JSON[_0x459deb(0x17b)](_0x4257a3[_0x459deb(0x123)]):null,'gatewaySettings':_0x4257a3['gatewaySettings']?JSON[_0x459deb(0x17b)](_0x4257a3[_0x459deb(0xfd)]):null,'publicKey':_0x4257a3[_0x459deb(0xe5)],'wallets':{'usdtPolygonWallet':_0x4257a3[_0x459deb(0x18e)],'usdtTrcWallet':_0x4257a3[_0x459deb(0x1bc)],'usdtErcWallet':_0x4257a3[_0x459deb(0xc1)],'usdcPolygonWallet':_0x4257a3[_0x459deb(0x177)]},'status':_0x4257a3['status'],'createdAt':_0x4257a3['createdAt']};}async[a35_0x55f94f(0x190)](_0x366683){const _0x3780a6=a35_0x55f94f,_0x57415c=await database_1[_0x3780a6(0x1ac)]['shop']['update']({'where':{'id':_0x366683},'data':{'status':_0x3780a6(0x157)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x57415c['id'],'fullName':_0x57415c[_0x3780a6(0x196)],'username':_0x57415c['username'],'telegramId':_0x57415c[_0x3780a6(0x1ab)],'merchantUrl':_0x57415c[_0x3780a6(0x17e)],'gateways':_0x57415c['paymentGateways']?JSON[_0x3780a6(0x17b)](_0x57415c[_0x3780a6(0x123)]):null,'gatewaySettings':_0x57415c['gatewaySettings']?JSON[_0x3780a6(0x17b)](_0x57415c['gatewaySettings']):null,'publicKey':_0x57415c[_0x3780a6(0xe5)],'wallets':{'usdtPolygonWallet':_0x57415c['usdtPolygonWallet'],'usdtTrcWallet':_0x57415c[_0x3780a6(0x1bc)],'usdtErcWallet':_0x57415c[_0x3780a6(0xc1)],'usdcPolygonWallet':_0x57415c['usdcPolygonWallet']},'status':_0x57415c[_0x3780a6(0x103)],'createdAt':_0x57415c['createdAt']};}async[a35_0x55f94f(0x16b)](_0x2b0b1a){const _0x43eea9=a35_0x55f94f,_0x3b5644=await database_1[_0x43eea9(0x1ac)]['shop'][_0x43eea9(0x192)]({'where':{'id':_0x2b0b1a},'data':{'status':_0x43eea9(0x132)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3b5644['id'],'fullName':_0x3b5644[_0x43eea9(0x196)],'username':_0x3b5644[_0x43eea9(0xee)],'telegramId':_0x3b5644[_0x43eea9(0x1ab)],'merchantUrl':_0x3b5644[_0x43eea9(0x17e)],'gateways':_0x3b5644['paymentGateways']?JSON[_0x43eea9(0x17b)](_0x3b5644[_0x43eea9(0x123)]):null,'gatewaySettings':_0x3b5644[_0x43eea9(0xfd)]?JSON[_0x43eea9(0x17b)](_0x3b5644[_0x43eea9(0xfd)]):null,'publicKey':_0x3b5644[_0x43eea9(0xe5)],'wallets':{'usdtPolygonWallet':_0x3b5644['usdtPolygonWallet'],'usdtTrcWallet':_0x3b5644[_0x43eea9(0x1bc)],'usdtErcWallet':_0x3b5644['usdtErcWallet'],'usdcPolygonWallet':_0x3b5644[_0x43eea9(0x177)]},'status':_0x3b5644['status'],'createdAt':_0x3b5644[_0x43eea9(0xc5)]};}async[a35_0x55f94f(0x16a)](_0x429ca5){const _0x125815=a35_0x55f94f,{page:_0x322e67,limit:_0x43cc78,status:_0x56a4c3}=_0x429ca5,_0x3d4c92=(_0x322e67-0x1)*_0x43cc78,_0x3e60c1={};_0x56a4c3&&(_0x3e60c1[_0x125815(0x103)]=_0x56a4c3[_0x125815(0xc0)]());const [_0x3182f4,_0x13ebd3]=await Promise[_0x125815(0x117)]([database_1[_0x125815(0x1ac)][_0x125815(0xd7)]['findMany']({'where':_0x3e60c1,'skip':_0x3d4c92,'take':_0x43cc78,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x125815(0x1ac)][_0x125815(0xd7)][_0x125815(0x10d)]({'where':_0x3e60c1})]);return{'users':_0x3182f4['map'](_0x2543c3=>({'id':_0x2543c3['id'],'fullName':_0x2543c3[_0x125815(0x196)],'username':_0x2543c3[_0x125815(0xee)],'telegramId':_0x2543c3['telegram'],'merchantUrl':_0x2543c3[_0x125815(0x17e)],'gateways':_0x2543c3[_0x125815(0x123)]?JSON[_0x125815(0x17b)](_0x2543c3['paymentGateways']):null,'gatewaySettings':_0x2543c3['gatewaySettings']?JSON[_0x125815(0x17b)](_0x2543c3[_0x125815(0xfd)]):null,'publicKey':_0x2543c3[_0x125815(0xe5)],'wallets':{'usdtPolygonWallet':_0x2543c3[_0x125815(0x18e)],'usdtTrcWallet':_0x2543c3[_0x125815(0x1bc)],'usdtErcWallet':_0x2543c3['usdtErcWallet'],'usdcPolygonWallet':_0x2543c3['usdcPolygonWallet']},'status':_0x2543c3['status'],'createdAt':_0x2543c3[_0x125815(0xc5)]})),'pagination':{'page':_0x322e67,'limit':_0x43cc78,'total':_0x13ebd3,'totalPages':Math[_0x125815(0x1cb)](_0x13ebd3/_0x43cc78)}};}async[a35_0x55f94f(0x1b4)](_0x4c12c3){const _0x1d01f5=a35_0x55f94f,_0x5e85b3=await database_1[_0x1d01f5(0x1ac)][_0x1d01f5(0xd7)]['findUnique']({'where':{'id':_0x4c12c3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5e85b3)return null;return{'id':_0x5e85b3['id'],'fullName':_0x5e85b3[_0x1d01f5(0x196)],'username':_0x5e85b3[_0x1d01f5(0xee)],'telegramId':_0x5e85b3[_0x1d01f5(0x1ab)],'merchantUrl':_0x5e85b3['shopUrl'],'gateways':_0x5e85b3[_0x1d01f5(0x123)]?JSON[_0x1d01f5(0x17b)](_0x5e85b3['paymentGateways']):null,'gatewaySettings':_0x5e85b3[_0x1d01f5(0xfd)]?JSON[_0x1d01f5(0x17b)](_0x5e85b3[_0x1d01f5(0xfd)]):null,'publicKey':_0x5e85b3[_0x1d01f5(0xe5)],'wallets':{'usdtPolygonWallet':_0x5e85b3['usdtPolygonWallet'],'usdtTrcWallet':_0x5e85b3[_0x1d01f5(0x1bc)],'usdtErcWallet':_0x5e85b3[_0x1d01f5(0xc1)],'usdcPolygonWallet':_0x5e85b3[_0x1d01f5(0x177)]},'status':_0x5e85b3['status'],'createdAt':_0x5e85b3[_0x1d01f5(0xc5)]};}async[a35_0x55f94f(0x10a)](_0x682058){const _0x2b31de=a35_0x55f94f,{fullName:_0x83ecec,username:_0x37ee7d,password:_0xe76c18,telegramId:_0x267e62,merchantUrl:_0xbbc07f,gateways:_0x4e7a75,gatewaySettings:_0x30542b,wallets:_0x924fdc}=_0x682058,_0x241f84=await database_1[_0x2b31de(0x1ac)][_0x2b31de(0xd7)]['findUnique']({'where':{'username':_0x37ee7d}});if(_0x241f84)throw new Error(_0x2b31de(0x121));if(_0x267e62){const _0x48f840=await database_1[_0x2b31de(0x1ac)][_0x2b31de(0xd7)][_0x2b31de(0x137)]({'where':{'telegram':_0x267e62}});if(_0x48f840)throw new Error(_0x2b31de(0x168));}const _0x7a8c2e=await bcryptjs_1[_0x2b31de(0x1ac)][_0x2b31de(0x19c)](_0xe76c18,0xc),_0x1b5abd=_0x2b31de(0x149)+crypto_1[_0x2b31de(0x1ac)][_0x2b31de(0x1d6)](0x20)['toString'](_0x2b31de(0x18c)),_0x5ea905='sk_'+crypto_1['default'][_0x2b31de(0x1d6)](0x20)[_0x2b31de(0x1b6)]('hex'),_0x46ff56=await database_1[_0x2b31de(0x1ac)][_0x2b31de(0xd7)][_0x2b31de(0x118)]({'data':{'name':_0x83ecec,'username':_0x37ee7d,'password':_0x7a8c2e,'telegram':_0x267e62,'shopUrl':_0xbbc07f,'paymentGateways':_0x4e7a75?JSON[_0x2b31de(0x189)](_0x4e7a75):null,'gatewaySettings':_0x30542b?JSON[_0x2b31de(0x189)](_0x30542b):null,'usdtPolygonWallet':_0x924fdc?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x924fdc?.[_0x2b31de(0x1bc)]||null,'usdtErcWallet':_0x924fdc?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x924fdc?.[_0x2b31de(0x177)]||null,'publicKey':_0x1b5abd,'secretKey':_0x5ea905,'status':_0x2b31de(0x132)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x46ff56['id'],'fullName':_0x46ff56[_0x2b31de(0x196)],'username':_0x46ff56[_0x2b31de(0xee)],'telegramId':_0x46ff56[_0x2b31de(0x1ab)],'merchantUrl':_0x46ff56[_0x2b31de(0x17e)],'gateways':_0x46ff56[_0x2b31de(0x123)]?JSON[_0x2b31de(0x17b)](_0x46ff56[_0x2b31de(0x123)]):null,'gatewaySettings':_0x46ff56[_0x2b31de(0xfd)]?JSON[_0x2b31de(0x17b)](_0x46ff56[_0x2b31de(0xfd)]):null,'publicKey':_0x46ff56[_0x2b31de(0xe5)],'wallets':{'usdtPolygonWallet':_0x46ff56[_0x2b31de(0x18e)],'usdtTrcWallet':_0x46ff56[_0x2b31de(0x1bc)],'usdtErcWallet':_0x46ff56[_0x2b31de(0xc1)],'usdcPolygonWallet':_0x46ff56['usdcPolygonWallet']},'status':_0x46ff56[_0x2b31de(0x103)],'createdAt':_0x46ff56['createdAt']};}async['deleteUser'](_0x5d0f2c){const _0x414371=a35_0x55f94f;await database_1[_0x414371(0x1ac)]['shop'][_0x414371(0x131)]({'where':{'id':_0x5d0f2c}});}[a35_0x55f94f(0xb7)](_0x1a8280,_0x5da9d3,_0x2d16c6){const _0x4552b3=a35_0x55f94f,_0x2d20e2=new Map(),_0x25454a=new Date(_0x5da9d3);while(_0x25454a<=_0x2d16c6){const _0x2539ae=_0x25454a[_0x4552b3(0x1c5)]()[_0x4552b3(0x1d2)]('T')[0x0];_0x2d20e2[_0x4552b3(0x11b)](_0x2539ae,{'revenue':0x0,'count':0x0}),_0x25454a['setDate'](_0x25454a[_0x4552b3(0x142)]()+0x1);}for(const _0x26e440 of _0x1a8280){const _0x10b5c5=_0x26e440[_0x4552b3(0xc5)][_0x4552b3(0x1c5)]()[_0x4552b3(0x1d2)]('T')[0x0],_0x50c2cf=_0x2d20e2[_0x4552b3(0x128)](_0x10b5c5);_0x50c2cf&&(_0x50c2cf['count']+=0x1,_0x26e440['status']==='PAID'&&(_0x26e440[_0x4552b3(0x19a)]?_0x50c2cf[_0x4552b3(0x193)]+=_0x26e440['amountUSDT']:console[_0x4552b3(0x16c)](_0x4552b3(0x1a5)+_0x26e440['id']+_0x4552b3(0x109))));}const _0x4702e1=[],_0x5826e0=[];for(const [_0x56c14f,_0x3405a5]of _0x2d20e2){_0x4702e1[_0x4552b3(0xcc)]({'date':_0x56c14f,'amount':Math['round'](_0x3405a5[_0x4552b3(0x193)]*0x64)/0x64}),_0x5826e0[_0x4552b3(0xcc)]({'date':_0x56c14f,'count':_0x3405a5['count']});}return{'dailyRevenue':_0x4702e1,'dailyPayments':_0x5826e0};}}exports['AdminService']=AdminService;