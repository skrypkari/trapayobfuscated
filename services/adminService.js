'use strict';const a48_0xb1fe34=a48_0xa52a;(function(_0x33df9f,_0x183ac9){const _0x30c560=a48_0xa52a,_0x4d4912=_0x33df9f();while(!![]){try{const _0xcab204=-parseInt(_0x30c560(0x9f))/0x1*(parseInt(_0x30c560(0x1b7))/0x2)+parseInt(_0x30c560(0x10a))/0x3+parseInt(_0x30c560(0x1af))/0x4+-parseInt(_0x30c560(0x110))/0x5*(-parseInt(_0x30c560(0x1c1))/0x6)+parseInt(_0x30c560(0xa7))/0x7+-parseInt(_0x30c560(0x255))/0x8+parseInt(_0x30c560(0x1ca))/0x9*(-parseInt(_0x30c560(0xe7))/0xa);if(_0xcab204===_0x183ac9)break;else _0x4d4912['push'](_0x4d4912['shift']());}catch(_0x31ad6e){_0x4d4912['push'](_0x4d4912['shift']());}}}(a48_0x4ed2,0xbe7cd));function a48_0x4ed2(){const _0x454772=['totp','chargebackAmount','config','\x20\x20\x20Amount\x20difference:\x20','üìä\x20Gateway\x20filter\x20applied:','InstaXchange','\x20backup\x20codes','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','üìä\x20Sorting\x20payments\x20by\x20','disableAdmin2FA','availableBalance','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','getUTCDay','üìä\x20Getting\x20payout\x20reports\x20with\x20filters:','currencyService','aggregate','Payout\x20not\x20found','UTC','join','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','backupCodes','getUserById','%\x20commission)','\x20\x20\x20Difference:\x20','setUTCDate','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','base32','updatePayout','\x20\x20\x20Merchant\x20gets:\x20','TrapaPay','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','üìä\x20Getting\x20payments\x20with\x20filters:','count','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','Error\x20parsing\x20backup\x20codes:','COMPLETED','\x20\x20\x20Added\x20to\x20balance:\x20+','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','PENDING','\x20-\x20','txid','gatewayOrderId','findUnique','wallet','sort','Username\x20already\x20exists','getAllPayments','substr','bcryptjs','pendingUrl','klyme_de','updatedAt','merchantId','toLowerCase','KLYME\x20EU','slice','üìä\x20Statistics\x20PAID\x20payments\x20count:\x20','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','setup2FA','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','startsWith','plisio','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','split','cointopay','random','totalPayout','.env','passwordHash','revenue','\x20USDT\x20(gross\x20revenue)',',\x20successful:\x20','\x20\x20\x20New\x20amount:\x20','\x20\x20\x20Balance:\x20','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','not\x20specified','\x20PAID\x20payments','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','üí∞\x20[PAYOUT]\x20Gateway\x20','twoFactorSecret','\x27\x20to\x20name\x20\x27','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','2213404pXEePA','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','toISOString','AmPay\x20TRY','getAllUsers','REFUND','shopId','dateTo','1406zKHhUv','_count','dailyRevenue','\x20\x20\x20üåç\x20Country:\x20','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','ADMIN_2FA_ENABLED=true','üí∞\x20Current\x20shop\x20balance:\x20','mastercard','\x20USDT\x20(theoretical\x20net)',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','690RbJJVQ','balance','__importDefault','splice','../config/config','enable2FA','üîê\x202FA\x20disabled\x20for\x20shop:\x20','üìä\x20Generated\x20reports\x20for\x20','üîê\x20Admin\x202FA\x20setup\x20initiated','109863pOEJcG','üí±\x20Currency\x20filter\x20applied:\x20','setDate','setupAdmin2FA','paymentGateways','push','erc20_usdc','\x27\x20->\x20name\x20\x27','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','error','asc','deletePayout','convertToUSDT','totalAmount','averageCommissionRate','username','getUTCMonth','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','cwd','getUTCFullYear','turnoverUSDT','getGatewayIdByName','insensitive','\x20paid\x20payments\x20for\x20gateway\x20','payouts','\x20USDT)','log','adminNotes','parse','lastLoginAt','\x20\x20\x20Current\x20amount:\x20','toLocaleDateString',',\x20chargebacks:\x20','\x20\x20\x20Available\x20(number):\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','ADMIN_PASSWORD_HASH=','telegramId','from','toFixed','getGatewayDisplayName','\x20->\x20','includes','üîç\x20Shop\x20wallets:','noda','existsSync','getSystemStatistics','0000','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','disable2FA','date','successUrl','\x20USDT,\x20Required:\x20','values','pk_','üéØ\x20[','hash','\x20\x20\x20Transaction\x20hash:\x20','changeAdminPassword','CHARGEBACK','amount','Insufficient\x20balance.\x20Available:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','Telegram\x20username\x20already\x20exists','merchantEarningsUSDT','getUTCDate','all_time','2FA\x20is\x20already\x20enabled','readFileSync','cointopay2','forEach','floor','toUpperCase','customerCountry','getShopWallets','shop','usdtPolygonWallet','test_gateway','customerName','filter','\x20USDT\x20(after\x20','\x20\x20\x20Full\x20amount:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20\x20\x20Payout\x20amount:\x20','üîç\x20Total\x20payments\x20matching\x20filters:\x20','totalCommissionRate','\x20for\x20shop\x20','SUSPENDED','get','\x20became\x20PAID:','getMerchantsSelection','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','whiteUrl','stringify','usdcErcWallet','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','toString','gateways','‚ö†Ô∏è\x20Payment\x20','üîÑ\x20Admin\x20updating\x20payment\x20','\x20\x20\x20Merchant\x20loses:\x20','yesterday','createUser','_sum','telegramUsers','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','‚ö†Ô∏è\x20Gateway\x20\x27','toDataURL','orderId','week','Payment\x20not\x20found','shopUrl','OnRamp','round','üîç\x20Balance\x20check\x20details:','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','üìÖ\x20Date\x20from\x20filter:\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','statusChangedAt','klyme_gb','failureMessage','\x20\x20\x20Current\x20network:\x20','Rapyd','network','month','üí∞\x20Shop\x20','__esModule','Current\x20password\x20is\x20incorrect',',\x20Commission:\x20','\x20order','lte','Test\x20Gateway','usdtTrcWallet','polygon_usdc','enableAdmin2FA','7852264ITEpdB','commission','\x20USDT\x20(current\x20balance\x20in\x20DB)','default','ADMIN_2FA_ENABLED=','length','üîê\x20Admin\x202FA\x20enabled','customerUa','paymentsCount','AmPay','localeCompare','\x20\x20\x20Amount\x20decreased\x20by\x20','‚úÖ\x20Payout\x20created\x20in\x20DB:','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','create','ACTIVE','amountUSDT','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','name','ADMIN_BACKUP_CODES=','gatewayCommissionRate','üìä\x20Available\x20gateways\x20in\x20database:','thisMonth','getPaymentById','881lNWpDf','totalAmountUSDT','Noda','üìä\x20Calculating\x20payout\x20statistics...','\x20\x20\x20Tolerance:\x20','set','üîå\x20Gateway:\x20','USDT','1951999qhppWQ','üí∞\x20[PAYOUT]\x20Merchant\x20','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','some','\x20balance\x20updated:\x20','üîß\x20[','not\x20provided','getGatewayInternalName','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','payout','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','all','notes','\x20\x20\x20üìÖ\x20This\x20month:\x20','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','%\x20from\x20','‚úÖ\x20Payout\x20','randomBytes','paidOutUSDT','createdAt','2020-01-01','KLYME\x20GB','sk_','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20\x20\x20Available\x20(raw):\x20','paidAt','ADMIN_2FA_SECRET=','\x20in\x20','reduce','getDate','SquirrelPay','totalAmountAfterCommissionUSDT','admin','averageCheckUSDT','dateFrom','üîë\x20Generated\x20','\x20\x20\x20Gateway:\x20','last_week','OxaPay','min','PAID','fullName','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','./telegramBotService','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','üìä\x20Final\x20WHERE\x20conditions:','map','suspendUser','Invalid\x202FA\x20token\x20or\x20backup\x20code','getGatewayNameById','\x20USDT\x20(','\x27\x20->\x20ID\x20\x27','custom','custom_','\x20USDT','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20üí≥\x20Total\x20payments:\x20','totalPaidOut','2FA\x20token\x20is\x20required','\x20\x20\x20üåê\x20IP:\x20','defineProperty','updatePaymentStatus','70HRBmui','qrcode','./currencyService','\x20with\x20payout\x20history','üí∞\x20Updating\x20payout\x20','MasterCard','publicKey','CoinToPay2','\x20USDT,\x20Requested:\x20','generateDailyStatistics','\x20status:\x20','$transaction','üí∞\x20Found\x20','Error\x20processing\x20payment\x20','utf8','gte','ceil','findMany','generateSecret','‚úÖ\x20Payout\x20created:\x20','\x20updated\x20successfully','üîç\x20Selected\x20polygon\x20wallet:\x20','üìä\x20Statistics\x20WHERE\x20conditions:','merchantEarnings','üí∞\x20Creating\x20payout\x20for\x20shop\x20','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','last_month','writeFileSync','telegram','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','ru-RU','\x20\x20\x20Requested\x20(number):\x20','customerEmail','usdcPolygonWallet','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','2598807IXPXnD','\x20\x20\x20Shop\x20balance:\x20','setHours','Amer','Visa/MasterCard','MaxPara','33395YJeJti','\x20USDT\x20from\x20balance','entries','update','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','deleteUser','AdminService','get2FASettings','wallets','MyXSpend','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','usdtErcWallet','\x20to\x20','customerIp',']\x20Gateway\x20settings\x20before\x20saving:','trim','üîÑ\x20Gateway\x20mapping\x20(get):','today',']\x20Updating\x20password\x20for\x20user\x20','desc','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','trc20','Shop\x20not\x20found','periodTo','twoFactorEnabled','password',',\x20refunds:\x20','getTime','merchantUrl','Invalid\x202FA\x20token','status','this_month','\x20merchants','üîê\x20Admin\x202FA\x20disabled','period','üí≥\x20Final\x20payout\x20wallet\x20for\x20','üîç\x20Initial\x20wallet\x20from\x20request:\x20','üîç\x20Using\x20gateway\x20\x27','getFullYear','üîç\x20Selected\x20erc20\x20wallet:\x20','verify','not\x20set','üîÑ\x20Gateway\x20mapping\x20(create):','TrapaPay\x20Admin\x20(','totalPayments','currency','path','compare','getMonth','gateway','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20\x20\x20Shop\x20totalPaidOut:\x20','\x20USDT,\x20merchant:\x20','ADMIN_2FA_ENABLED=false','getPayoutReports','üí∞\x20Payment\x20','turnover','delete','hex','amountAfterGatewayCommissionUSDT','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','periodFrom','otpauth_url','gatewaySettings','üìÖ\x20Period:\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20paid\x20payments\x20for\x20analysis','Interac','KLYME\x20DE','commissionUSDT','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','payment','erc20','üìä\x20Payout\x20statistics\x20calculated:','amountAfterCommissionUSDT','gatewayEarnings'];a48_0x4ed2=function(){return _0x454772;};return a48_0x4ed2();}var __importDefault=this&&this[a48_0xb1fe34(0x1c3)]||function(_0x3a9532){const _0x42dd50=a48_0xb1fe34;return _0x3a9532&&_0x3a9532[_0x42dd50(0x24c)]?_0x3a9532:{'default':_0x3a9532};};Object[a48_0xb1fe34(0xe5)](exports,a48_0xb1fe34(0x24c),{'value':!![]}),exports[a48_0xb1fe34(0x116)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a48_0xb1fe34(0x18d))),crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0xb1fe34(0x13e))),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a48_0xb1fe34(0xe8))),config_1=require(a48_0xb1fe34(0x1c5)),currencyService_1=require(a48_0xb1fe34(0xe9)),telegramBotService_1=require(a48_0xb1fe34(0xd2)),gateway_1=require('../types/gateway');function a48_0xa52a(_0x45ee1f,_0x6151b5){_0x45ee1f=_0x45ee1f-0x91;const _0x4ed283=a48_0x4ed2();let _0xa52a56=_0x4ed283[_0x45ee1f];return _0xa52a56;}class AdminService{async['getPayoutStats'](){const _0x51d386=a48_0xb1fe34;console[_0x51d386(0x1e4)](_0x51d386(0xa2));const _0x35784f=await database_1['default']['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x5f013c=await database_1['default'][_0x51d386(0x157)][_0x51d386(0x17c)]({'where':{'status':_0x51d386(0xcf),'gateway':{'not':_0x51d386(0x217)}}}),_0x15163b=new Date(),_0x205e82=new Date(_0x15163b[_0x51d386(0x136)](),_0x15163b[_0x51d386(0x140)](),0x1),_0x29d173=new Date(_0x15163b['getFullYear'](),_0x15163b[_0x51d386(0x140)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5e8110=await database_1[_0x51d386(0x258)]['payout'][_0x51d386(0x16b)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x205e82,'lte':_0x29d173},'status':_0x51d386(0x180)}}),_0x5024eb=_0x35784f[_0x51d386(0x233)][_0x51d386(0xe2)]||0x0,_0x397d57=_0x35784f[_0x51d386(0x233)][_0x51d386(0x1c2)]||0x0,_0x9a960b=_0x5e8110[_0x51d386(0x233)][_0x51d386(0x205)]||0x0,_0x4be135={'totalPayout':Math['round'](_0x5024eb*0x64)/0x64,'awaitingPayout':Math['round'](_0x397d57*0x64)/0x64,'thisMonth':Math['round'](_0x9a960b*0x64)/0x64,'availableBalance':Math[_0x51d386(0x23e)](_0x397d57*0x64)/0x64,'totalPayments':_0x5f013c};return console[_0x51d386(0x1e4)](_0x51d386(0x159)),console[_0x51d386(0x1e4)](_0x51d386(0x242)+_0x4be135[_0x51d386(0x19f)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x51d386(0x1e4)](_0x51d386(0x236)+_0x4be135['awaitingPayout']+_0x51d386(0x16f)),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x4be135[_0x51d386(0x166)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x51d386(0xb4)+_0x4be135[_0x51d386(0x9d)]+_0x51d386(0xde)),console[_0x51d386(0x1e4)](_0x51d386(0xe1)+_0x4be135[_0x51d386(0x13c)]+_0x51d386(0x1a9)),_0x4be135;}async['updateCustomerData'](_0x1ce969,_0xfd2d4f){const _0xba8e5b=a48_0xb1fe34;console['log'](_0xba8e5b(0x11a)+_0x1ce969+':',_0xfd2d4f);const _0x459d9f=await database_1[_0xba8e5b(0x258)]['payment']['findUnique']({'where':{'id':_0x1ce969},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x459d9f)throw new Error(_0xba8e5b(0x23b));const _0x53ee0c={};_0xfd2d4f['customerCountry']!==undefined&&(_0x53ee0c[_0xba8e5b(0x213)]=_0xfd2d4f['customerCountry']||null);_0xfd2d4f[_0xba8e5b(0x11d)]!==undefined&&(_0x53ee0c['customerIp']=_0xfd2d4f['customerIp']||null);_0xfd2d4f[_0xba8e5b(0x25c)]!==undefined&&(_0x53ee0c[_0xba8e5b(0x25c)]=_0xfd2d4f[_0xba8e5b(0x25c)]||null);const _0x393cd0=await database_1[_0xba8e5b(0x258)][_0xba8e5b(0x157)]['update']({'where':{'id':_0x1ce969},'data':{..._0x53ee0c,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xba8e5b(0x1e4)](_0xba8e5b(0x1aa)+_0x1ce969),console[_0xba8e5b(0x1e4)](_0xba8e5b(0x1ba)+_0x459d9f['customerCountry']+'\x20->\x20'+_0x393cd0[_0xba8e5b(0x213)]),console[_0xba8e5b(0x1e4)](_0xba8e5b(0xe4)+_0x459d9f['customerIp']+'\x20->\x20'+_0x393cd0[_0xba8e5b(0x11d)]),console[_0xba8e5b(0x1e4)](_0xba8e5b(0xd1)+(_0x459d9f[_0xba8e5b(0x25c)]?_0xba8e5b(0xa4):_0xba8e5b(0x139))+_0xba8e5b(0x1f2)+(_0x393cd0[_0xba8e5b(0x25c)]?'set':'not\x20set')),_0x393cd0;}async[a48_0xb1fe34(0x1f7)](_0x5b18fd,_0x59f7bc){const _0x56ac40=a48_0xb1fe34,_0x4d91e7=_0x59f7bc?new Date(_0x59f7bc):new Date();let _0x10f47e,_0x81d1e2;if(_0x5b18fd['startsWith'](_0x56ac40(0xdd))){const _0x5a862c=_0x5b18fd['replace'](_0x56ac40(0xdd),'')['split']('_');if(_0x5a862c[_0x56ac40(0x25a)]===0x2){const _0x5db1fe=new Date(_0x5a862c[0x0]),_0x462735=new Date(_0x5a862c[0x1]);_0x10f47e=new Date(Date[_0x56ac40(0x16d)](_0x5db1fe['getUTCFullYear'](),_0x5db1fe[_0x56ac40(0x1da)](),_0x5db1fe[_0x56ac40(0x20b)](),0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x462735['getUTCFullYear'](),_0x462735[_0x56ac40(0x1da)](),_0x462735['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x53e8f5=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7[_0x56ac40(0x20b)]()-0x1e));_0x10f47e=new Date(Date[_0x56ac40(0x16d)](_0x53e8f5[_0x56ac40(0x1dd)](),_0x53e8f5[_0x56ac40(0x1da)](),_0x53e8f5['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7[_0x56ac40(0x20b)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x5b18fd['toLowerCase']()){case _0x56ac40(0x121):_0x10f47e=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7['getUTCFullYear'](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7[_0x56ac40(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case _0x56ac40(0x231):const _0x11f700=new Date(_0x4d91e7);_0x11f700[_0x56ac40(0x174)](_0x11f700[_0x56ac40(0x20b)]()-0x1),_0x10f47e=new Date(Date['UTC'](_0x11f700[_0x56ac40(0x1dd)](),_0x11f700['getUTCMonth'](),_0x11f700[_0x56ac40(0x20b)](),0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x11f700[_0x56ac40(0x1dd)](),_0x11f700['getUTCMonth'](),_0x11f700[_0x56ac40(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x4411bd=_0x4d91e7[_0x56ac40(0x168)](),_0x48d317=_0x4411bd===0x0?-0x6:0x1-_0x4411bd,_0x1b22bd=_0x4d91e7[_0x56ac40(0x20b)]()+_0x48d317;_0x10f47e=new Date(Date['UTC'](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7['getUTCMonth'](),_0x1b22bd,0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7[_0x56ac40(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case _0x56ac40(0xcc):const _0x24c0e3=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7[_0x56ac40(0x20b)]()-0x7)),_0xa6ce7=_0x24c0e3['getUTCDay'](),_0x1e64d3=_0xa6ce7===0x0?-0x6:0x1-_0xa6ce7,_0x4ae8c2=_0x24c0e3[_0x56ac40(0x20b)]()+_0x1e64d3;_0x10f47e=new Date(Date['UTC'](_0x24c0e3[_0x56ac40(0x1dd)](),_0x24c0e3[_0x56ac40(0x1da)](),_0x4ae8c2,0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x24c0e3['getUTCFullYear'](),_0x24c0e3[_0x56ac40(0x1da)](),_0x4ae8c2+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x56ac40(0x12f):_0x10f47e=new Date(Date['UTC'](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),0x1,0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7['getUTCMonth'](),_0x4d91e7[_0x56ac40(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case _0x56ac40(0x101):_0x10f47e=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x56ac40(0x20c):_0x10f47e=new Date(Date[_0x56ac40(0x16d)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7['getUTCFullYear'](),_0x4d91e7['getUTCMonth'](),_0x4d91e7[_0x56ac40(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x10f47e=new Date(_0x4d91e7['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x1b8048=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7[_0x56ac40(0x20b)]()-0x1e));_0x10f47e=new Date(Date[_0x56ac40(0x16d)](_0x1b8048['getUTCFullYear'](),_0x1b8048[_0x56ac40(0x1da)](),_0x1b8048[_0x56ac40(0x20b)](),0x0,0x0,0x0,0x0)),_0x81d1e2=new Date(Date[_0x56ac40(0x16d)](_0x4d91e7[_0x56ac40(0x1dd)](),_0x4d91e7[_0x56ac40(0x1da)](),_0x4d91e7[_0x56ac40(0x20b)](),0x17,0x3b,0x3b,0x3e7));}const _0x3ba8da={'gte':_0x10f47e,'lte':_0x81d1e2};console['log']('üìä\x20Statistics\x20date\x20range:\x20'+_0x10f47e[_0x56ac40(0x1b1)]()+_0x56ac40(0x11c)+_0x81d1e2[_0x56ac40(0x1b1)]());const [_0x9294c,_0x2ede55,_0x4c79ce,_0x16dfb5,_0xd9ffeb,_0x5e6b7c,_0x20a98c,_0x2e7e72,_0x4d9856]=await Promise[_0x56ac40(0xb2)]([database_1[_0x56ac40(0x258)][_0x56ac40(0x215)][_0x56ac40(0x17c)](),database_1[_0x56ac40(0x258)][_0x56ac40(0x215)][_0x56ac40(0x17c)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x56ac40(0x157)][_0x56ac40(0x17c)]({'where':{'status':_0x56ac40(0xcf),'createdAt':_0x3ba8da,'gateway':{'not':_0x56ac40(0x217)}}}),database_1[_0x56ac40(0x258)]['payment'][_0x56ac40(0x17c)]({'where':{'status':_0x56ac40(0x204),'createdAt':_0x3ba8da,'gateway':{'not':_0x56ac40(0x217)}}}),database_1[_0x56ac40(0x258)]['payment'][_0x56ac40(0x17c)]({'where':{'status':'REFUND','createdAt':_0x3ba8da,'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x56ac40(0x157)][_0x56ac40(0xf8)]({'where':{'status':_0x56ac40(0xcf),'createdAt':_0x3ba8da,'gateway':{'not':_0x56ac40(0x217)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x56ac40(0x258)][_0x56ac40(0x157)][_0x56ac40(0xf8)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x56ac40(0x123)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x56ac40(0x258)][_0x56ac40(0x157)]['findMany']({'where':{'createdAt':_0x3ba8da,'gateway':{'not':_0x56ac40(0x217)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x56ac40(0x258)][_0x56ac40(0x157)]['findMany']({'where':{'status':'PAID','gateway':{'not':_0x56ac40(0x217)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x56ac40(0x1e4)](_0x56ac40(0x195)+_0x4c79ce);let _0x15a99d=0x0,_0x4c1ef1=0x0;for(const _0x1447ab of _0x5e6b7c){const _0x492eca=_0x1447ab[_0x56ac40(0x97)]||0x0;_0x15a99d+=_0x492eca;if(_0x1447ab[_0x56ac40(0x14b)]&&_0x1447ab[_0x56ac40(0x97)]){const _0xc625cb=_0x1447ab[_0x56ac40(0x97)]-_0x1447ab['amountAfterGatewayCommissionUSDT'];_0x4c1ef1+=_0xc625cb;}}let _0x476517=0x0;for(const _0x306cba of _0x4d9856){if(_0x306cba['amountAfterGatewayCommissionUSDT']&&_0x306cba[_0x56ac40(0x97)]){const _0x5efd04=_0x306cba['amountUSDT']-_0x306cba[_0x56ac40(0x14b)];_0x476517+=_0x5efd04;}}const _0x29b823=_0x4c79ce>0x0?_0x15a99d/_0x4c79ce:0x0,_0x4202a5=this[_0x56ac40(0xf0)](_0x2e7e72,_0x10f47e,_0x81d1e2),_0x336f71=await database_1[_0x56ac40(0x258)][_0x56ac40(0x157)][_0x56ac40(0x17c)]({'where':{'createdAt':_0x3ba8da,'gateway':{'not':_0x56ac40(0x217)},'status':{'notIn':[_0x56ac40(0x183),'EXPIRED']}}}),_0x3e1676=_0x336f71>0x0?_0x4c79ce/_0x336f71*0x64:0x0;return{'totalShops':_0x9294c,'activeShops':_0x2ede55,'totalPayments':_0x336f71,'successfulPayments':_0x4c79ce,'totalAttempts':_0x336f71,'chargebacks':_0x16dfb5,'refunds':_0xd9ffeb,'totalRevenue':Math[_0x56ac40(0x23e)](_0x15a99d*0x64)/0x64,'trapayEarnings':Math['round'](_0x4c1ef1*0x64)/0x64,'trapayEarningsAllTime':Math[_0x56ac40(0x23e)](_0x476517*0x64)/0x64,'averagePaymentAmount':Math[_0x56ac40(0x23e)](_0x29b823*0x64)/0x64,'conversionRate':Math[_0x56ac40(0x23e)](_0x3e1676*0x64)/0x64,'dailyRevenue':_0x4202a5[_0x56ac40(0x1b9)],'dailyPayments':_0x4202a5['dailyPayments'],'recentPayments':_0x20a98c[_0x56ac40(0xd6)](_0x5051ca=>({'id':_0x5051ca['id'],'amount':_0x5051ca[_0x56ac40(0x205)],'currency':_0x5051ca[_0x56ac40(0x13d)],'status':_0x5051ca[_0x56ac40(0x12e)],'gateway':_0x5051ca[_0x56ac40(0x141)],'shop':_0x5051ca[_0x56ac40(0x215)],'createdAt':_0x5051ca[_0x56ac40(0xba)]}))};}}async['getMerchantStatistics'](_0x39efc2){const _0x37f2e2=a48_0xb1fe34;console['log']('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x39efc2);let _0x3a85e6,_0x172c8a=new Date();if(_0x39efc2[_0x37f2e2(0x132)]===_0x37f2e2(0xdc)&&_0x39efc2[_0x37f2e2(0xc9)]&&_0x39efc2[_0x37f2e2(0x1b6)]){const _0x253a89=new Date(_0x39efc2['dateFrom']),_0xacabd9=new Date(_0x39efc2[_0x37f2e2(0x1b6)]);_0x3a85e6=new Date(Date[_0x37f2e2(0x16d)](_0x253a89[_0x37f2e2(0x1dd)](),_0x253a89[_0x37f2e2(0x1da)](),_0x253a89[_0x37f2e2(0x20b)](),0x0,0x0,0x0,0x0)),_0x172c8a=new Date(Date[_0x37f2e2(0x16d)](_0xacabd9[_0x37f2e2(0x1dd)](),_0xacabd9[_0x37f2e2(0x1da)](),_0xacabd9[_0x37f2e2(0x20b)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x51666b=new Date();switch(_0x39efc2[_0x37f2e2(0x132)]){case _0x37f2e2(0x23a):_0x3a85e6=new Date(_0x51666b[_0x37f2e2(0x12b)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x3a85e6[_0x37f2e2(0x10c)](0x0,0x0,0x0,0x0),_0x172c8a['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x37f2e2(0x24a):_0x3a85e6=new Date(Date[_0x37f2e2(0x16d)](_0x51666b[_0x37f2e2(0x1dd)](),_0x51666b[_0x37f2e2(0x1da)](),0x1,0x0,0x0,0x0,0x0)),_0x172c8a=new Date(Date[_0x37f2e2(0x16d)](_0x51666b[_0x37f2e2(0x1dd)](),_0x51666b[_0x37f2e2(0x1da)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case'lastMonth':_0x3a85e6=new Date(Date[_0x37f2e2(0x16d)](_0x51666b['getUTCFullYear'](),_0x51666b[_0x37f2e2(0x1da)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x172c8a=new Date(Date[_0x37f2e2(0x16d)](_0x51666b[_0x37f2e2(0x1dd)](),_0x51666b[_0x37f2e2(0x1da)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'year':_0x3a85e6=new Date(_0x51666b[_0x37f2e2(0x12b)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x3a85e6[_0x37f2e2(0x10c)](0x0,0x0,0x0,0x0),_0x172c8a[_0x37f2e2(0x10c)](0x17,0x3b,0x3b,0x3e7);break;case _0x37f2e2(0xb2):default:_0x3a85e6=new Date(_0x37f2e2(0xbb)),_0x3a85e6[_0x37f2e2(0x10c)](0x0,0x0,0x0,0x0),_0x172c8a[_0x37f2e2(0x10c)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x37f2e2(0x1e4)]('üìÖ\x20Period:\x20'+_0x3a85e6[_0x37f2e2(0x1b1)]()+_0x37f2e2(0x11c)+_0x172c8a[_0x37f2e2(0x1b1)]());const _0x3da69a={'status':'PAID','gateway':{'not':_0x37f2e2(0x217)},'createdAt':{'gte':_0x3a85e6,'lte':_0x172c8a}};_0x39efc2[_0x37f2e2(0x1b5)]&&(_0x3da69a[_0x37f2e2(0x1b5)]=_0x39efc2['shopId']);const _0x11d4fd=await database_1[_0x37f2e2(0x258)][_0x37f2e2(0x157)]['findMany']({'where':_0x3da69a,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x37f2e2(0x1e4)]('üí∞\x20Found\x20'+_0x11d4fd[_0x37f2e2(0x25a)]+_0x37f2e2(0x152));const _0x5b482b={'gateway':{'not':_0x37f2e2(0x217)},'status':{'notIn':[_0x37f2e2(0x183),'EXPIRED']},'createdAt':{'gte':_0x3a85e6,'lte':_0x172c8a}};_0x39efc2['shopId']&&(_0x5b482b['shopId']=_0x39efc2[_0x37f2e2(0x1b5)]);const _0x2922a4=await database_1['default']['payment'][_0x37f2e2(0x17c)]({'where':_0x5b482b}),_0x75e31={..._0x5b482b,'status':_0x37f2e2(0x204)},_0x36c20b={..._0x5b482b,'status':_0x37f2e2(0x1b4)},[_0x3e6e69,_0x31723e]=await Promise['all']([database_1[_0x37f2e2(0x258)][_0x37f2e2(0x157)][_0x37f2e2(0x17c)]({'where':_0x75e31}),database_1[_0x37f2e2(0x258)][_0x37f2e2(0x157)][_0x37f2e2(0x17c)]({'where':_0x36c20b})]);console[_0x37f2e2(0x1e4)](_0x37f2e2(0x1ec)+_0x2922a4+_0x37f2e2(0x1a4)+_0x11d4fd[_0x37f2e2(0x25a)]+_0x37f2e2(0x1ea)+_0x3e6e69+_0x37f2e2(0x12a)+_0x31723e);let _0x34aa3c=0x0,_0x31f0b4=0x0,_0x52b13d=0x0;const _0x3148d7={},_0xf22f7={},_0x1b4687={},_0x5e3d6b=new Date(_0x3a85e6);while(_0x5e3d6b<=_0x172c8a){const _0x5bac2d=_0x5e3d6b[_0x37f2e2(0x1b1)]()[_0x37f2e2(0x19c)]('T')[0x0];_0x1b4687[_0x5bac2d]={'date':_0x5bac2d,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x5e3d6b[_0x37f2e2(0x174)](_0x5e3d6b['getUTCDate']()+0x1);}for(const _0x4cf51e of _0x11d4fd){try{const _0x2dd305=_0x4cf51e[_0x37f2e2(0x97)]||0x0;if(_0x2dd305<=0x0){console['warn']('‚ö†Ô∏è\x20Payment\x20'+_0x4cf51e['id']+_0x37f2e2(0x17e));continue;}let _0x596c06,_0x1ea3d0;if(_0x4cf51e[_0x37f2e2(0x14b)]!==null&&_0x4cf51e[_0x37f2e2(0x14b)]!==undefined)_0x596c06=_0x4cf51e[_0x37f2e2(0x14b)],_0x1ea3d0=_0x2dd305-_0x596c06,console[_0x37f2e2(0x1e4)](_0x37f2e2(0xaf)+_0x4cf51e['id']+':\x20'+_0x2dd305[_0x37f2e2(0x1f0)](0x6)+_0x37f2e2(0x144)+_0x596c06[_0x37f2e2(0x1f0)](0x6)+'\x20USDT');else{let _0x473036={};if(_0x4cf51e[_0x37f2e2(0x215)][_0x37f2e2(0x14f)])try{_0x473036=JSON[_0x37f2e2(0x1e6)](_0x4cf51e[_0x37f2e2(0x215)]['gatewaySettings']);}catch(_0x46deac){console['error'](_0x37f2e2(0x142)+_0x4cf51e['shopId']+':',_0x46deac);}let _0x14e7b=0x2d;for(const [_0x31d497,_0x204b2b]of Object[_0x37f2e2(0x112)](_0x473036)){if(_0x31d497['toLowerCase']()===_0x4cf51e[_0x37f2e2(0x141)]['toLowerCase']()){_0x14e7b=_0x204b2b[_0x37f2e2(0x256)]||0x2d;break;}}_0x1ea3d0=_0x2dd305*(_0x14e7b/0x64),_0x596c06=_0x2dd305-_0x1ea3d0,console['log'](_0x37f2e2(0x1f9)+_0x4cf51e['id']+':\x20'+_0x14e7b+_0x37f2e2(0xb6)+_0x2dd305[_0x37f2e2(0x1f0)](0x6)+_0x37f2e2(0xde));}_0x34aa3c+=_0x2dd305,_0x31f0b4+=_0x596c06,_0x52b13d+=_0x1ea3d0;let _0x15fcfe;_0x4cf51e['gatewayCommissionRate']!==null&&_0x4cf51e[_0x37f2e2(0x9b)]!==undefined?(_0x15fcfe=_0x4cf51e['gatewayCommissionRate'],console[_0x37f2e2(0x1e4)](_0x37f2e2(0x208)+_0x4cf51e['id']+':\x20'+_0x15fcfe+'%')):(_0x15fcfe=_0x2dd305>0x0?_0x1ea3d0/_0x2dd305*0x64:0x0,console[_0x37f2e2(0x1e4)](_0x37f2e2(0x98)+_0x4cf51e['id']+':\x20'+_0x15fcfe[_0x37f2e2(0x1f0)](0x2)+'%'));!_0x3148d7[_0x4cf51e[_0x37f2e2(0x141)]]&&(_0x3148d7[_0x4cf51e['gateway']]={'gateway':_0x4cf51e[_0x37f2e2(0x141)],'gatewayDisplayName':this[_0x37f2e2(0x1f1)](_0x4cf51e[_0x37f2e2(0x141)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3148d7[_0x4cf51e['gateway']][_0x37f2e2(0x25d)]++,_0x3148d7[_0x4cf51e['gateway']][_0x37f2e2(0x1de)]+=_0x2dd305,_0x3148d7[_0x4cf51e[_0x37f2e2(0x141)]][_0x37f2e2(0x155)]+=_0x1ea3d0,_0x3148d7[_0x4cf51e[_0x37f2e2(0x141)]]['merchantEarningsUSDT']+=_0x596c06,_0x3148d7[_0x4cf51e['gateway']][_0x37f2e2(0x21f)]+=_0x15fcfe;!_0x39efc2[_0x37f2e2(0x1b5)]&&(!_0xf22f7[_0x4cf51e[_0x37f2e2(0x1b5)]]&&(_0xf22f7[_0x4cf51e[_0x37f2e2(0x1b5)]]={'shopId':_0x4cf51e['shopId'],'shopName':_0x4cf51e[_0x37f2e2(0x215)][_0x37f2e2(0x99)],'shopUsername':_0x4cf51e[_0x37f2e2(0x215)][_0x37f2e2(0x1d9)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xf22f7[_0x4cf51e['shopId']]['paymentsCount']++,_0xf22f7[_0x4cf51e[_0x37f2e2(0x1b5)]]['turnoverUSDT']+=_0x2dd305,_0xf22f7[_0x4cf51e[_0x37f2e2(0x1b5)]][_0x37f2e2(0x155)]+=_0x1ea3d0,_0xf22f7[_0x4cf51e[_0x37f2e2(0x1b5)]][_0x37f2e2(0x20a)]+=_0x596c06);const _0x11d5de=_0x4cf51e[_0x37f2e2(0xc0)][_0x37f2e2(0x1b1)]()['split']('T')[0x0];_0x1b4687[_0x11d5de]&&(_0x1b4687[_0x11d5de][_0x37f2e2(0x148)]+=_0x2dd305,_0x1b4687[_0x11d5de][_0x37f2e2(0xfe)]+=_0x596c06,_0x1b4687[_0x11d5de][_0x37f2e2(0x15b)]+=_0x1ea3d0,_0x1b4687[_0x11d5de][_0x37f2e2(0x25d)]++);}catch(_0x1c40d8){console[_0x37f2e2(0x1d3)](_0x37f2e2(0xf4)+_0x4cf51e['id']+':',_0x1c40d8);}}Object[_0x37f2e2(0x1fe)](_0x3148d7)[_0x37f2e2(0x210)](_0x95beee=>{const _0x3bd32c=_0x37f2e2;_0x95beee[_0x3bd32c(0x1d8)]=_0x95beee[_0x3bd32c(0x25d)]>0x0?_0x95beee[_0x3bd32c(0x21f)]/_0x95beee['paymentsCount']:0x0,delete _0x95beee['totalCommissionRate'];}),Object[_0x37f2e2(0x1fe)](_0xf22f7)['forEach'](_0x4b9ab1=>{const _0x24c1b9=_0x37f2e2;_0x4b9ab1['averageCheckUSDT']=_0x4b9ab1[_0x24c1b9(0x25d)]>0x0?_0x4b9ab1[_0x24c1b9(0x1de)]/_0x4b9ab1[_0x24c1b9(0x25d)]:0x0;});let _0x39a75c=0x0,_0x169e79=0x0;if(_0x39efc2[_0x37f2e2(0x1b5)]){const _0x4d9fe7=await database_1['default'][_0x37f2e2(0xb0)]['findMany']({'where':{'shopId':_0x39efc2[_0x37f2e2(0x1b5)],'status':_0x37f2e2(0x180),'createdAt':{'gte':_0x3a85e6,'lte':_0x172c8a}},'select':{'amount':!![]}});_0x39a75c=_0x4d9fe7[_0x37f2e2(0xc3)]((_0x1e7426,_0x531f6e)=>_0x1e7426+_0x531f6e[_0x37f2e2(0x205)],0x0);const _0x49d4be=await database_1[_0x37f2e2(0x258)][_0x37f2e2(0xb0)][_0x37f2e2(0xf8)]({'where':{'shopId':_0x39efc2['shopId'],'status':_0x37f2e2(0x183),'createdAt':{'gte':_0x3a85e6,'lte':_0x172c8a}},'select':{'amount':!![]}});_0x169e79=_0x49d4be['reduce']((_0x260639,_0x27f1d5)=>_0x260639+_0x27f1d5[_0x37f2e2(0x205)],0x0);}const _0x3789ac=_0x2922a4,_0xbfaea9=_0x11d4fd[_0x37f2e2(0x25a)],_0x4c06fe=_0xbfaea9>0x0?_0x34aa3c/_0xbfaea9:0x0,_0x5c3e2f=_0x3789ac>0x0?Math[_0x37f2e2(0x23e)](_0xbfaea9/_0x3789ac*0x2710)/0x64:0x0,_0x1fc32e=Math[_0x37f2e2(0xf7)]((_0x172c8a[_0x37f2e2(0x12b)]()-_0x3a85e6[_0x37f2e2(0x12b)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2306ca={'totalTurnover':Math[_0x37f2e2(0x23e)](_0x34aa3c*0x64)/0x64,'merchantEarnings':Math[_0x37f2e2(0x23e)](_0x31f0b4*0x64)/0x64,'gatewayEarnings':Math[_0x37f2e2(0x23e)](_0x52b13d*0x64)/0x64,'totalPaidOut':Math[_0x37f2e2(0x23e)](_0x39a75c*0x64)/0x64,'pendingPayout':Math['round'](_0x169e79*0x64)/0x64,'averageCheck':Math[_0x37f2e2(0x23e)](_0x4c06fe*0x64)/0x64,'totalPayments':_0x3789ac,'successfulPayments':_0xbfaea9,'conversionRate':_0x5c3e2f,'chargebacks':_0x3e6e69,'refunds':_0x31723e,'gatewayBreakdown':Object[_0x37f2e2(0x1fe)](_0x3148d7)[_0x37f2e2(0xd6)](_0x194a5c=>({..._0x194a5c,'turnoverUSDT':Math[_0x37f2e2(0x23e)](_0x194a5c[_0x37f2e2(0x1de)]*0x64)/0x64,'commissionUSDT':Math[_0x37f2e2(0x23e)](_0x194a5c[_0x37f2e2(0x155)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x37f2e2(0x23e)](_0x194a5c['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x37f2e2(0x23e)](_0x194a5c[_0x37f2e2(0x1d8)]*0x64)/0x64})),'merchantBreakdown':_0x39efc2['shopId']?undefined:Object[_0x37f2e2(0x1fe)](_0xf22f7)['map'](_0xb6e0d5=>({..._0xb6e0d5,'turnoverUSDT':Math[_0x37f2e2(0x23e)](_0xb6e0d5['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x37f2e2(0x23e)](_0xb6e0d5[_0x37f2e2(0x155)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0xb6e0d5['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x37f2e2(0x23e)](_0xb6e0d5[_0x37f2e2(0xb9)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0xb6e0d5[_0x37f2e2(0xc8)]*0x64)/0x64})),'dailyData':Object[_0x37f2e2(0x1fe)](_0x1b4687)[_0x37f2e2(0xd6)](_0x19a676=>({..._0x19a676,'turnover':Math[_0x37f2e2(0x23e)](_0x19a676[_0x37f2e2(0x148)]*0x64)/0x64,'merchantEarnings':Math[_0x37f2e2(0x23e)](_0x19a676[_0x37f2e2(0xfe)]*0x64)/0x64,'gatewayEarnings':Math[_0x37f2e2(0x23e)](_0x19a676[_0x37f2e2(0x15b)]*0x64)/0x64}))['sort']((_0x172a8a,_0x31f79e)=>_0x172a8a[_0x37f2e2(0x1fb)][_0x37f2e2(0x91)](_0x31f79e[_0x37f2e2(0x1fb)])),'periodInfo':{'from':_0x3a85e6,'to':_0x172c8a,'periodType':_0x39efc2[_0x37f2e2(0x132)]||'custom','daysCount':_0x1fc32e}};return console[_0x37f2e2(0x1e4)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x37f2e2(0x1e4)](_0x37f2e2(0xa9)+_0x2306ca['totalTurnover']+_0x37f2e2(0xde)),console[_0x37f2e2(0x1e4)](_0x37f2e2(0x1b0)+_0x2306ca[_0x37f2e2(0xfe)]+_0x37f2e2(0xde)),console[_0x37f2e2(0x1e4)](_0x37f2e2(0x114)+_0x2306ca[_0x37f2e2(0x15b)]+_0x37f2e2(0xde)),console[_0x37f2e2(0x1e4)]('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x2306ca[_0x37f2e2(0xe2)]+_0x37f2e2(0xde)),console[_0x37f2e2(0x1e4)](_0x37f2e2(0x14c)+_0x2306ca['pendingPayout']+'\x20USDT'),console['log']('\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20'+_0x2306ca['totalPayments']),_0x2306ca;}async[a48_0xb1fe34(0x224)](_0x396a09){const _0x412ab7=a48_0xb1fe34;console[_0x412ab7(0x1e4)]('üìã\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x396a09});let _0x5d3398={};_0x396a09&&(_0x5d3398[_0x412ab7(0x1e2)]={'some':{}});const _0x20bcd5=await database_1[_0x412ab7(0x258)][_0x412ab7(0x215)][_0x412ab7(0xf8)]({'where':_0x5d3398,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x412ab7(0x1d4)}});return console[_0x412ab7(0x1e4)]('üìã\x20Found\x20'+_0x20bcd5['length']+'\x20merchants\x20for\x20selection'+(_0x396a09?_0x412ab7(0xea):'')),_0x20bcd5[_0x412ab7(0xd6)](_0x2fdc72=>({'id':_0x2fdc72['id'],'username':_0x2fdc72[_0x412ab7(0x1d9)],'name':_0x2fdc72[_0x412ab7(0x99)]}));}[a48_0xb1fe34(0x1f1)](_0x12a25d){const _0x4aa16e=a48_0xb1fe34,_0x288b34={'test_gateway':_0x4aa16e(0x251),'plisio':'Plisio','rapyd':_0x4aa16e(0x248),'noda':_0x4aa16e(0xa1),'cointopay':'CoinToPay','cointopay2':_0x4aa16e(0xee),'klyme_eu':_0x4aa16e(0x193),'klyme_gb':_0x4aa16e(0xbc),'klyme_de':_0x4aa16e(0x154),'mastercard':_0x4aa16e(0xec),'visa/mastercard':_0x4aa16e(0x10e),'amer':_0x4aa16e(0x10d),'myxspend':_0x4aa16e(0x119),'ampay':_0x4aa16e(0x25e),'ampay_try':_0x4aa16e(0x1b2),'sepa':'Sepa','interac':_0x4aa16e(0x153),'onramp':_0x4aa16e(0x23d),'squirrelpay':_0x4aa16e(0xc5),'maxpara':_0x4aa16e(0x10f),'instaxchange':_0x4aa16e(0x161),'oxapay':_0x4aa16e(0xcd)};return _0x288b34[_0x12a25d]||_0x12a25d;}[a48_0xb1fe34(0xae)](_0x1b34ae){const _0x309345=a48_0xb1fe34,_0x3edd8d={'Test\x20Gateway':_0x309345(0x217),'Plisio':_0x309345(0x19a),'Rapyd':'rapyd','Noda':_0x309345(0x1f5),'CoinToPay':_0x309345(0x19d),'CoinToPay2':_0x309345(0x20f),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x309345(0x245),'KLYME\x20DE':_0x309345(0x18f),'MasterCard':_0x309345(0x1be)};return _0x3edd8d[_0x1b34ae]||_0x1b34ae[_0x309345(0x192)]();}async['getMerchantsAwaitingPayout'](_0x199e79){const _0x258e4a=a48_0xb1fe34,{page:_0x5a5401,limit:_0x7f021f,minAmount:_0x3b9591,search:_0x63d4dc}=_0x199e79;console['log'](_0x258e4a(0xdf),_0x199e79);let _0x2f7fa9={};_0x63d4dc&&(_0x2f7fa9[_0x258e4a(0x99)]={'contains':_0x63d4dc,'mode':_0x258e4a(0x1e0)});const _0x2e0995=await database_1[_0x258e4a(0x258)]['shop'][_0x258e4a(0xf8)]({'where':_0x2f7fa9,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x12c2f8=_0x2e0995[_0x258e4a(0x219)](_0x3fcfd9=>{const _0x2dadcd=_0x258e4a,_0x5e0b60=Math[_0x2dadcd(0x211)](_0x3fcfd9[_0x2dadcd(0x1c2)]*0x64)/0x64;if(_0x3b9591&&_0x5e0b60<_0x3b9591)return![];return _0x5e0b60!==0x0;});_0x12c2f8[_0x258e4a(0x189)]((_0x22320a,_0x543ec9)=>_0x543ec9['balance']-_0x22320a[_0x258e4a(0x1c2)]);const _0x3b4405=_0x12c2f8['length'],_0x5f17a4=(_0x5a5401-0x1)*_0x7f021f,_0x5a3b42=_0x12c2f8[_0x258e4a(0x194)](_0x5f17a4,_0x5f17a4+_0x7f021f);console[_0x258e4a(0x1e4)](_0x258e4a(0xf3)+_0x5a3b42[_0x258e4a(0x25a)]+_0x258e4a(0x156));const _0x17666e=await Promise[_0x258e4a(0xb2)](_0x5a3b42[_0x258e4a(0xd6)](async _0x37ed38=>{const _0x37fec8=_0x258e4a,[_0x4af3e6,_0x4758f2,_0x57f3a0]=await Promise['all']([database_1[_0x37fec8(0x258)]['payment'][_0x37fec8(0x17c)]({'where':{'shopId':_0x37ed38['id'],'status':'PAID','gateway':{'not':_0x37fec8(0x217)}}}),database_1['default']['payment']['findFirst']({'where':{'shopId':_0x37ed38['id'],'status':_0x37fec8(0xcf),'gateway':{'not':_0x37fec8(0x217)}},'orderBy':{'paidAt':_0x37fec8(0x1d4)},'select':{'paidAt':!![]}}),database_1[_0x37fec8(0x258)][_0x37fec8(0x157)]['groupBy']({'by':[_0x37fec8(0x141)],'where':{'shopId':_0x37ed38['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2b991f=new Date(),_0x2a7130=new Date(_0x2b991f[_0x37fec8(0x136)](),_0x2b991f[_0x37fec8(0x140)](),0x1),_0x2c81fd=new Date(_0x2b991f[_0x37fec8(0x136)](),_0x2b991f[_0x37fec8(0x140)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x10120a,_0x4e16c1]=await Promise[_0x37fec8(0xb2)]([database_1[_0x37fec8(0x258)][_0x37fec8(0xb0)][_0x37fec8(0x16b)]({'_sum':{'amount':!![]},'where':{'shopId':_0x37ed38['id'],'status':_0x37fec8(0x180)}}),database_1[_0x37fec8(0x258)][_0x37fec8(0xb0)][_0x37fec8(0x16b)]({'_sum':{'amount':!![]},'where':{'shopId':_0x37ed38['id'],'status':'COMPLETED','createdAt':{'gte':_0x2a7130,'lte':_0x2c81fd}}})]),_0x30638f=_0x10120a[_0x37fec8(0x233)][_0x37fec8(0x205)]||0x0,_0x33ed03=_0x4e16c1[_0x37fec8(0x233)]['amount']||0x0,_0x6fe655=await Promise[_0x37fec8(0xb2)](_0x57f3a0[_0x37fec8(0xd6)](async _0x214546=>{const _0x44f896=_0x37fec8;let _0x18c305=0x2d;if(_0x37ed38[_0x44f896(0x14f)])try{const _0xc4194=JSON[_0x44f896(0x1e6)](_0x37ed38['gatewaySettings']);for(const [_0x39debb,_0x2375eb]of Object[_0x44f896(0x112)](_0xc4194)){if(_0x39debb[_0x44f896(0x192)]()===_0x214546['gateway'][_0x44f896(0x192)]()){_0x18c305=_0x2375eb['commission']||0xa,console[_0x44f896(0x1e4)](_0x44f896(0x1ab)+_0x214546['gateway']+_0x44f896(0x220)+_0x37ed38['id']+':\x20commission\x20=\x20'+_0x18c305+'%');break;}}}catch(_0x26433f){console[_0x44f896(0x1d3)](_0x44f896(0x142)+_0x37ed38['id']+':',_0x26433f);}const _0x227233=_0x214546['_sum']?.[_0x44f896(0x97)]||0x0,_0x284302=_0x227233*(0x1-_0x18c305/0x64);return{'gateway':_0x214546[_0x44f896(0x141)],'count':_0x214546[_0x44f896(0x1b8)]?.['id']||0x0,'amountUSDT':Math[_0x44f896(0x23e)](_0x227233*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x284302*0x64)/0x64,'commission':_0x18c305};})),_0x3c819b=_0x6fe655['reduce']((_0x2f7ee4,_0x58eb4e)=>_0x2f7ee4+_0x58eb4e['amountUSDT'],0x0),_0x245802=_0x6fe655[_0x37fec8(0xc3)]((_0x48d44c,_0x4c6129)=>_0x48d44c+_0x4c6129[_0x37fec8(0x15a)],0x0),_0x1b3bf5=_0x37ed38[_0x37fec8(0x1c2)];return console[_0x37fec8(0x1e4)](_0x37fec8(0xa8)+_0x37ed38[_0x37fec8(0x1d9)]+':'),console[_0x37fec8(0x1e4)](_0x37fec8(0x1db)+_0x3c819b[_0x37fec8(0x1f0)](0x2)+_0x37fec8(0x1a3)),console[_0x37fec8(0x1e4)](_0x37fec8(0xd4)+_0x245802[_0x37fec8(0x1f0)](0x2)+_0x37fec8(0x1bf)),console[_0x37fec8(0x1e4)](_0x37fec8(0x1bb)+_0x1b3bf5[_0x37fec8(0x1f0)](0x2)+_0x37fec8(0x257)),console['log']('\x20\x20\x20üí∏\x20Total\x20payouts:\x20'+_0x30638f['toFixed'](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0x37fec8(0x1e4)]('\x20\x20\x20ü§î\x20Difference:\x20'+(_0x245802-_0x30638f-_0x1b3bf5)[_0x37fec8(0x1f0)](0x2)+_0x37fec8(0xbe)),{'id':_0x37ed38['id'],'fullName':_0x37ed38[_0x37fec8(0x99)],'username':_0x37ed38['username'],'telegramId':_0x37ed38['telegram'],'merchantUrl':_0x37ed38['shopUrl'],'wallets':{'usdtPolygonWallet':_0x37ed38[_0x37fec8(0x216)],'usdtTrcWallet':_0x37ed38['usdtTrcWallet'],'usdtErcWallet':_0x37ed38[_0x37fec8(0x11b)],'usdcPolygonWallet':_0x37ed38[_0x37fec8(0x108)],'usdcErcWallet':_0x37ed38[_0x37fec8(0x228)]},'totalAmountUSDT':Math[_0x37fec8(0x23e)](_0x3c819b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x37fec8(0x23e)](_0x245802*0x64)/0x64,'currentBalance':Math[_0x37fec8(0x211)](_0x1b3bf5*0x64)/0x64,'totalPayout':Math[_0x37fec8(0x23e)](_0x30638f*0x64)/0x64,'thisMonth':Math[_0x37fec8(0x23e)](_0x33ed03*0x64)/0x64,'paymentsCount':_0x4af3e6,'oldestPaymentDate':_0x4758f2?.[_0x37fec8(0xc0)]||_0x37ed38[_0x37fec8(0xba)],'gatewayBreakdown':_0x6fe655};})),_0xa4e869=_0x17666e[_0x258e4a(0xc3)]((_0x1fcadc,_0x2d320e)=>_0x1fcadc+_0x2d320e[_0x258e4a(0xa0)],0x0),_0x47e74a=_0x17666e['reduce']((_0x16c20f,_0x3d075e)=>_0x16c20f+_0x3d075e[_0x258e4a(0xc6)],0x0),_0x1aaa01=_0x17666e[_0x258e4a(0xc3)]((_0x3d39de,_0x2da45b)=>_0x3d39de+_0x2da45b[_0x258e4a(0x19f)],0x0),_0x1b5368=_0x17666e[_0x258e4a(0xc3)]((_0x31e9e3,_0x25f65f)=>_0x31e9e3+_0x25f65f[_0x258e4a(0x9d)],0x0);return console[_0x258e4a(0x1e4)](_0x258e4a(0x1a7)+_0x3b4405+_0x258e4a(0x130)),console[_0x258e4a(0x1e4)](_0x258e4a(0x225)+Math[_0x258e4a(0x23e)](_0xa4e869*0x64)/0x64+_0x258e4a(0x1a3)),console[_0x258e4a(0x1e4)](_0x258e4a(0x167)+Math[_0x258e4a(0x23e)](_0x47e74a*0x64)/0x64+_0x258e4a(0x196)),console['log'](_0x258e4a(0x240)+Math['round'](_0x1aaa01*0x64)/0x64+_0x258e4a(0xde)),console[_0x258e4a(0x1e4)](_0x258e4a(0x243)+Math[_0x258e4a(0x23e)](_0x1b5368*0x64)/0x64+_0x258e4a(0xde)),{'merchants':_0x17666e,'pagination':{'page':_0x5a5401,'limit':_0x7f021f,'total':_0x3b4405,'totalPages':Math[_0x258e4a(0xf7)](_0x3b4405/_0x7f021f)},'summary':{'totalMerchants':_0x3b4405,'totalAmountUSDT':Math[_0x258e4a(0x23e)](_0xa4e869*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x47e74a*0x64)/0x64,'totalPayout':Math[_0x258e4a(0x23e)](_0x1aaa01*0x64)/0x64,'thisMonth':Math['round'](_0x1b5368*0x64)/0x64}};}async['createPayout'](_0x4dafd9){const _0x572b78=a48_0xb1fe34,{shopId:_0x51b99e,amount:_0x77c4cc,network:_0x381441,wallet:_0x25ba99,notes:_0xd797eb,txid:_0x1eee09,periodFrom:_0x111cf2,periodTo:_0x2da396}=_0x4dafd9,_0x3fc77c=await database_1[_0x572b78(0x258)]['$transaction'](async _0x303788=>{const _0x25fb94=_0x572b78,_0x3d39ec=await _0x303788[_0x25fb94(0x215)][_0x25fb94(0x187)]({'where':{'id':_0x51b99e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3d39ec)throw new Error(_0x25fb94(0x126));console[_0x25fb94(0x1e4)](_0x25fb94(0xff)+_0x3d39ec[_0x25fb94(0x1d9)]+':'),console[_0x25fb94(0x1e4)](_0x25fb94(0xe0)+_0x3d39ec['balance']['toFixed'](0x6)+'\x20USDT'),console[_0x25fb94(0x1e4)](_0x25fb94(0x21d)+_0x77c4cc['toFixed'](0x6)+'\x20USDT'),console['log'](_0x25fb94(0x17d)+_0x3d39ec[_0x25fb94(0xe2)]['toFixed'](0x6)+_0x25fb94(0xde));if(_0x1eee09)console[_0x25fb94(0x1e4)](_0x25fb94(0x202)+_0x1eee09);const _0x10b607=0.000001,_0x17b4e7=Number(_0x3d39ec[_0x25fb94(0x1c2)]),_0xac86cd=Number(_0x77c4cc);console[_0x25fb94(0x1e4)](_0x25fb94(0x23f)),console[_0x25fb94(0x1e4)](_0x25fb94(0xbf)+_0x3d39ec['balance']),console[_0x25fb94(0x1e4)](_0x25fb94(0x1eb)+_0x17b4e7),console[_0x25fb94(0x1e4)](_0x25fb94(0x106)+_0xac86cd),console['log'](_0x25fb94(0x173)+(_0x17b4e7-_0xac86cd)),console[_0x25fb94(0x1e4)](_0x25fb94(0xa3)+_0x10b607);if(_0x17b4e7<_0xac86cd-_0x10b607)throw new Error(_0x25fb94(0x206)+_0x17b4e7[_0x25fb94(0x1f0)](0x6)+_0x25fb94(0xef)+_0xac86cd[_0x25fb94(0x1f0)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x17b4e7-_0xac86cd)[_0x25fb94(0x1f0)](0x8)+_0x25fb94(0xde));console[_0x25fb94(0x1e4)](_0x25fb94(0xb5));const _0x4c77d6=Math[_0x25fb94(0xce)](_0x17b4e7,_0xac86cd);let _0x1eb7f7=_0x25ba99;console['log'](_0x25fb94(0x134)+(_0x25ba99||_0x25fb94(0xad)));if(!_0x1eb7f7){console[_0x25fb94(0x1e4)](_0x25fb94(0x124));const _0x414cea=await _0x303788[_0x25fb94(0x215)]['findUnique']({'where':{'id':_0x51b99e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x25fb94(0x1e4)](_0x25fb94(0x1f4),_0x414cea);if(_0x414cea)switch(_0x381441){case'polygon':_0x1eb7f7=_0x414cea['usdtPolygonWallet']||undefined,console[_0x25fb94(0x1e4)](_0x25fb94(0xfc)+_0x1eb7f7);break;case _0x25fb94(0x125):_0x1eb7f7=_0x414cea[_0x25fb94(0x252)]||undefined,console[_0x25fb94(0x1e4)]('üîç\x20Selected\x20trc20\x20wallet:\x20'+_0x1eb7f7);break;case _0x25fb94(0x158):_0x1eb7f7=_0x414cea[_0x25fb94(0x11b)]||undefined,console[_0x25fb94(0x1e4)](_0x25fb94(0x137)+_0x1eb7f7);break;case _0x25fb94(0x253):_0x1eb7f7=_0x414cea[_0x25fb94(0x108)]||undefined,console[_0x25fb94(0x1e4)]('üîç\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x1eb7f7);break;case _0x25fb94(0x1d0):_0x1eb7f7=_0x414cea[_0x25fb94(0x228)]||undefined,console['log'](_0x25fb94(0x22a)+_0x1eb7f7);break;}}else console[_0x25fb94(0x1e4)]('‚úÖ\x20Using\x20wallet\x20from\x20request:\x20'+_0x1eb7f7);console[_0x25fb94(0x1e4)](_0x25fb94(0x133)+_0x381441+':\x20'+(_0x1eb7f7||_0x25fb94(0x1a8))),console[_0x25fb94(0x1e4)]('üîç\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x51b99e,'amount':_0x4c77d6,'network':_0x381441,'wallet':_0x1eb7f7,'status':_0x25fb94(0x180),'txid':_0x1eee09,'notes':_0xd797eb,'periodFrom':_0x111cf2?new Date(_0x111cf2):null,'periodTo':_0x2da396?new Date(_0x2da396):null});const _0x1ae98c=await _0x303788[_0x25fb94(0xb0)]['create']({'data':{'shopId':_0x51b99e,'amount':_0x4c77d6,'network':_0x381441,'wallet':_0x1eb7f7,'status':_0x25fb94(0x180),'txid':_0x1eee09,'notes':_0xd797eb,'periodFrom':_0x111cf2?new Date(_0x111cf2):null,'periodTo':_0x2da396?new Date(_0x2da396):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x25fb94(0x1e4)](_0x25fb94(0x93),{'id':_0x1ae98c['id'],'wallet':_0x1ae98c[_0x25fb94(0x188)],'network':_0x1ae98c[_0x25fb94(0x249)],'amount':_0x1ae98c[_0x25fb94(0x205)]});const _0x285eb3=_0x17b4e7-_0x4c77d6,_0x1a212d=Number(_0x3d39ec[_0x25fb94(0xe2)])+_0x4c77d6;return await _0x303788[_0x25fb94(0x215)]['update']({'where':{'id':_0x51b99e},'data':{'balance':_0x285eb3,'totalPaidOut':_0x1a212d}}),console['log']('üí∞\x20Shop\x20'+_0x3d39ec[_0x25fb94(0x1d9)]+'\x20balance\x20updated:'),console[_0x25fb94(0x1e4)](_0x25fb94(0x1a6)+_0x17b4e7['toFixed'](0x6)+_0x25fb94(0x1f2)+_0x285eb3[_0x25fb94(0x1f0)](0x6)+'\x20USDT\x20(-'+_0x4c77d6[_0x25fb94(0x1f0)](0x6)+')'),console['log'](_0x25fb94(0x207)+_0x3d39ec[_0x25fb94(0xe2)][_0x25fb94(0x1f0)](0x6)+'\x20->\x20'+_0x1a212d[_0x25fb94(0x1f0)](0x6)+'\x20USDT\x20(+'+_0x4c77d6['toFixed'](0x6)+')'),console[_0x25fb94(0x1e4)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x4c77d6[_0x25fb94(0x1f0)](0x6)+_0x25fb94(0xde)),{'payout':_0x1ae98c,'shop':_0x3d39ec};});console[_0x572b78(0x1e4)](_0x572b78(0xfa)+_0x3fc77c['payout']['id']+'\x20for\x20shop\x20'+_0x3fc77c[_0x572b78(0x215)]['username']+'\x20('+_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x205)][_0x572b78(0x1f0)](0x6)+_0x572b78(0x1e3));try{let _0x33b139='–ù–µ\x20—É–∫–∞–∑–∞–Ω';if(_0x3fc77c[_0x572b78(0xb0)]['periodFrom']&&_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x127)]){const _0x4c6040=new Date(_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x14d)])[_0x572b78(0x1e9)]('ru-RU'),_0x59820f=new Date(_0x3fc77c[_0x572b78(0xb0)]['periodTo'])['toLocaleDateString'](_0x572b78(0x105));_0x33b139=_0x4c6040+_0x572b78(0x184)+_0x59820f;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x1b5)],{'id':_0x3fc77c[_0x572b78(0xb0)]['id'],'amount':_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x205)],'network':_0x3fc77c['payout'][_0x572b78(0x249)],'wallet':_0x3fc77c[_0x572b78(0xb0)]['wallet'],'period':_0x33b139,'createdAt':_0x3fc77c['payout'][_0x572b78(0xba)],'txid':_0x3fc77c[_0x572b78(0xb0)]['txid']}),console['log'](_0x572b78(0x22b)+_0x3fc77c[_0x572b78(0xb0)]['id']);}catch(_0x500a3b){console[_0x572b78(0x1d3)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x3fc77c[_0x572b78(0xb0)]['id']+':',_0x500a3b);}return{'id':_0x3fc77c[_0x572b78(0xb0)]['id'],'shopId':_0x3fc77c[_0x572b78(0xb0)]['shopId'],'shopName':_0x3fc77c[_0x572b78(0x215)][_0x572b78(0x99)],'shopUsername':_0x3fc77c[_0x572b78(0x215)][_0x572b78(0x1d9)],'amount':_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x205)],'network':_0x3fc77c['payout'][_0x572b78(0x249)],'wallet':_0x3fc77c['payout'][_0x572b78(0x188)],'status':_0x3fc77c['payout'][_0x572b78(0x12e)],'txid':_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x185)],'notes':_0x3fc77c['payout'][_0x572b78(0xb3)],'periodFrom':_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0x14d)],'periodTo':_0x3fc77c[_0x572b78(0xb0)]['periodTo'],'createdAt':_0x3fc77c[_0x572b78(0xb0)][_0x572b78(0xba)],'paidAt':_0x3fc77c[_0x572b78(0xb0)]['paidAt']};}async['getAllPayouts'](_0x460140){const _0x1adc5f=a48_0xb1fe34,{page:_0x1fcaba,limit:_0x1bb778,shopId:_0x2a656b,network:_0x2abe1e,dateFrom:_0x5ae13d,dateTo:_0x7bf749,search:_0xf7ae61}=_0x460140,_0x20d7e6=(_0x1fcaba-0x1)*_0x1bb778,_0x2e6af4={};_0x2a656b&&(_0x2e6af4[_0x1adc5f(0x1b5)]=_0x2a656b);_0x2abe1e&&(_0x2e6af4[_0x1adc5f(0x249)]=_0x2abe1e);if(_0x5ae13d||_0x7bf749){_0x2e6af4[_0x1adc5f(0xba)]={};if(_0x5ae13d){const _0x20c131=new Date(_0x5ae13d);_0x20c131[_0x1adc5f(0x10c)](0x0,0x0,0x0,0x1),_0x2e6af4[_0x1adc5f(0xba)][_0x1adc5f(0xf6)]=_0x20c131,console[_0x1adc5f(0x1e4)](_0x1adc5f(0x94)+_0x20c131['toISOString']());}if(_0x7bf749){const _0x1d3196=new Date(_0x7bf749);_0x1d3196[_0x1adc5f(0x10c)](0x17,0x3b,0x3b,0x3e7),_0x2e6af4[_0x1adc5f(0xba)][_0x1adc5f(0x250)]=_0x1d3196,console[_0x1adc5f(0x1e4)]('üìÖ\x20Payout\x20date\x20to\x20filter:\x20'+_0x1d3196[_0x1adc5f(0x1b1)]());}}_0xf7ae61&&(_0x2e6af4['OR']=[{'shop':{'name':{'contains':_0xf7ae61,'mode':_0x1adc5f(0x1e0)}}},{'shop':{'username':{'contains':_0xf7ae61,'mode':'insensitive'}}},{'notes':{'contains':_0xf7ae61,'mode':_0x1adc5f(0x1e0)}}]);const [_0x291d75,_0x2a0391]=await Promise[_0x1adc5f(0xb2)]([database_1[_0x1adc5f(0x258)][_0x1adc5f(0xb0)]['findMany']({'where':_0x2e6af4,'skip':_0x20d7e6,'take':_0x1bb778,'orderBy':{'createdAt':_0x1adc5f(0x123)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1adc5f(0x258)][_0x1adc5f(0xb0)]['count']({'where':_0x2e6af4})]);return{'payouts':_0x291d75[_0x1adc5f(0xd6)](_0x3e4817=>({'id':_0x3e4817['id'],'shopId':_0x3e4817[_0x1adc5f(0x1b5)],'shopName':_0x3e4817[_0x1adc5f(0x215)][_0x1adc5f(0x99)],'shopUsername':_0x3e4817[_0x1adc5f(0x215)][_0x1adc5f(0x1d9)],'amount':_0x3e4817[_0x1adc5f(0x205)],'network':_0x3e4817[_0x1adc5f(0x249)],'wallet':_0x3e4817[_0x1adc5f(0x188)],'status':_0x3e4817['status'],'txid':_0x3e4817[_0x1adc5f(0x185)],'notes':_0x3e4817[_0x1adc5f(0xb3)],'periodFrom':_0x3e4817[_0x1adc5f(0x14d)],'periodTo':_0x3e4817['periodTo'],'createdAt':_0x3e4817['createdAt'],'paidAt':_0x3e4817['paidAt']})),'pagination':{'page':_0x1fcaba,'limit':_0x1bb778,'total':_0x2a0391,'totalPages':Math[_0x1adc5f(0xf7)](_0x2a0391/_0x1bb778)}};}async['getPayoutById'](_0x5c0f10){const _0x2a139a=a48_0xb1fe34,_0x884c5d=await database_1[_0x2a139a(0x258)]['payout'][_0x2a139a(0x187)]({'where':{'id':_0x5c0f10},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x884c5d)return null;return{'id':_0x884c5d['id'],'shopId':_0x884c5d[_0x2a139a(0x1b5)],'shopName':_0x884c5d['shop'][_0x2a139a(0x99)],'shopUsername':_0x884c5d[_0x2a139a(0x215)][_0x2a139a(0x1d9)],'amount':_0x884c5d[_0x2a139a(0x205)],'network':_0x884c5d[_0x2a139a(0x249)],'wallet':_0x884c5d[_0x2a139a(0x188)],'status':_0x884c5d[_0x2a139a(0x12e)],'txid':_0x884c5d[_0x2a139a(0x185)],'notes':_0x884c5d[_0x2a139a(0xb3)],'periodFrom':_0x884c5d[_0x2a139a(0x14d)],'periodTo':_0x884c5d[_0x2a139a(0x127)],'createdAt':_0x884c5d[_0x2a139a(0xba)],'paidAt':_0x884c5d['paidAt']};}async[a48_0xb1fe34(0x1d5)](_0x569370){const _0x3dc0db=a48_0xb1fe34;await database_1[_0x3dc0db(0x258)][_0x3dc0db(0xb0)]['delete']({'where':{'id':_0x569370}});}async[a48_0xb1fe34(0x177)](_0x297b10,_0x9ad90d){const _0x2a1148=a48_0xb1fe34,_0x4f669d=await database_1[_0x2a1148(0x258)]['$transaction'](async _0x2af30d=>{const _0x53adab=_0x2a1148,_0x1d8d75=await _0x2af30d[_0x53adab(0xb0)][_0x53adab(0x187)]({'where':{'id':_0x297b10},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x1d8d75)throw new Error(_0x53adab(0x16c));console[_0x53adab(0x1e4)](_0x53adab(0xeb)+_0x297b10+'\x20for\x20shop\x20'+_0x1d8d75[_0x53adab(0x215)][_0x53adab(0x1d9)]+':'),console['log'](_0x53adab(0x1e8)+_0x1d8d75['amount'][_0x53adab(0x1f0)](0x6)+_0x53adab(0xde)),console[_0x53adab(0x1e4)](_0x53adab(0x247)+_0x1d8d75[_0x53adab(0x249)]),console[_0x53adab(0x1e4)](_0x53adab(0x10b)+_0x1d8d75[_0x53adab(0x215)][_0x53adab(0x1c2)][_0x53adab(0x1f0)](0x6)+_0x53adab(0xde)),console[_0x53adab(0x1e4)](_0x53adab(0x143)+_0x1d8d75[_0x53adab(0x215)][_0x53adab(0xe2)][_0x53adab(0x1f0)](0x6)+_0x53adab(0xde));let _0x506b90=0x0;if(_0x9ad90d[_0x53adab(0x205)]!==undefined){const _0x2ea5a6=Number(_0x1d8d75[_0x53adab(0x205)]),_0x39102a=Number(_0x9ad90d[_0x53adab(0x205)]);_0x506b90=_0x39102a-_0x2ea5a6,console['log'](_0x53adab(0x1a5)+_0x39102a[_0x53adab(0x1f0)](0x6)+_0x53adab(0xde)),console[_0x53adab(0x1e4)](_0x53adab(0x15f)+_0x506b90[_0x53adab(0x1f0)](0x6)+_0x53adab(0xde));if(_0x506b90<0x0)console['log'](_0x53adab(0x92)+Math['abs'](_0x506b90)[_0x53adab(0x1f0)](0x6)+'\x20USDT\x20-\x20will\x20return\x20to\x20balance');else{if(_0x506b90>0x0){const _0x385197=Number(_0x1d8d75[_0x53adab(0x215)][_0x53adab(0x1c2)]);console[_0x53adab(0x1e4)]('\x20\x20\x20Amount\x20increased\x20by\x20'+_0x506b90['toFixed'](0x6)+_0x53adab(0x198));if(_0x385197<_0x506b90)throw new Error(_0x53adab(0xb1)+_0x385197[_0x53adab(0x1f0)](0x6)+_0x53adab(0x1fd)+_0x506b90[_0x53adab(0x1f0)](0x6)+_0x53adab(0xde));}}}const _0x5876df={};if(_0x9ad90d[_0x53adab(0x205)]!==undefined)_0x5876df[_0x53adab(0x205)]=_0x9ad90d[_0x53adab(0x205)];if(_0x9ad90d[_0x53adab(0x249)]!==undefined)_0x5876df[_0x53adab(0x249)]=_0x9ad90d[_0x53adab(0x249)];if(_0x9ad90d[_0x53adab(0x188)]!==undefined)_0x5876df[_0x53adab(0x188)]=_0x9ad90d[_0x53adab(0x188)]||null;if(_0x9ad90d[_0x53adab(0xb3)]!==undefined)_0x5876df[_0x53adab(0xb3)]=_0x9ad90d[_0x53adab(0xb3)]||null;if(_0x9ad90d[_0x53adab(0x185)]!==undefined)_0x5876df[_0x53adab(0x185)]=_0x9ad90d['txid']||null;if(_0x9ad90d[_0x53adab(0x14d)]!==undefined)_0x5876df[_0x53adab(0x14d)]=_0x9ad90d[_0x53adab(0x14d)]?new Date(_0x9ad90d[_0x53adab(0x14d)]):null;if(_0x9ad90d[_0x53adab(0x127)]!==undefined)_0x5876df[_0x53adab(0x127)]=_0x9ad90d[_0x53adab(0x127)]?new Date(_0x9ad90d[_0x53adab(0x127)]):null;const _0x1b4b55=await _0x2af30d[_0x53adab(0xb0)][_0x53adab(0x113)]({'where':{'id':_0x297b10},'data':_0x5876df,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x506b90!==0x0){const _0x12a67b=Number(_0x1d8d75['shop'][_0x53adab(0x1c2)]),_0xea0ef=Number(_0x1d8d75[_0x53adab(0x215)][_0x53adab(0xe2)]),_0x6af3e7=_0x12a67b-_0x506b90,_0x29dafa=_0xea0ef+_0x506b90;await _0x2af30d[_0x53adab(0x215)][_0x53adab(0x113)]({'where':{'id':_0x1d8d75[_0x53adab(0x1b5)]},'data':{'balance':_0x6af3e7,'totalPaidOut':_0x29dafa}}),console[_0x53adab(0x1e4)](_0x53adab(0x24b)+_0x1d8d75['shop'][_0x53adab(0x1d9)]+'\x20balance\x20updated:'),console[_0x53adab(0x1e4)](_0x53adab(0x1a6)+_0x12a67b['toFixed'](0x6)+_0x53adab(0x1f2)+_0x6af3e7[_0x53adab(0x1f0)](0x6)+_0x53adab(0xde)),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0xea0ef[_0x53adab(0x1f0)](0x6)+_0x53adab(0x1f2)+_0x29dafa[_0x53adab(0x1f0)](0x6)+_0x53adab(0xde));}return console[_0x53adab(0x1e4)](_0x53adab(0xb7)+_0x297b10+_0x53adab(0xfb)),_0x1b4b55;});return{'id':_0x4f669d['id'],'shopId':_0x4f669d['shopId'],'shopName':_0x4f669d[_0x2a1148(0x215)][_0x2a1148(0x99)],'shopUsername':_0x4f669d[_0x2a1148(0x215)]['username'],'amount':Number(_0x4f669d[_0x2a1148(0x205)]),'network':_0x4f669d[_0x2a1148(0x249)],'wallet':_0x4f669d[_0x2a1148(0x188)],'status':_0x4f669d[_0x2a1148(0x12e)],'txid':_0x4f669d[_0x2a1148(0x185)],'notes':_0x4f669d[_0x2a1148(0xb3)],'periodFrom':_0x4f669d[_0x2a1148(0x14d)],'periodTo':_0x4f669d[_0x2a1148(0x127)],'createdAt':_0x4f669d[_0x2a1148(0xba)],'paidAt':_0x4f669d[_0x2a1148(0xc0)]};}async[a48_0xb1fe34(0x18b)](_0x34aa46){const _0x316c92=a48_0xb1fe34,{page:_0x42b129,limit:_0x1eccc4,status:_0x18aa1e,gateway:_0x37f27e,shopId:_0x374451,dateFrom:_0x4eb707,dateTo:_0x50273d,search:_0x25e1f1,currency:_0x1ebc17,sortBy:_0x1f1d82,sortOrder:_0x6249c9}=_0x34aa46,_0x35a872=(_0x42b129-0x1)*_0x1eccc4;console[_0x316c92(0x1e4)](_0x316c92(0x17b),_0x34aa46);const _0x26ad6e=await database_1[_0x316c92(0x258)][_0x316c92(0x157)]['groupBy']({'by':[_0x316c92(0x141)],'_count':{'gateway':!![]}});console['log'](_0x316c92(0x9c),_0x26ad6e[_0x316c92(0xd6)](_0xe87e49=>_0xe87e49['gateway']+'\x20('+_0xe87e49['_count'][_0x316c92(0x141)]+'\x20payments)'));if(_0x37f27e){const _0x4ee777=_0x26ad6e[_0x316c92(0xaa)](_0x5b8913=>_0x5b8913[_0x316c92(0x141)]['toLowerCase']()===_0x37f27e[_0x316c92(0x192)]());!_0x4ee777&&_0x37f27e[_0x316c92(0x192)]()!==_0x316c92(0x217)&&console[_0x316c92(0x1e4)](_0x316c92(0x235)+_0x37f27e+_0x316c92(0x151)+_0x26ad6e[_0x316c92(0xd6)](_0x242ac8=>_0x242ac8[_0x316c92(0x141)])[_0x316c92(0x16e)](',\x20'));}const _0x44ea98={};_0x18aa1e&&(_0x44ea98[_0x316c92(0x12e)]=_0x18aa1e[_0x316c92(0x212)]());if(!_0x37f27e)_0x44ea98[_0x316c92(0x141)]={'not':_0x316c92(0x217)};else{if(_0x37f27e&&(_0x37f27e[_0x316c92(0x192)]()===_0x316c92(0x217)||_0x37f27e===_0x316c92(0x1f8)))_0x44ea98[_0x316c92(0x141)]=_0x316c92(0x217);else{let _0x227959=_0x37f27e;const _0x36632c=(0x0,gateway_1[_0x316c92(0xd9)])(_0x37f27e);if(_0x36632c)_0x227959=_0x36632c,console[_0x316c92(0x1e4)]('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0x37f27e+_0x316c92(0x1ad)+_0x227959+'\x27');else{const _0x235688=(0x0,gateway_1[_0x316c92(0x1df)])(_0x37f27e);if(_0x235688){const _0x3ccba8=(0x0,gateway_1[_0x316c92(0xd9)])(_0x235688);_0x3ccba8&&(_0x227959=_0x3ccba8,console['log']('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0x37f27e+_0x316c92(0xdb)+_0x235688+_0x316c92(0x1d1)+_0x227959+'\x27'));}else console['log'](_0x316c92(0x135)+_0x37f27e+_0x316c92(0x21c));}const _0x7f531b=await database_1[_0x316c92(0x258)][_0x316c92(0x157)][_0x316c92(0x17c)]({'where':{'gateway':_0x227959[_0x316c92(0x192)]()},'take':0x1});_0x7f531b===0x0?(console[_0x316c92(0x1e4)](_0x316c92(0x237)+_0x227959+'\x27\x20(from\x20\x27'+_0x37f27e+_0x316c92(0x175)),_0x44ea98[_0x316c92(0x141)]='NONEXISTENT_GATEWAY_FILTER'):(_0x44ea98[_0x316c92(0x141)]=_0x227959['toLowerCase'](),console[_0x316c92(0x1e4)](_0x316c92(0x104)+_0x227959+'\x27\x20(from\x20\x27'+_0x37f27e+'\x27)'));}}console['log'](_0x316c92(0x160),_0x44ea98[_0x316c92(0x141)]);_0x374451&&(_0x44ea98[_0x316c92(0x1b5)]=_0x374451);_0x1ebc17&&(_0x44ea98['currency']=_0x1ebc17[_0x316c92(0x212)](),console['log'](_0x316c92(0x1cb)+_0x1ebc17[_0x316c92(0x212)]()));if(_0x4eb707||_0x50273d){_0x44ea98[_0x316c92(0xba)]={};if(_0x4eb707){const _0x34278d=new Date(_0x4eb707),_0x535d34=new Date(Date[_0x316c92(0x16d)](_0x34278d[_0x316c92(0x1dd)](),_0x34278d[_0x316c92(0x1da)](),_0x34278d[_0x316c92(0x20b)](),0x0,0x0,0x0,0x0));_0x44ea98['createdAt'][_0x316c92(0xf6)]=_0x535d34,console[_0x316c92(0x1e4)](_0x316c92(0x241)+_0x535d34[_0x316c92(0x1b1)]());}if(_0x50273d){const _0x9361a8=new Date(_0x50273d),_0x2d7af9=new Date(Date[_0x316c92(0x16d)](_0x9361a8[_0x316c92(0x1dd)](),_0x9361a8[_0x316c92(0x1da)](),_0x9361a8[_0x316c92(0x20b)](),0x17,0x3b,0x3b,0x3e7));_0x44ea98[_0x316c92(0xba)][_0x316c92(0x250)]=_0x2d7af9,console['log']('üìÖ\x20Date\x20to\x20filter:\x20'+_0x2d7af9[_0x316c92(0x1b1)]());}}_0x25e1f1&&(_0x44ea98['OR']=[{'id':{'contains':_0x25e1f1,'mode':_0x316c92(0x1e0)}},{'orderId':{'contains':_0x25e1f1,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x25e1f1,'mode':_0x316c92(0x1e0)}},{'customerEmail':{'contains':_0x25e1f1,'mode':_0x316c92(0x1e0)}},{'shop':{'name':{'contains':_0x25e1f1,'mode':_0x316c92(0x1e0)}}},{'shop':{'username':{'contains':_0x25e1f1,'mode':_0x316c92(0x1e0)}}}]);console['log'](_0x316c92(0xd5),JSON['stringify'](_0x44ea98,null,0x2));const _0x2408b8=await database_1['default'][_0x316c92(0x157)][_0x316c92(0x17c)]({'where':_0x44ea98});console[_0x316c92(0x1e4)](_0x316c92(0x21e)+_0x2408b8);let _0x410cfc={'createdAt':'desc'};if(_0x1f1d82){const _0x1b86ef=[_0x316c92(0x205),_0x316c92(0xba),'updatedAt',_0x316c92(0x12e),_0x316c92(0x141),_0x316c92(0x13d)],_0x2dc4ee=[_0x316c92(0x1d4),_0x316c92(0x123)];if(_0x1b86ef[_0x316c92(0x1f3)](_0x1f1d82)){const _0x147e9d=_0x2dc4ee[_0x316c92(0x1f3)](_0x6249c9)?_0x6249c9:_0x316c92(0x123);_0x410cfc={[_0x1f1d82]:_0x147e9d},console['log'](_0x316c92(0x164)+_0x1f1d82+_0x316c92(0xc2)+_0x147e9d+_0x316c92(0x24f));}}const [_0x56a63f,_0x443d74]=await Promise[_0x316c92(0xb2)]([database_1[_0x316c92(0x258)][_0x316c92(0x157)][_0x316c92(0xf8)]({'where':_0x44ea98,'skip':_0x35a872,'take':_0x1eccc4,'orderBy':_0x410cfc,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x316c92(0x157)][_0x316c92(0x17c)]({'where':_0x44ea98})]);let _0x30b32d,_0x561e82;if(_0x4eb707){const _0x137927=new Date(_0x4eb707);_0x30b32d=new Date(Date[_0x316c92(0x16d)](_0x137927[_0x316c92(0x1dd)](),_0x137927['getUTCMonth'](),_0x137927[_0x316c92(0x20b)](),0x0,0x0,0x0,0x0));}else{const _0x18066f=new Date();_0x30b32d=new Date(Date[_0x316c92(0x16d)](_0x18066f['getUTCFullYear'](),_0x18066f['getUTCMonth'](),_0x18066f[_0x316c92(0x20b)](),0x0,0x0,0x0,0x0));}if(_0x50273d){const _0x1a1e5d=new Date(_0x50273d);_0x561e82=new Date(Date[_0x316c92(0x16d)](_0x1a1e5d[_0x316c92(0x1dd)](),_0x1a1e5d[_0x316c92(0x1da)](),_0x1a1e5d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x4eb707){const _0x1e5c5e=new Date(_0x4eb707);_0x561e82=new Date(Date[_0x316c92(0x16d)](_0x1e5c5e[_0x316c92(0x1dd)](),_0x1e5c5e[_0x316c92(0x1da)](),_0x1e5c5e[_0x316c92(0x20b)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x21a69c=new Date();_0x561e82=new Date(Date[_0x316c92(0x16d)](_0x21a69c[_0x316c92(0x1dd)](),_0x21a69c['getUTCMonth'](),_0x21a69c[_0x316c92(0x20b)](),0x17,0x3b,0x3b,0x3e7));}}const _0x25c8cb={'status':'PAID','createdAt':{'gte':_0x30b32d,'lte':_0x561e82}};_0x37f27e?_0x25c8cb[_0x316c92(0x141)]=_0x44ea98[_0x316c92(0x141)]:_0x25c8cb[_0x316c92(0x141)]={'not':_0x316c92(0x217)};_0x374451&&(_0x25c8cb[_0x316c92(0x1b5)]=_0x374451);_0x1ebc17&&(_0x25c8cb[_0x316c92(0x13d)]=_0x1ebc17['toUpperCase']());console['log'](_0x316c92(0xfd),JSON[_0x316c92(0x227)](_0x25c8cb,null,0x2));const _0x293c02=await database_1[_0x316c92(0x258)][_0x316c92(0x157)]['findMany']({'where':_0x25c8cb,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}}),_0x337dc6={};let _0x1e05f7=0x0;return _0x293c02[_0x316c92(0x210)](_0x52c03d=>{const _0x5530ad=_0x316c92;_0x52c03d[_0x5530ad(0x97)]&&(_0x1e05f7+=_0x52c03d[_0x5530ad(0x97)]);if(_0x52c03d[_0x5530ad(0x13d)]){const _0x550692=_0x52c03d[_0x5530ad(0x13d)][_0x5530ad(0x212)]();!_0x337dc6[_0x550692]&&(_0x337dc6[_0x550692]=0x0),_0x337dc6[_0x550692]+=_0x52c03d[_0x5530ad(0x205)];}}),_0x1e05f7>0x0&&(_0x337dc6[_0x316c92(0xa6)]=_0x1e05f7),{'payments':_0x56a63f,'pagination':{'page':_0x42b129,'limit':_0x1eccc4,'total':_0x443d74,'totalPages':Math[_0x316c92(0xf7)](_0x443d74/_0x1eccc4)},'statistics':_0x337dc6};}async[a48_0xb1fe34(0x9e)](_0x277dd8){const _0x24c54d=a48_0xb1fe34,_0x244815=await database_1[_0x24c54d(0x258)][_0x24c54d(0x157)][_0x24c54d(0x187)]({'where':{'id':_0x277dd8},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x244815)return null;return{'id':_0x244815['id'],'shopId':_0x244815[_0x24c54d(0x1b5)],'gateway':_0x244815['gateway'],'amount':_0x244815[_0x24c54d(0x205)],'currency':_0x244815[_0x24c54d(0x13d)],'status':_0x244815[_0x24c54d(0x12e)],'orderId':_0x244815[_0x24c54d(0x239)],'gatewayOrderId':_0x244815[_0x24c54d(0x186)],'customerEmail':_0x244815[_0x24c54d(0x107)],'customerName':_0x244815['customerName'],'customerCountry':_0x244815['customerCountry'],'customerIp':_0x244815[_0x24c54d(0x11d)],'customerUa':_0x244815['customerUa'],'failureMessage':_0x244815[_0x24c54d(0x246)],'externalPaymentUrl':_0x244815['externalPaymentUrl'],'successUrl':_0x244815[_0x24c54d(0x1fc)],'failUrl':_0x244815['failUrl'],'pendingUrl':_0x244815[_0x24c54d(0x18e)],'whiteUrl':_0x244815[_0x24c54d(0x226)],'createdAt':_0x244815[_0x24c54d(0xba)],'updatedAt':_0x244815[_0x24c54d(0x190)],'shop':_0x244815[_0x24c54d(0x215)]};}async[a48_0xb1fe34(0xe6)](_0x21d96d,_0x6704a2,_0x4d3042,_0x68155c){const _0x250397=a48_0xb1fe34,_0x3e8c4a=await database_1['default'][_0x250397(0xf2)](async _0xf30351=>{const _0x140c6a=_0x250397,_0x191f2e=await _0xf30351['payment'][_0x140c6a(0x187)]({'where':{'id':_0x21d96d},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x191f2e)throw new Error('Payment\x20not\x20found');const _0x3adf8f=_0x191f2e[_0x140c6a(0x12e)],_0x2199e0=_0x6704a2[_0x140c6a(0x212)]();console[_0x140c6a(0x1e4)](_0x140c6a(0x22f)+_0x21d96d+_0x140c6a(0xf1)+_0x3adf8f+_0x140c6a(0x1f2)+_0x2199e0),console['log'](_0x140c6a(0x1bd)+_0x191f2e['shop'][_0x140c6a(0x1c2)]+_0x140c6a(0xde));const _0xc731b6={'status':_0x2199e0,'updatedAt':new Date(),'statusChangedBy':_0x140c6a(0xc7),'statusChangedAt':new Date()};_0x4d3042&&(_0xc731b6[_0x140c6a(0x1e5)]=_0x4d3042);_0x2199e0===_0x140c6a(0x204)&&_0x68155c&&(_0xc731b6[_0x140c6a(0x15d)]=_0x68155c);let _0x22bad6=0x0,_0x52eff0=_0x191f2e[_0x140c6a(0x215)]['balance'];if(_0x2199e0==='PAID'&&_0x3adf8f!==_0x140c6a(0xcf)){_0xc731b6[_0x140c6a(0xc0)]=new Date();const _0x1a47d1=await currencyService_1[_0x140c6a(0x16a)][_0x140c6a(0x1d6)](_0x191f2e[_0x140c6a(0x205)],_0x191f2e[_0x140c6a(0x13d)]);_0xc731b6[_0x140c6a(0x97)]=_0x1a47d1;let _0x370721=0x2d;const _0x18790a=await _0xf30351[_0x140c6a(0x215)]['findUnique']({'where':{'id':_0x191f2e[_0x140c6a(0x1b5)]},'select':{'gatewaySettings':!![]}});if(_0x18790a?.[_0x140c6a(0x14f)])try{const _0x2fc7bc=JSON[_0x140c6a(0x1e6)](_0x18790a['gatewaySettings']);for(const [_0x136a1d,_0x3a6e10]of Object[_0x140c6a(0x112)](_0x2fc7bc)){if(_0x136a1d[_0x140c6a(0x192)]()===_0x191f2e['gateway']['toLowerCase']()){_0x370721=_0x3a6e10[_0x140c6a(0x256)]||0xa;break;}}}catch(_0x5ceba){console[_0x140c6a(0x1d3)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x21d96d+':',_0x5ceba);}let _0x10b487;_0x191f2e[_0x140c6a(0x14b)]!==null&&_0x191f2e[_0x140c6a(0x14b)]!==undefined?(_0x10b487=_0x191f2e[_0x140c6a(0x14b)],console[_0x140c6a(0x1e4)](_0x140c6a(0x109)+_0x10b487['toFixed'](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x21d96d)):(_0x10b487=_0x1a47d1*(0x1-_0x370721/0x64),console[_0x140c6a(0x1e4)](_0x140c6a(0x1ae)+_0x21d96d+':\x20'+_0x370721+_0x140c6a(0xb6)+_0x1a47d1['toFixed'](0x6)+_0x140c6a(0xde)),_0xc731b6[_0x140c6a(0x14b)]=_0x10b487,_0xc731b6[_0x140c6a(0x9b)]=_0x370721),_0x22bad6=_0x10b487,_0x52eff0+=_0x10b487,console['log'](_0x140c6a(0x147)+_0x21d96d+_0x140c6a(0x223)),console[_0x140c6a(0x1e4)](_0x140c6a(0x21b)+_0x1a47d1[_0x140c6a(0x1f0)](0x6)+_0x140c6a(0xde)),console[_0x140c6a(0x1e4)](_0x140c6a(0xcb)+_0x191f2e[_0x140c6a(0x141)]+_0x140c6a(0x24e)+_0x370721+'%'),console[_0x140c6a(0x1e4)](_0x140c6a(0x178)+_0x10b487[_0x140c6a(0x1f0)](0x6)+_0x140c6a(0x21a)+_0x370721+_0x140c6a(0x172)),console[_0x140c6a(0x1e4)](_0x140c6a(0x181)+_0x10b487['toFixed'](0x6)+'\x20USDT');}else{if(_0x3adf8f===_0x140c6a(0xcf)&&_0x2199e0!=='PAID'&&_0x2199e0!==_0x140c6a(0x204)){if(_0x191f2e[_0x140c6a(0x97)]){let _0x2fb44a=0x2d;const _0x1f65e4=await _0xf30351[_0x140c6a(0x215)]['findUnique']({'where':{'id':_0x191f2e[_0x140c6a(0x1b5)]},'select':{'gatewaySettings':!![]}});if(_0x1f65e4?.[_0x140c6a(0x14f)])try{const _0x28ff22=JSON[_0x140c6a(0x1e6)](_0x1f65e4[_0x140c6a(0x14f)]);for(const [_0x437cf5,_0x35678e]of Object['entries'](_0x28ff22)){if(_0x437cf5['toLowerCase']()===_0x191f2e[_0x140c6a(0x141)][_0x140c6a(0x192)]()){_0x2fb44a=_0x35678e[_0x140c6a(0x256)]||0xa;break;}}}catch(_0x2d8132){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x21d96d+':',_0x2d8132);}const _0x3b8319=_0x191f2e[_0x140c6a(0x97)]*(0x1-_0x2fb44a/0x64);_0x22bad6=-_0x3b8319,_0x52eff0-=_0x3b8319,console[_0x140c6a(0x1e4)](_0x140c6a(0x21b)+_0x191f2e[_0x140c6a(0x97)][_0x140c6a(0x1f0)](0x6)+_0x140c6a(0xde)),console['log'](_0x140c6a(0xcb)+_0x191f2e[_0x140c6a(0x141)]+_0x140c6a(0x24e)+_0x2fb44a+'%'),console[_0x140c6a(0x1e4)](_0x140c6a(0x230)+_0x3b8319[_0x140c6a(0x1f0)](0x6)+_0x140c6a(0x21a)+_0x2fb44a+_0x140c6a(0x172)),console['log'](_0x140c6a(0x19b)+_0x3b8319['toFixed'](0x6)+_0x140c6a(0xde));}}}_0x2199e0===_0x140c6a(0x204)&&(console['log'](_0x140c6a(0x163)),_0x68155c&&_0x68155c>0x0?(_0x22bad6=-_0x68155c,_0x52eff0-=_0x68155c,console[_0x140c6a(0x1e4)]('üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x68155c[_0x140c6a(0x1f0)](0x6)+_0x140c6a(0x111)),console[_0x140c6a(0x1e4)](_0x140c6a(0xd3))):console[_0x140c6a(0x1e4)]('‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0xc731b6[_0x140c6a(0x15d)]=_0x68155c||0x0);_0x2199e0===_0x140c6a(0x1b4)&&_0x3adf8f==='PAID'&&console[_0x140c6a(0x1e4)](_0x140c6a(0x100));const _0x37d8ec=await _0xf30351[_0x140c6a(0x157)][_0x140c6a(0x113)]({'where':{'id':_0x21d96d},'data':_0xc731b6,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x22bad6!==0x0&&(await _0xf30351[_0x140c6a(0x215)][_0x140c6a(0x113)]({'where':{'id':_0x191f2e[_0x140c6a(0x1b5)]},'data':{'balance':_0x52eff0}}),console[_0x140c6a(0x1e4)](_0x140c6a(0x24b)+_0x191f2e[_0x140c6a(0x1b5)]+_0x140c6a(0xab)+_0x191f2e[_0x140c6a(0x215)]['balance'][_0x140c6a(0x1f0)](0x6)+_0x140c6a(0x1f2)+_0x52eff0[_0x140c6a(0x1f0)](0x6)+_0x140c6a(0xda)+(_0x22bad6>0x0?'+':'')+_0x22bad6['toFixed'](0x6)+')')),_0x37d8ec;});return{'id':_0x3e8c4a['id'],'shopId':_0x3e8c4a[_0x250397(0x1b5)],'gateway':_0x3e8c4a['gateway'],'amount':_0x3e8c4a[_0x250397(0x205)],'currency':_0x3e8c4a[_0x250397(0x13d)],'status':_0x3e8c4a[_0x250397(0x12e)],'orderId':_0x3e8c4a[_0x250397(0x239)],'gatewayOrderId':_0x3e8c4a[_0x250397(0x186)],'customerEmail':_0x3e8c4a[_0x250397(0x107)],'customerName':_0x3e8c4a[_0x250397(0x218)],'customerCountry':_0x3e8c4a['customerCountry'],'customerIp':_0x3e8c4a['customerIp'],'customerUa':_0x3e8c4a[_0x250397(0x25c)],'failureMessage':_0x3e8c4a[_0x250397(0x246)],'adminNotes':_0x3e8c4a[_0x250397(0x1e5)],'chargebackAmount':_0x3e8c4a[_0x250397(0x15d)],'statusChangedBy':_0x3e8c4a['statusChangedBy'],'statusChangedAt':_0x3e8c4a[_0x250397(0x244)],'createdAt':_0x3e8c4a[_0x250397(0xba)],'updatedAt':_0x3e8c4a[_0x250397(0x190)],'shop':_0x3e8c4a[_0x250397(0x215)]};}async['updateUser'](_0x5f40e9,_0x3ee3d9){const _0x94a988=a48_0xb1fe34,_0x3205f3=Math[_0x94a988(0x19e)]()[_0x94a988(0x22c)](0x24)[_0x94a988(0x18c)](0x2,0x9);console[_0x94a988(0x1e4)]('üéØ\x20updateUser\x20called\x20with\x20ID:\x20'+_0x3205f3+',\x20userId:\x20'+_0x5f40e9);const _0x404229={..._0x3ee3d9};_0x3ee3d9[_0x94a988(0x129)]&&_0x3ee3d9[_0x94a988(0x129)][_0x94a988(0x11f)]()!==''?(console[_0x94a988(0x1e4)]('üîê\x20['+_0x3205f3+_0x94a988(0x122)+_0x5f40e9),_0x404229[_0x94a988(0x129)]=await bcryptjs_1[_0x94a988(0x258)]['hash'](_0x3ee3d9[_0x94a988(0x129)],0xc)):(console[_0x94a988(0x1e4)]('üîê\x20['+_0x3205f3+_0x94a988(0x1c0)),delete _0x404229['password']);_0x3ee3d9[_0x94a988(0xd0)]&&(_0x404229['name']=_0x3ee3d9['fullName'],delete _0x404229[_0x94a988(0xd0)]);_0x3ee3d9[_0x94a988(0x1ee)]&&(_0x404229[_0x94a988(0x103)]=_0x3ee3d9[_0x94a988(0x1ee)],delete _0x404229[_0x94a988(0x1ee)]);_0x3ee3d9[_0x94a988(0x12c)]&&(_0x404229[_0x94a988(0x23c)]=_0x3ee3d9['merchantUrl'],delete _0x404229[_0x94a988(0x12c)]);if(_0x3ee3d9[_0x94a988(0x22d)]){const _0x1e4ff8=_0x3ee3d9[_0x94a988(0x22d)][_0x94a988(0xd6)](_0x383436=>this[_0x94a988(0xae)](_0x383436));console[_0x94a988(0x1e4)]('üîÑ\x20Gateway\x20mapping:',_0x3ee3d9['gateways'],'->',_0x1e4ff8),_0x404229[_0x94a988(0x1ce)]=JSON[_0x94a988(0x227)](_0x1e4ff8),delete _0x404229[_0x94a988(0x22d)];}_0x3ee3d9[_0x94a988(0x14f)]&&(console[_0x94a988(0x1e4)](_0x94a988(0xac)+_0x3205f3+_0x94a988(0x11e),_0x3ee3d9[_0x94a988(0x14f)]),_0x404229[_0x94a988(0x14f)]=JSON['stringify'](_0x3ee3d9[_0x94a988(0x14f)]),console['log'](_0x94a988(0xac)+_0x3205f3+']\x20Gateway\x20settings\x20JSON\x20string:',_0x404229[_0x94a988(0x14f)]));_0x3ee3d9[_0x94a988(0x118)]&&(_0x3ee3d9['wallets'][_0x94a988(0x216)]!==undefined&&(_0x404229[_0x94a988(0x216)]=_0x3ee3d9[_0x94a988(0x118)][_0x94a988(0x216)]||null),_0x3ee3d9['wallets'][_0x94a988(0x252)]!==undefined&&(_0x404229[_0x94a988(0x252)]=_0x3ee3d9[_0x94a988(0x118)][_0x94a988(0x252)]||null),_0x3ee3d9[_0x94a988(0x118)][_0x94a988(0x11b)]!==undefined&&(_0x404229[_0x94a988(0x11b)]=_0x3ee3d9[_0x94a988(0x118)][_0x94a988(0x11b)]||null),_0x3ee3d9['wallets']['usdcPolygonWallet']!==undefined&&(_0x404229[_0x94a988(0x108)]=_0x3ee3d9[_0x94a988(0x118)]['usdcPolygonWallet']||null),delete _0x404229[_0x94a988(0x118)]);const _0x144c2c=await database_1[_0x94a988(0x258)][_0x94a988(0x215)][_0x94a988(0x113)]({'where':{'id':_0x5f40e9},'data':_0x404229,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x94a988(0x1e4)](_0x94a988(0x200)+_0x3205f3+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x144c2c['gatewaySettings']),{'id':_0x144c2c['id'],'fullName':_0x144c2c[_0x94a988(0x99)],'username':_0x144c2c[_0x94a988(0x1d9)],'telegramId':_0x144c2c[_0x94a988(0x103)],'merchantUrl':_0x144c2c[_0x94a988(0x23c)],'gateways':_0x144c2c['paymentGateways']?JSON[_0x94a988(0x1e6)](_0x144c2c[_0x94a988(0x1ce)]):null,'gatewaySettings':_0x144c2c[_0x94a988(0x14f)]?JSON[_0x94a988(0x1e6)](_0x144c2c[_0x94a988(0x14f)]):null,'publicKey':_0x144c2c['publicKey'],'wallets':{'usdtPolygonWallet':_0x144c2c['usdtPolygonWallet'],'usdtTrcWallet':_0x144c2c[_0x94a988(0x252)],'usdtErcWallet':_0x144c2c[_0x94a988(0x11b)],'usdcPolygonWallet':_0x144c2c[_0x94a988(0x108)]},'status':_0x144c2c[_0x94a988(0x12e)],'createdAt':_0x144c2c[_0x94a988(0xba)]};}async[a48_0xb1fe34(0xd7)](_0x2c93c5){const _0x160882=a48_0xb1fe34,_0x2e2dc3=await database_1[_0x160882(0x258)]['shop'][_0x160882(0x113)]({'where':{'id':_0x2c93c5},'data':{'status':_0x160882(0x221)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e2dc3['id'],'fullName':_0x2e2dc3[_0x160882(0x99)],'username':_0x2e2dc3[_0x160882(0x1d9)],'telegramId':_0x2e2dc3[_0x160882(0x103)],'merchantUrl':_0x2e2dc3[_0x160882(0x23c)],'gateways':_0x2e2dc3[_0x160882(0x1ce)]?JSON['parse'](_0x2e2dc3[_0x160882(0x1ce)]):null,'gatewaySettings':_0x2e2dc3[_0x160882(0x14f)]?JSON[_0x160882(0x1e6)](_0x2e2dc3[_0x160882(0x14f)]):null,'publicKey':_0x2e2dc3[_0x160882(0xed)],'wallets':{'usdtPolygonWallet':_0x2e2dc3['usdtPolygonWallet'],'usdtTrcWallet':_0x2e2dc3[_0x160882(0x252)],'usdtErcWallet':_0x2e2dc3[_0x160882(0x11b)],'usdcPolygonWallet':_0x2e2dc3[_0x160882(0x108)]},'status':_0x2e2dc3[_0x160882(0x12e)],'createdAt':_0x2e2dc3[_0x160882(0xba)]};}async['activateUser'](_0x2763f9){const _0x5ef454=a48_0xb1fe34,_0x5ca4c9=await database_1[_0x5ef454(0x258)][_0x5ef454(0x215)]['update']({'where':{'id':_0x2763f9},'data':{'status':_0x5ef454(0x96)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5ca4c9['id'],'fullName':_0x5ca4c9[_0x5ef454(0x99)],'username':_0x5ca4c9[_0x5ef454(0x1d9)],'telegramId':_0x5ca4c9[_0x5ef454(0x103)],'merchantUrl':_0x5ca4c9[_0x5ef454(0x23c)],'gateways':_0x5ca4c9[_0x5ef454(0x1ce)]?JSON['parse'](_0x5ca4c9[_0x5ef454(0x1ce)]):null,'gatewaySettings':_0x5ca4c9['gatewaySettings']?JSON[_0x5ef454(0x1e6)](_0x5ca4c9[_0x5ef454(0x14f)]):null,'publicKey':_0x5ca4c9[_0x5ef454(0xed)],'wallets':{'usdtPolygonWallet':_0x5ca4c9['usdtPolygonWallet'],'usdtTrcWallet':_0x5ca4c9[_0x5ef454(0x252)],'usdtErcWallet':_0x5ca4c9[_0x5ef454(0x11b)],'usdcPolygonWallet':_0x5ca4c9[_0x5ef454(0x108)]},'status':_0x5ca4c9['status'],'createdAt':_0x5ca4c9[_0x5ef454(0xba)]};}async[a48_0xb1fe34(0x1b3)](_0x1c4461){const _0x353b55=a48_0xb1fe34,{page:_0x22c21b,limit:_0x5c7aa6,status:_0x5558be,search:_0x386bf9}=_0x1c4461,_0x7ffdba=(_0x22c21b-0x1)*_0x5c7aa6,_0x4f2df5={};_0x5558be&&(_0x4f2df5[_0x353b55(0x12e)]=_0x5558be[_0x353b55(0x212)]());_0x386bf9&&(_0x4f2df5['OR']=[{'name':{'contains':_0x386bf9,'mode':_0x353b55(0x1e0)}},{'username':{'contains':_0x386bf9,'mode':_0x353b55(0x1e0)}},{'telegram':{'contains':_0x386bf9,'mode':_0x353b55(0x1e0)}},{'shopUrl':{'contains':_0x386bf9,'mode':'insensitive'}}]);const [_0x4de91c,_0x3ed2ce]=await Promise[_0x353b55(0xb2)]([database_1[_0x353b55(0x258)][_0x353b55(0x215)]['findMany']({'where':_0x4f2df5,'skip':_0x7ffdba,'take':_0x5c7aa6,'orderBy':{'createdAt':_0x353b55(0x123)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x353b55(0x258)][_0x353b55(0x215)]['count']({'where':_0x4f2df5})]);return{'users':_0x4de91c['map'](_0x56d705=>{const _0x27834f=_0x353b55,_0x2cfde1=_0x56d705['paymentGateways']?JSON['parse'](_0x56d705[_0x27834f(0x1ce)]):null,_0x3ceb5b=_0x2cfde1?_0x2cfde1[_0x27834f(0xd6)](_0x2dbffd=>this['getGatewayDisplayName'](_0x2dbffd)):null;return{'id':_0x56d705['id'],'fullName':_0x56d705[_0x27834f(0x99)],'username':_0x56d705[_0x27834f(0x1d9)],'telegramId':_0x56d705[_0x27834f(0x103)],'merchantUrl':_0x56d705['shopUrl'],'gateways':_0x3ceb5b,'gatewaySettings':_0x56d705[_0x27834f(0x14f)]?JSON[_0x27834f(0x1e6)](_0x56d705[_0x27834f(0x14f)]):null,'publicKey':_0x56d705['publicKey'],'wallets':{'usdtPolygonWallet':_0x56d705['usdtPolygonWallet'],'usdtTrcWallet':_0x56d705[_0x27834f(0x252)],'usdtErcWallet':_0x56d705[_0x27834f(0x11b)],'usdcPolygonWallet':_0x56d705[_0x27834f(0x108)],'usdcErcWallet':_0x56d705['usdcErcWallet']},'status':_0x56d705[_0x27834f(0x12e)],'twoFactorEnabled':_0x56d705['twoFactorEnabled']||![],'telegramUsersCount':_0x56d705[_0x27834f(0x1b8)][_0x27834f(0x234)],'createdAt':_0x56d705[_0x27834f(0xba)],'lastLoginAt':_0x56d705[_0x27834f(0x1e7)]};}),'pagination':{'page':_0x22c21b,'limit':_0x5c7aa6,'total':_0x3ed2ce,'totalPages':Math['ceil'](_0x3ed2ce/_0x5c7aa6)}};}async[a48_0xb1fe34(0x171)](_0x13bdf4){const _0x2f1932=a48_0xb1fe34,_0x18f042=await database_1['default'][_0x2f1932(0x215)]['findUnique']({'where':{'id':_0x13bdf4},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x18f042)return null;const _0x564d45=_0x18f042[_0x2f1932(0x1ce)]?JSON[_0x2f1932(0x1e6)](_0x18f042[_0x2f1932(0x1ce)]):null,_0x4fa068=_0x564d45?_0x564d45[_0x2f1932(0xd6)](_0x364351=>this['getGatewayDisplayName'](_0x364351)):null;return _0x564d45&&_0x4fa068&&console[_0x2f1932(0x1e4)](_0x2f1932(0x120),_0x564d45,'->',_0x4fa068),{'id':_0x18f042['id'],'fullName':_0x18f042['name'],'username':_0x18f042[_0x2f1932(0x1d9)],'telegramId':_0x18f042[_0x2f1932(0x103)],'merchantUrl':_0x18f042[_0x2f1932(0x23c)],'gateways':_0x4fa068,'gatewaySettings':_0x18f042['gatewaySettings']?JSON['parse'](_0x18f042['gatewaySettings']):null,'publicKey':_0x18f042[_0x2f1932(0xed)],'wallets':{'usdtPolygonWallet':_0x18f042['usdtPolygonWallet'],'usdtTrcWallet':_0x18f042['usdtTrcWallet'],'usdtErcWallet':_0x18f042[_0x2f1932(0x11b)],'usdcPolygonWallet':_0x18f042[_0x2f1932(0x108)],'usdcErcWallet':_0x18f042[_0x2f1932(0x228)]},'status':_0x18f042[_0x2f1932(0x12e)],'createdAt':_0x18f042['createdAt']};}async[a48_0xb1fe34(0x232)](_0x13dd6a){const _0x2005e1=a48_0xb1fe34,{fullName:_0x3b0fb1,username:_0x25812f,password:_0x273414,telegramId:_0x135e0f,merchantUrl:_0x24eef2,gateways:_0x1997b3,gatewaySettings:_0x3b6e04,wallets:_0x9da187}=_0x13dd6a,_0x4e82c8=await database_1[_0x2005e1(0x258)][_0x2005e1(0x215)][_0x2005e1(0x187)]({'where':{'username':_0x25812f}});if(_0x4e82c8)throw new Error(_0x2005e1(0x18a));if(_0x135e0f){const _0x4e0c1a=await database_1[_0x2005e1(0x258)][_0x2005e1(0x215)]['findUnique']({'where':{'telegram':_0x135e0f}});if(_0x4e0c1a)throw new Error(_0x2005e1(0x209));}const _0x2f3623=await bcryptjs_1[_0x2005e1(0x258)][_0x2005e1(0x201)](_0x273414,0xc),_0x591c29=_0x2005e1(0x1ff)+crypto_1[_0x2005e1(0x258)][_0x2005e1(0xb8)](0x20)['toString']('hex'),_0x3b3e99=_0x2005e1(0xbd)+crypto_1[_0x2005e1(0x258)][_0x2005e1(0xb8)](0x20)['toString'](_0x2005e1(0x14a)),_0x54d14a=_0x1997b3?_0x1997b3[_0x2005e1(0xd6)](_0x328d86=>this['getGatewayInternalName'](_0x328d86)):null;_0x1997b3&&_0x54d14a&&console[_0x2005e1(0x1e4)](_0x2005e1(0x13a),_0x1997b3,'->',_0x54d14a);const _0x42bfd7=await database_1[_0x2005e1(0x258)]['shop'][_0x2005e1(0x95)]({'data':{'name':_0x3b0fb1,'username':_0x25812f,'password':_0x2f3623,'telegram':_0x135e0f,'shopUrl':_0x24eef2,'paymentGateways':_0x54d14a?JSON['stringify'](_0x54d14a):null,'gatewaySettings':_0x3b6e04?JSON[_0x2005e1(0x227)](_0x3b6e04):null,'usdtPolygonWallet':_0x9da187?.[_0x2005e1(0x216)]||null,'usdtTrcWallet':_0x9da187?.['usdtTrcWallet']||null,'usdtErcWallet':_0x9da187?.[_0x2005e1(0x11b)]||null,'usdcPolygonWallet':_0x9da187?.['usdcPolygonWallet']||null,'publicKey':_0x591c29,'secretKey':_0x3b3e99,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x42bfd7['id'],'fullName':_0x42bfd7[_0x2005e1(0x99)],'username':_0x42bfd7[_0x2005e1(0x1d9)],'telegramId':_0x42bfd7[_0x2005e1(0x103)],'merchantUrl':_0x42bfd7[_0x2005e1(0x23c)],'gateways':_0x42bfd7['paymentGateways']?JSON['parse'](_0x42bfd7[_0x2005e1(0x1ce)]):null,'gatewaySettings':_0x42bfd7[_0x2005e1(0x14f)]?JSON[_0x2005e1(0x1e6)](_0x42bfd7['gatewaySettings']):null,'publicKey':_0x42bfd7[_0x2005e1(0xed)],'wallets':{'usdtPolygonWallet':_0x42bfd7[_0x2005e1(0x216)],'usdtTrcWallet':_0x42bfd7[_0x2005e1(0x252)],'usdtErcWallet':_0x42bfd7['usdtErcWallet'],'usdcPolygonWallet':_0x42bfd7[_0x2005e1(0x108)]},'status':_0x42bfd7['status'],'createdAt':_0x42bfd7[_0x2005e1(0xba)]};}async[a48_0xb1fe34(0x115)](_0x4a0eb0,_0x47954d){const _0x58bd9f=a48_0xb1fe34;if(config_1[_0x58bd9f(0x15e)][_0x58bd9f(0xc7)][_0x58bd9f(0x128)]){if(!_0x47954d)throw new Error(_0x58bd9f(0xe3));const _0x55963e=speakeasy_1[_0x58bd9f(0x258)][_0x58bd9f(0x15c)][_0x58bd9f(0x138)]({'secret':config_1[_0x58bd9f(0x15e)][_0x58bd9f(0xc7)][_0x58bd9f(0x1ac)],'encoding':_0x58bd9f(0x176),'token':_0x47954d,'window':0x2});if(!_0x55963e){let _0x54b091=![];if(config_1[_0x58bd9f(0x15e)][_0x58bd9f(0xc7)][_0x58bd9f(0x170)]){const _0x2a8f8e=JSON[_0x58bd9f(0x1e6)](config_1['config'][_0x58bd9f(0xc7)][_0x58bd9f(0x170)]);for(let _0x442505=0x0;_0x442505<_0x2a8f8e[_0x58bd9f(0x25a)];_0x442505++){const _0x568e6f=await bcryptjs_1['default'][_0x58bd9f(0x13f)](_0x47954d,_0x2a8f8e[_0x442505]);if(_0x568e6f){_0x54b091=!![],_0x2a8f8e[_0x58bd9f(0x1c4)](_0x442505,0x1),config_1[_0x58bd9f(0x15e)][_0x58bd9f(0xc7)]['backupCodes']=JSON[_0x58bd9f(0x227)](_0x2a8f8e);const _0x1f8a61=path_1['default'][_0x58bd9f(0x16e)](process[_0x58bd9f(0x1dc)](),_0x58bd9f(0x1a0));if(fs_1[_0x58bd9f(0x258)][_0x58bd9f(0x1f6)](_0x1f8a61)){let _0x478ae9=fs_1[_0x58bd9f(0x258)][_0x58bd9f(0x20e)](_0x1f8a61,_0x58bd9f(0xf5));const _0x12c7ae=_0x478ae9[_0x58bd9f(0x19c)]('\x0a');for(let _0x1c8890=0x0;_0x1c8890<_0x12c7ae[_0x58bd9f(0x25a)];_0x1c8890++){if(_0x12c7ae[_0x1c8890][_0x58bd9f(0x199)]('ADMIN_BACKUP_CODES=')){_0x12c7ae[_0x1c8890]='ADMIN_BACKUP_CODES='+JSON[_0x58bd9f(0x227)](_0x2a8f8e);break;}}fs_1[_0x58bd9f(0x258)]['writeFileSync'](_0x1f8a61,_0x12c7ae[_0x58bd9f(0x16e)]('\x0a'),_0x58bd9f(0xf5));}break;}}}if(!_0x54b091)throw new Error(_0x58bd9f(0xd8));}}await database_1[_0x58bd9f(0x258)][_0x58bd9f(0x215)][_0x58bd9f(0x149)]({'where':{'id':_0x4a0eb0}});}async[a48_0xb1fe34(0x214)](_0x52ec90){const _0x2ed198=a48_0xb1fe34,_0x2115df=await database_1[_0x2ed198(0x258)]['shop']['findUnique']({'where':{'id':_0x52ec90},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x2115df)throw new Error(_0x2ed198(0x126));return{'usdtPolygonWallet':_0x2115df[_0x2ed198(0x216)],'usdtTrcWallet':_0x2115df[_0x2ed198(0x252)],'usdtErcWallet':_0x2115df[_0x2ed198(0x11b)],'usdcPolygonWallet':_0x2115df[_0x2ed198(0x108)],'usdcErcWallet':_0x2115df[_0x2ed198(0x228)]};}['generateBackupCodes'](_0x763bce=0x8){const _0x11781a=a48_0xb1fe34,_0x2385af=[];for(let _0x2fca76=0x0;_0x2fca76<_0x763bce;_0x2fca76++){const _0xdd70c=crypto_1[_0x11781a(0x258)][_0x11781a(0xb8)](0x4)[_0x11781a(0x22c)](_0x11781a(0x14a))[_0x11781a(0x212)]();_0x2385af[_0x11781a(0x1cf)](_0xdd70c);}return _0x2385af;}async[a48_0xb1fe34(0x197)](_0x3793f5){const _0x25f2ac=a48_0xb1fe34,_0x4b150c=await database_1['default']['shop']['findUnique']({'where':{'id':_0x3793f5},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4b150c)throw new Error(_0x25f2ac(0x126));const _0x44e69f=speakeasy_1[_0x25f2ac(0x258)][_0x25f2ac(0xf9)]({'name':'TrapaPay\x20('+_0x4b150c[_0x25f2ac(0x1d9)]+')','issuer':_0x25f2ac(0x179),'length':0x20}),_0x21dcc5=await qrcode_1[_0x25f2ac(0x258)][_0x25f2ac(0x238)](_0x44e69f[_0x25f2ac(0x14e)]),_0x1f10fc=this['generateBackupCodes'](0x8),_0x4ac203=await Promise[_0x25f2ac(0xb2)](_0x1f10fc[_0x25f2ac(0xd6)](_0x555389=>bcryptjs_1[_0x25f2ac(0x258)][_0x25f2ac(0x201)](_0x555389,0xa)));return await database_1[_0x25f2ac(0x258)]['shop'][_0x25f2ac(0x113)]({'where':{'id':_0x3793f5},'data':{'twoFactorSecret':_0x44e69f['base32'],'backupCodes':JSON[_0x25f2ac(0x227)](_0x4ac203)}}),console[_0x25f2ac(0x1e4)](_0x25f2ac(0x1d2)+_0x4b150c[_0x25f2ac(0x1d9)]),console[_0x25f2ac(0x1e4)](_0x25f2ac(0xca)+_0x1f10fc[_0x25f2ac(0x25a)]+_0x25f2ac(0x162)),{'secret':_0x44e69f[_0x25f2ac(0x176)],'qrCode':_0x21dcc5,'manualEntryKey':_0x44e69f[_0x25f2ac(0x176)],'backupCodes':_0x1f10fc};}async[a48_0xb1fe34(0x1c6)](_0x159a0c,_0x1ce02d){const _0x27dcf9=a48_0xb1fe34,_0x1723e7=await database_1[_0x27dcf9(0x258)][_0x27dcf9(0x215)][_0x27dcf9(0x187)]({'where':{'id':_0x159a0c},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x1723e7)throw new Error(_0x27dcf9(0x126));if(!_0x1723e7[_0x27dcf9(0x1ac)])throw new Error(_0x27dcf9(0x229));if(_0x1723e7[_0x27dcf9(0x128)])throw new Error('2FA\x20is\x20already\x20enabled');const _0xe94e89=speakeasy_1[_0x27dcf9(0x258)][_0x27dcf9(0x15c)][_0x27dcf9(0x138)]({'secret':_0x1723e7[_0x27dcf9(0x1ac)],'encoding':_0x27dcf9(0x176),'token':_0x1ce02d,'window':0x2});if(!_0xe94e89)throw new Error('Invalid\x202FA\x20token');return await database_1['default'][_0x27dcf9(0x215)][_0x27dcf9(0x113)]({'where':{'id':_0x159a0c},'data':{'twoFactorEnabled':!![]}}),console['log']('üîê\x202FA\x20enabled\x20for\x20shop:\x20'+_0x1723e7['username']),{'enabled':!![]};}async[a48_0xb1fe34(0x1fa)](_0x45e494){const _0x3866eb=a48_0xb1fe34,_0x404a10=await database_1[_0x3866eb(0x258)][_0x3866eb(0x215)][_0x3866eb(0x187)]({'where':{'id':_0x45e494},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x404a10)throw new Error(_0x3866eb(0x126));await database_1[_0x3866eb(0x258)][_0x3866eb(0x215)][_0x3866eb(0x113)]({'where':{'id':_0x45e494},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x3866eb(0x1e4)](_0x3866eb(0x1c7)+_0x404a10[_0x3866eb(0x1d9)]);}async[a48_0xb1fe34(0x203)](_0xfb97da,_0x2cb8c3,_0x506a72,_0x3b7a35){const _0x57d979=a48_0xb1fe34;if(_0x2cb8c3!==_0x506a72)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x2cb8c3[_0x57d979(0x25a)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x232db6=await bcryptjs_1[_0x57d979(0x258)]['compare'](_0xfb97da,config_1[_0x57d979(0x15e)]['admin']['passwordHash']);if(!_0x232db6)throw new Error(_0x57d979(0x24d));if(config_1[_0x57d979(0x15e)][_0x57d979(0xc7)][_0x57d979(0x128)]){if(!_0x3b7a35)throw new Error('2FA\x20token\x20is\x20required');const _0x146a7f=speakeasy_1[_0x57d979(0x258)]['totp'][_0x57d979(0x138)]({'secret':config_1['config'][_0x57d979(0xc7)][_0x57d979(0x1ac)],'encoding':_0x57d979(0x176),'token':_0x3b7a35,'window':0x2});if(!_0x146a7f){let _0x2af369=![];if(config_1[_0x57d979(0x15e)][_0x57d979(0xc7)][_0x57d979(0x170)]){const _0x25b9e7=JSON['parse'](config_1[_0x57d979(0x15e)]['admin'][_0x57d979(0x170)]);for(let _0x5c5578=0x0;_0x5c5578<_0x25b9e7[_0x57d979(0x25a)];_0x5c5578++){const _0x2fa9c2=await bcryptjs_1['default'][_0x57d979(0x13f)](_0x3b7a35,_0x25b9e7[_0x5c5578]);if(_0x2fa9c2){_0x2af369=!![],_0x25b9e7[_0x57d979(0x1c4)](_0x5c5578,0x1),config_1[_0x57d979(0x15e)][_0x57d979(0xc7)][_0x57d979(0x170)]=JSON[_0x57d979(0x227)](_0x25b9e7);const _0x250c8b=path_1[_0x57d979(0x258)][_0x57d979(0x16e)](process[_0x57d979(0x1dc)](),'.env');if(fs_1['default'][_0x57d979(0x1f6)](_0x250c8b)){let _0x2915a3=fs_1['default'][_0x57d979(0x20e)](_0x250c8b,_0x57d979(0xf5));const _0x1af766=_0x2915a3[_0x57d979(0x19c)]('\x0a');for(let _0x5d2ac6=0x0;_0x5d2ac6<_0x1af766[_0x57d979(0x25a)];_0x5d2ac6++){if(_0x1af766[_0x5d2ac6][_0x57d979(0x199)](_0x57d979(0x9a))){_0x1af766[_0x5d2ac6]=_0x57d979(0x9a)+JSON[_0x57d979(0x227)](_0x25b9e7);break;}}fs_1[_0x57d979(0x258)]['writeFileSync'](_0x250c8b,_0x1af766[_0x57d979(0x16e)]('\x0a'),_0x57d979(0xf5));}break;}}}if(!_0x2af369)throw new Error(_0x57d979(0xd8));}}const _0x2134b6=await bcryptjs_1[_0x57d979(0x258)][_0x57d979(0x201)](_0x2cb8c3,0xc);config_1[_0x57d979(0x15e)][_0x57d979(0xc7)][_0x57d979(0x1a1)]=_0x2134b6;const _0x245208=path_1[_0x57d979(0x258)][_0x57d979(0x16e)](process[_0x57d979(0x1dc)](),_0x57d979(0x1a0));let _0xc1fa20='';if(fs_1[_0x57d979(0x258)][_0x57d979(0x1f6)](_0x245208)){_0xc1fa20=fs_1[_0x57d979(0x258)][_0x57d979(0x20e)](_0x245208,'utf8');const _0x17ac98=_0xc1fa20[_0x57d979(0x19c)]('\x0a');let _0x45cb22=![];for(let _0x5af859=0x0;_0x5af859<_0x17ac98[_0x57d979(0x25a)];_0x5af859++){if(_0x17ac98[_0x5af859][_0x57d979(0x199)](_0x57d979(0x1ed))){_0x17ac98[_0x5af859]=_0x57d979(0x1ed)+_0x2134b6,_0x45cb22=!![];break;}}!_0x45cb22&&_0x17ac98[_0x57d979(0x1cf)](_0x57d979(0x1ed)+_0x2134b6),_0xc1fa20=_0x17ac98['join']('\x0a'),fs_1[_0x57d979(0x258)]['writeFileSync'](_0x245208,_0xc1fa20,_0x57d979(0xf5));}console[_0x57d979(0x1e4)]('üîê\x20Admin\x20password\x20changed\x20successfully');}async[a48_0xb1fe34(0x117)](){const _0x2f8875=a48_0xb1fe34;let _0x4477de=0x0;if(config_1[_0x2f8875(0x15e)][_0x2f8875(0xc7)][_0x2f8875(0x170)])try{const _0x2bb778=JSON[_0x2f8875(0x1e6)](config_1[_0x2f8875(0x15e)][_0x2f8875(0xc7)]['backupCodes']);_0x4477de=_0x2bb778['length'];}catch(_0x533934){console[_0x2f8875(0x1d3)](_0x2f8875(0x17f),_0x533934);}return{'twoFactorEnabled':config_1[_0x2f8875(0x15e)][_0x2f8875(0xc7)]['twoFactorEnabled'],'backupCodesCount':_0x4477de};}async[a48_0xb1fe34(0x1cd)](){const _0x5a4931=a48_0xb1fe34,_0x407d32=speakeasy_1[_0x5a4931(0x258)]['generateSecret']({'name':_0x5a4931(0x13b)+config_1[_0x5a4931(0x15e)][_0x5a4931(0xc7)][_0x5a4931(0x1d9)]+')','issuer':'TrapaPay\x20Admin','length':0x20}),_0x525fd1=await qrcode_1['default'][_0x5a4931(0x238)](_0x407d32[_0x5a4931(0x14e)]),_0x419c38=[];for(let _0x513308=0x0;_0x513308<0x8;_0x513308++){const _0x59e3c5=crypto_1[_0x5a4931(0x258)][_0x5a4931(0xb8)](0x4)[_0x5a4931(0x22c)](_0x5a4931(0x14a))['toUpperCase']();_0x419c38['push'](_0x59e3c5);}const _0x1dae98=await Promise[_0x5a4931(0xb2)](_0x419c38[_0x5a4931(0xd6)](_0x5a5466=>bcryptjs_1['default'][_0x5a4931(0x201)](_0x5a5466,0xa)));config_1[_0x5a4931(0x15e)][_0x5a4931(0xc7)][_0x5a4931(0x1ac)]=_0x407d32[_0x5a4931(0x176)],config_1[_0x5a4931(0x15e)][_0x5a4931(0xc7)]['backupCodes']=JSON[_0x5a4931(0x227)](_0x1dae98);const _0x557252=path_1[_0x5a4931(0x258)][_0x5a4931(0x16e)](process[_0x5a4931(0x1dc)](),_0x5a4931(0x1a0));if(fs_1[_0x5a4931(0x258)][_0x5a4931(0x1f6)](_0x557252)){let _0x1b6478=fs_1[_0x5a4931(0x258)]['readFileSync'](_0x557252,_0x5a4931(0xf5));const _0x19275b=_0x1b6478['split']('\x0a');let _0x59fdab=![],_0x29b7ec=![];for(let _0x566dd3=0x0;_0x566dd3<_0x19275b[_0x5a4931(0x25a)];_0x566dd3++){_0x19275b[_0x566dd3][_0x5a4931(0x199)](_0x5a4931(0xc1))&&(_0x19275b[_0x566dd3]=_0x5a4931(0xc1)+_0x407d32[_0x5a4931(0x176)],_0x59fdab=!![]),_0x19275b[_0x566dd3][_0x5a4931(0x199)](_0x5a4931(0x9a))&&(_0x19275b[_0x566dd3]=_0x5a4931(0x9a)+JSON[_0x5a4931(0x227)](_0x1dae98),_0x29b7ec=!![]);}if(!_0x59fdab)_0x19275b[_0x5a4931(0x1cf)](_0x5a4931(0xc1)+_0x407d32[_0x5a4931(0x176)]);if(!_0x29b7ec)_0x19275b[_0x5a4931(0x1cf)](_0x5a4931(0x9a)+JSON[_0x5a4931(0x227)](_0x1dae98));fs_1['default'][_0x5a4931(0x102)](_0x557252,_0x19275b[_0x5a4931(0x16e)]('\x0a'),'utf8');}return console[_0x5a4931(0x1e4)](_0x5a4931(0x1c9)),console['log'](_0x5a4931(0xca)+_0x419c38[_0x5a4931(0x25a)]+_0x5a4931(0x162)),{'secret':_0x407d32[_0x5a4931(0x176)],'qrCode':_0x525fd1,'manualEntryKey':_0x407d32[_0x5a4931(0x176)],'backupCodes':_0x419c38};}async[a48_0xb1fe34(0x254)](_0x523897){const _0x437934=a48_0xb1fe34;if(!config_1[_0x437934(0x15e)][_0x437934(0xc7)][_0x437934(0x1ac)])throw new Error(_0x437934(0x229));if(config_1[_0x437934(0x15e)][_0x437934(0xc7)]['twoFactorEnabled'])throw new Error(_0x437934(0x20d));const _0x40a6e3=speakeasy_1[_0x437934(0x258)][_0x437934(0x15c)][_0x437934(0x138)]({'secret':config_1[_0x437934(0x15e)][_0x437934(0xc7)][_0x437934(0x1ac)],'encoding':'base32','token':_0x523897,'window':0x2});if(!_0x40a6e3)throw new Error(_0x437934(0x12d));config_1[_0x437934(0x15e)][_0x437934(0xc7)][_0x437934(0x128)]=!![];const _0x3d9cd4=path_1[_0x437934(0x258)][_0x437934(0x16e)](process[_0x437934(0x1dc)](),_0x437934(0x1a0));if(fs_1['default'][_0x437934(0x1f6)](_0x3d9cd4)){let _0xa04134=fs_1[_0x437934(0x258)]['readFileSync'](_0x3d9cd4,'utf8');const _0x583b30=_0xa04134[_0x437934(0x19c)]('\x0a');let _0x13f9a8=![];for(let _0x4a99e1=0x0;_0x4a99e1<_0x583b30[_0x437934(0x25a)];_0x4a99e1++){if(_0x583b30[_0x4a99e1][_0x437934(0x199)]('ADMIN_2FA_ENABLED=')){_0x583b30[_0x4a99e1]=_0x437934(0x1bc),_0x13f9a8=!![];break;}}if(!_0x13f9a8)_0x583b30[_0x437934(0x1cf)]('ADMIN_2FA_ENABLED=true');fs_1[_0x437934(0x258)][_0x437934(0x102)](_0x3d9cd4,_0x583b30[_0x437934(0x16e)]('\x0a'),_0x437934(0xf5));}return console[_0x437934(0x1e4)](_0x437934(0x25b)),{'enabled':!![]};}async[a48_0xb1fe34(0x165)](){const _0x55c65f=a48_0xb1fe34;config_1['config'][_0x55c65f(0xc7)][_0x55c65f(0x128)]=![],config_1['config'][_0x55c65f(0xc7)][_0x55c65f(0x1ac)]='',config_1[_0x55c65f(0x15e)][_0x55c65f(0xc7)][_0x55c65f(0x170)]='';const _0x128df1=path_1[_0x55c65f(0x258)][_0x55c65f(0x16e)](process[_0x55c65f(0x1dc)](),_0x55c65f(0x1a0));if(fs_1['default'][_0x55c65f(0x1f6)](_0x128df1)){let _0x22f518=fs_1['default'][_0x55c65f(0x20e)](_0x128df1,_0x55c65f(0xf5));const _0x10e563=_0x22f518['split']('\x0a');for(let _0xd9a4b1=0x0;_0xd9a4b1<_0x10e563[_0x55c65f(0x25a)];_0xd9a4b1++){_0x10e563[_0xd9a4b1][_0x55c65f(0x199)](_0x55c65f(0x259))&&(_0x10e563[_0xd9a4b1]=_0x55c65f(0x145)),_0x10e563[_0xd9a4b1][_0x55c65f(0x199)](_0x55c65f(0xc1))&&(_0x10e563[_0xd9a4b1]='ADMIN_2FA_SECRET='),_0x10e563[_0xd9a4b1][_0x55c65f(0x199)](_0x55c65f(0x9a))&&(_0x10e563[_0xd9a4b1]=_0x55c65f(0x9a));}fs_1[_0x55c65f(0x258)][_0x55c65f(0x102)](_0x128df1,_0x10e563['join']('\x0a'),'utf8');}console['log'](_0x55c65f(0x131));}[a48_0xb1fe34(0xf0)](_0x46a3db,_0x59cef8,_0x1bdb87){const _0x5c8aa6=a48_0xb1fe34,_0x8ec9d7=new Map(),_0x5078f8=new Date(_0x59cef8);while(_0x5078f8<=_0x1bdb87){const _0x39800c=_0x5078f8['toISOString']()[_0x5c8aa6(0x19c)]('T')[0x0];_0x8ec9d7['set'](_0x39800c,{'revenue':0x0,'count':0x0}),_0x5078f8[_0x5c8aa6(0x1cc)](_0x5078f8[_0x5c8aa6(0xc4)]()+0x1);}for(const _0x940377 of _0x46a3db){const _0x267f5b=_0x940377[_0x5c8aa6(0xba)][_0x5c8aa6(0x1b1)]()[_0x5c8aa6(0x19c)]('T')[0x0],_0x2ab98b=_0x8ec9d7[_0x5c8aa6(0x222)](_0x267f5b);_0x2ab98b&&(_0x2ab98b[_0x5c8aa6(0x17c)]+=0x1,_0x940377[_0x5c8aa6(0x12e)]===_0x5c8aa6(0xcf)&&(_0x940377[_0x5c8aa6(0x97)]?_0x2ab98b[_0x5c8aa6(0x1a2)]+=_0x940377[_0x5c8aa6(0x97)]:console[_0x5c8aa6(0x1e4)](_0x5c8aa6(0x22e)+_0x940377['id']+_0x5c8aa6(0x182))));}const _0x3cb2ab=[],_0x931655=[];for(const [_0x38d610,_0x1ba8b6]of _0x8ec9d7){_0x3cb2ab[_0x5c8aa6(0x1cf)]({'date':_0x38d610,'amount':Math['round'](_0x1ba8b6[_0x5c8aa6(0x1a2)]*0x64)/0x64}),_0x931655['push']({'date':_0x38d610,'count':_0x1ba8b6[_0x5c8aa6(0x17c)]});}return{'dailyRevenue':_0x3cb2ab,'dailyPayments':_0x931655};}async[a48_0xb1fe34(0x146)](_0x17054f){const _0x2873ca=a48_0xb1fe34;console[_0x2873ca(0x1e4)](_0x2873ca(0x169),_0x17054f);const _0x5e3c9d=new Date(_0x17054f[_0x2873ca(0x14d)]),_0x43e6dd=new Date(_0x17054f['periodTo']),_0x18e6b4=new Date(Date[_0x2873ca(0x16d)](_0x5e3c9d[_0x2873ca(0x1dd)](),_0x5e3c9d[_0x2873ca(0x1da)](),_0x5e3c9d[_0x2873ca(0x20b)](),0x0,0x0,0x0,0x0)),_0x42f5bd=new Date(Date[_0x2873ca(0x16d)](_0x43e6dd[_0x2873ca(0x1dd)](),_0x43e6dd[_0x2873ca(0x1da)](),_0x43e6dd[_0x2873ca(0x20b)](),0x17,0x3b,0x3b,0x3e7));console[_0x2873ca(0x1e4)](_0x2873ca(0x150)+_0x18e6b4[_0x2873ca(0x1b1)]()+'\x20to\x20'+_0x42f5bd[_0x2873ca(0x1b1)]()),console[_0x2873ca(0x1e4)](_0x2873ca(0xa5)+_0x17054f[_0x2873ca(0x141)]);const _0x4bb79c=await database_1[_0x2873ca(0x258)][_0x2873ca(0x157)][_0x2873ca(0xf8)]({'where':{'status':_0x2873ca(0xcf),'gateway':_0x17054f[_0x2873ca(0x141)][_0x2873ca(0x192)](),'createdAt':{'gte':_0x18e6b4,'lte':_0x42f5bd}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2873ca(0x1e4)]('üí∞\x20Found\x20'+_0x4bb79c['length']+_0x2873ca(0x1e1)+_0x17054f['gateway']);const _0x2f7239=new Map();for(const _0x294a82 of _0x4bb79c){const _0x756a23=_0x294a82[_0x2873ca(0x14b)]||0x0;if(_0x756a23<=0x0){console['warn'](_0x2873ca(0x22e)+_0x294a82['id']+_0x2873ca(0x17a));continue;}if(_0x2f7239['has'](_0x294a82[_0x2873ca(0x1b5)])){const _0x57b714=_0x2f7239[_0x2873ca(0x222)](_0x294a82[_0x2873ca(0x1b5)]);_0x57b714[_0x2873ca(0x1d7)]+=_0x756a23;}else _0x2f7239[_0x2873ca(0xa4)](_0x294a82[_0x2873ca(0x1b5)],{'merchantId':_0x294a82[_0x2873ca(0x215)]['id'],'merchantName':_0x294a82[_0x2873ca(0x215)]['name'],'merchantUsername':_0x294a82['shop'][_0x2873ca(0x1d9)],'totalAmount':_0x756a23});}const _0x40a6b7=Array[_0x2873ca(0x1ef)](_0x2f7239[_0x2873ca(0x1fe)]())[_0x2873ca(0xd6)](_0x3237f3=>({'merchantId':_0x3237f3[_0x2873ca(0x191)],'merchantName':_0x3237f3['merchantName'],'merchantUsername':_0x3237f3['merchantUsername'],'gateway':_0x17054f['gateway'],'periodFrom':_0x17054f[_0x2873ca(0x14d)],'periodTo':_0x17054f[_0x2873ca(0x127)],'totalAmount':Math[_0x2873ca(0x23e)](_0x3237f3[_0x2873ca(0x1d7)]*0x64)/0x64}));return _0x40a6b7['sort']((_0x53866d,_0x26b63b)=>_0x26b63b[_0x2873ca(0x1d7)]-_0x53866d['totalAmount']),console[_0x2873ca(0x1e4)](_0x2873ca(0x1c8)+_0x40a6b7['length']+_0x2873ca(0x130)),_0x40a6b7;}}exports[a48_0xb1fe34(0x116)]=AdminService;