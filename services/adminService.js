'use strict';const a36_0x286081=a36_0x26a9;(function(_0x4ae52b,_0x59359a){const _0x3dc0f5=a36_0x26a9,_0x46257c=_0x4ae52b();while(!![]){try{const _0x18cc04=-parseInt(_0x3dc0f5(0x179))/0x1*(-parseInt(_0x3dc0f5(0xd5))/0x2)+parseInt(_0x3dc0f5(0x14d))/0x3+parseInt(_0x3dc0f5(0x10d))/0x4+parseInt(_0x3dc0f5(0xc0))/0x5*(parseInt(_0x3dc0f5(0x156))/0x6)+-parseInt(_0x3dc0f5(0x126))/0x7+parseInt(_0x3dc0f5(0xe2))/0x8*(parseInt(_0x3dc0f5(0x168))/0x9)+-parseInt(_0x3dc0f5(0x153))/0xa;if(_0x18cc04===_0x59359a)break;else _0x46257c['push'](_0x46257c['shift']());}catch(_0x4f7b3e){_0x46257c['push'](_0x46257c['shift']());}}}(a36_0x20ea,0xddf37));var __importDefault=this&&this[a36_0x286081(0x155)]||function(_0x52d7ed){const _0x9ed104=a36_0x286081;return _0x52d7ed&&_0x52d7ed[_0x9ed104(0xe1)]?_0x52d7ed:{'default':_0x52d7ed};};function a36_0x20ea(){const _0x189eb3=['⚠️\x20Payment\x20','rapyd','\x20USDT\x20for\x20payment\x20','username','\x27\x20to\x20name\x20\x27','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','_count','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','error','updateCustomerData','reduce','\x20USDT\x20(already\x20paid\x20out)','turnover','desc','Shop\x20not\x20found','3632636zYCCqX','fullName','\x20no\x20longer\x20PAID:','toISOString','KLYME\x20DE','REFUND','\x20USDT\x20(+','round','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20merchants','\x20\x20\x20Transaction\x20hash:\x20','getGatewayInternalName','totalAmountAfterCommissionUSDT','trim','💳\x20Payout\x20wallet\x20for\x20','txid','📋\x20Found\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','Test\x20Gateway','network','entries','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','merchantEarningsUSDT','count','gateways','3094630ovcNdZ','Username\x20already\x20exists','amount','getPayoutById','CoinToPay','adminNotes','generateDailyStatistics','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20payments)','💱\x20Currency\x20filter\x20applied:\x20','averageCommissionRate','createdAt','💰\x20[PAYOUT]\x20Merchant\x20','🔄\x20Gateway\x20mapping:','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','plisio','month','klyme_gb','create','📊\x20Calculating\x20payout\x20statistics...','stringify','getAllPayments','30d','getAllPayouts','Plisio','customerEmail','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','gateway','join','values','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','dateTo','externalPaymentUrl','🔐\x20[','delete','yesterday','AdminService','2515854Xwzkav','availableBalance','paymentGateways','🔄\x20Converted\x20gateway\x20name\x20\x27','💰\x20[PAYOUT]\x20Gateway\x20','toFixed','50613850zNNEUW','substr','__importDefault','650004emDBqy','\x20\x20\x20🌍\x20Country:\x20','customerUa','toUpperCase','getSystemStatistics','getPaymentById','Payment\x20not\x20found','hash','COMPLETED','🔄\x20Admin\x20updating\x20payment\x20','90d','\x20order','customerIp','asc','$transaction','telegramId','\x20\x20\x20Payout\x20amount:\x20','💰\x20Shop\x20','828SpAYmB','CHARGEBACK','orderId','amountAfterGatewayCommissionUSDT','wallets','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20\x20\x20Total\x20paid\x20out:\x20','map','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance',',\x20Commission:\x20','localeCompare','date','🔄\x20Converted\x20gateway\x20ID\x20\x27','telegram','📊\x20Gateway\x20filter\x20applied:','getAllUsers','\x27\x20(from\x20\x27','65353RVVOMs','totalPaidOut','period','balance','year',']\x20Updating\x20password\x20for\x20user\x20','getFullYear','\x20balance\x20updated:\x20','📊\x20Sorting\x20payments\x20by\x20','📊\x20Final\x20WHERE\x20conditions:','🔄\x20Gateway\x20mapping\x20(get):','../config/database','📋\x20Getting\x20merchants\x20selection\x20list...','usdcPolygonWallet','publicKey','totalPayout','klyme_eu','customerCountry','\x20for\x20shop\x20','Insufficient\x20balance.\x20Available:\x20','update','Noda','chargebackAmount',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','push','⚠️\x20Requested\x20gateway\x20\x27','\x20USDT','\x20\x20\x20Balance:\x20','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','periodFrom','shop','paidOutUSDT','setDate','test_gateway','default','usdtTrcWallet','revenue','erc20','paidAt','commissionUSDT','\x20\x20\x20⏳\x20Pending\x20payout:\x20','_sum','averageCheckUSDT','💰\x20Payment\x20','sort','parse','getGatewayNameById','whiteUrl','length','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','defineProperty','cointopay2','\x27\x20->\x20ID\x20\x27','split','getMonth','set','pk_','shopUrl','getGatewayDisplayName','payment','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','convertToUSDT','lte','log','bcryptjs','randomBytes','💸\x20CHARGEBACK\x20penalty:\x20-','failureMessage','📊\x20Merchant\x20statistics\x20calculated:','✅\x20Payout\x20created:\x20','usdtPolygonWallet','activateUser','\x20USDT,\x20Requested:\x20','📊\x20Payout\x20statistics\x20calculated:','ACTIVE','getTime','all','\x20\x20\x20Merchant\x20gets:\x20','🔧\x20[','setHours','\x20\x20\x20📅\x20This\x20month:\x20','deleteUser','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','statusChangedAt','aggregate','totalCommissionRate','dateFrom','merchantUrl','suspendUser','name','\x20\x20\x20Gateway:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','createPayout','SUSPENDED','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','failUrl','payout','getGatewayIdByName','findMany','includes','2020-01-01','trc20','\x20\x20\x20💰\x20Total\x20turnover:\x20','groupBy','\x20paid\x20payments\x20for\x20analysis','pendingPayout','totalPayments','getDate','\x20USDT\x20(after\x20','💰\x20Current\x20shop\x20balance:\x20','./currencyService','\x20\x20\x20�📊\x20Total\x20payments:\x20','get','turnoverUSDT','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','status','KLYME\x20GB','usdtErcWallet','\x20->\x20','updateUser','paymentsCount','%\x20from\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20active\x20merchants\x20for\x20selection','\x27\x20->\x20name\x20\x27','gatewayEarnings','statusChangedBy',',\x20userId:\x20','📊\x20Getting\x20payments\x20with\x20filters:','\x20merchants\x20with\x20positive\x20balance','polygon_usdc','65mQlPvC','sk_','📊\x20Total\x20payments\x20(including\x20failed):\x20','getMerchantsAwaitingPayout','currencyService','customerName','findFirst','gte','week','klyme_de',',\x20successful:\x20','gatewayCommissionRate','\x20\x20\x20Current\x20balance:\x20','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','insensitive','\x20USDT\x20(with\x20commission\x20deducted)','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','%\x20commission)','currency','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','commission','46uWJAvE','thisMonth','toString','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','totalAmountUSDT','periodTo','ceil','\x20\x20\x20💰\x20Total\x20payout:\x20','summary','\x20\x20\x20🌐\x20IP:\x20','\x20USDT\x20(','🎯\x20[','__esModule','152552pQTGLC','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','password','getUserById','totalTurnover','amountUSDT','PAID','merchantEarnings','🎯\x20updateUser\x20called\x20with\x20ID:\x20','updatedAt','💰\x20Found\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT\x20(theoretical\x20net)','gatewaySettings','warn','\x20\x20\x20Full\x20amount:\x20','day','toLowerCase','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','findUnique','hex','crypto','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','noda','shopId','\x20\x20\x20Merchant\x20loses:\x20','pendingUrl'];a36_0x20ea=function(){return _0x189eb3;};return a36_0x20ea();}Object[a36_0x286081(0x1ab)](exports,a36_0x286081(0xe1),{'value':!![]}),exports[a36_0x286081(0x14c)]=void 0x0;const database_1=__importDefault(require(a36_0x286081(0x184))),bcryptjs_1=__importDefault(require(a36_0x286081(0x1b9))),crypto_1=__importDefault(require(a36_0x286081(0xf7))),currencyService_1=require(a36_0x286081(0xab)),gateway_1=require('../types/gateway');class AdminService{async['getPayoutStats'](){const _0x3a87eb=a36_0x286081;console[_0x3a87eb(0x1b8)](_0x3a87eb(0x139));const _0x487dd9=await database_1[_0x3a87eb(0x19b)][_0x3a87eb(0x197)][_0x3a87eb(0x1cd)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3a87eb(0x1c3)}}),_0x1843d8=await this[_0x3a87eb(0xc3)]({'page':0x1,'limit':0x3e8}),_0x13c444=await database_1[_0x3a87eb(0x19b)][_0x3a87eb(0x1b4)][_0x3a87eb(0x124)]({'where':{'status':_0x3a87eb(0xe8),'gateway':{'not':_0x3a87eb(0x19a)}}}),_0x2f21b2=new Date(),_0x40d7c0=new Date(_0x2f21b2[_0x3a87eb(0x17f)](),_0x2f21b2[_0x3a87eb(0x1af)](),0x1),_0x485b75=new Date(_0x2f21b2[_0x3a87eb(0x17f)](),_0x2f21b2[_0x3a87eb(0x1af)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2ee081=await database_1[_0x3a87eb(0x19b)][_0x3a87eb(0x1d9)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x40d7c0,'lte':_0x485b75},'status':_0x3a87eb(0x15e)}}),_0x24770f=_0x487dd9['_sum'][_0x3a87eb(0x17a)]||0x0,_0xf7481a=_0x1843d8[_0x3a87eb(0xdd)][_0x3a87eb(0x119)],_0x475105=_0x2ee081[_0x3a87eb(0x1a2)][_0x3a87eb(0x128)]||0x0,_0x287085={'totalPayout':Math['round'](_0x24770f*0x64)/0x64,'awaitingPayout':Math[_0x3a87eb(0x114)](_0xf7481a*0x64)/0x64,'thisMonth':Math[_0x3a87eb(0x114)](_0x475105*0x64)/0x64,'availableBalance':Math[_0x3a87eb(0x114)](_0xf7481a*0x64)/0x64,'totalPayments':_0x13c444};return console[_0x3a87eb(0x1b8)](_0x3a87eb(0x1c2)),console[_0x3a87eb(0x1b8)](_0x3a87eb(0xdc)+_0x287085[_0x3a87eb(0x188)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x3a87eb(0x1b8)](_0x3a87eb(0x1cb)+_0x287085['awaitingPayout']+_0x3a87eb(0xcf)),console[_0x3a87eb(0x1b8)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x287085[_0x3a87eb(0x14e)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x3a87eb(0x1b8)](_0x3a87eb(0x1c9)+_0x287085[_0x3a87eb(0xd6)]+_0x3a87eb(0x193)),console[_0x3a87eb(0x1b8)]('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x287085[_0x3a87eb(0x1e3)]+'\x20PAID\x20payments'),console[_0x3a87eb(0x1b8)](_0x3a87eb(0x140)+(_0x487dd9['_sum'][_0x3a87eb(0x17c)]||0x0)[_0x3a87eb(0x152)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x3a87eb(0x1b8)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x487dd9['_sum'][_0x3a87eb(0x17c)]||0x0)-_0xf7481a)[_0x3a87eb(0x152)](0x2)+_0x3a87eb(0x193)),_0x287085;}async[a36_0x286081(0x107)](_0x2ac636,_0x1d912d){const _0x440518=a36_0x286081;console[_0x440518(0x1b8)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x2ac636+':',_0x1d912d);const _0x53e6d8=await database_1['default']['payment'][_0x440518(0xf5)]({'where':{'id':_0x2ac636},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x53e6d8)throw new Error(_0x440518(0x15c));const _0x11fc03={};_0x1d912d[_0x440518(0x18a)]!==undefined&&(_0x11fc03[_0x440518(0x18a)]=_0x1d912d['customerCountry']||null);_0x1d912d[_0x440518(0x162)]!==undefined&&(_0x11fc03[_0x440518(0x162)]=_0x1d912d[_0x440518(0x162)]||null);_0x1d912d[_0x440518(0x158)]!==undefined&&(_0x11fc03[_0x440518(0x158)]=_0x1d912d[_0x440518(0x158)]||null);const _0x107379=await database_1['default']['payment'][_0x440518(0x18d)]({'where':{'id':_0x2ac636},'data':{..._0x11fc03,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x440518(0xd8)+_0x2ac636),console[_0x440518(0x1b8)](_0x440518(0x157)+_0x53e6d8[_0x440518(0x18a)]+'\x20->\x20'+_0x107379[_0x440518(0x18a)]),console[_0x440518(0x1b8)](_0x440518(0xde)+_0x53e6d8['customerIp']+_0x440518(0xb3)+_0x107379[_0x440518(0x162)]),console[_0x440518(0x1b8)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x53e6d8['customerUa']?_0x440518(0x1b0):'not\x20set')+_0x440518(0xb3)+(_0x107379['customerUa']?_0x440518(0x1b0):'not\x20set')),_0x107379;}async[a36_0x286081(0x15a)](_0x6d6f43){const _0x3f94a4=a36_0x286081,_0x450b5e=new Date();let _0x544a16;switch(_0x6d6f43['toLowerCase']()){case _0x3f94a4(0xf2):_0x544a16=new Date(_0x450b5e[_0x3f94a4(0x17f)](),_0x450b5e['getMonth'](),_0x450b5e[_0x3f94a4(0x1e4)](),0x0,0x0,0x0,0x0);break;case _0x3f94a4(0x14b):const _0x8071ef=new Date(_0x450b5e);_0x8071ef['setDate'](_0x8071ef['getDate']()-0x1),_0x544a16=new Date(_0x8071ef[_0x3f94a4(0x17f)](),_0x8071ef[_0x3f94a4(0x1af)](),_0x8071ef['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x544a16=new Date(_0x450b5e[_0x3f94a4(0x1c4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3f94a4(0x13c):_0x544a16=new Date(_0x450b5e[_0x3f94a4(0x1c4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3f94a4(0x160):_0x544a16=new Date(_0x450b5e[_0x3f94a4(0x1c4)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x3f94a4(0x1c5):const _0x32b4ce=await database_1[_0x3f94a4(0x19b)][_0x3f94a4(0x1b4)][_0x3f94a4(0xc6)]({'where':{'gateway':{'not':_0x3f94a4(0x19a)}},'orderBy':{'createdAt':_0x3f94a4(0x163)},'select':{'createdAt':!![]}});_0x544a16=_0x32b4ce?_0x32b4ce[_0x3f94a4(0x131)]:new Date(_0x3f94a4(0x1dd));break;default:_0x544a16=new Date(_0x450b5e[_0x3f94a4(0x1c4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x544a16[_0x3f94a4(0x1c8)](0x0,0x0,0x0,0x0);let _0x57e4ab;if(_0x6d6f43[_0x3f94a4(0xf3)]()===_0x3f94a4(0x14b)){const _0x5da796=new Date(_0x450b5e);_0x5da796['setDate'](_0x5da796[_0x3f94a4(0x1e4)]()-0x1),_0x57e4ab=new Date(_0x5da796[_0x3f94a4(0x17f)](),_0x5da796[_0x3f94a4(0x1af)](),_0x5da796[_0x3f94a4(0x1e4)](),0x17,0x3b,0x3b,0x3e7);}const _0x13ffd9={'gte':_0x544a16};_0x57e4ab&&(_0x13ffd9[_0x3f94a4(0x1b7)]=_0x57e4ab);const [_0x4d30de,_0x31aff4,_0x556ca0,_0x17f5e7,_0x2e899c,_0xbb827f]=await Promise['all']([database_1['default'][_0x3f94a4(0x197)][_0x3f94a4(0x124)](),database_1[_0x3f94a4(0x19b)][_0x3f94a4(0x197)][_0x3f94a4(0x124)]({'where':{'status':'ACTIVE'}}),database_1[_0x3f94a4(0x19b)][_0x3f94a4(0x1b4)]['count']({'where':{'status':'PAID','createdAt':_0x13ffd9,'gateway':{'not':_0x3f94a4(0x19a)}}}),database_1['default'][_0x3f94a4(0x1b4)][_0x3f94a4(0x1db)]({'where':{'status':_0x3f94a4(0xe8),'createdAt':_0x13ffd9,'gateway':{'not':_0x3f94a4(0x19a)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x3f94a4(0x19b)][_0x3f94a4(0x1b4)][_0x3f94a4(0x1db)]({'where':{'gateway':{'not':_0x3f94a4(0x19a)}},'take':0xa,'orderBy':{'createdAt':_0x3f94a4(0x10b)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x3f94a4(0x1db)]({'where':{'createdAt':_0x13ffd9,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x1d21fc=0x0,_0x16a6ae=0x0;for(const _0x271602 of _0x17f5e7){const _0x283845=await currencyService_1['currencyService']['convertToUSDT'](_0x271602[_0x3f94a4(0x128)],_0x271602[_0x3f94a4(0xd2)]);_0x1d21fc+=_0x283845;if(_0x271602[_0x3f94a4(0x16b)]){const _0xf95922=await currencyService_1[_0x3f94a4(0xc4)][_0x3f94a4(0x1b6)](_0x271602[_0x3f94a4(0x128)],_0x271602[_0x3f94a4(0xd2)]),_0x2b0c7c=_0x271602[_0x3f94a4(0x16b)],_0xd4413e=_0xf95922-_0x2b0c7c;_0x16a6ae+=_0xd4413e;}}const _0x4816e3=_0x556ca0>0x0?_0x1d21fc/_0x556ca0:0x0,_0x429a92=this[_0x3f94a4(0x12c)](_0xbb827f,_0x544a16,_0x57e4ab||_0x450b5e),_0x4ad345=await database_1['default'][_0x3f94a4(0x1b4)][_0x3f94a4(0x124)]({'where':{'createdAt':_0x13ffd9,'gateway':{'not':_0x3f94a4(0x19a)}}}),_0x28df1c=_0x4ad345>0x0?_0x556ca0/_0x4ad345*0x64:0x0;return{'totalShops':_0x4d30de,'activeShops':_0x31aff4,'totalPayments':_0x556ca0,'successfulPayments':_0x556ca0,'totalAttempts':_0x4ad345,'totalRevenue':Math[_0x3f94a4(0x114)](_0x1d21fc*0x64)/0x64,'trapayEarnings':Math[_0x3f94a4(0x114)](_0x16a6ae*0x64)/0x64,'averagePaymentAmount':Math[_0x3f94a4(0x114)](_0x4816e3*0x64)/0x64,'conversionRate':Math['round'](_0x28df1c*0x64)/0x64,'dailyRevenue':_0x429a92['dailyRevenue'],'dailyPayments':_0x429a92['dailyPayments'],'recentPayments':_0x2e899c[_0x3f94a4(0x16f)](_0x5ea302=>({'id':_0x5ea302['id'],'amount':_0x5ea302[_0x3f94a4(0x128)],'currency':_0x5ea302[_0x3f94a4(0xd2)],'status':_0x5ea302[_0x3f94a4(0xb0)],'gateway':_0x5ea302[_0x3f94a4(0x141)],'shop':_0x5ea302['shop'],'createdAt':_0x5ea302['createdAt']}))};}async['getMerchantStatistics'](_0x250978){const _0x35f2e9=a36_0x286081;console[_0x35f2e9(0x1b8)](_0x35f2e9(0x115),_0x250978);let _0x2945c8,_0xcb38c2=new Date();if(_0x250978[_0x35f2e9(0x17b)]==='custom'&&_0x250978[_0x35f2e9(0x1cf)]&&_0x250978[_0x35f2e9(0x147)])_0x2945c8=new Date(_0x250978['dateFrom']),_0xcb38c2=new Date(_0x250978[_0x35f2e9(0x147)]),_0x2945c8['setHours'](0x0,0x0,0x0,0x0),_0xcb38c2[_0x35f2e9(0x1c8)](0x17,0x3b,0x3b,0x3e7);else{const _0x1a85c3=new Date();switch(_0x250978[_0x35f2e9(0x17b)]){case _0x35f2e9(0xc8):_0x2945c8=new Date(_0x1a85c3['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x35f2e9(0x136):_0x2945c8=new Date(_0x1a85c3[_0x35f2e9(0x1c4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x35f2e9(0x17d):_0x2945c8=new Date(_0x1a85c3['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x35f2e9(0x1c5):default:_0x2945c8=new Date(_0x35f2e9(0x1dd));break;}_0x2945c8[_0x35f2e9(0x1c8)](0x0,0x0,0x0,0x0),_0xcb38c2[_0x35f2e9(0x1c8)](0x17,0x3b,0x3b,0x3e7);}console[_0x35f2e9(0x1b8)]('📅\x20Period:\x20'+_0x2945c8[_0x35f2e9(0x110)]()+'\x20to\x20'+_0xcb38c2[_0x35f2e9(0x110)]());const _0x1298a1={'status':_0x35f2e9(0xe8),'gateway':{'not':_0x35f2e9(0x19a)},'paidAt':{'gte':_0x2945c8,'lte':_0xcb38c2}};_0x250978[_0x35f2e9(0xfb)]&&(_0x1298a1[_0x35f2e9(0xfb)]=_0x250978[_0x35f2e9(0xfb)]);const _0x15e881=await database_1[_0x35f2e9(0x19b)][_0x35f2e9(0x1b4)][_0x35f2e9(0x1db)]({'where':_0x1298a1,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x35f2e9(0x1b8)]('💰\x20Found\x20'+_0x15e881[_0x35f2e9(0x1a9)]+_0x35f2e9(0x1e1));const _0x2a0168={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x2945c8,'lte':_0xcb38c2}};_0x250978[_0x35f2e9(0xfb)]&&(_0x2a0168[_0x35f2e9(0xfb)]=_0x250978[_0x35f2e9(0xfb)]);const _0x4d0059=await database_1[_0x35f2e9(0x19b)][_0x35f2e9(0x1b4)][_0x35f2e9(0x124)]({'where':_0x2a0168});console[_0x35f2e9(0x1b8)](_0x35f2e9(0xc2)+_0x4d0059+_0x35f2e9(0xca)+_0x15e881['length']);let _0x2a6429=0x0,_0x1db713=0x0,_0x395641=0x0;const _0x4c11a2={},_0x504754={},_0x25b005={};for(const _0x1496d2 of _0x15e881){try{const _0x272ccf=_0x1496d2[_0x35f2e9(0xe7)]||0x0;if(_0x272ccf<=0x0){console[_0x35f2e9(0xf0)](_0x35f2e9(0xfe)+_0x1496d2['id']+_0x35f2e9(0x1d4));continue;}let _0x35d4a9,_0x4afeb9;if(_0x1496d2['amountAfterGatewayCommissionUSDT']!==null&&_0x1496d2[_0x35f2e9(0x16b)]!==undefined)_0x35d4a9=_0x1496d2[_0x35f2e9(0x16b)],_0x4afeb9=_0x272ccf-_0x35d4a9,console['log'](_0x35f2e9(0x134)+_0x1496d2['id']+':\x20'+_0x272ccf[_0x35f2e9(0x152)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x35d4a9['toFixed'](0x6)+'\x20USDT');else{let _0x4d8355={};if(_0x1496d2['shop'][_0x35f2e9(0xef)])try{_0x4d8355=JSON[_0x35f2e9(0x1a6)](_0x1496d2[_0x35f2e9(0x197)][_0x35f2e9(0xef)]);}catch(_0x1af701){console[_0x35f2e9(0x106)](_0x35f2e9(0x12d)+_0x1496d2[_0x35f2e9(0xfb)]+':',_0x1af701);}let _0x146c8b=0x2d;for(const [_0x51f57d,_0x290ef9]of Object[_0x35f2e9(0x121)](_0x4d8355)){if(_0x51f57d[_0x35f2e9(0xf3)]()===_0x1496d2[_0x35f2e9(0x141)][_0x35f2e9(0xf3)]()){_0x146c8b=_0x290ef9[_0x35f2e9(0xd4)]||0x2d;break;}}_0x4afeb9=_0x272ccf*(_0x146c8b/0x64),_0x35d4a9=_0x272ccf-_0x4afeb9,console[_0x35f2e9(0x1b8)](_0x35f2e9(0x145)+_0x1496d2['id']+':\x20'+_0x146c8b+_0x35f2e9(0xb6)+_0x272ccf['toFixed'](0x6)+_0x35f2e9(0x193));}_0x2a6429+=_0x272ccf,_0x1db713+=_0x35d4a9,_0x395641+=_0x4afeb9;let _0x3a2dd9;_0x1496d2[_0x35f2e9(0xcb)]!==null&&_0x1496d2['gatewayCommissionRate']!==undefined?(_0x3a2dd9=_0x1496d2[_0x35f2e9(0xcb)],console[_0x35f2e9(0x1b8)]('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x1496d2['id']+':\x20'+_0x3a2dd9+'%')):(_0x3a2dd9=_0x272ccf>0x0?_0x4afeb9/_0x272ccf*0x64:0x0,console[_0x35f2e9(0x1b8)](_0x35f2e9(0x1b5)+_0x1496d2['id']+':\x20'+_0x3a2dd9['toFixed'](0x2)+'%'));!_0x4c11a2[_0x1496d2['gateway']]&&(_0x4c11a2[_0x1496d2[_0x35f2e9(0x141)]]={'gateway':_0x1496d2[_0x35f2e9(0x141)],'gatewayDisplayName':this[_0x35f2e9(0x1b3)](_0x1496d2[_0x35f2e9(0x141)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4c11a2[_0x1496d2[_0x35f2e9(0x141)]][_0x35f2e9(0xb5)]++,_0x4c11a2[_0x1496d2['gateway']][_0x35f2e9(0xae)]+=_0x272ccf,_0x4c11a2[_0x1496d2['gateway']][_0x35f2e9(0x1a0)]+=_0x4afeb9,_0x4c11a2[_0x1496d2['gateway']][_0x35f2e9(0x123)]+=_0x35d4a9,_0x4c11a2[_0x1496d2[_0x35f2e9(0x141)]][_0x35f2e9(0x1ce)]+=_0x3a2dd9;!_0x250978[_0x35f2e9(0xfb)]&&(!_0x504754[_0x1496d2[_0x35f2e9(0xfb)]]&&(_0x504754[_0x1496d2[_0x35f2e9(0xfb)]]={'shopId':_0x1496d2[_0x35f2e9(0xfb)],'shopName':_0x1496d2['shop'][_0x35f2e9(0x1d2)],'shopUsername':_0x1496d2['shop'][_0x35f2e9(0x101)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x504754[_0x1496d2[_0x35f2e9(0xfb)]]['paymentsCount']++,_0x504754[_0x1496d2[_0x35f2e9(0xfb)]][_0x35f2e9(0xae)]+=_0x272ccf,_0x504754[_0x1496d2['shopId']][_0x35f2e9(0x1a0)]+=_0x4afeb9,_0x504754[_0x1496d2[_0x35f2e9(0xfb)]][_0x35f2e9(0x123)]+=_0x35d4a9);const _0x653ace=_0x1496d2['paidAt'][_0x35f2e9(0x110)]()[_0x35f2e9(0x1ae)]('T')[0x0];!_0x25b005[_0x653ace]&&(_0x25b005[_0x653ace]={'date':_0x653ace,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x25b005[_0x653ace][_0x35f2e9(0x10a)]+=_0x272ccf,_0x25b005[_0x653ace][_0x35f2e9(0xe9)]+=_0x35d4a9,_0x25b005[_0x653ace]['gatewayEarnings']+=_0x4afeb9,_0x25b005[_0x653ace][_0x35f2e9(0xb5)]++;}catch(_0x4c4358){console[_0x35f2e9(0x106)]('Error\x20processing\x20payment\x20'+_0x1496d2['id']+':',_0x4c4358);}}Object[_0x35f2e9(0x143)](_0x4c11a2)['forEach'](_0x513414=>{const _0x4eba05=_0x35f2e9;_0x513414[_0x4eba05(0x130)]=_0x513414['paymentsCount']>0x0?_0x513414[_0x4eba05(0x1ce)]/_0x513414[_0x4eba05(0xb5)]:0x0,delete _0x513414[_0x4eba05(0x1ce)];}),Object[_0x35f2e9(0x143)](_0x504754)['forEach'](_0x3fc337=>{const _0x5c353f=_0x35f2e9;_0x3fc337['averageCheckUSDT']=_0x3fc337[_0x5c353f(0xb5)]>0x0?_0x3fc337[_0x5c353f(0xae)]/_0x3fc337[_0x5c353f(0xb5)]:0x0;});let _0x46e714=0x0,_0x1989b1=0x0;if(_0x250978[_0x35f2e9(0xfb)]){const _0x3e79b7=await database_1[_0x35f2e9(0x19b)][_0x35f2e9(0x1d9)]['findMany']({'where':{'shopId':_0x250978['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x2945c8,'lte':_0xcb38c2}},'select':{'amount':!![]}});_0x46e714=_0x3e79b7[_0x35f2e9(0x108)]((_0x351526,_0x3bc7cd)=>_0x351526+_0x3bc7cd['amount'],0x0);const _0x42d218=await database_1['default'][_0x35f2e9(0x1d9)][_0x35f2e9(0x1db)]({'where':{'shopId':_0x250978[_0x35f2e9(0xfb)],'status':'PENDING','createdAt':{'gte':_0x2945c8,'lte':_0xcb38c2}},'select':{'amount':!![]}});_0x1989b1=_0x42d218[_0x35f2e9(0x108)]((_0x56fe0d,_0xd91446)=>_0x56fe0d+_0xd91446[_0x35f2e9(0x128)],0x0);}const _0x25bb28=_0x4d0059,_0xf86a35=_0x15e881[_0x35f2e9(0x1a9)],_0x5d081c=_0xf86a35>0x0?_0x2a6429/_0xf86a35:0x0,_0x47f7a3=_0x25bb28>0x0?Math[_0x35f2e9(0x114)](_0xf86a35/_0x25bb28*0x2710)/0x64:0x0,_0xd6a840=Math[_0x35f2e9(0xdb)]((_0xcb38c2[_0x35f2e9(0x1c4)]()-_0x2945c8[_0x35f2e9(0x1c4)]())/(0x3e8*0x3c*0x3c*0x18)),_0xae5740={'totalTurnover':Math['round'](_0x2a6429*0x64)/0x64,'merchantEarnings':Math[_0x35f2e9(0x114)](_0x1db713*0x64)/0x64,'gatewayEarnings':Math[_0x35f2e9(0x114)](_0x395641*0x64)/0x64,'totalPaidOut':Math[_0x35f2e9(0x114)](_0x46e714*0x64)/0x64,'pendingPayout':Math[_0x35f2e9(0x114)](_0x1989b1*0x64)/0x64,'averageCheck':Math['round'](_0x5d081c*0x64)/0x64,'totalPayments':_0x25bb28,'successfulPayments':_0xf86a35,'conversionRate':_0x47f7a3,'gatewayBreakdown':Object['values'](_0x4c11a2)[_0x35f2e9(0x16f)](_0x5ec362=>({..._0x5ec362,'turnoverUSDT':Math[_0x35f2e9(0x114)](_0x5ec362[_0x35f2e9(0xae)]*0x64)/0x64,'commissionUSDT':Math[_0x35f2e9(0x114)](_0x5ec362[_0x35f2e9(0x1a0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x35f2e9(0x114)](_0x5ec362['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x35f2e9(0x114)](_0x5ec362[_0x35f2e9(0x130)]*0x64)/0x64})),'merchantBreakdown':_0x250978['shopId']?undefined:Object['values'](_0x504754)[_0x35f2e9(0x16f)](_0x53236e=>({..._0x53236e,'turnoverUSDT':Math[_0x35f2e9(0x114)](_0x53236e['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x35f2e9(0x114)](_0x53236e[_0x35f2e9(0x1a0)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x53236e[_0x35f2e9(0x123)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x53236e[_0x35f2e9(0x198)]*0x64)/0x64,'averageCheckUSDT':Math[_0x35f2e9(0x114)](_0x53236e[_0x35f2e9(0x1a3)]*0x64)/0x64})),'dailyData':Object['values'](_0x25b005)['map'](_0x554b5c=>({..._0x554b5c,'turnover':Math[_0x35f2e9(0x114)](_0x554b5c[_0x35f2e9(0x10a)]*0x64)/0x64,'merchantEarnings':Math[_0x35f2e9(0x114)](_0x554b5c['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x35f2e9(0x114)](_0x554b5c[_0x35f2e9(0xba)]*0x64)/0x64}))[_0x35f2e9(0x1a5)]((_0x4a538d,_0x5221c2)=>_0x4a538d['date'][_0x35f2e9(0x172)](_0x5221c2[_0x35f2e9(0x173)])),'periodInfo':{'from':_0x2945c8,'to':_0xcb38c2,'periodType':_0x250978['period']||'custom','daysCount':_0xd6a840}};return console[_0x35f2e9(0x1b8)](_0x35f2e9(0x1bd)),console[_0x35f2e9(0x1b8)](_0x35f2e9(0x1df)+_0xae5740[_0x35f2e9(0xe6)]+_0x35f2e9(0x193)),console[_0x35f2e9(0x1b8)](_0x35f2e9(0x144)+_0xae5740[_0x35f2e9(0xe9)]+_0x35f2e9(0x193)),console[_0x35f2e9(0x1b8)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0xae5740[_0x35f2e9(0xba)]+_0x35f2e9(0x193)),console[_0x35f2e9(0x1b8)](_0x35f2e9(0xaf)+_0xae5740['totalPaidOut']+'\x20USDT'),console[_0x35f2e9(0x1b8)](_0x35f2e9(0x1a1)+_0xae5740[_0x35f2e9(0x1e2)]+_0x35f2e9(0x193)),console[_0x35f2e9(0x1b8)](_0x35f2e9(0xac)+_0xae5740[_0x35f2e9(0x1e3)]),_0xae5740;}async['getMerchantsSelection'](){const _0xf72124=a36_0x286081;console['log'](_0xf72124(0x185));const _0x1b6b7b=await database_1[_0xf72124(0x19b)][_0xf72124(0x197)]['findMany']({'where':{'status':_0xf72124(0x1c3)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xf72124(0x163)}});return console[_0xf72124(0x1b8)](_0xf72124(0x11d)+_0x1b6b7b[_0xf72124(0x1a9)]+_0xf72124(0xb8)),_0x1b6b7b[_0xf72124(0x16f)](_0x37e939=>({'id':_0x37e939['id'],'username':_0x37e939[_0xf72124(0x101)],'name':_0x37e939[_0xf72124(0x1d2)]}));}['getGatewayDisplayName'](_0x55606b){const _0x1e0a7a=a36_0x286081,_0x43017e={'test_gateway':_0x1e0a7a(0x11f),'plisio':_0x1e0a7a(0x13e),'rapyd':'Rapyd','noda':_0x1e0a7a(0x18e),'cointopay':_0x1e0a7a(0x12a),'cointopay2':'Open\x20Banking\x202','klyme_eu':'KLYME\x20EU','klyme_gb':_0x1e0a7a(0xb1),'klyme_de':_0x1e0a7a(0x111),'mastercard':'MasterCard'};return _0x43017e[_0x55606b]||_0x55606b;}[a36_0x286081(0x118)](_0x3da965){const _0x5cb091=a36_0x286081,_0x2e0bd7={'Test\x20Gateway':_0x5cb091(0x19a),'Plisio':_0x5cb091(0x135),'Rapyd':_0x5cb091(0xff),'Noda':_0x5cb091(0xfa),'CoinToPay':'cointopay','CoinToPay2':_0x5cb091(0x1ac),'KLYME\x20EU':_0x5cb091(0x189),'KLYME\x20GB':_0x5cb091(0x137),'KLYME\x20DE':_0x5cb091(0xc9),'MasterCard':'mastercard'};return _0x2e0bd7[_0x3da965]||_0x3da965[_0x5cb091(0xf3)]();}async[a36_0x286081(0xc3)](_0x2f3a9d){const _0xc50e88=a36_0x286081,{page:_0x113b65,limit:_0x1336bf,minAmount:_0x37a4f1,search:_0x2525f8}=_0x2f3a9d,_0x1fdb85=(_0x113b65-0x1)*_0x1336bf;console['log'](_0xc50e88(0xf4),_0x2f3a9d);const _0x15b28e={'balance':{'gt':0x0},'status':_0xc50e88(0x1c3)};_0x37a4f1&&(_0x15b28e[_0xc50e88(0x17c)][_0xc50e88(0xc7)]=_0x37a4f1);_0x2525f8&&(_0x15b28e[_0xc50e88(0x1d2)]={'contains':_0x2525f8,'mode':'insensitive'});const [_0x2dfc1c,_0x48fb5a]=await Promise[_0xc50e88(0x1c5)]([database_1[_0xc50e88(0x19b)][_0xc50e88(0x197)]['findMany']({'where':_0x15b28e,'skip':_0x1fdb85,'take':_0x1336bf,'orderBy':{'balance':_0xc50e88(0x10b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0xc50e88(0x19b)][_0xc50e88(0x197)][_0xc50e88(0x124)]({'where':_0x15b28e})]);console[_0xc50e88(0x1b8)](_0xc50e88(0xec)+_0x2dfc1c['length']+_0xc50e88(0xbe));const _0x28e767=await Promise[_0xc50e88(0x1c5)](_0x2dfc1c[_0xc50e88(0x16f)](async _0x2688ab=>{const _0x5ec6ad=_0xc50e88,[_0x49073e,_0x136607,_0x406c61]=await Promise[_0x5ec6ad(0x1c5)]([database_1[_0x5ec6ad(0x19b)][_0x5ec6ad(0x1b4)][_0x5ec6ad(0x124)]({'where':{'shopId':_0x2688ab['id'],'status':'PAID','gateway':{'not':_0x5ec6ad(0x19a)}}}),database_1[_0x5ec6ad(0x19b)]['payment'][_0x5ec6ad(0xc6)]({'where':{'shopId':_0x2688ab['id'],'status':_0x5ec6ad(0xe8),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x5ec6ad(0x163)},'select':{'paidAt':!![]}}),database_1[_0x5ec6ad(0x19b)]['payment'][_0x5ec6ad(0x1e0)]({'by':[_0x5ec6ad(0x141)],'where':{'shopId':_0x2688ab['id'],'status':'PAID','gateway':{'not':_0x5ec6ad(0x19a)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xa28f1b=new Date(),_0x31ba60=new Date(_0xa28f1b[_0x5ec6ad(0x17f)](),_0xa28f1b['getMonth'](),0x1),_0xa5289=new Date(_0xa28f1b[_0x5ec6ad(0x17f)](),_0xa28f1b[_0x5ec6ad(0x1af)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3a92d9,_0x230ba5]=await Promise[_0x5ec6ad(0x1c5)]([database_1[_0x5ec6ad(0x19b)][_0x5ec6ad(0x1d9)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x2688ab['id'],'status':_0x5ec6ad(0x15e)}}),database_1[_0x5ec6ad(0x19b)][_0x5ec6ad(0x1d9)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x2688ab['id'],'status':_0x5ec6ad(0x15e),'createdAt':{'gte':_0x31ba60,'lte':_0xa5289}}})]),_0x20f966=_0x3a92d9['_sum'][_0x5ec6ad(0x128)]||0x0,_0x3c4e24=_0x230ba5['_sum']['amount']||0x0,_0x4607e3=await Promise['all'](_0x406c61[_0x5ec6ad(0x16f)](async _0x174c66=>{const _0x1ab4b7=_0x5ec6ad;let _0x5d5fce=0x2d;if(_0x2688ab[_0x1ab4b7(0xef)])try{const _0x33f6d4=JSON[_0x1ab4b7(0x1a6)](_0x2688ab[_0x1ab4b7(0xef)]);for(const [_0x1729d9,_0x2a67e0]of Object[_0x1ab4b7(0x121)](_0x33f6d4)){if(_0x1729d9[_0x1ab4b7(0xf3)]()===_0x174c66['gateway'][_0x1ab4b7(0xf3)]()){_0x5d5fce=_0x2a67e0[_0x1ab4b7(0xd4)]||0xa,console['log'](_0x1ab4b7(0x151)+_0x174c66[_0x1ab4b7(0x141)]+_0x1ab4b7(0x18b)+_0x2688ab['id']+':\x20commission\x20=\x20'+_0x5d5fce+'%');break;}}}catch(_0xd0711){console['error'](_0x1ab4b7(0x12d)+_0x2688ab['id']+':',_0xd0711);}const _0x20a9dc=_0x174c66[_0x1ab4b7(0x1a2)]?.[_0x1ab4b7(0xe7)]||0x0,_0x29fdc2=_0x20a9dc*(0x1-_0x5d5fce/0x64);return{'gateway':_0x174c66[_0x1ab4b7(0x141)],'count':_0x174c66[_0x1ab4b7(0x104)]?.['id']||0x0,'amountUSDT':Math[_0x1ab4b7(0x114)](_0x20a9dc*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x1ab4b7(0x114)](_0x29fdc2*0x64)/0x64,'commission':_0x5d5fce};})),_0x18d036=_0x4607e3['reduce']((_0x474644,_0x1b81ad)=>_0x474644+_0x1b81ad[_0x5ec6ad(0xe7)],0x0),_0x12e7cb=_0x4607e3['reduce']((_0x512406,_0x4e1a5e)=>_0x512406+_0x4e1a5e['amountAfterCommissionUSDT'],0x0),_0x19d670=_0x2688ab[_0x5ec6ad(0x17c)];return console[_0x5ec6ad(0x1b8)](_0x5ec6ad(0x132)+_0x2688ab[_0x5ec6ad(0x101)]+':'),console['log'](_0x5ec6ad(0x146)+_0x18d036['toFixed'](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x5ec6ad(0x1b8)](_0x5ec6ad(0x1d7)+_0x12e7cb[_0x5ec6ad(0x152)](0x2)+_0x5ec6ad(0xee)),console[_0x5ec6ad(0x1b8)](_0x5ec6ad(0xd3)+_0x19d670['toFixed'](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x5ec6ad(0x1b8)]('\x20\x20\x20💸\x20Total\x20payouts:\x20'+_0x20f966['toFixed'](0x2)+_0x5ec6ad(0x109)),console['log']('\x20\x20\x20🤔\x20Difference:\x20'+(_0x12e7cb-_0x20f966-_0x19d670)[_0x5ec6ad(0x152)](0x2)+_0x5ec6ad(0x16d)),{'id':_0x2688ab['id'],'fullName':_0x2688ab[_0x5ec6ad(0x1d2)],'username':_0x2688ab[_0x5ec6ad(0x101)],'telegramId':_0x2688ab[_0x5ec6ad(0x175)],'merchantUrl':_0x2688ab[_0x5ec6ad(0x1b2)],'wallets':{'usdtPolygonWallet':_0x2688ab[_0x5ec6ad(0x1bf)],'usdtTrcWallet':_0x2688ab[_0x5ec6ad(0x19c)],'usdtErcWallet':_0x2688ab[_0x5ec6ad(0xb2)],'usdcPolygonWallet':_0x2688ab['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x5ec6ad(0x114)](_0x18d036*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5ec6ad(0x114)](_0x12e7cb*0x64)/0x64,'currentBalance':Math['round'](_0x19d670*0x64)/0x64,'totalPayout':Math[_0x5ec6ad(0x114)](_0x20f966*0x64)/0x64,'thisMonth':Math[_0x5ec6ad(0x114)](_0x3c4e24*0x64)/0x64,'paymentsCount':_0x49073e,'oldestPaymentDate':_0x136607?.[_0x5ec6ad(0x19f)]||_0x2688ab[_0x5ec6ad(0x131)],'gatewayBreakdown':_0x4607e3};})),_0x1839cd=_0x28e767[_0xc50e88(0x108)]((_0x22c223,_0x1bd938)=>_0x22c223+_0x1bd938[_0xc50e88(0xd9)],0x0),_0x100a54=_0x28e767[_0xc50e88(0x108)]((_0x165297,_0x59fd02)=>_0x165297+_0x59fd02[_0xc50e88(0x119)],0x0),_0x324c14=_0x28e767['reduce']((_0x5026ec,_0x23e3c8)=>_0x5026ec+_0x23e3c8[_0xc50e88(0x188)],0x0),_0xf1f38d=_0x28e767['reduce']((_0x2fff48,_0x223640)=>_0x2fff48+_0x223640[_0xc50e88(0xd6)],0x0);return console['log']('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x48fb5a+_0xc50e88(0x116)),console['log']('\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20'+Math[_0xc50e88(0x114)](_0x1839cd*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0xc50e88(0x1b8)](_0xc50e88(0x105)+Math[_0xc50e88(0x114)](_0x100a54*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0xc50e88(0x1b8)](_0xc50e88(0xf8)+Math['round'](_0x324c14*0x64)/0x64+'\x20USDT'),console['log'](_0xc50e88(0xd0)+Math[_0xc50e88(0x114)](_0xf1f38d*0x64)/0x64+_0xc50e88(0x193)),{'merchants':_0x28e767,'pagination':{'page':_0x113b65,'limit':_0x1336bf,'total':_0x48fb5a,'totalPages':Math[_0xc50e88(0xdb)](_0x48fb5a/_0x1336bf)},'summary':{'totalMerchants':_0x48fb5a,'totalAmountUSDT':Math['round'](_0x1839cd*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x100a54*0x64)/0x64,'totalPayout':Math[_0xc50e88(0x114)](_0x324c14*0x64)/0x64,'thisMonth':Math['round'](_0xf1f38d*0x64)/0x64}};}async[a36_0x286081(0x1d5)](_0x399e0e){const _0x103a6e=a36_0x286081,{shopId:_0x57993f,amount:_0x800abf,network:_0x956a28,wallet:_0x16ea9c,notes:_0x249743,txid:_0x311f05,periodFrom:_0x3b2faa,periodTo:_0x3cb0ee}=_0x399e0e,_0x3147dd=await database_1['default'][_0x103a6e(0x164)](async _0x3d960c=>{const _0x1def80=_0x103a6e,_0x38d2ca=await _0x3d960c['shop'][_0x1def80(0xf5)]({'where':{'id':_0x57993f},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x38d2ca)throw new Error(_0x1def80(0x10c));console['log'](_0x1def80(0xf9)+_0x38d2ca[_0x1def80(0x101)]+':'),console['log'](_0x1def80(0xcc)+_0x38d2ca[_0x1def80(0x17c)]['toFixed'](0x6)+'\x20USDT'),console[_0x1def80(0x1b8)](_0x1def80(0x166)+_0x800abf[_0x1def80(0x152)](0x6)+_0x1def80(0x193)),console[_0x1def80(0x1b8)](_0x1def80(0xed)+_0x38d2ca['totalPaidOut']['toFixed'](0x6)+_0x1def80(0x193));if(_0x311f05)console[_0x1def80(0x1b8)](_0x1def80(0x117)+_0x311f05);if(_0x38d2ca[_0x1def80(0x17c)]<_0x800abf)throw new Error(_0x1def80(0x18c)+_0x38d2ca['balance'][_0x1def80(0x152)](0x6)+_0x1def80(0x1c1)+_0x800abf['toFixed'](0x6)+_0x1def80(0x193));let _0x451ab1=_0x16ea9c;if(!_0x451ab1){const _0x1e6a92=await _0x3d960c['shop'][_0x1def80(0xf5)]({'where':{'id':_0x57993f},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x1e6a92)switch(_0x956a28){case'polygon':_0x451ab1=_0x1e6a92[_0x1def80(0x1bf)]||undefined;break;case _0x1def80(0x1de):_0x451ab1=_0x1e6a92[_0x1def80(0x19c)]||undefined;break;case _0x1def80(0x19e):_0x451ab1=_0x1e6a92[_0x1def80(0xb2)]||undefined;break;case _0x1def80(0xbf):_0x451ab1=_0x1e6a92[_0x1def80(0x186)]||undefined;break;}}console[_0x1def80(0x1b8)](_0x1def80(0x11b)+_0x956a28+':\x20'+(_0x451ab1||'not\x20specified'));const _0x2e74be=await _0x3d960c[_0x1def80(0x1d9)][_0x1def80(0x138)]({'data':{'shopId':_0x57993f,'amount':_0x800abf,'network':_0x956a28,'status':_0x1def80(0x15e),'txid':_0x311f05,'notes':_0x249743,'periodFrom':_0x3b2faa?new Date(_0x3b2faa):null,'periodTo':_0x3cb0ee?new Date(_0x3cb0ee):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2fb497=_0x38d2ca['balance']-_0x800abf,_0x1d378b=_0x38d2ca['totalPaidOut']+_0x800abf;return await _0x3d960c['shop'][_0x1def80(0x18d)]({'where':{'id':_0x57993f},'data':{'balance':_0x2fb497,'totalPaidOut':_0x1d378b}}),console[_0x1def80(0x1b8)](_0x1def80(0x167)+_0x38d2ca[_0x1def80(0x101)]+'\x20balance\x20updated:'),console[_0x1def80(0x1b8)](_0x1def80(0x194)+_0x38d2ca[_0x1def80(0x17c)][_0x1def80(0x152)](0x6)+'\x20->\x20'+_0x2fb497['toFixed'](0x6)+'\x20USDT\x20(-'+_0x800abf['toFixed'](0x6)+')'),console[_0x1def80(0x1b8)](_0x1def80(0x16e)+_0x38d2ca[_0x1def80(0x17a)]['toFixed'](0x6)+'\x20->\x20'+_0x1d378b['toFixed'](0x6)+_0x1def80(0x113)+_0x800abf[_0x1def80(0x152)](0x6)+')'),{'payout':_0x2e74be,'shop':_0x38d2ca};});return console[_0x103a6e(0x1b8)](_0x103a6e(0x1be)+_0x3147dd[_0x103a6e(0x1d9)]['id']+_0x103a6e(0x18b)+_0x3147dd[_0x103a6e(0x197)]['username']+'\x20('+_0x800abf+'\x20USDT)'),{'id':_0x3147dd[_0x103a6e(0x1d9)]['id'],'shopId':_0x3147dd['payout'][_0x103a6e(0xfb)],'shopName':_0x3147dd[_0x103a6e(0x197)][_0x103a6e(0x1d2)],'shopUsername':_0x3147dd[_0x103a6e(0x197)][_0x103a6e(0x101)],'amount':_0x3147dd[_0x103a6e(0x1d9)]['amount'],'network':_0x3147dd['payout'][_0x103a6e(0x120)],'status':_0x3147dd[_0x103a6e(0x1d9)][_0x103a6e(0xb0)],'txid':_0x3147dd['payout'][_0x103a6e(0x11c)],'notes':_0x3147dd[_0x103a6e(0x1d9)]['notes'],'periodFrom':_0x3147dd['payout'][_0x103a6e(0x196)],'periodTo':_0x3147dd['payout'][_0x103a6e(0xda)],'createdAt':_0x3147dd[_0x103a6e(0x1d9)][_0x103a6e(0x131)],'paidAt':_0x3147dd[_0x103a6e(0x1d9)][_0x103a6e(0x19f)]};}async[a36_0x286081(0x13d)](_0x332f11){const _0x17e81f=a36_0x286081,{page:_0x52e6e5,limit:_0x496dda,shopId:_0x3fa7be,network:_0x9d5493,dateFrom:_0x253b66,dateTo:_0x19c77d,search:_0x553197}=_0x332f11,_0x11bc55=(_0x52e6e5-0x1)*_0x496dda,_0x350071={};_0x3fa7be&&(_0x350071[_0x17e81f(0xfb)]=_0x3fa7be);_0x9d5493&&(_0x350071[_0x17e81f(0x120)]=_0x9d5493);(_0x253b66||_0x19c77d)&&(_0x350071[_0x17e81f(0x131)]={},_0x253b66&&(_0x350071[_0x17e81f(0x131)][_0x17e81f(0xc7)]=new Date(_0x253b66)),_0x19c77d&&(_0x350071['createdAt'][_0x17e81f(0x1b7)]=new Date(_0x19c77d)));_0x553197&&(_0x350071['OR']=[{'shop':{'name':{'contains':_0x553197,'mode':_0x17e81f(0xce)}}},{'shop':{'username':{'contains':_0x553197,'mode':_0x17e81f(0xce)}}},{'notes':{'contains':_0x553197,'mode':_0x17e81f(0xce)}}]);const [_0x5a82d6,_0xb1c40a]=await Promise['all']([database_1[_0x17e81f(0x19b)][_0x17e81f(0x1d9)][_0x17e81f(0x1db)]({'where':_0x350071,'skip':_0x11bc55,'take':_0x496dda,'orderBy':{'createdAt':_0x17e81f(0x10b)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x17e81f(0x19b)]['payout'][_0x17e81f(0x124)]({'where':_0x350071})]);return{'payouts':_0x5a82d6[_0x17e81f(0x16f)](_0x46d0a1=>({'id':_0x46d0a1['id'],'shopId':_0x46d0a1[_0x17e81f(0xfb)],'shopName':_0x46d0a1[_0x17e81f(0x197)][_0x17e81f(0x1d2)],'shopUsername':_0x46d0a1['shop'][_0x17e81f(0x101)],'amount':_0x46d0a1[_0x17e81f(0x128)],'network':_0x46d0a1[_0x17e81f(0x120)],'status':_0x46d0a1[_0x17e81f(0xb0)],'txid':_0x46d0a1['txid'],'notes':_0x46d0a1['notes'],'periodFrom':_0x46d0a1[_0x17e81f(0x196)],'periodTo':_0x46d0a1[_0x17e81f(0xda)],'createdAt':_0x46d0a1['createdAt'],'paidAt':_0x46d0a1[_0x17e81f(0x19f)]})),'pagination':{'page':_0x52e6e5,'limit':_0x496dda,'total':_0xb1c40a,'totalPages':Math[_0x17e81f(0xdb)](_0xb1c40a/_0x496dda)}};}async[a36_0x286081(0x129)](_0x417a99){const _0x44962f=a36_0x286081,_0x3a10b9=await database_1['default'][_0x44962f(0x1d9)][_0x44962f(0xf5)]({'where':{'id':_0x417a99},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3a10b9)return null;return{'id':_0x3a10b9['id'],'shopId':_0x3a10b9[_0x44962f(0xfb)],'shopName':_0x3a10b9[_0x44962f(0x197)][_0x44962f(0x1d2)],'shopUsername':_0x3a10b9[_0x44962f(0x197)][_0x44962f(0x101)],'amount':_0x3a10b9[_0x44962f(0x128)],'network':_0x3a10b9[_0x44962f(0x120)],'status':_0x3a10b9[_0x44962f(0xb0)],'txid':_0x3a10b9['txid'],'notes':_0x3a10b9['notes'],'periodFrom':_0x3a10b9[_0x44962f(0x196)],'periodTo':_0x3a10b9[_0x44962f(0xda)],'createdAt':_0x3a10b9['createdAt'],'paidAt':_0x3a10b9['paidAt']};}async['deletePayout'](_0x3e5254){const _0x25bf11=a36_0x286081;await database_1[_0x25bf11(0x19b)][_0x25bf11(0x1d9)][_0x25bf11(0x14a)]({'where':{'id':_0x3e5254}});}async[a36_0x286081(0x13b)](_0x2a25de){const _0x5a5d53=a36_0x286081,{page:_0x2ed05d,limit:_0x166dea,status:_0x3e87d2,gateway:_0xb2159a,shopId:_0x104ef9,dateFrom:_0x5b5cc4,dateTo:_0x29137c,search:_0x1fab50,currency:_0x153899,sortBy:_0x1857e8,sortOrder:_0x1fe067}=_0x2a25de,_0x3c337b=(_0x2ed05d-0x1)*_0x166dea;console[_0x5a5d53(0x1b8)](_0x5a5d53(0xbd),_0x2a25de);const _0x5a0c70=await database_1['default'][_0x5a5d53(0x1b4)][_0x5a5d53(0x1e0)]({'by':[_0x5a5d53(0x141)],'_count':{'gateway':!![]}});console['log']('📊\x20Available\x20gateways\x20in\x20database:',_0x5a0c70['map'](_0x5d2c7d=>_0x5d2c7d[_0x5a5d53(0x141)]+'\x20('+_0x5d2c7d[_0x5a5d53(0x104)]['gateway']+_0x5a5d53(0x12e)));if(_0xb2159a){const _0xec69e3=_0x5a0c70['some'](_0x1a15d5=>_0x1a15d5[_0x5a5d53(0x141)][_0x5a5d53(0xf3)]()===_0xb2159a[_0x5a5d53(0xf3)]());!_0xec69e3&&_0xb2159a[_0x5a5d53(0xf3)]()!==_0x5a5d53(0x19a)&&console[_0x5a5d53(0x1b8)](_0x5a5d53(0x192)+_0xb2159a+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x5a0c70[_0x5a5d53(0x16f)](_0x161ed7=>_0x161ed7[_0x5a5d53(0x141)])[_0x5a5d53(0x142)](',\x20'));}const _0x2d4860={};_0x3e87d2&&(_0x2d4860[_0x5a5d53(0xb0)]=_0x3e87d2['toUpperCase']());if(!_0xb2159a)_0x2d4860[_0x5a5d53(0x141)]={'not':'test_gateway'};else{if(_0xb2159a&&(_0xb2159a[_0x5a5d53(0xf3)]()==='test_gateway'||_0xb2159a==='0000'))_0x2d4860[_0x5a5d53(0x141)]=_0x5a5d53(0x19a);else{let _0x12887c=_0xb2159a;const _0x3ca6fb=(0x0,gateway_1[_0x5a5d53(0x1a7)])(_0xb2159a);if(_0x3ca6fb)_0x12887c=_0x3ca6fb,console[_0x5a5d53(0x1b8)](_0x5a5d53(0x174)+_0xb2159a+_0x5a5d53(0x102)+_0x12887c+'\x27');else{const _0x1aad6c=(0x0,gateway_1[_0x5a5d53(0x1da)])(_0xb2159a);if(_0x1aad6c){const _0x205144=(0x0,gateway_1[_0x5a5d53(0x1a7)])(_0x1aad6c);_0x205144&&(_0x12887c=_0x205144,console['log'](_0x5a5d53(0x150)+_0xb2159a+_0x5a5d53(0x1ad)+_0x1aad6c+_0x5a5d53(0xb9)+_0x12887c+'\x27'));}else console[_0x5a5d53(0x1b8)]('🔍\x20Using\x20gateway\x20\x27'+_0xb2159a+_0x5a5d53(0x1aa));}const _0x3517b6=await database_1['default'][_0x5a5d53(0x1b4)][_0x5a5d53(0x124)]({'where':{'gateway':_0x12887c[_0x5a5d53(0xf3)]()},'take':0x1});_0x3517b6===0x0?(console[_0x5a5d53(0x1b8)]('⚠️\x20Gateway\x20\x27'+_0x12887c+_0x5a5d53(0x178)+_0xb2159a+_0x5a5d53(0x11e)),_0x2d4860[_0x5a5d53(0x141)]='NONEXISTENT_GATEWAY_FILTER'):(_0x2d4860['gateway']=_0x12887c['toLowerCase'](),console['log']('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x12887c+_0x5a5d53(0x178)+_0xb2159a+'\x27)'));}}console['log'](_0x5a5d53(0x176),_0x2d4860['gateway']);_0x104ef9&&(_0x2d4860[_0x5a5d53(0xfb)]=_0x104ef9);_0x153899&&(_0x2d4860[_0x5a5d53(0xd2)]=_0x153899[_0x5a5d53(0x159)](),console[_0x5a5d53(0x1b8)](_0x5a5d53(0x12f)+_0x153899[_0x5a5d53(0x159)]()));(_0x5b5cc4||_0x29137c)&&(_0x2d4860['createdAt']={},_0x5b5cc4&&(_0x2d4860['createdAt'][_0x5a5d53(0xc7)]=new Date(_0x5b5cc4)),_0x29137c&&(_0x2d4860[_0x5a5d53(0x131)][_0x5a5d53(0x1b7)]=new Date(_0x29137c)));_0x1fab50&&(_0x2d4860['OR']=[{'id':{'contains':_0x1fab50,'mode':_0x5a5d53(0xce)}},{'orderId':{'contains':_0x1fab50,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x1fab50,'mode':_0x5a5d53(0xce)}},{'customerEmail':{'contains':_0x1fab50,'mode':_0x5a5d53(0xce)}},{'shop':{'name':{'contains':_0x1fab50,'mode':_0x5a5d53(0xce)}}},{'shop':{'username':{'contains':_0x1fab50,'mode':'insensitive'}}}]);console[_0x5a5d53(0x1b8)](_0x5a5d53(0x182),JSON[_0x5a5d53(0x13a)](_0x2d4860,null,0x2));let _0x38c212={'createdAt':'desc'};if(_0x1857e8){const _0x2e0a4f=['amount',_0x5a5d53(0x131),_0x5a5d53(0xeb),_0x5a5d53(0xb0),_0x5a5d53(0x141),'currency'],_0x214ba6=['asc','desc'];if(_0x2e0a4f['includes'](_0x1857e8)){const _0x868a8f=_0x214ba6[_0x5a5d53(0x1dc)](_0x1fe067)?_0x1fe067:'desc';_0x38c212={[_0x1857e8]:_0x868a8f},console[_0x5a5d53(0x1b8)](_0x5a5d53(0x181)+_0x1857e8+'\x20in\x20'+_0x868a8f+_0x5a5d53(0x161));}}const [_0x306fd7,_0x27a8ef]=await Promise[_0x5a5d53(0x1c5)]([database_1['default'][_0x5a5d53(0x1b4)][_0x5a5d53(0x1db)]({'where':_0x2d4860,'skip':_0x3c337b,'take':_0x166dea,'orderBy':_0x38c212,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5a5d53(0x19b)]['payment'][_0x5a5d53(0x124)]({'where':_0x2d4860})]);return{'payments':_0x306fd7,'pagination':{'page':_0x2ed05d,'limit':_0x166dea,'total':_0x27a8ef,'totalPages':Math['ceil'](_0x27a8ef/_0x166dea)}};}async[a36_0x286081(0x15b)](_0x339eee){const _0x1c3408=a36_0x286081,_0x8454b4=await database_1[_0x1c3408(0x19b)]['payment']['findUnique']({'where':{'id':_0x339eee},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x8454b4)return null;return{'id':_0x8454b4['id'],'shopId':_0x8454b4[_0x1c3408(0xfb)],'gateway':_0x8454b4[_0x1c3408(0x141)],'amount':_0x8454b4[_0x1c3408(0x128)],'currency':_0x8454b4[_0x1c3408(0xd2)],'status':_0x8454b4[_0x1c3408(0xb0)],'orderId':_0x8454b4[_0x1c3408(0x16a)],'gatewayOrderId':_0x8454b4['gatewayOrderId'],'customerEmail':_0x8454b4[_0x1c3408(0x13f)],'customerName':_0x8454b4[_0x1c3408(0xc5)],'customerCountry':_0x8454b4['customerCountry'],'customerIp':_0x8454b4[_0x1c3408(0x162)],'customerUa':_0x8454b4[_0x1c3408(0x158)],'failureMessage':_0x8454b4[_0x1c3408(0x1bc)],'externalPaymentUrl':_0x8454b4[_0x1c3408(0x148)],'successUrl':_0x8454b4['successUrl'],'failUrl':_0x8454b4[_0x1c3408(0x1d8)],'pendingUrl':_0x8454b4[_0x1c3408(0xfd)],'whiteUrl':_0x8454b4[_0x1c3408(0x1a8)],'createdAt':_0x8454b4[_0x1c3408(0x131)],'updatedAt':_0x8454b4[_0x1c3408(0xeb)],'shop':_0x8454b4['shop']};}async['updatePaymentStatus'](_0xe14866,_0x1504fb,_0x446aa7,_0x2be3ce){const _0x14f13e=a36_0x286081,_0x55e9ca=await database_1['default'][_0x14f13e(0x164)](async _0x17dc0c=>{const _0x21f13c=_0x14f13e,_0x274c8d=await _0x17dc0c[_0x21f13c(0x1b4)][_0x21f13c(0xf5)]({'where':{'id':_0xe14866},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x274c8d)throw new Error(_0x21f13c(0x15c));const _0x2f62f6=_0x274c8d[_0x21f13c(0xb0)],_0xe8c1ec=_0x1504fb['toUpperCase']();console[_0x21f13c(0x1b8)](_0x21f13c(0x15f)+_0xe14866+'\x20status:\x20'+_0x2f62f6+_0x21f13c(0xb3)+_0xe8c1ec),console['log'](_0x21f13c(0xaa)+_0x274c8d['shop'][_0x21f13c(0x17c)]+_0x21f13c(0x193));const _0x194ce2={'status':_0xe8c1ec,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x446aa7&&(_0x194ce2[_0x21f13c(0x12b)]=_0x446aa7);_0xe8c1ec===_0x21f13c(0x169)&&_0x2be3ce&&(_0x194ce2[_0x21f13c(0x18f)]=_0x2be3ce);let _0x57eb42=0x0,_0x487f8e=_0x274c8d['shop']['balance'];if(_0xe8c1ec===_0x21f13c(0xe8)&&_0x2f62f6!==_0x21f13c(0xe8)){_0x194ce2[_0x21f13c(0x19f)]=new Date();const _0x4616db=await currencyService_1[_0x21f13c(0xc4)]['convertToUSDT'](_0x274c8d[_0x21f13c(0x128)],_0x274c8d['currency']);_0x194ce2['amountUSDT']=_0x4616db;let _0x4d4b3d=0x2d;const _0x135d1d=await _0x17dc0c[_0x21f13c(0x197)][_0x21f13c(0xf5)]({'where':{'id':_0x274c8d[_0x21f13c(0xfb)]},'select':{'gatewaySettings':!![]}});if(_0x135d1d?.[_0x21f13c(0xef)])try{const _0x2034bb=JSON[_0x21f13c(0x1a6)](_0x135d1d['gatewaySettings']);for(const [_0x35469e,_0x369888]of Object[_0x21f13c(0x121)](_0x2034bb)){if(_0x35469e[_0x21f13c(0xf3)]()===_0x274c8d[_0x21f13c(0x141)][_0x21f13c(0xf3)]()){_0x4d4b3d=_0x369888[_0x21f13c(0xd4)]||0xa;break;}}}catch(_0xe68f38){console[_0x21f13c(0x106)](_0x21f13c(0xb7)+_0xe14866+':',_0xe68f38);}let _0x44f49c;_0x274c8d['amountAfterGatewayCommissionUSDT']!==null&&_0x274c8d[_0x21f13c(0x16b)]!==undefined?(_0x44f49c=_0x274c8d[_0x21f13c(0x16b)],console[_0x21f13c(0x1b8)](_0x21f13c(0xcd)+_0x44f49c[_0x21f13c(0x152)](0x6)+_0x21f13c(0x100)+_0xe14866)):(_0x44f49c=_0x4616db*(0x1-_0x4d4b3d/0x64),console['log'](_0x21f13c(0x195)+_0xe14866+':\x20'+_0x4d4b3d+'%\x20from\x20'+_0x4616db[_0x21f13c(0x152)](0x6)+_0x21f13c(0x193)),_0x194ce2[_0x21f13c(0x16b)]=_0x44f49c,_0x194ce2[_0x21f13c(0xcb)]=_0x4d4b3d),_0x57eb42=_0x44f49c,_0x487f8e+=_0x44f49c,console[_0x21f13c(0x1b8)](_0x21f13c(0x1a4)+_0xe14866+'\x20became\x20PAID:'),console[_0x21f13c(0x1b8)](_0x21f13c(0xf1)+_0x4616db[_0x21f13c(0x152)](0x6)+_0x21f13c(0x193)),console[_0x21f13c(0x1b8)](_0x21f13c(0x1d3)+_0x274c8d[_0x21f13c(0x141)]+_0x21f13c(0x171)+_0x4d4b3d+'%'),console[_0x21f13c(0x1b8)](_0x21f13c(0x1c6)+_0x44f49c['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0x4d4b3d+_0x21f13c(0xd1)),console[_0x21f13c(0x1b8)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x44f49c['toFixed'](0x6)+'\x20USDT');}else{if(_0x2f62f6===_0x21f13c(0xe8)&&_0xe8c1ec!==_0x21f13c(0xe8)){if(_0x274c8d[_0x21f13c(0xe7)]){let _0x332419=0x2d;const _0x80e414=await _0x17dc0c[_0x21f13c(0x197)][_0x21f13c(0xf5)]({'where':{'id':_0x274c8d[_0x21f13c(0xfb)]},'select':{'gatewaySettings':!![]}});if(_0x80e414?.[_0x21f13c(0xef)])try{const _0x8d2ce7=JSON[_0x21f13c(0x1a6)](_0x80e414[_0x21f13c(0xef)]);for(const [_0x2cfe13,_0x34f5d2]of Object[_0x21f13c(0x121)](_0x8d2ce7)){if(_0x2cfe13['toLowerCase']()===_0x274c8d['gateway'][_0x21f13c(0xf3)]()){_0x332419=_0x34f5d2['commission']||0xa;break;}}}catch(_0x35e145){console[_0x21f13c(0x106)](_0x21f13c(0xb7)+_0xe14866+':',_0x35e145);}const _0x356bf5=_0x274c8d[_0x21f13c(0xe7)]*(0x1-_0x332419/0x64);_0x57eb42=-_0x356bf5,_0x487f8e-=_0x356bf5,_0x194ce2[_0x21f13c(0xe7)]=null,_0x194ce2['amountAfterGatewayCommissionUSDT']=null,console[_0x21f13c(0x1b8)]('💰\x20Payment\x20'+_0xe14866+_0x21f13c(0x10f)),console[_0x21f13c(0x1b8)](_0x21f13c(0xf1)+_0x274c8d['amountUSDT'][_0x21f13c(0x152)](0x6)+_0x21f13c(0x193)),console[_0x21f13c(0x1b8)](_0x21f13c(0x1d3)+_0x274c8d['gateway']+_0x21f13c(0x171)+_0x332419+'%'),console[_0x21f13c(0x1b8)](_0x21f13c(0xfc)+_0x356bf5[_0x21f13c(0x152)](0x6)+_0x21f13c(0x1e5)+_0x332419+_0x21f13c(0xd1)),console['log'](_0x21f13c(0x103)+_0x356bf5['toFixed'](0x6)+_0x21f13c(0x193));}}}_0xe8c1ec===_0x21f13c(0x169)&&(_0x2f62f6==='PAID'&&_0x274c8d['amountUSDT']&&console['log'](_0x21f13c(0x122)),_0x2be3ce&&_0x2be3ce>0x0&&(_0x57eb42-=_0x2be3ce,_0x487f8e-=_0x2be3ce,console[_0x21f13c(0x1b8)](_0x21f13c(0x1bb)+_0x2be3ce[_0x21f13c(0x152)](0x6)+'\x20USDT\x20from\x20balance')));_0xe8c1ec===_0x21f13c(0x112)&&_0x2f62f6===_0x21f13c(0xe8)&&console[_0x21f13c(0x1b8)](_0x21f13c(0x170));const _0x22c014=await _0x17dc0c[_0x21f13c(0x1b4)][_0x21f13c(0x18d)]({'where':{'id':_0xe14866},'data':_0x194ce2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x57eb42!==0x0&&(await _0x17dc0c[_0x21f13c(0x197)]['update']({'where':{'id':_0x274c8d['shopId']},'data':{'balance':_0x487f8e}}),console[_0x21f13c(0x1b8)](_0x21f13c(0x167)+_0x274c8d[_0x21f13c(0xfb)]+_0x21f13c(0x180)+_0x274c8d['shop'][_0x21f13c(0x17c)]['toFixed'](0x6)+_0x21f13c(0xb3)+_0x487f8e[_0x21f13c(0x152)](0x6)+_0x21f13c(0xdf)+(_0x57eb42>0x0?'+':'')+_0x57eb42['toFixed'](0x6)+')')),_0x22c014;});return{'id':_0x55e9ca['id'],'shopId':_0x55e9ca[_0x14f13e(0xfb)],'gateway':_0x55e9ca[_0x14f13e(0x141)],'amount':_0x55e9ca[_0x14f13e(0x128)],'currency':_0x55e9ca[_0x14f13e(0xd2)],'status':_0x55e9ca['status'],'orderId':_0x55e9ca['orderId'],'gatewayOrderId':_0x55e9ca['gatewayOrderId'],'customerEmail':_0x55e9ca['customerEmail'],'customerName':_0x55e9ca['customerName'],'customerCountry':_0x55e9ca['customerCountry'],'customerIp':_0x55e9ca[_0x14f13e(0x162)],'customerUa':_0x55e9ca[_0x14f13e(0x158)],'failureMessage':_0x55e9ca['failureMessage'],'adminNotes':_0x55e9ca[_0x14f13e(0x12b)],'chargebackAmount':_0x55e9ca[_0x14f13e(0x18f)],'statusChangedBy':_0x55e9ca[_0x14f13e(0xbb)],'statusChangedAt':_0x55e9ca[_0x14f13e(0x1cc)],'createdAt':_0x55e9ca[_0x14f13e(0x131)],'updatedAt':_0x55e9ca[_0x14f13e(0xeb)],'shop':_0x55e9ca[_0x14f13e(0x197)]};}async[a36_0x286081(0xb4)](_0x101978,_0x4a82a3){const _0x148635=a36_0x286081,_0xda08f0=Math['random']()[_0x148635(0xd7)](0x24)[_0x148635(0x154)](0x2,0x9);console[_0x148635(0x1b8)](_0x148635(0xea)+_0xda08f0+_0x148635(0xbc)+_0x101978);const _0x4c5505={..._0x4a82a3};_0x4a82a3[_0x148635(0xe4)]&&_0x4a82a3[_0x148635(0xe4)][_0x148635(0x11a)]()!==''?(console[_0x148635(0x1b8)]('🔐\x20['+_0xda08f0+_0x148635(0x17e)+_0x101978),_0x4c5505[_0x148635(0xe4)]=await bcryptjs_1[_0x148635(0x19b)][_0x148635(0x15d)](_0x4a82a3[_0x148635(0xe4)],0xc)):(console['log'](_0x148635(0x149)+_0xda08f0+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x4c5505[_0x148635(0xe4)]);_0x4a82a3['fullName']&&(_0x4c5505[_0x148635(0x1d2)]=_0x4a82a3[_0x148635(0x10e)],delete _0x4c5505['fullName']);_0x4a82a3['telegramId']&&(_0x4c5505['telegram']=_0x4a82a3['telegramId'],delete _0x4c5505[_0x148635(0x165)]);_0x4a82a3['merchantUrl']&&(_0x4c5505['shopUrl']=_0x4a82a3[_0x148635(0x1d0)],delete _0x4c5505['merchantUrl']);if(_0x4a82a3[_0x148635(0x125)]){const _0x379c77=_0x4a82a3[_0x148635(0x125)]['map'](_0x28ae8f=>this[_0x148635(0x118)](_0x28ae8f));console[_0x148635(0x1b8)](_0x148635(0x133),_0x4a82a3[_0x148635(0x125)],'->',_0x379c77),_0x4c5505['paymentGateways']=JSON['stringify'](_0x379c77),delete _0x4c5505[_0x148635(0x125)];}_0x4a82a3[_0x148635(0xef)]&&(console[_0x148635(0x1b8)](_0x148635(0x1c7)+_0xda08f0+']\x20Gateway\x20settings\x20before\x20saving:',_0x4a82a3[_0x148635(0xef)]),_0x4c5505[_0x148635(0xef)]=JSON['stringify'](_0x4a82a3[_0x148635(0xef)]),console[_0x148635(0x1b8)](_0x148635(0x1c7)+_0xda08f0+']\x20Gateway\x20settings\x20JSON\x20string:',_0x4c5505[_0x148635(0xef)]));_0x4a82a3[_0x148635(0x16c)]&&(_0x4a82a3[_0x148635(0x16c)][_0x148635(0x1bf)]!==undefined&&(_0x4c5505[_0x148635(0x1bf)]=_0x4a82a3[_0x148635(0x16c)]['usdtPolygonWallet']||null),_0x4a82a3[_0x148635(0x16c)]['usdtTrcWallet']!==undefined&&(_0x4c5505[_0x148635(0x19c)]=_0x4a82a3[_0x148635(0x16c)][_0x148635(0x19c)]||null),_0x4a82a3[_0x148635(0x16c)][_0x148635(0xb2)]!==undefined&&(_0x4c5505[_0x148635(0xb2)]=_0x4a82a3['wallets'][_0x148635(0xb2)]||null),_0x4a82a3['wallets'][_0x148635(0x186)]!==undefined&&(_0x4c5505[_0x148635(0x186)]=_0x4a82a3['wallets']['usdcPolygonWallet']||null),delete _0x4c5505[_0x148635(0x16c)]);const _0x53cc78=await database_1[_0x148635(0x19b)][_0x148635(0x197)][_0x148635(0x18d)]({'where':{'id':_0x101978},'data':_0x4c5505,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x148635(0x1b8)](_0x148635(0xe0)+_0xda08f0+_0x148635(0x190),_0x53cc78[_0x148635(0xef)]),{'id':_0x53cc78['id'],'fullName':_0x53cc78[_0x148635(0x1d2)],'username':_0x53cc78[_0x148635(0x101)],'telegramId':_0x53cc78[_0x148635(0x175)],'merchantUrl':_0x53cc78[_0x148635(0x1b2)],'gateways':_0x53cc78[_0x148635(0x14f)]?JSON[_0x148635(0x1a6)](_0x53cc78[_0x148635(0x14f)]):null,'gatewaySettings':_0x53cc78[_0x148635(0xef)]?JSON['parse'](_0x53cc78['gatewaySettings']):null,'publicKey':_0x53cc78['publicKey'],'wallets':{'usdtPolygonWallet':_0x53cc78[_0x148635(0x1bf)],'usdtTrcWallet':_0x53cc78[_0x148635(0x19c)],'usdtErcWallet':_0x53cc78[_0x148635(0xb2)],'usdcPolygonWallet':_0x53cc78['usdcPolygonWallet']},'status':_0x53cc78[_0x148635(0xb0)],'createdAt':_0x53cc78['createdAt']};}async[a36_0x286081(0x1d1)](_0xf95fa1){const _0x250e06=a36_0x286081,_0x4a9b77=await database_1['default']['shop']['update']({'where':{'id':_0xf95fa1},'data':{'status':_0x250e06(0x1d6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4a9b77['id'],'fullName':_0x4a9b77[_0x250e06(0x1d2)],'username':_0x4a9b77[_0x250e06(0x101)],'telegramId':_0x4a9b77['telegram'],'merchantUrl':_0x4a9b77[_0x250e06(0x1b2)],'gateways':_0x4a9b77[_0x250e06(0x14f)]?JSON[_0x250e06(0x1a6)](_0x4a9b77['paymentGateways']):null,'gatewaySettings':_0x4a9b77[_0x250e06(0xef)]?JSON[_0x250e06(0x1a6)](_0x4a9b77[_0x250e06(0xef)]):null,'publicKey':_0x4a9b77[_0x250e06(0x187)],'wallets':{'usdtPolygonWallet':_0x4a9b77[_0x250e06(0x1bf)],'usdtTrcWallet':_0x4a9b77[_0x250e06(0x19c)],'usdtErcWallet':_0x4a9b77[_0x250e06(0xb2)],'usdcPolygonWallet':_0x4a9b77[_0x250e06(0x186)]},'status':_0x4a9b77[_0x250e06(0xb0)],'createdAt':_0x4a9b77[_0x250e06(0x131)]};}async[a36_0x286081(0x1c0)](_0x2dd191){const _0x39bab9=a36_0x286081,_0x547177=await database_1[_0x39bab9(0x19b)][_0x39bab9(0x197)][_0x39bab9(0x18d)]({'where':{'id':_0x2dd191},'data':{'status':_0x39bab9(0x1c3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x547177['id'],'fullName':_0x547177[_0x39bab9(0x1d2)],'username':_0x547177[_0x39bab9(0x101)],'telegramId':_0x547177[_0x39bab9(0x175)],'merchantUrl':_0x547177[_0x39bab9(0x1b2)],'gateways':_0x547177[_0x39bab9(0x14f)]?JSON['parse'](_0x547177[_0x39bab9(0x14f)]):null,'gatewaySettings':_0x547177[_0x39bab9(0xef)]?JSON[_0x39bab9(0x1a6)](_0x547177['gatewaySettings']):null,'publicKey':_0x547177[_0x39bab9(0x187)],'wallets':{'usdtPolygonWallet':_0x547177['usdtPolygonWallet'],'usdtTrcWallet':_0x547177[_0x39bab9(0x19c)],'usdtErcWallet':_0x547177[_0x39bab9(0xb2)],'usdcPolygonWallet':_0x547177[_0x39bab9(0x186)]},'status':_0x547177[_0x39bab9(0xb0)],'createdAt':_0x547177[_0x39bab9(0x131)]};}async[a36_0x286081(0x177)](_0x3d29b0){const _0x572a6c=a36_0x286081,{page:_0x160c60,limit:_0x325fcc,status:_0x39b2ed}=_0x3d29b0,_0x5645fb=(_0x160c60-0x1)*_0x325fcc,_0x245d89={};_0x39b2ed&&(_0x245d89[_0x572a6c(0xb0)]=_0x39b2ed[_0x572a6c(0x159)]());const [_0x2c0de7,_0x5e5d9b]=await Promise[_0x572a6c(0x1c5)]([database_1[_0x572a6c(0x19b)][_0x572a6c(0x197)][_0x572a6c(0x1db)]({'where':_0x245d89,'skip':_0x5645fb,'take':_0x325fcc,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x572a6c(0x19b)][_0x572a6c(0x197)][_0x572a6c(0x124)]({'where':_0x245d89})]);return{'users':_0x2c0de7['map'](_0x8eb458=>{const _0xab41ba=_0x572a6c,_0x444d2c=_0x8eb458[_0xab41ba(0x14f)]?JSON[_0xab41ba(0x1a6)](_0x8eb458[_0xab41ba(0x14f)]):null,_0x4631fc=_0x444d2c?_0x444d2c[_0xab41ba(0x16f)](_0x54febc=>this['getGatewayDisplayName'](_0x54febc)):null;return{'id':_0x8eb458['id'],'fullName':_0x8eb458[_0xab41ba(0x1d2)],'username':_0x8eb458[_0xab41ba(0x101)],'telegramId':_0x8eb458[_0xab41ba(0x175)],'merchantUrl':_0x8eb458[_0xab41ba(0x1b2)],'gateways':_0x4631fc,'gatewaySettings':_0x8eb458['gatewaySettings']?JSON[_0xab41ba(0x1a6)](_0x8eb458[_0xab41ba(0xef)]):null,'publicKey':_0x8eb458['publicKey'],'wallets':{'usdtPolygonWallet':_0x8eb458[_0xab41ba(0x1bf)],'usdtTrcWallet':_0x8eb458[_0xab41ba(0x19c)],'usdtErcWallet':_0x8eb458[_0xab41ba(0xb2)],'usdcPolygonWallet':_0x8eb458[_0xab41ba(0x186)]},'status':_0x8eb458[_0xab41ba(0xb0)],'createdAt':_0x8eb458[_0xab41ba(0x131)]};}),'pagination':{'page':_0x160c60,'limit':_0x325fcc,'total':_0x5e5d9b,'totalPages':Math[_0x572a6c(0xdb)](_0x5e5d9b/_0x325fcc)}};}async[a36_0x286081(0xe5)](_0x227c42){const _0x4fa9e0=a36_0x286081,_0x1302b3=await database_1['default'][_0x4fa9e0(0x197)][_0x4fa9e0(0xf5)]({'where':{'id':_0x227c42},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1302b3)return null;const _0x5a9226=_0x1302b3[_0x4fa9e0(0x14f)]?JSON[_0x4fa9e0(0x1a6)](_0x1302b3[_0x4fa9e0(0x14f)]):null,_0x3105d1=_0x5a9226?_0x5a9226[_0x4fa9e0(0x16f)](_0xe7079=>this[_0x4fa9e0(0x1b3)](_0xe7079)):null;return _0x5a9226&&_0x3105d1&&console['log'](_0x4fa9e0(0x183),_0x5a9226,'->',_0x3105d1),{'id':_0x1302b3['id'],'fullName':_0x1302b3[_0x4fa9e0(0x1d2)],'username':_0x1302b3[_0x4fa9e0(0x101)],'telegramId':_0x1302b3[_0x4fa9e0(0x175)],'merchantUrl':_0x1302b3[_0x4fa9e0(0x1b2)],'gateways':_0x3105d1,'gatewaySettings':_0x1302b3[_0x4fa9e0(0xef)]?JSON[_0x4fa9e0(0x1a6)](_0x1302b3[_0x4fa9e0(0xef)]):null,'publicKey':_0x1302b3[_0x4fa9e0(0x187)],'wallets':{'usdtPolygonWallet':_0x1302b3[_0x4fa9e0(0x1bf)],'usdtTrcWallet':_0x1302b3[_0x4fa9e0(0x19c)],'usdtErcWallet':_0x1302b3['usdtErcWallet'],'usdcPolygonWallet':_0x1302b3[_0x4fa9e0(0x186)]},'status':_0x1302b3[_0x4fa9e0(0xb0)],'createdAt':_0x1302b3['createdAt']};}async['createUser'](_0x5ae4bb){const _0x334caf=a36_0x286081,{fullName:_0x1006f0,username:_0x39eb76,password:_0x277cf7,telegramId:_0x366f95,merchantUrl:_0x3f1c06,gateways:_0xd1410e,gatewaySettings:_0x217b3b,wallets:_0x85ee10}=_0x5ae4bb,_0x41e07e=await database_1['default'][_0x334caf(0x197)]['findUnique']({'where':{'username':_0x39eb76}});if(_0x41e07e)throw new Error(_0x334caf(0x127));if(_0x366f95){const _0x4b698b=await database_1[_0x334caf(0x19b)]['shop']['findUnique']({'where':{'telegram':_0x366f95}});if(_0x4b698b)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xb01e5c=await bcryptjs_1[_0x334caf(0x19b)][_0x334caf(0x15d)](_0x277cf7,0xc),_0x38d1ae=_0x334caf(0x1b1)+crypto_1[_0x334caf(0x19b)][_0x334caf(0x1ba)](0x20)[_0x334caf(0xd7)](_0x334caf(0xf6)),_0x5d5bf0=_0x334caf(0xc1)+crypto_1[_0x334caf(0x19b)]['randomBytes'](0x20)['toString'](_0x334caf(0xf6)),_0x26250d=_0xd1410e?_0xd1410e[_0x334caf(0x16f)](_0x4b5c66=>this['getGatewayInternalName'](_0x4b5c66)):null;_0xd1410e&&_0x26250d&&console[_0x334caf(0x1b8)]('🔄\x20Gateway\x20mapping\x20(create):',_0xd1410e,'->',_0x26250d);const _0x30a350=await database_1['default'][_0x334caf(0x197)][_0x334caf(0x138)]({'data':{'name':_0x1006f0,'username':_0x39eb76,'password':_0xb01e5c,'telegram':_0x366f95,'shopUrl':_0x3f1c06,'paymentGateways':_0x26250d?JSON[_0x334caf(0x13a)](_0x26250d):null,'gatewaySettings':_0x217b3b?JSON[_0x334caf(0x13a)](_0x217b3b):null,'usdtPolygonWallet':_0x85ee10?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x85ee10?.[_0x334caf(0x19c)]||null,'usdtErcWallet':_0x85ee10?.[_0x334caf(0xb2)]||null,'usdcPolygonWallet':_0x85ee10?.[_0x334caf(0x186)]||null,'publicKey':_0x38d1ae,'secretKey':_0x5d5bf0,'status':_0x334caf(0x1c3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x30a350['id'],'fullName':_0x30a350[_0x334caf(0x1d2)],'username':_0x30a350[_0x334caf(0x101)],'telegramId':_0x30a350[_0x334caf(0x175)],'merchantUrl':_0x30a350[_0x334caf(0x1b2)],'gateways':_0x30a350[_0x334caf(0x14f)]?JSON[_0x334caf(0x1a6)](_0x30a350[_0x334caf(0x14f)]):null,'gatewaySettings':_0x30a350[_0x334caf(0xef)]?JSON[_0x334caf(0x1a6)](_0x30a350[_0x334caf(0xef)]):null,'publicKey':_0x30a350[_0x334caf(0x187)],'wallets':{'usdtPolygonWallet':_0x30a350[_0x334caf(0x1bf)],'usdtTrcWallet':_0x30a350[_0x334caf(0x19c)],'usdtErcWallet':_0x30a350[_0x334caf(0xb2)],'usdcPolygonWallet':_0x30a350['usdcPolygonWallet']},'status':_0x30a350['status'],'createdAt':_0x30a350[_0x334caf(0x131)]};}async[a36_0x286081(0x1ca)](_0x30d868){const _0x53d79f=a36_0x286081;await database_1[_0x53d79f(0x19b)][_0x53d79f(0x197)]['delete']({'where':{'id':_0x30d868}});}[a36_0x286081(0x12c)](_0x197356,_0x18f2dc,_0x2ace80){const _0x1dc86f=a36_0x286081,_0x316dc8=new Map(),_0x5486fe=new Date(_0x18f2dc);while(_0x5486fe<=_0x2ace80){const _0x186f12=_0x5486fe[_0x1dc86f(0x110)]()[_0x1dc86f(0x1ae)]('T')[0x0];_0x316dc8[_0x1dc86f(0x1b0)](_0x186f12,{'revenue':0x0,'count':0x0}),_0x5486fe[_0x1dc86f(0x199)](_0x5486fe[_0x1dc86f(0x1e4)]()+0x1);}for(const _0xe1566d of _0x197356){const _0x24459d=_0xe1566d[_0x1dc86f(0x131)]['toISOString']()[_0x1dc86f(0x1ae)]('T')[0x0],_0x496735=_0x316dc8[_0x1dc86f(0xad)](_0x24459d);_0x496735&&(_0x496735[_0x1dc86f(0x124)]+=0x1,_0xe1566d[_0x1dc86f(0xb0)]===_0x1dc86f(0xe8)&&(_0xe1566d[_0x1dc86f(0xe7)]?_0x496735[_0x1dc86f(0x19d)]+=_0xe1566d[_0x1dc86f(0xe7)]:console[_0x1dc86f(0x1b8)]('⚠️\x20Payment\x20'+_0xe1566d['id']+_0x1dc86f(0xe3))));}const _0x4cdb63=[],_0x3051d3=[];for(const [_0x55a7d7,_0x50aa29]of _0x316dc8){_0x4cdb63[_0x1dc86f(0x191)]({'date':_0x55a7d7,'amount':Math['round'](_0x50aa29['revenue']*0x64)/0x64}),_0x3051d3['push']({'date':_0x55a7d7,'count':_0x50aa29[_0x1dc86f(0x124)]});}return{'dailyRevenue':_0x4cdb63,'dailyPayments':_0x3051d3};}}function a36_0x26a9(_0x55ec8d,_0x1cd2cb){const _0x20ea98=a36_0x20ea();return a36_0x26a9=function(_0x26a935,_0x2b6300){_0x26a935=_0x26a935-0xaa;let _0x14e482=_0x20ea98[_0x26a935];return _0x14e482;},a36_0x26a9(_0x55ec8d,_0x1cd2cb);}exports[a36_0x286081(0x14c)]=AdminService;