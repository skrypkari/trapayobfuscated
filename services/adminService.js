'use strict';function a33_0x2eb7(_0x1eef19,_0x5ed6e3){const _0x40c312=a33_0x40c3();return a33_0x2eb7=function(_0x2eb751,_0x237575){_0x2eb751=_0x2eb751-0x116;let _0x1da820=_0x40c312[_0x2eb751];return _0x1da820;},a33_0x2eb7(_0x1eef19,_0x5ed6e3);}const a33_0x3ecc27=a33_0x2eb7;(function(_0x380b64,_0x2b0583){const _0x243650=a33_0x2eb7,_0x1e1b42=_0x380b64();while(!![]){try{const _0x2e7e3b=-parseInt(_0x243650(0x1ef))/0x1+parseInt(_0x243650(0x1eb))/0x2+-parseInt(_0x243650(0x17e))/0x3+parseInt(_0x243650(0x177))/0x4*(parseInt(_0x243650(0x1b3))/0x5)+-parseInt(_0x243650(0x1bd))/0x6*(parseInt(_0x243650(0x184))/0x7)+-parseInt(_0x243650(0x143))/0x8+parseInt(_0x243650(0x129))/0x9;if(_0x2e7e3b===_0x2b0583)break;else _0x1e1b42['push'](_0x1e1b42['shift']());}catch(_0xb421d0){_0x1e1b42['push'](_0x1e1b42['shift']());}}}(a33_0x40c3,0x25898));var __importDefault=this&&this[a33_0x3ecc27(0x122)]||function(_0x1c7158){return _0x1c7158&&_0x1c7158['__esModule']?_0x1c7158:{'default':_0x1c7158};};function a33_0x40c3(){const _0x3e44f4=['912771rzDANf','\x20status\x20updated\x20from\x20','lte','toLowerCase','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','getSystemStatistics','UserService','📊\x20Found\x20','getGatewaySettings','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','\x20suspended\x20successfully','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','getMonth','webhookLog','bankId',',\x20amount:\x20','currencyService','💳\x20Total\x20payments:\x20','usdtTrcWallet','thisMonth','\x20merchants\x20out\x20of\x20','desc','⏳\x20Awaiting\x20Payout:\x20','error','\x20activated\x20successfully','824904QlYqAv','updatedAt','paymentMethod','shop','Shop\x20not\x20found','sort','customerEmail','./userService','✅\x20Activating\x20user:\x20','\x20payouts\x20out\x20of\x20','getAllUsers','\x20days)','reduce','txid','✅\x20Returning\x20','✅\x20Payout\x20statistics\x20calculated:','🏪\x20Found\x20','amountUSDT','\x20merchants\x20with\x20eligible\x20PAID\x20payments','log','\x20to\x20','calculateEffectiveAmount','telegram','statusChangedAt','stringify','createPayout','getDate','AdminService','amount','📈\x20Average\x20payment:\x20','payments','sourceCurrency','deletePayout','User\x20not\x20found','gatewayPaymentId','📊\x20Daily\x20revenue\x20entries:\x20','setDate','toUpperCase','ACTIVE','set','usage','generateDateRange','\x20days','defineProperty','updatePaymentStatus','📅\x20This\x20Month:\x20','adminNotes','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','round','deleteUser','convertToUSDT','__esModule','129164rNKkGg','get','getFullYear','webhookLogs','SUSPENDED','charAt','✅\x20Payment\x20','353862PWPQep','✅\x20Admin\x20statistics\x20generated\x20successfully','🚫\x20Suspending\x20user:\x20','\x20USDT\x20after\x20commission)','REFUND','publicKey','11711uHljMk','🗑️\x20Deleting\x20payout:\x20','gte','payout','✅\x20Found\x20payment:\x20','payment','\x20USDT\x20via\x20','getUserById','totalAmountAfterCommissionUSDT','\x20users\x20out\x20of\x20','has','availableBalance','count','notes','usdtPolygonWallet','remitterName','💰\x20Total\x20amount:\x20','Error\x20parsing\x20gateway\x20settings:','gateway','orderId','getAllPayouts','getPayoutStats','createUser','💸\x20Chargeback\x20penalty:\x20','\x20status\x20to:\x20','\x20USDT\x20(включая\x20штрафы\x20chargeback)','userService','PAID','parse','all','\x20USDT','usdcPolygonWallet','asc','findUnique','status_update','\x20USDT\x20(penalty\x20amount)','chargebackAmount','gatewaySettings','shopId','slice','from','ceil','PROCESSING','push','completed','payoutDelay','💰\x20Found\x20','30JGjNwI','activateUser','toISOString','awaitingPayout','network','customerName','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','COMPLETED','commission','🔍\x20Getting\x20payment\x20by\x20ID:\x20','102lhNHzc','usdtErcWallet','✅\x20User\x20','remitterIban','status','username','abs','\x20total','getPaymentById','❌\x20Payout\x20not\x20found:\x20','split','../types/gateway','isEligibleForPayout','size','currency','Payout\x20not\x20found','entries','suspendUser','gatewayOrderId','✅\x20Payout\x20','User\x20is\x20already\x20suspended','./currencyService','merchantPaid','Invalid\x20status.\x20Valid\x20statuses:\x20','expiresAt','amountAfterCommissionUSDT','📅\x20Processing\x20daily\x20stats\x20for\x20','calculateAmountAfterCommission','updateMany','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','../config/database','getAllPayments','📋\x20Getting\x20payouts\x20with\x20filters:','🔄\x20Updating\x20payment\x20','getPeriodDays','paymentGateways','toFixed','date','findMany','Payment\x20not\x20found','length','💸\x20Chargeback\x20amount:\x20','updateUser','📋\x20Getting\x20payments\x20with\x20filters:','telegramBotService','cardLast4','350476ijzhxm','name','externalPaymentUrl','create','67143akDNBp','🔍\x20Getting\x20payout\x20by\x20ID:\x20','statusChangedBy','paidAt','insensitive','getTime','default','CHARGEBACK','createdAt','shopUrl','join','includes','📊\x20Calculating\x20admin\x20payout\x20statistics...','__importDefault','update','markPaymentsAsPaidOut','./telegramBotService','\x20payments\x20as\x20paid\x20out','map','PENDING'];a33_0x40c3=function(){return _0x3e44f4;};return a33_0x40c3();}Object[a33_0x3ecc27(0x16e)](exports,a33_0x3ecc27(0x176),{'value':!![]}),exports[a33_0x3ecc27(0x15e)]=void 0x0;const database_1=__importDefault(require(a33_0x3ecc27(0x1db))),currencyService_1=require(a33_0x3ecc27(0x1d2)),userService_1=require(a33_0x3ecc27(0x14a)),telegramBotService_1=require(a33_0x3ecc27(0x125)),gateway_1=require(a33_0x3ecc27(0x1c8));class AdminService{constructor(){const _0x33e4ed=a33_0x3ecc27;this[_0x33e4ed(0x19e)]=new userService_1[(_0x33e4ed(0x12f))]();}[a33_0x3ecc27(0x1df)](_0x1446a1){switch(_0x1446a1){case'7d':return 0x7;case'30d':return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}['generateDateRange'](_0x3eea83,_0x4ab851){const _0x26bd3b=a33_0x3ecc27,_0x3d224c=[],_0x154237=new Date(_0x3eea83);while(_0x154237<=_0x4ab851){_0x3d224c[_0x26bd3b(0x1af)](_0x154237[_0x26bd3b(0x1b5)]()[_0x26bd3b(0x1c7)]('T')[0x0]),_0x154237[_0x26bd3b(0x167)](_0x154237[_0x26bd3b(0x15d)]()+0x1);}return _0x3d224c;}['getGatewaySettings'](_0x7e381b,_0x186f3e){const _0x563c73=a33_0x3ecc27;if(!_0x7e381b['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x12d082=JSON['parse'](_0x7e381b[_0x563c73(0x1a9)]),_0x49080e=_0x186f3e['charAt'](0x0)[_0x563c73(0x168)]()+_0x186f3e[_0x563c73(0x1ab)](0x1)[_0x563c73(0x12c)]();if(_0x12d082&&_0x12d082[_0x49080e])return{'commission':_0x12d082[_0x49080e][_0x563c73(0x1bb)]||0x0,'payoutDelay':_0x12d082[_0x49080e][_0x563c73(0x1b1)]||0x0};}catch(_0x39f6ac){console['error'](_0x563c73(0x195),_0x39f6ac);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x3ecc27(0x1c9)](_0x31bf76){const _0x4c918c=a33_0x3ecc27;if(_0x31bf76[_0x4c918c(0x1c1)]!==_0x4c918c(0x19f)||_0x31bf76[_0x4c918c(0x1d3)]||!_0x31bf76[_0x4c918c(0x118)])return![];const _0x44066b=this[_0x4c918c(0x131)](_0x31bf76[_0x4c918c(0x146)],_0x31bf76['gateway']),_0x433c27=_0x44066b[_0x4c918c(0x1b1)]*0x18*0x3c*0x3c*0x3e8,_0x3007ff=new Date(_0x31bf76['paidAt'][_0x4c918c(0x11a)]()+_0x433c27);return new Date()>_0x3007ff;}[a33_0x3ecc27(0x1d8)](_0x1d5a91,_0xe01e60){return _0x1d5a91*(0x1-_0xe01e60/0x64);}[a33_0x3ecc27(0x158)](_0x2738bf){const _0x3a41d9=a33_0x3ecc27;switch(_0x2738bf['status']){case _0x3a41d9(0x19f):return _0x2738bf[_0x3a41d9(0x15f)];case'CHARGEBACK':return-(_0x2738bf[_0x3a41d9(0x1a8)]||0x0);case _0x3a41d9(0x182):return 0x0;default:return 0x0;}}async[a33_0x3ecc27(0x15c)](_0x2b1bd5){const _0x2abeaa=a33_0x3ecc27,{shopId:_0xfc175e,amount:_0x1f1181,network:_0x367f7b,notes:_0x56efde}=_0x2b1bd5;console[_0x2abeaa(0x156)]('💸\x20Creating\x20payout\x20for\x20shop\x20'+_0xfc175e+':\x20'+_0x1f1181+_0x2abeaa(0x18a)+_0x367f7b);const _0x1d3a1a=await database_1[_0x2abeaa(0x11b)][_0x2abeaa(0x146)][_0x2abeaa(0x1a5)]({'where':{'id':_0xfc175e},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x1d3a1a)throw new Error(_0x2abeaa(0x147));if(_0x1d3a1a[_0x2abeaa(0x1c1)]!==_0x2abeaa(0x169))throw new Error('Shop\x20is\x20not\x20active');const _0x4bba46=await database_1[_0x2abeaa(0x11b)][_0x2abeaa(0x187)][_0x2abeaa(0x1ee)]({'data':{'shopId':_0xfc175e,'amount':_0x1f1181,'network':_0x367f7b,'status':_0x2abeaa(0x1ba),'notes':_0x56efde||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x2abeaa(0x124)](_0xfc175e,_0x1f1181);try{await telegramBotService_1[_0x2abeaa(0x1e9)]['sendPayoutNotification'](_0xfc175e,_0x4bba46,_0x2abeaa(0x1b0));}catch(_0x1d2f4d){console[_0x2abeaa(0x141)](_0x2abeaa(0x132),_0x1d2f4d);}return console[_0x2abeaa(0x156)]('✅\x20Payout\x20created\x20successfully:\x20'+_0x4bba46['id']),{'id':_0x4bba46['id'],'shopId':_0x4bba46[_0x2abeaa(0x1aa)],'shopName':_0x4bba46['shop'][_0x2abeaa(0x1ec)],'shopUsername':_0x4bba46['shop'][_0x2abeaa(0x1c2)],'amount':_0x4bba46[_0x2abeaa(0x15f)],'network':_0x4bba46[_0x2abeaa(0x1b7)],'status':_0x4bba46[_0x2abeaa(0x1c1)],'txid':_0x4bba46[_0x2abeaa(0x150)],'notes':_0x4bba46[_0x2abeaa(0x191)],'createdAt':_0x4bba46[_0x2abeaa(0x11d)],'paidAt':_0x4bba46[_0x2abeaa(0x118)]};}async[a33_0x3ecc27(0x124)](_0x1a61ba,_0x439cb7){const _0x42cf80=a33_0x3ecc27;console[_0x42cf80(0x156)](_0x42cf80(0x172)+_0x1a61ba+_0x42cf80(0x139)+_0x439cb7+'\x20USDT');const _0x2140a4=await database_1[_0x42cf80(0x11b)]['payment'][_0x42cf80(0x1e3)]({'where':{'shopId':_0x1a61ba,'status':_0x42cf80(0x19f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x42cf80(0x1a4)}});let _0x53aff6=_0x439cb7;const _0x55c97b=[];for(const _0x7e2f80 of _0x2140a4){const _0xab0b27={..._0x7e2f80,'status':_0x42cf80(0x19f),'merchantPaid':![],'shop':{'gatewaySettings':_0x7e2f80[_0x42cf80(0x146)][_0x42cf80(0x1a9)]}};if(!this[_0x42cf80(0x1c9)](_0xab0b27))continue;const _0x56f09f=await currencyService_1[_0x42cf80(0x13a)][_0x42cf80(0x175)](_0x7e2f80[_0x42cf80(0x15f)],_0x7e2f80[_0x42cf80(0x1cb)]),_0x411410=this[_0x42cf80(0x131)](_0x7e2f80[_0x42cf80(0x146)],_0x7e2f80[_0x42cf80(0x196)]),_0x3fc0d8=this['calculateAmountAfterCommission'](_0x56f09f,_0x411410['commission']);if(_0x3fc0d8<=_0x53aff6){_0x55c97b['push'](_0x7e2f80['id']),_0x53aff6-=_0x3fc0d8;if(_0x53aff6<=0.01)break;}}_0x55c97b['length']>0x0&&(await database_1['default'][_0x42cf80(0x189)][_0x42cf80(0x1d9)]({'where':{'id':{'in':_0x55c97b}},'data':{'merchantPaid':!![]}}),console[_0x42cf80(0x156)]('✅\x20Marked\x20'+_0x55c97b[_0x42cf80(0x1e5)]+_0x42cf80(0x126)));}async[a33_0x3ecc27(0x198)](_0x451270){const _0x34962e=a33_0x3ecc27,{page:_0x80dbf5,limit:_0x3371c5,shopId:_0x300e50,network:_0x5d2181,dateFrom:_0x2c87b1,dateTo:_0x50e66d,search:_0xe05bc4}=_0x451270,_0x17ddca=(_0x80dbf5-0x1)*_0x3371c5;console[_0x34962e(0x156)](_0x34962e(0x1dd),_0x451270);const _0x47e48d={};_0x300e50&&(_0x47e48d[_0x34962e(0x1aa)]=_0x300e50);_0x5d2181&&(_0x47e48d[_0x34962e(0x1b7)]=_0x5d2181);(_0x2c87b1||_0x50e66d)&&(_0x47e48d[_0x34962e(0x11d)]={},_0x2c87b1&&(_0x47e48d[_0x34962e(0x11d)][_0x34962e(0x186)]=new Date(_0x2c87b1)),_0x50e66d&&(_0x47e48d[_0x34962e(0x11d)][_0x34962e(0x12b)]=new Date(_0x50e66d)));_0xe05bc4&&(_0x47e48d['OR']=[{'txid':{'contains':_0xe05bc4,'mode':_0x34962e(0x119)}},{'notes':{'contains':_0xe05bc4,'mode':_0x34962e(0x119)}},{'shop':{'name':{'contains':_0xe05bc4,'mode':_0x34962e(0x119)}}},{'shop':{'username':{'contains':_0xe05bc4,'mode':_0x34962e(0x119)}}}]);const [_0x5cf1a7,_0x19dc87]=await Promise[_0x34962e(0x1a1)]([database_1[_0x34962e(0x11b)]['payout'][_0x34962e(0x1e3)]({'where':_0x47e48d,'skip':_0x17ddca,'take':_0x3371c5,'orderBy':{'createdAt':_0x34962e(0x13f)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x34962e(0x11b)][_0x34962e(0x187)][_0x34962e(0x190)]({'where':_0x47e48d})]);console[_0x34962e(0x156)](_0x34962e(0x130)+_0x5cf1a7[_0x34962e(0x1e5)]+_0x34962e(0x14c)+_0x19dc87+_0x34962e(0x1c4));const _0x4c523c=_0x5cf1a7[_0x34962e(0x127)](_0x4af407=>({'id':_0x4af407['id'],'shopId':_0x4af407['shopId'],'shopName':_0x4af407[_0x34962e(0x146)]['name'],'shopUsername':_0x4af407[_0x34962e(0x146)][_0x34962e(0x1c2)],'amount':_0x4af407[_0x34962e(0x15f)],'network':_0x4af407['network'],'status':_0x4af407[_0x34962e(0x1c1)],'txid':_0x4af407['txid'],'notes':_0x4af407['notes'],'createdAt':_0x4af407[_0x34962e(0x11d)],'paidAt':_0x4af407[_0x34962e(0x118)]}));return{'payouts':_0x4c523c,'pagination':{'page':_0x80dbf5,'limit':_0x3371c5,'total':_0x19dc87,'totalPages':Math[_0x34962e(0x1ad)](_0x19dc87/_0x3371c5)}};}async['getPayoutById'](_0x47ca0d){const _0x1d5355=a33_0x3ecc27;console['log'](_0x1d5355(0x116)+_0x47ca0d);const _0x73280c=await database_1[_0x1d5355(0x11b)][_0x1d5355(0x187)][_0x1d5355(0x1a5)]({'where':{'id':_0x47ca0d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x73280c)return console[_0x1d5355(0x156)](_0x1d5355(0x1c6)+_0x47ca0d),null;return console[_0x1d5355(0x156)]('✅\x20Found\x20payout:\x20'+_0x73280c[_0x1d5355(0x15f)]+'\x20USDT\x20via\x20'+_0x73280c[_0x1d5355(0x1b7)]),{'id':_0x73280c['id'],'shopId':_0x73280c[_0x1d5355(0x1aa)],'shopName':_0x73280c[_0x1d5355(0x146)][_0x1d5355(0x1ec)],'shopUsername':_0x73280c[_0x1d5355(0x146)]['username'],'amount':_0x73280c[_0x1d5355(0x15f)],'network':_0x73280c[_0x1d5355(0x1b7)],'status':_0x73280c[_0x1d5355(0x1c1)],'txid':_0x73280c['txid'],'notes':_0x73280c['notes'],'createdAt':_0x73280c[_0x1d5355(0x11d)],'paidAt':_0x73280c['paidAt']};}async[a33_0x3ecc27(0x163)](_0x44e31a){const _0x4dea0d=a33_0x3ecc27;console[_0x4dea0d(0x156)](_0x4dea0d(0x185)+_0x44e31a);const _0x485b61=await database_1[_0x4dea0d(0x11b)][_0x4dea0d(0x187)][_0x4dea0d(0x1a5)]({'where':{'id':_0x44e31a},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x485b61)throw new Error(_0x4dea0d(0x1cc));await database_1[_0x4dea0d(0x11b)][_0x4dea0d(0x187)]['delete']({'where':{'id':_0x44e31a}}),console[_0x4dea0d(0x156)](_0x4dea0d(0x1d0)+_0x44e31a+'\x20deleted\x20successfully');}async['getMerchantsAwaitingPayout'](_0x57dad1){const _0xa06385=a33_0x3ecc27,{page:_0x446428,limit:_0x4dc17d,minAmount:_0x11a4b7,search:_0x3606fc}=_0x57dad1;console['log'](_0xa06385(0x134),_0x57dad1);const _0x406ff5=await database_1[_0xa06385(0x11b)][_0xa06385(0x189)][_0xa06385(0x1e3)]({'where':{'status':_0xa06385(0x19f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0xa06385(0x156)](_0xa06385(0x1b2)+_0x406ff5[_0xa06385(0x1e5)]+_0xa06385(0x1b9));const _0x1a908c=new Map();for(const _0x3302b9 of _0x406ff5){const _0x57e9d7={..._0x3302b9,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0x3302b9[_0xa06385(0x146)]['gatewaySettings']}},_0xe66f1d=this['isEligibleForPayout'](_0x57e9d7);if(!_0xe66f1d)continue;const _0x1f3bac=await currencyService_1[_0xa06385(0x13a)][_0xa06385(0x175)](_0x3302b9['amount'],_0x3302b9['currency']),_0x3658e5=this[_0xa06385(0x131)](_0x3302b9['shop'],_0x3302b9[_0xa06385(0x196)]),_0x3403ac=this[_0xa06385(0x1d8)](_0x1f3bac,_0x3658e5['commission']),_0x51c945=_0x3302b9[_0xa06385(0x1aa)];!_0x1a908c[_0xa06385(0x18e)](_0x51c945)&&_0x1a908c[_0xa06385(0x16a)](_0x51c945,{'shop':_0x3302b9[_0xa06385(0x146)],'payments':[]}),_0x1a908c[_0xa06385(0x178)](_0x51c945)[_0xa06385(0x161)][_0xa06385(0x1af)]({'id':_0x3302b9['id'],'amount':_0x3302b9[_0xa06385(0x15f)],'currency':_0x3302b9[_0xa06385(0x1cb)],'gateway':_0x3302b9[_0xa06385(0x196)],'paidAt':_0x3302b9[_0xa06385(0x118)],'createdAt':_0x3302b9['createdAt'],'amountUSDT':_0x1f3bac,'commission':_0x3658e5[_0xa06385(0x1bb)],'amountAfterCommissionUSDT':_0x3403ac,'isEligible':!![]});}console[_0xa06385(0x156)](_0xa06385(0x153)+_0x1a908c[_0xa06385(0x1ca)]+_0xa06385(0x155));const _0x40a1d7=[];for(const [_0x246a94,_0x30911e]of _0x1a908c){const {shop:_0x57cc81,payments:_0x1c2d91}=_0x30911e,_0x165923=_0x1c2d91[_0xa06385(0x14f)]((_0x32645c,_0x242458)=>_0x32645c+_0x242458[_0xa06385(0x154)],0x0),_0x7f22b2=_0x1c2d91[_0xa06385(0x14f)]((_0x2e5120,_0x34465c)=>_0x2e5120+_0x34465c[_0xa06385(0x1d6)],0x0);if(_0x11a4b7&&_0x7f22b2<_0x11a4b7)continue;if(_0x3606fc){const _0x595fb1=_0x3606fc[_0xa06385(0x12c)](),_0x32d982=_0x57cc81[_0xa06385(0x1ec)]['toLowerCase']()[_0xa06385(0x120)](_0x595fb1)||_0x57cc81[_0xa06385(0x1c2)][_0xa06385(0x12c)]()[_0xa06385(0x120)](_0x595fb1)||_0x57cc81[_0xa06385(0x159)]&&_0x57cc81['telegram'][_0xa06385(0x12c)]()[_0xa06385(0x120)](_0x595fb1);if(!_0x32d982)continue;}const _0x143e11=new Map();for(const _0x2b0fe9 of _0x1c2d91){const _0x432b4a=_0x2b0fe9['gateway'];!_0x143e11[_0xa06385(0x18e)](_0x432b4a)&&_0x143e11[_0xa06385(0x16a)](_0x432b4a,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x2b0fe9[_0xa06385(0x1bb)]});const _0x47ba6f=_0x143e11['get'](_0x432b4a);_0x47ba6f[_0xa06385(0x190)]++,_0x47ba6f[_0xa06385(0x154)]+=_0x2b0fe9[_0xa06385(0x154)],_0x47ba6f[_0xa06385(0x1d6)]+=_0x2b0fe9[_0xa06385(0x1d6)];}const _0x201662=Array[_0xa06385(0x1ac)](_0x143e11[_0xa06385(0x1cd)]())[_0xa06385(0x127)](([_0x5c6f18,_0x255bde])=>({'gateway':_0x5c6f18[_0xa06385(0x17c)](0x0)['toUpperCase']()+_0x5c6f18[_0xa06385(0x1ab)](0x1),'count':_0x255bde[_0xa06385(0x190)],'amountUSDT':Math[_0xa06385(0x173)](_0x255bde['amountUSDT']*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0xa06385(0x173)](_0x255bde['amountAfterCommissionUSDT']*0x64)/0x64,'commission':_0x255bde[_0xa06385(0x1bb)]})),_0x328c0f=_0x1c2d91['reduce']((_0x5e6fa2,_0x362124)=>{const _0x493a7b=_0xa06385;return _0x362124[_0x493a7b(0x118)]<_0x5e6fa2?_0x362124['paidAt']:_0x5e6fa2;},_0x1c2d91[0x0]['paidAt']);_0x40a1d7[_0xa06385(0x1af)]({'id':_0x57cc81['id'],'fullName':_0x57cc81['name'],'username':_0x57cc81['username'],'telegramId':_0x57cc81[_0xa06385(0x159)],'merchantUrl':_0x57cc81[_0xa06385(0x11e)],'wallets':{'usdtPolygonWallet':_0x57cc81['usdtPolygonWallet'],'usdtTrcWallet':_0x57cc81[_0xa06385(0x13c)],'usdtErcWallet':_0x57cc81[_0xa06385(0x1be)],'usdcPolygonWallet':_0x57cc81[_0xa06385(0x1a3)]},'totalAmountUSDT':Math[_0xa06385(0x173)](_0x165923*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xa06385(0x173)](_0x7f22b2*0x64)/0x64,'paymentsCount':_0x1c2d91[_0xa06385(0x1e5)],'oldestPaymentDate':_0x328c0f,'gatewayBreakdown':_0x201662});}_0x40a1d7[_0xa06385(0x148)]((_0x47d0d3,_0x38bab2)=>_0x38bab2[_0xa06385(0x18c)]-_0x47d0d3[_0xa06385(0x18c)]);const _0x3f3bef=_0x40a1d7['length'],_0x5d9fcb=_0x40a1d7[_0xa06385(0x14f)]((_0x90c8d6,_0x1c0155)=>_0x90c8d6+_0x1c0155['totalAmountUSDT'],0x0),_0x48dd50=_0x40a1d7[_0xa06385(0x14f)]((_0x39e949,_0x26b2d3)=>_0x39e949+_0x26b2d3[_0xa06385(0x18c)],0x0),_0x196eb7=(_0x446428-0x1)*_0x4dc17d,_0xe362be=_0x40a1d7[_0xa06385(0x1ab)](_0x196eb7,_0x196eb7+_0x4dc17d);return console[_0xa06385(0x156)](_0xa06385(0x151)+_0xe362be[_0xa06385(0x1e5)]+_0xa06385(0x13e)+_0x3f3bef+_0xa06385(0x1c4)),console[_0xa06385(0x156)](_0xa06385(0x194)+_0x5d9fcb[_0xa06385(0x1e1)](0x2)+'\x20USDT\x20('+_0x48dd50['toFixed'](0x2)+_0xa06385(0x181)),{'merchants':_0xe362be,'pagination':{'page':_0x446428,'limit':_0x4dc17d,'total':_0x3f3bef,'totalPages':Math[_0xa06385(0x1ad)](_0x3f3bef/_0x4dc17d)},'summary':{'totalMerchants':_0x3f3bef,'totalAmountUSDT':Math[_0xa06385(0x173)](_0x5d9fcb*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xa06385(0x173)](_0x48dd50*0x64)/0x64}};}async[a33_0x3ecc27(0x199)](){const _0x40e2ae=a33_0x3ecc27;console['log'](_0x40e2ae(0x121));const _0x1e9d38=await database_1[_0x40e2ae(0x11b)]['payment'][_0x40e2ae(0x1e3)]({'where':{'status':{'in':[_0x40e2ae(0x19f),_0x40e2ae(0x182),_0x40e2ae(0x11c)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x40e2ae(0x156)](_0x40e2ae(0x1b2)+_0x1e9d38['length']+_0x40e2ae(0x135));const _0x498925=new Date(),_0x4ac6cf=new Date(_0x498925[_0x40e2ae(0x179)](),_0x498925[_0x40e2ae(0x136)](),0x1),_0x4f6ef5=new Date(_0x498925[_0x40e2ae(0x179)](),_0x498925[_0x40e2ae(0x136)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x2a4e91=0x0,_0x409b80=0x0,_0x320b0c=0x0,_0x2f7b38=0x0;for(const _0x15b150 of _0x1e9d38){const _0x45f4f7=this[_0x40e2ae(0x158)](_0x15b150);if(_0x45f4f7===0x0)continue;let _0x58fc6c,_0x1196fe;if(_0x15b150[_0x40e2ae(0x1c1)]==='CHARGEBACK')_0x58fc6c=Math[_0x40e2ae(0x1c3)](_0x45f4f7),_0x1196fe=-_0x58fc6c;else{_0x58fc6c=await currencyService_1[_0x40e2ae(0x13a)][_0x40e2ae(0x175)](_0x15b150[_0x40e2ae(0x15f)],_0x15b150[_0x40e2ae(0x1cb)]);const _0x110a86=this['getGatewaySettings'](_0x15b150[_0x40e2ae(0x146)],_0x15b150[_0x40e2ae(0x196)]);_0x1196fe=this[_0x40e2ae(0x1d8)](_0x58fc6c,_0x110a86[_0x40e2ae(0x1bb)]);}_0x15b150[_0x40e2ae(0x1d3)]&&(_0x2a4e91+=_0x1196fe,_0x15b150[_0x40e2ae(0x118)]&&_0x15b150['paidAt']>=_0x4ac6cf&&_0x15b150[_0x40e2ae(0x118)]<=_0x4f6ef5&&(_0x320b0c+=_0x1196fe)),_0x15b150[_0x40e2ae(0x1c1)]===_0x40e2ae(0x19f)&&this['isEligibleForPayout'](_0x15b150)&&(_0x409b80+=_0x1196fe,_0x2f7b38+=_0x58fc6c);}const _0x4c22b8={'totalPayout':Math['round'](_0x2a4e91*0x64)/0x64,'awaitingPayout':Math[_0x40e2ae(0x173)](_0x409b80*0x64)/0x64,'thisMonth':Math[_0x40e2ae(0x173)](_0x320b0c*0x64)/0x64,'availableBalance':Math[_0x40e2ae(0x173)](_0x2f7b38*0x64)/0x64};return console['log'](_0x40e2ae(0x152)),console['log']('💸\x20Total\x20Payout:\x20'+_0x4c22b8['totalPayout']+'\x20USDT\x20(включая\x20штрафы\x20chargeback)'),console[_0x40e2ae(0x156)](_0x40e2ae(0x140)+_0x4c22b8[_0x40e2ae(0x1b6)]+'\x20USDT\x20(только\x20PAID\x20платежи)'),console[_0x40e2ae(0x156)](_0x40e2ae(0x170)+_0x4c22b8[_0x40e2ae(0x13d)]+_0x40e2ae(0x1a2)),console[_0x40e2ae(0x156)]('💰\x20Available\x20Balance:\x20'+_0x4c22b8[_0x40e2ae(0x18f)]+_0x40e2ae(0x1a2)),_0x4c22b8;}async[a33_0x3ecc27(0x12e)](_0x29e325){const _0x225be5=a33_0x3ecc27,_0x230687=this[_0x225be5(0x1df)](_0x29e325),_0x161669=new Date();_0x161669[_0x225be5(0x167)](_0x161669[_0x225be5(0x15d)]()-_0x230687),console[_0x225be5(0x156)]('📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20'+_0x29e325+'\x20('+_0x230687+_0x225be5(0x14e));const _0x4fe304=await database_1[_0x225be5(0x11b)][_0x225be5(0x146)][_0x225be5(0x190)]({'where':{'status':_0x225be5(0x169)}}),_0x1c8dbc=await database_1['default'][_0x225be5(0x189)][_0x225be5(0x190)](),_0x331af6=await database_1[_0x225be5(0x11b)][_0x225be5(0x189)][_0x225be5(0x1e3)]({'where':{'status':{'in':[_0x225be5(0x19f),_0x225be5(0x182),'CHARGEBACK']}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x225be5(0x156)](_0x225be5(0x1b2)+_0x331af6['length']+_0x225be5(0x1da));const _0x56010c=await Promise[_0x225be5(0x1a1)](_0x331af6[_0x225be5(0x127)](async _0x5a1abd=>{const _0x30159c=_0x225be5,_0x24a494=this['calculateEffectiveAmount'](_0x5a1abd);if(_0x24a494===0x0)return{'amount':0x0,'createdAt':_0x5a1abd[_0x30159c(0x11d)]};let _0x519958;return _0x5a1abd[_0x30159c(0x1c1)]===_0x30159c(0x11c)?_0x519958=-Math[_0x30159c(0x1c3)](_0x24a494):_0x519958=await currencyService_1[_0x30159c(0x13a)]['convertToUSDT'](_0x5a1abd[_0x30159c(0x15f)],_0x5a1abd[_0x30159c(0x1cb)]),{'amount':_0x519958,'createdAt':_0x5a1abd[_0x30159c(0x11d)]};})),_0x3f8431=_0x56010c[_0x225be5(0x14f)]((_0x37fa94,_0x1013ac)=>_0x37fa94+_0x1013ac[_0x225be5(0x15f)],0x0),_0x5c1e38=_0x1c8dbc>0x0?_0x3f8431/_0x1c8dbc:0x0;console['log']('💵\x20Total\x20revenue:\x20'+_0x3f8431[_0x225be5(0x1e1)](0x2)+_0x225be5(0x19d)),console[_0x225be5(0x156)](_0x225be5(0x160)+_0x5c1e38['toFixed'](0x2)+_0x225be5(0x1a2));const _0x3a8923=await database_1[_0x225be5(0x11b)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x161669}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x225be5(0x156)](_0x225be5(0x1d7)+_0x3a8923[_0x225be5(0x1e5)]+_0x225be5(0x16d));const _0x225db4=await Promise['all'](_0x3a8923['map'](async _0x3879b5=>{const _0x32df5b=_0x225be5,_0x9cca6=await Promise[_0x32df5b(0x1a1)](_0x3879b5[_0x32df5b(0x161)][_0x32df5b(0x127)](async _0x5d3662=>{const _0x3e1479=_0x32df5b,_0x280816=this[_0x3e1479(0x158)](_0x5d3662);if(_0x280816===0x0)return 0x0;return _0x5d3662[_0x3e1479(0x1c1)]===_0x3e1479(0x11c)?-Math[_0x3e1479(0x1c3)](_0x280816):await currencyService_1['currencyService'][_0x3e1479(0x175)](_0x5d3662[_0x3e1479(0x15f)],_0x5d3662[_0x3e1479(0x1cb)]);})),_0x225649=_0x9cca6[_0x32df5b(0x14f)]((_0xb78e31,_0x51caf1)=>_0xb78e31+_0x51caf1,0x0);return{'date':_0x3879b5[_0x32df5b(0x1e2)][_0x32df5b(0x1b5)]()[_0x32df5b(0x1c7)]('T')[0x0],'amount':_0x225649};})),_0x256912=this[_0x225be5(0x16c)](_0x161669,new Date()),_0x80bbe8=new Map(_0x225db4[_0x225be5(0x127)](_0x442adb=>[_0x442adb['date'],_0x442adb['amount']])),_0x372ad4=_0x256912[_0x225be5(0x127)](_0x364b4a=>({'date':_0x364b4a,'amount':_0x80bbe8[_0x225be5(0x178)](_0x364b4a)||0x0}));return console[_0x225be5(0x156)](_0x225be5(0x17f)),console[_0x225be5(0x156)]('👥\x20Total\x20users:\x20'+_0x4fe304),console[_0x225be5(0x156)](_0x225be5(0x13b)+_0x1c8dbc),console[_0x225be5(0x156)](_0x225be5(0x166)+_0x372ad4['length']),{'totalRevenue':Math[_0x225be5(0x173)](_0x3f8431*0x64)/0x64,'totalUsers':_0x4fe304,'totalPayments':_0x1c8dbc,'averagePayment':Math['round'](_0x5c1e38*0x64)/0x64,'dailyRevenue':_0x372ad4};}async[a33_0x3ecc27(0x1dc)](_0x2e0fe7){const _0x2706d2=a33_0x3ecc27,{page:_0x274d97,limit:_0x254378,status:_0x50f19d,gateway:_0xeedade,shopId:_0x4ce168,dateFrom:_0x44c33c,dateTo:_0x55e0c5,search:_0x5afeb}=_0x2e0fe7,_0x42ad68=(_0x274d97-0x1)*_0x254378;console[_0x2706d2(0x156)](_0x2706d2(0x1e8),_0x2e0fe7);const _0x2468f2={};_0x50f19d&&(_0x2468f2[_0x2706d2(0x1c1)]=_0x50f19d[_0x2706d2(0x168)]());if(_0xeedade){if((0x0,gateway_1['isValidGatewayId'])(_0xeedade)){const _0x2344c0=(0x0,gateway_1['getGatewayNameById'])(_0xeedade);_0x2344c0&&(_0x2468f2[_0x2706d2(0x196)]=_0x2344c0);}else _0x2468f2[_0x2706d2(0x196)]=_0xeedade[_0x2706d2(0x12c)]();}_0x4ce168&&(_0x2468f2['shopId']=_0x4ce168);(_0x44c33c||_0x55e0c5)&&(_0x2468f2['createdAt']={},_0x44c33c&&(_0x2468f2[_0x2706d2(0x11d)][_0x2706d2(0x186)]=new Date(_0x44c33c)),_0x55e0c5&&(_0x2468f2['createdAt']['lte']=new Date(_0x55e0c5)));_0x5afeb&&(_0x2468f2['OR']=[{'orderId':{'contains':_0x5afeb,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x5afeb,'mode':_0x2706d2(0x119)}},{'gatewayPaymentId':{'contains':_0x5afeb,'mode':_0x2706d2(0x119)}},{'customerEmail':{'contains':_0x5afeb,'mode':_0x2706d2(0x119)}},{'customerName':{'contains':_0x5afeb,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x5afeb,'mode':_0x2706d2(0x119)}}},{'shop':{'username':{'contains':_0x5afeb,'mode':_0x2706d2(0x119)}}}]);const [_0x54213e,_0x42ae54]=await Promise['all']([database_1['default'][_0x2706d2(0x189)][_0x2706d2(0x1e3)]({'where':_0x2468f2,'skip':_0x42ad68,'take':_0x254378,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2706d2(0x11b)]['payment'][_0x2706d2(0x190)]({'where':_0x2468f2})]);console[_0x2706d2(0x156)](_0x2706d2(0x130)+_0x54213e[_0x2706d2(0x1e5)]+'\x20payments\x20out\x20of\x20'+_0x42ae54+_0x2706d2(0x1c4));const _0x516354=_0x54213e[_0x2706d2(0x127)](_0x1d2e6d=>({'id':_0x1d2e6d['id'],'shopId':_0x1d2e6d[_0x2706d2(0x1aa)],'shopName':_0x1d2e6d[_0x2706d2(0x146)][_0x2706d2(0x1ec)],'shopUsername':_0x1d2e6d[_0x2706d2(0x146)][_0x2706d2(0x1c2)],'gateway':_0x1d2e6d['gateway'],'orderId':_0x1d2e6d['orderId'],'gatewayOrderId':_0x1d2e6d[_0x2706d2(0x1cf)],'amount':_0x1d2e6d[_0x2706d2(0x15f)],'currency':_0x1d2e6d['currency'],'sourceCurrency':_0x1d2e6d[_0x2706d2(0x162)],'status':_0x1d2e6d[_0x2706d2(0x1c1)],'usage':_0x1d2e6d[_0x2706d2(0x16b)],'externalPaymentUrl':_0x1d2e6d[_0x2706d2(0x1ed)],'gatewayPaymentId':_0x1d2e6d[_0x2706d2(0x165)],'customerEmail':_0x1d2e6d[_0x2706d2(0x149)],'customerName':_0x1d2e6d['customerName'],'cardLast4':_0x1d2e6d[_0x2706d2(0x1ea)],'paymentMethod':_0x1d2e6d['paymentMethod'],'bankId':_0x1d2e6d[_0x2706d2(0x138)],'remitterIban':_0x1d2e6d[_0x2706d2(0x1c0)],'remitterName':_0x1d2e6d[_0x2706d2(0x193)],'chargebackAmount':_0x1d2e6d[_0x2706d2(0x1a8)],'adminNotes':_0x1d2e6d['adminNotes'],'statusChangedBy':_0x1d2e6d[_0x2706d2(0x117)],'statusChangedAt':_0x1d2e6d[_0x2706d2(0x15a)],'createdAt':_0x1d2e6d[_0x2706d2(0x11d)],'updatedAt':_0x1d2e6d[_0x2706d2(0x144)],'expiresAt':_0x1d2e6d[_0x2706d2(0x1d5)]}));return{'payments':_0x516354,'pagination':{'page':_0x274d97,'limit':_0x254378,'total':_0x42ae54,'totalPages':Math[_0x2706d2(0x1ad)](_0x42ae54/_0x254378)}};}async[a33_0x3ecc27(0x1c5)](_0x3d7c77){const _0x3317c9=a33_0x3ecc27;console[_0x3317c9(0x156)](_0x3317c9(0x1bc)+_0x3d7c77);const _0xe4b807=await database_1[_0x3317c9(0x11b)][_0x3317c9(0x189)][_0x3317c9(0x1a5)]({'where':{'id':_0x3d7c77},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x3317c9(0x13f)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0xe4b807)return console['log']('❌\x20Payment\x20not\x20found:\x20'+_0x3d7c77),null;return console[_0x3317c9(0x156)](_0x3317c9(0x188)+_0xe4b807[_0x3317c9(0x197)]+'\x20('+_0xe4b807[_0x3317c9(0x1c1)]+')'),{'id':_0xe4b807['id'],'shopId':_0xe4b807[_0x3317c9(0x1aa)],'shopName':_0xe4b807['shop']['name'],'shopUsername':_0xe4b807[_0x3317c9(0x146)][_0x3317c9(0x1c2)],'gateway':_0xe4b807[_0x3317c9(0x196)],'orderId':_0xe4b807[_0x3317c9(0x197)],'gatewayOrderId':_0xe4b807[_0x3317c9(0x1cf)],'amount':_0xe4b807['amount'],'currency':_0xe4b807[_0x3317c9(0x1cb)],'sourceCurrency':_0xe4b807['sourceCurrency'],'status':_0xe4b807[_0x3317c9(0x1c1)],'usage':_0xe4b807[_0x3317c9(0x16b)],'externalPaymentUrl':_0xe4b807['externalPaymentUrl'],'gatewayPaymentId':_0xe4b807['gatewayPaymentId'],'customerEmail':_0xe4b807[_0x3317c9(0x149)],'customerName':_0xe4b807['customerName'],'cardLast4':_0xe4b807[_0x3317c9(0x1ea)],'paymentMethod':_0xe4b807[_0x3317c9(0x145)],'bankId':_0xe4b807[_0x3317c9(0x138)],'remitterIban':_0xe4b807[_0x3317c9(0x1c0)],'remitterName':_0xe4b807[_0x3317c9(0x193)],'chargebackAmount':_0xe4b807['chargebackAmount'],'adminNotes':_0xe4b807[_0x3317c9(0x171)],'statusChangedBy':_0xe4b807[_0x3317c9(0x117)],'statusChangedAt':_0xe4b807['statusChangedAt'],'createdAt':_0xe4b807[_0x3317c9(0x11d)],'updatedAt':_0xe4b807[_0x3317c9(0x144)],'expiresAt':_0xe4b807[_0x3317c9(0x1d5)],'webhookLogs':_0xe4b807[_0x3317c9(0x17a)]};}async[a33_0x3ecc27(0x16f)](_0x238dad,_0x9b4cae,_0x588892,_0x36a94f){const _0x4cf92d=a33_0x3ecc27;console[_0x4cf92d(0x156)](_0x4cf92d(0x1de)+_0x238dad+_0x4cf92d(0x19c)+_0x9b4cae);const _0x4aa0ec=[_0x4cf92d(0x128),_0x4cf92d(0x1ae),_0x4cf92d(0x19f),'EXPIRED','FAILED','REFUND',_0x4cf92d(0x11c)];if(!_0x4aa0ec[_0x4cf92d(0x120)](_0x9b4cae[_0x4cf92d(0x168)]()))throw new Error(_0x4cf92d(0x1d4)+_0x4aa0ec[_0x4cf92d(0x11f)](',\x20'));const _0x26f5e4=await database_1[_0x4cf92d(0x11b)][_0x4cf92d(0x189)][_0x4cf92d(0x1a5)]({'where':{'id':_0x238dad},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x26f5e4)throw new Error(_0x4cf92d(0x1e4));if(_0x9b4cae[_0x4cf92d(0x168)]()==='CHARGEBACK'){if(!_0x36a94f||_0x36a94f<=0x0)throw new Error(_0x4cf92d(0x12d));console[_0x4cf92d(0x156)](_0x4cf92d(0x1e6)+_0x36a94f+_0x4cf92d(0x1a7));}const _0x45820e={'status':_0x9b4cae['toUpperCase'](),'updatedAt':new Date()};_0x588892&&(_0x45820e[_0x4cf92d(0x171)]=_0x588892);_0x9b4cae['toUpperCase']()===_0x4cf92d(0x11c)&&_0x36a94f&&(_0x45820e[_0x4cf92d(0x1a8)]=_0x36a94f);const _0x279c61=await database_1[_0x4cf92d(0x11b)]['payment'][_0x4cf92d(0x123)]({'where':{'id':_0x238dad},'data':_0x45820e,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x4cf92d(0x11b)][_0x4cf92d(0x137)][_0x4cf92d(0x1ee)]({'data':{'paymentId':_0x238dad,'shopId':_0x279c61[_0x4cf92d(0x1aa)],'event':_0x4cf92d(0x1a6),'statusCode':0xc8,'responseBody':JSON[_0x4cf92d(0x15b)]({'oldStatus':_0x26f5e4[_0x4cf92d(0x1c1)],'newStatus':_0x9b4cae['toUpperCase'](),'notes':_0x588892||null,'chargebackAmount':_0x36a94f||null,'timestamp':new Date()[_0x4cf92d(0x1b5)]()})}}),console['log'](_0x4cf92d(0x17d)+_0x26f5e4[_0x4cf92d(0x197)]+_0x4cf92d(0x12a)+_0x26f5e4[_0x4cf92d(0x1c1)]+_0x4cf92d(0x157)+_0x9b4cae['toUpperCase']()),_0x9b4cae[_0x4cf92d(0x168)]()===_0x4cf92d(0x11c)&&console[_0x4cf92d(0x156)](_0x4cf92d(0x19b)+_0x36a94f+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0x279c61['id'],'shopId':_0x279c61[_0x4cf92d(0x1aa)],'shopName':_0x279c61['shop']['name'],'shopUsername':_0x279c61[_0x4cf92d(0x146)][_0x4cf92d(0x1c2)],'gateway':_0x279c61['gateway'],'orderId':_0x279c61[_0x4cf92d(0x197)],'gatewayOrderId':_0x279c61[_0x4cf92d(0x1cf)],'amount':_0x279c61[_0x4cf92d(0x15f)],'currency':_0x279c61['currency'],'sourceCurrency':_0x279c61['sourceCurrency'],'status':_0x279c61[_0x4cf92d(0x1c1)],'usage':_0x279c61['usage'],'externalPaymentUrl':_0x279c61[_0x4cf92d(0x1ed)],'gatewayPaymentId':_0x279c61[_0x4cf92d(0x165)],'customerEmail':_0x279c61[_0x4cf92d(0x149)],'customerName':_0x279c61[_0x4cf92d(0x1b8)],'cardLast4':_0x279c61['cardLast4'],'paymentMethod':_0x279c61[_0x4cf92d(0x145)],'bankId':_0x279c61[_0x4cf92d(0x138)],'remitterIban':_0x279c61['remitterIban'],'remitterName':_0x279c61[_0x4cf92d(0x193)],'chargebackAmount':_0x279c61['chargebackAmount'],'adminNotes':_0x279c61[_0x4cf92d(0x171)],'statusChangedBy':_0x279c61[_0x4cf92d(0x117)],'statusChangedAt':_0x279c61[_0x4cf92d(0x15a)],'createdAt':_0x279c61['createdAt'],'updatedAt':_0x279c61[_0x4cf92d(0x144)],'expiresAt':_0x279c61[_0x4cf92d(0x1d5)]};}async[a33_0x3ecc27(0x14d)](_0x17f576){const _0x5bb195=a33_0x3ecc27,{page:_0x43bfe2,limit:_0x25cd12,status:_0x136f98}=_0x17f576,_0x274a26=(_0x43bfe2-0x1)*_0x25cd12,_0x427950={};_0x136f98&&(_0x427950[_0x5bb195(0x1c1)]=_0x136f98[_0x5bb195(0x168)]());console[_0x5bb195(0x156)]('📋\x20Getting\x20users\x20with\x20filters:',{'page':_0x43bfe2,'limit':_0x25cd12,'status':_0x136f98,'where':_0x427950});const [_0x29acfe,_0x13b8bb]=await Promise['all']([database_1[_0x5bb195(0x11b)][_0x5bb195(0x146)][_0x5bb195(0x1e3)]({'where':_0x427950,'skip':_0x274a26,'take':_0x25cd12,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x5bb195(0x13f)}}),database_1[_0x5bb195(0x11b)][_0x5bb195(0x146)][_0x5bb195(0x190)]({'where':_0x427950})]);console[_0x5bb195(0x156)](_0x5bb195(0x130)+_0x29acfe[_0x5bb195(0x1e5)]+_0x5bb195(0x18d)+_0x13b8bb+_0x5bb195(0x1c4));const _0x114a76=_0x29acfe[_0x5bb195(0x127)](_0x1e958a=>({'id':_0x1e958a['id'],'fullName':_0x1e958a[_0x5bb195(0x1ec)],'username':_0x1e958a['username'],'telegramId':_0x1e958a[_0x5bb195(0x159)],'merchantUrl':_0x1e958a['shopUrl'],'gateways':_0x1e958a[_0x5bb195(0x1e0)]?JSON[_0x5bb195(0x1a0)](_0x1e958a[_0x5bb195(0x1e0)]):null,'gatewaySettings':_0x1e958a[_0x5bb195(0x1a9)]?JSON['parse'](_0x1e958a[_0x5bb195(0x1a9)]):null,'publicKey':_0x1e958a[_0x5bb195(0x183)],'wallets':{'usdtPolygonWallet':_0x1e958a[_0x5bb195(0x192)],'usdtTrcWallet':_0x1e958a[_0x5bb195(0x13c)],'usdtErcWallet':_0x1e958a[_0x5bb195(0x1be)],'usdcPolygonWallet':_0x1e958a['usdcPolygonWallet']},'status':_0x1e958a[_0x5bb195(0x1c1)],'createdAt':_0x1e958a[_0x5bb195(0x11d)]}));return{'users':_0x114a76,'pagination':{'page':_0x43bfe2,'limit':_0x25cd12,'total':_0x13b8bb,'totalPages':Math[_0x5bb195(0x1ad)](_0x13b8bb/_0x25cd12)}};}async[a33_0x3ecc27(0x18b)](_0x3db470){const _0x1ba558=a33_0x3ecc27;return await this[_0x1ba558(0x19e)][_0x1ba558(0x18b)](_0x3db470);}async[a33_0x3ecc27(0x19a)](_0xa60874){const _0x228922=a33_0x3ecc27;return await this[_0x228922(0x19e)][_0x228922(0x19a)](_0xa60874);}async[a33_0x3ecc27(0x1e7)](_0x24e965,_0x1ffd80){const _0x4068b5=a33_0x3ecc27;return await this['userService'][_0x4068b5(0x1e7)](_0x24e965,_0x1ffd80);}async[a33_0x3ecc27(0x174)](_0x1f523b){const _0x398cc7=a33_0x3ecc27;return await this[_0x398cc7(0x19e)][_0x398cc7(0x174)](_0x1f523b);}async[a33_0x3ecc27(0x1ce)](_0x131114){const _0x4b838=a33_0x3ecc27;console[_0x4b838(0x156)](_0x4b838(0x180)+_0x131114);const _0x3099d7=await database_1[_0x4b838(0x11b)][_0x4b838(0x146)][_0x4b838(0x1a5)]({'where':{'id':_0x131114},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3099d7)throw new Error(_0x4b838(0x164));if(_0x3099d7[_0x4b838(0x1c1)]===_0x4b838(0x17b))throw new Error(_0x4b838(0x1d1));const _0x3f3224=await this[_0x4b838(0x19e)][_0x4b838(0x1e7)](_0x131114,{'status':_0x4b838(0x17b)});return console['log'](_0x4b838(0x1bf)+_0x3099d7[_0x4b838(0x1c2)]+_0x4b838(0x133)),_0x3f3224;}async[a33_0x3ecc27(0x1b4)](_0x218863){const _0x9828f0=a33_0x3ecc27;console[_0x9828f0(0x156)](_0x9828f0(0x14b)+_0x218863);const _0x56a58a=await database_1[_0x9828f0(0x11b)][_0x9828f0(0x146)][_0x9828f0(0x1a5)]({'where':{'id':_0x218863},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x56a58a)throw new Error('User\x20not\x20found');if(_0x56a58a['status']===_0x9828f0(0x169))throw new Error('User\x20is\x20already\x20active');const _0x4bf177=await this[_0x9828f0(0x19e)]['updateUser'](_0x218863,{'status':_0x9828f0(0x169)});return console[_0x9828f0(0x156)](_0x9828f0(0x1bf)+_0x56a58a[_0x9828f0(0x1c2)]+_0x9828f0(0x142)),_0x4bf177;}}exports['AdminService']=AdminService;