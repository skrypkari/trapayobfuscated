'use strict';const a33_0x1d57b5=a33_0x427d;(function(_0x3dd0b2,_0x21a3ff){const _0x5f195e=a33_0x427d,_0x59b83b=_0x3dd0b2();while(!![]){try{const _0x4698b1=-parseInt(_0x5f195e(0x159))/0x1*(-parseInt(_0x5f195e(0x186))/0x2)+-parseInt(_0x5f195e(0x175))/0x3*(parseInt(_0x5f195e(0x13b))/0x4)+-parseInt(_0x5f195e(0x19b))/0x5*(parseInt(_0x5f195e(0x1e5))/0x6)+-parseInt(_0x5f195e(0x179))/0x7*(parseInt(_0x5f195e(0x1dc))/0x8)+parseInt(_0x5f195e(0x1b9))/0x9+-parseInt(_0x5f195e(0x19a))/0xa*(-parseInt(_0x5f195e(0x155))/0xb)+parseInt(_0x5f195e(0x1eb))/0xc;if(_0x4698b1===_0x21a3ff)break;else _0x59b83b['push'](_0x59b83b['shift']());}catch(_0x3c36f6){_0x59b83b['push'](_0x59b83b['shift']());}}}(a33_0x4c95,0xb0867));function a33_0x427d(_0xb646,_0x920910){const _0x4c95bc=a33_0x4c95();return a33_0x427d=function(_0x427db6,_0x10da33){_0x427db6=_0x427db6-0x137;let _0x19a459=_0x4c95bc[_0x427db6];return _0x19a459;},a33_0x427d(_0xb646,_0x920910);}var __importDefault=this&&this[a33_0x1d57b5(0x1c7)]||function(_0x5cde69){const _0x37039d=a33_0x1d57b5;return _0x5cde69&&_0x5cde69[_0x37039d(0x14a)]?_0x5cde69:{'default':_0x5cde69};};Object['defineProperty'](exports,a33_0x1d57b5(0x14a),{'value':!![]}),exports[a33_0x1d57b5(0x148)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a33_0x1d57b5(0x1a8)),userService_1=require(a33_0x1d57b5(0x1e4)),telegramBotService_1=require(a33_0x1d57b5(0x20a)),gateway_1=require(a33_0x1d57b5(0x1f5));class AdminService{constructor(){const _0x33807d=a33_0x1d57b5;this[_0x33807d(0x1f7)]=new userService_1[(_0x33807d(0x1e1))]();}[a33_0x1d57b5(0x1d7)](_0x1ad56b){const _0x590840=a33_0x1d57b5;switch(_0x1ad56b){case'7d':return 0x7;case _0x590840(0x1bd):return 0x1e;case _0x590840(0x1ed):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x1d57b5(0x145)](_0xb20dab,_0x4b09cd){const _0x46bf19=a33_0x1d57b5,_0x13d6f1=[],_0x38b73a=new Date(_0xb20dab);while(_0x38b73a<=_0x4b09cd){_0x13d6f1[_0x46bf19(0x146)](_0x38b73a[_0x46bf19(0x201)]()[_0x46bf19(0x20b)]('T')[0x0]),_0x38b73a['setDate'](_0x38b73a[_0x46bf19(0x1c2)]()+0x1);}return _0x13d6f1;}[a33_0x1d57b5(0x190)](_0x49cdb3,_0x4157ff){const _0x4251a2=a33_0x1d57b5;if(!_0x49cdb3['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x4d0bb5=JSON['parse'](_0x49cdb3[_0x4251a2(0x1f9)]),_0x5a2a54=_0x4157ff[_0x4251a2(0x143)](0x0)[_0x4251a2(0x1e7)]()+_0x4157ff['slice'](0x1)[_0x4251a2(0x140)]();if(_0x4d0bb5&&_0x4d0bb5[_0x5a2a54])return{'commission':_0x4d0bb5[_0x5a2a54][_0x4251a2(0x1d0)]||0x0,'payoutDelay':_0x4d0bb5[_0x5a2a54][_0x4251a2(0x17f)]||0x0};}catch(_0x2a8eeb){console[_0x4251a2(0x1cc)]('Error\x20parsing\x20gateway\x20settings:',_0x2a8eeb);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x1d57b5(0x1ca)](_0x2acb9a){const _0xe06fe3=a33_0x1d57b5;if(_0x2acb9a[_0xe06fe3(0x1ba)]!==_0xe06fe3(0x207)||_0x2acb9a[_0xe06fe3(0x1b0)]||!_0x2acb9a['paidAt'])return![];const _0xb02e43=this[_0xe06fe3(0x190)](_0x2acb9a[_0xe06fe3(0x154)],_0x2acb9a[_0xe06fe3(0x151)]),_0x3fe87e=_0xb02e43[_0xe06fe3(0x17f)]*0x18*0x3c*0x3c*0x3e8,_0xd9a79d=new Date(_0x2acb9a[_0xe06fe3(0x187)]['getTime']()+_0x3fe87e);return new Date()>_0xd9a79d;}['calculateAmountAfterCommission'](_0x49d097,_0x48292c){return _0x49d097*(0x1-_0x48292c/0x64);}[a33_0x1d57b5(0x1aa)](_0x376f47){const _0x2cd9a6=a33_0x1d57b5;switch(_0x376f47[_0x2cd9a6(0x1ba)]){case _0x2cd9a6(0x207):return _0x376f47[_0x2cd9a6(0x1c8)];case _0x2cd9a6(0x15a):return-(_0x376f47[_0x2cd9a6(0x1b5)]||0x0);case'REFUND':return 0x0;default:return 0x0;}}async[a33_0x1d57b5(0x1fb)](_0x320a83){const _0x4fe331=a33_0x1d57b5,{shopId:_0x3b0774,amount:_0x5552dd,network:_0x26d4a4,notes:_0x375402}=_0x320a83;console[_0x4fe331(0x1b6)](_0x4fe331(0x1d6)+_0x3b0774+':\x20'+_0x5552dd+_0x4fe331(0x1d8)+_0x26d4a4);const _0x228cff=await database_1[_0x4fe331(0x1f0)][_0x4fe331(0x154)][_0x4fe331(0x1c0)]({'where':{'id':_0x3b0774},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x228cff)throw new Error(_0x4fe331(0x178));if(_0x228cff[_0x4fe331(0x1ba)]!==_0x4fe331(0x1d4))throw new Error('Shop\x20is\x20not\x20active');const _0x39436a=await database_1['default'][_0x4fe331(0x1df)]['create']({'data':{'shopId':_0x3b0774,'amount':_0x5552dd,'network':_0x26d4a4,'status':_0x4fe331(0x193),'notes':_0x375402||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x4fe331(0x16d)](_0x3b0774,_0x5552dd);try{await telegramBotService_1['telegramBotService'][_0x4fe331(0x1e9)](_0x3b0774,_0x39436a,_0x4fe331(0x1fd));}catch(_0x349202){console[_0x4fe331(0x1cc)]('Failed\x20to\x20send\x20Telegram\x20payout\x20notification:',_0x349202);}return console['log'](_0x4fe331(0x15f)+_0x39436a['id']),{'id':_0x39436a['id'],'shopId':_0x39436a[_0x4fe331(0x1f4)],'shopName':_0x39436a[_0x4fe331(0x154)]['name'],'shopUsername':_0x39436a['shop'][_0x4fe331(0x173)],'amount':_0x39436a[_0x4fe331(0x1c8)],'network':_0x39436a[_0x4fe331(0x1de)],'status':_0x39436a[_0x4fe331(0x1ba)],'txid':_0x39436a['txid'],'notes':_0x39436a[_0x4fe331(0x1b1)],'createdAt':_0x39436a[_0x4fe331(0x14e)],'paidAt':_0x39436a[_0x4fe331(0x187)]};}async[a33_0x1d57b5(0x16d)](_0x22311c,_0x195ff1){const _0x59e349=a33_0x1d57b5;console['log'](_0x59e349(0x14f)+_0x22311c+_0x59e349(0x13d)+_0x195ff1+_0x59e349(0x1c9));const _0x4cbd08=await database_1['default']['payment']['findMany']({'where':{'shopId':_0x22311c,'status':_0x59e349(0x207),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':'asc'}});let _0x221681=_0x195ff1;const _0x45a0c2=[];for(const _0x5eb543 of _0x4cbd08){const _0x18a4a2={..._0x5eb543,'status':_0x59e349(0x207),'merchantPaid':![],'shop':{'gatewaySettings':_0x5eb543['shop'][_0x59e349(0x1f9)]}};if(!this[_0x59e349(0x1ca)](_0x18a4a2))continue;const _0x489b78=await currencyService_1[_0x59e349(0x171)][_0x59e349(0x1c3)](_0x5eb543['amount'],_0x5eb543[_0x59e349(0x160)]),_0x166fcd=this[_0x59e349(0x190)](_0x5eb543[_0x59e349(0x154)],_0x5eb543[_0x59e349(0x151)]),_0x4e8a0b=this[_0x59e349(0x1b3)](_0x489b78,_0x166fcd['commission']);if(_0x4e8a0b<=_0x221681){_0x45a0c2[_0x59e349(0x146)](_0x5eb543['id']),_0x221681-=_0x4e8a0b;if(_0x221681<=0.01)break;}}_0x45a0c2[_0x59e349(0x18c)]>0x0&&(await database_1[_0x59e349(0x1f0)][_0x59e349(0x157)][_0x59e349(0x1a0)]({'where':{'id':{'in':_0x45a0c2}},'data':{'merchantPaid':!![]}}),console[_0x59e349(0x1b6)](_0x59e349(0x147)+_0x45a0c2[_0x59e349(0x18c)]+'\x20payments\x20as\x20paid\x20out'));}async[a33_0x1d57b5(0x1d9)](_0x20df0a){const _0x533a0b=a33_0x1d57b5,{page:_0x5a3dde,limit:_0x4af3f5,shopId:_0x5bc96c,network:_0x19a45c,dateFrom:_0x4921c6,dateTo:_0x576b5a,search:_0x4f3c3e}=_0x20df0a,_0x3c0e47=(_0x5a3dde-0x1)*_0x4af3f5;console[_0x533a0b(0x1b6)]('üìã\x20Getting\x20payouts\x20with\x20filters:',_0x20df0a);const _0x4e5aec={};_0x5bc96c&&(_0x4e5aec[_0x533a0b(0x1f4)]=_0x5bc96c);_0x19a45c&&(_0x4e5aec[_0x533a0b(0x1de)]=_0x19a45c);(_0x4921c6||_0x576b5a)&&(_0x4e5aec[_0x533a0b(0x14e)]={},_0x4921c6&&(_0x4e5aec[_0x533a0b(0x14e)][_0x533a0b(0x188)]=new Date(_0x4921c6)),_0x576b5a&&(_0x4e5aec[_0x533a0b(0x14e)]['lte']=new Date(_0x576b5a)));_0x4f3c3e&&(_0x4e5aec['OR']=[{'txid':{'contains':_0x4f3c3e,'mode':_0x533a0b(0x198)}},{'notes':{'contains':_0x4f3c3e,'mode':_0x533a0b(0x198)}},{'shop':{'name':{'contains':_0x4f3c3e,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x4f3c3e,'mode':_0x533a0b(0x198)}}}]);const [_0x4d45b7,_0x537eca]=await Promise[_0x533a0b(0x164)]([database_1[_0x533a0b(0x1f0)][_0x533a0b(0x1df)][_0x533a0b(0x19f)]({'where':_0x4e5aec,'skip':_0x3c0e47,'take':_0x4af3f5,'orderBy':{'createdAt':_0x533a0b(0x1ac)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x533a0b(0x1f0)][_0x533a0b(0x1df)][_0x533a0b(0x168)]({'where':_0x4e5aec})]);console[_0x533a0b(0x1b6)]('üìä\x20Found\x20'+_0x4d45b7[_0x533a0b(0x18c)]+'\x20payouts\x20out\x20of\x20'+_0x537eca+'\x20total');const _0x412688=_0x4d45b7[_0x533a0b(0x16e)](_0x11f1ef=>({'id':_0x11f1ef['id'],'shopId':_0x11f1ef[_0x533a0b(0x1f4)],'shopName':_0x11f1ef[_0x533a0b(0x154)]['name'],'shopUsername':_0x11f1ef['shop'][_0x533a0b(0x173)],'amount':_0x11f1ef['amount'],'network':_0x11f1ef['network'],'status':_0x11f1ef[_0x533a0b(0x1ba)],'txid':_0x11f1ef[_0x533a0b(0x19d)],'notes':_0x11f1ef[_0x533a0b(0x1b1)],'createdAt':_0x11f1ef['createdAt'],'paidAt':_0x11f1ef['paidAt']}));return{'payouts':_0x412688,'pagination':{'page':_0x5a3dde,'limit':_0x4af3f5,'total':_0x537eca,'totalPages':Math[_0x533a0b(0x191)](_0x537eca/_0x4af3f5)}};}async[a33_0x1d57b5(0x13f)](_0x543f84){const _0x524e2c=a33_0x1d57b5;console[_0x524e2c(0x1b6)]('üîç\x20Getting\x20payout\x20by\x20ID:\x20'+_0x543f84);const _0x5a15f8=await database_1[_0x524e2c(0x1f0)][_0x524e2c(0x1df)][_0x524e2c(0x1c0)]({'where':{'id':_0x543f84},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5a15f8)return console['log']('‚ùå\x20Payout\x20not\x20found:\x20'+_0x543f84),null;return console[_0x524e2c(0x1b6)](_0x524e2c(0x1a4)+_0x5a15f8[_0x524e2c(0x1c8)]+'\x20USDT\x20via\x20'+_0x5a15f8[_0x524e2c(0x1de)]),{'id':_0x5a15f8['id'],'shopId':_0x5a15f8[_0x524e2c(0x1f4)],'shopName':_0x5a15f8[_0x524e2c(0x154)][_0x524e2c(0x17d)],'shopUsername':_0x5a15f8[_0x524e2c(0x154)][_0x524e2c(0x173)],'amount':_0x5a15f8[_0x524e2c(0x1c8)],'network':_0x5a15f8[_0x524e2c(0x1de)],'status':_0x5a15f8[_0x524e2c(0x1ba)],'txid':_0x5a15f8[_0x524e2c(0x19d)],'notes':_0x5a15f8[_0x524e2c(0x1b1)],'createdAt':_0x5a15f8[_0x524e2c(0x14e)],'paidAt':_0x5a15f8['paidAt']};}async[a33_0x1d57b5(0x205)](_0x26d6a9){const _0x4e36ef=a33_0x1d57b5;console[_0x4e36ef(0x1b6)]('üóëÔ∏è\x20Deleting\x20payout:\x20'+_0x26d6a9);const _0x1739e5=await database_1[_0x4e36ef(0x1f0)][_0x4e36ef(0x1df)][_0x4e36ef(0x1c0)]({'where':{'id':_0x26d6a9},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x1739e5)throw new Error(_0x4e36ef(0x1d5));await database_1[_0x4e36ef(0x1f0)][_0x4e36ef(0x1df)]['delete']({'where':{'id':_0x26d6a9}}),console[_0x4e36ef(0x1b6)](_0x4e36ef(0x183)+_0x26d6a9+_0x4e36ef(0x209));}async[a33_0x1d57b5(0x141)](_0x543dca){const _0x5b6280=a33_0x1d57b5,{page:_0x38fdd3,limit:_0x3d4da6,minAmount:_0x4b3d7b,search:_0x1e3865}=_0x543dca;console[_0x5b6280(0x1b6)]('üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x543dca);const _0x14b2b5=await database_1[_0x5b6280(0x1f0)][_0x5b6280(0x157)][_0x5b6280(0x19f)]({'where':{'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log'](_0x5b6280(0x163)+_0x14b2b5['length']+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x11dc2c=new Map();for(const _0xeee517 of _0x14b2b5){const _0x59c415={..._0xeee517,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0xeee517[_0x5b6280(0x154)]['gatewaySettings']}},_0x4bbb46=this[_0x5b6280(0x1ca)](_0x59c415);if(!_0x4bbb46)continue;const _0x3fe4a7=await currencyService_1[_0x5b6280(0x171)][_0x5b6280(0x1c3)](_0xeee517[_0x5b6280(0x1c8)],_0xeee517['currency']),_0x417da4=this[_0x5b6280(0x190)](_0xeee517[_0x5b6280(0x154)],_0xeee517[_0x5b6280(0x151)]),_0x518e59=this['calculateAmountAfterCommission'](_0x3fe4a7,_0x417da4[_0x5b6280(0x1d0)]),_0x358b55=_0xeee517[_0x5b6280(0x1f4)];!_0x11dc2c[_0x5b6280(0x200)](_0x358b55)&&_0x11dc2c[_0x5b6280(0x1b7)](_0x358b55,{'shop':_0xeee517[_0x5b6280(0x154)],'payments':[]}),_0x11dc2c[_0x5b6280(0x156)](_0x358b55)[_0x5b6280(0x185)]['push']({'id':_0xeee517['id'],'amount':_0xeee517[_0x5b6280(0x1c8)],'currency':_0xeee517['currency'],'gateway':_0xeee517[_0x5b6280(0x151)],'paidAt':_0xeee517['paidAt'],'createdAt':_0xeee517[_0x5b6280(0x14e)],'amountUSDT':_0x3fe4a7,'commission':_0x417da4['commission'],'amountAfterCommissionUSDT':_0x518e59,'isEligible':!![]});}console[_0x5b6280(0x1b6)](_0x5b6280(0x181)+_0x11dc2c[_0x5b6280(0x1cd)]+_0x5b6280(0x18f));const _0x1027a0=[];for(const [_0x1c51ec,_0x3c0636]of _0x11dc2c){const {shop:_0x39f0db,payments:_0x56e6c8}=_0x3c0636,_0x414ad0=_0x56e6c8['reduce']((_0x1c5232,_0x229e5a)=>_0x1c5232+_0x229e5a['amountUSDT'],0x0),_0x2f702d=_0x56e6c8[_0x5b6280(0x18e)]((_0x57ae84,_0x33c3ba)=>_0x57ae84+_0x33c3ba[_0x5b6280(0x1e8)],0x0);if(_0x4b3d7b&&_0x2f702d<_0x4b3d7b)continue;if(_0x1e3865){const _0x496b58=_0x1e3865[_0x5b6280(0x140)](),_0x429fef=_0x39f0db[_0x5b6280(0x17d)][_0x5b6280(0x140)]()[_0x5b6280(0x1bb)](_0x496b58)||_0x39f0db['username']['toLowerCase']()['includes'](_0x496b58)||_0x39f0db[_0x5b6280(0x1db)]&&_0x39f0db[_0x5b6280(0x1db)][_0x5b6280(0x140)]()[_0x5b6280(0x1bb)](_0x496b58);if(!_0x429fef)continue;}const _0x3c79d0=new Map();for(const _0x3413d0 of _0x56e6c8){const _0x1a1635=_0x3413d0[_0x5b6280(0x151)];!_0x3c79d0[_0x5b6280(0x200)](_0x1a1635)&&_0x3c79d0[_0x5b6280(0x1b7)](_0x1a1635,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x3413d0[_0x5b6280(0x1d0)]});const _0x1a90ab=_0x3c79d0[_0x5b6280(0x156)](_0x1a1635);_0x1a90ab['count']++,_0x1a90ab[_0x5b6280(0x16c)]+=_0x3413d0[_0x5b6280(0x16c)],_0x1a90ab[_0x5b6280(0x1e8)]+=_0x3413d0[_0x5b6280(0x1e8)];}const _0x2caf3d=Array[_0x5b6280(0x167)](_0x3c79d0[_0x5b6280(0x18b)]())[_0x5b6280(0x16e)](([_0x13a83c,_0x11e4ba])=>({'gateway':_0x13a83c[_0x5b6280(0x143)](0x0)[_0x5b6280(0x1e7)]()+_0x13a83c[_0x5b6280(0x1ef)](0x1),'count':_0x11e4ba[_0x5b6280(0x168)],'amountUSDT':Math['round'](_0x11e4ba[_0x5b6280(0x16c)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5b6280(0x1bc)](_0x11e4ba['amountAfterCommissionUSDT']*0x64)/0x64,'commission':_0x11e4ba[_0x5b6280(0x1d0)]})),_0x24095b=_0x56e6c8[_0x5b6280(0x18e)]((_0x3cf4fa,_0x48f377)=>{const _0x5d5faf=_0x5b6280;return _0x48f377[_0x5d5faf(0x187)]<_0x3cf4fa?_0x48f377['paidAt']:_0x3cf4fa;},_0x56e6c8[0x0][_0x5b6280(0x187)]);_0x1027a0['push']({'id':_0x39f0db['id'],'fullName':_0x39f0db[_0x5b6280(0x17d)],'username':_0x39f0db[_0x5b6280(0x173)],'telegramId':_0x39f0db[_0x5b6280(0x1db)],'merchantUrl':_0x39f0db[_0x5b6280(0x1fa)],'wallets':{'usdtPolygonWallet':_0x39f0db[_0x5b6280(0x138)],'usdtTrcWallet':_0x39f0db[_0x5b6280(0x1ae)],'usdtErcWallet':_0x39f0db[_0x5b6280(0x16a)],'usdcPolygonWallet':_0x39f0db[_0x5b6280(0x17b)]},'totalAmountUSDT':Math[_0x5b6280(0x1bc)](_0x414ad0*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x2f702d*0x64)/0x64,'paymentsCount':_0x56e6c8[_0x5b6280(0x18c)],'oldestPaymentDate':_0x24095b,'gatewayBreakdown':_0x2caf3d});}_0x1027a0[_0x5b6280(0x19c)]((_0x18d2e1,_0x7f7024)=>_0x7f7024[_0x5b6280(0x189)]-_0x18d2e1[_0x5b6280(0x189)]);const _0x28c59c=_0x1027a0[_0x5b6280(0x18c)],_0x7f168a=_0x1027a0[_0x5b6280(0x18e)]((_0x18492c,_0x3473aa)=>_0x18492c+_0x3473aa[_0x5b6280(0x1a6)],0x0),_0x63e35d=_0x1027a0[_0x5b6280(0x18e)]((_0x2c43c8,_0x5cf023)=>_0x2c43c8+_0x5cf023[_0x5b6280(0x189)],0x0),_0x498237=(_0x38fdd3-0x1)*_0x3d4da6,_0x1f4b90=_0x1027a0['slice'](_0x498237,_0x498237+_0x3d4da6);return console[_0x5b6280(0x1b6)](_0x5b6280(0x149)+_0x1f4b90['length']+_0x5b6280(0x137)+_0x28c59c+'\x20total'),console['log'](_0x5b6280(0x1a2)+_0x7f168a[_0x5b6280(0x195)](0x2)+'\x20USDT\x20('+_0x63e35d[_0x5b6280(0x195)](0x2)+_0x5b6280(0x165)),{'merchants':_0x1f4b90,'pagination':{'page':_0x38fdd3,'limit':_0x3d4da6,'total':_0x28c59c,'totalPages':Math['ceil'](_0x28c59c/_0x3d4da6)},'summary':{'totalMerchants':_0x28c59c,'totalAmountUSDT':Math[_0x5b6280(0x1bc)](_0x7f168a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5b6280(0x1bc)](_0x63e35d*0x64)/0x64}};}async[a33_0x1d57b5(0x1e6)](){const _0x455a34=a33_0x1d57b5;console['log']('üìä\x20Calculating\x20admin\x20payout\x20statistics...');const _0x3004f2=await database_1['default'][_0x455a34(0x157)][_0x455a34(0x19f)]({'where':{'status':{'in':[_0x455a34(0x207),'REFUND',_0x455a34(0x15a)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x3004f2[_0x455a34(0x18c)]+_0x455a34(0x1f3));const _0x4782c3=new Date(),_0x4ceaa4=new Date(_0x4782c3['getFullYear'](),_0x4782c3[_0x455a34(0x206)](),0x1),_0x2a3a9d=new Date(_0x4782c3[_0x455a34(0x1a5)](),_0x4782c3[_0x455a34(0x206)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x4d3a68=0x0,_0x2a4037=0x0,_0xdb6936=0x0,_0x4d7a3f=0x0;for(const _0x4babb6 of _0x3004f2){const _0x314400=this['calculateEffectiveAmount'](_0x4babb6);if(_0x314400===0x0)continue;let _0x19ef18,_0x3e7fb4;if(_0x4babb6['status']===_0x455a34(0x15a))_0x19ef18=Math[_0x455a34(0x15c)](_0x314400),_0x3e7fb4=-_0x19ef18;else{_0x19ef18=await currencyService_1[_0x455a34(0x171)][_0x455a34(0x1c3)](_0x4babb6[_0x455a34(0x1c8)],_0x4babb6[_0x455a34(0x160)]);const _0x5f3b08=this[_0x455a34(0x190)](_0x4babb6[_0x455a34(0x154)],_0x4babb6[_0x455a34(0x151)]);_0x3e7fb4=this[_0x455a34(0x1b3)](_0x19ef18,_0x5f3b08[_0x455a34(0x1d0)]);}_0x4babb6[_0x455a34(0x1b0)]&&(_0x4d3a68+=_0x3e7fb4,_0x4babb6[_0x455a34(0x187)]&&_0x4babb6[_0x455a34(0x187)]>=_0x4ceaa4&&_0x4babb6['paidAt']<=_0x2a3a9d&&(_0xdb6936+=_0x3e7fb4)),_0x4babb6[_0x455a34(0x1ba)]===_0x455a34(0x207)&&this[_0x455a34(0x1ca)](_0x4babb6)&&(_0x2a4037+=_0x3e7fb4,_0x4d7a3f+=_0x19ef18);}const _0x5ec510={'totalPayout':Math[_0x455a34(0x1bc)](_0x4d3a68*0x64)/0x64,'awaitingPayout':Math['round'](_0x2a4037*0x64)/0x64,'thisMonth':Math['round'](_0xdb6936*0x64)/0x64,'availableBalance':Math[_0x455a34(0x1bc)](_0x4d7a3f*0x64)/0x64};return console[_0x455a34(0x1b6)](_0x455a34(0x1ee)),console[_0x455a34(0x1b6)](_0x455a34(0x14c)+_0x5ec510[_0x455a34(0x13e)]+_0x455a34(0x20d)),console[_0x455a34(0x1b6)]('‚è≥\x20Awaiting\x20Payout:\x20'+_0x5ec510[_0x455a34(0x1ff)]+'\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)'),console[_0x455a34(0x1b6)](_0x455a34(0x14d)+_0x5ec510['thisMonth']+'\x20USDT'),console[_0x455a34(0x1b6)](_0x455a34(0x1be)+_0x5ec510[_0x455a34(0x161)]+'\x20USDT'),_0x5ec510;}async['getSystemStatistics'](_0xf12e66){const _0x113389=a33_0x1d57b5,_0x568071=this[_0x113389(0x1d7)](_0xf12e66),_0x43a21c=new Date();_0x43a21c[_0x113389(0x1f8)](_0x43a21c['getDate']()-_0x568071),console[_0x113389(0x1b6)](_0x113389(0x170)+_0xf12e66+'\x20('+_0x568071+_0x113389(0x18a));const _0x1346fe=await database_1[_0x113389(0x1f0)][_0x113389(0x154)]['count']({'where':{'status':_0x113389(0x1d4)}}),_0xd3cddb=await database_1[_0x113389(0x1f0)]['payment'][_0x113389(0x168)](),_0x1ba958=await database_1[_0x113389(0x1f0)]['payment'][_0x113389(0x19f)]({'where':{'status':{'in':[_0x113389(0x207),_0x113389(0x172),_0x113389(0x15a)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x113389(0x1b6)]('üí∞\x20Found\x20'+_0x1ba958[_0x113389(0x18c)]+_0x113389(0x1a7));const _0x5af131=await Promise[_0x113389(0x164)](_0x1ba958['map'](async _0x3fdef5=>{const _0x301074=_0x113389,_0x453f71=this['calculateEffectiveAmount'](_0x3fdef5);if(_0x453f71===0x0)return{'amount':0x0,'createdAt':_0x3fdef5[_0x301074(0x14e)]};let _0x501fe7;return _0x3fdef5['status']===_0x301074(0x15a)?_0x501fe7=-Math[_0x301074(0x15c)](_0x453f71):_0x501fe7=await currencyService_1[_0x301074(0x171)]['convertToUSDT'](_0x3fdef5[_0x301074(0x1c8)],_0x3fdef5[_0x301074(0x160)]),{'amount':_0x501fe7,'createdAt':_0x3fdef5[_0x301074(0x14e)]};})),_0xbfcdbc=_0x5af131[_0x113389(0x18e)]((_0x552285,_0x3b389b)=>_0x552285+_0x3b389b[_0x113389(0x1c8)],0x0),_0x5136e7=_0xd3cddb>0x0?_0xbfcdbc/_0xd3cddb:0x0;console[_0x113389(0x1b6)](_0x113389(0x1c4)+_0xbfcdbc[_0x113389(0x195)](0x2)+_0x113389(0x20d)),console[_0x113389(0x1b6)]('üìà\x20Average\x20payment:\x20'+_0x5136e7[_0x113389(0x195)](0x2)+_0x113389(0x1c9));const _0x39c044=await database_1['default']['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x43a21c}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console['log']('üìÖ\x20Processing\x20daily\x20stats\x20for\x20'+_0x39c044['length']+'\x20days');const _0x46c56a=await Promise['all'](_0x39c044[_0x113389(0x16e)](async _0x2ab7e2=>{const _0xd64429=_0x113389,_0x57b896=await Promise[_0xd64429(0x164)](_0x2ab7e2[_0xd64429(0x185)][_0xd64429(0x16e)](async _0x34e6b5=>{const _0x255f10=_0xd64429,_0x16a6cf=this[_0x255f10(0x1aa)](_0x34e6b5);if(_0x16a6cf===0x0)return 0x0;return _0x34e6b5[_0x255f10(0x1ba)]===_0x255f10(0x15a)?-Math['abs'](_0x16a6cf):await currencyService_1[_0x255f10(0x171)][_0x255f10(0x1c3)](_0x34e6b5[_0x255f10(0x1c8)],_0x34e6b5[_0x255f10(0x160)]);})),_0x309ac1=_0x57b896[_0xd64429(0x18e)]((_0xb1c75d,_0x44a8c0)=>_0xb1c75d+_0x44a8c0,0x0);return{'date':_0x2ab7e2['date'][_0xd64429(0x201)]()[_0xd64429(0x20b)]('T')[0x0],'amount':_0x309ac1};})),_0x5d3458=this[_0x113389(0x145)](_0x43a21c,new Date()),_0x27c85a=new Map(_0x46c56a[_0x113389(0x16e)](_0x2d489f=>[_0x2d489f['date'],_0x2d489f[_0x113389(0x1c8)]])),_0x4627be=_0x5d3458[_0x113389(0x16e)](_0x5df72a=>({'date':_0x5df72a,'amount':_0x27c85a[_0x113389(0x156)](_0x5df72a)||0x0}));return console[_0x113389(0x1b6)]('‚úÖ\x20Admin\x20statistics\x20generated\x20successfully'),console['log']('üë•\x20Total\x20users:\x20'+_0x1346fe),console[_0x113389(0x1b6)](_0x113389(0x1ec)+_0xd3cddb),console[_0x113389(0x1b6)](_0x113389(0x1f1)+_0x4627be['length']),{'totalRevenue':Math['round'](_0xbfcdbc*0x64)/0x64,'totalUsers':_0x1346fe,'totalPayments':_0xd3cddb,'averagePayment':Math[_0x113389(0x1bc)](_0x5136e7*0x64)/0x64,'dailyRevenue':_0x4627be};}async[a33_0x1d57b5(0x1d3)](_0x471b16){const _0x529499=a33_0x1d57b5,{page:_0x195832,limit:_0xec9dae,status:_0x107651,gateway:_0x5e90f9,shopId:_0x818cd8,dateFrom:_0x5c0a9f,dateTo:_0x370c8e,search:_0x49a48d}=_0x471b16,_0x4bff3d=(_0x195832-0x1)*_0xec9dae;console[_0x529499(0x1b6)]('üìã\x20Getting\x20payments\x20with\x20filters:',_0x471b16);const _0x21b9ea={};_0x107651&&(_0x21b9ea['status']=_0x107651['toUpperCase']());if(_0x5e90f9){if((0x0,gateway_1[_0x529499(0x1f2)])(_0x5e90f9)){const _0x3f5562=(0x0,gateway_1[_0x529499(0x1ad)])(_0x5e90f9);_0x3f5562&&(_0x21b9ea[_0x529499(0x151)]=_0x3f5562);}else _0x21b9ea[_0x529499(0x151)]=_0x5e90f9['toLowerCase']();}_0x818cd8&&(_0x21b9ea[_0x529499(0x1f4)]=_0x818cd8);(_0x5c0a9f||_0x370c8e)&&(_0x21b9ea[_0x529499(0x14e)]={},_0x5c0a9f&&(_0x21b9ea[_0x529499(0x14e)][_0x529499(0x188)]=new Date(_0x5c0a9f)),_0x370c8e&&(_0x21b9ea[_0x529499(0x14e)][_0x529499(0x1ab)]=new Date(_0x370c8e)));_0x49a48d&&(_0x21b9ea['OR']=[{'orderId':{'contains':_0x49a48d,'mode':_0x529499(0x198)}},{'gatewayOrderId':{'contains':_0x49a48d,'mode':_0x529499(0x198)}},{'gatewayPaymentId':{'contains':_0x49a48d,'mode':_0x529499(0x198)}},{'customerEmail':{'contains':_0x49a48d,'mode':'insensitive'}},{'customerName':{'contains':_0x49a48d,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x49a48d,'mode':_0x529499(0x198)}}},{'shop':{'username':{'contains':_0x49a48d,'mode':_0x529499(0x198)}}}]);const [_0x2e5f2c,_0x5da2df]=await Promise[_0x529499(0x164)]([database_1[_0x529499(0x1f0)][_0x529499(0x157)][_0x529499(0x19f)]({'where':_0x21b9ea,'skip':_0x4bff3d,'take':_0xec9dae,'orderBy':{'createdAt':_0x529499(0x1ac)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x529499(0x1f0)][_0x529499(0x157)][_0x529499(0x168)]({'where':_0x21b9ea})]);console[_0x529499(0x1b6)](_0x529499(0x203)+_0x2e5f2c[_0x529499(0x18c)]+_0x529499(0x204)+_0x5da2df+_0x529499(0x1c6));const _0x4e45a2=_0x2e5f2c[_0x529499(0x16e)](_0x3f3a07=>({'id':_0x3f3a07['id'],'shopId':_0x3f3a07[_0x529499(0x1f4)],'shopName':_0x3f3a07[_0x529499(0x154)][_0x529499(0x17d)],'shopUsername':_0x3f3a07['shop'][_0x529499(0x173)],'gateway':_0x3f3a07[_0x529499(0x151)],'orderId':_0x3f3a07[_0x529499(0x1cb)],'gatewayOrderId':_0x3f3a07[_0x529499(0x1a1)],'amount':_0x3f3a07['amount'],'currency':_0x3f3a07[_0x529499(0x160)],'sourceCurrency':_0x3f3a07[_0x529499(0x176)],'status':_0x3f3a07[_0x529499(0x1ba)],'usage':_0x3f3a07[_0x529499(0x202)],'externalPaymentUrl':_0x3f3a07[_0x529499(0x18d)],'gatewayPaymentId':_0x3f3a07[_0x529499(0x169)],'customerEmail':_0x3f3a07['customerEmail'],'customerName':_0x3f3a07['customerName'],'cardLast4':_0x3f3a07[_0x529499(0x192)],'paymentMethod':_0x3f3a07['paymentMethod'],'bankId':_0x3f3a07['bankId'],'remitterIban':_0x3f3a07[_0x529499(0x208)],'remitterName':_0x3f3a07[_0x529499(0x1b2)],'chargebackAmount':_0x3f3a07[_0x529499(0x1b5)],'adminNotes':_0x3f3a07[_0x529499(0x1ce)],'statusChangedBy':_0x3f3a07[_0x529499(0x152)],'statusChangedAt':_0x3f3a07[_0x529499(0x1d1)],'createdAt':_0x3f3a07[_0x529499(0x14e)],'updatedAt':_0x3f3a07[_0x529499(0x139)],'expiresAt':_0x3f3a07['expiresAt']}));return{'payments':_0x4e45a2,'pagination':{'page':_0x195832,'limit':_0xec9dae,'total':_0x5da2df,'totalPages':Math[_0x529499(0x191)](_0x5da2df/_0xec9dae)}};}async['getPaymentById'](_0x8198b6){const _0x4d18e8=a33_0x1d57b5;console['log'](_0x4d18e8(0x162)+_0x8198b6);const _0xa08670=await database_1['default'][_0x4d18e8(0x157)][_0x4d18e8(0x1c0)]({'where':{'id':_0x8198b6},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x4d18e8(0x1ac)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0xa08670)return console[_0x4d18e8(0x1b6)](_0x4d18e8(0x17c)+_0x8198b6),null;return console['log'](_0x4d18e8(0x1d2)+_0xa08670[_0x4d18e8(0x1cb)]+'\x20('+_0xa08670[_0x4d18e8(0x1ba)]+')'),{'id':_0xa08670['id'],'shopId':_0xa08670[_0x4d18e8(0x1f4)],'shopName':_0xa08670[_0x4d18e8(0x154)][_0x4d18e8(0x17d)],'shopUsername':_0xa08670[_0x4d18e8(0x154)]['username'],'gateway':_0xa08670[_0x4d18e8(0x151)],'orderId':_0xa08670[_0x4d18e8(0x1cb)],'gatewayOrderId':_0xa08670[_0x4d18e8(0x1a1)],'amount':_0xa08670[_0x4d18e8(0x1c8)],'currency':_0xa08670[_0x4d18e8(0x160)],'sourceCurrency':_0xa08670[_0x4d18e8(0x176)],'status':_0xa08670['status'],'usage':_0xa08670[_0x4d18e8(0x202)],'externalPaymentUrl':_0xa08670['externalPaymentUrl'],'gatewayPaymentId':_0xa08670[_0x4d18e8(0x169)],'customerEmail':_0xa08670[_0x4d18e8(0x199)],'customerName':_0xa08670['customerName'],'cardLast4':_0xa08670[_0x4d18e8(0x192)],'paymentMethod':_0xa08670[_0x4d18e8(0x1fc)],'bankId':_0xa08670[_0x4d18e8(0x15d)],'remitterIban':_0xa08670[_0x4d18e8(0x208)],'remitterName':_0xa08670[_0x4d18e8(0x1b2)],'chargebackAmount':_0xa08670['chargebackAmount'],'adminNotes':_0xa08670[_0x4d18e8(0x1ce)],'statusChangedBy':_0xa08670['statusChangedBy'],'statusChangedAt':_0xa08670[_0x4d18e8(0x1d1)],'createdAt':_0xa08670['createdAt'],'updatedAt':_0xa08670[_0x4d18e8(0x139)],'expiresAt':_0xa08670[_0x4d18e8(0x17e)],'webhookLogs':_0xa08670[_0x4d18e8(0x1bf)]};}async[a33_0x1d57b5(0x153)](_0x1cc688,_0x18ad50,_0x4d95d7,_0x26596f){const _0x1da95c=a33_0x1d57b5;console[_0x1da95c(0x1b6)]('üîÑ\x20Updating\x20payment\x20'+_0x1cc688+_0x1da95c(0x1fe)+_0x18ad50);const _0x45dd1f=[_0x1da95c(0x166),_0x1da95c(0x196),_0x1da95c(0x207),_0x1da95c(0x184),_0x1da95c(0x197),'REFUND',_0x1da95c(0x15a)];if(!_0x45dd1f[_0x1da95c(0x1bb)](_0x18ad50[_0x1da95c(0x1e7)]()))throw new Error(_0x1da95c(0x14b)+_0x45dd1f[_0x1da95c(0x13a)](',\x20'));const _0xec20c0=await database_1[_0x1da95c(0x1f0)][_0x1da95c(0x157)][_0x1da95c(0x1c0)]({'where':{'id':_0x1cc688},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0xec20c0)throw new Error(_0x1da95c(0x142));if(_0x18ad50[_0x1da95c(0x1e7)]()===_0x1da95c(0x15a)){if(!_0x26596f||_0x26596f<=0x0)throw new Error(_0x1da95c(0x1f6));console[_0x1da95c(0x1b6)](_0x1da95c(0x1ea)+_0x26596f+_0x1da95c(0x17a));}const _0x26e6ff={'status':_0x18ad50['toUpperCase'](),'updatedAt':new Date()};_0x4d95d7&&(_0x26e6ff[_0x1da95c(0x1ce)]=_0x4d95d7);_0x18ad50[_0x1da95c(0x1e7)]()===_0x1da95c(0x15a)&&_0x26596f&&(_0x26e6ff[_0x1da95c(0x1b5)]=_0x26596f);const _0x3868de=await database_1[_0x1da95c(0x1f0)]['payment'][_0x1da95c(0x1af)]({'where':{'id':_0x1cc688},'data':_0x26e6ff,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default'][_0x1da95c(0x13c)][_0x1da95c(0x1dd)]({'data':{'paymentId':_0x1cc688,'shopId':_0x3868de[_0x1da95c(0x1f4)],'event':_0x1da95c(0x1b4),'statusCode':0xc8,'responseBody':JSON[_0x1da95c(0x144)]({'oldStatus':_0xec20c0[_0x1da95c(0x1ba)],'newStatus':_0x18ad50[_0x1da95c(0x1e7)](),'notes':_0x4d95d7||null,'chargebackAmount':_0x26596f||null,'timestamp':new Date()[_0x1da95c(0x201)]()})}}),console[_0x1da95c(0x1b6)](_0x1da95c(0x194)+_0xec20c0[_0x1da95c(0x1cb)]+_0x1da95c(0x1c5)+_0xec20c0['status']+_0x1da95c(0x19e)+_0x18ad50['toUpperCase']()),_0x18ad50[_0x1da95c(0x1e7)]()==='CHARGEBACK'&&console[_0x1da95c(0x1b6)](_0x1da95c(0x16b)+_0x26596f+_0x1da95c(0x177)),{'id':_0x3868de['id'],'shopId':_0x3868de[_0x1da95c(0x1f4)],'shopName':_0x3868de[_0x1da95c(0x154)][_0x1da95c(0x17d)],'shopUsername':_0x3868de[_0x1da95c(0x154)]['username'],'gateway':_0x3868de[_0x1da95c(0x151)],'orderId':_0x3868de[_0x1da95c(0x1cb)],'gatewayOrderId':_0x3868de['gatewayOrderId'],'amount':_0x3868de[_0x1da95c(0x1c8)],'currency':_0x3868de['currency'],'sourceCurrency':_0x3868de[_0x1da95c(0x176)],'status':_0x3868de['status'],'usage':_0x3868de[_0x1da95c(0x202)],'externalPaymentUrl':_0x3868de[_0x1da95c(0x18d)],'gatewayPaymentId':_0x3868de[_0x1da95c(0x169)],'customerEmail':_0x3868de['customerEmail'],'customerName':_0x3868de[_0x1da95c(0x1e0)],'cardLast4':_0x3868de['cardLast4'],'paymentMethod':_0x3868de['paymentMethod'],'bankId':_0x3868de[_0x1da95c(0x15d)],'remitterIban':_0x3868de[_0x1da95c(0x208)],'remitterName':_0x3868de[_0x1da95c(0x1b2)],'chargebackAmount':_0x3868de['chargebackAmount'],'adminNotes':_0x3868de[_0x1da95c(0x1ce)],'statusChangedBy':_0x3868de[_0x1da95c(0x152)],'statusChangedAt':_0x3868de[_0x1da95c(0x1d1)],'createdAt':_0x3868de[_0x1da95c(0x14e)],'updatedAt':_0x3868de[_0x1da95c(0x139)],'expiresAt':_0x3868de[_0x1da95c(0x17e)]};}async[a33_0x1d57b5(0x180)](_0x327d34){const _0x12d284=a33_0x1d57b5,{page:_0x3080ea,limit:_0x425de1,status:_0x150c20}=_0x327d34,_0x106083=(_0x3080ea-0x1)*_0x425de1,_0x5dd0ca={};_0x150c20&&(_0x5dd0ca['status']=_0x150c20['toUpperCase']());console[_0x12d284(0x1b6)](_0x12d284(0x150),{'page':_0x3080ea,'limit':_0x425de1,'status':_0x150c20,'where':_0x5dd0ca});const [_0x35fa78,_0x40c629]=await Promise['all']([database_1[_0x12d284(0x1f0)]['shop']['findMany']({'where':_0x5dd0ca,'skip':_0x106083,'take':_0x425de1,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x12d284(0x1ac)}}),database_1['default'][_0x12d284(0x154)][_0x12d284(0x168)]({'where':_0x5dd0ca})]);console[_0x12d284(0x1b6)](_0x12d284(0x203)+_0x35fa78[_0x12d284(0x18c)]+_0x12d284(0x15e)+_0x40c629+'\x20total');const _0x12cef9=_0x35fa78[_0x12d284(0x16e)](_0x1b219e=>({'id':_0x1b219e['id'],'fullName':_0x1b219e[_0x12d284(0x17d)],'username':_0x1b219e[_0x12d284(0x173)],'telegramId':_0x1b219e[_0x12d284(0x1db)],'merchantUrl':_0x1b219e[_0x12d284(0x1fa)],'gateways':_0x1b219e[_0x12d284(0x1e2)]?JSON[_0x12d284(0x1c1)](_0x1b219e[_0x12d284(0x1e2)]):null,'gatewaySettings':_0x1b219e['gatewaySettings']?JSON[_0x12d284(0x1c1)](_0x1b219e[_0x12d284(0x1f9)]):null,'publicKey':_0x1b219e['publicKey'],'wallets':{'usdtPolygonWallet':_0x1b219e[_0x12d284(0x138)],'usdtTrcWallet':_0x1b219e[_0x12d284(0x1ae)],'usdtErcWallet':_0x1b219e[_0x12d284(0x16a)],'usdcPolygonWallet':_0x1b219e[_0x12d284(0x17b)]},'status':_0x1b219e[_0x12d284(0x1ba)],'createdAt':_0x1b219e[_0x12d284(0x14e)]}));return{'users':_0x12cef9,'pagination':{'page':_0x3080ea,'limit':_0x425de1,'total':_0x40c629,'totalPages':Math[_0x12d284(0x191)](_0x40c629/_0x425de1)}};}async['getUserById'](_0xc5e314){const _0x543b73=a33_0x1d57b5;return await this['userService'][_0x543b73(0x15b)](_0xc5e314);}async[a33_0x1d57b5(0x158)](_0x314aeb){return await this['userService']['createUser'](_0x314aeb);}async[a33_0x1d57b5(0x1e3)](_0xcc01b1,_0x330584){const _0x54b107=a33_0x1d57b5;return await this[_0x54b107(0x1f7)][_0x54b107(0x1e3)](_0xcc01b1,_0x330584);}async[a33_0x1d57b5(0x174)](_0x17b395){const _0x57e759=a33_0x1d57b5;return await this[_0x57e759(0x1f7)][_0x57e759(0x174)](_0x17b395);}async['suspendUser'](_0x2a8a9d){const _0x21a3dd=a33_0x1d57b5;console[_0x21a3dd(0x1b6)](_0x21a3dd(0x20c)+_0x2a8a9d);const _0x42a2c1=await database_1[_0x21a3dd(0x1f0)][_0x21a3dd(0x154)]['findUnique']({'where':{'id':_0x2a8a9d},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x42a2c1)throw new Error(_0x21a3dd(0x1cf));if(_0x42a2c1[_0x21a3dd(0x1ba)]==='SUSPENDED')throw new Error(_0x21a3dd(0x16f));const _0x30671e=await this[_0x21a3dd(0x1f7)]['updateUser'](_0x2a8a9d,{'status':_0x21a3dd(0x182)});return console[_0x21a3dd(0x1b6)]('‚úÖ\x20User\x20'+_0x42a2c1[_0x21a3dd(0x173)]+_0x21a3dd(0x1b8)),_0x30671e;}async[a33_0x1d57b5(0x1a3)](_0x27ecb0){const _0x51526a=a33_0x1d57b5;console[_0x51526a(0x1b6)]('‚úÖ\x20Activating\x20user:\x20'+_0x27ecb0);const _0x26341c=await database_1[_0x51526a(0x1f0)][_0x51526a(0x154)][_0x51526a(0x1c0)]({'where':{'id':_0x27ecb0},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x26341c)throw new Error(_0x51526a(0x1cf));if(_0x26341c[_0x51526a(0x1ba)]==='ACTIVE')throw new Error(_0x51526a(0x1a9));const _0x3a409c=await this['userService']['updateUser'](_0x27ecb0,{'status':_0x51526a(0x1d4)});return console['log'](_0x51526a(0x1da)+_0x26341c['username']+'\x20activated\x20successfully'),_0x3a409c;}}exports[a33_0x1d57b5(0x148)]=AdminService;function a33_0x4c95(){const _0x3f1e8f=['‚úÖ\x20Marked\x20','AdminService','‚úÖ\x20Returning\x20','__esModule','Invalid\x20status.\x20Valid\x20statuses:\x20','üí∏\x20Total\x20Payout:\x20','üìÖ\x20This\x20Month:\x20','createdAt','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','üìã\x20Getting\x20users\x20with\x20filters:','gateway','statusChangedBy','updatePaymentStatus','shop','8222335gAZyCi','get','payment','createUser','419raKxLq','CHARGEBACK','getUserById','abs','bankId','\x20users\x20out\x20of\x20','‚úÖ\x20Payout\x20created\x20successfully:\x20','currency','availableBalance','üîç\x20Getting\x20payment\x20by\x20ID:\x20','üí∞\x20Found\x20','all','\x20USDT\x20after\x20commission)','PENDING','from','count','gatewayPaymentId','usdtErcWallet','üí∏\x20Chargeback\x20penalty:\x20','amountUSDT','markPaymentsAsPaidOut','map','User\x20is\x20already\x20suspended','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','currencyService','REFUND','username','deleteUser','3SHDEWX','sourceCurrency','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','Shop\x20not\x20found','1547784pkYKkD','\x20USDT\x20(penalty\x20amount)','usdcPolygonWallet','‚ùå\x20Payment\x20not\x20found:\x20','name','expiresAt','payoutDelay','getAllUsers','üè™\x20Found\x20','SUSPENDED','‚úÖ\x20Payout\x20','EXPIRED','payments','4348pQRSkn','paidAt','gte','totalAmountAfterCommissionUSDT','\x20days)','entries','length','externalPaymentUrl','reduce','\x20merchants\x20with\x20eligible\x20PAID\x20payments','getGatewaySettings','ceil','cardLast4','COMPLETED','‚úÖ\x20Payment\x20','toFixed','PROCESSING','FAILED','insensitive','customerEmail','10xagZsD','3136990RFhsIf','sort','txid','\x20to\x20','findMany','updateMany','gatewayOrderId','üí∞\x20Total\x20amount:\x20','activateUser','‚úÖ\x20Found\x20payout:\x20','getFullYear','totalAmountUSDT','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','./currencyService','User\x20is\x20already\x20active','calculateEffectiveAmount','lte','desc','getGatewayNameById','usdtTrcWallet','update','merchantPaid','notes','remitterName','calculateAmountAfterCommission','status_update','chargebackAmount','log','set','\x20suspended\x20successfully','8365158wTcFiI','status','includes','round','30d','üí∞\x20Available\x20Balance:\x20','webhookLogs','findUnique','parse','getDate','convertToUSDT','üíµ\x20Total\x20revenue:\x20','\x20status\x20updated\x20from\x20','\x20total','__importDefault','amount','\x20USDT','isEligibleForPayout','orderId','error','size','adminNotes','User\x20not\x20found','commission','statusChangedAt','‚úÖ\x20Found\x20payment:\x20','getAllPayments','ACTIVE','Payout\x20not\x20found','üí∏\x20Creating\x20payout\x20for\x20shop\x20','getPeriodDays','\x20USDT\x20via\x20','getAllPayouts','‚úÖ\x20User\x20','telegram','24rthYIv','create','network','payout','customerName','UserService','paymentGateways','updateUser','./userService','12KPEcGu','getPayoutStats','toUpperCase','amountAfterCommissionUSDT','sendPayoutNotification','üí∏\x20Chargeback\x20amount:\x20','4168656wthzUX','üí≥\x20Total\x20payments:\x20','90d','‚úÖ\x20Payout\x20statistics\x20calculated:','slice','default','üìä\x20Daily\x20revenue\x20entries:\x20','isValidGatewayId','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','shopId','../types/gateway','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','userService','setDate','gatewaySettings','shopUrl','createPayout','paymentMethod','completed','\x20status\x20to:\x20','awaitingPayout','has','toISOString','usage','üìä\x20Found\x20','\x20payments\x20out\x20of\x20','deletePayout','getMonth','PAID','remitterIban','\x20deleted\x20successfully','./telegramBotService','split','üö´\x20Suspending\x20user:\x20','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','\x20merchants\x20out\x20of\x20','usdtPolygonWallet','updatedAt','join','1176248VgSSzB','webhookLog',',\x20amount:\x20','totalPayout','getPayoutById','toLowerCase','getMerchantsAwaitingPayout','Payment\x20not\x20found','charAt','stringify','generateDateRange','push'];a33_0x4c95=function(){return _0x3f1e8f;};return a33_0x4c95();}