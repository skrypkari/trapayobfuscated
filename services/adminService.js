'use strict';const a35_0x109166=a35_0x365e;(function(_0xfee328,_0x16320e){const _0x1b6006=a35_0x365e,_0x4482ca=_0xfee328();while(!![]){try{const _0x1b0430=-parseInt(_0x1b6006(0x159))/0x1*(parseInt(_0x1b6006(0x1f7))/0x2)+-parseInt(_0x1b6006(0x163))/0x3+parseInt(_0x1b6006(0x1dd))/0x4*(-parseInt(_0x1b6006(0x170))/0x5)+parseInt(_0x1b6006(0x20e))/0x6*(-parseInt(_0x1b6006(0x162))/0x7)+-parseInt(_0x1b6006(0x182))/0x8*(parseInt(_0x1b6006(0x19d))/0x9)+-parseInt(_0x1b6006(0x219))/0xa+parseInt(_0x1b6006(0x183))/0xb*(parseInt(_0x1b6006(0x185))/0xc);if(_0x1b0430===_0x16320e)break;else _0x4482ca['push'](_0x4482ca['shift']());}catch(_0x1a6a56){_0x4482ca['push'](_0x4482ca['shift']());}}}(a35_0x5cc2,0x35633));function a35_0x5cc2(){const _0x233f88=['COMPLETED','KLYME\x20EU','deleteUser','lte','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','randomBytes','💸\x20CHARGEBACK\x20penalty:\x20-','paidAt','totalPayments','totalPayout','\x20->\x20','createUser','toISOString','\x20status:\x20','sk_','not\x20set','parse','\x20USDT\x20(','Shop\x20not\x20found','1300184jXYaxX','\x20\x20\x20🖥️\x20User\x20Agent:\x20','💰\x20Current\x20shop\x20balance:\x20','📊\x20Merchant\x20statistics\x20calculated:','count','\x20for\x20shop\x20','payment','customerName','\x20USDT)','getPayoutStats','statusChangedBy','\x20USDT','KLYME\x20DE','\x20\x20\x20📅\x20This\x20month:\x20','usdtPolygonWallet','ACTIVE','gatewayOrderId','usdtTrcWallet','findMany','awaitingPayout','SUSPENDED','deletePayout','publicKey','getPaymentById','update','chargebackAmount','64KFgSCi','\x20merchants\x20with\x20positive\x20balance','asc','Error\x20processing\x20payment\x20','telegram','usdcPolygonWallet','password','pk_','activateUser','wallets','\x20USDT\x20to\x20balance','toFixed','gatewaySettings','\x20\x20\x20Balance:\x20','values','totalPaidOut','totalCommissionRate','✅\x20Payout\x20created:\x20','externalPaymentUrl','turnover','ceil','getAllPayouts','suspendUser','297546sCjQPY','getAllPayments','gte','\x20\x20\x20💵\x20Available\x20balance:\x20','name','adminNotes','gateway','90d','Payment\x20not\x20found','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','periodFrom','3067190GxpZii','test_gateway','fullName','year','customerUa','turnoverUSDT','defineProperty','customerCountry','month','\x20merchants,\x20','getMerchantStatistics','findUnique','AdminService','updatePaymentStatus','payout','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','getFullYear','\x20became\x20PAID:\x20+','paymentsCount','hash','shopUrl','getAllUsers','insensitive','dateTo','thisMonth','10254LFNyFV','_count','log','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','updatedAt','30d','aggregate','network','string','21Hcigul','1264887OFerHy','reduce','\x20\x20\x20💰\x20Total\x20turnover:\x20','default','delete','../config/database','stringify','date','txid','map','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','amount','averageCommissionRate','5CKVKLF','PAID','split','\x20balance\x20updated:','whiteUrl','customerIp','\x20USDT\x20total','failureMessage','notes','usdtErcWallet','failUrl','__esModule','orderId','\x20USDT\x20from\x20balance','getMonth','findFirst','\x20balance\x20updated:\x20','Username\x20already\x20exists','8uhqADL','20145829cCDOdv','📊\x20Calculating\x20payout\x20statistics...','12QdGXKF','toUpperCase','periodTo','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','availableBalance','admin','gateways','bcryptjs','KLYME\x20GB','gatewayEarnings','crypto','balance','toLowerCase','📊\x20Merchants\x20awaiting\x20payout:\x20','createPayout','💰\x20Creating\x20payout\x20for\x20shop\x20','dateFrom','shopId','\x20\x20\x20Payout\x20amount:\x20','hex','desc','getSystemStatistics','📊\x20Payout\x20statistics\x20calculated:','averageCheckUSDT','742221wcYXEp','telegramId','getGatewayDisplayName','$transaction','\x20\x20\x20🌍\x20Country:\x20','commissionUSDT','set','sort','💰\x20Found\x20','localeCompare','\x20USDT,\x20Requested:\x20','merchantEarningsUSDT','CHARGEBACK','\x20\x20\x20🌐\x20IP:\x20','merchantUrl','amountUSDT','round','createdAt','💰\x20Shop\x20','customerEmail','username','convertToUSDT','Noda','\x20USDT\x20(total\x20paid\x20to\x20merchants)','_sum','\x20to\x20','merchantEarnings','\x20\x20\x20💰\x20Total\x20payout:\x20','period','💰\x20Payment\x20','currency','getTime','totalTurnover','status','shop','custom','currencyService','updateCustomerData','all','Plisio','getPayoutById','paymentGateways','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','toString','length'];a35_0x5cc2=function(){return _0x233f88;};return a35_0x5cc2();}var __importDefault=this&&this['__importDefault']||function(_0x2636f9){const _0x354860=a35_0x365e;return _0x2636f9&&_0x2636f9[_0x354860(0x17b)]?_0x2636f9:{'default':_0x2636f9};};Object[a35_0x109166(0x21f)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x109166(0x168))),bcryptjs_1=__importDefault(require(a35_0x109166(0x18c))),crypto_1=__importDefault(require(a35_0x109166(0x18f))),currencyService_1=require('./currencyService');function a35_0x365e(_0x52ffa1,_0x3d13e7){const _0x5cc25a=a35_0x5cc2();return a35_0x365e=function(_0x365e49,_0x1712fb){_0x365e49=_0x365e49-0x156;let _0x140cee=_0x5cc25a[_0x365e49];return _0x140cee;},a35_0x365e(_0x52ffa1,_0x3d13e7);}class AdminService{async[a35_0x109166(0x1e6)](){const _0x47a6ef=a35_0x109166;console[_0x47a6ef(0x15b)](_0x47a6ef(0x184));const _0x1fb2a1=await database_1[_0x47a6ef(0x166)][_0x47a6ef(0x1bf)][_0x47a6ef(0x15f)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x47a6ef(0x1ec)}}),_0x270ec2=new Date(),_0xd2fae0=new Date(_0x270ec2['getFullYear'](),_0x270ec2[_0x47a6ef(0x17e)](),0x1),_0x286747=new Date(_0x270ec2[_0x47a6ef(0x229)](),_0x270ec2[_0x47a6ef(0x17e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x10b760=await database_1[_0x47a6ef(0x166)][_0x47a6ef(0x227)][_0x47a6ef(0x15f)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0xd2fae0,'lte':_0x286747},'status':_0x47a6ef(0x1ca)}}),_0x5c8328=_0x1fb2a1[_0x47a6ef(0x1b5)][_0x47a6ef(0x206)]||0x0,_0x479025=_0x1fb2a1[_0x47a6ef(0x1b5)][_0x47a6ef(0x190)]||0x0,_0x5ccc01=_0x10b760[_0x47a6ef(0x1b5)]['amount']||0x0,_0x111d93={'totalPayout':Math[_0x47a6ef(0x1ad)](_0x5c8328*0x64)/0x64,'awaitingPayout':Math['round'](_0x479025*0x64)/0x64,'thisMonth':Math[_0x47a6ef(0x1ad)](_0x5ccc01*0x64)/0x64,'availableBalance':Math['round'](_0x479025*0x64)/0x64};return console[_0x47a6ef(0x15b)](_0x47a6ef(0x19b)),console['log'](_0x47a6ef(0x1b8)+_0x111d93[_0x47a6ef(0x1d3)]+_0x47a6ef(0x1b4)),console[_0x47a6ef(0x15b)](_0x47a6ef(0x16d)+_0x111d93[_0x47a6ef(0x1f0)]+'\x20USDT\x20(total\x20merchant\x20balances)'),console[_0x47a6ef(0x15b)](_0x47a6ef(0x211)+_0x111d93[_0x47a6ef(0x189)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x47a6ef(0x15b)](_0x47a6ef(0x1ea)+_0x111d93[_0x47a6ef(0x158)]+_0x47a6ef(0x1e8)),_0x111d93;}async[a35_0x109166(0x1c2)](_0x38b678,_0xa8c6dc){const _0x4421ea=a35_0x109166;console[_0x4421ea(0x15b)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x38b678+':',_0xa8c6dc);const _0x23b622=await database_1[_0x4421ea(0x166)]['payment']['findUnique']({'where':{'id':_0x38b678},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x23b622)throw new Error(_0x4421ea(0x216));const _0x15ac1d={};_0xa8c6dc[_0x4421ea(0x220)]!==undefined&&(_0x15ac1d['customerCountry']=_0xa8c6dc[_0x4421ea(0x220)]||null);_0xa8c6dc[_0x4421ea(0x175)]!==undefined&&(_0x15ac1d[_0x4421ea(0x175)]=_0xa8c6dc[_0x4421ea(0x175)]||null);_0xa8c6dc[_0x4421ea(0x21d)]!==undefined&&(_0x15ac1d[_0x4421ea(0x21d)]=_0xa8c6dc[_0x4421ea(0x21d)]||null);const _0x30665b=await database_1['default'][_0x4421ea(0x1e3)]['update']({'where':{'id':_0x38b678},'data':{..._0x15ac1d,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x4421ea(0x228)+_0x38b678),console[_0x4421ea(0x15b)](_0x4421ea(0x1a1)+_0x23b622[_0x4421ea(0x220)]+_0x4421ea(0x1d4)+_0x30665b[_0x4421ea(0x220)]),console[_0x4421ea(0x15b)](_0x4421ea(0x1aa)+_0x23b622['customerIp']+'\x20->\x20'+_0x30665b[_0x4421ea(0x175)]),console['log'](_0x4421ea(0x1de)+(_0x23b622[_0x4421ea(0x21d)]?_0x4421ea(0x1a3):_0x4421ea(0x1d9))+_0x4421ea(0x1d4)+(_0x30665b[_0x4421ea(0x21d)]?_0x4421ea(0x1a3):'not\x20set')),_0x30665b;}async[a35_0x109166(0x19a)](_0x3b0e37){const _0x2f97be=a35_0x109166,_0x4d84ef=new Date();let _0x497595;switch(_0x3b0e37){case'7d':_0x497595=new Date(_0x4d84ef[_0x2f97be(0x1bc)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2f97be(0x15e):_0x497595=new Date(_0x4d84ef[_0x2f97be(0x1bc)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2f97be(0x215):_0x497595=new Date(_0x4d84ef['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x497595=new Date(_0x4d84ef['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x451286,_0x27a6a7,_0x3e4ce3,_0x47644c,_0x314f08,_0x2b3374]=await Promise[_0x2f97be(0x1c3)]([database_1['default'][_0x2f97be(0x1bf)][_0x2f97be(0x1e1)](),database_1[_0x2f97be(0x166)][_0x2f97be(0x1bf)][_0x2f97be(0x1e1)]({'where':{'status':_0x2f97be(0x1ec)}}),database_1[_0x2f97be(0x166)][_0x2f97be(0x1e3)][_0x2f97be(0x1e1)]({'where':{'createdAt':{'gte':_0x497595},'gateway':{'not':_0x2f97be(0x21a)}}}),database_1[_0x2f97be(0x166)][_0x2f97be(0x1e3)][_0x2f97be(0x1e1)]({'where':{'status':_0x2f97be(0x171),'createdAt':{'gte':_0x497595},'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x2f97be(0x1e3)][_0x2f97be(0x1ef)]({'where':{'status':'PAID','createdAt':{'gte':_0x497595},'gateway':{'not':_0x2f97be(0x21a)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x2f97be(0x166)][_0x2f97be(0x1e3)][_0x2f97be(0x1ef)]({'where':{'gateway':{'not':_0x2f97be(0x21a)}},'take':0xa,'orderBy':{'createdAt':_0x2f97be(0x199)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x2bc0c0=0x0;for(const _0x1c213f of _0x314f08){const _0x3a1650=await currencyService_1['currencyService']['convertToUSDT'](_0x1c213f[_0x2f97be(0x16e)],_0x1c213f['currency']);_0x2bc0c0+=_0x3a1650;}const _0x2f106d=_0x3e4ce3>0x0?_0x47644c/_0x3e4ce3*0x64:0x0;return{'totalShops':_0x451286,'activeShops':_0x27a6a7,'totalPayments':_0x3e4ce3,'successfulPayments':_0x47644c,'totalRevenue':Math[_0x2f97be(0x1ad)](_0x2bc0c0*0x64)/0x64,'conversionRate':Math[_0x2f97be(0x1ad)](_0x2f106d*0x64)/0x64,'recentPayments':_0x2b3374[_0x2f97be(0x16c)](_0x1add66=>({'id':_0x1add66['id'],'amount':_0x1add66[_0x2f97be(0x16e)],'currency':_0x1add66[_0x2f97be(0x1bb)],'status':_0x1add66[_0x2f97be(0x1be)],'gateway':_0x1add66[_0x2f97be(0x214)],'shop':_0x1add66[_0x2f97be(0x1bf)],'createdAt':_0x1add66[_0x2f97be(0x1ae)]}))};}async[a35_0x109166(0x223)](_0x416bfb){const _0x630ae8=a35_0x109166;console['log'](_0x630ae8(0x15c),_0x416bfb);let _0x5822aa,_0x5a5a58=new Date();if(_0x416bfb[_0x630ae8(0x1b9)]===_0x630ae8(0x1c0)&&_0x416bfb['dateFrom']&&_0x416bfb['dateTo'])_0x5822aa=new Date(_0x416bfb[_0x630ae8(0x195)]),_0x5a5a58=new Date(_0x416bfb[_0x630ae8(0x157)]);else{const _0x3a56e8=new Date();switch(_0x416bfb[_0x630ae8(0x1b9)]){case'week':_0x5822aa=new Date(_0x3a56e8[_0x630ae8(0x1bc)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x630ae8(0x221):_0x5822aa=new Date(_0x3a56e8[_0x630ae8(0x1bc)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x630ae8(0x21c):_0x5822aa=new Date(_0x3a56e8['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x630ae8(0x1c3):default:_0x5822aa=new Date('2020-01-01');break;}}console[_0x630ae8(0x15b)]('📅\x20Period:\x20'+_0x5822aa[_0x630ae8(0x1d6)]()+_0x630ae8(0x1b6)+_0x5a5a58[_0x630ae8(0x1d6)]());const _0x33d213={'status':'PAID','gateway':{'not':_0x630ae8(0x21a)},'paidAt':{'gte':_0x5822aa,'lte':_0x5a5a58}};_0x416bfb[_0x630ae8(0x196)]&&(_0x33d213[_0x630ae8(0x196)]=_0x416bfb[_0x630ae8(0x196)]);const _0x37038a=await database_1[_0x630ae8(0x166)][_0x630ae8(0x1e3)]['findMany']({'where':_0x33d213,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x630ae8(0x15b)](_0x630ae8(0x1a5)+_0x37038a[_0x630ae8(0x1c9)]+'\x20paid\x20payments\x20for\x20analysis');let _0x942fde=0x0,_0x495100=0x0,_0x5e8c4a=0x0;const _0x42a35d={},_0x59f6c8={},_0x4ca06d={};for(const _0x149bca of _0x37038a){try{const _0x346ea3=await currencyService_1[_0x630ae8(0x1c1)][_0x630ae8(0x1b2)](_0x149bca[_0x630ae8(0x16e)],_0x149bca[_0x630ae8(0x1bb)]);let _0x28dafa={};if(_0x149bca[_0x630ae8(0x1bf)][_0x630ae8(0x203)])try{_0x28dafa=JSON['parse'](_0x149bca['shop'][_0x630ae8(0x203)]);}catch(_0x37e3d8){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x149bca['shopId']+':',_0x37e3d8);}const _0x44ceae=_0x28dafa['commission']||0xa,_0x12b849=_0x346ea3*(_0x44ceae/0x64),_0x2ac3a6=_0x346ea3-_0x12b849;_0x942fde+=_0x346ea3,_0x495100+=_0x2ac3a6,_0x5e8c4a+=_0x12b849;!_0x42a35d[_0x149bca[_0x630ae8(0x214)]]&&(_0x42a35d[_0x149bca[_0x630ae8(0x214)]]={'gateway':_0x149bca[_0x630ae8(0x214)],'gatewayDisplayName':this[_0x630ae8(0x19f)](_0x149bca[_0x630ae8(0x214)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x42a35d[_0x149bca[_0x630ae8(0x214)]][_0x630ae8(0x22b)]++,_0x42a35d[_0x149bca[_0x630ae8(0x214)]][_0x630ae8(0x21e)]+=_0x346ea3,_0x42a35d[_0x149bca[_0x630ae8(0x214)]][_0x630ae8(0x1a2)]+=_0x12b849,_0x42a35d[_0x149bca[_0x630ae8(0x214)]][_0x630ae8(0x1a8)]+=_0x2ac3a6,_0x42a35d[_0x149bca[_0x630ae8(0x214)]]['totalCommissionRate']+=_0x44ceae;!_0x416bfb['shopId']&&(!_0x59f6c8[_0x149bca['shopId']]&&(_0x59f6c8[_0x149bca[_0x630ae8(0x196)]]={'shopId':_0x149bca['shopId'],'shopName':_0x149bca[_0x630ae8(0x1bf)]['name'],'shopUsername':_0x149bca[_0x630ae8(0x1bf)][_0x630ae8(0x1b1)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x59f6c8[_0x149bca[_0x630ae8(0x196)]][_0x630ae8(0x22b)]++,_0x59f6c8[_0x149bca[_0x630ae8(0x196)]]['turnoverUSDT']+=_0x346ea3,_0x59f6c8[_0x149bca[_0x630ae8(0x196)]][_0x630ae8(0x1a2)]+=_0x12b849,_0x59f6c8[_0x149bca[_0x630ae8(0x196)]]['merchantEarningsUSDT']+=_0x2ac3a6);const _0x256c17=_0x149bca['paidAt'][_0x630ae8(0x1d6)]()[_0x630ae8(0x172)]('T')[0x0];!_0x4ca06d[_0x256c17]&&(_0x4ca06d[_0x256c17]={'date':_0x256c17,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4ca06d[_0x256c17][_0x630ae8(0x20a)]+=_0x346ea3,_0x4ca06d[_0x256c17]['merchantEarnings']+=_0x2ac3a6,_0x4ca06d[_0x256c17][_0x630ae8(0x18e)]+=_0x12b849,_0x4ca06d[_0x256c17][_0x630ae8(0x22b)]++;}catch(_0x4a275d){console['error'](_0x630ae8(0x1fa)+_0x149bca['id']+':',_0x4a275d);}}Object[_0x630ae8(0x205)](_0x42a35d)['forEach'](_0x3f4e13=>{const _0x419367=_0x630ae8;_0x3f4e13[_0x419367(0x16f)]=_0x3f4e13[_0x419367(0x22b)]>0x0?_0x3f4e13[_0x419367(0x207)]/_0x3f4e13[_0x419367(0x22b)]:0x0,delete _0x3f4e13[_0x419367(0x207)];}),Object[_0x630ae8(0x205)](_0x59f6c8)['forEach'](_0x4604fc=>{const _0x6779cb=_0x630ae8;_0x4604fc[_0x6779cb(0x19c)]=_0x4604fc[_0x6779cb(0x22b)]>0x0?_0x4604fc[_0x6779cb(0x21e)]/_0x4604fc[_0x6779cb(0x22b)]:0x0;});let _0x58b67d=0x0;if(_0x416bfb[_0x630ae8(0x196)]){const _0x50175c=await database_1['default'][_0x630ae8(0x227)][_0x630ae8(0x1ef)]({'where':{'shopId':_0x416bfb[_0x630ae8(0x196)],'status':_0x630ae8(0x1ca),'createdAt':{'gte':_0x5822aa,'lte':_0x5a5a58}},'select':{'amount':!![]}});_0x58b67d=_0x50175c[_0x630ae8(0x164)]((_0x123fcd,_0x356706)=>_0x123fcd+_0x356706[_0x630ae8(0x16e)],0x0);}const _0x79360f=_0x37038a[_0x630ae8(0x1c9)],_0x5e1fed=_0x37038a[_0x630ae8(0x1c9)],_0x5e71eb=_0x79360f>0x0?_0x942fde/_0x79360f:0x0,_0x19617e=0x64,_0x25d242=Math[_0x630ae8(0x20b)]((_0x5a5a58[_0x630ae8(0x1bc)]()-_0x5822aa[_0x630ae8(0x1bc)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5014dc={'totalTurnover':Math['round'](_0x942fde*0x64)/0x64,'merchantEarnings':Math[_0x630ae8(0x1ad)](_0x495100*0x64)/0x64,'gatewayEarnings':Math[_0x630ae8(0x1ad)](_0x5e8c4a*0x64)/0x64,'totalPaidOut':Math[_0x630ae8(0x1ad)](_0x58b67d*0x64)/0x64,'averageCheck':Math['round'](_0x5e71eb*0x64)/0x64,'totalPayments':_0x79360f,'successfulPayments':_0x5e1fed,'conversionRate':_0x19617e,'gatewayBreakdown':Object[_0x630ae8(0x205)](_0x42a35d)[_0x630ae8(0x16c)](_0x2d5778=>({..._0x2d5778,'turnoverUSDT':Math['round'](_0x2d5778[_0x630ae8(0x21e)]*0x64)/0x64,'commissionUSDT':Math[_0x630ae8(0x1ad)](_0x2d5778[_0x630ae8(0x1a2)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x630ae8(0x1ad)](_0x2d5778['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x2d5778[_0x630ae8(0x16f)]*0x64)/0x64})),'merchantBreakdown':_0x416bfb['shopId']?undefined:Object[_0x630ae8(0x205)](_0x59f6c8)[_0x630ae8(0x16c)](_0x25f3fe=>({..._0x25f3fe,'turnoverUSDT':Math[_0x630ae8(0x1ad)](_0x25f3fe['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x25f3fe['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x25f3fe[_0x630ae8(0x1a8)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x25f3fe['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x630ae8(0x1ad)](_0x25f3fe[_0x630ae8(0x19c)]*0x64)/0x64})),'dailyData':Object[_0x630ae8(0x205)](_0x4ca06d)['map'](_0x340e5a=>({..._0x340e5a,'turnover':Math['round'](_0x340e5a['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x630ae8(0x1ad)](_0x340e5a[_0x630ae8(0x1b7)]*0x64)/0x64,'gatewayEarnings':Math[_0x630ae8(0x1ad)](_0x340e5a[_0x630ae8(0x18e)]*0x64)/0x64}))[_0x630ae8(0x1a4)]((_0x2fa81f,_0x4d780e)=>_0x2fa81f[_0x630ae8(0x16a)][_0x630ae8(0x1a6)](_0x4d780e[_0x630ae8(0x16a)])),'periodInfo':{'from':_0x5822aa,'to':_0x5a5a58,'periodType':_0x416bfb[_0x630ae8(0x1b9)]||'custom','daysCount':_0x25d242}};return console[_0x630ae8(0x15b)](_0x630ae8(0x1e0)),console['log'](_0x630ae8(0x165)+_0x5014dc[_0x630ae8(0x1bd)]+_0x630ae8(0x1e8)),console['log'](_0x630ae8(0x188)+_0x5014dc[_0x630ae8(0x1b7)]+_0x630ae8(0x1e8)),console['log'](_0x630ae8(0x217)+_0x5014dc['gatewayEarnings']+_0x630ae8(0x1e8)),console[_0x630ae8(0x15b)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x5014dc[_0x630ae8(0x1d2)]),_0x5014dc;}[a35_0x109166(0x19f)](_0x3c4c64){const _0xad867b=a35_0x109166,_0xc77c41={'test_gateway':'Test\x20Gateway','plisio':_0xad867b(0x1c4),'rapyd':'Rapyd','noda':_0xad867b(0x1b3),'cointopay':'CoinToPay','klyme_eu':_0xad867b(0x1cb),'klyme_gb':_0xad867b(0x18d),'klyme_de':_0xad867b(0x1e9)};return _0xc77c41[_0x3c4c64]||_0x3c4c64;}async['getMerchantsAwaitingPayout'](_0x4f0a03){const _0x41f2b3=a35_0x109166,{page:_0x2025a7,limit:_0x42403b,minAmount:_0x4d2b0c,search:_0x39ba97}=_0x4f0a03,_0x3790d8=(_0x2025a7-0x1)*_0x42403b;console[_0x41f2b3(0x15b)](_0x41f2b3(0x1c7),_0x4f0a03);const _0x4dddec={'balance':{'gt':0x0},'status':_0x41f2b3(0x1ec)};_0x4d2b0c&&(_0x4dddec[_0x41f2b3(0x190)][_0x41f2b3(0x210)]=_0x4d2b0c);_0x39ba97&&(_0x4dddec['OR']=[{'name':{'contains':_0x39ba97,'mode':_0x41f2b3(0x156)}},{'username':{'contains':_0x39ba97,'mode':'insensitive'}}]);const [_0x7cf5a6,_0x373355]=await Promise[_0x41f2b3(0x1c3)]([database_1[_0x41f2b3(0x166)][_0x41f2b3(0x1bf)][_0x41f2b3(0x1ef)]({'where':_0x4dddec,'skip':_0x3790d8,'take':_0x42403b,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x41f2b3(0x166)][_0x41f2b3(0x1bf)][_0x41f2b3(0x1e1)]({'where':_0x4dddec})]);console['log'](_0x41f2b3(0x1a5)+_0x7cf5a6['length']+_0x41f2b3(0x1f8));const _0x34a35f=await Promise['all'](_0x7cf5a6[_0x41f2b3(0x16c)](async _0x4d7cd7=>{const _0x266824=_0x41f2b3,[_0x2d0fc2,_0x252203,_0x3d07a3]=await Promise[_0x266824(0x1c3)]([database_1[_0x266824(0x166)]['payment'][_0x266824(0x1e1)]({'where':{'shopId':_0x4d7cd7['id'],'status':_0x266824(0x171),'amountUSDT':{'not':null}}}),database_1['default'][_0x266824(0x1e3)][_0x266824(0x17f)]({'where':{'shopId':_0x4d7cd7['id'],'status':_0x266824(0x171),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x266824(0x1f9)},'select':{'paidAt':!![]}}),database_1['default'][_0x266824(0x1e3)]['groupBy']({'by':['gateway'],'where':{'shopId':_0x4d7cd7['id'],'status':_0x266824(0x171),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x5210a9=_0x3d07a3[_0x266824(0x16c)](_0x5a619c=>({'gateway':_0x5a619c[_0x266824(0x214)],'count':_0x5a619c[_0x266824(0x15a)]['id'],'amountUSDT':_0x5a619c[_0x266824(0x1b5)]['amountUSDT']||0x0,'amountAfterCommissionUSDT':_0x5a619c['_sum']['amountUSDT']||0x0,'commission':0x0}));return{'id':_0x4d7cd7['id'],'fullName':_0x4d7cd7['name'],'username':_0x4d7cd7[_0x266824(0x1b1)],'telegramId':_0x4d7cd7[_0x266824(0x1fb)],'merchantUrl':_0x4d7cd7['shopUrl'],'wallets':{'usdtPolygonWallet':_0x4d7cd7['usdtPolygonWallet'],'usdtTrcWallet':_0x4d7cd7[_0x266824(0x1ee)],'usdtErcWallet':_0x4d7cd7[_0x266824(0x179)],'usdcPolygonWallet':_0x4d7cd7['usdcPolygonWallet']},'totalAmountUSDT':_0x4d7cd7[_0x266824(0x190)],'totalAmountAfterCommissionUSDT':_0x4d7cd7[_0x266824(0x190)],'paymentsCount':_0x2d0fc2,'oldestPaymentDate':_0x252203?.[_0x266824(0x1d1)]||_0x4d7cd7['createdAt'],'gatewayBreakdown':_0x5210a9};})),_0x43aeb2=_0x7cf5a6['reduce']((_0x1fef2b,_0x16d1fe)=>_0x1fef2b+_0x16d1fe[_0x41f2b3(0x190)],0x0),_0x395189=_0x43aeb2;return console['log'](_0x41f2b3(0x192)+_0x373355+_0x41f2b3(0x222)+Math[_0x41f2b3(0x1ad)](_0x395189*0x64)/0x64+_0x41f2b3(0x176)),{'merchants':_0x34a35f,'pagination':{'page':_0x2025a7,'limit':_0x42403b,'total':_0x373355,'totalPages':Math[_0x41f2b3(0x20b)](_0x373355/_0x42403b)},'summary':{'totalMerchants':_0x373355,'totalAmountUSDT':Math['round'](_0x43aeb2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x41f2b3(0x1ad)](_0x395189*0x64)/0x64}};}async[a35_0x109166(0x193)](_0xb6ceaa){const _0x51f933=a35_0x109166,{shopId:_0x3df281,amount:_0x199eca,network:_0x301a25,notes:_0x304dca,periodFrom:_0x4589b2,periodTo:_0x563387}=_0xb6ceaa,_0x2a6a86=await database_1[_0x51f933(0x166)]['$transaction'](async _0x432029=>{const _0x28ac64=_0x51f933,_0x51146a=await _0x432029[_0x28ac64(0x1bf)][_0x28ac64(0x224)]({'where':{'id':_0x3df281},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x51146a)throw new Error(_0x28ac64(0x1dc));console[_0x28ac64(0x15b)](_0x28ac64(0x194)+_0x51146a['username']+':'),console[_0x28ac64(0x15b)]('\x20\x20\x20Current\x20balance:\x20'+_0x51146a[_0x28ac64(0x190)][_0x28ac64(0x202)](0x6)+'\x20USDT'),console[_0x28ac64(0x15b)](_0x28ac64(0x197)+_0x199eca[_0x28ac64(0x202)](0x6)+_0x28ac64(0x1e8)),console['log']('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x51146a[_0x28ac64(0x206)][_0x28ac64(0x202)](0x6)+_0x28ac64(0x1e8));if(_0x51146a[_0x28ac64(0x190)]<_0x199eca)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x51146a[_0x28ac64(0x190)][_0x28ac64(0x202)](0x6)+_0x28ac64(0x1a7)+_0x199eca['toFixed'](0x6)+_0x28ac64(0x1e8));const _0x33c12c=await _0x432029['payout']['create']({'data':{'shopId':_0x3df281,'amount':_0x199eca,'network':_0x301a25,'status':_0x28ac64(0x1ca),'notes':_0x304dca,'periodFrom':_0x4589b2?new Date(_0x4589b2):null,'periodTo':_0x563387?new Date(_0x563387):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x5af8f6=_0x51146a[_0x28ac64(0x190)]-_0x199eca,_0x183765=_0x51146a[_0x28ac64(0x206)]+_0x199eca;return await _0x432029[_0x28ac64(0x1bf)][_0x28ac64(0x1f5)]({'where':{'id':_0x3df281},'data':{'balance':_0x5af8f6,'totalPaidOut':_0x183765}}),console['log']('💰\x20Shop\x20'+_0x51146a[_0x28ac64(0x1b1)]+_0x28ac64(0x173)),console['log'](_0x28ac64(0x204)+_0x51146a[_0x28ac64(0x190)][_0x28ac64(0x202)](0x6)+'\x20->\x20'+_0x5af8f6['toFixed'](0x6)+'\x20USDT\x20(-'+_0x199eca[_0x28ac64(0x202)](0x6)+')'),console[_0x28ac64(0x15b)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x51146a[_0x28ac64(0x206)][_0x28ac64(0x202)](0x6)+_0x28ac64(0x1d4)+_0x183765['toFixed'](0x6)+'\x20USDT\x20(+'+_0x199eca[_0x28ac64(0x202)](0x6)+')'),{'payout':_0x33c12c,'shop':_0x51146a};});return console[_0x51f933(0x15b)](_0x51f933(0x208)+_0x2a6a86[_0x51f933(0x227)]['id']+_0x51f933(0x1e2)+_0x2a6a86[_0x51f933(0x1bf)][_0x51f933(0x1b1)]+'\x20('+_0x199eca+_0x51f933(0x1e5)),{'id':_0x2a6a86[_0x51f933(0x227)]['id'],'shopId':_0x2a6a86[_0x51f933(0x227)][_0x51f933(0x196)],'shopName':_0x2a6a86[_0x51f933(0x1bf)][_0x51f933(0x212)],'shopUsername':_0x2a6a86[_0x51f933(0x1bf)][_0x51f933(0x1b1)],'amount':_0x2a6a86[_0x51f933(0x227)]['amount'],'network':_0x2a6a86[_0x51f933(0x227)][_0x51f933(0x160)],'status':_0x2a6a86[_0x51f933(0x227)][_0x51f933(0x1be)],'txid':_0x2a6a86[_0x51f933(0x227)][_0x51f933(0x16b)],'notes':_0x2a6a86[_0x51f933(0x227)][_0x51f933(0x178)],'periodFrom':_0x2a6a86[_0x51f933(0x227)]['periodFrom'],'periodTo':_0x2a6a86['payout'][_0x51f933(0x187)],'createdAt':_0x2a6a86['payout'][_0x51f933(0x1ae)],'paidAt':_0x2a6a86[_0x51f933(0x227)][_0x51f933(0x1d1)]};}async[a35_0x109166(0x20c)](_0x15f2c8){const _0x2733a6=a35_0x109166,{page:_0x57134e,limit:_0x256bc9,shopId:_0x43888e,network:_0x154eb1,dateFrom:_0x5d59fb,dateTo:_0xda657c,search:_0x545d0c}=_0x15f2c8,_0x3140e0=(_0x57134e-0x1)*_0x256bc9,_0x2dfe2f={};_0x43888e&&(_0x2dfe2f[_0x2733a6(0x196)]=_0x43888e);_0x154eb1&&(_0x2dfe2f[_0x2733a6(0x160)]=_0x154eb1);(_0x5d59fb||_0xda657c)&&(_0x2dfe2f[_0x2733a6(0x1ae)]={},_0x5d59fb&&(_0x2dfe2f['createdAt'][_0x2733a6(0x210)]=new Date(_0x5d59fb)),_0xda657c&&(_0x2dfe2f[_0x2733a6(0x1ae)][_0x2733a6(0x1cd)]=new Date(_0xda657c)));_0x545d0c&&(_0x2dfe2f['OR']=[{'shop':{'name':{'contains':_0x545d0c,'mode':_0x2733a6(0x156)}}},{'shop':{'username':{'contains':_0x545d0c,'mode':_0x2733a6(0x156)}}},{'notes':{'contains':_0x545d0c,'mode':_0x2733a6(0x156)}}]);const [_0x5a73a5,_0x35df4c]=await Promise[_0x2733a6(0x1c3)]([database_1[_0x2733a6(0x166)][_0x2733a6(0x227)][_0x2733a6(0x1ef)]({'where':_0x2dfe2f,'skip':_0x3140e0,'take':_0x256bc9,'orderBy':{'createdAt':_0x2733a6(0x199)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2733a6(0x227)][_0x2733a6(0x1e1)]({'where':_0x2dfe2f})]);return{'payouts':_0x5a73a5[_0x2733a6(0x16c)](_0x1b12c8=>({'id':_0x1b12c8['id'],'shopId':_0x1b12c8['shopId'],'shopName':_0x1b12c8[_0x2733a6(0x1bf)]['name'],'shopUsername':_0x1b12c8[_0x2733a6(0x1bf)]['username'],'amount':_0x1b12c8[_0x2733a6(0x16e)],'network':_0x1b12c8[_0x2733a6(0x160)],'status':_0x1b12c8['status'],'txid':_0x1b12c8[_0x2733a6(0x16b)],'notes':_0x1b12c8[_0x2733a6(0x178)],'periodFrom':_0x1b12c8[_0x2733a6(0x218)],'periodTo':_0x1b12c8['periodTo'],'createdAt':_0x1b12c8[_0x2733a6(0x1ae)],'paidAt':_0x1b12c8[_0x2733a6(0x1d1)]})),'pagination':{'page':_0x57134e,'limit':_0x256bc9,'total':_0x35df4c,'totalPages':Math['ceil'](_0x35df4c/_0x256bc9)}};}async[a35_0x109166(0x1c5)](_0x2fcf7b){const _0x51f636=a35_0x109166,_0x1fa8c3=await database_1[_0x51f636(0x166)]['payout'][_0x51f636(0x224)]({'where':{'id':_0x2fcf7b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1fa8c3)return null;return{'id':_0x1fa8c3['id'],'shopId':_0x1fa8c3[_0x51f636(0x196)],'shopName':_0x1fa8c3['shop']['name'],'shopUsername':_0x1fa8c3['shop'][_0x51f636(0x1b1)],'amount':_0x1fa8c3[_0x51f636(0x16e)],'network':_0x1fa8c3['network'],'status':_0x1fa8c3[_0x51f636(0x1be)],'txid':_0x1fa8c3[_0x51f636(0x16b)],'notes':_0x1fa8c3[_0x51f636(0x178)],'periodFrom':_0x1fa8c3[_0x51f636(0x218)],'periodTo':_0x1fa8c3[_0x51f636(0x187)],'createdAt':_0x1fa8c3[_0x51f636(0x1ae)],'paidAt':_0x1fa8c3[_0x51f636(0x1d1)]};}async[a35_0x109166(0x1f2)](_0x211087){const _0x2674fb=a35_0x109166;await database_1[_0x2674fb(0x166)][_0x2674fb(0x227)][_0x2674fb(0x167)]({'where':{'id':_0x211087}});}async[a35_0x109166(0x20f)](_0x24984f){const _0x32b5a0=a35_0x109166,{page:_0x2831bc,limit:_0x5cc626,status:_0x3fb562,gateway:_0x2cd82,shopId:_0x4b7ead,dateFrom:_0x1630af,dateTo:_0x153444,search:_0x48a579}=_0x24984f,_0x727f31=(_0x2831bc-0x1)*_0x5cc626,_0x385523={};_0x3fb562&&(_0x385523[_0x32b5a0(0x1be)]=_0x3fb562[_0x32b5a0(0x186)]());_0x2cd82&&(_0x385523['gateway']=_0x2cd82[_0x32b5a0(0x191)]());_0x385523[_0x32b5a0(0x214)]=_0x385523[_0x32b5a0(0x214)]?_0x385523['gateway']:{'not':_0x32b5a0(0x21a)};if(typeof _0x385523['gateway']==='string'&&_0x385523[_0x32b5a0(0x214)]!==_0x32b5a0(0x21a)){}else{if(typeof _0x385523[_0x32b5a0(0x214)]===_0x32b5a0(0x161)&&_0x385523['gateway']===_0x32b5a0(0x21a)){}else _0x385523['gateway']={'not':_0x32b5a0(0x21a)};}_0x4b7ead&&(_0x385523['shopId']=_0x4b7ead);(_0x1630af||_0x153444)&&(_0x385523[_0x32b5a0(0x1ae)]={},_0x1630af&&(_0x385523[_0x32b5a0(0x1ae)][_0x32b5a0(0x210)]=new Date(_0x1630af)),_0x153444&&(_0x385523['createdAt'][_0x32b5a0(0x1cd)]=new Date(_0x153444)));_0x48a579&&(_0x385523['OR']=[{'orderId':{'contains':_0x48a579,'mode':_0x32b5a0(0x156)}},{'gatewayOrderId':{'contains':_0x48a579,'mode':_0x32b5a0(0x156)}},{'customerEmail':{'contains':_0x48a579,'mode':_0x32b5a0(0x156)}},{'shop':{'name':{'contains':_0x48a579,'mode':_0x32b5a0(0x156)}}},{'shop':{'username':{'contains':_0x48a579,'mode':_0x32b5a0(0x156)}}}]);const [_0x4f01fe,_0x406360]=await Promise[_0x32b5a0(0x1c3)]([database_1[_0x32b5a0(0x166)][_0x32b5a0(0x1e3)][_0x32b5a0(0x1ef)]({'where':_0x385523,'skip':_0x727f31,'take':_0x5cc626,'orderBy':{'createdAt':_0x32b5a0(0x199)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x32b5a0(0x166)][_0x32b5a0(0x1e3)][_0x32b5a0(0x1e1)]({'where':_0x385523})]);return{'payments':_0x4f01fe[_0x32b5a0(0x16c)](_0x504cac=>({'id':_0x504cac['id'],'shopId':_0x504cac['shopId'],'gateway':_0x504cac[_0x32b5a0(0x214)],'amount':_0x504cac[_0x32b5a0(0x16e)],'currency':_0x504cac[_0x32b5a0(0x1bb)],'status':_0x504cac[_0x32b5a0(0x1be)],'orderId':_0x504cac[_0x32b5a0(0x17c)],'gatewayOrderId':_0x504cac[_0x32b5a0(0x1ed)],'customerEmail':_0x504cac[_0x32b5a0(0x1b0)],'customerName':_0x504cac['customerName'],'customerCountry':_0x504cac['customerCountry'],'customerIp':_0x504cac[_0x32b5a0(0x175)],'customerUa':_0x504cac[_0x32b5a0(0x21d)],'failureMessage':_0x504cac[_0x32b5a0(0x177)],'createdAt':_0x504cac[_0x32b5a0(0x1ae)],'updatedAt':_0x504cac['updatedAt'],'shop':_0x504cac['shop']})),'pagination':{'page':_0x2831bc,'limit':_0x5cc626,'total':_0x406360,'totalPages':Math[_0x32b5a0(0x20b)](_0x406360/_0x5cc626)}};}async[a35_0x109166(0x1f4)](_0x10dc06){const _0x5ed8fb=a35_0x109166,_0x55ad97=await database_1[_0x5ed8fb(0x166)][_0x5ed8fb(0x1e3)][_0x5ed8fb(0x224)]({'where':{'id':_0x10dc06},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x55ad97)return null;return{'id':_0x55ad97['id'],'shopId':_0x55ad97['shopId'],'gateway':_0x55ad97[_0x5ed8fb(0x214)],'amount':_0x55ad97[_0x5ed8fb(0x16e)],'currency':_0x55ad97[_0x5ed8fb(0x1bb)],'status':_0x55ad97[_0x5ed8fb(0x1be)],'orderId':_0x55ad97[_0x5ed8fb(0x17c)],'gatewayOrderId':_0x55ad97[_0x5ed8fb(0x1ed)],'customerEmail':_0x55ad97['customerEmail'],'customerName':_0x55ad97[_0x5ed8fb(0x1e4)],'customerCountry':_0x55ad97[_0x5ed8fb(0x220)],'customerIp':_0x55ad97[_0x5ed8fb(0x175)],'customerUa':_0x55ad97[_0x5ed8fb(0x21d)],'failureMessage':_0x55ad97[_0x5ed8fb(0x177)],'externalPaymentUrl':_0x55ad97[_0x5ed8fb(0x209)],'successUrl':_0x55ad97['successUrl'],'failUrl':_0x55ad97[_0x5ed8fb(0x17a)],'pendingUrl':_0x55ad97['pendingUrl'],'whiteUrl':_0x55ad97[_0x5ed8fb(0x174)],'createdAt':_0x55ad97['createdAt'],'updatedAt':_0x55ad97[_0x5ed8fb(0x15d)],'shop':_0x55ad97['shop']};}async[a35_0x109166(0x226)](_0x4663f0,_0x4a944c,_0x5aa2ee,_0x2216eb){const _0x22e65a=a35_0x109166,_0x2b612c=await database_1[_0x22e65a(0x166)][_0x22e65a(0x1a0)](async _0x4e69b4=>{const _0x5790e3=_0x22e65a,_0x1370ae=await _0x4e69b4[_0x5790e3(0x1e3)][_0x5790e3(0x224)]({'where':{'id':_0x4663f0},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1370ae)throw new Error(_0x5790e3(0x216));const _0x172f81=_0x1370ae[_0x5790e3(0x1be)],_0x12fa69=_0x4a944c['toUpperCase']();console[_0x5790e3(0x15b)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x4663f0+_0x5790e3(0x1d7)+_0x172f81+_0x5790e3(0x1d4)+_0x12fa69),console[_0x5790e3(0x15b)](_0x5790e3(0x1df)+_0x1370ae['shop'][_0x5790e3(0x190)]+_0x5790e3(0x1e8));const _0xb70cb2={'status':_0x12fa69,'updatedAt':new Date(),'statusChangedBy':_0x5790e3(0x18a),'statusChangedAt':new Date()};_0x5aa2ee&&(_0xb70cb2[_0x5790e3(0x213)]=_0x5aa2ee);_0x12fa69==='CHARGEBACK'&&_0x2216eb&&(_0xb70cb2[_0x5790e3(0x1f6)]=_0x2216eb);let _0x2f8132=0x0,_0x12239f=_0x1370ae[_0x5790e3(0x1bf)][_0x5790e3(0x190)];if(_0x12fa69===_0x5790e3(0x171)&&_0x172f81!==_0x5790e3(0x171)){_0xb70cb2['paidAt']=new Date();const _0x147fc1=await currencyService_1[_0x5790e3(0x1c1)][_0x5790e3(0x1b2)](_0x1370ae[_0x5790e3(0x16e)],_0x1370ae[_0x5790e3(0x1bb)]);_0xb70cb2[_0x5790e3(0x1ac)]=_0x147fc1,_0x2f8132=_0x147fc1,_0x12239f+=_0x147fc1,console[_0x5790e3(0x15b)]('💰\x20Payment\x20'+_0x4663f0+_0x5790e3(0x22a)+_0x147fc1[_0x5790e3(0x202)](0x6)+_0x5790e3(0x201));}else _0x172f81===_0x5790e3(0x171)&&_0x12fa69!==_0x5790e3(0x171)&&(_0x1370ae[_0x5790e3(0x1ac)]&&(_0x2f8132=-_0x1370ae[_0x5790e3(0x1ac)],_0x12239f-=_0x1370ae[_0x5790e3(0x1ac)],_0xb70cb2[_0x5790e3(0x1ac)]=null,console[_0x5790e3(0x15b)](_0x5790e3(0x1ba)+_0x4663f0+'\x20no\x20longer\x20PAID:\x20-'+_0x1370ae[_0x5790e3(0x1ac)]['toFixed'](0x6)+_0x5790e3(0x17d))));if(_0x12fa69===_0x5790e3(0x1a9)){if(_0x172f81==='PAID'&&_0x1370ae['amountUSDT']){}_0x2216eb&&_0x2216eb>0x0&&(_0x2f8132-=_0x2216eb,_0x12239f-=_0x2216eb,console[_0x5790e3(0x15b)](_0x5790e3(0x1d0)+_0x2216eb['toFixed'](0x6)+_0x5790e3(0x17d)));}_0x12fa69==='REFUND'&&_0x172f81==='PAID'&&console['log'](_0x5790e3(0x1ce));const _0x1eada0=await _0x4e69b4[_0x5790e3(0x1e3)][_0x5790e3(0x1f5)]({'where':{'id':_0x4663f0},'data':_0xb70cb2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2f8132!==0x0&&(await _0x4e69b4[_0x5790e3(0x1bf)][_0x5790e3(0x1f5)]({'where':{'id':_0x1370ae[_0x5790e3(0x196)]},'data':{'balance':_0x12239f}}),console['log'](_0x5790e3(0x1af)+_0x1370ae['shopId']+_0x5790e3(0x180)+_0x1370ae['shop'][_0x5790e3(0x190)][_0x5790e3(0x202)](0x6)+_0x5790e3(0x1d4)+_0x12239f[_0x5790e3(0x202)](0x6)+_0x5790e3(0x1db)+(_0x2f8132>0x0?'+':'')+_0x2f8132['toFixed'](0x6)+')')),_0x1eada0;});return{'id':_0x2b612c['id'],'shopId':_0x2b612c[_0x22e65a(0x196)],'gateway':_0x2b612c['gateway'],'amount':_0x2b612c[_0x22e65a(0x16e)],'currency':_0x2b612c[_0x22e65a(0x1bb)],'status':_0x2b612c['status'],'orderId':_0x2b612c[_0x22e65a(0x17c)],'gatewayOrderId':_0x2b612c['gatewayOrderId'],'customerEmail':_0x2b612c[_0x22e65a(0x1b0)],'customerName':_0x2b612c[_0x22e65a(0x1e4)],'customerCountry':_0x2b612c[_0x22e65a(0x220)],'customerIp':_0x2b612c[_0x22e65a(0x175)],'customerUa':_0x2b612c[_0x22e65a(0x21d)],'failureMessage':_0x2b612c[_0x22e65a(0x177)],'adminNotes':_0x2b612c[_0x22e65a(0x213)],'chargebackAmount':_0x2b612c['chargebackAmount'],'statusChangedBy':_0x2b612c[_0x22e65a(0x1e7)],'statusChangedAt':_0x2b612c['statusChangedAt'],'createdAt':_0x2b612c[_0x22e65a(0x1ae)],'updatedAt':_0x2b612c[_0x22e65a(0x15d)],'shop':_0x2b612c['shop']};}async['updateUser'](_0x13198b,_0x3f365c){const _0x66edb6=a35_0x109166,_0x4ead90={..._0x3f365c};_0x3f365c[_0x66edb6(0x1fd)]&&(_0x4ead90[_0x66edb6(0x1fd)]=await bcryptjs_1[_0x66edb6(0x166)][_0x66edb6(0x22c)](_0x3f365c[_0x66edb6(0x1fd)],0xc));_0x3f365c['fullName']&&(_0x4ead90[_0x66edb6(0x212)]=_0x3f365c[_0x66edb6(0x21b)],delete _0x4ead90[_0x66edb6(0x21b)]);_0x3f365c[_0x66edb6(0x19e)]&&(_0x4ead90[_0x66edb6(0x1fb)]=_0x3f365c[_0x66edb6(0x19e)],delete _0x4ead90['telegramId']);_0x3f365c[_0x66edb6(0x1ab)]&&(_0x4ead90['shopUrl']=_0x3f365c[_0x66edb6(0x1ab)],delete _0x4ead90[_0x66edb6(0x1ab)]);_0x3f365c[_0x66edb6(0x18b)]&&(_0x4ead90[_0x66edb6(0x1c6)]=JSON[_0x66edb6(0x169)](_0x3f365c[_0x66edb6(0x18b)]),delete _0x4ead90[_0x66edb6(0x18b)]);_0x3f365c[_0x66edb6(0x203)]&&(_0x4ead90['gatewaySettings']=JSON[_0x66edb6(0x169)](_0x3f365c[_0x66edb6(0x203)]),delete _0x4ead90[_0x66edb6(0x203)]);_0x3f365c['wallets']&&(_0x3f365c['wallets'][_0x66edb6(0x1eb)]!==undefined&&(_0x4ead90[_0x66edb6(0x1eb)]=_0x3f365c[_0x66edb6(0x200)][_0x66edb6(0x1eb)]||null),_0x3f365c[_0x66edb6(0x200)][_0x66edb6(0x1ee)]!==undefined&&(_0x4ead90[_0x66edb6(0x1ee)]=_0x3f365c[_0x66edb6(0x200)][_0x66edb6(0x1ee)]||null),_0x3f365c[_0x66edb6(0x200)][_0x66edb6(0x179)]!==undefined&&(_0x4ead90[_0x66edb6(0x179)]=_0x3f365c['wallets']['usdtErcWallet']||null),_0x3f365c[_0x66edb6(0x200)]['usdcPolygonWallet']!==undefined&&(_0x4ead90[_0x66edb6(0x1fc)]=_0x3f365c['wallets'][_0x66edb6(0x1fc)]||null),delete _0x4ead90['wallets']);const _0x5490f9=await database_1[_0x66edb6(0x166)]['shop'][_0x66edb6(0x1f5)]({'where':{'id':_0x13198b},'data':_0x4ead90,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5490f9['id'],'fullName':_0x5490f9[_0x66edb6(0x212)],'username':_0x5490f9['username'],'telegramId':_0x5490f9[_0x66edb6(0x1fb)],'merchantUrl':_0x5490f9[_0x66edb6(0x22d)],'gateways':_0x5490f9[_0x66edb6(0x1c6)]?JSON['parse'](_0x5490f9['paymentGateways']):null,'gatewaySettings':_0x5490f9[_0x66edb6(0x203)]?JSON['parse'](_0x5490f9[_0x66edb6(0x203)]):null,'publicKey':_0x5490f9[_0x66edb6(0x1f3)],'wallets':{'usdtPolygonWallet':_0x5490f9['usdtPolygonWallet'],'usdtTrcWallet':_0x5490f9[_0x66edb6(0x1ee)],'usdtErcWallet':_0x5490f9[_0x66edb6(0x179)],'usdcPolygonWallet':_0x5490f9[_0x66edb6(0x1fc)]},'status':_0x5490f9[_0x66edb6(0x1be)],'createdAt':_0x5490f9[_0x66edb6(0x1ae)]};}async[a35_0x109166(0x20d)](_0x1e9095){const _0x41bd99=a35_0x109166,_0x3bd02c=await database_1[_0x41bd99(0x166)]['shop'][_0x41bd99(0x1f5)]({'where':{'id':_0x1e9095},'data':{'status':_0x41bd99(0x1f1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3bd02c['id'],'fullName':_0x3bd02c['name'],'username':_0x3bd02c['username'],'telegramId':_0x3bd02c[_0x41bd99(0x1fb)],'merchantUrl':_0x3bd02c[_0x41bd99(0x22d)],'gateways':_0x3bd02c['paymentGateways']?JSON[_0x41bd99(0x1da)](_0x3bd02c[_0x41bd99(0x1c6)]):null,'gatewaySettings':_0x3bd02c[_0x41bd99(0x203)]?JSON[_0x41bd99(0x1da)](_0x3bd02c[_0x41bd99(0x203)]):null,'publicKey':_0x3bd02c[_0x41bd99(0x1f3)],'wallets':{'usdtPolygonWallet':_0x3bd02c[_0x41bd99(0x1eb)],'usdtTrcWallet':_0x3bd02c[_0x41bd99(0x1ee)],'usdtErcWallet':_0x3bd02c[_0x41bd99(0x179)],'usdcPolygonWallet':_0x3bd02c[_0x41bd99(0x1fc)]},'status':_0x3bd02c[_0x41bd99(0x1be)],'createdAt':_0x3bd02c['createdAt']};}async[a35_0x109166(0x1ff)](_0x470820){const _0x4642e5=a35_0x109166,_0x3efe77=await database_1[_0x4642e5(0x166)][_0x4642e5(0x1bf)][_0x4642e5(0x1f5)]({'where':{'id':_0x470820},'data':{'status':_0x4642e5(0x1ec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3efe77['id'],'fullName':_0x3efe77[_0x4642e5(0x212)],'username':_0x3efe77[_0x4642e5(0x1b1)],'telegramId':_0x3efe77['telegram'],'merchantUrl':_0x3efe77['shopUrl'],'gateways':_0x3efe77['paymentGateways']?JSON['parse'](_0x3efe77['paymentGateways']):null,'gatewaySettings':_0x3efe77[_0x4642e5(0x203)]?JSON[_0x4642e5(0x1da)](_0x3efe77[_0x4642e5(0x203)]):null,'publicKey':_0x3efe77['publicKey'],'wallets':{'usdtPolygonWallet':_0x3efe77[_0x4642e5(0x1eb)],'usdtTrcWallet':_0x3efe77[_0x4642e5(0x1ee)],'usdtErcWallet':_0x3efe77['usdtErcWallet'],'usdcPolygonWallet':_0x3efe77['usdcPolygonWallet']},'status':_0x3efe77[_0x4642e5(0x1be)],'createdAt':_0x3efe77[_0x4642e5(0x1ae)]};}async[a35_0x109166(0x22e)](_0x52e4af){const _0x11b43a=a35_0x109166,{page:_0x16c4b2,limit:_0x417ccc,status:_0x25a99c}=_0x52e4af,_0x596175=(_0x16c4b2-0x1)*_0x417ccc,_0x469c7b={};_0x25a99c&&(_0x469c7b[_0x11b43a(0x1be)]=_0x25a99c['toUpperCase']());const [_0x43ba6b,_0x4e0423]=await Promise[_0x11b43a(0x1c3)]([database_1[_0x11b43a(0x166)]['shop']['findMany']({'where':_0x469c7b,'skip':_0x596175,'take':_0x417ccc,'orderBy':{'createdAt':_0x11b43a(0x199)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x11b43a(0x166)][_0x11b43a(0x1bf)]['count']({'where':_0x469c7b})]);return{'users':_0x43ba6b[_0x11b43a(0x16c)](_0x4e7298=>({'id':_0x4e7298['id'],'fullName':_0x4e7298[_0x11b43a(0x212)],'username':_0x4e7298['username'],'telegramId':_0x4e7298[_0x11b43a(0x1fb)],'merchantUrl':_0x4e7298[_0x11b43a(0x22d)],'gateways':_0x4e7298[_0x11b43a(0x1c6)]?JSON['parse'](_0x4e7298[_0x11b43a(0x1c6)]):null,'gatewaySettings':_0x4e7298['gatewaySettings']?JSON[_0x11b43a(0x1da)](_0x4e7298[_0x11b43a(0x203)]):null,'publicKey':_0x4e7298[_0x11b43a(0x1f3)],'wallets':{'usdtPolygonWallet':_0x4e7298[_0x11b43a(0x1eb)],'usdtTrcWallet':_0x4e7298[_0x11b43a(0x1ee)],'usdtErcWallet':_0x4e7298[_0x11b43a(0x179)],'usdcPolygonWallet':_0x4e7298[_0x11b43a(0x1fc)]},'status':_0x4e7298['status'],'createdAt':_0x4e7298[_0x11b43a(0x1ae)]})),'pagination':{'page':_0x16c4b2,'limit':_0x417ccc,'total':_0x4e0423,'totalPages':Math['ceil'](_0x4e0423/_0x417ccc)}};}async['getUserById'](_0x59464f){const _0x9165f8=a35_0x109166,_0x132630=await database_1['default'][_0x9165f8(0x1bf)][_0x9165f8(0x224)]({'where':{'id':_0x59464f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x132630)return null;return{'id':_0x132630['id'],'fullName':_0x132630['name'],'username':_0x132630[_0x9165f8(0x1b1)],'telegramId':_0x132630[_0x9165f8(0x1fb)],'merchantUrl':_0x132630['shopUrl'],'gateways':_0x132630[_0x9165f8(0x1c6)]?JSON[_0x9165f8(0x1da)](_0x132630['paymentGateways']):null,'gatewaySettings':_0x132630[_0x9165f8(0x203)]?JSON[_0x9165f8(0x1da)](_0x132630[_0x9165f8(0x203)]):null,'publicKey':_0x132630['publicKey'],'wallets':{'usdtPolygonWallet':_0x132630['usdtPolygonWallet'],'usdtTrcWallet':_0x132630[_0x9165f8(0x1ee)],'usdtErcWallet':_0x132630[_0x9165f8(0x179)],'usdcPolygonWallet':_0x132630[_0x9165f8(0x1fc)]},'status':_0x132630['status'],'createdAt':_0x132630[_0x9165f8(0x1ae)]};}async[a35_0x109166(0x1d5)](_0x4b35b6){const _0x434c8e=a35_0x109166,{fullName:_0x16b069,username:_0x4c443f,password:_0xe725c4,telegramId:_0x1678e6,merchantUrl:_0x2776c0,gateways:_0xc5a601,gatewaySettings:_0xb34f9d,wallets:_0x24b909}=_0x4b35b6,_0xb0aca2=await database_1['default'][_0x434c8e(0x1bf)]['findUnique']({'where':{'username':_0x4c443f}});if(_0xb0aca2)throw new Error(_0x434c8e(0x181));if(_0x1678e6){const _0x50aa51=await database_1[_0x434c8e(0x166)][_0x434c8e(0x1bf)][_0x434c8e(0x224)]({'where':{'telegram':_0x1678e6}});if(_0x50aa51)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x13e87e=await bcryptjs_1[_0x434c8e(0x166)]['hash'](_0xe725c4,0xc),_0x3075e4=_0x434c8e(0x1fe)+crypto_1['default'][_0x434c8e(0x1cf)](0x20)[_0x434c8e(0x1c8)](_0x434c8e(0x198)),_0x58c0c1=_0x434c8e(0x1d8)+crypto_1[_0x434c8e(0x166)][_0x434c8e(0x1cf)](0x20)['toString'](_0x434c8e(0x198)),_0x453951=await database_1['default'][_0x434c8e(0x1bf)]['create']({'data':{'name':_0x16b069,'username':_0x4c443f,'password':_0x13e87e,'telegram':_0x1678e6,'shopUrl':_0x2776c0,'paymentGateways':_0xc5a601?JSON[_0x434c8e(0x169)](_0xc5a601):null,'gatewaySettings':_0xb34f9d?JSON['stringify'](_0xb34f9d):null,'usdtPolygonWallet':_0x24b909?.[_0x434c8e(0x1eb)]||null,'usdtTrcWallet':_0x24b909?.[_0x434c8e(0x1ee)]||null,'usdtErcWallet':_0x24b909?.[_0x434c8e(0x179)]||null,'usdcPolygonWallet':_0x24b909?.[_0x434c8e(0x1fc)]||null,'publicKey':_0x3075e4,'secretKey':_0x58c0c1,'status':_0x434c8e(0x1ec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x453951['id'],'fullName':_0x453951['name'],'username':_0x453951[_0x434c8e(0x1b1)],'telegramId':_0x453951[_0x434c8e(0x1fb)],'merchantUrl':_0x453951[_0x434c8e(0x22d)],'gateways':_0x453951[_0x434c8e(0x1c6)]?JSON[_0x434c8e(0x1da)](_0x453951[_0x434c8e(0x1c6)]):null,'gatewaySettings':_0x453951['gatewaySettings']?JSON[_0x434c8e(0x1da)](_0x453951[_0x434c8e(0x203)]):null,'publicKey':_0x453951[_0x434c8e(0x1f3)],'wallets':{'usdtPolygonWallet':_0x453951['usdtPolygonWallet'],'usdtTrcWallet':_0x453951['usdtTrcWallet'],'usdtErcWallet':_0x453951[_0x434c8e(0x179)],'usdcPolygonWallet':_0x453951['usdcPolygonWallet']},'status':_0x453951[_0x434c8e(0x1be)],'createdAt':_0x453951[_0x434c8e(0x1ae)]};}async[a35_0x109166(0x1cc)](_0x151179){const _0x58e809=a35_0x109166;await database_1[_0x58e809(0x166)]['shop'][_0x58e809(0x167)]({'where':{'id':_0x151179}});}}exports[a35_0x109166(0x225)]=AdminService;