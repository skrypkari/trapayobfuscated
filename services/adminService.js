'use strict';const a35_0x1cb8f9=a35_0x2a6e;(function(_0x43c473,_0x256f50){const _0x4ac238=a35_0x2a6e,_0xb0c37f=_0x43c473();while(!![]){try{const _0x182a0c=parseInt(_0x4ac238(0x1fa))/0x1+parseInt(_0x4ac238(0x1be))/0x2*(-parseInt(_0x4ac238(0x15d))/0x3)+parseInt(_0x4ac238(0x19c))/0x4*(-parseInt(_0x4ac238(0x1c1))/0x5)+parseInt(_0x4ac238(0x166))/0x6+parseInt(_0x4ac238(0x1c6))/0x7*(-parseInt(_0x4ac238(0x158))/0x8)+-parseInt(_0x4ac238(0x176))/0x9*(-parseInt(_0x4ac238(0x215))/0xa)+parseInt(_0x4ac238(0x1fb))/0xb;if(_0x182a0c===_0x256f50)break;else _0xb0c37f['push'](_0xb0c37f['shift']());}catch(_0x415160){_0xb0c37f['push'](_0xb0c37f['shift']());}}}(a35_0x3a20,0xdacff));var __importDefault=this&&this[a35_0x1cb8f9(0x16d)]||function(_0x2145d5){return _0x2145d5&&_0x2145d5['__esModule']?_0x2145d5:{'default':_0x2145d5};};Object[a35_0x1cb8f9(0x203)](exports,a35_0x1cb8f9(0x1f5),{'value':!![]}),exports[a35_0x1cb8f9(0x1cc)]=void 0x0;function a35_0x3a20(){const _0x309248=['turnover','log','customerEmail','\x20\x20\x20Current\x20balance:\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','toString','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','failureMessage','💳\x20Payout\x20wallet\x20for\x20','4fGbFWW','adminNotes','gte','orderId','turnoverUSDT','trc20','customerIp','_sum','gatewayEarnings','name','customerName','reduce','createUser','externalPaymentUrl','hash','📅\x20Period:\x20','ceil','round','payment','totalPaidOut','sk_','week','Shop\x20not\x20found','telegramId','🔄\x20Admin\x20updating\x20payment\x20','paymentGateways','getTime','\x20USDT,\x20Requested:\x20','count','\x20\x20\x20Balance:\x20','✅\x20Payout\x20created:\x20','getUserById','\x20\x20\x20Payout\x20amount:\x20','lte','1892JZQHaj','failUrl','fullName','6543295soOTkK','string','merchantEarningsUSDT','usdcPolygonWallet','dateTo','65023KLyiRJ','getGatewayDisplayName','polygon_usdc','username','gateways','update','AdminService','KLYME\x20DE','2020-01-01','Telegram\x20username\x20already\x20exists','\x20USDT\x20(','merchantEarnings','COMPLETED','Error\x20processing\x20payment\x20','shop','PAID','create','pk_','Insufficient\x20balance.\x20Available:\x20','averageCheckUSDT','customerCountry','password','period','📊\x20Merchants\x20awaiting\x20payout:\x20','updatePaymentStatus','getAllUsers','delete','stringify','💸\x20CHARGEBACK\x20penalty:\x20-','gatewaySettings','SUSPENDED','groupBy','map','\x20\x20\x20Transaction\x20hash:\x20','REFUND','availableBalance','length','\x20\x20\x20💰\x20Total\x20turnover:\x20','not\x20set','usdtTrcWallet','deleteUser','publicKey','custom','findMany','\x20merchants,\x20','\x20\x20\x20Total\x20paid\x20out:\x20','values','__esModule','💰\x20Shop\x20','\x20to\x20','💰\x20Current\x20shop\x20balance:\x20','ACTIVE','22312PHbDOZ','36889314mNQHkD','awaitingPayout','set','randomBytes','asc','successUrl','\x20paid\x20payments\x20for\x20analysis','currencyService','defineProperty','deletePayout','getPaymentById','network','sort','toISOString','merchantUrl','totalPayments','getAllPayouts','_count','forEach','💰\x20Payment\x20','usdtPolygonWallet','periodFrom','$transaction','getMonth','Noda','\x20no\x20longer\x20PAID:\x20-','1790NeHZMs','dateFrom','all','txid','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','admin','\x20\x20\x20📅\x20This\x20month:\x20','averageCommissionRate','desc','KLYME\x20EU','\x20\x20\x20💵\x20Available\x20balance:\x20','../config/database','getFullYear','getMerchantStatistics','date','activateUser','toLowerCase','📊\x20Merchant\x20statistics\x20calculated:','\x20balance\x20updated:\x20','amountUSDT','aggregate','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT','\x20\x20\x20🌍\x20Country:\x20','balance','month','Payment\x20not\x20found','parse','shopId','telegram','1464PTcmIy','createdAt','notes','findUnique','commissionUSDT','105mXcufy','whiteUrl','suspendUser','gatewayOrderId','\x20USDT\x20(total\x20merchant\x20balances)','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','usdtErcWallet','updatedAt','\x20merchants\x20with\x20positive\x20balance','1852440lEVAHB','erc20','year','wallets','updateCustomerData','status','toFixed','__importDefault','periodTo','updateUser','paymentsCount','statusChangedAt','\x20USDT\x20(total\x20paid\x20to\x20merchants)','shopUrl','thisMonth','customerUa','12735aRSiYf','pendingUrl','💰\x20Found\x20','default','Username\x20already\x20exists','convertToUSDT','\x20USDT)','error','not\x20specified','totalCommissionRate','\x20for\x20shop\x20','insensitive','getSystemStatistics','toUpperCase','hex','CHARGEBACK','gateway','currency','amount','crypto','payout','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','paidAt','paidOutUSDT','\x20->\x20','test_gateway','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','totalTurnover','chargebackAmount'];a35_0x3a20=function(){return _0x309248;};return a35_0x3a20();}const database_1=__importDefault(require(a35_0x1cb8f9(0x220))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x1cb8f9(0x189))),currencyService_1=require('./currencyService');class AdminService{async['getPayoutStats'](){const _0x2cb9d5=a35_0x1cb8f9;console[_0x2cb9d5(0x194)]('📊\x20Calculating\x20payout\x20statistics...');const _0x2a46d1=await database_1[_0x2cb9d5(0x179)][_0x2cb9d5(0x1d4)][_0x2cb9d5(0x229)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0xa00424=new Date(),_0x348cfb=new Date(_0xa00424[_0x2cb9d5(0x221)](),_0xa00424[_0x2cb9d5(0x212)](),0x1),_0x5a211c=new Date(_0xa00424['getFullYear'](),_0xa00424['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x23377e=await database_1[_0x2cb9d5(0x179)][_0x2cb9d5(0x18a)][_0x2cb9d5(0x229)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x348cfb,'lte':_0x5a211c},'status':_0x2cb9d5(0x1d2)}}),_0x53157a=_0x2a46d1[_0x2cb9d5(0x1a3)][_0x2cb9d5(0x1af)]||0x0,_0x214a1b=_0x2a46d1[_0x2cb9d5(0x1a3)][_0x2cb9d5(0x22d)]||0x0,_0x28e294=_0x23377e[_0x2cb9d5(0x1a3)]['amount']||0x0,_0x49e591={'totalPayout':Math[_0x2cb9d5(0x1ad)](_0x53157a*0x64)/0x64,'awaitingPayout':Math[_0x2cb9d5(0x1ad)](_0x214a1b*0x64)/0x64,'thisMonth':Math[_0x2cb9d5(0x1ad)](_0x28e294*0x64)/0x64,'availableBalance':Math[_0x2cb9d5(0x1ad)](_0x214a1b*0x64)/0x64};return console['log']('📊\x20Payout\x20statistics\x20calculated:'),console[_0x2cb9d5(0x194)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x49e591['totalPayout']+_0x2cb9d5(0x172)),console['log']('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x49e591[_0x2cb9d5(0x1fc)]+_0x2cb9d5(0x161)),console[_0x2cb9d5(0x194)](_0x2cb9d5(0x21f)+_0x49e591[_0x2cb9d5(0x1e9)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x2cb9d5(0x194)](_0x2cb9d5(0x21b)+_0x49e591[_0x2cb9d5(0x174)]+_0x2cb9d5(0x22b)),_0x49e591;}async[a35_0x1cb8f9(0x16a)](_0x2d9856,_0x9fa72c){const _0x4d747e=a35_0x1cb8f9;console[_0x4d747e(0x194)](_0x4d747e(0x219)+_0x2d9856+':',_0x9fa72c);const _0x193ba9=await database_1['default'][_0x4d747e(0x1ae)][_0x4d747e(0x15b)]({'where':{'id':_0x2d9856},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x193ba9)throw new Error(_0x4d747e(0x22f));const _0xa097cb={};_0x9fa72c[_0x4d747e(0x1da)]!==undefined&&(_0xa097cb['customerCountry']=_0x9fa72c['customerCountry']||null);_0x9fa72c[_0x4d747e(0x1a2)]!==undefined&&(_0xa097cb[_0x4d747e(0x1a2)]=_0x9fa72c[_0x4d747e(0x1a2)]||null);_0x9fa72c[_0x4d747e(0x175)]!==undefined&&(_0xa097cb[_0x4d747e(0x175)]=_0x9fa72c[_0x4d747e(0x175)]||null);const _0x42bd49=await database_1[_0x4d747e(0x179)]['payment'][_0x4d747e(0x1cb)]({'where':{'id':_0x2d9856},'data':{..._0xa097cb,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x4d747e(0x194)](_0x4d747e(0x162)+_0x2d9856),console[_0x4d747e(0x194)](_0x4d747e(0x22c)+_0x193ba9[_0x4d747e(0x1da)]+_0x4d747e(0x18e)+_0x42bd49[_0x4d747e(0x1da)]),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x193ba9[_0x4d747e(0x1a2)]+_0x4d747e(0x18e)+_0x42bd49[_0x4d747e(0x1a2)]),console['log']('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x193ba9[_0x4d747e(0x175)]?_0x4d747e(0x1fd):'not\x20set')+_0x4d747e(0x18e)+(_0x42bd49[_0x4d747e(0x175)]?_0x4d747e(0x1fd):_0x4d747e(0x1ec))),_0x42bd49;}async[a35_0x1cb8f9(0x182)](_0x4ee536){const _0x17a212=a35_0x1cb8f9,_0x47959f=new Date();let _0x48b2c2;switch(_0x4ee536){case'7d':_0x48b2c2=new Date(_0x47959f[_0x17a212(0x1b6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x48b2c2=new Date(_0x47959f[_0x17a212(0x1b6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x48b2c2=new Date(_0x47959f[_0x17a212(0x1b6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x48b2c2=new Date(_0x47959f[_0x17a212(0x1b6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2710be,_0x151cc6,_0x5341dc,_0x21c044,_0x42877c,_0x2efada]=await Promise[_0x17a212(0x217)]([database_1[_0x17a212(0x179)][_0x17a212(0x1d4)][_0x17a212(0x1b8)](),database_1[_0x17a212(0x179)]['shop'][_0x17a212(0x1b8)]({'where':{'status':_0x17a212(0x1f9)}}),database_1['default']['payment']['count']({'where':{'createdAt':{'gte':_0x48b2c2},'gateway':{'not':_0x17a212(0x18f)}}}),database_1[_0x17a212(0x179)]['payment'][_0x17a212(0x1b8)]({'where':{'status':_0x17a212(0x1d5),'createdAt':{'gte':_0x48b2c2},'gateway':{'not':'test_gateway'}}}),database_1[_0x17a212(0x179)][_0x17a212(0x1ae)][_0x17a212(0x1f1)]({'where':{'status':_0x17a212(0x1d5),'createdAt':{'gte':_0x48b2c2},'gateway':{'not':_0x17a212(0x18f)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x17a212(0x179)]['payment'][_0x17a212(0x1f1)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x17a212(0x21d)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x16b9c6=0x0;for(const _0x35ac5b of _0x42877c){const _0x37f521=await currencyService_1[_0x17a212(0x202)]['convertToUSDT'](_0x35ac5b[_0x17a212(0x188)],_0x35ac5b[_0x17a212(0x187)]);_0x16b9c6+=_0x37f521;}const _0x3f2463=_0x5341dc>0x0?_0x21c044/_0x5341dc*0x64:0x0;return{'totalShops':_0x2710be,'activeShops':_0x151cc6,'totalPayments':_0x5341dc,'successfulPayments':_0x21c044,'totalRevenue':Math[_0x17a212(0x1ad)](_0x16b9c6*0x64)/0x64,'conversionRate':Math[_0x17a212(0x1ad)](_0x3f2463*0x64)/0x64,'recentPayments':_0x2efada['map'](_0x10ebf1=>({'id':_0x10ebf1['id'],'amount':_0x10ebf1[_0x17a212(0x188)],'currency':_0x10ebf1[_0x17a212(0x187)],'status':_0x10ebf1[_0x17a212(0x16b)],'gateway':_0x10ebf1[_0x17a212(0x186)],'shop':_0x10ebf1[_0x17a212(0x1d4)],'createdAt':_0x10ebf1['createdAt']}))};}async[a35_0x1cb8f9(0x222)](_0x3066e0){const _0x287533=a35_0x1cb8f9;console[_0x287533(0x194)](_0x287533(0x190),_0x3066e0);let _0x2b21a5,_0x568937=new Date();if(_0x3066e0[_0x287533(0x1dc)]===_0x287533(0x1f0)&&_0x3066e0[_0x287533(0x216)]&&_0x3066e0[_0x287533(0x1c5)])_0x2b21a5=new Date(_0x3066e0[_0x287533(0x216)]),_0x568937=new Date(_0x3066e0['dateTo']);else{const _0xd86dcb=new Date();switch(_0x3066e0['period']){case _0x287533(0x1b1):_0x2b21a5=new Date(_0xd86dcb[_0x287533(0x1b6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x287533(0x22e):_0x2b21a5=new Date(_0xd86dcb[_0x287533(0x1b6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x287533(0x168):_0x2b21a5=new Date(_0xd86dcb[_0x287533(0x1b6)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x2b21a5=new Date(_0x287533(0x1ce));break;}}console['log'](_0x287533(0x1ab)+_0x2b21a5['toISOString']()+_0x287533(0x1f7)+_0x568937[_0x287533(0x208)]());const _0x5b3c8b={'status':_0x287533(0x1d5),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x2b21a5,'lte':_0x568937}};_0x3066e0[_0x287533(0x231)]&&(_0x5b3c8b[_0x287533(0x231)]=_0x3066e0[_0x287533(0x231)]);const _0x5a7432=await database_1['default']['payment'][_0x287533(0x1f1)]({'where':_0x5b3c8b,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x287533(0x194)]('💰\x20Found\x20'+_0x5a7432[_0x287533(0x1ea)]+_0x287533(0x201));const _0x1a8a3d={'gateway':{'not':_0x287533(0x18f)},'createdAt':{'gte':_0x2b21a5,'lte':_0x568937}};_0x3066e0[_0x287533(0x231)]&&(_0x1a8a3d[_0x287533(0x231)]=_0x3066e0[_0x287533(0x231)]);const _0x1feb0f=await database_1[_0x287533(0x179)][_0x287533(0x1ae)][_0x287533(0x1b8)]({'where':_0x1a8a3d});console[_0x287533(0x194)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x1feb0f+',\x20successful:\x20'+_0x5a7432['length']);let _0x10cea9=0x0,_0x32d10a=0x0,_0x477b4f=0x0;const _0x2b6799={},_0x21edd7={},_0x28832d={};for(const _0xbe6ac0 of _0x5a7432){try{const _0x1bbb3a=await currencyService_1[_0x287533(0x202)][_0x287533(0x17b)](_0xbe6ac0[_0x287533(0x188)],_0xbe6ac0[_0x287533(0x187)]);let _0x238872={};if(_0xbe6ac0[_0x287533(0x1d4)][_0x287533(0x1e3)])try{_0x238872=JSON[_0x287533(0x230)](_0xbe6ac0[_0x287533(0x1d4)][_0x287533(0x1e3)]);}catch(_0x3da249){console[_0x287533(0x17d)](_0x287533(0x199)+_0xbe6ac0['shopId']+':',_0x3da249);}const _0x541585=_0x238872[_0xbe6ac0['gateway']]||{},_0x1a8b4c=_0x541585['commission']||0xa,_0x3d67ac=_0x1bbb3a*(_0x1a8b4c/0x64),_0x41e709=_0x1bbb3a-_0x3d67ac;_0x10cea9+=_0x1bbb3a,_0x32d10a+=_0x41e709,_0x477b4f+=_0x3d67ac;!_0x2b6799[_0xbe6ac0['gateway']]&&(_0x2b6799[_0xbe6ac0[_0x287533(0x186)]]={'gateway':_0xbe6ac0[_0x287533(0x186)],'gatewayDisplayName':this[_0x287533(0x1c7)](_0xbe6ac0[_0x287533(0x186)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2b6799[_0xbe6ac0[_0x287533(0x186)]][_0x287533(0x170)]++,_0x2b6799[_0xbe6ac0[_0x287533(0x186)]]['turnoverUSDT']+=_0x1bbb3a,_0x2b6799[_0xbe6ac0[_0x287533(0x186)]][_0x287533(0x15c)]+=_0x3d67ac,_0x2b6799[_0xbe6ac0[_0x287533(0x186)]]['merchantEarningsUSDT']+=_0x41e709,_0x2b6799[_0xbe6ac0[_0x287533(0x186)]][_0x287533(0x17f)]+=_0x1a8b4c;!_0x3066e0[_0x287533(0x231)]&&(!_0x21edd7[_0xbe6ac0[_0x287533(0x231)]]&&(_0x21edd7[_0xbe6ac0[_0x287533(0x231)]]={'shopId':_0xbe6ac0['shopId'],'shopName':_0xbe6ac0['shop'][_0x287533(0x1a5)],'shopUsername':_0xbe6ac0[_0x287533(0x1d4)][_0x287533(0x1c9)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x21edd7[_0xbe6ac0[_0x287533(0x231)]][_0x287533(0x170)]++,_0x21edd7[_0xbe6ac0[_0x287533(0x231)]][_0x287533(0x1a0)]+=_0x1bbb3a,_0x21edd7[_0xbe6ac0['shopId']][_0x287533(0x15c)]+=_0x3d67ac,_0x21edd7[_0xbe6ac0[_0x287533(0x231)]][_0x287533(0x1c3)]+=_0x41e709);const _0x573b2b=_0xbe6ac0['paidAt']['toISOString']()['split']('T')[0x0];!_0x28832d[_0x573b2b]&&(_0x28832d[_0x573b2b]={'date':_0x573b2b,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x28832d[_0x573b2b][_0x287533(0x193)]+=_0x1bbb3a,_0x28832d[_0x573b2b][_0x287533(0x1d1)]+=_0x41e709,_0x28832d[_0x573b2b][_0x287533(0x1a4)]+=_0x3d67ac,_0x28832d[_0x573b2b][_0x287533(0x170)]++;}catch(_0xe21fa){console[_0x287533(0x17d)](_0x287533(0x1d3)+_0xbe6ac0['id']+':',_0xe21fa);}}Object[_0x287533(0x1f4)](_0x2b6799)[_0x287533(0x20d)](_0x45daa8=>{const _0x2728cc=_0x287533;_0x45daa8[_0x2728cc(0x21c)]=_0x45daa8['paymentsCount']>0x0?_0x45daa8[_0x2728cc(0x17f)]/_0x45daa8['paymentsCount']:0x0,delete _0x45daa8[_0x2728cc(0x17f)];}),Object[_0x287533(0x1f4)](_0x21edd7)[_0x287533(0x20d)](_0x4dedd1=>{const _0x3158f4=_0x287533;_0x4dedd1[_0x3158f4(0x1d9)]=_0x4dedd1[_0x3158f4(0x170)]>0x0?_0x4dedd1[_0x3158f4(0x1a0)]/_0x4dedd1[_0x3158f4(0x170)]:0x0;});let _0x3438ea=0x0;if(_0x3066e0['shopId']){const _0x4f0a31=await database_1['default']['payout'][_0x287533(0x1f1)]({'where':{'shopId':_0x3066e0['shopId'],'status':_0x287533(0x1d2),'createdAt':{'gte':_0x2b21a5,'lte':_0x568937}},'select':{'amount':!![]}});_0x3438ea=_0x4f0a31[_0x287533(0x1a7)]((_0x105439,_0x4a4cda)=>_0x105439+_0x4a4cda[_0x287533(0x188)],0x0);}const _0x5ba1a6=_0x1feb0f,_0x7248cf=_0x5a7432[_0x287533(0x1ea)],_0x531c9f=_0x7248cf>0x0?_0x10cea9/_0x7248cf:0x0,_0xa68d68=_0x5ba1a6>0x0?Math[_0x287533(0x1ad)](_0x7248cf/_0x5ba1a6*0x2710)/0x64:0x0,_0xb5ab1e=Math['ceil']((_0x568937[_0x287533(0x1b6)]()-_0x2b21a5['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x50aacc={'totalTurnover':Math['round'](_0x10cea9*0x64)/0x64,'merchantEarnings':Math[_0x287533(0x1ad)](_0x32d10a*0x64)/0x64,'gatewayEarnings':Math[_0x287533(0x1ad)](_0x477b4f*0x64)/0x64,'totalPaidOut':Math['round'](_0x3438ea*0x64)/0x64,'averageCheck':Math['round'](_0x531c9f*0x64)/0x64,'totalPayments':_0x5ba1a6,'successfulPayments':_0x7248cf,'conversionRate':_0xa68d68,'gatewayBreakdown':Object[_0x287533(0x1f4)](_0x2b6799)[_0x287533(0x1e6)](_0x5724bf=>({..._0x5724bf,'turnoverUSDT':Math[_0x287533(0x1ad)](_0x5724bf[_0x287533(0x1a0)]*0x64)/0x64,'commissionUSDT':Math[_0x287533(0x1ad)](_0x5724bf[_0x287533(0x15c)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x5724bf[_0x287533(0x1c3)]*0x64)/0x64,'averageCommissionRate':Math[_0x287533(0x1ad)](_0x5724bf[_0x287533(0x21c)]*0x64)/0x64})),'merchantBreakdown':_0x3066e0[_0x287533(0x231)]?undefined:Object[_0x287533(0x1f4)](_0x21edd7)[_0x287533(0x1e6)](_0x50fae9=>({..._0x50fae9,'turnoverUSDT':Math['round'](_0x50fae9[_0x287533(0x1a0)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x50fae9[_0x287533(0x15c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x287533(0x1ad)](_0x50fae9[_0x287533(0x1c3)]*0x64)/0x64,'paidOutUSDT':Math[_0x287533(0x1ad)](_0x50fae9[_0x287533(0x18d)]*0x64)/0x64,'averageCheckUSDT':Math[_0x287533(0x1ad)](_0x50fae9[_0x287533(0x1d9)]*0x64)/0x64})),'dailyData':Object[_0x287533(0x1f4)](_0x28832d)[_0x287533(0x1e6)](_0x211b69=>({..._0x211b69,'turnover':Math[_0x287533(0x1ad)](_0x211b69['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x287533(0x1ad)](_0x211b69[_0x287533(0x1d1)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x211b69[_0x287533(0x1a4)]*0x64)/0x64}))[_0x287533(0x207)]((_0x39736c,_0x9d9ca6)=>_0x39736c[_0x287533(0x223)]['localeCompare'](_0x9d9ca6[_0x287533(0x223)])),'periodInfo':{'from':_0x2b21a5,'to':_0x568937,'periodType':_0x3066e0[_0x287533(0x1dc)]||'custom','daysCount':_0xb5ab1e}};return console[_0x287533(0x194)](_0x287533(0x226)),console[_0x287533(0x194)](_0x287533(0x1eb)+_0x50aacc[_0x287533(0x191)]+_0x287533(0x22b)),console[_0x287533(0x194)](_0x287533(0x18b)+_0x50aacc['merchantEarnings']+_0x287533(0x22b)),console[_0x287533(0x194)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x50aacc[_0x287533(0x1a4)]+'\x20USDT'),console[_0x287533(0x194)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x50aacc[_0x287533(0x20a)]),_0x50aacc;}[a35_0x1cb8f9(0x1c7)](_0x21ba3d){const _0x4d4692=a35_0x1cb8f9,_0x4a54e6={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':'Rapyd','noda':_0x4d4692(0x213),'cointopay':'CoinToPay','klyme_eu':_0x4d4692(0x21e),'klyme_gb':'KLYME\x20GB','klyme_de':_0x4d4692(0x1cd)};return _0x4a54e6[_0x21ba3d]||_0x21ba3d;}async['getMerchantsAwaitingPayout'](_0x5df9d8){const _0x55eca7=a35_0x1cb8f9,{page:_0x4456b5,limit:_0x459c3d,minAmount:_0x21a4e3,search:_0x12584a}=_0x5df9d8,_0x34089f=(_0x4456b5-0x1)*_0x459c3d;console[_0x55eca7(0x194)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x5df9d8);const _0x5e64c0={'balance':{'gt':0x0},'status':_0x55eca7(0x1f9)};_0x21a4e3&&(_0x5e64c0[_0x55eca7(0x22d)][_0x55eca7(0x19e)]=_0x21a4e3);_0x12584a&&(_0x5e64c0['OR']=[{'name':{'contains':_0x12584a,'mode':'insensitive'}},{'username':{'contains':_0x12584a,'mode':_0x55eca7(0x181)}}]);const [_0x1e3ea7,_0x23bf71]=await Promise[_0x55eca7(0x217)]([database_1[_0x55eca7(0x179)]['shop'][_0x55eca7(0x1f1)]({'where':_0x5e64c0,'skip':_0x34089f,'take':_0x459c3d,'orderBy':{'balance':_0x55eca7(0x21d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x55eca7(0x1b8)]({'where':_0x5e64c0})]);console[_0x55eca7(0x194)](_0x55eca7(0x178)+_0x1e3ea7[_0x55eca7(0x1ea)]+_0x55eca7(0x165));const _0x4886c1=await Promise[_0x55eca7(0x217)](_0x1e3ea7[_0x55eca7(0x1e6)](async _0x64b31d=>{const _0x5d679b=_0x55eca7,[_0x5d8f2c,_0x4cbb85,_0x28cfcf]=await Promise[_0x5d679b(0x217)]([database_1[_0x5d679b(0x179)][_0x5d679b(0x1ae)][_0x5d679b(0x1b8)]({'where':{'shopId':_0x64b31d['id'],'status':_0x5d679b(0x1d5),'amountUSDT':{'not':null}}}),database_1[_0x5d679b(0x179)]['payment']['findFirst']({'where':{'shopId':_0x64b31d['id'],'status':'PAID','amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x5d679b(0x1ff)},'select':{'paidAt':!![]}}),database_1[_0x5d679b(0x179)][_0x5d679b(0x1ae)][_0x5d679b(0x1e5)]({'by':[_0x5d679b(0x186)],'where':{'shopId':_0x64b31d['id'],'status':_0x5d679b(0x1d5),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x38fbef=_0x28cfcf[_0x5d679b(0x1e6)](_0xb7d71f=>({'gateway':_0xb7d71f[_0x5d679b(0x186)],'count':_0xb7d71f[_0x5d679b(0x20c)]['id'],'amountUSDT':_0xb7d71f[_0x5d679b(0x1a3)]['amountUSDT']||0x0,'amountAfterCommissionUSDT':_0xb7d71f[_0x5d679b(0x1a3)][_0x5d679b(0x228)]||0x0,'commission':0x0}));return{'id':_0x64b31d['id'],'fullName':_0x64b31d['name'],'username':_0x64b31d[_0x5d679b(0x1c9)],'telegramId':_0x64b31d[_0x5d679b(0x232)],'merchantUrl':_0x64b31d[_0x5d679b(0x173)],'wallets':{'usdtPolygonWallet':_0x64b31d['usdtPolygonWallet'],'usdtTrcWallet':_0x64b31d['usdtTrcWallet'],'usdtErcWallet':_0x64b31d['usdtErcWallet'],'usdcPolygonWallet':_0x64b31d[_0x5d679b(0x1c4)]},'totalAmountUSDT':_0x64b31d[_0x5d679b(0x22d)],'totalAmountAfterCommissionUSDT':_0x64b31d['balance'],'paymentsCount':_0x5d8f2c,'oldestPaymentDate':_0x4cbb85?.['paidAt']||_0x64b31d[_0x5d679b(0x159)],'gatewayBreakdown':_0x38fbef};})),_0x177c8a=_0x1e3ea7[_0x55eca7(0x1a7)]((_0x63291c,_0x1f3a5c)=>_0x63291c+_0x1f3a5c[_0x55eca7(0x22d)],0x0),_0xa4b595=_0x177c8a;return console['log'](_0x55eca7(0x1dd)+_0x23bf71+_0x55eca7(0x1f2)+Math[_0x55eca7(0x1ad)](_0xa4b595*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x4886c1,'pagination':{'page':_0x4456b5,'limit':_0x459c3d,'total':_0x23bf71,'totalPages':Math[_0x55eca7(0x1ac)](_0x23bf71/_0x459c3d)},'summary':{'totalMerchants':_0x23bf71,'totalAmountUSDT':Math['round'](_0x177c8a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x55eca7(0x1ad)](_0xa4b595*0x64)/0x64}};}async['createPayout'](_0x493055){const _0x7a6ec3=a35_0x1cb8f9,{shopId:_0x3caf2c,amount:_0x323b6d,network:_0x445fc2,wallet:_0x5c1b40,notes:_0x2ca5d5,txid:_0x368c7b,periodFrom:_0x212188,periodTo:_0xdc4074}=_0x493055,_0x14dc0e=await database_1[_0x7a6ec3(0x179)][_0x7a6ec3(0x211)](async _0x3f1759=>{const _0x18a6a8=_0x7a6ec3,_0x59c20b=await _0x3f1759[_0x18a6a8(0x1d4)]['findUnique']({'where':{'id':_0x3caf2c},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x59c20b)throw new Error(_0x18a6a8(0x1b2));console[_0x18a6a8(0x194)](_0x18a6a8(0x197)+_0x59c20b[_0x18a6a8(0x1c9)]+':'),console[_0x18a6a8(0x194)](_0x18a6a8(0x196)+_0x59c20b[_0x18a6a8(0x22d)][_0x18a6a8(0x16c)](0x6)+_0x18a6a8(0x22b)),console[_0x18a6a8(0x194)](_0x18a6a8(0x1bc)+_0x323b6d['toFixed'](0x6)+_0x18a6a8(0x22b)),console[_0x18a6a8(0x194)](_0x18a6a8(0x22a)+_0x59c20b[_0x18a6a8(0x1af)][_0x18a6a8(0x16c)](0x6)+_0x18a6a8(0x22b));if(_0x368c7b)console[_0x18a6a8(0x194)](_0x18a6a8(0x1e7)+_0x368c7b);if(_0x59c20b[_0x18a6a8(0x22d)]<_0x323b6d)throw new Error(_0x18a6a8(0x1d8)+_0x59c20b[_0x18a6a8(0x22d)][_0x18a6a8(0x16c)](0x6)+_0x18a6a8(0x1b7)+_0x323b6d[_0x18a6a8(0x16c)](0x6)+_0x18a6a8(0x22b));let _0x12a4e0=_0x5c1b40;if(!_0x12a4e0){const _0x50e3b8=await _0x3f1759[_0x18a6a8(0x1d4)][_0x18a6a8(0x15b)]({'where':{'id':_0x3caf2c},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x50e3b8)switch(_0x445fc2){case'polygon':_0x12a4e0=_0x50e3b8['usdtPolygonWallet']||undefined;break;case _0x18a6a8(0x1a1):_0x12a4e0=_0x50e3b8[_0x18a6a8(0x1ed)]||undefined;break;case _0x18a6a8(0x167):_0x12a4e0=_0x50e3b8[_0x18a6a8(0x163)]||undefined;break;case _0x18a6a8(0x1c8):_0x12a4e0=_0x50e3b8[_0x18a6a8(0x1c4)]||undefined;break;}}console[_0x18a6a8(0x194)](_0x18a6a8(0x19b)+_0x445fc2+':\x20'+(_0x12a4e0||_0x18a6a8(0x17e)));const _0x4dea39=await _0x3f1759[_0x18a6a8(0x18a)][_0x18a6a8(0x1d6)]({'data':{'shopId':_0x3caf2c,'amount':_0x323b6d,'network':_0x445fc2,'status':_0x18a6a8(0x1d2),'txid':_0x368c7b,'notes':_0x2ca5d5,'periodFrom':_0x212188?new Date(_0x212188):null,'periodTo':_0xdc4074?new Date(_0xdc4074):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x211e18=_0x59c20b['balance']-_0x323b6d,_0x307e88=_0x59c20b[_0x18a6a8(0x1af)]+_0x323b6d;return await _0x3f1759[_0x18a6a8(0x1d4)][_0x18a6a8(0x1cb)]({'where':{'id':_0x3caf2c},'data':{'balance':_0x211e18,'totalPaidOut':_0x307e88}}),console[_0x18a6a8(0x194)](_0x18a6a8(0x1f6)+_0x59c20b[_0x18a6a8(0x1c9)]+'\x20balance\x20updated:'),console[_0x18a6a8(0x194)](_0x18a6a8(0x1b9)+_0x59c20b[_0x18a6a8(0x22d)][_0x18a6a8(0x16c)](0x6)+_0x18a6a8(0x18e)+_0x211e18[_0x18a6a8(0x16c)](0x6)+'\x20USDT\x20(-'+_0x323b6d['toFixed'](0x6)+')'),console[_0x18a6a8(0x194)](_0x18a6a8(0x1f3)+_0x59c20b[_0x18a6a8(0x1af)][_0x18a6a8(0x16c)](0x6)+'\x20->\x20'+_0x307e88[_0x18a6a8(0x16c)](0x6)+'\x20USDT\x20(+'+_0x323b6d[_0x18a6a8(0x16c)](0x6)+')'),{'payout':_0x4dea39,'shop':_0x59c20b};});return console['log'](_0x7a6ec3(0x1ba)+_0x14dc0e[_0x7a6ec3(0x18a)]['id']+_0x7a6ec3(0x180)+_0x14dc0e[_0x7a6ec3(0x1d4)][_0x7a6ec3(0x1c9)]+'\x20('+_0x323b6d+_0x7a6ec3(0x17c)),{'id':_0x14dc0e[_0x7a6ec3(0x18a)]['id'],'shopId':_0x14dc0e[_0x7a6ec3(0x18a)][_0x7a6ec3(0x231)],'shopName':_0x14dc0e['shop'][_0x7a6ec3(0x1a5)],'shopUsername':_0x14dc0e[_0x7a6ec3(0x1d4)][_0x7a6ec3(0x1c9)],'amount':_0x14dc0e['payout'][_0x7a6ec3(0x188)],'network':_0x14dc0e[_0x7a6ec3(0x18a)]['network'],'status':_0x14dc0e[_0x7a6ec3(0x18a)]['status'],'txid':_0x14dc0e[_0x7a6ec3(0x18a)][_0x7a6ec3(0x218)],'notes':_0x14dc0e[_0x7a6ec3(0x18a)][_0x7a6ec3(0x15a)],'periodFrom':_0x14dc0e[_0x7a6ec3(0x18a)]['periodFrom'],'periodTo':_0x14dc0e[_0x7a6ec3(0x18a)][_0x7a6ec3(0x16e)],'createdAt':_0x14dc0e['payout'][_0x7a6ec3(0x159)],'paidAt':_0x14dc0e[_0x7a6ec3(0x18a)][_0x7a6ec3(0x18c)]};}async[a35_0x1cb8f9(0x20b)](_0x36288d){const _0x6dc27e=a35_0x1cb8f9,{page:_0x2c936a,limit:_0x5c528e,shopId:_0x3c272a,network:_0x3c12a5,dateFrom:_0x2c9298,dateTo:_0x4f807a,search:_0x3eb102}=_0x36288d,_0x5f044c=(_0x2c936a-0x1)*_0x5c528e,_0x418014={};_0x3c272a&&(_0x418014[_0x6dc27e(0x231)]=_0x3c272a);_0x3c12a5&&(_0x418014[_0x6dc27e(0x206)]=_0x3c12a5);(_0x2c9298||_0x4f807a)&&(_0x418014[_0x6dc27e(0x159)]={},_0x2c9298&&(_0x418014[_0x6dc27e(0x159)][_0x6dc27e(0x19e)]=new Date(_0x2c9298)),_0x4f807a&&(_0x418014[_0x6dc27e(0x159)][_0x6dc27e(0x1bd)]=new Date(_0x4f807a)));_0x3eb102&&(_0x418014['OR']=[{'shop':{'name':{'contains':_0x3eb102,'mode':_0x6dc27e(0x181)}}},{'shop':{'username':{'contains':_0x3eb102,'mode':_0x6dc27e(0x181)}}},{'notes':{'contains':_0x3eb102,'mode':_0x6dc27e(0x181)}}]);const [_0x4407fd,_0x1a0939]=await Promise['all']([database_1[_0x6dc27e(0x179)][_0x6dc27e(0x18a)][_0x6dc27e(0x1f1)]({'where':_0x418014,'skip':_0x5f044c,'take':_0x5c528e,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x6dc27e(0x179)][_0x6dc27e(0x18a)][_0x6dc27e(0x1b8)]({'where':_0x418014})]);return{'payouts':_0x4407fd['map'](_0x5ab362=>({'id':_0x5ab362['id'],'shopId':_0x5ab362[_0x6dc27e(0x231)],'shopName':_0x5ab362[_0x6dc27e(0x1d4)]['name'],'shopUsername':_0x5ab362['shop'][_0x6dc27e(0x1c9)],'amount':_0x5ab362[_0x6dc27e(0x188)],'network':_0x5ab362[_0x6dc27e(0x206)],'status':_0x5ab362['status'],'txid':_0x5ab362[_0x6dc27e(0x218)],'notes':_0x5ab362[_0x6dc27e(0x15a)],'periodFrom':_0x5ab362[_0x6dc27e(0x210)],'periodTo':_0x5ab362[_0x6dc27e(0x16e)],'createdAt':_0x5ab362['createdAt'],'paidAt':_0x5ab362['paidAt']})),'pagination':{'page':_0x2c936a,'limit':_0x5c528e,'total':_0x1a0939,'totalPages':Math[_0x6dc27e(0x1ac)](_0x1a0939/_0x5c528e)}};}async['getPayoutById'](_0x262c97){const _0x5e4369=a35_0x1cb8f9,_0x2d79b0=await database_1[_0x5e4369(0x179)][_0x5e4369(0x18a)][_0x5e4369(0x15b)]({'where':{'id':_0x262c97},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2d79b0)return null;return{'id':_0x2d79b0['id'],'shopId':_0x2d79b0[_0x5e4369(0x231)],'shopName':_0x2d79b0[_0x5e4369(0x1d4)][_0x5e4369(0x1a5)],'shopUsername':_0x2d79b0['shop']['username'],'amount':_0x2d79b0['amount'],'network':_0x2d79b0[_0x5e4369(0x206)],'status':_0x2d79b0[_0x5e4369(0x16b)],'txid':_0x2d79b0[_0x5e4369(0x218)],'notes':_0x2d79b0[_0x5e4369(0x15a)],'periodFrom':_0x2d79b0[_0x5e4369(0x210)],'periodTo':_0x2d79b0[_0x5e4369(0x16e)],'createdAt':_0x2d79b0[_0x5e4369(0x159)],'paidAt':_0x2d79b0[_0x5e4369(0x18c)]};}async[a35_0x1cb8f9(0x204)](_0x977fe6){const _0x10ab30=a35_0x1cb8f9;await database_1[_0x10ab30(0x179)][_0x10ab30(0x18a)]['delete']({'where':{'id':_0x977fe6}});}async['getAllPayments'](_0x2d61da){const _0x4b7df3=a35_0x1cb8f9,{page:_0x2befbf,limit:_0x30f661,status:_0x52176e,gateway:_0x57733c,shopId:_0x399090,dateFrom:_0x5bff25,dateTo:_0x18f3f8,search:_0x19aa6f}=_0x2d61da,_0x1376b0=(_0x2befbf-0x1)*_0x30f661,_0x52f9af={};_0x52176e&&(_0x52f9af[_0x4b7df3(0x16b)]=_0x52176e[_0x4b7df3(0x183)]());_0x57733c&&(_0x52f9af['gateway']=_0x57733c[_0x4b7df3(0x225)]());_0x52f9af[_0x4b7df3(0x186)]=_0x52f9af['gateway']?_0x52f9af[_0x4b7df3(0x186)]:{'not':'test_gateway'};if(typeof _0x52f9af[_0x4b7df3(0x186)]===_0x4b7df3(0x1c2)&&_0x52f9af[_0x4b7df3(0x186)]!=='test_gateway'){}else{if(typeof _0x52f9af['gateway']===_0x4b7df3(0x1c2)&&_0x52f9af[_0x4b7df3(0x186)]==='test_gateway'){}else _0x52f9af['gateway']={'not':_0x4b7df3(0x18f)};}_0x399090&&(_0x52f9af['shopId']=_0x399090);(_0x5bff25||_0x18f3f8)&&(_0x52f9af['createdAt']={},_0x5bff25&&(_0x52f9af['createdAt'][_0x4b7df3(0x19e)]=new Date(_0x5bff25)),_0x18f3f8&&(_0x52f9af[_0x4b7df3(0x159)]['lte']=new Date(_0x18f3f8)));_0x19aa6f&&(_0x52f9af['OR']=[{'orderId':{'contains':_0x19aa6f,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x19aa6f,'mode':_0x4b7df3(0x181)}},{'customerEmail':{'contains':_0x19aa6f,'mode':_0x4b7df3(0x181)}},{'shop':{'name':{'contains':_0x19aa6f,'mode':_0x4b7df3(0x181)}}},{'shop':{'username':{'contains':_0x19aa6f,'mode':_0x4b7df3(0x181)}}}]);const [_0x2c971d,_0x485141]=await Promise[_0x4b7df3(0x217)]([database_1[_0x4b7df3(0x179)][_0x4b7df3(0x1ae)][_0x4b7df3(0x1f1)]({'where':_0x52f9af,'skip':_0x1376b0,'take':_0x30f661,'orderBy':{'createdAt':_0x4b7df3(0x21d)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4b7df3(0x1ae)][_0x4b7df3(0x1b8)]({'where':_0x52f9af})]);return{'payments':_0x2c971d[_0x4b7df3(0x1e6)](_0x117eb5=>({'id':_0x117eb5['id'],'shopId':_0x117eb5[_0x4b7df3(0x231)],'gateway':_0x117eb5['gateway'],'amount':_0x117eb5[_0x4b7df3(0x188)],'currency':_0x117eb5[_0x4b7df3(0x187)],'status':_0x117eb5[_0x4b7df3(0x16b)],'orderId':_0x117eb5[_0x4b7df3(0x19f)],'gatewayOrderId':_0x117eb5[_0x4b7df3(0x160)],'customerEmail':_0x117eb5['customerEmail'],'customerName':_0x117eb5[_0x4b7df3(0x1a6)],'customerCountry':_0x117eb5['customerCountry'],'customerIp':_0x117eb5['customerIp'],'customerUa':_0x117eb5[_0x4b7df3(0x175)],'failureMessage':_0x117eb5[_0x4b7df3(0x19a)],'createdAt':_0x117eb5[_0x4b7df3(0x159)],'updatedAt':_0x117eb5[_0x4b7df3(0x164)],'shop':_0x117eb5['shop']})),'pagination':{'page':_0x2befbf,'limit':_0x30f661,'total':_0x485141,'totalPages':Math[_0x4b7df3(0x1ac)](_0x485141/_0x30f661)}};}async[a35_0x1cb8f9(0x205)](_0x6558af){const _0x2ae20f=a35_0x1cb8f9,_0xc5ac53=await database_1[_0x2ae20f(0x179)][_0x2ae20f(0x1ae)]['findUnique']({'where':{'id':_0x6558af},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xc5ac53)return null;return{'id':_0xc5ac53['id'],'shopId':_0xc5ac53[_0x2ae20f(0x231)],'gateway':_0xc5ac53[_0x2ae20f(0x186)],'amount':_0xc5ac53['amount'],'currency':_0xc5ac53['currency'],'status':_0xc5ac53['status'],'orderId':_0xc5ac53[_0x2ae20f(0x19f)],'gatewayOrderId':_0xc5ac53[_0x2ae20f(0x160)],'customerEmail':_0xc5ac53[_0x2ae20f(0x195)],'customerName':_0xc5ac53[_0x2ae20f(0x1a6)],'customerCountry':_0xc5ac53[_0x2ae20f(0x1da)],'customerIp':_0xc5ac53[_0x2ae20f(0x1a2)],'customerUa':_0xc5ac53[_0x2ae20f(0x175)],'failureMessage':_0xc5ac53[_0x2ae20f(0x19a)],'externalPaymentUrl':_0xc5ac53[_0x2ae20f(0x1a9)],'successUrl':_0xc5ac53[_0x2ae20f(0x200)],'failUrl':_0xc5ac53[_0x2ae20f(0x1bf)],'pendingUrl':_0xc5ac53[_0x2ae20f(0x177)],'whiteUrl':_0xc5ac53[_0x2ae20f(0x15e)],'createdAt':_0xc5ac53[_0x2ae20f(0x159)],'updatedAt':_0xc5ac53[_0x2ae20f(0x164)],'shop':_0xc5ac53[_0x2ae20f(0x1d4)]};}async[a35_0x1cb8f9(0x1de)](_0x4eecb8,_0x9d3224,_0x9d3a0c,_0xfa1f89){const _0x15f548=a35_0x1cb8f9,_0x31a0c9=await database_1['default'][_0x15f548(0x211)](async _0x5d1566=>{const _0x43815d=_0x15f548,_0x4f2772=await _0x5d1566['payment']['findUnique']({'where':{'id':_0x4eecb8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4f2772)throw new Error(_0x43815d(0x22f));const _0x6d68ef=_0x4f2772[_0x43815d(0x16b)],_0x5ae2df=_0x9d3224[_0x43815d(0x183)]();console[_0x43815d(0x194)](_0x43815d(0x1b4)+_0x4eecb8+'\x20status:\x20'+_0x6d68ef+_0x43815d(0x18e)+_0x5ae2df),console[_0x43815d(0x194)](_0x43815d(0x1f8)+_0x4f2772[_0x43815d(0x1d4)][_0x43815d(0x22d)]+_0x43815d(0x22b));const _0x248999={'status':_0x5ae2df,'updatedAt':new Date(),'statusChangedBy':_0x43815d(0x21a),'statusChangedAt':new Date()};_0x9d3a0c&&(_0x248999['adminNotes']=_0x9d3a0c);_0x5ae2df===_0x43815d(0x185)&&_0xfa1f89&&(_0x248999[_0x43815d(0x192)]=_0xfa1f89);let _0x10c4e7=0x0,_0x22e324=_0x4f2772[_0x43815d(0x1d4)][_0x43815d(0x22d)];if(_0x5ae2df===_0x43815d(0x1d5)&&_0x6d68ef!==_0x43815d(0x1d5)){_0x248999[_0x43815d(0x18c)]=new Date();const _0xbd7e42=await currencyService_1[_0x43815d(0x202)][_0x43815d(0x17b)](_0x4f2772[_0x43815d(0x188)],_0x4f2772[_0x43815d(0x187)]);_0x248999[_0x43815d(0x228)]=_0xbd7e42,_0x10c4e7=_0xbd7e42,_0x22e324+=_0xbd7e42,console['log']('💰\x20Payment\x20'+_0x4eecb8+'\x20became\x20PAID:\x20+'+_0xbd7e42[_0x43815d(0x16c)](0x6)+'\x20USDT\x20to\x20balance');}else _0x6d68ef===_0x43815d(0x1d5)&&_0x5ae2df!==_0x43815d(0x1d5)&&(_0x4f2772[_0x43815d(0x228)]&&(_0x10c4e7=-_0x4f2772[_0x43815d(0x228)],_0x22e324-=_0x4f2772['amountUSDT'],_0x248999[_0x43815d(0x228)]=null,console[_0x43815d(0x194)](_0x43815d(0x20e)+_0x4eecb8+_0x43815d(0x214)+_0x4f2772['amountUSDT'][_0x43815d(0x16c)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x5ae2df===_0x43815d(0x185)){if(_0x6d68ef==='PAID'&&_0x4f2772[_0x43815d(0x228)]){}_0xfa1f89&&_0xfa1f89>0x0&&(_0x10c4e7-=_0xfa1f89,_0x22e324-=_0xfa1f89,console[_0x43815d(0x194)](_0x43815d(0x1e2)+_0xfa1f89[_0x43815d(0x16c)](0x6)+'\x20USDT\x20from\x20balance'));}_0x5ae2df===_0x43815d(0x1e8)&&_0x6d68ef===_0x43815d(0x1d5)&&console['log']('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x3a7dd7=await _0x5d1566[_0x43815d(0x1ae)][_0x43815d(0x1cb)]({'where':{'id':_0x4eecb8},'data':_0x248999,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x10c4e7!==0x0&&(await _0x5d1566[_0x43815d(0x1d4)][_0x43815d(0x1cb)]({'where':{'id':_0x4f2772[_0x43815d(0x231)]},'data':{'balance':_0x22e324}}),console['log'](_0x43815d(0x1f6)+_0x4f2772[_0x43815d(0x231)]+_0x43815d(0x227)+_0x4f2772[_0x43815d(0x1d4)][_0x43815d(0x22d)][_0x43815d(0x16c)](0x6)+'\x20->\x20'+_0x22e324[_0x43815d(0x16c)](0x6)+_0x43815d(0x1d0)+(_0x10c4e7>0x0?'+':'')+_0x10c4e7[_0x43815d(0x16c)](0x6)+')')),_0x3a7dd7;});return{'id':_0x31a0c9['id'],'shopId':_0x31a0c9[_0x15f548(0x231)],'gateway':_0x31a0c9[_0x15f548(0x186)],'amount':_0x31a0c9[_0x15f548(0x188)],'currency':_0x31a0c9[_0x15f548(0x187)],'status':_0x31a0c9[_0x15f548(0x16b)],'orderId':_0x31a0c9['orderId'],'gatewayOrderId':_0x31a0c9['gatewayOrderId'],'customerEmail':_0x31a0c9[_0x15f548(0x195)],'customerName':_0x31a0c9['customerName'],'customerCountry':_0x31a0c9[_0x15f548(0x1da)],'customerIp':_0x31a0c9[_0x15f548(0x1a2)],'customerUa':_0x31a0c9[_0x15f548(0x175)],'failureMessage':_0x31a0c9[_0x15f548(0x19a)],'adminNotes':_0x31a0c9[_0x15f548(0x19d)],'chargebackAmount':_0x31a0c9['chargebackAmount'],'statusChangedBy':_0x31a0c9['statusChangedBy'],'statusChangedAt':_0x31a0c9[_0x15f548(0x171)],'createdAt':_0x31a0c9['createdAt'],'updatedAt':_0x31a0c9[_0x15f548(0x164)],'shop':_0x31a0c9['shop']};}async[a35_0x1cb8f9(0x16f)](_0x23050c,_0x57566c){const _0x8be825=a35_0x1cb8f9,_0x7f1002={..._0x57566c};_0x57566c[_0x8be825(0x1db)]&&(_0x7f1002[_0x8be825(0x1db)]=await bcryptjs_1['default']['hash'](_0x57566c[_0x8be825(0x1db)],0xc));_0x57566c[_0x8be825(0x1c0)]&&(_0x7f1002['name']=_0x57566c[_0x8be825(0x1c0)],delete _0x7f1002[_0x8be825(0x1c0)]);_0x57566c[_0x8be825(0x1b3)]&&(_0x7f1002[_0x8be825(0x232)]=_0x57566c[_0x8be825(0x1b3)],delete _0x7f1002['telegramId']);_0x57566c[_0x8be825(0x209)]&&(_0x7f1002['shopUrl']=_0x57566c['merchantUrl'],delete _0x7f1002[_0x8be825(0x209)]);_0x57566c[_0x8be825(0x1ca)]&&(_0x7f1002[_0x8be825(0x1b5)]=JSON['stringify'](_0x57566c[_0x8be825(0x1ca)]),delete _0x7f1002['gateways']);_0x57566c[_0x8be825(0x1e3)]&&(_0x7f1002[_0x8be825(0x1e3)]=JSON[_0x8be825(0x1e1)](_0x57566c[_0x8be825(0x1e3)]),delete _0x7f1002[_0x8be825(0x1e3)]);_0x57566c['wallets']&&(_0x57566c[_0x8be825(0x169)][_0x8be825(0x20f)]!==undefined&&(_0x7f1002[_0x8be825(0x20f)]=_0x57566c[_0x8be825(0x169)][_0x8be825(0x20f)]||null),_0x57566c['wallets'][_0x8be825(0x1ed)]!==undefined&&(_0x7f1002[_0x8be825(0x1ed)]=_0x57566c[_0x8be825(0x169)][_0x8be825(0x1ed)]||null),_0x57566c[_0x8be825(0x169)][_0x8be825(0x163)]!==undefined&&(_0x7f1002[_0x8be825(0x163)]=_0x57566c['wallets'][_0x8be825(0x163)]||null),_0x57566c['wallets'][_0x8be825(0x1c4)]!==undefined&&(_0x7f1002[_0x8be825(0x1c4)]=_0x57566c[_0x8be825(0x169)][_0x8be825(0x1c4)]||null),delete _0x7f1002['wallets']);const _0x153b98=await database_1[_0x8be825(0x179)][_0x8be825(0x1d4)][_0x8be825(0x1cb)]({'where':{'id':_0x23050c},'data':_0x7f1002,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x153b98['id'],'fullName':_0x153b98[_0x8be825(0x1a5)],'username':_0x153b98[_0x8be825(0x1c9)],'telegramId':_0x153b98['telegram'],'merchantUrl':_0x153b98[_0x8be825(0x173)],'gateways':_0x153b98[_0x8be825(0x1b5)]?JSON[_0x8be825(0x230)](_0x153b98[_0x8be825(0x1b5)]):null,'gatewaySettings':_0x153b98[_0x8be825(0x1e3)]?JSON[_0x8be825(0x230)](_0x153b98[_0x8be825(0x1e3)]):null,'publicKey':_0x153b98[_0x8be825(0x1ef)],'wallets':{'usdtPolygonWallet':_0x153b98[_0x8be825(0x20f)],'usdtTrcWallet':_0x153b98['usdtTrcWallet'],'usdtErcWallet':_0x153b98[_0x8be825(0x163)],'usdcPolygonWallet':_0x153b98['usdcPolygonWallet']},'status':_0x153b98['status'],'createdAt':_0x153b98['createdAt']};}async[a35_0x1cb8f9(0x15f)](_0xd5e372){const _0x1581e4=a35_0x1cb8f9,_0xe812bf=await database_1[_0x1581e4(0x179)][_0x1581e4(0x1d4)][_0x1581e4(0x1cb)]({'where':{'id':_0xd5e372},'data':{'status':_0x1581e4(0x1e4)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xe812bf['id'],'fullName':_0xe812bf[_0x1581e4(0x1a5)],'username':_0xe812bf[_0x1581e4(0x1c9)],'telegramId':_0xe812bf[_0x1581e4(0x232)],'merchantUrl':_0xe812bf[_0x1581e4(0x173)],'gateways':_0xe812bf[_0x1581e4(0x1b5)]?JSON[_0x1581e4(0x230)](_0xe812bf['paymentGateways']):null,'gatewaySettings':_0xe812bf[_0x1581e4(0x1e3)]?JSON[_0x1581e4(0x230)](_0xe812bf[_0x1581e4(0x1e3)]):null,'publicKey':_0xe812bf[_0x1581e4(0x1ef)],'wallets':{'usdtPolygonWallet':_0xe812bf[_0x1581e4(0x20f)],'usdtTrcWallet':_0xe812bf[_0x1581e4(0x1ed)],'usdtErcWallet':_0xe812bf[_0x1581e4(0x163)],'usdcPolygonWallet':_0xe812bf[_0x1581e4(0x1c4)]},'status':_0xe812bf[_0x1581e4(0x16b)],'createdAt':_0xe812bf[_0x1581e4(0x159)]};}async[a35_0x1cb8f9(0x224)](_0x476a01){const _0xdf8e5b=a35_0x1cb8f9,_0x4ef9dc=await database_1[_0xdf8e5b(0x179)][_0xdf8e5b(0x1d4)]['update']({'where':{'id':_0x476a01},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4ef9dc['id'],'fullName':_0x4ef9dc['name'],'username':_0x4ef9dc[_0xdf8e5b(0x1c9)],'telegramId':_0x4ef9dc['telegram'],'merchantUrl':_0x4ef9dc[_0xdf8e5b(0x173)],'gateways':_0x4ef9dc[_0xdf8e5b(0x1b5)]?JSON[_0xdf8e5b(0x230)](_0x4ef9dc[_0xdf8e5b(0x1b5)]):null,'gatewaySettings':_0x4ef9dc[_0xdf8e5b(0x1e3)]?JSON[_0xdf8e5b(0x230)](_0x4ef9dc['gatewaySettings']):null,'publicKey':_0x4ef9dc[_0xdf8e5b(0x1ef)],'wallets':{'usdtPolygonWallet':_0x4ef9dc[_0xdf8e5b(0x20f)],'usdtTrcWallet':_0x4ef9dc[_0xdf8e5b(0x1ed)],'usdtErcWallet':_0x4ef9dc['usdtErcWallet'],'usdcPolygonWallet':_0x4ef9dc[_0xdf8e5b(0x1c4)]},'status':_0x4ef9dc[_0xdf8e5b(0x16b)],'createdAt':_0x4ef9dc[_0xdf8e5b(0x159)]};}async[a35_0x1cb8f9(0x1df)](_0x324613){const _0xa09854=a35_0x1cb8f9,{page:_0x42b98e,limit:_0x4557e0,status:_0x68ebca}=_0x324613,_0x8b712e=(_0x42b98e-0x1)*_0x4557e0,_0x489f18={};_0x68ebca&&(_0x489f18[_0xa09854(0x16b)]=_0x68ebca[_0xa09854(0x183)]());const [_0x33ddd1,_0x41577b]=await Promise[_0xa09854(0x217)]([database_1[_0xa09854(0x179)]['shop'][_0xa09854(0x1f1)]({'where':_0x489f18,'skip':_0x8b712e,'take':_0x4557e0,'orderBy':{'createdAt':_0xa09854(0x21d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0xa09854(0x179)][_0xa09854(0x1d4)][_0xa09854(0x1b8)]({'where':_0x489f18})]);return{'users':_0x33ddd1[_0xa09854(0x1e6)](_0x3b51ea=>({'id':_0x3b51ea['id'],'fullName':_0x3b51ea[_0xa09854(0x1a5)],'username':_0x3b51ea[_0xa09854(0x1c9)],'telegramId':_0x3b51ea[_0xa09854(0x232)],'merchantUrl':_0x3b51ea['shopUrl'],'gateways':_0x3b51ea['paymentGateways']?JSON[_0xa09854(0x230)](_0x3b51ea[_0xa09854(0x1b5)]):null,'gatewaySettings':_0x3b51ea[_0xa09854(0x1e3)]?JSON[_0xa09854(0x230)](_0x3b51ea[_0xa09854(0x1e3)]):null,'publicKey':_0x3b51ea[_0xa09854(0x1ef)],'wallets':{'usdtPolygonWallet':_0x3b51ea[_0xa09854(0x20f)],'usdtTrcWallet':_0x3b51ea['usdtTrcWallet'],'usdtErcWallet':_0x3b51ea['usdtErcWallet'],'usdcPolygonWallet':_0x3b51ea[_0xa09854(0x1c4)]},'status':_0x3b51ea['status'],'createdAt':_0x3b51ea[_0xa09854(0x159)]})),'pagination':{'page':_0x42b98e,'limit':_0x4557e0,'total':_0x41577b,'totalPages':Math[_0xa09854(0x1ac)](_0x41577b/_0x4557e0)}};}async[a35_0x1cb8f9(0x1bb)](_0x4af189){const _0x3e8b0f=a35_0x1cb8f9,_0x2fb73f=await database_1['default'][_0x3e8b0f(0x1d4)][_0x3e8b0f(0x15b)]({'where':{'id':_0x4af189},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2fb73f)return null;return{'id':_0x2fb73f['id'],'fullName':_0x2fb73f['name'],'username':_0x2fb73f[_0x3e8b0f(0x1c9)],'telegramId':_0x2fb73f[_0x3e8b0f(0x232)],'merchantUrl':_0x2fb73f[_0x3e8b0f(0x173)],'gateways':_0x2fb73f[_0x3e8b0f(0x1b5)]?JSON[_0x3e8b0f(0x230)](_0x2fb73f['paymentGateways']):null,'gatewaySettings':_0x2fb73f[_0x3e8b0f(0x1e3)]?JSON[_0x3e8b0f(0x230)](_0x2fb73f[_0x3e8b0f(0x1e3)]):null,'publicKey':_0x2fb73f[_0x3e8b0f(0x1ef)],'wallets':{'usdtPolygonWallet':_0x2fb73f[_0x3e8b0f(0x20f)],'usdtTrcWallet':_0x2fb73f[_0x3e8b0f(0x1ed)],'usdtErcWallet':_0x2fb73f[_0x3e8b0f(0x163)],'usdcPolygonWallet':_0x2fb73f[_0x3e8b0f(0x1c4)]},'status':_0x2fb73f[_0x3e8b0f(0x16b)],'createdAt':_0x2fb73f[_0x3e8b0f(0x159)]};}async[a35_0x1cb8f9(0x1a8)](_0x5a9b03){const _0x2fabe6=a35_0x1cb8f9,{fullName:_0x25f29f,username:_0x435e73,password:_0x441d6b,telegramId:_0x29ae38,merchantUrl:_0x2ded0c,gateways:_0x162ac7,gatewaySettings:_0x40b7f3,wallets:_0xdf9bb}=_0x5a9b03,_0x542945=await database_1[_0x2fabe6(0x179)][_0x2fabe6(0x1d4)][_0x2fabe6(0x15b)]({'where':{'username':_0x435e73}});if(_0x542945)throw new Error(_0x2fabe6(0x17a));if(_0x29ae38){const _0x16f168=await database_1[_0x2fabe6(0x179)][_0x2fabe6(0x1d4)]['findUnique']({'where':{'telegram':_0x29ae38}});if(_0x16f168)throw new Error(_0x2fabe6(0x1cf));}const _0x2efed9=await bcryptjs_1[_0x2fabe6(0x179)][_0x2fabe6(0x1aa)](_0x441d6b,0xc),_0x15735a=_0x2fabe6(0x1d7)+crypto_1[_0x2fabe6(0x179)]['randomBytes'](0x20)[_0x2fabe6(0x198)](_0x2fabe6(0x184)),_0x31882f=_0x2fabe6(0x1b0)+crypto_1[_0x2fabe6(0x179)][_0x2fabe6(0x1fe)](0x20)['toString'](_0x2fabe6(0x184)),_0x3677bc=await database_1[_0x2fabe6(0x179)][_0x2fabe6(0x1d4)][_0x2fabe6(0x1d6)]({'data':{'name':_0x25f29f,'username':_0x435e73,'password':_0x2efed9,'telegram':_0x29ae38,'shopUrl':_0x2ded0c,'paymentGateways':_0x162ac7?JSON['stringify'](_0x162ac7):null,'gatewaySettings':_0x40b7f3?JSON['stringify'](_0x40b7f3):null,'usdtPolygonWallet':_0xdf9bb?.[_0x2fabe6(0x20f)]||null,'usdtTrcWallet':_0xdf9bb?.[_0x2fabe6(0x1ed)]||null,'usdtErcWallet':_0xdf9bb?.[_0x2fabe6(0x163)]||null,'usdcPolygonWallet':_0xdf9bb?.[_0x2fabe6(0x1c4)]||null,'publicKey':_0x15735a,'secretKey':_0x31882f,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3677bc['id'],'fullName':_0x3677bc[_0x2fabe6(0x1a5)],'username':_0x3677bc[_0x2fabe6(0x1c9)],'telegramId':_0x3677bc['telegram'],'merchantUrl':_0x3677bc[_0x2fabe6(0x173)],'gateways':_0x3677bc[_0x2fabe6(0x1b5)]?JSON['parse'](_0x3677bc[_0x2fabe6(0x1b5)]):null,'gatewaySettings':_0x3677bc[_0x2fabe6(0x1e3)]?JSON['parse'](_0x3677bc[_0x2fabe6(0x1e3)]):null,'publicKey':_0x3677bc[_0x2fabe6(0x1ef)],'wallets':{'usdtPolygonWallet':_0x3677bc[_0x2fabe6(0x20f)],'usdtTrcWallet':_0x3677bc[_0x2fabe6(0x1ed)],'usdtErcWallet':_0x3677bc['usdtErcWallet'],'usdcPolygonWallet':_0x3677bc[_0x2fabe6(0x1c4)]},'status':_0x3677bc['status'],'createdAt':_0x3677bc[_0x2fabe6(0x159)]};}async[a35_0x1cb8f9(0x1ee)](_0x39d569){const _0x35747d=a35_0x1cb8f9;await database_1[_0x35747d(0x179)][_0x35747d(0x1d4)][_0x35747d(0x1e0)]({'where':{'id':_0x39d569}});}}function a35_0x2a6e(_0x39f100,_0x404962){const _0x3a2012=a35_0x3a20();return a35_0x2a6e=function(_0x2a6e58,_0x2b9f4f){_0x2a6e58=_0x2a6e58-0x158;let _0x34b406=_0x3a2012[_0x2a6e58];return _0x34b406;},a35_0x2a6e(_0x39f100,_0x404962);}exports[a35_0x1cb8f9(0x1cc)]=AdminService;