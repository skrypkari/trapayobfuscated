'use strict';const a33_0x249653=a33_0x31dc;(function(_0x35cb07,_0x4d3d9b){const _0xf53655=a33_0x31dc,_0x4fe7cc=_0x35cb07();while(!![]){try{const _0x3b9af9=parseInt(_0xf53655(0x1b0))/0x1+parseInt(_0xf53655(0x1bd))/0x2+-parseInt(_0xf53655(0x200))/0x3+parseInt(_0xf53655(0x275))/0x4+parseInt(_0xf53655(0x1ae))/0x5*(-parseInt(_0xf53655(0x1a9))/0x6)+-parseInt(_0xf53655(0x217))/0x7+parseInt(_0xf53655(0x259))/0x8;if(_0x3b9af9===_0x4d3d9b)break;else _0x4fe7cc['push'](_0x4fe7cc['shift']());}catch(_0x162f38){_0x4fe7cc['push'](_0x4fe7cc['shift']());}}}(a33_0x51dd,0x59f11));var __importDefault=this&&this['__importDefault']||function(_0x3f8d83){return _0x3f8d83&&_0x3f8d83['__esModule']?_0x3f8d83:{'default':_0x3f8d83};};Object[a33_0x249653(0x244)](exports,a33_0x249653(0x237),{'value':!![]}),exports[a33_0x249653(0x231)]=void 0x0;function a33_0x31dc(_0x4f9806,_0x30b9b9){const _0x51dd82=a33_0x51dd();return a33_0x31dc=function(_0x31dcea,_0x2bf8f5){_0x31dcea=_0x31dcea-0x19c;let _0x56f10b=_0x51dd82[_0x31dcea];return _0x56f10b;},a33_0x31dc(_0x4f9806,_0x30b9b9);}const database_1=__importDefault(require(a33_0x249653(0x20d))),currencyService_1=require(a33_0x249653(0x274)),userService_1=require(a33_0x249653(0x1a8)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a33_0x249653(0x1b6));function a33_0x51dd(){const _0x3e3cef=['‚úÖ\x20Payout\x20created\x20successfully:\x20','paymentMethod','gte','entries','üí∞\x20Found\x20','customerName','üë•\x20Total\x20users:\x20','updateMany','FAILED','Payment\x20not\x20found','paymentGateways','getPayoutById','statusChangedAt','availableBalance','generateDateRange','merchantPaid','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','insensitive','get','üìà\x20Average\x20payment:\x20','6508616VAWDxg','paidAt','$queryRaw','username','length','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','slice','completed','create','expiresAt','getTime','getAllPayments','User\x20not\x20found','webhookLogs','customerEmail','log','90d','sendPayoutNotification','üí∏\x20Total\x20Payout:\x20','usdtTrcWallet','usdtErcWallet','toISOString','userService','usdcPolygonWallet','üóëÔ∏è\x20Deleting\x20payout:\x20','üí∏\x20Creating\x20payout\x20for\x20shop\x20','charAt','./currencyService','688836HUxxfN','split','admin','createUser','sourceCurrency','üè™\x20Found\x20','\x20merchants\x20out\x20of\x20',',\x20amount:\x20','üí≥\x20Total\x20payments:\x20','shop','setDate','payoutDelay','calculateEffectiveAmount','./userService','24kdYbgq','name','ceil','status','shopId','413095YdtxTG','join','231593paMPQe','‚è≥\x20Awaiting\x20Payout:\x20','awaitingPayout','remitterName','toLowerCase','delete','../types/gateway','üíµ\x20Total\x20revenue:\x20','SUSPENDED','from','totalAmountUSDT','getDate','isValidGatewayId','291548bDfvRg','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','cardLast4','PAID','sort','currency','findMany','getGatewaySettings','üìä\x20Found\x20','\x20status\x20to:\x20','\x20payments\x20out\x20of\x20','round','createPayout','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','üìä\x20Daily\x20revenue\x20entries:\x20','‚úÖ\x20Payout\x20','updatePaymentStatus','push','stringify','count','‚úÖ\x20Payment\x20','currencyService','map','usdtPolygonWallet','error','createdAt','desc','toFixed','lte','has','\x20days','payout','\x20suspended\x20successfully','date','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','User\x20is\x20already\x20active','asc','totalAmountAfterCommissionUSDT','deleteUser','üí∏\x20Chargeback\x20penalty:\x20','calculateAmountAfterCommission','ACTIVE','üìã\x20Getting\x20users\x20with\x20filters:','üí∏\x20Chargeback\x20amount:\x20','markPaymentsAsPaidOut','size','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getAllPayouts','bankId','\x20merchants\x20with\x20eligible\x20PAID\x20payments','üö´\x20Suspending\x20user:\x20','gatewayOrderId','getAllUsers','gatewayPaymentId','toUpperCase','getMerchantsAwaitingPayout','Payout\x20not\x20found','convertToUSDT','Shop\x20not\x20found','\x20USDT','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','remitterIban','payment','usage','getMonth','\x20payouts\x20out\x20of\x20','‚úÖ\x20User\x20','876576kXyNhZ','findUnique','üîÑ\x20Admin\x20updating\x20payment\x20','Invalid\x20status.\x20Valid\x20statuses:\x20','üìÖ\x20This\x20Month:\x20','suspendUser','gatewaySettings','thisMonth','deletePayout','\x20activated\x20successfully','updatedAt','üìã\x20Getting\x20payments\x20with\x20filters:','updateUser','../config/database','amountAfterCommissionUSDT','shopUrl','amountUSDT','getPeriodDays','orderId','User\x20is\x20already\x20suspended','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','\x20total','REFUND','2604588bWWotM','getSystemStatistics','üí∞\x20Total\x20amount:\x20','amount','\x20USDT\x20after\x20commission)','‚úÖ\x20Activating\x20user:\x20','chargebackAmount','admin_status_update','‚úÖ\x20Marked\x20','parse','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','\x20USDT\x20(','‚ùå\x20Payment\x20not\x20found:\x20','externalPaymentUrl','txid','üìä\x20Calculating\x20admin\x20payout\x20statistics...','totalPayout','statusChangedBy','reduce','update','Error\x20parsing\x20gateway\x20settings:','network','gateway','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','getUserById','‚ùå\x20Payout\x20not\x20found:\x20','AdminService','payments','commission','notes','telegramBotService','isEligibleForPayout','__esModule','COMPLETED','\x20payments\x20as\x20paid\x20out','CHARGEBACK','adminNotes','telegram','‚úÖ\x20Payout\x20statistics\x20calculated:','abs','default','includes','üîç\x20Getting\x20payout\x20by\x20ID:\x20','\x20USDT\x20(penalty\x20amount)','all','defineProperty'];a33_0x51dd=function(){return _0x3e3cef;};return a33_0x51dd();}class AdminService{constructor(){const _0x268955=a33_0x249653;this[_0x268955(0x26f)]=new userService_1['UserService']();}[a33_0x249653(0x211)](_0x5bc9e6){const _0x11a5ad=a33_0x249653;switch(_0x5bc9e6){case'7d':return 0x7;case'30d':return 0x1e;case _0x11a5ad(0x269):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x249653(0x253)](_0x1da17e,_0x552bb7){const _0x9f7001=a33_0x249653,_0x47ec86=[],_0x40f55a=new Date(_0x1da17e);while(_0x40f55a<=_0x552bb7){_0x47ec86[_0x9f7001(0x1ce)](_0x40f55a[_0x9f7001(0x26e)]()[_0x9f7001(0x19c)]('T')[0x0]),_0x40f55a['setDate'](_0x40f55a[_0x9f7001(0x1bb)]()+0x1);}return _0x47ec86;}[a33_0x249653(0x1c4)](_0x130037,_0x236238){const _0x415d4f=a33_0x249653;if(!_0x130037[_0x415d4f(0x206)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x123699=JSON[_0x415d4f(0x220)](_0x130037[_0x415d4f(0x206)]),_0x37dd8f=_0x236238[_0x415d4f(0x273)](0x0)[_0x415d4f(0x1f3)]()+_0x236238['slice'](0x1)['toLowerCase']();if(_0x123699&&_0x123699[_0x37dd8f])return{'commission':_0x123699[_0x37dd8f][_0x415d4f(0x233)]||0x0,'payoutDelay':_0x123699[_0x37dd8f]['payoutDelay']||0x0};}catch(_0x1228f8){console[_0x415d4f(0x1d5)](_0x415d4f(0x22b),_0x1228f8);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x249653(0x236)](_0x49ab22){const _0xb76775=a33_0x249653;if(_0x49ab22['status']!=='PAID'||_0x49ab22[_0xb76775(0x254)]||!_0x49ab22[_0xb76775(0x25a)])return![];const _0x2c05e8=this[_0xb76775(0x1c4)](_0x49ab22[_0xb76775(0x1a4)],_0x49ab22[_0xb76775(0x22d)]),_0x155597=_0x2c05e8[_0xb76775(0x1a6)]*0x18*0x3c*0x3c*0x3e8,_0x1a38f6=new Date(_0x49ab22[_0xb76775(0x25a)][_0xb76775(0x263)]()+_0x155597);return new Date()>_0x1a38f6;}[a33_0x249653(0x1e5)](_0xa881aa,_0x2cef15){return _0xa881aa*(0x1-_0x2cef15/0x64);}['calculateEffectiveAmount'](_0x43cc31){const _0x24dee7=a33_0x249653;switch(_0x43cc31[_0x24dee7(0x1ac)]){case _0x24dee7(0x1c0):return _0x43cc31['amount'];case _0x24dee7(0x23a):return-(_0x43cc31[_0x24dee7(0x21d)]||0x0);case _0x24dee7(0x216):return 0x0;default:return 0x0;}}async[a33_0x249653(0x1c9)](_0x5d27e6){const _0x55d294=a33_0x249653,{shopId:_0x2a4284,amount:_0x2ce1ad,network:_0x3b41cc,notes:_0x1a1f1d}=_0x5d27e6;console[_0x55d294(0x268)](_0x55d294(0x272)+_0x2a4284+':\x20'+_0x2ce1ad+'\x20USDT\x20via\x20'+_0x3b41cc);const _0x12110d=await database_1['default'][_0x55d294(0x1a4)][_0x55d294(0x201)]({'where':{'id':_0x2a4284},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x12110d)throw new Error(_0x55d294(0x1f7));if(_0x12110d[_0x55d294(0x1ac)]!==_0x55d294(0x1e6))throw new Error('Shop\x20is\x20not\x20active');const _0x1b1989=await database_1[_0x55d294(0x23f)]['payout']['create']({'data':{'shopId':_0x2a4284,'amount':_0x2ce1ad,'network':_0x3b41cc,'status':_0x55d294(0x238),'notes':_0x1a1f1d||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x55d294(0x1e9)](_0x2a4284,_0x2ce1ad);try{await telegramBotService_1[_0x55d294(0x235)][_0x55d294(0x26a)](_0x2a4284,_0x1b1989,_0x55d294(0x260));}catch(_0x2620ba){console['error'](_0x55d294(0x255),_0x2620ba);}return console[_0x55d294(0x268)](_0x55d294(0x245)+_0x1b1989['id']),{'id':_0x1b1989['id'],'shopId':_0x1b1989[_0x55d294(0x1ad)],'shopName':_0x1b1989[_0x55d294(0x1a4)]['name'],'shopUsername':_0x1b1989[_0x55d294(0x1a4)]['username'],'amount':_0x1b1989[_0x55d294(0x21a)],'network':_0x1b1989[_0x55d294(0x22c)],'status':_0x1b1989[_0x55d294(0x1ac)],'txid':_0x1b1989['txid'],'notes':_0x1b1989['notes'],'createdAt':_0x1b1989[_0x55d294(0x1d6)],'paidAt':_0x1b1989['paidAt']};}async[a33_0x249653(0x1e9)](_0x4b8157,_0x43da4c){const _0x239f56=a33_0x249653;console['log'](_0x239f56(0x221)+_0x4b8157+_0x239f56(0x1a2)+_0x43da4c+'\x20USDT');const _0x4d33c3=await database_1[_0x239f56(0x23f)][_0x239f56(0x1fb)][_0x239f56(0x1c3)]({'where':{'shopId':_0x4b8157,'status':_0x239f56(0x1c0),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x239f56(0x1e1)}});let _0x2f3652=_0x43da4c;const _0x442630=[];for(const _0x5dce52 of _0x4d33c3){const _0x175a5e={..._0x5dce52,'status':_0x239f56(0x1c0),'merchantPaid':![],'shop':{'gatewaySettings':_0x5dce52[_0x239f56(0x1a4)][_0x239f56(0x206)]}};if(!this[_0x239f56(0x236)](_0x175a5e))continue;const _0x5dbd1d=await currencyService_1['currencyService'][_0x239f56(0x1f6)](_0x5dce52[_0x239f56(0x21a)],_0x5dce52[_0x239f56(0x1c2)]),_0x30919f=this[_0x239f56(0x1c4)](_0x5dce52['shop'],_0x5dce52['gateway']),_0x553df5=this[_0x239f56(0x1e5)](_0x5dbd1d,_0x30919f[_0x239f56(0x233)]);if(_0x553df5<=_0x2f3652){_0x442630[_0x239f56(0x1ce)](_0x5dce52['id']),_0x2f3652-=_0x553df5;if(_0x2f3652<=0.01)break;}}_0x442630[_0x239f56(0x25d)]>0x0&&(await database_1[_0x239f56(0x23f)][_0x239f56(0x1fb)][_0x239f56(0x24c)]({'where':{'id':{'in':_0x442630}},'data':{'merchantPaid':!![]}}),console[_0x239f56(0x268)](_0x239f56(0x21f)+_0x442630[_0x239f56(0x25d)]+_0x239f56(0x239)));}async[a33_0x249653(0x1ec)](_0x353297){const _0x18b82c=a33_0x249653,{page:_0x16195c,limit:_0x4f101d,shopId:_0x56cb0b,network:_0x571bcc,dateFrom:_0x2195fc,dateTo:_0x47969d,search:_0x5086a5}=_0x353297,_0x2d6ae7=(_0x16195c-0x1)*_0x4f101d;console[_0x18b82c(0x268)]('üìã\x20Getting\x20payouts\x20with\x20filters:',_0x353297);const _0x2f7ccd={};_0x56cb0b&&(_0x2f7ccd[_0x18b82c(0x1ad)]=_0x56cb0b);_0x571bcc&&(_0x2f7ccd[_0x18b82c(0x22c)]=_0x571bcc);(_0x2195fc||_0x47969d)&&(_0x2f7ccd[_0x18b82c(0x1d6)]={},_0x2195fc&&(_0x2f7ccd['createdAt'][_0x18b82c(0x247)]=new Date(_0x2195fc)),_0x47969d&&(_0x2f7ccd[_0x18b82c(0x1d6)][_0x18b82c(0x1d9)]=new Date(_0x47969d)));_0x5086a5&&(_0x2f7ccd['OR']=[{'txid':{'contains':_0x5086a5,'mode':'insensitive'}},{'notes':{'contains':_0x5086a5,'mode':_0x18b82c(0x256)}},{'shop':{'name':{'contains':_0x5086a5,'mode':_0x18b82c(0x256)}}},{'shop':{'username':{'contains':_0x5086a5,'mode':_0x18b82c(0x256)}}}]);const [_0x1a58f1,_0x39f20e]=await Promise[_0x18b82c(0x243)]([database_1[_0x18b82c(0x23f)][_0x18b82c(0x1dc)]['findMany']({'where':_0x2f7ccd,'skip':_0x2d6ae7,'take':_0x4f101d,'orderBy':{'createdAt':_0x18b82c(0x1d7)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x18b82c(0x23f)][_0x18b82c(0x1dc)]['count']({'where':_0x2f7ccd})]);console[_0x18b82c(0x268)](_0x18b82c(0x1c5)+_0x1a58f1['length']+_0x18b82c(0x1fe)+_0x39f20e+'\x20total');const _0x48ab73=_0x1a58f1[_0x18b82c(0x1d3)](_0x3de4f6=>({'id':_0x3de4f6['id'],'shopId':_0x3de4f6[_0x18b82c(0x1ad)],'shopName':_0x3de4f6[_0x18b82c(0x1a4)]['name'],'shopUsername':_0x3de4f6[_0x18b82c(0x1a4)][_0x18b82c(0x25c)],'amount':_0x3de4f6[_0x18b82c(0x21a)],'network':_0x3de4f6['network'],'status':_0x3de4f6[_0x18b82c(0x1ac)],'txid':_0x3de4f6['txid'],'notes':_0x3de4f6[_0x18b82c(0x234)],'createdAt':_0x3de4f6['createdAt'],'paidAt':_0x3de4f6[_0x18b82c(0x25a)]}));return{'payouts':_0x48ab73,'pagination':{'page':_0x16195c,'limit':_0x4f101d,'total':_0x39f20e,'totalPages':Math[_0x18b82c(0x1ab)](_0x39f20e/_0x4f101d)}};}async[a33_0x249653(0x250)](_0x56cb9d){const _0x66011a=a33_0x249653;console['log'](_0x66011a(0x241)+_0x56cb9d);const _0x3e8ac1=await database_1[_0x66011a(0x23f)][_0x66011a(0x1dc)][_0x66011a(0x201)]({'where':{'id':_0x56cb9d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3e8ac1)return console['log'](_0x66011a(0x230)+_0x56cb9d),null;return console[_0x66011a(0x268)]('‚úÖ\x20Found\x20payout:\x20'+_0x3e8ac1[_0x66011a(0x21a)]+'\x20USDT\x20via\x20'+_0x3e8ac1[_0x66011a(0x22c)]),{'id':_0x3e8ac1['id'],'shopId':_0x3e8ac1[_0x66011a(0x1ad)],'shopName':_0x3e8ac1['shop'][_0x66011a(0x1aa)],'shopUsername':_0x3e8ac1[_0x66011a(0x1a4)][_0x66011a(0x25c)],'amount':_0x3e8ac1['amount'],'network':_0x3e8ac1[_0x66011a(0x22c)],'status':_0x3e8ac1['status'],'txid':_0x3e8ac1[_0x66011a(0x225)],'notes':_0x3e8ac1[_0x66011a(0x234)],'createdAt':_0x3e8ac1['createdAt'],'paidAt':_0x3e8ac1[_0x66011a(0x25a)]};}async[a33_0x249653(0x208)](_0xd8b2b5){const _0x50a2cd=a33_0x249653;console[_0x50a2cd(0x268)](_0x50a2cd(0x271)+_0xd8b2b5);const _0x76da8b=await database_1[_0x50a2cd(0x23f)][_0x50a2cd(0x1dc)]['findUnique']({'where':{'id':_0xd8b2b5},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x76da8b)throw new Error(_0x50a2cd(0x1f5));await database_1['default'][_0x50a2cd(0x1dc)][_0x50a2cd(0x1b5)]({'where':{'id':_0xd8b2b5}}),console['log'](_0x50a2cd(0x1cc)+_0xd8b2b5+'\x20deleted\x20successfully');}async[a33_0x249653(0x1f4)](_0x5df44d){const _0x2ef635=a33_0x249653,{page:_0x454296,limit:_0x3db248,minAmount:_0x232c7d,search:_0x4d665d}=_0x5df44d;console[_0x2ef635(0x268)](_0x2ef635(0x1eb),_0x5df44d);const _0x1f31e4=await database_1[_0x2ef635(0x23f)]['payment'][_0x2ef635(0x1c3)]({'where':{'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x2ef635(0x268)](_0x2ef635(0x249)+_0x1f31e4[_0x2ef635(0x25d)]+_0x2ef635(0x1be));const _0x5b15bf=new Map();for(const _0x475693 of _0x1f31e4){const _0x536a11={..._0x475693,'status':_0x2ef635(0x1c0),'merchantPaid':![],'shop':{'gatewaySettings':_0x475693[_0x2ef635(0x1a4)][_0x2ef635(0x206)]}},_0x107fd9=this['isEligibleForPayout'](_0x536a11);if(!_0x107fd9)continue;const _0x13ae63=await currencyService_1[_0x2ef635(0x1d2)][_0x2ef635(0x1f6)](_0x475693['amount'],_0x475693[_0x2ef635(0x1c2)]),_0x3efffb=this[_0x2ef635(0x1c4)](_0x475693[_0x2ef635(0x1a4)],_0x475693[_0x2ef635(0x22d)]),_0x14ea2e=this[_0x2ef635(0x1e5)](_0x13ae63,_0x3efffb[_0x2ef635(0x233)]),_0x365bfc=_0x475693[_0x2ef635(0x1ad)];!_0x5b15bf[_0x2ef635(0x1da)](_0x365bfc)&&_0x5b15bf['set'](_0x365bfc,{'shop':_0x475693[_0x2ef635(0x1a4)],'payments':[]}),_0x5b15bf['get'](_0x365bfc)['payments']['push']({'id':_0x475693['id'],'amount':_0x475693['amount'],'currency':_0x475693[_0x2ef635(0x1c2)],'gateway':_0x475693[_0x2ef635(0x22d)],'paidAt':_0x475693['paidAt'],'createdAt':_0x475693[_0x2ef635(0x1d6)],'amountUSDT':_0x13ae63,'commission':_0x3efffb[_0x2ef635(0x233)],'amountAfterCommissionUSDT':_0x14ea2e,'isEligible':!![]});}console[_0x2ef635(0x268)](_0x2ef635(0x1a0)+_0x5b15bf[_0x2ef635(0x1ea)]+_0x2ef635(0x1ee));const _0x4be8d2=[];for(const [_0x32a720,_0x9f9d00]of _0x5b15bf){const {shop:_0x147822,payments:_0x49e839}=_0x9f9d00,_0x32ec12=_0x49e839[_0x2ef635(0x229)]((_0x32299a,_0x507a9f)=>_0x32299a+_0x507a9f[_0x2ef635(0x210)],0x0),_0x9f8aca=_0x49e839[_0x2ef635(0x229)]((_0x110864,_0x4311cf)=>_0x110864+_0x4311cf[_0x2ef635(0x20e)],0x0);if(_0x232c7d&&_0x9f8aca<_0x232c7d)continue;if(_0x4d665d){const _0x1f6c9a=_0x4d665d[_0x2ef635(0x1b4)](),_0x102c08=_0x147822[_0x2ef635(0x1aa)]['toLowerCase']()[_0x2ef635(0x240)](_0x1f6c9a)||_0x147822[_0x2ef635(0x25c)]['toLowerCase']()[_0x2ef635(0x240)](_0x1f6c9a)||_0x147822[_0x2ef635(0x23c)]&&_0x147822[_0x2ef635(0x23c)]['toLowerCase']()[_0x2ef635(0x240)](_0x1f6c9a);if(!_0x102c08)continue;}const _0xf3687c=new Map();for(const _0x18dd18 of _0x49e839){const _0x4f5242=_0x18dd18[_0x2ef635(0x22d)];!_0xf3687c[_0x2ef635(0x1da)](_0x4f5242)&&_0xf3687c['set'](_0x4f5242,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x18dd18[_0x2ef635(0x233)]});const _0x47ab9c=_0xf3687c[_0x2ef635(0x257)](_0x4f5242);_0x47ab9c[_0x2ef635(0x1d0)]++,_0x47ab9c[_0x2ef635(0x210)]+=_0x18dd18[_0x2ef635(0x210)],_0x47ab9c[_0x2ef635(0x20e)]+=_0x18dd18['amountAfterCommissionUSDT'];}const _0x3f5ba6=Array[_0x2ef635(0x1b9)](_0xf3687c[_0x2ef635(0x248)]())['map'](([_0x47b4f3,_0x42accb])=>({'gateway':_0x47b4f3['charAt'](0x0)[_0x2ef635(0x1f3)]()+_0x47b4f3['slice'](0x1),'count':_0x42accb[_0x2ef635(0x1d0)],'amountUSDT':Math[_0x2ef635(0x1c8)](_0x42accb['amountUSDT']*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x2ef635(0x1c8)](_0x42accb[_0x2ef635(0x20e)]*0x64)/0x64,'commission':_0x42accb[_0x2ef635(0x233)]})),_0x3b63d5=_0x49e839[_0x2ef635(0x229)]((_0x17d6f,_0x2211b5)=>{const _0x5d373d=_0x2ef635;return _0x2211b5['paidAt']<_0x17d6f?_0x2211b5[_0x5d373d(0x25a)]:_0x17d6f;},_0x49e839[0x0][_0x2ef635(0x25a)]);_0x4be8d2[_0x2ef635(0x1ce)]({'id':_0x147822['id'],'fullName':_0x147822[_0x2ef635(0x1aa)],'username':_0x147822[_0x2ef635(0x25c)],'telegramId':_0x147822[_0x2ef635(0x23c)],'merchantUrl':_0x147822[_0x2ef635(0x20f)],'wallets':{'usdtPolygonWallet':_0x147822['usdtPolygonWallet'],'usdtTrcWallet':_0x147822[_0x2ef635(0x26c)],'usdtErcWallet':_0x147822[_0x2ef635(0x26d)],'usdcPolygonWallet':_0x147822[_0x2ef635(0x270)]},'totalAmountUSDT':Math[_0x2ef635(0x1c8)](_0x32ec12*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2ef635(0x1c8)](_0x9f8aca*0x64)/0x64,'paymentsCount':_0x49e839[_0x2ef635(0x25d)],'oldestPaymentDate':_0x3b63d5,'gatewayBreakdown':_0x3f5ba6});}_0x4be8d2[_0x2ef635(0x1c1)]((_0x3a4625,_0x3b2aa5)=>_0x3b2aa5[_0x2ef635(0x1e2)]-_0x3a4625[_0x2ef635(0x1e2)]);const _0x352a4e=_0x4be8d2['length'],_0x1b852a=_0x4be8d2[_0x2ef635(0x229)]((_0xe285ab,_0x590e71)=>_0xe285ab+_0x590e71[_0x2ef635(0x1ba)],0x0),_0x5fd5e3=_0x4be8d2['reduce']((_0x2706a6,_0x322684)=>_0x2706a6+_0x322684[_0x2ef635(0x1e2)],0x0),_0x4cc88b=(_0x454296-0x1)*_0x3db248,_0x318ec2=_0x4be8d2[_0x2ef635(0x25f)](_0x4cc88b,_0x4cc88b+_0x3db248);return console['log']('‚úÖ\x20Returning\x20'+_0x318ec2[_0x2ef635(0x25d)]+_0x2ef635(0x1a1)+_0x352a4e+_0x2ef635(0x215)),console[_0x2ef635(0x268)](_0x2ef635(0x219)+_0x1b852a[_0x2ef635(0x1d8)](0x2)+_0x2ef635(0x222)+_0x5fd5e3[_0x2ef635(0x1d8)](0x2)+_0x2ef635(0x21b)),{'merchants':_0x318ec2,'pagination':{'page':_0x454296,'limit':_0x3db248,'total':_0x352a4e,'totalPages':Math[_0x2ef635(0x1ab)](_0x352a4e/_0x3db248)},'summary':{'totalMerchants':_0x352a4e,'totalAmountUSDT':Math[_0x2ef635(0x1c8)](_0x1b852a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2ef635(0x1c8)](_0x5fd5e3*0x64)/0x64}};}async['getPayoutStats'](){const _0x1b9850=a33_0x249653;console[_0x1b9850(0x268)](_0x1b9850(0x226));const _0xcad401=await database_1['default'][_0x1b9850(0x1fb)][_0x1b9850(0x1c3)]({'where':{'status':{'in':[_0x1b9850(0x1c0),'REFUND',_0x1b9850(0x23a)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log'](_0x1b9850(0x249)+_0xcad401['length']+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x23e732=new Date(),_0x22df8a=new Date(_0x23e732['getFullYear'](),_0x23e732[_0x1b9850(0x1fd)](),0x1),_0x3f20bd=new Date(_0x23e732['getFullYear'](),_0x23e732[_0x1b9850(0x1fd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x44bfbf=0x0,_0x22e8e4=0x0,_0x16df09=0x0,_0x584aff=0x0;for(const _0x534215 of _0xcad401){const _0x29a1d4=this[_0x1b9850(0x1a7)](_0x534215);if(_0x29a1d4===0x0)continue;let _0x39902a,_0x438e28;if(_0x534215[_0x1b9850(0x1ac)]===_0x1b9850(0x23a))_0x39902a=Math[_0x1b9850(0x23e)](_0x29a1d4),_0x438e28=-_0x39902a;else{_0x39902a=await currencyService_1['currencyService'][_0x1b9850(0x1f6)](_0x534215[_0x1b9850(0x21a)],_0x534215['currency']);const _0x1cd006=this[_0x1b9850(0x1c4)](_0x534215[_0x1b9850(0x1a4)],_0x534215[_0x1b9850(0x22d)]);_0x438e28=this['calculateAmountAfterCommission'](_0x39902a,_0x1cd006[_0x1b9850(0x233)]);}_0x534215[_0x1b9850(0x254)]&&(_0x44bfbf+=_0x438e28,_0x534215[_0x1b9850(0x25a)]&&_0x534215[_0x1b9850(0x25a)]>=_0x22df8a&&_0x534215[_0x1b9850(0x25a)]<=_0x3f20bd&&(_0x16df09+=_0x438e28)),_0x534215[_0x1b9850(0x1ac)]==='PAID'&&this[_0x1b9850(0x236)](_0x534215)&&(_0x22e8e4+=_0x438e28,_0x584aff+=_0x39902a);}const _0x16c646={'totalPayout':Math['round'](_0x44bfbf*0x64)/0x64,'awaitingPayout':Math[_0x1b9850(0x1c8)](_0x22e8e4*0x64)/0x64,'thisMonth':Math[_0x1b9850(0x1c8)](_0x16df09*0x64)/0x64,'availableBalance':Math[_0x1b9850(0x1c8)](_0x584aff*0x64)/0x64};return console[_0x1b9850(0x268)](_0x1b9850(0x23d)),console['log'](_0x1b9850(0x26b)+_0x16c646[_0x1b9850(0x227)]+'\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)'),console['log'](_0x1b9850(0x1b1)+_0x16c646[_0x1b9850(0x1b2)]+_0x1b9850(0x1df)),console[_0x1b9850(0x268)](_0x1b9850(0x204)+_0x16c646[_0x1b9850(0x207)]+_0x1b9850(0x1f8)),console[_0x1b9850(0x268)]('üí∞\x20Available\x20Balance:\x20'+_0x16c646[_0x1b9850(0x252)]+_0x1b9850(0x1f8)),_0x16c646;}async[a33_0x249653(0x218)](_0x1bc8e0){const _0x41704d=a33_0x249653,_0x502bd1=this[_0x41704d(0x211)](_0x1bc8e0),_0x505568=new Date();_0x505568[_0x41704d(0x1a5)](_0x505568[_0x41704d(0x1bb)]()-_0x502bd1),console['log']('üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20'+_0x1bc8e0+'\x20('+_0x502bd1+'\x20days)');const _0x309814=await database_1[_0x41704d(0x23f)]['shop']['count']({'where':{'status':_0x41704d(0x1e6)}}),_0x261a59=await database_1['default'][_0x41704d(0x1fb)]['count'](),_0x29878f=await database_1[_0x41704d(0x23f)][_0x41704d(0x1fb)][_0x41704d(0x1c3)]({'where':{'status':{'in':['PAID',_0x41704d(0x216),_0x41704d(0x23a)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x41704d(0x268)](_0x41704d(0x249)+_0x29878f[_0x41704d(0x25d)]+_0x41704d(0x25e));const _0x113a61=await Promise[_0x41704d(0x243)](_0x29878f[_0x41704d(0x1d3)](async _0x474333=>{const _0x391faf=_0x41704d,_0x277b66=this[_0x391faf(0x1a7)](_0x474333);if(_0x277b66===0x0)return{'amount':0x0,'createdAt':_0x474333[_0x391faf(0x1d6)]};let _0x2f8185;return _0x474333[_0x391faf(0x1ac)]===_0x391faf(0x23a)?_0x2f8185=-Math['abs'](_0x277b66):_0x2f8185=await currencyService_1[_0x391faf(0x1d2)][_0x391faf(0x1f6)](_0x474333[_0x391faf(0x21a)],_0x474333[_0x391faf(0x1c2)]),{'amount':_0x2f8185,'createdAt':_0x474333[_0x391faf(0x1d6)]};})),_0x2df9cb=_0x113a61[_0x41704d(0x229)]((_0x57d2ee,_0x5a36c0)=>_0x57d2ee+_0x5a36c0[_0x41704d(0x21a)],0x0),_0x1aac55=_0x261a59>0x0?_0x2df9cb/_0x261a59:0x0;console[_0x41704d(0x268)](_0x41704d(0x1b7)+_0x2df9cb['toFixed'](0x2)+'\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)'),console[_0x41704d(0x268)](_0x41704d(0x258)+_0x1aac55['toFixed'](0x2)+_0x41704d(0x1f8));const _0x28a287=await database_1[_0x41704d(0x23f)][_0x41704d(0x25b)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x505568}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console['log'](_0x41704d(0x22e)+_0x28a287['length']+_0x41704d(0x1db));const _0x52a793=await Promise['all'](_0x28a287['map'](async _0xe9b45c=>{const _0xfcdf3e=_0x41704d,_0x411d7c=await Promise[_0xfcdf3e(0x243)](_0xe9b45c[_0xfcdf3e(0x232)]['map'](async _0x29a44c=>{const _0x109492=_0xfcdf3e,_0x5758dc=this[_0x109492(0x1a7)](_0x29a44c);if(_0x5758dc===0x0)return 0x0;return _0x29a44c[_0x109492(0x1ac)]===_0x109492(0x23a)?-Math[_0x109492(0x23e)](_0x5758dc):await currencyService_1['currencyService'][_0x109492(0x1f6)](_0x29a44c['amount'],_0x29a44c[_0x109492(0x1c2)]);})),_0x4c8645=_0x411d7c['reduce']((_0x3ea214,_0x539063)=>_0x3ea214+_0x539063,0x0);return{'date':_0xe9b45c[_0xfcdf3e(0x1de)][_0xfcdf3e(0x26e)]()[_0xfcdf3e(0x19c)]('T')[0x0],'amount':_0x4c8645};})),_0x149c81=this[_0x41704d(0x253)](_0x505568,new Date()),_0x4d3e98=new Map(_0x52a793[_0x41704d(0x1d3)](_0x2efd2e=>[_0x2efd2e[_0x41704d(0x1de)],_0x2efd2e[_0x41704d(0x21a)]])),_0x1ea1dc=_0x149c81['map'](_0x32413c=>({'date':_0x32413c,'amount':_0x4d3e98[_0x41704d(0x257)](_0x32413c)||0x0}));return console['log'](_0x41704d(0x214)),console[_0x41704d(0x268)](_0x41704d(0x24b)+_0x309814),console['log'](_0x41704d(0x1a3)+_0x261a59),console[_0x41704d(0x268)](_0x41704d(0x1cb)+_0x1ea1dc[_0x41704d(0x25d)]),{'totalRevenue':Math[_0x41704d(0x1c8)](_0x2df9cb*0x64)/0x64,'totalUsers':_0x309814,'totalPayments':_0x261a59,'averagePayment':Math[_0x41704d(0x1c8)](_0x1aac55*0x64)/0x64,'dailyRevenue':_0x1ea1dc};}async[a33_0x249653(0x264)](_0x1de833){const _0x4232e1=a33_0x249653,{page:_0x38650f,limit:_0x5990fa,status:_0x24a1bf,gateway:_0x19bbc0,shopId:_0x2f1598,dateFrom:_0x1fc2b7,dateTo:_0x481918,search:_0x199f99}=_0x1de833,_0xd70f89=(_0x38650f-0x1)*_0x5990fa;console['log'](_0x4232e1(0x20b),_0x1de833);const _0x365f46={};_0x24a1bf&&(_0x365f46['status']=_0x24a1bf[_0x4232e1(0x1f3)]());if(_0x19bbc0){if((0x0,gateway_1[_0x4232e1(0x1bc)])(_0x19bbc0)){const _0x5d0e05=(0x0,gateway_1['getGatewayNameById'])(_0x19bbc0);_0x5d0e05&&(_0x365f46[_0x4232e1(0x22d)]=_0x5d0e05);}else _0x365f46[_0x4232e1(0x22d)]=_0x19bbc0['toLowerCase']();}_0x2f1598&&(_0x365f46[_0x4232e1(0x1ad)]=_0x2f1598);(_0x1fc2b7||_0x481918)&&(_0x365f46['createdAt']={},_0x1fc2b7&&(_0x365f46[_0x4232e1(0x1d6)][_0x4232e1(0x247)]=new Date(_0x1fc2b7)),_0x481918&&(_0x365f46[_0x4232e1(0x1d6)][_0x4232e1(0x1d9)]=new Date(_0x481918)));_0x199f99&&(_0x365f46['OR']=[{'orderId':{'contains':_0x199f99,'mode':_0x4232e1(0x256)}},{'gatewayOrderId':{'contains':_0x199f99,'mode':'insensitive'}},{'gatewayPaymentId':{'contains':_0x199f99,'mode':_0x4232e1(0x256)}},{'customerEmail':{'contains':_0x199f99,'mode':'insensitive'}},{'customerName':{'contains':_0x199f99,'mode':_0x4232e1(0x256)}},{'shop':{'name':{'contains':_0x199f99,'mode':_0x4232e1(0x256)}}},{'shop':{'username':{'contains':_0x199f99,'mode':_0x4232e1(0x256)}}}]);const [_0x11da30,_0x43a379]=await Promise['all']([database_1[_0x4232e1(0x23f)][_0x4232e1(0x1fb)][_0x4232e1(0x1c3)]({'where':_0x365f46,'skip':_0xd70f89,'take':_0x5990fa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4232e1(0x23f)][_0x4232e1(0x1fb)][_0x4232e1(0x1d0)]({'where':_0x365f46})]);console[_0x4232e1(0x268)](_0x4232e1(0x1c5)+_0x11da30[_0x4232e1(0x25d)]+_0x4232e1(0x1c7)+_0x43a379+'\x20total');const _0xf7bf23=_0x11da30['map'](_0x1e92fa=>({'id':_0x1e92fa['id'],'shopId':_0x1e92fa[_0x4232e1(0x1ad)],'shopName':_0x1e92fa['shop'][_0x4232e1(0x1aa)],'shopUsername':_0x1e92fa[_0x4232e1(0x1a4)]['username'],'gateway':_0x1e92fa[_0x4232e1(0x22d)],'orderId':_0x1e92fa['orderId'],'gatewayOrderId':_0x1e92fa['gatewayOrderId'],'amount':_0x1e92fa[_0x4232e1(0x21a)],'currency':_0x1e92fa[_0x4232e1(0x1c2)],'sourceCurrency':_0x1e92fa['sourceCurrency'],'status':_0x1e92fa[_0x4232e1(0x1ac)],'usage':_0x1e92fa['usage'],'externalPaymentUrl':_0x1e92fa['externalPaymentUrl'],'gatewayPaymentId':_0x1e92fa[_0x4232e1(0x1f2)],'customerEmail':_0x1e92fa[_0x4232e1(0x267)],'customerName':_0x1e92fa[_0x4232e1(0x24a)],'cardLast4':_0x1e92fa[_0x4232e1(0x1bf)],'paymentMethod':_0x1e92fa[_0x4232e1(0x246)],'bankId':_0x1e92fa['bankId'],'remitterIban':_0x1e92fa[_0x4232e1(0x1fa)],'remitterName':_0x1e92fa[_0x4232e1(0x1b3)],'chargebackAmount':_0x1e92fa['chargebackAmount'],'adminNotes':_0x1e92fa[_0x4232e1(0x23b)],'statusChangedBy':_0x1e92fa[_0x4232e1(0x228)],'statusChangedAt':_0x1e92fa[_0x4232e1(0x251)],'createdAt':_0x1e92fa[_0x4232e1(0x1d6)],'updatedAt':_0x1e92fa[_0x4232e1(0x20a)],'expiresAt':_0x1e92fa[_0x4232e1(0x262)]}));return{'payments':_0xf7bf23,'pagination':{'page':_0x38650f,'limit':_0x5990fa,'total':_0x43a379,'totalPages':Math['ceil'](_0x43a379/_0x5990fa)}};}async['getPaymentById'](_0x322195){const _0x4d95a4=a33_0x249653;console[_0x4d95a4(0x268)]('üîç\x20Getting\x20payment\x20by\x20ID:\x20'+_0x322195);const _0x43ecb4=await database_1['default'][_0x4d95a4(0x1fb)][_0x4d95a4(0x201)]({'where':{'id':_0x322195},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x43ecb4)return console[_0x4d95a4(0x268)](_0x4d95a4(0x223)+_0x322195),null;return console[_0x4d95a4(0x268)]('‚úÖ\x20Found\x20payment:\x20'+_0x43ecb4['orderId']+'\x20('+_0x43ecb4[_0x4d95a4(0x1ac)]+')'),{'id':_0x43ecb4['id'],'shopId':_0x43ecb4[_0x4d95a4(0x1ad)],'shopName':_0x43ecb4[_0x4d95a4(0x1a4)][_0x4d95a4(0x1aa)],'shopUsername':_0x43ecb4[_0x4d95a4(0x1a4)][_0x4d95a4(0x25c)],'gateway':_0x43ecb4[_0x4d95a4(0x22d)],'orderId':_0x43ecb4[_0x4d95a4(0x212)],'gatewayOrderId':_0x43ecb4[_0x4d95a4(0x1f0)],'amount':_0x43ecb4[_0x4d95a4(0x21a)],'currency':_0x43ecb4['currency'],'sourceCurrency':_0x43ecb4[_0x4d95a4(0x19f)],'status':_0x43ecb4[_0x4d95a4(0x1ac)],'usage':_0x43ecb4[_0x4d95a4(0x1fc)],'externalPaymentUrl':_0x43ecb4['externalPaymentUrl'],'gatewayPaymentId':_0x43ecb4[_0x4d95a4(0x1f2)],'customerEmail':_0x43ecb4['customerEmail'],'customerName':_0x43ecb4['customerName'],'cardLast4':_0x43ecb4[_0x4d95a4(0x1bf)],'paymentMethod':_0x43ecb4['paymentMethod'],'bankId':_0x43ecb4[_0x4d95a4(0x1ed)],'remitterIban':_0x43ecb4['remitterIban'],'remitterName':_0x43ecb4[_0x4d95a4(0x1b3)],'chargebackAmount':_0x43ecb4[_0x4d95a4(0x21d)],'adminNotes':_0x43ecb4[_0x4d95a4(0x23b)],'statusChangedBy':_0x43ecb4[_0x4d95a4(0x228)],'statusChangedAt':_0x43ecb4[_0x4d95a4(0x251)],'createdAt':_0x43ecb4['createdAt'],'updatedAt':_0x43ecb4[_0x4d95a4(0x20a)],'expiresAt':_0x43ecb4[_0x4d95a4(0x262)],'webhookLogs':_0x43ecb4[_0x4d95a4(0x266)]};}async[a33_0x249653(0x1cd)](_0x43ad5f,_0x34acd3,_0x238d95,_0x370e74){const _0x511a5c=a33_0x249653;console['log'](_0x511a5c(0x202)+_0x43ad5f+_0x511a5c(0x1c6)+_0x34acd3);const _0x197d03=['PENDING',_0x511a5c(0x1c0),'EXPIRED',_0x511a5c(0x24d),_0x511a5c(0x216),_0x511a5c(0x23a)];if(!_0x197d03[_0x511a5c(0x240)](_0x34acd3[_0x511a5c(0x1f3)]()))throw new Error(_0x511a5c(0x203)+_0x197d03[_0x511a5c(0x1af)](',\x20'));const _0x27f03b=await database_1[_0x511a5c(0x23f)][_0x511a5c(0x1fb)]['findUnique']({'where':{'id':_0x43ad5f},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x27f03b)throw new Error(_0x511a5c(0x24e));if(_0x34acd3[_0x511a5c(0x1f3)]()===_0x511a5c(0x23a)){if(!_0x370e74||_0x370e74<=0x0)throw new Error(_0x511a5c(0x1f9));console['log'](_0x511a5c(0x1e8)+_0x370e74+_0x511a5c(0x242));}const _0x215c1d={'status':_0x34acd3[_0x511a5c(0x1f3)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x238d95&&(_0x215c1d['adminNotes']=_0x238d95);_0x34acd3['toUpperCase']()==='CHARGEBACK'&&_0x370e74&&(_0x215c1d[_0x511a5c(0x21d)]=_0x370e74);const _0x4b82e4=await database_1['default'][_0x511a5c(0x1fb)][_0x511a5c(0x22a)]({'where':{'id':_0x43ad5f},'data':_0x215c1d,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default']['webhookLog'][_0x511a5c(0x261)]({'data':{'paymentId':_0x43ad5f,'shopId':_0x4b82e4[_0x511a5c(0x1ad)],'event':_0x511a5c(0x21e),'statusCode':0xc8,'responseBody':JSON[_0x511a5c(0x1cf)]({'oldStatus':_0x27f03b[_0x511a5c(0x1ac)],'newStatus':_0x34acd3[_0x511a5c(0x1f3)](),'notes':_0x238d95||null,'chargebackAmount':_0x370e74||null,'updatedBy':_0x511a5c(0x19d),'timestamp':new Date()[_0x511a5c(0x26e)]()})}}),console['log'](_0x511a5c(0x1d1)+_0x27f03b['orderId']+'\x20status\x20updated\x20from\x20'+_0x27f03b[_0x511a5c(0x1ac)]+'\x20to\x20'+_0x34acd3[_0x511a5c(0x1f3)]()),_0x34acd3['toUpperCase']()==='CHARGEBACK'&&console[_0x511a5c(0x268)](_0x511a5c(0x1e4)+_0x370e74+_0x511a5c(0x1ca)),{'id':_0x4b82e4['id'],'shopId':_0x4b82e4[_0x511a5c(0x1ad)],'shopName':_0x4b82e4[_0x511a5c(0x1a4)][_0x511a5c(0x1aa)],'shopUsername':_0x4b82e4[_0x511a5c(0x1a4)][_0x511a5c(0x25c)],'gateway':_0x4b82e4[_0x511a5c(0x22d)],'orderId':_0x4b82e4[_0x511a5c(0x212)],'gatewayOrderId':_0x4b82e4[_0x511a5c(0x1f0)],'amount':_0x4b82e4[_0x511a5c(0x21a)],'currency':_0x4b82e4[_0x511a5c(0x1c2)],'sourceCurrency':_0x4b82e4[_0x511a5c(0x19f)],'status':_0x4b82e4[_0x511a5c(0x1ac)],'usage':_0x4b82e4[_0x511a5c(0x1fc)],'externalPaymentUrl':_0x4b82e4[_0x511a5c(0x224)],'gatewayPaymentId':_0x4b82e4[_0x511a5c(0x1f2)],'customerEmail':_0x4b82e4[_0x511a5c(0x267)],'customerName':_0x4b82e4[_0x511a5c(0x24a)],'cardLast4':_0x4b82e4[_0x511a5c(0x1bf)],'paymentMethod':_0x4b82e4[_0x511a5c(0x246)],'bankId':_0x4b82e4[_0x511a5c(0x1ed)],'remitterIban':_0x4b82e4[_0x511a5c(0x1fa)],'remitterName':_0x4b82e4[_0x511a5c(0x1b3)],'chargebackAmount':_0x4b82e4[_0x511a5c(0x21d)],'adminNotes':_0x4b82e4[_0x511a5c(0x23b)],'statusChangedBy':_0x4b82e4[_0x511a5c(0x228)],'statusChangedAt':_0x4b82e4[_0x511a5c(0x251)],'createdAt':_0x4b82e4[_0x511a5c(0x1d6)],'updatedAt':_0x4b82e4[_0x511a5c(0x20a)],'expiresAt':_0x4b82e4[_0x511a5c(0x262)]};}async[a33_0x249653(0x1f1)](_0x5223b1){const _0x29ca73=a33_0x249653,{page:_0x4f91cf,limit:_0x402224,status:_0x4ee8bb}=_0x5223b1,_0x59d4a1=(_0x4f91cf-0x1)*_0x402224,_0x2797a2={};_0x4ee8bb&&(_0x2797a2[_0x29ca73(0x1ac)]=_0x4ee8bb[_0x29ca73(0x1f3)]());console['log'](_0x29ca73(0x1e7),{'page':_0x4f91cf,'limit':_0x402224,'status':_0x4ee8bb,'where':_0x2797a2});const [_0x3cda49,_0x65e14d]=await Promise[_0x29ca73(0x243)]([database_1['default']['shop'][_0x29ca73(0x1c3)]({'where':_0x2797a2,'skip':_0x59d4a1,'take':_0x402224,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}}),database_1[_0x29ca73(0x23f)][_0x29ca73(0x1a4)][_0x29ca73(0x1d0)]({'where':_0x2797a2})]);console[_0x29ca73(0x268)](_0x29ca73(0x1c5)+_0x3cda49[_0x29ca73(0x25d)]+'\x20users\x20out\x20of\x20'+_0x65e14d+_0x29ca73(0x215));const _0xb5becb=_0x3cda49['map'](_0x33403d=>({'id':_0x33403d['id'],'fullName':_0x33403d[_0x29ca73(0x1aa)],'username':_0x33403d[_0x29ca73(0x25c)],'telegramId':_0x33403d[_0x29ca73(0x23c)],'merchantUrl':_0x33403d[_0x29ca73(0x20f)],'gateways':_0x33403d[_0x29ca73(0x24f)]?JSON[_0x29ca73(0x220)](_0x33403d[_0x29ca73(0x24f)]):null,'gatewaySettings':_0x33403d[_0x29ca73(0x206)]?JSON[_0x29ca73(0x220)](_0x33403d[_0x29ca73(0x206)]):null,'publicKey':_0x33403d['publicKey'],'wallets':{'usdtPolygonWallet':_0x33403d[_0x29ca73(0x1d4)],'usdtTrcWallet':_0x33403d[_0x29ca73(0x26c)],'usdtErcWallet':_0x33403d[_0x29ca73(0x26d)],'usdcPolygonWallet':_0x33403d[_0x29ca73(0x270)]},'status':_0x33403d['status'],'createdAt':_0x33403d[_0x29ca73(0x1d6)]}));return{'users':_0xb5becb,'pagination':{'page':_0x4f91cf,'limit':_0x402224,'total':_0x65e14d,'totalPages':Math['ceil'](_0x65e14d/_0x402224)}};}async[a33_0x249653(0x22f)](_0x159ca2){const _0x3fe294=a33_0x249653;return await this['userService'][_0x3fe294(0x22f)](_0x159ca2);}async[a33_0x249653(0x19e)](_0x32be2c){const _0x31b0db=a33_0x249653;return await this[_0x31b0db(0x26f)][_0x31b0db(0x19e)](_0x32be2c);}async[a33_0x249653(0x20c)](_0x3a8203,_0x300d66){const _0x1be94b=a33_0x249653;return await this[_0x1be94b(0x26f)][_0x1be94b(0x20c)](_0x3a8203,_0x300d66);}async[a33_0x249653(0x1e3)](_0xa20fba){const _0x1f7e2f=a33_0x249653;return await this['userService'][_0x1f7e2f(0x1e3)](_0xa20fba);}async[a33_0x249653(0x205)](_0x5a1f99){const _0x58bd8e=a33_0x249653;console[_0x58bd8e(0x268)](_0x58bd8e(0x1ef)+_0x5a1f99);const _0x310835=await database_1[_0x58bd8e(0x23f)][_0x58bd8e(0x1a4)]['findUnique']({'where':{'id':_0x5a1f99},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x310835)throw new Error(_0x58bd8e(0x265));if(_0x310835[_0x58bd8e(0x1ac)]===_0x58bd8e(0x1b8))throw new Error(_0x58bd8e(0x213));const _0x5b9e5f=await this[_0x58bd8e(0x26f)][_0x58bd8e(0x20c)](_0x5a1f99,{'status':_0x58bd8e(0x1b8)});return console[_0x58bd8e(0x268)](_0x58bd8e(0x1ff)+_0x310835[_0x58bd8e(0x25c)]+_0x58bd8e(0x1dd)),_0x5b9e5f;}async['activateUser'](_0x21f1bc){const _0xcada3b=a33_0x249653;console['log'](_0xcada3b(0x21c)+_0x21f1bc);const _0xdb98e6=await database_1['default'][_0xcada3b(0x1a4)][_0xcada3b(0x201)]({'where':{'id':_0x21f1bc},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0xdb98e6)throw new Error('User\x20not\x20found');if(_0xdb98e6[_0xcada3b(0x1ac)]===_0xcada3b(0x1e6))throw new Error(_0xcada3b(0x1e0));const _0x402576=await this[_0xcada3b(0x26f)]['updateUser'](_0x21f1bc,{'status':_0xcada3b(0x1e6)});return console[_0xcada3b(0x268)](_0xcada3b(0x1ff)+_0xdb98e6['username']+_0xcada3b(0x209)),_0x402576;}}exports[a33_0x249653(0x231)]=AdminService;