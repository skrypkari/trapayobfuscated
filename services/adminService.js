'use strict';const a36_0x428702=a36_0x3357;(function(_0x244f9f,_0x176c0a){const _0x3ec7c2=a36_0x3357,_0x520103=_0x244f9f();while(!![]){try{const _0x27536e=-parseInt(_0x3ec7c2(0xe4))/0x1+parseInt(_0x3ec7c2(0x13e))/0x2+-parseInt(_0x3ec7c2(0x18c))/0x3*(parseInt(_0x3ec7c2(0x1b3))/0x4)+-parseInt(_0x3ec7c2(0xf9))/0x5+-parseInt(_0x3ec7c2(0x1ae))/0x6+-parseInt(_0x3ec7c2(0x12b))/0x7+-parseInt(_0x3ec7c2(0xd2))/0x8*(-parseInt(_0x3ec7c2(0x194))/0x9);if(_0x27536e===_0x176c0a)break;else _0x520103['push'](_0x520103['shift']());}catch(_0x1ae0af){_0x520103['push'](_0x520103['shift']());}}}(a36_0x178b,0x21834));function a36_0x178b(){const _0x4d8b0d=['status','customerName','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','stringify','all','\x20USDT\x20(-','toFixed','__esModule','⚠️\x20Payment\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','CoinToPay','\x20PAID\x20payments','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','amountAfterGatewayCommissionUSDT','\x20\x20\x20Merchant\x20gets:\x20','revenue','error','\x20USDT\x20(after\x20','failUrl','password','🔄\x20Gateway\x20mapping:','paidOutUSDT','shopId','totalCommissionRate','create','paymentGateways','telegram','\x20order','\x20merchants\x20with\x20positive\x20balance','$transaction','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','usdtErcWallet','0000','9mYgtdX','publicKey','\x20->\x20','mastercard','getPaymentById','payout','findFirst','📊\x20Payout\x20statistics\x20calculated:','50202HMvUhm','toString','SUSPENDED','Noda','\x20USDT','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','getAllPayouts','getGatewayInternalName','sk_','customerUa','customerEmail','💰\x20Payment\x20','\x20became\x20PAID:','\x20\x20\x20Payout\x20amount:\x20','generateDailyStatistics','noda','💰\x20[PAYOUT]\x20Merchant\x20','📊\x20Getting\x20payments\x20with\x20filters:','\x27\x20->\x20ID\x20\x27','getUserById','\x20\x20\x20Gateway:\x20','\x20active\x20merchants\x20for\x20selection','chargebackAmount','gte','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','payment','760722tEwmQB','sort','\x20USDT\x20for\x20payment\x20','\x20\x20\x20Full\x20amount:\x20','REFUND','9892DxyLae','month','getTime','KLYME\x20GB','updateCustomerData','\x20in\x20','some','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','totalTurnover','%\x20commission)','💰\x20Current\x20shop\x20balance:\x20','PENDING','merchantEarnings','pk_','pendingUrl','COMPLETED','thisMonth','whiteUrl','round','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','\x20to\x20','insensitive','\x20\x20\x20🌍\x20Country:\x20','totalPayout','erc20','Plisio','summary','Test\x20Gateway','\x20USDT\x20(without\x20commission)','hex','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','dateFrom',',\x20Commission:\x20','averageCommissionRate','merchantEarningsUSDT','cointopay2','ACTIVE','failureMessage','date','averageCheckUSDT','asc','💱\x20Currency\x20filter\x20applied:\x20','getMonth','dateTo','usdcPolygonWallet',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','periodTo','\x20USDT\x20(theoretical\x20net)','getGatewayNameById','\x20USDT,\x20Requested:\x20','CHARGEBACK','Rapyd','📅\x20Period:\x20','suspendUser','random','network','\x27\x20->\x20name\x20\x27','wallets','groupBy','\x20USDT\x20(+','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','year','AdminService','\x20USDT\x20(actual\x20balances)','findUnique','username','delete','txid','getDate','createPayout','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','📊\x20Gateway\x20filter\x20applied:','✅\x20Payout\x20created:\x20','bcryptjs','toISOString','toLowerCase','hash','map','Payment\x20not\x20found','getPayoutById','🎯\x20[','📊\x20Merchants\x20awaiting\x20payout:\x20','telegramId','includes','trc20','848GFqoTe','convertToUSDT','fullName','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20Transaction\x20hash:\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','⚠️\x20Gateway\x20\x27','merchantUrl','\x20status:\x20','usdtTrcWallet','\x20\x20\x20💳\x20Total\x20payments:\x20','gateway','gateways','📊\x20Final\x20WHERE\x20conditions:','PAID','getMerchantsSelection','defineProperty','dailyPayments','267509plduOM','90d','\x20\x20\x20Balance:\x20','localeCompare','currencyService','randomBytes','shopUrl','\x20paid\x20payments\x20for\x20analysis','set','availableBalance','\x20\x20\x20📊\x20Commission\x20difference:\x20','getGatewayDisplayName','📊\x20Total\x20payments\x20(including\x20failed):\x20','length','findMany','substr','../types/gateway','📋\x20Found\x20','getAllPayments','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','turnover','728670aWftvr','orderId','shop','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x27\x20to\x20name\x20\x27','KLYME\x20EU','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','not\x20set','\x20USDT\x20(gross\x20revenue)','_count','totalPayments','forEach','get','./currencyService','\x27\x20(from\x20\x27','klyme_de','updatePaymentStatus','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','deleteUser','parse','count','\x20\x20\x20💰\x20Total\x20payout:\x20','plisio','commissionUSDT','gatewaySettings','customerCountry','💰\x20Shop\x20','join','\x20USDT\x20from\x20balance','statusChangedBy','lte','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','commission','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','paidAt','amount','getFullYear','2020-01-01','values','createUser','balance','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','🔧\x20[','__importDefault','📊\x20Sorting\x20payments\x20by\x20','✅\x20Using\x20gateway\x20filter:\x20\x27','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','aggregate','_sum','134981Oolini','notes','periodFrom','🔄\x20Admin\x20updating\x20payment\x20','polygon','\x20balance\x20updated:\x20','Open\x20Banking\x202','update','🔍\x20Using\x20gateway\x20\x27','💰\x20Found\x20','totalAmountAfterCommissionUSDT','\x27\x20not\x20found.\x20Available\x20gateways:\x20','createdAt','split','\x20\x20\x20�📊\x20Total\x20payments:\x20',']\x20Updating\x20password\x20for\x20user\x20','\x20\x20\x20Total\x20paid\x20out:\x20','📊\x20Merchant\x20statistics\x20calculated:',']\x20Gateway\x20settings\x20JSON\x20string:','225464XypUyP','paymentsCount','entries','\x20\x20\x20📅\x20This\x20month:\x20',':\x20commission\x20=\x20','totalPaidOut','name','period','usdtPolygonWallet',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','custom','🔐\x20[','awaitingPayout','currency','test_gateway','\x20\x20\x20🌐\x20IP:\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','ceil','default','getSystemStatistics','cointopay','📋\x20Getting\x20merchants\x20selection\x20list...','amountUSDT','💸\x20CHARGEBACK\x20penalty:\x20-','Telegram\x20username\x20already\x20exists','not\x20specified','customerIp',',\x20successful:\x20','turnoverUSDT','reduce','\x20for\x20shop\x20','gatewayOrderId','log','Shop\x20not\x20found','desc','💳\x20Payout\x20wallet\x20for\x20','externalPaymentUrl','pendingPayout','\x20\x20\x20⏳\x20Pending\x20payout:\x20','getMerchantStatistics','toUpperCase','getMerchantsAwaitingPayout','updatedAt','%\x20from\x20'];a36_0x178b=function(){return _0x4d8b0d;};return a36_0x178b();}var __importDefault=this&&this[a36_0x428702(0x125)]||function(_0x316688){return _0x316688&&_0x316688['__esModule']?_0x316688:{'default':_0x316688};};Object[a36_0x428702(0xe2)](exports,a36_0x428702(0x172),{'value':!![]}),exports[a36_0x428702(0xbb)]=void 0x0;function a36_0x3357(_0x54b123,_0x8c7233){const _0x178b94=a36_0x178b();return a36_0x3357=function(_0x335716,_0x2c79c9){_0x335716=_0x335716-0xb8;let _0x422047=_0x178b94[_0x335716];return _0x422047;},a36_0x3357(_0x54b123,_0x8c7233);}const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a36_0x428702(0xc6))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a36_0x428702(0x107)),gateway_1=require(a36_0x428702(0xf4));class AdminService{async['getPayoutStats'](){const _0xad33d5=a36_0x428702;console[_0xad33d5(0x15f)]('📊\x20Calculating\x20payout\x20statistics...');const _0x4b9c23=await database_1[_0xad33d5(0x151)][_0xad33d5(0xfb)][_0xad33d5(0x129)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0xad33d5(0x1d7)}}),_0xf1c5fc=await this[_0xad33d5(0x168)]({'page':0x1,'limit':0x3e8}),_0x3afd20=await database_1[_0xad33d5(0x151)]['payment']['count']({'where':{'status':_0xad33d5(0xe0),'gateway':{'not':_0xad33d5(0x14c)}}}),_0x162b58=new Date(),_0x3370c7=new Date(_0x162b58['getFullYear'](),_0x162b58[_0xad33d5(0x1dd)](),0x1),_0x234378=new Date(_0x162b58['getFullYear'](),_0x162b58[_0xad33d5(0x1dd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x34b927=await database_1[_0xad33d5(0x151)][_0xad33d5(0x191)][_0xad33d5(0x129)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3370c7,'lte':_0x234378},'status':_0xad33d5(0x1c2)}}),_0x2d62f3=_0x4b9c23[_0xad33d5(0x12a)][_0xad33d5(0x143)]||0x0,_0x169ef6=_0xf1c5fc[_0xad33d5(0x1cd)][_0xad33d5(0x135)],_0x5a778c=_0x34b927[_0xad33d5(0x12a)]['amount']||0x0,_0x3b9f42={'totalPayout':Math[_0xad33d5(0x1c5)](_0x2d62f3*0x64)/0x64,'awaitingPayout':Math[_0xad33d5(0x1c5)](_0x169ef6*0x64)/0x64,'thisMonth':Math[_0xad33d5(0x1c5)](_0x5a778c*0x64)/0x64,'availableBalance':Math[_0xad33d5(0x1c5)](_0x169ef6*0x64)/0x64,'totalPayments':_0x3afd20};return console[_0xad33d5(0x15f)](_0xad33d5(0x193)),console[_0xad33d5(0x15f)](_0xad33d5(0x10f)+_0x3b9f42[_0xad33d5(0x1ca)]+_0xad33d5(0xfc)),console[_0xad33d5(0x15f)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x3b9f42[_0xad33d5(0x14a)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0xad33d5(0x15f)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x3b9f42[_0xad33d5(0xed)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0xad33d5(0x15f)](_0xad33d5(0x141)+_0x3b9f42[_0xad33d5(0x1c3)]+_0xad33d5(0x198)),console['log'](_0xad33d5(0xdc)+_0x3b9f42[_0xad33d5(0x104)]+_0xad33d5(0x176)),console['log'](_0xad33d5(0x16d)+(_0x4b9c23[_0xad33d5(0x12a)][_0xad33d5(0x122)]||0x0)['toFixed'](0x2)+_0xad33d5(0x1cf)),console[_0xad33d5(0x15f)](_0xad33d5(0xee)+((_0x4b9c23['_sum']['balance']||0x0)-_0x169ef6)['toFixed'](0x2)+'\x20USDT'),_0x3b9f42;}async[a36_0x428702(0x1b7)](_0x40d298,_0x5a5f5a){const _0x4fbd93=a36_0x428702;console['log'](_0x4fbd93(0x14e)+_0x40d298+':',_0x5a5f5a);const _0x70f590=await database_1['default'][_0x4fbd93(0x1ad)][_0x4fbd93(0xbd)]({'where':{'id':_0x40d298},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x70f590)throw new Error('Payment\x20not\x20found');const _0x42e1de={};_0x5a5f5a[_0x4fbd93(0x113)]!==undefined&&(_0x42e1de[_0x4fbd93(0x113)]=_0x5a5f5a[_0x4fbd93(0x113)]||null);_0x5a5f5a[_0x4fbd93(0x159)]!==undefined&&(_0x42e1de[_0x4fbd93(0x159)]=_0x5a5f5a['customerIp']||null);_0x5a5f5a['customerUa']!==undefined&&(_0x42e1de[_0x4fbd93(0x19d)]=_0x5a5f5a[_0x4fbd93(0x19d)]||null);const _0x1210eb=await database_1['default'][_0x4fbd93(0x1ad)][_0x4fbd93(0x132)]({'where':{'id':_0x40d298},'data':{..._0x42e1de,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x4fbd93(0x123)+_0x40d298),console['log'](_0x4fbd93(0x1c9)+_0x70f590['customerCountry']+_0x4fbd93(0x18e)+_0x1210eb[_0x4fbd93(0x113)]),console['log'](_0x4fbd93(0x14d)+_0x70f590[_0x4fbd93(0x159)]+'\x20->\x20'+_0x1210eb[_0x4fbd93(0x159)]),console[_0x4fbd93(0x15f)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x70f590[_0x4fbd93(0x19d)]?_0x4fbd93(0xec):'not\x20set')+_0x4fbd93(0x18e)+(_0x1210eb[_0x4fbd93(0x19d)]?_0x4fbd93(0xec):_0x4fbd93(0x101))),_0x1210eb;}async[a36_0x428702(0x152)](_0x34b743){const _0x4c1181=a36_0x428702,_0x58a726=new Date();let _0x5479cf;switch(_0x34b743){case'7d':_0x5479cf=new Date(_0x58a726[_0x4c1181(0x1b5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5479cf=new Date(_0x58a726['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4c1181(0xe5):_0x5479cf=new Date(_0x58a726[_0x4c1181(0x1b5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4c1181(0x16f):const _0x9676a4=await database_1[_0x4c1181(0x151)]['payment'][_0x4c1181(0x192)]({'where':{'gateway':{'not':_0x4c1181(0x14c)}},'orderBy':{'createdAt':_0x4c1181(0x1db)},'select':{'createdAt':!![]}});_0x5479cf=_0x9676a4?_0x9676a4['createdAt']:new Date(_0x4c1181(0x11f)),console[_0x4c1181(0x15f)](_0x4c1181(0x1c6)+_0x5479cf[_0x4c1181(0xc7)]());break;default:_0x5479cf=new Date(_0x58a726[_0x4c1181(0x1b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x450d47,_0x2089a4,_0xe09527,_0x567990,_0x30c263,_0x35e480,_0x361ce1]=await Promise[_0x4c1181(0x16f)]([database_1[_0x4c1181(0x151)][_0x4c1181(0xfb)][_0x4c1181(0x10e)](),database_1[_0x4c1181(0x151)][_0x4c1181(0xfb)][_0x4c1181(0x10e)]({'where':{'status':_0x4c1181(0x1d7)}}),database_1[_0x4c1181(0x151)]['payment'][_0x4c1181(0x10e)]({'where':{'createdAt':{'gte':_0x5479cf},'gateway':{'not':_0x4c1181(0x14c)}}}),database_1[_0x4c1181(0x151)][_0x4c1181(0x1ad)][_0x4c1181(0x10e)]({'where':{'status':_0x4c1181(0xe0),'createdAt':{'gte':_0x5479cf},'gateway':{'not':_0x4c1181(0x14c)}}}),database_1[_0x4c1181(0x151)][_0x4c1181(0x1ad)][_0x4c1181(0xf2)]({'where':{'status':'PAID','createdAt':{'gte':_0x5479cf},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x4c1181(0x151)][_0x4c1181(0x1ad)][_0x4c1181(0xf2)]({'where':{'gateway':{'not':_0x4c1181(0x14c)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4c1181(0x151)][_0x4c1181(0x1ad)][_0x4c1181(0xf2)]({'where':{'createdAt':{'gte':_0x5479cf},'gateway':{'not':_0x4c1181(0x14c)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x3bfd0b=0x0;for(const _0x2077e9 of _0x30c263){const _0x383da5=await currencyService_1[_0x4c1181(0xe8)][_0x4c1181(0xd3)](_0x2077e9['amount'],_0x2077e9[_0x4c1181(0x14b)]);_0x3bfd0b+=_0x383da5;}const _0x1bfde9=this[_0x4c1181(0x1a2)](_0x361ce1,_0x5479cf,_0x58a726),_0x447942=_0xe09527>0x0?_0x567990/_0xe09527*0x64:0x0;return{'totalShops':_0x450d47,'activeShops':_0x2089a4,'totalPayments':_0xe09527,'successfulPayments':_0x567990,'totalRevenue':Math[_0x4c1181(0x1c5)](_0x3bfd0b*0x64)/0x64,'conversionRate':Math['round'](_0x447942*0x64)/0x64,'dailyRevenue':_0x1bfde9['dailyRevenue'],'dailyPayments':_0x1bfde9[_0x4c1181(0xe3)],'recentPayments':_0x35e480['map'](_0x492ccf=>({'id':_0x492ccf['id'],'amount':_0x492ccf[_0x4c1181(0x11d)],'currency':_0x492ccf[_0x4c1181(0x14b)],'status':_0x492ccf['status'],'gateway':_0x492ccf[_0x4c1181(0xdd)],'shop':_0x492ccf[_0x4c1181(0xfb)],'createdAt':_0x492ccf[_0x4c1181(0x137)]}))};}async[a36_0x428702(0x166)](_0x90a69a){const _0x15dfe9=a36_0x428702;console[_0x15dfe9(0x15f)](_0x15dfe9(0xd5),_0x90a69a);let _0x32cf8f,_0x5090a0=new Date();if(_0x90a69a[_0x15dfe9(0x145)]===_0x15dfe9(0x148)&&_0x90a69a[_0x15dfe9(0x1d2)]&&_0x90a69a[_0x15dfe9(0x1de)])_0x32cf8f=new Date(_0x90a69a[_0x15dfe9(0x1d2)]),_0x5090a0=new Date(_0x90a69a[_0x15dfe9(0x1de)]);else{const _0x39db82=new Date();switch(_0x90a69a[_0x15dfe9(0x145)]){case'week':_0x32cf8f=new Date(_0x39db82['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x15dfe9(0x1b4):_0x32cf8f=new Date(_0x39db82[_0x15dfe9(0x1b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x15dfe9(0xba):_0x32cf8f=new Date(_0x39db82['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x32cf8f=new Date(_0x15dfe9(0x11f));break;}}console['log'](_0x15dfe9(0x1e7)+_0x32cf8f['toISOString']()+_0x15dfe9(0x1c7)+_0x5090a0[_0x15dfe9(0xc7)]());const _0x157913={'status':_0x15dfe9(0xe0),'gateway':{'not':_0x15dfe9(0x14c)},'paidAt':{'gte':_0x32cf8f,'lte':_0x5090a0}};_0x90a69a[_0x15dfe9(0x181)]&&(_0x157913[_0x15dfe9(0x181)]=_0x90a69a['shopId']);const _0x3b786e=await database_1['default'][_0x15dfe9(0x1ad)][_0x15dfe9(0xf2)]({'where':_0x157913,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x15dfe9(0x15f)]('💰\x20Found\x20'+_0x3b786e[_0x15dfe9(0xf1)]+_0x15dfe9(0xeb));const _0x28157f={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x32cf8f,'lte':_0x5090a0}};_0x90a69a[_0x15dfe9(0x181)]&&(_0x28157f[_0x15dfe9(0x181)]=_0x90a69a['shopId']);const _0x496681=await database_1['default'][_0x15dfe9(0x1ad)][_0x15dfe9(0x10e)]({'where':_0x28157f});console[_0x15dfe9(0x15f)](_0x15dfe9(0xf0)+_0x496681+_0x15dfe9(0x15a)+_0x3b786e[_0x15dfe9(0xf1)]);let _0x3c3a2c=0x0,_0x20d2b9=0x0,_0x50acfb=0x0;const _0x4d6acc={},_0x5bb427={},_0xff8212={};for(const _0x104fa4 of _0x3b786e){try{const _0x4f3427=await currencyService_1['currencyService'][_0x15dfe9(0xd3)](_0x104fa4['amount'],_0x104fa4[_0x15dfe9(0x14b)]);let _0x2c527c={};if(_0x104fa4['shop'][_0x15dfe9(0x112)])try{_0x2c527c=JSON['parse'](_0x104fa4[_0x15dfe9(0xfb)][_0x15dfe9(0x112)]);}catch(_0x19b17d){console[_0x15dfe9(0x17b)](_0x15dfe9(0x11b)+_0x104fa4[_0x15dfe9(0x181)]+':',_0x19b17d);}let _0x24a08c={},_0x208f77=0xa;for(const [_0x4a0ae9,_0x320c3c]of Object[_0x15dfe9(0x140)](_0x2c527c)){if(_0x4a0ae9[_0x15dfe9(0xc8)]()===_0x104fa4[_0x15dfe9(0xdd)][_0x15dfe9(0xc8)]()){_0x24a08c=_0x320c3c,_0x208f77=_0x320c3c[_0x15dfe9(0x11a)]||0xa;break;}}let _0x5d4fe3,_0x21da25;_0x104fa4[_0x15dfe9(0x178)]!==null&&_0x104fa4[_0x15dfe9(0x178)]!==undefined?(_0x5d4fe3=_0x104fa4[_0x15dfe9(0x178)],_0x21da25=_0x4f3427-_0x5d4fe3,console[_0x15dfe9(0x15f)]('📊\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x5d4fe3['toFixed'](0x6)+_0x15dfe9(0x1b0)+_0x104fa4['id'])):(_0x21da25=_0x4f3427*(_0x208f77/0x64),_0x5d4fe3=_0x4f3427-_0x21da25,console[_0x15dfe9(0x15f)](_0x15dfe9(0x189)+_0x104fa4['id']+':\x20'+_0x208f77+_0x15dfe9(0x16a)+_0x4f3427[_0x15dfe9(0x171)](0x6)+_0x15dfe9(0x198)));_0x3c3a2c+=_0x4f3427,_0x20d2b9+=_0x5d4fe3,_0x50acfb+=_0x21da25;!_0x4d6acc[_0x104fa4[_0x15dfe9(0xdd)]]&&(_0x4d6acc[_0x104fa4['gateway']]={'gateway':_0x104fa4[_0x15dfe9(0xdd)],'gatewayDisplayName':this[_0x15dfe9(0xef)](_0x104fa4[_0x15dfe9(0xdd)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4d6acc[_0x104fa4[_0x15dfe9(0xdd)]][_0x15dfe9(0x13f)]++,_0x4d6acc[_0x104fa4[_0x15dfe9(0xdd)]]['turnoverUSDT']+=_0x4f3427,_0x4d6acc[_0x104fa4[_0x15dfe9(0xdd)]][_0x15dfe9(0x111)]+=_0x21da25,_0x4d6acc[_0x104fa4[_0x15dfe9(0xdd)]][_0x15dfe9(0x1d5)]+=_0x5d4fe3,_0x4d6acc[_0x104fa4[_0x15dfe9(0xdd)]][_0x15dfe9(0x182)]+=_0x208f77;!_0x90a69a[_0x15dfe9(0x181)]&&(!_0x5bb427[_0x104fa4[_0x15dfe9(0x181)]]&&(_0x5bb427[_0x104fa4[_0x15dfe9(0x181)]]={'shopId':_0x104fa4['shopId'],'shopName':_0x104fa4[_0x15dfe9(0xfb)][_0x15dfe9(0x144)],'shopUsername':_0x104fa4[_0x15dfe9(0xfb)][_0x15dfe9(0xbe)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x5bb427[_0x104fa4[_0x15dfe9(0x181)]]['paymentsCount']++,_0x5bb427[_0x104fa4['shopId']][_0x15dfe9(0x15b)]+=_0x4f3427,_0x5bb427[_0x104fa4[_0x15dfe9(0x181)]]['commissionUSDT']+=_0x21da25,_0x5bb427[_0x104fa4[_0x15dfe9(0x181)]][_0x15dfe9(0x1d5)]+=_0x5d4fe3);const _0x4c2878=_0x104fa4[_0x15dfe9(0x11c)][_0x15dfe9(0xc7)]()[_0x15dfe9(0x138)]('T')[0x0];!_0xff8212[_0x4c2878]&&(_0xff8212[_0x4c2878]={'date':_0x4c2878,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xff8212[_0x4c2878][_0x15dfe9(0xf8)]+=_0x4f3427,_0xff8212[_0x4c2878][_0x15dfe9(0x1bf)]+=_0x5d4fe3,_0xff8212[_0x4c2878]['gatewayEarnings']+=_0x21da25,_0xff8212[_0x4c2878][_0x15dfe9(0x13f)]++;}catch(_0x3eda58){console[_0x15dfe9(0x17b)]('Error\x20processing\x20payment\x20'+_0x104fa4['id']+':',_0x3eda58);}}Object[_0x15dfe9(0x120)](_0x4d6acc)[_0x15dfe9(0x105)](_0x466708=>{const _0x257925=_0x15dfe9;_0x466708[_0x257925(0x1d4)]=_0x466708[_0x257925(0x13f)]>0x0?_0x466708['totalCommissionRate']/_0x466708[_0x257925(0x13f)]:0x0,delete _0x466708['totalCommissionRate'];}),Object[_0x15dfe9(0x120)](_0x5bb427)[_0x15dfe9(0x105)](_0x2149b0=>{const _0x2128c6=_0x15dfe9;_0x2149b0[_0x2128c6(0x1da)]=_0x2149b0['paymentsCount']>0x0?_0x2149b0[_0x2128c6(0x15b)]/_0x2149b0[_0x2128c6(0x13f)]:0x0;});let _0x28289c=0x0,_0x5b5cfb=0x0;if(_0x90a69a[_0x15dfe9(0x181)]){const _0x3ff74f=await database_1[_0x15dfe9(0x151)][_0x15dfe9(0x191)][_0x15dfe9(0xf2)]({'where':{'shopId':_0x90a69a[_0x15dfe9(0x181)],'status':_0x15dfe9(0x1c2),'createdAt':{'gte':_0x32cf8f,'lte':_0x5090a0}},'select':{'amount':!![]}});_0x28289c=_0x3ff74f['reduce']((_0x480700,_0xcf924a)=>_0x480700+_0xcf924a['amount'],0x0);const _0x5a1afb=await database_1[_0x15dfe9(0x151)][_0x15dfe9(0x191)][_0x15dfe9(0xf2)]({'where':{'shopId':_0x90a69a['shopId'],'status':_0x15dfe9(0x1be),'createdAt':{'gte':_0x32cf8f,'lte':_0x5090a0}},'select':{'amount':!![]}});_0x5b5cfb=_0x5a1afb[_0x15dfe9(0x15c)]((_0x15f5d1,_0x35e388)=>_0x15f5d1+_0x35e388['amount'],0x0);}const _0x36787e=_0x496681,_0x1d9ac1=_0x3b786e[_0x15dfe9(0xf1)],_0x6d413e=_0x1d9ac1>0x0?_0x3c3a2c/_0x1d9ac1:0x0,_0x4a495e=_0x36787e>0x0?Math['round'](_0x1d9ac1/_0x36787e*0x2710)/0x64:0x0,_0x545647=Math[_0x15dfe9(0x150)]((_0x5090a0[_0x15dfe9(0x1b5)]()-_0x32cf8f[_0x15dfe9(0x1b5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x569cec={'totalTurnover':Math[_0x15dfe9(0x1c5)](_0x3c3a2c*0x64)/0x64,'merchantEarnings':Math[_0x15dfe9(0x1c5)](_0x20d2b9*0x64)/0x64,'gatewayEarnings':Math['round'](_0x50acfb*0x64)/0x64,'totalPaidOut':Math[_0x15dfe9(0x1c5)](_0x28289c*0x64)/0x64,'pendingPayout':Math[_0x15dfe9(0x1c5)](_0x5b5cfb*0x64)/0x64,'averageCheck':Math[_0x15dfe9(0x1c5)](_0x6d413e*0x64)/0x64,'totalPayments':_0x36787e,'successfulPayments':_0x1d9ac1,'conversionRate':_0x4a495e,'gatewayBreakdown':Object['values'](_0x4d6acc)[_0x15dfe9(0xca)](_0x142a76=>({..._0x142a76,'turnoverUSDT':Math[_0x15dfe9(0x1c5)](_0x142a76['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x15dfe9(0x1c5)](_0x142a76[_0x15dfe9(0x111)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x15dfe9(0x1c5)](_0x142a76[_0x15dfe9(0x1d5)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x142a76['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x90a69a['shopId']?undefined:Object['values'](_0x5bb427)[_0x15dfe9(0xca)](_0x5ca138=>({..._0x5ca138,'turnoverUSDT':Math[_0x15dfe9(0x1c5)](_0x5ca138['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x15dfe9(0x1c5)](_0x5ca138[_0x15dfe9(0x111)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x15dfe9(0x1c5)](_0x5ca138[_0x15dfe9(0x1d5)]*0x64)/0x64,'paidOutUSDT':Math[_0x15dfe9(0x1c5)](_0x5ca138[_0x15dfe9(0x180)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x5ca138['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x15dfe9(0x120)](_0xff8212)[_0x15dfe9(0xca)](_0x4573ae=>({..._0x4573ae,'turnover':Math[_0x15dfe9(0x1c5)](_0x4573ae[_0x15dfe9(0xf8)]*0x64)/0x64,'merchantEarnings':Math[_0x15dfe9(0x1c5)](_0x4573ae['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4573ae['gatewayEarnings']*0x64)/0x64}))[_0x15dfe9(0x1af)]((_0x511956,_0x2a85ec)=>_0x511956[_0x15dfe9(0x1d9)][_0x15dfe9(0xe7)](_0x2a85ec['date'])),'periodInfo':{'from':_0x32cf8f,'to':_0x5090a0,'periodType':_0x90a69a['period']||_0x15dfe9(0x148),'daysCount':_0x545647}};return console[_0x15dfe9(0x15f)](_0x15dfe9(0x13c)),console[_0x15dfe9(0x15f)](_0x15dfe9(0xff)+_0x569cec[_0x15dfe9(0x1bb)]+_0x15dfe9(0x198)),console[_0x15dfe9(0x15f)](_0x15dfe9(0x14f)+_0x569cec[_0x15dfe9(0x1bf)]+'\x20USDT'),console['log'](_0x15dfe9(0x1ba)+_0x569cec['gatewayEarnings']+'\x20USDT'),console['log'](_0x15dfe9(0x1ac)+_0x569cec[_0x15dfe9(0x143)]+'\x20USDT'),console[_0x15dfe9(0x15f)](_0x15dfe9(0x165)+_0x569cec[_0x15dfe9(0x164)]+_0x15dfe9(0x198)),console['log'](_0x15dfe9(0x139)+_0x569cec[_0x15dfe9(0x104)]),_0x569cec;}async[a36_0x428702(0xe1)](){const _0x2b91d1=a36_0x428702;console[_0x2b91d1(0x15f)](_0x2b91d1(0x154));const _0x59670a=await database_1[_0x2b91d1(0x151)][_0x2b91d1(0xfb)][_0x2b91d1(0xf2)]({'where':{'status':_0x2b91d1(0x1d7)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2b91d1(0x1db)}});return console['log'](_0x2b91d1(0xf5)+_0x59670a['length']+_0x2b91d1(0x1a9)),_0x59670a[_0x2b91d1(0xca)](_0xbe7575=>({'id':_0xbe7575['id'],'username':_0xbe7575[_0x2b91d1(0xbe)],'name':_0xbe7575[_0x2b91d1(0x144)]}));}[a36_0x428702(0xef)](_0x5a2cd0){const _0x5bea7b=a36_0x428702,_0x176d28={'test_gateway':_0x5bea7b(0x1ce),'plisio':_0x5bea7b(0x1cc),'rapyd':_0x5bea7b(0x1e6),'noda':_0x5bea7b(0x197),'cointopay':_0x5bea7b(0x175),'cointopay2':_0x5bea7b(0x131),'klyme_eu':_0x5bea7b(0xfe),'klyme_gb':_0x5bea7b(0x1b6),'klyme_de':'KLYME\x20DE','mastercard':'MasterCard'};return _0x176d28[_0x5a2cd0]||_0x5a2cd0;}['getGatewayInternalName'](_0x201bd0){const _0x18547c=a36_0x428702,_0x388c4f={'Test\x20Gateway':'test_gateway','Plisio':_0x18547c(0x110),'Rapyd':'rapyd','Noda':_0x18547c(0x1a3),'CoinToPay':_0x18547c(0x153),'CoinToPay2':_0x18547c(0x1d6),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x18547c(0x109),'MasterCard':_0x18547c(0x18f)};return _0x388c4f[_0x201bd0]||_0x201bd0['toLowerCase']();}async['getMerchantsAwaitingPayout'](_0xda5c8b){const _0xda3be=a36_0x428702,{page:_0x3896f0,limit:_0x1c9eea,minAmount:_0x792773,search:_0x624c3c}=_0xda5c8b,_0x2a5f1b=(_0x3896f0-0x1)*_0x1c9eea;console[_0xda3be(0x15f)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0xda5c8b);const _0x4d1a5c={'balance':{'gt':0x0},'status':_0xda3be(0x1d7)};_0x792773&&(_0x4d1a5c[_0xda3be(0x122)][_0xda3be(0x1ab)]=_0x792773);_0x624c3c&&(_0x4d1a5c['OR']=[{'name':{'contains':_0x624c3c,'mode':_0xda3be(0x1c8)}},{'username':{'contains':_0x624c3c,'mode':_0xda3be(0x1c8)}}]);const [_0xf2a945,_0x114b71]=await Promise[_0xda3be(0x16f)]([database_1[_0xda3be(0x151)][_0xda3be(0xfb)][_0xda3be(0xf2)]({'where':_0x4d1a5c,'skip':_0x2a5f1b,'take':_0x1c9eea,'orderBy':{'balance':_0xda3be(0x161)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0xda3be(0x151)][_0xda3be(0xfb)][_0xda3be(0x10e)]({'where':_0x4d1a5c})]);console[_0xda3be(0x15f)](_0xda3be(0x134)+_0xf2a945[_0xda3be(0xf1)]+_0xda3be(0x187));const _0x49c3b5=await Promise[_0xda3be(0x16f)](_0xf2a945[_0xda3be(0xca)](async _0x4b0bcf=>{const _0x2947ba=_0xda3be,[_0xbf911e,_0x1628fb,_0xe1bce5]=await Promise['all']([database_1[_0x2947ba(0x151)][_0x2947ba(0x1ad)][_0x2947ba(0x10e)]({'where':{'shopId':_0x4b0bcf['id'],'status':_0x2947ba(0xe0),'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x2947ba(0x1ad)][_0x2947ba(0x192)]({'where':{'shopId':_0x4b0bcf['id'],'status':_0x2947ba(0xe0),'gateway':{'not':_0x2947ba(0x14c)}},'orderBy':{'paidAt':_0x2947ba(0x1db)},'select':{'paidAt':!![]}}),database_1[_0x2947ba(0x151)][_0x2947ba(0x1ad)][_0x2947ba(0x1ed)]({'by':[_0x2947ba(0xdd)],'where':{'shopId':_0x4b0bcf['id'],'status':_0x2947ba(0xe0),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4c0347=new Date(),_0xf438ee=new Date(_0x4c0347[_0x2947ba(0x11e)](),_0x4c0347[_0x2947ba(0x1dd)](),0x1),_0x5345ff=new Date(_0x4c0347[_0x2947ba(0x11e)](),_0x4c0347[_0x2947ba(0x1dd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3db3f8,_0x489d4b]=await Promise[_0x2947ba(0x16f)]([database_1[_0x2947ba(0x151)][_0x2947ba(0x191)][_0x2947ba(0x129)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4b0bcf['id'],'status':_0x2947ba(0x1c2)}}),database_1[_0x2947ba(0x151)][_0x2947ba(0x191)][_0x2947ba(0x129)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4b0bcf['id'],'status':_0x2947ba(0x1c2),'createdAt':{'gte':_0xf438ee,'lte':_0x5345ff}}})]),_0x81185=_0x3db3f8[_0x2947ba(0x12a)][_0x2947ba(0x11d)]||0x0,_0x94a15d=_0x489d4b['_sum'][_0x2947ba(0x11d)]||0x0,_0x20a261=await Promise[_0x2947ba(0x16f)](_0xe1bce5[_0x2947ba(0xca)](async _0x7c6d32=>{const _0x1b32ff=_0x2947ba;let _0x4cba02=0xa;if(_0x4b0bcf['gatewaySettings'])try{const _0x4f4441=JSON['parse'](_0x4b0bcf['gatewaySettings']);for(const [_0x165ed3,_0x4d71f6]of Object[_0x1b32ff(0x140)](_0x4f4441)){if(_0x165ed3[_0x1b32ff(0xc8)]()===_0x7c6d32[_0x1b32ff(0xdd)][_0x1b32ff(0xc8)]()){_0x4cba02=_0x4d71f6[_0x1b32ff(0x11a)]||0xa,console['log']('💰\x20[PAYOUT]\x20Gateway\x20'+_0x7c6d32[_0x1b32ff(0xdd)]+'\x20for\x20shop\x20'+_0x4b0bcf['id']+_0x1b32ff(0x142)+_0x4cba02+'%');break;}}}catch(_0x5c3ce7){console[_0x1b32ff(0x17b)](_0x1b32ff(0x11b)+_0x4b0bcf['id']+':',_0x5c3ce7);}const _0x2195dc=_0x7c6d32[_0x1b32ff(0x12a)]?.['amountUSDT']||0x0,_0x45566a=_0x2195dc*(0x1-_0x4cba02/0x64);return{'gateway':_0x7c6d32[_0x1b32ff(0xdd)],'count':_0x7c6d32[_0x1b32ff(0x103)]?.['id']||0x0,'amountUSDT':Math[_0x1b32ff(0x1c5)](_0x2195dc*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x45566a*0x64)/0x64,'commission':_0x4cba02};})),_0x302d3c=_0x20a261['reduce']((_0x5d7258,_0x2205df)=>_0x5d7258+_0x2205df[_0x2947ba(0x155)],0x0),_0x448d72=_0x4b0bcf['balance'];return console[_0x2947ba(0x15f)](_0x2947ba(0x1a4)+_0x4b0bcf['username']+':'),console[_0x2947ba(0x15f)]('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x302d3c[_0x2947ba(0x171)](0x2)+_0x2947ba(0x102)),console[_0x2947ba(0x15f)]('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x20a261[_0x2947ba(0x15c)]((_0x3f3778,_0x2ade2a)=>_0x3f3778+_0x2ade2a['amountAfterCommissionUSDT'],0x0)['toFixed'](0x2)+_0x2947ba(0x1e2)),console['log']('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x448d72[_0x2947ba(0x171)](0x2)+'\x20USDT\x20(after\x20payouts)'),{'id':_0x4b0bcf['id'],'fullName':_0x4b0bcf[_0x2947ba(0x144)],'username':_0x4b0bcf['username'],'telegramId':_0x4b0bcf[_0x2947ba(0x185)],'merchantUrl':_0x4b0bcf[_0x2947ba(0xea)],'wallets':{'usdtPolygonWallet':_0x4b0bcf[_0x2947ba(0x146)],'usdtTrcWallet':_0x4b0bcf[_0x2947ba(0xdb)],'usdtErcWallet':_0x4b0bcf[_0x2947ba(0x18a)],'usdcPolygonWallet':_0x4b0bcf[_0x2947ba(0x1df)]},'totalAmountUSDT':Math[_0x2947ba(0x1c5)](_0x302d3c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x448d72*0x64)/0x64,'totalPayout':Math[_0x2947ba(0x1c5)](_0x81185*0x64)/0x64,'thisMonth':Math[_0x2947ba(0x1c5)](_0x94a15d*0x64)/0x64,'paymentsCount':_0xbf911e,'oldestPaymentDate':_0x1628fb?.[_0x2947ba(0x11c)]||_0x4b0bcf[_0x2947ba(0x137)],'gatewayBreakdown':_0x20a261};})),_0xc20a94=_0x49c3b5[_0xda3be(0x15c)]((_0x18e3e7,_0x4be681)=>_0x18e3e7+_0x4be681['totalAmountUSDT'],0x0),_0x4ff730=_0x49c3b5[_0xda3be(0x15c)]((_0x5d1186,_0x4901e9)=>_0x5d1186+_0x4901e9[_0xda3be(0x135)],0x0),_0x3f435d=_0x49c3b5[_0xda3be(0x15c)]((_0x422020,_0x5171b6)=>_0x422020+_0x5171b6[_0xda3be(0x1ca)],0x0),_0x2a037c=_0x49c3b5[_0xda3be(0x15c)]((_0x5ddd42,_0x1abe08)=>_0x5ddd42+_0x1abe08[_0xda3be(0x1c3)],0x0);return console[_0xda3be(0x15f)](_0xda3be(0xce)+_0x114b71+'\x20merchants'),console[_0xda3be(0x15f)](_0xda3be(0xf7)+Math[_0xda3be(0x1c5)](_0xc20a94*0x64)/0x64+_0xda3be(0x102)),console[_0xda3be(0x15f)](_0xda3be(0x1d1)+Math[_0xda3be(0x1c5)](_0x4ff730*0x64)/0x64+_0xda3be(0xbc)),console[_0xda3be(0x15f)](_0xda3be(0x199)+Math['round'](_0x3f435d*0x64)/0x64+_0xda3be(0x198)),console[_0xda3be(0x15f)](_0xda3be(0x177)+Math[_0xda3be(0x1c5)](_0x2a037c*0x64)/0x64+_0xda3be(0x198)),{'merchants':_0x49c3b5,'pagination':{'page':_0x3896f0,'limit':_0x1c9eea,'total':_0x114b71,'totalPages':Math['ceil'](_0x114b71/_0x1c9eea)},'summary':{'totalMerchants':_0x114b71,'totalAmountUSDT':Math[_0xda3be(0x1c5)](_0xc20a94*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xda3be(0x1c5)](_0x4ff730*0x64)/0x64,'totalPayout':Math[_0xda3be(0x1c5)](_0x3f435d*0x64)/0x64,'thisMonth':Math[_0xda3be(0x1c5)](_0x2a037c*0x64)/0x64}};}async[a36_0x428702(0xc2)](_0x462a95){const _0x33dc27=a36_0x428702,{shopId:_0x540853,amount:_0x29bffd,network:_0x5a7681,wallet:_0x3ed493,notes:_0x1dbbea,txid:_0x2ab8d2,periodFrom:_0x2cba39,periodTo:_0xb6db63}=_0x462a95,_0x354ce2=await database_1[_0x33dc27(0x151)]['$transaction'](async _0x1ba005=>{const _0x2197fd=_0x33dc27,_0x1b0a79=await _0x1ba005[_0x2197fd(0xfb)]['findUnique']({'where':{'id':_0x540853},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1b0a79)throw new Error(_0x2197fd(0x160));console[_0x2197fd(0x15f)](_0x2197fd(0xd7)+_0x1b0a79[_0x2197fd(0xbe)]+':'),console[_0x2197fd(0x15f)]('\x20\x20\x20Current\x20balance:\x20'+_0x1b0a79['balance']['toFixed'](0x6)+_0x2197fd(0x198)),console[_0x2197fd(0x15f)](_0x2197fd(0x1a1)+_0x29bffd[_0x2197fd(0x171)](0x6)+_0x2197fd(0x198)),console[_0x2197fd(0x15f)](_0x2197fd(0x119)+_0x1b0a79['totalPaidOut']['toFixed'](0x6)+_0x2197fd(0x198));if(_0x2ab8d2)console[_0x2197fd(0x15f)](_0x2197fd(0xd6)+_0x2ab8d2);if(_0x1b0a79[_0x2197fd(0x122)]<_0x29bffd)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x1b0a79[_0x2197fd(0x122)][_0x2197fd(0x171)](0x6)+_0x2197fd(0x1e4)+_0x29bffd[_0x2197fd(0x171)](0x6)+_0x2197fd(0x198));let _0x3ad4c5=_0x3ed493;if(!_0x3ad4c5){const _0x4f230b=await _0x1ba005[_0x2197fd(0xfb)][_0x2197fd(0xbd)]({'where':{'id':_0x540853},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4f230b)switch(_0x5a7681){case _0x2197fd(0x12f):_0x3ad4c5=_0x4f230b['usdtPolygonWallet']||undefined;break;case _0x2197fd(0xd1):_0x3ad4c5=_0x4f230b[_0x2197fd(0xdb)]||undefined;break;case _0x2197fd(0x1cb):_0x3ad4c5=_0x4f230b[_0x2197fd(0x18a)]||undefined;break;case'polygon_usdc':_0x3ad4c5=_0x4f230b[_0x2197fd(0x1df)]||undefined;break;}}console[_0x2197fd(0x15f)](_0x2197fd(0x162)+_0x5a7681+':\x20'+(_0x3ad4c5||_0x2197fd(0x158)));const _0x506cbb=await _0x1ba005[_0x2197fd(0x191)][_0x2197fd(0x183)]({'data':{'shopId':_0x540853,'amount':_0x29bffd,'network':_0x5a7681,'status':'COMPLETED','txid':_0x2ab8d2,'notes':_0x1dbbea,'periodFrom':_0x2cba39?new Date(_0x2cba39):null,'periodTo':_0xb6db63?new Date(_0xb6db63):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3f7fce=_0x1b0a79['balance']-_0x29bffd,_0x2351ff=_0x1b0a79['totalPaidOut']+_0x29bffd;return await _0x1ba005[_0x2197fd(0xfb)][_0x2197fd(0x132)]({'where':{'id':_0x540853},'data':{'balance':_0x3f7fce,'totalPaidOut':_0x2351ff}}),console['log'](_0x2197fd(0x114)+_0x1b0a79[_0x2197fd(0xbe)]+'\x20balance\x20updated:'),console[_0x2197fd(0x15f)](_0x2197fd(0xe6)+_0x1b0a79[_0x2197fd(0x122)]['toFixed'](0x6)+'\x20->\x20'+_0x3f7fce[_0x2197fd(0x171)](0x6)+_0x2197fd(0x170)+_0x29bffd['toFixed'](0x6)+')'),console[_0x2197fd(0x15f)](_0x2197fd(0x13b)+_0x1b0a79[_0x2197fd(0x143)][_0x2197fd(0x171)](0x6)+_0x2197fd(0x18e)+_0x2351ff[_0x2197fd(0x171)](0x6)+_0x2197fd(0xb8)+_0x29bffd['toFixed'](0x6)+')'),{'payout':_0x506cbb,'shop':_0x1b0a79};});return console['log'](_0x33dc27(0xc5)+_0x354ce2[_0x33dc27(0x191)]['id']+_0x33dc27(0x15d)+_0x354ce2[_0x33dc27(0xfb)][_0x33dc27(0xbe)]+'\x20('+_0x29bffd+'\x20USDT)'),{'id':_0x354ce2[_0x33dc27(0x191)]['id'],'shopId':_0x354ce2['payout'][_0x33dc27(0x181)],'shopName':_0x354ce2[_0x33dc27(0xfb)][_0x33dc27(0x144)],'shopUsername':_0x354ce2[_0x33dc27(0xfb)][_0x33dc27(0xbe)],'amount':_0x354ce2[_0x33dc27(0x191)]['amount'],'network':_0x354ce2[_0x33dc27(0x191)][_0x33dc27(0x1ea)],'status':_0x354ce2['payout'][_0x33dc27(0x16b)],'txid':_0x354ce2[_0x33dc27(0x191)][_0x33dc27(0xc0)],'notes':_0x354ce2[_0x33dc27(0x191)][_0x33dc27(0x12c)],'periodFrom':_0x354ce2[_0x33dc27(0x191)][_0x33dc27(0x12d)],'periodTo':_0x354ce2[_0x33dc27(0x191)]['periodTo'],'createdAt':_0x354ce2[_0x33dc27(0x191)][_0x33dc27(0x137)],'paidAt':_0x354ce2[_0x33dc27(0x191)][_0x33dc27(0x11c)]};}async[a36_0x428702(0x19a)](_0x294ace){const _0x31d1e0=a36_0x428702,{page:_0x198041,limit:_0x1f1212,shopId:_0x210e5e,network:_0x5a223d,dateFrom:_0x5b5603,dateTo:_0x1b8938,search:_0x4e619c}=_0x294ace,_0x1359a2=(_0x198041-0x1)*_0x1f1212,_0x3d8e66={};_0x210e5e&&(_0x3d8e66['shopId']=_0x210e5e);_0x5a223d&&(_0x3d8e66[_0x31d1e0(0x1ea)]=_0x5a223d);(_0x5b5603||_0x1b8938)&&(_0x3d8e66['createdAt']={},_0x5b5603&&(_0x3d8e66[_0x31d1e0(0x137)][_0x31d1e0(0x1ab)]=new Date(_0x5b5603)),_0x1b8938&&(_0x3d8e66[_0x31d1e0(0x137)][_0x31d1e0(0x118)]=new Date(_0x1b8938)));_0x4e619c&&(_0x3d8e66['OR']=[{'shop':{'name':{'contains':_0x4e619c,'mode':_0x31d1e0(0x1c8)}}},{'shop':{'username':{'contains':_0x4e619c,'mode':'insensitive'}}},{'notes':{'contains':_0x4e619c,'mode':_0x31d1e0(0x1c8)}}]);const [_0x2e368a,_0x429b88]=await Promise[_0x31d1e0(0x16f)]([database_1[_0x31d1e0(0x151)][_0x31d1e0(0x191)]['findMany']({'where':_0x3d8e66,'skip':_0x1359a2,'take':_0x1f1212,'orderBy':{'createdAt':_0x31d1e0(0x161)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x31d1e0(0x151)][_0x31d1e0(0x191)][_0x31d1e0(0x10e)]({'where':_0x3d8e66})]);return{'payouts':_0x2e368a['map'](_0x463aeb=>({'id':_0x463aeb['id'],'shopId':_0x463aeb[_0x31d1e0(0x181)],'shopName':_0x463aeb['shop']['name'],'shopUsername':_0x463aeb['shop'][_0x31d1e0(0xbe)],'amount':_0x463aeb[_0x31d1e0(0x11d)],'network':_0x463aeb[_0x31d1e0(0x1ea)],'status':_0x463aeb[_0x31d1e0(0x16b)],'txid':_0x463aeb['txid'],'notes':_0x463aeb[_0x31d1e0(0x12c)],'periodFrom':_0x463aeb[_0x31d1e0(0x12d)],'periodTo':_0x463aeb[_0x31d1e0(0x1e1)],'createdAt':_0x463aeb[_0x31d1e0(0x137)],'paidAt':_0x463aeb[_0x31d1e0(0x11c)]})),'pagination':{'page':_0x198041,'limit':_0x1f1212,'total':_0x429b88,'totalPages':Math['ceil'](_0x429b88/_0x1f1212)}};}async[a36_0x428702(0xcc)](_0x40f95f){const _0x9fe070=a36_0x428702,_0x3b0673=await database_1[_0x9fe070(0x151)]['payout'][_0x9fe070(0xbd)]({'where':{'id':_0x40f95f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3b0673)return null;return{'id':_0x3b0673['id'],'shopId':_0x3b0673['shopId'],'shopName':_0x3b0673['shop'][_0x9fe070(0x144)],'shopUsername':_0x3b0673[_0x9fe070(0xfb)]['username'],'amount':_0x3b0673['amount'],'network':_0x3b0673[_0x9fe070(0x1ea)],'status':_0x3b0673[_0x9fe070(0x16b)],'txid':_0x3b0673[_0x9fe070(0xc0)],'notes':_0x3b0673[_0x9fe070(0x12c)],'periodFrom':_0x3b0673[_0x9fe070(0x12d)],'periodTo':_0x3b0673[_0x9fe070(0x1e1)],'createdAt':_0x3b0673['createdAt'],'paidAt':_0x3b0673[_0x9fe070(0x11c)]};}async['deletePayout'](_0x15f318){const _0x27ce81=a36_0x428702;await database_1[_0x27ce81(0x151)][_0x27ce81(0x191)][_0x27ce81(0xbf)]({'where':{'id':_0x15f318}});}async[a36_0x428702(0xf6)](_0x540a62){const _0x4e4345=a36_0x428702,{page:_0x524444,limit:_0x30c192,status:_0x41ce2e,gateway:_0x416a4d,shopId:_0x4441f1,dateFrom:_0x525c52,dateTo:_0x444715,search:_0x5b2f8f,currency:_0x2cd11f,sortBy:_0x190f87,sortOrder:_0x2f26ac}=_0x540a62,_0x31c272=(_0x524444-0x1)*_0x30c192;console[_0x4e4345(0x15f)](_0x4e4345(0x1a5),_0x540a62);const _0x527302=await database_1['default']['payment'][_0x4e4345(0x1ed)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log']('📊\x20Available\x20gateways\x20in\x20database:',_0x527302['map'](_0x2fb619=>_0x2fb619[_0x4e4345(0xdd)]+'\x20('+_0x2fb619['_count']['gateway']+'\x20payments)'));if(_0x416a4d){const _0x4df161=_0x527302[_0x4e4345(0x1b9)](_0x2d28de=>_0x2d28de['gateway'][_0x4e4345(0xc8)]()===_0x416a4d[_0x4e4345(0xc8)]());!_0x4df161&&_0x416a4d[_0x4e4345(0xc8)]()!==_0x4e4345(0x14c)&&console['log']('⚠️\x20Requested\x20gateway\x20\x27'+_0x416a4d+_0x4e4345(0x136)+_0x527302[_0x4e4345(0xca)](_0x11a179=>_0x11a179[_0x4e4345(0xdd)])[_0x4e4345(0x115)](',\x20'));}const _0x3d4831={};_0x41ce2e&&(_0x3d4831['status']=_0x41ce2e['toUpperCase']());if(!_0x416a4d)_0x3d4831['gateway']={'not':_0x4e4345(0x14c)};else{if(_0x416a4d&&(_0x416a4d[_0x4e4345(0xc8)]()===_0x4e4345(0x14c)||_0x416a4d===_0x4e4345(0x18b)))_0x3d4831[_0x4e4345(0xdd)]=_0x4e4345(0x14c);else{let _0x176256=_0x416a4d;const _0x2ce894=(0x0,gateway_1['getGatewayNameById'])(_0x416a4d);if(_0x2ce894)_0x176256=_0x2ce894,console[_0x4e4345(0x15f)](_0x4e4345(0x174)+_0x416a4d+_0x4e4345(0xfd)+_0x176256+'\x27');else{const _0x5de3b5=(0x0,gateway_1['getGatewayIdByName'])(_0x416a4d);if(_0x5de3b5){const _0x465c45=(0x0,gateway_1[_0x4e4345(0x1e3)])(_0x5de3b5);_0x465c45&&(_0x176256=_0x465c45,console[_0x4e4345(0x15f)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x416a4d+_0x4e4345(0x1a6)+_0x5de3b5+_0x4e4345(0x1eb)+_0x176256+'\x27'));}else console[_0x4e4345(0x15f)](_0x4e4345(0x133)+_0x416a4d+_0x4e4345(0x128));}const _0x5749fb=await database_1[_0x4e4345(0x151)][_0x4e4345(0x1ad)]['count']({'where':{'gateway':_0x176256[_0x4e4345(0xc8)]()},'take':0x1});_0x5749fb===0x0?(console[_0x4e4345(0x15f)](_0x4e4345(0xd8)+_0x176256+_0x4e4345(0x108)+_0x416a4d+_0x4e4345(0x10b)),_0x3d4831[_0x4e4345(0xdd)]='NONEXISTENT_GATEWAY_FILTER'):(_0x3d4831[_0x4e4345(0xdd)]=_0x176256[_0x4e4345(0xc8)](),console[_0x4e4345(0x15f)](_0x4e4345(0x127)+_0x176256+_0x4e4345(0x108)+_0x416a4d+'\x27)'));}}console[_0x4e4345(0x15f)](_0x4e4345(0xc4),_0x3d4831[_0x4e4345(0xdd)]);_0x4441f1&&(_0x3d4831[_0x4e4345(0x181)]=_0x4441f1);_0x2cd11f&&(_0x3d4831[_0x4e4345(0x14b)]=_0x2cd11f[_0x4e4345(0x167)](),console[_0x4e4345(0x15f)](_0x4e4345(0x1dc)+_0x2cd11f['toUpperCase']()));(_0x525c52||_0x444715)&&(_0x3d4831['createdAt']={},_0x525c52&&(_0x3d4831[_0x4e4345(0x137)]['gte']=new Date(_0x525c52)),_0x444715&&(_0x3d4831['createdAt']['lte']=new Date(_0x444715)));_0x5b2f8f&&(_0x3d4831['OR']=[{'id':{'contains':_0x5b2f8f,'mode':'insensitive'}},{'orderId':{'contains':_0x5b2f8f,'mode':_0x4e4345(0x1c8)}},{'gatewayOrderId':{'contains':_0x5b2f8f,'mode':_0x4e4345(0x1c8)}},{'customerEmail':{'contains':_0x5b2f8f,'mode':_0x4e4345(0x1c8)}},{'shop':{'name':{'contains':_0x5b2f8f,'mode':_0x4e4345(0x1c8)}}},{'shop':{'username':{'contains':_0x5b2f8f,'mode':_0x4e4345(0x1c8)}}}]);console[_0x4e4345(0x15f)](_0x4e4345(0xdf),JSON[_0x4e4345(0x16e)](_0x3d4831,null,0x2));let _0x2f35da={'createdAt':_0x4e4345(0x161)};if(_0x190f87){const _0x391391=[_0x4e4345(0x11d),'createdAt','updatedAt',_0x4e4345(0x16b),_0x4e4345(0xdd),_0x4e4345(0x14b)],_0x17425a=['asc',_0x4e4345(0x161)];if(_0x391391[_0x4e4345(0xd0)](_0x190f87)){const _0x2d122b=_0x17425a['includes'](_0x2f26ac)?_0x2f26ac:'desc';_0x2f35da={[_0x190f87]:_0x2d122b},console['log'](_0x4e4345(0x126)+_0x190f87+_0x4e4345(0x1b8)+_0x2d122b+_0x4e4345(0x186));}}const [_0xd21da2,_0x375712]=await Promise[_0x4e4345(0x16f)]([database_1[_0x4e4345(0x151)][_0x4e4345(0x1ad)][_0x4e4345(0xf2)]({'where':_0x3d4831,'skip':_0x31c272,'take':_0x30c192,'orderBy':_0x2f35da,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4e4345(0x151)]['payment'][_0x4e4345(0x10e)]({'where':_0x3d4831})]);return{'payments':_0xd21da2,'pagination':{'page':_0x524444,'limit':_0x30c192,'total':_0x375712,'totalPages':Math['ceil'](_0x375712/_0x30c192)}};}async[a36_0x428702(0x190)](_0x562fe8){const _0x2f5c91=a36_0x428702,_0x167879=await database_1[_0x2f5c91(0x151)]['payment']['findUnique']({'where':{'id':_0x562fe8},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x167879)return null;return{'id':_0x167879['id'],'shopId':_0x167879[_0x2f5c91(0x181)],'gateway':_0x167879[_0x2f5c91(0xdd)],'amount':_0x167879[_0x2f5c91(0x11d)],'currency':_0x167879[_0x2f5c91(0x14b)],'status':_0x167879[_0x2f5c91(0x16b)],'orderId':_0x167879['orderId'],'gatewayOrderId':_0x167879['gatewayOrderId'],'customerEmail':_0x167879[_0x2f5c91(0x19e)],'customerName':_0x167879[_0x2f5c91(0x16c)],'customerCountry':_0x167879[_0x2f5c91(0x113)],'customerIp':_0x167879[_0x2f5c91(0x159)],'customerUa':_0x167879[_0x2f5c91(0x19d)],'failureMessage':_0x167879[_0x2f5c91(0x1d8)],'externalPaymentUrl':_0x167879[_0x2f5c91(0x163)],'successUrl':_0x167879['successUrl'],'failUrl':_0x167879[_0x2f5c91(0x17d)],'pendingUrl':_0x167879[_0x2f5c91(0x1c1)],'whiteUrl':_0x167879[_0x2f5c91(0x1c4)],'createdAt':_0x167879['createdAt'],'updatedAt':_0x167879[_0x2f5c91(0x169)],'shop':_0x167879['shop']};}async[a36_0x428702(0x10a)](_0x4b6c19,_0xbefe7f,_0x1aaba4,_0x279949){const _0x37d0ee=a36_0x428702,_0x2066bd=await database_1['default'][_0x37d0ee(0x188)](async _0x17ee82=>{const _0x29f798=_0x37d0ee,_0x14e0fc=await _0x17ee82['payment'][_0x29f798(0xbd)]({'where':{'id':_0x4b6c19},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x14e0fc)throw new Error(_0x29f798(0xcb));const _0x5ed267=_0x14e0fc[_0x29f798(0x16b)],_0x5551ea=_0xbefe7f[_0x29f798(0x167)]();console[_0x29f798(0x15f)](_0x29f798(0x12e)+_0x4b6c19+_0x29f798(0xda)+_0x5ed267+'\x20->\x20'+_0x5551ea),console['log'](_0x29f798(0x1bd)+_0x14e0fc[_0x29f798(0xfb)][_0x29f798(0x122)]+_0x29f798(0x198));const _0xb2fdc7={'status':_0x5551ea,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x1aaba4&&(_0xb2fdc7['adminNotes']=_0x1aaba4);_0x5551ea===_0x29f798(0x1e5)&&_0x279949&&(_0xb2fdc7[_0x29f798(0x1aa)]=_0x279949);let _0x276966=0x0,_0xd11469=_0x14e0fc[_0x29f798(0xfb)][_0x29f798(0x122)];if(_0x5551ea===_0x29f798(0xe0)&&_0x5ed267!==_0x29f798(0xe0)){_0xb2fdc7['paidAt']=new Date();const _0x4b928f=await currencyService_1[_0x29f798(0xe8)][_0x29f798(0xd3)](_0x14e0fc[_0x29f798(0x11d)],_0x14e0fc['currency']);_0xb2fdc7[_0x29f798(0x155)]=_0x4b928f;let _0x3b26e6=0xa;const _0x57ad49=await _0x17ee82['shop'][_0x29f798(0xbd)]({'where':{'id':_0x14e0fc[_0x29f798(0x181)]},'select':{'gatewaySettings':!![]}});if(_0x57ad49?.['gatewaySettings'])try{const _0xda6d64=JSON[_0x29f798(0x10d)](_0x57ad49[_0x29f798(0x112)]);for(const [_0x5cb794,_0x459761]of Object[_0x29f798(0x140)](_0xda6d64)){if(_0x5cb794[_0x29f798(0xc8)]()===_0x14e0fc['gateway'][_0x29f798(0xc8)]()){_0x3b26e6=_0x459761[_0x29f798(0x11a)]||0xa;break;}}}catch(_0x2af74c){console[_0x29f798(0x17b)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x4b6c19+':',_0x2af74c);}let _0x5b7d12;_0x14e0fc[_0x29f798(0x178)]!==null&&_0x14e0fc['amountAfterGatewayCommissionUSDT']!==undefined?(_0x5b7d12=_0x14e0fc[_0x29f798(0x178)],console['log']('📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x5b7d12[_0x29f798(0x171)](0x6)+_0x29f798(0x1b0)+_0x4b6c19)):(_0x5b7d12=_0x4b928f*(0x1-_0x3b26e6/0x64),console[_0x29f798(0x15f)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x4b6c19+':\x20'+_0x3b26e6+'%\x20from\x20'+_0x4b928f[_0x29f798(0x171)](0x6)+'\x20USDT'),_0xb2fdc7[_0x29f798(0x178)]=_0x5b7d12),_0x276966=_0x5b7d12,_0xd11469+=_0x5b7d12,console['log']('💰\x20Payment\x20'+_0x4b6c19+_0x29f798(0x1a0)),console['log'](_0x29f798(0x1b1)+_0x4b928f[_0x29f798(0x171)](0x6)+'\x20USDT'),console['log'](_0x29f798(0x1a8)+_0x14e0fc[_0x29f798(0xdd)]+_0x29f798(0x1d3)+_0x3b26e6+'%'),console[_0x29f798(0x15f)](_0x29f798(0x179)+_0x5b7d12[_0x29f798(0x171)](0x6)+_0x29f798(0x17c)+_0x3b26e6+_0x29f798(0x1bc)),console[_0x29f798(0x15f)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x5b7d12['toFixed'](0x6)+_0x29f798(0x198));}else{if(_0x5ed267===_0x29f798(0xe0)&&_0x5551ea!==_0x29f798(0xe0)){if(_0x14e0fc[_0x29f798(0x155)]){let _0x2caa0d=0xa;const _0x488523=await _0x17ee82['shop']['findUnique']({'where':{'id':_0x14e0fc[_0x29f798(0x181)]},'select':{'gatewaySettings':!![]}});if(_0x488523?.[_0x29f798(0x112)])try{const _0x4257e7=JSON[_0x29f798(0x10d)](_0x488523[_0x29f798(0x112)]);for(const [_0x4fefd9,_0x453f13]of Object[_0x29f798(0x140)](_0x4257e7)){if(_0x4fefd9[_0x29f798(0xc8)]()===_0x14e0fc[_0x29f798(0xdd)][_0x29f798(0xc8)]()){_0x2caa0d=_0x453f13[_0x29f798(0x11a)]||0xa;break;}}}catch(_0x13ceaf){console[_0x29f798(0x17b)](_0x29f798(0xc3)+_0x4b6c19+':',_0x13ceaf);}const _0x272734=_0x14e0fc[_0x29f798(0x155)]*(0x1-_0x2caa0d/0x64);_0x276966=-_0x272734,_0xd11469-=_0x272734,_0xb2fdc7['amountUSDT']=null,_0xb2fdc7[_0x29f798(0x178)]=null,console['log'](_0x29f798(0x19f)+_0x4b6c19+'\x20no\x20longer\x20PAID:'),console[_0x29f798(0x15f)](_0x29f798(0x1b1)+_0x14e0fc[_0x29f798(0x155)][_0x29f798(0x171)](0x6)+_0x29f798(0x198)),console[_0x29f798(0x15f)](_0x29f798(0x1a8)+_0x14e0fc[_0x29f798(0xdd)]+_0x29f798(0x1d3)+_0x2caa0d+'%'),console[_0x29f798(0x15f)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x272734[_0x29f798(0x171)](0x6)+_0x29f798(0x17c)+_0x2caa0d+_0x29f798(0x1bc)),console[_0x29f798(0x15f)](_0x29f798(0x100)+_0x272734[_0x29f798(0x171)](0x6)+'\x20USDT');}}}_0x5551ea===_0x29f798(0x1e5)&&(_0x5ed267==='PAID'&&_0x14e0fc[_0x29f798(0x155)]&&console[_0x29f798(0x15f)](_0x29f798(0xb9)),_0x279949&&_0x279949>0x0&&(_0x276966-=_0x279949,_0xd11469-=_0x279949,console[_0x29f798(0x15f)](_0x29f798(0x156)+_0x279949['toFixed'](0x6)+_0x29f798(0x116))));_0x5551ea===_0x29f798(0x1b2)&&_0x5ed267==='PAID'&&console[_0x29f798(0x15f)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x1d9698=await _0x17ee82['payment'][_0x29f798(0x132)]({'where':{'id':_0x4b6c19},'data':_0xb2fdc7,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x276966!==0x0&&(await _0x17ee82[_0x29f798(0xfb)][_0x29f798(0x132)]({'where':{'id':_0x14e0fc[_0x29f798(0x181)]},'data':{'balance':_0xd11469}}),console['log'](_0x29f798(0x114)+_0x14e0fc[_0x29f798(0x181)]+_0x29f798(0x130)+_0x14e0fc[_0x29f798(0xfb)][_0x29f798(0x122)][_0x29f798(0x171)](0x6)+_0x29f798(0x18e)+_0xd11469['toFixed'](0x6)+'\x20USDT\x20('+(_0x276966>0x0?'+':'')+_0x276966['toFixed'](0x6)+')')),_0x1d9698;});return{'id':_0x2066bd['id'],'shopId':_0x2066bd[_0x37d0ee(0x181)],'gateway':_0x2066bd[_0x37d0ee(0xdd)],'amount':_0x2066bd[_0x37d0ee(0x11d)],'currency':_0x2066bd['currency'],'status':_0x2066bd[_0x37d0ee(0x16b)],'orderId':_0x2066bd[_0x37d0ee(0xfa)],'gatewayOrderId':_0x2066bd[_0x37d0ee(0x15e)],'customerEmail':_0x2066bd['customerEmail'],'customerName':_0x2066bd['customerName'],'customerCountry':_0x2066bd[_0x37d0ee(0x113)],'customerIp':_0x2066bd[_0x37d0ee(0x159)],'customerUa':_0x2066bd[_0x37d0ee(0x19d)],'failureMessage':_0x2066bd[_0x37d0ee(0x1d8)],'adminNotes':_0x2066bd['adminNotes'],'chargebackAmount':_0x2066bd['chargebackAmount'],'statusChangedBy':_0x2066bd[_0x37d0ee(0x117)],'statusChangedAt':_0x2066bd['statusChangedAt'],'createdAt':_0x2066bd[_0x37d0ee(0x137)],'updatedAt':_0x2066bd[_0x37d0ee(0x169)],'shop':_0x2066bd[_0x37d0ee(0xfb)]};}async['updateUser'](_0x453f80,_0x3412ba){const _0x383712=a36_0x428702,_0x561e1b=Math[_0x383712(0x1e9)]()[_0x383712(0x195)](0x24)[_0x383712(0xf3)](0x2,0x9);console[_0x383712(0x15f)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x561e1b+',\x20userId:\x20'+_0x453f80);const _0x5def3d={..._0x3412ba};_0x3412ba[_0x383712(0x17e)]&&_0x3412ba[_0x383712(0x17e)]['trim']()!==''?(console[_0x383712(0x15f)]('🔐\x20['+_0x561e1b+_0x383712(0x13a)+_0x453f80),_0x5def3d[_0x383712(0x17e)]=await bcryptjs_1[_0x383712(0x151)][_0x383712(0xc9)](_0x3412ba[_0x383712(0x17e)],0xc)):(console[_0x383712(0x15f)](_0x383712(0x149)+_0x561e1b+_0x383712(0x147)),delete _0x5def3d[_0x383712(0x17e)]);_0x3412ba['fullName']&&(_0x5def3d[_0x383712(0x144)]=_0x3412ba[_0x383712(0xd4)],delete _0x5def3d['fullName']);_0x3412ba[_0x383712(0xcf)]&&(_0x5def3d['telegram']=_0x3412ba['telegramId'],delete _0x5def3d['telegramId']);_0x3412ba['merchantUrl']&&(_0x5def3d[_0x383712(0xea)]=_0x3412ba['merchantUrl'],delete _0x5def3d[_0x383712(0xd9)]);if(_0x3412ba[_0x383712(0xde)]){const _0x2bbb48=_0x3412ba[_0x383712(0xde)][_0x383712(0xca)](_0x2426a7=>this['getGatewayInternalName'](_0x2426a7));console[_0x383712(0x15f)](_0x383712(0x17f),_0x3412ba[_0x383712(0xde)],'->',_0x2bbb48),_0x5def3d['paymentGateways']=JSON['stringify'](_0x2bbb48),delete _0x5def3d[_0x383712(0xde)];}_0x3412ba[_0x383712(0x112)]&&(console[_0x383712(0x15f)](_0x383712(0x124)+_0x561e1b+']\x20Gateway\x20settings\x20before\x20saving:',_0x3412ba[_0x383712(0x112)]),_0x5def3d[_0x383712(0x112)]=JSON[_0x383712(0x16e)](_0x3412ba[_0x383712(0x112)]),console[_0x383712(0x15f)]('🔧\x20['+_0x561e1b+_0x383712(0x13d),_0x5def3d[_0x383712(0x112)]));_0x3412ba[_0x383712(0x1ec)]&&(_0x3412ba[_0x383712(0x1ec)][_0x383712(0x146)]!==undefined&&(_0x5def3d['usdtPolygonWallet']=_0x3412ba[_0x383712(0x1ec)][_0x383712(0x146)]||null),_0x3412ba[_0x383712(0x1ec)]['usdtTrcWallet']!==undefined&&(_0x5def3d[_0x383712(0xdb)]=_0x3412ba[_0x383712(0x1ec)][_0x383712(0xdb)]||null),_0x3412ba[_0x383712(0x1ec)][_0x383712(0x18a)]!==undefined&&(_0x5def3d[_0x383712(0x18a)]=_0x3412ba[_0x383712(0x1ec)][_0x383712(0x18a)]||null),_0x3412ba[_0x383712(0x1ec)][_0x383712(0x1df)]!==undefined&&(_0x5def3d['usdcPolygonWallet']=_0x3412ba[_0x383712(0x1ec)][_0x383712(0x1df)]||null),delete _0x5def3d[_0x383712(0x1ec)]);const _0x38ae46=await database_1['default'][_0x383712(0xfb)][_0x383712(0x132)]({'where':{'id':_0x453f80},'data':_0x5def3d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x383712(0x15f)](_0x383712(0xcd)+_0x561e1b+_0x383712(0x1e0),_0x38ae46[_0x383712(0x112)]),{'id':_0x38ae46['id'],'fullName':_0x38ae46[_0x383712(0x144)],'username':_0x38ae46[_0x383712(0xbe)],'telegramId':_0x38ae46['telegram'],'merchantUrl':_0x38ae46[_0x383712(0xea)],'gateways':_0x38ae46[_0x383712(0x184)]?JSON[_0x383712(0x10d)](_0x38ae46['paymentGateways']):null,'gatewaySettings':_0x38ae46[_0x383712(0x112)]?JSON[_0x383712(0x10d)](_0x38ae46[_0x383712(0x112)]):null,'publicKey':_0x38ae46[_0x383712(0x18d)],'wallets':{'usdtPolygonWallet':_0x38ae46['usdtPolygonWallet'],'usdtTrcWallet':_0x38ae46['usdtTrcWallet'],'usdtErcWallet':_0x38ae46[_0x383712(0x18a)],'usdcPolygonWallet':_0x38ae46['usdcPolygonWallet']},'status':_0x38ae46[_0x383712(0x16b)],'createdAt':_0x38ae46[_0x383712(0x137)]};}async[a36_0x428702(0x1e8)](_0x5787b0){const _0x5b41cc=a36_0x428702,_0x84ff5b=await database_1[_0x5b41cc(0x151)][_0x5b41cc(0xfb)][_0x5b41cc(0x132)]({'where':{'id':_0x5787b0},'data':{'status':_0x5b41cc(0x196)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x84ff5b['id'],'fullName':_0x84ff5b[_0x5b41cc(0x144)],'username':_0x84ff5b[_0x5b41cc(0xbe)],'telegramId':_0x84ff5b[_0x5b41cc(0x185)],'merchantUrl':_0x84ff5b[_0x5b41cc(0xea)],'gateways':_0x84ff5b[_0x5b41cc(0x184)]?JSON['parse'](_0x84ff5b[_0x5b41cc(0x184)]):null,'gatewaySettings':_0x84ff5b[_0x5b41cc(0x112)]?JSON['parse'](_0x84ff5b[_0x5b41cc(0x112)]):null,'publicKey':_0x84ff5b[_0x5b41cc(0x18d)],'wallets':{'usdtPolygonWallet':_0x84ff5b[_0x5b41cc(0x146)],'usdtTrcWallet':_0x84ff5b[_0x5b41cc(0xdb)],'usdtErcWallet':_0x84ff5b[_0x5b41cc(0x18a)],'usdcPolygonWallet':_0x84ff5b[_0x5b41cc(0x1df)]},'status':_0x84ff5b[_0x5b41cc(0x16b)],'createdAt':_0x84ff5b[_0x5b41cc(0x137)]};}async['activateUser'](_0xecc78a){const _0x4f3356=a36_0x428702,_0x527a4d=await database_1[_0x4f3356(0x151)][_0x4f3356(0xfb)]['update']({'where':{'id':_0xecc78a},'data':{'status':_0x4f3356(0x1d7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x527a4d['id'],'fullName':_0x527a4d[_0x4f3356(0x144)],'username':_0x527a4d[_0x4f3356(0xbe)],'telegramId':_0x527a4d[_0x4f3356(0x185)],'merchantUrl':_0x527a4d[_0x4f3356(0xea)],'gateways':_0x527a4d[_0x4f3356(0x184)]?JSON[_0x4f3356(0x10d)](_0x527a4d[_0x4f3356(0x184)]):null,'gatewaySettings':_0x527a4d[_0x4f3356(0x112)]?JSON[_0x4f3356(0x10d)](_0x527a4d[_0x4f3356(0x112)]):null,'publicKey':_0x527a4d[_0x4f3356(0x18d)],'wallets':{'usdtPolygonWallet':_0x527a4d['usdtPolygonWallet'],'usdtTrcWallet':_0x527a4d[_0x4f3356(0xdb)],'usdtErcWallet':_0x527a4d[_0x4f3356(0x18a)],'usdcPolygonWallet':_0x527a4d[_0x4f3356(0x1df)]},'status':_0x527a4d[_0x4f3356(0x16b)],'createdAt':_0x527a4d[_0x4f3356(0x137)]};}async['getAllUsers'](_0x5f04fb){const _0x184865=a36_0x428702,{page:_0x3d312a,limit:_0x2a41e6,status:_0x42bc06}=_0x5f04fb,_0x477535=(_0x3d312a-0x1)*_0x2a41e6,_0x122d47={};_0x42bc06&&(_0x122d47[_0x184865(0x16b)]=_0x42bc06[_0x184865(0x167)]());const [_0x392fbf,_0x228f39]=await Promise['all']([database_1['default'][_0x184865(0xfb)][_0x184865(0xf2)]({'where':_0x122d47,'skip':_0x477535,'take':_0x2a41e6,'orderBy':{'createdAt':_0x184865(0x161)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x184865(0x151)]['shop'][_0x184865(0x10e)]({'where':_0x122d47})]);return{'users':_0x392fbf[_0x184865(0xca)](_0xff6b91=>{const _0x4ac704=_0x184865,_0x202659=_0xff6b91[_0x4ac704(0x184)]?JSON['parse'](_0xff6b91['paymentGateways']):null,_0x31167f=_0x202659?_0x202659[_0x4ac704(0xca)](_0x4c489b=>this[_0x4ac704(0xef)](_0x4c489b)):null;return{'id':_0xff6b91['id'],'fullName':_0xff6b91[_0x4ac704(0x144)],'username':_0xff6b91[_0x4ac704(0xbe)],'telegramId':_0xff6b91['telegram'],'merchantUrl':_0xff6b91[_0x4ac704(0xea)],'gateways':_0x31167f,'gatewaySettings':_0xff6b91[_0x4ac704(0x112)]?JSON[_0x4ac704(0x10d)](_0xff6b91[_0x4ac704(0x112)]):null,'publicKey':_0xff6b91[_0x4ac704(0x18d)],'wallets':{'usdtPolygonWallet':_0xff6b91[_0x4ac704(0x146)],'usdtTrcWallet':_0xff6b91[_0x4ac704(0xdb)],'usdtErcWallet':_0xff6b91['usdtErcWallet'],'usdcPolygonWallet':_0xff6b91[_0x4ac704(0x1df)]},'status':_0xff6b91[_0x4ac704(0x16b)],'createdAt':_0xff6b91[_0x4ac704(0x137)]};}),'pagination':{'page':_0x3d312a,'limit':_0x2a41e6,'total':_0x228f39,'totalPages':Math['ceil'](_0x228f39/_0x2a41e6)}};}async[a36_0x428702(0x1a7)](_0x90bf5){const _0x1e79dc=a36_0x428702,_0xf80dc2=await database_1[_0x1e79dc(0x151)][_0x1e79dc(0xfb)][_0x1e79dc(0xbd)]({'where':{'id':_0x90bf5},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xf80dc2)return null;const _0x40a99d=_0xf80dc2[_0x1e79dc(0x184)]?JSON[_0x1e79dc(0x10d)](_0xf80dc2[_0x1e79dc(0x184)]):null,_0x33fa91=_0x40a99d?_0x40a99d['map'](_0x2da931=>this[_0x1e79dc(0xef)](_0x2da931)):null;return _0x40a99d&&_0x33fa91&&console['log']('🔄\x20Gateway\x20mapping\x20(get):',_0x40a99d,'->',_0x33fa91),{'id':_0xf80dc2['id'],'fullName':_0xf80dc2['name'],'username':_0xf80dc2[_0x1e79dc(0xbe)],'telegramId':_0xf80dc2[_0x1e79dc(0x185)],'merchantUrl':_0xf80dc2['shopUrl'],'gateways':_0x33fa91,'gatewaySettings':_0xf80dc2[_0x1e79dc(0x112)]?JSON[_0x1e79dc(0x10d)](_0xf80dc2[_0x1e79dc(0x112)]):null,'publicKey':_0xf80dc2[_0x1e79dc(0x18d)],'wallets':{'usdtPolygonWallet':_0xf80dc2[_0x1e79dc(0x146)],'usdtTrcWallet':_0xf80dc2['usdtTrcWallet'],'usdtErcWallet':_0xf80dc2['usdtErcWallet'],'usdcPolygonWallet':_0xf80dc2[_0x1e79dc(0x1df)]},'status':_0xf80dc2[_0x1e79dc(0x16b)],'createdAt':_0xf80dc2[_0x1e79dc(0x137)]};}async[a36_0x428702(0x121)](_0x716ef7){const _0x26a219=a36_0x428702,{fullName:_0x1b5b1c,username:_0x7d0cb0,password:_0x32fb1e,telegramId:_0x174d9f,merchantUrl:_0x3ef966,gateways:_0x44b8fc,gatewaySettings:_0x1ddca2,wallets:_0x40103c}=_0x716ef7,_0x1ad39a=await database_1[_0x26a219(0x151)][_0x26a219(0xfb)]['findUnique']({'where':{'username':_0x7d0cb0}});if(_0x1ad39a)throw new Error('Username\x20already\x20exists');if(_0x174d9f){const _0x3e8130=await database_1[_0x26a219(0x151)][_0x26a219(0xfb)][_0x26a219(0xbd)]({'where':{'telegram':_0x174d9f}});if(_0x3e8130)throw new Error(_0x26a219(0x157));}const _0x1e0624=await bcryptjs_1[_0x26a219(0x151)][_0x26a219(0xc9)](_0x32fb1e,0xc),_0xd8a43d=_0x26a219(0x1c0)+crypto_1[_0x26a219(0x151)][_0x26a219(0xe9)](0x20)[_0x26a219(0x195)](_0x26a219(0x1d0)),_0x1bdd31=_0x26a219(0x19c)+crypto_1[_0x26a219(0x151)]['randomBytes'](0x20)[_0x26a219(0x195)]('hex'),_0x2a4670=_0x44b8fc?_0x44b8fc[_0x26a219(0xca)](_0x5a2d63=>this[_0x26a219(0x19b)](_0x5a2d63)):null;_0x44b8fc&&_0x2a4670&&console[_0x26a219(0x15f)]('🔄\x20Gateway\x20mapping\x20(create):',_0x44b8fc,'->',_0x2a4670);const _0x1af647=await database_1[_0x26a219(0x151)][_0x26a219(0xfb)][_0x26a219(0x183)]({'data':{'name':_0x1b5b1c,'username':_0x7d0cb0,'password':_0x1e0624,'telegram':_0x174d9f,'shopUrl':_0x3ef966,'paymentGateways':_0x2a4670?JSON[_0x26a219(0x16e)](_0x2a4670):null,'gatewaySettings':_0x1ddca2?JSON[_0x26a219(0x16e)](_0x1ddca2):null,'usdtPolygonWallet':_0x40103c?.[_0x26a219(0x146)]||null,'usdtTrcWallet':_0x40103c?.[_0x26a219(0xdb)]||null,'usdtErcWallet':_0x40103c?.[_0x26a219(0x18a)]||null,'usdcPolygonWallet':_0x40103c?.[_0x26a219(0x1df)]||null,'publicKey':_0xd8a43d,'secretKey':_0x1bdd31,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1af647['id'],'fullName':_0x1af647[_0x26a219(0x144)],'username':_0x1af647[_0x26a219(0xbe)],'telegramId':_0x1af647[_0x26a219(0x185)],'merchantUrl':_0x1af647[_0x26a219(0xea)],'gateways':_0x1af647['paymentGateways']?JSON[_0x26a219(0x10d)](_0x1af647['paymentGateways']):null,'gatewaySettings':_0x1af647[_0x26a219(0x112)]?JSON['parse'](_0x1af647[_0x26a219(0x112)]):null,'publicKey':_0x1af647['publicKey'],'wallets':{'usdtPolygonWallet':_0x1af647[_0x26a219(0x146)],'usdtTrcWallet':_0x1af647[_0x26a219(0xdb)],'usdtErcWallet':_0x1af647['usdtErcWallet'],'usdcPolygonWallet':_0x1af647[_0x26a219(0x1df)]},'status':_0x1af647[_0x26a219(0x16b)],'createdAt':_0x1af647[_0x26a219(0x137)]};}async[a36_0x428702(0x10c)](_0x1160ce){const _0x45789a=a36_0x428702;await database_1[_0x45789a(0x151)][_0x45789a(0xfb)][_0x45789a(0xbf)]({'where':{'id':_0x1160ce}});}[a36_0x428702(0x1a2)](_0x1783b1,_0x50a71f,_0x5203fe){const _0x5e6b83=a36_0x428702,_0xd067bf=new Map(),_0x40c75e=new Date(_0x50a71f);while(_0x40c75e<=_0x5203fe){const _0x254edc=_0x40c75e[_0x5e6b83(0xc7)]()[_0x5e6b83(0x138)]('T')[0x0];_0xd067bf[_0x5e6b83(0xec)](_0x254edc,{'revenue':0x0,'count':0x0}),_0x40c75e['setDate'](_0x40c75e[_0x5e6b83(0xc1)]()+0x1);}for(const _0x406056 of _0x1783b1){const _0x8f467d=_0x406056[_0x5e6b83(0x137)][_0x5e6b83(0xc7)]()[_0x5e6b83(0x138)]('T')[0x0],_0x61478a=_0xd067bf[_0x5e6b83(0x106)](_0x8f467d);_0x61478a&&(_0x61478a[_0x5e6b83(0x10e)]+=0x1,_0x406056[_0x5e6b83(0x16b)]===_0x5e6b83(0xe0)&&(_0x406056[_0x5e6b83(0x155)]?_0x61478a[_0x5e6b83(0x17a)]+=_0x406056[_0x5e6b83(0x155)]:console[_0x5e6b83(0x15f)](_0x5e6b83(0x173)+_0x406056['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x33eb6b=[],_0x329291=[];for(const [_0x5959fa,_0x1e5dde]of _0xd067bf){_0x33eb6b['push']({'date':_0x5959fa,'amount':Math['round'](_0x1e5dde[_0x5e6b83(0x17a)]*0x64)/0x64}),_0x329291['push']({'date':_0x5959fa,'count':_0x1e5dde['count']});}return{'dailyRevenue':_0x33eb6b,'dailyPayments':_0x329291};}}exports[a36_0x428702(0xbb)]=AdminService;