'use strict';function a40_0x4bbf(){const _0x4ceee9=['üìä\x20Sorting\x20payments\x20by\x20','year','%\x20commission)','\x20\x20\x20Gateway:\x20','rapyd','push','COMPLETED','getMonth','generateDailyStatistics','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','amountAfterGatewayCommissionUSDT','min',',\x20Commission:\x20','createUser','üìä\x20Final\x20WHERE\x20conditions:','üí∞\x20Shop\x20','custom',',\x20userId:\x20','crypto','\x20USDT\x20for\x20payment\x20','customerIp','1CMVhNi','üîê\x20[','\x20payments)','chargebackAmount','default','getGatewayDisplayName','totalTurnover','90d','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','period','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','üîÑ\x20Gateway\x20mapping\x20(create):','Noda','Rapyd',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','\x20\x20\x20Payout\x20amount:\x20','Error\x20processing\x20payment\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','./currencyService','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','üìä\x20Getting\x20payments\x20with\x20filters:','delete','gateways','payment','totalPayments','‚úÖ\x20Payout\x20created:\x20','getSystemStatistics','390862LuYzTo','groupBy','11IGZcAv','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','üîç\x20Balance\x20check\x20details:','plisio','payout','pendingUrl','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','amount','commissionUSDT','failureMessage','Payment\x20not\x20found','error','telegram','name','shopId','merchantEarnings','log','\x20USDT\x20(','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','cointopay2','week','Plisio','findUnique','toISOString','turnoverUSDT','mastercard','klyme_de','randomBytes','\x20merchants\x20with\x20positive\x20balance','statusChangedAt','averageCheckUSDT','erc20','paymentGateways','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','AdminService','hash','wallets','\x20merchants','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','count','setDate','balance','deleteUser','7419392QoJbSb','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','availableBalance','create','currency','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','turnover','üí∞\x20[PAYOUT]\x20Merchant\x20','periodFrom','commission','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','yesterday','üìã\x20Found\x20','\x20USDT\x20(after\x20','\x20\x20\x20Tolerance:\x20','random','39708TiONFe','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','../config/database','all','\x20\x20\x20üí∞\x20Total\x20payout:\x20','substr','shopUrl',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','updatedAt','hex','whiteUrl','lte','statusChangedBy','publicKey','\x20USDT,\x20Difference:\x20','_count','\x20\x20\x20Total\x20paid\x20out:\x20','status','__esModule','2020-01-01','getAllUsers','üîÑ\x20Gateway\x20mapping:','‚ö†Ô∏è\x20Gateway\x20\x27','paidOutUSDT','getFullYear','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','map','pk_','üìä\x20Total\x20payments\x20(including\x20failed):\x20','getGatewayIdByName',':\x20commission\x20=\x20','gte','toFixed','getUserById','\x20\x20\x20Balance:\x20','\x20\x20\x20üìÖ\x20This\x20month:\x20','setHours','merchantEarningsUSDT',']\x20Updating\x20password\x20for\x20user\x20','\x20USDT\x20(theoretical\x20net)','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','entries','\x20status:\x20','gatewayCommissionRate','\x20paid\x20payments\x20for\x20analysis','\x20balance\x20updated:\x20','üîÑ\x20Converted\x20gateway\x20name\x20\x27','getTime','totalPaidOut','ACTIVE','\x20USDT','../types/gateway','getDate','desc','gatewayEarnings','some','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','‚ö†Ô∏è\x20Payment\x20','\x20PAID\x20payments','485UxhrCZ','paidAt','gatewaySettings','getPayoutStats','üìä\x20Calculating\x20payout\x20statistics...','username','ceil','set','localeCompare','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20Merchant\x20gets:\x20','Shop\x20not\x20found','getMerchantStatistics','password','suspendUser','KLYME\x20DE','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','üí∞\x20[PAYOUT]\x20Gateway\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','customerEmail','txid','periodTo','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','adminNotes','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','toUpperCase','üìä\x20Merchants\x20awaiting\x20payout:\x20','\x20active\x20merchants\x20for\x20selection','test_gateway','PAID','getAllPayments','\x20\x20\x20üåç\x20Country:\x20','fullName','noda','klyme_eu','Insufficient\x20balance.\x20Available:\x20','toLowerCase','Test\x20Gateway','createPayout','üîß\x20[','join','forEach','CoinToPay','createdAt','get','getPaymentById','\x20USDT\x20(+','thisMonth','deletePayout','üí≥\x20Payout\x20wallet\x20for\x20','successUrl','convertToUSDT','dateFrom','usdcPolygonWallet','MasterCard','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','dateTo','__importDefault','round','not\x20specified','\x20balance\x20updated:','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','KLYME\x20EU','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20Full\x20amount:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','update','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','warn','shop','7298410uVZGBS','findFirst','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','orderId','\x20\x20\x20üíµ\x20Available\x20balance:\x20','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','üìã\x20Getting\x20merchants\x20selection\x20list...','usdcErcWallet','üí∞\x20Found\x20','values','not\x20set','polygon','date','\x20\x20\x20üí≥\x20Total\x20payments:\x20','gateway','insensitive','getMerchantsSelection','KLYME\x20GB','1320evIDWt','SUSPENDED','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','üîç\x20Using\x20gateway\x20\x27','$transaction','usdtPolygonWallet','\x27\x20->\x20name\x20\x27','usdtTrcWallet','\x20in\x20','\x20USDT)','merchantUrl','54712140JXarzQ','üìÖ\x20Period:\x20','toString','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20USDT\x20(-','Username\x20already\x20exists','paymentsCount','findMany','updatePaymentStatus','averageCommissionRate','revenue','\x20USDT\x20(actual\x20balances)','erc20_usdc','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','\x20\x20\x20Requested\x20(number):\x20','\x20USDT\x20(already\x20paid\x20out)','gatewayOrderId','_sum','getGatewayInternalName','\x27\x20(from\x20\x27','activateUser','\x20USDT\x20(gross\x20revenue)','\x20USDT\x20(same\x20as\x20awaiting)','admin','68802YPCDpD','üìä\x20Gateway\x20filter\x20applied:','reduce','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20->\x20','114412ZAHBJt','Open\x20Banking\x202','split','üí∞\x20Current\x20shop\x20balance:\x20','bcryptjs','totalPayout','network','notes','üìä\x20Available\x20gateways\x20in\x20database:','\x20\x20\x20Difference:\x20','%\x20from\x20','asc','telegramId','totalAmountAfterCommissionUSDT','\x20\x20\x20Merchant\x20loses:\x20','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','parse','\x20\x20\x20ü§î\x20Difference:\x20','getAllPayouts',']\x20Gateway\x20settings\x20JSON\x20string:','stringify','51ynZLXn','CHARGEBACK','customerCountry','aggregate','\x20to\x20','totalCommissionRate','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','includes','currencyService','amountAfterCommissionUSDT','customerUa','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20üåê\x20IP:\x20','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','awaitingPayout','failUrl','\x27\x20to\x20name\x20\x27','day','\x20USDT\x20(current\x20balance\x20in\x20DB)','\x20USDT,\x20merchant:\x20','usdtErcWallet','\x20became\x20PAID:','getGatewayNameById','length','amountUSDT','trc20','üìä\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'];a40_0x4bbf=function(){return _0x4ceee9;};return a40_0x4bbf();}const a40_0x383efb=a40_0x4154;(function(_0x3b9b7f,_0x1c2b5c){const _0x1f85c1=a40_0x4154,_0x1ba221=_0x3b9b7f();while(!![]){try{const _0x157bc4=parseInt(_0x1f85c1(0x29b))/0x1*(parseInt(_0x1f85c1(0x2b8))/0x2)+-parseInt(_0x1f85c1(0x26a))/0x3*(parseInt(_0x1f85c1(0x255))/0x4)+parseInt(_0x1f85c1(0x1d4))/0x5*(-parseInt(_0x1f85c1(0x250))/0x6)+-parseInt(_0x1f85c1(0x21b))/0x7+-parseInt(_0x1f85c1(0x2e5))/0x8+parseInt(_0x1f85c1(0x2f5))/0x9*(-parseInt(_0x1f85c1(0x22d))/0xa)+-parseInt(_0x1f85c1(0x2ba))/0xb*(-parseInt(_0x1f85c1(0x238))/0xc);if(_0x157bc4===_0x1c2b5c)break;else _0x1ba221['push'](_0x1ba221['shift']());}catch(_0x924864){_0x1ba221['push'](_0x1ba221['shift']());}}}(a40_0x4bbf,0x9368c));var __importDefault=this&&this[a40_0x383efb(0x20e)]||function(_0x4198b6){return _0x4198b6&&_0x4198b6['__esModule']?_0x4198b6:{'default':_0x4198b6};};function a40_0x4154(_0x3753fc,_0x599899){const _0x4bbff2=a40_0x4bbf();return a40_0x4154=function(_0x4154c5,_0x384ffe){_0x4154c5=_0x4154c5-0x1b8;let _0x48f928=_0x4bbff2[_0x4154c5];return _0x48f928;},a40_0x4154(_0x3753fc,_0x599899);}Object['defineProperty'](exports,a40_0x383efb(0x307),{'value':!![]}),exports[a40_0x383efb(0x2dc)]=void 0x0;const database_1=__importDefault(require(a40_0x383efb(0x2f7))),bcryptjs_1=__importDefault(require(a40_0x383efb(0x259))),crypto_1=__importDefault(require(a40_0x383efb(0x298))),currencyService_1=require(a40_0x383efb(0x2af)),gateway_1=require(a40_0x383efb(0x1cc));class AdminService{async[a40_0x383efb(0x1d7)](){const _0x27f384=a40_0x383efb;console['log'](_0x27f384(0x1d8));const _0x4fa8af=await database_1[_0x27f384(0x29f)][_0x27f384(0x21a)][_0x27f384(0x26d)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x4775c9=await database_1[_0x27f384(0x29f)][_0x27f384(0x2b4)][_0x27f384(0x2e1)]({'where':{'status':_0x27f384(0x1f2),'gateway':{'not':_0x27f384(0x1f1)}}}),_0x4197af=new Date(),_0x225301=new Date(_0x4197af['getFullYear'](),_0x4197af['getMonth'](),0x1),_0x12057b=new Date(_0x4197af[_0x27f384(0x30d)](),_0x4197af[_0x27f384(0x28d)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2c3915=await database_1['default'][_0x27f384(0x2be)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x225301,'lte':_0x12057b},'status':_0x27f384(0x28c)}}),_0x25c0c0=_0x4fa8af[_0x27f384(0x249)][_0x27f384(0x1c9)]||0x0,_0x390a7a=_0x4fa8af[_0x27f384(0x249)]['balance']||0x0,_0x52d195=_0x2c3915[_0x27f384(0x249)][_0x27f384(0x2c1)]||0x0,_0x4710c3={'totalPayout':Math[_0x27f384(0x20f)](_0x25c0c0*0x64)/0x64,'awaitingPayout':Math[_0x27f384(0x20f)](_0x390a7a*0x64)/0x64,'thisMonth':Math[_0x27f384(0x20f)](_0x52d195*0x64)/0x64,'availableBalance':Math['round'](_0x390a7a*0x64)/0x64,'totalPayments':_0x4775c9};return console[_0x27f384(0x2ca)]('üìä\x20Payout\x20statistics\x20calculated:'),console['log'](_0x27f384(0x2f9)+_0x4710c3[_0x27f384(0x25a)]+_0x27f384(0x253)),console['log'](_0x27f384(0x2ae)+_0x4710c3[_0x27f384(0x278)]+_0x27f384(0x2a6)),console[_0x27f384(0x2ca)](_0x27f384(0x21f)+_0x4710c3[_0x27f384(0x2e7)]+_0x27f384(0x24e)),console[_0x27f384(0x2ca)](_0x27f384(0x1bb)+_0x4710c3[_0x27f384(0x204)]+_0x27f384(0x1cb)),console[_0x27f384(0x2ca)](_0x27f384(0x228)+_0x4710c3[_0x27f384(0x2b5)]+_0x27f384(0x1d3)),_0x4710c3;}async['updateCustomerData'](_0x3c22c9,_0x4c0c5d){const _0x343380=a40_0x383efb;console['log']('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x3c22c9+':',_0x4c0c5d);const _0x477f5e=await database_1[_0x343380(0x29f)][_0x343380(0x2b4)]['findUnique']({'where':{'id':_0x3c22c9},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x477f5e)throw new Error(_0x343380(0x2c4));const _0x2d29d9={};_0x4c0c5d['customerCountry']!==undefined&&(_0x2d29d9[_0x343380(0x26c)]=_0x4c0c5d[_0x343380(0x26c)]||null);_0x4c0c5d['customerIp']!==undefined&&(_0x2d29d9[_0x343380(0x29a)]=_0x4c0c5d[_0x343380(0x29a)]||null);_0x4c0c5d[_0x343380(0x274)]!==undefined&&(_0x2d29d9[_0x343380(0x274)]=_0x4c0c5d[_0x343380(0x274)]||null);const _0xa72e78=await database_1['default'][_0x343380(0x2b4)]['update']({'where':{'id':_0x3c22c9},'data':{..._0x2d29d9,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x343380(0x28f)+_0x3c22c9),console[_0x343380(0x2ca)](_0x343380(0x1f4)+_0x477f5e[_0x343380(0x26c)]+_0x343380(0x254)+_0xa72e78['customerCountry']),console[_0x343380(0x2ca)](_0x343380(0x276)+_0x477f5e[_0x343380(0x29a)]+_0x343380(0x254)+_0xa72e78['customerIp']),console['log'](_0x343380(0x1ec)+(_0x477f5e[_0x343380(0x274)]?_0x343380(0x1db):_0x343380(0x225))+_0x343380(0x254)+(_0xa72e78[_0x343380(0x274)]?_0x343380(0x1db):'not\x20set')),_0xa72e78;}async[a40_0x383efb(0x2b7)](_0x361d16){const _0x39ad12=a40_0x383efb,_0x3a3f02=new Date();let _0x2d688a;switch(_0x361d16['toLowerCase']()){case _0x39ad12(0x27b):_0x2d688a=new Date(_0x3a3f02[_0x39ad12(0x30d)](),_0x3a3f02[_0x39ad12(0x28d)](),_0x3a3f02[_0x39ad12(0x1cd)](),0x0,0x0,0x0,0x0);break;case _0x39ad12(0x2f0):const _0x59adae=new Date(_0x3a3f02);_0x59adae[_0x39ad12(0x2e2)](_0x59adae[_0x39ad12(0x1cd)]()-0x1),_0x2d688a=new Date(_0x59adae['getFullYear'](),_0x59adae[_0x39ad12(0x28d)](),_0x59adae['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x2d688a=new Date(_0x3a3f02[_0x39ad12(0x1c8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2d688a=new Date(_0x3a3f02[_0x39ad12(0x1c8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x39ad12(0x2a2):_0x2d688a=new Date(_0x3a3f02[_0x39ad12(0x1c8)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x39ad12(0x2f8):const _0x5042ba=await database_1[_0x39ad12(0x29f)][_0x39ad12(0x2b4)]['findFirst']({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x39ad12(0x260)},'select':{'createdAt':!![]}});_0x2d688a=_0x5042ba?_0x5042ba[_0x39ad12(0x200)]:new Date(_0x39ad12(0x308));break;default:_0x2d688a=new Date(_0x3a3f02[_0x39ad12(0x1c8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x2d688a[_0x39ad12(0x1bc)](0x0,0x0,0x0,0x0);let _0xd3a9b5;if(_0x361d16['toLowerCase']()===_0x39ad12(0x2f0)){const _0x2dff5c=new Date(_0x3a3f02);_0x2dff5c['setDate'](_0x2dff5c[_0x39ad12(0x1cd)]()-0x1),_0xd3a9b5=new Date(_0x2dff5c[_0x39ad12(0x30d)](),_0x2dff5c[_0x39ad12(0x28d)](),_0x2dff5c[_0x39ad12(0x1cd)](),0x17,0x3b,0x3b,0x3e7);}const _0x507137={'gte':_0x2d688a};_0xd3a9b5&&(_0x507137['lte']=_0xd3a9b5);const [_0x4aa3d6,_0x3ddb1a,_0x22543b,_0x5d7fbd,_0x2a7f5c,_0x7adbd2]=await Promise[_0x39ad12(0x2f8)]([database_1[_0x39ad12(0x29f)][_0x39ad12(0x21a)]['count'](),database_1['default'][_0x39ad12(0x21a)][_0x39ad12(0x2e1)]({'where':{'status':_0x39ad12(0x1ca)}}),database_1[_0x39ad12(0x29f)][_0x39ad12(0x2b4)][_0x39ad12(0x2e1)]({'where':{'status':'PAID','createdAt':_0x507137,'gateway':{'not':_0x39ad12(0x1f1)}}}),database_1[_0x39ad12(0x29f)][_0x39ad12(0x2b4)]['findMany']({'where':{'status':_0x39ad12(0x1f2),'createdAt':_0x507137,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x39ad12(0x29f)][_0x39ad12(0x2b4)]['findMany']({'where':{'gateway':{'not':_0x39ad12(0x1f1)}},'take':0xa,'orderBy':{'createdAt':_0x39ad12(0x1ce)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x39ad12(0x29f)][_0x39ad12(0x2b4)][_0x39ad12(0x23f)]({'where':{'createdAt':_0x507137,'gateway':{'not':_0x39ad12(0x1f1)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4e1837=0x0,_0x19ff95=0x0;for(const _0x573281 of _0x5d7fbd){const _0x24e66a=await currencyService_1[_0x39ad12(0x272)]['convertToUSDT'](_0x573281[_0x39ad12(0x2c1)],_0x573281[_0x39ad12(0x2e9)]);_0x4e1837+=_0x24e66a;if(_0x573281[_0x39ad12(0x290)]){const _0x580961=await currencyService_1[_0x39ad12(0x272)][_0x39ad12(0x208)](_0x573281[_0x39ad12(0x2c1)],_0x573281[_0x39ad12(0x2e9)]),_0x5c7b3c=_0x573281[_0x39ad12(0x290)],_0x3fa9e0=_0x580961-_0x5c7b3c;_0x19ff95+=_0x3fa9e0;}}const _0x27663b=_0x22543b>0x0?_0x4e1837/_0x22543b:0x0,_0x4ee934=this[_0x39ad12(0x28e)](_0x7adbd2,_0x2d688a,_0xd3a9b5||_0x3a3f02),_0x5ccb7d=await database_1[_0x39ad12(0x29f)]['payment'][_0x39ad12(0x2e1)]({'where':{'createdAt':_0x507137,'gateway':{'not':'test_gateway'}}}),_0x3833a5=_0x5ccb7d>0x0?_0x22543b/_0x5ccb7d*0x64:0x0;return{'totalShops':_0x4aa3d6,'activeShops':_0x3ddb1a,'totalPayments':_0x22543b,'successfulPayments':_0x22543b,'totalAttempts':_0x5ccb7d,'totalRevenue':Math[_0x39ad12(0x20f)](_0x4e1837*0x64)/0x64,'trapayEarnings':Math[_0x39ad12(0x20f)](_0x19ff95*0x64)/0x64,'averagePaymentAmount':Math[_0x39ad12(0x20f)](_0x27663b*0x64)/0x64,'conversionRate':Math[_0x39ad12(0x20f)](_0x3833a5*0x64)/0x64,'dailyRevenue':_0x4ee934['dailyRevenue'],'dailyPayments':_0x4ee934['dailyPayments'],'recentPayments':_0x2a7f5c['map'](_0x4004c3=>({'id':_0x4004c3['id'],'amount':_0x4004c3[_0x39ad12(0x2c1)],'currency':_0x4004c3[_0x39ad12(0x2e9)],'status':_0x4004c3[_0x39ad12(0x306)],'gateway':_0x4004c3[_0x39ad12(0x229)],'shop':_0x4004c3[_0x39ad12(0x21a)],'createdAt':_0x4004c3[_0x39ad12(0x200)]}))};}async[a40_0x383efb(0x1e0)](_0x29f6bd){const _0x24674f=a40_0x383efb;console[_0x24674f(0x2ca)]('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x29f6bd);let _0x429cd9,_0x1c48d0=new Date();if(_0x29f6bd[_0x24674f(0x2a4)]===_0x24674f(0x296)&&_0x29f6bd[_0x24674f(0x209)]&&_0x29f6bd[_0x24674f(0x20d)])_0x429cd9=new Date(_0x29f6bd[_0x24674f(0x209)]),_0x1c48d0=new Date(_0x29f6bd[_0x24674f(0x20d)]),_0x429cd9[_0x24674f(0x1bc)](0x0,0x0,0x0,0x0),_0x1c48d0[_0x24674f(0x1bc)](0x17,0x3b,0x3b,0x3e7);else{const _0x4c9d1d=new Date();switch(_0x29f6bd[_0x24674f(0x2a4)]){case _0x24674f(0x2ce):_0x429cd9=new Date(_0x4c9d1d['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x429cd9=new Date(_0x4c9d1d[_0x24674f(0x1c8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x24674f(0x287):_0x429cd9=new Date(_0x4c9d1d['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x24674f(0x2f8):default:_0x429cd9=new Date(_0x24674f(0x308));break;}_0x429cd9[_0x24674f(0x1bc)](0x0,0x0,0x0,0x0),_0x1c48d0['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x24674f(0x2ca)](_0x24674f(0x239)+_0x429cd9['toISOString']()+_0x24674f(0x26e)+_0x1c48d0['toISOString']());const _0x55809f={'status':_0x24674f(0x1f2),'gateway':{'not':_0x24674f(0x1f1)},'paidAt':{'gte':_0x429cd9,'lte':_0x1c48d0}};_0x29f6bd[_0x24674f(0x2c8)]&&(_0x55809f[_0x24674f(0x2c8)]=_0x29f6bd['shopId']);const _0x48312a=await database_1['default'][_0x24674f(0x2b4)][_0x24674f(0x23f)]({'where':_0x55809f,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x24674f(0x2ca)](_0x24674f(0x223)+_0x48312a[_0x24674f(0x281)]+_0x24674f(0x1c5));const _0x4c5ba6={'gateway':{'not':_0x24674f(0x1f1)},'createdAt':{'gte':_0x429cd9,'lte':_0x1c48d0}};_0x29f6bd[_0x24674f(0x2c8)]&&(_0x4c5ba6[_0x24674f(0x2c8)]=_0x29f6bd['shopId']);const _0x54c0d6=await database_1[_0x24674f(0x29f)][_0x24674f(0x2b4)][_0x24674f(0x2e1)]({'where':_0x4c5ba6});console[_0x24674f(0x2ca)](_0x24674f(0x313)+_0x54c0d6+',\x20successful:\x20'+_0x48312a[_0x24674f(0x281)]);let _0xfeadda=0x0,_0x5cd50c=0x0,_0x3d3578=0x0;const _0x2dc03f={},_0x1fb739={},_0x2206ec={};for(const _0x4a514e of _0x48312a){try{const _0x4ef89b=_0x4a514e[_0x24674f(0x282)]||0x0;if(_0x4ef89b<=0x0){console[_0x24674f(0x219)](_0x24674f(0x1d2)+_0x4a514e['id']+_0x24674f(0x1e6));continue;}let _0x12e6c9,_0x41f9c0;if(_0x4a514e[_0x24674f(0x290)]!==null&&_0x4a514e[_0x24674f(0x290)]!==undefined)_0x12e6c9=_0x4a514e[_0x24674f(0x290)],_0x41f9c0=_0x4ef89b-_0x12e6c9,console[_0x24674f(0x2ca)](_0x24674f(0x2e0)+_0x4a514e['id']+':\x20'+_0x4ef89b[_0x24674f(0x1b8)](0x6)+_0x24674f(0x27d)+_0x12e6c9[_0x24674f(0x1b8)](0x6)+_0x24674f(0x1cb));else{let _0x549daf={};if(_0x4a514e[_0x24674f(0x21a)][_0x24674f(0x1d6)])try{_0x549daf=JSON[_0x24674f(0x265)](_0x4a514e['shop'][_0x24674f(0x1d6)]);}catch(_0x56347e){console[_0x24674f(0x2c5)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x4a514e['shopId']+':',_0x56347e);}let _0x6d12f8=0x2d;for(const [_0x524315,_0x355feb]of Object['entries'](_0x549daf)){if(_0x524315[_0x24674f(0x1f9)]()===_0x4a514e['gateway'][_0x24674f(0x1f9)]()){_0x6d12f8=_0x355feb[_0x24674f(0x2ee)]||0x2d;break;}}_0x41f9c0=_0x4ef89b*(_0x6d12f8/0x64),_0x12e6c9=_0x4ef89b-_0x41f9c0,console['log'](_0x24674f(0x2cc)+_0x4a514e['id']+':\x20'+_0x6d12f8+_0x24674f(0x25f)+_0x4ef89b[_0x24674f(0x1b8)](0x6)+_0x24674f(0x1cb));}_0xfeadda+=_0x4ef89b,_0x5cd50c+=_0x12e6c9,_0x3d3578+=_0x41f9c0;let _0x2c1846;_0x4a514e[_0x24674f(0x1c4)]!==null&&_0x4a514e['gatewayCommissionRate']!==undefined?(_0x2c1846=_0x4a514e[_0x24674f(0x1c4)],console[_0x24674f(0x2ca)](_0x24674f(0x212)+_0x4a514e['id']+':\x20'+_0x2c1846+'%')):(_0x2c1846=_0x4ef89b>0x0?_0x41f9c0/_0x4ef89b*0x64:0x0,console[_0x24674f(0x2ca)](_0x24674f(0x275)+_0x4a514e['id']+':\x20'+_0x2c1846[_0x24674f(0x1b8)](0x2)+'%'));!_0x2dc03f[_0x4a514e['gateway']]&&(_0x2dc03f[_0x4a514e['gateway']]={'gateway':_0x4a514e[_0x24674f(0x229)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x4a514e['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2dc03f[_0x4a514e['gateway']][_0x24674f(0x23e)]++,_0x2dc03f[_0x4a514e[_0x24674f(0x229)]][_0x24674f(0x2d2)]+=_0x4ef89b,_0x2dc03f[_0x4a514e['gateway']][_0x24674f(0x2c2)]+=_0x41f9c0,_0x2dc03f[_0x4a514e['gateway']][_0x24674f(0x1bd)]+=_0x12e6c9,_0x2dc03f[_0x4a514e[_0x24674f(0x229)]]['totalCommissionRate']+=_0x2c1846;!_0x29f6bd[_0x24674f(0x2c8)]&&(!_0x1fb739[_0x4a514e[_0x24674f(0x2c8)]]&&(_0x1fb739[_0x4a514e[_0x24674f(0x2c8)]]={'shopId':_0x4a514e['shopId'],'shopName':_0x4a514e[_0x24674f(0x21a)][_0x24674f(0x2c7)],'shopUsername':_0x4a514e['shop'][_0x24674f(0x1d9)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1fb739[_0x4a514e[_0x24674f(0x2c8)]]['paymentsCount']++,_0x1fb739[_0x4a514e[_0x24674f(0x2c8)]][_0x24674f(0x2d2)]+=_0x4ef89b,_0x1fb739[_0x4a514e['shopId']][_0x24674f(0x2c2)]+=_0x41f9c0,_0x1fb739[_0x4a514e[_0x24674f(0x2c8)]][_0x24674f(0x1bd)]+=_0x12e6c9);const _0x5b0f41=_0x4a514e[_0x24674f(0x1d5)][_0x24674f(0x2d1)]()[_0x24674f(0x257)]('T')[0x0];!_0x2206ec[_0x5b0f41]&&(_0x2206ec[_0x5b0f41]={'date':_0x5b0f41,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2206ec[_0x5b0f41][_0x24674f(0x2eb)]+=_0x4ef89b,_0x2206ec[_0x5b0f41][_0x24674f(0x2c9)]+=_0x12e6c9,_0x2206ec[_0x5b0f41]['gatewayEarnings']+=_0x41f9c0,_0x2206ec[_0x5b0f41][_0x24674f(0x23e)]++;}catch(_0x39e30e){console[_0x24674f(0x2c5)](_0x24674f(0x2ad)+_0x4a514e['id']+':',_0x39e30e);}}Object[_0x24674f(0x224)](_0x2dc03f)[_0x24674f(0x1fe)](_0x1e76de=>{const _0x24b513=_0x24674f;_0x1e76de['averageCommissionRate']=_0x1e76de[_0x24b513(0x23e)]>0x0?_0x1e76de[_0x24b513(0x26f)]/_0x1e76de[_0x24b513(0x23e)]:0x0,delete _0x1e76de['totalCommissionRate'];}),Object[_0x24674f(0x224)](_0x1fb739)[_0x24674f(0x1fe)](_0x5af820=>{const _0x1bc4d2=_0x24674f;_0x5af820['averageCheckUSDT']=_0x5af820[_0x1bc4d2(0x23e)]>0x0?_0x5af820[_0x1bc4d2(0x2d2)]/_0x5af820['paymentsCount']:0x0;});let _0x21878d=0x0,_0x195f5e=0x0;if(_0x29f6bd[_0x24674f(0x2c8)]){const _0x4ab064=await database_1[_0x24674f(0x29f)][_0x24674f(0x2be)][_0x24674f(0x23f)]({'where':{'shopId':_0x29f6bd['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x429cd9,'lte':_0x1c48d0}},'select':{'amount':!![]}});_0x21878d=_0x4ab064[_0x24674f(0x252)]((_0x3d8c3c,_0x1bcf6e)=>_0x3d8c3c+_0x1bcf6e[_0x24674f(0x2c1)],0x0);const _0x582507=await database_1[_0x24674f(0x29f)][_0x24674f(0x2be)][_0x24674f(0x23f)]({'where':{'shopId':_0x29f6bd[_0x24674f(0x2c8)],'status':'PENDING','createdAt':{'gte':_0x429cd9,'lte':_0x1c48d0}},'select':{'amount':!![]}});_0x195f5e=_0x582507[_0x24674f(0x252)]((_0x3aa4d3,_0x2c636f)=>_0x3aa4d3+_0x2c636f[_0x24674f(0x2c1)],0x0);}const _0x33962d=_0x54c0d6,_0x78ba71=_0x48312a[_0x24674f(0x281)],_0x16235c=_0x78ba71>0x0?_0xfeadda/_0x78ba71:0x0,_0x93db27=_0x33962d>0x0?Math[_0x24674f(0x20f)](_0x78ba71/_0x33962d*0x2710)/0x64:0x0,_0x58b2d1=Math[_0x24674f(0x1da)]((_0x1c48d0[_0x24674f(0x1c8)]()-_0x429cd9[_0x24674f(0x1c8)]())/(0x3e8*0x3c*0x3c*0x18)),_0x43bab5={'totalTurnover':Math[_0x24674f(0x20f)](_0xfeadda*0x64)/0x64,'merchantEarnings':Math[_0x24674f(0x20f)](_0x5cd50c*0x64)/0x64,'gatewayEarnings':Math[_0x24674f(0x20f)](_0x3d3578*0x64)/0x64,'totalPaidOut':Math[_0x24674f(0x20f)](_0x21878d*0x64)/0x64,'pendingPayout':Math['round'](_0x195f5e*0x64)/0x64,'averageCheck':Math[_0x24674f(0x20f)](_0x16235c*0x64)/0x64,'totalPayments':_0x33962d,'successfulPayments':_0x78ba71,'conversionRate':_0x93db27,'gatewayBreakdown':Object[_0x24674f(0x224)](_0x2dc03f)['map'](_0x17a5a0=>({..._0x17a5a0,'turnoverUSDT':Math[_0x24674f(0x20f)](_0x17a5a0['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x24674f(0x20f)](_0x17a5a0['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x17a5a0['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x24674f(0x20f)](_0x17a5a0[_0x24674f(0x241)]*0x64)/0x64})),'merchantBreakdown':_0x29f6bd[_0x24674f(0x2c8)]?undefined:Object[_0x24674f(0x224)](_0x1fb739)[_0x24674f(0x311)](_0x1cc588=>({..._0x1cc588,'turnoverUSDT':Math['round'](_0x1cc588[_0x24674f(0x2d2)]*0x64)/0x64,'commissionUSDT':Math[_0x24674f(0x20f)](_0x1cc588['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x1cc588[_0x24674f(0x1bd)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x1cc588[_0x24674f(0x30c)]*0x64)/0x64,'averageCheckUSDT':Math[_0x24674f(0x20f)](_0x1cc588[_0x24674f(0x2d8)]*0x64)/0x64})),'dailyData':Object[_0x24674f(0x224)](_0x2206ec)[_0x24674f(0x311)](_0x2f3780=>({..._0x2f3780,'turnover':Math[_0x24674f(0x20f)](_0x2f3780['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x24674f(0x20f)](_0x2f3780[_0x24674f(0x2c9)]*0x64)/0x64,'gatewayEarnings':Math[_0x24674f(0x20f)](_0x2f3780[_0x24674f(0x1cf)]*0x64)/0x64}))['sort']((_0x5df473,_0x5d67f5)=>_0x5df473[_0x24674f(0x227)][_0x24674f(0x1dc)](_0x5d67f5[_0x24674f(0x227)])),'periodInfo':{'from':_0x429cd9,'to':_0x1c48d0,'periodType':_0x29f6bd['period']||'custom','daysCount':_0x58b2d1}};return console['log'](_0x24674f(0x284)),console[_0x24674f(0x2ca)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x43bab5[_0x24674f(0x2a1)]+_0x24674f(0x1cb)),console[_0x24674f(0x2ca)](_0x24674f(0x285)+_0x43bab5[_0x24674f(0x2c9)]+'\x20USDT'),console[_0x24674f(0x2ca)](_0x24674f(0x245)+_0x43bab5[_0x24674f(0x1cf)]+_0x24674f(0x1cb)),console[_0x24674f(0x2ca)](_0x24674f(0x1e4)+_0x43bab5[_0x24674f(0x1c9)]+_0x24674f(0x1cb)),console['log']('\x20\x20\x20‚è≥\x20Pending\x20payout:\x20'+_0x43bab5['pendingPayout']+_0x24674f(0x1cb)),console[_0x24674f(0x2ca)](_0x24674f(0x2bb)+_0x43bab5['totalPayments']),_0x43bab5;}async[a40_0x383efb(0x22b)](){const _0x2358e6=a40_0x383efb;console[_0x2358e6(0x2ca)](_0x2358e6(0x221));const _0x41b463=await database_1[_0x2358e6(0x29f)][_0x2358e6(0x21a)][_0x2358e6(0x23f)]({'where':{'status':_0x2358e6(0x1ca)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x2358e6(0x2ca)](_0x2358e6(0x2f1)+_0x41b463[_0x2358e6(0x281)]+_0x2358e6(0x1f0)),_0x41b463['map'](_0xe5fa63=>({'id':_0xe5fa63['id'],'username':_0xe5fa63[_0x2358e6(0x1d9)],'name':_0xe5fa63[_0x2358e6(0x2c7)]}));}[a40_0x383efb(0x2a0)](_0x53b0c9){const _0x4fd3ee=a40_0x383efb,_0x4af337={'test_gateway':_0x4fd3ee(0x1fa),'plisio':_0x4fd3ee(0x2cf),'rapyd':_0x4fd3ee(0x2a9),'noda':_0x4fd3ee(0x2a8),'cointopay':_0x4fd3ee(0x1ff),'cointopay2':_0x4fd3ee(0x256),'klyme_eu':_0x4fd3ee(0x213),'klyme_gb':_0x4fd3ee(0x22c),'klyme_de':_0x4fd3ee(0x1e3),'mastercard':_0x4fd3ee(0x20b)};return _0x4af337[_0x53b0c9]||_0x53b0c9;}['getGatewayInternalName'](_0x195174){const _0x15d5fa=a40_0x383efb,_0xedccd0={'Test\x20Gateway':_0x15d5fa(0x1f1),'Plisio':_0x15d5fa(0x2bd),'Rapyd':_0x15d5fa(0x28a),'Noda':_0x15d5fa(0x1f6),'CoinToPay':'cointopay','CoinToPay2':_0x15d5fa(0x2cd),'KLYME\x20EU':_0x15d5fa(0x1f7),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x15d5fa(0x2d4),'MasterCard':_0x15d5fa(0x2d3)};return _0xedccd0[_0x195174]||_0x195174[_0x15d5fa(0x1f9)]();}async['getMerchantsAwaitingPayout'](_0x306d71){const _0xcb466a=a40_0x383efb,{page:_0x596410,limit:_0x46cefa,minAmount:_0x421e11,search:_0x46c22b}=_0x306d71,_0x1495f4=(_0x596410-0x1)*_0x46cefa;console['log'](_0xcb466a(0x220),_0x306d71);const _0x21cb7c={'balance':{'gt':0x0},'status':_0xcb466a(0x1ca)};_0x421e11&&(_0x21cb7c[_0xcb466a(0x2e3)][_0xcb466a(0x316)]=_0x421e11);_0x46c22b&&(_0x21cb7c[_0xcb466a(0x2c7)]={'contains':_0x46c22b,'mode':'insensitive'});const [_0x52c575,_0x348065]=await Promise[_0xcb466a(0x2f8)]([database_1[_0xcb466a(0x29f)][_0xcb466a(0x21a)][_0xcb466a(0x23f)]({'where':_0x21cb7c,'skip':_0x1495f4,'take':_0x46cefa,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0xcb466a(0x29f)][_0xcb466a(0x21a)][_0xcb466a(0x2e1)]({'where':_0x21cb7c})]);console[_0xcb466a(0x2ca)](_0xcb466a(0x223)+_0x52c575['length']+_0xcb466a(0x2d6));const _0x41d915=await Promise['all'](_0x52c575[_0xcb466a(0x311)](async _0x2fcc91=>{const _0x52af4d=_0xcb466a,[_0xde953c,_0x1d3080,_0x2cbcca]=await Promise[_0x52af4d(0x2f8)]([database_1[_0x52af4d(0x29f)]['payment']['count']({'where':{'shopId':_0x2fcc91['id'],'status':_0x52af4d(0x1f2),'gateway':{'not':_0x52af4d(0x1f1)}}}),database_1['default']['payment'][_0x52af4d(0x21c)]({'where':{'shopId':_0x2fcc91['id'],'status':_0x52af4d(0x1f2),'gateway':{'not':_0x52af4d(0x1f1)}},'orderBy':{'paidAt':_0x52af4d(0x260)},'select':{'paidAt':!![]}}),database_1[_0x52af4d(0x29f)][_0x52af4d(0x2b4)][_0x52af4d(0x2b9)]({'by':['gateway'],'where':{'shopId':_0x2fcc91['id'],'status':_0x52af4d(0x1f2),'gateway':{'not':_0x52af4d(0x1f1)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2d0d27=new Date(),_0x17ceaf=new Date(_0x2d0d27['getFullYear'](),_0x2d0d27[_0x52af4d(0x28d)](),0x1),_0x10127a=new Date(_0x2d0d27[_0x52af4d(0x30d)](),_0x2d0d27[_0x52af4d(0x28d)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5edf79,_0x50dde4]=await Promise[_0x52af4d(0x2f8)]([database_1[_0x52af4d(0x29f)]['payout'][_0x52af4d(0x26d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2fcc91['id'],'status':'COMPLETED'}}),database_1[_0x52af4d(0x29f)][_0x52af4d(0x2be)][_0x52af4d(0x26d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2fcc91['id'],'status':_0x52af4d(0x28c),'createdAt':{'gte':_0x17ceaf,'lte':_0x10127a}}})]),_0x1a91db=_0x5edf79[_0x52af4d(0x249)][_0x52af4d(0x2c1)]||0x0,_0x2140aa=_0x50dde4[_0x52af4d(0x249)][_0x52af4d(0x2c1)]||0x0,_0xc41817=await Promise[_0x52af4d(0x2f8)](_0x2cbcca[_0x52af4d(0x311)](async _0x52c280=>{const _0x5513fb=_0x52af4d;let _0x885741=0x2d;if(_0x2fcc91[_0x5513fb(0x1d6)])try{const _0x59db01=JSON[_0x5513fb(0x265)](_0x2fcc91[_0x5513fb(0x1d6)]);for(const [_0x46bb17,_0x3fafd2]of Object['entries'](_0x59db01)){if(_0x46bb17[_0x5513fb(0x1f9)]()===_0x52c280[_0x5513fb(0x229)]['toLowerCase']()){_0x885741=_0x3fafd2[_0x5513fb(0x2ee)]||0xa,console[_0x5513fb(0x2ca)](_0x5513fb(0x1e5)+_0x52c280['gateway']+'\x20for\x20shop\x20'+_0x2fcc91['id']+_0x5513fb(0x315)+_0x885741+'%');break;}}}catch(_0x256a29){console['error'](_0x5513fb(0x1c1)+_0x2fcc91['id']+':',_0x256a29);}const _0x599d84=_0x52c280[_0x5513fb(0x249)]?.[_0x5513fb(0x282)]||0x0,_0x5a1ff2=_0x599d84*(0x1-_0x885741/0x64);return{'gateway':_0x52c280['gateway'],'count':_0x52c280['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x599d84*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5513fb(0x20f)](_0x5a1ff2*0x64)/0x64,'commission':_0x885741};})),_0x13afd6=_0xc41817[_0x52af4d(0x252)]((_0x51acf4,_0x2f5915)=>_0x51acf4+_0x2f5915['amountUSDT'],0x0),_0x41cd32=_0xc41817['reduce']((_0x42efaa,_0x3d4398)=>_0x42efaa+_0x3d4398[_0x52af4d(0x273)],0x0),_0x27cad6=_0x2fcc91['balance'];return console[_0x52af4d(0x2ca)](_0x52af4d(0x2ec)+_0x2fcc91[_0x52af4d(0x1d9)]+':'),console[_0x52af4d(0x2ca)]('\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20'+_0x13afd6['toFixed'](0x2)+_0x52af4d(0x24d)),console[_0x52af4d(0x2ca)](_0x52af4d(0x22f)+_0x41cd32['toFixed'](0x2)+_0x52af4d(0x1bf)),console[_0x52af4d(0x2ca)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x27cad6['toFixed'](0x2)+_0x52af4d(0x27c)),console[_0x52af4d(0x2ca)](_0x52af4d(0x2ab)+_0x1a91db['toFixed'](0x2)+_0x52af4d(0x247)),console[_0x52af4d(0x2ca)](_0x52af4d(0x266)+(_0x41cd32-_0x1a91db-_0x27cad6)[_0x52af4d(0x1b8)](0x2)+_0x52af4d(0x270)),{'id':_0x2fcc91['id'],'fullName':_0x2fcc91[_0x52af4d(0x2c7)],'username':_0x2fcc91[_0x52af4d(0x1d9)],'telegramId':_0x2fcc91[_0x52af4d(0x2c6)],'merchantUrl':_0x2fcc91[_0x52af4d(0x2fb)],'wallets':{'usdtPolygonWallet':_0x2fcc91[_0x52af4d(0x232)],'usdtTrcWallet':_0x2fcc91[_0x52af4d(0x234)],'usdtErcWallet':_0x2fcc91[_0x52af4d(0x27e)],'usdcPolygonWallet':_0x2fcc91['usdcPolygonWallet'],'usdcErcWallet':_0x2fcc91[_0x52af4d(0x222)]},'totalAmountUSDT':Math[_0x52af4d(0x20f)](_0x13afd6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x41cd32*0x64)/0x64,'currentBalance':Math['round'](_0x27cad6*0x64)/0x64,'totalPayout':Math[_0x52af4d(0x20f)](_0x1a91db*0x64)/0x64,'thisMonth':Math[_0x52af4d(0x20f)](_0x2140aa*0x64)/0x64,'paymentsCount':_0xde953c,'oldestPaymentDate':_0x1d3080?.['paidAt']||_0x2fcc91[_0x52af4d(0x200)],'gatewayBreakdown':_0xc41817};})),_0x3caae8=_0x41d915[_0xcb466a(0x252)]((_0x95bd1b,_0x3451d7)=>_0x95bd1b+_0x3451d7['totalAmountUSDT'],0x0),_0x5e9bad=_0x41d915['reduce']((_0x3274ca,_0x2c7cae)=>_0x3274ca+_0x2c7cae[_0xcb466a(0x262)],0x0),_0x10af27=_0x41d915[_0xcb466a(0x252)]((_0x4986a0,_0xafd12c)=>_0x4986a0+_0xafd12c['totalPayout'],0x0),_0x37bf7c=_0x41d915[_0xcb466a(0x252)]((_0x124dfb,_0x5d22ac)=>_0x124dfb+_0x5d22ac[_0xcb466a(0x204)],0x0);return console[_0xcb466a(0x2ca)](_0xcb466a(0x1ef)+_0x348065+_0xcb466a(0x2df)),console['log'](_0xcb466a(0x2a3)+Math[_0xcb466a(0x20f)](_0x3caae8*0x64)/0x64+_0xcb466a(0x24d)),console[_0xcb466a(0x2ca)](_0xcb466a(0x2e6)+Math[_0xcb466a(0x20f)](_0x5e9bad*0x64)/0x64+_0xcb466a(0x243)),console[_0xcb466a(0x2ca)](_0xcb466a(0x2b0)+Math['round'](_0x10af27*0x64)/0x64+_0xcb466a(0x1cb)),console[_0xcb466a(0x2ca)]('\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20'+Math['round'](_0x37bf7c*0x64)/0x64+'\x20USDT'),{'merchants':_0x41d915,'pagination':{'page':_0x596410,'limit':_0x46cefa,'total':_0x348065,'totalPages':Math[_0xcb466a(0x1da)](_0x348065/_0x46cefa)},'summary':{'totalMerchants':_0x348065,'totalAmountUSDT':Math[_0xcb466a(0x20f)](_0x3caae8*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xcb466a(0x20f)](_0x5e9bad*0x64)/0x64,'totalPayout':Math[_0xcb466a(0x20f)](_0x10af27*0x64)/0x64,'thisMonth':Math['round'](_0x37bf7c*0x64)/0x64}};}async[a40_0x383efb(0x1fb)](_0x5067ac){const _0x4d37fd=a40_0x383efb,{shopId:_0x51691e,amount:_0x3c716f,network:_0x12bb81,wallet:_0x1e786f,notes:_0x4fffcb,txid:_0x53837b,periodFrom:_0x510fae,periodTo:_0x539e33}=_0x5067ac,_0x29717a=await database_1[_0x4d37fd(0x29f)][_0x4d37fd(0x231)](async _0x595f2c=>{const _0x25125f=_0x4d37fd,_0x2c344b=await _0x595f2c[_0x25125f(0x21a)]['findUnique']({'where':{'id':_0x51691e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2c344b)throw new Error(_0x25125f(0x1df));console['log']('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0x2c344b['username']+':'),console['log']('\x20\x20\x20Current\x20balance:\x20'+_0x2c344b[_0x25125f(0x2e3)][_0x25125f(0x1b8)](0x6)+_0x25125f(0x1cb)),console[_0x25125f(0x2ca)](_0x25125f(0x2ac)+_0x3c716f[_0x25125f(0x1b8)](0x6)+_0x25125f(0x1cb)),console['log'](_0x25125f(0x2ef)+_0x2c344b['totalPaidOut'][_0x25125f(0x1b8)](0x6)+_0x25125f(0x1cb));if(_0x53837b)console[_0x25125f(0x2ca)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x53837b);const _0x486f77=0.000001,_0xe8af54=Number(_0x2c344b[_0x25125f(0x2e3)]),_0x58d418=Number(_0x3c716f);console[_0x25125f(0x2ca)](_0x25125f(0x2bc)),console[_0x25125f(0x2ca)]('\x20\x20\x20Available\x20(raw):\x20'+_0x2c344b[_0x25125f(0x2e3)]),console['log']('\x20\x20\x20Available\x20(number):\x20'+_0xe8af54),console[_0x25125f(0x2ca)](_0x25125f(0x246)+_0x58d418),console[_0x25125f(0x2ca)](_0x25125f(0x25e)+(_0xe8af54-_0x58d418)),console[_0x25125f(0x2ca)](_0x25125f(0x2f3)+_0x486f77);if(_0xe8af54<_0x58d418-_0x486f77)throw new Error(_0x25125f(0x1f8)+_0xe8af54[_0x25125f(0x1b8)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x58d418[_0x25125f(0x1b8)](0x6)+_0x25125f(0x303)+(_0xe8af54-_0x58d418)[_0x25125f(0x1b8)](0x8)+_0x25125f(0x1cb));console[_0x25125f(0x2ca)](_0x25125f(0x2f6));const _0x2d12b2=Math[_0x25125f(0x291)](_0xe8af54,_0x58d418);let _0x2ea6ff=_0x1e786f;if(!_0x2ea6ff){const _0x5a7ed3=await _0x595f2c[_0x25125f(0x21a)]['findUnique']({'where':{'id':_0x51691e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x5a7ed3)switch(_0x12bb81){case _0x25125f(0x226):_0x2ea6ff=_0x5a7ed3[_0x25125f(0x232)]||undefined;break;case _0x25125f(0x283):_0x2ea6ff=_0x5a7ed3[_0x25125f(0x234)]||undefined;break;case _0x25125f(0x2d9):_0x2ea6ff=_0x5a7ed3[_0x25125f(0x27e)]||undefined;break;case'polygon_usdc':_0x2ea6ff=_0x5a7ed3['usdcPolygonWallet']||undefined;break;case _0x25125f(0x244):_0x2ea6ff=_0x5a7ed3[_0x25125f(0x222)]||undefined;break;}}console['log'](_0x25125f(0x206)+_0x12bb81+':\x20'+(_0x2ea6ff||_0x25125f(0x210)));const _0x4535a9=await _0x595f2c[_0x25125f(0x2be)][_0x25125f(0x2e8)]({'data':{'shopId':_0x51691e,'amount':_0x2d12b2,'network':_0x12bb81,'status':'COMPLETED','txid':_0x53837b,'notes':_0x4fffcb,'periodFrom':_0x510fae?new Date(_0x510fae):null,'periodTo':_0x539e33?new Date(_0x539e33):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x13c408=_0xe8af54-_0x2d12b2,_0x48428c=Number(_0x2c344b['totalPaidOut'])+_0x2d12b2;return await _0x595f2c[_0x25125f(0x21a)]['update']({'where':{'id':_0x51691e},'data':{'balance':_0x13c408,'totalPaidOut':_0x48428c}}),console[_0x25125f(0x2ca)](_0x25125f(0x295)+_0x2c344b[_0x25125f(0x1d9)]+_0x25125f(0x211)),console['log'](_0x25125f(0x1ba)+_0xe8af54[_0x25125f(0x1b8)](0x6)+_0x25125f(0x254)+_0x13c408[_0x25125f(0x1b8)](0x6)+_0x25125f(0x23c)+_0x2d12b2[_0x25125f(0x1b8)](0x6)+')'),console['log'](_0x25125f(0x305)+_0x2c344b[_0x25125f(0x1c9)][_0x25125f(0x1b8)](0x6)+'\x20->\x20'+_0x48428c[_0x25125f(0x1b8)](0x6)+_0x25125f(0x203)+_0x2d12b2['toFixed'](0x6)+')'),console[_0x25125f(0x2ca)](_0x25125f(0x30e)+_0x2d12b2[_0x25125f(0x1b8)](0x6)+_0x25125f(0x1cb)),{'payout':_0x4535a9,'shop':_0x2c344b};});return console[_0x4d37fd(0x2ca)](_0x4d37fd(0x2b6)+_0x29717a[_0x4d37fd(0x2be)]['id']+'\x20for\x20shop\x20'+_0x29717a[_0x4d37fd(0x21a)][_0x4d37fd(0x1d9)]+'\x20('+_0x29717a[_0x4d37fd(0x2be)]['amount']['toFixed'](0x6)+_0x4d37fd(0x236)),{'id':_0x29717a['payout']['id'],'shopId':_0x29717a['payout'][_0x4d37fd(0x2c8)],'shopName':_0x29717a[_0x4d37fd(0x21a)][_0x4d37fd(0x2c7)],'shopUsername':_0x29717a[_0x4d37fd(0x21a)][_0x4d37fd(0x1d9)],'amount':_0x29717a[_0x4d37fd(0x2be)][_0x4d37fd(0x2c1)],'network':_0x29717a['payout']['network'],'status':_0x29717a[_0x4d37fd(0x2be)][_0x4d37fd(0x306)],'txid':_0x29717a['payout'][_0x4d37fd(0x1e8)],'notes':_0x29717a[_0x4d37fd(0x2be)]['notes'],'periodFrom':_0x29717a[_0x4d37fd(0x2be)][_0x4d37fd(0x2ed)],'periodTo':_0x29717a[_0x4d37fd(0x2be)][_0x4d37fd(0x1e9)],'createdAt':_0x29717a[_0x4d37fd(0x2be)]['createdAt'],'paidAt':_0x29717a['payout'][_0x4d37fd(0x1d5)]};}async[a40_0x383efb(0x267)](_0x24c01f){const _0x54f793=a40_0x383efb,{page:_0xbd47c4,limit:_0x29540c,shopId:_0x48c701,network:_0x24f998,dateFrom:_0x287a0e,dateTo:_0x50c4c8,search:_0x3aca80}=_0x24c01f,_0x681619=(_0xbd47c4-0x1)*_0x29540c,_0x5d28c4={};_0x48c701&&(_0x5d28c4[_0x54f793(0x2c8)]=_0x48c701);_0x24f998&&(_0x5d28c4[_0x54f793(0x25b)]=_0x24f998);(_0x287a0e||_0x50c4c8)&&(_0x5d28c4[_0x54f793(0x200)]={},_0x287a0e&&(_0x5d28c4[_0x54f793(0x200)][_0x54f793(0x316)]=new Date(_0x287a0e)),_0x50c4c8&&(_0x5d28c4[_0x54f793(0x200)]['lte']=new Date(_0x50c4c8)));_0x3aca80&&(_0x5d28c4['OR']=[{'shop':{'name':{'contains':_0x3aca80,'mode':_0x54f793(0x22a)}}},{'shop':{'username':{'contains':_0x3aca80,'mode':_0x54f793(0x22a)}}},{'notes':{'contains':_0x3aca80,'mode':_0x54f793(0x22a)}}]);const [_0x450b7a,_0x3a5b27]=await Promise['all']([database_1[_0x54f793(0x29f)]['payout'][_0x54f793(0x23f)]({'where':_0x5d28c4,'skip':_0x681619,'take':_0x29540c,'orderBy':{'createdAt':_0x54f793(0x1ce)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x54f793(0x29f)][_0x54f793(0x2be)][_0x54f793(0x2e1)]({'where':_0x5d28c4})]);return{'payouts':_0x450b7a['map'](_0x1771bc=>({'id':_0x1771bc['id'],'shopId':_0x1771bc[_0x54f793(0x2c8)],'shopName':_0x1771bc[_0x54f793(0x21a)]['name'],'shopUsername':_0x1771bc[_0x54f793(0x21a)][_0x54f793(0x1d9)],'amount':_0x1771bc[_0x54f793(0x2c1)],'network':_0x1771bc[_0x54f793(0x25b)],'status':_0x1771bc[_0x54f793(0x306)],'txid':_0x1771bc['txid'],'notes':_0x1771bc[_0x54f793(0x25c)],'periodFrom':_0x1771bc['periodFrom'],'periodTo':_0x1771bc['periodTo'],'createdAt':_0x1771bc[_0x54f793(0x200)],'paidAt':_0x1771bc[_0x54f793(0x1d5)]})),'pagination':{'page':_0xbd47c4,'limit':_0x29540c,'total':_0x3a5b27,'totalPages':Math[_0x54f793(0x1da)](_0x3a5b27/_0x29540c)}};}async['getPayoutById'](_0x5a3d40){const _0x16bdd8=a40_0x383efb,_0x418bc9=await database_1[_0x16bdd8(0x29f)][_0x16bdd8(0x2be)][_0x16bdd8(0x2d0)]({'where':{'id':_0x5a3d40},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x418bc9)return null;return{'id':_0x418bc9['id'],'shopId':_0x418bc9[_0x16bdd8(0x2c8)],'shopName':_0x418bc9['shop']['name'],'shopUsername':_0x418bc9['shop'][_0x16bdd8(0x1d9)],'amount':_0x418bc9['amount'],'network':_0x418bc9[_0x16bdd8(0x25b)],'status':_0x418bc9['status'],'txid':_0x418bc9[_0x16bdd8(0x1e8)],'notes':_0x418bc9[_0x16bdd8(0x25c)],'periodFrom':_0x418bc9[_0x16bdd8(0x2ed)],'periodTo':_0x418bc9['periodTo'],'createdAt':_0x418bc9['createdAt'],'paidAt':_0x418bc9[_0x16bdd8(0x1d5)]};}async[a40_0x383efb(0x205)](_0x3550a1){const _0x7e3564=a40_0x383efb;await database_1[_0x7e3564(0x29f)][_0x7e3564(0x2be)][_0x7e3564(0x2b2)]({'where':{'id':_0x3550a1}});}async[a40_0x383efb(0x1f3)](_0x366b11){const _0x1eee1d=a40_0x383efb,{page:_0x5ec143,limit:_0x52509d,status:_0x4b495d,gateway:_0x5e7b65,shopId:_0x562f25,dateFrom:_0x16f25a,dateTo:_0x39851e,search:_0x31f98d,currency:_0x2aca8e,sortBy:_0x2cb7e5,sortOrder:_0x2c1d5a}=_0x366b11,_0x330b35=(_0x5ec143-0x1)*_0x52509d;console['log'](_0x1eee1d(0x2b1),_0x366b11);const _0x2270f7=await database_1[_0x1eee1d(0x29f)]['payment'][_0x1eee1d(0x2b9)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x1eee1d(0x2ca)](_0x1eee1d(0x25d),_0x2270f7[_0x1eee1d(0x311)](_0x56984d=>_0x56984d[_0x1eee1d(0x229)]+'\x20('+_0x56984d[_0x1eee1d(0x304)]['gateway']+_0x1eee1d(0x29d)));if(_0x5e7b65){const _0x27c993=_0x2270f7[_0x1eee1d(0x1d0)](_0x5c4b13=>_0x5c4b13[_0x1eee1d(0x229)]['toLowerCase']()===_0x5e7b65[_0x1eee1d(0x1f9)]());!_0x27c993&&_0x5e7b65[_0x1eee1d(0x1f9)]()!=='test_gateway'&&console[_0x1eee1d(0x2ca)](_0x1eee1d(0x1c0)+_0x5e7b65+_0x1eee1d(0x23b)+_0x2270f7['map'](_0x59b88d=>_0x59b88d[_0x1eee1d(0x229)])[_0x1eee1d(0x1fd)](',\x20'));}const _0x458faa={};_0x4b495d&&(_0x458faa[_0x1eee1d(0x306)]=_0x4b495d[_0x1eee1d(0x1ee)]());if(!_0x5e7b65)_0x458faa[_0x1eee1d(0x229)]={'not':'test_gateway'};else{if(_0x5e7b65&&(_0x5e7b65[_0x1eee1d(0x1f9)]()===_0x1eee1d(0x1f1)||_0x5e7b65==='0000'))_0x458faa[_0x1eee1d(0x229)]=_0x1eee1d(0x1f1);else{let _0x2deee4=_0x5e7b65;const _0x32fb9b=(0x0,gateway_1[_0x1eee1d(0x280)])(_0x5e7b65);if(_0x32fb9b)_0x2deee4=_0x32fb9b,console[_0x1eee1d(0x2ca)](_0x1eee1d(0x277)+_0x5e7b65+_0x1eee1d(0x27a)+_0x2deee4+'\x27');else{const _0x457b43=(0x0,gateway_1[_0x1eee1d(0x314)])(_0x5e7b65);if(_0x457b43){const _0xfe4855=(0x0,gateway_1[_0x1eee1d(0x280)])(_0x457b43);_0xfe4855&&(_0x2deee4=_0xfe4855,console[_0x1eee1d(0x2ca)](_0x1eee1d(0x1c7)+_0x5e7b65+'\x27\x20->\x20ID\x20\x27'+_0x457b43+_0x1eee1d(0x233)+_0x2deee4+'\x27'));}else console['log'](_0x1eee1d(0x230)+_0x5e7b65+_0x1eee1d(0x218));}const _0x234a73=await database_1[_0x1eee1d(0x29f)][_0x1eee1d(0x2b4)]['count']({'where':{'gateway':_0x2deee4[_0x1eee1d(0x1f9)]()},'take':0x1});_0x234a73===0x0?(console[_0x1eee1d(0x2ca)](_0x1eee1d(0x30b)+_0x2deee4+'\x27\x20(from\x20\x27'+_0x5e7b65+_0x1eee1d(0x1dd)),_0x458faa[_0x1eee1d(0x229)]=_0x1eee1d(0x214)):(_0x458faa['gateway']=_0x2deee4[_0x1eee1d(0x1f9)](),console[_0x1eee1d(0x2ca)](_0x1eee1d(0x20c)+_0x2deee4+_0x1eee1d(0x24b)+_0x5e7b65+'\x27)'));}}console[_0x1eee1d(0x2ca)](_0x1eee1d(0x251),_0x458faa[_0x1eee1d(0x229)]);_0x562f25&&(_0x458faa[_0x1eee1d(0x2c8)]=_0x562f25);_0x2aca8e&&(_0x458faa[_0x1eee1d(0x2e9)]=_0x2aca8e[_0x1eee1d(0x1ee)](),console[_0x1eee1d(0x2ca)]('üí±\x20Currency\x20filter\x20applied:\x20'+_0x2aca8e[_0x1eee1d(0x1ee)]()));(_0x16f25a||_0x39851e)&&(_0x458faa[_0x1eee1d(0x200)]={},_0x16f25a&&(_0x458faa[_0x1eee1d(0x200)][_0x1eee1d(0x316)]=new Date(_0x16f25a)),_0x39851e&&(_0x458faa[_0x1eee1d(0x200)][_0x1eee1d(0x300)]=new Date(_0x39851e)));_0x31f98d&&(_0x458faa['OR']=[{'id':{'contains':_0x31f98d,'mode':'insensitive'}},{'orderId':{'contains':_0x31f98d,'mode':_0x1eee1d(0x22a)}},{'gatewayOrderId':{'contains':_0x31f98d,'mode':'insensitive'}},{'customerEmail':{'contains':_0x31f98d,'mode':_0x1eee1d(0x22a)}},{'shop':{'name':{'contains':_0x31f98d,'mode':_0x1eee1d(0x22a)}}},{'shop':{'username':{'contains':_0x31f98d,'mode':_0x1eee1d(0x22a)}}}]);console[_0x1eee1d(0x2ca)](_0x1eee1d(0x294),JSON[_0x1eee1d(0x269)](_0x458faa,null,0x2));let _0x2b816f={'createdAt':_0x1eee1d(0x1ce)};if(_0x2cb7e5){const _0x338907=[_0x1eee1d(0x2c1),_0x1eee1d(0x200),_0x1eee1d(0x2fd),_0x1eee1d(0x306),_0x1eee1d(0x229),_0x1eee1d(0x2e9)],_0x4d5136=['asc',_0x1eee1d(0x1ce)];if(_0x338907[_0x1eee1d(0x271)](_0x2cb7e5)){const _0x2bb12a=_0x4d5136[_0x1eee1d(0x271)](_0x2c1d5a)?_0x2c1d5a:_0x1eee1d(0x1ce);_0x2b816f={[_0x2cb7e5]:_0x2bb12a},console[_0x1eee1d(0x2ca)](_0x1eee1d(0x286)+_0x2cb7e5+_0x1eee1d(0x235)+_0x2bb12a+'\x20order');}}const [_0x187fae,_0x20defc]=await Promise['all']([database_1[_0x1eee1d(0x29f)][_0x1eee1d(0x2b4)][_0x1eee1d(0x23f)]({'where':_0x458faa,'skip':_0x330b35,'take':_0x52509d,'orderBy':_0x2b816f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1eee1d(0x29f)][_0x1eee1d(0x2b4)][_0x1eee1d(0x2e1)]({'where':_0x458faa})]);return{'payments':_0x187fae,'pagination':{'page':_0x5ec143,'limit':_0x52509d,'total':_0x20defc,'totalPages':Math[_0x1eee1d(0x1da)](_0x20defc/_0x52509d)}};}async[a40_0x383efb(0x202)](_0x38c356){const _0x2ff026=a40_0x383efb,_0x144eb7=await database_1[_0x2ff026(0x29f)][_0x2ff026(0x2b4)][_0x2ff026(0x2d0)]({'where':{'id':_0x38c356},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x144eb7)return null;return{'id':_0x144eb7['id'],'shopId':_0x144eb7[_0x2ff026(0x2c8)],'gateway':_0x144eb7[_0x2ff026(0x229)],'amount':_0x144eb7[_0x2ff026(0x2c1)],'currency':_0x144eb7['currency'],'status':_0x144eb7[_0x2ff026(0x306)],'orderId':_0x144eb7[_0x2ff026(0x21e)],'gatewayOrderId':_0x144eb7[_0x2ff026(0x248)],'customerEmail':_0x144eb7['customerEmail'],'customerName':_0x144eb7['customerName'],'customerCountry':_0x144eb7[_0x2ff026(0x26c)],'customerIp':_0x144eb7[_0x2ff026(0x29a)],'customerUa':_0x144eb7['customerUa'],'failureMessage':_0x144eb7[_0x2ff026(0x2c3)],'externalPaymentUrl':_0x144eb7['externalPaymentUrl'],'successUrl':_0x144eb7[_0x2ff026(0x207)],'failUrl':_0x144eb7[_0x2ff026(0x279)],'pendingUrl':_0x144eb7[_0x2ff026(0x2bf)],'whiteUrl':_0x144eb7[_0x2ff026(0x2ff)],'createdAt':_0x144eb7[_0x2ff026(0x200)],'updatedAt':_0x144eb7['updatedAt'],'shop':_0x144eb7[_0x2ff026(0x21a)]};}async[a40_0x383efb(0x240)](_0x54bdc9,_0x49be9f,_0x5375e6,_0x42d1bf){const _0x50a2b2=a40_0x383efb,_0x39c3a6=await database_1[_0x50a2b2(0x29f)][_0x50a2b2(0x231)](async _0x504702=>{const _0x5da4b6=_0x50a2b2,_0x5561cf=await _0x504702['payment'][_0x5da4b6(0x2d0)]({'where':{'id':_0x54bdc9},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5561cf)throw new Error('Payment\x20not\x20found');const _0x236bb4=_0x5561cf[_0x5da4b6(0x306)],_0x3e9799=_0x49be9f[_0x5da4b6(0x1ee)]();console[_0x5da4b6(0x2ca)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x54bdc9+_0x5da4b6(0x1c3)+_0x236bb4+_0x5da4b6(0x254)+_0x3e9799),console['log'](_0x5da4b6(0x258)+_0x5561cf[_0x5da4b6(0x21a)][_0x5da4b6(0x2e3)]+'\x20USDT');const _0x5944ff={'status':_0x3e9799,'updatedAt':new Date(),'statusChangedBy':_0x5da4b6(0x24f),'statusChangedAt':new Date()};_0x5375e6&&(_0x5944ff[_0x5da4b6(0x1eb)]=_0x5375e6);_0x3e9799===_0x5da4b6(0x26b)&&_0x42d1bf&&(_0x5944ff[_0x5da4b6(0x29e)]=_0x42d1bf);let _0x139d43=0x0,_0x29dbd1=_0x5561cf[_0x5da4b6(0x21a)][_0x5da4b6(0x2e3)];if(_0x3e9799===_0x5da4b6(0x1f2)&&_0x236bb4!==_0x5da4b6(0x1f2)){_0x5944ff['paidAt']=new Date();const _0x5a398d=await currencyService_1[_0x5da4b6(0x272)][_0x5da4b6(0x208)](_0x5561cf[_0x5da4b6(0x2c1)],_0x5561cf[_0x5da4b6(0x2e9)]);_0x5944ff[_0x5da4b6(0x282)]=_0x5a398d;let _0x2cbb5f=0x2d;const _0x31b3db=await _0x504702['shop']['findUnique']({'where':{'id':_0x5561cf[_0x5da4b6(0x2c8)]},'select':{'gatewaySettings':!![]}});if(_0x31b3db?.[_0x5da4b6(0x1d6)])try{const _0xe9227f=JSON[_0x5da4b6(0x265)](_0x31b3db[_0x5da4b6(0x1d6)]);for(const [_0x24222a,_0x31903b]of Object['entries'](_0xe9227f)){if(_0x24222a[_0x5da4b6(0x1f9)]()===_0x5561cf[_0x5da4b6(0x229)][_0x5da4b6(0x1f9)]()){_0x2cbb5f=_0x31903b['commission']||0xa;break;}}}catch(_0x2c6bff){console[_0x5da4b6(0x2c5)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x54bdc9+':',_0x2c6bff);}let _0x4bc95f;_0x5561cf[_0x5da4b6(0x290)]!==null&&_0x5561cf[_0x5da4b6(0x290)]!==undefined?(_0x4bc95f=_0x5561cf[_0x5da4b6(0x290)],console[_0x5da4b6(0x2ca)](_0x5da4b6(0x2c0)+_0x4bc95f['toFixed'](0x6)+_0x5da4b6(0x299)+_0x54bdc9)):(_0x4bc95f=_0x5a398d*(0x1-_0x2cbb5f/0x64),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x1ed)+_0x54bdc9+':\x20'+_0x2cbb5f+'%\x20from\x20'+_0x5a398d[_0x5da4b6(0x1b8)](0x6)+'\x20USDT'),_0x5944ff[_0x5da4b6(0x290)]=_0x4bc95f,_0x5944ff[_0x5da4b6(0x1c4)]=_0x2cbb5f),_0x139d43=_0x4bc95f,_0x29dbd1+=_0x4bc95f,console[_0x5da4b6(0x2ca)]('üí∞\x20Payment\x20'+_0x54bdc9+_0x5da4b6(0x27f)),console['log'](_0x5da4b6(0x215)+_0x5a398d[_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x1cb)),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x289)+_0x5561cf[_0x5da4b6(0x229)]+_0x5da4b6(0x292)+_0x2cbb5f+'%'),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x1de)+_0x4bc95f[_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x2f2)+_0x2cbb5f+_0x5da4b6(0x288)),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x30f)+_0x4bc95f[_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x1cb));}else{if(_0x236bb4==='PAID'&&_0x3e9799!==_0x5da4b6(0x1f2)&&_0x3e9799!=='CHARGEBACK'){if(_0x5561cf['amountUSDT']){let _0x54d21e=0x2d;const _0x55b17f=await _0x504702[_0x5da4b6(0x21a)][_0x5da4b6(0x2d0)]({'where':{'id':_0x5561cf['shopId']},'select':{'gatewaySettings':!![]}});if(_0x55b17f?.[_0x5da4b6(0x1d6)])try{const _0x3f7c33=JSON[_0x5da4b6(0x265)](_0x55b17f[_0x5da4b6(0x1d6)]);for(const [_0x1c8441,_0x381a0f]of Object[_0x5da4b6(0x1c2)](_0x3f7c33)){if(_0x1c8441[_0x5da4b6(0x1f9)]()===_0x5561cf[_0x5da4b6(0x229)][_0x5da4b6(0x1f9)]()){_0x54d21e=_0x381a0f[_0x5da4b6(0x2ee)]||0xa;break;}}}catch(_0x3287b2){console[_0x5da4b6(0x2c5)](_0x5da4b6(0x310)+_0x54bdc9+':',_0x3287b2);}const _0x40d6e7=_0x5561cf[_0x5da4b6(0x282)]*(0x1-_0x54d21e/0x64);_0x139d43=-_0x40d6e7,_0x29dbd1-=_0x40d6e7,console[_0x5da4b6(0x2ca)](_0x5da4b6(0x215)+_0x5561cf[_0x5da4b6(0x282)][_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x1cb)),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x289)+_0x5561cf[_0x5da4b6(0x229)]+_0x5da4b6(0x292)+_0x54d21e+'%'),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x263)+_0x40d6e7[_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x2f2)+_0x54d21e+'%\x20commission)'),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x1d1)+_0x40d6e7[_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x1cb));}}}_0x3e9799==='CHARGEBACK'&&(console[_0x5da4b6(0x2ca)](_0x5da4b6(0x2a5)),_0x42d1bf&&_0x42d1bf>0x0?(_0x139d43=-_0x42d1bf,_0x29dbd1-=_0x42d1bf,console[_0x5da4b6(0x2ca)](_0x5da4b6(0x2db)+_0x42d1bf[_0x5da4b6(0x1b8)](0x6)+'\x20USDT\x20from\x20balance'),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x21d))):console[_0x5da4b6(0x2ca)](_0x5da4b6(0x1ea)),_0x5944ff[_0x5da4b6(0x29e)]=_0x42d1bf||0x0);_0x3e9799==='REFUND'&&_0x236bb4===_0x5da4b6(0x1f2)&&console[_0x5da4b6(0x2ca)](_0x5da4b6(0x2ea));const _0x47cb68=await _0x504702[_0x5da4b6(0x2b4)][_0x5da4b6(0x217)]({'where':{'id':_0x54bdc9},'data':_0x5944ff,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x139d43!==0x0&&(await _0x504702['shop'][_0x5da4b6(0x217)]({'where':{'id':_0x5561cf[_0x5da4b6(0x2c8)]},'data':{'balance':_0x29dbd1}}),console[_0x5da4b6(0x2ca)](_0x5da4b6(0x295)+_0x5561cf[_0x5da4b6(0x2c8)]+_0x5da4b6(0x1c6)+_0x5561cf[_0x5da4b6(0x21a)][_0x5da4b6(0x2e3)][_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x254)+_0x29dbd1[_0x5da4b6(0x1b8)](0x6)+_0x5da4b6(0x2cb)+(_0x139d43>0x0?'+':'')+_0x139d43[_0x5da4b6(0x1b8)](0x6)+')')),_0x47cb68;});return{'id':_0x39c3a6['id'],'shopId':_0x39c3a6[_0x50a2b2(0x2c8)],'gateway':_0x39c3a6[_0x50a2b2(0x229)],'amount':_0x39c3a6[_0x50a2b2(0x2c1)],'currency':_0x39c3a6[_0x50a2b2(0x2e9)],'status':_0x39c3a6[_0x50a2b2(0x306)],'orderId':_0x39c3a6['orderId'],'gatewayOrderId':_0x39c3a6[_0x50a2b2(0x248)],'customerEmail':_0x39c3a6[_0x50a2b2(0x1e7)],'customerName':_0x39c3a6['customerName'],'customerCountry':_0x39c3a6[_0x50a2b2(0x26c)],'customerIp':_0x39c3a6['customerIp'],'customerUa':_0x39c3a6['customerUa'],'failureMessage':_0x39c3a6[_0x50a2b2(0x2c3)],'adminNotes':_0x39c3a6[_0x50a2b2(0x1eb)],'chargebackAmount':_0x39c3a6[_0x50a2b2(0x29e)],'statusChangedBy':_0x39c3a6[_0x50a2b2(0x301)],'statusChangedAt':_0x39c3a6[_0x50a2b2(0x2d7)],'createdAt':_0x39c3a6['createdAt'],'updatedAt':_0x39c3a6['updatedAt'],'shop':_0x39c3a6[_0x50a2b2(0x21a)]};}async['updateUser'](_0x39fd72,_0x241a65){const _0x328464=a40_0x383efb,_0x40fea8=Math[_0x328464(0x2f4)]()[_0x328464(0x23a)](0x24)[_0x328464(0x2fa)](0x2,0x9);console[_0x328464(0x2ca)](_0x328464(0x264)+_0x40fea8+_0x328464(0x297)+_0x39fd72);const _0x5952cc={..._0x241a65};_0x241a65['password']&&_0x241a65[_0x328464(0x1e1)]['trim']()!==''?(console[_0x328464(0x2ca)](_0x328464(0x29c)+_0x40fea8+_0x328464(0x1be)+_0x39fd72),_0x5952cc[_0x328464(0x1e1)]=await bcryptjs_1[_0x328464(0x29f)][_0x328464(0x2dd)](_0x241a65[_0x328464(0x1e1)],0xc)):(console[_0x328464(0x2ca)](_0x328464(0x29c)+_0x40fea8+_0x328464(0x2aa)),delete _0x5952cc['password']);_0x241a65[_0x328464(0x1f5)]&&(_0x5952cc['name']=_0x241a65[_0x328464(0x1f5)],delete _0x5952cc[_0x328464(0x1f5)]);_0x241a65[_0x328464(0x261)]&&(_0x5952cc[_0x328464(0x2c6)]=_0x241a65['telegramId'],delete _0x5952cc['telegramId']);_0x241a65[_0x328464(0x237)]&&(_0x5952cc[_0x328464(0x2fb)]=_0x241a65[_0x328464(0x237)],delete _0x5952cc['merchantUrl']);if(_0x241a65[_0x328464(0x2b3)]){const _0x5cfa1a=_0x241a65['gateways'][_0x328464(0x311)](_0x227907=>this[_0x328464(0x24a)](_0x227907));console[_0x328464(0x2ca)](_0x328464(0x30a),_0x241a65[_0x328464(0x2b3)],'->',_0x5cfa1a),_0x5952cc[_0x328464(0x2da)]=JSON['stringify'](_0x5cfa1a),delete _0x5952cc['gateways'];}_0x241a65[_0x328464(0x1d6)]&&(console['log'](_0x328464(0x1fc)+_0x40fea8+']\x20Gateway\x20settings\x20before\x20saving:',_0x241a65['gatewaySettings']),_0x5952cc[_0x328464(0x1d6)]=JSON['stringify'](_0x241a65['gatewaySettings']),console[_0x328464(0x2ca)](_0x328464(0x1fc)+_0x40fea8+_0x328464(0x268),_0x5952cc[_0x328464(0x1d6)]));_0x241a65[_0x328464(0x2de)]&&(_0x241a65[_0x328464(0x2de)][_0x328464(0x232)]!==undefined&&(_0x5952cc[_0x328464(0x232)]=_0x241a65[_0x328464(0x2de)][_0x328464(0x232)]||null),_0x241a65['wallets'][_0x328464(0x234)]!==undefined&&(_0x5952cc[_0x328464(0x234)]=_0x241a65[_0x328464(0x2de)][_0x328464(0x234)]||null),_0x241a65[_0x328464(0x2de)]['usdtErcWallet']!==undefined&&(_0x5952cc[_0x328464(0x27e)]=_0x241a65[_0x328464(0x2de)][_0x328464(0x27e)]||null),_0x241a65[_0x328464(0x2de)][_0x328464(0x20a)]!==undefined&&(_0x5952cc[_0x328464(0x20a)]=_0x241a65[_0x328464(0x2de)][_0x328464(0x20a)]||null),delete _0x5952cc[_0x328464(0x2de)]);const _0x12568c=await database_1[_0x328464(0x29f)]['shop'][_0x328464(0x217)]({'where':{'id':_0x39fd72},'data':_0x5952cc,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log']('üéØ\x20['+_0x40fea8+_0x328464(0x2fc),_0x12568c[_0x328464(0x1d6)]),{'id':_0x12568c['id'],'fullName':_0x12568c['name'],'username':_0x12568c[_0x328464(0x1d9)],'telegramId':_0x12568c[_0x328464(0x2c6)],'merchantUrl':_0x12568c[_0x328464(0x2fb)],'gateways':_0x12568c[_0x328464(0x2da)]?JSON[_0x328464(0x265)](_0x12568c['paymentGateways']):null,'gatewaySettings':_0x12568c[_0x328464(0x1d6)]?JSON[_0x328464(0x265)](_0x12568c['gatewaySettings']):null,'publicKey':_0x12568c['publicKey'],'wallets':{'usdtPolygonWallet':_0x12568c['usdtPolygonWallet'],'usdtTrcWallet':_0x12568c[_0x328464(0x234)],'usdtErcWallet':_0x12568c[_0x328464(0x27e)],'usdcPolygonWallet':_0x12568c[_0x328464(0x20a)]},'status':_0x12568c['status'],'createdAt':_0x12568c[_0x328464(0x200)]};}async[a40_0x383efb(0x1e2)](_0x183526){const _0x35335b=a40_0x383efb,_0x4640de=await database_1[_0x35335b(0x29f)][_0x35335b(0x21a)][_0x35335b(0x217)]({'where':{'id':_0x183526},'data':{'status':_0x35335b(0x22e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4640de['id'],'fullName':_0x4640de[_0x35335b(0x2c7)],'username':_0x4640de['username'],'telegramId':_0x4640de['telegram'],'merchantUrl':_0x4640de[_0x35335b(0x2fb)],'gateways':_0x4640de['paymentGateways']?JSON[_0x35335b(0x265)](_0x4640de[_0x35335b(0x2da)]):null,'gatewaySettings':_0x4640de[_0x35335b(0x1d6)]?JSON[_0x35335b(0x265)](_0x4640de['gatewaySettings']):null,'publicKey':_0x4640de['publicKey'],'wallets':{'usdtPolygonWallet':_0x4640de[_0x35335b(0x232)],'usdtTrcWallet':_0x4640de[_0x35335b(0x234)],'usdtErcWallet':_0x4640de['usdtErcWallet'],'usdcPolygonWallet':_0x4640de[_0x35335b(0x20a)]},'status':_0x4640de[_0x35335b(0x306)],'createdAt':_0x4640de[_0x35335b(0x200)]};}async[a40_0x383efb(0x24c)](_0x287e83){const _0x2f87a9=a40_0x383efb,_0x4f5901=await database_1[_0x2f87a9(0x29f)][_0x2f87a9(0x21a)][_0x2f87a9(0x217)]({'where':{'id':_0x287e83},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4f5901['id'],'fullName':_0x4f5901[_0x2f87a9(0x2c7)],'username':_0x4f5901[_0x2f87a9(0x1d9)],'telegramId':_0x4f5901[_0x2f87a9(0x2c6)],'merchantUrl':_0x4f5901[_0x2f87a9(0x2fb)],'gateways':_0x4f5901[_0x2f87a9(0x2da)]?JSON['parse'](_0x4f5901[_0x2f87a9(0x2da)]):null,'gatewaySettings':_0x4f5901[_0x2f87a9(0x1d6)]?JSON['parse'](_0x4f5901[_0x2f87a9(0x1d6)]):null,'publicKey':_0x4f5901[_0x2f87a9(0x302)],'wallets':{'usdtPolygonWallet':_0x4f5901['usdtPolygonWallet'],'usdtTrcWallet':_0x4f5901[_0x2f87a9(0x234)],'usdtErcWallet':_0x4f5901['usdtErcWallet'],'usdcPolygonWallet':_0x4f5901[_0x2f87a9(0x20a)]},'status':_0x4f5901[_0x2f87a9(0x306)],'createdAt':_0x4f5901[_0x2f87a9(0x200)]};}async[a40_0x383efb(0x309)](_0x68377f){const _0x3267bc=a40_0x383efb,{page:_0x28489f,limit:_0x19cf4e,status:_0x240e3c}=_0x68377f,_0x4695a7=(_0x28489f-0x1)*_0x19cf4e,_0x305abc={};_0x240e3c&&(_0x305abc[_0x3267bc(0x306)]=_0x240e3c[_0x3267bc(0x1ee)]());const [_0x4af1b3,_0x26cd10]=await Promise[_0x3267bc(0x2f8)]([database_1[_0x3267bc(0x29f)]['shop'][_0x3267bc(0x23f)]({'where':_0x305abc,'skip':_0x4695a7,'take':_0x19cf4e,'orderBy':{'createdAt':_0x3267bc(0x1ce)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x3267bc(0x21a)][_0x3267bc(0x2e1)]({'where':_0x305abc})]);return{'users':_0x4af1b3[_0x3267bc(0x311)](_0x20e864=>{const _0x20b0a4=_0x3267bc,_0x518663=_0x20e864[_0x20b0a4(0x2da)]?JSON['parse'](_0x20e864[_0x20b0a4(0x2da)]):null,_0x379416=_0x518663?_0x518663[_0x20b0a4(0x311)](_0x419d62=>this[_0x20b0a4(0x2a0)](_0x419d62)):null;return{'id':_0x20e864['id'],'fullName':_0x20e864[_0x20b0a4(0x2c7)],'username':_0x20e864[_0x20b0a4(0x1d9)],'telegramId':_0x20e864[_0x20b0a4(0x2c6)],'merchantUrl':_0x20e864[_0x20b0a4(0x2fb)],'gateways':_0x379416,'gatewaySettings':_0x20e864['gatewaySettings']?JSON[_0x20b0a4(0x265)](_0x20e864[_0x20b0a4(0x1d6)]):null,'publicKey':_0x20e864['publicKey'],'wallets':{'usdtPolygonWallet':_0x20e864[_0x20b0a4(0x232)],'usdtTrcWallet':_0x20e864['usdtTrcWallet'],'usdtErcWallet':_0x20e864[_0x20b0a4(0x27e)],'usdcPolygonWallet':_0x20e864[_0x20b0a4(0x20a)]},'status':_0x20e864['status'],'createdAt':_0x20e864[_0x20b0a4(0x200)]};}),'pagination':{'page':_0x28489f,'limit':_0x19cf4e,'total':_0x26cd10,'totalPages':Math[_0x3267bc(0x1da)](_0x26cd10/_0x19cf4e)}};}async[a40_0x383efb(0x1b9)](_0x2e06cf){const _0x8d398f=a40_0x383efb,_0x153f99=await database_1['default'][_0x8d398f(0x21a)][_0x8d398f(0x2d0)]({'where':{'id':_0x2e06cf},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x153f99)return null;const _0xd6c5f0=_0x153f99[_0x8d398f(0x2da)]?JSON[_0x8d398f(0x265)](_0x153f99['paymentGateways']):null,_0x25c663=_0xd6c5f0?_0xd6c5f0[_0x8d398f(0x311)](_0x54c386=>this[_0x8d398f(0x2a0)](_0x54c386)):null;return _0xd6c5f0&&_0x25c663&&console[_0x8d398f(0x2ca)]('üîÑ\x20Gateway\x20mapping\x20(get):',_0xd6c5f0,'->',_0x25c663),{'id':_0x153f99['id'],'fullName':_0x153f99[_0x8d398f(0x2c7)],'username':_0x153f99['username'],'telegramId':_0x153f99[_0x8d398f(0x2c6)],'merchantUrl':_0x153f99['shopUrl'],'gateways':_0x25c663,'gatewaySettings':_0x153f99[_0x8d398f(0x1d6)]?JSON['parse'](_0x153f99[_0x8d398f(0x1d6)]):null,'publicKey':_0x153f99[_0x8d398f(0x302)],'wallets':{'usdtPolygonWallet':_0x153f99[_0x8d398f(0x232)],'usdtTrcWallet':_0x153f99[_0x8d398f(0x234)],'usdtErcWallet':_0x153f99[_0x8d398f(0x27e)],'usdcPolygonWallet':_0x153f99[_0x8d398f(0x20a)]},'status':_0x153f99[_0x8d398f(0x306)],'createdAt':_0x153f99[_0x8d398f(0x200)]};}async[a40_0x383efb(0x293)](_0x2bdf03){const _0x53ba1a=a40_0x383efb,{fullName:_0x1e110f,username:_0x317f0e,password:_0x346334,telegramId:_0x20bc38,merchantUrl:_0x1d11c9,gateways:_0x4e2099,gatewaySettings:_0x4b2f76,wallets:_0x3fb7af}=_0x2bdf03,_0x66bfe5=await database_1[_0x53ba1a(0x29f)]['shop'][_0x53ba1a(0x2d0)]({'where':{'username':_0x317f0e}});if(_0x66bfe5)throw new Error(_0x53ba1a(0x23d));if(_0x20bc38){const _0x156b22=await database_1[_0x53ba1a(0x29f)][_0x53ba1a(0x21a)]['findUnique']({'where':{'telegram':_0x20bc38}});if(_0x156b22)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x2d3925=await bcryptjs_1['default'][_0x53ba1a(0x2dd)](_0x346334,0xc),_0x105f0f=_0x53ba1a(0x312)+crypto_1['default'][_0x53ba1a(0x2d5)](0x20)[_0x53ba1a(0x23a)](_0x53ba1a(0x2fe)),_0x2be956='sk_'+crypto_1[_0x53ba1a(0x29f)][_0x53ba1a(0x2d5)](0x20)[_0x53ba1a(0x23a)](_0x53ba1a(0x2fe)),_0x374cf4=_0x4e2099?_0x4e2099[_0x53ba1a(0x311)](_0x2f6aec=>this[_0x53ba1a(0x24a)](_0x2f6aec)):null;_0x4e2099&&_0x374cf4&&console[_0x53ba1a(0x2ca)](_0x53ba1a(0x2a7),_0x4e2099,'->',_0x374cf4);const _0x406cda=await database_1[_0x53ba1a(0x29f)][_0x53ba1a(0x21a)]['create']({'data':{'name':_0x1e110f,'username':_0x317f0e,'password':_0x2d3925,'telegram':_0x20bc38,'shopUrl':_0x1d11c9,'paymentGateways':_0x374cf4?JSON[_0x53ba1a(0x269)](_0x374cf4):null,'gatewaySettings':_0x4b2f76?JSON[_0x53ba1a(0x269)](_0x4b2f76):null,'usdtPolygonWallet':_0x3fb7af?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x3fb7af?.[_0x53ba1a(0x234)]||null,'usdtErcWallet':_0x3fb7af?.[_0x53ba1a(0x27e)]||null,'usdcPolygonWallet':_0x3fb7af?.[_0x53ba1a(0x20a)]||null,'publicKey':_0x105f0f,'secretKey':_0x2be956,'status':_0x53ba1a(0x1ca)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x406cda['id'],'fullName':_0x406cda[_0x53ba1a(0x2c7)],'username':_0x406cda[_0x53ba1a(0x1d9)],'telegramId':_0x406cda[_0x53ba1a(0x2c6)],'merchantUrl':_0x406cda[_0x53ba1a(0x2fb)],'gateways':_0x406cda[_0x53ba1a(0x2da)]?JSON[_0x53ba1a(0x265)](_0x406cda['paymentGateways']):null,'gatewaySettings':_0x406cda['gatewaySettings']?JSON[_0x53ba1a(0x265)](_0x406cda[_0x53ba1a(0x1d6)]):null,'publicKey':_0x406cda[_0x53ba1a(0x302)],'wallets':{'usdtPolygonWallet':_0x406cda[_0x53ba1a(0x232)],'usdtTrcWallet':_0x406cda['usdtTrcWallet'],'usdtErcWallet':_0x406cda['usdtErcWallet'],'usdcPolygonWallet':_0x406cda['usdcPolygonWallet']},'status':_0x406cda[_0x53ba1a(0x306)],'createdAt':_0x406cda[_0x53ba1a(0x200)]};}async[a40_0x383efb(0x2e4)](_0x5f09c0){const _0x583d75=a40_0x383efb;await database_1[_0x583d75(0x29f)]['shop']['delete']({'where':{'id':_0x5f09c0}});}[a40_0x383efb(0x28e)](_0x3ff122,_0x37aebe,_0x2c949a){const _0x822db1=a40_0x383efb,_0x5442bb=new Map(),_0x179d80=new Date(_0x37aebe);while(_0x179d80<=_0x2c949a){const _0x2d0fe5=_0x179d80[_0x822db1(0x2d1)]()[_0x822db1(0x257)]('T')[0x0];_0x5442bb['set'](_0x2d0fe5,{'revenue':0x0,'count':0x0}),_0x179d80['setDate'](_0x179d80[_0x822db1(0x1cd)]()+0x1);}for(const _0x135304 of _0x3ff122){const _0x303eef=_0x135304[_0x822db1(0x200)][_0x822db1(0x2d1)]()[_0x822db1(0x257)]('T')[0x0],_0x845553=_0x5442bb[_0x822db1(0x201)](_0x303eef);_0x845553&&(_0x845553[_0x822db1(0x2e1)]+=0x1,_0x135304[_0x822db1(0x306)]==='PAID'&&(_0x135304['amountUSDT']?_0x845553[_0x822db1(0x242)]+=_0x135304[_0x822db1(0x282)]:console[_0x822db1(0x2ca)](_0x822db1(0x1d2)+_0x135304['id']+_0x822db1(0x216))));}const _0x47f8e1=[],_0x1b88ab=[];for(const [_0x2fc34a,_0x45e16f]of _0x5442bb){_0x47f8e1[_0x822db1(0x28b)]({'date':_0x2fc34a,'amount':Math[_0x822db1(0x20f)](_0x45e16f[_0x822db1(0x242)]*0x64)/0x64}),_0x1b88ab[_0x822db1(0x28b)]({'date':_0x2fc34a,'count':_0x45e16f[_0x822db1(0x2e1)]});}return{'dailyRevenue':_0x47f8e1,'dailyPayments':_0x1b88ab};}}exports['AdminService']=AdminService;