'use strict';const a36_0x53d968=a36_0x2be7;(function(_0x1fb2f2,_0x13555c){const _0x6e9d9a=a36_0x2be7,_0x3fcc7c=_0x1fb2f2();while(!![]){try{const _0x9c3be0=parseInt(_0x6e9d9a(0x1d9))/0x1+parseInt(_0x6e9d9a(0x29a))/0x2+-parseInt(_0x6e9d9a(0x2be))/0x3+parseInt(_0x6e9d9a(0x2a6))/0x4*(-parseInt(_0x6e9d9a(0x221))/0x5)+parseInt(_0x6e9d9a(0x1cb))/0x6*(parseInt(_0x6e9d9a(0x287))/0x7)+parseInt(_0x6e9d9a(0x264))/0x8+-parseInt(_0x6e9d9a(0x290))/0x9*(-parseInt(_0x6e9d9a(0x1e7))/0xa);if(_0x9c3be0===_0x13555c)break;else _0x3fcc7c['push'](_0x3fcc7c['shift']());}catch(_0x36d915){_0x3fcc7c['push'](_0x3fcc7c['shift']());}}}(a36_0x366e,0xbdcc4));function a36_0x366e(){const _0x238e4c=['currencyService','entries','whiteUrl','payment','Username\x20already\x20exists','randomBytes','\x20USDT\x20(+','_sum','dateTo','Plisio','usdcPolygonWallet','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','6957790cfqfPa','\x20order','not\x20set','password','getSystemStatistics',':\x20commission\x20=\x20','chargebackAmount','\x20\x20\x20💵\x20Available\x20balance:\x20','insensitive','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','__esModule','\x20USDT,\x20Requested:\x20','📊\x20Merchant\x20statistics\x20calculated:','amountUSDT','Rapyd','Open\x20Banking\x202','split','sort','random','usdtPolygonWallet','groupBy','gatewaySettings','custom','💰\x20Creating\x20payout\x20for\x20shop\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','💰\x20[PAYOUT]\x20Merchant\x20','gatewayEarnings','admin','customerIp','shopUrl','🎯\x20[','\x20USDT\x20(theoretical\x20net)','\x20\x20\x20📊\x20Commission\x20difference:\x20','\x20USDT\x20(gross\x20revenue)','\x20\x20\x20Merchant\x20gets:\x20','toLowerCase','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','klyme_de','gateway','wallets','merchantUrl','\x20no\x20longer\x20PAID:','📊\x20Getting\x20payments\x20with\x20filters:','rapyd','mastercard','findMany','🔄\x20Admin\x20updating\x20payment\x20','dateFrom','\x20USDT\x20for\x20payment\x20','amountAfterGatewayCommissionUSDT','SUSPENDED','setDate','amount','\x20became\x20PAID:','customerName','update','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','totalAmountAfterCommissionUSDT','10nVqHze','\x27\x20not\x20found.\x20Available\x20gateways:\x20','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','totalTurnover','📊\x20Payout\x20statistics\x20calculated:','customerCountry','MasterCard','noda','🔍\x20Using\x20gateway\x20\x27','getUserById','date','./currencyService','⚠️\x20Gateway\x20\x27','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','getMonth','\x20USDT\x20(total\x20paid\x20to\x20merchants)','failureMessage','💳\x20Payout\x20wallet\x20for\x20','getMerchantsAwaitingPayout','paymentsCount','publicKey','usdtTrcWallet','pk_',']\x20Updating\x20password\x20for\x20user\x20','adminNotes','getGatewayNameById','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','COMPLETED','turnoverUSDT','../types/gateway','../config/database','error','\x20status:\x20','📊\x20Available\x20gateways\x20in\x20database:','klyme_gb','summary','customerUa','set','getFullYear','ACTIVE','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','updateCustomerData','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','📊\x20Total\x20payments\x20(including\x20failed):\x20','\x20balance\x20updated:','🔐\x20[','\x20payments)','\x20\x20\x20🌍\x20Country:\x20','getMerchantStatistics','\x20for\x20shop\x20','test_gateway','statusChangedAt','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','averageCommissionRate','🔄\x20Gateway\x20mapping\x20(get):','round','AdminService','createPayout','paidAt','sk_','Error\x20processing\x20payment\x20','💸\x20CHARGEBACK\x20penalty:\x20-','totalCommissionRate','createdAt','\x20\x20\x20💳\x20Total\x20payments:\x20','3580784Amrcro','map','forEach','💰\x20Payment\x20','values','telegram','\x20USDT\x20from\x20balance','pendingPayout','cointopay','\x20active\x20merchants\x20for\x20selection','parse','getPayoutStats','commission','totalPayout','%\x20commission)','revenue','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','PENDING','⚠️\x20Requested\x20gateway\x20\x27','awaitingPayout','\x20\x20\x20Merchant\x20loses:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','getAllUsers','getDate','gte','merchantEarnings','CoinToPay','some','shop','commissionUSDT','\x20\x20\x20💰\x20Total\x20payout:\x20','getAllPayouts','toString','lte','\x27\x20(from\x20\x27','1351BgKWqv','\x20\x20\x20Balance:\x20','hex','thisMonth','getGatewayInternalName','💰\x20[PAYOUT]\x20Gateway\x20','\x20USDT',']\x20Gateway\x20settings\x20JSON\x20string:','\x20merchants','9JuaRzQ','successUrl','fullName','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20merchants\x20with\x20positive\x20balance','merchantEarningsUSDT','📊\x20Gateway\x20filter\x20applied:','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20USDT\x20(without\x20commission)','633786HjjdnU','network','$transaction','PAID','all','count','paymentGateways','gateways','delete','aggregate','amountAfterCommissionUSDT','erc20','1223940QtLobl','findUnique','create',']\x20Gateway\x20settings\x20before\x20saving:','paidOutUSDT','REFUND','createUser','\x27\x20->\x20name\x20\x27','💰\x20Current\x20shop\x20balance:\x20','log','defineProperty','\x20\x20\x20Gateway:\x20','customerEmail','toUpperCase','\x20USDT)','pendingUrl','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20',',\x20userId:\x20','plisio','telegramId','get','\x20USDT\x20(after\x20payouts)','trc20',',\x20Commission:\x20','3650637UpMZfY','payout','polygon','periodTo','getTime','turnover','not\x20specified','%\x20from\x20','Shop\x20not\x20found','failUrl','stringify','✅\x20Using\x20gateway\x20filter:\x20\x27','balance','dailyRevenue','\x20USDT\x20(-','📅\x20Period:\x20','getGatewayIdByName',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','getPaymentById','averageCheckUSDT','\x20\x20\x20📅\x20This\x20month:\x20','💰\x20Shop\x20','✅\x20Payout\x20created:\x20','_count','currency','📊\x20Final\x20WHERE\x20conditions:','\x20->\x20','getAllPayments','CHARGEBACK','statusChangedBy','\x20USDT\x20(after\x20','\x20\x20\x20Total\x20paid\x20out:\x20','month','generateDailyStatistics','totalPaidOut','periodFrom','bcryptjs','getGatewayDisplayName','status','username','cointopay2',',\x20successful:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','Test\x20Gateway','orderId','trim','length','\x20\x20\x20Transaction\x20hash:\x20','updatedAt','⚠️\x20Payment\x20','shopId','suspendUser','📋\x20Getting\x20merchants\x20selection\x20list...','txid','30d','gatewayOrderId','💰\x20Found\x20','externalPaymentUrl','convertToUSDT','getMerchantsSelection','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','90d','🔧\x20[','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','KLYME\x20EU','usdtErcWallet','hash','polygon_usdc','default','toFixed','period','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20USDT\x20(','toISOString','notes','💱\x20Currency\x20filter\x20applied:\x20','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','2020-01-01','asc','reduce','🔄\x20Converted\x20gateway\x20name\x20\x27','KLYME\x20DE','ceil','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','desc','includes','7278PYQclH','totalPayments','Payment\x20not\x20found','📊\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','0000','updateUser','name','Noda','📊\x20Merchants\x20awaiting\x20payout:\x20','findFirst','📋\x20Found\x20','dailyPayments','activateUser','911882zAcPav','\x20USDT\x20(same\x20as\x20awaiting)'];a36_0x366e=function(){return _0x238e4c;};return a36_0x366e();}var __importDefault=this&&this['__importDefault']||function(_0x571399){const _0x1a2839=a36_0x2be7;return _0x571399&&_0x571399[_0x1a2839(0x1f1)]?_0x571399:{'default':_0x571399};};function a36_0x2be7(_0x5740ad,_0x13fdf9){const _0x366ebb=a36_0x366e();return a36_0x2be7=function(_0x2be7f1,_0x1f4583){_0x2be7f1=_0x2be7f1-0x189;let _0x22a668=_0x366ebb[_0x2be7f1];return _0x22a668;},a36_0x2be7(_0x5740ad,_0x13fdf9);}Object[a36_0x53d968(0x2b0)](exports,'__esModule',{'value':!![]}),exports[a36_0x53d968(0x25b)]=void 0x0;const database_1=__importDefault(require(a36_0x53d968(0x23f))),bcryptjs_1=__importDefault(require(a36_0x53d968(0x199))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a36_0x53d968(0x22c)),gateway_1=require(a36_0x53d968(0x23e));class AdminService{async[a36_0x53d968(0x26f)](){const _0x5d380f=a36_0x53d968;console[_0x5d380f(0x2af)]('📊\x20Calculating\x20payout\x20statistics...');const _0x1a5dd5=await database_1[_0x5d380f(0x1b9)][_0x5d380f(0x280)][_0x5d380f(0x2a3)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x5d380f(0x248)}}),_0x3d7265=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x2984f7=await database_1['default'][_0x5d380f(0x1de)][_0x5d380f(0x29f)]({'where':{'status':_0x5d380f(0x29d),'gateway':{'not':_0x5d380f(0x254)}}}),_0x8f50dc=new Date(),_0x18420f=new Date(_0x8f50dc[_0x5d380f(0x247)](),_0x8f50dc['getMonth'](),0x1),_0x5ef02e=new Date(_0x8f50dc[_0x5d380f(0x247)](),_0x8f50dc[_0x5d380f(0x22f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x297b60=await database_1[_0x5d380f(0x1b9)][_0x5d380f(0x2bf)][_0x5d380f(0x2a3)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x18420f,'lte':_0x5ef02e},'status':_0x5d380f(0x23c)}}),_0x2f672e=_0x1a5dd5[_0x5d380f(0x1e2)][_0x5d380f(0x197)]||0x0,_0x306fad=_0x3d7265[_0x5d380f(0x244)][_0x5d380f(0x220)],_0x23c923=_0x297b60[_0x5d380f(0x1e2)]['amount']||0x0,_0x1f6cdf={'totalPayout':Math['round'](_0x2f672e*0x64)/0x64,'awaitingPayout':Math['round'](_0x306fad*0x64)/0x64,'thisMonth':Math[_0x5d380f(0x25a)](_0x23c923*0x64)/0x64,'availableBalance':Math['round'](_0x306fad*0x64)/0x64,'totalPayments':_0x2984f7};return console['log'](_0x5d380f(0x225)),console[_0x5d380f(0x2af)](_0x5d380f(0x282)+_0x1f6cdf[_0x5d380f(0x271)]+_0x5d380f(0x230)),console[_0x5d380f(0x2af)](_0x5d380f(0x279)+_0x1f6cdf[_0x5d380f(0x277)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x5d380f(0x2af)](_0x5d380f(0x1ee)+_0x1f6cdf['availableBalance']+_0x5d380f(0x1da)),console[_0x5d380f(0x2af)](_0x5d380f(0x189)+_0x1f6cdf['thisMonth']+_0x5d380f(0x28d)),console[_0x5d380f(0x2af)](_0x5d380f(0x263)+_0x1f6cdf[_0x5d380f(0x1cc)]+'\x20PAID\x20payments'),console['log']('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x1a5dd5[_0x5d380f(0x1e2)][_0x5d380f(0x2ca)]||0x0)[_0x5d380f(0x1ba)](0x2)+_0x5d380f(0x299)),console[_0x5d380f(0x2af)](_0x5d380f(0x207)+((_0x1a5dd5[_0x5d380f(0x1e2)][_0x5d380f(0x2ca)]||0x0)-_0x306fad)['toFixed'](0x2)+'\x20USDT'),_0x1f6cdf;}async[a36_0x53d968(0x24b)](_0x5d05c7,_0x50663a){const _0xd8bd3=a36_0x53d968;console['log'](_0xd8bd3(0x1b4)+_0x5d05c7+':',_0x50663a);const _0x18faaa=await database_1[_0xd8bd3(0x1b9)]['payment'][_0xd8bd3(0x2a7)]({'where':{'id':_0x5d05c7},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x18faaa)throw new Error(_0xd8bd3(0x1cd));const _0x45b248={};_0x50663a['customerCountry']!==undefined&&(_0x45b248[_0xd8bd3(0x226)]=_0x50663a[_0xd8bd3(0x226)]||null);_0x50663a[_0xd8bd3(0x203)]!==undefined&&(_0x45b248[_0xd8bd3(0x203)]=_0x50663a[_0xd8bd3(0x203)]||null);_0x50663a['customerUa']!==undefined&&(_0x45b248[_0xd8bd3(0x245)]=_0x50663a[_0xd8bd3(0x245)]||null);const _0x1e9be6=await database_1[_0xd8bd3(0x1b9)]['payment'][_0xd8bd3(0x21e)]({'where':{'id':_0x5d05c7},'data':{..._0x45b248,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xd8bd3(0x2af)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x5d05c7),console[_0xd8bd3(0x2af)](_0xd8bd3(0x251)+_0x18faaa[_0xd8bd3(0x226)]+_0xd8bd3(0x18f)+_0x1e9be6[_0xd8bd3(0x226)]),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x18faaa[_0xd8bd3(0x203)]+_0xd8bd3(0x18f)+_0x1e9be6[_0xd8bd3(0x203)]),console[_0xd8bd3(0x2af)](_0xd8bd3(0x1bc)+(_0x18faaa[_0xd8bd3(0x245)]?_0xd8bd3(0x246):'not\x20set')+'\x20->\x20'+(_0x1e9be6['customerUa']?'set':_0xd8bd3(0x1e9))),_0x1e9be6;}async[a36_0x53d968(0x1eb)](_0x10a91f){const _0x40e3f9=a36_0x53d968,_0x1f7dbd=new Date();let _0x2935d5;switch(_0x10a91f){case'7d':_0x2935d5=new Date(_0x1f7dbd[_0x40e3f9(0x2c2)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x40e3f9(0x1ab):_0x2935d5=new Date(_0x1f7dbd['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x40e3f9(0x1b2):_0x2935d5=new Date(_0x1f7dbd[_0x40e3f9(0x2c2)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x40e3f9(0x29e):const _0x1b8304=await database_1[_0x40e3f9(0x1b9)][_0x40e3f9(0x1de)][_0x40e3f9(0x1d5)]({'where':{'gateway':{'not':_0x40e3f9(0x254)}},'orderBy':{'createdAt':_0x40e3f9(0x1c3)},'select':{'createdAt':!![]}});_0x2935d5=_0x1b8304?_0x1b8304['createdAt']:new Date(_0x40e3f9(0x1c2)),console[_0x40e3f9(0x2af)]('📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x2935d5['toISOString']());break;default:_0x2935d5=new Date(_0x1f7dbd[_0x40e3f9(0x2c2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1031bf,_0x10a8ff,_0x495700,_0x4caeb6,_0x314072,_0x314db9,_0x21f8c3]=await Promise['all']([database_1['default'][_0x40e3f9(0x280)]['count'](),database_1[_0x40e3f9(0x1b9)][_0x40e3f9(0x280)]['count']({'where':{'status':_0x40e3f9(0x248)}}),database_1['default']['payment'][_0x40e3f9(0x29f)]({'where':{'createdAt':{'gte':_0x2935d5},'gateway':{'not':_0x40e3f9(0x254)}}}),database_1[_0x40e3f9(0x1b9)][_0x40e3f9(0x1de)]['count']({'where':{'status':_0x40e3f9(0x29d),'createdAt':{'gte':_0x2935d5},'gateway':{'not':_0x40e3f9(0x254)}}}),database_1[_0x40e3f9(0x1b9)]['payment'][_0x40e3f9(0x214)]({'where':{'status':_0x40e3f9(0x29d),'createdAt':{'gte':_0x2935d5},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x40e3f9(0x1b9)]['payment'][_0x40e3f9(0x214)]({'where':{'gateway':{'not':_0x40e3f9(0x254)}},'take':0xa,'orderBy':{'createdAt':_0x40e3f9(0x1c9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x40e3f9(0x1b9)]['payment']['findMany']({'where':{'createdAt':{'gte':_0x2935d5},'gateway':{'not':_0x40e3f9(0x254)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x1eaf26=0x0;for(const _0x561cde of _0x314072){const _0x9594d5=await currencyService_1[_0x40e3f9(0x1db)][_0x40e3f9(0x1af)](_0x561cde[_0x40e3f9(0x21b)],_0x561cde[_0x40e3f9(0x18d)]);_0x1eaf26+=_0x9594d5;}const _0x24d3b7=this[_0x40e3f9(0x196)](_0x21f8c3,_0x2935d5,_0x1f7dbd),_0x10b1f2=_0x495700>0x0?_0x4caeb6/_0x495700*0x64:0x0;return{'totalShops':_0x1031bf,'activeShops':_0x10a8ff,'totalPayments':_0x495700,'successfulPayments':_0x4caeb6,'totalRevenue':Math[_0x40e3f9(0x25a)](_0x1eaf26*0x64)/0x64,'conversionRate':Math[_0x40e3f9(0x25a)](_0x10b1f2*0x64)/0x64,'dailyRevenue':_0x24d3b7[_0x40e3f9(0x2cb)],'dailyPayments':_0x24d3b7[_0x40e3f9(0x1d7)],'recentPayments':_0x314db9[_0x40e3f9(0x265)](_0x27056d=>({'id':_0x27056d['id'],'amount':_0x27056d[_0x40e3f9(0x21b)],'currency':_0x27056d[_0x40e3f9(0x18d)],'status':_0x27056d['status'],'gateway':_0x27056d[_0x40e3f9(0x20d)],'shop':_0x27056d[_0x40e3f9(0x280)],'createdAt':_0x27056d[_0x40e3f9(0x262)]}))};}async[a36_0x53d968(0x252)](_0x25cb38){const _0x4270af=a36_0x53d968;console[_0x4270af(0x2af)](_0x4270af(0x1f0),_0x25cb38);let _0x2debc5,_0x4e0108=new Date();if(_0x25cb38[_0x4270af(0x1bb)]==='custom'&&_0x25cb38[_0x4270af(0x216)]&&_0x25cb38['dateTo'])_0x2debc5=new Date(_0x25cb38[_0x4270af(0x216)]),_0x4e0108=new Date(_0x25cb38[_0x4270af(0x1e3)]);else{const _0xbf2b8a=new Date();switch(_0x25cb38[_0x4270af(0x1bb)]){case'week':_0x2debc5=new Date(_0xbf2b8a['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4270af(0x195):_0x2debc5=new Date(_0xbf2b8a[_0x4270af(0x2c2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x2debc5=new Date(_0xbf2b8a['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4270af(0x29e):default:_0x2debc5=new Date(_0x4270af(0x1c2));break;}}console['log'](_0x4270af(0x2cd)+_0x2debc5['toISOString']()+'\x20to\x20'+_0x4e0108[_0x4270af(0x1be)]());const _0xff5c2c={'status':'PAID','gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x2debc5,'lte':_0x4e0108}};_0x25cb38['shopId']&&(_0xff5c2c[_0x4270af(0x1a7)]=_0x25cb38['shopId']);const _0x30846e=await database_1[_0x4270af(0x1b9)]['payment'][_0x4270af(0x214)]({'where':_0xff5c2c,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4270af(0x2af)](_0x4270af(0x1ad)+_0x30846e[_0x4270af(0x1a3)]+'\x20paid\x20payments\x20for\x20analysis');const _0x557cef={'gateway':{'not':_0x4270af(0x254)},'createdAt':{'gte':_0x2debc5,'lte':_0x4e0108}};_0x25cb38[_0x4270af(0x1a7)]&&(_0x557cef[_0x4270af(0x1a7)]=_0x25cb38[_0x4270af(0x1a7)]);const _0x3201f6=await database_1[_0x4270af(0x1b9)][_0x4270af(0x1de)][_0x4270af(0x29f)]({'where':_0x557cef});console['log'](_0x4270af(0x24d)+_0x3201f6+_0x4270af(0x19e)+_0x30846e[_0x4270af(0x1a3)]);let _0x1b6b9f=0x0,_0x737ccf=0x0,_0x1925d8=0x0;const _0x32361a={},_0x360200={},_0x596adf={};for(const _0x2ed1db of _0x30846e){try{const _0x42c4d6=await currencyService_1[_0x4270af(0x1db)][_0x4270af(0x1af)](_0x2ed1db[_0x4270af(0x21b)],_0x2ed1db[_0x4270af(0x18d)]);let _0x5db479={};if(_0x2ed1db[_0x4270af(0x280)]['gatewaySettings'])try{_0x5db479=JSON['parse'](_0x2ed1db[_0x4270af(0x280)]['gatewaySettings']);}catch(_0x27f42b){console[_0x4270af(0x240)](_0x4270af(0x2b6)+_0x2ed1db['shopId']+':',_0x27f42b);}let _0x5a4c45={},_0x20fe02=0xa;for(const [_0x27ac95,_0x2b9d2c]of Object[_0x4270af(0x1dc)](_0x5db479)){if(_0x27ac95[_0x4270af(0x20a)]()===_0x2ed1db['gateway'][_0x4270af(0x20a)]()){_0x5a4c45=_0x2b9d2c,_0x20fe02=_0x2b9d2c['commission']||0xa;break;}}let _0x26f076,_0x552f36;_0x2ed1db[_0x4270af(0x218)]!==null&&_0x2ed1db[_0x4270af(0x218)]!==undefined?(_0x26f076=_0x2ed1db[_0x4270af(0x218)],_0x552f36=_0x42c4d6-_0x26f076,console[_0x4270af(0x2af)](_0x4270af(0x1ce)+_0x26f076['toFixed'](0x6)+_0x4270af(0x217)+_0x2ed1db['id'])):(_0x552f36=_0x42c4d6*(_0x20fe02/0x64),_0x26f076=_0x42c4d6-_0x552f36,console[_0x4270af(0x2af)](_0x4270af(0x223)+_0x2ed1db['id']+':\x20'+_0x20fe02+_0x4270af(0x2c5)+_0x42c4d6[_0x4270af(0x1ba)](0x6)+'\x20USDT'));_0x1b6b9f+=_0x42c4d6,_0x737ccf+=_0x26f076,_0x1925d8+=_0x552f36;!_0x32361a[_0x2ed1db[_0x4270af(0x20d)]]&&(_0x32361a[_0x2ed1db[_0x4270af(0x20d)]]={'gateway':_0x2ed1db[_0x4270af(0x20d)],'gatewayDisplayName':this[_0x4270af(0x19a)](_0x2ed1db[_0x4270af(0x20d)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x32361a[_0x2ed1db['gateway']]['paymentsCount']++,_0x32361a[_0x2ed1db['gateway']]['turnoverUSDT']+=_0x42c4d6,_0x32361a[_0x2ed1db[_0x4270af(0x20d)]][_0x4270af(0x281)]+=_0x552f36,_0x32361a[_0x2ed1db[_0x4270af(0x20d)]][_0x4270af(0x295)]+=_0x26f076,_0x32361a[_0x2ed1db[_0x4270af(0x20d)]][_0x4270af(0x261)]+=_0x20fe02;!_0x25cb38[_0x4270af(0x1a7)]&&(!_0x360200[_0x2ed1db[_0x4270af(0x1a7)]]&&(_0x360200[_0x2ed1db[_0x4270af(0x1a7)]]={'shopId':_0x2ed1db[_0x4270af(0x1a7)],'shopName':_0x2ed1db['shop'][_0x4270af(0x1d2)],'shopUsername':_0x2ed1db[_0x4270af(0x280)][_0x4270af(0x19c)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x360200[_0x2ed1db[_0x4270af(0x1a7)]][_0x4270af(0x234)]++,_0x360200[_0x2ed1db[_0x4270af(0x1a7)]][_0x4270af(0x23d)]+=_0x42c4d6,_0x360200[_0x2ed1db[_0x4270af(0x1a7)]]['commissionUSDT']+=_0x552f36,_0x360200[_0x2ed1db[_0x4270af(0x1a7)]][_0x4270af(0x295)]+=_0x26f076);const _0x18aebf=_0x2ed1db[_0x4270af(0x25d)]['toISOString']()[_0x4270af(0x1f7)]('T')[0x0];!_0x596adf[_0x18aebf]&&(_0x596adf[_0x18aebf]={'date':_0x18aebf,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x596adf[_0x18aebf][_0x4270af(0x2c3)]+=_0x42c4d6,_0x596adf[_0x18aebf][_0x4270af(0x27d)]+=_0x26f076,_0x596adf[_0x18aebf][_0x4270af(0x201)]+=_0x552f36,_0x596adf[_0x18aebf]['paymentsCount']++;}catch(_0x5ab869){console[_0x4270af(0x240)](_0x4270af(0x25f)+_0x2ed1db['id']+':',_0x5ab869);}}Object['values'](_0x32361a)[_0x4270af(0x266)](_0x81a2cd=>{const _0x2fa6c0=_0x4270af;_0x81a2cd[_0x2fa6c0(0x258)]=_0x81a2cd[_0x2fa6c0(0x234)]>0x0?_0x81a2cd[_0x2fa6c0(0x261)]/_0x81a2cd['paymentsCount']:0x0,delete _0x81a2cd['totalCommissionRate'];}),Object[_0x4270af(0x268)](_0x360200)[_0x4270af(0x266)](_0x388385=>{const _0x21b505=_0x4270af;_0x388385[_0x21b505(0x2d1)]=_0x388385[_0x21b505(0x234)]>0x0?_0x388385[_0x21b505(0x23d)]/_0x388385[_0x21b505(0x234)]:0x0;});let _0x55864e=0x0,_0x2843e5=0x0;if(_0x25cb38['shopId']){const _0xe22a5a=await database_1['default'][_0x4270af(0x2bf)][_0x4270af(0x214)]({'where':{'shopId':_0x25cb38[_0x4270af(0x1a7)],'status':_0x4270af(0x23c),'createdAt':{'gte':_0x2debc5,'lte':_0x4e0108}},'select':{'amount':!![]}});_0x55864e=_0xe22a5a['reduce']((_0x3d1de4,_0x283896)=>_0x3d1de4+_0x283896[_0x4270af(0x21b)],0x0);const _0x53a936=await database_1[_0x4270af(0x1b9)]['payout'][_0x4270af(0x214)]({'where':{'shopId':_0x25cb38[_0x4270af(0x1a7)],'status':_0x4270af(0x275),'createdAt':{'gte':_0x2debc5,'lte':_0x4e0108}},'select':{'amount':!![]}});_0x2843e5=_0x53a936[_0x4270af(0x1c4)]((_0x4f58fa,_0xdc9bef)=>_0x4f58fa+_0xdc9bef[_0x4270af(0x21b)],0x0);}const _0x3df13c=_0x3201f6,_0x593518=_0x30846e[_0x4270af(0x1a3)],_0x26a4da=_0x593518>0x0?_0x1b6b9f/_0x593518:0x0,_0x1ba1b1=_0x3df13c>0x0?Math[_0x4270af(0x25a)](_0x593518/_0x3df13c*0x2710)/0x64:0x0,_0x3c6c64=Math[_0x4270af(0x1c7)]((_0x4e0108[_0x4270af(0x2c2)]()-_0x2debc5[_0x4270af(0x2c2)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4e5eee={'totalTurnover':Math[_0x4270af(0x25a)](_0x1b6b9f*0x64)/0x64,'merchantEarnings':Math[_0x4270af(0x25a)](_0x737ccf*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1925d8*0x64)/0x64,'totalPaidOut':Math['round'](_0x55864e*0x64)/0x64,'pendingPayout':Math[_0x4270af(0x25a)](_0x2843e5*0x64)/0x64,'averageCheck':Math['round'](_0x26a4da*0x64)/0x64,'totalPayments':_0x3df13c,'successfulPayments':_0x593518,'conversionRate':_0x1ba1b1,'gatewayBreakdown':Object[_0x4270af(0x268)](_0x32361a)['map'](_0x464646=>({..._0x464646,'turnoverUSDT':Math[_0x4270af(0x25a)](_0x464646[_0x4270af(0x23d)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x464646[_0x4270af(0x281)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x464646[_0x4270af(0x295)]*0x64)/0x64,'averageCommissionRate':Math[_0x4270af(0x25a)](_0x464646[_0x4270af(0x258)]*0x64)/0x64})),'merchantBreakdown':_0x25cb38[_0x4270af(0x1a7)]?undefined:Object[_0x4270af(0x268)](_0x360200)[_0x4270af(0x265)](_0x591cf1=>({..._0x591cf1,'turnoverUSDT':Math[_0x4270af(0x25a)](_0x591cf1[_0x4270af(0x23d)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x591cf1['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4270af(0x25a)](_0x591cf1[_0x4270af(0x295)]*0x64)/0x64,'paidOutUSDT':Math[_0x4270af(0x25a)](_0x591cf1[_0x4270af(0x2aa)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x591cf1[_0x4270af(0x2d1)]*0x64)/0x64})),'dailyData':Object['values'](_0x596adf)[_0x4270af(0x265)](_0x160205=>({..._0x160205,'turnover':Math['round'](_0x160205['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x4270af(0x25a)](_0x160205['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x4270af(0x25a)](_0x160205['gatewayEarnings']*0x64)/0x64}))[_0x4270af(0x1f8)]((_0x2d0410,_0x251500)=>_0x2d0410[_0x4270af(0x22b)]['localeCompare'](_0x251500[_0x4270af(0x22b)])),'periodInfo':{'from':_0x2debc5,'to':_0x4e0108,'periodType':_0x25cb38['period']||_0x4270af(0x1fd),'daysCount':_0x3c6c64}};return console['log'](_0x4270af(0x1f3)),console[_0x4270af(0x2af)](_0x4270af(0x1cf)+_0x4e5eee[_0x4270af(0x224)]+_0x4270af(0x28d)),console[_0x4270af(0x2af)](_0x4270af(0x20b)+_0x4e5eee[_0x4270af(0x27d)]+_0x4270af(0x28d)),console['log'](_0x4270af(0x24a)+_0x4e5eee[_0x4270af(0x201)]+_0x4270af(0x28d)),console['log']('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0x4e5eee[_0x4270af(0x197)]+_0x4270af(0x28d)),console[_0x4270af(0x2af)]('\x20\x20\x20⏳\x20Pending\x20payout:\x20'+_0x4e5eee[_0x4270af(0x26b)]+_0x4270af(0x28d)),console[_0x4270af(0x2af)]('\x20\x20\x20�📊\x20Total\x20payments:\x20'+_0x4e5eee['totalPayments']),_0x4e5eee;}async[a36_0x53d968(0x1b0)](){const _0x402fde=a36_0x53d968;console[_0x402fde(0x2af)](_0x402fde(0x1a9));const _0x1c4693=await database_1[_0x402fde(0x1b9)][_0x402fde(0x280)][_0x402fde(0x214)]({'where':{'status':_0x402fde(0x248)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x402fde(0x1c3)}});return console[_0x402fde(0x2af)](_0x402fde(0x1d6)+_0x1c4693[_0x402fde(0x1a3)]+_0x402fde(0x26d)),_0x1c4693['map'](_0xf4ae60=>({'id':_0xf4ae60['id'],'username':_0xf4ae60[_0x402fde(0x19c)],'name':_0xf4ae60[_0x402fde(0x1d2)]}));}['getGatewayDisplayName'](_0x5a8355){const _0x441b3f=a36_0x53d968,_0x5890e3={'test_gateway':_0x441b3f(0x1a0),'plisio':_0x441b3f(0x1e4),'rapyd':_0x441b3f(0x1f5),'noda':_0x441b3f(0x1d3),'cointopay':_0x441b3f(0x27e),'cointopay2':_0x441b3f(0x1f6),'klyme_eu':_0x441b3f(0x1b5),'klyme_gb':'KLYME\x20GB','klyme_de':_0x441b3f(0x1c6),'mastercard':_0x441b3f(0x227)};return _0x5890e3[_0x5a8355]||_0x5a8355;}['getGatewayInternalName'](_0x510ac5){const _0x31e019=a36_0x53d968,_0x2382a2={'Test\x20Gateway':_0x31e019(0x254),'Plisio':_0x31e019(0x2b8),'Rapyd':_0x31e019(0x212),'Noda':_0x31e019(0x228),'CoinToPay':_0x31e019(0x26c),'CoinToPay2':_0x31e019(0x19d),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x31e019(0x243),'KLYME\x20DE':_0x31e019(0x20c),'MasterCard':_0x31e019(0x213)};return _0x2382a2[_0x510ac5]||_0x510ac5[_0x31e019(0x20a)]();}async[a36_0x53d968(0x233)](_0x593ea2){const _0x4241d7=a36_0x53d968,{page:_0x226b8f,limit:_0x591330,minAmount:_0x15bfe8,search:_0x3f8690}=_0x593ea2,_0x5f43f1=(_0x226b8f-0x1)*_0x591330;console[_0x4241d7(0x2af)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x593ea2);const _0x395239={'balance':{'gt':0x0},'status':_0x4241d7(0x248)};_0x15bfe8&&(_0x395239[_0x4241d7(0x2ca)][_0x4241d7(0x27c)]=_0x15bfe8);_0x3f8690&&(_0x395239['OR']=[{'name':{'contains':_0x3f8690,'mode':_0x4241d7(0x1ef)}},{'username':{'contains':_0x3f8690,'mode':'insensitive'}}]);const [_0x19e002,_0x49dfab]=await Promise['all']([database_1[_0x4241d7(0x1b9)][_0x4241d7(0x280)][_0x4241d7(0x214)]({'where':_0x395239,'skip':_0x5f43f1,'take':_0x591330,'orderBy':{'balance':_0x4241d7(0x1c9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x4241d7(0x280)]['count']({'where':_0x395239})]);console['log'](_0x4241d7(0x1ad)+_0x19e002[_0x4241d7(0x1a3)]+_0x4241d7(0x294));const _0x443d6a=await Promise[_0x4241d7(0x29e)](_0x19e002['map'](async _0x176e6b=>{const _0x418824=_0x4241d7,[_0x3f64aa,_0x4a5055,_0x31ec05]=await Promise[_0x418824(0x29e)]([database_1[_0x418824(0x1b9)][_0x418824(0x1de)][_0x418824(0x29f)]({'where':{'shopId':_0x176e6b['id'],'status':'PAID','gateway':{'not':_0x418824(0x254)}}}),database_1[_0x418824(0x1b9)][_0x418824(0x1de)][_0x418824(0x1d5)]({'where':{'shopId':_0x176e6b['id'],'status':_0x418824(0x29d),'gateway':{'not':_0x418824(0x254)}},'orderBy':{'paidAt':_0x418824(0x1c3)},'select':{'paidAt':!![]}}),database_1[_0x418824(0x1b9)]['payment']['groupBy']({'by':[_0x418824(0x20d)],'where':{'shopId':_0x176e6b['id'],'status':_0x418824(0x29d),'gateway':{'not':_0x418824(0x254)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x503f85=new Date(),_0x1c6a24=new Date(_0x503f85['getFullYear'](),_0x503f85[_0x418824(0x22f)](),0x1),_0x213a17=new Date(_0x503f85[_0x418824(0x247)](),_0x503f85[_0x418824(0x22f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x86548,_0x51b2a7]=await Promise[_0x418824(0x29e)]([database_1[_0x418824(0x1b9)][_0x418824(0x2bf)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x176e6b['id'],'status':'COMPLETED'}}),database_1['default'][_0x418824(0x2bf)][_0x418824(0x2a3)]({'_sum':{'amount':!![]},'where':{'shopId':_0x176e6b['id'],'status':_0x418824(0x23c),'createdAt':{'gte':_0x1c6a24,'lte':_0x213a17}}})]),_0x272077=_0x86548[_0x418824(0x1e2)][_0x418824(0x21b)]||0x0,_0x36b623=_0x51b2a7[_0x418824(0x1e2)][_0x418824(0x21b)]||0x0,_0x22251f=await Promise[_0x418824(0x29e)](_0x31ec05[_0x418824(0x265)](async _0x336352=>{const _0x5db409=_0x418824;let _0x4fbc25=0xa;if(_0x176e6b['gatewaySettings'])try{const _0x4d0dfc=JSON['parse'](_0x176e6b['gatewaySettings']);for(const [_0x3b3ef2,_0x298f80]of Object[_0x5db409(0x1dc)](_0x4d0dfc)){if(_0x3b3ef2['toLowerCase']()===_0x336352[_0x5db409(0x20d)][_0x5db409(0x20a)]()){_0x4fbc25=_0x298f80[_0x5db409(0x270)]||0xa,console[_0x5db409(0x2af)](_0x5db409(0x28c)+_0x336352[_0x5db409(0x20d)]+_0x5db409(0x253)+_0x176e6b['id']+_0x5db409(0x1ec)+_0x4fbc25+'%');break;}}}catch(_0x36e15e){console['error'](_0x5db409(0x2b6)+_0x176e6b['id']+':',_0x36e15e);}const _0x40760b=_0x336352[_0x5db409(0x1e2)]?.[_0x5db409(0x1f4)]||0x0,_0x1063ae=_0x40760b*(0x1-_0x4fbc25/0x64);return{'gateway':_0x336352[_0x5db409(0x20d)],'count':_0x336352[_0x5db409(0x18c)]?.['id']||0x0,'amountUSDT':Math[_0x5db409(0x25a)](_0x40760b*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5db409(0x25a)](_0x1063ae*0x64)/0x64,'commission':_0x4fbc25};})),_0x4bdc4e=_0x22251f[_0x418824(0x1c4)]((_0x44ddc2,_0x1882bc)=>_0x44ddc2+_0x1882bc[_0x418824(0x1f4)],0x0),_0x477aae=_0x176e6b['balance'];return console['log'](_0x418824(0x200)+_0x176e6b[_0x418824(0x19c)]+':'),console[_0x418824(0x2af)](_0x418824(0x21f)+_0x4bdc4e[_0x418824(0x1ba)](0x2)+_0x418824(0x208)),console[_0x418824(0x2af)](_0x418824(0x298)+_0x22251f[_0x418824(0x1c4)]((_0x888392,_0x1078a7)=>_0x888392+_0x1078a7[_0x418824(0x2a4)],0x0)[_0x418824(0x1ba)](0x2)+_0x418824(0x206)),console[_0x418824(0x2af)](_0x418824(0x22e)+_0x477aae[_0x418824(0x1ba)](0x2)+_0x418824(0x2bb)),{'id':_0x176e6b['id'],'fullName':_0x176e6b['name'],'username':_0x176e6b[_0x418824(0x19c)],'telegramId':_0x176e6b[_0x418824(0x269)],'merchantUrl':_0x176e6b[_0x418824(0x204)],'wallets':{'usdtPolygonWallet':_0x176e6b[_0x418824(0x1fa)],'usdtTrcWallet':_0x176e6b[_0x418824(0x236)],'usdtErcWallet':_0x176e6b[_0x418824(0x1b6)],'usdcPolygonWallet':_0x176e6b['usdcPolygonWallet']},'totalAmountUSDT':Math['round'](_0x4bdc4e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x418824(0x25a)](_0x477aae*0x64)/0x64,'totalPayout':Math['round'](_0x272077*0x64)/0x64,'thisMonth':Math[_0x418824(0x25a)](_0x36b623*0x64)/0x64,'paymentsCount':_0x3f64aa,'oldestPaymentDate':_0x4a5055?.[_0x418824(0x25d)]||_0x176e6b['createdAt'],'gatewayBreakdown':_0x22251f};})),_0x1e9aff=_0x443d6a[_0x4241d7(0x1c4)]((_0x5cfd29,_0x511397)=>_0x5cfd29+_0x511397['totalAmountUSDT'],0x0),_0x1b0d85=_0x443d6a[_0x4241d7(0x1c4)]((_0xc611f7,_0x2fd240)=>_0xc611f7+_0x2fd240[_0x4241d7(0x220)],0x0),_0x41cffe=_0x443d6a['reduce']((_0x3a482c,_0x2fcba1)=>_0x3a482c+_0x2fcba1[_0x4241d7(0x271)],0x0),_0x5662b8=_0x443d6a['reduce']((_0x3d19d0,_0x2b9011)=>_0x3d19d0+_0x2b9011[_0x4241d7(0x28a)],0x0);return console[_0x4241d7(0x2af)](_0x4241d7(0x1d4)+_0x49dfab+_0x4241d7(0x28f)),console[_0x4241d7(0x2af)](_0x4241d7(0x1e6)+Math['round'](_0x1e9aff*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x4241d7(0x2af)](_0x4241d7(0x274)+Math[_0x4241d7(0x25a)](_0x1b0d85*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console['log'](_0x4241d7(0x23b)+Math[_0x4241d7(0x25a)](_0x41cffe*0x64)/0x64+_0x4241d7(0x28d)),console[_0x4241d7(0x2af)]('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x4241d7(0x25a)](_0x5662b8*0x64)/0x64+_0x4241d7(0x28d)),{'merchants':_0x443d6a,'pagination':{'page':_0x226b8f,'limit':_0x591330,'total':_0x49dfab,'totalPages':Math[_0x4241d7(0x1c7)](_0x49dfab/_0x591330)},'summary':{'totalMerchants':_0x49dfab,'totalAmountUSDT':Math['round'](_0x1e9aff*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4241d7(0x25a)](_0x1b0d85*0x64)/0x64,'totalPayout':Math[_0x4241d7(0x25a)](_0x41cffe*0x64)/0x64,'thisMonth':Math[_0x4241d7(0x25a)](_0x5662b8*0x64)/0x64}};}async[a36_0x53d968(0x25c)](_0x44727e){const _0x1fe3c6=a36_0x53d968,{shopId:_0x1ca133,amount:_0x263d64,network:_0x47957f,wallet:_0x8e7047,notes:_0x11340c,txid:_0x5533c5,periodFrom:_0x555125,periodTo:_0x2c7cf1}=_0x44727e,_0x26c04f=await database_1[_0x1fe3c6(0x1b9)][_0x1fe3c6(0x29c)](async _0x2f87e5=>{const _0x38ee42=_0x1fe3c6,_0x238ed1=await _0x2f87e5[_0x38ee42(0x280)][_0x38ee42(0x2a7)]({'where':{'id':_0x1ca133},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x238ed1)throw new Error(_0x38ee42(0x2c6));console[_0x38ee42(0x2af)](_0x38ee42(0x1fe)+_0x238ed1[_0x38ee42(0x19c)]+':'),console[_0x38ee42(0x2af)](_0x38ee42(0x256)+_0x238ed1[_0x38ee42(0x2ca)][_0x38ee42(0x1ba)](0x6)+_0x38ee42(0x28d)),console[_0x38ee42(0x2af)](_0x38ee42(0x249)+_0x263d64[_0x38ee42(0x1ba)](0x6)+_0x38ee42(0x28d)),console[_0x38ee42(0x2af)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x238ed1[_0x38ee42(0x197)][_0x38ee42(0x1ba)](0x6)+'\x20USDT');if(_0x5533c5)console[_0x38ee42(0x2af)](_0x38ee42(0x1a4)+_0x5533c5);if(_0x238ed1[_0x38ee42(0x2ca)]<_0x263d64)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x238ed1['balance'][_0x38ee42(0x1ba)](0x6)+_0x38ee42(0x1f2)+_0x263d64[_0x38ee42(0x1ba)](0x6)+_0x38ee42(0x28d));let _0x31f025=_0x8e7047;if(!_0x31f025){const _0x4684a0=await _0x2f87e5[_0x38ee42(0x280)]['findUnique']({'where':{'id':_0x1ca133},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4684a0)switch(_0x47957f){case _0x38ee42(0x2c0):_0x31f025=_0x4684a0['usdtPolygonWallet']||undefined;break;case _0x38ee42(0x2bc):_0x31f025=_0x4684a0[_0x38ee42(0x236)]||undefined;break;case _0x38ee42(0x2a5):_0x31f025=_0x4684a0[_0x38ee42(0x1b6)]||undefined;break;case _0x38ee42(0x1b8):_0x31f025=_0x4684a0['usdcPolygonWallet']||undefined;break;}}console['log'](_0x38ee42(0x232)+_0x47957f+':\x20'+(_0x31f025||_0x38ee42(0x2c4)));const _0x3dd582=await _0x2f87e5['payout']['create']({'data':{'shopId':_0x1ca133,'amount':_0x263d64,'network':_0x47957f,'status':_0x38ee42(0x23c),'txid':_0x5533c5,'notes':_0x11340c,'periodFrom':_0x555125?new Date(_0x555125):null,'periodTo':_0x2c7cf1?new Date(_0x2c7cf1):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x184090=_0x238ed1['balance']-_0x263d64,_0x123a75=_0x238ed1[_0x38ee42(0x197)]+_0x263d64;return await _0x2f87e5[_0x38ee42(0x280)][_0x38ee42(0x21e)]({'where':{'id':_0x1ca133},'data':{'balance':_0x184090,'totalPaidOut':_0x123a75}}),console[_0x38ee42(0x2af)]('💰\x20Shop\x20'+_0x238ed1[_0x38ee42(0x19c)]+_0x38ee42(0x24e)),console['log'](_0x38ee42(0x288)+_0x238ed1[_0x38ee42(0x2ca)]['toFixed'](0x6)+_0x38ee42(0x18f)+_0x184090['toFixed'](0x6)+_0x38ee42(0x2cc)+_0x263d64['toFixed'](0x6)+')'),console[_0x38ee42(0x2af)](_0x38ee42(0x194)+_0x238ed1[_0x38ee42(0x197)][_0x38ee42(0x1ba)](0x6)+'\x20->\x20'+_0x123a75[_0x38ee42(0x1ba)](0x6)+_0x38ee42(0x1e1)+_0x263d64[_0x38ee42(0x1ba)](0x6)+')'),{'payout':_0x3dd582,'shop':_0x238ed1};});return console[_0x1fe3c6(0x2af)](_0x1fe3c6(0x18b)+_0x26c04f[_0x1fe3c6(0x2bf)]['id']+_0x1fe3c6(0x253)+_0x26c04f['shop'][_0x1fe3c6(0x19c)]+'\x20('+_0x263d64+_0x1fe3c6(0x2b4)),{'id':_0x26c04f['payout']['id'],'shopId':_0x26c04f[_0x1fe3c6(0x2bf)]['shopId'],'shopName':_0x26c04f[_0x1fe3c6(0x280)]['name'],'shopUsername':_0x26c04f[_0x1fe3c6(0x280)][_0x1fe3c6(0x19c)],'amount':_0x26c04f[_0x1fe3c6(0x2bf)][_0x1fe3c6(0x21b)],'network':_0x26c04f[_0x1fe3c6(0x2bf)][_0x1fe3c6(0x29b)],'status':_0x26c04f[_0x1fe3c6(0x2bf)][_0x1fe3c6(0x19b)],'txid':_0x26c04f[_0x1fe3c6(0x2bf)]['txid'],'notes':_0x26c04f[_0x1fe3c6(0x2bf)][_0x1fe3c6(0x1bf)],'periodFrom':_0x26c04f[_0x1fe3c6(0x2bf)][_0x1fe3c6(0x198)],'periodTo':_0x26c04f['payout'][_0x1fe3c6(0x2c1)],'createdAt':_0x26c04f[_0x1fe3c6(0x2bf)]['createdAt'],'paidAt':_0x26c04f[_0x1fe3c6(0x2bf)][_0x1fe3c6(0x25d)]};}async[a36_0x53d968(0x283)](_0x1e0367){const _0x2968cd=a36_0x53d968,{page:_0xdff25e,limit:_0x484d36,shopId:_0x1fd063,network:_0x572658,dateFrom:_0x32d582,dateTo:_0x1306b8,search:_0x38897c}=_0x1e0367,_0x4b8122=(_0xdff25e-0x1)*_0x484d36,_0x75b1ef={};_0x1fd063&&(_0x75b1ef[_0x2968cd(0x1a7)]=_0x1fd063);_0x572658&&(_0x75b1ef[_0x2968cd(0x29b)]=_0x572658);(_0x32d582||_0x1306b8)&&(_0x75b1ef[_0x2968cd(0x262)]={},_0x32d582&&(_0x75b1ef[_0x2968cd(0x262)][_0x2968cd(0x27c)]=new Date(_0x32d582)),_0x1306b8&&(_0x75b1ef[_0x2968cd(0x262)][_0x2968cd(0x285)]=new Date(_0x1306b8)));_0x38897c&&(_0x75b1ef['OR']=[{'shop':{'name':{'contains':_0x38897c,'mode':_0x2968cd(0x1ef)}}},{'shop':{'username':{'contains':_0x38897c,'mode':_0x2968cd(0x1ef)}}},{'notes':{'contains':_0x38897c,'mode':_0x2968cd(0x1ef)}}]);const [_0x191020,_0x204dd9]=await Promise[_0x2968cd(0x29e)]([database_1[_0x2968cd(0x1b9)][_0x2968cd(0x2bf)][_0x2968cd(0x214)]({'where':_0x75b1ef,'skip':_0x4b8122,'take':_0x484d36,'orderBy':{'createdAt':_0x2968cd(0x1c9)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2968cd(0x1b9)][_0x2968cd(0x2bf)]['count']({'where':_0x75b1ef})]);return{'payouts':_0x191020[_0x2968cd(0x265)](_0x9bc801=>({'id':_0x9bc801['id'],'shopId':_0x9bc801[_0x2968cd(0x1a7)],'shopName':_0x9bc801[_0x2968cd(0x280)][_0x2968cd(0x1d2)],'shopUsername':_0x9bc801[_0x2968cd(0x280)][_0x2968cd(0x19c)],'amount':_0x9bc801['amount'],'network':_0x9bc801[_0x2968cd(0x29b)],'status':_0x9bc801['status'],'txid':_0x9bc801[_0x2968cd(0x1aa)],'notes':_0x9bc801[_0x2968cd(0x1bf)],'periodFrom':_0x9bc801[_0x2968cd(0x198)],'periodTo':_0x9bc801[_0x2968cd(0x2c1)],'createdAt':_0x9bc801[_0x2968cd(0x262)],'paidAt':_0x9bc801[_0x2968cd(0x25d)]})),'pagination':{'page':_0xdff25e,'limit':_0x484d36,'total':_0x204dd9,'totalPages':Math[_0x2968cd(0x1c7)](_0x204dd9/_0x484d36)}};}async['getPayoutById'](_0xd25e0b){const _0x23d87b=a36_0x53d968,_0x5bb6a1=await database_1[_0x23d87b(0x1b9)]['payout']['findUnique']({'where':{'id':_0xd25e0b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5bb6a1)return null;return{'id':_0x5bb6a1['id'],'shopId':_0x5bb6a1[_0x23d87b(0x1a7)],'shopName':_0x5bb6a1[_0x23d87b(0x280)][_0x23d87b(0x1d2)],'shopUsername':_0x5bb6a1[_0x23d87b(0x280)][_0x23d87b(0x19c)],'amount':_0x5bb6a1['amount'],'network':_0x5bb6a1['network'],'status':_0x5bb6a1[_0x23d87b(0x19b)],'txid':_0x5bb6a1[_0x23d87b(0x1aa)],'notes':_0x5bb6a1[_0x23d87b(0x1bf)],'periodFrom':_0x5bb6a1[_0x23d87b(0x198)],'periodTo':_0x5bb6a1[_0x23d87b(0x2c1)],'createdAt':_0x5bb6a1[_0x23d87b(0x262)],'paidAt':_0x5bb6a1[_0x23d87b(0x25d)]};}async['deletePayout'](_0x366d5e){const _0x390a47=a36_0x53d968;await database_1['default'][_0x390a47(0x2bf)][_0x390a47(0x2a2)]({'where':{'id':_0x366d5e}});}async[a36_0x53d968(0x190)](_0x226ff4){const _0x273353=a36_0x53d968,{page:_0x482871,limit:_0xe474dd,status:_0xddb795,gateway:_0x422819,shopId:_0x497c8e,dateFrom:_0x4c824b,dateTo:_0x22c9fa,search:_0x2570a8,currency:_0x340a7e,sortBy:_0x5ddbd6,sortOrder:_0x3b82e4}=_0x226ff4,_0x2d684b=(_0x482871-0x1)*_0xe474dd;console[_0x273353(0x2af)](_0x273353(0x211),_0x226ff4);const _0x544f08=await database_1[_0x273353(0x1b9)]['payment'][_0x273353(0x1fb)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log'](_0x273353(0x242),_0x544f08[_0x273353(0x265)](_0x3a653c=>_0x3a653c[_0x273353(0x20d)]+'\x20('+_0x3a653c['_count'][_0x273353(0x20d)]+_0x273353(0x250)));if(_0x422819){const _0xc25921=_0x544f08[_0x273353(0x27f)](_0x22b31a=>_0x22b31a[_0x273353(0x20d)][_0x273353(0x20a)]()===_0x422819[_0x273353(0x20a)]());!_0xc25921&&_0x422819['toLowerCase']()!==_0x273353(0x254)&&console[_0x273353(0x2af)](_0x273353(0x276)+_0x422819+_0x273353(0x222)+_0x544f08['map'](_0x3e36e4=>_0x3e36e4[_0x273353(0x20d)])['join'](',\x20'));}const _0x39f798={};_0xddb795&&(_0x39f798[_0x273353(0x19b)]=_0xddb795['toUpperCase']());if(!_0x422819)_0x39f798[_0x273353(0x20d)]={'not':_0x273353(0x254)};else{if(_0x422819&&(_0x422819[_0x273353(0x20a)]()===_0x273353(0x254)||_0x422819===_0x273353(0x1d0)))_0x39f798[_0x273353(0x20d)]=_0x273353(0x254);else{let _0x71173d=_0x422819;const _0x25535c=(0x0,gateway_1[_0x273353(0x23a)])(_0x422819);if(_0x25535c)_0x71173d=_0x25535c,console[_0x273353(0x2af)]('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x422819+'\x27\x20to\x20name\x20\x27'+_0x71173d+'\x27');else{const _0x1820db=(0x0,gateway_1[_0x273353(0x2ce)])(_0x422819);if(_0x1820db){const _0x602e08=(0x0,gateway_1['getGatewayNameById'])(_0x1820db);_0x602e08&&(_0x71173d=_0x602e08,console['log'](_0x273353(0x1c5)+_0x422819+'\x27\x20->\x20ID\x20\x27'+_0x1820db+_0x273353(0x2ad)+_0x71173d+'\x27'));}else console['log'](_0x273353(0x229)+_0x422819+_0x273353(0x19f));}const _0x57bd1e=await database_1[_0x273353(0x1b9)]['payment'][_0x273353(0x29f)]({'where':{'gateway':_0x71173d['toLowerCase']()},'take':0x1});_0x57bd1e===0x0?(console[_0x273353(0x2af)](_0x273353(0x22d)+_0x71173d+_0x273353(0x286)+_0x422819+_0x273353(0x293)),_0x39f798[_0x273353(0x20d)]='NONEXISTENT_GATEWAY_FILTER'):(_0x39f798['gateway']=_0x71173d['toLowerCase'](),console[_0x273353(0x2af)](_0x273353(0x2c9)+_0x71173d+'\x27\x20(from\x20\x27'+_0x422819+'\x27)'));}}console['log'](_0x273353(0x296),_0x39f798[_0x273353(0x20d)]);_0x497c8e&&(_0x39f798[_0x273353(0x1a7)]=_0x497c8e);_0x340a7e&&(_0x39f798['currency']=_0x340a7e[_0x273353(0x2b3)](),console[_0x273353(0x2af)](_0x273353(0x1c0)+_0x340a7e[_0x273353(0x2b3)]()));(_0x4c824b||_0x22c9fa)&&(_0x39f798[_0x273353(0x262)]={},_0x4c824b&&(_0x39f798[_0x273353(0x262)]['gte']=new Date(_0x4c824b)),_0x22c9fa&&(_0x39f798['createdAt'][_0x273353(0x285)]=new Date(_0x22c9fa)));_0x2570a8&&(_0x39f798['OR']=[{'id':{'contains':_0x2570a8,'mode':_0x273353(0x1ef)}},{'orderId':{'contains':_0x2570a8,'mode':_0x273353(0x1ef)}},{'gatewayOrderId':{'contains':_0x2570a8,'mode':_0x273353(0x1ef)}},{'customerEmail':{'contains':_0x2570a8,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x2570a8,'mode':_0x273353(0x1ef)}}},{'shop':{'username':{'contains':_0x2570a8,'mode':_0x273353(0x1ef)}}}]);console[_0x273353(0x2af)](_0x273353(0x18e),JSON[_0x273353(0x2c8)](_0x39f798,null,0x2));let _0x110024={'createdAt':_0x273353(0x1c9)};if(_0x5ddbd6){const _0x27cd37=[_0x273353(0x21b),_0x273353(0x262),_0x273353(0x1a5),_0x273353(0x19b),'gateway',_0x273353(0x18d)],_0x580cd9=[_0x273353(0x1c3),'desc'];if(_0x27cd37[_0x273353(0x1ca)](_0x5ddbd6)){const _0x38faed=_0x580cd9['includes'](_0x3b82e4)?_0x3b82e4:_0x273353(0x1c9);_0x110024={[_0x5ddbd6]:_0x38faed},console[_0x273353(0x2af)]('📊\x20Sorting\x20payments\x20by\x20'+_0x5ddbd6+'\x20in\x20'+_0x38faed+_0x273353(0x1e8));}}const [_0x280b21,_0x543ce8]=await Promise['all']([database_1[_0x273353(0x1b9)][_0x273353(0x1de)][_0x273353(0x214)]({'where':_0x39f798,'skip':_0x2d684b,'take':_0xe474dd,'orderBy':_0x110024,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x273353(0x1de)][_0x273353(0x29f)]({'where':_0x39f798})]);return{'payments':_0x280b21,'pagination':{'page':_0x482871,'limit':_0xe474dd,'total':_0x543ce8,'totalPages':Math[_0x273353(0x1c7)](_0x543ce8/_0xe474dd)}};}async[a36_0x53d968(0x2d0)](_0x3d035c){const _0x5486ef=a36_0x53d968,_0x325a5a=await database_1[_0x5486ef(0x1b9)][_0x5486ef(0x1de)]['findUnique']({'where':{'id':_0x3d035c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x325a5a)return null;return{'id':_0x325a5a['id'],'shopId':_0x325a5a['shopId'],'gateway':_0x325a5a[_0x5486ef(0x20d)],'amount':_0x325a5a[_0x5486ef(0x21b)],'currency':_0x325a5a[_0x5486ef(0x18d)],'status':_0x325a5a[_0x5486ef(0x19b)],'orderId':_0x325a5a['orderId'],'gatewayOrderId':_0x325a5a['gatewayOrderId'],'customerEmail':_0x325a5a[_0x5486ef(0x2b2)],'customerName':_0x325a5a[_0x5486ef(0x21d)],'customerCountry':_0x325a5a[_0x5486ef(0x226)],'customerIp':_0x325a5a[_0x5486ef(0x203)],'customerUa':_0x325a5a[_0x5486ef(0x245)],'failureMessage':_0x325a5a[_0x5486ef(0x231)],'externalPaymentUrl':_0x325a5a[_0x5486ef(0x1ae)],'successUrl':_0x325a5a[_0x5486ef(0x291)],'failUrl':_0x325a5a[_0x5486ef(0x2c7)],'pendingUrl':_0x325a5a[_0x5486ef(0x2b5)],'whiteUrl':_0x325a5a[_0x5486ef(0x1dd)],'createdAt':_0x325a5a[_0x5486ef(0x262)],'updatedAt':_0x325a5a[_0x5486ef(0x1a5)],'shop':_0x325a5a[_0x5486ef(0x280)]};}async['updatePaymentStatus'](_0x5505eb,_0x684e71,_0x1c7444,_0x1950de){const _0x4be603=a36_0x53d968,_0x159a6a=await database_1[_0x4be603(0x1b9)][_0x4be603(0x29c)](async _0x461b5f=>{const _0x48762a=_0x4be603,_0x2e1b07=await _0x461b5f[_0x48762a(0x1de)]['findUnique']({'where':{'id':_0x5505eb},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2e1b07)throw new Error('Payment\x20not\x20found');const _0x295d5e=_0x2e1b07[_0x48762a(0x19b)],_0x4bbea2=_0x684e71[_0x48762a(0x2b3)]();console[_0x48762a(0x2af)](_0x48762a(0x215)+_0x5505eb+_0x48762a(0x241)+_0x295d5e+_0x48762a(0x18f)+_0x4bbea2),console[_0x48762a(0x2af)](_0x48762a(0x2ae)+_0x2e1b07[_0x48762a(0x280)]['balance']+_0x48762a(0x28d));const _0x573289={'status':_0x4bbea2,'updatedAt':new Date(),'statusChangedBy':_0x48762a(0x202),'statusChangedAt':new Date()};_0x1c7444&&(_0x573289[_0x48762a(0x239)]=_0x1c7444);_0x4bbea2===_0x48762a(0x191)&&_0x1950de&&(_0x573289[_0x48762a(0x1ed)]=_0x1950de);let _0x596825=0x0,_0x514aa8=_0x2e1b07[_0x48762a(0x280)][_0x48762a(0x2ca)];if(_0x4bbea2==='PAID'&&_0x295d5e!==_0x48762a(0x29d)){_0x573289[_0x48762a(0x25d)]=new Date();const _0x37b872=await currencyService_1[_0x48762a(0x1db)]['convertToUSDT'](_0x2e1b07['amount'],_0x2e1b07[_0x48762a(0x18d)]);_0x573289[_0x48762a(0x1f4)]=_0x37b872;let _0x496d46=0xa;const _0x34bcca=await _0x461b5f['shop'][_0x48762a(0x2a7)]({'where':{'id':_0x2e1b07[_0x48762a(0x1a7)]},'select':{'gatewaySettings':!![]}});if(_0x34bcca?.[_0x48762a(0x1fc)])try{const _0x33c8c7=JSON[_0x48762a(0x26e)](_0x34bcca[_0x48762a(0x1fc)]);for(const [_0x2b675f,_0x1efcf1]of Object[_0x48762a(0x1dc)](_0x33c8c7)){if(_0x2b675f[_0x48762a(0x20a)]()===_0x2e1b07[_0x48762a(0x20d)][_0x48762a(0x20a)]()){_0x496d46=_0x1efcf1[_0x48762a(0x270)]||0xa;break;}}}catch(_0x3b62f9){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x5505eb+':',_0x3b62f9);}let _0x26326c;_0x2e1b07[_0x48762a(0x218)]!==null&&_0x2e1b07[_0x48762a(0x218)]!==undefined?(_0x26326c=_0x2e1b07[_0x48762a(0x218)],console[_0x48762a(0x2af)](_0x48762a(0x1b1)+_0x26326c[_0x48762a(0x1ba)](0x6)+_0x48762a(0x217)+_0x5505eb)):(_0x26326c=_0x37b872*(0x1-_0x496d46/0x64),console['log'](_0x48762a(0x1c1)+_0x5505eb+':\x20'+_0x496d46+_0x48762a(0x2c5)+_0x37b872[_0x48762a(0x1ba)](0x6)+_0x48762a(0x28d)),_0x573289['amountAfterGatewayCommissionUSDT']=_0x26326c),_0x596825=_0x26326c,_0x514aa8+=_0x26326c,console['log'](_0x48762a(0x267)+_0x5505eb+_0x48762a(0x21c)),console[_0x48762a(0x2af)](_0x48762a(0x297)+_0x37b872[_0x48762a(0x1ba)](0x6)+_0x48762a(0x28d)),console[_0x48762a(0x2af)](_0x48762a(0x2b1)+_0x2e1b07[_0x48762a(0x20d)]+',\x20Commission:\x20'+_0x496d46+'%'),console[_0x48762a(0x2af)](_0x48762a(0x209)+_0x26326c[_0x48762a(0x1ba)](0x6)+_0x48762a(0x193)+_0x496d46+_0x48762a(0x272)),console[_0x48762a(0x2af)](_0x48762a(0x257)+_0x26326c[_0x48762a(0x1ba)](0x6)+_0x48762a(0x28d));}else{if(_0x295d5e===_0x48762a(0x29d)&&_0x4bbea2!==_0x48762a(0x29d)){if(_0x2e1b07['amountUSDT']){let _0x59524d=0xa;const _0x21fa19=await _0x461b5f['shop'][_0x48762a(0x2a7)]({'where':{'id':_0x2e1b07['shopId']},'select':{'gatewaySettings':!![]}});if(_0x21fa19?.[_0x48762a(0x1fc)])try{const _0x4bb359=JSON[_0x48762a(0x26e)](_0x21fa19[_0x48762a(0x1fc)]);for(const [_0x3036de,_0x53cd08]of Object[_0x48762a(0x1dc)](_0x4bb359)){if(_0x3036de[_0x48762a(0x20a)]()===_0x2e1b07[_0x48762a(0x20d)][_0x48762a(0x20a)]()){_0x59524d=_0x53cd08[_0x48762a(0x270)]||0xa;break;}}}catch(_0x21a0c4){console[_0x48762a(0x240)](_0x48762a(0x1ff)+_0x5505eb+':',_0x21a0c4);}const _0x149e7f=_0x2e1b07[_0x48762a(0x1f4)]*(0x1-_0x59524d/0x64);_0x596825=-_0x149e7f,_0x514aa8-=_0x149e7f,_0x573289[_0x48762a(0x1f4)]=null,_0x573289[_0x48762a(0x218)]=null,console[_0x48762a(0x2af)](_0x48762a(0x267)+_0x5505eb+_0x48762a(0x210)),console[_0x48762a(0x2af)](_0x48762a(0x297)+_0x2e1b07[_0x48762a(0x1f4)][_0x48762a(0x1ba)](0x6)+_0x48762a(0x28d)),console[_0x48762a(0x2af)](_0x48762a(0x2b1)+_0x2e1b07[_0x48762a(0x20d)]+_0x48762a(0x2bd)+_0x59524d+'%'),console[_0x48762a(0x2af)](_0x48762a(0x278)+_0x149e7f[_0x48762a(0x1ba)](0x6)+_0x48762a(0x193)+_0x59524d+'%\x20commission)'),console[_0x48762a(0x2af)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x149e7f['toFixed'](0x6)+_0x48762a(0x28d));}}}_0x4bbea2===_0x48762a(0x191)&&(_0x295d5e==='PAID'&&_0x2e1b07['amountUSDT']&&console[_0x48762a(0x2af)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x1950de&&_0x1950de>0x0&&(_0x596825-=_0x1950de,_0x514aa8-=_0x1950de,console[_0x48762a(0x2af)](_0x48762a(0x260)+_0x1950de['toFixed'](0x6)+_0x48762a(0x26a))));_0x4bbea2===_0x48762a(0x2ab)&&_0x295d5e===_0x48762a(0x29d)&&console[_0x48762a(0x2af)](_0x48762a(0x24c));const _0x26c0c7=await _0x461b5f[_0x48762a(0x1de)][_0x48762a(0x21e)]({'where':{'id':_0x5505eb},'data':_0x573289,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x596825!==0x0&&(await _0x461b5f[_0x48762a(0x280)]['update']({'where':{'id':_0x2e1b07[_0x48762a(0x1a7)]},'data':{'balance':_0x514aa8}}),console['log'](_0x48762a(0x18a)+_0x2e1b07[_0x48762a(0x1a7)]+'\x20balance\x20updated:\x20'+_0x2e1b07[_0x48762a(0x280)][_0x48762a(0x2ca)][_0x48762a(0x1ba)](0x6)+_0x48762a(0x18f)+_0x514aa8[_0x48762a(0x1ba)](0x6)+_0x48762a(0x1bd)+(_0x596825>0x0?'+':'')+_0x596825[_0x48762a(0x1ba)](0x6)+')')),_0x26c0c7;});return{'id':_0x159a6a['id'],'shopId':_0x159a6a[_0x4be603(0x1a7)],'gateway':_0x159a6a[_0x4be603(0x20d)],'amount':_0x159a6a['amount'],'currency':_0x159a6a['currency'],'status':_0x159a6a[_0x4be603(0x19b)],'orderId':_0x159a6a[_0x4be603(0x1a1)],'gatewayOrderId':_0x159a6a[_0x4be603(0x1ac)],'customerEmail':_0x159a6a[_0x4be603(0x2b2)],'customerName':_0x159a6a[_0x4be603(0x21d)],'customerCountry':_0x159a6a[_0x4be603(0x226)],'customerIp':_0x159a6a['customerIp'],'customerUa':_0x159a6a[_0x4be603(0x245)],'failureMessage':_0x159a6a[_0x4be603(0x231)],'adminNotes':_0x159a6a[_0x4be603(0x239)],'chargebackAmount':_0x159a6a[_0x4be603(0x1ed)],'statusChangedBy':_0x159a6a[_0x4be603(0x192)],'statusChangedAt':_0x159a6a[_0x4be603(0x255)],'createdAt':_0x159a6a['createdAt'],'updatedAt':_0x159a6a[_0x4be603(0x1a5)],'shop':_0x159a6a[_0x4be603(0x280)]};}async[a36_0x53d968(0x1d1)](_0x48fdbc,_0x114c63){const _0x262e7c=a36_0x53d968,_0x463887=Math[_0x262e7c(0x1f9)]()['toString'](0x24)['substr'](0x2,0x9);console[_0x262e7c(0x2af)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x463887+_0x262e7c(0x2b7)+_0x48fdbc);const _0x446808={..._0x114c63};_0x114c63[_0x262e7c(0x1ea)]&&_0x114c63[_0x262e7c(0x1ea)][_0x262e7c(0x1a2)]()!==''?(console['log'](_0x262e7c(0x24f)+_0x463887+_0x262e7c(0x238)+_0x48fdbc),_0x446808[_0x262e7c(0x1ea)]=await bcryptjs_1['default'][_0x262e7c(0x1b7)](_0x114c63[_0x262e7c(0x1ea)],0xc)):(console['log']('🔐\x20['+_0x463887+_0x262e7c(0x2cf)),delete _0x446808['password']);_0x114c63['fullName']&&(_0x446808['name']=_0x114c63[_0x262e7c(0x292)],delete _0x446808['fullName']);_0x114c63[_0x262e7c(0x2b9)]&&(_0x446808['telegram']=_0x114c63[_0x262e7c(0x2b9)],delete _0x446808[_0x262e7c(0x2b9)]);_0x114c63[_0x262e7c(0x20f)]&&(_0x446808[_0x262e7c(0x204)]=_0x114c63[_0x262e7c(0x20f)],delete _0x446808['merchantUrl']);if(_0x114c63[_0x262e7c(0x2a1)]){const _0x2c5683=_0x114c63['gateways'][_0x262e7c(0x265)](_0x25bbbf=>this['getGatewayInternalName'](_0x25bbbf));console[_0x262e7c(0x2af)]('🔄\x20Gateway\x20mapping:',_0x114c63[_0x262e7c(0x2a1)],'->',_0x2c5683),_0x446808['paymentGateways']=JSON[_0x262e7c(0x2c8)](_0x2c5683),delete _0x446808['gateways'];}_0x114c63['gatewaySettings']&&(console[_0x262e7c(0x2af)](_0x262e7c(0x1b3)+_0x463887+_0x262e7c(0x2a9),_0x114c63[_0x262e7c(0x1fc)]),_0x446808[_0x262e7c(0x1fc)]=JSON['stringify'](_0x114c63[_0x262e7c(0x1fc)]),console[_0x262e7c(0x2af)](_0x262e7c(0x1b3)+_0x463887+_0x262e7c(0x28e),_0x446808[_0x262e7c(0x1fc)]));_0x114c63[_0x262e7c(0x20e)]&&(_0x114c63[_0x262e7c(0x20e)]['usdtPolygonWallet']!==undefined&&(_0x446808['usdtPolygonWallet']=_0x114c63[_0x262e7c(0x20e)][_0x262e7c(0x1fa)]||null),_0x114c63[_0x262e7c(0x20e)][_0x262e7c(0x236)]!==undefined&&(_0x446808[_0x262e7c(0x236)]=_0x114c63[_0x262e7c(0x20e)][_0x262e7c(0x236)]||null),_0x114c63['wallets'][_0x262e7c(0x1b6)]!==undefined&&(_0x446808[_0x262e7c(0x1b6)]=_0x114c63[_0x262e7c(0x20e)][_0x262e7c(0x1b6)]||null),_0x114c63[_0x262e7c(0x20e)][_0x262e7c(0x1e5)]!==undefined&&(_0x446808[_0x262e7c(0x1e5)]=_0x114c63['wallets'][_0x262e7c(0x1e5)]||null),delete _0x446808[_0x262e7c(0x20e)]);const _0x559372=await database_1['default'][_0x262e7c(0x280)][_0x262e7c(0x21e)]({'where':{'id':_0x48fdbc},'data':_0x446808,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x262e7c(0x205)+_0x463887+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x559372[_0x262e7c(0x1fc)]),{'id':_0x559372['id'],'fullName':_0x559372[_0x262e7c(0x1d2)],'username':_0x559372['username'],'telegramId':_0x559372[_0x262e7c(0x269)],'merchantUrl':_0x559372[_0x262e7c(0x204)],'gateways':_0x559372['paymentGateways']?JSON[_0x262e7c(0x26e)](_0x559372[_0x262e7c(0x2a0)]):null,'gatewaySettings':_0x559372[_0x262e7c(0x1fc)]?JSON[_0x262e7c(0x26e)](_0x559372['gatewaySettings']):null,'publicKey':_0x559372[_0x262e7c(0x235)],'wallets':{'usdtPolygonWallet':_0x559372[_0x262e7c(0x1fa)],'usdtTrcWallet':_0x559372[_0x262e7c(0x236)],'usdtErcWallet':_0x559372[_0x262e7c(0x1b6)],'usdcPolygonWallet':_0x559372[_0x262e7c(0x1e5)]},'status':_0x559372[_0x262e7c(0x19b)],'createdAt':_0x559372[_0x262e7c(0x262)]};}async[a36_0x53d968(0x1a8)](_0x531e09){const _0x241d61=a36_0x53d968,_0x10f3ae=await database_1[_0x241d61(0x1b9)][_0x241d61(0x280)][_0x241d61(0x21e)]({'where':{'id':_0x531e09},'data':{'status':_0x241d61(0x219)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x10f3ae['id'],'fullName':_0x10f3ae['name'],'username':_0x10f3ae[_0x241d61(0x19c)],'telegramId':_0x10f3ae['telegram'],'merchantUrl':_0x10f3ae[_0x241d61(0x204)],'gateways':_0x10f3ae[_0x241d61(0x2a0)]?JSON[_0x241d61(0x26e)](_0x10f3ae[_0x241d61(0x2a0)]):null,'gatewaySettings':_0x10f3ae[_0x241d61(0x1fc)]?JSON[_0x241d61(0x26e)](_0x10f3ae[_0x241d61(0x1fc)]):null,'publicKey':_0x10f3ae['publicKey'],'wallets':{'usdtPolygonWallet':_0x10f3ae[_0x241d61(0x1fa)],'usdtTrcWallet':_0x10f3ae[_0x241d61(0x236)],'usdtErcWallet':_0x10f3ae[_0x241d61(0x1b6)],'usdcPolygonWallet':_0x10f3ae[_0x241d61(0x1e5)]},'status':_0x10f3ae['status'],'createdAt':_0x10f3ae[_0x241d61(0x262)]};}async[a36_0x53d968(0x1d8)](_0x497bbe){const _0x4f8c86=a36_0x53d968,_0x287a09=await database_1[_0x4f8c86(0x1b9)][_0x4f8c86(0x280)][_0x4f8c86(0x21e)]({'where':{'id':_0x497bbe},'data':{'status':_0x4f8c86(0x248)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x287a09['id'],'fullName':_0x287a09[_0x4f8c86(0x1d2)],'username':_0x287a09[_0x4f8c86(0x19c)],'telegramId':_0x287a09[_0x4f8c86(0x269)],'merchantUrl':_0x287a09[_0x4f8c86(0x204)],'gateways':_0x287a09[_0x4f8c86(0x2a0)]?JSON[_0x4f8c86(0x26e)](_0x287a09['paymentGateways']):null,'gatewaySettings':_0x287a09[_0x4f8c86(0x1fc)]?JSON[_0x4f8c86(0x26e)](_0x287a09[_0x4f8c86(0x1fc)]):null,'publicKey':_0x287a09['publicKey'],'wallets':{'usdtPolygonWallet':_0x287a09[_0x4f8c86(0x1fa)],'usdtTrcWallet':_0x287a09[_0x4f8c86(0x236)],'usdtErcWallet':_0x287a09['usdtErcWallet'],'usdcPolygonWallet':_0x287a09[_0x4f8c86(0x1e5)]},'status':_0x287a09[_0x4f8c86(0x19b)],'createdAt':_0x287a09[_0x4f8c86(0x262)]};}async[a36_0x53d968(0x27a)](_0x349f97){const _0x5e288c=a36_0x53d968,{page:_0x3be98d,limit:_0x44fa83,status:_0x1c2fba}=_0x349f97,_0x1e4cca=(_0x3be98d-0x1)*_0x44fa83,_0x53ae18={};_0x1c2fba&&(_0x53ae18[_0x5e288c(0x19b)]=_0x1c2fba[_0x5e288c(0x2b3)]());const [_0x268f9c,_0x4d49e1]=await Promise[_0x5e288c(0x29e)]([database_1['default'][_0x5e288c(0x280)][_0x5e288c(0x214)]({'where':_0x53ae18,'skip':_0x1e4cca,'take':_0x44fa83,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5e288c(0x1b9)]['shop']['count']({'where':_0x53ae18})]);return{'users':_0x268f9c[_0x5e288c(0x265)](_0x3db0b7=>{const _0x1690c8=_0x5e288c,_0x1b0848=_0x3db0b7[_0x1690c8(0x2a0)]?JSON['parse'](_0x3db0b7[_0x1690c8(0x2a0)]):null,_0x15ca38=_0x1b0848?_0x1b0848['map'](_0x424a12=>this['getGatewayDisplayName'](_0x424a12)):null;return{'id':_0x3db0b7['id'],'fullName':_0x3db0b7[_0x1690c8(0x1d2)],'username':_0x3db0b7[_0x1690c8(0x19c)],'telegramId':_0x3db0b7[_0x1690c8(0x269)],'merchantUrl':_0x3db0b7[_0x1690c8(0x204)],'gateways':_0x15ca38,'gatewaySettings':_0x3db0b7['gatewaySettings']?JSON[_0x1690c8(0x26e)](_0x3db0b7[_0x1690c8(0x1fc)]):null,'publicKey':_0x3db0b7['publicKey'],'wallets':{'usdtPolygonWallet':_0x3db0b7['usdtPolygonWallet'],'usdtTrcWallet':_0x3db0b7[_0x1690c8(0x236)],'usdtErcWallet':_0x3db0b7[_0x1690c8(0x1b6)],'usdcPolygonWallet':_0x3db0b7[_0x1690c8(0x1e5)]},'status':_0x3db0b7[_0x1690c8(0x19b)],'createdAt':_0x3db0b7[_0x1690c8(0x262)]};}),'pagination':{'page':_0x3be98d,'limit':_0x44fa83,'total':_0x4d49e1,'totalPages':Math[_0x5e288c(0x1c7)](_0x4d49e1/_0x44fa83)}};}async[a36_0x53d968(0x22a)](_0x1ecc9d){const _0x11f95a=a36_0x53d968,_0x22722f=await database_1['default']['shop']['findUnique']({'where':{'id':_0x1ecc9d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x22722f)return null;const _0xeb0ab2=_0x22722f[_0x11f95a(0x2a0)]?JSON['parse'](_0x22722f[_0x11f95a(0x2a0)]):null,_0x5104a4=_0xeb0ab2?_0xeb0ab2[_0x11f95a(0x265)](_0x1f2f96=>this[_0x11f95a(0x19a)](_0x1f2f96)):null;return _0xeb0ab2&&_0x5104a4&&console[_0x11f95a(0x2af)](_0x11f95a(0x259),_0xeb0ab2,'->',_0x5104a4),{'id':_0x22722f['id'],'fullName':_0x22722f['name'],'username':_0x22722f['username'],'telegramId':_0x22722f[_0x11f95a(0x269)],'merchantUrl':_0x22722f[_0x11f95a(0x204)],'gateways':_0x5104a4,'gatewaySettings':_0x22722f[_0x11f95a(0x1fc)]?JSON[_0x11f95a(0x26e)](_0x22722f[_0x11f95a(0x1fc)]):null,'publicKey':_0x22722f['publicKey'],'wallets':{'usdtPolygonWallet':_0x22722f[_0x11f95a(0x1fa)],'usdtTrcWallet':_0x22722f[_0x11f95a(0x236)],'usdtErcWallet':_0x22722f['usdtErcWallet'],'usdcPolygonWallet':_0x22722f['usdcPolygonWallet']},'status':_0x22722f[_0x11f95a(0x19b)],'createdAt':_0x22722f[_0x11f95a(0x262)]};}async[a36_0x53d968(0x2ac)](_0x2c933e){const _0x17fcb6=a36_0x53d968,{fullName:_0x3c08bf,username:_0x2b8321,password:_0x4ecb1d,telegramId:_0x3a3293,merchantUrl:_0x2a9c80,gateways:_0x4f40c8,gatewaySettings:_0x3f3922,wallets:_0x5b2c62}=_0x2c933e,_0xb4b3d2=await database_1[_0x17fcb6(0x1b9)][_0x17fcb6(0x280)][_0x17fcb6(0x2a7)]({'where':{'username':_0x2b8321}});if(_0xb4b3d2)throw new Error(_0x17fcb6(0x1df));if(_0x3a3293){const _0x3b48b7=await database_1[_0x17fcb6(0x1b9)][_0x17fcb6(0x280)][_0x17fcb6(0x2a7)]({'where':{'telegram':_0x3a3293}});if(_0x3b48b7)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x2e09a4=await bcryptjs_1['default'][_0x17fcb6(0x1b7)](_0x4ecb1d,0xc),_0x1e5bf9=_0x17fcb6(0x237)+crypto_1[_0x17fcb6(0x1b9)][_0x17fcb6(0x1e0)](0x20)[_0x17fcb6(0x284)]('hex'),_0x39886e=_0x17fcb6(0x25e)+crypto_1[_0x17fcb6(0x1b9)][_0x17fcb6(0x1e0)](0x20)[_0x17fcb6(0x284)](_0x17fcb6(0x289)),_0x52203a=_0x4f40c8?_0x4f40c8[_0x17fcb6(0x265)](_0x162c5e=>this[_0x17fcb6(0x28b)](_0x162c5e)):null;_0x4f40c8&&_0x52203a&&console['log']('🔄\x20Gateway\x20mapping\x20(create):',_0x4f40c8,'->',_0x52203a);const _0x14d212=await database_1[_0x17fcb6(0x1b9)][_0x17fcb6(0x280)][_0x17fcb6(0x2a8)]({'data':{'name':_0x3c08bf,'username':_0x2b8321,'password':_0x2e09a4,'telegram':_0x3a3293,'shopUrl':_0x2a9c80,'paymentGateways':_0x52203a?JSON[_0x17fcb6(0x2c8)](_0x52203a):null,'gatewaySettings':_0x3f3922?JSON['stringify'](_0x3f3922):null,'usdtPolygonWallet':_0x5b2c62?.[_0x17fcb6(0x1fa)]||null,'usdtTrcWallet':_0x5b2c62?.[_0x17fcb6(0x236)]||null,'usdtErcWallet':_0x5b2c62?.[_0x17fcb6(0x1b6)]||null,'usdcPolygonWallet':_0x5b2c62?.['usdcPolygonWallet']||null,'publicKey':_0x1e5bf9,'secretKey':_0x39886e,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x14d212['id'],'fullName':_0x14d212[_0x17fcb6(0x1d2)],'username':_0x14d212['username'],'telegramId':_0x14d212[_0x17fcb6(0x269)],'merchantUrl':_0x14d212[_0x17fcb6(0x204)],'gateways':_0x14d212[_0x17fcb6(0x2a0)]?JSON[_0x17fcb6(0x26e)](_0x14d212[_0x17fcb6(0x2a0)]):null,'gatewaySettings':_0x14d212[_0x17fcb6(0x1fc)]?JSON[_0x17fcb6(0x26e)](_0x14d212[_0x17fcb6(0x1fc)]):null,'publicKey':_0x14d212['publicKey'],'wallets':{'usdtPolygonWallet':_0x14d212['usdtPolygonWallet'],'usdtTrcWallet':_0x14d212[_0x17fcb6(0x236)],'usdtErcWallet':_0x14d212[_0x17fcb6(0x1b6)],'usdcPolygonWallet':_0x14d212['usdcPolygonWallet']},'status':_0x14d212[_0x17fcb6(0x19b)],'createdAt':_0x14d212['createdAt']};}async['deleteUser'](_0x77027f){const _0x1a4421=a36_0x53d968;await database_1[_0x1a4421(0x1b9)]['shop'][_0x1a4421(0x2a2)]({'where':{'id':_0x77027f}});}['generateDailyStatistics'](_0x561b62,_0x4cca30,_0x201a4f){const _0x1185e7=a36_0x53d968,_0x1f0ca9=new Map(),_0x3bbe35=new Date(_0x4cca30);while(_0x3bbe35<=_0x201a4f){const _0x4b9135=_0x3bbe35[_0x1185e7(0x1be)]()[_0x1185e7(0x1f7)]('T')[0x0];_0x1f0ca9[_0x1185e7(0x246)](_0x4b9135,{'revenue':0x0,'count':0x0}),_0x3bbe35[_0x1185e7(0x21a)](_0x3bbe35[_0x1185e7(0x27b)]()+0x1);}for(const _0x53029a of _0x561b62){const _0x3a7c59=_0x53029a['createdAt'][_0x1185e7(0x1be)]()['split']('T')[0x0],_0x2b0748=_0x1f0ca9[_0x1185e7(0x2ba)](_0x3a7c59);_0x2b0748&&(_0x2b0748[_0x1185e7(0x29f)]+=0x1,_0x53029a[_0x1185e7(0x19b)]===_0x1185e7(0x29d)&&(_0x53029a['amountUSDT']?_0x2b0748[_0x1185e7(0x273)]+=_0x53029a['amountUSDT']:console['log'](_0x1185e7(0x1a6)+_0x53029a['id']+_0x1185e7(0x1c8))));}const _0x53f8af=[],_0x251fe1=[];for(const [_0x523183,_0x2dc97b]of _0x1f0ca9){_0x53f8af['push']({'date':_0x523183,'amount':Math['round'](_0x2dc97b['revenue']*0x64)/0x64}),_0x251fe1['push']({'date':_0x523183,'count':_0x2dc97b[_0x1185e7(0x29f)]});}return{'dailyRevenue':_0x53f8af,'dailyPayments':_0x251fe1};}}exports[a36_0x53d968(0x25b)]=AdminService;