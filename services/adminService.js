'use strict';const a35_0x628281=a35_0x493d;function a35_0x3b76(){const _0x362b83=['\x20\x20\x20üìÖ\x20This\x20month:\x20','merchantUrl','gatewaySettings','failureMessage','NOT\x20FOUND','default','suspendUser','fullName','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','amount','\x20\x20\x20Total\x20payments:\x20','üìä\x20Shop\x20info\x20for\x20','getMerchantsSelection','\x20balance\x20updated:\x20','$transaction','createUser','totalPaidOut','\x20USDT\x20(+','reduce','2915760zKcRku','üí∞\x20Payment\x20','totalPayout','KLYME\x20DE','name','getAllPayouts','‚úÖ\x20Payout\x20created:\x20','üí∞\x20[DAILY]\x20Added\x20','\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20','notes','\x20\x20\x20üåê\x20IP:\x20','randomBytes','balance','getMerchantsAwaitingPayout','\x20payments,\x20returning\x20','averageCommissionRate','_sum','getUserById','toLowerCase','ACTIVE','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','test','currency','telegramId','\x20for\x20shop\x20','\x20USDT\x20for\x20','getGatewayDisplayName','üìä\x20Merchant\x20statistics\x20calculated:','\x20USDT\x20(-','Noda','merchantEarnings','string','23892219uDugMf','toString','\x20\x20\x20Raw\x20gatewaySettings:\x20','paymentsCount','telegram','generateDailyStatistics','\x20to\x20','formatNetworkName','error','\x20no\x20longer\x20PAID:\x20-','getMerchantStatistics','toUpperCase','../types/gateway','üìä\x20[ADMIN]\x20Status\x20breakdown:','üí∞\x20Found\x20','\x20\x20\x20Payout\x20amount:\x20','\x20USDT)','1041CivjmF','SUSPENDED','üí∞\x20Current\x20shop\x20balance:\x20','remitterIban','../config/database','status','Username\x20already\x20exists','Telegram\x20username\x20already\x20exists','KLYME\x20EU','count','getMonth','\x20merchants,\x20','map','averageCheckUSDT','log','Error\x20processing\x20payment\x20','values','updatedAt','üìä\x20Merchants\x20awaiting\x20payout:\x20','üîç\x20Admin\x20getAllPayments\x20query\x20filters:','parse','REFUND','\x20\x20\x20Commission\x20from\x20settings:\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','chargebackAmount','aggregate','üîç\x20Admin\x20payments\x20filter:\x20Converting\x20gateway\x20ID\x20','\x20\x20\x20‚úÖ\x20Successful\x20payments:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','toFixed','üìä\x20First\x20payment\x20gateway:\x20','updateUser','\x20payments\x20found','üîç\x20Search\x20term:\x20\x22','Amer\x20Master','gatewayOrderId','üîÑ\x20Admin\x20updating\x20payment\x20','keys','\x20as-is','bcryptjs','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','groupBy','987684uFzoAa','custom','whiteUrl','updatePaymentStatus','üîç\x20Admin\x20payments\x20filter:\x20Using\x20gateway\x20name\x20','\x20USDT\x20for\x20payment\x20on\x20','turnoverUSDT','length','insensitive','delete','createdAt','üìä\x20All-time\x20statistics\x20from\x20first\x20payment:\x20','customerUa','bankId','CoinToPay','customerIp','get','externalPaymentUrl','toISOString','INACTIVE','paidOutUSDT','USDT\x20TRC20','üìÖ\x20Period:\x20','activateUser','set','7181280pIUJPx','\x20\x20\x20Parsed\x20gatewaySettings:','CHARGEBACK','dailyRevenue','\x20\x20\x20Gateway\x20key\x20found:\x20','üìä\x20[DAILY]\x20Processed\x20','ceil','gateway','üìä\x20Calculating\x20payout\x20statistics...','\x20\x20\x20Successful\x20payments:\x20','\x20\x20\x20Gateway:\x20','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','desc','üìã\x20Payment\x20details:\x20ID=','sk_','period','lte','\x20USDT\x20(','commission','\x20->\x20','password','periodFrom','split','stringify','\x20USDT\x20(same\x20as\x20awaiting)','üìä\x20[ADMIN]\x20Period:\x20','totalPayments','convertToUSDT','publicKey','__esModule','test_gateway','\x20\x20\x20Current\x20balance:\x20','\x20commission\x20analysis:','pk_','USDT\x20ERC20','commissionUSDT','totalCommissionRate','FOUND','\x20payments\x20for\x20daily\x20statistics','7NWcIBv','üìä\x20Payout\x20statistics\x20calculated:','\x20items','\x20USDT','successUrl','\x20\x20\x20üìà\x20Conversion\x20rate:\x20','getTime','2020-01-01','üí±\x20[DAILY]\x20Converted\x20','dateTo','\x20for\x20payment\x20on\x20','usdtTrcWallet','1092754ffieOe','AdminService','USDT\x20Polygon','currencyService','PAID','customerCountry','username','push','availableBalance','\x20\x20\x20üíµ\x20Available\x20balance:\x20','localeCompare','awaitingPayout','\x20USDT,\x20Requested:\x20','getFullYear','gatewayEarnings','txid','üîç\x20Direct\x20payment\x20check\x20for\x20ID\x20\x22','getSystemStatistics','Rapyd','5414TaCSYn','payment','\x20\x20\x20Name:\x20','üìä\x20[ADMIN]\x20Processing\x20','üîç\x20Search\x20results:\x20','cardLast4','revenue','Payment\x20not\x20found','remitterName','üìä\x20Conversion\x20rate\x20calculation:','conversionRate','amountUSDT','gte','4706616MHKxdi','__importDefault','usdcPolygonWallet','hex','periodTo','gateways','dateFrom','shop','findUnique','update','\x20USDT\x20from\x20balance','\x20\x20\x20üìä\x20Total\x20payments:\x20','\x20total','asc','üí∞\x20Shop\x20','COMPLETED','USDC\x20Polygon','round','\x20USDT\x20total','\x20balance\x20updated:','\x20\x20\x20Shop:\x20','getWalletAddress','customerName','year','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','findFirst','sort','crypto','not\x20set','not\x20found','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','payout','üìä\x20Admin\x20getAllPayments\x20results:\x20found\x20','null','\x20\x20\x20Conversion\x20rate:\x20','successfulPayments','üìä\x20[DAILY]\x20Total\x20revenue\x20processed:\x20','\x20USDT\x20(total\x20merchant\x20balances)','paymentGateways','lifetime','includes','usdtErcWallet','customerEmail','wallets','adminNotes',',\x20orderID=','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','findMany','failUrl','date','orderId','paymentMethod','dailyPayments','shopUrl','90d','\x20status:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20to\x20name\x20','statusChangedAt','setDate','‚ö†Ô∏è\x20[DAILY]\x20Failed\x20to\x20convert\x20','\x20\x20\x20Final\x20commission\x20used:\x20','txUrls','\x20(direct\x20amountUSDT)','shopId','paidAt','merchantEarningsUSDT','usdtPolygonWallet','turnover','üîç\x20Admin\x20payments\x20filter:\x20Currency\x20contains\x20\x22','\x20USDT\x20to\x20balance','all','network','create','getAllPayments','Insufficient\x20balance.\x20Available:\x20','Plisio','\x20paid\x20payments\x20for\x20analysis','hash','üí∏\x20CHARGEBACK\x20penalty:\x20-'];a35_0x3b76=function(){return _0x362b83;};return a35_0x3b76();}(function(_0x464298,_0x294364){const _0x2382ea=a35_0x493d,_0x4e14ba=_0x464298();while(!![]){try{const _0x2d844c=parseInt(_0x2382ea(0x106))/0x1+-parseInt(_0x2382ea(0x119))/0x2*(parseInt(_0x2382ea(0x1bb))/0x3)+-parseInt(_0x2382ea(0x126))/0x4+-parseInt(_0x2382ea(0x1fe))/0x5+parseInt(_0x2382ea(0x1e5))/0x6+-parseInt(_0x2382ea(0x225))/0x7*(-parseInt(_0x2382ea(0x18a))/0x8)+parseInt(_0x2382ea(0x1aa))/0x9;if(_0x2d844c===_0x294364)break;else _0x4e14ba['push'](_0x4e14ba['shift']());}catch(_0x5587d7){_0x4e14ba['push'](_0x4e14ba['shift']());}}}(a35_0x3b76,0xb0d42));function a35_0x493d(_0x1569c2,_0x4537d4){const _0x3b767a=a35_0x3b76();return a35_0x493d=function(_0x493d19,_0x19ee10){_0x493d19=_0x493d19-0xff;let _0xdcd5de=_0x3b767a[_0x493d19];return _0xdcd5de;},a35_0x493d(_0x1569c2,_0x4537d4);}var __importDefault=this&&this[a35_0x628281(0x127)]||function(_0x2c3dd1){const _0x172f91=a35_0x628281;return _0x2c3dd1&&_0x2c3dd1[_0x172f91(0x21b)]?_0x2c3dd1:{'default':_0x2c3dd1};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a35_0x628281(0x107)]=void 0x0;const database_1=__importDefault(require(a35_0x628281(0x1bf))),bcryptjs_1=__importDefault(require(a35_0x628281(0x1e2))),crypto_1=__importDefault(require(a35_0x628281(0x142))),currencyService_1=require('./currencyService');class AdminService{async['getPayoutStats'](){const _0x441dfb=a35_0x628281;console[_0x441dfb(0x1c9)](_0x441dfb(0x206));const _0x1300a6=await database_1[_0x441dfb(0x17c)]['shop'][_0x441dfb(0x1d4)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x441dfb(0x19d)}}),_0x3e2bcf=new Date(),_0x508331=new Date(_0x3e2bcf['getFullYear'](),_0x3e2bcf[_0x441dfb(0x1c5)](),0x1),_0x369cac=new Date(_0x3e2bcf[_0x441dfb(0x113)](),_0x3e2bcf['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x240d71=await database_1[_0x441dfb(0x17c)]['payout'][_0x441dfb(0x1d4)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x508331,'lte':_0x369cac},'status':_0x441dfb(0x135)}}),_0x57dbad=_0x1300a6[_0x441dfb(0x19a)][_0x441dfb(0x187)]||0x0,_0x3f0c27=_0x1300a6[_0x441dfb(0x19a)][_0x441dfb(0x196)]||0x0,_0x5c42ed=_0x240d71[_0x441dfb(0x19a)][_0x441dfb(0x180)]||0x0,_0x4430e6={'totalPayout':Math['round'](_0x57dbad*0x64)/0x64,'awaitingPayout':Math[_0x441dfb(0x137)](_0x3f0c27*0x64)/0x64,'thisMonth':Math['round'](_0x5c42ed*0x64)/0x64,'availableBalance':Math[_0x441dfb(0x137)](_0x3f0c27*0x64)/0x64};return console[_0x441dfb(0x1c9)](_0x441dfb(0x226)),console[_0x441dfb(0x1c9)](_0x441dfb(0x1d2)+_0x4430e6[_0x441dfb(0x18c)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x441dfb(0x1c9)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x4430e6[_0x441dfb(0x111)]+_0x441dfb(0x14c)),console[_0x441dfb(0x1c9)](_0x441dfb(0x10f)+_0x4430e6[_0x441dfb(0x10e)]+_0x441dfb(0x216)),console[_0x441dfb(0x1c9)](_0x441dfb(0x177)+_0x4430e6['thisMonth']+_0x441dfb(0x228)),_0x4430e6;}async['updateCustomerData'](_0x5ada8b,_0x56e404){const _0x29459f=a35_0x628281;console[_0x29459f(0x1c9)](_0x29459f(0x17f)+_0x5ada8b+':',_0x56e404);const _0x34dd36=await database_1['default'][_0x29459f(0x11a)]['findUnique']({'where':{'id':_0x5ada8b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x34dd36)throw new Error(_0x29459f(0x120));const _0x17aeac={};_0x56e404[_0x29459f(0x10b)]!==undefined&&(_0x17aeac[_0x29459f(0x10b)]=_0x56e404['customerCountry']||null);_0x56e404[_0x29459f(0x1f4)]!==undefined&&(_0x17aeac[_0x29459f(0x1f4)]=_0x56e404['customerIp']||null);_0x56e404[_0x29459f(0x1f1)]!==undefined&&(_0x17aeac[_0x29459f(0x1f1)]=_0x56e404['customerUa']||null);const _0x5b9936=await database_1['default']['payment'][_0x29459f(0x12f)]({'where':{'id':_0x5ada8b},'data':{..._0x17aeac,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x29459f(0x1c9)]('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x5ada8b),console[_0x29459f(0x1c9)]('\x20\x20\x20üåç\x20Country:\x20'+_0x34dd36[_0x29459f(0x10b)]+_0x29459f(0x211)+_0x5b9936['customerCountry']),console[_0x29459f(0x1c9)](_0x29459f(0x194)+_0x34dd36[_0x29459f(0x1f4)]+'\x20->\x20'+_0x5b9936[_0x29459f(0x1f4)]),console[_0x29459f(0x1c9)](_0x29459f(0x1e3)+(_0x34dd36[_0x29459f(0x1f1)]?_0x29459f(0x1fd):_0x29459f(0x143))+'\x20->\x20'+(_0x5b9936[_0x29459f(0x1f1)]?_0x29459f(0x1fd):_0x29459f(0x143))),_0x5b9936;}async[a35_0x628281(0x117)](_0xa68140){const _0x2297c7=a35_0x628281,_0x1e16cf=new Date();let _0x457bd3;switch(_0xa68140){case'7d':_0x457bd3=new Date(_0x1e16cf[_0x2297c7(0x100)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x457bd3=new Date(_0x1e16cf[_0x2297c7(0x100)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2297c7(0x15d):_0x457bd3=new Date(_0x1e16cf[_0x2297c7(0x100)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x2297c7(0x16e):case'alltime':case _0x2297c7(0x14e):const _0x53fb72=await database_1[_0x2297c7(0x17c)][_0x2297c7(0x11a)]['findFirst']({'where':{'gateway':{'not':_0x2297c7(0x21c)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x457bd3=_0x53fb72?_0x53fb72['createdAt']:new Date(0x0),console[_0x2297c7(0x1c9)]('üìä\x20All-time\x20statistics\x20from\x20first\x20payment:\x20'+_0x457bd3[_0x2297c7(0x1f7)]());break;default:_0x457bd3=new Date(_0x1e16cf[_0x2297c7(0x100)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3b9389,_0x103188,_0x2ccaa6,_0x4a7ea3,_0x18c9ea,_0x18835f,_0x3f7fc9]=await Promise[_0x2297c7(0x16e)]([database_1[_0x2297c7(0x17c)][_0x2297c7(0x12d)]['count'](),database_1['default'][_0x2297c7(0x12d)][_0x2297c7(0x1c4)]({'where':{'status':_0x2297c7(0x19d)}}),database_1[_0x2297c7(0x17c)][_0x2297c7(0x11a)][_0x2297c7(0x1c4)]({'where':{'createdAt':{'gte':_0x457bd3},'gateway':{'not':'test_gateway'}}}),database_1[_0x2297c7(0x17c)]['payment']['count']({'where':{'status':_0x2297c7(0x10a),'createdAt':{'gte':_0x457bd3},'gateway':{'not':_0x2297c7(0x21c)}}}),database_1[_0x2297c7(0x17c)]['payment'][_0x2297c7(0x156)]({'where':{'status':_0x2297c7(0x10a),'createdAt':{'gte':_0x457bd3},'gateway':{'not':_0x2297c7(0x21c)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x2297c7(0x17c)][_0x2297c7(0x11a)][_0x2297c7(0x156)]({'where':{'gateway':{'not':_0x2297c7(0x21c)}},'take':0xa,'orderBy':{'createdAt':_0x2297c7(0x20a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2297c7(0x17c)][_0x2297c7(0x11a)][_0x2297c7(0x156)]({'where':{'createdAt':{'gte':_0x457bd3},'gateway':{'not':_0x2297c7(0x21c)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x205d60=0x0;for(const _0x4b4094 of _0x18c9ea){if(_0x4b4094['amountUSDT'])_0x205d60+=_0x4b4094['amountUSDT'];else{const _0x12df72=await currencyService_1['currencyService'][_0x2297c7(0x219)](_0x4b4094[_0x2297c7(0x180)],_0x4b4094[_0x2297c7(0x1a0)]);_0x205d60+=_0x12df72;}}console['log'](_0x2297c7(0x11c)+_0x3f7fc9[_0x2297c7(0x1ec)]+_0x2297c7(0x224)),console[_0x2297c7(0x1c9)](_0x2297c7(0x217)+_0x457bd3['toISOString']()[_0x2297c7(0x214)]('T')[0x0]+_0x2297c7(0x1b0)+_0x1e16cf['toISOString']()[_0x2297c7(0x214)]('T')[0x0]);const _0x1d9304=_0x3f7fc9[_0x2297c7(0x189)]((_0xe69850,_0x2b048a)=>{const _0x39fc9f=_0x2297c7;return _0xe69850[_0x2b048a[_0x39fc9f(0x1c0)]]=(_0xe69850[_0x2b048a['status']]||0x0)+0x1,_0xe69850;},{});console[_0x2297c7(0x1c9)](_0x2297c7(0x1b7),_0x1d9304);const _0x29a12d=await this['generateDailyStatistics'](_0x3f7fc9,_0x457bd3,_0x1e16cf),_0xdaae0d=_0x2ccaa6>0x0?_0x4a7ea3/_0x2ccaa6*0x64:0x0;return{'totalShops':_0x3b9389,'activeShops':_0x103188,'totalPayments':_0x2ccaa6,'successfulPayments':_0x4a7ea3,'totalRevenue':Math[_0x2297c7(0x137)](_0x205d60*0x64)/0x64,'conversionRate':Math[_0x2297c7(0x137)](_0xdaae0d*0x64)/0x64,'dailyRevenue':_0x29a12d[_0x2297c7(0x201)],'dailyPayments':_0x29a12d[_0x2297c7(0x15b)],'recentPayments':_0x18835f[_0x2297c7(0x1c7)](_0x3dfdb9=>({'id':_0x3dfdb9['id'],'amount':_0x3dfdb9['amount'],'currency':_0x3dfdb9['currency'],'status':_0x3dfdb9[_0x2297c7(0x1c0)],'gateway':_0x3dfdb9['gateway'],'shop':_0x3dfdb9[_0x2297c7(0x12d)],'createdAt':_0x3dfdb9['createdAt']}))};}async[a35_0x628281(0x1af)](_0x5c2417,_0xf6cd00,_0x59752d){const _0x1d69d6=a35_0x628281,_0xf92783=new Map(),_0x1089c8=new Date(_0xf6cd00);while(_0x1089c8<=_0x59752d){const _0x54c46e=_0x1089c8[_0x1d69d6(0x1f7)]()['split']('T')[0x0];_0xf92783[_0x1d69d6(0x1fd)](_0x54c46e,{'revenue':0x0,'count':0x0}),_0x1089c8[_0x1d69d6(0x162)](_0x1089c8['getDate']()+0x1);}let _0x3d32fa=0x0,_0x1b1fc1=0x0;for(const _0x182f8e of _0x5c2417){const _0x3a2788=_0x182f8e['createdAt'][_0x1d69d6(0x1f7)]()[_0x1d69d6(0x214)]('T')[0x0],_0x1e85bd=_0xf92783[_0x1d69d6(0x1f5)](_0x3a2788);if(_0x1e85bd){_0x1e85bd[_0x1d69d6(0x1c4)]+=0x1;if(_0x182f8e[_0x1d69d6(0x1c0)]===_0x1d69d6(0x10a)){_0x3d32fa++;if(_0x182f8e[_0x1d69d6(0x124)])_0x1e85bd['revenue']+=_0x182f8e[_0x1d69d6(0x124)],_0x1b1fc1+=_0x182f8e[_0x1d69d6(0x124)],console[_0x1d69d6(0x1c9)](_0x1d69d6(0x191)+_0x182f8e['amountUSDT']+_0x1d69d6(0x1a3)+_0x3a2788+_0x1d69d6(0x166));else try{const _0x4e3493=await currencyService_1[_0x1d69d6(0x109)][_0x1d69d6(0x219)](_0x182f8e[_0x1d69d6(0x180)],_0x182f8e['currency']);_0x1e85bd[_0x1d69d6(0x11f)]+=_0x4e3493,_0x1b1fc1+=_0x4e3493,console[_0x1d69d6(0x1c9)](_0x1d69d6(0x102)+_0x182f8e[_0x1d69d6(0x180)]+'\x20'+_0x182f8e[_0x1d69d6(0x1a0)]+'\x20to\x20'+_0x4e3493+_0x1d69d6(0x1ea)+_0x3a2788);}catch(_0x4159b1){console['warn'](_0x1d69d6(0x163)+_0x182f8e[_0x1d69d6(0x180)]+'\x20'+_0x182f8e[_0x1d69d6(0x1a0)]+_0x1d69d6(0x104)+_0x3a2788+':',_0x4159b1);}}}}console[_0x1d69d6(0x1c9)](_0x1d69d6(0x203)+_0x3d32fa+'\x20PAID\x20payments\x20out\x20of\x20'+_0x5c2417[_0x1d69d6(0x1ec)]+_0x1d69d6(0x132)),console['log'](_0x1d69d6(0x14b)+_0x1b1fc1+_0x1d69d6(0x228));const _0x10d0c8=[],_0x67a9af=[];for(const [_0x54d7f2,_0x195532]of _0xf92783){_0x10d0c8[_0x1d69d6(0x10d)]({'date':_0x54d7f2,'amount':Math[_0x1d69d6(0x137)](_0x195532['revenue']*0x64)/0x64}),_0x67a9af['push']({'date':_0x54d7f2,'count':_0x195532[_0x1d69d6(0x1c4)]});}return{'dailyRevenue':_0x10d0c8,'dailyPayments':_0x67a9af};}async[a35_0x628281(0x1b4)](_0x40b106){const _0x137fc8=a35_0x628281;console['log'](_0x137fc8(0x155),_0x40b106);let _0x520c61,_0x5d411a=new Date();if(_0x40b106[_0x137fc8(0x20d)]===_0x137fc8(0x1e6)&&_0x40b106['dateFrom']&&_0x40b106[_0x137fc8(0x103)])_0x520c61=new Date(_0x40b106[_0x137fc8(0x12c)]),_0x5d411a=new Date(_0x40b106[_0x137fc8(0x103)]);else{const _0x2573d6=new Date();switch(_0x40b106[_0x137fc8(0x20d)]){case'week':_0x520c61=new Date(_0x2573d6[_0x137fc8(0x100)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x520c61=new Date(_0x2573d6[_0x137fc8(0x100)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x137fc8(0x13d):_0x520c61=new Date(_0x2573d6[_0x137fc8(0x100)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x137fc8(0x16e):case'alltime':case _0x137fc8(0x14e):const _0x5d9000=_0x40b106[_0x137fc8(0x167)]?{'gateway':{'not':_0x137fc8(0x21c)},'shopId':_0x40b106['shopId']}:{'gateway':{'not':_0x137fc8(0x21c)}},_0x14b665=await database_1[_0x137fc8(0x17c)][_0x137fc8(0x11a)][_0x137fc8(0x140)]({'where':_0x5d9000,'orderBy':{'createdAt':_0x137fc8(0x133)},'select':{'createdAt':!![]}});_0x520c61=_0x14b665?_0x14b665[_0x137fc8(0x1ef)]:new Date(_0x137fc8(0x101)),console[_0x137fc8(0x1c9)](_0x137fc8(0x1f0)+_0x520c61[_0x137fc8(0x1f7)]());break;default:const _0x564564=await database_1[_0x137fc8(0x17c)][_0x137fc8(0x11a)]['findFirst']({'where':{'gateway':{'not':_0x137fc8(0x21c)}},'orderBy':{'createdAt':_0x137fc8(0x133)},'select':{'createdAt':!![]}});_0x520c61=_0x564564?_0x564564[_0x137fc8(0x1ef)]:new Date(_0x137fc8(0x101));break;}}console[_0x137fc8(0x1c9)](_0x137fc8(0x1fb)+_0x520c61[_0x137fc8(0x1f7)]()+'\x20to\x20'+_0x5d411a[_0x137fc8(0x1f7)]());if(_0x40b106[_0x137fc8(0x167)]){const _0x2b3bb2=await database_1[_0x137fc8(0x17c)][_0x137fc8(0x12d)]['findUnique']({'where':{'id':_0x40b106[_0x137fc8(0x167)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console[_0x137fc8(0x1c9)](_0x137fc8(0x182)+_0x40b106[_0x137fc8(0x167)]+':'),console[_0x137fc8(0x1c9)](_0x137fc8(0x11b)+_0x2b3bb2?.[_0x137fc8(0x18e)]),console[_0x137fc8(0x1c9)]('\x20\x20\x20Username:\x20'+_0x2b3bb2?.[_0x137fc8(0x10c)]),console[_0x137fc8(0x1c9)](_0x137fc8(0x1ac)+(_0x2b3bb2?.[_0x137fc8(0x179)]||_0x137fc8(0x148)));if(_0x2b3bb2?.[_0x137fc8(0x179)])try{const _0x368230=JSON['parse'](_0x2b3bb2['gatewaySettings']);console[_0x137fc8(0x1c9)]('\x20\x20\x20Parsed\x20gatewaySettings:',_0x368230),console['log'](_0x137fc8(0x192)+(_0x368230[_0x137fc8(0x210)]||'not\x20found'));}catch(_0x3624c4){console[_0x137fc8(0x1c9)]('\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20'+_0x3624c4);}}const _0x33e931={'status':'PAID','gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x520c61,'lte':_0x5d411a}};_0x40b106['shopId']&&(_0x33e931[_0x137fc8(0x167)]=_0x40b106[_0x137fc8(0x167)]);const _0x23bfd1=await database_1[_0x137fc8(0x17c)]['payment'][_0x137fc8(0x156)]({'where':_0x33e931,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x137fc8(0x1c9)](_0x137fc8(0x1b8)+_0x23bfd1['length']+_0x137fc8(0x174));const _0x3e2e1a={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x520c61,'lte':_0x5d411a}};_0x40b106[_0x137fc8(0x167)]&&(_0x3e2e1a['shopId']=_0x40b106[_0x137fc8(0x167)]);const _0xe87622=await database_1['default'][_0x137fc8(0x11a)][_0x137fc8(0x1c4)]({'where':_0x3e2e1a});console[_0x137fc8(0x1c9)]('üìä\x20Total\x20payments\x20(all\x20statuses):\x20'+_0xe87622),console[_0x137fc8(0x1c9)]('‚úÖ\x20Successful\x20payments:\x20'+_0x23bfd1['length']);let _0xc24fa4=0x0,_0x553f0e=0x0,_0x573c49=0x0;const _0x2aa3e1={},_0x5c89dc={},_0x3ca8a7={};for(const _0x5b5b0f of _0x23bfd1){try{const _0x2cc5ce=await currencyService_1[_0x137fc8(0x109)]['convertToUSDT'](_0x5b5b0f[_0x137fc8(0x180)],_0x5b5b0f['currency']);let _0xcfce={};if(_0x5b5b0f[_0x137fc8(0x12d)][_0x137fc8(0x179)])try{_0xcfce=JSON['parse'](_0x5b5b0f[_0x137fc8(0x12d)][_0x137fc8(0x179)]);}catch(_0x4ac6fc){console[_0x137fc8(0x1b2)](_0x137fc8(0x15f)+_0x5b5b0f['shopId']+':',_0x4ac6fc);}let _0x3cb3e0=0xa;const _0x142247=Object[_0x137fc8(0x1e0)](_0xcfce)['find'](_0x1b03b6=>_0x1b03b6[_0x137fc8(0x19c)]()===_0x5b5b0f[_0x137fc8(0x205)][_0x137fc8(0x19c)]());_0x142247&&_0xcfce[_0x142247]&&_0xcfce[_0x142247]['commission']&&(_0x3cb3e0=_0xcfce[_0x142247][_0x137fc8(0x210)]);console[_0x137fc8(0x1c9)]('üìä\x20Payment\x20'+_0x5b5b0f['id']+_0x137fc8(0x21e)),console[_0x137fc8(0x1c9)](_0x137fc8(0x13a)+_0x5b5b0f[_0x137fc8(0x12d)][_0x137fc8(0x18e)]+'\x20('+_0x5b5b0f[_0x137fc8(0x167)]+')'),console[_0x137fc8(0x1c9)](_0x137fc8(0x208)+_0x5b5b0f[_0x137fc8(0x205)]),console[_0x137fc8(0x1c9)](_0x137fc8(0x1ac)+(_0x5b5b0f[_0x137fc8(0x12d)][_0x137fc8(0x179)]||'null')),console['log'](_0x137fc8(0x1ff),_0xcfce),console[_0x137fc8(0x1c9)](_0x137fc8(0x202)+(_0x142247||'not\x20found')),console[_0x137fc8(0x1c9)](_0x137fc8(0x1d1)+(_0x142247&&_0xcfce[_0x142247]?_0xcfce[_0x142247]['commission']:_0x137fc8(0x144))),console['log'](_0x137fc8(0x164)+_0x3cb3e0+'%');const _0x531009=_0x2cc5ce*(_0x3cb3e0/0x64),_0x5e658f=_0x2cc5ce-_0x531009;_0xc24fa4+=_0x2cc5ce,_0x553f0e+=_0x5e658f,_0x573c49+=_0x531009;!_0x2aa3e1[_0x5b5b0f[_0x137fc8(0x205)]]&&(_0x2aa3e1[_0x5b5b0f[_0x137fc8(0x205)]]={'gateway':_0x5b5b0f[_0x137fc8(0x205)],'gatewayDisplayName':this[_0x137fc8(0x1a4)](_0x5b5b0f['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2aa3e1[_0x5b5b0f['gateway']][_0x137fc8(0x1ad)]++,_0x2aa3e1[_0x5b5b0f[_0x137fc8(0x205)]][_0x137fc8(0x1eb)]+=_0x2cc5ce,_0x2aa3e1[_0x5b5b0f[_0x137fc8(0x205)]][_0x137fc8(0x221)]+=_0x531009,_0x2aa3e1[_0x5b5b0f[_0x137fc8(0x205)]][_0x137fc8(0x169)]+=_0x5e658f,_0x2aa3e1[_0x5b5b0f[_0x137fc8(0x205)]][_0x137fc8(0x222)]+=_0x3cb3e0;!_0x40b106[_0x137fc8(0x167)]&&(!_0x5c89dc[_0x5b5b0f['shopId']]&&(_0x5c89dc[_0x5b5b0f[_0x137fc8(0x167)]]={'shopId':_0x5b5b0f[_0x137fc8(0x167)],'shopName':_0x5b5b0f[_0x137fc8(0x12d)]['name'],'shopUsername':_0x5b5b0f[_0x137fc8(0x12d)][_0x137fc8(0x10c)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x5c89dc[_0x5b5b0f['shopId']]['paymentsCount']++,_0x5c89dc[_0x5b5b0f[_0x137fc8(0x167)]]['turnoverUSDT']+=_0x2cc5ce,_0x5c89dc[_0x5b5b0f['shopId']]['commissionUSDT']+=_0x531009,_0x5c89dc[_0x5b5b0f[_0x137fc8(0x167)]]['merchantEarningsUSDT']+=_0x5e658f);const _0x5b2480=_0x5b5b0f[_0x137fc8(0x168)]['toISOString']()['split']('T')[0x0];!_0x3ca8a7[_0x5b2480]&&(_0x3ca8a7[_0x5b2480]={'date':_0x5b2480,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3ca8a7[_0x5b2480][_0x137fc8(0x16b)]+=_0x2cc5ce,_0x3ca8a7[_0x5b2480][_0x137fc8(0x1a8)]+=_0x5e658f,_0x3ca8a7[_0x5b2480][_0x137fc8(0x114)]+=_0x531009,_0x3ca8a7[_0x5b2480][_0x137fc8(0x1ad)]++;}catch(_0x28bbcb){console['error'](_0x137fc8(0x1ca)+_0x5b5b0f['id']+':',_0x28bbcb);}}Object[_0x137fc8(0x1cb)](_0x2aa3e1)['forEach'](_0x44c104=>{const _0x2ce473=_0x137fc8;_0x44c104[_0x2ce473(0x199)]=_0x44c104[_0x2ce473(0x1ad)]>0x0?_0x44c104[_0x2ce473(0x222)]/_0x44c104[_0x2ce473(0x1ad)]:0x0,delete _0x44c104[_0x2ce473(0x222)];}),Object['values'](_0x5c89dc)['forEach'](_0x3947a2=>{const _0x101699=_0x137fc8;_0x3947a2[_0x101699(0x1c8)]=_0x3947a2[_0x101699(0x1ad)]>0x0?_0x3947a2[_0x101699(0x1eb)]/_0x3947a2[_0x101699(0x1ad)]:0x0;});let _0xedd823=0x0;if(_0x40b106['shopId']){const _0x3e421b=await database_1[_0x137fc8(0x17c)]['payout'][_0x137fc8(0x156)]({'where':{'shopId':_0x40b106[_0x137fc8(0x167)],'status':_0x137fc8(0x135),'createdAt':{'gte':_0x520c61,'lte':_0x5d411a}},'select':{'amount':!![]}});_0xedd823=_0x3e421b[_0x137fc8(0x189)]((_0x35bc32,_0x472750)=>_0x35bc32+_0x472750[_0x137fc8(0x180)],0x0);}const _0x6821ac=_0xe87622,_0x3d0ef9=_0x23bfd1[_0x137fc8(0x1ec)],_0x1cc28d=_0x3d0ef9>0x0?_0xc24fa4/_0x3d0ef9:0x0,_0x1b4564=_0x6821ac>0x0?_0x3d0ef9/_0x6821ac*0x64:0x0;console[_0x137fc8(0x1c9)](_0x137fc8(0x122)),console[_0x137fc8(0x1c9)](_0x137fc8(0x181)+_0x6821ac),console[_0x137fc8(0x1c9)](_0x137fc8(0x207)+_0x3d0ef9),console['log'](_0x137fc8(0x149)+_0x1b4564[_0x137fc8(0x1d8)](0x2)+'%');const _0x393978=Math['ceil']((_0x5d411a[_0x137fc8(0x100)]()-_0x520c61[_0x137fc8(0x100)]())/(0x3e8*0x3c*0x3c*0x18)),_0xf8e8d2={'totalTurnover':Math[_0x137fc8(0x137)](_0xc24fa4*0x64)/0x64,'merchantEarnings':Math[_0x137fc8(0x137)](_0x553f0e*0x64)/0x64,'gatewayEarnings':Math[_0x137fc8(0x137)](_0x573c49*0x64)/0x64,'totalPaidOut':Math[_0x137fc8(0x137)](_0xedd823*0x64)/0x64,'averageCheck':Math['round'](_0x1cc28d*0x64)/0x64,'totalPayments':_0x6821ac,'successfulPayments':_0x3d0ef9,'conversionRate':Math['round'](_0x1b4564*0x64)/0x64,'gatewayBreakdown':Object['values'](_0x2aa3e1)['map'](_0xc9aefd=>({..._0xc9aefd,'turnoverUSDT':Math[_0x137fc8(0x137)](_0xc9aefd[_0x137fc8(0x1eb)]*0x64)/0x64,'commissionUSDT':Math[_0x137fc8(0x137)](_0xc9aefd[_0x137fc8(0x221)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x137fc8(0x137)](_0xc9aefd[_0x137fc8(0x169)]*0x64)/0x64,'averageCommissionRate':Math[_0x137fc8(0x137)](_0xc9aefd['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x40b106[_0x137fc8(0x167)]?undefined:Object['values'](_0x5c89dc)[_0x137fc8(0x1c7)](_0x3b0c3b=>({..._0x3b0c3b,'turnoverUSDT':Math['round'](_0x3b0c3b['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x3b0c3b['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3b0c3b['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x137fc8(0x137)](_0x3b0c3b[_0x137fc8(0x1f9)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x3b0c3b[_0x137fc8(0x1c8)]*0x64)/0x64})),'dailyData':Object[_0x137fc8(0x1cb)](_0x3ca8a7)['map'](_0x471113=>({..._0x471113,'turnover':Math[_0x137fc8(0x137)](_0x471113[_0x137fc8(0x16b)]*0x64)/0x64,'merchantEarnings':Math[_0x137fc8(0x137)](_0x471113[_0x137fc8(0x1a8)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x471113[_0x137fc8(0x114)]*0x64)/0x64}))[_0x137fc8(0x141)]((_0x427578,_0x343788)=>_0x427578[_0x137fc8(0x158)][_0x137fc8(0x110)](_0x343788[_0x137fc8(0x158)])),'periodInfo':{'from':_0x520c61,'to':_0x5d411a,'periodType':_0x40b106[_0x137fc8(0x20d)]||'custom','daysCount':_0x393978}};return console[_0x137fc8(0x1c9)](_0x137fc8(0x1a5)),console['log'](_0x137fc8(0x13f)+_0xf8e8d2['totalTurnover']+_0x137fc8(0x228)),console[_0x137fc8(0x1c9)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0xf8e8d2[_0x137fc8(0x1a8)]+_0x137fc8(0x228)),console['log'](_0x137fc8(0x13e)+_0xf8e8d2[_0x137fc8(0x114)]+_0x137fc8(0x228)),console['log'](_0x137fc8(0x131)+_0xf8e8d2[_0x137fc8(0x218)]),console[_0x137fc8(0x1c9)](_0x137fc8(0x1d6)+_0xf8e8d2[_0x137fc8(0x14a)]),console['log'](_0x137fc8(0xff)+_0xf8e8d2[_0x137fc8(0x123)]+'%'),_0xf8e8d2;}[a35_0x628281(0x1a4)](_0x2135ba){const _0x164d57=a35_0x628281,_0x144e51={'test_gateway':'Test\x20Gateway','plisio':_0x164d57(0x173),'rapyd':_0x164d57(0x118),'noda':_0x164d57(0x1a7),'cointopay':_0x164d57(0x1f3),'mastercard':_0x164d57(0x1dd),'klyme_eu':_0x164d57(0x1c3),'klyme_gb':'KLYME\x20GB','klyme_de':_0x164d57(0x18d)};return _0x144e51[_0x2135ba]||_0x2135ba;}async[a35_0x628281(0x197)](_0x4bdde9){const _0x11a7b6=a35_0x628281,{page:_0x292c2e,limit:_0x3d4c08,minAmount:_0x4d996c,search:_0xec0e9d}=_0x4bdde9,_0x2b7b22=(_0x292c2e-0x1)*_0x3d4c08;console[_0x11a7b6(0x1c9)](_0x11a7b6(0x209),_0x4bdde9);const _0x4081c2={'balance':{'gt':0x0},'status':'ACTIVE'};_0x4d996c&&(_0x4081c2[_0x11a7b6(0x196)][_0x11a7b6(0x125)]=_0x4d996c);_0xec0e9d&&(_0x4081c2['OR']=[{'name':{'contains':_0xec0e9d,'mode':_0x11a7b6(0x1ed)}},{'username':{'contains':_0xec0e9d,'mode':'insensitive'}}]);const [_0x164c41,_0x555159]=await Promise[_0x11a7b6(0x16e)]([database_1[_0x11a7b6(0x17c)][_0x11a7b6(0x12d)]['findMany']({'where':_0x4081c2,'skip':_0x2b7b22,'take':_0x3d4c08,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default'][_0x11a7b6(0x12d)][_0x11a7b6(0x1c4)]({'where':_0x4081c2})]);console['log'](_0x11a7b6(0x1b8)+_0x164c41[_0x11a7b6(0x1ec)]+'\x20merchants\x20with\x20positive\x20balance');const _0x33d498=await Promise['all'](_0x164c41['map'](async _0x23c666=>{const _0x3ca833=_0x11a7b6,[_0x44fa6d,_0xb3dcf4,_0x1c0139]=await Promise[_0x3ca833(0x16e)]([database_1[_0x3ca833(0x17c)][_0x3ca833(0x11a)][_0x3ca833(0x1c4)]({'where':{'shopId':_0x23c666['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1['default']['payment'][_0x3ca833(0x140)]({'where':{'shopId':_0x23c666['id'],'status':'PAID','amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x3ca833(0x1e4)]({'by':[_0x3ca833(0x205)],'where':{'shopId':_0x23c666['id'],'status':_0x3ca833(0x10a),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x395b09=_0x1c0139['map'](_0x5babfe=>({'gateway':_0x5babfe[_0x3ca833(0x205)],'count':_0x5babfe['_count']['id'],'amountUSDT':_0x5babfe['_sum'][_0x3ca833(0x124)]||0x0,'amountAfterCommissionUSDT':_0x5babfe[_0x3ca833(0x19a)][_0x3ca833(0x124)]||0x0,'commission':0x0}));return{'id':_0x23c666['id'],'fullName':_0x23c666[_0x3ca833(0x18e)],'username':_0x23c666[_0x3ca833(0x10c)],'telegramId':_0x23c666[_0x3ca833(0x1ae)],'merchantUrl':_0x23c666[_0x3ca833(0x15c)],'wallets':{'usdtPolygonWallet':_0x23c666[_0x3ca833(0x16a)],'usdtTrcWallet':_0x23c666[_0x3ca833(0x105)],'usdtErcWallet':_0x23c666[_0x3ca833(0x150)],'usdcPolygonWallet':_0x23c666[_0x3ca833(0x128)]},'totalAmountUSDT':_0x23c666[_0x3ca833(0x196)],'totalAmountAfterCommissionUSDT':_0x23c666[_0x3ca833(0x196)],'paymentsCount':_0x44fa6d,'oldestPaymentDate':_0xb3dcf4?.[_0x3ca833(0x168)]||_0x23c666[_0x3ca833(0x1ef)],'gatewayBreakdown':_0x395b09};})),_0x218c57=_0x164c41[_0x11a7b6(0x189)]((_0x4060bb,_0x5454a3)=>_0x4060bb+_0x5454a3[_0x11a7b6(0x196)],0x0),_0x5dedc7=_0x218c57;return console[_0x11a7b6(0x1c9)](_0x11a7b6(0x1cd)+_0x555159+_0x11a7b6(0x1c6)+Math['round'](_0x5dedc7*0x64)/0x64+_0x11a7b6(0x138)),{'merchants':_0x33d498,'pagination':{'page':_0x292c2e,'limit':_0x3d4c08,'total':_0x555159,'totalPages':Math[_0x11a7b6(0x204)](_0x555159/_0x3d4c08)},'summary':{'totalMerchants':_0x555159,'totalAmountUSDT':Math[_0x11a7b6(0x137)](_0x218c57*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5dedc7*0x64)/0x64}};}async['createPayout'](_0x29b2e3){const _0xd0783d=a35_0x628281,{shopId:_0x567386,amount:_0x2180b3,network:_0x37ca3d,notes:_0x42b4fb,periodFrom:_0x108ede,periodTo:_0x40af1a}=_0x29b2e3,_0x3cf5bf=await database_1[_0xd0783d(0x17c)][_0xd0783d(0x185)](async _0x3b8edb=>{const _0x27d559=_0xd0783d,_0x516ae6=await _0x3b8edb['shop'][_0x27d559(0x12e)]({'where':{'id':_0x567386},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x516ae6)throw new Error('Shop\x20not\x20found');console[_0x27d559(0x1c9)]('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0x516ae6[_0x27d559(0x10c)]+':'),console[_0x27d559(0x1c9)](_0x27d559(0x21d)+_0x516ae6[_0x27d559(0x196)][_0x27d559(0x1d8)](0x6)+_0x27d559(0x228)),console[_0x27d559(0x1c9)](_0x27d559(0x1b9)+_0x2180b3[_0x27d559(0x1d8)](0x6)+_0x27d559(0x228)),console['log'](_0x27d559(0x19e)+_0x516ae6[_0x27d559(0x187)]['toFixed'](0x6)+_0x27d559(0x228));if(_0x516ae6[_0x27d559(0x196)]<_0x2180b3)throw new Error(_0x27d559(0x172)+_0x516ae6[_0x27d559(0x196)][_0x27d559(0x1d8)](0x6)+_0x27d559(0x112)+_0x2180b3[_0x27d559(0x1d8)](0x6)+_0x27d559(0x228));const _0x47238c=await _0x3b8edb[_0x27d559(0x146)]['create']({'data':{'shopId':_0x567386,'amount':_0x2180b3,'network':_0x37ca3d,'status':'COMPLETED','notes':_0x42b4fb,'periodFrom':_0x108ede?new Date(_0x108ede):null,'periodTo':_0x40af1a?new Date(_0x40af1a):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4ee027=_0x516ae6[_0x27d559(0x196)]-_0x2180b3,_0x4dd4b6=_0x516ae6['totalPaidOut']+_0x2180b3;return await _0x3b8edb[_0x27d559(0x12d)]['update']({'where':{'id':_0x567386},'data':{'balance':_0x4ee027,'totalPaidOut':_0x4dd4b6}}),console['log'](_0x27d559(0x134)+_0x516ae6[_0x27d559(0x10c)]+_0x27d559(0x139)),console[_0x27d559(0x1c9)]('\x20\x20\x20Balance:\x20'+_0x516ae6[_0x27d559(0x196)][_0x27d559(0x1d8)](0x6)+'\x20->\x20'+_0x4ee027[_0x27d559(0x1d8)](0x6)+_0x27d559(0x1a6)+_0x2180b3[_0x27d559(0x1d8)](0x6)+')'),console['log'](_0x27d559(0x1d7)+_0x516ae6[_0x27d559(0x187)]['toFixed'](0x6)+_0x27d559(0x211)+_0x4dd4b6[_0x27d559(0x1d8)](0x6)+_0x27d559(0x188)+_0x2180b3[_0x27d559(0x1d8)](0x6)+')'),{'payout':_0x47238c,'shop':_0x516ae6};});return console[_0xd0783d(0x1c9)](_0xd0783d(0x190)+_0x3cf5bf[_0xd0783d(0x146)]['id']+_0xd0783d(0x1a2)+_0x3cf5bf[_0xd0783d(0x12d)][_0xd0783d(0x10c)]+'\x20('+_0x2180b3+_0xd0783d(0x1ba)),{'id':_0x3cf5bf[_0xd0783d(0x146)]['id'],'shopId':_0x3cf5bf[_0xd0783d(0x146)]['shopId'],'shopName':_0x3cf5bf[_0xd0783d(0x12d)][_0xd0783d(0x18e)],'shopUsername':_0x3cf5bf[_0xd0783d(0x12d)]['username'],'amount':_0x3cf5bf['payout'][_0xd0783d(0x180)],'network':_0x3cf5bf[_0xd0783d(0x146)][_0xd0783d(0x16f)],'status':_0x3cf5bf[_0xd0783d(0x146)][_0xd0783d(0x1c0)],'txid':_0x3cf5bf['payout'][_0xd0783d(0x115)],'notes':_0x3cf5bf[_0xd0783d(0x146)][_0xd0783d(0x193)],'periodFrom':_0x3cf5bf[_0xd0783d(0x146)][_0xd0783d(0x213)],'periodTo':_0x3cf5bf[_0xd0783d(0x146)][_0xd0783d(0x12a)],'createdAt':_0x3cf5bf[_0xd0783d(0x146)][_0xd0783d(0x1ef)],'paidAt':_0x3cf5bf[_0xd0783d(0x146)][_0xd0783d(0x168)]};}[a35_0x628281(0x1b1)](_0x1feca7){const _0x509aa1=a35_0x628281,_0x59a9b8={'polygon':_0x509aa1(0x108),'trc20':_0x509aa1(0x1fa),'erc20':_0x509aa1(0x220),'polygon_usdc':_0x509aa1(0x136)};return _0x59a9b8[_0x1feca7]||_0x1feca7[_0x509aa1(0x1b5)]();}[a35_0x628281(0x13b)](_0x535210,_0x35bab8){const _0x119f36=a35_0x628281,_0x658933={'polygon':_0x119f36(0x16a),'trc20':'usdtTrcWallet','erc20':_0x119f36(0x150),'polygon_usdc':'usdcPolygonWallet'},_0x433263=_0x658933[_0x35bab8];return _0x433263?_0x535210[_0x433263]:null;}async[a35_0x628281(0x18f)](_0x543d33){const _0x4e2267=a35_0x628281,{page:_0x1fd34d,limit:_0x54fd59,shopId:_0x300887,network:_0x4b96f7,dateFrom:_0x21f1d6,dateTo:_0x4ec980,search:_0x111408}=_0x543d33,_0x182f5a=(_0x1fd34d-0x1)*_0x54fd59,_0x12b513={};_0x300887&&(_0x12b513[_0x4e2267(0x167)]=_0x300887);_0x4b96f7&&(_0x12b513[_0x4e2267(0x16f)]=_0x4b96f7);(_0x21f1d6||_0x4ec980)&&(_0x12b513[_0x4e2267(0x1ef)]={},_0x21f1d6&&(_0x12b513[_0x4e2267(0x1ef)][_0x4e2267(0x125)]=new Date(_0x21f1d6)),_0x4ec980&&(_0x12b513['createdAt'][_0x4e2267(0x20e)]=new Date(_0x4ec980)));_0x111408&&(_0x12b513['OR']=[{'shop':{'name':{'contains':_0x111408,'mode':_0x4e2267(0x1ed)}}},{'shop':{'username':{'contains':_0x111408,'mode':_0x4e2267(0x1ed)}}},{'notes':{'contains':_0x111408,'mode':_0x4e2267(0x1ed)}}]);const [_0x54d2f7,_0x520a99]=await Promise[_0x4e2267(0x16e)]([database_1['default'][_0x4e2267(0x146)][_0x4e2267(0x156)]({'where':_0x12b513,'skip':_0x182f5a,'take':_0x54fd59,'orderBy':{'createdAt':_0x4e2267(0x20a)},'include':{'shop':{'select':{'name':!![],'username':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x4e2267(0x17c)][_0x4e2267(0x146)][_0x4e2267(0x1c4)]({'where':_0x12b513})]);return{'payouts':_0x54d2f7['map'](_0x357ae0=>({'id':_0x357ae0['id'],'shopId':_0x357ae0[_0x4e2267(0x167)],'shopName':_0x357ae0[_0x4e2267(0x12d)][_0x4e2267(0x18e)],'shopUsername':_0x357ae0[_0x4e2267(0x12d)][_0x4e2267(0x10c)],'amount':_0x357ae0[_0x4e2267(0x180)],'network':this[_0x4e2267(0x1b1)](_0x357ae0[_0x4e2267(0x16f)]),'networkTechnical':_0x357ae0[_0x4e2267(0x16f)],'walletAddress':this['getWalletAddress'](_0x357ae0[_0x4e2267(0x12d)],_0x357ae0['network']),'status':_0x357ae0[_0x4e2267(0x1c0)],'txid':_0x357ae0[_0x4e2267(0x115)],'notes':_0x357ae0[_0x4e2267(0x193)],'periodFrom':_0x357ae0[_0x4e2267(0x213)],'periodTo':_0x357ae0[_0x4e2267(0x12a)],'createdAt':_0x357ae0[_0x4e2267(0x1ef)],'paidAt':_0x357ae0[_0x4e2267(0x168)]})),'pagination':{'page':_0x1fd34d,'limit':_0x54fd59,'total':_0x520a99,'totalPages':Math[_0x4e2267(0x204)](_0x520a99/_0x54fd59)}};}async['getPayoutById'](_0x21769d){const _0x26af2b=a35_0x628281,_0x287d05=await database_1[_0x26af2b(0x17c)][_0x26af2b(0x146)][_0x26af2b(0x12e)]({'where':{'id':_0x21769d},'include':{'shop':{'select':{'name':!![],'username':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});if(!_0x287d05)return null;return{'id':_0x287d05['id'],'shopId':_0x287d05['shopId'],'shopName':_0x287d05['shop']['name'],'shopUsername':_0x287d05['shop'][_0x26af2b(0x10c)],'amount':_0x287d05[_0x26af2b(0x180)],'network':this['formatNetworkName'](_0x287d05[_0x26af2b(0x16f)]),'networkTechnical':_0x287d05[_0x26af2b(0x16f)],'walletAddress':this[_0x26af2b(0x13b)](_0x287d05[_0x26af2b(0x12d)],_0x287d05[_0x26af2b(0x16f)]),'status':_0x287d05[_0x26af2b(0x1c0)],'txid':_0x287d05['txid'],'notes':_0x287d05[_0x26af2b(0x193)],'periodFrom':_0x287d05[_0x26af2b(0x213)],'periodTo':_0x287d05['periodTo'],'createdAt':_0x287d05[_0x26af2b(0x1ef)],'paidAt':_0x287d05['paidAt']};}async['deletePayout'](_0x38a23f){const _0x389a3a=a35_0x628281;await database_1[_0x389a3a(0x17c)][_0x389a3a(0x146)][_0x389a3a(0x1ee)]({'where':{'id':_0x38a23f}});}async[a35_0x628281(0x171)](_0xd25dc4){const _0x336fbb=a35_0x628281,{page:_0x458515,limit:_0x605019,status:_0x2b2ede,gateway:_0xb48fa3,shopId:_0x24898a,dateFrom:_0x260f92,dateTo:_0x1a37f4,search:_0x1f56a6,sortBy:sortBy=_0x336fbb(0x1ef),sortOrder:sortOrder=_0x336fbb(0x20a),currency:_0x52bbd9}=_0xd25dc4,_0x1bfa58=(_0x458515-0x1)*_0x605019,_0x3bf634={},_0x2b0836=['createdAt',_0x336fbb(0x180),_0x336fbb(0x1c0),_0x336fbb(0x205),_0x336fbb(0x1a0)],_0x4d60fc=_0x2b0836[_0x336fbb(0x14f)](sortBy)?sortBy:_0x336fbb(0x1ef),_0x15cf29=['asc',_0x336fbb(0x20a)][_0x336fbb(0x14f)](sortOrder?.['toLowerCase']())?sortOrder[_0x336fbb(0x19c)]():_0x336fbb(0x20a);console[_0x336fbb(0x1c9)]('üîç\x20Admin\x20getAllPayments\x20sorting:\x20'+_0x4d60fc+'\x20'+_0x15cf29);_0x2b2ede&&(_0x3bf634[_0x336fbb(0x1c0)]=_0x2b2ede['toUpperCase']());if(_0xb48fa3){const {getGatewayNameById:_0x3cb98e,isValidGatewayId:_0x1d1c87}=require(_0x336fbb(0x1b6)),_0x1ee05a=/^\d{4}$/[_0x336fbb(0x19f)](_0xb48fa3);if(_0x1ee05a&&_0x1d1c87(_0xb48fa3)){const _0x19033f=_0x3cb98e(_0xb48fa3);console['log'](_0x336fbb(0x1d5)+_0xb48fa3+_0x336fbb(0x160)+_0x19033f),_0x3bf634['gateway']=_0x19033f;}else console[_0x336fbb(0x1c9)](_0x336fbb(0x1e9)+_0xb48fa3+_0x336fbb(0x1e1)),_0x3bf634[_0x336fbb(0x205)]=_0xb48fa3[_0x336fbb(0x19c)]();}_0x52bbd9&&(_0x3bf634[_0x336fbb(0x1a0)]={'contains':_0x52bbd9,'mode':_0x336fbb(0x1ed)},console[_0x336fbb(0x1c9)](_0x336fbb(0x16c)+_0x52bbd9+'\x22'));_0x3bf634[_0x336fbb(0x205)]=_0x3bf634['gateway']?_0x3bf634[_0x336fbb(0x205)]:{'not':_0x336fbb(0x21c)};if(typeof _0x3bf634[_0x336fbb(0x205)]===_0x336fbb(0x1a9)&&_0x3bf634[_0x336fbb(0x205)]!=='test_gateway'){}else{if(typeof _0x3bf634[_0x336fbb(0x205)]===_0x336fbb(0x1a9)&&_0x3bf634[_0x336fbb(0x205)]===_0x336fbb(0x21c)){}else _0x3bf634[_0x336fbb(0x205)]={'not':_0x336fbb(0x21c)};}_0x24898a&&(_0x3bf634[_0x336fbb(0x167)]=_0x24898a);(_0x260f92||_0x1a37f4)&&(_0x3bf634[_0x336fbb(0x1ef)]={},_0x260f92&&(_0x3bf634[_0x336fbb(0x1ef)][_0x336fbb(0x125)]=new Date(_0x260f92)),_0x1a37f4&&(_0x3bf634[_0x336fbb(0x1ef)]['lte']=new Date(_0x1a37f4)));_0x1f56a6&&(_0x3bf634['OR']=[{'id':_0x1f56a6},{'id':{'contains':_0x1f56a6,'mode':_0x336fbb(0x1ed)}},{'orderId':{'contains':_0x1f56a6,'mode':_0x336fbb(0x1ed)}},{'gatewayOrderId':{'contains':_0x1f56a6,'mode':_0x336fbb(0x1ed)}},{'customerEmail':{'contains':_0x1f56a6,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x1f56a6,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x1f56a6,'mode':_0x336fbb(0x1ed)}}}],console[_0x336fbb(0x1c9)]('üîç\x20Admin\x20search\x20query:\x20\x22'+_0x1f56a6+'\x22'));console[_0x336fbb(0x1c9)](_0x336fbb(0x1ce),JSON[_0x336fbb(0x215)](_0x3bf634,null,0x2));if(_0x1f56a6&&_0x1f56a6[_0x336fbb(0x1ec)]>0x14){const _0x176657=await database_1[_0x336fbb(0x17c)]['payment'][_0x336fbb(0x12e)]({'where':{'id':_0x1f56a6},'select':{'id':!![],'orderId':!![],'gatewayOrderId':!![],'gateway':!![]}});console[_0x336fbb(0x1c9)](_0x336fbb(0x116)+_0x1f56a6+'\x22:',_0x176657?_0x336fbb(0x223):_0x336fbb(0x17b)),_0x176657&&console['log'](_0x336fbb(0x20b)+_0x176657['id']+_0x336fbb(0x154)+_0x176657[_0x336fbb(0x159)]+',\x20gatewayOrderID='+_0x176657[_0x336fbb(0x1de)]+',\x20gateway='+_0x176657[_0x336fbb(0x205)]);}const _0x102d39={};_0x102d39[_0x4d60fc]=_0x15cf29;const [_0x57d57c,_0x45d94d]=await Promise[_0x336fbb(0x16e)]([database_1[_0x336fbb(0x17c)]['payment'][_0x336fbb(0x156)]({'where':_0x3bf634,'skip':_0x1bfa58,'take':_0x605019,'orderBy':_0x102d39,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x336fbb(0x17c)]['payment'][_0x336fbb(0x1c4)]({'where':_0x3bf634})]);return console[_0x336fbb(0x1c9)](_0x336fbb(0x147)+_0x45d94d+_0x336fbb(0x198)+_0x57d57c[_0x336fbb(0x1ec)]+_0x336fbb(0x227)),_0x1f56a6&&(console['log'](_0x336fbb(0x1dc)+_0x1f56a6+'\x22'),console[_0x336fbb(0x1c9)](_0x336fbb(0x11d)+_0x57d57c['length']+_0x336fbb(0x1db))),_0x57d57c[_0x336fbb(0x1ec)]>0x0&&console[_0x336fbb(0x1c9)](_0x336fbb(0x1d9)+_0x57d57c[0x0][_0x336fbb(0x205)]+',\x20ID:\x20'+_0x57d57c[0x0]['id']),{'payments':_0x57d57c[_0x336fbb(0x1c7)](_0x3c3a71=>({'id':_0x3c3a71['id'],'shopId':_0x3c3a71[_0x336fbb(0x167)],'gateway':this[_0x336fbb(0x1a4)](_0x3c3a71['gateway']),'gatewayTechnical':_0x3c3a71[_0x336fbb(0x205)],'amount':_0x3c3a71[_0x336fbb(0x180)],'currency':_0x3c3a71[_0x336fbb(0x1a0)],'status':_0x3c3a71[_0x336fbb(0x1c0)],'orderId':_0x3c3a71[_0x336fbb(0x159)],'gatewayOrderId':_0x3c3a71[_0x336fbb(0x1de)],'customerEmail':_0x3c3a71[_0x336fbb(0x151)],'customerName':_0x3c3a71[_0x336fbb(0x13c)],'customerCountry':_0x3c3a71['customerCountry'],'customerIp':_0x3c3a71[_0x336fbb(0x1f4)],'customerUa':_0x3c3a71[_0x336fbb(0x1f1)],'failureMessage':_0x3c3a71['failureMessage'],'cardLast4':_0x3c3a71[_0x336fbb(0x11e)],'paymentMethod':_0x3c3a71[_0x336fbb(0x15a)],'bankId':_0x3c3a71['bankId'],'remitterIban':_0x3c3a71[_0x336fbb(0x1be)],'remitterName':_0x3c3a71[_0x336fbb(0x121)],'txUrls':_0x3c3a71['txUrls'],'createdAt':_0x3c3a71[_0x336fbb(0x1ef)],'updatedAt':_0x3c3a71[_0x336fbb(0x1cc)],'shop':_0x3c3a71[_0x336fbb(0x12d)]})),'pagination':{'page':_0x458515,'limit':_0x605019,'total':_0x45d94d,'totalPages':Math[_0x336fbb(0x204)](_0x45d94d/_0x605019)}};}async['getPaymentById'](_0x35712b){const _0x380f49=a35_0x628281,_0x130d9a=await database_1[_0x380f49(0x17c)]['payment'][_0x380f49(0x12e)]({'where':{'id':_0x35712b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x130d9a)return null;return{'id':_0x130d9a['id'],'shopId':_0x130d9a[_0x380f49(0x167)],'gateway':this['getGatewayDisplayName'](_0x130d9a['gateway']),'gatewayTechnical':_0x130d9a[_0x380f49(0x205)],'amount':_0x130d9a['amount'],'currency':_0x130d9a[_0x380f49(0x1a0)],'status':_0x130d9a[_0x380f49(0x1c0)],'orderId':_0x130d9a[_0x380f49(0x159)],'gatewayOrderId':_0x130d9a[_0x380f49(0x1de)],'customerEmail':_0x130d9a[_0x380f49(0x151)],'customerName':_0x130d9a[_0x380f49(0x13c)],'customerCountry':_0x130d9a[_0x380f49(0x10b)],'customerIp':_0x130d9a[_0x380f49(0x1f4)],'customerUa':_0x130d9a[_0x380f49(0x1f1)],'failureMessage':_0x130d9a[_0x380f49(0x17a)],'externalPaymentUrl':_0x130d9a[_0x380f49(0x1f6)],'successUrl':_0x130d9a[_0x380f49(0x229)],'failUrl':_0x130d9a[_0x380f49(0x157)],'pendingUrl':_0x130d9a['pendingUrl'],'whiteUrl':_0x130d9a[_0x380f49(0x1e7)],'cardLast4':_0x130d9a[_0x380f49(0x11e)],'paymentMethod':_0x130d9a[_0x380f49(0x15a)],'bankId':_0x130d9a[_0x380f49(0x1f2)],'remitterIban':_0x130d9a[_0x380f49(0x1be)],'remitterName':_0x130d9a[_0x380f49(0x121)],'txUrls':_0x130d9a[_0x380f49(0x165)],'createdAt':_0x130d9a[_0x380f49(0x1ef)],'updatedAt':_0x130d9a['updatedAt'],'shop':_0x130d9a['shop']};}async[a35_0x628281(0x1e8)](_0x16c43a,_0x44433c,_0x29d660,_0x420afd){const _0x46bdbd=a35_0x628281,_0x157eed=await database_1[_0x46bdbd(0x17c)]['$transaction'](async _0x1da0ff=>{const _0x7515b0=_0x46bdbd,_0x540353=await _0x1da0ff[_0x7515b0(0x11a)][_0x7515b0(0x12e)]({'where':{'id':_0x16c43a},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x540353)throw new Error(_0x7515b0(0x120));const _0x59d49e=_0x540353['status'],_0x5d0f7c=_0x44433c[_0x7515b0(0x1b5)]();console[_0x7515b0(0x1c9)](_0x7515b0(0x1df)+_0x16c43a+_0x7515b0(0x15e)+_0x59d49e+_0x7515b0(0x211)+_0x5d0f7c),console[_0x7515b0(0x1c9)](_0x7515b0(0x1bd)+_0x540353[_0x7515b0(0x12d)]['balance']+'\x20USDT');const _0xe15d4f={'status':_0x5d0f7c,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x29d660&&(_0xe15d4f[_0x7515b0(0x153)]=_0x29d660);_0x5d0f7c===_0x7515b0(0x200)&&_0x420afd&&(_0xe15d4f[_0x7515b0(0x1d3)]=_0x420afd);let _0x2f7115=0x0,_0x367e02=_0x540353[_0x7515b0(0x12d)][_0x7515b0(0x196)];if(_0x5d0f7c===_0x7515b0(0x10a)&&_0x59d49e!=='PAID'){_0xe15d4f['paidAt']=new Date();const _0x3224a2=await currencyService_1[_0x7515b0(0x109)]['convertToUSDT'](_0x540353[_0x7515b0(0x180)],_0x540353[_0x7515b0(0x1a0)]);_0xe15d4f[_0x7515b0(0x124)]=_0x3224a2,_0x2f7115=_0x3224a2,_0x367e02+=_0x3224a2,console[_0x7515b0(0x1c9)](_0x7515b0(0x18b)+_0x16c43a+'\x20became\x20PAID:\x20+'+_0x3224a2[_0x7515b0(0x1d8)](0x6)+_0x7515b0(0x16d));}else _0x59d49e==='PAID'&&_0x5d0f7c!==_0x7515b0(0x10a)&&(_0x540353['amountUSDT']&&(_0x2f7115=-_0x540353[_0x7515b0(0x124)],_0x367e02-=_0x540353[_0x7515b0(0x124)],_0xe15d4f[_0x7515b0(0x124)]=null,console[_0x7515b0(0x1c9)](_0x7515b0(0x18b)+_0x16c43a+_0x7515b0(0x1b3)+_0x540353[_0x7515b0(0x124)][_0x7515b0(0x1d8)](0x6)+_0x7515b0(0x130))));if(_0x5d0f7c===_0x7515b0(0x200)){if(_0x59d49e===_0x7515b0(0x10a)&&_0x540353[_0x7515b0(0x124)]){}_0x420afd&&_0x420afd>0x0&&(_0x2f7115-=_0x420afd,_0x367e02-=_0x420afd,console[_0x7515b0(0x1c9)](_0x7515b0(0x176)+_0x420afd['toFixed'](0x6)+'\x20USDT\x20from\x20balance'));}_0x5d0f7c===_0x7515b0(0x1d0)&&_0x59d49e===_0x7515b0(0x10a)&&console[_0x7515b0(0x1c9)](_0x7515b0(0x145));const _0x503174=await _0x1da0ff['payment'][_0x7515b0(0x12f)]({'where':{'id':_0x16c43a},'data':_0xe15d4f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2f7115!==0x0&&(await _0x1da0ff[_0x7515b0(0x12d)][_0x7515b0(0x12f)]({'where':{'id':_0x540353[_0x7515b0(0x167)]},'data':{'balance':_0x367e02}}),console[_0x7515b0(0x1c9)]('üí∞\x20Shop\x20'+_0x540353[_0x7515b0(0x167)]+_0x7515b0(0x184)+_0x540353[_0x7515b0(0x12d)]['balance']['toFixed'](0x6)+_0x7515b0(0x211)+_0x367e02['toFixed'](0x6)+_0x7515b0(0x20f)+(_0x2f7115>0x0?'+':'')+_0x2f7115[_0x7515b0(0x1d8)](0x6)+')')),_0x503174;});return{'id':_0x157eed['id'],'shopId':_0x157eed[_0x46bdbd(0x167)],'gateway':_0x157eed[_0x46bdbd(0x205)],'amount':_0x157eed[_0x46bdbd(0x180)],'currency':_0x157eed[_0x46bdbd(0x1a0)],'status':_0x157eed['status'],'orderId':_0x157eed['orderId'],'gatewayOrderId':_0x157eed['gatewayOrderId'],'customerEmail':_0x157eed['customerEmail'],'customerName':_0x157eed['customerName'],'customerCountry':_0x157eed[_0x46bdbd(0x10b)],'customerIp':_0x157eed['customerIp'],'customerUa':_0x157eed[_0x46bdbd(0x1f1)],'failureMessage':_0x157eed[_0x46bdbd(0x17a)],'adminNotes':_0x157eed[_0x46bdbd(0x153)],'chargebackAmount':_0x157eed[_0x46bdbd(0x1d3)],'statusChangedBy':_0x157eed['statusChangedBy'],'statusChangedAt':_0x157eed[_0x46bdbd(0x161)],'createdAt':_0x157eed['createdAt'],'updatedAt':_0x157eed[_0x46bdbd(0x1cc)],'shop':_0x157eed[_0x46bdbd(0x12d)]};}async[a35_0x628281(0x1da)](_0x59f65f,_0x4226b6){const _0x525304=a35_0x628281,_0x3e722d={..._0x4226b6};_0x4226b6[_0x525304(0x212)]&&(_0x3e722d[_0x525304(0x212)]=await bcryptjs_1['default'][_0x525304(0x175)](_0x4226b6['password'],0xc));_0x4226b6[_0x525304(0x17e)]&&(_0x3e722d[_0x525304(0x18e)]=_0x4226b6[_0x525304(0x17e)],delete _0x3e722d['fullName']);_0x4226b6[_0x525304(0x1a1)]&&(_0x3e722d[_0x525304(0x1ae)]=_0x4226b6['telegramId'],delete _0x3e722d['telegramId']);_0x4226b6[_0x525304(0x178)]&&(_0x3e722d[_0x525304(0x15c)]=_0x4226b6[_0x525304(0x178)],delete _0x3e722d[_0x525304(0x178)]);_0x4226b6[_0x525304(0x12b)]&&(_0x3e722d[_0x525304(0x14d)]=JSON[_0x525304(0x215)](_0x4226b6[_0x525304(0x12b)]),delete _0x3e722d[_0x525304(0x12b)]);_0x4226b6['gatewaySettings']&&(_0x3e722d['gatewaySettings']=JSON['stringify'](_0x4226b6[_0x525304(0x179)]));_0x4226b6[_0x525304(0x152)]&&(_0x4226b6[_0x525304(0x152)][_0x525304(0x16a)]!==undefined&&(_0x3e722d[_0x525304(0x16a)]=_0x4226b6[_0x525304(0x152)][_0x525304(0x16a)]||null),_0x4226b6[_0x525304(0x152)][_0x525304(0x105)]!==undefined&&(_0x3e722d[_0x525304(0x105)]=_0x4226b6[_0x525304(0x152)][_0x525304(0x105)]||null),_0x4226b6['wallets'][_0x525304(0x150)]!==undefined&&(_0x3e722d['usdtErcWallet']=_0x4226b6[_0x525304(0x152)]['usdtErcWallet']||null),_0x4226b6['wallets'][_0x525304(0x128)]!==undefined&&(_0x3e722d[_0x525304(0x128)]=_0x4226b6[_0x525304(0x152)]['usdcPolygonWallet']||null),delete _0x3e722d[_0x525304(0x152)]);const _0x246b6c=await database_1[_0x525304(0x17c)][_0x525304(0x12d)]['update']({'where':{'id':_0x59f65f},'data':_0x3e722d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x246b6c['id'],'fullName':_0x246b6c[_0x525304(0x18e)],'username':_0x246b6c[_0x525304(0x10c)],'telegramId':_0x246b6c['telegram'],'merchantUrl':_0x246b6c[_0x525304(0x15c)],'gateways':_0x246b6c[_0x525304(0x14d)]?JSON[_0x525304(0x1cf)](_0x246b6c[_0x525304(0x14d)]):null,'gatewaySettings':_0x246b6c[_0x525304(0x179)]?JSON[_0x525304(0x1cf)](_0x246b6c[_0x525304(0x179)]):null,'publicKey':_0x246b6c[_0x525304(0x21a)],'wallets':{'usdtPolygonWallet':_0x246b6c[_0x525304(0x16a)],'usdtTrcWallet':_0x246b6c[_0x525304(0x105)],'usdtErcWallet':_0x246b6c['usdtErcWallet'],'usdcPolygonWallet':_0x246b6c['usdcPolygonWallet']},'status':_0x246b6c[_0x525304(0x1c0)],'createdAt':_0x246b6c[_0x525304(0x1ef)]};}async[a35_0x628281(0x17d)](_0x473d7a){const _0x1e8c77=a35_0x628281,_0xa94fc4=await database_1[_0x1e8c77(0x17c)][_0x1e8c77(0x12d)][_0x1e8c77(0x12f)]({'where':{'id':_0x473d7a},'data':{'status':_0x1e8c77(0x1bc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xa94fc4['id'],'fullName':_0xa94fc4['name'],'username':_0xa94fc4['username'],'telegramId':_0xa94fc4[_0x1e8c77(0x1ae)],'merchantUrl':_0xa94fc4[_0x1e8c77(0x15c)],'gateways':_0xa94fc4[_0x1e8c77(0x14d)]?JSON['parse'](_0xa94fc4[_0x1e8c77(0x14d)]):null,'gatewaySettings':_0xa94fc4[_0x1e8c77(0x179)]?JSON['parse'](_0xa94fc4[_0x1e8c77(0x179)]):null,'publicKey':_0xa94fc4['publicKey'],'wallets':{'usdtPolygonWallet':_0xa94fc4['usdtPolygonWallet'],'usdtTrcWallet':_0xa94fc4[_0x1e8c77(0x105)],'usdtErcWallet':_0xa94fc4[_0x1e8c77(0x150)],'usdcPolygonWallet':_0xa94fc4[_0x1e8c77(0x128)]},'status':_0xa94fc4[_0x1e8c77(0x1c0)],'createdAt':_0xa94fc4[_0x1e8c77(0x1ef)]};}async[a35_0x628281(0x1fc)](_0x333b5a){const _0x1cf12d=a35_0x628281,_0x18b104=await database_1[_0x1cf12d(0x17c)]['shop'][_0x1cf12d(0x12f)]({'where':{'id':_0x333b5a},'data':{'status':_0x1cf12d(0x19d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x18b104['id'],'fullName':_0x18b104[_0x1cf12d(0x18e)],'username':_0x18b104[_0x1cf12d(0x10c)],'telegramId':_0x18b104[_0x1cf12d(0x1ae)],'merchantUrl':_0x18b104['shopUrl'],'gateways':_0x18b104[_0x1cf12d(0x14d)]?JSON[_0x1cf12d(0x1cf)](_0x18b104['paymentGateways']):null,'gatewaySettings':_0x18b104[_0x1cf12d(0x179)]?JSON[_0x1cf12d(0x1cf)](_0x18b104[_0x1cf12d(0x179)]):null,'publicKey':_0x18b104[_0x1cf12d(0x21a)],'wallets':{'usdtPolygonWallet':_0x18b104['usdtPolygonWallet'],'usdtTrcWallet':_0x18b104[_0x1cf12d(0x105)],'usdtErcWallet':_0x18b104[_0x1cf12d(0x150)],'usdcPolygonWallet':_0x18b104[_0x1cf12d(0x128)]},'status':_0x18b104[_0x1cf12d(0x1c0)],'createdAt':_0x18b104[_0x1cf12d(0x1ef)]};}async['getAllUsers'](_0x10c6f9){const _0x547ae1=a35_0x628281,{page:_0x46866c,limit:_0x42903a,status:_0x3f8fe9}=_0x10c6f9,_0x2e43f5=(_0x46866c-0x1)*_0x42903a,_0x41ab30={};_0x3f8fe9&&(_0x41ab30[_0x547ae1(0x1c0)]=_0x3f8fe9[_0x547ae1(0x1b5)]());const [_0x5d4e6c,_0x4c91ad]=await Promise['all']([database_1['default'][_0x547ae1(0x12d)]['findMany']({'where':_0x41ab30,'skip':_0x2e43f5,'take':_0x42903a,'orderBy':{'createdAt':_0x547ae1(0x20a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x547ae1(0x17c)][_0x547ae1(0x12d)][_0x547ae1(0x1c4)]({'where':_0x41ab30})]);return{'users':_0x5d4e6c[_0x547ae1(0x1c7)](_0x5cfb64=>({'id':_0x5cfb64['id'],'fullName':_0x5cfb64[_0x547ae1(0x18e)],'username':_0x5cfb64[_0x547ae1(0x10c)],'telegramId':_0x5cfb64['telegram'],'merchantUrl':_0x5cfb64['shopUrl'],'gateways':_0x5cfb64['paymentGateways']?JSON[_0x547ae1(0x1cf)](_0x5cfb64['paymentGateways']):null,'gatewaySettings':_0x5cfb64[_0x547ae1(0x179)]?JSON[_0x547ae1(0x1cf)](_0x5cfb64[_0x547ae1(0x179)]):null,'publicKey':_0x5cfb64[_0x547ae1(0x21a)],'wallets':{'usdtPolygonWallet':_0x5cfb64[_0x547ae1(0x16a)],'usdtTrcWallet':_0x5cfb64[_0x547ae1(0x105)],'usdtErcWallet':_0x5cfb64[_0x547ae1(0x150)],'usdcPolygonWallet':_0x5cfb64[_0x547ae1(0x128)]},'status':_0x5cfb64[_0x547ae1(0x1c0)],'createdAt':_0x5cfb64[_0x547ae1(0x1ef)]})),'pagination':{'page':_0x46866c,'limit':_0x42903a,'total':_0x4c91ad,'totalPages':Math[_0x547ae1(0x204)](_0x4c91ad/_0x42903a)}};}async[a35_0x628281(0x19b)](_0x2d6f5d){const _0x2257f3=a35_0x628281,_0x314b5e=await database_1[_0x2257f3(0x17c)]['shop'][_0x2257f3(0x12e)]({'where':{'id':_0x2d6f5d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x314b5e)return null;return{'id':_0x314b5e['id'],'fullName':_0x314b5e[_0x2257f3(0x18e)],'username':_0x314b5e[_0x2257f3(0x10c)],'telegramId':_0x314b5e[_0x2257f3(0x1ae)],'merchantUrl':_0x314b5e[_0x2257f3(0x15c)],'gateways':_0x314b5e['paymentGateways']?JSON[_0x2257f3(0x1cf)](_0x314b5e['paymentGateways']):null,'gatewaySettings':_0x314b5e[_0x2257f3(0x179)]?JSON[_0x2257f3(0x1cf)](_0x314b5e[_0x2257f3(0x179)]):null,'publicKey':_0x314b5e['publicKey'],'wallets':{'usdtPolygonWallet':_0x314b5e[_0x2257f3(0x16a)],'usdtTrcWallet':_0x314b5e[_0x2257f3(0x105)],'usdtErcWallet':_0x314b5e['usdtErcWallet'],'usdcPolygonWallet':_0x314b5e[_0x2257f3(0x128)]},'status':_0x314b5e[_0x2257f3(0x1c0)],'createdAt':_0x314b5e[_0x2257f3(0x1ef)]};}async[a35_0x628281(0x186)](_0x47393b){const _0x443891=a35_0x628281,{fullName:_0x5d7ccd,username:_0x2b9f96,password:_0x33bb4b,telegramId:_0x39db42,merchantUrl:_0x4c208e,gateways:_0x2812b,gatewaySettings:_0x22c05a,wallets:_0x4719ee}=_0x47393b,_0x292801=await database_1[_0x443891(0x17c)][_0x443891(0x12d)]['findUnique']({'where':{'username':_0x2b9f96}});if(_0x292801)throw new Error(_0x443891(0x1c1));if(_0x39db42){const _0x59f9fe=await database_1['default'][_0x443891(0x12d)]['findUnique']({'where':{'telegram':_0x39db42}});if(_0x59f9fe)throw new Error(_0x443891(0x1c2));}const _0x37612a=await bcryptjs_1['default'][_0x443891(0x175)](_0x33bb4b,0xc),_0x4bf70d=_0x443891(0x21f)+crypto_1[_0x443891(0x17c)][_0x443891(0x195)](0x20)['toString'](_0x443891(0x129)),_0x5889c8=_0x443891(0x20c)+crypto_1[_0x443891(0x17c)][_0x443891(0x195)](0x20)[_0x443891(0x1ab)](_0x443891(0x129)),_0x3a382a=await database_1[_0x443891(0x17c)][_0x443891(0x12d)][_0x443891(0x170)]({'data':{'name':_0x5d7ccd,'username':_0x2b9f96,'password':_0x37612a,'telegram':_0x39db42,'shopUrl':_0x4c208e,'paymentGateways':_0x2812b?JSON['stringify'](_0x2812b):null,'gatewaySettings':_0x22c05a?JSON[_0x443891(0x215)](_0x22c05a):null,'usdtPolygonWallet':_0x4719ee?.[_0x443891(0x16a)]||null,'usdtTrcWallet':_0x4719ee?.['usdtTrcWallet']||null,'usdtErcWallet':_0x4719ee?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x4719ee?.['usdcPolygonWallet']||null,'publicKey':_0x4bf70d,'secretKey':_0x5889c8,'status':_0x443891(0x19d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3a382a['id'],'fullName':_0x3a382a[_0x443891(0x18e)],'username':_0x3a382a[_0x443891(0x10c)],'telegramId':_0x3a382a[_0x443891(0x1ae)],'merchantUrl':_0x3a382a[_0x443891(0x15c)],'gateways':_0x3a382a[_0x443891(0x14d)]?JSON['parse'](_0x3a382a[_0x443891(0x14d)]):null,'gatewaySettings':_0x3a382a[_0x443891(0x179)]?JSON[_0x443891(0x1cf)](_0x3a382a[_0x443891(0x179)]):null,'publicKey':_0x3a382a[_0x443891(0x21a)],'wallets':{'usdtPolygonWallet':_0x3a382a[_0x443891(0x16a)],'usdtTrcWallet':_0x3a382a[_0x443891(0x105)],'usdtErcWallet':_0x3a382a[_0x443891(0x150)],'usdcPolygonWallet':_0x3a382a[_0x443891(0x128)]},'status':_0x3a382a['status'],'createdAt':_0x3a382a[_0x443891(0x1ef)]};}async['deleteUser'](_0xec04b6){const _0x570fa4=a35_0x628281;await database_1[_0x570fa4(0x17c)][_0x570fa4(0x12d)]['delete']({'where':{'id':_0xec04b6}});}async[a35_0x628281(0x183)](_0x1daedd){const _0x499c74=a35_0x628281,_0x3e65c6={};_0x1daedd&&[_0x499c74(0x19d),_0x499c74(0x1f8),_0x499c74(0x1bc)][_0x499c74(0x14f)](_0x1daedd[_0x499c74(0x1b5)]())&&(_0x3e65c6[_0x499c74(0x1c0)]=_0x1daedd[_0x499c74(0x1b5)]());const _0x1e0086=await database_1['default'][_0x499c74(0x12d)][_0x499c74(0x156)]({'where':_0x3e65c6,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x499c74(0x133)}});return _0x1e0086;}}exports[a35_0x628281(0x107)]=AdminService;