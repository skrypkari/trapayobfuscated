'use strict';function a33_0x1c72(_0x51f150,_0x5b36cd){const _0x2b861e=a33_0x2b86();return a33_0x1c72=function(_0x1c72cd,_0x33f62d){_0x1c72cd=_0x1c72cd-0x196;let _0x3d117d=_0x2b861e[_0x1c72cd];return _0x3d117d;},a33_0x1c72(_0x51f150,_0x5b36cd);}const a33_0x27f168=a33_0x1c72;(function(_0x57c1af,_0x4261f0){const _0x5d32b8=a33_0x1c72,_0xdde553=_0x57c1af();while(!![]){try{const _0x19be5b=-parseInt(_0x5d32b8(0x1e0))/0x1+parseInt(_0x5d32b8(0x1aa))/0x2+parseInt(_0x5d32b8(0x1bc))/0x3*(-parseInt(_0x5d32b8(0x1e7))/0x4)+parseInt(_0x5d32b8(0x1ab))/0x5*(-parseInt(_0x5d32b8(0x22b))/0x6)+-parseInt(_0x5d32b8(0x265))/0x7*(-parseInt(_0x5d32b8(0x21d))/0x8)+parseInt(_0x5d32b8(0x243))/0x9+-parseInt(_0x5d32b8(0x1d0))/0xa*(-parseInt(_0x5d32b8(0x1f0))/0xb);if(_0x19be5b===_0x4261f0)break;else _0xdde553['push'](_0xdde553['shift']());}catch(_0x244039){_0xdde553['push'](_0xdde553['shift']());}}}(a33_0x2b86,0xdc375));var __importDefault=this&&this['__importDefault']||function(_0x3c50cb){const _0x50c924=a33_0x1c72;return _0x3c50cb&&_0x3c50cb[_0x50c924(0x24c)]?_0x3c50cb:{'default':_0x3c50cb};};Object['defineProperty'](exports,a33_0x27f168(0x24c),{'value':!![]}),exports[a33_0x27f168(0x1b9)]=void 0x0;const database_1=__importDefault(require(a33_0x27f168(0x19f))),currencyService_1=require(a33_0x27f168(0x1cd)),userService_1=require(a33_0x27f168(0x218)),telegramBotService_1=require(a33_0x27f168(0x254)),gateway_1=require(a33_0x27f168(0x19c));function a33_0x2b86(){const _0x3de736=['üí∏\x20Chargeback\x20penalty:\x20','\x20deleted\x20successfully','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','payoutDelay','webhookLogs','üí∏\x20Creating\x20payout\x20for\x20shop\x20','push','amountUSDT','16961SLgTFZ','commission','üìã\x20Getting\x20users\x20with\x20filters:','‚úÖ\x20Payout\x20created\x20successfully:\x20','join','UserService','status_update','all','üìã\x20Getting\x20payouts\x20with\x20filters:','üìà\x20Average\x20payment:\x20','‚úÖ\x20User\x20','\x20days)','REFUND','externalPaymentUrl','../types/gateway','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','‚ùå\x20Payout\x20not\x20found:\x20','../config/database','log','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','cardLast4','‚è≥\x20Awaiting\x20Payout:\x20','sendPayoutNotification','ceil','usage','‚úÖ\x20Found\x20payment:\x20','üë•\x20Total\x20users:\x20','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','2260296UuErnn','5CApYIs','üìä\x20Calculating\x20admin\x20payout\x20statistics...','toISOString','getMerchantsAwaitingPayout','calculateEffectiveAmount','getAllPayments','Payment\x20not\x20found','\x20merchants\x20with\x20eligible\x20PAID\x20payments','getDate','telegramBotService','\x20activated\x20successfully','getGatewayNameById','payments','default','AdminService','set','telegram','2383185IsbxMi','PAID','paymentMethod','statusChangedBy','amount','deletePayout','updatedAt','üí∞\x20Total\x20amount:\x20','notes','slice','activateUser','lte','bankId','adminNotes','remitterIban','‚úÖ\x20Payout\x20','awaitingPayout','./currencyService','updateUser','userService','30vcPyTo','status','üí∞\x20Available\x20Balance:\x20','üí≥\x20Total\x20payments:\x20','orderId','shopId','length','calculateAmountAfterCommission','get','üìã\x20Getting\x20payments\x20with\x20filters:','findUnique','currencyService','remitterName','COMPLETED','abs','chargebackAmount','1624916iRjJBA','getUserById','getAllUsers','createPayout','error','\x20payments\x20as\x20paid\x20out','map','8eSbGmd','\x20status\x20to:\x20','setDate','90d','customerEmail','merchantPaid','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','availableBalance','üè™\x20Found\x20','7188214IleOHD','has','totalPayout','includes','User\x20is\x20already\x20active','üíµ\x20Total\x20revenue:\x20','toLowerCase','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','findMany','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','gatewayPaymentId','User\x20not\x20found','txid','toFixed','‚úÖ\x20Payout\x20statistics\x20calculated:','getAllPayouts','count','\x20USDT\x20(','Shop\x20is\x20not\x20active','parse','getMonth','üí∞\x20Found\x20','name',',\x20amount:\x20','totalAmountAfterCommissionUSDT','PROCESSING','\x20suspended\x20successfully','totalAmountUSDT','desc','SUSPENDED','\x20to\x20','payout','gte','generateDateRange','paidAt','\x20USDT','toUpperCase','isValidGatewayId','‚úÖ\x20Returning\x20','getPeriodDays','./userService','insensitive','üîç\x20Getting\x20payment\x20by\x20ID:\x20','\x20days','getGatewaySettings','4296tRSHzC','üóëÔ∏è\x20Deleting\x20payout:\x20','username','getPayoutStats','CHARGEBACK','currency','üí∏\x20Chargeback\x20amount:\x20','amountAfterCommissionUSDT','üìä\x20Found\x20','\x20payouts\x20out\x20of\x20','publicKey','paymentGateways','asc','ACTIVE','8600346CibOBC','sort','expiresAt','network','\x20USDT\x20via\x20','\x20total','charAt','\x20USDT\x20after\x20commission)','getFullYear','‚úÖ\x20Activating\x20user:\x20','date','PENDING','deleteUser','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','payment','usdtErcWallet','suspendUser','shop','convertToUSDT','createUser','User\x20is\x20already\x20suspended','isEligibleForPayout','statusChangedAt','\x20USDT\x20(penalty\x20amount)','10416429oyyWKt','FAILED','30d','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','gatewaySettings','shopUrl','entries','getPayoutById','usdtTrcWallet','__esModule','üìä\x20Daily\x20revenue\x20entries:\x20','createdAt','gateway','size','üí∏\x20Total\x20Payout:\x20','usdcPolygonWallet','create','./telegramBotService','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','gatewayOrderId','delete','updatePaymentStatus','split','customerName','reduce','round'];a33_0x2b86=function(){return _0x3de736;};return a33_0x2b86();}class AdminService{constructor(){const _0x5f32a5=a33_0x27f168;this[_0x5f32a5(0x1cf)]=new userService_1[(_0x5f32a5(0x26a))]();}[a33_0x27f168(0x217)](_0x24f3dc){const _0x2117eb=a33_0x27f168;switch(_0x24f3dc){case'7d':return 0x7;case _0x2117eb(0x245):return 0x1e;case _0x2117eb(0x1ea):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x27f168(0x211)](_0x16a71a,_0x54be5c){const _0x431db7=a33_0x27f168,_0x522d63=[],_0x4b784b=new Date(_0x16a71a);while(_0x4b784b<=_0x54be5c){_0x522d63['push'](_0x4b784b[_0x431db7(0x1ad)]()[_0x431db7(0x259)]('T')[0x0]),_0x4b784b[_0x431db7(0x1e9)](_0x4b784b[_0x431db7(0x1b3)]()+0x1);}return _0x522d63;}[a33_0x27f168(0x21c)](_0xa64460,_0x395e47){const _0x53a250=a33_0x27f168;if(!_0xa64460[_0x53a250(0x247)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x16200e=JSON[_0x53a250(0x203)](_0xa64460[_0x53a250(0x247)]),_0x5ef547=_0x395e47[_0x53a250(0x231)](0x0)[_0x53a250(0x214)]()+_0x395e47[_0x53a250(0x1c5)](0x1)[_0x53a250(0x1f6)]();if(_0x16200e&&_0x16200e[_0x5ef547])return{'commission':_0x16200e[_0x5ef547][_0x53a250(0x266)]||0x0,'payoutDelay':_0x16200e[_0x5ef547][_0x53a250(0x260)]||0x0};}catch(_0x1da3b1){console[_0x53a250(0x1e4)]('Error\x20parsing\x20gateway\x20settings:',_0x1da3b1);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x27f168(0x240)](_0x216d08){const _0x2e965c=a33_0x27f168;if(_0x216d08['status']!==_0x2e965c(0x1bd)||_0x216d08[_0x2e965c(0x1ec)]||!_0x216d08[_0x2e965c(0x212)])return![];const _0x283774=this['getGatewaySettings'](_0x216d08[_0x2e965c(0x23c)],_0x216d08[_0x2e965c(0x24f)]),_0x21a605=_0x283774[_0x2e965c(0x260)]*0x18*0x3c*0x3c*0x3e8,_0x3d82ee=new Date(_0x216d08[_0x2e965c(0x212)]['getTime']()+_0x21a605);return new Date()>_0x3d82ee;}[a33_0x27f168(0x1d7)](_0x4af014,_0x400c0d){return _0x4af014*(0x1-_0x400c0d/0x64);}[a33_0x27f168(0x1af)](_0x1f3518){const _0x28c821=a33_0x27f168;switch(_0x1f3518[_0x28c821(0x1d1)]){case _0x28c821(0x1bd):return _0x1f3518[_0x28c821(0x1c0)];case _0x28c821(0x221):return-(_0x1f3518['chargebackAmount']||0x0);case _0x28c821(0x19a):return 0x0;default:return 0x0;}}async[a33_0x27f168(0x1e3)](_0x2c60e9){const _0x46b84a=a33_0x27f168,{shopId:_0xf0e338,amount:_0xf16b8f,network:_0x51bfc9,notes:_0x202b51}=_0x2c60e9;console[_0x46b84a(0x1a0)](_0x46b84a(0x262)+_0xf0e338+':\x20'+_0xf16b8f+_0x46b84a(0x22f)+_0x51bfc9);const _0x19df79=await database_1[_0x46b84a(0x1b8)][_0x46b84a(0x23c)][_0x46b84a(0x1da)]({'where':{'id':_0xf0e338},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x19df79)throw new Error('Shop\x20not\x20found');if(_0x19df79['status']!==_0x46b84a(0x22a))throw new Error(_0x46b84a(0x202));const _0x1f73c5=await database_1['default']['payout'][_0x46b84a(0x253)]({'data':{'shopId':_0xf0e338,'amount':_0xf16b8f,'network':_0x51bfc9,'status':_0x46b84a(0x1dd),'notes':_0x202b51||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this['markPaymentsAsPaidOut'](_0xf0e338,_0xf16b8f);try{await telegramBotService_1[_0x46b84a(0x1b4)][_0x46b84a(0x1a4)](_0xf0e338,_0x1f73c5,'completed');}catch(_0x462570){console[_0x46b84a(0x1e4)](_0x46b84a(0x1ed),_0x462570);}return console[_0x46b84a(0x1a0)](_0x46b84a(0x268)+_0x1f73c5['id']),{'id':_0x1f73c5['id'],'shopId':_0x1f73c5[_0x46b84a(0x1d5)],'shopName':_0x1f73c5[_0x46b84a(0x23c)]['name'],'shopUsername':_0x1f73c5[_0x46b84a(0x23c)][_0x46b84a(0x21f)],'amount':_0x1f73c5[_0x46b84a(0x1c0)],'network':_0x1f73c5[_0x46b84a(0x22e)],'status':_0x1f73c5[_0x46b84a(0x1d1)],'txid':_0x1f73c5['txid'],'notes':_0x1f73c5[_0x46b84a(0x1c4)],'createdAt':_0x1f73c5['createdAt'],'paidAt':_0x1f73c5['paidAt']};}async['markPaymentsAsPaidOut'](_0x1ae952,_0x9d07a7){const _0x215fda=a33_0x27f168;console[_0x215fda(0x1a0)](_0x215fda(0x246)+_0x1ae952+_0x215fda(0x207)+_0x9d07a7+_0x215fda(0x213));const _0x2dff59=await database_1[_0x215fda(0x1b8)][_0x215fda(0x239)]['findMany']({'where':{'shopId':_0x1ae952,'status':_0x215fda(0x1bd),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x215fda(0x229)}});let _0x479cec=_0x9d07a7;const _0x126ab5=[];for(const _0x1a43ec of _0x2dff59){const _0x2a76bd={..._0x1a43ec,'status':_0x215fda(0x1bd),'merchantPaid':![],'shop':{'gatewaySettings':_0x1a43ec[_0x215fda(0x23c)][_0x215fda(0x247)]}};if(!this[_0x215fda(0x240)](_0x2a76bd))continue;const _0x19cda6=await currencyService_1[_0x215fda(0x1db)]['convertToUSDT'](_0x1a43ec[_0x215fda(0x1c0)],_0x1a43ec[_0x215fda(0x222)]),_0x2bb146=this['getGatewaySettings'](_0x1a43ec[_0x215fda(0x23c)],_0x1a43ec[_0x215fda(0x24f)]),_0x177efb=this[_0x215fda(0x1d7)](_0x19cda6,_0x2bb146['commission']);if(_0x177efb<=_0x479cec){_0x126ab5[_0x215fda(0x263)](_0x1a43ec['id']),_0x479cec-=_0x177efb;if(_0x479cec<=0.01)break;}}_0x126ab5['length']>0x0&&(await database_1[_0x215fda(0x1b8)][_0x215fda(0x239)]['updateMany']({'where':{'id':{'in':_0x126ab5}},'data':{'merchantPaid':!![]}}),console[_0x215fda(0x1a0)]('‚úÖ\x20Marked\x20'+_0x126ab5[_0x215fda(0x1d6)]+_0x215fda(0x1e5)));}async[a33_0x27f168(0x1ff)](_0x38a676){const _0x3794bd=a33_0x27f168,{page:_0x12b9eb,limit:_0x3f1eb6,shopId:_0x5c1274,network:_0x5b36ab,dateFrom:_0x3bb369,dateTo:_0x38a45f,search:_0x14bedb}=_0x38a676,_0x57a5cc=(_0x12b9eb-0x1)*_0x3f1eb6;console[_0x3794bd(0x1a0)](_0x3794bd(0x196),_0x38a676);const _0x4319aa={};_0x5c1274&&(_0x4319aa[_0x3794bd(0x1d5)]=_0x5c1274);_0x5b36ab&&(_0x4319aa[_0x3794bd(0x22e)]=_0x5b36ab);(_0x3bb369||_0x38a45f)&&(_0x4319aa[_0x3794bd(0x24e)]={},_0x3bb369&&(_0x4319aa[_0x3794bd(0x24e)][_0x3794bd(0x210)]=new Date(_0x3bb369)),_0x38a45f&&(_0x4319aa[_0x3794bd(0x24e)][_0x3794bd(0x1c7)]=new Date(_0x38a45f)));_0x14bedb&&(_0x4319aa['OR']=[{'txid':{'contains':_0x14bedb,'mode':_0x3794bd(0x219)}},{'notes':{'contains':_0x14bedb,'mode':_0x3794bd(0x219)}},{'shop':{'name':{'contains':_0x14bedb,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x14bedb,'mode':_0x3794bd(0x219)}}}]);const [_0x3ec595,_0x140920]=await Promise[_0x3794bd(0x26c)]([database_1[_0x3794bd(0x1b8)]['payout'][_0x3794bd(0x1f8)]({'where':_0x4319aa,'skip':_0x57a5cc,'take':_0x3f1eb6,'orderBy':{'createdAt':_0x3794bd(0x20c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3794bd(0x1b8)][_0x3794bd(0x20f)]['count']({'where':_0x4319aa})]);console['log'](_0x3794bd(0x225)+_0x3ec595[_0x3794bd(0x1d6)]+_0x3794bd(0x226)+_0x140920+_0x3794bd(0x230));const _0x341325=_0x3ec595['map'](_0x7934da=>({'id':_0x7934da['id'],'shopId':_0x7934da['shopId'],'shopName':_0x7934da[_0x3794bd(0x23c)][_0x3794bd(0x206)],'shopUsername':_0x7934da[_0x3794bd(0x23c)]['username'],'amount':_0x7934da['amount'],'network':_0x7934da[_0x3794bd(0x22e)],'status':_0x7934da['status'],'txid':_0x7934da[_0x3794bd(0x1fc)],'notes':_0x7934da[_0x3794bd(0x1c4)],'createdAt':_0x7934da[_0x3794bd(0x24e)],'paidAt':_0x7934da[_0x3794bd(0x212)]}));return{'payouts':_0x341325,'pagination':{'page':_0x12b9eb,'limit':_0x3f1eb6,'total':_0x140920,'totalPages':Math[_0x3794bd(0x1a5)](_0x140920/_0x3f1eb6)}};}async[a33_0x27f168(0x24a)](_0x448fd9){const _0x47631e=a33_0x27f168;console[_0x47631e(0x1a0)]('üîç\x20Getting\x20payout\x20by\x20ID:\x20'+_0x448fd9);const _0xb1bd08=await database_1[_0x47631e(0x1b8)][_0x47631e(0x20f)][_0x47631e(0x1da)]({'where':{'id':_0x448fd9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xb1bd08)return console['log'](_0x47631e(0x19e)+_0x448fd9),null;return console[_0x47631e(0x1a0)]('‚úÖ\x20Found\x20payout:\x20'+_0xb1bd08[_0x47631e(0x1c0)]+_0x47631e(0x22f)+_0xb1bd08[_0x47631e(0x22e)]),{'id':_0xb1bd08['id'],'shopId':_0xb1bd08[_0x47631e(0x1d5)],'shopName':_0xb1bd08[_0x47631e(0x23c)][_0x47631e(0x206)],'shopUsername':_0xb1bd08['shop']['username'],'amount':_0xb1bd08[_0x47631e(0x1c0)],'network':_0xb1bd08[_0x47631e(0x22e)],'status':_0xb1bd08[_0x47631e(0x1d1)],'txid':_0xb1bd08[_0x47631e(0x1fc)],'notes':_0xb1bd08['notes'],'createdAt':_0xb1bd08[_0x47631e(0x24e)],'paidAt':_0xb1bd08[_0x47631e(0x212)]};}async[a33_0x27f168(0x1c1)](_0x284298){const _0x209529=a33_0x27f168;console[_0x209529(0x1a0)](_0x209529(0x21e)+_0x284298);const _0x5b04ad=await database_1[_0x209529(0x1b8)][_0x209529(0x20f)][_0x209529(0x1da)]({'where':{'id':_0x284298},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x5b04ad)throw new Error('Payout\x20not\x20found');await database_1[_0x209529(0x1b8)][_0x209529(0x20f)][_0x209529(0x257)]({'where':{'id':_0x284298}}),console['log'](_0x209529(0x1cb)+_0x284298+_0x209529(0x25e));}async[a33_0x27f168(0x1ae)](_0xf3a457){const _0x89d308=a33_0x27f168,{page:_0x48dcd4,limit:_0x4ef8c2,minAmount:_0x42c3be,search:_0xaa97bd}=_0xf3a457;console[_0x89d308(0x1a0)](_0x89d308(0x25f),_0xf3a457);const _0x5664f2=await database_1[_0x89d308(0x1b8)][_0x89d308(0x239)]['findMany']({'where':{'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log'](_0x89d308(0x205)+_0x5664f2[_0x89d308(0x1d6)]+_0x89d308(0x1a9));const _0x6e7b78=new Map();for(const _0x2cd30d of _0x5664f2){const _0x2a2340={..._0x2cd30d,'status':_0x89d308(0x1bd),'merchantPaid':![],'shop':{'gatewaySettings':_0x2cd30d[_0x89d308(0x23c)][_0x89d308(0x247)]}},_0x465ec=this[_0x89d308(0x240)](_0x2a2340);if(!_0x465ec)continue;const _0xbd197=await currencyService_1['currencyService'][_0x89d308(0x23d)](_0x2cd30d['amount'],_0x2cd30d['currency']),_0xef7e1a=this[_0x89d308(0x21c)](_0x2cd30d['shop'],_0x2cd30d[_0x89d308(0x24f)]),_0x859cc5=this['calculateAmountAfterCommission'](_0xbd197,_0xef7e1a[_0x89d308(0x266)]),_0x2cad57=_0x2cd30d[_0x89d308(0x1d5)];!_0x6e7b78[_0x89d308(0x1f1)](_0x2cad57)&&_0x6e7b78['set'](_0x2cad57,{'shop':_0x2cd30d[_0x89d308(0x23c)],'payments':[]}),_0x6e7b78[_0x89d308(0x1d8)](_0x2cad57)[_0x89d308(0x1b7)][_0x89d308(0x263)]({'id':_0x2cd30d['id'],'amount':_0x2cd30d[_0x89d308(0x1c0)],'currency':_0x2cd30d[_0x89d308(0x222)],'gateway':_0x2cd30d[_0x89d308(0x24f)],'paidAt':_0x2cd30d[_0x89d308(0x212)],'createdAt':_0x2cd30d[_0x89d308(0x24e)],'amountUSDT':_0xbd197,'commission':_0xef7e1a[_0x89d308(0x266)],'amountAfterCommissionUSDT':_0x859cc5,'isEligible':!![]});}console[_0x89d308(0x1a0)](_0x89d308(0x1ef)+_0x6e7b78[_0x89d308(0x250)]+_0x89d308(0x1b2));const _0x3a2370=[];for(const [_0xb28442,_0x40db6e]of _0x6e7b78){const {shop:_0x5c15ee,payments:_0x3295ec}=_0x40db6e,_0x4cd338=_0x3295ec['reduce']((_0x103798,_0x124e70)=>_0x103798+_0x124e70[_0x89d308(0x264)],0x0),_0x3d2cac=_0x3295ec['reduce']((_0x299dcd,_0x1dcac1)=>_0x299dcd+_0x1dcac1[_0x89d308(0x224)],0x0);if(_0x42c3be&&_0x3d2cac<_0x42c3be)continue;if(_0xaa97bd){const _0x163464=_0xaa97bd[_0x89d308(0x1f6)](),_0x5e9814=_0x5c15ee[_0x89d308(0x206)][_0x89d308(0x1f6)]()[_0x89d308(0x1f3)](_0x163464)||_0x5c15ee['username'][_0x89d308(0x1f6)]()[_0x89d308(0x1f3)](_0x163464)||_0x5c15ee[_0x89d308(0x1bb)]&&_0x5c15ee['telegram'][_0x89d308(0x1f6)]()[_0x89d308(0x1f3)](_0x163464);if(!_0x5e9814)continue;}const _0x11d621=new Map();for(const _0x859339 of _0x3295ec){const _0x3fcae0=_0x859339[_0x89d308(0x24f)];!_0x11d621[_0x89d308(0x1f1)](_0x3fcae0)&&_0x11d621[_0x89d308(0x1ba)](_0x3fcae0,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x859339[_0x89d308(0x266)]});const _0x323507=_0x11d621['get'](_0x3fcae0);_0x323507[_0x89d308(0x200)]++,_0x323507[_0x89d308(0x264)]+=_0x859339[_0x89d308(0x264)],_0x323507[_0x89d308(0x224)]+=_0x859339[_0x89d308(0x224)];}const _0x5f4f10=Array['from'](_0x11d621[_0x89d308(0x249)]())[_0x89d308(0x1e6)](([_0x523e8c,_0x51a56f])=>({'gateway':_0x523e8c['charAt'](0x0)[_0x89d308(0x214)]()+_0x523e8c[_0x89d308(0x1c5)](0x1),'count':_0x51a56f[_0x89d308(0x200)],'amountUSDT':Math['round'](_0x51a56f[_0x89d308(0x264)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x51a56f[_0x89d308(0x224)]*0x64)/0x64,'commission':_0x51a56f[_0x89d308(0x266)]})),_0x38a68f=_0x3295ec[_0x89d308(0x25b)]((_0x3e037e,_0x32f570)=>{const _0x499532=_0x89d308;return _0x32f570[_0x499532(0x212)]<_0x3e037e?_0x32f570[_0x499532(0x212)]:_0x3e037e;},_0x3295ec[0x0][_0x89d308(0x212)]);_0x3a2370[_0x89d308(0x263)]({'id':_0x5c15ee['id'],'fullName':_0x5c15ee[_0x89d308(0x206)],'username':_0x5c15ee[_0x89d308(0x21f)],'telegramId':_0x5c15ee['telegram'],'merchantUrl':_0x5c15ee[_0x89d308(0x248)],'wallets':{'usdtPolygonWallet':_0x5c15ee['usdtPolygonWallet'],'usdtTrcWallet':_0x5c15ee['usdtTrcWallet'],'usdtErcWallet':_0x5c15ee[_0x89d308(0x23a)],'usdcPolygonWallet':_0x5c15ee[_0x89d308(0x252)]},'totalAmountUSDT':Math[_0x89d308(0x25c)](_0x4cd338*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x89d308(0x25c)](_0x3d2cac*0x64)/0x64,'paymentsCount':_0x3295ec[_0x89d308(0x1d6)],'oldestPaymentDate':_0x38a68f,'gatewayBreakdown':_0x5f4f10});}_0x3a2370[_0x89d308(0x22c)]((_0x5cf2c2,_0x206caf)=>_0x206caf['totalAmountAfterCommissionUSDT']-_0x5cf2c2[_0x89d308(0x208)]);const _0x316ac4=_0x3a2370[_0x89d308(0x1d6)],_0x56990c=_0x3a2370[_0x89d308(0x25b)]((_0x192f82,_0x238742)=>_0x192f82+_0x238742[_0x89d308(0x20b)],0x0),_0x53fee7=_0x3a2370[_0x89d308(0x25b)]((_0x278d4,_0x4f3148)=>_0x278d4+_0x4f3148['totalAmountAfterCommissionUSDT'],0x0),_0x2805c0=(_0x48dcd4-0x1)*_0x4ef8c2,_0x4eb67f=_0x3a2370[_0x89d308(0x1c5)](_0x2805c0,_0x2805c0+_0x4ef8c2);return console[_0x89d308(0x1a0)](_0x89d308(0x216)+_0x4eb67f[_0x89d308(0x1d6)]+'\x20merchants\x20out\x20of\x20'+_0x316ac4+_0x89d308(0x230)),console[_0x89d308(0x1a0)](_0x89d308(0x1c3)+_0x56990c[_0x89d308(0x1fd)](0x2)+_0x89d308(0x201)+_0x53fee7[_0x89d308(0x1fd)](0x2)+_0x89d308(0x232)),{'merchants':_0x4eb67f,'pagination':{'page':_0x48dcd4,'limit':_0x4ef8c2,'total':_0x316ac4,'totalPages':Math['ceil'](_0x316ac4/_0x4ef8c2)},'summary':{'totalMerchants':_0x316ac4,'totalAmountUSDT':Math[_0x89d308(0x25c)](_0x56990c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x89d308(0x25c)](_0x53fee7*0x64)/0x64}};}async[a33_0x27f168(0x220)](){const _0x49e779=a33_0x27f168;console[_0x49e779(0x1a0)](_0x49e779(0x1ac));const _0x25ac01=await database_1[_0x49e779(0x1b8)]['payment'][_0x49e779(0x1f8)]({'where':{'status':{'in':[_0x49e779(0x1bd),_0x49e779(0x19a),_0x49e779(0x221)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x25ac01[_0x49e779(0x1d6)]+_0x49e779(0x255));const _0x3d6b8f=new Date(),_0x27ccf9=new Date(_0x3d6b8f[_0x49e779(0x233)](),_0x3d6b8f[_0x49e779(0x204)](),0x1),_0x26d441=new Date(_0x3d6b8f[_0x49e779(0x233)](),_0x3d6b8f[_0x49e779(0x204)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x546716=0x0,_0x40021c=0x0,_0xf5638f=0x0,_0x369e6e=0x0;for(const _0xaf1261 of _0x25ac01){const _0x9f3bf6=this['calculateEffectiveAmount'](_0xaf1261);if(_0x9f3bf6===0x0)continue;let _0x167d2f,_0x168e32;if(_0xaf1261[_0x49e779(0x1d1)]===_0x49e779(0x221))_0x167d2f=Math[_0x49e779(0x1de)](_0x9f3bf6),_0x168e32=-_0x167d2f;else{_0x167d2f=await currencyService_1['currencyService'][_0x49e779(0x23d)](_0xaf1261[_0x49e779(0x1c0)],_0xaf1261[_0x49e779(0x222)]);const _0x3c05de=this[_0x49e779(0x21c)](_0xaf1261[_0x49e779(0x23c)],_0xaf1261[_0x49e779(0x24f)]);_0x168e32=this['calculateAmountAfterCommission'](_0x167d2f,_0x3c05de[_0x49e779(0x266)]);}_0xaf1261[_0x49e779(0x1ec)]&&(_0x546716+=_0x168e32,_0xaf1261[_0x49e779(0x212)]&&_0xaf1261[_0x49e779(0x212)]>=_0x27ccf9&&_0xaf1261[_0x49e779(0x212)]<=_0x26d441&&(_0xf5638f+=_0x168e32)),_0xaf1261[_0x49e779(0x1d1)]==='PAID'&&this[_0x49e779(0x240)](_0xaf1261)&&(_0x40021c+=_0x168e32,_0x369e6e+=_0x167d2f);}const _0x1d5344={'totalPayout':Math[_0x49e779(0x25c)](_0x546716*0x64)/0x64,'awaitingPayout':Math[_0x49e779(0x25c)](_0x40021c*0x64)/0x64,'thisMonth':Math[_0x49e779(0x25c)](_0xf5638f*0x64)/0x64,'availableBalance':Math[_0x49e779(0x25c)](_0x369e6e*0x64)/0x64};return console[_0x49e779(0x1a0)](_0x49e779(0x1fe)),console[_0x49e779(0x1a0)](_0x49e779(0x251)+_0x1d5344[_0x49e779(0x1f2)]+_0x49e779(0x238)),console[_0x49e779(0x1a0)](_0x49e779(0x1a3)+_0x1d5344[_0x49e779(0x1cc)]+_0x49e779(0x1a1)),console[_0x49e779(0x1a0)]('üìÖ\x20This\x20Month:\x20'+_0x1d5344['thisMonth']+'\x20USDT'),console[_0x49e779(0x1a0)](_0x49e779(0x1d2)+_0x1d5344[_0x49e779(0x1ee)]+'\x20USDT'),_0x1d5344;}async['getSystemStatistics'](_0xf93dc8){const _0x192b6b=a33_0x27f168,_0x9b338b=this['getPeriodDays'](_0xf93dc8),_0x3090ce=new Date();_0x3090ce[_0x192b6b(0x1e9)](_0x3090ce[_0x192b6b(0x1b3)]()-_0x9b338b),console[_0x192b6b(0x1a0)](_0x192b6b(0x19d)+_0xf93dc8+'\x20('+_0x9b338b+_0x192b6b(0x199));const _0x38ff54=await database_1['default'][_0x192b6b(0x23c)][_0x192b6b(0x200)]({'where':{'status':_0x192b6b(0x22a)}}),_0x4faa92=await database_1['default'][_0x192b6b(0x239)]['count'](),_0x42a86f=await database_1['default'][_0x192b6b(0x239)][_0x192b6b(0x1f8)]({'where':{'status':{'in':[_0x192b6b(0x1bd),_0x192b6b(0x19a),_0x192b6b(0x221)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x192b6b(0x1a0)](_0x192b6b(0x205)+_0x42a86f['length']+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x557f5d=await Promise[_0x192b6b(0x26c)](_0x42a86f[_0x192b6b(0x1e6)](async _0xd6055b=>{const _0x56a016=_0x192b6b,_0xacbf2=this['calculateEffectiveAmount'](_0xd6055b);if(_0xacbf2===0x0)return{'amount':0x0,'createdAt':_0xd6055b['createdAt']};let _0x392463;return _0xd6055b[_0x56a016(0x1d1)]==='CHARGEBACK'?_0x392463=-Math[_0x56a016(0x1de)](_0xacbf2):_0x392463=await currencyService_1[_0x56a016(0x1db)]['convertToUSDT'](_0xd6055b[_0x56a016(0x1c0)],_0xd6055b['currency']),{'amount':_0x392463,'createdAt':_0xd6055b['createdAt']};})),_0x596b29=_0x557f5d[_0x192b6b(0x25b)]((_0x18144c,_0x427749)=>_0x18144c+_0x427749[_0x192b6b(0x1c0)],0x0),_0x3c7643=_0x4faa92>0x0?_0x596b29/_0x4faa92:0x0;console[_0x192b6b(0x1a0)](_0x192b6b(0x1f5)+_0x596b29['toFixed'](0x2)+_0x192b6b(0x238)),console[_0x192b6b(0x1a0)](_0x192b6b(0x197)+_0x3c7643[_0x192b6b(0x1fd)](0x2)+_0x192b6b(0x213));const _0x4c70c9=await database_1['default']['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x3090ce}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console['log'](_0x192b6b(0x1f9)+_0x4c70c9[_0x192b6b(0x1d6)]+_0x192b6b(0x21b));const _0x1631a3=await Promise[_0x192b6b(0x26c)](_0x4c70c9[_0x192b6b(0x1e6)](async _0x1cd24d=>{const _0x16ae3a=_0x192b6b,_0x1d01c9=await Promise[_0x16ae3a(0x26c)](_0x1cd24d[_0x16ae3a(0x1b7)][_0x16ae3a(0x1e6)](async _0x3c892e=>{const _0x3d0190=_0x16ae3a,_0x23d8cf=this['calculateEffectiveAmount'](_0x3c892e);if(_0x23d8cf===0x0)return 0x0;return _0x3c892e[_0x3d0190(0x1d1)]===_0x3d0190(0x221)?-Math[_0x3d0190(0x1de)](_0x23d8cf):await currencyService_1[_0x3d0190(0x1db)][_0x3d0190(0x23d)](_0x3c892e[_0x3d0190(0x1c0)],_0x3c892e[_0x3d0190(0x222)]);})),_0x39308f=_0x1d01c9[_0x16ae3a(0x25b)]((_0x4b7c84,_0x4dbf12)=>_0x4b7c84+_0x4dbf12,0x0);return{'date':_0x1cd24d[_0x16ae3a(0x235)][_0x16ae3a(0x1ad)]()['split']('T')[0x0],'amount':_0x39308f};})),_0x1108d2=this[_0x192b6b(0x211)](_0x3090ce,new Date()),_0x529a28=new Map(_0x1631a3[_0x192b6b(0x1e6)](_0x5a68eb=>[_0x5a68eb[_0x192b6b(0x235)],_0x5a68eb['amount']])),_0xf77b78=_0x1108d2[_0x192b6b(0x1e6)](_0x570302=>({'date':_0x570302,'amount':_0x529a28[_0x192b6b(0x1d8)](_0x570302)||0x0}));return console[_0x192b6b(0x1a0)]('‚úÖ\x20Admin\x20statistics\x20generated\x20successfully'),console[_0x192b6b(0x1a0)](_0x192b6b(0x1a8)+_0x38ff54),console[_0x192b6b(0x1a0)](_0x192b6b(0x1d3)+_0x4faa92),console[_0x192b6b(0x1a0)](_0x192b6b(0x24d)+_0xf77b78[_0x192b6b(0x1d6)]),{'totalRevenue':Math['round'](_0x596b29*0x64)/0x64,'totalUsers':_0x38ff54,'totalPayments':_0x4faa92,'averagePayment':Math['round'](_0x3c7643*0x64)/0x64,'dailyRevenue':_0xf77b78};}async[a33_0x27f168(0x1b0)](_0xdc26af){const _0x18ae14=a33_0x27f168,{page:_0xa32f3,limit:_0x54a620,status:_0x95a4a1,gateway:_0x1ca1b1,shopId:_0x5cfaaf,dateFrom:_0x5b429b,dateTo:_0x100be0,search:_0x475643}=_0xdc26af,_0x5a5d78=(_0xa32f3-0x1)*_0x54a620;console[_0x18ae14(0x1a0)](_0x18ae14(0x1d9),_0xdc26af);const _0x5af5aa={};_0x95a4a1&&(_0x5af5aa['status']=_0x95a4a1[_0x18ae14(0x214)]());if(_0x1ca1b1){if((0x0,gateway_1[_0x18ae14(0x215)])(_0x1ca1b1)){const _0x3d035c=(0x0,gateway_1[_0x18ae14(0x1b6)])(_0x1ca1b1);_0x3d035c&&(_0x5af5aa[_0x18ae14(0x24f)]=_0x3d035c);}else _0x5af5aa[_0x18ae14(0x24f)]=_0x1ca1b1[_0x18ae14(0x1f6)]();}_0x5cfaaf&&(_0x5af5aa[_0x18ae14(0x1d5)]=_0x5cfaaf);(_0x5b429b||_0x100be0)&&(_0x5af5aa[_0x18ae14(0x24e)]={},_0x5b429b&&(_0x5af5aa['createdAt'][_0x18ae14(0x210)]=new Date(_0x5b429b)),_0x100be0&&(_0x5af5aa[_0x18ae14(0x24e)]['lte']=new Date(_0x100be0)));_0x475643&&(_0x5af5aa['OR']=[{'orderId':{'contains':_0x475643,'mode':_0x18ae14(0x219)}},{'gatewayOrderId':{'contains':_0x475643,'mode':_0x18ae14(0x219)}},{'gatewayPaymentId':{'contains':_0x475643,'mode':_0x18ae14(0x219)}},{'customerEmail':{'contains':_0x475643,'mode':_0x18ae14(0x219)}},{'customerName':{'contains':_0x475643,'mode':_0x18ae14(0x219)}},{'shop':{'name':{'contains':_0x475643,'mode':_0x18ae14(0x219)}}},{'shop':{'username':{'contains':_0x475643,'mode':_0x18ae14(0x219)}}}]);const [_0x5168a7,_0x7841b6]=await Promise[_0x18ae14(0x26c)]([database_1['default'][_0x18ae14(0x239)][_0x18ae14(0x1f8)]({'where':_0x5af5aa,'skip':_0x5a5d78,'take':_0x54a620,'orderBy':{'createdAt':_0x18ae14(0x20c)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x18ae14(0x1b8)][_0x18ae14(0x239)][_0x18ae14(0x200)]({'where':_0x5af5aa})]);console[_0x18ae14(0x1a0)](_0x18ae14(0x225)+_0x5168a7['length']+'\x20payments\x20out\x20of\x20'+_0x7841b6+_0x18ae14(0x230));const _0x21eee8=_0x5168a7['map'](_0x1204b3=>({'id':_0x1204b3['id'],'shopId':_0x1204b3[_0x18ae14(0x1d5)],'shopName':_0x1204b3['shop'][_0x18ae14(0x206)],'shopUsername':_0x1204b3[_0x18ae14(0x23c)][_0x18ae14(0x21f)],'gateway':_0x1204b3[_0x18ae14(0x24f)],'orderId':_0x1204b3[_0x18ae14(0x1d4)],'gatewayOrderId':_0x1204b3[_0x18ae14(0x256)],'amount':_0x1204b3[_0x18ae14(0x1c0)],'currency':_0x1204b3['currency'],'sourceCurrency':_0x1204b3['sourceCurrency'],'status':_0x1204b3[_0x18ae14(0x1d1)],'usage':_0x1204b3[_0x18ae14(0x1a6)],'externalPaymentUrl':_0x1204b3[_0x18ae14(0x19b)],'gatewayPaymentId':_0x1204b3[_0x18ae14(0x1fa)],'customerEmail':_0x1204b3[_0x18ae14(0x1eb)],'customerName':_0x1204b3[_0x18ae14(0x25a)],'cardLast4':_0x1204b3[_0x18ae14(0x1a2)],'paymentMethod':_0x1204b3[_0x18ae14(0x1be)],'bankId':_0x1204b3[_0x18ae14(0x1c8)],'remitterIban':_0x1204b3[_0x18ae14(0x1ca)],'remitterName':_0x1204b3[_0x18ae14(0x1dc)],'chargebackAmount':_0x1204b3[_0x18ae14(0x1df)],'adminNotes':_0x1204b3[_0x18ae14(0x1c9)],'statusChangedBy':_0x1204b3[_0x18ae14(0x1bf)],'statusChangedAt':_0x1204b3[_0x18ae14(0x241)],'createdAt':_0x1204b3[_0x18ae14(0x24e)],'updatedAt':_0x1204b3['updatedAt'],'expiresAt':_0x1204b3[_0x18ae14(0x22d)]}));return{'payments':_0x21eee8,'pagination':{'page':_0xa32f3,'limit':_0x54a620,'total':_0x7841b6,'totalPages':Math[_0x18ae14(0x1a5)](_0x7841b6/_0x54a620)}};}async['getPaymentById'](_0x45a613){const _0x58aa18=a33_0x27f168;console[_0x58aa18(0x1a0)](_0x58aa18(0x21a)+_0x45a613);const _0x41121c=await database_1[_0x58aa18(0x1b8)][_0x58aa18(0x239)]['findUnique']({'where':{'id':_0x45a613},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x58aa18(0x20c)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x41121c)return console[_0x58aa18(0x1a0)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x45a613),null;return console[_0x58aa18(0x1a0)](_0x58aa18(0x1a7)+_0x41121c[_0x58aa18(0x1d4)]+'\x20('+_0x41121c['status']+')'),{'id':_0x41121c['id'],'shopId':_0x41121c[_0x58aa18(0x1d5)],'shopName':_0x41121c[_0x58aa18(0x23c)][_0x58aa18(0x206)],'shopUsername':_0x41121c['shop']['username'],'gateway':_0x41121c[_0x58aa18(0x24f)],'orderId':_0x41121c['orderId'],'gatewayOrderId':_0x41121c[_0x58aa18(0x256)],'amount':_0x41121c[_0x58aa18(0x1c0)],'currency':_0x41121c['currency'],'sourceCurrency':_0x41121c['sourceCurrency'],'status':_0x41121c['status'],'usage':_0x41121c[_0x58aa18(0x1a6)],'externalPaymentUrl':_0x41121c[_0x58aa18(0x19b)],'gatewayPaymentId':_0x41121c[_0x58aa18(0x1fa)],'customerEmail':_0x41121c[_0x58aa18(0x1eb)],'customerName':_0x41121c[_0x58aa18(0x25a)],'cardLast4':_0x41121c[_0x58aa18(0x1a2)],'paymentMethod':_0x41121c[_0x58aa18(0x1be)],'bankId':_0x41121c[_0x58aa18(0x1c8)],'remitterIban':_0x41121c[_0x58aa18(0x1ca)],'remitterName':_0x41121c[_0x58aa18(0x1dc)],'chargebackAmount':_0x41121c[_0x58aa18(0x1df)],'adminNotes':_0x41121c['adminNotes'],'statusChangedBy':_0x41121c['statusChangedBy'],'statusChangedAt':_0x41121c['statusChangedAt'],'createdAt':_0x41121c[_0x58aa18(0x24e)],'updatedAt':_0x41121c['updatedAt'],'expiresAt':_0x41121c['expiresAt'],'webhookLogs':_0x41121c[_0x58aa18(0x261)]};}async[a33_0x27f168(0x258)](_0x3cded0,_0x41ad4c,_0x499a7c,_0x5ccf49){const _0x1b38f0=a33_0x27f168;console['log']('üîÑ\x20Updating\x20payment\x20'+_0x3cded0+_0x1b38f0(0x1e8)+_0x41ad4c);const _0x2dcf04=[_0x1b38f0(0x236),_0x1b38f0(0x209),'PAID','EXPIRED',_0x1b38f0(0x244),_0x1b38f0(0x19a),'CHARGEBACK'];if(!_0x2dcf04[_0x1b38f0(0x1f3)](_0x41ad4c[_0x1b38f0(0x214)]()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x2dcf04[_0x1b38f0(0x269)](',\x20'));const _0x2e060d=await database_1['default'][_0x1b38f0(0x239)]['findUnique']({'where':{'id':_0x3cded0},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x2e060d)throw new Error(_0x1b38f0(0x1b1));if(_0x41ad4c[_0x1b38f0(0x214)]()==='CHARGEBACK'){if(!_0x5ccf49||_0x5ccf49<=0x0)throw new Error('Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)');console['log'](_0x1b38f0(0x223)+_0x5ccf49+_0x1b38f0(0x242));}const _0x3a2fab={'status':_0x41ad4c[_0x1b38f0(0x214)](),'updatedAt':new Date()};_0x499a7c&&(_0x3a2fab[_0x1b38f0(0x1c9)]=_0x499a7c);_0x41ad4c[_0x1b38f0(0x214)]()===_0x1b38f0(0x221)&&_0x5ccf49&&(_0x3a2fab[_0x1b38f0(0x1df)]=_0x5ccf49);const _0x3ab563=await database_1[_0x1b38f0(0x1b8)][_0x1b38f0(0x239)]['update']({'where':{'id':_0x3cded0},'data':_0x3a2fab,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x1b38f0(0x1b8)]['webhookLog']['create']({'data':{'paymentId':_0x3cded0,'shopId':_0x3ab563[_0x1b38f0(0x1d5)],'event':_0x1b38f0(0x26b),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x2e060d[_0x1b38f0(0x1d1)],'newStatus':_0x41ad4c[_0x1b38f0(0x214)](),'notes':_0x499a7c||null,'chargebackAmount':_0x5ccf49||null,'timestamp':new Date()[_0x1b38f0(0x1ad)]()})}}),console[_0x1b38f0(0x1a0)]('‚úÖ\x20Payment\x20'+_0x2e060d[_0x1b38f0(0x1d4)]+'\x20status\x20updated\x20from\x20'+_0x2e060d[_0x1b38f0(0x1d1)]+_0x1b38f0(0x20e)+_0x41ad4c['toUpperCase']()),_0x41ad4c[_0x1b38f0(0x214)]()===_0x1b38f0(0x221)&&console[_0x1b38f0(0x1a0)](_0x1b38f0(0x25d)+_0x5ccf49+_0x1b38f0(0x1f7)),{'id':_0x3ab563['id'],'shopId':_0x3ab563[_0x1b38f0(0x1d5)],'shopName':_0x3ab563[_0x1b38f0(0x23c)][_0x1b38f0(0x206)],'shopUsername':_0x3ab563['shop']['username'],'gateway':_0x3ab563[_0x1b38f0(0x24f)],'orderId':_0x3ab563[_0x1b38f0(0x1d4)],'gatewayOrderId':_0x3ab563[_0x1b38f0(0x256)],'amount':_0x3ab563[_0x1b38f0(0x1c0)],'currency':_0x3ab563[_0x1b38f0(0x222)],'sourceCurrency':_0x3ab563['sourceCurrency'],'status':_0x3ab563[_0x1b38f0(0x1d1)],'usage':_0x3ab563[_0x1b38f0(0x1a6)],'externalPaymentUrl':_0x3ab563[_0x1b38f0(0x19b)],'gatewayPaymentId':_0x3ab563['gatewayPaymentId'],'customerEmail':_0x3ab563[_0x1b38f0(0x1eb)],'customerName':_0x3ab563[_0x1b38f0(0x25a)],'cardLast4':_0x3ab563['cardLast4'],'paymentMethod':_0x3ab563[_0x1b38f0(0x1be)],'bankId':_0x3ab563[_0x1b38f0(0x1c8)],'remitterIban':_0x3ab563[_0x1b38f0(0x1ca)],'remitterName':_0x3ab563['remitterName'],'chargebackAmount':_0x3ab563[_0x1b38f0(0x1df)],'adminNotes':_0x3ab563[_0x1b38f0(0x1c9)],'statusChangedBy':_0x3ab563[_0x1b38f0(0x1bf)],'statusChangedAt':_0x3ab563[_0x1b38f0(0x241)],'createdAt':_0x3ab563[_0x1b38f0(0x24e)],'updatedAt':_0x3ab563[_0x1b38f0(0x1c2)],'expiresAt':_0x3ab563[_0x1b38f0(0x22d)]};}async[a33_0x27f168(0x1e2)](_0x5b0892){const _0x575343=a33_0x27f168,{page:_0x546fa4,limit:_0x7c6a5,status:_0x24aa97}=_0x5b0892,_0x385685=(_0x546fa4-0x1)*_0x7c6a5,_0x332513={};_0x24aa97&&(_0x332513['status']=_0x24aa97[_0x575343(0x214)]());console[_0x575343(0x1a0)](_0x575343(0x267),{'page':_0x546fa4,'limit':_0x7c6a5,'status':_0x24aa97,'where':_0x332513});const [_0x3164cb,_0x4fa181]=await Promise[_0x575343(0x26c)]([database_1[_0x575343(0x1b8)]['shop'][_0x575343(0x1f8)]({'where':_0x332513,'skip':_0x385685,'take':_0x7c6a5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x575343(0x20c)}}),database_1[_0x575343(0x1b8)][_0x575343(0x23c)][_0x575343(0x200)]({'where':_0x332513})]);console[_0x575343(0x1a0)]('üìä\x20Found\x20'+_0x3164cb[_0x575343(0x1d6)]+'\x20users\x20out\x20of\x20'+_0x4fa181+_0x575343(0x230));const _0xc30ceb=_0x3164cb[_0x575343(0x1e6)](_0x300f66=>({'id':_0x300f66['id'],'fullName':_0x300f66[_0x575343(0x206)],'username':_0x300f66[_0x575343(0x21f)],'telegramId':_0x300f66[_0x575343(0x1bb)],'merchantUrl':_0x300f66[_0x575343(0x248)],'gateways':_0x300f66[_0x575343(0x228)]?JSON[_0x575343(0x203)](_0x300f66['paymentGateways']):null,'gatewaySettings':_0x300f66[_0x575343(0x247)]?JSON[_0x575343(0x203)](_0x300f66[_0x575343(0x247)]):null,'publicKey':_0x300f66[_0x575343(0x227)],'wallets':{'usdtPolygonWallet':_0x300f66['usdtPolygonWallet'],'usdtTrcWallet':_0x300f66[_0x575343(0x24b)],'usdtErcWallet':_0x300f66[_0x575343(0x23a)],'usdcPolygonWallet':_0x300f66[_0x575343(0x252)]},'status':_0x300f66['status'],'createdAt':_0x300f66[_0x575343(0x24e)]}));return{'users':_0xc30ceb,'pagination':{'page':_0x546fa4,'limit':_0x7c6a5,'total':_0x4fa181,'totalPages':Math[_0x575343(0x1a5)](_0x4fa181/_0x7c6a5)}};}async[a33_0x27f168(0x1e1)](_0x40dd2e){const _0x11cba1=a33_0x27f168;return await this[_0x11cba1(0x1cf)]['getUserById'](_0x40dd2e);}async[a33_0x27f168(0x23e)](_0x6f1e87){const _0x93a69a=a33_0x27f168;return await this[_0x93a69a(0x1cf)]['createUser'](_0x6f1e87);}async['updateUser'](_0x275853,_0x51c708){const _0x119f14=a33_0x27f168;return await this[_0x119f14(0x1cf)][_0x119f14(0x1ce)](_0x275853,_0x51c708);}async[a33_0x27f168(0x237)](_0x19791d){const _0x5d88b8=a33_0x27f168;return await this[_0x5d88b8(0x1cf)][_0x5d88b8(0x237)](_0x19791d);}async[a33_0x27f168(0x23b)](_0x2a357b){const _0x15052a=a33_0x27f168;console[_0x15052a(0x1a0)]('üö´\x20Suspending\x20user:\x20'+_0x2a357b);const _0xb3f552=await database_1['default'][_0x15052a(0x23c)][_0x15052a(0x1da)]({'where':{'id':_0x2a357b},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0xb3f552)throw new Error(_0x15052a(0x1fb));if(_0xb3f552['status']===_0x15052a(0x20d))throw new Error(_0x15052a(0x23f));const _0x137b74=await this[_0x15052a(0x1cf)][_0x15052a(0x1ce)](_0x2a357b,{'status':_0x15052a(0x20d)});return console[_0x15052a(0x1a0)]('‚úÖ\x20User\x20'+_0xb3f552[_0x15052a(0x21f)]+_0x15052a(0x20a)),_0x137b74;}async[a33_0x27f168(0x1c6)](_0x574b70){const _0x1d0262=a33_0x27f168;console['log'](_0x1d0262(0x234)+_0x574b70);const _0x3e2ebd=await database_1[_0x1d0262(0x1b8)]['shop']['findUnique']({'where':{'id':_0x574b70},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3e2ebd)throw new Error(_0x1d0262(0x1fb));if(_0x3e2ebd['status']===_0x1d0262(0x22a))throw new Error(_0x1d0262(0x1f4));const _0x345891=await this['userService']['updateUser'](_0x574b70,{'status':'ACTIVE'});return console[_0x1d0262(0x1a0)](_0x1d0262(0x198)+_0x3e2ebd['username']+_0x1d0262(0x1b5)),_0x345891;}}exports[a33_0x27f168(0x1b9)]=AdminService;