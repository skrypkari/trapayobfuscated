'use strict';const a40_0x3a31c4=a40_0x4dec;function a40_0x2540(){const _0x184218=['map','gte','ceil','pendingUrl','getGatewayNameById','\x27\x20to\x20name\x20\x27','whiteUrl','revenue','telegramId','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20USDT\x20(same\x20as\x20awaiting)','erc20_usdc','🔍\x20Selected\x20polygon_usdc\x20wallet:\x20','\x20active\x20merchants\x20for\x20selection','desc','log','\x20in\x20','💰\x20Payment\x20','getMerchantStatistics','\x20\x20\x20Merchant\x20gets:\x20','50379BLtTfc','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','commission','0000','balance','🔄\x20Admin\x20updating\x20payment\x20','getDate','ru-RU','$transaction','deleteUser','CoinToPay','📅\x20Period:\x20','cointopay','toString','length','🔍\x20Selected\x20erc20\x20wallet:\x20','shopId','dateFrom','averageCommissionRate','getMerchantsSelection','txid','custom','Noda','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','pk_','network','name','\x20\x20\x20Balance:\x20','📊\x20Getting\x20payments\x20with\x20filters:','📊\x20Payout\x20statistics\x20calculated:','count','sort','merchantUrl','insensitive','currency','amountAfterCommissionUSDT','\x27\x20->\x20name\x20\x27','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','some','sk_','period','🔄\x20Gateway\x20mapping\x20(get):','createUser','getMerchantsAwaitingPayout','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','amountAfterGatewayCommissionUSDT','deletePayout','2020-01-01','../config/database','toLowerCase','🎯\x20updateUser\x20called\x20with\x20ID:\x20','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','shopUrl','aggregate','\x20USDT\x20(','push','KLYME\x20EU','paymentGateways','usdcPolygonWallet','rapyd','usdtPolygonWallet','currencyService','getGatewayDisplayName','reduce','Error\x20processing\x20payment\x20','../types/gateway','🔍\x20Creating\x20payout\x20with\x20data:','commissionUSDT','not\x20set','update','SUSPENDED','\x27\x20not\x20found.\x20Available\x20gateways:\x20','toUpperCase','payouts','awaitingPayout','🔄\x20Converted\x20gateway\x20name\x20\x27','usdtTrcWallet','\x20\x20\x20Total\x20paid\x20out:\x20','gateway','Payment\x20not\x20found','gatewayOrderId','PENDING','NONEXISTENT_GATEWAY_FILTER','COMPLETED','updateUser','🔍\x20Initial\x20wallet\x20from\x20request:\x20','totalPayments','default','date','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','asc','💱\x20Currency\x20filter\x20applied:\x20','payment','filter','fullName','\x27\x20->\x20ID\x20\x27','\x20USDT','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','username','dailyRevenue','findUnique','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','66ZRutyW','lte','29377740vHkzuP','hex','🔧\x20[','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','getMonth','wallets','\x20\x20\x20Payout\x20amount:\x20','\x20for\x20shop\x20','payout','toFixed','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','getPayoutStats','MasterCard','polygon','📋\x20Getting\x20merchants\x20selection\x20list...','password','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20to\x20','\x20USDT\x20(-','5138856cALTiU','day','getGatewayInternalName',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','convertToUSDT','localeCompare','cointopay2',']\x20Updating\x20password\x20for\x20user\x20','merchantEarnings','failureMessage','shop','\x20merchants','customerUa','getSystemStatistics','totalCommissionRate','createPayout','hash','🎯\x20[','653uOfZWi','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','totalAmountUSDT','\x20\x20\x20📅\x20This\x20month:\x20','statusChangedBy','\x20paid\x20payments\x20for\x20analysis','amountUSDT','__importDefault','substr','toISOString','paymentsCount','customerEmail','findMany','bcryptjs','stringify','gateways','\x20status:\x20','\x20USDT)','totalTurnover','\x20payments)','📊\x20Sorting\x20payments\x20by\x20','getTime','yesterday','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','📊\x20Merchant\x20statistics\x20calculated:','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','💰\x20[PAYOUT]\x20Merchant\x20','telegram','\x20USDT,\x20merchant:\x20','📋\x20Found\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','🔄\x20Gateway\x20mapping\x20(create):','customerName','parse','averageCheckUSDT','gatewayEarnings','PAID','🔍\x20Using\x20gateway\x20\x27','failUrl','usdtErcWallet','\x20USDT\x20(theoretical\x20net)','1587056npcoUw','set','min','statusChangedAt','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','includes','generateDailyStatistics','\x20USDT\x20(current\x20balance\x20in\x20DB)','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','📊\x20Calculating\x20payout\x20statistics...','%\x20from\x20','📅\x20Payout\x20date\x20from\x20filter:\x20','🔍\x20Balance\x20check\x20details:','totalPayout','\x20\x20\x20💰\x20Total\x20payout:\x20','adminNotes','paidAt','📊\x20Available\x20gateways\x20in\x20database:','split','18tbzOtx','\x20\x20\x20🌐\x20IP:\x20','📅\x20Date\x20from\x20filter:\x20','%\x20commission)','groupBy','KLYME\x20GB','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','✅\x20Payout\x20created\x20in\x20DB:','orderId','createdAt','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','usdcErcWallet','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','getAllPayments','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','🔍\x20Selected\x20polygon\x20wallet:\x20','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x27\x20(from\x20\x27','dailyPayments','\x20-\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','periodFrom','\x20\x20\x20Full\x20amount:\x20','\x20->\x20','gatewayCommissionRate','Rapyd','noda','randomBytes','mastercard','__esModule','\x20USDT\x20(+','not\x20provided','\x20USDT,\x20Difference:\x20','findFirst','\x20\x20\x20Current\x20balance:\x20','203345BAaxdy','⚠️\x20Payment\x20',':\x20commission\x20=\x20','30d','\x20USDT\x20(already\x20paid\x20out)','turnover','status',',\x20Commission:\x20',',\x20userId:\x20','totalPaidOut','REFUND','🔍\x20Selected\x20trc20\x20wallet:\x20','chargebackAmount','setHours','⚠️\x20Requested\x20gateway\x20\x27','\x20\x20\x20Difference:\x20','test_gateway','dateTo','setDate','\x20USDT\x20for\x20payment\x20','merchantEarningsUSDT','gatewaySettings','\x20\x20\x20Available\x20(number):\x20','customerIp','slice','getFullYear','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20with\x20payout\x20history','AdminService','updateCustomerData','CHARGEBACK','\x20order','💰\x20Found\x20','📊\x20Final\x20WHERE\x20conditions:','periodTo','1604swdZtz','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','entries','\x20\x20\x20�📊\x20Total\x20payments:\x20','getPayoutById','publicKey','💰\x20Creating\x20payout\x20for\x20shop\x20','turnoverUSDT','amount','\x20\x20\x20Requested\x20(number):\x20','💰\x20Shop\x20','klyme_eu','externalPaymentUrl','getAllPayouts','customerCountry','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','trim','\x20balance\x20updated:','paidOutUSDT','erc20','wallet','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','week','Plisio','round','toLocaleDateString','delete','\x20\x20\x20🌍\x20Country:\x20','klyme_de','\x20\x20\x20🖥️\x20User\x20Agent:\x20','💳\x20Final\x20payout\x20wallet\x20for\x20','month','error','ACTIVE','updatedAt','\x20\x20\x20Gateway:\x20','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','📊\x20Total\x20payments\x20(including\x20failed):\x20','KLYME\x20DE','2818548LlhEQw','\x20\x20\x20⏳\x20Pending\x20payout:\x20','successUrl','notes','🔄\x20Gateway\x20mapping:','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','values','_sum','getUserById','Insufficient\x20balance.\x20Available:\x20','📊\x20Gateway\x20filter\x20applied:','90d','\x20USDT\x20(gross\x20revenue)','getGatewayIdByName','all','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','trc20','❌\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'];a40_0x2540=function(){return _0x184218;};return a40_0x2540();}(function(_0x29ee28,_0x49ebcb){const _0x447d8a=a40_0x4dec,_0x5d3791=_0x29ee28();while(!![]){try{const _0x14b64a=-parseInt(_0x447d8a(0x29f))/0x1*(parseInt(_0x447d8a(0x322))/0x2)+-parseInt(_0x447d8a(0x28d))/0x3+parseInt(_0x447d8a(0x1e8))/0x4+parseInt(_0x447d8a(0x2ff))/0x5+-parseInt(_0x447d8a(0x278))/0x6*(parseInt(_0x447d8a(0x20e))/0x7)+-parseInt(_0x447d8a(0x2c9))/0x8*(parseInt(_0x447d8a(0x2dc))/0x9)+parseInt(_0x447d8a(0x27a))/0xa;if(_0x14b64a===_0x49ebcb)break;else _0x5d3791['push'](_0x5d3791['shift']());}catch(_0x52e726){_0x5d3791['push'](_0x5d3791['shift']());}}}(a40_0x2540,0xecefb));var __importDefault=this&&this[a40_0x3a31c4(0x2a7)]||function(_0x4fe008){const _0x1a06b8=a40_0x3a31c4;return _0x4fe008&&_0x4fe008[_0x1a06b8(0x2f9)]?_0x4fe008:{'default':_0x4fe008};};Object['defineProperty'](exports,a40_0x3a31c4(0x2f9),{'value':!![]}),exports[a40_0x3a31c4(0x31b)]=void 0x0;const database_1=__importDefault(require(a40_0x3a31c4(0x241))),bcryptjs_1=__importDefault(require(a40_0x3a31c4(0x2ad))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService'),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a40_0x3a31c4(0x252));function a40_0x4dec(_0x4532ec,_0x48be4e){const _0x25404a=a40_0x2540();return a40_0x4dec=function(_0x4dec98,_0x3a2e7c){_0x4dec98=_0x4dec98-0x1d2;let _0x5ec7ed=_0x25404a[_0x4dec98];return _0x5ec7ed;},a40_0x4dec(_0x4532ec,_0x48be4e);}class AdminService{async[a40_0x3a31c4(0x285)](){const _0x495700=a40_0x3a31c4;console[_0x495700(0x209)](_0x495700(0x2d2));const _0x382d94=await database_1['default'][_0x495700(0x297)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x495700(0x1e1)}}),_0x2a4626=await database_1[_0x495700(0x268)][_0x495700(0x26d)]['count']({'where':{'status':_0x495700(0x2c4),'gateway':{'not':_0x495700(0x30f)}}}),_0x4cfb19=new Date(),_0x5053c2=new Date(_0x4cfb19['getFullYear'](),_0x4cfb19[_0x495700(0x27e)](),0x1),_0x189b81=new Date(_0x4cfb19[_0x495700(0x318)](),_0x4cfb19['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x27e0b4=await database_1['default']['payout'][_0x495700(0x246)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5053c2,'lte':_0x189b81},'status':_0x495700(0x264)}}),_0x3c5c0a=_0x382d94[_0x495700(0x1ef)][_0x495700(0x308)]||0x0,_0x357c1f=_0x382d94[_0x495700(0x1ef)][_0x495700(0x214)]||0x0,_0xb03f70=_0x27e0b4[_0x495700(0x1ef)][_0x495700(0x32a)]||0x0,_0x440a66={'totalPayout':Math[_0x495700(0x1d8)](_0x3c5c0a*0x64)/0x64,'awaitingPayout':Math['round'](_0x357c1f*0x64)/0x64,'thisMonth':Math['round'](_0xb03f70*0x64)/0x64,'availableBalance':Math['round'](_0x357c1f*0x64)/0x64,'totalPayments':_0x2a4626};return console[_0x495700(0x209)](_0x495700(0x22d)),console[_0x495700(0x209)](_0x495700(0x2d7)+_0x440a66[_0x495700(0x2d6)]+_0x495700(0x2a0)),console['log']('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x440a66[_0x495700(0x25b)]+_0x495700(0x2e8)),console[_0x495700(0x209)](_0x495700(0x28a)+_0x440a66['availableBalance']+_0x495700(0x204)),console[_0x495700(0x209)](_0x495700(0x2a3)+_0x440a66['thisMonth']+_0x495700(0x271)),console['log'](_0x495700(0x319)+_0x440a66[_0x495700(0x267)]+'\x20PAID\x20payments'),_0x440a66;}async[a40_0x3a31c4(0x31c)](_0xa1b09d,_0x219ed7){const _0x546864=a40_0x3a31c4;console[_0x546864(0x209)](_0x546864(0x276)+_0xa1b09d+':',_0x219ed7);const _0x4ce03e=await database_1[_0x546864(0x268)][_0x546864(0x26d)][_0x546864(0x275)]({'where':{'id':_0xa1b09d},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4ce03e)throw new Error(_0x546864(0x260));const _0x5a8c4d={};_0x219ed7['customerCountry']!==undefined&&(_0x5a8c4d[_0x546864(0x330)]=_0x219ed7[_0x546864(0x330)]||null);_0x219ed7[_0x546864(0x316)]!==undefined&&(_0x5a8c4d[_0x546864(0x316)]=_0x219ed7[_0x546864(0x316)]||null);_0x219ed7[_0x546864(0x299)]!==undefined&&(_0x5a8c4d[_0x546864(0x299)]=_0x219ed7['customerUa']||null);const _0xbb3b4a=await database_1[_0x546864(0x268)][_0x546864(0x26d)]['update']({'where':{'id':_0xa1b09d},'data':{..._0x5a8c4d,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x546864(0x331)+_0xa1b09d),console[_0x546864(0x209)](_0x546864(0x1db)+_0x4ce03e[_0x546864(0x330)]+'\x20->\x20'+_0xbb3b4a[_0x546864(0x330)]),console[_0x546864(0x209)](_0x546864(0x2dd)+_0x4ce03e['customerIp']+'\x20->\x20'+_0xbb3b4a[_0x546864(0x316)]),console[_0x546864(0x209)](_0x546864(0x1dd)+(_0x4ce03e[_0x546864(0x299)]?'set':_0x546864(0x255))+_0x546864(0x2f3)+(_0xbb3b4a[_0x546864(0x299)]?'set':'not\x20set')),_0xbb3b4a;}async[a40_0x3a31c4(0x29a)](_0x5a401f){const _0x190069=a40_0x3a31c4,_0x37b993=new Date();let _0x2469b6;switch(_0x5a401f['toLowerCase']()){case _0x190069(0x28e):_0x2469b6=new Date(_0x37b993[_0x190069(0x318)](),_0x37b993[_0x190069(0x27e)](),_0x37b993[_0x190069(0x216)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x19e775=new Date(_0x37b993);_0x19e775['setDate'](_0x19e775[_0x190069(0x216)]()-0x1),_0x2469b6=new Date(_0x19e775['getFullYear'](),_0x19e775[_0x190069(0x27e)](),_0x19e775['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x2469b6=new Date(_0x37b993['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x190069(0x302):_0x2469b6=new Date(_0x37b993[_0x190069(0x2b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x190069(0x1f3):_0x2469b6=new Date(_0x37b993[_0x190069(0x2b5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x190069(0x1f6):const _0x59f560=await database_1[_0x190069(0x268)][_0x190069(0x26d)][_0x190069(0x2fd)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x2469b6=_0x59f560?_0x59f560[_0x190069(0x2e5)]:new Date('2020-01-01');break;default:_0x2469b6=new Date(_0x37b993[_0x190069(0x2b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x2469b6[_0x190069(0x30c)](0x0,0x0,0x0,0x0);let _0x1a4506;if(_0x5a401f[_0x190069(0x242)]()===_0x190069(0x2b6)){const _0x52de0f=new Date(_0x37b993);_0x52de0f['setDate'](_0x52de0f[_0x190069(0x216)]()-0x1),_0x1a4506=new Date(_0x52de0f[_0x190069(0x318)](),_0x52de0f[_0x190069(0x27e)](),_0x52de0f[_0x190069(0x216)](),0x17,0x3b,0x3b,0x3e7);}const _0x31b840={'gte':_0x2469b6};_0x1a4506&&(_0x31b840['lte']=_0x1a4506);const [_0x159d63,_0x234e17,_0xfd4af0,_0x27cd35,_0x1456d2,_0x237b6f]=await Promise[_0x190069(0x1f6)]([database_1[_0x190069(0x268)]['shop'][_0x190069(0x22e)](),database_1[_0x190069(0x268)][_0x190069(0x297)]['count']({'where':{'status':_0x190069(0x1e1)}}),database_1[_0x190069(0x268)]['payment'][_0x190069(0x22e)]({'where':{'status':_0x190069(0x2c4),'createdAt':_0x31b840,'gateway':{'not':_0x190069(0x30f)}}}),database_1[_0x190069(0x268)][_0x190069(0x26d)]['findMany']({'where':{'status':'PAID','createdAt':_0x31b840,'gateway':{'not':_0x190069(0x30f)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x190069(0x268)][_0x190069(0x26d)][_0x190069(0x2ac)]({'where':{'gateway':{'not':_0x190069(0x30f)}},'take':0xa,'orderBy':{'createdAt':_0x190069(0x208)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x190069(0x268)][_0x190069(0x26d)][_0x190069(0x2ac)]({'where':{'createdAt':_0x31b840,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x16fe73=0x0,_0x17c9a7=0x0;for(const _0x278d58 of _0x27cd35){const _0x1a1d78=await currencyService_1[_0x190069(0x24e)][_0x190069(0x291)](_0x278d58[_0x190069(0x32a)],_0x278d58[_0x190069(0x232)]);_0x16fe73+=_0x1a1d78;if(_0x278d58[_0x190069(0x23e)]){const _0x50bd94=await currencyService_1[_0x190069(0x24e)]['convertToUSDT'](_0x278d58[_0x190069(0x32a)],_0x278d58[_0x190069(0x232)]),_0x527256=_0x278d58[_0x190069(0x23e)],_0x3aa9e6=_0x50bd94-_0x527256;_0x17c9a7+=_0x3aa9e6;}}const _0x5b9dd4=_0xfd4af0>0x0?_0x16fe73/_0xfd4af0:0x0,_0x24a8e5=this[_0x190069(0x2cf)](_0x237b6f,_0x2469b6,_0x1a4506||_0x37b993),_0x2e976b=await database_1[_0x190069(0x268)][_0x190069(0x26d)][_0x190069(0x22e)]({'where':{'createdAt':_0x31b840,'gateway':{'not':'test_gateway'}}}),_0x178415=_0x2e976b>0x0?_0xfd4af0/_0x2e976b*0x64:0x0;return{'totalShops':_0x159d63,'activeShops':_0x234e17,'totalPayments':_0xfd4af0,'successfulPayments':_0xfd4af0,'totalAttempts':_0x2e976b,'totalRevenue':Math['round'](_0x16fe73*0x64)/0x64,'trapayEarnings':Math['round'](_0x17c9a7*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x5b9dd4*0x64)/0x64,'conversionRate':Math[_0x190069(0x1d8)](_0x178415*0x64)/0x64,'dailyRevenue':_0x24a8e5[_0x190069(0x274)],'dailyPayments':_0x24a8e5[_0x190069(0x2ee)],'recentPayments':_0x1456d2['map'](_0xf2999a=>({'id':_0xf2999a['id'],'amount':_0xf2999a[_0x190069(0x32a)],'currency':_0xf2999a[_0x190069(0x232)],'status':_0xf2999a['status'],'gateway':_0xf2999a[_0x190069(0x25f)],'shop':_0xf2999a[_0x190069(0x297)],'createdAt':_0xf2999a[_0x190069(0x2e5)]}))};}async[a40_0x3a31c4(0x20c)](_0x127b75){const _0x262b65=a40_0x3a31c4;console['log'](_0x262b65(0x2d1),_0x127b75);let _0x2fe587,_0x256a75=new Date();if(_0x127b75[_0x262b65(0x238)]===_0x262b65(0x225)&&_0x127b75[_0x262b65(0x221)]&&_0x127b75['dateTo'])_0x2fe587=new Date(_0x127b75[_0x262b65(0x221)]),_0x256a75=new Date(_0x127b75[_0x262b65(0x310)]),_0x2fe587[_0x262b65(0x30c)](0x0,0x0,0x0,0x0),_0x256a75[_0x262b65(0x30c)](0x17,0x3b,0x3b,0x3e7);else{const _0x3c8089=new Date();switch(_0x127b75[_0x262b65(0x238)]){case _0x262b65(0x1d6):_0x2fe587=new Date(_0x3c8089[_0x262b65(0x2b5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x262b65(0x1df):_0x2fe587=new Date(_0x3c8089[_0x262b65(0x2b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x2fe587=new Date(_0x3c8089[_0x262b65(0x2b5)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x262b65(0x1f6):default:_0x2fe587=new Date(_0x262b65(0x240));break;}_0x2fe587[_0x262b65(0x30c)](0x0,0x0,0x0,0x0),_0x256a75[_0x262b65(0x30c)](0x17,0x3b,0x3b,0x3e7);}console[_0x262b65(0x209)](_0x262b65(0x21b)+_0x2fe587[_0x262b65(0x2a9)]()+_0x262b65(0x28b)+_0x256a75[_0x262b65(0x2a9)]());const _0x5067bb={'status':_0x262b65(0x2c4),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x2fe587,'lte':_0x256a75}};_0x127b75[_0x262b65(0x220)]&&(_0x5067bb[_0x262b65(0x220)]=_0x127b75[_0x262b65(0x220)]);const _0x2cd783=await database_1[_0x262b65(0x268)][_0x262b65(0x26d)][_0x262b65(0x2ac)]({'where':_0x5067bb,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('💰\x20Found\x20'+_0x2cd783[_0x262b65(0x21e)]+_0x262b65(0x2a5));const _0x4440d0={'gateway':{'not':_0x262b65(0x30f)},'createdAt':{'gte':_0x2fe587,'lte':_0x256a75}};_0x127b75[_0x262b65(0x220)]&&(_0x4440d0['shopId']=_0x127b75[_0x262b65(0x220)]);const _0x467c83=await database_1[_0x262b65(0x268)]['payment'][_0x262b65(0x22e)]({'where':_0x4440d0});console[_0x262b65(0x209)](_0x262b65(0x1e6)+_0x467c83+',\x20successful:\x20'+_0x2cd783['length']);let _0x3d365b=0x0,_0x36c0d6=0x0,_0x58059d=0x0;const _0x33f26c={},_0x4554ee={},_0x15cdce={};for(const _0x89e743 of _0x2cd783){try{const _0x2ff3e6=_0x89e743[_0x262b65(0x2a6)]||0x0;if(_0x2ff3e6<=0x0){console['warn']('⚠️\x20Payment\x20'+_0x89e743['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x205dc0,_0x4c3ca2;if(_0x89e743['amountAfterGatewayCommissionUSDT']!==null&&_0x89e743[_0x262b65(0x23e)]!==undefined)_0x205dc0=_0x89e743[_0x262b65(0x23e)],_0x4c3ca2=_0x2ff3e6-_0x205dc0,console[_0x262b65(0x209)]('📊\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x89e743['id']+':\x20'+_0x2ff3e6[_0x262b65(0x283)](0x6)+_0x262b65(0x2bc)+_0x205dc0[_0x262b65(0x283)](0x6)+_0x262b65(0x271));else{let _0x3ce591={};if(_0x89e743[_0x262b65(0x297)][_0x262b65(0x314)])try{_0x3ce591=JSON[_0x262b65(0x2c1)](_0x89e743['shop'][_0x262b65(0x314)]);}catch(_0x1b65f3){console[_0x262b65(0x1e0)](_0x262b65(0x2b9)+_0x89e743[_0x262b65(0x220)]+':',_0x1b65f3);}let _0x2c8afa=0x2d;for(const [_0x164e81,_0x1a6c4a]of Object[_0x262b65(0x324)](_0x3ce591)){if(_0x164e81[_0x262b65(0x242)]()===_0x89e743[_0x262b65(0x25f)][_0x262b65(0x242)]()){_0x2c8afa=_0x1a6c4a[_0x262b65(0x212)]||0x2d;break;}}_0x4c3ca2=_0x2ff3e6*(_0x2c8afa/0x64),_0x205dc0=_0x2ff3e6-_0x4c3ca2,console[_0x262b65(0x209)](_0x262b65(0x227)+_0x89e743['id']+':\x20'+_0x2c8afa+_0x262b65(0x2d3)+_0x2ff3e6['toFixed'](0x6)+_0x262b65(0x271));}_0x3d365b+=_0x2ff3e6,_0x36c0d6+=_0x205dc0,_0x58059d+=_0x4c3ca2;let _0x57d7ac;_0x89e743[_0x262b65(0x2f4)]!==null&&_0x89e743[_0x262b65(0x2f4)]!==undefined?(_0x57d7ac=_0x89e743[_0x262b65(0x2f4)],console['log'](_0x262b65(0x272)+_0x89e743['id']+':\x20'+_0x57d7ac+'%')):(_0x57d7ac=_0x2ff3e6>0x0?_0x4c3ca2/_0x2ff3e6*0x64:0x0,console[_0x262b65(0x209)](_0x262b65(0x244)+_0x89e743['id']+':\x20'+_0x57d7ac[_0x262b65(0x283)](0x2)+'%'));!_0x33f26c[_0x89e743[_0x262b65(0x25f)]]&&(_0x33f26c[_0x89e743[_0x262b65(0x25f)]]={'gateway':_0x89e743[_0x262b65(0x25f)],'gatewayDisplayName':this[_0x262b65(0x24f)](_0x89e743[_0x262b65(0x25f)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x33f26c[_0x89e743[_0x262b65(0x25f)]][_0x262b65(0x2aa)]++,_0x33f26c[_0x89e743[_0x262b65(0x25f)]][_0x262b65(0x329)]+=_0x2ff3e6,_0x33f26c[_0x89e743[_0x262b65(0x25f)]][_0x262b65(0x254)]+=_0x4c3ca2,_0x33f26c[_0x89e743['gateway']][_0x262b65(0x313)]+=_0x205dc0,_0x33f26c[_0x89e743[_0x262b65(0x25f)]][_0x262b65(0x29b)]+=_0x57d7ac;!_0x127b75[_0x262b65(0x220)]&&(!_0x4554ee[_0x89e743[_0x262b65(0x220)]]&&(_0x4554ee[_0x89e743['shopId']]={'shopId':_0x89e743['shopId'],'shopName':_0x89e743[_0x262b65(0x297)][_0x262b65(0x22a)],'shopUsername':_0x89e743[_0x262b65(0x297)][_0x262b65(0x273)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4554ee[_0x89e743[_0x262b65(0x220)]][_0x262b65(0x2aa)]++,_0x4554ee[_0x89e743[_0x262b65(0x220)]][_0x262b65(0x329)]+=_0x2ff3e6,_0x4554ee[_0x89e743[_0x262b65(0x220)]][_0x262b65(0x254)]+=_0x4c3ca2,_0x4554ee[_0x89e743[_0x262b65(0x220)]][_0x262b65(0x313)]+=_0x205dc0);const _0x4b74ea=_0x89e743[_0x262b65(0x2d9)][_0x262b65(0x2a9)]()[_0x262b65(0x2db)]('T')[0x0];!_0x15cdce[_0x4b74ea]&&(_0x15cdce[_0x4b74ea]={'date':_0x4b74ea,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x15cdce[_0x4b74ea][_0x262b65(0x304)]+=_0x2ff3e6,_0x15cdce[_0x4b74ea][_0x262b65(0x295)]+=_0x205dc0,_0x15cdce[_0x4b74ea][_0x262b65(0x2c3)]+=_0x4c3ca2,_0x15cdce[_0x4b74ea][_0x262b65(0x2aa)]++;}catch(_0x60a543){console['error'](_0x262b65(0x251)+_0x89e743['id']+':',_0x60a543);}}Object[_0x262b65(0x1ee)](_0x33f26c)['forEach'](_0x1dc2f5=>{const _0x45766c=_0x262b65;_0x1dc2f5['averageCommissionRate']=_0x1dc2f5[_0x45766c(0x2aa)]>0x0?_0x1dc2f5[_0x45766c(0x29b)]/_0x1dc2f5[_0x45766c(0x2aa)]:0x0,delete _0x1dc2f5[_0x45766c(0x29b)];}),Object[_0x262b65(0x1ee)](_0x4554ee)['forEach'](_0x2e7eb4=>{const _0xe099cd=_0x262b65;_0x2e7eb4[_0xe099cd(0x2c2)]=_0x2e7eb4[_0xe099cd(0x2aa)]>0x0?_0x2e7eb4[_0xe099cd(0x329)]/_0x2e7eb4[_0xe099cd(0x2aa)]:0x0;});let _0x5befbe=0x0,_0x7670f3=0x0;if(_0x127b75[_0x262b65(0x220)]){const _0x361e31=await database_1[_0x262b65(0x268)][_0x262b65(0x282)][_0x262b65(0x2ac)]({'where':{'shopId':_0x127b75[_0x262b65(0x220)],'status':_0x262b65(0x264),'createdAt':{'gte':_0x2fe587,'lte':_0x256a75}},'select':{'amount':!![]}});_0x5befbe=_0x361e31['reduce']((_0x40787c,_0x5b1f35)=>_0x40787c+_0x5b1f35['amount'],0x0);const _0x417a77=await database_1[_0x262b65(0x268)][_0x262b65(0x282)]['findMany']({'where':{'shopId':_0x127b75['shopId'],'status':_0x262b65(0x262),'createdAt':{'gte':_0x2fe587,'lte':_0x256a75}},'select':{'amount':!![]}});_0x7670f3=_0x417a77[_0x262b65(0x250)]((_0xec49c2,_0x4d977c)=>_0xec49c2+_0x4d977c[_0x262b65(0x32a)],0x0);}const _0x5b1c11=_0x467c83,_0x3d282d=_0x2cd783[_0x262b65(0x21e)],_0x4a0d69=_0x3d282d>0x0?_0x3d365b/_0x3d282d:0x0,_0x5eb60c=_0x5b1c11>0x0?Math[_0x262b65(0x1d8)](_0x3d282d/_0x5b1c11*0x2710)/0x64:0x0,_0x1f5a94=Math[_0x262b65(0x1fc)]((_0x256a75[_0x262b65(0x2b5)]()-_0x2fe587[_0x262b65(0x2b5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x31cb21={'totalTurnover':Math[_0x262b65(0x1d8)](_0x3d365b*0x64)/0x64,'merchantEarnings':Math[_0x262b65(0x1d8)](_0x36c0d6*0x64)/0x64,'gatewayEarnings':Math[_0x262b65(0x1d8)](_0x58059d*0x64)/0x64,'totalPaidOut':Math['round'](_0x5befbe*0x64)/0x64,'pendingPayout':Math[_0x262b65(0x1d8)](_0x7670f3*0x64)/0x64,'averageCheck':Math[_0x262b65(0x1d8)](_0x4a0d69*0x64)/0x64,'totalPayments':_0x5b1c11,'successfulPayments':_0x3d282d,'conversionRate':_0x5eb60c,'gatewayBreakdown':Object[_0x262b65(0x1ee)](_0x33f26c)[_0x262b65(0x1fa)](_0x2b6dbd=>({..._0x2b6dbd,'turnoverUSDT':Math[_0x262b65(0x1d8)](_0x2b6dbd[_0x262b65(0x329)]*0x64)/0x64,'commissionUSDT':Math[_0x262b65(0x1d8)](_0x2b6dbd[_0x262b65(0x254)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x262b65(0x1d8)](_0x2b6dbd[_0x262b65(0x313)]*0x64)/0x64,'averageCommissionRate':Math[_0x262b65(0x1d8)](_0x2b6dbd[_0x262b65(0x222)]*0x64)/0x64})),'merchantBreakdown':_0x127b75['shopId']?undefined:Object[_0x262b65(0x1ee)](_0x4554ee)['map'](_0x530d9f=>({..._0x530d9f,'turnoverUSDT':Math[_0x262b65(0x1d8)](_0x530d9f[_0x262b65(0x329)]*0x64)/0x64,'commissionUSDT':Math[_0x262b65(0x1d8)](_0x530d9f[_0x262b65(0x254)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x530d9f[_0x262b65(0x313)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x530d9f[_0x262b65(0x1d2)]*0x64)/0x64,'averageCheckUSDT':Math[_0x262b65(0x1d8)](_0x530d9f[_0x262b65(0x2c2)]*0x64)/0x64})),'dailyData':Object[_0x262b65(0x1ee)](_0x15cdce)['map'](_0x82e914=>({..._0x82e914,'turnover':Math['round'](_0x82e914[_0x262b65(0x304)]*0x64)/0x64,'merchantEarnings':Math[_0x262b65(0x1d8)](_0x82e914[_0x262b65(0x295)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x82e914[_0x262b65(0x2c3)]*0x64)/0x64}))[_0x262b65(0x22f)]((_0x2d1ae6,_0x1ff4ea)=>_0x2d1ae6[_0x262b65(0x269)][_0x262b65(0x292)](_0x1ff4ea[_0x262b65(0x269)])),'periodInfo':{'from':_0x2fe587,'to':_0x256a75,'periodType':_0x127b75[_0x262b65(0x238)]||_0x262b65(0x225),'daysCount':_0x1f5a94}};return console[_0x262b65(0x209)](_0x262b65(0x2b8)),console[_0x262b65(0x209)](_0x262b65(0x2f0)+_0x31cb21[_0x262b65(0x2b2)]+_0x262b65(0x271)),console[_0x262b65(0x209)](_0x262b65(0x2e6)+_0x31cb21[_0x262b65(0x295)]+'\x20USDT'),console[_0x262b65(0x209)](_0x262b65(0x210)+_0x31cb21[_0x262b65(0x2c3)]+_0x262b65(0x271)),console['log'](_0x262b65(0x2ea)+_0x31cb21[_0x262b65(0x308)]+'\x20USDT'),console[_0x262b65(0x209)](_0x262b65(0x1e9)+_0x31cb21['pendingPayout']+_0x262b65(0x271)),console[_0x262b65(0x209)](_0x262b65(0x325)+_0x31cb21[_0x262b65(0x267)]),_0x31cb21;}async[a40_0x3a31c4(0x223)](_0x1f5c51){const _0x963cea=a40_0x3a31c4;console[_0x963cea(0x209)](_0x963cea(0x288),{'hasPayoutHistory':_0x1f5c51});let _0x1d5c4d={'status':'ACTIVE'};_0x1f5c51&&(_0x1d5c4d[_0x963cea(0x25a)]={'some':{}});const _0x296a70=await database_1['default'][_0x963cea(0x297)][_0x963cea(0x2ac)]({'where':_0x1d5c4d,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x963cea(0x209)](_0x963cea(0x2bd)+_0x296a70[_0x963cea(0x21e)]+_0x963cea(0x207)+(_0x1f5c51?_0x963cea(0x31a):'')),_0x296a70[_0x963cea(0x1fa)](_0x4cedc=>({'id':_0x4cedc['id'],'username':_0x4cedc[_0x963cea(0x273)],'name':_0x4cedc[_0x963cea(0x22a)]}));}[a40_0x3a31c4(0x24f)](_0xec1930){const _0x29fdb4=a40_0x3a31c4,_0x397c33={'test_gateway':'Test\x20Gateway','plisio':_0x29fdb4(0x1d7),'rapyd':_0x29fdb4(0x2f5),'noda':_0x29fdb4(0x226),'cointopay':_0x29fdb4(0x21a),'cointopay2':'Open\x20Banking\x202','klyme_eu':_0x29fdb4(0x249),'klyme_gb':_0x29fdb4(0x2e1),'klyme_de':_0x29fdb4(0x1e7),'mastercard':_0x29fdb4(0x286)};return _0x397c33[_0xec1930]||_0xec1930;}[a40_0x3a31c4(0x28f)](_0x2a79f8){const _0x4bc892=a40_0x3a31c4,_0x3e16b1={'Test\x20Gateway':'test_gateway','Plisio':'plisio','Rapyd':_0x4bc892(0x24c),'Noda':_0x4bc892(0x2f6),'CoinToPay':_0x4bc892(0x21c),'CoinToPay2':_0x4bc892(0x293),'KLYME\x20EU':_0x4bc892(0x32d),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x4bc892(0x1dc),'MasterCard':_0x4bc892(0x2f8)};return _0x3e16b1[_0x2a79f8]||_0x2a79f8['toLowerCase']();}async[a40_0x3a31c4(0x23b)](_0xd6f101){const _0x1f4f58=a40_0x3a31c4,{page:_0x3fd55b,limit:_0x3ab61a,minAmount:_0x3d697b,search:_0x53ff6b}=_0xd6f101;console[_0x1f4f58(0x209)](_0x1f4f58(0x1ed),_0xd6f101);let _0x458de0={'status':_0x1f4f58(0x1e1)};_0x53ff6b&&(_0x458de0[_0x1f4f58(0x22a)]={'contains':_0x53ff6b,'mode':_0x1f4f58(0x231)});const _0x14ebea=await database_1['default'][_0x1f4f58(0x297)][_0x1f4f58(0x2ac)]({'where':_0x458de0,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x2dc086=_0x14ebea[_0x1f4f58(0x26e)](_0x5bd4e5=>{const _0x3e69d5=_0x1f4f58,_0x4bc3f5=Math['round'](_0x5bd4e5[_0x3e69d5(0x214)]*0x64)/0x64;if(_0x3d697b&&_0x4bc3f5<_0x3d697b)return![];return _0x4bc3f5!==0x0;});_0x2dc086[_0x1f4f58(0x22f)]((_0x50a050,_0x3ebd3f)=>_0x3ebd3f['balance']-_0x50a050[_0x1f4f58(0x214)]);const _0x325672=_0x2dc086[_0x1f4f58(0x21e)],_0x4fa650=(_0x3fd55b-0x1)*_0x3ab61a,_0x3d8e9b=_0x2dc086[_0x1f4f58(0x317)](_0x4fa650,_0x4fa650+_0x3ab61a);console['log'](_0x1f4f58(0x31f)+_0x3d8e9b[_0x1f4f58(0x21e)]+_0x1f4f58(0x323));const _0x12fa7f=await Promise[_0x1f4f58(0x1f6)](_0x3d8e9b['map'](async _0x3f87f4=>{const _0xec88ab=_0x1f4f58,[_0xb68654,_0x519af4,_0x5a6c05]=await Promise[_0xec88ab(0x1f6)]([database_1['default'][_0xec88ab(0x26d)][_0xec88ab(0x22e)]({'where':{'shopId':_0x3f87f4['id'],'status':_0xec88ab(0x2c4),'gateway':{'not':'test_gateway'}}}),database_1[_0xec88ab(0x268)][_0xec88ab(0x26d)][_0xec88ab(0x2fd)]({'where':{'shopId':_0x3f87f4['id'],'status':_0xec88ab(0x2c4),'gateway':{'not':_0xec88ab(0x30f)}},'orderBy':{'paidAt':_0xec88ab(0x26b)},'select':{'paidAt':!![]}}),database_1['default'][_0xec88ab(0x26d)][_0xec88ab(0x2e0)]({'by':[_0xec88ab(0x25f)],'where':{'shopId':_0x3f87f4['id'],'status':'PAID','gateway':{'not':_0xec88ab(0x30f)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x257042=new Date(),_0x54d91a=new Date(_0x257042[_0xec88ab(0x318)](),_0x257042[_0xec88ab(0x27e)](),0x1),_0x3c7077=new Date(_0x257042[_0xec88ab(0x318)](),_0x257042[_0xec88ab(0x27e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5e88d5,_0x29d021]=await Promise['all']([database_1[_0xec88ab(0x268)][_0xec88ab(0x282)][_0xec88ab(0x246)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3f87f4['id'],'status':_0xec88ab(0x264)}}),database_1[_0xec88ab(0x268)][_0xec88ab(0x282)][_0xec88ab(0x246)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3f87f4['id'],'status':'COMPLETED','createdAt':{'gte':_0x54d91a,'lte':_0x3c7077}}})]),_0x3cc4a7=_0x5e88d5[_0xec88ab(0x1ef)][_0xec88ab(0x32a)]||0x0,_0xdc80c5=_0x29d021['_sum'][_0xec88ab(0x32a)]||0x0,_0x19e856=await Promise['all'](_0x5a6c05[_0xec88ab(0x1fa)](async _0xe2a88c=>{const _0x2ffaa6=_0xec88ab;let _0x2cd228=0x2d;if(_0x3f87f4[_0x2ffaa6(0x314)])try{const _0x2f9d3d=JSON[_0x2ffaa6(0x2c1)](_0x3f87f4['gatewaySettings']);for(const [_0x4f6cbe,_0xa90a22]of Object['entries'](_0x2f9d3d)){if(_0x4f6cbe[_0x2ffaa6(0x242)]()===_0xe2a88c[_0x2ffaa6(0x25f)][_0x2ffaa6(0x242)]()){_0x2cd228=_0xa90a22[_0x2ffaa6(0x212)]||0xa,console['log']('💰\x20[PAYOUT]\x20Gateway\x20'+_0xe2a88c[_0x2ffaa6(0x25f)]+'\x20for\x20shop\x20'+_0x3f87f4['id']+_0x2ffaa6(0x301)+_0x2cd228+'%');break;}}}catch(_0x5277b3){console[_0x2ffaa6(0x1e0)](_0x2ffaa6(0x2b9)+_0x3f87f4['id']+':',_0x5277b3);}const _0x1f028d=_0xe2a88c[_0x2ffaa6(0x1ef)]?.[_0x2ffaa6(0x2a6)]||0x0,_0x1ddab4=_0x1f028d*(0x1-_0x2cd228/0x64);return{'gateway':_0xe2a88c[_0x2ffaa6(0x25f)],'count':_0xe2a88c['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x1f028d*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x2ffaa6(0x1d8)](_0x1ddab4*0x64)/0x64,'commission':_0x2cd228};})),_0x55cffd=_0x19e856[_0xec88ab(0x250)]((_0xb81576,_0x2bbd03)=>_0xb81576+_0x2bbd03['amountUSDT'],0x0),_0x2019e1=_0x19e856[_0xec88ab(0x250)]((_0x32726b,_0x11011c)=>_0x32726b+_0x11011c[_0xec88ab(0x233)],0x0),_0x4d5fb2=_0x3f87f4['balance'];return console['log'](_0xec88ab(0x2ba)+_0x3f87f4[_0xec88ab(0x273)]+':'),console[_0xec88ab(0x209)](_0xec88ab(0x23c)+_0x55cffd[_0xec88ab(0x283)](0x2)+_0xec88ab(0x1f4)),console['log'](_0xec88ab(0x211)+_0x2019e1[_0xec88ab(0x283)](0x2)+_0xec88ab(0x2c8)),console[_0xec88ab(0x209)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x4d5fb2[_0xec88ab(0x283)](0x2)+_0xec88ab(0x2d0)),console[_0xec88ab(0x209)]('\x20\x20\x20💸\x20Total\x20payouts:\x20'+_0x3cc4a7[_0xec88ab(0x283)](0x2)+_0xec88ab(0x303)),console[_0xec88ab(0x209)]('\x20\x20\x20🤔\x20Difference:\x20'+(_0x2019e1-_0x3cc4a7-_0x4d5fb2)[_0xec88ab(0x283)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x3f87f4['id'],'fullName':_0x3f87f4[_0xec88ab(0x22a)],'username':_0x3f87f4[_0xec88ab(0x273)],'telegramId':_0x3f87f4[_0xec88ab(0x2bb)],'merchantUrl':_0x3f87f4['shopUrl'],'wallets':{'usdtPolygonWallet':_0x3f87f4[_0xec88ab(0x24d)],'usdtTrcWallet':_0x3f87f4[_0xec88ab(0x25d)],'usdtErcWallet':_0x3f87f4[_0xec88ab(0x2c7)],'usdcPolygonWallet':_0x3f87f4['usdcPolygonWallet'],'usdcErcWallet':_0x3f87f4[_0xec88ab(0x2e7)]},'totalAmountUSDT':Math['round'](_0x55cffd*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xec88ab(0x1d8)](_0x2019e1*0x64)/0x64,'currentBalance':Math['round'](_0x4d5fb2*0x64)/0x64,'totalPayout':Math[_0xec88ab(0x1d8)](_0x3cc4a7*0x64)/0x64,'thisMonth':Math['round'](_0xdc80c5*0x64)/0x64,'paymentsCount':_0xb68654,'oldestPaymentDate':_0x519af4?.[_0xec88ab(0x2d9)]||_0x3f87f4[_0xec88ab(0x2e5)],'gatewayBreakdown':_0x19e856};})),_0x547f31=_0x12fa7f[_0x1f4f58(0x250)]((_0xdee88c,_0x445897)=>_0xdee88c+_0x445897[_0x1f4f58(0x2a2)],0x0),_0x3f7cf1=_0x12fa7f[_0x1f4f58(0x250)]((_0x350859,_0x31a062)=>_0x350859+_0x31a062['totalAmountAfterCommissionUSDT'],0x0),_0x126f7e=_0x12fa7f[_0x1f4f58(0x250)]((_0x1d007f,_0x58cd8d)=>_0x1d007f+_0x58cd8d['totalPayout'],0x0),_0x2b69c9=_0x12fa7f[_0x1f4f58(0x250)]((_0x136a50,_0x26fc2b)=>_0x136a50+_0x26fc2b['thisMonth'],0x0);return console['log'](_0x1f4f58(0x1e4)+_0x325672+_0x1f4f58(0x298)),console[_0x1f4f58(0x209)](_0x1f4f58(0x20f)+Math[_0x1f4f58(0x1d8)](_0x547f31*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console['log']('\x20\x20\x20✅\x20Total\x20net\x20balances:\x20'+Math[_0x1f4f58(0x1d8)](_0x3f7cf1*0x64)/0x64+_0x1f4f58(0x2e2)),console[_0x1f4f58(0x209)](_0x1f4f58(0x284)+Math[_0x1f4f58(0x1d8)](_0x126f7e*0x64)/0x64+_0x1f4f58(0x271)),console['log'](_0x1f4f58(0x27d)+Math['round'](_0x2b69c9*0x64)/0x64+_0x1f4f58(0x271)),{'merchants':_0x12fa7f,'pagination':{'page':_0x3fd55b,'limit':_0x3ab61a,'total':_0x325672,'totalPages':Math[_0x1f4f58(0x1fc)](_0x325672/_0x3ab61a)},'summary':{'totalMerchants':_0x325672,'totalAmountUSDT':Math[_0x1f4f58(0x1d8)](_0x547f31*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1f4f58(0x1d8)](_0x3f7cf1*0x64)/0x64,'totalPayout':Math[_0x1f4f58(0x1d8)](_0x126f7e*0x64)/0x64,'thisMonth':Math[_0x1f4f58(0x1d8)](_0x2b69c9*0x64)/0x64}};}async[a40_0x3a31c4(0x29c)](_0x365213){const _0x541acf=a40_0x3a31c4,{shopId:_0x2faee5,amount:_0x504277,network:_0x154a98,wallet:_0x349ae5,notes:_0x3312de,txid:_0x4acb93,periodFrom:_0x4d3a6d,periodTo:_0x1e9305}=_0x365213,_0x57acfa=await database_1['default'][_0x541acf(0x218)](async _0x57a275=>{const _0x423835=_0x541acf,_0x50dbc1=await _0x57a275['shop']['findUnique']({'where':{'id':_0x2faee5},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x50dbc1)throw new Error('Shop\x20not\x20found');console['log'](_0x423835(0x328)+_0x50dbc1['username']+':'),console[_0x423835(0x209)](_0x423835(0x2fe)+_0x50dbc1[_0x423835(0x214)]['toFixed'](0x6)+_0x423835(0x271)),console['log'](_0x423835(0x280)+_0x504277[_0x423835(0x283)](0x6)+_0x423835(0x271)),console[_0x423835(0x209)](_0x423835(0x1d5)+_0x50dbc1[_0x423835(0x308)][_0x423835(0x283)](0x6)+_0x423835(0x271));if(_0x4acb93)console[_0x423835(0x209)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x4acb93);const _0x4b7f21=0.000001,_0x419e0c=Number(_0x50dbc1[_0x423835(0x214)]),_0x19fdb6=Number(_0x504277);console[_0x423835(0x209)](_0x423835(0x2d5)),console['log']('\x20\x20\x20Available\x20(raw):\x20'+_0x50dbc1[_0x423835(0x214)]),console['log'](_0x423835(0x315)+_0x419e0c),console[_0x423835(0x209)](_0x423835(0x32b)+_0x19fdb6),console['log'](_0x423835(0x30e)+(_0x419e0c-_0x19fdb6)),console[_0x423835(0x209)]('\x20\x20\x20Tolerance:\x20'+_0x4b7f21);if(_0x419e0c<_0x19fdb6-_0x4b7f21)throw new Error(_0x423835(0x1f1)+_0x419e0c[_0x423835(0x283)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x19fdb6[_0x423835(0x283)](0x6)+_0x423835(0x2fc)+(_0x419e0c-_0x19fdb6)[_0x423835(0x283)](0x8)+_0x423835(0x271));console[_0x423835(0x209)](_0x423835(0x2cd));const _0x148dc7=Math[_0x423835(0x2cb)](_0x419e0c,_0x19fdb6);let _0x55f409=_0x349ae5;console[_0x423835(0x209)](_0x423835(0x266)+(_0x349ae5||_0x423835(0x2fb)));if(!_0x55f409){console[_0x423835(0x209)]('🔍\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x1d5495=await _0x57a275[_0x423835(0x297)][_0x423835(0x275)]({'where':{'id':_0x2faee5},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x423835(0x209)]('🔍\x20Shop\x20wallets:',_0x1d5495);if(_0x1d5495)switch(_0x154a98){case _0x423835(0x287):_0x55f409=_0x1d5495['usdtPolygonWallet']||undefined,console[_0x423835(0x209)](_0x423835(0x2eb)+_0x55f409);break;case _0x423835(0x1f8):_0x55f409=_0x1d5495[_0x423835(0x25d)]||undefined,console[_0x423835(0x209)](_0x423835(0x30a)+_0x55f409);break;case _0x423835(0x1d3):_0x55f409=_0x1d5495['usdtErcWallet']||undefined,console['log'](_0x423835(0x21f)+_0x55f409);break;case'polygon_usdc':_0x55f409=_0x1d5495['usdcPolygonWallet']||undefined,console[_0x423835(0x209)](_0x423835(0x206)+_0x55f409);break;case _0x423835(0x205):_0x55f409=_0x1d5495[_0x423835(0x2e7)]||undefined,console['log']('🔍\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x55f409);break;}}else console[_0x423835(0x209)]('✅\x20Using\x20wallet\x20from\x20request:\x20'+_0x55f409);console[_0x423835(0x209)](_0x423835(0x1de)+_0x154a98+':\x20'+(_0x55f409||'not\x20specified')),console[_0x423835(0x209)](_0x423835(0x253),{'shopId':_0x2faee5,'amount':_0x148dc7,'network':_0x154a98,'wallet':_0x55f409,'status':'COMPLETED','txid':_0x4acb93,'notes':_0x3312de,'periodFrom':_0x4d3a6d?new Date(_0x4d3a6d):null,'periodTo':_0x1e9305?new Date(_0x1e9305):null});const _0x4aacb9=await _0x57a275[_0x423835(0x282)]['create']({'data':{'shopId':_0x2faee5,'amount':_0x148dc7,'network':_0x154a98,'wallet':_0x55f409,'status':'COMPLETED','txid':_0x4acb93,'notes':_0x3312de,'periodFrom':_0x4d3a6d?new Date(_0x4d3a6d):null,'periodTo':_0x1e9305?new Date(_0x1e9305):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x423835(0x209)](_0x423835(0x2e3),{'id':_0x4aacb9['id'],'wallet':_0x4aacb9[_0x423835(0x1d4)],'network':_0x4aacb9['network'],'amount':_0x4aacb9[_0x423835(0x32a)]});const _0xb346ac=_0x419e0c-_0x148dc7,_0x93ff0=Number(_0x50dbc1['totalPaidOut'])+_0x148dc7;return await _0x57a275[_0x423835(0x297)][_0x423835(0x256)]({'where':{'id':_0x2faee5},'data':{'balance':_0xb346ac,'totalPaidOut':_0x93ff0}}),console[_0x423835(0x209)](_0x423835(0x32c)+_0x50dbc1[_0x423835(0x273)]+_0x423835(0x333)),console['log'](_0x423835(0x22b)+_0x419e0c[_0x423835(0x283)](0x6)+_0x423835(0x2f3)+_0xb346ac['toFixed'](0x6)+_0x423835(0x28c)+_0x148dc7['toFixed'](0x6)+')'),console[_0x423835(0x209)](_0x423835(0x25e)+_0x50dbc1[_0x423835(0x308)][_0x423835(0x283)](0x6)+_0x423835(0x2f3)+_0x93ff0[_0x423835(0x283)](0x6)+_0x423835(0x2fa)+_0x148dc7[_0x423835(0x283)](0x6)+')'),console[_0x423835(0x209)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x148dc7[_0x423835(0x283)](0x6)+_0x423835(0x271)),{'payout':_0x4aacb9,'shop':_0x50dbc1};});console[_0x541acf(0x209)]('✅\x20Payout\x20created:\x20'+_0x57acfa[_0x541acf(0x282)]['id']+_0x541acf(0x281)+_0x57acfa[_0x541acf(0x297)][_0x541acf(0x273)]+'\x20('+_0x57acfa[_0x541acf(0x282)]['amount']['toFixed'](0x6)+_0x541acf(0x2b1));try{let _0x339acc='Не\x20указан';if(_0x57acfa[_0x541acf(0x282)][_0x541acf(0x2f1)]&&_0x57acfa[_0x541acf(0x282)][_0x541acf(0x321)]){const _0x46e42f=new Date(_0x57acfa['payout'][_0x541acf(0x2f1)])['toLocaleDateString'](_0x541acf(0x217)),_0x446757=new Date(_0x57acfa[_0x541acf(0x282)][_0x541acf(0x321)])[_0x541acf(0x1d9)](_0x541acf(0x217));_0x339acc=_0x46e42f+_0x541acf(0x2ef)+_0x446757;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x57acfa[_0x541acf(0x282)][_0x541acf(0x220)],{'id':_0x57acfa['payout']['id'],'amount':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x32a)],'network':_0x57acfa['payout'][_0x541acf(0x229)],'wallet':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x1d4)],'period':_0x339acc,'createdAt':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x2e5)],'txid':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x224)]}),console['log']('📱\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x57acfa['payout']['id']);}catch(_0x37c149){console[_0x541acf(0x1e0)](_0x541acf(0x1f9)+_0x57acfa[_0x541acf(0x282)]['id']+':',_0x37c149);}return{'id':_0x57acfa[_0x541acf(0x282)]['id'],'shopId':_0x57acfa['payout'][_0x541acf(0x220)],'shopName':_0x57acfa[_0x541acf(0x297)][_0x541acf(0x22a)],'shopUsername':_0x57acfa['shop'][_0x541acf(0x273)],'amount':_0x57acfa['payout'][_0x541acf(0x32a)],'network':_0x57acfa[_0x541acf(0x282)]['network'],'wallet':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x1d4)],'status':_0x57acfa['payout']['status'],'txid':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x224)],'notes':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x1eb)],'periodFrom':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x2f1)],'periodTo':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x321)],'createdAt':_0x57acfa[_0x541acf(0x282)][_0x541acf(0x2e5)],'paidAt':_0x57acfa['payout']['paidAt']};}async[a40_0x3a31c4(0x32f)](_0xa9ff26){const _0xd8590a=a40_0x3a31c4,{page:_0x321d5f,limit:_0x4e6927,shopId:_0x4068f5,network:_0x109711,dateFrom:_0x5b9108,dateTo:_0x244fc8,search:_0x3c81a7}=_0xa9ff26,_0x6f9f02=(_0x321d5f-0x1)*_0x4e6927,_0x3c19a9={};_0x4068f5&&(_0x3c19a9[_0xd8590a(0x220)]=_0x4068f5);_0x109711&&(_0x3c19a9[_0xd8590a(0x229)]=_0x109711);if(_0x5b9108||_0x244fc8){_0x3c19a9[_0xd8590a(0x2e5)]={};if(_0x5b9108){const _0x1cc608=new Date(_0x5b9108);_0x1cc608[_0xd8590a(0x30c)](0x0,0x0,0x0,0x1),_0x3c19a9[_0xd8590a(0x2e5)][_0xd8590a(0x1fb)]=_0x1cc608,console[_0xd8590a(0x209)](_0xd8590a(0x2d4)+_0x1cc608[_0xd8590a(0x2a9)]());}if(_0x244fc8){const _0x101e32=new Date(_0x244fc8);_0x101e32[_0xd8590a(0x30c)](0x17,0x3b,0x3b,0x3e7),_0x3c19a9['createdAt'][_0xd8590a(0x279)]=_0x101e32,console[_0xd8590a(0x209)]('📅\x20Payout\x20date\x20to\x20filter:\x20'+_0x101e32[_0xd8590a(0x2a9)]());}}_0x3c81a7&&(_0x3c19a9['OR']=[{'shop':{'name':{'contains':_0x3c81a7,'mode':_0xd8590a(0x231)}}},{'shop':{'username':{'contains':_0x3c81a7,'mode':_0xd8590a(0x231)}}},{'notes':{'contains':_0x3c81a7,'mode':'insensitive'}}]);const [_0x4aa06f,_0x3b1033]=await Promise[_0xd8590a(0x1f6)]([database_1[_0xd8590a(0x268)][_0xd8590a(0x282)][_0xd8590a(0x2ac)]({'where':_0x3c19a9,'skip':_0x6f9f02,'take':_0x4e6927,'orderBy':{'createdAt':_0xd8590a(0x208)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xd8590a(0x268)][_0xd8590a(0x282)][_0xd8590a(0x22e)]({'where':_0x3c19a9})]);return{'payouts':_0x4aa06f[_0xd8590a(0x1fa)](_0x242e91=>({'id':_0x242e91['id'],'shopId':_0x242e91[_0xd8590a(0x220)],'shopName':_0x242e91[_0xd8590a(0x297)][_0xd8590a(0x22a)],'shopUsername':_0x242e91['shop'][_0xd8590a(0x273)],'amount':_0x242e91[_0xd8590a(0x32a)],'network':_0x242e91[_0xd8590a(0x229)],'wallet':_0x242e91['wallet'],'status':_0x242e91['status'],'txid':_0x242e91[_0xd8590a(0x224)],'notes':_0x242e91[_0xd8590a(0x1eb)],'periodFrom':_0x242e91[_0xd8590a(0x2f1)],'periodTo':_0x242e91['periodTo'],'createdAt':_0x242e91['createdAt'],'paidAt':_0x242e91[_0xd8590a(0x2d9)]})),'pagination':{'page':_0x321d5f,'limit':_0x4e6927,'total':_0x3b1033,'totalPages':Math['ceil'](_0x3b1033/_0x4e6927)}};}async[a40_0x3a31c4(0x326)](_0x5304c5){const _0x44cbd4=a40_0x3a31c4,_0x18f938=await database_1[_0x44cbd4(0x268)][_0x44cbd4(0x282)][_0x44cbd4(0x275)]({'where':{'id':_0x5304c5},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x18f938)return null;return{'id':_0x18f938['id'],'shopId':_0x18f938[_0x44cbd4(0x220)],'shopName':_0x18f938[_0x44cbd4(0x297)]['name'],'shopUsername':_0x18f938[_0x44cbd4(0x297)][_0x44cbd4(0x273)],'amount':_0x18f938[_0x44cbd4(0x32a)],'network':_0x18f938['network'],'wallet':_0x18f938[_0x44cbd4(0x1d4)],'status':_0x18f938[_0x44cbd4(0x305)],'txid':_0x18f938[_0x44cbd4(0x224)],'notes':_0x18f938[_0x44cbd4(0x1eb)],'periodFrom':_0x18f938[_0x44cbd4(0x2f1)],'periodTo':_0x18f938[_0x44cbd4(0x321)],'createdAt':_0x18f938[_0x44cbd4(0x2e5)],'paidAt':_0x18f938[_0x44cbd4(0x2d9)]};}async[a40_0x3a31c4(0x23f)](_0x25c3cd){const _0x1358aa=a40_0x3a31c4;await database_1[_0x1358aa(0x268)][_0x1358aa(0x282)][_0x1358aa(0x1da)]({'where':{'id':_0x25c3cd}});}async[a40_0x3a31c4(0x2e9)](_0x4ae4cf){const _0x33ac56=a40_0x3a31c4,{page:_0x2c6b14,limit:_0x5f135c,status:_0x3b4198,gateway:_0x4de27b,shopId:_0x25f1ce,dateFrom:_0x98062d,dateTo:_0x55dc94,search:_0x1edc93,currency:_0x4de4b6,sortBy:_0x54038a,sortOrder:_0x4672e8}=_0x4ae4cf,_0x21b606=(_0x2c6b14-0x1)*_0x5f135c;console[_0x33ac56(0x209)](_0x33ac56(0x22c),_0x4ae4cf);const _0x4799a9=await database_1[_0x33ac56(0x268)]['payment'][_0x33ac56(0x2e0)]({'by':[_0x33ac56(0x25f)],'_count':{'gateway':!![]}});console[_0x33ac56(0x209)](_0x33ac56(0x2da),_0x4799a9['map'](_0x4c06e1=>_0x4c06e1[_0x33ac56(0x25f)]+'\x20('+_0x4c06e1['_count'][_0x33ac56(0x25f)]+_0x33ac56(0x2b3)));if(_0x4de27b){const _0xb944ac=_0x4799a9[_0x33ac56(0x236)](_0x3b3927=>_0x3b3927[_0x33ac56(0x25f)][_0x33ac56(0x242)]()===_0x4de27b[_0x33ac56(0x242)]());!_0xb944ac&&_0x4de27b[_0x33ac56(0x242)]()!=='test_gateway'&&console[_0x33ac56(0x209)](_0x33ac56(0x30d)+_0x4de27b+_0x33ac56(0x258)+_0x4799a9[_0x33ac56(0x1fa)](_0x3dc484=>_0x3dc484['gateway'])['join'](',\x20'));}const _0x2b2d40={};_0x3b4198&&(_0x2b2d40[_0x33ac56(0x305)]=_0x3b4198[_0x33ac56(0x259)]());if(!_0x4de27b)_0x2b2d40[_0x33ac56(0x25f)]={'not':'test_gateway'};else{if(_0x4de27b&&(_0x4de27b[_0x33ac56(0x242)]()==='test_gateway'||_0x4de27b===_0x33ac56(0x213)))_0x2b2d40['gateway']=_0x33ac56(0x30f);else{let _0x29a675=_0x4de27b;const _0x2c62f4=(0x0,gateway_1[_0x33ac56(0x1fe)])(_0x4de27b);if(_0x2c62f4)_0x29a675=_0x2c62f4,console[_0x33ac56(0x209)](_0x33ac56(0x277)+_0x4de27b+_0x33ac56(0x1ff)+_0x29a675+'\x27');else{const _0x2fc715=(0x0,gateway_1[_0x33ac56(0x1f5)])(_0x4de27b);if(_0x2fc715){const _0x3e54b5=(0x0,gateway_1[_0x33ac56(0x1fe)])(_0x2fc715);_0x3e54b5&&(_0x29a675=_0x3e54b5,console[_0x33ac56(0x209)](_0x33ac56(0x25c)+_0x4de27b+_0x33ac56(0x270)+_0x2fc715+_0x33ac56(0x234)+_0x29a675+'\x27'));}else console[_0x33ac56(0x209)](_0x33ac56(0x2c5)+_0x4de27b+_0x33ac56(0x2a1));}const _0x237e89=await database_1[_0x33ac56(0x268)][_0x33ac56(0x26d)][_0x33ac56(0x22e)]({'where':{'gateway':_0x29a675[_0x33ac56(0x242)]()},'take':0x1});_0x237e89===0x0?(console['log']('⚠️\x20Gateway\x20\x27'+_0x29a675+_0x33ac56(0x2ed)+_0x4de27b+_0x33ac56(0x1e5)),_0x2b2d40[_0x33ac56(0x25f)]=_0x33ac56(0x263)):(_0x2b2d40[_0x33ac56(0x25f)]=_0x29a675[_0x33ac56(0x242)](),console[_0x33ac56(0x209)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x29a675+_0x33ac56(0x2ed)+_0x4de27b+'\x27)'));}}console[_0x33ac56(0x209)](_0x33ac56(0x1f2),_0x2b2d40[_0x33ac56(0x25f)]);_0x25f1ce&&(_0x2b2d40[_0x33ac56(0x220)]=_0x25f1ce);_0x4de4b6&&(_0x2b2d40[_0x33ac56(0x232)]=_0x4de4b6['toUpperCase'](),console[_0x33ac56(0x209)](_0x33ac56(0x26c)+_0x4de4b6[_0x33ac56(0x259)]()));if(_0x98062d||_0x55dc94){_0x2b2d40[_0x33ac56(0x2e5)]={};if(_0x98062d){const _0x562f6c=new Date(_0x98062d);_0x562f6c[_0x33ac56(0x30c)](0x0,0x0,0x0,0x1),_0x2b2d40[_0x33ac56(0x2e5)][_0x33ac56(0x1fb)]=_0x562f6c,console[_0x33ac56(0x209)](_0x33ac56(0x2de)+_0x562f6c[_0x33ac56(0x2a9)]());}if(_0x55dc94){const _0x186632=new Date(_0x55dc94);_0x186632['setHours'](0x17,0x3b,0x3b,0x3e7),_0x2b2d40[_0x33ac56(0x2e5)][_0x33ac56(0x279)]=_0x186632,console[_0x33ac56(0x209)]('📅\x20Date\x20to\x20filter:\x20'+_0x186632[_0x33ac56(0x2a9)]());}}_0x1edc93&&(_0x2b2d40['OR']=[{'id':{'contains':_0x1edc93,'mode':_0x33ac56(0x231)}},{'orderId':{'contains':_0x1edc93,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x1edc93,'mode':_0x33ac56(0x231)}},{'customerEmail':{'contains':_0x1edc93,'mode':_0x33ac56(0x231)}},{'shop':{'name':{'contains':_0x1edc93,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x1edc93,'mode':_0x33ac56(0x231)}}}]);console[_0x33ac56(0x209)](_0x33ac56(0x320),JSON[_0x33ac56(0x2ae)](_0x2b2d40,null,0x2));let _0x170cdc={'createdAt':'desc'};if(_0x54038a){const _0x148da9=[_0x33ac56(0x32a),_0x33ac56(0x2e5),'updatedAt',_0x33ac56(0x305),'gateway',_0x33ac56(0x232)],_0x2a16df=[_0x33ac56(0x26b),_0x33ac56(0x208)];if(_0x148da9[_0x33ac56(0x2ce)](_0x54038a)){const _0x3f76c3=_0x2a16df['includes'](_0x4672e8)?_0x4672e8:_0x33ac56(0x208);_0x170cdc={[_0x54038a]:_0x3f76c3},console[_0x33ac56(0x209)](_0x33ac56(0x2b4)+_0x54038a+_0x33ac56(0x20a)+_0x3f76c3+_0x33ac56(0x31e));}}const [_0x5587af,_0x2b9b1e]=await Promise[_0x33ac56(0x1f6)]([database_1[_0x33ac56(0x268)]['payment'][_0x33ac56(0x2ac)]({'where':_0x2b2d40,'skip':_0x21b606,'take':_0x5f135c,'orderBy':_0x170cdc,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x33ac56(0x268)]['payment']['count']({'where':_0x2b2d40})]);return{'payments':_0x5587af,'pagination':{'page':_0x2c6b14,'limit':_0x5f135c,'total':_0x2b9b1e,'totalPages':Math['ceil'](_0x2b9b1e/_0x5f135c)}};}async['getPaymentById'](_0x5186da){const _0x5d8963=a40_0x3a31c4,_0x367dee=await database_1[_0x5d8963(0x268)][_0x5d8963(0x26d)][_0x5d8963(0x275)]({'where':{'id':_0x5186da},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x367dee)return null;return{'id':_0x367dee['id'],'shopId':_0x367dee[_0x5d8963(0x220)],'gateway':_0x367dee[_0x5d8963(0x25f)],'amount':_0x367dee[_0x5d8963(0x32a)],'currency':_0x367dee[_0x5d8963(0x232)],'status':_0x367dee['status'],'orderId':_0x367dee[_0x5d8963(0x2e4)],'gatewayOrderId':_0x367dee[_0x5d8963(0x261)],'customerEmail':_0x367dee[_0x5d8963(0x2ab)],'customerName':_0x367dee[_0x5d8963(0x2c0)],'customerCountry':_0x367dee['customerCountry'],'customerIp':_0x367dee['customerIp'],'customerUa':_0x367dee[_0x5d8963(0x299)],'failureMessage':_0x367dee[_0x5d8963(0x296)],'externalPaymentUrl':_0x367dee[_0x5d8963(0x32e)],'successUrl':_0x367dee[_0x5d8963(0x1ea)],'failUrl':_0x367dee[_0x5d8963(0x2c6)],'pendingUrl':_0x367dee[_0x5d8963(0x1fd)],'whiteUrl':_0x367dee[_0x5d8963(0x200)],'createdAt':_0x367dee[_0x5d8963(0x2e5)],'updatedAt':_0x367dee['updatedAt'],'shop':_0x367dee['shop']};}async['updatePaymentStatus'](_0x107263,_0x4673cc,_0x19dc11,_0x2021db){const _0xd20d26=a40_0x3a31c4,_0x17b24b=await database_1[_0xd20d26(0x268)][_0xd20d26(0x218)](async _0x46b85d=>{const _0x52a08e=_0xd20d26,_0x59bb5b=await _0x46b85d[_0x52a08e(0x26d)][_0x52a08e(0x275)]({'where':{'id':_0x107263},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x59bb5b)throw new Error(_0x52a08e(0x260));const _0x3df6b0=_0x59bb5b[_0x52a08e(0x305)],_0xa7b35e=_0x4673cc[_0x52a08e(0x259)]();console[_0x52a08e(0x209)](_0x52a08e(0x215)+_0x107263+_0x52a08e(0x2b0)+_0x3df6b0+_0x52a08e(0x2f3)+_0xa7b35e),console[_0x52a08e(0x209)]('💰\x20Current\x20shop\x20balance:\x20'+_0x59bb5b[_0x52a08e(0x297)]['balance']+'\x20USDT');const _0x441092={'status':_0xa7b35e,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x19dc11&&(_0x441092[_0x52a08e(0x2d8)]=_0x19dc11);_0xa7b35e==='CHARGEBACK'&&_0x2021db&&(_0x441092[_0x52a08e(0x30b)]=_0x2021db);let _0x4b076e=0x0,_0x1dc2f4=_0x59bb5b[_0x52a08e(0x297)][_0x52a08e(0x214)];if(_0xa7b35e==='PAID'&&_0x3df6b0!==_0x52a08e(0x2c4)){_0x441092[_0x52a08e(0x2d9)]=new Date();const _0x37c5ff=await currencyService_1['currencyService'][_0x52a08e(0x291)](_0x59bb5b[_0x52a08e(0x32a)],_0x59bb5b[_0x52a08e(0x232)]);_0x441092[_0x52a08e(0x2a6)]=_0x37c5ff;let _0x52f6e4=0x2d;const _0x388671=await _0x46b85d['shop']['findUnique']({'where':{'id':_0x59bb5b[_0x52a08e(0x220)]},'select':{'gatewaySettings':!![]}});if(_0x388671?.[_0x52a08e(0x314)])try{const _0x4c0b15=JSON[_0x52a08e(0x2c1)](_0x388671[_0x52a08e(0x314)]);for(const [_0x409a91,_0x42039c]of Object['entries'](_0x4c0b15)){if(_0x409a91[_0x52a08e(0x242)]()===_0x59bb5b[_0x52a08e(0x25f)][_0x52a08e(0x242)]()){_0x52f6e4=_0x42039c['commission']||0xa;break;}}}catch(_0x1ac6eb){console[_0x52a08e(0x1e0)](_0x52a08e(0x26a)+_0x107263+':',_0x1ac6eb);}let _0x1503de;_0x59bb5b['amountAfterGatewayCommissionUSDT']!==null&&_0x59bb5b[_0x52a08e(0x23e)]!==undefined?(_0x1503de=_0x59bb5b[_0x52a08e(0x23e)],console[_0x52a08e(0x209)](_0x52a08e(0x1f7)+_0x1503de[_0x52a08e(0x283)](0x6)+_0x52a08e(0x312)+_0x107263)):(_0x1503de=_0x37c5ff*(0x1-_0x52f6e4/0x64),console[_0x52a08e(0x209)](_0x52a08e(0x203)+_0x107263+':\x20'+_0x52f6e4+_0x52a08e(0x2d3)+_0x37c5ff[_0x52a08e(0x283)](0x6)+_0x52a08e(0x271)),_0x441092[_0x52a08e(0x23e)]=_0x1503de,_0x441092[_0x52a08e(0x2f4)]=_0x52f6e4),_0x4b076e=_0x1503de,_0x1dc2f4+=_0x1503de,console[_0x52a08e(0x209)](_0x52a08e(0x20b)+_0x107263+'\x20became\x20PAID:'),console[_0x52a08e(0x209)](_0x52a08e(0x2f2)+_0x37c5ff[_0x52a08e(0x283)](0x6)+_0x52a08e(0x271)),console[_0x52a08e(0x209)](_0x52a08e(0x1e3)+_0x59bb5b[_0x52a08e(0x25f)]+_0x52a08e(0x306)+_0x52f6e4+'%'),console['log'](_0x52a08e(0x20d)+_0x1503de[_0x52a08e(0x283)](0x6)+'\x20USDT\x20(after\x20'+_0x52f6e4+_0x52a08e(0x2df)),console[_0x52a08e(0x209)](_0x52a08e(0x2be)+_0x1503de['toFixed'](0x6)+'\x20USDT');}else{if(_0x3df6b0===_0x52a08e(0x2c4)&&_0xa7b35e!==_0x52a08e(0x2c4)&&_0xa7b35e!==_0x52a08e(0x31d)){if(_0x59bb5b[_0x52a08e(0x2a6)]){let _0x1ca31b=0x2d;const _0x1b7371=await _0x46b85d[_0x52a08e(0x297)]['findUnique']({'where':{'id':_0x59bb5b['shopId']},'select':{'gatewaySettings':!![]}});if(_0x1b7371?.['gatewaySettings'])try{const _0x700c90=JSON[_0x52a08e(0x2c1)](_0x1b7371['gatewaySettings']);for(const [_0x1f03cc,_0x5df2c2]of Object[_0x52a08e(0x324)](_0x700c90)){if(_0x1f03cc[_0x52a08e(0x242)]()===_0x59bb5b[_0x52a08e(0x25f)][_0x52a08e(0x242)]()){_0x1ca31b=_0x5df2c2[_0x52a08e(0x212)]||0xa;break;}}}catch(_0x540d29){console[_0x52a08e(0x1e0)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x107263+':',_0x540d29);}const _0x585839=_0x59bb5b[_0x52a08e(0x2a6)]*(0x1-_0x1ca31b/0x64);_0x4b076e=-_0x585839,_0x1dc2f4-=_0x585839,console[_0x52a08e(0x209)](_0x52a08e(0x2f2)+_0x59bb5b['amountUSDT'][_0x52a08e(0x283)](0x6)+'\x20USDT'),console[_0x52a08e(0x209)](_0x52a08e(0x1e3)+_0x59bb5b['gateway']+_0x52a08e(0x306)+_0x1ca31b+'%'),console[_0x52a08e(0x209)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x585839[_0x52a08e(0x283)](0x6)+'\x20USDT\x20(after\x20'+_0x1ca31b+'%\x20commission)'),console[_0x52a08e(0x209)](_0x52a08e(0x235)+_0x585839['toFixed'](0x6)+_0x52a08e(0x271));}}}_0xa7b35e==='CHARGEBACK'&&(console[_0x52a08e(0x209)]('💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x2021db&&_0x2021db>0x0?(_0x4b076e=-_0x2021db,_0x1dc2f4-=_0x2021db,console[_0x52a08e(0x209)]('💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x2021db[_0x52a08e(0x283)](0x6)+'\x20USDT\x20from\x20balance'),console[_0x52a08e(0x209)](_0x52a08e(0x2ec))):console[_0x52a08e(0x209)]('⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x441092['chargebackAmount']=_0x2021db||0x0);_0xa7b35e===_0x52a08e(0x309)&&_0x3df6b0===_0x52a08e(0x2c4)&&console[_0x52a08e(0x209)](_0x52a08e(0x2b7));const _0x150195=await _0x46b85d[_0x52a08e(0x26d)][_0x52a08e(0x256)]({'where':{'id':_0x107263},'data':_0x441092,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4b076e!==0x0&&(await _0x46b85d['shop'][_0x52a08e(0x256)]({'where':{'id':_0x59bb5b['shopId']},'data':{'balance':_0x1dc2f4}}),console['log']('💰\x20Shop\x20'+_0x59bb5b[_0x52a08e(0x220)]+'\x20balance\x20updated:\x20'+_0x59bb5b[_0x52a08e(0x297)]['balance'][_0x52a08e(0x283)](0x6)+'\x20->\x20'+_0x1dc2f4[_0x52a08e(0x283)](0x6)+_0x52a08e(0x247)+(_0x4b076e>0x0?'+':'')+_0x4b076e[_0x52a08e(0x283)](0x6)+')')),_0x150195;});return{'id':_0x17b24b['id'],'shopId':_0x17b24b[_0xd20d26(0x220)],'gateway':_0x17b24b[_0xd20d26(0x25f)],'amount':_0x17b24b[_0xd20d26(0x32a)],'currency':_0x17b24b['currency'],'status':_0x17b24b[_0xd20d26(0x305)],'orderId':_0x17b24b[_0xd20d26(0x2e4)],'gatewayOrderId':_0x17b24b[_0xd20d26(0x261)],'customerEmail':_0x17b24b[_0xd20d26(0x2ab)],'customerName':_0x17b24b[_0xd20d26(0x2c0)],'customerCountry':_0x17b24b[_0xd20d26(0x330)],'customerIp':_0x17b24b[_0xd20d26(0x316)],'customerUa':_0x17b24b['customerUa'],'failureMessage':_0x17b24b[_0xd20d26(0x296)],'adminNotes':_0x17b24b[_0xd20d26(0x2d8)],'chargebackAmount':_0x17b24b[_0xd20d26(0x30b)],'statusChangedBy':_0x17b24b[_0xd20d26(0x2a4)],'statusChangedAt':_0x17b24b[_0xd20d26(0x2cc)],'createdAt':_0x17b24b[_0xd20d26(0x2e5)],'updatedAt':_0x17b24b[_0xd20d26(0x1e2)],'shop':_0x17b24b[_0xd20d26(0x297)]};}async[a40_0x3a31c4(0x265)](_0x3526a8,_0x16de02){const _0x599655=a40_0x3a31c4,_0x2342ce=Math['random']()[_0x599655(0x21d)](0x24)[_0x599655(0x2a8)](0x2,0x9);console[_0x599655(0x209)](_0x599655(0x243)+_0x2342ce+_0x599655(0x307)+_0x3526a8);const _0x4292d2={..._0x16de02};_0x16de02['password']&&_0x16de02[_0x599655(0x289)][_0x599655(0x332)]()!==''?(console['log']('🔐\x20['+_0x2342ce+_0x599655(0x294)+_0x3526a8),_0x4292d2[_0x599655(0x289)]=await bcryptjs_1[_0x599655(0x268)][_0x599655(0x29d)](_0x16de02['password'],0xc)):(console['log']('🔐\x20['+_0x2342ce+_0x599655(0x290)),delete _0x4292d2[_0x599655(0x289)]);_0x16de02[_0x599655(0x26f)]&&(_0x4292d2[_0x599655(0x22a)]=_0x16de02['fullName'],delete _0x4292d2[_0x599655(0x26f)]);_0x16de02['telegramId']&&(_0x4292d2[_0x599655(0x2bb)]=_0x16de02[_0x599655(0x202)],delete _0x4292d2[_0x599655(0x202)]);_0x16de02[_0x599655(0x230)]&&(_0x4292d2['shopUrl']=_0x16de02[_0x599655(0x230)],delete _0x4292d2[_0x599655(0x230)]);if(_0x16de02[_0x599655(0x2af)]){const _0x18c36a=_0x16de02[_0x599655(0x2af)][_0x599655(0x1fa)](_0x2b6e4c=>this['getGatewayInternalName'](_0x2b6e4c));console[_0x599655(0x209)](_0x599655(0x1ec),_0x16de02[_0x599655(0x2af)],'->',_0x18c36a),_0x4292d2[_0x599655(0x24a)]=JSON[_0x599655(0x2ae)](_0x18c36a),delete _0x4292d2[_0x599655(0x2af)];}_0x16de02[_0x599655(0x314)]&&(console['log'](_0x599655(0x27c)+_0x2342ce+']\x20Gateway\x20settings\x20before\x20saving:',_0x16de02['gatewaySettings']),_0x4292d2[_0x599655(0x314)]=JSON[_0x599655(0x2ae)](_0x16de02[_0x599655(0x314)]),console[_0x599655(0x209)]('🔧\x20['+_0x2342ce+_0x599655(0x23d),_0x4292d2[_0x599655(0x314)]));_0x16de02[_0x599655(0x27f)]&&(_0x16de02[_0x599655(0x27f)][_0x599655(0x24d)]!==undefined&&(_0x4292d2[_0x599655(0x24d)]=_0x16de02[_0x599655(0x27f)][_0x599655(0x24d)]||null),_0x16de02[_0x599655(0x27f)][_0x599655(0x25d)]!==undefined&&(_0x4292d2[_0x599655(0x25d)]=_0x16de02[_0x599655(0x27f)][_0x599655(0x25d)]||null),_0x16de02['wallets'][_0x599655(0x2c7)]!==undefined&&(_0x4292d2[_0x599655(0x2c7)]=_0x16de02[_0x599655(0x27f)]['usdtErcWallet']||null),_0x16de02[_0x599655(0x27f)]['usdcPolygonWallet']!==undefined&&(_0x4292d2[_0x599655(0x24b)]=_0x16de02[_0x599655(0x27f)][_0x599655(0x24b)]||null),delete _0x4292d2['wallets']);const _0x35bb86=await database_1[_0x599655(0x268)][_0x599655(0x297)][_0x599655(0x256)]({'where':{'id':_0x3526a8},'data':_0x4292d2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x599655(0x29e)+_0x2342ce+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x35bb86[_0x599655(0x314)]),{'id':_0x35bb86['id'],'fullName':_0x35bb86['name'],'username':_0x35bb86[_0x599655(0x273)],'telegramId':_0x35bb86[_0x599655(0x2bb)],'merchantUrl':_0x35bb86[_0x599655(0x245)],'gateways':_0x35bb86[_0x599655(0x24a)]?JSON[_0x599655(0x2c1)](_0x35bb86[_0x599655(0x24a)]):null,'gatewaySettings':_0x35bb86[_0x599655(0x314)]?JSON[_0x599655(0x2c1)](_0x35bb86['gatewaySettings']):null,'publicKey':_0x35bb86[_0x599655(0x327)],'wallets':{'usdtPolygonWallet':_0x35bb86[_0x599655(0x24d)],'usdtTrcWallet':_0x35bb86[_0x599655(0x25d)],'usdtErcWallet':_0x35bb86[_0x599655(0x2c7)],'usdcPolygonWallet':_0x35bb86[_0x599655(0x24b)]},'status':_0x35bb86[_0x599655(0x305)],'createdAt':_0x35bb86[_0x599655(0x2e5)]};}async['suspendUser'](_0x78952){const _0x2d7e41=a40_0x3a31c4,_0x5a3145=await database_1[_0x2d7e41(0x268)][_0x2d7e41(0x297)]['update']({'where':{'id':_0x78952},'data':{'status':_0x2d7e41(0x257)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a3145['id'],'fullName':_0x5a3145[_0x2d7e41(0x22a)],'username':_0x5a3145[_0x2d7e41(0x273)],'telegramId':_0x5a3145['telegram'],'merchantUrl':_0x5a3145[_0x2d7e41(0x245)],'gateways':_0x5a3145[_0x2d7e41(0x24a)]?JSON['parse'](_0x5a3145[_0x2d7e41(0x24a)]):null,'gatewaySettings':_0x5a3145['gatewaySettings']?JSON['parse'](_0x5a3145['gatewaySettings']):null,'publicKey':_0x5a3145[_0x2d7e41(0x327)],'wallets':{'usdtPolygonWallet':_0x5a3145[_0x2d7e41(0x24d)],'usdtTrcWallet':_0x5a3145[_0x2d7e41(0x25d)],'usdtErcWallet':_0x5a3145['usdtErcWallet'],'usdcPolygonWallet':_0x5a3145[_0x2d7e41(0x24b)]},'status':_0x5a3145[_0x2d7e41(0x305)],'createdAt':_0x5a3145[_0x2d7e41(0x2e5)]};}async['activateUser'](_0x554674){const _0x51a9fe=a40_0x3a31c4,_0x2733f8=await database_1[_0x51a9fe(0x268)][_0x51a9fe(0x297)][_0x51a9fe(0x256)]({'where':{'id':_0x554674},'data':{'status':_0x51a9fe(0x1e1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2733f8['id'],'fullName':_0x2733f8[_0x51a9fe(0x22a)],'username':_0x2733f8[_0x51a9fe(0x273)],'telegramId':_0x2733f8['telegram'],'merchantUrl':_0x2733f8['shopUrl'],'gateways':_0x2733f8[_0x51a9fe(0x24a)]?JSON[_0x51a9fe(0x2c1)](_0x2733f8[_0x51a9fe(0x24a)]):null,'gatewaySettings':_0x2733f8[_0x51a9fe(0x314)]?JSON[_0x51a9fe(0x2c1)](_0x2733f8[_0x51a9fe(0x314)]):null,'publicKey':_0x2733f8[_0x51a9fe(0x327)],'wallets':{'usdtPolygonWallet':_0x2733f8[_0x51a9fe(0x24d)],'usdtTrcWallet':_0x2733f8[_0x51a9fe(0x25d)],'usdtErcWallet':_0x2733f8[_0x51a9fe(0x2c7)],'usdcPolygonWallet':_0x2733f8[_0x51a9fe(0x24b)]},'status':_0x2733f8[_0x51a9fe(0x305)],'createdAt':_0x2733f8[_0x51a9fe(0x2e5)]};}async['getAllUsers'](_0x18a28a){const _0xfa91e4=a40_0x3a31c4,{page:_0x5b950a,limit:_0x24d4d9,status:_0x5345e7}=_0x18a28a,_0x1dcf6b=(_0x5b950a-0x1)*_0x24d4d9,_0x3428fd={};_0x5345e7&&(_0x3428fd[_0xfa91e4(0x305)]=_0x5345e7[_0xfa91e4(0x259)]());const [_0x92360f,_0x7c47eb]=await Promise[_0xfa91e4(0x1f6)]([database_1[_0xfa91e4(0x268)][_0xfa91e4(0x297)][_0xfa91e4(0x2ac)]({'where':_0x3428fd,'skip':_0x1dcf6b,'take':_0x24d4d9,'orderBy':{'createdAt':_0xfa91e4(0x208)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0xfa91e4(0x268)][_0xfa91e4(0x297)]['count']({'where':_0x3428fd})]);return{'users':_0x92360f['map'](_0x5e59fe=>{const _0x34a606=_0xfa91e4,_0x4f4783=_0x5e59fe[_0x34a606(0x24a)]?JSON[_0x34a606(0x2c1)](_0x5e59fe[_0x34a606(0x24a)]):null,_0x15c070=_0x4f4783?_0x4f4783[_0x34a606(0x1fa)](_0x3d93ee=>this['getGatewayDisplayName'](_0x3d93ee)):null;return{'id':_0x5e59fe['id'],'fullName':_0x5e59fe[_0x34a606(0x22a)],'username':_0x5e59fe['username'],'telegramId':_0x5e59fe[_0x34a606(0x2bb)],'merchantUrl':_0x5e59fe[_0x34a606(0x245)],'gateways':_0x15c070,'gatewaySettings':_0x5e59fe['gatewaySettings']?JSON[_0x34a606(0x2c1)](_0x5e59fe[_0x34a606(0x314)]):null,'publicKey':_0x5e59fe[_0x34a606(0x327)],'wallets':{'usdtPolygonWallet':_0x5e59fe[_0x34a606(0x24d)],'usdtTrcWallet':_0x5e59fe[_0x34a606(0x25d)],'usdtErcWallet':_0x5e59fe['usdtErcWallet'],'usdcPolygonWallet':_0x5e59fe['usdcPolygonWallet']},'status':_0x5e59fe[_0x34a606(0x305)],'createdAt':_0x5e59fe['createdAt']};}),'pagination':{'page':_0x5b950a,'limit':_0x24d4d9,'total':_0x7c47eb,'totalPages':Math[_0xfa91e4(0x1fc)](_0x7c47eb/_0x24d4d9)}};}async[a40_0x3a31c4(0x1f0)](_0x481d96){const _0x272381=a40_0x3a31c4,_0x4c3fba=await database_1[_0x272381(0x268)][_0x272381(0x297)]['findUnique']({'where':{'id':_0x481d96},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4c3fba)return null;const _0x40b6e5=_0x4c3fba['paymentGateways']?JSON[_0x272381(0x2c1)](_0x4c3fba[_0x272381(0x24a)]):null,_0x505530=_0x40b6e5?_0x40b6e5[_0x272381(0x1fa)](_0x58577a=>this['getGatewayDisplayName'](_0x58577a)):null;return _0x40b6e5&&_0x505530&&console[_0x272381(0x209)](_0x272381(0x239),_0x40b6e5,'->',_0x505530),{'id':_0x4c3fba['id'],'fullName':_0x4c3fba['name'],'username':_0x4c3fba[_0x272381(0x273)],'telegramId':_0x4c3fba[_0x272381(0x2bb)],'merchantUrl':_0x4c3fba[_0x272381(0x245)],'gateways':_0x505530,'gatewaySettings':_0x4c3fba[_0x272381(0x314)]?JSON['parse'](_0x4c3fba[_0x272381(0x314)]):null,'publicKey':_0x4c3fba['publicKey'],'wallets':{'usdtPolygonWallet':_0x4c3fba['usdtPolygonWallet'],'usdtTrcWallet':_0x4c3fba[_0x272381(0x25d)],'usdtErcWallet':_0x4c3fba[_0x272381(0x2c7)],'usdcPolygonWallet':_0x4c3fba['usdcPolygonWallet']},'status':_0x4c3fba['status'],'createdAt':_0x4c3fba['createdAt']};}async[a40_0x3a31c4(0x23a)](_0x278464){const _0x1c2361=a40_0x3a31c4,{fullName:_0x239c71,username:_0x162c76,password:_0x2d7173,telegramId:_0x5d1c13,merchantUrl:_0x2c305d,gateways:_0x196918,gatewaySettings:_0x483416,wallets:_0x21df7e}=_0x278464,_0x4ea80e=await database_1[_0x1c2361(0x268)][_0x1c2361(0x297)]['findUnique']({'where':{'username':_0x162c76}});if(_0x4ea80e)throw new Error('Username\x20already\x20exists');if(_0x5d1c13){const _0x15678e=await database_1['default'][_0x1c2361(0x297)][_0x1c2361(0x275)]({'where':{'telegram':_0x5d1c13}});if(_0x15678e)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x559b71=await bcryptjs_1[_0x1c2361(0x268)][_0x1c2361(0x29d)](_0x2d7173,0xc),_0x5a623d=_0x1c2361(0x228)+crypto_1[_0x1c2361(0x268)][_0x1c2361(0x2f7)](0x20)[_0x1c2361(0x21d)](_0x1c2361(0x27b)),_0x1ff849=_0x1c2361(0x237)+crypto_1['default']['randomBytes'](0x20)[_0x1c2361(0x21d)](_0x1c2361(0x27b)),_0x1baffc=_0x196918?_0x196918[_0x1c2361(0x1fa)](_0x3a9716=>this['getGatewayInternalName'](_0x3a9716)):null;_0x196918&&_0x1baffc&&console[_0x1c2361(0x209)](_0x1c2361(0x2bf),_0x196918,'->',_0x1baffc);const _0xa0e603=await database_1[_0x1c2361(0x268)]['shop']['create']({'data':{'name':_0x239c71,'username':_0x162c76,'password':_0x559b71,'telegram':_0x5d1c13,'shopUrl':_0x2c305d,'paymentGateways':_0x1baffc?JSON['stringify'](_0x1baffc):null,'gatewaySettings':_0x483416?JSON['stringify'](_0x483416):null,'usdtPolygonWallet':_0x21df7e?.[_0x1c2361(0x24d)]||null,'usdtTrcWallet':_0x21df7e?.[_0x1c2361(0x25d)]||null,'usdtErcWallet':_0x21df7e?.[_0x1c2361(0x2c7)]||null,'usdcPolygonWallet':_0x21df7e?.['usdcPolygonWallet']||null,'publicKey':_0x5a623d,'secretKey':_0x1ff849,'status':_0x1c2361(0x1e1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xa0e603['id'],'fullName':_0xa0e603[_0x1c2361(0x22a)],'username':_0xa0e603[_0x1c2361(0x273)],'telegramId':_0xa0e603[_0x1c2361(0x2bb)],'merchantUrl':_0xa0e603[_0x1c2361(0x245)],'gateways':_0xa0e603['paymentGateways']?JSON[_0x1c2361(0x2c1)](_0xa0e603[_0x1c2361(0x24a)]):null,'gatewaySettings':_0xa0e603['gatewaySettings']?JSON[_0x1c2361(0x2c1)](_0xa0e603['gatewaySettings']):null,'publicKey':_0xa0e603[_0x1c2361(0x327)],'wallets':{'usdtPolygonWallet':_0xa0e603[_0x1c2361(0x24d)],'usdtTrcWallet':_0xa0e603[_0x1c2361(0x25d)],'usdtErcWallet':_0xa0e603['usdtErcWallet'],'usdcPolygonWallet':_0xa0e603['usdcPolygonWallet']},'status':_0xa0e603[_0x1c2361(0x305)],'createdAt':_0xa0e603[_0x1c2361(0x2e5)]};}async[a40_0x3a31c4(0x219)](_0x58408b){const _0x68f1d1=a40_0x3a31c4;await database_1['default'][_0x68f1d1(0x297)][_0x68f1d1(0x1da)]({'where':{'id':_0x58408b}});}[a40_0x3a31c4(0x2cf)](_0x19e371,_0x11206b,_0x4308ea){const _0x59f82b=a40_0x3a31c4,_0x35ab0a=new Map(),_0x3582bd=new Date(_0x11206b);while(_0x3582bd<=_0x4308ea){const _0x294fd2=_0x3582bd[_0x59f82b(0x2a9)]()[_0x59f82b(0x2db)]('T')[0x0];_0x35ab0a[_0x59f82b(0x2ca)](_0x294fd2,{'revenue':0x0,'count':0x0}),_0x3582bd[_0x59f82b(0x311)](_0x3582bd[_0x59f82b(0x216)]()+0x1);}for(const _0x5dc643 of _0x19e371){const _0x3a4898=_0x5dc643[_0x59f82b(0x2e5)][_0x59f82b(0x2a9)]()[_0x59f82b(0x2db)]('T')[0x0],_0x1f52af=_0x35ab0a['get'](_0x3a4898);_0x1f52af&&(_0x1f52af['count']+=0x1,_0x5dc643['status']===_0x59f82b(0x2c4)&&(_0x5dc643['amountUSDT']?_0x1f52af[_0x59f82b(0x201)]+=_0x5dc643['amountUSDT']:console[_0x59f82b(0x209)](_0x59f82b(0x300)+_0x5dc643['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x5824c4=[],_0x334ed1=[];for(const [_0x326961,_0x29e580]of _0x35ab0a){_0x5824c4[_0x59f82b(0x248)]({'date':_0x326961,'amount':Math[_0x59f82b(0x1d8)](_0x29e580['revenue']*0x64)/0x64}),_0x334ed1['push']({'date':_0x326961,'count':_0x29e580['count']});}return{'dailyRevenue':_0x5824c4,'dailyPayments':_0x334ed1};}}exports['AdminService']=AdminService;