'use strict';const a35_0x46f36a=a35_0xfcdd;(function(_0x126dfc,_0x403592){const _0x25fda4=a35_0xfcdd,_0x141baa=_0x126dfc();while(!![]){try{const _0x5bd4dc=parseInt(_0x25fda4(0x2ac))/0x1*(-parseInt(_0x25fda4(0x275))/0x2)+-parseInt(_0x25fda4(0x1f9))/0x3*(-parseInt(_0x25fda4(0x20f))/0x4)+parseInt(_0x25fda4(0x255))/0x5*(parseInt(_0x25fda4(0x235))/0x6)+parseInt(_0x25fda4(0x257))/0x7*(-parseInt(_0x25fda4(0x20c))/0x8)+parseInt(_0x25fda4(0x22a))/0x9*(parseInt(_0x25fda4(0x21b))/0xa)+-parseInt(_0x25fda4(0x27d))/0xb*(parseInt(_0x25fda4(0x205))/0xc)+-parseInt(_0x25fda4(0x2a3))/0xd*(-parseInt(_0x25fda4(0x20b))/0xe);if(_0x5bd4dc===_0x403592)break;else _0x141baa['push'](_0x141baa['shift']());}catch(_0x44c40c){_0x141baa['push'](_0x141baa['shift']());}}}(a35_0x3dac,0x9d268));var __importDefault=this&&this[a35_0x46f36a(0x203)]||function(_0x147cc9){const _0x349cd2=a35_0x46f36a;return _0x147cc9&&_0x147cc9[_0x349cd2(0x2ba)]?_0x147cc9:{'default':_0x147cc9};};function a35_0xfcdd(_0x20c617,_0x5e0d36){const _0x3dac09=a35_0x3dac();return a35_0xfcdd=function(_0xfcdd53,_0x578c85){_0xfcdd53=_0xfcdd53-0x19d;let _0x223cae=_0x3dac09[_0xfcdd53];return _0x223cae;},a35_0xfcdd(_0x20c617,_0x5e0d36);}Object[a35_0x46f36a(0x1ee)](exports,'__esModule',{'value':!![]}),exports[a35_0x46f36a(0x2ab)]=void 0x0;const database_1=__importDefault(require(a35_0x46f36a(0x1d1))),bcryptjs_1=__importDefault(require(a35_0x46f36a(0x1bc))),crypto_1=__importDefault(require(a35_0x46f36a(0x1fe))),currencyService_1=require('./currencyService'),gateway_1=require(a35_0x46f36a(0x26d));function a35_0x3dac(){const _0x33a0df=['\x20active\x20merchants\x20for\x20selection','💸\x20CHARGEBACK\x20penalty:\x20-','name','publicKey','successUrl','trc20','averageCommissionRate','entries','some','set','_count','../types/gateway','wallets','🔍\x20Using\x20gateway\x20\x27','currency','📋\x20Found\x20','\x20USDT)','\x20USDT\x20(without\x20commission)','\x20\x20\x20💰\x20Total\x20turnover:\x20','114126gbMhhc','usdcPolygonWallet','2020-01-01',',\x20successful:\x20','createdAt','statusChangedBy','Noda','round','11uxMrhi',':\x20commission\x20=\x20','totalAmountAfterCommissionUSDT','join','lte','\x20\x20\x20🌐\x20IP:\x20','getSystemStatistics','createUser','create','whiteUrl','toUpperCase','\x20USDT\x20(after\x20','Username\x20already\x20exists','gatewaySettings','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','status','💳\x20Payout\x20wallet\x20for\x20','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','%\x20commission)','stringify','balance','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20status:\x20','paymentGateways','period','getFullYear','polygon','turnover','map','\x27\x20->\x20ID\x20\x27','customerName','getGatewayNameById','shopId','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','CHARGEBACK','not\x20specified','shopUrl','error','65iRiTfu','deletePayout','externalPaymentUrl','not\x20set','failUrl','date','Test\x20Gateway','\x20\x20\x20Balance:\x20','AdminService','15TsehqE','summary','awaitingPayout','💰\x20Current\x20shop\x20balance:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','totalCommissionRate','KLYME\x20EU','updateCustomerData','fullName','💰\x20[PAYOUT]\x20Gateway\x20','📊\x20Calculating\x20payout\x20statistics...','\x20\x20\x20Added\x20to\x20balance:\x20+','_sum','default','__esModule','📋\x20Getting\x20merchants\x20selection\x20list...','📊\x20Gateway\x20filter\x20applied:','\x20became\x20PAID:','activateUser','availableBalance','orderId','toISOString','30d','failureMessage','currencyService','delete','\x20\x20\x20🌍\x20Country:\x20','amountUSDT','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','getGatewayDisplayName','getAllUsers','hash','periodTo','log','getMerchantsAwaitingPayout','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','getMonth','custom','update','\x27\x20to\x20name\x20\x27','📅\x20Period:\x20','usdtErcWallet','generateDailyStatistics','NONEXISTENT_GATEWAY_FILTER','🔄\x20Converted\x20gateway\x20name\x20\x27','\x20\x20\x20Current\x20balance:\x20','usdtPolygonWallet','\x20\x20\x20📊\x20Commission\x20difference:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','updatedAt','bcryptjs','\x20USDT\x20(after\x20payouts)','reduce','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20paid\x20payments\x20for\x20analysis','Insufficient\x20balance.\x20Available:\x20','dailyPayments','thisMonth','averageCheckUSDT','\x20\x20\x20Total\x20paid\x20out:\x20','totalPayout','✅\x20Payout\x20created:\x20','\x20in\x20','groupBy','desc','totalPayments','merchantEarningsUSDT','push','toFixed','customerCountry','findMany','../config/database','paymentsCount','convertToUSDT','toLowerCase','admin','Rapyd','customerUa','\x20\x20\x20Gateway:\x20','merchantUrl','revenue','commissionUSDT','asc','📊\x20Total\x20payments\x20(including\x20failed):\x20','customerIp','\x20USDT','⚠️\x20Gateway\x20\x27','totalAmountUSDT','\x27\x20(from\x20\x27','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','dateFrom','toString','\x20->\x20','totalTurnover','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','notes','split','\x20USDT\x20from\x20balance','usdtTrcWallet','defineProperty','forEach','sk_','randomBytes','suspendUser','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','insensitive','getMerchantStatistics','\x27\x20->\x20name\x20\x27','SUSPENDED','parse','261oIkXRk','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','telegramId','\x20\x20\x20Merchant\x20loses:\x20','count','crypto','week','getGatewayIdByName','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','gateway','__importDefault','turnoverUSDT','960420CmlXRT','dateTo','\x20USDT\x20(-','txid','length','network','2009126MRXIYQ','8DjFjtu','commission','hex','35280HHMLvu','periodFrom','⚠️\x20Payment\x20','\x20to\x20','paidAt','sort','$transaction','customerEmail','\x20\x20\x20💳\x20Total\x20payments:\x20','dailyRevenue','amountAfterCommissionUSDT','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','10MlTedr','pk_','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','gte','findFirst','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20USDT\x20(same\x20as\x20awaiting)','Payment\x20not\x20found','payout','\x20balance\x20updated:','shop','getPayoutById','gatewayOrderId','\x20USDT\x20(gross\x20revenue)','\x20USDT\x20(+','8066493fbYRYj','values','year','REFUND','getPayoutStats','gatewayEarnings','\x20USDT\x20(actual\x20balances)','💰\x20Payment\x20','📊\x20Final\x20WHERE\x20conditions:','Error\x20processing\x20payment\x20','\x20merchants','389934MMTyST','includes','getAllPayouts','get','\x20\x20\x20Transaction\x20hash:\x20','aggregate','\x20\x20\x20💰\x20Total\x20payout:\x20','ACTIVE','username','test_gateway','\x20payments)','KLYME\x20GB','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','gateways',',\x20Commission:\x20','\x20USDT\x20(','\x20for\x20shop\x20','\x20\x20\x20💵\x20Available\x20balance:\x20','💰\x20[PAYOUT]\x20Merchant\x20','createPayout','merchantEarnings','all','adminNotes','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','chargebackAmount','paidOutUSDT','findUnique','totalPaidOut','getMerchantsSelection','PAID','getTime','\x20merchants\x20with\x20positive\x20balance','25QkLSpZ','telegram','7885073XmDRlv','amount','📊\x20Merchants\x20awaiting\x20payout:\x20','updateUser','COMPLETED','💰\x20Found\x20','payment','ceil','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','getUserById','password'];a35_0x3dac=function(){return _0x33a0df;};return a35_0x3dac();}class AdminService{async[a35_0x46f36a(0x22e)](){const _0x4cdfaf=a35_0x46f36a;console['log'](_0x4cdfaf(0x2b6));const _0x39f18e=await database_1[_0x4cdfaf(0x2b9)]['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x620ab6=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x1ab7d6=await database_1[_0x4cdfaf(0x2b9)][_0x4cdfaf(0x25d)]['count']({'where':{'status':_0x4cdfaf(0x252),'gateway':{'not':_0x4cdfaf(0x23e)}}}),_0x4c03eb=new Date(),_0x4e3a08=new Date(_0x4c03eb[_0x4cdfaf(0x296)](),_0x4c03eb[_0x4cdfaf(0x1ad)](),0x1),_0x48c111=new Date(_0x4c03eb['getFullYear'](),_0x4c03eb['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x48361e=await database_1[_0x4cdfaf(0x2b9)]['payout'][_0x4cdfaf(0x23a)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4e3a08,'lte':_0x48c111},'status':_0x4cdfaf(0x25b)}}),_0xa7b4d6=_0x39f18e[_0x4cdfaf(0x2b8)]['totalPaidOut']||0x0,_0x116582=_0x620ab6[_0x4cdfaf(0x2ad)][_0x4cdfaf(0x27f)],_0x4cf40c=_0x48361e[_0x4cdfaf(0x2b8)][_0x4cdfaf(0x258)]||0x0,_0x3fd13f={'totalPayout':Math[_0x4cdfaf(0x27c)](_0xa7b4d6*0x64)/0x64,'awaitingPayout':Math[_0x4cdfaf(0x27c)](_0x116582*0x64)/0x64,'thisMonth':Math[_0x4cdfaf(0x27c)](_0x4cf40c*0x64)/0x64,'availableBalance':Math['round'](_0x116582*0x64)/0x64,'totalPayments':_0x1ab7d6};return console[_0x4cdfaf(0x1aa)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x4cdfaf(0x1aa)](_0x4cdfaf(0x23b)+_0x3fd13f[_0x4cdfaf(0x1c6)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log'](_0x4cdfaf(0x1ba)+_0x3fd13f[_0x4cdfaf(0x2ae)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x4cdfaf(0x1aa)](_0x4cdfaf(0x246)+_0x3fd13f[_0x4cdfaf(0x2bf)]+_0x4cdfaf(0x221)),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x3fd13f[_0x4cdfaf(0x1c3)]+_0x4cdfaf(0x1df)),console[_0x4cdfaf(0x1aa)](_0x4cdfaf(0x217)+_0x3fd13f['totalPayments']+'\x20PAID\x20payments'),console[_0x4cdfaf(0x1aa)]('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x39f18e['_sum'][_0x4cdfaf(0x291)]||0x0)['toFixed'](0x2)+_0x4cdfaf(0x273)),console['log'](_0x4cdfaf(0x1b8)+((_0x39f18e[_0x4cdfaf(0x2b8)]['balance']||0x0)-_0x116582)['toFixed'](0x2)+_0x4cdfaf(0x1df)),_0x3fd13f;}async[a35_0x46f36a(0x2b3)](_0x435e58,_0x3b62c2){const _0x2291b5=a35_0x46f36a;console[_0x2291b5(0x1aa)](_0x2291b5(0x1e3)+_0x435e58+':',_0x3b62c2);const _0x5124a3=await database_1[_0x2291b5(0x2b9)]['payment'][_0x2291b5(0x24f)]({'where':{'id':_0x435e58},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5124a3)throw new Error(_0x2291b5(0x222));const _0x176235={};_0x3b62c2[_0x2291b5(0x1cf)]!==undefined&&(_0x176235[_0x2291b5(0x1cf)]=_0x3b62c2[_0x2291b5(0x1cf)]||null);_0x3b62c2[_0x2291b5(0x1de)]!==undefined&&(_0x176235[_0x2291b5(0x1de)]=_0x3b62c2[_0x2291b5(0x1de)]||null);_0x3b62c2[_0x2291b5(0x1d7)]!==undefined&&(_0x176235[_0x2291b5(0x1d7)]=_0x3b62c2['customerUa']||null);const _0x31d493=await database_1[_0x2291b5(0x2b9)]['payment'][_0x2291b5(0x1af)]({'where':{'id':_0x435e58},'data':{..._0x176235,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2291b5(0x1aa)](_0x2291b5(0x1a5)+_0x435e58),console[_0x2291b5(0x1aa)](_0x2291b5(0x1a3)+_0x5124a3[_0x2291b5(0x1cf)]+'\x20->\x20'+_0x31d493[_0x2291b5(0x1cf)]),console[_0x2291b5(0x1aa)](_0x2291b5(0x282)+_0x5124a3[_0x2291b5(0x1de)]+_0x2291b5(0x1e6)+_0x31d493['customerIp']),console[_0x2291b5(0x1aa)](_0x2291b5(0x1e9)+(_0x5124a3['customerUa']?'set':_0x2291b5(0x2a6))+'\x20->\x20'+(_0x31d493[_0x2291b5(0x1d7)]?_0x2291b5(0x26b):_0x2291b5(0x2a6))),_0x31d493;}async[a35_0x46f36a(0x283)](_0x1d861c){const _0x1166bc=a35_0x46f36a,_0x4636ed=new Date();let _0x337d73;switch(_0x1d861c){case'7d':_0x337d73=new Date(_0x4636ed['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1166bc(0x19f):_0x337d73=new Date(_0x4636ed[_0x1166bc(0x253)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x337d73=new Date(_0x4636ed[_0x1166bc(0x253)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x32b53f=await database_1[_0x1166bc(0x2b9)]['payment'][_0x1166bc(0x21f)]({'where':{'gateway':{'not':_0x1166bc(0x23e)}},'orderBy':{'createdAt':_0x1166bc(0x1dc)},'select':{'createdAt':!![]}});_0x337d73=_0x32b53f?_0x32b53f[_0x1166bc(0x279)]:new Date(_0x1166bc(0x277)),console[_0x1166bc(0x1aa)](_0x1166bc(0x28e)+_0x337d73[_0x1166bc(0x19e)]());break;default:_0x337d73=new Date(_0x4636ed[_0x1166bc(0x253)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3079a9,_0x3c729f,_0xd03722,_0x2c195a,_0x40c7bf,_0x35b2ad,_0x2196c4]=await Promise['all']([database_1[_0x1166bc(0x2b9)]['shop'][_0x1166bc(0x1fd)](),database_1[_0x1166bc(0x2b9)][_0x1166bc(0x225)][_0x1166bc(0x1fd)]({'where':{'status':_0x1166bc(0x23c)}}),database_1[_0x1166bc(0x2b9)][_0x1166bc(0x25d)]['count']({'where':{'createdAt':{'gte':_0x337d73},'gateway':{'not':_0x1166bc(0x23e)}}}),database_1[_0x1166bc(0x2b9)][_0x1166bc(0x25d)]['count']({'where':{'status':_0x1166bc(0x252),'createdAt':{'gte':_0x337d73},'gateway':{'not':_0x1166bc(0x23e)}}}),database_1[_0x1166bc(0x2b9)]['payment'][_0x1166bc(0x1d0)]({'where':{'status':'PAID','createdAt':{'gte':_0x337d73},'gateway':{'not':_0x1166bc(0x23e)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x1166bc(0x2b9)][_0x1166bc(0x25d)]['findMany']({'where':{'gateway':{'not':_0x1166bc(0x23e)}},'take':0xa,'orderBy':{'createdAt':_0x1166bc(0x1ca)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x1166bc(0x1d0)]({'where':{'createdAt':{'gte':_0x337d73},'gateway':{'not':_0x1166bc(0x23e)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x22446b=0x0;for(const _0x25fa50 of _0x40c7bf){const _0x5500bf=await currencyService_1[_0x1166bc(0x1a1)][_0x1166bc(0x1d3)](_0x25fa50[_0x1166bc(0x258)],_0x25fa50[_0x1166bc(0x270)]);_0x22446b+=_0x5500bf;}const _0xe5d3a2=this[_0x1166bc(0x1b3)](_0x2196c4,_0x337d73,_0x4636ed),_0x5c3fb9=_0xd03722>0x0?_0x2c195a/_0xd03722*0x64:0x0;return{'totalShops':_0x3079a9,'activeShops':_0x3c729f,'totalPayments':_0xd03722,'successfulPayments':_0x2c195a,'totalRevenue':Math['round'](_0x22446b*0x64)/0x64,'conversionRate':Math[_0x1166bc(0x27c)](_0x5c3fb9*0x64)/0x64,'dailyRevenue':_0xe5d3a2[_0x1166bc(0x218)],'dailyPayments':_0xe5d3a2[_0x1166bc(0x1c2)],'recentPayments':_0x35b2ad[_0x1166bc(0x299)](_0x5333c0=>({'id':_0x5333c0['id'],'amount':_0x5333c0[_0x1166bc(0x258)],'currency':_0x5333c0['currency'],'status':_0x5333c0[_0x1166bc(0x28c)],'gateway':_0x5333c0['gateway'],'shop':_0x5333c0[_0x1166bc(0x225)],'createdAt':_0x5333c0[_0x1166bc(0x279)]}))};}async[a35_0x46f36a(0x1f5)](_0x87c5c9){const _0x2c977a=a35_0x46f36a;console[_0x2c977a(0x1aa)](_0x2c977a(0x1bf),_0x87c5c9);let _0x4fe20c,_0x206a0d=new Date();if(_0x87c5c9['period']===_0x2c977a(0x1ae)&&_0x87c5c9[_0x2c977a(0x1e4)]&&_0x87c5c9[_0x2c977a(0x206)])_0x4fe20c=new Date(_0x87c5c9[_0x2c977a(0x1e4)]),_0x206a0d=new Date(_0x87c5c9[_0x2c977a(0x206)]);else{const _0xc29582=new Date();switch(_0x87c5c9[_0x2c977a(0x295)]){case _0x2c977a(0x1ff):_0x4fe20c=new Date(_0xc29582[_0x2c977a(0x253)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x4fe20c=new Date(_0xc29582[_0x2c977a(0x253)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2c977a(0x22c):_0x4fe20c=new Date(_0xc29582['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2c977a(0x24a):default:_0x4fe20c=new Date(_0x2c977a(0x277));break;}}console[_0x2c977a(0x1aa)](_0x2c977a(0x1b1)+_0x4fe20c[_0x2c977a(0x19e)]()+_0x2c977a(0x212)+_0x206a0d['toISOString']());const _0x4c8b87={'status':_0x2c977a(0x252),'gateway':{'not':_0x2c977a(0x23e)},'paidAt':{'gte':_0x4fe20c,'lte':_0x206a0d}};_0x87c5c9[_0x2c977a(0x29d)]&&(_0x4c8b87[_0x2c977a(0x29d)]=_0x87c5c9[_0x2c977a(0x29d)]);const _0x50a909=await database_1[_0x2c977a(0x2b9)][_0x2c977a(0x25d)][_0x2c977a(0x1d0)]({'where':_0x4c8b87,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2c977a(0x1aa)](_0x2c977a(0x25c)+_0x50a909[_0x2c977a(0x209)]+_0x2c977a(0x1c0));const _0x19e54d={'gateway':{'not':_0x2c977a(0x23e)},'createdAt':{'gte':_0x4fe20c,'lte':_0x206a0d}};_0x87c5c9[_0x2c977a(0x29d)]&&(_0x19e54d['shopId']=_0x87c5c9['shopId']);const _0xf8c927=await database_1[_0x2c977a(0x2b9)][_0x2c977a(0x25d)][_0x2c977a(0x1fd)]({'where':_0x19e54d});console[_0x2c977a(0x1aa)](_0x2c977a(0x1dd)+_0xf8c927+_0x2c977a(0x278)+_0x50a909[_0x2c977a(0x209)]);let _0x51116e=0x0,_0x53ba88=0x0,_0x1470ba=0x0;const _0x4edac1={},_0x58d612={},_0x2c27e6={};for(const _0x35e287 of _0x50a909){try{const _0x46f479=await currencyService_1[_0x2c977a(0x1a1)][_0x2c977a(0x1d3)](_0x35e287[_0x2c977a(0x258)],_0x35e287[_0x2c977a(0x270)]);let _0x2117d4={};if(_0x35e287[_0x2c977a(0x225)]['gatewaySettings'])try{_0x2117d4=JSON[_0x2c977a(0x1f8)](_0x35e287[_0x2c977a(0x225)][_0x2c977a(0x28a)]);}catch(_0x3189f6){console[_0x2c977a(0x2a2)](_0x2c977a(0x292)+_0x35e287[_0x2c977a(0x29d)]+':',_0x3189f6);}let _0x43d671={},_0x5d92ed=0xa;for(const [_0xc306a4,_0x22937a]of Object[_0x2c977a(0x269)](_0x2117d4)){if(_0xc306a4[_0x2c977a(0x1d4)]()===_0x35e287[_0x2c977a(0x202)]['toLowerCase']()){_0x43d671=_0x22937a,_0x5d92ed=_0x22937a['commission']||0xa;break;}}const _0x2e21cf=_0x46f479*(_0x5d92ed/0x64),_0xf6cd4c=_0x46f479-_0x2e21cf;_0x51116e+=_0x46f479,_0x53ba88+=_0xf6cd4c,_0x1470ba+=_0x2e21cf;!_0x4edac1[_0x35e287['gateway']]&&(_0x4edac1[_0x35e287[_0x2c977a(0x202)]]={'gateway':_0x35e287[_0x2c977a(0x202)],'gatewayDisplayName':this[_0x2c977a(0x1a6)](_0x35e287['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4edac1[_0x35e287[_0x2c977a(0x202)]][_0x2c977a(0x1d2)]++,_0x4edac1[_0x35e287[_0x2c977a(0x202)]][_0x2c977a(0x204)]+=_0x46f479,_0x4edac1[_0x35e287[_0x2c977a(0x202)]]['commissionUSDT']+=_0x2e21cf,_0x4edac1[_0x35e287['gateway']][_0x2c977a(0x1cc)]+=_0xf6cd4c,_0x4edac1[_0x35e287[_0x2c977a(0x202)]][_0x2c977a(0x2b1)]+=_0x5d92ed;!_0x87c5c9[_0x2c977a(0x29d)]&&(!_0x58d612[_0x35e287[_0x2c977a(0x29d)]]&&(_0x58d612[_0x35e287[_0x2c977a(0x29d)]]={'shopId':_0x35e287[_0x2c977a(0x29d)],'shopName':_0x35e287['shop'][_0x2c977a(0x264)],'shopUsername':_0x35e287[_0x2c977a(0x225)][_0x2c977a(0x23d)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x58d612[_0x35e287[_0x2c977a(0x29d)]]['paymentsCount']++,_0x58d612[_0x35e287['shopId']]['turnoverUSDT']+=_0x46f479,_0x58d612[_0x35e287['shopId']][_0x2c977a(0x1db)]+=_0x2e21cf,_0x58d612[_0x35e287['shopId']]['merchantEarningsUSDT']+=_0xf6cd4c);const _0x45bca5=_0x35e287[_0x2c977a(0x213)][_0x2c977a(0x19e)]()[_0x2c977a(0x1eb)]('T')[0x0];!_0x2c27e6[_0x45bca5]&&(_0x2c27e6[_0x45bca5]={'date':_0x45bca5,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2c27e6[_0x45bca5][_0x2c977a(0x298)]+=_0x46f479,_0x2c27e6[_0x45bca5][_0x2c977a(0x249)]+=_0xf6cd4c,_0x2c27e6[_0x45bca5][_0x2c977a(0x22f)]+=_0x2e21cf,_0x2c27e6[_0x45bca5]['paymentsCount']++;}catch(_0x1260f8){console['error'](_0x2c977a(0x233)+_0x35e287['id']+':',_0x1260f8);}}Object[_0x2c977a(0x22b)](_0x4edac1)[_0x2c977a(0x1ef)](_0x28f9ef=>{const _0x2e7c6c=_0x2c977a;_0x28f9ef[_0x2e7c6c(0x268)]=_0x28f9ef[_0x2e7c6c(0x1d2)]>0x0?_0x28f9ef[_0x2e7c6c(0x2b1)]/_0x28f9ef[_0x2e7c6c(0x1d2)]:0x0,delete _0x28f9ef[_0x2e7c6c(0x2b1)];}),Object[_0x2c977a(0x22b)](_0x58d612)[_0x2c977a(0x1ef)](_0xe1c410=>{const _0x21fb82=_0x2c977a;_0xe1c410['averageCheckUSDT']=_0xe1c410[_0x21fb82(0x1d2)]>0x0?_0xe1c410[_0x21fb82(0x204)]/_0xe1c410[_0x21fb82(0x1d2)]:0x0;});let _0x33aed1=0x0;if(_0x87c5c9['shopId']){const _0x1309cc=await database_1['default']['payout'][_0x2c977a(0x1d0)]({'where':{'shopId':_0x87c5c9[_0x2c977a(0x29d)],'status':'COMPLETED','createdAt':{'gte':_0x4fe20c,'lte':_0x206a0d}},'select':{'amount':!![]}});_0x33aed1=_0x1309cc[_0x2c977a(0x1be)]((_0x2e85af,_0x79e617)=>_0x2e85af+_0x79e617['amount'],0x0);}const _0x348c8a=_0xf8c927,_0x2d6c71=_0x50a909[_0x2c977a(0x209)],_0x2f9ef1=_0x2d6c71>0x0?_0x51116e/_0x2d6c71:0x0,_0x3266ed=_0x348c8a>0x0?Math[_0x2c977a(0x27c)](_0x2d6c71/_0x348c8a*0x2710)/0x64:0x0,_0x4f8e40=Math[_0x2c977a(0x25e)]((_0x206a0d[_0x2c977a(0x253)]()-_0x4fe20c[_0x2c977a(0x253)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1cc1d5={'totalTurnover':Math['round'](_0x51116e*0x64)/0x64,'merchantEarnings':Math[_0x2c977a(0x27c)](_0x53ba88*0x64)/0x64,'gatewayEarnings':Math[_0x2c977a(0x27c)](_0x1470ba*0x64)/0x64,'totalPaidOut':Math[_0x2c977a(0x27c)](_0x33aed1*0x64)/0x64,'averageCheck':Math['round'](_0x2f9ef1*0x64)/0x64,'totalPayments':_0x348c8a,'successfulPayments':_0x2d6c71,'conversionRate':_0x3266ed,'gatewayBreakdown':Object[_0x2c977a(0x22b)](_0x4edac1)[_0x2c977a(0x299)](_0x4fcfb9=>({..._0x4fcfb9,'turnoverUSDT':Math[_0x2c977a(0x27c)](_0x4fcfb9[_0x2c977a(0x204)]*0x64)/0x64,'commissionUSDT':Math[_0x2c977a(0x27c)](_0x4fcfb9[_0x2c977a(0x1db)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2c977a(0x27c)](_0x4fcfb9['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x2c977a(0x27c)](_0x4fcfb9['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x87c5c9[_0x2c977a(0x29d)]?undefined:Object[_0x2c977a(0x22b)](_0x58d612)['map'](_0x27ec5c=>({..._0x27ec5c,'turnoverUSDT':Math[_0x2c977a(0x27c)](_0x27ec5c[_0x2c977a(0x204)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x27ec5c['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2c977a(0x27c)](_0x27ec5c[_0x2c977a(0x1cc)]*0x64)/0x64,'paidOutUSDT':Math[_0x2c977a(0x27c)](_0x27ec5c[_0x2c977a(0x24e)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x27ec5c[_0x2c977a(0x1c4)]*0x64)/0x64})),'dailyData':Object['values'](_0x2c27e6)[_0x2c977a(0x299)](_0x31db57=>({..._0x31db57,'turnover':Math[_0x2c977a(0x27c)](_0x31db57[_0x2c977a(0x298)]*0x64)/0x64,'merchantEarnings':Math[_0x2c977a(0x27c)](_0x31db57[_0x2c977a(0x249)]*0x64)/0x64,'gatewayEarnings':Math[_0x2c977a(0x27c)](_0x31db57[_0x2c977a(0x22f)]*0x64)/0x64}))[_0x2c977a(0x214)]((_0x60ac55,_0x5a86dc)=>_0x60ac55[_0x2c977a(0x2a8)]['localeCompare'](_0x5a86dc[_0x2c977a(0x2a8)])),'periodInfo':{'from':_0x4fe20c,'to':_0x206a0d,'periodType':_0x87c5c9['period']||_0x2c977a(0x1ae),'daysCount':_0x4f8e40}};return console[_0x2c977a(0x1aa)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x2c977a(0x1aa)](_0x2c977a(0x274)+_0x1cc1d5[_0x2c977a(0x1e7)]+_0x2c977a(0x1df)),console[_0x2c977a(0x1aa)](_0x2c977a(0x21a)+_0x1cc1d5['merchantEarnings']+'\x20USDT'),console[_0x2c977a(0x1aa)](_0x2c977a(0x21d)+_0x1cc1d5[_0x2c977a(0x22f)]+_0x2c977a(0x1df)),console[_0x2c977a(0x1aa)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x1cc1d5[_0x2c977a(0x1cb)]),_0x1cc1d5;}async[a35_0x46f36a(0x251)](){const _0x2721d5=a35_0x46f36a;console[_0x2721d5(0x1aa)](_0x2721d5(0x2bb));const _0x3f1834=await database_1[_0x2721d5(0x2b9)][_0x2721d5(0x225)][_0x2721d5(0x1d0)]({'where':{'status':_0x2721d5(0x23c)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x2721d5(0x1aa)](_0x2721d5(0x271)+_0x3f1834[_0x2721d5(0x209)]+_0x2721d5(0x262)),_0x3f1834[_0x2721d5(0x299)](_0x5794de=>({'id':_0x5794de['id'],'username':_0x5794de['username'],'name':_0x5794de[_0x2721d5(0x264)]}));}[a35_0x46f36a(0x1a6)](_0x18fcde){const _0x78b191=a35_0x46f36a,_0xfbb0b2={'test_gateway':_0x78b191(0x2a9),'plisio':'Plisio','rapyd':_0x78b191(0x1d6),'noda':_0x78b191(0x27b),'cointopay':'CoinToPay','klyme_eu':_0x78b191(0x2b2),'klyme_gb':_0x78b191(0x240),'klyme_de':'KLYME\x20DE'};return _0xfbb0b2[_0x18fcde]||_0x18fcde;}async[a35_0x46f36a(0x1ab)](_0x40f0ad){const _0x31bb2c=a35_0x46f36a,{page:_0x467ac7,limit:_0x11cfe8,minAmount:_0x2d7070,search:_0x5016f1}=_0x40f0ad,_0x150da8=(_0x467ac7-0x1)*_0x11cfe8;console[_0x31bb2c(0x1aa)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x40f0ad);const _0x573593={'balance':{'gt':0x0},'status':_0x31bb2c(0x23c)};_0x2d7070&&(_0x573593[_0x31bb2c(0x291)][_0x31bb2c(0x21e)]=_0x2d7070);_0x5016f1&&(_0x573593['OR']=[{'name':{'contains':_0x5016f1,'mode':_0x31bb2c(0x1f4)}},{'username':{'contains':_0x5016f1,'mode':_0x31bb2c(0x1f4)}}]);const [_0x474d32,_0x25615b]=await Promise[_0x31bb2c(0x24a)]([database_1[_0x31bb2c(0x2b9)][_0x31bb2c(0x225)][_0x31bb2c(0x1d0)]({'where':_0x573593,'skip':_0x150da8,'take':_0x11cfe8,'orderBy':{'balance':_0x31bb2c(0x1ca)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x31bb2c(0x2b9)][_0x31bb2c(0x225)][_0x31bb2c(0x1fd)]({'where':_0x573593})]);console[_0x31bb2c(0x1aa)](_0x31bb2c(0x25c)+_0x474d32[_0x31bb2c(0x209)]+_0x31bb2c(0x254));const _0x3186c6=await Promise[_0x31bb2c(0x24a)](_0x474d32[_0x31bb2c(0x299)](async _0x3ed07e=>{const _0x356a89=_0x31bb2c,[_0xd22844,_0x3b1b4c,_0x281597]=await Promise[_0x356a89(0x24a)]([database_1[_0x356a89(0x2b9)]['payment']['count']({'where':{'shopId':_0x3ed07e['id'],'status':_0x356a89(0x252),'gateway':{'not':_0x356a89(0x23e)}}}),database_1[_0x356a89(0x2b9)][_0x356a89(0x25d)][_0x356a89(0x21f)]({'where':{'shopId':_0x3ed07e['id'],'status':_0x356a89(0x252),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x356a89(0x1dc)},'select':{'paidAt':!![]}}),database_1[_0x356a89(0x2b9)][_0x356a89(0x25d)][_0x356a89(0x1c9)]({'by':['gateway'],'where':{'shopId':_0x3ed07e['id'],'status':'PAID','gateway':{'not':_0x356a89(0x23e)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x257075=new Date(),_0x35c8cb=new Date(_0x257075[_0x356a89(0x296)](),_0x257075[_0x356a89(0x1ad)](),0x1),_0x4db8bd=new Date(_0x257075[_0x356a89(0x296)](),_0x257075[_0x356a89(0x1ad)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0xb9d049,_0x313ac8]=await Promise['all']([database_1[_0x356a89(0x2b9)][_0x356a89(0x223)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x3ed07e['id'],'status':_0x356a89(0x25b)}}),database_1['default']['payout'][_0x356a89(0x23a)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3ed07e['id'],'status':_0x356a89(0x25b),'createdAt':{'gte':_0x35c8cb,'lte':_0x4db8bd}}})]),_0x50ea5e=_0xb9d049[_0x356a89(0x2b8)][_0x356a89(0x258)]||0x0,_0x4c7612=_0x313ac8[_0x356a89(0x2b8)][_0x356a89(0x258)]||0x0,_0x405fc1=await Promise[_0x356a89(0x24a)](_0x281597[_0x356a89(0x299)](async _0x57ac93=>{const _0x1b631e=_0x356a89;let _0x33628f=0xa;if(_0x3ed07e[_0x1b631e(0x28a)])try{const _0x2a955a=JSON['parse'](_0x3ed07e['gatewaySettings']);for(const [_0x21277c,_0x3ecf23]of Object[_0x1b631e(0x269)](_0x2a955a)){if(_0x21277c[_0x1b631e(0x1d4)]()===_0x57ac93[_0x1b631e(0x202)]['toLowerCase']()){_0x33628f=_0x3ecf23['commission']||0xa,console[_0x1b631e(0x1aa)](_0x1b631e(0x2b5)+_0x57ac93['gateway']+_0x1b631e(0x245)+_0x3ed07e['id']+_0x1b631e(0x27e)+_0x33628f+'%');break;}}}catch(_0x3b43d8){console['error'](_0x1b631e(0x292)+_0x3ed07e['id']+':',_0x3b43d8);}const _0xf5766a=_0x57ac93[_0x1b631e(0x2b8)][_0x1b631e(0x1a4)]||0x0,_0x20601f=_0xf5766a*(0x1-_0x33628f/0x64);return{'gateway':_0x57ac93[_0x1b631e(0x202)],'count':_0x57ac93[_0x1b631e(0x26c)]['id'],'amountUSDT':Math['round'](_0xf5766a*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x20601f*0x64)/0x64,'commission':_0x33628f};})),_0x4ec5b2=_0x405fc1[_0x356a89(0x1be)]((_0x686954,_0x187c1c)=>_0x686954+_0x187c1c[_0x356a89(0x1a4)],0x0),_0x466948=_0x3ed07e[_0x356a89(0x291)];return console[_0x356a89(0x1aa)](_0x356a89(0x247)+_0x3ed07e[_0x356a89(0x23d)]+':'),console[_0x356a89(0x1aa)](_0x356a89(0x24c)+_0x4ec5b2[_0x356a89(0x1ce)](0x2)+_0x356a89(0x228)),console[_0x356a89(0x1aa)](_0x356a89(0x1fa)+_0x405fc1['reduce']((_0x2a4995,_0x30b57f)=>_0x2a4995+_0x30b57f[_0x356a89(0x219)],0x0)[_0x356a89(0x1ce)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x356a89(0x1aa)](_0x356a89(0x201)+_0x466948[_0x356a89(0x1ce)](0x2)+_0x356a89(0x1bd)),{'id':_0x3ed07e['id'],'fullName':_0x3ed07e[_0x356a89(0x264)],'username':_0x3ed07e[_0x356a89(0x23d)],'telegramId':_0x3ed07e[_0x356a89(0x256)],'merchantUrl':_0x3ed07e['shopUrl'],'wallets':{'usdtPolygonWallet':_0x3ed07e[_0x356a89(0x1b7)],'usdtTrcWallet':_0x3ed07e['usdtTrcWallet'],'usdtErcWallet':_0x3ed07e[_0x356a89(0x1b2)],'usdcPolygonWallet':_0x3ed07e[_0x356a89(0x276)]},'totalAmountUSDT':Math[_0x356a89(0x27c)](_0x4ec5b2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x356a89(0x27c)](_0x466948*0x64)/0x64,'totalPayout':Math['round'](_0x50ea5e*0x64)/0x64,'thisMonth':Math[_0x356a89(0x27c)](_0x4c7612*0x64)/0x64,'paymentsCount':_0xd22844,'oldestPaymentDate':_0x3b1b4c?.[_0x356a89(0x213)]||_0x3ed07e[_0x356a89(0x279)],'gatewayBreakdown':_0x405fc1};})),_0x4ce1e1=_0x3186c6[_0x31bb2c(0x1be)]((_0x3cf96b,_0x1e6e16)=>_0x3cf96b+_0x1e6e16[_0x31bb2c(0x1e1)],0x0),_0x25a5db=_0x3186c6[_0x31bb2c(0x1be)]((_0x2d38bf,_0xd5e1d2)=>_0x2d38bf+_0xd5e1d2[_0x31bb2c(0x27f)],0x0),_0x4ddede=_0x3186c6[_0x31bb2c(0x1be)]((_0x333118,_0x4b8f30)=>_0x333118+_0x4b8f30['totalPayout'],0x0),_0x4aa55f=_0x3186c6[_0x31bb2c(0x1be)]((_0x4671b2,_0x26e24f)=>_0x4671b2+_0x26e24f[_0x31bb2c(0x1c3)],0x0);return console[_0x31bb2c(0x1aa)](_0x31bb2c(0x259)+_0x25615b+_0x31bb2c(0x234)),console[_0x31bb2c(0x1aa)]('\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20'+Math[_0x31bb2c(0x27c)](_0x4ce1e1*0x64)/0x64+_0x31bb2c(0x228)),console['log'](_0x31bb2c(0x28b)+Math[_0x31bb2c(0x27c)](_0x25a5db*0x64)/0x64+_0x31bb2c(0x230)),console[_0x31bb2c(0x1aa)](_0x31bb2c(0x1ac)+Math['round'](_0x4ddede*0x64)/0x64+_0x31bb2c(0x1df)),console[_0x31bb2c(0x1aa)](_0x31bb2c(0x29e)+Math[_0x31bb2c(0x27c)](_0x4aa55f*0x64)/0x64+_0x31bb2c(0x1df)),{'merchants':_0x3186c6,'pagination':{'page':_0x467ac7,'limit':_0x11cfe8,'total':_0x25615b,'totalPages':Math[_0x31bb2c(0x25e)](_0x25615b/_0x11cfe8)},'summary':{'totalMerchants':_0x25615b,'totalAmountUSDT':Math[_0x31bb2c(0x27c)](_0x4ce1e1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x31bb2c(0x27c)](_0x25a5db*0x64)/0x64,'totalPayout':Math[_0x31bb2c(0x27c)](_0x4ddede*0x64)/0x64,'thisMonth':Math['round'](_0x4aa55f*0x64)/0x64}};}async[a35_0x46f36a(0x248)](_0x5f8db5){const _0x4d587d=a35_0x46f36a,{shopId:_0x2e950d,amount:_0x5362fc,network:_0x223dcb,wallet:_0x109298,notes:_0x519912,txid:_0x3f1771,periodFrom:_0x3cf371,periodTo:_0x43b09d}=_0x5f8db5,_0x1e15f5=await database_1[_0x4d587d(0x2b9)]['$transaction'](async _0x55ec5b=>{const _0x579f72=_0x4d587d,_0x524020=await _0x55ec5b[_0x579f72(0x225)][_0x579f72(0x24f)]({'where':{'id':_0x2e950d},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x524020)throw new Error('Shop\x20not\x20found');console[_0x579f72(0x1aa)](_0x579f72(0x220)+_0x524020[_0x579f72(0x23d)]+':'),console['log'](_0x579f72(0x1b6)+_0x524020[_0x579f72(0x291)][_0x579f72(0x1ce)](0x6)+_0x579f72(0x1df)),console['log']('\x20\x20\x20Payout\x20amount:\x20'+_0x5362fc[_0x579f72(0x1ce)](0x6)+_0x579f72(0x1df)),console[_0x579f72(0x1aa)](_0x579f72(0x1b9)+_0x524020[_0x579f72(0x250)]['toFixed'](0x6)+_0x579f72(0x1df));if(_0x3f1771)console[_0x579f72(0x1aa)](_0x579f72(0x239)+_0x3f1771);if(_0x524020[_0x579f72(0x291)]<_0x5362fc)throw new Error(_0x579f72(0x1c1)+_0x524020['balance']['toFixed'](0x6)+'\x20USDT,\x20Requested:\x20'+_0x5362fc[_0x579f72(0x1ce)](0x6)+_0x579f72(0x1df));let _0x29d8d5=_0x109298;if(!_0x29d8d5){const _0x2a68fe=await _0x55ec5b['shop']['findUnique']({'where':{'id':_0x2e950d},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x2a68fe)switch(_0x223dcb){case _0x579f72(0x297):_0x29d8d5=_0x2a68fe[_0x579f72(0x1b7)]||undefined;break;case _0x579f72(0x267):_0x29d8d5=_0x2a68fe[_0x579f72(0x1ed)]||undefined;break;case'erc20':_0x29d8d5=_0x2a68fe[_0x579f72(0x1b2)]||undefined;break;case'polygon_usdc':_0x29d8d5=_0x2a68fe[_0x579f72(0x276)]||undefined;break;}}console[_0x579f72(0x1aa)](_0x579f72(0x28d)+_0x223dcb+':\x20'+(_0x29d8d5||_0x579f72(0x2a0)));const _0x1cea08=await _0x55ec5b[_0x579f72(0x223)][_0x579f72(0x285)]({'data':{'shopId':_0x2e950d,'amount':_0x5362fc,'network':_0x223dcb,'status':_0x579f72(0x25b),'txid':_0x3f1771,'notes':_0x519912,'periodFrom':_0x3cf371?new Date(_0x3cf371):null,'periodTo':_0x43b09d?new Date(_0x43b09d):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x26ce02=_0x524020[_0x579f72(0x291)]-_0x5362fc,_0x1bd984=_0x524020[_0x579f72(0x250)]+_0x5362fc;return await _0x55ec5b['shop'][_0x579f72(0x1af)]({'where':{'id':_0x2e950d},'data':{'balance':_0x26ce02,'totalPaidOut':_0x1bd984}}),console[_0x579f72(0x1aa)]('💰\x20Shop\x20'+_0x524020[_0x579f72(0x23d)]+_0x579f72(0x224)),console[_0x579f72(0x1aa)](_0x579f72(0x2aa)+_0x524020[_0x579f72(0x291)][_0x579f72(0x1ce)](0x6)+_0x579f72(0x1e6)+_0x26ce02[_0x579f72(0x1ce)](0x6)+_0x579f72(0x207)+_0x5362fc[_0x579f72(0x1ce)](0x6)+')'),console[_0x579f72(0x1aa)](_0x579f72(0x1c5)+_0x524020[_0x579f72(0x250)][_0x579f72(0x1ce)](0x6)+_0x579f72(0x1e6)+_0x1bd984[_0x579f72(0x1ce)](0x6)+_0x579f72(0x229)+_0x5362fc[_0x579f72(0x1ce)](0x6)+')'),{'payout':_0x1cea08,'shop':_0x524020};});return console[_0x4d587d(0x1aa)](_0x4d587d(0x1c7)+_0x1e15f5[_0x4d587d(0x223)]['id']+'\x20for\x20shop\x20'+_0x1e15f5[_0x4d587d(0x225)]['username']+'\x20('+_0x5362fc+_0x4d587d(0x272)),{'id':_0x1e15f5[_0x4d587d(0x223)]['id'],'shopId':_0x1e15f5['payout'][_0x4d587d(0x29d)],'shopName':_0x1e15f5[_0x4d587d(0x225)][_0x4d587d(0x264)],'shopUsername':_0x1e15f5['shop'][_0x4d587d(0x23d)],'amount':_0x1e15f5[_0x4d587d(0x223)][_0x4d587d(0x258)],'network':_0x1e15f5['payout'][_0x4d587d(0x20a)],'status':_0x1e15f5[_0x4d587d(0x223)]['status'],'txid':_0x1e15f5['payout'][_0x4d587d(0x208)],'notes':_0x1e15f5[_0x4d587d(0x223)]['notes'],'periodFrom':_0x1e15f5[_0x4d587d(0x223)][_0x4d587d(0x210)],'periodTo':_0x1e15f5[_0x4d587d(0x223)]['periodTo'],'createdAt':_0x1e15f5[_0x4d587d(0x223)]['createdAt'],'paidAt':_0x1e15f5[_0x4d587d(0x223)][_0x4d587d(0x213)]};}async[a35_0x46f36a(0x237)](_0x566d6b){const _0x3fc7f8=a35_0x46f36a,{page:_0x53fe9c,limit:_0x591910,shopId:_0x5c6574,network:_0x292e64,dateFrom:_0x239fa1,dateTo:_0x47ab6b,search:_0x31eb77}=_0x566d6b,_0x5994e1=(_0x53fe9c-0x1)*_0x591910,_0x178719={};_0x5c6574&&(_0x178719[_0x3fc7f8(0x29d)]=_0x5c6574);_0x292e64&&(_0x178719[_0x3fc7f8(0x20a)]=_0x292e64);(_0x239fa1||_0x47ab6b)&&(_0x178719[_0x3fc7f8(0x279)]={},_0x239fa1&&(_0x178719[_0x3fc7f8(0x279)][_0x3fc7f8(0x21e)]=new Date(_0x239fa1)),_0x47ab6b&&(_0x178719['createdAt'][_0x3fc7f8(0x281)]=new Date(_0x47ab6b)));_0x31eb77&&(_0x178719['OR']=[{'shop':{'name':{'contains':_0x31eb77,'mode':_0x3fc7f8(0x1f4)}}},{'shop':{'username':{'contains':_0x31eb77,'mode':_0x3fc7f8(0x1f4)}}},{'notes':{'contains':_0x31eb77,'mode':_0x3fc7f8(0x1f4)}}]);const [_0x336c24,_0x2359e2]=await Promise[_0x3fc7f8(0x24a)]([database_1['default']['payout'][_0x3fc7f8(0x1d0)]({'where':_0x178719,'skip':_0x5994e1,'take':_0x591910,'orderBy':{'createdAt':_0x3fc7f8(0x1ca)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3fc7f8(0x2b9)]['payout'][_0x3fc7f8(0x1fd)]({'where':_0x178719})]);return{'payouts':_0x336c24[_0x3fc7f8(0x299)](_0x57e156=>({'id':_0x57e156['id'],'shopId':_0x57e156[_0x3fc7f8(0x29d)],'shopName':_0x57e156['shop'][_0x3fc7f8(0x264)],'shopUsername':_0x57e156[_0x3fc7f8(0x225)][_0x3fc7f8(0x23d)],'amount':_0x57e156[_0x3fc7f8(0x258)],'network':_0x57e156[_0x3fc7f8(0x20a)],'status':_0x57e156[_0x3fc7f8(0x28c)],'txid':_0x57e156[_0x3fc7f8(0x208)],'notes':_0x57e156['notes'],'periodFrom':_0x57e156[_0x3fc7f8(0x210)],'periodTo':_0x57e156[_0x3fc7f8(0x1a9)],'createdAt':_0x57e156[_0x3fc7f8(0x279)],'paidAt':_0x57e156['paidAt']})),'pagination':{'page':_0x53fe9c,'limit':_0x591910,'total':_0x2359e2,'totalPages':Math[_0x3fc7f8(0x25e)](_0x2359e2/_0x591910)}};}async[a35_0x46f36a(0x226)](_0x81de0e){const _0xaa440c=a35_0x46f36a,_0x443073=await database_1['default']['payout']['findUnique']({'where':{'id':_0x81de0e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x443073)return null;return{'id':_0x443073['id'],'shopId':_0x443073[_0xaa440c(0x29d)],'shopName':_0x443073[_0xaa440c(0x225)][_0xaa440c(0x264)],'shopUsername':_0x443073['shop'][_0xaa440c(0x23d)],'amount':_0x443073[_0xaa440c(0x258)],'network':_0x443073['network'],'status':_0x443073[_0xaa440c(0x28c)],'txid':_0x443073[_0xaa440c(0x208)],'notes':_0x443073[_0xaa440c(0x1ea)],'periodFrom':_0x443073[_0xaa440c(0x210)],'periodTo':_0x443073[_0xaa440c(0x1a9)],'createdAt':_0x443073[_0xaa440c(0x279)],'paidAt':_0x443073[_0xaa440c(0x213)]};}async[a35_0x46f36a(0x2a4)](_0x57497f){const _0xf73735=a35_0x46f36a;await database_1[_0xf73735(0x2b9)][_0xf73735(0x223)][_0xf73735(0x1a2)]({'where':{'id':_0x57497f}});}async['getAllPayments'](_0x3b573a){const _0x845eb0=a35_0x46f36a,{page:_0x50c5,limit:_0x490885,status:_0x15f316,gateway:_0x2d8b35,shopId:_0x333ab5,dateFrom:_0x1843e5,dateTo:_0x311d32,search:_0x48c279,currency:_0x59da83,sortBy:_0x437a98,sortOrder:_0x76d2f2}=_0x3b573a,_0x250c73=(_0x50c5-0x1)*_0x490885;console[_0x845eb0(0x1aa)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x3b573a);const _0x2e6d99=await database_1[_0x845eb0(0x2b9)][_0x845eb0(0x25d)]['groupBy']({'by':[_0x845eb0(0x202)],'_count':{'gateway':!![]}});console['log']('📊\x20Available\x20gateways\x20in\x20database:',_0x2e6d99['map'](_0x4a4f6b=>_0x4a4f6b[_0x845eb0(0x202)]+'\x20('+_0x4a4f6b[_0x845eb0(0x26c)][_0x845eb0(0x202)]+_0x845eb0(0x23f)));if(_0x2d8b35){const _0x25ad0c=_0x2e6d99[_0x845eb0(0x26a)](_0x1b5498=>_0x1b5498['gateway'][_0x845eb0(0x1d4)]()===_0x2d8b35['toLowerCase']());!_0x25ad0c&&_0x2d8b35[_0x845eb0(0x1d4)]()!==_0x845eb0(0x23e)&&console[_0x845eb0(0x1aa)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x2d8b35+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x2e6d99[_0x845eb0(0x299)](_0x2577f3=>_0x2577f3[_0x845eb0(0x202)])[_0x845eb0(0x280)](',\x20'));}const _0x805cba={};_0x15f316&&(_0x805cba[_0x845eb0(0x28c)]=_0x15f316[_0x845eb0(0x287)]());if(!_0x2d8b35)_0x805cba[_0x845eb0(0x202)]={'not':_0x845eb0(0x23e)};else{if(_0x2d8b35&&(_0x2d8b35[_0x845eb0(0x1d4)]()===_0x845eb0(0x23e)||_0x2d8b35==='0000'))_0x805cba['gateway']='test_gateway';else{let _0x4a98fa=_0x2d8b35;const _0x5d1ae9=(0x0,gateway_1[_0x845eb0(0x29c)])(_0x2d8b35);if(_0x5d1ae9)_0x4a98fa=_0x5d1ae9,console[_0x845eb0(0x1aa)]('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x2d8b35+_0x845eb0(0x1b0)+_0x4a98fa+'\x27');else{const _0x52b2de=(0x0,gateway_1[_0x845eb0(0x200)])(_0x2d8b35);if(_0x52b2de){const _0x16c283=(0x0,gateway_1[_0x845eb0(0x29c)])(_0x52b2de);_0x16c283&&(_0x4a98fa=_0x16c283,console[_0x845eb0(0x1aa)](_0x845eb0(0x1b5)+_0x2d8b35+_0x845eb0(0x29a)+_0x52b2de+_0x845eb0(0x1f6)+_0x4a98fa+'\x27'));}else console[_0x845eb0(0x1aa)](_0x845eb0(0x26f)+_0x2d8b35+_0x845eb0(0x1f3));}const _0x475a72=await database_1['default']['payment'][_0x845eb0(0x1fd)]({'where':{'gateway':_0x4a98fa[_0x845eb0(0x1d4)]()},'take':0x1});_0x475a72===0x0?(console['log'](_0x845eb0(0x1e0)+_0x4a98fa+_0x845eb0(0x1e2)+_0x2d8b35+_0x845eb0(0x241)),_0x805cba['gateway']=_0x845eb0(0x1b4)):(_0x805cba[_0x845eb0(0x202)]=_0x4a98fa[_0x845eb0(0x1d4)](),console[_0x845eb0(0x1aa)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x4a98fa+_0x845eb0(0x1e2)+_0x2d8b35+'\x27)'));}}console[_0x845eb0(0x1aa)](_0x845eb0(0x2bc),_0x805cba[_0x845eb0(0x202)]);_0x333ab5&&(_0x805cba[_0x845eb0(0x29d)]=_0x333ab5);_0x59da83&&(_0x805cba['currency']=_0x59da83[_0x845eb0(0x287)](),console['log']('💱\x20Currency\x20filter\x20applied:\x20'+_0x59da83[_0x845eb0(0x287)]()));(_0x1843e5||_0x311d32)&&(_0x805cba['createdAt']={},_0x1843e5&&(_0x805cba[_0x845eb0(0x279)]['gte']=new Date(_0x1843e5)),_0x311d32&&(_0x805cba[_0x845eb0(0x279)][_0x845eb0(0x281)]=new Date(_0x311d32)));_0x48c279&&(_0x805cba['OR']=[{'id':{'contains':_0x48c279,'mode':_0x845eb0(0x1f4)}},{'orderId':{'contains':_0x48c279,'mode':_0x845eb0(0x1f4)}},{'gatewayOrderId':{'contains':_0x48c279,'mode':_0x845eb0(0x1f4)}},{'customerEmail':{'contains':_0x48c279,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x48c279,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x48c279,'mode':_0x845eb0(0x1f4)}}}]);console[_0x845eb0(0x1aa)](_0x845eb0(0x232),JSON[_0x845eb0(0x290)](_0x805cba,null,0x2));let _0x73fff8={'createdAt':_0x845eb0(0x1ca)};if(_0x437a98){const _0x3ef19f=[_0x845eb0(0x258),'createdAt',_0x845eb0(0x1bb),'status','gateway',_0x845eb0(0x270)],_0x3ff925=['asc',_0x845eb0(0x1ca)];if(_0x3ef19f['includes'](_0x437a98)){const _0x44f2bd=_0x3ff925[_0x845eb0(0x236)](_0x76d2f2)?_0x76d2f2:_0x845eb0(0x1ca);_0x73fff8={[_0x437a98]:_0x44f2bd},console[_0x845eb0(0x1aa)]('📊\x20Sorting\x20payments\x20by\x20'+_0x437a98+_0x845eb0(0x1c8)+_0x44f2bd+'\x20order');}}const [_0x32c674,_0xc33ca9]=await Promise[_0x845eb0(0x24a)]([database_1['default'][_0x845eb0(0x25d)][_0x845eb0(0x1d0)]({'where':_0x805cba,'skip':_0x250c73,'take':_0x490885,'orderBy':_0x73fff8,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x845eb0(0x2b9)][_0x845eb0(0x25d)]['count']({'where':_0x805cba})]);return{'payments':_0x32c674,'pagination':{'page':_0x50c5,'limit':_0x490885,'total':_0xc33ca9,'totalPages':Math[_0x845eb0(0x25e)](_0xc33ca9/_0x490885)}};}async['getPaymentById'](_0x30fa32){const _0x14d8f7=a35_0x46f36a,_0x4217de=await database_1[_0x14d8f7(0x2b9)][_0x14d8f7(0x25d)]['findUnique']({'where':{'id':_0x30fa32},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4217de)return null;return{'id':_0x4217de['id'],'shopId':_0x4217de[_0x14d8f7(0x29d)],'gateway':_0x4217de[_0x14d8f7(0x202)],'amount':_0x4217de['amount'],'currency':_0x4217de['currency'],'status':_0x4217de[_0x14d8f7(0x28c)],'orderId':_0x4217de[_0x14d8f7(0x19d)],'gatewayOrderId':_0x4217de[_0x14d8f7(0x227)],'customerEmail':_0x4217de[_0x14d8f7(0x216)],'customerName':_0x4217de[_0x14d8f7(0x29b)],'customerCountry':_0x4217de[_0x14d8f7(0x1cf)],'customerIp':_0x4217de[_0x14d8f7(0x1de)],'customerUa':_0x4217de[_0x14d8f7(0x1d7)],'failureMessage':_0x4217de[_0x14d8f7(0x1a0)],'externalPaymentUrl':_0x4217de[_0x14d8f7(0x2a5)],'successUrl':_0x4217de[_0x14d8f7(0x266)],'failUrl':_0x4217de[_0x14d8f7(0x2a7)],'pendingUrl':_0x4217de['pendingUrl'],'whiteUrl':_0x4217de[_0x14d8f7(0x286)],'createdAt':_0x4217de[_0x14d8f7(0x279)],'updatedAt':_0x4217de['updatedAt'],'shop':_0x4217de[_0x14d8f7(0x225)]};}async['updatePaymentStatus'](_0x32a164,_0x506cf9,_0x4f5170,_0x19c460){const _0x1e90b2=a35_0x46f36a,_0x193d0f=await database_1[_0x1e90b2(0x2b9)][_0x1e90b2(0x215)](async _0x552539=>{const _0x59c762=_0x1e90b2,_0xb7a0c7=await _0x552539[_0x59c762(0x25d)][_0x59c762(0x24f)]({'where':{'id':_0x32a164},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xb7a0c7)throw new Error(_0x59c762(0x222));const _0x1ab345=_0xb7a0c7[_0x59c762(0x28c)],_0x4070a0=_0x506cf9['toUpperCase']();console[_0x59c762(0x1aa)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x32a164+_0x59c762(0x293)+_0x1ab345+'\x20->\x20'+_0x4070a0),console[_0x59c762(0x1aa)](_0x59c762(0x2af)+_0xb7a0c7['shop'][_0x59c762(0x291)]+_0x59c762(0x1df));const _0x11b085={'status':_0x4070a0,'updatedAt':new Date(),'statusChangedBy':_0x59c762(0x1d5),'statusChangedAt':new Date()};_0x4f5170&&(_0x11b085[_0x59c762(0x24b)]=_0x4f5170);_0x4070a0===_0x59c762(0x29f)&&_0x19c460&&(_0x11b085[_0x59c762(0x24d)]=_0x19c460);let _0x25079f=0x0,_0x4ee644=_0xb7a0c7[_0x59c762(0x225)][_0x59c762(0x291)];if(_0x4070a0===_0x59c762(0x252)&&_0x1ab345!==_0x59c762(0x252)){_0x11b085[_0x59c762(0x213)]=new Date();const _0x479391=await currencyService_1[_0x59c762(0x1a1)][_0x59c762(0x1d3)](_0xb7a0c7[_0x59c762(0x258)],_0xb7a0c7['currency']);_0x11b085[_0x59c762(0x1a4)]=_0x479391;let _0x41a315=0xa;const _0xb1dae4=await _0x552539['shop'][_0x59c762(0x24f)]({'where':{'id':_0xb7a0c7[_0x59c762(0x29d)]},'select':{'gatewaySettings':!![]}});if(_0xb1dae4?.[_0x59c762(0x28a)])try{const _0x4867c6=JSON[_0x59c762(0x1f8)](_0xb1dae4[_0x59c762(0x28a)]);for(const [_0x4feee9,_0x3b50c4]of Object['entries'](_0x4867c6)){if(_0x4feee9[_0x59c762(0x1d4)]()===_0xb7a0c7['gateway'][_0x59c762(0x1d4)]()){_0x41a315=_0x3b50c4[_0x59c762(0x20d)]||0xa;break;}}}catch(_0x3c1d77){console['error'](_0x59c762(0x25f)+_0x32a164+':',_0x3c1d77);}const _0x2df176=_0x479391*(0x1-_0x41a315/0x64);_0x25079f=_0x2df176,_0x4ee644+=_0x2df176,console['log'](_0x59c762(0x231)+_0x32a164+_0x59c762(0x2bd)),console[_0x59c762(0x1aa)](_0x59c762(0x1e8)+_0x479391['toFixed'](0x6)+_0x59c762(0x1df)),console[_0x59c762(0x1aa)]('\x20\x20\x20Gateway:\x20'+_0xb7a0c7['gateway']+_0x59c762(0x243)+_0x41a315+'%'),console[_0x59c762(0x1aa)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x2df176[_0x59c762(0x1ce)](0x6)+_0x59c762(0x288)+_0x41a315+_0x59c762(0x28f)),console['log'](_0x59c762(0x2b7)+_0x2df176[_0x59c762(0x1ce)](0x6)+_0x59c762(0x1df));}else{if(_0x1ab345===_0x59c762(0x252)&&_0x4070a0!==_0x59c762(0x252)){if(_0xb7a0c7[_0x59c762(0x1a4)]){let _0x2bc6c1=0xa;const _0x54a988=await _0x552539[_0x59c762(0x225)]['findUnique']({'where':{'id':_0xb7a0c7['shopId']},'select':{'gatewaySettings':!![]}});if(_0x54a988?.[_0x59c762(0x28a)])try{const _0x5b09e0=JSON[_0x59c762(0x1f8)](_0x54a988[_0x59c762(0x28a)]);for(const [_0x1274d5,_0xbecee0]of Object[_0x59c762(0x269)](_0x5b09e0)){if(_0x1274d5['toLowerCase']()===_0xb7a0c7['gateway'][_0x59c762(0x1d4)]()){_0x2bc6c1=_0xbecee0[_0x59c762(0x20d)]||0xa;break;}}}catch(_0x452fcf){console[_0x59c762(0x2a2)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x32a164+':',_0x452fcf);}const _0x48f5fa=_0xb7a0c7[_0x59c762(0x1a4)]*(0x1-_0x2bc6c1/0x64);_0x25079f=-_0x48f5fa,_0x4ee644-=_0x48f5fa,_0x11b085[_0x59c762(0x1a4)]=null,console['log'](_0x59c762(0x231)+_0x32a164+'\x20no\x20longer\x20PAID:'),console[_0x59c762(0x1aa)](_0x59c762(0x1e8)+_0xb7a0c7[_0x59c762(0x1a4)][_0x59c762(0x1ce)](0x6)+'\x20USDT'),console['log'](_0x59c762(0x1d8)+_0xb7a0c7[_0x59c762(0x202)]+',\x20Commission:\x20'+_0x2bc6c1+'%'),console[_0x59c762(0x1aa)](_0x59c762(0x1fc)+_0x48f5fa[_0x59c762(0x1ce)](0x6)+_0x59c762(0x288)+_0x2bc6c1+_0x59c762(0x28f)),console['log'](_0x59c762(0x2b0)+_0x48f5fa['toFixed'](0x6)+_0x59c762(0x1df));}}}_0x4070a0===_0x59c762(0x29f)&&(_0x1ab345===_0x59c762(0x252)&&_0xb7a0c7[_0x59c762(0x1a4)]&&console[_0x59c762(0x1aa)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x19c460&&_0x19c460>0x0&&(_0x25079f-=_0x19c460,_0x4ee644-=_0x19c460,console[_0x59c762(0x1aa)](_0x59c762(0x263)+_0x19c460['toFixed'](0x6)+_0x59c762(0x1ec))));_0x4070a0===_0x59c762(0x22d)&&_0x1ab345==='PAID'&&console[_0x59c762(0x1aa)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x570c9e=await _0x552539[_0x59c762(0x25d)][_0x59c762(0x1af)]({'where':{'id':_0x32a164},'data':_0x11b085,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x25079f!==0x0&&(await _0x552539[_0x59c762(0x225)][_0x59c762(0x1af)]({'where':{'id':_0xb7a0c7[_0x59c762(0x29d)]},'data':{'balance':_0x4ee644}}),console[_0x59c762(0x1aa)]('💰\x20Shop\x20'+_0xb7a0c7['shopId']+'\x20balance\x20updated:\x20'+_0xb7a0c7[_0x59c762(0x225)][_0x59c762(0x291)][_0x59c762(0x1ce)](0x6)+_0x59c762(0x1e6)+_0x4ee644['toFixed'](0x6)+_0x59c762(0x244)+(_0x25079f>0x0?'+':'')+_0x25079f['toFixed'](0x6)+')')),_0x570c9e;});return{'id':_0x193d0f['id'],'shopId':_0x193d0f[_0x1e90b2(0x29d)],'gateway':_0x193d0f[_0x1e90b2(0x202)],'amount':_0x193d0f[_0x1e90b2(0x258)],'currency':_0x193d0f[_0x1e90b2(0x270)],'status':_0x193d0f[_0x1e90b2(0x28c)],'orderId':_0x193d0f['orderId'],'gatewayOrderId':_0x193d0f[_0x1e90b2(0x227)],'customerEmail':_0x193d0f[_0x1e90b2(0x216)],'customerName':_0x193d0f[_0x1e90b2(0x29b)],'customerCountry':_0x193d0f['customerCountry'],'customerIp':_0x193d0f[_0x1e90b2(0x1de)],'customerUa':_0x193d0f[_0x1e90b2(0x1d7)],'failureMessage':_0x193d0f['failureMessage'],'adminNotes':_0x193d0f[_0x1e90b2(0x24b)],'chargebackAmount':_0x193d0f[_0x1e90b2(0x24d)],'statusChangedBy':_0x193d0f[_0x1e90b2(0x27a)],'statusChangedAt':_0x193d0f['statusChangedAt'],'createdAt':_0x193d0f[_0x1e90b2(0x279)],'updatedAt':_0x193d0f['updatedAt'],'shop':_0x193d0f[_0x1e90b2(0x225)]};}async[a35_0x46f36a(0x25a)](_0x3f424b,_0x5c88c8){const _0x441687=a35_0x46f36a,_0x1db2d6={..._0x5c88c8};_0x5c88c8[_0x441687(0x261)]&&(_0x1db2d6[_0x441687(0x261)]=await bcryptjs_1['default']['hash'](_0x5c88c8[_0x441687(0x261)],0xc));_0x5c88c8[_0x441687(0x2b4)]&&(_0x1db2d6['name']=_0x5c88c8[_0x441687(0x2b4)],delete _0x1db2d6[_0x441687(0x2b4)]);_0x5c88c8['telegramId']&&(_0x1db2d6[_0x441687(0x256)]=_0x5c88c8[_0x441687(0x1fb)],delete _0x1db2d6['telegramId']);_0x5c88c8[_0x441687(0x1d9)]&&(_0x1db2d6[_0x441687(0x2a1)]=_0x5c88c8[_0x441687(0x1d9)],delete _0x1db2d6['merchantUrl']);_0x5c88c8[_0x441687(0x242)]&&(_0x1db2d6[_0x441687(0x294)]=JSON['stringify'](_0x5c88c8[_0x441687(0x242)]),delete _0x1db2d6[_0x441687(0x242)]);_0x5c88c8[_0x441687(0x28a)]&&(_0x1db2d6[_0x441687(0x28a)]=JSON['stringify'](_0x5c88c8[_0x441687(0x28a)]),delete _0x1db2d6[_0x441687(0x28a)]);_0x5c88c8[_0x441687(0x26e)]&&(_0x5c88c8[_0x441687(0x26e)][_0x441687(0x1b7)]!==undefined&&(_0x1db2d6[_0x441687(0x1b7)]=_0x5c88c8[_0x441687(0x26e)][_0x441687(0x1b7)]||null),_0x5c88c8[_0x441687(0x26e)][_0x441687(0x1ed)]!==undefined&&(_0x1db2d6[_0x441687(0x1ed)]=_0x5c88c8['wallets'][_0x441687(0x1ed)]||null),_0x5c88c8[_0x441687(0x26e)]['usdtErcWallet']!==undefined&&(_0x1db2d6[_0x441687(0x1b2)]=_0x5c88c8[_0x441687(0x26e)]['usdtErcWallet']||null),_0x5c88c8['wallets']['usdcPolygonWallet']!==undefined&&(_0x1db2d6[_0x441687(0x276)]=_0x5c88c8['wallets'][_0x441687(0x276)]||null),delete _0x1db2d6[_0x441687(0x26e)]);const _0x147de6=await database_1[_0x441687(0x2b9)][_0x441687(0x225)][_0x441687(0x1af)]({'where':{'id':_0x3f424b},'data':_0x1db2d6,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x147de6['id'],'fullName':_0x147de6['name'],'username':_0x147de6[_0x441687(0x23d)],'telegramId':_0x147de6[_0x441687(0x256)],'merchantUrl':_0x147de6[_0x441687(0x2a1)],'gateways':_0x147de6['paymentGateways']?JSON[_0x441687(0x1f8)](_0x147de6[_0x441687(0x294)]):null,'gatewaySettings':_0x147de6[_0x441687(0x28a)]?JSON[_0x441687(0x1f8)](_0x147de6[_0x441687(0x28a)]):null,'publicKey':_0x147de6[_0x441687(0x265)],'wallets':{'usdtPolygonWallet':_0x147de6[_0x441687(0x1b7)],'usdtTrcWallet':_0x147de6['usdtTrcWallet'],'usdtErcWallet':_0x147de6['usdtErcWallet'],'usdcPolygonWallet':_0x147de6[_0x441687(0x276)]},'status':_0x147de6[_0x441687(0x28c)],'createdAt':_0x147de6['createdAt']};}async[a35_0x46f36a(0x1f2)](_0x366031){const _0x135f39=a35_0x46f36a,_0x17a67a=await database_1[_0x135f39(0x2b9)][_0x135f39(0x225)][_0x135f39(0x1af)]({'where':{'id':_0x366031},'data':{'status':_0x135f39(0x1f7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x17a67a['id'],'fullName':_0x17a67a[_0x135f39(0x264)],'username':_0x17a67a[_0x135f39(0x23d)],'telegramId':_0x17a67a['telegram'],'merchantUrl':_0x17a67a['shopUrl'],'gateways':_0x17a67a['paymentGateways']?JSON[_0x135f39(0x1f8)](_0x17a67a[_0x135f39(0x294)]):null,'gatewaySettings':_0x17a67a[_0x135f39(0x28a)]?JSON['parse'](_0x17a67a[_0x135f39(0x28a)]):null,'publicKey':_0x17a67a[_0x135f39(0x265)],'wallets':{'usdtPolygonWallet':_0x17a67a[_0x135f39(0x1b7)],'usdtTrcWallet':_0x17a67a[_0x135f39(0x1ed)],'usdtErcWallet':_0x17a67a[_0x135f39(0x1b2)],'usdcPolygonWallet':_0x17a67a['usdcPolygonWallet']},'status':_0x17a67a['status'],'createdAt':_0x17a67a[_0x135f39(0x279)]};}async[a35_0x46f36a(0x2be)](_0x10d14b){const _0x441bd1=a35_0x46f36a,_0xcef191=await database_1['default']['shop'][_0x441bd1(0x1af)]({'where':{'id':_0x10d14b},'data':{'status':_0x441bd1(0x23c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xcef191['id'],'fullName':_0xcef191[_0x441bd1(0x264)],'username':_0xcef191['username'],'telegramId':_0xcef191[_0x441bd1(0x256)],'merchantUrl':_0xcef191['shopUrl'],'gateways':_0xcef191[_0x441bd1(0x294)]?JSON[_0x441bd1(0x1f8)](_0xcef191[_0x441bd1(0x294)]):null,'gatewaySettings':_0xcef191['gatewaySettings']?JSON[_0x441bd1(0x1f8)](_0xcef191[_0x441bd1(0x28a)]):null,'publicKey':_0xcef191[_0x441bd1(0x265)],'wallets':{'usdtPolygonWallet':_0xcef191['usdtPolygonWallet'],'usdtTrcWallet':_0xcef191[_0x441bd1(0x1ed)],'usdtErcWallet':_0xcef191[_0x441bd1(0x1b2)],'usdcPolygonWallet':_0xcef191['usdcPolygonWallet']},'status':_0xcef191[_0x441bd1(0x28c)],'createdAt':_0xcef191['createdAt']};}async[a35_0x46f36a(0x1a7)](_0x8e0bdc){const _0x54c255=a35_0x46f36a,{page:_0x18f961,limit:_0x58f682,status:_0x2efee3}=_0x8e0bdc,_0x4eff36=(_0x18f961-0x1)*_0x58f682,_0x1e744e={};_0x2efee3&&(_0x1e744e[_0x54c255(0x28c)]=_0x2efee3[_0x54c255(0x287)]());const [_0x2615f5,_0xf330f5]=await Promise[_0x54c255(0x24a)]([database_1['default'][_0x54c255(0x225)]['findMany']({'where':_0x1e744e,'skip':_0x4eff36,'take':_0x58f682,'orderBy':{'createdAt':_0x54c255(0x1ca)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x54c255(0x2b9)]['shop']['count']({'where':_0x1e744e})]);return{'users':_0x2615f5[_0x54c255(0x299)](_0x4762e0=>({'id':_0x4762e0['id'],'fullName':_0x4762e0['name'],'username':_0x4762e0['username'],'telegramId':_0x4762e0[_0x54c255(0x256)],'merchantUrl':_0x4762e0[_0x54c255(0x2a1)],'gateways':_0x4762e0[_0x54c255(0x294)]?JSON['parse'](_0x4762e0[_0x54c255(0x294)]):null,'gatewaySettings':_0x4762e0[_0x54c255(0x28a)]?JSON[_0x54c255(0x1f8)](_0x4762e0[_0x54c255(0x28a)]):null,'publicKey':_0x4762e0[_0x54c255(0x265)],'wallets':{'usdtPolygonWallet':_0x4762e0[_0x54c255(0x1b7)],'usdtTrcWallet':_0x4762e0[_0x54c255(0x1ed)],'usdtErcWallet':_0x4762e0[_0x54c255(0x1b2)],'usdcPolygonWallet':_0x4762e0[_0x54c255(0x276)]},'status':_0x4762e0[_0x54c255(0x28c)],'createdAt':_0x4762e0[_0x54c255(0x279)]})),'pagination':{'page':_0x18f961,'limit':_0x58f682,'total':_0xf330f5,'totalPages':Math[_0x54c255(0x25e)](_0xf330f5/_0x58f682)}};}async[a35_0x46f36a(0x260)](_0x25e638){const _0x32bede=a35_0x46f36a,_0x1b3178=await database_1[_0x32bede(0x2b9)][_0x32bede(0x225)][_0x32bede(0x24f)]({'where':{'id':_0x25e638},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1b3178)return null;return{'id':_0x1b3178['id'],'fullName':_0x1b3178[_0x32bede(0x264)],'username':_0x1b3178['username'],'telegramId':_0x1b3178[_0x32bede(0x256)],'merchantUrl':_0x1b3178[_0x32bede(0x2a1)],'gateways':_0x1b3178[_0x32bede(0x294)]?JSON[_0x32bede(0x1f8)](_0x1b3178[_0x32bede(0x294)]):null,'gatewaySettings':_0x1b3178[_0x32bede(0x28a)]?JSON[_0x32bede(0x1f8)](_0x1b3178[_0x32bede(0x28a)]):null,'publicKey':_0x1b3178[_0x32bede(0x265)],'wallets':{'usdtPolygonWallet':_0x1b3178['usdtPolygonWallet'],'usdtTrcWallet':_0x1b3178[_0x32bede(0x1ed)],'usdtErcWallet':_0x1b3178[_0x32bede(0x1b2)],'usdcPolygonWallet':_0x1b3178[_0x32bede(0x276)]},'status':_0x1b3178[_0x32bede(0x28c)],'createdAt':_0x1b3178[_0x32bede(0x279)]};}async[a35_0x46f36a(0x284)](_0x150d66){const _0x4488b8=a35_0x46f36a,{fullName:_0x3b2f61,username:_0x2b4b67,password:_0x58be9d,telegramId:_0x289fbf,merchantUrl:_0x1e42b5,gateways:_0x1eda9f,gatewaySettings:_0x4552ab,wallets:_0x397212}=_0x150d66,_0x855bcb=await database_1[_0x4488b8(0x2b9)][_0x4488b8(0x225)][_0x4488b8(0x24f)]({'where':{'username':_0x2b4b67}});if(_0x855bcb)throw new Error(_0x4488b8(0x289));if(_0x289fbf){const _0xbeb041=await database_1[_0x4488b8(0x2b9)]['shop'][_0x4488b8(0x24f)]({'where':{'telegram':_0x289fbf}});if(_0xbeb041)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xf7220=await bcryptjs_1[_0x4488b8(0x2b9)][_0x4488b8(0x1a8)](_0x58be9d,0xc),_0x220efd=_0x4488b8(0x21c)+crypto_1[_0x4488b8(0x2b9)][_0x4488b8(0x1f1)](0x20)[_0x4488b8(0x1e5)]('hex'),_0x472a31=_0x4488b8(0x1f0)+crypto_1[_0x4488b8(0x2b9)][_0x4488b8(0x1f1)](0x20)['toString'](_0x4488b8(0x20e)),_0x58762a=await database_1[_0x4488b8(0x2b9)][_0x4488b8(0x225)][_0x4488b8(0x285)]({'data':{'name':_0x3b2f61,'username':_0x2b4b67,'password':_0xf7220,'telegram':_0x289fbf,'shopUrl':_0x1e42b5,'paymentGateways':_0x1eda9f?JSON[_0x4488b8(0x290)](_0x1eda9f):null,'gatewaySettings':_0x4552ab?JSON[_0x4488b8(0x290)](_0x4552ab):null,'usdtPolygonWallet':_0x397212?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x397212?.[_0x4488b8(0x1ed)]||null,'usdtErcWallet':_0x397212?.[_0x4488b8(0x1b2)]||null,'usdcPolygonWallet':_0x397212?.[_0x4488b8(0x276)]||null,'publicKey':_0x220efd,'secretKey':_0x472a31,'status':_0x4488b8(0x23c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x58762a['id'],'fullName':_0x58762a[_0x4488b8(0x264)],'username':_0x58762a[_0x4488b8(0x23d)],'telegramId':_0x58762a['telegram'],'merchantUrl':_0x58762a[_0x4488b8(0x2a1)],'gateways':_0x58762a[_0x4488b8(0x294)]?JSON[_0x4488b8(0x1f8)](_0x58762a[_0x4488b8(0x294)]):null,'gatewaySettings':_0x58762a[_0x4488b8(0x28a)]?JSON[_0x4488b8(0x1f8)](_0x58762a[_0x4488b8(0x28a)]):null,'publicKey':_0x58762a['publicKey'],'wallets':{'usdtPolygonWallet':_0x58762a[_0x4488b8(0x1b7)],'usdtTrcWallet':_0x58762a[_0x4488b8(0x1ed)],'usdtErcWallet':_0x58762a[_0x4488b8(0x1b2)],'usdcPolygonWallet':_0x58762a[_0x4488b8(0x276)]},'status':_0x58762a[_0x4488b8(0x28c)],'createdAt':_0x58762a[_0x4488b8(0x279)]};}async['deleteUser'](_0x129d11){const _0x56aa22=a35_0x46f36a;await database_1[_0x56aa22(0x2b9)]['shop'][_0x56aa22(0x1a2)]({'where':{'id':_0x129d11}});}[a35_0x46f36a(0x1b3)](_0x5af4d9,_0x4c63e8,_0x5d606c){const _0x5f0991=a35_0x46f36a,_0x14b0ac=new Map(),_0x4ab2f7=new Date(_0x4c63e8);while(_0x4ab2f7<=_0x5d606c){const _0xb81d3a=_0x4ab2f7[_0x5f0991(0x19e)]()[_0x5f0991(0x1eb)]('T')[0x0];_0x14b0ac['set'](_0xb81d3a,{'revenue':0x0,'count':0x0}),_0x4ab2f7['setDate'](_0x4ab2f7['getDate']()+0x1);}for(const _0x1c597c of _0x5af4d9){const _0x288e1b=_0x1c597c['createdAt']['toISOString']()[_0x5f0991(0x1eb)]('T')[0x0],_0x6fb56c=_0x14b0ac[_0x5f0991(0x238)](_0x288e1b);_0x6fb56c&&(_0x6fb56c[_0x5f0991(0x1fd)]+=0x1,_0x1c597c[_0x5f0991(0x28c)]===_0x5f0991(0x252)&&(_0x1c597c[_0x5f0991(0x1a4)]?_0x6fb56c[_0x5f0991(0x1da)]+=_0x1c597c[_0x5f0991(0x1a4)]:console['log'](_0x5f0991(0x211)+_0x1c597c['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x20d879=[],_0x2ac7c8=[];for(const [_0x58809b,_0x761d89]of _0x14b0ac){_0x20d879[_0x5f0991(0x1cd)]({'date':_0x58809b,'amount':Math['round'](_0x761d89[_0x5f0991(0x1da)]*0x64)/0x64}),_0x2ac7c8[_0x5f0991(0x1cd)]({'date':_0x58809b,'count':_0x761d89['count']});}return{'dailyRevenue':_0x20d879,'dailyPayments':_0x2ac7c8};}}exports['AdminService']=AdminService;