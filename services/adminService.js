'use strict';const a33_0x1aea9a=a33_0x37a4;function a33_0x37a4(_0xfa3c6b,_0xc2a152){const _0x2ca025=a33_0x2ca0();return a33_0x37a4=function(_0x37a461,_0x2b81b){_0x37a461=_0x37a461-0x1bc;let _0x33ee7c=_0x2ca025[_0x37a461];return _0x33ee7c;},a33_0x37a4(_0xfa3c6b,_0xc2a152);}(function(_0xf9efa8,_0xada497){const _0x27b983=a33_0x37a4,_0x527f7c=_0xf9efa8();while(!![]){try{const _0x17fa4b=-parseInt(_0x27b983(0x233))/0x1*(parseInt(_0x27b983(0x1c8))/0x2)+parseInt(_0x27b983(0x22e))/0x3*(-parseInt(_0x27b983(0x1dd))/0x4)+parseInt(_0x27b983(0x23d))/0x5*(parseInt(_0x27b983(0x274))/0x6)+parseInt(_0x27b983(0x24a))/0x7*(parseInt(_0x27b983(0x23f))/0x8)+parseInt(_0x27b983(0x1fb))/0x9*(parseInt(_0x27b983(0x1f1))/0xa)+-parseInt(_0x27b983(0x24c))/0xb*(-parseInt(_0x27b983(0x214))/0xc)+parseInt(_0x27b983(0x281))/0xd*(-parseInt(_0x27b983(0x207))/0xe);if(_0x17fa4b===_0xada497)break;else _0x527f7c['push'](_0x527f7c['shift']());}catch(_0x144d49){_0x527f7c['push'](_0x527f7c['shift']());}}}(a33_0x2ca0,0x83bc7));var __importDefault=this&&this[a33_0x1aea9a(0x1f7)]||function(_0xc2d1b){const _0x4aa7d9=a33_0x1aea9a;return _0xc2d1b&&_0xc2d1b[_0x4aa7d9(0x218)]?_0xc2d1b:{'default':_0xc2d1b};};Object[a33_0x1aea9a(0x24f)](exports,'__esModule',{'value':!![]}),exports[a33_0x1aea9a(0x1f5)]=void 0x0;const database_1=__importDefault(require(a33_0x1aea9a(0x228))),currencyService_1=require(a33_0x1aea9a(0x20b)),userService_1=require(a33_0x1aea9a(0x1cb)),telegramBotService_1=require(a33_0x1aea9a(0x294)),gateway_1=require(a33_0x1aea9a(0x20f));function a33_0x2ca0(){const _0x5746ea=['username','paymentGateways','./userService','getTime','adminNotes','txid','toFixed','statusChangedBy','üìä\x20Found\x20','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','‚úÖ\x20Payment\x20','gateway','convertToUSDT','from','üóëÔ∏è\x20Deleting\x20payout:\x20','gatewaySettings','toISOString','\x20payments\x20out\x20of\x20','default','remitterIban','52IYmzeM','üë•\x20Total\x20users:\x20','setDate','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','üí∞\x20Found\x20','getFullYear','üîç\x20Getting\x20payment\x20by\x20ID:\x20','admin','amountUSDT','getMerchantsAwaitingPayout','reduce','shopId','\x20activated\x20successfully','webhookLogs','Payout\x20not\x20found','customerName','üè™\x20Found\x20','all','currency','network','2779630tWLsjk','includes','commission','orderId','AdminService','round','__importDefault','‚ùå\x20Payment\x20not\x20found:\x20','name','amountAfterCommissionUSDT','18mXFpbo','üìÖ\x20This\x20Month:\x20','getGatewaySettings','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','isValidGatewayId','update','bankId','abs','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','üí∞\x20Available\x20Balance:\x20','REFUND','payment','10332994rqgTNB','\x20merchants\x20with\x20eligible\x20PAID\x20payments','SUSPENDED','completed','./currencyService','\x20USDT','insensitive','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','../types/gateway','\x20users\x20out\x20of\x20','telegram','getPaymentById','log','996dFtRAN','‚úÖ\x20Payout\x20statistics\x20calculated:','\x20days)','getDate','__esModule','\x20payouts\x20out\x20of\x20','totalAmountAfterCommissionUSDT','deleteUser','updatedAt','generateDateRange','usdtPolygonWallet','üíµ\x20Total\x20revenue:\x20','updateUser','createUser','üìã\x20Getting\x20users\x20with\x20filters:','getUserById','count','calculateEffectiveAmount','desc','gatewayPaymentId','../config/database','paidAt','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','gte','üö´\x20Suspending\x20user:\x20','error','118143BkmjLW','length','parse','ACTIVE','\x20to\x20','4WqnQZr','expiresAt','Payment\x20not\x20found','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','totalAmountUSDT','usdcPolygonWallet','üìã\x20Getting\x20payments\x20with\x20filters:','getPayoutStats','üìã\x20Getting\x20payouts\x20with\x20filters:','paymentMethod','3208085mnDCtD','findMany','2726328wXoOVK','customerEmail','shopUrl','User\x20is\x20already\x20suspended','usage','isEligibleForPayout','split','telegramBotService','usdtTrcWallet','payments','sourceCurrency','7vhYOJE','notes','72193lAHsSp','amount','charAt','defineProperty','‚úÖ\x20Payout\x20created\x20successfully:\x20','üîç\x20Getting\x20payout\x20by\x20ID:\x20','webhookLog','\x20status\x20to:\x20','chargebackAmount','toUpperCase','delete','lte','slice','\x20USDT\x20after\x20commission)','\x20USDT\x20via\x20','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','shop','sort','\x20days','remitterName','CHARGEBACK','calculateAmountAfterCommission','publicKey','üí∏\x20Chargeback\x20amount:\x20','awaitingPayout','UserService','statusChangedAt','currencyService','cardLast4','‚úÖ\x20User\x20','admin_status_update','create','Invalid\x20status.\x20Valid\x20statuses:\x20','map','updatePaymentStatus','createdAt','Shop\x20not\x20found','EXPIRED','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','üí∏\x20Total\x20Payout:\x20','6IVCpMG','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','90d','getSystemStatistics','‚úÖ\x20Activating\x20user:\x20','\x20payments\x20as\x20paid\x20out','\x20USDT\x20(','‚úÖ\x20Marked\x20','payoutDelay','markPaymentsAsPaidOut','get','Error\x20parsing\x20gateway\x20settings:','\x20merchants\x20out\x20of\x20','13xIOUVD','getPeriodDays','\x20status\x20updated\x20from\x20','User\x20not\x20found','\x20deleted\x20successfully',',\x20amount:\x20','gatewayOrderId','\x20total','externalPaymentUrl','payout','activateUser','ceil','date','‚úÖ\x20Payout\x20','toLowerCase','getGatewayNameById','User\x20is\x20already\x20active','üîÑ\x20Admin\x20updating\x20payment\x20','PENDING','./telegramBotService','‚úÖ\x20Found\x20payout:\x20','30d','getAllUsers','getPayoutById','findUnique','üí∏\x20Creating\x20payout\x20for\x20shop\x20','status','push','merchantPaid','usdtErcWallet','PAID','userService','‚ùå\x20Payout\x20not\x20found:\x20','146724fGHrsx'];a33_0x2ca0=function(){return _0x5746ea;};return a33_0x2ca0();}class AdminService{constructor(){const _0x43eb44=a33_0x1aea9a;this[_0x43eb44(0x1c6)]=new userService_1[(_0x43eb44(0x265))]();}[a33_0x1aea9a(0x282)](_0xe27e0f){const _0x2ba8c0=a33_0x1aea9a;switch(_0xe27e0f){case'7d':return 0x7;case _0x2ba8c0(0x1bc):return 0x1e;case _0x2ba8c0(0x276):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x1aea9a(0x21d)](_0x564c5f,_0x33c380){const _0x3fa8e9=a33_0x1aea9a,_0x1cb41a=[],_0x24d223=new Date(_0x564c5f);while(_0x24d223<=_0x33c380){_0x1cb41a['push'](_0x24d223[_0x3fa8e9(0x1d9)]()[_0x3fa8e9(0x245)]('T')[0x0]),_0x24d223[_0x3fa8e9(0x1df)](_0x24d223[_0x3fa8e9(0x217)]()+0x1);}return _0x1cb41a;}['getGatewaySettings'](_0x12789b,_0xbc627e){const _0x4381f0=a33_0x1aea9a;if(!_0x12789b[_0x4381f0(0x1d8)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x579e85=JSON['parse'](_0x12789b[_0x4381f0(0x1d8)]),_0x4182f8=_0xbc627e[_0x4381f0(0x24e)](0x0)[_0x4381f0(0x255)]()+_0xbc627e[_0x4381f0(0x258)](0x1)['toLowerCase']();if(_0x579e85&&_0x579e85[_0x4182f8])return{'commission':_0x579e85[_0x4182f8]['commission']||0x0,'payoutDelay':_0x579e85[_0x4182f8]['payoutDelay']||0x0};}catch(_0x427cbf){console[_0x4381f0(0x22d)](_0x4381f0(0x27f),_0x427cbf);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x1aea9a(0x244)](_0xacde75){const _0x19385a=a33_0x1aea9a;if(_0xacde75['status']!==_0x19385a(0x1c5)||_0xacde75[_0x19385a(0x1c3)]||!_0xacde75[_0x19385a(0x229)])return![];const _0x3a838f=this[_0x19385a(0x1fd)](_0xacde75[_0x19385a(0x25c)],_0xacde75['gateway']),_0x1f0989=_0x3a838f[_0x19385a(0x27c)]*0x18*0x3c*0x3c*0x3e8,_0x2c66bc=new Date(_0xacde75[_0x19385a(0x229)][_0x19385a(0x1cc)]()+_0x1f0989);return new Date()>_0x2c66bc;}[a33_0x1aea9a(0x261)](_0x44409e,_0x553258){return _0x44409e*(0x1-_0x553258/0x64);}['calculateEffectiveAmount'](_0x23821c){const _0x4d7434=a33_0x1aea9a;switch(_0x23821c[_0x4d7434(0x1c1)]){case'PAID':return _0x23821c[_0x4d7434(0x24d)];case _0x4d7434(0x260):return-(_0x23821c[_0x4d7434(0x254)]||0x0);case'REFUND':return 0x0;default:return 0x0;}}async['createPayout'](_0xc52ba6){const _0xc46527=a33_0x1aea9a,{shopId:_0x4e0acf,amount:_0x222ded,network:_0x21b74e,notes:_0x1427fb}=_0xc52ba6;console[_0xc46527(0x213)](_0xc46527(0x1c0)+_0x4e0acf+':\x20'+_0x222ded+_0xc46527(0x25a)+_0x21b74e);const _0x4d5fbc=await database_1[_0xc46527(0x1db)][_0xc46527(0x25c)][_0xc46527(0x1bf)]({'where':{'id':_0x4e0acf},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x4d5fbc)throw new Error(_0xc46527(0x270));if(_0x4d5fbc['status']!=='ACTIVE')throw new Error('Shop\x20is\x20not\x20active');const _0x586a32=await database_1[_0xc46527(0x1db)]['payout'][_0xc46527(0x26b)]({'data':{'shopId':_0x4e0acf,'amount':_0x222ded,'network':_0x21b74e,'status':'COMPLETED','notes':_0x1427fb||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this['markPaymentsAsPaidOut'](_0x4e0acf,_0x222ded);try{await telegramBotService_1[_0xc46527(0x246)]['sendPayoutNotification'](_0x4e0acf,_0x586a32,_0xc46527(0x20a));}catch(_0x4943e7){console[_0xc46527(0x22d)](_0xc46527(0x236),_0x4943e7);}return console['log'](_0xc46527(0x250)+_0x586a32['id']),{'id':_0x586a32['id'],'shopId':_0x586a32['shopId'],'shopName':_0x586a32['shop']['name'],'shopUsername':_0x586a32[_0xc46527(0x25c)]['username'],'amount':_0x586a32[_0xc46527(0x24d)],'network':_0x586a32['network'],'status':_0x586a32[_0xc46527(0x1c1)],'txid':_0x586a32['txid'],'notes':_0x586a32[_0xc46527(0x24b)],'createdAt':_0x586a32[_0xc46527(0x26f)],'paidAt':_0x586a32[_0xc46527(0x229)]};}async[a33_0x1aea9a(0x27d)](_0x1d7564,_0x53ffac){const _0x987803=a33_0x1aea9a;console[_0x987803(0x213)](_0x987803(0x272)+_0x1d7564+_0x987803(0x286)+_0x53ffac+'\x20USDT');const _0x1074d5=await database_1['default'][_0x987803(0x206)][_0x987803(0x23e)]({'where':{'shopId':_0x1d7564,'status':_0x987803(0x1c5),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':'asc'}});let _0x4bd6ef=_0x53ffac;const _0x246d1d=[];for(const _0x2bba7c of _0x1074d5){const _0x2e0041={..._0x2bba7c,'status':_0x987803(0x1c5),'merchantPaid':![],'shop':{'gatewaySettings':_0x2bba7c[_0x987803(0x25c)][_0x987803(0x1d8)]}};if(!this[_0x987803(0x244)](_0x2e0041))continue;const _0x30162f=await currencyService_1[_0x987803(0x267)]['convertToUSDT'](_0x2bba7c[_0x987803(0x24d)],_0x2bba7c[_0x987803(0x1ef)]),_0x57944b=this[_0x987803(0x1fd)](_0x2bba7c[_0x987803(0x25c)],_0x2bba7c[_0x987803(0x1d4)]),_0x13600c=this['calculateAmountAfterCommission'](_0x30162f,_0x57944b[_0x987803(0x1f3)]);if(_0x13600c<=_0x4bd6ef){_0x246d1d[_0x987803(0x1c2)](_0x2bba7c['id']),_0x4bd6ef-=_0x13600c;if(_0x4bd6ef<=0.01)break;}}_0x246d1d[_0x987803(0x22f)]>0x0&&(await database_1[_0x987803(0x1db)][_0x987803(0x206)]['updateMany']({'where':{'id':{'in':_0x246d1d}},'data':{'merchantPaid':!![]}}),console[_0x987803(0x213)](_0x987803(0x27b)+_0x246d1d['length']+_0x987803(0x279)));}async['getAllPayouts'](_0x2c9b5f){const _0x3c9ecd=a33_0x1aea9a,{page:_0x412e23,limit:_0x1c504c,shopId:_0x102cca,network:_0xd875f,dateFrom:_0x5d7218,dateTo:_0x1a78ee,search:_0x5ba454}=_0x2c9b5f,_0x549d46=(_0x412e23-0x1)*_0x1c504c;console['log'](_0x3c9ecd(0x23b),_0x2c9b5f);const _0x4448ba={};_0x102cca&&(_0x4448ba[_0x3c9ecd(0x1e8)]=_0x102cca);_0xd875f&&(_0x4448ba[_0x3c9ecd(0x1f0)]=_0xd875f);(_0x5d7218||_0x1a78ee)&&(_0x4448ba['createdAt']={},_0x5d7218&&(_0x4448ba[_0x3c9ecd(0x26f)][_0x3c9ecd(0x22b)]=new Date(_0x5d7218)),_0x1a78ee&&(_0x4448ba[_0x3c9ecd(0x26f)][_0x3c9ecd(0x257)]=new Date(_0x1a78ee)));_0x5ba454&&(_0x4448ba['OR']=[{'txid':{'contains':_0x5ba454,'mode':_0x3c9ecd(0x20d)}},{'notes':{'contains':_0x5ba454,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x5ba454,'mode':_0x3c9ecd(0x20d)}}},{'shop':{'username':{'contains':_0x5ba454,'mode':'insensitive'}}}]);const [_0x122575,_0x4bda4a]=await Promise['all']([database_1[_0x3c9ecd(0x1db)]['payout']['findMany']({'where':_0x4448ba,'skip':_0x549d46,'take':_0x1c504c,'orderBy':{'createdAt':_0x3c9ecd(0x226)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3c9ecd(0x1db)]['payout']['count']({'where':_0x4448ba})]);console[_0x3c9ecd(0x213)](_0x3c9ecd(0x1d1)+_0x122575[_0x3c9ecd(0x22f)]+_0x3c9ecd(0x219)+_0x4bda4a+_0x3c9ecd(0x288));const _0xe4e086=_0x122575[_0x3c9ecd(0x26d)](_0xe111ff=>({'id':_0xe111ff['id'],'shopId':_0xe111ff[_0x3c9ecd(0x1e8)],'shopName':_0xe111ff[_0x3c9ecd(0x25c)][_0x3c9ecd(0x1f9)],'shopUsername':_0xe111ff['shop'][_0x3c9ecd(0x1c9)],'amount':_0xe111ff['amount'],'network':_0xe111ff['network'],'status':_0xe111ff['status'],'txid':_0xe111ff['txid'],'notes':_0xe111ff['notes'],'createdAt':_0xe111ff[_0x3c9ecd(0x26f)],'paidAt':_0xe111ff[_0x3c9ecd(0x229)]}));return{'payouts':_0xe4e086,'pagination':{'page':_0x412e23,'limit':_0x1c504c,'total':_0x4bda4a,'totalPages':Math[_0x3c9ecd(0x28c)](_0x4bda4a/_0x1c504c)}};}async[a33_0x1aea9a(0x1be)](_0x1560e5){const _0x455223=a33_0x1aea9a;console['log'](_0x455223(0x251)+_0x1560e5);const _0x2b1ddb=await database_1['default']['payout'][_0x455223(0x1bf)]({'where':{'id':_0x1560e5},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2b1ddb)return console[_0x455223(0x213)](_0x455223(0x1c7)+_0x1560e5),null;return console[_0x455223(0x213)](_0x455223(0x295)+_0x2b1ddb['amount']+'\x20USDT\x20via\x20'+_0x2b1ddb['network']),{'id':_0x2b1ddb['id'],'shopId':_0x2b1ddb[_0x455223(0x1e8)],'shopName':_0x2b1ddb[_0x455223(0x25c)][_0x455223(0x1f9)],'shopUsername':_0x2b1ddb[_0x455223(0x25c)]['username'],'amount':_0x2b1ddb[_0x455223(0x24d)],'network':_0x2b1ddb[_0x455223(0x1f0)],'status':_0x2b1ddb[_0x455223(0x1c1)],'txid':_0x2b1ddb[_0x455223(0x1ce)],'notes':_0x2b1ddb[_0x455223(0x24b)],'createdAt':_0x2b1ddb[_0x455223(0x26f)],'paidAt':_0x2b1ddb[_0x455223(0x229)]};}async['deletePayout'](_0x18e392){const _0x17a326=a33_0x1aea9a;console[_0x17a326(0x213)](_0x17a326(0x1d7)+_0x18e392);const _0x59e417=await database_1['default'][_0x17a326(0x28a)][_0x17a326(0x1bf)]({'where':{'id':_0x18e392},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x59e417)throw new Error(_0x17a326(0x1eb));await database_1['default']['payout'][_0x17a326(0x256)]({'where':{'id':_0x18e392}}),console[_0x17a326(0x213)](_0x17a326(0x28e)+_0x18e392+_0x17a326(0x285));}async[a33_0x1aea9a(0x1e6)](_0x2699e3){const _0x33fd8f=a33_0x1aea9a,{page:_0x4f5eee,limit:_0x34dc46,minAmount:_0x267920,search:_0x6e03e9}=_0x2699e3;console[_0x33fd8f(0x213)](_0x33fd8f(0x1d2),_0x2699e3);const _0x24541b=await database_1[_0x33fd8f(0x1db)][_0x33fd8f(0x206)][_0x33fd8f(0x23e)]({'where':{'status':_0x33fd8f(0x1c5),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x33fd8f(0x213)](_0x33fd8f(0x1e1)+_0x24541b[_0x33fd8f(0x22f)]+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x56add5=new Map();for(const _0x49a11d of _0x24541b){const _0x3a9641={..._0x49a11d,'status':_0x33fd8f(0x1c5),'merchantPaid':![],'shop':{'gatewaySettings':_0x49a11d[_0x33fd8f(0x25c)][_0x33fd8f(0x1d8)]}},_0x336c93=this[_0x33fd8f(0x244)](_0x3a9641);if(!_0x336c93)continue;const _0x38035d=await currencyService_1['currencyService'][_0x33fd8f(0x1d5)](_0x49a11d['amount'],_0x49a11d[_0x33fd8f(0x1ef)]),_0x4c3ea1=this[_0x33fd8f(0x1fd)](_0x49a11d['shop'],_0x49a11d[_0x33fd8f(0x1d4)]),_0x476928=this['calculateAmountAfterCommission'](_0x38035d,_0x4c3ea1[_0x33fd8f(0x1f3)]),_0x4440ea=_0x49a11d[_0x33fd8f(0x1e8)];!_0x56add5['has'](_0x4440ea)&&_0x56add5['set'](_0x4440ea,{'shop':_0x49a11d[_0x33fd8f(0x25c)],'payments':[]}),_0x56add5[_0x33fd8f(0x27e)](_0x4440ea)['payments'][_0x33fd8f(0x1c2)]({'id':_0x49a11d['id'],'amount':_0x49a11d['amount'],'currency':_0x49a11d[_0x33fd8f(0x1ef)],'gateway':_0x49a11d[_0x33fd8f(0x1d4)],'paidAt':_0x49a11d[_0x33fd8f(0x229)],'createdAt':_0x49a11d[_0x33fd8f(0x26f)],'amountUSDT':_0x38035d,'commission':_0x4c3ea1['commission'],'amountAfterCommissionUSDT':_0x476928,'isEligible':!![]});}console[_0x33fd8f(0x213)](_0x33fd8f(0x1ed)+_0x56add5['size']+_0x33fd8f(0x208));const _0xba7eac=[];for(const [_0x13e596,_0xd7e9e9]of _0x56add5){const {shop:_0x3ae5f9,payments:_0x5ac184}=_0xd7e9e9,_0xeabea0=_0x5ac184['reduce']((_0x233322,_0x4d2c42)=>_0x233322+_0x4d2c42['amountUSDT'],0x0),_0x2c5d41=_0x5ac184[_0x33fd8f(0x1e7)]((_0x1ce97a,_0x4bb43e)=>_0x1ce97a+_0x4bb43e[_0x33fd8f(0x1fa)],0x0);if(_0x267920&&_0x2c5d41<_0x267920)continue;if(_0x6e03e9){const _0x30063=_0x6e03e9[_0x33fd8f(0x28f)](),_0x2f24a7=_0x3ae5f9[_0x33fd8f(0x1f9)][_0x33fd8f(0x28f)]()[_0x33fd8f(0x1f2)](_0x30063)||_0x3ae5f9['username'][_0x33fd8f(0x28f)]()[_0x33fd8f(0x1f2)](_0x30063)||_0x3ae5f9[_0x33fd8f(0x211)]&&_0x3ae5f9[_0x33fd8f(0x211)]['toLowerCase']()[_0x33fd8f(0x1f2)](_0x30063);if(!_0x2f24a7)continue;}const _0xa54fe=new Map();for(const _0x1088f4 of _0x5ac184){const _0xbec548=_0x1088f4[_0x33fd8f(0x1d4)];!_0xa54fe['has'](_0xbec548)&&_0xa54fe['set'](_0xbec548,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x1088f4[_0x33fd8f(0x1f3)]});const _0x1ece11=_0xa54fe['get'](_0xbec548);_0x1ece11['count']++,_0x1ece11[_0x33fd8f(0x1e5)]+=_0x1088f4[_0x33fd8f(0x1e5)],_0x1ece11[_0x33fd8f(0x1fa)]+=_0x1088f4[_0x33fd8f(0x1fa)];}const _0x385ff8=Array[_0x33fd8f(0x1d6)](_0xa54fe['entries']())[_0x33fd8f(0x26d)](([_0x27ac41,_0x27def0])=>({'gateway':_0x27ac41[_0x33fd8f(0x24e)](0x0)[_0x33fd8f(0x255)]()+_0x27ac41['slice'](0x1),'count':_0x27def0[_0x33fd8f(0x224)],'amountUSDT':Math['round'](_0x27def0[_0x33fd8f(0x1e5)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x33fd8f(0x1f6)](_0x27def0[_0x33fd8f(0x1fa)]*0x64)/0x64,'commission':_0x27def0[_0x33fd8f(0x1f3)]})),_0x27e2d7=_0x5ac184[_0x33fd8f(0x1e7)]((_0xe1adc,_0x1f629b)=>{const _0x18a18b=_0x33fd8f;return _0x1f629b[_0x18a18b(0x229)]<_0xe1adc?_0x1f629b[_0x18a18b(0x229)]:_0xe1adc;},_0x5ac184[0x0][_0x33fd8f(0x229)]);_0xba7eac[_0x33fd8f(0x1c2)]({'id':_0x3ae5f9['id'],'fullName':_0x3ae5f9[_0x33fd8f(0x1f9)],'username':_0x3ae5f9[_0x33fd8f(0x1c9)],'telegramId':_0x3ae5f9['telegram'],'merchantUrl':_0x3ae5f9[_0x33fd8f(0x241)],'wallets':{'usdtPolygonWallet':_0x3ae5f9[_0x33fd8f(0x21e)],'usdtTrcWallet':_0x3ae5f9['usdtTrcWallet'],'usdtErcWallet':_0x3ae5f9[_0x33fd8f(0x1c4)],'usdcPolygonWallet':_0x3ae5f9[_0x33fd8f(0x238)]},'totalAmountUSDT':Math[_0x33fd8f(0x1f6)](_0xeabea0*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x33fd8f(0x1f6)](_0x2c5d41*0x64)/0x64,'paymentsCount':_0x5ac184[_0x33fd8f(0x22f)],'oldestPaymentDate':_0x27e2d7,'gatewayBreakdown':_0x385ff8});}_0xba7eac[_0x33fd8f(0x25d)]((_0x326066,_0x34592b)=>_0x34592b[_0x33fd8f(0x21a)]-_0x326066[_0x33fd8f(0x21a)]);const _0x17ef64=_0xba7eac[_0x33fd8f(0x22f)],_0x2c28e1=_0xba7eac[_0x33fd8f(0x1e7)]((_0x6688de,_0x4a0428)=>_0x6688de+_0x4a0428[_0x33fd8f(0x237)],0x0),_0x2c2b07=_0xba7eac[_0x33fd8f(0x1e7)]((_0x5115d0,_0x125714)=>_0x5115d0+_0x125714[_0x33fd8f(0x21a)],0x0),_0x148442=(_0x4f5eee-0x1)*_0x34dc46,_0x2502bb=_0xba7eac[_0x33fd8f(0x258)](_0x148442,_0x148442+_0x34dc46);return console[_0x33fd8f(0x213)]('‚úÖ\x20Returning\x20'+_0x2502bb['length']+_0x33fd8f(0x280)+_0x17ef64+'\x20total'),console[_0x33fd8f(0x213)]('üí∞\x20Total\x20amount:\x20'+_0x2c28e1['toFixed'](0x2)+_0x33fd8f(0x27a)+_0x2c2b07[_0x33fd8f(0x1cf)](0x2)+_0x33fd8f(0x259)),{'merchants':_0x2502bb,'pagination':{'page':_0x4f5eee,'limit':_0x34dc46,'total':_0x17ef64,'totalPages':Math['ceil'](_0x17ef64/_0x34dc46)},'summary':{'totalMerchants':_0x17ef64,'totalAmountUSDT':Math[_0x33fd8f(0x1f6)](_0x2c28e1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x2c2b07*0x64)/0x64}};}async[a33_0x1aea9a(0x23a)](){const _0x4189c9=a33_0x1aea9a;console[_0x4189c9(0x213)]('üìä\x20Calculating\x20admin\x20payout\x20statistics...');const _0x5ea823=await database_1[_0x4189c9(0x1db)]['payment'][_0x4189c9(0x23e)]({'where':{'status':{'in':[_0x4189c9(0x1c5),_0x4189c9(0x205),_0x4189c9(0x260)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log'](_0x4189c9(0x1e1)+_0x5ea823[_0x4189c9(0x22f)]+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x230516=new Date(),_0x1a5f48=new Date(_0x230516[_0x4189c9(0x1e2)](),_0x230516['getMonth'](),0x1),_0x4586b3=new Date(_0x230516[_0x4189c9(0x1e2)](),_0x230516['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x57b36a=0x0,_0x257071=0x0,_0xf2918e=0x0,_0x38864e=0x0;for(const _0xbf3bb1 of _0x5ea823){const _0xf1ff17=this[_0x4189c9(0x225)](_0xbf3bb1);if(_0xf1ff17===0x0)continue;let _0x15e1a3,_0x4cda5a;if(_0xbf3bb1[_0x4189c9(0x1c1)]===_0x4189c9(0x260))_0x15e1a3=Math['abs'](_0xf1ff17),_0x4cda5a=-_0x15e1a3;else{_0x15e1a3=await currencyService_1[_0x4189c9(0x267)][_0x4189c9(0x1d5)](_0xbf3bb1[_0x4189c9(0x24d)],_0xbf3bb1['currency']);const _0x66a76d=this[_0x4189c9(0x1fd)](_0xbf3bb1['shop'],_0xbf3bb1[_0x4189c9(0x1d4)]);_0x4cda5a=this['calculateAmountAfterCommission'](_0x15e1a3,_0x66a76d[_0x4189c9(0x1f3)]);}_0xbf3bb1['merchantPaid']&&(_0x57b36a+=_0x4cda5a,_0xbf3bb1[_0x4189c9(0x229)]&&_0xbf3bb1[_0x4189c9(0x229)]>=_0x1a5f48&&_0xbf3bb1[_0x4189c9(0x229)]<=_0x4586b3&&(_0xf2918e+=_0x4cda5a)),_0xbf3bb1[_0x4189c9(0x1c1)]===_0x4189c9(0x1c5)&&this[_0x4189c9(0x244)](_0xbf3bb1)&&(_0x257071+=_0x4cda5a,_0x38864e+=_0x15e1a3);}const _0x2b6813={'totalPayout':Math[_0x4189c9(0x1f6)](_0x57b36a*0x64)/0x64,'awaitingPayout':Math['round'](_0x257071*0x64)/0x64,'thisMonth':Math['round'](_0xf2918e*0x64)/0x64,'availableBalance':Math[_0x4189c9(0x1f6)](_0x38864e*0x64)/0x64};return console[_0x4189c9(0x213)](_0x4189c9(0x215)),console[_0x4189c9(0x213)](_0x4189c9(0x273)+_0x2b6813['totalPayout']+_0x4189c9(0x1fe)),console[_0x4189c9(0x213)]('‚è≥\x20Awaiting\x20Payout:\x20'+_0x2b6813[_0x4189c9(0x264)]+'\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)'),console['log'](_0x4189c9(0x1fc)+_0x2b6813['thisMonth']+_0x4189c9(0x20c)),console[_0x4189c9(0x213)](_0x4189c9(0x204)+_0x2b6813['availableBalance']+'\x20USDT'),_0x2b6813;}async[a33_0x1aea9a(0x277)](_0x2c2392){const _0x2bb490=a33_0x1aea9a,_0x57caea=this[_0x2bb490(0x282)](_0x2c2392),_0x4c6ed7=new Date();_0x4c6ed7[_0x2bb490(0x1df)](_0x4c6ed7[_0x2bb490(0x217)]()-_0x57caea),console[_0x2bb490(0x213)](_0x2bb490(0x275)+_0x2c2392+'\x20('+_0x57caea+_0x2bb490(0x216));const _0x251231=await database_1['default']['shop'][_0x2bb490(0x224)]({'where':{'status':_0x2bb490(0x231)}}),_0x198416=await database_1[_0x2bb490(0x1db)][_0x2bb490(0x206)][_0x2bb490(0x224)](),_0x58af71=await database_1['default'][_0x2bb490(0x206)]['findMany']({'where':{'status':{'in':[_0x2bb490(0x1c5),'REFUND',_0x2bb490(0x260)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console['log']('üí∞\x20Found\x20'+_0x58af71['length']+_0x2bb490(0x203));const _0x47895e=await Promise['all'](_0x58af71[_0x2bb490(0x26d)](async _0x267d06=>{const _0x385335=_0x2bb490,_0x3a3d8a=this[_0x385335(0x225)](_0x267d06);if(_0x3a3d8a===0x0)return{'amount':0x0,'createdAt':_0x267d06['createdAt']};let _0x9de983;return _0x267d06[_0x385335(0x1c1)]==='CHARGEBACK'?_0x9de983=-Math[_0x385335(0x202)](_0x3a3d8a):_0x9de983=await currencyService_1[_0x385335(0x267)][_0x385335(0x1d5)](_0x267d06['amount'],_0x267d06[_0x385335(0x1ef)]),{'amount':_0x9de983,'createdAt':_0x267d06[_0x385335(0x26f)]};})),_0x5eebdc=_0x47895e[_0x2bb490(0x1e7)]((_0x124a87,_0xf84419)=>_0x124a87+_0xf84419[_0x2bb490(0x24d)],0x0),_0x36b14a=_0x198416>0x0?_0x5eebdc/_0x198416:0x0;console[_0x2bb490(0x213)](_0x2bb490(0x21f)+_0x5eebdc[_0x2bb490(0x1cf)](0x2)+_0x2bb490(0x1fe)),console[_0x2bb490(0x213)]('üìà\x20Average\x20payment:\x20'+_0x36b14a[_0x2bb490(0x1cf)](0x2)+_0x2bb490(0x20c));const _0x27ed79=await database_1[_0x2bb490(0x1db)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x4c6ed7}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x2bb490(0x213)](_0x2bb490(0x20e)+_0x27ed79[_0x2bb490(0x22f)]+_0x2bb490(0x25e));const _0x50e55e=await Promise[_0x2bb490(0x1ee)](_0x27ed79['map'](async _0x2daa2e=>{const _0x5c3cc0=_0x2bb490,_0x1fa1a0=await Promise[_0x5c3cc0(0x1ee)](_0x2daa2e[_0x5c3cc0(0x248)][_0x5c3cc0(0x26d)](async _0x57ae32=>{const _0x46d760=_0x5c3cc0,_0x45678c=this[_0x46d760(0x225)](_0x57ae32);if(_0x45678c===0x0)return 0x0;return _0x57ae32['status']===_0x46d760(0x260)?-Math[_0x46d760(0x202)](_0x45678c):await currencyService_1[_0x46d760(0x267)]['convertToUSDT'](_0x57ae32[_0x46d760(0x24d)],_0x57ae32[_0x46d760(0x1ef)]);})),_0x49d07c=_0x1fa1a0[_0x5c3cc0(0x1e7)]((_0x1efd10,_0x13f4b4)=>_0x1efd10+_0x13f4b4,0x0);return{'date':_0x2daa2e['date'][_0x5c3cc0(0x1d9)]()[_0x5c3cc0(0x245)]('T')[0x0],'amount':_0x49d07c};})),_0x35c0af=this['generateDateRange'](_0x4c6ed7,new Date()),_0x2257c9=new Map(_0x50e55e['map'](_0x35dd6e=>[_0x35dd6e[_0x2bb490(0x28d)],_0x35dd6e[_0x2bb490(0x24d)]])),_0x111730=_0x35c0af['map'](_0x437cef=>({'date':_0x437cef,'amount':_0x2257c9[_0x2bb490(0x27e)](_0x437cef)||0x0}));return console['log'](_0x2bb490(0x1e0)),console[_0x2bb490(0x213)](_0x2bb490(0x1de)+_0x251231),console[_0x2bb490(0x213)]('üí≥\x20Total\x20payments:\x20'+_0x198416),console[_0x2bb490(0x213)]('üìä\x20Daily\x20revenue\x20entries:\x20'+_0x111730[_0x2bb490(0x22f)]),{'totalRevenue':Math[_0x2bb490(0x1f6)](_0x5eebdc*0x64)/0x64,'totalUsers':_0x251231,'totalPayments':_0x198416,'averagePayment':Math['round'](_0x36b14a*0x64)/0x64,'dailyRevenue':_0x111730};}async['getAllPayments'](_0x5afd27){const _0x346dc8=a33_0x1aea9a,{page:_0x14cbc5,limit:_0x311e02,status:_0x2c358a,gateway:_0x33e495,shopId:_0xa91360,dateFrom:_0x345f78,dateTo:_0x57f332,search:_0x228681}=_0x5afd27,_0x1d15af=(_0x14cbc5-0x1)*_0x311e02;console[_0x346dc8(0x213)](_0x346dc8(0x239),_0x5afd27);const _0x291e43={};_0x2c358a&&(_0x291e43['status']=_0x2c358a[_0x346dc8(0x255)]());if(_0x33e495){if((0x0,gateway_1[_0x346dc8(0x1ff)])(_0x33e495)){const _0x27f3d9=(0x0,gateway_1[_0x346dc8(0x290)])(_0x33e495);_0x27f3d9&&(_0x291e43['gateway']=_0x27f3d9);}else _0x291e43[_0x346dc8(0x1d4)]=_0x33e495['toLowerCase']();}_0xa91360&&(_0x291e43[_0x346dc8(0x1e8)]=_0xa91360);(_0x345f78||_0x57f332)&&(_0x291e43['createdAt']={},_0x345f78&&(_0x291e43['createdAt'][_0x346dc8(0x22b)]=new Date(_0x345f78)),_0x57f332&&(_0x291e43['createdAt'][_0x346dc8(0x257)]=new Date(_0x57f332)));_0x228681&&(_0x291e43['OR']=[{'orderId':{'contains':_0x228681,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x228681,'mode':_0x346dc8(0x20d)}},{'gatewayPaymentId':{'contains':_0x228681,'mode':_0x346dc8(0x20d)}},{'customerEmail':{'contains':_0x228681,'mode':'insensitive'}},{'customerName':{'contains':_0x228681,'mode':_0x346dc8(0x20d)}},{'shop':{'name':{'contains':_0x228681,'mode':_0x346dc8(0x20d)}}},{'shop':{'username':{'contains':_0x228681,'mode':_0x346dc8(0x20d)}}}]);const [_0x41c1b8,_0x5901f1]=await Promise['all']([database_1[_0x346dc8(0x1db)]['payment'][_0x346dc8(0x23e)]({'where':_0x291e43,'skip':_0x1d15af,'take':_0x311e02,'orderBy':{'createdAt':_0x346dc8(0x226)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x346dc8(0x1db)]['payment']['count']({'where':_0x291e43})]);console[_0x346dc8(0x213)](_0x346dc8(0x1d1)+_0x41c1b8['length']+_0x346dc8(0x1da)+_0x5901f1+_0x346dc8(0x288));const _0x1a9dec=_0x41c1b8[_0x346dc8(0x26d)](_0x3ad85e=>({'id':_0x3ad85e['id'],'shopId':_0x3ad85e[_0x346dc8(0x1e8)],'shopName':_0x3ad85e['shop'][_0x346dc8(0x1f9)],'shopUsername':_0x3ad85e[_0x346dc8(0x25c)][_0x346dc8(0x1c9)],'gateway':_0x3ad85e[_0x346dc8(0x1d4)],'orderId':_0x3ad85e[_0x346dc8(0x1f4)],'gatewayOrderId':_0x3ad85e[_0x346dc8(0x287)],'amount':_0x3ad85e[_0x346dc8(0x24d)],'currency':_0x3ad85e[_0x346dc8(0x1ef)],'sourceCurrency':_0x3ad85e[_0x346dc8(0x249)],'status':_0x3ad85e[_0x346dc8(0x1c1)],'usage':_0x3ad85e[_0x346dc8(0x243)],'externalPaymentUrl':_0x3ad85e[_0x346dc8(0x289)],'gatewayPaymentId':_0x3ad85e[_0x346dc8(0x227)],'customerEmail':_0x3ad85e[_0x346dc8(0x240)],'customerName':_0x3ad85e[_0x346dc8(0x1ec)],'cardLast4':_0x3ad85e['cardLast4'],'paymentMethod':_0x3ad85e['paymentMethod'],'bankId':_0x3ad85e[_0x346dc8(0x201)],'remitterIban':_0x3ad85e[_0x346dc8(0x1dc)],'remitterName':_0x3ad85e[_0x346dc8(0x25f)],'chargebackAmount':_0x3ad85e['chargebackAmount'],'adminNotes':_0x3ad85e[_0x346dc8(0x1cd)],'statusChangedBy':_0x3ad85e[_0x346dc8(0x1d0)],'statusChangedAt':_0x3ad85e['statusChangedAt'],'createdAt':_0x3ad85e[_0x346dc8(0x26f)],'updatedAt':_0x3ad85e['updatedAt'],'expiresAt':_0x3ad85e[_0x346dc8(0x234)]}));return{'payments':_0x1a9dec,'pagination':{'page':_0x14cbc5,'limit':_0x311e02,'total':_0x5901f1,'totalPages':Math[_0x346dc8(0x28c)](_0x5901f1/_0x311e02)}};}async[a33_0x1aea9a(0x212)](_0x570c2c){const _0x59c031=a33_0x1aea9a;console[_0x59c031(0x213)](_0x59c031(0x1e3)+_0x570c2c);const _0x3d60fa=await database_1['default'][_0x59c031(0x206)][_0x59c031(0x1bf)]({'where':{'id':_0x570c2c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x59c031(0x226)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x3d60fa)return console[_0x59c031(0x213)](_0x59c031(0x1f8)+_0x570c2c),null;return console['log']('‚úÖ\x20Found\x20payment:\x20'+_0x3d60fa[_0x59c031(0x1f4)]+'\x20('+_0x3d60fa[_0x59c031(0x1c1)]+')'),{'id':_0x3d60fa['id'],'shopId':_0x3d60fa[_0x59c031(0x1e8)],'shopName':_0x3d60fa[_0x59c031(0x25c)]['name'],'shopUsername':_0x3d60fa[_0x59c031(0x25c)][_0x59c031(0x1c9)],'gateway':_0x3d60fa[_0x59c031(0x1d4)],'orderId':_0x3d60fa[_0x59c031(0x1f4)],'gatewayOrderId':_0x3d60fa[_0x59c031(0x287)],'amount':_0x3d60fa[_0x59c031(0x24d)],'currency':_0x3d60fa[_0x59c031(0x1ef)],'sourceCurrency':_0x3d60fa['sourceCurrency'],'status':_0x3d60fa[_0x59c031(0x1c1)],'usage':_0x3d60fa[_0x59c031(0x243)],'externalPaymentUrl':_0x3d60fa['externalPaymentUrl'],'gatewayPaymentId':_0x3d60fa['gatewayPaymentId'],'customerEmail':_0x3d60fa[_0x59c031(0x240)],'customerName':_0x3d60fa[_0x59c031(0x1ec)],'cardLast4':_0x3d60fa[_0x59c031(0x268)],'paymentMethod':_0x3d60fa['paymentMethod'],'bankId':_0x3d60fa[_0x59c031(0x201)],'remitterIban':_0x3d60fa[_0x59c031(0x1dc)],'remitterName':_0x3d60fa['remitterName'],'chargebackAmount':_0x3d60fa[_0x59c031(0x254)],'adminNotes':_0x3d60fa[_0x59c031(0x1cd)],'statusChangedBy':_0x3d60fa[_0x59c031(0x1d0)],'statusChangedAt':_0x3d60fa[_0x59c031(0x266)],'createdAt':_0x3d60fa['createdAt'],'updatedAt':_0x3d60fa[_0x59c031(0x21c)],'expiresAt':_0x3d60fa[_0x59c031(0x234)],'webhookLogs':_0x3d60fa[_0x59c031(0x1ea)]};}async[a33_0x1aea9a(0x26e)](_0x564ac9,_0x968423,_0x268f1f,_0x1eba97){const _0x10fc09=a33_0x1aea9a;console[_0x10fc09(0x213)](_0x10fc09(0x292)+_0x564ac9+_0x10fc09(0x253)+_0x968423);const _0x46e2ac=[_0x10fc09(0x293),_0x10fc09(0x1c5),_0x10fc09(0x271),'FAILED',_0x10fc09(0x205),'CHARGEBACK'];if(!_0x46e2ac[_0x10fc09(0x1f2)](_0x968423[_0x10fc09(0x255)]()))throw new Error(_0x10fc09(0x26c)+_0x46e2ac['join'](',\x20'));const _0x4ae42e=await database_1[_0x10fc09(0x1db)]['payment'][_0x10fc09(0x1bf)]({'where':{'id':_0x564ac9},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x4ae42e)throw new Error(_0x10fc09(0x235));if(_0x968423[_0x10fc09(0x255)]()===_0x10fc09(0x260)){if(!_0x1eba97||_0x1eba97<=0x0)throw new Error(_0x10fc09(0x25b));console[_0x10fc09(0x213)](_0x10fc09(0x263)+_0x1eba97+'\x20USDT\x20(penalty\x20amount)');}const _0x2a46e5={'status':_0x968423['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x268f1f&&(_0x2a46e5['adminNotes']=_0x268f1f);_0x968423[_0x10fc09(0x255)]()===_0x10fc09(0x260)&&_0x1eba97&&(_0x2a46e5[_0x10fc09(0x254)]=_0x1eba97);const _0x1c5b45=await database_1[_0x10fc09(0x1db)][_0x10fc09(0x206)][_0x10fc09(0x200)]({'where':{'id':_0x564ac9},'data':_0x2a46e5,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x10fc09(0x1db)][_0x10fc09(0x252)]['create']({'data':{'paymentId':_0x564ac9,'shopId':_0x1c5b45[_0x10fc09(0x1e8)],'event':_0x10fc09(0x26a),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x4ae42e[_0x10fc09(0x1c1)],'newStatus':_0x968423[_0x10fc09(0x255)](),'notes':_0x268f1f||null,'chargebackAmount':_0x1eba97||null,'updatedBy':_0x10fc09(0x1e4),'timestamp':new Date()['toISOString']()})}}),console[_0x10fc09(0x213)](_0x10fc09(0x1d3)+_0x4ae42e[_0x10fc09(0x1f4)]+_0x10fc09(0x283)+_0x4ae42e['status']+_0x10fc09(0x232)+_0x968423['toUpperCase']()),_0x968423[_0x10fc09(0x255)]()===_0x10fc09(0x260)&&console[_0x10fc09(0x213)]('üí∏\x20Chargeback\x20penalty:\x20'+_0x1eba97+_0x10fc09(0x22a)),{'id':_0x1c5b45['id'],'shopId':_0x1c5b45['shopId'],'shopName':_0x1c5b45[_0x10fc09(0x25c)]['name'],'shopUsername':_0x1c5b45[_0x10fc09(0x25c)]['username'],'gateway':_0x1c5b45[_0x10fc09(0x1d4)],'orderId':_0x1c5b45['orderId'],'gatewayOrderId':_0x1c5b45['gatewayOrderId'],'amount':_0x1c5b45[_0x10fc09(0x24d)],'currency':_0x1c5b45[_0x10fc09(0x1ef)],'sourceCurrency':_0x1c5b45[_0x10fc09(0x249)],'status':_0x1c5b45[_0x10fc09(0x1c1)],'usage':_0x1c5b45[_0x10fc09(0x243)],'externalPaymentUrl':_0x1c5b45[_0x10fc09(0x289)],'gatewayPaymentId':_0x1c5b45['gatewayPaymentId'],'customerEmail':_0x1c5b45[_0x10fc09(0x240)],'customerName':_0x1c5b45[_0x10fc09(0x1ec)],'cardLast4':_0x1c5b45[_0x10fc09(0x268)],'paymentMethod':_0x1c5b45[_0x10fc09(0x23c)],'bankId':_0x1c5b45[_0x10fc09(0x201)],'remitterIban':_0x1c5b45[_0x10fc09(0x1dc)],'remitterName':_0x1c5b45[_0x10fc09(0x25f)],'chargebackAmount':_0x1c5b45[_0x10fc09(0x254)],'adminNotes':_0x1c5b45[_0x10fc09(0x1cd)],'statusChangedBy':_0x1c5b45[_0x10fc09(0x1d0)],'statusChangedAt':_0x1c5b45[_0x10fc09(0x266)],'createdAt':_0x1c5b45['createdAt'],'updatedAt':_0x1c5b45[_0x10fc09(0x21c)],'expiresAt':_0x1c5b45[_0x10fc09(0x234)]};}async[a33_0x1aea9a(0x1bd)](_0x17c097){const _0x642684=a33_0x1aea9a,{page:_0x52b013,limit:_0x2d9f13,status:_0x1d9629}=_0x17c097,_0x56ec9a=(_0x52b013-0x1)*_0x2d9f13,_0xc73d36={};_0x1d9629&&(_0xc73d36['status']=_0x1d9629[_0x642684(0x255)]());console[_0x642684(0x213)](_0x642684(0x222),{'page':_0x52b013,'limit':_0x2d9f13,'status':_0x1d9629,'where':_0xc73d36});const [_0x54b9b4,_0x5b49b9]=await Promise[_0x642684(0x1ee)]([database_1[_0x642684(0x1db)]['shop'][_0x642684(0x23e)]({'where':_0xc73d36,'skip':_0x56ec9a,'take':_0x2d9f13,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x642684(0x226)}}),database_1[_0x642684(0x1db)][_0x642684(0x25c)][_0x642684(0x224)]({'where':_0xc73d36})]);console['log'](_0x642684(0x1d1)+_0x54b9b4[_0x642684(0x22f)]+_0x642684(0x210)+_0x5b49b9+'\x20total');const _0x26e759=_0x54b9b4[_0x642684(0x26d)](_0xac6ee=>({'id':_0xac6ee['id'],'fullName':_0xac6ee[_0x642684(0x1f9)],'username':_0xac6ee[_0x642684(0x1c9)],'telegramId':_0xac6ee[_0x642684(0x211)],'merchantUrl':_0xac6ee[_0x642684(0x241)],'gateways':_0xac6ee[_0x642684(0x1ca)]?JSON[_0x642684(0x230)](_0xac6ee[_0x642684(0x1ca)]):null,'gatewaySettings':_0xac6ee[_0x642684(0x1d8)]?JSON[_0x642684(0x230)](_0xac6ee['gatewaySettings']):null,'publicKey':_0xac6ee[_0x642684(0x262)],'wallets':{'usdtPolygonWallet':_0xac6ee[_0x642684(0x21e)],'usdtTrcWallet':_0xac6ee[_0x642684(0x247)],'usdtErcWallet':_0xac6ee[_0x642684(0x1c4)],'usdcPolygonWallet':_0xac6ee[_0x642684(0x238)]},'status':_0xac6ee[_0x642684(0x1c1)],'createdAt':_0xac6ee[_0x642684(0x26f)]}));return{'users':_0x26e759,'pagination':{'page':_0x52b013,'limit':_0x2d9f13,'total':_0x5b49b9,'totalPages':Math['ceil'](_0x5b49b9/_0x2d9f13)}};}async[a33_0x1aea9a(0x223)](_0xc76e02){const _0x279620=a33_0x1aea9a;return await this['userService'][_0x279620(0x223)](_0xc76e02);}async['createUser'](_0x46a7d3){const _0x52ebfc=a33_0x1aea9a;return await this[_0x52ebfc(0x1c6)][_0x52ebfc(0x221)](_0x46a7d3);}async[a33_0x1aea9a(0x220)](_0x338ccc,_0x5bda7e){const _0xcf0f=a33_0x1aea9a;return await this[_0xcf0f(0x1c6)]['updateUser'](_0x338ccc,_0x5bda7e);}async[a33_0x1aea9a(0x21b)](_0x2bf324){const _0x36300f=a33_0x1aea9a;return await this[_0x36300f(0x1c6)][_0x36300f(0x21b)](_0x2bf324);}async['suspendUser'](_0x49157a){const _0x36e019=a33_0x1aea9a;console[_0x36e019(0x213)](_0x36e019(0x22c)+_0x49157a);const _0x311f52=await database_1[_0x36e019(0x1db)][_0x36e019(0x25c)]['findUnique']({'where':{'id':_0x49157a},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x311f52)throw new Error('User\x20not\x20found');if(_0x311f52[_0x36e019(0x1c1)]==='SUSPENDED')throw new Error(_0x36e019(0x242));const _0x586b61=await this[_0x36e019(0x1c6)][_0x36e019(0x220)](_0x49157a,{'status':_0x36e019(0x209)});return console['log']('‚úÖ\x20User\x20'+_0x311f52['username']+'\x20suspended\x20successfully'),_0x586b61;}async[a33_0x1aea9a(0x28b)](_0x32ca21){const _0x3492b4=a33_0x1aea9a;console[_0x3492b4(0x213)](_0x3492b4(0x278)+_0x32ca21);const _0x367d6c=await database_1[_0x3492b4(0x1db)]['shop'][_0x3492b4(0x1bf)]({'where':{'id':_0x32ca21},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x367d6c)throw new Error(_0x3492b4(0x284));if(_0x367d6c[_0x3492b4(0x1c1)]===_0x3492b4(0x231))throw new Error(_0x3492b4(0x291));const _0x444671=await this['userService']['updateUser'](_0x32ca21,{'status':_0x3492b4(0x231)});return console[_0x3492b4(0x213)](_0x3492b4(0x269)+_0x367d6c[_0x3492b4(0x1c9)]+_0x3492b4(0x1e9)),_0x444671;}}exports[a33_0x1aea9a(0x1f5)]=AdminService;