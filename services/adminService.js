'use strict';const a40_0x2e7599=a40_0x3cf5;(function(_0x57dbad,_0x2d5653){const _0x212759=a40_0x3cf5,_0x3469d1=_0x57dbad();while(!![]){try{const _0x475946=-parseInt(_0x212759(0xcb))/0x1*(parseInt(_0x212759(0x150))/0x2)+parseInt(_0x212759(0x119))/0x3+-parseInt(_0x212759(0xf9))/0x4*(parseInt(_0x212759(0x156))/0x5)+-parseInt(_0x212759(0x1b2))/0x6+parseInt(_0x212759(0x179))/0x7*(-parseInt(_0x212759(0x10b))/0x8)+parseInt(_0x212759(0x1e9))/0x9+parseInt(_0x212759(0x1fc))/0xa*(parseInt(_0x212759(0x15b))/0xb);if(_0x475946===_0x2d5653)break;else _0x3469d1['push'](_0x3469d1['shift']());}catch(_0x3bfbaa){_0x3469d1['push'](_0x3469d1['shift']());}}}(a40_0x802f,0x8df0c));function a40_0x802f(){const _0x4ed9dc=['\x20to\x20','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','🔍\x20Balance\x20check\x20details:','reduce','187210jMvTzT','🎯\x20[',':\x20commission\x20=\x20','update','gte','dateTo','random','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','🔍\x20Using\x20gateway\x20\x27','warn','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','currency','dateFrom','\x20\x20\x20Current\x20balance:\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','week','\x20status:\x20','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','some','\x20in\x20','\x27\x20(from\x20\x27','createPayout','💳\x20Payout\x20wallet\x20for\x20','password','usdtTrcWallet','payment','hash','getPayoutById','whiteUrl','klyme_gb','📊\x20Final\x20WHERE\x20conditions:','📊\x20Available\x20gateways\x20in\x20database:','thisMonth','setHours','hex','yesterday','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','📋\x20Found\x20','failUrl','admin','month','\x20for\x20shop\x20','\x20\x20\x20🤔\x20Difference:\x20','__esModule','KLYME\x20DE','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','getUserById','aggregate','1CvYkJf','periodTo','customerName','⚠️\x20Payment\x20','\x20became\x20PAID:','custom','Username\x20already\x20exists','mastercard','💰\x20Current\x20shop\x20balance:\x20','updateCustomerData','toString','turnoverUSDT',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','⚠️\x20Gateway\x20\x27','includes','not\x20set','deleteUser','\x20USDT\x20(already\x20paid\x20out)','Open\x20Banking\x202','toLowerCase','chargebackAmount','\x27\x20->\x20name\x20\x27','customerEmail','MasterCard','sort','totalTurnover','./currencyService','merchantEarnings','💰\x20[PAYOUT]\x20Gateway\x20','toUpperCase','getPayoutStats','merchantEarningsUSDT','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','getGatewayInternalName','🔄\x20Converted\x20gateway\x20name\x20\x27','\x20USDT\x20(same\x20as\x20awaiting)',']\x20Updating\x20password\x20for\x20user\x20','amount','amountUSDT','\x20\x20\x20�📊\x20Total\x20payments:\x20','updatedAt','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','not\x20specified','\x20\x20\x20Merchant\x20gets:\x20','stringify','\x20USDT\x20(after\x20','152ndpqek','default','📅\x20Period:\x20','polygon_usdc','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','cointopay2','pk_','test_gateway','🔄\x20Gateway\x20mapping\x20(create):','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','$transaction','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','commissionUSDT','plisio','\x20USDT)','payout','\x20\x20\x20⏳\x20Pending\x20payout:\x20','232ExeNOt','🔄\x20Gateway\x20mapping\x20(get):','noda','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','customerUa','failureMessage','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20✅\x20Total\x20net\x20balances:\x20','getSystemStatistics','publicKey','pendingPayout','CHARGEBACK','\x20USDT\x20(theoretical\x20net)','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','2419797YoRtTi','customerIp','getGatewayIdByName','createdAt','Test\x20Gateway','txid','join','orderId','filter','notes','amountAfterGatewayCommissionUSDT','revenue','COMPLETED','📊\x20Gateway\x20filter\x20applied:','set','💰\x20Found\x20','\x27\x20to\x20name\x20\x27','balance','defineProperty','📊\x20Calculating\x20payout\x20statistics...','\x20\x20\x20💸\x20Total\x20payouts:\x20','paymentsCount','Insufficient\x20balance.\x20Available:\x20','\x20\x20\x20Available\x20(raw):\x20','\x20\x20\x20💵\x20Available\x20balance:\x20',',\x20successful:\x20','🔐\x20[','shopId','_count','\x20USDT,\x20Requested:\x20','\x20payments)','customerCountry','crypto','getMerchantsAwaitingPayout','paymentGateways','desc','REFUND','\x20USDT','Rapyd','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20Merchant\x20loses:\x20','status','gatewayCommissionRate','fullName','90d','insensitive','Noda','successUrl','localeCompare','\x20\x20\x20🌍\x20Country:\x20','\x20USDT\x20(gross\x20revenue)','telegram','\x20\x20\x20Gateway:\x20','totalPayments','\x20PAID\x20payments','2251562HggSnY','%\x20commission)','usdcPolygonWallet','../types/gateway','createUser','toFixed','27070sLyCQm','Payment\x20not\x20found','PAID','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','\x20\x20\x20Requested\x20(number):\x20','913YGrKLv','\x20USDT\x20from\x20balance','\x20\x20\x20Transaction\x20hash:\x20','currencyService','gatewayEarnings','\x27\x20not\x20found.\x20Available\x20gateways:\x20','getGatewayNameById','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20💰\x20Total\x20payout:\x20','all','findFirst','gatewayOrderId','gatewaySettings','amountAfterCommissionUSDT','\x20USDT\x20(current\x20balance\x20in\x20DB)','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20',',\x20userId:\x20','\x20\x20\x20Difference:\x20','💰\x20Payment\x20','trc20','getFullYear','parse','map','gateways','commission','awaitingPayout','asc','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','ceil','251398UxHuDR','✅\x20Payout\x20created:\x20','entries','min','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','PENDING','totalCommissionRate','\x20\x20\x20Available\x20(number):\x20','bcryptjs','0000','SUSPENDED','toISOString','generateDailyStatistics','klyme_de','🔄\x20Converted\x20gateway\x20ID\x20\x27','adminNotes','getGatewayDisplayName','getDate','getAllPayouts','period','forEach','🔧\x20[','log','turnover','KLYME\x20EU','getAllPayments','\x20balance\x20updated:','username','💰\x20[PAYOUT]\x20Merchant\x20','💰\x20Shop\x20','\x20\x20\x20Payout\x20amount:\x20','⚠️\x20Requested\x20gateway\x20\x27','Shop\x20not\x20found','paidAt','error','totalPaidOut','🔄\x20Admin\x20updating\x20payment\x20','\x20\x20\x20🌐\x20IP:\x20','averageCommissionRate','statusChangedBy','Telegram\x20username\x20already\x20exists','📊\x20Total\x20payments\x20(including\x20failed):\x20','ACTIVE','\x20USDT\x20(','name','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','day','split','\x20->\x20','shop','dailyRevenue','\x20\x20\x20💳\x20Total\x20payments:\x20','push','groupBy','Plisio','findUnique','merchantUrl','2308752hCpsma','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','substr','create','dailyPayments','gateway','length',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20\x20\x20Balance:\x20','periodFrom','totalPayout','📋\x20Getting\x20merchants\x20selection\x20list...','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','getMonth','getMerchantsSelection','2020-01-01','AdminService','\x20\x20\x20💰\x20Total\x20turnover:\x20','lte','\x20\x20\x20Full\x20amount:\x20','date','deletePayout','wallet',',\x20Commission:\x20','erc20','randomBytes','%\x20from\x20','_sum','📊\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20🖥️\x20User\x20Agent:\x20','setDate','cointopay','📊\x20Getting\x20payments\x20with\x20filters:','shopUrl','averageCheckUSDT','💱\x20Currency\x20filter\x20applied:\x20','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','count','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','round','sk_','updateUser','wallets','getTime','convertToUSDT',']\x20Gateway\x20settings\x20before\x20saving:','usdtPolygonWallet','\x20\x20\x20Tolerance:\x20','Error\x20processing\x20payment\x20','usdtErcWallet','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','30d','💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','8808813cdZBWr','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','network','__importDefault','findMany','polygon','values','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','✅\x20Using\x20gateway\x20filter:\x20\x27','KLYME\x20GB','updatePaymentStatus','delete','usdcErcWallet','\x20USDT,\x20merchant:\x20'];a40_0x802f=function(){return _0x4ed9dc;};return a40_0x802f();}function a40_0x3cf5(_0x502f08,_0x29cce9){const _0x802f97=a40_0x802f();return a40_0x3cf5=function(_0x3cf5e1,_0x33d1a1){_0x3cf5e1=_0x3cf5e1-0xc6;let _0x4bc15e=_0x802f97[_0x3cf5e1];return _0x4bc15e;},a40_0x3cf5(_0x502f08,_0x29cce9);}var __importDefault=this&&this[a40_0x2e7599(0x1ec)]||function(_0x26655c){const _0xd9ab58=a40_0x2e7599;return _0x26655c&&_0x26655c[_0xd9ab58(0xc6)]?_0x26655c:{'default':_0x26655c};};Object[a40_0x2e7599(0x12b)](exports,'__esModule',{'value':!![]}),exports[a40_0x2e7599(0x1c3)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a40_0x2e7599(0x181))),crypto_1=__importDefault(require(a40_0x2e7599(0x139))),currencyService_1=require(a40_0x2e7599(0xe5)),gateway_1=require(a40_0x2e7599(0x153));class AdminService{async[a40_0x2e7599(0xe9)](){const _0x3a3967=a40_0x2e7599;console['log'](_0x3a3967(0x12c));const _0x1a45e3=await database_1[_0x3a3967(0xfa)]['shop'][_0x3a3967(0xca)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3a3967(0x1a3)}}),_0x581196=await database_1['default'][_0x3a3967(0x216)][_0x3a3967(0x1d8)]({'where':{'status':_0x3a3967(0x158),'gateway':{'not':_0x3a3967(0x100)}}}),_0x187df6=new Date(),_0x2a6570=new Date(_0x187df6['getFullYear'](),_0x187df6[_0x3a3967(0x1c0)](),0x1),_0x180d56=new Date(_0x187df6['getFullYear'](),_0x187df6[_0x3a3967(0x1c0)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xfa6c38=await database_1[_0x3a3967(0xfa)][_0x3a3967(0x109)][_0x3a3967(0xca)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2a6570,'lte':_0x180d56},'status':_0x3a3967(0x125)}}),_0x501c6b=_0x1a45e3[_0x3a3967(0x1ce)][_0x3a3967(0x19c)]||0x0,_0x2e6aa7=_0x1a45e3['_sum']['balance']||0x0,_0x1e0db0=_0xfa6c38['_sum'][_0x3a3967(0xf0)]||0x0,_0x14e76b={'totalPayout':Math[_0x3a3967(0x1db)](_0x501c6b*0x64)/0x64,'awaitingPayout':Math[_0x3a3967(0x1db)](_0x2e6aa7*0x64)/0x64,'thisMonth':Math[_0x3a3967(0x1db)](_0x1e0db0*0x64)/0x64,'availableBalance':Math[_0x3a3967(0x1db)](_0x2e6aa7*0x64)/0x64,'totalPayments':_0x581196};return console[_0x3a3967(0x18f)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x3a3967(0x18f)](_0x3a3967(0x163)+_0x14e76b[_0x3a3967(0x1bc)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x3a3967(0x18f)](_0x3a3967(0x1b3)+_0x14e76b[_0x3a3967(0x174)]+_0x3a3967(0x10e)),console[_0x3a3967(0x18f)](_0x3a3967(0x131)+_0x14e76b['availableBalance']+_0x3a3967(0xee)),console[_0x3a3967(0x18f)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x14e76b[_0x3a3967(0x21d)]+_0x3a3967(0x13e)),console[_0x3a3967(0x18f)](_0x3a3967(0x1ac)+_0x14e76b['totalPayments']+_0x3a3967(0x14f)),_0x14e76b;}async[a40_0x2e7599(0xd4)](_0x1bb936,_0x513b1f){const _0x594400=a40_0x2e7599;console[_0x594400(0x18f)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x1bb936+':',_0x513b1f);const _0x1ef470=await database_1[_0x594400(0xfa)][_0x594400(0x216)][_0x594400(0x1b0)]({'where':{'id':_0x1bb936},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1ef470)throw new Error(_0x594400(0x157));const _0x313b98={};_0x513b1f[_0x594400(0x138)]!==undefined&&(_0x313b98[_0x594400(0x138)]=_0x513b1f[_0x594400(0x138)]||null);_0x513b1f[_0x594400(0x11a)]!==undefined&&(_0x313b98[_0x594400(0x11a)]=_0x513b1f[_0x594400(0x11a)]||null);_0x513b1f[_0x594400(0x10f)]!==undefined&&(_0x313b98[_0x594400(0x10f)]=_0x513b1f['customerUa']||null);const _0x35fd85=await database_1[_0x594400(0xfa)][_0x594400(0x216)][_0x594400(0x1ff)]({'where':{'id':_0x1bb936},'data':{..._0x313b98,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x594400(0x18f)](_0x594400(0x1d7)+_0x1bb936),console[_0x594400(0x18f)](_0x594400(0x14a)+_0x1ef470[_0x594400(0x138)]+_0x594400(0x1a9)+_0x35fd85[_0x594400(0x138)]),console[_0x594400(0x18f)](_0x594400(0x19e)+_0x1ef470[_0x594400(0x11a)]+_0x594400(0x1a9)+_0x35fd85['customerIp']),console['log'](_0x594400(0x1d0)+(_0x1ef470[_0x594400(0x10f)]?_0x594400(0x127):_0x594400(0xda))+'\x20->\x20'+(_0x35fd85[_0x594400(0x10f)]?_0x594400(0x127):_0x594400(0xda))),_0x35fd85;}async[a40_0x2e7599(0x113)](_0x1701a8){const _0xf7059e=a40_0x2e7599,_0x230d60=new Date();let _0x26242d;switch(_0x1701a8['toLowerCase']()){case _0xf7059e(0x1a7):_0x26242d=new Date(_0x230d60[_0xf7059e(0x16f)](),_0x230d60['getMonth'](),_0x230d60['getDate'](),0x0,0x0,0x0,0x0);break;case _0xf7059e(0x220):const _0x196578=new Date(_0x230d60);_0x196578[_0xf7059e(0x1d1)](_0x196578[_0xf7059e(0x18a)]()-0x1),_0x26242d=new Date(_0x196578[_0xf7059e(0x16f)](),_0x196578[_0xf7059e(0x1c0)](),_0x196578['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x26242d=new Date(_0x230d60[_0xf7059e(0x1df)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xf7059e(0x1e7):_0x26242d=new Date(_0x230d60[_0xf7059e(0x1df)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xf7059e(0x145):_0x26242d=new Date(_0x230d60[_0xf7059e(0x1df)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0xf7059e(0x164):const _0x532d93=await database_1['default'][_0xf7059e(0x216)][_0xf7059e(0x165)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0xf7059e(0x175)},'select':{'createdAt':!![]}});_0x26242d=_0x532d93?_0x532d93['createdAt']:new Date(_0xf7059e(0x1c2));break;default:_0x26242d=new Date(_0x230d60['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x26242d[_0xf7059e(0x21e)](0x0,0x0,0x0,0x0);let _0x5e35c4;if(_0x1701a8[_0xf7059e(0xde)]()===_0xf7059e(0x220)){const _0x326d67=new Date(_0x230d60);_0x326d67['setDate'](_0x326d67[_0xf7059e(0x18a)]()-0x1),_0x5e35c4=new Date(_0x326d67[_0xf7059e(0x16f)](),_0x326d67[_0xf7059e(0x1c0)](),_0x326d67[_0xf7059e(0x18a)](),0x17,0x3b,0x3b,0x3e7);}const _0x4ca61e={'gte':_0x26242d};_0x5e35c4&&(_0x4ca61e[_0xf7059e(0x1c5)]=_0x5e35c4);const [_0x2d151d,_0x1fa04b,_0x82a52a,_0x2588a6,_0x5aa1f6,_0xa1a6b2]=await Promise['all']([database_1['default'][_0xf7059e(0x1aa)][_0xf7059e(0x1d8)](),database_1[_0xf7059e(0xfa)][_0xf7059e(0x1aa)][_0xf7059e(0x1d8)]({'where':{'status':_0xf7059e(0x1a3)}}),database_1[_0xf7059e(0xfa)][_0xf7059e(0x216)]['count']({'where':{'status':_0xf7059e(0x158),'createdAt':_0x4ca61e,'gateway':{'not':'test_gateway'}}}),database_1[_0xf7059e(0xfa)][_0xf7059e(0x216)][_0xf7059e(0x1ed)]({'where':{'status':_0xf7059e(0x158),'createdAt':_0x4ca61e,'gateway':{'not':_0xf7059e(0x100)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0xf7059e(0xfa)][_0xf7059e(0x216)]['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0xf7059e(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0xf7059e(0x1ed)]({'where':{'createdAt':_0x4ca61e,'gateway':{'not':_0xf7059e(0x100)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x73f06b=0x0,_0x10b281=0x0;for(const _0x1611df of _0x2588a6){const _0xa4a20=await currencyService_1[_0xf7059e(0x15e)]['convertToUSDT'](_0x1611df[_0xf7059e(0xf0)],_0x1611df[_0xf7059e(0x208)]);_0x73f06b+=_0xa4a20;if(_0x1611df[_0xf7059e(0x123)]){const _0x1946cd=await currencyService_1[_0xf7059e(0x15e)]['convertToUSDT'](_0x1611df[_0xf7059e(0xf0)],_0x1611df[_0xf7059e(0x208)]),_0x59de30=_0x1611df[_0xf7059e(0x123)],_0xd4f75b=_0x1946cd-_0x59de30;_0x10b281+=_0xd4f75b;}}const _0x3469c3=_0x82a52a>0x0?_0x73f06b/_0x82a52a:0x0,_0x87ed1c=this[_0xf7059e(0x185)](_0xa1a6b2,_0x26242d,_0x5e35c4||_0x230d60),_0x107f81=await database_1[_0xf7059e(0xfa)][_0xf7059e(0x216)]['count']({'where':{'createdAt':_0x4ca61e,'gateway':{'not':_0xf7059e(0x100)}}}),_0x52798d=_0x107f81>0x0?_0x82a52a/_0x107f81*0x64:0x0;return{'totalShops':_0x2d151d,'activeShops':_0x1fa04b,'totalPayments':_0x82a52a,'successfulPayments':_0x82a52a,'totalAttempts':_0x107f81,'totalRevenue':Math[_0xf7059e(0x1db)](_0x73f06b*0x64)/0x64,'trapayEarnings':Math['round'](_0x10b281*0x64)/0x64,'averagePaymentAmount':Math[_0xf7059e(0x1db)](_0x3469c3*0x64)/0x64,'conversionRate':Math[_0xf7059e(0x1db)](_0x52798d*0x64)/0x64,'dailyRevenue':_0x87ed1c[_0xf7059e(0x1ab)],'dailyPayments':_0x87ed1c[_0xf7059e(0x1b6)],'recentPayments':_0x5aa1f6['map'](_0x2b97c2=>({'id':_0x2b97c2['id'],'amount':_0x2b97c2[_0xf7059e(0xf0)],'currency':_0x2b97c2[_0xf7059e(0x208)],'status':_0x2b97c2[_0xf7059e(0x142)],'gateway':_0x2b97c2[_0xf7059e(0x1b7)],'shop':_0x2b97c2[_0xf7059e(0x1aa)],'createdAt':_0x2b97c2[_0xf7059e(0x11c)]}))};}async['getMerchantStatistics'](_0x5b7f61){const _0x170507=a40_0x2e7599;console[_0x170507(0x18f)](_0x170507(0x140),_0x5b7f61);let _0x1ac09b,_0x248bf2=new Date();if(_0x5b7f61[_0x170507(0x18c)]===_0x170507(0xd0)&&_0x5b7f61[_0x170507(0x209)]&&_0x5b7f61['dateTo'])_0x1ac09b=new Date(_0x5b7f61[_0x170507(0x209)]),_0x248bf2=new Date(_0x5b7f61[_0x170507(0x201)]),_0x1ac09b[_0x170507(0x21e)](0x0,0x0,0x0,0x0),_0x248bf2['setHours'](0x17,0x3b,0x3b,0x3e7);else{const _0x4255c6=new Date();switch(_0x5b7f61[_0x170507(0x18c)]){case _0x170507(0x20c):_0x1ac09b=new Date(_0x4255c6[_0x170507(0x1df)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x170507(0x225):_0x1ac09b=new Date(_0x4255c6[_0x170507(0x1df)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x1ac09b=new Date(_0x4255c6[_0x170507(0x1df)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x170507(0x164):default:_0x1ac09b=new Date(_0x170507(0x1c2));break;}_0x1ac09b[_0x170507(0x21e)](0x0,0x0,0x0,0x0),_0x248bf2['setHours'](0x17,0x3b,0x3b,0x3e7);}console['log'](_0x170507(0xfb)+_0x1ac09b[_0x170507(0x184)]()+_0x170507(0x1f7)+_0x248bf2[_0x170507(0x184)]());const _0x1d8ace={'status':_0x170507(0x158),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x1ac09b,'lte':_0x248bf2}};_0x5b7f61[_0x170507(0x134)]&&(_0x1d8ace[_0x170507(0x134)]=_0x5b7f61[_0x170507(0x134)]);const _0x1ea90e=await database_1[_0x170507(0xfa)][_0x170507(0x216)][_0x170507(0x1ed)]({'where':_0x1d8ace,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x170507(0x18f)](_0x170507(0x128)+_0x1ea90e['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x3d3159={'gateway':{'not':_0x170507(0x100)},'createdAt':{'gte':_0x1ac09b,'lte':_0x248bf2}};_0x5b7f61['shopId']&&(_0x3d3159[_0x170507(0x134)]=_0x5b7f61[_0x170507(0x134)]);const _0x536e21=await database_1[_0x170507(0xfa)]['payment']['count']({'where':_0x3d3159});console[_0x170507(0x18f)](_0x170507(0x1a2)+_0x536e21+_0x170507(0x132)+_0x1ea90e[_0x170507(0x1b8)]);let _0x319930=0x0,_0x156ce9=0x0,_0x5931cc=0x0;const _0x32e028={},_0x2233e7={},_0xb6b30e={};for(const _0x2c62e8 of _0x1ea90e){try{const _0x46942c=_0x2c62e8[_0x170507(0xf1)]||0x0;if(_0x46942c<=0x0){console[_0x170507(0x205)]('⚠️\x20Payment\x20'+_0x2c62e8['id']+_0x170507(0x102));continue;}let _0x10bc39,_0x49bd9b;if(_0x2c62e8[_0x170507(0x123)]!==null&&_0x2c62e8['amountAfterGatewayCommissionUSDT']!==undefined)_0x10bc39=_0x2c62e8[_0x170507(0x123)],_0x49bd9b=_0x46942c-_0x10bc39,console[_0x170507(0x18f)]('📊\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x2c62e8['id']+':\x20'+_0x46942c[_0x170507(0x155)](0x6)+_0x170507(0x1f6)+_0x10bc39[_0x170507(0x155)](0x6)+'\x20USDT');else{let _0x1c57d1={};if(_0x2c62e8['shop']['gatewaySettings'])try{_0x1c57d1=JSON[_0x170507(0x170)](_0x2c62e8[_0x170507(0x1aa)][_0x170507(0x167)]);}catch(_0xacb989){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x2c62e8[_0x170507(0x134)]+':',_0xacb989);}let _0x560f20=0x2d;for(const [_0x5c2c25,_0x290959]of Object[_0x170507(0x17b)](_0x1c57d1)){if(_0x5c2c25[_0x170507(0xde)]()===_0x2c62e8['gateway']['toLowerCase']()){_0x560f20=_0x290959['commission']||0x2d;break;}}_0x49bd9b=_0x46942c*(_0x560f20/0x64),_0x10bc39=_0x46942c-_0x49bd9b,console[_0x170507(0x18f)]('📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x2c62e8['id']+':\x20'+_0x560f20+_0x170507(0x1cd)+_0x46942c[_0x170507(0x155)](0x6)+'\x20USDT');}_0x319930+=_0x46942c,_0x156ce9+=_0x10bc39,_0x5931cc+=_0x49bd9b;let _0x17f4a0;_0x2c62e8[_0x170507(0x143)]!==null&&_0x2c62e8[_0x170507(0x143)]!==undefined?(_0x17f4a0=_0x2c62e8['gatewayCommissionRate'],console['log'](_0x170507(0x1e6)+_0x2c62e8['id']+':\x20'+_0x17f4a0+'%')):(_0x17f4a0=_0x46942c>0x0?_0x49bd9b/_0x46942c*0x64:0x0,console[_0x170507(0x18f)](_0x170507(0xeb)+_0x2c62e8['id']+':\x20'+_0x17f4a0[_0x170507(0x155)](0x2)+'%'));!_0x32e028[_0x2c62e8[_0x170507(0x1b7)]]&&(_0x32e028[_0x2c62e8[_0x170507(0x1b7)]]={'gateway':_0x2c62e8[_0x170507(0x1b7)],'gatewayDisplayName':this[_0x170507(0x189)](_0x2c62e8[_0x170507(0x1b7)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x32e028[_0x2c62e8[_0x170507(0x1b7)]][_0x170507(0x12e)]++,_0x32e028[_0x2c62e8[_0x170507(0x1b7)]][_0x170507(0xd6)]+=_0x46942c,_0x32e028[_0x2c62e8['gateway']][_0x170507(0x106)]+=_0x49bd9b,_0x32e028[_0x2c62e8['gateway']][_0x170507(0xea)]+=_0x10bc39,_0x32e028[_0x2c62e8[_0x170507(0x1b7)]]['totalCommissionRate']+=_0x17f4a0;!_0x5b7f61[_0x170507(0x134)]&&(!_0x2233e7[_0x2c62e8[_0x170507(0x134)]]&&(_0x2233e7[_0x2c62e8['shopId']]={'shopId':_0x2c62e8[_0x170507(0x134)],'shopName':_0x2c62e8[_0x170507(0x1aa)][_0x170507(0x1a5)],'shopUsername':_0x2c62e8[_0x170507(0x1aa)][_0x170507(0x194)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2233e7[_0x2c62e8['shopId']][_0x170507(0x12e)]++,_0x2233e7[_0x2c62e8[_0x170507(0x134)]][_0x170507(0xd6)]+=_0x46942c,_0x2233e7[_0x2c62e8[_0x170507(0x134)]][_0x170507(0x106)]+=_0x49bd9b,_0x2233e7[_0x2c62e8['shopId']][_0x170507(0xea)]+=_0x10bc39);const _0x166ce8=_0x2c62e8[_0x170507(0x19a)][_0x170507(0x184)]()[_0x170507(0x1a8)]('T')[0x0];!_0xb6b30e[_0x166ce8]&&(_0xb6b30e[_0x166ce8]={'date':_0x166ce8,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xb6b30e[_0x166ce8]['turnover']+=_0x46942c,_0xb6b30e[_0x166ce8][_0x170507(0xe6)]+=_0x10bc39,_0xb6b30e[_0x166ce8][_0x170507(0x15f)]+=_0x49bd9b,_0xb6b30e[_0x166ce8][_0x170507(0x12e)]++;}catch(_0x502e40){console[_0x170507(0x19b)](_0x170507(0x1e4)+_0x2c62e8['id']+':',_0x502e40);}}Object[_0x170507(0x1ef)](_0x32e028)[_0x170507(0x18d)](_0x4f2b26=>{const _0x192b2f=_0x170507;_0x4f2b26[_0x192b2f(0x19f)]=_0x4f2b26[_0x192b2f(0x12e)]>0x0?_0x4f2b26[_0x192b2f(0x17f)]/_0x4f2b26[_0x192b2f(0x12e)]:0x0,delete _0x4f2b26[_0x192b2f(0x17f)];}),Object[_0x170507(0x1ef)](_0x2233e7)['forEach'](_0x565750=>{const _0x44ecb6=_0x170507;_0x565750[_0x44ecb6(0x1d5)]=_0x565750[_0x44ecb6(0x12e)]>0x0?_0x565750['turnoverUSDT']/_0x565750[_0x44ecb6(0x12e)]:0x0;});let _0x5e332e=0x0,_0x25584e=0x0;if(_0x5b7f61['shopId']){const _0x56afd1=await database_1['default'][_0x170507(0x109)][_0x170507(0x1ed)]({'where':{'shopId':_0x5b7f61[_0x170507(0x134)],'status':_0x170507(0x125),'createdAt':{'gte':_0x1ac09b,'lte':_0x248bf2}},'select':{'amount':!![]}});_0x5e332e=_0x56afd1[_0x170507(0x1fb)]((_0x37c513,_0xcdfa8a)=>_0x37c513+_0xcdfa8a[_0x170507(0xf0)],0x0);const _0x44db53=await database_1[_0x170507(0xfa)][_0x170507(0x109)][_0x170507(0x1ed)]({'where':{'shopId':_0x5b7f61[_0x170507(0x134)],'status':_0x170507(0x17e),'createdAt':{'gte':_0x1ac09b,'lte':_0x248bf2}},'select':{'amount':!![]}});_0x25584e=_0x44db53[_0x170507(0x1fb)]((_0xaaa5d3,_0x323fd4)=>_0xaaa5d3+_0x323fd4[_0x170507(0xf0)],0x0);}const _0x3293ab=_0x536e21,_0x529d60=_0x1ea90e[_0x170507(0x1b8)],_0x17d4f1=_0x529d60>0x0?_0x319930/_0x529d60:0x0,_0x4ee2c2=_0x3293ab>0x0?Math['round'](_0x529d60/_0x3293ab*0x2710)/0x64:0x0,_0x168624=Math[_0x170507(0x178)]((_0x248bf2['getTime']()-_0x1ac09b[_0x170507(0x1df)]())/(0x3e8*0x3c*0x3c*0x18)),_0x6cf94d={'totalTurnover':Math[_0x170507(0x1db)](_0x319930*0x64)/0x64,'merchantEarnings':Math['round'](_0x156ce9*0x64)/0x64,'gatewayEarnings':Math[_0x170507(0x1db)](_0x5931cc*0x64)/0x64,'totalPaidOut':Math[_0x170507(0x1db)](_0x5e332e*0x64)/0x64,'pendingPayout':Math[_0x170507(0x1db)](_0x25584e*0x64)/0x64,'averageCheck':Math['round'](_0x17d4f1*0x64)/0x64,'totalPayments':_0x3293ab,'successfulPayments':_0x529d60,'conversionRate':_0x4ee2c2,'gatewayBreakdown':Object[_0x170507(0x1ef)](_0x32e028)[_0x170507(0x171)](_0x470c11=>({..._0x470c11,'turnoverUSDT':Math[_0x170507(0x1db)](_0x470c11['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x170507(0x1db)](_0x470c11['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x470c11[_0x170507(0xea)]*0x64)/0x64,'averageCommissionRate':Math[_0x170507(0x1db)](_0x470c11[_0x170507(0x19f)]*0x64)/0x64})),'merchantBreakdown':_0x5b7f61[_0x170507(0x134)]?undefined:Object[_0x170507(0x1ef)](_0x2233e7)['map'](_0x4f8d5f=>({..._0x4f8d5f,'turnoverUSDT':Math[_0x170507(0x1db)](_0x4f8d5f[_0x170507(0xd6)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x4f8d5f['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x170507(0x1db)](_0x4f8d5f['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x170507(0x1db)](_0x4f8d5f['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x170507(0x1db)](_0x4f8d5f[_0x170507(0x1d5)]*0x64)/0x64})),'dailyData':Object[_0x170507(0x1ef)](_0xb6b30e)[_0x170507(0x171)](_0x44de94=>({..._0x44de94,'turnover':Math['round'](_0x44de94[_0x170507(0x190)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x44de94[_0x170507(0xe6)]*0x64)/0x64,'gatewayEarnings':Math[_0x170507(0x1db)](_0x44de94[_0x170507(0x15f)]*0x64)/0x64}))['sort']((_0x33a63a,_0xe2f5e8)=>_0x33a63a['date'][_0x170507(0x149)](_0xe2f5e8[_0x170507(0x1c7)])),'periodInfo':{'from':_0x1ac09b,'to':_0x248bf2,'periodType':_0x5b7f61[_0x170507(0x18c)]||'custom','daysCount':_0x168624}};return console[_0x170507(0x18f)](_0x170507(0x1cf)),console['log'](_0x170507(0x1c4)+_0x6cf94d[_0x170507(0xe4)]+_0x170507(0x13e)),console[_0x170507(0x18f)](_0x170507(0x221)+_0x6cf94d[_0x170507(0xe6)]+'\x20USDT'),console['log'](_0x170507(0x1a6)+_0x6cf94d[_0x170507(0x15f)]+_0x170507(0x13e)),console[_0x170507(0x18f)](_0x170507(0x1bf)+_0x6cf94d[_0x170507(0x19c)]+_0x170507(0x13e)),console['log'](_0x170507(0x10a)+_0x6cf94d[_0x170507(0x115)]+'\x20USDT'),console[_0x170507(0x18f)](_0x170507(0xf2)+_0x6cf94d[_0x170507(0x14e)]),_0x6cf94d;}async[a40_0x2e7599(0x1c1)](){const _0x5e726e=a40_0x2e7599;console[_0x5e726e(0x18f)](_0x5e726e(0x1bd));const _0x4d7018=await database_1[_0x5e726e(0xfa)][_0x5e726e(0x1aa)]['findMany']({'where':{'status':_0x5e726e(0x1a3)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x5e726e(0x175)}});return console['log'](_0x5e726e(0x222)+_0x4d7018[_0x5e726e(0x1b8)]+'\x20active\x20merchants\x20for\x20selection'),_0x4d7018['map'](_0x265702=>({'id':_0x265702['id'],'username':_0x265702[_0x5e726e(0x194)],'name':_0x265702[_0x5e726e(0x1a5)]}));}[a40_0x2e7599(0x189)](_0x109a90){const _0xc66a01=a40_0x2e7599,_0x42b9d0={'test_gateway':_0xc66a01(0x11d),'plisio':_0xc66a01(0x1af),'rapyd':_0xc66a01(0x13f),'noda':_0xc66a01(0x147),'cointopay':'CoinToPay','cointopay2':_0xc66a01(0xdd),'klyme_eu':_0xc66a01(0x191),'klyme_gb':_0xc66a01(0x1f2),'klyme_de':_0xc66a01(0xc7),'mastercard':_0xc66a01(0xe2)};return _0x42b9d0[_0x109a90]||_0x109a90;}[a40_0x2e7599(0xec)](_0x493e91){const _0xbf1f72=a40_0x2e7599,_0x435fb2={'Test\x20Gateway':_0xbf1f72(0x100),'Plisio':_0xbf1f72(0x107),'Rapyd':'rapyd','Noda':_0xbf1f72(0x10d),'CoinToPay':_0xbf1f72(0x1d2),'CoinToPay2':_0xbf1f72(0xfe),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0xbf1f72(0x21a),'KLYME\x20DE':_0xbf1f72(0x186),'MasterCard':_0xbf1f72(0xd2)};return _0x435fb2[_0x493e91]||_0x493e91[_0xbf1f72(0xde)]();}async[a40_0x2e7599(0x13a)](_0x5756ea){const _0x1ed972=a40_0x2e7599,{page:_0xcc31ba,limit:_0x47cdbd,minAmount:_0x2d29e7,search:_0x414856}=_0x5756ea;console[_0x1ed972(0x18f)](_0x1ed972(0x20b),_0x5756ea);let _0x23fd14={'status':_0x1ed972(0x1a3)};_0x414856&&(_0x23fd14['name']={'contains':_0x414856,'mode':_0x1ed972(0x146)});const _0x4a552c=await database_1[_0x1ed972(0xfa)][_0x1ed972(0x1aa)]['findMany']({'where':_0x23fd14,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x4ea6af=_0x4a552c[_0x1ed972(0x121)](_0x46b038=>{const _0x2b95da=_0x1ed972,_0x3f07aa=Math[_0x2b95da(0x1db)](_0x46b038[_0x2b95da(0x12a)]*0x64)/0x64;if(_0x2d29e7&&_0x3f07aa<_0x2d29e7)return![];return _0x3f07aa!==0x0;});_0x4ea6af[_0x1ed972(0xe3)]((_0x34e2b1,_0xfa6bbe)=>_0xfa6bbe[_0x1ed972(0x12a)]-_0x34e2b1['balance']);const _0x1c427b=_0x4ea6af[_0x1ed972(0x1b8)],_0x5681e2=(_0xcc31ba-0x1)*_0x47cdbd,_0x49c728=_0x4ea6af['slice'](_0x5681e2,_0x5681e2+_0x47cdbd);console[_0x1ed972(0x18f)](_0x1ed972(0x128)+_0x49c728[_0x1ed972(0x1b8)]+_0x1ed972(0x177));const _0x27cd5b=await Promise[_0x1ed972(0x164)](_0x49c728[_0x1ed972(0x171)](async _0x19a913=>{const _0x5e56dd=_0x1ed972,[_0x202bd6,_0xaaa09e,_0x477c1b]=await Promise[_0x5e56dd(0x164)]([database_1[_0x5e56dd(0xfa)]['payment'][_0x5e56dd(0x1d8)]({'where':{'shopId':_0x19a913['id'],'status':'PAID','gateway':{'not':'test_gateway'}}}),database_1['default'][_0x5e56dd(0x216)]['findFirst']({'where':{'shopId':_0x19a913['id'],'status':_0x5e56dd(0x158),'gateway':{'not':_0x5e56dd(0x100)}},'orderBy':{'paidAt':_0x5e56dd(0x175)},'select':{'paidAt':!![]}}),database_1[_0x5e56dd(0xfa)]['payment']['groupBy']({'by':[_0x5e56dd(0x1b7)],'where':{'shopId':_0x19a913['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3eabd8=new Date(),_0x8d3d6=new Date(_0x3eabd8[_0x5e56dd(0x16f)](),_0x3eabd8[_0x5e56dd(0x1c0)](),0x1),_0x77ef1f=new Date(_0x3eabd8[_0x5e56dd(0x16f)](),_0x3eabd8[_0x5e56dd(0x1c0)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3574c7,_0x4499fc]=await Promise['all']([database_1['default'][_0x5e56dd(0x109)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x19a913['id'],'status':_0x5e56dd(0x125)}}),database_1[_0x5e56dd(0xfa)][_0x5e56dd(0x109)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x19a913['id'],'status':_0x5e56dd(0x125),'createdAt':{'gte':_0x8d3d6,'lte':_0x77ef1f}}})]),_0x42f854=_0x3574c7[_0x5e56dd(0x1ce)]['amount']||0x0,_0x239ad7=_0x4499fc[_0x5e56dd(0x1ce)][_0x5e56dd(0xf0)]||0x0,_0x16b848=await Promise[_0x5e56dd(0x164)](_0x477c1b[_0x5e56dd(0x171)](async _0x3a8837=>{const _0x680484=_0x5e56dd;let _0x57b12f=0x2d;if(_0x19a913['gatewaySettings'])try{const _0x582389=JSON[_0x680484(0x170)](_0x19a913['gatewaySettings']);for(const [_0x3fd6de,_0x90a640]of Object[_0x680484(0x17b)](_0x582389)){if(_0x3fd6de['toLowerCase']()===_0x3a8837[_0x680484(0x1b7)][_0x680484(0xde)]()){_0x57b12f=_0x90a640[_0x680484(0x173)]||0xa,console['log'](_0x680484(0xe7)+_0x3a8837['gateway']+'\x20for\x20shop\x20'+_0x19a913['id']+_0x680484(0x1fe)+_0x57b12f+'%');break;}}}catch(_0x30f422){console[_0x680484(0x19b)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x19a913['id']+':',_0x30f422);}const _0x3afa55=_0x3a8837[_0x680484(0x1ce)]?.[_0x680484(0xf1)]||0x0,_0x5eb073=_0x3afa55*(0x1-_0x57b12f/0x64);return{'gateway':_0x3a8837[_0x680484(0x1b7)],'count':_0x3a8837[_0x680484(0x135)]?.['id']||0x0,'amountUSDT':Math[_0x680484(0x1db)](_0x3afa55*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x680484(0x1db)](_0x5eb073*0x64)/0x64,'commission':_0x57b12f};})),_0xfd357c=_0x16b848['reduce']((_0x455171,_0x32a879)=>_0x455171+_0x32a879['amountUSDT'],0x0),_0x5bcb4a=_0x16b848[_0x5e56dd(0x1fb)]((_0x4c3b90,_0x246d59)=>_0x4c3b90+_0x246d59[_0x5e56dd(0x168)],0x0),_0x2ce328=_0x19a913[_0x5e56dd(0x12a)];return console[_0x5e56dd(0x18f)](_0x5e56dd(0x195)+_0x19a913[_0x5e56dd(0x194)]+':'),console[_0x5e56dd(0x18f)](_0x5e56dd(0x1f8)+_0xfd357c['toFixed'](0x2)+_0x5e56dd(0x14b)),console[_0x5e56dd(0x18f)]('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x5bcb4a[_0x5e56dd(0x155)](0x2)+_0x5e56dd(0x117)),console['log'](_0x5e56dd(0x207)+_0x2ce328[_0x5e56dd(0x155)](0x2)+_0x5e56dd(0x169)),console[_0x5e56dd(0x18f)](_0x5e56dd(0x12d)+_0x42f854['toFixed'](0x2)+_0x5e56dd(0xdc)),console['log'](_0x5e56dd(0x227)+(_0x5bcb4a-_0x42f854-_0x2ce328)[_0x5e56dd(0x155)](0x2)+_0x5e56dd(0x1da)),{'id':_0x19a913['id'],'fullName':_0x19a913['name'],'username':_0x19a913[_0x5e56dd(0x194)],'telegramId':_0x19a913[_0x5e56dd(0x14c)],'merchantUrl':_0x19a913[_0x5e56dd(0x1d4)],'wallets':{'usdtPolygonWallet':_0x19a913['usdtPolygonWallet'],'usdtTrcWallet':_0x19a913[_0x5e56dd(0x215)],'usdtErcWallet':_0x19a913[_0x5e56dd(0x1e5)],'usdcPolygonWallet':_0x19a913['usdcPolygonWallet'],'usdcErcWallet':_0x19a913[_0x5e56dd(0x1f5)]},'totalAmountUSDT':Math[_0x5e56dd(0x1db)](_0xfd357c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5e56dd(0x1db)](_0x5bcb4a*0x64)/0x64,'currentBalance':Math['round'](_0x2ce328*0x64)/0x64,'totalPayout':Math[_0x5e56dd(0x1db)](_0x42f854*0x64)/0x64,'thisMonth':Math[_0x5e56dd(0x1db)](_0x239ad7*0x64)/0x64,'paymentsCount':_0x202bd6,'oldestPaymentDate':_0xaaa09e?.[_0x5e56dd(0x19a)]||_0x19a913[_0x5e56dd(0x11c)],'gatewayBreakdown':_0x16b848};})),_0x468b77=_0x27cd5b[_0x1ed972(0x1fb)]((_0x276f93,_0x34d6f5)=>_0x276f93+_0x34d6f5['totalAmountUSDT'],0x0),_0xc5e62c=_0x27cd5b[_0x1ed972(0x1fb)]((_0x1e6e47,_0x69bca4)=>_0x1e6e47+_0x69bca4['totalAmountAfterCommissionUSDT'],0x0),_0x8cc26c=_0x27cd5b[_0x1ed972(0x1fb)]((_0x4a4bfa,_0x35a685)=>_0x4a4bfa+_0x35a685[_0x1ed972(0x1bc)],0x0),_0x1e0f9d=_0x27cd5b[_0x1ed972(0x1fb)]((_0x3cb790,_0x13daf2)=>_0x3cb790+_0x13daf2[_0x1ed972(0x21d)],0x0);return console['log'](_0x1ed972(0xc8)+_0x1c427b+'\x20merchants'),console[_0x1ed972(0x18f)](_0x1ed972(0x203)+Math['round'](_0x468b77*0x64)/0x64+_0x1ed972(0x14b)),console[_0x1ed972(0x18f)](_0x1ed972(0x112)+Math[_0x1ed972(0x1db)](_0xc5e62c*0x64)/0x64+_0x1ed972(0x1ea)),console[_0x1ed972(0x18f)](_0x1ed972(0x1d9)+Math[_0x1ed972(0x1db)](_0x8cc26c*0x64)/0x64+_0x1ed972(0x13e)),console[_0x1ed972(0x18f)](_0x1ed972(0xfd)+Math[_0x1ed972(0x1db)](_0x1e0f9d*0x64)/0x64+_0x1ed972(0x13e)),{'merchants':_0x27cd5b,'pagination':{'page':_0xcc31ba,'limit':_0x47cdbd,'total':_0x1c427b,'totalPages':Math[_0x1ed972(0x178)](_0x1c427b/_0x47cdbd)},'summary':{'totalMerchants':_0x1c427b,'totalAmountUSDT':Math['round'](_0x468b77*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1ed972(0x1db)](_0xc5e62c*0x64)/0x64,'totalPayout':Math[_0x1ed972(0x1db)](_0x8cc26c*0x64)/0x64,'thisMonth':Math['round'](_0x1e0f9d*0x64)/0x64}};}async[a40_0x2e7599(0x212)](_0x299b47){const _0x1aa256=a40_0x2e7599,{shopId:_0xfa6afa,amount:_0x55a636,network:_0x3829d5,wallet:_0xecb85,notes:_0x3b69b9,txid:_0x484c72,periodFrom:_0x590f75,periodTo:_0x341728}=_0x299b47,_0xe0920d=await database_1[_0x1aa256(0xfa)][_0x1aa256(0x103)](async _0x173473=>{const _0x315e18=_0x1aa256,_0xda6a23=await _0x173473[_0x315e18(0x1aa)][_0x315e18(0x1b0)]({'where':{'id':_0xfa6afa},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xda6a23)throw new Error(_0x315e18(0x199));console[_0x315e18(0x18f)](_0x315e18(0x206)+_0xda6a23['username']+':'),console['log'](_0x315e18(0x20a)+_0xda6a23['balance']['toFixed'](0x6)+_0x315e18(0x13e)),console[_0x315e18(0x18f)](_0x315e18(0x197)+_0x55a636[_0x315e18(0x155)](0x6)+_0x315e18(0x13e)),console[_0x315e18(0x18f)](_0x315e18(0x111)+_0xda6a23[_0x315e18(0x19c)][_0x315e18(0x155)](0x6)+'\x20USDT');if(_0x484c72)console['log'](_0x315e18(0x15d)+_0x484c72);const _0x1a73a2=0.000001,_0x4c2f82=Number(_0xda6a23['balance']),_0x3f8748=Number(_0x55a636);console[_0x315e18(0x18f)](_0x315e18(0x1fa)),console[_0x315e18(0x18f)](_0x315e18(0x130)+_0xda6a23[_0x315e18(0x12a)]),console[_0x315e18(0x18f)](_0x315e18(0x180)+_0x4c2f82),console[_0x315e18(0x18f)](_0x315e18(0x15a)+_0x3f8748),console[_0x315e18(0x18f)](_0x315e18(0x16c)+(_0x4c2f82-_0x3f8748)),console[_0x315e18(0x18f)](_0x315e18(0x1e3)+_0x1a73a2);if(_0x4c2f82<_0x3f8748-_0x1a73a2)throw new Error(_0x315e18(0x12f)+_0x4c2f82[_0x315e18(0x155)](0x6)+_0x315e18(0x136)+_0x3f8748[_0x315e18(0x155)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x4c2f82-_0x3f8748)[_0x315e18(0x155)](0x8)+_0x315e18(0x13e));console['log'](_0x315e18(0x159));const _0x351aef=Math[_0x315e18(0x17c)](_0x4c2f82,_0x3f8748);let _0x43307a=_0xecb85;if(!_0x43307a){const _0x32727e=await _0x173473[_0x315e18(0x1aa)]['findUnique']({'where':{'id':_0xfa6afa},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x32727e)switch(_0x3829d5){case _0x315e18(0x1ee):_0x43307a=_0x32727e[_0x315e18(0x1e2)]||undefined;break;case _0x315e18(0x16e):_0x43307a=_0x32727e['usdtTrcWallet']||undefined;break;case _0x315e18(0x1cb):_0x43307a=_0x32727e[_0x315e18(0x1e5)]||undefined;break;case _0x315e18(0xfc):_0x43307a=_0x32727e[_0x315e18(0x152)]||undefined;break;case'erc20_usdc':_0x43307a=_0x32727e['usdcErcWallet']||undefined;break;}}console['log'](_0x315e18(0x213)+_0x3829d5+':\x20'+(_0x43307a||_0x315e18(0xf5)));const _0x134d23=await _0x173473['payout'][_0x315e18(0x1b5)]({'data':{'shopId':_0xfa6afa,'amount':_0x351aef,'network':_0x3829d5,'wallet':_0x43307a,'status':_0x315e18(0x125),'txid':_0x484c72,'notes':_0x3b69b9,'periodFrom':_0x590f75?new Date(_0x590f75):null,'periodTo':_0x341728?new Date(_0x341728):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x57f970=_0x4c2f82-_0x351aef,_0x3a1b22=Number(_0xda6a23[_0x315e18(0x19c)])+_0x351aef;return await _0x173473[_0x315e18(0x1aa)][_0x315e18(0x1ff)]({'where':{'id':_0xfa6afa},'data':{'balance':_0x57f970,'totalPaidOut':_0x3a1b22}}),console[_0x315e18(0x18f)](_0x315e18(0x196)+_0xda6a23['username']+_0x315e18(0x193)),console[_0x315e18(0x18f)](_0x315e18(0x1ba)+_0x4c2f82[_0x315e18(0x155)](0x6)+_0x315e18(0x1a9)+_0x57f970[_0x315e18(0x155)](0x6)+'\x20USDT\x20(-'+_0x351aef['toFixed'](0x6)+')'),console[_0x315e18(0x18f)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0xda6a23['totalPaidOut'][_0x315e18(0x155)](0x6)+_0x315e18(0x1a9)+_0x3a1b22[_0x315e18(0x155)](0x6)+'\x20USDT\x20(+'+_0x351aef[_0x315e18(0x155)](0x6)+')'),console[_0x315e18(0x18f)](_0x315e18(0x20e)+_0x351aef[_0x315e18(0x155)](0x6)+_0x315e18(0x13e)),{'payout':_0x134d23,'shop':_0xda6a23};});return console[_0x1aa256(0x18f)](_0x1aa256(0x17a)+_0xe0920d[_0x1aa256(0x109)]['id']+_0x1aa256(0x226)+_0xe0920d[_0x1aa256(0x1aa)][_0x1aa256(0x194)]+'\x20('+_0xe0920d[_0x1aa256(0x109)][_0x1aa256(0xf0)][_0x1aa256(0x155)](0x6)+_0x1aa256(0x108)),{'id':_0xe0920d[_0x1aa256(0x109)]['id'],'shopId':_0xe0920d[_0x1aa256(0x109)][_0x1aa256(0x134)],'shopName':_0xe0920d[_0x1aa256(0x1aa)][_0x1aa256(0x1a5)],'shopUsername':_0xe0920d[_0x1aa256(0x1aa)][_0x1aa256(0x194)],'amount':_0xe0920d[_0x1aa256(0x109)][_0x1aa256(0xf0)],'network':_0xe0920d[_0x1aa256(0x109)][_0x1aa256(0x1eb)],'wallet':_0xe0920d[_0x1aa256(0x109)]['wallet'],'status':_0xe0920d['payout']['status'],'txid':_0xe0920d[_0x1aa256(0x109)]['txid'],'notes':_0xe0920d[_0x1aa256(0x109)]['notes'],'periodFrom':_0xe0920d[_0x1aa256(0x109)][_0x1aa256(0x1bb)],'periodTo':_0xe0920d[_0x1aa256(0x109)][_0x1aa256(0xcc)],'createdAt':_0xe0920d[_0x1aa256(0x109)][_0x1aa256(0x11c)],'paidAt':_0xe0920d['payout'][_0x1aa256(0x19a)]};}async[a40_0x2e7599(0x18b)](_0x3a4fb2){const _0x5976f4=a40_0x2e7599,{page:_0x11a1f1,limit:_0x3f3cf1,shopId:_0x3c3b9e,network:_0x530061,dateFrom:_0x3d3a36,dateTo:_0x6be8d3,search:_0x47add2}=_0x3a4fb2,_0x10da28=(_0x11a1f1-0x1)*_0x3f3cf1,_0x157294={};_0x3c3b9e&&(_0x157294['shopId']=_0x3c3b9e);_0x530061&&(_0x157294[_0x5976f4(0x1eb)]=_0x530061);(_0x3d3a36||_0x6be8d3)&&(_0x157294[_0x5976f4(0x11c)]={},_0x3d3a36&&(_0x157294[_0x5976f4(0x11c)][_0x5976f4(0x200)]=new Date(_0x3d3a36)),_0x6be8d3&&(_0x157294[_0x5976f4(0x11c)]['lte']=new Date(_0x6be8d3)));_0x47add2&&(_0x157294['OR']=[{'shop':{'name':{'contains':_0x47add2,'mode':_0x5976f4(0x146)}}},{'shop':{'username':{'contains':_0x47add2,'mode':'insensitive'}}},{'notes':{'contains':_0x47add2,'mode':_0x5976f4(0x146)}}]);const [_0x8694f5,_0xa02430]=await Promise[_0x5976f4(0x164)]([database_1[_0x5976f4(0xfa)]['payout'][_0x5976f4(0x1ed)]({'where':_0x157294,'skip':_0x10da28,'take':_0x3f3cf1,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5976f4(0xfa)]['payout'][_0x5976f4(0x1d8)]({'where':_0x157294})]);return{'payouts':_0x8694f5[_0x5976f4(0x171)](_0xad2025=>({'id':_0xad2025['id'],'shopId':_0xad2025[_0x5976f4(0x134)],'shopName':_0xad2025[_0x5976f4(0x1aa)][_0x5976f4(0x1a5)],'shopUsername':_0xad2025[_0x5976f4(0x1aa)]['username'],'amount':_0xad2025[_0x5976f4(0xf0)],'network':_0xad2025[_0x5976f4(0x1eb)],'wallet':_0xad2025[_0x5976f4(0x1c9)],'status':_0xad2025[_0x5976f4(0x142)],'txid':_0xad2025[_0x5976f4(0x11e)],'notes':_0xad2025[_0x5976f4(0x122)],'periodFrom':_0xad2025[_0x5976f4(0x1bb)],'periodTo':_0xad2025[_0x5976f4(0xcc)],'createdAt':_0xad2025[_0x5976f4(0x11c)],'paidAt':_0xad2025['paidAt']})),'pagination':{'page':_0x11a1f1,'limit':_0x3f3cf1,'total':_0xa02430,'totalPages':Math[_0x5976f4(0x178)](_0xa02430/_0x3f3cf1)}};}async[a40_0x2e7599(0x218)](_0x5e7a5c){const _0x677f9f=a40_0x2e7599,_0x4fd40c=await database_1['default'][_0x677f9f(0x109)]['findUnique']({'where':{'id':_0x5e7a5c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4fd40c)return null;return{'id':_0x4fd40c['id'],'shopId':_0x4fd40c[_0x677f9f(0x134)],'shopName':_0x4fd40c['shop'][_0x677f9f(0x1a5)],'shopUsername':_0x4fd40c[_0x677f9f(0x1aa)][_0x677f9f(0x194)],'amount':_0x4fd40c['amount'],'network':_0x4fd40c[_0x677f9f(0x1eb)],'wallet':_0x4fd40c[_0x677f9f(0x1c9)],'status':_0x4fd40c[_0x677f9f(0x142)],'txid':_0x4fd40c['txid'],'notes':_0x4fd40c[_0x677f9f(0x122)],'periodFrom':_0x4fd40c[_0x677f9f(0x1bb)],'periodTo':_0x4fd40c[_0x677f9f(0xcc)],'createdAt':_0x4fd40c[_0x677f9f(0x11c)],'paidAt':_0x4fd40c[_0x677f9f(0x19a)]};}async[a40_0x2e7599(0x1c8)](_0x219e6b){const _0x13f3b7=a40_0x2e7599;await database_1[_0x13f3b7(0xfa)][_0x13f3b7(0x109)][_0x13f3b7(0x1f4)]({'where':{'id':_0x219e6b}});}async[a40_0x2e7599(0x192)](_0x4028da){const _0x105990=a40_0x2e7599,{page:_0x2be908,limit:_0x2275f8,status:_0x2b0b02,gateway:_0x5ba6a0,shopId:_0x584e17,dateFrom:_0x337aec,dateTo:_0x1e2f28,search:_0x19a647,currency:_0x3483ce,sortBy:_0x23362e,sortOrder:_0x1ea15c}=_0x4028da,_0x26a8fe=(_0x2be908-0x1)*_0x2275f8;console[_0x105990(0x18f)](_0x105990(0x1d3),_0x4028da);const _0x184ae7=await database_1[_0x105990(0xfa)][_0x105990(0x216)][_0x105990(0x1ae)]({'by':[_0x105990(0x1b7)],'_count':{'gateway':!![]}});console[_0x105990(0x18f)](_0x105990(0x21c),_0x184ae7['map'](_0x404e44=>_0x404e44['gateway']+'\x20('+_0x404e44['_count'][_0x105990(0x1b7)]+_0x105990(0x137)));if(_0x5ba6a0){const _0x337a88=_0x184ae7[_0x105990(0x20f)](_0x53b35c=>_0x53b35c[_0x105990(0x1b7)][_0x105990(0xde)]()===_0x5ba6a0[_0x105990(0xde)]());!_0x337a88&&_0x5ba6a0[_0x105990(0xde)]()!==_0x105990(0x100)&&console[_0x105990(0x18f)](_0x105990(0x198)+_0x5ba6a0+_0x105990(0x160)+_0x184ae7['map'](_0x2cf042=>_0x2cf042['gateway'])[_0x105990(0x11f)](',\x20'));}const _0xbbea81={};_0x2b0b02&&(_0xbbea81[_0x105990(0x142)]=_0x2b0b02[_0x105990(0xe8)]());if(!_0x5ba6a0)_0xbbea81['gateway']={'not':_0x105990(0x100)};else{if(_0x5ba6a0&&(_0x5ba6a0[_0x105990(0xde)]()===_0x105990(0x100)||_0x5ba6a0===_0x105990(0x182)))_0xbbea81['gateway']=_0x105990(0x100);else{let _0xb4c862=_0x5ba6a0;const _0x30e69e=(0x0,gateway_1[_0x105990(0x161)])(_0x5ba6a0);if(_0x30e69e)_0xb4c862=_0x30e69e,console[_0x105990(0x18f)](_0x105990(0x187)+_0x5ba6a0+_0x105990(0x129)+_0xb4c862+'\x27');else{const _0xf5ac71=(0x0,gateway_1[_0x105990(0x11b)])(_0x5ba6a0);if(_0xf5ac71){const _0x278cf7=(0x0,gateway_1['getGatewayNameById'])(_0xf5ac71);_0x278cf7&&(_0xb4c862=_0x278cf7,console[_0x105990(0x18f)](_0x105990(0xed)+_0x5ba6a0+'\x27\x20->\x20ID\x20\x27'+_0xf5ac71+_0x105990(0xe0)+_0xb4c862+'\x27'));}else console[_0x105990(0x18f)](_0x105990(0x204)+_0x5ba6a0+_0x105990(0x105));}const _0x1b11e1=await database_1['default'][_0x105990(0x216)][_0x105990(0x1d8)]({'where':{'gateway':_0xb4c862[_0x105990(0xde)]()},'take':0x1});_0x1b11e1===0x0?(console[_0x105990(0x18f)](_0x105990(0xd8)+_0xb4c862+_0x105990(0x211)+_0x5ba6a0+_0x105990(0x118)),_0xbbea81['gateway']=_0x105990(0x162)):(_0xbbea81[_0x105990(0x1b7)]=_0xb4c862[_0x105990(0xde)](),console['log'](_0x105990(0x1f1)+_0xb4c862+_0x105990(0x211)+_0x5ba6a0+'\x27)'));}}console['log'](_0x105990(0x126),_0xbbea81['gateway']);_0x584e17&&(_0xbbea81['shopId']=_0x584e17);_0x3483ce&&(_0xbbea81['currency']=_0x3483ce[_0x105990(0xe8)](),console['log'](_0x105990(0x1d6)+_0x3483ce['toUpperCase']()));(_0x337aec||_0x1e2f28)&&(_0xbbea81[_0x105990(0x11c)]={},_0x337aec&&(_0xbbea81[_0x105990(0x11c)][_0x105990(0x200)]=new Date(_0x337aec)),_0x1e2f28&&(_0xbbea81[_0x105990(0x11c)]['lte']=new Date(_0x1e2f28)));_0x19a647&&(_0xbbea81['OR']=[{'id':{'contains':_0x19a647,'mode':_0x105990(0x146)}},{'orderId':{'contains':_0x19a647,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x19a647,'mode':_0x105990(0x146)}},{'customerEmail':{'contains':_0x19a647,'mode':_0x105990(0x146)}},{'shop':{'name':{'contains':_0x19a647,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x19a647,'mode':_0x105990(0x146)}}}]);console[_0x105990(0x18f)](_0x105990(0x21b),JSON[_0x105990(0xf7)](_0xbbea81,null,0x2));let _0x5e5daa={'createdAt':_0x105990(0x13c)};if(_0x23362e){const _0x22253a=[_0x105990(0xf0),_0x105990(0x11c),'updatedAt',_0x105990(0x142),_0x105990(0x1b7),_0x105990(0x208)],_0x56c47f=['asc',_0x105990(0x13c)];if(_0x22253a[_0x105990(0xd9)](_0x23362e)){const _0x20eb5f=_0x56c47f[_0x105990(0xd9)](_0x1ea15c)?_0x1ea15c:_0x105990(0x13c);_0x5e5daa={[_0x23362e]:_0x20eb5f},console['log']('📊\x20Sorting\x20payments\x20by\x20'+_0x23362e+_0x105990(0x210)+_0x20eb5f+'\x20order');}}const [_0x10b89,_0x831f10]=await Promise[_0x105990(0x164)]([database_1[_0x105990(0xfa)][_0x105990(0x216)][_0x105990(0x1ed)]({'where':_0xbbea81,'skip':_0x26a8fe,'take':_0x2275f8,'orderBy':_0x5e5daa,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x105990(0xfa)][_0x105990(0x216)][_0x105990(0x1d8)]({'where':_0xbbea81})]);return{'payments':_0x10b89,'pagination':{'page':_0x2be908,'limit':_0x2275f8,'total':_0x831f10,'totalPages':Math[_0x105990(0x178)](_0x831f10/_0x2275f8)}};}async['getPaymentById'](_0x573aae){const _0x52a4da=a40_0x2e7599,_0x57e73a=await database_1[_0x52a4da(0xfa)][_0x52a4da(0x216)][_0x52a4da(0x1b0)]({'where':{'id':_0x573aae},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x57e73a)return null;return{'id':_0x57e73a['id'],'shopId':_0x57e73a[_0x52a4da(0x134)],'gateway':_0x57e73a[_0x52a4da(0x1b7)],'amount':_0x57e73a['amount'],'currency':_0x57e73a['currency'],'status':_0x57e73a[_0x52a4da(0x142)],'orderId':_0x57e73a[_0x52a4da(0x120)],'gatewayOrderId':_0x57e73a['gatewayOrderId'],'customerEmail':_0x57e73a[_0x52a4da(0xe1)],'customerName':_0x57e73a[_0x52a4da(0xcd)],'customerCountry':_0x57e73a['customerCountry'],'customerIp':_0x57e73a[_0x52a4da(0x11a)],'customerUa':_0x57e73a[_0x52a4da(0x10f)],'failureMessage':_0x57e73a[_0x52a4da(0x110)],'externalPaymentUrl':_0x57e73a['externalPaymentUrl'],'successUrl':_0x57e73a[_0x52a4da(0x148)],'failUrl':_0x57e73a[_0x52a4da(0x223)],'pendingUrl':_0x57e73a['pendingUrl'],'whiteUrl':_0x57e73a[_0x52a4da(0x219)],'createdAt':_0x57e73a[_0x52a4da(0x11c)],'updatedAt':_0x57e73a[_0x52a4da(0xf3)],'shop':_0x57e73a[_0x52a4da(0x1aa)]};}async[a40_0x2e7599(0x1f3)](_0x315bcf,_0x564d46,_0x2ad117,_0x58f33a){const _0x2a25f3=a40_0x2e7599,_0x55ed94=await database_1[_0x2a25f3(0xfa)][_0x2a25f3(0x103)](async _0x5ce694=>{const _0x2e7efb=_0x2a25f3,_0x4b92b5=await _0x5ce694[_0x2e7efb(0x216)][_0x2e7efb(0x1b0)]({'where':{'id':_0x315bcf},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4b92b5)throw new Error(_0x2e7efb(0x157));const _0x41124a=_0x4b92b5[_0x2e7efb(0x142)],_0x180c1b=_0x564d46[_0x2e7efb(0xe8)]();console[_0x2e7efb(0x18f)](_0x2e7efb(0x19d)+_0x315bcf+_0x2e7efb(0x20d)+_0x41124a+_0x2e7efb(0x1a9)+_0x180c1b),console['log'](_0x2e7efb(0xd3)+_0x4b92b5[_0x2e7efb(0x1aa)][_0x2e7efb(0x12a)]+_0x2e7efb(0x13e));const _0x434fea={'status':_0x180c1b,'updatedAt':new Date(),'statusChangedBy':_0x2e7efb(0x224),'statusChangedAt':new Date()};_0x2ad117&&(_0x434fea[_0x2e7efb(0x188)]=_0x2ad117);_0x180c1b===_0x2e7efb(0x116)&&_0x58f33a&&(_0x434fea[_0x2e7efb(0xdf)]=_0x58f33a);let _0x46be13=0x0,_0x5be8f6=_0x4b92b5[_0x2e7efb(0x1aa)][_0x2e7efb(0x12a)];if(_0x180c1b===_0x2e7efb(0x158)&&_0x41124a!=='PAID'){_0x434fea['paidAt']=new Date();const _0x226944=await currencyService_1[_0x2e7efb(0x15e)][_0x2e7efb(0x1e0)](_0x4b92b5[_0x2e7efb(0xf0)],_0x4b92b5[_0x2e7efb(0x208)]);_0x434fea['amountUSDT']=_0x226944;let _0x1b819f=0x2d;const _0x1c1abe=await _0x5ce694[_0x2e7efb(0x1aa)]['findUnique']({'where':{'id':_0x4b92b5[_0x2e7efb(0x134)]},'select':{'gatewaySettings':!![]}});if(_0x1c1abe?.[_0x2e7efb(0x167)])try{const _0x228ec7=JSON[_0x2e7efb(0x170)](_0x1c1abe[_0x2e7efb(0x167)]);for(const [_0x33fda6,_0x2100fd]of Object[_0x2e7efb(0x17b)](_0x228ec7)){if(_0x33fda6['toLowerCase']()===_0x4b92b5[_0x2e7efb(0x1b7)][_0x2e7efb(0xde)]()){_0x1b819f=_0x2100fd[_0x2e7efb(0x173)]||0xa;break;}}}catch(_0x49a901){console[_0x2e7efb(0x19b)](_0x2e7efb(0x176)+_0x315bcf+':',_0x49a901);}let _0x4adc3a;_0x4b92b5[_0x2e7efb(0x123)]!==null&&_0x4b92b5[_0x2e7efb(0x123)]!==undefined?(_0x4adc3a=_0x4b92b5[_0x2e7efb(0x123)],console[_0x2e7efb(0x18f)](_0x2e7efb(0x104)+_0x4adc3a['toFixed'](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x315bcf)):(_0x4adc3a=_0x226944*(0x1-_0x1b819f/0x64),console[_0x2e7efb(0x18f)](_0x2e7efb(0x16a)+_0x315bcf+':\x20'+_0x1b819f+'%\x20from\x20'+_0x226944[_0x2e7efb(0x155)](0x6)+_0x2e7efb(0x13e)),_0x434fea[_0x2e7efb(0x123)]=_0x4adc3a,_0x434fea[_0x2e7efb(0x143)]=_0x1b819f),_0x46be13=_0x4adc3a,_0x5be8f6+=_0x4adc3a,console[_0x2e7efb(0x18f)](_0x2e7efb(0x16d)+_0x315bcf+_0x2e7efb(0xcf)),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x226944[_0x2e7efb(0x155)](0x6)+'\x20USDT'),console[_0x2e7efb(0x18f)](_0x2e7efb(0x14d)+_0x4b92b5['gateway']+',\x20Commission:\x20'+_0x1b819f+'%'),console['log'](_0x2e7efb(0xf6)+_0x4adc3a[_0x2e7efb(0x155)](0x6)+'\x20USDT\x20(after\x20'+_0x1b819f+_0x2e7efb(0x151)),console[_0x2e7efb(0x18f)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x4adc3a[_0x2e7efb(0x155)](0x6)+_0x2e7efb(0x13e));}else{if(_0x41124a===_0x2e7efb(0x158)&&_0x180c1b!==_0x2e7efb(0x158)&&_0x180c1b!==_0x2e7efb(0x116)){if(_0x4b92b5[_0x2e7efb(0xf1)]){let _0x33392d=0x2d;const _0x3b3220=await _0x5ce694[_0x2e7efb(0x1aa)][_0x2e7efb(0x1b0)]({'where':{'id':_0x4b92b5['shopId']},'select':{'gatewaySettings':!![]}});if(_0x3b3220?.[_0x2e7efb(0x167)])try{const _0x15d11d=JSON[_0x2e7efb(0x170)](_0x3b3220[_0x2e7efb(0x167)]);for(const [_0x2c21e3,_0x29773a]of Object[_0x2e7efb(0x17b)](_0x15d11d)){if(_0x2c21e3[_0x2e7efb(0xde)]()===_0x4b92b5['gateway']['toLowerCase']()){_0x33392d=_0x29773a[_0x2e7efb(0x173)]||0xa;break;}}}catch(_0x5a675c){console['error'](_0x2e7efb(0x176)+_0x315bcf+':',_0x5a675c);}const _0x431678=_0x4b92b5[_0x2e7efb(0xf1)]*(0x1-_0x33392d/0x64);_0x46be13=-_0x431678,_0x5be8f6-=_0x431678,console[_0x2e7efb(0x18f)](_0x2e7efb(0x1c6)+_0x4b92b5[_0x2e7efb(0xf1)][_0x2e7efb(0x155)](0x6)+_0x2e7efb(0x13e)),console['log'](_0x2e7efb(0x14d)+_0x4b92b5[_0x2e7efb(0x1b7)]+_0x2e7efb(0x1ca)+_0x33392d+'%'),console[_0x2e7efb(0x18f)](_0x2e7efb(0x141)+_0x431678[_0x2e7efb(0x155)](0x6)+_0x2e7efb(0xf8)+_0x33392d+'%\x20commission)'),console[_0x2e7efb(0x18f)](_0x2e7efb(0xf4)+_0x431678[_0x2e7efb(0x155)](0x6)+_0x2e7efb(0x13e));}}}_0x180c1b===_0x2e7efb(0x116)&&(console[_0x2e7efb(0x18f)](_0x2e7efb(0x1e8)),_0x58f33a&&_0x58f33a>0x0?(_0x46be13=-_0x58f33a,_0x5be8f6-=_0x58f33a,console[_0x2e7efb(0x18f)]('💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x58f33a[_0x2e7efb(0x155)](0x6)+_0x2e7efb(0x15c)),console[_0x2e7efb(0x18f)]('💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console['log'](_0x2e7efb(0x1f0)),_0x434fea[_0x2e7efb(0xdf)]=_0x58f33a||0x0);_0x180c1b===_0x2e7efb(0x13d)&&_0x41124a===_0x2e7efb(0x158)&&console[_0x2e7efb(0x18f)](_0x2e7efb(0x1be));const _0x56c24a=await _0x5ce694[_0x2e7efb(0x216)][_0x2e7efb(0x1ff)]({'where':{'id':_0x315bcf},'data':_0x434fea,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x46be13!==0x0&&(await _0x5ce694[_0x2e7efb(0x1aa)][_0x2e7efb(0x1ff)]({'where':{'id':_0x4b92b5[_0x2e7efb(0x134)]},'data':{'balance':_0x5be8f6}}),console[_0x2e7efb(0x18f)](_0x2e7efb(0x196)+_0x4b92b5[_0x2e7efb(0x134)]+'\x20balance\x20updated:\x20'+_0x4b92b5[_0x2e7efb(0x1aa)][_0x2e7efb(0x12a)][_0x2e7efb(0x155)](0x6)+_0x2e7efb(0x1a9)+_0x5be8f6[_0x2e7efb(0x155)](0x6)+_0x2e7efb(0x1a4)+(_0x46be13>0x0?'+':'')+_0x46be13[_0x2e7efb(0x155)](0x6)+')')),_0x56c24a;});return{'id':_0x55ed94['id'],'shopId':_0x55ed94['shopId'],'gateway':_0x55ed94[_0x2a25f3(0x1b7)],'amount':_0x55ed94[_0x2a25f3(0xf0)],'currency':_0x55ed94[_0x2a25f3(0x208)],'status':_0x55ed94[_0x2a25f3(0x142)],'orderId':_0x55ed94[_0x2a25f3(0x120)],'gatewayOrderId':_0x55ed94[_0x2a25f3(0x166)],'customerEmail':_0x55ed94[_0x2a25f3(0xe1)],'customerName':_0x55ed94[_0x2a25f3(0xcd)],'customerCountry':_0x55ed94['customerCountry'],'customerIp':_0x55ed94['customerIp'],'customerUa':_0x55ed94['customerUa'],'failureMessage':_0x55ed94[_0x2a25f3(0x110)],'adminNotes':_0x55ed94[_0x2a25f3(0x188)],'chargebackAmount':_0x55ed94[_0x2a25f3(0xdf)],'statusChangedBy':_0x55ed94[_0x2a25f3(0x1a0)],'statusChangedAt':_0x55ed94['statusChangedAt'],'createdAt':_0x55ed94[_0x2a25f3(0x11c)],'updatedAt':_0x55ed94['updatedAt'],'shop':_0x55ed94[_0x2a25f3(0x1aa)]};}async[a40_0x2e7599(0x1dd)](_0x583e5a,_0x42b48f){const _0x5919eb=a40_0x2e7599,_0x39ac54=Math[_0x5919eb(0x202)]()['toString'](0x24)[_0x5919eb(0x1b4)](0x2,0x9);console[_0x5919eb(0x18f)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x39ac54+_0x5919eb(0x16b)+_0x583e5a);const _0x50b7e7={..._0x42b48f};_0x42b48f[_0x5919eb(0x214)]&&_0x42b48f[_0x5919eb(0x214)]['trim']()!==''?(console[_0x5919eb(0x18f)](_0x5919eb(0x133)+_0x39ac54+_0x5919eb(0xef)+_0x583e5a),_0x50b7e7[_0x5919eb(0x214)]=await bcryptjs_1[_0x5919eb(0xfa)][_0x5919eb(0x217)](_0x42b48f['password'],0xc)):(console[_0x5919eb(0x18f)](_0x5919eb(0x133)+_0x39ac54+_0x5919eb(0xd7)),delete _0x50b7e7[_0x5919eb(0x214)]);_0x42b48f[_0x5919eb(0x144)]&&(_0x50b7e7['name']=_0x42b48f['fullName'],delete _0x50b7e7[_0x5919eb(0x144)]);_0x42b48f['telegramId']&&(_0x50b7e7[_0x5919eb(0x14c)]=_0x42b48f['telegramId'],delete _0x50b7e7['telegramId']);_0x42b48f[_0x5919eb(0x1b1)]&&(_0x50b7e7['shopUrl']=_0x42b48f[_0x5919eb(0x1b1)],delete _0x50b7e7[_0x5919eb(0x1b1)]);if(_0x42b48f[_0x5919eb(0x172)]){const _0x1eae93=_0x42b48f[_0x5919eb(0x172)][_0x5919eb(0x171)](_0x2ba399=>this[_0x5919eb(0xec)](_0x2ba399));console['log']('🔄\x20Gateway\x20mapping:',_0x42b48f['gateways'],'->',_0x1eae93),_0x50b7e7[_0x5919eb(0x13b)]=JSON['stringify'](_0x1eae93),delete _0x50b7e7['gateways'];}_0x42b48f[_0x5919eb(0x167)]&&(console['log'](_0x5919eb(0x18e)+_0x39ac54+_0x5919eb(0x1e1),_0x42b48f[_0x5919eb(0x167)]),_0x50b7e7[_0x5919eb(0x167)]=JSON['stringify'](_0x42b48f[_0x5919eb(0x167)]),console[_0x5919eb(0x18f)](_0x5919eb(0x18e)+_0x39ac54+_0x5919eb(0x1f9),_0x50b7e7['gatewaySettings']));_0x42b48f[_0x5919eb(0x1de)]&&(_0x42b48f[_0x5919eb(0x1de)][_0x5919eb(0x1e2)]!==undefined&&(_0x50b7e7[_0x5919eb(0x1e2)]=_0x42b48f[_0x5919eb(0x1de)][_0x5919eb(0x1e2)]||null),_0x42b48f['wallets']['usdtTrcWallet']!==undefined&&(_0x50b7e7['usdtTrcWallet']=_0x42b48f[_0x5919eb(0x1de)]['usdtTrcWallet']||null),_0x42b48f['wallets'][_0x5919eb(0x1e5)]!==undefined&&(_0x50b7e7['usdtErcWallet']=_0x42b48f[_0x5919eb(0x1de)][_0x5919eb(0x1e5)]||null),_0x42b48f[_0x5919eb(0x1de)][_0x5919eb(0x152)]!==undefined&&(_0x50b7e7['usdcPolygonWallet']=_0x42b48f['wallets']['usdcPolygonWallet']||null),delete _0x50b7e7[_0x5919eb(0x1de)]);const _0x5343c4=await database_1[_0x5919eb(0xfa)][_0x5919eb(0x1aa)][_0x5919eb(0x1ff)]({'where':{'id':_0x583e5a},'data':_0x50b7e7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x5919eb(0x1fd)+_0x39ac54+_0x5919eb(0x1b9),_0x5343c4[_0x5919eb(0x167)]),{'id':_0x5343c4['id'],'fullName':_0x5343c4[_0x5919eb(0x1a5)],'username':_0x5343c4[_0x5919eb(0x194)],'telegramId':_0x5343c4[_0x5919eb(0x14c)],'merchantUrl':_0x5343c4['shopUrl'],'gateways':_0x5343c4['paymentGateways']?JSON[_0x5919eb(0x170)](_0x5343c4[_0x5919eb(0x13b)]):null,'gatewaySettings':_0x5343c4[_0x5919eb(0x167)]?JSON['parse'](_0x5343c4['gatewaySettings']):null,'publicKey':_0x5343c4[_0x5919eb(0x114)],'wallets':{'usdtPolygonWallet':_0x5343c4[_0x5919eb(0x1e2)],'usdtTrcWallet':_0x5343c4[_0x5919eb(0x215)],'usdtErcWallet':_0x5343c4['usdtErcWallet'],'usdcPolygonWallet':_0x5343c4[_0x5919eb(0x152)]},'status':_0x5343c4[_0x5919eb(0x142)],'createdAt':_0x5343c4[_0x5919eb(0x11c)]};}async['suspendUser'](_0x9f763c){const _0x220e5a=a40_0x2e7599,_0x5d3dfb=await database_1[_0x220e5a(0xfa)][_0x220e5a(0x1aa)]['update']({'where':{'id':_0x9f763c},'data':{'status':_0x220e5a(0x183)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d3dfb['id'],'fullName':_0x5d3dfb[_0x220e5a(0x1a5)],'username':_0x5d3dfb[_0x220e5a(0x194)],'telegramId':_0x5d3dfb['telegram'],'merchantUrl':_0x5d3dfb[_0x220e5a(0x1d4)],'gateways':_0x5d3dfb[_0x220e5a(0x13b)]?JSON[_0x220e5a(0x170)](_0x5d3dfb[_0x220e5a(0x13b)]):null,'gatewaySettings':_0x5d3dfb[_0x220e5a(0x167)]?JSON['parse'](_0x5d3dfb[_0x220e5a(0x167)]):null,'publicKey':_0x5d3dfb['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d3dfb['usdtPolygonWallet'],'usdtTrcWallet':_0x5d3dfb[_0x220e5a(0x215)],'usdtErcWallet':_0x5d3dfb[_0x220e5a(0x1e5)],'usdcPolygonWallet':_0x5d3dfb[_0x220e5a(0x152)]},'status':_0x5d3dfb[_0x220e5a(0x142)],'createdAt':_0x5d3dfb[_0x220e5a(0x11c)]};}async['activateUser'](_0x5c66fd){const _0x36c79a=a40_0x2e7599,_0x492734=await database_1['default'][_0x36c79a(0x1aa)][_0x36c79a(0x1ff)]({'where':{'id':_0x5c66fd},'data':{'status':_0x36c79a(0x1a3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x492734['id'],'fullName':_0x492734[_0x36c79a(0x1a5)],'username':_0x492734['username'],'telegramId':_0x492734[_0x36c79a(0x14c)],'merchantUrl':_0x492734[_0x36c79a(0x1d4)],'gateways':_0x492734[_0x36c79a(0x13b)]?JSON[_0x36c79a(0x170)](_0x492734[_0x36c79a(0x13b)]):null,'gatewaySettings':_0x492734[_0x36c79a(0x167)]?JSON[_0x36c79a(0x170)](_0x492734['gatewaySettings']):null,'publicKey':_0x492734[_0x36c79a(0x114)],'wallets':{'usdtPolygonWallet':_0x492734[_0x36c79a(0x1e2)],'usdtTrcWallet':_0x492734[_0x36c79a(0x215)],'usdtErcWallet':_0x492734[_0x36c79a(0x1e5)],'usdcPolygonWallet':_0x492734[_0x36c79a(0x152)]},'status':_0x492734['status'],'createdAt':_0x492734[_0x36c79a(0x11c)]};}async['getAllUsers'](_0x5d25ec){const _0x5c91cc=a40_0x2e7599,{page:_0x111b97,limit:_0x4d8aa4,status:_0x317ace}=_0x5d25ec,_0x4f6f98=(_0x111b97-0x1)*_0x4d8aa4,_0x12e789={};_0x317ace&&(_0x12e789[_0x5c91cc(0x142)]=_0x317ace[_0x5c91cc(0xe8)]());const [_0x4e2a81,_0x574e46]=await Promise['all']([database_1[_0x5c91cc(0xfa)][_0x5c91cc(0x1aa)][_0x5c91cc(0x1ed)]({'where':_0x12e789,'skip':_0x4f6f98,'take':_0x4d8aa4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5c91cc(0xfa)][_0x5c91cc(0x1aa)][_0x5c91cc(0x1d8)]({'where':_0x12e789})]);return{'users':_0x4e2a81['map'](_0x358bbb=>{const _0x36eab8=_0x5c91cc,_0x31cc0a=_0x358bbb[_0x36eab8(0x13b)]?JSON[_0x36eab8(0x170)](_0x358bbb[_0x36eab8(0x13b)]):null,_0x477b2f=_0x31cc0a?_0x31cc0a[_0x36eab8(0x171)](_0x27ad57=>this[_0x36eab8(0x189)](_0x27ad57)):null;return{'id':_0x358bbb['id'],'fullName':_0x358bbb[_0x36eab8(0x1a5)],'username':_0x358bbb[_0x36eab8(0x194)],'telegramId':_0x358bbb['telegram'],'merchantUrl':_0x358bbb[_0x36eab8(0x1d4)],'gateways':_0x477b2f,'gatewaySettings':_0x358bbb[_0x36eab8(0x167)]?JSON[_0x36eab8(0x170)](_0x358bbb[_0x36eab8(0x167)]):null,'publicKey':_0x358bbb['publicKey'],'wallets':{'usdtPolygonWallet':_0x358bbb['usdtPolygonWallet'],'usdtTrcWallet':_0x358bbb[_0x36eab8(0x215)],'usdtErcWallet':_0x358bbb[_0x36eab8(0x1e5)],'usdcPolygonWallet':_0x358bbb[_0x36eab8(0x152)]},'status':_0x358bbb['status'],'createdAt':_0x358bbb['createdAt']};}),'pagination':{'page':_0x111b97,'limit':_0x4d8aa4,'total':_0x574e46,'totalPages':Math['ceil'](_0x574e46/_0x4d8aa4)}};}async[a40_0x2e7599(0xc9)](_0x1a350d){const _0x4a281d=a40_0x2e7599,_0x4a790d=await database_1['default'][_0x4a281d(0x1aa)][_0x4a281d(0x1b0)]({'where':{'id':_0x1a350d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4a790d)return null;const _0x2ccab2=_0x4a790d[_0x4a281d(0x13b)]?JSON[_0x4a281d(0x170)](_0x4a790d[_0x4a281d(0x13b)]):null,_0x45d5d1=_0x2ccab2?_0x2ccab2[_0x4a281d(0x171)](_0x9d5dbf=>this[_0x4a281d(0x189)](_0x9d5dbf)):null;return _0x2ccab2&&_0x45d5d1&&console[_0x4a281d(0x18f)](_0x4a281d(0x10c),_0x2ccab2,'->',_0x45d5d1),{'id':_0x4a790d['id'],'fullName':_0x4a790d[_0x4a281d(0x1a5)],'username':_0x4a790d[_0x4a281d(0x194)],'telegramId':_0x4a790d['telegram'],'merchantUrl':_0x4a790d['shopUrl'],'gateways':_0x45d5d1,'gatewaySettings':_0x4a790d[_0x4a281d(0x167)]?JSON[_0x4a281d(0x170)](_0x4a790d[_0x4a281d(0x167)]):null,'publicKey':_0x4a790d['publicKey'],'wallets':{'usdtPolygonWallet':_0x4a790d[_0x4a281d(0x1e2)],'usdtTrcWallet':_0x4a790d[_0x4a281d(0x215)],'usdtErcWallet':_0x4a790d[_0x4a281d(0x1e5)],'usdcPolygonWallet':_0x4a790d[_0x4a281d(0x152)]},'status':_0x4a790d[_0x4a281d(0x142)],'createdAt':_0x4a790d['createdAt']};}async[a40_0x2e7599(0x154)](_0x46a2e4){const _0x222374=a40_0x2e7599,{fullName:_0x244ace,username:_0x5a41e9,password:_0x205c95,telegramId:_0x5ca678,merchantUrl:_0x2c0e47,gateways:_0x2e0c29,gatewaySettings:_0x4c8576,wallets:_0x2b5f46}=_0x46a2e4,_0x54873b=await database_1[_0x222374(0xfa)]['shop'][_0x222374(0x1b0)]({'where':{'username':_0x5a41e9}});if(_0x54873b)throw new Error(_0x222374(0xd1));if(_0x5ca678){const _0x41f12d=await database_1[_0x222374(0xfa)][_0x222374(0x1aa)][_0x222374(0x1b0)]({'where':{'telegram':_0x5ca678}});if(_0x41f12d)throw new Error(_0x222374(0x1a1));}const _0x2a2089=await bcryptjs_1[_0x222374(0xfa)]['hash'](_0x205c95,0xc),_0x2bcb07=_0x222374(0xff)+crypto_1[_0x222374(0xfa)][_0x222374(0x1cc)](0x20)[_0x222374(0xd5)]('hex'),_0x25c4b2=_0x222374(0x1dc)+crypto_1[_0x222374(0xfa)][_0x222374(0x1cc)](0x20)[_0x222374(0xd5)](_0x222374(0x21f)),_0x24d557=_0x2e0c29?_0x2e0c29[_0x222374(0x171)](_0x4c2ade=>this[_0x222374(0xec)](_0x4c2ade)):null;_0x2e0c29&&_0x24d557&&console[_0x222374(0x18f)](_0x222374(0x101),_0x2e0c29,'->',_0x24d557);const _0x54a043=await database_1[_0x222374(0xfa)][_0x222374(0x1aa)]['create']({'data':{'name':_0x244ace,'username':_0x5a41e9,'password':_0x2a2089,'telegram':_0x5ca678,'shopUrl':_0x2c0e47,'paymentGateways':_0x24d557?JSON[_0x222374(0xf7)](_0x24d557):null,'gatewaySettings':_0x4c8576?JSON[_0x222374(0xf7)](_0x4c8576):null,'usdtPolygonWallet':_0x2b5f46?.[_0x222374(0x1e2)]||null,'usdtTrcWallet':_0x2b5f46?.[_0x222374(0x215)]||null,'usdtErcWallet':_0x2b5f46?.[_0x222374(0x1e5)]||null,'usdcPolygonWallet':_0x2b5f46?.[_0x222374(0x152)]||null,'publicKey':_0x2bcb07,'secretKey':_0x25c4b2,'status':_0x222374(0x1a3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x54a043['id'],'fullName':_0x54a043['name'],'username':_0x54a043['username'],'telegramId':_0x54a043[_0x222374(0x14c)],'merchantUrl':_0x54a043[_0x222374(0x1d4)],'gateways':_0x54a043[_0x222374(0x13b)]?JSON[_0x222374(0x170)](_0x54a043[_0x222374(0x13b)]):null,'gatewaySettings':_0x54a043['gatewaySettings']?JSON['parse'](_0x54a043[_0x222374(0x167)]):null,'publicKey':_0x54a043[_0x222374(0x114)],'wallets':{'usdtPolygonWallet':_0x54a043['usdtPolygonWallet'],'usdtTrcWallet':_0x54a043[_0x222374(0x215)],'usdtErcWallet':_0x54a043[_0x222374(0x1e5)],'usdcPolygonWallet':_0x54a043[_0x222374(0x152)]},'status':_0x54a043[_0x222374(0x142)],'createdAt':_0x54a043[_0x222374(0x11c)]};}async[a40_0x2e7599(0xdb)](_0xa87a34){const _0x10ef0c=a40_0x2e7599;await database_1[_0x10ef0c(0xfa)][_0x10ef0c(0x1aa)][_0x10ef0c(0x1f4)]({'where':{'id':_0xa87a34}});}['generateDailyStatistics'](_0x156f6e,_0x47ff3f,_0x3fb746){const _0x93fe30=a40_0x2e7599,_0x41b87c=new Map(),_0x2a0b5b=new Date(_0x47ff3f);while(_0x2a0b5b<=_0x3fb746){const _0x28ff84=_0x2a0b5b['toISOString']()['split']('T')[0x0];_0x41b87c[_0x93fe30(0x127)](_0x28ff84,{'revenue':0x0,'count':0x0}),_0x2a0b5b[_0x93fe30(0x1d1)](_0x2a0b5b[_0x93fe30(0x18a)]()+0x1);}for(const _0x87d2a9 of _0x156f6e){const _0x65c4b7=_0x87d2a9[_0x93fe30(0x11c)][_0x93fe30(0x184)]()[_0x93fe30(0x1a8)]('T')[0x0],_0x22139c=_0x41b87c['get'](_0x65c4b7);_0x22139c&&(_0x22139c['count']+=0x1,_0x87d2a9[_0x93fe30(0x142)]===_0x93fe30(0x158)&&(_0x87d2a9[_0x93fe30(0xf1)]?_0x22139c[_0x93fe30(0x124)]+=_0x87d2a9[_0x93fe30(0xf1)]:console['log'](_0x93fe30(0xce)+_0x87d2a9['id']+_0x93fe30(0x17d))));}const _0x1eb859=[],_0x35d0e9=[];for(const [_0x3066f2,_0x17858e]of _0x41b87c){_0x1eb859[_0x93fe30(0x1ad)]({'date':_0x3066f2,'amount':Math[_0x93fe30(0x1db)](_0x17858e[_0x93fe30(0x124)]*0x64)/0x64}),_0x35d0e9[_0x93fe30(0x1ad)]({'date':_0x3066f2,'count':_0x17858e['count']});}return{'dailyRevenue':_0x1eb859,'dailyPayments':_0x35d0e9};}}exports[a40_0x2e7599(0x1c3)]=AdminService;