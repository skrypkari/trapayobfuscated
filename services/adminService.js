'use strict';const a33_0x18eeb0=a33_0x2a05;(function(_0x36a43b,_0x28c363){const _0x2b1383=a33_0x2a05,_0x22043f=_0x36a43b();while(!![]){try{const _0x2bc255=parseInt(_0x2b1383(0x249))/0x1+-parseInt(_0x2b1383(0x1f4))/0x2*(parseInt(_0x2b1383(0x246))/0x3)+parseInt(_0x2b1383(0x20f))/0x4*(parseInt(_0x2b1383(0x182))/0x5)+parseInt(_0x2b1383(0x223))/0x6+-parseInt(_0x2b1383(0x1d9))/0x7*(parseInt(_0x2b1383(0x1f1))/0x8)+-parseInt(_0x2b1383(0x1d2))/0x9+parseInt(_0x2b1383(0x193))/0xa;if(_0x2bc255===_0x28c363)break;else _0x22043f['push'](_0x22043f['shift']());}catch(_0x391d86){_0x22043f['push'](_0x22043f['shift']());}}}(a33_0x43e0,0x33c68));var __importDefault=this&&this[a33_0x18eeb0(0x1ec)]||function(_0xca85c5){return _0xca85c5&&_0xca85c5['__esModule']?_0xca85c5:{'default':_0xca85c5};};Object[a33_0x18eeb0(0x1e5)](exports,a33_0x18eeb0(0x1a9),{'value':!![]}),exports[a33_0x18eeb0(0x239)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require('./currencyService'),userService_1=require(a33_0x18eeb0(0x1b8)),telegramBotService_1=require(a33_0x18eeb0(0x20e)),gateway_1=require('../types/gateway');function a33_0x2a05(_0x3f6e6d,_0x4d6d12){const _0x43e005=a33_0x43e0();return a33_0x2a05=function(_0x2a0516,_0x700f77){_0x2a0516=_0x2a0516-0x17a;let _0x5b93a2=_0x43e005[_0x2a0516];return _0x5b93a2;},a33_0x2a05(_0x3f6e6d,_0x4d6d12);}function a33_0x43e0(){const _0x11998a=['320644ZTVQPr','‚úÖ\x20User\x20','findMany','PAID','remitterIban','üìä\x20Calculating\x20admin\x20payout\x20statistics...','üë•\x20Total\x20users:\x20','all','name','\x20USDT\x20via\x20','payoutDelay','setDate','statusChangedAt','convertToUSDT','5rujOCB','usage','getPeriodDays','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','notes','\x20status\x20to:\x20','insensitive','\x20USDT\x20(penalty\x20amount)','üíµ\x20Total\x20revenue:\x20','desc','\x20days','sourceCurrency','gte','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','payout','\x20USDT','getTime','473070poemCo','Payout\x20not\x20found','getAllPayments','usdtTrcWallet','toLowerCase','‚úÖ\x20Marked\x20','üìã\x20Getting\x20payments\x20with\x20filters:','totalAmountAfterCommissionUSDT','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','error','join','findUnique','üîç\x20Getting\x20payment\x20by\x20ID:\x20','customerName','‚è≥\x20Awaiting\x20Payout:\x20','getFullYear','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','User\x20not\x20found','map','userService','ACTIVE','sendPayoutNotification','__esModule','UserService','generateDateRange','shopUrl','getAllPayouts','toFixed','activateUser','payment','‚ùå\x20Payout\x20not\x20found:\x20','\x20USDT\x20(','updateUser','üí∏\x20Chargeback\x20penalty:\x20','üìÖ\x20This\x20Month:\x20','merchantPaid','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','./userService','üö´\x20Suspending\x20user:\x20','txid','calculateAmountAfterCommission','üí∞\x20Found\x20','updateMany','log','paymentGateways','üè™\x20Found\x20','completed','push','gatewaySettings','date','üí∞\x20Available\x20Balance:\x20','bankId','remitterName','‚úÖ\x20Returning\x20','getPayoutById','\x20USDT\x20after\x20commission)','‚ùå\x20Payment\x20not\x20found:\x20','telegram','gatewayOrderId','stringify','webhookLogs','\x20suspended\x20successfully','üí∏\x20Total\x20Payout:\x20','93798miqSYk','CHARGEBACK','abs','amount','getGatewaySettings','get','updatePaymentStatus','91StFhoA','\x20days)','\x20payouts\x20out\x20of\x20','FAILED','gateway','parse','count','REFUND','telegramBotService','Payment\x20not\x20found','totalAmountUSDT','create','defineProperty','markPaymentsAsPaidOut','Invalid\x20status.\x20Valid\x20statuses:\x20','COMPLETED','network','expiresAt','getAllUsers','__importDefault','sort','isValidGatewayId','ceil','createUser','72008FiItMK','‚úÖ\x20Payout\x20created\x20successfully:\x20','adminNotes','2102hDpzFt','\x20deleted\x20successfully','split','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','üìã\x20Getting\x20payouts\x20with\x20filters:','lte','slice','getMonth','status','usdtPolygonWallet','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','orderId','from','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','externalPaymentUrl','getMerchantsAwaitingPayout','amountUSDT','status_update','getPaymentById','round','deleteUser','username','set','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','\x20to\x20','./telegramBotService','185228gEnEGq','availableBalance','Error\x20parsing\x20gateway\x20settings:','paidAt','getSystemStatistics','‚úÖ\x20Payment\x20','calculateEffectiveAmount','getDate','webhookLog','amountAfterCommissionUSDT','asc','default','updatedAt','usdcPolygonWallet','\x20payments\x20as\x20paid\x20out','currency','currencyService','SUSPENDED','length','\x20status\x20updated\x20from\x20','1664004SvhaqX','PROCESSING','getPayoutStats','reduce','createdAt','delete','\x20payments\x20out\x20of\x20','isEligibleForPayout','üí∏\x20Creating\x20payout\x20for\x20shop\x20','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','getGatewayNameById','üìä\x20Found\x20','PENDING','payments','üí∞\x20Total\x20amount:\x20','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','statusChangedBy','commission','üí∏\x20Chargeback\x20amount:\x20','\x20merchants\x20out\x20of\x20','shopId','getUserById','AdminService','has','shop','paymentMethod','chargebackAmount',',\x20amount:\x20','toISOString','customerEmail','\x20users\x20out\x20of\x20','\x20total','gatewayPaymentId','‚úÖ\x20Payout\x20statistics\x20calculated:','includes','1005WrNrBe','cardLast4','toUpperCase'];a33_0x43e0=function(){return _0x11998a;};return a33_0x43e0();}class AdminService{constructor(){const _0x572d93=a33_0x18eeb0;this[_0x572d93(0x1a6)]=new userService_1[(_0x572d93(0x1aa))]();}[a33_0x18eeb0(0x184)](_0xc71dc9){switch(_0xc71dc9){case'7d':return 0x7;case'30d':return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x18eeb0(0x1ab)](_0xb3fadc,_0x20802e){const _0x19bc56=a33_0x18eeb0,_0x3fa948=[],_0x33bd4d=new Date(_0xb3fadc);while(_0x33bd4d<=_0x20802e){_0x3fa948['push'](_0x33bd4d[_0x19bc56(0x23f)]()[_0x19bc56(0x1f6)]('T')[0x0]),_0x33bd4d[_0x19bc56(0x17f)](_0x33bd4d['getDate']()+0x1);}return _0x3fa948;}[a33_0x18eeb0(0x1d6)](_0x17c93a,_0x42b344){const _0x1c58a7=a33_0x18eeb0;if(!_0x17c93a['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x534c66=JSON['parse'](_0x17c93a[_0x1c58a7(0x1c3)]),_0x74357b=_0x42b344['charAt'](0x0)[_0x1c58a7(0x248)]()+_0x42b344[_0x1c58a7(0x1fb)](0x1)[_0x1c58a7(0x197)]();if(_0x534c66&&_0x534c66[_0x74357b])return{'commission':_0x534c66[_0x74357b][_0x1c58a7(0x234)]||0x0,'payoutDelay':_0x534c66[_0x74357b][_0x1c58a7(0x17e)]||0x0};}catch(_0x1eb45d){console[_0x1c58a7(0x19c)](_0x1c58a7(0x211),_0x1eb45d);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x18eeb0(0x22a)](_0x4930e5){const _0x1a81e5=a33_0x18eeb0;if(_0x4930e5[_0x1a81e5(0x1fd)]!==_0x1a81e5(0x24c)||_0x4930e5[_0x1a81e5(0x1b6)]||!_0x4930e5['paidAt'])return![];const _0x5bd679=this[_0x1a81e5(0x1d6)](_0x4930e5[_0x1a81e5(0x23b)],_0x4930e5[_0x1a81e5(0x1dd)]),_0x21f662=_0x5bd679[_0x1a81e5(0x17e)]*0x18*0x3c*0x3c*0x3e8,_0x3fa703=new Date(_0x4930e5[_0x1a81e5(0x212)][_0x1a81e5(0x192)]()+_0x21f662);return new Date()>_0x3fa703;}[a33_0x18eeb0(0x1bb)](_0x3fcd7b,_0x290b04){return _0x3fcd7b*(0x1-_0x290b04/0x64);}[a33_0x18eeb0(0x215)](_0x12db1c){const _0x35cc4e=a33_0x18eeb0;switch(_0x12db1c[_0x35cc4e(0x1fd)]){case _0x35cc4e(0x24c):return _0x12db1c['amount'];case _0x35cc4e(0x1d3):return-(_0x12db1c[_0x35cc4e(0x23d)]||0x0);case'REFUND':return 0x0;default:return 0x0;}}async['createPayout'](_0x301737){const _0x3e5439=a33_0x18eeb0,{shopId:_0x263cb6,amount:_0x1011b8,network:_0x539bf9,notes:_0x385aff}=_0x301737;console[_0x3e5439(0x1be)](_0x3e5439(0x22b)+_0x263cb6+':\x20'+_0x1011b8+_0x3e5439(0x17d)+_0x539bf9);const _0x4f2e30=await database_1[_0x3e5439(0x21a)][_0x3e5439(0x23b)]['findUnique']({'where':{'id':_0x263cb6},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x4f2e30)throw new Error('Shop\x20not\x20found');if(_0x4f2e30[_0x3e5439(0x1fd)]!==_0x3e5439(0x1a7))throw new Error('Shop\x20is\x20not\x20active');const _0x256a62=await database_1[_0x3e5439(0x21a)]['payout'][_0x3e5439(0x1e4)]({'data':{'shopId':_0x263cb6,'amount':_0x1011b8,'network':_0x539bf9,'status':_0x3e5439(0x1e8),'notes':_0x385aff||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this['markPaymentsAsPaidOut'](_0x263cb6,_0x1011b8);try{await telegramBotService_1[_0x3e5439(0x1e1)][_0x3e5439(0x1a8)](_0x263cb6,_0x256a62,_0x3e5439(0x1c1));}catch(_0x2fa3a3){console[_0x3e5439(0x19c)](_0x3e5439(0x1b7),_0x2fa3a3);}return console[_0x3e5439(0x1be)](_0x3e5439(0x1f2)+_0x256a62['id']),{'id':_0x256a62['id'],'shopId':_0x256a62[_0x3e5439(0x237)],'shopName':_0x256a62[_0x3e5439(0x23b)][_0x3e5439(0x17c)],'shopUsername':_0x256a62['shop'][_0x3e5439(0x20a)],'amount':_0x256a62[_0x3e5439(0x1d5)],'network':_0x256a62[_0x3e5439(0x1e9)],'status':_0x256a62[_0x3e5439(0x1fd)],'txid':_0x256a62[_0x3e5439(0x1ba)],'notes':_0x256a62[_0x3e5439(0x186)],'createdAt':_0x256a62['createdAt'],'paidAt':_0x256a62[_0x3e5439(0x212)]};}async[a33_0x18eeb0(0x1e6)](_0x5177e6,_0x32c3fb){const _0x8c5772=a33_0x18eeb0;console[_0x8c5772(0x1be)](_0x8c5772(0x22c)+_0x5177e6+_0x8c5772(0x23e)+_0x32c3fb+_0x8c5772(0x191));const _0x31cb7a=await database_1[_0x8c5772(0x21a)][_0x8c5772(0x1b0)][_0x8c5772(0x24b)]({'where':{'shopId':_0x5177e6,'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x8c5772(0x219)}});let _0x3dd798=_0x32c3fb;const _0x4ee52a=[];for(const _0x212fd4 of _0x31cb7a){const _0x2a1bfa={..._0x212fd4,'status':_0x8c5772(0x24c),'merchantPaid':![],'shop':{'gatewaySettings':_0x212fd4['shop'][_0x8c5772(0x1c3)]}};if(!this[_0x8c5772(0x22a)](_0x2a1bfa))continue;const _0xc5b6dc=await currencyService_1['currencyService'][_0x8c5772(0x181)](_0x212fd4[_0x8c5772(0x1d5)],_0x212fd4[_0x8c5772(0x21e)]),_0x5417bf=this[_0x8c5772(0x1d6)](_0x212fd4[_0x8c5772(0x23b)],_0x212fd4[_0x8c5772(0x1dd)]),_0x40eb99=this[_0x8c5772(0x1bb)](_0xc5b6dc,_0x5417bf[_0x8c5772(0x234)]);if(_0x40eb99<=_0x3dd798){_0x4ee52a[_0x8c5772(0x1c2)](_0x212fd4['id']),_0x3dd798-=_0x40eb99;if(_0x3dd798<=0.01)break;}}_0x4ee52a[_0x8c5772(0x221)]>0x0&&(await database_1['default'][_0x8c5772(0x1b0)][_0x8c5772(0x1bd)]({'where':{'id':{'in':_0x4ee52a}},'data':{'merchantPaid':!![]}}),console[_0x8c5772(0x1be)](_0x8c5772(0x198)+_0x4ee52a[_0x8c5772(0x221)]+_0x8c5772(0x21d)));}async[a33_0x18eeb0(0x1ad)](_0x46b486){const _0x14e5d0=a33_0x18eeb0,{page:_0xa5ed9e,limit:_0x3eb146,shopId:_0x3d540d,network:_0x3083ca,dateFrom:_0x3a897f,dateTo:_0x30375a,search:_0x511292}=_0x46b486,_0x221404=(_0xa5ed9e-0x1)*_0x3eb146;console[_0x14e5d0(0x1be)](_0x14e5d0(0x1f9),_0x46b486);const _0x71d3b5={};_0x3d540d&&(_0x71d3b5[_0x14e5d0(0x237)]=_0x3d540d);_0x3083ca&&(_0x71d3b5[_0x14e5d0(0x1e9)]=_0x3083ca);(_0x3a897f||_0x30375a)&&(_0x71d3b5[_0x14e5d0(0x227)]={},_0x3a897f&&(_0x71d3b5[_0x14e5d0(0x227)][_0x14e5d0(0x18e)]=new Date(_0x3a897f)),_0x30375a&&(_0x71d3b5[_0x14e5d0(0x227)][_0x14e5d0(0x1fa)]=new Date(_0x30375a)));_0x511292&&(_0x71d3b5['OR']=[{'txid':{'contains':_0x511292,'mode':_0x14e5d0(0x188)}},{'notes':{'contains':_0x511292,'mode':_0x14e5d0(0x188)}},{'shop':{'name':{'contains':_0x511292,'mode':_0x14e5d0(0x188)}}},{'shop':{'username':{'contains':_0x511292,'mode':_0x14e5d0(0x188)}}}]);const [_0x527ae5,_0x23e58f]=await Promise['all']([database_1[_0x14e5d0(0x21a)][_0x14e5d0(0x190)]['findMany']({'where':_0x71d3b5,'skip':_0x221404,'take':_0x3eb146,'orderBy':{'createdAt':_0x14e5d0(0x18b)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x14e5d0(0x21a)][_0x14e5d0(0x190)]['count']({'where':_0x71d3b5})]);console[_0x14e5d0(0x1be)]('üìä\x20Found\x20'+_0x527ae5[_0x14e5d0(0x221)]+_0x14e5d0(0x1db)+_0x23e58f+_0x14e5d0(0x242));const _0x2eee49=_0x527ae5['map'](_0x1db3f5=>({'id':_0x1db3f5['id'],'shopId':_0x1db3f5['shopId'],'shopName':_0x1db3f5[_0x14e5d0(0x23b)][_0x14e5d0(0x17c)],'shopUsername':_0x1db3f5[_0x14e5d0(0x23b)][_0x14e5d0(0x20a)],'amount':_0x1db3f5[_0x14e5d0(0x1d5)],'network':_0x1db3f5['network'],'status':_0x1db3f5[_0x14e5d0(0x1fd)],'txid':_0x1db3f5['txid'],'notes':_0x1db3f5[_0x14e5d0(0x186)],'createdAt':_0x1db3f5['createdAt'],'paidAt':_0x1db3f5[_0x14e5d0(0x212)]}));return{'payouts':_0x2eee49,'pagination':{'page':_0xa5ed9e,'limit':_0x3eb146,'total':_0x23e58f,'totalPages':Math[_0x14e5d0(0x1ef)](_0x23e58f/_0x3eb146)}};}async[a33_0x18eeb0(0x1c9)](_0x26267c){const _0x29852b=a33_0x18eeb0;console[_0x29852b(0x1be)]('üîç\x20Getting\x20payout\x20by\x20ID:\x20'+_0x26267c);const _0x33e35b=await database_1[_0x29852b(0x21a)][_0x29852b(0x190)]['findUnique']({'where':{'id':_0x26267c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x33e35b)return console[_0x29852b(0x1be)](_0x29852b(0x1b1)+_0x26267c),null;return console['log']('‚úÖ\x20Found\x20payout:\x20'+_0x33e35b['amount']+'\x20USDT\x20via\x20'+_0x33e35b[_0x29852b(0x1e9)]),{'id':_0x33e35b['id'],'shopId':_0x33e35b[_0x29852b(0x237)],'shopName':_0x33e35b[_0x29852b(0x23b)][_0x29852b(0x17c)],'shopUsername':_0x33e35b[_0x29852b(0x23b)][_0x29852b(0x20a)],'amount':_0x33e35b[_0x29852b(0x1d5)],'network':_0x33e35b[_0x29852b(0x1e9)],'status':_0x33e35b[_0x29852b(0x1fd)],'txid':_0x33e35b[_0x29852b(0x1ba)],'notes':_0x33e35b[_0x29852b(0x186)],'createdAt':_0x33e35b['createdAt'],'paidAt':_0x33e35b[_0x29852b(0x212)]};}async['deletePayout'](_0x21a10a){const _0x4bec95=a33_0x18eeb0;console['log']('üóëÔ∏è\x20Deleting\x20payout:\x20'+_0x21a10a);const _0x591b09=await database_1['default'][_0x4bec95(0x190)][_0x4bec95(0x19e)]({'where':{'id':_0x21a10a},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x591b09)throw new Error(_0x4bec95(0x194));await database_1[_0x4bec95(0x21a)][_0x4bec95(0x190)][_0x4bec95(0x228)]({'where':{'id':_0x21a10a}}),console['log']('‚úÖ\x20Payout\x20'+_0x21a10a+_0x4bec95(0x1f5));}async[a33_0x18eeb0(0x204)](_0x4d2c89){const _0x45f9b5=a33_0x18eeb0,{page:_0x5c61a9,limit:_0x3ab24b,minAmount:_0x6b661,search:_0x315592}=_0x4d2c89;console[_0x45f9b5(0x1be)](_0x45f9b5(0x202),_0x4d2c89);const _0x7f4044=await database_1['default'][_0x45f9b5(0x1b0)][_0x45f9b5(0x24b)]({'where':{'status':_0x45f9b5(0x24c),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x45f9b5(0x1be)](_0x45f9b5(0x1bc)+_0x7f4044[_0x45f9b5(0x221)]+_0x45f9b5(0x20c));const _0x1d7e23=new Map();for(const _0x63f99c of _0x7f4044){const _0x4097e4={..._0x63f99c,'status':_0x45f9b5(0x24c),'merchantPaid':![],'shop':{'gatewaySettings':_0x63f99c[_0x45f9b5(0x23b)][_0x45f9b5(0x1c3)]}},_0x55eb03=this['isEligibleForPayout'](_0x4097e4);if(!_0x55eb03)continue;const _0x50771d=await currencyService_1[_0x45f9b5(0x21f)][_0x45f9b5(0x181)](_0x63f99c['amount'],_0x63f99c[_0x45f9b5(0x21e)]),_0x11be99=this['getGatewaySettings'](_0x63f99c['shop'],_0x63f99c[_0x45f9b5(0x1dd)]),_0x17b63a=this[_0x45f9b5(0x1bb)](_0x50771d,_0x11be99[_0x45f9b5(0x234)]),_0x7f696f=_0x63f99c[_0x45f9b5(0x237)];!_0x1d7e23[_0x45f9b5(0x23a)](_0x7f696f)&&_0x1d7e23[_0x45f9b5(0x20b)](_0x7f696f,{'shop':_0x63f99c[_0x45f9b5(0x23b)],'payments':[]}),_0x1d7e23[_0x45f9b5(0x1d7)](_0x7f696f)[_0x45f9b5(0x230)][_0x45f9b5(0x1c2)]({'id':_0x63f99c['id'],'amount':_0x63f99c[_0x45f9b5(0x1d5)],'currency':_0x63f99c['currency'],'gateway':_0x63f99c[_0x45f9b5(0x1dd)],'paidAt':_0x63f99c[_0x45f9b5(0x212)],'createdAt':_0x63f99c['createdAt'],'amountUSDT':_0x50771d,'commission':_0x11be99[_0x45f9b5(0x234)],'amountAfterCommissionUSDT':_0x17b63a,'isEligible':!![]});}console[_0x45f9b5(0x1be)](_0x45f9b5(0x1c0)+_0x1d7e23['size']+'\x20merchants\x20with\x20eligible\x20PAID\x20payments');const _0x199fe3=[];for(const [_0x27b4bf,_0x15676e]of _0x1d7e23){const {shop:_0x521c86,payments:_0x10f1f7}=_0x15676e,_0x477340=_0x10f1f7[_0x45f9b5(0x226)]((_0x1fe2bd,_0x25301c)=>_0x1fe2bd+_0x25301c[_0x45f9b5(0x205)],0x0),_0x10ae3c=_0x10f1f7[_0x45f9b5(0x226)]((_0x2aa71a,_0x24fc3a)=>_0x2aa71a+_0x24fc3a[_0x45f9b5(0x218)],0x0);if(_0x6b661&&_0x10ae3c<_0x6b661)continue;if(_0x315592){const _0x1cf67a=_0x315592[_0x45f9b5(0x197)](),_0x68ddb3=_0x521c86['name'][_0x45f9b5(0x197)]()[_0x45f9b5(0x245)](_0x1cf67a)||_0x521c86['username']['toLowerCase']()[_0x45f9b5(0x245)](_0x1cf67a)||_0x521c86[_0x45f9b5(0x1cc)]&&_0x521c86[_0x45f9b5(0x1cc)][_0x45f9b5(0x197)]()[_0x45f9b5(0x245)](_0x1cf67a);if(!_0x68ddb3)continue;}const _0x224d4=new Map();for(const _0x2639d0 of _0x10f1f7){const _0x28e36b=_0x2639d0[_0x45f9b5(0x1dd)];!_0x224d4['has'](_0x28e36b)&&_0x224d4['set'](_0x28e36b,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x2639d0[_0x45f9b5(0x234)]});const _0x41dc0d=_0x224d4[_0x45f9b5(0x1d7)](_0x28e36b);_0x41dc0d['count']++,_0x41dc0d['amountUSDT']+=_0x2639d0['amountUSDT'],_0x41dc0d[_0x45f9b5(0x218)]+=_0x2639d0[_0x45f9b5(0x218)];}const _0x480f9b=Array[_0x45f9b5(0x201)](_0x224d4['entries']())[_0x45f9b5(0x1a5)](([_0x45607b,_0x384335])=>({'gateway':_0x45607b['charAt'](0x0)[_0x45f9b5(0x248)]()+_0x45607b[_0x45f9b5(0x1fb)](0x1),'count':_0x384335[_0x45f9b5(0x1df)],'amountUSDT':Math['round'](_0x384335[_0x45f9b5(0x205)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x384335[_0x45f9b5(0x218)]*0x64)/0x64,'commission':_0x384335[_0x45f9b5(0x234)]})),_0x169d5a=_0x10f1f7[_0x45f9b5(0x226)]((_0x522258,_0x4f2182)=>{return _0x4f2182['paidAt']<_0x522258?_0x4f2182['paidAt']:_0x522258;},_0x10f1f7[0x0]['paidAt']);_0x199fe3[_0x45f9b5(0x1c2)]({'id':_0x521c86['id'],'fullName':_0x521c86[_0x45f9b5(0x17c)],'username':_0x521c86[_0x45f9b5(0x20a)],'telegramId':_0x521c86[_0x45f9b5(0x1cc)],'merchantUrl':_0x521c86[_0x45f9b5(0x1ac)],'wallets':{'usdtPolygonWallet':_0x521c86[_0x45f9b5(0x1fe)],'usdtTrcWallet':_0x521c86[_0x45f9b5(0x196)],'usdtErcWallet':_0x521c86['usdtErcWallet'],'usdcPolygonWallet':_0x521c86[_0x45f9b5(0x21c)]},'totalAmountUSDT':Math['round'](_0x477340*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x45f9b5(0x208)](_0x10ae3c*0x64)/0x64,'paymentsCount':_0x10f1f7[_0x45f9b5(0x221)],'oldestPaymentDate':_0x169d5a,'gatewayBreakdown':_0x480f9b});}_0x199fe3[_0x45f9b5(0x1ed)]((_0xf8871,_0x333b98)=>_0x333b98[_0x45f9b5(0x19a)]-_0xf8871[_0x45f9b5(0x19a)]);const _0x43e701=_0x199fe3[_0x45f9b5(0x221)],_0x5ed72a=_0x199fe3[_0x45f9b5(0x226)]((_0x439e81,_0x41e78f)=>_0x439e81+_0x41e78f[_0x45f9b5(0x1e3)],0x0),_0xfe01df=_0x199fe3[_0x45f9b5(0x226)]((_0x48051e,_0x3eac4d)=>_0x48051e+_0x3eac4d['totalAmountAfterCommissionUSDT'],0x0),_0x5a8857=(_0x5c61a9-0x1)*_0x3ab24b,_0x3402f1=_0x199fe3['slice'](_0x5a8857,_0x5a8857+_0x3ab24b);return console[_0x45f9b5(0x1be)](_0x45f9b5(0x1c8)+_0x3402f1['length']+_0x45f9b5(0x236)+_0x43e701+_0x45f9b5(0x242)),console[_0x45f9b5(0x1be)](_0x45f9b5(0x231)+_0x5ed72a[_0x45f9b5(0x1ae)](0x2)+_0x45f9b5(0x1b2)+_0xfe01df[_0x45f9b5(0x1ae)](0x2)+_0x45f9b5(0x1ca)),{'merchants':_0x3402f1,'pagination':{'page':_0x5c61a9,'limit':_0x3ab24b,'total':_0x43e701,'totalPages':Math['ceil'](_0x43e701/_0x3ab24b)},'summary':{'totalMerchants':_0x43e701,'totalAmountUSDT':Math[_0x45f9b5(0x208)](_0x5ed72a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x45f9b5(0x208)](_0xfe01df*0x64)/0x64}};}async[a33_0x18eeb0(0x225)](){const _0x49d84f=a33_0x18eeb0;console[_0x49d84f(0x1be)](_0x49d84f(0x24e));const _0x540829=await database_1[_0x49d84f(0x21a)][_0x49d84f(0x1b0)][_0x49d84f(0x24b)]({'where':{'status':{'in':['PAID',_0x49d84f(0x1e0),_0x49d84f(0x1d3)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x540829[_0x49d84f(0x221)]+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x2a717d=new Date(),_0x5f0fd9=new Date(_0x2a717d[_0x49d84f(0x1a2)](),_0x2a717d[_0x49d84f(0x1fc)](),0x1),_0x2466f1=new Date(_0x2a717d['getFullYear'](),_0x2a717d[_0x49d84f(0x1fc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x149b11=0x0,_0xffddf5=0x0,_0x202b80=0x0,_0x591f6e=0x0;for(const _0x1b3985 of _0x540829){const _0x44e40d=this[_0x49d84f(0x215)](_0x1b3985);if(_0x44e40d===0x0)continue;let _0x23b991,_0x447e1e;if(_0x1b3985[_0x49d84f(0x1fd)]===_0x49d84f(0x1d3))_0x23b991=Math[_0x49d84f(0x1d4)](_0x44e40d),_0x447e1e=-_0x23b991;else{_0x23b991=await currencyService_1[_0x49d84f(0x21f)][_0x49d84f(0x181)](_0x1b3985[_0x49d84f(0x1d5)],_0x1b3985[_0x49d84f(0x21e)]);const _0x1036b3=this['getGatewaySettings'](_0x1b3985[_0x49d84f(0x23b)],_0x1b3985[_0x49d84f(0x1dd)]);_0x447e1e=this['calculateAmountAfterCommission'](_0x23b991,_0x1036b3['commission']);}_0x1b3985['merchantPaid']&&(_0x149b11+=_0x447e1e,_0x1b3985[_0x49d84f(0x212)]&&_0x1b3985[_0x49d84f(0x212)]>=_0x5f0fd9&&_0x1b3985['paidAt']<=_0x2466f1&&(_0x202b80+=_0x447e1e)),_0x1b3985[_0x49d84f(0x1fd)]===_0x49d84f(0x24c)&&this[_0x49d84f(0x22a)](_0x1b3985)&&(_0xffddf5+=_0x447e1e,_0x591f6e+=_0x23b991);}const _0x30246a={'totalPayout':Math['round'](_0x149b11*0x64)/0x64,'awaitingPayout':Math[_0x49d84f(0x208)](_0xffddf5*0x64)/0x64,'thisMonth':Math['round'](_0x202b80*0x64)/0x64,'availableBalance':Math[_0x49d84f(0x208)](_0x591f6e*0x64)/0x64};return console[_0x49d84f(0x1be)](_0x49d84f(0x244)),console[_0x49d84f(0x1be)](_0x49d84f(0x1d1)+_0x30246a['totalPayout']+_0x49d84f(0x1a3)),console[_0x49d84f(0x1be)](_0x49d84f(0x1a1)+_0x30246a['awaitingPayout']+_0x49d84f(0x1ff)),console[_0x49d84f(0x1be)](_0x49d84f(0x1b5)+_0x30246a['thisMonth']+'\x20USDT'),console[_0x49d84f(0x1be)](_0x49d84f(0x1c5)+_0x30246a[_0x49d84f(0x210)]+_0x49d84f(0x191)),_0x30246a;}async[a33_0x18eeb0(0x213)](_0x3dcbc7){const _0x574b06=a33_0x18eeb0,_0x2d5598=this[_0x574b06(0x184)](_0x3dcbc7),_0x33810e=new Date();_0x33810e['setDate'](_0x33810e[_0x574b06(0x216)]()-_0x2d5598),console['log'](_0x574b06(0x19b)+_0x3dcbc7+'\x20('+_0x2d5598+_0x574b06(0x1da));const _0x1a22cb=await database_1[_0x574b06(0x21a)][_0x574b06(0x23b)][_0x574b06(0x1df)]({'where':{'status':_0x574b06(0x1a7)}}),_0xf39cf3=await database_1[_0x574b06(0x21a)][_0x574b06(0x1b0)][_0x574b06(0x1df)](),_0x4744d6=await database_1[_0x574b06(0x21a)][_0x574b06(0x1b0)]['findMany']({'where':{'status':{'in':[_0x574b06(0x24c),_0x574b06(0x1e0),'CHARGEBACK']}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x574b06(0x1be)](_0x574b06(0x1bc)+_0x4744d6[_0x574b06(0x221)]+_0x574b06(0x185));const _0xc76ca8=await Promise['all'](_0x4744d6[_0x574b06(0x1a5)](async _0x466f54=>{const _0x431612=_0x574b06,_0x44c156=this['calculateEffectiveAmount'](_0x466f54);if(_0x44c156===0x0)return{'amount':0x0,'createdAt':_0x466f54[_0x431612(0x227)]};let _0x3d251a;return _0x466f54[_0x431612(0x1fd)]===_0x431612(0x1d3)?_0x3d251a=-Math[_0x431612(0x1d4)](_0x44c156):_0x3d251a=await currencyService_1[_0x431612(0x21f)]['convertToUSDT'](_0x466f54[_0x431612(0x1d5)],_0x466f54[_0x431612(0x21e)]),{'amount':_0x3d251a,'createdAt':_0x466f54[_0x431612(0x227)]};})),_0x2c5127=_0xc76ca8[_0x574b06(0x226)]((_0x1a4004,_0x3af451)=>_0x1a4004+_0x3af451[_0x574b06(0x1d5)],0x0),_0x5a35c6=_0xf39cf3>0x0?_0x2c5127/_0xf39cf3:0x0;console[_0x574b06(0x1be)](_0x574b06(0x18a)+_0x2c5127['toFixed'](0x2)+_0x574b06(0x1a3)),console['log']('üìà\x20Average\x20payment:\x20'+_0x5a35c6[_0x574b06(0x1ae)](0x2)+_0x574b06(0x191));const _0x1b083c=await database_1[_0x574b06(0x21a)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x33810e}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x574b06(0x1be)](_0x574b06(0x18f)+_0x1b083c[_0x574b06(0x221)]+_0x574b06(0x18c));const _0x2c6072=await Promise[_0x574b06(0x17b)](_0x1b083c[_0x574b06(0x1a5)](async _0x5122a7=>{const _0x2d081c=_0x574b06,_0x2bcb6f=await Promise[_0x2d081c(0x17b)](_0x5122a7[_0x2d081c(0x230)]['map'](async _0x28d445=>{const _0x4378de=_0x2d081c,_0x42b23e=this[_0x4378de(0x215)](_0x28d445);if(_0x42b23e===0x0)return 0x0;return _0x28d445['status']===_0x4378de(0x1d3)?-Math['abs'](_0x42b23e):await currencyService_1[_0x4378de(0x21f)]['convertToUSDT'](_0x28d445[_0x4378de(0x1d5)],_0x28d445[_0x4378de(0x21e)]);})),_0x4fbaae=_0x2bcb6f[_0x2d081c(0x226)]((_0x29c0c0,_0x3782a2)=>_0x29c0c0+_0x3782a2,0x0);return{'date':_0x5122a7[_0x2d081c(0x1c4)][_0x2d081c(0x23f)]()[_0x2d081c(0x1f6)]('T')[0x0],'amount':_0x4fbaae};})),_0x12a376=this[_0x574b06(0x1ab)](_0x33810e,new Date()),_0x4dc5ec=new Map(_0x2c6072[_0x574b06(0x1a5)](_0x220a20=>[_0x220a20[_0x574b06(0x1c4)],_0x220a20[_0x574b06(0x1d5)]])),_0x28fe12=_0x12a376['map'](_0x3d4161=>({'date':_0x3d4161,'amount':_0x4dc5ec[_0x574b06(0x1d7)](_0x3d4161)||0x0}));return console['log'](_0x574b06(0x1f8)),console[_0x574b06(0x1be)](_0x574b06(0x17a)+_0x1a22cb),console[_0x574b06(0x1be)]('üí≥\x20Total\x20payments:\x20'+_0xf39cf3),console['log']('üìä\x20Daily\x20revenue\x20entries:\x20'+_0x28fe12['length']),{'totalRevenue':Math[_0x574b06(0x208)](_0x2c5127*0x64)/0x64,'totalUsers':_0x1a22cb,'totalPayments':_0xf39cf3,'averagePayment':Math[_0x574b06(0x208)](_0x5a35c6*0x64)/0x64,'dailyRevenue':_0x28fe12};}async[a33_0x18eeb0(0x195)](_0x2815a8){const _0x103535=a33_0x18eeb0,{page:_0x1a4669,limit:_0x10e553,status:_0x19887e,gateway:_0x49f233,shopId:_0x241b75,dateFrom:_0x1d1606,dateTo:_0x26fbdd,search:_0x22c5bd}=_0x2815a8,_0x27b535=(_0x1a4669-0x1)*_0x10e553;console[_0x103535(0x1be)](_0x103535(0x199),_0x2815a8);const _0x54a771={};_0x19887e&&(_0x54a771['status']=_0x19887e[_0x103535(0x248)]());if(_0x49f233){if((0x0,gateway_1[_0x103535(0x1ee)])(_0x49f233)){const _0x8ae577=(0x0,gateway_1[_0x103535(0x22d)])(_0x49f233);_0x8ae577&&(_0x54a771['gateway']=_0x8ae577);}else _0x54a771['gateway']=_0x49f233['toLowerCase']();}_0x241b75&&(_0x54a771[_0x103535(0x237)]=_0x241b75);(_0x1d1606||_0x26fbdd)&&(_0x54a771['createdAt']={},_0x1d1606&&(_0x54a771[_0x103535(0x227)]['gte']=new Date(_0x1d1606)),_0x26fbdd&&(_0x54a771[_0x103535(0x227)][_0x103535(0x1fa)]=new Date(_0x26fbdd)));_0x22c5bd&&(_0x54a771['OR']=[{'orderId':{'contains':_0x22c5bd,'mode':_0x103535(0x188)}},{'gatewayOrderId':{'contains':_0x22c5bd,'mode':_0x103535(0x188)}},{'gatewayPaymentId':{'contains':_0x22c5bd,'mode':'insensitive'}},{'customerEmail':{'contains':_0x22c5bd,'mode':_0x103535(0x188)}},{'customerName':{'contains':_0x22c5bd,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x22c5bd,'mode':_0x103535(0x188)}}},{'shop':{'username':{'contains':_0x22c5bd,'mode':_0x103535(0x188)}}}]);const [_0x57cdf0,_0x4b8391]=await Promise[_0x103535(0x17b)]([database_1[_0x103535(0x21a)][_0x103535(0x1b0)]['findMany']({'where':_0x54a771,'skip':_0x27b535,'take':_0x10e553,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x103535(0x1b0)][_0x103535(0x1df)]({'where':_0x54a771})]);console[_0x103535(0x1be)](_0x103535(0x22e)+_0x57cdf0[_0x103535(0x221)]+_0x103535(0x229)+_0x4b8391+_0x103535(0x242));const _0x473f94=_0x57cdf0[_0x103535(0x1a5)](_0x45518f=>({'id':_0x45518f['id'],'shopId':_0x45518f[_0x103535(0x237)],'shopName':_0x45518f[_0x103535(0x23b)][_0x103535(0x17c)],'shopUsername':_0x45518f[_0x103535(0x23b)][_0x103535(0x20a)],'gateway':_0x45518f['gateway'],'orderId':_0x45518f['orderId'],'gatewayOrderId':_0x45518f[_0x103535(0x1cd)],'amount':_0x45518f[_0x103535(0x1d5)],'currency':_0x45518f[_0x103535(0x21e)],'sourceCurrency':_0x45518f[_0x103535(0x18d)],'status':_0x45518f[_0x103535(0x1fd)],'usage':_0x45518f[_0x103535(0x183)],'externalPaymentUrl':_0x45518f[_0x103535(0x203)],'gatewayPaymentId':_0x45518f['gatewayPaymentId'],'customerEmail':_0x45518f['customerEmail'],'customerName':_0x45518f[_0x103535(0x1a0)],'cardLast4':_0x45518f[_0x103535(0x247)],'paymentMethod':_0x45518f[_0x103535(0x23c)],'bankId':_0x45518f[_0x103535(0x1c6)],'remitterIban':_0x45518f['remitterIban'],'remitterName':_0x45518f[_0x103535(0x1c7)],'chargebackAmount':_0x45518f[_0x103535(0x23d)],'adminNotes':_0x45518f[_0x103535(0x1f3)],'statusChangedBy':_0x45518f[_0x103535(0x233)],'statusChangedAt':_0x45518f[_0x103535(0x180)],'createdAt':_0x45518f['createdAt'],'updatedAt':_0x45518f[_0x103535(0x21b)],'expiresAt':_0x45518f[_0x103535(0x1ea)]}));return{'payments':_0x473f94,'pagination':{'page':_0x1a4669,'limit':_0x10e553,'total':_0x4b8391,'totalPages':Math[_0x103535(0x1ef)](_0x4b8391/_0x10e553)}};}async[a33_0x18eeb0(0x207)](_0x49f78d){const _0x4a5cf1=a33_0x18eeb0;console[_0x4a5cf1(0x1be)](_0x4a5cf1(0x19f)+_0x49f78d);const _0x23b8dd=await database_1['default'][_0x4a5cf1(0x1b0)]['findUnique']({'where':{'id':_0x49f78d},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x4a5cf1(0x18b)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x23b8dd)return console[_0x4a5cf1(0x1be)](_0x4a5cf1(0x1cb)+_0x49f78d),null;return console[_0x4a5cf1(0x1be)]('‚úÖ\x20Found\x20payment:\x20'+_0x23b8dd['orderId']+'\x20('+_0x23b8dd[_0x4a5cf1(0x1fd)]+')'),{'id':_0x23b8dd['id'],'shopId':_0x23b8dd[_0x4a5cf1(0x237)],'shopName':_0x23b8dd[_0x4a5cf1(0x23b)][_0x4a5cf1(0x17c)],'shopUsername':_0x23b8dd[_0x4a5cf1(0x23b)][_0x4a5cf1(0x20a)],'gateway':_0x23b8dd[_0x4a5cf1(0x1dd)],'orderId':_0x23b8dd[_0x4a5cf1(0x200)],'gatewayOrderId':_0x23b8dd[_0x4a5cf1(0x1cd)],'amount':_0x23b8dd[_0x4a5cf1(0x1d5)],'currency':_0x23b8dd[_0x4a5cf1(0x21e)],'sourceCurrency':_0x23b8dd[_0x4a5cf1(0x18d)],'status':_0x23b8dd[_0x4a5cf1(0x1fd)],'usage':_0x23b8dd[_0x4a5cf1(0x183)],'externalPaymentUrl':_0x23b8dd[_0x4a5cf1(0x203)],'gatewayPaymentId':_0x23b8dd[_0x4a5cf1(0x243)],'customerEmail':_0x23b8dd[_0x4a5cf1(0x240)],'customerName':_0x23b8dd[_0x4a5cf1(0x1a0)],'cardLast4':_0x23b8dd[_0x4a5cf1(0x247)],'paymentMethod':_0x23b8dd['paymentMethod'],'bankId':_0x23b8dd[_0x4a5cf1(0x1c6)],'remitterIban':_0x23b8dd['remitterIban'],'remitterName':_0x23b8dd['remitterName'],'chargebackAmount':_0x23b8dd[_0x4a5cf1(0x23d)],'adminNotes':_0x23b8dd[_0x4a5cf1(0x1f3)],'statusChangedBy':_0x23b8dd['statusChangedBy'],'statusChangedAt':_0x23b8dd[_0x4a5cf1(0x180)],'createdAt':_0x23b8dd[_0x4a5cf1(0x227)],'updatedAt':_0x23b8dd[_0x4a5cf1(0x21b)],'expiresAt':_0x23b8dd[_0x4a5cf1(0x1ea)],'webhookLogs':_0x23b8dd[_0x4a5cf1(0x1cf)]};}async[a33_0x18eeb0(0x1d8)](_0x2698d3,_0x57615a,_0x30b2da,_0x4a3a95){const _0x503290=a33_0x18eeb0;console[_0x503290(0x1be)]('üîÑ\x20Updating\x20payment\x20'+_0x2698d3+_0x503290(0x187)+_0x57615a);const _0x264084=[_0x503290(0x22f),_0x503290(0x224),_0x503290(0x24c),'EXPIRED',_0x503290(0x1dc),_0x503290(0x1e0),_0x503290(0x1d3)];if(!_0x264084[_0x503290(0x245)](_0x57615a[_0x503290(0x248)]()))throw new Error(_0x503290(0x1e7)+_0x264084[_0x503290(0x19d)](',\x20'));const _0x41b130=await database_1[_0x503290(0x21a)][_0x503290(0x1b0)][_0x503290(0x19e)]({'where':{'id':_0x2698d3},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x41b130)throw new Error(_0x503290(0x1e2));if(_0x57615a[_0x503290(0x248)]()===_0x503290(0x1d3)){if(!_0x4a3a95||_0x4a3a95<=0x0)throw new Error(_0x503290(0x1f7));console['log'](_0x503290(0x235)+_0x4a3a95+_0x503290(0x189));}const _0x4a26ba={'status':_0x57615a[_0x503290(0x248)](),'updatedAt':new Date()};_0x30b2da&&(_0x4a26ba[_0x503290(0x1f3)]=_0x30b2da);_0x57615a[_0x503290(0x248)]()===_0x503290(0x1d3)&&_0x4a3a95&&(_0x4a26ba[_0x503290(0x23d)]=_0x4a3a95);const _0x56a2ce=await database_1[_0x503290(0x21a)]['payment']['update']({'where':{'id':_0x2698d3},'data':_0x4a26ba,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x503290(0x21a)][_0x503290(0x217)][_0x503290(0x1e4)]({'data':{'paymentId':_0x2698d3,'shopId':_0x56a2ce[_0x503290(0x237)],'event':_0x503290(0x206),'statusCode':0xc8,'responseBody':JSON[_0x503290(0x1ce)]({'oldStatus':_0x41b130[_0x503290(0x1fd)],'newStatus':_0x57615a['toUpperCase'](),'notes':_0x30b2da||null,'chargebackAmount':_0x4a3a95||null,'timestamp':new Date()['toISOString']()})}}),console['log'](_0x503290(0x214)+_0x41b130[_0x503290(0x200)]+_0x503290(0x222)+_0x41b130[_0x503290(0x1fd)]+_0x503290(0x20d)+_0x57615a['toUpperCase']()),_0x57615a[_0x503290(0x248)]()===_0x503290(0x1d3)&&console[_0x503290(0x1be)](_0x503290(0x1b4)+_0x4a3a95+_0x503290(0x232)),{'id':_0x56a2ce['id'],'shopId':_0x56a2ce[_0x503290(0x237)],'shopName':_0x56a2ce[_0x503290(0x23b)][_0x503290(0x17c)],'shopUsername':_0x56a2ce[_0x503290(0x23b)][_0x503290(0x20a)],'gateway':_0x56a2ce[_0x503290(0x1dd)],'orderId':_0x56a2ce['orderId'],'gatewayOrderId':_0x56a2ce[_0x503290(0x1cd)],'amount':_0x56a2ce[_0x503290(0x1d5)],'currency':_0x56a2ce[_0x503290(0x21e)],'sourceCurrency':_0x56a2ce[_0x503290(0x18d)],'status':_0x56a2ce[_0x503290(0x1fd)],'usage':_0x56a2ce[_0x503290(0x183)],'externalPaymentUrl':_0x56a2ce[_0x503290(0x203)],'gatewayPaymentId':_0x56a2ce['gatewayPaymentId'],'customerEmail':_0x56a2ce[_0x503290(0x240)],'customerName':_0x56a2ce[_0x503290(0x1a0)],'cardLast4':_0x56a2ce[_0x503290(0x247)],'paymentMethod':_0x56a2ce[_0x503290(0x23c)],'bankId':_0x56a2ce[_0x503290(0x1c6)],'remitterIban':_0x56a2ce[_0x503290(0x24d)],'remitterName':_0x56a2ce['remitterName'],'chargebackAmount':_0x56a2ce[_0x503290(0x23d)],'adminNotes':_0x56a2ce[_0x503290(0x1f3)],'statusChangedBy':_0x56a2ce[_0x503290(0x233)],'statusChangedAt':_0x56a2ce[_0x503290(0x180)],'createdAt':_0x56a2ce[_0x503290(0x227)],'updatedAt':_0x56a2ce[_0x503290(0x21b)],'expiresAt':_0x56a2ce[_0x503290(0x1ea)]};}async[a33_0x18eeb0(0x1eb)](_0x41bfa0){const _0x48033d=a33_0x18eeb0,{page:_0x3509d8,limit:_0x31aed8,status:_0x1ccb9e}=_0x41bfa0,_0xf99c8f=(_0x3509d8-0x1)*_0x31aed8,_0x813d86={};_0x1ccb9e&&(_0x813d86[_0x48033d(0x1fd)]=_0x1ccb9e['toUpperCase']());console['log']('üìã\x20Getting\x20users\x20with\x20filters:',{'page':_0x3509d8,'limit':_0x31aed8,'status':_0x1ccb9e,'where':_0x813d86});const [_0x5def0b,_0x39d28d]=await Promise[_0x48033d(0x17b)]([database_1[_0x48033d(0x21a)][_0x48033d(0x23b)][_0x48033d(0x24b)]({'where':_0x813d86,'skip':_0xf99c8f,'take':_0x31aed8,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x48033d(0x18b)}}),database_1[_0x48033d(0x21a)]['shop'][_0x48033d(0x1df)]({'where':_0x813d86})]);console[_0x48033d(0x1be)](_0x48033d(0x22e)+_0x5def0b[_0x48033d(0x221)]+_0x48033d(0x241)+_0x39d28d+_0x48033d(0x242));const _0x1fabd1=_0x5def0b['map'](_0x3d3a00=>({'id':_0x3d3a00['id'],'fullName':_0x3d3a00['name'],'username':_0x3d3a00[_0x48033d(0x20a)],'telegramId':_0x3d3a00[_0x48033d(0x1cc)],'merchantUrl':_0x3d3a00[_0x48033d(0x1ac)],'gateways':_0x3d3a00['paymentGateways']?JSON[_0x48033d(0x1de)](_0x3d3a00[_0x48033d(0x1bf)]):null,'gatewaySettings':_0x3d3a00[_0x48033d(0x1c3)]?JSON[_0x48033d(0x1de)](_0x3d3a00[_0x48033d(0x1c3)]):null,'publicKey':_0x3d3a00['publicKey'],'wallets':{'usdtPolygonWallet':_0x3d3a00[_0x48033d(0x1fe)],'usdtTrcWallet':_0x3d3a00[_0x48033d(0x196)],'usdtErcWallet':_0x3d3a00['usdtErcWallet'],'usdcPolygonWallet':_0x3d3a00[_0x48033d(0x21c)]},'status':_0x3d3a00[_0x48033d(0x1fd)],'createdAt':_0x3d3a00[_0x48033d(0x227)]}));return{'users':_0x1fabd1,'pagination':{'page':_0x3509d8,'limit':_0x31aed8,'total':_0x39d28d,'totalPages':Math['ceil'](_0x39d28d/_0x31aed8)}};}async[a33_0x18eeb0(0x238)](_0x29d25e){const _0x4cb1a1=a33_0x18eeb0;return await this[_0x4cb1a1(0x1a6)][_0x4cb1a1(0x238)](_0x29d25e);}async[a33_0x18eeb0(0x1f0)](_0x46d030){const _0x4e4786=a33_0x18eeb0;return await this[_0x4e4786(0x1a6)][_0x4e4786(0x1f0)](_0x46d030);}async[a33_0x18eeb0(0x1b3)](_0x114cac,_0x1b723d){const _0x246a41=a33_0x18eeb0;return await this[_0x246a41(0x1a6)][_0x246a41(0x1b3)](_0x114cac,_0x1b723d);}async[a33_0x18eeb0(0x209)](_0x13ab84){const _0x43fc2e=a33_0x18eeb0;return await this[_0x43fc2e(0x1a6)][_0x43fc2e(0x209)](_0x13ab84);}async['suspendUser'](_0x5c731e){const _0x556abe=a33_0x18eeb0;console['log'](_0x556abe(0x1b9)+_0x5c731e);const _0x27265e=await database_1[_0x556abe(0x21a)][_0x556abe(0x23b)]['findUnique']({'where':{'id':_0x5c731e},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x27265e)throw new Error(_0x556abe(0x1a4));if(_0x27265e['status']===_0x556abe(0x220))throw new Error('User\x20is\x20already\x20suspended');const _0xd00ce8=await this['userService']['updateUser'](_0x5c731e,{'status':_0x556abe(0x220)});return console[_0x556abe(0x1be)](_0x556abe(0x24a)+_0x27265e[_0x556abe(0x20a)]+_0x556abe(0x1d0)),_0xd00ce8;}async[a33_0x18eeb0(0x1af)](_0x12c6b4){const _0x488c59=a33_0x18eeb0;console[_0x488c59(0x1be)]('‚úÖ\x20Activating\x20user:\x20'+_0x12c6b4);const _0x1d72b4=await database_1[_0x488c59(0x21a)]['shop']['findUnique']({'where':{'id':_0x12c6b4},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x1d72b4)throw new Error('User\x20not\x20found');if(_0x1d72b4['status']===_0x488c59(0x1a7))throw new Error('User\x20is\x20already\x20active');const _0x238652=await this[_0x488c59(0x1a6)][_0x488c59(0x1b3)](_0x12c6b4,{'status':_0x488c59(0x1a7)});return console[_0x488c59(0x1be)](_0x488c59(0x24a)+_0x1d72b4[_0x488c59(0x20a)]+'\x20activated\x20successfully'),_0x238652;}}exports[a33_0x18eeb0(0x239)]=AdminService;