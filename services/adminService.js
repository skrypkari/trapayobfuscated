'use strict';const a35_0x2bc1e9=a35_0x5e0d;(function(_0x2ed9bb,_0x220a73){const _0x318439=a35_0x5e0d,_0x422683=_0x2ed9bb();while(!![]){try{const _0x1752d6=-parseInt(_0x318439(0x220))/0x1*(-parseInt(_0x318439(0x1df))/0x2)+-parseInt(_0x318439(0x1ba))/0x3+-parseInt(_0x318439(0x233))/0x4*(parseInt(_0x318439(0x207))/0x5)+parseInt(_0x318439(0x1d3))/0x6+-parseInt(_0x318439(0x1d7))/0x7+-parseInt(_0x318439(0x22e))/0x8*(-parseInt(_0x318439(0x1ce))/0x9)+parseInt(_0x318439(0x1bf))/0xa*(-parseInt(_0x318439(0x1a0))/0xb);if(_0x1752d6===_0x220a73)break;else _0x422683['push'](_0x422683['shift']());}catch(_0x8f5ab9){_0x422683['push'](_0x422683['shift']());}}}(a35_0x550e,0xd9313));var __importDefault=this&&this[a35_0x2bc1e9(0x203)]||function(_0x2d9bf5){const _0x3bfc79=a35_0x2bc1e9;return _0x2d9bf5&&_0x2d9bf5[_0x3bfc79(0x1eb)]?_0x2d9bf5:{'default':_0x2d9bf5};};Object[a35_0x2bc1e9(0x1c2)](exports,a35_0x2bc1e9(0x1eb),{'value':!![]}),exports[a35_0x2bc1e9(0x172)]=void 0x0;const database_1=__importDefault(require(a35_0x2bc1e9(0x1cc))),bcryptjs_1=__importDefault(require(a35_0x2bc1e9(0x1d5))),crypto_1=__importDefault(require(a35_0x2bc1e9(0x192))),currencyService_1=require(a35_0x2bc1e9(0x231));function a35_0x5e0d(_0x2b0b7f,_0x4e409d){const _0x550ea8=a35_0x550e();return a35_0x5e0d=function(_0x5e0dd2,_0x2a3f3a){_0x5e0dd2=_0x5e0dd2-0x16e;let _0x314b3a=_0x550ea8[_0x5e0dd2];return _0x314b3a;},a35_0x5e0d(_0x2b0b7f,_0x4e409d);}class AdminService{async[a35_0x2bc1e9(0x177)](){const _0x32d6e3=a35_0x2bc1e9;console[_0x32d6e3(0x196)](_0x32d6e3(0x194));const _0x4f1cf6=await database_1['default'][_0x32d6e3(0x244)][_0x32d6e3(0x208)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x240e00=new Date(),_0x334d82=new Date(_0x240e00[_0x32d6e3(0x210)](),_0x240e00[_0x32d6e3(0x1b6)](),0x1),_0x441142=new Date(_0x240e00[_0x32d6e3(0x210)](),_0x240e00['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x10f8ac=await database_1[_0x32d6e3(0x179)][_0x32d6e3(0x18c)][_0x32d6e3(0x208)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x334d82,'lte':_0x441142},'status':_0x32d6e3(0x1e1)}}),_0x5c5e39=_0x4f1cf6['_sum'][_0x32d6e3(0x1ee)]||0x0,_0xd76bcd=_0x4f1cf6['_sum'][_0x32d6e3(0x19d)]||0x0,_0x3fb5a5=_0x10f8ac[_0x32d6e3(0x1b5)][_0x32d6e3(0x1f8)]||0x0,_0x2d5d59={'totalPayout':Math[_0x32d6e3(0x1da)](_0x5c5e39*0x64)/0x64,'awaitingPayout':Math[_0x32d6e3(0x1da)](_0xd76bcd*0x64)/0x64,'thisMonth':Math[_0x32d6e3(0x1da)](_0x3fb5a5*0x64)/0x64,'availableBalance':Math['round'](_0xd76bcd*0x64)/0x64};return console['log'](_0x32d6e3(0x1ed)),console[_0x32d6e3(0x196)](_0x32d6e3(0x241)+_0x2d5d59[_0x32d6e3(0x1ad)]+_0x32d6e3(0x195)),console[_0x32d6e3(0x196)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x2d5d59[_0x32d6e3(0x1dc)]+_0x32d6e3(0x17e)),console[_0x32d6e3(0x196)](_0x32d6e3(0x21d)+_0x2d5d59[_0x32d6e3(0x1ea)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x32d6e3(0x196)](_0x32d6e3(0x23c)+_0x2d5d59['thisMonth']+'\x20USDT'),_0x2d5d59;}async[a35_0x2bc1e9(0x1c9)](_0x4921de,_0xcf85f3){const _0x47428a=a35_0x2bc1e9;console['log'](_0x47428a(0x212)+_0x4921de+':',_0xcf85f3);const _0x4bbed4=await database_1[_0x47428a(0x179)]['payment']['findUnique']({'where':{'id':_0x4921de},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4bbed4)throw new Error(_0x47428a(0x22f));const _0xabdb8d={};_0xcf85f3[_0x47428a(0x206)]!==undefined&&(_0xabdb8d[_0x47428a(0x206)]=_0xcf85f3[_0x47428a(0x206)]||null);_0xcf85f3['customerIp']!==undefined&&(_0xabdb8d[_0x47428a(0x23f)]=_0xcf85f3[_0x47428a(0x23f)]||null);_0xcf85f3[_0x47428a(0x1e7)]!==undefined&&(_0xabdb8d[_0x47428a(0x1e7)]=_0xcf85f3[_0x47428a(0x1e7)]||null);const _0x215b98=await database_1['default'][_0x47428a(0x230)]['update']({'where':{'id':_0x4921de},'data':{..._0xabdb8d,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x47428a(0x1c0)+_0x4921de),console['log'](_0x47428a(0x1fc)+_0x4bbed4[_0x47428a(0x206)]+_0x47428a(0x19c)+_0x215b98[_0x47428a(0x206)]),console[_0x47428a(0x196)](_0x47428a(0x225)+_0x4bbed4[_0x47428a(0x23f)]+'\x20->\x20'+_0x215b98[_0x47428a(0x23f)]),console[_0x47428a(0x196)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x4bbed4[_0x47428a(0x1e7)]?_0x47428a(0x16e):_0x47428a(0x186))+'\x20->\x20'+(_0x215b98[_0x47428a(0x1e7)]?_0x47428a(0x16e):'not\x20set')),_0x215b98;}async[a35_0x2bc1e9(0x17d)](_0x12fba0){const _0x3715e4=a35_0x2bc1e9,_0x315d49=new Date();let _0x291518;switch(_0x12fba0){case'7d':_0x291518=new Date(_0x315d49[_0x3715e4(0x1db)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3715e4(0x223):_0x291518=new Date(_0x315d49[_0x3715e4(0x1db)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3715e4(0x1e9):_0x291518=new Date(_0x315d49[_0x3715e4(0x1db)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x291518=new Date(_0x315d49[_0x3715e4(0x1db)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x183975,_0x566aa9,_0x12cf0f,_0x52c778,_0x4e1fbc,_0xd455fa]=await Promise[_0x3715e4(0x1ca)]([database_1[_0x3715e4(0x179)][_0x3715e4(0x244)][_0x3715e4(0x18a)](),database_1[_0x3715e4(0x179)][_0x3715e4(0x244)][_0x3715e4(0x18a)]({'where':{'status':'ACTIVE'}}),database_1[_0x3715e4(0x179)][_0x3715e4(0x230)][_0x3715e4(0x18a)]({'where':{'createdAt':{'gte':_0x291518},'gateway':{'not':_0x3715e4(0x202)}}}),database_1[_0x3715e4(0x179)][_0x3715e4(0x230)][_0x3715e4(0x18a)]({'where':{'status':_0x3715e4(0x1fa),'createdAt':{'gte':_0x291518},'gateway':{'not':_0x3715e4(0x202)}}}),database_1['default'][_0x3715e4(0x230)][_0x3715e4(0x198)]({'where':{'status':'PAID','createdAt':{'gte':_0x291518},'gateway':{'not':_0x3715e4(0x202)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x3715e4(0x230)][_0x3715e4(0x198)]({'where':{'gateway':{'not':_0x3715e4(0x202)}},'take':0xa,'orderBy':{'createdAt':_0x3715e4(0x1a6)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x17f22c=0x0;for(const _0x4d1de8 of _0x4e1fbc){const _0x43202f=await currencyService_1[_0x3715e4(0x19e)]['convertToUSDT'](_0x4d1de8[_0x3715e4(0x1f8)],_0x4d1de8[_0x3715e4(0x1a5)]);_0x17f22c+=_0x43202f;}const _0x79722f=_0x12cf0f>0x0?_0x52c778/_0x12cf0f*0x64:0x0;return{'totalShops':_0x183975,'activeShops':_0x566aa9,'totalPayments':_0x12cf0f,'successfulPayments':_0x52c778,'totalRevenue':Math['round'](_0x17f22c*0x64)/0x64,'conversionRate':Math[_0x3715e4(0x1da)](_0x79722f*0x64)/0x64,'recentPayments':_0xd455fa[_0x3715e4(0x22a)](_0x48392b=>({'id':_0x48392b['id'],'amount':_0x48392b[_0x3715e4(0x1f8)],'currency':_0x48392b[_0x3715e4(0x1a5)],'status':_0x48392b[_0x3715e4(0x17a)],'gateway':_0x48392b[_0x3715e4(0x221)],'shop':_0x48392b[_0x3715e4(0x244)],'createdAt':_0x48392b[_0x3715e4(0x170)]}))};}async[a35_0x2bc1e9(0x222)](_0x33fcae){const _0x417579=a35_0x2bc1e9;console['log'](_0x417579(0x183),_0x33fcae);let _0x51341a,_0x5298da=new Date();if(_0x33fcae[_0x417579(0x21e)]===_0x417579(0x229)&&_0x33fcae[_0x417579(0x1f4)]&&_0x33fcae[_0x417579(0x1ae)])_0x51341a=new Date(_0x33fcae[_0x417579(0x1f4)]),_0x5298da=new Date(_0x33fcae[_0x417579(0x1ae)]);else{const _0x214ca2=new Date();switch(_0x33fcae[_0x417579(0x21e)]){case'week':_0x51341a=new Date(_0x214ca2['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x417579(0x1a4):_0x51341a=new Date(_0x214ca2[_0x417579(0x1db)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x417579(0x18f):_0x51341a=new Date(_0x214ca2[_0x417579(0x1db)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x417579(0x1ca):default:_0x51341a=new Date('2020-01-01');break;}}console[_0x417579(0x196)](_0x417579(0x20b)+_0x51341a[_0x417579(0x1e0)]()+'\x20to\x20'+_0x5298da[_0x417579(0x1e0)]());const _0x298ca6={'status':_0x417579(0x1fa),'gateway':{'not':_0x417579(0x202)},'paidAt':{'gte':_0x51341a,'lte':_0x5298da}};_0x33fcae[_0x417579(0x1b1)]&&(_0x298ca6[_0x417579(0x1b1)]=_0x33fcae['shopId']);const _0x2a16dd=await database_1[_0x417579(0x179)][_0x417579(0x230)]['findMany']({'where':_0x298ca6,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x417579(0x196)](_0x417579(0x240)+_0x2a16dd[_0x417579(0x243)]+_0x417579(0x21a));let _0x317b4b=0x0,_0x4061fb=0x0,_0x58593e=0x0;const _0x1d1ded={},_0xaabc40={},_0x303773={};for(const _0x16a28d of _0x2a16dd){try{const _0x48b25f=await currencyService_1[_0x417579(0x19e)][_0x417579(0x1a8)](_0x16a28d[_0x417579(0x1f8)],_0x16a28d[_0x417579(0x1a5)]);let _0x45e737={};if(_0x16a28d[_0x417579(0x244)]['gatewaySettings'])try{_0x45e737=JSON[_0x417579(0x228)](_0x16a28d[_0x417579(0x244)][_0x417579(0x23d)]);}catch(_0x519290){console[_0x417579(0x1f7)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x16a28d[_0x417579(0x1b1)]+':',_0x519290);}const _0x58406c=_0x45e737['commission']||0xa,_0x29b4cb=_0x48b25f*(_0x58406c/0x64),_0x240a74=_0x48b25f-_0x29b4cb;_0x317b4b+=_0x48b25f,_0x4061fb+=_0x240a74,_0x58593e+=_0x29b4cb;!_0x1d1ded[_0x16a28d[_0x417579(0x221)]]&&(_0x1d1ded[_0x16a28d[_0x417579(0x221)]]={'gateway':_0x16a28d[_0x417579(0x221)],'gatewayDisplayName':this[_0x417579(0x234)](_0x16a28d[_0x417579(0x221)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1d1ded[_0x16a28d[_0x417579(0x221)]][_0x417579(0x1e8)]++,_0x1d1ded[_0x16a28d[_0x417579(0x221)]]['turnoverUSDT']+=_0x48b25f,_0x1d1ded[_0x16a28d[_0x417579(0x221)]][_0x417579(0x20a)]+=_0x29b4cb,_0x1d1ded[_0x16a28d['gateway']][_0x417579(0x191)]+=_0x240a74,_0x1d1ded[_0x16a28d[_0x417579(0x221)]]['totalCommissionRate']+=_0x58406c;!_0x33fcae[_0x417579(0x1b1)]&&(!_0xaabc40[_0x16a28d[_0x417579(0x1b1)]]&&(_0xaabc40[_0x16a28d['shopId']]={'shopId':_0x16a28d[_0x417579(0x1b1)],'shopName':_0x16a28d[_0x417579(0x244)][_0x417579(0x232)],'shopUsername':_0x16a28d[_0x417579(0x244)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xaabc40[_0x16a28d[_0x417579(0x1b1)]][_0x417579(0x1e8)]++,_0xaabc40[_0x16a28d[_0x417579(0x1b1)]][_0x417579(0x1f9)]+=_0x48b25f,_0xaabc40[_0x16a28d['shopId']][_0x417579(0x20a)]+=_0x29b4cb,_0xaabc40[_0x16a28d[_0x417579(0x1b1)]]['merchantEarningsUSDT']+=_0x240a74);const _0x2bf812=_0x16a28d[_0x417579(0x22b)][_0x417579(0x1e0)]()['split']('T')[0x0];!_0x303773[_0x2bf812]&&(_0x303773[_0x2bf812]={'date':_0x2bf812,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x303773[_0x2bf812][_0x417579(0x1b8)]+=_0x48b25f,_0x303773[_0x2bf812][_0x417579(0x1e2)]+=_0x240a74,_0x303773[_0x2bf812][_0x417579(0x1bc)]+=_0x29b4cb,_0x303773[_0x2bf812][_0x417579(0x1e8)]++;}catch(_0x4a00c3){console[_0x417579(0x1f7)](_0x417579(0x217)+_0x16a28d['id']+':',_0x4a00c3);}}Object[_0x417579(0x1b3)](_0x1d1ded)['forEach'](_0x2279cf=>{const _0x7da4a1=_0x417579;_0x2279cf[_0x7da4a1(0x1c3)]=_0x2279cf[_0x7da4a1(0x1e8)]>0x0?_0x2279cf[_0x7da4a1(0x219)]/_0x2279cf[_0x7da4a1(0x1e8)]:0x0,delete _0x2279cf[_0x7da4a1(0x219)];}),Object['values'](_0xaabc40)[_0x417579(0x180)](_0x1ef71a=>{const _0x992499=_0x417579;_0x1ef71a[_0x992499(0x22d)]=_0x1ef71a[_0x992499(0x1e8)]>0x0?_0x1ef71a[_0x992499(0x1f9)]/_0x1ef71a['paymentsCount']:0x0;});let _0x1c64b8=0x0;if(_0x33fcae[_0x417579(0x1b1)]){const _0x2e5050=await database_1[_0x417579(0x179)]['payout'][_0x417579(0x198)]({'where':{'shopId':_0x33fcae[_0x417579(0x1b1)],'status':_0x417579(0x1e1),'createdAt':{'gte':_0x51341a,'lte':_0x5298da}},'select':{'amount':!![]}});_0x1c64b8=_0x2e5050[_0x417579(0x1cf)]((_0x3edf14,_0x584235)=>_0x3edf14+_0x584235['amount'],0x0);}const _0x393a73=_0x2a16dd['length'],_0x20b4c7=_0x2a16dd[_0x417579(0x243)],_0x394392=_0x393a73>0x0?_0x317b4b/_0x393a73:0x0,_0x326a44=0x64,_0x87674e=Math[_0x417579(0x19b)]((_0x5298da[_0x417579(0x1db)]()-_0x51341a[_0x417579(0x1db)]())/(0x3e8*0x3c*0x3c*0x18)),_0x14d2d2={'totalTurnover':Math[_0x417579(0x1da)](_0x317b4b*0x64)/0x64,'merchantEarnings':Math['round'](_0x4061fb*0x64)/0x64,'gatewayEarnings':Math[_0x417579(0x1da)](_0x58593e*0x64)/0x64,'totalPaidOut':Math[_0x417579(0x1da)](_0x1c64b8*0x64)/0x64,'averageCheck':Math[_0x417579(0x1da)](_0x394392*0x64)/0x64,'totalPayments':_0x393a73,'successfulPayments':_0x20b4c7,'conversionRate':_0x326a44,'gatewayBreakdown':Object[_0x417579(0x1b3)](_0x1d1ded)[_0x417579(0x22a)](_0x464ae7=>({..._0x464ae7,'turnoverUSDT':Math[_0x417579(0x1da)](_0x464ae7[_0x417579(0x1f9)]*0x64)/0x64,'commissionUSDT':Math[_0x417579(0x1da)](_0x464ae7[_0x417579(0x20a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x417579(0x1da)](_0x464ae7['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x417579(0x1da)](_0x464ae7['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x33fcae[_0x417579(0x1b1)]?undefined:Object[_0x417579(0x1b3)](_0xaabc40)['map'](_0x910757=>({..._0x910757,'turnoverUSDT':Math[_0x417579(0x1da)](_0x910757['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x417579(0x1da)](_0x910757[_0x417579(0x20a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x417579(0x1da)](_0x910757[_0x417579(0x191)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x910757[_0x417579(0x1b0)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x910757[_0x417579(0x22d)]*0x64)/0x64})),'dailyData':Object[_0x417579(0x1b3)](_0x303773)[_0x417579(0x22a)](_0x298b08=>({..._0x298b08,'turnover':Math[_0x417579(0x1da)](_0x298b08['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x417579(0x1da)](_0x298b08['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x417579(0x1da)](_0x298b08[_0x417579(0x1bc)]*0x64)/0x64}))[_0x417579(0x1ef)]((_0x1ed683,_0xc0a22a)=>_0x1ed683[_0x417579(0x1c8)][_0x417579(0x1b4)](_0xc0a22a[_0x417579(0x1c8)])),'periodInfo':{'from':_0x51341a,'to':_0x5298da,'periodType':_0x33fcae['period']||_0x417579(0x229),'daysCount':_0x87674e}};return console[_0x417579(0x196)](_0x417579(0x242)),console[_0x417579(0x196)](_0x417579(0x1cd)+_0x14d2d2[_0x417579(0x22c)]+'\x20USDT'),console[_0x417579(0x196)](_0x417579(0x1d8)+_0x14d2d2['merchantEarnings']+_0x417579(0x171)),console[_0x417579(0x196)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x14d2d2['gatewayEarnings']+_0x417579(0x171)),console[_0x417579(0x196)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x14d2d2[_0x417579(0x1d4)]),_0x14d2d2;}[a35_0x2bc1e9(0x234)](_0x11d56e){const _0x1021f8=a35_0x2bc1e9,_0x4bea63={'test_gateway':'Test\x20Gateway','plisio':_0x1021f8(0x1c5),'rapyd':_0x1021f8(0x1f2),'noda':_0x1021f8(0x190),'cointopay':_0x1021f8(0x1fb),'klyme_eu':_0x1021f8(0x200),'klyme_gb':_0x1021f8(0x1de),'klyme_de':_0x1021f8(0x1dd)};return _0x4bea63[_0x11d56e]||_0x11d56e;}async[a35_0x2bc1e9(0x1af)](_0x245990){const _0x331c53=a35_0x2bc1e9,{page:_0x5da7d8,limit:_0x4e1d33,minAmount:_0x4a6825,search:_0x712da6}=_0x245990,_0x6ae349=(_0x5da7d8-0x1)*_0x4e1d33;console['log']('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x245990);const _0x31bd1b={'balance':{'gt':0x0},'status':_0x331c53(0x239)};_0x4a6825&&(_0x31bd1b[_0x331c53(0x19d)][_0x331c53(0x214)]=_0x4a6825);_0x712da6&&(_0x31bd1b['OR']=[{'name':{'contains':_0x712da6,'mode':_0x331c53(0x18d)}},{'username':{'contains':_0x712da6,'mode':_0x331c53(0x18d)}}]);const [_0x1f9653,_0x4dd1e9]=await Promise[_0x331c53(0x1ca)]([database_1['default'][_0x331c53(0x244)][_0x331c53(0x198)]({'where':_0x31bd1b,'skip':_0x6ae349,'take':_0x4e1d33,'orderBy':{'balance':_0x331c53(0x1a6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default'][_0x331c53(0x244)][_0x331c53(0x18a)]({'where':_0x31bd1b})]);console[_0x331c53(0x196)](_0x331c53(0x240)+_0x1f9653[_0x331c53(0x243)]+_0x331c53(0x184));const _0x26c7ec=await Promise[_0x331c53(0x1ca)](_0x1f9653[_0x331c53(0x22a)](async _0x4f9303=>{const _0x103c46=_0x331c53,[_0x25303b,_0x43474c,_0x5b3681]=await Promise[_0x103c46(0x1ca)]([database_1[_0x103c46(0x179)][_0x103c46(0x230)][_0x103c46(0x18a)]({'where':{'shopId':_0x4f9303['id'],'status':_0x103c46(0x1fa),'amountUSDT':{'not':null}}}),database_1[_0x103c46(0x179)][_0x103c46(0x230)][_0x103c46(0x20f)]({'where':{'shopId':_0x4f9303['id'],'status':_0x103c46(0x1fa),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x103c46(0x1f5)},'select':{'paidAt':!![]}}),database_1[_0x103c46(0x179)]['payment'][_0x103c46(0x176)]({'by':['gateway'],'where':{'shopId':_0x4f9303['id'],'status':_0x103c46(0x1fa),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x46f81b=_0x5b3681['map'](_0x216a67=>({'gateway':_0x216a67[_0x103c46(0x221)],'count':_0x216a67['_count']['id'],'amountUSDT':_0x216a67[_0x103c46(0x1b5)][_0x103c46(0x211)]||0x0,'amountAfterCommissionUSDT':_0x216a67[_0x103c46(0x1b5)][_0x103c46(0x211)]||0x0,'commission':0x0}));return{'id':_0x4f9303['id'],'fullName':_0x4f9303[_0x103c46(0x232)],'username':_0x4f9303[_0x103c46(0x1a9)],'telegramId':_0x4f9303[_0x103c46(0x197)],'merchantUrl':_0x4f9303[_0x103c46(0x218)],'wallets':{'usdtPolygonWallet':_0x4f9303[_0x103c46(0x1ec)],'usdtTrcWallet':_0x4f9303[_0x103c46(0x226)],'usdtErcWallet':_0x4f9303[_0x103c46(0x1fe)],'usdcPolygonWallet':_0x4f9303[_0x103c46(0x204)]},'totalAmountUSDT':_0x4f9303[_0x103c46(0x19d)],'totalAmountAfterCommissionUSDT':_0x4f9303[_0x103c46(0x19d)],'paymentsCount':_0x25303b,'oldestPaymentDate':_0x43474c?.[_0x103c46(0x22b)]||_0x4f9303[_0x103c46(0x170)],'gatewayBreakdown':_0x46f81b};})),_0x19b626=_0x1f9653[_0x331c53(0x1cf)]((_0x26cbaf,_0x5a28d1)=>_0x26cbaf+_0x5a28d1[_0x331c53(0x19d)],0x0),_0x29a12f=_0x19b626;return console[_0x331c53(0x196)](_0x331c53(0x1fd)+_0x4dd1e9+_0x331c53(0x1d2)+Math[_0x331c53(0x1da)](_0x29a12f*0x64)/0x64+_0x331c53(0x1bb)),{'merchants':_0x26c7ec,'pagination':{'page':_0x5da7d8,'limit':_0x4e1d33,'total':_0x4dd1e9,'totalPages':Math[_0x331c53(0x19b)](_0x4dd1e9/_0x4e1d33)},'summary':{'totalMerchants':_0x4dd1e9,'totalAmountUSDT':Math[_0x331c53(0x1da)](_0x19b626*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x331c53(0x1da)](_0x29a12f*0x64)/0x64}};}async[a35_0x2bc1e9(0x209)](_0x57f458){const _0x19ac5f=a35_0x2bc1e9,{shopId:_0x5e70cc,amount:_0x209ed5,network:_0xb81854,notes:_0x8e2385,periodFrom:_0x2a3090,periodTo:_0x1fcef9}=_0x57f458,_0x7b8f63=await database_1['default'][_0x19ac5f(0x1a2)](async _0x277f10=>{const _0x54d629=_0x19ac5f,_0x1f5240=await _0x277f10['shop']['findUnique']({'where':{'id':_0x5e70cc},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1f5240)throw new Error('Shop\x20not\x20found');console[_0x54d629(0x196)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x1f5240[_0x54d629(0x1a9)]+':'),console[_0x54d629(0x196)](_0x54d629(0x1b7)+_0x1f5240['balance'][_0x54d629(0x1a7)](0x6)+_0x54d629(0x171)),console[_0x54d629(0x196)](_0x54d629(0x1e5)+_0x209ed5['toFixed'](0x6)+_0x54d629(0x171)),console[_0x54d629(0x196)](_0x54d629(0x193)+_0x1f5240[_0x54d629(0x1ee)][_0x54d629(0x1a7)](0x6)+_0x54d629(0x171));if(_0x1f5240[_0x54d629(0x19d)]<_0x209ed5)throw new Error(_0x54d629(0x23b)+_0x1f5240[_0x54d629(0x19d)][_0x54d629(0x1a7)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x209ed5[_0x54d629(0x1a7)](0x6)+_0x54d629(0x171));const _0x5f876b=await _0x277f10[_0x54d629(0x18c)]['create']({'data':{'shopId':_0x5e70cc,'amount':_0x209ed5,'network':_0xb81854,'status':_0x54d629(0x1e1),'notes':_0x8e2385,'periodFrom':_0x2a3090?new Date(_0x2a3090):null,'periodTo':_0x1fcef9?new Date(_0x1fcef9):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3a264d=_0x1f5240[_0x54d629(0x19d)]-_0x209ed5,_0xdee732=_0x1f5240[_0x54d629(0x1ee)]+_0x209ed5;return await _0x277f10['shop']['update']({'where':{'id':_0x5e70cc},'data':{'balance':_0x3a264d,'totalPaidOut':_0xdee732}}),console[_0x54d629(0x196)](_0x54d629(0x1f6)+_0x1f5240[_0x54d629(0x1a9)]+_0x54d629(0x18b)),console[_0x54d629(0x196)](_0x54d629(0x1b2)+_0x1f5240[_0x54d629(0x19d)][_0x54d629(0x1a7)](0x6)+_0x54d629(0x19c)+_0x3a264d[_0x54d629(0x1a7)](0x6)+_0x54d629(0x173)+_0x209ed5['toFixed'](0x6)+')'),console['log'](_0x54d629(0x224)+_0x1f5240['totalPaidOut']['toFixed'](0x6)+_0x54d629(0x19c)+_0xdee732['toFixed'](0x6)+_0x54d629(0x215)+_0x209ed5[_0x54d629(0x1a7)](0x6)+')'),{'payout':_0x5f876b,'shop':_0x1f5240};});return console[_0x19ac5f(0x196)](_0x19ac5f(0x23e)+_0x7b8f63['payout']['id']+'\x20for\x20shop\x20'+_0x7b8f63['shop'][_0x19ac5f(0x1a9)]+'\x20('+_0x209ed5+_0x19ac5f(0x1f3)),{'id':_0x7b8f63['payout']['id'],'shopId':_0x7b8f63[_0x19ac5f(0x18c)][_0x19ac5f(0x1b1)],'shopName':_0x7b8f63[_0x19ac5f(0x244)][_0x19ac5f(0x232)],'shopUsername':_0x7b8f63[_0x19ac5f(0x244)][_0x19ac5f(0x1a9)],'amount':_0x7b8f63[_0x19ac5f(0x18c)]['amount'],'network':_0x7b8f63[_0x19ac5f(0x18c)][_0x19ac5f(0x174)],'status':_0x7b8f63['payout'][_0x19ac5f(0x17a)],'txid':_0x7b8f63['payout']['txid'],'notes':_0x7b8f63[_0x19ac5f(0x18c)][_0x19ac5f(0x187)],'periodFrom':_0x7b8f63[_0x19ac5f(0x18c)]['periodFrom'],'periodTo':_0x7b8f63[_0x19ac5f(0x18c)][_0x19ac5f(0x1a3)],'createdAt':_0x7b8f63[_0x19ac5f(0x18c)]['createdAt'],'paidAt':_0x7b8f63['payout'][_0x19ac5f(0x22b)]};}async[a35_0x2bc1e9(0x235)](_0x4ba837){const _0xcce62e=a35_0x2bc1e9,{page:_0x24e8d5,limit:_0x3bba90,shopId:_0x4e24d6,network:_0x21481f,dateFrom:_0x4a93a7,dateTo:_0x1f3325,search:_0x59f0cd}=_0x4ba837,_0x2e7cb0=(_0x24e8d5-0x1)*_0x3bba90,_0x49780f={};_0x4e24d6&&(_0x49780f[_0xcce62e(0x1b1)]=_0x4e24d6);_0x21481f&&(_0x49780f[_0xcce62e(0x174)]=_0x21481f);(_0x4a93a7||_0x1f3325)&&(_0x49780f[_0xcce62e(0x170)]={},_0x4a93a7&&(_0x49780f[_0xcce62e(0x170)][_0xcce62e(0x214)]=new Date(_0x4a93a7)),_0x1f3325&&(_0x49780f[_0xcce62e(0x170)][_0xcce62e(0x20d)]=new Date(_0x1f3325)));_0x59f0cd&&(_0x49780f['OR']=[{'shop':{'name':{'contains':_0x59f0cd,'mode':_0xcce62e(0x18d)}}},{'shop':{'username':{'contains':_0x59f0cd,'mode':_0xcce62e(0x18d)}}},{'notes':{'contains':_0x59f0cd,'mode':_0xcce62e(0x18d)}}]);const [_0x3fb53e,_0x3ffb7f]=await Promise[_0xcce62e(0x1ca)]([database_1[_0xcce62e(0x179)][_0xcce62e(0x18c)][_0xcce62e(0x198)]({'where':_0x49780f,'skip':_0x2e7cb0,'take':_0x3bba90,'orderBy':{'createdAt':_0xcce62e(0x1a6)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xcce62e(0x179)][_0xcce62e(0x18c)][_0xcce62e(0x18a)]({'where':_0x49780f})]);return{'payouts':_0x3fb53e['map'](_0x167575=>({'id':_0x167575['id'],'shopId':_0x167575['shopId'],'shopName':_0x167575[_0xcce62e(0x244)]['name'],'shopUsername':_0x167575[_0xcce62e(0x244)][_0xcce62e(0x1a9)],'amount':_0x167575[_0xcce62e(0x1f8)],'network':_0x167575['network'],'status':_0x167575[_0xcce62e(0x17a)],'txid':_0x167575[_0xcce62e(0x18e)],'notes':_0x167575[_0xcce62e(0x187)],'periodFrom':_0x167575[_0xcce62e(0x1c6)],'periodTo':_0x167575[_0xcce62e(0x1a3)],'createdAt':_0x167575[_0xcce62e(0x170)],'paidAt':_0x167575[_0xcce62e(0x22b)]})),'pagination':{'page':_0x24e8d5,'limit':_0x3bba90,'total':_0x3ffb7f,'totalPages':Math[_0xcce62e(0x19b)](_0x3ffb7f/_0x3bba90)}};}async['getPayoutById'](_0x4f8aaf){const _0x480f3f=a35_0x2bc1e9,_0x3549bc=await database_1[_0x480f3f(0x179)][_0x480f3f(0x18c)][_0x480f3f(0x16f)]({'where':{'id':_0x4f8aaf},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3549bc)return null;return{'id':_0x3549bc['id'],'shopId':_0x3549bc[_0x480f3f(0x1b1)],'shopName':_0x3549bc[_0x480f3f(0x244)]['name'],'shopUsername':_0x3549bc['shop'][_0x480f3f(0x1a9)],'amount':_0x3549bc['amount'],'network':_0x3549bc[_0x480f3f(0x174)],'status':_0x3549bc[_0x480f3f(0x17a)],'txid':_0x3549bc[_0x480f3f(0x18e)],'notes':_0x3549bc[_0x480f3f(0x187)],'periodFrom':_0x3549bc[_0x480f3f(0x1c6)],'periodTo':_0x3549bc['periodTo'],'createdAt':_0x3549bc[_0x480f3f(0x170)],'paidAt':_0x3549bc['paidAt']};}async['deletePayout'](_0x3671e3){const _0x2293af=a35_0x2bc1e9;await database_1[_0x2293af(0x179)]['payout'][_0x2293af(0x1b9)]({'where':{'id':_0x3671e3}});}async[a35_0x2bc1e9(0x188)](_0x34c67a){const _0xe96ac2=a35_0x2bc1e9,{page:_0x39be20,limit:_0x25bb9e,status:_0x59dd9c,gateway:_0x3e7307,shopId:_0x40828a,dateFrom:_0x2f3015,dateTo:_0x1b28e3,search:_0x4b4049}=_0x34c67a,_0x1e05f3=(_0x39be20-0x1)*_0x25bb9e,_0x4b0632={};_0x59dd9c&&(_0x4b0632[_0xe96ac2(0x17a)]=_0x59dd9c[_0xe96ac2(0x201)]());_0x3e7307&&(_0x4b0632[_0xe96ac2(0x221)]=_0x3e7307[_0xe96ac2(0x19a)]());_0x4b0632[_0xe96ac2(0x221)]=_0x4b0632[_0xe96ac2(0x221)]?_0x4b0632[_0xe96ac2(0x221)]:{'not':_0xe96ac2(0x202)};if(typeof _0x4b0632[_0xe96ac2(0x221)]==='string'&&_0x4b0632[_0xe96ac2(0x221)]!==_0xe96ac2(0x202)){}else{if(typeof _0x4b0632['gateway']===_0xe96ac2(0x1ff)&&_0x4b0632['gateway']===_0xe96ac2(0x202)){}else _0x4b0632[_0xe96ac2(0x221)]={'not':_0xe96ac2(0x202)};}_0x40828a&&(_0x4b0632[_0xe96ac2(0x1b1)]=_0x40828a);(_0x2f3015||_0x1b28e3)&&(_0x4b0632[_0xe96ac2(0x170)]={},_0x2f3015&&(_0x4b0632['createdAt'][_0xe96ac2(0x214)]=new Date(_0x2f3015)),_0x1b28e3&&(_0x4b0632[_0xe96ac2(0x170)]['lte']=new Date(_0x1b28e3)));_0x4b4049&&(_0x4b0632['OR']=[{'orderId':{'contains':_0x4b4049,'mode':_0xe96ac2(0x18d)}},{'gatewayOrderId':{'contains':_0x4b4049,'mode':_0xe96ac2(0x18d)}},{'customerEmail':{'contains':_0x4b4049,'mode':_0xe96ac2(0x18d)}},{'shop':{'name':{'contains':_0x4b4049,'mode':_0xe96ac2(0x18d)}}},{'shop':{'username':{'contains':_0x4b4049,'mode':'insensitive'}}}]);const [_0x113368,_0x189d01]=await Promise[_0xe96ac2(0x1ca)]([database_1['default'][_0xe96ac2(0x230)][_0xe96ac2(0x198)]({'where':_0x4b0632,'skip':_0x1e05f3,'take':_0x25bb9e,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0xe96ac2(0x230)]['count']({'where':_0x4b0632})]);return{'payments':_0x113368[_0xe96ac2(0x22a)](_0x13c663=>({'id':_0x13c663['id'],'shopId':_0x13c663[_0xe96ac2(0x1b1)],'gateway':_0x13c663[_0xe96ac2(0x221)],'amount':_0x13c663[_0xe96ac2(0x1f8)],'currency':_0x13c663[_0xe96ac2(0x1a5)],'status':_0x13c663['status'],'orderId':_0x13c663[_0xe96ac2(0x178)],'gatewayOrderId':_0x13c663[_0xe96ac2(0x181)],'customerEmail':_0x13c663[_0xe96ac2(0x1bd)],'customerName':_0x13c663[_0xe96ac2(0x205)],'customerCountry':_0x13c663[_0xe96ac2(0x206)],'customerIp':_0x13c663[_0xe96ac2(0x23f)],'customerUa':_0x13c663[_0xe96ac2(0x1e7)],'failureMessage':_0x13c663[_0xe96ac2(0x1a1)],'createdAt':_0x13c663[_0xe96ac2(0x170)],'updatedAt':_0x13c663[_0xe96ac2(0x1c1)],'shop':_0x13c663['shop']})),'pagination':{'page':_0x39be20,'limit':_0x25bb9e,'total':_0x189d01,'totalPages':Math[_0xe96ac2(0x19b)](_0x189d01/_0x25bb9e)}};}async[a35_0x2bc1e9(0x227)](_0x4999aa){const _0x21e166=a35_0x2bc1e9,_0x203b24=await database_1[_0x21e166(0x179)][_0x21e166(0x230)][_0x21e166(0x16f)]({'where':{'id':_0x4999aa},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x203b24)return null;return{'id':_0x203b24['id'],'shopId':_0x203b24[_0x21e166(0x1b1)],'gateway':_0x203b24[_0x21e166(0x221)],'amount':_0x203b24[_0x21e166(0x1f8)],'currency':_0x203b24[_0x21e166(0x1a5)],'status':_0x203b24['status'],'orderId':_0x203b24[_0x21e166(0x178)],'gatewayOrderId':_0x203b24['gatewayOrderId'],'customerEmail':_0x203b24[_0x21e166(0x1bd)],'customerName':_0x203b24['customerName'],'customerCountry':_0x203b24[_0x21e166(0x206)],'customerIp':_0x203b24['customerIp'],'customerUa':_0x203b24[_0x21e166(0x1e7)],'failureMessage':_0x203b24[_0x21e166(0x1a1)],'externalPaymentUrl':_0x203b24['externalPaymentUrl'],'successUrl':_0x203b24[_0x21e166(0x20e)],'failUrl':_0x203b24['failUrl'],'pendingUrl':_0x203b24[_0x21e166(0x185)],'whiteUrl':_0x203b24['whiteUrl'],'createdAt':_0x203b24[_0x21e166(0x170)],'updatedAt':_0x203b24[_0x21e166(0x1c1)],'shop':_0x203b24[_0x21e166(0x244)]};}async[a35_0x2bc1e9(0x1e3)](_0x379712,_0xc5caef,_0x12e36c,_0x218492){const _0x1a1549=a35_0x2bc1e9,_0x4ccb9a=await database_1[_0x1a1549(0x179)][_0x1a1549(0x1a2)](async _0x80085=>{const _0x280391=_0x1a1549,_0x188bd6=await _0x80085[_0x280391(0x230)][_0x280391(0x16f)]({'where':{'id':_0x379712},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x188bd6)throw new Error(_0x280391(0x22f));const _0x436fd1=_0x188bd6['status'],_0x22907d=_0xc5caef[_0x280391(0x201)]();console['log'](_0x280391(0x1d0)+_0x379712+_0x280391(0x216)+_0x436fd1+_0x280391(0x19c)+_0x22907d),console[_0x280391(0x196)]('💰\x20Current\x20shop\x20balance:\x20'+_0x188bd6['shop']['balance']+_0x280391(0x171));const _0x5b1255={'status':_0x22907d,'updatedAt':new Date(),'statusChangedBy':_0x280391(0x1aa),'statusChangedAt':new Date()};_0x12e36c&&(_0x5b1255['adminNotes']=_0x12e36c);_0x22907d===_0x280391(0x236)&&_0x218492&&(_0x5b1255['chargebackAmount']=_0x218492);let _0x89578a=0x0,_0x308342=_0x188bd6[_0x280391(0x244)]['balance'];if(_0x22907d===_0x280391(0x1fa)&&_0x436fd1!==_0x280391(0x1fa)){_0x5b1255[_0x280391(0x22b)]=new Date();const _0x47ee7b=await currencyService_1[_0x280391(0x19e)][_0x280391(0x1a8)](_0x188bd6['amount'],_0x188bd6[_0x280391(0x1a5)]);_0x5b1255[_0x280391(0x211)]=_0x47ee7b,_0x89578a=_0x47ee7b,_0x308342+=_0x47ee7b,console[_0x280391(0x196)]('💰\x20Payment\x20'+_0x379712+'\x20became\x20PAID:\x20+'+_0x47ee7b[_0x280391(0x1a7)](0x6)+_0x280391(0x1f0));}else _0x436fd1==='PAID'&&_0x22907d!=='PAID'&&(_0x188bd6[_0x280391(0x211)]&&(_0x89578a=-_0x188bd6[_0x280391(0x211)],_0x308342-=_0x188bd6['amountUSDT'],_0x5b1255[_0x280391(0x211)]=null,console[_0x280391(0x196)](_0x280391(0x1e4)+_0x379712+'\x20no\x20longer\x20PAID:\x20-'+_0x188bd6[_0x280391(0x211)][_0x280391(0x1a7)](0x6)+_0x280391(0x1d6))));if(_0x22907d==='CHARGEBACK'){if(_0x436fd1===_0x280391(0x1fa)&&_0x188bd6[_0x280391(0x211)]){}_0x218492&&_0x218492>0x0&&(_0x89578a-=_0x218492,_0x308342-=_0x218492,console[_0x280391(0x196)](_0x280391(0x1d1)+_0x218492[_0x280391(0x1a7)](0x6)+_0x280391(0x1d6)));}_0x22907d==='REFUND'&&_0x436fd1==='PAID'&&console[_0x280391(0x196)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x4035b0=await _0x80085[_0x280391(0x230)]['update']({'where':{'id':_0x379712},'data':_0x5b1255,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x89578a!==0x0&&(await _0x80085[_0x280391(0x244)][_0x280391(0x1ac)]({'where':{'id':_0x188bd6['shopId']},'data':{'balance':_0x308342}}),console[_0x280391(0x196)](_0x280391(0x1f6)+_0x188bd6[_0x280391(0x1b1)]+'\x20balance\x20updated:\x20'+_0x188bd6[_0x280391(0x244)][_0x280391(0x19d)][_0x280391(0x1a7)](0x6)+_0x280391(0x19c)+_0x308342[_0x280391(0x1a7)](0x6)+_0x280391(0x17f)+(_0x89578a>0x0?'+':'')+_0x89578a[_0x280391(0x1a7)](0x6)+')')),_0x4035b0;});return{'id':_0x4ccb9a['id'],'shopId':_0x4ccb9a[_0x1a1549(0x1b1)],'gateway':_0x4ccb9a[_0x1a1549(0x221)],'amount':_0x4ccb9a['amount'],'currency':_0x4ccb9a[_0x1a1549(0x1a5)],'status':_0x4ccb9a[_0x1a1549(0x17a)],'orderId':_0x4ccb9a[_0x1a1549(0x178)],'gatewayOrderId':_0x4ccb9a['gatewayOrderId'],'customerEmail':_0x4ccb9a[_0x1a1549(0x1bd)],'customerName':_0x4ccb9a[_0x1a1549(0x205)],'customerCountry':_0x4ccb9a[_0x1a1549(0x206)],'customerIp':_0x4ccb9a['customerIp'],'customerUa':_0x4ccb9a[_0x1a1549(0x1e7)],'failureMessage':_0x4ccb9a[_0x1a1549(0x1a1)],'adminNotes':_0x4ccb9a[_0x1a1549(0x237)],'chargebackAmount':_0x4ccb9a[_0x1a1549(0x213)],'statusChangedBy':_0x4ccb9a['statusChangedBy'],'statusChangedAt':_0x4ccb9a['statusChangedAt'],'createdAt':_0x4ccb9a[_0x1a1549(0x170)],'updatedAt':_0x4ccb9a['updatedAt'],'shop':_0x4ccb9a[_0x1a1549(0x244)]};}async[a35_0x2bc1e9(0x20c)](_0x122bfd,_0x580e3f){const _0x57e649=a35_0x2bc1e9,_0x320ae4={..._0x580e3f};_0x580e3f['password']&&(_0x320ae4[_0x57e649(0x1cb)]=await bcryptjs_1[_0x57e649(0x179)][_0x57e649(0x175)](_0x580e3f[_0x57e649(0x1cb)],0xc));_0x580e3f[_0x57e649(0x17c)]&&(_0x320ae4[_0x57e649(0x232)]=_0x580e3f[_0x57e649(0x17c)],delete _0x320ae4[_0x57e649(0x17c)]);_0x580e3f[_0x57e649(0x1d9)]&&(_0x320ae4[_0x57e649(0x197)]=_0x580e3f[_0x57e649(0x1d9)],delete _0x320ae4['telegramId']);_0x580e3f[_0x57e649(0x1c4)]&&(_0x320ae4[_0x57e649(0x218)]=_0x580e3f['merchantUrl'],delete _0x320ae4['merchantUrl']);_0x580e3f[_0x57e649(0x1c7)]&&(_0x320ae4[_0x57e649(0x1e6)]=JSON[_0x57e649(0x1be)](_0x580e3f[_0x57e649(0x1c7)]),delete _0x320ae4[_0x57e649(0x1c7)]);_0x580e3f[_0x57e649(0x23d)]&&(_0x320ae4[_0x57e649(0x23d)]=JSON['stringify'](_0x580e3f[_0x57e649(0x23d)]),delete _0x320ae4[_0x57e649(0x23d)]);_0x580e3f[_0x57e649(0x19f)]&&(_0x580e3f[_0x57e649(0x19f)][_0x57e649(0x1ec)]!==undefined&&(_0x320ae4[_0x57e649(0x1ec)]=_0x580e3f['wallets'][_0x57e649(0x1ec)]||null),_0x580e3f['wallets'][_0x57e649(0x226)]!==undefined&&(_0x320ae4[_0x57e649(0x226)]=_0x580e3f[_0x57e649(0x19f)]['usdtTrcWallet']||null),_0x580e3f[_0x57e649(0x19f)][_0x57e649(0x1fe)]!==undefined&&(_0x320ae4['usdtErcWallet']=_0x580e3f[_0x57e649(0x19f)][_0x57e649(0x1fe)]||null),_0x580e3f[_0x57e649(0x19f)][_0x57e649(0x204)]!==undefined&&(_0x320ae4[_0x57e649(0x204)]=_0x580e3f[_0x57e649(0x19f)][_0x57e649(0x204)]||null),delete _0x320ae4['wallets']);const _0x5194b4=await database_1['default']['shop'][_0x57e649(0x1ac)]({'where':{'id':_0x122bfd},'data':_0x320ae4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5194b4['id'],'fullName':_0x5194b4['name'],'username':_0x5194b4['username'],'telegramId':_0x5194b4[_0x57e649(0x197)],'merchantUrl':_0x5194b4[_0x57e649(0x218)],'gateways':_0x5194b4['paymentGateways']?JSON[_0x57e649(0x228)](_0x5194b4[_0x57e649(0x1e6)]):null,'gatewaySettings':_0x5194b4[_0x57e649(0x23d)]?JSON['parse'](_0x5194b4['gatewaySettings']):null,'publicKey':_0x5194b4[_0x57e649(0x1ab)],'wallets':{'usdtPolygonWallet':_0x5194b4[_0x57e649(0x1ec)],'usdtTrcWallet':_0x5194b4[_0x57e649(0x226)],'usdtErcWallet':_0x5194b4[_0x57e649(0x1fe)],'usdcPolygonWallet':_0x5194b4[_0x57e649(0x204)]},'status':_0x5194b4[_0x57e649(0x17a)],'createdAt':_0x5194b4[_0x57e649(0x170)]};}async[a35_0x2bc1e9(0x21b)](_0x220f57){const _0x1ed334=a35_0x2bc1e9,_0x4ce1ed=await database_1[_0x1ed334(0x179)][_0x1ed334(0x244)]['update']({'where':{'id':_0x220f57},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4ce1ed['id'],'fullName':_0x4ce1ed[_0x1ed334(0x232)],'username':_0x4ce1ed[_0x1ed334(0x1a9)],'telegramId':_0x4ce1ed[_0x1ed334(0x197)],'merchantUrl':_0x4ce1ed[_0x1ed334(0x218)],'gateways':_0x4ce1ed[_0x1ed334(0x1e6)]?JSON[_0x1ed334(0x228)](_0x4ce1ed[_0x1ed334(0x1e6)]):null,'gatewaySettings':_0x4ce1ed[_0x1ed334(0x23d)]?JSON[_0x1ed334(0x228)](_0x4ce1ed[_0x1ed334(0x23d)]):null,'publicKey':_0x4ce1ed[_0x1ed334(0x1ab)],'wallets':{'usdtPolygonWallet':_0x4ce1ed['usdtPolygonWallet'],'usdtTrcWallet':_0x4ce1ed[_0x1ed334(0x226)],'usdtErcWallet':_0x4ce1ed[_0x1ed334(0x1fe)],'usdcPolygonWallet':_0x4ce1ed[_0x1ed334(0x204)]},'status':_0x4ce1ed[_0x1ed334(0x17a)],'createdAt':_0x4ce1ed[_0x1ed334(0x170)]};}async['activateUser'](_0x1a252e){const _0x216d59=a35_0x2bc1e9,_0x46f4c9=await database_1[_0x216d59(0x179)][_0x216d59(0x244)][_0x216d59(0x1ac)]({'where':{'id':_0x1a252e},'data':{'status':_0x216d59(0x239)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x46f4c9['id'],'fullName':_0x46f4c9[_0x216d59(0x232)],'username':_0x46f4c9[_0x216d59(0x1a9)],'telegramId':_0x46f4c9['telegram'],'merchantUrl':_0x46f4c9['shopUrl'],'gateways':_0x46f4c9['paymentGateways']?JSON[_0x216d59(0x228)](_0x46f4c9[_0x216d59(0x1e6)]):null,'gatewaySettings':_0x46f4c9[_0x216d59(0x23d)]?JSON['parse'](_0x46f4c9[_0x216d59(0x23d)]):null,'publicKey':_0x46f4c9[_0x216d59(0x1ab)],'wallets':{'usdtPolygonWallet':_0x46f4c9[_0x216d59(0x1ec)],'usdtTrcWallet':_0x46f4c9['usdtTrcWallet'],'usdtErcWallet':_0x46f4c9['usdtErcWallet'],'usdcPolygonWallet':_0x46f4c9[_0x216d59(0x204)]},'status':_0x46f4c9[_0x216d59(0x17a)],'createdAt':_0x46f4c9[_0x216d59(0x170)]};}async[a35_0x2bc1e9(0x199)](_0x2d4129){const _0x3f81db=a35_0x2bc1e9,{page:_0x3dde51,limit:_0x11c429,status:_0x24ca0c}=_0x2d4129,_0x32bc1b=(_0x3dde51-0x1)*_0x11c429,_0x4989c3={};_0x24ca0c&&(_0x4989c3[_0x3f81db(0x17a)]=_0x24ca0c[_0x3f81db(0x201)]());const [_0x141153,_0x2df22]=await Promise[_0x3f81db(0x1ca)]([database_1[_0x3f81db(0x179)][_0x3f81db(0x244)][_0x3f81db(0x198)]({'where':_0x4989c3,'skip':_0x32bc1b,'take':_0x11c429,'orderBy':{'createdAt':_0x3f81db(0x1a6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3f81db(0x179)]['shop']['count']({'where':_0x4989c3})]);return{'users':_0x141153[_0x3f81db(0x22a)](_0x4edf3a=>({'id':_0x4edf3a['id'],'fullName':_0x4edf3a[_0x3f81db(0x232)],'username':_0x4edf3a[_0x3f81db(0x1a9)],'telegramId':_0x4edf3a[_0x3f81db(0x197)],'merchantUrl':_0x4edf3a[_0x3f81db(0x218)],'gateways':_0x4edf3a[_0x3f81db(0x1e6)]?JSON['parse'](_0x4edf3a[_0x3f81db(0x1e6)]):null,'gatewaySettings':_0x4edf3a[_0x3f81db(0x23d)]?JSON['parse'](_0x4edf3a[_0x3f81db(0x23d)]):null,'publicKey':_0x4edf3a[_0x3f81db(0x1ab)],'wallets':{'usdtPolygonWallet':_0x4edf3a[_0x3f81db(0x1ec)],'usdtTrcWallet':_0x4edf3a[_0x3f81db(0x226)],'usdtErcWallet':_0x4edf3a[_0x3f81db(0x1fe)],'usdcPolygonWallet':_0x4edf3a[_0x3f81db(0x204)]},'status':_0x4edf3a['status'],'createdAt':_0x4edf3a[_0x3f81db(0x170)]})),'pagination':{'page':_0x3dde51,'limit':_0x11c429,'total':_0x2df22,'totalPages':Math[_0x3f81db(0x19b)](_0x2df22/_0x11c429)}};}async['getUserById'](_0x1db5ab){const _0x206089=a35_0x2bc1e9,_0x390772=await database_1[_0x206089(0x179)]['shop'][_0x206089(0x16f)]({'where':{'id':_0x1db5ab},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x390772)return null;return{'id':_0x390772['id'],'fullName':_0x390772[_0x206089(0x232)],'username':_0x390772[_0x206089(0x1a9)],'telegramId':_0x390772[_0x206089(0x197)],'merchantUrl':_0x390772[_0x206089(0x218)],'gateways':_0x390772['paymentGateways']?JSON[_0x206089(0x228)](_0x390772[_0x206089(0x1e6)]):null,'gatewaySettings':_0x390772[_0x206089(0x23d)]?JSON['parse'](_0x390772[_0x206089(0x23d)]):null,'publicKey':_0x390772[_0x206089(0x1ab)],'wallets':{'usdtPolygonWallet':_0x390772['usdtPolygonWallet'],'usdtTrcWallet':_0x390772[_0x206089(0x226)],'usdtErcWallet':_0x390772[_0x206089(0x1fe)],'usdcPolygonWallet':_0x390772[_0x206089(0x204)]},'status':_0x390772[_0x206089(0x17a)],'createdAt':_0x390772[_0x206089(0x170)]};}async[a35_0x2bc1e9(0x238)](_0x174df){const _0x5e39d7=a35_0x2bc1e9,{fullName:_0x5d4842,username:_0x1a30ac,password:_0x5cee47,telegramId:_0x362971,merchantUrl:_0x363d59,gateways:_0x1e555d,gatewaySettings:_0x135c5a,wallets:_0x66895b}=_0x174df,_0x49eafa=await database_1[_0x5e39d7(0x179)][_0x5e39d7(0x244)][_0x5e39d7(0x16f)]({'where':{'username':_0x1a30ac}});if(_0x49eafa)throw new Error(_0x5e39d7(0x1f1));if(_0x362971){const _0x405933=await database_1[_0x5e39d7(0x179)][_0x5e39d7(0x244)][_0x5e39d7(0x16f)]({'where':{'telegram':_0x362971}});if(_0x405933)throw new Error(_0x5e39d7(0x189));}const _0x2528d2=await bcryptjs_1[_0x5e39d7(0x179)][_0x5e39d7(0x175)](_0x5cee47,0xc),_0x115a7e=_0x5e39d7(0x17b)+crypto_1[_0x5e39d7(0x179)][_0x5e39d7(0x21f)](0x20)[_0x5e39d7(0x182)](_0x5e39d7(0x23a)),_0x42ccea='sk_'+crypto_1['default'][_0x5e39d7(0x21f)](0x20)[_0x5e39d7(0x182)]('hex'),_0x5451a3=await database_1[_0x5e39d7(0x179)]['shop']['create']({'data':{'name':_0x5d4842,'username':_0x1a30ac,'password':_0x2528d2,'telegram':_0x362971,'shopUrl':_0x363d59,'paymentGateways':_0x1e555d?JSON[_0x5e39d7(0x1be)](_0x1e555d):null,'gatewaySettings':_0x135c5a?JSON[_0x5e39d7(0x1be)](_0x135c5a):null,'usdtPolygonWallet':_0x66895b?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x66895b?.[_0x5e39d7(0x226)]||null,'usdtErcWallet':_0x66895b?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x66895b?.[_0x5e39d7(0x204)]||null,'publicKey':_0x115a7e,'secretKey':_0x42ccea,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5451a3['id'],'fullName':_0x5451a3['name'],'username':_0x5451a3['username'],'telegramId':_0x5451a3[_0x5e39d7(0x197)],'merchantUrl':_0x5451a3[_0x5e39d7(0x218)],'gateways':_0x5451a3[_0x5e39d7(0x1e6)]?JSON[_0x5e39d7(0x228)](_0x5451a3[_0x5e39d7(0x1e6)]):null,'gatewaySettings':_0x5451a3[_0x5e39d7(0x23d)]?JSON[_0x5e39d7(0x228)](_0x5451a3['gatewaySettings']):null,'publicKey':_0x5451a3['publicKey'],'wallets':{'usdtPolygonWallet':_0x5451a3[_0x5e39d7(0x1ec)],'usdtTrcWallet':_0x5451a3[_0x5e39d7(0x226)],'usdtErcWallet':_0x5451a3['usdtErcWallet'],'usdcPolygonWallet':_0x5451a3[_0x5e39d7(0x204)]},'status':_0x5451a3[_0x5e39d7(0x17a)],'createdAt':_0x5451a3[_0x5e39d7(0x170)]};}async[a35_0x2bc1e9(0x21c)](_0x478e3a){const _0x51915e=a35_0x2bc1e9;await database_1['default'][_0x51915e(0x244)][_0x51915e(0x1b9)]({'where':{'id':_0x478e3a}});}}function a35_0x550e(){const _0x1747b8=['\x20paid\x20payments\x20for\x20analysis','suspendUser','deleteUser','\x20\x20\x20💵\x20Available\x20balance:\x20','period','randomBytes','37qFbhvm','gateway','getMerchantStatistics','30d','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20🌐\x20IP:\x20','usdtTrcWallet','getPaymentById','parse','custom','map','paidAt','totalTurnover','averageCheckUSDT','56864BRngJC','Payment\x20not\x20found','payment','./currencyService','name','1492taSwpn','getGatewayDisplayName','getAllPayouts','CHARGEBACK','adminNotes','createUser','ACTIVE','hex','Insufficient\x20balance.\x20Available:\x20','\x20\x20\x20📅\x20This\x20month:\x20','gatewaySettings','✅\x20Payout\x20created:\x20','customerIp','💰\x20Found\x20','\x20\x20\x20💰\x20Total\x20payout:\x20','📊\x20Merchant\x20statistics\x20calculated:','length','shop','set','findUnique','createdAt','\x20USDT','AdminService','\x20USDT\x20(-','network','hash','groupBy','getPayoutStats','orderId','default','status','pk_','fullName','getSystemStatistics','\x20USDT\x20(total\x20merchant\x20balances)','\x20USDT\x20(','forEach','gatewayOrderId','toString','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20merchants\x20with\x20positive\x20balance','pendingUrl','not\x20set','notes','getAllPayments','Telegram\x20username\x20already\x20exists','count','\x20balance\x20updated:','payout','insensitive','txid','year','Noda','merchantEarningsUSDT','crypto','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','📊\x20Calculating\x20payout\x20statistics...','\x20USDT\x20(total\x20paid\x20to\x20merchants)','log','telegram','findMany','getAllUsers','toLowerCase','ceil','\x20->\x20','balance','currencyService','wallets','354563ECCJDX','failureMessage','$transaction','periodTo','month','currency','desc','toFixed','convertToUSDT','username','admin','publicKey','update','totalPayout','dateTo','getMerchantsAwaitingPayout','paidOutUSDT','shopId','\x20\x20\x20Balance:\x20','values','localeCompare','_sum','getMonth','\x20\x20\x20Current\x20balance:\x20','turnover','delete','237039JmdspA','\x20USDT\x20total','gatewayEarnings','customerEmail','stringify','150kwcVWG','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','updatedAt','defineProperty','averageCommissionRate','merchantUrl','Plisio','periodFrom','gateways','date','updateCustomerData','all','password','../config/database','\x20\x20\x20💰\x20Total\x20turnover:\x20','45zZONaf','reduce','🔄\x20Admin\x20updating\x20payment\x20','💸\x20CHARGEBACK\x20penalty:\x20-','\x20merchants,\x20','3439632KWnFuE','totalPayments','bcryptjs','\x20USDT\x20from\x20balance','565299LebKYL','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','telegramId','round','getTime','awaitingPayout','KLYME\x20DE','KLYME\x20GB','68620xfdGwc','toISOString','COMPLETED','merchantEarnings','updatePaymentStatus','💰\x20Payment\x20','\x20\x20\x20Payout\x20amount:\x20','paymentGateways','customerUa','paymentsCount','90d','availableBalance','__esModule','usdtPolygonWallet','📊\x20Payout\x20statistics\x20calculated:','totalPaidOut','sort','\x20USDT\x20to\x20balance','Username\x20already\x20exists','Rapyd','\x20USDT)','dateFrom','asc','💰\x20Shop\x20','error','amount','turnoverUSDT','PAID','CoinToPay','\x20\x20\x20🌍\x20Country:\x20','📊\x20Merchants\x20awaiting\x20payout:\x20','usdtErcWallet','string','KLYME\x20EU','toUpperCase','test_gateway','__importDefault','usdcPolygonWallet','customerName','customerCountry','4630xjJLTK','aggregate','createPayout','commissionUSDT','📅\x20Period:\x20','updateUser','lte','successUrl','findFirst','getFullYear','amountUSDT','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','chargebackAmount','gte','\x20USDT\x20(+','\x20status:\x20','Error\x20processing\x20payment\x20','shopUrl','totalCommissionRate'];a35_0x550e=function(){return _0x1747b8;};return a35_0x550e();}exports[a35_0x2bc1e9(0x172)]=AdminService;