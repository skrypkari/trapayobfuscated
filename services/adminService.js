'use strict';function a35_0xb3b9(){const _0x2bf18e=['594988DAaNbG','dateTo','Shop\x20not\x20found','error','shop','Username\x20already\x20exists','commission','CoinToPay','üîÑ\x20Gateway\x20mapping:','\x20\x20\x20Balance:\x20','log','\x20to\x20','getAllUsers','getMonth','customerIp','paymentsCount','currency','SUSPENDED','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','../types/gateway','suspendUser','customerCountry','AdminService','aggregate','usdtErcWallet','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','dailyPayments','periodFrom','rapyd','$transaction','merchantUrl','awaitingPayout','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','revenue','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20USDT\x20(theoretical\x20net)','password','\x20for\x20shop\x20','hex','\x20\x20\x20Current\x20balance:\x20','gte','updateUser','_count','availableBalance','\x20USDT','includes','\x20paid\x20payments\x20for\x20analysis','map','test_gateway','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','customerUa','thisMonth','../config/database','Open\x20Banking\x202','not\x20specified','join','averageCommissionRate','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','klyme_de','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','crypto','custom','2306848IeXsVM','txid','parse','\x20\x20\x20Payout\x20amount:\x20','update','90d','groupBy','\x20\x20\x20üíµ\x20Available\x20balance:\x20','üìã\x20Found\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','üìä\x20Gateway\x20filter\x20applied:','customerEmail','publicKey','getGatewayInternalName','convertToUSDT','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','reduce','Telegram\x20username\x20already\x20exists','üîÑ\x20Gateway\x20mapping\x20(create):','notes','üí±\x20Currency\x20filter\x20applied:\x20','\x20\x20\x20Merchant\x20gets:\x20','stringify','\x20in\x20','%\x20commission)','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','üîÑ\x20Admin\x20updating\x20payment\x20','deleteUser','failUrl','üîÑ\x20Converted\x20gateway\x20name\x20\x27','payout','Insufficient\x20balance.\x20Available:\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','entries','üìä\x20Sorting\x20payments\x20by\x20','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','getFullYear','COMPLETED','üìä\x20Final\x20WHERE\x20conditions:','findUnique','toString','1326iMeQnW','statusChangedBy','usdtTrcWallet','totalTurnover','KLYME\x20DE','successUrl','pendingUrl','default','totalAmountAfterCommissionUSDT','hash','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','getDate','totalPayout','toLowerCase','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','turnoverUSDT','\x20merchants','\x20PAID\x20payments','getPaymentById','üí≥\x20Payout\x20wallet\x20for\x20','getPayoutById','\x20became\x20PAID:','getTime','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','\x20no\x20longer\x20PAID:','üí∞\x20Current\x20shop\x20balance:\x20','randomBytes','toFixed','\x20USDT\x20(+','15COzxJZ','year','insensitive','16033292CMvmku','findMany','all','_sum','amountUSDT','PAID','not\x20set','1112641PhinOQ','Error\x20processing\x20payment\x20','__esModule','adminNotes','desc','gatewaySettings','\x20active\x20merchants\x20for\x20selection','totalCommissionRate','\x27\x20(from\x20\x27','forEach','polygon_usdc','createPayout','toISOString','whiteUrl','amount','create','\x20balance\x20updated:\x20','username','shopUrl','count','values','getGatewayDisplayName','üìä\x20Available\x20gateways\x20in\x20database:','getSystemStatistics','getGatewayNameById','split','paidOutUSDT','fullName','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','getMerchantsAwaitingPayout','activateUser','ceil','merchantEarningsUSDT','klyme_gb','paymentGateways','totalPaidOut','localeCompare','status','\x20USDT)','Test\x20Gateway','dateFrom','periodTo','\x20order','10moIZEL','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','CHARGEBACK','defineProperty','shopId','\x20payments)','üí∞\x20Shop\x20','29554sxKqVa','üìä\x20Payout\x20statistics\x20calculated:','sort','payment','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','sk_','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','length','asc','gateways','üîç\x20Using\x20gateway\x20\x27','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','2020-01-01','get','totalAmountUSDT','telegramId','\x20USDT\x20(gross\x20revenue)','generateDailyStatistics','telegram','getGatewayIdByName','KLYME\x20GB','üí∞\x20[PAYOUT]\x20Gateway\x20','merchantEarnings',',\x20Commission:\x20','lte','findFirst','\x20\x20\x20Gateway:\x20','üìä\x20Getting\x20payments\x20with\x20filters:','getAllPayouts','orderId','toUpperCase','paidAt','3IFprAw','push','set','chargebackAmount','\x27\x20->\x20ID\x20\x27','averageCheckUSDT','getAllPayments','841336rJNKJJ','\x20\x20\x20üí≥\x20Total\x20payments:\x20','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20USDT\x20(','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','network','Payment\x20not\x20found','round','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','üí∏\x20CHARGEBACK\x20penalty:\x20-','\x20USDT,\x20Requested:\x20','\x20merchants\x20with\x20positive\x20balance','cointopay','week','gatewayEarnings','failureMessage','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','getMerchantsSelection','üìä\x20Merchant\x20statistics\x20calculated:','usdcPolygonWallet','üí∞\x20Payment\x20','\x20USDT\x20(actual\x20balances)','3050586lPEGoW','getUserById','updatePaymentStatus','üìã\x20Getting\x20merchants\x20selection\x20list...','gateway','\x20USDT\x20(-','period','turnover','\x20\x20\x20Total\x20paid\x20out:\x20','createdAt','klyme_eu','trc20','balance','totalPayments','polygon','commissionUSDT','0000','\x20USDT\x20(with\x20commission\x20deducted)','\x20->\x20','date','\x27\x20to\x20name\x20\x27','./currencyService','ACTIVE','noda','admin','summary','erc20',':\x20commission\x20=\x20','usdtPolygonWallet','updatedAt','delete','wallets','Noda','updateCustomerData','some','üí∞\x20Found\x20','getPayoutStats','currencyService','üìä\x20Merchants\x20awaiting\x20payout:\x20','name','gatewayOrderId','\x20USDT\x20(without\x20commission)','\x20\x20\x20üåç\x20Country:\x20','bcryptjs','KLYME\x20EU'];a35_0xb3b9=function(){return _0x2bf18e;};return a35_0xb3b9();}const a35_0xe65f49=a35_0x2bba;(function(_0x240cf1,_0x1c7d40){const _0x18a88e=a35_0x2bba,_0x496fdc=_0x240cf1();while(!![]){try{const _0x50b6d3=parseInt(_0x18a88e(0x1de))/0x1+parseInt(_0x18a88e(0x27a))/0x2*(parseInt(_0x18a88e(0x230))/0x3)+-parseInt(_0x18a88e(0x237))/0x4*(parseInt(_0x18a88e(0x1d4))/0x5)+-parseInt(_0x18a88e(0x2e2))/0x6*(parseInt(_0x18a88e(0x210))/0x7)+-parseInt(_0x18a88e(0x2b8))/0x8+-parseInt(_0x18a88e(0x24d))/0x9+-parseInt(_0x18a88e(0x209))/0xa*(-parseInt(_0x18a88e(0x1d7))/0xb);if(_0x50b6d3===_0x1c7d40)break;else _0x496fdc['push'](_0x496fdc['shift']());}catch(_0x372453){_0x496fdc['push'](_0x496fdc['shift']());}}}(a35_0xb3b9,0xa51ed));var __importDefault=this&&this['__importDefault']||function(_0x2f5888){const _0x5889d5=a35_0x2bba;return _0x2f5888&&_0x2f5888[_0x5889d5(0x1e0)]?_0x2f5888:{'default':_0x2f5888};};function a35_0x2bba(_0xf44152,_0x54fd0c){const _0xb3b9dc=a35_0xb3b9();return a35_0x2bba=function(_0x2bba38,_0x4d4022){_0x2bba38=_0x2bba38-0x1bb;let _0x594714=_0xb3b9dc[_0x2bba38];return _0x594714;},a35_0x2bba(_0xf44152,_0x54fd0c);}Object[a35_0xe65f49(0x20c)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0xe65f49(0x2ae))),bcryptjs_1=__importDefault(require(a35_0xe65f49(0x278))),crypto_1=__importDefault(require(a35_0xe65f49(0x2b6))),currencyService_1=require(a35_0xe65f49(0x262)),gateway_1=require(a35_0xe65f49(0x28d));class AdminService{async[a35_0xe65f49(0x271)](){const _0x5e8e4f=a35_0xe65f49;console[_0x5e8e4f(0x284)]('üìä\x20Calculating\x20payout\x20statistics...');const _0x3d05fd=await database_1['default']['shop'][_0x5e8e4f(0x291)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x5e8e4f(0x263)}}),_0xd7162b=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x33f6b2=await database_1['default']['payment']['count']({'where':{'status':_0x5e8e4f(0x1dc),'gateway':{'not':_0x5e8e4f(0x2aa)}}}),_0xc45780=new Date(),_0xe2d0de=new Date(_0xc45780[_0x5e8e4f(0x2dd)](),_0xc45780['getMonth'](),0x1),_0x588cc1=new Date(_0xc45780[_0x5e8e4f(0x2dd)](),_0xc45780[_0x5e8e4f(0x287)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1599e4=await database_1['default'][_0x5e8e4f(0x2d7)][_0x5e8e4f(0x291)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0xe2d0de,'lte':_0x588cc1},'status':'COMPLETED'}}),_0x55c0f4=_0x3d05fd[_0x5e8e4f(0x1da)][_0x5e8e4f(0x201)]||0x0,_0x4db8b9=_0xd7162b[_0x5e8e4f(0x266)][_0x5e8e4f(0x1bf)],_0x5b678a=_0x1599e4['_sum'][_0x5e8e4f(0x1ec)]||0x0,_0x5df29a={'totalPayout':Math[_0x5e8e4f(0x23e)](_0x55c0f4*0x64)/0x64,'awaitingPayout':Math[_0x5e8e4f(0x23e)](_0x4db8b9*0x64)/0x64,'thisMonth':Math[_0x5e8e4f(0x23e)](_0x5b678a*0x64)/0x64,'availableBalance':Math[_0x5e8e4f(0x23e)](_0x4db8b9*0x64)/0x64,'totalPayments':_0x33f6b2};return console[_0x5e8e4f(0x284)](_0x5e8e4f(0x211)),console[_0x5e8e4f(0x284)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x5df29a[_0x5e8e4f(0x1c3)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x5e8e4f(0x284)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x5df29a[_0x5e8e4f(0x299)]+_0x5e8e4f(0x25e)),console['log'](_0x5e8e4f(0x2bf)+_0x5df29a[_0x5e8e4f(0x2a5)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x5e8e4f(0x284)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x5df29a[_0x5e8e4f(0x2ad)]+'\x20USDT'),console[_0x5e8e4f(0x284)](_0x5e8e4f(0x238)+_0x5df29a[_0x5e8e4f(0x25a)]+_0x5e8e4f(0x1c8)),console['log'](_0x5e8e4f(0x2c7)+(_0x3d05fd[_0x5e8e4f(0x1da)][_0x5e8e4f(0x259)]||0x0)[_0x5e8e4f(0x1d2)](0x2)+_0x5e8e4f(0x276)),console[_0x5e8e4f(0x284)]('\x20\x20\x20üìä\x20Commission\x20difference:\x20'+((_0x3d05fd[_0x5e8e4f(0x1da)]['balance']||0x0)-_0x4db8b9)[_0x5e8e4f(0x1d2)](0x2)+_0x5e8e4f(0x2a6)),_0x5df29a;}async[a35_0xe65f49(0x26e)](_0x7498c8,_0x27c27d){const _0x40953a=a35_0xe65f49;console[_0x40953a(0x284)](_0x40953a(0x1c1)+_0x7498c8+':',_0x27c27d);const _0x54ae17=await database_1['default'][_0x40953a(0x213)]['findUnique']({'where':{'id':_0x7498c8},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x54ae17)throw new Error(_0x40953a(0x23d));const _0x4fee46={};_0x27c27d['customerCountry']!==undefined&&(_0x4fee46[_0x40953a(0x28f)]=_0x27c27d[_0x40953a(0x28f)]||null);_0x27c27d[_0x40953a(0x288)]!==undefined&&(_0x4fee46[_0x40953a(0x288)]=_0x27c27d['customerIp']||null);_0x27c27d[_0x40953a(0x2ac)]!==undefined&&(_0x4fee46['customerUa']=_0x27c27d[_0x40953a(0x2ac)]||null);const _0x25dbf7=await database_1[_0x40953a(0x1be)][_0x40953a(0x213)][_0x40953a(0x2bc)]({'where':{'id':_0x7498c8},'data':{..._0x4fee46,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x40953a(0x284)](_0x40953a(0x21b)+_0x7498c8),console[_0x40953a(0x284)](_0x40953a(0x277)+_0x54ae17['customerCountry']+'\x20->\x20'+_0x25dbf7[_0x40953a(0x28f)]),console[_0x40953a(0x284)]('\x20\x20\x20üåê\x20IP:\x20'+_0x54ae17[_0x40953a(0x288)]+_0x40953a(0x25f)+_0x25dbf7['customerIp']),console['log'](_0x40953a(0x216)+(_0x54ae17['customerUa']?_0x40953a(0x232):'not\x20set')+_0x40953a(0x25f)+(_0x25dbf7[_0x40953a(0x2ac)]?'set':_0x40953a(0x1dd))),_0x25dbf7;}async[a35_0xe65f49(0x1f5)](_0x5d5550){const _0x4854be=a35_0xe65f49,_0x368504=new Date();let _0x355931;switch(_0x5d5550){case'7d':_0x355931=new Date(_0x368504[_0x4854be(0x1cd)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x355931=new Date(_0x368504[_0x4854be(0x1cd)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4854be(0x2bd):_0x355931=new Date(_0x368504['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4854be(0x1d9):const _0x49956e=await database_1[_0x4854be(0x1be)][_0x4854be(0x213)]['findFirst']({'where':{'gateway':{'not':_0x4854be(0x2aa)}},'orderBy':{'createdAt':_0x4854be(0x218)},'select':{'createdAt':!![]}});_0x355931=_0x49956e?_0x49956e[_0x4854be(0x256)]:new Date(_0x4854be(0x21c)),console[_0x4854be(0x284)](_0x4854be(0x2ab)+_0x355931[_0x4854be(0x1ea)]());break;default:_0x355931=new Date(_0x368504[_0x4854be(0x1cd)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5dde4d,_0x5d7b5c,_0x48ad56,_0xa092e,_0x195354,_0x2c2f1d,_0x25d218]=await Promise[_0x4854be(0x1d9)]([database_1[_0x4854be(0x1be)][_0x4854be(0x27e)][_0x4854be(0x1f1)](),database_1[_0x4854be(0x1be)][_0x4854be(0x27e)][_0x4854be(0x1f1)]({'where':{'status':_0x4854be(0x263)}}),database_1['default']['payment'][_0x4854be(0x1f1)]({'where':{'createdAt':{'gte':_0x355931},'gateway':{'not':'test_gateway'}}}),database_1[_0x4854be(0x1be)][_0x4854be(0x213)]['count']({'where':{'status':_0x4854be(0x1dc),'createdAt':{'gte':_0x355931},'gateway':{'not':'test_gateway'}}}),database_1[_0x4854be(0x1be)][_0x4854be(0x213)][_0x4854be(0x1d8)]({'where':{'status':_0x4854be(0x1dc),'createdAt':{'gte':_0x355931},'gateway':{'not':_0x4854be(0x2aa)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x4854be(0x213)][_0x4854be(0x1d8)]({'where':{'gateway':{'not':_0x4854be(0x2aa)}},'take':0xa,'orderBy':{'createdAt':_0x4854be(0x1e2)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4854be(0x213)][_0x4854be(0x1d8)]({'where':{'createdAt':{'gte':_0x355931},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x418ebd=0x0;for(const _0x26d808 of _0x195354){const _0xd24649=await currencyService_1[_0x4854be(0x272)]['convertToUSDT'](_0x26d808[_0x4854be(0x1ec)],_0x26d808['currency']);_0x418ebd+=_0xd24649;}const _0x2fc508=this[_0x4854be(0x221)](_0x25d218,_0x355931,_0x368504),_0x1e4f1b=_0x48ad56>0x0?_0xa092e/_0x48ad56*0x64:0x0;return{'totalShops':_0x5dde4d,'activeShops':_0x5d7b5c,'totalPayments':_0x48ad56,'successfulPayments':_0xa092e,'totalRevenue':Math[_0x4854be(0x23e)](_0x418ebd*0x64)/0x64,'conversionRate':Math[_0x4854be(0x23e)](_0x1e4f1b*0x64)/0x64,'dailyRevenue':_0x2fc508['dailyRevenue'],'dailyPayments':_0x2fc508[_0x4854be(0x294)],'recentPayments':_0x2c2f1d[_0x4854be(0x2a9)](_0x438220=>({'id':_0x438220['id'],'amount':_0x438220[_0x4854be(0x1ec)],'currency':_0x438220[_0x4854be(0x28a)],'status':_0x438220['status'],'gateway':_0x438220[_0x4854be(0x251)],'shop':_0x438220[_0x4854be(0x27e)],'createdAt':_0x438220['createdAt']}))};}async['getMerchantStatistics'](_0x5a3aa3){const _0x1be529=a35_0xe65f49;console[_0x1be529(0x284)](_0x1be529(0x239),_0x5a3aa3);let _0x3a2dc8,_0x66d283=new Date();if(_0x5a3aa3[_0x1be529(0x253)]===_0x1be529(0x2b7)&&_0x5a3aa3[_0x1be529(0x206)]&&_0x5a3aa3[_0x1be529(0x27b)])_0x3a2dc8=new Date(_0x5a3aa3[_0x1be529(0x206)]),_0x66d283=new Date(_0x5a3aa3[_0x1be529(0x27b)]);else{const _0x1f01f0=new Date();switch(_0x5a3aa3[_0x1be529(0x253)]){case _0x1be529(0x244):_0x3a2dc8=new Date(_0x1f01f0[_0x1be529(0x1cd)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x3a2dc8=new Date(_0x1f01f0['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1be529(0x1d5):_0x3a2dc8=new Date(_0x1f01f0['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x3a2dc8=new Date(_0x1be529(0x21c));break;}}console[_0x1be529(0x284)]('üìÖ\x20Period:\x20'+_0x3a2dc8[_0x1be529(0x1ea)]()+_0x1be529(0x285)+_0x66d283[_0x1be529(0x1ea)]());const _0x378cef={'status':'PAID','gateway':{'not':_0x1be529(0x2aa)},'paidAt':{'gte':_0x3a2dc8,'lte':_0x66d283}};_0x5a3aa3[_0x1be529(0x20d)]&&(_0x378cef[_0x1be529(0x20d)]=_0x5a3aa3['shopId']);const _0x25cafa=await database_1[_0x1be529(0x1be)]['payment']['findMany']({'where':_0x378cef,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x1be529(0x284)](_0x1be529(0x270)+_0x25cafa[_0x1be529(0x217)]+_0x1be529(0x2a8));const _0x8fa2a5={'gateway':{'not':_0x1be529(0x2aa)},'createdAt':{'gte':_0x3a2dc8,'lte':_0x66d283}};_0x5a3aa3[_0x1be529(0x20d)]&&(_0x8fa2a5[_0x1be529(0x20d)]=_0x5a3aa3[_0x1be529(0x20d)]);const _0x687b5f=await database_1['default'][_0x1be529(0x213)][_0x1be529(0x1f1)]({'where':_0x8fa2a5});console[_0x1be529(0x284)](_0x1be529(0x2c1)+_0x687b5f+',\x20successful:\x20'+_0x25cafa[_0x1be529(0x217)]);let _0x15d686=0x0,_0x45f79a=0x0,_0x54e12f=0x0;const _0x19977b={},_0x4408f1={},_0x3686f8={};for(const _0x35997b of _0x25cafa){try{const _0x390dd1=await currencyService_1['currencyService']['convertToUSDT'](_0x35997b[_0x1be529(0x1ec)],_0x35997b[_0x1be529(0x28a)]);let _0x1bcc71={};if(_0x35997b[_0x1be529(0x27e)][_0x1be529(0x1e3)])try{_0x1bcc71=JSON[_0x1be529(0x2ba)](_0x35997b[_0x1be529(0x27e)][_0x1be529(0x1e3)]);}catch(_0x57e2ed){console[_0x1be529(0x27d)](_0x1be529(0x29c)+_0x35997b[_0x1be529(0x20d)]+':',_0x57e2ed);}let _0xbad310={},_0x3d8c0e=0xa;for(const [_0x47b2a8,_0x188fff]of Object[_0x1be529(0x2da)](_0x1bcc71)){if(_0x47b2a8[_0x1be529(0x1c4)]()===_0x35997b[_0x1be529(0x251)][_0x1be529(0x1c4)]()){_0xbad310=_0x188fff,_0x3d8c0e=_0x188fff[_0x1be529(0x280)]||0xa;break;}}const _0xec1677=_0x390dd1*(_0x3d8c0e/0x64),_0x59e65e=_0x390dd1-_0xec1677;_0x15d686+=_0x390dd1,_0x45f79a+=_0x59e65e,_0x54e12f+=_0xec1677;!_0x19977b[_0x35997b[_0x1be529(0x251)]]&&(_0x19977b[_0x35997b['gateway']]={'gateway':_0x35997b[_0x1be529(0x251)],'gatewayDisplayName':this[_0x1be529(0x1f3)](_0x35997b[_0x1be529(0x251)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x19977b[_0x35997b['gateway']][_0x1be529(0x289)]++,_0x19977b[_0x35997b['gateway']][_0x1be529(0x1c6)]+=_0x390dd1,_0x19977b[_0x35997b[_0x1be529(0x251)]][_0x1be529(0x25c)]+=_0xec1677,_0x19977b[_0x35997b[_0x1be529(0x251)]][_0x1be529(0x1fe)]+=_0x59e65e,_0x19977b[_0x35997b[_0x1be529(0x251)]][_0x1be529(0x1e5)]+=_0x3d8c0e;!_0x5a3aa3[_0x1be529(0x20d)]&&(!_0x4408f1[_0x35997b[_0x1be529(0x20d)]]&&(_0x4408f1[_0x35997b[_0x1be529(0x20d)]]={'shopId':_0x35997b[_0x1be529(0x20d)],'shopName':_0x35997b[_0x1be529(0x27e)]['name'],'shopUsername':_0x35997b[_0x1be529(0x27e)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4408f1[_0x35997b[_0x1be529(0x20d)]][_0x1be529(0x289)]++,_0x4408f1[_0x35997b[_0x1be529(0x20d)]]['turnoverUSDT']+=_0x390dd1,_0x4408f1[_0x35997b['shopId']][_0x1be529(0x25c)]+=_0xec1677,_0x4408f1[_0x35997b[_0x1be529(0x20d)]][_0x1be529(0x1fe)]+=_0x59e65e);const _0x27cd90=_0x35997b['paidAt'][_0x1be529(0x1ea)]()[_0x1be529(0x1f7)]('T')[0x0];!_0x3686f8[_0x27cd90]&&(_0x3686f8[_0x27cd90]={'date':_0x27cd90,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3686f8[_0x27cd90][_0x1be529(0x254)]+=_0x390dd1,_0x3686f8[_0x27cd90][_0x1be529(0x226)]+=_0x59e65e,_0x3686f8[_0x27cd90][_0x1be529(0x245)]+=_0xec1677,_0x3686f8[_0x27cd90][_0x1be529(0x289)]++;}catch(_0x3fe760){console[_0x1be529(0x27d)](_0x1be529(0x1df)+_0x35997b['id']+':',_0x3fe760);}}Object[_0x1be529(0x1f2)](_0x19977b)['forEach'](_0x3c7922=>{const _0x3a6b06=_0x1be529;_0x3c7922[_0x3a6b06(0x2b2)]=_0x3c7922['paymentsCount']>0x0?_0x3c7922[_0x3a6b06(0x1e5)]/_0x3c7922[_0x3a6b06(0x289)]:0x0,delete _0x3c7922[_0x3a6b06(0x1e5)];}),Object[_0x1be529(0x1f2)](_0x4408f1)[_0x1be529(0x1e7)](_0x225aad=>{const _0x5f19a5=_0x1be529;_0x225aad['averageCheckUSDT']=_0x225aad[_0x5f19a5(0x289)]>0x0?_0x225aad[_0x5f19a5(0x1c6)]/_0x225aad[_0x5f19a5(0x289)]:0x0;});let _0x4c5b00=0x0;if(_0x5a3aa3[_0x1be529(0x20d)]){const _0x514cf9=await database_1[_0x1be529(0x1be)]['payout'][_0x1be529(0x1d8)]({'where':{'shopId':_0x5a3aa3[_0x1be529(0x20d)],'status':'COMPLETED','createdAt':{'gte':_0x3a2dc8,'lte':_0x66d283}},'select':{'amount':!![]}});_0x4c5b00=_0x514cf9[_0x1be529(0x2c8)]((_0x4dfdf8,_0x4d2728)=>_0x4dfdf8+_0x4d2728[_0x1be529(0x1ec)],0x0);}const _0x529c92=_0x687b5f,_0xedb0d5=_0x25cafa['length'],_0x5cf4ec=_0xedb0d5>0x0?_0x15d686/_0xedb0d5:0x0,_0x3ae86c=_0x529c92>0x0?Math[_0x1be529(0x23e)](_0xedb0d5/_0x529c92*0x2710)/0x64:0x0,_0x3a2608=Math[_0x1be529(0x1fd)]((_0x66d283[_0x1be529(0x1cd)]()-_0x3a2dc8[_0x1be529(0x1cd)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4c94f2={'totalTurnover':Math[_0x1be529(0x23e)](_0x15d686*0x64)/0x64,'merchantEarnings':Math[_0x1be529(0x23e)](_0x45f79a*0x64)/0x64,'gatewayEarnings':Math[_0x1be529(0x23e)](_0x54e12f*0x64)/0x64,'totalPaidOut':Math[_0x1be529(0x23e)](_0x4c5b00*0x64)/0x64,'averageCheck':Math[_0x1be529(0x23e)](_0x5cf4ec*0x64)/0x64,'totalPayments':_0x529c92,'successfulPayments':_0xedb0d5,'conversionRate':_0x3ae86c,'gatewayBreakdown':Object[_0x1be529(0x1f2)](_0x19977b)['map'](_0x39e8d9=>({..._0x39e8d9,'turnoverUSDT':Math[_0x1be529(0x23e)](_0x39e8d9[_0x1be529(0x1c6)]*0x64)/0x64,'commissionUSDT':Math[_0x1be529(0x23e)](_0x39e8d9[_0x1be529(0x25c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1be529(0x23e)](_0x39e8d9[_0x1be529(0x1fe)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x39e8d9['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x5a3aa3['shopId']?undefined:Object['values'](_0x4408f1)[_0x1be529(0x2a9)](_0x3a6ed7=>({..._0x3a6ed7,'turnoverUSDT':Math[_0x1be529(0x23e)](_0x3a6ed7['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x1be529(0x23e)](_0x3a6ed7['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3a6ed7[_0x1be529(0x1fe)]*0x64)/0x64,'paidOutUSDT':Math[_0x1be529(0x23e)](_0x3a6ed7[_0x1be529(0x1f8)]*0x64)/0x64,'averageCheckUSDT':Math[_0x1be529(0x23e)](_0x3a6ed7[_0x1be529(0x235)]*0x64)/0x64})),'dailyData':Object[_0x1be529(0x1f2)](_0x3686f8)[_0x1be529(0x2a9)](_0x31ac83=>({..._0x31ac83,'turnover':Math[_0x1be529(0x23e)](_0x31ac83[_0x1be529(0x254)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x31ac83['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x1be529(0x23e)](_0x31ac83[_0x1be529(0x245)]*0x64)/0x64}))[_0x1be529(0x212)]((_0x4f1244,_0x450f53)=>_0x4f1244[_0x1be529(0x260)][_0x1be529(0x202)](_0x450f53[_0x1be529(0x260)])),'periodInfo':{'from':_0x3a2dc8,'to':_0x66d283,'periodType':_0x5a3aa3['period']||'custom','daysCount':_0x3a2608}};return console['log'](_0x1be529(0x249)),console[_0x1be529(0x284)](_0x1be529(0x1ce)+_0x4c94f2[_0x1be529(0x2e5)]+_0x1be529(0x2a6)),console[_0x1be529(0x284)](_0x1be529(0x23b)+_0x4c94f2[_0x1be529(0x226)]+_0x1be529(0x2a6)),console[_0x1be529(0x284)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x4c94f2[_0x1be529(0x245)]+_0x1be529(0x2a6)),console[_0x1be529(0x284)]('\x20\x20\x20üìä\x20Total\x20payments:\x20'+_0x4c94f2[_0x1be529(0x25a)]),_0x4c94f2;}async[a35_0xe65f49(0x248)](){const _0x363f96=a35_0xe65f49;console['log'](_0x363f96(0x250));const _0x4806d9=await database_1[_0x363f96(0x1be)]['shop'][_0x363f96(0x1d8)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x363f96(0x218)}});return console[_0x363f96(0x284)](_0x363f96(0x2c0)+_0x4806d9['length']+_0x363f96(0x1e4)),_0x4806d9[_0x363f96(0x2a9)](_0x143ae8=>({'id':_0x143ae8['id'],'username':_0x143ae8['username'],'name':_0x143ae8['name']}));}[a35_0xe65f49(0x1f3)](_0x59c657){const _0x20c18d=a35_0xe65f49,_0x5542fd={'test_gateway':_0x20c18d(0x205),'plisio':'Plisio','rapyd':'Rapyd','noda':_0x20c18d(0x26d),'cointopay':_0x20c18d(0x281),'cointopay2':_0x20c18d(0x2af),'klyme_eu':_0x20c18d(0x279),'klyme_gb':_0x20c18d(0x224),'klyme_de':_0x20c18d(0x1bb),'mastercard':'MasterCard'};return _0x5542fd[_0x59c657]||_0x59c657;}[a35_0xe65f49(0x2c5)](_0x121972){const _0x5078fc=a35_0xe65f49,_0x1e2ec4={'Test\x20Gateway':_0x5078fc(0x2aa),'Plisio':'plisio','Rapyd':_0x5078fc(0x296),'Noda':_0x5078fc(0x264),'CoinToPay':_0x5078fc(0x243),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x5078fc(0x257),'KLYME\x20GB':_0x5078fc(0x1ff),'KLYME\x20DE':_0x5078fc(0x2b4),'MasterCard':'mastercard'};return _0x1e2ec4[_0x121972]||_0x121972[_0x5078fc(0x1c4)]();}async[a35_0xe65f49(0x1fb)](_0x51733c){const _0xe1cb04=a35_0xe65f49,{page:_0x27c9ea,limit:_0x3bf4d6,minAmount:_0x5d92ec,search:_0x55c1ad}=_0x51733c,_0x2c7630=(_0x27c9ea-0x1)*_0x3bf4d6;console[_0xe1cb04(0x284)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x51733c);const _0x337ea7={'balance':{'gt':0x0},'status':_0xe1cb04(0x263)};_0x5d92ec&&(_0x337ea7['balance'][_0xe1cb04(0x2a2)]=_0x5d92ec);_0x55c1ad&&(_0x337ea7['OR']=[{'name':{'contains':_0x55c1ad,'mode':_0xe1cb04(0x1d6)}},{'username':{'contains':_0x55c1ad,'mode':_0xe1cb04(0x1d6)}}]);const [_0x4ca5a7,_0x4edc0a]=await Promise[_0xe1cb04(0x1d9)]([database_1['default'][_0xe1cb04(0x27e)]['findMany']({'where':_0x337ea7,'skip':_0x2c7630,'take':_0x3bf4d6,'orderBy':{'balance':_0xe1cb04(0x1e2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0xe1cb04(0x1be)]['shop'][_0xe1cb04(0x1f1)]({'where':_0x337ea7})]);console[_0xe1cb04(0x284)](_0xe1cb04(0x270)+_0x4ca5a7[_0xe1cb04(0x217)]+_0xe1cb04(0x242));const _0x178f87=await Promise['all'](_0x4ca5a7['map'](async _0xf94911=>{const _0x552132=_0xe1cb04,[_0x3b677a,_0x1994cf,_0x3326f4]=await Promise[_0x552132(0x1d9)]([database_1[_0x552132(0x1be)][_0x552132(0x213)]['count']({'where':{'shopId':_0xf94911['id'],'status':_0x552132(0x1dc),'gateway':{'not':_0x552132(0x2aa)}}}),database_1[_0x552132(0x1be)]['payment'][_0x552132(0x229)]({'where':{'shopId':_0xf94911['id'],'status':'PAID','gateway':{'not':_0x552132(0x2aa)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x552132(0x1be)][_0x552132(0x213)]['groupBy']({'by':[_0x552132(0x251)],'where':{'shopId':_0xf94911['id'],'status':_0x552132(0x1dc),'gateway':{'not':_0x552132(0x2aa)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xa83fc=new Date(),_0x292d4=new Date(_0xa83fc[_0x552132(0x2dd)](),_0xa83fc[_0x552132(0x287)](),0x1),_0x35653e=new Date(_0xa83fc[_0x552132(0x2dd)](),_0xa83fc[_0x552132(0x287)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x1bbf17,_0x276760]=await Promise[_0x552132(0x1d9)]([database_1['default']['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0xf94911['id'],'status':_0x552132(0x2de)}}),database_1[_0x552132(0x1be)]['payout'][_0x552132(0x291)]({'_sum':{'amount':!![]},'where':{'shopId':_0xf94911['id'],'status':_0x552132(0x2de),'createdAt':{'gte':_0x292d4,'lte':_0x35653e}}})]),_0x56dcb0=_0x1bbf17['_sum'][_0x552132(0x1ec)]||0x0,_0x176fda=_0x276760[_0x552132(0x1da)][_0x552132(0x1ec)]||0x0,_0x2e920a=await Promise[_0x552132(0x1d9)](_0x3326f4[_0x552132(0x2a9)](async _0x2b5c48=>{const _0x270a9c=_0x552132;let _0x4d4136=0xa;if(_0xf94911[_0x270a9c(0x1e3)])try{const _0x1521e1=JSON[_0x270a9c(0x2ba)](_0xf94911[_0x270a9c(0x1e3)]);for(const [_0x47c634,_0x10a937]of Object['entries'](_0x1521e1)){if(_0x47c634[_0x270a9c(0x1c4)]()===_0x2b5c48[_0x270a9c(0x251)][_0x270a9c(0x1c4)]()){_0x4d4136=_0x10a937['commission']||0xa,console[_0x270a9c(0x284)](_0x270a9c(0x225)+_0x2b5c48['gateway']+_0x270a9c(0x29f)+_0xf94911['id']+_0x270a9c(0x268)+_0x4d4136+'%');break;}}}catch(_0x6deff){console[_0x270a9c(0x27d)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0xf94911['id']+':',_0x6deff);}const _0x57f9d7=_0x2b5c48['_sum']['amountUSDT']||0x0,_0x2075f7=_0x57f9d7*(0x1-_0x4d4136/0x64);return{'gateway':_0x2b5c48[_0x270a9c(0x251)],'count':_0x2b5c48[_0x270a9c(0x2a4)]['id'],'amountUSDT':Math[_0x270a9c(0x23e)](_0x57f9d7*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x2075f7*0x64)/0x64,'commission':_0x4d4136};})),_0x4b75a4=_0x2e920a['reduce']((_0x523e13,_0xded514)=>_0x523e13+_0xded514[_0x552132(0x1db)],0x0),_0x1cb216=_0xf94911[_0x552132(0x259)];return console[_0x552132(0x284)](_0x552132(0x2d9)+_0xf94911[_0x552132(0x1ef)]+':'),console['log'](_0x552132(0x1c5)+_0x4b75a4[_0x552132(0x1d2)](0x2)+_0x552132(0x220)),console['log'](_0x552132(0x1fa)+_0x2e920a[_0x552132(0x2c8)]((_0x1bb4a2,_0x2f432e)=>_0x1bb4a2+_0x2f432e['amountAfterCommissionUSDT'],0x0)['toFixed'](0x2)+_0x552132(0x29d)),console['log']('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x1cb216[_0x552132(0x1d2)](0x2)+'\x20USDT\x20(after\x20payouts)'),{'id':_0xf94911['id'],'fullName':_0xf94911[_0x552132(0x274)],'username':_0xf94911[_0x552132(0x1ef)],'telegramId':_0xf94911['telegram'],'merchantUrl':_0xf94911[_0x552132(0x1f0)],'wallets':{'usdtPolygonWallet':_0xf94911[_0x552132(0x269)],'usdtTrcWallet':_0xf94911[_0x552132(0x2e4)],'usdtErcWallet':_0xf94911[_0x552132(0x292)],'usdcPolygonWallet':_0xf94911[_0x552132(0x24a)]},'totalAmountUSDT':Math[_0x552132(0x23e)](_0x4b75a4*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x552132(0x23e)](_0x1cb216*0x64)/0x64,'totalPayout':Math[_0x552132(0x23e)](_0x56dcb0*0x64)/0x64,'thisMonth':Math[_0x552132(0x23e)](_0x176fda*0x64)/0x64,'paymentsCount':_0x3b677a,'oldestPaymentDate':_0x1994cf?.[_0x552132(0x22f)]||_0xf94911[_0x552132(0x256)],'gatewayBreakdown':_0x2e920a};})),_0x2864b6=_0x178f87['reduce']((_0x14750a,_0x47853a)=>_0x14750a+_0x47853a[_0xe1cb04(0x21e)],0x0),_0x3991ce=_0x178f87[_0xe1cb04(0x2c8)]((_0x3a95a1,_0x1fd9df)=>_0x3a95a1+_0x1fd9df['totalAmountAfterCommissionUSDT'],0x0),_0x372c39=_0x178f87[_0xe1cb04(0x2c8)]((_0x1a0109,_0x14431a)=>_0x1a0109+_0x14431a[_0xe1cb04(0x1c3)],0x0),_0x3f6101=_0x178f87[_0xe1cb04(0x2c8)]((_0x4a79f8,_0x4cc6eb)=>_0x4a79f8+_0x4cc6eb[_0xe1cb04(0x2ad)],0x0);return console['log'](_0xe1cb04(0x273)+_0x4edc0a+_0xe1cb04(0x1c7)),console[_0xe1cb04(0x284)]('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math[_0xe1cb04(0x23e)](_0x2864b6*0x64)/0x64+_0xe1cb04(0x220)),console['log'](_0xe1cb04(0x28c)+Math[_0xe1cb04(0x23e)](_0x3991ce*0x64)/0x64+_0xe1cb04(0x24c)),console[_0xe1cb04(0x284)]('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0xe1cb04(0x23e)](_0x372c39*0x64)/0x64+'\x20USDT'),console[_0xe1cb04(0x284)](_0xe1cb04(0x20a)+Math[_0xe1cb04(0x23e)](_0x3f6101*0x64)/0x64+_0xe1cb04(0x2a6)),{'merchants':_0x178f87,'pagination':{'page':_0x27c9ea,'limit':_0x3bf4d6,'total':_0x4edc0a,'totalPages':Math[_0xe1cb04(0x1fd)](_0x4edc0a/_0x3bf4d6)},'summary':{'totalMerchants':_0x4edc0a,'totalAmountUSDT':Math[_0xe1cb04(0x23e)](_0x2864b6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xe1cb04(0x23e)](_0x3991ce*0x64)/0x64,'totalPayout':Math['round'](_0x372c39*0x64)/0x64,'thisMonth':Math[_0xe1cb04(0x23e)](_0x3f6101*0x64)/0x64}};}async[a35_0xe65f49(0x1e9)](_0x35ef4b){const _0x53c6b7=a35_0xe65f49,{shopId:_0x576375,amount:_0x438023,network:_0x39083b,wallet:_0x3a3b21,notes:_0x356fae,txid:_0x2bd90d,periodFrom:_0x4240c6,periodTo:_0x36193c}=_0x35ef4b,_0x2baaee=await database_1['default'][_0x53c6b7(0x297)](async _0x3315f6=>{const _0x4f085f=_0x53c6b7,_0xb29930=await _0x3315f6[_0x4f085f(0x27e)][_0x4f085f(0x2e0)]({'where':{'id':_0x576375},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xb29930)throw new Error(_0x4f085f(0x27c));console[_0x4f085f(0x284)]('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0xb29930[_0x4f085f(0x1ef)]+':'),console[_0x4f085f(0x284)](_0x4f085f(0x2a1)+_0xb29930[_0x4f085f(0x259)][_0x4f085f(0x1d2)](0x6)+_0x4f085f(0x2a6)),console[_0x4f085f(0x284)](_0x4f085f(0x2bb)+_0x438023['toFixed'](0x6)+_0x4f085f(0x2a6)),console[_0x4f085f(0x284)](_0x4f085f(0x2b5)+_0xb29930[_0x4f085f(0x201)][_0x4f085f(0x1d2)](0x6)+'\x20USDT');if(_0x2bd90d)console[_0x4f085f(0x284)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x2bd90d);if(_0xb29930[_0x4f085f(0x259)]<_0x438023)throw new Error(_0x4f085f(0x2d8)+_0xb29930['balance'][_0x4f085f(0x1d2)](0x6)+_0x4f085f(0x241)+_0x438023[_0x4f085f(0x1d2)](0x6)+'\x20USDT');let _0xaad22e=_0x3a3b21;if(!_0xaad22e){const _0xdb779d=await _0x3315f6[_0x4f085f(0x27e)][_0x4f085f(0x2e0)]({'where':{'id':_0x576375},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0xdb779d)switch(_0x39083b){case _0x4f085f(0x25b):_0xaad22e=_0xdb779d[_0x4f085f(0x269)]||undefined;break;case _0x4f085f(0x258):_0xaad22e=_0xdb779d['usdtTrcWallet']||undefined;break;case _0x4f085f(0x267):_0xaad22e=_0xdb779d['usdtErcWallet']||undefined;break;case _0x4f085f(0x1e8):_0xaad22e=_0xdb779d[_0x4f085f(0x24a)]||undefined;break;}}console[_0x4f085f(0x284)](_0x4f085f(0x1ca)+_0x39083b+':\x20'+(_0xaad22e||_0x4f085f(0x2b0)));const _0x22a5f1=await _0x3315f6[_0x4f085f(0x2d7)][_0x4f085f(0x1ed)]({'data':{'shopId':_0x576375,'amount':_0x438023,'network':_0x39083b,'status':_0x4f085f(0x2de),'txid':_0x2bd90d,'notes':_0x356fae,'periodFrom':_0x4240c6?new Date(_0x4240c6):null,'periodTo':_0x36193c?new Date(_0x36193c):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x247d5f=_0xb29930['balance']-_0x438023,_0x19c5f0=_0xb29930[_0x4f085f(0x201)]+_0x438023;return await _0x3315f6[_0x4f085f(0x27e)][_0x4f085f(0x2bc)]({'where':{'id':_0x576375},'data':{'balance':_0x247d5f,'totalPaidOut':_0x19c5f0}}),console[_0x4f085f(0x284)](_0x4f085f(0x20f)+_0xb29930[_0x4f085f(0x1ef)]+'\x20balance\x20updated:'),console[_0x4f085f(0x284)](_0x4f085f(0x283)+_0xb29930['balance'][_0x4f085f(0x1d2)](0x6)+_0x4f085f(0x25f)+_0x247d5f['toFixed'](0x6)+_0x4f085f(0x252)+_0x438023[_0x4f085f(0x1d2)](0x6)+')'),console['log'](_0x4f085f(0x255)+_0xb29930['totalPaidOut'][_0x4f085f(0x1d2)](0x6)+'\x20->\x20'+_0x19c5f0['toFixed'](0x6)+_0x4f085f(0x1d3)+_0x438023[_0x4f085f(0x1d2)](0x6)+')'),{'payout':_0x22a5f1,'shop':_0xb29930};});return console['log']('‚úÖ\x20Payout\x20created:\x20'+_0x2baaee[_0x53c6b7(0x2d7)]['id']+_0x53c6b7(0x29f)+_0x2baaee[_0x53c6b7(0x27e)][_0x53c6b7(0x1ef)]+'\x20('+_0x438023+_0x53c6b7(0x204)),{'id':_0x2baaee[_0x53c6b7(0x2d7)]['id'],'shopId':_0x2baaee[_0x53c6b7(0x2d7)][_0x53c6b7(0x20d)],'shopName':_0x2baaee['shop']['name'],'shopUsername':_0x2baaee[_0x53c6b7(0x27e)][_0x53c6b7(0x1ef)],'amount':_0x2baaee['payout']['amount'],'network':_0x2baaee[_0x53c6b7(0x2d7)][_0x53c6b7(0x23c)],'status':_0x2baaee['payout'][_0x53c6b7(0x203)],'txid':_0x2baaee[_0x53c6b7(0x2d7)][_0x53c6b7(0x2b9)],'notes':_0x2baaee['payout']['notes'],'periodFrom':_0x2baaee[_0x53c6b7(0x2d7)]['periodFrom'],'periodTo':_0x2baaee[_0x53c6b7(0x2d7)]['periodTo'],'createdAt':_0x2baaee[_0x53c6b7(0x2d7)][_0x53c6b7(0x256)],'paidAt':_0x2baaee[_0x53c6b7(0x2d7)]['paidAt']};}async[a35_0xe65f49(0x22c)](_0x34946a){const _0x4a0687=a35_0xe65f49,{page:_0x46c3bf,limit:_0x385b61,shopId:_0x5a5263,network:_0x3e6928,dateFrom:_0x312664,dateTo:_0x320ae0,search:_0x3966da}=_0x34946a,_0x4723e8=(_0x46c3bf-0x1)*_0x385b61,_0x2fa367={};_0x5a5263&&(_0x2fa367[_0x4a0687(0x20d)]=_0x5a5263);_0x3e6928&&(_0x2fa367[_0x4a0687(0x23c)]=_0x3e6928);(_0x312664||_0x320ae0)&&(_0x2fa367[_0x4a0687(0x256)]={},_0x312664&&(_0x2fa367[_0x4a0687(0x256)]['gte']=new Date(_0x312664)),_0x320ae0&&(_0x2fa367[_0x4a0687(0x256)][_0x4a0687(0x228)]=new Date(_0x320ae0)));_0x3966da&&(_0x2fa367['OR']=[{'shop':{'name':{'contains':_0x3966da,'mode':_0x4a0687(0x1d6)}}},{'shop':{'username':{'contains':_0x3966da,'mode':_0x4a0687(0x1d6)}}},{'notes':{'contains':_0x3966da,'mode':_0x4a0687(0x1d6)}}]);const [_0x597bae,_0xd914e2]=await Promise[_0x4a0687(0x1d9)]([database_1[_0x4a0687(0x1be)][_0x4a0687(0x2d7)][_0x4a0687(0x1d8)]({'where':_0x2fa367,'skip':_0x4723e8,'take':_0x385b61,'orderBy':{'createdAt':_0x4a0687(0x1e2)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4a0687(0x1be)][_0x4a0687(0x2d7)]['count']({'where':_0x2fa367})]);return{'payouts':_0x597bae[_0x4a0687(0x2a9)](_0x176fac=>({'id':_0x176fac['id'],'shopId':_0x176fac[_0x4a0687(0x20d)],'shopName':_0x176fac[_0x4a0687(0x27e)][_0x4a0687(0x274)],'shopUsername':_0x176fac[_0x4a0687(0x27e)][_0x4a0687(0x1ef)],'amount':_0x176fac[_0x4a0687(0x1ec)],'network':_0x176fac[_0x4a0687(0x23c)],'status':_0x176fac[_0x4a0687(0x203)],'txid':_0x176fac['txid'],'notes':_0x176fac[_0x4a0687(0x2cb)],'periodFrom':_0x176fac[_0x4a0687(0x295)],'periodTo':_0x176fac[_0x4a0687(0x207)],'createdAt':_0x176fac[_0x4a0687(0x256)],'paidAt':_0x176fac['paidAt']})),'pagination':{'page':_0x46c3bf,'limit':_0x385b61,'total':_0xd914e2,'totalPages':Math[_0x4a0687(0x1fd)](_0xd914e2/_0x385b61)}};}async[a35_0xe65f49(0x1cb)](_0x195e1d){const _0x25ea48=a35_0xe65f49,_0x1633a8=await database_1[_0x25ea48(0x1be)][_0x25ea48(0x2d7)][_0x25ea48(0x2e0)]({'where':{'id':_0x195e1d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1633a8)return null;return{'id':_0x1633a8['id'],'shopId':_0x1633a8[_0x25ea48(0x20d)],'shopName':_0x1633a8['shop']['name'],'shopUsername':_0x1633a8['shop']['username'],'amount':_0x1633a8[_0x25ea48(0x1ec)],'network':_0x1633a8[_0x25ea48(0x23c)],'status':_0x1633a8[_0x25ea48(0x203)],'txid':_0x1633a8[_0x25ea48(0x2b9)],'notes':_0x1633a8[_0x25ea48(0x2cb)],'periodFrom':_0x1633a8[_0x25ea48(0x295)],'periodTo':_0x1633a8[_0x25ea48(0x207)],'createdAt':_0x1633a8[_0x25ea48(0x256)],'paidAt':_0x1633a8[_0x25ea48(0x22f)]};}async['deletePayout'](_0x47bf72){const _0x5cfce5=a35_0xe65f49;await database_1[_0x5cfce5(0x1be)][_0x5cfce5(0x2d7)][_0x5cfce5(0x26b)]({'where':{'id':_0x47bf72}});}async[a35_0xe65f49(0x236)](_0xd90533){const _0x345792=a35_0xe65f49,{page:_0x540310,limit:_0x3c22b7,status:_0x18a67a,gateway:_0x37a19b,shopId:_0x42de30,dateFrom:_0x5c3ec7,dateTo:_0x211119,search:_0x3ef0a2,currency:_0x2bb0c3,sortBy:_0x4fef7c,sortOrder:_0x38ae57}=_0xd90533,_0x3a31a8=(_0x540310-0x1)*_0x3c22b7;console['log'](_0x345792(0x22b),_0xd90533);const _0x154a67=await database_1[_0x345792(0x1be)]['payment'][_0x345792(0x2be)]({'by':[_0x345792(0x251)],'_count':{'gateway':!![]}});console[_0x345792(0x284)](_0x345792(0x1f4),_0x154a67[_0x345792(0x2a9)](_0x12f0f0=>_0x12f0f0[_0x345792(0x251)]+'\x20('+_0x12f0f0['_count'][_0x345792(0x251)]+_0x345792(0x20e)));if(_0x37a19b){const _0x11bdaf=_0x154a67[_0x345792(0x26f)](_0x118fd6=>_0x118fd6[_0x345792(0x251)][_0x345792(0x1c4)]()===_0x37a19b[_0x345792(0x1c4)]());!_0x11bdaf&&_0x37a19b[_0x345792(0x1c4)]()!==_0x345792(0x2aa)&&console[_0x345792(0x284)](_0x345792(0x2b3)+_0x37a19b+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x154a67[_0x345792(0x2a9)](_0x4cbca0=>_0x4cbca0[_0x345792(0x251)])[_0x345792(0x2b1)](',\x20'));}const _0x50e711={};_0x18a67a&&(_0x50e711[_0x345792(0x203)]=_0x18a67a[_0x345792(0x22e)]());if(!_0x37a19b)_0x50e711[_0x345792(0x251)]={'not':_0x345792(0x2aa)};else{if(_0x37a19b&&(_0x37a19b['toLowerCase']()===_0x345792(0x2aa)||_0x37a19b===_0x345792(0x25d)))_0x50e711[_0x345792(0x251)]=_0x345792(0x2aa);else{let _0x4b03c3=_0x37a19b;const _0x11547e=(0x0,gateway_1['getGatewayNameById'])(_0x37a19b);if(_0x11547e)_0x4b03c3=_0x11547e,console['log'](_0x345792(0x2dc)+_0x37a19b+_0x345792(0x261)+_0x4b03c3+'\x27');else{const _0x186655=(0x0,gateway_1[_0x345792(0x223)])(_0x37a19b);if(_0x186655){const _0x3f7b81=(0x0,gateway_1[_0x345792(0x1f6)])(_0x186655);_0x3f7b81&&(_0x4b03c3=_0x3f7b81,console[_0x345792(0x284)](_0x345792(0x2d6)+_0x37a19b+_0x345792(0x234)+_0x186655+'\x27\x20->\x20name\x20\x27'+_0x4b03c3+'\x27'));}else console[_0x345792(0x284)](_0x345792(0x21a)+_0x37a19b+_0x345792(0x214));}const _0x55f171=await database_1[_0x345792(0x1be)]['payment'][_0x345792(0x1f1)]({'where':{'gateway':_0x4b03c3[_0x345792(0x1c4)]()},'take':0x1});_0x55f171===0x0?(console[_0x345792(0x284)]('‚ö†Ô∏è\x20Gateway\x20\x27'+_0x4b03c3+_0x345792(0x1e6)+_0x37a19b+_0x345792(0x2d2)),_0x50e711['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x50e711[_0x345792(0x251)]=_0x4b03c3[_0x345792(0x1c4)](),console['log']('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0x4b03c3+_0x345792(0x1e6)+_0x37a19b+'\x27)'));}}console['log'](_0x345792(0x2c2),_0x50e711[_0x345792(0x251)]);_0x42de30&&(_0x50e711[_0x345792(0x20d)]=_0x42de30);_0x2bb0c3&&(_0x50e711[_0x345792(0x28a)]=_0x2bb0c3[_0x345792(0x22e)](),console[_0x345792(0x284)](_0x345792(0x2cc)+_0x2bb0c3[_0x345792(0x22e)]()));(_0x5c3ec7||_0x211119)&&(_0x50e711['createdAt']={},_0x5c3ec7&&(_0x50e711[_0x345792(0x256)][_0x345792(0x2a2)]=new Date(_0x5c3ec7)),_0x211119&&(_0x50e711[_0x345792(0x256)]['lte']=new Date(_0x211119)));_0x3ef0a2&&(_0x50e711['OR']=[{'id':{'contains':_0x3ef0a2,'mode':'insensitive'}},{'orderId':{'contains':_0x3ef0a2,'mode':_0x345792(0x1d6)}},{'gatewayOrderId':{'contains':_0x3ef0a2,'mode':_0x345792(0x1d6)}},{'customerEmail':{'contains':_0x3ef0a2,'mode':_0x345792(0x1d6)}},{'shop':{'name':{'contains':_0x3ef0a2,'mode':_0x345792(0x1d6)}}},{'shop':{'username':{'contains':_0x3ef0a2,'mode':'insensitive'}}}]);console[_0x345792(0x284)](_0x345792(0x2df),JSON[_0x345792(0x2ce)](_0x50e711,null,0x2));let _0x5275e9={'createdAt':_0x345792(0x1e2)};if(_0x4fef7c){const _0x391059=['amount','createdAt','updatedAt','status',_0x345792(0x251),'currency'],_0x17b0b9=['asc',_0x345792(0x1e2)];if(_0x391059['includes'](_0x4fef7c)){const _0x3c4702=_0x17b0b9[_0x345792(0x2a7)](_0x38ae57)?_0x38ae57:_0x345792(0x1e2);_0x5275e9={[_0x4fef7c]:_0x3c4702},console[_0x345792(0x284)](_0x345792(0x2db)+_0x4fef7c+_0x345792(0x2cf)+_0x3c4702+_0x345792(0x208));}}const [_0x56880c,_0x4e3b52]=await Promise[_0x345792(0x1d9)]([database_1[_0x345792(0x1be)][_0x345792(0x213)][_0x345792(0x1d8)]({'where':_0x50e711,'skip':_0x3a31a8,'take':_0x3c22b7,'orderBy':_0x5275e9,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x345792(0x1be)][_0x345792(0x213)][_0x345792(0x1f1)]({'where':_0x50e711})]);return{'payments':_0x56880c,'pagination':{'page':_0x540310,'limit':_0x3c22b7,'total':_0x4e3b52,'totalPages':Math['ceil'](_0x4e3b52/_0x3c22b7)}};}async[a35_0xe65f49(0x1c9)](_0x44c402){const _0x1085aa=a35_0xe65f49,_0x18977a=await database_1[_0x1085aa(0x1be)][_0x1085aa(0x213)][_0x1085aa(0x2e0)]({'where':{'id':_0x44c402},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x18977a)return null;return{'id':_0x18977a['id'],'shopId':_0x18977a['shopId'],'gateway':_0x18977a['gateway'],'amount':_0x18977a['amount'],'currency':_0x18977a[_0x1085aa(0x28a)],'status':_0x18977a[_0x1085aa(0x203)],'orderId':_0x18977a[_0x1085aa(0x22d)],'gatewayOrderId':_0x18977a[_0x1085aa(0x275)],'customerEmail':_0x18977a[_0x1085aa(0x2c3)],'customerName':_0x18977a['customerName'],'customerCountry':_0x18977a[_0x1085aa(0x28f)],'customerIp':_0x18977a['customerIp'],'customerUa':_0x18977a[_0x1085aa(0x2ac)],'failureMessage':_0x18977a['failureMessage'],'externalPaymentUrl':_0x18977a['externalPaymentUrl'],'successUrl':_0x18977a[_0x1085aa(0x1bc)],'failUrl':_0x18977a[_0x1085aa(0x2d5)],'pendingUrl':_0x18977a[_0x1085aa(0x1bd)],'whiteUrl':_0x18977a[_0x1085aa(0x1eb)],'createdAt':_0x18977a['createdAt'],'updatedAt':_0x18977a[_0x1085aa(0x26a)],'shop':_0x18977a['shop']};}async[a35_0xe65f49(0x24f)](_0x3ea88c,_0x30ec5c,_0x2c691b,_0x549cc6){const _0x26eec5=a35_0xe65f49,_0x6af1a8=await database_1[_0x26eec5(0x1be)][_0x26eec5(0x297)](async _0x274318=>{const _0x31344b=_0x26eec5,_0x21e88d=await _0x274318[_0x31344b(0x213)]['findUnique']({'where':{'id':_0x3ea88c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x21e88d)throw new Error(_0x31344b(0x23d));const _0x56a72b=_0x21e88d[_0x31344b(0x203)],_0xdfdabe=_0x30ec5c[_0x31344b(0x22e)]();console[_0x31344b(0x284)](_0x31344b(0x2d3)+_0x3ea88c+'\x20status:\x20'+_0x56a72b+_0x31344b(0x25f)+_0xdfdabe),console[_0x31344b(0x284)](_0x31344b(0x1d0)+_0x21e88d[_0x31344b(0x27e)][_0x31344b(0x259)]+_0x31344b(0x2a6));const _0x2cb1a2={'status':_0xdfdabe,'updatedAt':new Date(),'statusChangedBy':_0x31344b(0x265),'statusChangedAt':new Date()};_0x2c691b&&(_0x2cb1a2[_0x31344b(0x1e1)]=_0x2c691b);_0xdfdabe===_0x31344b(0x20b)&&_0x549cc6&&(_0x2cb1a2[_0x31344b(0x233)]=_0x549cc6);let _0x451d8e=0x0,_0x3df612=_0x21e88d[_0x31344b(0x27e)][_0x31344b(0x259)];if(_0xdfdabe==='PAID'&&_0x56a72b!==_0x31344b(0x1dc)){_0x2cb1a2[_0x31344b(0x22f)]=new Date();const _0x44e849=await currencyService_1[_0x31344b(0x272)][_0x31344b(0x2c6)](_0x21e88d[_0x31344b(0x1ec)],_0x21e88d['currency']);_0x2cb1a2[_0x31344b(0x1db)]=_0x44e849;let _0x370a95=0xa;const _0x5baeb0=await _0x274318[_0x31344b(0x27e)][_0x31344b(0x2e0)]({'where':{'id':_0x21e88d[_0x31344b(0x20d)]},'select':{'gatewaySettings':!![]}});if(_0x5baeb0?.[_0x31344b(0x1e3)])try{const _0x5e7d33=JSON[_0x31344b(0x2ba)](_0x5baeb0['gatewaySettings']);for(const [_0x35f3ce,_0x2674db]of Object[_0x31344b(0x2da)](_0x5e7d33)){if(_0x35f3ce['toLowerCase']()===_0x21e88d[_0x31344b(0x251)]['toLowerCase']()){_0x370a95=_0x2674db[_0x31344b(0x280)]||0xa;break;}}}catch(_0xe27d12){console['error'](_0x31344b(0x293)+_0x3ea88c+':',_0xe27d12);}const _0x1d2a08=_0x44e849*(0x1-_0x370a95/0x64);_0x451d8e=_0x1d2a08,_0x3df612+=_0x1d2a08,console[_0x31344b(0x284)](_0x31344b(0x24b)+_0x3ea88c+_0x31344b(0x1cc)),console[_0x31344b(0x284)]('\x20\x20\x20Full\x20amount:\x20'+_0x44e849[_0x31344b(0x1d2)](0x6)+'\x20USDT'),console[_0x31344b(0x284)](_0x31344b(0x22a)+_0x21e88d[_0x31344b(0x251)]+_0x31344b(0x227)+_0x370a95+'%'),console[_0x31344b(0x284)](_0x31344b(0x2cd)+_0x1d2a08[_0x31344b(0x1d2)](0x6)+'\x20USDT\x20(after\x20'+_0x370a95+_0x31344b(0x2d0)),console['log']('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x1d2a08['toFixed'](0x6)+_0x31344b(0x2a6));}else{if(_0x56a72b==='PAID'&&_0xdfdabe!==_0x31344b(0x1dc)){if(_0x21e88d[_0x31344b(0x1db)]){let _0x1aadf9=0xa;const _0x2898a5=await _0x274318[_0x31344b(0x27e)][_0x31344b(0x2e0)]({'where':{'id':_0x21e88d[_0x31344b(0x20d)]},'select':{'gatewaySettings':!![]}});if(_0x2898a5?.[_0x31344b(0x1e3)])try{const _0x19e4df=JSON['parse'](_0x2898a5['gatewaySettings']);for(const [_0x426dc4,_0x5cf6f9]of Object['entries'](_0x19e4df)){if(_0x426dc4[_0x31344b(0x1c4)]()===_0x21e88d[_0x31344b(0x251)]['toLowerCase']()){_0x1aadf9=_0x5cf6f9[_0x31344b(0x280)]||0xa;break;}}}catch(_0x43b3b7){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x3ea88c+':',_0x43b3b7);}const _0x5a855c=_0x21e88d['amountUSDT']*(0x1-_0x1aadf9/0x64);_0x451d8e=-_0x5a855c,_0x3df612-=_0x5a855c,_0x2cb1a2[_0x31344b(0x1db)]=null,console[_0x31344b(0x284)]('üí∞\x20Payment\x20'+_0x3ea88c+_0x31344b(0x1cf)),console[_0x31344b(0x284)]('\x20\x20\x20Full\x20amount:\x20'+_0x21e88d[_0x31344b(0x1db)][_0x31344b(0x1d2)](0x6)+_0x31344b(0x2a6)),console[_0x31344b(0x284)]('\x20\x20\x20Gateway:\x20'+_0x21e88d[_0x31344b(0x251)]+',\x20Commission:\x20'+_0x1aadf9+'%'),console[_0x31344b(0x284)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x5a855c[_0x31344b(0x1d2)](0x6)+'\x20USDT\x20(after\x20'+_0x1aadf9+_0x31344b(0x2d0)),console[_0x31344b(0x284)](_0x31344b(0x23f)+_0x5a855c[_0x31344b(0x1d2)](0x6)+_0x31344b(0x2a6));}}}_0xdfdabe==='CHARGEBACK'&&(_0x56a72b===_0x31344b(0x1dc)&&_0x21e88d[_0x31344b(0x1db)]&&console['log'](_0x31344b(0x2d1)),_0x549cc6&&_0x549cc6>0x0&&(_0x451d8e-=_0x549cc6,_0x3df612-=_0x549cc6,console[_0x31344b(0x284)](_0x31344b(0x240)+_0x549cc6[_0x31344b(0x1d2)](0x6)+'\x20USDT\x20from\x20balance')));_0xdfdabe==='REFUND'&&_0x56a72b===_0x31344b(0x1dc)&&console[_0x31344b(0x284)](_0x31344b(0x247));const _0x1e49a6=await _0x274318[_0x31344b(0x213)]['update']({'where':{'id':_0x3ea88c},'data':_0x2cb1a2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x451d8e!==0x0&&(await _0x274318[_0x31344b(0x27e)][_0x31344b(0x2bc)]({'where':{'id':_0x21e88d['shopId']},'data':{'balance':_0x3df612}}),console[_0x31344b(0x284)]('üí∞\x20Shop\x20'+_0x21e88d[_0x31344b(0x20d)]+_0x31344b(0x1ee)+_0x21e88d['shop']['balance'][_0x31344b(0x1d2)](0x6)+_0x31344b(0x25f)+_0x3df612['toFixed'](0x6)+_0x31344b(0x23a)+(_0x451d8e>0x0?'+':'')+_0x451d8e['toFixed'](0x6)+')')),_0x1e49a6;});return{'id':_0x6af1a8['id'],'shopId':_0x6af1a8[_0x26eec5(0x20d)],'gateway':_0x6af1a8[_0x26eec5(0x251)],'amount':_0x6af1a8[_0x26eec5(0x1ec)],'currency':_0x6af1a8['currency'],'status':_0x6af1a8[_0x26eec5(0x203)],'orderId':_0x6af1a8[_0x26eec5(0x22d)],'gatewayOrderId':_0x6af1a8[_0x26eec5(0x275)],'customerEmail':_0x6af1a8[_0x26eec5(0x2c3)],'customerName':_0x6af1a8['customerName'],'customerCountry':_0x6af1a8[_0x26eec5(0x28f)],'customerIp':_0x6af1a8[_0x26eec5(0x288)],'customerUa':_0x6af1a8[_0x26eec5(0x2ac)],'failureMessage':_0x6af1a8[_0x26eec5(0x246)],'adminNotes':_0x6af1a8[_0x26eec5(0x1e1)],'chargebackAmount':_0x6af1a8['chargebackAmount'],'statusChangedBy':_0x6af1a8[_0x26eec5(0x2e3)],'statusChangedAt':_0x6af1a8['statusChangedAt'],'createdAt':_0x6af1a8['createdAt'],'updatedAt':_0x6af1a8[_0x26eec5(0x26a)],'shop':_0x6af1a8[_0x26eec5(0x27e)]};}async[a35_0xe65f49(0x2a3)](_0x4a4f8c,_0x578341){const _0xfe45d0=a35_0xe65f49,_0x493cad={..._0x578341};_0x578341[_0xfe45d0(0x29e)]&&(_0x493cad[_0xfe45d0(0x29e)]=await bcryptjs_1['default']['hash'](_0x578341[_0xfe45d0(0x29e)],0xc));_0x578341[_0xfe45d0(0x1f9)]&&(_0x493cad['name']=_0x578341['fullName'],delete _0x493cad[_0xfe45d0(0x1f9)]);_0x578341['telegramId']&&(_0x493cad[_0xfe45d0(0x222)]=_0x578341[_0xfe45d0(0x21f)],delete _0x493cad['telegramId']);_0x578341['merchantUrl']&&(_0x493cad[_0xfe45d0(0x1f0)]=_0x578341[_0xfe45d0(0x298)],delete _0x493cad[_0xfe45d0(0x298)]);if(_0x578341['gateways']){const _0x5b55cb=_0x578341[_0xfe45d0(0x219)]['map'](_0x219a44=>this[_0xfe45d0(0x2c5)](_0x219a44));console[_0xfe45d0(0x284)](_0xfe45d0(0x282),_0x578341[_0xfe45d0(0x219)],'->',_0x5b55cb),_0x493cad[_0xfe45d0(0x200)]=JSON[_0xfe45d0(0x2ce)](_0x5b55cb),delete _0x493cad[_0xfe45d0(0x219)];}_0x578341[_0xfe45d0(0x1e3)]&&(_0x493cad[_0xfe45d0(0x1e3)]=JSON[_0xfe45d0(0x2ce)](_0x578341[_0xfe45d0(0x1e3)]),delete _0x493cad[_0xfe45d0(0x1e3)]);_0x578341[_0xfe45d0(0x26c)]&&(_0x578341[_0xfe45d0(0x26c)]['usdtPolygonWallet']!==undefined&&(_0x493cad[_0xfe45d0(0x269)]=_0x578341[_0xfe45d0(0x26c)][_0xfe45d0(0x269)]||null),_0x578341[_0xfe45d0(0x26c)]['usdtTrcWallet']!==undefined&&(_0x493cad[_0xfe45d0(0x2e4)]=_0x578341[_0xfe45d0(0x26c)][_0xfe45d0(0x2e4)]||null),_0x578341[_0xfe45d0(0x26c)][_0xfe45d0(0x292)]!==undefined&&(_0x493cad[_0xfe45d0(0x292)]=_0x578341[_0xfe45d0(0x26c)][_0xfe45d0(0x292)]||null),_0x578341[_0xfe45d0(0x26c)][_0xfe45d0(0x24a)]!==undefined&&(_0x493cad[_0xfe45d0(0x24a)]=_0x578341[_0xfe45d0(0x26c)][_0xfe45d0(0x24a)]||null),delete _0x493cad['wallets']);const _0x548d45=await database_1[_0xfe45d0(0x1be)][_0xfe45d0(0x27e)][_0xfe45d0(0x2bc)]({'where':{'id':_0x4a4f8c},'data':_0x493cad,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x548d45['id'],'fullName':_0x548d45[_0xfe45d0(0x274)],'username':_0x548d45[_0xfe45d0(0x1ef)],'telegramId':_0x548d45['telegram'],'merchantUrl':_0x548d45[_0xfe45d0(0x1f0)],'gateways':_0x548d45[_0xfe45d0(0x200)]?JSON[_0xfe45d0(0x2ba)](_0x548d45[_0xfe45d0(0x200)]):null,'gatewaySettings':_0x548d45[_0xfe45d0(0x1e3)]?JSON[_0xfe45d0(0x2ba)](_0x548d45[_0xfe45d0(0x1e3)]):null,'publicKey':_0x548d45[_0xfe45d0(0x2c4)],'wallets':{'usdtPolygonWallet':_0x548d45[_0xfe45d0(0x269)],'usdtTrcWallet':_0x548d45[_0xfe45d0(0x2e4)],'usdtErcWallet':_0x548d45[_0xfe45d0(0x292)],'usdcPolygonWallet':_0x548d45['usdcPolygonWallet']},'status':_0x548d45[_0xfe45d0(0x203)],'createdAt':_0x548d45[_0xfe45d0(0x256)]};}async[a35_0xe65f49(0x28e)](_0x5debab){const _0x2fad47=a35_0xe65f49,_0x3e1ec8=await database_1[_0x2fad47(0x1be)][_0x2fad47(0x27e)][_0x2fad47(0x2bc)]({'where':{'id':_0x5debab},'data':{'status':_0x2fad47(0x28b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3e1ec8['id'],'fullName':_0x3e1ec8['name'],'username':_0x3e1ec8['username'],'telegramId':_0x3e1ec8[_0x2fad47(0x222)],'merchantUrl':_0x3e1ec8[_0x2fad47(0x1f0)],'gateways':_0x3e1ec8[_0x2fad47(0x200)]?JSON['parse'](_0x3e1ec8[_0x2fad47(0x200)]):null,'gatewaySettings':_0x3e1ec8[_0x2fad47(0x1e3)]?JSON['parse'](_0x3e1ec8['gatewaySettings']):null,'publicKey':_0x3e1ec8[_0x2fad47(0x2c4)],'wallets':{'usdtPolygonWallet':_0x3e1ec8['usdtPolygonWallet'],'usdtTrcWallet':_0x3e1ec8[_0x2fad47(0x2e4)],'usdtErcWallet':_0x3e1ec8[_0x2fad47(0x292)],'usdcPolygonWallet':_0x3e1ec8[_0x2fad47(0x24a)]},'status':_0x3e1ec8[_0x2fad47(0x203)],'createdAt':_0x3e1ec8[_0x2fad47(0x256)]};}async[a35_0xe65f49(0x1fc)](_0x329fa0){const _0x31c38d=a35_0xe65f49,_0x412b26=await database_1['default']['shop']['update']({'where':{'id':_0x329fa0},'data':{'status':_0x31c38d(0x263)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x412b26['id'],'fullName':_0x412b26[_0x31c38d(0x274)],'username':_0x412b26[_0x31c38d(0x1ef)],'telegramId':_0x412b26['telegram'],'merchantUrl':_0x412b26[_0x31c38d(0x1f0)],'gateways':_0x412b26[_0x31c38d(0x200)]?JSON[_0x31c38d(0x2ba)](_0x412b26['paymentGateways']):null,'gatewaySettings':_0x412b26[_0x31c38d(0x1e3)]?JSON[_0x31c38d(0x2ba)](_0x412b26[_0x31c38d(0x1e3)]):null,'publicKey':_0x412b26['publicKey'],'wallets':{'usdtPolygonWallet':_0x412b26['usdtPolygonWallet'],'usdtTrcWallet':_0x412b26[_0x31c38d(0x2e4)],'usdtErcWallet':_0x412b26[_0x31c38d(0x292)],'usdcPolygonWallet':_0x412b26['usdcPolygonWallet']},'status':_0x412b26[_0x31c38d(0x203)],'createdAt':_0x412b26[_0x31c38d(0x256)]};}async[a35_0xe65f49(0x286)](_0x2dcbc6){const _0x11a448=a35_0xe65f49,{page:_0x2b5675,limit:_0x30a871,status:_0xd810ec}=_0x2dcbc6,_0x26533c=(_0x2b5675-0x1)*_0x30a871,_0x2b4119={};_0xd810ec&&(_0x2b4119[_0x11a448(0x203)]=_0xd810ec['toUpperCase']());const [_0x51e951,_0x4f88dd]=await Promise['all']([database_1[_0x11a448(0x1be)][_0x11a448(0x27e)][_0x11a448(0x1d8)]({'where':_0x2b4119,'skip':_0x26533c,'take':_0x30a871,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x11a448(0x1be)][_0x11a448(0x27e)]['count']({'where':_0x2b4119})]);return{'users':_0x51e951[_0x11a448(0x2a9)](_0x2c6203=>{const _0x1cdf75=_0x11a448,_0x32256b=_0x2c6203[_0x1cdf75(0x200)]?JSON[_0x1cdf75(0x2ba)](_0x2c6203['paymentGateways']):null,_0xfc8d2a=_0x32256b?_0x32256b[_0x1cdf75(0x2a9)](_0x37e0b0=>this[_0x1cdf75(0x1f3)](_0x37e0b0)):null;return{'id':_0x2c6203['id'],'fullName':_0x2c6203[_0x1cdf75(0x274)],'username':_0x2c6203[_0x1cdf75(0x1ef)],'telegramId':_0x2c6203[_0x1cdf75(0x222)],'merchantUrl':_0x2c6203[_0x1cdf75(0x1f0)],'gateways':_0xfc8d2a,'gatewaySettings':_0x2c6203[_0x1cdf75(0x1e3)]?JSON[_0x1cdf75(0x2ba)](_0x2c6203[_0x1cdf75(0x1e3)]):null,'publicKey':_0x2c6203['publicKey'],'wallets':{'usdtPolygonWallet':_0x2c6203[_0x1cdf75(0x269)],'usdtTrcWallet':_0x2c6203[_0x1cdf75(0x2e4)],'usdtErcWallet':_0x2c6203[_0x1cdf75(0x292)],'usdcPolygonWallet':_0x2c6203[_0x1cdf75(0x24a)]},'status':_0x2c6203[_0x1cdf75(0x203)],'createdAt':_0x2c6203[_0x1cdf75(0x256)]};}),'pagination':{'page':_0x2b5675,'limit':_0x30a871,'total':_0x4f88dd,'totalPages':Math[_0x11a448(0x1fd)](_0x4f88dd/_0x30a871)}};}async[a35_0xe65f49(0x24e)](_0x4bc21e){const _0x294308=a35_0xe65f49,_0x560c6a=await database_1[_0x294308(0x1be)][_0x294308(0x27e)]['findUnique']({'where':{'id':_0x4bc21e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x560c6a)return null;const _0x83d5e8=_0x560c6a[_0x294308(0x200)]?JSON[_0x294308(0x2ba)](_0x560c6a['paymentGateways']):null,_0x5ab6db=_0x83d5e8?_0x83d5e8[_0x294308(0x2a9)](_0x1ca23b=>this[_0x294308(0x1f3)](_0x1ca23b)):null;return _0x83d5e8&&_0x5ab6db&&console[_0x294308(0x284)]('üîÑ\x20Gateway\x20mapping\x20(get):',_0x83d5e8,'->',_0x5ab6db),{'id':_0x560c6a['id'],'fullName':_0x560c6a[_0x294308(0x274)],'username':_0x560c6a['username'],'telegramId':_0x560c6a['telegram'],'merchantUrl':_0x560c6a[_0x294308(0x1f0)],'gateways':_0x5ab6db,'gatewaySettings':_0x560c6a[_0x294308(0x1e3)]?JSON[_0x294308(0x2ba)](_0x560c6a[_0x294308(0x1e3)]):null,'publicKey':_0x560c6a[_0x294308(0x2c4)],'wallets':{'usdtPolygonWallet':_0x560c6a[_0x294308(0x269)],'usdtTrcWallet':_0x560c6a[_0x294308(0x2e4)],'usdtErcWallet':_0x560c6a[_0x294308(0x292)],'usdcPolygonWallet':_0x560c6a[_0x294308(0x24a)]},'status':_0x560c6a[_0x294308(0x203)],'createdAt':_0x560c6a['createdAt']};}async['createUser'](_0x416a18){const _0x46ab48=a35_0xe65f49,{fullName:_0x40cf4e,username:_0xe09d8,password:_0x44ec5d,telegramId:_0x377d55,merchantUrl:_0x246a15,gateways:_0x5a6fcd,gatewaySettings:_0x5b5bf1,wallets:_0x143e3f}=_0x416a18,_0x5563d2=await database_1[_0x46ab48(0x1be)][_0x46ab48(0x27e)][_0x46ab48(0x2e0)]({'where':{'username':_0xe09d8}});if(_0x5563d2)throw new Error(_0x46ab48(0x27f));if(_0x377d55){const _0x34c8fa=await database_1[_0x46ab48(0x1be)]['shop']['findUnique']({'where':{'telegram':_0x377d55}});if(_0x34c8fa)throw new Error(_0x46ab48(0x2c9));}const _0x4efe2=await bcryptjs_1[_0x46ab48(0x1be)][_0x46ab48(0x1c0)](_0x44ec5d,0xc),_0x241e75='pk_'+crypto_1[_0x46ab48(0x1be)][_0x46ab48(0x1d1)](0x20)['toString'](_0x46ab48(0x2a0)),_0xa1dc2e=_0x46ab48(0x215)+crypto_1[_0x46ab48(0x1be)][_0x46ab48(0x1d1)](0x20)[_0x46ab48(0x2e1)]('hex'),_0x2d3c27=_0x5a6fcd?_0x5a6fcd[_0x46ab48(0x2a9)](_0x5a6def=>this['getGatewayInternalName'](_0x5a6def)):null;_0x5a6fcd&&_0x2d3c27&&console[_0x46ab48(0x284)](_0x46ab48(0x2ca),_0x5a6fcd,'->',_0x2d3c27);const _0x2e466e=await database_1['default']['shop'][_0x46ab48(0x1ed)]({'data':{'name':_0x40cf4e,'username':_0xe09d8,'password':_0x4efe2,'telegram':_0x377d55,'shopUrl':_0x246a15,'paymentGateways':_0x2d3c27?JSON[_0x46ab48(0x2ce)](_0x2d3c27):null,'gatewaySettings':_0x5b5bf1?JSON[_0x46ab48(0x2ce)](_0x5b5bf1):null,'usdtPolygonWallet':_0x143e3f?.[_0x46ab48(0x269)]||null,'usdtTrcWallet':_0x143e3f?.[_0x46ab48(0x2e4)]||null,'usdtErcWallet':_0x143e3f?.[_0x46ab48(0x292)]||null,'usdcPolygonWallet':_0x143e3f?.[_0x46ab48(0x24a)]||null,'publicKey':_0x241e75,'secretKey':_0xa1dc2e,'status':_0x46ab48(0x263)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e466e['id'],'fullName':_0x2e466e[_0x46ab48(0x274)],'username':_0x2e466e[_0x46ab48(0x1ef)],'telegramId':_0x2e466e[_0x46ab48(0x222)],'merchantUrl':_0x2e466e[_0x46ab48(0x1f0)],'gateways':_0x2e466e[_0x46ab48(0x200)]?JSON[_0x46ab48(0x2ba)](_0x2e466e[_0x46ab48(0x200)]):null,'gatewaySettings':_0x2e466e[_0x46ab48(0x1e3)]?JSON[_0x46ab48(0x2ba)](_0x2e466e['gatewaySettings']):null,'publicKey':_0x2e466e[_0x46ab48(0x2c4)],'wallets':{'usdtPolygonWallet':_0x2e466e[_0x46ab48(0x269)],'usdtTrcWallet':_0x2e466e[_0x46ab48(0x2e4)],'usdtErcWallet':_0x2e466e[_0x46ab48(0x292)],'usdcPolygonWallet':_0x2e466e[_0x46ab48(0x24a)]},'status':_0x2e466e[_0x46ab48(0x203)],'createdAt':_0x2e466e['createdAt']};}async[a35_0xe65f49(0x2d4)](_0x381b84){const _0x16b3a2=a35_0xe65f49;await database_1['default'][_0x16b3a2(0x27e)][_0x16b3a2(0x26b)]({'where':{'id':_0x381b84}});}['generateDailyStatistics'](_0x2d3425,_0x397ad2,_0x352261){const _0x20bca9=a35_0xe65f49,_0x52734b=new Map(),_0x1be936=new Date(_0x397ad2);while(_0x1be936<=_0x352261){const _0x54cf2a=_0x1be936['toISOString']()[_0x20bca9(0x1f7)]('T')[0x0];_0x52734b[_0x20bca9(0x232)](_0x54cf2a,{'revenue':0x0,'count':0x0}),_0x1be936['setDate'](_0x1be936[_0x20bca9(0x1c2)]()+0x1);}for(const _0x4247ef of _0x2d3425){const _0x5575fe=_0x4247ef[_0x20bca9(0x256)]['toISOString']()['split']('T')[0x0],_0x570f42=_0x52734b[_0x20bca9(0x21d)](_0x5575fe);_0x570f42&&(_0x570f42[_0x20bca9(0x1f1)]+=0x1,_0x4247ef[_0x20bca9(0x203)]==='PAID'&&(_0x4247ef[_0x20bca9(0x1db)]?_0x570f42[_0x20bca9(0x29b)]+=_0x4247ef['amountUSDT']:console[_0x20bca9(0x284)]('‚ö†Ô∏è\x20Payment\x20'+_0x4247ef['id']+_0x20bca9(0x29a))));}const _0x33ead1=[],_0x1be4b3=[];for(const [_0x451833,_0x58a363]of _0x52734b){_0x33ead1[_0x20bca9(0x231)]({'date':_0x451833,'amount':Math[_0x20bca9(0x23e)](_0x58a363[_0x20bca9(0x29b)]*0x64)/0x64}),_0x1be4b3[_0x20bca9(0x231)]({'date':_0x451833,'count':_0x58a363['count']});}return{'dailyRevenue':_0x33ead1,'dailyPayments':_0x1be4b3};}}exports[a35_0xe65f49(0x290)]=AdminService;