'use strict';const a35_0x28db66=a35_0x1fd9;(function(_0x508d35,_0xf62335){const _0x5c8dbb=a35_0x1fd9,_0xdf6c65=_0x508d35();while(!![]){try{const _0x502d1a=-parseInt(_0x5c8dbb(0x11c))/0x1+parseInt(_0x5c8dbb(0xef))/0x2+parseInt(_0x5c8dbb(0xf6))/0x3+-parseInt(_0x5c8dbb(0x12f))/0x4+-parseInt(_0x5c8dbb(0x13c))/0x5*(parseInt(_0x5c8dbb(0x155))/0x6)+parseInt(_0x5c8dbb(0xf3))/0x7+parseInt(_0x5c8dbb(0x13a))/0x8*(-parseInt(_0x5c8dbb(0x123))/0x9);if(_0x502d1a===_0xf62335)break;else _0xdf6c65['push'](_0xdf6c65['shift']());}catch(_0x2da934){_0xdf6c65['push'](_0xdf6c65['shift']());}}}(a35_0x339a,0xee73d));var __importDefault=this&&this[a35_0x28db66(0x103)]||function(_0x10ad9d){const _0x479ff2=a35_0x28db66;return _0x10ad9d&&_0x10ad9d[_0x479ff2(0x68)]?_0x10ad9d:{'default':_0x10ad9d};};Object[a35_0x28db66(0x126)](exports,a35_0x28db66(0x68),{'value':!![]}),exports[a35_0x28db66(0xdb)]=void 0x0;function a35_0x1fd9(_0x41a780,_0x5e453c){const _0x339aec=a35_0x339a();return a35_0x1fd9=function(_0x1fd900,_0x128981){_0x1fd900=_0x1fd900-0x67;let _0x4b67de=_0x339aec[_0x1fd900];return _0x4b67de;},a35_0x1fd9(_0x41a780,_0x5e453c);}const database_1=__importDefault(require(a35_0x28db66(0x124))),bcryptjs_1=__importDefault(require(a35_0x28db66(0xfc))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x28db66(0x81)),gateway_1=require('../types/gateway');class AdminService{async[a35_0x28db66(0x70)](){const _0x3d4701=a35_0x28db66;console[_0x3d4701(0xd8)](_0x3d4701(0xcf));const _0x2a0223=await database_1['default'][_0x3d4701(0xf8)][_0x3d4701(0x11b)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3d4701(0xfb)}}),_0x3798c5=new Date(),_0x231163=new Date(_0x3798c5[_0x3d4701(0xda)](),_0x3798c5['getMonth'](),0x1),_0x5039d7=new Date(_0x3798c5[_0x3d4701(0xda)](),_0x3798c5[_0x3d4701(0xd1)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5f3a47=await database_1['default'][_0x3d4701(0x121)][_0x3d4701(0x11b)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x231163,'lte':_0x5039d7},'status':_0x3d4701(0xe9)}}),_0x44c739=_0x2a0223[_0x3d4701(0xbd)]['totalPaidOut']||0x0,_0x224b00=_0x2a0223['_sum'][_0x3d4701(0xa6)]||0x0,_0x3a729d=_0x5f3a47[_0x3d4701(0xbd)]['amount']||0x0,_0x3ac739={'totalPayout':Math[_0x3d4701(0x8b)](_0x44c739*0x64)/0x64,'awaitingPayout':Math[_0x3d4701(0x8b)](_0x224b00*0x64)/0x64,'thisMonth':Math[_0x3d4701(0x8b)](_0x3a729d*0x64)/0x64,'availableBalance':Math[_0x3d4701(0x8b)](_0x224b00*0x64)/0x64};return console[_0x3d4701(0xd8)](_0x3d4701(0xb3)),console[_0x3d4701(0xd8)](_0x3d4701(0x9f)+_0x3ac739['totalPayout']+_0x3d4701(0x130)),console[_0x3d4701(0xd8)](_0x3d4701(0x112)+_0x3ac739[_0x3d4701(0xd5)]+'\x20USDT\x20(total\x20merchant\x20balances)'),console[_0x3d4701(0xd8)](_0x3d4701(0xe5)+_0x3ac739[_0x3d4701(0x115)]+_0x3d4701(0x13d)),console[_0x3d4701(0xd8)](_0x3d4701(0x159)+_0x3ac739[_0x3d4701(0x135)]+_0x3d4701(0xee)),_0x3ac739;}async[a35_0x28db66(0x98)](_0x436217,_0x1255fa){const _0x8df753=a35_0x28db66;console['log'](_0x8df753(0xbe)+_0x436217+':',_0x1255fa);const _0x4c85a3=await database_1[_0x8df753(0xfd)][_0x8df753(0xd0)][_0x8df753(0x16c)]({'where':{'id':_0x436217},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4c85a3)throw new Error(_0x8df753(0xc5));const _0x43157e={};_0x1255fa['customerCountry']!==undefined&&(_0x43157e[_0x8df753(0x95)]=_0x1255fa[_0x8df753(0x95)]||null);_0x1255fa[_0x8df753(0x168)]!==undefined&&(_0x43157e[_0x8df753(0x168)]=_0x1255fa[_0x8df753(0x168)]||null);_0x1255fa['customerUa']!==undefined&&(_0x43157e[_0x8df753(0x87)]=_0x1255fa[_0x8df753(0x87)]||null);const _0x5d7890=await database_1[_0x8df753(0xfd)][_0x8df753(0xd0)][_0x8df753(0xa2)]({'where':{'id':_0x436217},'data':{..._0x43157e,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x8df753(0xd8)](_0x8df753(0xaa)+_0x436217),console['log'](_0x8df753(0x10f)+_0x4c85a3[_0x8df753(0x95)]+'\x20->\x20'+_0x5d7890[_0x8df753(0x95)]),console[_0x8df753(0xd8)](_0x8df753(0x9d)+_0x4c85a3[_0x8df753(0x168)]+'\x20->\x20'+_0x5d7890[_0x8df753(0x168)]),console[_0x8df753(0xd8)](_0x8df753(0x166)+(_0x4c85a3[_0x8df753(0x87)]?_0x8df753(0x13b):'not\x20set')+'\x20->\x20'+(_0x5d7890['customerUa']?_0x8df753(0x13b):_0x8df753(0xa1))),_0x5d7890;}async[a35_0x28db66(0x119)](_0xce06ed){const _0x3ed772=a35_0x28db66,_0x7a1bde=new Date();let _0x5ac58b;switch(_0xce06ed){case'7d':_0x5ac58b=new Date(_0x7a1bde['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5ac58b=new Date(_0x7a1bde['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x5ac58b=new Date(_0x7a1bde[_0x3ed772(0x6e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x3ed772(0x72):const _0x3f5c52=await database_1['default'][_0x3ed772(0xd0)][_0x3ed772(0xb1)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x3ed772(0xdc)},'select':{'createdAt':!![]}});_0x5ac58b=_0x3f5c52?_0x3f5c52[_0x3ed772(0x10e)]:new Date(_0x3ed772(0x85)),console['log'](_0x3ed772(0xa5)+_0x5ac58b[_0x3ed772(0xe1)]());break;default:_0x5ac58b=new Date(_0x7a1bde['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xfa209f,_0x60fd84,_0xa3c086,_0x2087a7,_0xd9c3b2,_0xdeb81,_0x19ec89]=await Promise[_0x3ed772(0x72)]([database_1[_0x3ed772(0xfd)][_0x3ed772(0xf8)][_0x3ed772(0xec)](),database_1[_0x3ed772(0xfd)][_0x3ed772(0xf8)][_0x3ed772(0xec)]({'where':{'status':_0x3ed772(0xfb)}}),database_1[_0x3ed772(0xfd)][_0x3ed772(0xd0)][_0x3ed772(0xec)]({'where':{'createdAt':{'gte':_0x5ac58b},'gateway':{'not':'test_gateway'}}}),database_1[_0x3ed772(0xfd)]['payment'][_0x3ed772(0xec)]({'where':{'status':_0x3ed772(0xce),'createdAt':{'gte':_0x5ac58b},'gateway':{'not':_0x3ed772(0x14f)}}}),database_1['default']['payment'][_0x3ed772(0xb4)]({'where':{'status':_0x3ed772(0xce),'createdAt':{'gte':_0x5ac58b},'gateway':{'not':_0x3ed772(0x14f)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x3ed772(0xfd)][_0x3ed772(0xd0)][_0x3ed772(0xb4)]({'where':{'gateway':{'not':_0x3ed772(0x14f)}},'take':0xa,'orderBy':{'createdAt':_0x3ed772(0x164)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3ed772(0xfd)][_0x3ed772(0xd0)][_0x3ed772(0xb4)]({'where':{'createdAt':{'gte':_0x5ac58b},'gateway':{'not':_0x3ed772(0x14f)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x1e6ffe=0x0;for(const _0x533615 of _0xd9c3b2){const _0x34008f=await currencyService_1[_0x3ed772(0xe6)]['convertToUSDT'](_0x533615[_0x3ed772(0xbf)],_0x533615['currency']);_0x1e6ffe+=_0x34008f;}const _0x1b4c2e=this[_0x3ed772(0x6c)](_0x19ec89,_0x5ac58b,_0x7a1bde),_0x409516=_0xa3c086>0x0?_0x2087a7/_0xa3c086*0x64:0x0;return{'totalShops':_0xfa209f,'activeShops':_0x60fd84,'totalPayments':_0xa3c086,'successfulPayments':_0x2087a7,'totalRevenue':Math['round'](_0x1e6ffe*0x64)/0x64,'conversionRate':Math[_0x3ed772(0x8b)](_0x409516*0x64)/0x64,'dailyRevenue':_0x1b4c2e[_0x3ed772(0xdd)],'dailyPayments':_0x1b4c2e[_0x3ed772(0x14b)],'recentPayments':_0xdeb81[_0x3ed772(0x83)](_0x370e3f=>({'id':_0x370e3f['id'],'amount':_0x370e3f[_0x3ed772(0xbf)],'currency':_0x370e3f['currency'],'status':_0x370e3f[_0x3ed772(0xdf)],'gateway':_0x370e3f[_0x3ed772(0x110)],'shop':_0x370e3f[_0x3ed772(0xf8)],'createdAt':_0x370e3f['createdAt']}))};}async['getMerchantStatistics'](_0x141818){const _0x9b643=a35_0x28db66;console['log'](_0x9b643(0x163),_0x141818);let _0x39d9ff,_0x2fefb9=new Date();if(_0x141818[_0x9b643(0xb0)]===_0x9b643(0xd7)&&_0x141818[_0x9b643(0x96)]&&_0x141818[_0x9b643(0x14c)])_0x39d9ff=new Date(_0x141818[_0x9b643(0x96)]),_0x2fefb9=new Date(_0x141818['dateTo']);else{const _0x20756c=new Date();switch(_0x141818[_0x9b643(0xb0)]){case _0x9b643(0x6d):_0x39d9ff=new Date(_0x20756c[_0x9b643(0x6e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x39d9ff=new Date(_0x20756c[_0x9b643(0x6e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x9b643(0x165):_0x39d9ff=new Date(_0x20756c[_0x9b643(0x6e)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x9b643(0x72):default:_0x39d9ff=new Date(_0x9b643(0x85));break;}}console[_0x9b643(0xd8)](_0x9b643(0x9b)+_0x39d9ff[_0x9b643(0xe1)]()+_0x9b643(0x13f)+_0x2fefb9['toISOString']());const _0x41f4e0={'status':_0x9b643(0xce),'gateway':{'not':_0x9b643(0x14f)},'paidAt':{'gte':_0x39d9ff,'lte':_0x2fefb9}};_0x141818[_0x9b643(0x136)]&&(_0x41f4e0['shopId']=_0x141818[_0x9b643(0x136)]);const _0x4b7154=await database_1[_0x9b643(0xfd)][_0x9b643(0xd0)][_0x9b643(0xb4)]({'where':_0x41f4e0,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x9b643(0xd8)](_0x9b643(0x134)+_0x4b7154['length']+_0x9b643(0x148));const _0x2eebe1={'gateway':{'not':_0x9b643(0x14f)},'createdAt':{'gte':_0x39d9ff,'lte':_0x2fefb9}};_0x141818['shopId']&&(_0x2eebe1[_0x9b643(0x136)]=_0x141818[_0x9b643(0x136)]);const _0x525a45=await database_1['default'][_0x9b643(0xd0)]['count']({'where':_0x2eebe1});console[_0x9b643(0xd8)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x525a45+',\x20successful:\x20'+_0x4b7154[_0x9b643(0x100)]);let _0x24b661=0x0,_0x93df9b=0x0,_0x4f2855=0x0;const _0x6165b1={},_0x4238e4={},_0x220114={};for(const _0x4d6795 of _0x4b7154){try{const _0x5a024d=await currencyService_1[_0x9b643(0xe6)][_0x9b643(0xed)](_0x4d6795[_0x9b643(0xbf)],_0x4d6795['currency']);let _0x5cc50b={};if(_0x4d6795['shop'][_0x9b643(0x140)])try{_0x5cc50b=JSON[_0x9b643(0xae)](_0x4d6795[_0x9b643(0xf8)][_0x9b643(0x140)]);}catch(_0x3ef44f){console[_0x9b643(0x117)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x4d6795['shopId']+':',_0x3ef44f);}let _0x2eb943={},_0x532a6f=0xa;for(const [_0x3a9785,_0x3d81dd]of Object[_0x9b643(0x8a)](_0x5cc50b)){if(_0x3a9785[_0x9b643(0x67)]()===_0x4d6795[_0x9b643(0x110)][_0x9b643(0x67)]()){_0x2eb943=_0x3d81dd,_0x532a6f=_0x3d81dd[_0x9b643(0x10a)]||0xa;break;}}const _0x21c129=_0x5a024d*(_0x532a6f/0x64),_0x154e42=_0x5a024d-_0x21c129;_0x24b661+=_0x5a024d,_0x93df9b+=_0x154e42,_0x4f2855+=_0x21c129;!_0x6165b1[_0x4d6795[_0x9b643(0x110)]]&&(_0x6165b1[_0x4d6795['gateway']]={'gateway':_0x4d6795['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x4d6795['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x6165b1[_0x4d6795[_0x9b643(0x110)]][_0x9b643(0xf5)]++,_0x6165b1[_0x4d6795[_0x9b643(0x110)]][_0x9b643(0xc2)]+=_0x5a024d,_0x6165b1[_0x4d6795[_0x9b643(0x110)]][_0x9b643(0xe7)]+=_0x21c129,_0x6165b1[_0x4d6795[_0x9b643(0x110)]]['merchantEarningsUSDT']+=_0x154e42,_0x6165b1[_0x4d6795['gateway']][_0x9b643(0x111)]+=_0x532a6f;!_0x141818[_0x9b643(0x136)]&&(!_0x4238e4[_0x4d6795[_0x9b643(0x136)]]&&(_0x4238e4[_0x4d6795[_0x9b643(0x136)]]={'shopId':_0x4d6795[_0x9b643(0x136)],'shopName':_0x4d6795[_0x9b643(0xf8)]['name'],'shopUsername':_0x4d6795[_0x9b643(0xf8)][_0x9b643(0x16b)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4238e4[_0x4d6795[_0x9b643(0x136)]][_0x9b643(0xf5)]++,_0x4238e4[_0x4d6795[_0x9b643(0x136)]][_0x9b643(0xc2)]+=_0x5a024d,_0x4238e4[_0x4d6795['shopId']]['commissionUSDT']+=_0x21c129,_0x4238e4[_0x4d6795[_0x9b643(0x136)]]['merchantEarningsUSDT']+=_0x154e42);const _0x4a4f59=_0x4d6795[_0x9b643(0xb7)][_0x9b643(0xe1)]()[_0x9b643(0x7f)]('T')[0x0];!_0x220114[_0x4a4f59]&&(_0x220114[_0x4a4f59]={'date':_0x4a4f59,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x220114[_0x4a4f59]['turnover']+=_0x5a024d,_0x220114[_0x4a4f59][_0x9b643(0x108)]+=_0x154e42,_0x220114[_0x4a4f59][_0x9b643(0x94)]+=_0x21c129,_0x220114[_0x4a4f59]['paymentsCount']++;}catch(_0x50a6f3){console[_0x9b643(0x117)](_0x9b643(0x10c)+_0x4d6795['id']+':',_0x50a6f3);}}Object[_0x9b643(0x7d)](_0x6165b1)[_0x9b643(0x149)](_0x176b39=>{const _0x2e1440=_0x9b643;_0x176b39[_0x2e1440(0xab)]=_0x176b39[_0x2e1440(0xf5)]>0x0?_0x176b39[_0x2e1440(0x111)]/_0x176b39['paymentsCount']:0x0,delete _0x176b39[_0x2e1440(0x111)];}),Object[_0x9b643(0x7d)](_0x4238e4)[_0x9b643(0x149)](_0x16a79b=>{const _0x5348b7=_0x9b643;_0x16a79b[_0x5348b7(0x14e)]=_0x16a79b[_0x5348b7(0xf5)]>0x0?_0x16a79b['turnoverUSDT']/_0x16a79b[_0x5348b7(0xf5)]:0x0;});let _0x8031f9=0x0;if(_0x141818[_0x9b643(0x136)]){const _0x158a70=await database_1['default'][_0x9b643(0x121)][_0x9b643(0xb4)]({'where':{'shopId':_0x141818['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x39d9ff,'lte':_0x2fefb9}},'select':{'amount':!![]}});_0x8031f9=_0x158a70['reduce']((_0x5b0125,_0x1c133d)=>_0x5b0125+_0x1c133d['amount'],0x0);}const _0x189e3d=_0x525a45,_0x1073f4=_0x4b7154['length'],_0x55b3dc=_0x1073f4>0x0?_0x24b661/_0x1073f4:0x0,_0x49f368=_0x189e3d>0x0?Math[_0x9b643(0x8b)](_0x1073f4/_0x189e3d*0x2710)/0x64:0x0,_0x22832e=Math['ceil']((_0x2fefb9[_0x9b643(0x6e)]()-_0x39d9ff['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x78eea7={'totalTurnover':Math[_0x9b643(0x8b)](_0x24b661*0x64)/0x64,'merchantEarnings':Math[_0x9b643(0x8b)](_0x93df9b*0x64)/0x64,'gatewayEarnings':Math[_0x9b643(0x8b)](_0x4f2855*0x64)/0x64,'totalPaidOut':Math[_0x9b643(0x8b)](_0x8031f9*0x64)/0x64,'averageCheck':Math[_0x9b643(0x8b)](_0x55b3dc*0x64)/0x64,'totalPayments':_0x189e3d,'successfulPayments':_0x1073f4,'conversionRate':_0x49f368,'gatewayBreakdown':Object['values'](_0x6165b1)[_0x9b643(0x83)](_0x53ae52=>({..._0x53ae52,'turnoverUSDT':Math['round'](_0x53ae52[_0x9b643(0xc2)]*0x64)/0x64,'commissionUSDT':Math[_0x9b643(0x8b)](_0x53ae52['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x9b643(0x8b)](_0x53ae52[_0x9b643(0x167)]*0x64)/0x64,'averageCommissionRate':Math[_0x9b643(0x8b)](_0x53ae52['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x141818[_0x9b643(0x136)]?undefined:Object[_0x9b643(0x7d)](_0x4238e4)[_0x9b643(0x83)](_0x23fe1c=>({..._0x23fe1c,'turnoverUSDT':Math[_0x9b643(0x8b)](_0x23fe1c[_0x9b643(0xc2)]*0x64)/0x64,'commissionUSDT':Math[_0x9b643(0x8b)](_0x23fe1c[_0x9b643(0xe7)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x9b643(0x8b)](_0x23fe1c[_0x9b643(0x167)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x23fe1c[_0x9b643(0x158)]*0x64)/0x64,'averageCheckUSDT':Math[_0x9b643(0x8b)](_0x23fe1c[_0x9b643(0x14e)]*0x64)/0x64})),'dailyData':Object[_0x9b643(0x7d)](_0x220114)[_0x9b643(0x83)](_0x1c1387=>({..._0x1c1387,'turnover':Math[_0x9b643(0x8b)](_0x1c1387['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x9b643(0x8b)](_0x1c1387[_0x9b643(0x108)]*0x64)/0x64,'gatewayEarnings':Math[_0x9b643(0x8b)](_0x1c1387['gatewayEarnings']*0x64)/0x64}))['sort']((_0x3c105b,_0xba497c)=>_0x3c105b[_0x9b643(0xe8)][_0x9b643(0x76)](_0xba497c['date'])),'periodInfo':{'from':_0x39d9ff,'to':_0x2fefb9,'periodType':_0x141818[_0x9b643(0xb0)]||_0x9b643(0xd7),'daysCount':_0x22832e}};return console[_0x9b643(0xd8)](_0x9b643(0x11e)),console[_0x9b643(0xd8)](_0x9b643(0x141)+_0x78eea7['totalTurnover']+_0x9b643(0xee)),console[_0x9b643(0xd8)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x78eea7[_0x9b643(0x108)]+'\x20USDT'),console[_0x9b643(0xd8)](_0x9b643(0x162)+_0x78eea7[_0x9b643(0x94)]+_0x9b643(0xee)),console[_0x9b643(0xd8)](_0x9b643(0x12e)+_0x78eea7[_0x9b643(0x90)]),_0x78eea7;}async[a35_0x28db66(0xc4)](){const _0xbcd567=a35_0x28db66;console[_0xbcd567(0xd8)](_0xbcd567(0xea));const _0x5d5ac9=await database_1[_0xbcd567(0xfd)][_0xbcd567(0xf8)][_0xbcd567(0xb4)]({'where':{'status':_0xbcd567(0xfb)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xbcd567(0xdc)}});return console[_0xbcd567(0xd8)]('📋\x20Found\x20'+_0x5d5ac9[_0xbcd567(0x100)]+'\x20active\x20merchants\x20for\x20selection'),_0x5d5ac9['map'](_0x44c26b=>({'id':_0x44c26b['id'],'username':_0x44c26b[_0xbcd567(0x16b)],'name':_0x44c26b['name']}));}[a35_0x28db66(0x150)](_0x7a6b7d){const _0x5f4a2a=a35_0x28db66,_0x9f89cf={'test_gateway':_0x5f4a2a(0x79),'plisio':_0x5f4a2a(0x118),'rapyd':_0x5f4a2a(0x137),'noda':_0x5f4a2a(0xa0),'cointopay':_0x5f4a2a(0xf4),'klyme_eu':_0x5f4a2a(0x7a),'klyme_gb':_0x5f4a2a(0x8c),'klyme_de':_0x5f4a2a(0xca)};return _0x9f89cf[_0x7a6b7d]||_0x7a6b7d;}async['getMerchantsAwaitingPayout'](_0x57dcca){const _0x3b3cb7=a35_0x28db66,{page:_0x12224b,limit:_0x4f8973,minAmount:_0x5b995b,search:_0x16e410}=_0x57dcca,_0x4f3034=(_0x12224b-0x1)*_0x4f8973;console[_0x3b3cb7(0xd8)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x57dcca);const _0x2aff32={'balance':{'gt':0x0},'status':'ACTIVE'};_0x5b995b&&(_0x2aff32[_0x3b3cb7(0xa6)]['gte']=_0x5b995b);_0x16e410&&(_0x2aff32['OR']=[{'name':{'contains':_0x16e410,'mode':_0x3b3cb7(0x86)}},{'username':{'contains':_0x16e410,'mode':'insensitive'}}]);const [_0x172cdc,_0x4484bb]=await Promise[_0x3b3cb7(0x72)]([database_1[_0x3b3cb7(0xfd)]['shop'][_0x3b3cb7(0xb4)]({'where':_0x2aff32,'skip':_0x4f3034,'take':_0x4f8973,'orderBy':{'balance':_0x3b3cb7(0x164)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x3b3cb7(0xfd)][_0x3b3cb7(0xf8)][_0x3b3cb7(0xec)]({'where':_0x2aff32})]);console[_0x3b3cb7(0xd8)](_0x3b3cb7(0x134)+_0x172cdc['length']+_0x3b3cb7(0x10b));const _0x2fc6a9=await Promise[_0x3b3cb7(0x72)](_0x172cdc[_0x3b3cb7(0x83)](async _0x3e8553=>{const _0x1ccf55=_0x3b3cb7,[_0x5c4c89,_0x2de1df,_0x3e29d5]=await Promise['all']([database_1[_0x1ccf55(0xfd)][_0x1ccf55(0xd0)]['count']({'where':{'shopId':_0x3e8553['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x1ccf55(0xfd)][_0x1ccf55(0xd0)][_0x1ccf55(0xb1)]({'where':{'shopId':_0x3e8553['id'],'status':_0x1ccf55(0xce),'amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x1ccf55(0xfd)][_0x1ccf55(0xd0)][_0x1ccf55(0xd2)]({'by':[_0x1ccf55(0x110)],'where':{'shopId':_0x3e8553['id'],'status':_0x1ccf55(0xce),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x33a97c=await Promise[_0x1ccf55(0x72)](_0x3e29d5['map'](async _0x52e592=>{const _0x249bd7=_0x1ccf55;let _0x1cbbcb=0xa;if(_0x3e8553[_0x249bd7(0x140)])try{const _0x4ef2dc=JSON[_0x249bd7(0xae)](_0x3e8553[_0x249bd7(0x140)]);for(const [_0x49a919,_0x5c9796]of Object['entries'](_0x4ef2dc)){if(_0x49a919['toLowerCase']()===_0x52e592[_0x249bd7(0x110)]['toLowerCase']()){_0x1cbbcb=_0x5c9796[_0x249bd7(0x10a)]||0xa,console['log'](_0x249bd7(0x113)+_0x52e592[_0x249bd7(0x110)]+_0x249bd7(0xd6)+_0x3e8553['id']+':\x20commission\x20=\x20'+_0x1cbbcb+'%');break;}}}catch(_0x5114e0){console[_0x249bd7(0x117)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x3e8553['id']+':',_0x5114e0);}const _0x3bd316=_0x52e592[_0x249bd7(0xbd)]['amountUSDT']||0x0,_0x2a0654=_0x3bd316*(0x1-_0x1cbbcb/0x64);return{'gateway':_0x52e592[_0x249bd7(0x110)],'count':_0x52e592[_0x249bd7(0x156)]['id'],'amountUSDT':Math[_0x249bd7(0x8b)](_0x3bd316*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x249bd7(0x8b)](_0x2a0654*0x64)/0x64,'commission':_0x1cbbcb};})),_0x3dde44=_0x33a97c[_0x1ccf55(0x12b)]((_0x3481a6,_0x18fb37)=>_0x3481a6+_0x18fb37[_0x1ccf55(0x114)],0x0),_0x2ea964=_0x33a97c[_0x1ccf55(0x12b)]((_0x348920,_0x547030)=>_0x348920+_0x547030[_0x1ccf55(0xff)],0x0);return{'id':_0x3e8553['id'],'fullName':_0x3e8553[_0x1ccf55(0xbb)],'username':_0x3e8553[_0x1ccf55(0x16b)],'telegramId':_0x3e8553[_0x1ccf55(0xba)],'merchantUrl':_0x3e8553[_0x1ccf55(0x169)],'wallets':{'usdtPolygonWallet':_0x3e8553[_0x1ccf55(0x12a)],'usdtTrcWallet':_0x3e8553[_0x1ccf55(0x15d)],'usdtErcWallet':_0x3e8553[_0x1ccf55(0x109)],'usdcPolygonWallet':_0x3e8553[_0x1ccf55(0xa9)]},'totalAmountUSDT':Math['round'](_0x3dde44*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1ccf55(0x8b)](_0x2ea964*0x64)/0x64,'paymentsCount':_0x5c4c89,'oldestPaymentDate':_0x2de1df?.[_0x1ccf55(0xb7)]||_0x3e8553[_0x1ccf55(0x10e)],'gatewayBreakdown':_0x33a97c};})),_0x582aa2=_0x2fc6a9[_0x3b3cb7(0x12b)]((_0x642c95,_0x331f03)=>_0x642c95+_0x331f03[_0x3b3cb7(0xad)],0x0),_0x476a54=_0x2fc6a9['reduce']((_0x4656c4,_0x4aa501)=>_0x4656c4+_0x4aa501['totalAmountAfterCommissionUSDT'],0x0);return console['log'](_0x3b3cb7(0x12c)+_0x4484bb+_0x3b3cb7(0xa8)+Math['round'](_0x476a54*0x64)/0x64+_0x3b3cb7(0x6f)),{'merchants':_0x2fc6a9,'pagination':{'page':_0x12224b,'limit':_0x4f8973,'total':_0x4484bb,'totalPages':Math[_0x3b3cb7(0x78)](_0x4484bb/_0x4f8973)},'summary':{'totalMerchants':_0x4484bb,'totalAmountUSDT':Math[_0x3b3cb7(0x8b)](_0x582aa2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3b3cb7(0x8b)](_0x476a54*0x64)/0x64}};}async[a35_0x28db66(0x154)](_0x14b7ae){const _0x92828e=a35_0x28db66,{shopId:_0x1d6326,amount:_0x57d5cd,network:_0x2562c0,wallet:_0x25980b,notes:_0x5aaa69,txid:_0x37eb35,periodFrom:_0x1860c0,periodTo:_0x3cce0b}=_0x14b7ae,_0x2690f3=await database_1[_0x92828e(0xfd)][_0x92828e(0x138)](async _0x12e870=>{const _0x50c126=_0x92828e,_0x4109df=await _0x12e870[_0x50c126(0xf8)][_0x50c126(0x16c)]({'where':{'id':_0x1d6326},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4109df)throw new Error('Shop\x20not\x20found');console['log'](_0x50c126(0xf0)+_0x4109df['username']+':'),console['log'](_0x50c126(0xe2)+_0x4109df['balance'][_0x50c126(0xa4)](0x6)+_0x50c126(0xee)),console[_0x50c126(0xd8)](_0x50c126(0xf9)+_0x57d5cd[_0x50c126(0xa4)](0x6)+'\x20USDT'),console[_0x50c126(0xd8)](_0x50c126(0x105)+_0x4109df[_0x50c126(0x73)][_0x50c126(0xa4)](0x6)+_0x50c126(0xee));if(_0x37eb35)console['log'](_0x50c126(0x8d)+_0x37eb35);if(_0x4109df['balance']<_0x57d5cd)throw new Error(_0x50c126(0x77)+_0x4109df['balance'][_0x50c126(0xa4)](0x6)+_0x50c126(0x152)+_0x57d5cd[_0x50c126(0xa4)](0x6)+'\x20USDT');let _0x3c6f42=_0x25980b;if(!_0x3c6f42){const _0x1959de=await _0x12e870[_0x50c126(0xf8)][_0x50c126(0x16c)]({'where':{'id':_0x1d6326},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x1959de)switch(_0x2562c0){case _0x50c126(0x9e):_0x3c6f42=_0x1959de[_0x50c126(0x12a)]||undefined;break;case _0x50c126(0x88):_0x3c6f42=_0x1959de['usdtTrcWallet']||undefined;break;case'erc20':_0x3c6f42=_0x1959de[_0x50c126(0x109)]||undefined;break;case _0x50c126(0x142):_0x3c6f42=_0x1959de[_0x50c126(0xa9)]||undefined;break;}}console[_0x50c126(0xd8)](_0x50c126(0xcc)+_0x2562c0+':\x20'+(_0x3c6f42||_0x50c126(0xd3)));const _0x2e2280=await _0x12e870[_0x50c126(0x121)][_0x50c126(0x91)]({'data':{'shopId':_0x1d6326,'amount':_0x57d5cd,'network':_0x2562c0,'status':_0x50c126(0xe9),'txid':_0x37eb35,'notes':_0x5aaa69,'periodFrom':_0x1860c0?new Date(_0x1860c0):null,'periodTo':_0x3cce0b?new Date(_0x3cce0b):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x34a98f=_0x4109df['balance']-_0x57d5cd,_0x22464c=_0x4109df['totalPaidOut']+_0x57d5cd;return await _0x12e870[_0x50c126(0xf8)][_0x50c126(0xa2)]({'where':{'id':_0x1d6326},'data':{'balance':_0x34a98f,'totalPaidOut':_0x22464c}}),console['log'](_0x50c126(0x75)+_0x4109df[_0x50c126(0x16b)]+_0x50c126(0xf2)),console['log']('\x20\x20\x20Balance:\x20'+_0x4109df[_0x50c126(0xa6)]['toFixed'](0x6)+_0x50c126(0xb5)+_0x34a98f[_0x50c126(0xa4)](0x6)+_0x50c126(0x122)+_0x57d5cd[_0x50c126(0xa4)](0x6)+')'),console[_0x50c126(0xd8)](_0x50c126(0x12d)+_0x4109df[_0x50c126(0x73)][_0x50c126(0xa4)](0x6)+_0x50c126(0xb5)+_0x22464c[_0x50c126(0xa4)](0x6)+'\x20USDT\x20(+'+_0x57d5cd['toFixed'](0x6)+')'),{'payout':_0x2e2280,'shop':_0x4109df};});return console[_0x92828e(0xd8)]('✅\x20Payout\x20created:\x20'+_0x2690f3['payout']['id']+_0x92828e(0xd6)+_0x2690f3['shop'][_0x92828e(0x16b)]+'\x20('+_0x57d5cd+_0x92828e(0x10d)),{'id':_0x2690f3[_0x92828e(0x121)]['id'],'shopId':_0x2690f3[_0x92828e(0x121)][_0x92828e(0x136)],'shopName':_0x2690f3[_0x92828e(0xf8)][_0x92828e(0xbb)],'shopUsername':_0x2690f3[_0x92828e(0xf8)]['username'],'amount':_0x2690f3['payout'][_0x92828e(0xbf)],'network':_0x2690f3['payout'][_0x92828e(0xb2)],'status':_0x2690f3[_0x92828e(0x121)][_0x92828e(0xdf)],'txid':_0x2690f3[_0x92828e(0x121)][_0x92828e(0x101)],'notes':_0x2690f3[_0x92828e(0x121)][_0x92828e(0xeb)],'periodFrom':_0x2690f3[_0x92828e(0x121)]['periodFrom'],'periodTo':_0x2690f3[_0x92828e(0x121)][_0x92828e(0xfe)],'createdAt':_0x2690f3[_0x92828e(0x121)][_0x92828e(0x10e)],'paidAt':_0x2690f3[_0x92828e(0x121)]['paidAt']};}async[a35_0x28db66(0x14a)](_0x42b995){const _0x593cc0=a35_0x28db66,{page:_0x23cf10,limit:_0x2b6624,shopId:_0x54b592,network:_0x310bd6,dateFrom:_0x273227,dateTo:_0x224c9c,search:_0x46a33d}=_0x42b995,_0x58d6be=(_0x23cf10-0x1)*_0x2b6624,_0x36aa7e={};_0x54b592&&(_0x36aa7e[_0x593cc0(0x136)]=_0x54b592);_0x310bd6&&(_0x36aa7e[_0x593cc0(0xb2)]=_0x310bd6);(_0x273227||_0x224c9c)&&(_0x36aa7e[_0x593cc0(0x10e)]={},_0x273227&&(_0x36aa7e['createdAt'][_0x593cc0(0x133)]=new Date(_0x273227)),_0x224c9c&&(_0x36aa7e[_0x593cc0(0x10e)][_0x593cc0(0x157)]=new Date(_0x224c9c)));_0x46a33d&&(_0x36aa7e['OR']=[{'shop':{'name':{'contains':_0x46a33d,'mode':_0x593cc0(0x86)}}},{'shop':{'username':{'contains':_0x46a33d,'mode':'insensitive'}}},{'notes':{'contains':_0x46a33d,'mode':_0x593cc0(0x86)}}]);const [_0x2020aa,_0x27972b]=await Promise[_0x593cc0(0x72)]([database_1['default'][_0x593cc0(0x121)][_0x593cc0(0xb4)]({'where':_0x36aa7e,'skip':_0x58d6be,'take':_0x2b6624,'orderBy':{'createdAt':_0x593cc0(0x164)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x593cc0(0xfd)]['payout'][_0x593cc0(0xec)]({'where':_0x36aa7e})]);return{'payouts':_0x2020aa[_0x593cc0(0x83)](_0x58aacb=>({'id':_0x58aacb['id'],'shopId':_0x58aacb['shopId'],'shopName':_0x58aacb[_0x593cc0(0xf8)]['name'],'shopUsername':_0x58aacb[_0x593cc0(0xf8)][_0x593cc0(0x16b)],'amount':_0x58aacb[_0x593cc0(0xbf)],'network':_0x58aacb[_0x593cc0(0xb2)],'wallet':_0x58aacb[_0x593cc0(0x74)],'status':_0x58aacb[_0x593cc0(0xdf)],'txid':_0x58aacb[_0x593cc0(0x101)],'notes':_0x58aacb['notes'],'periodFrom':_0x58aacb[_0x593cc0(0x104)],'periodTo':_0x58aacb[_0x593cc0(0xfe)],'createdAt':_0x58aacb['createdAt'],'paidAt':_0x58aacb['paidAt']})),'pagination':{'page':_0x23cf10,'limit':_0x2b6624,'total':_0x27972b,'totalPages':Math[_0x593cc0(0x78)](_0x27972b/_0x2b6624)}};}async[a35_0x28db66(0xb6)](_0xe07158){const _0x395003=a35_0x28db66,_0x3e3634=await database_1['default'][_0x395003(0x121)][_0x395003(0x16c)]({'where':{'id':_0xe07158},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3e3634)return null;return{'id':_0x3e3634['id'],'shopId':_0x3e3634[_0x395003(0x136)],'shopName':_0x3e3634['shop'][_0x395003(0xbb)],'shopUsername':_0x3e3634[_0x395003(0xf8)][_0x395003(0x16b)],'amount':_0x3e3634[_0x395003(0xbf)],'network':_0x3e3634[_0x395003(0xb2)],'status':_0x3e3634['status'],'txid':_0x3e3634['txid'],'notes':_0x3e3634[_0x395003(0xeb)],'periodFrom':_0x3e3634[_0x395003(0x104)],'periodTo':_0x3e3634[_0x395003(0xfe)],'createdAt':_0x3e3634['createdAt'],'paidAt':_0x3e3634[_0x395003(0xb7)]};}async['deletePayout'](_0x302a37){const _0x8495b2=a35_0x28db66;await database_1[_0x8495b2(0xfd)][_0x8495b2(0x121)]['delete']({'where':{'id':_0x302a37}});}async[a35_0x28db66(0x139)](_0x74ba25){const _0x3a19ed=a35_0x28db66,{page:_0x4d0a23,limit:_0x4d1b3d,status:_0x5c64c3,gateway:_0x4a02c8,shopId:_0x22e464,dateFrom:_0x2ffe1d,dateTo:_0x304ce8,search:_0xfb1eb6,currency:_0x5854d3,sortBy:_0x3a000b,sortOrder:_0xeebb2d}=_0x74ba25,_0x4a845a=(_0x4d0a23-0x1)*_0x4d1b3d;console[_0x3a19ed(0xd8)](_0x3a19ed(0x16d),_0x74ba25);const _0x1e8738=await database_1[_0x3a19ed(0xfd)][_0x3a19ed(0xd0)][_0x3a19ed(0xd2)]({'by':[_0x3a19ed(0x110)],'_count':{'gateway':!![]}});console[_0x3a19ed(0xd8)](_0x3a19ed(0x15e),_0x1e8738[_0x3a19ed(0x83)](_0x1b2de8=>_0x1b2de8[_0x3a19ed(0x110)]+'\x20('+_0x1b2de8[_0x3a19ed(0x156)][_0x3a19ed(0x110)]+_0x3a19ed(0x7b)));if(_0x4a02c8){const _0x3963ef=_0x1e8738[_0x3a19ed(0x7e)](_0x1d9f6b=>_0x1d9f6b['gateway']['toLowerCase']()===_0x4a02c8[_0x3a19ed(0x67)]());!_0x3963ef&&_0x4a02c8['toLowerCase']()!==_0x3a19ed(0x14f)&&console[_0x3a19ed(0xd8)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x4a02c8+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x1e8738[_0x3a19ed(0x83)](_0x1b0b95=>_0x1b0b95[_0x3a19ed(0x110)])[_0x3a19ed(0x15c)](',\x20'));}const _0x4f1d4f={};_0x5c64c3&&(_0x4f1d4f[_0x3a19ed(0xdf)]=_0x5c64c3[_0x3a19ed(0xc3)]());if(!_0x4a02c8)_0x4f1d4f[_0x3a19ed(0x110)]={'not':_0x3a19ed(0x14f)};else{if(_0x4a02c8&&(_0x4a02c8[_0x3a19ed(0x67)]()===_0x3a19ed(0x14f)||_0x4a02c8===_0x3a19ed(0x160)))_0x4f1d4f[_0x3a19ed(0x110)]=_0x3a19ed(0x14f);else{let _0x504f46=_0x4a02c8;const _0x5d8732=(0x0,gateway_1[_0x3a19ed(0x82)])(_0x4a02c8);if(_0x5d8732)_0x504f46=_0x5d8732,console[_0x3a19ed(0xd8)](_0x3a19ed(0x6b)+_0x4a02c8+_0x3a19ed(0xc6)+_0x504f46+'\x27');else{const _0x1ccdf7=(0x0,gateway_1['getGatewayIdByName'])(_0x4a02c8);if(_0x1ccdf7){const _0x15e5b5=(0x0,gateway_1[_0x3a19ed(0x82)])(_0x1ccdf7);_0x15e5b5&&(_0x504f46=_0x15e5b5,console[_0x3a19ed(0xd8)](_0x3a19ed(0x125)+_0x4a02c8+_0x3a19ed(0x132)+_0x1ccdf7+_0x3a19ed(0x145)+_0x504f46+'\x27'));}else console[_0x3a19ed(0xd8)](_0x3a19ed(0xc7)+_0x4a02c8+_0x3a19ed(0xbc));}const _0x258654=await database_1[_0x3a19ed(0xfd)][_0x3a19ed(0xd0)]['count']({'where':{'gateway':_0x504f46[_0x3a19ed(0x67)]()},'take':0x1});_0x258654===0x0?(console[_0x3a19ed(0xd8)](_0x3a19ed(0x15a)+_0x504f46+_0x3a19ed(0x116)+_0x4a02c8+_0x3a19ed(0xcb)),_0x4f1d4f[_0x3a19ed(0x110)]=_0x3a19ed(0xe3)):(_0x4f1d4f['gateway']=_0x504f46[_0x3a19ed(0x67)](),console[_0x3a19ed(0xd8)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x504f46+_0x3a19ed(0x116)+_0x4a02c8+'\x27)'));}}console[_0x3a19ed(0xd8)](_0x3a19ed(0x16a),_0x4f1d4f[_0x3a19ed(0x110)]);_0x22e464&&(_0x4f1d4f[_0x3a19ed(0x136)]=_0x22e464);_0x5854d3&&(_0x4f1d4f[_0x3a19ed(0x11d)]=_0x5854d3[_0x3a19ed(0xc3)](),console[_0x3a19ed(0xd8)]('💱\x20Currency\x20filter\x20applied:\x20'+_0x5854d3['toUpperCase']()));(_0x2ffe1d||_0x304ce8)&&(_0x4f1d4f[_0x3a19ed(0x10e)]={},_0x2ffe1d&&(_0x4f1d4f['createdAt']['gte']=new Date(_0x2ffe1d)),_0x304ce8&&(_0x4f1d4f[_0x3a19ed(0x10e)][_0x3a19ed(0x157)]=new Date(_0x304ce8)));_0xfb1eb6&&(_0x4f1d4f['OR']=[{'orderId':{'contains':_0xfb1eb6,'mode':_0x3a19ed(0x86)}},{'gatewayOrderId':{'contains':_0xfb1eb6,'mode':_0x3a19ed(0x86)}},{'customerEmail':{'contains':_0xfb1eb6,'mode':_0x3a19ed(0x86)}},{'shop':{'name':{'contains':_0xfb1eb6,'mode':_0x3a19ed(0x86)}}},{'shop':{'username':{'contains':_0xfb1eb6,'mode':'insensitive'}}}]);console[_0x3a19ed(0xd8)](_0x3a19ed(0xfa),JSON[_0x3a19ed(0x146)](_0x4f1d4f,null,0x2));let _0x15c484={'createdAt':_0x3a19ed(0x164)};if(_0x3a000b){const _0x356935=[_0x3a19ed(0xbf),'createdAt',_0x3a19ed(0x97),'status',_0x3a19ed(0x110),_0x3a19ed(0x11d)],_0x583320=['asc',_0x3a19ed(0x164)];if(_0x356935['includes'](_0x3a000b)){const _0x2436ae=_0x583320[_0x3a19ed(0xac)](_0xeebb2d)?_0xeebb2d:'desc';_0x15c484={[_0x3a000b]:_0x2436ae},console[_0x3a19ed(0xd8)](_0x3a19ed(0xd9)+_0x3a000b+_0x3a19ed(0x129)+_0x2436ae+_0x3a19ed(0xe0));}}const [_0x2afd06,_0x1bed28]=await Promise['all']([database_1[_0x3a19ed(0xfd)][_0x3a19ed(0xd0)]['findMany']({'where':_0x4f1d4f,'skip':_0x4a845a,'take':_0x4d1b3d,'orderBy':_0x15c484,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3a19ed(0xfd)][_0x3a19ed(0xd0)]['count']({'where':_0x4f1d4f})]);return{'payments':_0x2afd06[_0x3a19ed(0x83)](_0x1994fa=>({'id':_0x1994fa['id'],'shopId':_0x1994fa[_0x3a19ed(0x136)],'gateway':_0x1994fa['gateway'],'amount':_0x1994fa[_0x3a19ed(0xbf)],'currency':_0x1994fa[_0x3a19ed(0x11d)],'status':_0x1994fa[_0x3a19ed(0xdf)],'orderId':_0x1994fa[_0x3a19ed(0xa7)],'gatewayOrderId':_0x1994fa['gatewayOrderId'],'customerEmail':_0x1994fa[_0x3a19ed(0x8e)],'customerName':_0x1994fa['customerName'],'customerCountry':_0x1994fa[_0x3a19ed(0x95)],'customerIp':_0x1994fa[_0x3a19ed(0x168)],'customerUa':_0x1994fa[_0x3a19ed(0x87)],'failureMessage':_0x1994fa['failureMessage'],'createdAt':_0x1994fa[_0x3a19ed(0x10e)],'updatedAt':_0x1994fa[_0x3a19ed(0x97)],'shop':_0x1994fa[_0x3a19ed(0xf8)]})),'pagination':{'page':_0x4d0a23,'limit':_0x4d1b3d,'total':_0x1bed28,'totalPages':Math[_0x3a19ed(0x78)](_0x1bed28/_0x4d1b3d)}};}async['getPaymentById'](_0x5b89cf){const _0x7392de=a35_0x28db66,_0xd73914=await database_1[_0x7392de(0xfd)]['payment'][_0x7392de(0x16c)]({'where':{'id':_0x5b89cf},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xd73914)return null;return{'id':_0xd73914['id'],'shopId':_0xd73914[_0x7392de(0x136)],'gateway':_0xd73914[_0x7392de(0x110)],'amount':_0xd73914[_0x7392de(0xbf)],'currency':_0xd73914[_0x7392de(0x11d)],'status':_0xd73914[_0x7392de(0xdf)],'orderId':_0xd73914['orderId'],'gatewayOrderId':_0xd73914[_0x7392de(0xa3)],'customerEmail':_0xd73914['customerEmail'],'customerName':_0xd73914['customerName'],'customerCountry':_0xd73914[_0x7392de(0x95)],'customerIp':_0xd73914[_0x7392de(0x168)],'customerUa':_0xd73914[_0x7392de(0x87)],'failureMessage':_0xd73914['failureMessage'],'externalPaymentUrl':_0xd73914['externalPaymentUrl'],'successUrl':_0xd73914[_0x7392de(0x120)],'failUrl':_0xd73914['failUrl'],'pendingUrl':_0xd73914['pendingUrl'],'whiteUrl':_0xd73914[_0x7392de(0xf7)],'createdAt':_0xd73914[_0x7392de(0x10e)],'updatedAt':_0xd73914['updatedAt'],'shop':_0xd73914[_0x7392de(0xf8)]};}async[a35_0x28db66(0x102)](_0x240913,_0x1056d0,_0x2bd26a,_0x592575){const _0x314d01=a35_0x28db66,_0x216175=await database_1[_0x314d01(0xfd)][_0x314d01(0x138)](async _0x489981=>{const _0xe5dc04=_0x314d01,_0x7825f1=await _0x489981[_0xe5dc04(0xd0)]['findUnique']({'where':{'id':_0x240913},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x7825f1)throw new Error('Payment\x20not\x20found');const _0x5006d6=_0x7825f1[_0xe5dc04(0xdf)],_0x3cceeb=_0x1056d0[_0xe5dc04(0xc3)]();console[_0xe5dc04(0xd8)](_0xe5dc04(0x11f)+_0x240913+_0xe5dc04(0x9c)+_0x5006d6+_0xe5dc04(0xb5)+_0x3cceeb),console[_0xe5dc04(0xd8)]('💰\x20Current\x20shop\x20balance:\x20'+_0x7825f1[_0xe5dc04(0xf8)][_0xe5dc04(0xa6)]+_0xe5dc04(0xee));const _0xfe897c={'status':_0x3cceeb,'updatedAt':new Date(),'statusChangedBy':_0xe5dc04(0x6a),'statusChangedAt':new Date()};_0x2bd26a&&(_0xfe897c[_0xe5dc04(0x80)]=_0x2bd26a);_0x3cceeb===_0xe5dc04(0x84)&&_0x592575&&(_0xfe897c[_0xe5dc04(0xcd)]=_0x592575);let _0x583000=0x0,_0x5b7ae4=_0x7825f1[_0xe5dc04(0xf8)]['balance'];if(_0x3cceeb==='PAID'&&_0x5006d6!==_0xe5dc04(0xce)){_0xfe897c[_0xe5dc04(0xb7)]=new Date();const _0x1e54cd=await currencyService_1[_0xe5dc04(0xe6)]['convertToUSDT'](_0x7825f1[_0xe5dc04(0xbf)],_0x7825f1[_0xe5dc04(0x11d)]);_0xfe897c[_0xe5dc04(0x114)]=_0x1e54cd,_0x583000=_0x1e54cd,_0x5b7ae4+=_0x1e54cd,console['log'](_0xe5dc04(0x71)+_0x240913+_0xe5dc04(0x144)+_0x1e54cd[_0xe5dc04(0xa4)](0x6)+'\x20USDT\x20to\x20balance');}else _0x5006d6===_0xe5dc04(0xce)&&_0x3cceeb!==_0xe5dc04(0xce)&&(_0x7825f1[_0xe5dc04(0x114)]&&(_0x583000=-_0x7825f1[_0xe5dc04(0x114)],_0x5b7ae4-=_0x7825f1[_0xe5dc04(0x114)],_0xfe897c[_0xe5dc04(0x114)]=null,console[_0xe5dc04(0xd8)](_0xe5dc04(0x71)+_0x240913+_0xe5dc04(0xaf)+_0x7825f1[_0xe5dc04(0x114)][_0xe5dc04(0xa4)](0x6)+_0xe5dc04(0x151))));if(_0x3cceeb===_0xe5dc04(0x84)){if(_0x5006d6===_0xe5dc04(0xce)&&_0x7825f1['amountUSDT']){}_0x592575&&_0x592575>0x0&&(_0x583000-=_0x592575,_0x5b7ae4-=_0x592575,console['log']('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x592575[_0xe5dc04(0xa4)](0x6)+_0xe5dc04(0x151)));}_0x3cceeb===_0xe5dc04(0xc0)&&_0x5006d6===_0xe5dc04(0xce)&&console[_0xe5dc04(0xd8)](_0xe5dc04(0x7c));const _0x309ebd=await _0x489981[_0xe5dc04(0xd0)][_0xe5dc04(0xa2)]({'where':{'id':_0x240913},'data':_0xfe897c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x583000!==0x0&&(await _0x489981['shop']['update']({'where':{'id':_0x7825f1[_0xe5dc04(0x136)]},'data':{'balance':_0x5b7ae4}}),console['log'](_0xe5dc04(0x75)+_0x7825f1['shopId']+_0xe5dc04(0x15f)+_0x7825f1['shop'][_0xe5dc04(0xa6)][_0xe5dc04(0xa4)](0x6)+_0xe5dc04(0xb5)+_0x5b7ae4[_0xe5dc04(0xa4)](0x6)+'\x20USDT\x20('+(_0x583000>0x0?'+':'')+_0x583000[_0xe5dc04(0xa4)](0x6)+')')),_0x309ebd;});return{'id':_0x216175['id'],'shopId':_0x216175[_0x314d01(0x136)],'gateway':_0x216175[_0x314d01(0x110)],'amount':_0x216175[_0x314d01(0xbf)],'currency':_0x216175[_0x314d01(0x11d)],'status':_0x216175[_0x314d01(0xdf)],'orderId':_0x216175[_0x314d01(0xa7)],'gatewayOrderId':_0x216175[_0x314d01(0xa3)],'customerEmail':_0x216175[_0x314d01(0x8e)],'customerName':_0x216175[_0x314d01(0x107)],'customerCountry':_0x216175[_0x314d01(0x95)],'customerIp':_0x216175['customerIp'],'customerUa':_0x216175['customerUa'],'failureMessage':_0x216175['failureMessage'],'adminNotes':_0x216175[_0x314d01(0x80)],'chargebackAmount':_0x216175[_0x314d01(0xcd)],'statusChangedBy':_0x216175[_0x314d01(0xd4)],'statusChangedAt':_0x216175[_0x314d01(0x92)],'createdAt':_0x216175[_0x314d01(0x10e)],'updatedAt':_0x216175['updatedAt'],'shop':_0x216175[_0x314d01(0xf8)]};}async[a35_0x28db66(0xe4)](_0x341d53,_0xc317ce){const _0xbe302e=a35_0x28db66,_0x57f257={..._0xc317ce};_0xc317ce[_0xbe302e(0xde)]&&(_0x57f257['password']=await bcryptjs_1[_0xbe302e(0xfd)][_0xbe302e(0x9a)](_0xc317ce['password'],0xc));_0xc317ce[_0xbe302e(0x15b)]&&(_0x57f257[_0xbe302e(0xbb)]=_0xc317ce[_0xbe302e(0x15b)],delete _0x57f257['fullName']);_0xc317ce['telegramId']&&(_0x57f257[_0xbe302e(0xba)]=_0xc317ce[_0xbe302e(0x147)],delete _0x57f257[_0xbe302e(0x147)]);_0xc317ce[_0xbe302e(0xc8)]&&(_0x57f257[_0xbe302e(0x169)]=_0xc317ce[_0xbe302e(0xc8)],delete _0x57f257[_0xbe302e(0xc8)]);_0xc317ce[_0xbe302e(0x69)]&&(_0x57f257[_0xbe302e(0x11a)]=JSON['stringify'](_0xc317ce[_0xbe302e(0x69)]),delete _0x57f257[_0xbe302e(0x69)]);_0xc317ce[_0xbe302e(0x140)]&&(_0x57f257[_0xbe302e(0x140)]=JSON['stringify'](_0xc317ce[_0xbe302e(0x140)]),delete _0x57f257['gatewaySettings']);_0xc317ce[_0xbe302e(0xc9)]&&(_0xc317ce[_0xbe302e(0xc9)][_0xbe302e(0x12a)]!==undefined&&(_0x57f257[_0xbe302e(0x12a)]=_0xc317ce[_0xbe302e(0xc9)][_0xbe302e(0x12a)]||null),_0xc317ce['wallets']['usdtTrcWallet']!==undefined&&(_0x57f257[_0xbe302e(0x15d)]=_0xc317ce[_0xbe302e(0xc9)][_0xbe302e(0x15d)]||null),_0xc317ce[_0xbe302e(0xc9)][_0xbe302e(0x109)]!==undefined&&(_0x57f257[_0xbe302e(0x109)]=_0xc317ce['wallets'][_0xbe302e(0x109)]||null),_0xc317ce[_0xbe302e(0xc9)]['usdcPolygonWallet']!==undefined&&(_0x57f257[_0xbe302e(0xa9)]=_0xc317ce['wallets'][_0xbe302e(0xa9)]||null),delete _0x57f257[_0xbe302e(0xc9)]);const _0x4e31d5=await database_1[_0xbe302e(0xfd)][_0xbe302e(0xf8)][_0xbe302e(0xa2)]({'where':{'id':_0x341d53},'data':_0x57f257,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4e31d5['id'],'fullName':_0x4e31d5['name'],'username':_0x4e31d5['username'],'telegramId':_0x4e31d5[_0xbe302e(0xba)],'merchantUrl':_0x4e31d5[_0xbe302e(0x169)],'gateways':_0x4e31d5[_0xbe302e(0x11a)]?JSON['parse'](_0x4e31d5[_0xbe302e(0x11a)]):null,'gatewaySettings':_0x4e31d5[_0xbe302e(0x140)]?JSON[_0xbe302e(0xae)](_0x4e31d5[_0xbe302e(0x140)]):null,'publicKey':_0x4e31d5[_0xbe302e(0xb8)],'wallets':{'usdtPolygonWallet':_0x4e31d5[_0xbe302e(0x12a)],'usdtTrcWallet':_0x4e31d5['usdtTrcWallet'],'usdtErcWallet':_0x4e31d5['usdtErcWallet'],'usdcPolygonWallet':_0x4e31d5[_0xbe302e(0xa9)]},'status':_0x4e31d5[_0xbe302e(0xdf)],'createdAt':_0x4e31d5[_0xbe302e(0x10e)]};}async['suspendUser'](_0xb2b25c){const _0x1dca8a=a35_0x28db66,_0x2b8adc=await database_1[_0x1dca8a(0xfd)][_0x1dca8a(0xf8)][_0x1dca8a(0xa2)]({'where':{'id':_0xb2b25c},'data':{'status':_0x1dca8a(0x127)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2b8adc['id'],'fullName':_0x2b8adc['name'],'username':_0x2b8adc[_0x1dca8a(0x16b)],'telegramId':_0x2b8adc[_0x1dca8a(0xba)],'merchantUrl':_0x2b8adc[_0x1dca8a(0x169)],'gateways':_0x2b8adc['paymentGateways']?JSON[_0x1dca8a(0xae)](_0x2b8adc[_0x1dca8a(0x11a)]):null,'gatewaySettings':_0x2b8adc[_0x1dca8a(0x140)]?JSON['parse'](_0x2b8adc[_0x1dca8a(0x140)]):null,'publicKey':_0x2b8adc[_0x1dca8a(0xb8)],'wallets':{'usdtPolygonWallet':_0x2b8adc[_0x1dca8a(0x12a)],'usdtTrcWallet':_0x2b8adc[_0x1dca8a(0x15d)],'usdtErcWallet':_0x2b8adc[_0x1dca8a(0x109)],'usdcPolygonWallet':_0x2b8adc[_0x1dca8a(0xa9)]},'status':_0x2b8adc[_0x1dca8a(0xdf)],'createdAt':_0x2b8adc['createdAt']};}async[a35_0x28db66(0x143)](_0x5c8056){const _0x637e7d=a35_0x28db66,_0x6053fc=await database_1[_0x637e7d(0xfd)][_0x637e7d(0xf8)][_0x637e7d(0xa2)]({'where':{'id':_0x5c8056},'data':{'status':_0x637e7d(0xfb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x6053fc['id'],'fullName':_0x6053fc[_0x637e7d(0xbb)],'username':_0x6053fc[_0x637e7d(0x16b)],'telegramId':_0x6053fc[_0x637e7d(0xba)],'merchantUrl':_0x6053fc['shopUrl'],'gateways':_0x6053fc[_0x637e7d(0x11a)]?JSON[_0x637e7d(0xae)](_0x6053fc[_0x637e7d(0x11a)]):null,'gatewaySettings':_0x6053fc[_0x637e7d(0x140)]?JSON['parse'](_0x6053fc['gatewaySettings']):null,'publicKey':_0x6053fc['publicKey'],'wallets':{'usdtPolygonWallet':_0x6053fc[_0x637e7d(0x12a)],'usdtTrcWallet':_0x6053fc['usdtTrcWallet'],'usdtErcWallet':_0x6053fc[_0x637e7d(0x109)],'usdcPolygonWallet':_0x6053fc['usdcPolygonWallet']},'status':_0x6053fc[_0x637e7d(0xdf)],'createdAt':_0x6053fc[_0x637e7d(0x10e)]};}async[a35_0x28db66(0x131)](_0x509c28){const _0x4b8fdd=a35_0x28db66,{page:_0x422681,limit:_0x8ddc11,status:_0x105c81}=_0x509c28,_0x24e711=(_0x422681-0x1)*_0x8ddc11,_0x37b369={};_0x105c81&&(_0x37b369[_0x4b8fdd(0xdf)]=_0x105c81[_0x4b8fdd(0xc3)]());const [_0xaf1329,_0x5b2485]=await Promise['all']([database_1['default'][_0x4b8fdd(0xf8)]['findMany']({'where':_0x37b369,'skip':_0x24e711,'take':_0x8ddc11,'orderBy':{'createdAt':_0x4b8fdd(0x164)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4b8fdd(0xfd)][_0x4b8fdd(0xf8)]['count']({'where':_0x37b369})]);return{'users':_0xaf1329[_0x4b8fdd(0x83)](_0x2fb61f=>({'id':_0x2fb61f['id'],'fullName':_0x2fb61f[_0x4b8fdd(0xbb)],'username':_0x2fb61f['username'],'telegramId':_0x2fb61f[_0x4b8fdd(0xba)],'merchantUrl':_0x2fb61f[_0x4b8fdd(0x169)],'gateways':_0x2fb61f[_0x4b8fdd(0x11a)]?JSON[_0x4b8fdd(0xae)](_0x2fb61f['paymentGateways']):null,'gatewaySettings':_0x2fb61f[_0x4b8fdd(0x140)]?JSON['parse'](_0x2fb61f[_0x4b8fdd(0x140)]):null,'publicKey':_0x2fb61f[_0x4b8fdd(0xb8)],'wallets':{'usdtPolygonWallet':_0x2fb61f[_0x4b8fdd(0x12a)],'usdtTrcWallet':_0x2fb61f[_0x4b8fdd(0x15d)],'usdtErcWallet':_0x2fb61f[_0x4b8fdd(0x109)],'usdcPolygonWallet':_0x2fb61f[_0x4b8fdd(0xa9)]},'status':_0x2fb61f[_0x4b8fdd(0xdf)],'createdAt':_0x2fb61f['createdAt']})),'pagination':{'page':_0x422681,'limit':_0x8ddc11,'total':_0x5b2485,'totalPages':Math[_0x4b8fdd(0x78)](_0x5b2485/_0x8ddc11)}};}async['getUserById'](_0x546818){const _0x24655e=a35_0x28db66,_0xf7c4fc=await database_1[_0x24655e(0xfd)]['shop'][_0x24655e(0x16c)]({'where':{'id':_0x546818},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xf7c4fc)return null;return{'id':_0xf7c4fc['id'],'fullName':_0xf7c4fc[_0x24655e(0xbb)],'username':_0xf7c4fc[_0x24655e(0x16b)],'telegramId':_0xf7c4fc[_0x24655e(0xba)],'merchantUrl':_0xf7c4fc[_0x24655e(0x169)],'gateways':_0xf7c4fc[_0x24655e(0x11a)]?JSON['parse'](_0xf7c4fc[_0x24655e(0x11a)]):null,'gatewaySettings':_0xf7c4fc[_0x24655e(0x140)]?JSON[_0x24655e(0xae)](_0xf7c4fc[_0x24655e(0x140)]):null,'publicKey':_0xf7c4fc[_0x24655e(0xb8)],'wallets':{'usdtPolygonWallet':_0xf7c4fc[_0x24655e(0x12a)],'usdtTrcWallet':_0xf7c4fc[_0x24655e(0x15d)],'usdtErcWallet':_0xf7c4fc['usdtErcWallet'],'usdcPolygonWallet':_0xf7c4fc[_0x24655e(0xa9)]},'status':_0xf7c4fc[_0x24655e(0xdf)],'createdAt':_0xf7c4fc[_0x24655e(0x10e)]};}async['createUser'](_0xa0a2ec){const _0x22c712=a35_0x28db66,{fullName:_0x4b81c3,username:_0x26539a,password:_0x5140b4,telegramId:_0x4ff6db,merchantUrl:_0x2b9d9a,gateways:_0x189e70,gatewaySettings:_0x38dbb2,wallets:_0x686181}=_0xa0a2ec,_0x293d3a=await database_1[_0x22c712(0xfd)][_0x22c712(0xf8)][_0x22c712(0x16c)]({'where':{'username':_0x26539a}});if(_0x293d3a)throw new Error(_0x22c712(0x89));if(_0x4ff6db){const _0x3754db=await database_1[_0x22c712(0xfd)][_0x22c712(0xf8)][_0x22c712(0x16c)]({'where':{'telegram':_0x4ff6db}});if(_0x3754db)throw new Error(_0x22c712(0x106));}const _0x4a59b8=await bcryptjs_1[_0x22c712(0xfd)][_0x22c712(0x9a)](_0x5140b4,0xc),_0xc2470c='pk_'+crypto_1[_0x22c712(0xfd)][_0x22c712(0x13e)](0x20)[_0x22c712(0xc1)](_0x22c712(0x128)),_0x2dd464=_0x22c712(0x153)+crypto_1[_0x22c712(0xfd)]['randomBytes'](0x20)[_0x22c712(0xc1)](_0x22c712(0x128)),_0x7a130d=await database_1[_0x22c712(0xfd)][_0x22c712(0xf8)][_0x22c712(0x91)]({'data':{'name':_0x4b81c3,'username':_0x26539a,'password':_0x4a59b8,'telegram':_0x4ff6db,'shopUrl':_0x2b9d9a,'paymentGateways':_0x189e70?JSON['stringify'](_0x189e70):null,'gatewaySettings':_0x38dbb2?JSON[_0x22c712(0x146)](_0x38dbb2):null,'usdtPolygonWallet':_0x686181?.[_0x22c712(0x12a)]||null,'usdtTrcWallet':_0x686181?.[_0x22c712(0x15d)]||null,'usdtErcWallet':_0x686181?.[_0x22c712(0x109)]||null,'usdcPolygonWallet':_0x686181?.[_0x22c712(0xa9)]||null,'publicKey':_0xc2470c,'secretKey':_0x2dd464,'status':_0x22c712(0xfb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x7a130d['id'],'fullName':_0x7a130d[_0x22c712(0xbb)],'username':_0x7a130d[_0x22c712(0x16b)],'telegramId':_0x7a130d[_0x22c712(0xba)],'merchantUrl':_0x7a130d['shopUrl'],'gateways':_0x7a130d['paymentGateways']?JSON[_0x22c712(0xae)](_0x7a130d[_0x22c712(0x11a)]):null,'gatewaySettings':_0x7a130d[_0x22c712(0x140)]?JSON[_0x22c712(0xae)](_0x7a130d[_0x22c712(0x140)]):null,'publicKey':_0x7a130d[_0x22c712(0xb8)],'wallets':{'usdtPolygonWallet':_0x7a130d[_0x22c712(0x12a)],'usdtTrcWallet':_0x7a130d[_0x22c712(0x15d)],'usdtErcWallet':_0x7a130d[_0x22c712(0x109)],'usdcPolygonWallet':_0x7a130d['usdcPolygonWallet']},'status':_0x7a130d[_0x22c712(0xdf)],'createdAt':_0x7a130d[_0x22c712(0x10e)]};}async[a35_0x28db66(0x93)](_0x4c6e3c){const _0x5f26c7=a35_0x28db66;await database_1[_0x5f26c7(0xfd)][_0x5f26c7(0xf8)][_0x5f26c7(0x99)]({'where':{'id':_0x4c6e3c}});}['generateDailyStatistics'](_0x1c5f69,_0xa11b70,_0xbaf803){const _0xff7851=a35_0x28db66,_0x18abea=new Map(),_0x3516bc=new Date(_0xa11b70);while(_0x3516bc<=_0xbaf803){const _0x421d38=_0x3516bc['toISOString']()['split']('T')[0x0];_0x18abea[_0xff7851(0x13b)](_0x421d38,{'revenue':0x0,'count':0x0}),_0x3516bc[_0xff7851(0x8f)](_0x3516bc[_0xff7851(0xf1)]()+0x1);}for(const _0x450ed0 of _0x1c5f69){const _0x525438=_0x450ed0[_0xff7851(0x10e)]['toISOString']()[_0xff7851(0x7f)]('T')[0x0],_0x10bfd3=_0x18abea[_0xff7851(0x14d)](_0x525438);_0x10bfd3&&(_0x10bfd3['count']+=0x1,_0x450ed0[_0xff7851(0xdf)]==='PAID'&&(_0x450ed0['amountUSDT']?_0x10bfd3['revenue']+=_0x450ed0[_0xff7851(0x114)]:console[_0xff7851(0xd8)](_0xff7851(0x161)+_0x450ed0['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x46c9a9=[],_0x2fc19e=[];for(const [_0x5830ba,_0x2f33bc]of _0x18abea){_0x46c9a9[_0xff7851(0xb9)]({'date':_0x5830ba,'amount':Math[_0xff7851(0x8b)](_0x2f33bc['revenue']*0x64)/0x64}),_0x2fc19e[_0xff7851(0xb9)]({'date':_0x5830ba,'count':_0x2f33bc['count']});}return{'dailyRevenue':_0x46c9a9,'dailyPayments':_0x2fc19e};}}exports[a35_0x28db66(0xdb)]=AdminService;function a35_0x339a(){const _0x343bc7=['📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','desc','year','\x20\x20\x20🖥️\x20User\x20Agent:\x20','merchantEarningsUSDT','customerIp','shopUrl','📊\x20Gateway\x20filter\x20applied:','username','findUnique','📊\x20Getting\x20payments\x20with\x20filters:','toLowerCase','__esModule','gateways','admin','🔄\x20Converted\x20gateway\x20ID\x20\x27','generateDailyStatistics','week','getTime','\x20USDT\x20total','getPayoutStats','💰\x20Payment\x20','all','totalPaidOut','wallet','💰\x20Shop\x20','localeCompare','Insufficient\x20balance.\x20Available:\x20','ceil','Test\x20Gateway','KLYME\x20EU','\x20payments)','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','values','some','split','adminNotes','./currencyService','getGatewayNameById','map','CHARGEBACK','2020-01-01','insensitive','customerUa','trc20','Username\x20already\x20exists','entries','round','KLYME\x20GB','\x20\x20\x20Transaction\x20hash:\x20','customerEmail','setDate','totalPayments','create','statusChangedAt','deleteUser','gatewayEarnings','customerCountry','dateFrom','updatedAt','updateCustomerData','delete','hash','📅\x20Period:\x20','\x20status:\x20','\x20\x20\x20🌐\x20IP:\x20','polygon','\x20\x20\x20💰\x20Total\x20payout:\x20','Noda','not\x20set','update','gatewayOrderId','toFixed','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','balance','orderId','\x20merchants,\x20','usdcPolygonWallet','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','averageCommissionRate','includes','totalAmountUSDT','parse','\x20no\x20longer\x20PAID:\x20-','period','findFirst','network','📊\x20Payout\x20statistics\x20calculated:','findMany','\x20->\x20','getPayoutById','paidAt','publicKey','push','telegram','name','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','_sum','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','amount','REFUND','toString','turnoverUSDT','toUpperCase','getMerchantsSelection','Payment\x20not\x20found','\x27\x20to\x20name\x20\x27','🔍\x20Using\x20gateway\x20\x27','merchantUrl','wallets','KLYME\x20DE','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','💳\x20Payout\x20wallet\x20for\x20','chargebackAmount','PAID','📊\x20Calculating\x20payout\x20statistics...','payment','getMonth','groupBy','not\x20specified','statusChangedBy','awaitingPayout','\x20for\x20shop\x20','custom','log','📊\x20Sorting\x20payments\x20by\x20','getFullYear','AdminService','asc','dailyRevenue','password','status','\x20order','toISOString','\x20\x20\x20Current\x20balance:\x20','NONEXISTENT_GATEWAY_FILTER','updateUser','\x20\x20\x20💵\x20Available\x20balance:\x20','currencyService','commissionUSDT','date','COMPLETED','📋\x20Getting\x20merchants\x20selection\x20list...','notes','count','convertToUSDT','\x20USDT','3041424LJoDjk','💰\x20Creating\x20payout\x20for\x20shop\x20','getDate','\x20balance\x20updated:','11972940vWrLwn','CoinToPay','paymentsCount','4567785kGSndW','whiteUrl','shop','\x20\x20\x20Payout\x20amount:\x20','📊\x20Final\x20WHERE\x20conditions:','ACTIVE','bcryptjs','default','periodTo','amountAfterCommissionUSDT','length','txid','updatePaymentStatus','__importDefault','periodFrom','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','Telegram\x20username\x20already\x20exists','customerName','merchantEarnings','usdtErcWallet','commission','\x20merchants\x20with\x20positive\x20balance','Error\x20processing\x20payment\x20','\x20USDT)','createdAt','\x20\x20\x20🌍\x20Country:\x20','gateway','totalCommissionRate','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','💰\x20[PAYOUT]\x20Gateway\x20','amountUSDT','availableBalance','\x27\x20(from\x20\x27','error','Plisio','getSystemStatistics','paymentGateways','aggregate','548096khLPCl','currency','📊\x20Merchant\x20statistics\x20calculated:','🔄\x20Admin\x20updating\x20payment\x20','successUrl','payout','\x20USDT\x20(-','9IbQYoP','../config/database','🔄\x20Converted\x20gateway\x20name\x20\x27','defineProperty','SUSPENDED','hex','\x20in\x20','usdtPolygonWallet','reduce','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20📊\x20Total\x20payments:\x20','4934724Vqxmoo','\x20USDT\x20(total\x20paid\x20to\x20merchants)','getAllUsers','\x27\x20->\x20ID\x20\x27','gte','💰\x20Found\x20','thisMonth','shopId','Rapyd','$transaction','getAllPayments','9421208BATYwJ','set','170qYVXYE','\x20USDT\x20(same\x20as\x20awaiting)','randomBytes','\x20to\x20','gatewaySettings','\x20\x20\x20💰\x20Total\x20turnover:\x20','polygon_usdc','activateUser','\x20became\x20PAID:\x20+','\x27\x20->\x20name\x20\x27','stringify','telegramId','\x20paid\x20payments\x20for\x20analysis','forEach','getAllPayouts','dailyPayments','dateTo','get','averageCheckUSDT','test_gateway','getGatewayDisplayName','\x20USDT\x20from\x20balance','\x20USDT,\x20Requested:\x20','sk_','createPayout','144282IWVoXy','_count','lte','paidOutUSDT','\x20\x20\x20📅\x20This\x20month:\x20','⚠️\x20Gateway\x20\x27','fullName','join','usdtTrcWallet','📊\x20Available\x20gateways\x20in\x20database:','\x20balance\x20updated:\x20','0000','⚠️\x20Payment\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'];a35_0x339a=function(){return _0x343bc7;};return a35_0x339a();}