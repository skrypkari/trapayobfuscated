'use strict';const a46_0x4851f0=a46_0xef95;(function(_0x108603,_0x3bd723){const _0x2179bc=a46_0xef95,_0x4539f6=_0x108603();while(!![]){try{const _0x538300=-parseInt(_0x2179bc(0x207))/0x1*(-parseInt(_0x2179bc(0x1eb))/0x2)+parseInt(_0x2179bc(0x2b3))/0x3+-parseInt(_0x2179bc(0x2f9))/0x4+parseInt(_0x2179bc(0x1c2))/0x5+parseInt(_0x2179bc(0x1f4))/0x6*(-parseInt(_0x2179bc(0x204))/0x7)+-parseInt(_0x2179bc(0x23c))/0x8*(parseInt(_0x2179bc(0x219))/0x9)+parseInt(_0x2179bc(0x277))/0xa;if(_0x538300===_0x3bd723)break;else _0x4539f6['push'](_0x4539f6['shift']());}catch(_0x17fac1){_0x4539f6['push'](_0x4539f6['shift']());}}}(a46_0x3c35,0x615e5));function a46_0x3c35(){const _0x322371=['ðŸ”\x20Balance\x20check\x20details:','getGatewayDisplayName','failUrl','dailyRevenue','randomBytes','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','turnoverUSDT','getDate','trc20','turnover','\x20\x20\x20Merchant\x20loses:\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','paidOutUSDT','\x20USDT\x20(already\x20paid\x20out)','gte','getGatewayNameById','Telegram\x20username\x20already\x20exists','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','Test\x20Gateway','map','totalPayments','\x20order','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','ðŸ“…\x20Date\x20to\x20filter:\x20','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','1940781tChiCS','reduce','NONEXISTENT_GATEWAY_FILTER','merchantEarningsUSDT','\x20USDT,\x20merchant:\x20','%\x20commission)','\x20\x20\x20Merchant\x20gets:\x20','custom','\x20\x20\x20Balance:\x20','gatewayEarnings','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20',']\x20Gateway\x20settings\x20before\x20saving:','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','\x20\x20\x20ðŸŒ\x20IP:\x20','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','last_month','usdtErcWallet','network','totalAmountAfterCommissionUSDT','\x20USDT\x20(after\x20','\x20status:\x20','ðŸ”\x20[','\x20\x20\x20ðŸ¤”\x20Difference:\x20','log','pendingPayout',',\x20refunds:\x20','âœ…\x20Payout\x20created\x20in\x20DB:','setDate','not\x20specified','customerEmail','publicKey','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','ðŸ”„\x20Gateway\x20mapping\x20(get):','pendingUrl','currency','delete','getTime','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','amount','_sum','ðŸ’°\x20Payment\x20','\x20for\x20shop\x20','getPayoutStats','ACTIVE','ðŸ’±\x20Currency\x20filter\x20applied:\x20','includes','EXPIRED','setHours','polygon_usdc','createdAt','Payment\x20not\x20found','Shop\x20not\x20found','setUTCDate','defineProperty','push','this_month','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','gatewayOrderId','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','gateway','some','getUserById','./currencyService','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','createPayout','1236192HGdvqd','klyme_de','join','\x20USDT\x20(+','rapyd','amountAfterGatewayCommissionUSDT','\x20balance\x20updated:','ðŸ’°\x20Current\x20shop\x20balance:\x20','create','KLYME\x20EU','txid','filter','periodTo','paymentsCount','updatedAt','merchantUrl','password','shopUrl','\x20-\x20','usdcErcWallet','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','generateDailyStatistics','period','CoinToPay','\x20paid\x20payments\x20for\x20analysis','KLYME\x20GB','parse','ru-RU','lte','getUTCDate','totalCommissionRate','getGatewayIdByName','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','AdminService','getUTCMonth','ðŸ“Š\x20Statistics\x20date\x20range:\x20','usdtTrcWallet','getFullYear','getAllPayments','groupBy','customerIp','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','startsWith','hex','Plisio','REFUND','count','ðŸ“Š\x20Sorting\x20payments\x20by\x20','%\x20from\x20','replace','failureMessage','plisio','\x20\x20\x20Payout\x20amount:\x20','424755BEGUbm','getPaymentById','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','Error\x20processing\x20payment\x20',']\x20Gateway\x20settings\x20JSON\x20string:','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','getAllPayouts','_count','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','amountUSDT','\x20\x20\x20Available\x20(raw):\x20','toString','gatewayCommissionRate','telegram','values','getUTCFullYear','CHARGEBACK','\x20with\x20payout\x20history','ðŸ“…\x20Period:\x20','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','substr','\x20in\x20','notes','convertToUSDT','chargebackAmount','âš ï¸\x20Payment\x20','totalTurnover','\x27\x20->\x20name\x20\x27','findFirst','entries','split','Noda','payment','âœ…\x20Using\x20gateway\x20filter:\x20\x27','default','updateUser','awaitingPayout','wallet','\x20\x20\x20Subtracted\x20from\x20balance:\x20-',',\x20successful:\x20','merchantEarnings','627866IgNVFy','get','âœ…\x20Payout\x20created:\x20','KLYME\x20DE','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','klyme_gb','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','month','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','1194uXEgcO','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','totalPaidOut','\x20\x20\x20Gateway:\x20','ðŸ’°\x20Shop\x20','\x20\x20\x20â³\x20Pending\x20payout:\x20','\x20merchants\x20for\x20selection','\x20USDT)','ðŸ’°\x20Found\x20','mastercard','commission','0000','toFixed','customerUa','periodFrom','19369vWzqtf','../config/database','toISOString','1fQiACg','error','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','yesterday','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','commissionUSDT','findMany','ðŸ“Š\x20Gateway\x20filter\x20applied:','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','thisMonth','desc','\x20USDT',',\x20userId:\x20','externalPaymentUrl','\x20USDT\x20(theoretical\x20net)','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','2020-01-01','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','9ekKeWU','ceil','toLocaleDateString','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','stringify','sk_','\x20\x20\x20Total\x20paid\x20out:\x20','username','balance','shopId','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','cointopay','\x20merchants','MasterCard','âš ï¸\x20Requested\x20gateway\x20\x27','asc','this_week','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','update','payout','totalPayout','length','warn','PENDING','name','PAID','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','ðŸ“‹\x20Found\x20','hash','random','orderId','forEach','revenue','\x20payments)','averageCommissionRate','4308152vaXuGh','wallets','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','admin','\x20\x20\x20ðŸŒ\x20Country:\x20','gatewaySettings','updateCustomerData','toLowerCase',':\x20commission\x20=\x20','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','deletePayout','floor','\x27\x20to\x20name\x20\x27','year','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','erc20','fullName','slice','getGatewayInternalName','averageCheckUSDT','\x20to\x20','all','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','customerCountry','ðŸ“Š\x20Payout\x20statistics\x20calculated:','test_gateway','Rapyd','\x20\x20\x20Full\x20amount:\x20','round','\x20USDT\x20(-','../types/gateway','\x20balance\x20updated:\x20','cointopay2','./telegramBotService','whiteUrl','ðŸ”§\x20[','aggregate','ðŸ”\x20Using\x20gateway\x20\x27','pk_','availableBalance','status','COMPLETED','\x27\x20not\x20found.\x20Available\x20gateways:\x20','noda','getMonth','custom_','dateFrom','sendPayoutNotification','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','currencyService','getAllUsers','deleteUser','\x27\x20->\x20ID\x20\x27','usdtPolygonWallet','\x20\x20\x20Difference:\x20','\x20USDT\x20(gross\x20revenue)','shop','getUTCDay','7512100fOGaWd','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','insensitive','toUpperCase','dateTo','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','telegramBotService',',\x20Commission:\x20','not\x20set','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','UTC','ðŸ“…\x20Date\x20from\x20filter:\x20','date','\x20USDT\x20from\x20balance','Open\x20Banking\x202','set','\x20->\x20','paidAt','findUnique','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','\x27\x20(from\x20\x27','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','__esModule','SUSPENDED','ðŸŽ¯\x20[','getMerchantsSelection','usdcPolygonWallet','min','paymentGateways','klyme_eu','gateways'];a46_0x3c35=function(){return _0x322371;};return a46_0x3c35();}function a46_0xef95(_0x32e1d5,_0x594ba3){_0x32e1d5=_0x32e1d5-0x19b;const _0x3c35d2=a46_0x3c35();let _0xef95b1=_0x3c35d2[_0x32e1d5];return _0xef95b1;}var __importDefault=this&&this['__importDefault']||function(_0x286346){const _0x41014b=a46_0xef95;return _0x286346&&_0x286346[_0x41014b(0x28f)]?_0x286346:{'default':_0x286346};};Object[a46_0x4851f0(0x2ec)](exports,'__esModule',{'value':!![]}),exports[a46_0x4851f0(0x1ae)]=void 0x0;const database_1=__importDefault(require(a46_0x4851f0(0x205))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a46_0x4851f0(0x2f6)),telegramBotService_1=require(a46_0x4851f0(0x25e)),gateway_1=require(a46_0x4851f0(0x25b));class AdminService{async[a46_0x4851f0(0x2e1)](){const _0x48c71f=a46_0x4851f0;console[_0x48c71f(0x2cd)]('ðŸ“Š\x20Calculating\x20payout\x20statistics...');const _0xd625d6=await database_1[_0x48c71f(0x1e4)][_0x48c71f(0x275)][_0x48c71f(0x261)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0xa638cd=await database_1[_0x48c71f(0x1e4)][_0x48c71f(0x1e2)][_0x48c71f(0x1bb)]({'where':{'status':_0x48c71f(0x232),'gateway':{'not':_0x48c71f(0x256)}}}),_0x3ea5b1=new Date(),_0x3ff7c1=new Date(_0x3ea5b1['getFullYear'](),_0x3ea5b1['getMonth'](),0x1),_0x117bf6=new Date(_0x3ea5b1[_0x48c71f(0x1b2)](),_0x3ea5b1[_0x48c71f(0x269)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2213d0=await database_1[_0x48c71f(0x1e4)]['payout'][_0x48c71f(0x261)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3ff7c1,'lte':_0x117bf6},'status':_0x48c71f(0x266)}}),_0x10a5e9=_0xd625d6[_0x48c71f(0x2de)]['totalPaidOut']||0x0,_0x217c55=_0xd625d6['_sum']['balance']||0x0,_0x20f01e=_0x2213d0['_sum'][_0x48c71f(0x2dd)]||0x0,_0xbdf456={'totalPayout':Math[_0x48c71f(0x259)](_0x10a5e9*0x64)/0x64,'awaitingPayout':Math[_0x48c71f(0x259)](_0x217c55*0x64)/0x64,'thisMonth':Math[_0x48c71f(0x259)](_0x20f01e*0x64)/0x64,'availableBalance':Math[_0x48c71f(0x259)](_0x217c55*0x64)/0x64,'totalPayments':_0xa638cd};return console[_0x48c71f(0x2cd)](_0x48c71f(0x255)),console[_0x48c71f(0x2cd)](_0x48c71f(0x20b)+_0xbdf456[_0x48c71f(0x22d)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x48c71f(0x2cd)](_0x48c71f(0x2be)+_0xbdf456[_0x48c71f(0x1e6)]+_0x48c71f(0x1f6)),console[_0x48c71f(0x2cd)]('\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20'+_0xbdf456[_0x48c71f(0x264)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x48c71f(0x209)+_0xbdf456[_0x48c71f(0x210)]+'\x20USDT'),console['log'](_0x48c71f(0x281)+_0xbdf456[_0x48c71f(0x2ae)]+'\x20PAID\x20payments'),_0xbdf456;}async[a46_0x4851f0(0x242)](_0x6278b0,_0x3ed456){const _0x3782d8=a46_0x4851f0;console['log'](_0x3782d8(0x2c1)+_0x6278b0+':',_0x3ed456);const _0x134bb2=await database_1[_0x3782d8(0x1e4)][_0x3782d8(0x1e2)][_0x3782d8(0x28a)]({'where':{'id':_0x6278b0},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x134bb2)throw new Error(_0x3782d8(0x2e9));const _0x52da6c={};_0x3ed456[_0x3782d8(0x254)]!==undefined&&(_0x52da6c[_0x3782d8(0x254)]=_0x3ed456[_0x3782d8(0x254)]||null);_0x3ed456[_0x3782d8(0x1b5)]!==undefined&&(_0x52da6c['customerIp']=_0x3ed456[_0x3782d8(0x1b5)]||null);_0x3ed456[_0x3782d8(0x202)]!==undefined&&(_0x52da6c[_0x3782d8(0x202)]=_0x3ed456['customerUa']||null);const _0x312226=await database_1['default'][_0x3782d8(0x1e2)][_0x3782d8(0x22b)]({'where':{'id':_0x6278b0},'data':{..._0x52da6c,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3782d8(0x2cd)]('âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x6278b0),console[_0x3782d8(0x2cd)](_0x3782d8(0x240)+_0x134bb2[_0x3782d8(0x254)]+_0x3782d8(0x288)+_0x312226[_0x3782d8(0x254)]),console[_0x3782d8(0x2cd)](_0x3782d8(0x2c3)+_0x134bb2[_0x3782d8(0x1b5)]+_0x3782d8(0x288)+_0x312226[_0x3782d8(0x1b5)]),console['log']('\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20'+(_0x134bb2['customerUa']?_0x3782d8(0x287):_0x3782d8(0x280))+_0x3782d8(0x288)+(_0x312226['customerUa']?_0x3782d8(0x287):_0x3782d8(0x280))),_0x312226;}async['getSystemStatistics'](_0xf70052,_0x58a67d){const _0x44662d=a46_0x4851f0,_0x2020e8=_0x58a67d?new Date(_0x58a67d):new Date();let _0x1f8dfd,_0x1db0ec;if(_0xf70052[_0x44662d(0x1b7)](_0x44662d(0x26a))){const _0x432f74=_0xf70052[_0x44662d(0x1be)](_0x44662d(0x26a),'')[_0x44662d(0x1e0)]('_');if(_0x432f74['length']===0x2){const _0x3182bc=new Date(_0x432f74[0x0]),_0x3c3018=new Date(_0x432f74[0x1]);_0x1f8dfd=new Date(Date[_0x44662d(0x282)](_0x3182bc[_0x44662d(0x1d1)](),_0x3182bc['getUTCMonth'](),_0x3182bc[_0x44662d(0x1aa)](),0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x3c3018[_0x44662d(0x1d1)](),_0x3c3018[_0x44662d(0x1af)](),_0x3c3018[_0x44662d(0x1aa)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4d3386=new Date(Date['UTC'](_0x2020e8['getUTCFullYear'](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8[_0x44662d(0x1aa)]()-0x1e));_0x1f8dfd=new Date(Date['UTC'](_0x4d3386[_0x44662d(0x1d1)](),_0x4d3386['getUTCMonth'](),_0x4d3386['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8[_0x44662d(0x1aa)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0xf70052[_0x44662d(0x243)]()){case'today':_0x1f8dfd=new Date(Date['UTC'](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date['UTC'](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x44662d(0x20a):const _0x5b7353=new Date(_0x2020e8);_0x5b7353[_0x44662d(0x2eb)](_0x5b7353[_0x44662d(0x1aa)]()-0x1),_0x1f8dfd=new Date(Date[_0x44662d(0x282)](_0x5b7353['getUTCFullYear'](),_0x5b7353[_0x44662d(0x1af)](),_0x5b7353['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x5b7353[_0x44662d(0x1d1)](),_0x5b7353['getUTCMonth'](),_0x5b7353[_0x44662d(0x1aa)](),0x17,0x3b,0x3b,0x3e7));break;case _0x44662d(0x229):const _0x3650a1=_0x2020e8['getUTCDay'](),_0x2c0459=_0x3650a1===0x0?-0x6:0x1-_0x3650a1,_0x1798f4=_0x2020e8[_0x44662d(0x1aa)]()+_0x2c0459;_0x1f8dfd=new Date(Date[_0x44662d(0x282)](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),_0x1798f4,0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0x430820=new Date(Date[_0x44662d(0x282)](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8[_0x44662d(0x1aa)]()-0x7)),_0x5f2c02=_0x430820[_0x44662d(0x276)](),_0x1cc349=_0x5f2c02===0x0?-0x6:0x1-_0x5f2c02,_0x14ab2d=_0x430820[_0x44662d(0x1aa)]()+_0x1cc349;_0x1f8dfd=new Date(Date[_0x44662d(0x282)](_0x430820['getUTCFullYear'](),_0x430820[_0x44662d(0x1af)](),_0x14ab2d,0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x430820[_0x44662d(0x1d1)](),_0x430820[_0x44662d(0x1af)](),_0x14ab2d+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x44662d(0x2ee):_0x1f8dfd=new Date(Date['UTC'](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),0x1,0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date['UTC'](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8['getUTCMonth'](),_0x2020e8['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x44662d(0x2c5):_0x1f8dfd=new Date(Date[_0x44662d(0x282)](_0x2020e8['getUTCFullYear'](),_0x2020e8[_0x44662d(0x1af)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x1f8dfd=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x2020e8['getUTCFullYear'](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8[_0x44662d(0x1aa)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x1f8dfd=new Date(_0x2020e8[_0x44662d(0x2da)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x51ed4c=new Date(Date[_0x44662d(0x282)](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8['getUTCMonth'](),_0x2020e8[_0x44662d(0x1aa)]()-0x1e));_0x1f8dfd=new Date(Date[_0x44662d(0x282)](_0x51ed4c['getUTCFullYear'](),_0x51ed4c['getUTCMonth'](),_0x51ed4c['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1db0ec=new Date(Date[_0x44662d(0x282)](_0x2020e8[_0x44662d(0x1d1)](),_0x2020e8[_0x44662d(0x1af)](),_0x2020e8['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}const _0xb69abf={'gte':_0x1f8dfd,'lte':_0x1db0ec};console['log'](_0x44662d(0x1b0)+_0x1f8dfd[_0x44662d(0x206)]()+_0x44662d(0x251)+_0x1db0ec['toISOString']());const [_0x5b55b7,_0x449cbb,_0x1c3c20,_0x204fcd,_0x539959,_0x4d92f2,_0x4a4732,_0x427de7]=await Promise[_0x44662d(0x252)]([database_1[_0x44662d(0x1e4)]['shop'][_0x44662d(0x1bb)](),database_1[_0x44662d(0x1e4)][_0x44662d(0x275)][_0x44662d(0x1bb)]({'where':{'status':_0x44662d(0x2e2)}}),database_1[_0x44662d(0x1e4)][_0x44662d(0x1e2)]['count']({'where':{'status':_0x44662d(0x232),'createdAt':_0xb69abf,'gateway':{'not':_0x44662d(0x256)}}}),database_1[_0x44662d(0x1e4)][_0x44662d(0x1e2)][_0x44662d(0x1bb)]({'where':{'status':_0x44662d(0x1d2),'createdAt':_0xb69abf,'gateway':{'not':_0x44662d(0x256)}}}),database_1[_0x44662d(0x1e4)][_0x44662d(0x1e2)][_0x44662d(0x1bb)]({'where':{'status':_0x44662d(0x1ba),'createdAt':_0xb69abf,'gateway':{'not':'test_gateway'}}}),database_1[_0x44662d(0x1e4)][_0x44662d(0x1e2)][_0x44662d(0x20d)]({'where':{'status':'PAID','createdAt':_0xb69abf,'gateway':{'not':_0x44662d(0x256)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x44662d(0x1e4)][_0x44662d(0x1e2)][_0x44662d(0x20d)]({'where':{'gateway':{'not':_0x44662d(0x256)}},'take':0xa,'orderBy':{'createdAt':_0x44662d(0x211)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x44662d(0x1e4)][_0x44662d(0x1e2)][_0x44662d(0x20d)]({'where':{'createdAt':_0xb69abf,'gateway':{'not':_0x44662d(0x256)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x33122a=0x0,_0xdab998=0x0;for(const _0x4c4800 of _0x4d92f2){const _0x1bb317=_0x4c4800[_0x44662d(0x1cb)]||0x0;_0x33122a+=_0x1bb317;if(_0x4c4800[_0x44662d(0x2fe)]&&_0x4c4800['amountUSDT']){const _0x259951=_0x4c4800['amountUSDT']-_0x4c4800[_0x44662d(0x2fe)];_0xdab998+=_0x259951;}}const _0x2e10d9=_0x1c3c20>0x0?_0x33122a/_0x1c3c20:0x0,_0x26393b=this[_0x44662d(0x1a2)](_0x427de7,_0x1f8dfd,_0x1db0ec),_0x2cc67e=await database_1[_0x44662d(0x1e4)][_0x44662d(0x1e2)]['count']({'where':{'createdAt':_0xb69abf,'gateway':{'not':_0x44662d(0x256)},'status':{'notIn':['PENDING',_0x44662d(0x2e5)]}}}),_0x44d0c1=_0x2cc67e>0x0?_0x1c3c20/_0x2cc67e*0x64:0x0;return{'totalShops':_0x5b55b7,'activeShops':_0x449cbb,'totalPayments':_0x2cc67e,'successfulPayments':_0x1c3c20,'totalAttempts':_0x2cc67e,'chargebacks':_0x204fcd,'refunds':_0x539959,'totalRevenue':Math['round'](_0x33122a*0x64)/0x64,'trapayEarnings':Math[_0x44662d(0x259)](_0xdab998*0x64)/0x64,'averagePaymentAmount':Math[_0x44662d(0x259)](_0x2e10d9*0x64)/0x64,'conversionRate':Math[_0x44662d(0x259)](_0x44d0c1*0x64)/0x64,'dailyRevenue':_0x26393b[_0x44662d(0x29b)],'dailyPayments':_0x26393b['dailyPayments'],'recentPayments':_0x4a4732[_0x44662d(0x2ad)](_0x32f20f=>({'id':_0x32f20f['id'],'amount':_0x32f20f[_0x44662d(0x2dd)],'currency':_0x32f20f['currency'],'status':_0x32f20f['status'],'gateway':_0x32f20f[_0x44662d(0x2f3)],'shop':_0x32f20f[_0x44662d(0x275)],'createdAt':_0x32f20f[_0x44662d(0x2e8)]}))};}}async['getMerchantStatistics'](_0xac0e16){const _0x4fb2bf=a46_0x4851f0;console['log']('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0xac0e16);let _0x1298b3,_0x14b14a=new Date();if(_0xac0e16[_0x4fb2bf(0x1a3)]===_0x4fb2bf(0x2ba)&&_0xac0e16[_0x4fb2bf(0x26b)]&&_0xac0e16[_0x4fb2bf(0x27b)])_0x1298b3=new Date(_0xac0e16['dateFrom']),_0x14b14a=new Date(_0xac0e16['dateTo']),_0x1298b3[_0x4fb2bf(0x2e6)](0x0,0x0,0x0,0x0),_0x14b14a[_0x4fb2bf(0x2e6)](0x17,0x3b,0x3b,0x3e7);else{const _0x55ddff=new Date();switch(_0xac0e16['period']){case'week':_0x1298b3=new Date(_0x55ddff[_0x4fb2bf(0x2da)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4fb2bf(0x1f2):_0x1298b3=new Date(_0x55ddff[_0x4fb2bf(0x2da)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4fb2bf(0x249):_0x1298b3=new Date(_0x55ddff[_0x4fb2bf(0x2da)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4fb2bf(0x252):default:_0x1298b3=new Date(_0x4fb2bf(0x217));break;}_0x1298b3[_0x4fb2bf(0x2e6)](0x0,0x0,0x0,0x0),_0x14b14a[_0x4fb2bf(0x2e6)](0x17,0x3b,0x3b,0x3e7);}console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x1d4)+_0x1298b3[_0x4fb2bf(0x206)]()+_0x4fb2bf(0x251)+_0x14b14a['toISOString']());const _0x4123b6={'status':_0x4fb2bf(0x232),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x1298b3,'lte':_0x14b14a}};_0xac0e16[_0x4fb2bf(0x222)]&&(_0x4123b6[_0x4fb2bf(0x222)]=_0xac0e16['shopId']);const _0x5b9be4=await database_1[_0x4fb2bf(0x1e4)][_0x4fb2bf(0x1e2)]['findMany']({'where':_0x4123b6,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4fb2bf(0x2cd)]('ðŸ’°\x20Found\x20'+_0x5b9be4[_0x4fb2bf(0x22e)]+_0x4fb2bf(0x1a5));const _0x388307={'gateway':{'not':_0x4fb2bf(0x256)},'status':{'notIn':['PENDING',_0x4fb2bf(0x2e5)]},'createdAt':{'gte':_0x1298b3,'lte':_0x14b14a}};_0xac0e16[_0x4fb2bf(0x222)]&&(_0x388307[_0x4fb2bf(0x222)]=_0xac0e16[_0x4fb2bf(0x222)]);const _0x514174=await database_1[_0x4fb2bf(0x1e4)][_0x4fb2bf(0x1e2)]['count']({'where':_0x388307}),_0x526d1a={..._0x388307,'status':_0x4fb2bf(0x1d2)},_0x5963c3={..._0x388307,'status':_0x4fb2bf(0x1ba)},[_0x14ab86,_0x47cf31]=await Promise['all']([database_1[_0x4fb2bf(0x1e4)][_0x4fb2bf(0x1e2)]['count']({'where':_0x526d1a}),database_1[_0x4fb2bf(0x1e4)][_0x4fb2bf(0x1e2)]['count']({'where':_0x5963c3})]);console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x22a)+_0x514174+_0x4fb2bf(0x1e9)+_0x5b9be4[_0x4fb2bf(0x22e)]+',\x20chargebacks:\x20'+_0x14ab86+_0x4fb2bf(0x2cf)+_0x47cf31);let _0xb252d4=0x0,_0x34ab0a=0x0,_0x3ee48a=0x0;const _0x397e12={},_0x167e20={},_0x1c795b={};for(const _0x1f3bb4 of _0x5b9be4){try{const _0x117f57=_0x1f3bb4[_0x4fb2bf(0x1cb)]||0x0;if(_0x117f57<=0x0){console[_0x4fb2bf(0x22f)](_0x4fb2bf(0x1db)+_0x1f3bb4['id']+_0x4fb2bf(0x2f1));continue;}let _0x3785c9,_0x1911ed;if(_0x1f3bb4[_0x4fb2bf(0x2fe)]!==null&&_0x1f3bb4[_0x4fb2bf(0x2fe)]!==undefined)_0x3785c9=_0x1f3bb4['amountAfterGatewayCommissionUSDT'],_0x1911ed=_0x117f57-_0x3785c9,console['log'](_0x4fb2bf(0x2ab)+_0x1f3bb4['id']+':\x20'+_0x117f57[_0x4fb2bf(0x201)](0x6)+_0x4fb2bf(0x2b7)+_0x3785c9['toFixed'](0x6)+_0x4fb2bf(0x212));else{let _0x54126d={};if(_0x1f3bb4['shop'][_0x4fb2bf(0x241)])try{_0x54126d=JSON[_0x4fb2bf(0x1a7)](_0x1f3bb4[_0x4fb2bf(0x275)][_0x4fb2bf(0x241)]);}catch(_0x5697a7){console[_0x4fb2bf(0x208)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1f3bb4[_0x4fb2bf(0x222)]+':',_0x5697a7);}let _0x3450d6=0x2d;for(const [_0x4573b6,_0x3f78d8]of Object[_0x4fb2bf(0x1df)](_0x54126d)){if(_0x4573b6[_0x4fb2bf(0x243)]()===_0x1f3bb4[_0x4fb2bf(0x2f3)][_0x4fb2bf(0x243)]()){_0x3450d6=_0x3f78d8[_0x4fb2bf(0x1ff)]||0x2d;break;}}_0x1911ed=_0x117f57*(_0x3450d6/0x64),_0x3785c9=_0x117f57-_0x1911ed,console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x1c7)+_0x1f3bb4['id']+':\x20'+_0x3450d6+'%\x20from\x20'+_0x117f57['toFixed'](0x6)+_0x4fb2bf(0x212));}_0xb252d4+=_0x117f57,_0x34ab0a+=_0x3785c9,_0x3ee48a+=_0x1911ed;let _0x26defe;_0x1f3bb4[_0x4fb2bf(0x1ce)]!==null&&_0x1f3bb4['gatewayCommissionRate']!==undefined?(_0x26defe=_0x1f3bb4['gatewayCommissionRate'],console[_0x4fb2bf(0x2cd)]('ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x1f3bb4['id']+':\x20'+_0x26defe+'%')):(_0x26defe=_0x117f57>0x0?_0x1911ed/_0x117f57*0x64:0x0,console['log'](_0x4fb2bf(0x216)+_0x1f3bb4['id']+':\x20'+_0x26defe['toFixed'](0x2)+'%'));!_0x397e12[_0x1f3bb4['gateway']]&&(_0x397e12[_0x1f3bb4[_0x4fb2bf(0x2f3)]]={'gateway':_0x1f3bb4[_0x4fb2bf(0x2f3)],'gatewayDisplayName':this[_0x4fb2bf(0x299)](_0x1f3bb4[_0x4fb2bf(0x2f3)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x397e12[_0x1f3bb4[_0x4fb2bf(0x2f3)]][_0x4fb2bf(0x306)]++,_0x397e12[_0x1f3bb4[_0x4fb2bf(0x2f3)]][_0x4fb2bf(0x29e)]+=_0x117f57,_0x397e12[_0x1f3bb4[_0x4fb2bf(0x2f3)]][_0x4fb2bf(0x20c)]+=_0x1911ed,_0x397e12[_0x1f3bb4['gateway']]['merchantEarningsUSDT']+=_0x3785c9,_0x397e12[_0x1f3bb4['gateway']][_0x4fb2bf(0x1ab)]+=_0x26defe;!_0xac0e16[_0x4fb2bf(0x222)]&&(!_0x167e20[_0x1f3bb4['shopId']]&&(_0x167e20[_0x1f3bb4[_0x4fb2bf(0x222)]]={'shopId':_0x1f3bb4[_0x4fb2bf(0x222)],'shopName':_0x1f3bb4[_0x4fb2bf(0x275)]['name'],'shopUsername':_0x1f3bb4[_0x4fb2bf(0x275)][_0x4fb2bf(0x220)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x167e20[_0x1f3bb4['shopId']][_0x4fb2bf(0x306)]++,_0x167e20[_0x1f3bb4[_0x4fb2bf(0x222)]][_0x4fb2bf(0x29e)]+=_0x117f57,_0x167e20[_0x1f3bb4['shopId']][_0x4fb2bf(0x20c)]+=_0x1911ed,_0x167e20[_0x1f3bb4[_0x4fb2bf(0x222)]][_0x4fb2bf(0x2b6)]+=_0x3785c9);const _0x44ebce=_0x1f3bb4[_0x4fb2bf(0x289)][_0x4fb2bf(0x206)]()[_0x4fb2bf(0x1e0)]('T')[0x0];!_0x1c795b[_0x44ebce]&&(_0x1c795b[_0x44ebce]={'date':_0x44ebce,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1c795b[_0x44ebce][_0x4fb2bf(0x2a1)]+=_0x117f57,_0x1c795b[_0x44ebce][_0x4fb2bf(0x1ea)]+=_0x3785c9,_0x1c795b[_0x44ebce][_0x4fb2bf(0x2bc)]+=_0x1911ed,_0x1c795b[_0x44ebce][_0x4fb2bf(0x306)]++;}catch(_0x15ccc9){console[_0x4fb2bf(0x208)](_0x4fb2bf(0x1c5)+_0x1f3bb4['id']+':',_0x15ccc9);}}Object['values'](_0x397e12)['forEach'](_0x595177=>{const _0x5b22a4=_0x4fb2bf;_0x595177[_0x5b22a4(0x23b)]=_0x595177[_0x5b22a4(0x306)]>0x0?_0x595177['totalCommissionRate']/_0x595177['paymentsCount']:0x0,delete _0x595177[_0x5b22a4(0x1ab)];}),Object[_0x4fb2bf(0x1d0)](_0x167e20)[_0x4fb2bf(0x238)](_0x1650eb=>{const _0x561c6e=_0x4fb2bf;_0x1650eb['averageCheckUSDT']=_0x1650eb[_0x561c6e(0x306)]>0x0?_0x1650eb[_0x561c6e(0x29e)]/_0x1650eb['paymentsCount']:0x0;});let _0x40820a=0x0,_0x577754=0x0;if(_0xac0e16[_0x4fb2bf(0x222)]){const _0x47bfbb=await database_1[_0x4fb2bf(0x1e4)]['payout'][_0x4fb2bf(0x20d)]({'where':{'shopId':_0xac0e16['shopId'],'status':_0x4fb2bf(0x266),'createdAt':{'gte':_0x1298b3,'lte':_0x14b14a}},'select':{'amount':!![]}});_0x40820a=_0x47bfbb[_0x4fb2bf(0x2b4)]((_0x8d56f9,_0x52e478)=>_0x8d56f9+_0x52e478[_0x4fb2bf(0x2dd)],0x0);const _0x4b872a=await database_1['default'][_0x4fb2bf(0x22c)][_0x4fb2bf(0x20d)]({'where':{'shopId':_0xac0e16['shopId'],'status':_0x4fb2bf(0x230),'createdAt':{'gte':_0x1298b3,'lte':_0x14b14a}},'select':{'amount':!![]}});_0x577754=_0x4b872a['reduce']((_0x1413bf,_0x10c4e6)=>_0x1413bf+_0x10c4e6['amount'],0x0);}const _0x51d064=_0x514174,_0x24bf8f=_0x5b9be4['length'],_0x918632=_0x24bf8f>0x0?_0xb252d4/_0x24bf8f:0x0,_0x4fd93b=_0x51d064>0x0?Math[_0x4fb2bf(0x259)](_0x24bf8f/_0x51d064*0x2710)/0x64:0x0,_0x2860bb=Math[_0x4fb2bf(0x21a)]((_0x14b14a[_0x4fb2bf(0x2da)]()-_0x1298b3['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x2c26fd={'totalTurnover':Math['round'](_0xb252d4*0x64)/0x64,'merchantEarnings':Math[_0x4fb2bf(0x259)](_0x34ab0a*0x64)/0x64,'gatewayEarnings':Math[_0x4fb2bf(0x259)](_0x3ee48a*0x64)/0x64,'totalPaidOut':Math[_0x4fb2bf(0x259)](_0x40820a*0x64)/0x64,'pendingPayout':Math[_0x4fb2bf(0x259)](_0x577754*0x64)/0x64,'averageCheck':Math[_0x4fb2bf(0x259)](_0x918632*0x64)/0x64,'totalPayments':_0x51d064,'successfulPayments':_0x24bf8f,'conversionRate':_0x4fd93b,'chargebacks':_0x14ab86,'refunds':_0x47cf31,'gatewayBreakdown':Object[_0x4fb2bf(0x1d0)](_0x397e12)[_0x4fb2bf(0x2ad)](_0xa7c3f9=>({..._0xa7c3f9,'turnoverUSDT':Math[_0x4fb2bf(0x259)](_0xa7c3f9[_0x4fb2bf(0x29e)]*0x64)/0x64,'commissionUSDT':Math[_0x4fb2bf(0x259)](_0xa7c3f9[_0x4fb2bf(0x20c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4fb2bf(0x259)](_0xa7c3f9[_0x4fb2bf(0x2b6)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0xa7c3f9[_0x4fb2bf(0x23b)]*0x64)/0x64})),'merchantBreakdown':_0xac0e16[_0x4fb2bf(0x222)]?undefined:Object[_0x4fb2bf(0x1d0)](_0x167e20)['map'](_0x40f0b3=>({..._0x40f0b3,'turnoverUSDT':Math[_0x4fb2bf(0x259)](_0x40f0b3[_0x4fb2bf(0x29e)]*0x64)/0x64,'commissionUSDT':Math[_0x4fb2bf(0x259)](_0x40f0b3['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4fb2bf(0x259)](_0x40f0b3['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x40f0b3[_0x4fb2bf(0x2a4)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x40f0b3[_0x4fb2bf(0x250)]*0x64)/0x64})),'dailyData':Object[_0x4fb2bf(0x1d0)](_0x1c795b)['map'](_0x14a16a=>({..._0x14a16a,'turnover':Math[_0x4fb2bf(0x259)](_0x14a16a[_0x4fb2bf(0x2a1)]*0x64)/0x64,'merchantEarnings':Math[_0x4fb2bf(0x259)](_0x14a16a[_0x4fb2bf(0x1ea)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x14a16a[_0x4fb2bf(0x2bc)]*0x64)/0x64}))['sort']((_0x65ea80,_0x584041)=>_0x65ea80[_0x4fb2bf(0x284)]['localeCompare'](_0x584041[_0x4fb2bf(0x284)])),'periodInfo':{'from':_0x1298b3,'to':_0x14b14a,'periodType':_0xac0e16[_0x4fb2bf(0x1a3)]||_0x4fb2bf(0x2ba),'daysCount':_0x2860bb}};return console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x233)),console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x218)+_0x2c26fd[_0x4fb2bf(0x1dc)]+'\x20USDT'),console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x223)+_0x2c26fd['merchantEarnings']+_0x4fb2bf(0x212)),console['log']('\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20'+_0x2c26fd[_0x4fb2bf(0x2bc)]+_0x4fb2bf(0x212)),console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x2bd)+_0x2c26fd[_0x4fb2bf(0x1f7)]+'\x20USDT'),console[_0x4fb2bf(0x2cd)](_0x4fb2bf(0x1fa)+_0x2c26fd[_0x4fb2bf(0x2ce)]+'\x20USDT'),console[_0x4fb2bf(0x2cd)]('\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20'+_0x2c26fd[_0x4fb2bf(0x2ae)]),_0x2c26fd;}async[a46_0x4851f0(0x292)](_0x14f20b){const _0x19a818=a46_0x4851f0;console['log'](_0x19a818(0x1a1),{'hasPayoutHistory':_0x14f20b});let _0xb320fe={};_0x14f20b&&(_0xb320fe['payouts']={'some':{}});const _0xea91cc=await database_1['default'][_0x19a818(0x275)][_0x19a818(0x20d)]({'where':_0xb320fe,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x19a818(0x228)}});return console['log'](_0x19a818(0x234)+_0xea91cc[_0x19a818(0x22e)]+_0x19a818(0x1fb)+(_0x14f20b?_0x19a818(0x1d3):'')),_0xea91cc[_0x19a818(0x2ad)](_0x203393=>({'id':_0x203393['id'],'username':_0x203393[_0x19a818(0x220)],'name':_0x203393[_0x19a818(0x231)]}));}[a46_0x4851f0(0x299)](_0x19ad9f){const _0x40f25b=a46_0x4851f0,_0x5ba2f3={'test_gateway':_0x40f25b(0x2ac),'plisio':_0x40f25b(0x1b9),'rapyd':_0x40f25b(0x257),'noda':_0x40f25b(0x1e1),'cointopay':_0x40f25b(0x1a4),'cointopay2':_0x40f25b(0x286),'klyme_eu':_0x40f25b(0x302),'klyme_gb':_0x40f25b(0x1a6),'klyme_de':_0x40f25b(0x1ee),'mastercard':_0x40f25b(0x226)};return _0x5ba2f3[_0x19ad9f]||_0x19ad9f;}[a46_0x4851f0(0x24f)](_0x180c7f){const _0x1eb7fd=a46_0x4851f0,_0x181b15={'Test\x20Gateway':_0x1eb7fd(0x256),'Plisio':_0x1eb7fd(0x1c0),'Rapyd':_0x1eb7fd(0x2fd),'Noda':_0x1eb7fd(0x268),'CoinToPay':_0x1eb7fd(0x224),'CoinToPay2':_0x1eb7fd(0x25d),'KLYME\x20EU':_0x1eb7fd(0x296),'KLYME\x20GB':_0x1eb7fd(0x1f0),'KLYME\x20DE':_0x1eb7fd(0x2fa),'MasterCard':_0x1eb7fd(0x1fe)};return _0x181b15[_0x180c7f]||_0x180c7f[_0x1eb7fd(0x243)]();}async['getMerchantsAwaitingPayout'](_0x109bf8){const _0xeac766=a46_0x4851f0,{page:_0x42281a,limit:_0x27b02e,minAmount:_0x3839ba,search:_0x55beb6}=_0x109bf8;console[_0xeac766(0x2cd)](_0xeac766(0x26d),_0x109bf8);let _0x566dd2={};_0x55beb6&&(_0x566dd2['name']={'contains':_0x55beb6,'mode':_0xeac766(0x279)});const _0x414eac=await database_1['default'][_0xeac766(0x275)][_0xeac766(0x20d)]({'where':_0x566dd2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x161850=_0x414eac[_0xeac766(0x304)](_0x3ce537=>{const _0x51174f=_0xeac766,_0x1df221=Math[_0x51174f(0x247)](_0x3ce537['balance']*0x64)/0x64;if(_0x3839ba&&_0x1df221<_0x3839ba)return![];return _0x1df221!==0x0;});_0x161850['sort']((_0x5e32d2,_0x39af64)=>_0x39af64[_0xeac766(0x221)]-_0x5e32d2[_0xeac766(0x221)]);const _0x38e855=_0x161850[_0xeac766(0x22e)],_0x54cfb8=(_0x42281a-0x1)*_0x27b02e,_0x521f37=_0x161850[_0xeac766(0x24e)](_0x54cfb8,_0x54cfb8+_0x27b02e);console[_0xeac766(0x2cd)](_0xeac766(0x1fd)+_0x521f37[_0xeac766(0x22e)]+_0xeac766(0x1f3));const _0x46504a=await Promise[_0xeac766(0x252)](_0x521f37[_0xeac766(0x2ad)](async _0x508d7d=>{const _0x278b54=_0xeac766,[_0x4f2590,_0x1c8024,_0x71beb8]=await Promise['all']([database_1[_0x278b54(0x1e4)]['payment'][_0x278b54(0x1bb)]({'where':{'shopId':_0x508d7d['id'],'status':'PAID','gateway':{'not':'test_gateway'}}}),database_1[_0x278b54(0x1e4)][_0x278b54(0x1e2)][_0x278b54(0x1de)]({'where':{'shopId':_0x508d7d['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default'][_0x278b54(0x1e2)][_0x278b54(0x1b4)]({'by':[_0x278b54(0x2f3)],'where':{'shopId':_0x508d7d['id'],'status':_0x278b54(0x232),'gateway':{'not':_0x278b54(0x256)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4d26ce=new Date(),_0x2edecc=new Date(_0x4d26ce[_0x278b54(0x1b2)](),_0x4d26ce[_0x278b54(0x269)](),0x1),_0x19be75=new Date(_0x4d26ce[_0x278b54(0x1b2)](),_0x4d26ce['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2c1b7c,_0x3e5446]=await Promise['all']([database_1[_0x278b54(0x1e4)]['payout'][_0x278b54(0x261)]({'_sum':{'amount':!![]},'where':{'shopId':_0x508d7d['id'],'status':_0x278b54(0x266)}}),database_1['default'][_0x278b54(0x22c)][_0x278b54(0x261)]({'_sum':{'amount':!![]},'where':{'shopId':_0x508d7d['id'],'status':_0x278b54(0x266),'createdAt':{'gte':_0x2edecc,'lte':_0x19be75}}})]),_0x4b01fa=_0x2c1b7c[_0x278b54(0x2de)][_0x278b54(0x2dd)]||0x0,_0x359c92=_0x3e5446[_0x278b54(0x2de)][_0x278b54(0x2dd)]||0x0,_0x5ca2b8=await Promise[_0x278b54(0x252)](_0x71beb8['map'](async _0x220c19=>{const _0x4306de=_0x278b54;let _0x80b41=0x2d;if(_0x508d7d[_0x4306de(0x241)])try{const _0x1b0f45=JSON[_0x4306de(0x1a7)](_0x508d7d[_0x4306de(0x241)]);for(const [_0x4e082f,_0x44d093]of Object[_0x4306de(0x1df)](_0x1b0f45)){if(_0x4e082f['toLowerCase']()===_0x220c19[_0x4306de(0x2f3)]['toLowerCase']()){_0x80b41=_0x44d093[_0x4306de(0x1ff)]||0xa,console['log']('ðŸ’°\x20[PAYOUT]\x20Gateway\x20'+_0x220c19[_0x4306de(0x2f3)]+_0x4306de(0x2e0)+_0x508d7d['id']+_0x4306de(0x244)+_0x80b41+'%');break;}}}catch(_0x55ab0f){console[_0x4306de(0x208)](_0x4306de(0x2f2)+_0x508d7d['id']+':',_0x55ab0f);}const _0x5e0a3c=_0x220c19[_0x4306de(0x2de)]?.[_0x4306de(0x1cb)]||0x0,_0x427583=_0x5e0a3c*(0x1-_0x80b41/0x64);return{'gateway':_0x220c19[_0x4306de(0x2f3)],'count':_0x220c19[_0x4306de(0x1c9)]?.['id']||0x0,'amountUSDT':Math[_0x4306de(0x259)](_0x5e0a3c*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x427583*0x64)/0x64,'commission':_0x80b41};})),_0x5d7f3a=_0x5ca2b8[_0x278b54(0x2b4)]((_0x2ad0c0,_0x3d9e72)=>_0x2ad0c0+_0x3d9e72['amountUSDT'],0x0),_0x30abce=_0x5ca2b8[_0x278b54(0x2b4)]((_0x2aa8ae,_0x587f7f)=>_0x2aa8ae+_0x587f7f['amountAfterCommissionUSDT'],0x0),_0x635c0e=_0x508d7d['balance'];return console[_0x278b54(0x2cd)](_0x278b54(0x28e)+_0x508d7d[_0x278b54(0x220)]+':'),console[_0x278b54(0x2cd)](_0x278b54(0x27c)+_0x5d7f3a[_0x278b54(0x201)](0x2)+_0x278b54(0x274)),console['log'](_0x278b54(0x1d5)+_0x30abce[_0x278b54(0x201)](0x2)+_0x278b54(0x215)),console[_0x278b54(0x2cd)](_0x278b54(0x253)+_0x635c0e[_0x278b54(0x201)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x278b54(0x2cd)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0x4b01fa[_0x278b54(0x201)](0x2)+_0x278b54(0x2a5)),console[_0x278b54(0x2cd)](_0x278b54(0x2cc)+(_0x30abce-_0x4b01fa-_0x635c0e)[_0x278b54(0x201)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x508d7d['id'],'fullName':_0x508d7d[_0x278b54(0x231)],'username':_0x508d7d[_0x278b54(0x220)],'telegramId':_0x508d7d[_0x278b54(0x1cf)],'merchantUrl':_0x508d7d[_0x278b54(0x19e)],'wallets':{'usdtPolygonWallet':_0x508d7d[_0x278b54(0x272)],'usdtTrcWallet':_0x508d7d[_0x278b54(0x1b1)],'usdtErcWallet':_0x508d7d[_0x278b54(0x2c6)],'usdcPolygonWallet':_0x508d7d[_0x278b54(0x293)],'usdcErcWallet':_0x508d7d[_0x278b54(0x1a0)]},'totalAmountUSDT':Math[_0x278b54(0x259)](_0x5d7f3a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x278b54(0x259)](_0x30abce*0x64)/0x64,'currentBalance':Math[_0x278b54(0x247)](_0x635c0e*0x64)/0x64,'totalPayout':Math[_0x278b54(0x259)](_0x4b01fa*0x64)/0x64,'thisMonth':Math[_0x278b54(0x259)](_0x359c92*0x64)/0x64,'paymentsCount':_0x4f2590,'oldestPaymentDate':_0x1c8024?.[_0x278b54(0x289)]||_0x508d7d[_0x278b54(0x2e8)],'gatewayBreakdown':_0x5ca2b8};})),_0x42ac4c=_0x46504a[_0xeac766(0x2b4)]((_0x742f47,_0xc7af73)=>_0x742f47+_0xc7af73['totalAmountUSDT'],0x0),_0x1247ba=_0x46504a[_0xeac766(0x2b4)]((_0x409b0e,_0x214f59)=>_0x409b0e+_0x214f59[_0xeac766(0x2c8)],0x0),_0x2bbcb9=_0x46504a[_0xeac766(0x2b4)]((_0x43cd3c,_0x10c292)=>_0x43cd3c+_0x10c292['totalPayout'],0x0),_0x207a6c=_0x46504a[_0xeac766(0x2b4)]((_0x2ad23b,_0x47e85e)=>_0x2ad23b+_0x47e85e[_0xeac766(0x210)],0x0);return console[_0xeac766(0x2cd)](_0xeac766(0x2aa)+_0x38e855+_0xeac766(0x225)),console[_0xeac766(0x2cd)](_0xeac766(0x1c4)+Math['round'](_0x42ac4c*0x64)/0x64+_0xeac766(0x274)),console['log'](_0xeac766(0x1f1)+Math['round'](_0x1247ba*0x64)/0x64+_0xeac766(0x2c4)),console[_0xeac766(0x2cd)](_0xeac766(0x2f7)+Math[_0xeac766(0x259)](_0x2bbcb9*0x64)/0x64+_0xeac766(0x212)),console[_0xeac766(0x2cd)](_0xeac766(0x2dc)+Math[_0xeac766(0x259)](_0x207a6c*0x64)/0x64+'\x20USDT'),{'merchants':_0x46504a,'pagination':{'page':_0x42281a,'limit':_0x27b02e,'total':_0x38e855,'totalPages':Math[_0xeac766(0x21a)](_0x38e855/_0x27b02e)},'summary':{'totalMerchants':_0x38e855,'totalAmountUSDT':Math[_0xeac766(0x259)](_0x42ac4c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xeac766(0x259)](_0x1247ba*0x64)/0x64,'totalPayout':Math[_0xeac766(0x259)](_0x2bbcb9*0x64)/0x64,'thisMonth':Math[_0xeac766(0x259)](_0x207a6c*0x64)/0x64}};}async[a46_0x4851f0(0x2f8)](_0x68be88){const _0x18a143=a46_0x4851f0,{shopId:_0x474d3f,amount:_0x5d38dd,network:_0x21d2bb,wallet:_0x26cd37,notes:_0x2bce3e,txid:_0x2a9c6a,periodFrom:_0x32d45e,periodTo:_0x1f5b5f}=_0x68be88,_0x1e4e34=await database_1[_0x18a143(0x1e4)]['$transaction'](async _0x41c6f2=>{const _0x2d3538=_0x18a143,_0x5a66ec=await _0x41c6f2[_0x2d3538(0x275)]['findUnique']({'where':{'id':_0x474d3f},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5a66ec)throw new Error(_0x2d3538(0x2ea));console['log']('ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20'+_0x5a66ec['username']+':'),console[_0x2d3538(0x2cd)]('\x20\x20\x20Current\x20balance:\x20'+_0x5a66ec[_0x2d3538(0x221)][_0x2d3538(0x201)](0x6)+_0x2d3538(0x212)),console['log'](_0x2d3538(0x1c1)+_0x5d38dd[_0x2d3538(0x201)](0x6)+_0x2d3538(0x212)),console[_0x2d3538(0x2cd)](_0x2d3538(0x27d)+_0x5a66ec[_0x2d3538(0x1f7)][_0x2d3538(0x201)](0x6)+_0x2d3538(0x212));if(_0x2a9c6a)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x2a9c6a);const _0x1ba875=0.000001,_0x6964ac=Number(_0x5a66ec['balance']),_0x3cffea=Number(_0x5d38dd);console['log'](_0x2d3538(0x298)),console[_0x2d3538(0x2cd)](_0x2d3538(0x1cc)+_0x5a66ec[_0x2d3538(0x221)]),console['log']('\x20\x20\x20Available\x20(number):\x20'+_0x6964ac),console['log']('\x20\x20\x20Requested\x20(number):\x20'+_0x3cffea),console[_0x2d3538(0x2cd)](_0x2d3538(0x273)+(_0x6964ac-_0x3cffea)),console[_0x2d3538(0x2cd)]('\x20\x20\x20Tolerance:\x20'+_0x1ba875);if(_0x6964ac<_0x3cffea-_0x1ba875)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x6964ac['toFixed'](0x6)+'\x20USDT,\x20Requested:\x20'+_0x3cffea[_0x2d3538(0x201)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x6964ac-_0x3cffea)[_0x2d3538(0x201)](0x8)+_0x2d3538(0x212));console[_0x2d3538(0x2cd)](_0x2d3538(0x2b0));const _0x51c438=Math[_0x2d3538(0x294)](_0x6964ac,_0x3cffea);let _0x1ca77c=_0x26cd37;console[_0x2d3538(0x2cd)](_0x2d3538(0x20f)+(_0x26cd37||'not\x20provided'));if(!_0x1ca77c){console[_0x2d3538(0x2cd)](_0x2d3538(0x1ef));const _0x238181=await _0x41c6f2[_0x2d3538(0x275)]['findUnique']({'where':{'id':_0x474d3f},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log']('ðŸ”\x20Shop\x20wallets:',_0x238181);if(_0x238181)switch(_0x21d2bb){case'polygon':_0x1ca77c=_0x238181['usdtPolygonWallet']||undefined,console[_0x2d3538(0x2cd)](_0x2d3538(0x1ca)+_0x1ca77c);break;case _0x2d3538(0x2a0):_0x1ca77c=_0x238181[_0x2d3538(0x1b1)]||undefined,console[_0x2d3538(0x2cd)](_0x2d3538(0x2c2)+_0x1ca77c);break;case _0x2d3538(0x24c):_0x1ca77c=_0x238181[_0x2d3538(0x2c6)]||undefined,console[_0x2d3538(0x2cd)](_0x2d3538(0x278)+_0x1ca77c);break;case _0x2d3538(0x2e7):_0x1ca77c=_0x238181[_0x2d3538(0x293)]||undefined,console[_0x2d3538(0x2cd)](_0x2d3538(0x2bf)+_0x1ca77c);break;case'erc20_usdc':_0x1ca77c=_0x238181[_0x2d3538(0x1a0)]||undefined,console[_0x2d3538(0x2cd)]('ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x1ca77c);break;}}else console[_0x2d3538(0x2cd)]('âœ…\x20Using\x20wallet\x20from\x20request:\x20'+_0x1ca77c);console[_0x2d3538(0x2cd)](_0x2d3538(0x2b2)+_0x21d2bb+':\x20'+(_0x1ca77c||_0x2d3538(0x2d2))),console['log']('ðŸ”\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x474d3f,'amount':_0x51c438,'network':_0x21d2bb,'wallet':_0x1ca77c,'status':'COMPLETED','txid':_0x2a9c6a,'notes':_0x2bce3e,'periodFrom':_0x32d45e?new Date(_0x32d45e):null,'periodTo':_0x1f5b5f?new Date(_0x1f5b5f):null});const _0xa364d3=await _0x41c6f2[_0x2d3538(0x22c)]['create']({'data':{'shopId':_0x474d3f,'amount':_0x51c438,'network':_0x21d2bb,'wallet':_0x1ca77c,'status':_0x2d3538(0x266),'txid':_0x2a9c6a,'notes':_0x2bce3e,'periodFrom':_0x32d45e?new Date(_0x32d45e):null,'periodTo':_0x1f5b5f?new Date(_0x1f5b5f):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x2d3538(0x2cd)](_0x2d3538(0x2d0),{'id':_0xa364d3['id'],'wallet':_0xa364d3[_0x2d3538(0x1e7)],'network':_0xa364d3[_0x2d3538(0x2c7)],'amount':_0xa364d3[_0x2d3538(0x2dd)]});const _0x1bdcaf=_0x6964ac-_0x51c438,_0x5634a5=Number(_0x5a66ec[_0x2d3538(0x1f7)])+_0x51c438;return await _0x41c6f2['shop'][_0x2d3538(0x22b)]({'where':{'id':_0x474d3f},'data':{'balance':_0x1bdcaf,'totalPaidOut':_0x5634a5}}),console[_0x2d3538(0x2cd)]('ðŸ’°\x20Shop\x20'+_0x5a66ec['username']+_0x2d3538(0x2ff)),console[_0x2d3538(0x2cd)](_0x2d3538(0x2bb)+_0x6964ac[_0x2d3538(0x201)](0x6)+_0x2d3538(0x288)+_0x1bdcaf['toFixed'](0x6)+_0x2d3538(0x25a)+_0x51c438[_0x2d3538(0x201)](0x6)+')'),console[_0x2d3538(0x2cd)](_0x2d3538(0x21f)+_0x5a66ec[_0x2d3538(0x1f7)]['toFixed'](0x6)+'\x20->\x20'+_0x5634a5[_0x2d3538(0x201)](0x6)+_0x2d3538(0x2fc)+_0x51c438[_0x2d3538(0x201)](0x6)+')'),console[_0x2d3538(0x2cd)](_0x2d3538(0x28b)+_0x51c438[_0x2d3538(0x201)](0x6)+_0x2d3538(0x212)),{'payout':_0xa364d3,'shop':_0x5a66ec};});console[_0x18a143(0x2cd)](_0x18a143(0x1ed)+_0x1e4e34[_0x18a143(0x22c)]['id']+_0x18a143(0x2e0)+_0x1e4e34[_0x18a143(0x275)][_0x18a143(0x220)]+'\x20('+_0x1e4e34['payout'][_0x18a143(0x2dd)][_0x18a143(0x201)](0x6)+_0x18a143(0x1fc));try{let _0x5177a5=_0x18a143(0x2db);if(_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x203)]&&_0x1e4e34[_0x18a143(0x22c)]['periodTo']){const _0x444a6c=new Date(_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x203)])[_0x18a143(0x21b)](_0x18a143(0x1a8)),_0x50accf=new Date(_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x305)])['toLocaleDateString'](_0x18a143(0x1a8));_0x5177a5=_0x444a6c+_0x18a143(0x19f)+_0x50accf;}await telegramBotService_1[_0x18a143(0x27e)][_0x18a143(0x26c)](_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x222)],{'id':_0x1e4e34[_0x18a143(0x22c)]['id'],'amount':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x2dd)],'network':_0x1e4e34[_0x18a143(0x22c)]['network'],'wallet':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x1e7)],'period':_0x5177a5,'createdAt':_0x1e4e34['payout'][_0x18a143(0x2e8)],'txid':_0x1e4e34[_0x18a143(0x22c)]['txid']}),console[_0x18a143(0x2cd)](_0x18a143(0x29d)+_0x1e4e34[_0x18a143(0x22c)]['id']);}catch(_0x288f63){console[_0x18a143(0x208)](_0x18a143(0x2a9)+_0x1e4e34[_0x18a143(0x22c)]['id']+':',_0x288f63);}return{'id':_0x1e4e34['payout']['id'],'shopId':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x222)],'shopName':_0x1e4e34[_0x18a143(0x275)]['name'],'shopUsername':_0x1e4e34[_0x18a143(0x275)][_0x18a143(0x220)],'amount':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x2dd)],'network':_0x1e4e34['payout'][_0x18a143(0x2c7)],'wallet':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x1e7)],'status':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x265)],'txid':_0x1e4e34['payout'][_0x18a143(0x303)],'notes':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x1d8)],'periodFrom':_0x1e4e34[_0x18a143(0x22c)]['periodFrom'],'periodTo':_0x1e4e34[_0x18a143(0x22c)]['periodTo'],'createdAt':_0x1e4e34[_0x18a143(0x22c)]['createdAt'],'paidAt':_0x1e4e34[_0x18a143(0x22c)][_0x18a143(0x289)]};}async[a46_0x4851f0(0x1c8)](_0x4d78b6){const _0x73227=a46_0x4851f0,{page:_0x4c9041,limit:_0x1f8bdd,shopId:_0x544a31,network:_0x46826b,dateFrom:_0x17d08e,dateTo:_0x1199ab,search:_0x4682a4}=_0x4d78b6,_0x47ff8b=(_0x4c9041-0x1)*_0x1f8bdd,_0x29291a={};_0x544a31&&(_0x29291a[_0x73227(0x222)]=_0x544a31);_0x46826b&&(_0x29291a['network']=_0x46826b);if(_0x17d08e||_0x1199ab){_0x29291a[_0x73227(0x2e8)]={};if(_0x17d08e){const _0x438bf2=new Date(_0x17d08e);_0x438bf2[_0x73227(0x2e6)](0x0,0x0,0x0,0x1),_0x29291a[_0x73227(0x2e8)]['gte']=_0x438bf2,console['log']('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x438bf2['toISOString']());}if(_0x1199ab){const _0x1a5108=new Date(_0x1199ab);_0x1a5108['setHours'](0x17,0x3b,0x3b,0x3e7),_0x29291a[_0x73227(0x2e8)]['lte']=_0x1a5108,console[_0x73227(0x2cd)](_0x73227(0x28c)+_0x1a5108[_0x73227(0x206)]());}}_0x4682a4&&(_0x29291a['OR']=[{'shop':{'name':{'contains':_0x4682a4,'mode':_0x73227(0x279)}}},{'shop':{'username':{'contains':_0x4682a4,'mode':_0x73227(0x279)}}},{'notes':{'contains':_0x4682a4,'mode':_0x73227(0x279)}}]);const [_0x5927d8,_0x6d2f4b]=await Promise[_0x73227(0x252)]([database_1['default']['payout']['findMany']({'where':_0x29291a,'skip':_0x47ff8b,'take':_0x1f8bdd,'orderBy':{'createdAt':_0x73227(0x211)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x73227(0x1e4)][_0x73227(0x22c)][_0x73227(0x1bb)]({'where':_0x29291a})]);return{'payouts':_0x5927d8[_0x73227(0x2ad)](_0x245ba9=>({'id':_0x245ba9['id'],'shopId':_0x245ba9['shopId'],'shopName':_0x245ba9[_0x73227(0x275)][_0x73227(0x231)],'shopUsername':_0x245ba9[_0x73227(0x275)][_0x73227(0x220)],'amount':_0x245ba9[_0x73227(0x2dd)],'network':_0x245ba9[_0x73227(0x2c7)],'wallet':_0x245ba9[_0x73227(0x1e7)],'status':_0x245ba9[_0x73227(0x265)],'txid':_0x245ba9[_0x73227(0x303)],'notes':_0x245ba9[_0x73227(0x1d8)],'periodFrom':_0x245ba9[_0x73227(0x203)],'periodTo':_0x245ba9[_0x73227(0x305)],'createdAt':_0x245ba9[_0x73227(0x2e8)],'paidAt':_0x245ba9[_0x73227(0x289)]})),'pagination':{'page':_0x4c9041,'limit':_0x1f8bdd,'total':_0x6d2f4b,'totalPages':Math[_0x73227(0x21a)](_0x6d2f4b/_0x1f8bdd)}};}async['getPayoutById'](_0x243468){const _0xa02d16=a46_0x4851f0,_0x1ef05a=await database_1[_0xa02d16(0x1e4)]['payout']['findUnique']({'where':{'id':_0x243468},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1ef05a)return null;return{'id':_0x1ef05a['id'],'shopId':_0x1ef05a[_0xa02d16(0x222)],'shopName':_0x1ef05a[_0xa02d16(0x275)]['name'],'shopUsername':_0x1ef05a[_0xa02d16(0x275)]['username'],'amount':_0x1ef05a[_0xa02d16(0x2dd)],'network':_0x1ef05a[_0xa02d16(0x2c7)],'wallet':_0x1ef05a['wallet'],'status':_0x1ef05a['status'],'txid':_0x1ef05a[_0xa02d16(0x303)],'notes':_0x1ef05a[_0xa02d16(0x1d8)],'periodFrom':_0x1ef05a[_0xa02d16(0x203)],'periodTo':_0x1ef05a['periodTo'],'createdAt':_0x1ef05a['createdAt'],'paidAt':_0x1ef05a[_0xa02d16(0x289)]};}async[a46_0x4851f0(0x246)](_0x5e8b88){const _0x34ae9e=a46_0x4851f0;await database_1[_0x34ae9e(0x1e4)][_0x34ae9e(0x22c)][_0x34ae9e(0x2d9)]({'where':{'id':_0x5e8b88}});}async[a46_0x4851f0(0x1b3)](_0x520274){const _0x320420=a46_0x4851f0,{page:_0x424afe,limit:_0x90105e,status:_0xfb09e6,gateway:_0x1f3299,shopId:_0xd42ccb,dateFrom:_0x1ff321,dateTo:_0x25d02c,search:_0x962834,currency:_0x3fa500,sortBy:_0x5d9897,sortOrder:_0x2ff1ae}=_0x520274,_0x2390ed=(_0x424afe-0x1)*_0x90105e;console[_0x320420(0x2cd)](_0x320420(0x2ef),_0x520274);const _0x18edcb=await database_1['default'][_0x320420(0x1e2)]['groupBy']({'by':[_0x320420(0x2f3)],'_count':{'gateway':!![]}});console[_0x320420(0x2cd)]('ðŸ“Š\x20Available\x20gateways\x20in\x20database:',_0x18edcb[_0x320420(0x2ad)](_0x4a250c=>_0x4a250c[_0x320420(0x2f3)]+'\x20('+_0x4a250c[_0x320420(0x1c9)]['gateway']+_0x320420(0x23a)));if(_0x1f3299){const _0x429cf7=_0x18edcb[_0x320420(0x2f4)](_0x1732d2=>_0x1732d2[_0x320420(0x2f3)][_0x320420(0x243)]()===_0x1f3299['toLowerCase']());!_0x429cf7&&_0x1f3299['toLowerCase']()!=='test_gateway'&&console[_0x320420(0x2cd)](_0x320420(0x227)+_0x1f3299+_0x320420(0x267)+_0x18edcb[_0x320420(0x2ad)](_0x296914=>_0x296914[_0x320420(0x2f3)])[_0x320420(0x2fb)](',\x20'));}const _0x324383={};_0xfb09e6&&(_0x324383[_0x320420(0x265)]=_0xfb09e6[_0x320420(0x27a)]());if(!_0x1f3299)_0x324383[_0x320420(0x2f3)]={'not':_0x320420(0x256)};else{if(_0x1f3299&&(_0x1f3299[_0x320420(0x243)]()===_0x320420(0x256)||_0x1f3299===_0x320420(0x200)))_0x324383[_0x320420(0x2f3)]=_0x320420(0x256);else{let _0x2273d5=_0x1f3299;const _0x1a0b1c=(0x0,gateway_1[_0x320420(0x2a7)])(_0x1f3299);if(_0x1a0b1c)_0x2273d5=_0x1a0b1c,console[_0x320420(0x2cd)]('ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27'+_0x1f3299+_0x320420(0x248)+_0x2273d5+'\x27');else{const _0x51db94=(0x0,gateway_1[_0x320420(0x1ac)])(_0x1f3299);if(_0x51db94){const _0x1b61dc=(0x0,gateway_1['getGatewayNameById'])(_0x51db94);_0x1b61dc&&(_0x2273d5=_0x1b61dc,console[_0x320420(0x2cd)](_0x320420(0x21c)+_0x1f3299+_0x320420(0x271)+_0x51db94+_0x320420(0x1dd)+_0x2273d5+'\x27'));}else console['log'](_0x320420(0x262)+_0x1f3299+_0x320420(0x24b));}const _0x601370=await database_1[_0x320420(0x1e4)][_0x320420(0x1e2)][_0x320420(0x1bb)]({'where':{'gateway':_0x2273d5[_0x320420(0x243)]()},'take':0x1});_0x601370===0x0?(console[_0x320420(0x2cd)]('âš ï¸\x20Gateway\x20\x27'+_0x2273d5+_0x320420(0x28d)+_0x1f3299+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x324383[_0x320420(0x2f3)]=_0x320420(0x2b5)):(_0x324383[_0x320420(0x2f3)]=_0x2273d5[_0x320420(0x243)](),console['log'](_0x320420(0x1e3)+_0x2273d5+_0x320420(0x28d)+_0x1f3299+'\x27)'));}}console[_0x320420(0x2cd)](_0x320420(0x20e),_0x324383[_0x320420(0x2f3)]);_0xd42ccb&&(_0x324383['shopId']=_0xd42ccb);_0x3fa500&&(_0x324383[_0x320420(0x2d8)]=_0x3fa500[_0x320420(0x27a)](),console['log'](_0x320420(0x2e3)+_0x3fa500[_0x320420(0x27a)]()));if(_0x1ff321||_0x25d02c){_0x324383[_0x320420(0x2e8)]={};if(_0x1ff321){const _0x251323=new Date(_0x1ff321),_0x526cd7=new Date(Date[_0x320420(0x282)](_0x251323[_0x320420(0x1d1)](),_0x251323[_0x320420(0x1af)](),_0x251323['getUTCDate'](),0x0,0x0,0x0,0x0));_0x324383[_0x320420(0x2e8)][_0x320420(0x2a6)]=_0x526cd7,console[_0x320420(0x2cd)](_0x320420(0x283)+_0x526cd7[_0x320420(0x206)]());}if(_0x25d02c){const _0x30cdb3=new Date(_0x25d02c),_0x542cce=new Date(Date[_0x320420(0x282)](_0x30cdb3['getUTCFullYear'](),_0x30cdb3[_0x320420(0x1af)](),_0x30cdb3[_0x320420(0x1aa)](),0x17,0x3b,0x3b,0x3e7));_0x324383['createdAt'][_0x320420(0x1a9)]=_0x542cce,console[_0x320420(0x2cd)](_0x320420(0x2b1)+_0x542cce['toISOString']());}}_0x962834&&(_0x324383['OR']=[{'id':{'contains':_0x962834,'mode':_0x320420(0x279)}},{'orderId':{'contains':_0x962834,'mode':_0x320420(0x279)}},{'gatewayOrderId':{'contains':_0x962834,'mode':_0x320420(0x279)}},{'customerEmail':{'contains':_0x962834,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x962834,'mode':_0x320420(0x279)}}},{'shop':{'username':{'contains':_0x962834,'mode':_0x320420(0x279)}}}]);console[_0x320420(0x2cd)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x320420(0x21d)](_0x324383,null,0x2));const _0x54c7f1=await database_1[_0x320420(0x1e4)][_0x320420(0x1e2)][_0x320420(0x1bb)]({'where':_0x324383});console[_0x320420(0x2cd)](_0x320420(0x245)+_0x54c7f1);let _0x335e31={'createdAt':'desc'};if(_0x5d9897){const _0x2ea93b=[_0x320420(0x2dd),'createdAt','updatedAt',_0x320420(0x265),'gateway',_0x320420(0x2d8)],_0x51f5d8=[_0x320420(0x228),_0x320420(0x211)];if(_0x2ea93b[_0x320420(0x2e4)](_0x5d9897)){const _0x53a95=_0x51f5d8[_0x320420(0x2e4)](_0x2ff1ae)?_0x2ff1ae:'desc';_0x335e31={[_0x5d9897]:_0x53a95},console[_0x320420(0x2cd)](_0x320420(0x1bc)+_0x5d9897+_0x320420(0x1d7)+_0x53a95+_0x320420(0x2af));}}const [_0x2aad8a,_0x5266e3]=await Promise[_0x320420(0x252)]([database_1[_0x320420(0x1e4)][_0x320420(0x1e2)][_0x320420(0x20d)]({'where':_0x324383,'skip':_0x2390ed,'take':_0x90105e,'orderBy':_0x335e31,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x320420(0x1e4)]['payment'][_0x320420(0x1bb)]({'where':_0x324383})]);return{'payments':_0x2aad8a,'pagination':{'page':_0x424afe,'limit':_0x90105e,'total':_0x5266e3,'totalPages':Math[_0x320420(0x21a)](_0x5266e3/_0x90105e)}};}async[a46_0x4851f0(0x1c3)](_0x3ae25b){const _0x263642=a46_0x4851f0,_0x2c9875=await database_1[_0x263642(0x1e4)][_0x263642(0x1e2)][_0x263642(0x28a)]({'where':{'id':_0x3ae25b},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2c9875)return null;return{'id':_0x2c9875['id'],'shopId':_0x2c9875[_0x263642(0x222)],'gateway':_0x2c9875[_0x263642(0x2f3)],'amount':_0x2c9875[_0x263642(0x2dd)],'currency':_0x2c9875[_0x263642(0x2d8)],'status':_0x2c9875[_0x263642(0x265)],'orderId':_0x2c9875[_0x263642(0x237)],'gatewayOrderId':_0x2c9875[_0x263642(0x2f0)],'customerEmail':_0x2c9875[_0x263642(0x2d3)],'customerName':_0x2c9875['customerName'],'customerCountry':_0x2c9875[_0x263642(0x254)],'customerIp':_0x2c9875[_0x263642(0x1b5)],'customerUa':_0x2c9875[_0x263642(0x202)],'failureMessage':_0x2c9875[_0x263642(0x1bf)],'externalPaymentUrl':_0x2c9875[_0x263642(0x214)],'successUrl':_0x2c9875['successUrl'],'failUrl':_0x2c9875[_0x263642(0x29a)],'pendingUrl':_0x2c9875[_0x263642(0x2d7)],'whiteUrl':_0x2c9875[_0x263642(0x25f)],'createdAt':_0x2c9875[_0x263642(0x2e8)],'updatedAt':_0x2c9875['updatedAt'],'shop':_0x2c9875['shop']};}async['updatePaymentStatus'](_0x47ab7b,_0x4b00a7,_0x41e738,_0x34c8bd){const _0x4b7458=a46_0x4851f0,_0x53f3fa=await database_1[_0x4b7458(0x1e4)]['$transaction'](async _0x5ec0c5=>{const _0x23485b=_0x4b7458,_0x523614=await _0x5ec0c5['payment'][_0x23485b(0x28a)]({'where':{'id':_0x47ab7b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x523614)throw new Error(_0x23485b(0x2e9));const _0x19dac2=_0x523614[_0x23485b(0x265)],_0x2503e3=_0x4b00a7[_0x23485b(0x27a)]();console[_0x23485b(0x2cd)]('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0x47ab7b+_0x23485b(0x2ca)+_0x19dac2+_0x23485b(0x288)+_0x2503e3),console['log'](_0x23485b(0x300)+_0x523614[_0x23485b(0x275)]['balance']+_0x23485b(0x212));const _0x4d0547={'status':_0x2503e3,'updatedAt':new Date(),'statusChangedBy':_0x23485b(0x23f),'statusChangedAt':new Date()};_0x41e738&&(_0x4d0547['adminNotes']=_0x41e738);_0x2503e3===_0x23485b(0x1d2)&&_0x34c8bd&&(_0x4d0547[_0x23485b(0x1da)]=_0x34c8bd);let _0x45e465=0x0,_0x504c1e=_0x523614[_0x23485b(0x275)]['balance'];if(_0x2503e3===_0x23485b(0x232)&&_0x19dac2!=='PAID'){_0x4d0547[_0x23485b(0x289)]=new Date();const _0x4fb8cb=await currencyService_1[_0x23485b(0x26e)][_0x23485b(0x1d9)](_0x523614[_0x23485b(0x2dd)],_0x523614['currency']);_0x4d0547['amountUSDT']=_0x4fb8cb;let _0x4e2e6a=0x2d;const _0x571c28=await _0x5ec0c5[_0x23485b(0x275)][_0x23485b(0x28a)]({'where':{'id':_0x523614[_0x23485b(0x222)]},'select':{'gatewaySettings':!![]}});if(_0x571c28?.['gatewaySettings'])try{const _0x5f3a07=JSON[_0x23485b(0x1a7)](_0x571c28['gatewaySettings']);for(const [_0x587853,_0x147f29]of Object[_0x23485b(0x1df)](_0x5f3a07)){if(_0x587853[_0x23485b(0x243)]()===_0x523614[_0x23485b(0x2f3)][_0x23485b(0x243)]()){_0x4e2e6a=_0x147f29['commission']||0xa;break;}}}catch(_0x5a3865){console[_0x23485b(0x208)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x47ab7b+':',_0x5a3865);}let _0x4e2eba;_0x523614[_0x23485b(0x2fe)]!==null&&_0x523614[_0x23485b(0x2fe)]!==undefined?(_0x4e2eba=_0x523614[_0x23485b(0x2fe)],console['log'](_0x23485b(0x2d5)+_0x4e2eba[_0x23485b(0x201)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x47ab7b)):(_0x4e2eba=_0x4fb8cb*(0x1-_0x4e2e6a/0x64),console[_0x23485b(0x2cd)]('ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x47ab7b+':\x20'+_0x4e2e6a+_0x23485b(0x1bd)+_0x4fb8cb[_0x23485b(0x201)](0x6)+_0x23485b(0x212)),_0x4d0547[_0x23485b(0x2fe)]=_0x4e2eba,_0x4d0547[_0x23485b(0x1ce)]=_0x4e2e6a),_0x45e465=_0x4e2eba,_0x504c1e+=_0x4e2eba,console[_0x23485b(0x2cd)](_0x23485b(0x2df)+_0x47ab7b+'\x20became\x20PAID:'),console[_0x23485b(0x2cd)](_0x23485b(0x258)+_0x4fb8cb[_0x23485b(0x201)](0x6)+_0x23485b(0x212)),console[_0x23485b(0x2cd)](_0x23485b(0x1f8)+_0x523614[_0x23485b(0x2f3)]+_0x23485b(0x27f)+_0x4e2e6a+'%'),console[_0x23485b(0x2cd)](_0x23485b(0x2b9)+_0x4e2eba[_0x23485b(0x201)](0x6)+_0x23485b(0x2c9)+_0x4e2e6a+_0x23485b(0x2b8)),console[_0x23485b(0x2cd)](_0x23485b(0x2a3)+_0x4e2eba[_0x23485b(0x201)](0x6)+_0x23485b(0x212));}else{if(_0x19dac2===_0x23485b(0x232)&&_0x2503e3!==_0x23485b(0x232)&&_0x2503e3!==_0x23485b(0x1d2)){if(_0x523614[_0x23485b(0x1cb)]){let _0x41ebce=0x2d;const _0x4c307f=await _0x5ec0c5[_0x23485b(0x275)][_0x23485b(0x28a)]({'where':{'id':_0x523614['shopId']},'select':{'gatewaySettings':!![]}});if(_0x4c307f?.[_0x23485b(0x241)])try{const _0x194a1b=JSON[_0x23485b(0x1a7)](_0x4c307f[_0x23485b(0x241)]);for(const [_0x32fbae,_0x518515]of Object[_0x23485b(0x1df)](_0x194a1b)){if(_0x32fbae[_0x23485b(0x243)]()===_0x523614[_0x23485b(0x2f3)][_0x23485b(0x243)]()){_0x41ebce=_0x518515[_0x23485b(0x1ff)]||0xa;break;}}}catch(_0x18cf24){console[_0x23485b(0x208)](_0x23485b(0x24a)+_0x47ab7b+':',_0x18cf24);}const _0x433085=_0x523614['amountUSDT']*(0x1-_0x41ebce/0x64);_0x45e465=-_0x433085,_0x504c1e-=_0x433085,console['log'](_0x23485b(0x258)+_0x523614['amountUSDT'][_0x23485b(0x201)](0x6)+_0x23485b(0x212)),console[_0x23485b(0x2cd)]('\x20\x20\x20Gateway:\x20'+_0x523614[_0x23485b(0x2f3)]+_0x23485b(0x27f)+_0x41ebce+'%'),console[_0x23485b(0x2cd)](_0x23485b(0x2a2)+_0x433085[_0x23485b(0x201)](0x6)+_0x23485b(0x2c9)+_0x41ebce+_0x23485b(0x2b8)),console[_0x23485b(0x2cd)](_0x23485b(0x1e8)+_0x433085[_0x23485b(0x201)](0x6)+_0x23485b(0x212));}}}_0x2503e3===_0x23485b(0x1d2)&&(console['log']('ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x34c8bd&&_0x34c8bd>0x0?(_0x45e465=-_0x34c8bd,_0x504c1e-=_0x34c8bd,console['log'](_0x23485b(0x1ad)+_0x34c8bd[_0x23485b(0x201)](0x6)+_0x23485b(0x285)),console[_0x23485b(0x2cd)](_0x23485b(0x1f5))):console[_0x23485b(0x2cd)]('âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x4d0547[_0x23485b(0x1da)]=_0x34c8bd||0x0);_0x2503e3===_0x23485b(0x1ba)&&_0x19dac2===_0x23485b(0x232)&&console[_0x23485b(0x2cd)]('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x54b236=await _0x5ec0c5['payment'][_0x23485b(0x22b)]({'where':{'id':_0x47ab7b},'data':_0x4d0547,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x45e465!==0x0&&(await _0x5ec0c5[_0x23485b(0x275)]['update']({'where':{'id':_0x523614['shopId']},'data':{'balance':_0x504c1e}}),console[_0x23485b(0x2cd)](_0x23485b(0x1f9)+_0x523614[_0x23485b(0x222)]+_0x23485b(0x25c)+_0x523614[_0x23485b(0x275)][_0x23485b(0x221)]['toFixed'](0x6)+_0x23485b(0x288)+_0x504c1e['toFixed'](0x6)+'\x20USDT\x20('+(_0x45e465>0x0?'+':'')+_0x45e465[_0x23485b(0x201)](0x6)+')')),_0x54b236;});return{'id':_0x53f3fa['id'],'shopId':_0x53f3fa[_0x4b7458(0x222)],'gateway':_0x53f3fa[_0x4b7458(0x2f3)],'amount':_0x53f3fa['amount'],'currency':_0x53f3fa['currency'],'status':_0x53f3fa[_0x4b7458(0x265)],'orderId':_0x53f3fa[_0x4b7458(0x237)],'gatewayOrderId':_0x53f3fa[_0x4b7458(0x2f0)],'customerEmail':_0x53f3fa[_0x4b7458(0x2d3)],'customerName':_0x53f3fa['customerName'],'customerCountry':_0x53f3fa[_0x4b7458(0x254)],'customerIp':_0x53f3fa[_0x4b7458(0x1b5)],'customerUa':_0x53f3fa[_0x4b7458(0x202)],'failureMessage':_0x53f3fa[_0x4b7458(0x1bf)],'adminNotes':_0x53f3fa['adminNotes'],'chargebackAmount':_0x53f3fa['chargebackAmount'],'statusChangedBy':_0x53f3fa['statusChangedBy'],'statusChangedAt':_0x53f3fa['statusChangedAt'],'createdAt':_0x53f3fa[_0x4b7458(0x2e8)],'updatedAt':_0x53f3fa[_0x4b7458(0x19b)],'shop':_0x53f3fa['shop']};}async[a46_0x4851f0(0x1e5)](_0x59194f,_0x5a737a){const _0x5c6d19=a46_0x4851f0,_0x57f287=Math[_0x5c6d19(0x236)]()['toString'](0x24)[_0x5c6d19(0x1d6)](0x2,0x9);console[_0x5c6d19(0x2cd)](_0x5c6d19(0x1b6)+_0x57f287+_0x5c6d19(0x213)+_0x59194f);const _0x13c09e={..._0x5a737a};_0x5a737a[_0x5c6d19(0x19d)]&&_0x5a737a[_0x5c6d19(0x19d)]['trim']()!==''?(console['log'](_0x5c6d19(0x2cb)+_0x57f287+']\x20Updating\x20password\x20for\x20user\x20'+_0x59194f),_0x13c09e['password']=await bcryptjs_1[_0x5c6d19(0x1e4)][_0x5c6d19(0x235)](_0x5a737a['password'],0xc)):(console[_0x5c6d19(0x2cd)]('ðŸ”\x20['+_0x57f287+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x13c09e[_0x5c6d19(0x19d)]);_0x5a737a[_0x5c6d19(0x24d)]&&(_0x13c09e['name']=_0x5a737a['fullName'],delete _0x13c09e[_0x5c6d19(0x24d)]);_0x5a737a['telegramId']&&(_0x13c09e[_0x5c6d19(0x1cf)]=_0x5a737a['telegramId'],delete _0x13c09e['telegramId']);_0x5a737a[_0x5c6d19(0x19c)]&&(_0x13c09e[_0x5c6d19(0x19e)]=_0x5a737a[_0x5c6d19(0x19c)],delete _0x13c09e[_0x5c6d19(0x19c)]);if(_0x5a737a[_0x5c6d19(0x297)]){const _0x318938=_0x5a737a['gateways'][_0x5c6d19(0x2ad)](_0x38d6ed=>this['getGatewayInternalName'](_0x38d6ed));console[_0x5c6d19(0x2cd)]('ðŸ”„\x20Gateway\x20mapping:',_0x5a737a[_0x5c6d19(0x297)],'->',_0x318938),_0x13c09e['paymentGateways']=JSON['stringify'](_0x318938),delete _0x13c09e[_0x5c6d19(0x297)];}_0x5a737a[_0x5c6d19(0x241)]&&(console['log'](_0x5c6d19(0x260)+_0x57f287+_0x5c6d19(0x2c0),_0x5a737a['gatewaySettings']),_0x13c09e[_0x5c6d19(0x241)]=JSON[_0x5c6d19(0x21d)](_0x5a737a['gatewaySettings']),console[_0x5c6d19(0x2cd)](_0x5c6d19(0x260)+_0x57f287+_0x5c6d19(0x1c6),_0x13c09e['gatewaySettings']));_0x5a737a[_0x5c6d19(0x23d)]&&(_0x5a737a[_0x5c6d19(0x23d)][_0x5c6d19(0x272)]!==undefined&&(_0x13c09e['usdtPolygonWallet']=_0x5a737a[_0x5c6d19(0x23d)][_0x5c6d19(0x272)]||null),_0x5a737a[_0x5c6d19(0x23d)][_0x5c6d19(0x1b1)]!==undefined&&(_0x13c09e[_0x5c6d19(0x1b1)]=_0x5a737a['wallets'][_0x5c6d19(0x1b1)]||null),_0x5a737a[_0x5c6d19(0x23d)]['usdtErcWallet']!==undefined&&(_0x13c09e[_0x5c6d19(0x2c6)]=_0x5a737a['wallets'][_0x5c6d19(0x2c6)]||null),_0x5a737a[_0x5c6d19(0x23d)][_0x5c6d19(0x293)]!==undefined&&(_0x13c09e[_0x5c6d19(0x293)]=_0x5a737a['wallets'][_0x5c6d19(0x293)]||null),delete _0x13c09e[_0x5c6d19(0x23d)]);const _0x56ad7f=await database_1[_0x5c6d19(0x1e4)][_0x5c6d19(0x275)][_0x5c6d19(0x22b)]({'where':{'id':_0x59194f},'data':_0x13c09e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x5c6d19(0x291)+_0x57f287+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x56ad7f[_0x5c6d19(0x241)]),{'id':_0x56ad7f['id'],'fullName':_0x56ad7f[_0x5c6d19(0x231)],'username':_0x56ad7f['username'],'telegramId':_0x56ad7f[_0x5c6d19(0x1cf)],'merchantUrl':_0x56ad7f[_0x5c6d19(0x19e)],'gateways':_0x56ad7f[_0x5c6d19(0x295)]?JSON['parse'](_0x56ad7f[_0x5c6d19(0x295)]):null,'gatewaySettings':_0x56ad7f[_0x5c6d19(0x241)]?JSON['parse'](_0x56ad7f[_0x5c6d19(0x241)]):null,'publicKey':_0x56ad7f['publicKey'],'wallets':{'usdtPolygonWallet':_0x56ad7f['usdtPolygonWallet'],'usdtTrcWallet':_0x56ad7f[_0x5c6d19(0x1b1)],'usdtErcWallet':_0x56ad7f[_0x5c6d19(0x2c6)],'usdcPolygonWallet':_0x56ad7f[_0x5c6d19(0x293)]},'status':_0x56ad7f[_0x5c6d19(0x265)],'createdAt':_0x56ad7f[_0x5c6d19(0x2e8)]};}async['suspendUser'](_0x5e7e1f){const _0x4ef594=a46_0x4851f0,_0xdb6e26=await database_1[_0x4ef594(0x1e4)][_0x4ef594(0x275)][_0x4ef594(0x22b)]({'where':{'id':_0x5e7e1f},'data':{'status':_0x4ef594(0x290)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xdb6e26['id'],'fullName':_0xdb6e26[_0x4ef594(0x231)],'username':_0xdb6e26[_0x4ef594(0x220)],'telegramId':_0xdb6e26[_0x4ef594(0x1cf)],'merchantUrl':_0xdb6e26[_0x4ef594(0x19e)],'gateways':_0xdb6e26[_0x4ef594(0x295)]?JSON[_0x4ef594(0x1a7)](_0xdb6e26[_0x4ef594(0x295)]):null,'gatewaySettings':_0xdb6e26['gatewaySettings']?JSON[_0x4ef594(0x1a7)](_0xdb6e26['gatewaySettings']):null,'publicKey':_0xdb6e26[_0x4ef594(0x2d4)],'wallets':{'usdtPolygonWallet':_0xdb6e26[_0x4ef594(0x272)],'usdtTrcWallet':_0xdb6e26[_0x4ef594(0x1b1)],'usdtErcWallet':_0xdb6e26[_0x4ef594(0x2c6)],'usdcPolygonWallet':_0xdb6e26[_0x4ef594(0x293)]},'status':_0xdb6e26[_0x4ef594(0x265)],'createdAt':_0xdb6e26[_0x4ef594(0x2e8)]};}async['activateUser'](_0x14aa60){const _0x2eea31=a46_0x4851f0,_0x866006=await database_1[_0x2eea31(0x1e4)][_0x2eea31(0x275)][_0x2eea31(0x22b)]({'where':{'id':_0x14aa60},'data':{'status':_0x2eea31(0x2e2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x866006['id'],'fullName':_0x866006[_0x2eea31(0x231)],'username':_0x866006[_0x2eea31(0x220)],'telegramId':_0x866006[_0x2eea31(0x1cf)],'merchantUrl':_0x866006[_0x2eea31(0x19e)],'gateways':_0x866006[_0x2eea31(0x295)]?JSON[_0x2eea31(0x1a7)](_0x866006[_0x2eea31(0x295)]):null,'gatewaySettings':_0x866006['gatewaySettings']?JSON[_0x2eea31(0x1a7)](_0x866006[_0x2eea31(0x241)]):null,'publicKey':_0x866006[_0x2eea31(0x2d4)],'wallets':{'usdtPolygonWallet':_0x866006['usdtPolygonWallet'],'usdtTrcWallet':_0x866006[_0x2eea31(0x1b1)],'usdtErcWallet':_0x866006[_0x2eea31(0x2c6)],'usdcPolygonWallet':_0x866006[_0x2eea31(0x293)]},'status':_0x866006[_0x2eea31(0x265)],'createdAt':_0x866006['createdAt']};}async[a46_0x4851f0(0x26f)](_0x109820){const _0x58b34d=a46_0x4851f0,{page:_0x2b9358,limit:_0x5d5f0c,status:_0x49e031}=_0x109820,_0x232566=(_0x2b9358-0x1)*_0x5d5f0c,_0x329830={};_0x49e031&&(_0x329830[_0x58b34d(0x265)]=_0x49e031['toUpperCase']());const [_0x6f9554,_0x538dce]=await Promise[_0x58b34d(0x252)]([database_1[_0x58b34d(0x1e4)][_0x58b34d(0x275)][_0x58b34d(0x20d)]({'where':_0x329830,'skip':_0x232566,'take':_0x5d5f0c,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x58b34d(0x1e4)][_0x58b34d(0x275)][_0x58b34d(0x1bb)]({'where':_0x329830})]);return{'users':_0x6f9554['map'](_0x27e483=>{const _0x41f46b=_0x58b34d,_0x32e581=_0x27e483[_0x41f46b(0x295)]?JSON[_0x41f46b(0x1a7)](_0x27e483[_0x41f46b(0x295)]):null,_0x36812a=_0x32e581?_0x32e581[_0x41f46b(0x2ad)](_0x2e99e0=>this[_0x41f46b(0x299)](_0x2e99e0)):null;return{'id':_0x27e483['id'],'fullName':_0x27e483[_0x41f46b(0x231)],'username':_0x27e483[_0x41f46b(0x220)],'telegramId':_0x27e483['telegram'],'merchantUrl':_0x27e483[_0x41f46b(0x19e)],'gateways':_0x36812a,'gatewaySettings':_0x27e483[_0x41f46b(0x241)]?JSON[_0x41f46b(0x1a7)](_0x27e483[_0x41f46b(0x241)]):null,'publicKey':_0x27e483[_0x41f46b(0x2d4)],'wallets':{'usdtPolygonWallet':_0x27e483[_0x41f46b(0x272)],'usdtTrcWallet':_0x27e483[_0x41f46b(0x1b1)],'usdtErcWallet':_0x27e483[_0x41f46b(0x2c6)],'usdcPolygonWallet':_0x27e483[_0x41f46b(0x293)]},'status':_0x27e483[_0x41f46b(0x265)],'createdAt':_0x27e483[_0x41f46b(0x2e8)]};}),'pagination':{'page':_0x2b9358,'limit':_0x5d5f0c,'total':_0x538dce,'totalPages':Math['ceil'](_0x538dce/_0x5d5f0c)}};}async[a46_0x4851f0(0x2f5)](_0x192813){const _0x38ec3e=a46_0x4851f0,_0x4c7e55=await database_1[_0x38ec3e(0x1e4)][_0x38ec3e(0x275)][_0x38ec3e(0x28a)]({'where':{'id':_0x192813},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4c7e55)return null;const _0xcb2d4d=_0x4c7e55[_0x38ec3e(0x295)]?JSON['parse'](_0x4c7e55[_0x38ec3e(0x295)]):null,_0x449636=_0xcb2d4d?_0xcb2d4d[_0x38ec3e(0x2ad)](_0x31996f=>this[_0x38ec3e(0x299)](_0x31996f)):null;return _0xcb2d4d&&_0x449636&&console[_0x38ec3e(0x2cd)](_0x38ec3e(0x2d6),_0xcb2d4d,'->',_0x449636),{'id':_0x4c7e55['id'],'fullName':_0x4c7e55['name'],'username':_0x4c7e55['username'],'telegramId':_0x4c7e55[_0x38ec3e(0x1cf)],'merchantUrl':_0x4c7e55[_0x38ec3e(0x19e)],'gateways':_0x449636,'gatewaySettings':_0x4c7e55[_0x38ec3e(0x241)]?JSON[_0x38ec3e(0x1a7)](_0x4c7e55[_0x38ec3e(0x241)]):null,'publicKey':_0x4c7e55[_0x38ec3e(0x2d4)],'wallets':{'usdtPolygonWallet':_0x4c7e55[_0x38ec3e(0x272)],'usdtTrcWallet':_0x4c7e55['usdtTrcWallet'],'usdtErcWallet':_0x4c7e55[_0x38ec3e(0x2c6)],'usdcPolygonWallet':_0x4c7e55['usdcPolygonWallet']},'status':_0x4c7e55['status'],'createdAt':_0x4c7e55[_0x38ec3e(0x2e8)]};}async['createUser'](_0x2a0d08){const _0x3215f6=a46_0x4851f0,{fullName:_0x18651d,username:_0x3f40c4,password:_0x110be3,telegramId:_0x334c6e,merchantUrl:_0x3082f9,gateways:_0x17fdb6,gatewaySettings:_0x5d8b1e,wallets:_0x3089ce}=_0x2a0d08,_0x4fa7d8=await database_1[_0x3215f6(0x1e4)]['shop']['findUnique']({'where':{'username':_0x3f40c4}});if(_0x4fa7d8)throw new Error('Username\x20already\x20exists');if(_0x334c6e){const _0x5f4691=await database_1['default']['shop'][_0x3215f6(0x28a)]({'where':{'telegram':_0x334c6e}});if(_0x5f4691)throw new Error(_0x3215f6(0x2a8));}const _0x30b44d=await bcryptjs_1[_0x3215f6(0x1e4)]['hash'](_0x110be3,0xc),_0x5d7c5d=_0x3215f6(0x263)+crypto_1[_0x3215f6(0x1e4)][_0x3215f6(0x29c)](0x20)['toString'](_0x3215f6(0x1b8)),_0x437e99=_0x3215f6(0x21e)+crypto_1[_0x3215f6(0x1e4)][_0x3215f6(0x29c)](0x20)[_0x3215f6(0x1cd)](_0x3215f6(0x1b8)),_0x5a1190=_0x17fdb6?_0x17fdb6['map'](_0x57977b=>this[_0x3215f6(0x24f)](_0x57977b)):null;_0x17fdb6&&_0x5a1190&&console[_0x3215f6(0x2cd)]('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0x17fdb6,'->',_0x5a1190);const _0x2fc29c=await database_1[_0x3215f6(0x1e4)][_0x3215f6(0x275)][_0x3215f6(0x301)]({'data':{'name':_0x18651d,'username':_0x3f40c4,'password':_0x30b44d,'telegram':_0x334c6e,'shopUrl':_0x3082f9,'paymentGateways':_0x5a1190?JSON[_0x3215f6(0x21d)](_0x5a1190):null,'gatewaySettings':_0x5d8b1e?JSON['stringify'](_0x5d8b1e):null,'usdtPolygonWallet':_0x3089ce?.[_0x3215f6(0x272)]||null,'usdtTrcWallet':_0x3089ce?.['usdtTrcWallet']||null,'usdtErcWallet':_0x3089ce?.[_0x3215f6(0x2c6)]||null,'usdcPolygonWallet':_0x3089ce?.['usdcPolygonWallet']||null,'publicKey':_0x5d7c5d,'secretKey':_0x437e99,'status':_0x3215f6(0x2e2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2fc29c['id'],'fullName':_0x2fc29c[_0x3215f6(0x231)],'username':_0x2fc29c[_0x3215f6(0x220)],'telegramId':_0x2fc29c['telegram'],'merchantUrl':_0x2fc29c[_0x3215f6(0x19e)],'gateways':_0x2fc29c[_0x3215f6(0x295)]?JSON[_0x3215f6(0x1a7)](_0x2fc29c[_0x3215f6(0x295)]):null,'gatewaySettings':_0x2fc29c[_0x3215f6(0x241)]?JSON[_0x3215f6(0x1a7)](_0x2fc29c['gatewaySettings']):null,'publicKey':_0x2fc29c['publicKey'],'wallets':{'usdtPolygonWallet':_0x2fc29c['usdtPolygonWallet'],'usdtTrcWallet':_0x2fc29c['usdtTrcWallet'],'usdtErcWallet':_0x2fc29c[_0x3215f6(0x2c6)],'usdcPolygonWallet':_0x2fc29c['usdcPolygonWallet']},'status':_0x2fc29c['status'],'createdAt':_0x2fc29c['createdAt']};}async[a46_0x4851f0(0x270)](_0x304537){const _0x46fbb6=a46_0x4851f0;await database_1['default'][_0x46fbb6(0x275)]['delete']({'where':{'id':_0x304537}});}[a46_0x4851f0(0x1a2)](_0x11ad47,_0x43be60,_0x21695f){const _0x4c6594=a46_0x4851f0,_0x5251be=new Map(),_0x51f81e=new Date(_0x43be60);while(_0x51f81e<=_0x21695f){const _0x102728=_0x51f81e[_0x4c6594(0x206)]()[_0x4c6594(0x1e0)]('T')[0x0];_0x5251be[_0x4c6594(0x287)](_0x102728,{'revenue':0x0,'count':0x0}),_0x51f81e[_0x4c6594(0x2d1)](_0x51f81e[_0x4c6594(0x29f)]()+0x1);}for(const _0xd471a5 of _0x11ad47){const _0x1f1094=_0xd471a5['createdAt'][_0x4c6594(0x206)]()[_0x4c6594(0x1e0)]('T')[0x0],_0x348bb7=_0x5251be[_0x4c6594(0x1ec)](_0x1f1094);_0x348bb7&&(_0x348bb7[_0x4c6594(0x1bb)]+=0x1,_0xd471a5[_0x4c6594(0x265)]===_0x4c6594(0x232)&&(_0xd471a5['amountUSDT']?_0x348bb7[_0x4c6594(0x239)]+=_0xd471a5[_0x4c6594(0x1cb)]:console['log'](_0x4c6594(0x1db)+_0xd471a5['id']+_0x4c6594(0x23e))));}const _0x879fc6=[],_0x303a5e=[];for(const [_0x4a8361,_0x3e60d1]of _0x5251be){_0x879fc6[_0x4c6594(0x2ed)]({'date':_0x4a8361,'amount':Math['round'](_0x3e60d1[_0x4c6594(0x239)]*0x64)/0x64}),_0x303a5e[_0x4c6594(0x2ed)]({'date':_0x4a8361,'count':_0x3e60d1['count']});}return{'dailyRevenue':_0x879fc6,'dailyPayments':_0x303a5e};}}exports['AdminService']=AdminService;