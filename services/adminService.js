'use strict';const a35_0xc07cbb=a35_0x1494;(function(_0x1a9b94,_0x5e739e){const _0x2e051e=a35_0x1494,_0x265b9b=_0x1a9b94();while(!![]){try{const _0x3297b3=parseInt(_0x2e051e(0xfd))/0x1*(-parseInt(_0x2e051e(0x19e))/0x2)+parseInt(_0x2e051e(0x146))/0x3+-parseInt(_0x2e051e(0x14c))/0x4*(parseInt(_0x2e051e(0x12d))/0x5)+parseInt(_0x2e051e(0x207))/0x6*(parseInt(_0x2e051e(0x1bd))/0x7)+parseInt(_0x2e051e(0x1c9))/0x8+parseInt(_0x2e051e(0x139))/0x9*(parseInt(_0x2e051e(0x106))/0xa)+-parseInt(_0x2e051e(0x10a))/0xb;if(_0x3297b3===_0x5e739e)break;else _0x265b9b['push'](_0x265b9b['shift']());}catch(_0x26c81e){_0x265b9b['push'](_0x265b9b['shift']());}}}(a35_0x4264,0x8be53));function a35_0x1494(_0x51fc06,_0x3d89df){const _0x426486=a35_0x4264();return a35_0x1494=function(_0x1494aa,_0x28293f){_0x1494aa=_0x1494aa-0xfa;let _0x3c5a9e=_0x426486[_0x1494aa];return _0x3c5a9e;},a35_0x1494(_0x51fc06,_0x3d89df);}function a35_0x4264(){const _0x29df48=['\x20USDT\x20(','toUpperCase','createdAt','localeCompare','insensitive','\x20USDT\x20from\x20balance','periodFrom','toString','fullName','getMonth','1099yTwsHF','gatewaySettings','generateDailyStatistics','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','shop','currencyService','_count','convertToUSDT','\x27\x20->\x20ID\x20\x27','💱\x20Currency\x20filter\x20applied:\x20','wallets','pk_','7486504QmNyhe','⚠️\x20Gateway\x20\x27','trc20','totalPayments','length','usdcPolygonWallet','dateTo','test_gateway','groupBy','\x20payments)',',\x20userId:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20merchants\x20with\x20positive\x20balance','random','usdtTrcWallet','shopUrl','failureMessage','bcryptjs','periodTo',']\x20Updating\x20password\x20for\x20user\x20','not\x20set','🔄\x20Converted\x20gateway\x20name\x20\x27','merchantEarnings','awaitingPayout','🔧\x20[','all','getGatewayDisplayName','noda','2020-01-01','sort','substr','getGatewayIdByName','KLYME\x20EU','🎯\x20[','💰\x20Creating\x20payout\x20for\x20shop\x20','klyme_eu','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','statusChangedBy','hash','orderId','\x27\x20not\x20found.\x20Available\x20gateways:\x20','💰\x20Shop\x20','balance','shopId','gte','\x27\x20(from\x20\x27','💰\x20[PAYOUT]\x20Merchant\x20','Telegram\x20username\x20already\x20exists','period','$transaction','turnoverUSDT','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','getMerchantsSelection','crypto','amountAfterCommissionUSDT','getAllUsers','\x20\x20\x20💵\x20Available\x20balance:\x20','gatewayEarnings','CHARGEBACK','lte','week','deletePayout','18822VLrteO','amountAfterGatewayCommissionUSDT','findUnique','totalPaidOut','amountUSDT','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','update','\x20USDT\x20(-','📅\x20Period:\x20','month','hex','asc','\x20\x20\x20💳\x20Total\x20payments:\x20','aggregate','toLowerCase','⚠️\x20Requested\x20gateway\x20\x27','stringify','📊\x20Available\x20gateways\x20in\x20database:','commissionUSDT','forEach','\x20USDT\x20(after\x20','dateFrom','updateCustomerData','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20\x20\x20Full\x20amount:\x20','totalPayout','deleteUser','COMPLETED','KLYME\x20GB','randomBytes','\x20\x20\x20💰\x20Total\x20turnover:\x20','getGatewayInternalName','round','erc20','Shop\x20not\x20found','join','\x20\x20\x20📅\x20This\x20month:\x20','adminNotes','\x20USDT)','💰\x20Current\x20shop\x20balance:\x20','averageCheckUSDT','values',',\x20Commission:\x20','🔄\x20Admin\x20updating\x20payment\x20','29IdLnZD','split','map','custom','externalPaymentUrl','\x27\x20to\x20name\x20\x27','\x20no\x20longer\x20PAID:','\x27\x20->\x20name\x20\x27','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','128890lXKLKE','paidAt','../types/gateway','payout','852280Hchihb','⚠️\x20Payment\x20','\x20USDT','\x20PAID\x20payments','getPayoutById','\x20USDT\x20(without\x20commission)','getGatewayNameById','network','toISOString','\x20USDT\x20(same\x20as\x20awaiting)','desc','Noda','amount','gateways','getFullYear','txid','klyme_de','gateway','whiteUrl','thisMonth','findMany','totalCommissionRate','%\x20commission)','getTime','set','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','createPayout','updatedAt','\x20\x20\x20Gateway:\x20','password','pendingUrl','ACTIVE','not\x20specified','📊\x20Total\x20payments\x20(including\x20failed):\x20','ceil','12595qbZalx',']\x20Gateway\x20settings\x20JSON\x20string:','telegram',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x20order','\x20status:\x20','telegramId','\x20merchants','KLYME\x20DE','status','\x20for\x20shop\x20','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','333oZFQKh','merchantUrl','🔄\x20Converted\x20gateway\x20ID\x20\x27','Username\x20already\x20exists','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20Merchant\x20gets:\x20','rapyd','💸\x20CHARGEBACK\x20penalty:\x20-','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','NONEXISTENT_GATEWAY_FILTER','\x20USDT\x20(after\x20payouts)','🔄\x20Gateway\x20mapping\x20(create):','getMerchantStatistics','1694379RTvaHQ','revenue','error','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','push','dailyPayments','1364NuiHFL','successUrl','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','PAID','_sum','log','📊\x20Calculating\x20payout\x20statistics...','commission','📊\x20Gateway\x20filter\x20applied:','setDate','\x20USDT\x20for\x20payment\x20','currency','updatePaymentStatus','\x20to\x20','\x20paid\x20payments\x20for\x20analysis','customerUa','delete','💰\x20Found\x20','getMerchantsAwaitingPayout','__esModule','📊\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','merchantEarningsUSDT','failUrl','\x20USDT\x20(gross\x20revenue)','some','publicKey','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','🎯\x20updateUser\x20called\x20with\x20ID:\x20','\x20\x20\x20Transaction\x20hash:\x20','toFixed','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','💰\x20[PAYOUT]\x20Gateway\x20','reduce','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','paymentGateways','totalAmountAfterCommissionUSDT','findFirst','customerIp','getAllPayouts','Error\x20processing\x20payment\x20','turnover','\x20USDT,\x20Requested:\x20','\x20\x20\x20Balance:\x20','0000','💰\x20Payment\x20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','usdtErcWallet','name','getAllPayments','includes',']\x20Gateway\x20settings\x20before\x20saving:','Insufficient\x20balance.\x20Available:\x20','parse','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','statusChangedAt','activateUser','\x20\x20\x20Payout\x20amount:\x20','\x20->\x20','\x20active\x20merchants\x20for\x20selection','plisio','📋\x20Getting\x20merchants\x20selection\x20list...','🔐\x20[','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','AdminService','\x20\x20\x20🌐\x20IP:\x20','📊\x20Getting\x20payments\x20with\x20filters:','✅\x20Payout\x20created:\x20','\x20\x20\x20📊\x20Total\x20payments:\x20','chargebackAmount','customerName','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','notes','\x20USDT\x20(total\x20paid\x20to\x20merchants)','customerCountry','trim','polygon','create','CoinToPay','summary','customerEmail','\x20balance\x20updated:\x20','66244xICPQy',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','sk_','date','\x20became\x20PAID:','dailyRevenue','gatewayOrderId','\x20\x20\x20Current\x20balance:\x20','📊\x20Sorting\x20payments\x20by\x20','getPayoutStats','count','default','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','entries','usdtPolygonWallet','Payment\x20not\x20found','paidOutUSDT','username','payment','paymentsCount','averageCommissionRate'];a35_0x4264=function(){return _0x29df48;};return a35_0x4264();}var __importDefault=this&&this['__importDefault']||function(_0x76be3e){const _0x1992e6=a35_0x1494;return _0x76be3e&&_0x76be3e[_0x1992e6(0x15f)]?_0x76be3e:{'default':_0x76be3e};};Object['defineProperty'](exports,a35_0xc07cbb(0x15f),{'value':!![]}),exports[a35_0xc07cbb(0x18c)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0xc07cbb(0x1da))),crypto_1=__importDefault(require(a35_0xc07cbb(0x1fe))),currencyService_1=require('./currencyService'),gateway_1=require(a35_0xc07cbb(0x108));class AdminService{async[a35_0xc07cbb(0x1a7)](){const _0x385f61=a35_0xc07cbb;console[_0x385f61(0x151)](_0x385f61(0x152));const _0x259d12=await database_1[_0x385f61(0x1a9)][_0x385f61(0x1c1)][_0x385f61(0x214)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x2ad108=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x8818b9=await database_1[_0x385f61(0x1a9)][_0x385f61(0x1b0)]['count']({'where':{'status':_0x385f61(0x14f),'gateway':{'not':_0x385f61(0x1d0)}}}),_0x276d3a=new Date(),_0x32031a=new Date(_0x276d3a['getFullYear'](),_0x276d3a['getMonth'](),0x1),_0x42e567=new Date(_0x276d3a[_0x385f61(0x118)](),_0x276d3a[_0x385f61(0x1bc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x46dc34=await database_1[_0x385f61(0x1a9)]['payout'][_0x385f61(0x214)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x32031a,'lte':_0x42e567},'status':_0x385f61(0x222)}}),_0x165ffb=_0x259d12[_0x385f61(0x150)][_0x385f61(0x20a)]||0x0,_0x7c2e1=_0x2ad108[_0x385f61(0x19b)][_0x385f61(0x16f)],_0x386674=_0x46dc34[_0x385f61(0x150)]['amount']||0x0,_0x419eb1={'totalPayout':Math['round'](_0x165ffb*0x64)/0x64,'awaitingPayout':Math[_0x385f61(0x227)](_0x7c2e1*0x64)/0x64,'thisMonth':Math[_0x385f61(0x227)](_0x386674*0x64)/0x64,'availableBalance':Math['round'](_0x7c2e1*0x64)/0x64,'totalPayments':_0x8818b9};return console[_0x385f61(0x151)]('📊\x20Payout\x20statistics\x20calculated:'),console['log']('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x419eb1[_0x385f61(0x220)]+_0x385f61(0x195)),console['log'](_0x385f61(0x1fc)+_0x419eb1[_0x385f61(0x1e0)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x385f61(0x151)](_0x385f61(0x201)+_0x419eb1['availableBalance']+_0x385f61(0x113)),console[_0x385f61(0x151)](_0x385f61(0x22b)+_0x419eb1['thisMonth']+_0x385f61(0x10c)),console[_0x385f61(0x151)](_0x385f61(0x213)+_0x419eb1[_0x385f61(0x1cc)]+_0x385f61(0x10d)),console[_0x385f61(0x151)](_0x385f61(0x181)+(_0x259d12[_0x385f61(0x150)][_0x385f61(0x1f3)]||0x0)[_0x385f61(0x169)](0x2)+_0x385f61(0x10f)),console[_0x385f61(0x151)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x259d12[_0x385f61(0x150)][_0x385f61(0x1f3)]||0x0)-_0x7c2e1)[_0x385f61(0x169)](0x2)+_0x385f61(0x10c)),_0x419eb1;}async[a35_0xc07cbb(0x21d)](_0x22719d,_0x2ba8f6){const _0x2ad5ad=a35_0xc07cbb;console[_0x2ad5ad(0x151)](_0x2ad5ad(0x1ed)+_0x22719d+':',_0x2ba8f6);const _0x452ab2=await database_1[_0x2ad5ad(0x1a9)][_0x2ad5ad(0x1b0)][_0x2ad5ad(0x209)]({'where':{'id':_0x22719d},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x452ab2)throw new Error(_0x2ad5ad(0x1ad));const _0xfb9ed0={};_0x2ba8f6[_0x2ad5ad(0x196)]!==undefined&&(_0xfb9ed0[_0x2ad5ad(0x196)]=_0x2ba8f6[_0x2ad5ad(0x196)]||null);_0x2ba8f6[_0x2ad5ad(0x171)]!==undefined&&(_0xfb9ed0[_0x2ad5ad(0x171)]=_0x2ba8f6['customerIp']||null);_0x2ba8f6[_0x2ad5ad(0x15b)]!==undefined&&(_0xfb9ed0[_0x2ad5ad(0x15b)]=_0x2ba8f6[_0x2ad5ad(0x15b)]||null);const _0x4beae9=await database_1[_0x2ad5ad(0x1a9)]['payment']['update']({'where':{'id':_0x22719d},'data':{..._0xfb9ed0,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x22719d),console[_0x2ad5ad(0x151)]('\x20\x20\x20🌍\x20Country:\x20'+_0x452ab2['customerCountry']+_0x2ad5ad(0x186)+_0x4beae9['customerCountry']),console[_0x2ad5ad(0x151)](_0x2ad5ad(0x18d)+_0x452ab2[_0x2ad5ad(0x171)]+'\x20->\x20'+_0x4beae9[_0x2ad5ad(0x171)]),console['log']('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x452ab2['customerUa']?_0x2ad5ad(0x122):_0x2ad5ad(0x1dd))+_0x2ad5ad(0x186)+(_0x4beae9[_0x2ad5ad(0x15b)]?_0x2ad5ad(0x122):_0x2ad5ad(0x1dd))),_0x4beae9;}async['getSystemStatistics'](_0x2d8f6a){const _0x457396=a35_0xc07cbb,_0x1fda8e=new Date();let _0x2a2ea7;switch(_0x2d8f6a){case'7d':_0x2a2ea7=new Date(_0x1fda8e[_0x457396(0x121)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2a2ea7=new Date(_0x1fda8e[_0x457396(0x121)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x2a2ea7=new Date(_0x1fda8e['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x457396(0x1e2):const _0x186b12=await database_1[_0x457396(0x1a9)][_0x457396(0x1b0)][_0x457396(0x170)]({'where':{'gateway':{'not':_0x457396(0x1d0)}},'orderBy':{'createdAt':_0x457396(0x212)},'select':{'createdAt':!![]}});_0x2a2ea7=_0x186b12?_0x186b12[_0x457396(0x1b5)]:new Date(_0x457396(0x1e5)),console[_0x457396(0x151)](_0x457396(0x20c)+_0x2a2ea7['toISOString']());break;default:_0x2a2ea7=new Date(_0x1fda8e[_0x457396(0x121)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x49a7df,_0x4a575a,_0x6aaa12,_0x531e8f,_0x22e046,_0x30ecc2,_0x10627e]=await Promise[_0x457396(0x1e2)]([database_1[_0x457396(0x1a9)][_0x457396(0x1c1)][_0x457396(0x1a8)](),database_1[_0x457396(0x1a9)][_0x457396(0x1c1)]['count']({'where':{'status':'ACTIVE'}}),database_1[_0x457396(0x1a9)][_0x457396(0x1b0)]['count']({'where':{'createdAt':{'gte':_0x2a2ea7},'gateway':{'not':_0x457396(0x1d0)}}}),database_1[_0x457396(0x1a9)][_0x457396(0x1b0)][_0x457396(0x1a8)]({'where':{'status':'PAID','createdAt':{'gte':_0x2a2ea7},'gateway':{'not':_0x457396(0x1d0)}}}),database_1[_0x457396(0x1a9)][_0x457396(0x1b0)][_0x457396(0x11e)]({'where':{'status':_0x457396(0x14f),'createdAt':{'gte':_0x2a2ea7},'gateway':{'not':_0x457396(0x1d0)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x457396(0x1a9)][_0x457396(0x1b0)][_0x457396(0x11e)]({'where':{'gateway':{'not':_0x457396(0x1d0)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x457396(0x1a9)][_0x457396(0x1b0)]['findMany']({'where':{'createdAt':{'gte':_0x2a2ea7},'gateway':{'not':_0x457396(0x1d0)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x40f075=0x0;for(const _0x5da756 of _0x22e046){const _0xfea9ff=await currencyService_1[_0x457396(0x1c2)][_0x457396(0x1c4)](_0x5da756[_0x457396(0x116)],_0x5da756['currency']);_0x40f075+=_0xfea9ff;}const _0xe0d6df=this['generateDailyStatistics'](_0x10627e,_0x2a2ea7,_0x1fda8e),_0xdcf4d7=_0x6aaa12>0x0?_0x531e8f/_0x6aaa12*0x64:0x0;return{'totalShops':_0x49a7df,'activeShops':_0x4a575a,'totalPayments':_0x6aaa12,'successfulPayments':_0x531e8f,'totalRevenue':Math[_0x457396(0x227)](_0x40f075*0x64)/0x64,'conversionRate':Math[_0x457396(0x227)](_0xdcf4d7*0x64)/0x64,'dailyRevenue':_0xe0d6df[_0x457396(0x1a3)],'dailyPayments':_0xe0d6df[_0x457396(0x14b)],'recentPayments':_0x30ecc2['map'](_0x3d9e37=>({'id':_0x3d9e37['id'],'amount':_0x3d9e37[_0x457396(0x116)],'currency':_0x3d9e37[_0x457396(0x157)],'status':_0x3d9e37[_0x457396(0x136)],'gateway':_0x3d9e37['gateway'],'shop':_0x3d9e37[_0x457396(0x1c1)],'createdAt':_0x3d9e37[_0x457396(0x1b5)]}))};}async[a35_0xc07cbb(0x145)](_0x4c32d3){const _0x186495=a35_0xc07cbb;console[_0x186495(0x151)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x4c32d3);let _0x5d9e06,_0x4ff756=new Date();if(_0x4c32d3[_0x186495(0x1f9)]===_0x186495(0x100)&&_0x4c32d3['dateFrom']&&_0x4c32d3[_0x186495(0x1cf)])_0x5d9e06=new Date(_0x4c32d3[_0x186495(0x21c)]),_0x4ff756=new Date(_0x4c32d3[_0x186495(0x1cf)]);else{const _0x5b61e4=new Date();switch(_0x4c32d3['period']){case _0x186495(0x205):_0x5d9e06=new Date(_0x5b61e4[_0x186495(0x121)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x186495(0x210):_0x5d9e06=new Date(_0x5b61e4[_0x186495(0x121)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x5d9e06=new Date(_0x5b61e4['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x186495(0x1e2):default:_0x5d9e06=new Date(_0x186495(0x1e5));break;}}console['log'](_0x186495(0x20f)+_0x5d9e06[_0x186495(0x112)]()+_0x186495(0x159)+_0x4ff756[_0x186495(0x112)]());const _0x482e7d={'status':'PAID','gateway':{'not':_0x186495(0x1d0)},'paidAt':{'gte':_0x5d9e06,'lte':_0x4ff756}};_0x4c32d3[_0x186495(0x1f4)]&&(_0x482e7d[_0x186495(0x1f4)]=_0x4c32d3['shopId']);const _0x5653a7=await database_1[_0x186495(0x1a9)][_0x186495(0x1b0)][_0x186495(0x11e)]({'where':_0x482e7d,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x186495(0x151)]('💰\x20Found\x20'+_0x5653a7[_0x186495(0x1cd)]+_0x186495(0x15a));const _0x5daf76={'gateway':{'not':_0x186495(0x1d0)},'createdAt':{'gte':_0x5d9e06,'lte':_0x4ff756}};_0x4c32d3['shopId']&&(_0x5daf76[_0x186495(0x1f4)]=_0x4c32d3[_0x186495(0x1f4)]);const _0x430c4f=await database_1[_0x186495(0x1a9)][_0x186495(0x1b0)]['count']({'where':_0x5daf76});console[_0x186495(0x151)](_0x186495(0x12b)+_0x430c4f+',\x20successful:\x20'+_0x5653a7[_0x186495(0x1cd)]);let _0x36b6a8=0x0,_0x5d9fd3=0x0,_0x2a40cf=0x0;const _0x4fb459={},_0x3ad489={},_0x3ae997={};for(const _0x339f5b of _0x5653a7){try{const _0x369e4d=await currencyService_1[_0x186495(0x1c2)][_0x186495(0x1c4)](_0x339f5b[_0x186495(0x116)],_0x339f5b[_0x186495(0x157)]);let _0x2e2394={};if(_0x339f5b['shop'][_0x186495(0x1be)])try{_0x2e2394=JSON['parse'](_0x339f5b[_0x186495(0x1c1)][_0x186495(0x1be)]);}catch(_0x4a364d){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x339f5b[_0x186495(0x1f4)]+':',_0x4a364d);}let _0x47f640={},_0x386842=0xa;for(const [_0x123715,_0x28b8a6]of Object[_0x186495(0x1ab)](_0x2e2394)){if(_0x123715[_0x186495(0x215)]()===_0x339f5b['gateway'][_0x186495(0x215)]()){_0x47f640=_0x28b8a6,_0x386842=_0x28b8a6[_0x186495(0x153)]||0xa;break;}}let _0xdead23,_0x267356;_0x339f5b[_0x186495(0x208)]!==null&&_0x339f5b[_0x186495(0x208)]!==undefined?(_0xdead23=_0x339f5b[_0x186495(0x208)],_0x267356=_0x369e4d-_0xdead23,console[_0x186495(0x151)](_0x186495(0x160)+_0xdead23[_0x186495(0x169)](0x6)+_0x186495(0x156)+_0x339f5b['id'])):(_0x267356=_0x369e4d*(_0x386842/0x64),_0xdead23=_0x369e4d-_0x267356,console[_0x186495(0x151)]('📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x339f5b['id']+':\x20'+_0x386842+'%\x20from\x20'+_0x369e4d[_0x186495(0x169)](0x6)+_0x186495(0x10c)));_0x36b6a8+=_0x369e4d,_0x5d9fd3+=_0xdead23,_0x2a40cf+=_0x267356;!_0x4fb459[_0x339f5b['gateway']]&&(_0x4fb459[_0x339f5b[_0x186495(0x11b)]]={'gateway':_0x339f5b[_0x186495(0x11b)],'gatewayDisplayName':this[_0x186495(0x1e3)](_0x339f5b[_0x186495(0x11b)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4fb459[_0x339f5b[_0x186495(0x11b)]]['paymentsCount']++,_0x4fb459[_0x339f5b[_0x186495(0x11b)]]['turnoverUSDT']+=_0x369e4d,_0x4fb459[_0x339f5b[_0x186495(0x11b)]][_0x186495(0x219)]+=_0x267356,_0x4fb459[_0x339f5b[_0x186495(0x11b)]][_0x186495(0x161)]+=_0xdead23,_0x4fb459[_0x339f5b[_0x186495(0x11b)]][_0x186495(0x11f)]+=_0x386842;!_0x4c32d3['shopId']&&(!_0x3ad489[_0x339f5b[_0x186495(0x1f4)]]&&(_0x3ad489[_0x339f5b[_0x186495(0x1f4)]]={'shopId':_0x339f5b[_0x186495(0x1f4)],'shopName':_0x339f5b[_0x186495(0x1c1)][_0x186495(0x17b)],'shopUsername':_0x339f5b[_0x186495(0x1c1)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3ad489[_0x339f5b[_0x186495(0x1f4)]][_0x186495(0x1b1)]++,_0x3ad489[_0x339f5b[_0x186495(0x1f4)]]['turnoverUSDT']+=_0x369e4d,_0x3ad489[_0x339f5b[_0x186495(0x1f4)]][_0x186495(0x219)]+=_0x267356,_0x3ad489[_0x339f5b[_0x186495(0x1f4)]][_0x186495(0x161)]+=_0xdead23);const _0x203536=_0x339f5b[_0x186495(0x107)][_0x186495(0x112)]()[_0x186495(0xfe)]('T')[0x0];!_0x3ae997[_0x203536]&&(_0x3ae997[_0x203536]={'date':_0x203536,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3ae997[_0x203536][_0x186495(0x174)]+=_0x369e4d,_0x3ae997[_0x203536][_0x186495(0x1df)]+=_0xdead23,_0x3ae997[_0x203536][_0x186495(0x202)]+=_0x267356,_0x3ae997[_0x203536]['paymentsCount']++;}catch(_0x55bf0c){console[_0x186495(0x148)](_0x186495(0x173)+_0x339f5b['id']+':',_0x55bf0c);}}Object[_0x186495(0xfa)](_0x4fb459)['forEach'](_0x2104f9=>{const _0x4f618b=_0x186495;_0x2104f9[_0x4f618b(0x1b2)]=_0x2104f9[_0x4f618b(0x1b1)]>0x0?_0x2104f9[_0x4f618b(0x11f)]/_0x2104f9[_0x4f618b(0x1b1)]:0x0,delete _0x2104f9[_0x4f618b(0x11f)];}),Object[_0x186495(0xfa)](_0x3ad489)[_0x186495(0x21a)](_0xc5f864=>{const _0x312bd3=_0x186495;_0xc5f864[_0x312bd3(0x22f)]=_0xc5f864['paymentsCount']>0x0?_0xc5f864['turnoverUSDT']/_0xc5f864[_0x312bd3(0x1b1)]:0x0;});let _0x21cb0a=0x0;if(_0x4c32d3['shopId']){const _0x340b5b=await database_1[_0x186495(0x1a9)][_0x186495(0x109)][_0x186495(0x11e)]({'where':{'shopId':_0x4c32d3[_0x186495(0x1f4)],'status':_0x186495(0x222),'createdAt':{'gte':_0x5d9e06,'lte':_0x4ff756}},'select':{'amount':!![]}});_0x21cb0a=_0x340b5b[_0x186495(0x16c)]((_0x2ae808,_0x41b373)=>_0x2ae808+_0x41b373[_0x186495(0x116)],0x0);}const _0x4d14c6=_0x430c4f,_0x5937a6=_0x5653a7['length'],_0x4d30d7=_0x5937a6>0x0?_0x36b6a8/_0x5937a6:0x0,_0x4e867f=_0x4d14c6>0x0?Math[_0x186495(0x227)](_0x5937a6/_0x4d14c6*0x2710)/0x64:0x0,_0x326e66=Math['ceil']((_0x4ff756[_0x186495(0x121)]()-_0x5d9e06[_0x186495(0x121)]())/(0x3e8*0x3c*0x3c*0x18)),_0x52b8ef={'totalTurnover':Math[_0x186495(0x227)](_0x36b6a8*0x64)/0x64,'merchantEarnings':Math['round'](_0x5d9fd3*0x64)/0x64,'gatewayEarnings':Math[_0x186495(0x227)](_0x2a40cf*0x64)/0x64,'totalPaidOut':Math['round'](_0x21cb0a*0x64)/0x64,'averageCheck':Math[_0x186495(0x227)](_0x4d30d7*0x64)/0x64,'totalPayments':_0x4d14c6,'successfulPayments':_0x5937a6,'conversionRate':_0x4e867f,'gatewayBreakdown':Object[_0x186495(0xfa)](_0x4fb459)[_0x186495(0xff)](_0x130e34=>({..._0x130e34,'turnoverUSDT':Math['round'](_0x130e34[_0x186495(0x1fb)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x130e34['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x186495(0x227)](_0x130e34[_0x186495(0x161)]*0x64)/0x64,'averageCommissionRate':Math[_0x186495(0x227)](_0x130e34[_0x186495(0x1b2)]*0x64)/0x64})),'merchantBreakdown':_0x4c32d3[_0x186495(0x1f4)]?undefined:Object[_0x186495(0xfa)](_0x3ad489)[_0x186495(0xff)](_0x4ca09d=>({..._0x4ca09d,'turnoverUSDT':Math['round'](_0x4ca09d['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x4ca09d['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x186495(0x227)](_0x4ca09d[_0x186495(0x161)]*0x64)/0x64,'paidOutUSDT':Math[_0x186495(0x227)](_0x4ca09d[_0x186495(0x1ae)]*0x64)/0x64,'averageCheckUSDT':Math[_0x186495(0x227)](_0x4ca09d['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x186495(0xfa)](_0x3ae997)[_0x186495(0xff)](_0x23a007=>({..._0x23a007,'turnover':Math['round'](_0x23a007[_0x186495(0x174)]*0x64)/0x64,'merchantEarnings':Math[_0x186495(0x227)](_0x23a007[_0x186495(0x1df)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x23a007['gatewayEarnings']*0x64)/0x64}))[_0x186495(0x1e6)]((_0x48978c,_0x398a97)=>_0x48978c[_0x186495(0x1a1)][_0x186495(0x1b6)](_0x398a97[_0x186495(0x1a1)])),'periodInfo':{'from':_0x5d9e06,'to':_0x4ff756,'periodType':_0x4c32d3['period']||_0x186495(0x100),'daysCount':_0x326e66}};return console[_0x186495(0x151)]('📊\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x186495(0x225)+_0x52b8ef['totalTurnover']+'\x20USDT'),console['log'](_0x186495(0x123)+_0x52b8ef[_0x186495(0x1df)]+_0x186495(0x10c)),console['log'](_0x186495(0x1c0)+_0x52b8ef['gatewayEarnings']+_0x186495(0x10c)),console[_0x186495(0x151)](_0x186495(0x190)+_0x52b8ef[_0x186495(0x1cc)]),_0x52b8ef;}async[a35_0xc07cbb(0x1fd)](){const _0x3f3231=a35_0xc07cbb;console[_0x3f3231(0x151)](_0x3f3231(0x189));const _0x562409=await database_1['default']['shop'][_0x3f3231(0x11e)]({'where':{'status':_0x3f3231(0x129)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console['log']('📋\x20Found\x20'+_0x562409[_0x3f3231(0x1cd)]+_0x3f3231(0x187)),_0x562409[_0x3f3231(0xff)](_0x559c91=>({'id':_0x559c91['id'],'username':_0x559c91[_0x3f3231(0x1af)],'name':_0x559c91[_0x3f3231(0x17b)]}));}[a35_0xc07cbb(0x1e3)](_0x495207){const _0x4fb828=a35_0xc07cbb,_0x54be56={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':'Rapyd','noda':_0x4fb828(0x115),'cointopay':_0x4fb828(0x19a),'cointopay2':'Open\x20Banking\x202','klyme_eu':_0x4fb828(0x1e9),'klyme_gb':_0x4fb828(0x223),'klyme_de':_0x4fb828(0x135),'mastercard':'MasterCard'};return _0x54be56[_0x495207]||_0x495207;}[a35_0xc07cbb(0x226)](_0x25cbbe){const _0xfe8e47=a35_0xc07cbb,_0x5eaad5={'Test\x20Gateway':_0xfe8e47(0x1d0),'Plisio':_0xfe8e47(0x188),'Rapyd':_0xfe8e47(0x13f),'Noda':_0xfe8e47(0x1e4),'CoinToPay':'cointopay','CoinToPay2':'cointopay2','KLYME\x20EU':_0xfe8e47(0x1ec),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0xfe8e47(0x11a),'MasterCard':'mastercard'};return _0x5eaad5[_0x25cbbe]||_0x25cbbe['toLowerCase']();}async[a35_0xc07cbb(0x15e)](_0x1b6aea){const _0x1f2bf7=a35_0xc07cbb,{page:_0x32abda,limit:_0x1f8761,minAmount:_0x5ebe24,search:_0x2b9cca}=_0x1b6aea,_0x53320b=(_0x32abda-0x1)*_0x1f8761;console[_0x1f2bf7(0x151)](_0x1f2bf7(0x141),_0x1b6aea);const _0x46c432={'balance':{'gt':0x0},'status':_0x1f2bf7(0x129)};_0x5ebe24&&(_0x46c432['balance'][_0x1f2bf7(0x1f5)]=_0x5ebe24);_0x2b9cca&&(_0x46c432['OR']=[{'name':{'contains':_0x2b9cca,'mode':_0x1f2bf7(0x1b7)}},{'username':{'contains':_0x2b9cca,'mode':_0x1f2bf7(0x1b7)}}]);const [_0x4dbf33,_0x4b3c97]=await Promise[_0x1f2bf7(0x1e2)]([database_1[_0x1f2bf7(0x1a9)][_0x1f2bf7(0x1c1)][_0x1f2bf7(0x11e)]({'where':_0x46c432,'skip':_0x53320b,'take':_0x1f8761,'orderBy':{'balance':_0x1f2bf7(0x114)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x1f2bf7(0x1c1)][_0x1f2bf7(0x1a8)]({'where':_0x46c432})]);console['log'](_0x1f2bf7(0x15d)+_0x4dbf33[_0x1f2bf7(0x1cd)]+_0x1f2bf7(0x1d5));const _0x1d785e=await Promise['all'](_0x4dbf33[_0x1f2bf7(0xff)](async _0x3535b4=>{const _0x4d91b6=_0x1f2bf7,[_0x448fd0,_0x5ce579,_0x42e926]=await Promise[_0x4d91b6(0x1e2)]([database_1[_0x4d91b6(0x1a9)][_0x4d91b6(0x1b0)]['count']({'where':{'shopId':_0x3535b4['id'],'status':_0x4d91b6(0x14f),'gateway':{'not':'test_gateway'}}}),database_1[_0x4d91b6(0x1a9)][_0x4d91b6(0x1b0)][_0x4d91b6(0x170)]({'where':{'shopId':_0x3535b4['id'],'status':_0x4d91b6(0x14f),'gateway':{'not':_0x4d91b6(0x1d0)}},'orderBy':{'paidAt':_0x4d91b6(0x212)},'select':{'paidAt':!![]}}),database_1[_0x4d91b6(0x1a9)][_0x4d91b6(0x1b0)][_0x4d91b6(0x1d1)]({'by':['gateway'],'where':{'shopId':_0x3535b4['id'],'status':_0x4d91b6(0x14f),'gateway':{'not':_0x4d91b6(0x1d0)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x53a8f7=new Date(),_0x3570f7=new Date(_0x53a8f7[_0x4d91b6(0x118)](),_0x53a8f7[_0x4d91b6(0x1bc)](),0x1),_0x199f93=new Date(_0x53a8f7[_0x4d91b6(0x118)](),_0x53a8f7[_0x4d91b6(0x1bc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x599358,_0x1afcb1]=await Promise[_0x4d91b6(0x1e2)]([database_1[_0x4d91b6(0x1a9)][_0x4d91b6(0x109)][_0x4d91b6(0x214)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3535b4['id'],'status':_0x4d91b6(0x222)}}),database_1[_0x4d91b6(0x1a9)][_0x4d91b6(0x109)][_0x4d91b6(0x214)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3535b4['id'],'status':'COMPLETED','createdAt':{'gte':_0x3570f7,'lte':_0x199f93}}})]),_0x5caa16=_0x599358[_0x4d91b6(0x150)][_0x4d91b6(0x116)]||0x0,_0x54f438=_0x1afcb1['_sum'][_0x4d91b6(0x116)]||0x0,_0x4b735a=await Promise[_0x4d91b6(0x1e2)](_0x42e926[_0x4d91b6(0xff)](async _0xe16c50=>{const _0x11e3b3=_0x4d91b6;let _0x3d0006=0xa;if(_0x3535b4['gatewaySettings'])try{const _0x1ae2d5=JSON[_0x11e3b3(0x180)](_0x3535b4[_0x11e3b3(0x1be)]);for(const [_0x28a2a1,_0xe34983]of Object[_0x11e3b3(0x1ab)](_0x1ae2d5)){if(_0x28a2a1[_0x11e3b3(0x215)]()===_0xe16c50['gateway'][_0x11e3b3(0x215)]()){_0x3d0006=_0xe34983[_0x11e3b3(0x153)]||0xa,console[_0x11e3b3(0x151)](_0x11e3b3(0x16b)+_0xe16c50[_0x11e3b3(0x11b)]+_0x11e3b3(0x137)+_0x3535b4['id']+':\x20commission\x20=\x20'+_0x3d0006+'%');break;}}}catch(_0x3ec146){console['error'](_0x11e3b3(0x16a)+_0x3535b4['id']+':',_0x3ec146);}const _0x532062=_0xe16c50['_sum']?.[_0x11e3b3(0x20b)]||0x0,_0x2cde88=_0x532062*(0x1-_0x3d0006/0x64);return{'gateway':_0xe16c50['gateway'],'count':_0xe16c50[_0x11e3b3(0x1c3)]?.['id']||0x0,'amountUSDT':Math[_0x11e3b3(0x227)](_0x532062*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x11e3b3(0x227)](_0x2cde88*0x64)/0x64,'commission':_0x3d0006};})),_0x3fd100=_0x4b735a['reduce']((_0xbe2be7,_0x2ed30f)=>_0xbe2be7+_0x2ed30f[_0x4d91b6(0x20b)],0x0),_0x25124e=_0x3535b4['balance'];return console[_0x4d91b6(0x151)](_0x4d91b6(0x1f7)+_0x3535b4[_0x4d91b6(0x1af)]+':'),console['log'](_0x4d91b6(0x18b)+_0x3fd100[_0x4d91b6(0x169)](0x2)+_0x4d91b6(0x163)),console[_0x4d91b6(0x151)](_0x4d91b6(0x193)+_0x4b735a['reduce']((_0x365de0,_0x53db0a)=>_0x365de0+_0x53db0a[_0x4d91b6(0x1ff)],0x0)[_0x4d91b6(0x169)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x4d91b6(0x151)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x25124e[_0x4d91b6(0x169)](0x2)+_0x4d91b6(0x143)),{'id':_0x3535b4['id'],'fullName':_0x3535b4[_0x4d91b6(0x17b)],'username':_0x3535b4['username'],'telegramId':_0x3535b4[_0x4d91b6(0x12f)],'merchantUrl':_0x3535b4[_0x4d91b6(0x1d8)],'wallets':{'usdtPolygonWallet':_0x3535b4[_0x4d91b6(0x1ac)],'usdtTrcWallet':_0x3535b4['usdtTrcWallet'],'usdtErcWallet':_0x3535b4[_0x4d91b6(0x17a)],'usdcPolygonWallet':_0x3535b4[_0x4d91b6(0x1ce)]},'totalAmountUSDT':Math['round'](_0x3fd100*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4d91b6(0x227)](_0x25124e*0x64)/0x64,'totalPayout':Math['round'](_0x5caa16*0x64)/0x64,'thisMonth':Math[_0x4d91b6(0x227)](_0x54f438*0x64)/0x64,'paymentsCount':_0x448fd0,'oldestPaymentDate':_0x5ce579?.[_0x4d91b6(0x107)]||_0x3535b4[_0x4d91b6(0x1b5)],'gatewayBreakdown':_0x4b735a};})),_0x17056f=_0x1d785e[_0x1f2bf7(0x16c)]((_0x497448,_0x259213)=>_0x497448+_0x259213['totalAmountUSDT'],0x0),_0x44978d=_0x1d785e[_0x1f2bf7(0x16c)]((_0x3e4f1a,_0x53b218)=>_0x3e4f1a+_0x53b218[_0x1f2bf7(0x16f)],0x0),_0x34ae30=_0x1d785e[_0x1f2bf7(0x16c)]((_0x42ff44,_0x156f2a)=>_0x42ff44+_0x156f2a[_0x1f2bf7(0x220)],0x0),_0x2e6fab=_0x1d785e[_0x1f2bf7(0x16c)]((_0x258297,_0x162c6e)=>_0x258297+_0x162c6e[_0x1f2bf7(0x11d)],0x0);return console['log']('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x4b3c97+_0x1f2bf7(0x134)),console[_0x1f2bf7(0x151)](_0x1f2bf7(0x166)+Math[_0x1f2bf7(0x227)](_0x17056f*0x64)/0x64+_0x1f2bf7(0x163)),console[_0x1f2bf7(0x151)](_0x1f2bf7(0x179)+Math['round'](_0x44978d*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0x1f2bf7(0x151)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x1f2bf7(0x227)](_0x34ae30*0x64)/0x64+'\x20USDT'),console[_0x1f2bf7(0x151)](_0x1f2bf7(0x1aa)+Math[_0x1f2bf7(0x227)](_0x2e6fab*0x64)/0x64+'\x20USDT'),{'merchants':_0x1d785e,'pagination':{'page':_0x32abda,'limit':_0x1f8761,'total':_0x4b3c97,'totalPages':Math[_0x1f2bf7(0x12c)](_0x4b3c97/_0x1f8761)},'summary':{'totalMerchants':_0x4b3c97,'totalAmountUSDT':Math[_0x1f2bf7(0x227)](_0x17056f*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1f2bf7(0x227)](_0x44978d*0x64)/0x64,'totalPayout':Math[_0x1f2bf7(0x227)](_0x34ae30*0x64)/0x64,'thisMonth':Math[_0x1f2bf7(0x227)](_0x2e6fab*0x64)/0x64}};}async[a35_0xc07cbb(0x124)](_0x1908da){const _0xa4d25b=a35_0xc07cbb,{shopId:_0x3de484,amount:_0x1bc2e1,network:_0x3985eb,wallet:_0x2d4d6c,notes:_0x2aff92,txid:_0x2ae639,periodFrom:_0x3c22e0,periodTo:_0x1d13d0}=_0x1908da,_0x271eae=await database_1['default'][_0xa4d25b(0x1fa)](async _0x3d6513=>{const _0x3094f3=_0xa4d25b,_0x4b347c=await _0x3d6513['shop']['findUnique']({'where':{'id':_0x3de484},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4b347c)throw new Error(_0x3094f3(0x229));console[_0x3094f3(0x151)](_0x3094f3(0x1eb)+_0x4b347c['username']+':'),console[_0x3094f3(0x151)](_0x3094f3(0x1a5)+_0x4b347c['balance']['toFixed'](0x6)+_0x3094f3(0x10c)),console[_0x3094f3(0x151)](_0x3094f3(0x185)+_0x1bc2e1[_0x3094f3(0x169)](0x6)+_0x3094f3(0x10c)),console[_0x3094f3(0x151)](_0x3094f3(0x105)+_0x4b347c['totalPaidOut'][_0x3094f3(0x169)](0x6)+_0x3094f3(0x10c));if(_0x2ae639)console['log'](_0x3094f3(0x168)+_0x2ae639);if(_0x4b347c[_0x3094f3(0x1f3)]<_0x1bc2e1)throw new Error(_0x3094f3(0x17f)+_0x4b347c[_0x3094f3(0x1f3)]['toFixed'](0x6)+_0x3094f3(0x175)+_0x1bc2e1[_0x3094f3(0x169)](0x6)+'\x20USDT');let _0x9aaf60=_0x2d4d6c;if(!_0x9aaf60){const _0x3e9198=await _0x3d6513[_0x3094f3(0x1c1)]['findUnique']({'where':{'id':_0x3de484},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x3e9198)switch(_0x3985eb){case _0x3094f3(0x198):_0x9aaf60=_0x3e9198['usdtPolygonWallet']||undefined;break;case _0x3094f3(0x1cb):_0x9aaf60=_0x3e9198['usdtTrcWallet']||undefined;break;case _0x3094f3(0x228):_0x9aaf60=_0x3e9198[_0x3094f3(0x17a)]||undefined;break;case'polygon_usdc':_0x9aaf60=_0x3e9198[_0x3094f3(0x1ce)]||undefined;break;}}console[_0x3094f3(0x151)]('💳\x20Payout\x20wallet\x20for\x20'+_0x3985eb+':\x20'+(_0x9aaf60||_0x3094f3(0x12a)));const _0x52d621=await _0x3d6513[_0x3094f3(0x109)][_0x3094f3(0x199)]({'data':{'shopId':_0x3de484,'amount':_0x1bc2e1,'network':_0x3985eb,'status':_0x3094f3(0x222),'txid':_0x2ae639,'notes':_0x2aff92,'periodFrom':_0x3c22e0?new Date(_0x3c22e0):null,'periodTo':_0x1d13d0?new Date(_0x1d13d0):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x637a14=_0x4b347c['balance']-_0x1bc2e1,_0x2d38ac=_0x4b347c[_0x3094f3(0x20a)]+_0x1bc2e1;return await _0x3d6513['shop'][_0x3094f3(0x20d)]({'where':{'id':_0x3de484},'data':{'balance':_0x637a14,'totalPaidOut':_0x2d38ac}}),console['log'](_0x3094f3(0x1f2)+_0x4b347c[_0x3094f3(0x1af)]+'\x20balance\x20updated:'),console[_0x3094f3(0x151)](_0x3094f3(0x176)+_0x4b347c[_0x3094f3(0x1f3)][_0x3094f3(0x169)](0x6)+_0x3094f3(0x186)+_0x637a14[_0x3094f3(0x169)](0x6)+_0x3094f3(0x20e)+_0x1bc2e1['toFixed'](0x6)+')'),console[_0x3094f3(0x151)](_0x3094f3(0x182)+_0x4b347c['totalPaidOut'][_0x3094f3(0x169)](0x6)+_0x3094f3(0x186)+_0x2d38ac[_0x3094f3(0x169)](0x6)+'\x20USDT\x20(+'+_0x1bc2e1[_0x3094f3(0x169)](0x6)+')'),{'payout':_0x52d621,'shop':_0x4b347c};});return console[_0xa4d25b(0x151)](_0xa4d25b(0x18f)+_0x271eae[_0xa4d25b(0x109)]['id']+_0xa4d25b(0x137)+_0x271eae[_0xa4d25b(0x1c1)][_0xa4d25b(0x1af)]+'\x20('+_0x1bc2e1+_0xa4d25b(0x22d)),{'id':_0x271eae['payout']['id'],'shopId':_0x271eae[_0xa4d25b(0x109)][_0xa4d25b(0x1f4)],'shopName':_0x271eae[_0xa4d25b(0x1c1)][_0xa4d25b(0x17b)],'shopUsername':_0x271eae[_0xa4d25b(0x1c1)]['username'],'amount':_0x271eae[_0xa4d25b(0x109)][_0xa4d25b(0x116)],'network':_0x271eae['payout'][_0xa4d25b(0x111)],'status':_0x271eae[_0xa4d25b(0x109)][_0xa4d25b(0x136)],'txid':_0x271eae['payout'][_0xa4d25b(0x119)],'notes':_0x271eae[_0xa4d25b(0x109)][_0xa4d25b(0x194)],'periodFrom':_0x271eae['payout'][_0xa4d25b(0x1b9)],'periodTo':_0x271eae['payout'][_0xa4d25b(0x1db)],'createdAt':_0x271eae[_0xa4d25b(0x109)][_0xa4d25b(0x1b5)],'paidAt':_0x271eae[_0xa4d25b(0x109)]['paidAt']};}async[a35_0xc07cbb(0x172)](_0x3a0f76){const _0x5ea705=a35_0xc07cbb,{page:_0x444ee8,limit:_0x249d19,shopId:_0x3c1875,network:_0x23d0bb,dateFrom:_0x1e01f2,dateTo:_0x2cc5de,search:_0x27cf64}=_0x3a0f76,_0x562c97=(_0x444ee8-0x1)*_0x249d19,_0x509c6e={};_0x3c1875&&(_0x509c6e[_0x5ea705(0x1f4)]=_0x3c1875);_0x23d0bb&&(_0x509c6e[_0x5ea705(0x111)]=_0x23d0bb);(_0x1e01f2||_0x2cc5de)&&(_0x509c6e[_0x5ea705(0x1b5)]={},_0x1e01f2&&(_0x509c6e[_0x5ea705(0x1b5)]['gte']=new Date(_0x1e01f2)),_0x2cc5de&&(_0x509c6e[_0x5ea705(0x1b5)][_0x5ea705(0x204)]=new Date(_0x2cc5de)));_0x27cf64&&(_0x509c6e['OR']=[{'shop':{'name':{'contains':_0x27cf64,'mode':_0x5ea705(0x1b7)}}},{'shop':{'username':{'contains':_0x27cf64,'mode':_0x5ea705(0x1b7)}}},{'notes':{'contains':_0x27cf64,'mode':_0x5ea705(0x1b7)}}]);const [_0x13b251,_0x57295b]=await Promise['all']([database_1[_0x5ea705(0x1a9)][_0x5ea705(0x109)][_0x5ea705(0x11e)]({'where':_0x509c6e,'skip':_0x562c97,'take':_0x249d19,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5ea705(0x1a9)][_0x5ea705(0x109)][_0x5ea705(0x1a8)]({'where':_0x509c6e})]);return{'payouts':_0x13b251[_0x5ea705(0xff)](_0x576ffa=>({'id':_0x576ffa['id'],'shopId':_0x576ffa[_0x5ea705(0x1f4)],'shopName':_0x576ffa[_0x5ea705(0x1c1)][_0x5ea705(0x17b)],'shopUsername':_0x576ffa['shop'][_0x5ea705(0x1af)],'amount':_0x576ffa[_0x5ea705(0x116)],'network':_0x576ffa[_0x5ea705(0x111)],'status':_0x576ffa['status'],'txid':_0x576ffa['txid'],'notes':_0x576ffa['notes'],'periodFrom':_0x576ffa['periodFrom'],'periodTo':_0x576ffa[_0x5ea705(0x1db)],'createdAt':_0x576ffa[_0x5ea705(0x1b5)],'paidAt':_0x576ffa[_0x5ea705(0x107)]})),'pagination':{'page':_0x444ee8,'limit':_0x249d19,'total':_0x57295b,'totalPages':Math[_0x5ea705(0x12c)](_0x57295b/_0x249d19)}};}async[a35_0xc07cbb(0x10e)](_0x3a1152){const _0x4f22ac=a35_0xc07cbb,_0x4608ef=await database_1[_0x4f22ac(0x1a9)]['payout'][_0x4f22ac(0x209)]({'where':{'id':_0x3a1152},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4608ef)return null;return{'id':_0x4608ef['id'],'shopId':_0x4608ef['shopId'],'shopName':_0x4608ef[_0x4f22ac(0x1c1)][_0x4f22ac(0x17b)],'shopUsername':_0x4608ef[_0x4f22ac(0x1c1)][_0x4f22ac(0x1af)],'amount':_0x4608ef[_0x4f22ac(0x116)],'network':_0x4608ef['network'],'status':_0x4608ef[_0x4f22ac(0x136)],'txid':_0x4608ef[_0x4f22ac(0x119)],'notes':_0x4608ef[_0x4f22ac(0x194)],'periodFrom':_0x4608ef[_0x4f22ac(0x1b9)],'periodTo':_0x4608ef[_0x4f22ac(0x1db)],'createdAt':_0x4608ef[_0x4f22ac(0x1b5)],'paidAt':_0x4608ef[_0x4f22ac(0x107)]};}async[a35_0xc07cbb(0x206)](_0x19d3a3){const _0x5e47e3=a35_0xc07cbb;await database_1[_0x5e47e3(0x1a9)][_0x5e47e3(0x109)][_0x5e47e3(0x15c)]({'where':{'id':_0x19d3a3}});}async[a35_0xc07cbb(0x17c)](_0x4d9711){const _0x4658ed=a35_0xc07cbb,{page:_0x75cab3,limit:_0x546755,status:_0x3a6037,gateway:_0x613b8b,shopId:_0x11d798,dateFrom:_0x5da227,dateTo:_0x27315c,search:_0x108bc9,currency:_0x541667,sortBy:_0x1e485e,sortOrder:_0x3b4bd0}=_0x4d9711,_0x5473f0=(_0x75cab3-0x1)*_0x546755;console[_0x4658ed(0x151)](_0x4658ed(0x18e),_0x4d9711);const _0x32b877=await database_1[_0x4658ed(0x1a9)][_0x4658ed(0x1b0)][_0x4658ed(0x1d1)]({'by':[_0x4658ed(0x11b)],'_count':{'gateway':!![]}});console[_0x4658ed(0x151)](_0x4658ed(0x218),_0x32b877[_0x4658ed(0xff)](_0x5721ef=>_0x5721ef[_0x4658ed(0x11b)]+'\x20('+_0x5721ef[_0x4658ed(0x1c3)][_0x4658ed(0x11b)]+_0x4658ed(0x1d2)));if(_0x613b8b){const _0x1e05dd=_0x32b877[_0x4658ed(0x164)](_0x136deb=>_0x136deb[_0x4658ed(0x11b)][_0x4658ed(0x215)]()===_0x613b8b['toLowerCase']());!_0x1e05dd&&_0x613b8b[_0x4658ed(0x215)]()!==_0x4658ed(0x1d0)&&console['log'](_0x4658ed(0x216)+_0x613b8b+_0x4658ed(0x1f1)+_0x32b877[_0x4658ed(0xff)](_0x55d1a3=>_0x55d1a3[_0x4658ed(0x11b)])[_0x4658ed(0x22a)](',\x20'));}const _0x7970a3={};_0x3a6037&&(_0x7970a3[_0x4658ed(0x136)]=_0x3a6037['toUpperCase']());if(!_0x613b8b)_0x7970a3[_0x4658ed(0x11b)]={'not':_0x4658ed(0x1d0)};else{if(_0x613b8b&&(_0x613b8b[_0x4658ed(0x215)]()===_0x4658ed(0x1d0)||_0x613b8b===_0x4658ed(0x177)))_0x7970a3[_0x4658ed(0x11b)]=_0x4658ed(0x1d0);else{let _0x523643=_0x613b8b;const _0x12df14=(0x0,gateway_1[_0x4658ed(0x110)])(_0x613b8b);if(_0x12df14)_0x523643=_0x12df14,console[_0x4658ed(0x151)](_0x4658ed(0x13b)+_0x613b8b+_0x4658ed(0x102)+_0x523643+'\x27');else{const _0x1ff19f=(0x0,gateway_1[_0x4658ed(0x1e8)])(_0x613b8b);if(_0x1ff19f){const _0x1338e9=(0x0,gateway_1[_0x4658ed(0x110)])(_0x1ff19f);_0x1338e9&&(_0x523643=_0x1338e9,console[_0x4658ed(0x151)](_0x4658ed(0x1de)+_0x613b8b+_0x4658ed(0x1c5)+_0x1ff19f+_0x4658ed(0x104)+_0x523643+'\x27'));}else console[_0x4658ed(0x151)]('🔍\x20Using\x20gateway\x20\x27'+_0x613b8b+_0x4658ed(0x1d4));}const _0x28f9fa=await database_1[_0x4658ed(0x1a9)][_0x4658ed(0x1b0)]['count']({'where':{'gateway':_0x523643[_0x4658ed(0x215)]()},'take':0x1});_0x28f9fa===0x0?(console[_0x4658ed(0x151)](_0x4658ed(0x1ca)+_0x523643+_0x4658ed(0x1f6)+_0x613b8b+_0x4658ed(0x13d)),_0x7970a3[_0x4658ed(0x11b)]=_0x4658ed(0x142)):(_0x7970a3[_0x4658ed(0x11b)]=_0x523643[_0x4658ed(0x215)](),console[_0x4658ed(0x151)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x523643+_0x4658ed(0x1f6)+_0x613b8b+'\x27)'));}}console['log'](_0x4658ed(0x154),_0x7970a3['gateway']);_0x11d798&&(_0x7970a3['shopId']=_0x11d798);_0x541667&&(_0x7970a3[_0x4658ed(0x157)]=_0x541667[_0x4658ed(0x1b4)](),console[_0x4658ed(0x151)](_0x4658ed(0x1c6)+_0x541667[_0x4658ed(0x1b4)]()));(_0x5da227||_0x27315c)&&(_0x7970a3[_0x4658ed(0x1b5)]={},_0x5da227&&(_0x7970a3['createdAt'][_0x4658ed(0x1f5)]=new Date(_0x5da227)),_0x27315c&&(_0x7970a3[_0x4658ed(0x1b5)][_0x4658ed(0x204)]=new Date(_0x27315c)));_0x108bc9&&(_0x7970a3['OR']=[{'id':{'contains':_0x108bc9,'mode':_0x4658ed(0x1b7)}},{'orderId':{'contains':_0x108bc9,'mode':_0x4658ed(0x1b7)}},{'gatewayOrderId':{'contains':_0x108bc9,'mode':_0x4658ed(0x1b7)}},{'customerEmail':{'contains':_0x108bc9,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x108bc9,'mode':_0x4658ed(0x1b7)}}},{'shop':{'username':{'contains':_0x108bc9,'mode':_0x4658ed(0x1b7)}}}]);console[_0x4658ed(0x151)]('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x4658ed(0x217)](_0x7970a3,null,0x2));let _0x4e40de={'createdAt':_0x4658ed(0x114)};if(_0x1e485e){const _0x72755f=[_0x4658ed(0x116),'createdAt',_0x4658ed(0x125),'status',_0x4658ed(0x11b),_0x4658ed(0x157)],_0x10957d=[_0x4658ed(0x212),_0x4658ed(0x114)];if(_0x72755f[_0x4658ed(0x17d)](_0x1e485e)){const _0x5d4e0a=_0x10957d['includes'](_0x3b4bd0)?_0x3b4bd0:_0x4658ed(0x114);_0x4e40de={[_0x1e485e]:_0x5d4e0a},console['log'](_0x4658ed(0x1a6)+_0x1e485e+'\x20in\x20'+_0x5d4e0a+_0x4658ed(0x131));}}const [_0x444e5e,_0xf8de79]=await Promise['all']([database_1[_0x4658ed(0x1a9)][_0x4658ed(0x1b0)][_0x4658ed(0x11e)]({'where':_0x7970a3,'skip':_0x5473f0,'take':_0x546755,'orderBy':_0x4e40de,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4658ed(0x1a9)][_0x4658ed(0x1b0)][_0x4658ed(0x1a8)]({'where':_0x7970a3})]);return{'payments':_0x444e5e,'pagination':{'page':_0x75cab3,'limit':_0x546755,'total':_0xf8de79,'totalPages':Math[_0x4658ed(0x12c)](_0xf8de79/_0x546755)}};}async['getPaymentById'](_0x1c6d82){const _0x56a387=a35_0xc07cbb,_0x136e6e=await database_1[_0x56a387(0x1a9)][_0x56a387(0x1b0)]['findUnique']({'where':{'id':_0x1c6d82},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x136e6e)return null;return{'id':_0x136e6e['id'],'shopId':_0x136e6e[_0x56a387(0x1f4)],'gateway':_0x136e6e[_0x56a387(0x11b)],'amount':_0x136e6e[_0x56a387(0x116)],'currency':_0x136e6e[_0x56a387(0x157)],'status':_0x136e6e[_0x56a387(0x136)],'orderId':_0x136e6e[_0x56a387(0x1f0)],'gatewayOrderId':_0x136e6e[_0x56a387(0x1a4)],'customerEmail':_0x136e6e['customerEmail'],'customerName':_0x136e6e[_0x56a387(0x192)],'customerCountry':_0x136e6e[_0x56a387(0x196)],'customerIp':_0x136e6e[_0x56a387(0x171)],'customerUa':_0x136e6e[_0x56a387(0x15b)],'failureMessage':_0x136e6e[_0x56a387(0x1d9)],'externalPaymentUrl':_0x136e6e[_0x56a387(0x101)],'successUrl':_0x136e6e[_0x56a387(0x14d)],'failUrl':_0x136e6e[_0x56a387(0x162)],'pendingUrl':_0x136e6e[_0x56a387(0x128)],'whiteUrl':_0x136e6e[_0x56a387(0x11c)],'createdAt':_0x136e6e[_0x56a387(0x1b5)],'updatedAt':_0x136e6e[_0x56a387(0x125)],'shop':_0x136e6e[_0x56a387(0x1c1)]};}async[a35_0xc07cbb(0x158)](_0x5aca42,_0xc3e52,_0x37683f,_0x89dcf5){const _0x3f800e=a35_0xc07cbb,_0x19afc5=await database_1[_0x3f800e(0x1a9)][_0x3f800e(0x1fa)](async _0x4f9ab8=>{const _0xf70810=_0x3f800e,_0x5ed7d4=await _0x4f9ab8[_0xf70810(0x1b0)][_0xf70810(0x209)]({'where':{'id':_0x5aca42},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5ed7d4)throw new Error(_0xf70810(0x1ad));const _0x476ed5=_0x5ed7d4[_0xf70810(0x136)],_0x3d0ecc=_0xc3e52['toUpperCase']();console['log'](_0xf70810(0xfc)+_0x5aca42+_0xf70810(0x132)+_0x476ed5+_0xf70810(0x186)+_0x3d0ecc),console[_0xf70810(0x151)](_0xf70810(0x22e)+_0x5ed7d4[_0xf70810(0x1c1)][_0xf70810(0x1f3)]+_0xf70810(0x10c));const _0x389191={'status':_0x3d0ecc,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x37683f&&(_0x389191[_0xf70810(0x22c)]=_0x37683f);_0x3d0ecc===_0xf70810(0x203)&&_0x89dcf5&&(_0x389191['chargebackAmount']=_0x89dcf5);let _0x4abf79=0x0,_0x517e40=_0x5ed7d4[_0xf70810(0x1c1)][_0xf70810(0x1f3)];if(_0x3d0ecc===_0xf70810(0x14f)&&_0x476ed5!==_0xf70810(0x14f)){_0x389191[_0xf70810(0x107)]=new Date();const _0x3d542e=await currencyService_1[_0xf70810(0x1c2)][_0xf70810(0x1c4)](_0x5ed7d4['amount'],_0x5ed7d4[_0xf70810(0x157)]);_0x389191[_0xf70810(0x20b)]=_0x3d542e;let _0x2f3ed8=0xa;const _0x31000e=await _0x4f9ab8[_0xf70810(0x1c1)][_0xf70810(0x209)]({'where':{'id':_0x5ed7d4[_0xf70810(0x1f4)]},'select':{'gatewaySettings':!![]}});if(_0x31000e?.[_0xf70810(0x1be)])try{const _0x264e35=JSON['parse'](_0x31000e['gatewaySettings']);for(const [_0x2fd3a9,_0x120df3]of Object['entries'](_0x264e35)){if(_0x2fd3a9[_0xf70810(0x215)]()===_0x5ed7d4[_0xf70810(0x11b)][_0xf70810(0x215)]()){_0x2f3ed8=_0x120df3[_0xf70810(0x153)]||0xa;break;}}}catch(_0xa6da4a){console[_0xf70810(0x148)](_0xf70810(0x21e)+_0x5aca42+':',_0xa6da4a);}let _0x4af2d8;_0x5ed7d4[_0xf70810(0x208)]!==null&&_0x5ed7d4[_0xf70810(0x208)]!==undefined?(_0x4af2d8=_0x5ed7d4[_0xf70810(0x208)],console[_0xf70810(0x151)](_0xf70810(0x138)+_0x4af2d8[_0xf70810(0x169)](0x6)+_0xf70810(0x156)+_0x5aca42)):(_0x4af2d8=_0x3d542e*(0x1-_0x2f3ed8/0x64),console[_0xf70810(0x151)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x5aca42+':\x20'+_0x2f3ed8+'%\x20from\x20'+_0x3d542e[_0xf70810(0x169)](0x6)+'\x20USDT'),_0x389191[_0xf70810(0x208)]=_0x4af2d8),_0x4abf79=_0x4af2d8,_0x517e40+=_0x4af2d8,console[_0xf70810(0x151)](_0xf70810(0x178)+_0x5aca42+_0xf70810(0x1a2)),console[_0xf70810(0x151)](_0xf70810(0x21f)+_0x3d542e[_0xf70810(0x169)](0x6)+_0xf70810(0x10c)),console[_0xf70810(0x151)](_0xf70810(0x126)+_0x5ed7d4[_0xf70810(0x11b)]+_0xf70810(0xfb)+_0x2f3ed8+'%'),console['log'](_0xf70810(0x13e)+_0x4af2d8[_0xf70810(0x169)](0x6)+_0xf70810(0x21b)+_0x2f3ed8+_0xf70810(0x120)),console[_0xf70810(0x151)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x4af2d8['toFixed'](0x6)+_0xf70810(0x10c));}else{if(_0x476ed5===_0xf70810(0x14f)&&_0x3d0ecc!=='PAID'){if(_0x5ed7d4[_0xf70810(0x20b)]){let _0x301451=0xa;const _0x298147=await _0x4f9ab8[_0xf70810(0x1c1)][_0xf70810(0x209)]({'where':{'id':_0x5ed7d4[_0xf70810(0x1f4)]},'select':{'gatewaySettings':!![]}});if(_0x298147?.['gatewaySettings'])try{const _0xb9362d=JSON[_0xf70810(0x180)](_0x298147['gatewaySettings']);for(const [_0x1e3b18,_0x211c11]of Object[_0xf70810(0x1ab)](_0xb9362d)){if(_0x1e3b18['toLowerCase']()===_0x5ed7d4[_0xf70810(0x11b)]['toLowerCase']()){_0x301451=_0x211c11[_0xf70810(0x153)]||0xa;break;}}}catch(_0x2786b1){console[_0xf70810(0x148)](_0xf70810(0x21e)+_0x5aca42+':',_0x2786b1);}const _0x319475=_0x5ed7d4[_0xf70810(0x208)]||_0x5ed7d4[_0xf70810(0x20b)]*(0x1-_0x301451/0x64);_0x4abf79=-_0x319475,_0x517e40-=_0x319475,_0x389191['amountUSDT']=null,_0x389191['amountAfterGatewayCommissionUSDT']=null,console[_0xf70810(0x151)](_0xf70810(0x178)+_0x5aca42+_0xf70810(0x103)),console[_0xf70810(0x151)](_0xf70810(0x21f)+_0x5ed7d4[_0xf70810(0x20b)]['toFixed'](0x6)+'\x20USDT'),console[_0xf70810(0x151)](_0xf70810(0x126)+_0x5ed7d4['gateway']+',\x20Commission:\x20'+_0x301451+'%'),console[_0xf70810(0x151)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x319475[_0xf70810(0x169)](0x6)+'\x20USDT\x20(after\x20'+_0x301451+_0xf70810(0x120)),console[_0xf70810(0x151)](_0xf70810(0x149)+_0x319475[_0xf70810(0x169)](0x6)+_0xf70810(0x10c));}}}_0x3d0ecc===_0xf70810(0x203)&&(_0x476ed5===_0xf70810(0x14f)&&_0x5ed7d4[_0xf70810(0x20b)]&&console['log'](_0xf70810(0x14e)),_0x89dcf5&&_0x89dcf5>0x0&&(_0x4abf79-=_0x89dcf5,_0x517e40-=_0x89dcf5,console[_0xf70810(0x151)](_0xf70810(0x140)+_0x89dcf5['toFixed'](0x6)+_0xf70810(0x1b8))));_0x3d0ecc==='REFUND'&&_0x476ed5===_0xf70810(0x14f)&&console[_0xf70810(0x151)](_0xf70810(0x16d));const _0x35e582=await _0x4f9ab8[_0xf70810(0x1b0)][_0xf70810(0x20d)]({'where':{'id':_0x5aca42},'data':_0x389191,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4abf79!==0x0&&(await _0x4f9ab8[_0xf70810(0x1c1)][_0xf70810(0x20d)]({'where':{'id':_0x5ed7d4[_0xf70810(0x1f4)]},'data':{'balance':_0x517e40}}),console[_0xf70810(0x151)](_0xf70810(0x1f2)+_0x5ed7d4[_0xf70810(0x1f4)]+_0xf70810(0x19d)+_0x5ed7d4['shop']['balance'][_0xf70810(0x169)](0x6)+_0xf70810(0x186)+_0x517e40['toFixed'](0x6)+_0xf70810(0x1b3)+(_0x4abf79>0x0?'+':'')+_0x4abf79[_0xf70810(0x169)](0x6)+')')),_0x35e582;});return{'id':_0x19afc5['id'],'shopId':_0x19afc5[_0x3f800e(0x1f4)],'gateway':_0x19afc5['gateway'],'amount':_0x19afc5[_0x3f800e(0x116)],'currency':_0x19afc5[_0x3f800e(0x157)],'status':_0x19afc5[_0x3f800e(0x136)],'orderId':_0x19afc5[_0x3f800e(0x1f0)],'gatewayOrderId':_0x19afc5[_0x3f800e(0x1a4)],'customerEmail':_0x19afc5[_0x3f800e(0x19c)],'customerName':_0x19afc5['customerName'],'customerCountry':_0x19afc5[_0x3f800e(0x196)],'customerIp':_0x19afc5['customerIp'],'customerUa':_0x19afc5['customerUa'],'failureMessage':_0x19afc5['failureMessage'],'adminNotes':_0x19afc5['adminNotes'],'chargebackAmount':_0x19afc5[_0x3f800e(0x191)],'statusChangedBy':_0x19afc5[_0x3f800e(0x1ee)],'statusChangedAt':_0x19afc5[_0x3f800e(0x183)],'createdAt':_0x19afc5[_0x3f800e(0x1b5)],'updatedAt':_0x19afc5[_0x3f800e(0x125)],'shop':_0x19afc5[_0x3f800e(0x1c1)]};}async['updateUser'](_0x22ff8b,_0x5ee8a9){const _0x40830e=a35_0xc07cbb,_0x112dcc=Math[_0x40830e(0x1d6)]()[_0x40830e(0x1ba)](0x24)[_0x40830e(0x1e7)](0x2,0x9);console[_0x40830e(0x151)](_0x40830e(0x167)+_0x112dcc+_0x40830e(0x1d3)+_0x22ff8b);const _0x47d073={..._0x5ee8a9};_0x5ee8a9[_0x40830e(0x127)]&&_0x5ee8a9[_0x40830e(0x127)][_0x40830e(0x197)]()!==''?(console[_0x40830e(0x151)]('🔐\x20['+_0x112dcc+_0x40830e(0x1dc)+_0x22ff8b),_0x47d073[_0x40830e(0x127)]=await bcryptjs_1['default'][_0x40830e(0x1ef)](_0x5ee8a9[_0x40830e(0x127)],0xc)):(console[_0x40830e(0x151)](_0x40830e(0x18a)+_0x112dcc+_0x40830e(0x130)),delete _0x47d073[_0x40830e(0x127)]);_0x5ee8a9[_0x40830e(0x1bb)]&&(_0x47d073[_0x40830e(0x17b)]=_0x5ee8a9[_0x40830e(0x1bb)],delete _0x47d073[_0x40830e(0x1bb)]);_0x5ee8a9[_0x40830e(0x133)]&&(_0x47d073[_0x40830e(0x12f)]=_0x5ee8a9[_0x40830e(0x133)],delete _0x47d073[_0x40830e(0x133)]);_0x5ee8a9[_0x40830e(0x13a)]&&(_0x47d073[_0x40830e(0x1d8)]=_0x5ee8a9[_0x40830e(0x13a)],delete _0x47d073['merchantUrl']);if(_0x5ee8a9[_0x40830e(0x117)]){const _0x10adb9=_0x5ee8a9[_0x40830e(0x117)]['map'](_0x47c2ac=>this[_0x40830e(0x226)](_0x47c2ac));console['log']('🔄\x20Gateway\x20mapping:',_0x5ee8a9[_0x40830e(0x117)],'->',_0x10adb9),_0x47d073[_0x40830e(0x16e)]=JSON[_0x40830e(0x217)](_0x10adb9),delete _0x47d073[_0x40830e(0x117)];}_0x5ee8a9[_0x40830e(0x1be)]&&(console[_0x40830e(0x151)](_0x40830e(0x1e1)+_0x112dcc+_0x40830e(0x17e),_0x5ee8a9[_0x40830e(0x1be)]),_0x47d073[_0x40830e(0x1be)]=JSON[_0x40830e(0x217)](_0x5ee8a9['gatewaySettings']),console[_0x40830e(0x151)](_0x40830e(0x1e1)+_0x112dcc+_0x40830e(0x12e),_0x47d073[_0x40830e(0x1be)]));_0x5ee8a9[_0x40830e(0x1c7)]&&(_0x5ee8a9['wallets'][_0x40830e(0x1ac)]!==undefined&&(_0x47d073[_0x40830e(0x1ac)]=_0x5ee8a9[_0x40830e(0x1c7)]['usdtPolygonWallet']||null),_0x5ee8a9[_0x40830e(0x1c7)]['usdtTrcWallet']!==undefined&&(_0x47d073[_0x40830e(0x1d7)]=_0x5ee8a9[_0x40830e(0x1c7)][_0x40830e(0x1d7)]||null),_0x5ee8a9['wallets']['usdtErcWallet']!==undefined&&(_0x47d073[_0x40830e(0x17a)]=_0x5ee8a9['wallets']['usdtErcWallet']||null),_0x5ee8a9[_0x40830e(0x1c7)][_0x40830e(0x1ce)]!==undefined&&(_0x47d073['usdcPolygonWallet']=_0x5ee8a9[_0x40830e(0x1c7)][_0x40830e(0x1ce)]||null),delete _0x47d073[_0x40830e(0x1c7)]);const _0x56b7b2=await database_1[_0x40830e(0x1a9)][_0x40830e(0x1c1)][_0x40830e(0x20d)]({'where':{'id':_0x22ff8b},'data':_0x47d073,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x40830e(0x151)](_0x40830e(0x1ea)+_0x112dcc+_0x40830e(0x19f),_0x56b7b2[_0x40830e(0x1be)]),{'id':_0x56b7b2['id'],'fullName':_0x56b7b2[_0x40830e(0x17b)],'username':_0x56b7b2[_0x40830e(0x1af)],'telegramId':_0x56b7b2[_0x40830e(0x12f)],'merchantUrl':_0x56b7b2[_0x40830e(0x1d8)],'gateways':_0x56b7b2[_0x40830e(0x16e)]?JSON[_0x40830e(0x180)](_0x56b7b2[_0x40830e(0x16e)]):null,'gatewaySettings':_0x56b7b2[_0x40830e(0x1be)]?JSON[_0x40830e(0x180)](_0x56b7b2[_0x40830e(0x1be)]):null,'publicKey':_0x56b7b2['publicKey'],'wallets':{'usdtPolygonWallet':_0x56b7b2[_0x40830e(0x1ac)],'usdtTrcWallet':_0x56b7b2['usdtTrcWallet'],'usdtErcWallet':_0x56b7b2[_0x40830e(0x17a)],'usdcPolygonWallet':_0x56b7b2[_0x40830e(0x1ce)]},'status':_0x56b7b2[_0x40830e(0x136)],'createdAt':_0x56b7b2[_0x40830e(0x1b5)]};}async['suspendUser'](_0x3858bf){const _0x543869=a35_0xc07cbb,_0x1fff69=await database_1[_0x543869(0x1a9)][_0x543869(0x1c1)][_0x543869(0x20d)]({'where':{'id':_0x3858bf},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1fff69['id'],'fullName':_0x1fff69[_0x543869(0x17b)],'username':_0x1fff69[_0x543869(0x1af)],'telegramId':_0x1fff69[_0x543869(0x12f)],'merchantUrl':_0x1fff69[_0x543869(0x1d8)],'gateways':_0x1fff69[_0x543869(0x16e)]?JSON['parse'](_0x1fff69[_0x543869(0x16e)]):null,'gatewaySettings':_0x1fff69['gatewaySettings']?JSON[_0x543869(0x180)](_0x1fff69[_0x543869(0x1be)]):null,'publicKey':_0x1fff69['publicKey'],'wallets':{'usdtPolygonWallet':_0x1fff69['usdtPolygonWallet'],'usdtTrcWallet':_0x1fff69[_0x543869(0x1d7)],'usdtErcWallet':_0x1fff69[_0x543869(0x17a)],'usdcPolygonWallet':_0x1fff69['usdcPolygonWallet']},'status':_0x1fff69[_0x543869(0x136)],'createdAt':_0x1fff69[_0x543869(0x1b5)]};}async[a35_0xc07cbb(0x184)](_0x5777be){const _0x1fd349=a35_0xc07cbb,_0x14892d=await database_1[_0x1fd349(0x1a9)][_0x1fd349(0x1c1)][_0x1fd349(0x20d)]({'where':{'id':_0x5777be},'data':{'status':_0x1fd349(0x129)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x14892d['id'],'fullName':_0x14892d[_0x1fd349(0x17b)],'username':_0x14892d['username'],'telegramId':_0x14892d[_0x1fd349(0x12f)],'merchantUrl':_0x14892d[_0x1fd349(0x1d8)],'gateways':_0x14892d['paymentGateways']?JSON['parse'](_0x14892d[_0x1fd349(0x16e)]):null,'gatewaySettings':_0x14892d[_0x1fd349(0x1be)]?JSON['parse'](_0x14892d[_0x1fd349(0x1be)]):null,'publicKey':_0x14892d[_0x1fd349(0x165)],'wallets':{'usdtPolygonWallet':_0x14892d[_0x1fd349(0x1ac)],'usdtTrcWallet':_0x14892d['usdtTrcWallet'],'usdtErcWallet':_0x14892d[_0x1fd349(0x17a)],'usdcPolygonWallet':_0x14892d[_0x1fd349(0x1ce)]},'status':_0x14892d[_0x1fd349(0x136)],'createdAt':_0x14892d[_0x1fd349(0x1b5)]};}async[a35_0xc07cbb(0x200)](_0x44dff2){const _0x598fe2=a35_0xc07cbb,{page:_0x203e93,limit:_0x3faee8,status:_0x54d8a}=_0x44dff2,_0x45193b=(_0x203e93-0x1)*_0x3faee8,_0x5775ff={};_0x54d8a&&(_0x5775ff[_0x598fe2(0x136)]=_0x54d8a['toUpperCase']());const [_0xd3960f,_0x16aaf0]=await Promise[_0x598fe2(0x1e2)]([database_1['default'][_0x598fe2(0x1c1)][_0x598fe2(0x11e)]({'where':_0x5775ff,'skip':_0x45193b,'take':_0x3faee8,'orderBy':{'createdAt':_0x598fe2(0x114)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x598fe2(0x1a9)][_0x598fe2(0x1c1)][_0x598fe2(0x1a8)]({'where':_0x5775ff})]);return{'users':_0xd3960f[_0x598fe2(0xff)](_0x12a4b2=>{const _0x5f1c88=_0x598fe2,_0x3b45d8=_0x12a4b2['paymentGateways']?JSON[_0x5f1c88(0x180)](_0x12a4b2[_0x5f1c88(0x16e)]):null,_0x58d1b2=_0x3b45d8?_0x3b45d8['map'](_0x110033=>this[_0x5f1c88(0x1e3)](_0x110033)):null;return{'id':_0x12a4b2['id'],'fullName':_0x12a4b2[_0x5f1c88(0x17b)],'username':_0x12a4b2['username'],'telegramId':_0x12a4b2[_0x5f1c88(0x12f)],'merchantUrl':_0x12a4b2['shopUrl'],'gateways':_0x58d1b2,'gatewaySettings':_0x12a4b2[_0x5f1c88(0x1be)]?JSON[_0x5f1c88(0x180)](_0x12a4b2[_0x5f1c88(0x1be)]):null,'publicKey':_0x12a4b2[_0x5f1c88(0x165)],'wallets':{'usdtPolygonWallet':_0x12a4b2[_0x5f1c88(0x1ac)],'usdtTrcWallet':_0x12a4b2[_0x5f1c88(0x1d7)],'usdtErcWallet':_0x12a4b2[_0x5f1c88(0x17a)],'usdcPolygonWallet':_0x12a4b2['usdcPolygonWallet']},'status':_0x12a4b2[_0x5f1c88(0x136)],'createdAt':_0x12a4b2[_0x5f1c88(0x1b5)]};}),'pagination':{'page':_0x203e93,'limit':_0x3faee8,'total':_0x16aaf0,'totalPages':Math[_0x598fe2(0x12c)](_0x16aaf0/_0x3faee8)}};}async['getUserById'](_0x29bba9){const _0x4d42f6=a35_0xc07cbb,_0x2db747=await database_1[_0x4d42f6(0x1a9)]['shop'][_0x4d42f6(0x209)]({'where':{'id':_0x29bba9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2db747)return null;const _0x3b4218=_0x2db747[_0x4d42f6(0x16e)]?JSON[_0x4d42f6(0x180)](_0x2db747[_0x4d42f6(0x16e)]):null,_0xb32c9e=_0x3b4218?_0x3b4218[_0x4d42f6(0xff)](_0x41dfd6=>this[_0x4d42f6(0x1e3)](_0x41dfd6)):null;return _0x3b4218&&_0xb32c9e&&console[_0x4d42f6(0x151)]('🔄\x20Gateway\x20mapping\x20(get):',_0x3b4218,'->',_0xb32c9e),{'id':_0x2db747['id'],'fullName':_0x2db747[_0x4d42f6(0x17b)],'username':_0x2db747[_0x4d42f6(0x1af)],'telegramId':_0x2db747['telegram'],'merchantUrl':_0x2db747['shopUrl'],'gateways':_0xb32c9e,'gatewaySettings':_0x2db747[_0x4d42f6(0x1be)]?JSON['parse'](_0x2db747[_0x4d42f6(0x1be)]):null,'publicKey':_0x2db747[_0x4d42f6(0x165)],'wallets':{'usdtPolygonWallet':_0x2db747['usdtPolygonWallet'],'usdtTrcWallet':_0x2db747[_0x4d42f6(0x1d7)],'usdtErcWallet':_0x2db747['usdtErcWallet'],'usdcPolygonWallet':_0x2db747['usdcPolygonWallet']},'status':_0x2db747[_0x4d42f6(0x136)],'createdAt':_0x2db747['createdAt']};}async['createUser'](_0x5c4e48){const _0x3d94f0=a35_0xc07cbb,{fullName:_0x57bd41,username:_0x1b3464,password:_0x30805d,telegramId:_0x322d63,merchantUrl:_0x11b06a,gateways:_0x345bd9,gatewaySettings:_0x420880,wallets:_0x2fd1ff}=_0x5c4e48,_0x219992=await database_1[_0x3d94f0(0x1a9)][_0x3d94f0(0x1c1)][_0x3d94f0(0x209)]({'where':{'username':_0x1b3464}});if(_0x219992)throw new Error(_0x3d94f0(0x13c));if(_0x322d63){const _0x2027ea=await database_1[_0x3d94f0(0x1a9)]['shop'][_0x3d94f0(0x209)]({'where':{'telegram':_0x322d63}});if(_0x2027ea)throw new Error(_0x3d94f0(0x1f8));}const _0x588360=await bcryptjs_1[_0x3d94f0(0x1a9)][_0x3d94f0(0x1ef)](_0x30805d,0xc),_0x5d3b19=_0x3d94f0(0x1c8)+crypto_1[_0x3d94f0(0x1a9)][_0x3d94f0(0x224)](0x20)[_0x3d94f0(0x1ba)](_0x3d94f0(0x211)),_0x3452f9=_0x3d94f0(0x1a0)+crypto_1[_0x3d94f0(0x1a9)][_0x3d94f0(0x224)](0x20)[_0x3d94f0(0x1ba)]('hex'),_0xe767fe=_0x345bd9?_0x345bd9[_0x3d94f0(0xff)](_0x2db236=>this[_0x3d94f0(0x226)](_0x2db236)):null;_0x345bd9&&_0xe767fe&&console[_0x3d94f0(0x151)](_0x3d94f0(0x144),_0x345bd9,'->',_0xe767fe);const _0x8f7996=await database_1[_0x3d94f0(0x1a9)][_0x3d94f0(0x1c1)]['create']({'data':{'name':_0x57bd41,'username':_0x1b3464,'password':_0x588360,'telegram':_0x322d63,'shopUrl':_0x11b06a,'paymentGateways':_0xe767fe?JSON[_0x3d94f0(0x217)](_0xe767fe):null,'gatewaySettings':_0x420880?JSON[_0x3d94f0(0x217)](_0x420880):null,'usdtPolygonWallet':_0x2fd1ff?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x2fd1ff?.['usdtTrcWallet']||null,'usdtErcWallet':_0x2fd1ff?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x2fd1ff?.[_0x3d94f0(0x1ce)]||null,'publicKey':_0x5d3b19,'secretKey':_0x3452f9,'status':_0x3d94f0(0x129)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x8f7996['id'],'fullName':_0x8f7996[_0x3d94f0(0x17b)],'username':_0x8f7996[_0x3d94f0(0x1af)],'telegramId':_0x8f7996[_0x3d94f0(0x12f)],'merchantUrl':_0x8f7996['shopUrl'],'gateways':_0x8f7996[_0x3d94f0(0x16e)]?JSON['parse'](_0x8f7996[_0x3d94f0(0x16e)]):null,'gatewaySettings':_0x8f7996[_0x3d94f0(0x1be)]?JSON[_0x3d94f0(0x180)](_0x8f7996[_0x3d94f0(0x1be)]):null,'publicKey':_0x8f7996[_0x3d94f0(0x165)],'wallets':{'usdtPolygonWallet':_0x8f7996[_0x3d94f0(0x1ac)],'usdtTrcWallet':_0x8f7996[_0x3d94f0(0x1d7)],'usdtErcWallet':_0x8f7996['usdtErcWallet'],'usdcPolygonWallet':_0x8f7996['usdcPolygonWallet']},'status':_0x8f7996[_0x3d94f0(0x136)],'createdAt':_0x8f7996['createdAt']};}async[a35_0xc07cbb(0x221)](_0x135c25){const _0x1e486f=a35_0xc07cbb;await database_1[_0x1e486f(0x1a9)][_0x1e486f(0x1c1)][_0x1e486f(0x15c)]({'where':{'id':_0x135c25}});}[a35_0xc07cbb(0x1bf)](_0x218399,_0x17204b,_0x3c8292){const _0x26bc70=a35_0xc07cbb,_0x12d653=new Map(),_0x2cdb0e=new Date(_0x17204b);while(_0x2cdb0e<=_0x3c8292){const _0x312eb3=_0x2cdb0e[_0x26bc70(0x112)]()['split']('T')[0x0];_0x12d653[_0x26bc70(0x122)](_0x312eb3,{'revenue':0x0,'count':0x0}),_0x2cdb0e[_0x26bc70(0x155)](_0x2cdb0e['getDate']()+0x1);}for(const _0x225afb of _0x218399){const _0x105ecd=_0x225afb[_0x26bc70(0x1b5)][_0x26bc70(0x112)]()[_0x26bc70(0xfe)]('T')[0x0],_0x5d097a=_0x12d653['get'](_0x105ecd);_0x5d097a&&(_0x5d097a['count']+=0x1,_0x225afb[_0x26bc70(0x136)]===_0x26bc70(0x14f)&&(_0x225afb[_0x26bc70(0x20b)]?_0x5d097a[_0x26bc70(0x147)]+=_0x225afb[_0x26bc70(0x20b)]:console[_0x26bc70(0x151)](_0x26bc70(0x10b)+_0x225afb['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x4dd1b2=[],_0x2ffcb6=[];for(const [_0x227360,_0x5d08d6]of _0x12d653){_0x4dd1b2[_0x26bc70(0x14a)]({'date':_0x227360,'amount':Math[_0x26bc70(0x227)](_0x5d08d6[_0x26bc70(0x147)]*0x64)/0x64}),_0x2ffcb6[_0x26bc70(0x14a)]({'date':_0x227360,'count':_0x5d08d6[_0x26bc70(0x1a8)]});}return{'dailyRevenue':_0x4dd1b2,'dailyPayments':_0x2ffcb6};}}exports[a35_0xc07cbb(0x18c)]=AdminService;