'use strict';function a38_0x12ec(_0x16a695,_0x15671c){const _0x3b3707=a38_0x3b37();return a38_0x12ec=function(_0x12ec5c,_0x271145){_0x12ec5c=_0x12ec5c-0x8b;let _0x9bcf35=_0x3b3707[_0x12ec5c];return _0x9bcf35;},a38_0x12ec(_0x16a695,_0x15671c);}const a38_0x3dc91a=a38_0x12ec;(function(_0x5cfc46,_0x2237d5){const _0x3fcdca=a38_0x12ec,_0x85fdc1=_0x5cfc46();while(!![]){try{const _0x2229ea=-parseInt(_0x3fcdca(0x11a))/0x1+parseInt(_0x3fcdca(0xec))/0x2*(parseInt(_0x3fcdca(0x178))/0x3)+-parseInt(_0x3fcdca(0x19e))/0x4+-parseInt(_0x3fcdca(0x1b4))/0x5*(-parseInt(_0x3fcdca(0xe9))/0x6)+-parseInt(_0x3fcdca(0x9c))/0x7+parseInt(_0x3fcdca(0x1b0))/0x8*(-parseInt(_0x3fcdca(0xeb))/0x9)+-parseInt(_0x3fcdca(0x157))/0xa*(-parseInt(_0x3fcdca(0xdb))/0xb);if(_0x2229ea===_0x2237d5)break;else _0x85fdc1['push'](_0x85fdc1['shift']());}catch(_0x5b76fe){_0x85fdc1['push'](_0x85fdc1['shift']());}}}(a38_0x3b37,0x572ac));var __importDefault=this&&this[a38_0x3dc91a(0x9a)]||function(_0x29ca33){const _0x1f05e0=a38_0x3dc91a;return _0x29ca33&&_0x29ca33[_0x1f05e0(0x1a5)]?_0x29ca33:{'default':_0x29ca33};};Object['defineProperty'](exports,a38_0x3dc91a(0x1a5),{'value':!![]}),exports[a38_0x3dc91a(0x152)]=void 0x0;const database_1=__importDefault(require(a38_0x3dc91a(0x18a))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a38_0x3dc91a(0x193))),currencyService_1=require('./currencyService'),gateway_1=require('../types/gateway');function a38_0x3b37(){const _0x1fba1a=['getUserById','gateway','232790JHzUrn','all','\x20\x20\x20🌐\x20IP:\x20','failureMessage','createUser','💱\x20Currency\x20filter\x20applied:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','📊\x20Payout\x20statistics\x20calculated:','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20payments)','revenue','\x20\x20\x20Payout\x20amount:\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','default','2020-01-01','aggregate','findFirst','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','error','📊\x20Calculating\x20payout\x20statistics...','🔄\x20Admin\x20updating\x20payment\x20','Plisio','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','usdtPolygonWallet','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','getAllUsers','getGatewayNameById',']\x20Gateway\x20settings\x20JSON\x20string:','\x20\x20\x20📅\x20This\x20month:\x20','currencyService','🔄\x20Converted\x20gateway\x20name\x20\x27','3WUnOdF','90d','log','\x20no\x20longer\x20PAID:','whiteUrl','dailyRevenue','paidOutUSDT','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','\x27\x20->\x20ID\x20\x27','status','💰\x20[PAYOUT]\x20Merchant\x20','not\x20set','dateTo','\x20\x20\x20Merchant\x20loses:\x20','hash','\x20\x20\x20🤔\x20Difference:\x20','$transaction','random','../config/database','paidAt','turnover',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','💰\x20Found\x20','📊\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20💸\x20Total\x20payouts:\x20','totalPayments','💰\x20Payment\x20','crypto','notes','setDate','payment','⚠️\x20Gateway\x20\x27','\x20\x20\x20🌍\x20Country:\x20','getMerchantStatistics','getTime','averageCheckUSDT','totalTurnover','\x20\x20\x20Total\x20paid\x20out:\x20','2706920jyebry','gateways','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','substr','totalCommissionRate','\x20USDT\x20(actual\x20balances)','💸\x20CHARGEBACK\x20penalty:\x20-','__esModule','lte','paymentsCount','join','shop','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20USDT\x20(-','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20\x20\x20Transaction\x20hash:\x20','asc','🔄\x20Gateway\x20mapping\x20(get):','616UaOVGx','Insufficient\x20balance.\x20Available:\x20','deleteUser','\x20USDT\x20(same\x20as\x20awaiting)','5IEXLtt','Shop\x20not\x20found','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','statusChangedAt','week','\x20USDT\x20(total\x20paid\x20to\x20merchants)','toISOString','getAllPayments','\x27\x20->\x20name\x20\x27','fullName','update','\x20paid\x20payments\x20for\x20analysis','\x20\x20\x20💰\x20Total\x20turnover:\x20','getMerchantsSelection','merchantUrl','adminNotes','pendingPayout','periodTo','⚠️\x20Payment\x20','COMPLETED','\x20balance\x20updated:\x20','_count','getSystemStatistics','🔐\x20[','count','\x20USDT)','getDate','forEach','ceil','periodFrom','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','dateFrom','getMerchantsAwaitingPayout','toFixed','rapyd','✅\x20Using\x20gateway\x20filter:\x20\x27','gatewayOrderId','paymentGateways','\x20USDT\x20(+','__importDefault','📊\x20Merchant\x20statistics\x20calculated:','2461088fYFuGm','updatedAt','\x20order','commission','network','polygon','🔄\x20Converted\x20gateway\x20ID\x20\x27','usdtErcWallet','gatewaySettings','ACTIVE','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','Noda','toUpperCase','shopUrl','pk_','Test\x20Gateway',',\x20userId:\x20','push','split','%\x20commission)','klyme_eu','customerName','amountAfterGatewayCommissionUSDT','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','toLowerCase','Rapyd','deletePayout','🎯\x20updateUser\x20called\x20with\x20ID:\x20','CoinToPay','plisio','customerIp','warn','year','\x20\x20\x20�📊\x20Total\x20payments:\x20','30d','\x20USDT','shopId','📊\x20Final\x20WHERE\x20conditions:','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','merchantEarnings','\x20balance\x20updated:','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20USDT\x20for\x20payment\x20','some','usdcPolygonWallet','parse','💰\x20Shop\x20','getGatewayDisplayName','amount','📊\x20Sorting\x20payments\x20by\x20','%\x20from\x20','includes','entries','📊\x20Available\x20gateways\x20in\x20database:','gte','\x20status:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','💰\x20[PAYOUT]\x20Gateway\x20','cointopay',',\x20Commission:\x20','balance','📅\x20Period:\x20','\x20USDT,\x20merchant:\x20','671zCKStW','REFUND','\x20USDT\x20(after\x20','stringify','amountUSDT','desc','gatewayEarnings','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','getGatewayInternalName','KLYME\x20GB','📊\x20Total\x20payments\x20(including\x20failed):\x20','delete','updateUser','findUnique','1147146ldMukV','sk_','10701InCWUo','196838lmkShu','klyme_gb','updateCustomerData','\x20PAID\x20payments','publicKey','dailyPayments','CHARGEBACK','totalAmountUSDT','\x20\x20\x20Added\x20to\x20balance:\x20+','custom','getPayoutById',']\x20Updating\x20password\x20for\x20user\x20',',\x20successful:\x20','customerUa','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','toString','\x20USDT\x20(theoretical\x20net)','date','customerCountry','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','🔍\x20Using\x20gateway\x20\x27','\x20USDT\x20(gross\x20revenue)','period','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','turnoverUSDT','thisMonth','currency','convertToUSDT','cointopay2','availableBalance','setHours','telegram','getGatewayIdByName','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','erc20','\x20->\x20','polygon_usdc','getMonth','\x20USDT\x20(','\x20\x20\x20Full\x20amount:\x20','createdAt','getPayoutStats','usdtTrcWallet','MasterCard',']\x20Gateway\x20settings\x20before\x20saving:','PAID','232726kXpoIv','📋\x20Found\x20','name','NONEXISTENT_GATEWAY_FILTER','map','set','txid','averageCommissionRate','round','test_gateway','yesterday','_sum','values','groupBy','🔄\x20Gateway\x20mapping:','month','\x20for\x20shop\x20','PENDING','SUSPENDED','orderId','\x27\x20(from\x20\x27','gatewayCommissionRate','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','\x20USDT,\x20Requested:\x20','password','randomBytes','telegramId','create','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','getFullYear','chargebackAmount','Payment\x20not\x20found','reduce','commissionUSDT','createPayout','\x20USDT\x20(current\x20balance\x20in\x20DB)','totalPayout','payout','getPaymentById','klyme_de','wallets','findMany','trc20','suspendUser','🔧\x20[','\x20\x20\x20Gateway:\x20','\x20\x20\x20Merchant\x20gets:\x20','💰\x20Current\x20shop\x20balance:\x20','length','username','merchantEarningsUSDT','localeCompare','totalPaidOut','\x20USDT\x20(already\x20paid\x20out)','💳\x20Payout\x20wallet\x20for\x20','\x20\x20\x20Balance:\x20','AdminService','Username\x20already\x20exists','insensitive'];a38_0x3b37=function(){return _0x1fba1a;};return a38_0x3b37();}class AdminService{async[a38_0x3dc91a(0x115)](){const _0x153727=a38_0x3dc91a;console[_0x153727(0x17a)](_0x153727(0x16a));const _0x4647ff=await database_1[_0x153727(0x164)][_0x153727(0x1a9)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x153727(0xa5)}}),_0x14a7bf=await database_1['default'][_0x153727(0x196)]['count']({'where':{'status':'PAID','gateway':{'not':_0x153727(0x123)}}}),_0x5b875c=new Date(),_0x1c78c5=new Date(_0x5b875c['getFullYear'](),_0x5b875c['getMonth'](),0x1),_0xcba71b=new Date(_0x5b875c[_0x153727(0x137)](),_0x5b875c['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2b354e=await database_1[_0x153727(0x164)][_0x153727(0x13f)][_0x153727(0x166)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1c78c5,'lte':_0xcba71b},'status':'COMPLETED'}}),_0x1cfbc9=_0x4647ff[_0x153727(0x125)][_0x153727(0x14e)]||0x0,_0x27cd3d=_0x4647ff['_sum'][_0x153727(0xd8)]||0x0,_0x416db5=_0x2b354e[_0x153727(0x125)]['amount']||0x0,_0x1bad13={'totalPayout':Math[_0x153727(0x122)](_0x1cfbc9*0x64)/0x64,'awaitingPayout':Math[_0x153727(0x122)](_0x27cd3d*0x64)/0x64,'thisMonth':Math['round'](_0x416db5*0x64)/0x64,'availableBalance':Math['round'](_0x27cd3d*0x64)/0x64,'totalPayments':_0x14a7bf};return console['log'](_0x153727(0x15e)),console['log'](_0x153727(0xc5)+_0x1bad13['totalPayout']+_0x153727(0x1b9)),console[_0x153727(0x17a)](_0x153727(0xb3)+_0x1bad13['awaitingPayout']+_0x153727(0xff)),console[_0x153727(0x17a)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x1bad13[_0x153727(0x109)]+_0x153727(0x1b3)),console[_0x153727(0x17a)](_0x153727(0x175)+_0x1bad13['thisMonth']+_0x153727(0xbf)),console['log'](_0x153727(0x1ac)+_0x1bad13[_0x153727(0x191)]+_0x153727(0xef)),_0x1bad13;}async[a38_0x3dc91a(0xee)](_0x59b6c2,_0x3e2605){const _0x4de7b7=a38_0x3dc91a;console[_0x4de7b7(0x17a)](_0x4de7b7(0x91)+_0x59b6c2+':',_0x3e2605);const _0x1471c3=await database_1[_0x4de7b7(0x164)][_0x4de7b7(0x196)][_0x4de7b7(0xe8)]({'where':{'id':_0x59b6c2},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1471c3)throw new Error(_0x4de7b7(0x139));const _0x31efa9={};_0x3e2605['customerCountry']!==undefined&&(_0x31efa9[_0x4de7b7(0xfe)]=_0x3e2605['customerCountry']||null);_0x3e2605['customerIp']!==undefined&&(_0x31efa9['customerIp']=_0x3e2605[_0x4de7b7(0xba)]||null);_0x3e2605[_0x4de7b7(0xf9)]!==undefined&&(_0x31efa9[_0x4de7b7(0xf9)]=_0x3e2605[_0x4de7b7(0xf9)]||null);const _0x2a3cc3=await database_1['default'][_0x4de7b7(0x196)][_0x4de7b7(0x1be)]({'where':{'id':_0x59b6c2},'data':{..._0x31efa9,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x4de7b7(0x17a)](_0x4de7b7(0xfa)+_0x59b6c2),console[_0x4de7b7(0x17a)](_0x4de7b7(0x198)+_0x1471c3['customerCountry']+'\x20->\x20'+_0x2a3cc3['customerCountry']),console['log'](_0x4de7b7(0x159)+_0x1471c3[_0x4de7b7(0xba)]+_0x4de7b7(0x10f)+_0x2a3cc3[_0x4de7b7(0xba)]),console[_0x4de7b7(0x17a)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x1471c3['customerUa']?'set':_0x4de7b7(0x183))+_0x4de7b7(0x10f)+(_0x2a3cc3[_0x4de7b7(0xf9)]?'set':_0x4de7b7(0x183))),_0x2a3cc3;}async[a38_0x3dc91a(0x1ca)](_0x3caf0f){const _0x4f1a7e=a38_0x3dc91a,_0x495601=new Date();let _0xde535;switch(_0x3caf0f[_0x4f1a7e(0xb4)]()){case'day':_0xde535=new Date(_0x495601['getFullYear'](),_0x495601[_0x4f1a7e(0x111)](),_0x495601[_0x4f1a7e(0x8d)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x1b8714=new Date(_0x495601);_0x1b8714[_0x4f1a7e(0x195)](_0x1b8714[_0x4f1a7e(0x8d)]()-0x1),_0xde535=new Date(_0x1b8714[_0x4f1a7e(0x137)](),_0x1b8714[_0x4f1a7e(0x111)](),_0x1b8714[_0x4f1a7e(0x8d)](),0x0,0x0,0x0,0x0);break;case'7d':_0xde535=new Date(_0x495601['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4f1a7e(0xbe):_0xde535=new Date(_0x495601['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4f1a7e(0x179):_0xde535=new Date(_0x495601['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4f1a7e(0x158):const _0x435cc3=await database_1['default'][_0x4f1a7e(0x196)][_0x4f1a7e(0x167)]({'where':{'gateway':{'not':_0x4f1a7e(0x123)}},'orderBy':{'createdAt':_0x4f1a7e(0x1ae)},'select':{'createdAt':!![]}});_0xde535=_0x435cc3?_0x435cc3['createdAt']:new Date(_0x4f1a7e(0x165));break;default:_0xde535=new Date(_0x495601[_0x4f1a7e(0x19a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0xde535[_0x4f1a7e(0x10a)](0x0,0x0,0x0,0x0);let _0x5e5402;if(_0x3caf0f[_0x4f1a7e(0xb4)]()===_0x4f1a7e(0x124)){const _0x55427a=new Date(_0x495601);_0x55427a[_0x4f1a7e(0x195)](_0x55427a[_0x4f1a7e(0x8d)]()-0x1),_0x5e5402=new Date(_0x55427a[_0x4f1a7e(0x137)](),_0x55427a[_0x4f1a7e(0x111)](),_0x55427a[_0x4f1a7e(0x8d)](),0x17,0x3b,0x3b,0x3e7);}const _0x516648={'gte':_0xde535};_0x5e5402&&(_0x516648[_0x4f1a7e(0x1a6)]=_0x5e5402);const [_0x2dc12e,_0x3c1d3b,_0x5706f2,_0x4f1c7a,_0x2b2b75,_0x54f2f0]=await Promise[_0x4f1a7e(0x158)]([database_1[_0x4f1a7e(0x164)][_0x4f1a7e(0x1a9)][_0x4f1a7e(0x8b)](),database_1[_0x4f1a7e(0x164)][_0x4f1a7e(0x1a9)][_0x4f1a7e(0x8b)]({'where':{'status':_0x4f1a7e(0xa5)}}),database_1[_0x4f1a7e(0x164)][_0x4f1a7e(0x196)][_0x4f1a7e(0x8b)]({'where':{'status':_0x4f1a7e(0x119),'createdAt':_0x516648,'gateway':{'not':'test_gateway'}}}),database_1['default']['payment'][_0x4f1a7e(0x143)]({'where':{'status':_0x4f1a7e(0x119),'createdAt':_0x516648,'gateway':{'not':_0x4f1a7e(0x123)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4f1a7e(0x164)][_0x4f1a7e(0x196)][_0x4f1a7e(0x143)]({'where':{'gateway':{'not':_0x4f1a7e(0x123)}},'take':0xa,'orderBy':{'createdAt':_0x4f1a7e(0xe0)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4f1a7e(0x164)][_0x4f1a7e(0x196)]['findMany']({'where':{'createdAt':_0x516648,'gateway':{'not':_0x4f1a7e(0x123)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x511e2b=0x0,_0x83483f=0x0;for(const _0x2f8db9 of _0x4f1c7a){const _0x1025ff=await currencyService_1[_0x4f1a7e(0x176)]['convertToUSDT'](_0x2f8db9[_0x4f1a7e(0xcc)],_0x2f8db9[_0x4f1a7e(0x106)]);_0x511e2b+=_0x1025ff;if(_0x2f8db9['amountAfterGatewayCommissionUSDT']){const _0x5c6fac=await currencyService_1['currencyService']['convertToUSDT'](_0x2f8db9['amount'],_0x2f8db9['currency']),_0x1806d6=_0x2f8db9['amountAfterGatewayCommissionUSDT'],_0x4b2768=_0x5c6fac-_0x1806d6;_0x83483f+=_0x4b2768;}}const _0x53dd51=_0x5706f2>0x0?_0x511e2b/_0x5706f2:0x0,_0x750091=this['generateDailyStatistics'](_0x54f2f0,_0xde535,_0x5e5402||_0x495601),_0xb0c577=await database_1[_0x4f1a7e(0x164)][_0x4f1a7e(0x196)][_0x4f1a7e(0x8b)]({'where':{'createdAt':_0x516648,'gateway':{'not':_0x4f1a7e(0x123)}}}),_0x8b1a0e=_0xb0c577>0x0?_0x5706f2/_0xb0c577*0x64:0x0;return{'totalShops':_0x2dc12e,'activeShops':_0x3c1d3b,'totalPayments':_0x5706f2,'successfulPayments':_0x5706f2,'totalAttempts':_0xb0c577,'totalRevenue':Math[_0x4f1a7e(0x122)](_0x511e2b*0x64)/0x64,'trapayEarnings':Math[_0x4f1a7e(0x122)](_0x83483f*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x53dd51*0x64)/0x64,'conversionRate':Math['round'](_0x8b1a0e*0x64)/0x64,'dailyRevenue':_0x750091[_0x4f1a7e(0x17d)],'dailyPayments':_0x750091[_0x4f1a7e(0xf1)],'recentPayments':_0x2b2b75[_0x4f1a7e(0x11e)](_0x31064a=>({'id':_0x31064a['id'],'amount':_0x31064a[_0x4f1a7e(0xcc)],'currency':_0x31064a[_0x4f1a7e(0x106)],'status':_0x31064a[_0x4f1a7e(0x181)],'gateway':_0x31064a[_0x4f1a7e(0x156)],'shop':_0x31064a['shop'],'createdAt':_0x31064a[_0x4f1a7e(0x114)]}))};}async[a38_0x3dc91a(0x199)](_0x1328d0){const _0x40b150=a38_0x3dc91a;console[_0x40b150(0x17a)](_0x40b150(0x170),_0x1328d0);let _0x2f00ae,_0x53f36a=new Date();if(_0x1328d0['period']===_0x40b150(0xf5)&&_0x1328d0[_0x40b150(0x92)]&&_0x1328d0[_0x40b150(0x184)])_0x2f00ae=new Date(_0x1328d0['dateFrom']),_0x53f36a=new Date(_0x1328d0['dateTo']),_0x2f00ae[_0x40b150(0x10a)](0x0,0x0,0x0,0x0),_0x53f36a[_0x40b150(0x10a)](0x17,0x3b,0x3b,0x3e7);else{const _0x3a56df=new Date();switch(_0x1328d0[_0x40b150(0x102)]){case _0x40b150(0x1b8):_0x2f00ae=new Date(_0x3a56df[_0x40b150(0x19a)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x40b150(0x129):_0x2f00ae=new Date(_0x3a56df[_0x40b150(0x19a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x40b150(0xbc):_0x2f00ae=new Date(_0x3a56df['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x40b150(0x158):default:_0x2f00ae=new Date(_0x40b150(0x165));break;}_0x2f00ae[_0x40b150(0x10a)](0x0,0x0,0x0,0x0),_0x53f36a[_0x40b150(0x10a)](0x17,0x3b,0x3b,0x3e7);}console['log'](_0x40b150(0xd9)+_0x2f00ae[_0x40b150(0x1ba)]()+'\x20to\x20'+_0x53f36a[_0x40b150(0x1ba)]());const _0x36d073={'status':_0x40b150(0x119),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x2f00ae,'lte':_0x53f36a}};_0x1328d0[_0x40b150(0xc0)]&&(_0x36d073[_0x40b150(0xc0)]=_0x1328d0[_0x40b150(0xc0)]);const _0x3b3dce=await database_1[_0x40b150(0x164)][_0x40b150(0x196)][_0x40b150(0x143)]({'where':_0x36d073,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x40b150(0x18e)+_0x3b3dce[_0x40b150(0x14a)]+_0x40b150(0x1bf));const _0xb29da4={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x2f00ae,'lte':_0x53f36a}};_0x1328d0['shopId']&&(_0xb29da4[_0x40b150(0xc0)]=_0x1328d0[_0x40b150(0xc0)]);const _0x4e255b=await database_1[_0x40b150(0x164)][_0x40b150(0x196)][_0x40b150(0x8b)]({'where':_0xb29da4});console[_0x40b150(0x17a)](_0x40b150(0xe5)+_0x4e255b+_0x40b150(0xf8)+_0x3b3dce[_0x40b150(0x14a)]);let _0x5c3f9b=0x0,_0x2b5e56=0x0,_0x33560f=0x0;const _0x3a1d66={},_0x49aca7={},_0x4a0878={};for(const _0x373894 of _0x3b3dce){try{const _0x1d970a=_0x373894[_0x40b150(0xdf)]||0x0;if(_0x1d970a<=0x0){console[_0x40b150(0xbb)](_0x40b150(0x1c6)+_0x373894['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x121758,_0x320700;if(_0x373894[_0x40b150(0xb2)]!==null&&_0x373894[_0x40b150(0xb2)]!==undefined)_0x121758=_0x373894[_0x40b150(0xb2)],_0x320700=_0x1d970a-_0x121758,console[_0x40b150(0x17a)](_0x40b150(0x17f)+_0x373894['id']+':\x20'+_0x1d970a[_0x40b150(0x94)](0x6)+_0x40b150(0xda)+_0x121758[_0x40b150(0x94)](0x6)+_0x40b150(0xbf));else{let _0x9f82e={};if(_0x373894[_0x40b150(0x1a9)]['gatewaySettings'])try{_0x9f82e=JSON[_0x40b150(0xc9)](_0x373894[_0x40b150(0x1a9)][_0x40b150(0xa4)]);}catch(_0xbddf7c){console['error'](_0x40b150(0x168)+_0x373894[_0x40b150(0xc0)]+':',_0xbddf7c);}let _0x3bf33b=0x2d;for(const [_0x367d51,_0x52dc8d]of Object[_0x40b150(0xd0)](_0x9f82e)){if(_0x367d51['toLowerCase']()===_0x373894[_0x40b150(0x156)][_0x40b150(0xb4)]()){_0x3bf33b=_0x52dc8d[_0x40b150(0x9f)]||0x2d;break;}}_0x320700=_0x1d970a*(_0x3bf33b/0x64),_0x121758=_0x1d970a-_0x320700,console[_0x40b150(0x17a)](_0x40b150(0xa6)+_0x373894['id']+':\x20'+_0x3bf33b+_0x40b150(0xce)+_0x1d970a[_0x40b150(0x94)](0x6)+_0x40b150(0xbf));}_0x5c3f9b+=_0x1d970a,_0x2b5e56+=_0x121758,_0x33560f+=_0x320700;let _0x303a54;_0x373894['gatewayCommissionRate']!==null&&_0x373894[_0x40b150(0x12f)]!==undefined?(_0x303a54=_0x373894['gatewayCommissionRate'],console[_0x40b150(0x17a)](_0x40b150(0xe2)+_0x373894['id']+':\x20'+_0x303a54+'%')):(_0x303a54=_0x1d970a>0x0?_0x320700/_0x1d970a*0x64:0x0,console['log']('📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x373894['id']+':\x20'+_0x303a54[_0x40b150(0x94)](0x2)+'%'));!_0x3a1d66[_0x373894[_0x40b150(0x156)]]&&(_0x3a1d66[_0x373894[_0x40b150(0x156)]]={'gateway':_0x373894['gateway'],'gatewayDisplayName':this[_0x40b150(0xcb)](_0x373894[_0x40b150(0x156)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3a1d66[_0x373894[_0x40b150(0x156)]][_0x40b150(0x1a7)]++,_0x3a1d66[_0x373894[_0x40b150(0x156)]][_0x40b150(0x104)]+=_0x1d970a,_0x3a1d66[_0x373894[_0x40b150(0x156)]][_0x40b150(0x13b)]+=_0x320700,_0x3a1d66[_0x373894[_0x40b150(0x156)]][_0x40b150(0x14c)]+=_0x121758,_0x3a1d66[_0x373894['gateway']][_0x40b150(0x1a2)]+=_0x303a54;!_0x1328d0['shopId']&&(!_0x49aca7[_0x373894[_0x40b150(0xc0)]]&&(_0x49aca7[_0x373894[_0x40b150(0xc0)]]={'shopId':_0x373894[_0x40b150(0xc0)],'shopName':_0x373894['shop'][_0x40b150(0x11c)],'shopUsername':_0x373894[_0x40b150(0x1a9)][_0x40b150(0x14b)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x49aca7[_0x373894[_0x40b150(0xc0)]][_0x40b150(0x1a7)]++,_0x49aca7[_0x373894[_0x40b150(0xc0)]][_0x40b150(0x104)]+=_0x1d970a,_0x49aca7[_0x373894[_0x40b150(0xc0)]]['commissionUSDT']+=_0x320700,_0x49aca7[_0x373894[_0x40b150(0xc0)]][_0x40b150(0x14c)]+=_0x121758);const _0x4be8e0=_0x373894['paidAt']['toISOString']()['split']('T')[0x0];!_0x4a0878[_0x4be8e0]&&(_0x4a0878[_0x4be8e0]={'date':_0x4be8e0,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4a0878[_0x4be8e0][_0x40b150(0x18c)]+=_0x1d970a,_0x4a0878[_0x4be8e0][_0x40b150(0xc3)]+=_0x121758,_0x4a0878[_0x4be8e0][_0x40b150(0xe1)]+=_0x320700,_0x4a0878[_0x4be8e0]['paymentsCount']++;}catch(_0x1b063a){console[_0x40b150(0x169)]('Error\x20processing\x20payment\x20'+_0x373894['id']+':',_0x1b063a);}}Object[_0x40b150(0x126)](_0x3a1d66)[_0x40b150(0x8e)](_0xad18c3=>{const _0x46634=_0x40b150;_0xad18c3[_0x46634(0x121)]=_0xad18c3['paymentsCount']>0x0?_0xad18c3[_0x46634(0x1a2)]/_0xad18c3[_0x46634(0x1a7)]:0x0,delete _0xad18c3[_0x46634(0x1a2)];}),Object[_0x40b150(0x126)](_0x49aca7)[_0x40b150(0x8e)](_0x44fcea=>{const _0x4398ff=_0x40b150;_0x44fcea[_0x4398ff(0x19b)]=_0x44fcea[_0x4398ff(0x1a7)]>0x0?_0x44fcea[_0x4398ff(0x104)]/_0x44fcea[_0x4398ff(0x1a7)]:0x0;});let _0x40a033=0x0,_0x346be1=0x0;if(_0x1328d0[_0x40b150(0xc0)]){const _0x5d5cf1=await database_1[_0x40b150(0x164)][_0x40b150(0x13f)][_0x40b150(0x143)]({'where':{'shopId':_0x1328d0[_0x40b150(0xc0)],'status':_0x40b150(0x1c7),'createdAt':{'gte':_0x2f00ae,'lte':_0x53f36a}},'select':{'amount':!![]}});_0x40a033=_0x5d5cf1[_0x40b150(0x13a)]((_0x21b1cc,_0x241894)=>_0x21b1cc+_0x241894['amount'],0x0);const _0x2685c6=await database_1[_0x40b150(0x164)]['payout']['findMany']({'where':{'shopId':_0x1328d0[_0x40b150(0xc0)],'status':_0x40b150(0x12b),'createdAt':{'gte':_0x2f00ae,'lte':_0x53f36a}},'select':{'amount':!![]}});_0x346be1=_0x2685c6[_0x40b150(0x13a)]((_0x1503c9,_0x29f5d4)=>_0x1503c9+_0x29f5d4['amount'],0x0);}const _0x22b061=_0x4e255b,_0x124400=_0x3b3dce['length'],_0x36e098=_0x124400>0x0?_0x5c3f9b/_0x124400:0x0,_0x217120=_0x22b061>0x0?Math['round'](_0x124400/_0x22b061*0x2710)/0x64:0x0,_0x16be82=Math[_0x40b150(0x8f)]((_0x53f36a['getTime']()-_0x2f00ae[_0x40b150(0x19a)]())/(0x3e8*0x3c*0x3c*0x18)),_0x24d972={'totalTurnover':Math['round'](_0x5c3f9b*0x64)/0x64,'merchantEarnings':Math[_0x40b150(0x122)](_0x2b5e56*0x64)/0x64,'gatewayEarnings':Math['round'](_0x33560f*0x64)/0x64,'totalPaidOut':Math[_0x40b150(0x122)](_0x40a033*0x64)/0x64,'pendingPayout':Math[_0x40b150(0x122)](_0x346be1*0x64)/0x64,'averageCheck':Math[_0x40b150(0x122)](_0x36e098*0x64)/0x64,'totalPayments':_0x22b061,'successfulPayments':_0x124400,'conversionRate':_0x217120,'gatewayBreakdown':Object[_0x40b150(0x126)](_0x3a1d66)[_0x40b150(0x11e)](_0x32b6ec=>({..._0x32b6ec,'turnoverUSDT':Math[_0x40b150(0x122)](_0x32b6ec[_0x40b150(0x104)]*0x64)/0x64,'commissionUSDT':Math[_0x40b150(0x122)](_0x32b6ec[_0x40b150(0x13b)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x40b150(0x122)](_0x32b6ec[_0x40b150(0x14c)]*0x64)/0x64,'averageCommissionRate':Math[_0x40b150(0x122)](_0x32b6ec[_0x40b150(0x121)]*0x64)/0x64})),'merchantBreakdown':_0x1328d0[_0x40b150(0xc0)]?undefined:Object[_0x40b150(0x126)](_0x49aca7)[_0x40b150(0x11e)](_0x105ebf=>({..._0x105ebf,'turnoverUSDT':Math[_0x40b150(0x122)](_0x105ebf[_0x40b150(0x104)]*0x64)/0x64,'commissionUSDT':Math[_0x40b150(0x122)](_0x105ebf['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x105ebf[_0x40b150(0x14c)]*0x64)/0x64,'paidOutUSDT':Math[_0x40b150(0x122)](_0x105ebf[_0x40b150(0x17e)]*0x64)/0x64,'averageCheckUSDT':Math[_0x40b150(0x122)](_0x105ebf[_0x40b150(0x19b)]*0x64)/0x64})),'dailyData':Object[_0x40b150(0x126)](_0x4a0878)['map'](_0x182653=>({..._0x182653,'turnover':Math[_0x40b150(0x122)](_0x182653['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x40b150(0x122)](_0x182653[_0x40b150(0xc3)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x182653[_0x40b150(0xe1)]*0x64)/0x64}))['sort']((_0x3b91f9,_0x5c5a15)=>_0x3b91f9[_0x40b150(0xfd)][_0x40b150(0x14d)](_0x5c5a15[_0x40b150(0xfd)])),'periodInfo':{'from':_0x2f00ae,'to':_0x53f36a,'periodType':_0x1328d0[_0x40b150(0x102)]||'custom','daysCount':_0x16be82}};return console[_0x40b150(0x17a)](_0x40b150(0x9b)),console[_0x40b150(0x17a)](_0x40b150(0x1c0)+_0x24d972[_0x40b150(0x19c)]+_0x40b150(0xbf)),console[_0x40b150(0x17a)](_0x40b150(0xd4)+_0x24d972[_0x40b150(0xc3)]+'\x20USDT'),console['log'](_0x40b150(0x10d)+_0x24d972[_0x40b150(0xe1)]+_0x40b150(0xbf)),console[_0x40b150(0x17a)](_0x40b150(0x130)+_0x24d972[_0x40b150(0x14e)]+_0x40b150(0xbf)),console['log']('\x20\x20\x20⏳\x20Pending\x20payout:\x20'+_0x24d972[_0x40b150(0x1c4)]+_0x40b150(0xbf)),console[_0x40b150(0x17a)](_0x40b150(0xbd)+_0x24d972['totalPayments']),_0x24d972;}async[a38_0x3dc91a(0x1c1)](){const _0x1fbd34=a38_0x3dc91a;console[_0x1fbd34(0x17a)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x5c7725=await database_1[_0x1fbd34(0x164)][_0x1fbd34(0x1a9)][_0x1fbd34(0x143)]({'where':{'status':_0x1fbd34(0xa5)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1fbd34(0x1ae)}});return console[_0x1fbd34(0x17a)](_0x1fbd34(0x11b)+_0x5c7725[_0x1fbd34(0x14a)]+'\x20active\x20merchants\x20for\x20selection'),_0x5c7725[_0x1fbd34(0x11e)](_0x54a327=>({'id':_0x54a327['id'],'username':_0x54a327[_0x1fbd34(0x14b)],'name':_0x54a327[_0x1fbd34(0x11c)]}));}[a38_0x3dc91a(0xcb)](_0x173135){const _0x1b2ac3=a38_0x3dc91a,_0x336fd2={'test_gateway':_0x1b2ac3(0xab),'plisio':_0x1b2ac3(0x16c),'rapyd':_0x1b2ac3(0xb5),'noda':_0x1b2ac3(0xa7),'cointopay':_0x1b2ac3(0xb8),'cointopay2':'Open\x20Banking\x202','klyme_eu':'KLYME\x20EU','klyme_gb':_0x1b2ac3(0xe4),'klyme_de':'KLYME\x20DE','mastercard':_0x1b2ac3(0x117)};return _0x336fd2[_0x173135]||_0x173135;}[a38_0x3dc91a(0xe3)](_0x41a10c){const _0x2c5ece=a38_0x3dc91a,_0x4f9fcf={'Test\x20Gateway':'test_gateway','Plisio':_0x2c5ece(0xb9),'Rapyd':_0x2c5ece(0x95),'Noda':'noda','CoinToPay':_0x2c5ece(0xd6),'CoinToPay2':_0x2c5ece(0x108),'KLYME\x20EU':_0x2c5ece(0xb0),'KLYME\x20GB':_0x2c5ece(0xed),'KLYME\x20DE':_0x2c5ece(0x141),'MasterCard':'mastercard'};return _0x4f9fcf[_0x41a10c]||_0x41a10c['toLowerCase']();}async[a38_0x3dc91a(0x93)](_0x33101e){const _0x595b3a=a38_0x3dc91a,{page:_0x336d37,limit:_0x3455f1,minAmount:_0x1c4c41,search:_0x1d1803}=_0x33101e,_0x3eb40b=(_0x336d37-0x1)*_0x3455f1;console[_0x595b3a(0x17a)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x33101e);const _0x4c1950={'balance':{'gt':0x0},'status':_0x595b3a(0xa5)};_0x1c4c41&&(_0x4c1950[_0x595b3a(0xd8)][_0x595b3a(0xd2)]=_0x1c4c41);_0x1d1803&&(_0x4c1950[_0x595b3a(0x11c)]={'contains':_0x1d1803,'mode':_0x595b3a(0x154)});const [_0x1406f4,_0x3215ac]=await Promise[_0x595b3a(0x158)]([database_1['default']['shop'][_0x595b3a(0x143)]({'where':_0x4c1950,'skip':_0x3eb40b,'take':_0x3455f1,'orderBy':{'balance':_0x595b3a(0xe0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x595b3a(0x164)]['shop'][_0x595b3a(0x8b)]({'where':_0x4c1950})]);console[_0x595b3a(0x17a)](_0x595b3a(0x18e)+_0x1406f4[_0x595b3a(0x14a)]+'\x20merchants\x20with\x20positive\x20balance');const _0x554cf9=await Promise['all'](_0x1406f4[_0x595b3a(0x11e)](async _0x130fcd=>{const _0x1b048b=_0x595b3a,[_0x28714e,_0x1ab896,_0x5539b2]=await Promise[_0x1b048b(0x158)]([database_1[_0x1b048b(0x164)]['payment'][_0x1b048b(0x8b)]({'where':{'shopId':_0x130fcd['id'],'status':_0x1b048b(0x119),'gateway':{'not':'test_gateway'}}}),database_1[_0x1b048b(0x164)][_0x1b048b(0x196)][_0x1b048b(0x167)]({'where':{'shopId':_0x130fcd['id'],'status':_0x1b048b(0x119),'gateway':{'not':_0x1b048b(0x123)}},'orderBy':{'paidAt':_0x1b048b(0x1ae)},'select':{'paidAt':!![]}}),database_1[_0x1b048b(0x164)][_0x1b048b(0x196)][_0x1b048b(0x127)]({'by':[_0x1b048b(0x156)],'where':{'shopId':_0x130fcd['id'],'status':_0x1b048b(0x119),'gateway':{'not':_0x1b048b(0x123)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xa3da2=new Date(),_0x4b433f=new Date(_0xa3da2['getFullYear'](),_0xa3da2['getMonth'](),0x1),_0xaaaed7=new Date(_0xa3da2['getFullYear'](),_0xa3da2['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x309778,_0x52d9b4]=await Promise[_0x1b048b(0x158)]([database_1[_0x1b048b(0x164)][_0x1b048b(0x13f)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x130fcd['id'],'status':_0x1b048b(0x1c7)}}),database_1['default'][_0x1b048b(0x13f)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x130fcd['id'],'status':_0x1b048b(0x1c7),'createdAt':{'gte':_0x4b433f,'lte':_0xaaaed7}}})]),_0x47b445=_0x309778[_0x1b048b(0x125)][_0x1b048b(0xcc)]||0x0,_0x2938eb=_0x52d9b4[_0x1b048b(0x125)][_0x1b048b(0xcc)]||0x0,_0x502a56=await Promise[_0x1b048b(0x158)](_0x5539b2[_0x1b048b(0x11e)](async _0x1eeaeb=>{const _0x362584=_0x1b048b;let _0xd8f550=0x2d;if(_0x130fcd[_0x362584(0xa4)])try{const _0x5e909a=JSON[_0x362584(0xc9)](_0x130fcd[_0x362584(0xa4)]);for(const [_0x396fdf,_0x690d93]of Object[_0x362584(0xd0)](_0x5e909a)){if(_0x396fdf[_0x362584(0xb4)]()===_0x1eeaeb[_0x362584(0x156)][_0x362584(0xb4)]()){_0xd8f550=_0x690d93[_0x362584(0x9f)]||0xa,console[_0x362584(0x17a)](_0x362584(0xd5)+_0x1eeaeb[_0x362584(0x156)]+_0x362584(0x12a)+_0x130fcd['id']+':\x20commission\x20=\x20'+_0xd8f550+'%');break;}}}catch(_0x1a4477){console[_0x362584(0x169)](_0x362584(0x168)+_0x130fcd['id']+':',_0x1a4477);}const _0x118d53=_0x1eeaeb['_sum']?.['amountUSDT']||0x0,_0x54e68f=_0x118d53*(0x1-_0xd8f550/0x64);return{'gateway':_0x1eeaeb[_0x362584(0x156)],'count':_0x1eeaeb[_0x362584(0x1c9)]?.['id']||0x0,'amountUSDT':Math[_0x362584(0x122)](_0x118d53*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x362584(0x122)](_0x54e68f*0x64)/0x64,'commission':_0xd8f550};})),_0x4dcc49=_0x502a56[_0x1b048b(0x13a)]((_0x4e7425,_0x509c10)=>_0x4e7425+_0x509c10[_0x1b048b(0xdf)],0x0),_0xbb8416=_0x502a56[_0x1b048b(0x13a)]((_0x2b7837,_0x1873f1)=>_0x2b7837+_0x1873f1['amountAfterCommissionUSDT'],0x0),_0x1d7837=_0x130fcd[_0x1b048b(0xd8)];return console[_0x1b048b(0x17a)](_0x1b048b(0x182)+_0x130fcd['username']+':'),console[_0x1b048b(0x17a)](_0x1b048b(0x103)+_0x4dcc49[_0x1b048b(0x94)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x1b048b(0x17a)](_0x1b048b(0x16d)+_0xbb8416[_0x1b048b(0x94)](0x2)+_0x1b048b(0xfc)),console[_0x1b048b(0x17a)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x1d7837[_0x1b048b(0x94)](0x2)+_0x1b048b(0x13d)),console[_0x1b048b(0x17a)](_0x1b048b(0x190)+_0x47b445[_0x1b048b(0x94)](0x2)+_0x1b048b(0x14f)),console['log'](_0x1b048b(0x187)+(_0xbb8416-_0x47b445-_0x1d7837)[_0x1b048b(0x94)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x130fcd['id'],'fullName':_0x130fcd['name'],'username':_0x130fcd[_0x1b048b(0x14b)],'telegramId':_0x130fcd['telegram'],'merchantUrl':_0x130fcd[_0x1b048b(0xa9)],'wallets':{'usdtPolygonWallet':_0x130fcd[_0x1b048b(0x16f)],'usdtTrcWallet':_0x130fcd['usdtTrcWallet'],'usdtErcWallet':_0x130fcd[_0x1b048b(0xa3)],'usdcPolygonWallet':_0x130fcd[_0x1b048b(0xc8)]},'totalAmountUSDT':Math[_0x1b048b(0x122)](_0x4dcc49*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1b048b(0x122)](_0xbb8416*0x64)/0x64,'currentBalance':Math['round'](_0x1d7837*0x64)/0x64,'totalPayout':Math[_0x1b048b(0x122)](_0x47b445*0x64)/0x64,'thisMonth':Math[_0x1b048b(0x122)](_0x2938eb*0x64)/0x64,'paymentsCount':_0x28714e,'oldestPaymentDate':_0x1ab896?.[_0x1b048b(0x18b)]||_0x130fcd['createdAt'],'gatewayBreakdown':_0x502a56};})),_0xd17eba=_0x554cf9[_0x595b3a(0x13a)]((_0x63cda4,_0x2ad51b)=>_0x63cda4+_0x2ad51b[_0x595b3a(0xf3)],0x0),_0x1cc766=_0x554cf9[_0x595b3a(0x13a)]((_0x2e158f,_0x5e9988)=>_0x2e158f+_0x5e9988['totalAmountAfterCommissionUSDT'],0x0),_0x9e6198=_0x554cf9[_0x595b3a(0x13a)]((_0x114f8a,_0xb174ea)=>_0x114f8a+_0xb174ea[_0x595b3a(0x13e)],0x0),_0x390257=_0x554cf9['reduce']((_0x1dc80e,_0x314e9b)=>_0x1dc80e+_0x314e9b[_0x595b3a(0x105)],0x0);return console[_0x595b3a(0x17a)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x3215ac+'\x20merchants'),console[_0x595b3a(0x17a)](_0x595b3a(0x1b6)+Math[_0x595b3a(0x122)](_0xd17eba*0x64)/0x64+_0x595b3a(0x101)),console['log']('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x595b3a(0x122)](_0x1cc766*0x64)/0x64+_0x595b3a(0x1a3)),console[_0x595b3a(0x17a)](_0x595b3a(0x136)+Math['round'](_0x9e6198*0x64)/0x64+'\x20USDT'),console['log']('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x595b3a(0x122)](_0x390257*0x64)/0x64+_0x595b3a(0xbf)),{'merchants':_0x554cf9,'pagination':{'page':_0x336d37,'limit':_0x3455f1,'total':_0x3215ac,'totalPages':Math[_0x595b3a(0x8f)](_0x3215ac/_0x3455f1)},'summary':{'totalMerchants':_0x3215ac,'totalAmountUSDT':Math[_0x595b3a(0x122)](_0xd17eba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1cc766*0x64)/0x64,'totalPayout':Math[_0x595b3a(0x122)](_0x9e6198*0x64)/0x64,'thisMonth':Math[_0x595b3a(0x122)](_0x390257*0x64)/0x64}};}async[a38_0x3dc91a(0x13c)](_0x540ed7){const _0x2f6126=a38_0x3dc91a,{shopId:_0x905dbd,amount:_0xd5c7fc,network:_0x403678,wallet:_0xbc74b4,notes:_0x1ca742,txid:_0x8ed413,periodFrom:_0x40e323,periodTo:_0xa32ee2}=_0x540ed7,_0x3c720e=await database_1['default'][_0x2f6126(0x188)](async _0xbda934=>{const _0x2c16d0=_0x2f6126,_0x323c18=await _0xbda934[_0x2c16d0(0x1a9)]['findUnique']({'where':{'id':_0x905dbd},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x323c18)throw new Error(_0x2c16d0(0x1b5));console[_0x2c16d0(0x17a)](_0x2c16d0(0x163)+_0x323c18[_0x2c16d0(0x14b)]+':'),console[_0x2c16d0(0x17a)]('\x20\x20\x20Current\x20balance:\x20'+_0x323c18['balance']['toFixed'](0x6)+_0x2c16d0(0xbf)),console[_0x2c16d0(0x17a)](_0x2c16d0(0x162)+_0xd5c7fc[_0x2c16d0(0x94)](0x6)+_0x2c16d0(0xbf)),console[_0x2c16d0(0x17a)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x323c18[_0x2c16d0(0x14e)]['toFixed'](0x6)+_0x2c16d0(0xbf));if(_0x8ed413)console[_0x2c16d0(0x17a)](_0x2c16d0(0x1ad)+_0x8ed413);if(_0x323c18['balance']<_0xd5c7fc)throw new Error(_0x2c16d0(0x1b1)+_0x323c18[_0x2c16d0(0xd8)]['toFixed'](0x6)+_0x2c16d0(0x131)+_0xd5c7fc[_0x2c16d0(0x94)](0x6)+_0x2c16d0(0xbf));let _0x1381fa=_0xbc74b4;if(!_0x1381fa){const _0x213efb=await _0xbda934[_0x2c16d0(0x1a9)][_0x2c16d0(0xe8)]({'where':{'id':_0x905dbd},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x213efb)switch(_0x403678){case _0x2c16d0(0xa1):_0x1381fa=_0x213efb[_0x2c16d0(0x16f)]||undefined;break;case _0x2c16d0(0x144):_0x1381fa=_0x213efb[_0x2c16d0(0x116)]||undefined;break;case _0x2c16d0(0x10e):_0x1381fa=_0x213efb[_0x2c16d0(0xa3)]||undefined;break;case _0x2c16d0(0x110):_0x1381fa=_0x213efb[_0x2c16d0(0xc8)]||undefined;break;}}console[_0x2c16d0(0x17a)](_0x2c16d0(0x150)+_0x403678+':\x20'+(_0x1381fa||'not\x20specified'));const _0xfb3bd3=await _0xbda934[_0x2c16d0(0x13f)][_0x2c16d0(0x135)]({'data':{'shopId':_0x905dbd,'amount':_0xd5c7fc,'network':_0x403678,'status':_0x2c16d0(0x1c7),'txid':_0x8ed413,'notes':_0x1ca742,'periodFrom':_0x40e323?new Date(_0x40e323):null,'periodTo':_0xa32ee2?new Date(_0xa32ee2):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4e525d=_0x323c18[_0x2c16d0(0xd8)]-_0xd5c7fc,_0x542287=_0x323c18[_0x2c16d0(0x14e)]+_0xd5c7fc;return await _0xbda934[_0x2c16d0(0x1a9)][_0x2c16d0(0x1be)]({'where':{'id':_0x905dbd},'data':{'balance':_0x4e525d,'totalPaidOut':_0x542287}}),console[_0x2c16d0(0x17a)](_0x2c16d0(0xca)+_0x323c18['username']+_0x2c16d0(0xc4)),console[_0x2c16d0(0x17a)](_0x2c16d0(0x151)+_0x323c18[_0x2c16d0(0xd8)][_0x2c16d0(0x94)](0x6)+_0x2c16d0(0x10f)+_0x4e525d[_0x2c16d0(0x94)](0x6)+_0x2c16d0(0x1ab)+_0xd5c7fc[_0x2c16d0(0x94)](0x6)+')'),console['log'](_0x2c16d0(0x19d)+_0x323c18[_0x2c16d0(0x14e)][_0x2c16d0(0x94)](0x6)+_0x2c16d0(0x10f)+_0x542287[_0x2c16d0(0x94)](0x6)+_0x2c16d0(0x99)+_0xd5c7fc[_0x2c16d0(0x94)](0x6)+')'),{'payout':_0xfb3bd3,'shop':_0x323c18};});return console[_0x2f6126(0x17a)]('✅\x20Payout\x20created:\x20'+_0x3c720e['payout']['id']+'\x20for\x20shop\x20'+_0x3c720e[_0x2f6126(0x1a9)]['username']+'\x20('+_0xd5c7fc+_0x2f6126(0x8c)),{'id':_0x3c720e[_0x2f6126(0x13f)]['id'],'shopId':_0x3c720e['payout']['shopId'],'shopName':_0x3c720e[_0x2f6126(0x1a9)]['name'],'shopUsername':_0x3c720e[_0x2f6126(0x1a9)]['username'],'amount':_0x3c720e['payout'][_0x2f6126(0xcc)],'network':_0x3c720e[_0x2f6126(0x13f)][_0x2f6126(0xa0)],'status':_0x3c720e[_0x2f6126(0x13f)]['status'],'txid':_0x3c720e['payout'][_0x2f6126(0x120)],'notes':_0x3c720e[_0x2f6126(0x13f)]['notes'],'periodFrom':_0x3c720e['payout'][_0x2f6126(0x90)],'periodTo':_0x3c720e[_0x2f6126(0x13f)][_0x2f6126(0x1c5)],'createdAt':_0x3c720e[_0x2f6126(0x13f)]['createdAt'],'paidAt':_0x3c720e[_0x2f6126(0x13f)][_0x2f6126(0x18b)]};}async['getAllPayouts'](_0x15d8d8){const _0x32a72b=a38_0x3dc91a,{page:_0x102960,limit:_0x525646,shopId:_0x3293e3,network:_0x2b156e,dateFrom:_0x42ff9a,dateTo:_0x5238a5,search:_0x9d508a}=_0x15d8d8,_0x138971=(_0x102960-0x1)*_0x525646,_0x12cc75={};_0x3293e3&&(_0x12cc75['shopId']=_0x3293e3);_0x2b156e&&(_0x12cc75[_0x32a72b(0xa0)]=_0x2b156e);(_0x42ff9a||_0x5238a5)&&(_0x12cc75[_0x32a72b(0x114)]={},_0x42ff9a&&(_0x12cc75[_0x32a72b(0x114)]['gte']=new Date(_0x42ff9a)),_0x5238a5&&(_0x12cc75['createdAt'][_0x32a72b(0x1a6)]=new Date(_0x5238a5)));_0x9d508a&&(_0x12cc75['OR']=[{'shop':{'name':{'contains':_0x9d508a,'mode':_0x32a72b(0x154)}}},{'shop':{'username':{'contains':_0x9d508a,'mode':_0x32a72b(0x154)}}},{'notes':{'contains':_0x9d508a,'mode':_0x32a72b(0x154)}}]);const [_0x5e6f26,_0x59fe05]=await Promise['all']([database_1[_0x32a72b(0x164)]['payout']['findMany']({'where':_0x12cc75,'skip':_0x138971,'take':_0x525646,'orderBy':{'createdAt':_0x32a72b(0xe0)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x32a72b(0x164)]['payout']['count']({'where':_0x12cc75})]);return{'payouts':_0x5e6f26['map'](_0x2a0eb8=>({'id':_0x2a0eb8['id'],'shopId':_0x2a0eb8['shopId'],'shopName':_0x2a0eb8[_0x32a72b(0x1a9)][_0x32a72b(0x11c)],'shopUsername':_0x2a0eb8[_0x32a72b(0x1a9)]['username'],'amount':_0x2a0eb8[_0x32a72b(0xcc)],'network':_0x2a0eb8[_0x32a72b(0xa0)],'status':_0x2a0eb8[_0x32a72b(0x181)],'txid':_0x2a0eb8[_0x32a72b(0x120)],'notes':_0x2a0eb8[_0x32a72b(0x194)],'periodFrom':_0x2a0eb8[_0x32a72b(0x90)],'periodTo':_0x2a0eb8[_0x32a72b(0x1c5)],'createdAt':_0x2a0eb8[_0x32a72b(0x114)],'paidAt':_0x2a0eb8[_0x32a72b(0x18b)]})),'pagination':{'page':_0x102960,'limit':_0x525646,'total':_0x59fe05,'totalPages':Math[_0x32a72b(0x8f)](_0x59fe05/_0x525646)}};}async[a38_0x3dc91a(0xf6)](_0x4fffc9){const _0xfe6809=a38_0x3dc91a,_0x90d073=await database_1[_0xfe6809(0x164)]['payout']['findUnique']({'where':{'id':_0x4fffc9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x90d073)return null;return{'id':_0x90d073['id'],'shopId':_0x90d073[_0xfe6809(0xc0)],'shopName':_0x90d073[_0xfe6809(0x1a9)][_0xfe6809(0x11c)],'shopUsername':_0x90d073['shop']['username'],'amount':_0x90d073[_0xfe6809(0xcc)],'network':_0x90d073[_0xfe6809(0xa0)],'status':_0x90d073[_0xfe6809(0x181)],'txid':_0x90d073[_0xfe6809(0x120)],'notes':_0x90d073['notes'],'periodFrom':_0x90d073[_0xfe6809(0x90)],'periodTo':_0x90d073[_0xfe6809(0x1c5)],'createdAt':_0x90d073[_0xfe6809(0x114)],'paidAt':_0x90d073[_0xfe6809(0x18b)]};}async[a38_0x3dc91a(0xb6)](_0x5c8f55){const _0x2fb49c=a38_0x3dc91a;await database_1[_0x2fb49c(0x164)][_0x2fb49c(0x13f)][_0x2fb49c(0xe6)]({'where':{'id':_0x5c8f55}});}async[a38_0x3dc91a(0x1bb)](_0xd42865){const _0x224b02=a38_0x3dc91a,{page:_0x14d0ce,limit:_0x419a6a,status:_0x365f3d,gateway:_0x1d495d,shopId:_0x194961,dateFrom:_0x1b2027,dateTo:_0x499726,search:_0x113087,currency:_0x8b32df,sortBy:_0x17c371,sortOrder:_0x57a7f4}=_0xd42865,_0x3d916b=(_0x14d0ce-0x1)*_0x419a6a;console[_0x224b02(0x17a)](_0x224b02(0x18f),_0xd42865);const _0x528c2f=await database_1[_0x224b02(0x164)][_0x224b02(0x196)][_0x224b02(0x127)]({'by':[_0x224b02(0x156)],'_count':{'gateway':!![]}});console[_0x224b02(0x17a)](_0x224b02(0xd1),_0x528c2f[_0x224b02(0x11e)](_0xbe8853=>_0xbe8853['gateway']+'\x20('+_0xbe8853['_count'][_0x224b02(0x156)]+_0x224b02(0x160)));if(_0x1d495d){const _0x5af688=_0x528c2f[_0x224b02(0xc7)](_0x39c65a=>_0x39c65a[_0x224b02(0x156)][_0x224b02(0xb4)]()===_0x1d495d[_0x224b02(0xb4)]());!_0x5af688&&_0x1d495d[_0x224b02(0xb4)]()!==_0x224b02(0x123)&&console[_0x224b02(0x17a)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x1d495d+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x528c2f['map'](_0x3c9f4d=>_0x3c9f4d[_0x224b02(0x156)])[_0x224b02(0x1a8)](',\x20'));}const _0x5f1194={};_0x365f3d&&(_0x5f1194['status']=_0x365f3d[_0x224b02(0xa8)]());if(!_0x1d495d)_0x5f1194[_0x224b02(0x156)]={'not':_0x224b02(0x123)};else{if(_0x1d495d&&(_0x1d495d['toLowerCase']()===_0x224b02(0x123)||_0x1d495d==='0000'))_0x5f1194[_0x224b02(0x156)]=_0x224b02(0x123);else{let _0x3976da=_0x1d495d;const _0x348edb=(0x0,gateway_1[_0x224b02(0x173)])(_0x1d495d);if(_0x348edb)_0x3976da=_0x348edb,console[_0x224b02(0x17a)](_0x224b02(0xa2)+_0x1d495d+'\x27\x20to\x20name\x20\x27'+_0x3976da+'\x27');else{const _0x1a9a89=(0x0,gateway_1[_0x224b02(0x10c)])(_0x1d495d);if(_0x1a9a89){const _0x571d6f=(0x0,gateway_1[_0x224b02(0x173)])(_0x1a9a89);_0x571d6f&&(_0x3976da=_0x571d6f,console['log'](_0x224b02(0x177)+_0x1d495d+_0x224b02(0x180)+_0x1a9a89+_0x224b02(0x1bc)+_0x3976da+'\x27'));}else console[_0x224b02(0x17a)](_0x224b02(0x100)+_0x1d495d+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2ea0cd=await database_1[_0x224b02(0x164)][_0x224b02(0x196)][_0x224b02(0x8b)]({'where':{'gateway':_0x3976da[_0x224b02(0xb4)]()},'take':0x1});_0x2ea0cd===0x0?(console[_0x224b02(0x17a)](_0x224b02(0x197)+_0x3976da+_0x224b02(0x12e)+_0x1d495d+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x5f1194[_0x224b02(0x156)]=_0x224b02(0x11d)):(_0x5f1194[_0x224b02(0x156)]=_0x3976da['toLowerCase'](),console[_0x224b02(0x17a)](_0x224b02(0x96)+_0x3976da+_0x224b02(0x12e)+_0x1d495d+'\x27)'));}}console[_0x224b02(0x17a)]('📊\x20Gateway\x20filter\x20applied:',_0x5f1194[_0x224b02(0x156)]);_0x194961&&(_0x5f1194[_0x224b02(0xc0)]=_0x194961);_0x8b32df&&(_0x5f1194[_0x224b02(0x106)]=_0x8b32df['toUpperCase'](),console[_0x224b02(0x17a)](_0x224b02(0x15c)+_0x8b32df[_0x224b02(0xa8)]()));(_0x1b2027||_0x499726)&&(_0x5f1194[_0x224b02(0x114)]={},_0x1b2027&&(_0x5f1194[_0x224b02(0x114)]['gte']=new Date(_0x1b2027)),_0x499726&&(_0x5f1194[_0x224b02(0x114)][_0x224b02(0x1a6)]=new Date(_0x499726)));_0x113087&&(_0x5f1194['OR']=[{'id':{'contains':_0x113087,'mode':_0x224b02(0x154)}},{'orderId':{'contains':_0x113087,'mode':_0x224b02(0x154)}},{'gatewayOrderId':{'contains':_0x113087,'mode':_0x224b02(0x154)}},{'customerEmail':{'contains':_0x113087,'mode':_0x224b02(0x154)}},{'shop':{'name':{'contains':_0x113087,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x113087,'mode':'insensitive'}}}]);console[_0x224b02(0x17a)](_0x224b02(0xc1),JSON[_0x224b02(0xde)](_0x5f1194,null,0x2));let _0x1472b0={'createdAt':_0x224b02(0xe0)};if(_0x17c371){const _0x45182b=['amount',_0x224b02(0x114),_0x224b02(0x9d),'status','gateway',_0x224b02(0x106)],_0x5bef16=['asc','desc'];if(_0x45182b[_0x224b02(0xcf)](_0x17c371)){const _0x3d70ae=_0x5bef16[_0x224b02(0xcf)](_0x57a7f4)?_0x57a7f4:'desc';_0x1472b0={[_0x17c371]:_0x3d70ae},console[_0x224b02(0x17a)](_0x224b02(0xcd)+_0x17c371+'\x20in\x20'+_0x3d70ae+_0x224b02(0x9e));}}const [_0x4a5a1f,_0x2b4011]=await Promise[_0x224b02(0x158)]([database_1['default'][_0x224b02(0x196)][_0x224b02(0x143)]({'where':_0x5f1194,'skip':_0x3d916b,'take':_0x419a6a,'orderBy':_0x1472b0,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x224b02(0x164)][_0x224b02(0x196)]['count']({'where':_0x5f1194})]);return{'payments':_0x4a5a1f,'pagination':{'page':_0x14d0ce,'limit':_0x419a6a,'total':_0x2b4011,'totalPages':Math[_0x224b02(0x8f)](_0x2b4011/_0x419a6a)}};}async[a38_0x3dc91a(0x140)](_0x4b5bc9){const _0x4e6461=a38_0x3dc91a,_0x1fc036=await database_1[_0x4e6461(0x164)][_0x4e6461(0x196)][_0x4e6461(0xe8)]({'where':{'id':_0x4b5bc9},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1fc036)return null;return{'id':_0x1fc036['id'],'shopId':_0x1fc036['shopId'],'gateway':_0x1fc036[_0x4e6461(0x156)],'amount':_0x1fc036['amount'],'currency':_0x1fc036[_0x4e6461(0x106)],'status':_0x1fc036[_0x4e6461(0x181)],'orderId':_0x1fc036[_0x4e6461(0x12d)],'gatewayOrderId':_0x1fc036['gatewayOrderId'],'customerEmail':_0x1fc036['customerEmail'],'customerName':_0x1fc036[_0x4e6461(0xb1)],'customerCountry':_0x1fc036[_0x4e6461(0xfe)],'customerIp':_0x1fc036[_0x4e6461(0xba)],'customerUa':_0x1fc036[_0x4e6461(0xf9)],'failureMessage':_0x1fc036[_0x4e6461(0x15a)],'externalPaymentUrl':_0x1fc036['externalPaymentUrl'],'successUrl':_0x1fc036['successUrl'],'failUrl':_0x1fc036['failUrl'],'pendingUrl':_0x1fc036['pendingUrl'],'whiteUrl':_0x1fc036[_0x4e6461(0x17c)],'createdAt':_0x1fc036['createdAt'],'updatedAt':_0x1fc036[_0x4e6461(0x9d)],'shop':_0x1fc036[_0x4e6461(0x1a9)]};}async['updatePaymentStatus'](_0x4d8caf,_0x7f05b6,_0x46729d,_0x575857){const _0x197e99=a38_0x3dc91a,_0x50ccab=await database_1[_0x197e99(0x164)][_0x197e99(0x188)](async _0x1294d9=>{const _0xb65e4=_0x197e99,_0x1f73ed=await _0x1294d9[_0xb65e4(0x196)]['findUnique']({'where':{'id':_0x4d8caf},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1f73ed)throw new Error(_0xb65e4(0x139));const _0x30bc71=_0x1f73ed['status'],_0x3b1eec=_0x7f05b6[_0xb65e4(0xa8)]();console['log'](_0xb65e4(0x16b)+_0x4d8caf+_0xb65e4(0xd3)+_0x30bc71+_0xb65e4(0x10f)+_0x3b1eec),console[_0xb65e4(0x17a)](_0xb65e4(0x149)+_0x1f73ed[_0xb65e4(0x1a9)][_0xb65e4(0xd8)]+_0xb65e4(0xbf));const _0xcef7eb={'status':_0x3b1eec,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x46729d&&(_0xcef7eb[_0xb65e4(0x1c3)]=_0x46729d);_0x3b1eec===_0xb65e4(0xf2)&&_0x575857&&(_0xcef7eb[_0xb65e4(0x138)]=_0x575857);let _0x2399d2=0x0,_0x721a94=_0x1f73ed['shop'][_0xb65e4(0xd8)];if(_0x3b1eec===_0xb65e4(0x119)&&_0x30bc71!==_0xb65e4(0x119)){_0xcef7eb['paidAt']=new Date();const _0x3797d2=await currencyService_1['currencyService'][_0xb65e4(0x107)](_0x1f73ed[_0xb65e4(0xcc)],_0x1f73ed[_0xb65e4(0x106)]);_0xcef7eb['amountUSDT']=_0x3797d2;let _0xa075a8=0x2d;const _0x4a2fe8=await _0x1294d9[_0xb65e4(0x1a9)][_0xb65e4(0xe8)]({'where':{'id':_0x1f73ed[_0xb65e4(0xc0)]},'select':{'gatewaySettings':!![]}});if(_0x4a2fe8?.[_0xb65e4(0xa4)])try{const _0xeafc12=JSON[_0xb65e4(0xc9)](_0x4a2fe8['gatewaySettings']);for(const [_0x5f12d2,_0x5180e9]of Object[_0xb65e4(0xd0)](_0xeafc12)){if(_0x5f12d2[_0xb65e4(0xb4)]()===_0x1f73ed[_0xb65e4(0x156)]['toLowerCase']()){_0xa075a8=_0x5180e9[_0xb65e4(0x9f)]||0xa;break;}}}catch(_0x5f4c3a){console[_0xb65e4(0x169)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x4d8caf+':',_0x5f4c3a);}let _0x52e642;_0x1f73ed[_0xb65e4(0xb2)]!==null&&_0x1f73ed[_0xb65e4(0xb2)]!==undefined?(_0x52e642=_0x1f73ed['amountAfterGatewayCommissionUSDT'],console[_0xb65e4(0x17a)]('📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x52e642['toFixed'](0x6)+_0xb65e4(0xc6)+_0x4d8caf)):(_0x52e642=_0x3797d2*(0x1-_0xa075a8/0x64),console[_0xb65e4(0x17a)](_0xb65e4(0x1aa)+_0x4d8caf+':\x20'+_0xa075a8+_0xb65e4(0xce)+_0x3797d2[_0xb65e4(0x94)](0x6)+'\x20USDT'),_0xcef7eb[_0xb65e4(0xb2)]=_0x52e642,_0xcef7eb[_0xb65e4(0x12f)]=_0xa075a8),_0x2399d2=_0x52e642,_0x721a94+=_0x52e642,console[_0xb65e4(0x17a)](_0xb65e4(0x192)+_0x4d8caf+'\x20became\x20PAID:'),console[_0xb65e4(0x17a)]('\x20\x20\x20Full\x20amount:\x20'+_0x3797d2[_0xb65e4(0x94)](0x6)+_0xb65e4(0xbf)),console[_0xb65e4(0x17a)](_0xb65e4(0x147)+_0x1f73ed['gateway']+_0xb65e4(0xd7)+_0xa075a8+'%'),console[_0xb65e4(0x17a)](_0xb65e4(0x148)+_0x52e642[_0xb65e4(0x94)](0x6)+_0xb65e4(0xdd)+_0xa075a8+_0xb65e4(0xaf)),console[_0xb65e4(0x17a)](_0xb65e4(0xf4)+_0x52e642[_0xb65e4(0x94)](0x6)+_0xb65e4(0xbf));}else{if(_0x30bc71===_0xb65e4(0x119)&&_0x3b1eec!=='PAID'){if(_0x1f73ed['amountUSDT']){let _0x89dfea=0x2d;const _0x30771c=await _0x1294d9[_0xb65e4(0x1a9)]['findUnique']({'where':{'id':_0x1f73ed[_0xb65e4(0xc0)]},'select':{'gatewaySettings':!![]}});if(_0x30771c?.[_0xb65e4(0xa4)])try{const _0xc12d77=JSON[_0xb65e4(0xc9)](_0x30771c[_0xb65e4(0xa4)]);for(const [_0x1cfb4d,_0x3fc728]of Object['entries'](_0xc12d77)){if(_0x1cfb4d[_0xb65e4(0xb4)]()===_0x1f73ed['gateway'][_0xb65e4(0xb4)]()){_0x89dfea=_0x3fc728[_0xb65e4(0x9f)]||0xa;break;}}}catch(_0x298acb){console['error'](_0xb65e4(0x15f)+_0x4d8caf+':',_0x298acb);}const _0x411b3e=_0x1f73ed[_0xb65e4(0xdf)]*(0x1-_0x89dfea/0x64);_0x2399d2=-_0x411b3e,_0x721a94-=_0x411b3e,_0xcef7eb['amountUSDT']=null,_0xcef7eb[_0xb65e4(0xb2)]=null,console[_0xb65e4(0x17a)](_0xb65e4(0x192)+_0x4d8caf+_0xb65e4(0x17b)),console[_0xb65e4(0x17a)](_0xb65e4(0x113)+_0x1f73ed[_0xb65e4(0xdf)][_0xb65e4(0x94)](0x6)+_0xb65e4(0xbf)),console[_0xb65e4(0x17a)]('\x20\x20\x20Gateway:\x20'+_0x1f73ed[_0xb65e4(0x156)]+',\x20Commission:\x20'+_0x89dfea+'%'),console[_0xb65e4(0x17a)](_0xb65e4(0x185)+_0x411b3e[_0xb65e4(0x94)](0x6)+_0xb65e4(0xdd)+_0x89dfea+_0xb65e4(0xaf)),console[_0xb65e4(0x17a)](_0xb65e4(0x1a0)+_0x411b3e[_0xb65e4(0x94)](0x6)+'\x20USDT');}}}_0x3b1eec==='CHARGEBACK'&&(_0x30bc71==='PAID'&&_0x1f73ed['amountUSDT']&&console[_0xb65e4(0x17a)](_0xb65e4(0x171)),_0x575857&&_0x575857>0x0&&(_0x2399d2-=_0x575857,_0x721a94-=_0x575857,console[_0xb65e4(0x17a)](_0xb65e4(0x1a4)+_0x575857[_0xb65e4(0x94)](0x6)+'\x20USDT\x20from\x20balance')));_0x3b1eec===_0xb65e4(0xdc)&&_0x30bc71===_0xb65e4(0x119)&&console[_0xb65e4(0x17a)](_0xb65e4(0xc2));const _0x5ba254=await _0x1294d9['payment'][_0xb65e4(0x1be)]({'where':{'id':_0x4d8caf},'data':_0xcef7eb,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2399d2!==0x0&&(await _0x1294d9[_0xb65e4(0x1a9)]['update']({'where':{'id':_0x1f73ed[_0xb65e4(0xc0)]},'data':{'balance':_0x721a94}}),console['log'](_0xb65e4(0xca)+_0x1f73ed[_0xb65e4(0xc0)]+_0xb65e4(0x1c8)+_0x1f73ed[_0xb65e4(0x1a9)][_0xb65e4(0xd8)][_0xb65e4(0x94)](0x6)+_0xb65e4(0x10f)+_0x721a94[_0xb65e4(0x94)](0x6)+_0xb65e4(0x112)+(_0x2399d2>0x0?'+':'')+_0x2399d2[_0xb65e4(0x94)](0x6)+')')),_0x5ba254;});return{'id':_0x50ccab['id'],'shopId':_0x50ccab[_0x197e99(0xc0)],'gateway':_0x50ccab[_0x197e99(0x156)],'amount':_0x50ccab[_0x197e99(0xcc)],'currency':_0x50ccab[_0x197e99(0x106)],'status':_0x50ccab[_0x197e99(0x181)],'orderId':_0x50ccab[_0x197e99(0x12d)],'gatewayOrderId':_0x50ccab[_0x197e99(0x97)],'customerEmail':_0x50ccab['customerEmail'],'customerName':_0x50ccab['customerName'],'customerCountry':_0x50ccab[_0x197e99(0xfe)],'customerIp':_0x50ccab[_0x197e99(0xba)],'customerUa':_0x50ccab[_0x197e99(0xf9)],'failureMessage':_0x50ccab['failureMessage'],'adminNotes':_0x50ccab[_0x197e99(0x1c3)],'chargebackAmount':_0x50ccab[_0x197e99(0x138)],'statusChangedBy':_0x50ccab['statusChangedBy'],'statusChangedAt':_0x50ccab[_0x197e99(0x1b7)],'createdAt':_0x50ccab[_0x197e99(0x114)],'updatedAt':_0x50ccab['updatedAt'],'shop':_0x50ccab[_0x197e99(0x1a9)]};}async[a38_0x3dc91a(0xe7)](_0x685790,_0x4df0a9){const _0x170f4b=a38_0x3dc91a,_0x2db0c=Math[_0x170f4b(0x189)]()[_0x170f4b(0xfb)](0x24)[_0x170f4b(0x1a1)](0x2,0x9);console['log'](_0x170f4b(0xb7)+_0x2db0c+_0x170f4b(0xac)+_0x685790);const _0x21696a={..._0x4df0a9};_0x4df0a9['password']&&_0x4df0a9[_0x170f4b(0x132)]['trim']()!==''?(console[_0x170f4b(0x17a)](_0x170f4b(0x1cb)+_0x2db0c+_0x170f4b(0xf7)+_0x685790),_0x21696a[_0x170f4b(0x132)]=await bcryptjs_1[_0x170f4b(0x164)][_0x170f4b(0x186)](_0x4df0a9[_0x170f4b(0x132)],0xc)):(console[_0x170f4b(0x17a)](_0x170f4b(0x1cb)+_0x2db0c+_0x170f4b(0x18d)),delete _0x21696a[_0x170f4b(0x132)]);_0x4df0a9[_0x170f4b(0x1bd)]&&(_0x21696a[_0x170f4b(0x11c)]=_0x4df0a9[_0x170f4b(0x1bd)],delete _0x21696a['fullName']);_0x4df0a9[_0x170f4b(0x134)]&&(_0x21696a[_0x170f4b(0x10b)]=_0x4df0a9[_0x170f4b(0x134)],delete _0x21696a[_0x170f4b(0x134)]);_0x4df0a9['merchantUrl']&&(_0x21696a[_0x170f4b(0xa9)]=_0x4df0a9['merchantUrl'],delete _0x21696a[_0x170f4b(0x1c2)]);if(_0x4df0a9[_0x170f4b(0x19f)]){const _0x487493=_0x4df0a9[_0x170f4b(0x19f)][_0x170f4b(0x11e)](_0x53844e=>this[_0x170f4b(0xe3)](_0x53844e));console[_0x170f4b(0x17a)](_0x170f4b(0x128),_0x4df0a9['gateways'],'->',_0x487493),_0x21696a[_0x170f4b(0x98)]=JSON[_0x170f4b(0xde)](_0x487493),delete _0x21696a[_0x170f4b(0x19f)];}_0x4df0a9[_0x170f4b(0xa4)]&&(console[_0x170f4b(0x17a)](_0x170f4b(0x146)+_0x2db0c+_0x170f4b(0x118),_0x4df0a9[_0x170f4b(0xa4)]),_0x21696a['gatewaySettings']=JSON[_0x170f4b(0xde)](_0x4df0a9[_0x170f4b(0xa4)]),console[_0x170f4b(0x17a)](_0x170f4b(0x146)+_0x2db0c+_0x170f4b(0x174),_0x21696a['gatewaySettings']));_0x4df0a9[_0x170f4b(0x142)]&&(_0x4df0a9['wallets'][_0x170f4b(0x16f)]!==undefined&&(_0x21696a[_0x170f4b(0x16f)]=_0x4df0a9['wallets']['usdtPolygonWallet']||null),_0x4df0a9[_0x170f4b(0x142)][_0x170f4b(0x116)]!==undefined&&(_0x21696a[_0x170f4b(0x116)]=_0x4df0a9[_0x170f4b(0x142)][_0x170f4b(0x116)]||null),_0x4df0a9[_0x170f4b(0x142)][_0x170f4b(0xa3)]!==undefined&&(_0x21696a[_0x170f4b(0xa3)]=_0x4df0a9[_0x170f4b(0x142)][_0x170f4b(0xa3)]||null),_0x4df0a9[_0x170f4b(0x142)]['usdcPolygonWallet']!==undefined&&(_0x21696a[_0x170f4b(0xc8)]=_0x4df0a9['wallets'][_0x170f4b(0xc8)]||null),delete _0x21696a[_0x170f4b(0x142)]);const _0x2db3e7=await database_1[_0x170f4b(0x164)][_0x170f4b(0x1a9)]['update']({'where':{'id':_0x685790},'data':_0x21696a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log']('🎯\x20['+_0x2db0c+_0x170f4b(0x16e),_0x2db3e7[_0x170f4b(0xa4)]),{'id':_0x2db3e7['id'],'fullName':_0x2db3e7[_0x170f4b(0x11c)],'username':_0x2db3e7[_0x170f4b(0x14b)],'telegramId':_0x2db3e7[_0x170f4b(0x10b)],'merchantUrl':_0x2db3e7[_0x170f4b(0xa9)],'gateways':_0x2db3e7['paymentGateways']?JSON['parse'](_0x2db3e7[_0x170f4b(0x98)]):null,'gatewaySettings':_0x2db3e7[_0x170f4b(0xa4)]?JSON['parse'](_0x2db3e7[_0x170f4b(0xa4)]):null,'publicKey':_0x2db3e7[_0x170f4b(0xf0)],'wallets':{'usdtPolygonWallet':_0x2db3e7[_0x170f4b(0x16f)],'usdtTrcWallet':_0x2db3e7[_0x170f4b(0x116)],'usdtErcWallet':_0x2db3e7['usdtErcWallet'],'usdcPolygonWallet':_0x2db3e7['usdcPolygonWallet']},'status':_0x2db3e7['status'],'createdAt':_0x2db3e7[_0x170f4b(0x114)]};}async[a38_0x3dc91a(0x145)](_0x5d93f5){const _0x151cf2=a38_0x3dc91a,_0xc0bc29=await database_1[_0x151cf2(0x164)][_0x151cf2(0x1a9)]['update']({'where':{'id':_0x5d93f5},'data':{'status':_0x151cf2(0x12c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xc0bc29['id'],'fullName':_0xc0bc29[_0x151cf2(0x11c)],'username':_0xc0bc29['username'],'telegramId':_0xc0bc29['telegram'],'merchantUrl':_0xc0bc29[_0x151cf2(0xa9)],'gateways':_0xc0bc29[_0x151cf2(0x98)]?JSON[_0x151cf2(0xc9)](_0xc0bc29[_0x151cf2(0x98)]):null,'gatewaySettings':_0xc0bc29['gatewaySettings']?JSON['parse'](_0xc0bc29['gatewaySettings']):null,'publicKey':_0xc0bc29[_0x151cf2(0xf0)],'wallets':{'usdtPolygonWallet':_0xc0bc29[_0x151cf2(0x16f)],'usdtTrcWallet':_0xc0bc29[_0x151cf2(0x116)],'usdtErcWallet':_0xc0bc29[_0x151cf2(0xa3)],'usdcPolygonWallet':_0xc0bc29[_0x151cf2(0xc8)]},'status':_0xc0bc29[_0x151cf2(0x181)],'createdAt':_0xc0bc29['createdAt']};}async['activateUser'](_0x2067fd){const _0x21fe8c=a38_0x3dc91a,_0x4ea9cb=await database_1['default'][_0x21fe8c(0x1a9)][_0x21fe8c(0x1be)]({'where':{'id':_0x2067fd},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4ea9cb['id'],'fullName':_0x4ea9cb[_0x21fe8c(0x11c)],'username':_0x4ea9cb[_0x21fe8c(0x14b)],'telegramId':_0x4ea9cb['telegram'],'merchantUrl':_0x4ea9cb[_0x21fe8c(0xa9)],'gateways':_0x4ea9cb[_0x21fe8c(0x98)]?JSON['parse'](_0x4ea9cb[_0x21fe8c(0x98)]):null,'gatewaySettings':_0x4ea9cb[_0x21fe8c(0xa4)]?JSON[_0x21fe8c(0xc9)](_0x4ea9cb[_0x21fe8c(0xa4)]):null,'publicKey':_0x4ea9cb[_0x21fe8c(0xf0)],'wallets':{'usdtPolygonWallet':_0x4ea9cb[_0x21fe8c(0x16f)],'usdtTrcWallet':_0x4ea9cb[_0x21fe8c(0x116)],'usdtErcWallet':_0x4ea9cb[_0x21fe8c(0xa3)],'usdcPolygonWallet':_0x4ea9cb[_0x21fe8c(0xc8)]},'status':_0x4ea9cb['status'],'createdAt':_0x4ea9cb['createdAt']};}async[a38_0x3dc91a(0x172)](_0x512adb){const _0x5aee85=a38_0x3dc91a,{page:_0x29bd79,limit:_0x370289,status:_0x11ee6e}=_0x512adb,_0x42bca5=(_0x29bd79-0x1)*_0x370289,_0x4ae7eb={};_0x11ee6e&&(_0x4ae7eb['status']=_0x11ee6e[_0x5aee85(0xa8)]());const [_0x289f37,_0x447e55]=await Promise[_0x5aee85(0x158)]([database_1['default'][_0x5aee85(0x1a9)][_0x5aee85(0x143)]({'where':_0x4ae7eb,'skip':_0x42bca5,'take':_0x370289,'orderBy':{'createdAt':_0x5aee85(0xe0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5aee85(0x164)][_0x5aee85(0x1a9)]['count']({'where':_0x4ae7eb})]);return{'users':_0x289f37[_0x5aee85(0x11e)](_0x2cc9ed=>{const _0x3fa231=_0x5aee85,_0x24c9f8=_0x2cc9ed[_0x3fa231(0x98)]?JSON[_0x3fa231(0xc9)](_0x2cc9ed['paymentGateways']):null,_0x15d66b=_0x24c9f8?_0x24c9f8[_0x3fa231(0x11e)](_0x28c901=>this[_0x3fa231(0xcb)](_0x28c901)):null;return{'id':_0x2cc9ed['id'],'fullName':_0x2cc9ed['name'],'username':_0x2cc9ed['username'],'telegramId':_0x2cc9ed['telegram'],'merchantUrl':_0x2cc9ed['shopUrl'],'gateways':_0x15d66b,'gatewaySettings':_0x2cc9ed[_0x3fa231(0xa4)]?JSON[_0x3fa231(0xc9)](_0x2cc9ed[_0x3fa231(0xa4)]):null,'publicKey':_0x2cc9ed['publicKey'],'wallets':{'usdtPolygonWallet':_0x2cc9ed[_0x3fa231(0x16f)],'usdtTrcWallet':_0x2cc9ed[_0x3fa231(0x116)],'usdtErcWallet':_0x2cc9ed['usdtErcWallet'],'usdcPolygonWallet':_0x2cc9ed['usdcPolygonWallet']},'status':_0x2cc9ed[_0x3fa231(0x181)],'createdAt':_0x2cc9ed[_0x3fa231(0x114)]};}),'pagination':{'page':_0x29bd79,'limit':_0x370289,'total':_0x447e55,'totalPages':Math[_0x5aee85(0x8f)](_0x447e55/_0x370289)}};}async[a38_0x3dc91a(0x155)](_0x3a8e1c){const _0x1d1a57=a38_0x3dc91a,_0x27295c=await database_1[_0x1d1a57(0x164)][_0x1d1a57(0x1a9)][_0x1d1a57(0xe8)]({'where':{'id':_0x3a8e1c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x27295c)return null;const _0x11c9c6=_0x27295c[_0x1d1a57(0x98)]?JSON['parse'](_0x27295c[_0x1d1a57(0x98)]):null,_0x4594ac=_0x11c9c6?_0x11c9c6[_0x1d1a57(0x11e)](_0x29d97b=>this[_0x1d1a57(0xcb)](_0x29d97b)):null;return _0x11c9c6&&_0x4594ac&&console[_0x1d1a57(0x17a)](_0x1d1a57(0x1af),_0x11c9c6,'->',_0x4594ac),{'id':_0x27295c['id'],'fullName':_0x27295c[_0x1d1a57(0x11c)],'username':_0x27295c[_0x1d1a57(0x14b)],'telegramId':_0x27295c[_0x1d1a57(0x10b)],'merchantUrl':_0x27295c[_0x1d1a57(0xa9)],'gateways':_0x4594ac,'gatewaySettings':_0x27295c['gatewaySettings']?JSON[_0x1d1a57(0xc9)](_0x27295c[_0x1d1a57(0xa4)]):null,'publicKey':_0x27295c[_0x1d1a57(0xf0)],'wallets':{'usdtPolygonWallet':_0x27295c['usdtPolygonWallet'],'usdtTrcWallet':_0x27295c[_0x1d1a57(0x116)],'usdtErcWallet':_0x27295c['usdtErcWallet'],'usdcPolygonWallet':_0x27295c['usdcPolygonWallet']},'status':_0x27295c[_0x1d1a57(0x181)],'createdAt':_0x27295c[_0x1d1a57(0x114)]};}async[a38_0x3dc91a(0x15b)](_0x3cbfc1){const _0x240962=a38_0x3dc91a,{fullName:_0x5d2faa,username:_0x5ba509,password:_0x5a340b,telegramId:_0x222bb1,merchantUrl:_0x536682,gateways:_0x50c541,gatewaySettings:_0x472cc2,wallets:_0x8d1982}=_0x3cbfc1,_0x241f44=await database_1[_0x240962(0x164)]['shop'][_0x240962(0xe8)]({'where':{'username':_0x5ba509}});if(_0x241f44)throw new Error(_0x240962(0x153));if(_0x222bb1){const _0x11289d=await database_1[_0x240962(0x164)]['shop'][_0x240962(0xe8)]({'where':{'telegram':_0x222bb1}});if(_0x11289d)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x4a5dcf=await bcryptjs_1[_0x240962(0x164)][_0x240962(0x186)](_0x5a340b,0xc),_0x3efced=_0x240962(0xaa)+crypto_1[_0x240962(0x164)][_0x240962(0x133)](0x20)[_0x240962(0xfb)]('hex'),_0x5260f8=_0x240962(0xea)+crypto_1['default'][_0x240962(0x133)](0x20)[_0x240962(0xfb)]('hex'),_0x2cbf46=_0x50c541?_0x50c541[_0x240962(0x11e)](_0x161fba=>this[_0x240962(0xe3)](_0x161fba)):null;_0x50c541&&_0x2cbf46&&console['log']('🔄\x20Gateway\x20mapping\x20(create):',_0x50c541,'->',_0x2cbf46);const _0x52285f=await database_1[_0x240962(0x164)]['shop']['create']({'data':{'name':_0x5d2faa,'username':_0x5ba509,'password':_0x4a5dcf,'telegram':_0x222bb1,'shopUrl':_0x536682,'paymentGateways':_0x2cbf46?JSON[_0x240962(0xde)](_0x2cbf46):null,'gatewaySettings':_0x472cc2?JSON['stringify'](_0x472cc2):null,'usdtPolygonWallet':_0x8d1982?.[_0x240962(0x16f)]||null,'usdtTrcWallet':_0x8d1982?.[_0x240962(0x116)]||null,'usdtErcWallet':_0x8d1982?.[_0x240962(0xa3)]||null,'usdcPolygonWallet':_0x8d1982?.[_0x240962(0xc8)]||null,'publicKey':_0x3efced,'secretKey':_0x5260f8,'status':_0x240962(0xa5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x52285f['id'],'fullName':_0x52285f[_0x240962(0x11c)],'username':_0x52285f['username'],'telegramId':_0x52285f[_0x240962(0x10b)],'merchantUrl':_0x52285f[_0x240962(0xa9)],'gateways':_0x52285f[_0x240962(0x98)]?JSON[_0x240962(0xc9)](_0x52285f[_0x240962(0x98)]):null,'gatewaySettings':_0x52285f[_0x240962(0xa4)]?JSON[_0x240962(0xc9)](_0x52285f[_0x240962(0xa4)]):null,'publicKey':_0x52285f['publicKey'],'wallets':{'usdtPolygonWallet':_0x52285f['usdtPolygonWallet'],'usdtTrcWallet':_0x52285f['usdtTrcWallet'],'usdtErcWallet':_0x52285f[_0x240962(0xa3)],'usdcPolygonWallet':_0x52285f[_0x240962(0xc8)]},'status':_0x52285f[_0x240962(0x181)],'createdAt':_0x52285f[_0x240962(0x114)]};}async[a38_0x3dc91a(0x1b2)](_0x1728b5){const _0x22ed6f=a38_0x3dc91a;await database_1['default'][_0x22ed6f(0x1a9)][_0x22ed6f(0xe6)]({'where':{'id':_0x1728b5}});}['generateDailyStatistics'](_0x4ba7b3,_0x1ecb7e,_0x2d9377){const _0x48ddd8=a38_0x3dc91a,_0x6d78c1=new Map(),_0x155ba7=new Date(_0x1ecb7e);while(_0x155ba7<=_0x2d9377){const _0x11b588=_0x155ba7[_0x48ddd8(0x1ba)]()[_0x48ddd8(0xae)]('T')[0x0];_0x6d78c1[_0x48ddd8(0x11f)](_0x11b588,{'revenue':0x0,'count':0x0}),_0x155ba7['setDate'](_0x155ba7[_0x48ddd8(0x8d)]()+0x1);}for(const _0xc107bb of _0x4ba7b3){const _0x1f806f=_0xc107bb[_0x48ddd8(0x114)][_0x48ddd8(0x1ba)]()[_0x48ddd8(0xae)]('T')[0x0],_0x3d5f0d=_0x6d78c1['get'](_0x1f806f);_0x3d5f0d&&(_0x3d5f0d[_0x48ddd8(0x8b)]+=0x1,_0xc107bb[_0x48ddd8(0x181)]===_0x48ddd8(0x119)&&(_0xc107bb[_0x48ddd8(0xdf)]?_0x3d5f0d[_0x48ddd8(0x161)]+=_0xc107bb[_0x48ddd8(0xdf)]:console[_0x48ddd8(0x17a)]('⚠️\x20Payment\x20'+_0xc107bb['id']+_0x48ddd8(0x15d))));}const _0x79dcc6=[],_0x3cf7df=[];for(const [_0x3d472d,_0x4355a2]of _0x6d78c1){_0x79dcc6[_0x48ddd8(0xad)]({'date':_0x3d472d,'amount':Math['round'](_0x4355a2[_0x48ddd8(0x161)]*0x64)/0x64}),_0x3cf7df[_0x48ddd8(0xad)]({'date':_0x3d472d,'count':_0x4355a2[_0x48ddd8(0x8b)]});}return{'dailyRevenue':_0x79dcc6,'dailyPayments':_0x3cf7df};}}exports[a38_0x3dc91a(0x152)]=AdminService;