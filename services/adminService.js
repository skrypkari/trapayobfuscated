'use strict';const a40_0x223e0c=a40_0xce88;(function(_0x5ea77c,_0xe33241){const _0x55de22=a40_0xce88,_0x32cc5c=_0x5ea77c();while(!![]){try{const _0x32f7d8=parseInt(_0x55de22(0x21c))/0x1+-parseInt(_0x55de22(0x187))/0x2*(parseInt(_0x55de22(0xed))/0x3)+-parseInt(_0x55de22(0x1bb))/0x4*(parseInt(_0x55de22(0xfa))/0x5)+parseInt(_0x55de22(0xef))/0x6+parseInt(_0x55de22(0x1da))/0x7+-parseInt(_0x55de22(0x112))/0x8*(parseInt(_0x55de22(0x1d8))/0x9)+parseInt(_0x55de22(0xf5))/0xa;if(_0x32f7d8===_0xe33241)break;else _0x32cc5c['push'](_0x32cc5c['shift']());}catch(_0x273880){_0x32cc5c['push'](_0x32cc5c['shift']());}}}(a40_0x3c9f,0x87390));var __importDefault=this&&this['__importDefault']||function(_0x33473c){const _0x4379f1=a40_0xce88;return _0x33473c&&_0x33473c[_0x4379f1(0x12c)]?_0x33473c:{'default':_0x33473c};};function a40_0xce88(_0x2a07bc,_0x2080de){const _0x3c9fd7=a40_0x3c9f();return a40_0xce88=function(_0xce8842,_0x1c3791){_0xce8842=_0xce8842-0xed;let _0x3b09ac=_0x3c9fd7[_0xce8842];return _0x3b09ac;},a40_0xce88(_0x2a07bc,_0x2080de);}Object[a40_0x223e0c(0xf7)](exports,a40_0x223e0c(0x12c),{'value':!![]}),exports[a40_0x223e0c(0x1d9)]=void 0x0;const database_1=__importDefault(require(a40_0x223e0c(0x23d))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a40_0x223e0c(0x131)),telegramBotService_1=require('./telegramBotService'),gateway_1=require('../types/gateway');class AdminService{async[a40_0x223e0c(0x11e)](){const _0x3cf669=a40_0x223e0c;console[_0x3cf669(0x23a)](_0x3cf669(0x188));const _0x31f481=await database_1['default'][_0x3cf669(0x170)][_0x3cf669(0x1f8)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3cf669(0xff)}}),_0x3d27ea=await database_1[_0x3cf669(0x249)][_0x3cf669(0x1fd)][_0x3cf669(0x168)]({'where':{'status':_0x3cf669(0x159),'gateway':{'not':_0x3cf669(0x1ee)}}}),_0xb2d8=new Date(),_0x29e712=new Date(_0xb2d8[_0x3cf669(0x1a5)](),_0xb2d8[_0x3cf669(0x11a)](),0x1),_0x213608=new Date(_0xb2d8[_0x3cf669(0x1a5)](),_0xb2d8['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2568fd=await database_1[_0x3cf669(0x249)][_0x3cf669(0x180)][_0x3cf669(0x1f8)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x29e712,'lte':_0x213608},'status':_0x3cf669(0x119)}}),_0x1a3aef=_0x31f481[_0x3cf669(0x1c3)][_0x3cf669(0x225)]||0x0,_0x463e41=_0x31f481[_0x3cf669(0x1c3)][_0x3cf669(0x117)]||0x0,_0x45ebd5=_0x2568fd[_0x3cf669(0x1c3)][_0x3cf669(0x223)]||0x0,_0x143a60={'totalPayout':Math['round'](_0x1a3aef*0x64)/0x64,'awaitingPayout':Math[_0x3cf669(0x13e)](_0x463e41*0x64)/0x64,'thisMonth':Math[_0x3cf669(0x13e)](_0x45ebd5*0x64)/0x64,'availableBalance':Math['round'](_0x463e41*0x64)/0x64,'totalPayments':_0x3d27ea};return console['log'](_0x3cf669(0x160)),console['log']('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x143a60[_0x3cf669(0x16f)]+_0x3cf669(0x1bc)),console['log'](_0x3cf669(0x111)+_0x143a60[_0x3cf669(0x197)]+_0x3cf669(0x194)),console['log'](_0x3cf669(0x1ba)+_0x143a60['availableBalance']+_0x3cf669(0x24e)),console[_0x3cf669(0x23a)](_0x3cf669(0x1fc)+_0x143a60['thisMonth']+_0x3cf669(0x1a8)),console[_0x3cf669(0x23a)](_0x3cf669(0x1de)+_0x143a60[_0x3cf669(0x138)]+_0x3cf669(0x20e)),_0x143a60;}async[a40_0x223e0c(0x1c0)](_0x4b4050,_0x22d659){const _0x814f8e=a40_0x223e0c;console['log'](_0x814f8e(0x15e)+_0x4b4050+':',_0x22d659);const _0x1a0973=await database_1['default'][_0x814f8e(0x1fd)]['findUnique']({'where':{'id':_0x4b4050},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1a0973)throw new Error('Payment\x20not\x20found');const _0x96a9b8={};_0x22d659['customerCountry']!==undefined&&(_0x96a9b8[_0x814f8e(0x242)]=_0x22d659[_0x814f8e(0x242)]||null);_0x22d659[_0x814f8e(0x13c)]!==undefined&&(_0x96a9b8[_0x814f8e(0x13c)]=_0x22d659[_0x814f8e(0x13c)]||null);_0x22d659['customerUa']!==undefined&&(_0x96a9b8[_0x814f8e(0xf9)]=_0x22d659[_0x814f8e(0xf9)]||null);const _0x4169ec=await database_1['default'][_0x814f8e(0x1fd)][_0x814f8e(0x227)]({'where':{'id':_0x4b4050},'data':{..._0x96a9b8,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x814f8e(0x23a)](_0x814f8e(0x142)+_0x4b4050),console[_0x814f8e(0x23a)](_0x814f8e(0x231)+_0x1a0973[_0x814f8e(0x242)]+'\x20->\x20'+_0x4169ec[_0x814f8e(0x242)]),console[_0x814f8e(0x23a)](_0x814f8e(0x1e9)+_0x1a0973['customerIp']+_0x814f8e(0x17a)+_0x4169ec['customerIp']),console[_0x814f8e(0x23a)](_0x814f8e(0x1a4)+(_0x1a0973[_0x814f8e(0xf9)]?_0x814f8e(0xf0):_0x814f8e(0x141))+_0x814f8e(0x17a)+(_0x4169ec[_0x814f8e(0xf9)]?_0x814f8e(0xf0):_0x814f8e(0x141))),_0x4169ec;}async[a40_0x223e0c(0x18a)](_0x4de46a){const _0x1df14e=a40_0x223e0c,_0x4a55e0=new Date();let _0x2981c9;switch(_0x4de46a[_0x1df14e(0x155)]()){case _0x1df14e(0x20d):_0x2981c9=new Date(_0x4a55e0[_0x1df14e(0x1a5)](),_0x4a55e0[_0x1df14e(0x11a)](),_0x4a55e0[_0x1df14e(0x17f)](),0x0,0x0,0x0,0x0);break;case _0x1df14e(0x153):const _0x4477f6=new Date(_0x4a55e0);_0x4477f6['setDate'](_0x4477f6[_0x1df14e(0x17f)]()-0x1),_0x2981c9=new Date(_0x4477f6[_0x1df14e(0x1a5)](),_0x4477f6[_0x1df14e(0x11a)](),_0x4477f6[_0x1df14e(0x17f)](),0x0,0x0,0x0,0x0);break;case'7d':_0x2981c9=new Date(_0x4a55e0['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2981c9=new Date(_0x4a55e0['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1df14e(0x212):_0x2981c9=new Date(_0x4a55e0[_0x1df14e(0x14e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x1df14e(0x162):const _0x3eb571=await database_1['default'][_0x1df14e(0x1fd)][_0x1df14e(0x152)]({'where':{'gateway':{'not':_0x1df14e(0x1ee)}},'orderBy':{'createdAt':_0x1df14e(0x136)},'select':{'createdAt':!![]}});_0x2981c9=_0x3eb571?_0x3eb571[_0x1df14e(0x163)]:new Date(_0x1df14e(0x1e7));break;default:_0x2981c9=new Date(_0x4a55e0[_0x1df14e(0x14e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x2981c9['setHours'](0x0,0x0,0x0,0x0);let _0x1121b4;if(_0x4de46a[_0x1df14e(0x155)]()===_0x1df14e(0x153)){const _0x562ce3=new Date(_0x4a55e0);_0x562ce3[_0x1df14e(0x158)](_0x562ce3[_0x1df14e(0x17f)]()-0x1),_0x1121b4=new Date(_0x562ce3[_0x1df14e(0x1a5)](),_0x562ce3[_0x1df14e(0x11a)](),_0x562ce3[_0x1df14e(0x17f)](),0x17,0x3b,0x3b,0x3e7);}const _0x4fd140={'gte':_0x2981c9};_0x1121b4&&(_0x4fd140[_0x1df14e(0x134)]=_0x1121b4);const [_0x3824d1,_0x2aa124,_0x45ef2f,_0x5a5cf5,_0x41c21f,_0x23978c,_0x248e89,_0x59de6c]=await Promise[_0x1df14e(0x162)]([database_1[_0x1df14e(0x249)][_0x1df14e(0x170)]['count'](),database_1['default'][_0x1df14e(0x170)][_0x1df14e(0x168)]({'where':{'status':_0x1df14e(0xff)}}),database_1['default']['payment'][_0x1df14e(0x168)]({'where':{'status':_0x1df14e(0x159),'createdAt':_0x4fd140,'gateway':{'not':'test_gateway'}}}),database_1[_0x1df14e(0x249)]['payment'][_0x1df14e(0x168)]({'where':{'status':_0x1df14e(0x135),'createdAt':_0x4fd140,'gateway':{'not':_0x1df14e(0x1ee)}}}),database_1[_0x1df14e(0x249)][_0x1df14e(0x1fd)][_0x1df14e(0x168)]({'where':{'status':_0x1df14e(0x1b5),'createdAt':_0x4fd140,'gateway':{'not':'test_gateway'}}}),database_1[_0x1df14e(0x249)]['payment'][_0x1df14e(0x24a)]({'where':{'status':'PAID','createdAt':_0x4fd140,'gateway':{'not':_0x1df14e(0x1ee)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x1df14e(0x249)][_0x1df14e(0x1fd)][_0x1df14e(0x24a)]({'where':{'gateway':{'not':_0x1df14e(0x1ee)}},'take':0xa,'orderBy':{'createdAt':_0x1df14e(0x14a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1df14e(0x249)][_0x1df14e(0x1fd)]['findMany']({'where':{'createdAt':_0x4fd140,'gateway':{'not':_0x1df14e(0x1ee)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x2742b3=0x0,_0x14b042=0x0;for(const _0x228a97 of _0x23978c){const _0x4c301f=await currencyService_1[_0x1df14e(0x198)][_0x1df14e(0x245)](_0x228a97[_0x1df14e(0x223)],_0x228a97[_0x1df14e(0x106)]);_0x2742b3+=_0x4c301f;if(_0x228a97[_0x1df14e(0x10c)]){const _0x3a2bc2=await currencyService_1[_0x1df14e(0x198)][_0x1df14e(0x245)](_0x228a97[_0x1df14e(0x223)],_0x228a97['currency']),_0x4b2d0f=_0x228a97[_0x1df14e(0x10c)],_0x4b0c5c=_0x3a2bc2-_0x4b2d0f;_0x14b042+=_0x4b0c5c;}}const _0x25a983=_0x45ef2f>0x0?_0x2742b3/_0x45ef2f:0x0,_0x2ce6a2=this[_0x1df14e(0x1b9)](_0x59de6c,_0x2981c9,_0x1121b4||_0x4a55e0),_0x205b61=await database_1[_0x1df14e(0x249)][_0x1df14e(0x1fd)][_0x1df14e(0x168)]({'where':{'createdAt':_0x4fd140,'gateway':{'not':_0x1df14e(0x1ee)}}}),_0xbec028=_0x205b61>0x0?_0x45ef2f/_0x205b61*0x64:0x0;return{'totalShops':_0x3824d1,'activeShops':_0x2aa124,'totalPayments':_0x45ef2f,'successfulPayments':_0x45ef2f,'totalAttempts':_0x205b61,'chargebacks':_0x5a5cf5,'refunds':_0x41c21f,'totalRevenue':Math[_0x1df14e(0x13e)](_0x2742b3*0x64)/0x64,'trapayEarnings':Math['round'](_0x14b042*0x64)/0x64,'averagePaymentAmount':Math[_0x1df14e(0x13e)](_0x25a983*0x64)/0x64,'conversionRate':Math[_0x1df14e(0x13e)](_0xbec028*0x64)/0x64,'dailyRevenue':_0x2ce6a2[_0x1df14e(0x1b2)],'dailyPayments':_0x2ce6a2[_0x1df14e(0x166)],'recentPayments':_0x248e89[_0x1df14e(0x205)](_0x490edd=>({'id':_0x490edd['id'],'amount':_0x490edd['amount'],'currency':_0x490edd[_0x1df14e(0x106)],'status':_0x490edd['status'],'gateway':_0x490edd[_0x1df14e(0x16e)],'shop':_0x490edd['shop'],'createdAt':_0x490edd[_0x1df14e(0x163)]}))};}async[a40_0x223e0c(0x143)](_0x21c601){const _0xbf9679=a40_0x223e0c;console[_0xbf9679(0x23a)](_0xbf9679(0x228),_0x21c601);let _0x1fdd74,_0x3b634f=new Date();if(_0x21c601[_0xbf9679(0x1df)]===_0xbf9679(0x191)&&_0x21c601[_0xbf9679(0x16d)]&&_0x21c601['dateTo'])_0x1fdd74=new Date(_0x21c601['dateFrom']),_0x3b634f=new Date(_0x21c601[_0xbf9679(0x173)]),_0x1fdd74[_0xbf9679(0x1fa)](0x0,0x0,0x0,0x0),_0x3b634f[_0xbf9679(0x1fa)](0x17,0x3b,0x3b,0x3e7);else{const _0x15a70b=new Date();switch(_0x21c601[_0xbf9679(0x1df)]){case _0xbf9679(0x1b4):_0x1fdd74=new Date(_0x15a70b[_0xbf9679(0x14e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xbf9679(0x115):_0x1fdd74=new Date(_0x15a70b[_0xbf9679(0x14e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xbf9679(0x15b):_0x1fdd74=new Date(_0x15a70b['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0xbf9679(0x162):default:_0x1fdd74=new Date(_0xbf9679(0x1e7));break;}_0x1fdd74['setHours'](0x0,0x0,0x0,0x0),_0x3b634f[_0xbf9679(0x1fa)](0x17,0x3b,0x3b,0x3e7);}console[_0xbf9679(0x23a)](_0xbf9679(0x1ac)+_0x1fdd74['toISOString']()+_0xbf9679(0x1b7)+_0x3b634f[_0xbf9679(0x185)]());const _0x74b295={'status':_0xbf9679(0x159),'gateway':{'not':_0xbf9679(0x1ee)},'paidAt':{'gte':_0x1fdd74,'lte':_0x3b634f}};_0x21c601[_0xbf9679(0x216)]&&(_0x74b295[_0xbf9679(0x216)]=_0x21c601[_0xbf9679(0x216)]);const _0x4231e9=await database_1[_0xbf9679(0x249)]['payment'][_0xbf9679(0x24a)]({'where':_0x74b295,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0xbf9679(0x23a)](_0xbf9679(0x217)+_0x4231e9[_0xbf9679(0x19d)]+_0xbf9679(0x16a));const _0x21bc1a={'gateway':{'not':_0xbf9679(0x1ee)},'createdAt':{'gte':_0x1fdd74,'lte':_0x3b634f}};_0x21c601[_0xbf9679(0x216)]&&(_0x21bc1a['shopId']=_0x21c601[_0xbf9679(0x216)]);const _0x2ccb84=await database_1['default']['payment']['count']({'where':_0x21bc1a}),_0x18b7dc={..._0x21bc1a,'status':_0xbf9679(0x135)},_0x1a1de6={..._0x21bc1a,'status':_0xbf9679(0x1b5)},[_0x10df83,_0x382a67]=await Promise[_0xbf9679(0x162)]([database_1['default'][_0xbf9679(0x1fd)][_0xbf9679(0x168)]({'where':_0x18b7dc}),database_1[_0xbf9679(0x249)][_0xbf9679(0x1fd)][_0xbf9679(0x168)]({'where':_0x1a1de6})]);console['log'](_0xbf9679(0x104)+_0x2ccb84+',\x20successful:\x20'+_0x4231e9[_0xbf9679(0x19d)]+_0xbf9679(0x144)+_0x10df83+_0xbf9679(0x190)+_0x382a67);let _0x80f236=0x0,_0x10de16=0x0,_0x5c2f8d=0x0;const _0x243303={},_0x57f2cc={},_0x137eca={};for(const _0x1031f1 of _0x4231e9){try{const _0x32d809=_0x1031f1[_0xbf9679(0x226)]||0x0;if(_0x32d809<=0x0){console[_0xbf9679(0x1a9)](_0xbf9679(0x251)+_0x1031f1['id']+_0xbf9679(0x1f3));continue;}let _0x503037,_0x1bb434;if(_0x1031f1[_0xbf9679(0x10c)]!==null&&_0x1031f1['amountAfterGatewayCommissionUSDT']!==undefined)_0x503037=_0x1031f1[_0xbf9679(0x10c)],_0x1bb434=_0x32d809-_0x503037,console['log'](_0xbf9679(0x1c4)+_0x1031f1['id']+':\x20'+_0x32d809[_0xbf9679(0x214)](0x6)+_0xbf9679(0xf2)+_0x503037[_0xbf9679(0x214)](0x6)+_0xbf9679(0x1a8));else{let _0x4feea0={};if(_0x1031f1[_0xbf9679(0x170)][_0xbf9679(0x14f)])try{_0x4feea0=JSON[_0xbf9679(0x1d6)](_0x1031f1[_0xbf9679(0x170)][_0xbf9679(0x14f)]);}catch(_0x38def3){console[_0xbf9679(0x179)](_0xbf9679(0x122)+_0x1031f1['shopId']+':',_0x38def3);}let _0x273be2=0x2d;for(const [_0xe388af,_0x20c0c4]of Object['entries'](_0x4feea0)){if(_0xe388af['toLowerCase']()===_0x1031f1[_0xbf9679(0x16e)][_0xbf9679(0x155)]()){_0x273be2=_0x20c0c4[_0xbf9679(0x1e6)]||0x2d;break;}}_0x1bb434=_0x32d809*(_0x273be2/0x64),_0x503037=_0x32d809-_0x1bb434,console['log'](_0xbf9679(0x243)+_0x1031f1['id']+':\x20'+_0x273be2+_0xbf9679(0x200)+_0x32d809[_0xbf9679(0x214)](0x6)+'\x20USDT');}_0x80f236+=_0x32d809,_0x10de16+=_0x503037,_0x5c2f8d+=_0x1bb434;let _0x157784;_0x1031f1[_0xbf9679(0x218)]!==null&&_0x1031f1['gatewayCommissionRate']!==undefined?(_0x157784=_0x1031f1[_0xbf9679(0x218)],console[_0xbf9679(0x23a)]('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x1031f1['id']+':\x20'+_0x157784+'%')):(_0x157784=_0x32d809>0x0?_0x1bb434/_0x32d809*0x64:0x0,console[_0xbf9679(0x23a)]('📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x1031f1['id']+':\x20'+_0x157784[_0xbf9679(0x214)](0x2)+'%'));!_0x243303[_0x1031f1[_0xbf9679(0x16e)]]&&(_0x243303[_0x1031f1['gateway']]={'gateway':_0x1031f1[_0xbf9679(0x16e)],'gatewayDisplayName':this[_0xbf9679(0x18d)](_0x1031f1[_0xbf9679(0x16e)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x243303[_0x1031f1[_0xbf9679(0x16e)]][_0xbf9679(0x183)]++,_0x243303[_0x1031f1[_0xbf9679(0x16e)]][_0xbf9679(0x178)]+=_0x32d809,_0x243303[_0x1031f1['gateway']][_0xbf9679(0x203)]+=_0x1bb434,_0x243303[_0x1031f1[_0xbf9679(0x16e)]][_0xbf9679(0x147)]+=_0x503037,_0x243303[_0x1031f1['gateway']][_0xbf9679(0x1eb)]+=_0x157784;!_0x21c601['shopId']&&(!_0x57f2cc[_0x1031f1['shopId']]&&(_0x57f2cc[_0x1031f1[_0xbf9679(0x216)]]={'shopId':_0x1031f1['shopId'],'shopName':_0x1031f1[_0xbf9679(0x170)]['name'],'shopUsername':_0x1031f1[_0xbf9679(0x170)][_0xbf9679(0x229)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x57f2cc[_0x1031f1[_0xbf9679(0x216)]][_0xbf9679(0x183)]++,_0x57f2cc[_0x1031f1[_0xbf9679(0x216)]][_0xbf9679(0x178)]+=_0x32d809,_0x57f2cc[_0x1031f1[_0xbf9679(0x216)]][_0xbf9679(0x203)]+=_0x1bb434,_0x57f2cc[_0x1031f1[_0xbf9679(0x216)]][_0xbf9679(0x147)]+=_0x503037);const _0x32b877=_0x1031f1[_0xbf9679(0x14b)][_0xbf9679(0x185)]()[_0xbf9679(0x18f)]('T')[0x0];!_0x137eca[_0x32b877]&&(_0x137eca[_0x32b877]={'date':_0x32b877,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x137eca[_0x32b877][_0xbf9679(0x125)]+=_0x32d809,_0x137eca[_0x32b877][_0xbf9679(0x1b3)]+=_0x503037,_0x137eca[_0x32b877][_0xbf9679(0x23c)]+=_0x1bb434,_0x137eca[_0x32b877][_0xbf9679(0x183)]++;}catch(_0x429652){console[_0xbf9679(0x179)](_0xbf9679(0x237)+_0x1031f1['id']+':',_0x429652);}}Object[_0xbf9679(0x15d)](_0x243303)['forEach'](_0x517c68=>{const _0x14814d=_0xbf9679;_0x517c68[_0x14814d(0x222)]=_0x517c68['paymentsCount']>0x0?_0x517c68[_0x14814d(0x1eb)]/_0x517c68[_0x14814d(0x183)]:0x0,delete _0x517c68[_0x14814d(0x1eb)];}),Object[_0xbf9679(0x15d)](_0x57f2cc)['forEach'](_0x66cf4d=>{const _0x2f6e2d=_0xbf9679;_0x66cf4d[_0x2f6e2d(0x108)]=_0x66cf4d['paymentsCount']>0x0?_0x66cf4d[_0x2f6e2d(0x178)]/_0x66cf4d['paymentsCount']:0x0;});let _0x38246d=0x0,_0x407f81=0x0;if(_0x21c601['shopId']){const _0x697eab=await database_1[_0xbf9679(0x249)]['payout'][_0xbf9679(0x24a)]({'where':{'shopId':_0x21c601[_0xbf9679(0x216)],'status':_0xbf9679(0x119),'createdAt':{'gte':_0x1fdd74,'lte':_0x3b634f}},'select':{'amount':!![]}});_0x38246d=_0x697eab[_0xbf9679(0x21e)]((_0x48a701,_0x18a364)=>_0x48a701+_0x18a364[_0xbf9679(0x223)],0x0);const _0x4705cf=await database_1[_0xbf9679(0x249)][_0xbf9679(0x180)][_0xbf9679(0x24a)]({'where':{'shopId':_0x21c601[_0xbf9679(0x216)],'status':_0xbf9679(0x233),'createdAt':{'gte':_0x1fdd74,'lte':_0x3b634f}},'select':{'amount':!![]}});_0x407f81=_0x4705cf[_0xbf9679(0x21e)]((_0x18816e,_0x4359cb)=>_0x18816e+_0x4359cb[_0xbf9679(0x223)],0x0);}const _0x5892a7=_0x2ccb84,_0x2c2086=_0x4231e9['length'],_0x4be453=_0x2c2086>0x0?_0x80f236/_0x2c2086:0x0,_0x486754=_0x5892a7>0x0?Math[_0xbf9679(0x13e)](_0x2c2086/_0x5892a7*0x2710)/0x64:0x0,_0x4bd438=Math[_0xbf9679(0x1cc)]((_0x3b634f[_0xbf9679(0x14e)]()-_0x1fdd74[_0xbf9679(0x14e)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2b2889={'totalTurnover':Math['round'](_0x80f236*0x64)/0x64,'merchantEarnings':Math['round'](_0x10de16*0x64)/0x64,'gatewayEarnings':Math[_0xbf9679(0x13e)](_0x5c2f8d*0x64)/0x64,'totalPaidOut':Math[_0xbf9679(0x13e)](_0x38246d*0x64)/0x64,'pendingPayout':Math[_0xbf9679(0x13e)](_0x407f81*0x64)/0x64,'averageCheck':Math[_0xbf9679(0x13e)](_0x4be453*0x64)/0x64,'totalPayments':_0x5892a7,'successfulPayments':_0x2c2086,'conversionRate':_0x486754,'chargebacks':_0x10df83,'refunds':_0x382a67,'gatewayBreakdown':Object['values'](_0x243303)[_0xbf9679(0x205)](_0x3748f5=>({..._0x3748f5,'turnoverUSDT':Math['round'](_0x3748f5[_0xbf9679(0x178)]*0x64)/0x64,'commissionUSDT':Math[_0xbf9679(0x13e)](_0x3748f5[_0xbf9679(0x203)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0xbf9679(0x13e)](_0x3748f5['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0xbf9679(0x13e)](_0x3748f5[_0xbf9679(0x222)]*0x64)/0x64})),'merchantBreakdown':_0x21c601[_0xbf9679(0x216)]?undefined:Object['values'](_0x57f2cc)[_0xbf9679(0x205)](_0x423670=>({..._0x423670,'turnoverUSDT':Math[_0xbf9679(0x13e)](_0x423670['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x423670[_0xbf9679(0x203)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0xbf9679(0x13e)](_0x423670['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0xbf9679(0x13e)](_0x423670[_0xbf9679(0x121)]*0x64)/0x64,'averageCheckUSDT':Math[_0xbf9679(0x13e)](_0x423670[_0xbf9679(0x108)]*0x64)/0x64})),'dailyData':Object[_0xbf9679(0x15d)](_0x137eca)[_0xbf9679(0x205)](_0x1e3a0b=>({..._0x1e3a0b,'turnover':Math[_0xbf9679(0x13e)](_0x1e3a0b['turnover']*0x64)/0x64,'merchantEarnings':Math[_0xbf9679(0x13e)](_0x1e3a0b[_0xbf9679(0x1b3)]*0x64)/0x64,'gatewayEarnings':Math[_0xbf9679(0x13e)](_0x1e3a0b['gatewayEarnings']*0x64)/0x64}))[_0xbf9679(0x1e8)]((_0x11ccd7,_0x5c0bd3)=>_0x11ccd7[_0xbf9679(0x114)][_0xbf9679(0x1cf)](_0x5c0bd3['date'])),'periodInfo':{'from':_0x1fdd74,'to':_0x3b634f,'periodType':_0x21c601[_0xbf9679(0x1df)]||_0xbf9679(0x191),'daysCount':_0x4bd438}};return console[_0xbf9679(0x23a)](_0xbf9679(0x20f)),console['log'](_0xbf9679(0x1ea)+_0x2b2889[_0xbf9679(0x17b)]+'\x20USDT'),console[_0xbf9679(0x23a)](_0xbf9679(0x232)+_0x2b2889['merchantEarnings']+_0xbf9679(0x1a8)),console[_0xbf9679(0x23a)](_0xbf9679(0x209)+_0x2b2889[_0xbf9679(0x23c)]+_0xbf9679(0x1a8)),console[_0xbf9679(0x23a)]('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0x2b2889['totalPaidOut']+_0xbf9679(0x1a8)),console[_0xbf9679(0x23a)](_0xbf9679(0x103)+_0x2b2889['pendingPayout']+_0xbf9679(0x1a8)),console['log'](_0xbf9679(0x20a)+_0x2b2889['totalPayments']),_0x2b2889;}async['getMerchantsSelection'](_0x412569){const _0x1d94ee=a40_0x223e0c;console['log'](_0x1d94ee(0x235),{'hasPayoutHistory':_0x412569});let _0x503634={'status':'ACTIVE'};_0x412569&&(_0x503634[_0x1d94ee(0x19a)]={'some':{}});const _0x140694=await database_1['default'][_0x1d94ee(0x170)][_0x1d94ee(0x24a)]({'where':_0x503634,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1d94ee(0x136)}});return console[_0x1d94ee(0x23a)](_0x1d94ee(0x20c)+_0x140694[_0x1d94ee(0x19d)]+'\x20active\x20merchants\x20for\x20selection'+(_0x412569?_0x1d94ee(0x1e3):'')),_0x140694[_0x1d94ee(0x205)](_0xc2c92b=>({'id':_0xc2c92b['id'],'username':_0xc2c92b[_0x1d94ee(0x229)],'name':_0xc2c92b[_0x1d94ee(0x10d)]}));}[a40_0x223e0c(0x18d)](_0xc65886){const _0x13ee4f=a40_0x223e0c,_0x285b43={'test_gateway':_0x13ee4f(0x16b),'plisio':_0x13ee4f(0x176),'rapyd':_0x13ee4f(0x19f),'noda':'Noda','cointopay':_0x13ee4f(0x199),'cointopay2':_0x13ee4f(0x1e5),'klyme_eu':_0x13ee4f(0x17c),'klyme_gb':_0x13ee4f(0x105),'klyme_de':_0x13ee4f(0x172),'mastercard':_0x13ee4f(0x1f0)};return _0x285b43[_0xc65886]||_0xc65886;}[a40_0x223e0c(0x129)](_0x2ed8b0){const _0x3b783f=a40_0x223e0c,_0x308868={'Test\x20Gateway':_0x3b783f(0x1ee),'Plisio':_0x3b783f(0x241),'Rapyd':'rapyd','Noda':'noda','CoinToPay':_0x3b783f(0x1bf),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x3b783f(0x1be),'KLYME\x20GB':_0x3b783f(0x126),'KLYME\x20DE':_0x3b783f(0x167),'MasterCard':_0x3b783f(0x24c)};return _0x308868[_0x2ed8b0]||_0x2ed8b0[_0x3b783f(0x155)]();}async['getMerchantsAwaitingPayout'](_0x23f671){const _0x566278=a40_0x223e0c,{page:_0x56728f,limit:_0x1cc3e0,minAmount:_0x10c17d,search:_0x3289be}=_0x23f671;console['log'](_0x566278(0x12b),_0x23f671);let _0x20de4c={'status':_0x566278(0xff)};_0x3289be&&(_0x20de4c[_0x566278(0x10d)]={'contains':_0x3289be,'mode':_0x566278(0x1d2)});const _0x3d11fd=await database_1[_0x566278(0x249)][_0x566278(0x170)]['findMany']({'where':_0x20de4c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x2ad4e8=_0x3d11fd['filter'](_0x5dfdfc=>{const _0x5e4b74=_0x566278,_0xa97f68=Math[_0x5e4b74(0x1dd)](_0x5dfdfc[_0x5e4b74(0x117)]*0x64)/0x64;if(_0x10c17d&&_0xa97f68<_0x10c17d)return![];return _0xa97f68!==0x0;});_0x2ad4e8[_0x566278(0x1e8)]((_0x2c9be8,_0x328ba5)=>_0x328ba5[_0x566278(0x117)]-_0x2c9be8[_0x566278(0x117)]);const _0x47edba=_0x2ad4e8[_0x566278(0x19d)],_0x1b59c6=(_0x56728f-0x1)*_0x1cc3e0,_0x3c5a65=_0x2ad4e8[_0x566278(0x161)](_0x1b59c6,_0x1b59c6+_0x1cc3e0);console[_0x566278(0x23a)](_0x566278(0x217)+_0x3c5a65[_0x566278(0x19d)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x128cf4=await Promise[_0x566278(0x162)](_0x3c5a65[_0x566278(0x205)](async _0x88c3d=>{const _0x53b07c=_0x566278,[_0x5f47bf,_0x168e1c,_0x4e4a35]=await Promise['all']([database_1['default']['payment'][_0x53b07c(0x168)]({'where':{'shopId':_0x88c3d['id'],'status':_0x53b07c(0x159),'gateway':{'not':_0x53b07c(0x1ee)}}}),database_1[_0x53b07c(0x249)][_0x53b07c(0x1fd)]['findFirst']({'where':{'shopId':_0x88c3d['id'],'status':_0x53b07c(0x159),'gateway':{'not':_0x53b07c(0x1ee)}},'orderBy':{'paidAt':_0x53b07c(0x136)},'select':{'paidAt':!![]}}),database_1['default'][_0x53b07c(0x1fd)]['groupBy']({'by':[_0x53b07c(0x16e)],'where':{'shopId':_0x88c3d['id'],'status':_0x53b07c(0x159),'gateway':{'not':_0x53b07c(0x1ee)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x22e9aa=new Date(),_0xfa4add=new Date(_0x22e9aa[_0x53b07c(0x1a5)](),_0x22e9aa[_0x53b07c(0x11a)](),0x1),_0x47a135=new Date(_0x22e9aa['getFullYear'](),_0x22e9aa['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3fd7c8,_0x198480]=await Promise[_0x53b07c(0x162)]([database_1[_0x53b07c(0x249)][_0x53b07c(0x180)][_0x53b07c(0x1f8)]({'_sum':{'amount':!![]},'where':{'shopId':_0x88c3d['id'],'status':'COMPLETED'}}),database_1[_0x53b07c(0x249)]['payout'][_0x53b07c(0x1f8)]({'_sum':{'amount':!![]},'where':{'shopId':_0x88c3d['id'],'status':'COMPLETED','createdAt':{'gte':_0xfa4add,'lte':_0x47a135}}})]),_0x3db078=_0x3fd7c8[_0x53b07c(0x1c3)]['amount']||0x0,_0xc719f1=_0x198480[_0x53b07c(0x1c3)][_0x53b07c(0x223)]||0x0,_0x1d28b2=await Promise[_0x53b07c(0x162)](_0x4e4a35[_0x53b07c(0x205)](async _0x5bb46c=>{const _0x528768=_0x53b07c;let _0x282a47=0x2d;if(_0x88c3d[_0x528768(0x14f)])try{const _0x49b1d3=JSON[_0x528768(0x1d6)](_0x88c3d[_0x528768(0x14f)]);for(const [_0x399c45,_0x48f346]of Object[_0x528768(0x11f)](_0x49b1d3)){if(_0x399c45['toLowerCase']()===_0x5bb46c[_0x528768(0x16e)][_0x528768(0x155)]()){_0x282a47=_0x48f346[_0x528768(0x1e6)]||0xa,console[_0x528768(0x23a)](_0x528768(0xf6)+_0x5bb46c[_0x528768(0x16e)]+_0x528768(0xfb)+_0x88c3d['id']+_0x528768(0x1ab)+_0x282a47+'%');break;}}}catch(_0x3064c2){console[_0x528768(0x179)](_0x528768(0x122)+_0x88c3d['id']+':',_0x3064c2);}const _0x3d78f8=_0x5bb46c[_0x528768(0x1c3)]?.[_0x528768(0x226)]||0x0,_0x26a7d3=_0x3d78f8*(0x1-_0x282a47/0x64);return{'gateway':_0x5bb46c[_0x528768(0x16e)],'count':_0x5bb46c['_count']?.['id']||0x0,'amountUSDT':Math[_0x528768(0x13e)](_0x3d78f8*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x528768(0x13e)](_0x26a7d3*0x64)/0x64,'commission':_0x282a47};})),_0xf859=_0x1d28b2[_0x53b07c(0x21e)]((_0x2b615e,_0x25edd8)=>_0x2b615e+_0x25edd8['amountUSDT'],0x0),_0x5ae452=_0x1d28b2['reduce']((_0xa0ff17,_0x4acf96)=>_0xa0ff17+_0x4acf96[_0x53b07c(0x204)],0x0),_0x1fe0ac=_0x88c3d['balance'];return console[_0x53b07c(0x23a)]('💰\x20[PAYOUT]\x20Merchant\x20'+_0x88c3d[_0x53b07c(0x229)]+':'),console['log']('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0xf859[_0x53b07c(0x214)](0x2)+_0x53b07c(0x113)),console['log'](_0x53b07c(0x10e)+_0x5ae452['toFixed'](0x2)+_0x53b07c(0x10f)),console[_0x53b07c(0x23a)](_0x53b07c(0x175)+_0x1fe0ac[_0x53b07c(0x214)](0x2)+_0x53b07c(0xf1)),console[_0x53b07c(0x23a)](_0x53b07c(0x1cd)+_0x3db078[_0x53b07c(0x214)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0x53b07c(0x23a)](_0x53b07c(0x150)+(_0x5ae452-_0x3db078-_0x1fe0ac)[_0x53b07c(0x214)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x88c3d['id'],'fullName':_0x88c3d[_0x53b07c(0x10d)],'username':_0x88c3d[_0x53b07c(0x229)],'telegramId':_0x88c3d[_0x53b07c(0x1e4)],'merchantUrl':_0x88c3d[_0x53b07c(0x118)],'wallets':{'usdtPolygonWallet':_0x88c3d['usdtPolygonWallet'],'usdtTrcWallet':_0x88c3d[_0x53b07c(0x18e)],'usdtErcWallet':_0x88c3d[_0x53b07c(0x15c)],'usdcPolygonWallet':_0x88c3d[_0x53b07c(0x137)],'usdcErcWallet':_0x88c3d[_0x53b07c(0x13d)]},'totalAmountUSDT':Math[_0x53b07c(0x13e)](_0xf859*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x53b07c(0x13e)](_0x5ae452*0x64)/0x64,'currentBalance':Math[_0x53b07c(0x1dd)](_0x1fe0ac*0x64)/0x64,'totalPayout':Math['round'](_0x3db078*0x64)/0x64,'thisMonth':Math['round'](_0xc719f1*0x64)/0x64,'paymentsCount':_0x5f47bf,'oldestPaymentDate':_0x168e1c?.['paidAt']||_0x88c3d[_0x53b07c(0x163)],'gatewayBreakdown':_0x1d28b2};})),_0x574705=_0x128cf4[_0x566278(0x21e)]((_0x3ea0d2,_0x2d8fd4)=>_0x3ea0d2+_0x2d8fd4['totalAmountUSDT'],0x0),_0x53d974=_0x128cf4[_0x566278(0x21e)]((_0x405bbd,_0x4d978a)=>_0x405bbd+_0x4d978a[_0x566278(0x1ed)],0x0),_0x429c93=_0x128cf4[_0x566278(0x21e)]((_0x199b08,_0x3add70)=>_0x199b08+_0x3add70[_0x566278(0x16f)],0x0),_0x5b1081=_0x128cf4[_0x566278(0x21e)]((_0x333c0a,_0x393e1f)=>_0x333c0a+_0x393e1f['thisMonth'],0x0);return console[_0x566278(0x23a)](_0x566278(0x1e2)+_0x47edba+_0x566278(0x244)),console[_0x566278(0x23a)](_0x566278(0x151)+Math[_0x566278(0x13e)](_0x574705*0x64)/0x64+_0x566278(0x113)),console[_0x566278(0x23a)](_0x566278(0x196)+Math[_0x566278(0x13e)](_0x53d974*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x566278(0x23a)](_0x566278(0xf4)+Math[_0x566278(0x13e)](_0x429c93*0x64)/0x64+_0x566278(0x1a8)),console[_0x566278(0x23a)](_0x566278(0x1cb)+Math[_0x566278(0x13e)](_0x5b1081*0x64)/0x64+_0x566278(0x1a8)),{'merchants':_0x128cf4,'pagination':{'page':_0x56728f,'limit':_0x1cc3e0,'total':_0x47edba,'totalPages':Math[_0x566278(0x1cc)](_0x47edba/_0x1cc3e0)},'summary':{'totalMerchants':_0x47edba,'totalAmountUSDT':Math['round'](_0x574705*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x566278(0x13e)](_0x53d974*0x64)/0x64,'totalPayout':Math['round'](_0x429c93*0x64)/0x64,'thisMonth':Math[_0x566278(0x13e)](_0x5b1081*0x64)/0x64}};}async[a40_0x223e0c(0x224)](_0x4a2e33){const _0x49c957=a40_0x223e0c,{shopId:_0x1db091,amount:_0x3da8db,network:_0x3ff41a,wallet:_0x38d16c,notes:_0x44bdad,txid:_0x186cae,periodFrom:_0x3daedf,periodTo:_0x455b9a}=_0x4a2e33,_0x53a664=await database_1[_0x49c957(0x249)][_0x49c957(0x189)](async _0x3a976e=>{const _0x509c31=_0x49c957,_0xcd7265=await _0x3a976e[_0x509c31(0x170)][_0x509c31(0x234)]({'where':{'id':_0x1db091},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xcd7265)throw new Error(_0x509c31(0x101));console['log'](_0x509c31(0x1c1)+_0xcd7265['username']+':'),console[_0x509c31(0x23a)](_0x509c31(0x192)+_0xcd7265[_0x509c31(0x117)][_0x509c31(0x214)](0x6)+_0x509c31(0x1a8)),console[_0x509c31(0x23a)]('\x20\x20\x20Payout\x20amount:\x20'+_0x3da8db[_0x509c31(0x214)](0x6)+_0x509c31(0x1a8)),console[_0x509c31(0x23a)](_0x509c31(0x1fb)+_0xcd7265[_0x509c31(0x225)][_0x509c31(0x214)](0x6)+_0x509c31(0x1a8));if(_0x186cae)console[_0x509c31(0x23a)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x186cae);const _0x5c6c10=0.000001,_0x52d4c7=Number(_0xcd7265[_0x509c31(0x117)]),_0x19eb12=Number(_0x3da8db);console['log'](_0x509c31(0x177)),console['log'](_0x509c31(0xf8)+_0xcd7265[_0x509c31(0x117)]),console[_0x509c31(0x23a)](_0x509c31(0x164)+_0x52d4c7),console[_0x509c31(0x23a)](_0x509c31(0x210)+_0x19eb12),console['log']('\x20\x20\x20Difference:\x20'+(_0x52d4c7-_0x19eb12)),console[_0x509c31(0x23a)]('\x20\x20\x20Tolerance:\x20'+_0x5c6c10);if(_0x52d4c7<_0x19eb12-_0x5c6c10)throw new Error(_0x509c31(0x156)+_0x52d4c7['toFixed'](0x6)+'\x20USDT,\x20Requested:\x20'+_0x19eb12[_0x509c31(0x214)](0x6)+_0x509c31(0x127)+(_0x52d4c7-_0x19eb12)[_0x509c31(0x214)](0x8)+_0x509c31(0x1a8));console['log']('✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x1c0fff=Math[_0x509c31(0x248)](_0x52d4c7,_0x19eb12);let _0x1e5a71=_0x38d16c;console[_0x509c31(0x23a)](_0x509c31(0x1c2)+(_0x38d16c||'not\x20provided'));if(!_0x1e5a71){console['log']('🔍\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x714b04=await _0x3a976e[_0x509c31(0x170)][_0x509c31(0x234)]({'where':{'id':_0x1db091},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x509c31(0x230),_0x714b04);if(_0x714b04)switch(_0x3ff41a){case _0x509c31(0x24b):_0x1e5a71=_0x714b04[_0x509c31(0x18b)]||undefined,console[_0x509c31(0x23a)](_0x509c31(0x206)+_0x1e5a71);break;case _0x509c31(0x208):_0x1e5a71=_0x714b04['usdtTrcWallet']||undefined,console[_0x509c31(0x23a)](_0x509c31(0xfe)+_0x1e5a71);break;case _0x509c31(0x219):_0x1e5a71=_0x714b04[_0x509c31(0x15c)]||undefined,console[_0x509c31(0x23a)](_0x509c31(0xfd)+_0x1e5a71);break;case'polygon_usdc':_0x1e5a71=_0x714b04[_0x509c31(0x137)]||undefined,console['log'](_0x509c31(0x13b)+_0x1e5a71);break;case _0x509c31(0x1a6):_0x1e5a71=_0x714b04[_0x509c31(0x13d)]||undefined,console[_0x509c31(0x23a)](_0x509c31(0x1a2)+_0x1e5a71);break;}}else console[_0x509c31(0x23a)]('✅\x20Using\x20wallet\x20from\x20request:\x20'+_0x1e5a71);console[_0x509c31(0x23a)](_0x509c31(0x102)+_0x3ff41a+':\x20'+(_0x1e5a71||_0x509c31(0x1bd))),console['log'](_0x509c31(0x130),{'shopId':_0x1db091,'amount':_0x1c0fff,'network':_0x3ff41a,'wallet':_0x1e5a71,'status':_0x509c31(0x119),'txid':_0x186cae,'notes':_0x44bdad,'periodFrom':_0x3daedf?new Date(_0x3daedf):null,'periodTo':_0x455b9a?new Date(_0x455b9a):null});const _0x51f8f6=await _0x3a976e[_0x509c31(0x180)][_0x509c31(0x11d)]({'data':{'shopId':_0x1db091,'amount':_0x1c0fff,'network':_0x3ff41a,'wallet':_0x1e5a71,'status':_0x509c31(0x119),'txid':_0x186cae,'notes':_0x44bdad,'periodFrom':_0x3daedf?new Date(_0x3daedf):null,'periodTo':_0x455b9a?new Date(_0x455b9a):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x509c31(0x23a)]('✅\x20Payout\x20created\x20in\x20DB:',{'id':_0x51f8f6['id'],'wallet':_0x51f8f6[_0x509c31(0x239)],'network':_0x51f8f6[_0x509c31(0x24f)],'amount':_0x51f8f6[_0x509c31(0x223)]});const _0x37e142=_0x52d4c7-_0x1c0fff,_0xb73097=Number(_0xcd7265['totalPaidOut'])+_0x1c0fff;return await _0x3a976e['shop'][_0x509c31(0x227)]({'where':{'id':_0x1db091},'data':{'balance':_0x37e142,'totalPaidOut':_0xb73097}}),console['log'](_0x509c31(0x12d)+_0xcd7265['username']+'\x20balance\x20updated:'),console['log'](_0x509c31(0x215)+_0x52d4c7['toFixed'](0x6)+_0x509c31(0x17a)+_0x37e142[_0x509c31(0x214)](0x6)+_0x509c31(0xf3)+_0x1c0fff['toFixed'](0x6)+')'),console[_0x509c31(0x23a)](_0x509c31(0x24d)+_0xcd7265[_0x509c31(0x225)][_0x509c31(0x214)](0x6)+'\x20->\x20'+_0xb73097['toFixed'](0x6)+_0x509c31(0x15f)+_0x1c0fff[_0x509c31(0x214)](0x6)+')'),console[_0x509c31(0x23a)](_0x509c31(0x1b6)+_0x1c0fff[_0x509c31(0x214)](0x6)+_0x509c31(0x1a8)),{'payout':_0x51f8f6,'shop':_0xcd7265};});console[_0x49c957(0x23a)](_0x49c957(0x213)+_0x53a664[_0x49c957(0x180)]['id']+_0x49c957(0xfb)+_0x53a664['shop'][_0x49c957(0x229)]+'\x20('+_0x53a664[_0x49c957(0x180)][_0x49c957(0x223)][_0x49c957(0x214)](0x6)+_0x49c957(0x22e));try{let _0x49eef0=_0x49c957(0x1b1);if(_0x53a664[_0x49c957(0x180)][_0x49c957(0x1f7)]&&_0x53a664[_0x49c957(0x180)][_0x49c957(0x110)]){const _0x361e89=new Date(_0x53a664[_0x49c957(0x180)][_0x49c957(0x1f7)])['toLocaleDateString'](_0x49c957(0x1d4)),_0x462bba=new Date(_0x53a664['payout']['periodTo'])[_0x49c957(0x1d1)](_0x49c957(0x1d4));_0x49eef0=_0x361e89+_0x49c957(0x154)+_0x462bba;}await telegramBotService_1[_0x49c957(0x1ca)][_0x49c957(0x13a)](_0x53a664['payout'][_0x49c957(0x216)],{'id':_0x53a664[_0x49c957(0x180)]['id'],'amount':_0x53a664[_0x49c957(0x180)][_0x49c957(0x223)],'network':_0x53a664[_0x49c957(0x180)][_0x49c957(0x24f)],'wallet':_0x53a664[_0x49c957(0x180)][_0x49c957(0x239)],'period':_0x49eef0,'createdAt':_0x53a664['payout'][_0x49c957(0x163)],'txid':_0x53a664[_0x49c957(0x180)][_0x49c957(0x19e)]}),console[_0x49c957(0x23a)]('📱\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x53a664[_0x49c957(0x180)]['id']);}catch(_0x426dee){console[_0x49c957(0x179)](_0x49c957(0x16c)+_0x53a664[_0x49c957(0x180)]['id']+':',_0x426dee);}return{'id':_0x53a664['payout']['id'],'shopId':_0x53a664[_0x49c957(0x180)][_0x49c957(0x216)],'shopName':_0x53a664[_0x49c957(0x170)]['name'],'shopUsername':_0x53a664['shop'][_0x49c957(0x229)],'amount':_0x53a664[_0x49c957(0x180)][_0x49c957(0x223)],'network':_0x53a664['payout'][_0x49c957(0x24f)],'wallet':_0x53a664[_0x49c957(0x180)]['wallet'],'status':_0x53a664['payout'][_0x49c957(0x22a)],'txid':_0x53a664[_0x49c957(0x180)][_0x49c957(0x19e)],'notes':_0x53a664[_0x49c957(0x180)][_0x49c957(0x1c6)],'periodFrom':_0x53a664[_0x49c957(0x180)][_0x49c957(0x1f7)],'periodTo':_0x53a664[_0x49c957(0x180)][_0x49c957(0x110)],'createdAt':_0x53a664[_0x49c957(0x180)]['createdAt'],'paidAt':_0x53a664['payout'][_0x49c957(0x14b)]};}async[a40_0x223e0c(0x21d)](_0x38d0d5){const _0x4b8016=a40_0x223e0c,{page:_0x4fcdab,limit:_0xfef67f,shopId:_0x4c416a,network:_0x456181,dateFrom:_0x2f303f,dateTo:_0x2968b6,search:_0x1809a7}=_0x38d0d5,_0x52b050=(_0x4fcdab-0x1)*_0xfef67f,_0x393649={};_0x4c416a&&(_0x393649[_0x4b8016(0x216)]=_0x4c416a);_0x456181&&(_0x393649[_0x4b8016(0x24f)]=_0x456181);if(_0x2f303f||_0x2968b6){_0x393649[_0x4b8016(0x163)]={};if(_0x2f303f){const _0x5577e6=new Date(_0x2f303f);_0x5577e6[_0x4b8016(0x1fa)](0x0,0x0,0x0,0x1),_0x393649[_0x4b8016(0x163)]['gte']=_0x5577e6,console['log'](_0x4b8016(0x116)+_0x5577e6[_0x4b8016(0x185)]());}if(_0x2968b6){const _0xf1439=new Date(_0x2968b6);_0xf1439[_0x4b8016(0x1fa)](0x17,0x3b,0x3b,0x3e7),_0x393649[_0x4b8016(0x163)][_0x4b8016(0x134)]=_0xf1439,console[_0x4b8016(0x23a)](_0x4b8016(0x12f)+_0xf1439[_0x4b8016(0x185)]());}}_0x1809a7&&(_0x393649['OR']=[{'shop':{'name':{'contains':_0x1809a7,'mode':_0x4b8016(0x1d2)}}},{'shop':{'username':{'contains':_0x1809a7,'mode':_0x4b8016(0x1d2)}}},{'notes':{'contains':_0x1809a7,'mode':'insensitive'}}]);const [_0x365683,_0x5b22a7]=await Promise[_0x4b8016(0x162)]([database_1['default'][_0x4b8016(0x180)][_0x4b8016(0x24a)]({'where':_0x393649,'skip':_0x52b050,'take':_0xfef67f,'orderBy':{'createdAt':_0x4b8016(0x14a)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4b8016(0x249)]['payout'][_0x4b8016(0x168)]({'where':_0x393649})]);return{'payouts':_0x365683['map'](_0x285441=>({'id':_0x285441['id'],'shopId':_0x285441[_0x4b8016(0x216)],'shopName':_0x285441[_0x4b8016(0x170)]['name'],'shopUsername':_0x285441[_0x4b8016(0x170)][_0x4b8016(0x229)],'amount':_0x285441[_0x4b8016(0x223)],'network':_0x285441['network'],'wallet':_0x285441[_0x4b8016(0x239)],'status':_0x285441[_0x4b8016(0x22a)],'txid':_0x285441['txid'],'notes':_0x285441['notes'],'periodFrom':_0x285441['periodFrom'],'periodTo':_0x285441[_0x4b8016(0x110)],'createdAt':_0x285441[_0x4b8016(0x163)],'paidAt':_0x285441['paidAt']})),'pagination':{'page':_0x4fcdab,'limit':_0xfef67f,'total':_0x5b22a7,'totalPages':Math[_0x4b8016(0x1cc)](_0x5b22a7/_0xfef67f)}};}async[a40_0x223e0c(0x1f4)](_0xd6c03d){const _0x19d805=a40_0x223e0c,_0x4762e1=await database_1['default'][_0x19d805(0x180)][_0x19d805(0x234)]({'where':{'id':_0xd6c03d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4762e1)return null;return{'id':_0x4762e1['id'],'shopId':_0x4762e1[_0x19d805(0x216)],'shopName':_0x4762e1[_0x19d805(0x170)][_0x19d805(0x10d)],'shopUsername':_0x4762e1[_0x19d805(0x170)]['username'],'amount':_0x4762e1[_0x19d805(0x223)],'network':_0x4762e1[_0x19d805(0x24f)],'wallet':_0x4762e1['wallet'],'status':_0x4762e1['status'],'txid':_0x4762e1[_0x19d805(0x19e)],'notes':_0x4762e1[_0x19d805(0x1c6)],'periodFrom':_0x4762e1[_0x19d805(0x1f7)],'periodTo':_0x4762e1[_0x19d805(0x110)],'createdAt':_0x4762e1[_0x19d805(0x163)],'paidAt':_0x4762e1[_0x19d805(0x14b)]};}async['deletePayout'](_0x5de0fa){const _0x26ba50=a40_0x223e0c;await database_1[_0x26ba50(0x249)][_0x26ba50(0x180)][_0x26ba50(0x1aa)]({'where':{'id':_0x5de0fa}});}async['getAllPayments'](_0x5695f4){const _0x4d9a89=a40_0x223e0c,{page:_0x57d66e,limit:_0x96a600,status:_0xc6fc47,gateway:_0x109572,shopId:_0x7ae75f,dateFrom:_0x2d244b,dateTo:_0x5a7f3e,search:_0x43ad6f,currency:_0x3a1228,sortBy:_0x2db640,sortOrder:_0x1f8cd1}=_0x5695f4,_0x475752=(_0x57d66e-0x1)*_0x96a600;console[_0x4d9a89(0x23a)](_0x4d9a89(0x1f2),_0x5695f4);const _0x2ca541=await database_1['default'][_0x4d9a89(0x1fd)][_0x4d9a89(0x1f9)]({'by':[_0x4d9a89(0x16e)],'_count':{'gateway':!![]}});console[_0x4d9a89(0x23a)]('📊\x20Available\x20gateways\x20in\x20database:',_0x2ca541[_0x4d9a89(0x205)](_0x1351d5=>_0x1351d5[_0x4d9a89(0x16e)]+'\x20('+_0x1351d5[_0x4d9a89(0x139)][_0x4d9a89(0x16e)]+_0x4d9a89(0x11b)));if(_0x109572){const _0x2c40bd=_0x2ca541[_0x4d9a89(0x1ae)](_0x2ca51d=>_0x2ca51d[_0x4d9a89(0x16e)]['toLowerCase']()===_0x109572['toLowerCase']());!_0x2c40bd&&_0x109572['toLowerCase']()!==_0x4d9a89(0x1ee)&&console[_0x4d9a89(0x23a)](_0x4d9a89(0x149)+_0x109572+_0x4d9a89(0x22f)+_0x2ca541[_0x4d9a89(0x205)](_0x3165b=>_0x3165b['gateway'])[_0x4d9a89(0x201)](',\x20'));}const _0x575ef4={};_0xc6fc47&&(_0x575ef4[_0x4d9a89(0x22a)]=_0xc6fc47[_0x4d9a89(0x140)]());if(!_0x109572)_0x575ef4['gateway']={'not':'test_gateway'};else{if(_0x109572&&(_0x109572[_0x4d9a89(0x155)]()===_0x4d9a89(0x1ee)||_0x109572===_0x4d9a89(0x1d0)))_0x575ef4[_0x4d9a89(0x16e)]='test_gateway';else{let _0x2cbc98=_0x109572;const _0x1cd340=(0x0,gateway_1['getGatewayNameById'])(_0x109572);if(_0x1cd340)_0x2cbc98=_0x1cd340,console[_0x4d9a89(0x23a)]('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x109572+_0x4d9a89(0x22d)+_0x2cbc98+'\x27');else{const _0x41b2c0=(0x0,gateway_1[_0x4d9a89(0x11c)])(_0x109572);if(_0x41b2c0){const _0x19633e=(0x0,gateway_1[_0x4d9a89(0x15a)])(_0x41b2c0);_0x19633e&&(_0x2cbc98=_0x19633e,console[_0x4d9a89(0x23a)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x109572+_0x4d9a89(0x10a)+_0x41b2c0+_0x4d9a89(0x169)+_0x2cbc98+'\x27'));}else console[_0x4d9a89(0x23a)](_0x4d9a89(0x1ef)+_0x109572+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2b416a=await database_1[_0x4d9a89(0x249)]['payment'][_0x4d9a89(0x168)]({'where':{'gateway':_0x2cbc98[_0x4d9a89(0x155)]()},'take':0x1});_0x2b416a===0x0?(console['log']('⚠️\x20Gateway\x20\x27'+_0x2cbc98+_0x4d9a89(0x13f)+_0x109572+_0x4d9a89(0x1e1)),_0x575ef4[_0x4d9a89(0x16e)]=_0x4d9a89(0x23f)):(_0x575ef4[_0x4d9a89(0x16e)]=_0x2cbc98[_0x4d9a89(0x155)](),console[_0x4d9a89(0x23a)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x2cbc98+_0x4d9a89(0x13f)+_0x109572+'\x27)'));}}console[_0x4d9a89(0x23a)]('📊\x20Gateway\x20filter\x20applied:',_0x575ef4[_0x4d9a89(0x16e)]);_0x7ae75f&&(_0x575ef4['shopId']=_0x7ae75f);_0x3a1228&&(_0x575ef4[_0x4d9a89(0x106)]=_0x3a1228[_0x4d9a89(0x140)](),console['log'](_0x4d9a89(0x1a1)+_0x3a1228[_0x4d9a89(0x140)]()));if(_0x2d244b||_0x5a7f3e){_0x575ef4[_0x4d9a89(0x163)]={};if(_0x2d244b){const _0x32b921=new Date(_0x2d244b);_0x32b921[_0x4d9a89(0x1fa)](0x0,0x0,0x0,0x1),_0x575ef4['createdAt'][_0x4d9a89(0x174)]=_0x32b921,console[_0x4d9a89(0x23a)](_0x4d9a89(0x1ec)+_0x32b921[_0x4d9a89(0x185)]());}if(_0x5a7f3e){const _0x4a081d=new Date(_0x5a7f3e);_0x4a081d['setHours'](0x17,0x3b,0x3b,0x3e7),_0x575ef4['createdAt'][_0x4d9a89(0x134)]=_0x4a081d,console[_0x4d9a89(0x23a)](_0x4d9a89(0x23e)+_0x4a081d[_0x4d9a89(0x185)]());}}_0x43ad6f&&(_0x575ef4['OR']=[{'id':{'contains':_0x43ad6f,'mode':'insensitive'}},{'orderId':{'contains':_0x43ad6f,'mode':_0x4d9a89(0x1d2)}},{'gatewayOrderId':{'contains':_0x43ad6f,'mode':_0x4d9a89(0x1d2)}},{'customerEmail':{'contains':_0x43ad6f,'mode':_0x4d9a89(0x1d2)}},{'shop':{'name':{'contains':_0x43ad6f,'mode':_0x4d9a89(0x1d2)}}},{'shop':{'username':{'contains':_0x43ad6f,'mode':_0x4d9a89(0x1d2)}}}]);console[_0x4d9a89(0x23a)](_0x4d9a89(0x132),JSON[_0x4d9a89(0x1dc)](_0x575ef4,null,0x2));let _0x1a56dc={'createdAt':_0x4d9a89(0x14a)};if(_0x2db640){const _0x143d41=[_0x4d9a89(0x223),_0x4d9a89(0x163),'updatedAt',_0x4d9a89(0x22a),'gateway','currency'],_0x2e786d=[_0x4d9a89(0x136),_0x4d9a89(0x14a)];if(_0x143d41[_0x4d9a89(0x120)](_0x2db640)){const _0x367b65=_0x2e786d[_0x4d9a89(0x120)](_0x1f8cd1)?_0x1f8cd1:_0x4d9a89(0x14a);_0x1a56dc={[_0x2db640]:_0x367b65},console[_0x4d9a89(0x23a)](_0x4d9a89(0x148)+_0x2db640+'\x20in\x20'+_0x367b65+_0x4d9a89(0x1c5));}}const [_0xa2bfec,_0x174a8b]=await Promise[_0x4d9a89(0x162)]([database_1[_0x4d9a89(0x249)][_0x4d9a89(0x1fd)][_0x4d9a89(0x24a)]({'where':_0x575ef4,'skip':_0x475752,'take':_0x96a600,'orderBy':_0x1a56dc,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4d9a89(0x249)][_0x4d9a89(0x1fd)]['count']({'where':_0x575ef4})]);return{'payments':_0xa2bfec,'pagination':{'page':_0x57d66e,'limit':_0x96a600,'total':_0x174a8b,'totalPages':Math['ceil'](_0x174a8b/_0x96a600)}};}async['getPaymentById'](_0x30d8e9){const _0x5a1ad1=a40_0x223e0c,_0x3efcdc=await database_1['default']['payment']['findUnique']({'where':{'id':_0x30d8e9},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3efcdc)return null;return{'id':_0x3efcdc['id'],'shopId':_0x3efcdc[_0x5a1ad1(0x216)],'gateway':_0x3efcdc['gateway'],'amount':_0x3efcdc[_0x5a1ad1(0x223)],'currency':_0x3efcdc[_0x5a1ad1(0x106)],'status':_0x3efcdc[_0x5a1ad1(0x22a)],'orderId':_0x3efcdc[_0x5a1ad1(0x1a7)],'gatewayOrderId':_0x3efcdc[_0x5a1ad1(0x1b8)],'customerEmail':_0x3efcdc[_0x5a1ad1(0x195)],'customerName':_0x3efcdc[_0x5a1ad1(0x1c7)],'customerCountry':_0x3efcdc[_0x5a1ad1(0x242)],'customerIp':_0x3efcdc[_0x5a1ad1(0x13c)],'customerUa':_0x3efcdc['customerUa'],'failureMessage':_0x3efcdc[_0x5a1ad1(0x165)],'externalPaymentUrl':_0x3efcdc['externalPaymentUrl'],'successUrl':_0x3efcdc[_0x5a1ad1(0x21a)],'failUrl':_0x3efcdc['failUrl'],'pendingUrl':_0x3efcdc[_0x5a1ad1(0x12e)],'whiteUrl':_0x3efcdc[_0x5a1ad1(0x1fe)],'createdAt':_0x3efcdc[_0x5a1ad1(0x163)],'updatedAt':_0x3efcdc['updatedAt'],'shop':_0x3efcdc[_0x5a1ad1(0x170)]};}async['updatePaymentStatus'](_0x55f00e,_0x2ceeec,_0x23aac7,_0x4ed698){const _0x245a8d=a40_0x223e0c,_0x484448=await database_1[_0x245a8d(0x249)][_0x245a8d(0x189)](async _0xa9209d=>{const _0x4a2767=_0x245a8d,_0x1a6935=await _0xa9209d[_0x4a2767(0x1fd)][_0x4a2767(0x234)]({'where':{'id':_0x55f00e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1a6935)throw new Error(_0x4a2767(0x246));const _0x4e6bcf=_0x1a6935['status'],_0x54a39e=_0x2ceeec[_0x4a2767(0x140)]();console['log'](_0x4a2767(0x123)+_0x55f00e+'\x20status:\x20'+_0x4e6bcf+_0x4a2767(0x17a)+_0x54a39e),console[_0x4a2767(0x23a)]('💰\x20Current\x20shop\x20balance:\x20'+_0x1a6935[_0x4a2767(0x170)]['balance']+_0x4a2767(0x1a8));const _0x397f7a={'status':_0x54a39e,'updatedAt':new Date(),'statusChangedBy':_0x4a2767(0x1ff),'statusChangedAt':new Date()};_0x23aac7&&(_0x397f7a['adminNotes']=_0x23aac7);_0x54a39e===_0x4a2767(0x135)&&_0x4ed698&&(_0x397f7a['chargebackAmount']=_0x4ed698);let _0x39716b=0x0,_0x568c85=_0x1a6935[_0x4a2767(0x170)][_0x4a2767(0x117)];if(_0x54a39e==='PAID'&&_0x4e6bcf!=='PAID'){_0x397f7a['paidAt']=new Date();const _0x354874=await currencyService_1[_0x4a2767(0x198)][_0x4a2767(0x245)](_0x1a6935[_0x4a2767(0x223)],_0x1a6935['currency']);_0x397f7a[_0x4a2767(0x226)]=_0x354874;let _0x458351=0x2d;const _0x228e9a=await _0xa9209d[_0x4a2767(0x170)][_0x4a2767(0x234)]({'where':{'id':_0x1a6935['shopId']},'select':{'gatewaySettings':!![]}});if(_0x228e9a?.[_0x4a2767(0x14f)])try{const _0xc9b6eb=JSON[_0x4a2767(0x1d6)](_0x228e9a[_0x4a2767(0x14f)]);for(const [_0x577132,_0x1e4d4c]of Object[_0x4a2767(0x11f)](_0xc9b6eb)){if(_0x577132[_0x4a2767(0x155)]()===_0x1a6935[_0x4a2767(0x16e)][_0x4a2767(0x155)]()){_0x458351=_0x1e4d4c[_0x4a2767(0x1e6)]||0xa;break;}}}catch(_0xf30cae){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x55f00e+':',_0xf30cae);}let _0x4adffc;_0x1a6935[_0x4a2767(0x10c)]!==null&&_0x1a6935[_0x4a2767(0x10c)]!==undefined?(_0x4adffc=_0x1a6935[_0x4a2767(0x10c)],console[_0x4a2767(0x23a)]('📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x4adffc[_0x4a2767(0x214)](0x6)+_0x4a2767(0x238)+_0x55f00e)):(_0x4adffc=_0x354874*(0x1-_0x458351/0x64),console[_0x4a2767(0x23a)](_0x4a2767(0xee)+_0x55f00e+':\x20'+_0x458351+_0x4a2767(0x200)+_0x354874['toFixed'](0x6)+_0x4a2767(0x1a8)),_0x397f7a['amountAfterGatewayCommissionUSDT']=_0x4adffc,_0x397f7a[_0x4a2767(0x218)]=_0x458351),_0x39716b=_0x4adffc,_0x568c85+=_0x4adffc,console['log'](_0x4a2767(0x124)+_0x55f00e+'\x20became\x20PAID:'),console['log'](_0x4a2767(0x250)+_0x354874['toFixed'](0x6)+_0x4a2767(0x1a8)),console[_0x4a2767(0x23a)](_0x4a2767(0x193)+_0x1a6935['gateway']+_0x4a2767(0x186)+_0x458351+'%'),console[_0x4a2767(0x23a)](_0x4a2767(0x1ad)+_0x4adffc[_0x4a2767(0x214)](0x6)+'\x20USDT\x20(after\x20'+_0x458351+_0x4a2767(0x240)),console[_0x4a2767(0x23a)](_0x4a2767(0x18c)+_0x4adffc['toFixed'](0x6)+_0x4a2767(0x1a8));}else{if(_0x4e6bcf==='PAID'&&_0x54a39e!==_0x4a2767(0x159)&&_0x54a39e!=='CHARGEBACK'){if(_0x1a6935[_0x4a2767(0x226)]){let _0x4ea660=0x2d;const _0x5976fa=await _0xa9209d[_0x4a2767(0x170)][_0x4a2767(0x234)]({'where':{'id':_0x1a6935['shopId']},'select':{'gatewaySettings':!![]}});if(_0x5976fa?.['gatewaySettings'])try{const _0x563547=JSON['parse'](_0x5976fa['gatewaySettings']);for(const [_0x42a944,_0x4a9e1d]of Object[_0x4a2767(0x11f)](_0x563547)){if(_0x42a944[_0x4a2767(0x155)]()===_0x1a6935[_0x4a2767(0x16e)][_0x4a2767(0x155)]()){_0x4ea660=_0x4a9e1d[_0x4a2767(0x1e6)]||0xa;break;}}}catch(_0x5df6d9){console[_0x4a2767(0x179)](_0x4a2767(0x1f5)+_0x55f00e+':',_0x5df6d9);}const _0x5d2ddd=_0x1a6935['amountUSDT']*(0x1-_0x4ea660/0x64);_0x39716b=-_0x5d2ddd,_0x568c85-=_0x5d2ddd,console[_0x4a2767(0x23a)](_0x4a2767(0x250)+_0x1a6935[_0x4a2767(0x226)][_0x4a2767(0x214)](0x6)+'\x20USDT'),console[_0x4a2767(0x23a)]('\x20\x20\x20Gateway:\x20'+_0x1a6935[_0x4a2767(0x16e)]+_0x4a2767(0x186)+_0x4ea660+'%'),console[_0x4a2767(0x23a)](_0x4a2767(0x17d)+_0x5d2ddd[_0x4a2767(0x214)](0x6)+_0x4a2767(0x100)+_0x4ea660+_0x4a2767(0x240)),console[_0x4a2767(0x23a)](_0x4a2767(0x1c9)+_0x5d2ddd[_0x4a2767(0x214)](0x6)+_0x4a2767(0x1a8));}}}_0x54a39e==='CHARGEBACK'&&(console['log'](_0x4a2767(0x12a)),_0x4ed698&&_0x4ed698>0x0?(_0x39716b=-_0x4ed698,_0x568c85-=_0x4ed698,console['log'](_0x4a2767(0xfc)+_0x4ed698['toFixed'](0x6)+_0x4a2767(0x20b)),console[_0x4a2767(0x23a)](_0x4a2767(0x1a3))):console[_0x4a2767(0x23a)]('⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x397f7a[_0x4a2767(0x22b)]=_0x4ed698||0x0);_0x54a39e===_0x4a2767(0x1b5)&&_0x4e6bcf==='PAID'&&console[_0x4a2767(0x23a)](_0x4a2767(0x1ce));const _0x238699=await _0xa9209d[_0x4a2767(0x1fd)][_0x4a2767(0x227)]({'where':{'id':_0x55f00e},'data':_0x397f7a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x39716b!==0x0&&(await _0xa9209d[_0x4a2767(0x170)]['update']({'where':{'id':_0x1a6935[_0x4a2767(0x216)]},'data':{'balance':_0x568c85}}),console['log'](_0x4a2767(0x12d)+_0x1a6935[_0x4a2767(0x216)]+_0x4a2767(0x1d5)+_0x1a6935[_0x4a2767(0x170)][_0x4a2767(0x117)]['toFixed'](0x6)+_0x4a2767(0x17a)+_0x568c85[_0x4a2767(0x214)](0x6)+_0x4a2767(0x10b)+(_0x39716b>0x0?'+':'')+_0x39716b['toFixed'](0x6)+')')),_0x238699;});return{'id':_0x484448['id'],'shopId':_0x484448[_0x245a8d(0x216)],'gateway':_0x484448['gateway'],'amount':_0x484448[_0x245a8d(0x223)],'currency':_0x484448[_0x245a8d(0x106)],'status':_0x484448[_0x245a8d(0x22a)],'orderId':_0x484448[_0x245a8d(0x1a7)],'gatewayOrderId':_0x484448[_0x245a8d(0x1b8)],'customerEmail':_0x484448[_0x245a8d(0x195)],'customerName':_0x484448[_0x245a8d(0x1c7)],'customerCountry':_0x484448[_0x245a8d(0x242)],'customerIp':_0x484448['customerIp'],'customerUa':_0x484448[_0x245a8d(0xf9)],'failureMessage':_0x484448[_0x245a8d(0x165)],'adminNotes':_0x484448[_0x245a8d(0x1f1)],'chargebackAmount':_0x484448[_0x245a8d(0x22b)],'statusChangedBy':_0x484448[_0x245a8d(0x14c)],'statusChangedAt':_0x484448['statusChangedAt'],'createdAt':_0x484448[_0x245a8d(0x163)],'updatedAt':_0x484448[_0x245a8d(0x22c)],'shop':_0x484448[_0x245a8d(0x170)]};}async[a40_0x223e0c(0x145)](_0xab4fbd,_0x27880a){const _0x598828=a40_0x223e0c,_0x4b7695=Math[_0x598828(0x14d)]()['toString'](0x24)[_0x598828(0x146)](0x2,0x9);console['log'](_0x598828(0x211)+_0x4b7695+',\x20userId:\x20'+_0xab4fbd);const _0x646888={..._0x27880a};_0x27880a['password']&&_0x27880a[_0x598828(0x157)][_0x598828(0x21b)]()!==''?(console['log'](_0x598828(0x202)+_0x4b7695+']\x20Updating\x20password\x20for\x20user\x20'+_0xab4fbd),_0x646888[_0x598828(0x157)]=await bcryptjs_1['default']['hash'](_0x27880a[_0x598828(0x157)],0xc)):(console[_0x598828(0x23a)](_0x598828(0x202)+_0x4b7695+_0x598828(0x220)),delete _0x646888[_0x598828(0x157)]);_0x27880a[_0x598828(0x182)]&&(_0x646888[_0x598828(0x10d)]=_0x27880a[_0x598828(0x182)],delete _0x646888['fullName']);_0x27880a[_0x598828(0x1d3)]&&(_0x646888[_0x598828(0x1e4)]=_0x27880a[_0x598828(0x1d3)],delete _0x646888[_0x598828(0x1d3)]);_0x27880a[_0x598828(0x236)]&&(_0x646888[_0x598828(0x118)]=_0x27880a[_0x598828(0x236)],delete _0x646888[_0x598828(0x236)]);if(_0x27880a[_0x598828(0x1e0)]){const _0x5850ff=_0x27880a[_0x598828(0x1e0)][_0x598828(0x205)](_0x5b10fb=>this[_0x598828(0x129)](_0x5b10fb));console[_0x598828(0x23a)]('🔄\x20Gateway\x20mapping:',_0x27880a[_0x598828(0x1e0)],'->',_0x5850ff),_0x646888[_0x598828(0x1a0)]=JSON[_0x598828(0x1dc)](_0x5850ff),delete _0x646888[_0x598828(0x1e0)];}_0x27880a[_0x598828(0x14f)]&&(console[_0x598828(0x23a)](_0x598828(0x1af)+_0x4b7695+_0x598828(0x171),_0x27880a[_0x598828(0x14f)]),_0x646888['gatewaySettings']=JSON[_0x598828(0x1dc)](_0x27880a[_0x598828(0x14f)]),console[_0x598828(0x23a)](_0x598828(0x1af)+_0x4b7695+_0x598828(0x128),_0x646888[_0x598828(0x14f)]));_0x27880a[_0x598828(0x181)]&&(_0x27880a['wallets'][_0x598828(0x18b)]!==undefined&&(_0x646888[_0x598828(0x18b)]=_0x27880a[_0x598828(0x181)]['usdtPolygonWallet']||null),_0x27880a['wallets'][_0x598828(0x18e)]!==undefined&&(_0x646888[_0x598828(0x18e)]=_0x27880a[_0x598828(0x181)][_0x598828(0x18e)]||null),_0x27880a[_0x598828(0x181)]['usdtErcWallet']!==undefined&&(_0x646888[_0x598828(0x15c)]=_0x27880a[_0x598828(0x181)][_0x598828(0x15c)]||null),_0x27880a['wallets'][_0x598828(0x137)]!==undefined&&(_0x646888[_0x598828(0x137)]=_0x27880a[_0x598828(0x181)][_0x598828(0x137)]||null),delete _0x646888[_0x598828(0x181)]);const _0x356c7b=await database_1['default']['shop'][_0x598828(0x227)]({'where':{'id':_0xab4fbd},'data':_0x646888,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x598828(0x23a)](_0x598828(0x109)+_0x4b7695+_0x598828(0x19b),_0x356c7b[_0x598828(0x14f)]),{'id':_0x356c7b['id'],'fullName':_0x356c7b[_0x598828(0x10d)],'username':_0x356c7b[_0x598828(0x229)],'telegramId':_0x356c7b['telegram'],'merchantUrl':_0x356c7b[_0x598828(0x118)],'gateways':_0x356c7b[_0x598828(0x1a0)]?JSON['parse'](_0x356c7b['paymentGateways']):null,'gatewaySettings':_0x356c7b['gatewaySettings']?JSON[_0x598828(0x1d6)](_0x356c7b[_0x598828(0x14f)]):null,'publicKey':_0x356c7b[_0x598828(0x19c)],'wallets':{'usdtPolygonWallet':_0x356c7b[_0x598828(0x18b)],'usdtTrcWallet':_0x356c7b[_0x598828(0x18e)],'usdtErcWallet':_0x356c7b['usdtErcWallet'],'usdcPolygonWallet':_0x356c7b[_0x598828(0x137)]},'status':_0x356c7b[_0x598828(0x22a)],'createdAt':_0x356c7b[_0x598828(0x163)]};}async[a40_0x223e0c(0x107)](_0x5eb85c){const _0x8f45d9=a40_0x223e0c,_0x708a6f=await database_1[_0x8f45d9(0x249)]['shop'][_0x8f45d9(0x227)]({'where':{'id':_0x5eb85c},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x708a6f['id'],'fullName':_0x708a6f['name'],'username':_0x708a6f[_0x8f45d9(0x229)],'telegramId':_0x708a6f['telegram'],'merchantUrl':_0x708a6f[_0x8f45d9(0x118)],'gateways':_0x708a6f[_0x8f45d9(0x1a0)]?JSON[_0x8f45d9(0x1d6)](_0x708a6f['paymentGateways']):null,'gatewaySettings':_0x708a6f[_0x8f45d9(0x14f)]?JSON['parse'](_0x708a6f[_0x8f45d9(0x14f)]):null,'publicKey':_0x708a6f[_0x8f45d9(0x19c)],'wallets':{'usdtPolygonWallet':_0x708a6f[_0x8f45d9(0x18b)],'usdtTrcWallet':_0x708a6f['usdtTrcWallet'],'usdtErcWallet':_0x708a6f[_0x8f45d9(0x15c)],'usdcPolygonWallet':_0x708a6f['usdcPolygonWallet']},'status':_0x708a6f['status'],'createdAt':_0x708a6f[_0x8f45d9(0x163)]};}async[a40_0x223e0c(0x1db)](_0x4d2aec){const _0x1e0c7c=a40_0x223e0c,_0x1e312f=await database_1[_0x1e0c7c(0x249)][_0x1e0c7c(0x170)][_0x1e0c7c(0x227)]({'where':{'id':_0x4d2aec},'data':{'status':_0x1e0c7c(0xff)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1e312f['id'],'fullName':_0x1e312f[_0x1e0c7c(0x10d)],'username':_0x1e312f[_0x1e0c7c(0x229)],'telegramId':_0x1e312f[_0x1e0c7c(0x1e4)],'merchantUrl':_0x1e312f['shopUrl'],'gateways':_0x1e312f[_0x1e0c7c(0x1a0)]?JSON['parse'](_0x1e312f['paymentGateways']):null,'gatewaySettings':_0x1e312f[_0x1e0c7c(0x14f)]?JSON[_0x1e0c7c(0x1d6)](_0x1e312f[_0x1e0c7c(0x14f)]):null,'publicKey':_0x1e312f[_0x1e0c7c(0x19c)],'wallets':{'usdtPolygonWallet':_0x1e312f[_0x1e0c7c(0x18b)],'usdtTrcWallet':_0x1e312f[_0x1e0c7c(0x18e)],'usdtErcWallet':_0x1e312f['usdtErcWallet'],'usdcPolygonWallet':_0x1e312f[_0x1e0c7c(0x137)]},'status':_0x1e312f[_0x1e0c7c(0x22a)],'createdAt':_0x1e312f[_0x1e0c7c(0x163)]};}async['getAllUsers'](_0x1127e6){const _0x3799ca=a40_0x223e0c,{page:_0x4379e1,limit:_0x5597e7,status:_0x4c1036}=_0x1127e6,_0x5da11c=(_0x4379e1-0x1)*_0x5597e7,_0x2fcd95={};_0x4c1036&&(_0x2fcd95[_0x3799ca(0x22a)]=_0x4c1036[_0x3799ca(0x140)]());const [_0x10e6fc,_0x57eb34]=await Promise[_0x3799ca(0x162)]([database_1[_0x3799ca(0x249)][_0x3799ca(0x170)][_0x3799ca(0x24a)]({'where':_0x2fcd95,'skip':_0x5da11c,'take':_0x5597e7,'orderBy':{'createdAt':_0x3799ca(0x14a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3799ca(0x249)][_0x3799ca(0x170)]['count']({'where':_0x2fcd95})]);return{'users':_0x10e6fc[_0x3799ca(0x205)](_0x1e7993=>{const _0x2793a5=_0x3799ca,_0x40a4fc=_0x1e7993[_0x2793a5(0x1a0)]?JSON['parse'](_0x1e7993[_0x2793a5(0x1a0)]):null,_0x573285=_0x40a4fc?_0x40a4fc[_0x2793a5(0x205)](_0x441dad=>this['getGatewayDisplayName'](_0x441dad)):null;return{'id':_0x1e7993['id'],'fullName':_0x1e7993['name'],'username':_0x1e7993[_0x2793a5(0x229)],'telegramId':_0x1e7993[_0x2793a5(0x1e4)],'merchantUrl':_0x1e7993['shopUrl'],'gateways':_0x573285,'gatewaySettings':_0x1e7993[_0x2793a5(0x14f)]?JSON[_0x2793a5(0x1d6)](_0x1e7993[_0x2793a5(0x14f)]):null,'publicKey':_0x1e7993[_0x2793a5(0x19c)],'wallets':{'usdtPolygonWallet':_0x1e7993['usdtPolygonWallet'],'usdtTrcWallet':_0x1e7993[_0x2793a5(0x18e)],'usdtErcWallet':_0x1e7993['usdtErcWallet'],'usdcPolygonWallet':_0x1e7993['usdcPolygonWallet']},'status':_0x1e7993[_0x2793a5(0x22a)],'createdAt':_0x1e7993[_0x2793a5(0x163)]};}),'pagination':{'page':_0x4379e1,'limit':_0x5597e7,'total':_0x57eb34,'totalPages':Math[_0x3799ca(0x1cc)](_0x57eb34/_0x5597e7)}};}async['getUserById'](_0x5011e9){const _0x54b6e3=a40_0x223e0c,_0x471075=await database_1[_0x54b6e3(0x249)][_0x54b6e3(0x170)][_0x54b6e3(0x234)]({'where':{'id':_0x5011e9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x471075)return null;const _0x1b8dc7=_0x471075[_0x54b6e3(0x1a0)]?JSON[_0x54b6e3(0x1d6)](_0x471075[_0x54b6e3(0x1a0)]):null,_0x1e9d79=_0x1b8dc7?_0x1b8dc7[_0x54b6e3(0x205)](_0x489fa0=>this[_0x54b6e3(0x18d)](_0x489fa0)):null;return _0x1b8dc7&&_0x1e9d79&&console[_0x54b6e3(0x23a)](_0x54b6e3(0x247),_0x1b8dc7,'->',_0x1e9d79),{'id':_0x471075['id'],'fullName':_0x471075[_0x54b6e3(0x10d)],'username':_0x471075[_0x54b6e3(0x229)],'telegramId':_0x471075['telegram'],'merchantUrl':_0x471075['shopUrl'],'gateways':_0x1e9d79,'gatewaySettings':_0x471075['gatewaySettings']?JSON['parse'](_0x471075[_0x54b6e3(0x14f)]):null,'publicKey':_0x471075[_0x54b6e3(0x19c)],'wallets':{'usdtPolygonWallet':_0x471075['usdtPolygonWallet'],'usdtTrcWallet':_0x471075['usdtTrcWallet'],'usdtErcWallet':_0x471075[_0x54b6e3(0x15c)],'usdcPolygonWallet':_0x471075[_0x54b6e3(0x137)]},'status':_0x471075[_0x54b6e3(0x22a)],'createdAt':_0x471075[_0x54b6e3(0x163)]};}async[a40_0x223e0c(0x184)](_0x4ab4d0){const _0x191d7a=a40_0x223e0c,{fullName:_0x495298,username:_0x416809,password:_0x59fc1b,telegramId:_0x26aa00,merchantUrl:_0x46709b,gateways:_0x3474f7,gatewaySettings:_0x507388,wallets:_0x2d182b}=_0x4ab4d0,_0x1ba64e=await database_1['default']['shop'][_0x191d7a(0x234)]({'where':{'username':_0x416809}});if(_0x1ba64e)throw new Error('Username\x20already\x20exists');if(_0x26aa00){const _0xf9e283=await database_1[_0x191d7a(0x249)][_0x191d7a(0x170)][_0x191d7a(0x234)]({'where':{'telegram':_0x26aa00}});if(_0xf9e283)throw new Error(_0x191d7a(0x221));}const _0x298ef0=await bcryptjs_1[_0x191d7a(0x249)][_0x191d7a(0x1c8)](_0x59fc1b,0xc),_0x41aee6=_0x191d7a(0x133)+crypto_1['default'][_0x191d7a(0x23b)](0x20)[_0x191d7a(0x1f6)]('hex'),_0x2ec9d4=_0x191d7a(0x1d7)+crypto_1[_0x191d7a(0x249)][_0x191d7a(0x23b)](0x20)['toString'](_0x191d7a(0x17e)),_0x32213f=_0x3474f7?_0x3474f7[_0x191d7a(0x205)](_0x294606=>this[_0x191d7a(0x129)](_0x294606)):null;_0x3474f7&&_0x32213f&&console[_0x191d7a(0x23a)](_0x191d7a(0x1b0),_0x3474f7,'->',_0x32213f);const _0x478a9a=await database_1[_0x191d7a(0x249)][_0x191d7a(0x170)][_0x191d7a(0x11d)]({'data':{'name':_0x495298,'username':_0x416809,'password':_0x298ef0,'telegram':_0x26aa00,'shopUrl':_0x46709b,'paymentGateways':_0x32213f?JSON['stringify'](_0x32213f):null,'gatewaySettings':_0x507388?JSON[_0x191d7a(0x1dc)](_0x507388):null,'usdtPolygonWallet':_0x2d182b?.[_0x191d7a(0x18b)]||null,'usdtTrcWallet':_0x2d182b?.[_0x191d7a(0x18e)]||null,'usdtErcWallet':_0x2d182b?.[_0x191d7a(0x15c)]||null,'usdcPolygonWallet':_0x2d182b?.[_0x191d7a(0x137)]||null,'publicKey':_0x41aee6,'secretKey':_0x2ec9d4,'status':_0x191d7a(0xff)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x478a9a['id'],'fullName':_0x478a9a[_0x191d7a(0x10d)],'username':_0x478a9a[_0x191d7a(0x229)],'telegramId':_0x478a9a[_0x191d7a(0x1e4)],'merchantUrl':_0x478a9a['shopUrl'],'gateways':_0x478a9a[_0x191d7a(0x1a0)]?JSON['parse'](_0x478a9a['paymentGateways']):null,'gatewaySettings':_0x478a9a[_0x191d7a(0x14f)]?JSON[_0x191d7a(0x1d6)](_0x478a9a[_0x191d7a(0x14f)]):null,'publicKey':_0x478a9a[_0x191d7a(0x19c)],'wallets':{'usdtPolygonWallet':_0x478a9a[_0x191d7a(0x18b)],'usdtTrcWallet':_0x478a9a[_0x191d7a(0x18e)],'usdtErcWallet':_0x478a9a[_0x191d7a(0x15c)],'usdcPolygonWallet':_0x478a9a[_0x191d7a(0x137)]},'status':_0x478a9a['status'],'createdAt':_0x478a9a[_0x191d7a(0x163)]};}async['deleteUser'](_0x536371){const _0x28d801=a40_0x223e0c;await database_1[_0x28d801(0x249)][_0x28d801(0x170)][_0x28d801(0x1aa)]({'where':{'id':_0x536371}});}[a40_0x223e0c(0x1b9)](_0x3f5e0b,_0x62c8f4,_0x359846){const _0x108972=a40_0x223e0c,_0x33a47d=new Map(),_0x2540b6=new Date(_0x62c8f4);while(_0x2540b6<=_0x359846){const _0x3c6a2e=_0x2540b6[_0x108972(0x185)]()[_0x108972(0x18f)]('T')[0x0];_0x33a47d[_0x108972(0xf0)](_0x3c6a2e,{'revenue':0x0,'count':0x0}),_0x2540b6['setDate'](_0x2540b6[_0x108972(0x17f)]()+0x1);}for(const _0x32017d of _0x3f5e0b){const _0x1c3bd0=_0x32017d[_0x108972(0x163)][_0x108972(0x185)]()[_0x108972(0x18f)]('T')[0x0],_0x37f230=_0x33a47d['get'](_0x1c3bd0);_0x37f230&&(_0x37f230[_0x108972(0x168)]+=0x1,_0x32017d[_0x108972(0x22a)]===_0x108972(0x159)&&(_0x32017d[_0x108972(0x226)]?_0x37f230[_0x108972(0x207)]+=_0x32017d[_0x108972(0x226)]:console[_0x108972(0x23a)]('⚠️\x20Payment\x20'+_0x32017d['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x49a7ca=[],_0x72f16e=[];for(const [_0x1f8b5e,_0x4db0ff]of _0x33a47d){_0x49a7ca[_0x108972(0x21f)]({'date':_0x1f8b5e,'amount':Math[_0x108972(0x13e)](_0x4db0ff[_0x108972(0x207)]*0x64)/0x64}),_0x72f16e[_0x108972(0x21f)]({'date':_0x1f8b5e,'count':_0x4db0ff[_0x108972(0x168)]});}return{'dailyRevenue':_0x49a7ca,'dailyPayments':_0x72f16e};}}function a40_0x3c9f(){const _0x543997=['telegram','Open\x20Banking\x202','commission','2020-01-01','sort','\x20\x20\x20🌐\x20IP:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','totalCommissionRate','📅\x20Date\x20from\x20filter:\x20','totalAmountAfterCommissionUSDT','test_gateway','🔍\x20Using\x20gateway\x20\x27','MasterCard','adminNotes','📊\x20Getting\x20payments\x20with\x20filters:','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','getPayoutById','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','toString','periodFrom','aggregate','groupBy','setHours','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20📅\x20This\x20month:\x20','payment','whiteUrl','admin','%\x20from\x20','join','🔐\x20[','commissionUSDT','amountAfterCommissionUSDT','map','🔍\x20Selected\x20polygon\x20wallet:\x20','revenue','trc20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20\x20\x20�📊\x20Total\x20payments:\x20','\x20USDT\x20from\x20balance','📋\x20Found\x20','day','\x20PAID\x20payments','📊\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20Requested\x20(number):\x20','🎯\x20updateUser\x20called\x20with\x20ID:\x20','90d','✅\x20Payout\x20created:\x20','toFixed','\x20\x20\x20Balance:\x20','shopId','💰\x20Found\x20','gatewayCommissionRate','erc20','successUrl','trim','463713mglysy','getAllPayouts','reduce','push',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','Telegram\x20username\x20already\x20exists','averageCommissionRate','amount','createPayout','totalPaidOut','amountUSDT','update','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','username','status','chargebackAmount','updatedAt','\x27\x20to\x20name\x20\x27','\x20USDT)','\x27\x20not\x20found.\x20Available\x20gateways:\x20','🔍\x20Shop\x20wallets:','\x20\x20\x20🌍\x20Country:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','PENDING','findUnique','📋\x20Getting\x20merchants\x20selection\x20list...','merchantUrl','Error\x20processing\x20payment\x20','\x20USDT\x20for\x20payment\x20','wallet','log','randomBytes','gatewayEarnings','../config/database','📅\x20Date\x20to\x20filter:\x20','NONEXISTENT_GATEWAY_FILTER','%\x20commission)','plisio','customerCountry','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20merchants','convertToUSDT','Payment\x20not\x20found','🔄\x20Gateway\x20mapping\x20(get):','min','default','findMany','polygon','mastercard','\x20\x20\x20Total\x20paid\x20out:\x20','\x20USDT\x20(same\x20as\x20awaiting)','network','\x20\x20\x20Full\x20amount:\x20','⚠️\x20Payment\x20','6MUCQTN','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','1726062aRsFMx','set','\x20USDT\x20(current\x20balance\x20in\x20DB)','\x20USDT,\x20merchant:\x20','\x20USDT\x20(-','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','10868130qYHdfM','💰\x20[PAYOUT]\x20Gateway\x20','defineProperty','\x20\x20\x20Available\x20(raw):\x20','customerUa','12465FgaNHo','\x20for\x20shop\x20','💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','🔍\x20Selected\x20erc20\x20wallet:\x20','🔍\x20Selected\x20trc20\x20wallet:\x20','ACTIVE','\x20USDT\x20(after\x20','Shop\x20not\x20found','💳\x20Final\x20payout\x20wallet\x20for\x20','\x20\x20\x20⏳\x20Pending\x20payout:\x20','📊\x20Total\x20payments\x20(including\x20failed):\x20','KLYME\x20GB','currency','suspendUser','averageCheckUSDT','🎯\x20[','\x27\x20->\x20ID\x20\x27','\x20USDT\x20(','amountAfterGatewayCommissionUSDT','name','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20USDT\x20(theoretical\x20net)','periodTo','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','8mNIYXD','\x20USDT\x20(gross\x20revenue)','date','month','📅\x20Payout\x20date\x20from\x20filter:\x20','balance','shopUrl','COMPLETED','getMonth','\x20payments)','getGatewayIdByName','create','getPayoutStats','entries','includes','paidOutUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','🔄\x20Admin\x20updating\x20payment\x20','💰\x20Payment\x20','turnover','klyme_gb','\x20USDT,\x20Difference:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','getGatewayInternalName','💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','__esModule','💰\x20Shop\x20','pendingUrl','📅\x20Payout\x20date\x20to\x20filter:\x20','🔍\x20Creating\x20payout\x20with\x20data:','./currencyService','📊\x20Final\x20WHERE\x20conditions:','pk_','lte','CHARGEBACK','asc','usdcPolygonWallet','totalPayments','_count','sendPayoutNotification','🔍\x20Selected\x20polygon_usdc\x20wallet:\x20','customerIp','usdcErcWallet','round','\x27\x20(from\x20\x27','toUpperCase','not\x20set','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','getMerchantStatistics',',\x20chargebacks:\x20','updateUser','substr','merchantEarningsUSDT','📊\x20Sorting\x20payments\x20by\x20','⚠️\x20Requested\x20gateway\x20\x27','desc','paidAt','statusChangedBy','random','getTime','gatewaySettings','\x20\x20\x20🤔\x20Difference:\x20','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','findFirst','yesterday','\x20-\x20','toLowerCase','Insufficient\x20balance.\x20Available:\x20','password','setDate','PAID','getGatewayNameById','year','usdtErcWallet','values','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT\x20(+','📊\x20Payout\x20statistics\x20calculated:','slice','all','createdAt','\x20\x20\x20Available\x20(number):\x20','failureMessage','dailyPayments','klyme_de','count','\x27\x20->\x20name\x20\x27','\x20paid\x20payments\x20for\x20analysis','Test\x20Gateway','❌\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','dateFrom','gateway','totalPayout','shop',']\x20Gateway\x20settings\x20before\x20saving:','KLYME\x20DE','dateTo','gte','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','Plisio','🔍\x20Balance\x20check\x20details:','turnoverUSDT','error','\x20->\x20','totalTurnover','KLYME\x20EU','\x20\x20\x20Merchant\x20loses:\x20','hex','getDate','payout','wallets','fullName','paymentsCount','createUser','toISOString',',\x20Commission:\x20','929546WXkEkE','📊\x20Calculating\x20payout\x20statistics...','$transaction','getSystemStatistics','usdtPolygonWallet','\x20\x20\x20Added\x20to\x20balance:\x20+','getGatewayDisplayName','usdtTrcWallet','split',',\x20refunds:\x20','custom','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20Gateway:\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','customerEmail','\x20\x20\x20✅\x20Total\x20net\x20balances:\x20','awaitingPayout','currencyService','CoinToPay','payouts',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','publicKey','length','txid','Rapyd','paymentGateways','💱\x20Currency\x20filter\x20applied:\x20','🔍\x20Selected\x20erc20_usdc\x20wallet:\x20','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20\x20\x20🖥️\x20User\x20Agent:\x20','getFullYear','erc20_usdc','orderId','\x20USDT','warn','delete',':\x20commission\x20=\x20','📅\x20Period:\x20','\x20\x20\x20Merchant\x20gets:\x20','some','🔧\x20[','🔄\x20Gateway\x20mapping\x20(create):','Не\x20указан','dailyRevenue','merchantEarnings','week','REFUND','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20to\x20','gatewayOrderId','generateDailyStatistics','\x20\x20\x20💵\x20Available\x20balance:\x20','1084WWFhPe','\x20USDT\x20(total\x20paid\x20to\x20merchants)','not\x20specified','klyme_eu','cointopay','updateCustomerData','💰\x20Creating\x20payout\x20for\x20shop\x20','🔍\x20Initial\x20wallet\x20from\x20request:\x20','_sum','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','\x20order','notes','customerName','hash','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','telegramBotService','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','ceil','\x20\x20\x20💸\x20Total\x20payouts:\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','localeCompare','0000','toLocaleDateString','insensitive','telegramId','ru-RU','\x20balance\x20updated:\x20','parse','sk_','3230181RIyFGM','AdminService','4758089OdCRCJ','activateUser','stringify','floor','\x20\x20\x20💳\x20Total\x20payments:\x20','period','gateways','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','\x20with\x20payout\x20history'];a40_0x3c9f=function(){return _0x543997;};return a40_0x3c9f();}exports[a40_0x223e0c(0x1d9)]=AdminService;