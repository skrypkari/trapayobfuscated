'use strict';const a35_0x5e3a27=a35_0x5ee0;(function(_0x41ce4f,_0x4f2d69){const _0x5b02a9=a35_0x5ee0,_0x35da14=_0x41ce4f();while(!![]){try{const _0x5a6a9f=parseInt(_0x5b02a9(0x10a))/0x1*(parseInt(_0x5b02a9(0xf8))/0x2)+parseInt(_0x5b02a9(0x1e9))/0x3+-parseInt(_0x5b02a9(0x13e))/0x4+parseInt(_0x5b02a9(0x1cc))/0x5*(-parseInt(_0x5b02a9(0x132))/0x6)+parseInt(_0x5b02a9(0x195))/0x7*(parseInt(_0x5b02a9(0x14a))/0x8)+parseInt(_0x5b02a9(0x1b7))/0x9*(-parseInt(_0x5b02a9(0x181))/0xa)+-parseInt(_0x5b02a9(0x194))/0xb*(-parseInt(_0x5b02a9(0x1bb))/0xc);if(_0x5a6a9f===_0x4f2d69)break;else _0x35da14['push'](_0x35da14['shift']());}catch(_0x5a9521){_0x35da14['push'](_0x35da14['shift']());}}}(a35_0x3501,0x90f93));var __importDefault=this&&this[a35_0x5e3a27(0xf6)]||function(_0x508118){return _0x508118&&_0x508118['__esModule']?_0x508118:{'default':_0x508118};};Object['defineProperty'](exports,a35_0x5e3a27(0x17c),{'value':!![]}),exports[a35_0x5e3a27(0xec)]=void 0x0;function a35_0x5ee0(_0x41d252,_0x31fd7d){const _0x35015a=a35_0x3501();return a35_0x5ee0=function(_0x5ee05a,_0x55a606){_0x5ee05a=_0x5ee05a-0xe9;let _0x37f003=_0x35015a[_0x5ee05a];return _0x37f003;},a35_0x5ee0(_0x41d252,_0x31fd7d);}const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x5e3a27(0x153))),crypto_1=__importDefault(require(a35_0x5e3a27(0xf7))),currencyService_1=require('./currencyService');class AdminService{async[a35_0x5e3a27(0x156)](){const _0xf9222b=a35_0x5e3a27;console[_0xf9222b(0x162)](_0xf9222b(0x11e));const _0x2de1ce=await database_1[_0xf9222b(0x19f)][_0xf9222b(0x1bc)][_0xf9222b(0xe9)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0xf9222b(0x1ba)}}),_0x58d9b5=new Date(),_0x592b8e=new Date(_0x58d9b5[_0xf9222b(0x105)](),_0x58d9b5[_0xf9222b(0x1b5)](),0x1),_0x2a37b6=new Date(_0x58d9b5[_0xf9222b(0x105)](),_0x58d9b5['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5c1be2=await database_1[_0xf9222b(0x19f)][_0xf9222b(0x1b9)][_0xf9222b(0xe9)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x592b8e,'lte':_0x2a37b6},'status':_0xf9222b(0x1ac)}}),_0x300cae=_0x2de1ce['_sum'][_0xf9222b(0x110)]||0x0,_0x2698e0=_0x2de1ce[_0xf9222b(0x1c3)]['balance']||0x0,_0x3e4a1b=_0x5c1be2['_sum'][_0xf9222b(0xfa)]||0x0,_0x2a2855={'totalPayout':Math[_0xf9222b(0x1bd)](_0x300cae*0x64)/0x64,'awaitingPayout':Math[_0xf9222b(0x1bd)](_0x2698e0*0x64)/0x64,'thisMonth':Math[_0xf9222b(0x1bd)](_0x3e4a1b*0x64)/0x64,'availableBalance':Math['round'](_0x2698e0*0x64)/0x64};return console[_0xf9222b(0x162)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0xf9222b(0x162)](_0xf9222b(0xfd)+_0x2a2855['totalPayout']+_0xf9222b(0x173)),console[_0xf9222b(0x162)](_0xf9222b(0x148)+_0x2a2855['awaitingPayout']+'\x20USDT\x20(total\x20merchant\x20balances)'),console['log'](_0xf9222b(0x1e8)+_0x2a2855[_0xf9222b(0x15e)]+_0xf9222b(0x150)),console[_0xf9222b(0x162)](_0xf9222b(0x138)+_0x2a2855[_0xf9222b(0x1ad)]+_0xf9222b(0x18b)),_0x2a2855;}async[a35_0x5e3a27(0xf3)](_0x5f1221,_0x5ec1b2){const _0x53e559=a35_0x5e3a27;console[_0x53e559(0x162)](_0x53e559(0x18e)+_0x5f1221+':',_0x5ec1b2);const _0x5bb528=await database_1[_0x53e559(0x19f)][_0x53e559(0x101)]['findUnique']({'where':{'id':_0x5f1221},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5bb528)throw new Error(_0x53e559(0x142));const _0x57c312={};_0x5ec1b2[_0x53e559(0xee)]!==undefined&&(_0x57c312[_0x53e559(0xee)]=_0x5ec1b2[_0x53e559(0xee)]||null);_0x5ec1b2[_0x53e559(0x1f0)]!==undefined&&(_0x57c312[_0x53e559(0x1f0)]=_0x5ec1b2[_0x53e559(0x1f0)]||null);_0x5ec1b2['customerUa']!==undefined&&(_0x57c312[_0x53e559(0x1f5)]=_0x5ec1b2['customerUa']||null);const _0x2ad34f=await database_1[_0x53e559(0x19f)][_0x53e559(0x101)][_0x53e559(0x17f)]({'where':{'id':_0x5f1221},'data':{..._0x57c312,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x53e559(0x167)+_0x5f1221),console['log'](_0x53e559(0x125)+_0x5bb528[_0x53e559(0xee)]+'\x20->\x20'+_0x2ad34f[_0x53e559(0xee)]),console[_0x53e559(0x162)](_0x53e559(0x1b1)+_0x5bb528[_0x53e559(0x1f0)]+_0x53e559(0x1d5)+_0x2ad34f[_0x53e559(0x1f0)]),console[_0x53e559(0x162)](_0x53e559(0x1a8)+(_0x5bb528[_0x53e559(0x1f5)]?_0x53e559(0xf0):_0x53e559(0x16c))+_0x53e559(0x1d5)+(_0x2ad34f[_0x53e559(0x1f5)]?_0x53e559(0xf0):_0x53e559(0x16c))),_0x2ad34f;}async[a35_0x5e3a27(0x19d)](_0x58b4f8){const _0x284c37=a35_0x5e3a27,_0x54d817=new Date();let _0x247c9f;switch(_0x58b4f8){case'7d':_0x247c9f=new Date(_0x54d817[_0x284c37(0x1ab)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x247c9f=new Date(_0x54d817[_0x284c37(0x1ab)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x284c37(0x19b):_0x247c9f=new Date(_0x54d817[_0x284c37(0x1ab)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x247c9f=new Date(_0x54d817[_0x284c37(0x1ab)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x44b6be,_0x55fe7d,_0x93320,_0x59942e,_0x2c1d64,_0x2f0a00,_0x7e2289]=await Promise[_0x284c37(0x15d)]([database_1['default'][_0x284c37(0x1bc)]['count'](),database_1['default'][_0x284c37(0x1bc)][_0x284c37(0x104)]({'where':{'status':_0x284c37(0x1ba)}}),database_1['default'][_0x284c37(0x101)]['count']({'where':{'createdAt':{'gte':_0x247c9f},'gateway':{'not':_0x284c37(0x11f)}}}),database_1[_0x284c37(0x19f)][_0x284c37(0x101)][_0x284c37(0x104)]({'where':{'status':'PAID','createdAt':{'gte':_0x247c9f},'gateway':{'not':_0x284c37(0x11f)}}}),database_1[_0x284c37(0x19f)]['payment'][_0x284c37(0x113)]({'where':{'status':_0x284c37(0x1d7),'createdAt':{'gte':_0x247c9f},'gateway':{'not':_0x284c37(0x11f)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x284c37(0x19f)]['payment'][_0x284c37(0x113)]({'where':{'gateway':{'not':_0x284c37(0x11f)}},'take':0xa,'orderBy':{'createdAt':_0x284c37(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x284c37(0x19f)][_0x284c37(0x101)][_0x284c37(0x113)]({'where':{'createdAt':{'gte':_0x247c9f},'gateway':{'not':_0x284c37(0x11f)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x284c37(0x160)}})]);let _0x71d57c=0x0;for(const _0x436b24 of _0x2c1d64){if(_0x436b24[_0x284c37(0x191)])_0x71d57c+=_0x436b24[_0x284c37(0x191)];else{const _0x5c6053=await currencyService_1[_0x284c37(0x186)]['convertToUSDT'](_0x436b24[_0x284c37(0xfa)],_0x436b24[_0x284c37(0x12d)]);_0x71d57c+=_0x5c6053;}}console[_0x284c37(0x162)]('📊\x20[ADMIN]\x20Processing\x20'+_0x7e2289['length']+_0x284c37(0x1fd)),console[_0x284c37(0x162)](_0x284c37(0x154)+_0x247c9f[_0x284c37(0x16d)]()['split']('T')[0x0]+'\x20to\x20'+_0x54d817[_0x284c37(0x16d)]()[_0x284c37(0x14c)]('T')[0x0]);const _0x54b619=_0x7e2289['reduce']((_0x645c1e,_0x282300)=>{const _0x53d5ca=_0x284c37;return _0x645c1e[_0x282300[_0x53d5ca(0x1d9)]]=(_0x645c1e[_0x282300[_0x53d5ca(0x1d9)]]||0x0)+0x1,_0x645c1e;},{});console[_0x284c37(0x162)](_0x284c37(0x1c0),_0x54b619);const _0x4e8d18=await this[_0x284c37(0x15b)](_0x7e2289,_0x247c9f,_0x54d817),_0x105ea3=_0x93320>0x0?_0x59942e/_0x93320*0x64:0x0;return{'totalShops':_0x44b6be,'activeShops':_0x55fe7d,'totalPayments':_0x93320,'successfulPayments':_0x59942e,'totalRevenue':Math[_0x284c37(0x1bd)](_0x71d57c*0x64)/0x64,'conversionRate':Math[_0x284c37(0x1bd)](_0x105ea3*0x64)/0x64,'dailyRevenue':_0x4e8d18[_0x284c37(0x165)],'dailyPayments':_0x4e8d18['dailyPayments'],'recentPayments':_0x2f0a00['map'](_0x1e2c5c=>({'id':_0x1e2c5c['id'],'amount':_0x1e2c5c[_0x284c37(0xfa)],'currency':_0x1e2c5c['currency'],'status':_0x1e2c5c[_0x284c37(0x1d9)],'gateway':_0x1e2c5c[_0x284c37(0x1a6)],'shop':_0x1e2c5c[_0x284c37(0x1bc)],'createdAt':_0x1e2c5c[_0x284c37(0x1f1)]}))};}async[a35_0x5e3a27(0x15b)](_0x2c0777,_0x5a5e73,_0x3c181b){const _0x16c7bc=a35_0x5e3a27,_0xeff6b4=new Map(),_0x3c368d=new Date(_0x5a5e73);while(_0x3c368d<=_0x3c181b){const _0x13aab2=_0x3c368d['toISOString']()[_0x16c7bc(0x14c)]('T')[0x0];_0xeff6b4[_0x16c7bc(0xf0)](_0x13aab2,{'revenue':0x0,'count':0x0}),_0x3c368d[_0x16c7bc(0x169)](_0x3c368d['getDate']()+0x1);}let _0x5c305c=0x0,_0xa41371=0x0;for(const _0x8e5328 of _0x2c0777){const _0x1735ca=_0x8e5328[_0x16c7bc(0x1f1)][_0x16c7bc(0x16d)]()['split']('T')[0x0],_0x238dff=_0xeff6b4[_0x16c7bc(0x189)](_0x1735ca);if(_0x238dff){_0x238dff[_0x16c7bc(0x104)]+=0x1;if(_0x8e5328[_0x16c7bc(0x1d9)]===_0x16c7bc(0x1d7)){_0x5c305c++;if(_0x8e5328['amountUSDT'])_0x238dff['revenue']+=_0x8e5328[_0x16c7bc(0x191)],_0xa41371+=_0x8e5328[_0x16c7bc(0x191)],console[_0x16c7bc(0x162)](_0x16c7bc(0x1dc)+_0x8e5328[_0x16c7bc(0x191)]+_0x16c7bc(0x192)+_0x1735ca+_0x16c7bc(0xf2));else try{const _0x114d2d=await currencyService_1['currencyService'][_0x16c7bc(0x14e)](_0x8e5328[_0x16c7bc(0xfa)],_0x8e5328['currency']);_0x238dff['revenue']+=_0x114d2d,_0xa41371+=_0x114d2d,console['log']('💱\x20[DAILY]\x20Converted\x20'+_0x8e5328[_0x16c7bc(0xfa)]+'\x20'+_0x8e5328['currency']+_0x16c7bc(0x158)+_0x114d2d+_0x16c7bc(0x1e6)+_0x1735ca);}catch(_0x3d9ecf){console[_0x16c7bc(0x1ce)]('⚠️\x20[DAILY]\x20Failed\x20to\x20convert\x20'+_0x8e5328[_0x16c7bc(0xfa)]+'\x20'+_0x8e5328[_0x16c7bc(0x12d)]+'\x20for\x20payment\x20on\x20'+_0x1735ca+':',_0x3d9ecf);}}}}console[_0x16c7bc(0x162)](_0x16c7bc(0x1db)+_0x5c305c+_0x16c7bc(0xf5)+_0x2c0777['length']+_0x16c7bc(0x134)),console[_0x16c7bc(0x162)](_0x16c7bc(0x187)+_0xa41371+'\x20USDT');const _0x4ba004=[],_0x4d6e35=[];for(const [_0x328556,_0x484238]of _0xeff6b4){_0x4ba004[_0x16c7bc(0x168)]({'date':_0x328556,'amount':Math['round'](_0x484238[_0x16c7bc(0x14f)]*0x64)/0x64}),_0x4d6e35[_0x16c7bc(0x168)]({'date':_0x328556,'count':_0x484238[_0x16c7bc(0x104)]});}return{'dailyRevenue':_0x4ba004,'dailyPayments':_0x4d6e35};}async['getMerchantStatistics'](_0x3981fc){const _0x4ab43f=a35_0x5e3a27;console[_0x4ab43f(0x162)](_0x4ab43f(0x1f8),_0x3981fc);let _0x3da47d,_0x2a74e6=new Date();if(_0x3981fc[_0x4ab43f(0x151)]===_0x4ab43f(0x11b)&&_0x3981fc[_0x4ab43f(0x18a)]&&_0x3981fc[_0x4ab43f(0x111)])_0x3da47d=new Date(_0x3981fc[_0x4ab43f(0x18a)]),_0x2a74e6=new Date(_0x3981fc[_0x4ab43f(0x111)]);else{const _0x1d190f=new Date();switch(_0x3981fc[_0x4ab43f(0x151)]){case _0x4ab43f(0x1da):_0x3da47d=new Date(_0x1d190f[_0x4ab43f(0x1ab)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4ab43f(0x1c2):_0x3da47d=new Date(_0x1d190f[_0x4ab43f(0x1ab)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x3da47d=new Date(_0x1d190f[_0x4ab43f(0x1ab)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4ab43f(0x15d):default:_0x3da47d=new Date(_0x4ab43f(0x10c));break;}}console['log'](_0x4ab43f(0x19e)+_0x3da47d[_0x4ab43f(0x16d)]()+'\x20to\x20'+_0x2a74e6[_0x4ab43f(0x16d)]());if(_0x3981fc[_0x4ab43f(0x155)]){const _0xfbbec0=await database_1[_0x4ab43f(0x19f)]['shop'][_0x4ab43f(0x1eb)]({'where':{'id':_0x3981fc[_0x4ab43f(0x155)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console['log'](_0x4ab43f(0x145)+_0x3981fc[_0x4ab43f(0x155)]+':'),console[_0x4ab43f(0x162)](_0x4ab43f(0x12f)+_0xfbbec0?.['name']),console[_0x4ab43f(0x162)](_0x4ab43f(0x106)+_0xfbbec0?.['username']),console[_0x4ab43f(0x162)](_0x4ab43f(0x18c)+(_0xfbbec0?.[_0x4ab43f(0x109)]||_0x4ab43f(0x16f)));if(_0xfbbec0?.['gatewaySettings'])try{const _0x3a2603=JSON[_0x4ab43f(0x136)](_0xfbbec0[_0x4ab43f(0x109)]);console['log'](_0x4ab43f(0x1ea),_0x3a2603),console[_0x4ab43f(0x162)](_0x4ab43f(0x179)+(_0x3a2603[_0x4ab43f(0x141)]||_0x4ab43f(0x17a)));}catch(_0xb75011){console[_0x4ab43f(0x162)](_0x4ab43f(0x172)+_0xb75011);}}const _0x2d6d04={'status':'PAID','gateway':{'not':_0x4ab43f(0x11f)},'paidAt':{'gte':_0x3da47d,'lte':_0x2a74e6}};_0x3981fc[_0x4ab43f(0x155)]&&(_0x2d6d04[_0x4ab43f(0x155)]=_0x3981fc[_0x4ab43f(0x155)]);const _0x11ff12=await database_1['default']['payment']['findMany']({'where':_0x2d6d04,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4ab43f(0x162)](_0x4ab43f(0x126)+_0x11ff12[_0x4ab43f(0x19c)]+_0x4ab43f(0x137));const _0x5e1e50={'gateway':{'not':_0x4ab43f(0x11f)},'createdAt':{'gte':_0x3da47d,'lte':_0x2a74e6}};_0x3981fc[_0x4ab43f(0x155)]&&(_0x5e1e50[_0x4ab43f(0x155)]=_0x3981fc[_0x4ab43f(0x155)]);const _0xd11dc2=await database_1[_0x4ab43f(0x19f)][_0x4ab43f(0x101)]['count']({'where':_0x5e1e50});console[_0x4ab43f(0x162)]('📊\x20Total\x20payments\x20(all\x20statuses):\x20'+_0xd11dc2),console[_0x4ab43f(0x162)](_0x4ab43f(0x190)+_0x11ff12[_0x4ab43f(0x19c)]);let _0x1dcb38=0x0,_0x33629b=0x0,_0x13cef0=0x0;const _0x3c96bc={},_0x352a6b={},_0x41a6f3={};for(const _0x19685e of _0x11ff12){try{const _0x121537=await currencyService_1['currencyService'][_0x4ab43f(0x14e)](_0x19685e[_0x4ab43f(0xfa)],_0x19685e['currency']);let _0x3d6020={};if(_0x19685e[_0x4ab43f(0x1bc)][_0x4ab43f(0x109)])try{_0x3d6020=JSON[_0x4ab43f(0x136)](_0x19685e[_0x4ab43f(0x1bc)][_0x4ab43f(0x109)]);}catch(_0x291f30){console[_0x4ab43f(0x197)](_0x4ab43f(0x157)+_0x19685e[_0x4ab43f(0x155)]+':',_0x291f30);}let _0x23f6ef=0xa;const _0x2573f7=Object[_0x4ab43f(0x1c5)](_0x3d6020)[_0x4ab43f(0x178)](_0x591677=>_0x591677[_0x4ab43f(0x121)]()===_0x19685e[_0x4ab43f(0x1a6)][_0x4ab43f(0x121)]());_0x2573f7&&_0x3d6020[_0x2573f7]&&_0x3d6020[_0x2573f7][_0x4ab43f(0x141)]&&(_0x23f6ef=_0x3d6020[_0x2573f7][_0x4ab43f(0x141)]);console[_0x4ab43f(0x162)](_0x4ab43f(0xeb)+_0x19685e['id']+_0x4ab43f(0x12b)),console['log'](_0x4ab43f(0x131)+_0x19685e[_0x4ab43f(0x1bc)][_0x4ab43f(0x143)]+'\x20('+_0x19685e['shopId']+')'),console[_0x4ab43f(0x162)](_0x4ab43f(0x1d8)+_0x19685e[_0x4ab43f(0x1a6)]),console[_0x4ab43f(0x162)]('\x20\x20\x20Raw\x20gatewaySettings:\x20'+(_0x19685e[_0x4ab43f(0x1bc)][_0x4ab43f(0x109)]||_0x4ab43f(0x16f))),console['log'](_0x4ab43f(0x1ea),_0x3d6020),console[_0x4ab43f(0x162)](_0x4ab43f(0x139)+(_0x2573f7||_0x4ab43f(0x17a))),console[_0x4ab43f(0x162)]('\x20\x20\x20Commission\x20from\x20settings:\x20'+(_0x2573f7&&_0x3d6020[_0x2573f7]?_0x3d6020[_0x2573f7]['commission']:_0x4ab43f(0x17a))),console[_0x4ab43f(0x162)](_0x4ab43f(0x103)+_0x23f6ef+'%');const _0x402aec=_0x121537*(_0x23f6ef/0x64),_0x381f57=_0x121537-_0x402aec;_0x1dcb38+=_0x121537,_0x33629b+=_0x381f57,_0x13cef0+=_0x402aec;!_0x3c96bc[_0x19685e[_0x4ab43f(0x1a6)]]&&(_0x3c96bc[_0x19685e[_0x4ab43f(0x1a6)]]={'gateway':_0x19685e[_0x4ab43f(0x1a6)],'gatewayDisplayName':this[_0x4ab43f(0x16a)](_0x19685e[_0x4ab43f(0x1a6)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3c96bc[_0x19685e['gateway']]['paymentsCount']++,_0x3c96bc[_0x19685e[_0x4ab43f(0x1a6)]][_0x4ab43f(0x1a7)]+=_0x121537,_0x3c96bc[_0x19685e[_0x4ab43f(0x1a6)]][_0x4ab43f(0x1dd)]+=_0x402aec,_0x3c96bc[_0x19685e[_0x4ab43f(0x1a6)]]['merchantEarningsUSDT']+=_0x381f57,_0x3c96bc[_0x19685e[_0x4ab43f(0x1a6)]][_0x4ab43f(0x12e)]+=_0x23f6ef;!_0x3981fc[_0x4ab43f(0x155)]&&(!_0x352a6b[_0x19685e[_0x4ab43f(0x155)]]&&(_0x352a6b[_0x19685e['shopId']]={'shopId':_0x19685e[_0x4ab43f(0x155)],'shopName':_0x19685e[_0x4ab43f(0x1bc)]['name'],'shopUsername':_0x19685e['shop'][_0x4ab43f(0x1d4)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x352a6b[_0x19685e[_0x4ab43f(0x155)]][_0x4ab43f(0xef)]++,_0x352a6b[_0x19685e[_0x4ab43f(0x155)]][_0x4ab43f(0x1a7)]+=_0x121537,_0x352a6b[_0x19685e[_0x4ab43f(0x155)]][_0x4ab43f(0x1dd)]+=_0x402aec,_0x352a6b[_0x19685e[_0x4ab43f(0x155)]][_0x4ab43f(0x1c7)]+=_0x381f57);const _0x41f272=_0x19685e[_0x4ab43f(0x114)][_0x4ab43f(0x16d)]()['split']('T')[0x0];!_0x41a6f3[_0x41f272]&&(_0x41a6f3[_0x41f272]={'date':_0x41f272,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x41a6f3[_0x41f272][_0x4ab43f(0x107)]+=_0x121537,_0x41a6f3[_0x41f272][_0x4ab43f(0x1e3)]+=_0x381f57,_0x41a6f3[_0x41f272][_0x4ab43f(0x1c9)]+=_0x402aec,_0x41a6f3[_0x41f272]['paymentsCount']++;}catch(_0x49ac9d){console[_0x4ab43f(0x197)](_0x4ab43f(0x1d6)+_0x19685e['id']+':',_0x49ac9d);}}Object['values'](_0x3c96bc)[_0x4ab43f(0x1bf)](_0x49d216=>{const _0x18a870=_0x4ab43f;_0x49d216[_0x18a870(0x11d)]=_0x49d216[_0x18a870(0xef)]>0x0?_0x49d216[_0x18a870(0x12e)]/_0x49d216[_0x18a870(0xef)]:0x0,delete _0x49d216[_0x18a870(0x12e)];}),Object[_0x4ab43f(0x1d3)](_0x352a6b)['forEach'](_0x1b8cfa=>{const _0x1f239e=_0x4ab43f;_0x1b8cfa[_0x1f239e(0x1df)]=_0x1b8cfa[_0x1f239e(0xef)]>0x0?_0x1b8cfa[_0x1f239e(0x1a7)]/_0x1b8cfa['paymentsCount']:0x0;});let _0x590724=0x0;if(_0x3981fc[_0x4ab43f(0x155)]){const _0x5b38d2=await database_1['default'][_0x4ab43f(0x1b9)][_0x4ab43f(0x113)]({'where':{'shopId':_0x3981fc[_0x4ab43f(0x155)],'status':_0x4ab43f(0x1ac),'createdAt':{'gte':_0x3da47d,'lte':_0x2a74e6}},'select':{'amount':!![]}});_0x590724=_0x5b38d2[_0x4ab43f(0x1c1)]((_0x5acfbe,_0x2210a8)=>_0x5acfbe+_0x2210a8[_0x4ab43f(0xfa)],0x0);}const _0x1e15a1=_0xd11dc2,_0x1ef356=_0x11ff12[_0x4ab43f(0x19c)],_0x25e821=_0x1ef356>0x0?_0x1dcb38/_0x1ef356:0x0,_0x1fb06c=_0x1e15a1>0x0?_0x1ef356/_0x1e15a1*0x64:0x0;console['log'](_0x4ab43f(0x129)),console[_0x4ab43f(0x162)](_0x4ab43f(0x188)+_0x1e15a1),console[_0x4ab43f(0x162)](_0x4ab43f(0x130)+_0x1ef356),console[_0x4ab43f(0x162)]('\x20\x20\x20Conversion\x20rate:\x20'+_0x1fb06c[_0x4ab43f(0x13d)](0x2)+'%');const _0x446b52=Math[_0x4ab43f(0x1aa)]((_0x2a74e6[_0x4ab43f(0x1ab)]()-_0x3da47d[_0x4ab43f(0x1ab)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3ca28f={'totalTurnover':Math['round'](_0x1dcb38*0x64)/0x64,'merchantEarnings':Math[_0x4ab43f(0x1bd)](_0x33629b*0x64)/0x64,'gatewayEarnings':Math['round'](_0x13cef0*0x64)/0x64,'totalPaidOut':Math[_0x4ab43f(0x1bd)](_0x590724*0x64)/0x64,'averageCheck':Math['round'](_0x25e821*0x64)/0x64,'totalPayments':_0x1e15a1,'successfulPayments':_0x1ef356,'conversionRate':Math[_0x4ab43f(0x1bd)](_0x1fb06c*0x64)/0x64,'gatewayBreakdown':Object[_0x4ab43f(0x1d3)](_0x3c96bc)[_0x4ab43f(0x127)](_0x5abb8a=>({..._0x5abb8a,'turnoverUSDT':Math[_0x4ab43f(0x1bd)](_0x5abb8a[_0x4ab43f(0x1a7)]*0x64)/0x64,'commissionUSDT':Math[_0x4ab43f(0x1bd)](_0x5abb8a['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4ab43f(0x1bd)](_0x5abb8a[_0x4ab43f(0x1c7)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x5abb8a[_0x4ab43f(0x11d)]*0x64)/0x64})),'merchantBreakdown':_0x3981fc[_0x4ab43f(0x155)]?undefined:Object[_0x4ab43f(0x1d3)](_0x352a6b)[_0x4ab43f(0x127)](_0x2c275c=>({..._0x2c275c,'turnoverUSDT':Math[_0x4ab43f(0x1bd)](_0x2c275c[_0x4ab43f(0x1a7)]*0x64)/0x64,'commissionUSDT':Math[_0x4ab43f(0x1bd)](_0x2c275c[_0x4ab43f(0x1dd)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2c275c['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x4ab43f(0x1bd)](_0x2c275c[_0x4ab43f(0x1b8)]*0x64)/0x64,'averageCheckUSDT':Math[_0x4ab43f(0x1bd)](_0x2c275c['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x41a6f3)[_0x4ab43f(0x127)](_0x4142d6=>({..._0x4142d6,'turnover':Math[_0x4ab43f(0x1bd)](_0x4142d6[_0x4ab43f(0x107)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x4142d6['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x4ab43f(0x1bd)](_0x4142d6[_0x4ab43f(0x1c9)]*0x64)/0x64}))[_0x4ab43f(0x17d)]((_0x2d57db,_0x4c4145)=>_0x2d57db[_0x4ab43f(0x116)][_0x4ab43f(0x198)](_0x4c4145['date'])),'periodInfo':{'from':_0x3da47d,'to':_0x2a74e6,'periodType':_0x3981fc[_0x4ab43f(0x151)]||'custom','daysCount':_0x446b52}};return console[_0x4ab43f(0x162)](_0x4ab43f(0x185)),console[_0x4ab43f(0x162)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x3ca28f[_0x4ab43f(0x196)]+_0x4ab43f(0x18b)),console['log'](_0x4ab43f(0x1d1)+_0x3ca28f[_0x4ab43f(0x1e3)]+_0x4ab43f(0x18b)),console[_0x4ab43f(0x162)](_0x4ab43f(0x171)+_0x3ca28f['gatewayEarnings']+_0x4ab43f(0x18b)),console[_0x4ab43f(0x162)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x3ca28f[_0x4ab43f(0x16e)]),console[_0x4ab43f(0x162)](_0x4ab43f(0x18d)+_0x3ca28f[_0x4ab43f(0x1cb)]),console[_0x4ab43f(0x162)](_0x4ab43f(0x1b0)+_0x3ca28f[_0x4ab43f(0x1b4)]+'%'),_0x3ca28f;}[a35_0x5e3a27(0x16a)](_0x5df51d){const _0x3f9b8f=a35_0x5e3a27,_0x13b985={'test_gateway':_0x3f9b8f(0x1f7),'plisio':_0x3f9b8f(0x184),'rapyd':_0x3f9b8f(0x10f),'noda':'Noda','cointopay':_0x3f9b8f(0x1a9),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x3f9b8f(0x1d2)};return _0x13b985[_0x5df51d]||_0x5df51d;}async[a35_0x5e3a27(0x193)](_0x345e62){const _0x4857b6=a35_0x5e3a27,{page:_0x4dbcd7,limit:_0x2e13ce,minAmount:_0x20a2d1,search:_0x34a89e}=_0x345e62,_0x6cefdb=(_0x4dbcd7-0x1)*_0x2e13ce;console[_0x4857b6(0x162)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x345e62);const _0x51d618={'balance':{'gt':0x0},'status':'ACTIVE'};_0x20a2d1&&(_0x51d618[_0x4857b6(0x146)][_0x4857b6(0x15a)]=_0x20a2d1);_0x34a89e&&(_0x51d618['OR']=[{'name':{'contains':_0x34a89e,'mode':'insensitive'}},{'username':{'contains':_0x34a89e,'mode':_0x4857b6(0x119)}}]);const [_0x4838d5,_0x1c8a30]=await Promise['all']([database_1[_0x4857b6(0x19f)]['shop'][_0x4857b6(0x113)]({'where':_0x51d618,'skip':_0x6cefdb,'take':_0x2e13ce,'orderBy':{'balance':_0x4857b6(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x4857b6(0x19f)][_0x4857b6(0x1bc)][_0x4857b6(0x104)]({'where':_0x51d618})]);console[_0x4857b6(0x162)](_0x4857b6(0x126)+_0x4838d5['length']+_0x4857b6(0x1b3));const _0x505bc7=await Promise['all'](_0x4838d5['map'](async _0x57f02b=>{const _0x4749e6=_0x4857b6,[_0x436a36,_0xcd793d,_0x4ee71c]=await Promise['all']([database_1[_0x4749e6(0x19f)]['payment'][_0x4749e6(0x104)]({'where':{'shopId':_0x57f02b['id'],'status':_0x4749e6(0x1d7),'amountUSDT':{'not':null}}}),database_1[_0x4749e6(0x19f)][_0x4749e6(0x101)]['findFirst']({'where':{'shopId':_0x57f02b['id'],'status':_0x4749e6(0x1d7),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x4749e6(0x160)},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x4749e6(0x17e)]({'by':[_0x4749e6(0x1a6)],'where':{'shopId':_0x57f02b['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x466523=_0x4ee71c[_0x4749e6(0x127)](_0x4984af=>({'gateway':_0x4984af[_0x4749e6(0x1a6)],'count':_0x4984af['_count']['id'],'amountUSDT':_0x4984af[_0x4749e6(0x1c3)][_0x4749e6(0x191)]||0x0,'amountAfterCommissionUSDT':_0x4984af['_sum'][_0x4749e6(0x191)]||0x0,'commission':0x0}));return{'id':_0x57f02b['id'],'fullName':_0x57f02b[_0x4749e6(0x143)],'username':_0x57f02b['username'],'telegramId':_0x57f02b[_0x4749e6(0x16b)],'merchantUrl':_0x57f02b[_0x4749e6(0x1ed)],'wallets':{'usdtPolygonWallet':_0x57f02b[_0x4749e6(0x102)],'usdtTrcWallet':_0x57f02b[_0x4749e6(0x11c)],'usdtErcWallet':_0x57f02b[_0x4749e6(0x177)],'usdcPolygonWallet':_0x57f02b[_0x4749e6(0x1b2)]},'totalAmountUSDT':_0x57f02b[_0x4749e6(0x146)],'totalAmountAfterCommissionUSDT':_0x57f02b[_0x4749e6(0x146)],'paymentsCount':_0x436a36,'oldestPaymentDate':_0xcd793d?.[_0x4749e6(0x114)]||_0x57f02b[_0x4749e6(0x1f1)],'gatewayBreakdown':_0x466523};})),_0x4a3a89=_0x4838d5[_0x4857b6(0x1c1)]((_0x372ae9,_0x5b6353)=>_0x372ae9+_0x5b6353[_0x4857b6(0x146)],0x0),_0x590bb4=_0x4a3a89;return console[_0x4857b6(0x162)](_0x4857b6(0xf9)+_0x1c8a30+'\x20merchants,\x20'+Math[_0x4857b6(0x1bd)](_0x590bb4*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x505bc7,'pagination':{'page':_0x4dbcd7,'limit':_0x2e13ce,'total':_0x1c8a30,'totalPages':Math[_0x4857b6(0x1aa)](_0x1c8a30/_0x2e13ce)},'summary':{'totalMerchants':_0x1c8a30,'totalAmountUSDT':Math[_0x4857b6(0x1bd)](_0x4a3a89*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4857b6(0x1bd)](_0x590bb4*0x64)/0x64}};}async[a35_0x5e3a27(0x170)](_0x24f3d6){const _0x317526=a35_0x5e3a27,{shopId:_0x544f3e,amount:_0x42ad11,network:_0x10a7fe,notes:_0x116052,periodFrom:_0x25c4af,periodTo:_0x417d63}=_0x24f3d6,_0x57a239=await database_1[_0x317526(0x19f)][_0x317526(0x13f)](async _0x8a113b=>{const _0x2306ed=_0x317526,_0x2d44d5=await _0x8a113b['shop'][_0x2306ed(0x1eb)]({'where':{'id':_0x544f3e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2d44d5)throw new Error(_0x2306ed(0xfc));console[_0x2306ed(0x162)](_0x2306ed(0x1fa)+_0x2d44d5[_0x2306ed(0x1d4)]+':'),console[_0x2306ed(0x162)](_0x2306ed(0x112)+_0x2d44d5[_0x2306ed(0x146)][_0x2306ed(0x13d)](0x6)+_0x2306ed(0x18b)),console['log'](_0x2306ed(0x10b)+_0x42ad11[_0x2306ed(0x13d)](0x6)+_0x2306ed(0x18b)),console[_0x2306ed(0x162)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x2d44d5[_0x2306ed(0x110)][_0x2306ed(0x13d)](0x6)+'\x20USDT');if(_0x2d44d5['balance']<_0x42ad11)throw new Error(_0x2306ed(0x164)+_0x2d44d5[_0x2306ed(0x146)][_0x2306ed(0x13d)](0x6)+_0x2306ed(0x1a3)+_0x42ad11[_0x2306ed(0x13d)](0x6)+'\x20USDT');const _0x544968=await _0x8a113b[_0x2306ed(0x1b9)][_0x2306ed(0x122)]({'data':{'shopId':_0x544f3e,'amount':_0x42ad11,'network':_0x10a7fe,'status':_0x2306ed(0x1ac),'notes':_0x116052,'periodFrom':_0x25c4af?new Date(_0x25c4af):null,'periodTo':_0x417d63?new Date(_0x417d63):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x472318=_0x2d44d5['balance']-_0x42ad11,_0x3141f1=_0x2d44d5['totalPaidOut']+_0x42ad11;return await _0x8a113b[_0x2306ed(0x1bc)]['update']({'where':{'id':_0x544f3e},'data':{'balance':_0x472318,'totalPaidOut':_0x3141f1}}),console[_0x2306ed(0x162)](_0x2306ed(0x1ee)+_0x2d44d5['username']+_0x2306ed(0x176)),console['log'](_0x2306ed(0x123)+_0x2d44d5[_0x2306ed(0x146)][_0x2306ed(0x13d)](0x6)+_0x2306ed(0x1d5)+_0x472318[_0x2306ed(0x13d)](0x6)+_0x2306ed(0x13a)+_0x42ad11[_0x2306ed(0x13d)](0x6)+')'),console[_0x2306ed(0x162)](_0x2306ed(0x149)+_0x2d44d5[_0x2306ed(0x110)][_0x2306ed(0x13d)](0x6)+_0x2306ed(0x1d5)+_0x3141f1['toFixed'](0x6)+_0x2306ed(0xed)+_0x42ad11[_0x2306ed(0x13d)](0x6)+')'),{'payout':_0x544968,'shop':_0x2d44d5};});return console[_0x317526(0x162)](_0x317526(0x1cd)+_0x57a239[_0x317526(0x1b9)]['id']+'\x20for\x20shop\x20'+_0x57a239[_0x317526(0x1bc)][_0x317526(0x1d4)]+'\x20('+_0x42ad11+_0x317526(0x1e0)),{'id':_0x57a239[_0x317526(0x1b9)]['id'],'shopId':_0x57a239[_0x317526(0x1b9)][_0x317526(0x155)],'shopName':_0x57a239[_0x317526(0x1bc)][_0x317526(0x143)],'shopUsername':_0x57a239[_0x317526(0x1bc)][_0x317526(0x1d4)],'amount':_0x57a239['payout'][_0x317526(0xfa)],'network':_0x57a239['payout'][_0x317526(0x108)],'status':_0x57a239[_0x317526(0x1b9)][_0x317526(0x1d9)],'txid':_0x57a239[_0x317526(0x1b9)][_0x317526(0x1ec)],'notes':_0x57a239[_0x317526(0x1b9)][_0x317526(0x1e2)],'periodFrom':_0x57a239[_0x317526(0x1b9)]['periodFrom'],'periodTo':_0x57a239[_0x317526(0x1b9)][_0x317526(0x199)],'createdAt':_0x57a239[_0x317526(0x1b9)]['createdAt'],'paidAt':_0x57a239[_0x317526(0x1b9)][_0x317526(0x114)]};}async[a35_0x5e3a27(0x183)](_0x3a16fd){const _0x2be4c9=a35_0x5e3a27,{page:_0x2df659,limit:_0x20959b,shopId:_0x4634e6,network:_0x7c4aed,dateFrom:_0x2e332f,dateTo:_0x3889f1,search:_0x285c83}=_0x3a16fd,_0x4c70ec=(_0x2df659-0x1)*_0x20959b,_0x1f9f1a={};_0x4634e6&&(_0x1f9f1a[_0x2be4c9(0x155)]=_0x4634e6);_0x7c4aed&&(_0x1f9f1a[_0x2be4c9(0x108)]=_0x7c4aed);(_0x2e332f||_0x3889f1)&&(_0x1f9f1a[_0x2be4c9(0x1f1)]={},_0x2e332f&&(_0x1f9f1a[_0x2be4c9(0x1f1)][_0x2be4c9(0x15a)]=new Date(_0x2e332f)),_0x3889f1&&(_0x1f9f1a[_0x2be4c9(0x1f1)]['lte']=new Date(_0x3889f1)));_0x285c83&&(_0x1f9f1a['OR']=[{'shop':{'name':{'contains':_0x285c83,'mode':_0x2be4c9(0x119)}}},{'shop':{'username':{'contains':_0x285c83,'mode':_0x2be4c9(0x119)}}},{'notes':{'contains':_0x285c83,'mode':_0x2be4c9(0x119)}}]);const [_0xa75ce8,_0xf5415d]=await Promise[_0x2be4c9(0x15d)]([database_1[_0x2be4c9(0x19f)][_0x2be4c9(0x1b9)][_0x2be4c9(0x113)]({'where':_0x1f9f1a,'skip':_0x4c70ec,'take':_0x20959b,'orderBy':{'createdAt':_0x2be4c9(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2be4c9(0x19f)]['payout'][_0x2be4c9(0x104)]({'where':_0x1f9f1a})]);return{'payouts':_0xa75ce8[_0x2be4c9(0x127)](_0x5e5f5d=>({'id':_0x5e5f5d['id'],'shopId':_0x5e5f5d[_0x2be4c9(0x155)],'shopName':_0x5e5f5d[_0x2be4c9(0x1bc)]['name'],'shopUsername':_0x5e5f5d['shop'][_0x2be4c9(0x1d4)],'amount':_0x5e5f5d[_0x2be4c9(0xfa)],'network':_0x5e5f5d['network'],'status':_0x5e5f5d[_0x2be4c9(0x1d9)],'txid':_0x5e5f5d[_0x2be4c9(0x1ec)],'notes':_0x5e5f5d[_0x2be4c9(0x1e2)],'periodFrom':_0x5e5f5d['periodFrom'],'periodTo':_0x5e5f5d[_0x2be4c9(0x199)],'createdAt':_0x5e5f5d[_0x2be4c9(0x1f1)],'paidAt':_0x5e5f5d[_0x2be4c9(0x114)]})),'pagination':{'page':_0x2df659,'limit':_0x20959b,'total':_0xf5415d,'totalPages':Math[_0x2be4c9(0x1aa)](_0xf5415d/_0x20959b)}};}async[a35_0x5e3a27(0x10e)](_0x2e334d){const _0x4b0819=a35_0x5e3a27,_0x2380d2=await database_1[_0x4b0819(0x19f)][_0x4b0819(0x1b9)][_0x4b0819(0x1eb)]({'where':{'id':_0x2e334d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2380d2)return null;return{'id':_0x2380d2['id'],'shopId':_0x2380d2[_0x4b0819(0x155)],'shopName':_0x2380d2[_0x4b0819(0x1bc)]['name'],'shopUsername':_0x2380d2[_0x4b0819(0x1bc)][_0x4b0819(0x1d4)],'amount':_0x2380d2[_0x4b0819(0xfa)],'network':_0x2380d2[_0x4b0819(0x108)],'status':_0x2380d2[_0x4b0819(0x1d9)],'txid':_0x2380d2['txid'],'notes':_0x2380d2[_0x4b0819(0x1e2)],'periodFrom':_0x2380d2[_0x4b0819(0x1e1)],'periodTo':_0x2380d2[_0x4b0819(0x199)],'createdAt':_0x2380d2[_0x4b0819(0x1f1)],'paidAt':_0x2380d2['paidAt']};}async[a35_0x5e3a27(0x11a)](_0x1b9ecf){const _0x110931=a35_0x5e3a27;await database_1[_0x110931(0x19f)][_0x110931(0x1b9)][_0x110931(0xea)]({'where':{'id':_0x1b9ecf}});}async[a35_0x5e3a27(0x19a)](_0x313644){const _0x2084bd=a35_0x5e3a27,{page:_0x6d7fc2,limit:_0x30480d,status:_0xcc8e09,gateway:_0x2cd0b1,shopId:_0x5e2cc7,dateFrom:_0x489512,dateTo:_0x2f08a0,search:_0x503eaf}=_0x313644,_0x22136f=(_0x6d7fc2-0x1)*_0x30480d,_0x3a5759={};_0xcc8e09&&(_0x3a5759[_0x2084bd(0x1d9)]=_0xcc8e09[_0x2084bd(0x124)]());_0x2cd0b1&&(_0x3a5759[_0x2084bd(0x1a6)]=_0x2cd0b1[_0x2084bd(0x121)]());_0x3a5759[_0x2084bd(0x1a6)]=_0x3a5759[_0x2084bd(0x1a6)]?_0x3a5759['gateway']:{'not':_0x2084bd(0x11f)};if(typeof _0x3a5759[_0x2084bd(0x1a6)]===_0x2084bd(0x115)&&_0x3a5759['gateway']!==_0x2084bd(0x11f)){}else{if(typeof _0x3a5759[_0x2084bd(0x1a6)]===_0x2084bd(0x115)&&_0x3a5759[_0x2084bd(0x1a6)]===_0x2084bd(0x11f)){}else _0x3a5759[_0x2084bd(0x1a6)]={'not':_0x2084bd(0x11f)};}_0x5e2cc7&&(_0x3a5759['shopId']=_0x5e2cc7);(_0x489512||_0x2f08a0)&&(_0x3a5759['createdAt']={},_0x489512&&(_0x3a5759[_0x2084bd(0x1f1)][_0x2084bd(0x15a)]=new Date(_0x489512)),_0x2f08a0&&(_0x3a5759['createdAt']['lte']=new Date(_0x2f08a0)));_0x503eaf&&(_0x3a5759['OR']=[{'orderId':{'contains':_0x503eaf,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x503eaf,'mode':_0x2084bd(0x119)}},{'customerEmail':{'contains':_0x503eaf,'mode':_0x2084bd(0x119)}},{'shop':{'name':{'contains':_0x503eaf,'mode':_0x2084bd(0x119)}}},{'shop':{'username':{'contains':_0x503eaf,'mode':_0x2084bd(0x119)}}}]);const [_0x512e7b,_0x12c5a0]=await Promise[_0x2084bd(0x15d)]([database_1[_0x2084bd(0x19f)][_0x2084bd(0x101)][_0x2084bd(0x113)]({'where':_0x3a5759,'skip':_0x22136f,'take':_0x30480d,'orderBy':{'createdAt':_0x2084bd(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2084bd(0x19f)][_0x2084bd(0x101)][_0x2084bd(0x104)]({'where':_0x3a5759})]);return{'payments':_0x512e7b['map'](_0x4ba49b=>({'id':_0x4ba49b['id'],'shopId':_0x4ba49b[_0x2084bd(0x155)],'gateway':_0x4ba49b[_0x2084bd(0x1a6)],'amount':_0x4ba49b[_0x2084bd(0xfa)],'currency':_0x4ba49b[_0x2084bd(0x12d)],'status':_0x4ba49b[_0x2084bd(0x1d9)],'orderId':_0x4ba49b['orderId'],'gatewayOrderId':_0x4ba49b['gatewayOrderId'],'customerEmail':_0x4ba49b[_0x2084bd(0x175)],'customerName':_0x4ba49b['customerName'],'customerCountry':_0x4ba49b[_0x2084bd(0xee)],'customerIp':_0x4ba49b[_0x2084bd(0x1f0)],'customerUa':_0x4ba49b[_0x2084bd(0x1f5)],'failureMessage':_0x4ba49b['failureMessage'],'cardLast4':_0x4ba49b[_0x2084bd(0x1e4)],'paymentMethod':_0x4ba49b['paymentMethod'],'bankId':_0x4ba49b[_0x2084bd(0x1f9)],'remitterIban':_0x4ba49b[_0x2084bd(0xfb)],'remitterName':_0x4ba49b[_0x2084bd(0x1a1)],'txUrls':_0x4ba49b[_0x2084bd(0x1ae)],'createdAt':_0x4ba49b['createdAt'],'updatedAt':_0x4ba49b[_0x2084bd(0x1f4)],'shop':_0x4ba49b[_0x2084bd(0x1bc)]})),'pagination':{'page':_0x6d7fc2,'limit':_0x30480d,'total':_0x12c5a0,'totalPages':Math[_0x2084bd(0x1aa)](_0x12c5a0/_0x30480d)}};}async['getPaymentById'](_0x23baeb){const _0x19e822=a35_0x5e3a27,_0x274096=await database_1[_0x19e822(0x19f)][_0x19e822(0x101)][_0x19e822(0x1eb)]({'where':{'id':_0x23baeb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x274096)return null;return{'id':_0x274096['id'],'shopId':_0x274096[_0x19e822(0x155)],'gateway':_0x274096[_0x19e822(0x1a6)],'amount':_0x274096['amount'],'currency':_0x274096[_0x19e822(0x12d)],'status':_0x274096[_0x19e822(0x1d9)],'orderId':_0x274096['orderId'],'gatewayOrderId':_0x274096[_0x19e822(0x128)],'customerEmail':_0x274096[_0x19e822(0x175)],'customerName':_0x274096['customerName'],'customerCountry':_0x274096[_0x19e822(0xee)],'customerIp':_0x274096[_0x19e822(0x1f0)],'customerUa':_0x274096['customerUa'],'failureMessage':_0x274096[_0x19e822(0xff)],'externalPaymentUrl':_0x274096[_0x19e822(0x147)],'successUrl':_0x274096[_0x19e822(0x1af)],'failUrl':_0x274096[_0x19e822(0x118)],'pendingUrl':_0x274096[_0x19e822(0x140)],'whiteUrl':_0x274096[_0x19e822(0x1a5)],'cardLast4':_0x274096[_0x19e822(0x1e4)],'paymentMethod':_0x274096[_0x19e822(0x1be)],'bankId':_0x274096[_0x19e822(0x1f9)],'remitterIban':_0x274096[_0x19e822(0xfb)],'remitterName':_0x274096[_0x19e822(0x1a1)],'txUrls':_0x274096[_0x19e822(0x1ae)],'createdAt':_0x274096['createdAt'],'updatedAt':_0x274096['updatedAt'],'shop':_0x274096[_0x19e822(0x1bc)]};}async[a35_0x5e3a27(0x135)](_0x43a6c2,_0x408489,_0x3bd456,_0x24cdfa){const _0x486e80=a35_0x5e3a27,_0x34aec0=await database_1[_0x486e80(0x19f)][_0x486e80(0x13f)](async _0x1ca82f=>{const _0x5fbb5d=_0x486e80,_0x3ce1fc=await _0x1ca82f['payment']['findUnique']({'where':{'id':_0x43a6c2},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3ce1fc)throw new Error(_0x5fbb5d(0x142));const _0x378608=_0x3ce1fc[_0x5fbb5d(0x1d9)],_0xdb33d9=_0x408489['toUpperCase']();console[_0x5fbb5d(0x162)](_0x5fbb5d(0x1d0)+_0x43a6c2+_0x5fbb5d(0x182)+_0x378608+_0x5fbb5d(0x1d5)+_0xdb33d9),console[_0x5fbb5d(0x162)](_0x5fbb5d(0x1f6)+_0x3ce1fc[_0x5fbb5d(0x1bc)][_0x5fbb5d(0x146)]+'\x20USDT');const _0x55e2c0={'status':_0xdb33d9,'updatedAt':new Date(),'statusChangedBy':_0x5fbb5d(0x180),'statusChangedAt':new Date()};_0x3bd456&&(_0x55e2c0[_0x5fbb5d(0x159)]=_0x3bd456);_0xdb33d9===_0x5fbb5d(0x1de)&&_0x24cdfa&&(_0x55e2c0[_0x5fbb5d(0x1fc)]=_0x24cdfa);let _0x1f6133=0x0,_0x197ef8=_0x3ce1fc['shop']['balance'];if(_0xdb33d9==='PAID'&&_0x378608!==_0x5fbb5d(0x1d7)){_0x55e2c0[_0x5fbb5d(0x114)]=new Date();const _0x3cb869=await currencyService_1['currencyService'][_0x5fbb5d(0x14e)](_0x3ce1fc[_0x5fbb5d(0xfa)],_0x3ce1fc[_0x5fbb5d(0x12d)]);_0x55e2c0['amountUSDT']=_0x3cb869,_0x1f6133=_0x3cb869,_0x197ef8+=_0x3cb869,console['log']('💰\x20Payment\x20'+_0x43a6c2+_0x5fbb5d(0x1ef)+_0x3cb869[_0x5fbb5d(0x13d)](0x6)+'\x20USDT\x20to\x20balance');}else _0x378608===_0x5fbb5d(0x1d7)&&_0xdb33d9!==_0x5fbb5d(0x1d7)&&(_0x3ce1fc['amountUSDT']&&(_0x1f6133=-_0x3ce1fc[_0x5fbb5d(0x191)],_0x197ef8-=_0x3ce1fc[_0x5fbb5d(0x191)],_0x55e2c0[_0x5fbb5d(0x191)]=null,console[_0x5fbb5d(0x162)](_0x5fbb5d(0x15c)+_0x43a6c2+_0x5fbb5d(0x1f2)+_0x3ce1fc[_0x5fbb5d(0x191)][_0x5fbb5d(0x13d)](0x6)+_0x5fbb5d(0x120))));if(_0xdb33d9==='CHARGEBACK'){if(_0x378608===_0x5fbb5d(0x1d7)&&_0x3ce1fc[_0x5fbb5d(0x191)]){}_0x24cdfa&&_0x24cdfa>0x0&&(_0x1f6133-=_0x24cdfa,_0x197ef8-=_0x24cdfa,console[_0x5fbb5d(0x162)](_0x5fbb5d(0x14b)+_0x24cdfa[_0x5fbb5d(0x13d)](0x6)+'\x20USDT\x20from\x20balance'));}_0xdb33d9==='REFUND'&&_0x378608===_0x5fbb5d(0x1d7)&&console['log'](_0x5fbb5d(0x1fb));const _0x272118=await _0x1ca82f[_0x5fbb5d(0x101)][_0x5fbb5d(0x17f)]({'where':{'id':_0x43a6c2},'data':_0x55e2c0,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1f6133!==0x0&&(await _0x1ca82f[_0x5fbb5d(0x1bc)][_0x5fbb5d(0x17f)]({'where':{'id':_0x3ce1fc[_0x5fbb5d(0x155)]},'data':{'balance':_0x197ef8}}),console[_0x5fbb5d(0x162)](_0x5fbb5d(0x1ee)+_0x3ce1fc['shopId']+_0x5fbb5d(0x1cf)+_0x3ce1fc['shop'][_0x5fbb5d(0x146)][_0x5fbb5d(0x13d)](0x6)+_0x5fbb5d(0x1d5)+_0x197ef8[_0x5fbb5d(0x13d)](0x6)+_0x5fbb5d(0x1c8)+(_0x1f6133>0x0?'+':'')+_0x1f6133[_0x5fbb5d(0x13d)](0x6)+')')),_0x272118;});return{'id':_0x34aec0['id'],'shopId':_0x34aec0[_0x486e80(0x155)],'gateway':_0x34aec0[_0x486e80(0x1a6)],'amount':_0x34aec0[_0x486e80(0xfa)],'currency':_0x34aec0[_0x486e80(0x12d)],'status':_0x34aec0[_0x486e80(0x1d9)],'orderId':_0x34aec0[_0x486e80(0x144)],'gatewayOrderId':_0x34aec0[_0x486e80(0x128)],'customerEmail':_0x34aec0['customerEmail'],'customerName':_0x34aec0[_0x486e80(0x133)],'customerCountry':_0x34aec0[_0x486e80(0xee)],'customerIp':_0x34aec0[_0x486e80(0x1f0)],'customerUa':_0x34aec0[_0x486e80(0x1f5)],'failureMessage':_0x34aec0[_0x486e80(0xff)],'adminNotes':_0x34aec0['adminNotes'],'chargebackAmount':_0x34aec0['chargebackAmount'],'statusChangedBy':_0x34aec0[_0x486e80(0x1b6)],'statusChangedAt':_0x34aec0[_0x486e80(0x17b)],'createdAt':_0x34aec0[_0x486e80(0x1f1)],'updatedAt':_0x34aec0[_0x486e80(0x1f4)],'shop':_0x34aec0[_0x486e80(0x1bc)]};}async[a35_0x5e3a27(0x117)](_0x57e8ad,_0x63d0c1){const _0x1300f8=a35_0x5e3a27,_0x2e1a43={..._0x63d0c1};_0x63d0c1['password']&&(_0x2e1a43[_0x1300f8(0x1f3)]=await bcryptjs_1[_0x1300f8(0x19f)]['hash'](_0x63d0c1[_0x1300f8(0x1f3)],0xc));_0x63d0c1['fullName']&&(_0x2e1a43[_0x1300f8(0x143)]=_0x63d0c1[_0x1300f8(0x10d)],delete _0x2e1a43[_0x1300f8(0x10d)]);_0x63d0c1[_0x1300f8(0x1e5)]&&(_0x2e1a43['telegram']=_0x63d0c1[_0x1300f8(0x1e5)],delete _0x2e1a43['telegramId']);_0x63d0c1[_0x1300f8(0x1a0)]&&(_0x2e1a43['shopUrl']=_0x63d0c1[_0x1300f8(0x1a0)],delete _0x2e1a43['merchantUrl']);_0x63d0c1[_0x1300f8(0x12a)]&&(_0x2e1a43[_0x1300f8(0xf1)]=JSON['stringify'](_0x63d0c1['gateways']),delete _0x2e1a43[_0x1300f8(0x12a)]);_0x63d0c1[_0x1300f8(0x109)]&&(_0x2e1a43['gatewaySettings']=JSON[_0x1300f8(0x18f)](_0x63d0c1[_0x1300f8(0x109)]),delete _0x2e1a43[_0x1300f8(0x109)]);_0x63d0c1[_0x1300f8(0x1ca)]&&(_0x63d0c1['wallets']['usdtPolygonWallet']!==undefined&&(_0x2e1a43[_0x1300f8(0x102)]=_0x63d0c1[_0x1300f8(0x1ca)]['usdtPolygonWallet']||null),_0x63d0c1[_0x1300f8(0x1ca)][_0x1300f8(0x11c)]!==undefined&&(_0x2e1a43[_0x1300f8(0x11c)]=_0x63d0c1[_0x1300f8(0x1ca)][_0x1300f8(0x11c)]||null),_0x63d0c1[_0x1300f8(0x1ca)][_0x1300f8(0x177)]!==undefined&&(_0x2e1a43[_0x1300f8(0x177)]=_0x63d0c1[_0x1300f8(0x1ca)]['usdtErcWallet']||null),_0x63d0c1[_0x1300f8(0x1ca)]['usdcPolygonWallet']!==undefined&&(_0x2e1a43[_0x1300f8(0x1b2)]=_0x63d0c1[_0x1300f8(0x1ca)][_0x1300f8(0x1b2)]||null),delete _0x2e1a43[_0x1300f8(0x1ca)]);const _0x502206=await database_1[_0x1300f8(0x19f)][_0x1300f8(0x1bc)][_0x1300f8(0x17f)]({'where':{'id':_0x57e8ad},'data':_0x2e1a43,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x502206['id'],'fullName':_0x502206[_0x1300f8(0x143)],'username':_0x502206[_0x1300f8(0x1d4)],'telegramId':_0x502206[_0x1300f8(0x16b)],'merchantUrl':_0x502206['shopUrl'],'gateways':_0x502206[_0x1300f8(0xf1)]?JSON['parse'](_0x502206['paymentGateways']):null,'gatewaySettings':_0x502206[_0x1300f8(0x109)]?JSON[_0x1300f8(0x136)](_0x502206[_0x1300f8(0x109)]):null,'publicKey':_0x502206[_0x1300f8(0x1a2)],'wallets':{'usdtPolygonWallet':_0x502206[_0x1300f8(0x102)],'usdtTrcWallet':_0x502206[_0x1300f8(0x11c)],'usdtErcWallet':_0x502206['usdtErcWallet'],'usdcPolygonWallet':_0x502206['usdcPolygonWallet']},'status':_0x502206[_0x1300f8(0x1d9)],'createdAt':_0x502206['createdAt']};}async[a35_0x5e3a27(0x13b)](_0x24c2d6){const _0x2303af=a35_0x5e3a27,_0x420347=await database_1[_0x2303af(0x19f)][_0x2303af(0x1bc)]['update']({'where':{'id':_0x24c2d6},'data':{'status':_0x2303af(0xfe)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x420347['id'],'fullName':_0x420347['name'],'username':_0x420347[_0x2303af(0x1d4)],'telegramId':_0x420347[_0x2303af(0x16b)],'merchantUrl':_0x420347[_0x2303af(0x1ed)],'gateways':_0x420347['paymentGateways']?JSON[_0x2303af(0x136)](_0x420347[_0x2303af(0xf1)]):null,'gatewaySettings':_0x420347[_0x2303af(0x109)]?JSON[_0x2303af(0x136)](_0x420347['gatewaySettings']):null,'publicKey':_0x420347[_0x2303af(0x1a2)],'wallets':{'usdtPolygonWallet':_0x420347[_0x2303af(0x102)],'usdtTrcWallet':_0x420347['usdtTrcWallet'],'usdtErcWallet':_0x420347[_0x2303af(0x177)],'usdcPolygonWallet':_0x420347[_0x2303af(0x1b2)]},'status':_0x420347[_0x2303af(0x1d9)],'createdAt':_0x420347[_0x2303af(0x1f1)]};}async['activateUser'](_0x73f7fc){const _0x239d81=a35_0x5e3a27,_0x18a209=await database_1[_0x239d81(0x19f)][_0x239d81(0x1bc)][_0x239d81(0x17f)]({'where':{'id':_0x73f7fc},'data':{'status':_0x239d81(0x1ba)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x18a209['id'],'fullName':_0x18a209['name'],'username':_0x18a209[_0x239d81(0x1d4)],'telegramId':_0x18a209['telegram'],'merchantUrl':_0x18a209[_0x239d81(0x1ed)],'gateways':_0x18a209[_0x239d81(0xf1)]?JSON[_0x239d81(0x136)](_0x18a209[_0x239d81(0xf1)]):null,'gatewaySettings':_0x18a209[_0x239d81(0x109)]?JSON['parse'](_0x18a209[_0x239d81(0x109)]):null,'publicKey':_0x18a209[_0x239d81(0x1a2)],'wallets':{'usdtPolygonWallet':_0x18a209['usdtPolygonWallet'],'usdtTrcWallet':_0x18a209[_0x239d81(0x11c)],'usdtErcWallet':_0x18a209['usdtErcWallet'],'usdcPolygonWallet':_0x18a209['usdcPolygonWallet']},'status':_0x18a209['status'],'createdAt':_0x18a209[_0x239d81(0x1f1)]};}async[a35_0x5e3a27(0x152)](_0x3f0ee8){const _0x4d1c35=a35_0x5e3a27,{page:_0x110389,limit:_0x581d2f,status:_0x9679d8}=_0x3f0ee8,_0x8ce5f8=(_0x110389-0x1)*_0x581d2f,_0x2586cc={};_0x9679d8&&(_0x2586cc['status']=_0x9679d8[_0x4d1c35(0x124)]());const [_0x4b5930,_0x11d7c6]=await Promise[_0x4d1c35(0x15d)]([database_1[_0x4d1c35(0x19f)][_0x4d1c35(0x1bc)][_0x4d1c35(0x113)]({'where':_0x2586cc,'skip':_0x8ce5f8,'take':_0x581d2f,'orderBy':{'createdAt':_0x4d1c35(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4d1c35(0x19f)][_0x4d1c35(0x1bc)][_0x4d1c35(0x104)]({'where':_0x2586cc})]);return{'users':_0x4b5930[_0x4d1c35(0x127)](_0x2bb79e=>({'id':_0x2bb79e['id'],'fullName':_0x2bb79e[_0x4d1c35(0x143)],'username':_0x2bb79e[_0x4d1c35(0x1d4)],'telegramId':_0x2bb79e[_0x4d1c35(0x16b)],'merchantUrl':_0x2bb79e['shopUrl'],'gateways':_0x2bb79e[_0x4d1c35(0xf1)]?JSON[_0x4d1c35(0x136)](_0x2bb79e[_0x4d1c35(0xf1)]):null,'gatewaySettings':_0x2bb79e['gatewaySettings']?JSON[_0x4d1c35(0x136)](_0x2bb79e[_0x4d1c35(0x109)]):null,'publicKey':_0x2bb79e['publicKey'],'wallets':{'usdtPolygonWallet':_0x2bb79e[_0x4d1c35(0x102)],'usdtTrcWallet':_0x2bb79e[_0x4d1c35(0x11c)],'usdtErcWallet':_0x2bb79e[_0x4d1c35(0x177)],'usdcPolygonWallet':_0x2bb79e['usdcPolygonWallet']},'status':_0x2bb79e['status'],'createdAt':_0x2bb79e['createdAt']})),'pagination':{'page':_0x110389,'limit':_0x581d2f,'total':_0x11d7c6,'totalPages':Math['ceil'](_0x11d7c6/_0x581d2f)}};}async[a35_0x5e3a27(0x15f)](_0x376036){const _0x41101c=a35_0x5e3a27,_0x55b6c3=await database_1[_0x41101c(0x19f)][_0x41101c(0x1bc)][_0x41101c(0x1eb)]({'where':{'id':_0x376036},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x55b6c3)return null;return{'id':_0x55b6c3['id'],'fullName':_0x55b6c3[_0x41101c(0x143)],'username':_0x55b6c3[_0x41101c(0x1d4)],'telegramId':_0x55b6c3['telegram'],'merchantUrl':_0x55b6c3[_0x41101c(0x1ed)],'gateways':_0x55b6c3['paymentGateways']?JSON[_0x41101c(0x136)](_0x55b6c3[_0x41101c(0xf1)]):null,'gatewaySettings':_0x55b6c3[_0x41101c(0x109)]?JSON[_0x41101c(0x136)](_0x55b6c3[_0x41101c(0x109)]):null,'publicKey':_0x55b6c3['publicKey'],'wallets':{'usdtPolygonWallet':_0x55b6c3['usdtPolygonWallet'],'usdtTrcWallet':_0x55b6c3['usdtTrcWallet'],'usdtErcWallet':_0x55b6c3[_0x41101c(0x177)],'usdcPolygonWallet':_0x55b6c3[_0x41101c(0x1b2)]},'status':_0x55b6c3[_0x41101c(0x1d9)],'createdAt':_0x55b6c3[_0x41101c(0x1f1)]};}async[a35_0x5e3a27(0x1a4)](_0x20a7e2){const _0x1918d4=a35_0x5e3a27,{fullName:_0x378246,username:_0x6885b2,password:_0x59ee50,telegramId:_0x2a3d94,merchantUrl:_0x364d70,gateways:_0x58f7d9,gatewaySettings:_0x5b8421,wallets:_0x501599}=_0x20a7e2,_0x157038=await database_1[_0x1918d4(0x19f)][_0x1918d4(0x1bc)][_0x1918d4(0x1eb)]({'where':{'username':_0x6885b2}});if(_0x157038)throw new Error(_0x1918d4(0x174));if(_0x2a3d94){const _0x1d25aa=await database_1['default'][_0x1918d4(0x1bc)][_0x1918d4(0x1eb)]({'where':{'telegram':_0x2a3d94}});if(_0x1d25aa)throw new Error(_0x1918d4(0x1c6));}const _0x48a25e=await bcryptjs_1[_0x1918d4(0x19f)][_0x1918d4(0x163)](_0x59ee50,0xc),_0x27f8e8=_0x1918d4(0x12c)+crypto_1['default'][_0x1918d4(0x1c4)](0x20)[_0x1918d4(0x161)](_0x1918d4(0xf4)),_0x2f0a42='sk_'+crypto_1['default'][_0x1918d4(0x1c4)](0x20)['toString'](_0x1918d4(0xf4)),_0x5d121f=await database_1[_0x1918d4(0x19f)]['shop'][_0x1918d4(0x122)]({'data':{'name':_0x378246,'username':_0x6885b2,'password':_0x48a25e,'telegram':_0x2a3d94,'shopUrl':_0x364d70,'paymentGateways':_0x58f7d9?JSON[_0x1918d4(0x18f)](_0x58f7d9):null,'gatewaySettings':_0x5b8421?JSON[_0x1918d4(0x18f)](_0x5b8421):null,'usdtPolygonWallet':_0x501599?.[_0x1918d4(0x102)]||null,'usdtTrcWallet':_0x501599?.['usdtTrcWallet']||null,'usdtErcWallet':_0x501599?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x501599?.[_0x1918d4(0x1b2)]||null,'publicKey':_0x27f8e8,'secretKey':_0x2f0a42,'status':_0x1918d4(0x1ba)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d121f['id'],'fullName':_0x5d121f[_0x1918d4(0x143)],'username':_0x5d121f[_0x1918d4(0x1d4)],'telegramId':_0x5d121f[_0x1918d4(0x16b)],'merchantUrl':_0x5d121f['shopUrl'],'gateways':_0x5d121f['paymentGateways']?JSON[_0x1918d4(0x136)](_0x5d121f[_0x1918d4(0xf1)]):null,'gatewaySettings':_0x5d121f[_0x1918d4(0x109)]?JSON['parse'](_0x5d121f['gatewaySettings']):null,'publicKey':_0x5d121f['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d121f[_0x1918d4(0x102)],'usdtTrcWallet':_0x5d121f[_0x1918d4(0x11c)],'usdtErcWallet':_0x5d121f[_0x1918d4(0x177)],'usdcPolygonWallet':_0x5d121f['usdcPolygonWallet']},'status':_0x5d121f[_0x1918d4(0x1d9)],'createdAt':_0x5d121f[_0x1918d4(0x1f1)]};}async[a35_0x5e3a27(0x1e7)](_0x3e5b97){const _0x1ff005=a35_0x5e3a27;await database_1[_0x1ff005(0x19f)][_0x1ff005(0x1bc)]['delete']({'where':{'id':_0x3e5b97}});}async[a35_0x5e3a27(0x166)](_0x3ceebd){const _0x5dc7fb=a35_0x5e3a27,_0x105fec={};_0x3ceebd&&[_0x5dc7fb(0x1ba),_0x5dc7fb(0x100),_0x5dc7fb(0xfe)][_0x5dc7fb(0x14d)](_0x3ceebd['toUpperCase']())&&(_0x105fec[_0x5dc7fb(0x1d9)]=_0x3ceebd[_0x5dc7fb(0x124)]());const _0x154460=await database_1[_0x5dc7fb(0x19f)][_0x5dc7fb(0x1bc)]['findMany']({'where':_0x105fec,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x5dc7fb(0x160)}});return _0x154460;}}function a35_0x3501(){const _0x257e33=['\x20USDT\x20from\x20balance','toLowerCase','create','\x20\x20\x20Balance:\x20','toUpperCase','\x20\x20\x20🌍\x20Country:\x20','💰\x20Found\x20','map','gatewayOrderId','📊\x20Conversion\x20rate\x20calculation:','gateways','\x20commission\x20analysis:','pk_','currency','totalCommissionRate','\x20\x20\x20Name:\x20','\x20\x20\x20Successful\x20payments:\x20','\x20\x20\x20Shop:\x20','1770cxFleB','customerName','\x20total','updatePaymentStatus','parse','\x20paid\x20payments\x20for\x20analysis','\x20\x20\x20📅\x20This\x20month:\x20','\x20\x20\x20Gateway\x20key\x20found:\x20','\x20USDT\x20(-','suspendUser','desc','toFixed','3133052nUuYNd','$transaction','pendingUrl','commission','Payment\x20not\x20found','name','orderId','📊\x20Shop\x20info\x20for\x20','balance','externalPaymentUrl','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','8lxSyzE','💸\x20CHARGEBACK\x20penalty:\x20-','split','includes','convertToUSDT','revenue','\x20USDT\x20(same\x20as\x20awaiting)','period','getAllUsers','bcryptjs','📊\x20[ADMIN]\x20Period:\x20','shopId','getPayoutStats','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20to\x20','adminNotes','gte','generateDailyStatistics','💰\x20Payment\x20','all','availableBalance','getUserById','asc','toString','log','hash','Insufficient\x20balance.\x20Available:\x20','dailyRevenue','getMerchantsSelection','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','push','setDate','getGatewayDisplayName','telegram','not\x20set','toISOString','totalPayments','null','createPayout','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','Username\x20already\x20exists','customerEmail','\x20balance\x20updated:','usdtErcWallet','find','\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20','not\x20found','statusChangedAt','__esModule','sort','groupBy','update','admin','20YKoYeC','\x20status:\x20','getAllPayouts','Plisio','📊\x20Merchant\x20statistics\x20calculated:','currencyService','📊\x20[DAILY]\x20Total\x20revenue\x20processed:\x20','\x20\x20\x20Total\x20payments:\x20','get','dateFrom','\x20USDT','\x20\x20\x20Raw\x20gatewaySettings:\x20','\x20\x20\x20✅\x20Successful\x20payments:\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','stringify','✅\x20Successful\x20payments:\x20','amountUSDT','\x20USDT\x20for\x20','getMerchantsAwaitingPayout','20023201UMeOIf','4280213raBoUi','totalTurnover','error','localeCompare','periodTo','getAllPayments','90d','length','getSystemStatistics','📅\x20Period:\x20','default','merchantUrl','remitterName','publicKey','\x20USDT,\x20Requested:\x20','createUser','whiteUrl','gateway','turnoverUSDT','\x20\x20\x20🖥️\x20User\x20Agent:\x20','CoinToPay','ceil','getTime','COMPLETED','thisMonth','txUrls','successUrl','\x20\x20\x20📈\x20Conversion\x20rate:\x20','\x20\x20\x20🌐\x20IP:\x20','usdcPolygonWallet','\x20merchants\x20with\x20positive\x20balance','conversionRate','getMonth','statusChangedBy','3003228JWCMbU','paidOutUSDT','payout','ACTIVE','12PHalCF','shop','round','paymentMethod','forEach','📊\x20[ADMIN]\x20Status\x20breakdown:','reduce','month','_sum','randomBytes','keys','Telegram\x20username\x20already\x20exists','merchantEarningsUSDT','\x20USDT\x20(','gatewayEarnings','wallets','successfulPayments','15350qXhpit','✅\x20Payout\x20created:\x20','warn','\x20balance\x20updated:\x20','🔄\x20Admin\x20updating\x20payment\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','KLYME\x20DE','values','username','\x20->\x20','Error\x20processing\x20payment\x20','PAID','\x20\x20\x20Gateway:\x20','status','week','📊\x20[DAILY]\x20Processed\x20','💰\x20[DAILY]\x20Added\x20','commissionUSDT','CHARGEBACK','averageCheckUSDT','\x20USDT)','periodFrom','notes','merchantEarnings','cardLast4','telegramId','\x20USDT\x20for\x20payment\x20on\x20','deleteUser','\x20\x20\x20💵\x20Available\x20balance:\x20','366570vCZahj','\x20\x20\x20Parsed\x20gatewaySettings:','findUnique','txid','shopUrl','💰\x20Shop\x20','\x20became\x20PAID:\x20+','customerIp','createdAt','\x20no\x20longer\x20PAID:\x20-','password','updatedAt','customerUa','💰\x20Current\x20shop\x20balance:\x20','Test\x20Gateway','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','bankId','💰\x20Creating\x20payout\x20for\x20shop\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','chargebackAmount','\x20payments\x20for\x20daily\x20statistics','aggregate','delete','📊\x20Payment\x20','AdminService','\x20USDT\x20(+','customerCountry','paymentsCount','set','paymentGateways','\x20(direct\x20amountUSDT)','updateCustomerData','hex','\x20PAID\x20payments\x20out\x20of\x20','__importDefault','crypto','23304SQdTJY','📊\x20Merchants\x20awaiting\x20payout:\x20','amount','remitterIban','Shop\x20not\x20found','\x20\x20\x20💰\x20Total\x20payout:\x20','SUSPENDED','failureMessage','INACTIVE','payment','usdtPolygonWallet','\x20\x20\x20Final\x20commission\x20used:\x20','count','getFullYear','\x20\x20\x20Username:\x20','turnover','network','gatewaySettings','34prbaEN','\x20\x20\x20Payout\x20amount:\x20','2020-01-01','fullName','getPayoutById','Rapyd','totalPaidOut','dateTo','\x20\x20\x20Current\x20balance:\x20','findMany','paidAt','string','date','updateUser','failUrl','insensitive','deletePayout','custom','usdtTrcWallet','averageCommissionRate','📊\x20Calculating\x20payout\x20statistics...','test_gateway'];a35_0x3501=function(){return _0x257e33;};return a35_0x3501();}exports[a35_0x5e3a27(0xec)]=AdminService;