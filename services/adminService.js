'use strict';const a33_0x3ff3a5=a33_0x15e0;function a33_0x15e0(_0x2ff169,_0x59218e){const _0x27efcb=a33_0x27ef();return a33_0x15e0=function(_0x15e0a9,_0x3c3652){_0x15e0a9=_0x15e0a9-0xa4;let _0x3e2e84=_0x27efcb[_0x15e0a9];return _0x3e2e84;},a33_0x15e0(_0x2ff169,_0x59218e);}(function(_0x1b7494,_0x1f067f){const _0x173729=a33_0x15e0,_0x2a1037=_0x1b7494();while(!![]){try{const _0x421e5a=parseInt(_0x173729(0x176))/0x1*(-parseInt(_0x173729(0xee))/0x2)+-parseInt(_0x173729(0x10e))/0x3+-parseInt(_0x173729(0xd5))/0x4*(parseInt(_0x173729(0xc3))/0x5)+-parseInt(_0x173729(0x110))/0x6*(parseInt(_0x173729(0xb0))/0x7)+parseInt(_0x173729(0xcb))/0x8+-parseInt(_0x173729(0xdf))/0x9+parseInt(_0x173729(0x159))/0xa*(parseInt(_0x173729(0xbc))/0xb);if(_0x421e5a===_0x1f067f)break;else _0x2a1037['push'](_0x2a1037['shift']());}catch(_0x35d30e){_0x2a1037['push'](_0x2a1037['shift']());}}}(a33_0x27ef,0x44d5e));var __importDefault=this&&this[a33_0x3ff3a5(0xc8)]||function(_0x37b489){const _0xa150dc=a33_0x3ff3a5;return _0x37b489&&_0x37b489[_0xa150dc(0x177)]?_0x37b489:{'default':_0x37b489};};Object[a33_0x3ff3a5(0x138)](exports,a33_0x3ff3a5(0x177),{'value':!![]}),exports[a33_0x3ff3a5(0xac)]=void 0x0;function a33_0x27ef(){const _0x9b0552=['notes','sendPayoutNotification','\x20deleted\x20successfully','paymentGateways','default','REFUND','webhookLogs','shop','expiresAt','getAllPayouts','Shop\x20not\x20found','getPaymentById','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','payments','suspendUser','PAID','üìÖ\x20This\x20Month:\x20','txid','45680OYhzpQ','\x20days','abs','getMonth','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','PENDING','‚ùå\x20Payout\x20not\x20found:\x20','get','findMany','parse','cardLast4','./telegramBotService','30d','üìä\x20Found\x20','‚úÖ\x20Found\x20payment:\x20','username','join','Invalid\x20status.\x20Valid\x20statuses:\x20','‚úÖ\x20Payment\x20','‚úÖ\x20Activating\x20user:\x20','amountAfterCommissionUSDT','usage','slice','set','lte','thisMonth','isEligibleForPayout','\x20USDT','126425ihZKLW','__esModule','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','status','üí∞\x20Found\x20','telegram','üîç\x20Getting\x20payout\x20by\x20ID:\x20','awaitingPayout','\x20USDT\x20after\x20commission)','toUpperCase','calculateEffectiveAmount','AdminService','toLowerCase','userService','updateUser','725018HXsJIl','split','amount','\x20USDT\x20(','FAILED','date','sourceCurrency','üí∏\x20Chargeback\x20penalty:\x20','reduce','all','deletePayout','statusChangedAt','3421LUhIBG','User\x20is\x20already\x20suspended','\x20merchants\x20out\x20of\x20','\x20days)','getUserById','Shop\x20is\x20not\x20active','gateway','665rRyJBj','admin_status_update','ceil','publicKey','size','__importDefault','asc','totalAmountUSDT','677672kwJCmG','../config/database','getMerchantsAwaitingPayout','payment','externalPaymentUrl','toISOString','charAt','toFixed','update','availableBalance','10340kUbeDE','commission','generateDateRange','stringify','üí∏\x20Total\x20Payout:\x20','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','\x20status\x20updated\x20from\x20','\x20suspended\x20successfully','findUnique','totalAmountAfterCommissionUSDT','1191420jUfECy','payoutDelay','‚úÖ\x20Marked\x20','\x20payments\x20out\x20of\x20','User\x20not\x20found','markPaymentsAsPaidOut','\x20USDT\x20via\x20','\x20total','‚ùå\x20Payment\x20not\x20found:\x20','CHARGEBACK','error','createdAt','amountUSDT','./currencyService','insensitive','2hdttUX','\x20USDT\x20(penalty\x20amount)','SUSPENDED','paymentMethod','orderId','üìä\x20Calculating\x20admin\x20payout\x20statistics...','calculateAmountAfterCommission','üíµ\x20Total\x20revenue:\x20','getGatewaySettings','map','network','updateMany','üí≥\x20Total\x20payments:\x20','deleteUser','üîÑ\x20Admin\x20updating\x20payment\x20','üóëÔ∏è\x20Deleting\x20payout:\x20','ACTIVE','adminNotes','üí∞\x20Total\x20amount:\x20','paidAt','customerEmail','getFullYear','‚úÖ\x20Payout\x20statistics\x20calculated:','üè™\x20Found\x20','getAllUsers','createUser','desc','gatewayPaymentId','setDate','‚úÖ\x20User\x20','isValidGatewayId','convertToUSDT','1551669bZkvsv','bankId','6EIbpdR','currencyService','has','getGatewayNameById','../types/gateway','includes','shopUrl','Payment\x20not\x20found','payout','name','$queryRaw','Payout\x20not\x20found',',\x20amount:\x20','üë•\x20Total\x20users:\x20','remitterIban','log','statusChangedBy','create','round','push','getPeriodDays','updatedAt','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','üö´\x20Suspending\x20user:\x20','üìà\x20Average\x20payment:\x20','‚úÖ\x20Found\x20payout:\x20','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','shopId','usdtPolygonWallet','üí∏\x20Creating\x20payout\x20for\x20shop\x20','gatewayOrderId','üîç\x20Getting\x20payment\x20by\x20ID:\x20','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','count','length','telegramBotService','merchantPaid','gatewaySettings','chargebackAmount','gte','defineProperty','usdtTrcWallet','usdtErcWallet','COMPLETED','totalPayout','getAllPayments','customerName','EXPIRED','UserService','remitterName','Error\x20parsing\x20gateway\x20settings:','getPayoutStats','getDate','currency','User\x20is\x20already\x20active'];a33_0x27ef=function(){return _0x9b0552;};return a33_0x27ef();}const database_1=__importDefault(require(a33_0x3ff3a5(0xcc))),currencyService_1=require(a33_0x3ff3a5(0xec)),userService_1=require('./userService'),telegramBotService_1=require(a33_0x3ff3a5(0x165)),gateway_1=require(a33_0x3ff3a5(0x114));class AdminService{constructor(){const _0x2fd527=a33_0x3ff3a5;this[_0x2fd527(0xae)]=new userService_1[(_0x2fd527(0x140))]();}['getPeriodDays'](_0x3a7da4){const _0x557d8a=a33_0x3ff3a5;switch(_0x3a7da4){case'7d':return 0x7;case _0x557d8a(0x166):return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x3ff3a5(0xd7)](_0x49d561,_0x31e5ca){const _0x4c5f17=a33_0x3ff3a5,_0x27c8fb=[],_0x1a1d6b=new Date(_0x49d561);while(_0x1a1d6b<=_0x31e5ca){_0x27c8fb[_0x4c5f17(0x123)](_0x1a1d6b[_0x4c5f17(0xd0)]()['split']('T')[0x0]),_0x1a1d6b['setDate'](_0x1a1d6b[_0x4c5f17(0x144)]()+0x1);}return _0x27c8fb;}[a33_0x3ff3a5(0xf6)](_0x413287,_0x55a194){const _0x2652d3=a33_0x3ff3a5;if(!_0x413287[_0x2652d3(0x135)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x25105e=JSON[_0x2652d3(0x163)](_0x413287['gatewaySettings']),_0x590bd0=_0x55a194['charAt'](0x0)[_0x2652d3(0xaa)]()+_0x55a194['slice'](0x1)[_0x2652d3(0xad)]();if(_0x25105e&&_0x25105e[_0x590bd0])return{'commission':_0x25105e[_0x590bd0]['commission']||0x0,'payoutDelay':_0x25105e[_0x590bd0][_0x2652d3(0xe0)]||0x0};}catch(_0x45366b){console['error'](_0x2652d3(0x142),_0x45366b);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x3ff3a5(0x174)](_0x2bad44){const _0x792771=a33_0x3ff3a5;if(_0x2bad44[_0x792771(0xa4)]!==_0x792771(0x156)||_0x2bad44[_0x792771(0x134)]||!_0x2bad44[_0x792771(0x101)])return![];const _0x1c3a68=this[_0x792771(0xf6)](_0x2bad44[_0x792771(0x14e)],_0x2bad44[_0x792771(0xc2)]),_0x5f29fe=_0x1c3a68[_0x792771(0xe0)]*0x18*0x3c*0x3c*0x3e8,_0x1a7537=new Date(_0x2bad44[_0x792771(0x101)]['getTime']()+_0x5f29fe);return new Date()>_0x1a7537;}[a33_0x3ff3a5(0xf4)](_0x594ec8,_0x117a27){return _0x594ec8*(0x1-_0x117a27/0x64);}['calculateEffectiveAmount'](_0xc08677){const _0xdecefd=a33_0x3ff3a5;switch(_0xc08677[_0xdecefd(0xa4)]){case _0xdecefd(0x156):return _0xc08677[_0xdecefd(0xb2)];case _0xdecefd(0xe8):return-(_0xc08677[_0xdecefd(0x136)]||0x0);case _0xdecefd(0x14c):return 0x0;default:return 0x0;}}async['createPayout'](_0x3b355e){const _0x5d8de3=a33_0x3ff3a5,{shopId:_0xc9d2bb,amount:_0x50b037,network:_0x26ec52,notes:_0x5871c8}=_0x3b355e;console[_0x5d8de3(0x11f)](_0x5d8de3(0x12d)+_0xc9d2bb+':\x20'+_0x50b037+_0x5d8de3(0xe5)+_0x26ec52);const _0x4dc2b2=await database_1[_0x5d8de3(0x14b)][_0x5d8de3(0x14e)][_0x5d8de3(0xdd)]({'where':{'id':_0xc9d2bb},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x4dc2b2)throw new Error(_0x5d8de3(0x151));if(_0x4dc2b2['status']!==_0x5d8de3(0xfe))throw new Error(_0x5d8de3(0xc1));const _0x18f793=await database_1[_0x5d8de3(0x14b)][_0x5d8de3(0x118)][_0x5d8de3(0x121)]({'data':{'shopId':_0xc9d2bb,'amount':_0x50b037,'network':_0x26ec52,'status':_0x5d8de3(0x13b),'notes':_0x5871c8||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x5d8de3(0xe4)](_0xc9d2bb,_0x50b037);try{await telegramBotService_1[_0x5d8de3(0x133)][_0x5d8de3(0x148)](_0xc9d2bb,_0x18f793,'completed');}catch(_0x5cf1b3){console[_0x5d8de3(0xe9)](_0x5d8de3(0x130),_0x5cf1b3);}return console['log']('‚úÖ\x20Payout\x20created\x20successfully:\x20'+_0x18f793['id']),{'id':_0x18f793['id'],'shopId':_0x18f793['shopId'],'shopName':_0x18f793[_0x5d8de3(0x14e)]['name'],'shopUsername':_0x18f793[_0x5d8de3(0x14e)][_0x5d8de3(0x169)],'amount':_0x18f793[_0x5d8de3(0xb2)],'network':_0x18f793[_0x5d8de3(0xf8)],'status':_0x18f793['status'],'txid':_0x18f793['txid'],'notes':_0x18f793['notes'],'createdAt':_0x18f793[_0x5d8de3(0xea)],'paidAt':_0x18f793[_0x5d8de3(0x101)]};}async[a33_0x3ff3a5(0xe4)](_0x4022d3,_0x3b47cc){const _0x1f3f6d=a33_0x3ff3a5;console[_0x1f3f6d(0x11f)]('üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20'+_0x4022d3+_0x1f3f6d(0x11c)+_0x3b47cc+_0x1f3f6d(0x175));const _0x4a2016=await database_1[_0x1f3f6d(0x14b)][_0x1f3f6d(0xce)][_0x1f3f6d(0x162)]({'where':{'shopId':_0x4022d3,'status':_0x1f3f6d(0x156),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x1f3f6d(0xc9)}});let _0x15810c=_0x3b47cc;const _0x3872fa=[];for(const _0x1693d5 of _0x4a2016){const _0x3986b3={..._0x1693d5,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0x1693d5[_0x1f3f6d(0x14e)]['gatewaySettings']}};if(!this[_0x1f3f6d(0x174)](_0x3986b3))continue;const _0xc5575a=await currencyService_1[_0x1f3f6d(0x111)]['convertToUSDT'](_0x1693d5[_0x1f3f6d(0xb2)],_0x1693d5['currency']),_0x587372=this['getGatewaySettings'](_0x1693d5[_0x1f3f6d(0x14e)],_0x1693d5[_0x1f3f6d(0xc2)]),_0x4431aa=this[_0x1f3f6d(0xf4)](_0xc5575a,_0x587372['commission']);if(_0x4431aa<=_0x15810c){_0x3872fa['push'](_0x1693d5['id']),_0x15810c-=_0x4431aa;if(_0x15810c<=0.01)break;}}_0x3872fa[_0x1f3f6d(0x132)]>0x0&&(await database_1['default']['payment'][_0x1f3f6d(0xf9)]({'where':{'id':{'in':_0x3872fa}},'data':{'merchantPaid':!![]}}),console[_0x1f3f6d(0x11f)](_0x1f3f6d(0xe1)+_0x3872fa['length']+'\x20payments\x20as\x20paid\x20out'));}async[a33_0x3ff3a5(0x150)](_0x3bad77){const _0x3e4fa3=a33_0x3ff3a5,{page:_0x4e6c6e,limit:_0x15f907,shopId:_0x14a092,network:_0x3c6d2f,dateFrom:_0xedccb5,dateTo:_0x1852c9,search:_0x297e22}=_0x3bad77,_0x71b4cd=(_0x4e6c6e-0x1)*_0x15f907;console['log']('üìã\x20Getting\x20payouts\x20with\x20filters:',_0x3bad77);const _0x4c17fc={};_0x14a092&&(_0x4c17fc[_0x3e4fa3(0x12b)]=_0x14a092);_0x3c6d2f&&(_0x4c17fc[_0x3e4fa3(0xf8)]=_0x3c6d2f);(_0xedccb5||_0x1852c9)&&(_0x4c17fc[_0x3e4fa3(0xea)]={},_0xedccb5&&(_0x4c17fc[_0x3e4fa3(0xea)]['gte']=new Date(_0xedccb5)),_0x1852c9&&(_0x4c17fc[_0x3e4fa3(0xea)][_0x3e4fa3(0x172)]=new Date(_0x1852c9)));_0x297e22&&(_0x4c17fc['OR']=[{'txid':{'contains':_0x297e22,'mode':'insensitive'}},{'notes':{'contains':_0x297e22,'mode':_0x3e4fa3(0xed)}},{'shop':{'name':{'contains':_0x297e22,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x297e22,'mode':_0x3e4fa3(0xed)}}}]);const [_0x4949b0,_0x3a6f0b]=await Promise[_0x3e4fa3(0xb9)]([database_1[_0x3e4fa3(0x14b)][_0x3e4fa3(0x118)]['findMany']({'where':_0x4c17fc,'skip':_0x71b4cd,'take':_0x15f907,'orderBy':{'createdAt':_0x3e4fa3(0x108)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3e4fa3(0x14b)][_0x3e4fa3(0x118)][_0x3e4fa3(0x131)]({'where':_0x4c17fc})]);console['log'](_0x3e4fa3(0x167)+_0x4949b0[_0x3e4fa3(0x132)]+'\x20payouts\x20out\x20of\x20'+_0x3a6f0b+_0x3e4fa3(0xe6));const _0x43351e=_0x4949b0[_0x3e4fa3(0xf7)](_0x2e0ece=>({'id':_0x2e0ece['id'],'shopId':_0x2e0ece['shopId'],'shopName':_0x2e0ece[_0x3e4fa3(0x14e)][_0x3e4fa3(0x119)],'shopUsername':_0x2e0ece[_0x3e4fa3(0x14e)][_0x3e4fa3(0x169)],'amount':_0x2e0ece[_0x3e4fa3(0xb2)],'network':_0x2e0ece[_0x3e4fa3(0xf8)],'status':_0x2e0ece[_0x3e4fa3(0xa4)],'txid':_0x2e0ece['txid'],'notes':_0x2e0ece[_0x3e4fa3(0x147)],'createdAt':_0x2e0ece[_0x3e4fa3(0xea)],'paidAt':_0x2e0ece[_0x3e4fa3(0x101)]}));return{'payouts':_0x43351e,'pagination':{'page':_0x4e6c6e,'limit':_0x15f907,'total':_0x3a6f0b,'totalPages':Math[_0x3e4fa3(0xc5)](_0x3a6f0b/_0x15f907)}};}async['getPayoutById'](_0x2c6822){const _0x4f31e9=a33_0x3ff3a5;console[_0x4f31e9(0x11f)](_0x4f31e9(0xa7)+_0x2c6822);const _0x4debdf=await database_1[_0x4f31e9(0x14b)][_0x4f31e9(0x118)]['findUnique']({'where':{'id':_0x2c6822},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4debdf)return console[_0x4f31e9(0x11f)](_0x4f31e9(0x160)+_0x2c6822),null;return console[_0x4f31e9(0x11f)](_0x4f31e9(0x129)+_0x4debdf[_0x4f31e9(0xb2)]+_0x4f31e9(0xe5)+_0x4debdf[_0x4f31e9(0xf8)]),{'id':_0x4debdf['id'],'shopId':_0x4debdf[_0x4f31e9(0x12b)],'shopName':_0x4debdf['shop'][_0x4f31e9(0x119)],'shopUsername':_0x4debdf[_0x4f31e9(0x14e)]['username'],'amount':_0x4debdf[_0x4f31e9(0xb2)],'network':_0x4debdf[_0x4f31e9(0xf8)],'status':_0x4debdf[_0x4f31e9(0xa4)],'txid':_0x4debdf[_0x4f31e9(0x158)],'notes':_0x4debdf[_0x4f31e9(0x147)],'createdAt':_0x4debdf[_0x4f31e9(0xea)],'paidAt':_0x4debdf[_0x4f31e9(0x101)]};}async[a33_0x3ff3a5(0xba)](_0x357500){const _0xc47da5=a33_0x3ff3a5;console[_0xc47da5(0x11f)](_0xc47da5(0xfd)+_0x357500);const _0xfb560d=await database_1[_0xc47da5(0x14b)][_0xc47da5(0x118)][_0xc47da5(0xdd)]({'where':{'id':_0x357500},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0xfb560d)throw new Error(_0xc47da5(0x11b));await database_1['default'][_0xc47da5(0x118)]['delete']({'where':{'id':_0x357500}}),console[_0xc47da5(0x11f)]('‚úÖ\x20Payout\x20'+_0x357500+_0xc47da5(0x149));}async[a33_0x3ff3a5(0xcd)](_0x312c6d){const _0x407a91=a33_0x3ff3a5,{page:_0x123291,limit:_0x33b58f,minAmount:_0x5eb6ed,search:_0x242897}=_0x312c6d;console[_0x407a91(0x11f)]('üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x312c6d);const _0x30edaa=await database_1[_0x407a91(0x14b)][_0x407a91(0xce)][_0x407a91(0x162)]({'where':{'status':_0x407a91(0x156),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x407a91(0x11f)](_0x407a91(0xa5)+_0x30edaa[_0x407a91(0x132)]+_0x407a91(0x15e));const _0x2b08b4=new Map();for(const _0x388238 of _0x30edaa){const _0x3dc2d2={..._0x388238,'status':_0x407a91(0x156),'merchantPaid':![],'shop':{'gatewaySettings':_0x388238[_0x407a91(0x14e)][_0x407a91(0x135)]}},_0x2d187e=this[_0x407a91(0x174)](_0x3dc2d2);if(!_0x2d187e)continue;const _0x5959c9=await currencyService_1[_0x407a91(0x111)][_0x407a91(0x10d)](_0x388238[_0x407a91(0xb2)],_0x388238['currency']),_0x28d4a9=this[_0x407a91(0xf6)](_0x388238['shop'],_0x388238[_0x407a91(0xc2)]),_0x4aaa65=this['calculateAmountAfterCommission'](_0x5959c9,_0x28d4a9['commission']),_0x2dde5d=_0x388238[_0x407a91(0x12b)];!_0x2b08b4[_0x407a91(0x112)](_0x2dde5d)&&_0x2b08b4[_0x407a91(0x171)](_0x2dde5d,{'shop':_0x388238['shop'],'payments':[]}),_0x2b08b4[_0x407a91(0x161)](_0x2dde5d)[_0x407a91(0x154)]['push']({'id':_0x388238['id'],'amount':_0x388238[_0x407a91(0xb2)],'currency':_0x388238['currency'],'gateway':_0x388238[_0x407a91(0xc2)],'paidAt':_0x388238[_0x407a91(0x101)],'createdAt':_0x388238['createdAt'],'amountUSDT':_0x5959c9,'commission':_0x28d4a9[_0x407a91(0xd6)],'amountAfterCommissionUSDT':_0x4aaa65,'isEligible':!![]});}console['log'](_0x407a91(0x105)+_0x2b08b4[_0x407a91(0xc7)]+'\x20merchants\x20with\x20eligible\x20PAID\x20payments');const _0x2ff2f5=[];for(const [_0x4ff29e,_0x1c3ed2]of _0x2b08b4){const {shop:_0x1ed1e8,payments:_0xb6f318}=_0x1c3ed2,_0x3d4723=_0xb6f318[_0x407a91(0xb8)]((_0x41fe1d,_0x4209e0)=>_0x41fe1d+_0x4209e0[_0x407a91(0xeb)],0x0),_0x1bd35d=_0xb6f318[_0x407a91(0xb8)]((_0x14f949,_0x2d1e02)=>_0x14f949+_0x2d1e02[_0x407a91(0x16e)],0x0);if(_0x5eb6ed&&_0x1bd35d<_0x5eb6ed)continue;if(_0x242897){const _0x5e632e=_0x242897[_0x407a91(0xad)](),_0x19c3f0=_0x1ed1e8['name'][_0x407a91(0xad)]()[_0x407a91(0x115)](_0x5e632e)||_0x1ed1e8[_0x407a91(0x169)][_0x407a91(0xad)]()['includes'](_0x5e632e)||_0x1ed1e8['telegram']&&_0x1ed1e8[_0x407a91(0xa6)][_0x407a91(0xad)]()[_0x407a91(0x115)](_0x5e632e);if(!_0x19c3f0)continue;}const _0x69c176=new Map();for(const _0x218e3d of _0xb6f318){const _0xd6231e=_0x218e3d[_0x407a91(0xc2)];!_0x69c176['has'](_0xd6231e)&&_0x69c176[_0x407a91(0x171)](_0xd6231e,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x218e3d[_0x407a91(0xd6)]});const _0x446c06=_0x69c176[_0x407a91(0x161)](_0xd6231e);_0x446c06[_0x407a91(0x131)]++,_0x446c06[_0x407a91(0xeb)]+=_0x218e3d[_0x407a91(0xeb)],_0x446c06['amountAfterCommissionUSDT']+=_0x218e3d[_0x407a91(0x16e)];}const _0x2dc171=Array['from'](_0x69c176['entries']())['map'](([_0x49e18c,_0x5d8f24])=>({'gateway':_0x49e18c[_0x407a91(0xd1)](0x0)['toUpperCase']()+_0x49e18c[_0x407a91(0x170)](0x1),'count':_0x5d8f24[_0x407a91(0x131)],'amountUSDT':Math[_0x407a91(0x122)](_0x5d8f24['amountUSDT']*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x5d8f24[_0x407a91(0x16e)]*0x64)/0x64,'commission':_0x5d8f24[_0x407a91(0xd6)]})),_0x5c2b45=_0xb6f318[_0x407a91(0xb8)]((_0x4b337f,_0x2f9b80)=>{const _0x4e13c1=_0x407a91;return _0x2f9b80[_0x4e13c1(0x101)]<_0x4b337f?_0x2f9b80[_0x4e13c1(0x101)]:_0x4b337f;},_0xb6f318[0x0]['paidAt']);_0x2ff2f5['push']({'id':_0x1ed1e8['id'],'fullName':_0x1ed1e8['name'],'username':_0x1ed1e8[_0x407a91(0x169)],'telegramId':_0x1ed1e8[_0x407a91(0xa6)],'merchantUrl':_0x1ed1e8[_0x407a91(0x116)],'wallets':{'usdtPolygonWallet':_0x1ed1e8[_0x407a91(0x12c)],'usdtTrcWallet':_0x1ed1e8[_0x407a91(0x139)],'usdtErcWallet':_0x1ed1e8[_0x407a91(0x13a)],'usdcPolygonWallet':_0x1ed1e8['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x407a91(0x122)](_0x3d4723*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1bd35d*0x64)/0x64,'paymentsCount':_0xb6f318[_0x407a91(0x132)],'oldestPaymentDate':_0x5c2b45,'gatewayBreakdown':_0x2dc171});}_0x2ff2f5['sort']((_0x3b5c00,_0x4db344)=>_0x4db344['totalAmountAfterCommissionUSDT']-_0x3b5c00[_0x407a91(0xde)]);const _0x335177=_0x2ff2f5['length'],_0x2bbac1=_0x2ff2f5[_0x407a91(0xb8)]((_0x5b0c85,_0x5f096c)=>_0x5b0c85+_0x5f096c[_0x407a91(0xca)],0x0),_0xd7777d=_0x2ff2f5[_0x407a91(0xb8)]((_0x6ba7da,_0x5e982b)=>_0x6ba7da+_0x5e982b[_0x407a91(0xde)],0x0),_0x396f3c=(_0x123291-0x1)*_0x33b58f,_0x5f002d=_0x2ff2f5[_0x407a91(0x170)](_0x396f3c,_0x396f3c+_0x33b58f);return console[_0x407a91(0x11f)]('‚úÖ\x20Returning\x20'+_0x5f002d[_0x407a91(0x132)]+_0x407a91(0xbe)+_0x335177+_0x407a91(0xe6)),console[_0x407a91(0x11f)](_0x407a91(0x100)+_0x2bbac1['toFixed'](0x2)+_0x407a91(0xb3)+_0xd7777d['toFixed'](0x2)+_0x407a91(0xa9)),{'merchants':_0x5f002d,'pagination':{'page':_0x123291,'limit':_0x33b58f,'total':_0x335177,'totalPages':Math[_0x407a91(0xc5)](_0x335177/_0x33b58f)},'summary':{'totalMerchants':_0x335177,'totalAmountUSDT':Math[_0x407a91(0x122)](_0x2bbac1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0xd7777d*0x64)/0x64}};}async[a33_0x3ff3a5(0x143)](){const _0x5336a0=a33_0x3ff3a5;console[_0x5336a0(0x11f)](_0x5336a0(0xf3));const _0x577675=await database_1[_0x5336a0(0x14b)][_0x5336a0(0xce)][_0x5336a0(0x162)]({'where':{'status':{'in':[_0x5336a0(0x156),_0x5336a0(0x14c),_0x5336a0(0xe8)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log'](_0x5336a0(0xa5)+_0x577675[_0x5336a0(0x132)]+_0x5336a0(0x15d));const _0x37c187=new Date(),_0x2d4a30=new Date(_0x37c187[_0x5336a0(0x103)](),_0x37c187[_0x5336a0(0x15c)](),0x1),_0x423219=new Date(_0x37c187[_0x5336a0(0x103)](),_0x37c187['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x23fe1=0x0,_0x4c704e=0x0,_0x51792e=0x0,_0xbc92e0=0x0;for(const _0x5a528c of _0x577675){const _0xf998e6=this['calculateEffectiveAmount'](_0x5a528c);if(_0xf998e6===0x0)continue;let _0x3e6012,_0x49d542;if(_0x5a528c[_0x5336a0(0xa4)]===_0x5336a0(0xe8))_0x3e6012=Math['abs'](_0xf998e6),_0x49d542=-_0x3e6012;else{_0x3e6012=await currencyService_1[_0x5336a0(0x111)][_0x5336a0(0x10d)](_0x5a528c[_0x5336a0(0xb2)],_0x5a528c['currency']);const _0x3927a1=this[_0x5336a0(0xf6)](_0x5a528c[_0x5336a0(0x14e)],_0x5a528c['gateway']);_0x49d542=this[_0x5336a0(0xf4)](_0x3e6012,_0x3927a1[_0x5336a0(0xd6)]);}_0x5a528c['merchantPaid']&&(_0x23fe1+=_0x49d542,_0x5a528c[_0x5336a0(0x101)]&&_0x5a528c[_0x5336a0(0x101)]>=_0x2d4a30&&_0x5a528c[_0x5336a0(0x101)]<=_0x423219&&(_0x51792e+=_0x49d542)),_0x5a528c[_0x5336a0(0xa4)]==='PAID'&&this[_0x5336a0(0x174)](_0x5a528c)&&(_0x4c704e+=_0x49d542,_0xbc92e0+=_0x3e6012);}const _0xb340a={'totalPayout':Math[_0x5336a0(0x122)](_0x23fe1*0x64)/0x64,'awaitingPayout':Math['round'](_0x4c704e*0x64)/0x64,'thisMonth':Math[_0x5336a0(0x122)](_0x51792e*0x64)/0x64,'availableBalance':Math[_0x5336a0(0x122)](_0xbc92e0*0x64)/0x64};return console[_0x5336a0(0x11f)](_0x5336a0(0x104)),console[_0x5336a0(0x11f)](_0x5336a0(0xd9)+_0xb340a[_0x5336a0(0x13c)]+'\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)'),console[_0x5336a0(0x11f)]('‚è≥\x20Awaiting\x20Payout:\x20'+_0xb340a[_0x5336a0(0xa8)]+'\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)'),console[_0x5336a0(0x11f)](_0x5336a0(0x157)+_0xb340a[_0x5336a0(0x173)]+_0x5336a0(0x175)),console[_0x5336a0(0x11f)]('üí∞\x20Available\x20Balance:\x20'+_0xb340a[_0x5336a0(0xd4)]+_0x5336a0(0x175)),_0xb340a;}async['getSystemStatistics'](_0xecf287){const _0x436db6=a33_0x3ff3a5,_0x23f8f7=this[_0x436db6(0x124)](_0xecf287),_0x3d57f2=new Date();_0x3d57f2[_0x436db6(0x10a)](_0x3d57f2['getDate']()-_0x23f8f7),console[_0x436db6(0x11f)](_0x436db6(0x153)+_0xecf287+'\x20('+_0x23f8f7+_0x436db6(0xbf));const _0x1b166f=await database_1['default'][_0x436db6(0x14e)]['count']({'where':{'status':_0x436db6(0xfe)}}),_0x1e9229=await database_1[_0x436db6(0x14b)][_0x436db6(0xce)][_0x436db6(0x131)](),_0x496898=await database_1[_0x436db6(0x14b)][_0x436db6(0xce)][_0x436db6(0x162)]({'where':{'status':{'in':[_0x436db6(0x156),'REFUND',_0x436db6(0xe8)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x436db6(0x11f)]('üí∞\x20Found\x20'+_0x496898['length']+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x5036b5=await Promise[_0x436db6(0xb9)](_0x496898[_0x436db6(0xf7)](async _0x5883ad=>{const _0x17f1db=_0x436db6,_0x340f7b=this['calculateEffectiveAmount'](_0x5883ad);if(_0x340f7b===0x0)return{'amount':0x0,'createdAt':_0x5883ad['createdAt']};let _0x2e87cd;return _0x5883ad[_0x17f1db(0xa4)]===_0x17f1db(0xe8)?_0x2e87cd=-Math[_0x17f1db(0x15b)](_0x340f7b):_0x2e87cd=await currencyService_1[_0x17f1db(0x111)]['convertToUSDT'](_0x5883ad[_0x17f1db(0xb2)],_0x5883ad[_0x17f1db(0x145)]),{'amount':_0x2e87cd,'createdAt':_0x5883ad['createdAt']};})),_0x3e1a9e=_0x5036b5['reduce']((_0x4e2e18,_0x374c16)=>_0x4e2e18+_0x374c16[_0x436db6(0xb2)],0x0),_0xb3ba8a=_0x1e9229>0x0?_0x3e1a9e/_0x1e9229:0x0;console[_0x436db6(0x11f)](_0x436db6(0xf5)+_0x3e1a9e[_0x436db6(0xd2)](0x2)+_0x436db6(0xda)),console[_0x436db6(0x11f)](_0x436db6(0x128)+_0xb3ba8a[_0x436db6(0xd2)](0x2)+_0x436db6(0x175));const _0x15cacf=await database_1[_0x436db6(0x14b)][_0x436db6(0x11a)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x3d57f2}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x436db6(0x11f)](_0x436db6(0x12a)+_0x15cacf[_0x436db6(0x132)]+_0x436db6(0x15a));const _0x2dfcb5=await Promise[_0x436db6(0xb9)](_0x15cacf[_0x436db6(0xf7)](async _0x5702b1=>{const _0x45d560=_0x436db6,_0x3b54ec=await Promise[_0x45d560(0xb9)](_0x5702b1[_0x45d560(0x154)][_0x45d560(0xf7)](async _0x3ffc99=>{const _0x116ca6=_0x45d560,_0x3bab71=this[_0x116ca6(0xab)](_0x3ffc99);if(_0x3bab71===0x0)return 0x0;return _0x3ffc99[_0x116ca6(0xa4)]===_0x116ca6(0xe8)?-Math[_0x116ca6(0x15b)](_0x3bab71):await currencyService_1['currencyService'][_0x116ca6(0x10d)](_0x3ffc99['amount'],_0x3ffc99[_0x116ca6(0x145)]);})),_0x463de9=_0x3b54ec[_0x45d560(0xb8)]((_0x2dc35b,_0x4f7768)=>_0x2dc35b+_0x4f7768,0x0);return{'date':_0x5702b1[_0x45d560(0xb5)]['toISOString']()[_0x45d560(0xb1)]('T')[0x0],'amount':_0x463de9};})),_0x39331b=this[_0x436db6(0xd7)](_0x3d57f2,new Date()),_0x3ae739=new Map(_0x2dfcb5[_0x436db6(0xf7)](_0x30e2cb=>[_0x30e2cb[_0x436db6(0xb5)],_0x30e2cb[_0x436db6(0xb2)]])),_0x3c50e4=_0x39331b[_0x436db6(0xf7)](_0x400dc7=>({'date':_0x400dc7,'amount':_0x3ae739[_0x436db6(0x161)](_0x400dc7)||0x0}));return console['log'](_0x436db6(0x178)),console[_0x436db6(0x11f)](_0x436db6(0x11d)+_0x1b166f),console['log'](_0x436db6(0xfa)+_0x1e9229),console[_0x436db6(0x11f)]('üìä\x20Daily\x20revenue\x20entries:\x20'+_0x3c50e4[_0x436db6(0x132)]),{'totalRevenue':Math[_0x436db6(0x122)](_0x3e1a9e*0x64)/0x64,'totalUsers':_0x1b166f,'totalPayments':_0x1e9229,'averagePayment':Math[_0x436db6(0x122)](_0xb3ba8a*0x64)/0x64,'dailyRevenue':_0x3c50e4};}async[a33_0x3ff3a5(0x13d)](_0x2c297a){const _0x4ae6c9=a33_0x3ff3a5,{page:_0x3fee2b,limit:_0x2c546f,status:_0x5dd3fc,gateway:_0x1d89af,shopId:_0x5ed391,dateFrom:_0x256226,dateTo:_0x124c43,search:_0x2ddbf5}=_0x2c297a,_0x4d516a=(_0x3fee2b-0x1)*_0x2c546f;console[_0x4ae6c9(0x11f)]('üìã\x20Getting\x20payments\x20with\x20filters:',_0x2c297a);const _0x391bc0={};_0x5dd3fc&&(_0x391bc0[_0x4ae6c9(0xa4)]=_0x5dd3fc['toUpperCase']());if(_0x1d89af){if((0x0,gateway_1[_0x4ae6c9(0x10c)])(_0x1d89af)){const _0xbab752=(0x0,gateway_1[_0x4ae6c9(0x113)])(_0x1d89af);_0xbab752&&(_0x391bc0[_0x4ae6c9(0xc2)]=_0xbab752);}else _0x391bc0['gateway']=_0x1d89af[_0x4ae6c9(0xad)]();}_0x5ed391&&(_0x391bc0[_0x4ae6c9(0x12b)]=_0x5ed391);(_0x256226||_0x124c43)&&(_0x391bc0['createdAt']={},_0x256226&&(_0x391bc0[_0x4ae6c9(0xea)][_0x4ae6c9(0x137)]=new Date(_0x256226)),_0x124c43&&(_0x391bc0['createdAt'][_0x4ae6c9(0x172)]=new Date(_0x124c43)));_0x2ddbf5&&(_0x391bc0['OR']=[{'orderId':{'contains':_0x2ddbf5,'mode':_0x4ae6c9(0xed)}},{'gatewayOrderId':{'contains':_0x2ddbf5,'mode':_0x4ae6c9(0xed)}},{'gatewayPaymentId':{'contains':_0x2ddbf5,'mode':_0x4ae6c9(0xed)}},{'customerEmail':{'contains':_0x2ddbf5,'mode':_0x4ae6c9(0xed)}},{'customerName':{'contains':_0x2ddbf5,'mode':_0x4ae6c9(0xed)}},{'shop':{'name':{'contains':_0x2ddbf5,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x2ddbf5,'mode':_0x4ae6c9(0xed)}}}]);const [_0x4e4d35,_0x211b33]=await Promise['all']([database_1[_0x4ae6c9(0x14b)][_0x4ae6c9(0xce)][_0x4ae6c9(0x162)]({'where':_0x391bc0,'skip':_0x4d516a,'take':_0x2c546f,'orderBy':{'createdAt':_0x4ae6c9(0x108)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x4ae6c9(0x131)]({'where':_0x391bc0})]);console[_0x4ae6c9(0x11f)](_0x4ae6c9(0x167)+_0x4e4d35[_0x4ae6c9(0x132)]+_0x4ae6c9(0xe2)+_0x211b33+_0x4ae6c9(0xe6));const _0x41f2b8=_0x4e4d35[_0x4ae6c9(0xf7)](_0x35f66d=>({'id':_0x35f66d['id'],'shopId':_0x35f66d[_0x4ae6c9(0x12b)],'shopName':_0x35f66d[_0x4ae6c9(0x14e)][_0x4ae6c9(0x119)],'shopUsername':_0x35f66d['shop']['username'],'gateway':_0x35f66d[_0x4ae6c9(0xc2)],'orderId':_0x35f66d[_0x4ae6c9(0xf2)],'gatewayOrderId':_0x35f66d[_0x4ae6c9(0x12e)],'amount':_0x35f66d[_0x4ae6c9(0xb2)],'currency':_0x35f66d['currency'],'sourceCurrency':_0x35f66d[_0x4ae6c9(0xb6)],'status':_0x35f66d[_0x4ae6c9(0xa4)],'usage':_0x35f66d[_0x4ae6c9(0x16f)],'externalPaymentUrl':_0x35f66d[_0x4ae6c9(0xcf)],'gatewayPaymentId':_0x35f66d[_0x4ae6c9(0x109)],'customerEmail':_0x35f66d['customerEmail'],'customerName':_0x35f66d[_0x4ae6c9(0x13e)],'cardLast4':_0x35f66d['cardLast4'],'paymentMethod':_0x35f66d['paymentMethod'],'bankId':_0x35f66d[_0x4ae6c9(0x10f)],'remitterIban':_0x35f66d[_0x4ae6c9(0x11e)],'remitterName':_0x35f66d[_0x4ae6c9(0x141)],'chargebackAmount':_0x35f66d[_0x4ae6c9(0x136)],'adminNotes':_0x35f66d[_0x4ae6c9(0xff)],'statusChangedBy':_0x35f66d[_0x4ae6c9(0x120)],'statusChangedAt':_0x35f66d[_0x4ae6c9(0xbb)],'createdAt':_0x35f66d[_0x4ae6c9(0xea)],'updatedAt':_0x35f66d[_0x4ae6c9(0x125)],'expiresAt':_0x35f66d[_0x4ae6c9(0x14f)]}));return{'payments':_0x41f2b8,'pagination':{'page':_0x3fee2b,'limit':_0x2c546f,'total':_0x211b33,'totalPages':Math[_0x4ae6c9(0xc5)](_0x211b33/_0x2c546f)}};}async[a33_0x3ff3a5(0x152)](_0x4a8361){const _0x1b3c79=a33_0x3ff3a5;console[_0x1b3c79(0x11f)](_0x1b3c79(0x12f)+_0x4a8361);const _0x1d0dbe=await database_1['default'][_0x1b3c79(0xce)][_0x1b3c79(0xdd)]({'where':{'id':_0x4a8361},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x1b3c79(0x108)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x1d0dbe)return console[_0x1b3c79(0x11f)](_0x1b3c79(0xe7)+_0x4a8361),null;return console[_0x1b3c79(0x11f)](_0x1b3c79(0x168)+_0x1d0dbe['orderId']+'\x20('+_0x1d0dbe['status']+')'),{'id':_0x1d0dbe['id'],'shopId':_0x1d0dbe['shopId'],'shopName':_0x1d0dbe[_0x1b3c79(0x14e)][_0x1b3c79(0x119)],'shopUsername':_0x1d0dbe[_0x1b3c79(0x14e)][_0x1b3c79(0x169)],'gateway':_0x1d0dbe[_0x1b3c79(0xc2)],'orderId':_0x1d0dbe[_0x1b3c79(0xf2)],'gatewayOrderId':_0x1d0dbe[_0x1b3c79(0x12e)],'amount':_0x1d0dbe[_0x1b3c79(0xb2)],'currency':_0x1d0dbe['currency'],'sourceCurrency':_0x1d0dbe[_0x1b3c79(0xb6)],'status':_0x1d0dbe['status'],'usage':_0x1d0dbe[_0x1b3c79(0x16f)],'externalPaymentUrl':_0x1d0dbe[_0x1b3c79(0xcf)],'gatewayPaymentId':_0x1d0dbe[_0x1b3c79(0x109)],'customerEmail':_0x1d0dbe[_0x1b3c79(0x102)],'customerName':_0x1d0dbe['customerName'],'cardLast4':_0x1d0dbe['cardLast4'],'paymentMethod':_0x1d0dbe[_0x1b3c79(0xf1)],'bankId':_0x1d0dbe[_0x1b3c79(0x10f)],'remitterIban':_0x1d0dbe['remitterIban'],'remitterName':_0x1d0dbe[_0x1b3c79(0x141)],'chargebackAmount':_0x1d0dbe['chargebackAmount'],'adminNotes':_0x1d0dbe[_0x1b3c79(0xff)],'statusChangedBy':_0x1d0dbe[_0x1b3c79(0x120)],'statusChangedAt':_0x1d0dbe[_0x1b3c79(0xbb)],'createdAt':_0x1d0dbe[_0x1b3c79(0xea)],'updatedAt':_0x1d0dbe['updatedAt'],'expiresAt':_0x1d0dbe[_0x1b3c79(0x14f)],'webhookLogs':_0x1d0dbe[_0x1b3c79(0x14d)]};}async['updatePaymentStatus'](_0x26826d,_0x288ce5,_0x24c71d,_0xcda450){const _0x3a4a6d=a33_0x3ff3a5;console[_0x3a4a6d(0x11f)](_0x3a4a6d(0xfc)+_0x26826d+'\x20status\x20to:\x20'+_0x288ce5);const _0xd34568=[_0x3a4a6d(0x15f),_0x3a4a6d(0x156),_0x3a4a6d(0x13f),_0x3a4a6d(0xb4),_0x3a4a6d(0x14c),_0x3a4a6d(0xe8)];if(!_0xd34568[_0x3a4a6d(0x115)](_0x288ce5[_0x3a4a6d(0xaa)]()))throw new Error(_0x3a4a6d(0x16b)+_0xd34568[_0x3a4a6d(0x16a)](',\x20'));const _0x87cf0c=await database_1[_0x3a4a6d(0x14b)]['payment'][_0x3a4a6d(0xdd)]({'where':{'id':_0x26826d},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x87cf0c)throw new Error(_0x3a4a6d(0x117));if(_0x288ce5['toUpperCase']()===_0x3a4a6d(0xe8)){if(!_0xcda450||_0xcda450<=0x0)throw new Error('Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)');console['log']('üí∏\x20Chargeback\x20amount:\x20'+_0xcda450+_0x3a4a6d(0xef));}const _0x5d446a={'status':_0x288ce5[_0x3a4a6d(0xaa)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x24c71d&&(_0x5d446a[_0x3a4a6d(0xff)]=_0x24c71d);_0x288ce5[_0x3a4a6d(0xaa)]()===_0x3a4a6d(0xe8)&&_0xcda450&&(_0x5d446a[_0x3a4a6d(0x136)]=_0xcda450);const _0x5d946d=await database_1['default'][_0x3a4a6d(0xce)][_0x3a4a6d(0xd3)]({'where':{'id':_0x26826d},'data':_0x5d446a,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x3a4a6d(0x14b)]['webhookLog'][_0x3a4a6d(0x121)]({'data':{'paymentId':_0x26826d,'shopId':_0x5d946d[_0x3a4a6d(0x12b)],'event':_0x3a4a6d(0xc4),'statusCode':0xc8,'responseBody':JSON[_0x3a4a6d(0xd8)]({'oldStatus':_0x87cf0c['status'],'newStatus':_0x288ce5['toUpperCase'](),'notes':_0x24c71d||null,'chargebackAmount':_0xcda450||null,'updatedBy':'admin','timestamp':new Date()['toISOString']()})}}),console['log'](_0x3a4a6d(0x16c)+_0x87cf0c['orderId']+_0x3a4a6d(0xdb)+_0x87cf0c['status']+'\x20to\x20'+_0x288ce5[_0x3a4a6d(0xaa)]()),_0x288ce5[_0x3a4a6d(0xaa)]()==='CHARGEBACK'&&console[_0x3a4a6d(0x11f)](_0x3a4a6d(0xb7)+_0xcda450+_0x3a4a6d(0x126)),{'id':_0x5d946d['id'],'shopId':_0x5d946d[_0x3a4a6d(0x12b)],'shopName':_0x5d946d[_0x3a4a6d(0x14e)][_0x3a4a6d(0x119)],'shopUsername':_0x5d946d[_0x3a4a6d(0x14e)][_0x3a4a6d(0x169)],'gateway':_0x5d946d[_0x3a4a6d(0xc2)],'orderId':_0x5d946d[_0x3a4a6d(0xf2)],'gatewayOrderId':_0x5d946d[_0x3a4a6d(0x12e)],'amount':_0x5d946d[_0x3a4a6d(0xb2)],'currency':_0x5d946d[_0x3a4a6d(0x145)],'sourceCurrency':_0x5d946d['sourceCurrency'],'status':_0x5d946d['status'],'usage':_0x5d946d[_0x3a4a6d(0x16f)],'externalPaymentUrl':_0x5d946d['externalPaymentUrl'],'gatewayPaymentId':_0x5d946d[_0x3a4a6d(0x109)],'customerEmail':_0x5d946d[_0x3a4a6d(0x102)],'customerName':_0x5d946d[_0x3a4a6d(0x13e)],'cardLast4':_0x5d946d[_0x3a4a6d(0x164)],'paymentMethod':_0x5d946d[_0x3a4a6d(0xf1)],'bankId':_0x5d946d[_0x3a4a6d(0x10f)],'remitterIban':_0x5d946d['remitterIban'],'remitterName':_0x5d946d[_0x3a4a6d(0x141)],'chargebackAmount':_0x5d946d['chargebackAmount'],'adminNotes':_0x5d946d[_0x3a4a6d(0xff)],'statusChangedBy':_0x5d946d[_0x3a4a6d(0x120)],'statusChangedAt':_0x5d946d['statusChangedAt'],'createdAt':_0x5d946d[_0x3a4a6d(0xea)],'updatedAt':_0x5d946d[_0x3a4a6d(0x125)],'expiresAt':_0x5d946d['expiresAt']};}async[a33_0x3ff3a5(0x106)](_0x52386f){const _0x303c8f=a33_0x3ff3a5,{page:_0x3a6c77,limit:_0x1e1e65,status:_0x3e70ea}=_0x52386f,_0x49d662=(_0x3a6c77-0x1)*_0x1e1e65,_0xea693b={};_0x3e70ea&&(_0xea693b['status']=_0x3e70ea[_0x303c8f(0xaa)]());console[_0x303c8f(0x11f)]('üìã\x20Getting\x20users\x20with\x20filters:',{'page':_0x3a6c77,'limit':_0x1e1e65,'status':_0x3e70ea,'where':_0xea693b});const [_0x3c9856,_0x3cc3b8]=await Promise[_0x303c8f(0xb9)]([database_1[_0x303c8f(0x14b)][_0x303c8f(0x14e)][_0x303c8f(0x162)]({'where':_0xea693b,'skip':_0x49d662,'take':_0x1e1e65,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x303c8f(0x108)}}),database_1[_0x303c8f(0x14b)][_0x303c8f(0x14e)]['count']({'where':_0xea693b})]);console[_0x303c8f(0x11f)](_0x303c8f(0x167)+_0x3c9856[_0x303c8f(0x132)]+'\x20users\x20out\x20of\x20'+_0x3cc3b8+_0x303c8f(0xe6));const _0x4d9821=_0x3c9856[_0x303c8f(0xf7)](_0x281c3c=>({'id':_0x281c3c['id'],'fullName':_0x281c3c[_0x303c8f(0x119)],'username':_0x281c3c[_0x303c8f(0x169)],'telegramId':_0x281c3c['telegram'],'merchantUrl':_0x281c3c[_0x303c8f(0x116)],'gateways':_0x281c3c[_0x303c8f(0x14a)]?JSON['parse'](_0x281c3c['paymentGateways']):null,'gatewaySettings':_0x281c3c[_0x303c8f(0x135)]?JSON['parse'](_0x281c3c[_0x303c8f(0x135)]):null,'publicKey':_0x281c3c[_0x303c8f(0xc6)],'wallets':{'usdtPolygonWallet':_0x281c3c[_0x303c8f(0x12c)],'usdtTrcWallet':_0x281c3c[_0x303c8f(0x139)],'usdtErcWallet':_0x281c3c['usdtErcWallet'],'usdcPolygonWallet':_0x281c3c['usdcPolygonWallet']},'status':_0x281c3c[_0x303c8f(0xa4)],'createdAt':_0x281c3c[_0x303c8f(0xea)]}));return{'users':_0x4d9821,'pagination':{'page':_0x3a6c77,'limit':_0x1e1e65,'total':_0x3cc3b8,'totalPages':Math['ceil'](_0x3cc3b8/_0x1e1e65)}};}async[a33_0x3ff3a5(0xc0)](_0x339e56){const _0x3f5c5e=a33_0x3ff3a5;return await this[_0x3f5c5e(0xae)]['getUserById'](_0x339e56);}async[a33_0x3ff3a5(0x107)](_0x3934d1){const _0x3da811=a33_0x3ff3a5;return await this['userService'][_0x3da811(0x107)](_0x3934d1);}async[a33_0x3ff3a5(0xaf)](_0x3d5ce0,_0x238a27){const _0x5c4212=a33_0x3ff3a5;return await this[_0x5c4212(0xae)][_0x5c4212(0xaf)](_0x3d5ce0,_0x238a27);}async['deleteUser'](_0x37c3d2){const _0x2deb2d=a33_0x3ff3a5;return await this['userService'][_0x2deb2d(0xfb)](_0x37c3d2);}async[a33_0x3ff3a5(0x155)](_0x2b723c){const _0x2912d4=a33_0x3ff3a5;console[_0x2912d4(0x11f)](_0x2912d4(0x127)+_0x2b723c);const _0x1c268a=await database_1['default'][_0x2912d4(0x14e)][_0x2912d4(0xdd)]({'where':{'id':_0x2b723c},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x1c268a)throw new Error(_0x2912d4(0xe3));if(_0x1c268a[_0x2912d4(0xa4)]===_0x2912d4(0xf0))throw new Error(_0x2912d4(0xbd));const _0xa2c050=await this['userService'][_0x2912d4(0xaf)](_0x2b723c,{'status':_0x2912d4(0xf0)});return console[_0x2912d4(0x11f)](_0x2912d4(0x10b)+_0x1c268a[_0x2912d4(0x169)]+_0x2912d4(0xdc)),_0xa2c050;}async['activateUser'](_0x3f5f10){const _0x19be41=a33_0x3ff3a5;console[_0x19be41(0x11f)](_0x19be41(0x16d)+_0x3f5f10);const _0x3ab126=await database_1['default'][_0x19be41(0x14e)]['findUnique']({'where':{'id':_0x3f5f10},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3ab126)throw new Error(_0x19be41(0xe3));if(_0x3ab126[_0x19be41(0xa4)]===_0x19be41(0xfe))throw new Error(_0x19be41(0x146));const _0x25c8b4=await this[_0x19be41(0xae)][_0x19be41(0xaf)](_0x3f5f10,{'status':'ACTIVE'});return console[_0x19be41(0x11f)](_0x19be41(0x10b)+_0x3ab126[_0x19be41(0x169)]+'\x20activated\x20successfully'),_0x25c8b4;}}exports[a33_0x3ff3a5(0xac)]=AdminService;