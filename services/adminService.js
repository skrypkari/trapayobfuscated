'use strict';const a33_0x12b9f7=a33_0x3d95;(function(_0x4e8e8d,_0x1d285e){const _0x279dc6=a33_0x3d95,_0xd2d39e=_0x4e8e8d();while(!![]){try{const _0x21031f=-parseInt(_0x279dc6(0x13f))/0x1*(-parseInt(_0x279dc6(0x157))/0x2)+-parseInt(_0x279dc6(0x18e))/0x3*(parseInt(_0x279dc6(0x12d))/0x4)+-parseInt(_0x279dc6(0x144))/0x5+parseInt(_0x279dc6(0x11f))/0x6+parseInt(_0x279dc6(0xf6))/0x7+parseInt(_0x279dc6(0x17c))/0x8*(-parseInt(_0x279dc6(0x10c))/0x9)+parseInt(_0x279dc6(0x12c))/0xa*(parseInt(_0x279dc6(0x120))/0xb);if(_0x21031f===_0x1d285e)break;else _0xd2d39e['push'](_0xd2d39e['shift']());}catch(_0x58f36d){_0xd2d39e['push'](_0xd2d39e['shift']());}}}(a33_0x37ef,0x3baf8));var __importDefault=this&&this[a33_0x12b9f7(0x132)]||function(_0x4f8cdd){const _0x3ddc16=a33_0x12b9f7;return _0x4f8cdd&&_0x4f8cdd[_0x3ddc16(0x169)]?_0x4f8cdd:{'default':_0x4f8cdd};};Object[a33_0x12b9f7(0x18d)](exports,a33_0x12b9f7(0x169),{'value':!![]}),exports[a33_0x12b9f7(0x129)]=void 0x0;function a33_0x37ef(){const _0x192d97=['currency','User\x20not\x20found','defineProperty','1458618BBcQLm','merchantPaid','✅\x20Payment\x20','completed','webhookLogs','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','❌\x20Payment\x20not\x20found:\x20','slice','getMonth','updatePaymentStatus','deleteUser','getPayoutStats','ceil','💸\x20Creating\x20payout\x20for\x20shop\x20','statusChangedAt','markPaymentsAsPaidOut','✅\x20Found\x20payout:\x20','\x20deleted\x20successfully','split','Payment\x20not\x20found','getGatewaySettings','📋\x20Getting\x20payments\x20with\x20filters:','network','getMerchantsAwaitingPayout','gte','COMPLETED','usage','date','totalAmountAfterCommissionUSDT','\x20users\x20out\x20of\x20','\x20suspended\x20successfully','status','paymentGateways','\x20days)','User\x20is\x20already\x20active','payment','EXPIRED','create','totalPayout','reduce','\x20USDT\x20(включая\x20штрафы\x20chargeback)','✅\x20Payout\x20created\x20successfully:\x20','updatedAt','getSystemStatistics','✅\x20Admin\x20statistics\x20generated\x20successfully','adminNotes','✅\x20Found\x20payment:\x20','error','gatewaySettings','set','🚫\x20Suspending\x20user:\x20','currencyService','getPayoutById','customerEmail','FAILED','💸\x20Total\x20Payout:\x20','Invalid\x20status.\x20Valid\x20statuses:\x20','amount','\x20payments\x20as\x20paid\x20out','remitterName','name','\x20total','thisMonth','\x20payments\x20out\x20of\x20','chargebackAmount','Shop\x20not\x20found','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','SUSPENDED','createPayout','sourceCurrency','payoutDelay','cardLast4','orderId','\x20USDT\x20(','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','1670165YJZegx','getPeriodDays','gatewayPaymentId','includes','insensitive','calculateAmountAfterCommission','payments','telegram','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','📊\x20Daily\x20revenue\x20entries:\x20','usdtTrcWallet','\x20USDT','push','get','updateUser','status_update','shop','\x20merchants\x20out\x20of\x20','usdtErcWallet','remitterIban','UserService','💰\x20Found\x20','682515YQnZxw','\x20activated\x20successfully','✅\x20Activating\x20user:\x20','📊\x20Calculating\x20admin\x20payout\x20statistics...','webhookLog','createUser','stringify','amountUSDT','gatewayOrderId','\x20status\x20updated\x20from\x20','generateDateRange','calculateEffectiveAmount','../types/gateway','gateway','CHARGEBACK','shopId','amountAfterCommissionUSDT','✅\x20Returning\x20','default','2617986ebJLgO','11nwGayg','availableBalance','📅\x20Processing\x20daily\x20stats\x20for\x20','paidAt','toUpperCase','suspendUser','\x20merchants\x20with\x20eligible\x20PAID\x20payments','✅\x20Payout\x20','ACTIVE','AdminService','round','\x20USDT\x20(только\x20PAID\x20платежи)','3223670NkBwhH','4hCZRFQ','📅\x20This\x20Month:\x20','bankId','entries','\x20USDT\x20via\x20','__importDefault','getAllPayments','🔍\x20Getting\x20payment\x20by\x20ID:\x20','PAID','txid','log','✅\x20User\x20','🔄\x20Updating\x20payment\x20','length','💸\x20Chargeback\x20penalty:\x20','desc','createdAt','$queryRaw','24918MqVVeB','\x20USDT\x20(penalty\x20amount)','all','💰\x20Total\x20amount:\x20','abs','2075210AZDfUf','🗑️\x20Deleting\x20payout:\x20','./telegramBotService','⏳\x20Awaiting\x20Payout:\x20','💳\x20Total\x20payments:\x20','toISOString','setDate','📊\x20Found\x20','\x20payouts\x20out\x20of\x20','isEligibleForPayout','getFullYear','Error\x20parsing\x20gateway\x20settings:','getUserById','../config/database','activateUser','userService','has','PENDING','charAt','18xQjoeM','convertToUSDT','usdcPolygonWallet','🔍\x20Getting\x20payout\x20by\x20ID:\x20','asc','totalAmountUSDT','getAllPayouts','paymentMethod','commission','❌\x20Payout\x20not\x20found:\x20','sendPayoutNotification','getDate','✅\x20Payout\x20statistics\x20calculated:','parse','🏪\x20Found\x20','\x20USDT\x20after\x20commission)','externalPaymentUrl','toFixed','__esModule','customerName','statusChangedBy','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','\x20status\x20to:\x20','\x20to\x20','findUnique','isValidGatewayId','Shop\x20is\x20not\x20active','getPaymentById','./userService','toLowerCase','map','📈\x20Average\x20payment:\x20','usdtPolygonWallet','shopUrl','count','size','update','8RbQgRr','join',',\x20amount:\x20','📋\x20Getting\x20users\x20with\x20filters:','expiresAt','deletePayout','findMany','PROCESSING','getAllUsers','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','REFUND','payout','💸\x20Chargeback\x20amount:\x20','username','telegramBotService'];a33_0x37ef=function(){return _0x192d97;};return a33_0x37ef();}const database_1=__importDefault(require(a33_0x12b9f7(0x151))),currencyService_1=require('./currencyService'),userService_1=require(a33_0x12b9f7(0x173)),telegramBotService_1=require(a33_0x12b9f7(0x146)),gateway_1=require(a33_0x12b9f7(0x118));function a33_0x3d95(_0x518c37,_0x267f57){const _0x37ef5f=a33_0x37ef();return a33_0x3d95=function(_0x3d95d8,_0x3e59d7){_0x3d95d8=_0x3d95d8-0xb7;let _0x36380e=_0x37ef5f[_0x3d95d8];return _0x36380e;},a33_0x3d95(_0x518c37,_0x267f57);}class AdminService{constructor(){const _0x28b531=a33_0x12b9f7;this[_0x28b531(0x153)]=new userService_1[(_0x28b531(0x10a))]();}[a33_0x12b9f7(0xf7)](_0x4b65f9){switch(_0x4b65f9){case'7d':return 0x7;case'30d':return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x12b9f7(0x116)](_0x4491ac,_0x299234){const _0x3f5552=a33_0x12b9f7,_0x3d9d30=[],_0x48ca45=new Date(_0x4491ac);while(_0x48ca45<=_0x299234){_0x3d9d30[_0x3f5552(0x102)](_0x48ca45['toISOString']()[_0x3f5552(0xbc)]('T')[0x0]),_0x48ca45['setDate'](_0x48ca45[_0x3f5552(0x162)]()+0x1);}return _0x3d9d30;}[a33_0x12b9f7(0xbe)](_0x728314,_0x1055e1){const _0x2eb38f=a33_0x12b9f7;if(!_0x728314[_0x2eb38f(0xda)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x3b1163=JSON[_0x2eb38f(0x164)](_0x728314[_0x2eb38f(0xda)]),_0x448680=_0x1055e1[_0x2eb38f(0x156)](0x0)[_0x2eb38f(0x124)]()+_0x1055e1[_0x2eb38f(0x195)](0x1)[_0x2eb38f(0x174)]();if(_0x3b1163&&_0x3b1163[_0x448680])return{'commission':_0x3b1163[_0x448680][_0x2eb38f(0x15f)]||0x0,'payoutDelay':_0x3b1163[_0x448680][_0x2eb38f(0xf1)]||0x0};}catch(_0x5dd171){console[_0x2eb38f(0xd9)](_0x2eb38f(0x14f),_0x5dd171);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x12b9f7(0x14d)](_0x294aed){const _0x3050b0=a33_0x12b9f7;if(_0x294aed[_0x3050b0(0xc9)]!==_0x3050b0(0x135)||_0x294aed[_0x3050b0(0x18f)]||!_0x294aed[_0x3050b0(0x123)])return![];const _0x3065ad=this[_0x3050b0(0xbe)](_0x294aed[_0x3050b0(0x106)],_0x294aed[_0x3050b0(0x119)]),_0xa7ce99=_0x3065ad[_0x3050b0(0xf1)]*0x18*0x3c*0x3c*0x3e8,_0x5c3d64=new Date(_0x294aed['paidAt']['getTime']()+_0xa7ce99);return new Date()>_0x5c3d64;}[a33_0x12b9f7(0xfb)](_0x33f2ef,_0x5de98b){return _0x33f2ef*(0x1-_0x5de98b/0x64);}[a33_0x12b9f7(0x117)](_0x59468c){const _0x566022=a33_0x12b9f7;switch(_0x59468c[_0x566022(0xc9)]){case _0x566022(0x135):return _0x59468c[_0x566022(0xe3)];case _0x566022(0x11a):return-(_0x59468c[_0x566022(0xea)]||0x0);case'REFUND':return 0x0;default:return 0x0;}}async[a33_0x12b9f7(0xef)](_0x417a6e){const _0x5ad514=a33_0x12b9f7,{shopId:_0x3f1e7c,amount:_0x277d56,network:_0x45a6cc,notes:_0x1eb206}=_0x417a6e;console[_0x5ad514(0x137)](_0x5ad514(0xb7)+_0x3f1e7c+':\x20'+_0x277d56+_0x5ad514(0x131)+_0x45a6cc);const _0x28608b=await database_1[_0x5ad514(0x11e)][_0x5ad514(0x106)][_0x5ad514(0x16f)]({'where':{'id':_0x3f1e7c},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x28608b)throw new Error(_0x5ad514(0xeb));if(_0x28608b['status']!==_0x5ad514(0x128))throw new Error(_0x5ad514(0x171));const _0x10257f=await database_1[_0x5ad514(0x11e)][_0x5ad514(0x187)]['create']({'data':{'shopId':_0x3f1e7c,'amount':_0x277d56,'network':_0x45a6cc,'status':_0x5ad514(0xc3),'notes':_0x1eb206||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x5ad514(0xb9)](_0x3f1e7c,_0x277d56);try{await telegramBotService_1[_0x5ad514(0x18a)][_0x5ad514(0x161)](_0x3f1e7c,_0x10257f,_0x5ad514(0x191));}catch(_0x4ee6be){console[_0x5ad514(0xd9)](_0x5ad514(0xfe),_0x4ee6be);}return console[_0x5ad514(0x137)](_0x5ad514(0xd3)+_0x10257f['id']),{'id':_0x10257f['id'],'shopId':_0x10257f[_0x5ad514(0x11b)],'shopName':_0x10257f['shop'][_0x5ad514(0xe6)],'shopUsername':_0x10257f[_0x5ad514(0x106)][_0x5ad514(0x189)],'amount':_0x10257f[_0x5ad514(0xe3)],'network':_0x10257f[_0x5ad514(0xc0)],'status':_0x10257f[_0x5ad514(0xc9)],'txid':_0x10257f[_0x5ad514(0x136)],'notes':_0x10257f['notes'],'createdAt':_0x10257f['createdAt'],'paidAt':_0x10257f[_0x5ad514(0x123)]};}async[a33_0x12b9f7(0xb9)](_0xe760cf,_0x5ad2f1){const _0x57cf6f=a33_0x12b9f7;console[_0x57cf6f(0x137)](_0x57cf6f(0x185)+_0xe760cf+_0x57cf6f(0x17e)+_0x5ad2f1+_0x57cf6f(0x101));const _0x27a2fa=await database_1['default'][_0x57cf6f(0xcd)][_0x57cf6f(0x182)]({'where':{'shopId':_0xe760cf,'status':_0x57cf6f(0x135),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x57cf6f(0x15b)}});let _0x217909=_0x5ad2f1;const _0x22542c=[];for(const _0x5238ea of _0x27a2fa){const _0x5f5d31={..._0x5238ea,'status':_0x57cf6f(0x135),'merchantPaid':![],'shop':{'gatewaySettings':_0x5238ea[_0x57cf6f(0x106)][_0x57cf6f(0xda)]}};if(!this[_0x57cf6f(0x14d)](_0x5f5d31))continue;const _0x30f40e=await currencyService_1['currencyService'][_0x57cf6f(0x158)](_0x5238ea[_0x57cf6f(0xe3)],_0x5238ea[_0x57cf6f(0x18b)]),_0x5b7233=this[_0x57cf6f(0xbe)](_0x5238ea[_0x57cf6f(0x106)],_0x5238ea[_0x57cf6f(0x119)]),_0x1ab8a1=this[_0x57cf6f(0xfb)](_0x30f40e,_0x5b7233[_0x57cf6f(0x15f)]);if(_0x1ab8a1<=_0x217909){_0x22542c[_0x57cf6f(0x102)](_0x5238ea['id']),_0x217909-=_0x1ab8a1;if(_0x217909<=0.01)break;}}_0x22542c['length']>0x0&&(await database_1[_0x57cf6f(0x11e)][_0x57cf6f(0xcd)]['updateMany']({'where':{'id':{'in':_0x22542c}},'data':{'merchantPaid':!![]}}),console[_0x57cf6f(0x137)]('✅\x20Marked\x20'+_0x22542c[_0x57cf6f(0x13a)]+_0x57cf6f(0xe4)));}async[a33_0x12b9f7(0x15d)](_0x37de81){const _0x2364a9=a33_0x12b9f7,{page:_0x198b08,limit:_0x569393,shopId:_0x16ad00,network:_0x325277,dateFrom:_0xcb6e5e,dateTo:_0x43dd84,search:_0x980967}=_0x37de81,_0x487ae8=(_0x198b08-0x1)*_0x569393;console[_0x2364a9(0x137)]('📋\x20Getting\x20payouts\x20with\x20filters:',_0x37de81);const _0x4ccc03={};_0x16ad00&&(_0x4ccc03[_0x2364a9(0x11b)]=_0x16ad00);_0x325277&&(_0x4ccc03[_0x2364a9(0xc0)]=_0x325277);(_0xcb6e5e||_0x43dd84)&&(_0x4ccc03[_0x2364a9(0x13d)]={},_0xcb6e5e&&(_0x4ccc03['createdAt'][_0x2364a9(0xc2)]=new Date(_0xcb6e5e)),_0x43dd84&&(_0x4ccc03[_0x2364a9(0x13d)]['lte']=new Date(_0x43dd84)));_0x980967&&(_0x4ccc03['OR']=[{'txid':{'contains':_0x980967,'mode':_0x2364a9(0xfa)}},{'notes':{'contains':_0x980967,'mode':_0x2364a9(0xfa)}},{'shop':{'name':{'contains':_0x980967,'mode':_0x2364a9(0xfa)}}},{'shop':{'username':{'contains':_0x980967,'mode':'insensitive'}}}]);const [_0x30aa7f,_0x43964c]=await Promise['all']([database_1[_0x2364a9(0x11e)][_0x2364a9(0x187)][_0x2364a9(0x182)]({'where':_0x4ccc03,'skip':_0x487ae8,'take':_0x569393,'orderBy':{'createdAt':_0x2364a9(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2364a9(0x11e)][_0x2364a9(0x187)]['count']({'where':_0x4ccc03})]);console[_0x2364a9(0x137)](_0x2364a9(0x14b)+_0x30aa7f[_0x2364a9(0x13a)]+_0x2364a9(0x14c)+_0x43964c+'\x20total');const _0x283451=_0x30aa7f[_0x2364a9(0x175)](_0x2f6688=>({'id':_0x2f6688['id'],'shopId':_0x2f6688[_0x2364a9(0x11b)],'shopName':_0x2f6688['shop']['name'],'shopUsername':_0x2f6688[_0x2364a9(0x106)][_0x2364a9(0x189)],'amount':_0x2f6688['amount'],'network':_0x2f6688['network'],'status':_0x2f6688[_0x2364a9(0xc9)],'txid':_0x2f6688[_0x2364a9(0x136)],'notes':_0x2f6688['notes'],'createdAt':_0x2f6688[_0x2364a9(0x13d)],'paidAt':_0x2f6688[_0x2364a9(0x123)]}));return{'payouts':_0x283451,'pagination':{'page':_0x198b08,'limit':_0x569393,'total':_0x43964c,'totalPages':Math['ceil'](_0x43964c/_0x569393)}};}async[a33_0x12b9f7(0xde)](_0x450bc0){const _0x4ad627=a33_0x12b9f7;console['log'](_0x4ad627(0x15a)+_0x450bc0);const _0x32401e=await database_1['default']['payout'][_0x4ad627(0x16f)]({'where':{'id':_0x450bc0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x32401e)return console[_0x4ad627(0x137)](_0x4ad627(0x160)+_0x450bc0),null;return console[_0x4ad627(0x137)](_0x4ad627(0xba)+_0x32401e[_0x4ad627(0xe3)]+_0x4ad627(0x131)+_0x32401e['network']),{'id':_0x32401e['id'],'shopId':_0x32401e['shopId'],'shopName':_0x32401e[_0x4ad627(0x106)][_0x4ad627(0xe6)],'shopUsername':_0x32401e[_0x4ad627(0x106)][_0x4ad627(0x189)],'amount':_0x32401e['amount'],'network':_0x32401e[_0x4ad627(0xc0)],'status':_0x32401e['status'],'txid':_0x32401e[_0x4ad627(0x136)],'notes':_0x32401e['notes'],'createdAt':_0x32401e[_0x4ad627(0x13d)],'paidAt':_0x32401e[_0x4ad627(0x123)]};}async[a33_0x12b9f7(0x181)](_0x19d751){const _0x1c7de9=a33_0x12b9f7;console[_0x1c7de9(0x137)](_0x1c7de9(0x145)+_0x19d751);const _0x52de20=await database_1[_0x1c7de9(0x11e)][_0x1c7de9(0x187)][_0x1c7de9(0x16f)]({'where':{'id':_0x19d751},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x52de20)throw new Error('Payout\x20not\x20found');await database_1[_0x1c7de9(0x11e)]['payout']['delete']({'where':{'id':_0x19d751}}),console['log'](_0x1c7de9(0x127)+_0x19d751+_0x1c7de9(0xbb));}async[a33_0x12b9f7(0xc1)](_0x186ff7){const _0x232b35=a33_0x12b9f7,{page:_0x4e3b9f,limit:_0x3b0b9c,minAmount:_0x1566e3,search:_0x19c7b6}=_0x186ff7;console[_0x232b35(0x137)](_0x232b35(0xf5),_0x186ff7);const _0x554129=await database_1[_0x232b35(0x11e)][_0x232b35(0xcd)][_0x232b35(0x182)]({'where':{'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x232b35(0x137)](_0x232b35(0x10b)+_0x554129[_0x232b35(0x13a)]+_0x232b35(0x16c));const _0x3e081a=new Map();for(const _0x1a3562 of _0x554129){const _0x43ac8c={..._0x1a3562,'status':_0x232b35(0x135),'merchantPaid':![],'shop':{'gatewaySettings':_0x1a3562['shop'][_0x232b35(0xda)]}},_0x565b14=this[_0x232b35(0x14d)](_0x43ac8c);if(!_0x565b14)continue;const _0x41f152=await currencyService_1[_0x232b35(0xdd)]['convertToUSDT'](_0x1a3562['amount'],_0x1a3562[_0x232b35(0x18b)]),_0x424cd5=this['getGatewaySettings'](_0x1a3562['shop'],_0x1a3562[_0x232b35(0x119)]),_0x133500=this['calculateAmountAfterCommission'](_0x41f152,_0x424cd5['commission']),_0x4a152b=_0x1a3562[_0x232b35(0x11b)];!_0x3e081a['has'](_0x4a152b)&&_0x3e081a[_0x232b35(0xdb)](_0x4a152b,{'shop':_0x1a3562[_0x232b35(0x106)],'payments':[]}),_0x3e081a[_0x232b35(0x103)](_0x4a152b)[_0x232b35(0xfc)][_0x232b35(0x102)]({'id':_0x1a3562['id'],'amount':_0x1a3562[_0x232b35(0xe3)],'currency':_0x1a3562[_0x232b35(0x18b)],'gateway':_0x1a3562['gateway'],'paidAt':_0x1a3562[_0x232b35(0x123)],'createdAt':_0x1a3562[_0x232b35(0x13d)],'amountUSDT':_0x41f152,'commission':_0x424cd5[_0x232b35(0x15f)],'amountAfterCommissionUSDT':_0x133500,'isEligible':!![]});}console[_0x232b35(0x137)](_0x232b35(0x165)+_0x3e081a[_0x232b35(0x17a)]+_0x232b35(0x126));const _0x51b944=[];for(const [_0x5026a3,_0x55e0e0]of _0x3e081a){const {shop:_0x629dcf,payments:_0x46d5b7}=_0x55e0e0,_0x1a66cc=_0x46d5b7['reduce']((_0x186230,_0x3479e2)=>_0x186230+_0x3479e2[_0x232b35(0x113)],0x0),_0x3ae3b2=_0x46d5b7[_0x232b35(0xd1)]((_0x408de5,_0x31644f)=>_0x408de5+_0x31644f[_0x232b35(0x11c)],0x0);if(_0x1566e3&&_0x3ae3b2<_0x1566e3)continue;if(_0x19c7b6){const _0x425870=_0x19c7b6[_0x232b35(0x174)](),_0x2551f0=_0x629dcf[_0x232b35(0xe6)]['toLowerCase']()[_0x232b35(0xf9)](_0x425870)||_0x629dcf['username'][_0x232b35(0x174)]()[_0x232b35(0xf9)](_0x425870)||_0x629dcf['telegram']&&_0x629dcf[_0x232b35(0xfd)]['toLowerCase']()[_0x232b35(0xf9)](_0x425870);if(!_0x2551f0)continue;}const _0x42145a=new Map();for(const _0x4a99c4 of _0x46d5b7){const _0x523def=_0x4a99c4['gateway'];!_0x42145a[_0x232b35(0x154)](_0x523def)&&_0x42145a[_0x232b35(0xdb)](_0x523def,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x4a99c4[_0x232b35(0x15f)]});const _0x36f80c=_0x42145a[_0x232b35(0x103)](_0x523def);_0x36f80c[_0x232b35(0x179)]++,_0x36f80c['amountUSDT']+=_0x4a99c4['amountUSDT'],_0x36f80c[_0x232b35(0x11c)]+=_0x4a99c4['amountAfterCommissionUSDT'];}const _0x5c4995=Array['from'](_0x42145a[_0x232b35(0x130)]())[_0x232b35(0x175)](([_0x2af7c4,_0x397d6a])=>({'gateway':_0x2af7c4[_0x232b35(0x156)](0x0)[_0x232b35(0x124)]()+_0x2af7c4[_0x232b35(0x195)](0x1),'count':_0x397d6a[_0x232b35(0x179)],'amountUSDT':Math['round'](_0x397d6a[_0x232b35(0x113)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x232b35(0x12a)](_0x397d6a['amountAfterCommissionUSDT']*0x64)/0x64,'commission':_0x397d6a['commission']})),_0xe1efc8=_0x46d5b7['reduce']((_0x8fb42b,_0x505583)=>{const _0x44b645=_0x232b35;return _0x505583[_0x44b645(0x123)]<_0x8fb42b?_0x505583[_0x44b645(0x123)]:_0x8fb42b;},_0x46d5b7[0x0][_0x232b35(0x123)]);_0x51b944[_0x232b35(0x102)]({'id':_0x629dcf['id'],'fullName':_0x629dcf[_0x232b35(0xe6)],'username':_0x629dcf[_0x232b35(0x189)],'telegramId':_0x629dcf[_0x232b35(0xfd)],'merchantUrl':_0x629dcf['shopUrl'],'wallets':{'usdtPolygonWallet':_0x629dcf[_0x232b35(0x177)],'usdtTrcWallet':_0x629dcf[_0x232b35(0x100)],'usdtErcWallet':_0x629dcf['usdtErcWallet'],'usdcPolygonWallet':_0x629dcf[_0x232b35(0x159)]},'totalAmountUSDT':Math[_0x232b35(0x12a)](_0x1a66cc*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x232b35(0x12a)](_0x3ae3b2*0x64)/0x64,'paymentsCount':_0x46d5b7['length'],'oldestPaymentDate':_0xe1efc8,'gatewayBreakdown':_0x5c4995});}_0x51b944['sort']((_0x544fb4,_0x22ef5c)=>_0x22ef5c[_0x232b35(0xc6)]-_0x544fb4[_0x232b35(0xc6)]);const _0x2f6289=_0x51b944['length'],_0x4f56bf=_0x51b944[_0x232b35(0xd1)]((_0x562133,_0x52b5d7)=>_0x562133+_0x52b5d7[_0x232b35(0x15c)],0x0),_0x5126a5=_0x51b944[_0x232b35(0xd1)]((_0x5d5afc,_0x5f53dc)=>_0x5d5afc+_0x5f53dc[_0x232b35(0xc6)],0x0),_0x57abe4=(_0x4e3b9f-0x1)*_0x3b0b9c,_0x2f573c=_0x51b944[_0x232b35(0x195)](_0x57abe4,_0x57abe4+_0x3b0b9c);return console[_0x232b35(0x137)](_0x232b35(0x11d)+_0x2f573c['length']+_0x232b35(0x107)+_0x2f6289+'\x20total'),console['log'](_0x232b35(0x142)+_0x4f56bf[_0x232b35(0x168)](0x2)+_0x232b35(0xf4)+_0x5126a5['toFixed'](0x2)+_0x232b35(0x166)),{'merchants':_0x2f573c,'pagination':{'page':_0x4e3b9f,'limit':_0x3b0b9c,'total':_0x2f6289,'totalPages':Math[_0x232b35(0x19a)](_0x2f6289/_0x3b0b9c)},'summary':{'totalMerchants':_0x2f6289,'totalAmountUSDT':Math[_0x232b35(0x12a)](_0x4f56bf*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x232b35(0x12a)](_0x5126a5*0x64)/0x64}};}async[a33_0x12b9f7(0x199)](){const _0x2c423f=a33_0x12b9f7;console[_0x2c423f(0x137)](_0x2c423f(0x10f));const _0x33421d=await database_1[_0x2c423f(0x11e)][_0x2c423f(0xcd)][_0x2c423f(0x182)]({'where':{'status':{'in':[_0x2c423f(0x135),_0x2c423f(0x186),'CHARGEBACK']}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log'](_0x2c423f(0x10b)+_0x33421d[_0x2c423f(0x13a)]+_0x2c423f(0x193));const _0x4185f0=new Date(),_0x1370b8=new Date(_0x4185f0[_0x2c423f(0x14e)](),_0x4185f0[_0x2c423f(0x196)](),0x1),_0x24ab4b=new Date(_0x4185f0['getFullYear'](),_0x4185f0[_0x2c423f(0x196)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x2b8f79=0x0,_0x525d1e=0x0,_0x45338c=0x0,_0x4f51de=0x0;for(const _0x8d5f17 of _0x33421d){const _0x331fe5=this[_0x2c423f(0x117)](_0x8d5f17);if(_0x331fe5===0x0)continue;let _0x50a025,_0x482184;if(_0x8d5f17['status']==='CHARGEBACK')_0x50a025=Math[_0x2c423f(0x143)](_0x331fe5),_0x482184=-_0x50a025;else{_0x50a025=await currencyService_1[_0x2c423f(0xdd)][_0x2c423f(0x158)](_0x8d5f17[_0x2c423f(0xe3)],_0x8d5f17['currency']);const _0x14fdd3=this['getGatewaySettings'](_0x8d5f17[_0x2c423f(0x106)],_0x8d5f17[_0x2c423f(0x119)]);_0x482184=this['calculateAmountAfterCommission'](_0x50a025,_0x14fdd3[_0x2c423f(0x15f)]);}_0x8d5f17[_0x2c423f(0x18f)]&&(_0x2b8f79+=_0x482184,_0x8d5f17['paidAt']&&_0x8d5f17[_0x2c423f(0x123)]>=_0x1370b8&&_0x8d5f17[_0x2c423f(0x123)]<=_0x24ab4b&&(_0x45338c+=_0x482184)),_0x8d5f17[_0x2c423f(0xc9)]===_0x2c423f(0x135)&&this[_0x2c423f(0x14d)](_0x8d5f17)&&(_0x525d1e+=_0x482184,_0x4f51de+=_0x50a025);}const _0x1078ac={'totalPayout':Math['round'](_0x2b8f79*0x64)/0x64,'awaitingPayout':Math[_0x2c423f(0x12a)](_0x525d1e*0x64)/0x64,'thisMonth':Math['round'](_0x45338c*0x64)/0x64,'availableBalance':Math[_0x2c423f(0x12a)](_0x4f51de*0x64)/0x64};return console[_0x2c423f(0x137)](_0x2c423f(0x163)),console['log'](_0x2c423f(0xe1)+_0x1078ac[_0x2c423f(0xd0)]+'\x20USDT\x20(включая\x20штрафы\x20chargeback)'),console[_0x2c423f(0x137)](_0x2c423f(0x147)+_0x1078ac['awaitingPayout']+_0x2c423f(0x12b)),console[_0x2c423f(0x137)](_0x2c423f(0x12e)+_0x1078ac[_0x2c423f(0xe8)]+_0x2c423f(0x101)),console[_0x2c423f(0x137)]('💰\x20Available\x20Balance:\x20'+_0x1078ac[_0x2c423f(0x121)]+'\x20USDT'),_0x1078ac;}async[a33_0x12b9f7(0xd5)](_0x3ea566){const _0x47f461=a33_0x12b9f7,_0x12ce1a=this['getPeriodDays'](_0x3ea566),_0x3c0e30=new Date();_0x3c0e30[_0x47f461(0x14a)](_0x3c0e30[_0x47f461(0x162)]()-_0x12ce1a),console['log'](_0x47f461(0xec)+_0x3ea566+'\x20('+_0x12ce1a+_0x47f461(0xcb));const _0x59c0ff=await database_1['default']['shop'][_0x47f461(0x179)]({'where':{'status':'ACTIVE'}}),_0x2a8398=await database_1[_0x47f461(0x11e)][_0x47f461(0xcd)][_0x47f461(0x179)](),_0x40b138=await database_1[_0x47f461(0x11e)][_0x47f461(0xcd)][_0x47f461(0x182)]({'where':{'status':{'in':[_0x47f461(0x135),'REFUND',_0x47f461(0x11a)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console['log'](_0x47f461(0x10b)+_0x40b138[_0x47f461(0x13a)]+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x4ee43a=await Promise[_0x47f461(0x141)](_0x40b138['map'](async _0x5f1963=>{const _0x3f322a=_0x47f461,_0x313479=this[_0x3f322a(0x117)](_0x5f1963);if(_0x313479===0x0)return{'amount':0x0,'createdAt':_0x5f1963[_0x3f322a(0x13d)]};let _0x58e8e9;return _0x5f1963[_0x3f322a(0xc9)]===_0x3f322a(0x11a)?_0x58e8e9=-Math['abs'](_0x313479):_0x58e8e9=await currencyService_1[_0x3f322a(0xdd)][_0x3f322a(0x158)](_0x5f1963[_0x3f322a(0xe3)],_0x5f1963['currency']),{'amount':_0x58e8e9,'createdAt':_0x5f1963['createdAt']};})),_0x28b2ae=_0x4ee43a[_0x47f461(0xd1)]((_0x2e06f9,_0x2945a1)=>_0x2e06f9+_0x2945a1[_0x47f461(0xe3)],0x0),_0x351c1f=_0x2a8398>0x0?_0x28b2ae/_0x2a8398:0x0;console[_0x47f461(0x137)]('💵\x20Total\x20revenue:\x20'+_0x28b2ae['toFixed'](0x2)+_0x47f461(0xd2)),console[_0x47f461(0x137)](_0x47f461(0x176)+_0x351c1f[_0x47f461(0x168)](0x2)+_0x47f461(0x101));const _0x5602f1=await database_1[_0x47f461(0x11e)][_0x47f461(0x13e)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x3c0e30}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x47f461(0x137)](_0x47f461(0x122)+_0x5602f1[_0x47f461(0x13a)]+'\x20days');const _0x1d649f=await Promise[_0x47f461(0x141)](_0x5602f1[_0x47f461(0x175)](async _0x4103a4=>{const _0x1fd809=_0x47f461,_0x198010=await Promise[_0x1fd809(0x141)](_0x4103a4[_0x1fd809(0xfc)][_0x1fd809(0x175)](async _0x46ed72=>{const _0x5991be=_0x1fd809,_0x5a430c=this[_0x5991be(0x117)](_0x46ed72);if(_0x5a430c===0x0)return 0x0;return _0x46ed72[_0x5991be(0xc9)]===_0x5991be(0x11a)?-Math[_0x5991be(0x143)](_0x5a430c):await currencyService_1['currencyService'][_0x5991be(0x158)](_0x46ed72[_0x5991be(0xe3)],_0x46ed72['currency']);})),_0xc721f0=_0x198010[_0x1fd809(0xd1)]((_0x113be7,_0x31c9d5)=>_0x113be7+_0x31c9d5,0x0);return{'date':_0x4103a4[_0x1fd809(0xc5)][_0x1fd809(0x149)]()[_0x1fd809(0xbc)]('T')[0x0],'amount':_0xc721f0};})),_0x51b132=this[_0x47f461(0x116)](_0x3c0e30,new Date()),_0xb7831b=new Map(_0x1d649f['map'](_0x5d4655=>[_0x5d4655[_0x47f461(0xc5)],_0x5d4655[_0x47f461(0xe3)]])),_0x4dfcc8=_0x51b132[_0x47f461(0x175)](_0x15cedc=>({'date':_0x15cedc,'amount':_0xb7831b['get'](_0x15cedc)||0x0}));return console[_0x47f461(0x137)](_0x47f461(0xd6)),console[_0x47f461(0x137)]('👥\x20Total\x20users:\x20'+_0x59c0ff),console[_0x47f461(0x137)](_0x47f461(0x148)+_0x2a8398),console['log'](_0x47f461(0xff)+_0x4dfcc8[_0x47f461(0x13a)]),{'totalRevenue':Math[_0x47f461(0x12a)](_0x28b2ae*0x64)/0x64,'totalUsers':_0x59c0ff,'totalPayments':_0x2a8398,'averagePayment':Math[_0x47f461(0x12a)](_0x351c1f*0x64)/0x64,'dailyRevenue':_0x4dfcc8};}async[a33_0x12b9f7(0x133)](_0x3d24f7){const _0x2287c0=a33_0x12b9f7,{page:_0x17a0a3,limit:_0x740077,status:_0x3be799,gateway:_0x5a86ef,shopId:_0x1c2a68,dateFrom:_0x258446,dateTo:_0x30dd68,search:_0x3077ac}=_0x3d24f7,_0x59e2ae=(_0x17a0a3-0x1)*_0x740077;console[_0x2287c0(0x137)](_0x2287c0(0xbf),_0x3d24f7);const _0x5895e4={};_0x3be799&&(_0x5895e4['status']=_0x3be799['toUpperCase']());if(_0x5a86ef){if((0x0,gateway_1[_0x2287c0(0x170)])(_0x5a86ef)){const _0x315a39=(0x0,gateway_1['getGatewayNameById'])(_0x5a86ef);_0x315a39&&(_0x5895e4['gateway']=_0x315a39);}else _0x5895e4['gateway']=_0x5a86ef[_0x2287c0(0x174)]();}_0x1c2a68&&(_0x5895e4['shopId']=_0x1c2a68);(_0x258446||_0x30dd68)&&(_0x5895e4['createdAt']={},_0x258446&&(_0x5895e4['createdAt'][_0x2287c0(0xc2)]=new Date(_0x258446)),_0x30dd68&&(_0x5895e4['createdAt']['lte']=new Date(_0x30dd68)));_0x3077ac&&(_0x5895e4['OR']=[{'orderId':{'contains':_0x3077ac,'mode':_0x2287c0(0xfa)}},{'gatewayOrderId':{'contains':_0x3077ac,'mode':_0x2287c0(0xfa)}},{'gatewayPaymentId':{'contains':_0x3077ac,'mode':_0x2287c0(0xfa)}},{'customerEmail':{'contains':_0x3077ac,'mode':_0x2287c0(0xfa)}},{'customerName':{'contains':_0x3077ac,'mode':_0x2287c0(0xfa)}},{'shop':{'name':{'contains':_0x3077ac,'mode':_0x2287c0(0xfa)}}},{'shop':{'username':{'contains':_0x3077ac,'mode':_0x2287c0(0xfa)}}}]);const [_0x36a971,_0x2df3f9]=await Promise[_0x2287c0(0x141)]([database_1[_0x2287c0(0x11e)][_0x2287c0(0xcd)][_0x2287c0(0x182)]({'where':_0x5895e4,'skip':_0x59e2ae,'take':_0x740077,'orderBy':{'createdAt':_0x2287c0(0x13c)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2287c0(0x11e)][_0x2287c0(0xcd)]['count']({'where':_0x5895e4})]);console[_0x2287c0(0x137)]('📊\x20Found\x20'+_0x36a971[_0x2287c0(0x13a)]+_0x2287c0(0xe9)+_0x2df3f9+_0x2287c0(0xe7));const _0xacf9b0=_0x36a971['map'](_0x1a4fe3=>({'id':_0x1a4fe3['id'],'shopId':_0x1a4fe3[_0x2287c0(0x11b)],'shopName':_0x1a4fe3[_0x2287c0(0x106)]['name'],'shopUsername':_0x1a4fe3[_0x2287c0(0x106)][_0x2287c0(0x189)],'gateway':_0x1a4fe3[_0x2287c0(0x119)],'orderId':_0x1a4fe3[_0x2287c0(0xf3)],'gatewayOrderId':_0x1a4fe3[_0x2287c0(0x114)],'amount':_0x1a4fe3[_0x2287c0(0xe3)],'currency':_0x1a4fe3[_0x2287c0(0x18b)],'sourceCurrency':_0x1a4fe3[_0x2287c0(0xf0)],'status':_0x1a4fe3[_0x2287c0(0xc9)],'usage':_0x1a4fe3[_0x2287c0(0xc4)],'externalPaymentUrl':_0x1a4fe3['externalPaymentUrl'],'gatewayPaymentId':_0x1a4fe3['gatewayPaymentId'],'customerEmail':_0x1a4fe3['customerEmail'],'customerName':_0x1a4fe3[_0x2287c0(0x16a)],'cardLast4':_0x1a4fe3['cardLast4'],'paymentMethod':_0x1a4fe3['paymentMethod'],'bankId':_0x1a4fe3['bankId'],'remitterIban':_0x1a4fe3['remitterIban'],'remitterName':_0x1a4fe3['remitterName'],'chargebackAmount':_0x1a4fe3['chargebackAmount'],'adminNotes':_0x1a4fe3[_0x2287c0(0xd7)],'statusChangedBy':_0x1a4fe3[_0x2287c0(0x16b)],'statusChangedAt':_0x1a4fe3[_0x2287c0(0xb8)],'createdAt':_0x1a4fe3[_0x2287c0(0x13d)],'updatedAt':_0x1a4fe3['updatedAt'],'expiresAt':_0x1a4fe3[_0x2287c0(0x180)]}));return{'payments':_0xacf9b0,'pagination':{'page':_0x17a0a3,'limit':_0x740077,'total':_0x2df3f9,'totalPages':Math[_0x2287c0(0x19a)](_0x2df3f9/_0x740077)}};}async[a33_0x12b9f7(0x172)](_0x24871a){const _0x1a2aa3=a33_0x12b9f7;console[_0x1a2aa3(0x137)](_0x1a2aa3(0x134)+_0x24871a);const _0x562788=await database_1[_0x1a2aa3(0x11e)][_0x1a2aa3(0xcd)][_0x1a2aa3(0x16f)]({'where':{'id':_0x24871a},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x1a2aa3(0x13c)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x562788)return console[_0x1a2aa3(0x137)](_0x1a2aa3(0x194)+_0x24871a),null;return console[_0x1a2aa3(0x137)](_0x1a2aa3(0xd8)+_0x562788[_0x1a2aa3(0xf3)]+'\x20('+_0x562788[_0x1a2aa3(0xc9)]+')'),{'id':_0x562788['id'],'shopId':_0x562788[_0x1a2aa3(0x11b)],'shopName':_0x562788[_0x1a2aa3(0x106)]['name'],'shopUsername':_0x562788[_0x1a2aa3(0x106)][_0x1a2aa3(0x189)],'gateway':_0x562788[_0x1a2aa3(0x119)],'orderId':_0x562788[_0x1a2aa3(0xf3)],'gatewayOrderId':_0x562788[_0x1a2aa3(0x114)],'amount':_0x562788[_0x1a2aa3(0xe3)],'currency':_0x562788[_0x1a2aa3(0x18b)],'sourceCurrency':_0x562788[_0x1a2aa3(0xf0)],'status':_0x562788[_0x1a2aa3(0xc9)],'usage':_0x562788[_0x1a2aa3(0xc4)],'externalPaymentUrl':_0x562788[_0x1a2aa3(0x167)],'gatewayPaymentId':_0x562788[_0x1a2aa3(0xf8)],'customerEmail':_0x562788[_0x1a2aa3(0xdf)],'customerName':_0x562788[_0x1a2aa3(0x16a)],'cardLast4':_0x562788[_0x1a2aa3(0xf2)],'paymentMethod':_0x562788[_0x1a2aa3(0x15e)],'bankId':_0x562788['bankId'],'remitterIban':_0x562788['remitterIban'],'remitterName':_0x562788[_0x1a2aa3(0xe5)],'chargebackAmount':_0x562788['chargebackAmount'],'adminNotes':_0x562788[_0x1a2aa3(0xd7)],'statusChangedBy':_0x562788[_0x1a2aa3(0x16b)],'statusChangedAt':_0x562788['statusChangedAt'],'createdAt':_0x562788['createdAt'],'updatedAt':_0x562788[_0x1a2aa3(0xd4)],'expiresAt':_0x562788[_0x1a2aa3(0x180)],'webhookLogs':_0x562788[_0x1a2aa3(0x192)]};}async[a33_0x12b9f7(0x197)](_0x13332a,_0x462412,_0x376f7b,_0x2cede9){const _0x15705c=a33_0x12b9f7;console['log'](_0x15705c(0x139)+_0x13332a+_0x15705c(0x16d)+_0x462412);const _0x5998c7=[_0x15705c(0x155),_0x15705c(0x183),'PAID',_0x15705c(0xce),_0x15705c(0xe0),'REFUND',_0x15705c(0x11a)];if(!_0x5998c7[_0x15705c(0xf9)](_0x462412['toUpperCase']()))throw new Error(_0x15705c(0xe2)+_0x5998c7[_0x15705c(0x17d)](',\x20'));const _0x3ad167=await database_1['default'][_0x15705c(0xcd)][_0x15705c(0x16f)]({'where':{'id':_0x13332a},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x3ad167)throw new Error(_0x15705c(0xbd));if(_0x462412[_0x15705c(0x124)]()===_0x15705c(0x11a)){if(!_0x2cede9||_0x2cede9<=0x0)throw new Error(_0x15705c(0xed));console[_0x15705c(0x137)](_0x15705c(0x188)+_0x2cede9+_0x15705c(0x140));}const _0x2ae613={'status':_0x462412['toUpperCase'](),'updatedAt':new Date()};_0x376f7b&&(_0x2ae613[_0x15705c(0xd7)]=_0x376f7b);_0x462412[_0x15705c(0x124)]()===_0x15705c(0x11a)&&_0x2cede9&&(_0x2ae613[_0x15705c(0xea)]=_0x2cede9);const _0x36d4ec=await database_1[_0x15705c(0x11e)][_0x15705c(0xcd)][_0x15705c(0x17b)]({'where':{'id':_0x13332a},'data':_0x2ae613,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x15705c(0x11e)][_0x15705c(0x110)][_0x15705c(0xcf)]({'data':{'paymentId':_0x13332a,'shopId':_0x36d4ec['shopId'],'event':_0x15705c(0x105),'statusCode':0xc8,'responseBody':JSON[_0x15705c(0x112)]({'oldStatus':_0x3ad167['status'],'newStatus':_0x462412[_0x15705c(0x124)](),'notes':_0x376f7b||null,'chargebackAmount':_0x2cede9||null,'timestamp':new Date()['toISOString']()})}}),console[_0x15705c(0x137)](_0x15705c(0x190)+_0x3ad167['orderId']+_0x15705c(0x115)+_0x3ad167[_0x15705c(0xc9)]+_0x15705c(0x16e)+_0x462412[_0x15705c(0x124)]()),_0x462412[_0x15705c(0x124)]()===_0x15705c(0x11a)&&console['log'](_0x15705c(0x13b)+_0x2cede9+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0x36d4ec['id'],'shopId':_0x36d4ec[_0x15705c(0x11b)],'shopName':_0x36d4ec[_0x15705c(0x106)][_0x15705c(0xe6)],'shopUsername':_0x36d4ec[_0x15705c(0x106)][_0x15705c(0x189)],'gateway':_0x36d4ec[_0x15705c(0x119)],'orderId':_0x36d4ec['orderId'],'gatewayOrderId':_0x36d4ec[_0x15705c(0x114)],'amount':_0x36d4ec[_0x15705c(0xe3)],'currency':_0x36d4ec[_0x15705c(0x18b)],'sourceCurrency':_0x36d4ec[_0x15705c(0xf0)],'status':_0x36d4ec['status'],'usage':_0x36d4ec['usage'],'externalPaymentUrl':_0x36d4ec[_0x15705c(0x167)],'gatewayPaymentId':_0x36d4ec[_0x15705c(0xf8)],'customerEmail':_0x36d4ec[_0x15705c(0xdf)],'customerName':_0x36d4ec[_0x15705c(0x16a)],'cardLast4':_0x36d4ec[_0x15705c(0xf2)],'paymentMethod':_0x36d4ec[_0x15705c(0x15e)],'bankId':_0x36d4ec[_0x15705c(0x12f)],'remitterIban':_0x36d4ec[_0x15705c(0x109)],'remitterName':_0x36d4ec[_0x15705c(0xe5)],'chargebackAmount':_0x36d4ec[_0x15705c(0xea)],'adminNotes':_0x36d4ec[_0x15705c(0xd7)],'statusChangedBy':_0x36d4ec[_0x15705c(0x16b)],'statusChangedAt':_0x36d4ec['statusChangedAt'],'createdAt':_0x36d4ec['createdAt'],'updatedAt':_0x36d4ec[_0x15705c(0xd4)],'expiresAt':_0x36d4ec[_0x15705c(0x180)]};}async[a33_0x12b9f7(0x184)](_0x23d6cc){const _0x3fcda5=a33_0x12b9f7,{page:_0x2cbb60,limit:_0x558794,status:_0x516b28}=_0x23d6cc,_0x1edba2=(_0x2cbb60-0x1)*_0x558794,_0x41b19d={};_0x516b28&&(_0x41b19d[_0x3fcda5(0xc9)]=_0x516b28[_0x3fcda5(0x124)]());console[_0x3fcda5(0x137)](_0x3fcda5(0x17f),{'page':_0x2cbb60,'limit':_0x558794,'status':_0x516b28,'where':_0x41b19d});const [_0xf0dd5b,_0x286b10]=await Promise[_0x3fcda5(0x141)]([database_1[_0x3fcda5(0x11e)][_0x3fcda5(0x106)]['findMany']({'where':_0x41b19d,'skip':_0x1edba2,'take':_0x558794,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3fcda5(0x13c)}}),database_1[_0x3fcda5(0x11e)][_0x3fcda5(0x106)][_0x3fcda5(0x179)]({'where':_0x41b19d})]);console[_0x3fcda5(0x137)](_0x3fcda5(0x14b)+_0xf0dd5b[_0x3fcda5(0x13a)]+_0x3fcda5(0xc7)+_0x286b10+_0x3fcda5(0xe7));const _0x350b7f=_0xf0dd5b[_0x3fcda5(0x175)](_0x54e539=>({'id':_0x54e539['id'],'fullName':_0x54e539['name'],'username':_0x54e539[_0x3fcda5(0x189)],'telegramId':_0x54e539['telegram'],'merchantUrl':_0x54e539[_0x3fcda5(0x178)],'gateways':_0x54e539[_0x3fcda5(0xca)]?JSON[_0x3fcda5(0x164)](_0x54e539['paymentGateways']):null,'gatewaySettings':_0x54e539[_0x3fcda5(0xda)]?JSON[_0x3fcda5(0x164)](_0x54e539[_0x3fcda5(0xda)]):null,'publicKey':_0x54e539['publicKey'],'wallets':{'usdtPolygonWallet':_0x54e539['usdtPolygonWallet'],'usdtTrcWallet':_0x54e539[_0x3fcda5(0x100)],'usdtErcWallet':_0x54e539[_0x3fcda5(0x108)],'usdcPolygonWallet':_0x54e539[_0x3fcda5(0x159)]},'status':_0x54e539['status'],'createdAt':_0x54e539[_0x3fcda5(0x13d)]}));return{'users':_0x350b7f,'pagination':{'page':_0x2cbb60,'limit':_0x558794,'total':_0x286b10,'totalPages':Math[_0x3fcda5(0x19a)](_0x286b10/_0x558794)}};}async[a33_0x12b9f7(0x150)](_0x50703b){return await this['userService']['getUserById'](_0x50703b);}async[a33_0x12b9f7(0x111)](_0x2a890f){const _0x480780=a33_0x12b9f7;return await this[_0x480780(0x153)][_0x480780(0x111)](_0x2a890f);}async[a33_0x12b9f7(0x104)](_0x11618e,_0x533229){const _0x14c405=a33_0x12b9f7;return await this[_0x14c405(0x153)][_0x14c405(0x104)](_0x11618e,_0x533229);}async['deleteUser'](_0x3df59b){const _0x383556=a33_0x12b9f7;return await this[_0x383556(0x153)][_0x383556(0x198)](_0x3df59b);}async[a33_0x12b9f7(0x125)](_0x344743){const _0x5dff65=a33_0x12b9f7;console['log'](_0x5dff65(0xdc)+_0x344743);const _0x373b2b=await database_1[_0x5dff65(0x11e)][_0x5dff65(0x106)][_0x5dff65(0x16f)]({'where':{'id':_0x344743},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x373b2b)throw new Error('User\x20not\x20found');if(_0x373b2b[_0x5dff65(0xc9)]===_0x5dff65(0xee))throw new Error('User\x20is\x20already\x20suspended');const _0x4c5198=await this[_0x5dff65(0x153)][_0x5dff65(0x104)](_0x344743,{'status':'SUSPENDED'});return console[_0x5dff65(0x137)](_0x5dff65(0x138)+_0x373b2b[_0x5dff65(0x189)]+_0x5dff65(0xc8)),_0x4c5198;}async[a33_0x12b9f7(0x152)](_0x29187c){const _0x442bc9=a33_0x12b9f7;console[_0x442bc9(0x137)](_0x442bc9(0x10e)+_0x29187c);const _0x2ccbdd=await database_1[_0x442bc9(0x11e)][_0x442bc9(0x106)][_0x442bc9(0x16f)]({'where':{'id':_0x29187c},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x2ccbdd)throw new Error(_0x442bc9(0x18c));if(_0x2ccbdd[_0x442bc9(0xc9)]===_0x442bc9(0x128))throw new Error(_0x442bc9(0xcc));const _0x113476=await this['userService'][_0x442bc9(0x104)](_0x29187c,{'status':_0x442bc9(0x128)});return console['log'](_0x442bc9(0x138)+_0x2ccbdd[_0x442bc9(0x189)]+_0x442bc9(0x10d)),_0x113476;}}exports[a33_0x12b9f7(0x129)]=AdminService;