'use strict';const a33_0x3a6531=a33_0x5043;(function(_0x55d913,_0x4e6117){const _0x118c1e=a33_0x5043,_0x34c6f5=_0x55d913();while(!![]){try{const _0x306139=-parseInt(_0x118c1e(0x1cf))/0x1*(-parseInt(_0x118c1e(0x220))/0x2)+-parseInt(_0x118c1e(0x204))/0x3+-parseInt(_0x118c1e(0x20f))/0x4+-parseInt(_0x118c1e(0x22f))/0x5*(parseInt(_0x118c1e(0x224))/0x6)+-parseInt(_0x118c1e(0x1e5))/0x7*(parseInt(_0x118c1e(0x1c7))/0x8)+-parseInt(_0x118c1e(0x21c))/0x9+-parseInt(_0x118c1e(0x1d2))/0xa*(-parseInt(_0x118c1e(0x1ae))/0xb);if(_0x306139===_0x4e6117)break;else _0x34c6f5['push'](_0x34c6f5['shift']());}catch(_0x2a48d0){_0x34c6f5['push'](_0x34c6f5['shift']());}}}(a33_0x4355,0x7a49f));function a33_0x5043(_0x40fc4a,_0x3cb7ff){const _0x4355d4=a33_0x4355();return a33_0x5043=function(_0x5043f9,_0x55c2b6){_0x5043f9=_0x5043f9-0x179;let _0x3bc353=_0x4355d4[_0x5043f9];return _0x3bc353;},a33_0x5043(_0x40fc4a,_0x3cb7ff);}var __importDefault=this&&this[a33_0x3a6531(0x1c1)]||function(_0x4c72d6){const _0x147445=a33_0x3a6531;return _0x4c72d6&&_0x4c72d6[_0x147445(0x18a)]?_0x4c72d6:{'default':_0x4c72d6};};Object[a33_0x3a6531(0x1e9)](exports,a33_0x3a6531(0x18a),{'value':!![]}),exports[a33_0x3a6531(0x1d8)]=void 0x0;const database_1=__importDefault(require(a33_0x3a6531(0x1a0))),currencyService_1=require(a33_0x3a6531(0x201)),bcryptjs_1=__importDefault(require(a33_0x3a6531(0x20e))),crypto_1=__importDefault(require(a33_0x3a6531(0x1dd)));function a33_0x4355(){const _0x296869=['2673630NaKNKe','createUser','PENDING','telegram','create','qrUrl','deleteUser','\x20payments\x20as\x20paid\x20for\x20period\x20','orderId','updateMany','bcryptjs','95828cTrQqy','toString','paymentsCount','currencyService','period','updateCustomerData','Shop\x20not\x20found','ðŸ’°\x20Payout\x20stats\x20from\x20payments:','invoiceTotalSum','usdtPolygonWallet','custom','payout','merchantEarnings','2320533ZeRbRn','hash','aggregate','map','10xMkWnD','failUrl','getUserById','pendingUrl','3646242UVsFoF','statusChangedBy','COMPLETED','insensitive','ðŸ’°\x20Payout\x20created:\x20','reduce','getMerchantStatistics','search','expiresAt','commissionUSDT','merchantPaid','5yFEnMB','round','calculateTotalPayoutAmount','ðŸ’°\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','parse','ðŸ’°\x20Creating\x20payout\x20for\x20period:\x20','paymentGateways','ðŸ’°\x20Merchants\x20awaiting\x20payout\x20summary:','length','periodTo','getPayoutStats','stringify','\x20payments\x20for\x20analysis','ðŸ’°\x20Marked\x20','SUSPENDED','getSystemStatistics','findUnique','Error\x20parsing\x20gateway\x20settings:','qrCode','gateways','count','publicKey','sort','ðŸ’°\x20Calculating\x20payout\x20stats\x20from\x20payments...','filter','\x20USDT\x20via\x20','cardLast4','shopId','gatewaySettings','findMany','usage','getGatewayDisplayName','dateFrom','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','successfulPayments','usdcPolygonWallet','getAllPayments','ðŸ’°\x20Payout\x20stats\x20calculated:','ACTIVE','status','week','KLYME\x20EU','customerName','PAID','getMerchantsAwaitingPayout','error','__esModule','paidAt','Username\x20already\x20exists','gateway','default','ðŸ’°\x20Calculating\x20payout\x20statistics\x20based\x20on\x20payments...','paymentMethod','calculateCompletedPayoutAmount','currency','gte','txUrls','getDate','toISOString','customerIp','push','Plisio','shopUrl','country','network','minAmount','remitterName','amountAfterCommissionUSDT','../config/database','usdtErcWallet','dateTo','successUrl','usdtTrcWallet','bankId','pk_','payment','awaitingAmountUSDT','totalPayments','whiteUrl','fullName','amount','language','45881ONceAK','desc','customerCountry','gatewayOrderId','log','update','customerUa','failureMessage','externalPaymentUrl','setHours','toUpperCase','totalTurnover','wallets','month','turnoverUSDT','suspendUser','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','hex','updatedAt','__importDefault','lte','amountIsEditable','all','periodFrom','entries','71776pnHxME','merchantUrl','amountUSDT','year','ðŸ“Š\x20Found\x20','notes','remitterIban','txid','182973IVfPRO','totalAmountAfterCommissionUSDT','maxPayments','3750wcCdkg','ðŸ“Š\x20Period:\x20','chargebackAmount','Rapyd','randomBytes','_sum','AdminService','convertToUSDT','ðŸ’°\x20Found\x20','gatewayEarnings','password','crypto','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','split','gatewayPaymentId','username','getPaymentById','CoinToPay','name','154OcoaWE','calculatePayoutStatsFromPayments','CHARGEBACK','createdAt','defineProperty','30d','\x20-\x20','adminNotes','Period\x20end\x20date\x20cannot\x20be\x20in\x20the\x20future','statusChangedAt','\x20merchants\x20with\x20unpaid\x20payments','merchantEarningsUSDT','totalAmountUSDT','limit','setDate','getPayoutById','2020-01-01','generateDailyData','deletePayout','createPayout','telegramId','page','shop','customerEmail','updateUser','commission','getTime','commissionRates','./currencyService','rapydCustomer','ceil'];a33_0x4355=function(){return _0x296869;};return a33_0x4355();}class AdminService{async[a33_0x3a6531(0x23e)](_0x1fab1f){const _0x5d896e=a33_0x3a6531,_0x292d6a=new Date();let _0x29ca1a;switch(_0x1fab1f){case'7d':_0x29ca1a=new Date(_0x292d6a[_0x5d896e(0x1ff)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5d896e(0x1ea):_0x29ca1a=new Date(_0x292d6a['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x29ca1a=new Date(_0x292d6a[_0x5d896e(0x1ff)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'1y':_0x29ca1a=new Date(_0x292d6a[_0x5d896e(0x1ff)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;default:_0x29ca1a=new Date(_0x292d6a[_0x5d896e(0x1ff)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x23f74a,_0x10b995,_0x3d16d0,_0x455f93,_0x50149e,_0x4fa92c,_0x3878e2]=await Promise['all']([database_1[_0x5d896e(0x18e)][_0x5d896e(0x1fb)][_0x5d896e(0x243)](),database_1[_0x5d896e(0x18e)][_0x5d896e(0x1fb)][_0x5d896e(0x243)]({'where':{'status':_0x5d896e(0x182)}}),database_1[_0x5d896e(0x18e)][_0x5d896e(0x1a7)]['count']({'where':{'createdAt':{'gte':_0x29ca1a}}}),database_1['default']['payment']['count']({'where':{'status':_0x5d896e(0x187),'createdAt':{'gte':_0x29ca1a}}}),this['calculateTotalRevenue'](_0x29ca1a),this['calculateTotalPayouts'](_0x29ca1a),database_1[_0x5d896e(0x18e)][_0x5d896e(0x1a7)][_0x5d896e(0x179)]({'take':0xa,'orderBy':{'createdAt':_0x5d896e(0x1af)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]),_0x49f0cf=_0x3d16d0>0x0?_0x455f93/_0x3d16d0*0x64:0x0;return{'overview':{'totalShops':_0x23f74a,'activeShops':_0x10b995,'totalPayments':_0x3d16d0,'successfulPayments':_0x455f93,'conversionRate':Math['round'](_0x49f0cf*0x64)/0x64,'totalRevenue':Math[_0x5d896e(0x230)](_0x50149e*0x64)/0x64,'totalPayouts':Math[_0x5d896e(0x230)](_0x4fa92c*0x64)/0x64},'recentPayments':_0x3878e2[_0x5d896e(0x21f)](_0x511595=>({'id':_0x511595['id'],'amount':_0x511595[_0x5d896e(0x1ac)],'currency':_0x511595['currency'],'status':_0x511595[_0x5d896e(0x183)],'gateway':_0x511595[_0x5d896e(0x18d)],'shop':_0x511595[_0x5d896e(0x1fb)],'createdAt':_0x511595['createdAt']}))};}async[a33_0x3a6531(0x22a)](_0x161b13){const _0x5ed180=a33_0x3a6531;console[_0x5ed180(0x1b2)](_0x5ed180(0x1de),_0x161b13);const _0x50f827=new Date();let _0x5b3a34,_0x4d1343=_0x50f827;if(_0x161b13['period']===_0x5ed180(0x219)&&_0x161b13[_0x5ed180(0x17c)]&&_0x161b13[_0x5ed180(0x1a2)])_0x5b3a34=new Date(_0x161b13[_0x5ed180(0x17c)]),_0x4d1343=new Date(_0x161b13[_0x5ed180(0x1a2)]);else switch(_0x161b13[_0x5ed180(0x213)]){case _0x5ed180(0x184):_0x5b3a34=new Date(_0x50f827[_0x5ed180(0x1ff)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5ed180(0x1bb):_0x5b3a34=new Date(_0x50f827[_0x5ed180(0x1ff)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5ed180(0x1ca):_0x5b3a34=new Date(_0x50f827[_0x5ed180(0x1ff)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5ed180(0x1c4):default:_0x5b3a34=new Date(_0x5ed180(0x1f5));break;}console[_0x5ed180(0x1b2)](_0x5ed180(0x1d3)+_0x5b3a34[_0x5ed180(0x196)]()+_0x5ed180(0x1eb)+_0x4d1343[_0x5ed180(0x196)]());const _0xc542ce={'createdAt':{'gte':_0x5b3a34,'lte':_0x4d1343}};_0x161b13['shopId']&&(_0xc542ce['shopId']=_0x161b13['shopId']);const _0x55e576=await database_1[_0x5ed180(0x18e)]['payment'][_0x5ed180(0x179)]({'where':_0xc542ce,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5ed180(0x1b2)](_0x5ed180(0x1cb)+_0x55e576[_0x5ed180(0x237)]+_0x5ed180(0x23b));let _0x4cad96=0x0,_0x29d80b=0x0,_0x4be7df=0x0,_0x1c66b8=0x0,_0xf7bcd7=_0x55e576[_0x5ed180(0x237)],_0x2b6281=0x0;const _0x36be72={},_0x3f3bd6={};for(const _0x3d118e of _0x55e576){if(_0x3d118e[_0x5ed180(0x183)]===_0x5ed180(0x187)){_0x2b6281++;const _0x127389=await currencyService_1[_0x5ed180(0x212)][_0x5ed180(0x1d9)](_0x3d118e[_0x5ed180(0x1ac)],_0x3d118e[_0x5ed180(0x192)]);_0x4cad96+=_0x127389;let _0x35e45a=0xa;if(_0x3d118e['shop'][_0x5ed180(0x24b)])try{const _0xed9d7=JSON[_0x5ed180(0x233)](_0x3d118e[_0x5ed180(0x1fb)][_0x5ed180(0x24b)]),_0x43b325=this['getGatewayDisplayName'](_0x3d118e[_0x5ed180(0x18d)]);_0xed9d7[_0x43b325]?.[_0x5ed180(0x1fe)]!==undefined&&(_0x35e45a=_0xed9d7[_0x43b325][_0x5ed180(0x1fe)]);}catch(_0x25f074){console[_0x5ed180(0x189)](_0x5ed180(0x240),_0x25f074);}const _0x1f0bc1=_0x127389*(_0x35e45a/0x64),_0x8e43b5=_0x127389-_0x1f0bc1;_0x29d80b+=_0x8e43b5,_0x4be7df+=_0x1f0bc1,!_0x36be72[_0x3d118e[_0x5ed180(0x18d)]]&&(_0x36be72[_0x3d118e['gateway']]={'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'commissionRates':[]}),_0x36be72[_0x3d118e['gateway']][_0x5ed180(0x211)]++,_0x36be72[_0x3d118e[_0x5ed180(0x18d)]][_0x5ed180(0x1bc)]+=_0x127389,_0x36be72[_0x3d118e[_0x5ed180(0x18d)]][_0x5ed180(0x22d)]+=_0x1f0bc1,_0x36be72[_0x3d118e[_0x5ed180(0x18d)]][_0x5ed180(0x1f0)]+=_0x8e43b5,_0x36be72[_0x3d118e['gateway']][_0x5ed180(0x200)]['push'](_0x35e45a),!_0x161b13['shopId']&&(!_0x3f3bd6[_0x3d118e['shopId']]&&(_0x3f3bd6[_0x3d118e[_0x5ed180(0x24a)]]={'shopId':_0x3d118e['shopId'],'shopName':_0x3d118e[_0x5ed180(0x1fb)]['name'],'shopUsername':_0x3d118e[_0x5ed180(0x1fb)][_0x5ed180(0x1e1)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0}),_0x3f3bd6[_0x3d118e[_0x5ed180(0x24a)]][_0x5ed180(0x211)]++,_0x3f3bd6[_0x3d118e[_0x5ed180(0x24a)]][_0x5ed180(0x1bc)]+=_0x127389,_0x3f3bd6[_0x3d118e[_0x5ed180(0x24a)]][_0x5ed180(0x22d)]+=_0x1f0bc1,_0x3f3bd6[_0x3d118e['shopId']]['merchantEarningsUSDT']+=_0x8e43b5);}}const _0x4b9136={'createdAt':{'gte':_0x5b3a34,'lte':_0x4d1343}};_0x161b13['shopId']&&(_0x4b9136[_0x5ed180(0x24a)]=_0x161b13[_0x5ed180(0x24a)]);const _0x46df61=await database_1[_0x5ed180(0x18e)][_0x5ed180(0x21a)][_0x5ed180(0x179)]({'where':_0x4b9136});for(const _0x35cb19 of _0x46df61){_0x1c66b8+=_0x35cb19[_0x5ed180(0x1ac)];}const _0x2c120a=_0x2b6281>0x0?_0x4cad96/_0x2b6281:0x0,_0x252fa1=_0xf7bcd7>0x0?_0x2b6281/_0xf7bcd7*0x64:0x0,_0xc83af4=Object[_0x5ed180(0x1c6)](_0x36be72)['map'](([_0x1268fb,_0x3a1109])=>({'gateway':_0x1268fb,'gatewayDisplayName':this['getGatewayDisplayName'](_0x1268fb),'paymentsCount':_0x3a1109[_0x5ed180(0x211)],'turnoverUSDT':Math[_0x5ed180(0x230)](_0x3a1109[_0x5ed180(0x1bc)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3a1109[_0x5ed180(0x22d)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3a1109[_0x5ed180(0x1f0)]*0x64)/0x64,'averageCommissionRate':_0x3a1109[_0x5ed180(0x200)]['length']>0x0?Math[_0x5ed180(0x230)](_0x3a1109['commissionRates'][_0x5ed180(0x229)]((_0x2761c9,_0x55165d)=>_0x2761c9+_0x55165d,0x0)/_0x3a1109[_0x5ed180(0x200)]['length']*0x64)/0x64:0xa}));let _0x263621;!_0x161b13[_0x5ed180(0x24a)]&&(_0x263621=Object['values'](_0x3f3bd6)[_0x5ed180(0x21f)](_0x557918=>{const _0x3b94d3=_0x5ed180,_0x44b620=_0x46df61[_0x3b94d3(0x247)](_0x311377=>_0x311377[_0x3b94d3(0x24a)]===_0x557918[_0x3b94d3(0x24a)]),_0x1e7178=_0x44b620[_0x3b94d3(0x229)]((_0x1e5e24,_0x2c0da2)=>_0x1e5e24+_0x2c0da2[_0x3b94d3(0x1ac)],0x0);return{..._0x557918,'turnoverUSDT':Math[_0x3b94d3(0x230)](_0x557918['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x557918[_0x3b94d3(0x22d)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x557918[_0x3b94d3(0x1f0)]*0x64)/0x64,'paidOutUSDT':Math[_0x3b94d3(0x230)](_0x1e7178*0x64)/0x64,'averageCheckUSDT':_0x557918[_0x3b94d3(0x211)]>0x0?Math[_0x3b94d3(0x230)](_0x557918['turnoverUSDT']/_0x557918[_0x3b94d3(0x211)]*0x64)/0x64:0x0};}));const _0x23eab4=await this['generateDailyData'](_0x5b3a34,_0x4d1343,_0x161b13['shopId']),_0xb58f4c={'totalTurnover':Math[_0x5ed180(0x230)](_0x4cad96*0x64)/0x64,'merchantEarnings':Math[_0x5ed180(0x230)](_0x29d80b*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4be7df*0x64)/0x64,'totalPaidOut':Math[_0x5ed180(0x230)](_0x1c66b8*0x64)/0x64,'averageCheck':Math[_0x5ed180(0x230)](_0x2c120a*0x64)/0x64,'totalPayments':_0xf7bcd7,'successfulPayments':_0x2b6281,'conversionRate':Math['round'](_0x252fa1*0x64)/0x64,'gatewayBreakdown':_0xc83af4,'merchantBreakdown':_0x263621,'dailyData':_0x23eab4,'periodInfo':{'from':_0x5b3a34,'to':_0x4d1343,'periodType':_0x161b13[_0x5ed180(0x213)]||_0x5ed180(0x1bb),'daysCount':Math[_0x5ed180(0x203)]((_0x4d1343['getTime']()-_0x5b3a34[_0x5ed180(0x1ff)]())/(0x3e8*0x3c*0x3c*0x18))}};return console[_0x5ed180(0x1b2)](_0x5ed180(0x1be),{'totalTurnover':_0xb58f4c[_0x5ed180(0x1b9)],'merchantEarnings':_0xb58f4c[_0x5ed180(0x21b)],'gatewayEarnings':_0xb58f4c[_0x5ed180(0x1db)],'totalPayments':_0xb58f4c[_0x5ed180(0x1a9)],'successfulPayments':_0xb58f4c[_0x5ed180(0x17e)]}),_0xb58f4c;}async[a33_0x3a6531(0x1f6)](_0x66050f,_0x81f26b,_0x255b96){const _0x46d24a=a33_0x3a6531,_0x24f8fd=[],_0x545d7c=new Date(_0x66050f);while(_0x545d7c<=_0x81f26b){const _0x8c5e7f=new Date(_0x545d7c),_0x9f0429=new Date(_0x545d7c);_0x9f0429[_0x46d24a(0x1b7)](0x17,0x3b,0x3b,0x3e7);const _0x4081df={'createdAt':{'gte':_0x8c5e7f,'lte':_0x9f0429},'status':'PAID'};_0x255b96&&(_0x4081df[_0x46d24a(0x24a)]=_0x255b96);const _0x3a2ed4=await database_1[_0x46d24a(0x18e)]['payment']['findMany']({'where':_0x4081df,'include':{'shop':{'select':{'gatewaySettings':!![]}}}});let _0x256bb6=0x0,_0x5a770f=0x0,_0x28f2e6=0x0;for(const _0x10651f of _0x3a2ed4){const _0x1fd71b=await currencyService_1['currencyService'][_0x46d24a(0x1d9)](_0x10651f[_0x46d24a(0x1ac)],_0x10651f[_0x46d24a(0x192)]);_0x256bb6+=_0x1fd71b;let _0x451406=0xa;if(_0x10651f[_0x46d24a(0x1fb)][_0x46d24a(0x24b)])try{const _0x108c88=JSON['parse'](_0x10651f[_0x46d24a(0x1fb)][_0x46d24a(0x24b)]),_0xf99adf=this[_0x46d24a(0x17b)](_0x10651f[_0x46d24a(0x18d)]);_0x108c88[_0xf99adf]?.['commission']!==undefined&&(_0x451406=_0x108c88[_0xf99adf][_0x46d24a(0x1fe)]);}catch(_0x9894ba){}const _0x2dbcb8=_0x1fd71b*(_0x451406/0x64),_0x27ce46=_0x1fd71b-_0x2dbcb8;_0x5a770f+=_0x27ce46,_0x28f2e6+=_0x2dbcb8;}_0x24f8fd['push']({'date':_0x545d7c[_0x46d24a(0x196)]()[_0x46d24a(0x1df)]('T')[0x0],'turnover':Math[_0x46d24a(0x230)](_0x256bb6*0x64)/0x64,'merchantEarnings':Math[_0x46d24a(0x230)](_0x5a770f*0x64)/0x64,'gatewayEarnings':Math[_0x46d24a(0x230)](_0x28f2e6*0x64)/0x64,'paymentsCount':_0x3a2ed4[_0x46d24a(0x237)]}),_0x545d7c[_0x46d24a(0x1f3)](_0x545d7c[_0x46d24a(0x195)]()+0x1);}return _0x24f8fd;}[a33_0x3a6531(0x17b)](_0x24128b){const _0x3beb8b=a33_0x3a6531,_0x33b2b8={'plisio':_0x3beb8b(0x199),'rapyd':_0x3beb8b(0x1d5),'noda':'Noda','cointopay':_0x3beb8b(0x1e3),'klyme_eu':_0x3beb8b(0x185),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x33b2b8[_0x24128b]||_0x24128b;}async[a33_0x3a6531(0x239)](){const _0xceec70=a33_0x3a6531;console[_0xceec70(0x1b2)](_0xceec70(0x18f));const [_0x281569,_0x1bef08,_0x3af33a,_0x48dc92,_0x13e0dd,_0x43d580]=await Promise[_0xceec70(0x1c4)]([database_1['default']['payout']['count'](),database_1['default'][_0xceec70(0x21a)][_0xceec70(0x243)]({'where':{'status':'COMPLETED'}}),database_1[_0xceec70(0x18e)][_0xceec70(0x21a)][_0xceec70(0x243)]({'where':{'status':_0xceec70(0x206)}}),this[_0xceec70(0x1e6)](),this[_0xceec70(0x231)](),this['calculateCompletedPayoutAmount']()]);return console[_0xceec70(0x1b2)](_0xceec70(0x181),{'totalPayouts':_0x281569,'completedPayouts':_0x1bef08,'pendingPayouts':_0x3af33a,'totalPaidPayments':_0x48dc92,'totalPayoutAmount':_0x13e0dd,'completedPayoutAmount':_0x43d580}),{'totalPayouts':_0x48dc92[_0xceec70(0x1a9)]||0x0,'completedPayouts':_0x1bef08||0x0,'pendingPayouts':_0x48dc92['awaitingPayouts']||0x0,'rejectedPayouts':_0x281569-_0x1bef08-_0x3af33a||0x0,'totalAmount':Math[_0xceec70(0x230)]((_0x48dc92[_0xceec70(0x1f1)]||0x0)*0x64)/0x64,'completedAmount':Math[_0xceec70(0x230)]((_0x43d580||0x0)*0x64)/0x64,'pendingAmount':Math[_0xceec70(0x230)]((_0x48dc92[_0xceec70(0x1a8)]||0x0)*0x64)/0x64};}async[a33_0x3a6531(0x1e6)](){const _0x36031e=a33_0x3a6531;console[_0x36031e(0x1b2)](_0x36031e(0x246));const _0x192f5a=await database_1['default'][_0x36031e(0x1a7)]['findMany']({'where':{'status':_0x36031e(0x187),'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'shopId':!![],'shop':{'select':{'gatewaySettings':!![]}},'gateway':!![]}});console[_0x36031e(0x1b2)](_0x36031e(0x1da)+_0x192f5a[_0x36031e(0x237)]+'\x20paid\x20payments');let _0x377f75=0x0,_0x73d110=0x0,_0x5c3df4=0x0;for(const _0x4bc675 of _0x192f5a){const _0x396810=await currencyService_1[_0x36031e(0x212)][_0x36031e(0x1d9)](_0x4bc675[_0x36031e(0x1ac)],_0x4bc675['currency']);_0x377f75+=_0x396810,!_0x4bc675[_0x36031e(0x22e)]&&(_0x73d110+=_0x396810,_0x5c3df4++);}const _0x1f33db={'totalPayments':_0x192f5a['length'],'totalAmountUSDT':_0x377f75,'awaitingPayouts':_0x5c3df4,'awaitingAmountUSDT':_0x73d110};return console[_0x36031e(0x1b2)](_0x36031e(0x216),_0x1f33db),_0x1f33db;}async[a33_0x3a6531(0x188)](_0x5c57a7){const _0x4f8377=a33_0x3a6531;console[_0x4f8377(0x1b2)](_0x4f8377(0x232),_0x5c57a7);const _0x422f2c=await database_1[_0x4f8377(0x18e)][_0x4f8377(0x1fb)][_0x4f8377(0x179)]({'where':{'payments':{'some':{'status':_0x4f8377(0x187),'merchantPaid':![],'paidAt':{'not':null}}},..._0x5c57a7[_0x4f8377(0x22b)]?{'OR':[{'name':{'contains':_0x5c57a7['search'],'mode':_0x4f8377(0x227)}},{'username':{'contains':_0x5c57a7[_0x4f8377(0x22b)],'mode':'insensitive'}}]}:{}},'include':{'payments':{'where':{'status':_0x4f8377(0x187),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![]}}}});console[_0x4f8377(0x1b2)](_0x4f8377(0x1da)+_0x422f2c[_0x4f8377(0x237)]+_0x4f8377(0x1ef));const _0x43b7bd=[];for(const _0xf889de of _0x422f2c){let _0xea2f3e=0x0,_0x5acfa7=0x0;const _0x41a7b9={};let _0xe07911={};if(_0xf889de[_0x4f8377(0x24b)])try{_0xe07911=JSON[_0x4f8377(0x233)](_0xf889de[_0x4f8377(0x24b)]);}catch(_0x9b31c0){console[_0x4f8377(0x189)]('Error\x20parsing\x20gateway\x20settings\x20for\x20merchant:',_0xf889de[_0x4f8377(0x1e1)],_0x9b31c0);}let _0x546fab=new Date();for(const _0x506dcb of _0xf889de['payments']){const _0x493508=await currencyService_1[_0x4f8377(0x212)][_0x4f8377(0x1d9)](_0x506dcb['amount'],_0x506dcb['currency']);_0xea2f3e+=_0x493508;const _0x323c4b=this['getGatewayDisplayName'](_0x506dcb[_0x4f8377(0x18d)]);let _0x3aba5d=0xa;_0xe07911[_0x323c4b]?.[_0x4f8377(0x1fe)]!==undefined&&(_0x3aba5d=_0xe07911[_0x323c4b][_0x4f8377(0x1fe)]);const _0x15ee3d=_0x493508*(0x1-_0x3aba5d/0x64);_0x5acfa7+=_0x15ee3d,!_0x41a7b9[_0x506dcb[_0x4f8377(0x18d)]]&&(_0x41a7b9[_0x506dcb[_0x4f8377(0x18d)]]={'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x3aba5d}),_0x41a7b9[_0x506dcb[_0x4f8377(0x18d)]][_0x4f8377(0x243)]++,_0x41a7b9[_0x506dcb['gateway']][_0x4f8377(0x1c9)]+=_0x493508,_0x41a7b9[_0x506dcb[_0x4f8377(0x18d)]][_0x4f8377(0x19f)]+=_0x15ee3d,_0x506dcb[_0x4f8377(0x18b)]&&_0x506dcb[_0x4f8377(0x18b)]<_0x546fab&&(_0x546fab=_0x506dcb[_0x4f8377(0x18b)]);}if(_0x5c57a7[_0x4f8377(0x19d)]&&_0x5acfa7<_0x5c57a7['minAmount'])continue;_0x43b7bd[_0x4f8377(0x198)]({'id':_0xf889de['id'],'fullName':_0xf889de[_0x4f8377(0x1e4)],'username':_0xf889de['username'],'telegramId':_0xf889de[_0x4f8377(0x207)],'merchantUrl':_0xf889de[_0x4f8377(0x19a)],'wallets':{'usdtPolygonWallet':_0xf889de['usdtPolygonWallet'],'usdtTrcWallet':_0xf889de[_0x4f8377(0x1a4)],'usdtErcWallet':_0xf889de[_0x4f8377(0x1a1)],'usdcPolygonWallet':_0xf889de[_0x4f8377(0x17f)]},'totalAmountUSDT':Math['round'](_0xea2f3e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4f8377(0x230)](_0x5acfa7*0x64)/0x64,'paymentsCount':_0xf889de['payments'][_0x4f8377(0x237)],'oldestPaymentDate':_0x546fab,'gatewayBreakdown':Object[_0x4f8377(0x1c6)](_0x41a7b9)['map'](([_0x1094f0,_0x61338e])=>({'gateway':_0x1094f0,'count':_0x61338e[_0x4f8377(0x243)],'amountUSDT':Math['round'](_0x61338e[_0x4f8377(0x1c9)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4f8377(0x230)](_0x61338e[_0x4f8377(0x19f)]*0x64)/0x64,'commission':_0x61338e[_0x4f8377(0x1fe)]}))});}_0x43b7bd[_0x4f8377(0x245)]((_0xd951f2,_0x2316c7)=>_0x2316c7[_0x4f8377(0x1d0)]-_0xd951f2[_0x4f8377(0x1d0)]);const _0x4177cd=_0x43b7bd[_0x4f8377(0x237)],_0x4df3ec=(_0x5c57a7[_0x4f8377(0x1fa)]-0x1)*_0x5c57a7[_0x4f8377(0x1f2)],_0x12e018=_0x43b7bd['slice'](_0x4df3ec,_0x4df3ec+_0x5c57a7[_0x4f8377(0x1f2)]),_0x1fd4c6={'totalMerchants':_0x4177cd,'totalAmountUSDT':Math[_0x4f8377(0x230)](_0x43b7bd[_0x4f8377(0x229)]((_0x137bdb,_0x2e22a8)=>_0x137bdb+_0x2e22a8[_0x4f8377(0x1f1)],0x0)*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4f8377(0x230)](_0x43b7bd[_0x4f8377(0x229)]((_0x295ff0,_0x3db661)=>_0x295ff0+_0x3db661['totalAmountAfterCommissionUSDT'],0x0)*0x64)/0x64};return console['log'](_0x4f8377(0x236),_0x1fd4c6),{'merchants':_0x12e018,'pagination':{'page':_0x5c57a7[_0x4f8377(0x1fa)],'limit':_0x5c57a7[_0x4f8377(0x1f2)],'total':_0x4177cd,'totalPages':Math['ceil'](_0x4177cd/_0x5c57a7['limit'])},'summary':_0x1fd4c6};}async[a33_0x3a6531(0x1f8)](_0x3ff7ac){const _0x22605f=a33_0x3a6531,{shopId:_0x5be081,amount:_0x440d26,network:_0x39b3a5,notes:_0x5248a5,periodFrom:_0x4b187c,periodTo:_0xee6c7}=_0x3ff7ac,_0x363f9=await database_1['default']['shop'][_0x22605f(0x23f)]({'where':{'id':_0x5be081},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x363f9)throw new Error(_0x22605f(0x215));let _0x466303,_0x20019d;if(_0x4b187c&&_0xee6c7){_0x466303=new Date(_0x4b187c),_0x20019d=new Date(_0xee6c7);if(_0x466303>=_0x20019d)throw new Error('Period\x20start\x20date\x20must\x20be\x20before\x20end\x20date');if(_0x20019d>new Date())throw new Error(_0x22605f(0x1ed));console[_0x22605f(0x1b2)](_0x22605f(0x234)+_0x466303[_0x22605f(0x196)]()+_0x22605f(0x1eb)+_0x20019d['toISOString']());}const _0x201073=await database_1[_0x22605f(0x18e)][_0x22605f(0x21a)][_0x22605f(0x208)]({'data':{'shopId':_0x5be081,'amount':_0x440d26,'network':_0x39b3a5,'status':_0x22605f(0x226),'notes':_0x5248a5,'periodFrom':_0x466303,'periodTo':_0x20019d,'paidAt':new Date()}});console[_0x22605f(0x1b2)](_0x22605f(0x228)+_0x201073['id']+'\x20for\x20shop\x20'+_0x363f9[_0x22605f(0x1e1)]+'\x20('+_0x440d26+_0x22605f(0x248)+_0x39b3a5+')');if(_0x466303&&_0x20019d){const _0x468dcd=await database_1[_0x22605f(0x18e)]['payment'][_0x22605f(0x20d)]({'where':{'shopId':_0x5be081,'status':'PAID','merchantPaid':![],'paidAt':{'gte':_0x466303,'lte':_0x20019d}},'data':{'merchantPaid':!![]}});console['log'](_0x22605f(0x23c)+_0x468dcd['count']+_0x22605f(0x20b)+_0x466303[_0x22605f(0x196)]()+'\x20-\x20'+_0x20019d['toISOString']());}return{'id':_0x201073['id'],'shopId':_0x201073[_0x22605f(0x24a)],'shopName':_0x363f9[_0x22605f(0x1e4)],'shopUsername':_0x363f9['username'],'amount':_0x201073[_0x22605f(0x1ac)],'network':_0x201073[_0x22605f(0x19c)],'status':_0x201073[_0x22605f(0x183)],'txid':_0x201073[_0x22605f(0x1ce)],'notes':_0x201073[_0x22605f(0x1cc)],'periodFrom':_0x201073[_0x22605f(0x1c5)],'periodTo':_0x201073['periodTo'],'createdAt':_0x201073[_0x22605f(0x1e8)],'paidAt':_0x201073[_0x22605f(0x18b)]};}async['getAllPayouts'](_0x44736e){const _0x719e67=a33_0x3a6531,{page:_0x24057c,limit:_0x20aef6,shopId:_0x27596b,network:_0x1aee10,dateFrom:_0x2b767e,dateTo:_0xb7cca4,search:_0x2e7ef5}=_0x44736e,_0x2b0864=(_0x24057c-0x1)*_0x20aef6,_0x51873c={};_0x27596b&&(_0x51873c['shopId']=_0x27596b);_0x1aee10&&(_0x51873c[_0x719e67(0x19c)]=_0x1aee10);(_0x2b767e||_0xb7cca4)&&(_0x51873c[_0x719e67(0x1e8)]={},_0x2b767e&&(_0x51873c['createdAt']['gte']=new Date(_0x2b767e)),_0xb7cca4&&(_0x51873c['createdAt'][_0x719e67(0x1c2)]=new Date(_0xb7cca4)));_0x2e7ef5&&(_0x51873c['OR']=[{'shop':{'name':{'contains':_0x2e7ef5,'mode':_0x719e67(0x227)}}},{'shop':{'username':{'contains':_0x2e7ef5,'mode':_0x719e67(0x227)}}},{'notes':{'contains':_0x2e7ef5,'mode':_0x719e67(0x227)}},{'txid':{'contains':_0x2e7ef5,'mode':'insensitive'}}]);const [_0x318d45,_0x54d9f3]=await Promise[_0x719e67(0x1c4)]([database_1[_0x719e67(0x18e)]['payout'][_0x719e67(0x179)]({'where':_0x51873c,'skip':_0x2b0864,'take':_0x20aef6,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x719e67(0x18e)][_0x719e67(0x21a)]['count']({'where':_0x51873c})]);return{'payouts':_0x318d45[_0x719e67(0x21f)](_0x4f95fc=>({'id':_0x4f95fc['id'],'shopId':_0x4f95fc[_0x719e67(0x24a)],'shopName':_0x4f95fc[_0x719e67(0x1fb)][_0x719e67(0x1e4)],'shopUsername':_0x4f95fc[_0x719e67(0x1fb)]['username'],'amount':_0x4f95fc['amount'],'network':_0x4f95fc['network'],'status':_0x4f95fc[_0x719e67(0x183)],'txid':_0x4f95fc[_0x719e67(0x1ce)],'notes':_0x4f95fc[_0x719e67(0x1cc)],'periodFrom':_0x4f95fc[_0x719e67(0x1c5)],'periodTo':_0x4f95fc[_0x719e67(0x238)],'createdAt':_0x4f95fc[_0x719e67(0x1e8)],'paidAt':_0x4f95fc['paidAt']})),'pagination':{'page':_0x24057c,'limit':_0x20aef6,'total':_0x54d9f3,'totalPages':Math['ceil'](_0x54d9f3/_0x20aef6)}};}async[a33_0x3a6531(0x1f4)](_0x396874){const _0xfd95a4=a33_0x3a6531,_0x2b016c=await database_1['default']['payout'][_0xfd95a4(0x23f)]({'where':{'id':_0x396874},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2b016c)return null;return{'id':_0x2b016c['id'],'shopId':_0x2b016c[_0xfd95a4(0x24a)],'shopName':_0x2b016c[_0xfd95a4(0x1fb)]['name'],'shopUsername':_0x2b016c['shop'][_0xfd95a4(0x1e1)],'amount':_0x2b016c[_0xfd95a4(0x1ac)],'network':_0x2b016c[_0xfd95a4(0x19c)],'status':_0x2b016c['status'],'txid':_0x2b016c['txid'],'notes':_0x2b016c[_0xfd95a4(0x1cc)],'periodFrom':_0x2b016c[_0xfd95a4(0x1c5)],'periodTo':_0x2b016c[_0xfd95a4(0x238)],'createdAt':_0x2b016c[_0xfd95a4(0x1e8)],'paidAt':_0x2b016c[_0xfd95a4(0x18b)]};}async[a33_0x3a6531(0x1f7)](_0xecb413){const _0x4e2d73=a33_0x3a6531;await database_1[_0x4e2d73(0x18e)][_0x4e2d73(0x21a)]['delete']({'where':{'id':_0xecb413}});}async[a33_0x3a6531(0x180)](_0xbf45e4){const _0x16dc88=a33_0x3a6531,{page:_0x925bea,limit:_0x219206,status:_0x262d57,gateway:_0x34981f,shopId:_0x31476f,dateFrom:_0x3ab7cd,dateTo:_0x5a919c,search:_0x1b7dbe}=_0xbf45e4,_0x2e4f3e=(_0x925bea-0x1)*_0x219206,_0x4af84f={};_0x262d57&&(_0x4af84f[_0x16dc88(0x183)]=_0x262d57[_0x16dc88(0x1b8)]());_0x34981f&&(_0x4af84f[_0x16dc88(0x18d)]=_0x34981f);_0x31476f&&(_0x4af84f[_0x16dc88(0x24a)]=_0x31476f);(_0x3ab7cd||_0x5a919c)&&(_0x4af84f[_0x16dc88(0x1e8)]={},_0x3ab7cd&&(_0x4af84f[_0x16dc88(0x1e8)][_0x16dc88(0x193)]=new Date(_0x3ab7cd)),_0x5a919c&&(_0x4af84f[_0x16dc88(0x1e8)]['lte']=new Date(_0x5a919c)));_0x1b7dbe&&(_0x4af84f['OR']=[{'id':{'contains':_0x1b7dbe,'mode':_0x16dc88(0x227)}},{'orderId':{'contains':_0x1b7dbe,'mode':_0x16dc88(0x227)}},{'gatewayOrderId':{'contains':_0x1b7dbe,'mode':'insensitive'}},{'gatewayPaymentId':{'contains':_0x1b7dbe,'mode':_0x16dc88(0x227)}},{'customerEmail':{'contains':_0x1b7dbe,'mode':_0x16dc88(0x227)}},{'customerName':{'contains':_0x1b7dbe,'mode':_0x16dc88(0x227)}},{'shop':{'name':{'contains':_0x1b7dbe,'mode':_0x16dc88(0x227)}}},{'shop':{'username':{'contains':_0x1b7dbe,'mode':_0x16dc88(0x227)}}}]);const [_0x150760,_0x537322]=await Promise[_0x16dc88(0x1c4)]([database_1['default'][_0x16dc88(0x1a7)]['findMany']({'where':_0x4af84f,'skip':_0x2e4f3e,'take':_0x219206,'orderBy':{'createdAt':_0x16dc88(0x1af)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x16dc88(0x18e)]['payment']['count']({'where':_0x4af84f})]);return{'payments':_0x150760[_0x16dc88(0x21f)](_0x105a6f=>({'id':_0x105a6f['id'],'shopId':_0x105a6f[_0x16dc88(0x24a)],'gateway':_0x105a6f[_0x16dc88(0x18d)],'amount':_0x105a6f[_0x16dc88(0x1ac)],'currency':_0x105a6f[_0x16dc88(0x192)],'sourceCurrency':_0x105a6f['sourceCurrency'],'usage':_0x105a6f[_0x16dc88(0x17a)],'status':_0x105a6f[_0x16dc88(0x183)],'externalPaymentUrl':_0x105a6f[_0x16dc88(0x1b6)],'successUrl':_0x105a6f[_0x16dc88(0x1a3)],'failUrl':_0x105a6f[_0x16dc88(0x221)],'pendingUrl':_0x105a6f[_0x16dc88(0x223)],'whiteUrl':_0x105a6f[_0x16dc88(0x1aa)],'expiresAt':_0x105a6f[_0x16dc88(0x22c)],'orderId':_0x105a6f[_0x16dc88(0x20c)],'gatewayOrderId':_0x105a6f[_0x16dc88(0x1b1)],'gatewayPaymentId':_0x105a6f['gatewayPaymentId'],'customerEmail':_0x105a6f[_0x16dc88(0x1fc)],'customerName':_0x105a6f[_0x16dc88(0x186)],'customerCountry':_0x105a6f['customerCountry'],'customerIp':_0x105a6f[_0x16dc88(0x197)],'customerUa':_0x105a6f[_0x16dc88(0x1b4)],'invoiceTotalSum':_0x105a6f[_0x16dc88(0x217)],'qrCode':_0x105a6f[_0x16dc88(0x241)],'qrUrl':_0x105a6f[_0x16dc88(0x209)],'txUrls':_0x105a6f[_0x16dc88(0x194)],'country':_0x105a6f['country'],'language':_0x105a6f[_0x16dc88(0x1ad)],'amountIsEditable':_0x105a6f[_0x16dc88(0x1c3)],'maxPayments':_0x105a6f[_0x16dc88(0x1d1)],'rapydCustomer':_0x105a6f[_0x16dc88(0x202)],'cardLast4':_0x105a6f[_0x16dc88(0x249)],'paymentMethod':_0x105a6f[_0x16dc88(0x190)],'bankId':_0x105a6f[_0x16dc88(0x1a5)],'remitterIban':_0x105a6f['remitterIban'],'remitterName':_0x105a6f[_0x16dc88(0x19e)],'paidAt':_0x105a6f[_0x16dc88(0x18b)],'merchantPaid':_0x105a6f[_0x16dc88(0x22e)],'chargebackAmount':_0x105a6f['chargebackAmount'],'adminNotes':_0x105a6f[_0x16dc88(0x1ec)],'statusChangedBy':_0x105a6f[_0x16dc88(0x225)],'statusChangedAt':_0x105a6f[_0x16dc88(0x1ee)],'failureMessage':_0x105a6f[_0x16dc88(0x1b5)],'createdAt':_0x105a6f[_0x16dc88(0x1e8)],'updatedAt':_0x105a6f[_0x16dc88(0x1c0)],'shop':_0x105a6f[_0x16dc88(0x1fb)]})),'pagination':{'page':_0x925bea,'limit':_0x219206,'total':_0x537322,'totalPages':Math[_0x16dc88(0x203)](_0x537322/_0x219206)}};}async[a33_0x3a6531(0x1e2)](_0x1c7f6a){const _0x5edb24=a33_0x3a6531,_0x3c5301=await database_1[_0x5edb24(0x18e)][_0x5edb24(0x1a7)][_0x5edb24(0x23f)]({'where':{'id':_0x1c7f6a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3c5301)return null;return{'id':_0x3c5301['id'],'shopId':_0x3c5301[_0x5edb24(0x24a)],'gateway':_0x3c5301[_0x5edb24(0x18d)],'amount':_0x3c5301[_0x5edb24(0x1ac)],'currency':_0x3c5301[_0x5edb24(0x192)],'sourceCurrency':_0x3c5301['sourceCurrency'],'usage':_0x3c5301[_0x5edb24(0x17a)],'status':_0x3c5301[_0x5edb24(0x183)],'externalPaymentUrl':_0x3c5301[_0x5edb24(0x1b6)],'successUrl':_0x3c5301[_0x5edb24(0x1a3)],'failUrl':_0x3c5301[_0x5edb24(0x221)],'pendingUrl':_0x3c5301['pendingUrl'],'whiteUrl':_0x3c5301[_0x5edb24(0x1aa)],'expiresAt':_0x3c5301['expiresAt'],'orderId':_0x3c5301[_0x5edb24(0x20c)],'gatewayOrderId':_0x3c5301['gatewayOrderId'],'gatewayPaymentId':_0x3c5301['gatewayPaymentId'],'customerEmail':_0x3c5301[_0x5edb24(0x1fc)],'customerName':_0x3c5301[_0x5edb24(0x186)],'customerCountry':_0x3c5301['customerCountry'],'customerIp':_0x3c5301[_0x5edb24(0x197)],'customerUa':_0x3c5301['customerUa'],'invoiceTotalSum':_0x3c5301[_0x5edb24(0x217)],'qrCode':_0x3c5301[_0x5edb24(0x241)],'qrUrl':_0x3c5301[_0x5edb24(0x209)],'txUrls':_0x3c5301['txUrls'],'country':_0x3c5301[_0x5edb24(0x19b)],'language':_0x3c5301[_0x5edb24(0x1ad)],'amountIsEditable':_0x3c5301[_0x5edb24(0x1c3)],'maxPayments':_0x3c5301[_0x5edb24(0x1d1)],'rapydCustomer':_0x3c5301[_0x5edb24(0x202)],'cardLast4':_0x3c5301[_0x5edb24(0x249)],'paymentMethod':_0x3c5301[_0x5edb24(0x190)],'bankId':_0x3c5301[_0x5edb24(0x1a5)],'remitterIban':_0x3c5301[_0x5edb24(0x1cd)],'remitterName':_0x3c5301[_0x5edb24(0x19e)],'paidAt':_0x3c5301[_0x5edb24(0x18b)],'merchantPaid':_0x3c5301[_0x5edb24(0x22e)],'chargebackAmount':_0x3c5301['chargebackAmount'],'adminNotes':_0x3c5301['adminNotes'],'statusChangedBy':_0x3c5301[_0x5edb24(0x225)],'statusChangedAt':_0x3c5301[_0x5edb24(0x1ee)],'failureMessage':_0x3c5301[_0x5edb24(0x1b5)],'createdAt':_0x3c5301['createdAt'],'updatedAt':_0x3c5301[_0x5edb24(0x1c0)],'shop':_0x3c5301[_0x5edb24(0x1fb)]};}async['updatePaymentStatus'](_0x89713e,_0xa4f4b2,_0x3e98f3,_0x2983a3){const _0xd54534=a33_0x3a6531,_0x2dad6f={'status':_0xa4f4b2['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x3e98f3&&(_0x2dad6f['adminNotes']=_0x3e98f3);_0xa4f4b2['toUpperCase']()===_0xd54534(0x1e7)&&_0x2983a3&&(_0x2dad6f['chargebackAmount']=_0x2983a3);_0xa4f4b2[_0xd54534(0x1b8)]()===_0xd54534(0x187)&&(_0x2dad6f[_0xd54534(0x18b)]=new Date());const _0x284103=await database_1['default'][_0xd54534(0x1a7)][_0xd54534(0x1b3)]({'where':{'id':_0x89713e},'data':_0x2dad6f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x284103['id'],'shopId':_0x284103[_0xd54534(0x24a)],'gateway':_0x284103[_0xd54534(0x18d)],'amount':_0x284103['amount'],'currency':_0x284103[_0xd54534(0x192)],'sourceCurrency':_0x284103['sourceCurrency'],'usage':_0x284103[_0xd54534(0x17a)],'status':_0x284103[_0xd54534(0x183)],'externalPaymentUrl':_0x284103[_0xd54534(0x1b6)],'successUrl':_0x284103['successUrl'],'failUrl':_0x284103[_0xd54534(0x221)],'pendingUrl':_0x284103['pendingUrl'],'whiteUrl':_0x284103[_0xd54534(0x1aa)],'expiresAt':_0x284103['expiresAt'],'orderId':_0x284103[_0xd54534(0x20c)],'gatewayOrderId':_0x284103[_0xd54534(0x1b1)],'gatewayPaymentId':_0x284103[_0xd54534(0x1e0)],'customerEmail':_0x284103[_0xd54534(0x1fc)],'customerName':_0x284103[_0xd54534(0x186)],'customerCountry':_0x284103['customerCountry'],'customerIp':_0x284103[_0xd54534(0x197)],'customerUa':_0x284103['customerUa'],'invoiceTotalSum':_0x284103[_0xd54534(0x217)],'qrCode':_0x284103['qrCode'],'qrUrl':_0x284103['qrUrl'],'txUrls':_0x284103[_0xd54534(0x194)],'country':_0x284103[_0xd54534(0x19b)],'language':_0x284103['language'],'amountIsEditable':_0x284103[_0xd54534(0x1c3)],'maxPayments':_0x284103[_0xd54534(0x1d1)],'rapydCustomer':_0x284103[_0xd54534(0x202)],'cardLast4':_0x284103[_0xd54534(0x249)],'paymentMethod':_0x284103[_0xd54534(0x190)],'bankId':_0x284103[_0xd54534(0x1a5)],'remitterIban':_0x284103['remitterIban'],'remitterName':_0x284103[_0xd54534(0x19e)],'paidAt':_0x284103[_0xd54534(0x18b)],'merchantPaid':_0x284103[_0xd54534(0x22e)],'chargebackAmount':_0x284103[_0xd54534(0x1d4)],'adminNotes':_0x284103[_0xd54534(0x1ec)],'statusChangedBy':_0x284103[_0xd54534(0x225)],'statusChangedAt':_0x284103[_0xd54534(0x1ee)],'failureMessage':_0x284103[_0xd54534(0x1b5)],'createdAt':_0x284103[_0xd54534(0x1e8)],'updatedAt':_0x284103['updatedAt'],'shop':_0x284103[_0xd54534(0x1fb)]};}async[a33_0x3a6531(0x214)](_0x1557f6,_0x56eb2f){const _0x54d1e4=a33_0x3a6531;console[_0x54d1e4(0x1b2)]('ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x1557f6+':',_0x56eb2f);const _0x4682b3={'updatedAt':new Date()};_0x56eb2f[_0x54d1e4(0x1b0)]!==undefined&&(_0x4682b3[_0x54d1e4(0x1b0)]=_0x56eb2f[_0x54d1e4(0x1b0)]||null);_0x56eb2f['customerIp']!==undefined&&(_0x4682b3[_0x54d1e4(0x197)]=_0x56eb2f['customerIp']||null);_0x56eb2f[_0x54d1e4(0x1b4)]!==undefined&&(_0x4682b3[_0x54d1e4(0x1b4)]=_0x56eb2f[_0x54d1e4(0x1b4)]||null);const _0x16f0ce=await database_1[_0x54d1e4(0x18e)][_0x54d1e4(0x1a7)][_0x54d1e4(0x1b3)]({'where':{'id':_0x1557f6},'data':_0x4682b3,'select':{'id':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x54d1e4(0x1b2)](_0x54d1e4(0x17d)+_0x1557f6+':',{'customerCountry':_0x16f0ce[_0x54d1e4(0x1b0)],'customerIp':_0x16f0ce[_0x54d1e4(0x197)],'customerUa':_0x16f0ce['customerUa']}),{'id':_0x16f0ce['id'],'customerCountry':_0x16f0ce[_0x54d1e4(0x1b0)],'customerIp':_0x16f0ce[_0x54d1e4(0x197)],'customerUa':_0x16f0ce[_0x54d1e4(0x1b4)],'updatedAt':_0x16f0ce['updatedAt']};}async['getAllUsers'](_0x2e9e4f){const _0x4ecd24=a33_0x3a6531,{page:_0x127b7c,limit:_0xf2479b,status:_0x1dd42d}=_0x2e9e4f,_0x4d7432=(_0x127b7c-0x1)*_0xf2479b,_0xd49ece={};_0x1dd42d&&(_0xd49ece[_0x4ecd24(0x183)]=_0x1dd42d[_0x4ecd24(0x1b8)]());const [_0x248056,_0x421318]=await Promise['all']([database_1[_0x4ecd24(0x18e)][_0x4ecd24(0x1fb)][_0x4ecd24(0x179)]({'where':_0xd49ece,'skip':_0x4d7432,'take':_0xf2479b,'orderBy':{'createdAt':_0x4ecd24(0x1af)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x4ecd24(0x1fb)]['count']({'where':_0xd49ece})]);return{'users':_0x248056[_0x4ecd24(0x21f)](_0x2ba13e=>({'id':_0x2ba13e['id'],'fullName':_0x2ba13e[_0x4ecd24(0x1e4)],'username':_0x2ba13e[_0x4ecd24(0x1e1)],'telegramId':_0x2ba13e['telegram'],'merchantUrl':_0x2ba13e[_0x4ecd24(0x19a)],'gateways':_0x2ba13e[_0x4ecd24(0x235)]?JSON['parse'](_0x2ba13e[_0x4ecd24(0x235)]):null,'gatewaySettings':_0x2ba13e[_0x4ecd24(0x24b)]?JSON[_0x4ecd24(0x233)](_0x2ba13e['gatewaySettings']):null,'publicKey':_0x2ba13e[_0x4ecd24(0x244)],'wallets':{'usdtPolygonWallet':_0x2ba13e['usdtPolygonWallet'],'usdtTrcWallet':_0x2ba13e[_0x4ecd24(0x1a4)],'usdtErcWallet':_0x2ba13e[_0x4ecd24(0x1a1)],'usdcPolygonWallet':_0x2ba13e[_0x4ecd24(0x17f)]},'status':_0x2ba13e['status'],'createdAt':_0x2ba13e[_0x4ecd24(0x1e8)]})),'pagination':{'page':_0x127b7c,'limit':_0xf2479b,'total':_0x421318,'totalPages':Math['ceil'](_0x421318/_0xf2479b)}};}async[a33_0x3a6531(0x222)](_0xa4fe0c){const _0x3795b5=a33_0x3a6531,_0x32cc1a=await database_1[_0x3795b5(0x18e)][_0x3795b5(0x1fb)][_0x3795b5(0x23f)]({'where':{'id':_0xa4fe0c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x32cc1a)return null;return{'id':_0x32cc1a['id'],'fullName':_0x32cc1a['name'],'username':_0x32cc1a['username'],'telegramId':_0x32cc1a[_0x3795b5(0x207)],'merchantUrl':_0x32cc1a['shopUrl'],'gateways':_0x32cc1a['paymentGateways']?JSON[_0x3795b5(0x233)](_0x32cc1a[_0x3795b5(0x235)]):null,'gatewaySettings':_0x32cc1a[_0x3795b5(0x24b)]?JSON[_0x3795b5(0x233)](_0x32cc1a[_0x3795b5(0x24b)]):null,'publicKey':_0x32cc1a[_0x3795b5(0x244)],'wallets':{'usdtPolygonWallet':_0x32cc1a['usdtPolygonWallet'],'usdtTrcWallet':_0x32cc1a[_0x3795b5(0x1a4)],'usdtErcWallet':_0x32cc1a[_0x3795b5(0x1a1)],'usdcPolygonWallet':_0x32cc1a[_0x3795b5(0x17f)]},'status':_0x32cc1a[_0x3795b5(0x183)],'createdAt':_0x32cc1a[_0x3795b5(0x1e8)]};}async[a33_0x3a6531(0x205)](_0x5b313e){const _0x5d0077=a33_0x3a6531,{fullName:_0x41e286,username:_0x57e110,password:_0x5dd77d,telegramId:_0x5c2c70,merchantUrl:_0x3ed201,gateways:_0x3ccd83,gatewaySettings:_0x270c74,wallets:_0x1ddbcc}=_0x5b313e,_0x492edd=await database_1[_0x5d0077(0x18e)][_0x5d0077(0x1fb)][_0x5d0077(0x23f)]({'where':{'username':_0x57e110}});if(_0x492edd)throw new Error(_0x5d0077(0x18c));if(_0x5c2c70){const _0x2621f6=await database_1[_0x5d0077(0x18e)][_0x5d0077(0x1fb)][_0x5d0077(0x23f)]({'where':{'telegram':_0x5c2c70}});if(_0x2621f6)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x578a10=await bcryptjs_1[_0x5d0077(0x18e)]['hash'](_0x5dd77d,0xc),_0x1a30e1=_0x5d0077(0x1a6)+crypto_1[_0x5d0077(0x18e)]['randomBytes'](0x20)['toString'](_0x5d0077(0x1bf)),_0x1fee97='sk_'+crypto_1[_0x5d0077(0x18e)][_0x5d0077(0x1d6)](0x20)[_0x5d0077(0x210)](_0x5d0077(0x1bf)),_0x262e74=await database_1[_0x5d0077(0x18e)][_0x5d0077(0x1fb)][_0x5d0077(0x208)]({'data':{'name':_0x41e286,'username':_0x57e110,'password':_0x578a10,'telegram':_0x5c2c70,'shopUrl':_0x3ed201,'paymentGateways':_0x3ccd83?JSON[_0x5d0077(0x23a)](_0x3ccd83):null,'gatewaySettings':_0x270c74?JSON[_0x5d0077(0x23a)](_0x270c74):null,'usdtPolygonWallet':_0x1ddbcc?.[_0x5d0077(0x218)]||null,'usdtTrcWallet':_0x1ddbcc?.[_0x5d0077(0x1a4)]||null,'usdtErcWallet':_0x1ddbcc?.[_0x5d0077(0x1a1)]||null,'usdcPolygonWallet':_0x1ddbcc?.[_0x5d0077(0x17f)]||null,'publicKey':_0x1a30e1,'secretKey':_0x1fee97,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x262e74['id'],'fullName':_0x262e74[_0x5d0077(0x1e4)],'username':_0x262e74[_0x5d0077(0x1e1)],'telegramId':_0x262e74[_0x5d0077(0x207)],'merchantUrl':_0x262e74[_0x5d0077(0x19a)],'gateways':_0x262e74[_0x5d0077(0x235)]?JSON['parse'](_0x262e74[_0x5d0077(0x235)]):null,'gatewaySettings':_0x262e74[_0x5d0077(0x24b)]?JSON[_0x5d0077(0x233)](_0x262e74[_0x5d0077(0x24b)]):null,'publicKey':_0x262e74[_0x5d0077(0x244)],'wallets':{'usdtPolygonWallet':_0x262e74[_0x5d0077(0x218)],'usdtTrcWallet':_0x262e74['usdtTrcWallet'],'usdtErcWallet':_0x262e74[_0x5d0077(0x1a1)],'usdcPolygonWallet':_0x262e74[_0x5d0077(0x17f)]},'status':_0x262e74[_0x5d0077(0x183)],'createdAt':_0x262e74[_0x5d0077(0x1e8)]};}async[a33_0x3a6531(0x1fd)](_0x50a78f,_0x393941){const _0x111a40=a33_0x3a6531,_0x545bab={..._0x393941};_0x393941[_0x111a40(0x1dc)]&&(_0x545bab[_0x111a40(0x1dc)]=await bcryptjs_1[_0x111a40(0x18e)][_0x111a40(0x21d)](_0x393941['password'],0xc));_0x393941[_0x111a40(0x1ab)]&&(_0x545bab[_0x111a40(0x1e4)]=_0x393941[_0x111a40(0x1ab)],delete _0x545bab[_0x111a40(0x1ab)]);_0x393941[_0x111a40(0x1f9)]&&(_0x545bab[_0x111a40(0x207)]=_0x393941[_0x111a40(0x1f9)],delete _0x545bab[_0x111a40(0x1f9)]);_0x393941[_0x111a40(0x1c8)]&&(_0x545bab[_0x111a40(0x19a)]=_0x393941[_0x111a40(0x1c8)],delete _0x545bab['merchantUrl']);_0x393941['gateways']&&(_0x545bab['paymentGateways']=JSON['stringify'](_0x393941[_0x111a40(0x242)]),delete _0x545bab[_0x111a40(0x242)]);_0x393941[_0x111a40(0x24b)]&&(_0x545bab[_0x111a40(0x24b)]=JSON[_0x111a40(0x23a)](_0x393941[_0x111a40(0x24b)]),delete _0x545bab[_0x111a40(0x24b)]);_0x393941[_0x111a40(0x1ba)]&&(_0x393941[_0x111a40(0x1ba)][_0x111a40(0x218)]!==undefined&&(_0x545bab['usdtPolygonWallet']=_0x393941[_0x111a40(0x1ba)][_0x111a40(0x218)]||null),_0x393941['wallets'][_0x111a40(0x1a4)]!==undefined&&(_0x545bab[_0x111a40(0x1a4)]=_0x393941['wallets'][_0x111a40(0x1a4)]||null),_0x393941[_0x111a40(0x1ba)][_0x111a40(0x1a1)]!==undefined&&(_0x545bab['usdtErcWallet']=_0x393941[_0x111a40(0x1ba)][_0x111a40(0x1a1)]||null),_0x393941[_0x111a40(0x1ba)]['usdcPolygonWallet']!==undefined&&(_0x545bab['usdcPolygonWallet']=_0x393941['wallets'][_0x111a40(0x17f)]||null),delete _0x545bab[_0x111a40(0x1ba)]);const _0x203ae0=await database_1[_0x111a40(0x18e)][_0x111a40(0x1fb)][_0x111a40(0x1b3)]({'where':{'id':_0x50a78f},'data':_0x545bab,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x203ae0['id'],'fullName':_0x203ae0[_0x111a40(0x1e4)],'username':_0x203ae0[_0x111a40(0x1e1)],'telegramId':_0x203ae0[_0x111a40(0x207)],'merchantUrl':_0x203ae0['shopUrl'],'gateways':_0x203ae0[_0x111a40(0x235)]?JSON['parse'](_0x203ae0['paymentGateways']):null,'gatewaySettings':_0x203ae0[_0x111a40(0x24b)]?JSON[_0x111a40(0x233)](_0x203ae0[_0x111a40(0x24b)]):null,'publicKey':_0x203ae0[_0x111a40(0x244)],'wallets':{'usdtPolygonWallet':_0x203ae0[_0x111a40(0x218)],'usdtTrcWallet':_0x203ae0['usdtTrcWallet'],'usdtErcWallet':_0x203ae0[_0x111a40(0x1a1)],'usdcPolygonWallet':_0x203ae0[_0x111a40(0x17f)]},'status':_0x203ae0[_0x111a40(0x183)],'createdAt':_0x203ae0[_0x111a40(0x1e8)]};}async[a33_0x3a6531(0x20a)](_0x1ce114){const _0x37fa1c=a33_0x3a6531;await database_1[_0x37fa1c(0x18e)][_0x37fa1c(0x1fb)]['delete']({'where':{'id':_0x1ce114}});}async[a33_0x3a6531(0x1bd)](_0xaefa51){const _0xb36acf=a33_0x3a6531,_0x32b563=await database_1[_0xb36acf(0x18e)][_0xb36acf(0x1fb)][_0xb36acf(0x1b3)]({'where':{'id':_0xaefa51},'data':{'status':_0xb36acf(0x23d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x32b563['id'],'fullName':_0x32b563[_0xb36acf(0x1e4)],'username':_0x32b563['username'],'telegramId':_0x32b563[_0xb36acf(0x207)],'merchantUrl':_0x32b563[_0xb36acf(0x19a)],'gateways':_0x32b563[_0xb36acf(0x235)]?JSON[_0xb36acf(0x233)](_0x32b563[_0xb36acf(0x235)]):null,'gatewaySettings':_0x32b563[_0xb36acf(0x24b)]?JSON[_0xb36acf(0x233)](_0x32b563[_0xb36acf(0x24b)]):null,'publicKey':_0x32b563['publicKey'],'wallets':{'usdtPolygonWallet':_0x32b563[_0xb36acf(0x218)],'usdtTrcWallet':_0x32b563[_0xb36acf(0x1a4)],'usdtErcWallet':_0x32b563['usdtErcWallet'],'usdcPolygonWallet':_0x32b563[_0xb36acf(0x17f)]},'status':_0x32b563[_0xb36acf(0x183)],'createdAt':_0x32b563[_0xb36acf(0x1e8)]};}async['activateUser'](_0x1c50fc){const _0x6bc4d0=a33_0x3a6531,_0x32ea61=await database_1[_0x6bc4d0(0x18e)][_0x6bc4d0(0x1fb)][_0x6bc4d0(0x1b3)]({'where':{'id':_0x1c50fc},'data':{'status':_0x6bc4d0(0x182)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x32ea61['id'],'fullName':_0x32ea61[_0x6bc4d0(0x1e4)],'username':_0x32ea61[_0x6bc4d0(0x1e1)],'telegramId':_0x32ea61['telegram'],'merchantUrl':_0x32ea61['shopUrl'],'gateways':_0x32ea61[_0x6bc4d0(0x235)]?JSON[_0x6bc4d0(0x233)](_0x32ea61[_0x6bc4d0(0x235)]):null,'gatewaySettings':_0x32ea61[_0x6bc4d0(0x24b)]?JSON[_0x6bc4d0(0x233)](_0x32ea61[_0x6bc4d0(0x24b)]):null,'publicKey':_0x32ea61[_0x6bc4d0(0x244)],'wallets':{'usdtPolygonWallet':_0x32ea61['usdtPolygonWallet'],'usdtTrcWallet':_0x32ea61[_0x6bc4d0(0x1a4)],'usdtErcWallet':_0x32ea61[_0x6bc4d0(0x1a1)],'usdcPolygonWallet':_0x32ea61['usdcPolygonWallet']},'status':_0x32ea61[_0x6bc4d0(0x183)],'createdAt':_0x32ea61['createdAt']};}async['calculateTotalRevenue'](_0x3ca67f){const _0x29e7ad=a33_0x3a6531,_0x374883=await database_1['default'][_0x29e7ad(0x1a7)][_0x29e7ad(0x179)]({'where':{'status':_0x29e7ad(0x187),'createdAt':{'gte':_0x3ca67f}},'select':{'amount':!![],'currency':!![]}});let _0x4a1b26=0x0;for(const _0x1bcc7d of _0x374883){const _0x1e1a2d=await currencyService_1[_0x29e7ad(0x212)][_0x29e7ad(0x1d9)](_0x1bcc7d[_0x29e7ad(0x1ac)],_0x1bcc7d['currency']);_0x4a1b26+=_0x1e1a2d;}return _0x4a1b26;}async['calculateTotalPayouts'](_0x2b4a49){const _0x278aa1=a33_0x3a6531,_0x16e5ab=await database_1[_0x278aa1(0x18e)]['payout'][_0x278aa1(0x21e)]({'where':{'createdAt':{'gte':_0x2b4a49}},'_sum':{'amount':!![]}});return _0x16e5ab['_sum'][_0x278aa1(0x1ac)]||0x0;}async[a33_0x3a6531(0x231)](){const _0x519da3=a33_0x3a6531,_0x1b6abc=await database_1[_0x519da3(0x18e)]['payout'][_0x519da3(0x21e)]({'_sum':{'amount':!![]}});return _0x1b6abc[_0x519da3(0x1d7)]['amount']||0x0;}async[a33_0x3a6531(0x191)](){const _0x43f9bd=a33_0x3a6531,_0x3716af=await database_1[_0x43f9bd(0x18e)][_0x43f9bd(0x21a)]['aggregate']({'where':{'status':'COMPLETED'},'_sum':{'amount':!![]}});return _0x3716af['_sum']['amount']||0x0;}}exports['AdminService']=AdminService;