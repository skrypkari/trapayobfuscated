'use strict';const a35_0x5bc81f=a35_0x5ba4;(function(_0x4a2536,_0x420fba){const _0x181f80=a35_0x5ba4,_0xe04351=_0x4a2536();while(!![]){try{const _0x281c53=parseInt(_0x181f80(0x225))/0x1*(-parseInt(_0x181f80(0x259))/0x2)+-parseInt(_0x181f80(0x1d8))/0x3+-parseInt(_0x181f80(0x235))/0x4*(-parseInt(_0x181f80(0x268))/0x5)+-parseInt(_0x181f80(0x198))/0x6+-parseInt(_0x181f80(0x269))/0x7+-parseInt(_0x181f80(0x24e))/0x8+parseInt(_0x181f80(0x233))/0x9;if(_0x281c53===_0x420fba)break;else _0xe04351['push'](_0xe04351['shift']());}catch(_0x3f1265){_0xe04351['push'](_0xe04351['shift']());}}}(a35_0x3e4b,0xa68dd));var __importDefault=this&&this['__importDefault']||function(_0x3bd7c1){const _0x54227e=a35_0x5ba4;return _0x3bd7c1&&_0x3bd7c1[_0x54227e(0x194)]?_0x3bd7c1:{'default':_0x3bd7c1};};Object[a35_0x5bc81f(0x1e7)](exports,'__esModule',{'value':!![]}),exports[a35_0x5bc81f(0x22d)]=void 0x0;const database_1=__importDefault(require(a35_0x5bc81f(0x1f4))),bcryptjs_1=__importDefault(require(a35_0x5bc81f(0x238))),crypto_1=__importDefault(require(a35_0x5bc81f(0x251))),currencyService_1=require(a35_0x5bc81f(0x1de)),gateway_1=require(a35_0x5bc81f(0x1d7));function a35_0x5ba4(_0x57a4c5,_0x14495c){const _0x3e4bd9=a35_0x3e4b();return a35_0x5ba4=function(_0x5ba4e9,_0x4c6501){_0x5ba4e9=_0x5ba4e9-0x185;let _0x4ac3a3=_0x3e4bd9[_0x5ba4e9];return _0x4ac3a3;},a35_0x5ba4(_0x57a4c5,_0x14495c);}class AdminService{async['getPayoutStats'](){const _0x130d84=a35_0x5bc81f;console[_0x130d84(0x1e8)]('📊\x20Calculating\x20payout\x20statistics...');const _0x1dfd8e=await database_1[_0x130d84(0x1be)][_0x130d84(0x25e)][_0x130d84(0x252)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x130d84(0x27e)}}),_0x5ee96b=new Date(),_0x3981b5=new Date(_0x5ee96b[_0x130d84(0x19e)](),_0x5ee96b[_0x130d84(0x200)](),0x1),_0x2e8709=new Date(_0x5ee96b[_0x130d84(0x19e)](),_0x5ee96b[_0x130d84(0x200)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1d4d94=await database_1[_0x130d84(0x1be)]['payout'][_0x130d84(0x252)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3981b5,'lte':_0x2e8709},'status':_0x130d84(0x260)}}),_0x176228=_0x1dfd8e[_0x130d84(0x1f3)][_0x130d84(0x26e)]||0x0,_0x1e80bb=_0x1dfd8e[_0x130d84(0x1f3)][_0x130d84(0x281)]||0x0,_0x5de27f=_0x1d4d94[_0x130d84(0x1f3)][_0x130d84(0x1fd)]||0x0,_0x421a05={'totalPayout':Math[_0x130d84(0x254)](_0x176228*0x64)/0x64,'awaitingPayout':Math[_0x130d84(0x254)](_0x1e80bb*0x64)/0x64,'thisMonth':Math['round'](_0x5de27f*0x64)/0x64,'availableBalance':Math[_0x130d84(0x254)](_0x1e80bb*0x64)/0x64};return console[_0x130d84(0x1e8)]('📊\x20Payout\x20statistics\x20calculated:'),console['log'](_0x130d84(0x1d4)+_0x421a05[_0x130d84(0x257)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x130d84(0x1e8)](_0x130d84(0x1e9)+_0x421a05['awaitingPayout']+_0x130d84(0x275)),console['log']('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x421a05['availableBalance']+_0x130d84(0x1fb)),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x421a05[_0x130d84(0x205)]+_0x130d84(0x1e1)),_0x421a05;}async[a35_0x5bc81f(0x220)](_0x3c832b,_0x2b8cbd){const _0x392166=a35_0x5bc81f;console[_0x392166(0x1e8)](_0x392166(0x25f)+_0x3c832b+':',_0x2b8cbd);const _0x47903f=await database_1[_0x392166(0x1be)][_0x392166(0x208)]['findUnique']({'where':{'id':_0x3c832b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x47903f)throw new Error(_0x392166(0x1ec));const _0x23776f={};_0x2b8cbd[_0x392166(0x282)]!==undefined&&(_0x23776f['customerCountry']=_0x2b8cbd[_0x392166(0x282)]||null);_0x2b8cbd[_0x392166(0x26a)]!==undefined&&(_0x23776f[_0x392166(0x26a)]=_0x2b8cbd[_0x392166(0x26a)]||null);_0x2b8cbd['customerUa']!==undefined&&(_0x23776f[_0x392166(0x28f)]=_0x2b8cbd[_0x392166(0x28f)]||null);const _0xe0f541=await database_1[_0x392166(0x1be)][_0x392166(0x208)]['update']({'where':{'id':_0x3c832b},'data':{..._0x23776f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x3c832b),console[_0x392166(0x1e8)]('\x20\x20\x20🌍\x20Country:\x20'+_0x47903f['customerCountry']+_0x392166(0x276)+_0xe0f541[_0x392166(0x282)]),console[_0x392166(0x1e8)](_0x392166(0x1c8)+_0x47903f[_0x392166(0x26a)]+_0x392166(0x276)+_0xe0f541['customerIp']),console[_0x392166(0x1e8)](_0x392166(0x283)+(_0x47903f[_0x392166(0x28f)]?_0x392166(0x28a):'not\x20set')+_0x392166(0x276)+(_0xe0f541[_0x392166(0x28f)]?_0x392166(0x28a):_0x392166(0x25c))),_0xe0f541;}async[a35_0x5bc81f(0x1cd)](_0x4459a7){const _0x5aafa6=a35_0x5bc81f,_0x1f92c8=new Date();let _0x1098e5;switch(_0x4459a7){case'7d':_0x1098e5=new Date(_0x1f92c8['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5aafa6(0x19a):_0x1098e5=new Date(_0x1f92c8[_0x5aafa6(0x1bf)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5aafa6(0x1a5):_0x1098e5=new Date(_0x1f92c8['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x5aafa6(0x199):const _0x4b0448=await database_1[_0x5aafa6(0x1be)]['payment'][_0x5aafa6(0x1c2)]({'where':{'gateway':{'not':_0x5aafa6(0x279)}},'orderBy':{'createdAt':_0x5aafa6(0x27d)},'select':{'createdAt':!![]}});_0x1098e5=_0x4b0448?_0x4b0448[_0x5aafa6(0x197)]:new Date(_0x5aafa6(0x21f)),console[_0x5aafa6(0x1e8)](_0x5aafa6(0x1c1)+_0x1098e5[_0x5aafa6(0x26b)]());break;default:_0x1098e5=new Date(_0x1f92c8[_0x5aafa6(0x1bf)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2325a4,_0x5f4814,_0x44b831,_0x8be07b,_0x55b97c,_0x1a95c2,_0x3cce1d]=await Promise[_0x5aafa6(0x199)]([database_1[_0x5aafa6(0x1be)][_0x5aafa6(0x25e)][_0x5aafa6(0x1d1)](),database_1[_0x5aafa6(0x1be)]['shop'][_0x5aafa6(0x1d1)]({'where':{'status':_0x5aafa6(0x27e)}}),database_1[_0x5aafa6(0x1be)][_0x5aafa6(0x208)]['count']({'where':{'createdAt':{'gte':_0x1098e5},'gateway':{'not':_0x5aafa6(0x279)}}}),database_1[_0x5aafa6(0x1be)][_0x5aafa6(0x208)]['count']({'where':{'status':_0x5aafa6(0x21e),'createdAt':{'gte':_0x1098e5},'gateway':{'not':_0x5aafa6(0x279)}}}),database_1['default'][_0x5aafa6(0x208)][_0x5aafa6(0x25d)]({'where':{'status':_0x5aafa6(0x21e),'createdAt':{'gte':_0x1098e5},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x5aafa6(0x1be)]['payment'][_0x5aafa6(0x25d)]({'where':{'gateway':{'not':_0x5aafa6(0x279)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x5aafa6(0x208)][_0x5aafa6(0x25d)]({'where':{'createdAt':{'gte':_0x1098e5},'gateway':{'not':_0x5aafa6(0x279)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x704054=0x0;for(const _0x2dd43e of _0x55b97c){const _0x1300ea=await currencyService_1['currencyService'][_0x5aafa6(0x23e)](_0x2dd43e[_0x5aafa6(0x1fd)],_0x2dd43e[_0x5aafa6(0x1b7)]);_0x704054+=_0x1300ea;}const _0x461226=this[_0x5aafa6(0x237)](_0x3cce1d,_0x1098e5,_0x1f92c8),_0x1fc8ee=_0x44b831>0x0?_0x8be07b/_0x44b831*0x64:0x0;return{'totalShops':_0x2325a4,'activeShops':_0x5f4814,'totalPayments':_0x44b831,'successfulPayments':_0x8be07b,'totalRevenue':Math[_0x5aafa6(0x254)](_0x704054*0x64)/0x64,'conversionRate':Math['round'](_0x1fc8ee*0x64)/0x64,'dailyRevenue':_0x461226[_0x5aafa6(0x1d0)],'dailyPayments':_0x461226['dailyPayments'],'recentPayments':_0x1a95c2[_0x5aafa6(0x20f)](_0x593d52=>({'id':_0x593d52['id'],'amount':_0x593d52[_0x5aafa6(0x1fd)],'currency':_0x593d52[_0x5aafa6(0x1b7)],'status':_0x593d52['status'],'gateway':_0x593d52['gateway'],'shop':_0x593d52[_0x5aafa6(0x25e)],'createdAt':_0x593d52[_0x5aafa6(0x197)]}))};}async['getMerchantStatistics'](_0x359536){const _0x408ad8=a35_0x5bc81f;console[_0x408ad8(0x1e8)](_0x408ad8(0x228),_0x359536);let _0x5d83c1,_0x3a28dc=new Date();if(_0x359536[_0x408ad8(0x258)]===_0x408ad8(0x1d9)&&_0x359536[_0x408ad8(0x188)]&&_0x359536[_0x408ad8(0x1c7)])_0x5d83c1=new Date(_0x359536[_0x408ad8(0x188)]),_0x3a28dc=new Date(_0x359536['dateTo']);else{const _0xc815b3=new Date();switch(_0x359536['period']){case'week':_0x5d83c1=new Date(_0xc815b3[_0x408ad8(0x1bf)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x408ad8(0x22a):_0x5d83c1=new Date(_0xc815b3['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x408ad8(0x1b9):_0x5d83c1=new Date(_0xc815b3[_0x408ad8(0x1bf)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x408ad8(0x199):default:_0x5d83c1=new Date('2020-01-01');break;}}console[_0x408ad8(0x1e8)](_0x408ad8(0x201)+_0x5d83c1[_0x408ad8(0x26b)]()+'\x20to\x20'+_0x3a28dc['toISOString']());const _0x5d3d36={'status':_0x408ad8(0x21e),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x5d83c1,'lte':_0x3a28dc}};_0x359536[_0x408ad8(0x229)]&&(_0x5d3d36['shopId']=_0x359536[_0x408ad8(0x229)]);const _0x31284d=await database_1[_0x408ad8(0x1be)]['payment']['findMany']({'where':_0x5d3d36,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x408ad8(0x1e8)](_0x408ad8(0x249)+_0x31284d[_0x408ad8(0x1f8)]+'\x20paid\x20payments\x20for\x20analysis');const _0x4d4c81={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x5d83c1,'lte':_0x3a28dc}};_0x359536['shopId']&&(_0x4d4c81[_0x408ad8(0x229)]=_0x359536[_0x408ad8(0x229)]);const _0x2af48c=await database_1[_0x408ad8(0x1be)][_0x408ad8(0x208)]['count']({'where':_0x4d4c81});console[_0x408ad8(0x1e8)](_0x408ad8(0x1ea)+_0x2af48c+',\x20successful:\x20'+_0x31284d[_0x408ad8(0x1f8)]);let _0x43f45e=0x0,_0x18baa0=0x0,_0x4da4eb=0x0;const _0x47af81={},_0x3fb824={},_0x1b53ac={};for(const _0x14e363 of _0x31284d){try{const _0x362903=await currencyService_1[_0x408ad8(0x18f)][_0x408ad8(0x23e)](_0x14e363[_0x408ad8(0x1fd)],_0x14e363['currency']);let _0xf872d3={};if(_0x14e363['shop'][_0x408ad8(0x289)])try{_0xf872d3=JSON[_0x408ad8(0x1e5)](_0x14e363['shop']['gatewaySettings']);}catch(_0x167dfb){console[_0x408ad8(0x227)](_0x408ad8(0x210)+_0x14e363[_0x408ad8(0x229)]+':',_0x167dfb);}let _0x50cf17={},_0x34c814=0xa;for(const [_0x5e0010,_0x5bb315]of Object[_0x408ad8(0x226)](_0xf872d3)){if(_0x5e0010[_0x408ad8(0x270)]()===_0x14e363[_0x408ad8(0x23d)][_0x408ad8(0x270)]()){_0x50cf17=_0x5bb315,_0x34c814=_0x5bb315['commission']||0xa;break;}}const _0x3292ff=_0x362903*(_0x34c814/0x64),_0x735824=_0x362903-_0x3292ff;_0x43f45e+=_0x362903,_0x18baa0+=_0x735824,_0x4da4eb+=_0x3292ff;!_0x47af81[_0x14e363[_0x408ad8(0x23d)]]&&(_0x47af81[_0x14e363[_0x408ad8(0x23d)]]={'gateway':_0x14e363['gateway'],'gatewayDisplayName':this[_0x408ad8(0x211)](_0x14e363['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x47af81[_0x14e363[_0x408ad8(0x23d)]][_0x408ad8(0x1f7)]++,_0x47af81[_0x14e363['gateway']]['turnoverUSDT']+=_0x362903,_0x47af81[_0x14e363[_0x408ad8(0x23d)]][_0x408ad8(0x26c)]+=_0x3292ff,_0x47af81[_0x14e363[_0x408ad8(0x23d)]][_0x408ad8(0x1a3)]+=_0x735824,_0x47af81[_0x14e363[_0x408ad8(0x23d)]][_0x408ad8(0x1c3)]+=_0x34c814;!_0x359536[_0x408ad8(0x229)]&&(!_0x3fb824[_0x14e363['shopId']]&&(_0x3fb824[_0x14e363[_0x408ad8(0x229)]]={'shopId':_0x14e363['shopId'],'shopName':_0x14e363['shop'][_0x408ad8(0x22f)],'shopUsername':_0x14e363[_0x408ad8(0x25e)][_0x408ad8(0x224)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3fb824[_0x14e363['shopId']][_0x408ad8(0x1f7)]++,_0x3fb824[_0x14e363['shopId']]['turnoverUSDT']+=_0x362903,_0x3fb824[_0x14e363[_0x408ad8(0x229)]][_0x408ad8(0x26c)]+=_0x3292ff,_0x3fb824[_0x14e363['shopId']][_0x408ad8(0x1a3)]+=_0x735824);const _0x52f671=_0x14e363[_0x408ad8(0x246)][_0x408ad8(0x26b)]()['split']('T')[0x0];!_0x1b53ac[_0x52f671]&&(_0x1b53ac[_0x52f671]={'date':_0x52f671,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1b53ac[_0x52f671][_0x408ad8(0x24f)]+=_0x362903,_0x1b53ac[_0x52f671]['merchantEarnings']+=_0x735824,_0x1b53ac[_0x52f671]['gatewayEarnings']+=_0x3292ff,_0x1b53ac[_0x52f671][_0x408ad8(0x1f7)]++;}catch(_0xda669b){console[_0x408ad8(0x227)](_0x408ad8(0x25b)+_0x14e363['id']+':',_0xda669b);}}Object['values'](_0x47af81)['forEach'](_0x515a79=>{const _0x18862c=_0x408ad8;_0x515a79[_0x18862c(0x212)]=_0x515a79['paymentsCount']>0x0?_0x515a79[_0x18862c(0x1c3)]/_0x515a79['paymentsCount']:0x0,delete _0x515a79[_0x18862c(0x1c3)];}),Object[_0x408ad8(0x1c9)](_0x3fb824)[_0x408ad8(0x223)](_0x80b0bf=>{const _0x32867b=_0x408ad8;_0x80b0bf['averageCheckUSDT']=_0x80b0bf[_0x32867b(0x1f7)]>0x0?_0x80b0bf[_0x32867b(0x1e4)]/_0x80b0bf['paymentsCount']:0x0;});let _0x4f6365=0x0;if(_0x359536[_0x408ad8(0x229)]){const _0x40cc46=await database_1[_0x408ad8(0x1be)][_0x408ad8(0x1cf)][_0x408ad8(0x25d)]({'where':{'shopId':_0x359536[_0x408ad8(0x229)],'status':_0x408ad8(0x260),'createdAt':{'gte':_0x5d83c1,'lte':_0x3a28dc}},'select':{'amount':!![]}});_0x4f6365=_0x40cc46[_0x408ad8(0x207)]((_0x34f2b3,_0xc36998)=>_0x34f2b3+_0xc36998[_0x408ad8(0x1fd)],0x0);}const _0x56a5a5=_0x2af48c,_0x2ab510=_0x31284d[_0x408ad8(0x1f8)],_0x1f7860=_0x2ab510>0x0?_0x43f45e/_0x2ab510:0x0,_0x59688e=_0x56a5a5>0x0?Math['round'](_0x2ab510/_0x56a5a5*0x2710)/0x64:0x0,_0x495ee3=Math[_0x408ad8(0x288)]((_0x3a28dc['getTime']()-_0x5d83c1[_0x408ad8(0x1bf)]())/(0x3e8*0x3c*0x3c*0x18)),_0x772d93={'totalTurnover':Math[_0x408ad8(0x254)](_0x43f45e*0x64)/0x64,'merchantEarnings':Math['round'](_0x18baa0*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4da4eb*0x64)/0x64,'totalPaidOut':Math[_0x408ad8(0x254)](_0x4f6365*0x64)/0x64,'averageCheck':Math[_0x408ad8(0x254)](_0x1f7860*0x64)/0x64,'totalPayments':_0x56a5a5,'successfulPayments':_0x2ab510,'conversionRate':_0x59688e,'gatewayBreakdown':Object[_0x408ad8(0x1c9)](_0x47af81)[_0x408ad8(0x20f)](_0x2bd436=>({..._0x2bd436,'turnoverUSDT':Math[_0x408ad8(0x254)](_0x2bd436[_0x408ad8(0x1e4)]*0x64)/0x64,'commissionUSDT':Math[_0x408ad8(0x254)](_0x2bd436[_0x408ad8(0x26c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x408ad8(0x254)](_0x2bd436['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x2bd436[_0x408ad8(0x212)]*0x64)/0x64})),'merchantBreakdown':_0x359536[_0x408ad8(0x229)]?undefined:Object['values'](_0x3fb824)['map'](_0x308662=>({..._0x308662,'turnoverUSDT':Math[_0x408ad8(0x254)](_0x308662[_0x408ad8(0x1e4)]*0x64)/0x64,'commissionUSDT':Math[_0x408ad8(0x254)](_0x308662[_0x408ad8(0x26c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x408ad8(0x254)](_0x308662[_0x408ad8(0x1a3)]*0x64)/0x64,'paidOutUSDT':Math[_0x408ad8(0x254)](_0x308662[_0x408ad8(0x213)]*0x64)/0x64,'averageCheckUSDT':Math[_0x408ad8(0x254)](_0x308662['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x1b53ac)[_0x408ad8(0x20f)](_0x1dfc9c=>({..._0x1dfc9c,'turnover':Math[_0x408ad8(0x254)](_0x1dfc9c[_0x408ad8(0x24f)]*0x64)/0x64,'merchantEarnings':Math[_0x408ad8(0x254)](_0x1dfc9c[_0x408ad8(0x1dc)]*0x64)/0x64,'gatewayEarnings':Math[_0x408ad8(0x254)](_0x1dfc9c[_0x408ad8(0x27c)]*0x64)/0x64}))[_0x408ad8(0x1cc)]((_0x26d0ff,_0x3cdfb8)=>_0x26d0ff['date'][_0x408ad8(0x24c)](_0x3cdfb8[_0x408ad8(0x18d)])),'periodInfo':{'from':_0x5d83c1,'to':_0x3a28dc,'periodType':_0x359536[_0x408ad8(0x258)]||_0x408ad8(0x1d9),'daysCount':_0x495ee3}};return console['log'](_0x408ad8(0x190)),console[_0x408ad8(0x1e8)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x772d93[_0x408ad8(0x1d2)]+_0x408ad8(0x1e1)),console[_0x408ad8(0x1e8)](_0x408ad8(0x21b)+_0x772d93[_0x408ad8(0x1dc)]+_0x408ad8(0x1e1)),console[_0x408ad8(0x1e8)](_0x408ad8(0x191)+_0x772d93[_0x408ad8(0x27c)]+_0x408ad8(0x1e1)),console[_0x408ad8(0x1e8)](_0x408ad8(0x23c)+_0x772d93[_0x408ad8(0x221)]),_0x772d93;}async[a35_0x5bc81f(0x1bd)](){const _0x5c3eb0=a35_0x5bc81f;console[_0x5c3eb0(0x1e8)](_0x5c3eb0(0x255));const _0x55b507=await database_1[_0x5c3eb0(0x1be)][_0x5c3eb0(0x25e)]['findMany']({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x5c3eb0(0x1e8)](_0x5c3eb0(0x27b)+_0x55b507[_0x5c3eb0(0x1f8)]+_0x5c3eb0(0x244)),_0x55b507[_0x5c3eb0(0x20f)](_0x78bf0b=>({'id':_0x78bf0b['id'],'username':_0x78bf0b[_0x5c3eb0(0x224)],'name':_0x78bf0b[_0x5c3eb0(0x22f)]}));}[a35_0x5bc81f(0x211)](_0x3f8735){const _0x12ffcd=a35_0x5bc81f,_0x3d9b64={'test_gateway':_0x12ffcd(0x23f),'plisio':'Plisio','rapyd':_0x12ffcd(0x1e0),'noda':_0x12ffcd(0x261),'cointopay':_0x12ffcd(0x250),'klyme_eu':_0x12ffcd(0x1ba),'klyme_gb':'KLYME\x20GB','klyme_de':_0x12ffcd(0x1a2)};return _0x3d9b64[_0x3f8735]||_0x3f8735;}async[a35_0x5bc81f(0x1ee)](_0x2f3481){const _0x306581=a35_0x5bc81f,{page:_0x3fede6,limit:_0x533a66,minAmount:_0x20fd72,search:_0x132783}=_0x2f3481,_0x2def57=(_0x3fede6-0x1)*_0x533a66;console[_0x306581(0x1e8)](_0x306581(0x1c6),_0x2f3481);const _0x351624={'balance':{'gt':0x0},'status':_0x306581(0x27e)};_0x20fd72&&(_0x351624[_0x306581(0x281)][_0x306581(0x24a)]=_0x20fd72);_0x132783&&(_0x351624['OR']=[{'name':{'contains':_0x132783,'mode':_0x306581(0x1db)}},{'username':{'contains':_0x132783,'mode':'insensitive'}}]);const [_0x1a6af6,_0x2c42b7]=await Promise[_0x306581(0x199)]([database_1[_0x306581(0x1be)]['shop'][_0x306581(0x25d)]({'where':_0x351624,'skip':_0x2def57,'take':_0x533a66,'orderBy':{'balance':_0x306581(0x1e3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x306581(0x1be)]['shop']['count']({'where':_0x351624})]);console[_0x306581(0x1e8)](_0x306581(0x249)+_0x1a6af6[_0x306581(0x1f8)]+_0x306581(0x232));const _0x5ad39b=await Promise[_0x306581(0x199)](_0x1a6af6[_0x306581(0x20f)](async _0x10a63d=>{const _0x448747=_0x306581,[_0x5d070a,_0x61bd52,_0x485359]=await Promise['all']([database_1[_0x448747(0x1be)][_0x448747(0x208)][_0x448747(0x1d1)]({'where':{'shopId':_0x10a63d['id'],'status':_0x448747(0x21e),'amountUSDT':{'not':null}}}),database_1[_0x448747(0x1be)][_0x448747(0x208)][_0x448747(0x1c2)]({'where':{'shopId':_0x10a63d['id'],'status':_0x448747(0x21e),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x448747(0x27d)},'select':{'paidAt':!![]}}),database_1[_0x448747(0x1be)][_0x448747(0x208)][_0x448747(0x209)]({'by':['gateway'],'where':{'shopId':_0x10a63d['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2c95fb=await Promise['all'](_0x485359[_0x448747(0x20f)](async _0x8f5d5a=>{const _0x4c91f6=_0x448747;let _0x5d6d3d=0xa;if(_0x10a63d['gatewaySettings'])try{const _0x1623d0=JSON[_0x4c91f6(0x1e5)](_0x10a63d['gatewaySettings']);for(const [_0x301949,_0x2ecda3]of Object[_0x4c91f6(0x226)](_0x1623d0)){if(_0x301949[_0x4c91f6(0x270)]()===_0x8f5d5a[_0x4c91f6(0x23d)][_0x4c91f6(0x270)]()){_0x5d6d3d=_0x2ecda3['commission']||0xa,console['log']('💰\x20[PAYOUT]\x20Gateway\x20'+_0x8f5d5a[_0x4c91f6(0x23d)]+_0x4c91f6(0x1f9)+_0x10a63d['id']+_0x4c91f6(0x27a)+_0x5d6d3d+'%');break;}}}catch(_0x5a85ea){console[_0x4c91f6(0x227)](_0x4c91f6(0x210)+_0x10a63d['id']+':',_0x5a85ea);}const _0x48ed69=_0x8f5d5a[_0x4c91f6(0x1f3)][_0x4c91f6(0x1a0)]||0x0,_0x1a588d=_0x48ed69*(0x1-_0x5d6d3d/0x64);return{'gateway':_0x8f5d5a[_0x4c91f6(0x23d)],'count':_0x8f5d5a[_0x4c91f6(0x263)]['id'],'amountUSDT':Math[_0x4c91f6(0x254)](_0x48ed69*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4c91f6(0x254)](_0x1a588d*0x64)/0x64,'commission':_0x5d6d3d};})),_0x445469=_0x2c95fb['reduce']((_0x38c9bf,_0x4d1164)=>_0x38c9bf+_0x4d1164[_0x448747(0x1a0)],0x0),_0x6567aa=_0x2c95fb['reduce']((_0x102c3a,_0x2a09e5)=>_0x102c3a+_0x2a09e5[_0x448747(0x222)],0x0);return{'id':_0x10a63d['id'],'fullName':_0x10a63d[_0x448747(0x22f)],'username':_0x10a63d[_0x448747(0x224)],'telegramId':_0x10a63d[_0x448747(0x21c)],'merchantUrl':_0x10a63d['shopUrl'],'wallets':{'usdtPolygonWallet':_0x10a63d[_0x448747(0x19b)],'usdtTrcWallet':_0x10a63d['usdtTrcWallet'],'usdtErcWallet':_0x10a63d['usdtErcWallet'],'usdcPolygonWallet':_0x10a63d[_0x448747(0x193)]},'totalAmountUSDT':Math['round'](_0x445469*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x448747(0x254)](_0x6567aa*0x64)/0x64,'paymentsCount':_0x5d070a,'oldestPaymentDate':_0x61bd52?.['paidAt']||_0x10a63d[_0x448747(0x197)],'gatewayBreakdown':_0x2c95fb};})),_0x40b4ba=_0x5ad39b[_0x306581(0x207)]((_0x762cc7,_0x4b5886)=>_0x762cc7+_0x4b5886[_0x306581(0x1ab)],0x0),_0x3570fe=_0x5ad39b['reduce']((_0x22addc,_0x187ff9)=>_0x22addc+_0x187ff9[_0x306581(0x25a)],0x0);return console[_0x306581(0x1e8)](_0x306581(0x1bc)+_0x2c42b7+_0x306581(0x278)+Math[_0x306581(0x254)](_0x3570fe*0x64)/0x64+_0x306581(0x1da)),{'merchants':_0x5ad39b,'pagination':{'page':_0x3fede6,'limit':_0x533a66,'total':_0x2c42b7,'totalPages':Math[_0x306581(0x288)](_0x2c42b7/_0x533a66)},'summary':{'totalMerchants':_0x2c42b7,'totalAmountUSDT':Math[_0x306581(0x254)](_0x40b4ba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3570fe*0x64)/0x64}};}async[a35_0x5bc81f(0x21a)](_0x3619d6){const _0xc04ea8=a35_0x5bc81f,{shopId:_0x5d895f,amount:_0x1f9d73,network:_0x26862f,wallet:_0x3fb6a1,notes:_0x34004a,txid:_0x241b0d,periodFrom:_0x5a1510,periodTo:_0x26fad4}=_0x3619d6,_0x4dbde2=await database_1[_0xc04ea8(0x1be)][_0xc04ea8(0x274)](async _0x26de41=>{const _0x4b58aa=_0xc04ea8,_0x544fd5=await _0x26de41[_0x4b58aa(0x25e)][_0x4b58aa(0x231)]({'where':{'id':_0x5d895f},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x544fd5)throw new Error(_0x4b58aa(0x1a4));console[_0x4b58aa(0x1e8)](_0x4b58aa(0x1f5)+_0x544fd5[_0x4b58aa(0x224)]+':'),console[_0x4b58aa(0x1e8)](_0x4b58aa(0x20b)+_0x544fd5[_0x4b58aa(0x281)][_0x4b58aa(0x1df)](0x6)+_0x4b58aa(0x1e1)),console[_0x4b58aa(0x1e8)]('\x20\x20\x20Payout\x20amount:\x20'+_0x1f9d73[_0x4b58aa(0x1df)](0x6)+_0x4b58aa(0x1e1)),console[_0x4b58aa(0x1e8)](_0x4b58aa(0x1fe)+_0x544fd5[_0x4b58aa(0x26e)][_0x4b58aa(0x1df)](0x6)+'\x20USDT');if(_0x241b0d)console[_0x4b58aa(0x1e8)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x241b0d);if(_0x544fd5[_0x4b58aa(0x281)]<_0x1f9d73)throw new Error(_0x4b58aa(0x1ad)+_0x544fd5[_0x4b58aa(0x281)][_0x4b58aa(0x1df)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x1f9d73['toFixed'](0x6)+_0x4b58aa(0x1e1));let _0x424940=_0x3fb6a1;if(!_0x424940){const _0x38335f=await _0x26de41['shop'][_0x4b58aa(0x231)]({'where':{'id':_0x5d895f},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x38335f)switch(_0x26862f){case'polygon':_0x424940=_0x38335f[_0x4b58aa(0x19b)]||undefined;break;case'trc20':_0x424940=_0x38335f[_0x4b58aa(0x19c)]||undefined;break;case _0x4b58aa(0x273):_0x424940=_0x38335f[_0x4b58aa(0x245)]||undefined;break;case _0x4b58aa(0x204):_0x424940=_0x38335f['usdcPolygonWallet']||undefined;break;}}console[_0x4b58aa(0x1e8)](_0x4b58aa(0x189)+_0x26862f+':\x20'+(_0x424940||_0x4b58aa(0x241)));const _0x57f953=await _0x26de41[_0x4b58aa(0x1cf)]['create']({'data':{'shopId':_0x5d895f,'amount':_0x1f9d73,'network':_0x26862f,'status':_0x4b58aa(0x260),'txid':_0x241b0d,'notes':_0x34004a,'periodFrom':_0x5a1510?new Date(_0x5a1510):null,'periodTo':_0x26fad4?new Date(_0x26fad4):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x516942=_0x544fd5[_0x4b58aa(0x281)]-_0x1f9d73,_0x1ce994=_0x544fd5['totalPaidOut']+_0x1f9d73;return await _0x26de41['shop'][_0x4b58aa(0x185)]({'where':{'id':_0x5d895f},'data':{'balance':_0x516942,'totalPaidOut':_0x1ce994}}),console[_0x4b58aa(0x1e8)](_0x4b58aa(0x1b6)+_0x544fd5[_0x4b58aa(0x224)]+_0x4b58aa(0x247)),console[_0x4b58aa(0x1e8)]('\x20\x20\x20Balance:\x20'+_0x544fd5['balance'][_0x4b58aa(0x1df)](0x6)+_0x4b58aa(0x276)+_0x516942['toFixed'](0x6)+_0x4b58aa(0x284)+_0x1f9d73[_0x4b58aa(0x1df)](0x6)+')'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x544fd5[_0x4b58aa(0x26e)]['toFixed'](0x6)+'\x20->\x20'+_0x1ce994[_0x4b58aa(0x1df)](0x6)+_0x4b58aa(0x195)+_0x1f9d73[_0x4b58aa(0x1df)](0x6)+')'),{'payout':_0x57f953,'shop':_0x544fd5};});return console[_0xc04ea8(0x1e8)]('✅\x20Payout\x20created:\x20'+_0x4dbde2[_0xc04ea8(0x1cf)]['id']+_0xc04ea8(0x1f9)+_0x4dbde2[_0xc04ea8(0x25e)][_0xc04ea8(0x224)]+'\x20('+_0x1f9d73+_0xc04ea8(0x1ef)),{'id':_0x4dbde2[_0xc04ea8(0x1cf)]['id'],'shopId':_0x4dbde2['payout'][_0xc04ea8(0x229)],'shopName':_0x4dbde2[_0xc04ea8(0x25e)][_0xc04ea8(0x22f)],'shopUsername':_0x4dbde2[_0xc04ea8(0x25e)]['username'],'amount':_0x4dbde2[_0xc04ea8(0x1cf)]['amount'],'network':_0x4dbde2['payout'][_0xc04ea8(0x216)],'status':_0x4dbde2['payout'][_0xc04ea8(0x18c)],'txid':_0x4dbde2[_0xc04ea8(0x1cf)]['txid'],'notes':_0x4dbde2[_0xc04ea8(0x1cf)]['notes'],'periodFrom':_0x4dbde2[_0xc04ea8(0x1cf)]['periodFrom'],'periodTo':_0x4dbde2['payout']['periodTo'],'createdAt':_0x4dbde2[_0xc04ea8(0x1cf)][_0xc04ea8(0x197)],'paidAt':_0x4dbde2[_0xc04ea8(0x1cf)]['paidAt']};}async[a35_0x5bc81f(0x28e)](_0x4691a7){const _0x47cfbb=a35_0x5bc81f,{page:_0x1c23ff,limit:_0x5ef89a,shopId:_0x27e02c,network:_0x2ed018,dateFrom:_0x5dc316,dateTo:_0x380138,search:_0x3898b0}=_0x4691a7,_0x4f5dcc=(_0x1c23ff-0x1)*_0x5ef89a,_0x3cd49d={};_0x27e02c&&(_0x3cd49d[_0x47cfbb(0x229)]=_0x27e02c);_0x2ed018&&(_0x3cd49d[_0x47cfbb(0x216)]=_0x2ed018);(_0x5dc316||_0x380138)&&(_0x3cd49d['createdAt']={},_0x5dc316&&(_0x3cd49d['createdAt'][_0x47cfbb(0x24a)]=new Date(_0x5dc316)),_0x380138&&(_0x3cd49d['createdAt'][_0x47cfbb(0x239)]=new Date(_0x380138)));_0x3898b0&&(_0x3cd49d['OR']=[{'shop':{'name':{'contains':_0x3898b0,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3898b0,'mode':_0x47cfbb(0x1db)}}},{'notes':{'contains':_0x3898b0,'mode':_0x47cfbb(0x1db)}}]);const [_0x2a999f,_0x58368e]=await Promise[_0x47cfbb(0x199)]([database_1[_0x47cfbb(0x1be)][_0x47cfbb(0x1cf)][_0x47cfbb(0x25d)]({'where':_0x3cd49d,'skip':_0x4f5dcc,'take':_0x5ef89a,'orderBy':{'createdAt':_0x47cfbb(0x1e3)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x47cfbb(0x1be)][_0x47cfbb(0x1cf)]['count']({'where':_0x3cd49d})]);return{'payouts':_0x2a999f[_0x47cfbb(0x20f)](_0x9832ba=>({'id':_0x9832ba['id'],'shopId':_0x9832ba[_0x47cfbb(0x229)],'shopName':_0x9832ba[_0x47cfbb(0x25e)][_0x47cfbb(0x22f)],'shopUsername':_0x9832ba['shop']['username'],'amount':_0x9832ba[_0x47cfbb(0x1fd)],'network':_0x9832ba[_0x47cfbb(0x216)],'wallet':_0x9832ba[_0x47cfbb(0x1ce)],'status':_0x9832ba[_0x47cfbb(0x18c)],'txid':_0x9832ba[_0x47cfbb(0x1af)],'notes':_0x9832ba[_0x47cfbb(0x287)],'periodFrom':_0x9832ba['periodFrom'],'periodTo':_0x9832ba[_0x47cfbb(0x256)],'createdAt':_0x9832ba[_0x47cfbb(0x197)],'paidAt':_0x9832ba[_0x47cfbb(0x246)]})),'pagination':{'page':_0x1c23ff,'limit':_0x5ef89a,'total':_0x58368e,'totalPages':Math['ceil'](_0x58368e/_0x5ef89a)}};}async[a35_0x5bc81f(0x1ae)](_0x3505f9){const _0x54c230=a35_0x5bc81f,_0x4c09a6=await database_1[_0x54c230(0x1be)]['payout'][_0x54c230(0x231)]({'where':{'id':_0x3505f9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4c09a6)return null;return{'id':_0x4c09a6['id'],'shopId':_0x4c09a6[_0x54c230(0x229)],'shopName':_0x4c09a6[_0x54c230(0x25e)][_0x54c230(0x22f)],'shopUsername':_0x4c09a6[_0x54c230(0x25e)][_0x54c230(0x224)],'amount':_0x4c09a6[_0x54c230(0x1fd)],'network':_0x4c09a6[_0x54c230(0x216)],'status':_0x4c09a6[_0x54c230(0x18c)],'txid':_0x4c09a6['txid'],'notes':_0x4c09a6['notes'],'periodFrom':_0x4c09a6[_0x54c230(0x234)],'periodTo':_0x4c09a6['periodTo'],'createdAt':_0x4c09a6[_0x54c230(0x197)],'paidAt':_0x4c09a6[_0x54c230(0x246)]};}async[a35_0x5bc81f(0x267)](_0x4c0024){const _0xc44e4f=a35_0x5bc81f;await database_1[_0xc44e4f(0x1be)]['payout'][_0xc44e4f(0x1b5)]({'where':{'id':_0x4c0024}});}async[a35_0x5bc81f(0x202)](_0x139488){const _0x30dfa9=a35_0x5bc81f,{page:_0x4100f9,limit:_0x1c731c,status:_0x5382bd,gateway:_0x1b2216,shopId:_0x34bab6,dateFrom:_0xa70dfa,dateTo:_0x4454ea,search:_0x3222e4,currency:_0x704b10,sortBy:_0x435e60,sortOrder:_0xe28e1f}=_0x139488,_0x48a545=(_0x4100f9-0x1)*_0x1c731c;console[_0x30dfa9(0x1e8)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x139488);const _0xf83df7=await database_1['default']['payment'][_0x30dfa9(0x209)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x30dfa9(0x1e8)](_0x30dfa9(0x243),_0xf83df7['map'](_0x36a3b1=>_0x36a3b1[_0x30dfa9(0x23d)]+'\x20('+_0x36a3b1[_0x30dfa9(0x263)][_0x30dfa9(0x23d)]+_0x30dfa9(0x18a)));if(_0x1b2216){const _0x5515d3=_0xf83df7[_0x30dfa9(0x264)](_0x426fba=>_0x426fba[_0x30dfa9(0x23d)][_0x30dfa9(0x270)]()===_0x1b2216[_0x30dfa9(0x270)]());!_0x5515d3&&_0x1b2216[_0x30dfa9(0x270)]()!==_0x30dfa9(0x279)&&console[_0x30dfa9(0x1e8)](_0x30dfa9(0x1fa)+_0x1b2216+_0x30dfa9(0x22b)+_0xf83df7['map'](_0x4e9c9b=>_0x4e9c9b[_0x30dfa9(0x23d)])[_0x30dfa9(0x1e2)](',\x20'));}const _0x323362={};_0x5382bd&&(_0x323362['status']=_0x5382bd[_0x30dfa9(0x1b3)]());if(!_0x1b2216)_0x323362[_0x30dfa9(0x23d)]={'not':_0x30dfa9(0x279)};else{if(_0x1b2216&&(_0x1b2216[_0x30dfa9(0x270)]()===_0x30dfa9(0x279)||_0x1b2216===_0x30dfa9(0x23b)))_0x323362[_0x30dfa9(0x23d)]='test_gateway';else{let _0x20b189=_0x1b2216;const _0x5bd4e8=(0x0,gateway_1['getGatewayNameById'])(_0x1b2216);if(_0x5bd4e8)_0x20b189=_0x5bd4e8,console[_0x30dfa9(0x1e8)](_0x30dfa9(0x219)+_0x1b2216+_0x30dfa9(0x240)+_0x20b189+'\x27');else{const _0x1c0b2a=(0x0,gateway_1[_0x30dfa9(0x214)])(_0x1b2216);if(_0x1c0b2a){const _0x6bbbfe=(0x0,gateway_1['getGatewayNameById'])(_0x1c0b2a);_0x6bbbfe&&(_0x20b189=_0x6bbbfe,console[_0x30dfa9(0x1e8)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x1b2216+_0x30dfa9(0x19d)+_0x1c0b2a+_0x30dfa9(0x24b)+_0x20b189+'\x27'));}else console[_0x30dfa9(0x1e8)]('🔍\x20Using\x20gateway\x20\x27'+_0x1b2216+_0x30dfa9(0x253));}const _0x4e5462=await database_1[_0x30dfa9(0x1be)][_0x30dfa9(0x208)]['count']({'where':{'gateway':_0x20b189[_0x30dfa9(0x270)]()},'take':0x1});_0x4e5462===0x0?(console[_0x30dfa9(0x1e8)](_0x30dfa9(0x22e)+_0x20b189+_0x30dfa9(0x20e)+_0x1b2216+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x323362[_0x30dfa9(0x23d)]=_0x30dfa9(0x203)):(_0x323362[_0x30dfa9(0x23d)]=_0x20b189[_0x30dfa9(0x270)](),console[_0x30dfa9(0x1e8)](_0x30dfa9(0x27f)+_0x20b189+_0x30dfa9(0x20e)+_0x1b2216+'\x27)'));}}console['log'](_0x30dfa9(0x26f),_0x323362['gateway']);_0x34bab6&&(_0x323362[_0x30dfa9(0x229)]=_0x34bab6);_0x704b10&&(_0x323362['currency']=_0x704b10['toUpperCase'](),console[_0x30dfa9(0x1e8)](_0x30dfa9(0x1ca)+_0x704b10[_0x30dfa9(0x1b3)]()));(_0xa70dfa||_0x4454ea)&&(_0x323362[_0x30dfa9(0x197)]={},_0xa70dfa&&(_0x323362[_0x30dfa9(0x197)][_0x30dfa9(0x24a)]=new Date(_0xa70dfa)),_0x4454ea&&(_0x323362[_0x30dfa9(0x197)][_0x30dfa9(0x239)]=new Date(_0x4454ea)));_0x3222e4&&(_0x323362['OR']=[{'orderId':{'contains':_0x3222e4,'mode':_0x30dfa9(0x1db)}},{'gatewayOrderId':{'contains':_0x3222e4,'mode':'insensitive'}},{'customerEmail':{'contains':_0x3222e4,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x3222e4,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3222e4,'mode':_0x30dfa9(0x1db)}}}]);console[_0x30dfa9(0x1e8)](_0x30dfa9(0x18e),JSON[_0x30dfa9(0x20a)](_0x323362,null,0x2));let _0xf3ab5d={'createdAt':'desc'};if(_0x435e60){const _0x146bc2=[_0x30dfa9(0x1fd),_0x30dfa9(0x197),_0x30dfa9(0x1ac),_0x30dfa9(0x18c),_0x30dfa9(0x23d),_0x30dfa9(0x1b7)],_0x4afe83=[_0x30dfa9(0x27d),_0x30dfa9(0x1e3)];if(_0x146bc2['includes'](_0x435e60)){const _0x459f21=_0x4afe83[_0x30dfa9(0x272)](_0xe28e1f)?_0xe28e1f:'desc';_0xf3ab5d={[_0x435e60]:_0x459f21},console['log'](_0x30dfa9(0x1aa)+_0x435e60+'\x20in\x20'+_0x459f21+_0x30dfa9(0x242));}}const [_0x3eca66,_0x3caa57]=await Promise[_0x30dfa9(0x199)]([database_1['default'][_0x30dfa9(0x208)][_0x30dfa9(0x25d)]({'where':_0x323362,'skip':_0x48a545,'take':_0x1c731c,'orderBy':_0xf3ab5d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x30dfa9(0x1be)][_0x30dfa9(0x208)]['count']({'where':_0x323362})]);return{'payments':_0x3eca66['map'](_0x42e25f=>({'id':_0x42e25f['id'],'shopId':_0x42e25f['shopId'],'gateway':_0x42e25f['gateway'],'amount':_0x42e25f['amount'],'currency':_0x42e25f[_0x30dfa9(0x1b7)],'status':_0x42e25f[_0x30dfa9(0x18c)],'orderId':_0x42e25f['orderId'],'gatewayOrderId':_0x42e25f['gatewayOrderId'],'customerEmail':_0x42e25f['customerEmail'],'customerName':_0x42e25f[_0x30dfa9(0x20c)],'customerCountry':_0x42e25f[_0x30dfa9(0x282)],'customerIp':_0x42e25f[_0x30dfa9(0x26a)],'customerUa':_0x42e25f[_0x30dfa9(0x28f)],'failureMessage':_0x42e25f[_0x30dfa9(0x1bb)],'createdAt':_0x42e25f[_0x30dfa9(0x197)],'updatedAt':_0x42e25f[_0x30dfa9(0x1ac)],'shop':_0x42e25f['shop']})),'pagination':{'page':_0x4100f9,'limit':_0x1c731c,'total':_0x3caa57,'totalPages':Math[_0x30dfa9(0x288)](_0x3caa57/_0x1c731c)}};}async[a35_0x5bc81f(0x230)](_0x1654d6){const _0x1810d0=a35_0x5bc81f,_0xc76af=await database_1[_0x1810d0(0x1be)][_0x1810d0(0x208)][_0x1810d0(0x231)]({'where':{'id':_0x1654d6},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xc76af)return null;return{'id':_0xc76af['id'],'shopId':_0xc76af[_0x1810d0(0x229)],'gateway':_0xc76af['gateway'],'amount':_0xc76af[_0x1810d0(0x1fd)],'currency':_0xc76af[_0x1810d0(0x1b7)],'status':_0xc76af['status'],'orderId':_0xc76af['orderId'],'gatewayOrderId':_0xc76af[_0x1810d0(0x1b8)],'customerEmail':_0xc76af[_0x1810d0(0x1a9)],'customerName':_0xc76af[_0x1810d0(0x20c)],'customerCountry':_0xc76af[_0x1810d0(0x282)],'customerIp':_0xc76af['customerIp'],'customerUa':_0xc76af[_0x1810d0(0x28f)],'failureMessage':_0xc76af[_0x1810d0(0x1bb)],'externalPaymentUrl':_0xc76af[_0x1810d0(0x1fc)],'successUrl':_0xc76af[_0x1810d0(0x206)],'failUrl':_0xc76af[_0x1810d0(0x1eb)],'pendingUrl':_0xc76af[_0x1810d0(0x28c)],'whiteUrl':_0xc76af[_0x1810d0(0x1c0)],'createdAt':_0xc76af[_0x1810d0(0x197)],'updatedAt':_0xc76af[_0x1810d0(0x1ac)],'shop':_0xc76af[_0x1810d0(0x25e)]};}async[a35_0x5bc81f(0x1c5)](_0x2ece2f,_0x266d10,_0xa05506,_0x3ff6c2){const _0x276bd9=a35_0x5bc81f,_0x2a9f0b=await database_1[_0x276bd9(0x1be)]['$transaction'](async _0x5e477d=>{const _0x2259e0=_0x276bd9,_0x288bd7=await _0x5e477d[_0x2259e0(0x208)][_0x2259e0(0x231)]({'where':{'id':_0x2ece2f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x288bd7)throw new Error('Payment\x20not\x20found');const _0x3debae=_0x288bd7[_0x2259e0(0x18c)],_0x3b0f1b=_0x266d10[_0x2259e0(0x1b3)]();console[_0x2259e0(0x1e8)](_0x2259e0(0x20d)+_0x2ece2f+_0x2259e0(0x1b2)+_0x3debae+_0x2259e0(0x276)+_0x3b0f1b),console['log']('💰\x20Current\x20shop\x20balance:\x20'+_0x288bd7['shop'][_0x2259e0(0x281)]+_0x2259e0(0x1e1));const _0x4711f5={'status':_0x3b0f1b,'updatedAt':new Date(),'statusChangedBy':_0x2259e0(0x1b4),'statusChangedAt':new Date()};_0xa05506&&(_0x4711f5[_0x2259e0(0x192)]=_0xa05506);_0x3b0f1b===_0x2259e0(0x1f0)&&_0x3ff6c2&&(_0x4711f5[_0x2259e0(0x217)]=_0x3ff6c2);let _0x5e0f9d=0x0,_0x10de09=_0x288bd7[_0x2259e0(0x25e)][_0x2259e0(0x281)];if(_0x3b0f1b===_0x2259e0(0x21e)&&_0x3debae!==_0x2259e0(0x21e)){_0x4711f5[_0x2259e0(0x246)]=new Date();const _0x4e42e1=await currencyService_1[_0x2259e0(0x18f)][_0x2259e0(0x23e)](_0x288bd7[_0x2259e0(0x1fd)],_0x288bd7['currency']);_0x4711f5[_0x2259e0(0x1a0)]=_0x4e42e1,_0x5e0f9d=_0x4e42e1,_0x10de09+=_0x4e42e1,console[_0x2259e0(0x1e8)](_0x2259e0(0x1ed)+_0x2ece2f+'\x20became\x20PAID:\x20+'+_0x4e42e1[_0x2259e0(0x1df)](0x6)+_0x2259e0(0x196));}else _0x3debae===_0x2259e0(0x21e)&&_0x3b0f1b!==_0x2259e0(0x21e)&&(_0x288bd7[_0x2259e0(0x1a0)]&&(_0x5e0f9d=-_0x288bd7[_0x2259e0(0x1a0)],_0x10de09-=_0x288bd7[_0x2259e0(0x1a0)],_0x4711f5[_0x2259e0(0x1a0)]=null,console[_0x2259e0(0x1e8)]('💰\x20Payment\x20'+_0x2ece2f+'\x20no\x20longer\x20PAID:\x20-'+_0x288bd7[_0x2259e0(0x1a0)][_0x2259e0(0x1df)](0x6)+_0x2259e0(0x1b1))));if(_0x3b0f1b===_0x2259e0(0x1f0)){if(_0x3debae==='PAID'&&_0x288bd7[_0x2259e0(0x1a0)]){}_0x3ff6c2&&_0x3ff6c2>0x0&&(_0x5e0f9d-=_0x3ff6c2,_0x10de09-=_0x3ff6c2,console[_0x2259e0(0x1e8)](_0x2259e0(0x23a)+_0x3ff6c2[_0x2259e0(0x1df)](0x6)+_0x2259e0(0x1b1)));}_0x3b0f1b==='REFUND'&&_0x3debae===_0x2259e0(0x21e)&&console['log'](_0x2259e0(0x18b));const _0x5086ae=await _0x5e477d[_0x2259e0(0x208)][_0x2259e0(0x185)]({'where':{'id':_0x2ece2f},'data':_0x4711f5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5e0f9d!==0x0&&(await _0x5e477d[_0x2259e0(0x25e)][_0x2259e0(0x185)]({'where':{'id':_0x288bd7[_0x2259e0(0x229)]},'data':{'balance':_0x10de09}}),console[_0x2259e0(0x1e8)](_0x2259e0(0x1b6)+_0x288bd7[_0x2259e0(0x229)]+_0x2259e0(0x186)+_0x288bd7[_0x2259e0(0x25e)][_0x2259e0(0x281)]['toFixed'](0x6)+_0x2259e0(0x276)+_0x10de09['toFixed'](0x6)+_0x2259e0(0x187)+(_0x5e0f9d>0x0?'+':'')+_0x5e0f9d['toFixed'](0x6)+')')),_0x5086ae;});return{'id':_0x2a9f0b['id'],'shopId':_0x2a9f0b[_0x276bd9(0x229)],'gateway':_0x2a9f0b[_0x276bd9(0x23d)],'amount':_0x2a9f0b[_0x276bd9(0x1fd)],'currency':_0x2a9f0b[_0x276bd9(0x1b7)],'status':_0x2a9f0b[_0x276bd9(0x18c)],'orderId':_0x2a9f0b[_0x276bd9(0x1c4)],'gatewayOrderId':_0x2a9f0b[_0x276bd9(0x1b8)],'customerEmail':_0x2a9f0b[_0x276bd9(0x1a9)],'customerName':_0x2a9f0b[_0x276bd9(0x20c)],'customerCountry':_0x2a9f0b[_0x276bd9(0x282)],'customerIp':_0x2a9f0b['customerIp'],'customerUa':_0x2a9f0b[_0x276bd9(0x28f)],'failureMessage':_0x2a9f0b[_0x276bd9(0x1bb)],'adminNotes':_0x2a9f0b['adminNotes'],'chargebackAmount':_0x2a9f0b[_0x276bd9(0x217)],'statusChangedBy':_0x2a9f0b[_0x276bd9(0x1e6)],'statusChangedAt':_0x2a9f0b[_0x276bd9(0x21d)],'createdAt':_0x2a9f0b['createdAt'],'updatedAt':_0x2a9f0b[_0x276bd9(0x1ac)],'shop':_0x2a9f0b['shop']};}async[a35_0x5bc81f(0x1f1)](_0x142410,_0x2244d0){const _0x37b4ba=a35_0x5bc81f,_0x4d1c99={..._0x2244d0};_0x2244d0[_0x37b4ba(0x1b0)]&&(_0x4d1c99[_0x37b4ba(0x1b0)]=await bcryptjs_1[_0x37b4ba(0x1be)][_0x37b4ba(0x262)](_0x2244d0[_0x37b4ba(0x1b0)],0xc));_0x2244d0[_0x37b4ba(0x271)]&&(_0x4d1c99[_0x37b4ba(0x22f)]=_0x2244d0[_0x37b4ba(0x271)],delete _0x4d1c99['fullName']);_0x2244d0[_0x37b4ba(0x1d6)]&&(_0x4d1c99[_0x37b4ba(0x21c)]=_0x2244d0[_0x37b4ba(0x1d6)],delete _0x4d1c99[_0x37b4ba(0x1d6)]);_0x2244d0['merchantUrl']&&(_0x4d1c99[_0x37b4ba(0x277)]=_0x2244d0['merchantUrl'],delete _0x4d1c99[_0x37b4ba(0x24d)]);_0x2244d0[_0x37b4ba(0x1f2)]&&(_0x4d1c99[_0x37b4ba(0x218)]=JSON[_0x37b4ba(0x20a)](_0x2244d0['gateways']),delete _0x4d1c99[_0x37b4ba(0x1f2)]);_0x2244d0[_0x37b4ba(0x289)]&&(_0x4d1c99[_0x37b4ba(0x289)]=JSON['stringify'](_0x2244d0[_0x37b4ba(0x289)]),delete _0x4d1c99[_0x37b4ba(0x289)]);_0x2244d0['wallets']&&(_0x2244d0[_0x37b4ba(0x22c)][_0x37b4ba(0x19b)]!==undefined&&(_0x4d1c99[_0x37b4ba(0x19b)]=_0x2244d0[_0x37b4ba(0x22c)][_0x37b4ba(0x19b)]||null),_0x2244d0[_0x37b4ba(0x22c)][_0x37b4ba(0x19c)]!==undefined&&(_0x4d1c99['usdtTrcWallet']=_0x2244d0[_0x37b4ba(0x22c)][_0x37b4ba(0x19c)]||null),_0x2244d0[_0x37b4ba(0x22c)]['usdtErcWallet']!==undefined&&(_0x4d1c99[_0x37b4ba(0x245)]=_0x2244d0[_0x37b4ba(0x22c)]['usdtErcWallet']||null),_0x2244d0[_0x37b4ba(0x22c)][_0x37b4ba(0x193)]!==undefined&&(_0x4d1c99[_0x37b4ba(0x193)]=_0x2244d0[_0x37b4ba(0x22c)]['usdcPolygonWallet']||null),delete _0x4d1c99[_0x37b4ba(0x22c)]);const _0x246b89=await database_1[_0x37b4ba(0x1be)][_0x37b4ba(0x25e)][_0x37b4ba(0x185)]({'where':{'id':_0x142410},'data':_0x4d1c99,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x246b89['id'],'fullName':_0x246b89[_0x37b4ba(0x22f)],'username':_0x246b89['username'],'telegramId':_0x246b89[_0x37b4ba(0x21c)],'merchantUrl':_0x246b89['shopUrl'],'gateways':_0x246b89[_0x37b4ba(0x218)]?JSON[_0x37b4ba(0x1e5)](_0x246b89[_0x37b4ba(0x218)]):null,'gatewaySettings':_0x246b89[_0x37b4ba(0x289)]?JSON[_0x37b4ba(0x1e5)](_0x246b89[_0x37b4ba(0x289)]):null,'publicKey':_0x246b89[_0x37b4ba(0x19f)],'wallets':{'usdtPolygonWallet':_0x246b89[_0x37b4ba(0x19b)],'usdtTrcWallet':_0x246b89[_0x37b4ba(0x19c)],'usdtErcWallet':_0x246b89[_0x37b4ba(0x245)],'usdcPolygonWallet':_0x246b89[_0x37b4ba(0x193)]},'status':_0x246b89[_0x37b4ba(0x18c)],'createdAt':_0x246b89[_0x37b4ba(0x197)]};}async[a35_0x5bc81f(0x1ff)](_0xda32ba){const _0x568814=a35_0x5bc81f,_0x152238=await database_1[_0x568814(0x1be)][_0x568814(0x25e)][_0x568814(0x185)]({'where':{'id':_0xda32ba},'data':{'status':_0x568814(0x1a8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x152238['id'],'fullName':_0x152238[_0x568814(0x22f)],'username':_0x152238[_0x568814(0x224)],'telegramId':_0x152238[_0x568814(0x21c)],'merchantUrl':_0x152238[_0x568814(0x277)],'gateways':_0x152238['paymentGateways']?JSON[_0x568814(0x1e5)](_0x152238[_0x568814(0x218)]):null,'gatewaySettings':_0x152238['gatewaySettings']?JSON['parse'](_0x152238[_0x568814(0x289)]):null,'publicKey':_0x152238[_0x568814(0x19f)],'wallets':{'usdtPolygonWallet':_0x152238['usdtPolygonWallet'],'usdtTrcWallet':_0x152238[_0x568814(0x19c)],'usdtErcWallet':_0x152238[_0x568814(0x245)],'usdcPolygonWallet':_0x152238[_0x568814(0x193)]},'status':_0x152238[_0x568814(0x18c)],'createdAt':_0x152238[_0x568814(0x197)]};}async['activateUser'](_0x367c3e){const _0x48d485=a35_0x5bc81f,_0x2f65ef=await database_1[_0x48d485(0x1be)][_0x48d485(0x25e)]['update']({'where':{'id':_0x367c3e},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2f65ef['id'],'fullName':_0x2f65ef[_0x48d485(0x22f)],'username':_0x2f65ef[_0x48d485(0x224)],'telegramId':_0x2f65ef['telegram'],'merchantUrl':_0x2f65ef[_0x48d485(0x277)],'gateways':_0x2f65ef['paymentGateways']?JSON[_0x48d485(0x1e5)](_0x2f65ef[_0x48d485(0x218)]):null,'gatewaySettings':_0x2f65ef[_0x48d485(0x289)]?JSON[_0x48d485(0x1e5)](_0x2f65ef[_0x48d485(0x289)]):null,'publicKey':_0x2f65ef[_0x48d485(0x19f)],'wallets':{'usdtPolygonWallet':_0x2f65ef['usdtPolygonWallet'],'usdtTrcWallet':_0x2f65ef[_0x48d485(0x19c)],'usdtErcWallet':_0x2f65ef[_0x48d485(0x245)],'usdcPolygonWallet':_0x2f65ef['usdcPolygonWallet']},'status':_0x2f65ef[_0x48d485(0x18c)],'createdAt':_0x2f65ef[_0x48d485(0x197)]};}async[a35_0x5bc81f(0x1f6)](_0x56856f){const _0x1b44f7=a35_0x5bc81f,{page:_0x4e5850,limit:_0x18f7e3,status:_0x297931}=_0x56856f,_0xd48d1c=(_0x4e5850-0x1)*_0x18f7e3,_0x551733={};_0x297931&&(_0x551733[_0x1b44f7(0x18c)]=_0x297931[_0x1b44f7(0x1b3)]());const [_0x19d992,_0x1472d4]=await Promise[_0x1b44f7(0x199)]([database_1['default'][_0x1b44f7(0x25e)][_0x1b44f7(0x25d)]({'where':_0x551733,'skip':_0xd48d1c,'take':_0x18f7e3,'orderBy':{'createdAt':_0x1b44f7(0x1e3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x1b44f7(0x1be)][_0x1b44f7(0x25e)]['count']({'where':_0x551733})]);return{'users':_0x19d992[_0x1b44f7(0x20f)](_0x3ccd6c=>({'id':_0x3ccd6c['id'],'fullName':_0x3ccd6c[_0x1b44f7(0x22f)],'username':_0x3ccd6c[_0x1b44f7(0x224)],'telegramId':_0x3ccd6c[_0x1b44f7(0x21c)],'merchantUrl':_0x3ccd6c[_0x1b44f7(0x277)],'gateways':_0x3ccd6c[_0x1b44f7(0x218)]?JSON[_0x1b44f7(0x1e5)](_0x3ccd6c[_0x1b44f7(0x218)]):null,'gatewaySettings':_0x3ccd6c[_0x1b44f7(0x289)]?JSON[_0x1b44f7(0x1e5)](_0x3ccd6c[_0x1b44f7(0x289)]):null,'publicKey':_0x3ccd6c[_0x1b44f7(0x19f)],'wallets':{'usdtPolygonWallet':_0x3ccd6c[_0x1b44f7(0x19b)],'usdtTrcWallet':_0x3ccd6c[_0x1b44f7(0x19c)],'usdtErcWallet':_0x3ccd6c['usdtErcWallet'],'usdcPolygonWallet':_0x3ccd6c[_0x1b44f7(0x193)]},'status':_0x3ccd6c['status'],'createdAt':_0x3ccd6c[_0x1b44f7(0x197)]})),'pagination':{'page':_0x4e5850,'limit':_0x18f7e3,'total':_0x1472d4,'totalPages':Math[_0x1b44f7(0x288)](_0x1472d4/_0x18f7e3)}};}async[a35_0x5bc81f(0x215)](_0x671cd2){const _0x27a3ee=a35_0x5bc81f,_0x313450=await database_1['default'][_0x27a3ee(0x25e)][_0x27a3ee(0x231)]({'where':{'id':_0x671cd2},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x313450)return null;return{'id':_0x313450['id'],'fullName':_0x313450[_0x27a3ee(0x22f)],'username':_0x313450[_0x27a3ee(0x224)],'telegramId':_0x313450[_0x27a3ee(0x21c)],'merchantUrl':_0x313450[_0x27a3ee(0x277)],'gateways':_0x313450[_0x27a3ee(0x218)]?JSON[_0x27a3ee(0x1e5)](_0x313450['paymentGateways']):null,'gatewaySettings':_0x313450[_0x27a3ee(0x289)]?JSON[_0x27a3ee(0x1e5)](_0x313450[_0x27a3ee(0x289)]):null,'publicKey':_0x313450[_0x27a3ee(0x19f)],'wallets':{'usdtPolygonWallet':_0x313450[_0x27a3ee(0x19b)],'usdtTrcWallet':_0x313450[_0x27a3ee(0x19c)],'usdtErcWallet':_0x313450[_0x27a3ee(0x245)],'usdcPolygonWallet':_0x313450[_0x27a3ee(0x193)]},'status':_0x313450[_0x27a3ee(0x18c)],'createdAt':_0x313450['createdAt']};}async['createUser'](_0x3a19f0){const _0x5ddcd1=a35_0x5bc81f,{fullName:_0x42cc63,username:_0x472c44,password:_0x3fe7e9,telegramId:_0x26e0f9,merchantUrl:_0x30bd85,gateways:_0x18841b,gatewaySettings:_0x4df7d4,wallets:_0x4cf167}=_0x3a19f0,_0x432619=await database_1['default'][_0x5ddcd1(0x25e)]['findUnique']({'where':{'username':_0x472c44}});if(_0x432619)throw new Error(_0x5ddcd1(0x265));if(_0x26e0f9){const _0x105052=await database_1[_0x5ddcd1(0x1be)][_0x5ddcd1(0x25e)][_0x5ddcd1(0x231)]({'where':{'telegram':_0x26e0f9}});if(_0x105052)throw new Error(_0x5ddcd1(0x1d5));}const _0x140a32=await bcryptjs_1['default'][_0x5ddcd1(0x262)](_0x3fe7e9,0xc),_0x5aa6dc=_0x5ddcd1(0x1d3)+crypto_1[_0x5ddcd1(0x1be)][_0x5ddcd1(0x1dd)](0x20)[_0x5ddcd1(0x236)](_0x5ddcd1(0x248)),_0x1e800e=_0x5ddcd1(0x266)+crypto_1[_0x5ddcd1(0x1be)]['randomBytes'](0x20)[_0x5ddcd1(0x236)](_0x5ddcd1(0x248)),_0x37a6a1=await database_1[_0x5ddcd1(0x1be)]['shop'][_0x5ddcd1(0x280)]({'data':{'name':_0x42cc63,'username':_0x472c44,'password':_0x140a32,'telegram':_0x26e0f9,'shopUrl':_0x30bd85,'paymentGateways':_0x18841b?JSON[_0x5ddcd1(0x20a)](_0x18841b):null,'gatewaySettings':_0x4df7d4?JSON[_0x5ddcd1(0x20a)](_0x4df7d4):null,'usdtPolygonWallet':_0x4cf167?.[_0x5ddcd1(0x19b)]||null,'usdtTrcWallet':_0x4cf167?.[_0x5ddcd1(0x19c)]||null,'usdtErcWallet':_0x4cf167?.[_0x5ddcd1(0x245)]||null,'usdcPolygonWallet':_0x4cf167?.['usdcPolygonWallet']||null,'publicKey':_0x5aa6dc,'secretKey':_0x1e800e,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x37a6a1['id'],'fullName':_0x37a6a1['name'],'username':_0x37a6a1[_0x5ddcd1(0x224)],'telegramId':_0x37a6a1['telegram'],'merchantUrl':_0x37a6a1['shopUrl'],'gateways':_0x37a6a1[_0x5ddcd1(0x218)]?JSON[_0x5ddcd1(0x1e5)](_0x37a6a1[_0x5ddcd1(0x218)]):null,'gatewaySettings':_0x37a6a1['gatewaySettings']?JSON[_0x5ddcd1(0x1e5)](_0x37a6a1[_0x5ddcd1(0x289)]):null,'publicKey':_0x37a6a1[_0x5ddcd1(0x19f)],'wallets':{'usdtPolygonWallet':_0x37a6a1[_0x5ddcd1(0x19b)],'usdtTrcWallet':_0x37a6a1[_0x5ddcd1(0x19c)],'usdtErcWallet':_0x37a6a1[_0x5ddcd1(0x245)],'usdcPolygonWallet':_0x37a6a1[_0x5ddcd1(0x193)]},'status':_0x37a6a1[_0x5ddcd1(0x18c)],'createdAt':_0x37a6a1[_0x5ddcd1(0x197)]};}async[a35_0x5bc81f(0x1a1)](_0x53478c){const _0xc0b209=a35_0x5bc81f;await database_1[_0xc0b209(0x1be)][_0xc0b209(0x25e)][_0xc0b209(0x1b5)]({'where':{'id':_0x53478c}});}['generateDailyStatistics'](_0x47a86a,_0x1f314f,_0x5e4f82){const _0x4a7403=a35_0x5bc81f,_0x15e192=new Map(),_0x55b8a7=new Date(_0x1f314f);while(_0x55b8a7<=_0x5e4f82){const _0x136f0f=_0x55b8a7[_0x4a7403(0x26b)]()[_0x4a7403(0x1cb)]('T')[0x0];_0x15e192[_0x4a7403(0x28a)](_0x136f0f,{'revenue':0x0,'count':0x0}),_0x55b8a7[_0x4a7403(0x285)](_0x55b8a7[_0x4a7403(0x1a6)]()+0x1);}for(const _0x43a07e of _0x47a86a){const _0x2ee1f2=_0x43a07e['createdAt'][_0x4a7403(0x26b)]()['split']('T')[0x0],_0x4ad255=_0x15e192[_0x4a7403(0x286)](_0x2ee1f2);_0x4ad255&&(_0x4ad255['count']+=0x1,_0x43a07e['status']===_0x4a7403(0x21e)&&(_0x43a07e[_0x4a7403(0x1a0)]?_0x4ad255[_0x4a7403(0x28b)]+=_0x43a07e['amountUSDT']:console[_0x4a7403(0x1e8)](_0x4a7403(0x28d)+_0x43a07e['id']+_0x4a7403(0x26d))));}const _0x684096=[],_0x2ddef8=[];for(const [_0x92788f,_0x37424c]of _0x15e192){_0x684096[_0x4a7403(0x1a7)]({'date':_0x92788f,'amount':Math['round'](_0x37424c[_0x4a7403(0x28b)]*0x64)/0x64}),_0x2ddef8[_0x4a7403(0x1a7)]({'date':_0x92788f,'count':_0x37424c['count']});}return{'dailyRevenue':_0x684096,'dailyPayments':_0x2ddef8};}}function a35_0x3e4b(){const _0x5c0751=['year','KLYME\x20EU','failureMessage','📊\x20Merchants\x20awaiting\x20payout:\x20','getMerchantsSelection','default','getTime','whiteUrl','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','findFirst','totalCommissionRate','orderId','updatePaymentStatus','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','dateTo','\x20\x20\x20🌐\x20IP:\x20','values','💱\x20Currency\x20filter\x20applied:\x20','split','sort','getSystemStatistics','wallet','payout','dailyRevenue','count','totalTurnover','pk_','\x20\x20\x20💰\x20Total\x20payout:\x20','Telegram\x20username\x20already\x20exists','telegramId','../types/gateway','376752mKjioL','custom','\x20USDT\x20total','insensitive','merchantEarnings','randomBytes','./currencyService','toFixed','Rapyd','\x20USDT','join','desc','turnoverUSDT','parse','statusChangedBy','defineProperty','log','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','📊\x20Total\x20payments\x20(including\x20failed):\x20','failUrl','Payment\x20not\x20found','💰\x20Payment\x20','getMerchantsAwaitingPayout','\x20USDT)','CHARGEBACK','updateUser','gateways','_sum','../config/database','💰\x20Creating\x20payout\x20for\x20shop\x20','getAllUsers','paymentsCount','length','\x20for\x20shop\x20','⚠️\x20Requested\x20gateway\x20\x27','\x20USDT\x20(same\x20as\x20awaiting)','externalPaymentUrl','amount','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','suspendUser','getMonth','📅\x20Period:\x20','getAllPayments','NONEXISTENT_GATEWAY_FILTER','polygon_usdc','thisMonth','successUrl','reduce','payment','groupBy','stringify','\x20\x20\x20Current\x20balance:\x20','customerName','🔄\x20Admin\x20updating\x20payment\x20','\x27\x20(from\x20\x27','map','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','getGatewayDisplayName','averageCommissionRate','paidOutUSDT','getGatewayIdByName','getUserById','network','chargebackAmount','paymentGateways','🔄\x20Converted\x20gateway\x20ID\x20\x27','createPayout','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','telegram','statusChangedAt','PAID','2020-01-01','updateCustomerData','totalPayments','amountAfterCommissionUSDT','forEach','username','343vIQYoX','entries','error','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','shopId','month','\x27\x20not\x20found.\x20Available\x20gateways:\x20','wallets','AdminService','⚠️\x20Gateway\x20\x27','name','getPaymentById','findUnique','\x20merchants\x20with\x20positive\x20balance','29431296ihbCyT','periodFrom','17392ILohaI','toString','generateDailyStatistics','bcryptjs','lte','💸\x20CHARGEBACK\x20penalty:\x20-','0000','\x20\x20\x20📊\x20Total\x20payments:\x20','gateway','convertToUSDT','Test\x20Gateway','\x27\x20to\x20name\x20\x27','not\x20specified','\x20order','📊\x20Available\x20gateways\x20in\x20database:','\x20active\x20merchants\x20for\x20selection','usdtErcWallet','paidAt','\x20balance\x20updated:','hex','💰\x20Found\x20','gte','\x27\x20->\x20name\x20\x27','localeCompare','merchantUrl','7611296GBAwGA','turnover','CoinToPay','crypto','aggregate','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','round','📋\x20Getting\x20merchants\x20selection\x20list...','periodTo','totalPayout','period','4074SLYkXr','totalAmountAfterCommissionUSDT','Error\x20processing\x20payment\x20','not\x20set','findMany','shop','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','COMPLETED','Noda','hash','_count','some','Username\x20already\x20exists','sk_','deletePayout','915fsKZgf','4294108SUYEhK','customerIp','toISOString','commissionUSDT','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','totalPaidOut','📊\x20Gateway\x20filter\x20applied:','toLowerCase','fullName','includes','erc20','$transaction','\x20USDT\x20(total\x20merchant\x20balances)','\x20->\x20','shopUrl','\x20merchants,\x20','test_gateway',':\x20commission\x20=\x20','📋\x20Found\x20','gatewayEarnings','asc','ACTIVE','✅\x20Using\x20gateway\x20filter:\x20\x27','create','balance','customerCountry','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20USDT\x20(-','setDate','get','notes','ceil','gatewaySettings','set','revenue','pendingUrl','⚠️\x20Payment\x20','getAllPayouts','customerUa','update','\x20balance\x20updated:\x20','\x20USDT\x20(','dateFrom','💳\x20Payout\x20wallet\x20for\x20','\x20payments)','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','status','date','📊\x20Final\x20WHERE\x20conditions:','currencyService','📊\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','adminNotes','usdcPolygonWallet','__esModule','\x20USDT\x20(+','\x20USDT\x20to\x20balance','createdAt','5966952gZeIKp','all','30d','usdtPolygonWallet','usdtTrcWallet','\x27\x20->\x20ID\x20\x27','getFullYear','publicKey','amountUSDT','deleteUser','KLYME\x20DE','merchantEarningsUSDT','Shop\x20not\x20found','90d','getDate','push','SUSPENDED','customerEmail','📊\x20Sorting\x20payments\x20by\x20','totalAmountUSDT','updatedAt','Insufficient\x20balance.\x20Available:\x20','getPayoutById','txid','password','\x20USDT\x20from\x20balance','\x20status:\x20','toUpperCase','admin','delete','💰\x20Shop\x20','currency','gatewayOrderId'];a35_0x3e4b=function(){return _0x5c0751;};return a35_0x3e4b();}exports[a35_0x5bc81f(0x22d)]=AdminService;