'use strict';const a35_0x30910b=a35_0x46f0;(function(_0x5a1db3,_0x39c2c9){const _0x431d27=a35_0x46f0,_0x43e8b5=_0x5a1db3();while(!![]){try{const _0x1ca5c8=-parseInt(_0x431d27(0x22e))/0x1*(parseInt(_0x431d27(0x21b))/0x2)+parseInt(_0x431d27(0x1e9))/0x3*(-parseInt(_0x431d27(0x23a))/0x4)+-parseInt(_0x431d27(0x1cb))/0x5+parseInt(_0x431d27(0x22c))/0x6+parseInt(_0x431d27(0x20c))/0x7+-parseInt(_0x431d27(0x1e3))/0x8*(-parseInt(_0x431d27(0x1cf))/0x9)+parseInt(_0x431d27(0x1fe))/0xa;if(_0x1ca5c8===_0x39c2c9)break;else _0x43e8b5['push'](_0x43e8b5['shift']());}catch(_0x3f5c01){_0x43e8b5['push'](_0x43e8b5['shift']());}}}(a35_0x1714,0x97735));function a35_0x46f0(_0x59d749,_0x6adfa6){const _0x171422=a35_0x1714();return a35_0x46f0=function(_0x46f0af,_0x1e50ef){_0x46f0af=_0x46f0af-0x1a2;let _0x145eb4=_0x171422[_0x46f0af];return _0x145eb4;},a35_0x46f0(_0x59d749,_0x6adfa6);}var __importDefault=this&&this['__importDefault']||function(_0xa847d9){const _0x1ea6f1=a35_0x46f0;return _0xa847d9&&_0xa847d9[_0x1ea6f1(0x23e)]?_0xa847d9:{'default':_0xa847d9};};function a35_0x1714(){const _0x209fe8=['Payment\x20not\x20found','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','findUnique','sk_','shopId','\x20\x20\x20üìÖ\x20This\x20month:\x20','polygon_usdc','16wmopxe','values','log','telegramId','üí∞\x20Payment\x20','not\x20set','1789449EPeskZ','test_gateway','\x20USDT','getPaymentById','\x20\x20\x20üíµ\x20Available\x20balance:\x20','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','string','asc','defineProperty','totalCommissionRate','createPayout','updatePaymentStatus','\x20\x20\x20Transaction\x20hash:\x20','üí∞\x20Shop\x20','status','getAllUsers','error','paymentGateways','_count','toISOString','parse','1937120xdAUMy','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','üí∞\x20Found\x20','amount','gatewaySettings','KLYME\x20GB','name','gte','awaitingPayout','username','randomBytes','\x20\x20\x20Current\x20balance:\x20','erc20','shopUrl','5118372GwQJFf','Error\x20processing\x20payment\x20','default','network','adminNotes','update','toFixed','customerName','activateUser','week','round','desc','PAID','pk_','periodTo','42HjSaSr','updatedAt','Insufficient\x20balance.\x20Available:\x20','averageCheckUSDT','create','notes','length','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','whiteUrl','averageCommissionRate','getAllPayouts','groupBy','\x20\x20\x20üìä\x20Total\x20payments:\x20','totalTurnover','dateFrom','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','period','2729220UlUwtx','90d','5769BoFBrK','üìä\x20Calculating\x20payout\x20statistics...','all','findFirst','usdtErcWallet','getMonth','getFullYear','failureMessage','externalPaymentUrl','aggregate','amountUSDT','orderId','4rimDGz','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20USDT\x20from\x20balance','totalPaidOut','__esModule','\x20paid\x20payments\x20for\x20analysis','fullName','üí∏\x20CHARGEBACK\x20penalty:\x20-','\x20->\x20','\x20USDT\x20(-','crypto','$transaction','merchantEarningsUSDT','gatewayOrderId','polygon','\x20USDT\x20(total\x20merchant\x20balances)','\x20USDT)','deletePayout','\x20\x20\x20üåê\x20IP:\x20','\x20\x20\x20Payout\x20amount:\x20','createUser','\x20became\x20PAID:\x20+','getGatewayDisplayName','updateCustomerData','Noda','ACTIVE','\x20merchants\x20with\x20positive\x20balance','admin','telegram','password','convertToUSDT','usdtTrcWallet','\x20\x20\x20üåç\x20Country:\x20','COMPLETED','hash','merchantEarnings','AdminService','getSystemStatistics','statusChangedAt','üí≥\x20Payout\x20wallet\x20for\x20','successUrl','pendingUrl','usdcPolygonWallet','getPayoutStats','customerIp','30d','turnoverUSDT','bcryptjs','hex','üîÑ\x20Admin\x20updating\x20payment\x20','Test\x20Gateway','customerEmail','publicKey','KLYME\x20EU','periodFrom','usdtPolygonWallet','customerUa','getMerchantStatistics','customerCountry','getUserById','\x20USDT,\x20Requested:\x20','\x20USDT\x20(+','\x20USDT\x20total','ceil','payment','gateway','\x20USDT\x20(total\x20paid\x20to\x20merchants)','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20Balance:\x20','updateUser','localeCompare','gateways','CHARGEBACK','count','paymentsCount','getTime','dateTo','\x20for\x20shop\x20','Username\x20already\x20exists','findMany','delete','\x20\x20\x20Total\x20paid\x20out:\x20','toUpperCase','date','\x20\x20\x20üí∞\x20Total\x20payout:\x20','turnover','commission','Telegram\x20username\x20already\x20exists','paidAt','currencyService','Plisio','forEach','Rapyd','‚úÖ\x20Payout\x20created:\x20','balance','üìä\x20Payout\x20statistics\x20calculated:','paidOutUSDT','gatewayEarnings','insensitive','map','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','createdAt','üìä\x20Merchant\x20statistics\x20calculated:','payout','toString','\x20status:\x20','4463335iKfRNs','stringify','merchantUrl','currency','3828879GyLOrt','chargebackAmount','shop','txid','üí∞\x20Current\x20shop\x20balance:\x20','reduce','wallets','\x20balance\x20updated:\x20','_sum','Shop\x20not\x20found','set','suspendUser','commissionUSDT'];a35_0x1714=function(){return _0x209fe8;};return a35_0x1714();}Object[a35_0x30910b(0x1f1)](exports,a35_0x30910b(0x23e),{'value':!![]}),exports[a35_0x30910b(0x25e)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x30910b(0x269))),crypto_1=__importDefault(require(a35_0x30910b(0x244))),currencyService_1=require('./currencyService');class AdminService{async[a35_0x30910b(0x265)](){const _0x450dab=a35_0x30910b;console[_0x450dab(0x1e5)](_0x450dab(0x22f));const _0x1bcd4e=await database_1['default']['shop'][_0x450dab(0x237)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x450dab(0x253)}}),_0x26d524=new Date(),_0x311f4f=new Date(_0x26d524['getFullYear'](),_0x26d524[_0x450dab(0x233)](),0x1),_0x236b7e=new Date(_0x26d524[_0x450dab(0x234)](),_0x26d524[_0x450dab(0x233)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1a2368=await database_1['default']['payout'][_0x450dab(0x237)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x311f4f,'lte':_0x236b7e},'status':'COMPLETED'}}),_0x2e8925=_0x1bcd4e[_0x450dab(0x1d7)]['totalPaidOut']||0x0,_0x2537c9=_0x1bcd4e[_0x450dab(0x1d7)][_0x450dab(0x1bf)]||0x0,_0xeb2338=_0x1a2368[_0x450dab(0x1d7)]['amount']||0x0,_0x584b7e={'totalPayout':Math[_0x450dab(0x216)](_0x2e8925*0x64)/0x64,'awaitingPayout':Math[_0x450dab(0x216)](_0x2537c9*0x64)/0x64,'thisMonth':Math[_0x450dab(0x216)](_0xeb2338*0x64)/0x64,'availableBalance':Math[_0x450dab(0x216)](_0x2537c9*0x64)/0x64};return console[_0x450dab(0x1e5)](_0x450dab(0x1c0)),console[_0x450dab(0x1e5)](_0x450dab(0x1b5)+_0x584b7e['totalPayout']+_0x450dab(0x1a3)),console['log'](_0x450dab(0x1dd)+_0x584b7e[_0x450dab(0x206)]+_0x450dab(0x249)),console[_0x450dab(0x1e5)](_0x450dab(0x1ed)+_0x584b7e['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x450dab(0x1e5)](_0x450dab(0x1e1)+_0x584b7e['thisMonth']+'\x20USDT'),_0x584b7e;}async[a35_0x30910b(0x251)](_0x293eca,_0x53735f){const _0x37a38a=a35_0x30910b;console[_0x37a38a(0x1e5)](_0x37a38a(0x1a4)+_0x293eca+':',_0x53735f);const _0x28569a=await database_1[_0x37a38a(0x20e)][_0x37a38a(0x27a)][_0x37a38a(0x1de)]({'where':{'id':_0x293eca},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x28569a)throw new Error('Payment\x20not\x20found');const _0x209e76={};_0x53735f[_0x37a38a(0x274)]!==undefined&&(_0x209e76[_0x37a38a(0x274)]=_0x53735f[_0x37a38a(0x274)]||null);_0x53735f[_0x37a38a(0x266)]!==undefined&&(_0x209e76['customerIp']=_0x53735f[_0x37a38a(0x266)]||null);_0x53735f[_0x37a38a(0x272)]!==undefined&&(_0x209e76[_0x37a38a(0x272)]=_0x53735f['customerUa']||null);const _0x434469=await database_1[_0x37a38a(0x20e)][_0x37a38a(0x27a)][_0x37a38a(0x211)]({'where':{'id':_0x293eca},'data':{..._0x209e76,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x37a38a(0x1e5)]('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x293eca),console[_0x37a38a(0x1e5)](_0x37a38a(0x25a)+_0x28569a[_0x37a38a(0x274)]+_0x37a38a(0x242)+_0x434469['customerCountry']),console['log'](_0x37a38a(0x24c)+_0x28569a[_0x37a38a(0x266)]+_0x37a38a(0x242)+_0x434469[_0x37a38a(0x266)]),console[_0x37a38a(0x1e5)](_0x37a38a(0x1ee)+(_0x28569a[_0x37a38a(0x272)]?_0x37a38a(0x1d9):'not\x20set')+_0x37a38a(0x242)+(_0x434469[_0x37a38a(0x272)]?_0x37a38a(0x1d9):_0x37a38a(0x1e8))),_0x434469;}async[a35_0x30910b(0x25f)](_0x52b106){const _0x5537e7=a35_0x30910b,_0x79c233=new Date();let _0x504f8e;switch(_0x52b106){case'7d':_0x504f8e=new Date(_0x79c233[_0x5537e7(0x1ac)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5537e7(0x267):_0x504f8e=new Date(_0x79c233[_0x5537e7(0x1ac)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5537e7(0x22d):_0x504f8e=new Date(_0x79c233[_0x5537e7(0x1ac)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x504f8e=new Date(_0x79c233[_0x5537e7(0x1ac)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1c434f,_0x262f59,_0x592644,_0x5d7a2e,_0x8e1a39,_0x3a4ff2]=await Promise[_0x5537e7(0x230)]([database_1[_0x5537e7(0x20e)][_0x5537e7(0x1d1)][_0x5537e7(0x1aa)](),database_1[_0x5537e7(0x20e)][_0x5537e7(0x1d1)]['count']({'where':{'status':'ACTIVE'}}),database_1[_0x5537e7(0x20e)]['payment'][_0x5537e7(0x1aa)]({'where':{'createdAt':{'gte':_0x504f8e},'gateway':{'not':_0x5537e7(0x1ea)}}}),database_1[_0x5537e7(0x20e)][_0x5537e7(0x27a)][_0x5537e7(0x1aa)]({'where':{'status':'PAID','createdAt':{'gte':_0x504f8e},'gateway':{'not':'test_gateway'}}}),database_1[_0x5537e7(0x20e)]['payment']['findMany']({'where':{'status':_0x5537e7(0x218),'createdAt':{'gte':_0x504f8e},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x5537e7(0x20e)][_0x5537e7(0x27a)]['findMany']({'where':{'gateway':{'not':_0x5537e7(0x1ea)}},'take':0xa,'orderBy':{'createdAt':_0x5537e7(0x217)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x4d9f15=0x0;for(const _0x5a172a of _0x8e1a39){const _0x5e73b9=await currencyService_1[_0x5537e7(0x1ba)]['convertToUSDT'](_0x5a172a[_0x5537e7(0x201)],_0x5a172a['currency']);_0x4d9f15+=_0x5e73b9;}const _0x45505b=_0x592644>0x0?_0x5d7a2e/_0x592644*0x64:0x0;return{'totalShops':_0x1c434f,'activeShops':_0x262f59,'totalPayments':_0x592644,'successfulPayments':_0x5d7a2e,'totalRevenue':Math[_0x5537e7(0x216)](_0x4d9f15*0x64)/0x64,'conversionRate':Math[_0x5537e7(0x216)](_0x45505b*0x64)/0x64,'recentPayments':_0x3a4ff2[_0x5537e7(0x1c4)](_0x587cb6=>({'id':_0x587cb6['id'],'amount':_0x587cb6[_0x5537e7(0x201)],'currency':_0x587cb6[_0x5537e7(0x1ce)],'status':_0x587cb6[_0x5537e7(0x1f7)],'gateway':_0x587cb6[_0x5537e7(0x1a2)],'shop':_0x587cb6[_0x5537e7(0x1d1)],'createdAt':_0x587cb6[_0x5537e7(0x1c6)]}))};}async[a35_0x30910b(0x273)](_0x1b51cf){const _0x4f5054=a35_0x30910b;console[_0x4f5054(0x1e5)](_0x4f5054(0x22a),_0x1b51cf);let _0x3347df,_0x3af4c8=new Date();if(_0x1b51cf[_0x4f5054(0x22b)]==='custom'&&_0x1b51cf[_0x4f5054(0x229)]&&_0x1b51cf['dateTo'])_0x3347df=new Date(_0x1b51cf[_0x4f5054(0x229)]),_0x3af4c8=new Date(_0x1b51cf[_0x4f5054(0x1ad)]);else{const _0x1566ec=new Date();switch(_0x1b51cf['period']){case _0x4f5054(0x215):_0x3347df=new Date(_0x1566ec['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x3347df=new Date(_0x1566ec['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x3347df=new Date(_0x1566ec['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4f5054(0x230):default:_0x3347df=new Date('2020-01-01');break;}}console[_0x4f5054(0x1e5)]('üìÖ\x20Period:\x20'+_0x3347df[_0x4f5054(0x1fc)]()+'\x20to\x20'+_0x3af4c8[_0x4f5054(0x1fc)]());const _0x3dbeee={'status':_0x4f5054(0x218),'gateway':{'not':_0x4f5054(0x1ea)},'paidAt':{'gte':_0x3347df,'lte':_0x3af4c8}};_0x1b51cf['shopId']&&(_0x3dbeee[_0x4f5054(0x1e0)]=_0x1b51cf[_0x4f5054(0x1e0)]);const _0x228d7e=await database_1[_0x4f5054(0x20e)][_0x4f5054(0x27a)]['findMany']({'where':_0x3dbeee,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4f5054(0x1e5)](_0x4f5054(0x200)+_0x228d7e[_0x4f5054(0x221)]+_0x4f5054(0x23f));let _0x4a8f41=0x0,_0x1c754c=0x0,_0x170478=0x0;const _0x1ff392={},_0x308d9f={},_0x28ab39={};for(const _0x4dcbab of _0x228d7e){try{const _0x5682f2=await currencyService_1[_0x4f5054(0x1ba)][_0x4f5054(0x258)](_0x4dcbab['amount'],_0x4dcbab['currency']);let _0x3910a8={};if(_0x4dcbab[_0x4f5054(0x1d1)][_0x4f5054(0x202)])try{_0x3910a8=JSON['parse'](_0x4dcbab[_0x4f5054(0x1d1)][_0x4f5054(0x202)]);}catch(_0x445d4f){console[_0x4f5054(0x1f9)](_0x4f5054(0x1ff)+_0x4dcbab[_0x4f5054(0x1e0)]+':',_0x445d4f);}const _0x21d3fb=_0x3910a8[_0x4dcbab[_0x4f5054(0x1a2)]]||{},_0x4f31f7=_0x21d3fb[_0x4f5054(0x1b7)]||0xa,_0x5abd53=_0x5682f2*(_0x4f31f7/0x64),_0x514e23=_0x5682f2-_0x5abd53;_0x4a8f41+=_0x5682f2,_0x1c754c+=_0x514e23,_0x170478+=_0x5abd53;!_0x1ff392[_0x4dcbab[_0x4f5054(0x1a2)]]&&(_0x1ff392[_0x4dcbab[_0x4f5054(0x1a2)]]={'gateway':_0x4dcbab[_0x4f5054(0x1a2)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x4dcbab[_0x4f5054(0x1a2)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1ff392[_0x4dcbab[_0x4f5054(0x1a2)]][_0x4f5054(0x1ab)]++,_0x1ff392[_0x4dcbab[_0x4f5054(0x1a2)]][_0x4f5054(0x268)]+=_0x5682f2,_0x1ff392[_0x4dcbab[_0x4f5054(0x1a2)]][_0x4f5054(0x1db)]+=_0x5abd53,_0x1ff392[_0x4dcbab[_0x4f5054(0x1a2)]][_0x4f5054(0x246)]+=_0x514e23,_0x1ff392[_0x4dcbab['gateway']]['totalCommissionRate']+=_0x4f31f7;!_0x1b51cf['shopId']&&(!_0x308d9f[_0x4dcbab[_0x4f5054(0x1e0)]]&&(_0x308d9f[_0x4dcbab['shopId']]={'shopId':_0x4dcbab['shopId'],'shopName':_0x4dcbab[_0x4f5054(0x1d1)]['name'],'shopUsername':_0x4dcbab[_0x4f5054(0x1d1)][_0x4f5054(0x207)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x308d9f[_0x4dcbab[_0x4f5054(0x1e0)]]['paymentsCount']++,_0x308d9f[_0x4dcbab[_0x4f5054(0x1e0)]]['turnoverUSDT']+=_0x5682f2,_0x308d9f[_0x4dcbab[_0x4f5054(0x1e0)]]['commissionUSDT']+=_0x5abd53,_0x308d9f[_0x4dcbab[_0x4f5054(0x1e0)]][_0x4f5054(0x246)]+=_0x514e23);const _0x2fba83=_0x4dcbab['paidAt'][_0x4f5054(0x1fc)]()['split']('T')[0x0];!_0x28ab39[_0x2fba83]&&(_0x28ab39[_0x2fba83]={'date':_0x2fba83,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x28ab39[_0x2fba83][_0x4f5054(0x1b6)]+=_0x5682f2,_0x28ab39[_0x2fba83][_0x4f5054(0x25d)]+=_0x514e23,_0x28ab39[_0x2fba83][_0x4f5054(0x1c2)]+=_0x5abd53,_0x28ab39[_0x2fba83][_0x4f5054(0x1ab)]++;}catch(_0x118972){console[_0x4f5054(0x1f9)](_0x4f5054(0x20d)+_0x4dcbab['id']+':',_0x118972);}}Object[_0x4f5054(0x1e4)](_0x1ff392)[_0x4f5054(0x1bc)](_0x28176b=>{const _0xeb5bcf=_0x4f5054;_0x28176b[_0xeb5bcf(0x224)]=_0x28176b[_0xeb5bcf(0x1ab)]>0x0?_0x28176b[_0xeb5bcf(0x1f2)]/_0x28176b[_0xeb5bcf(0x1ab)]:0x0,delete _0x28176b[_0xeb5bcf(0x1f2)];}),Object[_0x4f5054(0x1e4)](_0x308d9f)['forEach'](_0x3aa4e1=>{const _0xc640a1=_0x4f5054;_0x3aa4e1[_0xc640a1(0x21e)]=_0x3aa4e1[_0xc640a1(0x1ab)]>0x0?_0x3aa4e1[_0xc640a1(0x268)]/_0x3aa4e1[_0xc640a1(0x1ab)]:0x0;});let _0xfa1c6a=0x0;if(_0x1b51cf[_0x4f5054(0x1e0)]){const _0x4a8d6d=await database_1[_0x4f5054(0x20e)][_0x4f5054(0x1c8)]['findMany']({'where':{'shopId':_0x1b51cf[_0x4f5054(0x1e0)],'status':_0x4f5054(0x25b),'createdAt':{'gte':_0x3347df,'lte':_0x3af4c8}},'select':{'amount':!![]}});_0xfa1c6a=_0x4a8d6d['reduce']((_0x278219,_0x1cf945)=>_0x278219+_0x1cf945[_0x4f5054(0x201)],0x0);}const _0x48685b=_0x228d7e[_0x4f5054(0x221)],_0x198f34=_0x228d7e[_0x4f5054(0x221)],_0x40f6dd=_0x48685b>0x0?_0x4a8f41/_0x48685b:0x0,_0x3061ba=0x64,_0x1a4dbe=Math['ceil']((_0x3af4c8[_0x4f5054(0x1ac)]()-_0x3347df[_0x4f5054(0x1ac)]())/(0x3e8*0x3c*0x3c*0x18)),_0x100c4c={'totalTurnover':Math[_0x4f5054(0x216)](_0x4a8f41*0x64)/0x64,'merchantEarnings':Math['round'](_0x1c754c*0x64)/0x64,'gatewayEarnings':Math[_0x4f5054(0x216)](_0x170478*0x64)/0x64,'totalPaidOut':Math[_0x4f5054(0x216)](_0xfa1c6a*0x64)/0x64,'averageCheck':Math[_0x4f5054(0x216)](_0x40f6dd*0x64)/0x64,'totalPayments':_0x48685b,'successfulPayments':_0x198f34,'conversionRate':_0x3061ba,'gatewayBreakdown':Object[_0x4f5054(0x1e4)](_0x1ff392)[_0x4f5054(0x1c4)](_0x14683d=>({..._0x14683d,'turnoverUSDT':Math['round'](_0x14683d[_0x4f5054(0x268)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x14683d['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x14683d[_0x4f5054(0x246)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x14683d[_0x4f5054(0x224)]*0x64)/0x64})),'merchantBreakdown':_0x1b51cf['shopId']?undefined:Object[_0x4f5054(0x1e4)](_0x308d9f)[_0x4f5054(0x1c4)](_0x472766=>({..._0x472766,'turnoverUSDT':Math[_0x4f5054(0x216)](_0x472766[_0x4f5054(0x268)]*0x64)/0x64,'commissionUSDT':Math[_0x4f5054(0x216)](_0x472766[_0x4f5054(0x1db)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x472766['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x4f5054(0x216)](_0x472766[_0x4f5054(0x1c1)]*0x64)/0x64,'averageCheckUSDT':Math[_0x4f5054(0x216)](_0x472766[_0x4f5054(0x21e)]*0x64)/0x64})),'dailyData':Object[_0x4f5054(0x1e4)](_0x28ab39)[_0x4f5054(0x1c4)](_0x43be24=>({..._0x43be24,'turnover':Math['round'](_0x43be24['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x4f5054(0x216)](_0x43be24[_0x4f5054(0x25d)]*0x64)/0x64,'gatewayEarnings':Math[_0x4f5054(0x216)](_0x43be24[_0x4f5054(0x1c2)]*0x64)/0x64}))['sort']((_0x58ea49,_0x260b1f)=>_0x58ea49[_0x4f5054(0x1b4)][_0x4f5054(0x1a7)](_0x260b1f[_0x4f5054(0x1b4)])),'periodInfo':{'from':_0x3347df,'to':_0x3af4c8,'periodType':_0x1b51cf[_0x4f5054(0x22b)]||'custom','daysCount':_0x1a4dbe}};return console[_0x4f5054(0x1e5)](_0x4f5054(0x1c7)),console[_0x4f5054(0x1e5)](_0x4f5054(0x1c5)+_0x100c4c[_0x4f5054(0x228)]+_0x4f5054(0x1eb)),console['log']('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x100c4c['merchantEarnings']+_0x4f5054(0x1eb)),console[_0x4f5054(0x1e5)](_0x4f5054(0x222)+_0x100c4c[_0x4f5054(0x1c2)]+_0x4f5054(0x1eb)),console[_0x4f5054(0x1e5)](_0x4f5054(0x227)+_0x100c4c['totalPayments']),_0x100c4c;}[a35_0x30910b(0x250)](_0x4f47c4){const _0x40e2bc=a35_0x30910b,_0x34b3b5={'test_gateway':_0x40e2bc(0x26c),'plisio':_0x40e2bc(0x1bb),'rapyd':_0x40e2bc(0x1bd),'noda':_0x40e2bc(0x252),'cointopay':'CoinToPay','klyme_eu':_0x40e2bc(0x26f),'klyme_gb':_0x40e2bc(0x203),'klyme_de':'KLYME\x20DE'};return _0x34b3b5[_0x4f47c4]||_0x4f47c4;}async['getMerchantsAwaitingPayout'](_0x570a87){const _0x4ecea4=a35_0x30910b,{page:_0x5557e3,limit:_0x50a7fd,minAmount:_0xbe5364,search:_0x126627}=_0x570a87,_0x15c4f1=(_0x5557e3-0x1)*_0x50a7fd;console['log']('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x570a87);const _0x3d8e19={'balance':{'gt':0x0},'status':_0x4ecea4(0x253)};_0xbe5364&&(_0x3d8e19[_0x4ecea4(0x1bf)][_0x4ecea4(0x205)]=_0xbe5364);_0x126627&&(_0x3d8e19['OR']=[{'name':{'contains':_0x126627,'mode':_0x4ecea4(0x1c3)}},{'username':{'contains':_0x126627,'mode':_0x4ecea4(0x1c3)}}]);const [_0x494817,_0x3ef5a1]=await Promise[_0x4ecea4(0x230)]([database_1['default'][_0x4ecea4(0x1d1)][_0x4ecea4(0x1b0)]({'where':_0x3d8e19,'skip':_0x15c4f1,'take':_0x50a7fd,'orderBy':{'balance':_0x4ecea4(0x217)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x4ecea4(0x20e)]['shop']['count']({'where':_0x3d8e19})]);console['log'](_0x4ecea4(0x200)+_0x494817['length']+_0x4ecea4(0x254));const _0x4117a4=await Promise[_0x4ecea4(0x230)](_0x494817['map'](async _0x5f278b=>{const _0x3496ca=_0x4ecea4,[_0x3a6447,_0x4d5b27,_0x14efb8]=await Promise['all']([database_1[_0x3496ca(0x20e)][_0x3496ca(0x27a)][_0x3496ca(0x1aa)]({'where':{'shopId':_0x5f278b['id'],'status':_0x3496ca(0x218),'amountUSDT':{'not':null}}}),database_1[_0x3496ca(0x20e)][_0x3496ca(0x27a)][_0x3496ca(0x231)]({'where':{'shopId':_0x5f278b['id'],'status':_0x3496ca(0x218),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x3496ca(0x1f0)},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x3496ca(0x226)]({'by':[_0x3496ca(0x1a2)],'where':{'shopId':_0x5f278b['id'],'status':_0x3496ca(0x218),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x57baa2=_0x14efb8[_0x3496ca(0x1c4)](_0x1bb925=>({'gateway':_0x1bb925[_0x3496ca(0x1a2)],'count':_0x1bb925[_0x3496ca(0x1fb)]['id'],'amountUSDT':_0x1bb925[_0x3496ca(0x1d7)]['amountUSDT']||0x0,'amountAfterCommissionUSDT':_0x1bb925[_0x3496ca(0x1d7)][_0x3496ca(0x238)]||0x0,'commission':0x0}));return{'id':_0x5f278b['id'],'fullName':_0x5f278b[_0x3496ca(0x204)],'username':_0x5f278b[_0x3496ca(0x207)],'telegramId':_0x5f278b[_0x3496ca(0x256)],'merchantUrl':_0x5f278b[_0x3496ca(0x20b)],'wallets':{'usdtPolygonWallet':_0x5f278b['usdtPolygonWallet'],'usdtTrcWallet':_0x5f278b[_0x3496ca(0x259)],'usdtErcWallet':_0x5f278b[_0x3496ca(0x232)],'usdcPolygonWallet':_0x5f278b[_0x3496ca(0x264)]},'totalAmountUSDT':_0x5f278b[_0x3496ca(0x1bf)],'totalAmountAfterCommissionUSDT':_0x5f278b['balance'],'paymentsCount':_0x3a6447,'oldestPaymentDate':_0x4d5b27?.['paidAt']||_0x5f278b[_0x3496ca(0x1c6)],'gatewayBreakdown':_0x57baa2};})),_0x946e3a=_0x494817[_0x4ecea4(0x1d4)]((_0x183b28,_0xdd40be)=>_0x183b28+_0xdd40be[_0x4ecea4(0x1bf)],0x0),_0x35af06=_0x946e3a;return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x3ef5a1+'\x20merchants,\x20'+Math['round'](_0x35af06*0x64)/0x64+_0x4ecea4(0x278)),{'merchants':_0x4117a4,'pagination':{'page':_0x5557e3,'limit':_0x50a7fd,'total':_0x3ef5a1,'totalPages':Math['ceil'](_0x3ef5a1/_0x50a7fd)},'summary':{'totalMerchants':_0x3ef5a1,'totalAmountUSDT':Math['round'](_0x946e3a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4ecea4(0x216)](_0x35af06*0x64)/0x64}};}async[a35_0x30910b(0x1f3)](_0x595f60){const _0x399d17=a35_0x30910b,{shopId:_0x22a4c8,amount:_0x29a0d8,network:_0x597f09,wallet:_0xb2e97a,notes:_0x3a3728,txid:_0x1225c0,periodFrom:_0x14455c,periodTo:_0x2ab099}=_0x595f60,_0x749ad1=await database_1[_0x399d17(0x20e)][_0x399d17(0x245)](async _0x46ec39=>{const _0x5c7af1=_0x399d17,_0xfe175c=await _0x46ec39['shop']['findUnique']({'where':{'id':_0x22a4c8},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xfe175c)throw new Error(_0x5c7af1(0x1d8));console[_0x5c7af1(0x1e5)]('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0xfe175c[_0x5c7af1(0x207)]+':'),console['log'](_0x5c7af1(0x209)+_0xfe175c[_0x5c7af1(0x1bf)][_0x5c7af1(0x212)](0x6)+'\x20USDT'),console[_0x5c7af1(0x1e5)](_0x5c7af1(0x24d)+_0x29a0d8[_0x5c7af1(0x212)](0x6)+_0x5c7af1(0x1eb)),console['log']('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0xfe175c[_0x5c7af1(0x23d)]['toFixed'](0x6)+'\x20USDT');if(_0x1225c0)console['log'](_0x5c7af1(0x1f5)+_0x1225c0);if(_0xfe175c['balance']<_0x29a0d8)throw new Error(_0x5c7af1(0x21d)+_0xfe175c[_0x5c7af1(0x1bf)]['toFixed'](0x6)+_0x5c7af1(0x276)+_0x29a0d8['toFixed'](0x6)+'\x20USDT');let _0x26af78=_0xb2e97a;if(!_0x26af78){const _0x4249b7=await _0x46ec39[_0x5c7af1(0x1d1)][_0x5c7af1(0x1de)]({'where':{'id':_0x22a4c8},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4249b7)switch(_0x597f09){case _0x5c7af1(0x248):_0x26af78=_0x4249b7[_0x5c7af1(0x271)]||undefined;break;case'trc20':_0x26af78=_0x4249b7[_0x5c7af1(0x259)]||undefined;break;case _0x5c7af1(0x20a):_0x26af78=_0x4249b7['usdtErcWallet']||undefined;break;case _0x5c7af1(0x1e2):_0x26af78=_0x4249b7[_0x5c7af1(0x264)]||undefined;break;}}console[_0x5c7af1(0x1e5)](_0x5c7af1(0x261)+_0x597f09+':\x20'+(_0x26af78||'not\x20specified'));const _0x184713=await _0x46ec39[_0x5c7af1(0x1c8)][_0x5c7af1(0x21f)]({'data':{'shopId':_0x22a4c8,'amount':_0x29a0d8,'network':_0x597f09,'status':_0x5c7af1(0x25b),'txid':_0x1225c0,'notes':_0x3a3728,'periodFrom':_0x14455c?new Date(_0x14455c):null,'periodTo':_0x2ab099?new Date(_0x2ab099):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3a0bde=_0xfe175c['balance']-_0x29a0d8,_0x4e15b6=_0xfe175c[_0x5c7af1(0x23d)]+_0x29a0d8;return await _0x46ec39[_0x5c7af1(0x1d1)][_0x5c7af1(0x211)]({'where':{'id':_0x22a4c8},'data':{'balance':_0x3a0bde,'totalPaidOut':_0x4e15b6}}),console[_0x5c7af1(0x1e5)](_0x5c7af1(0x1f6)+_0xfe175c['username']+'\x20balance\x20updated:'),console['log'](_0x5c7af1(0x1a5)+_0xfe175c[_0x5c7af1(0x1bf)][_0x5c7af1(0x212)](0x6)+_0x5c7af1(0x242)+_0x3a0bde[_0x5c7af1(0x212)](0x6)+_0x5c7af1(0x243)+_0x29a0d8[_0x5c7af1(0x212)](0x6)+')'),console[_0x5c7af1(0x1e5)](_0x5c7af1(0x1b2)+_0xfe175c[_0x5c7af1(0x23d)][_0x5c7af1(0x212)](0x6)+_0x5c7af1(0x242)+_0x4e15b6['toFixed'](0x6)+_0x5c7af1(0x277)+_0x29a0d8[_0x5c7af1(0x212)](0x6)+')'),{'payout':_0x184713,'shop':_0xfe175c};});return console['log'](_0x399d17(0x1be)+_0x749ad1[_0x399d17(0x1c8)]['id']+_0x399d17(0x1ae)+_0x749ad1[_0x399d17(0x1d1)][_0x399d17(0x207)]+'\x20('+_0x29a0d8+_0x399d17(0x24a)),{'id':_0x749ad1[_0x399d17(0x1c8)]['id'],'shopId':_0x749ad1['payout']['shopId'],'shopName':_0x749ad1[_0x399d17(0x1d1)][_0x399d17(0x204)],'shopUsername':_0x749ad1[_0x399d17(0x1d1)]['username'],'amount':_0x749ad1[_0x399d17(0x1c8)][_0x399d17(0x201)],'network':_0x749ad1['payout'][_0x399d17(0x20f)],'status':_0x749ad1['payout']['status'],'txid':_0x749ad1[_0x399d17(0x1c8)][_0x399d17(0x1d2)],'notes':_0x749ad1[_0x399d17(0x1c8)][_0x399d17(0x220)],'periodFrom':_0x749ad1[_0x399d17(0x1c8)][_0x399d17(0x270)],'periodTo':_0x749ad1[_0x399d17(0x1c8)][_0x399d17(0x21a)],'createdAt':_0x749ad1[_0x399d17(0x1c8)][_0x399d17(0x1c6)],'paidAt':_0x749ad1[_0x399d17(0x1c8)]['paidAt']};}async[a35_0x30910b(0x225)](_0x56d8c5){const _0x442f2a=a35_0x30910b,{page:_0x304351,limit:_0x18c782,shopId:_0x20f5b8,network:_0x59a4fc,dateFrom:_0x3d1b3e,dateTo:_0x40aa18,search:_0x4f05c1}=_0x56d8c5,_0x2b4ca4=(_0x304351-0x1)*_0x18c782,_0x4e0ee9={};_0x20f5b8&&(_0x4e0ee9[_0x442f2a(0x1e0)]=_0x20f5b8);_0x59a4fc&&(_0x4e0ee9[_0x442f2a(0x20f)]=_0x59a4fc);(_0x3d1b3e||_0x40aa18)&&(_0x4e0ee9['createdAt']={},_0x3d1b3e&&(_0x4e0ee9['createdAt'][_0x442f2a(0x205)]=new Date(_0x3d1b3e)),_0x40aa18&&(_0x4e0ee9[_0x442f2a(0x1c6)]['lte']=new Date(_0x40aa18)));_0x4f05c1&&(_0x4e0ee9['OR']=[{'shop':{'name':{'contains':_0x4f05c1,'mode':_0x442f2a(0x1c3)}}},{'shop':{'username':{'contains':_0x4f05c1,'mode':_0x442f2a(0x1c3)}}},{'notes':{'contains':_0x4f05c1,'mode':_0x442f2a(0x1c3)}}]);const [_0x270da4,_0x13cc19]=await Promise[_0x442f2a(0x230)]([database_1[_0x442f2a(0x20e)][_0x442f2a(0x1c8)][_0x442f2a(0x1b0)]({'where':_0x4e0ee9,'skip':_0x2b4ca4,'take':_0x18c782,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x442f2a(0x20e)][_0x442f2a(0x1c8)][_0x442f2a(0x1aa)]({'where':_0x4e0ee9})]);return{'payouts':_0x270da4[_0x442f2a(0x1c4)](_0x378dc9=>({'id':_0x378dc9['id'],'shopId':_0x378dc9[_0x442f2a(0x1e0)],'shopName':_0x378dc9[_0x442f2a(0x1d1)][_0x442f2a(0x204)],'shopUsername':_0x378dc9['shop'][_0x442f2a(0x207)],'amount':_0x378dc9[_0x442f2a(0x201)],'network':_0x378dc9[_0x442f2a(0x20f)],'status':_0x378dc9[_0x442f2a(0x1f7)],'txid':_0x378dc9[_0x442f2a(0x1d2)],'notes':_0x378dc9[_0x442f2a(0x220)],'periodFrom':_0x378dc9[_0x442f2a(0x270)],'periodTo':_0x378dc9[_0x442f2a(0x21a)],'createdAt':_0x378dc9[_0x442f2a(0x1c6)],'paidAt':_0x378dc9[_0x442f2a(0x1b9)]})),'pagination':{'page':_0x304351,'limit':_0x18c782,'total':_0x13cc19,'totalPages':Math[_0x442f2a(0x279)](_0x13cc19/_0x18c782)}};}async['getPayoutById'](_0x5e5083){const _0x1351e0=a35_0x30910b,_0xbef317=await database_1[_0x1351e0(0x20e)]['payout'][_0x1351e0(0x1de)]({'where':{'id':_0x5e5083},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xbef317)return null;return{'id':_0xbef317['id'],'shopId':_0xbef317['shopId'],'shopName':_0xbef317[_0x1351e0(0x1d1)]['name'],'shopUsername':_0xbef317[_0x1351e0(0x1d1)][_0x1351e0(0x207)],'amount':_0xbef317['amount'],'network':_0xbef317[_0x1351e0(0x20f)],'status':_0xbef317[_0x1351e0(0x1f7)],'txid':_0xbef317['txid'],'notes':_0xbef317[_0x1351e0(0x220)],'periodFrom':_0xbef317[_0x1351e0(0x270)],'periodTo':_0xbef317[_0x1351e0(0x21a)],'createdAt':_0xbef317[_0x1351e0(0x1c6)],'paidAt':_0xbef317[_0x1351e0(0x1b9)]};}async[a35_0x30910b(0x24b)](_0x1f8a9e){const _0x842f8d=a35_0x30910b;await database_1[_0x842f8d(0x20e)][_0x842f8d(0x1c8)][_0x842f8d(0x1b1)]({'where':{'id':_0x1f8a9e}});}async['getAllPayments'](_0x4bcebc){const _0x2c0698=a35_0x30910b,{page:_0x5b3535,limit:_0x3c6eb1,status:_0x103ce6,gateway:_0x575760,shopId:_0x293fa7,dateFrom:_0x4c60f9,dateTo:_0x51004d,search:_0x43a380}=_0x4bcebc,_0xdd22b8=(_0x5b3535-0x1)*_0x3c6eb1,_0x11fba3={};_0x103ce6&&(_0x11fba3[_0x2c0698(0x1f7)]=_0x103ce6[_0x2c0698(0x1b3)]());_0x575760&&(_0x11fba3[_0x2c0698(0x1a2)]=_0x575760['toLowerCase']());_0x11fba3[_0x2c0698(0x1a2)]=_0x11fba3[_0x2c0698(0x1a2)]?_0x11fba3['gateway']:{'not':_0x2c0698(0x1ea)};if(typeof _0x11fba3['gateway']===_0x2c0698(0x1ef)&&_0x11fba3[_0x2c0698(0x1a2)]!==_0x2c0698(0x1ea)){}else{if(typeof _0x11fba3[_0x2c0698(0x1a2)]===_0x2c0698(0x1ef)&&_0x11fba3['gateway']===_0x2c0698(0x1ea)){}else _0x11fba3[_0x2c0698(0x1a2)]={'not':_0x2c0698(0x1ea)};}_0x293fa7&&(_0x11fba3[_0x2c0698(0x1e0)]=_0x293fa7);(_0x4c60f9||_0x51004d)&&(_0x11fba3[_0x2c0698(0x1c6)]={},_0x4c60f9&&(_0x11fba3[_0x2c0698(0x1c6)][_0x2c0698(0x205)]=new Date(_0x4c60f9)),_0x51004d&&(_0x11fba3[_0x2c0698(0x1c6)]['lte']=new Date(_0x51004d)));_0x43a380&&(_0x11fba3['OR']=[{'orderId':{'contains':_0x43a380,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x43a380,'mode':_0x2c0698(0x1c3)}},{'customerEmail':{'contains':_0x43a380,'mode':_0x2c0698(0x1c3)}},{'shop':{'name':{'contains':_0x43a380,'mode':_0x2c0698(0x1c3)}}},{'shop':{'username':{'contains':_0x43a380,'mode':_0x2c0698(0x1c3)}}}]);const [_0x1bec87,_0x259e80]=await Promise[_0x2c0698(0x230)]([database_1[_0x2c0698(0x20e)]['payment'][_0x2c0698(0x1b0)]({'where':_0x11fba3,'skip':_0xdd22b8,'take':_0x3c6eb1,'orderBy':{'createdAt':_0x2c0698(0x217)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2c0698(0x20e)][_0x2c0698(0x27a)][_0x2c0698(0x1aa)]({'where':_0x11fba3})]);return{'payments':_0x1bec87[_0x2c0698(0x1c4)](_0x41f418=>({'id':_0x41f418['id'],'shopId':_0x41f418['shopId'],'gateway':_0x41f418[_0x2c0698(0x1a2)],'amount':_0x41f418['amount'],'currency':_0x41f418['currency'],'status':_0x41f418[_0x2c0698(0x1f7)],'orderId':_0x41f418[_0x2c0698(0x239)],'gatewayOrderId':_0x41f418[_0x2c0698(0x247)],'customerEmail':_0x41f418[_0x2c0698(0x26d)],'customerName':_0x41f418[_0x2c0698(0x213)],'customerCountry':_0x41f418[_0x2c0698(0x274)],'customerIp':_0x41f418[_0x2c0698(0x266)],'customerUa':_0x41f418[_0x2c0698(0x272)],'failureMessage':_0x41f418[_0x2c0698(0x235)],'createdAt':_0x41f418[_0x2c0698(0x1c6)],'updatedAt':_0x41f418[_0x2c0698(0x21c)],'shop':_0x41f418[_0x2c0698(0x1d1)]})),'pagination':{'page':_0x5b3535,'limit':_0x3c6eb1,'total':_0x259e80,'totalPages':Math[_0x2c0698(0x279)](_0x259e80/_0x3c6eb1)}};}async[a35_0x30910b(0x1ec)](_0x3f886e){const _0x202b28=a35_0x30910b,_0x270709=await database_1['default'][_0x202b28(0x27a)][_0x202b28(0x1de)]({'where':{'id':_0x3f886e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x270709)return null;return{'id':_0x270709['id'],'shopId':_0x270709['shopId'],'gateway':_0x270709[_0x202b28(0x1a2)],'amount':_0x270709[_0x202b28(0x201)],'currency':_0x270709['currency'],'status':_0x270709[_0x202b28(0x1f7)],'orderId':_0x270709[_0x202b28(0x239)],'gatewayOrderId':_0x270709[_0x202b28(0x247)],'customerEmail':_0x270709['customerEmail'],'customerName':_0x270709['customerName'],'customerCountry':_0x270709[_0x202b28(0x274)],'customerIp':_0x270709[_0x202b28(0x266)],'customerUa':_0x270709[_0x202b28(0x272)],'failureMessage':_0x270709['failureMessage'],'externalPaymentUrl':_0x270709[_0x202b28(0x236)],'successUrl':_0x270709[_0x202b28(0x262)],'failUrl':_0x270709['failUrl'],'pendingUrl':_0x270709[_0x202b28(0x263)],'whiteUrl':_0x270709[_0x202b28(0x223)],'createdAt':_0x270709[_0x202b28(0x1c6)],'updatedAt':_0x270709[_0x202b28(0x21c)],'shop':_0x270709[_0x202b28(0x1d1)]};}async[a35_0x30910b(0x1f4)](_0x5e9879,_0xec3f3f,_0x299995,_0x293761){const _0x58c13b=a35_0x30910b,_0x1217b3=await database_1['default'][_0x58c13b(0x245)](async _0x24d825=>{const _0x441f1a=_0x58c13b,_0x522be3=await _0x24d825[_0x441f1a(0x27a)][_0x441f1a(0x1de)]({'where':{'id':_0x5e9879},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x522be3)throw new Error(_0x441f1a(0x1dc));const _0x192583=_0x522be3[_0x441f1a(0x1f7)],_0x44eae3=_0xec3f3f[_0x441f1a(0x1b3)]();console[_0x441f1a(0x1e5)](_0x441f1a(0x26b)+_0x5e9879+_0x441f1a(0x1ca)+_0x192583+_0x441f1a(0x242)+_0x44eae3),console['log'](_0x441f1a(0x1d3)+_0x522be3[_0x441f1a(0x1d1)][_0x441f1a(0x1bf)]+_0x441f1a(0x1eb));const _0x3c100a={'status':_0x44eae3,'updatedAt':new Date(),'statusChangedBy':_0x441f1a(0x255),'statusChangedAt':new Date()};_0x299995&&(_0x3c100a[_0x441f1a(0x210)]=_0x299995);_0x44eae3===_0x441f1a(0x1a9)&&_0x293761&&(_0x3c100a[_0x441f1a(0x1d0)]=_0x293761);let _0x843ff2=0x0,_0x3dad84=_0x522be3['shop'][_0x441f1a(0x1bf)];if(_0x44eae3==='PAID'&&_0x192583!==_0x441f1a(0x218)){_0x3c100a[_0x441f1a(0x1b9)]=new Date();const _0x5741e9=await currencyService_1['currencyService'][_0x441f1a(0x258)](_0x522be3[_0x441f1a(0x201)],_0x522be3[_0x441f1a(0x1ce)]);_0x3c100a['amountUSDT']=_0x5741e9,_0x843ff2=_0x5741e9,_0x3dad84+=_0x5741e9,console[_0x441f1a(0x1e5)](_0x441f1a(0x1e7)+_0x5e9879+_0x441f1a(0x24f)+_0x5741e9[_0x441f1a(0x212)](0x6)+'\x20USDT\x20to\x20balance');}else _0x192583===_0x441f1a(0x218)&&_0x44eae3!==_0x441f1a(0x218)&&(_0x522be3[_0x441f1a(0x238)]&&(_0x843ff2=-_0x522be3[_0x441f1a(0x238)],_0x3dad84-=_0x522be3['amountUSDT'],_0x3c100a[_0x441f1a(0x238)]=null,console[_0x441f1a(0x1e5)](_0x441f1a(0x1e7)+_0x5e9879+'\x20no\x20longer\x20PAID:\x20-'+_0x522be3[_0x441f1a(0x238)][_0x441f1a(0x212)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x44eae3===_0x441f1a(0x1a9)){if(_0x192583==='PAID'&&_0x522be3[_0x441f1a(0x238)]){}_0x293761&&_0x293761>0x0&&(_0x843ff2-=_0x293761,_0x3dad84-=_0x293761,console['log'](_0x441f1a(0x241)+_0x293761[_0x441f1a(0x212)](0x6)+_0x441f1a(0x23c)));}_0x44eae3==='REFUND'&&_0x192583===_0x441f1a(0x218)&&console['log'](_0x441f1a(0x23b));const _0x4d764b=await _0x24d825[_0x441f1a(0x27a)]['update']({'where':{'id':_0x5e9879},'data':_0x3c100a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x843ff2!==0x0&&(await _0x24d825[_0x441f1a(0x1d1)][_0x441f1a(0x211)]({'where':{'id':_0x522be3[_0x441f1a(0x1e0)]},'data':{'balance':_0x3dad84}}),console[_0x441f1a(0x1e5)]('üí∞\x20Shop\x20'+_0x522be3['shopId']+_0x441f1a(0x1d6)+_0x522be3[_0x441f1a(0x1d1)]['balance'][_0x441f1a(0x212)](0x6)+'\x20->\x20'+_0x3dad84[_0x441f1a(0x212)](0x6)+'\x20USDT\x20('+(_0x843ff2>0x0?'+':'')+_0x843ff2[_0x441f1a(0x212)](0x6)+')')),_0x4d764b;});return{'id':_0x1217b3['id'],'shopId':_0x1217b3['shopId'],'gateway':_0x1217b3[_0x58c13b(0x1a2)],'amount':_0x1217b3[_0x58c13b(0x201)],'currency':_0x1217b3[_0x58c13b(0x1ce)],'status':_0x1217b3['status'],'orderId':_0x1217b3[_0x58c13b(0x239)],'gatewayOrderId':_0x1217b3['gatewayOrderId'],'customerEmail':_0x1217b3['customerEmail'],'customerName':_0x1217b3[_0x58c13b(0x213)],'customerCountry':_0x1217b3[_0x58c13b(0x274)],'customerIp':_0x1217b3[_0x58c13b(0x266)],'customerUa':_0x1217b3['customerUa'],'failureMessage':_0x1217b3[_0x58c13b(0x235)],'adminNotes':_0x1217b3[_0x58c13b(0x210)],'chargebackAmount':_0x1217b3[_0x58c13b(0x1d0)],'statusChangedBy':_0x1217b3['statusChangedBy'],'statusChangedAt':_0x1217b3[_0x58c13b(0x260)],'createdAt':_0x1217b3['createdAt'],'updatedAt':_0x1217b3[_0x58c13b(0x21c)],'shop':_0x1217b3[_0x58c13b(0x1d1)]};}async[a35_0x30910b(0x1a6)](_0x3da0b4,_0x4fdad6){const _0x2f293f=a35_0x30910b,_0x2cdeb5={..._0x4fdad6};_0x4fdad6[_0x2f293f(0x257)]&&(_0x2cdeb5[_0x2f293f(0x257)]=await bcryptjs_1[_0x2f293f(0x20e)][_0x2f293f(0x25c)](_0x4fdad6['password'],0xc));_0x4fdad6[_0x2f293f(0x240)]&&(_0x2cdeb5['name']=_0x4fdad6['fullName'],delete _0x2cdeb5[_0x2f293f(0x240)]);_0x4fdad6['telegramId']&&(_0x2cdeb5['telegram']=_0x4fdad6[_0x2f293f(0x1e6)],delete _0x2cdeb5[_0x2f293f(0x1e6)]);_0x4fdad6[_0x2f293f(0x1cd)]&&(_0x2cdeb5[_0x2f293f(0x20b)]=_0x4fdad6['merchantUrl'],delete _0x2cdeb5[_0x2f293f(0x1cd)]);_0x4fdad6['gateways']&&(_0x2cdeb5[_0x2f293f(0x1fa)]=JSON[_0x2f293f(0x1cc)](_0x4fdad6[_0x2f293f(0x1a8)]),delete _0x2cdeb5[_0x2f293f(0x1a8)]);_0x4fdad6['gatewaySettings']&&(_0x2cdeb5[_0x2f293f(0x202)]=JSON[_0x2f293f(0x1cc)](_0x4fdad6[_0x2f293f(0x202)]),delete _0x2cdeb5[_0x2f293f(0x202)]);_0x4fdad6['wallets']&&(_0x4fdad6[_0x2f293f(0x1d5)][_0x2f293f(0x271)]!==undefined&&(_0x2cdeb5[_0x2f293f(0x271)]=_0x4fdad6[_0x2f293f(0x1d5)][_0x2f293f(0x271)]||null),_0x4fdad6['wallets'][_0x2f293f(0x259)]!==undefined&&(_0x2cdeb5[_0x2f293f(0x259)]=_0x4fdad6[_0x2f293f(0x1d5)]['usdtTrcWallet']||null),_0x4fdad6['wallets'][_0x2f293f(0x232)]!==undefined&&(_0x2cdeb5['usdtErcWallet']=_0x4fdad6[_0x2f293f(0x1d5)][_0x2f293f(0x232)]||null),_0x4fdad6[_0x2f293f(0x1d5)][_0x2f293f(0x264)]!==undefined&&(_0x2cdeb5[_0x2f293f(0x264)]=_0x4fdad6[_0x2f293f(0x1d5)][_0x2f293f(0x264)]||null),delete _0x2cdeb5['wallets']);const _0xcf4bc3=await database_1[_0x2f293f(0x20e)][_0x2f293f(0x1d1)][_0x2f293f(0x211)]({'where':{'id':_0x3da0b4},'data':_0x2cdeb5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xcf4bc3['id'],'fullName':_0xcf4bc3[_0x2f293f(0x204)],'username':_0xcf4bc3[_0x2f293f(0x207)],'telegramId':_0xcf4bc3[_0x2f293f(0x256)],'merchantUrl':_0xcf4bc3['shopUrl'],'gateways':_0xcf4bc3['paymentGateways']?JSON[_0x2f293f(0x1fd)](_0xcf4bc3[_0x2f293f(0x1fa)]):null,'gatewaySettings':_0xcf4bc3['gatewaySettings']?JSON[_0x2f293f(0x1fd)](_0xcf4bc3[_0x2f293f(0x202)]):null,'publicKey':_0xcf4bc3[_0x2f293f(0x26e)],'wallets':{'usdtPolygonWallet':_0xcf4bc3[_0x2f293f(0x271)],'usdtTrcWallet':_0xcf4bc3[_0x2f293f(0x259)],'usdtErcWallet':_0xcf4bc3[_0x2f293f(0x232)],'usdcPolygonWallet':_0xcf4bc3[_0x2f293f(0x264)]},'status':_0xcf4bc3[_0x2f293f(0x1f7)],'createdAt':_0xcf4bc3['createdAt']};}async[a35_0x30910b(0x1da)](_0x3e66da){const _0x39bf8c=a35_0x30910b,_0x3da99d=await database_1['default'][_0x39bf8c(0x1d1)][_0x39bf8c(0x211)]({'where':{'id':_0x3e66da},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3da99d['id'],'fullName':_0x3da99d[_0x39bf8c(0x204)],'username':_0x3da99d[_0x39bf8c(0x207)],'telegramId':_0x3da99d[_0x39bf8c(0x256)],'merchantUrl':_0x3da99d[_0x39bf8c(0x20b)],'gateways':_0x3da99d[_0x39bf8c(0x1fa)]?JSON[_0x39bf8c(0x1fd)](_0x3da99d[_0x39bf8c(0x1fa)]):null,'gatewaySettings':_0x3da99d['gatewaySettings']?JSON[_0x39bf8c(0x1fd)](_0x3da99d[_0x39bf8c(0x202)]):null,'publicKey':_0x3da99d[_0x39bf8c(0x26e)],'wallets':{'usdtPolygonWallet':_0x3da99d[_0x39bf8c(0x271)],'usdtTrcWallet':_0x3da99d[_0x39bf8c(0x259)],'usdtErcWallet':_0x3da99d[_0x39bf8c(0x232)],'usdcPolygonWallet':_0x3da99d['usdcPolygonWallet']},'status':_0x3da99d[_0x39bf8c(0x1f7)],'createdAt':_0x3da99d[_0x39bf8c(0x1c6)]};}async[a35_0x30910b(0x214)](_0xd3ffd9){const _0xf7bb85=a35_0x30910b,_0x5117fa=await database_1[_0xf7bb85(0x20e)]['shop'][_0xf7bb85(0x211)]({'where':{'id':_0xd3ffd9},'data':{'status':_0xf7bb85(0x253)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5117fa['id'],'fullName':_0x5117fa[_0xf7bb85(0x204)],'username':_0x5117fa[_0xf7bb85(0x207)],'telegramId':_0x5117fa[_0xf7bb85(0x256)],'merchantUrl':_0x5117fa[_0xf7bb85(0x20b)],'gateways':_0x5117fa[_0xf7bb85(0x1fa)]?JSON[_0xf7bb85(0x1fd)](_0x5117fa[_0xf7bb85(0x1fa)]):null,'gatewaySettings':_0x5117fa['gatewaySettings']?JSON[_0xf7bb85(0x1fd)](_0x5117fa[_0xf7bb85(0x202)]):null,'publicKey':_0x5117fa[_0xf7bb85(0x26e)],'wallets':{'usdtPolygonWallet':_0x5117fa[_0xf7bb85(0x271)],'usdtTrcWallet':_0x5117fa[_0xf7bb85(0x259)],'usdtErcWallet':_0x5117fa[_0xf7bb85(0x232)],'usdcPolygonWallet':_0x5117fa[_0xf7bb85(0x264)]},'status':_0x5117fa['status'],'createdAt':_0x5117fa[_0xf7bb85(0x1c6)]};}async[a35_0x30910b(0x1f8)](_0x3a3066){const _0x79ea3a=a35_0x30910b,{page:_0xce1a75,limit:_0x5d3e0f,status:_0xd8b71d}=_0x3a3066,_0xad46d=(_0xce1a75-0x1)*_0x5d3e0f,_0x43ef76={};_0xd8b71d&&(_0x43ef76[_0x79ea3a(0x1f7)]=_0xd8b71d[_0x79ea3a(0x1b3)]());const [_0x223bcf,_0x5e079d]=await Promise['all']([database_1[_0x79ea3a(0x20e)][_0x79ea3a(0x1d1)][_0x79ea3a(0x1b0)]({'where':_0x43ef76,'skip':_0xad46d,'take':_0x5d3e0f,'orderBy':{'createdAt':_0x79ea3a(0x217)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x79ea3a(0x20e)][_0x79ea3a(0x1d1)][_0x79ea3a(0x1aa)]({'where':_0x43ef76})]);return{'users':_0x223bcf[_0x79ea3a(0x1c4)](_0x4ce8ba=>({'id':_0x4ce8ba['id'],'fullName':_0x4ce8ba[_0x79ea3a(0x204)],'username':_0x4ce8ba['username'],'telegramId':_0x4ce8ba[_0x79ea3a(0x256)],'merchantUrl':_0x4ce8ba[_0x79ea3a(0x20b)],'gateways':_0x4ce8ba[_0x79ea3a(0x1fa)]?JSON[_0x79ea3a(0x1fd)](_0x4ce8ba[_0x79ea3a(0x1fa)]):null,'gatewaySettings':_0x4ce8ba[_0x79ea3a(0x202)]?JSON[_0x79ea3a(0x1fd)](_0x4ce8ba['gatewaySettings']):null,'publicKey':_0x4ce8ba[_0x79ea3a(0x26e)],'wallets':{'usdtPolygonWallet':_0x4ce8ba[_0x79ea3a(0x271)],'usdtTrcWallet':_0x4ce8ba[_0x79ea3a(0x259)],'usdtErcWallet':_0x4ce8ba[_0x79ea3a(0x232)],'usdcPolygonWallet':_0x4ce8ba[_0x79ea3a(0x264)]},'status':_0x4ce8ba[_0x79ea3a(0x1f7)],'createdAt':_0x4ce8ba[_0x79ea3a(0x1c6)]})),'pagination':{'page':_0xce1a75,'limit':_0x5d3e0f,'total':_0x5e079d,'totalPages':Math['ceil'](_0x5e079d/_0x5d3e0f)}};}async[a35_0x30910b(0x275)](_0x28da49){const _0x3adffb=a35_0x30910b,_0xdc8375=await database_1[_0x3adffb(0x20e)][_0x3adffb(0x1d1)]['findUnique']({'where':{'id':_0x28da49},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xdc8375)return null;return{'id':_0xdc8375['id'],'fullName':_0xdc8375['name'],'username':_0xdc8375[_0x3adffb(0x207)],'telegramId':_0xdc8375[_0x3adffb(0x256)],'merchantUrl':_0xdc8375['shopUrl'],'gateways':_0xdc8375[_0x3adffb(0x1fa)]?JSON[_0x3adffb(0x1fd)](_0xdc8375[_0x3adffb(0x1fa)]):null,'gatewaySettings':_0xdc8375[_0x3adffb(0x202)]?JSON['parse'](_0xdc8375[_0x3adffb(0x202)]):null,'publicKey':_0xdc8375[_0x3adffb(0x26e)],'wallets':{'usdtPolygonWallet':_0xdc8375[_0x3adffb(0x271)],'usdtTrcWallet':_0xdc8375['usdtTrcWallet'],'usdtErcWallet':_0xdc8375[_0x3adffb(0x232)],'usdcPolygonWallet':_0xdc8375['usdcPolygonWallet']},'status':_0xdc8375[_0x3adffb(0x1f7)],'createdAt':_0xdc8375[_0x3adffb(0x1c6)]};}async[a35_0x30910b(0x24e)](_0x2ef3a5){const _0x21d194=a35_0x30910b,{fullName:_0x29a806,username:_0x54aa78,password:_0x1d1fb3,telegramId:_0x137faa,merchantUrl:_0x4b0265,gateways:_0x7eec8e,gatewaySettings:_0x4453b7,wallets:_0x5936e7}=_0x2ef3a5,_0x1d29e7=await database_1[_0x21d194(0x20e)]['shop'][_0x21d194(0x1de)]({'where':{'username':_0x54aa78}});if(_0x1d29e7)throw new Error(_0x21d194(0x1af));if(_0x137faa){const _0xda37f0=await database_1['default']['shop'][_0x21d194(0x1de)]({'where':{'telegram':_0x137faa}});if(_0xda37f0)throw new Error(_0x21d194(0x1b8));}const _0x54cd4e=await bcryptjs_1['default'][_0x21d194(0x25c)](_0x1d1fb3,0xc),_0x563b5a=_0x21d194(0x219)+crypto_1['default'][_0x21d194(0x208)](0x20)[_0x21d194(0x1c9)](_0x21d194(0x26a)),_0x2a6b2c=_0x21d194(0x1df)+crypto_1[_0x21d194(0x20e)]['randomBytes'](0x20)['toString'](_0x21d194(0x26a)),_0x1fb9f3=await database_1[_0x21d194(0x20e)][_0x21d194(0x1d1)][_0x21d194(0x21f)]({'data':{'name':_0x29a806,'username':_0x54aa78,'password':_0x54cd4e,'telegram':_0x137faa,'shopUrl':_0x4b0265,'paymentGateways':_0x7eec8e?JSON['stringify'](_0x7eec8e):null,'gatewaySettings':_0x4453b7?JSON['stringify'](_0x4453b7):null,'usdtPolygonWallet':_0x5936e7?.[_0x21d194(0x271)]||null,'usdtTrcWallet':_0x5936e7?.['usdtTrcWallet']||null,'usdtErcWallet':_0x5936e7?.[_0x21d194(0x232)]||null,'usdcPolygonWallet':_0x5936e7?.[_0x21d194(0x264)]||null,'publicKey':_0x563b5a,'secretKey':_0x2a6b2c,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1fb9f3['id'],'fullName':_0x1fb9f3[_0x21d194(0x204)],'username':_0x1fb9f3[_0x21d194(0x207)],'telegramId':_0x1fb9f3[_0x21d194(0x256)],'merchantUrl':_0x1fb9f3[_0x21d194(0x20b)],'gateways':_0x1fb9f3[_0x21d194(0x1fa)]?JSON[_0x21d194(0x1fd)](_0x1fb9f3['paymentGateways']):null,'gatewaySettings':_0x1fb9f3['gatewaySettings']?JSON[_0x21d194(0x1fd)](_0x1fb9f3['gatewaySettings']):null,'publicKey':_0x1fb9f3['publicKey'],'wallets':{'usdtPolygonWallet':_0x1fb9f3[_0x21d194(0x271)],'usdtTrcWallet':_0x1fb9f3[_0x21d194(0x259)],'usdtErcWallet':_0x1fb9f3['usdtErcWallet'],'usdcPolygonWallet':_0x1fb9f3[_0x21d194(0x264)]},'status':_0x1fb9f3['status'],'createdAt':_0x1fb9f3['createdAt']};}async['deleteUser'](_0x5120d4){const _0x45b8d6=a35_0x30910b;await database_1[_0x45b8d6(0x20e)][_0x45b8d6(0x1d1)][_0x45b8d6(0x1b1)]({'where':{'id':_0x5120d4}});}}exports['AdminService']=AdminService;