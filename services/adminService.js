'use strict';const a36_0x204bda=a36_0x4a54;(function(_0x46060e,_0x397694){const _0x4b9440=a36_0x4a54,_0x49280b=_0x46060e();while(!![]){try{const _0x5d8c55=-parseInt(_0x4b9440(0x1c6))/0x1*(parseInt(_0x4b9440(0xe2))/0x2)+-parseInt(_0x4b9440(0x175))/0x3+parseInt(_0x4b9440(0x14a))/0x4+-parseInt(_0x4b9440(0x13a))/0x5+parseInt(_0x4b9440(0xd8))/0x6*(-parseInt(_0x4b9440(0x1c3))/0x7)+-parseInt(_0x4b9440(0x162))/0x8*(parseInt(_0x4b9440(0x1c0))/0x9)+parseInt(_0x4b9440(0x130))/0xa*(parseInt(_0x4b9440(0x1d8))/0xb);if(_0x5d8c55===_0x397694)break;else _0x49280b['push'](_0x49280b['shift']());}catch(_0x183186){_0x49280b['push'](_0x49280b['shift']());}}}(a36_0x356a,0xafe9f));var __importDefault=this&&this[a36_0x204bda(0x166)]||function(_0x3d9e3f){const _0x15da6d=a36_0x204bda;return _0x3d9e3f&&_0x3d9e3f[_0x15da6d(0x1a3)]?_0x3d9e3f:{'default':_0x3d9e3f};};function a36_0x356a(){const _0x502ae4=['\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','5011984kOlEUP','toLowerCase','defineProperty','CoinToPay','includes','\x20balance\x20updated:','🔍\x20Using\x20gateway\x20\x27','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','shopId','📊\x20Merchant\x20statistics\x20calculated:','\x20USDT\x20(same\x20as\x20awaiting)','totalTurnover','getGatewayIdByName','day','🎯\x20[','rapyd','dailyRevenue','month','statusChangedAt','successUrl','reduce','paidAt','randomBytes','toString','802616BQnZFY','../types/gateway','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','PAID','__importDefault','_count','commissionUSDT','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','delete','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','desc','gatewayOrderId','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','✅\x20Payout\x20created:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','adminNotes','txid','setHours','wallets','2307072pokKJa','warn','totalPayments','activateUser','getTime','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','⚠️\x20Payment\x20','entries','Username\x20already\x20exists','values','date','klyme_eu','period','🔧\x20[','all','shop','localeCompare','usdtErcWallet','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','groupBy','amountAfterCommissionUSDT','\x20PAID\x20payments','parse','merchantEarnings','gatewayEarnings','periodFrom','\x20USDT','\x20USDT\x20for\x20payment\x20','dateFrom','Payment\x20not\x20found','2020-01-01','crypto','🔄\x20Converted\x20gateway\x20name\x20\x27','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','random','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','periodTo','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','\x20\x20\x20Merchant\x20loses:\x20','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20USDT,\x20Requested:\x20','dateTo','notes','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','getPaymentById','deleteUser','__esModule','count','COMPLETED','🔐\x20[','map',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20merchants','totalAmountUSDT','averageCommissionRate','balance','week','💰\x20[PAYOUT]\x20Merchant\x20','turnoverUSDT','\x20USDT\x20(+','AdminService',':\x20commission\x20=\x20','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','usdtPolygonWallet','%\x20from\x20','SUSPENDED','📋\x20Found\x20','\x20\x20\x20Gateway:\x20','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','awaitingPayout','getGatewayInternalName','30d','usdtTrcWallet','90tSrEEP','getAllPayments','network','106715uExVLM','\x20USDT)',']\x20Gateway\x20settings\x20before\x20saving:','151eAIEMt','password','hash','totalPaidOut','NONEXISTENT_GATEWAY_FILTER','insensitive','\x20USDT\x20(already\x20paid\x20out)','failureMessage','\x20\x20\x20💰\x20Total\x20payout:\x20','create','CHARGEBACK','merchantEarningsUSDT','telegram','toISOString','🔄\x20Gateway\x20mapping\x20(get):','currency','customerUa','\x20\x20\x20Payout\x20amount:\x20','253ylnbRR','getGatewayNameById','\x20payments)','toFixed','getPayoutStats','error','💰\x20Shop\x20','getAllUsers','username','year','\x20paid\x20payments\x20for\x20analysis','status','getGatewayDisplayName','⚠️\x20Requested\x20gateway\x20\x27','getSystemStatistics','klyme_de','shopUrl','currencyService','generateDailyStatistics','\x20became\x20PAID:','\x20status:\x20','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','\x20\x20\x20🌐\x20IP:\x20','\x20USDT\x20(after\x20','pendingPayout','customerIp','\x20USDT,\x20merchant:\x20','polygon','aggregate','getMonth','hex','set','averageCheckUSDT','whiteUrl','ceil','updatedAt','findFirst','💰\x20Payment\x20','trim','📊\x20Getting\x20payments\x20with\x20filters:','test_gateway','customerCountry','\x20\x20\x20🖥️\x20User\x20Agent:\x20','getMerchantsAwaitingPayout','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','gte','🔄\x20Gateway\x20mapping\x20(create):','\x20\x20\x20Merchant\x20gets:\x20','\x20USDT\x20(actual\x20balances)','some','sort','\x20\x20\x20🌍\x20Country:\x20','stringify','push','fullName','noda','KLYME\x20DE','setDate','round','trc20','length','createUser','telegramId','paymentsCount','externalPaymentUrl','findMany','📊\x20Final\x20WHERE\x20conditions:','102CRriCe','📊\x20Total\x20payments\x20(including\x20failed):\x20','admin','amount','updateUser','\x27\x20->\x20name\x20\x27','totalCommissionRate','paidOutUSDT','getFullYear','createdAt','15074IKzSnY','toUpperCase','MasterCard','payment','merchantUrl',',\x20successful:\x20','../config/database',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x20\x20\x20📅\x20This\x20month:\x20','chargebackAmount','turnover','\x20USDT\x20(current\x20balance\x20in\x20DB)','split','Plisio','gateway','\x20\x20\x20Full\x20amount:\x20','yesterday','\x20USDT\x20from\x20balance','\x20order','join','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','pk_','commission','\x20USDT\x20(','🎯\x20updateUser\x20called\x20with\x20ID:\x20','totalPayout','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','lte','cointopay2','\x20to\x20','\x27\x20(from\x20\x27','orderId','gatewaySettings','name',',\x20Commission:\x20','sk_','\x20\x20\x20Added\x20to\x20balance:\x20+','Rapyd','Noda','publicKey','suspendUser','polygon_usdc','💰\x20Found\x20','./currencyService','\x20in\x20','\x20\x20\x20�📊\x20Total\x20payments:\x20','\x20\x20\x20Transaction\x20hash:\x20','📊\x20Available\x20gateways\x20in\x20database:','substr','usdcPolygonWallet','asc','90d','\x20\x20\x20⏳\x20Pending\x20payout:\x20','⚠️\x20Gateway\x20\x27','get','\x20->\x20','$transaction','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20USDT\x20(gross\x20revenue)','update','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','\x20USDT\x20(-','default','ACTIVE','0000','getDate','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','\x27\x20to\x20name\x20\x27',',\x20userId:\x20','customerEmail','plisio','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','gatewayCommissionRate','amountAfterGatewayCommissionUSDT','amountUSDT','getPayoutById','KLYME\x20GB','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','1421530STYUAO','%\x20commission)','\x20balance\x20updated:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','updatePaymentStatus','log','\x20\x20\x20Balance:\x20','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','updateCustomerData','Test\x20Gateway','3162130JQXYZb','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20for\x20shop\x20','_sum','payout','findUnique','failUrl','paymentGateways','customerName',']\x20Gateway\x20settings\x20JSON\x20string:','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','not\x20set','getMerchantsSelection','gateways','convertToUSDT'];a36_0x356a=function(){return _0x502ae4;};return a36_0x356a();}Object[a36_0x204bda(0x14c)](exports,a36_0x204bda(0x1a3),{'value':!![]}),exports[a36_0x204bda(0x1b1)]=void 0x0;const database_1=__importDefault(require(a36_0x204bda(0xe8))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a36_0x204bda(0x194))),currencyService_1=require(a36_0x204bda(0x10d)),gateway_1=require(a36_0x204bda(0x163));function a36_0x4a54(_0x4856e9,_0x2354a1){const _0x356a8c=a36_0x356a();return a36_0x4a54=function(_0x4a54b6,_0x1d1a34){_0x4a54b6=_0x4a54b6-0xd1;let _0x2b56e2=_0x356a8c[_0x4a54b6];return _0x2b56e2;},a36_0x4a54(_0x4856e9,_0x2354a1);}class AdminService{async[a36_0x204bda(0x1dc)](){const _0x1aa717=a36_0x204bda;console[_0x1aa717(0x135)]('📊\x20Calculating\x20payout\x20statistics...');const _0x23bc8a=await database_1[_0x1aa717(0x120)][_0x1aa717(0x184)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x1aa717(0x121)}}),_0x1e62a2=await database_1[_0x1aa717(0x120)][_0x1aa717(0xe5)][_0x1aa717(0x1a4)]({'where':{'status':_0x1aa717(0x165),'gateway':{'not':_0x1aa717(0x200)}}}),_0x5e8de9=new Date(),_0x13fef7=new Date(_0x5e8de9['getFullYear'](),_0x5e8de9[_0x1aa717(0x1f5)](),0x1),_0x1fec9e=new Date(_0x5e8de9[_0x1aa717(0xe0)](),_0x5e8de9[_0x1aa717(0x1f5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4b941=await database_1[_0x1aa717(0x120)][_0x1aa717(0x13e)][_0x1aa717(0x1f4)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x13fef7,'lte':_0x1fec9e},'status':_0x1aa717(0x1a5)}}),_0x1d9a2a=_0x23bc8a[_0x1aa717(0x13d)][_0x1aa717(0x1c9)]||0x0,_0x2af4f0=_0x23bc8a[_0x1aa717(0x13d)][_0x1aa717(0x1ac)]||0x0,_0x4d6f52=_0x4b941[_0x1aa717(0x13d)][_0x1aa717(0xdb)]||0x0,_0x23c9b9={'totalPayout':Math[_0x1aa717(0x212)](_0x1d9a2a*0x64)/0x64,'awaitingPayout':Math['round'](_0x2af4f0*0x64)/0x64,'thisMonth':Math[_0x1aa717(0x212)](_0x4d6f52*0x64)/0x64,'availableBalance':Math['round'](_0x2af4f0*0x64)/0x64,'totalPayments':_0x1e62a2};return console[_0x1aa717(0x135)]('📊\x20Payout\x20statistics\x20calculated:'),console['log'](_0x1aa717(0x1ce)+_0x23c9b9['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x1aa717(0x135)](_0x1aa717(0x149)+_0x23c9b9[_0x1aa717(0x1bc)]+_0x1aa717(0x12f)),console[_0x1aa717(0x135)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x23c9b9['availableBalance']+_0x1aa717(0x154)),console[_0x1aa717(0x135)](_0x1aa717(0xea)+_0x23c9b9['thisMonth']+'\x20USDT'),console[_0x1aa717(0x135)](_0x1aa717(0x1ba)+_0x23c9b9['totalPayments']+_0x1aa717(0x18a)),_0x23c9b9;}async[a36_0x204bda(0x138)](_0xabd696,_0x4b19af){const _0x559303=a36_0x204bda;console[_0x559303(0x135)](_0x559303(0x164)+_0xabd696+':',_0x4b19af);const _0x3c498a=await database_1[_0x559303(0x120)][_0x559303(0xe5)][_0x559303(0x13f)]({'where':{'id':_0xabd696},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3c498a)throw new Error(_0x559303(0x192));const _0x3eaf3c={};_0x4b19af[_0x559303(0x201)]!==undefined&&(_0x3eaf3c[_0x559303(0x201)]=_0x4b19af[_0x559303(0x201)]||null);_0x4b19af['customerIp']!==undefined&&(_0x3eaf3c[_0x559303(0x1f1)]=_0x4b19af[_0x559303(0x1f1)]||null);_0x4b19af[_0x559303(0x1d6)]!==undefined&&(_0x3eaf3c[_0x559303(0x1d6)]=_0x4b19af['customerUa']||null);const _0x4b0869=await database_1[_0x559303(0x120)][_0x559303(0xe5)][_0x559303(0x11d)]({'where':{'id':_0xabd696},'data':{..._0x3eaf3c,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x559303(0x135)](_0x559303(0x17a)+_0xabd696),console[_0x559303(0x135)](_0x559303(0x20b)+_0x3c498a[_0x559303(0x201)]+_0x559303(0x119)+_0x4b0869['customerCountry']),console[_0x559303(0x135)](_0x559303(0x1ee)+_0x3c498a[_0x559303(0x1f1)]+_0x559303(0x119)+_0x4b0869[_0x559303(0x1f1)]),console[_0x559303(0x135)](_0x559303(0x202)+(_0x3c498a[_0x559303(0x1d6)]?'set':_0x559303(0x145))+'\x20->\x20'+(_0x4b0869['customerUa']?'set':'not\x20set')),_0x4b0869;}async[a36_0x204bda(0x1e6)](_0x16cfca){const _0xc79ec5=a36_0x204bda,_0x17932b=new Date();let _0x4f25a8;switch(_0x16cfca['toLowerCase']()){case _0xc79ec5(0x157):_0x4f25a8=new Date(_0x17932b[_0xc79ec5(0xe0)](),_0x17932b['getMonth'](),_0x17932b[_0xc79ec5(0x123)](),0x0,0x0,0x0,0x0);break;case _0xc79ec5(0xf2):const _0x451c3c=new Date(_0x17932b);_0x451c3c['setDate'](_0x451c3c[_0xc79ec5(0x123)]()-0x1),_0x4f25a8=new Date(_0x451c3c['getFullYear'](),_0x451c3c[_0xc79ec5(0x1f5)](),_0x451c3c[_0xc79ec5(0x123)](),0x0,0x0,0x0,0x0);break;case'7d':_0x4f25a8=new Date(_0x17932b[_0xc79ec5(0x179)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xc79ec5(0x1be):_0x4f25a8=new Date(_0x17932b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xc79ec5(0x115):_0x4f25a8=new Date(_0x17932b[_0xc79ec5(0x179)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x684743=await database_1[_0xc79ec5(0x120)][_0xc79ec5(0xe5)][_0xc79ec5(0x1fc)]({'where':{'gateway':{'not':_0xc79ec5(0x200)}},'orderBy':{'createdAt':_0xc79ec5(0x114)},'select':{'createdAt':!![]}});_0x4f25a8=_0x684743?_0x684743[_0xc79ec5(0xe1)]:new Date(_0xc79ec5(0x193));break;default:_0x4f25a8=new Date(_0x17932b[_0xc79ec5(0x179)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x4f25a8[_0xc79ec5(0x173)](0x0,0x0,0x0,0x0);let _0x31267b;if(_0x16cfca[_0xc79ec5(0x14b)]()===_0xc79ec5(0xf2)){const _0x1d8af1=new Date(_0x17932b);_0x1d8af1[_0xc79ec5(0x211)](_0x1d8af1[_0xc79ec5(0x123)]()-0x1),_0x31267b=new Date(_0x1d8af1[_0xc79ec5(0xe0)](),_0x1d8af1['getMonth'](),_0x1d8af1[_0xc79ec5(0x123)](),0x17,0x3b,0x3b,0x3e7);}const _0x5cbc72={'gte':_0x4f25a8};_0x31267b&&(_0x5cbc72[_0xc79ec5(0xfd)]=_0x31267b);const [_0x1696cb,_0x30bb40,_0x42c8d1,_0x442484,_0x6dd3f8,_0x532149]=await Promise[_0xc79ec5(0x183)]([database_1[_0xc79ec5(0x120)][_0xc79ec5(0x184)][_0xc79ec5(0x1a4)](),database_1[_0xc79ec5(0x120)][_0xc79ec5(0x184)]['count']({'where':{'status':'ACTIVE'}}),database_1[_0xc79ec5(0x120)][_0xc79ec5(0xe5)]['count']({'where':{'status':'PAID','createdAt':_0x5cbc72,'gateway':{'not':_0xc79ec5(0x200)}}}),database_1[_0xc79ec5(0x120)][_0xc79ec5(0xe5)][_0xc79ec5(0xd6)]({'where':{'status':'PAID','createdAt':_0x5cbc72,'gateway':{'not':_0xc79ec5(0x200)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0xc79ec5(0x120)][_0xc79ec5(0xe5)]['findMany']({'where':{'gateway':{'not':_0xc79ec5(0x200)}},'take':0xa,'orderBy':{'createdAt':_0xc79ec5(0x16c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xc79ec5(0x120)]['payment'][_0xc79ec5(0xd6)]({'where':{'createdAt':_0x5cbc72,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x15c541=0x0,_0x3e2124=0x0;for(const _0x3e2582 of _0x442484){const _0x25b1a1=await currencyService_1[_0xc79ec5(0x1e9)][_0xc79ec5(0x148)](_0x3e2582[_0xc79ec5(0xdb)],_0x3e2582[_0xc79ec5(0x1d5)]);_0x15c541+=_0x25b1a1;if(_0x3e2582[_0xc79ec5(0x12b)]){const _0x366033=await currencyService_1[_0xc79ec5(0x1e9)][_0xc79ec5(0x148)](_0x3e2582[_0xc79ec5(0xdb)],_0x3e2582[_0xc79ec5(0x1d5)]),_0x47fd4c=_0x3e2582['amountAfterGatewayCommissionUSDT'],_0x291bde=_0x366033-_0x47fd4c;_0x3e2124+=_0x291bde;}}const _0x31fc01=_0x42c8d1>0x0?_0x15c541/_0x42c8d1:0x0,_0x25c25b=this[_0xc79ec5(0x1ea)](_0x532149,_0x4f25a8,_0x31267b||_0x17932b),_0x3b9be6=await database_1[_0xc79ec5(0x120)][_0xc79ec5(0xe5)][_0xc79ec5(0x1a4)]({'where':{'createdAt':_0x5cbc72,'gateway':{'not':_0xc79ec5(0x200)}}}),_0x26e59e=_0x3b9be6>0x0?_0x42c8d1/_0x3b9be6*0x64:0x0;return{'totalShops':_0x1696cb,'activeShops':_0x30bb40,'totalPayments':_0x42c8d1,'successfulPayments':_0x42c8d1,'totalAttempts':_0x3b9be6,'totalRevenue':Math[_0xc79ec5(0x212)](_0x15c541*0x64)/0x64,'trapayEarnings':Math[_0xc79ec5(0x212)](_0x3e2124*0x64)/0x64,'averagePaymentAmount':Math[_0xc79ec5(0x212)](_0x31fc01*0x64)/0x64,'conversionRate':Math[_0xc79ec5(0x212)](_0x26e59e*0x64)/0x64,'dailyRevenue':_0x25c25b[_0xc79ec5(0x15a)],'dailyPayments':_0x25c25b['dailyPayments'],'recentPayments':_0x6dd3f8['map'](_0x1501c7=>({'id':_0x1501c7['id'],'amount':_0x1501c7['amount'],'currency':_0x1501c7[_0xc79ec5(0x1d5)],'status':_0x1501c7['status'],'gateway':_0x1501c7['gateway'],'shop':_0x1501c7[_0xc79ec5(0x184)],'createdAt':_0x1501c7[_0xc79ec5(0xe1)]}))};}async['getMerchantStatistics'](_0x358acc){const _0x2b2f40=a36_0x204bda;console[_0x2b2f40(0x135)](_0x2b2f40(0xfc),_0x358acc);let _0x1b0b25,_0x33eb46=new Date();if(_0x358acc['period']==='custom'&&_0x358acc[_0x2b2f40(0x191)]&&_0x358acc[_0x2b2f40(0x19e)])_0x1b0b25=new Date(_0x358acc[_0x2b2f40(0x191)]),_0x33eb46=new Date(_0x358acc[_0x2b2f40(0x19e)]),_0x1b0b25['setHours'](0x0,0x0,0x0,0x0),_0x33eb46[_0x2b2f40(0x173)](0x17,0x3b,0x3b,0x3e7);else{const _0x383afe=new Date();switch(_0x358acc[_0x2b2f40(0x181)]){case _0x2b2f40(0x1ad):_0x1b0b25=new Date(_0x383afe[_0x2b2f40(0x179)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2b2f40(0x15b):_0x1b0b25=new Date(_0x383afe['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2b2f40(0x1e1):_0x1b0b25=new Date(_0x383afe[_0x2b2f40(0x179)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2b2f40(0x183):default:_0x1b0b25=new Date(_0x2b2f40(0x193));break;}_0x1b0b25[_0x2b2f40(0x173)](0x0,0x0,0x0,0x0),_0x33eb46[_0x2b2f40(0x173)](0x17,0x3b,0x3b,0x3e7);}console[_0x2b2f40(0x135)]('📅\x20Period:\x20'+_0x1b0b25['toISOString']()+_0x2b2f40(0xff)+_0x33eb46['toISOString']());const _0xb4c4b0={'status':'PAID','gateway':{'not':_0x2b2f40(0x200)},'paidAt':{'gte':_0x1b0b25,'lte':_0x33eb46}};_0x358acc[_0x2b2f40(0x152)]&&(_0xb4c4b0[_0x2b2f40(0x152)]=_0x358acc[_0x2b2f40(0x152)]);const _0xb48b5b=await database_1['default']['payment'][_0x2b2f40(0xd6)]({'where':_0xb4c4b0,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2b2f40(0x135)]('💰\x20Found\x20'+_0xb48b5b[_0x2b2f40(0xd1)]+_0x2b2f40(0x1e2));const _0x320409={'gateway':{'not':_0x2b2f40(0x200)},'createdAt':{'gte':_0x1b0b25,'lte':_0x33eb46}};_0x358acc['shopId']&&(_0x320409['shopId']=_0x358acc[_0x2b2f40(0x152)]);const _0x864034=await database_1[_0x2b2f40(0x120)][_0x2b2f40(0xe5)]['count']({'where':_0x320409});console[_0x2b2f40(0x135)](_0x2b2f40(0xd9)+_0x864034+_0x2b2f40(0xe7)+_0xb48b5b['length']);let _0x713bdb=0x0,_0x26e638=0x0,_0x553b16=0x0;const _0x1f25f6={},_0x217be9={},_0x4ae7f8={};for(const _0x416687 of _0xb48b5b){try{const _0xde9901=_0x416687[_0x2b2f40(0x12c)]||0x0;if(_0xde9901<=0x0){console[_0x2b2f40(0x176)](_0x2b2f40(0x17b)+_0x416687['id']+_0x2b2f40(0x144));continue;}let _0x2e9ed3,_0x1c35d4;if(_0x416687[_0x2b2f40(0x12b)]!==null&&_0x416687[_0x2b2f40(0x12b)]!==undefined)_0x2e9ed3=_0x416687[_0x2b2f40(0x12b)],_0x1c35d4=_0xde9901-_0x2e9ed3,console['log'](_0x2b2f40(0x1ed)+_0x416687['id']+':\x20'+_0xde9901[_0x2b2f40(0x1db)](0x6)+_0x2b2f40(0x1f2)+_0x2e9ed3['toFixed'](0x6)+_0x2b2f40(0x18f));else{let _0xcad5ba={};if(_0x416687[_0x2b2f40(0x184)]['gatewaySettings'])try{_0xcad5ba=JSON[_0x2b2f40(0x18b)](_0x416687[_0x2b2f40(0x184)][_0x2b2f40(0x102)]);}catch(_0x320847){console[_0x2b2f40(0x1dd)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x416687['shopId']+':',_0x320847);}let _0x76b0bb=0x2d;for(const [_0xc70a15,_0x498ffd]of Object[_0x2b2f40(0x17c)](_0xcad5ba)){if(_0xc70a15['toLowerCase']()===_0x416687['gateway'][_0x2b2f40(0x14b)]()){_0x76b0bb=_0x498ffd[_0x2b2f40(0xf8)]||0x2d;break;}}_0x1c35d4=_0xde9901*(_0x76b0bb/0x64),_0x2e9ed3=_0xde9901-_0x1c35d4,console[_0x2b2f40(0x135)](_0x2b2f40(0x16e)+_0x416687['id']+':\x20'+_0x76b0bb+_0x2b2f40(0x1b6)+_0xde9901['toFixed'](0x6)+_0x2b2f40(0x18f));}_0x713bdb+=_0xde9901,_0x26e638+=_0x2e9ed3,_0x553b16+=_0x1c35d4;let _0x2dd0c4;_0x416687[_0x2b2f40(0x12a)]!==null&&_0x416687[_0x2b2f40(0x12a)]!==undefined?(_0x2dd0c4=_0x416687['gatewayCommissionRate'],console[_0x2b2f40(0x135)](_0x2b2f40(0x11e)+_0x416687['id']+':\x20'+_0x2dd0c4+'%')):(_0x2dd0c4=_0xde9901>0x0?_0x1c35d4/_0xde9901*0x64:0x0,console[_0x2b2f40(0x135)](_0x2b2f40(0x129)+_0x416687['id']+':\x20'+_0x2dd0c4[_0x2b2f40(0x1db)](0x2)+'%'));!_0x1f25f6[_0x416687[_0x2b2f40(0xf0)]]&&(_0x1f25f6[_0x416687[_0x2b2f40(0xf0)]]={'gateway':_0x416687['gateway'],'gatewayDisplayName':this[_0x2b2f40(0x1e4)](_0x416687[_0x2b2f40(0xf0)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1f25f6[_0x416687['gateway']][_0x2b2f40(0xd4)]++,_0x1f25f6[_0x416687['gateway']][_0x2b2f40(0x1af)]+=_0xde9901,_0x1f25f6[_0x416687[_0x2b2f40(0xf0)]][_0x2b2f40(0x168)]+=_0x1c35d4,_0x1f25f6[_0x416687[_0x2b2f40(0xf0)]][_0x2b2f40(0x1d1)]+=_0x2e9ed3,_0x1f25f6[_0x416687['gateway']]['totalCommissionRate']+=_0x2dd0c4;!_0x358acc[_0x2b2f40(0x152)]&&(!_0x217be9[_0x416687[_0x2b2f40(0x152)]]&&(_0x217be9[_0x416687[_0x2b2f40(0x152)]]={'shopId':_0x416687['shopId'],'shopName':_0x416687['shop']['name'],'shopUsername':_0x416687[_0x2b2f40(0x184)][_0x2b2f40(0x1e0)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x217be9[_0x416687[_0x2b2f40(0x152)]][_0x2b2f40(0xd4)]++,_0x217be9[_0x416687[_0x2b2f40(0x152)]][_0x2b2f40(0x1af)]+=_0xde9901,_0x217be9[_0x416687[_0x2b2f40(0x152)]][_0x2b2f40(0x168)]+=_0x1c35d4,_0x217be9[_0x416687[_0x2b2f40(0x152)]][_0x2b2f40(0x1d1)]+=_0x2e9ed3);const _0x27eddc=_0x416687[_0x2b2f40(0x15f)]['toISOString']()[_0x2b2f40(0xee)]('T')[0x0];!_0x4ae7f8[_0x27eddc]&&(_0x4ae7f8[_0x27eddc]={'date':_0x27eddc,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4ae7f8[_0x27eddc][_0x2b2f40(0xec)]+=_0xde9901,_0x4ae7f8[_0x27eddc][_0x2b2f40(0x18c)]+=_0x2e9ed3,_0x4ae7f8[_0x27eddc][_0x2b2f40(0x18d)]+=_0x1c35d4,_0x4ae7f8[_0x27eddc][_0x2b2f40(0xd4)]++;}catch(_0x4ebd8d){console['error']('Error\x20processing\x20payment\x20'+_0x416687['id']+':',_0x4ebd8d);}}Object['values'](_0x1f25f6)['forEach'](_0x444c14=>{const _0x4d551b=_0x2b2f40;_0x444c14[_0x4d551b(0x1ab)]=_0x444c14['paymentsCount']>0x0?_0x444c14[_0x4d551b(0xde)]/_0x444c14['paymentsCount']:0x0,delete _0x444c14[_0x4d551b(0xde)];}),Object['values'](_0x217be9)['forEach'](_0x212baa=>{const _0x31914f=_0x2b2f40;_0x212baa[_0x31914f(0x1f8)]=_0x212baa[_0x31914f(0xd4)]>0x0?_0x212baa['turnoverUSDT']/_0x212baa[_0x31914f(0xd4)]:0x0;});let _0x570c7f=0x0,_0x5324c4=0x0;if(_0x358acc[_0x2b2f40(0x152)]){const _0x39d086=await database_1[_0x2b2f40(0x120)][_0x2b2f40(0x13e)][_0x2b2f40(0xd6)]({'where':{'shopId':_0x358acc[_0x2b2f40(0x152)],'status':_0x2b2f40(0x1a5),'createdAt':{'gte':_0x1b0b25,'lte':_0x33eb46}},'select':{'amount':!![]}});_0x570c7f=_0x39d086[_0x2b2f40(0x15e)]((_0x527f6b,_0x3161b7)=>_0x527f6b+_0x3161b7[_0x2b2f40(0xdb)],0x0);const _0x472080=await database_1[_0x2b2f40(0x120)][_0x2b2f40(0x13e)]['findMany']({'where':{'shopId':_0x358acc[_0x2b2f40(0x152)],'status':'PENDING','createdAt':{'gte':_0x1b0b25,'lte':_0x33eb46}},'select':{'amount':!![]}});_0x5324c4=_0x472080[_0x2b2f40(0x15e)]((_0x4a5ff6,_0x2f9148)=>_0x4a5ff6+_0x2f9148[_0x2b2f40(0xdb)],0x0);}const _0x5003f9=_0x864034,_0x4c0325=_0xb48b5b[_0x2b2f40(0xd1)],_0x4f4bdd=_0x4c0325>0x0?_0x713bdb/_0x4c0325:0x0,_0x553010=_0x5003f9>0x0?Math[_0x2b2f40(0x212)](_0x4c0325/_0x5003f9*0x2710)/0x64:0x0,_0x18a831=Math[_0x2b2f40(0x1fa)]((_0x33eb46[_0x2b2f40(0x179)]()-_0x1b0b25[_0x2b2f40(0x179)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2d0c46={'totalTurnover':Math['round'](_0x713bdb*0x64)/0x64,'merchantEarnings':Math[_0x2b2f40(0x212)](_0x26e638*0x64)/0x64,'gatewayEarnings':Math[_0x2b2f40(0x212)](_0x553b16*0x64)/0x64,'totalPaidOut':Math['round'](_0x570c7f*0x64)/0x64,'pendingPayout':Math[_0x2b2f40(0x212)](_0x5324c4*0x64)/0x64,'averageCheck':Math[_0x2b2f40(0x212)](_0x4f4bdd*0x64)/0x64,'totalPayments':_0x5003f9,'successfulPayments':_0x4c0325,'conversionRate':_0x553010,'gatewayBreakdown':Object[_0x2b2f40(0x17e)](_0x1f25f6)[_0x2b2f40(0x1a7)](_0x5a645b=>({..._0x5a645b,'turnoverUSDT':Math[_0x2b2f40(0x212)](_0x5a645b['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2b2f40(0x212)](_0x5a645b[_0x2b2f40(0x168)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2b2f40(0x212)](_0x5a645b[_0x2b2f40(0x1d1)]*0x64)/0x64,'averageCommissionRate':Math[_0x2b2f40(0x212)](_0x5a645b['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x358acc[_0x2b2f40(0x152)]?undefined:Object[_0x2b2f40(0x17e)](_0x217be9)['map'](_0x53d39=>({..._0x53d39,'turnoverUSDT':Math[_0x2b2f40(0x212)](_0x53d39[_0x2b2f40(0x1af)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x53d39[_0x2b2f40(0x168)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2b2f40(0x212)](_0x53d39[_0x2b2f40(0x1d1)]*0x64)/0x64,'paidOutUSDT':Math[_0x2b2f40(0x212)](_0x53d39[_0x2b2f40(0xdf)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2b2f40(0x212)](_0x53d39['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x2b2f40(0x17e)](_0x4ae7f8)['map'](_0x4fb5a1=>({..._0x4fb5a1,'turnover':Math[_0x2b2f40(0x212)](_0x4fb5a1[_0x2b2f40(0xec)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x4fb5a1['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x2b2f40(0x212)](_0x4fb5a1['gatewayEarnings']*0x64)/0x64}))[_0x2b2f40(0x20a)]((_0x4a43f3,_0x4b4e27)=>_0x4a43f3[_0x2b2f40(0x17f)][_0x2b2f40(0x185)](_0x4b4e27[_0x2b2f40(0x17f)])),'periodInfo':{'from':_0x1b0b25,'to':_0x33eb46,'periodType':_0x358acc['period']||'custom','daysCount':_0x18a831}};return console[_0x2b2f40(0x135)](_0x2b2f40(0x153)),console[_0x2b2f40(0x135)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x2d0c46[_0x2b2f40(0x155)]+_0x2b2f40(0x18f)),console[_0x2b2f40(0x135)](_0x2b2f40(0x151)+_0x2d0c46[_0x2b2f40(0x18c)]+_0x2b2f40(0x18f)),console[_0x2b2f40(0x135)](_0x2b2f40(0x1a0)+_0x2d0c46[_0x2b2f40(0x18d)]+_0x2b2f40(0x18f)),console[_0x2b2f40(0x135)](_0x2b2f40(0x124)+_0x2d0c46[_0x2b2f40(0x1c9)]+_0x2b2f40(0x18f)),console[_0x2b2f40(0x135)](_0x2b2f40(0x116)+_0x2d0c46[_0x2b2f40(0x1f0)]+_0x2b2f40(0x18f)),console['log'](_0x2b2f40(0x10f)+_0x2d0c46[_0x2b2f40(0x177)]),_0x2d0c46;}async[a36_0x204bda(0x146)](){const _0x1b1adb=a36_0x204bda;console['log']('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x3f9c71=await database_1[_0x1b1adb(0x120)][_0x1b1adb(0x184)]['findMany']({'where':{'status':_0x1b1adb(0x121)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1b1adb(0x114)}});return console[_0x1b1adb(0x135)](_0x1b1adb(0x1b8)+_0x3f9c71[_0x1b1adb(0xd1)]+'\x20active\x20merchants\x20for\x20selection'),_0x3f9c71[_0x1b1adb(0x1a7)](_0x4f7548=>({'id':_0x4f7548['id'],'username':_0x4f7548[_0x1b1adb(0x1e0)],'name':_0x4f7548['name']}));}['getGatewayDisplayName'](_0x1c4a55){const _0x516c11=a36_0x204bda,_0x5795d6={'test_gateway':_0x516c11(0x139),'plisio':_0x516c11(0xef),'rapyd':_0x516c11(0x107),'noda':_0x516c11(0x108),'cointopay':_0x516c11(0x14d),'cointopay2':'Open\x20Banking\x202','klyme_eu':'KLYME\x20EU','klyme_gb':_0x516c11(0x12e),'klyme_de':_0x516c11(0x210),'mastercard':_0x516c11(0xe4)};return _0x5795d6[_0x1c4a55]||_0x1c4a55;}['getGatewayInternalName'](_0x41641f){const _0x5be199=a36_0x204bda,_0x50e618={'Test\x20Gateway':_0x5be199(0x200),'Plisio':_0x5be199(0x128),'Rapyd':_0x5be199(0x159),'Noda':_0x5be199(0x20f),'CoinToPay':'cointopay','CoinToPay2':_0x5be199(0xfe),'KLYME\x20EU':_0x5be199(0x180),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x5be199(0x1e7),'MasterCard':'mastercard'};return _0x50e618[_0x41641f]||_0x41641f['toLowerCase']();}async[a36_0x204bda(0x203)](_0xbc05ae){const _0x347b0a=a36_0x204bda,{page:_0x476161,limit:_0x5edc2b,minAmount:_0xb10b07,search:_0x5510bd}=_0xbc05ae,_0x1fffdd=(_0x476161-0x1)*_0x5edc2b;console[_0x347b0a(0x135)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0xbc05ae);const _0x3808e1={'balance':{'gt':0x0},'status':'ACTIVE'};_0xb10b07&&(_0x3808e1[_0x347b0a(0x1ac)]['gte']=_0xb10b07);_0x5510bd&&(_0x3808e1[_0x347b0a(0x103)]={'contains':_0x5510bd,'mode':_0x347b0a(0x1cb)});const [_0x189524,_0x257f04]=await Promise['all']([database_1[_0x347b0a(0x120)][_0x347b0a(0x184)][_0x347b0a(0xd6)]({'where':_0x3808e1,'skip':_0x1fffdd,'take':_0x5edc2b,'orderBy':{'balance':_0x347b0a(0x16c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x347b0a(0x120)]['shop'][_0x347b0a(0x1a4)]({'where':_0x3808e1})]);console['log'](_0x347b0a(0x10c)+_0x189524[_0x347b0a(0xd1)]+'\x20merchants\x20with\x20positive\x20balance');const _0x339703=await Promise['all'](_0x189524['map'](async _0x142b44=>{const _0x4eb873=_0x347b0a,[_0x383488,_0x162e84,_0x1e588b]=await Promise[_0x4eb873(0x183)]([database_1[_0x4eb873(0x120)][_0x4eb873(0xe5)][_0x4eb873(0x1a4)]({'where':{'shopId':_0x142b44['id'],'status':'PAID','gateway':{'not':'test_gateway'}}}),database_1[_0x4eb873(0x120)][_0x4eb873(0xe5)][_0x4eb873(0x1fc)]({'where':{'shopId':_0x142b44['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x4eb873(0x114)},'select':{'paidAt':!![]}}),database_1[_0x4eb873(0x120)][_0x4eb873(0xe5)][_0x4eb873(0x188)]({'by':[_0x4eb873(0xf0)],'where':{'shopId':_0x142b44['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2827d2=new Date(),_0x17e57b=new Date(_0x2827d2[_0x4eb873(0xe0)](),_0x2827d2[_0x4eb873(0x1f5)](),0x1),_0x463a49=new Date(_0x2827d2[_0x4eb873(0xe0)](),_0x2827d2[_0x4eb873(0x1f5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2e7e96,_0x2b581d]=await Promise['all']([database_1['default'][_0x4eb873(0x13e)][_0x4eb873(0x1f4)]({'_sum':{'amount':!![]},'where':{'shopId':_0x142b44['id'],'status':_0x4eb873(0x1a5)}}),database_1['default'][_0x4eb873(0x13e)][_0x4eb873(0x1f4)]({'_sum':{'amount':!![]},'where':{'shopId':_0x142b44['id'],'status':_0x4eb873(0x1a5),'createdAt':{'gte':_0x17e57b,'lte':_0x463a49}}})]),_0x315387=_0x2e7e96[_0x4eb873(0x13d)][_0x4eb873(0xdb)]||0x0,_0x3b6789=_0x2b581d[_0x4eb873(0x13d)][_0x4eb873(0xdb)]||0x0,_0x12e52b=await Promise['all'](_0x1e588b[_0x4eb873(0x1a7)](async _0x4d16f8=>{const _0x53f002=_0x4eb873;let _0x3262a7=0x2d;if(_0x142b44['gatewaySettings'])try{const _0x47d7d6=JSON[_0x53f002(0x18b)](_0x142b44['gatewaySettings']);for(const [_0x27ca07,_0x4debde]of Object[_0x53f002(0x17c)](_0x47d7d6)){if(_0x27ca07[_0x53f002(0x14b)]()===_0x4d16f8[_0x53f002(0xf0)][_0x53f002(0x14b)]()){_0x3262a7=_0x4debde['commission']||0xa,console[_0x53f002(0x135)]('💰\x20[PAYOUT]\x20Gateway\x20'+_0x4d16f8[_0x53f002(0xf0)]+'\x20for\x20shop\x20'+_0x142b44['id']+_0x53f002(0x1b2)+_0x3262a7+'%');break;}}}catch(_0x383cc7){console[_0x53f002(0x1dd)](_0x53f002(0x11b)+_0x142b44['id']+':',_0x383cc7);}const _0x597f1b=_0x4d16f8[_0x53f002(0x13d)]?.[_0x53f002(0x12c)]||0x0,_0x52a738=_0x597f1b*(0x1-_0x3262a7/0x64);return{'gateway':_0x4d16f8[_0x53f002(0xf0)],'count':_0x4d16f8[_0x53f002(0x167)]?.['id']||0x0,'amountUSDT':Math[_0x53f002(0x212)](_0x597f1b*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x53f002(0x212)](_0x52a738*0x64)/0x64,'commission':_0x3262a7};})),_0x57ea36=_0x12e52b[_0x4eb873(0x15e)]((_0x12d864,_0xf5faf9)=>_0x12d864+_0xf5faf9[_0x4eb873(0x12c)],0x0),_0x2872a5=_0x12e52b['reduce']((_0x416d43,_0x2594e0)=>_0x416d43+_0x2594e0[_0x4eb873(0x189)],0x0),_0x1d3391=_0x142b44['balance'];return console[_0x4eb873(0x135)](_0x4eb873(0x1ae)+_0x142b44[_0x4eb873(0x1e0)]+':'),console['log']('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x57ea36[_0x4eb873(0x1db)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console['log']('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x2872a5[_0x4eb873(0x1db)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log'](_0x4eb873(0x19a)+_0x1d3391['toFixed'](0x2)+_0x4eb873(0xed)),console['log']('\x20\x20\x20💸\x20Total\x20payouts:\x20'+_0x315387[_0x4eb873(0x1db)](0x2)+_0x4eb873(0x1cc)),console[_0x4eb873(0x135)]('\x20\x20\x20🤔\x20Difference:\x20'+(_0x2872a5-_0x315387-_0x1d3391)[_0x4eb873(0x1db)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x142b44['id'],'fullName':_0x142b44[_0x4eb873(0x103)],'username':_0x142b44[_0x4eb873(0x1e0)],'telegramId':_0x142b44[_0x4eb873(0x1d2)],'merchantUrl':_0x142b44[_0x4eb873(0x1e8)],'wallets':{'usdtPolygonWallet':_0x142b44[_0x4eb873(0x1b5)],'usdtTrcWallet':_0x142b44[_0x4eb873(0x1bf)],'usdtErcWallet':_0x142b44[_0x4eb873(0x186)],'usdcPolygonWallet':_0x142b44[_0x4eb873(0x113)]},'totalAmountUSDT':Math['round'](_0x57ea36*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4eb873(0x212)](_0x2872a5*0x64)/0x64,'currentBalance':Math['round'](_0x1d3391*0x64)/0x64,'totalPayout':Math['round'](_0x315387*0x64)/0x64,'thisMonth':Math[_0x4eb873(0x212)](_0x3b6789*0x64)/0x64,'paymentsCount':_0x383488,'oldestPaymentDate':_0x162e84?.['paidAt']||_0x142b44[_0x4eb873(0xe1)],'gatewayBreakdown':_0x12e52b};})),_0x1ec907=_0x339703[_0x347b0a(0x15e)]((_0x255750,_0x46bf56)=>_0x255750+_0x46bf56[_0x347b0a(0x1aa)],0x0),_0x3d88fc=_0x339703[_0x347b0a(0x15e)]((_0x4ddbe3,_0x2d1dde)=>_0x4ddbe3+_0x2d1dde['totalAmountAfterCommissionUSDT'],0x0),_0x1abc7a=_0x339703[_0x347b0a(0x15e)]((_0x3d03bf,_0x53b5ff)=>_0x3d03bf+_0x53b5ff[_0x347b0a(0xfb)],0x0),_0x5039d3=_0x339703['reduce']((_0x31be0e,_0xc5dd85)=>_0x31be0e+_0xc5dd85['thisMonth'],0x0);return console['log'](_0x347b0a(0x19c)+_0x257f04+_0x347b0a(0x1a9)),console['log'](_0x347b0a(0x198)+Math[_0x347b0a(0x212)](_0x1ec907*0x64)/0x64+_0x347b0a(0x11c)),console[_0x347b0a(0x135)](_0x347b0a(0x204)+Math[_0x347b0a(0x212)](_0x3d88fc*0x64)/0x64+_0x347b0a(0x208)),console[_0x347b0a(0x135)](_0x347b0a(0xf6)+Math[_0x347b0a(0x212)](_0x1abc7a*0x64)/0x64+_0x347b0a(0x18f)),console[_0x347b0a(0x135)](_0x347b0a(0x137)+Math['round'](_0x5039d3*0x64)/0x64+_0x347b0a(0x18f)),{'merchants':_0x339703,'pagination':{'page':_0x476161,'limit':_0x5edc2b,'total':_0x257f04,'totalPages':Math['ceil'](_0x257f04/_0x5edc2b)},'summary':{'totalMerchants':_0x257f04,'totalAmountUSDT':Math[_0x347b0a(0x212)](_0x1ec907*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3d88fc*0x64)/0x64,'totalPayout':Math[_0x347b0a(0x212)](_0x1abc7a*0x64)/0x64,'thisMonth':Math['round'](_0x5039d3*0x64)/0x64}};}async['createPayout'](_0x235ac7){const _0x2b6f00=a36_0x204bda,{shopId:_0x125da5,amount:_0x2e85a2,network:_0x34ef53,wallet:_0x194241,notes:_0x3c8d9f,txid:_0x3fbb5c,periodFrom:_0x2ebdaf,periodTo:_0x4e35ef}=_0x235ac7,_0x44a27a=await database_1[_0x2b6f00(0x120)][_0x2b6f00(0x11a)](async _0x3ed514=>{const _0x2e3199=_0x2b6f00,_0x2a7795=await _0x3ed514[_0x2e3199(0x184)][_0x2e3199(0x13f)]({'where':{'id':_0x125da5},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2a7795)throw new Error('Shop\x20not\x20found');console[_0x2e3199(0x135)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x2a7795[_0x2e3199(0x1e0)]+':'),console[_0x2e3199(0x135)]('\x20\x20\x20Current\x20balance:\x20'+_0x2a7795[_0x2e3199(0x1ac)][_0x2e3199(0x1db)](0x6)+'\x20USDT'),console['log'](_0x2e3199(0x1d7)+_0x2e85a2[_0x2e3199(0x1db)](0x6)+'\x20USDT'),console[_0x2e3199(0x135)](_0x2e3199(0x187)+_0x2a7795[_0x2e3199(0x1c9)][_0x2e3199(0x1db)](0x6)+_0x2e3199(0x18f));if(_0x3fbb5c)console['log'](_0x2e3199(0x110)+_0x3fbb5c);if(_0x2a7795[_0x2e3199(0x1ac)]<_0x2e85a2)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x2a7795[_0x2e3199(0x1ac)][_0x2e3199(0x1db)](0x6)+_0x2e3199(0x19d)+_0x2e85a2[_0x2e3199(0x1db)](0x6)+'\x20USDT');let _0x2900d9=_0x194241;if(!_0x2900d9){const _0x2457b0=await _0x3ed514[_0x2e3199(0x184)]['findUnique']({'where':{'id':_0x125da5},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x2457b0)switch(_0x34ef53){case _0x2e3199(0x1f3):_0x2900d9=_0x2457b0[_0x2e3199(0x1b5)]||undefined;break;case _0x2e3199(0x213):_0x2900d9=_0x2457b0['usdtTrcWallet']||undefined;break;case'erc20':_0x2900d9=_0x2457b0[_0x2e3199(0x186)]||undefined;break;case _0x2e3199(0x10b):_0x2900d9=_0x2457b0[_0x2e3199(0x113)]||undefined;break;}}console[_0x2e3199(0x135)]('💳\x20Payout\x20wallet\x20for\x20'+_0x34ef53+':\x20'+(_0x2900d9||'not\x20specified'));const _0x442118=await _0x3ed514[_0x2e3199(0x13e)][_0x2e3199(0x1cf)]({'data':{'shopId':_0x125da5,'amount':_0x2e85a2,'network':_0x34ef53,'status':_0x2e3199(0x1a5),'txid':_0x3fbb5c,'notes':_0x3c8d9f,'periodFrom':_0x2ebdaf?new Date(_0x2ebdaf):null,'periodTo':_0x4e35ef?new Date(_0x4e35ef):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4610cd=_0x2a7795[_0x2e3199(0x1ac)]-_0x2e85a2,_0x39a52c=_0x2a7795['totalPaidOut']+_0x2e85a2;return await _0x3ed514[_0x2e3199(0x184)][_0x2e3199(0x11d)]({'where':{'id':_0x125da5},'data':{'balance':_0x4610cd,'totalPaidOut':_0x39a52c}}),console[_0x2e3199(0x135)](_0x2e3199(0x1de)+_0x2a7795['username']+_0x2e3199(0x14f)),console[_0x2e3199(0x135)](_0x2e3199(0x136)+_0x2a7795[_0x2e3199(0x1ac)]['toFixed'](0x6)+_0x2e3199(0x119)+_0x4610cd[_0x2e3199(0x1db)](0x6)+_0x2e3199(0x11f)+_0x2e85a2['toFixed'](0x6)+')'),console[_0x2e3199(0x135)](_0x2e3199(0x1bb)+_0x2a7795[_0x2e3199(0x1c9)][_0x2e3199(0x1db)](0x6)+_0x2e3199(0x119)+_0x39a52c[_0x2e3199(0x1db)](0x6)+_0x2e3199(0x1b0)+_0x2e85a2['toFixed'](0x6)+')'),{'payout':_0x442118,'shop':_0x2a7795};});return console['log'](_0x2b6f00(0x16f)+_0x44a27a[_0x2b6f00(0x13e)]['id']+_0x2b6f00(0x13c)+_0x44a27a[_0x2b6f00(0x184)]['username']+'\x20('+_0x2e85a2+_0x2b6f00(0x1c4)),{'id':_0x44a27a[_0x2b6f00(0x13e)]['id'],'shopId':_0x44a27a[_0x2b6f00(0x13e)][_0x2b6f00(0x152)],'shopName':_0x44a27a[_0x2b6f00(0x184)][_0x2b6f00(0x103)],'shopUsername':_0x44a27a['shop'][_0x2b6f00(0x1e0)],'amount':_0x44a27a['payout'][_0x2b6f00(0xdb)],'network':_0x44a27a[_0x2b6f00(0x13e)]['network'],'status':_0x44a27a[_0x2b6f00(0x13e)][_0x2b6f00(0x1e3)],'txid':_0x44a27a[_0x2b6f00(0x13e)][_0x2b6f00(0x172)],'notes':_0x44a27a[_0x2b6f00(0x13e)]['notes'],'periodFrom':_0x44a27a[_0x2b6f00(0x13e)][_0x2b6f00(0x18e)],'periodTo':_0x44a27a['payout']['periodTo'],'createdAt':_0x44a27a[_0x2b6f00(0x13e)]['createdAt'],'paidAt':_0x44a27a['payout'][_0x2b6f00(0x15f)]};}async['getAllPayouts'](_0x2b5e4c){const _0xa3f02e=a36_0x204bda,{page:_0x25fe8e,limit:_0x17bef0,shopId:_0x473fb9,network:_0x43c9b0,dateFrom:_0x203058,dateTo:_0x14732f,search:_0x36a740}=_0x2b5e4c,_0x11d13a=(_0x25fe8e-0x1)*_0x17bef0,_0x2e6d8f={};_0x473fb9&&(_0x2e6d8f[_0xa3f02e(0x152)]=_0x473fb9);_0x43c9b0&&(_0x2e6d8f[_0xa3f02e(0x1c2)]=_0x43c9b0);(_0x203058||_0x14732f)&&(_0x2e6d8f[_0xa3f02e(0xe1)]={},_0x203058&&(_0x2e6d8f[_0xa3f02e(0xe1)][_0xa3f02e(0x205)]=new Date(_0x203058)),_0x14732f&&(_0x2e6d8f[_0xa3f02e(0xe1)][_0xa3f02e(0xfd)]=new Date(_0x14732f)));_0x36a740&&(_0x2e6d8f['OR']=[{'shop':{'name':{'contains':_0x36a740,'mode':_0xa3f02e(0x1cb)}}},{'shop':{'username':{'contains':_0x36a740,'mode':_0xa3f02e(0x1cb)}}},{'notes':{'contains':_0x36a740,'mode':'insensitive'}}]);const [_0x1cb4c0,_0x52a9f4]=await Promise['all']([database_1[_0xa3f02e(0x120)][_0xa3f02e(0x13e)][_0xa3f02e(0xd6)]({'where':_0x2e6d8f,'skip':_0x11d13a,'take':_0x17bef0,'orderBy':{'createdAt':_0xa3f02e(0x16c)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xa3f02e(0x120)][_0xa3f02e(0x13e)][_0xa3f02e(0x1a4)]({'where':_0x2e6d8f})]);return{'payouts':_0x1cb4c0[_0xa3f02e(0x1a7)](_0x3d94f0=>({'id':_0x3d94f0['id'],'shopId':_0x3d94f0['shopId'],'shopName':_0x3d94f0[_0xa3f02e(0x184)][_0xa3f02e(0x103)],'shopUsername':_0x3d94f0[_0xa3f02e(0x184)][_0xa3f02e(0x1e0)],'amount':_0x3d94f0['amount'],'network':_0x3d94f0[_0xa3f02e(0x1c2)],'status':_0x3d94f0[_0xa3f02e(0x1e3)],'txid':_0x3d94f0['txid'],'notes':_0x3d94f0[_0xa3f02e(0x19f)],'periodFrom':_0x3d94f0[_0xa3f02e(0x18e)],'periodTo':_0x3d94f0[_0xa3f02e(0x199)],'createdAt':_0x3d94f0['createdAt'],'paidAt':_0x3d94f0[_0xa3f02e(0x15f)]})),'pagination':{'page':_0x25fe8e,'limit':_0x17bef0,'total':_0x52a9f4,'totalPages':Math['ceil'](_0x52a9f4/_0x17bef0)}};}async[a36_0x204bda(0x12d)](_0x246f6a){const _0x11a736=a36_0x204bda,_0x1b093d=await database_1[_0x11a736(0x120)][_0x11a736(0x13e)][_0x11a736(0x13f)]({'where':{'id':_0x246f6a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1b093d)return null;return{'id':_0x1b093d['id'],'shopId':_0x1b093d['shopId'],'shopName':_0x1b093d[_0x11a736(0x184)][_0x11a736(0x103)],'shopUsername':_0x1b093d[_0x11a736(0x184)]['username'],'amount':_0x1b093d['amount'],'network':_0x1b093d[_0x11a736(0x1c2)],'status':_0x1b093d[_0x11a736(0x1e3)],'txid':_0x1b093d[_0x11a736(0x172)],'notes':_0x1b093d[_0x11a736(0x19f)],'periodFrom':_0x1b093d[_0x11a736(0x18e)],'periodTo':_0x1b093d[_0x11a736(0x199)],'createdAt':_0x1b093d[_0x11a736(0xe1)],'paidAt':_0x1b093d[_0x11a736(0x15f)]};}async['deletePayout'](_0x207c93){const _0x4e6095=a36_0x204bda;await database_1[_0x4e6095(0x120)][_0x4e6095(0x13e)]['delete']({'where':{'id':_0x207c93}});}async[a36_0x204bda(0x1c1)](_0x32d3bd){const _0x2ae513=a36_0x204bda,{page:_0x4eac1b,limit:_0x11c9fb,status:_0x2295f6,gateway:_0x1e56fc,shopId:_0x36c1be,dateFrom:_0x11a659,dateTo:_0x2ffa51,search:_0x41fd33,currency:_0x48bd1e,sortBy:_0x3880ed,sortOrder:_0x58dce7}=_0x32d3bd,_0x18206c=(_0x4eac1b-0x1)*_0x11c9fb;console[_0x2ae513(0x135)](_0x2ae513(0x1ff),_0x32d3bd);const _0x5057a2=await database_1['default'][_0x2ae513(0xe5)][_0x2ae513(0x188)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x2ae513(0x135)](_0x2ae513(0x111),_0x5057a2[_0x2ae513(0x1a7)](_0x4bb865=>_0x4bb865[_0x2ae513(0xf0)]+'\x20('+_0x4bb865[_0x2ae513(0x167)][_0x2ae513(0xf0)]+_0x2ae513(0x1da)));if(_0x1e56fc){const _0x1fe366=_0x5057a2[_0x2ae513(0x209)](_0xa133ac=>_0xa133ac[_0x2ae513(0xf0)]['toLowerCase']()===_0x1e56fc['toLowerCase']());!_0x1fe366&&_0x1e56fc[_0x2ae513(0x14b)]()!=='test_gateway'&&console[_0x2ae513(0x135)](_0x2ae513(0x1e5)+_0x1e56fc+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x5057a2[_0x2ae513(0x1a7)](_0x2cbd70=>_0x2cbd70[_0x2ae513(0xf0)])[_0x2ae513(0xf5)](',\x20'));}const _0x2af94d={};_0x2295f6&&(_0x2af94d['status']=_0x2295f6[_0x2ae513(0xe3)]());if(!_0x1e56fc)_0x2af94d[_0x2ae513(0xf0)]={'not':_0x2ae513(0x200)};else{if(_0x1e56fc&&(_0x1e56fc['toLowerCase']()===_0x2ae513(0x200)||_0x1e56fc===_0x2ae513(0x122)))_0x2af94d[_0x2ae513(0xf0)]=_0x2ae513(0x200);else{let _0x15334c=_0x1e56fc;const _0x386817=(0x0,gateway_1[_0x2ae513(0x1d9)])(_0x1e56fc);if(_0x386817)_0x15334c=_0x386817,console[_0x2ae513(0x135)](_0x2ae513(0x1b4)+_0x1e56fc+_0x2ae513(0x125)+_0x15334c+'\x27');else{const _0x32bffb=(0x0,gateway_1[_0x2ae513(0x156)])(_0x1e56fc);if(_0x32bffb){const _0x5165b0=(0x0,gateway_1['getGatewayNameById'])(_0x32bffb);_0x5165b0&&(_0x15334c=_0x5165b0,console['log'](_0x2ae513(0x195)+_0x1e56fc+'\x27\x20->\x20ID\x20\x27'+_0x32bffb+_0x2ae513(0xdd)+_0x15334c+'\x27'));}else console['log'](_0x2ae513(0x150)+_0x1e56fc+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x233e40=await database_1[_0x2ae513(0x120)]['payment'][_0x2ae513(0x1a4)]({'where':{'gateway':_0x15334c[_0x2ae513(0x14b)]()},'take':0x1});_0x233e40===0x0?(console[_0x2ae513(0x135)](_0x2ae513(0x117)+_0x15334c+'\x27\x20(from\x20\x27'+_0x1e56fc+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x2af94d['gateway']=_0x2ae513(0x1ca)):(_0x2af94d[_0x2ae513(0xf0)]=_0x15334c[_0x2ae513(0x14b)](),console['log']('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x15334c+_0x2ae513(0x100)+_0x1e56fc+'\x27)'));}}console['log']('📊\x20Gateway\x20filter\x20applied:',_0x2af94d[_0x2ae513(0xf0)]);_0x36c1be&&(_0x2af94d[_0x2ae513(0x152)]=_0x36c1be);_0x48bd1e&&(_0x2af94d[_0x2ae513(0x1d5)]=_0x48bd1e[_0x2ae513(0xe3)](),console[_0x2ae513(0x135)]('💱\x20Currency\x20filter\x20applied:\x20'+_0x48bd1e[_0x2ae513(0xe3)]()));(_0x11a659||_0x2ffa51)&&(_0x2af94d[_0x2ae513(0xe1)]={},_0x11a659&&(_0x2af94d[_0x2ae513(0xe1)]['gte']=new Date(_0x11a659)),_0x2ffa51&&(_0x2af94d[_0x2ae513(0xe1)][_0x2ae513(0xfd)]=new Date(_0x2ffa51)));_0x41fd33&&(_0x2af94d['OR']=[{'id':{'contains':_0x41fd33,'mode':_0x2ae513(0x1cb)}},{'orderId':{'contains':_0x41fd33,'mode':_0x2ae513(0x1cb)}},{'gatewayOrderId':{'contains':_0x41fd33,'mode':_0x2ae513(0x1cb)}},{'customerEmail':{'contains':_0x41fd33,'mode':_0x2ae513(0x1cb)}},{'shop':{'name':{'contains':_0x41fd33,'mode':_0x2ae513(0x1cb)}}},{'shop':{'username':{'contains':_0x41fd33,'mode':_0x2ae513(0x1cb)}}}]);console['log'](_0x2ae513(0xd7),JSON['stringify'](_0x2af94d,null,0x2));let _0x5103d4={'createdAt':'desc'};if(_0x3880ed){const _0x5e1d16=[_0x2ae513(0xdb),_0x2ae513(0xe1),'updatedAt',_0x2ae513(0x1e3),_0x2ae513(0xf0),_0x2ae513(0x1d5)],_0x19b3b6=['asc',_0x2ae513(0x16c)];if(_0x5e1d16[_0x2ae513(0x14e)](_0x3880ed)){const _0x349fb6=_0x19b3b6[_0x2ae513(0x14e)](_0x58dce7)?_0x58dce7:_0x2ae513(0x16c);_0x5103d4={[_0x3880ed]:_0x349fb6},console[_0x2ae513(0x135)]('📊\x20Sorting\x20payments\x20by\x20'+_0x3880ed+_0x2ae513(0x10e)+_0x349fb6+_0x2ae513(0xf4));}}const [_0x3b7c91,_0x1585d4]=await Promise['all']([database_1['default'][_0x2ae513(0xe5)][_0x2ae513(0xd6)]({'where':_0x2af94d,'skip':_0x18206c,'take':_0x11c9fb,'orderBy':_0x5103d4,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2ae513(0x120)][_0x2ae513(0xe5)][_0x2ae513(0x1a4)]({'where':_0x2af94d})]);return{'payments':_0x3b7c91,'pagination':{'page':_0x4eac1b,'limit':_0x11c9fb,'total':_0x1585d4,'totalPages':Math[_0x2ae513(0x1fa)](_0x1585d4/_0x11c9fb)}};}async[a36_0x204bda(0x1a1)](_0x5a9b1f){const _0x483fb4=a36_0x204bda,_0x335b1b=await database_1[_0x483fb4(0x120)][_0x483fb4(0xe5)][_0x483fb4(0x13f)]({'where':{'id':_0x5a9b1f},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x335b1b)return null;return{'id':_0x335b1b['id'],'shopId':_0x335b1b[_0x483fb4(0x152)],'gateway':_0x335b1b[_0x483fb4(0xf0)],'amount':_0x335b1b[_0x483fb4(0xdb)],'currency':_0x335b1b[_0x483fb4(0x1d5)],'status':_0x335b1b[_0x483fb4(0x1e3)],'orderId':_0x335b1b[_0x483fb4(0x101)],'gatewayOrderId':_0x335b1b[_0x483fb4(0x16d)],'customerEmail':_0x335b1b[_0x483fb4(0x127)],'customerName':_0x335b1b['customerName'],'customerCountry':_0x335b1b[_0x483fb4(0x201)],'customerIp':_0x335b1b['customerIp'],'customerUa':_0x335b1b[_0x483fb4(0x1d6)],'failureMessage':_0x335b1b['failureMessage'],'externalPaymentUrl':_0x335b1b[_0x483fb4(0xd5)],'successUrl':_0x335b1b[_0x483fb4(0x15d)],'failUrl':_0x335b1b[_0x483fb4(0x140)],'pendingUrl':_0x335b1b['pendingUrl'],'whiteUrl':_0x335b1b[_0x483fb4(0x1f9)],'createdAt':_0x335b1b[_0x483fb4(0xe1)],'updatedAt':_0x335b1b[_0x483fb4(0x1fb)],'shop':_0x335b1b[_0x483fb4(0x184)]};}async[a36_0x204bda(0x134)](_0x50e47f,_0x477426,_0x15c198,_0x1dec67){const _0x31658b=a36_0x204bda,_0x1952ed=await database_1['default'][_0x31658b(0x11a)](async _0x392def=>{const _0x23e45b=_0x31658b,_0x5e76ba=await _0x392def['payment'][_0x23e45b(0x13f)]({'where':{'id':_0x50e47f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5e76ba)throw new Error('Payment\x20not\x20found');const _0x27eac0=_0x5e76ba[_0x23e45b(0x1e3)],_0x4a626a=_0x477426[_0x23e45b(0xe3)]();console[_0x23e45b(0x135)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x50e47f+_0x23e45b(0x1ec)+_0x27eac0+_0x23e45b(0x119)+_0x4a626a),console[_0x23e45b(0x135)]('💰\x20Current\x20shop\x20balance:\x20'+_0x5e76ba['shop'][_0x23e45b(0x1ac)]+_0x23e45b(0x18f));const _0x1777a8={'status':_0x4a626a,'updatedAt':new Date(),'statusChangedBy':_0x23e45b(0xda),'statusChangedAt':new Date()};_0x15c198&&(_0x1777a8[_0x23e45b(0x171)]=_0x15c198);_0x4a626a==='CHARGEBACK'&&_0x1dec67&&(_0x1777a8[_0x23e45b(0xeb)]=_0x1dec67);let _0x7ff7db=0x0,_0x3cdf2f=_0x5e76ba[_0x23e45b(0x184)][_0x23e45b(0x1ac)];if(_0x4a626a===_0x23e45b(0x165)&&_0x27eac0!==_0x23e45b(0x165)){_0x1777a8[_0x23e45b(0x15f)]=new Date();const _0x5405cc=await currencyService_1[_0x23e45b(0x1e9)][_0x23e45b(0x148)](_0x5e76ba[_0x23e45b(0xdb)],_0x5e76ba[_0x23e45b(0x1d5)]);_0x1777a8[_0x23e45b(0x12c)]=_0x5405cc;let _0x48ecd1=0x2d;const _0x477110=await _0x392def['shop'][_0x23e45b(0x13f)]({'where':{'id':_0x5e76ba[_0x23e45b(0x152)]},'select':{'gatewaySettings':!![]}});if(_0x477110?.[_0x23e45b(0x102)])try{const _0x3f28a9=JSON[_0x23e45b(0x18b)](_0x477110[_0x23e45b(0x102)]);for(const [_0x19c3e6,_0x1bf4d3]of Object[_0x23e45b(0x17c)](_0x3f28a9)){if(_0x19c3e6[_0x23e45b(0x14b)]()===_0x5e76ba['gateway'][_0x23e45b(0x14b)]()){_0x48ecd1=_0x1bf4d3['commission']||0xa;break;}}}catch(_0x4cc99d){console['error'](_0x23e45b(0x16b)+_0x50e47f+':',_0x4cc99d);}let _0x43f0b5;_0x5e76ba[_0x23e45b(0x12b)]!==null&&_0x5e76ba[_0x23e45b(0x12b)]!==undefined?(_0x43f0b5=_0x5e76ba[_0x23e45b(0x12b)],console['log'](_0x23e45b(0x1b3)+_0x43f0b5[_0x23e45b(0x1db)](0x6)+_0x23e45b(0x190)+_0x50e47f)):(_0x43f0b5=_0x5405cc*(0x1-_0x48ecd1/0x64),console[_0x23e45b(0x135)](_0x23e45b(0x196)+_0x50e47f+':\x20'+_0x48ecd1+_0x23e45b(0x1b6)+_0x5405cc[_0x23e45b(0x1db)](0x6)+_0x23e45b(0x18f)),_0x1777a8['amountAfterGatewayCommissionUSDT']=_0x43f0b5,_0x1777a8[_0x23e45b(0x12a)]=_0x48ecd1),_0x7ff7db=_0x43f0b5,_0x3cdf2f+=_0x43f0b5,console['log'](_0x23e45b(0x1fd)+_0x50e47f+_0x23e45b(0x1eb)),console[_0x23e45b(0x135)](_0x23e45b(0xf1)+_0x5405cc['toFixed'](0x6)+_0x23e45b(0x18f)),console['log'](_0x23e45b(0x1b9)+_0x5e76ba['gateway']+_0x23e45b(0x104)+_0x48ecd1+'%'),console[_0x23e45b(0x135)](_0x23e45b(0x207)+_0x43f0b5[_0x23e45b(0x1db)](0x6)+_0x23e45b(0x1ef)+_0x48ecd1+_0x23e45b(0x131)),console['log'](_0x23e45b(0x106)+_0x43f0b5[_0x23e45b(0x1db)](0x6)+_0x23e45b(0x18f));}else{if(_0x27eac0===_0x23e45b(0x165)&&_0x4a626a!==_0x23e45b(0x165)){if(_0x5e76ba[_0x23e45b(0x12c)]){let _0x494caf=0x2d;const _0x50219c=await _0x392def[_0x23e45b(0x184)]['findUnique']({'where':{'id':_0x5e76ba['shopId']},'select':{'gatewaySettings':!![]}});if(_0x50219c?.['gatewaySettings'])try{const _0x32a12e=JSON[_0x23e45b(0x18b)](_0x50219c[_0x23e45b(0x102)]);for(const [_0x1ada23,_0x3ad646]of Object[_0x23e45b(0x17c)](_0x32a12e)){if(_0x1ada23['toLowerCase']()===_0x5e76ba[_0x23e45b(0xf0)][_0x23e45b(0x14b)]()){_0x494caf=_0x3ad646[_0x23e45b(0xf8)]||0xa;break;}}}catch(_0x33ec09){console[_0x23e45b(0x1dd)](_0x23e45b(0x16b)+_0x50e47f+':',_0x33ec09);}const _0x311faf=_0x5e76ba[_0x23e45b(0x12c)]*(0x1-_0x494caf/0x64);_0x7ff7db=-_0x311faf,_0x3cdf2f-=_0x311faf,_0x1777a8['amountUSDT']=null,_0x1777a8['amountAfterGatewayCommissionUSDT']=null,console[_0x23e45b(0x135)](_0x23e45b(0x1fd)+_0x50e47f+'\x20no\x20longer\x20PAID:'),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x5e76ba[_0x23e45b(0x12c)][_0x23e45b(0x1db)](0x6)+_0x23e45b(0x18f)),console[_0x23e45b(0x135)](_0x23e45b(0x1b9)+_0x5e76ba[_0x23e45b(0xf0)]+',\x20Commission:\x20'+_0x494caf+'%'),console['log'](_0x23e45b(0x19b)+_0x311faf[_0x23e45b(0x1db)](0x6)+_0x23e45b(0x1ef)+_0x494caf+_0x23e45b(0x131)),console[_0x23e45b(0x135)](_0x23e45b(0x133)+_0x311faf['toFixed'](0x6)+_0x23e45b(0x18f));}}}_0x4a626a===_0x23e45b(0x1d0)&&(_0x27eac0==='PAID'&&_0x5e76ba[_0x23e45b(0x12c)]&&console[_0x23e45b(0x135)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x1dec67&&_0x1dec67>0x0&&(_0x7ff7db-=_0x1dec67,_0x3cdf2f-=_0x1dec67,console[_0x23e45b(0x135)](_0x23e45b(0x170)+_0x1dec67[_0x23e45b(0x1db)](0x6)+_0x23e45b(0xf3))));_0x4a626a==='REFUND'&&_0x27eac0==='PAID'&&console['log'](_0x23e45b(0x169));const _0x2b17bb=await _0x392def['payment'][_0x23e45b(0x11d)]({'where':{'id':_0x50e47f},'data':_0x1777a8,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x7ff7db!==0x0&&(await _0x392def[_0x23e45b(0x184)][_0x23e45b(0x11d)]({'where':{'id':_0x5e76ba[_0x23e45b(0x152)]},'data':{'balance':_0x3cdf2f}}),console[_0x23e45b(0x135)](_0x23e45b(0x1de)+_0x5e76ba['shopId']+_0x23e45b(0x132)+_0x5e76ba[_0x23e45b(0x184)][_0x23e45b(0x1ac)][_0x23e45b(0x1db)](0x6)+_0x23e45b(0x119)+_0x3cdf2f[_0x23e45b(0x1db)](0x6)+_0x23e45b(0xf9)+(_0x7ff7db>0x0?'+':'')+_0x7ff7db['toFixed'](0x6)+')')),_0x2b17bb;});return{'id':_0x1952ed['id'],'shopId':_0x1952ed[_0x31658b(0x152)],'gateway':_0x1952ed[_0x31658b(0xf0)],'amount':_0x1952ed['amount'],'currency':_0x1952ed['currency'],'status':_0x1952ed[_0x31658b(0x1e3)],'orderId':_0x1952ed[_0x31658b(0x101)],'gatewayOrderId':_0x1952ed[_0x31658b(0x16d)],'customerEmail':_0x1952ed[_0x31658b(0x127)],'customerName':_0x1952ed[_0x31658b(0x142)],'customerCountry':_0x1952ed[_0x31658b(0x201)],'customerIp':_0x1952ed[_0x31658b(0x1f1)],'customerUa':_0x1952ed[_0x31658b(0x1d6)],'failureMessage':_0x1952ed[_0x31658b(0x1cd)],'adminNotes':_0x1952ed['adminNotes'],'chargebackAmount':_0x1952ed[_0x31658b(0xeb)],'statusChangedBy':_0x1952ed['statusChangedBy'],'statusChangedAt':_0x1952ed[_0x31658b(0x15c)],'createdAt':_0x1952ed[_0x31658b(0xe1)],'updatedAt':_0x1952ed['updatedAt'],'shop':_0x1952ed['shop']};}async[a36_0x204bda(0xdc)](_0x21f353,_0x49d52a){const _0x556128=a36_0x204bda,_0x22c7fe=Math[_0x556128(0x197)]()[_0x556128(0x161)](0x24)[_0x556128(0x112)](0x2,0x9);console['log'](_0x556128(0xfa)+_0x22c7fe+_0x556128(0x126)+_0x21f353);const _0x4ca45a={..._0x49d52a};_0x49d52a[_0x556128(0x1c7)]&&_0x49d52a[_0x556128(0x1c7)][_0x556128(0x1fe)]()!==''?(console[_0x556128(0x135)](_0x556128(0x1a6)+_0x22c7fe+']\x20Updating\x20password\x20for\x20user\x20'+_0x21f353),_0x4ca45a[_0x556128(0x1c7)]=await bcryptjs_1[_0x556128(0x120)][_0x556128(0x1c8)](_0x49d52a[_0x556128(0x1c7)],0xc)):(console[_0x556128(0x135)]('🔐\x20['+_0x22c7fe+_0x556128(0xe9)),delete _0x4ca45a[_0x556128(0x1c7)]);_0x49d52a[_0x556128(0x20e)]&&(_0x4ca45a[_0x556128(0x103)]=_0x49d52a[_0x556128(0x20e)],delete _0x4ca45a[_0x556128(0x20e)]);_0x49d52a[_0x556128(0xd3)]&&(_0x4ca45a[_0x556128(0x1d2)]=_0x49d52a[_0x556128(0xd3)],delete _0x4ca45a[_0x556128(0xd3)]);_0x49d52a[_0x556128(0xe6)]&&(_0x4ca45a[_0x556128(0x1e8)]=_0x49d52a[_0x556128(0xe6)],delete _0x4ca45a[_0x556128(0xe6)]);if(_0x49d52a[_0x556128(0x147)]){const _0x1d6229=_0x49d52a[_0x556128(0x147)][_0x556128(0x1a7)](_0xd7bc04=>this['getGatewayInternalName'](_0xd7bc04));console[_0x556128(0x135)]('🔄\x20Gateway\x20mapping:',_0x49d52a['gateways'],'->',_0x1d6229),_0x4ca45a['paymentGateways']=JSON[_0x556128(0x20c)](_0x1d6229),delete _0x4ca45a['gateways'];}_0x49d52a[_0x556128(0x102)]&&(console['log'](_0x556128(0x182)+_0x22c7fe+_0x556128(0x1c5),_0x49d52a[_0x556128(0x102)]),_0x4ca45a[_0x556128(0x102)]=JSON['stringify'](_0x49d52a[_0x556128(0x102)]),console[_0x556128(0x135)](_0x556128(0x182)+_0x22c7fe+_0x556128(0x143),_0x4ca45a[_0x556128(0x102)]));_0x49d52a[_0x556128(0x174)]&&(_0x49d52a[_0x556128(0x174)]['usdtPolygonWallet']!==undefined&&(_0x4ca45a['usdtPolygonWallet']=_0x49d52a['wallets']['usdtPolygonWallet']||null),_0x49d52a[_0x556128(0x174)][_0x556128(0x1bf)]!==undefined&&(_0x4ca45a[_0x556128(0x1bf)]=_0x49d52a[_0x556128(0x174)][_0x556128(0x1bf)]||null),_0x49d52a['wallets'][_0x556128(0x186)]!==undefined&&(_0x4ca45a[_0x556128(0x186)]=_0x49d52a[_0x556128(0x174)][_0x556128(0x186)]||null),_0x49d52a[_0x556128(0x174)]['usdcPolygonWallet']!==undefined&&(_0x4ca45a[_0x556128(0x113)]=_0x49d52a['wallets'][_0x556128(0x113)]||null),delete _0x4ca45a[_0x556128(0x174)]);const _0xd6803=await database_1['default']['shop'][_0x556128(0x11d)]({'where':{'id':_0x21f353},'data':_0x4ca45a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x556128(0x135)](_0x556128(0x158)+_0x22c7fe+_0x556128(0x1a8),_0xd6803[_0x556128(0x102)]),{'id':_0xd6803['id'],'fullName':_0xd6803['name'],'username':_0xd6803[_0x556128(0x1e0)],'telegramId':_0xd6803[_0x556128(0x1d2)],'merchantUrl':_0xd6803[_0x556128(0x1e8)],'gateways':_0xd6803[_0x556128(0x141)]?JSON['parse'](_0xd6803[_0x556128(0x141)]):null,'gatewaySettings':_0xd6803['gatewaySettings']?JSON[_0x556128(0x18b)](_0xd6803['gatewaySettings']):null,'publicKey':_0xd6803[_0x556128(0x109)],'wallets':{'usdtPolygonWallet':_0xd6803[_0x556128(0x1b5)],'usdtTrcWallet':_0xd6803[_0x556128(0x1bf)],'usdtErcWallet':_0xd6803[_0x556128(0x186)],'usdcPolygonWallet':_0xd6803[_0x556128(0x113)]},'status':_0xd6803[_0x556128(0x1e3)],'createdAt':_0xd6803['createdAt']};}async[a36_0x204bda(0x10a)](_0x153d93){const _0x3a05a5=a36_0x204bda,_0x5e25da=await database_1[_0x3a05a5(0x120)][_0x3a05a5(0x184)][_0x3a05a5(0x11d)]({'where':{'id':_0x153d93},'data':{'status':_0x3a05a5(0x1b7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5e25da['id'],'fullName':_0x5e25da['name'],'username':_0x5e25da[_0x3a05a5(0x1e0)],'telegramId':_0x5e25da[_0x3a05a5(0x1d2)],'merchantUrl':_0x5e25da[_0x3a05a5(0x1e8)],'gateways':_0x5e25da[_0x3a05a5(0x141)]?JSON[_0x3a05a5(0x18b)](_0x5e25da[_0x3a05a5(0x141)]):null,'gatewaySettings':_0x5e25da[_0x3a05a5(0x102)]?JSON['parse'](_0x5e25da[_0x3a05a5(0x102)]):null,'publicKey':_0x5e25da['publicKey'],'wallets':{'usdtPolygonWallet':_0x5e25da['usdtPolygonWallet'],'usdtTrcWallet':_0x5e25da[_0x3a05a5(0x1bf)],'usdtErcWallet':_0x5e25da[_0x3a05a5(0x186)],'usdcPolygonWallet':_0x5e25da[_0x3a05a5(0x113)]},'status':_0x5e25da[_0x3a05a5(0x1e3)],'createdAt':_0x5e25da[_0x3a05a5(0xe1)]};}async[a36_0x204bda(0x178)](_0x7850d1){const _0x4f32ae=a36_0x204bda,_0x204ac6=await database_1[_0x4f32ae(0x120)][_0x4f32ae(0x184)][_0x4f32ae(0x11d)]({'where':{'id':_0x7850d1},'data':{'status':_0x4f32ae(0x121)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x204ac6['id'],'fullName':_0x204ac6[_0x4f32ae(0x103)],'username':_0x204ac6[_0x4f32ae(0x1e0)],'telegramId':_0x204ac6['telegram'],'merchantUrl':_0x204ac6['shopUrl'],'gateways':_0x204ac6[_0x4f32ae(0x141)]?JSON[_0x4f32ae(0x18b)](_0x204ac6[_0x4f32ae(0x141)]):null,'gatewaySettings':_0x204ac6['gatewaySettings']?JSON['parse'](_0x204ac6[_0x4f32ae(0x102)]):null,'publicKey':_0x204ac6[_0x4f32ae(0x109)],'wallets':{'usdtPolygonWallet':_0x204ac6[_0x4f32ae(0x1b5)],'usdtTrcWallet':_0x204ac6['usdtTrcWallet'],'usdtErcWallet':_0x204ac6['usdtErcWallet'],'usdcPolygonWallet':_0x204ac6[_0x4f32ae(0x113)]},'status':_0x204ac6[_0x4f32ae(0x1e3)],'createdAt':_0x204ac6[_0x4f32ae(0xe1)]};}async[a36_0x204bda(0x1df)](_0x19d548){const _0x10d83c=a36_0x204bda,{page:_0x265d54,limit:_0x57a6c0,status:_0x1ccd7f}=_0x19d548,_0x27b401=(_0x265d54-0x1)*_0x57a6c0,_0x2ab2cb={};_0x1ccd7f&&(_0x2ab2cb[_0x10d83c(0x1e3)]=_0x1ccd7f[_0x10d83c(0xe3)]());const [_0x14741c,_0x43b02c]=await Promise[_0x10d83c(0x183)]([database_1[_0x10d83c(0x120)][_0x10d83c(0x184)]['findMany']({'where':_0x2ab2cb,'skip':_0x27b401,'take':_0x57a6c0,'orderBy':{'createdAt':_0x10d83c(0x16c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x10d83c(0x120)][_0x10d83c(0x184)][_0x10d83c(0x1a4)]({'where':_0x2ab2cb})]);return{'users':_0x14741c[_0x10d83c(0x1a7)](_0x15934a=>{const _0x3a23f0=_0x10d83c,_0x37db48=_0x15934a[_0x3a23f0(0x141)]?JSON[_0x3a23f0(0x18b)](_0x15934a[_0x3a23f0(0x141)]):null,_0x9b0408=_0x37db48?_0x37db48[_0x3a23f0(0x1a7)](_0x18f612=>this[_0x3a23f0(0x1e4)](_0x18f612)):null;return{'id':_0x15934a['id'],'fullName':_0x15934a[_0x3a23f0(0x103)],'username':_0x15934a[_0x3a23f0(0x1e0)],'telegramId':_0x15934a[_0x3a23f0(0x1d2)],'merchantUrl':_0x15934a[_0x3a23f0(0x1e8)],'gateways':_0x9b0408,'gatewaySettings':_0x15934a['gatewaySettings']?JSON[_0x3a23f0(0x18b)](_0x15934a[_0x3a23f0(0x102)]):null,'publicKey':_0x15934a[_0x3a23f0(0x109)],'wallets':{'usdtPolygonWallet':_0x15934a[_0x3a23f0(0x1b5)],'usdtTrcWallet':_0x15934a[_0x3a23f0(0x1bf)],'usdtErcWallet':_0x15934a[_0x3a23f0(0x186)],'usdcPolygonWallet':_0x15934a[_0x3a23f0(0x113)]},'status':_0x15934a[_0x3a23f0(0x1e3)],'createdAt':_0x15934a['createdAt']};}),'pagination':{'page':_0x265d54,'limit':_0x57a6c0,'total':_0x43b02c,'totalPages':Math['ceil'](_0x43b02c/_0x57a6c0)}};}async['getUserById'](_0x2f6394){const _0x1bb38e=a36_0x204bda,_0x2ba820=await database_1[_0x1bb38e(0x120)][_0x1bb38e(0x184)][_0x1bb38e(0x13f)]({'where':{'id':_0x2f6394},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2ba820)return null;const _0x4079e4=_0x2ba820[_0x1bb38e(0x141)]?JSON[_0x1bb38e(0x18b)](_0x2ba820[_0x1bb38e(0x141)]):null,_0x32ae98=_0x4079e4?_0x4079e4[_0x1bb38e(0x1a7)](_0x12c53d=>this['getGatewayDisplayName'](_0x12c53d)):null;return _0x4079e4&&_0x32ae98&&console[_0x1bb38e(0x135)](_0x1bb38e(0x1d4),_0x4079e4,'->',_0x32ae98),{'id':_0x2ba820['id'],'fullName':_0x2ba820[_0x1bb38e(0x103)],'username':_0x2ba820['username'],'telegramId':_0x2ba820[_0x1bb38e(0x1d2)],'merchantUrl':_0x2ba820[_0x1bb38e(0x1e8)],'gateways':_0x32ae98,'gatewaySettings':_0x2ba820['gatewaySettings']?JSON[_0x1bb38e(0x18b)](_0x2ba820[_0x1bb38e(0x102)]):null,'publicKey':_0x2ba820[_0x1bb38e(0x109)],'wallets':{'usdtPolygonWallet':_0x2ba820['usdtPolygonWallet'],'usdtTrcWallet':_0x2ba820[_0x1bb38e(0x1bf)],'usdtErcWallet':_0x2ba820['usdtErcWallet'],'usdcPolygonWallet':_0x2ba820['usdcPolygonWallet']},'status':_0x2ba820['status'],'createdAt':_0x2ba820[_0x1bb38e(0xe1)]};}async[a36_0x204bda(0xd2)](_0x30f452){const _0x5c906e=a36_0x204bda,{fullName:_0x565bfe,username:_0x91ea5e,password:_0xbc8334,telegramId:_0x3fea55,merchantUrl:_0x589e8e,gateways:_0x1bdf2d,gatewaySettings:_0x3cae43,wallets:_0x2ee615}=_0x30f452,_0x4194b3=await database_1[_0x5c906e(0x120)][_0x5c906e(0x184)][_0x5c906e(0x13f)]({'where':{'username':_0x91ea5e}});if(_0x4194b3)throw new Error(_0x5c906e(0x17d));if(_0x3fea55){const _0x24069f=await database_1[_0x5c906e(0x120)]['shop'][_0x5c906e(0x13f)]({'where':{'telegram':_0x3fea55}});if(_0x24069f)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xc0cc36=await bcryptjs_1[_0x5c906e(0x120)][_0x5c906e(0x1c8)](_0xbc8334,0xc),_0x4831ec=_0x5c906e(0xf7)+crypto_1['default'][_0x5c906e(0x160)](0x20)[_0x5c906e(0x161)]('hex'),_0xe66728=_0x5c906e(0x105)+crypto_1[_0x5c906e(0x120)][_0x5c906e(0x160)](0x20)[_0x5c906e(0x161)](_0x5c906e(0x1f6)),_0x9c8884=_0x1bdf2d?_0x1bdf2d[_0x5c906e(0x1a7)](_0x4fde8a=>this[_0x5c906e(0x1bd)](_0x4fde8a)):null;_0x1bdf2d&&_0x9c8884&&console[_0x5c906e(0x135)](_0x5c906e(0x206),_0x1bdf2d,'->',_0x9c8884);const _0x202993=await database_1[_0x5c906e(0x120)]['shop'][_0x5c906e(0x1cf)]({'data':{'name':_0x565bfe,'username':_0x91ea5e,'password':_0xc0cc36,'telegram':_0x3fea55,'shopUrl':_0x589e8e,'paymentGateways':_0x9c8884?JSON[_0x5c906e(0x20c)](_0x9c8884):null,'gatewaySettings':_0x3cae43?JSON[_0x5c906e(0x20c)](_0x3cae43):null,'usdtPolygonWallet':_0x2ee615?.[_0x5c906e(0x1b5)]||null,'usdtTrcWallet':_0x2ee615?.[_0x5c906e(0x1bf)]||null,'usdtErcWallet':_0x2ee615?.[_0x5c906e(0x186)]||null,'usdcPolygonWallet':_0x2ee615?.[_0x5c906e(0x113)]||null,'publicKey':_0x4831ec,'secretKey':_0xe66728,'status':_0x5c906e(0x121)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x202993['id'],'fullName':_0x202993[_0x5c906e(0x103)],'username':_0x202993[_0x5c906e(0x1e0)],'telegramId':_0x202993[_0x5c906e(0x1d2)],'merchantUrl':_0x202993[_0x5c906e(0x1e8)],'gateways':_0x202993['paymentGateways']?JSON[_0x5c906e(0x18b)](_0x202993[_0x5c906e(0x141)]):null,'gatewaySettings':_0x202993['gatewaySettings']?JSON['parse'](_0x202993['gatewaySettings']):null,'publicKey':_0x202993['publicKey'],'wallets':{'usdtPolygonWallet':_0x202993['usdtPolygonWallet'],'usdtTrcWallet':_0x202993[_0x5c906e(0x1bf)],'usdtErcWallet':_0x202993['usdtErcWallet'],'usdcPolygonWallet':_0x202993[_0x5c906e(0x113)]},'status':_0x202993[_0x5c906e(0x1e3)],'createdAt':_0x202993[_0x5c906e(0xe1)]};}async[a36_0x204bda(0x1a2)](_0x1b4f97){const _0x36bb71=a36_0x204bda;await database_1['default'][_0x36bb71(0x184)][_0x36bb71(0x16a)]({'where':{'id':_0x1b4f97}});}['generateDailyStatistics'](_0x5cd2f9,_0x4b072a,_0x2e69c7){const _0x497226=a36_0x204bda,_0x16954a=new Map(),_0x51c409=new Date(_0x4b072a);while(_0x51c409<=_0x2e69c7){const _0x47d6ad=_0x51c409[_0x497226(0x1d3)]()[_0x497226(0xee)]('T')[0x0];_0x16954a[_0x497226(0x1f7)](_0x47d6ad,{'revenue':0x0,'count':0x0}),_0x51c409[_0x497226(0x211)](_0x51c409[_0x497226(0x123)]()+0x1);}for(const _0x316ea4 of _0x5cd2f9){const _0x41e430=_0x316ea4[_0x497226(0xe1)][_0x497226(0x1d3)]()['split']('T')[0x0],_0x236fa4=_0x16954a[_0x497226(0x118)](_0x41e430);_0x236fa4&&(_0x236fa4[_0x497226(0x1a4)]+=0x1,_0x316ea4[_0x497226(0x1e3)]===_0x497226(0x165)&&(_0x316ea4[_0x497226(0x12c)]?_0x236fa4['revenue']+=_0x316ea4[_0x497226(0x12c)]:console[_0x497226(0x135)](_0x497226(0x17b)+_0x316ea4['id']+_0x497226(0x13b))));}const _0x455f2e=[],_0x2d4976=[];for(const [_0x4d13b7,_0x35b7f4]of _0x16954a){_0x455f2e[_0x497226(0x20d)]({'date':_0x4d13b7,'amount':Math[_0x497226(0x212)](_0x35b7f4['revenue']*0x64)/0x64}),_0x2d4976['push']({'date':_0x4d13b7,'count':_0x35b7f4[_0x497226(0x1a4)]});}return{'dailyRevenue':_0x455f2e,'dailyPayments':_0x2d4976};}}exports[a36_0x204bda(0x1b1)]=AdminService;