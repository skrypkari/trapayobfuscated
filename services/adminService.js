'use strict';const a35_0x71f5f0=a35_0x2ec9;(function(_0x460e4e,_0x1e0e11){const _0x36b76e=a35_0x2ec9,_0x50bab4=_0x460e4e();while(!![]){try{const _0x287ce1=parseInt(_0x36b76e(0xe9))/0x1+parseInt(_0x36b76e(0x12e))/0x2+-parseInt(_0x36b76e(0x16f))/0x3+-parseInt(_0x36b76e(0x11d))/0x4*(-parseInt(_0x36b76e(0xc1))/0x5)+-parseInt(_0x36b76e(0x10a))/0x6*(parseInt(_0x36b76e(0x136))/0x7)+parseInt(_0x36b76e(0xa6))/0x8*(parseInt(_0x36b76e(0x159))/0x9)+parseInt(_0x36b76e(0xc5))/0xa;if(_0x287ce1===_0x1e0e11)break;else _0x50bab4['push'](_0x50bab4['shift']());}catch(_0x52988e){_0x50bab4['push'](_0x50bab4['shift']());}}}(a35_0x1009,0x71b5d));function a35_0x1009(){const _0x3eb8bc=['forEach','sk_','map','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','adminNotes','whiteUrl','22210HYkeaD','\x20\x20\x20🖥️\x20User\x20Agent:\x20','KLYME\x20DE','activateUser','randomBytes','log','Username\x20already\x20exists','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','159880fYnPEB','📊\x20Payment\x20','username','payment','not\x20found','ceil','chargebackAmount','aggregate','gte','\x20\x20\x20Payout\x20amount:\x20','turnover','\x20->\x20','KLYME\x20EU','custom','groupBy','getPayoutById','gatewaySettings','\x20\x20\x20✅\x20Successful\x20payments:\x20','usdtPolygonWallet','delete','\x20became\x20PAID:\x20+','updatePaymentStatus','💰\x20Found\x20','hex','📊\x20Total\x20payments\x20(all\x20statuses):\x20','getMerchantsSelection','currencyService','default','getAllUsers','findFirst','setDate','paymentMethod','\x20merchants,\x20','convertToUSDT','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','4518SsFOTH','averageCommissionRate','averageCheckUSDT','generateDailyStatistics','amountUSDT','✅\x20Successful\x20payments:\x20','payout','error','month','\x20PAID\x20payments\x20out\x20of\x20','bankId','usdtTrcWallet','wallets','__importDefault','usdtErcWallet','successfulPayments','toLowerCase','\x20USDT)','totalCommissionRate','\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20','create','periodFrom','1720119GNywFz','./currencyService','💰\x20Shop\x20','\x20\x20\x20Raw\x20gatewaySettings:\x20','push','💰\x20Payment\x20','PAID','REFUND','not\x20set','merchantEarningsUSDT','💰\x20Current\x20shop\x20balance:\x20','getSystemStatistics','merchantEarnings','conversionRate','COMPLETED','getDate','parse','📊\x20[ADMIN]\x20Period:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','Test\x20Gateway','totalPayments','📊\x20[DAILY]\x20Total\x20revenue\x20processed:\x20','date','hash','toISOString','string','failureMessage','awaitingPayout','\x20USDT\x20for\x20payment\x20on\x20','SUSPENDED','find','getTime','\x20\x20\x20📈\x20Conversion\x20rate:\x20','count','fullName','\x20paid\x20payments\x20for\x20analysis','📊\x20[DAILY]\x20Processed\x20','cardLast4','KLYME\x20GB','createUser','insensitive','status','set','_count','commissionUSDT','ACTIVE','amount','\x20USDT\x20to\x20balance','getFullYear','customerUa','remitterName','gatewayEarnings','txUrls','totalTurnover','$transaction','\x20USDT\x20(','💱\x20[DAILY]\x20Converted\x20','update','revenue','round','remitterIban','paymentGateways','Telegram\x20username\x20already\x20exists','periodTo','reduce','crypto','get','4744JfcXlP','length','\x20USDT','\x20payments\x20for\x20daily\x20statistics','period','\x20USDT\x20(-','\x20USDT\x20from\x20balance','year','📊\x20Calculating\x20payout\x20statistics...','admin','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','💰\x20[DAILY]\x20Added\x20','network','\x20USDT\x20(total\x20paid\x20to\x20merchants)','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','sort','desc','Shop\x20not\x20found','totalPayout','paymentsCount','defineProperty','deleteUser','totalPaidOut','2020-01-01','\x20USDT\x20(same\x20as\x20awaiting)','findMany','usdcPolygonWallet','5VWSLQu','values','notes','shopUrl','107600lPustN','\x20\x20\x20Final\x20commission\x20used:\x20','\x20no\x20longer\x20PAID:\x20-','keys','statusChangedAt','dateTo','updatedAt','✅\x20Payout\x20created:\x20','updateUser','90d','__esModule','createPayout','customerIp','name','localeCompare','\x20(direct\x20amountUSDT)','findUnique','paidAt','getGatewayDisplayName','\x20\x20\x20Total\x20paid\x20out:\x20','asc','gateways','createdAt','customerEmail','orderId','AdminService','_sum','txid','deletePayout','failUrl','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','getUserById','\x20\x20\x20Parsed\x20gatewaySettings:','\x20\x20\x20Shop:\x20','\x20\x20\x20Commission\x20from\x20settings:\x20','statusChangedBy','721020azVqch','customerName','CoinToPay','thisMonth','\x20USDT\x20(+','Error\x20processing\x20payment\x20','\x20\x20\x20📅\x20This\x20month:\x20','commission','\x20USDT\x20total','dateFrom','toFixed','currency','gatewayOrderId','\x20status:\x20','\x20\x20\x20Total\x20payments:\x20','toUpperCase','password','gateway','getPaymentById','📊\x20Merchants\x20awaiting\x20payout:\x20','all','balance','paidOutUSDT','\x20USDT\x20(total\x20merchant\x20balances)','test_gateway','null','📊\x20[ADMIN]\x20Processing\x20','turnoverUSDT','getMonth','Noda','INACTIVE','\x20USDT,\x20Requested:\x20','Payment\x20not\x20found','84YTqNyZ','telegramId','stringify','\x20USDT\x20for\x20','split','💰\x20Creating\x20payout\x20for\x20shop\x20','pendingUrl','toString','\x20\x20\x20🌍\x20Country:\x20','\x20\x20\x20Current\x20balance:\x20','CHARGEBACK','\x20\x20\x20💰\x20Total\x20turnover:\x20','merchantUrl','📊\x20Conversion\x20rate\x20calculation:','\x20for\x20shop\x20','customerCountry','\x20commission\x20analysis:','telegram','shopId','1273276jwpHcw','warn','publicKey','lte','pk_','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','📊\x20Merchant\x20statistics\x20calculated:','availableBalance','\x20\x20\x20Conversion\x20rate:\x20','shop','dailyPayments'];a35_0x1009=function(){return _0x3eb8bc;};return a35_0x1009();}var __importDefault=this&&this[a35_0x71f5f0(0x166)]||function(_0x113fcf){return _0x113fcf&&_0x113fcf['__esModule']?_0x113fcf:{'default':_0x113fcf};};Object[a35_0x71f5f0(0xba)](exports,a35_0x71f5f0(0xcf),{'value':!![]}),exports[a35_0x71f5f0(0xde)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x71f5f0(0xa4))),currencyService_1=require(a35_0x71f5f0(0x170));function a35_0x2ec9(_0xd813e4,_0x45e028){const _0x10094b=a35_0x1009();return a35_0x2ec9=function(_0x2ec9e1,_0x2266fd){_0x2ec9e1=_0x2ec9e1-0x8c;let _0x985d8a=_0x10094b[_0x2ec9e1];return _0x985d8a;},a35_0x2ec9(_0xd813e4,_0x45e028);}class AdminService{async['getPayoutStats'](){const _0x205de6=a35_0x71f5f0;console[_0x205de6(0x133)](_0x205de6(0xae));const _0x48bbad=await database_1['default'][_0x205de6(0x126)][_0x205de6(0x13d)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x1c82db=new Date(),_0x3c2455=new Date(_0x1c82db[_0x205de6(0x93)](),_0x1c82db[_0x205de6(0x105)](),0x1),_0x997c7e=new Date(_0x1c82db[_0x205de6(0x93)](),_0x1c82db[_0x205de6(0x105)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xcd2f7b=await database_1[_0x205de6(0x151)][_0x205de6(0x15f)][_0x205de6(0x13d)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3c2455,'lte':_0x997c7e},'status':_0x205de6(0x17d)}}),_0x3991c8=_0x48bbad[_0x205de6(0xdf)]['totalPaidOut']||0x0,_0x4fb4c1=_0x48bbad[_0x205de6(0xdf)][_0x205de6(0xfe)]||0x0,_0x3e556e=_0xcd2f7b['_sum'][_0x205de6(0x91)]||0x0,_0x4e35b9={'totalPayout':Math['round'](_0x3991c8*0x64)/0x64,'awaitingPayout':Math[_0x205de6(0x9e)](_0x4fb4c1*0x64)/0x64,'thisMonth':Math[_0x205de6(0x9e)](_0x3e556e*0x64)/0x64,'availableBalance':Math[_0x205de6(0x9e)](_0x4fb4c1*0x64)/0x64};return console['log']('📊\x20Payout\x20statistics\x20calculated:'),console[_0x205de6(0x133)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x4e35b9[_0x205de6(0xb8)]+_0x205de6(0xb3)),console[_0x205de6(0x133)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x4e35b9[_0x205de6(0x18a)]+_0x205de6(0x100)),console[_0x205de6(0x133)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x4e35b9[_0x205de6(0x124)]+_0x205de6(0xbe)),console['log'](_0x205de6(0xef)+_0x4e35b9[_0x205de6(0xec)]+_0x205de6(0xa8)),_0x4e35b9;}async['updateCustomerData'](_0x2b3d17,_0x3b2883){const _0x1e70e3=a35_0x71f5f0;console[_0x1e70e3(0x133)](_0x1e70e3(0xe3)+_0x2b3d17+':',_0x3b2883);const _0x6c6009=await database_1[_0x1e70e3(0x151)][_0x1e70e3(0x139)]['findUnique']({'where':{'id':_0x2b3d17},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x6c6009)throw new Error(_0x1e70e3(0x109));const _0x3a48b0={};_0x3b2883['customerCountry']!==undefined&&(_0x3a48b0['customerCountry']=_0x3b2883['customerCountry']||null);_0x3b2883[_0x1e70e3(0xd1)]!==undefined&&(_0x3a48b0[_0x1e70e3(0xd1)]=_0x3b2883[_0x1e70e3(0xd1)]||null);_0x3b2883[_0x1e70e3(0x94)]!==undefined&&(_0x3a48b0[_0x1e70e3(0x94)]=_0x3b2883[_0x1e70e3(0x94)]||null);const _0x4941d3=await database_1[_0x1e70e3(0x151)][_0x1e70e3(0x139)]['update']({'where':{'id':_0x2b3d17},'data':{..._0x3a48b0,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x2b3d17),console[_0x1e70e3(0x133)](_0x1e70e3(0x112)+_0x6c6009[_0x1e70e3(0x119)]+_0x1e70e3(0x141)+_0x4941d3['customerCountry']),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x6c6009[_0x1e70e3(0xd1)]+_0x1e70e3(0x141)+_0x4941d3[_0x1e70e3(0xd1)]),console['log'](_0x1e70e3(0x12f)+(_0x6c6009[_0x1e70e3(0x94)]?_0x1e70e3(0x8d):_0x1e70e3(0x177))+_0x1e70e3(0x141)+(_0x4941d3[_0x1e70e3(0x94)]?_0x1e70e3(0x8d):'not\x20set')),_0x4941d3;}async[a35_0x71f5f0(0x17a)](_0x4ce139){const _0x25acec=a35_0x71f5f0,_0x49d0b1=new Date();let _0x20eccc;switch(_0x4ce139){case'7d':_0x20eccc=new Date(_0x49d0b1[_0x25acec(0x18e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x20eccc=new Date(_0x49d0b1[_0x25acec(0x18e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x25acec(0xce):_0x20eccc=new Date(_0x49d0b1['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x20eccc=new Date(_0x49d0b1[_0x25acec(0x18e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3e1dd6,_0x305e86,_0x5c987b,_0x2ed273,_0x11bd14,_0x313b97,_0x5264f1]=await Promise['all']([database_1[_0x25acec(0x151)][_0x25acec(0x126)][_0x25acec(0x190)](),database_1['default'][_0x25acec(0x126)][_0x25acec(0x190)]({'where':{'status':_0x25acec(0x90)}}),database_1[_0x25acec(0x151)][_0x25acec(0x139)][_0x25acec(0x190)]({'where':{'createdAt':{'gte':_0x20eccc},'gateway':{'not':_0x25acec(0x101)}}}),database_1[_0x25acec(0x151)][_0x25acec(0x139)][_0x25acec(0x190)]({'where':{'status':_0x25acec(0x175),'createdAt':{'gte':_0x20eccc},'gateway':{'not':_0x25acec(0x101)}}}),database_1[_0x25acec(0x151)][_0x25acec(0x139)][_0x25acec(0xbf)]({'where':{'status':_0x25acec(0x175),'createdAt':{'gte':_0x20eccc},'gateway':{'not':_0x25acec(0x101)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x25acec(0x151)][_0x25acec(0x139)][_0x25acec(0xbf)]({'where':{'gateway':{'not':_0x25acec(0x101)}},'take':0xa,'orderBy':{'createdAt':_0x25acec(0xb6)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x25acec(0x151)][_0x25acec(0x139)][_0x25acec(0xbf)]({'where':{'createdAt':{'gte':_0x20eccc},'gateway':{'not':_0x25acec(0x101)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x24a445=0x0;for(const _0x2fe3df of _0x11bd14){if(_0x2fe3df[_0x25acec(0x15d)])_0x24a445+=_0x2fe3df[_0x25acec(0x15d)];else{const _0x8aac95=await currencyService_1['currencyService'][_0x25acec(0x157)](_0x2fe3df[_0x25acec(0x91)],_0x2fe3df['currency']);_0x24a445+=_0x8aac95;}}console['log'](_0x25acec(0x103)+_0x5264f1[_0x25acec(0xa7)]+_0x25acec(0xa9)),console[_0x25acec(0x133)](_0x25acec(0x180)+_0x20eccc[_0x25acec(0x187)]()[_0x25acec(0x10e)]('T')[0x0]+'\x20to\x20'+_0x49d0b1[_0x25acec(0x187)]()[_0x25acec(0x10e)]('T')[0x0]);const _0xfcf7bd=_0x5264f1[_0x25acec(0xa3)]((_0x29f303,_0x245af6)=>{const _0x14100f=_0x25acec;return _0x29f303[_0x245af6[_0x14100f(0x8c)]]=(_0x29f303[_0x245af6[_0x14100f(0x8c)]]||0x0)+0x1,_0x29f303;},{});console[_0x25acec(0x133)]('📊\x20[ADMIN]\x20Status\x20breakdown:',_0xfcf7bd);const _0x4ec7d1=await this[_0x25acec(0x15c)](_0x5264f1,_0x20eccc,_0x49d0b1),_0xae5a72=_0x5c987b>0x0?_0x2ed273/_0x5c987b*0x64:0x0;return{'totalShops':_0x3e1dd6,'activeShops':_0x305e86,'totalPayments':_0x5c987b,'successfulPayments':_0x2ed273,'totalRevenue':Math['round'](_0x24a445*0x64)/0x64,'conversionRate':Math[_0x25acec(0x9e)](_0xae5a72*0x64)/0x64,'dailyRevenue':_0x4ec7d1['dailyRevenue'],'dailyPayments':_0x4ec7d1[_0x25acec(0x127)],'recentPayments':_0x313b97[_0x25acec(0x12a)](_0x265613=>({'id':_0x265613['id'],'amount':_0x265613[_0x25acec(0x91)],'currency':_0x265613[_0x25acec(0xf4)],'status':_0x265613[_0x25acec(0x8c)],'gateway':_0x265613[_0x25acec(0xfa)],'shop':_0x265613[_0x25acec(0x126)],'createdAt':_0x265613[_0x25acec(0xdb)]}))};}async['generateDailyStatistics'](_0x4682ad,_0x36ce8d,_0x4458f6){const _0x2b0d27=a35_0x71f5f0,_0xb35893=new Map(),_0x1c3706=new Date(_0x36ce8d);while(_0x1c3706<=_0x4458f6){const _0xcc5f18=_0x1c3706[_0x2b0d27(0x187)]()[_0x2b0d27(0x10e)]('T')[0x0];_0xb35893[_0x2b0d27(0x8d)](_0xcc5f18,{'revenue':0x0,'count':0x0}),_0x1c3706[_0x2b0d27(0x154)](_0x1c3706[_0x2b0d27(0x17e)]()+0x1);}let _0x452171=0x0,_0x24d13e=0x0;for(const _0x478321 of _0x4682ad){const _0x418f87=_0x478321[_0x2b0d27(0xdb)][_0x2b0d27(0x187)]()[_0x2b0d27(0x10e)]('T')[0x0],_0x3108e4=_0xb35893[_0x2b0d27(0xa5)](_0x418f87);if(_0x3108e4){_0x3108e4[_0x2b0d27(0x190)]+=0x1;if(_0x478321[_0x2b0d27(0x8c)]==='PAID'){_0x452171++;if(_0x478321['amountUSDT'])_0x3108e4[_0x2b0d27(0x9d)]+=_0x478321[_0x2b0d27(0x15d)],_0x24d13e+=_0x478321['amountUSDT'],console[_0x2b0d27(0x133)](_0x2b0d27(0xb1)+_0x478321[_0x2b0d27(0x15d)]+_0x2b0d27(0x10d)+_0x418f87+_0x2b0d27(0xd4));else try{const _0x3b642b=await currencyService_1[_0x2b0d27(0x150)][_0x2b0d27(0x157)](_0x478321[_0x2b0d27(0x91)],_0x478321[_0x2b0d27(0xf4)]);_0x3108e4[_0x2b0d27(0x9d)]+=_0x3b642b,_0x24d13e+=_0x3b642b,console[_0x2b0d27(0x133)](_0x2b0d27(0x9b)+_0x478321['amount']+'\x20'+_0x478321[_0x2b0d27(0xf4)]+'\x20to\x20'+_0x3b642b+_0x2b0d27(0x18b)+_0x418f87);}catch(_0x2a7232){console[_0x2b0d27(0x11e)]('⚠️\x20[DAILY]\x20Failed\x20to\x20convert\x20'+_0x478321[_0x2b0d27(0x91)]+'\x20'+_0x478321['currency']+'\x20for\x20payment\x20on\x20'+_0x418f87+':',_0x2a7232);}}}}console[_0x2b0d27(0x133)](_0x2b0d27(0x193)+_0x452171+_0x2b0d27(0x162)+_0x4682ad['length']+'\x20total'),console[_0x2b0d27(0x133)](_0x2b0d27(0x184)+_0x24d13e+_0x2b0d27(0xa8));const _0x6c17d6=[],_0x19d682=[];for(const [_0x2fa7db,_0x3ef0f9]of _0xb35893){_0x6c17d6[_0x2b0d27(0x173)]({'date':_0x2fa7db,'amount':Math[_0x2b0d27(0x9e)](_0x3ef0f9['revenue']*0x64)/0x64}),_0x19d682[_0x2b0d27(0x173)]({'date':_0x2fa7db,'count':_0x3ef0f9[_0x2b0d27(0x190)]});}return{'dailyRevenue':_0x6c17d6,'dailyPayments':_0x19d682};}async['getMerchantStatistics'](_0x9b015e){const _0x587fa8=a35_0x71f5f0;console[_0x587fa8(0x133)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x9b015e);let _0x4bd880,_0x16feb3=new Date();if(_0x9b015e['period']===_0x587fa8(0x143)&&_0x9b015e[_0x587fa8(0xf2)]&&_0x9b015e[_0x587fa8(0xca)])_0x4bd880=new Date(_0x9b015e['dateFrom']),_0x16feb3=new Date(_0x9b015e['dateTo']);else{const _0x291f5b=new Date();switch(_0x9b015e[_0x587fa8(0xaa)]){case'week':_0x4bd880=new Date(_0x291f5b[_0x587fa8(0x18e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x587fa8(0x161):_0x4bd880=new Date(_0x291f5b[_0x587fa8(0x18e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x587fa8(0xad):_0x4bd880=new Date(_0x291f5b[_0x587fa8(0x18e)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x587fa8(0xfd):default:_0x4bd880=new Date(_0x587fa8(0xbd));break;}}console[_0x587fa8(0x133)]('📅\x20Period:\x20'+_0x4bd880[_0x587fa8(0x187)]()+'\x20to\x20'+_0x16feb3[_0x587fa8(0x187)]());if(_0x9b015e['shopId']){const _0xf118db=await database_1[_0x587fa8(0x151)][_0x587fa8(0x126)]['findUnique']({'where':{'id':_0x9b015e['shopId']},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console[_0x587fa8(0x133)]('📊\x20Shop\x20info\x20for\x20'+_0x9b015e[_0x587fa8(0x11c)]+':'),console[_0x587fa8(0x133)]('\x20\x20\x20Name:\x20'+_0xf118db?.['name']),console[_0x587fa8(0x133)]('\x20\x20\x20Username:\x20'+_0xf118db?.[_0x587fa8(0x138)]),console[_0x587fa8(0x133)](_0x587fa8(0x172)+(_0xf118db?.[_0x587fa8(0x146)]||_0x587fa8(0x102)));if(_0xf118db?.[_0x587fa8(0x146)])try{const _0x750039=JSON[_0x587fa8(0x17f)](_0xf118db[_0x587fa8(0x146)]);console['log'](_0x587fa8(0xe5),_0x750039),console[_0x587fa8(0x133)]('\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20'+(_0x750039['commission']||_0x587fa8(0x13a)));}catch(_0x36dfaf){console[_0x587fa8(0x133)](_0x587fa8(0x16c)+_0x36dfaf);}}const _0x2765da={'status':_0x587fa8(0x175),'gateway':{'not':_0x587fa8(0x101)},'paidAt':{'gte':_0x4bd880,'lte':_0x16feb3}};_0x9b015e[_0x587fa8(0x11c)]&&(_0x2765da['shopId']=_0x9b015e['shopId']);const _0x94fe22=await database_1[_0x587fa8(0x151)][_0x587fa8(0x139)][_0x587fa8(0xbf)]({'where':_0x2765da,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x587fa8(0x133)](_0x587fa8(0x14c)+_0x94fe22[_0x587fa8(0xa7)]+_0x587fa8(0x192));const _0x26c4de={'gateway':{'not':_0x587fa8(0x101)},'createdAt':{'gte':_0x4bd880,'lte':_0x16feb3}};_0x9b015e[_0x587fa8(0x11c)]&&(_0x26c4de['shopId']=_0x9b015e[_0x587fa8(0x11c)]);const _0x121fd5=await database_1[_0x587fa8(0x151)]['payment'][_0x587fa8(0x190)]({'where':_0x26c4de});console['log'](_0x587fa8(0x14e)+_0x121fd5),console[_0x587fa8(0x133)](_0x587fa8(0x15e)+_0x94fe22[_0x587fa8(0xa7)]);let _0x3024f1=0x0,_0x3e21ae=0x0,_0x1e8cf9=0x0;const _0x4a70c8={},_0x454617={},_0x1d86d5={};for(const _0x355aa1 of _0x94fe22){try{const _0x36e554=await currencyService_1[_0x587fa8(0x150)]['convertToUSDT'](_0x355aa1[_0x587fa8(0x91)],_0x355aa1[_0x587fa8(0xf4)]);let _0x7e8acd={};if(_0x355aa1[_0x587fa8(0x126)][_0x587fa8(0x146)])try{_0x7e8acd=JSON[_0x587fa8(0x17f)](_0x355aa1['shop'][_0x587fa8(0x146)]);}catch(_0x2ce4c8){console[_0x587fa8(0x160)](_0x587fa8(0xb4)+_0x355aa1[_0x587fa8(0x11c)]+':',_0x2ce4c8);}let _0x581b77=0xa;const _0x11581e=Object[_0x587fa8(0xc8)](_0x7e8acd)[_0x587fa8(0x18d)](_0x343844=>_0x343844[_0x587fa8(0x169)]()===_0x355aa1[_0x587fa8(0xfa)]['toLowerCase']());_0x11581e&&_0x7e8acd[_0x11581e]&&_0x7e8acd[_0x11581e][_0x587fa8(0xf0)]&&(_0x581b77=_0x7e8acd[_0x11581e][_0x587fa8(0xf0)]);console[_0x587fa8(0x133)](_0x587fa8(0x137)+_0x355aa1['id']+_0x587fa8(0x11a)),console[_0x587fa8(0x133)](_0x587fa8(0xe6)+_0x355aa1[_0x587fa8(0x126)][_0x587fa8(0xd2)]+'\x20('+_0x355aa1[_0x587fa8(0x11c)]+')'),console['log']('\x20\x20\x20Gateway:\x20'+_0x355aa1['gateway']),console[_0x587fa8(0x133)](_0x587fa8(0x172)+(_0x355aa1[_0x587fa8(0x126)][_0x587fa8(0x146)]||_0x587fa8(0x102))),console['log']('\x20\x20\x20Parsed\x20gatewaySettings:',_0x7e8acd),console['log']('\x20\x20\x20Gateway\x20key\x20found:\x20'+(_0x11581e||'not\x20found')),console['log'](_0x587fa8(0xe7)+(_0x11581e&&_0x7e8acd[_0x11581e]?_0x7e8acd[_0x11581e][_0x587fa8(0xf0)]:_0x587fa8(0x13a))),console[_0x587fa8(0x133)](_0x587fa8(0xc6)+_0x581b77+'%');const _0x434f1d=_0x36e554*(_0x581b77/0x64),_0x1dda27=_0x36e554-_0x434f1d;_0x3024f1+=_0x36e554,_0x3e21ae+=_0x1dda27,_0x1e8cf9+=_0x434f1d;!_0x4a70c8[_0x355aa1[_0x587fa8(0xfa)]]&&(_0x4a70c8[_0x355aa1[_0x587fa8(0xfa)]]={'gateway':_0x355aa1[_0x587fa8(0xfa)],'gatewayDisplayName':this[_0x587fa8(0xd7)](_0x355aa1[_0x587fa8(0xfa)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4a70c8[_0x355aa1[_0x587fa8(0xfa)]][_0x587fa8(0xb9)]++,_0x4a70c8[_0x355aa1[_0x587fa8(0xfa)]][_0x587fa8(0x104)]+=_0x36e554,_0x4a70c8[_0x355aa1['gateway']]['commissionUSDT']+=_0x434f1d,_0x4a70c8[_0x355aa1[_0x587fa8(0xfa)]]['merchantEarningsUSDT']+=_0x1dda27,_0x4a70c8[_0x355aa1['gateway']][_0x587fa8(0x16b)]+=_0x581b77;!_0x9b015e['shopId']&&(!_0x454617[_0x355aa1[_0x587fa8(0x11c)]]&&(_0x454617[_0x355aa1[_0x587fa8(0x11c)]]={'shopId':_0x355aa1[_0x587fa8(0x11c)],'shopName':_0x355aa1[_0x587fa8(0x126)][_0x587fa8(0xd2)],'shopUsername':_0x355aa1['shop'][_0x587fa8(0x138)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x454617[_0x355aa1[_0x587fa8(0x11c)]][_0x587fa8(0xb9)]++,_0x454617[_0x355aa1['shopId']]['turnoverUSDT']+=_0x36e554,_0x454617[_0x355aa1['shopId']][_0x587fa8(0x8f)]+=_0x434f1d,_0x454617[_0x355aa1['shopId']][_0x587fa8(0x178)]+=_0x1dda27);const _0x5554ae=_0x355aa1[_0x587fa8(0xd6)]['toISOString']()[_0x587fa8(0x10e)]('T')[0x0];!_0x1d86d5[_0x5554ae]&&(_0x1d86d5[_0x5554ae]={'date':_0x5554ae,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1d86d5[_0x5554ae][_0x587fa8(0x140)]+=_0x36e554,_0x1d86d5[_0x5554ae][_0x587fa8(0x17b)]+=_0x1dda27,_0x1d86d5[_0x5554ae][_0x587fa8(0x96)]+=_0x434f1d,_0x1d86d5[_0x5554ae][_0x587fa8(0xb9)]++;}catch(_0x54189d){console[_0x587fa8(0x160)](_0x587fa8(0xee)+_0x355aa1['id']+':',_0x54189d);}}Object[_0x587fa8(0xc2)](_0x4a70c8)['forEach'](_0x15f880=>{const _0x334838=_0x587fa8;_0x15f880[_0x334838(0x15a)]=_0x15f880[_0x334838(0xb9)]>0x0?_0x15f880[_0x334838(0x16b)]/_0x15f880[_0x334838(0xb9)]:0x0,delete _0x15f880['totalCommissionRate'];}),Object[_0x587fa8(0xc2)](_0x454617)[_0x587fa8(0x128)](_0x9da32c=>{const _0x4c7e79=_0x587fa8;_0x9da32c[_0x4c7e79(0x15b)]=_0x9da32c['paymentsCount']>0x0?_0x9da32c[_0x4c7e79(0x104)]/_0x9da32c['paymentsCount']:0x0;});let _0x2a0d20=0x0;if(_0x9b015e[_0x587fa8(0x11c)]){const _0x20ae7e=await database_1[_0x587fa8(0x151)][_0x587fa8(0x15f)][_0x587fa8(0xbf)]({'where':{'shopId':_0x9b015e['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x4bd880,'lte':_0x16feb3}},'select':{'amount':!![]}});_0x2a0d20=_0x20ae7e['reduce']((_0x57a9bc,_0x52795a)=>_0x57a9bc+_0x52795a[_0x587fa8(0x91)],0x0);}const _0x11808e=_0x121fd5,_0x463175=_0x94fe22[_0x587fa8(0xa7)],_0x3047af=_0x463175>0x0?_0x3024f1/_0x463175:0x0,_0x54fcd4=_0x11808e>0x0?_0x463175/_0x11808e*0x64:0x0;console['log'](_0x587fa8(0x117)),console[_0x587fa8(0x133)](_0x587fa8(0xf7)+_0x11808e),console[_0x587fa8(0x133)]('\x20\x20\x20Successful\x20payments:\x20'+_0x463175),console['log'](_0x587fa8(0x125)+_0x54fcd4[_0x587fa8(0xf3)](0x2)+'%');const _0x412324=Math[_0x587fa8(0x13b)]((_0x16feb3[_0x587fa8(0x18e)]()-_0x4bd880[_0x587fa8(0x18e)]())/(0x3e8*0x3c*0x3c*0x18)),_0x39f380={'totalTurnover':Math[_0x587fa8(0x9e)](_0x3024f1*0x64)/0x64,'merchantEarnings':Math[_0x587fa8(0x9e)](_0x3e21ae*0x64)/0x64,'gatewayEarnings':Math[_0x587fa8(0x9e)](_0x1e8cf9*0x64)/0x64,'totalPaidOut':Math[_0x587fa8(0x9e)](_0x2a0d20*0x64)/0x64,'averageCheck':Math[_0x587fa8(0x9e)](_0x3047af*0x64)/0x64,'totalPayments':_0x11808e,'successfulPayments':_0x463175,'conversionRate':Math[_0x587fa8(0x9e)](_0x54fcd4*0x64)/0x64,'gatewayBreakdown':Object[_0x587fa8(0xc2)](_0x4a70c8)[_0x587fa8(0x12a)](_0x2d6159=>({..._0x2d6159,'turnoverUSDT':Math[_0x587fa8(0x9e)](_0x2d6159[_0x587fa8(0x104)]*0x64)/0x64,'commissionUSDT':Math[_0x587fa8(0x9e)](_0x2d6159['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x587fa8(0x9e)](_0x2d6159['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x587fa8(0x9e)](_0x2d6159[_0x587fa8(0x15a)]*0x64)/0x64})),'merchantBreakdown':_0x9b015e[_0x587fa8(0x11c)]?undefined:Object[_0x587fa8(0xc2)](_0x454617)[_0x587fa8(0x12a)](_0xb947de=>({..._0xb947de,'turnoverUSDT':Math[_0x587fa8(0x9e)](_0xb947de[_0x587fa8(0x104)]*0x64)/0x64,'commissionUSDT':Math[_0x587fa8(0x9e)](_0xb947de['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x587fa8(0x9e)](_0xb947de[_0x587fa8(0x178)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0xb947de[_0x587fa8(0xff)]*0x64)/0x64,'averageCheckUSDT':Math[_0x587fa8(0x9e)](_0xb947de[_0x587fa8(0x15b)]*0x64)/0x64})),'dailyData':Object[_0x587fa8(0xc2)](_0x1d86d5)[_0x587fa8(0x12a)](_0x1977ca=>({..._0x1977ca,'turnover':Math[_0x587fa8(0x9e)](_0x1977ca['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x587fa8(0x9e)](_0x1977ca[_0x587fa8(0x17b)]*0x64)/0x64,'gatewayEarnings':Math[_0x587fa8(0x9e)](_0x1977ca[_0x587fa8(0x96)]*0x64)/0x64}))[_0x587fa8(0xb5)]((_0x2b1d26,_0x106781)=>_0x2b1d26['date'][_0x587fa8(0xd3)](_0x106781[_0x587fa8(0x185)])),'periodInfo':{'from':_0x4bd880,'to':_0x16feb3,'periodType':_0x9b015e['period']||_0x587fa8(0x143),'daysCount':_0x412324}};return console[_0x587fa8(0x133)](_0x587fa8(0x123)),console[_0x587fa8(0x133)](_0x587fa8(0x115)+_0x39f380[_0x587fa8(0x98)]+_0x587fa8(0xa8)),console[_0x587fa8(0x133)](_0x587fa8(0x135)+_0x39f380[_0x587fa8(0x17b)]+_0x587fa8(0xa8)),console[_0x587fa8(0x133)](_0x587fa8(0x122)+_0x39f380['gatewayEarnings']+'\x20USDT'),console[_0x587fa8(0x133)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x39f380[_0x587fa8(0x183)]),console[_0x587fa8(0x133)](_0x587fa8(0x147)+_0x39f380[_0x587fa8(0x168)]),console[_0x587fa8(0x133)](_0x587fa8(0x18f)+_0x39f380[_0x587fa8(0x17c)]+'%'),_0x39f380;}[a35_0x71f5f0(0xd7)](_0x100311){const _0x1e686d=a35_0x71f5f0,_0x240e59={'test_gateway':_0x1e686d(0x182),'plisio':'Plisio','rapyd':'Rapyd','noda':_0x1e686d(0x106),'cointopay':_0x1e686d(0xeb),'mastercard':'Amer\x20Master','klyme_eu':_0x1e686d(0x142),'klyme_gb':_0x1e686d(0x195),'klyme_de':_0x1e686d(0x130)};return _0x240e59[_0x100311]||_0x100311;}async['getMerchantsAwaitingPayout'](_0x37f7e9){const _0x724098=a35_0x71f5f0,{page:_0x1375a5,limit:_0x344a98,minAmount:_0x20f30a,search:_0x5e7fe4}=_0x37f7e9,_0x151434=(_0x1375a5-0x1)*_0x344a98;console[_0x724098(0x133)](_0x724098(0xb0),_0x37f7e9);const _0x34283a={'balance':{'gt':0x0},'status':_0x724098(0x90)};_0x20f30a&&(_0x34283a[_0x724098(0xfe)]['gte']=_0x20f30a);_0x5e7fe4&&(_0x34283a['OR']=[{'name':{'contains':_0x5e7fe4,'mode':_0x724098(0x197)}},{'username':{'contains':_0x5e7fe4,'mode':_0x724098(0x197)}}]);const [_0xadc206,_0x58143a]=await Promise[_0x724098(0xfd)]([database_1[_0x724098(0x151)][_0x724098(0x126)][_0x724098(0xbf)]({'where':_0x34283a,'skip':_0x151434,'take':_0x344a98,'orderBy':{'balance':_0x724098(0xb6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x724098(0x151)][_0x724098(0x126)][_0x724098(0x190)]({'where':_0x34283a})]);console[_0x724098(0x133)](_0x724098(0x14c)+_0xadc206[_0x724098(0xa7)]+'\x20merchants\x20with\x20positive\x20balance');const _0x381563=await Promise['all'](_0xadc206[_0x724098(0x12a)](async _0x25fc64=>{const _0x3a96cb=_0x724098,[_0x6caf4b,_0x6192,_0x2813d6]=await Promise[_0x3a96cb(0xfd)]([database_1['default']['payment'][_0x3a96cb(0x190)]({'where':{'shopId':_0x25fc64['id'],'status':_0x3a96cb(0x175),'amountUSDT':{'not':null}}}),database_1[_0x3a96cb(0x151)][_0x3a96cb(0x139)][_0x3a96cb(0x153)]({'where':{'shopId':_0x25fc64['id'],'status':_0x3a96cb(0x175),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x3a96cb(0xd9)},'select':{'paidAt':!![]}}),database_1[_0x3a96cb(0x151)]['payment'][_0x3a96cb(0x144)]({'by':[_0x3a96cb(0xfa)],'where':{'shopId':_0x25fc64['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x1e4a06=_0x2813d6[_0x3a96cb(0x12a)](_0x3dd759=>({'gateway':_0x3dd759['gateway'],'count':_0x3dd759[_0x3a96cb(0x8e)]['id'],'amountUSDT':_0x3dd759[_0x3a96cb(0xdf)][_0x3a96cb(0x15d)]||0x0,'amountAfterCommissionUSDT':_0x3dd759[_0x3a96cb(0xdf)][_0x3a96cb(0x15d)]||0x0,'commission':0x0}));return{'id':_0x25fc64['id'],'fullName':_0x25fc64[_0x3a96cb(0xd2)],'username':_0x25fc64[_0x3a96cb(0x138)],'telegramId':_0x25fc64[_0x3a96cb(0x11b)],'merchantUrl':_0x25fc64['shopUrl'],'wallets':{'usdtPolygonWallet':_0x25fc64[_0x3a96cb(0x148)],'usdtTrcWallet':_0x25fc64[_0x3a96cb(0x164)],'usdtErcWallet':_0x25fc64[_0x3a96cb(0x167)],'usdcPolygonWallet':_0x25fc64[_0x3a96cb(0xc0)]},'totalAmountUSDT':_0x25fc64[_0x3a96cb(0xfe)],'totalAmountAfterCommissionUSDT':_0x25fc64['balance'],'paymentsCount':_0x6caf4b,'oldestPaymentDate':_0x6192?.[_0x3a96cb(0xd6)]||_0x25fc64[_0x3a96cb(0xdb)],'gatewayBreakdown':_0x1e4a06};})),_0x25655d=_0xadc206[_0x724098(0xa3)]((_0x3f584b,_0x1b7d86)=>_0x3f584b+_0x1b7d86[_0x724098(0xfe)],0x0),_0x4c2506=_0x25655d;return console[_0x724098(0x133)](_0x724098(0xfc)+_0x58143a+_0x724098(0x156)+Math['round'](_0x4c2506*0x64)/0x64+_0x724098(0xf1)),{'merchants':_0x381563,'pagination':{'page':_0x1375a5,'limit':_0x344a98,'total':_0x58143a,'totalPages':Math['ceil'](_0x58143a/_0x344a98)},'summary':{'totalMerchants':_0x58143a,'totalAmountUSDT':Math[_0x724098(0x9e)](_0x25655d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x724098(0x9e)](_0x4c2506*0x64)/0x64}};}async[a35_0x71f5f0(0xd0)](_0x120734){const _0x1c041d=a35_0x71f5f0,{shopId:_0x4cc7e7,amount:_0x49a5bd,network:_0x4af5b2,notes:_0x3aa661,periodFrom:_0x3739f6,periodTo:_0x2ee678}=_0x120734,_0x444b3e=await database_1[_0x1c041d(0x151)]['$transaction'](async _0x3f7da8=>{const _0x36a9f3=_0x1c041d,_0x55c3fa=await _0x3f7da8[_0x36a9f3(0x126)][_0x36a9f3(0xd5)]({'where':{'id':_0x4cc7e7},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x55c3fa)throw new Error(_0x36a9f3(0xb7));console[_0x36a9f3(0x133)](_0x36a9f3(0x10f)+_0x55c3fa[_0x36a9f3(0x138)]+':'),console[_0x36a9f3(0x133)](_0x36a9f3(0x113)+_0x55c3fa[_0x36a9f3(0xfe)][_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0xa8)),console[_0x36a9f3(0x133)](_0x36a9f3(0x13f)+_0x49a5bd[_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0xa8)),console[_0x36a9f3(0x133)](_0x36a9f3(0x12b)+_0x55c3fa['totalPaidOut'][_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0xa8));if(_0x55c3fa['balance']<_0x49a5bd)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x55c3fa[_0x36a9f3(0xfe)][_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0x108)+_0x49a5bd[_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0xa8));const _0x4e2a7f=await _0x3f7da8[_0x36a9f3(0x15f)][_0x36a9f3(0x16d)]({'data':{'shopId':_0x4cc7e7,'amount':_0x49a5bd,'network':_0x4af5b2,'status':_0x36a9f3(0x17d),'notes':_0x3aa661,'periodFrom':_0x3739f6?new Date(_0x3739f6):null,'periodTo':_0x2ee678?new Date(_0x2ee678):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3ed073=_0x55c3fa[_0x36a9f3(0xfe)]-_0x49a5bd,_0x3df0ab=_0x55c3fa[_0x36a9f3(0xbc)]+_0x49a5bd;return await _0x3f7da8[_0x36a9f3(0x126)][_0x36a9f3(0x9c)]({'where':{'id':_0x4cc7e7},'data':{'balance':_0x3ed073,'totalPaidOut':_0x3df0ab}}),console[_0x36a9f3(0x133)](_0x36a9f3(0x171)+_0x55c3fa[_0x36a9f3(0x138)]+'\x20balance\x20updated:'),console[_0x36a9f3(0x133)]('\x20\x20\x20Balance:\x20'+_0x55c3fa[_0x36a9f3(0xfe)][_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0x141)+_0x3ed073[_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0xab)+_0x49a5bd[_0x36a9f3(0xf3)](0x6)+')'),console['log'](_0x36a9f3(0xd8)+_0x55c3fa[_0x36a9f3(0xbc)][_0x36a9f3(0xf3)](0x6)+_0x36a9f3(0x141)+_0x3df0ab['toFixed'](0x6)+_0x36a9f3(0xed)+_0x49a5bd[_0x36a9f3(0xf3)](0x6)+')'),{'payout':_0x4e2a7f,'shop':_0x55c3fa};});return console[_0x1c041d(0x133)](_0x1c041d(0xcc)+_0x444b3e[_0x1c041d(0x15f)]['id']+_0x1c041d(0x118)+_0x444b3e[_0x1c041d(0x126)][_0x1c041d(0x138)]+'\x20('+_0x49a5bd+_0x1c041d(0x16a)),{'id':_0x444b3e[_0x1c041d(0x15f)]['id'],'shopId':_0x444b3e[_0x1c041d(0x15f)][_0x1c041d(0x11c)],'shopName':_0x444b3e[_0x1c041d(0x126)]['name'],'shopUsername':_0x444b3e[_0x1c041d(0x126)][_0x1c041d(0x138)],'amount':_0x444b3e[_0x1c041d(0x15f)]['amount'],'network':_0x444b3e[_0x1c041d(0x15f)][_0x1c041d(0xb2)],'status':_0x444b3e[_0x1c041d(0x15f)]['status'],'txid':_0x444b3e[_0x1c041d(0x15f)][_0x1c041d(0xe0)],'notes':_0x444b3e['payout'][_0x1c041d(0xc3)],'periodFrom':_0x444b3e[_0x1c041d(0x15f)][_0x1c041d(0x16e)],'periodTo':_0x444b3e[_0x1c041d(0x15f)][_0x1c041d(0xa2)],'createdAt':_0x444b3e[_0x1c041d(0x15f)][_0x1c041d(0xdb)],'paidAt':_0x444b3e[_0x1c041d(0x15f)][_0x1c041d(0xd6)]};}async['getAllPayouts'](_0x1856e3){const _0x44b350=a35_0x71f5f0,{page:_0x5a6721,limit:_0x33826c,shopId:_0x4f0caf,network:_0x372693,dateFrom:_0x495710,dateTo:_0x5a4bf4,search:_0x2a4059}=_0x1856e3,_0x16132e=(_0x5a6721-0x1)*_0x33826c,_0x86738c={};_0x4f0caf&&(_0x86738c[_0x44b350(0x11c)]=_0x4f0caf);_0x372693&&(_0x86738c[_0x44b350(0xb2)]=_0x372693);(_0x495710||_0x5a4bf4)&&(_0x86738c[_0x44b350(0xdb)]={},_0x495710&&(_0x86738c['createdAt'][_0x44b350(0x13e)]=new Date(_0x495710)),_0x5a4bf4&&(_0x86738c[_0x44b350(0xdb)][_0x44b350(0x120)]=new Date(_0x5a4bf4)));_0x2a4059&&(_0x86738c['OR']=[{'shop':{'name':{'contains':_0x2a4059,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x2a4059,'mode':_0x44b350(0x197)}}},{'notes':{'contains':_0x2a4059,'mode':_0x44b350(0x197)}}]);const [_0x4fd961,_0x11bbab]=await Promise[_0x44b350(0xfd)]([database_1['default'][_0x44b350(0x15f)]['findMany']({'where':_0x86738c,'skip':_0x16132e,'take':_0x33826c,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x44b350(0x151)]['payout'][_0x44b350(0x190)]({'where':_0x86738c})]);return{'payouts':_0x4fd961[_0x44b350(0x12a)](_0x1be8a2=>({'id':_0x1be8a2['id'],'shopId':_0x1be8a2['shopId'],'shopName':_0x1be8a2[_0x44b350(0x126)]['name'],'shopUsername':_0x1be8a2['shop'][_0x44b350(0x138)],'amount':_0x1be8a2[_0x44b350(0x91)],'network':_0x1be8a2['network'],'status':_0x1be8a2[_0x44b350(0x8c)],'txid':_0x1be8a2[_0x44b350(0xe0)],'notes':_0x1be8a2['notes'],'periodFrom':_0x1be8a2[_0x44b350(0x16e)],'periodTo':_0x1be8a2['periodTo'],'createdAt':_0x1be8a2[_0x44b350(0xdb)],'paidAt':_0x1be8a2[_0x44b350(0xd6)]})),'pagination':{'page':_0x5a6721,'limit':_0x33826c,'total':_0x11bbab,'totalPages':Math['ceil'](_0x11bbab/_0x33826c)}};}async[a35_0x71f5f0(0x145)](_0x5bc050){const _0x473f1f=a35_0x71f5f0,_0xe75ede=await database_1[_0x473f1f(0x151)]['payout'][_0x473f1f(0xd5)]({'where':{'id':_0x5bc050},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xe75ede)return null;return{'id':_0xe75ede['id'],'shopId':_0xe75ede[_0x473f1f(0x11c)],'shopName':_0xe75ede['shop'][_0x473f1f(0xd2)],'shopUsername':_0xe75ede[_0x473f1f(0x126)]['username'],'amount':_0xe75ede[_0x473f1f(0x91)],'network':_0xe75ede[_0x473f1f(0xb2)],'status':_0xe75ede[_0x473f1f(0x8c)],'txid':_0xe75ede[_0x473f1f(0xe0)],'notes':_0xe75ede[_0x473f1f(0xc3)],'periodFrom':_0xe75ede[_0x473f1f(0x16e)],'periodTo':_0xe75ede['periodTo'],'createdAt':_0xe75ede['createdAt'],'paidAt':_0xe75ede['paidAt']};}async[a35_0x71f5f0(0xe1)](_0x468fc4){const _0x207683=a35_0x71f5f0;await database_1[_0x207683(0x151)][_0x207683(0x15f)][_0x207683(0x149)]({'where':{'id':_0x468fc4}});}async['getAllPayments'](_0x53fb3b){const _0x21d4e0=a35_0x71f5f0,{page:_0x820ff,limit:_0x29f689,status:_0x391840,gateway:_0x114d63,shopId:_0x875e7b,dateFrom:_0x102c08,dateTo:_0x18c5d9,search:_0x4b590}=_0x53fb3b,_0x41a534=(_0x820ff-0x1)*_0x29f689,_0x4070fd={};_0x391840&&(_0x4070fd[_0x21d4e0(0x8c)]=_0x391840[_0x21d4e0(0xf8)]());_0x114d63&&(_0x4070fd[_0x21d4e0(0xfa)]=_0x114d63[_0x21d4e0(0x169)]());_0x4070fd[_0x21d4e0(0xfa)]=_0x4070fd[_0x21d4e0(0xfa)]?_0x4070fd[_0x21d4e0(0xfa)]:{'not':_0x21d4e0(0x101)};if(typeof _0x4070fd[_0x21d4e0(0xfa)]===_0x21d4e0(0x188)&&_0x4070fd['gateway']!=='test_gateway'){}else{if(typeof _0x4070fd[_0x21d4e0(0xfa)]===_0x21d4e0(0x188)&&_0x4070fd[_0x21d4e0(0xfa)]===_0x21d4e0(0x101)){}else _0x4070fd['gateway']={'not':_0x21d4e0(0x101)};}_0x875e7b&&(_0x4070fd[_0x21d4e0(0x11c)]=_0x875e7b);(_0x102c08||_0x18c5d9)&&(_0x4070fd[_0x21d4e0(0xdb)]={},_0x102c08&&(_0x4070fd['createdAt'][_0x21d4e0(0x13e)]=new Date(_0x102c08)),_0x18c5d9&&(_0x4070fd[_0x21d4e0(0xdb)][_0x21d4e0(0x120)]=new Date(_0x18c5d9)));_0x4b590&&(_0x4070fd['OR']=[{'orderId':{'contains':_0x4b590,'mode':_0x21d4e0(0x197)}},{'gatewayOrderId':{'contains':_0x4b590,'mode':'insensitive'}},{'customerEmail':{'contains':_0x4b590,'mode':_0x21d4e0(0x197)}},{'shop':{'name':{'contains':_0x4b590,'mode':_0x21d4e0(0x197)}}},{'shop':{'username':{'contains':_0x4b590,'mode':_0x21d4e0(0x197)}}}]);const [_0x174908,_0x539768]=await Promise['all']([database_1[_0x21d4e0(0x151)][_0x21d4e0(0x139)][_0x21d4e0(0xbf)]({'where':_0x4070fd,'skip':_0x41a534,'take':_0x29f689,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x21d4e0(0x151)][_0x21d4e0(0x139)]['count']({'where':_0x4070fd})]);return{'payments':_0x174908[_0x21d4e0(0x12a)](_0x3f4f83=>({'id':_0x3f4f83['id'],'shopId':_0x3f4f83[_0x21d4e0(0x11c)],'gateway':this[_0x21d4e0(0xd7)](_0x3f4f83['gateway']),'gatewayTechnical':_0x3f4f83['gateway'],'amount':_0x3f4f83[_0x21d4e0(0x91)],'currency':_0x3f4f83['currency'],'status':_0x3f4f83['status'],'orderId':_0x3f4f83[_0x21d4e0(0xdd)],'gatewayOrderId':_0x3f4f83[_0x21d4e0(0xf5)],'customerEmail':_0x3f4f83[_0x21d4e0(0xdc)],'customerName':_0x3f4f83[_0x21d4e0(0xea)],'customerCountry':_0x3f4f83[_0x21d4e0(0x119)],'customerIp':_0x3f4f83[_0x21d4e0(0xd1)],'customerUa':_0x3f4f83[_0x21d4e0(0x94)],'failureMessage':_0x3f4f83['failureMessage'],'cardLast4':_0x3f4f83['cardLast4'],'paymentMethod':_0x3f4f83[_0x21d4e0(0x155)],'bankId':_0x3f4f83['bankId'],'remitterIban':_0x3f4f83[_0x21d4e0(0x9f)],'remitterName':_0x3f4f83[_0x21d4e0(0x95)],'txUrls':_0x3f4f83['txUrls'],'createdAt':_0x3f4f83[_0x21d4e0(0xdb)],'updatedAt':_0x3f4f83[_0x21d4e0(0xcb)],'shop':_0x3f4f83[_0x21d4e0(0x126)]})),'pagination':{'page':_0x820ff,'limit':_0x29f689,'total':_0x539768,'totalPages':Math['ceil'](_0x539768/_0x29f689)}};}async[a35_0x71f5f0(0xfb)](_0x5886b8){const _0x27306d=a35_0x71f5f0,_0x5ea965=await database_1['default'][_0x27306d(0x139)]['findUnique']({'where':{'id':_0x5886b8},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5ea965)return null;return{'id':_0x5ea965['id'],'shopId':_0x5ea965[_0x27306d(0x11c)],'gateway':this[_0x27306d(0xd7)](_0x5ea965[_0x27306d(0xfa)]),'gatewayTechnical':_0x5ea965['gateway'],'amount':_0x5ea965['amount'],'currency':_0x5ea965[_0x27306d(0xf4)],'status':_0x5ea965[_0x27306d(0x8c)],'orderId':_0x5ea965['orderId'],'gatewayOrderId':_0x5ea965['gatewayOrderId'],'customerEmail':_0x5ea965[_0x27306d(0xdc)],'customerName':_0x5ea965[_0x27306d(0xea)],'customerCountry':_0x5ea965[_0x27306d(0x119)],'customerIp':_0x5ea965['customerIp'],'customerUa':_0x5ea965[_0x27306d(0x94)],'failureMessage':_0x5ea965['failureMessage'],'externalPaymentUrl':_0x5ea965['externalPaymentUrl'],'successUrl':_0x5ea965['successUrl'],'failUrl':_0x5ea965[_0x27306d(0xe2)],'pendingUrl':_0x5ea965[_0x27306d(0x110)],'whiteUrl':_0x5ea965[_0x27306d(0x12d)],'cardLast4':_0x5ea965[_0x27306d(0x194)],'paymentMethod':_0x5ea965[_0x27306d(0x155)],'bankId':_0x5ea965[_0x27306d(0x163)],'remitterIban':_0x5ea965[_0x27306d(0x9f)],'remitterName':_0x5ea965['remitterName'],'txUrls':_0x5ea965[_0x27306d(0x97)],'createdAt':_0x5ea965['createdAt'],'updatedAt':_0x5ea965[_0x27306d(0xcb)],'shop':_0x5ea965[_0x27306d(0x126)]};}async[a35_0x71f5f0(0x14b)](_0x684270,_0x196564,_0x371e0a,_0x55e97f){const _0x3eb26f=a35_0x71f5f0,_0x3e4114=await database_1['default'][_0x3eb26f(0x99)](async _0x5e61fc=>{const _0x3077f8=_0x3eb26f,_0x45df21=await _0x5e61fc[_0x3077f8(0x139)][_0x3077f8(0xd5)]({'where':{'id':_0x684270},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x45df21)throw new Error(_0x3077f8(0x109));const _0x5d54dd=_0x45df21[_0x3077f8(0x8c)],_0x171183=_0x196564[_0x3077f8(0xf8)]();console[_0x3077f8(0x133)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x684270+_0x3077f8(0xf6)+_0x5d54dd+'\x20->\x20'+_0x171183),console['log'](_0x3077f8(0x179)+_0x45df21[_0x3077f8(0x126)][_0x3077f8(0xfe)]+_0x3077f8(0xa8));const _0x3f9949={'status':_0x171183,'updatedAt':new Date(),'statusChangedBy':_0x3077f8(0xaf),'statusChangedAt':new Date()};_0x371e0a&&(_0x3f9949[_0x3077f8(0x12c)]=_0x371e0a);_0x171183===_0x3077f8(0x114)&&_0x55e97f&&(_0x3f9949[_0x3077f8(0x13c)]=_0x55e97f);let _0x4724a1=0x0,_0x1955c4=_0x45df21[_0x3077f8(0x126)][_0x3077f8(0xfe)];if(_0x171183===_0x3077f8(0x175)&&_0x5d54dd!=='PAID'){_0x3f9949['paidAt']=new Date();const _0x32346c=await currencyService_1[_0x3077f8(0x150)]['convertToUSDT'](_0x45df21[_0x3077f8(0x91)],_0x45df21[_0x3077f8(0xf4)]);_0x3f9949[_0x3077f8(0x15d)]=_0x32346c,_0x4724a1=_0x32346c,_0x1955c4+=_0x32346c,console['log'](_0x3077f8(0x174)+_0x684270+_0x3077f8(0x14a)+_0x32346c[_0x3077f8(0xf3)](0x6)+_0x3077f8(0x92));}else _0x5d54dd===_0x3077f8(0x175)&&_0x171183!=='PAID'&&(_0x45df21[_0x3077f8(0x15d)]&&(_0x4724a1=-_0x45df21[_0x3077f8(0x15d)],_0x1955c4-=_0x45df21[_0x3077f8(0x15d)],_0x3f9949['amountUSDT']=null,console[_0x3077f8(0x133)](_0x3077f8(0x174)+_0x684270+_0x3077f8(0xc7)+_0x45df21[_0x3077f8(0x15d)]['toFixed'](0x6)+_0x3077f8(0xac))));if(_0x171183===_0x3077f8(0x114)){if(_0x5d54dd===_0x3077f8(0x175)&&_0x45df21['amountUSDT']){}_0x55e97f&&_0x55e97f>0x0&&(_0x4724a1-=_0x55e97f,_0x1955c4-=_0x55e97f,console[_0x3077f8(0x133)](_0x3077f8(0x181)+_0x55e97f['toFixed'](0x6)+_0x3077f8(0xac)));}_0x171183===_0x3077f8(0x176)&&_0x5d54dd===_0x3077f8(0x175)&&console[_0x3077f8(0x133)](_0x3077f8(0x158));const _0x28042a=await _0x5e61fc[_0x3077f8(0x139)][_0x3077f8(0x9c)]({'where':{'id':_0x684270},'data':_0x3f9949,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4724a1!==0x0&&(await _0x5e61fc[_0x3077f8(0x126)][_0x3077f8(0x9c)]({'where':{'id':_0x45df21[_0x3077f8(0x11c)]},'data':{'balance':_0x1955c4}}),console[_0x3077f8(0x133)]('💰\x20Shop\x20'+_0x45df21['shopId']+'\x20balance\x20updated:\x20'+_0x45df21[_0x3077f8(0x126)]['balance']['toFixed'](0x6)+_0x3077f8(0x141)+_0x1955c4[_0x3077f8(0xf3)](0x6)+_0x3077f8(0x9a)+(_0x4724a1>0x0?'+':'')+_0x4724a1[_0x3077f8(0xf3)](0x6)+')')),_0x28042a;});return{'id':_0x3e4114['id'],'shopId':_0x3e4114[_0x3eb26f(0x11c)],'gateway':_0x3e4114[_0x3eb26f(0xfa)],'amount':_0x3e4114[_0x3eb26f(0x91)],'currency':_0x3e4114[_0x3eb26f(0xf4)],'status':_0x3e4114[_0x3eb26f(0x8c)],'orderId':_0x3e4114[_0x3eb26f(0xdd)],'gatewayOrderId':_0x3e4114[_0x3eb26f(0xf5)],'customerEmail':_0x3e4114[_0x3eb26f(0xdc)],'customerName':_0x3e4114['customerName'],'customerCountry':_0x3e4114[_0x3eb26f(0x119)],'customerIp':_0x3e4114[_0x3eb26f(0xd1)],'customerUa':_0x3e4114[_0x3eb26f(0x94)],'failureMessage':_0x3e4114[_0x3eb26f(0x189)],'adminNotes':_0x3e4114[_0x3eb26f(0x12c)],'chargebackAmount':_0x3e4114[_0x3eb26f(0x13c)],'statusChangedBy':_0x3e4114[_0x3eb26f(0xe8)],'statusChangedAt':_0x3e4114[_0x3eb26f(0xc9)],'createdAt':_0x3e4114[_0x3eb26f(0xdb)],'updatedAt':_0x3e4114['updatedAt'],'shop':_0x3e4114[_0x3eb26f(0x126)]};}async[a35_0x71f5f0(0xcd)](_0x3d112a,_0x4a4cf3){const _0x22d25b=a35_0x71f5f0,_0xa61fa7={..._0x4a4cf3};_0x4a4cf3[_0x22d25b(0xf9)]&&(_0xa61fa7[_0x22d25b(0xf9)]=await bcryptjs_1[_0x22d25b(0x151)][_0x22d25b(0x186)](_0x4a4cf3[_0x22d25b(0xf9)],0xc));_0x4a4cf3[_0x22d25b(0x191)]&&(_0xa61fa7[_0x22d25b(0xd2)]=_0x4a4cf3['fullName'],delete _0xa61fa7['fullName']);_0x4a4cf3['telegramId']&&(_0xa61fa7[_0x22d25b(0x11b)]=_0x4a4cf3['telegramId'],delete _0xa61fa7[_0x22d25b(0x10b)]);_0x4a4cf3[_0x22d25b(0x116)]&&(_0xa61fa7[_0x22d25b(0xc4)]=_0x4a4cf3[_0x22d25b(0x116)],delete _0xa61fa7[_0x22d25b(0x116)]);_0x4a4cf3[_0x22d25b(0xda)]&&(_0xa61fa7[_0x22d25b(0xa0)]=JSON[_0x22d25b(0x10c)](_0x4a4cf3[_0x22d25b(0xda)]));_0x4a4cf3[_0x22d25b(0x146)]&&(_0xa61fa7['gatewaySettings']=JSON[_0x22d25b(0x10c)](_0x4a4cf3[_0x22d25b(0x146)]));_0x4a4cf3[_0x22d25b(0x165)]&&(_0x4a4cf3[_0x22d25b(0x165)][_0x22d25b(0x148)]!==undefined&&(_0xa61fa7[_0x22d25b(0x148)]=_0x4a4cf3[_0x22d25b(0x165)][_0x22d25b(0x148)]||null),_0x4a4cf3[_0x22d25b(0x165)]['usdtTrcWallet']!==undefined&&(_0xa61fa7[_0x22d25b(0x164)]=_0x4a4cf3[_0x22d25b(0x165)]['usdtTrcWallet']||null),_0x4a4cf3['wallets'][_0x22d25b(0x167)]!==undefined&&(_0xa61fa7[_0x22d25b(0x167)]=_0x4a4cf3[_0x22d25b(0x165)][_0x22d25b(0x167)]||null),_0x4a4cf3['wallets']['usdcPolygonWallet']!==undefined&&(_0xa61fa7[_0x22d25b(0xc0)]=_0x4a4cf3[_0x22d25b(0x165)][_0x22d25b(0xc0)]||null),delete _0xa61fa7[_0x22d25b(0x165)]);const _0x836242=await database_1[_0x22d25b(0x151)][_0x22d25b(0x126)][_0x22d25b(0x9c)]({'where':{'id':_0x3d112a},'data':_0xa61fa7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x836242['id'],'fullName':_0x836242[_0x22d25b(0xd2)],'username':_0x836242[_0x22d25b(0x138)],'telegramId':_0x836242[_0x22d25b(0x11b)],'merchantUrl':_0x836242['shopUrl'],'gateways':_0x836242['paymentGateways']?JSON['parse'](_0x836242[_0x22d25b(0xa0)]):null,'gatewaySettings':_0x836242[_0x22d25b(0x146)]?JSON['parse'](_0x836242['gatewaySettings']):null,'publicKey':_0x836242[_0x22d25b(0x11f)],'wallets':{'usdtPolygonWallet':_0x836242[_0x22d25b(0x148)],'usdtTrcWallet':_0x836242[_0x22d25b(0x164)],'usdtErcWallet':_0x836242['usdtErcWallet'],'usdcPolygonWallet':_0x836242[_0x22d25b(0xc0)]},'status':_0x836242[_0x22d25b(0x8c)],'createdAt':_0x836242[_0x22d25b(0xdb)]};}async['suspendUser'](_0x10ae51){const _0x5e6a8a=a35_0x71f5f0,_0x2a1cb0=await database_1[_0x5e6a8a(0x151)]['shop'][_0x5e6a8a(0x9c)]({'where':{'id':_0x10ae51},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2a1cb0['id'],'fullName':_0x2a1cb0[_0x5e6a8a(0xd2)],'username':_0x2a1cb0[_0x5e6a8a(0x138)],'telegramId':_0x2a1cb0[_0x5e6a8a(0x11b)],'merchantUrl':_0x2a1cb0['shopUrl'],'gateways':_0x2a1cb0[_0x5e6a8a(0xa0)]?JSON[_0x5e6a8a(0x17f)](_0x2a1cb0[_0x5e6a8a(0xa0)]):null,'gatewaySettings':_0x2a1cb0[_0x5e6a8a(0x146)]?JSON[_0x5e6a8a(0x17f)](_0x2a1cb0['gatewaySettings']):null,'publicKey':_0x2a1cb0[_0x5e6a8a(0x11f)],'wallets':{'usdtPolygonWallet':_0x2a1cb0['usdtPolygonWallet'],'usdtTrcWallet':_0x2a1cb0[_0x5e6a8a(0x164)],'usdtErcWallet':_0x2a1cb0[_0x5e6a8a(0x167)],'usdcPolygonWallet':_0x2a1cb0[_0x5e6a8a(0xc0)]},'status':_0x2a1cb0[_0x5e6a8a(0x8c)],'createdAt':_0x2a1cb0[_0x5e6a8a(0xdb)]};}async[a35_0x71f5f0(0x131)](_0x37e725){const _0x19659f=a35_0x71f5f0,_0x30a9f6=await database_1[_0x19659f(0x151)]['shop'][_0x19659f(0x9c)]({'where':{'id':_0x37e725},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x30a9f6['id'],'fullName':_0x30a9f6[_0x19659f(0xd2)],'username':_0x30a9f6[_0x19659f(0x138)],'telegramId':_0x30a9f6[_0x19659f(0x11b)],'merchantUrl':_0x30a9f6['shopUrl'],'gateways':_0x30a9f6[_0x19659f(0xa0)]?JSON['parse'](_0x30a9f6[_0x19659f(0xa0)]):null,'gatewaySettings':_0x30a9f6[_0x19659f(0x146)]?JSON[_0x19659f(0x17f)](_0x30a9f6['gatewaySettings']):null,'publicKey':_0x30a9f6['publicKey'],'wallets':{'usdtPolygonWallet':_0x30a9f6[_0x19659f(0x148)],'usdtTrcWallet':_0x30a9f6['usdtTrcWallet'],'usdtErcWallet':_0x30a9f6['usdtErcWallet'],'usdcPolygonWallet':_0x30a9f6[_0x19659f(0xc0)]},'status':_0x30a9f6[_0x19659f(0x8c)],'createdAt':_0x30a9f6['createdAt']};}async[a35_0x71f5f0(0x152)](_0x28251){const _0x4b02b3=a35_0x71f5f0,{page:_0x5eeced,limit:_0x11f98d,status:_0x25cbd1}=_0x28251,_0x87accb=(_0x5eeced-0x1)*_0x11f98d,_0x326ebd={};_0x25cbd1&&(_0x326ebd[_0x4b02b3(0x8c)]=_0x25cbd1[_0x4b02b3(0xf8)]());const [_0x5424f9,_0x942fa6]=await Promise[_0x4b02b3(0xfd)]([database_1['default'][_0x4b02b3(0x126)][_0x4b02b3(0xbf)]({'where':_0x326ebd,'skip':_0x87accb,'take':_0x11f98d,'orderBy':{'createdAt':_0x4b02b3(0xb6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4b02b3(0x151)]['shop'][_0x4b02b3(0x190)]({'where':_0x326ebd})]);return{'users':_0x5424f9[_0x4b02b3(0x12a)](_0x3afcb7=>({'id':_0x3afcb7['id'],'fullName':_0x3afcb7[_0x4b02b3(0xd2)],'username':_0x3afcb7[_0x4b02b3(0x138)],'telegramId':_0x3afcb7[_0x4b02b3(0x11b)],'merchantUrl':_0x3afcb7[_0x4b02b3(0xc4)],'gateways':_0x3afcb7[_0x4b02b3(0xa0)]?JSON[_0x4b02b3(0x17f)](_0x3afcb7[_0x4b02b3(0xa0)]):null,'gatewaySettings':_0x3afcb7[_0x4b02b3(0x146)]?JSON[_0x4b02b3(0x17f)](_0x3afcb7['gatewaySettings']):null,'publicKey':_0x3afcb7[_0x4b02b3(0x11f)],'wallets':{'usdtPolygonWallet':_0x3afcb7[_0x4b02b3(0x148)],'usdtTrcWallet':_0x3afcb7[_0x4b02b3(0x164)],'usdtErcWallet':_0x3afcb7[_0x4b02b3(0x167)],'usdcPolygonWallet':_0x3afcb7[_0x4b02b3(0xc0)]},'status':_0x3afcb7[_0x4b02b3(0x8c)],'createdAt':_0x3afcb7[_0x4b02b3(0xdb)]})),'pagination':{'page':_0x5eeced,'limit':_0x11f98d,'total':_0x942fa6,'totalPages':Math[_0x4b02b3(0x13b)](_0x942fa6/_0x11f98d)}};}async[a35_0x71f5f0(0xe4)](_0x587cde){const _0x437b31=a35_0x71f5f0,_0x28887e=await database_1[_0x437b31(0x151)][_0x437b31(0x126)][_0x437b31(0xd5)]({'where':{'id':_0x587cde},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x28887e)return null;return{'id':_0x28887e['id'],'fullName':_0x28887e[_0x437b31(0xd2)],'username':_0x28887e['username'],'telegramId':_0x28887e[_0x437b31(0x11b)],'merchantUrl':_0x28887e[_0x437b31(0xc4)],'gateways':_0x28887e[_0x437b31(0xa0)]?JSON[_0x437b31(0x17f)](_0x28887e[_0x437b31(0xa0)]):null,'gatewaySettings':_0x28887e['gatewaySettings']?JSON['parse'](_0x28887e['gatewaySettings']):null,'publicKey':_0x28887e['publicKey'],'wallets':{'usdtPolygonWallet':_0x28887e['usdtPolygonWallet'],'usdtTrcWallet':_0x28887e['usdtTrcWallet'],'usdtErcWallet':_0x28887e['usdtErcWallet'],'usdcPolygonWallet':_0x28887e[_0x437b31(0xc0)]},'status':_0x28887e['status'],'createdAt':_0x28887e[_0x437b31(0xdb)]};}async[a35_0x71f5f0(0x196)](_0x5d1eaa){const _0x199c4b=a35_0x71f5f0,{fullName:_0xd710a7,username:_0x20ab8a,password:_0x398644,telegramId:_0x3348cd,merchantUrl:_0x5bba67,gateways:_0x436f8f,gatewaySettings:_0x2884e1,wallets:_0x2b50df}=_0x5d1eaa,_0xc4ace=await database_1[_0x199c4b(0x151)]['shop']['findUnique']({'where':{'username':_0x20ab8a}});if(_0xc4ace)throw new Error(_0x199c4b(0x134));if(_0x3348cd){const _0xb2905=await database_1[_0x199c4b(0x151)][_0x199c4b(0x126)][_0x199c4b(0xd5)]({'where':{'telegram':_0x3348cd}});if(_0xb2905)throw new Error(_0x199c4b(0xa1));}const _0x33fca8=await bcryptjs_1[_0x199c4b(0x151)]['hash'](_0x398644,0xc),_0xf0704a=_0x199c4b(0x121)+crypto_1['default'][_0x199c4b(0x132)](0x20)[_0x199c4b(0x111)](_0x199c4b(0x14d)),_0x35d40b=_0x199c4b(0x129)+crypto_1[_0x199c4b(0x151)][_0x199c4b(0x132)](0x20)[_0x199c4b(0x111)]('hex'),_0x1872c4=await database_1['default'][_0x199c4b(0x126)][_0x199c4b(0x16d)]({'data':{'name':_0xd710a7,'username':_0x20ab8a,'password':_0x33fca8,'telegram':_0x3348cd,'shopUrl':_0x5bba67,'paymentGateways':_0x436f8f?JSON[_0x199c4b(0x10c)](_0x436f8f):null,'gatewaySettings':_0x2884e1?JSON[_0x199c4b(0x10c)](_0x2884e1):null,'usdtPolygonWallet':_0x2b50df?.[_0x199c4b(0x148)]||null,'usdtTrcWallet':_0x2b50df?.[_0x199c4b(0x164)]||null,'usdtErcWallet':_0x2b50df?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x2b50df?.[_0x199c4b(0xc0)]||null,'publicKey':_0xf0704a,'secretKey':_0x35d40b,'status':_0x199c4b(0x90)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1872c4['id'],'fullName':_0x1872c4[_0x199c4b(0xd2)],'username':_0x1872c4[_0x199c4b(0x138)],'telegramId':_0x1872c4['telegram'],'merchantUrl':_0x1872c4['shopUrl'],'gateways':_0x1872c4[_0x199c4b(0xa0)]?JSON['parse'](_0x1872c4[_0x199c4b(0xa0)]):null,'gatewaySettings':_0x1872c4[_0x199c4b(0x146)]?JSON[_0x199c4b(0x17f)](_0x1872c4[_0x199c4b(0x146)]):null,'publicKey':_0x1872c4[_0x199c4b(0x11f)],'wallets':{'usdtPolygonWallet':_0x1872c4['usdtPolygonWallet'],'usdtTrcWallet':_0x1872c4[_0x199c4b(0x164)],'usdtErcWallet':_0x1872c4[_0x199c4b(0x167)],'usdcPolygonWallet':_0x1872c4['usdcPolygonWallet']},'status':_0x1872c4[_0x199c4b(0x8c)],'createdAt':_0x1872c4[_0x199c4b(0xdb)]};}async[a35_0x71f5f0(0xbb)](_0x41f48c){const _0x54d7f9=a35_0x71f5f0;await database_1[_0x54d7f9(0x151)][_0x54d7f9(0x126)][_0x54d7f9(0x149)]({'where':{'id':_0x41f48c}});}async[a35_0x71f5f0(0x14f)](_0x499341){const _0x2dee33=a35_0x71f5f0,_0x1c9c9d={};_0x499341&&[_0x2dee33(0x90),_0x2dee33(0x107),_0x2dee33(0x18c)]['includes'](_0x499341[_0x2dee33(0xf8)]())&&(_0x1c9c9d[_0x2dee33(0x8c)]=_0x499341[_0x2dee33(0xf8)]());const _0x3d486d=await database_1[_0x2dee33(0x151)]['shop'][_0x2dee33(0xbf)]({'where':_0x1c9c9d,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2dee33(0xd9)}});return _0x3d486d;}}exports[a35_0x71f5f0(0xde)]=AdminService;