'use strict';function a38_0x2a90(_0x1510d6,_0x17cf6b){const _0x9e8eb0=a38_0x9e8e();return a38_0x2a90=function(_0x2a9050,_0x49c3d1){_0x2a9050=_0x2a9050-0x15f;let _0x49510d=_0x9e8eb0[_0x2a9050];return _0x49510d;},a38_0x2a90(_0x1510d6,_0x17cf6b);}const a38_0x51d73a=a38_0x2a90;(function(_0x40e60b,_0x3e1360){const _0x3bf540=a38_0x2a90,_0x435a78=_0x40e60b();while(!![]){try{const _0xe2ef12=-parseInt(_0x3bf540(0x18d))/0x1*(-parseInt(_0x3bf540(0x1bc))/0x2)+parseInt(_0x3bf540(0x23d))/0x3+-parseInt(_0x3bf540(0x1bb))/0x4*(parseInt(_0x3bf540(0x18f))/0x5)+parseInt(_0x3bf540(0x241))/0x6+parseInt(_0x3bf540(0x1fc))/0x7+-parseInt(_0x3bf540(0x223))/0x8+parseInt(_0x3bf540(0x22a))/0x9;if(_0xe2ef12===_0x3e1360)break;else _0x435a78['push'](_0x435a78['shift']());}catch(_0x3a31d8){_0x435a78['push'](_0x435a78['shift']());}}}(a38_0x9e8e,0xb476a));function a38_0x9e8e(){const _0x2f58e4=['\x20\x20\x20Merchant\x20loses:\x20','rapyd','📊\x20Payout\x20statistics\x20calculated:','\x20payments)','turnoverUSDT','totalPaidOut','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','gatewayEarnings','⚠️\x20Requested\x20gateway\x20\x27','\x20USDT\x20(total\x20paid\x20to\x20merchants)','lte','💰\x20[PAYOUT]\x20Gateway\x20','⚠️\x20Gateway\x20\x27','commission','🔄\x20Converted\x20gateway\x20name\x20\x27','CHARGEBACK',']\x20Gateway\x20settings\x20JSON\x20string:','payout','📊\x20Sorting\x20payments\x20by\x20','💰\x20[PAYOUT]\x20Merchant\x20','🔐\x20[','getGatewayIdByName','🔄\x20Admin\x20updating\x20payment\x20','default','noda','getDate','dateFrom','substr',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20to\x20','../types/gateway','shopUrl','0000','ACTIVE','customerName','KLYME\x20EU','includes','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','usdtErcWallet','length','all','period','📊\x20Calculating\x20payout\x20statistics...','Open\x20Banking\x202','currencyService','Payment\x20not\x20found','randomBytes','averageCommissionRate','erc20_usdc','\x20order','periodTo','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','90d','1131004iWxfyt','push','generateDailyStatistics','\x20\x20\x20Available\x20(raw):\x20','findMany','trc20','Shop\x20not\x20found','⚠️\x20Payment\x20','failUrl','yesterday','getTime','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','Username\x20already\x20exists','setHours','getAllUsers','\x20USDT\x20from\x20balance','\x20USDT\x20(after\x20','custom','trim','round','convertToUSDT','usdcPolygonWallet','\x20\x20\x20📅\x20This\x20month:\x20','error','paidAt','💱\x20Currency\x20filter\x20applied:\x20','set','totalAmountUSDT','toLowerCase','\x20\x20\x20💳\x20Total\x20payments:\x20','amount','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','statusChangedAt','usdtTrcWallet','customerCountry','thisMonth',',\x20successful:\x20','🔧\x20[','shopId','7319240gFdjAW','mastercard','createdAt','\x20\x20\x20Tolerance:\x20','AdminService','\x20\x20\x20Payout\x20amount:\x20','getMerchantStatistics','13880394LNoJTA','gateway','orderId','desc','_count','🔄\x20Gateway\x20mapping:','currency','💰\x20Creating\x20payout\x20for\x20shop\x20','$transaction','erc20','month','📊\x20Final\x20WHERE\x20conditions:','update','gte','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','crypto','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20USDT\x20(+','1511289vjpWWG','\x20USDT,\x20Requested:\x20','availableBalance','\x20USDT)','4269696CNZAuj','\x20\x20\x20Balance:\x20',']\x20Gateway\x20settings\x20before\x20saving:','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20\x20\x20💰\x20Total\x20turnover:\x20','getPayoutStats','create','💰\x20Found\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','PAID','gateways','paidOutUSDT','turnover','Rapyd','paymentGateways','setDate','📋\x20Found\x20','getMonth','\x20\x20\x20�📊\x20Total\x20payments:\x20','delete','\x20status:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','toUpperCase','\x20\x20\x20Current\x20balance:\x20','findFirst','amountUSDT','externalPaymentUrl','__importDefault','klyme_de','\x20\x20\x20Available\x20(number):\x20','customerEmail','stringify','createPayout','\x20\x20\x20💵\x20Available\x20balance:\x20','test_gateway','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','klyme_gb','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','dailyPayments','💰\x20Payment\x20','\x20\x20\x20🤔\x20Difference:\x20','\x20USDT\x20(gross\x20revenue)','averageCheckUSDT','statusChangedBy','getFullYear','\x20became\x20PAID:','publicKey','\x20USDT\x20(actual\x20balances)','getPayoutById','\x20balance\x20updated:','🔄\x20Converted\x20gateway\x20ID\x20\x27','\x20->\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','🔍\x20Using\x20gateway\x20\x27','hex','getAllPayouts','balance','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','\x20merchants\x20with\x20positive\x20balance','usdtPolygonWallet','adminNotes','merchantUrl','gatewayCommissionRate','\x20\x20\x20⏳\x20Pending\x20payout:\x20','COMPLETED','findUnique','groupBy','successUrl','telegramId','merchantEarningsUSDT','pendingUrl','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','Plisio','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','hash','password','insensitive','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','💳\x20Payout\x20wallet\x20for\x20','username','SUSPENDED','\x20USDT,\x20Difference:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','shop','plisio','getGatewayNameById','💰\x20Current\x20shop\x20balance:\x20','createUser','✅\x20Using\x20gateway\x20filter:\x20\x27',']\x20Updating\x20password\x20for\x20user\x20','getMerchantsAwaitingPayout','txid','bcryptjs','\x20balance\x20updated:\x20','cointopay','wallets','\x20\x20\x20Added\x20to\x20balance:\x20+','toFixed','deletePayout','\x20USDT\x20(','MasterCard','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','updatePaymentStatus','📊\x20Gateway\x20filter\x20applied:','amountAfterGatewayCommissionUSDT','Test\x20Gateway','entries','\x20PAID\x20payments','week','\x20USDT','Insufficient\x20balance.\x20Available:\x20','revenue','\x20\x20\x20🌍\x20Country:\x20','\x20\x20\x20Full\x20amount:\x20','\x20USDT\x20(already\x20paid\x20out)','admin','fullName',':\x20commission\x20=\x20','\x20\x20\x20🌐\x20IP:\x20','forEach','\x20\x20\x20Gateway:\x20','ceil','🔄\x20Gateway\x20mapping\x20(create):','aggregate','KLYME\x20GB','merchantEarnings','gatewaySettings','../config/database','totalPayments','PENDING','__esModule','cointopay2','get','getUserById','📊\x20Available\x20gateways\x20in\x20database:','paymentsCount','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','toISOString','status',',\x20Commission:\x20','30d','%\x20commission)','getMerchantsSelection','updatedAt','\x20for\x20shop\x20','_sum','📅\x20Period:\x20','date','\x27\x20(from\x20\x27','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','pk_','pendingPayout','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','sort','💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','chargebackAmount','dailyRevenue','\x27\x20->\x20ID\x20\x27','26628zORaBf','payment','25DZNnDO','notes','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','values','suspendUser','totalPayout','totalAmountAfterCommissionUSDT','✅\x20Payout\x20created:\x20','\x20\x20\x20💰\x20Total\x20payout:\x20','💰\x20Shop\x20','totalCommissionRate','dateTo','\x20\x20\x20💸\x20Total\x20payouts:\x20','customerIp','📊\x20Merchants\x20awaiting\x20payout:\x20','polygon_usdc','log','usdcErcWallet','random','\x20merchants','count','getGatewayDisplayName','gatewayOrderId','split','periodFrom','getGatewayInternalName','Telegram\x20username\x20already\x20exists','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20USDT\x20(same\x20as\x20awaiting)','polygon','map','🎯\x20[','toString','getSystemStatistics','customerUa','commissionUSDT','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','name','klyme_eu','getPaymentById','2020-01-01','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','1161224gzjRDl','14EnkIeK','parse','network','telegram','day','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','reduce','asc','📊\x20Getting\x20payments\x20with\x20filters:','defineProperty'];a38_0x9e8e=function(){return _0x2f58e4;};return a38_0x9e8e();}var __importDefault=this&&this[a38_0x51d73a(0x25d)]||function(_0x4b0fcc){const _0x28ddfc=a38_0x51d73a;return _0x4b0fcc&&_0x4b0fcc[_0x28ddfc(0x16f)]?_0x4b0fcc:{'default':_0x4b0fcc};};Object[a38_0x51d73a(0x1c5)](exports,a38_0x51d73a(0x16f),{'value':!![]}),exports[a38_0x51d73a(0x227)]=void 0x0;const database_1=__importDefault(require(a38_0x51d73a(0x16c))),bcryptjs_1=__importDefault(require(a38_0x51d73a(0x29e))),crypto_1=__importDefault(require(a38_0x51d73a(0x239))),currencyService_1=require('./currencyService'),gateway_1=require(a38_0x51d73a(0x1e4));class AdminService{async[a38_0x51d73a(0x246)](){const _0x4725ca=a38_0x51d73a;console[_0x4725ca(0x1a1)](_0x4725ca(0x1f1));const _0x49d9af=await database_1['default'][_0x4725ca(0x295)][_0x4725ca(0x168)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x4725ca(0x1e7)}}),_0x352611=await database_1[_0x4725ca(0x1dd)][_0x4725ca(0x18e)][_0x4725ca(0x1a5)]({'where':{'status':_0x4725ca(0x24a),'gateway':{'not':_0x4725ca(0x264)}}}),_0x57aee8=new Date(),_0xebf1e1=new Date(_0x57aee8['getFullYear'](),_0x57aee8[_0x4725ca(0x252)](),0x1),_0x5bf352=new Date(_0x57aee8[_0x4725ca(0x26e)](),_0x57aee8[_0x4725ca(0x252)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x281544=await database_1[_0x4725ca(0x1dd)][_0x4725ca(0x1d7)][_0x4725ca(0x168)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0xebf1e1,'lte':_0x5bf352},'status':_0x4725ca(0x282)}}),_0x24d0d9=_0x49d9af[_0x4725ca(0x17e)]['totalPaidOut']||0x0,_0x20a018=_0x49d9af[_0x4725ca(0x17e)][_0x4725ca(0x27a)]||0x0,_0x3ee1b4=_0x281544[_0x4725ca(0x17e)][_0x4725ca(0x21a)]||0x0,_0xe0a9b8={'totalPayout':Math['round'](_0x24d0d9*0x64)/0x64,'awaitingPayout':Math[_0x4725ca(0x20f)](_0x20a018*0x64)/0x64,'thisMonth':Math[_0x4725ca(0x20f)](_0x3ee1b4*0x64)/0x64,'availableBalance':Math[_0x4725ca(0x20f)](_0x20a018*0x64)/0x64,'totalPayments':_0x352611};return console[_0x4725ca(0x1a1)](_0x4725ca(0x1c8)),console[_0x4725ca(0x1a1)](_0x4725ca(0x199)+_0xe0a9b8['totalPayout']+_0x4725ca(0x1cf)),console[_0x4725ca(0x1a1)](_0x4725ca(0x21b)+_0xe0a9b8['awaitingPayout']+_0x4725ca(0x249)),console[_0x4725ca(0x1a1)](_0x4725ca(0x263)+_0xe0a9b8[_0x4725ca(0x23f)]+_0x4725ca(0x1ad)),console[_0x4725ca(0x1a1)](_0x4725ca(0x212)+_0xe0a9b8[_0x4725ca(0x21f)]+_0x4725ca(0x2af)),console[_0x4725ca(0x1a1)](_0x4725ca(0x219)+_0xe0a9b8[_0x4725ca(0x16d)]+_0x4725ca(0x2ad)),_0xe0a9b8;}async['updateCustomerData'](_0xfa87c7,_0x45276a){const _0x51c4f1=a38_0x51d73a;console['log']('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0xfa87c7+':',_0x45276a);const _0x51d71e=await database_1[_0x51c4f1(0x1dd)][_0x51c4f1(0x18e)][_0x51c4f1(0x283)]({'where':{'id':_0xfa87c7},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x51d71e)throw new Error(_0x51c4f1(0x1f4));const _0x3a2f80={};_0x45276a[_0x51c4f1(0x21e)]!==undefined&&(_0x3a2f80['customerCountry']=_0x45276a[_0x51c4f1(0x21e)]||null);_0x45276a[_0x51c4f1(0x19e)]!==undefined&&(_0x3a2f80[_0x51c4f1(0x19e)]=_0x45276a['customerIp']||null);_0x45276a[_0x51c4f1(0x1b3)]!==undefined&&(_0x3a2f80[_0x51c4f1(0x1b3)]=_0x45276a[_0x51c4f1(0x1b3)]||null);const _0x56e22e=await database_1['default'][_0x51c4f1(0x18e)]['update']({'where':{'id':_0xfa87c7},'data':{..._0x3a2f80,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x51c4f1(0x1a1)](_0x51c4f1(0x1eb)+_0xfa87c7),console[_0x51c4f1(0x1a1)](_0x51c4f1(0x2b2)+_0x51d71e['customerCountry']+_0x51c4f1(0x275)+_0x56e22e[_0x51c4f1(0x21e)]),console[_0x51c4f1(0x1a1)](_0x51c4f1(0x163)+_0x51d71e[_0x51c4f1(0x19e)]+_0x51c4f1(0x275)+_0x56e22e[_0x51c4f1(0x19e)]),console[_0x51c4f1(0x1a1)](_0x51c4f1(0x23b)+(_0x51d71e[_0x51c4f1(0x1b3)]?_0x51c4f1(0x216):'not\x20set')+_0x51c4f1(0x275)+(_0x56e22e[_0x51c4f1(0x1b3)]?_0x51c4f1(0x216):'not\x20set')),_0x56e22e;}async[a38_0x51d73a(0x1b2)](_0x25a0b8){const _0x4846a1=a38_0x51d73a,_0x3c3305=new Date();let _0x535632;switch(_0x25a0b8[_0x4846a1(0x218)]()){case _0x4846a1(0x1c0):_0x535632=new Date(_0x3c3305['getFullYear'](),_0x3c3305[_0x4846a1(0x252)](),_0x3c3305['getDate'](),0x0,0x0,0x0,0x0);break;case _0x4846a1(0x205):const _0x2a2bbe=new Date(_0x3c3305);_0x2a2bbe[_0x4846a1(0x250)](_0x2a2bbe['getDate']()-0x1),_0x535632=new Date(_0x2a2bbe['getFullYear'](),_0x2a2bbe['getMonth'](),_0x2a2bbe['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x535632=new Date(_0x3c3305[_0x4846a1(0x206)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4846a1(0x179):_0x535632=new Date(_0x3c3305[_0x4846a1(0x206)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4846a1(0x1fb):_0x535632=new Date(_0x3c3305['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4846a1(0x1ef):const _0x35598b=await database_1['default'][_0x4846a1(0x18e)][_0x4846a1(0x25a)]({'where':{'gateway':{'not':_0x4846a1(0x264)}},'orderBy':{'createdAt':_0x4846a1(0x1c3)},'select':{'createdAt':!![]}});_0x535632=_0x35598b?_0x35598b[_0x4846a1(0x225)]:new Date('2020-01-01');break;default:_0x535632=new Date(_0x3c3305['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x535632[_0x4846a1(0x209)](0x0,0x0,0x0,0x0);let _0xb3aa3b;if(_0x25a0b8[_0x4846a1(0x218)]()==='yesterday'){const _0x1e3e0a=new Date(_0x3c3305);_0x1e3e0a[_0x4846a1(0x250)](_0x1e3e0a[_0x4846a1(0x1df)]()-0x1),_0xb3aa3b=new Date(_0x1e3e0a[_0x4846a1(0x26e)](),_0x1e3e0a[_0x4846a1(0x252)](),_0x1e3e0a[_0x4846a1(0x1df)](),0x17,0x3b,0x3b,0x3e7);}const _0x56b532={'gte':_0x535632};_0xb3aa3b&&(_0x56b532['lte']=_0xb3aa3b);const [_0x38e958,_0x427d69,_0x58eb24,_0x2ded6f,_0x2374b5,_0x1a2522]=await Promise[_0x4846a1(0x1ef)]([database_1[_0x4846a1(0x1dd)][_0x4846a1(0x295)][_0x4846a1(0x1a5)](),database_1[_0x4846a1(0x1dd)][_0x4846a1(0x295)][_0x4846a1(0x1a5)]({'where':{'status':_0x4846a1(0x1e7)}}),database_1[_0x4846a1(0x1dd)][_0x4846a1(0x18e)][_0x4846a1(0x1a5)]({'where':{'status':_0x4846a1(0x24a),'createdAt':_0x56b532,'gateway':{'not':_0x4846a1(0x264)}}}),database_1['default'][_0x4846a1(0x18e)][_0x4846a1(0x200)]({'where':{'status':_0x4846a1(0x24a),'createdAt':_0x56b532,'gateway':{'not':_0x4846a1(0x264)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x4846a1(0x18e)][_0x4846a1(0x200)]({'where':{'gateway':{'not':_0x4846a1(0x264)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4846a1(0x1dd)][_0x4846a1(0x18e)][_0x4846a1(0x200)]({'where':{'createdAt':_0x56b532,'gateway':{'not':_0x4846a1(0x264)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x1d928b=0x0,_0x4b38bd=0x0;for(const _0x214602 of _0x2ded6f){const _0x420991=await currencyService_1['currencyService'][_0x4846a1(0x210)](_0x214602[_0x4846a1(0x21a)],_0x214602[_0x4846a1(0x230)]);_0x1d928b+=_0x420991;if(_0x214602[_0x4846a1(0x2aa)]){const _0x388e60=await currencyService_1[_0x4846a1(0x1f3)]['convertToUSDT'](_0x214602['amount'],_0x214602['currency']),_0x19f565=_0x214602[_0x4846a1(0x2aa)],_0x9172e1=_0x388e60-_0x19f565;_0x4b38bd+=_0x9172e1;}}const _0x49e590=_0x58eb24>0x0?_0x1d928b/_0x58eb24:0x0,_0x9af46a=this[_0x4846a1(0x1fe)](_0x1a2522,_0x535632,_0xb3aa3b||_0x3c3305),_0x52ca79=await database_1[_0x4846a1(0x1dd)][_0x4846a1(0x18e)][_0x4846a1(0x1a5)]({'where':{'createdAt':_0x56b532,'gateway':{'not':'test_gateway'}}}),_0x1e1b5c=_0x52ca79>0x0?_0x58eb24/_0x52ca79*0x64:0x0;return{'totalShops':_0x38e958,'activeShops':_0x427d69,'totalPayments':_0x58eb24,'successfulPayments':_0x58eb24,'totalAttempts':_0x52ca79,'totalRevenue':Math[_0x4846a1(0x20f)](_0x1d928b*0x64)/0x64,'trapayEarnings':Math[_0x4846a1(0x20f)](_0x4b38bd*0x64)/0x64,'averagePaymentAmount':Math[_0x4846a1(0x20f)](_0x49e590*0x64)/0x64,'conversionRate':Math['round'](_0x1e1b5c*0x64)/0x64,'dailyRevenue':_0x9af46a[_0x4846a1(0x18b)],'dailyPayments':_0x9af46a[_0x4846a1(0x268)],'recentPayments':_0x2374b5[_0x4846a1(0x1af)](_0x21ece5=>({'id':_0x21ece5['id'],'amount':_0x21ece5[_0x4846a1(0x21a)],'currency':_0x21ece5[_0x4846a1(0x230)],'status':_0x21ece5[_0x4846a1(0x177)],'gateway':_0x21ece5[_0x4846a1(0x22b)],'shop':_0x21ece5[_0x4846a1(0x295)],'createdAt':_0x21ece5[_0x4846a1(0x225)]}))};}async[a38_0x51d73a(0x229)](_0x2aa369){const _0x178eab=a38_0x51d73a;console[_0x178eab(0x1a1)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x2aa369);let _0x5dd1b1,_0x4dcad5=new Date();if(_0x2aa369[_0x178eab(0x1f0)]===_0x178eab(0x20d)&&_0x2aa369['dateFrom']&&_0x2aa369['dateTo'])_0x5dd1b1=new Date(_0x2aa369[_0x178eab(0x1e0)]),_0x4dcad5=new Date(_0x2aa369[_0x178eab(0x19c)]),_0x5dd1b1[_0x178eab(0x209)](0x0,0x0,0x0,0x0),_0x4dcad5[_0x178eab(0x209)](0x17,0x3b,0x3b,0x3e7);else{const _0xe2c85a=new Date();switch(_0x2aa369[_0x178eab(0x1f0)]){case _0x178eab(0x2ae):_0x5dd1b1=new Date(_0xe2c85a[_0x178eab(0x206)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x178eab(0x234):_0x5dd1b1=new Date(_0xe2c85a['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x5dd1b1=new Date(_0xe2c85a[_0x178eab(0x206)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x178eab(0x1ef):default:_0x5dd1b1=new Date(_0x178eab(0x1b9));break;}_0x5dd1b1[_0x178eab(0x209)](0x0,0x0,0x0,0x0),_0x4dcad5[_0x178eab(0x209)](0x17,0x3b,0x3b,0x3e7);}console[_0x178eab(0x1a1)](_0x178eab(0x17f)+_0x5dd1b1['toISOString']()+_0x178eab(0x1e3)+_0x4dcad5[_0x178eab(0x176)]());const _0x19211e={'status':'PAID','gateway':{'not':_0x178eab(0x264)},'paidAt':{'gte':_0x5dd1b1,'lte':_0x4dcad5}};_0x2aa369[_0x178eab(0x222)]&&(_0x19211e[_0x178eab(0x222)]=_0x2aa369[_0x178eab(0x222)]);const _0x37670c=await database_1['default'][_0x178eab(0x18e)]['findMany']({'where':_0x19211e,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('💰\x20Found\x20'+_0x37670c['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x236689={'gateway':{'not':_0x178eab(0x264)},'createdAt':{'gte':_0x5dd1b1,'lte':_0x4dcad5}};_0x2aa369['shopId']&&(_0x236689['shopId']=_0x2aa369[_0x178eab(0x222)]);const _0x489a1f=await database_1[_0x178eab(0x1dd)][_0x178eab(0x18e)][_0x178eab(0x1a5)]({'where':_0x236689});console['log']('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x489a1f+_0x178eab(0x220)+_0x37670c['length']);let _0x21c8f7=0x0,_0x373654=0x0,_0x33fc79=0x0;const _0x530546={},_0x23ead6={},_0x32b28b={};for(const _0x721d5 of _0x37670c){try{const _0x25cb9c=_0x721d5['amountUSDT']||0x0;if(_0x25cb9c<=0x0){console['warn'](_0x178eab(0x203)+_0x721d5['id']+_0x178eab(0x207));continue;}let _0x4e264c,_0x30b7e3;if(_0x721d5[_0x178eab(0x2aa)]!==null&&_0x721d5[_0x178eab(0x2aa)]!==undefined)_0x4e264c=_0x721d5[_0x178eab(0x2aa)],_0x30b7e3=_0x25cb9c-_0x4e264c,console['log'](_0x178eab(0x192)+_0x721d5['id']+':\x20'+_0x25cb9c[_0x178eab(0x2a3)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x4e264c['toFixed'](0x6)+'\x20USDT');else{let _0x4dc2d6={};if(_0x721d5[_0x178eab(0x295)][_0x178eab(0x16b)])try{_0x4dc2d6=JSON[_0x178eab(0x1bd)](_0x721d5[_0x178eab(0x295)][_0x178eab(0x16b)]);}catch(_0x3fd4b4){console[_0x178eab(0x213)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x721d5[_0x178eab(0x222)]+':',_0x3fd4b4);}let _0x3a246e=0x2d;for(const [_0x1593ef,_0x465a9f]of Object['entries'](_0x4dc2d6)){if(_0x1593ef[_0x178eab(0x218)]()===_0x721d5[_0x178eab(0x22b)]['toLowerCase']()){_0x3a246e=_0x465a9f[_0x178eab(0x1d3)]||0x2d;break;}}_0x30b7e3=_0x25cb9c*(_0x3a246e/0x64),_0x4e264c=_0x25cb9c-_0x30b7e3,console[_0x178eab(0x1a1)](_0x178eab(0x1ba)+_0x721d5['id']+':\x20'+_0x3a246e+'%\x20from\x20'+_0x25cb9c[_0x178eab(0x2a3)](0x6)+_0x178eab(0x2af));}_0x21c8f7+=_0x25cb9c,_0x373654+=_0x4e264c,_0x33fc79+=_0x30b7e3;let _0x38ae8d;_0x721d5[_0x178eab(0x280)]!==null&&_0x721d5[_0x178eab(0x280)]!==undefined?(_0x38ae8d=_0x721d5['gatewayCommissionRate'],console[_0x178eab(0x1a1)](_0x178eab(0x1cc)+_0x721d5['id']+':\x20'+_0x38ae8d+'%')):(_0x38ae8d=_0x25cb9c>0x0?_0x30b7e3/_0x25cb9c*0x64:0x0,console[_0x178eab(0x1a1)](_0x178eab(0x1fa)+_0x721d5['id']+':\x20'+_0x38ae8d[_0x178eab(0x2a3)](0x2)+'%'));!_0x530546[_0x721d5['gateway']]&&(_0x530546[_0x721d5[_0x178eab(0x22b)]]={'gateway':_0x721d5[_0x178eab(0x22b)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x721d5[_0x178eab(0x22b)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x530546[_0x721d5['gateway']][_0x178eab(0x174)]++,_0x530546[_0x721d5[_0x178eab(0x22b)]][_0x178eab(0x1ca)]+=_0x25cb9c,_0x530546[_0x721d5[_0x178eab(0x22b)]]['commissionUSDT']+=_0x30b7e3,_0x530546[_0x721d5[_0x178eab(0x22b)]][_0x178eab(0x287)]+=_0x4e264c,_0x530546[_0x721d5[_0x178eab(0x22b)]]['totalCommissionRate']+=_0x38ae8d;!_0x2aa369['shopId']&&(!_0x23ead6[_0x721d5[_0x178eab(0x222)]]&&(_0x23ead6[_0x721d5[_0x178eab(0x222)]]={'shopId':_0x721d5[_0x178eab(0x222)],'shopName':_0x721d5[_0x178eab(0x295)][_0x178eab(0x1b6)],'shopUsername':_0x721d5[_0x178eab(0x295)][_0x178eab(0x291)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x23ead6[_0x721d5[_0x178eab(0x222)]][_0x178eab(0x174)]++,_0x23ead6[_0x721d5[_0x178eab(0x222)]][_0x178eab(0x1ca)]+=_0x25cb9c,_0x23ead6[_0x721d5[_0x178eab(0x222)]][_0x178eab(0x1b4)]+=_0x30b7e3,_0x23ead6[_0x721d5[_0x178eab(0x222)]]['merchantEarningsUSDT']+=_0x4e264c);const _0x11ed07=_0x721d5[_0x178eab(0x214)]['toISOString']()[_0x178eab(0x1a8)]('T')[0x0];!_0x32b28b[_0x11ed07]&&(_0x32b28b[_0x11ed07]={'date':_0x11ed07,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x32b28b[_0x11ed07]['turnover']+=_0x25cb9c,_0x32b28b[_0x11ed07]['merchantEarnings']+=_0x4e264c,_0x32b28b[_0x11ed07][_0x178eab(0x1cd)]+=_0x30b7e3,_0x32b28b[_0x11ed07]['paymentsCount']++;}catch(_0x3a2752){console[_0x178eab(0x213)]('Error\x20processing\x20payment\x20'+_0x721d5['id']+':',_0x3a2752);}}Object[_0x178eab(0x194)](_0x530546)[_0x178eab(0x164)](_0x1ab319=>{const _0x3a2f08=_0x178eab;_0x1ab319[_0x3a2f08(0x1f6)]=_0x1ab319[_0x3a2f08(0x174)]>0x0?_0x1ab319[_0x3a2f08(0x19b)]/_0x1ab319[_0x3a2f08(0x174)]:0x0,delete _0x1ab319['totalCommissionRate'];}),Object[_0x178eab(0x194)](_0x23ead6)[_0x178eab(0x164)](_0x46cdd4=>{const _0x3bb4fe=_0x178eab;_0x46cdd4[_0x3bb4fe(0x26c)]=_0x46cdd4[_0x3bb4fe(0x174)]>0x0?_0x46cdd4['turnoverUSDT']/_0x46cdd4[_0x3bb4fe(0x174)]:0x0;});let _0x15e19a=0x0,_0x1cca9f=0x0;if(_0x2aa369[_0x178eab(0x222)]){const _0x3d601a=await database_1[_0x178eab(0x1dd)][_0x178eab(0x1d7)][_0x178eab(0x200)]({'where':{'shopId':_0x2aa369[_0x178eab(0x222)],'status':'COMPLETED','createdAt':{'gte':_0x5dd1b1,'lte':_0x4dcad5}},'select':{'amount':!![]}});_0x15e19a=_0x3d601a[_0x178eab(0x1c2)]((_0x556ced,_0x2e9085)=>_0x556ced+_0x2e9085[_0x178eab(0x21a)],0x0);const _0x3e0527=await database_1['default']['payout'][_0x178eab(0x200)]({'where':{'shopId':_0x2aa369[_0x178eab(0x222)],'status':_0x178eab(0x16e),'createdAt':{'gte':_0x5dd1b1,'lte':_0x4dcad5}},'select':{'amount':!![]}});_0x1cca9f=_0x3e0527[_0x178eab(0x1c2)]((_0x1bcd5c,_0x3ffee7)=>_0x1bcd5c+_0x3ffee7[_0x178eab(0x21a)],0x0);}const _0x4f038b=_0x489a1f,_0x8e34f7=_0x37670c[_0x178eab(0x1ee)],_0x43dfea=_0x8e34f7>0x0?_0x21c8f7/_0x8e34f7:0x0,_0x125966=_0x4f038b>0x0?Math[_0x178eab(0x20f)](_0x8e34f7/_0x4f038b*0x2710)/0x64:0x0,_0x4831fe=Math[_0x178eab(0x166)]((_0x4dcad5[_0x178eab(0x206)]()-_0x5dd1b1[_0x178eab(0x206)]())/(0x3e8*0x3c*0x3c*0x18)),_0x320dc4={'totalTurnover':Math[_0x178eab(0x20f)](_0x21c8f7*0x64)/0x64,'merchantEarnings':Math[_0x178eab(0x20f)](_0x373654*0x64)/0x64,'gatewayEarnings':Math[_0x178eab(0x20f)](_0x33fc79*0x64)/0x64,'totalPaidOut':Math[_0x178eab(0x20f)](_0x15e19a*0x64)/0x64,'pendingPayout':Math[_0x178eab(0x20f)](_0x1cca9f*0x64)/0x64,'averageCheck':Math[_0x178eab(0x20f)](_0x43dfea*0x64)/0x64,'totalPayments':_0x4f038b,'successfulPayments':_0x8e34f7,'conversionRate':_0x125966,'gatewayBreakdown':Object[_0x178eab(0x194)](_0x530546)[_0x178eab(0x1af)](_0xfb582d=>({..._0xfb582d,'turnoverUSDT':Math[_0x178eab(0x20f)](_0xfb582d['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0xfb582d['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x178eab(0x20f)](_0xfb582d[_0x178eab(0x287)]*0x64)/0x64,'averageCommissionRate':Math[_0x178eab(0x20f)](_0xfb582d[_0x178eab(0x1f6)]*0x64)/0x64})),'merchantBreakdown':_0x2aa369[_0x178eab(0x222)]?undefined:Object[_0x178eab(0x194)](_0x23ead6)['map'](_0x2a9879=>({..._0x2a9879,'turnoverUSDT':Math['round'](_0x2a9879['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x2a9879[_0x178eab(0x1b4)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x178eab(0x20f)](_0x2a9879[_0x178eab(0x287)]*0x64)/0x64,'paidOutUSDT':Math[_0x178eab(0x20f)](_0x2a9879[_0x178eab(0x24c)]*0x64)/0x64,'averageCheckUSDT':Math[_0x178eab(0x20f)](_0x2a9879[_0x178eab(0x26c)]*0x64)/0x64})),'dailyData':Object['values'](_0x32b28b)['map'](_0x381d20=>({..._0x381d20,'turnover':Math['round'](_0x381d20[_0x178eab(0x24d)]*0x64)/0x64,'merchantEarnings':Math[_0x178eab(0x20f)](_0x381d20[_0x178eab(0x16a)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x381d20['gatewayEarnings']*0x64)/0x64}))[_0x178eab(0x186)]((_0x31fae8,_0x1e11d2)=>_0x31fae8['date']['localeCompare'](_0x1e11d2[_0x178eab(0x180)])),'periodInfo':{'from':_0x5dd1b1,'to':_0x4dcad5,'periodType':_0x2aa369['period']||'custom','daysCount':_0x4831fe}};return console['log']('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x178eab(0x1a1)](_0x178eab(0x245)+_0x320dc4['totalTurnover']+_0x178eab(0x2af)),console['log'](_0x178eab(0x28b)+_0x320dc4[_0x178eab(0x16a)]+_0x178eab(0x2af)),console[_0x178eab(0x1a1)](_0x178eab(0x267)+_0x320dc4[_0x178eab(0x1cd)]+_0x178eab(0x2af)),console[_0x178eab(0x1a1)](_0x178eab(0x2a7)+_0x320dc4[_0x178eab(0x1cb)]+_0x178eab(0x2af)),console[_0x178eab(0x1a1)](_0x178eab(0x281)+_0x320dc4[_0x178eab(0x184)]+_0x178eab(0x2af)),console[_0x178eab(0x1a1)](_0x178eab(0x253)+_0x320dc4[_0x178eab(0x16d)]),_0x320dc4;}async[a38_0x51d73a(0x17b)](){const _0x2c79fb=a38_0x51d73a;console[_0x2c79fb(0x1a1)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x1340e0=await database_1['default'][_0x2c79fb(0x295)][_0x2c79fb(0x200)]({'where':{'status':_0x2c79fb(0x1e7)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2c79fb(0x1c3)}});return console[_0x2c79fb(0x1a1)](_0x2c79fb(0x251)+_0x1340e0['length']+'\x20active\x20merchants\x20for\x20selection'),_0x1340e0[_0x2c79fb(0x1af)](_0xee25a7=>({'id':_0xee25a7['id'],'username':_0xee25a7[_0x2c79fb(0x291)],'name':_0xee25a7['name']}));}[a38_0x51d73a(0x1a6)](_0x228030){const _0x525d7d=a38_0x51d73a,_0x4b62ba={'test_gateway':_0x525d7d(0x2ab),'plisio':_0x525d7d(0x28a),'rapyd':_0x525d7d(0x24e),'noda':'Noda','cointopay':'CoinToPay','cointopay2':_0x525d7d(0x1f2),'klyme_eu':_0x525d7d(0x1e9),'klyme_gb':_0x525d7d(0x169),'klyme_de':'KLYME\x20DE','mastercard':_0x525d7d(0x2a6)};return _0x4b62ba[_0x228030]||_0x228030;}[a38_0x51d73a(0x1aa)](_0x407de0){const _0x3a79ab=a38_0x51d73a,_0x45a0={'Test\x20Gateway':_0x3a79ab(0x264),'Plisio':_0x3a79ab(0x296),'Rapyd':_0x3a79ab(0x1c7),'Noda':_0x3a79ab(0x1de),'CoinToPay':_0x3a79ab(0x2a0),'CoinToPay2':_0x3a79ab(0x170),'KLYME\x20EU':_0x3a79ab(0x1b7),'KLYME\x20GB':_0x3a79ab(0x266),'KLYME\x20DE':_0x3a79ab(0x25e),'MasterCard':_0x3a79ab(0x224)};return _0x45a0[_0x407de0]||_0x407de0['toLowerCase']();}async[a38_0x51d73a(0x29c)](_0x1c4d61){const _0x1b39b2=a38_0x51d73a,{page:_0xf42cfa,limit:_0x4f6572,minAmount:_0x1a5b7a,search:_0x5b814e}=_0x1c4d61,_0x2bea22=(_0xf42cfa-0x1)*_0x4f6572;console[_0x1b39b2(0x1a1)](_0x1b39b2(0x175),_0x1c4d61);const _0x984784={'balance':{'gt':0x0},'status':_0x1b39b2(0x1e7)};_0x1a5b7a&&(_0x984784[_0x1b39b2(0x27a)][_0x1b39b2(0x237)]=_0x1a5b7a);_0x5b814e&&(_0x984784[_0x1b39b2(0x1b6)]={'contains':_0x5b814e,'mode':_0x1b39b2(0x28e)});const [_0x58b54a,_0x223bc8]=await Promise[_0x1b39b2(0x1ef)]([database_1[_0x1b39b2(0x1dd)][_0x1b39b2(0x295)][_0x1b39b2(0x200)]({'where':_0x984784,'skip':_0x2bea22,'take':_0x4f6572,'orderBy':{'balance':_0x1b39b2(0x22d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x1b39b2(0x295)][_0x1b39b2(0x1a5)]({'where':_0x984784})]);console['log'](_0x1b39b2(0x248)+_0x58b54a['length']+_0x1b39b2(0x27c));const _0x13d482=await Promise['all'](_0x58b54a[_0x1b39b2(0x1af)](async _0x4dba47=>{const _0xd54fa5=_0x1b39b2,[_0x4745fc,_0x5b7f6d,_0x5e8c71]=await Promise[_0xd54fa5(0x1ef)]([database_1[_0xd54fa5(0x1dd)][_0xd54fa5(0x18e)][_0xd54fa5(0x1a5)]({'where':{'shopId':_0x4dba47['id'],'status':'PAID','gateway':{'not':_0xd54fa5(0x264)}}}),database_1[_0xd54fa5(0x1dd)][_0xd54fa5(0x18e)][_0xd54fa5(0x25a)]({'where':{'shopId':_0x4dba47['id'],'status':_0xd54fa5(0x24a),'gateway':{'not':_0xd54fa5(0x264)}},'orderBy':{'paidAt':_0xd54fa5(0x1c3)},'select':{'paidAt':!![]}}),database_1[_0xd54fa5(0x1dd)][_0xd54fa5(0x18e)]['groupBy']({'by':[_0xd54fa5(0x22b)],'where':{'shopId':_0x4dba47['id'],'status':_0xd54fa5(0x24a),'gateway':{'not':_0xd54fa5(0x264)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x47804c=new Date(),_0x4e644b=new Date(_0x47804c[_0xd54fa5(0x26e)](),_0x47804c[_0xd54fa5(0x252)](),0x1),_0x54944d=new Date(_0x47804c[_0xd54fa5(0x26e)](),_0x47804c[_0xd54fa5(0x252)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3effa4,_0x39eae9]=await Promise[_0xd54fa5(0x1ef)]([database_1[_0xd54fa5(0x1dd)][_0xd54fa5(0x1d7)][_0xd54fa5(0x168)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4dba47['id'],'status':_0xd54fa5(0x282)}}),database_1[_0xd54fa5(0x1dd)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x4dba47['id'],'status':'COMPLETED','createdAt':{'gte':_0x4e644b,'lte':_0x54944d}}})]),_0x56509f=_0x3effa4['_sum'][_0xd54fa5(0x21a)]||0x0,_0x1fa919=_0x39eae9[_0xd54fa5(0x17e)][_0xd54fa5(0x21a)]||0x0,_0x5676d3=await Promise[_0xd54fa5(0x1ef)](_0x5e8c71[_0xd54fa5(0x1af)](async _0x214dbf=>{const _0x5e986f=_0xd54fa5;let _0x46bf52=0x2d;if(_0x4dba47['gatewaySettings'])try{const _0x56ef52=JSON['parse'](_0x4dba47[_0x5e986f(0x16b)]);for(const [_0x225081,_0x4c9532]of Object[_0x5e986f(0x2ac)](_0x56ef52)){if(_0x225081[_0x5e986f(0x218)]()===_0x214dbf['gateway']['toLowerCase']()){_0x46bf52=_0x4c9532['commission']||0xa,console[_0x5e986f(0x1a1)](_0x5e986f(0x1d1)+_0x214dbf[_0x5e986f(0x22b)]+_0x5e986f(0x17d)+_0x4dba47['id']+_0x5e986f(0x162)+_0x46bf52+'%');break;}}}catch(_0x5bf945){console[_0x5e986f(0x213)](_0x5e986f(0x294)+_0x4dba47['id']+':',_0x5bf945);}const _0xe38fac=_0x214dbf[_0x5e986f(0x17e)]?.[_0x5e986f(0x25b)]||0x0,_0x4fd88c=_0xe38fac*(0x1-_0x46bf52/0x64);return{'gateway':_0x214dbf[_0x5e986f(0x22b)],'count':_0x214dbf[_0x5e986f(0x22e)]?.['id']||0x0,'amountUSDT':Math[_0x5e986f(0x20f)](_0xe38fac*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5e986f(0x20f)](_0x4fd88c*0x64)/0x64,'commission':_0x46bf52};})),_0x5992bb=_0x5676d3[_0xd54fa5(0x1c2)]((_0x5abd50,_0x4d29be)=>_0x5abd50+_0x4d29be['amountUSDT'],0x0),_0x3b14fe=_0x5676d3[_0xd54fa5(0x1c2)]((_0x220324,_0x4ff0d1)=>_0x220324+_0x4ff0d1['amountAfterCommissionUSDT'],0x0),_0x233acb=_0x4dba47[_0xd54fa5(0x27a)];return console[_0xd54fa5(0x1a1)](_0xd54fa5(0x1d9)+_0x4dba47[_0xd54fa5(0x291)]+':'),console[_0xd54fa5(0x1a1)](_0xd54fa5(0x191)+_0x5992bb[_0xd54fa5(0x2a3)](0x2)+_0xd54fa5(0x26b)),console['log'](_0xd54fa5(0x1ac)+_0x3b14fe['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log'](_0xd54fa5(0x1ec)+_0x233acb[_0xd54fa5(0x2a3)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console['log'](_0xd54fa5(0x19d)+_0x56509f[_0xd54fa5(0x2a3)](0x2)+_0xd54fa5(0x15f)),console[_0xd54fa5(0x1a1)](_0xd54fa5(0x26a)+(_0x3b14fe-_0x56509f-_0x233acb)[_0xd54fa5(0x2a3)](0x2)+_0xd54fa5(0x28f)),{'id':_0x4dba47['id'],'fullName':_0x4dba47['name'],'username':_0x4dba47['username'],'telegramId':_0x4dba47[_0xd54fa5(0x1bf)],'merchantUrl':_0x4dba47[_0xd54fa5(0x1e5)],'wallets':{'usdtPolygonWallet':_0x4dba47[_0xd54fa5(0x27d)],'usdtTrcWallet':_0x4dba47[_0xd54fa5(0x21d)],'usdtErcWallet':_0x4dba47[_0xd54fa5(0x1ed)],'usdcPolygonWallet':_0x4dba47[_0xd54fa5(0x211)],'usdcErcWallet':_0x4dba47[_0xd54fa5(0x1a2)]},'totalAmountUSDT':Math[_0xd54fa5(0x20f)](_0x5992bb*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xd54fa5(0x20f)](_0x3b14fe*0x64)/0x64,'currentBalance':Math[_0xd54fa5(0x20f)](_0x233acb*0x64)/0x64,'totalPayout':Math[_0xd54fa5(0x20f)](_0x56509f*0x64)/0x64,'thisMonth':Math[_0xd54fa5(0x20f)](_0x1fa919*0x64)/0x64,'paymentsCount':_0x4745fc,'oldestPaymentDate':_0x5b7f6d?.[_0xd54fa5(0x214)]||_0x4dba47[_0xd54fa5(0x225)],'gatewayBreakdown':_0x5676d3};})),_0x2b4e6b=_0x13d482[_0x1b39b2(0x1c2)]((_0x1749ba,_0x278893)=>_0x1749ba+_0x278893[_0x1b39b2(0x217)],0x0),_0x27f370=_0x13d482[_0x1b39b2(0x1c2)]((_0x314736,_0x296da6)=>_0x314736+_0x296da6[_0x1b39b2(0x197)],0x0),_0x5c2afc=_0x13d482['reduce']((_0x3f9cb1,_0x217e0c)=>_0x3f9cb1+_0x217e0c[_0x1b39b2(0x196)],0x0),_0x2a2064=_0x13d482[_0x1b39b2(0x1c2)]((_0x29d39b,_0x4063e3)=>_0x29d39b+_0x4063e3[_0x1b39b2(0x21f)],0x0);return console[_0x1b39b2(0x1a1)](_0x1b39b2(0x19f)+_0x223bc8+_0x1b39b2(0x1a4)),console[_0x1b39b2(0x1a1)](_0x1b39b2(0x185)+Math[_0x1b39b2(0x20f)](_0x2b4e6b*0x64)/0x64+_0x1b39b2(0x26b)),console['log']('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x1b39b2(0x20f)](_0x27f370*0x64)/0x64+_0x1b39b2(0x271)),console[_0x1b39b2(0x1a1)](_0x1b39b2(0x257)+Math[_0x1b39b2(0x20f)](_0x5c2afc*0x64)/0x64+'\x20USDT'),console[_0x1b39b2(0x1a1)](_0x1b39b2(0x182)+Math[_0x1b39b2(0x20f)](_0x2a2064*0x64)/0x64+_0x1b39b2(0x2af)),{'merchants':_0x13d482,'pagination':{'page':_0xf42cfa,'limit':_0x4f6572,'total':_0x223bc8,'totalPages':Math[_0x1b39b2(0x166)](_0x223bc8/_0x4f6572)},'summary':{'totalMerchants':_0x223bc8,'totalAmountUSDT':Math[_0x1b39b2(0x20f)](_0x2b4e6b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1b39b2(0x20f)](_0x27f370*0x64)/0x64,'totalPayout':Math[_0x1b39b2(0x20f)](_0x5c2afc*0x64)/0x64,'thisMonth':Math[_0x1b39b2(0x20f)](_0x2a2064*0x64)/0x64}};}async[a38_0x51d73a(0x262)](_0x5b5da9){const _0x30a2eb=a38_0x51d73a,{shopId:_0x592b7c,amount:_0x41199e,network:_0x273501,wallet:_0x3b64ef,notes:_0x32d020,txid:_0x28609a,periodFrom:_0xb62701,periodTo:_0x524f58}=_0x5b5da9,_0x116866=await database_1[_0x30a2eb(0x1dd)]['$transaction'](async _0x33df32=>{const _0x48a1c3=_0x30a2eb,_0x19b2f1=await _0x33df32['shop'][_0x48a1c3(0x283)]({'where':{'id':_0x592b7c},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x19b2f1)throw new Error(_0x48a1c3(0x202));console['log'](_0x48a1c3(0x231)+_0x19b2f1[_0x48a1c3(0x291)]+':'),console[_0x48a1c3(0x1a1)](_0x48a1c3(0x259)+_0x19b2f1[_0x48a1c3(0x27a)][_0x48a1c3(0x2a3)](0x6)+'\x20USDT'),console['log'](_0x48a1c3(0x228)+_0x41199e[_0x48a1c3(0x2a3)](0x6)+_0x48a1c3(0x2af)),console[_0x48a1c3(0x1a1)](_0x48a1c3(0x265)+_0x19b2f1[_0x48a1c3(0x1cb)][_0x48a1c3(0x2a3)](0x6)+_0x48a1c3(0x2af));if(_0x28609a)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x28609a);const _0x432fa4=0.000001,_0x1b2e3e=Number(_0x19b2f1[_0x48a1c3(0x27a)]),_0x1b3a67=Number(_0x41199e);console[_0x48a1c3(0x1a1)]('🔍\x20Balance\x20check\x20details:'),console['log'](_0x48a1c3(0x1ff)+_0x19b2f1[_0x48a1c3(0x27a)]),console['log'](_0x48a1c3(0x25f)+_0x1b2e3e),console[_0x48a1c3(0x1a1)]('\x20\x20\x20Requested\x20(number):\x20'+_0x1b3a67),console[_0x48a1c3(0x1a1)]('\x20\x20\x20Difference:\x20'+(_0x1b2e3e-_0x1b3a67)),console[_0x48a1c3(0x1a1)](_0x48a1c3(0x226)+_0x432fa4);if(_0x1b2e3e<_0x1b3a67-_0x432fa4)throw new Error(_0x48a1c3(0x2b0)+_0x1b2e3e[_0x48a1c3(0x2a3)](0x6)+_0x48a1c3(0x23e)+_0x1b3a67['toFixed'](0x6)+_0x48a1c3(0x293)+(_0x1b2e3e-_0x1b3a67)[_0x48a1c3(0x2a3)](0x8)+_0x48a1c3(0x2af));console[_0x48a1c3(0x1a1)](_0x48a1c3(0x27b));const _0x347cec=Math['min'](_0x1b2e3e,_0x1b3a67);let _0x25ce5=_0x3b64ef;if(!_0x25ce5){const _0xb9bf94=await _0x33df32[_0x48a1c3(0x295)]['findUnique']({'where':{'id':_0x592b7c},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0xb9bf94)switch(_0x273501){case _0x48a1c3(0x1ae):_0x25ce5=_0xb9bf94[_0x48a1c3(0x27d)]||undefined;break;case _0x48a1c3(0x201):_0x25ce5=_0xb9bf94[_0x48a1c3(0x21d)]||undefined;break;case _0x48a1c3(0x233):_0x25ce5=_0xb9bf94['usdtErcWallet']||undefined;break;case _0x48a1c3(0x1a0):_0x25ce5=_0xb9bf94[_0x48a1c3(0x211)]||undefined;break;case _0x48a1c3(0x1f7):_0x25ce5=_0xb9bf94[_0x48a1c3(0x1a2)]||undefined;break;}}console['log'](_0x48a1c3(0x290)+_0x273501+':\x20'+(_0x25ce5||'not\x20specified'));const _0x5b824c=await _0x33df32[_0x48a1c3(0x1d7)][_0x48a1c3(0x247)]({'data':{'shopId':_0x592b7c,'amount':_0x347cec,'network':_0x273501,'status':'COMPLETED','txid':_0x28609a,'notes':_0x32d020,'periodFrom':_0xb62701?new Date(_0xb62701):null,'periodTo':_0x524f58?new Date(_0x524f58):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x46d795=_0x1b2e3e-_0x347cec,_0x3df6ba=Number(_0x19b2f1[_0x48a1c3(0x1cb)])+_0x347cec;return await _0x33df32['shop'][_0x48a1c3(0x236)]({'where':{'id':_0x592b7c},'data':{'balance':_0x46d795,'totalPaidOut':_0x3df6ba}}),console[_0x48a1c3(0x1a1)]('💰\x20Shop\x20'+_0x19b2f1['username']+_0x48a1c3(0x273)),console[_0x48a1c3(0x1a1)](_0x48a1c3(0x242)+_0x1b2e3e['toFixed'](0x6)+_0x48a1c3(0x275)+_0x46d795['toFixed'](0x6)+'\x20USDT\x20(-'+_0x347cec[_0x48a1c3(0x2a3)](0x6)+')'),console[_0x48a1c3(0x1a1)](_0x48a1c3(0x256)+_0x19b2f1[_0x48a1c3(0x1cb)]['toFixed'](0x6)+_0x48a1c3(0x275)+_0x3df6ba[_0x48a1c3(0x2a3)](0x6)+_0x48a1c3(0x23c)+_0x347cec[_0x48a1c3(0x2a3)](0x6)+')'),console[_0x48a1c3(0x1a1)](_0x48a1c3(0x1b5)+_0x347cec[_0x48a1c3(0x2a3)](0x6)+_0x48a1c3(0x2af)),{'payout':_0x5b824c,'shop':_0x19b2f1};});return console['log'](_0x30a2eb(0x198)+_0x116866[_0x30a2eb(0x1d7)]['id']+_0x30a2eb(0x17d)+_0x116866[_0x30a2eb(0x295)][_0x30a2eb(0x291)]+'\x20('+_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x21a)][_0x30a2eb(0x2a3)](0x6)+_0x30a2eb(0x240)),{'id':_0x116866['payout']['id'],'shopId':_0x116866[_0x30a2eb(0x1d7)]['shopId'],'shopName':_0x116866[_0x30a2eb(0x295)][_0x30a2eb(0x1b6)],'shopUsername':_0x116866['shop'][_0x30a2eb(0x291)],'amount':_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x21a)],'network':_0x116866['payout'][_0x30a2eb(0x1be)],'status':_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x177)],'txid':_0x116866[_0x30a2eb(0x1d7)]['txid'],'notes':_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x190)],'periodFrom':_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x1a9)],'periodTo':_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x1f9)],'createdAt':_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x225)],'paidAt':_0x116866[_0x30a2eb(0x1d7)][_0x30a2eb(0x214)]};}async[a38_0x51d73a(0x279)](_0x4c0182){const _0x2ad416=a38_0x51d73a,{page:_0x32a16d,limit:_0x18b68c,shopId:_0x331206,network:_0x5a2387,dateFrom:_0x566fe2,dateTo:_0x19479c,search:_0xa7e1a}=_0x4c0182,_0x588175=(_0x32a16d-0x1)*_0x18b68c,_0x43cbd2={};_0x331206&&(_0x43cbd2['shopId']=_0x331206);_0x5a2387&&(_0x43cbd2['network']=_0x5a2387);(_0x566fe2||_0x19479c)&&(_0x43cbd2['createdAt']={},_0x566fe2&&(_0x43cbd2[_0x2ad416(0x225)][_0x2ad416(0x237)]=new Date(_0x566fe2)),_0x19479c&&(_0x43cbd2[_0x2ad416(0x225)][_0x2ad416(0x1d0)]=new Date(_0x19479c)));_0xa7e1a&&(_0x43cbd2['OR']=[{'shop':{'name':{'contains':_0xa7e1a,'mode':_0x2ad416(0x28e)}}},{'shop':{'username':{'contains':_0xa7e1a,'mode':_0x2ad416(0x28e)}}},{'notes':{'contains':_0xa7e1a,'mode':_0x2ad416(0x28e)}}]);const [_0x4edbb8,_0x4472c3]=await Promise[_0x2ad416(0x1ef)]([database_1[_0x2ad416(0x1dd)]['payout'][_0x2ad416(0x200)]({'where':_0x43cbd2,'skip':_0x588175,'take':_0x18b68c,'orderBy':{'createdAt':_0x2ad416(0x22d)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout'][_0x2ad416(0x1a5)]({'where':_0x43cbd2})]);return{'payouts':_0x4edbb8[_0x2ad416(0x1af)](_0x2834a1=>({'id':_0x2834a1['id'],'shopId':_0x2834a1[_0x2ad416(0x222)],'shopName':_0x2834a1[_0x2ad416(0x295)]['name'],'shopUsername':_0x2834a1['shop'][_0x2ad416(0x291)],'amount':_0x2834a1['amount'],'network':_0x2834a1[_0x2ad416(0x1be)],'status':_0x2834a1[_0x2ad416(0x177)],'txid':_0x2834a1[_0x2ad416(0x29d)],'notes':_0x2834a1[_0x2ad416(0x190)],'periodFrom':_0x2834a1['periodFrom'],'periodTo':_0x2834a1[_0x2ad416(0x1f9)],'createdAt':_0x2834a1['createdAt'],'paidAt':_0x2834a1[_0x2ad416(0x214)]})),'pagination':{'page':_0x32a16d,'limit':_0x18b68c,'total':_0x4472c3,'totalPages':Math['ceil'](_0x4472c3/_0x18b68c)}};}async[a38_0x51d73a(0x272)](_0x50d00b){const _0x2ab38b=a38_0x51d73a,_0x397f8b=await database_1[_0x2ab38b(0x1dd)][_0x2ab38b(0x1d7)][_0x2ab38b(0x283)]({'where':{'id':_0x50d00b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x397f8b)return null;return{'id':_0x397f8b['id'],'shopId':_0x397f8b['shopId'],'shopName':_0x397f8b['shop'][_0x2ab38b(0x1b6)],'shopUsername':_0x397f8b[_0x2ab38b(0x295)][_0x2ab38b(0x291)],'amount':_0x397f8b['amount'],'network':_0x397f8b[_0x2ab38b(0x1be)],'status':_0x397f8b[_0x2ab38b(0x177)],'txid':_0x397f8b['txid'],'notes':_0x397f8b[_0x2ab38b(0x190)],'periodFrom':_0x397f8b[_0x2ab38b(0x1a9)],'periodTo':_0x397f8b[_0x2ab38b(0x1f9)],'createdAt':_0x397f8b[_0x2ab38b(0x225)],'paidAt':_0x397f8b['paidAt']};}async[a38_0x51d73a(0x2a4)](_0x2454b1){const _0xb49103=a38_0x51d73a;await database_1[_0xb49103(0x1dd)][_0xb49103(0x1d7)][_0xb49103(0x254)]({'where':{'id':_0x2454b1}});}async['getAllPayments'](_0x1d75c2){const _0x41b6e9=a38_0x51d73a,{page:_0x483c22,limit:_0x53a27c,status:_0x3fb5ce,gateway:_0x31211d,shopId:_0x451421,dateFrom:_0x1f459d,dateTo:_0x5c0634,search:_0xda6797,currency:_0x36aec7,sortBy:_0x4cc567,sortOrder:_0x1082e9}=_0x1d75c2,_0xa31646=(_0x483c22-0x1)*_0x53a27c;console[_0x41b6e9(0x1a1)](_0x41b6e9(0x1c4),_0x1d75c2);const _0x20785c=await database_1[_0x41b6e9(0x1dd)][_0x41b6e9(0x18e)][_0x41b6e9(0x284)]({'by':[_0x41b6e9(0x22b)],'_count':{'gateway':!![]}});console[_0x41b6e9(0x1a1)](_0x41b6e9(0x173),_0x20785c[_0x41b6e9(0x1af)](_0x1e678e=>_0x1e678e[_0x41b6e9(0x22b)]+'\x20('+_0x1e678e[_0x41b6e9(0x22e)][_0x41b6e9(0x22b)]+_0x41b6e9(0x1c9)));if(_0x31211d){const _0x37a39b=_0x20785c['some'](_0x34f8e7=>_0x34f8e7[_0x41b6e9(0x22b)]['toLowerCase']()===_0x31211d[_0x41b6e9(0x218)]());!_0x37a39b&&_0x31211d[_0x41b6e9(0x218)]()!==_0x41b6e9(0x264)&&console[_0x41b6e9(0x1a1)](_0x41b6e9(0x1ce)+_0x31211d+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x20785c['map'](_0x2e50c1=>_0x2e50c1[_0x41b6e9(0x22b)])['join'](',\x20'));}const _0x3f3263={};_0x3fb5ce&&(_0x3f3263[_0x41b6e9(0x177)]=_0x3fb5ce[_0x41b6e9(0x258)]());if(!_0x31211d)_0x3f3263[_0x41b6e9(0x22b)]={'not':_0x41b6e9(0x264)};else{if(_0x31211d&&(_0x31211d[_0x41b6e9(0x218)]()===_0x41b6e9(0x264)||_0x31211d===_0x41b6e9(0x1e6)))_0x3f3263[_0x41b6e9(0x22b)]=_0x41b6e9(0x264);else{let _0x2e2a24=_0x31211d;const _0x534047=(0x0,gateway_1[_0x41b6e9(0x297)])(_0x31211d);if(_0x534047)_0x2e2a24=_0x534047,console['log'](_0x41b6e9(0x274)+_0x31211d+'\x27\x20to\x20name\x20\x27'+_0x2e2a24+'\x27');else{const _0x215605=(0x0,gateway_1[_0x41b6e9(0x1db)])(_0x31211d);if(_0x215605){const _0x3b41d3=(0x0,gateway_1[_0x41b6e9(0x297)])(_0x215605);_0x3b41d3&&(_0x2e2a24=_0x3b41d3,console[_0x41b6e9(0x1a1)](_0x41b6e9(0x1d4)+_0x31211d+_0x41b6e9(0x18c)+_0x215605+'\x27\x20->\x20name\x20\x27'+_0x2e2a24+'\x27'));}else console[_0x41b6e9(0x1a1)](_0x41b6e9(0x277)+_0x31211d+_0x41b6e9(0x244));}const _0x2cf26d=await database_1[_0x41b6e9(0x1dd)][_0x41b6e9(0x18e)]['count']({'where':{'gateway':_0x2e2a24[_0x41b6e9(0x218)]()},'take':0x1});_0x2cf26d===0x0?(console[_0x41b6e9(0x1a1)](_0x41b6e9(0x1d2)+_0x2e2a24+_0x41b6e9(0x181)+_0x31211d+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x3f3263[_0x41b6e9(0x22b)]=_0x41b6e9(0x23a)):(_0x3f3263[_0x41b6e9(0x22b)]=_0x2e2a24[_0x41b6e9(0x218)](),console[_0x41b6e9(0x1a1)](_0x41b6e9(0x29a)+_0x2e2a24+_0x41b6e9(0x181)+_0x31211d+'\x27)'));}}console[_0x41b6e9(0x1a1)](_0x41b6e9(0x2a9),_0x3f3263[_0x41b6e9(0x22b)]);_0x451421&&(_0x3f3263[_0x41b6e9(0x222)]=_0x451421);_0x36aec7&&(_0x3f3263[_0x41b6e9(0x230)]=_0x36aec7[_0x41b6e9(0x258)](),console['log'](_0x41b6e9(0x215)+_0x36aec7[_0x41b6e9(0x258)]()));(_0x1f459d||_0x5c0634)&&(_0x3f3263[_0x41b6e9(0x225)]={},_0x1f459d&&(_0x3f3263[_0x41b6e9(0x225)][_0x41b6e9(0x237)]=new Date(_0x1f459d)),_0x5c0634&&(_0x3f3263[_0x41b6e9(0x225)][_0x41b6e9(0x1d0)]=new Date(_0x5c0634)));_0xda6797&&(_0x3f3263['OR']=[{'id':{'contains':_0xda6797,'mode':_0x41b6e9(0x28e)}},{'orderId':{'contains':_0xda6797,'mode':_0x41b6e9(0x28e)}},{'gatewayOrderId':{'contains':_0xda6797,'mode':_0x41b6e9(0x28e)}},{'customerEmail':{'contains':_0xda6797,'mode':_0x41b6e9(0x28e)}},{'shop':{'name':{'contains':_0xda6797,'mode':_0x41b6e9(0x28e)}}},{'shop':{'username':{'contains':_0xda6797,'mode':'insensitive'}}}]);console[_0x41b6e9(0x1a1)](_0x41b6e9(0x235),JSON[_0x41b6e9(0x261)](_0x3f3263,null,0x2));let _0x51ba42={'createdAt':_0x41b6e9(0x22d)};if(_0x4cc567){const _0x38ccef=['amount',_0x41b6e9(0x225),_0x41b6e9(0x17c),_0x41b6e9(0x177),_0x41b6e9(0x22b),_0x41b6e9(0x230)],_0x27acac=['asc',_0x41b6e9(0x22d)];if(_0x38ccef[_0x41b6e9(0x1ea)](_0x4cc567)){const _0x27481c=_0x27acac['includes'](_0x1082e9)?_0x1082e9:_0x41b6e9(0x22d);_0x51ba42={[_0x4cc567]:_0x27481c},console[_0x41b6e9(0x1a1)](_0x41b6e9(0x1d8)+_0x4cc567+'\x20in\x20'+_0x27481c+_0x41b6e9(0x1f8));}}const [_0x4d4a35,_0x2b1068]=await Promise[_0x41b6e9(0x1ef)]([database_1['default'][_0x41b6e9(0x18e)][_0x41b6e9(0x200)]({'where':_0x3f3263,'skip':_0xa31646,'take':_0x53a27c,'orderBy':_0x51ba42,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x41b6e9(0x1dd)]['payment'][_0x41b6e9(0x1a5)]({'where':_0x3f3263})]);return{'payments':_0x4d4a35,'pagination':{'page':_0x483c22,'limit':_0x53a27c,'total':_0x2b1068,'totalPages':Math['ceil'](_0x2b1068/_0x53a27c)}};}async[a38_0x51d73a(0x1b8)](_0x458838){const _0x311fb7=a38_0x51d73a,_0x332a35=await database_1[_0x311fb7(0x1dd)][_0x311fb7(0x18e)][_0x311fb7(0x283)]({'where':{'id':_0x458838},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x332a35)return null;return{'id':_0x332a35['id'],'shopId':_0x332a35[_0x311fb7(0x222)],'gateway':_0x332a35[_0x311fb7(0x22b)],'amount':_0x332a35['amount'],'currency':_0x332a35['currency'],'status':_0x332a35['status'],'orderId':_0x332a35[_0x311fb7(0x22c)],'gatewayOrderId':_0x332a35[_0x311fb7(0x1a7)],'customerEmail':_0x332a35['customerEmail'],'customerName':_0x332a35[_0x311fb7(0x1e8)],'customerCountry':_0x332a35[_0x311fb7(0x21e)],'customerIp':_0x332a35[_0x311fb7(0x19e)],'customerUa':_0x332a35[_0x311fb7(0x1b3)],'failureMessage':_0x332a35['failureMessage'],'externalPaymentUrl':_0x332a35[_0x311fb7(0x25c)],'successUrl':_0x332a35[_0x311fb7(0x285)],'failUrl':_0x332a35[_0x311fb7(0x204)],'pendingUrl':_0x332a35[_0x311fb7(0x288)],'whiteUrl':_0x332a35['whiteUrl'],'createdAt':_0x332a35['createdAt'],'updatedAt':_0x332a35['updatedAt'],'shop':_0x332a35['shop']};}async[a38_0x51d73a(0x2a8)](_0x124ed6,_0x109377,_0x3500cd,_0x5ebc56){const _0xc2c93f=a38_0x51d73a,_0x4150c2=await database_1['default'][_0xc2c93f(0x232)](async _0x5bd911=>{const _0x296a36=_0xc2c93f,_0x3b5972=await _0x5bd911[_0x296a36(0x18e)][_0x296a36(0x283)]({'where':{'id':_0x124ed6},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3b5972)throw new Error(_0x296a36(0x1f4));const _0xaa8226=_0x3b5972['status'],_0x2c3d3a=_0x109377[_0x296a36(0x258)]();console[_0x296a36(0x1a1)](_0x296a36(0x1dc)+_0x124ed6+_0x296a36(0x255)+_0xaa8226+_0x296a36(0x275)+_0x2c3d3a),console[_0x296a36(0x1a1)](_0x296a36(0x298)+_0x3b5972[_0x296a36(0x295)][_0x296a36(0x27a)]+_0x296a36(0x2af));const _0x51a9a2={'status':_0x2c3d3a,'updatedAt':new Date(),'statusChangedBy':_0x296a36(0x160),'statusChangedAt':new Date()};_0x3500cd&&(_0x51a9a2['adminNotes']=_0x3500cd);_0x2c3d3a===_0x296a36(0x1d5)&&_0x5ebc56&&(_0x51a9a2[_0x296a36(0x18a)]=_0x5ebc56);let _0x3fcb2f=0x0,_0x3324a6=_0x3b5972[_0x296a36(0x295)][_0x296a36(0x27a)];if(_0x2c3d3a===_0x296a36(0x24a)&&_0xaa8226!=='PAID'){_0x51a9a2[_0x296a36(0x214)]=new Date();const _0x3d4e7d=await currencyService_1[_0x296a36(0x1f3)][_0x296a36(0x210)](_0x3b5972[_0x296a36(0x21a)],_0x3b5972['currency']);_0x51a9a2[_0x296a36(0x25b)]=_0x3d4e7d;let _0x53cb34=0x2d;const _0x288cfb=await _0x5bd911[_0x296a36(0x295)]['findUnique']({'where':{'id':_0x3b5972[_0x296a36(0x222)]},'select':{'gatewaySettings':!![]}});if(_0x288cfb?.['gatewaySettings'])try{const _0x343df1=JSON['parse'](_0x288cfb[_0x296a36(0x16b)]);for(const [_0x2f8e49,_0x2b649c]of Object[_0x296a36(0x2ac)](_0x343df1)){if(_0x2f8e49[_0x296a36(0x218)]()===_0x3b5972['gateway'][_0x296a36(0x218)]()){_0x53cb34=_0x2b649c[_0x296a36(0x1d3)]||0xa;break;}}}catch(_0x445fee){console[_0x296a36(0x213)](_0x296a36(0x193)+_0x124ed6+':',_0x445fee);}let _0x5f042d;_0x3b5972[_0x296a36(0x2aa)]!==null&&_0x3b5972[_0x296a36(0x2aa)]!==undefined?(_0x5f042d=_0x3b5972['amountAfterGatewayCommissionUSDT'],console[_0x296a36(0x1a1)](_0x296a36(0x238)+_0x5f042d[_0x296a36(0x2a3)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x124ed6)):(_0x5f042d=_0x3d4e7d*(0x1-_0x53cb34/0x64),console[_0x296a36(0x1a1)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x124ed6+':\x20'+_0x53cb34+'%\x20from\x20'+_0x3d4e7d[_0x296a36(0x2a3)](0x6)+_0x296a36(0x2af)),_0x51a9a2[_0x296a36(0x2aa)]=_0x5f042d,_0x51a9a2[_0x296a36(0x280)]=_0x53cb34),_0x3fcb2f=_0x5f042d,_0x3324a6+=_0x5f042d,console[_0x296a36(0x1a1)](_0x296a36(0x269)+_0x124ed6+_0x296a36(0x26f)),console[_0x296a36(0x1a1)](_0x296a36(0x2b3)+_0x3d4e7d['toFixed'](0x6)+_0x296a36(0x2af)),console[_0x296a36(0x1a1)](_0x296a36(0x165)+_0x3b5972['gateway']+',\x20Commission:\x20'+_0x53cb34+'%'),console[_0x296a36(0x1a1)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x5f042d[_0x296a36(0x2a3)](0x6)+_0x296a36(0x20c)+_0x53cb34+'%\x20commission)'),console['log'](_0x296a36(0x2a2)+_0x5f042d[_0x296a36(0x2a3)](0x6)+_0x296a36(0x2af));}else{if(_0xaa8226===_0x296a36(0x24a)&&_0x2c3d3a!=='PAID'&&_0x2c3d3a!==_0x296a36(0x1d5)){if(_0x3b5972[_0x296a36(0x25b)]){let _0x38a355=0x2d;const _0x20a538=await _0x5bd911[_0x296a36(0x295)]['findUnique']({'where':{'id':_0x3b5972['shopId']},'select':{'gatewaySettings':!![]}});if(_0x20a538?.[_0x296a36(0x16b)])try{const _0x324c78=JSON[_0x296a36(0x1bd)](_0x20a538['gatewaySettings']);for(const [_0x12ff09,_0x1654ca]of Object[_0x296a36(0x2ac)](_0x324c78)){if(_0x12ff09['toLowerCase']()===_0x3b5972[_0x296a36(0x22b)]['toLowerCase']()){_0x38a355=_0x1654ca[_0x296a36(0x1d3)]||0xa;break;}}}catch(_0xd9296){console[_0x296a36(0x213)](_0x296a36(0x193)+_0x124ed6+':',_0xd9296);}const _0x332d56=_0x3b5972[_0x296a36(0x25b)]*(0x1-_0x38a355/0x64);_0x3fcb2f=-_0x332d56,_0x3324a6-=_0x332d56,console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x3b5972[_0x296a36(0x25b)][_0x296a36(0x2a3)](0x6)+_0x296a36(0x2af)),console[_0x296a36(0x1a1)](_0x296a36(0x165)+_0x3b5972[_0x296a36(0x22b)]+_0x296a36(0x178)+_0x38a355+'%'),console[_0x296a36(0x1a1)](_0x296a36(0x1c6)+_0x332d56['toFixed'](0x6)+_0x296a36(0x20c)+_0x38a355+_0x296a36(0x17a)),console[_0x296a36(0x1a1)](_0x296a36(0x188)+_0x332d56[_0x296a36(0x2a3)](0x6)+'\x20USDT');}}}_0x2c3d3a===_0x296a36(0x1d5)&&(console[_0x296a36(0x1a1)](_0x296a36(0x187)),_0x5ebc56&&_0x5ebc56>0x0?(_0x3fcb2f=-_0x5ebc56,_0x3324a6-=_0x5ebc56,console[_0x296a36(0x1a1)](_0x296a36(0x189)+_0x5ebc56['toFixed'](0x6)+_0x296a36(0x20b)),console[_0x296a36(0x1a1)](_0x296a36(0x289))):console['log'](_0x296a36(0x1c1)),_0x51a9a2[_0x296a36(0x18a)]=_0x5ebc56||0x0);_0x2c3d3a==='REFUND'&&_0xaa8226==='PAID'&&console[_0x296a36(0x1a1)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x4c73f4=await _0x5bd911[_0x296a36(0x18e)]['update']({'where':{'id':_0x124ed6},'data':_0x51a9a2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3fcb2f!==0x0&&(await _0x5bd911['shop'][_0x296a36(0x236)]({'where':{'id':_0x3b5972[_0x296a36(0x222)]},'data':{'balance':_0x3324a6}}),console['log'](_0x296a36(0x19a)+_0x3b5972[_0x296a36(0x222)]+_0x296a36(0x29f)+_0x3b5972[_0x296a36(0x295)][_0x296a36(0x27a)]['toFixed'](0x6)+'\x20->\x20'+_0x3324a6[_0x296a36(0x2a3)](0x6)+_0x296a36(0x2a5)+(_0x3fcb2f>0x0?'+':'')+_0x3fcb2f[_0x296a36(0x2a3)](0x6)+')')),_0x4c73f4;});return{'id':_0x4150c2['id'],'shopId':_0x4150c2['shopId'],'gateway':_0x4150c2[_0xc2c93f(0x22b)],'amount':_0x4150c2[_0xc2c93f(0x21a)],'currency':_0x4150c2['currency'],'status':_0x4150c2[_0xc2c93f(0x177)],'orderId':_0x4150c2[_0xc2c93f(0x22c)],'gatewayOrderId':_0x4150c2[_0xc2c93f(0x1a7)],'customerEmail':_0x4150c2[_0xc2c93f(0x260)],'customerName':_0x4150c2['customerName'],'customerCountry':_0x4150c2[_0xc2c93f(0x21e)],'customerIp':_0x4150c2[_0xc2c93f(0x19e)],'customerUa':_0x4150c2['customerUa'],'failureMessage':_0x4150c2['failureMessage'],'adminNotes':_0x4150c2[_0xc2c93f(0x27e)],'chargebackAmount':_0x4150c2[_0xc2c93f(0x18a)],'statusChangedBy':_0x4150c2[_0xc2c93f(0x26d)],'statusChangedAt':_0x4150c2[_0xc2c93f(0x21c)],'createdAt':_0x4150c2[_0xc2c93f(0x225)],'updatedAt':_0x4150c2[_0xc2c93f(0x17c)],'shop':_0x4150c2[_0xc2c93f(0x295)]};}async['updateUser'](_0x6cd97e,_0x3d5404){const _0x1ef363=a38_0x51d73a,_0x476746=Math[_0x1ef363(0x1a3)]()[_0x1ef363(0x1b1)](0x24)[_0x1ef363(0x1e1)](0x2,0x9);console[_0x1ef363(0x1a1)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x476746+',\x20userId:\x20'+_0x6cd97e);const _0x1206fe={..._0x3d5404};_0x3d5404[_0x1ef363(0x28d)]&&_0x3d5404[_0x1ef363(0x28d)][_0x1ef363(0x20e)]()!==''?(console[_0x1ef363(0x1a1)](_0x1ef363(0x1da)+_0x476746+_0x1ef363(0x29b)+_0x6cd97e),_0x1206fe[_0x1ef363(0x28d)]=await bcryptjs_1[_0x1ef363(0x1dd)][_0x1ef363(0x28c)](_0x3d5404['password'],0xc)):(console['log'](_0x1ef363(0x1da)+_0x476746+_0x1ef363(0x276)),delete _0x1206fe[_0x1ef363(0x28d)]);_0x3d5404[_0x1ef363(0x161)]&&(_0x1206fe[_0x1ef363(0x1b6)]=_0x3d5404[_0x1ef363(0x161)],delete _0x1206fe[_0x1ef363(0x161)]);_0x3d5404[_0x1ef363(0x286)]&&(_0x1206fe[_0x1ef363(0x1bf)]=_0x3d5404[_0x1ef363(0x286)],delete _0x1206fe[_0x1ef363(0x286)]);_0x3d5404[_0x1ef363(0x27f)]&&(_0x1206fe[_0x1ef363(0x1e5)]=_0x3d5404[_0x1ef363(0x27f)],delete _0x1206fe['merchantUrl']);if(_0x3d5404[_0x1ef363(0x24b)]){const _0x15e2e3=_0x3d5404['gateways'][_0x1ef363(0x1af)](_0x20fdc8=>this[_0x1ef363(0x1aa)](_0x20fdc8));console['log'](_0x1ef363(0x22f),_0x3d5404[_0x1ef363(0x24b)],'->',_0x15e2e3),_0x1206fe[_0x1ef363(0x24f)]=JSON[_0x1ef363(0x261)](_0x15e2e3),delete _0x1206fe['gateways'];}_0x3d5404[_0x1ef363(0x16b)]&&(console[_0x1ef363(0x1a1)](_0x1ef363(0x221)+_0x476746+_0x1ef363(0x243),_0x3d5404[_0x1ef363(0x16b)]),_0x1206fe['gatewaySettings']=JSON[_0x1ef363(0x261)](_0x3d5404[_0x1ef363(0x16b)]),console[_0x1ef363(0x1a1)](_0x1ef363(0x221)+_0x476746+_0x1ef363(0x1d6),_0x1206fe[_0x1ef363(0x16b)]));_0x3d5404[_0x1ef363(0x2a1)]&&(_0x3d5404['wallets'][_0x1ef363(0x27d)]!==undefined&&(_0x1206fe[_0x1ef363(0x27d)]=_0x3d5404['wallets'][_0x1ef363(0x27d)]||null),_0x3d5404[_0x1ef363(0x2a1)]['usdtTrcWallet']!==undefined&&(_0x1206fe[_0x1ef363(0x21d)]=_0x3d5404[_0x1ef363(0x2a1)][_0x1ef363(0x21d)]||null),_0x3d5404[_0x1ef363(0x2a1)][_0x1ef363(0x1ed)]!==undefined&&(_0x1206fe[_0x1ef363(0x1ed)]=_0x3d5404[_0x1ef363(0x2a1)][_0x1ef363(0x1ed)]||null),_0x3d5404[_0x1ef363(0x2a1)][_0x1ef363(0x211)]!==undefined&&(_0x1206fe[_0x1ef363(0x211)]=_0x3d5404['wallets'][_0x1ef363(0x211)]||null),delete _0x1206fe[_0x1ef363(0x2a1)]);const _0x5722e2=await database_1['default'][_0x1ef363(0x295)]['update']({'where':{'id':_0x6cd97e},'data':_0x1206fe,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x1ef363(0x1a1)](_0x1ef363(0x1b0)+_0x476746+_0x1ef363(0x1e2),_0x5722e2['gatewaySettings']),{'id':_0x5722e2['id'],'fullName':_0x5722e2[_0x1ef363(0x1b6)],'username':_0x5722e2[_0x1ef363(0x291)],'telegramId':_0x5722e2[_0x1ef363(0x1bf)],'merchantUrl':_0x5722e2['shopUrl'],'gateways':_0x5722e2['paymentGateways']?JSON['parse'](_0x5722e2['paymentGateways']):null,'gatewaySettings':_0x5722e2[_0x1ef363(0x16b)]?JSON[_0x1ef363(0x1bd)](_0x5722e2[_0x1ef363(0x16b)]):null,'publicKey':_0x5722e2[_0x1ef363(0x270)],'wallets':{'usdtPolygonWallet':_0x5722e2['usdtPolygonWallet'],'usdtTrcWallet':_0x5722e2['usdtTrcWallet'],'usdtErcWallet':_0x5722e2[_0x1ef363(0x1ed)],'usdcPolygonWallet':_0x5722e2[_0x1ef363(0x211)]},'status':_0x5722e2[_0x1ef363(0x177)],'createdAt':_0x5722e2[_0x1ef363(0x225)]};}async[a38_0x51d73a(0x195)](_0x41ea0e){const _0x46e4fd=a38_0x51d73a,_0x491069=await database_1['default'][_0x46e4fd(0x295)][_0x46e4fd(0x236)]({'where':{'id':_0x41ea0e},'data':{'status':_0x46e4fd(0x292)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x491069['id'],'fullName':_0x491069[_0x46e4fd(0x1b6)],'username':_0x491069[_0x46e4fd(0x291)],'telegramId':_0x491069[_0x46e4fd(0x1bf)],'merchantUrl':_0x491069['shopUrl'],'gateways':_0x491069['paymentGateways']?JSON[_0x46e4fd(0x1bd)](_0x491069[_0x46e4fd(0x24f)]):null,'gatewaySettings':_0x491069[_0x46e4fd(0x16b)]?JSON[_0x46e4fd(0x1bd)](_0x491069[_0x46e4fd(0x16b)]):null,'publicKey':_0x491069['publicKey'],'wallets':{'usdtPolygonWallet':_0x491069[_0x46e4fd(0x27d)],'usdtTrcWallet':_0x491069['usdtTrcWallet'],'usdtErcWallet':_0x491069[_0x46e4fd(0x1ed)],'usdcPolygonWallet':_0x491069[_0x46e4fd(0x211)]},'status':_0x491069[_0x46e4fd(0x177)],'createdAt':_0x491069[_0x46e4fd(0x225)]};}async['activateUser'](_0x322491){const _0x48c669=a38_0x51d73a,_0x327d2e=await database_1['default']['shop'][_0x48c669(0x236)]({'where':{'id':_0x322491},'data':{'status':_0x48c669(0x1e7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x327d2e['id'],'fullName':_0x327d2e[_0x48c669(0x1b6)],'username':_0x327d2e['username'],'telegramId':_0x327d2e[_0x48c669(0x1bf)],'merchantUrl':_0x327d2e[_0x48c669(0x1e5)],'gateways':_0x327d2e[_0x48c669(0x24f)]?JSON[_0x48c669(0x1bd)](_0x327d2e[_0x48c669(0x24f)]):null,'gatewaySettings':_0x327d2e[_0x48c669(0x16b)]?JSON['parse'](_0x327d2e['gatewaySettings']):null,'publicKey':_0x327d2e['publicKey'],'wallets':{'usdtPolygonWallet':_0x327d2e[_0x48c669(0x27d)],'usdtTrcWallet':_0x327d2e['usdtTrcWallet'],'usdtErcWallet':_0x327d2e[_0x48c669(0x1ed)],'usdcPolygonWallet':_0x327d2e[_0x48c669(0x211)]},'status':_0x327d2e[_0x48c669(0x177)],'createdAt':_0x327d2e['createdAt']};}async[a38_0x51d73a(0x20a)](_0x2ee029){const _0x466916=a38_0x51d73a,{page:_0x5c1011,limit:_0x168035,status:_0x3ab9c0}=_0x2ee029,_0x3301f1=(_0x5c1011-0x1)*_0x168035,_0x508ea8={};_0x3ab9c0&&(_0x508ea8[_0x466916(0x177)]=_0x3ab9c0[_0x466916(0x258)]());const [_0x1eb498,_0xfe794]=await Promise[_0x466916(0x1ef)]([database_1['default']['shop'][_0x466916(0x200)]({'where':_0x508ea8,'skip':_0x3301f1,'take':_0x168035,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x466916(0x1dd)][_0x466916(0x295)][_0x466916(0x1a5)]({'where':_0x508ea8})]);return{'users':_0x1eb498[_0x466916(0x1af)](_0x3f8e54=>{const _0x51f8eb=_0x466916,_0x35ab6c=_0x3f8e54['paymentGateways']?JSON[_0x51f8eb(0x1bd)](_0x3f8e54[_0x51f8eb(0x24f)]):null,_0x5617eb=_0x35ab6c?_0x35ab6c[_0x51f8eb(0x1af)](_0x1c497e=>this[_0x51f8eb(0x1a6)](_0x1c497e)):null;return{'id':_0x3f8e54['id'],'fullName':_0x3f8e54[_0x51f8eb(0x1b6)],'username':_0x3f8e54['username'],'telegramId':_0x3f8e54['telegram'],'merchantUrl':_0x3f8e54[_0x51f8eb(0x1e5)],'gateways':_0x5617eb,'gatewaySettings':_0x3f8e54[_0x51f8eb(0x16b)]?JSON[_0x51f8eb(0x1bd)](_0x3f8e54[_0x51f8eb(0x16b)]):null,'publicKey':_0x3f8e54['publicKey'],'wallets':{'usdtPolygonWallet':_0x3f8e54['usdtPolygonWallet'],'usdtTrcWallet':_0x3f8e54[_0x51f8eb(0x21d)],'usdtErcWallet':_0x3f8e54['usdtErcWallet'],'usdcPolygonWallet':_0x3f8e54[_0x51f8eb(0x211)]},'status':_0x3f8e54[_0x51f8eb(0x177)],'createdAt':_0x3f8e54[_0x51f8eb(0x225)]};}),'pagination':{'page':_0x5c1011,'limit':_0x168035,'total':_0xfe794,'totalPages':Math[_0x466916(0x166)](_0xfe794/_0x168035)}};}async[a38_0x51d73a(0x172)](_0x10e600){const _0x2f78a4=a38_0x51d73a,_0x1fb884=await database_1[_0x2f78a4(0x1dd)]['shop'][_0x2f78a4(0x283)]({'where':{'id':_0x10e600},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1fb884)return null;const _0x534b5b=_0x1fb884[_0x2f78a4(0x24f)]?JSON[_0x2f78a4(0x1bd)](_0x1fb884[_0x2f78a4(0x24f)]):null,_0x53a02c=_0x534b5b?_0x534b5b[_0x2f78a4(0x1af)](_0x149020=>this[_0x2f78a4(0x1a6)](_0x149020)):null;return _0x534b5b&&_0x53a02c&&console['log']('🔄\x20Gateway\x20mapping\x20(get):',_0x534b5b,'->',_0x53a02c),{'id':_0x1fb884['id'],'fullName':_0x1fb884['name'],'username':_0x1fb884['username'],'telegramId':_0x1fb884['telegram'],'merchantUrl':_0x1fb884[_0x2f78a4(0x1e5)],'gateways':_0x53a02c,'gatewaySettings':_0x1fb884['gatewaySettings']?JSON[_0x2f78a4(0x1bd)](_0x1fb884[_0x2f78a4(0x16b)]):null,'publicKey':_0x1fb884['publicKey'],'wallets':{'usdtPolygonWallet':_0x1fb884['usdtPolygonWallet'],'usdtTrcWallet':_0x1fb884[_0x2f78a4(0x21d)],'usdtErcWallet':_0x1fb884[_0x2f78a4(0x1ed)],'usdcPolygonWallet':_0x1fb884[_0x2f78a4(0x211)]},'status':_0x1fb884['status'],'createdAt':_0x1fb884[_0x2f78a4(0x225)]};}async[a38_0x51d73a(0x299)](_0x13c299){const _0x1f5c98=a38_0x51d73a,{fullName:_0x4896ea,username:_0x132090,password:_0x491fed,telegramId:_0xc1199e,merchantUrl:_0x2d5d9d,gateways:_0x8c13d1,gatewaySettings:_0x4a2374,wallets:_0x6c1614}=_0x13c299,_0x4b3681=await database_1['default'][_0x1f5c98(0x295)][_0x1f5c98(0x283)]({'where':{'username':_0x132090}});if(_0x4b3681)throw new Error(_0x1f5c98(0x208));if(_0xc1199e){const _0x1d627d=await database_1['default'][_0x1f5c98(0x295)][_0x1f5c98(0x283)]({'where':{'telegram':_0xc1199e}});if(_0x1d627d)throw new Error(_0x1f5c98(0x1ab));}const _0x4a023c=await bcryptjs_1[_0x1f5c98(0x1dd)][_0x1f5c98(0x28c)](_0x491fed,0xc),_0x593512=_0x1f5c98(0x183)+crypto_1[_0x1f5c98(0x1dd)][_0x1f5c98(0x1f5)](0x20)['toString'](_0x1f5c98(0x278)),_0x1b3ed9='sk_'+crypto_1[_0x1f5c98(0x1dd)][_0x1f5c98(0x1f5)](0x20)[_0x1f5c98(0x1b1)](_0x1f5c98(0x278)),_0x1462d9=_0x8c13d1?_0x8c13d1['map'](_0x597e35=>this[_0x1f5c98(0x1aa)](_0x597e35)):null;_0x8c13d1&&_0x1462d9&&console[_0x1f5c98(0x1a1)](_0x1f5c98(0x167),_0x8c13d1,'->',_0x1462d9);const _0x23bbb0=await database_1['default'][_0x1f5c98(0x295)][_0x1f5c98(0x247)]({'data':{'name':_0x4896ea,'username':_0x132090,'password':_0x4a023c,'telegram':_0xc1199e,'shopUrl':_0x2d5d9d,'paymentGateways':_0x1462d9?JSON[_0x1f5c98(0x261)](_0x1462d9):null,'gatewaySettings':_0x4a2374?JSON[_0x1f5c98(0x261)](_0x4a2374):null,'usdtPolygonWallet':_0x6c1614?.[_0x1f5c98(0x27d)]||null,'usdtTrcWallet':_0x6c1614?.[_0x1f5c98(0x21d)]||null,'usdtErcWallet':_0x6c1614?.[_0x1f5c98(0x1ed)]||null,'usdcPolygonWallet':_0x6c1614?.[_0x1f5c98(0x211)]||null,'publicKey':_0x593512,'secretKey':_0x1b3ed9,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x23bbb0['id'],'fullName':_0x23bbb0[_0x1f5c98(0x1b6)],'username':_0x23bbb0[_0x1f5c98(0x291)],'telegramId':_0x23bbb0[_0x1f5c98(0x1bf)],'merchantUrl':_0x23bbb0[_0x1f5c98(0x1e5)],'gateways':_0x23bbb0['paymentGateways']?JSON[_0x1f5c98(0x1bd)](_0x23bbb0[_0x1f5c98(0x24f)]):null,'gatewaySettings':_0x23bbb0[_0x1f5c98(0x16b)]?JSON[_0x1f5c98(0x1bd)](_0x23bbb0[_0x1f5c98(0x16b)]):null,'publicKey':_0x23bbb0[_0x1f5c98(0x270)],'wallets':{'usdtPolygonWallet':_0x23bbb0[_0x1f5c98(0x27d)],'usdtTrcWallet':_0x23bbb0[_0x1f5c98(0x21d)],'usdtErcWallet':_0x23bbb0[_0x1f5c98(0x1ed)],'usdcPolygonWallet':_0x23bbb0[_0x1f5c98(0x211)]},'status':_0x23bbb0[_0x1f5c98(0x177)],'createdAt':_0x23bbb0['createdAt']};}async['deleteUser'](_0x5a4af1){const _0x58e215=a38_0x51d73a;await database_1[_0x58e215(0x1dd)]['shop'][_0x58e215(0x254)]({'where':{'id':_0x5a4af1}});}[a38_0x51d73a(0x1fe)](_0x247abf,_0x5d2694,_0xff93a2){const _0x16a1b6=a38_0x51d73a,_0x27c338=new Map(),_0x26ca21=new Date(_0x5d2694);while(_0x26ca21<=_0xff93a2){const _0x4eb310=_0x26ca21[_0x16a1b6(0x176)]()[_0x16a1b6(0x1a8)]('T')[0x0];_0x27c338[_0x16a1b6(0x216)](_0x4eb310,{'revenue':0x0,'count':0x0}),_0x26ca21[_0x16a1b6(0x250)](_0x26ca21[_0x16a1b6(0x1df)]()+0x1);}for(const _0x4c0589 of _0x247abf){const _0x570b6f=_0x4c0589['createdAt'][_0x16a1b6(0x176)]()[_0x16a1b6(0x1a8)]('T')[0x0],_0x3b4d31=_0x27c338[_0x16a1b6(0x171)](_0x570b6f);_0x3b4d31&&(_0x3b4d31[_0x16a1b6(0x1a5)]+=0x1,_0x4c0589[_0x16a1b6(0x177)]==='PAID'&&(_0x4c0589[_0x16a1b6(0x25b)]?_0x3b4d31[_0x16a1b6(0x2b1)]+=_0x4c0589[_0x16a1b6(0x25b)]:console[_0x16a1b6(0x1a1)](_0x16a1b6(0x203)+_0x4c0589['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x4231cc=[],_0x4a68ae=[];for(const [_0x45577a,_0x15653e]of _0x27c338){_0x4231cc[_0x16a1b6(0x1fd)]({'date':_0x45577a,'amount':Math['round'](_0x15653e[_0x16a1b6(0x2b1)]*0x64)/0x64}),_0x4a68ae[_0x16a1b6(0x1fd)]({'date':_0x45577a,'count':_0x15653e[_0x16a1b6(0x1a5)]});}return{'dailyRevenue':_0x4231cc,'dailyPayments':_0x4a68ae};}}exports[a38_0x51d73a(0x227)]=AdminService;