'use strict';function a33_0x5143(_0x550c36,_0x4610ae){const _0x5006d1=a33_0x5006();return a33_0x5143=function(_0x514311,_0x176268){_0x514311=_0x514311-0xfc;let _0x5626c6=_0x5006d1[_0x514311];return _0x5626c6;},a33_0x5143(_0x550c36,_0x4610ae);}const a33_0x1766bb=a33_0x5143;(function(_0x1fe899,_0x5d10d6){const _0x3ecdf1=a33_0x5143,_0x2be8bb=_0x1fe899();while(!![]){try{const _0x8e2359=-parseInt(_0x3ecdf1(0x12f))/0x1+parseInt(_0x3ecdf1(0x10f))/0x2+parseInt(_0x3ecdf1(0x199))/0x3*(-parseInt(_0x3ecdf1(0x19d))/0x4)+parseInt(_0x3ecdf1(0x15f))/0x5*(-parseInt(_0x3ecdf1(0x149))/0x6)+parseInt(_0x3ecdf1(0x1ab))/0x7+-parseInt(_0x3ecdf1(0x181))/0x8+parseInt(_0x3ecdf1(0x121))/0x9*(parseInt(_0x3ecdf1(0x155))/0xa);if(_0x8e2359===_0x5d10d6)break;else _0x2be8bb['push'](_0x2be8bb['shift']());}catch(_0x51583c){_0x2be8bb['push'](_0x2be8bb['shift']());}}}(a33_0x5006,0xcc9d2));var __importDefault=this&&this[a33_0x1766bb(0x114)]||function(_0x5933e8){const _0x3ee847=a33_0x1766bb;return _0x5933e8&&_0x5933e8[_0x3ee847(0x188)]?_0x5933e8:{'default':_0x5933e8};};Object[a33_0x1766bb(0x11c)](exports,a33_0x1766bb(0x188),{'value':!![]}),exports[a33_0x1766bb(0x179)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a33_0x1766bb(0x16d))),crypto_1=__importDefault(require(a33_0x1766bb(0x120))),currencyService_1=require('./currencyService');class AdminService{async[a33_0x1766bb(0x151)](_0x57e3fb){const _0x1fea8e=a33_0x1766bb;console[_0x1fea8e(0x162)](_0x1fea8e(0x12d),_0x57e3fb);let _0x1a4491,_0x1a805f;const _0x1e349b=new Date();switch(_0x57e3fb[_0x1fea8e(0x16c)]){case _0x1fea8e(0x122):_0x1a4491=new Date(_0x1fea8e(0x12c)),_0x1a805f=_0x1e349b;break;case _0x1fea8e(0x190):_0x1a4491=new Date(_0x1e349b['getFullYear'](),0x0,0x1),_0x1a805f=_0x1e349b;break;case _0x1fea8e(0x17b):_0x1a4491=new Date(_0x1e349b['getFullYear'](),_0x1e349b['getMonth'](),0x1),_0x1a805f=_0x1e349b;break;case _0x1fea8e(0x138):const _0x3908b9=new Date(_0x1e349b);_0x3908b9[_0x1fea8e(0x184)](_0x1e349b[_0x1fea8e(0x110)]()-_0x1e349b[_0x1fea8e(0x174)]()),_0x3908b9[_0x1fea8e(0x115)](0x0,0x0,0x0,0x0),_0x1a4491=_0x3908b9,_0x1a805f=_0x1e349b;break;case _0x1fea8e(0x111):if(!_0x57e3fb['dateFrom']||!_0x57e3fb['dateTo'])throw new Error(_0x1fea8e(0x172));_0x1a4491=new Date(_0x57e3fb[_0x1fea8e(0x105)]),_0x1a805f=new Date(_0x57e3fb['dateTo']);break;default:_0x1a4491=new Date(_0x1e349b[_0x1fea8e(0x11e)](),_0x1e349b[_0x1fea8e(0x130)](),0x1),_0x1a805f=_0x1e349b;break;}console['log'](_0x1fea8e(0x185)+_0x1a4491[_0x1fea8e(0x1a8)]()+'\x20-\x20'+_0x1a805f['toISOString']());const _0x2a46cf={'status':_0x1fea8e(0xfc),'paidAt':{'gte':_0x1a4491,'lte':_0x1a805f}};_0x57e3fb['shopId']&&(_0x2a46cf['shopId']=_0x57e3fb[_0x1fea8e(0x17a)]);const _0x2c6f2c=await database_1['default'][_0x1fea8e(0x166)]['findMany']({'where':_0x2a46cf,'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x1fea8e(0x162)](_0x1fea8e(0x136)+_0x2c6f2c[_0x1fea8e(0x133)]+_0x1fea8e(0x129));const _0x1b6720={'status':_0x1fea8e(0x189),'paidAt':{'gte':_0x1a4491,'lte':_0x1a805f}};_0x57e3fb[_0x1fea8e(0x17a)]&&(_0x1b6720[_0x1fea8e(0x17a)]=_0x57e3fb[_0x1fea8e(0x17a)]);const _0x5f3dd9=await database_1[_0x1fea8e(0x126)][_0x1fea8e(0x13e)][_0x1fea8e(0x159)]({'where':_0x1b6720,'select':{'shopId':!![],'amount':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x1fea8e(0x162)](_0x1fea8e(0x13d)+_0x5f3dd9[_0x1fea8e(0x133)]+_0x1fea8e(0x18b));let _0x8a24f7=0x0,_0x53cd8a=0x0;const _0x257611={},_0x3a59df={},_0x1b5ec1={};for(const _0x10c0ed of _0x2c6f2c){const _0x4ab672=await currencyService_1[_0x1fea8e(0x14b)]['convertToUSDT'](_0x10c0ed[_0x1fea8e(0x1ac)],_0x10c0ed['currency']);_0x8a24f7+=_0x4ab672;let _0xdd008=0xa;if(_0x10c0ed['shop'][_0x1fea8e(0x106)])try{const _0x391c09=JSON[_0x1fea8e(0x15c)](_0x10c0ed[_0x1fea8e(0x161)]['gatewaySettings']),_0x391d66=this[_0x1fea8e(0x15b)](_0x10c0ed[_0x1fea8e(0x11b)]);_0x391c09[_0x391d66]?.['commission']!==undefined&&(_0xdd008=_0x391c09[_0x391d66][_0x1fea8e(0x112)]);}catch(_0x338d8d){console['error'](_0x1fea8e(0x173),_0x338d8d);}const _0x98b38b=_0x4ab672*(_0xdd008/0x64),_0x59fcd5=_0x4ab672-_0x98b38b;_0x53cd8a+=_0x98b38b;!_0x257611[_0x10c0ed[_0x1fea8e(0x11b)]]&&(_0x257611[_0x10c0ed[_0x1fea8e(0x11b)]]={'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0,'paymentsWithCommission':0x0});_0x257611[_0x10c0ed['gateway']][_0x1fea8e(0x132)]++,_0x257611[_0x10c0ed['gateway']][_0x1fea8e(0x153)]+=_0x4ab672,_0x257611[_0x10c0ed[_0x1fea8e(0x11b)]][_0x1fea8e(0x134)]+=_0x98b38b,_0x257611[_0x10c0ed[_0x1fea8e(0x11b)]]['merchantEarningsUSDT']+=_0x59fcd5,_0x257611[_0x10c0ed[_0x1fea8e(0x11b)]]['totalCommissionRate']+=_0xdd008,_0x257611[_0x10c0ed[_0x1fea8e(0x11b)]]['paymentsWithCommission']++;!_0x57e3fb[_0x1fea8e(0x17a)]&&(!_0x3a59df[_0x10c0ed[_0x1fea8e(0x17a)]]&&(_0x3a59df[_0x10c0ed[_0x1fea8e(0x17a)]]={'shopId':_0x10c0ed[_0x1fea8e(0x17a)],'shopName':_0x10c0ed[_0x1fea8e(0x161)][_0x1fea8e(0x17c)],'shopUsername':_0x10c0ed[_0x1fea8e(0x161)][_0x1fea8e(0x14e)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3a59df[_0x10c0ed[_0x1fea8e(0x17a)]][_0x1fea8e(0x132)]++,_0x3a59df[_0x10c0ed[_0x1fea8e(0x17a)]][_0x1fea8e(0x153)]+=_0x4ab672,_0x3a59df[_0x10c0ed[_0x1fea8e(0x17a)]][_0x1fea8e(0x134)]+=_0x98b38b,_0x3a59df[_0x10c0ed[_0x1fea8e(0x17a)]][_0x1fea8e(0x128)]+=_0x59fcd5);const _0x158dad=_0x10c0ed[_0x1fea8e(0x187)][_0x1fea8e(0x1a8)]()[_0x1fea8e(0x169)]('T')[0x0];!_0x1b5ec1[_0x158dad]&&(_0x1b5ec1[_0x158dad]={'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1b5ec1[_0x158dad][_0x1fea8e(0x146)]+=_0x4ab672,_0x1b5ec1[_0x158dad][_0x1fea8e(0x11f)]+=_0x59fcd5,_0x1b5ec1[_0x158dad][_0x1fea8e(0x182)]+=_0x98b38b,_0x1b5ec1[_0x158dad][_0x1fea8e(0x132)]++;}let _0x3b822b=0x0;const _0x220f25={};for(const _0x43ee39 of _0x5f3dd9){_0x3b822b+=_0x43ee39[_0x1fea8e(0x1ac)],!_0x220f25[_0x43ee39[_0x1fea8e(0x17a)]]&&(_0x220f25[_0x43ee39[_0x1fea8e(0x17a)]]=0x0),_0x220f25[_0x43ee39['shopId']]+=_0x43ee39[_0x1fea8e(0x1ac)];}const _0x1fa313=_0x8a24f7-_0x3b822b,_0x4cb14c=_0x8a24f7-_0x53cd8a;for(const _0x3809a2 in _0x3a59df){_0x3a59df[_0x3809a2][_0x1fea8e(0x11a)]=_0x220f25[_0x3809a2]||0x0,_0x3a59df[_0x3809a2][_0x1fea8e(0x1a1)]=_0x3a59df[_0x3809a2]['paymentsCount']>0x0?_0x3a59df[_0x3809a2]['turnoverUSDT']/_0x3a59df[_0x3809a2][_0x1fea8e(0x132)]:0x0;}const _0x2d7e99={'totalTurnover':Math[_0x1fea8e(0x143)](_0x8a24f7*0x64)/0x64,'merchantEarnings':Math['round'](_0x4cb14c*0x64)/0x64,'gatewayEarnings':Math[_0x1fea8e(0x143)](_0x1fa313*0x64)/0x64,'totalPaidOut':Math[_0x1fea8e(0x143)](_0x3b822b*0x64)/0x64,'averageCheck':_0x2c6f2c[_0x1fea8e(0x133)]>0x0?Math[_0x1fea8e(0x143)](_0x8a24f7/_0x2c6f2c[_0x1fea8e(0x133)]*0x64)/0x64:0x0,'totalPayments':_0x2c6f2c[_0x1fea8e(0x133)],'successfulPayments':_0x2c6f2c['length'],'conversionRate':0x64,'gatewayBreakdown':Object['entries'](_0x257611)[_0x1fea8e(0x142)](([_0x4904c4,_0x4348d4])=>({'gateway':_0x4904c4,'gatewayDisplayName':this[_0x1fea8e(0x15b)](_0x4904c4),'paymentsCount':_0x4348d4[_0x1fea8e(0x132)],'turnoverUSDT':Math[_0x1fea8e(0x143)](_0x4348d4[_0x1fea8e(0x153)]*0x64)/0x64,'commissionUSDT':Math[_0x1fea8e(0x143)](_0x4348d4['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1fea8e(0x143)](_0x4348d4[_0x1fea8e(0x128)]*0x64)/0x64,'averageCommissionRate':_0x4348d4[_0x1fea8e(0x13c)]>0x0?Math[_0x1fea8e(0x143)](_0x4348d4['totalCommissionRate']/_0x4348d4[_0x1fea8e(0x13c)]*0x64)/0x64:0x0})),'merchantBreakdown':_0x57e3fb[_0x1fea8e(0x17a)]?undefined:Object[_0x1fea8e(0x137)](_0x3a59df)[_0x1fea8e(0x142)](_0x37da61=>({'shopId':_0x37da61[_0x1fea8e(0x17a)],'shopName':_0x37da61[_0x1fea8e(0x17d)],'shopUsername':_0x37da61[_0x1fea8e(0x176)],'paymentsCount':_0x37da61[_0x1fea8e(0x132)],'turnoverUSDT':Math[_0x1fea8e(0x143)](_0x37da61[_0x1fea8e(0x153)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x37da61[_0x1fea8e(0x134)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1fea8e(0x143)](_0x37da61[_0x1fea8e(0x128)]*0x64)/0x64,'paidOutUSDT':Math[_0x1fea8e(0x143)]((_0x220f25[_0x37da61[_0x1fea8e(0x17a)]]||0x0)*0x64)/0x64,'averageCheckUSDT':Math[_0x1fea8e(0x143)](_0x37da61[_0x1fea8e(0x153)]/_0x37da61[_0x1fea8e(0x132)]*0x64)/0x64})),'dailyData':Object[_0x1fea8e(0x178)](_0x1b5ec1)[_0x1fea8e(0x170)](([_0xf24064],[_0x2c070e])=>_0xf24064[_0x1fea8e(0x17f)](_0x2c070e))['map'](([_0x3702ab,_0x56e596])=>({'date':_0x3702ab,'turnover':Math[_0x1fea8e(0x143)](_0x56e596['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x1fea8e(0x143)](_0x56e596[_0x1fea8e(0x11f)]*0x64)/0x64,'gatewayEarnings':Math[_0x1fea8e(0x143)](_0x56e596[_0x1fea8e(0x182)]*0x64)/0x64,'paymentsCount':_0x56e596[_0x1fea8e(0x132)]})),'periodInfo':{'from':_0x1a4491,'to':_0x1a805f,'periodType':_0x57e3fb['period']||_0x1fea8e(0x17b),'daysCount':Math[_0x1fea8e(0x103)]((_0x1a805f[_0x1fea8e(0x1aa)]()-_0x1a4491[_0x1fea8e(0x1aa)]())/(0x3e8*0x3c*0x3c*0x18))}};return console[_0x1fea8e(0x162)](_0x1fea8e(0x192),{'totalTurnover':_0x2d7e99[_0x1fea8e(0x1a4)],'merchantEarnings':_0x2d7e99[_0x1fea8e(0x11f)],'gatewayEarnings':_0x2d7e99['gatewayEarnings'],'totalPaidOut':_0x2d7e99[_0x1fea8e(0x156)],'paymentsCount':_0x2d7e99[_0x1fea8e(0x1a6)]}),_0x2d7e99;}[a33_0x1766bb(0x15b)](_0x283f33){const _0x1f00ec=a33_0x1766bb,_0x1b6eba={'plisio':_0x1f00ec(0x104),'rapyd':_0x1f00ec(0x16b),'noda':_0x1f00ec(0x117),'cointopay':_0x1f00ec(0x13f),'klyme_eu':_0x1f00ec(0x12e),'klyme_gb':_0x1f00ec(0x131),'klyme_de':_0x1f00ec(0x15a)};return _0x1b6eba[_0x283f33]||_0x283f33;}async[a33_0x1766bb(0x10c)](_0x106db4='30d'){const _0x2cf1cf=a33_0x1766bb,_0x4bb590=new Date();let _0x588cf0;switch(_0x106db4){case'7d':_0x588cf0=new Date(_0x4bb590[_0x2cf1cf(0x1aa)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2cf1cf(0x19c):_0x588cf0=new Date(_0x4bb590[_0x2cf1cf(0x1aa)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x588cf0=new Date(_0x4bb590[_0x2cf1cf(0x1aa)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'1y':_0x588cf0=new Date(_0x4bb590['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;default:_0x588cf0=new Date(_0x4bb590[_0x2cf1cf(0x1aa)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x24f1ad,_0x4eb18b,_0x196281,_0x4c0f91,_0x5c2bc0,_0x47b099]=await Promise[_0x2cf1cf(0x122)]([database_1[_0x2cf1cf(0x126)][_0x2cf1cf(0x161)][_0x2cf1cf(0x18a)](),database_1[_0x2cf1cf(0x126)]['shop']['count']({'where':{'status':_0x2cf1cf(0x183)}}),database_1[_0x2cf1cf(0x126)][_0x2cf1cf(0x166)][_0x2cf1cf(0x18a)]({'where':{'createdAt':{'gte':_0x588cf0}}}),database_1[_0x2cf1cf(0x126)][_0x2cf1cf(0x166)][_0x2cf1cf(0x18a)]({'where':{'status':_0x2cf1cf(0xfc),'createdAt':{'gte':_0x588cf0}}}),database_1[_0x2cf1cf(0x126)][_0x2cf1cf(0x166)][_0x2cf1cf(0x159)]({'where':{'status':_0x2cf1cf(0xfc),'createdAt':{'gte':_0x588cf0}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x2cf1cf(0x126)]['payment'][_0x2cf1cf(0x159)]({'take':0xa,'orderBy':{'createdAt':_0x2cf1cf(0x163)},'where':{'createdAt':{'gte':_0x588cf0}},'select':{'id':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'createdAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x48c855=0x0;for(const _0x3d9ecc of _0x5c2bc0){const _0x762193=await currencyService_1[_0x2cf1cf(0x14b)]['convertToUSDT'](_0x3d9ecc[_0x2cf1cf(0x1ac)],_0x3d9ecc[_0x2cf1cf(0x16e)]);_0x48c855+=_0x762193;}const _0x276a3c=_0x196281>0x0?_0x4c0f91/_0x196281*0x64:0x0;return{'overview':{'totalShops':_0x24f1ad,'activeShops':_0x4eb18b,'totalPayments':_0x196281,'successfulPayments':_0x4c0f91,'totalRevenue':Math['round'](_0x48c855*0x64)/0x64,'conversionRate':Math[_0x2cf1cf(0x143)](_0x276a3c*0x64)/0x64},'recentPayments':_0x47b099[_0x2cf1cf(0x142)](_0x3a792f=>({'id':_0x3a792f['id'],'amount':_0x3a792f['amount'],'currency':_0x3a792f[_0x2cf1cf(0x16e)],'status':_0x3a792f[_0x2cf1cf(0x14c)],'gateway':_0x3a792f[_0x2cf1cf(0x11b)],'shopName':_0x3a792f['shop'][_0x2cf1cf(0x17c)],'shopUsername':_0x3a792f['shop'][_0x2cf1cf(0x14e)],'createdAt':_0x3a792f[_0x2cf1cf(0x11d)]})),'period':_0x106db4};}async['getPayoutStats'](){const _0x261b9b=a33_0x1766bb,_0x5d52e4=await database_1[_0x261b9b(0x126)][_0x261b9b(0x166)]['findMany']({'where':{'status':_0x261b9b(0xfc),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'shop':{'select':{'gatewaySettings':!![]}}}});let _0x53ac89=0x0,_0x122cd6=0x0;for(const _0x47da00 of _0x5d52e4){const _0x3e54aa=await currencyService_1['currencyService'][_0x261b9b(0x160)](_0x47da00[_0x261b9b(0x1ac)],_0x47da00[_0x261b9b(0x16e)]);_0x122cd6+=_0x3e54aa;let _0xef9e5e=0xa;if(_0x47da00['shop'][_0x261b9b(0x106)])try{const _0x2f1976=JSON['parse'](_0x47da00[_0x261b9b(0x161)][_0x261b9b(0x106)]),_0x34d89a=this[_0x261b9b(0x15b)](_0x47da00[_0x261b9b(0x11b)]);_0x2f1976[_0x34d89a]?.[_0x261b9b(0x112)]!==undefined&&(_0xef9e5e=_0x2f1976[_0x34d89a]['commission']);}catch(_0x15dfb4){console[_0x261b9b(0x124)]('Error\x20parsing\x20gateway\x20settings:',_0x15dfb4);}const _0x56445e=_0x3e54aa*(0x1-_0xef9e5e/0x64);_0x53ac89+=_0x56445e;}const [_0x2db8b8,_0x55c53e]=await Promise['all']([database_1[_0x261b9b(0x126)][_0x261b9b(0x13e)][_0x261b9b(0x17e)]({'where':{'status':_0x261b9b(0x189)},'_sum':{'amount':!![]}}),database_1[_0x261b9b(0x126)][_0x261b9b(0x13e)][_0x261b9b(0x17e)]({'where':{'status':_0x261b9b(0x189),'paidAt':{'gte':new Date(new Date()[_0x261b9b(0x11e)](),new Date()['getMonth'](),0x1)}},'_sum':{'amount':!![]}})]);return{'totalPayout':_0x2db8b8[_0x261b9b(0xff)]['amount']||0x0,'awaitingPayout':Math['round'](_0x53ac89*0x64)/0x64,'thisMonth':_0x55c53e[_0x261b9b(0xff)]['amount']||0x0,'availableBalance':Math['round'](_0x122cd6*0x64)/0x64};}async[a33_0x1766bb(0x14f)](_0x2cbe1f){const _0xb689aa=a33_0x1766bb,{page:_0xfc07f4,limit:_0x356fc3,minAmount:_0xd4d87a,search:_0x356e60}=_0x2cbe1f,_0x594791=await database_1[_0xb689aa(0x126)][_0xb689aa(0x166)][_0xb689aa(0x159)]({'where':{'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![]}}}}),_0x5a121b={};for(const _0x161282 of _0x594791){!_0x5a121b[_0x161282['shopId']]&&(_0x5a121b[_0x161282[_0xb689aa(0x17a)]]={'shop':_0x161282['shop'],'payments':[],'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'gatewayBreakdown':{},'oldestPaymentDate':_0x161282[_0xb689aa(0x187)]});const _0x210ca1=_0x5a121b[_0x161282[_0xb689aa(0x17a)]];_0x210ca1[_0xb689aa(0x194)][_0xb689aa(0x1a3)](_0x161282);const _0x18bee2=await currencyService_1['currencyService']['convertToUSDT'](_0x161282[_0xb689aa(0x1ac)],_0x161282[_0xb689aa(0x16e)]);_0x210ca1[_0xb689aa(0x14d)]+=_0x18bee2;let _0x1c2ef3=0xa;if(_0x161282['shop'][_0xb689aa(0x106)])try{const _0x4f64d7=JSON['parse'](_0x161282['shop'][_0xb689aa(0x106)]),_0x3650e7=this[_0xb689aa(0x15b)](_0x161282['gateway']);_0x4f64d7[_0x3650e7]?.[_0xb689aa(0x112)]!==undefined&&(_0x1c2ef3=_0x4f64d7[_0x3650e7]['commission']);}catch(_0x17625f){console[_0xb689aa(0x124)](_0xb689aa(0x173),_0x17625f);}const _0x59111e=_0x18bee2*(0x1-_0x1c2ef3/0x64);_0x210ca1[_0xb689aa(0x1a9)]+=_0x59111e,!_0x210ca1['gatewayBreakdown'][_0x161282[_0xb689aa(0x11b)]]&&(_0x210ca1[_0xb689aa(0x139)][_0x161282[_0xb689aa(0x11b)]]={'gateway':_0x161282['gateway'],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x1c2ef3}),_0x210ca1[_0xb689aa(0x139)][_0x161282[_0xb689aa(0x11b)]][_0xb689aa(0x18a)]++,_0x210ca1[_0xb689aa(0x139)][_0x161282['gateway']]['amountUSDT']+=_0x18bee2,_0x210ca1[_0xb689aa(0x139)][_0x161282['gateway']][_0xb689aa(0x1a7)]+=_0x59111e,_0x161282[_0xb689aa(0x187)]<_0x210ca1[_0xb689aa(0x148)]&&(_0x210ca1['oldestPaymentDate']=_0x161282['paidAt']);}let _0x4cdaf2=Object['values'](_0x5a121b)[_0xb689aa(0x142)](_0x8214d7=>({'id':_0x8214d7[_0xb689aa(0x161)]['id'],'fullName':_0x8214d7[_0xb689aa(0x161)][_0xb689aa(0x17c)],'username':_0x8214d7[_0xb689aa(0x161)]['username'],'telegramId':_0x8214d7['shop'][_0xb689aa(0x1a5)],'merchantUrl':_0x8214d7['shop'][_0xb689aa(0x123)],'wallets':{'usdtPolygonWallet':_0x8214d7[_0xb689aa(0x161)][_0xb689aa(0x198)],'usdtTrcWallet':_0x8214d7[_0xb689aa(0x161)]['usdtTrcWallet'],'usdtErcWallet':_0x8214d7['shop']['usdtErcWallet'],'usdcPolygonWallet':_0x8214d7[_0xb689aa(0x161)][_0xb689aa(0x19e)]},'totalAmountUSDT':Math[_0xb689aa(0x143)](_0x8214d7['totalAmountUSDT']*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x8214d7[_0xb689aa(0x1a9)]*0x64)/0x64,'paymentsCount':_0x8214d7[_0xb689aa(0x194)][_0xb689aa(0x133)],'oldestPaymentDate':_0x8214d7[_0xb689aa(0x148)],'gatewayBreakdown':Object['values'](_0x8214d7[_0xb689aa(0x139)])[_0xb689aa(0x142)](_0x211236=>({'gateway':_0x211236[_0xb689aa(0x11b)],'count':_0x211236['count'],'amountUSDT':Math['round'](_0x211236[_0xb689aa(0x125)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0xb689aa(0x143)](_0x211236[_0xb689aa(0x1a7)]*0x64)/0x64,'commission':_0x211236[_0xb689aa(0x112)]}))}));_0xd4d87a&&(_0x4cdaf2=_0x4cdaf2['filter'](_0x4bb8e5=>_0x4bb8e5['totalAmountAfterCommissionUSDT']>=_0xd4d87a));if(_0x356e60){const _0x982a11=_0x356e60[_0xb689aa(0x108)]();_0x4cdaf2=_0x4cdaf2[_0xb689aa(0x157)](_0x21bf03=>_0x21bf03[_0xb689aa(0x152)][_0xb689aa(0x108)]()['includes'](_0x982a11)||_0x21bf03[_0xb689aa(0x14e)][_0xb689aa(0x108)]()[_0xb689aa(0x107)](_0x982a11));}_0x4cdaf2['sort']((_0x455486,_0x3f8de7)=>_0x3f8de7[_0xb689aa(0x1a9)]-_0x455486['totalAmountAfterCommissionUSDT']);const _0x6e2b6e={'totalMerchants':_0x4cdaf2[_0xb689aa(0x133)],'totalAmountUSDT':Math[_0xb689aa(0x143)](_0x4cdaf2[_0xb689aa(0x19a)]((_0x59fd6d,_0x5a5825)=>_0x59fd6d+_0x5a5825[_0xb689aa(0x14d)],0x0)*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xb689aa(0x143)](_0x4cdaf2[_0xb689aa(0x19a)]((_0x5e02cf,_0x5a09da)=>_0x5e02cf+_0x5a09da[_0xb689aa(0x1a9)],0x0)*0x64)/0x64},_0x5cbdbb=(_0xfc07f4-0x1)*_0x356fc3,_0x51c46f=_0x4cdaf2[_0xb689aa(0x113)](_0x5cbdbb,_0x5cbdbb+_0x356fc3);return{'merchants':_0x51c46f,'pagination':{'page':_0xfc07f4,'limit':_0x356fc3,'total':_0x4cdaf2[_0xb689aa(0x133)],'totalPages':Math[_0xb689aa(0x103)](_0x4cdaf2[_0xb689aa(0x133)]/_0x356fc3)},'summary':_0x6e2b6e};}async[a33_0x1766bb(0x10a)](_0x547e34){const _0x19d031=a33_0x1766bb,{shopId:_0x5f1371,amount:_0xa057a9,network:_0x16bc89,notes:_0x1049c8}=_0x547e34,_0x33980d=await database_1['default']['shop'][_0x19d031(0x109)]({'where':{'id':_0x5f1371},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x33980d)throw new Error(_0x19d031(0x180));const _0x5b7cbf=await database_1[_0x19d031(0x126)][_0x19d031(0x13e)][_0x19d031(0x135)]({'data':{'shopId':_0x5f1371,'amount':_0xa057a9,'network':_0x16bc89,'status':_0x19d031(0x189),'notes':_0x1049c8,'paidAt':new Date()}});return{'id':_0x5b7cbf['id'],'shopId':_0x5b7cbf[_0x19d031(0x17a)],'shopName':_0x33980d[_0x19d031(0x17c)],'shopUsername':_0x33980d[_0x19d031(0x14e)],'amount':_0x5b7cbf[_0x19d031(0x1ac)],'network':_0x5b7cbf[_0x19d031(0x196)],'status':_0x5b7cbf[_0x19d031(0x14c)],'txid':_0x5b7cbf[_0x19d031(0x13b)],'notes':_0x5b7cbf[_0x19d031(0x177)],'createdAt':_0x5b7cbf[_0x19d031(0x11d)],'paidAt':_0x5b7cbf[_0x19d031(0x187)]};}async[a33_0x1766bb(0x186)](_0x2a4bd2){const _0x1e04fa=a33_0x1766bb,{page:_0x2c85be,limit:_0x68378,shopId:_0x32fd47,network:_0x1af2c3,dateFrom:_0xb75720,dateTo:_0x3cdc99,search:_0x3aae7e}=_0x2a4bd2,_0x56b47b=(_0x2c85be-0x1)*_0x68378,_0x4e3bab={};_0x32fd47&&(_0x4e3bab['shopId']=_0x32fd47);_0x1af2c3&&(_0x4e3bab[_0x1e04fa(0x196)]=_0x1af2c3);(_0xb75720||_0x3cdc99)&&(_0x4e3bab[_0x1e04fa(0x187)]={},_0xb75720&&(_0x4e3bab[_0x1e04fa(0x187)][_0x1e04fa(0x140)]=new Date(_0xb75720)),_0x3cdc99&&(_0x4e3bab[_0x1e04fa(0x187)][_0x1e04fa(0x193)]=new Date(_0x3cdc99)));_0x3aae7e&&(_0x4e3bab['OR']=[{'shop':{'name':{'contains':_0x3aae7e,'mode':_0x1e04fa(0x119)}}},{'shop':{'username':{'contains':_0x3aae7e,'mode':_0x1e04fa(0x119)}}},{'notes':{'contains':_0x3aae7e,'mode':'insensitive'}}]);const [_0x1308c6,_0x19dc74]=await Promise[_0x1e04fa(0x122)]([database_1[_0x1e04fa(0x126)][_0x1e04fa(0x13e)][_0x1e04fa(0x159)]({'where':_0x4e3bab,'skip':_0x56b47b,'take':_0x68378,'orderBy':{'createdAt':_0x1e04fa(0x163)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1e04fa(0x126)]['payout'][_0x1e04fa(0x18a)]({'where':_0x4e3bab})]);return{'payouts':_0x1308c6['map'](_0x56d2db=>({'id':_0x56d2db['id'],'shopId':_0x56d2db['shopId'],'shopName':_0x56d2db['shop'][_0x1e04fa(0x17c)],'shopUsername':_0x56d2db[_0x1e04fa(0x161)]['username'],'amount':_0x56d2db[_0x1e04fa(0x1ac)],'network':_0x56d2db[_0x1e04fa(0x196)],'status':_0x56d2db[_0x1e04fa(0x14c)],'txid':_0x56d2db[_0x1e04fa(0x13b)],'notes':_0x56d2db[_0x1e04fa(0x177)],'createdAt':_0x56d2db[_0x1e04fa(0x11d)],'paidAt':_0x56d2db[_0x1e04fa(0x187)]})),'pagination':{'page':_0x2c85be,'limit':_0x68378,'total':_0x19dc74,'totalPages':Math[_0x1e04fa(0x103)](_0x19dc74/_0x68378)}};}async[a33_0x1766bb(0x171)](_0x23e055){const _0x5a0fd6=a33_0x1766bb,_0x82c8ff=await database_1[_0x5a0fd6(0x126)]['payout']['findUnique']({'where':{'id':_0x23e055},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x82c8ff)return null;return{'id':_0x82c8ff['id'],'shopId':_0x82c8ff[_0x5a0fd6(0x17a)],'shopName':_0x82c8ff[_0x5a0fd6(0x161)][_0x5a0fd6(0x17c)],'shopUsername':_0x82c8ff[_0x5a0fd6(0x161)]['username'],'amount':_0x82c8ff[_0x5a0fd6(0x1ac)],'network':_0x82c8ff[_0x5a0fd6(0x196)],'status':_0x82c8ff['status'],'txid':_0x82c8ff[_0x5a0fd6(0x13b)],'notes':_0x82c8ff[_0x5a0fd6(0x177)],'createdAt':_0x82c8ff[_0x5a0fd6(0x11d)],'paidAt':_0x82c8ff[_0x5a0fd6(0x187)]};}async[a33_0x1766bb(0x144)](_0x5c3866){const _0xa18d7b=a33_0x1766bb;await database_1[_0xa18d7b(0x126)][_0xa18d7b(0x13e)][_0xa18d7b(0x168)]({'where':{'id':_0x5c3866}});}async[a33_0x1766bb(0x16f)](_0x53d509){const _0x1f14c6=a33_0x1766bb,{page:_0x28855f,limit:_0x37fde9,status:_0x5a2fe8,gateway:_0x2d632c,shopId:_0x32c125,dateFrom:_0x14eaf5,dateTo:_0x2c0361,search:_0xc9e2eb}=_0x53d509,_0x558ae6=(_0x28855f-0x1)*_0x37fde9,_0x340bcf={};_0x5a2fe8&&(_0x340bcf['status']=_0x5a2fe8[_0x1f14c6(0x10d)]());_0x2d632c&&(_0x340bcf['gateway']=_0x2d632c[_0x1f14c6(0x108)]());_0x32c125&&(_0x340bcf[_0x1f14c6(0x17a)]=_0x32c125);(_0x14eaf5||_0x2c0361)&&(_0x340bcf['createdAt']={},_0x14eaf5&&(_0x340bcf[_0x1f14c6(0x11d)][_0x1f14c6(0x140)]=new Date(_0x14eaf5)),_0x2c0361&&(_0x340bcf[_0x1f14c6(0x11d)][_0x1f14c6(0x193)]=new Date(_0x2c0361)));_0xc9e2eb&&(_0x340bcf['OR']=[{'orderId':{'contains':_0xc9e2eb,'mode':_0x1f14c6(0x119)}},{'gatewayOrderId':{'contains':_0xc9e2eb,'mode':_0x1f14c6(0x119)}},{'customerEmail':{'contains':_0xc9e2eb,'mode':_0x1f14c6(0x119)}},{'shop':{'name':{'contains':_0xc9e2eb,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0xc9e2eb,'mode':_0x1f14c6(0x119)}}}]);const [_0x53aba8,_0x3bd9d1]=await Promise[_0x1f14c6(0x122)]([database_1[_0x1f14c6(0x126)][_0x1f14c6(0x166)][_0x1f14c6(0x159)]({'where':_0x340bcf,'skip':_0x558ae6,'take':_0x37fde9,'orderBy':{'createdAt':_0x1f14c6(0x163)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x1f14c6(0x166)][_0x1f14c6(0x18a)]({'where':_0x340bcf})]);return{'payments':_0x53aba8[_0x1f14c6(0x142)](_0x4aca0d=>({'id':_0x4aca0d['id'],'shopId':_0x4aca0d[_0x1f14c6(0x17a)],'shopName':_0x4aca0d[_0x1f14c6(0x161)][_0x1f14c6(0x17c)],'shopUsername':_0x4aca0d['shop'][_0x1f14c6(0x14e)],'gateway':_0x4aca0d['gateway'],'amount':_0x4aca0d[_0x1f14c6(0x1ac)],'currency':_0x4aca0d[_0x1f14c6(0x16e)],'status':_0x4aca0d[_0x1f14c6(0x14c)],'orderId':_0x4aca0d[_0x1f14c6(0x102)],'gatewayOrderId':_0x4aca0d[_0x1f14c6(0x100)],'customerEmail':_0x4aca0d[_0x1f14c6(0x118)],'customerName':_0x4aca0d[_0x1f14c6(0x18d)],'createdAt':_0x4aca0d[_0x1f14c6(0x11d)],'updatedAt':_0x4aca0d['updatedAt'],'paidAt':_0x4aca0d['paidAt']})),'pagination':{'page':_0x28855f,'limit':_0x37fde9,'total':_0x3bd9d1,'totalPages':Math[_0x1f14c6(0x103)](_0x3bd9d1/_0x37fde9)}};}async[a33_0x1766bb(0x150)](_0x1600eb){const _0x5ee525=a33_0x1766bb,_0x10de65=await database_1['default'][_0x5ee525(0x166)][_0x5ee525(0x109)]({'where':{'id':_0x1600eb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x10de65)return null;return{'id':_0x10de65['id'],'shopId':_0x10de65[_0x5ee525(0x17a)],'shopName':_0x10de65[_0x5ee525(0x161)][_0x5ee525(0x17c)],'shopUsername':_0x10de65[_0x5ee525(0x161)][_0x5ee525(0x14e)],'gateway':_0x10de65[_0x5ee525(0x11b)],'amount':_0x10de65[_0x5ee525(0x1ac)],'currency':_0x10de65[_0x5ee525(0x16e)],'status':_0x10de65[_0x5ee525(0x14c)],'orderId':_0x10de65['orderId'],'gatewayOrderId':_0x10de65['gatewayOrderId'],'gatewayPaymentId':_0x10de65[_0x5ee525(0x15e)],'customerEmail':_0x10de65[_0x5ee525(0x118)],'customerName':_0x10de65[_0x5ee525(0x18d)],'externalPaymentUrl':_0x10de65[_0x5ee525(0x18c)],'successUrl':_0x10de65[_0x5ee525(0x165)],'failUrl':_0x10de65['failUrl'],'createdAt':_0x10de65['createdAt'],'updatedAt':_0x10de65[_0x5ee525(0x18f)],'paidAt':_0x10de65['paidAt'],'merchantPaid':_0x10de65[_0x5ee525(0x141)],'adminNotes':_0x10de65[_0x5ee525(0x191)],'statusChangedBy':_0x10de65[_0x5ee525(0x19b)],'statusChangedAt':_0x10de65[_0x5ee525(0x175)]};}async['updatePaymentStatus'](_0x247df2,_0x4a22e9,_0x16ec9c,_0x24fcef){const _0x13efbf=a33_0x1766bb,_0xa2158d={'status':_0x4a22e9['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x16ec9c&&(_0xa2158d[_0x13efbf(0x191)]=_0x16ec9c);_0x4a22e9['toUpperCase']()==='CHARGEBACK'&&_0x24fcef&&(_0xa2158d[_0x13efbf(0x154)]=_0x24fcef);_0x4a22e9[_0x13efbf(0x10d)]()===_0x13efbf(0xfc)&&(_0xa2158d[_0x13efbf(0x187)]=new Date());const _0x5bef39=await database_1[_0x13efbf(0x126)][_0x13efbf(0x166)][_0x13efbf(0x167)]({'where':{'id':_0x247df2},'data':_0xa2158d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x5bef39['id'],'shopId':_0x5bef39[_0x13efbf(0x17a)],'shopName':_0x5bef39['shop']['name'],'shopUsername':_0x5bef39[_0x13efbf(0x161)][_0x13efbf(0x14e)],'gateway':_0x5bef39[_0x13efbf(0x11b)],'amount':_0x5bef39[_0x13efbf(0x1ac)],'currency':_0x5bef39[_0x13efbf(0x16e)],'status':_0x5bef39[_0x13efbf(0x14c)],'orderId':_0x5bef39['orderId'],'gatewayOrderId':_0x5bef39[_0x13efbf(0x100)],'gatewayPaymentId':_0x5bef39[_0x13efbf(0x15e)],'customerEmail':_0x5bef39['customerEmail'],'customerName':_0x5bef39[_0x13efbf(0x18d)],'adminNotes':_0x5bef39['adminNotes'],'chargebackAmount':_0x5bef39[_0x13efbf(0x154)],'createdAt':_0x5bef39[_0x13efbf(0x11d)],'updatedAt':_0x5bef39[_0x13efbf(0x18f)],'paidAt':_0x5bef39['paidAt'],'statusChangedBy':_0x5bef39[_0x13efbf(0x19b)],'statusChangedAt':_0x5bef39[_0x13efbf(0x175)]};}async[a33_0x1766bb(0x195)](_0x1d4a23){const _0x145e6a=a33_0x1766bb,{page:_0xf0320,limit:_0x51632f,status:_0x5bece5}=_0x1d4a23,_0x5cbcdf=(_0xf0320-0x1)*_0x51632f,_0x45e18d={};_0x5bece5&&(_0x45e18d['status']=_0x5bece5[_0x145e6a(0x10d)]());const [_0x19e2ad,_0x233b96]=await Promise[_0x145e6a(0x122)]([database_1[_0x145e6a(0x126)]['shop'][_0x145e6a(0x159)]({'where':_0x45e18d,'skip':_0x5cbcdf,'take':_0x51632f,'orderBy':{'createdAt':_0x145e6a(0x163)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x145e6a(0x126)][_0x145e6a(0x161)][_0x145e6a(0x18a)]({'where':_0x45e18d})]);return{'users':_0x19e2ad[_0x145e6a(0x142)](_0x426508=>({'id':_0x426508['id'],'fullName':_0x426508[_0x145e6a(0x17c)],'username':_0x426508['username'],'telegramId':_0x426508[_0x145e6a(0x1a5)],'merchantUrl':_0x426508['shopUrl'],'gateways':_0x426508[_0x145e6a(0x12a)]?JSON[_0x145e6a(0x15c)](_0x426508[_0x145e6a(0x12a)]):null,'gatewaySettings':_0x426508[_0x145e6a(0x106)]?JSON[_0x145e6a(0x15c)](_0x426508[_0x145e6a(0x106)]):null,'publicKey':_0x426508[_0x145e6a(0x10e)],'wallets':{'usdtPolygonWallet':_0x426508[_0x145e6a(0x198)],'usdtTrcWallet':_0x426508[_0x145e6a(0x12b)],'usdtErcWallet':_0x426508[_0x145e6a(0x147)],'usdcPolygonWallet':_0x426508['usdcPolygonWallet']},'status':_0x426508[_0x145e6a(0x14c)],'createdAt':_0x426508[_0x145e6a(0x11d)]})),'pagination':{'page':_0xf0320,'limit':_0x51632f,'total':_0x233b96,'totalPages':Math[_0x145e6a(0x103)](_0x233b96/_0x51632f)}};}async[a33_0x1766bb(0x116)](_0x252c61){const _0x3cc285=a33_0x1766bb,_0x4d11a1=await database_1[_0x3cc285(0x126)]['shop'][_0x3cc285(0x109)]({'where':{'id':_0x252c61},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4d11a1)return null;return{'id':_0x4d11a1['id'],'fullName':_0x4d11a1[_0x3cc285(0x17c)],'username':_0x4d11a1[_0x3cc285(0x14e)],'telegramId':_0x4d11a1['telegram'],'merchantUrl':_0x4d11a1['shopUrl'],'gateways':_0x4d11a1[_0x3cc285(0x12a)]?JSON[_0x3cc285(0x15c)](_0x4d11a1[_0x3cc285(0x12a)]):null,'gatewaySettings':_0x4d11a1['gatewaySettings']?JSON['parse'](_0x4d11a1[_0x3cc285(0x106)]):null,'publicKey':_0x4d11a1[_0x3cc285(0x10e)],'wallets':{'usdtPolygonWallet':_0x4d11a1['usdtPolygonWallet'],'usdtTrcWallet':_0x4d11a1['usdtTrcWallet'],'usdtErcWallet':_0x4d11a1['usdtErcWallet'],'usdcPolygonWallet':_0x4d11a1[_0x3cc285(0x19e)]},'status':_0x4d11a1[_0x3cc285(0x14c)],'createdAt':_0x4d11a1['createdAt']};}async[a33_0x1766bb(0x10b)](_0x54ab2c){const _0x29548a=a33_0x1766bb,{fullName:_0xe384b5,username:_0x1c15c0,password:_0x250f65,telegramId:_0x2d397a,merchantUrl:_0x33795f,gateways:_0x123566,gatewaySettings:_0x12dfa6,wallets:_0x775ab3}=_0x54ab2c,_0x2d7192=await database_1[_0x29548a(0x126)][_0x29548a(0x161)][_0x29548a(0x109)]({'where':{'username':_0x1c15c0}});if(_0x2d7192)throw new Error(_0x29548a(0x1a2));if(_0x2d397a){const _0x5def3b=await database_1[_0x29548a(0x126)][_0x29548a(0x161)][_0x29548a(0x109)]({'where':{'telegram':_0x2d397a}});if(_0x5def3b)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xea69bd=await bcryptjs_1['default'][_0x29548a(0x164)](_0x250f65,0xc),_0x55c29c='pk_'+crypto_1[_0x29548a(0x126)][_0x29548a(0x18e)](0x20)[_0x29548a(0x127)](_0x29548a(0x15d)),_0x292aea=_0x29548a(0x197)+crypto_1[_0x29548a(0x126)][_0x29548a(0x18e)](0x20)[_0x29548a(0x127)](_0x29548a(0x15d)),_0xce9182=await database_1[_0x29548a(0x126)][_0x29548a(0x161)][_0x29548a(0x135)]({'data':{'name':_0xe384b5,'username':_0x1c15c0,'password':_0xea69bd,'telegram':_0x2d397a,'shopUrl':_0x33795f,'paymentGateways':_0x123566?JSON['stringify'](_0x123566):null,'gatewaySettings':_0x12dfa6?JSON[_0x29548a(0x19f)](_0x12dfa6):null,'usdtPolygonWallet':_0x775ab3?.[_0x29548a(0x198)]||null,'usdtTrcWallet':_0x775ab3?.['usdtTrcWallet']||null,'usdtErcWallet':_0x775ab3?.[_0x29548a(0x147)]||null,'usdcPolygonWallet':_0x775ab3?.[_0x29548a(0x19e)]||null,'publicKey':_0x55c29c,'secretKey':_0x292aea,'status':_0x29548a(0x183)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xce9182['id'],'fullName':_0xce9182[_0x29548a(0x17c)],'username':_0xce9182['username'],'telegramId':_0xce9182[_0x29548a(0x1a5)],'merchantUrl':_0xce9182[_0x29548a(0x123)],'gateways':_0xce9182[_0x29548a(0x12a)]?JSON[_0x29548a(0x15c)](_0xce9182[_0x29548a(0x12a)]):null,'gatewaySettings':_0xce9182[_0x29548a(0x106)]?JSON[_0x29548a(0x15c)](_0xce9182[_0x29548a(0x106)]):null,'publicKey':_0xce9182['publicKey'],'wallets':{'usdtPolygonWallet':_0xce9182['usdtPolygonWallet'],'usdtTrcWallet':_0xce9182[_0x29548a(0x12b)],'usdtErcWallet':_0xce9182[_0x29548a(0x147)],'usdcPolygonWallet':_0xce9182[_0x29548a(0x19e)]},'status':_0xce9182['status'],'createdAt':_0xce9182[_0x29548a(0x11d)]};}async[a33_0x1766bb(0x145)](_0x2db8f3,_0x3ceb9a){const _0x351ac5=a33_0x1766bb,_0x10d52f={..._0x3ceb9a};_0x3ceb9a['password']&&(_0x10d52f[_0x351ac5(0xfe)]=await bcryptjs_1[_0x351ac5(0x126)][_0x351ac5(0x164)](_0x3ceb9a[_0x351ac5(0xfe)],0xc));_0x3ceb9a[_0x351ac5(0x152)]&&(_0x10d52f['name']=_0x3ceb9a['fullName'],delete _0x10d52f[_0x351ac5(0x152)]);_0x3ceb9a[_0x351ac5(0xfd)]&&(_0x10d52f[_0x351ac5(0x1a5)]=_0x3ceb9a[_0x351ac5(0xfd)],delete _0x10d52f[_0x351ac5(0xfd)]);_0x3ceb9a[_0x351ac5(0x13a)]&&(_0x10d52f[_0x351ac5(0x123)]=_0x3ceb9a[_0x351ac5(0x13a)],delete _0x10d52f[_0x351ac5(0x13a)]);_0x3ceb9a[_0x351ac5(0x158)]&&(_0x10d52f[_0x351ac5(0x12a)]=JSON[_0x351ac5(0x19f)](_0x3ceb9a[_0x351ac5(0x158)]),delete _0x10d52f[_0x351ac5(0x158)]);_0x3ceb9a[_0x351ac5(0x106)]&&(_0x10d52f['gatewaySettings']=JSON[_0x351ac5(0x19f)](_0x3ceb9a[_0x351ac5(0x106)]),delete _0x10d52f[_0x351ac5(0x106)]);_0x3ceb9a[_0x351ac5(0x1a0)]&&(_0x3ceb9a[_0x351ac5(0x1a0)][_0x351ac5(0x198)]!==undefined&&(_0x10d52f[_0x351ac5(0x198)]=_0x3ceb9a['wallets'][_0x351ac5(0x198)]||null),_0x3ceb9a[_0x351ac5(0x1a0)][_0x351ac5(0x12b)]!==undefined&&(_0x10d52f[_0x351ac5(0x12b)]=_0x3ceb9a[_0x351ac5(0x1a0)]['usdtTrcWallet']||null),_0x3ceb9a[_0x351ac5(0x1a0)][_0x351ac5(0x147)]!==undefined&&(_0x10d52f['usdtErcWallet']=_0x3ceb9a[_0x351ac5(0x1a0)][_0x351ac5(0x147)]||null),_0x3ceb9a[_0x351ac5(0x1a0)][_0x351ac5(0x19e)]!==undefined&&(_0x10d52f[_0x351ac5(0x19e)]=_0x3ceb9a[_0x351ac5(0x1a0)][_0x351ac5(0x19e)]||null),delete _0x10d52f[_0x351ac5(0x1a0)]);const _0x772c7b=await database_1[_0x351ac5(0x126)][_0x351ac5(0x161)][_0x351ac5(0x167)]({'where':{'id':_0x2db8f3},'data':_0x10d52f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x772c7b['id'],'fullName':_0x772c7b[_0x351ac5(0x17c)],'username':_0x772c7b[_0x351ac5(0x14e)],'telegramId':_0x772c7b[_0x351ac5(0x1a5)],'merchantUrl':_0x772c7b[_0x351ac5(0x123)],'gateways':_0x772c7b[_0x351ac5(0x12a)]?JSON[_0x351ac5(0x15c)](_0x772c7b[_0x351ac5(0x12a)]):null,'gatewaySettings':_0x772c7b[_0x351ac5(0x106)]?JSON[_0x351ac5(0x15c)](_0x772c7b[_0x351ac5(0x106)]):null,'publicKey':_0x772c7b[_0x351ac5(0x10e)],'wallets':{'usdtPolygonWallet':_0x772c7b['usdtPolygonWallet'],'usdtTrcWallet':_0x772c7b[_0x351ac5(0x12b)],'usdtErcWallet':_0x772c7b[_0x351ac5(0x147)],'usdcPolygonWallet':_0x772c7b[_0x351ac5(0x19e)]},'status':_0x772c7b[_0x351ac5(0x14c)],'createdAt':_0x772c7b[_0x351ac5(0x11d)]};}async[a33_0x1766bb(0x14a)](_0xe54fff){const _0x450a5b=a33_0x1766bb;await database_1[_0x450a5b(0x126)]['shop'][_0x450a5b(0x168)]({'where':{'id':_0xe54fff}});}async[a33_0x1766bb(0x16a)](_0x1cbec1){const _0x559eb8=a33_0x1766bb,_0x1496fa=await database_1[_0x559eb8(0x126)]['shop'][_0x559eb8(0x167)]({'where':{'id':_0x1cbec1},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1496fa['id'],'fullName':_0x1496fa['name'],'username':_0x1496fa['username'],'telegramId':_0x1496fa[_0x559eb8(0x1a5)],'merchantUrl':_0x1496fa[_0x559eb8(0x123)],'gateways':_0x1496fa['paymentGateways']?JSON[_0x559eb8(0x15c)](_0x1496fa[_0x559eb8(0x12a)]):null,'gatewaySettings':_0x1496fa[_0x559eb8(0x106)]?JSON[_0x559eb8(0x15c)](_0x1496fa[_0x559eb8(0x106)]):null,'publicKey':_0x1496fa[_0x559eb8(0x10e)],'wallets':{'usdtPolygonWallet':_0x1496fa[_0x559eb8(0x198)],'usdtTrcWallet':_0x1496fa[_0x559eb8(0x12b)],'usdtErcWallet':_0x1496fa[_0x559eb8(0x147)],'usdcPolygonWallet':_0x1496fa['usdcPolygonWallet']},'status':_0x1496fa[_0x559eb8(0x14c)],'createdAt':_0x1496fa['createdAt']};}async[a33_0x1766bb(0x101)](_0x3572ad){const _0x1f6c17=a33_0x1766bb,_0x4b8747=await database_1['default'][_0x1f6c17(0x161)][_0x1f6c17(0x167)]({'where':{'id':_0x3572ad},'data':{'status':_0x1f6c17(0x183)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4b8747['id'],'fullName':_0x4b8747[_0x1f6c17(0x17c)],'username':_0x4b8747['username'],'telegramId':_0x4b8747[_0x1f6c17(0x1a5)],'merchantUrl':_0x4b8747['shopUrl'],'gateways':_0x4b8747['paymentGateways']?JSON[_0x1f6c17(0x15c)](_0x4b8747[_0x1f6c17(0x12a)]):null,'gatewaySettings':_0x4b8747[_0x1f6c17(0x106)]?JSON[_0x1f6c17(0x15c)](_0x4b8747['gatewaySettings']):null,'publicKey':_0x4b8747[_0x1f6c17(0x10e)],'wallets':{'usdtPolygonWallet':_0x4b8747[_0x1f6c17(0x198)],'usdtTrcWallet':_0x4b8747['usdtTrcWallet'],'usdtErcWallet':_0x4b8747[_0x1f6c17(0x147)],'usdcPolygonWallet':_0x4b8747['usdcPolygonWallet']},'status':_0x4b8747['status'],'createdAt':_0x4b8747[_0x1f6c17(0x11d)]};}}exports[a33_0x1766bb(0x179)]=AdminService;function a33_0x5006(){const _0x260b6c=['statusChangedAt','shopUsername','notes','entries','AdminService','shopId','month','name','shopName','aggregate','localeCompare','Shop\x20not\x20found','12306864pbUdQn','gatewayEarnings','ACTIVE','setDate','ðŸ“…\x20Period:\x20','getAllPayouts','paidAt','__esModule','COMPLETED','count','\x20completed\x20payouts','externalPaymentUrl','customerName','randomBytes','updatedAt','year','adminNotes','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','lte','payments','getAllUsers','network','sk_','usdtPolygonWallet','111zhGEBi','reduce','statusChangedBy','30d','134488wTNbXT','usdcPolygonWallet','stringify','wallets','averageCheckUSDT','Username\x20already\x20exists','push','totalTurnover','telegram','totalPayments','amountAfterCommissionUSDT','toISOString','totalAmountAfterCommissionUSDT','getTime','2475809vHtDeQ','amount','PAID','telegramId','password','_sum','gatewayOrderId','activateUser','orderId','ceil','Plisio','dateFrom','gatewaySettings','includes','toLowerCase','findUnique','createPayout','createUser','getSystemStatistics','toUpperCase','publicKey','2065568CiQuVX','getDate','custom','commission','slice','__importDefault','setHours','getUserById','Noda','customerEmail','insensitive','paidOutUSDT','gateway','defineProperty','createdAt','getFullYear','merchantEarnings','crypto','2395854bQgcnx','all','shopUrl','error','amountUSDT','default','toString','merchantEarningsUSDT','\x20successful\x20payments','paymentGateways','usdtTrcWallet','2020-01-01','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','KLYME\x20EU','970647TEiiIv','getMonth','KLYME\x20GB','paymentsCount','length','commissionUSDT','create','ðŸ’°\x20Found\x20','values','week','gatewayBreakdown','merchantUrl','txid','paymentsWithCommission','ðŸ’¸\x20Found\x20','payout','CoinToPay','gte','merchantPaid','map','round','deletePayout','updateUser','turnover','usdtErcWallet','oldestPaymentDate','48324OPhrCs','deleteUser','currencyService','status','totalAmountUSDT','username','getMerchantsAwaitingPayout','getPaymentById','getMerchantStatistics','fullName','turnoverUSDT','chargebackAmount','170ZhJTHm','totalPaidOut','filter','gateways','findMany','KLYME\x20DE','getGatewayDisplayName','parse','hex','gatewayPaymentId','820lresJs','convertToUSDT','shop','log','desc','hash','successUrl','payment','update','delete','split','suspendUser','Rapyd','period','bcryptjs','currency','getAllPayments','sort','getPayoutById','dateFrom\x20and\x20dateTo\x20are\x20required\x20for\x20custom\x20period','Error\x20parsing\x20gateway\x20settings:','getDay'];a33_0x5006=function(){return _0x260b6c;};return a33_0x5006();}