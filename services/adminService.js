'use strict';const a40_0x222d94=a40_0x4231;function a40_0x4d4e(){const _0x22c6d5=['stringify','\x20USDT\x20(theoretical\x20net)','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','error','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20USDT\x20(total\x20paid\x20to\x20merchants)','getSystemStatistics',',\x20Commission:\x20','\x20\x20\x20💵\x20Available\x20balance:\x20','0000','🔐\x20[','includes','ceil','\x20active\x20merchants\x20for\x20selection','30d','get','polygon','💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','commission','💳\x20Final\x20payout\x20wallet\x20for\x20','wallets','✅\x20Payout\x20created\x20in\x20DB:','findFirst','\x20\x20\x20Transaction\x20hash:\x20','sendPayoutNotification','updateCustomerData','\x20\x20\x20�📊\x20Total\x20payments:\x20','\x20USDT\x20(-','\x20\x20\x20Merchant\x20loses:\x20','push','usdcPolygonWallet','merchantUrl','🔄\x20Gateway\x20mapping:','amount','\x20to\x20','gateway','username','MasterCard','getMerchantsAwaitingPayout','\x20PAID\x20payments','currencyService','asc','📱\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','pendingUrl','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','gatewayCommissionRate','🔍\x20Balance\x20check\x20details:','values','gatewayEarnings','🔍\x20Selected\x20polygon\x20wallet:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20\x20\x20📅\x20This\x20month:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','_sum','Test\x20Gateway','telegramBotService','3iWxtXz','\x20\x20\x20🤔\x20Difference:\x20','randomBytes','averageCheckUSDT','paymentsCount','payouts','updatedAt','commissionUSDT','\x20\x20\x20Total\x20paid\x20out:\x20','Error\x20processing\x20payment\x20','network','\x20USDT\x20(after\x20',',\x20successful:\x20','insensitive','\x20USDT)','amountAfterCommissionUSDT','🔍\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','revenue','\x20\x20\x20Balance:\x20','lte','failureMessage','\x20status:\x20','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','customerName','all','hash','publicKey','day','thisMonth','toFixed','\x20USDT\x20for\x20payment\x20','\x20USDT','year','2ocWxXW','name','🎯\x20[','🔄\x20Gateway\x20mapping\x20(create):','📋\x20Getting\x20merchants\x20selection\x20list...','parse','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','custom','toUpperCase','paidAt','averageCommissionRate','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','1184987IEkrFk','📊\x20Getting\x20payments\x20with\x20filters:','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','convertToUSDT','Не\x20указан','\x20\x20\x20Difference:\x20','\x27\x20->\x20name\x20\x27','getGatewayDisplayName','forEach','dateTo','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','🔍\x20Selected\x20erc20\x20wallet:\x20','gte','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','9877490DfccLf','generateDailyStatistics','suspendUser','join','\x20became\x20PAID:','PAID','merchantEarningsUSDT','\x20\x20\x20✅\x20Total\x20net\x20balances:\x20','shop','min','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','%\x20commission)','some','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','2020-01-01','\x27\x20->\x20ID\x20\x27',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','notes','chargebackAmount','usdtTrcWallet','erc20_usdc','Noda','\x20USDT,\x20Requested:\x20','warn','amountAfterGatewayCommissionUSDT','period','not\x20specified','getDate',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','\x20with\x20payout\x20history','desc','shopId','📊\x20Available\x20gateways\x20in\x20database:','currency','sort','customerIp','Shop\x20not\x20found','dailyRevenue','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20order','\x20\x20\x20Requested\x20(number):\x20','not\x20provided','merchantEarnings','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','totalAmountAfterCommissionUSDT','\x20\x20\x20Gateway:\x20','dateFrom','gateways','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20USDT\x20from\x20balance','password','Payment\x20not\x20found','toString','telegramId','substr','📊\x20Calculating\x20payout\x20statistics...','noda','⚠️\x20Payment\x20','$transaction','shopUrl','📊\x20Final\x20WHERE\x20conditions:','split','statusChangedBy','💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','getPayoutStats','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','pendingPayout','toISOString','mastercard','totalPaidOut','random','totalPayments','2835xkXDfL','update','AdminService','\x20USDT\x20(gross\x20revenue)','🔍\x20Using\x20gateway\x20\x27','\x20payments)','length','REFUND','KLYME\x20DE','💰\x20Shop\x20','not\x20set','amountUSDT','📊\x20Gateway\x20filter\x20applied:','klyme_eu','25528BvOJNo','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','payout','payment','setHours',']\x20Gateway\x20settings\x20JSON\x20string:','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','🎯\x20updateUser\x20called\x20with\x20ID:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','customerUa','🔄\x20Converted\x20gateway\x20name\x20\x27','getUserById','COMPLETED','getMerchantsSelection','entries','\x20\x20\x20Full\x20amount:\x20','cointopay','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','gatewayOrderId','findUnique','set','22070532xOJqyY','totalCommissionRate','📅\x20Period:\x20','klyme_de','\x20\x20\x20💸\x20Total\x20payouts:\x20','reduce','whiteUrl','customerEmail','log','klyme_gb','getMonth','\x20->\x20','getGatewayInternalName','\x20USDT,\x20merchant:\x20','customerCountry','admin','KLYME\x20EU','\x20paid\x20payments\x20for\x20analysis','getGatewayNameById','✅\x20Using\x20gateway\x20filter:\x20\x27','filter','\x20\x20\x20Payout\x20amount:\x20','usdtPolygonWallet','ACTIVE','pk_','getAllPayouts','totalAmountUSDT','paymentGateways','🔍\x20Selected\x20trc20\x20wallet:\x20','createdAt','📊\x20Total\x20payments\x20(including\x20failed):\x20','aggregate','turnoverUSDT','deletePayout','toLowerCase','⚠️\x20Requested\x20gateway\x20\x27','2924110wHDQiS','_count','getAllPayments','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','usdcErcWallet','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','balance','txid',']\x20Gateway\x20settings\x20before\x20saving:','🔍\x20Selected\x20erc20_usdc\x20wallet:\x20','\x20USDT\x20(same\x20as\x20awaiting)','telegram','%\x20from\x20','__importDefault','adminNotes','\x27\x20(from\x20\x27','yesterday','localeCompare','2297084rkugVu','plisio','periodTo','setDate','gatewaySettings','delete','slice','\x20\x20\x20🌍\x20Country:\x20','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','📊\x20Sorting\x20payments\x20by\x20','dailyPayments','trim','\x20for\x20shop\x20','round','date','groupBy','📅\x20Date\x20to\x20filter:\x20','❌\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','map','Plisio','activateUser','findMany','🔧\x20[','updatePaymentStatus','\x20\x20\x20🌐\x20IP:\x20','getTime','\x20\x20\x20💳\x20Total\x20payments:\x20','toLocaleDateString','getPayoutById','week','periodFrom','🔍\x20Initial\x20wallet\x20from\x20request:\x20','default','\x20\x20\x20Available\x20(number):\x20','📅\x20Payout\x20date\x20to\x20filter:\x20','💰\x20Found\x20','\x20-\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','bcryptjs','CHARGEBACK','count','Open\x20Banking\x202','failUrl','test_gateway','Telegram\x20username\x20already\x20exists','erc20','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','wallet','getFullYear','create','fullName','\x20\x20\x20Added\x20to\x20balance:\x20+','🔄\x20Admin\x20updating\x20payment\x20','2155tBuKel','updateUser','rapyd','\x20USDT\x20(already\x20paid\x20out)','19596AGIqFH','✅\x20Payout\x20created:\x20','month','\x20in\x20','status','usdtErcWallet',':\x20commission\x20=\x20','Insufficient\x20balance.\x20Available:\x20','CoinToPay','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','turnover','PENDING','createUser'];a40_0x4d4e=function(){return _0x22c6d5;};return a40_0x4d4e();}(function(_0x109277,_0x527b18){const _0x15eafd=a40_0x4231,_0x578668=_0x109277();while(!![]){try{const _0x175e28=parseInt(_0x15eafd(0x24f))/0x1*(parseInt(_0x15eafd(0x243))/0x2)+parseInt(_0x15eafd(0x222))/0x3*(parseInt(_0x15eafd(0x1a2))/0x4)+-parseInt(_0x15eafd(0x1d8))/0x5*(parseInt(_0x15eafd(0x1dc))/0x6)+parseInt(_0x15eafd(0x190))/0x7+-parseInt(_0x15eafd(0x2b5))/0x8*(parseInt(_0x15eafd(0x2a7))/0x9)+-parseInt(_0x15eafd(0x25d))/0xa+parseInt(_0x15eafd(0x16c))/0xb;if(_0x175e28===_0x527b18)break;else _0x578668['push'](_0x578668['shift']());}catch(_0x402b4c){_0x578668['push'](_0x578668['shift']());}}}(a40_0x4d4e,0xbf1f8));function a40_0x4231(_0x513ed4,_0x397a89){const _0x4d4e00=a40_0x4d4e();return a40_0x4231=function(_0x4231db,_0x10b01f){_0x4231db=_0x4231db-0x15c;let _0x2558c5=_0x4d4e00[_0x4231db];return _0x2558c5;},a40_0x4231(_0x513ed4,_0x397a89);}var __importDefault=this&&this[a40_0x222d94(0x19d)]||function(_0x30b048){return _0x30b048&&_0x30b048['__esModule']?_0x30b048:{'default':_0x30b048};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x222d94(0x2a9)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a40_0x222d94(0x1c9))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService'),telegramBotService_1=require('./telegramBotService'),gateway_1=require('../types/gateway');class AdminService{async[a40_0x222d94(0x29f)](){const _0x16221b=a40_0x222d94;console[_0x16221b(0x174)](_0x16221b(0x295));const _0x139b47=await database_1[_0x16221b(0x1c3)][_0x16221b(0x265)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x16221b(0x183)}}),_0x3ea818=await database_1[_0x16221b(0x1c3)]['payment']['count']({'where':{'status':_0x16221b(0x262),'gateway':{'not':'test_gateway'}}}),_0x5ca7ba=new Date(),_0x3670aa=new Date(_0x5ca7ba[_0x16221b(0x1d3)](),_0x5ca7ba[_0x16221b(0x176)](),0x1),_0x5b624e=new Date(_0x5ca7ba[_0x16221b(0x1d3)](),_0x5ca7ba['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x186c3b=await database_1['default'][_0x16221b(0x2b7)][_0x16221b(0x18b)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3670aa,'lte':_0x5b624e},'status':'COMPLETED'}}),_0x5d8d38=_0x139b47[_0x16221b(0x21f)]['totalPaidOut']||0x0,_0x378766=_0x139b47[_0x16221b(0x21f)][_0x16221b(0x196)]||0x0,_0x543331=_0x186c3b[_0x16221b(0x21f)]['amount']||0x0,_0x30a253={'totalPayout':Math['round'](_0x5d8d38*0x64)/0x64,'awaitingPayout':Math['round'](_0x378766*0x64)/0x64,'thisMonth':Math[_0x16221b(0x1b0)](_0x543331*0x64)/0x64,'availableBalance':Math[_0x16221b(0x1b0)](_0x378766*0x64)/0x64,'totalPayments':_0x3ea818};return console[_0x16221b(0x174)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x16221b(0x174)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x30a253['totalPayout']+_0x16221b(0x1ef)),console[_0x16221b(0x174)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x30a253['awaitingPayout']+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console['log'](_0x16221b(0x1f2)+_0x30a253['availableBalance']+_0x16221b(0x19a)),console['log'](_0x16221b(0x21d)+_0x30a253[_0x16221b(0x23e)]+_0x16221b(0x241)),console[_0x16221b(0x174)](_0x16221b(0x1bd)+_0x30a253[_0x16221b(0x2a6)]+_0x16221b(0x211)),_0x30a253;}async[a40_0x222d94(0x203)](_0x63fa6,_0xeb4c53){const _0x17cb10=a40_0x222d94;console['log'](_0x17cb10(0x2a0)+_0x63fa6+':',_0xeb4c53);const _0x323b99=await database_1[_0x17cb10(0x1c3)][_0x17cb10(0x2b8)]['findUnique']({'where':{'id':_0x63fa6},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x323b99)throw new Error(_0x17cb10(0x291));const _0x49c2b0={};_0xeb4c53['customerCountry']!==undefined&&(_0x49c2b0[_0x17cb10(0x17a)]=_0xeb4c53['customerCountry']||null);_0xeb4c53[_0x17cb10(0x281)]!==undefined&&(_0x49c2b0[_0x17cb10(0x281)]=_0xeb4c53[_0x17cb10(0x281)]||null);_0xeb4c53[_0x17cb10(0x160)]!==undefined&&(_0x49c2b0[_0x17cb10(0x160)]=_0xeb4c53[_0x17cb10(0x160)]||null);const _0x552e3d=await database_1[_0x17cb10(0x1c3)][_0x17cb10(0x2b8)][_0x17cb10(0x2a8)]({'where':{'id':_0x63fa6},'data':{..._0x49c2b0,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x17cb10(0x174)](_0x17cb10(0x195)+_0x63fa6),console[_0x17cb10(0x174)](_0x17cb10(0x1a9)+_0x323b99[_0x17cb10(0x17a)]+_0x17cb10(0x177)+_0x552e3d[_0x17cb10(0x17a)]),console['log'](_0x17cb10(0x1bb)+_0x323b99[_0x17cb10(0x281)]+'\x20->\x20'+_0x552e3d['customerIp']),console['log']('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x323b99[_0x17cb10(0x160)]?_0x17cb10(0x16b):'not\x20set')+'\x20->\x20'+(_0x552e3d[_0x17cb10(0x160)]?_0x17cb10(0x16b):_0x17cb10(0x2b1))),_0x552e3d;}async[a40_0x222d94(0x1f0)](_0x2c31cf){const _0x99ee1d=a40_0x222d94,_0x24222e=new Date();let _0x5ce61f;switch(_0x2c31cf[_0x99ee1d(0x18e)]()){case _0x99ee1d(0x23d):_0x5ce61f=new Date(_0x24222e[_0x99ee1d(0x1d3)](),_0x24222e['getMonth'](),_0x24222e[_0x99ee1d(0x278)](),0x0,0x0,0x0,0x0);break;case _0x99ee1d(0x1a0):const _0x280fd7=new Date(_0x24222e);_0x280fd7[_0x99ee1d(0x1a5)](_0x280fd7[_0x99ee1d(0x278)]()-0x1),_0x5ce61f=new Date(_0x280fd7[_0x99ee1d(0x1d3)](),_0x280fd7['getMonth'](),_0x280fd7[_0x99ee1d(0x278)](),0x0,0x0,0x0,0x0);break;case'7d':_0x5ce61f=new Date(_0x24222e[_0x99ee1d(0x1bc)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x99ee1d(0x1f8):_0x5ce61f=new Date(_0x24222e[_0x99ee1d(0x1bc)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x5ce61f=new Date(_0x24222e[_0x99ee1d(0x1bc)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x99ee1d(0x23a):const _0x18a5fe=await database_1['default']['payment']['findFirst']({'where':{'gateway':{'not':_0x99ee1d(0x1ce)}},'orderBy':{'createdAt':_0x99ee1d(0x213)},'select':{'createdAt':!![]}});_0x5ce61f=_0x18a5fe?_0x18a5fe[_0x99ee1d(0x189)]:new Date(_0x99ee1d(0x26b));break;default:_0x5ce61f=new Date(_0x24222e[_0x99ee1d(0x1bc)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x5ce61f['setHours'](0x0,0x0,0x0,0x0);let _0x274773;if(_0x2c31cf[_0x99ee1d(0x18e)]()===_0x99ee1d(0x1a0)){const _0x2a6aa2=new Date(_0x24222e);_0x2a6aa2[_0x99ee1d(0x1a5)](_0x2a6aa2[_0x99ee1d(0x278)]()-0x1),_0x274773=new Date(_0x2a6aa2['getFullYear'](),_0x2a6aa2[_0x99ee1d(0x176)](),_0x2a6aa2[_0x99ee1d(0x278)](),0x17,0x3b,0x3b,0x3e7);}const _0x2c7e58={'gte':_0x5ce61f};_0x274773&&(_0x2c7e58[_0x99ee1d(0x235)]=_0x274773);const [_0x129431,_0x3f083c,_0x2f6ccf,_0x4502e4,_0x5c5c9,_0x27e56b]=await Promise[_0x99ee1d(0x23a)]([database_1['default'][_0x99ee1d(0x265)][_0x99ee1d(0x1cb)](),database_1[_0x99ee1d(0x1c3)][_0x99ee1d(0x265)][_0x99ee1d(0x1cb)]({'where':{'status':'ACTIVE'}}),database_1[_0x99ee1d(0x1c3)][_0x99ee1d(0x2b8)][_0x99ee1d(0x1cb)]({'where':{'status':_0x99ee1d(0x262),'createdAt':_0x2c7e58,'gateway':{'not':_0x99ee1d(0x1ce)}}}),database_1[_0x99ee1d(0x1c3)][_0x99ee1d(0x2b8)][_0x99ee1d(0x1b8)]({'where':{'status':_0x99ee1d(0x262),'createdAt':_0x2c7e58,'gateway':{'not':_0x99ee1d(0x1ce)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x99ee1d(0x2b8)][_0x99ee1d(0x1b8)]({'where':{'gateway':{'not':_0x99ee1d(0x1ce)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x99ee1d(0x1c3)][_0x99ee1d(0x2b8)][_0x99ee1d(0x1b8)]({'where':{'createdAt':_0x2c7e58,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0xee294c=0x0,_0x44fc4a=0x0;for(const _0x46a30b of _0x4502e4){const _0x5120b5=await currencyService_1['currencyService'][_0x99ee1d(0x252)](_0x46a30b['amount'],_0x46a30b[_0x99ee1d(0x27f)]);_0xee294c+=_0x5120b5;if(_0x46a30b[_0x99ee1d(0x275)]){const _0x49b7db=await currencyService_1[_0x99ee1d(0x212)][_0x99ee1d(0x252)](_0x46a30b[_0x99ee1d(0x20b)],_0x46a30b[_0x99ee1d(0x27f)]),_0x27aad3=_0x46a30b[_0x99ee1d(0x275)],_0xc3e198=_0x49b7db-_0x27aad3;_0x44fc4a+=_0xc3e198;}}const _0x4be583=_0x2f6ccf>0x0?_0xee294c/_0x2f6ccf:0x0,_0x24c972=this[_0x99ee1d(0x25e)](_0x27e56b,_0x5ce61f,_0x274773||_0x24222e),_0x563668=await database_1[_0x99ee1d(0x1c3)]['payment'][_0x99ee1d(0x1cb)]({'where':{'createdAt':_0x2c7e58,'gateway':{'not':_0x99ee1d(0x1ce)}}}),_0x1d95ea=_0x563668>0x0?_0x2f6ccf/_0x563668*0x64:0x0;return{'totalShops':_0x129431,'activeShops':_0x3f083c,'totalPayments':_0x2f6ccf,'successfulPayments':_0x2f6ccf,'totalAttempts':_0x563668,'totalRevenue':Math['round'](_0xee294c*0x64)/0x64,'trapayEarnings':Math[_0x99ee1d(0x1b0)](_0x44fc4a*0x64)/0x64,'averagePaymentAmount':Math[_0x99ee1d(0x1b0)](_0x4be583*0x64)/0x64,'conversionRate':Math[_0x99ee1d(0x1b0)](_0x1d95ea*0x64)/0x64,'dailyRevenue':_0x24c972[_0x99ee1d(0x283)],'dailyPayments':_0x24c972[_0x99ee1d(0x1ad)],'recentPayments':_0x5c5c9[_0x99ee1d(0x1b5)](_0x2001d6=>({'id':_0x2001d6['id'],'amount':_0x2001d6['amount'],'currency':_0x2001d6[_0x99ee1d(0x27f)],'status':_0x2001d6[_0x99ee1d(0x1e0)],'gateway':_0x2001d6[_0x99ee1d(0x20d)],'shop':_0x2001d6[_0x99ee1d(0x265)],'createdAt':_0x2001d6[_0x99ee1d(0x189)]}))};}async['getMerchantStatistics'](_0x4e467b){const _0x3402c9=a40_0x222d94;console['log'](_0x3402c9(0x259),_0x4e467b);let _0x4388f6,_0x4f7072=new Date();if(_0x4e467b['period']==='custom'&&_0x4e467b[_0x3402c9(0x28c)]&&_0x4e467b[_0x3402c9(0x258)])_0x4388f6=new Date(_0x4e467b[_0x3402c9(0x28c)]),_0x4f7072=new Date(_0x4e467b[_0x3402c9(0x258)]),_0x4388f6[_0x3402c9(0x2b9)](0x0,0x0,0x0,0x0),_0x4f7072[_0x3402c9(0x2b9)](0x17,0x3b,0x3b,0x3e7);else{const _0x2426ef=new Date();switch(_0x4e467b[_0x3402c9(0x276)]){case _0x3402c9(0x1c0):_0x4388f6=new Date(_0x2426ef[_0x3402c9(0x1bc)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3402c9(0x1de):_0x4388f6=new Date(_0x2426ef[_0x3402c9(0x1bc)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3402c9(0x242):_0x4388f6=new Date(_0x2426ef[_0x3402c9(0x1bc)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x3402c9(0x23a):default:_0x4388f6=new Date(_0x3402c9(0x26b));break;}_0x4388f6[_0x3402c9(0x2b9)](0x0,0x0,0x0,0x0),_0x4f7072[_0x3402c9(0x2b9)](0x17,0x3b,0x3b,0x3e7);}console[_0x3402c9(0x174)](_0x3402c9(0x16e)+_0x4388f6[_0x3402c9(0x2a2)]()+_0x3402c9(0x20c)+_0x4f7072[_0x3402c9(0x2a2)]());const _0x2528a7={'status':_0x3402c9(0x262),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x4388f6,'lte':_0x4f7072}};_0x4e467b[_0x3402c9(0x27d)]&&(_0x2528a7[_0x3402c9(0x27d)]=_0x4e467b[_0x3402c9(0x27d)]);const _0x506478=await database_1[_0x3402c9(0x1c3)][_0x3402c9(0x2b8)]['findMany']({'where':_0x2528a7,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3402c9(0x174)](_0x3402c9(0x1c6)+_0x506478[_0x3402c9(0x2ad)]+_0x3402c9(0x17d));const _0xd27062={'gateway':{'not':_0x3402c9(0x1ce)},'createdAt':{'gte':_0x4388f6,'lte':_0x4f7072}};_0x4e467b[_0x3402c9(0x27d)]&&(_0xd27062['shopId']=_0x4e467b[_0x3402c9(0x27d)]);const _0x14158a=await database_1[_0x3402c9(0x1c3)][_0x3402c9(0x2b8)][_0x3402c9(0x1cb)]({'where':_0xd27062});console[_0x3402c9(0x174)](_0x3402c9(0x18a)+_0x14158a+_0x3402c9(0x22e)+_0x506478[_0x3402c9(0x2ad)]);let _0x37ada4=0x0,_0x5f4bcb=0x0,_0x597fa9=0x0;const _0x61c1d9={},_0x2bd940={},_0xd515a7={};for(const _0x1a5a8 of _0x506478){try{const _0x31700d=_0x1a5a8[_0x3402c9(0x2b2)]||0x0;if(_0x31700d<=0x0){console[_0x3402c9(0x274)]('⚠️\x20Payment\x20'+_0x1a5a8['id']+_0x3402c9(0x21e));continue;}let _0x24f473,_0x5b1507;if(_0x1a5a8[_0x3402c9(0x275)]!==null&&_0x1a5a8['amountAfterGatewayCommissionUSDT']!==undefined)_0x24f473=_0x1a5a8['amountAfterGatewayCommissionUSDT'],_0x5b1507=_0x31700d-_0x24f473,console[_0x3402c9(0x174)](_0x3402c9(0x1ec)+_0x1a5a8['id']+':\x20'+_0x31700d['toFixed'](0x6)+_0x3402c9(0x179)+_0x24f473[_0x3402c9(0x23f)](0x6)+_0x3402c9(0x241));else{let _0x8055fb={};if(_0x1a5a8['shop']['gatewaySettings'])try{_0x8055fb=JSON[_0x3402c9(0x248)](_0x1a5a8[_0x3402c9(0x265)][_0x3402c9(0x1a6)]);}catch(_0x131f14){console[_0x3402c9(0x1ed)](_0x3402c9(0x29e)+_0x1a5a8[_0x3402c9(0x27d)]+':',_0x131f14);}let _0x177fb2=0x2d;for(const [_0x382bfe,_0x1a8a8a]of Object[_0x3402c9(0x165)](_0x8055fb)){if(_0x382bfe[_0x3402c9(0x18e)]()===_0x1a5a8['gateway']['toLowerCase']()){_0x177fb2=_0x1a8a8a[_0x3402c9(0x1fc)]||0x2d;break;}}_0x5b1507=_0x31700d*(_0x177fb2/0x64),_0x24f473=_0x31700d-_0x5b1507,console[_0x3402c9(0x174)](_0x3402c9(0x26a)+_0x1a5a8['id']+':\x20'+_0x177fb2+_0x3402c9(0x19c)+_0x31700d[_0x3402c9(0x23f)](0x6)+_0x3402c9(0x241));}_0x37ada4+=_0x31700d,_0x5f4bcb+=_0x24f473,_0x597fa9+=_0x5b1507;let _0x4cc5a3;_0x1a5a8[_0x3402c9(0x217)]!==null&&_0x1a5a8[_0x3402c9(0x217)]!==undefined?(_0x4cc5a3=_0x1a5a8[_0x3402c9(0x217)],console[_0x3402c9(0x174)](_0x3402c9(0x1aa)+_0x1a5a8['id']+':\x20'+_0x4cc5a3+'%')):(_0x4cc5a3=_0x31700d>0x0?_0x5b1507/_0x31700d*0x64:0x0,console[_0x3402c9(0x174)](_0x3402c9(0x267)+_0x1a5a8['id']+':\x20'+_0x4cc5a3[_0x3402c9(0x23f)](0x2)+'%'));!_0x61c1d9[_0x1a5a8[_0x3402c9(0x20d)]]&&(_0x61c1d9[_0x1a5a8[_0x3402c9(0x20d)]]={'gateway':_0x1a5a8[_0x3402c9(0x20d)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x1a5a8[_0x3402c9(0x20d)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x61c1d9[_0x1a5a8[_0x3402c9(0x20d)]][_0x3402c9(0x226)]++,_0x61c1d9[_0x1a5a8[_0x3402c9(0x20d)]][_0x3402c9(0x18c)]+=_0x31700d,_0x61c1d9[_0x1a5a8[_0x3402c9(0x20d)]][_0x3402c9(0x229)]+=_0x5b1507,_0x61c1d9[_0x1a5a8['gateway']][_0x3402c9(0x263)]+=_0x24f473,_0x61c1d9[_0x1a5a8[_0x3402c9(0x20d)]][_0x3402c9(0x16d)]+=_0x4cc5a3;!_0x4e467b['shopId']&&(!_0x2bd940[_0x1a5a8[_0x3402c9(0x27d)]]&&(_0x2bd940[_0x1a5a8[_0x3402c9(0x27d)]]={'shopId':_0x1a5a8['shopId'],'shopName':_0x1a5a8[_0x3402c9(0x265)]['name'],'shopUsername':_0x1a5a8[_0x3402c9(0x265)][_0x3402c9(0x20e)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2bd940[_0x1a5a8['shopId']][_0x3402c9(0x226)]++,_0x2bd940[_0x1a5a8[_0x3402c9(0x27d)]][_0x3402c9(0x18c)]+=_0x31700d,_0x2bd940[_0x1a5a8[_0x3402c9(0x27d)]][_0x3402c9(0x229)]+=_0x5b1507,_0x2bd940[_0x1a5a8[_0x3402c9(0x27d)]][_0x3402c9(0x263)]+=_0x24f473);const _0xb0f624=_0x1a5a8[_0x3402c9(0x24c)][_0x3402c9(0x2a2)]()['split']('T')[0x0];!_0xd515a7[_0xb0f624]&&(_0xd515a7[_0xb0f624]={'date':_0xb0f624,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xd515a7[_0xb0f624][_0x3402c9(0x1e7)]+=_0x31700d,_0xd515a7[_0xb0f624][_0x3402c9(0x288)]+=_0x24f473,_0xd515a7[_0xb0f624][_0x3402c9(0x21a)]+=_0x5b1507,_0xd515a7[_0xb0f624]['paymentsCount']++;}catch(_0x138e9a){console[_0x3402c9(0x1ed)](_0x3402c9(0x22b)+_0x1a5a8['id']+':',_0x138e9a);}}Object[_0x3402c9(0x219)](_0x61c1d9)[_0x3402c9(0x257)](_0x45b06d=>{const _0x1b2461=_0x3402c9;_0x45b06d[_0x1b2461(0x24d)]=_0x45b06d[_0x1b2461(0x226)]>0x0?_0x45b06d['totalCommissionRate']/_0x45b06d[_0x1b2461(0x226)]:0x0,delete _0x45b06d[_0x1b2461(0x16d)];}),Object[_0x3402c9(0x219)](_0x2bd940)[_0x3402c9(0x257)](_0x431216=>{const _0x4ad019=_0x3402c9;_0x431216[_0x4ad019(0x225)]=_0x431216[_0x4ad019(0x226)]>0x0?_0x431216[_0x4ad019(0x18c)]/_0x431216[_0x4ad019(0x226)]:0x0;});let _0x3fa805=0x0,_0x3ed9c9=0x0;if(_0x4e467b[_0x3402c9(0x27d)]){const _0x117461=await database_1[_0x3402c9(0x1c3)]['payout'][_0x3402c9(0x1b8)]({'where':{'shopId':_0x4e467b[_0x3402c9(0x27d)],'status':_0x3402c9(0x163),'createdAt':{'gte':_0x4388f6,'lte':_0x4f7072}},'select':{'amount':!![]}});_0x3fa805=_0x117461[_0x3402c9(0x171)]((_0x224a4a,_0x51cbc4)=>_0x224a4a+_0x51cbc4[_0x3402c9(0x20b)],0x0);const _0x46c024=await database_1['default'][_0x3402c9(0x2b7)]['findMany']({'where':{'shopId':_0x4e467b['shopId'],'status':_0x3402c9(0x1e8),'createdAt':{'gte':_0x4388f6,'lte':_0x4f7072}},'select':{'amount':!![]}});_0x3ed9c9=_0x46c024[_0x3402c9(0x171)]((_0x4b7725,_0x3e66ed)=>_0x4b7725+_0x3e66ed['amount'],0x0);}const _0xadd6f=_0x14158a,_0x53ea78=_0x506478[_0x3402c9(0x2ad)],_0x404280=_0x53ea78>0x0?_0x37ada4/_0x53ea78:0x0,_0x3731c5=_0xadd6f>0x0?Math['round'](_0x53ea78/_0xadd6f*0x2710)/0x64:0x0,_0x4c716c=Math[_0x3402c9(0x1f6)]((_0x4f7072[_0x3402c9(0x1bc)]()-_0x4388f6[_0x3402c9(0x1bc)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1f9d1e={'totalTurnover':Math[_0x3402c9(0x1b0)](_0x37ada4*0x64)/0x64,'merchantEarnings':Math[_0x3402c9(0x1b0)](_0x5f4bcb*0x64)/0x64,'gatewayEarnings':Math[_0x3402c9(0x1b0)](_0x597fa9*0x64)/0x64,'totalPaidOut':Math[_0x3402c9(0x1b0)](_0x3fa805*0x64)/0x64,'pendingPayout':Math[_0x3402c9(0x1b0)](_0x3ed9c9*0x64)/0x64,'averageCheck':Math['round'](_0x404280*0x64)/0x64,'totalPayments':_0xadd6f,'successfulPayments':_0x53ea78,'conversionRate':_0x3731c5,'gatewayBreakdown':Object['values'](_0x61c1d9)[_0x3402c9(0x1b5)](_0x4f2804=>({..._0x4f2804,'turnoverUSDT':Math[_0x3402c9(0x1b0)](_0x4f2804[_0x3402c9(0x18c)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x4f2804[_0x3402c9(0x229)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3402c9(0x1b0)](_0x4f2804[_0x3402c9(0x263)]*0x64)/0x64,'averageCommissionRate':Math[_0x3402c9(0x1b0)](_0x4f2804['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x4e467b[_0x3402c9(0x27d)]?undefined:Object['values'](_0x2bd940)[_0x3402c9(0x1b5)](_0x2a0da5=>({..._0x2a0da5,'turnoverUSDT':Math[_0x3402c9(0x1b0)](_0x2a0da5[_0x3402c9(0x18c)]*0x64)/0x64,'commissionUSDT':Math[_0x3402c9(0x1b0)](_0x2a0da5[_0x3402c9(0x229)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3402c9(0x1b0)](_0x2a0da5[_0x3402c9(0x263)]*0x64)/0x64,'paidOutUSDT':Math[_0x3402c9(0x1b0)](_0x2a0da5['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x3402c9(0x1b0)](_0x2a0da5[_0x3402c9(0x225)]*0x64)/0x64})),'dailyData':Object[_0x3402c9(0x219)](_0xd515a7)[_0x3402c9(0x1b5)](_0x531459=>({..._0x531459,'turnover':Math[_0x3402c9(0x1b0)](_0x531459['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x3402c9(0x1b0)](_0x531459['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x3402c9(0x1b0)](_0x531459[_0x3402c9(0x21a)]*0x64)/0x64}))[_0x3402c9(0x280)]((_0x50794d,_0x1608ee)=>_0x50794d['date'][_0x3402c9(0x1a1)](_0x1608ee[_0x3402c9(0x1b1)])),'periodInfo':{'from':_0x4388f6,'to':_0x4f7072,'periodType':_0x4e467b[_0x3402c9(0x276)]||_0x3402c9(0x24a),'daysCount':_0x4c716c}};return console[_0x3402c9(0x174)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x3402c9(0x174)](_0x3402c9(0x28e)+_0x1f9d1e['totalTurnover']+'\x20USDT'),console[_0x3402c9(0x174)](_0x3402c9(0x1c8)+_0x1f9d1e['merchantEarnings']+_0x3402c9(0x241)),console[_0x3402c9(0x174)](_0x3402c9(0x2b6)+_0x1f9d1e['gatewayEarnings']+_0x3402c9(0x241)),console['log'](_0x3402c9(0x1ab)+_0x1f9d1e[_0x3402c9(0x2a4)]+_0x3402c9(0x241)),console[_0x3402c9(0x174)]('\x20\x20\x20⏳\x20Pending\x20payout:\x20'+_0x1f9d1e[_0x3402c9(0x2a1)]+_0x3402c9(0x241)),console[_0x3402c9(0x174)](_0x3402c9(0x204)+_0x1f9d1e['totalPayments']),_0x1f9d1e;}async[a40_0x222d94(0x164)](_0x3f4afd){const _0x3c4dfb=a40_0x222d94;console[_0x3c4dfb(0x174)](_0x3c4dfb(0x247),{'hasPayoutHistory':_0x3f4afd});let _0x4f3ad1={'status':_0x3c4dfb(0x183)};_0x3f4afd&&(_0x4f3ad1[_0x3c4dfb(0x227)]={'some':{}});const _0x5b1f1a=await database_1['default'][_0x3c4dfb(0x265)][_0x3c4dfb(0x1b8)]({'where':_0x4f3ad1,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x3c4dfb(0x174)]('📋\x20Found\x20'+_0x5b1f1a[_0x3c4dfb(0x2ad)]+_0x3c4dfb(0x1f7)+(_0x3f4afd?_0x3c4dfb(0x27b):'')),_0x5b1f1a[_0x3c4dfb(0x1b5)](_0x51a6ba=>({'id':_0x51a6ba['id'],'username':_0x51a6ba[_0x3c4dfb(0x20e)],'name':_0x51a6ba[_0x3c4dfb(0x244)]}));}['getGatewayDisplayName'](_0x52e90c){const _0x4fe080=a40_0x222d94,_0x1fee29={'test_gateway':_0x4fe080(0x220),'plisio':_0x4fe080(0x1b6),'rapyd':'Rapyd','noda':_0x4fe080(0x272),'cointopay':_0x4fe080(0x1e4),'cointopay2':_0x4fe080(0x1cc),'klyme_eu':_0x4fe080(0x17c),'klyme_gb':'KLYME\x20GB','klyme_de':_0x4fe080(0x2af),'mastercard':_0x4fe080(0x20f)};return _0x1fee29[_0x52e90c]||_0x52e90c;}[a40_0x222d94(0x178)](_0x132f40){const _0x30c723=a40_0x222d94,_0xb1c944={'Test\x20Gateway':'test_gateway','Plisio':_0x30c723(0x1a3),'Rapyd':_0x30c723(0x1da),'Noda':_0x30c723(0x296),'CoinToPay':_0x30c723(0x167),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x30c723(0x2b4),'KLYME\x20GB':_0x30c723(0x175),'KLYME\x20DE':_0x30c723(0x16f),'MasterCard':_0x30c723(0x2a3)};return _0xb1c944[_0x132f40]||_0x132f40[_0x30c723(0x18e)]();}async[a40_0x222d94(0x210)](_0x4a954b){const _0x69b763=a40_0x222d94,{page:_0x42af2e,limit:_0x4332f3,minAmount:_0x1e5c5d,search:_0x150736}=_0x4a954b;console[_0x69b763(0x174)](_0x69b763(0x25c),_0x4a954b);let _0x3749e1={'status':_0x69b763(0x183)};_0x150736&&(_0x3749e1['name']={'contains':_0x150736,'mode':'insensitive'});const _0x4ff064=await database_1[_0x69b763(0x1c3)][_0x69b763(0x265)][_0x69b763(0x1b8)]({'where':_0x3749e1,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x3e80be=_0x4ff064[_0x69b763(0x180)](_0x18b0c7=>{const _0x51f7ee=_0x69b763,_0x30e184=Math[_0x51f7ee(0x1b0)](_0x18b0c7[_0x51f7ee(0x196)]*0x64)/0x64;if(_0x1e5c5d&&_0x30e184<_0x1e5c5d)return![];return _0x30e184!==0x0;});_0x3e80be[_0x69b763(0x280)]((_0x4502e5,_0x5209b2)=>_0x5209b2[_0x69b763(0x196)]-_0x4502e5[_0x69b763(0x196)]);const _0x38f62f=_0x3e80be[_0x69b763(0x2ad)],_0x3e1ff8=(_0x42af2e-0x1)*_0x4332f3,_0x1310c2=_0x3e80be[_0x69b763(0x1a8)](_0x3e1ff8,_0x3e1ff8+_0x4332f3);console[_0x69b763(0x174)](_0x69b763(0x1c6)+_0x1310c2[_0x69b763(0x2ad)]+_0x69b763(0x216));const _0x428ec1=await Promise[_0x69b763(0x23a)](_0x1310c2[_0x69b763(0x1b5)](async _0x243c30=>{const _0x125fe7=_0x69b763,[_0x194062,_0xe6327a,_0x552c89]=await Promise[_0x125fe7(0x23a)]([database_1['default'][_0x125fe7(0x2b8)][_0x125fe7(0x1cb)]({'where':{'shopId':_0x243c30['id'],'status':_0x125fe7(0x262),'gateway':{'not':_0x125fe7(0x1ce)}}}),database_1[_0x125fe7(0x1c3)][_0x125fe7(0x2b8)][_0x125fe7(0x200)]({'where':{'shopId':_0x243c30['id'],'status':'PAID','gateway':{'not':_0x125fe7(0x1ce)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x125fe7(0x1c3)][_0x125fe7(0x2b8)][_0x125fe7(0x1b2)]({'by':[_0x125fe7(0x20d)],'where':{'shopId':_0x243c30['id'],'status':_0x125fe7(0x262),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x347a78=new Date(),_0x307c2e=new Date(_0x347a78['getFullYear'](),_0x347a78[_0x125fe7(0x176)](),0x1),_0x415223=new Date(_0x347a78['getFullYear'](),_0x347a78['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x8cee00,_0x39f87a]=await Promise['all']([database_1['default'][_0x125fe7(0x2b7)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x243c30['id'],'status':_0x125fe7(0x163)}}),database_1[_0x125fe7(0x1c3)][_0x125fe7(0x2b7)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x243c30['id'],'status':'COMPLETED','createdAt':{'gte':_0x307c2e,'lte':_0x415223}}})]),_0x2a6901=_0x8cee00[_0x125fe7(0x21f)][_0x125fe7(0x20b)]||0x0,_0x2b45b0=_0x39f87a[_0x125fe7(0x21f)]['amount']||0x0,_0x3fb390=await Promise['all'](_0x552c89[_0x125fe7(0x1b5)](async _0x29a697=>{const _0x95304b=_0x125fe7;let _0x28e765=0x2d;if(_0x243c30[_0x95304b(0x1a6)])try{const _0x45b674=JSON[_0x95304b(0x248)](_0x243c30[_0x95304b(0x1a6)]);for(const [_0x5cb964,_0x5a7282]of Object['entries'](_0x45b674)){if(_0x5cb964[_0x95304b(0x18e)]()===_0x29a697[_0x95304b(0x20d)]['toLowerCase']()){_0x28e765=_0x5a7282[_0x95304b(0x1fc)]||0xa,console[_0x95304b(0x174)]('💰\x20[PAYOUT]\x20Gateway\x20'+_0x29a697[_0x95304b(0x20d)]+_0x95304b(0x1af)+_0x243c30['id']+_0x95304b(0x1e2)+_0x28e765+'%');break;}}}catch(_0x469c03){console[_0x95304b(0x1ed)](_0x95304b(0x29e)+_0x243c30['id']+':',_0x469c03);}const _0x1464c7=_0x29a697[_0x95304b(0x21f)]?.[_0x95304b(0x2b2)]||0x0,_0x1f2e9d=_0x1464c7*(0x1-_0x28e765/0x64);return{'gateway':_0x29a697[_0x95304b(0x20d)],'count':_0x29a697['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x1464c7*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x95304b(0x1b0)](_0x1f2e9d*0x64)/0x64,'commission':_0x28e765};})),_0x24d47e=_0x3fb390[_0x125fe7(0x171)]((_0x6e826b,_0x2b5bc7)=>_0x6e826b+_0x2b5bc7[_0x125fe7(0x2b2)],0x0),_0x4302df=_0x3fb390[_0x125fe7(0x171)]((_0x4983f5,_0x9f7972)=>_0x4983f5+_0x9f7972[_0x125fe7(0x231)],0x0),_0xcd68c=_0x243c30[_0x125fe7(0x196)];return console[_0x125fe7(0x174)]('💰\x20[PAYOUT]\x20Merchant\x20'+_0x243c30[_0x125fe7(0x20e)]+':'),console[_0x125fe7(0x174)]('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x24d47e[_0x125fe7(0x23f)](0x2)+_0x125fe7(0x2aa)),console[_0x125fe7(0x174)](_0x125fe7(0x284)+_0x4302df['toFixed'](0x2)+_0x125fe7(0x1eb)),console[_0x125fe7(0x174)](_0x125fe7(0x1e6)+_0xcd68c[_0x125fe7(0x23f)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console['log'](_0x125fe7(0x170)+_0x2a6901['toFixed'](0x2)+_0x125fe7(0x1db)),console[_0x125fe7(0x174)](_0x125fe7(0x223)+(_0x4302df-_0x2a6901-_0xcd68c)[_0x125fe7(0x23f)](0x2)+_0x125fe7(0x21c)),{'id':_0x243c30['id'],'fullName':_0x243c30['name'],'username':_0x243c30[_0x125fe7(0x20e)],'telegramId':_0x243c30[_0x125fe7(0x19b)],'merchantUrl':_0x243c30['shopUrl'],'wallets':{'usdtPolygonWallet':_0x243c30[_0x125fe7(0x182)],'usdtTrcWallet':_0x243c30[_0x125fe7(0x270)],'usdtErcWallet':_0x243c30[_0x125fe7(0x1e1)],'usdcPolygonWallet':_0x243c30['usdcPolygonWallet'],'usdcErcWallet':_0x243c30[_0x125fe7(0x194)]},'totalAmountUSDT':Math[_0x125fe7(0x1b0)](_0x24d47e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x125fe7(0x1b0)](_0x4302df*0x64)/0x64,'currentBalance':Math['round'](_0xcd68c*0x64)/0x64,'totalPayout':Math[_0x125fe7(0x1b0)](_0x2a6901*0x64)/0x64,'thisMonth':Math[_0x125fe7(0x1b0)](_0x2b45b0*0x64)/0x64,'paymentsCount':_0x194062,'oldestPaymentDate':_0xe6327a?.[_0x125fe7(0x24c)]||_0x243c30['createdAt'],'gatewayBreakdown':_0x3fb390};})),_0x3f15ac=_0x428ec1[_0x69b763(0x171)]((_0x5b2e99,_0x29e2d0)=>_0x5b2e99+_0x29e2d0[_0x69b763(0x186)],0x0),_0x47f088=_0x428ec1[_0x69b763(0x171)]((_0x36d7f6,_0x4592aa)=>_0x36d7f6+_0x4592aa[_0x69b763(0x28a)],0x0),_0x332335=_0x428ec1[_0x69b763(0x171)]((_0x10913a,_0xb44bda)=>_0x10913a+_0xb44bda['totalPayout'],0x0),_0x500338=_0x428ec1[_0x69b763(0x171)]((_0x29a30a,_0x808a0a)=>_0x29a30a+_0x808a0a[_0x69b763(0x23e)],0x0);return console[_0x69b763(0x174)](_0x69b763(0x15d)+_0x38f62f+'\x20merchants'),console['log']('\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20'+Math[_0x69b763(0x1b0)](_0x3f15ac*0x64)/0x64+_0x69b763(0x2aa)),console[_0x69b763(0x174)](_0x69b763(0x264)+Math['round'](_0x47f088*0x64)/0x64+_0x69b763(0x27a)),console[_0x69b763(0x174)](_0x69b763(0x193)+Math[_0x69b763(0x1b0)](_0x332335*0x64)/0x64+_0x69b763(0x241)),console[_0x69b763(0x174)](_0x69b763(0x168)+Math[_0x69b763(0x1b0)](_0x500338*0x64)/0x64+_0x69b763(0x241)),{'merchants':_0x428ec1,'pagination':{'page':_0x42af2e,'limit':_0x4332f3,'total':_0x38f62f,'totalPages':Math['ceil'](_0x38f62f/_0x4332f3)},'summary':{'totalMerchants':_0x38f62f,'totalAmountUSDT':Math[_0x69b763(0x1b0)](_0x3f15ac*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x69b763(0x1b0)](_0x47f088*0x64)/0x64,'totalPayout':Math[_0x69b763(0x1b0)](_0x332335*0x64)/0x64,'thisMonth':Math[_0x69b763(0x1b0)](_0x500338*0x64)/0x64}};}async['createPayout'](_0x3fd90c){const _0x31846a=a40_0x222d94,{shopId:_0x57279f,amount:_0x1a600b,network:_0x5c34f9,wallet:_0xc34593,notes:_0x2f5047,txid:_0x302e8d,periodFrom:_0x4a6633,periodTo:_0x6d5df0}=_0x3fd90c,_0x210b11=await database_1[_0x31846a(0x1c3)][_0x31846a(0x298)](async _0x483b1d=>{const _0xd63a52=_0x31846a,_0x45eb75=await _0x483b1d['shop'][_0xd63a52(0x16a)]({'where':{'id':_0x57279f},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x45eb75)throw new Error(_0xd63a52(0x282));console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x45eb75[_0xd63a52(0x20e)]+':'),console['log'](_0xd63a52(0x1e5)+_0x45eb75[_0xd63a52(0x196)]['toFixed'](0x6)+_0xd63a52(0x241)),console[_0xd63a52(0x174)](_0xd63a52(0x181)+_0x1a600b['toFixed'](0x6)+'\x20USDT'),console[_0xd63a52(0x174)](_0xd63a52(0x249)+_0x45eb75[_0xd63a52(0x2a4)][_0xd63a52(0x23f)](0x6)+_0xd63a52(0x241));if(_0x302e8d)console[_0xd63a52(0x174)](_0xd63a52(0x201)+_0x302e8d);const _0x1c933c=0.000001,_0x356246=Number(_0x45eb75[_0xd63a52(0x196)]),_0x4683c3=Number(_0x1a600b);console[_0xd63a52(0x174)](_0xd63a52(0x218)),console[_0xd63a52(0x174)]('\x20\x20\x20Available\x20(raw):\x20'+_0x45eb75['balance']),console[_0xd63a52(0x174)](_0xd63a52(0x1c4)+_0x356246),console[_0xd63a52(0x174)](_0xd63a52(0x286)+_0x4683c3),console['log'](_0xd63a52(0x254)+(_0x356246-_0x4683c3)),console[_0xd63a52(0x174)]('\x20\x20\x20Tolerance:\x20'+_0x1c933c);if(_0x356246<_0x4683c3-_0x1c933c)throw new Error(_0xd63a52(0x1e3)+_0x356246[_0xd63a52(0x23f)](0x6)+_0xd63a52(0x273)+_0x4683c3[_0xd63a52(0x23f)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x356246-_0x4683c3)[_0xd63a52(0x23f)](0x8)+_0xd63a52(0x241));console['log'](_0xd63a52(0x24e));const _0x4d4e7a=Math[_0xd63a52(0x266)](_0x356246,_0x4683c3);let _0x10e15f=_0xc34593;console[_0xd63a52(0x174)](_0xd63a52(0x1c2)+(_0xc34593||_0xd63a52(0x287)));if(!_0x10e15f){console['log'](_0xd63a52(0x232));const _0x69577b=await _0x483b1d['shop'][_0xd63a52(0x16a)]({'where':{'id':_0x57279f},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0xd63a52(0x174)]('🔍\x20Shop\x20wallets:',_0x69577b);if(_0x69577b)switch(_0x5c34f9){case _0xd63a52(0x1fa):_0x10e15f=_0x69577b['usdtPolygonWallet']||undefined,console[_0xd63a52(0x174)](_0xd63a52(0x21b)+_0x10e15f);break;case'trc20':_0x10e15f=_0x69577b[_0xd63a52(0x270)]||undefined,console[_0xd63a52(0x174)](_0xd63a52(0x188)+_0x10e15f);break;case _0xd63a52(0x1d0):_0x10e15f=_0x69577b[_0xd63a52(0x1e1)]||undefined,console[_0xd63a52(0x174)](_0xd63a52(0x25a)+_0x10e15f);break;case'polygon_usdc':_0x10e15f=_0x69577b['usdcPolygonWallet']||undefined,console[_0xd63a52(0x174)]('🔍\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x10e15f);break;case _0xd63a52(0x271):_0x10e15f=_0x69577b[_0xd63a52(0x194)]||undefined,console[_0xd63a52(0x174)](_0xd63a52(0x199)+_0x10e15f);break;}}else console[_0xd63a52(0x174)]('✅\x20Using\x20wallet\x20from\x20request:\x20'+_0x10e15f);console[_0xd63a52(0x174)](_0xd63a52(0x1fd)+_0x5c34f9+':\x20'+(_0x10e15f||_0xd63a52(0x277))),console[_0xd63a52(0x174)]('🔍\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x57279f,'amount':_0x4d4e7a,'network':_0x5c34f9,'wallet':_0x10e15f,'status':_0xd63a52(0x163),'txid':_0x302e8d,'notes':_0x2f5047,'periodFrom':_0x4a6633?new Date(_0x4a6633):null,'periodTo':_0x6d5df0?new Date(_0x6d5df0):null});const _0x29bfd9=await _0x483b1d['payout'][_0xd63a52(0x1d4)]({'data':{'shopId':_0x57279f,'amount':_0x4d4e7a,'network':_0x5c34f9,'wallet':_0x10e15f,'status':'COMPLETED','txid':_0x302e8d,'notes':_0x2f5047,'periodFrom':_0x4a6633?new Date(_0x4a6633):null,'periodTo':_0x6d5df0?new Date(_0x6d5df0):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0xd63a52(0x174)](_0xd63a52(0x1ff),{'id':_0x29bfd9['id'],'wallet':_0x29bfd9[_0xd63a52(0x1d2)],'network':_0x29bfd9[_0xd63a52(0x22c)],'amount':_0x29bfd9[_0xd63a52(0x20b)]});const _0x31522f=_0x356246-_0x4d4e7a,_0xffd864=Number(_0x45eb75[_0xd63a52(0x2a4)])+_0x4d4e7a;return await _0x483b1d[_0xd63a52(0x265)][_0xd63a52(0x2a8)]({'where':{'id':_0x57279f},'data':{'balance':_0x31522f,'totalPaidOut':_0xffd864}}),console[_0xd63a52(0x174)](_0xd63a52(0x2b0)+_0x45eb75[_0xd63a52(0x20e)]+'\x20balance\x20updated:'),console[_0xd63a52(0x174)](_0xd63a52(0x234)+_0x356246[_0xd63a52(0x23f)](0x6)+_0xd63a52(0x177)+_0x31522f[_0xd63a52(0x23f)](0x6)+_0xd63a52(0x205)+_0x4d4e7a['toFixed'](0x6)+')'),console['log'](_0xd63a52(0x22a)+_0x45eb75[_0xd63a52(0x2a4)]['toFixed'](0x6)+_0xd63a52(0x177)+_0xffd864[_0xd63a52(0x23f)](0x6)+'\x20USDT\x20(+'+_0x4d4e7a['toFixed'](0x6)+')'),console[_0xd63a52(0x174)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x4d4e7a['toFixed'](0x6)+_0xd63a52(0x241)),{'payout':_0x29bfd9,'shop':_0x45eb75};});console['log'](_0x31846a(0x1dd)+_0x210b11['payout']['id']+_0x31846a(0x1af)+_0x210b11[_0x31846a(0x265)][_0x31846a(0x20e)]+'\x20('+_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x20b)]['toFixed'](0x6)+_0x31846a(0x230));try{let _0x2f7868=_0x31846a(0x253);if(_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x1c1)]&&_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x1a4)]){const _0x4cb516=new Date(_0x210b11['payout'][_0x31846a(0x1c1)])['toLocaleDateString']('ru-RU'),_0x42f8f1=new Date(_0x210b11['payout'][_0x31846a(0x1a4)])[_0x31846a(0x1be)]('ru-RU');_0x2f7868=_0x4cb516+_0x31846a(0x1c7)+_0x42f8f1;}await telegramBotService_1[_0x31846a(0x221)][_0x31846a(0x202)](_0x210b11['payout'][_0x31846a(0x27d)],{'id':_0x210b11[_0x31846a(0x2b7)]['id'],'amount':_0x210b11[_0x31846a(0x2b7)]['amount'],'network':_0x210b11['payout'][_0x31846a(0x22c)],'wallet':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x1d2)],'period':_0x2f7868,'createdAt':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x189)],'txid':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x197)]}),console[_0x31846a(0x174)](_0x31846a(0x214)+_0x210b11[_0x31846a(0x2b7)]['id']);}catch(_0x17ff66){console[_0x31846a(0x1ed)](_0x31846a(0x1b4)+_0x210b11[_0x31846a(0x2b7)]['id']+':',_0x17ff66);}return{'id':_0x210b11[_0x31846a(0x2b7)]['id'],'shopId':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x27d)],'shopName':_0x210b11[_0x31846a(0x265)][_0x31846a(0x244)],'shopUsername':_0x210b11[_0x31846a(0x265)][_0x31846a(0x20e)],'amount':_0x210b11['payout']['amount'],'network':_0x210b11[_0x31846a(0x2b7)]['network'],'wallet':_0x210b11['payout'][_0x31846a(0x1d2)],'status':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x1e0)],'txid':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x197)],'notes':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x26e)],'periodFrom':_0x210b11[_0x31846a(0x2b7)]['periodFrom'],'periodTo':_0x210b11[_0x31846a(0x2b7)][_0x31846a(0x1a4)],'createdAt':_0x210b11['payout'][_0x31846a(0x189)],'paidAt':_0x210b11['payout'][_0x31846a(0x24c)]};}async[a40_0x222d94(0x185)](_0x446011){const _0x38595f=a40_0x222d94,{page:_0x1d0344,limit:_0x2fd150,shopId:_0x3982f0,network:_0x50a2fe,dateFrom:_0x6bcfb5,dateTo:_0x28b6bf,search:_0x331544}=_0x446011,_0x46a604=(_0x1d0344-0x1)*_0x2fd150,_0x5ea107={};_0x3982f0&&(_0x5ea107[_0x38595f(0x27d)]=_0x3982f0);_0x50a2fe&&(_0x5ea107[_0x38595f(0x22c)]=_0x50a2fe);if(_0x6bcfb5||_0x28b6bf){_0x5ea107[_0x38595f(0x189)]={};if(_0x6bcfb5){const _0x2e44b7=new Date(_0x6bcfb5);_0x2e44b7[_0x38595f(0x2b9)](0x0,0x0,0x0,0x1),_0x5ea107[_0x38595f(0x189)]['gte']=_0x2e44b7,console['log']('📅\x20Payout\x20date\x20from\x20filter:\x20'+_0x2e44b7[_0x38595f(0x2a2)]());}if(_0x28b6bf){const _0x5a4c52=new Date(_0x28b6bf);_0x5a4c52[_0x38595f(0x2b9)](0x17,0x3b,0x3b,0x3e7),_0x5ea107['createdAt'][_0x38595f(0x235)]=_0x5a4c52,console[_0x38595f(0x174)](_0x38595f(0x1c5)+_0x5a4c52[_0x38595f(0x2a2)]());}}_0x331544&&(_0x5ea107['OR']=[{'shop':{'name':{'contains':_0x331544,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x331544,'mode':_0x38595f(0x22f)}}},{'notes':{'contains':_0x331544,'mode':'insensitive'}}]);const [_0x1e7288,_0x563c1b]=await Promise[_0x38595f(0x23a)]([database_1['default'][_0x38595f(0x2b7)][_0x38595f(0x1b8)]({'where':_0x5ea107,'skip':_0x46a604,'take':_0x2fd150,'orderBy':{'createdAt':_0x38595f(0x27c)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x38595f(0x1c3)][_0x38595f(0x2b7)]['count']({'where':_0x5ea107})]);return{'payouts':_0x1e7288[_0x38595f(0x1b5)](_0x3be273=>({'id':_0x3be273['id'],'shopId':_0x3be273[_0x38595f(0x27d)],'shopName':_0x3be273['shop'][_0x38595f(0x244)],'shopUsername':_0x3be273['shop'][_0x38595f(0x20e)],'amount':_0x3be273[_0x38595f(0x20b)],'network':_0x3be273['network'],'wallet':_0x3be273[_0x38595f(0x1d2)],'status':_0x3be273['status'],'txid':_0x3be273[_0x38595f(0x197)],'notes':_0x3be273[_0x38595f(0x26e)],'periodFrom':_0x3be273[_0x38595f(0x1c1)],'periodTo':_0x3be273['periodTo'],'createdAt':_0x3be273[_0x38595f(0x189)],'paidAt':_0x3be273['paidAt']})),'pagination':{'page':_0x1d0344,'limit':_0x2fd150,'total':_0x563c1b,'totalPages':Math[_0x38595f(0x1f6)](_0x563c1b/_0x2fd150)}};}async[a40_0x222d94(0x1bf)](_0x5c676b){const _0x1604f8=a40_0x222d94,_0x4c067e=await database_1['default']['payout'][_0x1604f8(0x16a)]({'where':{'id':_0x5c676b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4c067e)return null;return{'id':_0x4c067e['id'],'shopId':_0x4c067e[_0x1604f8(0x27d)],'shopName':_0x4c067e['shop'][_0x1604f8(0x244)],'shopUsername':_0x4c067e['shop']['username'],'amount':_0x4c067e[_0x1604f8(0x20b)],'network':_0x4c067e[_0x1604f8(0x22c)],'wallet':_0x4c067e[_0x1604f8(0x1d2)],'status':_0x4c067e[_0x1604f8(0x1e0)],'txid':_0x4c067e[_0x1604f8(0x197)],'notes':_0x4c067e['notes'],'periodFrom':_0x4c067e['periodFrom'],'periodTo':_0x4c067e[_0x1604f8(0x1a4)],'createdAt':_0x4c067e['createdAt'],'paidAt':_0x4c067e['paidAt']};}async[a40_0x222d94(0x18d)](_0x4a0d26){const _0x28b180=a40_0x222d94;await database_1[_0x28b180(0x1c3)]['payout'][_0x28b180(0x1a7)]({'where':{'id':_0x4a0d26}});}async[a40_0x222d94(0x192)](_0x2c386d){const _0x5305bf=a40_0x222d94,{page:_0x41effb,limit:_0x54b708,status:_0x509b21,gateway:_0x1c5055,shopId:_0x37ac6f,dateFrom:_0x149775,dateTo:_0x442a9a,search:_0x2bd89d,currency:_0x5ac29b,sortBy:_0x39594a,sortOrder:_0x1809e2}=_0x2c386d,_0x5990d9=(_0x41effb-0x1)*_0x54b708;console['log'](_0x5305bf(0x250),_0x2c386d);const _0x54779b=await database_1[_0x5305bf(0x1c3)]['payment'][_0x5305bf(0x1b2)]({'by':[_0x5305bf(0x20d)],'_count':{'gateway':!![]}});console['log'](_0x5305bf(0x27e),_0x54779b['map'](_0x307d70=>_0x307d70['gateway']+'\x20('+_0x307d70[_0x5305bf(0x191)][_0x5305bf(0x20d)]+_0x5305bf(0x2ac)));if(_0x1c5055){const _0x1e7509=_0x54779b[_0x5305bf(0x269)](_0x3d4490=>_0x3d4490[_0x5305bf(0x20d)][_0x5305bf(0x18e)]()===_0x1c5055['toLowerCase']());!_0x1e7509&&_0x1c5055['toLowerCase']()!==_0x5305bf(0x1ce)&&console['log'](_0x5305bf(0x18f)+_0x1c5055+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x54779b['map'](_0x38b901=>_0x38b901['gateway'])[_0x5305bf(0x260)](',\x20'));}const _0x1edfba={};_0x509b21&&(_0x1edfba[_0x5305bf(0x1e0)]=_0x509b21[_0x5305bf(0x24b)]());if(!_0x1c5055)_0x1edfba['gateway']={'not':'test_gateway'};else{if(_0x1c5055&&(_0x1c5055[_0x5305bf(0x18e)]()==='test_gateway'||_0x1c5055===_0x5305bf(0x1f3)))_0x1edfba[_0x5305bf(0x20d)]=_0x5305bf(0x1ce);else{let _0x34a5ae=_0x1c5055;const _0x220c54=(0x0,gateway_1['getGatewayNameById'])(_0x1c5055);if(_0x220c54)_0x34a5ae=_0x220c54,console[_0x5305bf(0x174)]('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x1c5055+'\x27\x20to\x20name\x20\x27'+_0x34a5ae+'\x27');else{const _0xc8ad14=(0x0,gateway_1['getGatewayIdByName'])(_0x1c5055);if(_0xc8ad14){const _0x5cd57e=(0x0,gateway_1[_0x5305bf(0x17e)])(_0xc8ad14);_0x5cd57e&&(_0x34a5ae=_0x5cd57e,console[_0x5305bf(0x174)](_0x5305bf(0x161)+_0x1c5055+_0x5305bf(0x26c)+_0xc8ad14+_0x5305bf(0x255)+_0x34a5ae+'\x27'));}else console[_0x5305bf(0x174)](_0x5305bf(0x2ab)+_0x1c5055+_0x5305bf(0x1ee));}const _0x1d1efc=await database_1[_0x5305bf(0x1c3)][_0x5305bf(0x2b8)][_0x5305bf(0x1cb)]({'where':{'gateway':_0x34a5ae[_0x5305bf(0x18e)]()},'take':0x1});_0x1d1efc===0x0?(console[_0x5305bf(0x174)]('⚠️\x20Gateway\x20\x27'+_0x34a5ae+_0x5305bf(0x19f)+_0x1c5055+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x1edfba[_0x5305bf(0x20d)]='NONEXISTENT_GATEWAY_FILTER'):(_0x1edfba[_0x5305bf(0x20d)]=_0x34a5ae[_0x5305bf(0x18e)](),console[_0x5305bf(0x174)](_0x5305bf(0x17f)+_0x34a5ae+_0x5305bf(0x19f)+_0x1c5055+'\x27)'));}}console['log'](_0x5305bf(0x2b3),_0x1edfba[_0x5305bf(0x20d)]);_0x37ac6f&&(_0x1edfba[_0x5305bf(0x27d)]=_0x37ac6f);_0x5ac29b&&(_0x1edfba['currency']=_0x5ac29b[_0x5305bf(0x24b)](),console['log']('💱\x20Currency\x20filter\x20applied:\x20'+_0x5ac29b[_0x5305bf(0x24b)]()));if(_0x149775||_0x442a9a){_0x1edfba[_0x5305bf(0x189)]={};if(_0x149775){const _0x5e9def=new Date(_0x149775);_0x5e9def['setHours'](0x0,0x0,0x0,0x1),_0x1edfba[_0x5305bf(0x189)][_0x5305bf(0x25b)]=_0x5e9def,console['log']('📅\x20Date\x20from\x20filter:\x20'+_0x5e9def[_0x5305bf(0x2a2)]());}if(_0x442a9a){const _0x5afc82=new Date(_0x442a9a);_0x5afc82[_0x5305bf(0x2b9)](0x17,0x3b,0x3b,0x3e7),_0x1edfba[_0x5305bf(0x189)]['lte']=_0x5afc82,console[_0x5305bf(0x174)](_0x5305bf(0x1b3)+_0x5afc82[_0x5305bf(0x2a2)]());}}_0x2bd89d&&(_0x1edfba['OR']=[{'id':{'contains':_0x2bd89d,'mode':_0x5305bf(0x22f)}},{'orderId':{'contains':_0x2bd89d,'mode':_0x5305bf(0x22f)}},{'gatewayOrderId':{'contains':_0x2bd89d,'mode':_0x5305bf(0x22f)}},{'customerEmail':{'contains':_0x2bd89d,'mode':_0x5305bf(0x22f)}},{'shop':{'name':{'contains':_0x2bd89d,'mode':_0x5305bf(0x22f)}}},{'shop':{'username':{'contains':_0x2bd89d,'mode':_0x5305bf(0x22f)}}}]);console['log'](_0x5305bf(0x29a),JSON['stringify'](_0x1edfba,null,0x2));let _0x395924={'createdAt':'desc'};if(_0x39594a){const _0x8a450d=[_0x5305bf(0x20b),_0x5305bf(0x189),_0x5305bf(0x228),_0x5305bf(0x1e0),_0x5305bf(0x20d),_0x5305bf(0x27f)],_0x3d31dc=[_0x5305bf(0x213),_0x5305bf(0x27c)];if(_0x8a450d[_0x5305bf(0x1f5)](_0x39594a)){const _0xa3a1c4=_0x3d31dc[_0x5305bf(0x1f5)](_0x1809e2)?_0x1809e2:_0x5305bf(0x27c);_0x395924={[_0x39594a]:_0xa3a1c4},console['log'](_0x5305bf(0x1ac)+_0x39594a+_0x5305bf(0x1df)+_0xa3a1c4+_0x5305bf(0x285));}}const [_0x1455ea,_0x5d9c3a]=await Promise[_0x5305bf(0x23a)]([database_1[_0x5305bf(0x1c3)][_0x5305bf(0x2b8)]['findMany']({'where':_0x1edfba,'skip':_0x5990d9,'take':_0x54b708,'orderBy':_0x395924,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5305bf(0x1c3)]['payment'][_0x5305bf(0x1cb)]({'where':_0x1edfba})]);return{'payments':_0x1455ea,'pagination':{'page':_0x41effb,'limit':_0x54b708,'total':_0x5d9c3a,'totalPages':Math[_0x5305bf(0x1f6)](_0x5d9c3a/_0x54b708)}};}async['getPaymentById'](_0x4b7047){const _0x5e550e=a40_0x222d94,_0x1804c1=await database_1[_0x5e550e(0x1c3)][_0x5e550e(0x2b8)][_0x5e550e(0x16a)]({'where':{'id':_0x4b7047},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1804c1)return null;return{'id':_0x1804c1['id'],'shopId':_0x1804c1['shopId'],'gateway':_0x1804c1[_0x5e550e(0x20d)],'amount':_0x1804c1['amount'],'currency':_0x1804c1[_0x5e550e(0x27f)],'status':_0x1804c1[_0x5e550e(0x1e0)],'orderId':_0x1804c1['orderId'],'gatewayOrderId':_0x1804c1[_0x5e550e(0x169)],'customerEmail':_0x1804c1['customerEmail'],'customerName':_0x1804c1[_0x5e550e(0x239)],'customerCountry':_0x1804c1[_0x5e550e(0x17a)],'customerIp':_0x1804c1[_0x5e550e(0x281)],'customerUa':_0x1804c1[_0x5e550e(0x160)],'failureMessage':_0x1804c1[_0x5e550e(0x236)],'externalPaymentUrl':_0x1804c1['externalPaymentUrl'],'successUrl':_0x1804c1['successUrl'],'failUrl':_0x1804c1[_0x5e550e(0x1cd)],'pendingUrl':_0x1804c1[_0x5e550e(0x215)],'whiteUrl':_0x1804c1[_0x5e550e(0x172)],'createdAt':_0x1804c1['createdAt'],'updatedAt':_0x1804c1[_0x5e550e(0x228)],'shop':_0x1804c1['shop']};}async[a40_0x222d94(0x1ba)](_0x7c0332,_0x105ce2,_0x52324,_0x37ffb3){const _0x1a857f=a40_0x222d94,_0x2764bc=await database_1[_0x1a857f(0x1c3)][_0x1a857f(0x298)](async _0x1f7699=>{const _0x5a7347=_0x1a857f,_0xaba101=await _0x1f7699[_0x5a7347(0x2b8)][_0x5a7347(0x16a)]({'where':{'id':_0x7c0332},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xaba101)throw new Error('Payment\x20not\x20found');const _0x9dba1d=_0xaba101['status'],_0x461ae3=_0x105ce2[_0x5a7347(0x24b)]();console[_0x5a7347(0x174)](_0x5a7347(0x1d7)+_0x7c0332+_0x5a7347(0x237)+_0x9dba1d+_0x5a7347(0x177)+_0x461ae3),console[_0x5a7347(0x174)]('💰\x20Current\x20shop\x20balance:\x20'+_0xaba101['shop'][_0x5a7347(0x196)]+'\x20USDT');const _0x400430={'status':_0x461ae3,'updatedAt':new Date(),'statusChangedBy':_0x5a7347(0x17b),'statusChangedAt':new Date()};_0x52324&&(_0x400430[_0x5a7347(0x19e)]=_0x52324);_0x461ae3===_0x5a7347(0x1ca)&&_0x37ffb3&&(_0x400430['chargebackAmount']=_0x37ffb3);let _0x59b236=0x0,_0x15f045=_0xaba101[_0x5a7347(0x265)]['balance'];if(_0x461ae3==='PAID'&&_0x9dba1d!==_0x5a7347(0x262)){_0x400430[_0x5a7347(0x24c)]=new Date();const _0x5cf11b=await currencyService_1[_0x5a7347(0x212)]['convertToUSDT'](_0xaba101[_0x5a7347(0x20b)],_0xaba101['currency']);_0x400430[_0x5a7347(0x2b2)]=_0x5cf11b;let _0x5552ca=0x2d;const _0x584bbf=await _0x1f7699['shop'][_0x5a7347(0x16a)]({'where':{'id':_0xaba101[_0x5a7347(0x27d)]},'select':{'gatewaySettings':!![]}});if(_0x584bbf?.[_0x5a7347(0x1a6)])try{const _0x22e99a=JSON[_0x5a7347(0x248)](_0x584bbf['gatewaySettings']);for(const [_0x4bb410,_0x418522]of Object[_0x5a7347(0x165)](_0x22e99a)){if(_0x4bb410[_0x5a7347(0x18e)]()===_0xaba101[_0x5a7347(0x20d)][_0x5a7347(0x18e)]()){_0x5552ca=_0x418522[_0x5a7347(0x1fc)]||0xa;break;}}}catch(_0x579fab){console['error'](_0x5a7347(0x15f)+_0x7c0332+':',_0x579fab);}let _0x507da9;_0xaba101[_0x5a7347(0x275)]!==null&&_0xaba101[_0x5a7347(0x275)]!==undefined?(_0x507da9=_0xaba101[_0x5a7347(0x275)],console[_0x5a7347(0x174)](_0x5a7347(0x1d1)+_0x507da9[_0x5a7347(0x23f)](0x6)+_0x5a7347(0x240)+_0x7c0332)):(_0x507da9=_0x5cf11b*(0x1-_0x5552ca/0x64),console[_0x5a7347(0x174)](_0x5a7347(0x238)+_0x7c0332+':\x20'+_0x5552ca+_0x5a7347(0x19c)+_0x5cf11b[_0x5a7347(0x23f)](0x6)+_0x5a7347(0x241)),_0x400430[_0x5a7347(0x275)]=_0x507da9,_0x400430[_0x5a7347(0x217)]=_0x5552ca),_0x59b236=_0x507da9,_0x15f045+=_0x507da9,console['log']('💰\x20Payment\x20'+_0x7c0332+_0x5a7347(0x261)),console[_0x5a7347(0x174)](_0x5a7347(0x166)+_0x5cf11b[_0x5a7347(0x23f)](0x6)+_0x5a7347(0x241)),console[_0x5a7347(0x174)](_0x5a7347(0x28b)+_0xaba101[_0x5a7347(0x20d)]+_0x5a7347(0x1f1)+_0x5552ca+'%'),console['log']('\x20\x20\x20Merchant\x20gets:\x20'+_0x507da9[_0x5a7347(0x23f)](0x6)+_0x5a7347(0x22d)+_0x5552ca+_0x5a7347(0x268)),console[_0x5a7347(0x174)](_0x5a7347(0x1d6)+_0x507da9[_0x5a7347(0x23f)](0x6)+_0x5a7347(0x241));}else{if(_0x9dba1d===_0x5a7347(0x262)&&_0x461ae3!==_0x5a7347(0x262)&&_0x461ae3!==_0x5a7347(0x1ca)){if(_0xaba101[_0x5a7347(0x2b2)]){let _0x134327=0x2d;const _0x212a9f=await _0x1f7699[_0x5a7347(0x265)][_0x5a7347(0x16a)]({'where':{'id':_0xaba101[_0x5a7347(0x27d)]},'select':{'gatewaySettings':!![]}});if(_0x212a9f?.[_0x5a7347(0x1a6)])try{const _0x58ba38=JSON[_0x5a7347(0x248)](_0x212a9f[_0x5a7347(0x1a6)]);for(const [_0x1154ac,_0x3282bd]of Object[_0x5a7347(0x165)](_0x58ba38)){if(_0x1154ac[_0x5a7347(0x18e)]()===_0xaba101[_0x5a7347(0x20d)][_0x5a7347(0x18e)]()){_0x134327=_0x3282bd['commission']||0xa;break;}}}catch(_0x1060c2){console[_0x5a7347(0x1ed)](_0x5a7347(0x15f)+_0x7c0332+':',_0x1060c2);}const _0x2fab99=_0xaba101['amountUSDT']*(0x1-_0x134327/0x64);_0x59b236=-_0x2fab99,_0x15f045-=_0x2fab99,console[_0x5a7347(0x174)](_0x5a7347(0x166)+_0xaba101[_0x5a7347(0x2b2)]['toFixed'](0x6)+'\x20USDT'),console[_0x5a7347(0x174)](_0x5a7347(0x28b)+_0xaba101[_0x5a7347(0x20d)]+_0x5a7347(0x1f1)+_0x134327+'%'),console[_0x5a7347(0x174)](_0x5a7347(0x206)+_0x2fab99[_0x5a7347(0x23f)](0x6)+'\x20USDT\x20(after\x20'+_0x134327+'%\x20commission)'),console[_0x5a7347(0x174)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x2fab99[_0x5a7347(0x23f)](0x6)+_0x5a7347(0x241));}}}_0x461ae3===_0x5a7347(0x1ca)&&(console['log'](_0x5a7347(0x1fb)),_0x37ffb3&&_0x37ffb3>0x0?(_0x59b236=-_0x37ffb3,_0x15f045-=_0x37ffb3,console[_0x5a7347(0x174)](_0x5a7347(0x29d)+_0x37ffb3[_0x5a7347(0x23f)](0x6)+_0x5a7347(0x28f)),console[_0x5a7347(0x174)](_0x5a7347(0x289))):console[_0x5a7347(0x174)](_0x5a7347(0x251)),_0x400430[_0x5a7347(0x26f)]=_0x37ffb3||0x0);_0x461ae3===_0x5a7347(0x2ae)&&_0x9dba1d==='PAID'&&console[_0x5a7347(0x174)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x4202d9=await _0x1f7699[_0x5a7347(0x2b8)][_0x5a7347(0x2a8)]({'where':{'id':_0x7c0332},'data':_0x400430,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x59b236!==0x0&&(await _0x1f7699[_0x5a7347(0x265)]['update']({'where':{'id':_0xaba101[_0x5a7347(0x27d)]},'data':{'balance':_0x15f045}}),console[_0x5a7347(0x174)](_0x5a7347(0x2b0)+_0xaba101[_0x5a7347(0x27d)]+'\x20balance\x20updated:\x20'+_0xaba101[_0x5a7347(0x265)]['balance']['toFixed'](0x6)+_0x5a7347(0x177)+_0x15f045[_0x5a7347(0x23f)](0x6)+'\x20USDT\x20('+(_0x59b236>0x0?'+':'')+_0x59b236[_0x5a7347(0x23f)](0x6)+')')),_0x4202d9;});return{'id':_0x2764bc['id'],'shopId':_0x2764bc[_0x1a857f(0x27d)],'gateway':_0x2764bc[_0x1a857f(0x20d)],'amount':_0x2764bc[_0x1a857f(0x20b)],'currency':_0x2764bc['currency'],'status':_0x2764bc[_0x1a857f(0x1e0)],'orderId':_0x2764bc['orderId'],'gatewayOrderId':_0x2764bc[_0x1a857f(0x169)],'customerEmail':_0x2764bc[_0x1a857f(0x173)],'customerName':_0x2764bc['customerName'],'customerCountry':_0x2764bc[_0x1a857f(0x17a)],'customerIp':_0x2764bc[_0x1a857f(0x281)],'customerUa':_0x2764bc[_0x1a857f(0x160)],'failureMessage':_0x2764bc[_0x1a857f(0x236)],'adminNotes':_0x2764bc[_0x1a857f(0x19e)],'chargebackAmount':_0x2764bc[_0x1a857f(0x26f)],'statusChangedBy':_0x2764bc[_0x1a857f(0x29c)],'statusChangedAt':_0x2764bc['statusChangedAt'],'createdAt':_0x2764bc[_0x1a857f(0x189)],'updatedAt':_0x2764bc['updatedAt'],'shop':_0x2764bc[_0x1a857f(0x265)]};}async[a40_0x222d94(0x1d9)](_0x4b8192,_0x22235e){const _0x6edf98=a40_0x222d94,_0x828b7=Math[_0x6edf98(0x2a5)]()[_0x6edf98(0x292)](0x24)[_0x6edf98(0x294)](0x2,0x9);console[_0x6edf98(0x174)](_0x6edf98(0x15e)+_0x828b7+',\x20userId:\x20'+_0x4b8192);const _0x35dd2b={..._0x22235e};_0x22235e['password']&&_0x22235e[_0x6edf98(0x290)][_0x6edf98(0x1ae)]()!==''?(console[_0x6edf98(0x174)](_0x6edf98(0x1f4)+_0x828b7+']\x20Updating\x20password\x20for\x20user\x20'+_0x4b8192),_0x35dd2b[_0x6edf98(0x290)]=await bcryptjs_1[_0x6edf98(0x1c3)][_0x6edf98(0x23b)](_0x22235e[_0x6edf98(0x290)],0xc)):(console['log'](_0x6edf98(0x1f4)+_0x828b7+_0x6edf98(0x279)),delete _0x35dd2b[_0x6edf98(0x290)]);_0x22235e[_0x6edf98(0x1d5)]&&(_0x35dd2b[_0x6edf98(0x244)]=_0x22235e['fullName'],delete _0x35dd2b['fullName']);_0x22235e['telegramId']&&(_0x35dd2b[_0x6edf98(0x19b)]=_0x22235e[_0x6edf98(0x293)],delete _0x35dd2b[_0x6edf98(0x293)]);_0x22235e[_0x6edf98(0x209)]&&(_0x35dd2b['shopUrl']=_0x22235e[_0x6edf98(0x209)],delete _0x35dd2b[_0x6edf98(0x209)]);if(_0x22235e[_0x6edf98(0x28d)]){const _0x4f18c0=_0x22235e[_0x6edf98(0x28d)][_0x6edf98(0x1b5)](_0x5126e2=>this[_0x6edf98(0x178)](_0x5126e2));console[_0x6edf98(0x174)](_0x6edf98(0x20a),_0x22235e['gateways'],'->',_0x4f18c0),_0x35dd2b[_0x6edf98(0x187)]=JSON['stringify'](_0x4f18c0),delete _0x35dd2b['gateways'];}_0x22235e[_0x6edf98(0x1a6)]&&(console[_0x6edf98(0x174)](_0x6edf98(0x1b9)+_0x828b7+_0x6edf98(0x198),_0x22235e[_0x6edf98(0x1a6)]),_0x35dd2b['gatewaySettings']=JSON[_0x6edf98(0x1ea)](_0x22235e['gatewaySettings']),console['log']('🔧\x20['+_0x828b7+_0x6edf98(0x15c),_0x35dd2b[_0x6edf98(0x1a6)]));_0x22235e[_0x6edf98(0x1fe)]&&(_0x22235e[_0x6edf98(0x1fe)][_0x6edf98(0x182)]!==undefined&&(_0x35dd2b[_0x6edf98(0x182)]=_0x22235e[_0x6edf98(0x1fe)][_0x6edf98(0x182)]||null),_0x22235e['wallets']['usdtTrcWallet']!==undefined&&(_0x35dd2b['usdtTrcWallet']=_0x22235e['wallets'][_0x6edf98(0x270)]||null),_0x22235e[_0x6edf98(0x1fe)]['usdtErcWallet']!==undefined&&(_0x35dd2b['usdtErcWallet']=_0x22235e[_0x6edf98(0x1fe)][_0x6edf98(0x1e1)]||null),_0x22235e['wallets']['usdcPolygonWallet']!==undefined&&(_0x35dd2b['usdcPolygonWallet']=_0x22235e['wallets']['usdcPolygonWallet']||null),delete _0x35dd2b[_0x6edf98(0x1fe)]);const _0x91828a=await database_1[_0x6edf98(0x1c3)][_0x6edf98(0x265)][_0x6edf98(0x2a8)]({'where':{'id':_0x4b8192},'data':_0x35dd2b,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x6edf98(0x174)](_0x6edf98(0x245)+_0x828b7+_0x6edf98(0x26d),_0x91828a[_0x6edf98(0x1a6)]),{'id':_0x91828a['id'],'fullName':_0x91828a[_0x6edf98(0x244)],'username':_0x91828a[_0x6edf98(0x20e)],'telegramId':_0x91828a[_0x6edf98(0x19b)],'merchantUrl':_0x91828a['shopUrl'],'gateways':_0x91828a[_0x6edf98(0x187)]?JSON[_0x6edf98(0x248)](_0x91828a[_0x6edf98(0x187)]):null,'gatewaySettings':_0x91828a[_0x6edf98(0x1a6)]?JSON[_0x6edf98(0x248)](_0x91828a[_0x6edf98(0x1a6)]):null,'publicKey':_0x91828a[_0x6edf98(0x23c)],'wallets':{'usdtPolygonWallet':_0x91828a[_0x6edf98(0x182)],'usdtTrcWallet':_0x91828a[_0x6edf98(0x270)],'usdtErcWallet':_0x91828a[_0x6edf98(0x1e1)],'usdcPolygonWallet':_0x91828a[_0x6edf98(0x208)]},'status':_0x91828a[_0x6edf98(0x1e0)],'createdAt':_0x91828a[_0x6edf98(0x189)]};}async[a40_0x222d94(0x25f)](_0x23a478){const _0x51ccc2=a40_0x222d94,_0x595454=await database_1[_0x51ccc2(0x1c3)][_0x51ccc2(0x265)][_0x51ccc2(0x2a8)]({'where':{'id':_0x23a478},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x595454['id'],'fullName':_0x595454[_0x51ccc2(0x244)],'username':_0x595454[_0x51ccc2(0x20e)],'telegramId':_0x595454[_0x51ccc2(0x19b)],'merchantUrl':_0x595454['shopUrl'],'gateways':_0x595454[_0x51ccc2(0x187)]?JSON[_0x51ccc2(0x248)](_0x595454[_0x51ccc2(0x187)]):null,'gatewaySettings':_0x595454['gatewaySettings']?JSON[_0x51ccc2(0x248)](_0x595454[_0x51ccc2(0x1a6)]):null,'publicKey':_0x595454[_0x51ccc2(0x23c)],'wallets':{'usdtPolygonWallet':_0x595454['usdtPolygonWallet'],'usdtTrcWallet':_0x595454['usdtTrcWallet'],'usdtErcWallet':_0x595454['usdtErcWallet'],'usdcPolygonWallet':_0x595454['usdcPolygonWallet']},'status':_0x595454[_0x51ccc2(0x1e0)],'createdAt':_0x595454[_0x51ccc2(0x189)]};}async[a40_0x222d94(0x1b7)](_0x488188){const _0x52991a=a40_0x222d94,_0x4960e6=await database_1[_0x52991a(0x1c3)][_0x52991a(0x265)]['update']({'where':{'id':_0x488188},'data':{'status':_0x52991a(0x183)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4960e6['id'],'fullName':_0x4960e6['name'],'username':_0x4960e6[_0x52991a(0x20e)],'telegramId':_0x4960e6['telegram'],'merchantUrl':_0x4960e6[_0x52991a(0x299)],'gateways':_0x4960e6['paymentGateways']?JSON[_0x52991a(0x248)](_0x4960e6[_0x52991a(0x187)]):null,'gatewaySettings':_0x4960e6[_0x52991a(0x1a6)]?JSON[_0x52991a(0x248)](_0x4960e6[_0x52991a(0x1a6)]):null,'publicKey':_0x4960e6[_0x52991a(0x23c)],'wallets':{'usdtPolygonWallet':_0x4960e6[_0x52991a(0x182)],'usdtTrcWallet':_0x4960e6['usdtTrcWallet'],'usdtErcWallet':_0x4960e6[_0x52991a(0x1e1)],'usdcPolygonWallet':_0x4960e6[_0x52991a(0x208)]},'status':_0x4960e6['status'],'createdAt':_0x4960e6[_0x52991a(0x189)]};}async['getAllUsers'](_0xc2a9d0){const _0x4c90d4=a40_0x222d94,{page:_0x3399b9,limit:_0x5e66b3,status:_0x19efb6}=_0xc2a9d0,_0x545f9e=(_0x3399b9-0x1)*_0x5e66b3,_0x5a64c9={};_0x19efb6&&(_0x5a64c9['status']=_0x19efb6['toUpperCase']());const [_0x245db1,_0x18a6e7]=await Promise[_0x4c90d4(0x23a)]([database_1['default'][_0x4c90d4(0x265)]['findMany']({'where':_0x5a64c9,'skip':_0x545f9e,'take':_0x5e66b3,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4c90d4(0x1c3)][_0x4c90d4(0x265)][_0x4c90d4(0x1cb)]({'where':_0x5a64c9})]);return{'users':_0x245db1[_0x4c90d4(0x1b5)](_0x420e75=>{const _0x52c0de=_0x4c90d4,_0x41f9f3=_0x420e75[_0x52c0de(0x187)]?JSON['parse'](_0x420e75[_0x52c0de(0x187)]):null,_0x602ce9=_0x41f9f3?_0x41f9f3[_0x52c0de(0x1b5)](_0x50596f=>this[_0x52c0de(0x256)](_0x50596f)):null;return{'id':_0x420e75['id'],'fullName':_0x420e75[_0x52c0de(0x244)],'username':_0x420e75['username'],'telegramId':_0x420e75[_0x52c0de(0x19b)],'merchantUrl':_0x420e75[_0x52c0de(0x299)],'gateways':_0x602ce9,'gatewaySettings':_0x420e75['gatewaySettings']?JSON[_0x52c0de(0x248)](_0x420e75['gatewaySettings']):null,'publicKey':_0x420e75[_0x52c0de(0x23c)],'wallets':{'usdtPolygonWallet':_0x420e75[_0x52c0de(0x182)],'usdtTrcWallet':_0x420e75[_0x52c0de(0x270)],'usdtErcWallet':_0x420e75['usdtErcWallet'],'usdcPolygonWallet':_0x420e75[_0x52c0de(0x208)]},'status':_0x420e75[_0x52c0de(0x1e0)],'createdAt':_0x420e75['createdAt']};}),'pagination':{'page':_0x3399b9,'limit':_0x5e66b3,'total':_0x18a6e7,'totalPages':Math[_0x4c90d4(0x1f6)](_0x18a6e7/_0x5e66b3)}};}async[a40_0x222d94(0x162)](_0x505f12){const _0x22c3a8=a40_0x222d94,_0x109f3c=await database_1[_0x22c3a8(0x1c3)][_0x22c3a8(0x265)][_0x22c3a8(0x16a)]({'where':{'id':_0x505f12},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x109f3c)return null;const _0x325d5f=_0x109f3c[_0x22c3a8(0x187)]?JSON['parse'](_0x109f3c[_0x22c3a8(0x187)]):null,_0x334f4c=_0x325d5f?_0x325d5f['map'](_0x3786eb=>this[_0x22c3a8(0x256)](_0x3786eb)):null;return _0x325d5f&&_0x334f4c&&console['log']('🔄\x20Gateway\x20mapping\x20(get):',_0x325d5f,'->',_0x334f4c),{'id':_0x109f3c['id'],'fullName':_0x109f3c[_0x22c3a8(0x244)],'username':_0x109f3c[_0x22c3a8(0x20e)],'telegramId':_0x109f3c[_0x22c3a8(0x19b)],'merchantUrl':_0x109f3c['shopUrl'],'gateways':_0x334f4c,'gatewaySettings':_0x109f3c[_0x22c3a8(0x1a6)]?JSON['parse'](_0x109f3c[_0x22c3a8(0x1a6)]):null,'publicKey':_0x109f3c[_0x22c3a8(0x23c)],'wallets':{'usdtPolygonWallet':_0x109f3c[_0x22c3a8(0x182)],'usdtTrcWallet':_0x109f3c['usdtTrcWallet'],'usdtErcWallet':_0x109f3c[_0x22c3a8(0x1e1)],'usdcPolygonWallet':_0x109f3c[_0x22c3a8(0x208)]},'status':_0x109f3c['status'],'createdAt':_0x109f3c[_0x22c3a8(0x189)]};}async[a40_0x222d94(0x1e9)](_0x2db799){const _0x52e7f5=a40_0x222d94,{fullName:_0xd38c27,username:_0x576c76,password:_0x4b2642,telegramId:_0x5d2295,merchantUrl:_0x44bc40,gateways:_0x371a4a,gatewaySettings:_0xf2a367,wallets:_0x48449f}=_0x2db799,_0xef609f=await database_1[_0x52e7f5(0x1c3)][_0x52e7f5(0x265)][_0x52e7f5(0x16a)]({'where':{'username':_0x576c76}});if(_0xef609f)throw new Error('Username\x20already\x20exists');if(_0x5d2295){const _0x41bf76=await database_1[_0x52e7f5(0x1c3)][_0x52e7f5(0x265)][_0x52e7f5(0x16a)]({'where':{'telegram':_0x5d2295}});if(_0x41bf76)throw new Error(_0x52e7f5(0x1cf));}const _0x303e9c=await bcryptjs_1[_0x52e7f5(0x1c3)]['hash'](_0x4b2642,0xc),_0xd9b3c3=_0x52e7f5(0x184)+crypto_1['default'][_0x52e7f5(0x224)](0x20)['toString']('hex'),_0x5f3e6c='sk_'+crypto_1[_0x52e7f5(0x1c3)][_0x52e7f5(0x224)](0x20)[_0x52e7f5(0x292)]('hex'),_0x27575d=_0x371a4a?_0x371a4a['map'](_0x1dd03f=>this[_0x52e7f5(0x178)](_0x1dd03f)):null;_0x371a4a&&_0x27575d&&console[_0x52e7f5(0x174)](_0x52e7f5(0x246),_0x371a4a,'->',_0x27575d);const _0x7b7596=await database_1[_0x52e7f5(0x1c3)][_0x52e7f5(0x265)]['create']({'data':{'name':_0xd38c27,'username':_0x576c76,'password':_0x303e9c,'telegram':_0x5d2295,'shopUrl':_0x44bc40,'paymentGateways':_0x27575d?JSON[_0x52e7f5(0x1ea)](_0x27575d):null,'gatewaySettings':_0xf2a367?JSON[_0x52e7f5(0x1ea)](_0xf2a367):null,'usdtPolygonWallet':_0x48449f?.[_0x52e7f5(0x182)]||null,'usdtTrcWallet':_0x48449f?.[_0x52e7f5(0x270)]||null,'usdtErcWallet':_0x48449f?.[_0x52e7f5(0x1e1)]||null,'usdcPolygonWallet':_0x48449f?.[_0x52e7f5(0x208)]||null,'publicKey':_0xd9b3c3,'secretKey':_0x5f3e6c,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x7b7596['id'],'fullName':_0x7b7596['name'],'username':_0x7b7596[_0x52e7f5(0x20e)],'telegramId':_0x7b7596['telegram'],'merchantUrl':_0x7b7596[_0x52e7f5(0x299)],'gateways':_0x7b7596['paymentGateways']?JSON[_0x52e7f5(0x248)](_0x7b7596[_0x52e7f5(0x187)]):null,'gatewaySettings':_0x7b7596['gatewaySettings']?JSON[_0x52e7f5(0x248)](_0x7b7596[_0x52e7f5(0x1a6)]):null,'publicKey':_0x7b7596[_0x52e7f5(0x23c)],'wallets':{'usdtPolygonWallet':_0x7b7596['usdtPolygonWallet'],'usdtTrcWallet':_0x7b7596[_0x52e7f5(0x270)],'usdtErcWallet':_0x7b7596[_0x52e7f5(0x1e1)],'usdcPolygonWallet':_0x7b7596[_0x52e7f5(0x208)]},'status':_0x7b7596['status'],'createdAt':_0x7b7596[_0x52e7f5(0x189)]};}async['deleteUser'](_0xdd1802){const _0x2884f0=a40_0x222d94;await database_1[_0x2884f0(0x1c3)][_0x2884f0(0x265)][_0x2884f0(0x1a7)]({'where':{'id':_0xdd1802}});}['generateDailyStatistics'](_0x528222,_0x16fc7f,_0x2fd809){const _0xf61e30=a40_0x222d94,_0xa5a652=new Map(),_0x115687=new Date(_0x16fc7f);while(_0x115687<=_0x2fd809){const _0x99fb68=_0x115687[_0xf61e30(0x2a2)]()[_0xf61e30(0x29b)]('T')[0x0];_0xa5a652[_0xf61e30(0x16b)](_0x99fb68,{'revenue':0x0,'count':0x0}),_0x115687[_0xf61e30(0x1a5)](_0x115687[_0xf61e30(0x278)]()+0x1);}for(const _0x542d7f of _0x528222){const _0x2be174=_0x542d7f[_0xf61e30(0x189)][_0xf61e30(0x2a2)]()[_0xf61e30(0x29b)]('T')[0x0],_0xeed88c=_0xa5a652[_0xf61e30(0x1f9)](_0x2be174);_0xeed88c&&(_0xeed88c[_0xf61e30(0x1cb)]+=0x1,_0x542d7f[_0xf61e30(0x1e0)]==='PAID'&&(_0x542d7f[_0xf61e30(0x2b2)]?_0xeed88c['revenue']+=_0x542d7f['amountUSDT']:console['log'](_0xf61e30(0x297)+_0x542d7f['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x2adc97=[],_0x311190=[];for(const [_0x521599,_0x237a7a]of _0xa5a652){_0x2adc97[_0xf61e30(0x207)]({'date':_0x521599,'amount':Math[_0xf61e30(0x1b0)](_0x237a7a[_0xf61e30(0x233)]*0x64)/0x64}),_0x311190[_0xf61e30(0x207)]({'date':_0x521599,'count':_0x237a7a['count']});}return{'dailyRevenue':_0x2adc97,'dailyPayments':_0x311190};}}exports['AdminService']=AdminService;