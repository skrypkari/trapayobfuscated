'use strict';const a41_0x2d4de8=a41_0x4ae4;function a41_0x5973(){const _0xc2067b=['nzd','log','\x20currencies','findMany','2923440HKcmWD','aed','sek','getRatesStatus','brl','Payment\x20System/1.0','keys','error','getCurrencyRate','convertToUSDT','9346158oqcuxB','ils','currency','lkr','statusText','gel','tether','findFirst','btc','map','cad','length','xau','toFixed','jpy','json','Error\x20converting\x20','COINGECKO_URL','warn','760728LzRHGX','No\x20rate\x20found\x20for\x20currency:\x20','dkk','findUnique','xrp','rate','\x20USDT','inr','myr','Initial\x20currency\x20rates\x20update\x20failed:','sar','18534dSXxmB','eth','\x20USDT\x20=\x20','entries','yfi','toUpperCase','eur','CurrencyService','currencyRate','Error\x20getting\x20all\x20rates:','\x20USDT,\x20with\x20',',\x20using\x201\x20as\x20fallback','aud','dot','MARKUP_PERCENTAGE','twd','allSettled','usd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','try','❌\x20Failed\x20to\x20update\x20currency\x20rates:','7618164TFLVay','vef','join','link','bdt','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','asc','xlm','mxn','💱\x20Applied\x20','getMarkupPercentage','krw','bnb','https://api.coingecko.com/api/v3/simple/price','updateCurrencyRates','__esModule','219anOrvh','%\x20markup\x20to\x20','count','eos','application/json','upsert','updatedAt','convertMultipleToUSDT','usdt','default','kwd','\x20to\x20','vnd','1600184lOnmDa','sats','hkd','all','bmd','bhd','pln','nok','uah','huf','getAllRates','updateInterval','stopPeriodicUpdates','catch','chf','startPeriodicUpdates','Periodic\x20currency\x20rates\x20update\x20failed:','mmk','3468248WfzhLO','✅\x20Currency\x20rates\x20updated\x20successfully','CURRENCIES','forEach','gbp','7RKVgRM','sgd','bits','toLowerCase','desc','currencyService','thb','Error\x20getting\x20rates\x20status:','Failed\x20to\x20update\x20rate\x20for\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...'];a41_0x5973=function(){return _0xc2067b;};return a41_0x5973();}(function(_0x51dd0c,_0x960bc4){const _0x56d3f3=a41_0x4ae4,_0x354112=_0x51dd0c();while(!![]){try{const _0x5c33ed=parseInt(_0x56d3f3(0x1a0))/0x1+parseInt(_0x56d3f3(0x1ab))/0x2*(parseInt(_0x56d3f3(0x1d0))/0x3)+-parseInt(_0x56d3f3(0x1ef))/0x4+parseInt(_0x56d3f3(0x202))/0x5+-parseInt(_0x56d3f3(0x1c0))/0x6+parseInt(_0x56d3f3(0x1f4))/0x7*(-parseInt(_0x56d3f3(0x1dd))/0x8)+parseInt(_0x56d3f3(0x20c))/0x9;if(_0x5c33ed===_0x960bc4)break;else _0x354112['push'](_0x354112['shift']());}catch(_0x619029){_0x354112['push'](_0x354112['shift']());}}}(a41_0x5973,0xb0a86));function a41_0x4ae4(_0x55e44d,_0x547b97){const _0x597333=a41_0x5973();return a41_0x4ae4=function(_0x4ae4fc,_0x2f3751){_0x4ae4fc=_0x4ae4fc-0x1a0;let _0x3bbcf7=_0x597333[_0x4ae4fc];return _0x3bbcf7;},a41_0x4ae4(_0x55e44d,_0x547b97);}var __importDefault=this&&this['__importDefault']||function(_0xc06cee){const _0x37ce3e=a41_0x4ae4;return _0xc06cee&&_0xc06cee[_0x37ce3e(0x1cf)]?_0xc06cee:{'default':_0xc06cee};};Object['defineProperty'](exports,a41_0x2d4de8(0x1cf),{'value':!![]}),exports['currencyService']=exports[a41_0x2d4de8(0x1b2)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x2929cc=a41_0x2d4de8;this['COINGECKO_URL']=_0x2929cc(0x1cd),this[_0x2929cc(0x1f1)]=[_0x2929cc(0x214),_0x2929cc(0x1ac),'ltc','bch',_0x2929cc(0x1cc),_0x2929cc(0x1d3),_0x2929cc(0x1a4),_0x2929cc(0x1c7),_0x2929cc(0x1c3),_0x2929cc(0x1b8),_0x2929cc(0x1af),_0x2929cc(0x1bc),_0x2929cc(0x203),'ars',_0x2929cc(0x1b7),_0x2929cc(0x1c4),_0x2929cc(0x1e2),_0x2929cc(0x1e1),_0x2929cc(0x206),_0x2929cc(0x216),_0x2929cc(0x1eb),'clp','cny','czk',_0x2929cc(0x1a2),_0x2929cc(0x1b1),_0x2929cc(0x1f3),_0x2929cc(0x211),_0x2929cc(0x1df),_0x2929cc(0x1e6),'idr',_0x2929cc(0x20d),_0x2929cc(0x1a7),_0x2929cc(0x21a),_0x2929cc(0x1cb),_0x2929cc(0x1da),_0x2929cc(0x20f),_0x2929cc(0x1ee),_0x2929cc(0x1c8),_0x2929cc(0x1a8),'ngn',_0x2929cc(0x1e4),_0x2929cc(0x1fe),'php','pkr',_0x2929cc(0x1e3),'rub',_0x2929cc(0x1aa),_0x2929cc(0x204),_0x2929cc(0x1f5),_0x2929cc(0x1fa),_0x2929cc(0x1be),_0x2929cc(0x1ba),_0x2929cc(0x1e5),_0x2929cc(0x1c1),_0x2929cc(0x1dc),'zar','xdr','xag',_0x2929cc(0x218),_0x2929cc(0x1f6),_0x2929cc(0x1de)],this[_0x2929cc(0x1e8)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x2929cc(0x1ec)]();}[a41_0x2d4de8(0x1ec)](){const _0x66b480=a41_0x2d4de8;this['updateCurrencyRates']()[_0x66b480(0x1ea)](_0x121055=>{const _0x45efa7=_0x66b480;console[_0x45efa7(0x209)](_0x45efa7(0x1a9),_0x121055);}),this[_0x66b480(0x1e8)]=setInterval(async()=>{const _0x59369b=_0x66b480;try{await this[_0x59369b(0x1ce)]();}catch(_0x16360a){console['error'](_0x59369b(0x1ed),_0x16360a);}},0x3c*0x3c*0x3e8),console[_0x66b480(0x1ff)](_0x66b480(0x1c5));}[a41_0x2d4de8(0x1e9)](){const _0x89342c=a41_0x2d4de8;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x89342c(0x1e8)]=null,console[_0x89342c(0x1ff)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x3ca08c=a41_0x2d4de8;try{console[_0x3ca08c(0x1ff)](_0x3ca08c(0x1fd));const _0xd473f1=this[_0x3ca08c(0x1f1)][_0x3ca08c(0x1c2)](','),_0x173505=this[_0x3ca08c(0x21d)]+'?ids=tether&vs_currencies='+_0xd473f1,_0x11b44c=await fetch(_0x173505,{'headers':{'Accept':_0x3ca08c(0x1d4),'User-Agent':_0x3ca08c(0x207)}});if(!_0x11b44c['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x11b44c['status']+'\x20'+_0x11b44c[_0x3ca08c(0x210)]);const _0x1f3804=await _0x11b44c[_0x3ca08c(0x21b)]();if(!_0x1f3804[_0x3ca08c(0x212)])throw new Error(_0x3ca08c(0x1bd));const _0x5c0b80=_0x1f3804[_0x3ca08c(0x212)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x3ca08c(0x208)](_0x5c0b80)[_0x3ca08c(0x217)]+_0x3ca08c(0x200));const _0x20f6b0=Object[_0x3ca08c(0x1ae)](_0x5c0b80)[_0x3ca08c(0x215)](async([_0x37f2a4,_0xdf2610])=>{const _0x35f109=_0x3ca08c;try{await database_1[_0x35f109(0x1d9)]['currencyRate'][_0x35f109(0x1d5)]({'where':{'currency':_0x37f2a4['toLowerCase']()},'update':{'rate':_0xdf2610},'create':{'currency':_0x37f2a4[_0x35f109(0x1f7)](),'rate':_0xdf2610}});}catch(_0x2fd2d1){console[_0x35f109(0x209)](_0x35f109(0x1fc)+_0x37f2a4+':',_0x2fd2d1);}});await Promise[_0x3ca08c(0x1bb)](_0x20f6b0),console[_0x3ca08c(0x1ff)](_0x3ca08c(0x1f0));}catch(_0x23b486){console['error'](_0x3ca08c(0x1bf),_0x23b486);throw _0x23b486;}}async['getCurrencyRate'](_0x275dd7){const _0x312e59=a41_0x2d4de8,_0x156f86=_0x275dd7[_0x312e59(0x1f7)]();if(_0x156f86===_0x312e59(0x1d8))return 0x1;try{const _0xba46ac=await database_1[_0x312e59(0x1d9)][_0x312e59(0x1b3)][_0x312e59(0x1a3)]({'where':{'currency':_0x156f86}});if(!_0xba46ac)return console[_0x312e59(0x21e)](_0x312e59(0x1a1)+_0x275dd7+_0x312e59(0x1b6)),0x1;return _0xba46ac[_0x312e59(0x1a5)];}catch(_0x52077f){return console[_0x312e59(0x209)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x275dd7+':',_0x52077f),0x1;}}async[a41_0x2d4de8(0x20b)](_0x71df7,_0x8db251){const _0x271f23=a41_0x2d4de8,_0x4c8d59=_0x8db251['toLowerCase']();if(_0x4c8d59===_0x271f23(0x1d8)){const _0x4dd11e=_0x71df7*(0x1+this[_0x271f23(0x1b9)]/0x64);return console['log'](_0x271f23(0x1c9)+this[_0x271f23(0x1b9)]+_0x271f23(0x1d1)+_0x71df7+_0x271f23(0x1ad)+_0x4dd11e[_0x271f23(0x219)](0x6)+_0x271f23(0x1a6)),_0x4dd11e;}try{const _0x17cbdd=await this[_0x271f23(0x20a)](_0x4c8d59),_0x5deb84=_0x71df7/_0x17cbdd,_0x50e155=_0x5deb84*(0x1+this[_0x271f23(0x1b9)]/0x64);return console[_0x271f23(0x1ff)]('💱\x20Converted\x20'+_0x71df7+'\x20'+_0x8db251[_0x271f23(0x1b0)]()+_0x271f23(0x1db)+_0x5deb84[_0x271f23(0x219)](0x6)+_0x271f23(0x1b5)+this[_0x271f23(0x1b9)]+'%\x20markup\x20=\x20'+_0x50e155[_0x271f23(0x219)](0x6)+'\x20USDT\x20(rate:\x20'+_0x17cbdd+')'),_0x50e155;}catch(_0x43f9b){console[_0x271f23(0x209)](_0x271f23(0x21c)+_0x71df7+'\x20'+_0x8db251+'\x20to\x20USDT:',_0x43f9b);const _0x2013f1=_0x71df7*(0x1+this[_0x271f23(0x1b9)]/0x64);return _0x2013f1;}}async[a41_0x2d4de8(0x1d7)](_0x4ca517){let _0x19cd11=0x0;for(const {amount:_0x2d13dd,currency:_0x2788cd}of _0x4ca517){const _0x13232f=await this['convertToUSDT'](_0x2d13dd,_0x2788cd);_0x19cd11+=_0x13232f;}return _0x19cd11;}async[a41_0x2d4de8(0x1e7)](){const _0xd129b4=a41_0x2d4de8;try{const _0x1f6208=await database_1[_0xd129b4(0x1d9)]['currencyRate'][_0xd129b4(0x201)]({'select':{'currency':!![],'rate':!![]}}),_0x1c86d9={'usdt':0x1};return _0x1f6208[_0xd129b4(0x1f2)](_0x48a5e4=>{const _0x2c414b=_0xd129b4;_0x1c86d9[_0x48a5e4[_0x2c414b(0x20e)]]=_0x48a5e4['rate'];}),_0x1c86d9;}catch(_0x2804b9){return console['error'](_0xd129b4(0x1b4),_0x2804b9),{'usdt':0x1};}}async[a41_0x2d4de8(0x205)](){const _0x4093b1=a41_0x2d4de8;try{const [_0x39f7c7,_0x5b6239,_0x2d329f]=await Promise[_0x4093b1(0x1e0)]([database_1[_0x4093b1(0x1d9)][_0x4093b1(0x1b3)][_0x4093b1(0x1d2)](),database_1[_0x4093b1(0x1d9)][_0x4093b1(0x1b3)]['findFirst']({'orderBy':{'updatedAt':_0x4093b1(0x1f8)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x4093b1(0x213)]({'orderBy':{'updatedAt':_0x4093b1(0x1c6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x39f7c7,'lastUpdated':_0x5b6239?.[_0x4093b1(0x1d6)]||null,'oldestRate':_0x2d329f?.[_0x4093b1(0x1d6)]||null,'markupPercentage':this[_0x4093b1(0x1b9)]};}catch(_0x505ea4){return console['error'](_0x4093b1(0x1fb),_0x505ea4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4093b1(0x1b9)]};}}[a41_0x2d4de8(0x1ca)](){const _0x3cf5a4=a41_0x2d4de8;return this[_0x3cf5a4(0x1b9)];}}exports[a41_0x2d4de8(0x1b2)]=CurrencyService,exports[a41_0x2d4de8(0x1f9)]=new CurrencyService();