'use strict';const a39_0x116802=a39_0x1413;(function(_0x50bea7,_0x276c38){const _0x29f24d=a39_0x1413,_0x5efaa0=_0x50bea7();while(!![]){try{const _0x27d97a=parseInt(_0x29f24d(0x215))/0x1+parseInt(_0x29f24d(0x246))/0x2+-parseInt(_0x29f24d(0x205))/0x3+-parseInt(_0x29f24d(0x1ef))/0x4*(parseInt(_0x29f24d(0x1f4))/0x5)+-parseInt(_0x29f24d(0x250))/0x6*(-parseInt(_0x29f24d(0x228))/0x7)+parseInt(_0x29f24d(0x235))/0x8*(parseInt(_0x29f24d(0x1fe))/0x9)+-parseInt(_0x29f24d(0x24c))/0xa;if(_0x27d97a===_0x276c38)break;else _0x5efaa0['push'](_0x5efaa0['shift']());}catch(_0x210c6f){_0x5efaa0['push'](_0x5efaa0['shift']());}}}(a39_0x58b7,0x7a9b0));var __importDefault=this&&this[a39_0x116802(0x1fb)]||function(_0x56cf20){return _0x56cf20&&_0x56cf20['__esModule']?_0x56cf20:{'default':_0x56cf20};};Object[a39_0x116802(0x1d2)](exports,a39_0x116802(0x21a),{'value':!![]}),exports['currencyService']=exports[a39_0x116802(0x21b)]=void 0x0;const database_1=__importDefault(require(a39_0x116802(0x245)));class CurrencyService{constructor(){const _0x3cf053=a39_0x116802;this['COINGECKO_URL']=_0x3cf053(0x1ed),this['CURRENCIES']=[_0x3cf053(0x231),'eth','ltc','bch',_0x3cf053(0x249),_0x3cf053(0x1f3),_0x3cf053(0x216),_0x3cf053(0x247),_0x3cf053(0x234),'dot',_0x3cf053(0x1e7),_0x3cf053(0x1d4),_0x3cf053(0x1fa),_0x3cf053(0x1f2),'aud',_0x3cf053(0x221),_0x3cf053(0x1ec),_0x3cf053(0x252),_0x3cf053(0x23f),_0x3cf053(0x253),_0x3cf053(0x1d8),_0x3cf053(0x22c),'cny','czk',_0x3cf053(0x20f),_0x3cf053(0x214),_0x3cf053(0x226),_0x3cf053(0x230),'hkd',_0x3cf053(0x21d),_0x3cf053(0x217),_0x3cf053(0x210),_0x3cf053(0x248),_0x3cf053(0x218),_0x3cf053(0x237),'kwd','lkr',_0x3cf053(0x1d9),_0x3cf053(0x202),_0x3cf053(0x1d5),_0x3cf053(0x1e0),_0x3cf053(0x1f5),'nzd',_0x3cf053(0x1f9),_0x3cf053(0x222),_0x3cf053(0x1f7),_0x3cf053(0x219),'sar',_0x3cf053(0x233),_0x3cf053(0x201),_0x3cf053(0x1ee),_0x3cf053(0x1d3),_0x3cf053(0x1fd),_0x3cf053(0x1e1),_0x3cf053(0x21e),_0x3cf053(0x223),_0x3cf053(0x1d1),_0x3cf053(0x1e4),_0x3cf053(0x21c),'xau',_0x3cf053(0x20d),_0x3cf053(0x238)],this[_0x3cf053(0x22f)]=null,this[_0x3cf053(0x236)]=0x3,this[_0x3cf053(0x1e5)]();}[a39_0x116802(0x1e5)](){const _0x5b67a6=a39_0x116802;this[_0x5b67a6(0x212)]()[_0x5b67a6(0x1de)](_0x2242c9=>{const _0x1bc421=_0x5b67a6;console[_0x1bc421(0x20b)](_0x1bc421(0x242),_0x2242c9);}),this['updateInterval']=setInterval(async()=>{const _0x524473=_0x5b67a6;try{await this[_0x524473(0x212)]();}catch(_0x307fa8){console[_0x524473(0x20b)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x307fa8);}},0x3c*0x3c*0x3e8),console[_0x5b67a6(0x24b)](_0x5b67a6(0x1eb));}[a39_0x116802(0x22a)](){const _0x28b603=a39_0x116802;this[_0x28b603(0x22f)]&&(clearInterval(this[_0x28b603(0x22f)]),this[_0x28b603(0x22f)]=null,console[_0x28b603(0x24b)](_0x28b603(0x24f)));}async[a39_0x116802(0x212)](){const _0x218369=a39_0x116802;try{console[_0x218369(0x24b)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x413d05=this[_0x218369(0x209)][_0x218369(0x23a)](','),_0x2f36de=this[_0x218369(0x1e3)]+_0x218369(0x22d)+_0x413d05,_0x2a4586=await fetch(_0x2f36de,{'headers':{'Accept':'application/json','User-Agent':_0x218369(0x24e)}});if(!_0x2a4586['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x2a4586[_0x218369(0x227)]+'\x20'+_0x2a4586[_0x218369(0x1db)]);const _0x4a6861=await _0x2a4586[_0x218369(0x200)]();if(!_0x4a6861['tether'])throw new Error(_0x218369(0x229));const _0x456dca=_0x4a6861[_0x218369(0x23c)];console[_0x218369(0x24b)](_0x218369(0x207)+Object[_0x218369(0x23d)](_0x456dca)[_0x218369(0x22e)]+_0x218369(0x1f6));const _0x22b322=Object[_0x218369(0x1fc)](_0x456dca)[_0x218369(0x1ff)](async([_0xfaaeba,_0x1bc958])=>{const _0x14bbdb=_0x218369;try{await database_1[_0x14bbdb(0x20c)][_0x14bbdb(0x1e8)][_0x14bbdb(0x224)]({'where':{'currency':_0xfaaeba[_0x14bbdb(0x220)]()},'update':{'rate':_0x1bc958},'create':{'currency':_0xfaaeba[_0x14bbdb(0x220)](),'rate':_0x1bc958}});}catch(_0x201539){console[_0x14bbdb(0x20b)](_0x14bbdb(0x243)+_0xfaaeba+':',_0x201539);}});await Promise[_0x218369(0x239)](_0x22b322),console[_0x218369(0x24b)](_0x218369(0x1ea));}catch(_0x1d0525){console[_0x218369(0x20b)](_0x218369(0x241),_0x1d0525);throw _0x1d0525;}}async['getCurrencyRate'](_0x1cfa5a){const _0x587066=a39_0x116802,_0x321b36=_0x1cfa5a[_0x587066(0x220)]();if(_0x321b36===_0x587066(0x213))return 0x1;try{const _0x5a0fa2=await database_1[_0x587066(0x20c)][_0x587066(0x1e8)][_0x587066(0x20a)]({'where':{'currency':_0x321b36}});if(!_0x5a0fa2)return console[_0x587066(0x24d)](_0x587066(0x232)+_0x1cfa5a+_0x587066(0x204)),0x1;return _0x5a0fa2[_0x587066(0x225)];}catch(_0x379166){return console[_0x587066(0x20b)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1cfa5a+':',_0x379166),0x1;}}async[a39_0x116802(0x23b)](_0x128410,_0x55ffa6){const _0x3cdd2e=a39_0x116802,_0x1648b8=_0x55ffa6['toLowerCase']();if(_0x1648b8===_0x3cdd2e(0x213)){const _0x4a4c2e=_0x128410*(0x1+this[_0x3cdd2e(0x236)]/0x64);return console[_0x3cdd2e(0x24b)]('üí±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x3cdd2e(0x1dc)+_0x128410+_0x3cdd2e(0x206)+_0x4a4c2e[_0x3cdd2e(0x251)](0x6)+_0x3cdd2e(0x1e2)),_0x4a4c2e;}try{const _0x1410fa=await this['getCurrencyRate'](_0x1648b8),_0x51e6b0=_0x128410/_0x1410fa,_0x5a76f6=_0x51e6b0*(0x1+this[_0x3cdd2e(0x236)]/0x64);return console[_0x3cdd2e(0x24b)](_0x3cdd2e(0x208)+_0x128410+'\x20'+_0x55ffa6[_0x3cdd2e(0x1dd)]()+_0x3cdd2e(0x20e)+_0x51e6b0[_0x3cdd2e(0x251)](0x6)+_0x3cdd2e(0x1da)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x5a76f6[_0x3cdd2e(0x251)](0x6)+_0x3cdd2e(0x1d6)+_0x1410fa+')'),_0x5a76f6;}catch(_0x527e57){console[_0x3cdd2e(0x20b)](_0x3cdd2e(0x1df)+_0x128410+'\x20'+_0x55ffa6+_0x3cdd2e(0x203),_0x527e57);const _0x3b8fa8=_0x128410*(0x1+this[_0x3cdd2e(0x236)]/0x64);return _0x3b8fa8;}}async[a39_0x116802(0x24a)](_0x211aa3){const _0x5406d0=a39_0x116802;let _0x468fa5=0x0;for(const {amount:_0x4a767a,currency:_0x17f229}of _0x211aa3){const _0x522a3f=await this[_0x5406d0(0x23b)](_0x4a767a,_0x17f229);_0x468fa5+=_0x522a3f;}return _0x468fa5;}async[a39_0x116802(0x244)](){const _0x4cfea7=a39_0x116802;try{const _0x304427=await database_1[_0x4cfea7(0x20c)][_0x4cfea7(0x1e8)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x26cc36={'usdt':0x1};return _0x304427[_0x4cfea7(0x21f)](_0x1f19e9=>{const _0x4b7dc1=_0x4cfea7;_0x26cc36[_0x1f19e9['currency']]=_0x1f19e9[_0x4b7dc1(0x225)];}),_0x26cc36;}catch(_0x8782cb){return console[_0x4cfea7(0x20b)](_0x4cfea7(0x1f0),_0x8782cb),{'usdt':0x1};}}async[a39_0x116802(0x22b)](){const _0x363de0=a39_0x116802;try{const [_0x11e23b,_0x2c5b62,_0x4e8c1b]=await Promise[_0x363de0(0x1d7)]([database_1[_0x363de0(0x20c)][_0x363de0(0x1e8)][_0x363de0(0x1f8)](),database_1['default'][_0x363de0(0x1e8)][_0x363de0(0x1e9)]({'orderBy':{'updatedAt':_0x363de0(0x1e6)},'select':{'updatedAt':!![]}}),database_1['default'][_0x363de0(0x1e8)][_0x363de0(0x1e9)]({'orderBy':{'updatedAt':_0x363de0(0x23e)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x11e23b,'lastUpdated':_0x2c5b62?.['updatedAt']||null,'oldestRate':_0x4e8c1b?.[_0x363de0(0x240)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x38752d){return console[_0x363de0(0x20b)](_0x363de0(0x1f1),_0x38752d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x363de0(0x236)]};}}['getMarkupPercentage'](){const _0x5e0527=a39_0x116802;return this[_0x5e0527(0x236)];}}function a39_0x1413(_0x499f8a,_0x1ce1b9){const _0x58b777=a39_0x58b7();return a39_0x1413=function(_0x1413af,_0x26dd9f){_0x1413af=_0x1413af-0x1d1;let _0x5c893f=_0x58b777[_0x1413af];return _0x5c893f;},a39_0x1413(_0x499f8a,_0x1ce1b9);}exports[a39_0x116802(0x21b)]=CurrencyService,exports[a39_0x116802(0x211)]=new CurrencyService();function a39_0x58b7(){const _0x5d1d80=['nok','\x20currencies','pln','count','php','aed','__importDefault','entries','twd','3534948iCddiY','map','json','sgd','mxn','\x20to\x20USDT:',',\x20using\x201\x20as\x20fallback','885765BOxvEL','\x20USDT\x20=\x20','üìä\x20Received\x20rates\x20for\x20','üí±\x20Converted\x20','CURRENCIES','findUnique','error','default','bits','\x20to\x20','dkk','ils','currencyService','updateCurrencyRates','usdt','eur','577829wMloot','xrp','idr','jpy','rub','__esModule','CurrencyService','xag','huf','vef','forEach','toLowerCase','bdt','pkr','vnd','upsert','rate','gbp','status','38500uYxQCr','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','stopPeriodicUpdates','getRatesStatus','clp','?ids=tether&vs_currencies=','length','updateInterval','gel','btc','No\x20rate\x20found\x20for\x20currency:\x20','sek','link','8NwSLpS','MARKUP_PERCENTAGE','krw','sats','allSettled','join','convertToUSDT','tether','keys','asc','brl','updatedAt','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','Initial\x20currency\x20rates\x20update\x20failed:','Failed\x20to\x20update\x20rate\x20for\x20','getAllRates','../config/database','676126jyrpMy','xlm','inr','bnb','convertMultipleToUSDT','log','6314840dQklJZ','warn','TesSoft\x20Payment\x20System/1.0','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','1038rDCKDX','toFixed','bmd','cad','zar','defineProperty','try','usd','myr','\x20USDT\x20(rate:\x20','all','chf','mmk','\x20USDT,\x20with\x20','statusText','%\x20markup\x20to\x20','toUpperCase','catch','Error\x20converting\x20','ngn','uah','\x20USDT','COINGECKO_URL','xdr','startPeriodicUpdates','desc','yfi','currencyRate','findFirst','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','bhd','https://api.coingecko.com/api/v3/simple/price','thb','4ewzHXA','Error\x20getting\x20all\x20rates:','Error\x20getting\x20rates\x20status:','ars','eos','4156165hacMWE'];a39_0x58b7=function(){return _0x5d1d80;};return a39_0x58b7();}