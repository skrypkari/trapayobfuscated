'use strict';function a43_0x1494(){const _0x4736c2=['asc','rate','4828569JRasbi','getRatesStatus','all','CoinGecko\x20API\x20error:\x20','__importDefault','21287YESYQe','ngn','bdt','currency','MARKUP_PERCENTAGE','eth','1358133uJnpbN','toLowerCase','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','log','clp','sats','currencyService','cad','uah','php','?ids=tether&vs_currencies=','huf','Initial\x20currency\x20rates\x20update\x20failed:','bch','22105809XLEldP','jpy','xdr','CurrencyService','Failed\x20to\x20update\x20rate\x20for\x20','\x20USDT,\x20with\x20','aud','usdt','✅\x20Currency\x20rates\x20updated\x20successfully','default',',\x20using\x201\x20as\x20fallback','No\x20rate\x20found\x20for\x20currency:\x20','xag','bnb','mmk','\x20USDT','pln','CURRENCIES','getCurrencyRate','catch','COINGECKO_URL','czk','myr','updatedAt','../config/database','gbp','%\x20markup\x20to\x20','ltc','toFixed','toUpperCase','getMarkupPercentage','statusText','application/json','__esModule','vef','\x20USDT\x20(rate:\x20','bhd','35HneoiV','lkr','Periodic\x20currency\x20rates\x20update\x20failed:','convertMultipleToUSDT','hkd','startPeriodicUpdates','Error\x20converting\x20','json','error','mxn','usd','defineProperty','map','stopPeriodicUpdates','btc','convertToUSDT','Payment\x20System/1.0','\x20currencies','xau','bmd','currencyRate','\x20USDT\x20=\x20','474672xcQVVs','1592tHVEfo','upsert','count','findFirst','try','idr','sek','thb','xlm','status','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','dot','%\x20markup\x20=\x20','findMany','sgd','krw','findUnique','updateCurrencyRates','826734EuwjSN','keys','tether','3285686TyJpOw','chf','aed','Error\x20getting\x20rate\x20for\x20currency\x20','kwd','💱\x20Converted\x20','nzd','forEach','vnd','https://api.coingecko.com/api/v3/simple/price','updateInterval','nok'];a43_0x1494=function(){return _0x4736c2;};return a43_0x1494();}function a43_0x135c(_0x3617f7,_0x53f7b9){const _0x1494e2=a43_0x1494();return a43_0x135c=function(_0x135c91,_0x667241){_0x135c91=_0x135c91-0x14e;let _0x91923f=_0x1494e2[_0x135c91];return _0x91923f;},a43_0x135c(_0x3617f7,_0x53f7b9);}const a43_0x13eb16=a43_0x135c;(function(_0x2139fd,_0x406b87){const _0x8d6aa0=a43_0x135c,_0x40f245=_0x2139fd();while(!![]){try{const _0x1c7756=-parseInt(_0x8d6aa0(0x19e))/0x1+-parseInt(_0x8d6aa0(0x185))/0x2+parseInt(_0x8d6aa0(0x193))/0x3+parseInt(_0x8d6aa0(0x16f))/0x4+parseInt(_0x8d6aa0(0x159))/0x5*(-parseInt(_0x8d6aa0(0x182))/0x6)+-parseInt(_0x8d6aa0(0x198))/0x7*(-parseInt(_0x8d6aa0(0x170))/0x8)+parseInt(_0x8d6aa0(0x1ac))/0x9;if(_0x1c7756===_0x406b87)break;else _0x40f245['push'](_0x40f245['shift']());}catch(_0x317af7){_0x40f245['push'](_0x40f245['shift']());}}}(a43_0x1494,0xc92f4));var __importDefault=this&&this[a43_0x13eb16(0x197)]||function(_0x2f3eac){const _0x270628=a43_0x13eb16;return _0x2f3eac&&_0x2f3eac[_0x270628(0x155)]?_0x2f3eac:{'default':_0x2f3eac};};Object[a43_0x13eb16(0x164)](exports,'__esModule',{'value':!![]}),exports[a43_0x13eb16(0x1a4)]=exports[a43_0x13eb16(0x1af)]=void 0x0;const database_1=__importDefault(require(a43_0x13eb16(0x1c4)));class CurrencyService{constructor(){const _0x31cfe0=a43_0x13eb16;this[_0x31cfe0(0x1c0)]=_0x31cfe0(0x18e),this['CURRENCIES']=[_0x31cfe0(0x167),_0x31cfe0(0x19d),_0x31cfe0(0x14f),_0x31cfe0(0x1ab),_0x31cfe0(0x1b9),'eos','xrp',_0x31cfe0(0x178),'link',_0x31cfe0(0x17b),'yfi',_0x31cfe0(0x163),_0x31cfe0(0x187),'ars',_0x31cfe0(0x1b2),_0x31cfe0(0x19a),_0x31cfe0(0x158),_0x31cfe0(0x16c),'brl',_0x31cfe0(0x1a5),_0x31cfe0(0x186),_0x31cfe0(0x1a2),'cny',_0x31cfe0(0x1c1),'dkk','eur',_0x31cfe0(0x1c5),'gel',_0x31cfe0(0x15d),_0x31cfe0(0x1a9),_0x31cfe0(0x175),'ils','inr',_0x31cfe0(0x1ad),_0x31cfe0(0x17f),_0x31cfe0(0x189),_0x31cfe0(0x15a),_0x31cfe0(0x1ba),_0x31cfe0(0x162),_0x31cfe0(0x1c2),_0x31cfe0(0x199),_0x31cfe0(0x190),_0x31cfe0(0x18b),_0x31cfe0(0x1a7),'pkr',_0x31cfe0(0x1bc),'rub','sar',_0x31cfe0(0x176),_0x31cfe0(0x17e),_0x31cfe0(0x177),_0x31cfe0(0x174),'twd',_0x31cfe0(0x1a6),_0x31cfe0(0x156),_0x31cfe0(0x18d),'zar',_0x31cfe0(0x1ae),_0x31cfe0(0x1b8),_0x31cfe0(0x16b),'bits',_0x31cfe0(0x1a3)],this['updateInterval']=null,this[_0x31cfe0(0x19c)]=-0x3,this[_0x31cfe0(0x15e)]();}[a43_0x13eb16(0x15e)](){const _0x2c64b4=a43_0x13eb16;this[_0x2c64b4(0x181)]()[_0x2c64b4(0x1bf)](_0x3ff2e4=>{const _0x6adceb=_0x2c64b4;console['error'](_0x6adceb(0x1aa),_0x3ff2e4);}),this['updateInterval']=setInterval(async()=>{const _0x3fc427=_0x2c64b4;try{await this['updateCurrencyRates']();}catch(_0x82cf38){console[_0x3fc427(0x161)](_0x3fc427(0x15b),_0x82cf38);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a43_0x13eb16(0x166)](){const _0xbabb96=a43_0x13eb16;this[_0xbabb96(0x18f)]&&(clearInterval(this[_0xbabb96(0x18f)]),this[_0xbabb96(0x18f)]=null,console[_0xbabb96(0x1a1)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x3c65ca=a43_0x13eb16;try{console['log'](_0x3c65ca(0x17a));const _0x2abdfc=this[_0x3c65ca(0x1bd)]['join'](','),_0x7f0868=this[_0x3c65ca(0x1c0)]+_0x3c65ca(0x1a8)+_0x2abdfc,_0x2c229e=await fetch(_0x7f0868,{'headers':{'Accept':_0x3c65ca(0x154),'User-Agent':_0x3c65ca(0x169)}});if(!_0x2c229e['ok'])throw new Error(_0x3c65ca(0x196)+_0x2c229e[_0x3c65ca(0x179)]+'\x20'+_0x2c229e[_0x3c65ca(0x153)]);const _0x3fe645=await _0x2c229e[_0x3c65ca(0x160)]();if(!_0x3fe645[_0x3c65ca(0x184)])throw new Error(_0x3c65ca(0x1a0));const _0x200551=_0x3fe645[_0x3c65ca(0x184)];console[_0x3c65ca(0x1a1)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x3c65ca(0x183)](_0x200551)['length']+_0x3c65ca(0x16a));const _0x5a81df=Object['entries'](_0x200551)[_0x3c65ca(0x165)](async([_0x4c05a5,_0x392f18])=>{const _0xfdd289=_0x3c65ca;try{await database_1['default'][_0xfdd289(0x16d)][_0xfdd289(0x171)]({'where':{'currency':_0x4c05a5[_0xfdd289(0x19f)]()},'update':{'rate':_0x392f18},'create':{'currency':_0x4c05a5[_0xfdd289(0x19f)](),'rate':_0x392f18}});}catch(_0x4d5cdf){console[_0xfdd289(0x161)](_0xfdd289(0x1b0)+_0x4c05a5+':',_0x4d5cdf);}});await Promise['allSettled'](_0x5a81df),console[_0x3c65ca(0x1a1)](_0x3c65ca(0x1b4));}catch(_0x5ab95d){console[_0x3c65ca(0x161)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x5ab95d);throw _0x5ab95d;}}async[a43_0x13eb16(0x1be)](_0x535639){const _0x490d1c=a43_0x13eb16,_0x249cc3=_0x535639[_0x490d1c(0x19f)]();if(_0x249cc3===_0x490d1c(0x1b3))return 0x1;try{const _0x2247e1=await database_1[_0x490d1c(0x1b5)][_0x490d1c(0x16d)][_0x490d1c(0x180)]({'where':{'currency':_0x249cc3}});if(!_0x2247e1)return console['warn'](_0x490d1c(0x1b7)+_0x535639+_0x490d1c(0x1b6)),0x1;return _0x2247e1[_0x490d1c(0x192)];}catch(_0x924362){return console[_0x490d1c(0x161)](_0x490d1c(0x188)+_0x535639+':',_0x924362),0x1;}}async[a43_0x13eb16(0x168)](_0x2dce03,_0x405646){const _0x40f531=a43_0x13eb16,_0x2b9b70=_0x405646[_0x40f531(0x19f)]();if(_0x2b9b70===_0x40f531(0x1b3)){const _0x55b805=_0x2dce03*(0x1+this[_0x40f531(0x19c)]/0x64);return console[_0x40f531(0x1a1)]('💱\x20Applied\x20'+this[_0x40f531(0x19c)]+_0x40f531(0x14e)+_0x2dce03+_0x40f531(0x16e)+_0x55b805[_0x40f531(0x150)](0x6)+_0x40f531(0x1bb)),_0x55b805;}try{const _0x1f80d9=await this[_0x40f531(0x1be)](_0x2b9b70),_0x3ec625=_0x2dce03/_0x1f80d9,_0x192caf=_0x3ec625*(0x1+this[_0x40f531(0x19c)]/0x64);return console[_0x40f531(0x1a1)](_0x40f531(0x18a)+_0x2dce03+'\x20'+_0x405646[_0x40f531(0x151)]()+'\x20to\x20'+_0x3ec625[_0x40f531(0x150)](0x6)+_0x40f531(0x1b1)+this[_0x40f531(0x19c)]+_0x40f531(0x17c)+_0x192caf[_0x40f531(0x150)](0x6)+_0x40f531(0x157)+_0x1f80d9+')'),_0x192caf;}catch(_0x541a5a){console[_0x40f531(0x161)](_0x40f531(0x15f)+_0x2dce03+'\x20'+_0x405646+'\x20to\x20USDT:',_0x541a5a);const _0xeaef5e=_0x2dce03*(0x1+this[_0x40f531(0x19c)]/0x64);return _0xeaef5e;}}async[a43_0x13eb16(0x15c)](_0x4edede){const _0x50399c=a43_0x13eb16;let _0x555b7e=0x0;for(const {amount:_0x17eb87,currency:_0x3c0dd0}of _0x4edede){const _0x5eae9c=await this[_0x50399c(0x168)](_0x17eb87,_0x3c0dd0);_0x555b7e+=_0x5eae9c;}return _0x555b7e;}async['getAllRates'](){const _0x5b4c28=a43_0x13eb16;try{const _0x7769ec=await database_1[_0x5b4c28(0x1b5)][_0x5b4c28(0x16d)][_0x5b4c28(0x17d)]({'select':{'currency':!![],'rate':!![]}}),_0x162193={'usdt':0x1};return _0x7769ec[_0x5b4c28(0x18c)](_0x28533f=>{const _0x45489e=_0x5b4c28;_0x162193[_0x28533f[_0x45489e(0x19b)]]=_0x28533f[_0x45489e(0x192)];}),_0x162193;}catch(_0x1a8dd8){return console['error']('Error\x20getting\x20all\x20rates:',_0x1a8dd8),{'usdt':0x1};}}async[a43_0x13eb16(0x194)](){const _0x556d75=a43_0x13eb16;try{const [_0x46bb03,_0x3edaa9,_0x3b8072]=await Promise[_0x556d75(0x195)]([database_1[_0x556d75(0x1b5)][_0x556d75(0x16d)][_0x556d75(0x172)](),database_1[_0x556d75(0x1b5)][_0x556d75(0x16d)][_0x556d75(0x173)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x556d75(0x16d)]['findFirst']({'orderBy':{'updatedAt':_0x556d75(0x191)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x46bb03,'lastUpdated':_0x3edaa9?.[_0x556d75(0x1c3)]||null,'oldestRate':_0x3b8072?.[_0x556d75(0x1c3)]||null,'markupPercentage':this[_0x556d75(0x19c)]};}catch(_0xa3a046){return console['error']('Error\x20getting\x20rates\x20status:',_0xa3a046),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x556d75(0x19c)]};}}[a43_0x13eb16(0x152)](){const _0x2b9824=a43_0x13eb16;return this[_0x2b9824(0x19c)];}}exports[a43_0x13eb16(0x1af)]=CurrencyService,exports[a43_0x13eb16(0x1a4)]=new CurrencyService();