'use strict';const a39_0x1de3fe=a39_0x47fd;(function(_0x1f7a8b,_0x403a3b){const _0x1b2d75=a39_0x47fd,_0x15dc4b=_0x1f7a8b();while(!![]){try{const _0x1cd0dc=-parseInt(_0x1b2d75(0x152))/0x1+-parseInt(_0x1b2d75(0x13f))/0x2*(-parseInt(_0x1b2d75(0x1b2))/0x3)+-parseInt(_0x1b2d75(0x149))/0x4*(-parseInt(_0x1b2d75(0x1a0))/0x5)+-parseInt(_0x1b2d75(0x19c))/0x6+-parseInt(_0x1b2d75(0x140))/0x7+-parseInt(_0x1b2d75(0x170))/0x8+parseInt(_0x1b2d75(0x190))/0x9;if(_0x1cd0dc===_0x403a3b)break;else _0x15dc4b['push'](_0x15dc4b['shift']());}catch(_0x3ee1b2){_0x15dc4b['push'](_0x15dc4b['shift']());}}}(a39_0x4b57,0xf4051));function a39_0x4b57(){const _0x5dd02c=['cny','COINGECKO_URL','bdt','sar','chf','twd','💱\x20Applied\x20','clp','4MjLWVh','usdt','❌\x20Failed\x20to\x20update\x20currency\x20rates:','hkd','huf','\x20to\x20','toFixed','default','findMany','631787bUMiBS','json','asc','currency','upsert','Error\x20getting\x20all\x20rates:','ltc','vef','CURRENCIES','currencyRate','bits','all','xdr','vnd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20USDT\x20=\x20','pln','join','MARKUP_PERCENTAGE','currencyService','xau','application/json','btc','xag','Failed\x20to\x20update\x20rate\x20for\x20','cad','findFirst','updateInterval','try','dot','3182480ucHWks','%\x20markup\x20to\x20','?ids=tether&vs_currencies=','count','ngn','../config/database','zar','__importDefault','ars','status','allSettled','sats','https://api.coingecko.com/api/v3/simple/price','Error\x20converting\x20','lkr','php','%\x20markup\x20=\x20','statusText','toLowerCase','ils','Error\x20getting\x20rates\x20status:','Periodic\x20currency\x20rates\x20update\x20failed:','defineProperty','map','CurrencyService','mxn','eth','sgd','thb','forEach','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','log','23088456YvGift','stopPeriodicUpdates','rate','✅\x20Currency\x20rates\x20updated\x20successfully','idr','\x20USDT,\x20with\x20','rub','\x20to\x20USDT:','updatedAt','\x20USDT\x20(rate:\x20','kwd','No\x20rate\x20found\x20for\x20currency:\x20','5750730TfJWZr','\x20USDT','usd','desc','8259175tgjpqy','📊\x20Received\x20rates\x20for\x20','krw','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','getMarkupPercentage','xrp','error','inr','getRatesStatus','aed','dkk','bnb','jpy','startPeriodicUpdates','convertToUSDT','updateCurrencyRates','myr','link','29334ilAgvZ','__esModule','tether','eos','bch','findUnique','toUpperCase','28VboEht','9565878ZtTPZl'];a39_0x4b57=function(){return _0x5dd02c;};return a39_0x4b57();}var __importDefault=this&&this[a39_0x1de3fe(0x177)]||function(_0x484610){return _0x484610&&_0x484610['__esModule']?_0x484610:{'default':_0x484610};};Object[a39_0x1de3fe(0x186)](exports,a39_0x1de3fe(0x139),{'value':!![]}),exports[a39_0x1de3fe(0x165)]=exports[a39_0x1de3fe(0x188)]=void 0x0;const database_1=__importDefault(require(a39_0x1de3fe(0x175)));function a39_0x47fd(_0x3e40c0,_0x12937c){const _0x4b5735=a39_0x4b57();return a39_0x47fd=function(_0x47fd25,_0x358979){_0x47fd25=_0x47fd25-0x139;let _0x420be4=_0x4b5735[_0x47fd25];return _0x420be4;},a39_0x47fd(_0x3e40c0,_0x12937c);}class CurrencyService{constructor(){const _0x328eae=a39_0x1de3fe;this[_0x328eae(0x142)]=_0x328eae(0x17c),this[_0x328eae(0x15a)]=[_0x328eae(0x168),_0x328eae(0x18a),_0x328eae(0x158),_0x328eae(0x13c),_0x328eae(0x1ab),_0x328eae(0x13b),_0x328eae(0x1a5),'xlm',_0x328eae(0x1b1),_0x328eae(0x16f),'yfi',_0x328eae(0x19e),_0x328eae(0x1a9),_0x328eae(0x178),'aud',_0x328eae(0x143),'bhd','bmd','brl',_0x328eae(0x16b),_0x328eae(0x145),_0x328eae(0x148),_0x328eae(0x141),'czk',_0x328eae(0x1aa),'eur','gbp','gel',_0x328eae(0x14c),_0x328eae(0x14d),_0x328eae(0x194),_0x328eae(0x183),_0x328eae(0x1a7),_0x328eae(0x1ac),_0x328eae(0x1a2),_0x328eae(0x19a),_0x328eae(0x17e),'mmk',_0x328eae(0x189),_0x328eae(0x1b0),_0x328eae(0x174),'nok','nzd',_0x328eae(0x17f),'pkr',_0x328eae(0x162),_0x328eae(0x196),_0x328eae(0x144),'sek',_0x328eae(0x18b),_0x328eae(0x18c),_0x328eae(0x16e),_0x328eae(0x146),'uah',_0x328eae(0x159),_0x328eae(0x15f),_0x328eae(0x176),_0x328eae(0x15e),_0x328eae(0x169),_0x328eae(0x166),_0x328eae(0x15c),_0x328eae(0x17b)],this[_0x328eae(0x16d)]=null,this[_0x328eae(0x164)]=0x3,this[_0x328eae(0x1ad)]();}[a39_0x1de3fe(0x1ad)](){const _0x1bcda9=a39_0x1de3fe;this['updateCurrencyRates']()['catch'](_0x1c48a2=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x1c48a2);}),this['updateInterval']=setInterval(async()=>{const _0x3b62e6=a39_0x47fd;try{await this[_0x3b62e6(0x1af)]();}catch(_0x376014){console[_0x3b62e6(0x1a6)](_0x3b62e6(0x185),_0x376014);}},0x3c*0x3c*0x3e8),console['log'](_0x1bcda9(0x160));}[a39_0x1de3fe(0x191)](){const _0x30fdf3=a39_0x1de3fe;this['updateInterval']&&(clearInterval(this[_0x30fdf3(0x16d)]),this[_0x30fdf3(0x16d)]=null,console[_0x30fdf3(0x18f)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a39_0x1de3fe(0x1af)](){const _0x5209b2=a39_0x1de3fe;try{console[_0x5209b2(0x18f)](_0x5209b2(0x1a3));const _0x75821c=this['CURRENCIES'][_0x5209b2(0x163)](','),_0x197a32=this[_0x5209b2(0x142)]+_0x5209b2(0x172)+_0x75821c,_0x17c002=await fetch(_0x197a32,{'headers':{'Accept':_0x5209b2(0x167),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x17c002['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x17c002[_0x5209b2(0x179)]+'\x20'+_0x17c002[_0x5209b2(0x181)]);const _0x5272a2=await _0x17c002[_0x5209b2(0x153)]();if(!_0x5272a2[_0x5209b2(0x13a)])throw new Error(_0x5209b2(0x18e));const _0x1ff4a0=_0x5272a2['tether'];console[_0x5209b2(0x18f)](_0x5209b2(0x1a1)+Object['keys'](_0x1ff4a0)['length']+'\x20currencies');const _0x2fcfa8=Object['entries'](_0x1ff4a0)[_0x5209b2(0x187)](async([_0x123cdc,_0x23e8e3])=>{const _0x37345c=_0x5209b2;try{await database_1[_0x37345c(0x150)]['currencyRate'][_0x37345c(0x156)]({'where':{'currency':_0x123cdc[_0x37345c(0x182)]()},'update':{'rate':_0x23e8e3},'create':{'currency':_0x123cdc['toLowerCase'](),'rate':_0x23e8e3}});}catch(_0x1faa5b){console[_0x37345c(0x1a6)](_0x37345c(0x16a)+_0x123cdc+':',_0x1faa5b);}});await Promise[_0x5209b2(0x17a)](_0x2fcfa8),console[_0x5209b2(0x18f)](_0x5209b2(0x193));}catch(_0x13057d){console['error'](_0x5209b2(0x14b),_0x13057d);throw _0x13057d;}}async['getCurrencyRate'](_0x44ad90){const _0x38a12d=a39_0x1de3fe,_0x20185a=_0x44ad90[_0x38a12d(0x182)]();if(_0x20185a===_0x38a12d(0x14a))return 0x1;try{const _0x1e2e1f=await database_1[_0x38a12d(0x150)]['currencyRate'][_0x38a12d(0x13d)]({'where':{'currency':_0x20185a}});if(!_0x1e2e1f)return console['warn'](_0x38a12d(0x19b)+_0x44ad90+',\x20using\x201\x20as\x20fallback'),0x1;return _0x1e2e1f['rate'];}catch(_0x31e500){return console[_0x38a12d(0x1a6)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x44ad90+':',_0x31e500),0x1;}}async[a39_0x1de3fe(0x1ae)](_0x2e4e48,_0x420001){const _0x48a374=a39_0x1de3fe,_0x2df20d=_0x420001[_0x48a374(0x182)]();if(_0x2df20d===_0x48a374(0x14a)){const _0x4228d5=_0x2e4e48*(0x1+this[_0x48a374(0x164)]/0x64);return console[_0x48a374(0x18f)](_0x48a374(0x147)+this['MARKUP_PERCENTAGE']+_0x48a374(0x171)+_0x2e4e48+_0x48a374(0x161)+_0x4228d5[_0x48a374(0x14f)](0x6)+_0x48a374(0x19d)),_0x4228d5;}try{const _0x372d88=await this['getCurrencyRate'](_0x2df20d),_0xfd1431=_0x2e4e48/_0x372d88,_0x171ab6=_0xfd1431*(0x1+this[_0x48a374(0x164)]/0x64);return console[_0x48a374(0x18f)]('💱\x20Converted\x20'+_0x2e4e48+'\x20'+_0x420001[_0x48a374(0x13e)]()+_0x48a374(0x14e)+_0xfd1431[_0x48a374(0x14f)](0x6)+_0x48a374(0x195)+this[_0x48a374(0x164)]+_0x48a374(0x180)+_0x171ab6[_0x48a374(0x14f)](0x6)+_0x48a374(0x199)+_0x372d88+')'),_0x171ab6;}catch(_0x5536f3){console[_0x48a374(0x1a6)](_0x48a374(0x17d)+_0x2e4e48+'\x20'+_0x420001+_0x48a374(0x197),_0x5536f3);const _0x35993e=_0x2e4e48*(0x1+this[_0x48a374(0x164)]/0x64);return _0x35993e;}}async['convertMultipleToUSDT'](_0x29f727){let _0x12d47f=0x0;for(const {amount:_0x2b4db2,currency:_0x37a240}of _0x29f727){const _0x175b30=await this['convertToUSDT'](_0x2b4db2,_0x37a240);_0x12d47f+=_0x175b30;}return _0x12d47f;}async['getAllRates'](){const _0x33db34=a39_0x1de3fe;try{const _0x52b06c=await database_1['default'][_0x33db34(0x15b)][_0x33db34(0x151)]({'select':{'currency':!![],'rate':!![]}}),_0x4ed3b8={'usdt':0x1};return _0x52b06c[_0x33db34(0x18d)](_0x13f788=>{const _0x1acd01=_0x33db34;_0x4ed3b8[_0x13f788[_0x1acd01(0x155)]]=_0x13f788[_0x1acd01(0x192)];}),_0x4ed3b8;}catch(_0xedd392){return console[_0x33db34(0x1a6)](_0x33db34(0x157),_0xedd392),{'usdt':0x1};}}async[a39_0x1de3fe(0x1a8)](){const _0xefb4d3=a39_0x1de3fe;try{const [_0xe2408c,_0x539d17,_0x22f124]=await Promise[_0xefb4d3(0x15d)]([database_1[_0xefb4d3(0x150)]['currencyRate'][_0xefb4d3(0x173)](),database_1[_0xefb4d3(0x150)][_0xefb4d3(0x15b)][_0xefb4d3(0x16c)]({'orderBy':{'updatedAt':_0xefb4d3(0x19f)},'select':{'updatedAt':!![]}}),database_1['default'][_0xefb4d3(0x15b)][_0xefb4d3(0x16c)]({'orderBy':{'updatedAt':_0xefb4d3(0x154)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xe2408c,'lastUpdated':_0x539d17?.[_0xefb4d3(0x198)]||null,'oldestRate':_0x22f124?.[_0xefb4d3(0x198)]||null,'markupPercentage':this[_0xefb4d3(0x164)]};}catch(_0x48100e){return console['error'](_0xefb4d3(0x184),_0x48100e),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xefb4d3(0x164)]};}}[a39_0x1de3fe(0x1a4)](){return this['MARKUP_PERCENTAGE'];}}exports[a39_0x1de3fe(0x188)]=CurrencyService,exports[a39_0x1de3fe(0x165)]=new CurrencyService();