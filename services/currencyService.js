'use strict';const a38_0x147673=a38_0x39b9;(function(_0x4d3e79,_0x554634){const _0x4e331f=a38_0x39b9,_0x4b249b=_0x4d3e79();while(!![]){try{const _0x3d2c43=parseInt(_0x4e331f(0x151))/0x1*(-parseInt(_0x4e331f(0x122))/0x2)+-parseInt(_0x4e331f(0x13f))/0x3+-parseInt(_0x4e331f(0x109))/0x4*(parseInt(_0x4e331f(0x12e))/0x5)+-parseInt(_0x4e331f(0x16f))/0x6*(-parseInt(_0x4e331f(0x11e))/0x7)+-parseInt(_0x4e331f(0x11d))/0x8*(parseInt(_0x4e331f(0x10e))/0x9)+parseInt(_0x4e331f(0x13b))/0xa*(parseInt(_0x4e331f(0x13a))/0xb)+parseInt(_0x4e331f(0x178))/0xc*(parseInt(_0x4e331f(0x146))/0xd);if(_0x3d2c43===_0x554634)break;else _0x4b249b['push'](_0x4b249b['shift']());}catch(_0x5ad355){_0x4b249b['push'](_0x4b249b['shift']());}}}(a38_0x5b05,0x39297));var __importDefault=this&&this['__importDefault']||function(_0x10c324){return _0x10c324&&_0x10c324['__esModule']?_0x10c324:{'default':_0x10c324};};function a38_0x39b9(_0x56361d,_0x4b47d2){const _0x5b05a1=a38_0x5b05();return a38_0x39b9=function(_0x39b9f1,_0x4f0a7d){_0x39b9f1=_0x39b9f1-0x100;let _0x426cad=_0x5b05a1[_0x39b9f1];return _0x426cad;},a38_0x39b9(_0x56361d,_0x4b47d2);}Object['defineProperty'](exports,a38_0x147673(0x100),{'value':!![]}),exports[a38_0x147673(0x157)]=exports[a38_0x147673(0x145)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x5a343e=a38_0x147673;this['COINGECKO_URL']=_0x5a343e(0x106),this[_0x5a343e(0x110)]=[_0x5a343e(0x134),_0x5a343e(0x155),_0x5a343e(0x13e),'bch',_0x5a343e(0x133),'eos',_0x5a343e(0x15a),_0x5a343e(0x10c),_0x5a343e(0x15b),'dot','yfi',_0x5a343e(0x174),'aed',_0x5a343e(0x104),'aud',_0x5a343e(0x166),_0x5a343e(0x142),'bmd',_0x5a343e(0x14f),_0x5a343e(0x120),_0x5a343e(0x13d),_0x5a343e(0x12b),'cny',_0x5a343e(0x16c),_0x5a343e(0x173),_0x5a343e(0x117),_0x5a343e(0x14d),_0x5a343e(0x16d),_0x5a343e(0x13c),_0x5a343e(0x118),_0x5a343e(0x14e),_0x5a343e(0x167),_0x5a343e(0x11f),_0x5a343e(0x15f),_0x5a343e(0x150),'kwd',_0x5a343e(0x175),_0x5a343e(0x125),'mxn',_0x5a343e(0x135),_0x5a343e(0x160),_0x5a343e(0x15d),_0x5a343e(0x165),_0x5a343e(0x153),_0x5a343e(0x103),_0x5a343e(0x154),_0x5a343e(0x131),_0x5a343e(0x156),'sek','sgd',_0x5a343e(0x124),_0x5a343e(0x10b),'twd','uah',_0x5a343e(0x127),_0x5a343e(0x128),_0x5a343e(0x132),_0x5a343e(0x163),_0x5a343e(0x12c),'xau',_0x5a343e(0x16b),_0x5a343e(0x113)],this[_0x5a343e(0x148)]=null,this[_0x5a343e(0x11c)]=0x3,this[_0x5a343e(0x10d)]();}[a38_0x147673(0x10d)](){const _0x3c5077=a38_0x147673;this[_0x3c5077(0x158)]()[_0x3c5077(0x171)](_0x1cde01=>{const _0x35cfbd=_0x3c5077;console[_0x35cfbd(0x12f)](_0x35cfbd(0x10f),_0x1cde01);}),this['updateInterval']=setInterval(async()=>{const _0x2ebd69=_0x3c5077;try{await this['updateCurrencyRates']();}catch(_0x5c95ec){console['error'](_0x2ebd69(0x107),_0x5c95ec);}},0x3c*0x3c*0x3e8),console[_0x3c5077(0x114)](_0x3c5077(0x172));}[a38_0x147673(0x177)](){const _0x1f2180=a38_0x147673;this['updateInterval']&&(clearInterval(this[_0x1f2180(0x148)]),this['updateInterval']=null,console[_0x1f2180(0x114)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x147673(0x158)](){const _0x41678c=a38_0x147673;try{console[_0x41678c(0x114)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xf13fdf=this[_0x41678c(0x110)]['join'](','),_0x18b8ef=this[_0x41678c(0x144)]+'?ids=tether&vs_currencies='+_0xf13fdf,_0x5cb514=await fetch(_0x18b8ef,{'headers':{'Accept':_0x41678c(0x108),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x5cb514['ok'])throw new Error(_0x41678c(0x147)+_0x5cb514[_0x41678c(0x169)]+'\x20'+_0x5cb514[_0x41678c(0x141)]);const _0x127efc=await _0x5cb514[_0x41678c(0x179)]();if(!_0x127efc['tether'])throw new Error(_0x41678c(0x152));const _0x946c28=_0x127efc[_0x41678c(0x140)];console[_0x41678c(0x114)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x41678c(0x102)](_0x946c28)[_0x41678c(0x136)]+_0x41678c(0x11b));const _0xa1ad3d=Object['entries'](_0x946c28)[_0x41678c(0x11a)](async([_0x905e4f,_0x1687d9])=>{const _0x48c69f=_0x41678c;try{await database_1['default'][_0x48c69f(0x16e)][_0x48c69f(0x16a)]({'where':{'currency':_0x905e4f[_0x48c69f(0x101)]()},'update':{'rate':_0x1687d9},'create':{'currency':_0x905e4f['toLowerCase'](),'rate':_0x1687d9}});}catch(_0x22d102){console[_0x48c69f(0x12f)](_0x48c69f(0x162)+_0x905e4f+':',_0x22d102);}});await Promise['allSettled'](_0xa1ad3d),console[_0x41678c(0x114)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x846bab){console['error'](_0x41678c(0x15e),_0x846bab);throw _0x846bab;}}async[a38_0x147673(0x121)](_0x5ab0f1){const _0x46e147=a38_0x147673,_0x10eefb=_0x5ab0f1[_0x46e147(0x101)]();if(_0x10eefb===_0x46e147(0x170))return 0x1;try{const _0x855fdd=await database_1[_0x46e147(0x17a)][_0x46e147(0x16e)][_0x46e147(0x176)]({'where':{'currency':_0x10eefb}});if(!_0x855fdd)return console[_0x46e147(0x10a)](_0x46e147(0x116)+_0x5ab0f1+_0x46e147(0x164)),0x1;return _0x855fdd['rate'];}catch(_0x36d38a){return console[_0x46e147(0x12f)](_0x46e147(0x159)+_0x5ab0f1+':',_0x36d38a),0x1;}}async[a38_0x147673(0x14c)](_0x4d96b5,_0x25ca44){const _0x553b09=a38_0x147673,_0xaf8b80=_0x25ca44[_0x553b09(0x101)]();if(_0xaf8b80===_0x553b09(0x170)){const _0x4db839=_0x4d96b5*(0x1+this[_0x553b09(0x11c)]/0x64);return console[_0x553b09(0x114)](_0x553b09(0x168)+this['MARKUP_PERCENTAGE']+_0x553b09(0x115)+_0x4d96b5+'\x20USDT\x20=\x20'+_0x4db839['toFixed'](0x6)+_0x553b09(0x123)),_0x4db839;}try{const _0x59ee8a=await this[_0x553b09(0x121)](_0xaf8b80),_0x334b1c=_0x4d96b5/_0x59ee8a,_0x2c1b4b=_0x334b1c*(0x1+this[_0x553b09(0x11c)]/0x64);return console[_0x553b09(0x114)](_0x553b09(0x105)+_0x4d96b5+'\x20'+_0x25ca44[_0x553b09(0x15c)]()+'\x20to\x20'+_0x334b1c['toFixed'](0x6)+_0x553b09(0x149)+this[_0x553b09(0x11c)]+_0x553b09(0x138)+_0x2c1b4b[_0x553b09(0x12a)](0x6)+'\x20USDT\x20(rate:\x20'+_0x59ee8a+')'),_0x2c1b4b;}catch(_0x2998b7){console['error']('Error\x20converting\x20'+_0x4d96b5+'\x20'+_0x25ca44+_0x553b09(0x14b),_0x2998b7);const _0x33b7f0=_0x4d96b5*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x33b7f0;}}async[a38_0x147673(0x12d)](_0x173ec1){const _0x4fe30d=a38_0x147673;let _0x2e54a7=0x0;for(const {amount:_0x362fc4,currency:_0x423a2f}of _0x173ec1){const _0x4274b3=await this[_0x4fe30d(0x14c)](_0x362fc4,_0x423a2f);_0x2e54a7+=_0x4274b3;}return _0x2e54a7;}async[a38_0x147673(0x126)](){const _0x3d55bc=a38_0x147673;try{const _0x37e9d8=await database_1[_0x3d55bc(0x17a)][_0x3d55bc(0x16e)][_0x3d55bc(0x112)]({'select':{'currency':!![],'rate':!![]}}),_0x444cc5={'usdt':0x1};return _0x37e9d8[_0x3d55bc(0x14a)](_0x17bf06=>{const _0x4670ad=_0x3d55bc;_0x444cc5[_0x17bf06[_0x4670ad(0x161)]]=_0x17bf06[_0x4670ad(0x143)];}),_0x444cc5;}catch(_0x3dbd27){return console[_0x3d55bc(0x12f)](_0x3d55bc(0x111),_0x3dbd27),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2977ad=a38_0x147673;try{const [_0x27bdf5,_0x5ecb89,_0x16f58c]=await Promise[_0x2977ad(0x137)]([database_1[_0x2977ad(0x17a)][_0x2977ad(0x16e)][_0x2977ad(0x130)](),database_1[_0x2977ad(0x17a)]['currencyRate'][_0x2977ad(0x139)]({'orderBy':{'updatedAt':_0x2977ad(0x119)},'select':{'updatedAt':!![]}}),database_1[_0x2977ad(0x17a)][_0x2977ad(0x16e)][_0x2977ad(0x139)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x27bdf5,'lastUpdated':_0x5ecb89?.['updatedAt']||null,'oldestRate':_0x16f58c?.['updatedAt']||null,'markupPercentage':this[_0x2977ad(0x11c)]};}catch(_0x3ffd5a){return console[_0x2977ad(0x12f)](_0x2977ad(0x17b),_0x3ffd5a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2977ad(0x11c)]};}}[a38_0x147673(0x129)](){const _0x40daa3=a38_0x147673;return this[_0x40daa3(0x11c)];}}function a38_0x5b05(){const _0xece9f8=['default','Error\x20getting\x20rates\x20status:','__esModule','toLowerCase','keys','pkr','ars','üí±\x20Converted\x20','https://api.coingecko.com/api/v3/simple/price','Periodic\x20currency\x20rates\x20update\x20failed:','application/json','124vbPlUn','warn','try','xlm','startPeriodicUpdates','9jjHoRF','Initial\x20currency\x20rates\x20update\x20failed:','CURRENCIES','Error\x20getting\x20all\x20rates:','findMany','sats','log','%\x20markup\x20to\x20','No\x20rate\x20found\x20for\x20currency:\x20','eur','huf','desc','map','\x20currencies','MARKUP_PERCENTAGE','1133336xrhnZL','281659UGXqXq','inr','cad','getCurrencyRate','143934ksvHHy','\x20USDT','thb','mmk','getAllRates','vef','vnd','getMarkupPercentage','toFixed','clp','xag','convertMultipleToUSDT','34295Cmbsfo','error','count','rub','zar','bnb','btc','myr','length','all','%\x20markup\x20=\x20','findFirst','77rkImYF','476890vkVROs','hkd','chf','ltc','551289PqRzcm','tether','statusText','bhd','rate','COINGECKO_URL','CurrencyService','299TwwCBC','CoinGecko\x20API\x20error:\x20','updateInterval','\x20USDT,\x20with\x20','forEach','\x20to\x20USDT:','convertToUSDT','gbp','idr','brl','krw','2hWUtZS','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','php','pln','eth','sar','currencyService','updateCurrencyRates','Error\x20getting\x20rate\x20for\x20currency\x20','xrp','link','toUpperCase','nok','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','jpy','ngn','currency','Failed\x20to\x20update\x20rate\x20for\x20','xdr',',\x20using\x201\x20as\x20fallback','nzd','bdt','ils','üí±\x20Applied\x20','status','upsert','bits','czk','gel','currencyRate','36agfAzC','usdt','catch','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','dkk','usd','lkr','findUnique','stopPeriodicUpdates','177852SDqqfq','json'];a38_0x5b05=function(){return _0xece9f8;};return a38_0x5b05();}exports[a38_0x147673(0x145)]=CurrencyService,exports[a38_0x147673(0x157)]=new CurrencyService();