'use strict';const a38_0x589895=a38_0x1692;(function(_0x169dd8,_0x3e794f){const _0x291687=a38_0x1692,_0x2cfeea=_0x169dd8();while(!![]){try{const _0x4c2926=-parseInt(_0x291687(0x201))/0x1+-parseInt(_0x291687(0x1ea))/0x2+-parseInt(_0x291687(0x1dc))/0x3*(parseInt(_0x291687(0x19f))/0x4)+parseInt(_0x291687(0x1ad))/0x5+-parseInt(_0x291687(0x1be))/0x6*(-parseInt(_0x291687(0x1dd))/0x7)+-parseInt(_0x291687(0x18b))/0x8*(-parseInt(_0x291687(0x1ec))/0x9)+-parseInt(_0x291687(0x1f9))/0xa*(-parseInt(_0x291687(0x1cf))/0xb);if(_0x4c2926===_0x3e794f)break;else _0x2cfeea['push'](_0x2cfeea['shift']());}catch(_0x422043){_0x2cfeea['push'](_0x2cfeea['shift']());}}}(a38_0x8ad1,0xb4379));var __importDefault=this&&this['__importDefault']||function(_0x57fb53){const _0x4da664=a38_0x1692;return _0x57fb53&&_0x57fb53[_0x4da664(0x191)]?_0x57fb53:{'default':_0x57fb53};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x589895(0x19e)]=exports[a38_0x589895(0x1a0)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a38_0x8ad1(){const _0x353e9b=['btc','https://api.coingecko.com/api/v3/simple/price','log','catch','keys','bdt','2838310NKsoSi','📊\x20Received\x20rates\x20for\x20','117PcowkN','asc','bits','warn','mxn','rate','hkd','rub','xlm','currency','updateCurrencyRates','xau','bhd','10dzoZlI','updatedAt','sar','usd','forEach','startPeriodicUpdates','application/json','usdt','84507uGNweU','Periodic\x20currency\x20rates\x20update\x20failed:','vnd','eth','761616ySnGRA','bnb','TesSoft\x20Payment\x20System/1.0','dot','gel','findFirst','__esModule','✅\x20Currency\x20rates\x20updated\x20successfully','sgd','toFixed','join','CoinGecko\x20API\x20error:\x20','toUpperCase','jpy','aud','pln','💱\x20Converted\x20','toLowerCase','upsert','currencyService','4NaGnVk','CurrencyService','findMany','getMarkupPercentage','ltc','default','bch','currencyRate','getRatesStatus','updateInterval','\x20to\x20USDT:','stopPeriodicUpdates','tether','ils','4880420Nczfli','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','\x20to\x20','cad','thb','brl','krw','CURRENCIES','convertMultipleToUSDT','❌\x20Failed\x20to\x20update\x20currency\x20rates:','chf','MARKUP_PERCENTAGE','No\x20rate\x20found\x20for\x20currency:\x20',',\x20using\x201\x20as\x20fallback','kwd','Error\x20getting\x20rates\x20status:','\x20currencies','470622dGMqTy','czk','xdr','Failed\x20to\x20update\x20rate\x20for\x20','💱\x20Applied\x20','sats','statusText','convertToUSDT','Initial\x20currency\x20rates\x20update\x20failed:','?ids=tether&vs_currencies=','ngn','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','twd','vef','eur','pkr','eos','1065427dlwLAm','idr','count','length','allSettled','%\x20markup\x20to\x20','nok','ars','zar','try','\x20USDT,\x20with\x20','aed','nzd','2559318SXAZCV','70GLjBXr','xrp','Error\x20getting\x20rate\x20for\x20currency\x20','error','getCurrencyRate','clp','bmd'];a38_0x8ad1=function(){return _0x353e9b;};return a38_0x8ad1();}function a38_0x1692(_0x5385a2,_0x414e90){const _0x8ad1af=a38_0x8ad1();return a38_0x1692=function(_0x1692b5,_0x4e2a04){_0x1692b5=_0x1692b5-0x188;let _0x572989=_0x8ad1af[_0x1692b5];return _0x572989;},a38_0x1692(_0x5385a2,_0x414e90);}class CurrencyService{constructor(){const _0x20a9ae=a38_0x589895;this['COINGECKO_URL']=_0x20a9ae(0x1e5),this['CURRENCIES']=[_0x20a9ae(0x1e4),_0x20a9ae(0x18a),_0x20a9ae(0x1a3),_0x20a9ae(0x1a5),_0x20a9ae(0x18c),_0x20a9ae(0x1ce),_0x20a9ae(0x1de),_0x20a9ae(0x1f4),'link',_0x20a9ae(0x18e),'yfi',_0x20a9ae(0x1fc),_0x20a9ae(0x1da),_0x20a9ae(0x1d6),_0x20a9ae(0x199),_0x20a9ae(0x1e9),_0x20a9ae(0x1f8),_0x20a9ae(0x1e3),_0x20a9ae(0x1b2),_0x20a9ae(0x1b0),_0x20a9ae(0x1b7),_0x20a9ae(0x1e2),'cny',_0x20a9ae(0x1bf),'dkk',_0x20a9ae(0x1cc),'gbp',_0x20a9ae(0x18f),_0x20a9ae(0x1f2),'huf',_0x20a9ae(0x1d0),_0x20a9ae(0x1ac),'inr',_0x20a9ae(0x198),_0x20a9ae(0x1b3),_0x20a9ae(0x1bb),'lkr','mmk',_0x20a9ae(0x1f0),'myr',_0x20a9ae(0x1c8),_0x20a9ae(0x1d5),_0x20a9ae(0x1db),'php',_0x20a9ae(0x1cd),_0x20a9ae(0x19a),_0x20a9ae(0x1f3),_0x20a9ae(0x1fb),'sek',_0x20a9ae(0x193),_0x20a9ae(0x1b1),_0x20a9ae(0x1d8),_0x20a9ae(0x1ca),'uah',_0x20a9ae(0x1cb),_0x20a9ae(0x189),_0x20a9ae(0x1d7),_0x20a9ae(0x1c0),'xag',_0x20a9ae(0x1f7),_0x20a9ae(0x1ee),_0x20a9ae(0x1c3)],this[_0x20a9ae(0x1a8)]=null,this[_0x20a9ae(0x1b8)]=0x3,this['startPeriodicUpdates']();}[a38_0x589895(0x1fe)](){const _0x9457c3=a38_0x589895;this['updateCurrencyRates']()[_0x9457c3(0x1e7)](_0x438b28=>{const _0x3ac7ad=_0x9457c3;console[_0x3ac7ad(0x1e0)](_0x3ac7ad(0x1c6),_0x438b28);}),this[_0x9457c3(0x1a8)]=setInterval(async()=>{const _0x77d1d7=_0x9457c3;try{await this[_0x77d1d7(0x1f6)]();}catch(_0x154f09){console[_0x77d1d7(0x1e0)](_0x77d1d7(0x188),_0x154f09);}},0x3c*0x3c*0x3e8),console[_0x9457c3(0x1e6)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x589895(0x1aa)](){const _0x2d069c=a38_0x589895;this[_0x2d069c(0x1a8)]&&(clearInterval(this[_0x2d069c(0x1a8)]),this[_0x2d069c(0x1a8)]=null,console[_0x2d069c(0x1e6)](_0x2d069c(0x1ae)));}async['updateCurrencyRates'](){const _0xedf329=a38_0x589895;try{console[_0xedf329(0x1e6)](_0xedf329(0x1c9));const _0x121915=this[_0xedf329(0x1b4)][_0xedf329(0x195)](','),_0x47be08=this['COINGECKO_URL']+_0xedf329(0x1c7)+_0x121915,_0x52e5a6=await fetch(_0x47be08,{'headers':{'Accept':_0xedf329(0x1ff),'User-Agent':_0xedf329(0x18d)}});if(!_0x52e5a6['ok'])throw new Error(_0xedf329(0x196)+_0x52e5a6['status']+'\x20'+_0x52e5a6[_0xedf329(0x1c4)]);const _0x2004ce=await _0x52e5a6['json']();if(!_0x2004ce[_0xedf329(0x1ab)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x27b3dc=_0x2004ce['tether'];console[_0xedf329(0x1e6)](_0xedf329(0x1eb)+Object[_0xedf329(0x1e8)](_0x27b3dc)[_0xedf329(0x1d2)]+_0xedf329(0x1bd));const _0x135a40=Object['entries'](_0x27b3dc)['map'](async([_0x31d39e,_0x4e636a])=>{const _0x4cf654=_0xedf329;try{await database_1[_0x4cf654(0x1a4)][_0x4cf654(0x1a6)][_0x4cf654(0x19d)]({'where':{'currency':_0x31d39e[_0x4cf654(0x19c)]()},'update':{'rate':_0x4e636a},'create':{'currency':_0x31d39e[_0x4cf654(0x19c)](),'rate':_0x4e636a}});}catch(_0x557f23){console[_0x4cf654(0x1e0)](_0x4cf654(0x1c1)+_0x31d39e+':',_0x557f23);}});await Promise[_0xedf329(0x1d3)](_0x135a40),console[_0xedf329(0x1e6)](_0xedf329(0x192));}catch(_0x5c4ade){console[_0xedf329(0x1e0)](_0xedf329(0x1b6),_0x5c4ade);throw _0x5c4ade;}}async[a38_0x589895(0x1e1)](_0x594814){const _0x37c2b7=a38_0x589895,_0x5633f2=_0x594814[_0x37c2b7(0x19c)]();if(_0x5633f2===_0x37c2b7(0x200))return 0x1;try{const _0x82051a=await database_1['default']['currencyRate']['findUnique']({'where':{'currency':_0x5633f2}});if(!_0x82051a)return console[_0x37c2b7(0x1ef)](_0x37c2b7(0x1b9)+_0x594814+_0x37c2b7(0x1ba)),0x1;return _0x82051a[_0x37c2b7(0x1f1)];}catch(_0x53a6f1){return console[_0x37c2b7(0x1e0)](_0x37c2b7(0x1df)+_0x594814+':',_0x53a6f1),0x1;}}async[a38_0x589895(0x1c5)](_0x11696d,_0x32cb4c){const _0x3bfcd8=a38_0x589895,_0x316bac=_0x32cb4c[_0x3bfcd8(0x19c)]();if(_0x316bac==='usdt'){const _0x29dfe6=_0x11696d*(0x1+this[_0x3bfcd8(0x1b8)]/0x64);return console[_0x3bfcd8(0x1e6)](_0x3bfcd8(0x1c2)+this['MARKUP_PERCENTAGE']+_0x3bfcd8(0x1d4)+_0x11696d+'\x20USDT\x20=\x20'+_0x29dfe6[_0x3bfcd8(0x194)](0x6)+'\x20USDT'),_0x29dfe6;}try{const _0x37b5d0=await this[_0x3bfcd8(0x1e1)](_0x316bac),_0x23d75f=_0x11696d/_0x37b5d0,_0x5813ca=_0x23d75f*(0x1+this[_0x3bfcd8(0x1b8)]/0x64);return console[_0x3bfcd8(0x1e6)](_0x3bfcd8(0x19b)+_0x11696d+'\x20'+_0x32cb4c[_0x3bfcd8(0x197)]()+_0x3bfcd8(0x1af)+_0x23d75f[_0x3bfcd8(0x194)](0x6)+_0x3bfcd8(0x1d9)+this[_0x3bfcd8(0x1b8)]+'%\x20markup\x20=\x20'+_0x5813ca['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x37b5d0+')'),_0x5813ca;}catch(_0x12e3b3){console[_0x3bfcd8(0x1e0)]('Error\x20converting\x20'+_0x11696d+'\x20'+_0x32cb4c+_0x3bfcd8(0x1a9),_0x12e3b3);const _0xfd5ab6=_0x11696d*(0x1+this[_0x3bfcd8(0x1b8)]/0x64);return _0xfd5ab6;}}async[a38_0x589895(0x1b5)](_0x3eb114){const _0x147911=a38_0x589895;let _0x45d910=0x0;for(const {amount:_0x5d412e,currency:_0xa9dd4d}of _0x3eb114){const _0x5449f0=await this[_0x147911(0x1c5)](_0x5d412e,_0xa9dd4d);_0x45d910+=_0x5449f0;}return _0x45d910;}async['getAllRates'](){const _0x43cfc1=a38_0x589895;try{const _0x35da68=await database_1['default']['currencyRate'][_0x43cfc1(0x1a1)]({'select':{'currency':!![],'rate':!![]}}),_0x5a52f3={'usdt':0x1};return _0x35da68[_0x43cfc1(0x1fd)](_0xb3bbd6=>{const _0x50496=_0x43cfc1;_0x5a52f3[_0xb3bbd6[_0x50496(0x1f5)]]=_0xb3bbd6[_0x50496(0x1f1)];}),_0x5a52f3;}catch(_0x4a696f){return console[_0x43cfc1(0x1e0)]('Error\x20getting\x20all\x20rates:',_0x4a696f),{'usdt':0x1};}}async[a38_0x589895(0x1a7)](){const _0x33dc7e=a38_0x589895;try{const [_0x9a942d,_0x94e57f,_0x504be8]=await Promise['all']([database_1['default'][_0x33dc7e(0x1a6)][_0x33dc7e(0x1d1)](),database_1[_0x33dc7e(0x1a4)][_0x33dc7e(0x1a6)][_0x33dc7e(0x190)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x33dc7e(0x1a4)][_0x33dc7e(0x1a6)][_0x33dc7e(0x190)]({'orderBy':{'updatedAt':_0x33dc7e(0x1ed)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x9a942d,'lastUpdated':_0x94e57f?.['updatedAt']||null,'oldestRate':_0x504be8?.[_0x33dc7e(0x1fa)]||null,'markupPercentage':this[_0x33dc7e(0x1b8)]};}catch(_0x20cb91){return console[_0x33dc7e(0x1e0)](_0x33dc7e(0x1bc),_0x20cb91),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x589895(0x1a2)](){const _0x5548d1=a38_0x589895;return this[_0x5548d1(0x1b8)];}}exports[a38_0x589895(0x1a0)]=CurrencyService,exports[a38_0x589895(0x19e)]=new CurrencyService();