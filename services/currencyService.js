'use strict';const a39_0x4d489e=a39_0x5479;function a39_0x4971(){const _0x1eb1bf=['pln','bnb','xrp','findMany','currencyService','xag','\x20to\x20','default','mxn','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','uah','CURRENCIES','✅\x20Currency\x20rates\x20updated\x20successfully','CoinGecko\x20API\x20error:\x20','myr','sek','updatedAt','1121868BAViAu','mmk','lkr','usdt','aed','bch','krw','__esModule','xdr','yfi','clp','xau','currency','huf','bmd','228600djDSCf','13342pzTujC','33aRnpoK','error','try','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20USDT','Error\x20getting\x20rates\x20status:','nok','thb','desc','convertToUSDT','📊\x20Received\x20rates\x20for\x20',',\x20using\x201\x20as\x20fallback','cad','startPeriodicUpdates','gbp','json','Error\x20getting\x20all\x20rates:','258qXiqtw','status','sats','catch','join','59037WgxzNJ','aud','nzd','\x20USDT\x20(rate:\x20','log','COINGECKO_URL','toLowerCase','vnd','updateInterval','toFixed','updateCurrencyRates','Failed\x20to\x20update\x20rate\x20for\x20','all','czk','https://api.coingecko.com/api/v3/simple/price','%\x20markup\x20to\x20','findFirst','toUpperCase','__importDefault','xlm','70UTcmsz','idr','rate','28fZRXeK','map','ils','getAllRates','478557JAFadW','../config/database','CurrencyService','Periodic\x20currency\x20rates\x20update\x20failed:','hkd','1464PbGcVK','twd','rub','brl','dkk','currencyRate','getMarkupPercentage','MARKUP_PERCENTAGE','bdt','statusText','inr','sgd','ars','getCurrencyRate','202010uwsGZX','php','❌\x20Failed\x20to\x20update\x20currency\x20rates:','ltc','eth','vef','ngn','tether','allSettled','upsert','link','findUnique','42605YPMlBl','cny','warn','gel','%\x20markup\x20=\x20','\x20to\x20USDT:'];a39_0x4971=function(){return _0x1eb1bf;};return a39_0x4971();}(function(_0xb9bb72,_0x5e0ef6){const _0x12e6be=a39_0x5479,_0x307244=_0xb9bb72();while(!![]){try{const _0x2c5968=parseInt(_0x12e6be(0xdc))/0x1+parseInt(_0x12e6be(0x10f))/0x2*(parseInt(_0x12e6be(0x110))/0x3)+-parseInt(_0x12e6be(0xff))/0x4+-parseInt(_0x12e6be(0xe8))/0x5*(-parseInt(_0x12e6be(0x121))/0x6)+parseInt(_0x12e6be(0x13d))/0x7*(parseInt(_0x12e6be(0x10e))/0x8)+-parseInt(_0x12e6be(0x141))/0x9*(-parseInt(_0x12e6be(0x13a))/0xa)+-parseInt(_0x12e6be(0x126))/0xb*(parseInt(_0x12e6be(0xce))/0xc);if(_0x2c5968===_0x5e0ef6)break;else _0x307244['push'](_0x307244['shift']());}catch(_0x9e771){_0x307244['push'](_0x307244['shift']());}}}(a39_0x4971,0x2f228));var __importDefault=this&&this[a39_0x4d489e(0x138)]||function(_0x58624a){const _0x490adc=a39_0x4d489e;return _0x58624a&&_0x58624a[_0x490adc(0x106)]?_0x58624a:{'default':_0x58624a};};function a39_0x5479(_0x1d8cec,_0x461b8c){const _0x497155=a39_0x4971();return a39_0x5479=function(_0x547944,_0x39534e){_0x547944=_0x547944-0xca;let _0x48519b=_0x497155[_0x547944];return _0x48519b;},a39_0x5479(_0x1d8cec,_0x461b8c);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a39_0x4d489e(0xcb)]=void 0x0;const database_1=__importDefault(require(a39_0x4d489e(0xca)));class CurrencyService{constructor(){const _0x2104b8=a39_0x4d489e;this[_0x2104b8(0x12b)]=_0x2104b8(0x134),this[_0x2104b8(0xf9)]=['btc',_0x2104b8(0xe0),_0x2104b8(0xdf),_0x2104b8(0x104),_0x2104b8(0xef),'eos',_0x2104b8(0xf0),_0x2104b8(0x139),_0x2104b8(0xe6),'dot',_0x2104b8(0x108),'usd',_0x2104b8(0x103),_0x2104b8(0xda),_0x2104b8(0x127),_0x2104b8(0xd6),'bhd',_0x2104b8(0x10d),_0x2104b8(0xd1),_0x2104b8(0x11c),'chf',_0x2104b8(0x109),_0x2104b8(0xe9),_0x2104b8(0x133),_0x2104b8(0xd2),'eur',_0x2104b8(0x11e),_0x2104b8(0xeb),_0x2104b8(0xcd),_0x2104b8(0x10c),_0x2104b8(0x13b),_0x2104b8(0x13f),_0x2104b8(0xd8),'jpy',_0x2104b8(0x105),'kwd',_0x2104b8(0x101),_0x2104b8(0x100),_0x2104b8(0xf6),_0x2104b8(0xfc),_0x2104b8(0xe2),_0x2104b8(0x116),_0x2104b8(0x128),_0x2104b8(0xdd),'pkr',_0x2104b8(0xee),_0x2104b8(0xd0),'sar',_0x2104b8(0xfd),_0x2104b8(0xd9),_0x2104b8(0x117),_0x2104b8(0x112),_0x2104b8(0xcf),_0x2104b8(0xf8),_0x2104b8(0xe1),_0x2104b8(0x12d),'zar',_0x2104b8(0x107),_0x2104b8(0xf3),_0x2104b8(0x10a),'bits',_0x2104b8(0x123)],this[_0x2104b8(0x12e)]=null,this[_0x2104b8(0xd5)]=0x3,this[_0x2104b8(0x11d)]();}['startPeriodicUpdates'](){const _0x1aca36=a39_0x4d489e;this[_0x1aca36(0x130)]()[_0x1aca36(0x124)](_0x31bfe7=>{const _0xe3f281=_0x1aca36;console[_0xe3f281(0x111)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x31bfe7);}),this[_0x1aca36(0x12e)]=setInterval(async()=>{const _0xf0524d=_0x1aca36;try{await this[_0xf0524d(0x130)]();}catch(_0x2e40a2){console[_0xf0524d(0x111)](_0xf0524d(0xcc),_0x2e40a2);}},0x3c*0x3c*0x3e8),console[_0x1aca36(0x12a)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x4114d9=a39_0x4d489e;this[_0x4114d9(0x12e)]&&(clearInterval(this[_0x4114d9(0x12e)]),this[_0x4114d9(0x12e)]=null,console[_0x4114d9(0x12a)](_0x4114d9(0xf7)));}async[a39_0x4d489e(0x130)](){const _0x3c93cf=a39_0x4d489e;try{console[_0x3c93cf(0x12a)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x3148f1=this[_0x3c93cf(0xf9)][_0x3c93cf(0x125)](','),_0x2111ba=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x3148f1,_0x66d006=await fetch(_0x2111ba,{'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x66d006['ok'])throw new Error(_0x3c93cf(0xfb)+_0x66d006[_0x3c93cf(0x122)]+'\x20'+_0x66d006[_0x3c93cf(0xd7)]);const _0x5985fb=await _0x66d006[_0x3c93cf(0x11f)]();if(!_0x5985fb['tether'])throw new Error(_0x3c93cf(0x113));const _0x3273e9=_0x5985fb[_0x3c93cf(0xe3)];console['log'](_0x3c93cf(0x11a)+Object['keys'](_0x3273e9)['length']+'\x20currencies');const _0x343a2f=Object['entries'](_0x3273e9)[_0x3c93cf(0x13e)](async([_0x1f1030,_0x42ca4c])=>{const _0x5bbd50=_0x3c93cf;try{await database_1[_0x5bbd50(0xf5)][_0x5bbd50(0xd3)][_0x5bbd50(0xe5)]({'where':{'currency':_0x1f1030[_0x5bbd50(0x12c)]()},'update':{'rate':_0x42ca4c},'create':{'currency':_0x1f1030[_0x5bbd50(0x12c)](),'rate':_0x42ca4c}});}catch(_0x14633a){console[_0x5bbd50(0x111)](_0x5bbd50(0x131)+_0x1f1030+':',_0x14633a);}});await Promise[_0x3c93cf(0xe4)](_0x343a2f),console[_0x3c93cf(0x12a)](_0x3c93cf(0xfa));}catch(_0x23c9de){console[_0x3c93cf(0x111)](_0x3c93cf(0xde),_0x23c9de);throw _0x23c9de;}}async['getCurrencyRate'](_0x22a702){const _0x137a64=a39_0x4d489e,_0x135807=_0x22a702[_0x137a64(0x12c)]();if(_0x135807==='usdt')return 0x1;try{const _0x3babc6=await database_1[_0x137a64(0xf5)][_0x137a64(0xd3)][_0x137a64(0xe7)]({'where':{'currency':_0x135807}});if(!_0x3babc6)return console[_0x137a64(0xea)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x22a702+_0x137a64(0x11b)),0x1;return _0x3babc6[_0x137a64(0x13c)];}catch(_0x220291){return console[_0x137a64(0x111)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x22a702+':',_0x220291),0x1;}}async['convertToUSDT'](_0x1bf18a,_0x585e40){const _0x444922=a39_0x4d489e,_0x482849=_0x585e40[_0x444922(0x12c)]();if(_0x482849===_0x444922(0x102)){const _0x2c7977=_0x1bf18a*(0x1+this[_0x444922(0xd5)]/0x64);return console[_0x444922(0x12a)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x444922(0x135)+_0x1bf18a+'\x20USDT\x20=\x20'+_0x2c7977['toFixed'](0x6)+_0x444922(0x114)),_0x2c7977;}try{const _0x29e670=await this[_0x444922(0xdb)](_0x482849),_0x3dd9e0=_0x1bf18a/_0x29e670,_0x525c59=_0x3dd9e0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log']('💱\x20Converted\x20'+_0x1bf18a+'\x20'+_0x585e40[_0x444922(0x137)]()+_0x444922(0xf4)+_0x3dd9e0[_0x444922(0x12f)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0x444922(0xec)+_0x525c59[_0x444922(0x12f)](0x6)+_0x444922(0x129)+_0x29e670+')'),_0x525c59;}catch(_0x51b27c){console['error']('Error\x20converting\x20'+_0x1bf18a+'\x20'+_0x585e40+_0x444922(0xed),_0x51b27c);const _0x3c8edf=_0x1bf18a*(0x1+this[_0x444922(0xd5)]/0x64);return _0x3c8edf;}}async['convertMultipleToUSDT'](_0x1ebea6){const _0x5ac334=a39_0x4d489e;let _0x565b46=0x0;for(const {amount:_0x16c42d,currency:_0x45f341}of _0x1ebea6){const _0x21c787=await this[_0x5ac334(0x119)](_0x16c42d,_0x45f341);_0x565b46+=_0x21c787;}return _0x565b46;}async[a39_0x4d489e(0x140)](){const _0x483c68=a39_0x4d489e;try{const _0x360568=await database_1[_0x483c68(0xf5)][_0x483c68(0xd3)][_0x483c68(0xf1)]({'select':{'currency':!![],'rate':!![]}}),_0x5741d9={'usdt':0x1};return _0x360568['forEach'](_0x3e3376=>{const _0x4b644d=_0x483c68;_0x5741d9[_0x3e3376[_0x4b644d(0x10b)]]=_0x3e3376[_0x4b644d(0x13c)];}),_0x5741d9;}catch(_0x542035){return console[_0x483c68(0x111)](_0x483c68(0x120),_0x542035),{'usdt':0x1};}}async['getRatesStatus'](){const _0xce9ef7=a39_0x4d489e;try{const [_0x3e7362,_0x176c79,_0x37739e]=await Promise[_0xce9ef7(0x132)]([database_1[_0xce9ef7(0xf5)]['currencyRate']['count'](),database_1[_0xce9ef7(0xf5)][_0xce9ef7(0xd3)][_0xce9ef7(0x136)]({'orderBy':{'updatedAt':_0xce9ef7(0x118)},'select':{'updatedAt':!![]}}),database_1[_0xce9ef7(0xf5)][_0xce9ef7(0xd3)][_0xce9ef7(0x136)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3e7362,'lastUpdated':_0x176c79?.[_0xce9ef7(0xfe)]||null,'oldestRate':_0x37739e?.[_0xce9ef7(0xfe)]||null,'markupPercentage':this[_0xce9ef7(0xd5)]};}catch(_0x5121e8){return console[_0xce9ef7(0x111)](_0xce9ef7(0x115),_0x5121e8),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xce9ef7(0xd5)]};}}[a39_0x4d489e(0xd4)](){const _0x92ced=a39_0x4d489e;return this[_0x92ced(0xd5)];}}exports[a39_0x4d489e(0xcb)]=CurrencyService,exports[a39_0x4d489e(0xf2)]=new CurrencyService();