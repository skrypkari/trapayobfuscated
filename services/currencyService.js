'use strict';const a53_0x533e05=a53_0x1156;(function(_0x40e71b,_0x4d9531){const _0x46fc35=a53_0x1156,_0xf51f43=_0x40e71b();while(!![]){try{const _0x1e9e81=parseInt(_0x46fc35(0x230))/0x1*(-parseInt(_0x46fc35(0x269))/0x2)+-parseInt(_0x46fc35(0x211))/0x3*(-parseInt(_0x46fc35(0x1f7))/0x4)+-parseInt(_0x46fc35(0x24a))/0x5*(-parseInt(_0x46fc35(0x203))/0x6)+-parseInt(_0x46fc35(0x1f3))/0x7*(parseInt(_0x46fc35(0x220))/0x8)+-parseInt(_0x46fc35(0x202))/0x9+-parseInt(_0x46fc35(0x206))/0xa*(-parseInt(_0x46fc35(0x25b))/0xb)+-parseInt(_0x46fc35(0x239))/0xc*(-parseInt(_0x46fc35(0x240))/0xd);if(_0x1e9e81===_0x4d9531)break;else _0xf51f43['push'](_0xf51f43['shift']());}catch(_0x51aeb4){_0xf51f43['push'](_0xf51f43['shift']());}}}(a53_0x2085,0x794f2));function a53_0x1156(_0x238292,_0x2cfe36){_0x238292=_0x238292-0x1f2;const _0x208567=a53_0x2085();let _0x115677=_0x208567[_0x238292];return _0x115677;}var __importDefault=this&&this['__importDefault']||function(_0x4c195f){return _0x4c195f&&_0x4c195f['__esModule']?_0x4c195f:{'default':_0x4c195f};};Object[a53_0x533e05(0x258)](exports,a53_0x533e05(0x24e),{'value':!![]}),exports['currencyService']=exports[a53_0x533e05(0x22b)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a53_0x2085(){const _0x2e9b6c=['toFixed','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','findMany','convertToUSDT','aud','4751820IdmPBP','map','getAllRates','bnb','huf','cny','xau','26JOiffK','idr','CURRENCIES','rub','?ids=tether&vs_currencies=','brl','bdt','sek','toUpperCase','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','20BFjbMK','gel','currencyService','tether','__esModule','pln','No\x20rate\x20found\x20for\x20currency:\x20','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','forEach','desc','âœ…\x20Currency\x20rates\x20updated\x20successfully','eos','getCurrencyRate','gbp','defineProperty','MARKUP_PERCENTAGE','Initial\x20currency\x20rates\x20update\x20failed:','22lttNBH','sats','startPeriodicUpdates','upsert','error','sgd','pkr','eur','ðŸ’±\x20Applied\x20','twd','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Failed\x20to\x20update\x20rate\x20for\x20','usd','\x20to\x20USDT:','10154LQIslb','count','7ilztks','usdt','log','default','4FZRcOh',',\x20using\x201\x20as\x20fallback','\x20USDT','mmk','lkr','jpy','Periodic\x20currency\x20rates\x20update\x20failed:','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','bits','aed','clp','8356446LRYXwV','356802VYzImd','findUnique','currencyRate','1850460DPZDGp','ils','getRatesStatus','hkd','COINGECKO_URL','dot','asc','allSettled','nok','findFirst','xrp','480123GyiPgz','czk','Error\x20getting\x20rate\x20for\x20currency\x20','stopPeriodicUpdates','\x20USDT\x20(rate:\x20','updatedAt','myr','%\x20markup\x20=\x20','length','mxn','inr','updateInterval','toLowerCase','all','%\x20markup\x20to\x20','751832HudThB','thb','bch','warn','xlm','bhd','ars','statusText','ðŸ’±\x20Converted\x20','nzd','uah','CurrencyService','updateCurrencyRates','json','\x20USDT\x20=\x20','krw','8sOgZso','status','ðŸ“Š\x20Received\x20rates\x20for\x20','btc'];a53_0x2085=function(){return _0x2e9b6c;};return a53_0x2085();}class CurrencyService{constructor(){const _0x2a6f95=a53_0x533e05;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x2a6f95(0x242)]=[_0x2a6f95(0x233),'eth','ltc',_0x2a6f95(0x222),_0x2a6f95(0x23c),_0x2a6f95(0x255),_0x2a6f95(0x210),_0x2a6f95(0x224),'link',_0x2a6f95(0x20b),'yfi',_0x2a6f95(0x267),_0x2a6f95(0x200),_0x2a6f95(0x226),_0x2a6f95(0x238),_0x2a6f95(0x246),_0x2a6f95(0x225),'bmd',_0x2a6f95(0x245),'cad','chf',_0x2a6f95(0x201),_0x2a6f95(0x23e),_0x2a6f95(0x212),'dkk',_0x2a6f95(0x262),_0x2a6f95(0x257),_0x2a6f95(0x24b),_0x2a6f95(0x209),_0x2a6f95(0x23d),_0x2a6f95(0x241),_0x2a6f95(0x207),_0x2a6f95(0x21b),_0x2a6f95(0x1fc),_0x2a6f95(0x22f),'kwd',_0x2a6f95(0x1fb),_0x2a6f95(0x1fa),_0x2a6f95(0x21a),_0x2a6f95(0x217),'ngn',_0x2a6f95(0x20e),_0x2a6f95(0x229),'php',_0x2a6f95(0x261),_0x2a6f95(0x24f),_0x2a6f95(0x243),'sar',_0x2a6f95(0x247),_0x2a6f95(0x260),_0x2a6f95(0x221),'try',_0x2a6f95(0x264),_0x2a6f95(0x22a),'vef','vnd','zar','xdr','xag',_0x2a6f95(0x23f),_0x2a6f95(0x1ff),_0x2a6f95(0x25c)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=-0x3,this['startPeriodicUpdates']();}[a53_0x533e05(0x25d)](){const _0x43216c=a53_0x533e05;this[_0x43216c(0x22c)]()['catch'](_0x3e102d=>{const _0x362852=_0x43216c;console[_0x362852(0x25f)](_0x362852(0x25a),_0x3e102d);}),this[_0x43216c(0x21c)]=setInterval(async()=>{const _0x694b7a=_0x43216c;try{await this['updateCurrencyRates']();}catch(_0x2b824a){console[_0x694b7a(0x25f)](_0x694b7a(0x1fd),_0x2b824a);}},0x3c*0x3c*0x3e8),console[_0x43216c(0x1f5)](_0x43216c(0x1fe));}[a53_0x533e05(0x214)](){const _0x1f2879=a53_0x533e05;this[_0x1f2879(0x21c)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x1f2879(0x1f5)](_0x1f2879(0x251)));}async[a53_0x533e05(0x22c)](){const _0x47dc5b=a53_0x533e05;try{console[_0x47dc5b(0x1f5)](_0x47dc5b(0x265));const _0x5b7d7c=this[_0x47dc5b(0x242)]['join'](','),_0x3d7b68=this[_0x47dc5b(0x20a)]+_0x47dc5b(0x244)+_0x5b7d7c,_0x1a0b5e=await fetch(_0x3d7b68,{'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}});if(!_0x1a0b5e['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1a0b5e[_0x47dc5b(0x231)]+'\x20'+_0x1a0b5e[_0x47dc5b(0x227)]);const _0x4f74ea=await _0x1a0b5e[_0x47dc5b(0x22d)]();if(!_0x4f74ea[_0x47dc5b(0x24d)])throw new Error(_0x47dc5b(0x249));const _0x9ebc03=_0x4f74ea[_0x47dc5b(0x24d)];console['log'](_0x47dc5b(0x232)+Object['keys'](_0x9ebc03)[_0x47dc5b(0x219)]+'\x20currencies');const _0x876fba=Object['entries'](_0x9ebc03)[_0x47dc5b(0x23a)](async([_0x40c80a,_0x39e252])=>{const _0x3f022e=_0x47dc5b;try{await database_1[_0x3f022e(0x1f6)][_0x3f022e(0x205)][_0x3f022e(0x25e)]({'where':{'currency':_0x40c80a[_0x3f022e(0x21d)]()},'update':{'rate':_0x39e252},'create':{'currency':_0x40c80a['toLowerCase'](),'rate':_0x39e252}});}catch(_0x4d965f){console[_0x3f022e(0x25f)](_0x3f022e(0x266)+_0x40c80a+':',_0x4d965f);}});await Promise[_0x47dc5b(0x20d)](_0x876fba),console[_0x47dc5b(0x1f5)](_0x47dc5b(0x254));}catch(_0x11b5f3){console[_0x47dc5b(0x25f)](_0x47dc5b(0x235),_0x11b5f3);throw _0x11b5f3;}}async[a53_0x533e05(0x256)](_0x4974cc){const _0x1f07a3=a53_0x533e05,_0x234a4f=_0x4974cc[_0x1f07a3(0x21d)]();if(_0x234a4f===_0x1f07a3(0x1f4))return 0x1;try{const _0x23b3d0=await database_1['default']['currencyRate'][_0x1f07a3(0x204)]({'where':{'currency':_0x234a4f}});if(!_0x23b3d0)return console[_0x1f07a3(0x223)](_0x1f07a3(0x250)+_0x4974cc+_0x1f07a3(0x1f8)),0x1;return _0x23b3d0['rate'];}catch(_0x3460f5){return console[_0x1f07a3(0x25f)](_0x1f07a3(0x213)+_0x4974cc+':',_0x3460f5),0x1;}}async[a53_0x533e05(0x237)](_0x3a97f1,_0x5f301f){const _0x22157e=a53_0x533e05,_0x35d4c5=_0x5f301f[_0x22157e(0x21d)]();if(_0x35d4c5===_0x22157e(0x1f4)){const _0x2c8437=_0x3a97f1*(0x1+this[_0x22157e(0x259)]/0x64);return console[_0x22157e(0x1f5)](_0x22157e(0x263)+this[_0x22157e(0x259)]+_0x22157e(0x21f)+_0x3a97f1+_0x22157e(0x22e)+_0x2c8437[_0x22157e(0x234)](0x6)+_0x22157e(0x1f9)),_0x2c8437;}try{const _0x61bd2c=await this['getCurrencyRate'](_0x35d4c5),_0x1d51e6=_0x3a97f1/_0x61bd2c,_0x2adf00=_0x1d51e6*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x22157e(0x1f5)](_0x22157e(0x228)+_0x3a97f1+'\x20'+_0x5f301f[_0x22157e(0x248)]()+'\x20to\x20'+_0x1d51e6[_0x22157e(0x234)](0x6)+'\x20USDT,\x20with\x20'+this[_0x22157e(0x259)]+_0x22157e(0x218)+_0x2adf00[_0x22157e(0x234)](0x6)+_0x22157e(0x215)+_0x61bd2c+')'),_0x2adf00;}catch(_0x4c05ff){console[_0x22157e(0x25f)]('Error\x20converting\x20'+_0x3a97f1+'\x20'+_0x5f301f+_0x22157e(0x268),_0x4c05ff);const _0x235742=_0x3a97f1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x235742;}}async['convertMultipleToUSDT'](_0x413fd7){let _0x2d62db=0x0;for(const {amount:_0x57d3a9,currency:_0x137088}of _0x413fd7){const _0x18cf66=await this['convertToUSDT'](_0x57d3a9,_0x137088);_0x2d62db+=_0x18cf66;}return _0x2d62db;}async[a53_0x533e05(0x23b)](){const _0x43d449=a53_0x533e05;try{const _0x420d27=await database_1[_0x43d449(0x1f6)]['currencyRate'][_0x43d449(0x236)]({'select':{'currency':!![],'rate':!![]}}),_0xa1e3a3={'usdt':0x1};return _0x420d27[_0x43d449(0x252)](_0x386a5d=>{_0xa1e3a3[_0x386a5d['currency']]=_0x386a5d['rate'];}),_0xa1e3a3;}catch(_0x3f243b){return console[_0x43d449(0x25f)]('Error\x20getting\x20all\x20rates:',_0x3f243b),{'usdt':0x1};}}async[a53_0x533e05(0x208)](){const _0x4a0b73=a53_0x533e05;try{const [_0x5961c9,_0x56dce1,_0x25b2bd]=await Promise[_0x4a0b73(0x21e)]([database_1[_0x4a0b73(0x1f6)][_0x4a0b73(0x205)][_0x4a0b73(0x1f2)](),database_1[_0x4a0b73(0x1f6)][_0x4a0b73(0x205)][_0x4a0b73(0x20f)]({'orderBy':{'updatedAt':_0x4a0b73(0x253)},'select':{'updatedAt':!![]}}),database_1[_0x4a0b73(0x1f6)][_0x4a0b73(0x205)][_0x4a0b73(0x20f)]({'orderBy':{'updatedAt':_0x4a0b73(0x20c)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5961c9,'lastUpdated':_0x56dce1?.[_0x4a0b73(0x216)]||null,'oldestRate':_0x25b2bd?.[_0x4a0b73(0x216)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0xf82492){return console['error']('Error\x20getting\x20rates\x20status:',_0xf82492),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4a0b73(0x259)]};}}['getMarkupPercentage'](){const _0x5cfebd=a53_0x533e05;return this[_0x5cfebd(0x259)];}}exports['CurrencyService']=CurrencyService,exports[a53_0x533e05(0x24c)]=new CurrencyService();