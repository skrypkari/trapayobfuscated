'use strict';const a38_0x1e189b=a38_0x54d4;function a38_0x5329(){const _0x3709b9=['💱\x20Converted\x20','bmd','\x20to\x20USDT:','MARKUP_PERCENTAGE','warn','%\x20markup\x20=\x20','map','2023620jQCcyT','hkd','sek','log','usd','allSettled','lkr','myr','count','ils','6hLAqQQ','rate','jpy','mxn','getCurrencyRate','startPeriodicUpdates','link','xdr','entries','getAllRates','huf','59060ZivSoe','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','CoinGecko\x20API\x20error:\x20','btc','ars','getRatesStatus','status','Error\x20converting\x20','length','Failed\x20to\x20update\x20rate\x20for\x20','Error\x20getting\x20all\x20rates:','updatedAt','convertToUSDT','default','pkr','keys','eur','bch','Error\x20getting\x20rate\x20for\x20currency\x20','error','vnd','Initial\x20currency\x20rates\x20update\x20failed:','xrp','nzd','nok','cad','updateCurrencyRates','bnb','toLowerCase','TesSoft\x20Payment\x20System/1.0','gbp','29889YtdWbt','chf','upsert','defineProperty','__importDefault','findMany','68550fFUGri','vef','?ids=tether&vs_currencies=','desc','aed','42iwiSqy','inr','currencyRate','catch','https://api.coingecko.com/api/v3/simple/price','toFixed','bhd','pln','\x20currencies','findFirst','tether','krw','CurrencyService','\x20USDT\x20(rate:\x20','CURRENCIES','✅\x20Currency\x20rates\x20updated\x20successfully','clp','xau','1840034HevWZF','idr','eos','📊\x20Received\x20rates\x20for\x20','sar','kwd','currencyService','\x20USDT\x20=\x20','usdt','uah','currency','1211680VrYLES','czk','bits','\x20to\x20','../config/database','dot','eth','sgd','Error\x20getting\x20rates\x20status:','try','43772tXnLHS','gel','bdt','736fVwUlA','zar','application/json','twd','findUnique','all','yfi','__esModule','brl','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','statusText','COINGECKO_URL','updateInterval'];a38_0x5329=function(){return _0x3709b9;};return a38_0x5329();}(function(_0xa3c14f,_0x44854c){const _0x5d4b8d=a38_0x54d4,_0x23a36e=_0xa3c14f();while(!![]){try{const _0x24a3ea=-parseInt(_0x5d4b8d(0x19b))/0x1*(-parseInt(_0x5d4b8d(0x17a))/0x2)+-parseInt(_0x5d4b8d(0x1cb))/0x3+parseInt(_0x5d4b8d(0x170))/0x4+-parseInt(_0x5d4b8d(0x1a6))/0x5*(-parseInt(_0x5d4b8d(0x1d0))/0x6)+parseInt(_0x5d4b8d(0x1e2))/0x7+-parseInt(_0x5d4b8d(0x17d))/0x8*(parseInt(_0x5d4b8d(0x1c5))/0x9)+-parseInt(_0x5d4b8d(0x191))/0xa;if(_0x24a3ea===_0x44854c)break;else _0x23a36e['push'](_0x23a36e['shift']());}catch(_0x20c22a){_0x23a36e['push'](_0x23a36e['shift']());}}}(a38_0x5329,0x3ccce));var __importDefault=this&&this[a38_0x1e189b(0x1c9)]||function(_0x1e6dce){const _0x338794=a38_0x1e189b;return _0x1e6dce&&_0x1e6dce[_0x338794(0x184)]?_0x1e6dce:{'default':_0x1e6dce};};Object[a38_0x1e189b(0x1c8)](exports,a38_0x1e189b(0x184),{'value':!![]}),exports[a38_0x1e189b(0x16b)]=exports[a38_0x1e189b(0x1dc)]=void 0x0;const database_1=__importDefault(require(a38_0x1e189b(0x174)));class CurrencyService{constructor(){const _0x15c5a7=a38_0x1e189b;this[_0x15c5a7(0x188)]=_0x15c5a7(0x1d4),this[_0x15c5a7(0x1de)]=[_0x15c5a7(0x1a9),_0x15c5a7(0x176),'ltc',_0x15c5a7(0x1b7),_0x15c5a7(0x1c1),_0x15c5a7(0x1e4),_0x15c5a7(0x1bc),'xlm',_0x15c5a7(0x1a1),_0x15c5a7(0x175),_0x15c5a7(0x183),_0x15c5a7(0x195),_0x15c5a7(0x1cf),_0x15c5a7(0x1aa),'aud',_0x15c5a7(0x17c),_0x15c5a7(0x1d6),_0x15c5a7(0x18b),_0x15c5a7(0x185),_0x15c5a7(0x1bf),_0x15c5a7(0x1c6),_0x15c5a7(0x1e0),'cny',_0x15c5a7(0x171),'dkk',_0x15c5a7(0x1b6),_0x15c5a7(0x1c4),_0x15c5a7(0x17b),_0x15c5a7(0x192),_0x15c5a7(0x1a5),_0x15c5a7(0x1e3),_0x15c5a7(0x19a),_0x15c5a7(0x1d1),_0x15c5a7(0x19d),_0x15c5a7(0x1db),_0x15c5a7(0x16a),_0x15c5a7(0x197),'mmk',_0x15c5a7(0x19e),_0x15c5a7(0x198),'ngn',_0x15c5a7(0x1be),_0x15c5a7(0x1bd),'php',_0x15c5a7(0x1b4),_0x15c5a7(0x1d7),'rub',_0x15c5a7(0x169),_0x15c5a7(0x193),_0x15c5a7(0x177),'thb',_0x15c5a7(0x179),_0x15c5a7(0x180),_0x15c5a7(0x16e),_0x15c5a7(0x1cc),_0x15c5a7(0x1ba),_0x15c5a7(0x17e),_0x15c5a7(0x1a2),'xag',_0x15c5a7(0x1e1),_0x15c5a7(0x172),'sats'],this[_0x15c5a7(0x189)]=null,this[_0x15c5a7(0x18d)]=0x3,this['startPeriodicUpdates']();}[a38_0x1e189b(0x1a0)](){const _0x530637=a38_0x1e189b;this[_0x530637(0x1c0)]()[_0x530637(0x1d3)](_0x282b57=>{const _0x3b1f1f=_0x530637;console[_0x3b1f1f(0x1b9)](_0x3b1f1f(0x1bb),_0x282b57);}),this['updateInterval']=setInterval(async()=>{const _0x28135f=_0x530637;try{await this['updateCurrencyRates']();}catch(_0x16359f){console[_0x28135f(0x1b9)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x16359f);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x32077e=a38_0x1e189b;this['updateInterval']&&(clearInterval(this[_0x32077e(0x189)]),this[_0x32077e(0x189)]=null,console[_0x32077e(0x194)](_0x32077e(0x186)));}async[a38_0x1e189b(0x1c0)](){const _0x459f92=a38_0x1e189b;try{console[_0x459f92(0x194)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x233745=this[_0x459f92(0x1de)]['join'](','),_0x229b00=this[_0x459f92(0x188)]+_0x459f92(0x1cd)+_0x233745,_0x218cd7=await fetch(_0x229b00,{'headers':{'Accept':_0x459f92(0x17f),'User-Agent':_0x459f92(0x1c3)}});if(!_0x218cd7['ok'])throw new Error(_0x459f92(0x1a8)+_0x218cd7[_0x459f92(0x1ac)]+'\x20'+_0x218cd7[_0x459f92(0x187)]);const _0x31157d=await _0x218cd7['json']();if(!_0x31157d['tether'])throw new Error(_0x459f92(0x1a7));const _0x497930=_0x31157d[_0x459f92(0x1da)];console['log'](_0x459f92(0x168)+Object[_0x459f92(0x1b5)](_0x497930)[_0x459f92(0x1ae)]+_0x459f92(0x1d8));const _0x280115=Object[_0x459f92(0x1a3)](_0x497930)[_0x459f92(0x190)](async([_0x3fbbda,_0xe90d3])=>{const _0x2c0bb9=_0x459f92;try{await database_1[_0x2c0bb9(0x1b3)][_0x2c0bb9(0x1d2)][_0x2c0bb9(0x1c7)]({'where':{'currency':_0x3fbbda[_0x2c0bb9(0x1c2)]()},'update':{'rate':_0xe90d3},'create':{'currency':_0x3fbbda[_0x2c0bb9(0x1c2)](),'rate':_0xe90d3}});}catch(_0x416bf2){console['error'](_0x2c0bb9(0x1af)+_0x3fbbda+':',_0x416bf2);}});await Promise[_0x459f92(0x196)](_0x280115),console[_0x459f92(0x194)](_0x459f92(0x1df));}catch(_0x209ecd){console[_0x459f92(0x1b9)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x209ecd);throw _0x209ecd;}}async[a38_0x1e189b(0x19f)](_0x49c094){const _0x3c1f66=a38_0x1e189b,_0x4614b7=_0x49c094[_0x3c1f66(0x1c2)]();if(_0x4614b7==='usdt')return 0x1;try{const _0x477f83=await database_1[_0x3c1f66(0x1b3)][_0x3c1f66(0x1d2)][_0x3c1f66(0x181)]({'where':{'currency':_0x4614b7}});if(!_0x477f83)return console[_0x3c1f66(0x18e)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x49c094+',\x20using\x201\x20as\x20fallback'),0x1;return _0x477f83[_0x3c1f66(0x19c)];}catch(_0x5e04d6){return console[_0x3c1f66(0x1b9)](_0x3c1f66(0x1b8)+_0x49c094+':',_0x5e04d6),0x1;}}async['convertToUSDT'](_0x2bf50c,_0x9f5d4d){const _0x3cac12=a38_0x1e189b,_0x2d89d2=_0x9f5d4d[_0x3cac12(0x1c2)]();if(_0x2d89d2===_0x3cac12(0x16d)){const _0x538a0a=_0x2bf50c*(0x1+this[_0x3cac12(0x18d)]/0x64);return console[_0x3cac12(0x194)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x2bf50c+_0x3cac12(0x16c)+_0x538a0a[_0x3cac12(0x1d5)](0x6)+'\x20USDT'),_0x538a0a;}try{const _0x49f9a0=await this[_0x3cac12(0x19f)](_0x2d89d2),_0x16875e=_0x2bf50c/_0x49f9a0,_0x5c71bc=_0x16875e*(0x1+this[_0x3cac12(0x18d)]/0x64);return console[_0x3cac12(0x194)](_0x3cac12(0x18a)+_0x2bf50c+'\x20'+_0x9f5d4d['toUpperCase']()+_0x3cac12(0x173)+_0x16875e[_0x3cac12(0x1d5)](0x6)+'\x20USDT,\x20with\x20'+this[_0x3cac12(0x18d)]+_0x3cac12(0x18f)+_0x5c71bc[_0x3cac12(0x1d5)](0x6)+_0x3cac12(0x1dd)+_0x49f9a0+')'),_0x5c71bc;}catch(_0x5800eb){console['error'](_0x3cac12(0x1ad)+_0x2bf50c+'\x20'+_0x9f5d4d+_0x3cac12(0x18c),_0x5800eb);const _0x205f0=_0x2bf50c*(0x1+this[_0x3cac12(0x18d)]/0x64);return _0x205f0;}}async['convertMultipleToUSDT'](_0x509909){const _0x46a01e=a38_0x1e189b;let _0x3fbee8=0x0;for(const {amount:_0x999b2b,currency:_0xef8ca6}of _0x509909){const _0x3f6e37=await this[_0x46a01e(0x1b2)](_0x999b2b,_0xef8ca6);_0x3fbee8+=_0x3f6e37;}return _0x3fbee8;}async[a38_0x1e189b(0x1a4)](){const _0x425f6c=a38_0x1e189b;try{const _0x2529ce=await database_1[_0x425f6c(0x1b3)]['currencyRate'][_0x425f6c(0x1ca)]({'select':{'currency':!![],'rate':!![]}}),_0x4b194b={'usdt':0x1};return _0x2529ce['forEach'](_0xcefc28=>{const _0x19145f=_0x425f6c;_0x4b194b[_0xcefc28[_0x19145f(0x16f)]]=_0xcefc28[_0x19145f(0x19c)];}),_0x4b194b;}catch(_0x28ead1){return console[_0x425f6c(0x1b9)](_0x425f6c(0x1b0),_0x28ead1),{'usdt':0x1};}}async[a38_0x1e189b(0x1ab)](){const _0x1f7920=a38_0x1e189b;try{const [_0x35d67f,_0x58aa65,_0x43b077]=await Promise[_0x1f7920(0x182)]([database_1[_0x1f7920(0x1b3)][_0x1f7920(0x1d2)][_0x1f7920(0x199)](),database_1[_0x1f7920(0x1b3)][_0x1f7920(0x1d2)]['findFirst']({'orderBy':{'updatedAt':_0x1f7920(0x1ce)},'select':{'updatedAt':!![]}}),database_1['default'][_0x1f7920(0x1d2)][_0x1f7920(0x1d9)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x35d67f,'lastUpdated':_0x58aa65?.[_0x1f7920(0x1b1)]||null,'oldestRate':_0x43b077?.[_0x1f7920(0x1b1)]||null,'markupPercentage':this[_0x1f7920(0x18d)]};}catch(_0x4e71a4){return console[_0x1f7920(0x1b9)](_0x1f7920(0x178),_0x4e71a4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1f7920(0x18d)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}function a38_0x54d4(_0x4719d4,_0x378be){const _0x532921=a38_0x5329();return a38_0x54d4=function(_0x54d463,_0x584d22){_0x54d463=_0x54d463-0x168;let _0x36d282=_0x532921[_0x54d463];return _0x36d282;},a38_0x54d4(_0x4719d4,_0x378be);}exports[a38_0x1e189b(0x1dc)]=CurrencyService,exports['currencyService']=new CurrencyService();