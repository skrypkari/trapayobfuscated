'use strict';const a38_0x3f9a2f=a38_0x2087;(function(_0x57fb12,_0x233bc3){const _0x15a40e=a38_0x2087,_0x469ad0=_0x57fb12();while(!![]){try{const _0x211a6a=parseInt(_0x15a40e(0xb2))/0x1+parseInt(_0x15a40e(0x91))/0x2+-parseInt(_0x15a40e(0xe1))/0x3*(parseInt(_0x15a40e(0x90))/0x4)+-parseInt(_0x15a40e(0x100))/0x5*(-parseInt(_0x15a40e(0x92))/0x6)+-parseInt(_0x15a40e(0xd3))/0x7+-parseInt(_0x15a40e(0xb8))/0x8+-parseInt(_0x15a40e(0xcb))/0x9;if(_0x211a6a===_0x233bc3)break;else _0x469ad0['push'](_0x469ad0['shift']());}catch(_0x5aec61){_0x469ad0['push'](_0x469ad0['shift']());}}}(a38_0x1312,0xdb791));var __importDefault=this&&this[a38_0x3f9a2f(0x87)]||function(_0x166d55){const _0x529d34=a38_0x3f9a2f;return _0x166d55&&_0x166d55[_0x529d34(0xbf)]?_0x166d55:{'default':_0x166d55};};Object[a38_0x3f9a2f(0x94)](exports,a38_0x3f9a2f(0xbf),{'value':!![]}),exports[a38_0x3f9a2f(0xeb)]=exports[a38_0x3f9a2f(0xf6)]=void 0x0;const database_1=__importDefault(require(a38_0x3f9a2f(0xaa)));class CurrencyService{constructor(){const _0x31ebf5=a38_0x3f9a2f;this[_0x31ebf5(0x95)]=_0x31ebf5(0xc2),this['CURRENCIES']=[_0x31ebf5(0xf7),_0x31ebf5(0xe7),'ltc',_0x31ebf5(0xf4),'bnb','eos',_0x31ebf5(0xf0),_0x31ebf5(0xbb),_0x31ebf5(0xed),'dot',_0x31ebf5(0xe6),_0x31ebf5(0xa4),'aed',_0x31ebf5(0xa8),_0x31ebf5(0xf2),_0x31ebf5(0xb7),_0x31ebf5(0xdc),_0x31ebf5(0x9c),_0x31ebf5(0x89),_0x31ebf5(0xdb),_0x31ebf5(0xa0),_0x31ebf5(0xd8),_0x31ebf5(0x9b),_0x31ebf5(0x8a),_0x31ebf5(0xa5),_0x31ebf5(0xd4),'gbp','gel',_0x31ebf5(0xc7),_0x31ebf5(0x85),_0x31ebf5(0x97),'ils',_0x31ebf5(0xbc),_0x31ebf5(0xe2),_0x31ebf5(0xe9),_0x31ebf5(0xee),_0x31ebf5(0x9f),_0x31ebf5(0xe0),_0x31ebf5(0xef),_0x31ebf5(0xfb),_0x31ebf5(0xce),_0x31ebf5(0xa1),_0x31ebf5(0x82),'php','pkr',_0x31ebf5(0x8d),_0x31ebf5(0xf9),_0x31ebf5(0x84),_0x31ebf5(0xae),_0x31ebf5(0x101),_0x31ebf5(0xa3),_0x31ebf5(0xa2),_0x31ebf5(0xfa),_0x31ebf5(0x99),_0x31ebf5(0xc6),_0x31ebf5(0xe4),_0x31ebf5(0xac),'xdr',_0x31ebf5(0xda),_0x31ebf5(0xfe),_0x31ebf5(0xbd),_0x31ebf5(0x9d)],this['updateInterval']=null,this[_0x31ebf5(0x93)]=0x3,this[_0x31ebf5(0xfd)]();}[a38_0x3f9a2f(0xfd)](){const _0x5cab6c=a38_0x3f9a2f;this[_0x5cab6c(0xf3)]()[_0x5cab6c(0xdd)](_0x2764bf=>{const _0x474930=_0x5cab6c;console['error'](_0x474930(0xd9),_0x2764bf);}),this[_0x5cab6c(0x8b)]=setInterval(async()=>{const _0x26904d=_0x5cab6c;try{await this['updateCurrencyRates']();}catch(_0x476adb){console[_0x26904d(0xab)](_0x26904d(0x96),_0x476adb);}},0x3c*0x3c*0x3e8),console[_0x5cab6c(0xb4)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x2f4fb6=a38_0x3f9a2f;this[_0x2f4fb6(0x8b)]&&(clearInterval(this[_0x2f4fb6(0x8b)]),this[_0x2f4fb6(0x8b)]=null,console[_0x2f4fb6(0xb4)](_0x2f4fb6(0xec)));}async['updateCurrencyRates'](){const _0x301aea=a38_0x3f9a2f;try{console[_0x301aea(0xb4)](_0x301aea(0xad));const _0x573e82=this['CURRENCIES'][_0x301aea(0xff)](','),_0x3db8fe=this[_0x301aea(0x95)]+_0x301aea(0xde)+_0x573e82,_0x168a82=await fetch(_0x3db8fe,{'headers':{'Accept':'application/json','User-Agent':_0x301aea(0x86)}});if(!_0x168a82['ok'])throw new Error(_0x301aea(0xc1)+_0x168a82[_0x301aea(0xaf)]+'\x20'+_0x168a82[_0x301aea(0x83)]);const _0x183acf=await _0x168a82[_0x301aea(0x98)]();if(!_0x183acf['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x284068=_0x183acf[_0x301aea(0xd1)];console[_0x301aea(0xb4)](_0x301aea(0xb3)+Object[_0x301aea(0x9a)](_0x284068)[_0x301aea(0xc8)]+_0x301aea(0xbe));const _0x3c44d3=Object[_0x301aea(0xd5)](_0x284068)[_0x301aea(0xd0)](async([_0x48e6c1,_0x250359])=>{const _0x2975c4=_0x301aea;try{await database_1[_0x2975c4(0xc0)][_0x2975c4(0x8e)]['upsert']({'where':{'currency':_0x48e6c1[_0x2975c4(0x8c)]()},'update':{'rate':_0x250359},'create':{'currency':_0x48e6c1[_0x2975c4(0x8c)](),'rate':_0x250359}});}catch(_0x4e4f54){console[_0x2975c4(0xab)](_0x2975c4(0xc5)+_0x48e6c1+':',_0x4e4f54);}});await Promise[_0x301aea(0xa6)](_0x3c44d3),console['log'](_0x301aea(0xc3));}catch(_0x28df7f){console['error'](_0x301aea(0xe3),_0x28df7f);throw _0x28df7f;}}async[a38_0x3f9a2f(0xb6)](_0x8ca882){const _0x43f24d=a38_0x3f9a2f,_0x40575e=_0x8ca882[_0x43f24d(0x8c)]();if(_0x40575e===_0x43f24d(0xc4))return 0x1;try{const _0x257e84=await database_1[_0x43f24d(0xc0)]['currencyRate']['findUnique']({'where':{'currency':_0x40575e}});if(!_0x257e84)return console[_0x43f24d(0xa7)](_0x43f24d(0xba)+_0x8ca882+_0x43f24d(0x9e)),0x1;return _0x257e84['rate'];}catch(_0x39e3d4){return console[_0x43f24d(0xab)](_0x43f24d(0xf1)+_0x8ca882+':',_0x39e3d4),0x1;}}async[a38_0x3f9a2f(0xcc)](_0x294c4d,_0xf9f9b){const _0x3180b9=a38_0x3f9a2f,_0x3be60b=_0xf9f9b[_0x3180b9(0x8c)]();if(_0x3be60b===_0x3180b9(0xc4)){const _0x542496=_0x294c4d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3180b9(0xb4)](_0x3180b9(0xfc)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x294c4d+'\x20USDT\x20=\x20'+_0x542496[_0x3180b9(0xe8)](0x6)+_0x3180b9(0xd6)),_0x542496;}try{const _0xef42ad=await this[_0x3180b9(0xb6)](_0x3be60b),_0x56743b=_0x294c4d/_0xef42ad,_0x2b8274=_0x56743b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3180b9(0xb4)](_0x3180b9(0xb5)+_0x294c4d+'\x20'+_0xf9f9b[_0x3180b9(0x8f)]()+_0x3180b9(0xf8)+_0x56743b[_0x3180b9(0xe8)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x2b8274[_0x3180b9(0xe8)](0x6)+_0x3180b9(0xb0)+_0xef42ad+')'),_0x2b8274;}catch(_0x317553){console[_0x3180b9(0xab)]('Error\x20converting\x20'+_0x294c4d+'\x20'+_0xf9f9b+_0x3180b9(0xdf),_0x317553);const _0x3066e6=_0x294c4d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3066e6;}}async[a38_0x3f9a2f(0x88)](_0x1c3555){const _0x88794=a38_0x3f9a2f;let _0x468542=0x0;for(const {amount:_0x1eaacc,currency:_0x5d0e79}of _0x1c3555){const _0x46407f=await this[_0x88794(0xcc)](_0x1eaacc,_0x5d0e79);_0x468542+=_0x46407f;}return _0x468542;}async[a38_0x3f9a2f(0xb9)](){const _0x1102f5=a38_0x3f9a2f;try{const _0x47417d=await database_1['default']['currencyRate'][_0x1102f5(0xe5)]({'select':{'currency':!![],'rate':!![]}}),_0x3b76e0={'usdt':0x1};return _0x47417d[_0x1102f5(0xd7)](_0xba2e56=>{const _0x3f95c2=_0x1102f5;_0x3b76e0[_0xba2e56[_0x3f95c2(0xca)]]=_0xba2e56[_0x3f95c2(0xd2)];}),_0x3b76e0;}catch(_0x80a905){return console[_0x1102f5(0xab)](_0x1102f5(0xcd),_0x80a905),{'usdt':0x1};}}async[a38_0x3f9a2f(0xc9)](){const _0x2b91b1=a38_0x3f9a2f;try{const [_0x546d11,_0x292809,_0xb0217d]=await Promise[_0x2b91b1(0xcf)]([database_1[_0x2b91b1(0xc0)]['currencyRate'][_0x2b91b1(0x81)](),database_1[_0x2b91b1(0xc0)][_0x2b91b1(0x8e)][_0x2b91b1(0xea)]({'orderBy':{'updatedAt':_0x2b91b1(0xb1)},'select':{'updatedAt':!![]}}),database_1[_0x2b91b1(0xc0)][_0x2b91b1(0x8e)][_0x2b91b1(0xea)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x546d11,'lastUpdated':_0x292809?.['updatedAt']||null,'oldestRate':_0xb0217d?.['updatedAt']||null,'markupPercentage':this[_0x2b91b1(0x93)]};}catch(_0x35ff44){return console['error'](_0x2b91b1(0xf5),_0x35ff44),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2b91b1(0x93)]};}}[a38_0x3f9a2f(0xa9)](){return this['MARKUP_PERCENTAGE'];}}function a38_0x2087(_0x4835a0,_0x2ad56d){const _0x13128a=a38_0x1312();return a38_0x2087=function(_0x20875d,_0x414734){_0x20875d=_0x20875d-0x81;let _0x3addc4=_0x13128a[_0x20875d];return _0x3addc4;},a38_0x2087(_0x4835a0,_0x2ad56d);}exports[a38_0x3f9a2f(0xf6)]=CurrencyService,exports[a38_0x3f9a2f(0xeb)]=new CurrencyService();function a38_0x1312(){const _0x32329f=['allSettled','warn','ars','getMarkupPercentage','../config/database','error','zar','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','sek','status','\x20USDT\x20(rate:\x20','desc','902040oMBliR','üìä\x20Received\x20rates\x20for\x20','log','üí±\x20Converted\x20','getCurrencyRate','bdt','634360nNrvDv','getAllRates','No\x20rate\x20found\x20for\x20currency:\x20','xlm','inr','bits','\x20currencies','__esModule','default','CoinGecko\x20API\x20error:\x20','https://api.coingecko.com/api/v3/simple/price','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','usdt','Failed\x20to\x20update\x20rate\x20for\x20','vef','hkd','length','getRatesStatus','currency','10158102lsieUS','convertToUSDT','Error\x20getting\x20all\x20rates:','ngn','all','map','tether','rate','1557178vvoDSA','eur','entries','\x20USDT','forEach','clp','Initial\x20currency\x20rates\x20update\x20failed:','xag','cad','bhd','catch','?ids=tether&vs_currencies=','\x20to\x20USDT:','mmk','4885503oxKeBV','jpy','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','vnd','findMany','yfi','eth','toFixed','krw','findFirst','currencyService','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','link','kwd','mxn','xrp','Error\x20getting\x20rate\x20for\x20currency\x20','aud','updateCurrencyRates','bch','Error\x20getting\x20rates\x20status:','CurrencyService','btc','\x20to\x20','rub','twd','myr','üí±\x20Applied\x20','startPeriodicUpdates','xau','join','1250eQkfaA','sgd','count','nzd','statusText','sar','huf','TesSoft\x20Payment\x20System/1.0','__importDefault','convertMultipleToUSDT','brl','czk','updateInterval','toLowerCase','pln','currencyRate','toUpperCase','4dORcuR','3376198hoSvvC','32826BjUTjp','MARKUP_PERCENTAGE','defineProperty','COINGECKO_URL','Periodic\x20currency\x20rates\x20update\x20failed:','idr','json','uah','keys','cny','bmd','sats',',\x20using\x201\x20as\x20fallback','lkr','chf','nok','try','thb','usd','dkk'];a38_0x1312=function(){return _0x32329f;};return a38_0x1312();}