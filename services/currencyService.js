'use strict';const a38_0x5f1de=a38_0x1022;(function(_0xd1c1af,_0x8874b4){const _0x1f92d5=a38_0x1022,_0xb016df=_0xd1c1af();while(!![]){try{const _0x5debc1=-parseInt(_0x1f92d5(0x1f8))/0x1+-parseInt(_0x1f92d5(0x1eb))/0x2+parseInt(_0x1f92d5(0x1fc))/0x3+-parseInt(_0x1f92d5(0x24a))/0x4+-parseInt(_0x1f92d5(0x1f2))/0x5+-parseInt(_0x1f92d5(0x203))/0x6*(parseInt(_0x1f92d5(0x213))/0x7)+-parseInt(_0x1f92d5(0x1f1))/0x8*(-parseInt(_0x1f92d5(0x22d))/0x9);if(_0x5debc1===_0x8874b4)break;else _0xb016df['push'](_0xb016df['shift']());}catch(_0x375c74){_0xb016df['push'](_0xb016df['shift']());}}}(a38_0xfdfd,0x611c4));var __importDefault=this&&this['__importDefault']||function(_0x3a687a){const _0x26d926=a38_0x1022;return _0x3a687a&&_0x3a687a[_0x26d926(0x1e7)]?_0x3a687a:{'default':_0x3a687a};};Object[a38_0x5f1de(0x21e)](exports,a38_0x5f1de(0x1e7),{'value':!![]}),exports['currencyService']=exports[a38_0x5f1de(0x1ea)]=void 0x0;function a38_0xfdfd(){const _0x333b71=['uah','gbp','nok','usd','mxn','cny','application/json','jpy','statusText','chf','MARKUP_PERCENTAGE','xdr','default','keys','eos','56dqvPKu','Error\x20getting\x20rate\x20for\x20currency\x20','asc','length','getRatesStatus','dot','usdt','https://api.coingecko.com/api/v3/simple/price',',\x20using\x201\x20as\x20fallback','toLowerCase','💱\x20Applied\x20','defineProperty','allSettled','updatedAt','findUnique','gel','\x20USDT\x20(rate:\x20','💱\x20Converted\x20','Error\x20getting\x20all\x20rates:','ltc','getMarkupPercentage','xau','xlm','rate','bmd','Initial\x20currency\x20rates\x20update\x20failed:','89235eqhJNM','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','kwd','thb','nzd','pln','\x20USDT','error','sats','toFixed','xag','❌\x20Failed\x20to\x20update\x20currency\x20rates:','aud','%\x20markup\x20to\x20','\x20currencies','upsert','✅\x20Currency\x20rates\x20updated\x20successfully','bch','log','eth','TesSoft\x20Payment\x20System/1.0','Periodic\x20currency\x20rates\x20update\x20failed:','dkk','\x20USDT,\x20with\x20','findFirst','krw','mmk','updateInterval','btc','30192EovhXk','sek','No\x20rate\x20found\x20for\x20currency:\x20','startPeriodicUpdates','hkd','convertToUSDT','php','ngn','link','count','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','catch','czk','join','xrp','Error\x20converting\x20','currencyRate','sgd','bits','updateCurrencyRates','CURRENCIES','COINGECKO_URL','eur','toUpperCase','warn','convertMultipleToUSDT','__esModule','?ids=tether&vs_currencies=','%\x20markup\x20=\x20','CurrencyService','178450GiOrFK','inr','idr','huf','\x20to\x20','../config/database','1216ivwQBz','2150765CpVkXn','yfi','ils','Failed\x20to\x20update\x20rate\x20for\x20','try','rub','615284LCPIRX','ars','entries','all','244578POcxPL','\x20USDT\x20=\x20','forEach','getCurrencyRate','📊\x20Received\x20rates\x20for\x20','getAllRates','desc','36474zfNlXC'];a38_0xfdfd=function(){return _0x333b71;};return a38_0xfdfd();}const database_1=__importDefault(require(a38_0x5f1de(0x1f0)));function a38_0x1022(_0x256712,_0x3306de){const _0xfdfd3b=a38_0xfdfd();return a38_0x1022=function(_0x102257,_0x4b4952){_0x102257=_0x102257-0x1e3;let _0x738de6=_0xfdfd3b[_0x102257];return _0x738de6;},a38_0x1022(_0x256712,_0x3306de);}class CurrencyService{constructor(){const _0x145f39=a38_0x5f1de;this[_0x145f39(0x25f)]=_0x145f39(0x21a),this[_0x145f39(0x25e)]=[_0x145f39(0x249),_0x145f39(0x240),_0x145f39(0x226),_0x145f39(0x23e),'bnb',_0x145f39(0x212),_0x145f39(0x258),_0x145f39(0x229),_0x145f39(0x252),_0x145f39(0x218),_0x145f39(0x1f3),_0x145f39(0x207),'aed',_0x145f39(0x1f9),_0x145f39(0x239),'bdt','bhd',_0x145f39(0x22b),'brl','cad',_0x145f39(0x20d),'clp',_0x145f39(0x209),_0x145f39(0x256),_0x145f39(0x243),_0x145f39(0x1e3),_0x145f39(0x205),_0x145f39(0x222),_0x145f39(0x24e),_0x145f39(0x1ee),_0x145f39(0x1ed),_0x145f39(0x1f4),_0x145f39(0x1ec),_0x145f39(0x20b),_0x145f39(0x246),_0x145f39(0x22f),'lkr',_0x145f39(0x247),_0x145f39(0x208),'myr',_0x145f39(0x251),_0x145f39(0x206),_0x145f39(0x231),_0x145f39(0x250),'pkr',_0x145f39(0x232),_0x145f39(0x1f7),'sar',_0x145f39(0x24b),_0x145f39(0x25b),_0x145f39(0x230),_0x145f39(0x1f6),'twd',_0x145f39(0x204),'vef','vnd','zar',_0x145f39(0x20f),_0x145f39(0x237),_0x145f39(0x228),_0x145f39(0x25c),_0x145f39(0x235)],this[_0x145f39(0x248)]=null,this[_0x145f39(0x20e)]=0x3,this[_0x145f39(0x24d)]();}['startPeriodicUpdates'](){const _0x4fd741=a38_0x5f1de;this[_0x4fd741(0x25d)]()[_0x4fd741(0x255)](_0xb602fe=>{const _0x20b8d4=_0x4fd741;console[_0x20b8d4(0x234)](_0x20b8d4(0x22c),_0xb602fe);}),this[_0x4fd741(0x248)]=setInterval(async()=>{const _0x2579a8=_0x4fd741;try{await this[_0x2579a8(0x25d)]();}catch(_0x4ee74b){console[_0x2579a8(0x234)](_0x2579a8(0x242),_0x4ee74b);}},0x3c*0x3c*0x3e8),console[_0x4fd741(0x23f)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x5731b7=a38_0x5f1de;this[_0x5731b7(0x248)]&&(clearInterval(this[_0x5731b7(0x248)]),this[_0x5731b7(0x248)]=null,console[_0x5731b7(0x23f)](_0x5731b7(0x22e)));}async[a38_0x5f1de(0x25d)](){const _0x3172cd=a38_0x5f1de;try{console[_0x3172cd(0x23f)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x44c4a4=this[_0x3172cd(0x25e)][_0x3172cd(0x257)](','),_0x1ae16f=this[_0x3172cd(0x25f)]+_0x3172cd(0x1e8)+_0x44c4a4,_0x3adf85=await fetch(_0x1ae16f,{'headers':{'Accept':_0x3172cd(0x20a),'User-Agent':_0x3172cd(0x241)}});if(!_0x3adf85['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x3adf85['status']+'\x20'+_0x3adf85[_0x3172cd(0x20c)]);const _0x143fcd=await _0x3adf85['json']();if(!_0x143fcd['tether'])throw new Error(_0x3172cd(0x254));const _0x38d986=_0x143fcd['tether'];console['log'](_0x3172cd(0x200)+Object[_0x3172cd(0x211)](_0x38d986)[_0x3172cd(0x216)]+_0x3172cd(0x23b));const _0xbd0e71=Object[_0x3172cd(0x1fa)](_0x38d986)['map'](async([_0x8a6b43,_0x48114d])=>{const _0x4e3d82=_0x3172cd;try{await database_1['default'][_0x4e3d82(0x25a)][_0x4e3d82(0x23c)]({'where':{'currency':_0x8a6b43[_0x4e3d82(0x21c)]()},'update':{'rate':_0x48114d},'create':{'currency':_0x8a6b43[_0x4e3d82(0x21c)](),'rate':_0x48114d}});}catch(_0x42d9e2){console['error'](_0x4e3d82(0x1f5)+_0x8a6b43+':',_0x42d9e2);}});await Promise[_0x3172cd(0x21f)](_0xbd0e71),console[_0x3172cd(0x23f)](_0x3172cd(0x23d));}catch(_0x1963a5){console[_0x3172cd(0x234)](_0x3172cd(0x238),_0x1963a5);throw _0x1963a5;}}async[a38_0x5f1de(0x1ff)](_0x5fd2b2){const _0x37681c=a38_0x5f1de,_0xa69e52=_0x5fd2b2[_0x37681c(0x21c)]();if(_0xa69e52===_0x37681c(0x219))return 0x1;try{const _0x4e6e4d=await database_1[_0x37681c(0x210)][_0x37681c(0x25a)][_0x37681c(0x221)]({'where':{'currency':_0xa69e52}});if(!_0x4e6e4d)return console[_0x37681c(0x1e5)](_0x37681c(0x24c)+_0x5fd2b2+_0x37681c(0x21b)),0x1;return _0x4e6e4d['rate'];}catch(_0xb61e31){return console[_0x37681c(0x234)](_0x37681c(0x214)+_0x5fd2b2+':',_0xb61e31),0x1;}}async[a38_0x5f1de(0x24f)](_0x48c17d,_0x3d4ef7){const _0x422d7b=a38_0x5f1de,_0x46cf9c=_0x3d4ef7[_0x422d7b(0x21c)]();if(_0x46cf9c===_0x422d7b(0x219)){const _0xf1d6e=_0x48c17d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x422d7b(0x23f)](_0x422d7b(0x21d)+this[_0x422d7b(0x20e)]+_0x422d7b(0x23a)+_0x48c17d+_0x422d7b(0x1fd)+_0xf1d6e['toFixed'](0x6)+_0x422d7b(0x233)),_0xf1d6e;}try{const _0x2fd1d=await this[_0x422d7b(0x1ff)](_0x46cf9c),_0x181ca9=_0x48c17d/_0x2fd1d,_0x34c2b8=_0x181ca9*(0x1+this[_0x422d7b(0x20e)]/0x64);return console[_0x422d7b(0x23f)](_0x422d7b(0x224)+_0x48c17d+'\x20'+_0x3d4ef7[_0x422d7b(0x1e4)]()+_0x422d7b(0x1ef)+_0x181ca9[_0x422d7b(0x236)](0x6)+_0x422d7b(0x244)+this['MARKUP_PERCENTAGE']+_0x422d7b(0x1e9)+_0x34c2b8['toFixed'](0x6)+_0x422d7b(0x223)+_0x2fd1d+')'),_0x34c2b8;}catch(_0x26383){console[_0x422d7b(0x234)](_0x422d7b(0x259)+_0x48c17d+'\x20'+_0x3d4ef7+'\x20to\x20USDT:',_0x26383);const _0x4d3f45=_0x48c17d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x4d3f45;}}async[a38_0x5f1de(0x1e6)](_0x3e615d){let _0x51b5ad=0x0;for(const {amount:_0xb64922,currency:_0x126657}of _0x3e615d){const _0x551677=await this['convertToUSDT'](_0xb64922,_0x126657);_0x51b5ad+=_0x551677;}return _0x51b5ad;}async[a38_0x5f1de(0x201)](){const _0x31ed70=a38_0x5f1de;try{const _0x2b4fb7=await database_1[_0x31ed70(0x210)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x240189={'usdt':0x1};return _0x2b4fb7[_0x31ed70(0x1fe)](_0x5e69cd=>{const _0x5eaf5e=_0x31ed70;_0x240189[_0x5e69cd['currency']]=_0x5e69cd[_0x5eaf5e(0x22a)];}),_0x240189;}catch(_0x52a159){return console[_0x31ed70(0x234)](_0x31ed70(0x225),_0x52a159),{'usdt':0x1};}}async[a38_0x5f1de(0x217)](){const _0x521398=a38_0x5f1de;try{const [_0x4c6c81,_0x4a600c,_0x3328e1]=await Promise[_0x521398(0x1fb)]([database_1[_0x521398(0x210)]['currencyRate'][_0x521398(0x253)](),database_1[_0x521398(0x210)][_0x521398(0x25a)][_0x521398(0x245)]({'orderBy':{'updatedAt':_0x521398(0x202)},'select':{'updatedAt':!![]}}),database_1[_0x521398(0x210)][_0x521398(0x25a)][_0x521398(0x245)]({'orderBy':{'updatedAt':_0x521398(0x215)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4c6c81,'lastUpdated':_0x4a600c?.[_0x521398(0x220)]||null,'oldestRate':_0x3328e1?.[_0x521398(0x220)]||null,'markupPercentage':this[_0x521398(0x20e)]};}catch(_0x4dec20){return console[_0x521398(0x234)]('Error\x20getting\x20rates\x20status:',_0x4dec20),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x521398(0x20e)]};}}[a38_0x5f1de(0x227)](){const _0x16a894=a38_0x5f1de;return this[_0x16a894(0x20e)];}}exports[a38_0x5f1de(0x1ea)]=CurrencyService,exports['currencyService']=new CurrencyService();