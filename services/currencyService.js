'use strict';const a38_0x13227b=a38_0x3262;function a38_0x3262(_0x5878b8,_0x4e12a6){const _0x1921db=a38_0x1921();return a38_0x3262=function(_0x32626c,_0x294747){_0x32626c=_0x32626c-0x1f0;let _0x1a7279=_0x1921db[_0x32626c];return _0x1a7279;},a38_0x3262(_0x5878b8,_0x4e12a6);}(function(_0x511602,_0x5f3177){const _0x2d6a94=a38_0x3262,_0x1492f2=_0x511602();while(!![]){try{const _0x338c6c=parseInt(_0x2d6a94(0x242))/0x1+-parseInt(_0x2d6a94(0x204))/0x2*(-parseInt(_0x2d6a94(0x253))/0x3)+parseInt(_0x2d6a94(0x268))/0x4*(parseInt(_0x2d6a94(0x248))/0x5)+parseInt(_0x2d6a94(0x265))/0x6+parseInt(_0x2d6a94(0x213))/0x7*(-parseInt(_0x2d6a94(0x233))/0x8)+-parseInt(_0x2d6a94(0x200))/0x9*(parseInt(_0x2d6a94(0x228))/0xa)+-parseInt(_0x2d6a94(0x222))/0xb;if(_0x338c6c===_0x5f3177)break;else _0x1492f2['push'](_0x1492f2['shift']());}catch(_0x6952a4){_0x1492f2['push'](_0x1492f2['shift']());}}}(a38_0x1921,0xd0326));function a38_0x1921(){const _0x55764d=['currency','usdt','Initial\x20currency\x20rates\x20update\x20failed:','%\x20markup\x20to\x20','vef','krw','cny',',\x20using\x201\x20as\x20fallback','pln','currencyService','%\x20markup\x20=\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','allSettled','defineProperty','xrp','usd','chf','nok','26379CTfrvm','TesSoft\x20Payment\x20System/1.0','bnb','error','2HJlfpx','sek','btc','jpy','convertMultipleToUSDT','getRatesStatus','updateInterval','💱\x20Converted\x20','forEach','\x20to\x20USDT:','ngn','asc','✅\x20Currency\x20rates\x20updated\x20successfully','ltc','convertToUSDT','7fpUEjb','mxn','log','aud','startPeriodicUpdates','?ids=tether&vs_currencies=','thb','catch','vnd','php','brl','https://api.coingecko.com/api/v3/simple/price','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','Error\x20getting\x20rates\x20status:','__importDefault','6219345ZeQVZS','CoinGecko\x20API\x20error:\x20','currencyRate','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','sgd','\x20to\x20','4860NlMDBh','cad','💱\x20Applied\x20','stopPeriodicUpdates','CURRENCIES','\x20USDT,\x20with\x20','toLowerCase','keys','COINGECKO_URL','json','mmk','208456vRXaKL','Periodic\x20currency\x20rates\x20update\x20failed:','CurrencyService','lkr','updateCurrencyRates','gbp','sats','dot','status','\x20USDT\x20=\x20','zar','length','bmd','tether','huf','1162950WUSktg','No\x20rate\x20found\x20for\x20currency:\x20','nzd','uah','ars','eur','5dXSwZF','yfi','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','ils','join','__esModule','findMany','twd','statusText','\x20USDT','📊\x20Received\x20rates\x20for\x20','2227647fzfYul','xag','toFixed','bdt','application/json','getCurrencyRate','Error\x20converting\x20','rate','czk','kwd','bch','Error\x20getting\x20all\x20rates:','xlm','getMarkupPercentage','bits','entries','MARKUP_PERCENTAGE','idr','1119792DKEbOZ','xau','default','3106244EueYQU'];a38_0x1921=function(){return _0x55764d;};return a38_0x1921();}var __importDefault=this&&this[a38_0x13227b(0x221)]||function(_0x607621){const _0x46b531=a38_0x13227b;return _0x607621&&_0x607621[_0x46b531(0x24d)]?_0x607621:{'default':_0x607621};};Object[a38_0x13227b(0x1fb)](exports,a38_0x13227b(0x24d),{'value':!![]}),exports[a38_0x13227b(0x1f7)]=exports[a38_0x13227b(0x235)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x2f6b20=a38_0x13227b;this[_0x2f6b20(0x230)]=_0x2f6b20(0x21e),this[_0x2f6b20(0x22c)]=[_0x2f6b20(0x206),'eth',_0x2f6b20(0x211),_0x2f6b20(0x25d),_0x2f6b20(0x202),'eos',_0x2f6b20(0x1fc),_0x2f6b20(0x25f),'link',_0x2f6b20(0x23a),_0x2f6b20(0x249),_0x2f6b20(0x1fd),'aed',_0x2f6b20(0x246),_0x2f6b20(0x216),_0x2f6b20(0x256),'bhd',_0x2f6b20(0x23f),_0x2f6b20(0x21d),_0x2f6b20(0x229),_0x2f6b20(0x1fe),'clp',_0x2f6b20(0x1f4),_0x2f6b20(0x25b),'dkk',_0x2f6b20(0x247),_0x2f6b20(0x238),'gel','hkd',_0x2f6b20(0x241),_0x2f6b20(0x264),_0x2f6b20(0x24b),'inr',_0x2f6b20(0x207),_0x2f6b20(0x1f3),_0x2f6b20(0x25c),_0x2f6b20(0x236),_0x2f6b20(0x232),_0x2f6b20(0x214),'myr',_0x2f6b20(0x20e),_0x2f6b20(0x1ff),_0x2f6b20(0x244),_0x2f6b20(0x21c),'pkr',_0x2f6b20(0x1f6),'rub','sar',_0x2f6b20(0x205),_0x2f6b20(0x226),_0x2f6b20(0x219),'try',_0x2f6b20(0x24f),_0x2f6b20(0x245),_0x2f6b20(0x1f2),_0x2f6b20(0x21b),_0x2f6b20(0x23d),'xdr',_0x2f6b20(0x254),_0x2f6b20(0x266),_0x2f6b20(0x261),_0x2f6b20(0x239)],this[_0x2f6b20(0x20a)]=null,this[_0x2f6b20(0x263)]=0x3,this[_0x2f6b20(0x217)]();}[a38_0x13227b(0x217)](){const _0x880aca=a38_0x13227b;this[_0x880aca(0x237)]()[_0x880aca(0x21a)](_0x3cafc3=>{const _0x3c0cc4=_0x880aca;console[_0x3c0cc4(0x203)](_0x3c0cc4(0x1f0),_0x3cafc3);}),this[_0x880aca(0x20a)]=setInterval(async()=>{const _0x403f03=_0x880aca;try{await this[_0x403f03(0x237)]();}catch(_0x4c75f1){console['error'](_0x403f03(0x234),_0x4c75f1);}},0x3c*0x3c*0x3e8),console[_0x880aca(0x215)](_0x880aca(0x1f9));}[a38_0x13227b(0x22b)](){const _0x2dd881=a38_0x13227b;this[_0x2dd881(0x20a)]&&(clearInterval(this[_0x2dd881(0x20a)]),this['updateInterval']=null,console[_0x2dd881(0x215)](_0x2dd881(0x21f)));}async[a38_0x13227b(0x237)](){const _0x56bd1f=a38_0x13227b;try{console[_0x56bd1f(0x215)](_0x56bd1f(0x225));const _0x2d79b8=this['CURRENCIES'][_0x56bd1f(0x24c)](','),_0x3b952e=this['COINGECKO_URL']+_0x56bd1f(0x218)+_0x2d79b8,_0x2c2d7b=await fetch(_0x3b952e,{'headers':{'Accept':_0x56bd1f(0x257),'User-Agent':_0x56bd1f(0x201)}});if(!_0x2c2d7b['ok'])throw new Error(_0x56bd1f(0x223)+_0x2c2d7b[_0x56bd1f(0x23b)]+'\x20'+_0x2c2d7b[_0x56bd1f(0x250)]);const _0x2a6c22=await _0x2c2d7b[_0x56bd1f(0x231)]();if(!_0x2a6c22[_0x56bd1f(0x240)])throw new Error(_0x56bd1f(0x24a));const _0xdba879=_0x2a6c22[_0x56bd1f(0x240)];console[_0x56bd1f(0x215)](_0x56bd1f(0x252)+Object[_0x56bd1f(0x22f)](_0xdba879)[_0x56bd1f(0x23e)]+'\x20currencies');const _0x129c51=Object[_0x56bd1f(0x262)](_0xdba879)['map'](async([_0x210f03,_0x5a2053])=>{const _0x1b3227=_0x56bd1f;try{await database_1[_0x1b3227(0x267)]['currencyRate']['upsert']({'where':{'currency':_0x210f03[_0x1b3227(0x22e)]()},'update':{'rate':_0x5a2053},'create':{'currency':_0x210f03['toLowerCase'](),'rate':_0x5a2053}});}catch(_0x5a98d9){console[_0x1b3227(0x203)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x210f03+':',_0x5a98d9);}});await Promise[_0x56bd1f(0x1fa)](_0x129c51),console['log'](_0x56bd1f(0x210));}catch(_0x142227){console[_0x56bd1f(0x203)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x142227);throw _0x142227;}}async['getCurrencyRate'](_0x4340c0){const _0x4a01c6=a38_0x13227b,_0xf409ae=_0x4340c0['toLowerCase']();if(_0xf409ae===_0x4a01c6(0x26a))return 0x1;try{const _0x4c6a33=await database_1[_0x4a01c6(0x267)][_0x4a01c6(0x224)]['findUnique']({'where':{'currency':_0xf409ae}});if(!_0x4c6a33)return console['warn'](_0x4a01c6(0x243)+_0x4340c0+_0x4a01c6(0x1f5)),0x1;return _0x4c6a33[_0x4a01c6(0x25a)];}catch(_0x3c24c1){return console[_0x4a01c6(0x203)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x4340c0+':',_0x3c24c1),0x1;}}async[a38_0x13227b(0x212)](_0x328416,_0xe5eabf){const _0x46a813=a38_0x13227b,_0x2f0341=_0xe5eabf[_0x46a813(0x22e)]();if(_0x2f0341==='usdt'){const _0x580461=_0x328416*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x46a813(0x215)](_0x46a813(0x22a)+this[_0x46a813(0x263)]+_0x46a813(0x1f1)+_0x328416+_0x46a813(0x23c)+_0x580461['toFixed'](0x6)+_0x46a813(0x251)),_0x580461;}try{const _0x26d244=await this[_0x46a813(0x258)](_0x2f0341),_0x58f715=_0x328416/_0x26d244,_0x5c8c30=_0x58f715*(0x1+this[_0x46a813(0x263)]/0x64);return console[_0x46a813(0x215)](_0x46a813(0x20b)+_0x328416+'\x20'+_0xe5eabf['toUpperCase']()+_0x46a813(0x227)+_0x58f715['toFixed'](0x6)+_0x46a813(0x22d)+this['MARKUP_PERCENTAGE']+_0x46a813(0x1f8)+_0x5c8c30[_0x46a813(0x255)](0x6)+'\x20USDT\x20(rate:\x20'+_0x26d244+')'),_0x5c8c30;}catch(_0x4d7e73){console[_0x46a813(0x203)](_0x46a813(0x259)+_0x328416+'\x20'+_0xe5eabf+_0x46a813(0x20d),_0x4d7e73);const _0x372e8f=_0x328416*(0x1+this[_0x46a813(0x263)]/0x64);return _0x372e8f;}}async[a38_0x13227b(0x208)](_0x4cb88b){const _0xa8c69d=a38_0x13227b;let _0x5202b4=0x0;for(const {amount:_0x326743,currency:_0x16cc2a}of _0x4cb88b){const _0x2b82a7=await this[_0xa8c69d(0x212)](_0x326743,_0x16cc2a);_0x5202b4+=_0x2b82a7;}return _0x5202b4;}async['getAllRates'](){const _0x39f4ae=a38_0x13227b;try{const _0x302a3e=await database_1[_0x39f4ae(0x267)]['currencyRate'][_0x39f4ae(0x24e)]({'select':{'currency':!![],'rate':!![]}}),_0x583b82={'usdt':0x1};return _0x302a3e[_0x39f4ae(0x20c)](_0x2fd1e4=>{const _0x36987e=_0x39f4ae;_0x583b82[_0x2fd1e4[_0x36987e(0x269)]]=_0x2fd1e4['rate'];}),_0x583b82;}catch(_0x47b430){return console['error'](_0x39f4ae(0x25e),_0x47b430),{'usdt':0x1};}}async[a38_0x13227b(0x209)](){const _0x529fa6=a38_0x13227b;try{const [_0x24f400,_0x2a5b27,_0x2554c7]=await Promise['all']([database_1[_0x529fa6(0x267)]['currencyRate']['count'](),database_1[_0x529fa6(0x267)][_0x529fa6(0x224)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x529fa6(0x267)][_0x529fa6(0x224)]['findFirst']({'orderBy':{'updatedAt':_0x529fa6(0x20f)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x24f400,'lastUpdated':_0x2a5b27?.['updatedAt']||null,'oldestRate':_0x2554c7?.['updatedAt']||null,'markupPercentage':this[_0x529fa6(0x263)]};}catch(_0x3ba0c1){return console[_0x529fa6(0x203)](_0x529fa6(0x220),_0x3ba0c1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x529fa6(0x263)]};}}[a38_0x13227b(0x260)](){const _0x1b44eb=a38_0x13227b;return this[_0x1b44eb(0x263)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x13227b(0x1f7)]=new CurrencyService();