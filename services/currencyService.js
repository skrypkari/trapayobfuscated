'use strict';const a36_0x45837a=a36_0x14be;(function(_0x3303dc,_0x38bbba){const _0x547337=a36_0x14be,_0x37f827=_0x3303dc();while(!![]){try{const _0x47e27b=-parseInt(_0x547337(0x1f7))/0x1*(-parseInt(_0x547337(0x1d3))/0x2)+-parseInt(_0x547337(0x1db))/0x3+-parseInt(_0x547337(0x1b7))/0x4+-parseInt(_0x547337(0x1c0))/0x5+parseInt(_0x547337(0x1d6))/0x6+parseInt(_0x547337(0x1d8))/0x7*(-parseInt(_0x547337(0x20b))/0x8)+-parseInt(_0x547337(0x1ce))/0x9*(-parseInt(_0x547337(0x21a))/0xa);if(_0x47e27b===_0x38bbba)break;else _0x37f827['push'](_0x37f827['shift']());}catch(_0x2c44a8){_0x37f827['push'](_0x37f827['shift']());}}}(a36_0x26d3,0x2d14a));function a36_0x14be(_0x575c32,_0x523571){const _0x26d364=a36_0x26d3();return a36_0x14be=function(_0x14be98,_0x27ae0e){_0x14be98=_0x14be98-0x1ac;let _0x424fe2=_0x26d364[_0x14be98];return _0x424fe2;},a36_0x14be(_0x575c32,_0x523571);}var __importDefault=this&&this[a36_0x45837a(0x1fa)]||function(_0x1ae715){const _0xaea9f9=a36_0x45837a;return _0x1ae715&&_0x1ae715[_0xaea9f9(0x1b4)]?_0x1ae715:{'default':_0x1ae715};};Object[a36_0x45837a(0x218)](exports,a36_0x45837a(0x1b4),{'value':!![]}),exports[a36_0x45837a(0x21b)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a36_0x45837a(0x1e3)));class CurrencyService{constructor(){const _0xbb309b=a36_0x45837a;this[_0xbb309b(0x1e2)]=_0xbb309b(0x1ed),this['CURRENCIES']=['btc',_0xbb309b(0x201),_0xbb309b(0x1da),_0xbb309b(0x203),'bnb',_0xbb309b(0x220),_0xbb309b(0x1bc),'xlm',_0xbb309b(0x1bd),'dot',_0xbb309b(0x210),_0xbb309b(0x214),_0xbb309b(0x200),_0xbb309b(0x223),_0xbb309b(0x1ea),_0xbb309b(0x20f),_0xbb309b(0x205),_0xbb309b(0x1e7),_0xbb309b(0x1c2),'cad',_0xbb309b(0x1c1),'clp',_0xbb309b(0x20e),'czk',_0xbb309b(0x1af),_0xbb309b(0x1e8),'gbp','gel',_0xbb309b(0x1dc),_0xbb309b(0x1b5),_0xbb309b(0x215),_0xbb309b(0x1c3),_0xbb309b(0x1c8),_0xbb309b(0x1f1),_0xbb309b(0x21f),_0xbb309b(0x1f3),'lkr',_0xbb309b(0x1df),_0xbb309b(0x1d5),_0xbb309b(0x1fb),_0xbb309b(0x1f9),_0xbb309b(0x1d9),'nzd',_0xbb309b(0x212),_0xbb309b(0x1de),_0xbb309b(0x227),_0xbb309b(0x1b1),_0xbb309b(0x1ef),_0xbb309b(0x1ca),_0xbb309b(0x1dd),_0xbb309b(0x1fd),_0xbb309b(0x219),'twd',_0xbb309b(0x1d4),_0xbb309b(0x1c4),'vnd',_0xbb309b(0x208),_0xbb309b(0x1bb),_0xbb309b(0x1b2),_0xbb309b(0x1e4),_0xbb309b(0x226),_0xbb309b(0x1d2)],this[_0xbb309b(0x1b6)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0xbb309b(0x1c5)]();}[a36_0x45837a(0x1c5)](){const _0x332d1b=a36_0x45837a;this[_0x332d1b(0x1f2)]()['catch'](_0x2ae900=>{const _0x1233b7=_0x332d1b;console[_0x1233b7(0x1ee)](_0x1233b7(0x216),_0x2ae900);}),this[_0x332d1b(0x1b6)]=setInterval(async()=>{const _0x30a2ae=_0x332d1b;try{await this['updateCurrencyRates']();}catch(_0x421961){console['error'](_0x30a2ae(0x202),_0x421961);}},0x3c*0x3c*0x3e8),console[_0x332d1b(0x20a)](_0x332d1b(0x1e5));}['stopPeriodicUpdates'](){const _0x353a6b=a36_0x45837a;this[_0x353a6b(0x1b6)]&&(clearInterval(this[_0x353a6b(0x1b6)]),this[_0x353a6b(0x1b6)]=null,console['log'](_0x353a6b(0x1ac)));}async[a36_0x45837a(0x1f2)](){const _0x588e25=a36_0x45837a;try{console[_0x588e25(0x20a)](_0x588e25(0x228));const _0x4d72dc=this[_0x588e25(0x1b3)][_0x588e25(0x1c9)](','),_0x350e36=this[_0x588e25(0x1e2)]+_0x588e25(0x1e9)+_0x4d72dc,_0x2025c4=await fetch(_0x350e36,{'headers':{'Accept':_0x588e25(0x20d),'User-Agent':_0x588e25(0x221)}});if(!_0x2025c4['ok'])throw new Error(_0x588e25(0x1b9)+_0x2025c4[_0x588e25(0x1bf)]+'\x20'+_0x2025c4['statusText']);const _0x3eaf71=await _0x2025c4['json']();if(!_0x3eaf71[_0x588e25(0x1e6)])throw new Error(_0x588e25(0x1c7));const _0xf3586e=_0x3eaf71[_0x588e25(0x1e6)];console[_0x588e25(0x20a)]('üìä\x20Received\x20rates\x20for\x20'+Object['keys'](_0xf3586e)[_0x588e25(0x204)]+_0x588e25(0x1cb));const _0x92afae=Object['entries'](_0xf3586e)[_0x588e25(0x1ba)](async([_0x400b23,_0x561acd])=>{const _0x13f89c=_0x588e25;try{await database_1[_0x13f89c(0x206)][_0x13f89c(0x213)][_0x13f89c(0x209)]({'where':{'currency':_0x400b23['toLowerCase']()},'update':{'rate':_0x561acd},'create':{'currency':_0x400b23[_0x13f89c(0x21c)](),'rate':_0x561acd}});}catch(_0x210b8c){console[_0x13f89c(0x1ee)](_0x13f89c(0x1e0)+_0x400b23+':',_0x210b8c);}});await Promise[_0x588e25(0x222)](_0x92afae),console['log'](_0x588e25(0x20c));}catch(_0x5d3389){console[_0x588e25(0x1ee)](_0x588e25(0x207),_0x5d3389);throw _0x5d3389;}}async[a36_0x45837a(0x1f0)](_0x2133a5){const _0x3ea931=a36_0x45837a,_0x372caf=_0x2133a5[_0x3ea931(0x21c)]();if(_0x372caf==='usdt')return 0x1;try{const _0x5e3cdb=await database_1[_0x3ea931(0x206)][_0x3ea931(0x213)][_0x3ea931(0x1c6)]({'where':{'currency':_0x372caf}});if(!_0x5e3cdb)return console['warn'](_0x3ea931(0x1ff)+_0x2133a5+_0x3ea931(0x224)),0x1;return _0x5e3cdb['rate'];}catch(_0xbe2f2e){return console[_0x3ea931(0x1ee)](_0x3ea931(0x1f4)+_0x2133a5+':',_0xbe2f2e),0x1;}}async[a36_0x45837a(0x1ec)](_0x126b09,_0x379706){const _0x4306f6=a36_0x45837a,_0x18ac79=_0x379706[_0x4306f6(0x21c)]();if(_0x18ac79==='usdt'){const _0x231b6d=_0x126b09*(0x1+this[_0x4306f6(0x1d0)]/0x64);return console[_0x4306f6(0x20a)](_0x4306f6(0x1b0)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x126b09+_0x4306f6(0x1f8)+_0x231b6d[_0x4306f6(0x1eb)](0x6)+'\x20USDT'),_0x231b6d;}try{const _0x4c8ba3=await this[_0x4306f6(0x1f0)](_0x18ac79),_0xd69b5b=_0x126b09/_0x4c8ba3,_0x5c4c3f=_0xd69b5b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4306f6(0x20a)](_0x4306f6(0x1d7)+_0x126b09+'\x20'+_0x379706[_0x4306f6(0x21d)]()+_0x4306f6(0x225)+_0xd69b5b[_0x4306f6(0x1eb)](0x6)+'\x20USDT,\x20with\x20'+this[_0x4306f6(0x1d0)]+_0x4306f6(0x1b8)+_0x5c4c3f[_0x4306f6(0x1eb)](0x6)+_0x4306f6(0x1cd)+_0x4c8ba3+')'),_0x5c4c3f;}catch(_0x5cc4a5){console[_0x4306f6(0x1ee)](_0x4306f6(0x1fe)+_0x126b09+'\x20'+_0x379706+_0x4306f6(0x1f5),_0x5cc4a5);const _0x592f98=_0x126b09*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x592f98;}}async[a36_0x45837a(0x21e)](_0x3f7293){const _0x53f9aa=a36_0x45837a;let _0x5255bd=0x0;for(const {amount:_0x32735e,currency:_0x590b32}of _0x3f7293){const _0x28b8b2=await this[_0x53f9aa(0x1ec)](_0x32735e,_0x590b32);_0x5255bd+=_0x28b8b2;}return _0x5255bd;}async[a36_0x45837a(0x1f6)](){const _0x186b05=a36_0x45837a;try{const _0x2aff78=await database_1[_0x186b05(0x206)][_0x186b05(0x213)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x45fd0b={'usdt':0x1};return _0x2aff78[_0x186b05(0x211)](_0x2f90fa=>{const _0x545e1f=_0x186b05;_0x45fd0b[_0x2f90fa[_0x545e1f(0x1e1)]]=_0x2f90fa['rate'];}),_0x45fd0b;}catch(_0x86e666){return console[_0x186b05(0x1ee)](_0x186b05(0x1d1),_0x86e666),{'usdt':0x1};}}async[a36_0x45837a(0x1cf)](){const _0x4205d1=a36_0x45837a;try{const [_0x59cf95,_0x5e8906,_0x2ee26e]=await Promise[_0x4205d1(0x217)]([database_1[_0x4205d1(0x206)]['currencyRate'][_0x4205d1(0x1cc)](),database_1['default'][_0x4205d1(0x213)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x4205d1(0x213)][_0x4205d1(0x1ae)]({'orderBy':{'updatedAt':_0x4205d1(0x1ad)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x59cf95,'lastUpdated':_0x5e8906?.['updatedAt']||null,'oldestRate':_0x2ee26e?.['updatedAt']||null,'markupPercentage':this[_0x4205d1(0x1d0)]};}catch(_0x185e80){return console[_0x4205d1(0x1ee)](_0x4205d1(0x1fc),_0x185e80),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4205d1(0x1d0)]};}}['getMarkupPercentage'](){const _0x5588f8=a36_0x45837a;return this[_0x5588f8(0x1d0)];}}function a36_0x26d3(){const _0x2bfa18=['tether','bmd','eur','?ids=tether&vs_currencies=','aud','toFixed','convertToUSDT','https://api.coingecko.com/api/v3/simple/price','error','sar','getCurrencyRate','jpy','updateCurrencyRates','kwd','Error\x20getting\x20rate\x20for\x20currency\x20','\x20to\x20USDT:','getAllRates','2gBkGVc','\x20USDT\x20=\x20','ngn','__importDefault','myr','Error\x20getting\x20rates\x20status:','thb','Error\x20converting\x20','No\x20rate\x20found\x20for\x20currency:\x20','aed','eth','Periodic\x20currency\x20rates\x20update\x20failed:','bch','length','bhd','default','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','zar','upsert','log','150144ZMpSFQ','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','application/json','cny','bdt','yfi','forEach','php','currencyRate','usd','idr','Initial\x20currency\x20rates\x20update\x20failed:','all','defineProperty','try','3731990fYKKTJ','currencyService','toLowerCase','toUpperCase','convertMultipleToUSDT','krw','eos','TesSoft\x20Payment\x20System/1.0','allSettled','ars',',\x20using\x201\x20as\x20fallback','\x20to\x20','bits','pln','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','asc','findFirst','dkk','üí±\x20Applied\x20','rub','xag','CURRENCIES','__esModule','huf','updateInterval','816908EnhDsY','%\x20markup\x20=\x20','CoinGecko\x20API\x20error:\x20','map','xdr','xrp','link','CurrencyService','status','1659135znRYdi','chf','brl','ils','vef','startPeriodicUpdates','findUnique','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','inr','join','sek','\x20currencies','count','\x20USDT\x20(rate:\x20','18pvmGvG','getRatesStatus','MARKUP_PERCENTAGE','Error\x20getting\x20all\x20rates:','sats','196606OFMpDJ','uah','mxn','1941774uJzYkO','üí±\x20Converted\x20','84FswgfA','nok','ltc','962139PgnuSA','hkd','sgd','pkr','mmk','Failed\x20to\x20update\x20rate\x20for\x20','currency','COINGECKO_URL','../config/database','xau','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates'];a36_0x26d3=function(){return _0x2bfa18;};return a36_0x26d3();}exports[a36_0x45837a(0x1be)]=CurrencyService,exports[a36_0x45837a(0x21b)]=new CurrencyService();