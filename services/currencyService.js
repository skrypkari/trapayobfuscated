'use strict';function a41_0x206f(_0x5cd0c7,_0x2ce053){const _0x14a320=a41_0x14a3();return a41_0x206f=function(_0x206f64,_0x444692){_0x206f64=_0x206f64-0x8c;let _0x9e8a5c=_0x14a320[_0x206f64];return _0x9e8a5c;},a41_0x206f(_0x5cd0c7,_0x2ce053);}const a41_0x202e46=a41_0x206f;function a41_0x14a3(){const _0x133a4b=['🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','forEach','currency','ils','\x20to\x20','myr','rate','\x20USDT\x20=\x20','COINGECKO_URL','Failed\x20to\x20update\x20rate\x20for\x20','krw','9xPrcQH','mxn','idr','getCurrencyRate','dot','try','currencyService','https://api.coingecko.com/api/v3/simple/price','length','1669602trfnOV','%\x20markup\x20=\x20',',\x20using\x201\x20as\x20fallback','💱\x20Converted\x20','log','aud','tether','Error\x20getting\x20all\x20rates:','findMany','1277867FJyfNI','CURRENCIES','\x20to\x20USDT:','92DQrBHJ','sats','brl','dkk','12449216jsXkJa','uah','json','updatedAt','toUpperCase','nok','No\x20rate\x20found\x20for\x20currency:\x20','139563OqbOww','lkr','clp','../config/database','gbp','💱\x20Applied\x20','startPeriodicUpdates','xau','czk','\x20USDT\x20(rate:\x20','nzd','bdt','Initial\x20currency\x20rates\x20update\x20failed:','7QYfrEq','btc','twd','?ids=tether&vs_currencies=','MARKUP_PERCENTAGE','kwd','getRatesStatus','❌\x20Failed\x20to\x20update\x20currency\x20rates:','pln','eos','sar','__esModule','Periodic\x20currency\x20rates\x20update\x20failed:','currencyRate','bits','statusText','allSettled','thb','toFixed','application/json','convertToUSDT','ars','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','gel','CoinGecko\x20API\x20error:\x20','chf','xlm','310438ISBSpj','vnd','desc','findUnique','updateInterval','usdt','\x20currencies','mmk','catch','✅\x20Currency\x20rates\x20updated\x20successfully','rub','all','bnb','count','CurrencyService','7105385IviINL','36350700HCKgaw','sek','hkd','yfi','jpy','upsert','status','default','stopPeriodicUpdates','toLowerCase','Error\x20getting\x20rate\x20for\x20currency\x20','updateCurrencyRates','error','map','getAllRates','📊\x20Received\x20rates\x20for\x20','bmd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20USDT','cad','__importDefault','usd'];a41_0x14a3=function(){return _0x133a4b;};return a41_0x14a3();}(function(_0x3b19a8,_0x5d64ee){const _0x19a6d1=a41_0x206f,_0x3bdfbf=_0x3b19a8();while(!![]){try{const _0x4c1588=parseInt(_0x19a6d1(0xfc))/0x1+-parseInt(_0x19a6d1(0xb8))/0x2+parseInt(_0x19a6d1(0x90))/0x3*(-parseInt(_0x19a6d1(0xff))/0x4)+-parseInt(_0x19a6d1(0xc7))/0x5+-parseInt(_0x19a6d1(0xf3))/0x6*(-parseInt(_0x19a6d1(0x9d))/0x7)+-parseInt(_0x19a6d1(0x103))/0x8+-parseInt(_0x19a6d1(0xea))/0x9*(-parseInt(_0x19a6d1(0xc8))/0xa);if(_0x4c1588===_0x5d64ee)break;else _0x3bdfbf['push'](_0x3bdfbf['shift']());}catch(_0x50ff85){_0x3bdfbf['push'](_0x3bdfbf['shift']());}}}(a41_0x14a3,0xf1665));var __importDefault=this&&this[a41_0x202e46(0xdd)]||function(_0x1f6ca5){const _0x880565=a41_0x202e46;return _0x1f6ca5&&_0x1f6ca5[_0x880565(0xa8)]?_0x1f6ca5:{'default':_0x1f6ca5};};Object['defineProperty'](exports,a41_0x202e46(0xa8),{'value':!![]}),exports[a41_0x202e46(0xf0)]=exports[a41_0x202e46(0xc6)]=void 0x0;const database_1=__importDefault(require(a41_0x202e46(0x93)));class CurrencyService{constructor(){const _0x445200=a41_0x202e46;this[_0x445200(0xe7)]=_0x445200(0xf1),this[_0x445200(0xfd)]=[_0x445200(0x9e),'eth','ltc','bch',_0x445200(0xc4),_0x445200(0xa6),'xrp',_0x445200(0xb7),'link',_0x445200(0xee),_0x445200(0xcb),_0x445200(0xde),'aed',_0x445200(0xb2),_0x445200(0xf8),_0x445200(0x9b),'bhd',_0x445200(0xd8),_0x445200(0x101),_0x445200(0xdc),_0x445200(0xb6),_0x445200(0x92),'cny',_0x445200(0x98),_0x445200(0x102),'eur',_0x445200(0x94),_0x445200(0xb4),_0x445200(0xca),'huf',_0x445200(0xec),_0x445200(0xe2),'inr',_0x445200(0xcc),_0x445200(0xe9),_0x445200(0xa2),_0x445200(0x91),_0x445200(0xbf),_0x445200(0xeb),_0x445200(0xe4),'ngn',_0x445200(0x8e),_0x445200(0x9a),'php','pkr',_0x445200(0xa5),_0x445200(0xc2),_0x445200(0xa7),_0x445200(0xc9),'sgd',_0x445200(0xae),_0x445200(0xef),_0x445200(0x9f),_0x445200(0x104),'vef',_0x445200(0xb9),'zar','xdr','xag',_0x445200(0x97),_0x445200(0xab),_0x445200(0x100)],this[_0x445200(0xbc)]=null,this[_0x445200(0xa1)]=-0x3,this['startPeriodicUpdates']();}[a41_0x202e46(0x96)](){const _0x1e2284=a41_0x202e46;this[_0x1e2284(0xd3)]()[_0x1e2284(0xc0)](_0x2742ee=>{const _0x5f5641=_0x1e2284;console['error'](_0x5f5641(0x9c),_0x2742ee);}),this[_0x1e2284(0xbc)]=setInterval(async()=>{const _0x265472=_0x1e2284;try{await this['updateCurrencyRates']();}catch(_0x32578a){console[_0x265472(0xd4)](_0x265472(0xa9),_0x32578a);}},0x3c*0x3c*0x3e8),console[_0x1e2284(0xf7)](_0x1e2284(0xda));}[a41_0x202e46(0xd0)](){const _0x418e64=a41_0x202e46;this[_0x418e64(0xbc)]&&(clearInterval(this['updateInterval']),this[_0x418e64(0xbc)]=null,console[_0x418e64(0xf7)](_0x418e64(0xb3)));}async['updateCurrencyRates'](){const _0x1b4f7a=a41_0x202e46;try{console[_0x1b4f7a(0xf7)](_0x1b4f7a(0xdf));const _0x155c48=this[_0x1b4f7a(0xfd)]['join'](','),_0x2c9f13=this[_0x1b4f7a(0xe7)]+_0x1b4f7a(0xa0)+_0x155c48,_0x382487=await fetch(_0x2c9f13,{'headers':{'Accept':_0x1b4f7a(0xb0),'User-Agent':'Payment\x20System/1.0'}});if(!_0x382487['ok'])throw new Error(_0x1b4f7a(0xb5)+_0x382487[_0x1b4f7a(0xce)]+'\x20'+_0x382487[_0x1b4f7a(0xac)]);const _0xd87e3=await _0x382487[_0x1b4f7a(0x105)]();if(!_0xd87e3[_0x1b4f7a(0xf9)])throw new Error(_0x1b4f7a(0xd9));const _0x6047d9=_0xd87e3[_0x1b4f7a(0xf9)];console[_0x1b4f7a(0xf7)](_0x1b4f7a(0xd7)+Object['keys'](_0x6047d9)[_0x1b4f7a(0xf2)]+_0x1b4f7a(0xbe));const _0x33e48a=Object['entries'](_0x6047d9)[_0x1b4f7a(0xd5)](async([_0x14f402,_0x23089e])=>{const _0x3da5ea=_0x1b4f7a;try{await database_1[_0x3da5ea(0xcf)][_0x3da5ea(0xaa)][_0x3da5ea(0xcd)]({'where':{'currency':_0x14f402[_0x3da5ea(0xd1)]()},'update':{'rate':_0x23089e},'create':{'currency':_0x14f402[_0x3da5ea(0xd1)](),'rate':_0x23089e}});}catch(_0x57feb1){console[_0x3da5ea(0xd4)](_0x3da5ea(0xe8)+_0x14f402+':',_0x57feb1);}});await Promise[_0x1b4f7a(0xad)](_0x33e48a),console[_0x1b4f7a(0xf7)](_0x1b4f7a(0xc1));}catch(_0x16cfb5){console[_0x1b4f7a(0xd4)](_0x1b4f7a(0xa4),_0x16cfb5);throw _0x16cfb5;}}async['getCurrencyRate'](_0x885010){const _0x107d38=a41_0x202e46,_0x405336=_0x885010[_0x107d38(0xd1)]();if(_0x405336==='usdt')return 0x1;try{const _0x4c0476=await database_1['default'][_0x107d38(0xaa)][_0x107d38(0xbb)]({'where':{'currency':_0x405336}});if(!_0x4c0476)return console['warn'](_0x107d38(0x8f)+_0x885010+_0x107d38(0xf5)),0x1;return _0x4c0476[_0x107d38(0xe5)];}catch(_0xf8c604){return console[_0x107d38(0xd4)](_0x107d38(0xd2)+_0x885010+':',_0xf8c604),0x1;}}async[a41_0x202e46(0xb1)](_0x575c33,_0x39e772){const _0x61e625=a41_0x202e46,_0x416edb=_0x39e772[_0x61e625(0xd1)]();if(_0x416edb===_0x61e625(0xbd)){const _0xb3d3dd=_0x575c33*(0x1+this[_0x61e625(0xa1)]/0x64);return console[_0x61e625(0xf7)](_0x61e625(0x95)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x575c33+_0x61e625(0xe6)+_0xb3d3dd[_0x61e625(0xaf)](0x6)+_0x61e625(0xdb)),_0xb3d3dd;}try{const _0x6dccd=await this[_0x61e625(0xed)](_0x416edb),_0x33c3f2=_0x575c33/_0x6dccd,_0x36055b=_0x33c3f2*(0x1+this[_0x61e625(0xa1)]/0x64);return console[_0x61e625(0xf7)](_0x61e625(0xf6)+_0x575c33+'\x20'+_0x39e772[_0x61e625(0x8d)]()+_0x61e625(0xe3)+_0x33c3f2[_0x61e625(0xaf)](0x6)+'\x20USDT,\x20with\x20'+this[_0x61e625(0xa1)]+_0x61e625(0xf4)+_0x36055b['toFixed'](0x6)+_0x61e625(0x99)+_0x6dccd+')'),_0x36055b;}catch(_0x46eb82){console[_0x61e625(0xd4)]('Error\x20converting\x20'+_0x575c33+'\x20'+_0x39e772+_0x61e625(0xfe),_0x46eb82);const _0x608b65=_0x575c33*(0x1+this[_0x61e625(0xa1)]/0x64);return _0x608b65;}}async['convertMultipleToUSDT'](_0x1886e8){const _0x4b00e5=a41_0x202e46;let _0xd707f0=0x0;for(const {amount:_0x34dcab,currency:_0x2edaca}of _0x1886e8){const _0x7af342=await this[_0x4b00e5(0xb1)](_0x34dcab,_0x2edaca);_0xd707f0+=_0x7af342;}return _0xd707f0;}async[a41_0x202e46(0xd6)](){const _0x29cdfc=a41_0x202e46;try{const _0x208345=await database_1['default']['currencyRate'][_0x29cdfc(0xfb)]({'select':{'currency':!![],'rate':!![]}}),_0x1b0d07={'usdt':0x1};return _0x208345[_0x29cdfc(0xe0)](_0xe96eea=>{const _0x1224ee=_0x29cdfc;_0x1b0d07[_0xe96eea[_0x1224ee(0xe1)]]=_0xe96eea[_0x1224ee(0xe5)];}),_0x1b0d07;}catch(_0x4c01b9){return console[_0x29cdfc(0xd4)](_0x29cdfc(0xfa),_0x4c01b9),{'usdt':0x1};}}async[a41_0x202e46(0xa3)](){const _0x3a87f4=a41_0x202e46;try{const [_0x436ec7,_0x416c17,_0x570e94]=await Promise[_0x3a87f4(0xc3)]([database_1['default'][_0x3a87f4(0xaa)][_0x3a87f4(0xc5)](),database_1['default'][_0x3a87f4(0xaa)]['findFirst']({'orderBy':{'updatedAt':_0x3a87f4(0xba)},'select':{'updatedAt':!![]}}),database_1['default'][_0x3a87f4(0xaa)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x436ec7,'lastUpdated':_0x416c17?.[_0x3a87f4(0x8c)]||null,'oldestRate':_0x570e94?.['updatedAt']||null,'markupPercentage':this[_0x3a87f4(0xa1)]};}catch(_0x5805d2){return console[_0x3a87f4(0xd4)]('Error\x20getting\x20rates\x20status:',_0x5805d2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3a87f4(0xa1)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports[a41_0x202e46(0xc6)]=CurrencyService,exports[a41_0x202e46(0xf0)]=new CurrencyService();