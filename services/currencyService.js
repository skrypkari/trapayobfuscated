'use strict';const a41_0x1729a6=a41_0x1150;(function(_0xfabe98,_0x5d439d){const _0x45d6b3=a41_0x1150,_0x48f0d5=_0xfabe98();while(!![]){try{const _0x4edf3f=-parseInt(_0x45d6b3(0x1ca))/0x1*(parseInt(_0x45d6b3(0x1ee))/0x2)+-parseInt(_0x45d6b3(0x1bf))/0x3+-parseInt(_0x45d6b3(0x1ea))/0x4*(-parseInt(_0x45d6b3(0x239))/0x5)+-parseInt(_0x45d6b3(0x1d7))/0x6*(parseInt(_0x45d6b3(0x1d0))/0x7)+parseInt(_0x45d6b3(0x208))/0x8+-parseInt(_0x45d6b3(0x1c3))/0x9*(parseInt(_0x45d6b3(0x1e1))/0xa)+parseInt(_0x45d6b3(0x1e6))/0xb;if(_0x4edf3f===_0x5d439d)break;else _0x48f0d5['push'](_0x48f0d5['shift']());}catch(_0x51c6f7){_0x48f0d5['push'](_0x48f0d5['shift']());}}}(a41_0x2be9,0x8d329));var __importDefault=this&&this[a41_0x1729a6(0x23d)]||function(_0x2e185b){const _0x5a0817=a41_0x1729a6;return _0x2e185b&&_0x2e185b[_0x5a0817(0x201)]?_0x2e185b:{'default':_0x2e185b};};Object[a41_0x1729a6(0x22f)](exports,a41_0x1729a6(0x201),{'value':!![]}),exports[a41_0x1729a6(0x231)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a41_0x1729a6(0x213)));function a41_0x2be9(){const _0x40db9a=['CURRENCIES','\x20to\x20USDT:','twd','bch','xag','tether','../config/database','rate','Error\x20getting\x20rate\x20for\x20currency\x20','map','ltc','eos','status','cny','uah','getAllRates','toLowerCase','toUpperCase','count','Error\x20getting\x20all\x20rates:','✅\x20Currency\x20rates\x20updated\x20successfully','nok','zar','\x20USDT','xdr','pln','aed','Initial\x20currency\x20rates\x20update\x20failed:','aud','try','json','TesSoft\x20Payment\x20System/1.0','getCurrencyRate','join','defineProperty','php','currencyService','startPeriodicUpdates','findFirst','%\x20markup\x20=\x20','convertMultipleToUSDT','kwd','ngn','krw','15pqfjze','MARKUP_PERCENTAGE','https://api.coingecko.com/api/v3/simple/price','?ids=tether&vs_currencies=','__importDefault','💱\x20Applied\x20','getRatesStatus','551430ffbKXX','Error\x20getting\x20rates\x20status:','bits','brl','18TOaGgy','keys','Error\x20converting\x20','sar','bnb','error','thb','7bVvVkf','chf','CoinGecko\x20API\x20error:\x20','toFixed','forEach','usd','317527IrodEU','updateInterval','vef','sats','upsert','vnd','%\x20markup\x20to\x20','72PRuAKj','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','gbp','convertToUSDT','hkd','default','Failed\x20to\x20update\x20rate\x20for\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','dot','jpy','3561590eghOmy','Periodic\x20currency\x20rates\x20update\x20failed:','rub','mmk','currencyRate','20101840LZNHQG','asc','czk','💱\x20Converted\x20','433892BsdAAo','catch','pkr','xau','194664oFWkRN','currency','clp','all','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20USDT\x20(rate:\x20','updateCurrencyRates','desc','entries','gel','\x20currencies','eur','bhd','\x20USDT,\x20with\x20','usdt','sgd','findMany','findUnique','bdt','__esModule',',\x20using\x201\x20as\x20fallback','mxn','CurrencyService','bmd','nzd','log','4378160GaSbtk','length','sek','updatedAt','btc'];a41_0x2be9=function(){return _0x40db9a;};return a41_0x2be9();}function a41_0x1150(_0x1413ca,_0x2ce826){const _0x2be920=a41_0x2be9();return a41_0x1150=function(_0x11501c,_0x42e956){_0x11501c=_0x11501c-0x1be;let _0x504d51=_0x2be920[_0x11501c];return _0x504d51;},a41_0x1150(_0x1413ca,_0x2ce826);}class CurrencyService{constructor(){const _0x584b5a=a41_0x1729a6;this['COINGECKO_URL']=_0x584b5a(0x23b),this[_0x584b5a(0x20d)]=[_0x584b5a(0x20c),'eth',_0x584b5a(0x217),_0x584b5a(0x210),_0x584b5a(0x1c7),_0x584b5a(0x218),'xrp','xlm','link',_0x584b5a(0x1df),'yfi',_0x584b5a(0x1cf),_0x584b5a(0x227),'ars',_0x584b5a(0x229),_0x584b5a(0x200),_0x584b5a(0x1fa),_0x584b5a(0x205),_0x584b5a(0x1c2),'cad',_0x584b5a(0x1cb),_0x584b5a(0x1f0),_0x584b5a(0x21a),_0x584b5a(0x1e8),'dkk',_0x584b5a(0x1f9),_0x584b5a(0x1d9),_0x584b5a(0x1f7),_0x584b5a(0x1db),'huf','idr','ils','inr',_0x584b5a(0x1e0),_0x584b5a(0x238),_0x584b5a(0x236),'lkr',_0x584b5a(0x1e4),_0x584b5a(0x203),'myr',_0x584b5a(0x237),_0x584b5a(0x222),_0x584b5a(0x206),_0x584b5a(0x230),_0x584b5a(0x1ec),_0x584b5a(0x226),_0x584b5a(0x1e3),_0x584b5a(0x1c6),_0x584b5a(0x20a),_0x584b5a(0x1fd),_0x584b5a(0x1c9),_0x584b5a(0x22a),_0x584b5a(0x20f),_0x584b5a(0x21b),_0x584b5a(0x1d2),_0x584b5a(0x1d5),_0x584b5a(0x223),_0x584b5a(0x225),_0x584b5a(0x211),_0x584b5a(0x1ed),_0x584b5a(0x1c1),_0x584b5a(0x1d3)],this['updateInterval']=null,this[_0x584b5a(0x23a)]=-0x3,this[_0x584b5a(0x232)]();}[a41_0x1729a6(0x232)](){const _0x1f0159=a41_0x1729a6;this[_0x1f0159(0x1f4)]()[_0x1f0159(0x1eb)](_0x5572ca=>{const _0x3f195f=_0x1f0159;console[_0x3f195f(0x1c8)](_0x3f195f(0x228),_0x5572ca);}),this[_0x1f0159(0x1d1)]=setInterval(async()=>{const _0x8c80e0=_0x1f0159;try{await this['updateCurrencyRates']();}catch(_0x422973){console[_0x8c80e0(0x1c8)](_0x8c80e0(0x1e2),_0x422973);}},0x3c*0x3c*0x3e8),console[_0x1f0159(0x207)](_0x1f0159(0x1d8));}['stopPeriodicUpdates'](){const _0x509373=a41_0x1729a6;this[_0x509373(0x1d1)]&&(clearInterval(this['updateInterval']),this[_0x509373(0x1d1)]=null,console['log']('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a41_0x1729a6(0x1f4)](){const _0x5eebb=a41_0x1729a6;try{console[_0x5eebb(0x207)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x5153c2=this[_0x5eebb(0x20d)][_0x5eebb(0x22e)](','),_0x22fa8f=this['COINGECKO_URL']+_0x5eebb(0x23c)+_0x5153c2,_0xbb334=await fetch(_0x22fa8f,{'headers':{'Accept':'application/json','User-Agent':_0x5eebb(0x22c)}});if(!_0xbb334['ok'])throw new Error(_0x5eebb(0x1cc)+_0xbb334[_0x5eebb(0x219)]+'\x20'+_0xbb334['statusText']);const _0x56024c=await _0xbb334[_0x5eebb(0x22b)]();if(!_0x56024c[_0x5eebb(0x212)])throw new Error(_0x5eebb(0x1f2));const _0x30a708=_0x56024c[_0x5eebb(0x212)];console[_0x5eebb(0x207)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x5eebb(0x1c4)](_0x30a708)[_0x5eebb(0x209)]+_0x5eebb(0x1f8));const _0x2863fd=Object[_0x5eebb(0x1f6)](_0x30a708)[_0x5eebb(0x216)](async([_0xc07f09,_0x3f9208])=>{const _0x4e6049=_0x5eebb;try{await database_1['default']['currencyRate'][_0x4e6049(0x1d4)]({'where':{'currency':_0xc07f09[_0x4e6049(0x21d)]()},'update':{'rate':_0x3f9208},'create':{'currency':_0xc07f09[_0x4e6049(0x21d)](),'rate':_0x3f9208}});}catch(_0x5b19a6){console[_0x4e6049(0x1c8)](_0x4e6049(0x1dd)+_0xc07f09+':',_0x5b19a6);}});await Promise['allSettled'](_0x2863fd),console[_0x5eebb(0x207)](_0x5eebb(0x221));}catch(_0x3bc7a5){console[_0x5eebb(0x1c8)](_0x5eebb(0x1de),_0x3bc7a5);throw _0x3bc7a5;}}async[a41_0x1729a6(0x22d)](_0x4c13ca){const _0xbfd804=a41_0x1729a6,_0x5c775d=_0x4c13ca['toLowerCase']();if(_0x5c775d===_0xbfd804(0x1fc))return 0x1;try{const _0x1272ed=await database_1[_0xbfd804(0x1dc)]['currencyRate'][_0xbfd804(0x1ff)]({'where':{'currency':_0x5c775d}});if(!_0x1272ed)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x4c13ca+_0xbfd804(0x202)),0x1;return _0x1272ed['rate'];}catch(_0x2ba628){return console[_0xbfd804(0x1c8)](_0xbfd804(0x215)+_0x4c13ca+':',_0x2ba628),0x1;}}async[a41_0x1729a6(0x1da)](_0x201e4f,_0x71ea77){const _0x420e5f=a41_0x1729a6,_0x1e3d26=_0x71ea77[_0x420e5f(0x21d)]();if(_0x1e3d26===_0x420e5f(0x1fc)){const _0x5eca70=_0x201e4f*(0x1+this[_0x420e5f(0x23a)]/0x64);return console[_0x420e5f(0x207)](_0x420e5f(0x23e)+this['MARKUP_PERCENTAGE']+_0x420e5f(0x1d6)+_0x201e4f+'\x20USDT\x20=\x20'+_0x5eca70['toFixed'](0x6)+_0x420e5f(0x224)),_0x5eca70;}try{const _0x4e87d8=await this['getCurrencyRate'](_0x1e3d26),_0x447a5c=_0x201e4f/_0x4e87d8,_0x55e7ff=_0x447a5c*(0x1+this[_0x420e5f(0x23a)]/0x64);return console[_0x420e5f(0x207)](_0x420e5f(0x1e9)+_0x201e4f+'\x20'+_0x71ea77[_0x420e5f(0x21e)]()+'\x20to\x20'+_0x447a5c['toFixed'](0x6)+_0x420e5f(0x1fb)+this['MARKUP_PERCENTAGE']+_0x420e5f(0x234)+_0x55e7ff[_0x420e5f(0x1cd)](0x6)+_0x420e5f(0x1f3)+_0x4e87d8+')'),_0x55e7ff;}catch(_0x53b241){console[_0x420e5f(0x1c8)](_0x420e5f(0x1c5)+_0x201e4f+'\x20'+_0x71ea77+_0x420e5f(0x20e),_0x53b241);const _0x360b8a=_0x201e4f*(0x1+this[_0x420e5f(0x23a)]/0x64);return _0x360b8a;}}async[a41_0x1729a6(0x235)](_0x55ac44){const _0x10a5a3=a41_0x1729a6;let _0x529bd4=0x0;for(const {amount:_0x585e72,currency:_0x57dfb2}of _0x55ac44){const _0x50f405=await this[_0x10a5a3(0x1da)](_0x585e72,_0x57dfb2);_0x529bd4+=_0x50f405;}return _0x529bd4;}async[a41_0x1729a6(0x21c)](){const _0x3d8b65=a41_0x1729a6;try{const _0x17e5b2=await database_1[_0x3d8b65(0x1dc)][_0x3d8b65(0x1e5)][_0x3d8b65(0x1fe)]({'select':{'currency':!![],'rate':!![]}}),_0x55b874={'usdt':0x1};return _0x17e5b2[_0x3d8b65(0x1ce)](_0x2d2325=>{const _0x2b3916=_0x3d8b65;_0x55b874[_0x2d2325[_0x2b3916(0x1ef)]]=_0x2d2325[_0x2b3916(0x214)];}),_0x55b874;}catch(_0x31896c){return console[_0x3d8b65(0x1c8)](_0x3d8b65(0x220),_0x31896c),{'usdt':0x1};}}async[a41_0x1729a6(0x1be)](){const _0x3b4642=a41_0x1729a6;try{const [_0x304144,_0x1d80e0,_0xb97802]=await Promise[_0x3b4642(0x1f1)]([database_1['default'][_0x3b4642(0x1e5)][_0x3b4642(0x21f)](),database_1['default'][_0x3b4642(0x1e5)][_0x3b4642(0x233)]({'orderBy':{'updatedAt':_0x3b4642(0x1f5)},'select':{'updatedAt':!![]}}),database_1[_0x3b4642(0x1dc)][_0x3b4642(0x1e5)][_0x3b4642(0x233)]({'orderBy':{'updatedAt':_0x3b4642(0x1e7)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x304144,'lastUpdated':_0x1d80e0?.['updatedAt']||null,'oldestRate':_0xb97802?.[_0x3b4642(0x20b)]||null,'markupPercentage':this[_0x3b4642(0x23a)]};}catch(_0x292e3a){return console[_0x3b4642(0x1c8)](_0x3b4642(0x1c0),_0x292e3a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3b4642(0x23a)]};}}['getMarkupPercentage'](){const _0x3628eb=a41_0x1729a6;return this[_0x3628eb(0x23a)];}}exports[a41_0x1729a6(0x204)]=CurrencyService,exports[a41_0x1729a6(0x231)]=new CurrencyService();