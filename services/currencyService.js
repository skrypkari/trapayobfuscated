'use strict';const a43_0x1399ee=a43_0x4cc3;(function(_0x4b575e,_0x1075e6){const _0x4e6e0c=a43_0x4cc3,_0x1e710c=_0x4b575e();while(!![]){try{const _0x37a78f=parseInt(_0x4e6e0c(0x19d))/0x1+-parseInt(_0x4e6e0c(0x1a6))/0x2+parseInt(_0x4e6e0c(0x182))/0x3*(parseInt(_0x4e6e0c(0x152))/0x4)+parseInt(_0x4e6e0c(0x1a7))/0x5*(-parseInt(_0x4e6e0c(0x1a8))/0x6)+-parseInt(_0x4e6e0c(0x1b2))/0x7+-parseInt(_0x4e6e0c(0x174))/0x8*(parseInt(_0x4e6e0c(0x1b7))/0x9)+parseInt(_0x4e6e0c(0x139))/0xa*(parseInt(_0x4e6e0c(0x186))/0xb);if(_0x37a78f===_0x1075e6)break;else _0x1e710c['push'](_0x1e710c['shift']());}catch(_0x2dbb0b){_0x1e710c['push'](_0x1e710c['shift']());}}}(a43_0x37ed,0x9ff28));var __importDefault=this&&this[a43_0x1399ee(0x15e)]||function(_0x4214a6){return _0x4214a6&&_0x4214a6['__esModule']?_0x4214a6:{'default':_0x4214a6};};function a43_0x4cc3(_0x3bddf1,_0x278aec){const _0x37ed51=a43_0x37ed();return a43_0x4cc3=function(_0x4cc334,_0x49d50e){_0x4cc334=_0x4cc334-0x138;let _0x367bd3=_0x37ed51[_0x4cc334];return _0x367bd3;},a43_0x4cc3(_0x3bddf1,_0x278aec);}Object['defineProperty'](exports,a43_0x1399ee(0x19b),{'value':!![]}),exports['currencyService']=exports[a43_0x1399ee(0x19c)]=void 0x0;function a43_0x37ed(){const _0x577df1=['CoinGecko\x20API\x20error:\x20','keys','getCurrencyRate','kwd','xau','dkk','all','toLowerCase','aed','desc','rub','nok','php','\x20to\x20','Error\x20converting\x20','nzd','COINGECKO_URL','czk','findMany','4aRMmas','%\x20markup\x20=\x20','💱\x20Converted\x20','dot','uah','\x20USDT','application/json','brl','usdt','ils','xrp','tether','__importDefault','💱\x20Applied\x20','ngn','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ars','\x20currencies','CURRENCIES','zar','cny','Error\x20getting\x20all\x20rates:','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','yfi','cad','idr','Error\x20getting\x20rates\x20status:','toFixed','findFirst','currencyService','\x20to\x20USDT:','updateCurrencyRates','Error\x20getting\x20rate\x20for\x20currency\x20','count','3816744UklNuM','default','✅\x20Currency\x20rates\x20updated\x20successfully','sgd','vnd','?ids=tether&vs_currencies=','usd','xdr','findUnique','convertToUSDT','chf','Initial\x20currency\x20rates\x20update\x20failed:','currencyRate','%\x20markup\x20to\x20','1215663leNUlH','gbp','bits','bdt','209COOSOA','Payment\x20System/1.0','toUpperCase','huf','bnb','inr','asc','startPeriodicUpdates','No\x20rate\x20found\x20for\x20currency:\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','log','aud','error','xlm','https://api.coingecko.com/api/v3/simple/price','MARKUP_PERCENTAGE','❌\x20Failed\x20to\x20update\x20currency\x20rates:','sats','btc','krw','join','__esModule','CurrencyService','987589EhWIdc','../config/database','entries','getMarkupPercentage','sar','bmd','lkr','updatedAt','try','45322FWYYbf','545xcraul','22164jwEkXk','length','📊\x20Received\x20rates\x20for\x20','hkd','stopPeriodicUpdates','jpy','map','pln','Periodic\x20currency\x20rates\x20update\x20failed:','currency','6003459eUMgSg','status','xag','thb','\x20USDT,\x20with\x20','9NIoQzh','forEach','updateInterval','538090OcpNXe','\x20USDT\x20(rate:\x20','upsert','Failed\x20to\x20update\x20rate\x20for\x20','mxn','ltc'];a43_0x37ed=function(){return _0x577df1;};return a43_0x37ed();}const database_1=__importDefault(require(a43_0x1399ee(0x19e)));class CurrencyService{constructor(){const _0x216de5=a43_0x1399ee;this[_0x216de5(0x14f)]=_0x216de5(0x194),this['CURRENCIES']=[_0x216de5(0x198),'eth',_0x216de5(0x13e),'bch',_0x216de5(0x18a),'eos',_0x216de5(0x15c),_0x216de5(0x193),'link',_0x216de5(0x155),_0x216de5(0x169),_0x216de5(0x17a),_0x216de5(0x147),_0x216de5(0x162),_0x216de5(0x191),_0x216de5(0x185),'bhd',_0x216de5(0x1a2),_0x216de5(0x159),_0x216de5(0x16a),_0x216de5(0x17e),'clp',_0x216de5(0x166),_0x216de5(0x150),_0x216de5(0x144),'eur',_0x216de5(0x183),'gel',_0x216de5(0x1ab),_0x216de5(0x189),_0x216de5(0x16b),_0x216de5(0x15b),_0x216de5(0x18b),_0x216de5(0x1ad),_0x216de5(0x199),_0x216de5(0x142),_0x216de5(0x1a3),'mmk',_0x216de5(0x13d),'myr',_0x216de5(0x160),_0x216de5(0x14a),_0x216de5(0x14e),_0x216de5(0x14b),'pkr',_0x216de5(0x1af),_0x216de5(0x149),_0x216de5(0x1a1),'sek',_0x216de5(0x177),_0x216de5(0x1b5),_0x216de5(0x1a5),'twd',_0x216de5(0x156),'vef',_0x216de5(0x178),_0x216de5(0x165),_0x216de5(0x17b),_0x216de5(0x1b4),_0x216de5(0x143),_0x216de5(0x184),_0x216de5(0x197)],this['updateInterval']=null,this[_0x216de5(0x195)]=-0x3,this['startPeriodicUpdates']();}[a43_0x1399ee(0x18d)](){const _0x51727a=a43_0x1399ee;this[_0x51727a(0x171)]()['catch'](_0x4593e0=>{const _0x39aa92=_0x51727a;console[_0x39aa92(0x192)](_0x39aa92(0x17f),_0x4593e0);}),this[_0x51727a(0x138)]=setInterval(async()=>{const _0xca8d02=_0x51727a;try{await this[_0xca8d02(0x171)]();}catch(_0x2a9087){console[_0xca8d02(0x192)](_0xca8d02(0x1b0),_0x2a9087);}},0x3c*0x3c*0x3e8),console[_0x51727a(0x190)](_0x51727a(0x168));}[a43_0x1399ee(0x1ac)](){const _0xa8d363=a43_0x1399ee;this['updateInterval']&&(clearInterval(this[_0xa8d363(0x138)]),this[_0xa8d363(0x138)]=null,console['log'](_0xa8d363(0x18f)));}async[a43_0x1399ee(0x171)](){const _0x19db06=a43_0x1399ee;try{console['log'](_0x19db06(0x161));const _0xfbc398=this[_0x19db06(0x164)][_0x19db06(0x19a)](','),_0x295671=this[_0x19db06(0x14f)]+_0x19db06(0x179)+_0xfbc398,_0x2bccff=await fetch(_0x295671,{'headers':{'Accept':_0x19db06(0x158),'User-Agent':_0x19db06(0x187)}});if(!_0x2bccff['ok'])throw new Error(_0x19db06(0x13f)+_0x2bccff[_0x19db06(0x1b3)]+'\x20'+_0x2bccff['statusText']);const _0x2a882d=await _0x2bccff['json']();if(!_0x2a882d[_0x19db06(0x15d)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x3aa788=_0x2a882d[_0x19db06(0x15d)];console[_0x19db06(0x190)](_0x19db06(0x1aa)+Object[_0x19db06(0x140)](_0x3aa788)[_0x19db06(0x1a9)]+_0x19db06(0x163));const _0x2fffa7=Object[_0x19db06(0x19f)](_0x3aa788)[_0x19db06(0x1ae)](async([_0x5891ad,_0x38d563])=>{const _0xb006d3=_0x19db06;try{await database_1[_0xb006d3(0x175)][_0xb006d3(0x180)][_0xb006d3(0x13b)]({'where':{'currency':_0x5891ad[_0xb006d3(0x146)]()},'update':{'rate':_0x38d563},'create':{'currency':_0x5891ad[_0xb006d3(0x146)](),'rate':_0x38d563}});}catch(_0x29e96c){console[_0xb006d3(0x192)](_0xb006d3(0x13c)+_0x5891ad+':',_0x29e96c);}});await Promise['allSettled'](_0x2fffa7),console[_0x19db06(0x190)](_0x19db06(0x176));}catch(_0x1a0445){console[_0x19db06(0x192)](_0x19db06(0x196),_0x1a0445);throw _0x1a0445;}}async[a43_0x1399ee(0x141)](_0x417ab3){const _0x1c3973=a43_0x1399ee,_0x477547=_0x417ab3['toLowerCase']();if(_0x477547===_0x1c3973(0x15a))return 0x1;try{const _0x5334d6=await database_1['default'][_0x1c3973(0x180)][_0x1c3973(0x17c)]({'where':{'currency':_0x477547}});if(!_0x5334d6)return console['warn'](_0x1c3973(0x18e)+_0x417ab3+',\x20using\x201\x20as\x20fallback'),0x1;return _0x5334d6['rate'];}catch(_0x1388d4){return console['error'](_0x1c3973(0x172)+_0x417ab3+':',_0x1388d4),0x1;}}async[a43_0x1399ee(0x17d)](_0x35f1b8,_0x2ec476){const _0x2672cb=a43_0x1399ee,_0x48b32f=_0x2ec476[_0x2672cb(0x146)]();if(_0x48b32f===_0x2672cb(0x15a)){const _0x41a9d4=_0x35f1b8*(0x1+this[_0x2672cb(0x195)]/0x64);return console[_0x2672cb(0x190)](_0x2672cb(0x15f)+this[_0x2672cb(0x195)]+_0x2672cb(0x181)+_0x35f1b8+'\x20USDT\x20=\x20'+_0x41a9d4[_0x2672cb(0x16d)](0x6)+_0x2672cb(0x157)),_0x41a9d4;}try{const _0x3fa544=await this['getCurrencyRate'](_0x48b32f),_0x6433cc=_0x35f1b8/_0x3fa544,_0x2df9c4=_0x6433cc*(0x1+this[_0x2672cb(0x195)]/0x64);return console[_0x2672cb(0x190)](_0x2672cb(0x154)+_0x35f1b8+'\x20'+_0x2ec476[_0x2672cb(0x188)]()+_0x2672cb(0x14c)+_0x6433cc[_0x2672cb(0x16d)](0x6)+_0x2672cb(0x1b6)+this[_0x2672cb(0x195)]+_0x2672cb(0x153)+_0x2df9c4[_0x2672cb(0x16d)](0x6)+_0x2672cb(0x13a)+_0x3fa544+')'),_0x2df9c4;}catch(_0x30bc7b){console[_0x2672cb(0x192)](_0x2672cb(0x14d)+_0x35f1b8+'\x20'+_0x2ec476+_0x2672cb(0x170),_0x30bc7b);const _0x15e3fa=_0x35f1b8*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x15e3fa;}}async['convertMultipleToUSDT'](_0x39097a){const _0x244c26=a43_0x1399ee;let _0x57e3af=0x0;for(const {amount:_0x557247,currency:_0x507518}of _0x39097a){const _0x46c2df=await this[_0x244c26(0x17d)](_0x557247,_0x507518);_0x57e3af+=_0x46c2df;}return _0x57e3af;}async['getAllRates'](){const _0x2fcf54=a43_0x1399ee;try{const _0x20dbe9=await database_1[_0x2fcf54(0x175)][_0x2fcf54(0x180)][_0x2fcf54(0x151)]({'select':{'currency':!![],'rate':!![]}}),_0x18acf5={'usdt':0x1};return _0x20dbe9[_0x2fcf54(0x1b8)](_0x4505fd=>{const _0x290fc4=_0x2fcf54;_0x18acf5[_0x4505fd[_0x290fc4(0x1b1)]]=_0x4505fd['rate'];}),_0x18acf5;}catch(_0x417a3b){return console[_0x2fcf54(0x192)](_0x2fcf54(0x167),_0x417a3b),{'usdt':0x1};}}async['getRatesStatus'](){const _0xf9583f=a43_0x1399ee;try{const [_0x1f3969,_0x463fca,_0x557316]=await Promise[_0xf9583f(0x145)]([database_1[_0xf9583f(0x175)][_0xf9583f(0x180)][_0xf9583f(0x173)](),database_1['default'][_0xf9583f(0x180)][_0xf9583f(0x16e)]({'orderBy':{'updatedAt':_0xf9583f(0x148)},'select':{'updatedAt':!![]}}),database_1[_0xf9583f(0x175)][_0xf9583f(0x180)]['findFirst']({'orderBy':{'updatedAt':_0xf9583f(0x18c)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1f3969,'lastUpdated':_0x463fca?.[_0xf9583f(0x1a4)]||null,'oldestRate':_0x557316?.[_0xf9583f(0x1a4)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x5106c1){return console['error'](_0xf9583f(0x16c),_0x5106c1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a43_0x1399ee(0x1a0)](){return this['MARKUP_PERCENTAGE'];}}exports[a43_0x1399ee(0x19c)]=CurrencyService,exports[a43_0x1399ee(0x16f)]=new CurrencyService();