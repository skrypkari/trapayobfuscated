'use strict';function a43_0x4afd(_0x477627,_0x701aba){const _0x1ce6f2=a43_0x1ce6();return a43_0x4afd=function(_0x4afd75,_0x3ade4e){_0x4afd75=_0x4afd75-0x109;let _0x50d4ee=_0x1ce6f2[_0x4afd75];return _0x50d4ee;},a43_0x4afd(_0x477627,_0x701aba);}const a43_0x5b0b32=a43_0x4afd;(function(_0x18b466,_0x2d44de){const _0x5887a8=a43_0x4afd,_0x551796=_0x18b466();while(!![]){try{const _0x294789=-parseInt(_0x5887a8(0x12c))/0x1*(-parseInt(_0x5887a8(0x10e))/0x2)+parseInt(_0x5887a8(0x126))/0x3+-parseInt(_0x5887a8(0x141))/0x4*(-parseInt(_0x5887a8(0x184))/0x5)+parseInt(_0x5887a8(0x180))/0x6*(-parseInt(_0x5887a8(0x153))/0x7)+-parseInt(_0x5887a8(0x15a))/0x8+parseInt(_0x5887a8(0x10a))/0x9*(parseInt(_0x5887a8(0x12b))/0xa)+parseInt(_0x5887a8(0x17a))/0xb;if(_0x294789===_0x2d44de)break;else _0x551796['push'](_0x551796['shift']());}catch(_0x533038){_0x551796['push'](_0x551796['shift']());}}}(a43_0x1ce6,0x64418));function a43_0x1ce6(){const _0x2703c0=['toLowerCase','\x20to\x20USDT:','hkd','CoinGecko\x20API\x20error:\x20','__importDefault','eth','💱\x20Applied\x20','length','application/json','CURRENCIES','💱\x20Converted\x20','1138602dUkfkn','catch','updatedAt','?ids=tether&vs_currencies=','getCurrencyRate','48090hOKtxk','28011bVjfbE','\x20USDT,\x20with\x20','toFixed','\x20to\x20','brl','sek','Initial\x20currency\x20rates\x20update\x20failed:','rate','try','bmd','Error\x20getting\x20all\x20rates:','log',',\x20using\x201\x20as\x20fallback','btc','__esModule','vef','forEach','idr','convertToUSDT','currencyService','Periodic\x20currency\x20rates\x20update\x20failed:','36zgFwZk','\x20USDT','updateCurrencyRates','bhd','cad','sar','usdt','warn','cny','czk','%\x20markup\x20to\x20','ngn','xlm','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','vnd','nzd','bdt','findMany','14EaWNjh','bch','startPeriodicUpdates','map','uah','findFirst','pkr','5028768Tkwkge','\x20currencies','aud','getAllRates','tether','currencyRate','Error\x20converting\x20','statusText','desc','ars','asc','chf','krw','bits','eos','defineProperty','Payment\x20System/1.0','entries','getRatesStatus','lkr','bnb','status','currency','sgd','\x20USDT\x20=\x20','updateInterval','huf','Error\x20getting\x20rate\x20for\x20currency\x20','dkk','rub','dot','jpy','417692byvFOX','COINGECKO_URL','usd','getMarkupPercentage','clp','inr','517518hWmPou','gel','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','95335oNBllP','pln','xau','default','1008Rmdyvi','error','mmk','📊\x20Received\x20rates\x20for\x20','6sGSswl','MARKUP_PERCENTAGE','yfi','gbp','allSettled','nok','ltc','Error\x20getting\x20rates\x20status:','❌\x20Failed\x20to\x20update\x20currency\x20rates:','twd','stopPeriodicUpdates','keys','convertMultipleToUSDT'];a43_0x1ce6=function(){return _0x2703c0;};return a43_0x1ce6();}var __importDefault=this&&this[a43_0x5b0b32(0x11f)]||function(_0x1de13d){return _0x1de13d&&_0x1de13d['__esModule']?_0x1de13d:{'default':_0x1de13d};};Object[a43_0x5b0b32(0x169)](exports,a43_0x5b0b32(0x13a),{'value':!![]}),exports[a43_0x5b0b32(0x13f)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x48ac96=a43_0x5b0b32;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x48ac96(0x124)]=[_0x48ac96(0x139),_0x48ac96(0x120),_0x48ac96(0x114),_0x48ac96(0x154),_0x48ac96(0x16e),_0x48ac96(0x168),'xrp',_0x48ac96(0x14d),'link',_0x48ac96(0x178),_0x48ac96(0x110),_0x48ac96(0x17c),'aed',_0x48ac96(0x163),_0x48ac96(0x15c),_0x48ac96(0x151),_0x48ac96(0x144),_0x48ac96(0x135),_0x48ac96(0x130),_0x48ac96(0x145),_0x48ac96(0x165),_0x48ac96(0x17e),_0x48ac96(0x149),_0x48ac96(0x14a),_0x48ac96(0x176),'eur',_0x48ac96(0x111),_0x48ac96(0x181),_0x48ac96(0x11d),_0x48ac96(0x174),_0x48ac96(0x13d),'ils',_0x48ac96(0x17f),_0x48ac96(0x179),_0x48ac96(0x166),'kwd',_0x48ac96(0x16d),_0x48ac96(0x10c),'mxn','myr',_0x48ac96(0x14c),_0x48ac96(0x113),_0x48ac96(0x150),'php',_0x48ac96(0x159),_0x48ac96(0x185),_0x48ac96(0x177),_0x48ac96(0x146),_0x48ac96(0x131),_0x48ac96(0x171),'thb',_0x48ac96(0x134),_0x48ac96(0x117),_0x48ac96(0x157),_0x48ac96(0x13b),_0x48ac96(0x14f),'zar','xdr','xag',_0x48ac96(0x186),_0x48ac96(0x167),'sats'],this[_0x48ac96(0x173)]=null,this[_0x48ac96(0x10f)]=-0x3,this[_0x48ac96(0x155)]();}[a43_0x5b0b32(0x155)](){const _0xbbb36a=a43_0x5b0b32;this[_0xbbb36a(0x143)]()[_0xbbb36a(0x127)](_0x4e6680=>{const _0x14276b=_0xbbb36a;console['error'](_0x14276b(0x132),_0x4e6680);}),this[_0xbbb36a(0x173)]=setInterval(async()=>{const _0x2502eb=_0xbbb36a;try{await this[_0x2502eb(0x143)]();}catch(_0x16569f){console[_0x2502eb(0x10b)](_0x2502eb(0x140),_0x16569f);}},0x3c*0x3c*0x3e8),console[_0xbbb36a(0x137)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a43_0x5b0b32(0x118)](){const _0x34fef3=a43_0x5b0b32;this['updateInterval']&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console['log'](_0x34fef3(0x183)));}async[a43_0x5b0b32(0x143)](){const _0x2fe9c5=a43_0x5b0b32;try{console[_0x2fe9c5(0x137)](_0x2fe9c5(0x182));const _0x2c5086=this['CURRENCIES']['join'](','),_0x3ec285=this[_0x2fe9c5(0x17b)]+_0x2fe9c5(0x129)+_0x2c5086,_0x3b135b=await fetch(_0x3ec285,{'headers':{'Accept':_0x2fe9c5(0x123),'User-Agent':_0x2fe9c5(0x16a)}});if(!_0x3b135b['ok'])throw new Error(_0x2fe9c5(0x11e)+_0x3b135b[_0x2fe9c5(0x16f)]+'\x20'+_0x3b135b[_0x2fe9c5(0x161)]);const _0x3d1c78=await _0x3b135b['json']();if(!_0x3d1c78['tether'])throw new Error(_0x2fe9c5(0x14e));const _0x5d3e8a=_0x3d1c78[_0x2fe9c5(0x15e)];console['log'](_0x2fe9c5(0x10d)+Object[_0x2fe9c5(0x119)](_0x5d3e8a)[_0x2fe9c5(0x122)]+_0x2fe9c5(0x15b));const _0xd8b349=Object[_0x2fe9c5(0x16b)](_0x5d3e8a)[_0x2fe9c5(0x156)](async([_0x30f6b6,_0xca4845])=>{const _0x1626f9=_0x2fe9c5;try{await database_1[_0x1626f9(0x109)][_0x1626f9(0x15f)]['upsert']({'where':{'currency':_0x30f6b6[_0x1626f9(0x11b)]()},'update':{'rate':_0xca4845},'create':{'currency':_0x30f6b6[_0x1626f9(0x11b)](),'rate':_0xca4845}});}catch(_0x1590a9){console[_0x1626f9(0x10b)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x30f6b6+':',_0x1590a9);}});await Promise[_0x2fe9c5(0x112)](_0xd8b349),console[_0x2fe9c5(0x137)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x570cac){console[_0x2fe9c5(0x10b)](_0x2fe9c5(0x116),_0x570cac);throw _0x570cac;}}async[a43_0x5b0b32(0x12a)](_0x2e61ea){const _0x12787b=a43_0x5b0b32,_0x16cd9b=_0x2e61ea[_0x12787b(0x11b)]();if(_0x16cd9b===_0x12787b(0x147))return 0x1;try{const _0x1d663e=await database_1['default'][_0x12787b(0x15f)]['findUnique']({'where':{'currency':_0x16cd9b}});if(!_0x1d663e)return console[_0x12787b(0x148)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2e61ea+_0x12787b(0x138)),0x1;return _0x1d663e[_0x12787b(0x133)];}catch(_0x18eac5){return console[_0x12787b(0x10b)](_0x12787b(0x175)+_0x2e61ea+':',_0x18eac5),0x1;}}async[a43_0x5b0b32(0x13e)](_0x2ffbe4,_0x4d1c1){const _0x23e60b=a43_0x5b0b32,_0x1217a1=_0x4d1c1['toLowerCase']();if(_0x1217a1===_0x23e60b(0x147)){const _0x360bc2=_0x2ffbe4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x23e60b(0x137)](_0x23e60b(0x121)+this[_0x23e60b(0x10f)]+_0x23e60b(0x14b)+_0x2ffbe4+_0x23e60b(0x172)+_0x360bc2[_0x23e60b(0x12e)](0x6)+_0x23e60b(0x142)),_0x360bc2;}try{const _0x5b8acf=await this[_0x23e60b(0x12a)](_0x1217a1),_0x22fff4=_0x2ffbe4/_0x5b8acf,_0x42537f=_0x22fff4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x23e60b(0x137)](_0x23e60b(0x125)+_0x2ffbe4+'\x20'+_0x4d1c1['toUpperCase']()+_0x23e60b(0x12f)+_0x22fff4[_0x23e60b(0x12e)](0x6)+_0x23e60b(0x12d)+this[_0x23e60b(0x10f)]+'%\x20markup\x20=\x20'+_0x42537f['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x5b8acf+')'),_0x42537f;}catch(_0x1dee27){console[_0x23e60b(0x10b)](_0x23e60b(0x160)+_0x2ffbe4+'\x20'+_0x4d1c1+_0x23e60b(0x11c),_0x1dee27);const _0x158e15=_0x2ffbe4*(0x1+this[_0x23e60b(0x10f)]/0x64);return _0x158e15;}}async[a43_0x5b0b32(0x11a)](_0x4cbd54){let _0x376960=0x0;for(const {amount:_0x2dc83e,currency:_0x5b6068}of _0x4cbd54){const _0x538afc=await this['convertToUSDT'](_0x2dc83e,_0x5b6068);_0x376960+=_0x538afc;}return _0x376960;}async[a43_0x5b0b32(0x15d)](){const _0x56d979=a43_0x5b0b32;try{const _0xb11830=await database_1[_0x56d979(0x109)][_0x56d979(0x15f)][_0x56d979(0x152)]({'select':{'currency':!![],'rate':!![]}}),_0x4203f8={'usdt':0x1};return _0xb11830[_0x56d979(0x13c)](_0x52f0db=>{const _0x5594c2=_0x56d979;_0x4203f8[_0x52f0db[_0x5594c2(0x170)]]=_0x52f0db[_0x5594c2(0x133)];}),_0x4203f8;}catch(_0x11d78a){return console[_0x56d979(0x10b)](_0x56d979(0x136),_0x11d78a),{'usdt':0x1};}}async[a43_0x5b0b32(0x16c)](){const _0x19ff1b=a43_0x5b0b32;try{const [_0x31dc7a,_0x4a16cb,_0x1dc2ea]=await Promise['all']([database_1[_0x19ff1b(0x109)][_0x19ff1b(0x15f)]['count'](),database_1['default'][_0x19ff1b(0x15f)][_0x19ff1b(0x158)]({'orderBy':{'updatedAt':_0x19ff1b(0x162)},'select':{'updatedAt':!![]}}),database_1[_0x19ff1b(0x109)][_0x19ff1b(0x15f)][_0x19ff1b(0x158)]({'orderBy':{'updatedAt':_0x19ff1b(0x164)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x31dc7a,'lastUpdated':_0x4a16cb?.['updatedAt']||null,'oldestRate':_0x1dc2ea?.[_0x19ff1b(0x128)]||null,'markupPercentage':this[_0x19ff1b(0x10f)]};}catch(_0x3168b3){return console[_0x19ff1b(0x10b)](_0x19ff1b(0x115),_0x3168b3),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x19ff1b(0x10f)]};}}[a43_0x5b0b32(0x17d)](){const _0x331392=a43_0x5b0b32;return this[_0x331392(0x10f)];}}exports['CurrencyService']=CurrencyService,exports[a43_0x5b0b32(0x13f)]=new CurrencyService();