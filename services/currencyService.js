'use strict';const a39_0x2999fe=a39_0x1991;(function(_0x62effc,_0x412404){const _0x1e76a4=a39_0x1991,_0x18784d=_0x62effc();while(!![]){try{const _0xde7a35=parseInt(_0x1e76a4(0x19b))/0x1*(parseInt(_0x1e76a4(0x1d7))/0x2)+-parseInt(_0x1e76a4(0x1d0))/0x3+-parseInt(_0x1e76a4(0x1a4))/0x4+-parseInt(_0x1e76a4(0x1b3))/0x5+-parseInt(_0x1e76a4(0x1c5))/0x6*(parseInt(_0x1e76a4(0x1c1))/0x7)+-parseInt(_0x1e76a4(0x1bd))/0x8+-parseInt(_0x1e76a4(0x1ec))/0x9*(-parseInt(_0x1e76a4(0x1a2))/0xa);if(_0xde7a35===_0x412404)break;else _0x18784d['push'](_0x18784d['shift']());}catch(_0x2bebc7){_0x18784d['push'](_0x18784d['shift']());}}}(a39_0x3863,0xbd1ac));function a39_0x1991(_0x43b6f6,_0x34100b){const _0x3863bd=a39_0x3863();return a39_0x1991=function(_0x199124,_0x318b8a){_0x199124=_0x199124-0x189;let _0x1cde4b=_0x3863bd[_0x199124];return _0x1cde4b;},a39_0x1991(_0x43b6f6,_0x34100b);}function a39_0x3863(){const _0x3204ad=['tether','28fNhaTL','MARKUP_PERCENTAGE','toLowerCase','Failed\x20to\x20update\x20rate\x20for\x20','930018ilpLvS','📊\x20Received\x20rates\x20for\x20','status','toUpperCase','bnb','Error\x20getting\x20rates\x20status:','vef','sar','clp','usdt','application/json','1475067dZHWgG','convertMultipleToUSDT','eos','entries','stopPeriodicUpdates','defineProperty','asc','81558KAzORB','cad','https://api.coingecko.com/api/v3/simple/price','CoinGecko\x20API\x20error:\x20','\x20to\x20USDT:','bdt','updateCurrencyRates','warn','Error\x20converting\x20','getRatesStatus','brl','xlm','currency','eth','gel','idr','%\x20markup\x20to\x20','getMarkupPercentage','nzd','sek','rate','9NndopQ','map','currencyRate','php','length','count','aud','dkk','updatedAt','findUnique','ngn','bch','chf',',\x20using\x201\x20as\x20fallback','Error\x20getting\x20all\x20rates:','btc','findFirst','error','aed','No\x20rate\x20found\x20for\x20currency:\x20','cny','%\x20markup\x20=\x20','keys','convertToUSDT','bhd','thb','\x20currencies','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','eur','currencyService','💱\x20Applied\x20','../config/database','\x20USDT,\x20with\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','upsert','mmk','inr','vnd','myr','findMany','gbp','CURRENCIES','25wVYYXE','toFixed','Periodic\x20currency\x20rates\x20update\x20failed:','lkr','sats','nok','log','36741970FJfvWh','catch','4949228wWCjoc','startPeriodicUpdates','zar','usd','mxn','ltc','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20USDT\x20=\x20','TesSoft\x20Payment\x20System/1.0','updateInterval','__esModule','allSettled','default','huf','yfi','1985900BXVfEI','❌\x20Failed\x20to\x20update\x20currency\x20rates:','join','xag','statusText','Initial\x20currency\x20rates\x20update\x20failed:','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','czk','hkd','pkr','9383296YCaSJg','bits','ars'];a39_0x3863=function(){return _0x3204ad;};return a39_0x3863();}var __importDefault=this&&this['__importDefault']||function(_0x4fbe6c){const _0x3f7ee2=a39_0x1991;return _0x4fbe6c&&_0x4fbe6c[_0x3f7ee2(0x1ae)]?_0x4fbe6c:{'default':_0x4fbe6c};};Object[a39_0x2999fe(0x1d5)](exports,a39_0x2999fe(0x1ae),{'value':!![]}),exports[a39_0x2999fe(0x18e)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x2999fe(0x190)));class CurrencyService{constructor(){const _0xe9000b=a39_0x2999fe;this['COINGECKO_URL']=_0xe9000b(0x1d9),this['CURRENCIES']=[_0xe9000b(0x1fb),_0xe9000b(0x1e4),_0xe9000b(0x1a9),_0xe9000b(0x1f7),_0xe9000b(0x1c9),_0xe9000b(0x1d2),'xrp',_0xe9000b(0x1e2),'link','dot',_0xe9000b(0x1b2),_0xe9000b(0x1a7),_0xe9000b(0x1fe),_0xe9000b(0x1bf),_0xe9000b(0x1f2),_0xe9000b(0x1dc),_0xe9000b(0x189),'bmd',_0xe9000b(0x1e1),_0xe9000b(0x1d8),_0xe9000b(0x1f8),_0xe9000b(0x1cd),_0xe9000b(0x200),_0xe9000b(0x1ba),_0xe9000b(0x1f3),_0xe9000b(0x18d),_0xe9000b(0x199),_0xe9000b(0x1e5),_0xe9000b(0x1bb),_0xe9000b(0x1b1),_0xe9000b(0x1e6),'ils',_0xe9000b(0x195),'jpy','krw','kwd',_0xe9000b(0x19e),_0xe9000b(0x194),_0xe9000b(0x1a8),_0xe9000b(0x197),_0xe9000b(0x1f6),_0xe9000b(0x1a0),_0xe9000b(0x1e9),_0xe9000b(0x1ef),_0xe9000b(0x1bc),'pln','rub',_0xe9000b(0x1cc),_0xe9000b(0x1ea),'sgd',_0xe9000b(0x18a),'try','twd','uah',_0xe9000b(0x1cb),_0xe9000b(0x196),_0xe9000b(0x1a6),'xdr',_0xe9000b(0x1b6),'xau',_0xe9000b(0x1be),_0xe9000b(0x19f)],this[_0xe9000b(0x1ad)]=null,this[_0xe9000b(0x1c2)]=0x3,this[_0xe9000b(0x1a5)]();}[a39_0x2999fe(0x1a5)](){const _0x388af1=a39_0x2999fe;this[_0x388af1(0x1dd)]()[_0x388af1(0x1a3)](_0x459e13=>{const _0x130fc5=_0x388af1;console['error'](_0x130fc5(0x1b8),_0x459e13);}),this[_0x388af1(0x1ad)]=setInterval(async()=>{const _0x6a4ceb=_0x388af1;try{await this[_0x6a4ceb(0x1dd)]();}catch(_0x9ac95f){console['error'](_0x6a4ceb(0x19d),_0x9ac95f);}},0x3c*0x3c*0x3e8),console['log'](_0x388af1(0x1aa));}[a39_0x2999fe(0x1d4)](){const _0xb1e24=a39_0x2999fe;this['updateInterval']&&(clearInterval(this[_0xb1e24(0x1ad)]),this[_0xb1e24(0x1ad)]=null,console[_0xb1e24(0x1a1)](_0xb1e24(0x18c)));}async['updateCurrencyRates'](){const _0x37ee91=a39_0x2999fe;try{console[_0x37ee91(0x1a1)](_0x37ee91(0x192));const _0x16e1d6=this[_0x37ee91(0x19a)][_0x37ee91(0x1b5)](','),_0x3d8382=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x16e1d6,_0x292cb5=await fetch(_0x3d8382,{'headers':{'Accept':_0x37ee91(0x1cf),'User-Agent':_0x37ee91(0x1ac)}});if(!_0x292cb5['ok'])throw new Error(_0x37ee91(0x1da)+_0x292cb5[_0x37ee91(0x1c7)]+'\x20'+_0x292cb5[_0x37ee91(0x1b7)]);const _0x37eec9=await _0x292cb5['json']();if(!_0x37eec9[_0x37ee91(0x1c0)])throw new Error(_0x37ee91(0x1b9));const _0x1d9b6a=_0x37eec9['tether'];console[_0x37ee91(0x1a1)](_0x37ee91(0x1c6)+Object[_0x37ee91(0x202)](_0x1d9b6a)[_0x37ee91(0x1f0)]+_0x37ee91(0x18b));const _0x2dd7df=Object[_0x37ee91(0x1d3)](_0x1d9b6a)[_0x37ee91(0x1ed)](async([_0x145d9c,_0x4cce85])=>{const _0x865e91=_0x37ee91;try{await database_1[_0x865e91(0x1b0)]['currencyRate'][_0x865e91(0x193)]({'where':{'currency':_0x145d9c[_0x865e91(0x1c3)]()},'update':{'rate':_0x4cce85},'create':{'currency':_0x145d9c['toLowerCase'](),'rate':_0x4cce85}});}catch(_0x2ea7b0){console[_0x865e91(0x1fd)](_0x865e91(0x1c4)+_0x145d9c+':',_0x2ea7b0);}});await Promise[_0x37ee91(0x1af)](_0x2dd7df),console[_0x37ee91(0x1a1)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x27568e){console[_0x37ee91(0x1fd)](_0x37ee91(0x1b4),_0x27568e);throw _0x27568e;}}async['getCurrencyRate'](_0x35bc8b){const _0x38f561=a39_0x2999fe,_0x22e506=_0x35bc8b[_0x38f561(0x1c3)]();if(_0x22e506===_0x38f561(0x1ce))return 0x1;try{const _0x3daf7f=await database_1[_0x38f561(0x1b0)][_0x38f561(0x1ee)][_0x38f561(0x1f5)]({'where':{'currency':_0x22e506}});if(!_0x3daf7f)return console[_0x38f561(0x1de)](_0x38f561(0x1ff)+_0x35bc8b+_0x38f561(0x1f9)),0x1;return _0x3daf7f[_0x38f561(0x1eb)];}catch(_0x9f0a3c){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x35bc8b+':',_0x9f0a3c),0x1;}}async[a39_0x2999fe(0x203)](_0xe76fa6,_0x44451f){const _0x11eded=a39_0x2999fe,_0x11f5c2=_0x44451f[_0x11eded(0x1c3)]();if(_0x11f5c2===_0x11eded(0x1ce)){const _0x35c4fd=_0xe76fa6*(0x1+this[_0x11eded(0x1c2)]/0x64);return console[_0x11eded(0x1a1)](_0x11eded(0x18f)+this[_0x11eded(0x1c2)]+_0x11eded(0x1e7)+_0xe76fa6+_0x11eded(0x1ab)+_0x35c4fd[_0x11eded(0x19c)](0x6)+'\x20USDT'),_0x35c4fd;}try{const _0x23f8c9=await this['getCurrencyRate'](_0x11f5c2),_0x564eb3=_0xe76fa6/_0x23f8c9,_0x4cbbda=_0x564eb3*(0x1+this[_0x11eded(0x1c2)]/0x64);return console['log']('💱\x20Converted\x20'+_0xe76fa6+'\x20'+_0x44451f[_0x11eded(0x1c8)]()+'\x20to\x20'+_0x564eb3['toFixed'](0x6)+_0x11eded(0x191)+this[_0x11eded(0x1c2)]+_0x11eded(0x201)+_0x4cbbda[_0x11eded(0x19c)](0x6)+'\x20USDT\x20(rate:\x20'+_0x23f8c9+')'),_0x4cbbda;}catch(_0x5b4c01){console[_0x11eded(0x1fd)](_0x11eded(0x1df)+_0xe76fa6+'\x20'+_0x44451f+_0x11eded(0x1db),_0x5b4c01);const _0x15f90a=_0xe76fa6*(0x1+this[_0x11eded(0x1c2)]/0x64);return _0x15f90a;}}async[a39_0x2999fe(0x1d1)](_0x182d53){const _0x3b9c66=a39_0x2999fe;let _0x13d3ee=0x0;for(const {amount:_0x53fc4d,currency:_0x2b4f9d}of _0x182d53){const _0x3f8606=await this[_0x3b9c66(0x203)](_0x53fc4d,_0x2b4f9d);_0x13d3ee+=_0x3f8606;}return _0x13d3ee;}async['getAllRates'](){const _0x15812e=a39_0x2999fe;try{const _0x59ceb4=await database_1['default'][_0x15812e(0x1ee)][_0x15812e(0x198)]({'select':{'currency':!![],'rate':!![]}}),_0x588d46={'usdt':0x1};return _0x59ceb4['forEach'](_0x278174=>{const _0x2f676e=_0x15812e;_0x588d46[_0x278174[_0x2f676e(0x1e3)]]=_0x278174[_0x2f676e(0x1eb)];}),_0x588d46;}catch(_0x18012d){return console[_0x15812e(0x1fd)](_0x15812e(0x1fa),_0x18012d),{'usdt':0x1};}}async[a39_0x2999fe(0x1e0)](){const _0x129de8=a39_0x2999fe;try{const [_0x36b779,_0x569117,_0x4abd2c]=await Promise['all']([database_1[_0x129de8(0x1b0)][_0x129de8(0x1ee)][_0x129de8(0x1f1)](),database_1[_0x129de8(0x1b0)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x129de8(0x1b0)][_0x129de8(0x1ee)][_0x129de8(0x1fc)]({'orderBy':{'updatedAt':_0x129de8(0x1d6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x36b779,'lastUpdated':_0x569117?.[_0x129de8(0x1f4)]||null,'oldestRate':_0x4abd2c?.[_0x129de8(0x1f4)]||null,'markupPercentage':this[_0x129de8(0x1c2)]};}catch(_0x3985bd){return console[_0x129de8(0x1fd)](_0x129de8(0x1ca),_0x3985bd),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x129de8(0x1c2)]};}}[a39_0x2999fe(0x1e8)](){const _0x5eafb8=a39_0x2999fe;return this[_0x5eafb8(0x1c2)];}}exports['CurrencyService']=CurrencyService,exports[a39_0x2999fe(0x18e)]=new CurrencyService();