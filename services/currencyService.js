'use strict';const a43_0x1d35eb=a43_0x412e;(function(_0x308929,_0x5569e0){const _0x4da4d0=a43_0x412e,_0x3dc3b4=_0x308929();while(!![]){try{const _0x4527ec=-parseInt(_0x4da4d0(0x24c))/0x1*(parseInt(_0x4da4d0(0x208))/0x2)+-parseInt(_0x4da4d0(0x251))/0x3+parseInt(_0x4da4d0(0x255))/0x4+-parseInt(_0x4da4d0(0x225))/0x5*(-parseInt(_0x4da4d0(0x25d))/0x6)+parseInt(_0x4da4d0(0x1e6))/0x7*(parseInt(_0x4da4d0(0x215))/0x8)+-parseInt(_0x4da4d0(0x252))/0x9*(parseInt(_0x4da4d0(0x220))/0xa)+parseInt(_0x4da4d0(0x1fd))/0xb*(-parseInt(_0x4da4d0(0x214))/0xc);if(_0x4527ec===_0x5569e0)break;else _0x3dc3b4['push'](_0x3dc3b4['shift']());}catch(_0x293099){_0x3dc3b4['push'](_0x3dc3b4['shift']());}}}(a43_0x4ca9,0xbc05d));var __importDefault=this&&this[a43_0x1d35eb(0x1f9)]||function(_0x47b576){const _0x412d59=a43_0x1d35eb;return _0x47b576&&_0x47b576[_0x412d59(0x238)]?_0x47b576:{'default':_0x47b576};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0x1d35eb(0x1f3)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a43_0x1d35eb(0x242)));class CurrencyService{constructor(){const _0x967f68=a43_0x1d35eb;this[_0x967f68(0x20b)]=_0x967f68(0x1fb),this[_0x967f68(0x20d)]=[_0x967f68(0x25a),_0x967f68(0x233),_0x967f68(0x1f7),_0x967f68(0x1e2),_0x967f68(0x200),_0x967f68(0x1fa),_0x967f68(0x23a),'xlm',_0x967f68(0x212),'dot',_0x967f68(0x254),_0x967f68(0x24a),_0x967f68(0x1e1),_0x967f68(0x21b),_0x967f68(0x1eb),_0x967f68(0x219),_0x967f68(0x21e),_0x967f68(0x1e9),'brl',_0x967f68(0x21f),_0x967f68(0x234),_0x967f68(0x21a),_0x967f68(0x23e),_0x967f68(0x1fc),'dkk','eur',_0x967f68(0x1ee),_0x967f68(0x1f0),_0x967f68(0x235),_0x967f68(0x201),'idr',_0x967f68(0x20f),_0x967f68(0x25c),_0x967f68(0x25e),_0x967f68(0x1f4),'kwd',_0x967f68(0x259),_0x967f68(0x241),_0x967f68(0x211),_0x967f68(0x256),_0x967f68(0x24d),_0x967f68(0x245),_0x967f68(0x22e),'php',_0x967f68(0x1e7),_0x967f68(0x246),'rub',_0x967f68(0x228),'sek',_0x967f68(0x23f),_0x967f68(0x20c),_0x967f68(0x1ea),'twd',_0x967f68(0x202),'vef',_0x967f68(0x1f8),_0x967f68(0x1fe),'xdr','xag',_0x967f68(0x1f2),_0x967f68(0x222),_0x967f68(0x248)],this[_0x967f68(0x253)]=null,this[_0x967f68(0x21d)]=-0x3,this[_0x967f68(0x216)]();}['startPeriodicUpdates'](){const _0x3f9ac6=a43_0x1d35eb;this[_0x3f9ac6(0x224)]()['catch'](_0x59dcde=>{const _0x327560=_0x3f9ac6;console[_0x327560(0x21c)](_0x327560(0x247),_0x59dcde);}),this[_0x3f9ac6(0x253)]=setInterval(async()=>{const _0x1f0c52=_0x3f9ac6;try{await this[_0x1f0c52(0x224)]();}catch(_0x43213e){console[_0x1f0c52(0x21c)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x43213e);}},0x3c*0x3c*0x3e8),console[_0x3f9ac6(0x1ed)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a43_0x1d35eb(0x204)](){const _0x5cab5c=a43_0x1d35eb;this['updateInterval']&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x5cab5c(0x1ed)](_0x5cab5c(0x229)));}async['updateCurrencyRates'](){const _0x3e988e=a43_0x1d35eb;try{console['log'](_0x3e988e(0x1f5));const _0x153a12=this['CURRENCIES'][_0x3e988e(0x209)](','),_0x194766=this[_0x3e988e(0x20b)]+'?ids=tether&vs_currencies='+_0x153a12,_0x9d7838=await fetch(_0x194766,{'headers':{'Accept':_0x3e988e(0x236),'User-Agent':_0x3e988e(0x20e)}});if(!_0x9d7838['ok'])throw new Error(_0x3e988e(0x25f)+_0x9d7838[_0x3e988e(0x240)]+'\x20'+_0x9d7838['statusText']);const _0x35549c=await _0x9d7838[_0x3e988e(0x230)]();if(!_0x35549c[_0x3e988e(0x23d)])throw new Error(_0x3e988e(0x244));const _0x3511cf=_0x35549c['tether'];console['log'](_0x3e988e(0x231)+Object[_0x3e988e(0x22a)](_0x3511cf)[_0x3e988e(0x232)]+_0x3e988e(0x22d));const _0x1de7e1=Object[_0x3e988e(0x1e3)](_0x3511cf)[_0x3e988e(0x24f)](async([_0x202fe4,_0x4bdfcd])=>{const _0x39b6fe=_0x3e988e;try{await database_1['default'][_0x39b6fe(0x226)][_0x39b6fe(0x223)]({'where':{'currency':_0x202fe4['toLowerCase']()},'update':{'rate':_0x4bdfcd},'create':{'currency':_0x202fe4[_0x39b6fe(0x205)](),'rate':_0x4bdfcd}});}catch(_0x91d5e7){console[_0x39b6fe(0x21c)](_0x39b6fe(0x260)+_0x202fe4+':',_0x91d5e7);}});await Promise[_0x3e988e(0x250)](_0x1de7e1),console[_0x3e988e(0x1ed)](_0x3e988e(0x22c));}catch(_0x57fa77){console[_0x3e988e(0x21c)](_0x3e988e(0x1ef),_0x57fa77);throw _0x57fa77;}}async['getCurrencyRate'](_0x39a820){const _0x12a6b3=a43_0x1d35eb,_0xc96025=_0x39a820['toLowerCase']();if(_0xc96025===_0x12a6b3(0x24e))return 0x1;try{const _0x175d27=await database_1[_0x12a6b3(0x1f6)][_0x12a6b3(0x226)][_0x12a6b3(0x249)]({'where':{'currency':_0xc96025}});if(!_0x175d27)return console[_0x12a6b3(0x1f1)](_0x12a6b3(0x221)+_0x39a820+',\x20using\x201\x20as\x20fallback'),0x1;return _0x175d27['rate'];}catch(_0x2ac8de){return console[_0x12a6b3(0x21c)](_0x12a6b3(0x207)+_0x39a820+':',_0x2ac8de),0x1;}}async[a43_0x1d35eb(0x23b)](_0x4c2751,_0x5d9994){const _0x506769=a43_0x1d35eb,_0x2f32f0=_0x5d9994[_0x506769(0x205)]();if(_0x2f32f0===_0x506769(0x24e)){const _0x407406=_0x4c2751*(0x1+this[_0x506769(0x21d)]/0x64);return console[_0x506769(0x1ed)](_0x506769(0x1e4)+this['MARKUP_PERCENTAGE']+_0x506769(0x25b)+_0x4c2751+_0x506769(0x261)+_0x407406[_0x506769(0x243)](0x6)+_0x506769(0x23c)),_0x407406;}try{const _0x334e97=await this['getCurrencyRate'](_0x2f32f0),_0x301a16=_0x4c2751/_0x334e97,_0x40a874=_0x301a16*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x506769(0x1ed)](_0x506769(0x206)+_0x4c2751+'\x20'+_0x5d9994[_0x506769(0x239)]()+_0x506769(0x237)+_0x301a16['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x506769(0x21d)]+_0x506769(0x22b)+_0x40a874[_0x506769(0x243)](0x6)+_0x506769(0x1ff)+_0x334e97+')'),_0x40a874;}catch(_0x35fbfa){console[_0x506769(0x21c)](_0x506769(0x22f)+_0x4c2751+'\x20'+_0x5d9994+'\x20to\x20USDT:',_0x35fbfa);const _0x50ea5a=_0x4c2751*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x50ea5a;}}async[a43_0x1d35eb(0x203)](_0x15b074){const _0x54143e=a43_0x1d35eb;let _0x5cbd17=0x0;for(const {amount:_0x27fc6a,currency:_0x3da339}of _0x15b074){const _0x82a406=await this[_0x54143e(0x23b)](_0x27fc6a,_0x3da339);_0x5cbd17+=_0x82a406;}return _0x5cbd17;}async[a43_0x1d35eb(0x217)](){const _0x4c8264=a43_0x1d35eb;try{const _0x3f5efe=await database_1[_0x4c8264(0x1f6)][_0x4c8264(0x226)][_0x4c8264(0x24b)]({'select':{'currency':!![],'rate':!![]}}),_0x5a35d5={'usdt':0x1};return _0x3f5efe[_0x4c8264(0x227)](_0x296c12=>{const _0xa60553=_0x4c8264;_0x5a35d5[_0x296c12[_0xa60553(0x257)]]=_0x296c12[_0xa60553(0x20a)];}),_0x5a35d5;}catch(_0x133db6){return console[_0x4c8264(0x21c)]('Error\x20getting\x20all\x20rates:',_0x133db6),{'usdt':0x1};}}async[a43_0x1d35eb(0x1e5)](){const _0x3aa9d2=a43_0x1d35eb;try{const [_0x5890ed,_0x5d61fc,_0x5d4b8f]=await Promise['all']([database_1[_0x3aa9d2(0x1f6)][_0x3aa9d2(0x226)][_0x3aa9d2(0x258)](),database_1['default']['currencyRate'][_0x3aa9d2(0x218)]({'orderBy':{'updatedAt':_0x3aa9d2(0x1ec)},'select':{'updatedAt':!![]}}),database_1[_0x3aa9d2(0x1f6)]['currencyRate'][_0x3aa9d2(0x218)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5890ed,'lastUpdated':_0x5d61fc?.[_0x3aa9d2(0x1e8)]||null,'oldestRate':_0x5d4b8f?.[_0x3aa9d2(0x1e8)]||null,'markupPercentage':this[_0x3aa9d2(0x21d)]};}catch(_0x1812a1){return console[_0x3aa9d2(0x21c)]('Error\x20getting\x20rates\x20status:',_0x1812a1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3aa9d2(0x21d)]};}}[a43_0x1d35eb(0x213)](){const _0x3ee01d=a43_0x1d35eb;return this[_0x3ee01d(0x21d)];}}function a43_0x412e(_0x88c631,_0x31ae23){const _0x4ca9f3=a43_0x4ca9();return a43_0x412e=function(_0x412e90,_0x1ef3b6){_0x412e90=_0x412e90-0x1e1;let _0x1c607b=_0x4ca9f3[_0x412e90];return _0x1c607b;},a43_0x412e(_0x88c631,_0x31ae23);}function a43_0x4ca9(){const _0x3bb329=['hkd','application/json','\x20to\x20','__esModule','toUpperCase','xrp','convertToUSDT','\x20USDT','tether','cny','sgd','status','mmk','../config/database','toFixed','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','nok','pln','Initial\x20currency\x20rates\x20update\x20failed:','sats','findUnique','usd','findMany','293979scPnXz','ngn','usdt','map','allSettled','741258TAdeXk','27KkNkai','updateInterval','yfi','3300888LGcZqY','myr','currency','count','lkr','btc','%\x20markup\x20to\x20','inr','147306wGwUmk','jpy','CoinGecko\x20API\x20error:\x20','Failed\x20to\x20update\x20rate\x20for\x20','\x20USDT\x20=\x20','aed','bch','entries','üí±\x20Applied\x20','getRatesStatus','441nCKgNC','pkr','updatedAt','bmd','try','aud','desc','log','gbp','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','gel','warn','xau','currencyService','krw','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','default','ltc','vnd','__importDefault','eos','https://api.coingecko.com/api/v3/simple/price','czk','7199159kiRijk','zar','\x20USDT\x20(rate:\x20','bnb','huf','uah','convertMultipleToUSDT','stopPeriodicUpdates','toLowerCase','üí±\x20Converted\x20','Error\x20getting\x20rate\x20for\x20currency\x20','2PckHnF','join','rate','COINGECKO_URL','thb','CURRENCIES','Payment\x20System/1.0','ils','CurrencyService','mxn','link','getMarkupPercentage','12uYKWVX','92608uDljhX','startPeriodicUpdates','getAllRates','findFirst','bdt','clp','ars','error','MARKUP_PERCENTAGE','bhd','cad','1330060PgUcAZ','No\x20rate\x20found\x20for\x20currency:\x20','bits','upsert','updateCurrencyRates','165PrvTiD','currencyRate','forEach','sar','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','keys','%\x20markup\x20=\x20','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','\x20currencies','nzd','Error\x20converting\x20','json','üìä\x20Received\x20rates\x20for\x20','length','eth','chf'];a43_0x4ca9=function(){return _0x3bb329;};return a43_0x4ca9();}exports[a43_0x1d35eb(0x210)]=CurrencyService,exports[a43_0x1d35eb(0x1f3)]=new CurrencyService();