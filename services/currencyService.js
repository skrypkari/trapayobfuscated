'use strict';const a36_0x304aa0=a36_0x4422;(function(_0x5b9d8f,_0x361d1d){const _0x49a363=a36_0x4422,_0x12c14c=_0x5b9d8f();while(!![]){try{const _0x104922=parseInt(_0x49a363(0x17b))/0x1+parseInt(_0x49a363(0x14a))/0x2*(parseInt(_0x49a363(0x12a))/0x3)+-parseInt(_0x49a363(0x191))/0x4+-parseInt(_0x49a363(0x169))/0x5+parseInt(_0x49a363(0x111))/0x6+parseInt(_0x49a363(0x18c))/0x7*(parseInt(_0x49a363(0x133))/0x8)+parseInt(_0x49a363(0x12f))/0x9*(-parseInt(_0x49a363(0x177))/0xa);if(_0x104922===_0x361d1d)break;else _0x12c14c['push'](_0x12c14c['shift']());}catch(_0xee4e84){_0x12c14c['push'](_0x12c14c['shift']());}}}(a36_0x4759,0x91d24));var __importDefault=this&&this[a36_0x304aa0(0x146)]||function(_0x30687c){const _0x577898=a36_0x304aa0;return _0x30687c&&_0x30687c[_0x577898(0x122)]?_0x30687c:{'default':_0x30687c};};Object[a36_0x304aa0(0x181)](exports,a36_0x304aa0(0x122),{'value':!![]}),exports[a36_0x304aa0(0x16f)]=exports[a36_0x304aa0(0x138)]=void 0x0;function a36_0x4759(){const _0x1989e8=['cad','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','usdt','2821758cVtPBY','log','getCurrencyRate','ils','xag','306PhXBEp','dkk','updatedAt','pln','8pdTvgC','sek','CURRENCIES','getRatesStatus','ngn','CurrencyService','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','brl','?ids=tether&vs_currencies=','toFixed','MARKUP_PERCENTAGE','link','bnb','https://api.coingecko.com/api/v3/simple/price','vnd','Periodic\x20currency\x20rates\x20update\x20failed:','btc','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','desc','__importDefault','\x20USDT\x20=\x20','uah','asc','2QIOFfP','krw','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','updateCurrencyRates','xau','inr','startPeriodicUpdates','TesSoft\x20Payment\x20System/1.0','jpy','eur','findFirst','nok','upsert','default','\x20USDT\x20(rate:\x20','Initial\x20currency\x20rates\x20update\x20failed:','gel','currency',',\x20using\x201\x20as\x20fallback','toUpperCase','myr','getMarkupPercentage','%\x20markup\x20to\x20','ðŸ’±\x20Applied\x20','xrp','rate','map','bmd','xdr','hkd','convertToUSDT','3047105cguXre','keys','lkr','clp','join','json','currencyService','czk','count','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','Error\x20converting\x20','CoinGecko\x20API\x20error:\x20','nzd','toLowerCase','9660YSmWEk','length','Error\x20getting\x20rate\x20for\x20currency\x20','ltc','737029jzRayk','forEach','mmk','bhd','kwd','yfi','defineProperty','updateInterval','bch','dot','catch','error','ars','eth','currencyRate','try','sgd','23912gWURlb','âœ…\x20Currency\x20rates\x20updated\x20successfully','\x20USDT','\x20currencies','gbp','1932204ySGXsJ','sats','huf','249414NRpJtW','aud','cny','Failed\x20to\x20update\x20rate\x20for\x20','warn','%\x20markup\x20=\x20','getAllRates','twd','\x20USDT,\x20with\x20','rub','No\x20rate\x20found\x20for\x20currency:\x20','../config/database','COINGECKO_URL','pkr','chf','aed','bits','__esModule','ðŸ’±\x20Converted\x20','thb','mxn','tether'];a36_0x4759=function(){return _0x1989e8;};return a36_0x4759();}const database_1=__importDefault(require(a36_0x304aa0(0x11c)));function a36_0x4422(_0x18d1bc,_0x3ae751){const _0x47596c=a36_0x4759();return a36_0x4422=function(_0x4422df,_0xee3ab4){_0x4422df=_0x4422df-0x111;let _0x4fd9a3=_0x47596c[_0x4422df];return _0x4fd9a3;},a36_0x4422(_0x18d1bc,_0x3ae751);}class CurrencyService{constructor(){const _0x7db64d=a36_0x304aa0;this[_0x7db64d(0x11d)]=_0x7db64d(0x140),this['CURRENCIES']=[_0x7db64d(0x143),_0x7db64d(0x188),_0x7db64d(0x17a),_0x7db64d(0x183),_0x7db64d(0x13f),'eos',_0x7db64d(0x162),'xlm',_0x7db64d(0x13e),_0x7db64d(0x184),_0x7db64d(0x180),'usd',_0x7db64d(0x120),_0x7db64d(0x187),_0x7db64d(0x112),'bdt',_0x7db64d(0x17e),_0x7db64d(0x165),_0x7db64d(0x13a),_0x7db64d(0x127),_0x7db64d(0x11f),_0x7db64d(0x16c),_0x7db64d(0x113),_0x7db64d(0x170),_0x7db64d(0x130),_0x7db64d(0x153),_0x7db64d(0x190),_0x7db64d(0x15a),_0x7db64d(0x167),_0x7db64d(0x193),'idr',_0x7db64d(0x12d),_0x7db64d(0x14f),_0x7db64d(0x152),_0x7db64d(0x14b),_0x7db64d(0x17f),_0x7db64d(0x16b),_0x7db64d(0x17d),_0x7db64d(0x125),_0x7db64d(0x15e),_0x7db64d(0x137),_0x7db64d(0x155),_0x7db64d(0x175),'php',_0x7db64d(0x11e),_0x7db64d(0x132),_0x7db64d(0x11a),'sar',_0x7db64d(0x134),_0x7db64d(0x18b),_0x7db64d(0x124),_0x7db64d(0x18a),_0x7db64d(0x118),_0x7db64d(0x148),'vef',_0x7db64d(0x141),'zar',_0x7db64d(0x166),_0x7db64d(0x12e),_0x7db64d(0x14e),_0x7db64d(0x121),_0x7db64d(0x192)],this[_0x7db64d(0x182)]=null,this[_0x7db64d(0x13d)]=0x3,this[_0x7db64d(0x150)]();}[a36_0x304aa0(0x150)](){const _0x1ffd3b=a36_0x304aa0;this[_0x1ffd3b(0x14d)]()[_0x1ffd3b(0x185)](_0xd044a9=>{const _0x34ca54=_0x1ffd3b;console[_0x34ca54(0x186)](_0x34ca54(0x159),_0xd044a9);}),this[_0x1ffd3b(0x182)]=setInterval(async()=>{const _0xe072bb=_0x1ffd3b;try{await this[_0xe072bb(0x14d)]();}catch(_0x388add){console['error'](_0xe072bb(0x142),_0x388add);}},0x3c*0x3c*0x3e8),console[_0x1ffd3b(0x12b)](_0x1ffd3b(0x128));}['stopPeriodicUpdates'](){const _0x5621c3=a36_0x304aa0;this['updateInterval']&&(clearInterval(this[_0x5621c3(0x182)]),this[_0x5621c3(0x182)]=null,console[_0x5621c3(0x12b)](_0x5621c3(0x139)));}async[a36_0x304aa0(0x14d)](){const _0x261e6d=a36_0x304aa0;try{console['log'](_0x261e6d(0x144));const _0x539fdd=this[_0x261e6d(0x135)][_0x261e6d(0x16d)](','),_0x1091d7=this[_0x261e6d(0x11d)]+_0x261e6d(0x13b)+_0x539fdd,_0x3523c3=await fetch(_0x1091d7,{'headers':{'Accept':'application/json','User-Agent':_0x261e6d(0x151)}});if(!_0x3523c3['ok'])throw new Error(_0x261e6d(0x174)+_0x3523c3['status']+'\x20'+_0x3523c3['statusText']);const _0x378de4=await _0x3523c3[_0x261e6d(0x16e)]();if(!_0x378de4[_0x261e6d(0x126)])throw new Error(_0x261e6d(0x14c));const _0x5e1f6d=_0x378de4[_0x261e6d(0x126)];console[_0x261e6d(0x12b)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0x261e6d(0x16a)](_0x5e1f6d)[_0x261e6d(0x178)]+_0x261e6d(0x18f));const _0x409ad1=Object['entries'](_0x5e1f6d)[_0x261e6d(0x164)](async([_0x5bbc2d,_0x316a4])=>{const _0x175b68=_0x261e6d;try{await database_1[_0x175b68(0x157)][_0x175b68(0x189)][_0x175b68(0x156)]({'where':{'currency':_0x5bbc2d[_0x175b68(0x176)]()},'update':{'rate':_0x316a4},'create':{'currency':_0x5bbc2d[_0x175b68(0x176)](),'rate':_0x316a4}});}catch(_0x4512f5){console['error'](_0x175b68(0x114)+_0x5bbc2d+':',_0x4512f5);}});await Promise['allSettled'](_0x409ad1),console[_0x261e6d(0x12b)](_0x261e6d(0x18d));}catch(_0x1bc3cc){console[_0x261e6d(0x186)](_0x261e6d(0x172),_0x1bc3cc);throw _0x1bc3cc;}}async[a36_0x304aa0(0x12c)](_0x48c8e1){const _0x1190ef=a36_0x304aa0,_0x5c1336=_0x48c8e1[_0x1190ef(0x176)]();if(_0x5c1336===_0x1190ef(0x129))return 0x1;try{const _0x1591ad=await database_1['default'][_0x1190ef(0x189)]['findUnique']({'where':{'currency':_0x5c1336}});if(!_0x1591ad)return console[_0x1190ef(0x115)](_0x1190ef(0x11b)+_0x48c8e1+_0x1190ef(0x15c)),0x1;return _0x1591ad[_0x1190ef(0x163)];}catch(_0x59d48){return console['error'](_0x1190ef(0x179)+_0x48c8e1+':',_0x59d48),0x1;}}async[a36_0x304aa0(0x168)](_0x4405e1,_0x7adfdf){const _0x5b0927=a36_0x304aa0,_0x2e8480=_0x7adfdf[_0x5b0927(0x176)]();if(_0x2e8480===_0x5b0927(0x129)){const _0xc1e07f=_0x4405e1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5b0927(0x12b)](_0x5b0927(0x161)+this['MARKUP_PERCENTAGE']+_0x5b0927(0x160)+_0x4405e1+_0x5b0927(0x147)+_0xc1e07f[_0x5b0927(0x13c)](0x6)+_0x5b0927(0x18e)),_0xc1e07f;}try{const _0x4ad4d0=await this[_0x5b0927(0x12c)](_0x2e8480),_0x5a6e5e=_0x4405e1/_0x4ad4d0,_0x26bd2f=_0x5a6e5e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5b0927(0x12b)](_0x5b0927(0x123)+_0x4405e1+'\x20'+_0x7adfdf[_0x5b0927(0x15d)]()+'\x20to\x20'+_0x5a6e5e['toFixed'](0x6)+_0x5b0927(0x119)+this['MARKUP_PERCENTAGE']+_0x5b0927(0x116)+_0x26bd2f['toFixed'](0x6)+_0x5b0927(0x158)+_0x4ad4d0+')'),_0x26bd2f;}catch(_0x4d435a){console['error'](_0x5b0927(0x173)+_0x4405e1+'\x20'+_0x7adfdf+'\x20to\x20USDT:',_0x4d435a);const _0x257e8b=_0x4405e1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x257e8b;}}async['convertMultipleToUSDT'](_0x28001c){let _0x5d5399=0x0;for(const {amount:_0x2f2dfa,currency:_0x1b5970}of _0x28001c){const _0x7b8d9=await this['convertToUSDT'](_0x2f2dfa,_0x1b5970);_0x5d5399+=_0x7b8d9;}return _0x5d5399;}async[a36_0x304aa0(0x117)](){const _0x28706e=a36_0x304aa0;try{const _0x247a30=await database_1[_0x28706e(0x157)][_0x28706e(0x189)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x7383d7={'usdt':0x1};return _0x247a30[_0x28706e(0x17c)](_0x361e5c=>{const _0x6e98e8=_0x28706e;_0x7383d7[_0x361e5c[_0x6e98e8(0x15b)]]=_0x361e5c[_0x6e98e8(0x163)];}),_0x7383d7;}catch(_0x1ffe1c){return console[_0x28706e(0x186)]('Error\x20getting\x20all\x20rates:',_0x1ffe1c),{'usdt':0x1};}}async[a36_0x304aa0(0x136)](){const _0x294d9b=a36_0x304aa0;try{const [_0x1bfa3e,_0x16308a,_0x2e2b66]=await Promise['all']([database_1[_0x294d9b(0x157)][_0x294d9b(0x189)][_0x294d9b(0x171)](),database_1[_0x294d9b(0x157)][_0x294d9b(0x189)][_0x294d9b(0x154)]({'orderBy':{'updatedAt':_0x294d9b(0x145)},'select':{'updatedAt':!![]}}),database_1[_0x294d9b(0x157)][_0x294d9b(0x189)][_0x294d9b(0x154)]({'orderBy':{'updatedAt':_0x294d9b(0x149)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1bfa3e,'lastUpdated':_0x16308a?.['updatedAt']||null,'oldestRate':_0x2e2b66?.[_0x294d9b(0x131)]||null,'markupPercentage':this[_0x294d9b(0x13d)]};}catch(_0x1fe9ea){return console[_0x294d9b(0x186)]('Error\x20getting\x20rates\x20status:',_0x1fe9ea),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a36_0x304aa0(0x15f)](){const _0x2c232e=a36_0x304aa0;return this[_0x2c232e(0x13d)];}}exports[a36_0x304aa0(0x138)]=CurrencyService,exports[a36_0x304aa0(0x16f)]=new CurrencyService();