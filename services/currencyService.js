'use strict';const a43_0x1af05f=a43_0x208b;(function(_0x1b807a,_0x364c90){const _0x33890d=a43_0x208b,_0x630cb5=_0x1b807a();while(!![]){try{const _0x210d51=-parseInt(_0x33890d(0x1b2))/0x1+-parseInt(_0x33890d(0x1cf))/0x2*(-parseInt(_0x33890d(0x182))/0x3)+-parseInt(_0x33890d(0x1b6))/0x4+-parseInt(_0x33890d(0x1c4))/0x5*(-parseInt(_0x33890d(0x19e))/0x6)+-parseInt(_0x33890d(0x1a5))/0x7*(parseInt(_0x33890d(0x16d))/0x8)+parseInt(_0x33890d(0x1a9))/0x9+parseInt(_0x33890d(0x16e))/0xa;if(_0x210d51===_0x364c90)break;else _0x630cb5['push'](_0x630cb5['shift']());}catch(_0x17031d){_0x630cb5['push'](_0x630cb5['shift']());}}}(a43_0x17df,0xb420b));var __importDefault=this&&this[a43_0x1af05f(0x1b4)]||function(_0xe2769){const _0x385b53=a43_0x1af05f;return _0xe2769&&_0xe2769[_0x385b53(0x192)]?_0xe2769:{'default':_0xe2769};};function a43_0x17df(){const _0x2af511=['getCurrencyRate','huf','Error\x20getting\x20all\x20rates:',',\x20using\x201\x20as\x20fallback','currencyRate','pln','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','forEach','findMany','COINGECKO_URL','clp','❌\x20Failed\x20to\x20update\x20currency\x20rates:','application/json','statusText','czk','vef','2163513DMgYuZ','\x20to\x20','\x20USDT,\x20with\x20','keys','count','startPeriodicUpdates','usdt','btc','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ils','Error\x20converting\x20','getMarkupPercentage','catch','status','toFixed','vnd','__esModule','convertToUSDT','bmd','✅\x20Currency\x20rates\x20updated\x20successfully','updatedAt','dkk','Error\x20getting\x20rate\x20for\x20currency\x20','warn','findFirst','ngn','desc','\x20USDT','6NNCssz','getRatesStatus','currencyService','CoinGecko\x20API\x20error:\x20','uah','sar','bnb','6587xNTUKo','kwd','rub','xdr','6230403nOJbfX','📊\x20Received\x20rates\x20for\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','asc','sgd','dot','findUnique','idr','\x20to\x20USDT:','1126412ZuzERA','updateCurrencyRates','__importDefault','xau','4841952pKevvA','default','log','mxn','CurrencyService','currency','nzd','\x20currencies','json','getAllRates','../config/database','nok','jpy','Error\x20getting\x20rates\x20status:','5455310WwGjMd','\x20USDT\x20(rate:\x20','aud','CURRENCIES','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','error','allSettled','link','No\x20rate\x20found\x20for\x20currency:\x20','tether','pkr','2OZjuch','bch','%\x20markup\x20=\x20','sek','map','toLowerCase','💱\x20Applied\x20','hkd','mmk','stopPeriodicUpdates','rate','zar','sats','length','%\x20markup\x20to\x20','chf','MARKUP_PERCENTAGE','updateInterval','eos','7384lSbaLc','14387460BufQrO','cny','toUpperCase','Initial\x20currency\x20rates\x20update\x20failed:'];a43_0x17df=function(){return _0x2af511;};return a43_0x17df();}function a43_0x208b(_0xd943a9,_0x37408d){const _0x17dfde=a43_0x17df();return a43_0x208b=function(_0x208b72,_0x1ac1f4){_0x208b72=_0x208b72-0x16b;let _0x1460b0=_0x17dfde[_0x208b72];return _0x1460b0;},a43_0x208b(_0xd943a9,_0x37408d);}Object['defineProperty'](exports,a43_0x1af05f(0x192),{'value':!![]}),exports[a43_0x1af05f(0x1a0)]=exports[a43_0x1af05f(0x1ba)]=void 0x0;const database_1=__importDefault(require(a43_0x1af05f(0x1c0)));class CurrencyService{constructor(){const _0x5dc6b0=a43_0x1af05f;this[_0x5dc6b0(0x17b)]='https://api.coingecko.com/api/v3/simple/price',this[_0x5dc6b0(0x1c7)]=[_0x5dc6b0(0x189),'eth','ltc',_0x5dc6b0(0x1d0),_0x5dc6b0(0x1a4),_0x5dc6b0(0x16c),'xrp','xlm',_0x5dc6b0(0x1cb),_0x5dc6b0(0x1ae),'yfi','usd','aed','ars',_0x5dc6b0(0x1c6),'bdt','bhd',_0x5dc6b0(0x194),'brl','cad',_0x5dc6b0(0x1de),_0x5dc6b0(0x17c),_0x5dc6b0(0x16f),_0x5dc6b0(0x180),_0x5dc6b0(0x197),'eur','gbp','gel',_0x5dc6b0(0x1d6),_0x5dc6b0(0x173),_0x5dc6b0(0x1b0),_0x5dc6b0(0x18b),'inr',_0x5dc6b0(0x1c2),'krw',_0x5dc6b0(0x1a6),'lkr',_0x5dc6b0(0x1d7),_0x5dc6b0(0x1b9),'myr',_0x5dc6b0(0x19b),_0x5dc6b0(0x1c1),_0x5dc6b0(0x1bc),'php',_0x5dc6b0(0x1ce),_0x5dc6b0(0x177),_0x5dc6b0(0x1a7),_0x5dc6b0(0x1a3),_0x5dc6b0(0x1d2),_0x5dc6b0(0x1ad),'thb','try','twd',_0x5dc6b0(0x1a2),_0x5dc6b0(0x181),_0x5dc6b0(0x191),_0x5dc6b0(0x1da),_0x5dc6b0(0x1a8),'xag',_0x5dc6b0(0x1b5),'bits',_0x5dc6b0(0x1db)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x5dc6b0(0x187)]();}[a43_0x1af05f(0x187)](){const _0x3db6d6=a43_0x1af05f;this[_0x3db6d6(0x1b3)]()[_0x3db6d6(0x18e)](_0x1b9117=>{const _0x107d0a=_0x3db6d6;console[_0x107d0a(0x1c9)](_0x107d0a(0x171),_0x1b9117);}),this[_0x3db6d6(0x16b)]=setInterval(async()=>{const _0xa7b952=_0x3db6d6;try{await this[_0xa7b952(0x1b3)]();}catch(_0x9b78d1){console[_0xa7b952(0x1c9)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x9b78d1);}},0x3c*0x3c*0x3e8),console[_0x3db6d6(0x1b8)](_0x3db6d6(0x178));}[a43_0x1af05f(0x1d8)](){const _0x2746c3=a43_0x1af05f;this[_0x2746c3(0x16b)]&&(clearInterval(this['updateInterval']),this[_0x2746c3(0x16b)]=null,console['log'](_0x2746c3(0x1c8)));}async[a43_0x1af05f(0x1b3)](){const _0x50c949=a43_0x1af05f;try{console[_0x50c949(0x1b8)](_0x50c949(0x18a));const _0x5830cb=this[_0x50c949(0x1c7)]['join'](','),_0x1b5f37=this[_0x50c949(0x17b)]+'?ids=tether&vs_currencies='+_0x5830cb,_0x21c74b=await fetch(_0x1b5f37,{'headers':{'Accept':_0x50c949(0x17e),'User-Agent':'Payment\x20System/1.0'}});if(!_0x21c74b['ok'])throw new Error(_0x50c949(0x1a1)+_0x21c74b[_0x50c949(0x18f)]+'\x20'+_0x21c74b[_0x50c949(0x17f)]);const _0x5090a3=await _0x21c74b[_0x50c949(0x1be)]();if(!_0x5090a3[_0x50c949(0x1cd)])throw new Error(_0x50c949(0x1ab));const _0x5c1943=_0x5090a3['tether'];console[_0x50c949(0x1b8)](_0x50c949(0x1aa)+Object[_0x50c949(0x185)](_0x5c1943)[_0x50c949(0x1dc)]+_0x50c949(0x1bd));const _0x24b8ec=Object['entries'](_0x5c1943)[_0x50c949(0x1d3)](async([_0x30af0a,_0x113309])=>{const _0xe5c445=_0x50c949;try{await database_1[_0xe5c445(0x1b7)][_0xe5c445(0x176)]['upsert']({'where':{'currency':_0x30af0a[_0xe5c445(0x1d4)]()},'update':{'rate':_0x113309},'create':{'currency':_0x30af0a['toLowerCase'](),'rate':_0x113309}});}catch(_0x2ad0a6){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x30af0a+':',_0x2ad0a6);}});await Promise[_0x50c949(0x1ca)](_0x24b8ec),console['log'](_0x50c949(0x195));}catch(_0x260c29){console[_0x50c949(0x1c9)](_0x50c949(0x17d),_0x260c29);throw _0x260c29;}}async['getCurrencyRate'](_0x1550dc){const _0x2f4b2f=a43_0x1af05f,_0x40cd22=_0x1550dc[_0x2f4b2f(0x1d4)]();if(_0x40cd22==='usdt')return 0x1;try{const _0x33c5da=await database_1[_0x2f4b2f(0x1b7)][_0x2f4b2f(0x176)][_0x2f4b2f(0x1af)]({'where':{'currency':_0x40cd22}});if(!_0x33c5da)return console[_0x2f4b2f(0x199)](_0x2f4b2f(0x1cc)+_0x1550dc+_0x2f4b2f(0x175)),0x1;return _0x33c5da[_0x2f4b2f(0x1d9)];}catch(_0x32f3f8){return console[_0x2f4b2f(0x1c9)](_0x2f4b2f(0x198)+_0x1550dc+':',_0x32f3f8),0x1;}}async[a43_0x1af05f(0x193)](_0x3d667d,_0x51d516){const _0x5edb82=a43_0x1af05f,_0x548d0b=_0x51d516[_0x5edb82(0x1d4)]();if(_0x548d0b===_0x5edb82(0x188)){const _0x4b58e4=_0x3d667d*(0x1+this[_0x5edb82(0x1df)]/0x64);return console[_0x5edb82(0x1b8)](_0x5edb82(0x1d5)+this[_0x5edb82(0x1df)]+_0x5edb82(0x1dd)+_0x3d667d+'\x20USDT\x20=\x20'+_0x4b58e4['toFixed'](0x6)+_0x5edb82(0x19d)),_0x4b58e4;}try{const _0x1ed583=await this[_0x5edb82(0x172)](_0x548d0b),_0x6de91b=_0x3d667d/_0x1ed583,_0x2513ab=_0x6de91b*(0x1+this[_0x5edb82(0x1df)]/0x64);return console[_0x5edb82(0x1b8)]('💱\x20Converted\x20'+_0x3d667d+'\x20'+_0x51d516[_0x5edb82(0x170)]()+_0x5edb82(0x183)+_0x6de91b[_0x5edb82(0x190)](0x6)+_0x5edb82(0x184)+this[_0x5edb82(0x1df)]+_0x5edb82(0x1d1)+_0x2513ab[_0x5edb82(0x190)](0x6)+_0x5edb82(0x1c5)+_0x1ed583+')'),_0x2513ab;}catch(_0x3c91ef){console[_0x5edb82(0x1c9)](_0x5edb82(0x18c)+_0x3d667d+'\x20'+_0x51d516+_0x5edb82(0x1b1),_0x3c91ef);const _0x479cda=_0x3d667d*(0x1+this[_0x5edb82(0x1df)]/0x64);return _0x479cda;}}async['convertMultipleToUSDT'](_0x3efe96){let _0xaea980=0x0;for(const {amount:_0x20d2ab,currency:_0x23fa7f}of _0x3efe96){const _0xf7ec14=await this['convertToUSDT'](_0x20d2ab,_0x23fa7f);_0xaea980+=_0xf7ec14;}return _0xaea980;}async[a43_0x1af05f(0x1bf)](){const _0x214801=a43_0x1af05f;try{const _0x51acae=await database_1['default'][_0x214801(0x176)][_0x214801(0x17a)]({'select':{'currency':!![],'rate':!![]}}),_0x4d64e6={'usdt':0x1};return _0x51acae[_0x214801(0x179)](_0x43f55a=>{const _0x28f3c1=_0x214801;_0x4d64e6[_0x43f55a[_0x28f3c1(0x1bb)]]=_0x43f55a[_0x28f3c1(0x1d9)];}),_0x4d64e6;}catch(_0x10ae9f){return console[_0x214801(0x1c9)](_0x214801(0x174),_0x10ae9f),{'usdt':0x1};}}async[a43_0x1af05f(0x19f)](){const _0x25b80b=a43_0x1af05f;try{const [_0x215db6,_0x7611fb,_0x4588ad]=await Promise['all']([database_1[_0x25b80b(0x1b7)][_0x25b80b(0x176)][_0x25b80b(0x186)](),database_1['default']['currencyRate'][_0x25b80b(0x19a)]({'orderBy':{'updatedAt':_0x25b80b(0x19c)},'select':{'updatedAt':!![]}}),database_1[_0x25b80b(0x1b7)][_0x25b80b(0x176)]['findFirst']({'orderBy':{'updatedAt':_0x25b80b(0x1ac)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x215db6,'lastUpdated':_0x7611fb?.[_0x25b80b(0x196)]||null,'oldestRate':_0x4588ad?.['updatedAt']||null,'markupPercentage':this[_0x25b80b(0x1df)]};}catch(_0x1c968b){return console[_0x25b80b(0x1c9)](_0x25b80b(0x1c3),_0x1c968b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x25b80b(0x1df)]};}}[a43_0x1af05f(0x18d)](){const _0x19595a=a43_0x1af05f;return this[_0x19595a(0x1df)];}}exports[a43_0x1af05f(0x1ba)]=CurrencyService,exports['currencyService']=new CurrencyService();