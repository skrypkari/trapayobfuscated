'use strict';function a38_0x16a7(){const _0x347085=['jpy','hkd','defineProperty','gel','❌\x20Failed\x20to\x20update\x20currency\x20rates:','7305104fDNPTN','yfi','nzd','eth','cad','💱\x20Applied\x20','findMany','uah','stopPeriodicUpdates','\x20USDT,\x20with\x20','No\x20rate\x20found\x20for\x20currency:\x20','toFixed','entries','MARKUP_PERCENTAGE','link','__esModule','length','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','thb','5Gwsivp','json','asc','sek','Failed\x20to\x20update\x20rate\x20for\x20','pln','607146NanmfF','9ZYEKhH','try','dkk','ils','https://api.coingecko.com/api/v3/simple/price','convertMultipleToUSDT','chf','php','💱\x20Converted\x20','ars','getMarkupPercentage','bhd','keys','TesSoft\x20Payment\x20System/1.0','currencyRate','huf','getAllRates','krw','default','join','\x20USDT\x20=\x20',',\x20using\x201\x20as\x20fallback','statusText','getRatesStatus','CURRENCIES','bch','bdt','nok','\x20USDT\x20(rate:\x20','mxn','sgd','2514686yiSFmR','270pvzMTS','56MBnheJ','ngn','zar','vnd','📊\x20Received\x20rates\x20for\x20','catch','updatedAt','Error\x20getting\x20all\x20rates:','getCurrencyRate','Initial\x20currency\x20rates\x20update\x20failed:','Error\x20converting\x20','aud','updateInterval','startPeriodicUpdates','rate','currency','\x20USDT','CurrencyService','usdt','warn','idr','map','btc','%\x20markup\x20to\x20','forEach','updateCurrencyRates','bits','COINGECKO_URL','1302653KIuNYW','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','eos','findUnique','lkr','__importDefault','\x20currencies','toLowerCase','ltc','1320308fLVdZn','all','gbp','czk','currencyService','vef','twd','convertToUSDT','CoinGecko\x20API\x20error:\x20','kwd','../config/database','xag','brl','inr','allSettled','myr','\x20to\x20','upsert','usd','4065435vZGiHW','pkr','application/json','aed','bmd','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','desc','2692988CdTzbM','sats','log','✅\x20Currency\x20rates\x20updated\x20successfully','tether','error'];a38_0x16a7=function(){return _0x347085;};return a38_0x16a7();}const a38_0xd08695=a38_0x422f;(function(_0x501f7e,_0x3b21d9){const _0x3e38af=a38_0x422f,_0x1f7eac=_0x501f7e();while(!![]){try{const _0x1c82eb=-parseInt(_0x3e38af(0x1ac))/0x1+parseInt(_0x3e38af(0x185))/0x2+-parseInt(_0x3e38af(0x1bf))/0x3+-parseInt(_0x3e38af(0x1c6))/0x4*(-parseInt(_0x3e38af(0x1e4))/0x5)+-parseInt(_0x3e38af(0x1ea))/0x6*(parseInt(_0x3e38af(0x187))/0x7)+parseInt(_0x3e38af(0x1d1))/0x8*(-parseInt(_0x3e38af(0x1eb))/0x9)+parseInt(_0x3e38af(0x186))/0xa*(parseInt(_0x3e38af(0x1a3))/0xb);if(_0x1c82eb===_0x3b21d9)break;else _0x1f7eac['push'](_0x1f7eac['shift']());}catch(_0xe2218d){_0x1f7eac['push'](_0x1f7eac['shift']());}}}(a38_0x16a7,0xb2324));function a38_0x422f(_0x8d194,_0x9e0dc8){const _0x16a7df=a38_0x16a7();return a38_0x422f=function(_0x422f7f,_0x2cd168){_0x422f7f=_0x422f7f-0x169;let _0x3ab6fe=_0x16a7df[_0x422f7f];return _0x3ab6fe;},a38_0x422f(_0x8d194,_0x9e0dc8);}var __importDefault=this&&this[a38_0xd08695(0x1a8)]||function(_0xa2362){const _0x3e5cf9=a38_0xd08695;return _0xa2362&&_0xa2362[_0x3e5cf9(0x1e0)]?_0xa2362:{'default':_0xa2362};};Object[a38_0xd08695(0x1ce)](exports,a38_0xd08695(0x1e0),{'value':!![]}),exports[a38_0xd08695(0x1b0)]=exports[a38_0xd08695(0x198)]=void 0x0;const database_1=__importDefault(require(a38_0xd08695(0x1b6)));class CurrencyService{constructor(){const _0x42ce8a=a38_0xd08695;this[_0x42ce8a(0x1a2)]=_0x42ce8a(0x16a),this[_0x42ce8a(0x17e)]=[_0x42ce8a(0x19d),_0x42ce8a(0x1d4),_0x42ce8a(0x1ab),_0x42ce8a(0x17f),'bnb',_0x42ce8a(0x1a5),'xrp','xlm',_0x42ce8a(0x1df),'dot',_0x42ce8a(0x1d2),_0x42ce8a(0x1be),_0x42ce8a(0x1c2),_0x42ce8a(0x16f),_0x42ce8a(0x192),_0x42ce8a(0x180),_0x42ce8a(0x171),_0x42ce8a(0x1c3),_0x42ce8a(0x1b8),_0x42ce8a(0x1d5),_0x42ce8a(0x16c),'clp','cny',_0x42ce8a(0x1af),_0x42ce8a(0x1ed),'eur',_0x42ce8a(0x1ae),_0x42ce8a(0x1cf),_0x42ce8a(0x1cd),_0x42ce8a(0x175),_0x42ce8a(0x19b),_0x42ce8a(0x169),_0x42ce8a(0x1b9),_0x42ce8a(0x1cc),_0x42ce8a(0x177),_0x42ce8a(0x1b5),_0x42ce8a(0x1a7),'mmk',_0x42ce8a(0x183),_0x42ce8a(0x1bb),_0x42ce8a(0x188),_0x42ce8a(0x181),_0x42ce8a(0x1d3),_0x42ce8a(0x16d),_0x42ce8a(0x1c0),_0x42ce8a(0x1e9),'rub','sar',_0x42ce8a(0x1e7),_0x42ce8a(0x184),_0x42ce8a(0x1e3),_0x42ce8a(0x1ec),_0x42ce8a(0x1b2),_0x42ce8a(0x1d8),_0x42ce8a(0x1b1),_0x42ce8a(0x18a),_0x42ce8a(0x189),'xdr',_0x42ce8a(0x1b7),'xau',_0x42ce8a(0x1a1),_0x42ce8a(0x1c7)],this[_0x42ce8a(0x193)]=null,this[_0x42ce8a(0x1de)]=0x3,this[_0x42ce8a(0x194)]();}['startPeriodicUpdates'](){const _0x1a0abd=a38_0xd08695;this[_0x1a0abd(0x1a0)]()[_0x1a0abd(0x18c)](_0x1b6a5b=>{const _0x54f212=_0x1a0abd;console[_0x54f212(0x1cb)](_0x54f212(0x190),_0x1b6a5b);}),this[_0x1a0abd(0x193)]=setInterval(async()=>{const _0x4b3b41=_0x1a0abd;try{await this[_0x4b3b41(0x1a0)]();}catch(_0x5b0815){console[_0x4b3b41(0x1cb)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x5b0815);}},0x3c*0x3c*0x3e8),console[_0x1a0abd(0x1c8)](_0x1a0abd(0x1e2));}[a38_0xd08695(0x1d9)](){const _0x2d8c27=a38_0xd08695;this[_0x2d8c27(0x193)]&&(clearInterval(this['updateInterval']),this[_0x2d8c27(0x193)]=null,console['log']('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0xd08695(0x1a0)](){const _0x4fa328=a38_0xd08695;try{console[_0x4fa328(0x1c8)](_0x4fa328(0x1c4));const _0x2dbde6=this['CURRENCIES'][_0x4fa328(0x179)](','),_0x191061=this[_0x4fa328(0x1a2)]+'?ids=tether&vs_currencies='+_0x2dbde6,_0x4545f0=await fetch(_0x191061,{'headers':{'Accept':_0x4fa328(0x1c1),'User-Agent':_0x4fa328(0x173)}});if(!_0x4545f0['ok'])throw new Error(_0x4fa328(0x1b4)+_0x4545f0['status']+'\x20'+_0x4545f0[_0x4fa328(0x17c)]);const _0x1f9d48=await _0x4545f0[_0x4fa328(0x1e5)]();if(!_0x1f9d48['tether'])throw new Error(_0x4fa328(0x1a4));const _0x4393d7=_0x1f9d48[_0x4fa328(0x1ca)];console[_0x4fa328(0x1c8)](_0x4fa328(0x18b)+Object[_0x4fa328(0x172)](_0x4393d7)[_0x4fa328(0x1e1)]+_0x4fa328(0x1a9));const _0x4bf99a=Object[_0x4fa328(0x1dd)](_0x4393d7)[_0x4fa328(0x19c)](async([_0x174526,_0x234e12])=>{const _0xb31bbf=_0x4fa328;try{await database_1[_0xb31bbf(0x178)][_0xb31bbf(0x174)][_0xb31bbf(0x1bd)]({'where':{'currency':_0x174526['toLowerCase']()},'update':{'rate':_0x234e12},'create':{'currency':_0x174526[_0xb31bbf(0x1aa)](),'rate':_0x234e12}});}catch(_0x54e36b){console[_0xb31bbf(0x1cb)](_0xb31bbf(0x1e8)+_0x174526+':',_0x54e36b);}});await Promise[_0x4fa328(0x1ba)](_0x4bf99a),console[_0x4fa328(0x1c8)](_0x4fa328(0x1c9));}catch(_0x310b24){console['error'](_0x4fa328(0x1d0),_0x310b24);throw _0x310b24;}}async[a38_0xd08695(0x18f)](_0x2a08e3){const _0x493bbb=a38_0xd08695,_0x445be6=_0x2a08e3[_0x493bbb(0x1aa)]();if(_0x445be6===_0x493bbb(0x199))return 0x1;try{const _0x398182=await database_1[_0x493bbb(0x178)][_0x493bbb(0x174)][_0x493bbb(0x1a6)]({'where':{'currency':_0x445be6}});if(!_0x398182)return console[_0x493bbb(0x19a)](_0x493bbb(0x1db)+_0x2a08e3+_0x493bbb(0x17b)),0x1;return _0x398182['rate'];}catch(_0x5ea005){return console[_0x493bbb(0x1cb)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x2a08e3+':',_0x5ea005),0x1;}}async[a38_0xd08695(0x1b3)](_0x46e643,_0x42ef31){const _0x5544ce=a38_0xd08695,_0x2800a0=_0x42ef31[_0x5544ce(0x1aa)]();if(_0x2800a0===_0x5544ce(0x199)){const _0x59211b=_0x46e643*(0x1+this[_0x5544ce(0x1de)]/0x64);return console[_0x5544ce(0x1c8)](_0x5544ce(0x1d6)+this[_0x5544ce(0x1de)]+_0x5544ce(0x19e)+_0x46e643+_0x5544ce(0x17a)+_0x59211b['toFixed'](0x6)+_0x5544ce(0x197)),_0x59211b;}try{const _0x2e1624=await this[_0x5544ce(0x18f)](_0x2800a0),_0x38e728=_0x46e643/_0x2e1624,_0x42e799=_0x38e728*(0x1+this[_0x5544ce(0x1de)]/0x64);return console[_0x5544ce(0x1c8)](_0x5544ce(0x16e)+_0x46e643+'\x20'+_0x42ef31['toUpperCase']()+_0x5544ce(0x1bc)+_0x38e728['toFixed'](0x6)+_0x5544ce(0x1da)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x42e799[_0x5544ce(0x1dc)](0x6)+_0x5544ce(0x182)+_0x2e1624+')'),_0x42e799;}catch(_0x5d24bd){console[_0x5544ce(0x1cb)](_0x5544ce(0x191)+_0x46e643+'\x20'+_0x42ef31+'\x20to\x20USDT:',_0x5d24bd);const _0x3ea9f1=_0x46e643*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3ea9f1;}}async[a38_0xd08695(0x16b)](_0x41f1dd){const _0x5a5a8d=a38_0xd08695;let _0x17b32c=0x0;for(const {amount:_0x4c45f,currency:_0x34088d}of _0x41f1dd){const _0x4ad4f6=await this[_0x5a5a8d(0x1b3)](_0x4c45f,_0x34088d);_0x17b32c+=_0x4ad4f6;}return _0x17b32c;}async[a38_0xd08695(0x176)](){const _0x199dbf=a38_0xd08695;try{const _0x44ef57=await database_1[_0x199dbf(0x178)][_0x199dbf(0x174)][_0x199dbf(0x1d7)]({'select':{'currency':!![],'rate':!![]}}),_0x1526dc={'usdt':0x1};return _0x44ef57[_0x199dbf(0x19f)](_0x216cde=>{const _0x844326=_0x199dbf;_0x1526dc[_0x216cde[_0x844326(0x196)]]=_0x216cde[_0x844326(0x195)];}),_0x1526dc;}catch(_0xa78ba9){return console[_0x199dbf(0x1cb)](_0x199dbf(0x18e),_0xa78ba9),{'usdt':0x1};}}async[a38_0xd08695(0x17d)](){const _0x133f39=a38_0xd08695;try{const [_0x231ad7,_0x28f883,_0x1bdb82]=await Promise[_0x133f39(0x1ad)]([database_1['default'][_0x133f39(0x174)]['count'](),database_1[_0x133f39(0x178)][_0x133f39(0x174)]['findFirst']({'orderBy':{'updatedAt':_0x133f39(0x1c5)},'select':{'updatedAt':!![]}}),database_1['default'][_0x133f39(0x174)]['findFirst']({'orderBy':{'updatedAt':_0x133f39(0x1e6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x231ad7,'lastUpdated':_0x28f883?.[_0x133f39(0x18d)]||null,'oldestRate':_0x1bdb82?.[_0x133f39(0x18d)]||null,'markupPercentage':this[_0x133f39(0x1de)]};}catch(_0x2ffb83){return console[_0x133f39(0x1cb)]('Error\x20getting\x20rates\x20status:',_0x2ffb83),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x133f39(0x1de)]};}}[a38_0xd08695(0x170)](){const _0x365b6a=a38_0xd08695;return this[_0x365b6a(0x1de)];}}exports['CurrencyService']=CurrencyService,exports[a38_0xd08695(0x1b0)]=new CurrencyService();