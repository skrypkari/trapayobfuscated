'use strict';const a36_0x356485=a36_0x54e0;(function(_0xff55f9,_0x3ba2d0){const _0xd41662=a36_0x54e0,_0x26236b=_0xff55f9();while(!![]){try{const _0x12b59d=-parseInt(_0xd41662(0x13e))/0x1+-parseInt(_0xd41662(0xe9))/0x2*(parseInt(_0xd41662(0x138))/0x3)+-parseInt(_0xd41662(0x12f))/0x4+-parseInt(_0xd41662(0xf6))/0x5*(-parseInt(_0xd41662(0xf5))/0x6)+-parseInt(_0xd41662(0x108))/0x7+parseInt(_0xd41662(0x10b))/0x8+parseInt(_0xd41662(0x125))/0x9*(parseInt(_0xd41662(0x121))/0xa);if(_0x12b59d===_0x3ba2d0)break;else _0x26236b['push'](_0x26236b['shift']());}catch(_0x20d86d){_0x26236b['push'](_0x26236b['shift']());}}}(a36_0x4ad9,0x68c0e));function a36_0x54e0(_0x11cc67,_0x3da669){const _0x4ad989=a36_0x4ad9();return a36_0x54e0=function(_0x54e0f3,_0x1ac87a){_0x54e0f3=_0x54e0f3-0xd1;let _0x40f136=_0x4ad989[_0x54e0f3];return _0x40f136;},a36_0x54e0(_0x11cc67,_0x3da669);}var __importDefault=this&&this['__importDefault']||function(_0x39262a){return _0x39262a&&_0x39262a['__esModule']?_0x39262a:{'default':_0x39262a};};Object[a36_0x356485(0x11e)](exports,a36_0x356485(0x135),{'value':!![]}),exports[a36_0x356485(0xeb)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a36_0x356485(0x117)));class CurrencyService{constructor(){const _0x3c0361=a36_0x356485;this[_0x3c0361(0x13f)]=_0x3c0361(0xd3),this[_0x3c0361(0x113)]=[_0x3c0361(0x127),_0x3c0361(0x144),_0x3c0361(0x13a),'bch',_0x3c0361(0x11c),'eos',_0x3c0361(0xee),_0x3c0361(0x11f),_0x3c0361(0xd8),_0x3c0361(0x126),'yfi','usd',_0x3c0361(0xe1),_0x3c0361(0x140),'aud','bdt','bhd',_0x3c0361(0x13d),_0x3c0361(0x109),'cad',_0x3c0361(0x116),_0x3c0361(0x136),'cny',_0x3c0361(0xfb),_0x3c0361(0xe0),'eur',_0x3c0361(0xec),_0x3c0361(0xdb),'hkd',_0x3c0361(0xda),'idr',_0x3c0361(0x139),_0x3c0361(0x115),_0x3c0361(0x12a),_0x3c0361(0x119),_0x3c0361(0x10c),'lkr',_0x3c0361(0x137),_0x3c0361(0x11a),_0x3c0361(0xe3),_0x3c0361(0xfe),_0x3c0361(0x10d),_0x3c0361(0x141),_0x3c0361(0x104),'pkr',_0x3c0361(0xef),_0x3c0361(0x112),_0x3c0361(0xdd),_0x3c0361(0xe6),_0x3c0361(0x100),_0x3c0361(0xf2),'try',_0x3c0361(0xd6),_0x3c0361(0x133),_0x3c0361(0xf4),_0x3c0361(0xea),_0x3c0361(0x120),'xdr','xag',_0x3c0361(0xe5),'bits','sats'],this[_0x3c0361(0x10f)]=null,this[_0x3c0361(0x111)]=0x3,this[_0x3c0361(0x101)]();}['startPeriodicUpdates'](){const _0xc5f2c9=a36_0x356485;this[_0xc5f2c9(0xde)]()[_0xc5f2c9(0xed)](_0x26d09c=>{const _0x1a7a3d=_0xc5f2c9;console[_0x1a7a3d(0xfa)](_0x1a7a3d(0xe7),_0x26d09c);}),this['updateInterval']=setInterval(async()=>{const _0x1bc7b5=_0xc5f2c9;try{await this[_0x1bc7b5(0xde)]();}catch(_0x1c41c7){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x1c41c7);}},0x3c*0x3c*0x3e8),console[_0xc5f2c9(0x107)](_0xc5f2c9(0xd2));}[a36_0x356485(0x12b)](){const _0x3bfbd4=a36_0x356485;this[_0x3bfbd4(0x10f)]&&(clearInterval(this[_0x3bfbd4(0x10f)]),this[_0x3bfbd4(0x10f)]=null,console['log']('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a36_0x356485(0xde)](){const _0x398d86=a36_0x356485;try{console[_0x398d86(0x107)](_0x398d86(0x12d));const _0x2e07a4=this[_0x398d86(0x113)][_0x398d86(0x145)](','),_0x1d6dc2=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x2e07a4,_0x36523c=await fetch(_0x1d6dc2,{'headers':{'Accept':_0x398d86(0xf9),'User-Agent':_0x398d86(0xe4)}});if(!_0x36523c['ok'])throw new Error(_0x398d86(0xff)+_0x36523c[_0x398d86(0xf3)]+'\x20'+_0x36523c[_0x398d86(0x103)]);const _0x20ee10=await _0x36523c['json']();if(!_0x20ee10[_0x398d86(0x12e)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x2b0027=_0x20ee10[_0x398d86(0x12e)];console[_0x398d86(0x107)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x398d86(0x13b)](_0x2b0027)['length']+_0x398d86(0xd1));const _0x436a84=Object[_0x398d86(0xd9)](_0x2b0027)[_0x398d86(0x122)](async([_0x5b9bad,_0xba3b8d])=>{const _0x425579=_0x398d86;try{await database_1['default']['currencyRate'][_0x425579(0xdf)]({'where':{'currency':_0x5b9bad['toLowerCase']()},'update':{'rate':_0xba3b8d},'create':{'currency':_0x5b9bad[_0x425579(0x106)](),'rate':_0xba3b8d}});}catch(_0x4e82d5){console[_0x425579(0xfa)](_0x425579(0xd4)+_0x5b9bad+':',_0x4e82d5);}});await Promise[_0x398d86(0x118)](_0x436a84),console['log'](_0x398d86(0xe8));}catch(_0x1a93dc){console[_0x398d86(0xfa)](_0x398d86(0x110),_0x1a93dc);throw _0x1a93dc;}}async[a36_0x356485(0xfc)](_0x26b9ff){const _0x1f4dee=a36_0x356485,_0x446556=_0x26b9ff['toLowerCase']();if(_0x446556===_0x1f4dee(0x10e))return 0x1;try{const _0x1548c5=await database_1[_0x1f4dee(0x105)][_0x1f4dee(0xd7)][_0x1f4dee(0x132)]({'where':{'currency':_0x446556}});if(!_0x1548c5)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x26b9ff+_0x1f4dee(0xf7)),0x1;return _0x1548c5[_0x1f4dee(0x129)];}catch(_0x8add94){return console[_0x1f4dee(0xfa)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x26b9ff+':',_0x8add94),0x1;}}async[a36_0x356485(0xd5)](_0x4fa0c0,_0x524af5){const _0x4814c6=a36_0x356485,_0x242f0a=_0x524af5[_0x4814c6(0x106)]();if(_0x242f0a===_0x4814c6(0x10e)){const _0x318d15=_0x4fa0c0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4814c6(0x107)]('üí±\x20Applied\x20'+this[_0x4814c6(0x111)]+_0x4814c6(0x124)+_0x4fa0c0+_0x4814c6(0x130)+_0x318d15['toFixed'](0x6)+_0x4814c6(0x143)),_0x318d15;}try{const _0x2ba8f7=await this[_0x4814c6(0xfc)](_0x242f0a),_0x2128c7=_0x4fa0c0/_0x2ba8f7,_0x1d988f=_0x2128c7*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x4814c6(0x114)+_0x4fa0c0+'\x20'+_0x524af5[_0x4814c6(0x10a)]()+'\x20to\x20'+_0x2128c7[_0x4814c6(0x13c)](0x6)+_0x4814c6(0xf8)+this[_0x4814c6(0x111)]+_0x4814c6(0x134)+_0x1d988f['toFixed'](0x6)+_0x4814c6(0x12c)+_0x2ba8f7+')'),_0x1d988f;}catch(_0x12fe9b){console[_0x4814c6(0xfa)](_0x4814c6(0xf1)+_0x4fa0c0+'\x20'+_0x524af5+_0x4814c6(0xdc),_0x12fe9b);const _0x3a281b=_0x4fa0c0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3a281b;}}async[a36_0x356485(0x11b)](_0x35f6aa){let _0x14d56a=0x0;for(const {amount:_0x32e8f0,currency:_0x58031a}of _0x35f6aa){const _0x20665f=await this['convertToUSDT'](_0x32e8f0,_0x58031a);_0x14d56a+=_0x20665f;}return _0x14d56a;}async['getAllRates'](){const _0x400883=a36_0x356485;try{const _0x5893e1=await database_1[_0x400883(0x105)][_0x400883(0xd7)][_0x400883(0x131)]({'select':{'currency':!![],'rate':!![]}}),_0x5938fc={'usdt':0x1};return _0x5893e1['forEach'](_0x5bfcf8=>{const _0x4ca53c=_0x400883;_0x5938fc[_0x5bfcf8[_0x4ca53c(0x123)]]=_0x5bfcf8[_0x4ca53c(0x129)];}),_0x5938fc;}catch(_0xb0d46d){return console[_0x400883(0xfa)](_0x400883(0xf0),_0xb0d46d),{'usdt':0x1};}}async['getRatesStatus'](){const _0x19fec9=a36_0x356485;try{const [_0x2ec07a,_0x14391e,_0x14892d]=await Promise[_0x19fec9(0xfd)]([database_1[_0x19fec9(0x105)][_0x19fec9(0xd7)]['count'](),database_1[_0x19fec9(0x105)]['currencyRate'][_0x19fec9(0xe2)]({'orderBy':{'updatedAt':_0x19fec9(0x11d)},'select':{'updatedAt':!![]}}),database_1[_0x19fec9(0x105)][_0x19fec9(0xd7)]['findFirst']({'orderBy':{'updatedAt':_0x19fec9(0x142)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2ec07a,'lastUpdated':_0x14391e?.[_0x19fec9(0x128)]||null,'oldestRate':_0x14892d?.[_0x19fec9(0x128)]||null,'markupPercentage':this[_0x19fec9(0x111)]};}catch(_0xd14695){return console['error']('Error\x20getting\x20rates\x20status:',_0xd14695),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0xbc2df7=a36_0x356485;return this[_0xbc2df7(0x111)];}}function a36_0x4ad9(){const _0x305653=['krw','mxn','convertMultipleToUSDT','bnb','desc','defineProperty','xlm','zar','210WLsfcu','map','currency','%\x20markup\x20to\x20','568809vCoGwD','dot','btc','updatedAt','rate','jpy','stopPeriodicUpdates','\x20USDT\x20(rate:\x20','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','tether','2454556hviaXw','\x20USDT\x20=\x20','findMany','findUnique','uah','%\x20markup\x20=\x20','__esModule','clp','mmk','2463099gQDrWi','ils','ltc','keys','toFixed','bmd','94392UUqjWA','COINGECKO_URL','ars','nzd','asc','\x20USDT','eth','join','\x20currencies','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','https://api.coingecko.com/api/v3/simple/price','Failed\x20to\x20update\x20rate\x20for\x20','convertToUSDT','twd','currencyRate','link','entries','huf','gel','\x20to\x20USDT:','sar','updateCurrencyRates','upsert','dkk','aed','findFirst','myr','TesSoft\x20Payment\x20System/1.0','xau','sek','Initial\x20currency\x20rates\x20update\x20failed:','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','2xHDxlT','vnd','currencyService','gbp','catch','xrp','pln','Error\x20getting\x20all\x20rates:','Error\x20converting\x20','thb','status','vef','12amQBbn','753605yUDyDV',',\x20using\x201\x20as\x20fallback','\x20USDT,\x20with\x20','application/json','error','czk','getCurrencyRate','all','ngn','CoinGecko\x20API\x20error:\x20','sgd','startPeriodicUpdates','CurrencyService','statusText','php','default','toLowerCase','log','541695DQcbLZ','brl','toUpperCase','3254848PXxsMv','kwd','nok','usdt','updateInterval','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','MARKUP_PERCENTAGE','rub','CURRENCIES','üí±\x20Converted\x20','inr','chf','../config/database','allSettled'];a36_0x4ad9=function(){return _0x305653;};return a36_0x4ad9();}exports[a36_0x356485(0x102)]=CurrencyService,exports['currencyService']=new CurrencyService();