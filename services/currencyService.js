'use strict';const a49_0x4f0baf=a49_0x18fa;(function(_0x585a18,_0x200694){const _0x7c77ca=a49_0x18fa,_0xfeb7e5=_0x585a18();while(!![]){try{const _0x45d76e=-parseInt(_0x7c77ca(0x1a2))/0x1+-parseInt(_0x7c77ca(0x1d6))/0x2*(-parseInt(_0x7c77ca(0x1c5))/0x3)+-parseInt(_0x7c77ca(0x1d9))/0x4*(-parseInt(_0x7c77ca(0x197))/0x5)+-parseInt(_0x7c77ca(0x1af))/0x6*(parseInt(_0x7c77ca(0x1e9))/0x7)+-parseInt(_0x7c77ca(0x1f3))/0x8*(-parseInt(_0x7c77ca(0x1c9))/0x9)+-parseInt(_0x7c77ca(0x209))/0xa+parseInt(_0x7c77ca(0x1b0))/0xb;if(_0x45d76e===_0x200694)break;else _0xfeb7e5['push'](_0xfeb7e5['shift']());}catch(_0x5274f1){_0xfeb7e5['push'](_0xfeb7e5['shift']());}}}(a49_0x1d72,0xc60a3));function a49_0x18fa(_0xe7cb43,_0x14e2dc){_0xe7cb43=_0xe7cb43-0x18f;const _0x1d72ad=a49_0x1d72();let _0x18fa1b=_0x1d72ad[_0xe7cb43];return _0x18fa1b;}var __importDefault=this&&this[a49_0x4f0baf(0x1b7)]||function(_0x8d93ad){const _0x39253c=a49_0x4f0baf;return _0x8d93ad&&_0x8d93ad[_0x39253c(0x1fa)]?_0x8d93ad:{'default':_0x8d93ad};};Object['defineProperty'](exports,a49_0x4f0baf(0x1fa),{'value':!![]}),exports['currencyService']=exports[a49_0x4f0baf(0x1db)]=void 0x0;function a49_0x1d72(){const _0xd0c6b6=['upsert','warn','clp','9144NQKieb','17348727muKTRZ','toLowerCase','btc','tether','desc','sats','lkr','__importDefault','keys','nok','MARKUP_PERCENTAGE','brl','Error\x20getting\x20rates\x20status:','xag','getCurrencyRate','\x20USDT\x20=\x20','link','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','twd','sek','getMarkupPercentage','3096906BMpuWi','findFirst','mmk','updatedAt','441MlwBKJ','ars','eur','statusText','length','dot','âœ…\x20Currency\x20rates\x20updated\x20successfully','hkd','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','bch','aed','Error\x20getting\x20all\x20rates:','dkk','2mMFqqG','\x20USDT\x20(rate:\x20','cny','465716jdOhNc','bnb','CurrencyService','uah','ðŸ’±\x20Applied\x20','findMany','currencyService','stopPeriodicUpdates','inr','bits','Error\x20getting\x20rate\x20for\x20currency\x20','kwd','convertToUSDT','usdt','rub','\x20currencies','6881zotXxy','No\x20rate\x20found\x20for\x20currency:\x20','usd','CURRENCIES','asc','aud','xlm','updateCurrencyRates','gbp','chf','72120KHUBAp','default','thb','toFixed','zar','https://api.coingecko.com/api/v3/simple/price','eth','__esModule','nzd','yfi','ltc','COINGECKO_URL','mxn','ngn','startPeriodicUpdates','map','sar','getRatesStatus','sgd','ðŸ“Š\x20Received\x20rates\x20for\x20','error','../config/database','6043080KTRecp','allSettled','catch','getAllRates','all','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','log','Failed\x20to\x20update\x20rate\x20for\x20','xau','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','php','60FFnuMU','krw','Payment\x20System/1.0','Error\x20converting\x20','idr','application/json','updateInterval','rate','CoinGecko\x20API\x20error:\x20','bmd','xrp','1534771csaftc','eos','vef','currencyRate','xdr','currency','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','ðŸ’±\x20Converted\x20','czk','myr'];a49_0x1d72=function(){return _0xd0c6b6;};return a49_0x1d72();}const database_1=__importDefault(require(a49_0x4f0baf(0x208)));class CurrencyService{constructor(){const _0x440e73=a49_0x4f0baf;this[_0x440e73(0x1fe)]=_0x440e73(0x1f8),this[_0x440e73(0x1ec)]=[_0x440e73(0x1b2),_0x440e73(0x1f9),_0x440e73(0x1fd),_0x440e73(0x1d2),_0x440e73(0x1da),_0x440e73(0x1a3),_0x440e73(0x1a1),_0x440e73(0x1ef),_0x440e73(0x1c0),_0x440e73(0x1ce),_0x440e73(0x1fc),_0x440e73(0x1eb),_0x440e73(0x1d3),_0x440e73(0x1ca),_0x440e73(0x1ee),'bdt','bhd',_0x440e73(0x1a0),_0x440e73(0x1bb),'cad',_0x440e73(0x1f2),_0x440e73(0x1ae),_0x440e73(0x1d8),_0x440e73(0x1aa),_0x440e73(0x1d5),_0x440e73(0x1cb),_0x440e73(0x1f1),'gel',_0x440e73(0x1d0),'huf',_0x440e73(0x19b),'ils',_0x440e73(0x1e1),'jpy',_0x440e73(0x198),_0x440e73(0x1e4),_0x440e73(0x1b6),_0x440e73(0x1c7),_0x440e73(0x1ff),_0x440e73(0x1ab),_0x440e73(0x200),_0x440e73(0x1b9),_0x440e73(0x1fb),_0x440e73(0x196),'pkr','pln',_0x440e73(0x1e7),_0x440e73(0x203),_0x440e73(0x1c3),_0x440e73(0x205),_0x440e73(0x1f5),'try',_0x440e73(0x1c2),_0x440e73(0x1dc),_0x440e73(0x1a4),'vnd',_0x440e73(0x1f7),_0x440e73(0x1a6),_0x440e73(0x1bd),_0x440e73(0x194),_0x440e73(0x1e2),_0x440e73(0x1b5)],this['updateInterval']=null,this[_0x440e73(0x1ba)]=-0x3,this[_0x440e73(0x201)]();}['startPeriodicUpdates'](){const _0x10237b=a49_0x4f0baf;this[_0x10237b(0x1f0)]()[_0x10237b(0x20b)](_0x27dae1=>{const _0x11d034=_0x10237b;console[_0x11d034(0x207)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x27dae1);}),this[_0x10237b(0x19d)]=setInterval(async()=>{try{await this['updateCurrencyRates']();}catch(_0x40c766){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x40c766);}},0x3c*0x3c*0x3e8),console[_0x10237b(0x192)](_0x10237b(0x1d1));}[a49_0x4f0baf(0x1e0)](){const _0x4e194d=a49_0x4f0baf;this['updateInterval']&&(clearInterval(this[_0x4e194d(0x19d)]),this[_0x4e194d(0x19d)]=null,console[_0x4e194d(0x192)](_0x4e194d(0x1a8)));}async[a49_0x4f0baf(0x1f0)](){const _0x4cc9dc=a49_0x4f0baf;try{console['log'](_0x4cc9dc(0x191));const _0x4bc919=this[_0x4cc9dc(0x1ec)]['join'](','),_0x43e157=this[_0x4cc9dc(0x1fe)]+'?ids=tether&vs_currencies='+_0x4bc919,_0x239068=await fetch(_0x43e157,{'headers':{'Accept':_0x4cc9dc(0x19c),'User-Agent':_0x4cc9dc(0x199)}});if(!_0x239068['ok'])throw new Error(_0x4cc9dc(0x19f)+_0x239068['status']+'\x20'+_0x239068[_0x4cc9dc(0x1cc)]);const _0x1bd68d=await _0x239068['json']();if(!_0x1bd68d[_0x4cc9dc(0x1b3)])throw new Error(_0x4cc9dc(0x1c1));const _0x2deac9=_0x1bd68d[_0x4cc9dc(0x1b3)];console[_0x4cc9dc(0x192)](_0x4cc9dc(0x206)+Object[_0x4cc9dc(0x1b8)](_0x2deac9)[_0x4cc9dc(0x1cd)]+_0x4cc9dc(0x1e8));const _0x4e6d91=Object['entries'](_0x2deac9)[_0x4cc9dc(0x202)](async([_0x3fe7f6,_0x4cafa9])=>{const _0x496954=_0x4cc9dc;try{await database_1[_0x496954(0x1f4)][_0x496954(0x1a5)][_0x496954(0x1ac)]({'where':{'currency':_0x3fe7f6[_0x496954(0x1b1)]()},'update':{'rate':_0x4cafa9},'create':{'currency':_0x3fe7f6[_0x496954(0x1b1)](),'rate':_0x4cafa9}});}catch(_0x24c77a){console[_0x496954(0x207)](_0x496954(0x193)+_0x3fe7f6+':',_0x24c77a);}});await Promise[_0x4cc9dc(0x20a)](_0x4e6d91),console[_0x4cc9dc(0x192)](_0x4cc9dc(0x1cf));}catch(_0x51c5fe){console[_0x4cc9dc(0x207)](_0x4cc9dc(0x195),_0x51c5fe);throw _0x51c5fe;}}async['getCurrencyRate'](_0x53079b){const _0x9e6750=a49_0x4f0baf,_0x571a7f=_0x53079b['toLowerCase']();if(_0x571a7f==='usdt')return 0x1;try{const _0x5cdd4c=await database_1[_0x9e6750(0x1f4)]['currencyRate']['findUnique']({'where':{'currency':_0x571a7f}});if(!_0x5cdd4c)return console[_0x9e6750(0x1ad)](_0x9e6750(0x1ea)+_0x53079b+',\x20using\x201\x20as\x20fallback'),0x1;return _0x5cdd4c[_0x9e6750(0x19e)];}catch(_0x1c40fc){return console[_0x9e6750(0x207)](_0x9e6750(0x1e3)+_0x53079b+':',_0x1c40fc),0x1;}}async[a49_0x4f0baf(0x1e5)](_0x5d4b59,_0x53909e){const _0x31a9cb=a49_0x4f0baf,_0x4f4dec=_0x53909e['toLowerCase']();if(_0x4f4dec===_0x31a9cb(0x1e6)){const _0x27107d=_0x5d4b59*(0x1+this[_0x31a9cb(0x1ba)]/0x64);return console[_0x31a9cb(0x192)](_0x31a9cb(0x1dd)+this[_0x31a9cb(0x1ba)]+'%\x20markup\x20to\x20'+_0x5d4b59+_0x31a9cb(0x1bf)+_0x27107d[_0x31a9cb(0x1f6)](0x6)+'\x20USDT'),_0x27107d;}try{const _0x3f3e40=await this[_0x31a9cb(0x1be)](_0x4f4dec),_0x888969=_0x5d4b59/_0x3f3e40,_0x21ebea=_0x888969*(0x1+this[_0x31a9cb(0x1ba)]/0x64);return console[_0x31a9cb(0x192)](_0x31a9cb(0x1a9)+_0x5d4b59+'\x20'+_0x53909e['toUpperCase']()+'\x20to\x20'+_0x888969[_0x31a9cb(0x1f6)](0x6)+'\x20USDT,\x20with\x20'+this[_0x31a9cb(0x1ba)]+'%\x20markup\x20=\x20'+_0x21ebea[_0x31a9cb(0x1f6)](0x6)+_0x31a9cb(0x1d7)+_0x3f3e40+')'),_0x21ebea;}catch(_0x480763){console['error'](_0x31a9cb(0x19a)+_0x5d4b59+'\x20'+_0x53909e+'\x20to\x20USDT:',_0x480763);const _0x49accc=_0x5d4b59*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x49accc;}}async['convertMultipleToUSDT'](_0x481e76){const _0x5849c8=a49_0x4f0baf;let _0x4ab3b9=0x0;for(const {amount:_0x4c2ed5,currency:_0x5c7742}of _0x481e76){const _0x53761f=await this[_0x5849c8(0x1e5)](_0x4c2ed5,_0x5c7742);_0x4ab3b9+=_0x53761f;}return _0x4ab3b9;}async[a49_0x4f0baf(0x18f)](){const _0x322d30=a49_0x4f0baf;try{const _0x3c40be=await database_1[_0x322d30(0x1f4)][_0x322d30(0x1a5)][_0x322d30(0x1de)]({'select':{'currency':!![],'rate':!![]}}),_0x521540={'usdt':0x1};return _0x3c40be['forEach'](_0x3a6904=>{const _0x7b2f10=_0x322d30;_0x521540[_0x3a6904[_0x7b2f10(0x1a7)]]=_0x3a6904[_0x7b2f10(0x19e)];}),_0x521540;}catch(_0x3e7018){return console[_0x322d30(0x207)](_0x322d30(0x1d4),_0x3e7018),{'usdt':0x1};}}async[a49_0x4f0baf(0x204)](){const _0x8e399c=a49_0x4f0baf;try{const [_0x346f13,_0x27a2cd,_0x252fe9]=await Promise[_0x8e399c(0x190)]([database_1['default'][_0x8e399c(0x1a5)]['count'](),database_1[_0x8e399c(0x1f4)]['currencyRate'][_0x8e399c(0x1c6)]({'orderBy':{'updatedAt':_0x8e399c(0x1b4)},'select':{'updatedAt':!![]}}),database_1[_0x8e399c(0x1f4)][_0x8e399c(0x1a5)][_0x8e399c(0x1c6)]({'orderBy':{'updatedAt':_0x8e399c(0x1ed)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x346f13,'lastUpdated':_0x27a2cd?.[_0x8e399c(0x1c8)]||null,'oldestRate':_0x252fe9?.[_0x8e399c(0x1c8)]||null,'markupPercentage':this[_0x8e399c(0x1ba)]};}catch(_0x5278bd){return console['error'](_0x8e399c(0x1bc),_0x5278bd),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a49_0x4f0baf(0x1c4)](){const _0x1f6de2=a49_0x4f0baf;return this[_0x1f6de2(0x1ba)];}}exports['CurrencyService']=CurrencyService,exports[a49_0x4f0baf(0x1df)]=new CurrencyService();