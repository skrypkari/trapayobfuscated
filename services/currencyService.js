'use strict';const a38_0x25aa17=a38_0x432b;(function(_0x212499,_0x354401){const _0x2eddd0=a38_0x432b,_0x437d7f=_0x212499();while(!![]){try{const _0x2b3b3d=-parseInt(_0x2eddd0(0x1a8))/0x1*(-parseInt(_0x2eddd0(0x169))/0x2)+parseInt(_0x2eddd0(0x1a5))/0x3+-parseInt(_0x2eddd0(0x197))/0x4+-parseInt(_0x2eddd0(0x15c))/0x5+-parseInt(_0x2eddd0(0x1a4))/0x6*(parseInt(_0x2eddd0(0x182))/0x7)+parseInt(_0x2eddd0(0x145))/0x8+parseInt(_0x2eddd0(0x18e))/0x9;if(_0x2b3b3d===_0x354401)break;else _0x437d7f['push'](_0x437d7f['shift']());}catch(_0x225e5e){_0x437d7f['push'](_0x437d7f['shift']());}}}(a38_0x1e8b,0x751d2));var __importDefault=this&&this[a38_0x25aa17(0x1b7)]||function(_0x40be5b){return _0x40be5b&&_0x40be5b['__esModule']?_0x40be5b:{'default':_0x40be5b};};Object[a38_0x25aa17(0x17f)](exports,'__esModule',{'value':!![]}),exports[a38_0x25aa17(0x167)]=exports[a38_0x25aa17(0x181)]=void 0x0;function a38_0x432b(_0x51c91a,_0xb3fb88){const _0x1e8bb9=a38_0x1e8b();return a38_0x432b=function(_0x432bea,_0x5929c0){_0x432bea=_0x432bea-0x140;let _0x2fa202=_0x1e8bb9[_0x432bea];return _0x2fa202;},a38_0x432b(_0x51c91a,_0xb3fb88);}const database_1=__importDefault(require(a38_0x25aa17(0x189)));class CurrencyService{constructor(){const _0x5518be=a38_0x25aa17;this[_0x5518be(0x15b)]=_0x5518be(0x146),this[_0x5518be(0x171)]=[_0x5518be(0x1ac),_0x5518be(0x172),_0x5518be(0x1ae),'bch',_0x5518be(0x1b3),_0x5518be(0x173),_0x5518be(0x175),_0x5518be(0x153),_0x5518be(0x17c),_0x5518be(0x1ba),_0x5518be(0x1a2),_0x5518be(0x198),_0x5518be(0x141),_0x5518be(0x155),_0x5518be(0x164),_0x5518be(0x183),_0x5518be(0x19f),_0x5518be(0x19c),_0x5518be(0x159),_0x5518be(0x1b6),'chf','clp',_0x5518be(0x1ab),_0x5518be(0x1a6),_0x5518be(0x19e),'eur',_0x5518be(0x15e),_0x5518be(0x177),_0x5518be(0x1aa),'huf',_0x5518be(0x158),_0x5518be(0x18a),_0x5518be(0x1a3),_0x5518be(0x1b2),_0x5518be(0x186),_0x5518be(0x154),'lkr',_0x5518be(0x148),_0x5518be(0x1b5),'myr',_0x5518be(0x188),_0x5518be(0x149),_0x5518be(0x16d),_0x5518be(0x196),'pkr',_0x5518be(0x192),_0x5518be(0x1a9),'sar',_0x5518be(0x152),_0x5518be(0x165),_0x5518be(0x19b),_0x5518be(0x194),_0x5518be(0x161),'uah',_0x5518be(0x18d),'vnd',_0x5518be(0x14e),_0x5518be(0x15a),_0x5518be(0x1a0),_0x5518be(0x195),_0x5518be(0x1bb),_0x5518be(0x18c)],this[_0x5518be(0x176)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x5518be(0x178)]();}[a38_0x25aa17(0x178)](){const _0x40d576=a38_0x25aa17;this[_0x40d576(0x1b4)]()['catch'](_0x475cc9=>{const _0x52beb9=_0x40d576;console[_0x52beb9(0x17b)](_0x52beb9(0x1bd),_0x475cc9);}),this[_0x40d576(0x176)]=setInterval(async()=>{const _0xc383e5=_0x40d576;try{await this[_0xc383e5(0x1b4)]();}catch(_0x56545b){console[_0xc383e5(0x17b)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x56545b);}},0x3c*0x3c*0x3e8),console[_0x40d576(0x147)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x25aa17(0x1af)](){const _0x48dca2=a38_0x25aa17;this[_0x48dca2(0x176)]&&(clearInterval(this[_0x48dca2(0x176)]),this[_0x48dca2(0x176)]=null,console['log'](_0x48dca2(0x17a)));}async[a38_0x25aa17(0x1b4)](){const _0x9e4cae=a38_0x25aa17;try{console[_0x9e4cae(0x147)](_0x9e4cae(0x179));const _0x3851cc=this[_0x9e4cae(0x171)]['join'](','),_0x335930=this['COINGECKO_URL']+_0x9e4cae(0x19a)+_0x3851cc,_0x2ababd=await fetch(_0x335930,{'headers':{'Accept':_0x9e4cae(0x1a1),'User-Agent':_0x9e4cae(0x1b9)}});if(!_0x2ababd['ok'])throw new Error(_0x9e4cae(0x187)+_0x2ababd[_0x9e4cae(0x1a7)]+'\x20'+_0x2ababd[_0x9e4cae(0x184)]);const _0xfb6f27=await _0x2ababd['json']();if(!_0xfb6f27[_0x9e4cae(0x170)])throw new Error(_0x9e4cae(0x193));const _0x14e90b=_0xfb6f27[_0x9e4cae(0x170)];console['log'](_0x9e4cae(0x16f)+Object[_0x9e4cae(0x15f)](_0x14e90b)[_0x9e4cae(0x140)]+_0x9e4cae(0x174));const _0x5682e3=Object[_0x9e4cae(0x160)](_0x14e90b)[_0x9e4cae(0x199)](async([_0x5b15bd,_0x1e2ae9])=>{const _0x5a103e=_0x9e4cae;try{await database_1[_0x5a103e(0x1b1)][_0x5a103e(0x16e)][_0x5a103e(0x191)]({'where':{'currency':_0x5b15bd['toLowerCase']()},'update':{'rate':_0x1e2ae9},'create':{'currency':_0x5b15bd[_0x5a103e(0x1bc)](),'rate':_0x1e2ae9}});}catch(_0x1b73e4){console[_0x5a103e(0x17b)](_0x5a103e(0x163)+_0x5b15bd+':',_0x1b73e4);}});await Promise['allSettled'](_0x5682e3),console[_0x9e4cae(0x147)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x36a7e4){console['error'](_0x9e4cae(0x14b),_0x36a7e4);throw _0x36a7e4;}}async[a38_0x25aa17(0x16b)](_0x345a69){const _0x2cf27e=a38_0x25aa17,_0x4a48e0=_0x345a69['toLowerCase']();if(_0x4a48e0===_0x2cf27e(0x157))return 0x1;try{const _0xcadc1f=await database_1['default'][_0x2cf27e(0x16e)]['findUnique']({'where':{'currency':_0x4a48e0}});if(!_0xcadc1f)return console['warn'](_0x2cf27e(0x1b0)+_0x345a69+_0x2cf27e(0x156)),0x1;return _0xcadc1f[_0x2cf27e(0x1ad)];}catch(_0x58b267){return console[_0x2cf27e(0x17b)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x345a69+':',_0x58b267),0x1;}}async[a38_0x25aa17(0x142)](_0x4918b4,_0x59584c){const _0x584f6e=a38_0x25aa17,_0x50edfb=_0x59584c['toLowerCase']();if(_0x50edfb===_0x584f6e(0x157)){const _0x31fd0f=_0x4918b4*(0x1+this[_0x584f6e(0x14d)]/0x64);return console[_0x584f6e(0x147)](_0x584f6e(0x190)+this[_0x584f6e(0x14d)]+_0x584f6e(0x14a)+_0x4918b4+_0x584f6e(0x16c)+_0x31fd0f[_0x584f6e(0x15d)](0x6)+_0x584f6e(0x151)),_0x31fd0f;}try{const _0x34e75a=await this[_0x584f6e(0x16b)](_0x50edfb),_0xc3a31=_0x4918b4/_0x34e75a,_0x14dd61=_0xc3a31*(0x1+this[_0x584f6e(0x14d)]/0x64);return console[_0x584f6e(0x147)](_0x584f6e(0x150)+_0x4918b4+'\x20'+_0x59584c['toUpperCase']()+'\x20to\x20'+_0xc3a31[_0x584f6e(0x15d)](0x6)+'\x20USDT,\x20with\x20'+this[_0x584f6e(0x14d)]+_0x584f6e(0x185)+_0x14dd61[_0x584f6e(0x15d)](0x6)+_0x584f6e(0x14c)+_0x34e75a+')'),_0x14dd61;}catch(_0x504a13){console[_0x584f6e(0x17b)]('Error\x20converting\x20'+_0x4918b4+'\x20'+_0x59584c+_0x584f6e(0x18f),_0x504a13);const _0x346754=_0x4918b4*(0x1+this[_0x584f6e(0x14d)]/0x64);return _0x346754;}}async[a38_0x25aa17(0x168)](_0x346710){const _0x5af148=a38_0x25aa17;let _0x1c5b8b=0x0;for(const {amount:_0x175cb3,currency:_0x5d8e22}of _0x346710){const _0x1f2436=await this[_0x5af148(0x142)](_0x175cb3,_0x5d8e22);_0x1c5b8b+=_0x1f2436;}return _0x1c5b8b;}async['getAllRates'](){const _0x98015b=a38_0x25aa17;try{const _0x19aaeb=await database_1[_0x98015b(0x1b1)][_0x98015b(0x16e)][_0x98015b(0x17d)]({'select':{'currency':!![],'rate':!![]}}),_0x47e1b7={'usdt':0x1};return _0x19aaeb[_0x98015b(0x144)](_0x2c1048=>{const _0x15d1e1=_0x98015b;_0x47e1b7[_0x2c1048[_0x15d1e1(0x16a)]]=_0x2c1048[_0x15d1e1(0x1ad)];}),_0x47e1b7;}catch(_0x4025ec){return console['error'](_0x98015b(0x166),_0x4025ec),{'usdt':0x1};}}async[a38_0x25aa17(0x18b)](){const _0x362caa=a38_0x25aa17;try{const [_0x4efa06,_0x31badf,_0xd4c5a1]=await Promise['all']([database_1[_0x362caa(0x1b1)]['currencyRate'][_0x362caa(0x180)](),database_1[_0x362caa(0x1b1)][_0x362caa(0x16e)][_0x362caa(0x162)]({'orderBy':{'updatedAt':_0x362caa(0x19d)},'select':{'updatedAt':!![]}}),database_1['default'][_0x362caa(0x16e)][_0x362caa(0x162)]({'orderBy':{'updatedAt':_0x362caa(0x1b8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4efa06,'lastUpdated':_0x31badf?.[_0x362caa(0x17e)]||null,'oldestRate':_0xd4c5a1?.[_0x362caa(0x17e)]||null,'markupPercentage':this[_0x362caa(0x14d)]};}catch(_0x218222){return console[_0x362caa(0x17b)](_0x362caa(0x14f),_0x218222),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x362caa(0x14d)]};}}[a38_0x25aa17(0x143)](){const _0x24163a=a38_0x25aa17;return this[_0x24163a(0x14d)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x25aa17(0x167)]=new CurrencyService();function a38_0x1e8b(){const _0x9b55b6=['usd','map','?ids=tether&vs_currencies=','thb','bmd','desc','dkk','bhd','xag','application/json','yfi','inr','2316lEOGxJ','2851917mbvCPl','czk','status','65MhjqfB','rub','hkd','cny','btc','rate','ltc','stopPeriodicUpdates','No\x20rate\x20found\x20for\x20currency:\x20','default','jpy','bnb','updateCurrencyRates','mxn','cad','__importDefault','asc','TesSoft\x20Payment\x20System/1.0','dot','bits','toLowerCase','Initial\x20currency\x20rates\x20update\x20failed:','length','aed','convertToUSDT','getMarkupPercentage','forEach','1091032tySJMW','https://api.coingecko.com/api/v3/simple/price','log','mmk','nok','%\x20markup\x20to\x20','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','\x20USDT\x20(rate:\x20','MARKUP_PERCENTAGE','zar','Error\x20getting\x20rates\x20status:','üí±\x20Converted\x20','\x20USDT','sek','xlm','kwd','ars',',\x20using\x201\x20as\x20fallback','usdt','idr','brl','xdr','COINGECKO_URL','1609105eMSHGO','toFixed','gbp','keys','entries','twd','findFirst','Failed\x20to\x20update\x20rate\x20for\x20','aud','sgd','Error\x20getting\x20all\x20rates:','currencyService','convertMultipleToUSDT','17710CicCqv','currency','getCurrencyRate','\x20USDT\x20=\x20','nzd','currencyRate','üìä\x20Received\x20rates\x20for\x20','tether','CURRENCIES','eth','eos','\x20currencies','xrp','updateInterval','gel','startPeriodicUpdates','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','error','link','findMany','updatedAt','defineProperty','count','CurrencyService','7259ftdPnW','bdt','statusText','%\x20markup\x20=\x20','krw','CoinGecko\x20API\x20error:\x20','ngn','../config/database','ils','getRatesStatus','sats','vef','2460798aDXHhk','\x20to\x20USDT:','üí±\x20Applied\x20','upsert','pln','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','try','xau','php','2936856lWMrWT'];a38_0x1e8b=function(){return _0x9b55b6;};return a38_0x1e8b();}