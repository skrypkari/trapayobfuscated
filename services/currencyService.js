'use strict';const a58_0x13277e=a58_0x18c0;(function(_0x364552,_0x746d0e){const _0x10f557=a58_0x18c0,_0x9c3828=_0x364552();while(!![]){try{const _0x168ce6=parseInt(_0x10f557(0x17c))/0x1+parseInt(_0x10f557(0x136))/0x2+parseInt(_0x10f557(0x159))/0x3+parseInt(_0x10f557(0x144))/0x4+parseInt(_0x10f557(0x125))/0x5+-parseInt(_0x10f557(0x13f))/0x6+parseInt(_0x10f557(0x145))/0x7*(-parseInt(_0x10f557(0x15b))/0x8);if(_0x168ce6===_0x746d0e)break;else _0x9c3828['push'](_0x9c3828['shift']());}catch(_0x2bc96a){_0x9c3828['push'](_0x9c3828['shift']());}}}(a58_0x814b,0x8be24));var __importDefault=this&&this[a58_0x13277e(0x160)]||function(_0x4f0b76){return _0x4f0b76&&_0x4f0b76['__esModule']?_0x4f0b76:{'default':_0x4f0b76};};Object[a58_0x13277e(0x133)](exports,a58_0x13277e(0x184),{'value':!![]}),exports[a58_0x13277e(0x148)]=exports[a58_0x13277e(0x194)]=void 0x0;const database_1=__importDefault(require(a58_0x13277e(0x154)));class CurrencyService{constructor(){const _0x2cfbe3=a58_0x13277e;this[_0x2cfbe3(0x149)]=_0x2cfbe3(0x19a),this[_0x2cfbe3(0x166)]=[_0x2cfbe3(0x161),_0x2cfbe3(0x16b),_0x2cfbe3(0x18f),_0x2cfbe3(0x177),_0x2cfbe3(0x19e),_0x2cfbe3(0x162),'xrp',_0x2cfbe3(0x189),_0x2cfbe3(0x188),_0x2cfbe3(0x175),_0x2cfbe3(0x132),_0x2cfbe3(0x197),_0x2cfbe3(0x129),_0x2cfbe3(0x180),_0x2cfbe3(0x18e),'bdt',_0x2cfbe3(0x126),_0x2cfbe3(0x158),_0x2cfbe3(0x153),'cad',_0x2cfbe3(0x16f),_0x2cfbe3(0x12e),_0x2cfbe3(0x143),_0x2cfbe3(0x1a2),_0x2cfbe3(0x19c),_0x2cfbe3(0x15e),_0x2cfbe3(0x152),_0x2cfbe3(0x191),_0x2cfbe3(0x127),_0x2cfbe3(0x14f),_0x2cfbe3(0x142),_0x2cfbe3(0x19f),_0x2cfbe3(0x13d),_0x2cfbe3(0x150),'krw','kwd',_0x2cfbe3(0x168),'mmk','mxn',_0x2cfbe3(0x14e),_0x2cfbe3(0x141),_0x2cfbe3(0x137),_0x2cfbe3(0x139),'php',_0x2cfbe3(0x12a),_0x2cfbe3(0x15c),'rub','sar',_0x2cfbe3(0x163),_0x2cfbe3(0x17f),'thb',_0x2cfbe3(0x1a1),_0x2cfbe3(0x1a3),'uah',_0x2cfbe3(0x15f),_0x2cfbe3(0x123),_0x2cfbe3(0x12d),_0x2cfbe3(0x17d),_0x2cfbe3(0x12c),_0x2cfbe3(0x199),_0x2cfbe3(0x181),'sats'],this[_0x2cfbe3(0x135)]=null,this['MARKUP_PERCENTAGE']=-0x3,this['startPeriodicUpdates']();}[a58_0x13277e(0x198)](){const _0x1821c1=a58_0x13277e;this[_0x1821c1(0x183)]()[_0x1821c1(0x155)](_0xb0827c=>{const _0xc1f7c1=_0x1821c1;console['error'](_0xc1f7c1(0x179),_0xb0827c);}),this[_0x1821c1(0x135)]=setInterval(async()=>{try{await this['updateCurrencyRates']();}catch(_0x2f52bb){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x2f52bb);}},0x3c*0x3c*0x3e8),console[_0x1821c1(0x190)](_0x1821c1(0x1a0));}['stopPeriodicUpdates'](){const _0x37e426=a58_0x13277e;this[_0x37e426(0x135)]&&(clearInterval(this[_0x37e426(0x135)]),this[_0x37e426(0x135)]=null,console[_0x37e426(0x190)](_0x37e426(0x14a)));}async[a58_0x13277e(0x183)](){const _0x3c3219=a58_0x13277e;try{console[_0x3c3219(0x190)](_0x3c3219(0x147));const _0x13be9d=this[_0x3c3219(0x166)][_0x3c3219(0x176)](','),_0x2960f0=this[_0x3c3219(0x149)]+_0x3c3219(0x167)+_0x13be9d,_0x375626=await fetch(_0x2960f0,{'headers':{'Accept':_0x3c3219(0x124),'User-Agent':_0x3c3219(0x13c)}});if(!_0x375626['ok'])throw new Error(_0x3c3219(0x156)+_0x375626[_0x3c3219(0x12f)]+'\x20'+_0x375626['statusText']);const _0x24004f=await _0x375626[_0x3c3219(0x165)]();if(!_0x24004f['tether'])throw new Error(_0x3c3219(0x17b));const _0x15aabb=_0x24004f['tether'];console[_0x3c3219(0x190)](_0x3c3219(0x14c)+Object['keys'](_0x15aabb)[_0x3c3219(0x16d)]+_0x3c3219(0x170));const _0x43865f=0x5,_0x28c274=Object[_0x3c3219(0x172)](_0x15aabb);for(let _0x4440cf=0x0;_0x4440cf<_0x28c274[_0x3c3219(0x16d)];_0x4440cf+=_0x43865f){const _0x84a8c0=_0x28c274[_0x3c3219(0x12b)](_0x4440cf,_0x4440cf+_0x43865f),_0x4ac35d=_0x84a8c0[_0x3c3219(0x13b)](async([_0x38cb1c,_0x37bbe8])=>{const _0x39d0e0=_0x3c3219;try{await database_1[_0x39d0e0(0x185)]['currencyRate'][_0x39d0e0(0x134)]({'where':{'currency':_0x38cb1c[_0x39d0e0(0x18b)]()},'update':{'rate':_0x37bbe8},'create':{'currency':_0x38cb1c[_0x39d0e0(0x18b)](),'rate':_0x37bbe8}});}catch(_0x4143e9){console[_0x39d0e0(0x130)](_0x39d0e0(0x16c)+_0x38cb1c+':',_0x4143e9);}});await Promise[_0x3c3219(0x13a)](_0x4ac35d);}console['log']('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0xfa4a81){console[_0x3c3219(0x130)](_0x3c3219(0x15a),_0xfa4a81);throw _0xfa4a81;}}async[a58_0x13277e(0x13e)](_0xd031fe){const _0x3b4cd9=a58_0x13277e,_0x2e3218=_0xd031fe[_0x3b4cd9(0x18b)]();if(_0x2e3218==='usdt')return 0x1;try{const _0x2c6ee4=await database_1[_0x3b4cd9(0x185)][_0x3b4cd9(0x18c)][_0x3b4cd9(0x14b)]({'where':{'currency':_0x2e3218}});if(!_0x2c6ee4)return console[_0x3b4cd9(0x186)](_0x3b4cd9(0x195)+_0xd031fe+_0x3b4cd9(0x193)),0x1;return _0x2c6ee4[_0x3b4cd9(0x140)];}catch(_0x5d2813){return console[_0x3b4cd9(0x130)](_0x3b4cd9(0x169)+_0xd031fe+':',_0x5d2813),0x1;}}async[a58_0x13277e(0x192)](_0x92aadf,_0x8afff2){const _0x1d6816=a58_0x13277e,_0x5b7d60=_0x8afff2[_0x1d6816(0x18b)]();if(_0x5b7d60==='usdt'){const _0x3255e0=_0x92aadf*(0x1+this[_0x1d6816(0x18a)]/0x64);return console[_0x1d6816(0x190)](_0x1d6816(0x157)+this[_0x1d6816(0x18a)]+'%\x20markup\x20to\x20'+_0x92aadf+_0x1d6816(0x187)+_0x3255e0[_0x1d6816(0x131)](0x6)+'\x20USDT'),_0x3255e0;}try{const _0x117a44=await this[_0x1d6816(0x13e)](_0x5b7d60),_0xadbb5=_0x92aadf/_0x117a44,_0x510f92=_0xadbb5*(0x1+this[_0x1d6816(0x18a)]/0x64);return console['log'](_0x1d6816(0x173)+_0x92aadf+'\x20'+_0x8afff2[_0x1d6816(0x164)]()+'\x20to\x20'+_0xadbb5[_0x1d6816(0x131)](0x6)+_0x1d6816(0x171)+this[_0x1d6816(0x18a)]+_0x1d6816(0x16e)+_0x510f92[_0x1d6816(0x131)](0x6)+'\x20USDT\x20(rate:\x20'+_0x117a44+')'),_0x510f92;}catch(_0xb93b71){console[_0x1d6816(0x130)](_0x1d6816(0x146)+_0x92aadf+'\x20'+_0x8afff2+_0x1d6816(0x17e),_0xb93b71);const _0x456dc0=_0x92aadf*(0x1+this[_0x1d6816(0x18a)]/0x64);return _0x456dc0;}}async[a58_0x13277e(0x128)](_0x3cbd69){let _0x3fa8c5=0x0;for(const {amount:_0x184b11,currency:_0x47837c}of _0x3cbd69){const _0x37553f=await this['convertToUSDT'](_0x184b11,_0x47837c);_0x3fa8c5+=_0x37553f;}return _0x3fa8c5;}async[a58_0x13277e(0x19b)](){const _0x32aaeb=a58_0x13277e;try{const _0x22e13c=await database_1[_0x32aaeb(0x185)][_0x32aaeb(0x18c)][_0x32aaeb(0x196)]({'select':{'currency':!![],'rate':!![]}}),_0x131c9f={'usdt':0x1};return _0x22e13c[_0x32aaeb(0x17a)](_0x590075=>{const _0x5579b0=_0x32aaeb;_0x131c9f[_0x590075[_0x5579b0(0x16a)]]=_0x590075['rate'];}),_0x131c9f;}catch(_0x51206b){return console[_0x32aaeb(0x130)](_0x32aaeb(0x15d),_0x51206b),{'usdt':0x1};}}async[a58_0x13277e(0x151)](){const _0x43b0ed=a58_0x13277e;try{const [_0x2c8503,_0x428da8,_0x324d0c]=await Promise[_0x43b0ed(0x13a)]([database_1['default'][_0x43b0ed(0x18c)][_0x43b0ed(0x174)](),database_1[_0x43b0ed(0x185)][_0x43b0ed(0x18c)][_0x43b0ed(0x14d)]({'orderBy':{'updatedAt':_0x43b0ed(0x19d)},'select':{'updatedAt':!![]}}),database_1[_0x43b0ed(0x185)][_0x43b0ed(0x18c)][_0x43b0ed(0x14d)]({'orderBy':{'updatedAt':_0x43b0ed(0x18d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2c8503,'lastUpdated':_0x428da8?.[_0x43b0ed(0x182)]||null,'oldestRate':_0x324d0c?.['updatedAt']||null,'markupPercentage':this[_0x43b0ed(0x18a)]};}catch(_0x321db9){return console[_0x43b0ed(0x130)](_0x43b0ed(0x138),_0x321db9),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x43b0ed(0x18a)]};}}[a58_0x13277e(0x178)](){const _0xe8832b=a58_0x13277e;return this[_0xe8832b(0x18a)];}}exports['CurrencyService']=CurrencyService,exports[a58_0x13277e(0x148)]=new CurrencyService();function a58_0x18c0(_0x230cba,_0xbb0e08){_0x230cba=_0x230cba-0x123;const _0x814bc2=a58_0x814b();let _0x18c05b=_0x814bc2[_0x230cba];return _0x18c05b;}function a58_0x814b(){const _0x8fbae1=['toUpperCase','json','CURRENCIES','?ids=tether&vs_currencies=','lkr','Error\x20getting\x20rate\x20for\x20currency\x20','currency','eth','Failed\x20to\x20update\x20rate\x20for\x20','length','%\x20markup\x20=\x20','chf','\x20currencies','\x20USDT,\x20with\x20','entries','üí±\x20Converted\x20','count','dot','join','bch','getMarkupPercentage','Initial\x20currency\x20rates\x20update\x20failed:','forEach','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','1071168VBunUo','xdr','\x20to\x20USDT:','sgd','ars','bits','updatedAt','updateCurrencyRates','__esModule','default','warn','\x20USDT\x20=\x20','link','xlm','MARKUP_PERCENTAGE','toLowerCase','currencyRate','asc','aud','ltc','log','gel','convertToUSDT',',\x20using\x201\x20as\x20fallback','CurrencyService','No\x20rate\x20found\x20for\x20currency:\x20','findMany','usd','startPeriodicUpdates','xau','https://api.coingecko.com/api/v3/simple/price','getAllRates','dkk','desc','bnb','ils','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','try','czk','twd','vnd','application/json','1898060kBSGcv','bhd','hkd','convertMultipleToUSDT','aed','pkr','slice','xag','zar','clp','status','error','toFixed','yfi','defineProperty','upsert','updateInterval','2027242gzHxEV','nok','Error\x20getting\x20rates\x20status:','nzd','all','map','Payment\x20System/1.0','inr','getCurrencyRate','6088080hlQoXm','rate','ngn','idr','cny','3195584DoJFbi','25508VXtaKw','Error\x20converting\x20','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','currencyService','COINGECKO_URL','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','findUnique','üìä\x20Received\x20rates\x20for\x20','findFirst','myr','huf','jpy','getRatesStatus','gbp','brl','../config/database','catch','CoinGecko\x20API\x20error:\x20','üí±\x20Applied\x20','bmd','3029925pqPsTi','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','5896mWOvrx','pln','Error\x20getting\x20all\x20rates:','eur','vef','__importDefault','btc','eos','sek'];a58_0x814b=function(){return _0x8fbae1;};return a58_0x814b();}