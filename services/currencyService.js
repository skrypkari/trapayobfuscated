'use strict';const a58_0x3d88a6=a58_0x5e47;(function(_0xf75c24,_0x335d71){const _0x27c32b=a58_0x5e47,_0x4ce276=_0xf75c24();while(!![]){try{const _0x9eda1f=-parseInt(_0x27c32b(0x1e9))/0x1+-parseInt(_0x27c32b(0x229))/0x2+-parseInt(_0x27c32b(0x1e4))/0x3+-parseInt(_0x27c32b(0x1bb))/0x4+-parseInt(_0x27c32b(0x1f6))/0x5*(parseInt(_0x27c32b(0x1c8))/0x6)+parseInt(_0x27c32b(0x231))/0x7+parseInt(_0x27c32b(0x224))/0x8;if(_0x9eda1f===_0x335d71)break;else _0x4ce276['push'](_0x4ce276['shift']());}catch(_0x3758f){_0x4ce276['push'](_0x4ce276['shift']());}}}(a58_0x20b3,0x4c52e));function a58_0x20b3(){const _0x4d8aad=['php','catch','zar','990204TRqVLt','bch','findUnique','yfi','inr','updateCurrencyRates','twd','MARKUP_PERCENTAGE','getAllRates','ðŸ“Š\x20Received\x20rates\x20for\x20','stopPeriodicUpdates','toLowerCase','lkr','12rlhPrJ','bnb','toUpperCase','aed','%\x20markup\x20to\x20','\x20USDT\x20=\x20','updatedAt','CURRENCIES','clp','xag','Failed\x20to\x20update\x20rate\x20for\x20','xdr','entries','ltc','length','log','sats','currencyService','upsert','bits','vnd','aud','convertMultipleToUSDT','\x20currencies','mxn','tether','__esModule','uah','1826334fDTdYS','bhd','default','warn','cny','569881tiXSKx','convertToUSDT','?ids=tether&vs_currencies=','\x20USDT','keys','\x20to\x20USDT:','Initial\x20currency\x20rates\x20update\x20failed:','xrp','CurrencyService','dot','rate','CoinGecko\x20API\x20error:\x20','findFirst','507320mrvLGC','sgd','join','cad','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','sek','czk','getCurrencyRate','dkk','gel','status','getMarkupPercentage','rub','error','https://api.coingecko.com/api/v3/simple/price','pln','xau','count','__importDefault','eur','currency','thb','getRatesStatus','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20to\x20','jpy','Error\x20getting\x20all\x20rates:','currencyRate','ðŸ’±\x20Applied\x20','COINGECKO_URL','Error\x20converting\x20','vef','\x20USDT,\x20with\x20','mmk','Error\x20getting\x20rates\x20status:','eos','all','myr','startPeriodicUpdates','json','bdt','btc',',\x20using\x201\x20as\x20fallback','kwd','map','toFixed','15114888jiWrel','findMany','ngn','slice','pkr','470846YUsRVG','usdt','\x20USDT\x20(rate:\x20','updateInterval','Error\x20getting\x20rate\x20for\x20currency\x20','hkd','krw','ars','2014754AqKhrr'];a58_0x20b3=function(){return _0x4d8aad;};return a58_0x20b3();}function a58_0x5e47(_0x3505ff,_0x36f47c){_0x3505ff=_0x3505ff-0x1b8;const _0x20b39c=a58_0x20b3();let _0x5e47dd=_0x20b39c[_0x3505ff];return _0x5e47dd;}var __importDefault=this&&this[a58_0x3d88a6(0x208)]||function(_0x349d96){const _0x2c0db8=a58_0x3d88a6;return _0x349d96&&_0x349d96[_0x2c0db8(0x1e2)]?_0x349d96:{'default':_0x349d96};};Object['defineProperty'](exports,a58_0x3d88a6(0x1e2),{'value':!![]}),exports['currencyService']=exports[a58_0x3d88a6(0x1f1)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x2efe7=a58_0x3d88a6;this[_0x2efe7(0x213)]=_0x2efe7(0x204),this[_0x2efe7(0x1cf)]=[_0x2efe7(0x21f),'eth',_0x2efe7(0x1d5),_0x2efe7(0x1bc),_0x2efe7(0x1c9),_0x2efe7(0x219),_0x2efe7(0x1f0),'xlm','link',_0x2efe7(0x1f2),_0x2efe7(0x1be),'usd',_0x2efe7(0x1cb),_0x2efe7(0x230),_0x2efe7(0x1dd),_0x2efe7(0x21e),_0x2efe7(0x1e5),'bmd','brl',_0x2efe7(0x1f9),'chf',_0x2efe7(0x1d0),_0x2efe7(0x1e8),_0x2efe7(0x1fc),_0x2efe7(0x1fe),_0x2efe7(0x209),'gbp',_0x2efe7(0x1ff),_0x2efe7(0x22e),'huf','idr','ils',_0x2efe7(0x1bf),_0x2efe7(0x20f),_0x2efe7(0x22f),_0x2efe7(0x221),_0x2efe7(0x1c7),_0x2efe7(0x217),_0x2efe7(0x1e0),_0x2efe7(0x21b),_0x2efe7(0x226),'nok','nzd',_0x2efe7(0x1b8),_0x2efe7(0x228),_0x2efe7(0x205),_0x2efe7(0x202),'sar',_0x2efe7(0x1fb),_0x2efe7(0x1f7),_0x2efe7(0x20b),'try',_0x2efe7(0x1c1),_0x2efe7(0x1e3),_0x2efe7(0x215),_0x2efe7(0x1dc),_0x2efe7(0x1ba),_0x2efe7(0x1d3),_0x2efe7(0x1d1),_0x2efe7(0x206),_0x2efe7(0x1db),_0x2efe7(0x1d8)],this[_0x2efe7(0x22c)]=null,this[_0x2efe7(0x1c2)]=-0x3,this[_0x2efe7(0x21c)]();}[a58_0x3d88a6(0x21c)](){const _0x1d4b9e=a58_0x3d88a6;this[_0x1d4b9e(0x1c0)]()[_0x1d4b9e(0x1b9)](_0x125dec=>{const _0x5329e5=_0x1d4b9e;console[_0x5329e5(0x203)](_0x5329e5(0x1ef),_0x125dec);}),this['updateInterval']=setInterval(async()=>{const _0x4bf253=_0x1d4b9e;try{await this[_0x4bf253(0x1c0)]();}catch(_0x1e4c41){console[_0x4bf253(0x203)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x1e4c41);}},0x3c*0x3c*0x3e8),console[_0x1d4b9e(0x1d7)](_0x1d4b9e(0x20d));}[a58_0x3d88a6(0x1c5)](){const _0x228411=a58_0x3d88a6;this[_0x228411(0x22c)]&&(clearInterval(this[_0x228411(0x22c)]),this['updateInterval']=null,console[_0x228411(0x1d7)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a58_0x3d88a6(0x1c0)](){const _0x40f0cc=a58_0x3d88a6;try{console[_0x40f0cc(0x1d7)]('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x58f8cc=this[_0x40f0cc(0x1cf)][_0x40f0cc(0x1f8)](','),_0xd9e2af=this['COINGECKO_URL']+_0x40f0cc(0x1eb)+_0x58f8cc,_0x26afce=await fetch(_0xd9e2af,{'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}});if(!_0x26afce['ok'])throw new Error(_0x40f0cc(0x1f4)+_0x26afce[_0x40f0cc(0x200)]+'\x20'+_0x26afce['statusText']);const _0xb8e779=await _0x26afce[_0x40f0cc(0x21d)]();if(!_0xb8e779[_0x40f0cc(0x1e1)])throw new Error(_0x40f0cc(0x1fa));const _0x89fcc1=_0xb8e779[_0x40f0cc(0x1e1)];console[_0x40f0cc(0x1d7)](_0x40f0cc(0x1c4)+Object[_0x40f0cc(0x1ed)](_0x89fcc1)[_0x40f0cc(0x1d6)]+_0x40f0cc(0x1df));const _0x41151c=0x5,_0x4e111d=Object[_0x40f0cc(0x1d4)](_0x89fcc1);for(let _0x343669=0x0;_0x343669<_0x4e111d[_0x40f0cc(0x1d6)];_0x343669+=_0x41151c){const _0x21eb69=_0x4e111d[_0x40f0cc(0x227)](_0x343669,_0x343669+_0x41151c),_0x13757f=_0x21eb69[_0x40f0cc(0x222)](async([_0x4eb887,_0x21df6b])=>{const _0x3a131c=_0x40f0cc;try{await database_1[_0x3a131c(0x1e6)][_0x3a131c(0x211)][_0x3a131c(0x1da)]({'where':{'currency':_0x4eb887[_0x3a131c(0x1c6)]()},'update':{'rate':_0x21df6b},'create':{'currency':_0x4eb887['toLowerCase'](),'rate':_0x21df6b}});}catch(_0x43482e){console['error'](_0x3a131c(0x1d2)+_0x4eb887+':',_0x43482e);}});await Promise[_0x40f0cc(0x21a)](_0x13757f);}console[_0x40f0cc(0x1d7)]('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0xfeb028){console[_0x40f0cc(0x203)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0xfeb028);throw _0xfeb028;}}async[a58_0x3d88a6(0x1fd)](_0x46b4ec){const _0x2272df=a58_0x3d88a6,_0x38ae5b=_0x46b4ec['toLowerCase']();if(_0x38ae5b==='usdt')return 0x1;try{const _0x3f42e5=await database_1[_0x2272df(0x1e6)][_0x2272df(0x211)][_0x2272df(0x1bd)]({'where':{'currency':_0x38ae5b}});if(!_0x3f42e5)return console[_0x2272df(0x1e7)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x46b4ec+_0x2272df(0x220)),0x1;return _0x3f42e5[_0x2272df(0x1f3)];}catch(_0xbba184){return console['error'](_0x2272df(0x22d)+_0x46b4ec+':',_0xbba184),0x1;}}async[a58_0x3d88a6(0x1ea)](_0x129e81,_0x156c58){const _0x180fa7=a58_0x3d88a6,_0x5f3767=_0x156c58[_0x180fa7(0x1c6)]();if(_0x5f3767===_0x180fa7(0x22a)){const _0x543e8a=_0x129e81*(0x1+this[_0x180fa7(0x1c2)]/0x64);return console[_0x180fa7(0x1d7)](_0x180fa7(0x212)+this[_0x180fa7(0x1c2)]+_0x180fa7(0x1cc)+_0x129e81+_0x180fa7(0x1cd)+_0x543e8a['toFixed'](0x6)+_0x180fa7(0x1ec)),_0x543e8a;}try{const _0x4c524f=await this['getCurrencyRate'](_0x5f3767),_0x43509e=_0x129e81/_0x4c524f,_0x4082ca=_0x43509e*(0x1+this[_0x180fa7(0x1c2)]/0x64);return console[_0x180fa7(0x1d7)]('ðŸ’±\x20Converted\x20'+_0x129e81+'\x20'+_0x156c58[_0x180fa7(0x1ca)]()+_0x180fa7(0x20e)+_0x43509e[_0x180fa7(0x223)](0x6)+_0x180fa7(0x216)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x4082ca['toFixed'](0x6)+_0x180fa7(0x22b)+_0x4c524f+')'),_0x4082ca;}catch(_0x240d33){console['error'](_0x180fa7(0x214)+_0x129e81+'\x20'+_0x156c58+_0x180fa7(0x1ee),_0x240d33);const _0xbff355=_0x129e81*(0x1+this[_0x180fa7(0x1c2)]/0x64);return _0xbff355;}}async[a58_0x3d88a6(0x1de)](_0x2197ca){let _0x11a910=0x0;for(const {amount:_0xb7085e,currency:_0x58f294}of _0x2197ca){const _0x9bb49c=await this['convertToUSDT'](_0xb7085e,_0x58f294);_0x11a910+=_0x9bb49c;}return _0x11a910;}async[a58_0x3d88a6(0x1c3)](){const _0x54097e=a58_0x3d88a6;try{const _0x53f204=await database_1[_0x54097e(0x1e6)][_0x54097e(0x211)][_0x54097e(0x225)]({'select':{'currency':!![],'rate':!![]}}),_0x35fd81={'usdt':0x1};return _0x53f204['forEach'](_0xc328da=>{const _0x5253e3=_0x54097e;_0x35fd81[_0xc328da[_0x5253e3(0x20a)]]=_0xc328da[_0x5253e3(0x1f3)];}),_0x35fd81;}catch(_0x3fed28){return console['error'](_0x54097e(0x210),_0x3fed28),{'usdt':0x1};}}async[a58_0x3d88a6(0x20c)](){const _0x47cbcd=a58_0x3d88a6;try{const [_0x335736,_0x185f38,_0x4c5c9e]=await Promise['all']([database_1[_0x47cbcd(0x1e6)][_0x47cbcd(0x211)][_0x47cbcd(0x207)](),database_1[_0x47cbcd(0x1e6)][_0x47cbcd(0x211)][_0x47cbcd(0x1f5)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x47cbcd(0x1e6)][_0x47cbcd(0x211)][_0x47cbcd(0x1f5)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x335736,'lastUpdated':_0x185f38?.[_0x47cbcd(0x1ce)]||null,'oldestRate':_0x4c5c9e?.[_0x47cbcd(0x1ce)]||null,'markupPercentage':this[_0x47cbcd(0x1c2)]};}catch(_0x94af7a){return console[_0x47cbcd(0x203)](_0x47cbcd(0x218),_0x94af7a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x47cbcd(0x1c2)]};}}[a58_0x3d88a6(0x201)](){return this['MARKUP_PERCENTAGE'];}}exports[a58_0x3d88a6(0x1f1)]=CurrencyService,exports[a58_0x3d88a6(0x1d9)]=new CurrencyService();