'use strict';const a39_0x2a1577=a39_0x55b1;(function(_0x1a1f59,_0x290d5b){const _0x363ff5=a39_0x55b1,_0x12ec23=_0x1a1f59();while(!![]){try{const _0x11cdd0=-parseInt(_0x363ff5(0x12b))/0x1*(-parseInt(_0x363ff5(0x110))/0x2)+-parseInt(_0x363ff5(0xfc))/0x3+-parseInt(_0x363ff5(0x129))/0x4+-parseInt(_0x363ff5(0xd1))/0x5+parseInt(_0x363ff5(0x108))/0x6*(parseInt(_0x363ff5(0x137))/0x7)+parseInt(_0x363ff5(0x124))/0x8+parseInt(_0x363ff5(0xf1))/0x9;if(_0x11cdd0===_0x290d5b)break;else _0x12ec23['push'](_0x12ec23['shift']());}catch(_0x30cd73){_0x12ec23['push'](_0x12ec23['shift']());}}}(a39_0x1cb0,0xeddd1));function a39_0x1cb0(){const _0x3dd37b=['ltc','usdt','9567632HrWcgV','btc','allSettled','twd','bnb','3525532AYCHma','currency','314948NBzzSs','rate','getCurrencyRate','%\x20markup\x20=\x20','\x20USDT\x20=\x20','myr','CurrencyService','yfi','default','findFirst','krw','findMany','28YMImgl','zar','getMarkupPercentage','toUpperCase','cad','../config/database','count','📊\x20Received\x20rates\x20for\x20','clp','sats','inr','ils','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','join','czk','updateCurrencyRates','lkr','❌\x20Failed\x20to\x20update\x20currency\x20rates:','toFixed','updateInterval','bhd','all','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','keys','\x20USDT,\x20with\x20','rub','💱\x20Converted\x20','convertMultipleToUSDT','vnd','5862030aIFhLI','asc','ars','statusText','\x20USDT','Initial\x20currency\x20rates\x20update\x20failed:','error','thb','entries','eos','%\x20markup\x20to\x20','mmk','mxn','stopPeriodicUpdates','cny','COINGECKO_URL','sgd','eur','Failed\x20to\x20update\x20rate\x20for\x20','tether','sek','convertToUSDT','nzd','currencyService','log','upsert','xlm','huf','\x20USDT\x20(rate:\x20','__esModule','kwd','application/json','14390667QrPmVA','nok','MARKUP_PERCENTAGE','idr','bch','try','CoinGecko\x20API\x20error:\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','Error\x20getting\x20all\x20rates:','gel','TesSoft\x20Payment\x20System/1.0','5037669cbcxgP','dkk','No\x20rate\x20found\x20for\x20currency:\x20','https://api.coingecko.com/api/v3/simple/price','currencyRate','link','xag','startPeriodicUpdates','map','bmd','\x20to\x20','💱\x20Applied\x20','978888CengOs','vef','chf','php','updatedAt','brl','json','findUnique','8XWuudv','hkd','Error\x20converting\x20','aud','xau','defineProperty','✅\x20Currency\x20rates\x20updated\x20successfully','toLowerCase','ngn','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','desc','\x20to\x20USDT:','warn','Periodic\x20currency\x20rates\x20update\x20failed:','Error\x20getting\x20rate\x20for\x20currency\x20','sar','gbp','status'];a39_0x1cb0=function(){return _0x3dd37b;};return a39_0x1cb0();}function a39_0x55b1(_0x1bd51f,_0x200eea){const _0x1cb0c5=a39_0x1cb0();return a39_0x55b1=function(_0x55b1a4,_0x204242){_0x55b1a4=_0x55b1a4-0xb6;let _0x5d7c62=_0x1cb0c5[_0x55b1a4];return _0x5d7c62;},a39_0x55b1(_0x1bd51f,_0x200eea);}var __importDefault=this&&this['__importDefault']||function(_0x173fa6){const _0x42a915=a39_0x55b1;return _0x173fa6&&_0x173fa6[_0x42a915(0xee)]?_0x173fa6:{'default':_0x173fa6};};Object[a39_0x2a1577(0x115)](exports,a39_0x2a1577(0xee),{'value':!![]}),exports[a39_0x2a1577(0xe8)]=exports[a39_0x2a1577(0x131)]=void 0x0;const database_1=__importDefault(require(a39_0x2a1577(0xb9)));class CurrencyService{constructor(){const _0x5a5f9d=a39_0x2a1577;this[_0x5a5f9d(0xe0)]=_0x5a5f9d(0xff),this['CURRENCIES']=[_0x5a5f9d(0x125),'eth',_0x5a5f9d(0x122),_0x5a5f9d(0xf5),_0x5a5f9d(0x128),_0x5a5f9d(0xda),'xrp',_0x5a5f9d(0xeb),_0x5a5f9d(0x101),'dot',_0x5a5f9d(0x132),'usd','aed',_0x5a5f9d(0xd3),_0x5a5f9d(0x113),'bdt',_0x5a5f9d(0xc8),_0x5a5f9d(0x105),_0x5a5f9d(0x10d),_0x5a5f9d(0xb8),_0x5a5f9d(0x10a),_0x5a5f9d(0xbc),_0x5a5f9d(0xdf),_0x5a5f9d(0xc2),_0x5a5f9d(0xfd),_0x5a5f9d(0xe2),_0x5a5f9d(0x120),_0x5a5f9d(0xfa),_0x5a5f9d(0x111),_0x5a5f9d(0xec),_0x5a5f9d(0xf4),_0x5a5f9d(0xbf),_0x5a5f9d(0xbe),'jpy',_0x5a5f9d(0x135),_0x5a5f9d(0xef),_0x5a5f9d(0xc4),_0x5a5f9d(0xdc),_0x5a5f9d(0xdd),_0x5a5f9d(0x130),_0x5a5f9d(0x118),_0x5a5f9d(0xf2),_0x5a5f9d(0xe7),_0x5a5f9d(0x10b),'pkr','pln',_0x5a5f9d(0xcd),_0x5a5f9d(0x11f),_0x5a5f9d(0xe5),_0x5a5f9d(0xe1),_0x5a5f9d(0xd8),_0x5a5f9d(0xf6),_0x5a5f9d(0x127),'uah',_0x5a5f9d(0x109),_0x5a5f9d(0xd0),_0x5a5f9d(0x138),'xdr',_0x5a5f9d(0x102),_0x5a5f9d(0x114),'bits',_0x5a5f9d(0xbd)],this['updateInterval']=null,this[_0x5a5f9d(0xf3)]=0x3,this[_0x5a5f9d(0x103)]();}[a39_0x2a1577(0x103)](){const _0x3110a5=a39_0x2a1577;this[_0x3110a5(0xc3)]()['catch'](_0x440031=>{const _0x23cb40=_0x3110a5;console[_0x23cb40(0xd7)](_0x23cb40(0xd6),_0x440031);}),this['updateInterval']=setInterval(async()=>{const _0x4025a4=_0x3110a5;try{await this['updateCurrencyRates']();}catch(_0x49e423){console[_0x4025a4(0xd7)](_0x4025a4(0x11d),_0x49e423);}},0x3c*0x3c*0x3e8),console[_0x3110a5(0xe9)](_0x3110a5(0xc0));}[a39_0x2a1577(0xde)](){const _0x2bb4a7=a39_0x2a1577;this[_0x2bb4a7(0xc7)]&&(clearInterval(this[_0x2bb4a7(0xc7)]),this[_0x2bb4a7(0xc7)]=null,console[_0x2bb4a7(0xe9)](_0x2bb4a7(0x119)));}async[a39_0x2a1577(0xc3)](){const _0x75bfb4=a39_0x2a1577;try{console[_0x75bfb4(0xe9)](_0x75bfb4(0xca));const _0x35788b=this['CURRENCIES'][_0x75bfb4(0xc1)](','),_0x5091a8=this[_0x75bfb4(0xe0)]+'?ids=tether&vs_currencies='+_0x35788b,_0x37ce52=await fetch(_0x5091a8,{'headers':{'Accept':_0x75bfb4(0xf0),'User-Agent':_0x75bfb4(0xfb)}});if(!_0x37ce52['ok'])throw new Error(_0x75bfb4(0xf7)+_0x37ce52[_0x75bfb4(0x121)]+'\x20'+_0x37ce52[_0x75bfb4(0xd4)]);const _0x430233=await _0x37ce52[_0x75bfb4(0x10e)]();if(!_0x430233[_0x75bfb4(0xe4)])throw new Error(_0x75bfb4(0xf8));const _0x4e0758=_0x430233['tether'];console[_0x75bfb4(0xe9)](_0x75bfb4(0xbb)+Object[_0x75bfb4(0xcb)](_0x4e0758)['length']+'\x20currencies');const _0x33f412=Object[_0x75bfb4(0xd9)](_0x4e0758)[_0x75bfb4(0x104)](async([_0x252f9f,_0x3788da])=>{const _0x446c23=_0x75bfb4;try{await database_1['default'][_0x446c23(0x100)][_0x446c23(0xea)]({'where':{'currency':_0x252f9f['toLowerCase']()},'update':{'rate':_0x3788da},'create':{'currency':_0x252f9f['toLowerCase'](),'rate':_0x3788da}});}catch(_0x288356){console['error'](_0x446c23(0xe3)+_0x252f9f+':',_0x288356);}});await Promise[_0x75bfb4(0x126)](_0x33f412),console[_0x75bfb4(0xe9)](_0x75bfb4(0x116));}catch(_0x412f79){console[_0x75bfb4(0xd7)](_0x75bfb4(0xc5),_0x412f79);throw _0x412f79;}}async[a39_0x2a1577(0x12d)](_0x284bf1){const _0x5dffee=a39_0x2a1577,_0x2408e3=_0x284bf1[_0x5dffee(0x117)]();if(_0x2408e3==='usdt')return 0x1;try{const _0x4c7a84=await database_1['default'][_0x5dffee(0x100)][_0x5dffee(0x10f)]({'where':{'currency':_0x2408e3}});if(!_0x4c7a84)return console[_0x5dffee(0x11c)](_0x5dffee(0xfe)+_0x284bf1+',\x20using\x201\x20as\x20fallback'),0x1;return _0x4c7a84[_0x5dffee(0x12c)];}catch(_0x269fe5){return console[_0x5dffee(0xd7)](_0x5dffee(0x11e)+_0x284bf1+':',_0x269fe5),0x1;}}async[a39_0x2a1577(0xe6)](_0x4436a4,_0x4db5b8){const _0x22125e=a39_0x2a1577,_0x5b3112=_0x4db5b8[_0x22125e(0x117)]();if(_0x5b3112===_0x22125e(0x123)){const _0x1647e6=_0x4436a4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x22125e(0xe9)](_0x22125e(0x107)+this[_0x22125e(0xf3)]+_0x22125e(0xdb)+_0x4436a4+_0x22125e(0x12f)+_0x1647e6[_0x22125e(0xc6)](0x6)+_0x22125e(0xd5)),_0x1647e6;}try{const _0x25e431=await this[_0x22125e(0x12d)](_0x5b3112),_0x38f514=_0x4436a4/_0x25e431,_0x6e8111=_0x38f514*(0x1+this[_0x22125e(0xf3)]/0x64);return console[_0x22125e(0xe9)](_0x22125e(0xce)+_0x4436a4+'\x20'+_0x4db5b8[_0x22125e(0xb7)]()+_0x22125e(0x106)+_0x38f514[_0x22125e(0xc6)](0x6)+_0x22125e(0xcc)+this[_0x22125e(0xf3)]+_0x22125e(0x12e)+_0x6e8111['toFixed'](0x6)+_0x22125e(0xed)+_0x25e431+')'),_0x6e8111;}catch(_0x3de9c3){console[_0x22125e(0xd7)](_0x22125e(0x112)+_0x4436a4+'\x20'+_0x4db5b8+_0x22125e(0x11b),_0x3de9c3);const _0x59c954=_0x4436a4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x59c954;}}async[a39_0x2a1577(0xcf)](_0x9638f5){const _0x465538=a39_0x2a1577;let _0x4f0665=0x0;for(const {amount:_0x42f465,currency:_0x5700e5}of _0x9638f5){const _0x299da6=await this[_0x465538(0xe6)](_0x42f465,_0x5700e5);_0x4f0665+=_0x299da6;}return _0x4f0665;}async['getAllRates'](){const _0x5d0658=a39_0x2a1577;try{const _0x18a6ec=await database_1['default'][_0x5d0658(0x100)][_0x5d0658(0x136)]({'select':{'currency':!![],'rate':!![]}}),_0x3c692a={'usdt':0x1};return _0x18a6ec['forEach'](_0x23b88b=>{const _0x4c7fa2=_0x5d0658;_0x3c692a[_0x23b88b[_0x4c7fa2(0x12a)]]=_0x23b88b[_0x4c7fa2(0x12c)];}),_0x3c692a;}catch(_0x4d05a6){return console['error'](_0x5d0658(0xf9),_0x4d05a6),{'usdt':0x1};}}async['getRatesStatus'](){const _0x3c5124=a39_0x2a1577;try{const [_0x1cb61e,_0x5f452e,_0x26a2a2]=await Promise[_0x3c5124(0xc9)]([database_1[_0x3c5124(0x133)]['currencyRate'][_0x3c5124(0xba)](),database_1[_0x3c5124(0x133)][_0x3c5124(0x100)][_0x3c5124(0x134)]({'orderBy':{'updatedAt':_0x3c5124(0x11a)},'select':{'updatedAt':!![]}}),database_1[_0x3c5124(0x133)][_0x3c5124(0x100)][_0x3c5124(0x134)]({'orderBy':{'updatedAt':_0x3c5124(0xd2)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1cb61e,'lastUpdated':_0x5f452e?.[_0x3c5124(0x10c)]||null,'oldestRate':_0x26a2a2?.[_0x3c5124(0x10c)]||null,'markupPercentage':this[_0x3c5124(0xf3)]};}catch(_0xb70683){return console['error']('Error\x20getting\x20rates\x20status:',_0xb70683),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3c5124(0xf3)]};}}[a39_0x2a1577(0xb6)](){const _0x14bc4d=a39_0x2a1577;return this[_0x14bc4d(0xf3)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();