'use strict';const a38_0x5e1e1f=a38_0x5825;function a38_0xa462(){const _0x4ec9c5=['sgd','xrp','bmd','link','yfi','findFirst','chf','dot','sar','602748nRjVSY','status','cny','56772KDoAVK','💱\x20Converted\x20','COINGECKO_URL','asc','gel','ngn','aud','Error\x20getting\x20rates\x20status:','desc','findMany','usdt','10lZzdKF','Failed\x20to\x20update\x20rate\x20for\x20','toUpperCase','currencyRate','pkr','Initial\x20currency\x20rates\x20update\x20failed:','sats','CURRENCIES','updateCurrencyRates','inr','https://api.coingecko.com/api/v3/simple/price','rate','CurrencyService','bits','../config/database','\x20currencies','findUnique','getCurrencyRate','65419TDisvW','Periodic\x20currency\x20rates\x20update\x20failed:','getRatesStatus','updateInterval','bnb','vnd','updatedAt','join','💱\x20Applied\x20','__importDefault','\x20USDT','6pptbhd','uah','default','ars','2269750AGWTmo','getMarkupPercentage','Error\x20getting\x20rate\x20for\x20currency\x20','brl','upsert','currencyService','startPeriodicUpdates','getAllRates','eur','myr','clp','json','statusText','tether','%\x20markup\x20to\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','currency','MARKUP_PERCENTAGE','1127980htXQPp','toLowerCase','vef','convertToUSDT','keys','cad','dkk','hkd','\x20USDT,\x20with\x20','Error\x20getting\x20all\x20rates:','warn','1044618PKHkYs','\x20USDT\x20(rate:\x20','jpy','rub','php','toFixed','stopPeriodicUpdates','log','huf','__esModule','application/json',',\x20using\x201\x20as\x20fallback','CoinGecko\x20API\x20error:\x20','thb','Error\x20converting\x20','gbp','xlm','2213868QvhLht','\x20USDT\x20=\x20','ltc','lkr','count','zar','try','16ajrAHU','kwd','nok','error','sek','bch','?ids=tether&vs_currencies=','\x20to\x20','usd','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...'];a38_0xa462=function(){return _0x4ec9c5;};return a38_0xa462();}(function(_0x446001,_0x4ef29a){const _0x5dd893=a38_0x5825,_0x1f9d47=_0x446001();while(!![]){try{const _0x3ca320=-parseInt(_0x5dd893(0x198))/0x1*(parseInt(_0x5dd893(0x1a3))/0x2)+parseInt(_0x5dd893(0x17b))/0x3+parseInt(_0x5dd893(0x1d5))/0x4+parseInt(_0x5dd893(0x186))/0x5*(-parseInt(_0x5dd893(0x1c4))/0x6)+parseInt(_0x5dd893(0x1a7))/0x7+-parseInt(_0x5dd893(0x1dc))/0x8*(parseInt(_0x5dd893(0x178))/0x9)+parseInt(_0x5dd893(0x1b9))/0xa;if(_0x3ca320===_0x4ef29a)break;else _0x1f9d47['push'](_0x1f9d47['shift']());}catch(_0x431517){_0x1f9d47['push'](_0x1f9d47['shift']());}}}(a38_0xa462,0x50d18));var __importDefault=this&&this[a38_0x5e1e1f(0x1a1)]||function(_0xbe08cf){const _0x9e1b0e=a38_0x5e1e1f;return _0xbe08cf&&_0xbe08cf[_0x9e1b0e(0x1cd)]?_0xbe08cf:{'default':_0xbe08cf};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x5e1e1f(0x1ac)]=exports[a38_0x5e1e1f(0x192)]=void 0x0;const database_1=__importDefault(require(a38_0x5e1e1f(0x194)));function a38_0x5825(_0x507432,_0x55b3e1){const _0xa4623d=a38_0xa462();return a38_0x5825=function(_0x582518,_0x9d5d2a){_0x582518=_0x582518-0x177;let _0x2b5c67=_0xa4623d[_0x582518];return _0x2b5c67;},a38_0x5825(_0x507432,_0x55b3e1);}class CurrencyService{constructor(){const _0x36c316=a38_0x5e1e1f;this[_0x36c316(0x17d)]=_0x36c316(0x190),this[_0x36c316(0x18d)]=['btc','eth',_0x36c316(0x1d7),_0x36c316(0x1e1),_0x36c316(0x19c),'eos',_0x36c316(0x1e7),_0x36c316(0x1d4),_0x36c316(0x1e9),_0x36c316(0x1ed),_0x36c316(0x1ea),_0x36c316(0x1e4),'aed',_0x36c316(0x1a6),_0x36c316(0x181),'bdt','bhd',_0x36c316(0x1e8),_0x36c316(0x1aa),_0x36c316(0x1be),_0x36c316(0x1ec),_0x36c316(0x1b1),_0x36c316(0x17a),'czk',_0x36c316(0x1bf),_0x36c316(0x1af),_0x36c316(0x1d3),_0x36c316(0x17f),_0x36c316(0x1c0),_0x36c316(0x1cc),'idr','ils',_0x36c316(0x18f),_0x36c316(0x1c6),'krw',_0x36c316(0x1dd),_0x36c316(0x1d8),'mmk','mxn',_0x36c316(0x1b0),_0x36c316(0x180),_0x36c316(0x1de),'nzd',_0x36c316(0x1c8),_0x36c316(0x18a),'pln',_0x36c316(0x1c7),_0x36c316(0x177),_0x36c316(0x1e0),_0x36c316(0x1e6),_0x36c316(0x1d1),_0x36c316(0x1db),'twd',_0x36c316(0x1a4),_0x36c316(0x1bb),_0x36c316(0x19d),_0x36c316(0x1da),'xdr','xag','xau',_0x36c316(0x193),_0x36c316(0x18c)],this[_0x36c316(0x19b)]=null,this[_0x36c316(0x1b8)]=0x3,this[_0x36c316(0x1ad)]();}[a38_0x5e1e1f(0x1ad)](){const _0x181fee=a38_0x5e1e1f;this['updateCurrencyRates']()['catch'](_0x1d2302=>{const _0x3394da=a38_0x5825;console[_0x3394da(0x1df)](_0x3394da(0x18b),_0x1d2302);}),this[_0x181fee(0x19b)]=setInterval(async()=>{const _0x1bb90f=_0x181fee;try{await this[_0x1bb90f(0x18e)]();}catch(_0x44e9eb){console[_0x1bb90f(0x1df)](_0x1bb90f(0x199),_0x44e9eb);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x5e1e1f(0x1ca)](){const _0x53dc8e=a38_0x5e1e1f;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x53dc8e(0x19b)]=null,console[_0x53dc8e(0x1cb)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x5e1e1f(0x18e)](){const _0x4855c5=a38_0x5e1e1f;try{console[_0x4855c5(0x1cb)](_0x4855c5(0x1e5));const _0xe1cb36=this[_0x4855c5(0x18d)][_0x4855c5(0x19f)](','),_0x39c612=this[_0x4855c5(0x17d)]+_0x4855c5(0x1e2)+_0xe1cb36,_0x456ff9=await fetch(_0x39c612,{'headers':{'Accept':_0x4855c5(0x1ce),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x456ff9['ok'])throw new Error(_0x4855c5(0x1d0)+_0x456ff9[_0x4855c5(0x179)]+'\x20'+_0x456ff9[_0x4855c5(0x1b3)]);const _0x2ea952=await _0x456ff9[_0x4855c5(0x1b2)]();if(!_0x2ea952[_0x4855c5(0x1b4)])throw new Error(_0x4855c5(0x1b6));const _0x3275cc=_0x2ea952[_0x4855c5(0x1b4)];console[_0x4855c5(0x1cb)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x4855c5(0x1bd)](_0x3275cc)['length']+_0x4855c5(0x195));const _0x91d4d2=Object['entries'](_0x3275cc)['map'](async([_0x208e6c,_0x5709e4])=>{const _0x3afe8e=_0x4855c5;try{await database_1[_0x3afe8e(0x1a5)][_0x3afe8e(0x189)][_0x3afe8e(0x1ab)]({'where':{'currency':_0x208e6c['toLowerCase']()},'update':{'rate':_0x5709e4},'create':{'currency':_0x208e6c[_0x3afe8e(0x1ba)](),'rate':_0x5709e4}});}catch(_0x40755e){console[_0x3afe8e(0x1df)](_0x3afe8e(0x187)+_0x208e6c+':',_0x40755e);}});await Promise['allSettled'](_0x91d4d2),console[_0x4855c5(0x1cb)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x17cd0f){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x17cd0f);throw _0x17cd0f;}}async['getCurrencyRate'](_0x15946b){const _0x40589e=a38_0x5e1e1f,_0x301044=_0x15946b[_0x40589e(0x1ba)]();if(_0x301044===_0x40589e(0x185))return 0x1;try{const _0x4b5b70=await database_1[_0x40589e(0x1a5)][_0x40589e(0x189)][_0x40589e(0x196)]({'where':{'currency':_0x301044}});if(!_0x4b5b70)return console[_0x40589e(0x1c3)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x15946b+_0x40589e(0x1cf)),0x1;return _0x4b5b70['rate'];}catch(_0x4c2094){return console['error'](_0x40589e(0x1a9)+_0x15946b+':',_0x4c2094),0x1;}}async[a38_0x5e1e1f(0x1bc)](_0xcd54f2,_0x5bb699){const _0x13d4f6=a38_0x5e1e1f,_0x396732=_0x5bb699[_0x13d4f6(0x1ba)]();if(_0x396732==='usdt'){const _0x2e48e5=_0xcd54f2*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x13d4f6(0x1cb)](_0x13d4f6(0x1a0)+this[_0x13d4f6(0x1b8)]+_0x13d4f6(0x1b5)+_0xcd54f2+_0x13d4f6(0x1d6)+_0x2e48e5[_0x13d4f6(0x1c9)](0x6)+_0x13d4f6(0x1a2)),_0x2e48e5;}try{const _0x2961b3=await this[_0x13d4f6(0x197)](_0x396732),_0x3d442a=_0xcd54f2/_0x2961b3,_0x50ed16=_0x3d442a*(0x1+this[_0x13d4f6(0x1b8)]/0x64);return console['log'](_0x13d4f6(0x17c)+_0xcd54f2+'\x20'+_0x5bb699[_0x13d4f6(0x188)]()+_0x13d4f6(0x1e3)+_0x3d442a['toFixed'](0x6)+_0x13d4f6(0x1c1)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x50ed16[_0x13d4f6(0x1c9)](0x6)+_0x13d4f6(0x1c5)+_0x2961b3+')'),_0x50ed16;}catch(_0x187481){console['error'](_0x13d4f6(0x1d2)+_0xcd54f2+'\x20'+_0x5bb699+'\x20to\x20USDT:',_0x187481);const _0x3aed17=_0xcd54f2*(0x1+this[_0x13d4f6(0x1b8)]/0x64);return _0x3aed17;}}async['convertMultipleToUSDT'](_0x5b2941){const _0x30321e=a38_0x5e1e1f;let _0x5c1fb5=0x0;for(const {amount:_0x5dbc88,currency:_0x253984}of _0x5b2941){const _0x4092f7=await this[_0x30321e(0x1bc)](_0x5dbc88,_0x253984);_0x5c1fb5+=_0x4092f7;}return _0x5c1fb5;}async[a38_0x5e1e1f(0x1ae)](){const _0x4698b3=a38_0x5e1e1f;try{const _0x1fc6d6=await database_1['default'][_0x4698b3(0x189)][_0x4698b3(0x184)]({'select':{'currency':!![],'rate':!![]}}),_0x36eadf={'usdt':0x1};return _0x1fc6d6['forEach'](_0x5f3328=>{const _0x4219cc=_0x4698b3;_0x36eadf[_0x5f3328[_0x4219cc(0x1b7)]]=_0x5f3328[_0x4219cc(0x191)];}),_0x36eadf;}catch(_0x45b375){return console[_0x4698b3(0x1df)](_0x4698b3(0x1c2),_0x45b375),{'usdt':0x1};}}async[a38_0x5e1e1f(0x19a)](){const _0x1a00a9=a38_0x5e1e1f;try{const [_0x22eafc,_0x35fec6,_0x2cb3b2]=await Promise['all']([database_1[_0x1a00a9(0x1a5)][_0x1a00a9(0x189)][_0x1a00a9(0x1d9)](),database_1[_0x1a00a9(0x1a5)][_0x1a00a9(0x189)][_0x1a00a9(0x1eb)]({'orderBy':{'updatedAt':_0x1a00a9(0x183)},'select':{'updatedAt':!![]}}),database_1['default'][_0x1a00a9(0x189)][_0x1a00a9(0x1eb)]({'orderBy':{'updatedAt':_0x1a00a9(0x17e)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x22eafc,'lastUpdated':_0x35fec6?.[_0x1a00a9(0x19e)]||null,'oldestRate':_0x2cb3b2?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x7ba7d){return console[_0x1a00a9(0x1df)](_0x1a00a9(0x182),_0x7ba7d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1a00a9(0x1b8)]};}}[a38_0x5e1e1f(0x1a8)](){const _0x23a2ef=a38_0x5e1e1f;return this[_0x23a2ef(0x1b8)];}}exports[a38_0x5e1e1f(0x192)]=CurrencyService,exports[a38_0x5e1e1f(0x1ac)]=new CurrencyService();