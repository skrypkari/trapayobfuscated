'use strict';const a38_0x1480ae=a38_0xe9b2;function a38_0xe9b2(_0x5a5957,_0x2db9d1){const _0x193a94=a38_0x193a();return a38_0xe9b2=function(_0xe9b22b,_0x3dbd9e){_0xe9b22b=_0xe9b22b-0x131;let _0x123202=_0x193a94[_0xe9b22b];return _0x123202;},a38_0xe9b2(_0x5a5957,_0x2db9d1);}(function(_0x2ea50b,_0x109c33){const _0x254f67=a38_0xe9b2,_0x852160=_0x2ea50b();while(!![]){try{const _0x451789=-parseInt(_0x254f67(0x19a))/0x1+-parseInt(_0x254f67(0x178))/0x2+parseInt(_0x254f67(0x17d))/0x3+parseInt(_0x254f67(0x1a8))/0x4+-parseInt(_0x254f67(0x1a7))/0x5*(-parseInt(_0x254f67(0x161))/0x6)+-parseInt(_0x254f67(0x198))/0x7+parseInt(_0x254f67(0x197))/0x8;if(_0x451789===_0x109c33)break;else _0x852160['push'](_0x852160['shift']());}catch(_0x35b9c8){_0x852160['push'](_0x852160['shift']());}}}(a38_0x193a,0x6d89a));var __importDefault=this&&this['__importDefault']||function(_0x277c1f){return _0x277c1f&&_0x277c1f['__esModule']?_0x277c1f:{'default':_0x277c1f};};Object[a38_0x1480ae(0x163)](exports,a38_0x1480ae(0x13b),{'value':!![]}),exports[a38_0x1480ae(0x177)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x1480ae(0x153)));class CurrencyService{constructor(){const _0x1608ac=a38_0x1480ae;this[_0x1608ac(0x150)]=_0x1608ac(0x191),this[_0x1608ac(0x1af)]=[_0x1608ac(0x186),_0x1608ac(0x18c),_0x1608ac(0x17b),_0x1608ac(0x1a9),'bnb',_0x1608ac(0x14d),_0x1608ac(0x185),_0x1608ac(0x13f),_0x1608ac(0x15b),_0x1608ac(0x149),'yfi',_0x1608ac(0x174),_0x1608ac(0x18e),_0x1608ac(0x1a6),_0x1608ac(0x172),_0x1608ac(0x16f),'bhd',_0x1608ac(0x18b),_0x1608ac(0x16c),_0x1608ac(0x167),'chf','clp',_0x1608ac(0x1ae),'czk',_0x1608ac(0x14a),_0x1608ac(0x15e),_0x1608ac(0x15f),_0x1608ac(0x195),'hkd',_0x1608ac(0x18d),'idr',_0x1608ac(0x141),_0x1608ac(0x15a),_0x1608ac(0x17e),_0x1608ac(0x176),_0x1608ac(0x15d),'lkr',_0x1608ac(0x1a3),_0x1608ac(0x182),_0x1608ac(0x196),_0x1608ac(0x188),_0x1608ac(0x169),_0x1608ac(0x194),_0x1608ac(0x19e),'pkr',_0x1608ac(0x1a4),_0x1608ac(0x157),'sar',_0x1608ac(0x140),_0x1608ac(0x159),_0x1608ac(0x173),_0x1608ac(0x139),_0x1608ac(0x1a5),_0x1608ac(0x136),_0x1608ac(0x17a),_0x1608ac(0x13e),_0x1608ac(0x19b),_0x1608ac(0x1ab),_0x1608ac(0x179),_0x1608ac(0x13a),_0x1608ac(0x16a),_0x1608ac(0x165)],this['updateInterval']=null,this[_0x1608ac(0x1a2)]=0x3,this[_0x1608ac(0x180)]();}['startPeriodicUpdates'](){const _0x1e7356=a38_0x1480ae;this['updateCurrencyRates']()[_0x1e7356(0x14c)](_0x2acd1c=>{const _0x1d3d28=_0x1e7356;console['error'](_0x1d3d28(0x131),_0x2acd1c);}),this[_0x1e7356(0x145)]=setInterval(async()=>{const _0x250970=_0x1e7356;try{await this[_0x250970(0x13d)]();}catch(_0x47fdc0){console[_0x250970(0x168)](_0x250970(0x199),_0x47fdc0);}},0x3c*0x3c*0x3e8),console['log'](_0x1e7356(0x14e));}[a38_0x1480ae(0x154)](){const _0x95f364=a38_0x1480ae;this[_0x95f364(0x145)]&&(clearInterval(this[_0x95f364(0x145)]),this[_0x95f364(0x145)]=null,console[_0x95f364(0x152)](_0x95f364(0x155)));}async['updateCurrencyRates'](){const _0x46c217=a38_0x1480ae;try{console[_0x46c217(0x152)](_0x46c217(0x158));const _0x2a454f=this[_0x46c217(0x1af)][_0x46c217(0x137)](','),_0x552cc3=this['COINGECKO_URL']+_0x46c217(0x133)+_0x2a454f,_0x2ff946=await fetch(_0x552cc3,{'headers':{'Accept':_0x46c217(0x19d),'User-Agent':_0x46c217(0x19f)}});if(!_0x2ff946['ok'])throw new Error(_0x46c217(0x1a1)+_0x2ff946['status']+'\x20'+_0x2ff946[_0x46c217(0x192)]);const _0x3c55de=await _0x2ff946[_0x46c217(0x151)]();if(!_0x3c55de['tether'])throw new Error(_0x46c217(0x193));const _0x1e43c5=_0x3c55de[_0x46c217(0x16d)];console[_0x46c217(0x152)](_0x46c217(0x162)+Object[_0x46c217(0x15c)](_0x1e43c5)[_0x46c217(0x187)]+_0x46c217(0x1ac));const _0x5b8110=Object[_0x46c217(0x171)](_0x1e43c5)[_0x46c217(0x18f)](async([_0x471ab1,_0x17f21b])=>{const _0x484ea5=_0x46c217;try{await database_1[_0x484ea5(0x181)]['currencyRate']['upsert']({'where':{'currency':_0x471ab1[_0x484ea5(0x142)]()},'update':{'rate':_0x17f21b},'create':{'currency':_0x471ab1[_0x484ea5(0x142)](),'rate':_0x17f21b}});}catch(_0x26b65d){console[_0x484ea5(0x168)](_0x484ea5(0x166)+_0x471ab1+':',_0x26b65d);}});await Promise[_0x46c217(0x148)](_0x5b8110),console[_0x46c217(0x152)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x59196b){console[_0x46c217(0x168)](_0x46c217(0x14f),_0x59196b);throw _0x59196b;}}async['getCurrencyRate'](_0x745427){const _0x4df999=a38_0x1480ae,_0x26bebc=_0x745427['toLowerCase']();if(_0x26bebc===_0x4df999(0x156))return 0x1;try{const _0x386b1f=await database_1[_0x4df999(0x181)]['currencyRate'][_0x4df999(0x14b)]({'where':{'currency':_0x26bebc}});if(!_0x386b1f)return console[_0x4df999(0x16e)](_0x4df999(0x18a)+_0x745427+_0x4df999(0x13c)),0x1;return _0x386b1f[_0x4df999(0x17c)];}catch(_0x435b02){return console[_0x4df999(0x168)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x745427+':',_0x435b02),0x1;}}async[a38_0x1480ae(0x189)](_0x30ec81,_0xf6017c){const _0x1a59f6=a38_0x1480ae,_0x3e62b0=_0xf6017c[_0x1a59f6(0x142)]();if(_0x3e62b0==='usdt'){const _0x4bc0b4=_0x30ec81*(0x1+this[_0x1a59f6(0x1a2)]/0x64);return console[_0x1a59f6(0x152)](_0x1a59f6(0x1aa)+this[_0x1a59f6(0x1a2)]+_0x1a59f6(0x17f)+_0x30ec81+'\x20USDT\x20=\x20'+_0x4bc0b4['toFixed'](0x6)+'\x20USDT'),_0x4bc0b4;}try{const _0x46a6c1=await this['getCurrencyRate'](_0x3e62b0),_0x20a11a=_0x30ec81/_0x46a6c1,_0x8b3cfd=_0x20a11a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x1a59f6(0x152)](_0x1a59f6(0x144)+_0x30ec81+'\x20'+_0xf6017c[_0x1a59f6(0x160)]()+'\x20to\x20'+_0x20a11a[_0x1a59f6(0x132)](0x6)+'\x20USDT,\x20with\x20'+this[_0x1a59f6(0x1a2)]+_0x1a59f6(0x147)+_0x8b3cfd[_0x1a59f6(0x132)](0x6)+_0x1a59f6(0x134)+_0x46a6c1+')'),_0x8b3cfd;}catch(_0x26705c){console['error'](_0x1a59f6(0x164)+_0x30ec81+'\x20'+_0xf6017c+_0x1a59f6(0x183),_0x26705c);const _0x8eac9d=_0x30ec81*(0x1+this[_0x1a59f6(0x1a2)]/0x64);return _0x8eac9d;}}async[a38_0x1480ae(0x16b)](_0x54b832){const _0x1503d5=a38_0x1480ae;let _0x523903=0x0;for(const {amount:_0x30846a,currency:_0x422efb}of _0x54b832){const _0x32a416=await this[_0x1503d5(0x189)](_0x30846a,_0x422efb);_0x523903+=_0x32a416;}return _0x523903;}async[a38_0x1480ae(0x1ad)](){const _0x1aa07c=a38_0x1480ae;try{const _0x43d51b=await database_1[_0x1aa07c(0x181)]['currencyRate'][_0x1aa07c(0x170)]({'select':{'currency':!![],'rate':!![]}}),_0x10b2b0={'usdt':0x1};return _0x43d51b['forEach'](_0x18fe8f=>{const _0x4ea278=_0x1aa07c;_0x10b2b0[_0x18fe8f[_0x4ea278(0x175)]]=_0x18fe8f[_0x4ea278(0x17c)];}),_0x10b2b0;}catch(_0x267828){return console[_0x1aa07c(0x168)](_0x1aa07c(0x138),_0x267828),{'usdt':0x1};}}async['getRatesStatus'](){const _0x14d7ca=a38_0x1480ae;try{const [_0x12aee9,_0x370797,_0x143696]=await Promise[_0x14d7ca(0x1a0)]([database_1[_0x14d7ca(0x181)][_0x14d7ca(0x146)][_0x14d7ca(0x143)](),database_1[_0x14d7ca(0x181)][_0x14d7ca(0x146)][_0x14d7ca(0x19c)]({'orderBy':{'updatedAt':_0x14d7ca(0x190)},'select':{'updatedAt':!![]}}),database_1[_0x14d7ca(0x181)]['currencyRate'][_0x14d7ca(0x19c)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x12aee9,'lastUpdated':_0x370797?.['updatedAt']||null,'oldestRate':_0x143696?.['updatedAt']||null,'markupPercentage':this[_0x14d7ca(0x1a2)]};}catch(_0x27ccb8){return console[_0x14d7ca(0x168)](_0x14d7ca(0x184),_0x27ccb8),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x14d7ca(0x1a2)]};}}['getMarkupPercentage'](){const _0x5dcf0e=a38_0x1480ae;return this[_0x5dcf0e(0x1a2)];}}function a38_0x193a(){const _0x54ff59=['toLowerCase','count','üí±\x20Converted\x20','updateInterval','currencyRate','%\x20markup\x20=\x20','allSettled','dot','dkk','findUnique','catch','eos','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','COINGECKO_URL','json','log','../config/database','stopPeriodicUpdates','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','usdt','rub','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','sgd','inr','link','keys','kwd','eur','gbp','toUpperCase','4687506wPEQBV','üìä\x20Received\x20rates\x20for\x20','defineProperty','Error\x20converting\x20','sats','Failed\x20to\x20update\x20rate\x20for\x20','cad','error','nok','bits','convertMultipleToUSDT','brl','tether','warn','bdt','findMany','entries','aud','thb','usd','currency','krw','currencyService','1489822MTZIAx','xag','vef','ltc','rate','666576IZjPmh','jpy','%\x20markup\x20to\x20','startPeriodicUpdates','default','mxn','\x20to\x20USDT:','Error\x20getting\x20rates\x20status:','xrp','btc','length','ngn','convertToUSDT','No\x20rate\x20found\x20for\x20currency:\x20','bmd','eth','huf','aed','map','desc','https://api.coingecko.com/api/v3/simple/price','statusText','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','nzd','gel','myr','9839024msbXfB','5656028PEluwB','Periodic\x20currency\x20rates\x20update\x20failed:','864642jLXeZd','zar','findFirst','application/json','php','TesSoft\x20Payment\x20System/1.0','all','CoinGecko\x20API\x20error:\x20','MARKUP_PERCENTAGE','mmk','pln','twd','ars','5vxHEIk','2531608qBrjNF','bch','üí±\x20Applied\x20','xdr','\x20currencies','getAllRates','cny','CURRENCIES','Initial\x20currency\x20rates\x20update\x20failed:','toFixed','?ids=tether&vs_currencies=','\x20USDT\x20(rate:\x20','CurrencyService','uah','join','Error\x20getting\x20all\x20rates:','try','xau','__esModule',',\x20using\x201\x20as\x20fallback','updateCurrencyRates','vnd','xlm','sek','ils'];a38_0x193a=function(){return _0x54ff59;};return a38_0x193a();}exports[a38_0x1480ae(0x135)]=CurrencyService,exports['currencyService']=new CurrencyService();