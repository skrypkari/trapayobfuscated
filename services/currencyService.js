'use strict';const a43_0x5bc661=a43_0x4678;(function(_0x344c5a,_0x5c2527){const _0x66879a=a43_0x4678,_0x254f34=_0x344c5a();while(!![]){try{const _0x4fa3ca=-parseInt(_0x66879a(0x176))/0x1*(parseInt(_0x66879a(0x1a4))/0x2)+parseInt(_0x66879a(0x1cd))/0x3+-parseInt(_0x66879a(0x17a))/0x4+parseInt(_0x66879a(0x185))/0x5+-parseInt(_0x66879a(0x16e))/0x6*(parseInt(_0x66879a(0x197))/0x7)+parseInt(_0x66879a(0x19b))/0x8*(parseInt(_0x66879a(0x19d))/0x9)+parseInt(_0x66879a(0x19c))/0xa*(parseInt(_0x66879a(0x1b3))/0xb);if(_0x4fa3ca===_0x5c2527)break;else _0x254f34['push'](_0x254f34['shift']());}catch(_0x2e1412){_0x254f34['push'](_0x254f34['shift']());}}}(a43_0x2c88,0x6d8e8));var __importDefault=this&&this[a43_0x5bc661(0x18e)]||function(_0x3eb01){const _0x48d5fc=a43_0x5bc661;return _0x3eb01&&_0x3eb01[_0x48d5fc(0x1ae)]?_0x3eb01:{'default':_0x3eb01};};Object['defineProperty'](exports,a43_0x5bc661(0x1ae),{'value':!![]}),exports['currencyService']=exports[a43_0x5bc661(0x180)]=void 0x0;function a43_0x4678(_0x109aa6,_0x2b0d96){const _0x2c8840=a43_0x2c88();return a43_0x4678=function(_0x467862,_0x34024a){_0x467862=_0x467862-0x16c;let _0x477048=_0x2c8840[_0x467862];return _0x477048;},a43_0x4678(_0x109aa6,_0x2b0d96);}const database_1=__importDefault(require(a43_0x5bc661(0x1b9)));function a43_0x2c88(){const _0x2df2cc=['gbp','convertMultipleToUSDT','brl','getCurrencyRate','847038PbCbqm','aed','Error\x20getting\x20rates\x20status:','rub','847520ETIMDt','sar','xrp','zar','xau','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','CurrencyService','updatedAt','findUnique','statusText','?ids=tether&vs_currencies=','2021790COnUem','gel','\x20USDT,\x20with\x20','ils','toUpperCase','currencyRate','getRatesStatus','%\x20markup\x20=\x20',',\x20using\x201\x20as\x20fallback','__importDefault','cad','chf','toFixed','asc','huf','MARKUP_PERCENTAGE','thb','📊\x20Received\x20rates\x20for\x20','242123APWYTb','currencyService','COINGECKO_URL','convertToUSDT','1042008fpxZbY','60RecZJn','9RvXzNe','Payment\x20System/1.0','getMarkupPercentage','xdr','❌\x20Failed\x20to\x20update\x20currency\x20rates:','jpy','ngn','2NxKDav','eur','count','desc','Error\x20getting\x20all\x20rates:','length','nok','bch','stopPeriodicUpdates','try','__esModule','xag','tether','hkd','bdt','2278111zEtzmV','💱\x20Applied\x20','startPeriodicUpdates','upsert','twd','bhd','../config/database','error','cny','sek','xlm','eos','Failed\x20to\x20update\x20rate\x20for\x20','rate','updateInterval','https://api.coingecko.com/api/v3/simple/price','Initial\x20currency\x20rates\x20update\x20failed:','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','entries','catch','getAllRates','✅\x20Currency\x20rates\x20updated\x20successfully','CURRENCIES','💱\x20Converted\x20','bmd','currency','1474215ZwdWyb','\x20to\x20','\x20USDT','php','myr','all','forEach','json','usd','idr','Error\x20converting\x20','CoinGecko\x20API\x20error:\x20','application/json','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','warn','map','bnb','usdt','log','sgd','status','findFirst','\x20USDT\x20=\x20','mmk','keys','ars','mxn','link','nzd','pkr','default','132LltqvQ','inr','toLowerCase','updateCurrencyRates'];a43_0x2c88=function(){return _0x2df2cc;};return a43_0x2c88();}class CurrencyService{constructor(){const _0x1873f0=a43_0x5bc661;this[_0x1873f0(0x199)]=_0x1873f0(0x1c2),this[_0x1873f0(0x1c9)]=['btc','eth','ltc',_0x1873f0(0x1ab),_0x1873f0(0x1dd),_0x1873f0(0x1be),_0x1873f0(0x17c),_0x1873f0(0x1bd),_0x1873f0(0x1e8),'dot','yfi',_0x1873f0(0x1d5),_0x1873f0(0x177),_0x1873f0(0x1e6),'aud',_0x1873f0(0x1b2),_0x1873f0(0x1b8),_0x1873f0(0x1cb),_0x1873f0(0x174),_0x1873f0(0x18f),_0x1873f0(0x190),'clp',_0x1873f0(0x1bb),'czk','dkk',_0x1873f0(0x1a5),_0x1873f0(0x172),_0x1873f0(0x186),_0x1873f0(0x1b1),_0x1873f0(0x193),_0x1873f0(0x1d6),_0x1873f0(0x188),_0x1873f0(0x16f),_0x1873f0(0x1a2),'krw','kwd','lkr',_0x1873f0(0x1e4),_0x1873f0(0x1e7),_0x1873f0(0x1d1),_0x1873f0(0x1a3),_0x1873f0(0x1aa),_0x1873f0(0x1e9),_0x1873f0(0x1d0),_0x1873f0(0x16c),'pln',_0x1873f0(0x179),_0x1873f0(0x17b),_0x1873f0(0x1bc),_0x1873f0(0x1e0),_0x1873f0(0x195),_0x1873f0(0x1ad),_0x1873f0(0x1b7),'uah','vef','vnd',_0x1873f0(0x17d),_0x1873f0(0x1a0),_0x1873f0(0x1af),_0x1873f0(0x17e),'bits','sats'],this[_0x1873f0(0x1c1)]=null,this[_0x1873f0(0x194)]=-0x3,this[_0x1873f0(0x1b5)]();}[a43_0x5bc661(0x1b5)](){const _0x1d063c=a43_0x5bc661;this['updateCurrencyRates']()[_0x1d063c(0x1c6)](_0x7c10cb=>{const _0x10ba0a=_0x1d063c;console['error'](_0x10ba0a(0x1c3),_0x7c10cb);}),this['updateInterval']=setInterval(async()=>{const _0x8d54bf=_0x1d063c;try{await this[_0x8d54bf(0x171)]();}catch(_0x1234fb){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x1234fb);}},0x3c*0x3c*0x3e8),console[_0x1d063c(0x1df)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a43_0x5bc661(0x1ac)](){const _0x44a699=a43_0x5bc661;this[_0x44a699(0x1c1)]&&(clearInterval(this['updateInterval']),this[_0x44a699(0x1c1)]=null,console[_0x44a699(0x1df)](_0x44a699(0x1da)));}async[a43_0x5bc661(0x171)](){const _0x55e64b=a43_0x5bc661;try{console[_0x55e64b(0x1df)](_0x55e64b(0x1c4));const _0x3f62f1=this['CURRENCIES']['join'](','),_0x265874=this[_0x55e64b(0x199)]+_0x55e64b(0x184)+_0x3f62f1,_0x671dde=await fetch(_0x265874,{'headers':{'Accept':_0x55e64b(0x1d9),'User-Agent':_0x55e64b(0x19e)}});if(!_0x671dde['ok'])throw new Error(_0x55e64b(0x1d8)+_0x671dde[_0x55e64b(0x1e1)]+'\x20'+_0x671dde[_0x55e64b(0x183)]);const _0x55bedd=await _0x671dde[_0x55e64b(0x1d4)]();if(!_0x55bedd[_0x55e64b(0x1b0)])throw new Error(_0x55e64b(0x17f));const _0xcc26b3=_0x55bedd[_0x55e64b(0x1b0)];console['log'](_0x55e64b(0x196)+Object[_0x55e64b(0x1e5)](_0xcc26b3)[_0x55e64b(0x1a9)]+'\x20currencies');const _0x2dc7d8=Object[_0x55e64b(0x1c5)](_0xcc26b3)[_0x55e64b(0x1dc)](async([_0x5489fd,_0x401f68])=>{const _0x382023=_0x55e64b;try{await database_1[_0x382023(0x16d)][_0x382023(0x18a)][_0x382023(0x1b6)]({'where':{'currency':_0x5489fd[_0x382023(0x170)]()},'update':{'rate':_0x401f68},'create':{'currency':_0x5489fd[_0x382023(0x170)](),'rate':_0x401f68}});}catch(_0x3828d4){console[_0x382023(0x1ba)](_0x382023(0x1bf)+_0x5489fd+':',_0x3828d4);}});await Promise['allSettled'](_0x2dc7d8),console[_0x55e64b(0x1df)](_0x55e64b(0x1c8));}catch(_0x417eab){console[_0x55e64b(0x1ba)](_0x55e64b(0x1a1),_0x417eab);throw _0x417eab;}}async[a43_0x5bc661(0x175)](_0x1f80ab){const _0x17c581=a43_0x5bc661,_0x3e3912=_0x1f80ab[_0x17c581(0x170)]();if(_0x3e3912===_0x17c581(0x1de))return 0x1;try{const _0x279935=await database_1['default'][_0x17c581(0x18a)][_0x17c581(0x182)]({'where':{'currency':_0x3e3912}});if(!_0x279935)return console[_0x17c581(0x1db)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x1f80ab+_0x17c581(0x18d)),0x1;return _0x279935[_0x17c581(0x1c0)];}catch(_0xa8ff64){return console[_0x17c581(0x1ba)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1f80ab+':',_0xa8ff64),0x1;}}async[a43_0x5bc661(0x19a)](_0x44fe5d,_0x25026f){const _0x5d1d6b=a43_0x5bc661,_0x1e3395=_0x25026f[_0x5d1d6b(0x170)]();if(_0x1e3395===_0x5d1d6b(0x1de)){const _0x4d6623=_0x44fe5d*(0x1+this[_0x5d1d6b(0x194)]/0x64);return console[_0x5d1d6b(0x1df)](_0x5d1d6b(0x1b4)+this[_0x5d1d6b(0x194)]+'%\x20markup\x20to\x20'+_0x44fe5d+_0x5d1d6b(0x1e3)+_0x4d6623['toFixed'](0x6)+_0x5d1d6b(0x1cf)),_0x4d6623;}try{const _0x50b537=await this[_0x5d1d6b(0x175)](_0x1e3395),_0x4ee9e6=_0x44fe5d/_0x50b537,_0x30bc33=_0x4ee9e6*(0x1+this[_0x5d1d6b(0x194)]/0x64);return console[_0x5d1d6b(0x1df)](_0x5d1d6b(0x1ca)+_0x44fe5d+'\x20'+_0x25026f[_0x5d1d6b(0x189)]()+_0x5d1d6b(0x1ce)+_0x4ee9e6[_0x5d1d6b(0x191)](0x6)+_0x5d1d6b(0x187)+this[_0x5d1d6b(0x194)]+_0x5d1d6b(0x18c)+_0x30bc33[_0x5d1d6b(0x191)](0x6)+'\x20USDT\x20(rate:\x20'+_0x50b537+')'),_0x30bc33;}catch(_0x233244){console['error'](_0x5d1d6b(0x1d7)+_0x44fe5d+'\x20'+_0x25026f+'\x20to\x20USDT:',_0x233244);const _0x3cdfbc=_0x44fe5d*(0x1+this[_0x5d1d6b(0x194)]/0x64);return _0x3cdfbc;}}async[a43_0x5bc661(0x173)](_0x61806a){let _0x49576a=0x0;for(const {amount:_0x3eccf1,currency:_0x51d6d9}of _0x61806a){const _0x15b534=await this['convertToUSDT'](_0x3eccf1,_0x51d6d9);_0x49576a+=_0x15b534;}return _0x49576a;}async[a43_0x5bc661(0x1c7)](){const _0x5dee1b=a43_0x5bc661;try{const _0x465158=await database_1[_0x5dee1b(0x16d)][_0x5dee1b(0x18a)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x4977b4={'usdt':0x1};return _0x465158[_0x5dee1b(0x1d3)](_0x5d8568=>{const _0x5957c4=_0x5dee1b;_0x4977b4[_0x5d8568[_0x5957c4(0x1cc)]]=_0x5d8568[_0x5957c4(0x1c0)];}),_0x4977b4;}catch(_0x467999){return console[_0x5dee1b(0x1ba)](_0x5dee1b(0x1a8),_0x467999),{'usdt':0x1};}}async[a43_0x5bc661(0x18b)](){const _0x51caec=a43_0x5bc661;try{const [_0x482f6d,_0x26253e,_0x27fd00]=await Promise[_0x51caec(0x1d2)]([database_1[_0x51caec(0x16d)][_0x51caec(0x18a)][_0x51caec(0x1a6)](),database_1[_0x51caec(0x16d)][_0x51caec(0x18a)][_0x51caec(0x1e2)]({'orderBy':{'updatedAt':_0x51caec(0x1a7)},'select':{'updatedAt':!![]}}),database_1[_0x51caec(0x16d)]['currencyRate'][_0x51caec(0x1e2)]({'orderBy':{'updatedAt':_0x51caec(0x192)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x482f6d,'lastUpdated':_0x26253e?.[_0x51caec(0x181)]||null,'oldestRate':_0x27fd00?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x53f59a){return console[_0x51caec(0x1ba)](_0x51caec(0x178),_0x53f59a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x51caec(0x194)]};}}[a43_0x5bc661(0x19f)](){const _0x23087a=a43_0x5bc661;return this[_0x23087a(0x194)];}}exports['CurrencyService']=CurrencyService,exports[a43_0x5bc661(0x198)]=new CurrencyService();