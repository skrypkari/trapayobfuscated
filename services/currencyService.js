'use strict';const a39_0xd3d8c=a39_0x50e4;(function(_0x4dedb4,_0x54d240){const _0x10e25c=a39_0x50e4,_0x24708e=_0x4dedb4();while(!![]){try{const _0x30f33e=-parseInt(_0x10e25c(0x146))/0x1*(parseInt(_0x10e25c(0x157))/0x2)+-parseInt(_0x10e25c(0x158))/0x3*(parseInt(_0x10e25c(0x18e))/0x4)+parseInt(_0x10e25c(0x1b6))/0x5+-parseInt(_0x10e25c(0x183))/0x6+parseInt(_0x10e25c(0x174))/0x7+-parseInt(_0x10e25c(0x1ac))/0x8*(-parseInt(_0x10e25c(0x19b))/0x9)+-parseInt(_0x10e25c(0x166))/0xa;if(_0x30f33e===_0x54d240)break;else _0x24708e['push'](_0x24708e['shift']());}catch(_0x38f60c){_0x24708e['push'](_0x24708e['shift']());}}}(a39_0x5cc1,0x508e2));var __importDefault=this&&this[a39_0xd3d8c(0x14c)]||function(_0x4fe2f8){const _0x488116=a39_0xd3d8c;return _0x4fe2f8&&_0x4fe2f8[_0x488116(0x160)]?_0x4fe2f8:{'default':_0x4fe2f8};};Object[a39_0xd3d8c(0x16b)](exports,a39_0xd3d8c(0x160),{'value':!![]}),exports[a39_0xd3d8c(0x193)]=exports[a39_0xd3d8c(0x149)]=void 0x0;const database_1=__importDefault(require(a39_0xd3d8c(0x19f)));class CurrencyService{constructor(){const _0x241a86=a39_0xd3d8c;this[_0x241a86(0x19c)]=_0x241a86(0x182),this['CURRENCIES']=[_0x241a86(0x1a7),'eth',_0x241a86(0x162),_0x241a86(0x177),_0x241a86(0x185),_0x241a86(0x15c),_0x241a86(0x1a1),_0x241a86(0x18c),_0x241a86(0x15f),_0x241a86(0x142),_0x241a86(0x1ab),'usd',_0x241a86(0x140),'ars',_0x241a86(0x16c),_0x241a86(0x187),_0x241a86(0x192),_0x241a86(0x168),_0x241a86(0x152),'cad',_0x241a86(0x15e),_0x241a86(0x1a4),_0x241a86(0x13d),'czk',_0x241a86(0x1a0),'eur',_0x241a86(0x171),_0x241a86(0x19e),_0x241a86(0x19a),_0x241a86(0x13e),_0x241a86(0x1a8),'ils',_0x241a86(0x17a),_0x241a86(0x155),_0x241a86(0x18f),'kwd','lkr',_0x241a86(0x17d),_0x241a86(0x163),'myr',_0x241a86(0x172),'nok',_0x241a86(0x154),_0x241a86(0x189),_0x241a86(0x13b),'pln',_0x241a86(0x14b),_0x241a86(0x194),_0x241a86(0x184),'sgd',_0x241a86(0x1aa),_0x241a86(0x156),'twd',_0x241a86(0x173),_0x241a86(0x18d),_0x241a86(0x190),_0x241a86(0x197),_0x241a86(0x186),_0x241a86(0x198),_0x241a86(0x18b),_0x241a86(0x161),_0x241a86(0x17b)],this[_0x241a86(0x14f)]=null,this[_0x241a86(0x14a)]=0x3,this['startPeriodicUpdates']();}[a39_0xd3d8c(0x181)](){const _0x4a854e=a39_0xd3d8c;this[_0x4a854e(0x14d)]()[_0x4a854e(0x1b5)](_0xf523d8=>{const _0x227fda=_0x4a854e;console[_0x227fda(0x1af)](_0x227fda(0x150),_0xf523d8);}),this[_0x4a854e(0x14f)]=setInterval(async()=>{const _0x540990=_0x4a854e;try{await this[_0x540990(0x14d)]();}catch(_0x56e950){console[_0x540990(0x1af)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x56e950);}},0x3c*0x3c*0x3e8),console['log']('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0xd3d8c(0x164)](){const _0x500a55=a39_0xd3d8c;this[_0x500a55(0x14f)]&&(clearInterval(this[_0x500a55(0x14f)]),this['updateInterval']=null,console['log'](_0x500a55(0x191)));}async['updateCurrencyRates'](){const _0x21a008=a39_0xd3d8c;try{console[_0x21a008(0x16a)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x4ecfc2=this[_0x21a008(0x151)]['join'](','),_0x5e8220=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x4ecfc2,_0x3fdc17=await fetch(_0x5e8220,{'headers':{'Accept':_0x21a008(0x1b1),'User-Agent':_0x21a008(0x165)}});if(!_0x3fdc17['ok'])throw new Error(_0x21a008(0x144)+_0x3fdc17[_0x21a008(0x1a9)]+'\x20'+_0x3fdc17['statusText']);const _0x4be8ef=await _0x3fdc17[_0x21a008(0x145)]();if(!_0x4be8ef[_0x21a008(0x153)])throw new Error(_0x21a008(0x199));const _0x274e11=_0x4be8ef[_0x21a008(0x153)];console['log'](_0x21a008(0x14e)+Object['keys'](_0x274e11)[_0x21a008(0x167)]+_0x21a008(0x141));const _0x3ecf4a=Object[_0x21a008(0x178)](_0x274e11)[_0x21a008(0x1b4)](async([_0x27875d,_0x63bc23])=>{const _0x2d8861=_0x21a008;try{await database_1[_0x2d8861(0x17e)][_0x2d8861(0x170)][_0x2d8861(0x147)]({'where':{'currency':_0x27875d[_0x2d8861(0x16f)]()},'update':{'rate':_0x63bc23},'create':{'currency':_0x27875d[_0x2d8861(0x16f)](),'rate':_0x63bc23}});}catch(_0x4a2737){console[_0x2d8861(0x1af)](_0x2d8861(0x1b0)+_0x27875d+':',_0x4a2737);}});await Promise[_0x21a008(0x1b3)](_0x3ecf4a),console[_0x21a008(0x16a)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x472694){console[_0x21a008(0x1af)](_0x21a008(0x13f),_0x472694);throw _0x472694;}}async[a39_0xd3d8c(0x19d)](_0x549ad2){const _0x1bc443=a39_0xd3d8c,_0x5aa57f=_0x549ad2['toLowerCase']();if(_0x5aa57f===_0x1bc443(0x15d))return 0x1;try{const _0xea080b=await database_1['default'][_0x1bc443(0x170)][_0x1bc443(0x188)]({'where':{'currency':_0x5aa57f}});if(!_0xea080b)return console[_0x1bc443(0x1a5)](_0x1bc443(0x195)+_0x549ad2+',\x20using\x201\x20as\x20fallback'),0x1;return _0xea080b['rate'];}catch(_0x3b9715){return console[_0x1bc443(0x1af)](_0x1bc443(0x17c)+_0x549ad2+':',_0x3b9715),0x1;}}async[a39_0xd3d8c(0x1ae)](_0x1db4fb,_0x4e52d2){const _0x2dec7d=a39_0xd3d8c,_0x5970c7=_0x4e52d2[_0x2dec7d(0x16f)]();if(_0x5970c7===_0x2dec7d(0x15d)){const _0x30dd88=_0x1db4fb*(0x1+this[_0x2dec7d(0x14a)]/0x64);return console[_0x2dec7d(0x16a)](_0x2dec7d(0x15b)+this[_0x2dec7d(0x14a)]+_0x2dec7d(0x148)+_0x1db4fb+_0x2dec7d(0x17f)+_0x30dd88['toFixed'](0x6)+_0x2dec7d(0x175)),_0x30dd88;}try{const _0x1bbaf0=await this[_0x2dec7d(0x19d)](_0x5970c7),_0x54f028=_0x1db4fb/_0x1bbaf0,_0x53488a=_0x54f028*(0x1+this[_0x2dec7d(0x14a)]/0x64);return console['log'](_0x2dec7d(0x143)+_0x1db4fb+'\x20'+_0x4e52d2[_0x2dec7d(0x169)]()+'\x20to\x20'+_0x54f028[_0x2dec7d(0x1a6)](0x6)+_0x2dec7d(0x18a)+this[_0x2dec7d(0x14a)]+_0x2dec7d(0x13c)+_0x53488a[_0x2dec7d(0x1a6)](0x6)+'\x20USDT\x20(rate:\x20'+_0x1bbaf0+')'),_0x53488a;}catch(_0x4ee87f){console[_0x2dec7d(0x1af)](_0x2dec7d(0x1ad)+_0x1db4fb+'\x20'+_0x4e52d2+'\x20to\x20USDT:',_0x4ee87f);const _0x29e2ec=_0x1db4fb*(0x1+this[_0x2dec7d(0x14a)]/0x64);return _0x29e2ec;}}async['convertMultipleToUSDT'](_0x41997e){const _0x4833bc=a39_0xd3d8c;let _0x4f8689=0x0;for(const {amount:_0x1ba202,currency:_0xdaa9a9}of _0x41997e){const _0x9a7e90=await this[_0x4833bc(0x1ae)](_0x1ba202,_0xdaa9a9);_0x4f8689+=_0x9a7e90;}return _0x4f8689;}async['getAllRates'](){const _0x46dd4b=a39_0xd3d8c;try{const _0x252164=await database_1[_0x46dd4b(0x17e)][_0x46dd4b(0x170)][_0x46dd4b(0x180)]({'select':{'currency':!![],'rate':!![]}}),_0x10b397={'usdt':0x1};return _0x252164[_0x46dd4b(0x1a3)](_0x39400a=>{const _0x37d634=_0x46dd4b;_0x10b397[_0x39400a[_0x37d634(0x159)]]=_0x39400a[_0x37d634(0x176)];}),_0x10b397;}catch(_0x23d281){return console[_0x46dd4b(0x1af)](_0x46dd4b(0x15a),_0x23d281),{'usdt':0x1};}}async[a39_0xd3d8c(0x1b2)](){const _0x423620=a39_0xd3d8c;try{const [_0x5c57bc,_0x58ece8,_0xff80f7]=await Promise['all']([database_1[_0x423620(0x17e)][_0x423620(0x170)][_0x423620(0x1a2)](),database_1[_0x423620(0x17e)][_0x423620(0x170)]['findFirst']({'orderBy':{'updatedAt':_0x423620(0x16e)},'select':{'updatedAt':!![]}}),database_1[_0x423620(0x17e)][_0x423620(0x170)]['findFirst']({'orderBy':{'updatedAt':_0x423620(0x16d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5c57bc,'lastUpdated':_0x58ece8?.[_0x423620(0x196)]||null,'oldestRate':_0xff80f7?.['updatedAt']||null,'markupPercentage':this[_0x423620(0x14a)]};}catch(_0x32dd97){return console['error']('Error\x20getting\x20rates\x20status:',_0x32dd97),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x423620(0x14a)]};}}[a39_0xd3d8c(0x179)](){return this['MARKUP_PERCENTAGE'];}}function a39_0x5cc1(){const _0x3f5332=['Initial\x20currency\x20rates\x20update\x20failed:','CURRENCIES','brl','tether','nzd','jpy','try','678MrnXJd','9NnWizf','currency','Error\x20getting\x20all\x20rates:','üí±\x20Applied\x20','eos','usdt','chf','link','__esModule','bits','ltc','mxn','stopPeriodicUpdates','TesSoft\x20Payment\x20System/1.0','2212830lVlZUj','length','bmd','toUpperCase','log','defineProperty','aud','asc','desc','toLowerCase','currencyRate','gbp','ngn','uah','3808973SSOFoe','\x20USDT','rate','bch','entries','getMarkupPercentage','inr','sats','Error\x20getting\x20rate\x20for\x20currency\x20','mmk','default','\x20USDT\x20=\x20','findMany','startPeriodicUpdates','https://api.coingecko.com/api/v3/simple/price','90294ARNWlc','sek','bnb','xdr','bdt','findUnique','php','\x20USDT,\x20with\x20','xau','xlm','vef','413772UAPeVU','krw','vnd','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','bhd','currencyService','sar','No\x20rate\x20found\x20for\x20currency:\x20','updatedAt','zar','xag','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','hkd','108uwMztJ','COINGECKO_URL','getCurrencyRate','gel','../config/database','dkk','xrp','count','forEach','clp','warn','toFixed','btc','idr','status','thb','yfi','136760SiGHiP','Error\x20converting\x20','convertToUSDT','error','Failed\x20to\x20update\x20rate\x20for\x20','application/json','getRatesStatus','allSettled','map','catch','1031615WcSKqV','pkr','%\x20markup\x20=\x20','cny','huf','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','aed','\x20currencies','dot','üí±\x20Converted\x20','CoinGecko\x20API\x20error:\x20','json','233GVBLuP','upsert','%\x20markup\x20to\x20','CurrencyService','MARKUP_PERCENTAGE','rub','__importDefault','updateCurrencyRates','üìä\x20Received\x20rates\x20for\x20','updateInterval'];a39_0x5cc1=function(){return _0x3f5332;};return a39_0x5cc1();}function a39_0x50e4(_0x6cc315,_0x5880df){const _0x5cc14e=a39_0x5cc1();return a39_0x50e4=function(_0x50e447,_0x1ce812){_0x50e447=_0x50e447-0x13b;let _0x594400=_0x5cc14e[_0x50e447];return _0x594400;},a39_0x50e4(_0x6cc315,_0x5880df);}exports[a39_0xd3d8c(0x149)]=CurrencyService,exports[a39_0xd3d8c(0x193)]=new CurrencyService();