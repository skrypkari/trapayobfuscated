'use strict';const a38_0x5a9427=a38_0x3e59;(function(_0x519d13,_0x77fa10){const _0x380354=a38_0x3e59,_0x5819f0=_0x519d13();while(!![]){try{const _0xf5ccd1=parseInt(_0x380354(0x1d8))/0x1*(parseInt(_0x380354(0x17c))/0x2)+-parseInt(_0x380354(0x1cb))/0x3+parseInt(_0x380354(0x1ad))/0x4*(-parseInt(_0x380354(0x1b6))/0x5)+parseInt(_0x380354(0x171))/0x6*(-parseInt(_0x380354(0x18a))/0x7)+-parseInt(_0x380354(0x1b1))/0x8*(-parseInt(_0x380354(0x1e2))/0x9)+-parseInt(_0x380354(0x1d6))/0xa+parseInt(_0x380354(0x1e3))/0xb;if(_0xf5ccd1===_0x77fa10)break;else _0x5819f0['push'](_0x5819f0['shift']());}catch(_0x164531){_0x5819f0['push'](_0x5819f0['shift']());}}}(a38_0x5ace,0xc7930));var __importDefault=this&&this[a38_0x5a9427(0x173)]||function(_0x2a5024){const _0x124a3b=a38_0x5a9427;return _0x2a5024&&_0x2a5024[_0x124a3b(0x1a9)]?_0x2a5024:{'default':_0x2a5024};};Object[a38_0x5a9427(0x1c9)](exports,a38_0x5a9427(0x1a9),{'value':!![]}),exports['currencyService']=exports[a38_0x5a9427(0x1a2)]=void 0x0;const database_1=__importDefault(require(a38_0x5a9427(0x196)));class CurrencyService{constructor(){const _0x39562c=a38_0x5a9427;this[_0x39562c(0x1d4)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x39562c(0x18b),_0x39562c(0x1d5),_0x39562c(0x1a4),_0x39562c(0x16e),_0x39562c(0x1c1),'eos',_0x39562c(0x17f),'xlm','link',_0x39562c(0x17d),_0x39562c(0x181),_0x39562c(0x1b2),_0x39562c(0x16d),_0x39562c(0x18c),_0x39562c(0x1df),'bdt',_0x39562c(0x1e5),_0x39562c(0x1e4),_0x39562c(0x1c4),'cad',_0x39562c(0x16f),_0x39562c(0x191),'cny',_0x39562c(0x192),_0x39562c(0x195),_0x39562c(0x189),_0x39562c(0x1ba),'gel',_0x39562c(0x180),_0x39562c(0x19b),_0x39562c(0x17b),_0x39562c(0x1c5),_0x39562c(0x177),'jpy',_0x39562c(0x1b7),'kwd','lkr',_0x39562c(0x17e),_0x39562c(0x1af),'myr','ngn',_0x39562c(0x1a7),_0x39562c(0x19d),'php',_0x39562c(0x198),_0x39562c(0x1cd),_0x39562c(0x1b3),_0x39562c(0x186),_0x39562c(0x199),'sgd',_0x39562c(0x1c7),_0x39562c(0x1cc),_0x39562c(0x185),_0x39562c(0x1d2),_0x39562c(0x1dc),'vnd','zar',_0x39562c(0x190),_0x39562c(0x175),_0x39562c(0x18f),'bits',_0x39562c(0x1dd)],this[_0x39562c(0x1a8)]=null,this[_0x39562c(0x1d3)]=0x3,this[_0x39562c(0x1a3)]();}[a38_0x5a9427(0x1a3)](){const _0x40216d=a38_0x5a9427;this['updateCurrencyRates']()[_0x40216d(0x193)](_0x15a60d=>{const _0x2ccad4=_0x40216d;console[_0x2ccad4(0x1ab)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x15a60d);}),this['updateInterval']=setInterval(async()=>{const _0x445291=_0x40216d;try{await this[_0x445291(0x1e6)]();}catch(_0x832f7b){console[_0x445291(0x1ab)](_0x445291(0x179),_0x832f7b);}},0x3c*0x3c*0x3e8),console[_0x40216d(0x19f)](_0x40216d(0x1aa));}[a38_0x5a9427(0x197)](){const _0x3fc18b=a38_0x5a9427;this['updateInterval']&&(clearInterval(this[_0x3fc18b(0x1a8)]),this[_0x3fc18b(0x1a8)]=null,console['log'](_0x3fc18b(0x184)));}async[a38_0x5a9427(0x1e6)](){const _0x12eaea=a38_0x5a9427;try{console['log'](_0x12eaea(0x1c8));const _0x2e998b=this[_0x12eaea(0x1b0)]['join'](','),_0x436260=this[_0x12eaea(0x1d4)]+'?ids=tether&vs_currencies='+_0x2e998b,_0x165f03=await fetch(_0x436260,{'headers':{'Accept':_0x12eaea(0x174),'User-Agent':_0x12eaea(0x1e7)}});if(!_0x165f03['ok'])throw new Error(_0x12eaea(0x1b8)+_0x165f03[_0x12eaea(0x1a6)]+'\x20'+_0x165f03['statusText']);const _0x469f98=await _0x165f03[_0x12eaea(0x1a5)]();if(!_0x469f98['tether'])throw new Error(_0x12eaea(0x176));const _0x25e615=_0x469f98['tether'];console['log'](_0x12eaea(0x1d1)+Object[_0x12eaea(0x187)](_0x25e615)['length']+_0x12eaea(0x18e));const _0xb74840=Object[_0x12eaea(0x170)](_0x25e615)[_0x12eaea(0x19e)](async([_0x598c5d,_0x434245])=>{const _0x507d65=_0x12eaea;try{await database_1[_0x507d65(0x16c)]['currencyRate'][_0x507d65(0x18d)]({'where':{'currency':_0x598c5d['toLowerCase']()},'update':{'rate':_0x434245},'create':{'currency':_0x598c5d['toLowerCase'](),'rate':_0x434245}});}catch(_0x144e29){console[_0x507d65(0x1ab)](_0x507d65(0x19c)+_0x598c5d+':',_0x144e29);}});await Promise[_0x12eaea(0x1c3)](_0xb74840),console[_0x12eaea(0x19f)](_0x12eaea(0x1b5));}catch(_0x5f4f4d){console[_0x12eaea(0x1ab)](_0x12eaea(0x1b9),_0x5f4f4d);throw _0x5f4f4d;}}async[a38_0x5a9427(0x1d0)](_0x3df462){const _0x2981ef=a38_0x5a9427,_0x5d502e=_0x3df462[_0x2981ef(0x1bb)]();if(_0x5d502e==='usdt')return 0x1;try{const _0x18d26d=await database_1[_0x2981ef(0x16c)][_0x2981ef(0x1ae)][_0x2981ef(0x1a1)]({'where':{'currency':_0x5d502e}});if(!_0x18d26d)return console['warn'](_0x2981ef(0x1ca)+_0x3df462+_0x2981ef(0x1de)),0x1;return _0x18d26d[_0x2981ef(0x1bc)];}catch(_0x3936ab){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x3df462+':',_0x3936ab),0x1;}}async[a38_0x5a9427(0x182)](_0x19a187,_0x3d8ce2){const _0x524c12=a38_0x5a9427,_0x5bba9a=_0x3d8ce2['toLowerCase']();if(_0x5bba9a===_0x524c12(0x1bf)){const _0x1580fc=_0x19a187*(0x1+this[_0x524c12(0x1d3)]/0x64);return console[_0x524c12(0x19f)](_0x524c12(0x1bd)+this[_0x524c12(0x1d3)]+_0x524c12(0x1b4)+_0x19a187+_0x524c12(0x1ce)+_0x1580fc[_0x524c12(0x1d9)](0x6)+'\x20USDT'),_0x1580fc;}try{const _0x3ab16b=await this[_0x524c12(0x1d0)](_0x5bba9a),_0x5c5c3e=_0x19a187/_0x3ab16b,_0xbd992c=_0x5c5c3e*(0x1+this[_0x524c12(0x1d3)]/0x64);return console['log'](_0x524c12(0x1da)+_0x19a187+'\x20'+_0x3d8ce2[_0x524c12(0x1cf)]()+_0x524c12(0x1e8)+_0x5c5c3e[_0x524c12(0x1d9)](0x6)+_0x524c12(0x178)+this[_0x524c12(0x1d3)]+_0x524c12(0x1e0)+_0xbd992c[_0x524c12(0x1d9)](0x6)+_0x524c12(0x1c6)+_0x3ab16b+')'),_0xbd992c;}catch(_0x2c68f8){console['error'](_0x524c12(0x1c0)+_0x19a187+'\x20'+_0x3d8ce2+_0x524c12(0x1e1),_0x2c68f8);const _0x1b7a7a=_0x19a187*(0x1+this[_0x524c12(0x1d3)]/0x64);return _0x1b7a7a;}}async[a38_0x5a9427(0x183)](_0x537f7e){const _0xc3f4d5=a38_0x5a9427;let _0x490ccf=0x0;for(const {amount:_0xbc2fae,currency:_0x3f5667}of _0x537f7e){const _0x409b7c=await this[_0xc3f4d5(0x182)](_0xbc2fae,_0x3f5667);_0x490ccf+=_0x409b7c;}return _0x490ccf;}async['getAllRates'](){const _0x5415d7=a38_0x5a9427;try{const _0x15e139=await database_1[_0x5415d7(0x16c)][_0x5415d7(0x1ae)][_0x5415d7(0x1a0)]({'select':{'currency':!![],'rate':!![]}}),_0xb0762={'usdt':0x1};return _0x15e139[_0x5415d7(0x1be)](_0x2d07ca=>{const _0x32262d=_0x5415d7;_0xb0762[_0x2d07ca[_0x32262d(0x1ac)]]=_0x2d07ca[_0x32262d(0x1bc)];}),_0xb0762;}catch(_0x2b4332){return console['error'](_0x5415d7(0x1db),_0x2b4332),{'usdt':0x1};}}async[a38_0x5a9427(0x1c2)](){const _0x4a7632=a38_0x5a9427;try{const [_0x176bbb,_0x42d5dc,_0x158df4]=await Promise['all']([database_1[_0x4a7632(0x16c)][_0x4a7632(0x1ae)][_0x4a7632(0x17a)](),database_1[_0x4a7632(0x16c)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x4a7632(0x16c)][_0x4a7632(0x1ae)][_0x4a7632(0x194)]({'orderBy':{'updatedAt':_0x4a7632(0x172)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x176bbb,'lastUpdated':_0x42d5dc?.['updatedAt']||null,'oldestRate':_0x158df4?.[_0x4a7632(0x19a)]||null,'markupPercentage':this[_0x4a7632(0x1d3)]};}catch(_0x2e00cf){return console[_0x4a7632(0x1ab)]('Error\x20getting\x20rates\x20status:',_0x2e00cf),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4a7632(0x1d3)]};}}[a38_0x5a9427(0x1d7)](){const _0x139eda=a38_0x5a9427;return this[_0x139eda(0x1d3)];}}function a38_0x3e59(_0xfa24ef,_0x24e5db){const _0x5ace00=a38_0x5ace();return a38_0x3e59=function(_0x3e593e,_0x42819d){_0x3e593e=_0x3e593e-0x16c;let _0x49d776=_0x5ace00[_0x3e593e];return _0x49d776;},a38_0x3e59(_0xfa24ef,_0x24e5db);}exports[a38_0x5a9427(0x1a2)]=CurrencyService,exports[a38_0x5a9427(0x188)]=new CurrencyService();function a38_0x5ace(){const _0x257d3d=['vef','sats',',\x20using\x201\x20as\x20fallback','aud','%\x20markup\x20=\x20','\x20to\x20USDT:','144nzSHIo','35977887IGXrHr','bmd','bhd','updateCurrencyRates','TesSoft\x20Payment\x20System/1.0','\x20to\x20','default','aed','bch','chf','entries','397626zuRZAm','asc','__importDefault','application/json','xag','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','inr','\x20USDT,\x20with\x20','Periodic\x20currency\x20rates\x20update\x20failed:','count','idr','446CdBEnb','dot','mmk','xrp','hkd','yfi','convertToUSDT','convertMultipleToUSDT','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','twd','sar','keys','currencyService','eur','168RQsjHM','btc','ars','upsert','\x20currencies','xau','xdr','clp','czk','catch','findFirst','dkk','../config/database','stopPeriodicUpdates','pkr','sek','updatedAt','huf','Failed\x20to\x20update\x20rate\x20for\x20','nzd','map','log','findMany','findUnique','CurrencyService','startPeriodicUpdates','ltc','json','status','nok','updateInterval','__esModule','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','error','currency','1424nTWXCU','currencyRate','mxn','CURRENCIES','337264ZHPchG','usd','rub','%\x20markup\x20to\x20','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','10420ZuuDhh','krw','CoinGecko\x20API\x20error:\x20','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','gbp','toLowerCase','rate','üí±\x20Applied\x20','forEach','usdt','Error\x20converting\x20','bnb','getRatesStatus','allSettled','brl','ils','\x20USDT\x20(rate:\x20','thb','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','defineProperty','No\x20rate\x20found\x20for\x20currency:\x20','2694171odHIlB','try','pln','\x20USDT\x20=\x20','toUpperCase','getCurrencyRate','üìä\x20Received\x20rates\x20for\x20','uah','MARKUP_PERCENTAGE','COINGECKO_URL','eth','3123270uLtqud','getMarkupPercentage','1861xULdfX','toFixed','üí±\x20Converted\x20','Error\x20getting\x20all\x20rates:'];a38_0x5ace=function(){return _0x257d3d;};return a38_0x5ace();}