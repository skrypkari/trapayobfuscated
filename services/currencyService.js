'use strict';const a36_0x16b8bc=a36_0x5ebf;(function(_0x217076,_0x2dfaa8){const _0x59df1b=a36_0x5ebf,_0x3b2909=_0x217076();while(!![]){try{const _0x38bc27=-parseInt(_0x59df1b(0x10b))/0x1*(parseInt(_0x59df1b(0xe0))/0x2)+parseInt(_0x59df1b(0xe5))/0x3+-parseInt(_0x59df1b(0x122))/0x4+parseInt(_0x59df1b(0xe9))/0x5+parseInt(_0x59df1b(0x112))/0x6*(parseInt(_0x59df1b(0xeb))/0x7)+-parseInt(_0x59df1b(0xe8))/0x8*(parseInt(_0x59df1b(0xc1))/0x9)+parseInt(_0x59df1b(0x10f))/0xa;if(_0x38bc27===_0x2dfaa8)break;else _0x3b2909['push'](_0x3b2909['shift']());}catch(_0x46472a){_0x3b2909['push'](_0x3b2909['shift']());}}}(a36_0x53eb,0x4d742));var __importDefault=this&&this[a36_0x16b8bc(0xef)]||function(_0x648820){const _0x3f9c06=a36_0x16b8bc;return _0x648820&&_0x648820[_0x3f9c06(0xea)]?_0x648820:{'default':_0x648820};};Object[a36_0x16b8bc(0xd3)](exports,a36_0x16b8bc(0xea),{'value':!![]}),exports[a36_0x16b8bc(0xbf)]=exports[a36_0x16b8bc(0x113)]=void 0x0;function a36_0x5ebf(_0x557575,_0x449b11){const _0x53ebee=a36_0x53eb();return a36_0x5ebf=function(_0x5ebf3b,_0x6e366c){_0x5ebf3b=_0x5ebf3b-0xaf;let _0x5d49ad=_0x53ebee[_0x5ebf3b];return _0x5d49ad;},a36_0x5ebf(_0x557575,_0x449b11);}const database_1=__importDefault(require(a36_0x16b8bc(0xfa)));function a36_0x53eb(){const _0x5b5997=['rate','error','1689604lSPdDd','application/json','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','rub','❌\x20Failed\x20to\x20update\x20currency\x20rates:','sek','📊\x20Received\x20rates\x20for\x20','currencyRate','💱\x20Applied\x20','✅\x20Currency\x20rates\x20updated\x20successfully','toLowerCase','Error\x20getting\x20rate\x20for\x20currency\x20','jpy','COINGECKO_URL','catch','thb','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','\x20to\x20','xrp','ils','toFixed','currencyService','aud','9iQtSLK','join','statusText','eth','getRatesStatus','https://api.coingecko.com/api/v3/simple/price','tether','upsert','huf','\x20USDT,\x20with\x20','czk','try','uah','pln','usdt','clp','MARKUP_PERCENTAGE','krw','defineProperty','nok','sgd','mxn','ltc','stopPeriodicUpdates','twd','zar','dot','hkd',',\x20using\x201\x20as\x20fallback','bch','usd','4bcSWNS','sar','eur','Initial\x20currency\x20rates\x20update\x20failed:','lkr','699903jvdEjF','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','%\x20markup\x20=\x20','63592OWzlnK','1792485ItWlEK','__esModule','21fADlRA','Error\x20getting\x20rates\x20status:','idr','length','__importDefault','keys','bits','Error\x20getting\x20all\x20rates:','inr','\x20USDT','bnb','💱\x20Converted\x20','getAllRates','No\x20rate\x20found\x20for\x20currency:\x20','nzd','../config/database','\x20currencies','Error\x20converting\x20','%\x20markup\x20to\x20','log','toUpperCase','convertMultipleToUSDT','all','CURRENCIES','status','chf','php','updateCurrencyRates','xdr','ngn','convertToUSDT','Failed\x20to\x20update\x20rate\x20for\x20','174383rWGFNt','updateInterval','warn','pkr','2714290RYSmvb','Periodic\x20currency\x20rates\x20update\x20failed:','startPeriodicUpdates','466278MVoYss','CurrencyService','myr','mmk','default','getCurrencyRate','\x20USDT\x20=\x20','allSettled','entries','eos','findMany','bhd','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ars'];a36_0x53eb=function(){return _0x5b5997;};return a36_0x53eb();}class CurrencyService{constructor(){const _0x2c6f71=a36_0x16b8bc;this[_0x2c6f71(0xb7)]=_0x2c6f71(0xc6),this[_0x2c6f71(0x102)]=['btc',_0x2c6f71(0xc4),_0x2c6f71(0xd7),_0x2c6f71(0xde),_0x2c6f71(0xf5),_0x2c6f71(0x11b),_0x2c6f71(0xbc),'xlm','link',_0x2c6f71(0xdb),'yfi',_0x2c6f71(0xdf),'aed',_0x2c6f71(0x11f),_0x2c6f71(0xc0),'bdt',_0x2c6f71(0x11d),'bmd','brl','cad',_0x2c6f71(0x104),_0x2c6f71(0xd0),'cny',_0x2c6f71(0xcb),'dkk',_0x2c6f71(0xe2),'gbp','gel',_0x2c6f71(0xdc),_0x2c6f71(0xc9),_0x2c6f71(0xed),_0x2c6f71(0xbd),_0x2c6f71(0xf3),_0x2c6f71(0xb6),_0x2c6f71(0xd2),'kwd',_0x2c6f71(0xe4),_0x2c6f71(0x115),_0x2c6f71(0xd6),_0x2c6f71(0x114),_0x2c6f71(0x108),_0x2c6f71(0xd4),_0x2c6f71(0xf9),_0x2c6f71(0x105),_0x2c6f71(0x10e),_0x2c6f71(0xce),_0x2c6f71(0x125),_0x2c6f71(0xe1),_0x2c6f71(0xaf),_0x2c6f71(0xd5),_0x2c6f71(0xb9),_0x2c6f71(0xcc),_0x2c6f71(0xd9),_0x2c6f71(0xcd),'vef','vnd',_0x2c6f71(0xda),_0x2c6f71(0x107),'xag','xau',_0x2c6f71(0xf1),'sats'],this[_0x2c6f71(0x10c)]=null,this[_0x2c6f71(0xd1)]=0x3,this[_0x2c6f71(0x111)]();}[a36_0x16b8bc(0x111)](){const _0xb13cb=a36_0x16b8bc;this[_0xb13cb(0x106)]()[_0xb13cb(0xb8)](_0x6e8242=>{const _0x166d87=_0xb13cb;console['error'](_0x166d87(0xe3),_0x6e8242);}),this['updateInterval']=setInterval(async()=>{const _0x4390fb=_0xb13cb;try{await this[_0x4390fb(0x106)]();}catch(_0x49ca5f){console[_0x4390fb(0x121)](_0x4390fb(0x110),_0x49ca5f);}},0x3c*0x3c*0x3e8),console[_0xb13cb(0xfe)](_0xb13cb(0x124));}[a36_0x16b8bc(0xd8)](){const _0x43a099=a36_0x16b8bc;this[_0x43a099(0x10c)]&&(clearInterval(this[_0x43a099(0x10c)]),this[_0x43a099(0x10c)]=null,console[_0x43a099(0xfe)](_0x43a099(0xba)));}async[a36_0x16b8bc(0x106)](){const _0x216d0e=a36_0x16b8bc;try{console[_0x216d0e(0xfe)](_0x216d0e(0x11e));const _0x33e43c=this[_0x216d0e(0x102)][_0x216d0e(0xc2)](','),_0x286aec=this[_0x216d0e(0xb7)]+'?ids=tether&vs_currencies='+_0x33e43c,_0xb4e789=await fetch(_0x286aec,{'headers':{'Accept':_0x216d0e(0x123),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0xb4e789['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0xb4e789[_0x216d0e(0x103)]+'\x20'+_0xb4e789[_0x216d0e(0xc3)]);const _0x169eb9=await _0xb4e789['json']();if(!_0x169eb9[_0x216d0e(0xc7)])throw new Error(_0x216d0e(0xe6));const _0x3dc003=_0x169eb9[_0x216d0e(0xc7)];console['log'](_0x216d0e(0xb0)+Object[_0x216d0e(0xf0)](_0x3dc003)[_0x216d0e(0xee)]+_0x216d0e(0xfb));const _0x480511=Object[_0x216d0e(0x11a)](_0x3dc003)['map'](async([_0x34b320,_0x1f26e3])=>{const _0x4a54a7=_0x216d0e;try{await database_1['default'][_0x4a54a7(0xb1)][_0x4a54a7(0xc8)]({'where':{'currency':_0x34b320[_0x4a54a7(0xb4)]()},'update':{'rate':_0x1f26e3},'create':{'currency':_0x34b320[_0x4a54a7(0xb4)](),'rate':_0x1f26e3}});}catch(_0x23f5cd){console[_0x4a54a7(0x121)](_0x4a54a7(0x10a)+_0x34b320+':',_0x23f5cd);}});await Promise[_0x216d0e(0x119)](_0x480511),console['log'](_0x216d0e(0xb3));}catch(_0x514e02){console[_0x216d0e(0x121)](_0x216d0e(0x126),_0x514e02);throw _0x514e02;}}async['getCurrencyRate'](_0x29f40e){const _0x267f13=a36_0x16b8bc,_0x5ba56b=_0x29f40e[_0x267f13(0xb4)]();if(_0x5ba56b===_0x267f13(0xcf))return 0x1;try{const _0x7e21d1=await database_1[_0x267f13(0x116)]['currencyRate']['findUnique']({'where':{'currency':_0x5ba56b}});if(!_0x7e21d1)return console[_0x267f13(0x10d)](_0x267f13(0xf8)+_0x29f40e+_0x267f13(0xdd)),0x1;return _0x7e21d1[_0x267f13(0x120)];}catch(_0x2bcf3d){return console[_0x267f13(0x121)](_0x267f13(0xb5)+_0x29f40e+':',_0x2bcf3d),0x1;}}async[a36_0x16b8bc(0x109)](_0x39d7dd,_0x27e9d0){const _0x15ac49=a36_0x16b8bc,_0x1198ff=_0x27e9d0[_0x15ac49(0xb4)]();if(_0x1198ff===_0x15ac49(0xcf)){const _0x35293d=_0x39d7dd*(0x1+this[_0x15ac49(0xd1)]/0x64);return console['log'](_0x15ac49(0xb2)+this[_0x15ac49(0xd1)]+_0x15ac49(0xfd)+_0x39d7dd+_0x15ac49(0x118)+_0x35293d['toFixed'](0x6)+_0x15ac49(0xf4)),_0x35293d;}try{const _0x217e8e=await this[_0x15ac49(0x117)](_0x1198ff),_0x31f93e=_0x39d7dd/_0x217e8e,_0x2c1f35=_0x31f93e*(0x1+this[_0x15ac49(0xd1)]/0x64);return console[_0x15ac49(0xfe)](_0x15ac49(0xf6)+_0x39d7dd+'\x20'+_0x27e9d0[_0x15ac49(0xff)]()+_0x15ac49(0xbb)+_0x31f93e[_0x15ac49(0xbe)](0x6)+_0x15ac49(0xca)+this[_0x15ac49(0xd1)]+_0x15ac49(0xe7)+_0x2c1f35['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x217e8e+')'),_0x2c1f35;}catch(_0x30f727){console['error'](_0x15ac49(0xfc)+_0x39d7dd+'\x20'+_0x27e9d0+'\x20to\x20USDT:',_0x30f727);const _0x36f81c=_0x39d7dd*(0x1+this[_0x15ac49(0xd1)]/0x64);return _0x36f81c;}}async[a36_0x16b8bc(0x100)](_0x12a9f8){const _0xa15dfc=a36_0x16b8bc;let _0x29eab1=0x0;for(const {amount:_0x132267,currency:_0x10cc6e}of _0x12a9f8){const _0x305e01=await this[_0xa15dfc(0x109)](_0x132267,_0x10cc6e);_0x29eab1+=_0x305e01;}return _0x29eab1;}async[a36_0x16b8bc(0xf7)](){const _0x2148c0=a36_0x16b8bc;try{const _0x819b2a=await database_1[_0x2148c0(0x116)][_0x2148c0(0xb1)][_0x2148c0(0x11c)]({'select':{'currency':!![],'rate':!![]}}),_0x25861c={'usdt':0x1};return _0x819b2a['forEach'](_0x1d065a=>{const _0x552ded=_0x2148c0;_0x25861c[_0x1d065a['currency']]=_0x1d065a[_0x552ded(0x120)];}),_0x25861c;}catch(_0x2f1aad){return console['error'](_0x2148c0(0xf2),_0x2f1aad),{'usdt':0x1};}}async[a36_0x16b8bc(0xc5)](){const _0x4f2da9=a36_0x16b8bc;try{const [_0x2b9dc0,_0x3c0481,_0xcaf7ce]=await Promise[_0x4f2da9(0x101)]([database_1['default'][_0x4f2da9(0xb1)]['count'](),database_1[_0x4f2da9(0x116)][_0x4f2da9(0xb1)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x4f2da9(0x116)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2b9dc0,'lastUpdated':_0x3c0481?.['updatedAt']||null,'oldestRate':_0xcaf7ce?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x1587a6){return console[_0x4f2da9(0x121)](_0x4f2da9(0xec),_0x1587a6),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4f2da9(0xd1)]};}}['getMarkupPercentage'](){const _0x1d026c=a36_0x16b8bc;return this[_0x1d026c(0xd1)];}}exports[a36_0x16b8bc(0x113)]=CurrencyService,exports[a36_0x16b8bc(0xbf)]=new CurrencyService();