'use strict';const a38_0x254854=a38_0x34ee;(function(_0x2d570c,_0x5a476b){const _0x5b6856=a38_0x34ee,_0x1ede25=_0x2d570c();while(!![]){try{const _0x5414fe=parseInt(_0x5b6856(0xb1))/0x1*(parseInt(_0x5b6856(0xb7))/0x2)+-parseInt(_0x5b6856(0xdd))/0x3+-parseInt(_0x5b6856(0xe7))/0x4*(-parseInt(_0x5b6856(0xd6))/0x5)+-parseInt(_0x5b6856(0xcf))/0x6+-parseInt(_0x5b6856(0xce))/0x7+parseInt(_0x5b6856(0x9e))/0x8*(parseInt(_0x5b6856(0x91))/0x9)+-parseInt(_0x5b6856(0xab))/0xa;if(_0x5414fe===_0x5a476b)break;else _0x1ede25['push'](_0x1ede25['shift']());}catch(_0x2741a2){_0x1ede25['push'](_0x1ede25['shift']());}}}(a38_0x110a,0x99726));function a38_0x110a(){const _0xda7fe1=['Error\x20getting\x20rate\x20for\x20currency\x20','__importDefault','sats','\x20currencies','3565506zjthAc','6206754CNQcTj','currencyService','findUnique','getMarkupPercentage','xlm','map','bnb','137355hwzwQX','vef','default','join','updatedAt','allSettled','updateInterval','362118kzZDPI','xau','mmk','currencyRate','usdt','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','xdr','gbp','idr','catch','32TQwPxz','chf','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','aud','rub','?ids=tether&vs_currencies=','Periodic\x20currency\x20rates\x20update\x20failed:','count','MARKUP_PERCENTAGE','../config/database','bch','Error\x20getting\x20rates\x20status:','lkr','kwd','zar','convertMultipleToUSDT','CoinGecko\x20API\x20error:\x20','%\x20markup\x20=\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','startPeriodicUpdates','all','findFirst','clp',',\x20using\x201\x20as\x20fallback','toLowerCase','application/json','error','cad','getAllRates','link','📊\x20Received\x20rates\x20for\x20','COINGECKO_URL','\x20to\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','vnd','inr','czk','jpy','stopPeriodicUpdates','twd','✅\x20Currency\x20rates\x20updated\x20successfully','Failed\x20to\x20update\x20rate\x20for\x20','findMany','try','💱\x20Applied\x20','mxn','99InXDZN','__esModule','updateCurrencyRates','CURRENCIES','aed','sek','💱\x20Converted\x20','upsert','toUpperCase','getRatesStatus','tether','toFixed','bhd','752592tbbNJr','uah','log','\x20to\x20USDT:','Initial\x20currency\x20rates\x20update\x20failed:','asc','CurrencyService','huf','pkr','eur','nzd','sar','krw','438680ijYiSi','hkd','dkk','Error\x20getting\x20all\x20rates:','nok','TesSoft\x20Payment\x20System/1.0','1qwPGex','ltc','status','forEach','gel','btc','2164654UkFvEM','defineProperty','usd','currency','pln','ngn','bdt','\x20USDT,\x20with\x20','json','php','warn','bits','https://api.coingecko.com/api/v3/simple/price','ars','statusText','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','length','dot','\x20USDT\x20=\x20'];a38_0x110a=function(){return _0xda7fe1;};return a38_0x110a();}var __importDefault=this&&this[a38_0x254854(0xcb)]||function(_0x4fddec){const _0x41ec1f=a38_0x254854;return _0x4fddec&&_0x4fddec[_0x41ec1f(0x92)]?_0x4fddec:{'default':_0x4fddec};};Object[a38_0x254854(0xb8)](exports,a38_0x254854(0x92),{'value':!![]}),exports[a38_0x254854(0xd0)]=exports[a38_0x254854(0xa4)]=void 0x0;function a38_0x34ee(_0x3e064f,_0xe00dfd){const _0x110a24=a38_0x110a();return a38_0x34ee=function(_0x34eece,_0x365061){_0x34eece=_0x34eece-0x6c;let _0x15cd02=_0x110a24[_0x34eece];return _0x15cd02;},a38_0x34ee(_0x3e064f,_0xe00dfd);}const database_1=__importDefault(require(a38_0x254854(0x6c)));class CurrencyService{constructor(){const _0x533b60=a38_0x254854;this[_0x533b60(0x82)]=_0x533b60(0xc3),this[_0x533b60(0x94)]=[_0x533b60(0xb6),'eth',_0x533b60(0xb2),_0x533b60(0x6d),_0x533b60(0xd5),'eos','xrp',_0x533b60(0xd3),_0x533b60(0x80),_0x533b60(0xc8),'yfi',_0x533b60(0xb9),_0x533b60(0x95),_0x533b60(0xc4),_0x533b60(0xea),_0x533b60(0xbd),_0x533b60(0x9d),'bmd','brl',_0x533b60(0x7e),_0x533b60(0xe8),_0x533b60(0x79),'cny',_0x533b60(0x87),_0x533b60(0xad),_0x533b60(0xa7),_0x533b60(0xe4),_0x533b60(0xb5),_0x533b60(0xac),_0x533b60(0xa5),_0x533b60(0xe5),'ils',_0x533b60(0x86),_0x533b60(0x88),_0x533b60(0xaa),_0x533b60(0x70),_0x533b60(0x6f),_0x533b60(0xdf),_0x533b60(0x90),'myr',_0x533b60(0xbc),_0x533b60(0xaf),_0x533b60(0xa8),_0x533b60(0xc0),_0x533b60(0xa6),_0x533b60(0xbb),_0x533b60(0xeb),_0x533b60(0xa9),_0x533b60(0x96),'sgd','thb',_0x533b60(0x8e),_0x533b60(0x8a),_0x533b60(0x9f),_0x533b60(0xd7),_0x533b60(0x85),_0x533b60(0x71),_0x533b60(0xe3),'xag',_0x533b60(0xde),_0x533b60(0xc2),_0x533b60(0xcc)],this['updateInterval']=null,this[_0x533b60(0xef)]=0x3,this[_0x533b60(0x76)]();}[a38_0x254854(0x76)](){const _0x1b70d6=a38_0x254854;this[_0x1b70d6(0x93)]()[_0x1b70d6(0xe6)](_0x1e9385=>{const _0x1b4ec1=_0x1b70d6;console[_0x1b4ec1(0x7d)](_0x1b4ec1(0xa2),_0x1e9385);}),this[_0x1b70d6(0xdc)]=setInterval(async()=>{const _0x34451e=_0x1b70d6;try{await this[_0x34451e(0x93)]();}catch(_0x593e07){console['error'](_0x34451e(0xed),_0x593e07);}},0x3c*0x3c*0x3e8),console['log'](_0x1b70d6(0xe9));}[a38_0x254854(0x89)](){const _0x31d3b5=a38_0x254854;this[_0x31d3b5(0xdc)]&&(clearInterval(this[_0x31d3b5(0xdc)]),this[_0x31d3b5(0xdc)]=null,console[_0x31d3b5(0xa0)](_0x31d3b5(0xe2)));}async[a38_0x254854(0x93)](){const _0x41e055=a38_0x254854;try{console['log'](_0x41e055(0xc6));const _0x3775dd=this['CURRENCIES'][_0x41e055(0xd9)](','),_0x2ff1bd=this[_0x41e055(0x82)]+_0x41e055(0xec)+_0x3775dd,_0x490f78=await fetch(_0x2ff1bd,{'headers':{'Accept':_0x41e055(0x7c),'User-Agent':_0x41e055(0xb0)}});if(!_0x490f78['ok'])throw new Error(_0x41e055(0x73)+_0x490f78[_0x41e055(0xb3)]+'\x20'+_0x490f78[_0x41e055(0xc5)]);const _0x264dda=await _0x490f78[_0x41e055(0xbf)]();if(!_0x264dda[_0x41e055(0x9b)])throw new Error(_0x41e055(0x75));const _0x5c39c4=_0x264dda['tether'];console[_0x41e055(0xa0)](_0x41e055(0x81)+Object['keys'](_0x5c39c4)[_0x41e055(0xc7)]+_0x41e055(0xcd));const _0x50c7b6=Object['entries'](_0x5c39c4)[_0x41e055(0xd4)](async([_0x2c09d0,_0x5609e8])=>{const _0x293f23=_0x41e055;try{await database_1[_0x293f23(0xd8)][_0x293f23(0xe0)][_0x293f23(0x98)]({'where':{'currency':_0x2c09d0['toLowerCase']()},'update':{'rate':_0x5609e8},'create':{'currency':_0x2c09d0[_0x293f23(0x7b)](),'rate':_0x5609e8}});}catch(_0x21640e){console['error'](_0x293f23(0x8c)+_0x2c09d0+':',_0x21640e);}});await Promise[_0x41e055(0xdb)](_0x50c7b6),console[_0x41e055(0xa0)](_0x41e055(0x8b));}catch(_0x5557f9){console[_0x41e055(0x7d)](_0x41e055(0x84),_0x5557f9);throw _0x5557f9;}}async['getCurrencyRate'](_0x12f9a0){const _0x1ff4a3=a38_0x254854,_0x13a668=_0x12f9a0[_0x1ff4a3(0x7b)]();if(_0x13a668==='usdt')return 0x1;try{const _0xab98ec=await database_1['default'][_0x1ff4a3(0xe0)][_0x1ff4a3(0xd1)]({'where':{'currency':_0x13a668}});if(!_0xab98ec)return console[_0x1ff4a3(0xc1)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x12f9a0+_0x1ff4a3(0x7a)),0x1;return _0xab98ec['rate'];}catch(_0x910944){return console[_0x1ff4a3(0x7d)](_0x1ff4a3(0xca)+_0x12f9a0+':',_0x910944),0x1;}}async['convertToUSDT'](_0x509c8b,_0xfec2e8){const _0x1e9352=a38_0x254854,_0x1d47d0=_0xfec2e8['toLowerCase']();if(_0x1d47d0===_0x1e9352(0xe1)){const _0x411d0b=_0x509c8b*(0x1+this[_0x1e9352(0xef)]/0x64);return console[_0x1e9352(0xa0)](_0x1e9352(0x8f)+this[_0x1e9352(0xef)]+'%\x20markup\x20to\x20'+_0x509c8b+_0x1e9352(0xc9)+_0x411d0b['toFixed'](0x6)+'\x20USDT'),_0x411d0b;}try{const _0xa5cb1e=await this['getCurrencyRate'](_0x1d47d0),_0x306522=_0x509c8b/_0xa5cb1e,_0x4733a6=_0x306522*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x1e9352(0xa0)](_0x1e9352(0x97)+_0x509c8b+'\x20'+_0xfec2e8[_0x1e9352(0x99)]()+_0x1e9352(0x83)+_0x306522[_0x1e9352(0x9c)](0x6)+_0x1e9352(0xbe)+this['MARKUP_PERCENTAGE']+_0x1e9352(0x74)+_0x4733a6['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0xa5cb1e+')'),_0x4733a6;}catch(_0x1bbcfa){console['error']('Error\x20converting\x20'+_0x509c8b+'\x20'+_0xfec2e8+_0x1e9352(0xa1),_0x1bbcfa);const _0x40b6d8=_0x509c8b*(0x1+this[_0x1e9352(0xef)]/0x64);return _0x40b6d8;}}async[a38_0x254854(0x72)](_0x3b9806){let _0x18da53=0x0;for(const {amount:_0x57242c,currency:_0x35664f}of _0x3b9806){const _0x31a0b6=await this['convertToUSDT'](_0x57242c,_0x35664f);_0x18da53+=_0x31a0b6;}return _0x18da53;}async[a38_0x254854(0x7f)](){const _0x43c4f8=a38_0x254854;try{const _0x74bf89=await database_1['default'][_0x43c4f8(0xe0)][_0x43c4f8(0x8d)]({'select':{'currency':!![],'rate':!![]}}),_0xd7e0ee={'usdt':0x1};return _0x74bf89[_0x43c4f8(0xb4)](_0x5e42ad=>{const _0x2892e5=_0x43c4f8;_0xd7e0ee[_0x5e42ad[_0x2892e5(0xba)]]=_0x5e42ad['rate'];}),_0xd7e0ee;}catch(_0x5a7bce){return console[_0x43c4f8(0x7d)](_0x43c4f8(0xae),_0x5a7bce),{'usdt':0x1};}}async[a38_0x254854(0x9a)](){const _0x41ac5b=a38_0x254854;try{const [_0x3ba273,_0x442638,_0x372d35]=await Promise[_0x41ac5b(0x77)]([database_1[_0x41ac5b(0xd8)][_0x41ac5b(0xe0)][_0x41ac5b(0xee)](),database_1[_0x41ac5b(0xd8)][_0x41ac5b(0xe0)][_0x41ac5b(0x78)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x41ac5b(0xe0)]['findFirst']({'orderBy':{'updatedAt':_0x41ac5b(0xa3)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3ba273,'lastUpdated':_0x442638?.['updatedAt']||null,'oldestRate':_0x372d35?.[_0x41ac5b(0xda)]||null,'markupPercentage':this[_0x41ac5b(0xef)]};}catch(_0xe42fbc){return console[_0x41ac5b(0x7d)](_0x41ac5b(0x6e),_0xe42fbc),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x254854(0xd2)](){const _0x5566df=a38_0x254854;return this[_0x5566df(0xef)];}}exports[a38_0x254854(0xa4)]=CurrencyService,exports[a38_0x254854(0xd0)]=new CurrencyService();