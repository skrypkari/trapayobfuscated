'use strict';const a53_0x18db79=a53_0x1a7e;(function(_0x1c1361,_0x335114){const _0x20f406=a53_0x1a7e,_0xebe8f=_0x1c1361();while(!![]){try{const _0x2b0420=-parseInt(_0x20f406(0x11d))/0x1*(parseInt(_0x20f406(0xfd))/0x2)+-parseInt(_0x20f406(0x12f))/0x3+parseInt(_0x20f406(0x147))/0x4*(-parseInt(_0x20f406(0x107))/0x5)+parseInt(_0x20f406(0xf2))/0x6*(-parseInt(_0x20f406(0x13c))/0x7)+parseInt(_0x20f406(0x105))/0x8+parseInt(_0x20f406(0xee))/0x9*(parseInt(_0x20f406(0xeb))/0xa)+parseInt(_0x20f406(0x129))/0xb;if(_0x2b0420===_0x335114)break;else _0xebe8f['push'](_0xebe8f['shift']());}catch(_0x39d248){_0xebe8f['push'](_0xebe8f['shift']());}}}(a53_0x4492,0xd6fb9));function a53_0x4492(){const _0x4cd521=['bmd','6wpVjQi','updateInterval','\x20currencies','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','entries','%\x20markup\x20=\x20','link','currencyRate','ars','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','xrp','420548DsIKVA','ngn','eos','clp','btc','log','convertToUSDT','eth','3341592FNSlhY','xau','5845355iIunmm','jpy','getCurrencyRate','Initial\x20currency\x20rates\x20update\x20failed:','error','all','defineProperty','bdt','inr','\x20USDT,\x20with\x20','âœ…\x20Currency\x20rates\x20updated\x20successfully','allSettled','rub','dkk','desc','hkd','warn','forEach','\x20USDT','sek','CoinGecko\x20API\x20error:\x20','bits','5QBGCsl','try','nok','updateCurrencyRates','dot','pln','pkr','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','updatedAt','uah','gel','ðŸ’±\x20Converted\x20','36429228aRiQQD','findUnique','huf','Error\x20converting\x20','bhd','nzd','1081242rsTwrV','stopPeriodicUpdates','findFirst','asc','vef','mmk','toLowerCase','lkr','bnb','aud','CurrencyService','sgd','chf','2108043gEEnBb','application/json','Payment\x20System/1.0','\x20USDT\x20(rate:\x20','count','Error\x20getting\x20rates\x20status:','CURRENCIES','twd','eur','cad','catch','4XEwIPi','xag','map','gbp','xlm','../config/database','join','status','kwd','toFixed','bch','ðŸ’±\x20Applied\x20','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ltc','php','No\x20rate\x20found\x20for\x20currency:\x20','?ids=tether&vs_currencies=','COINGECKO_URL','zar','usdt','thb','krw','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','Periodic\x20currency\x20rates\x20update\x20failed:','currencyService','Error\x20getting\x20all\x20rates:','Failed\x20to\x20update\x20rate\x20for\x20','sats','convertMultipleToUSDT','MARKUP_PERCENTAGE','__importDefault','yfi','55210idAJhL','tether','default','54hAkjQQ','xdr','vnd'];a53_0x4492=function(){return _0x4cd521;};return a53_0x4492();}var __importDefault=this&&this[a53_0x18db79(0xe9)]||function(_0x303318){return _0x303318&&_0x303318['__esModule']?_0x303318:{'default':_0x303318};};Object[a53_0x18db79(0x10d)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a53_0x18db79(0x139)]=void 0x0;const database_1=__importDefault(require(a53_0x18db79(0xd0)));class CurrencyService{constructor(){const _0x4be179=a53_0x18db79;this[_0x4be179(0xdc)]='https://api.coingecko.com/api/v3/simple/price',this[_0x4be179(0x142)]=[_0x4be179(0x101),_0x4be179(0x104),_0x4be179(0xd8),_0x4be179(0xd5),_0x4be179(0x137),_0x4be179(0xff),_0x4be179(0xfc),_0x4be179(0xcf),_0x4be179(0xf8),_0x4be179(0x121),_0x4be179(0xea),'usd','aed',_0x4be179(0xfa),_0x4be179(0x138),_0x4be179(0x10e),_0x4be179(0x12d),_0x4be179(0xf1),'brl',_0x4be179(0x145),_0x4be179(0x13b),_0x4be179(0x100),'cny','czk',_0x4be179(0x114),_0x4be179(0x144),_0x4be179(0x14a),_0x4be179(0x127),_0x4be179(0x116),_0x4be179(0x12b),'idr','ils',_0x4be179(0x10f),_0x4be179(0x108),_0x4be179(0xe0),_0x4be179(0xd3),_0x4be179(0x136),_0x4be179(0x134),'mxn','myr',_0x4be179(0xfe),_0x4be179(0x11f),_0x4be179(0x12e),_0x4be179(0xd9),_0x4be179(0x123),_0x4be179(0x122),_0x4be179(0x113),'sar',_0x4be179(0x11a),_0x4be179(0x13a),_0x4be179(0xdf),_0x4be179(0x11e),_0x4be179(0x143),_0x4be179(0x126),_0x4be179(0x133),_0x4be179(0xf0),_0x4be179(0xdd),_0x4be179(0xef),_0x4be179(0x148),_0x4be179(0x106),_0x4be179(0x11c),_0x4be179(0xe6)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x2dca0e=a53_0x18db79;this[_0x2dca0e(0x120)]()[_0x2dca0e(0x146)](_0x1238ee=>{const _0x4815b9=_0x2dca0e;console[_0x4815b9(0x10b)](_0x4815b9(0x10a),_0x1238ee);}),this[_0x2dca0e(0xf3)]=setInterval(async()=>{const _0x28a696=_0x2dca0e;try{await this[_0x28a696(0x120)]();}catch(_0x60d4ee){console[_0x28a696(0x10b)](_0x28a696(0xe2),_0x60d4ee);}},0x3c*0x3c*0x3e8),console[_0x2dca0e(0x102)](_0x2dca0e(0xf5));}[a53_0x18db79(0x130)](){const _0x4e2cf2=a53_0x18db79;this['updateInterval']&&(clearInterval(this[_0x4e2cf2(0xf3)]),this[_0x4e2cf2(0xf3)]=null,console[_0x4e2cf2(0x102)](_0x4e2cf2(0xfb)));}async[a53_0x18db79(0x120)](){const _0x41e947=a53_0x18db79;try{console[_0x41e947(0x102)](_0x41e947(0xd7));const _0x51829a=this[_0x41e947(0x142)][_0x41e947(0xd1)](','),_0x369e11=this[_0x41e947(0xdc)]+_0x41e947(0xdb)+_0x51829a,_0x126b9c=await fetch(_0x369e11,{'headers':{'Accept':_0x41e947(0x13d),'User-Agent':_0x41e947(0x13e)}});if(!_0x126b9c['ok'])throw new Error(_0x41e947(0x11b)+_0x126b9c[_0x41e947(0xd2)]+'\x20'+_0x126b9c['statusText']);const _0x238fe7=await _0x126b9c['json']();if(!_0x238fe7[_0x41e947(0xec)])throw new Error(_0x41e947(0x124));const _0x58e2de=_0x238fe7[_0x41e947(0xec)];console[_0x41e947(0x102)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object['keys'](_0x58e2de)['length']+_0x41e947(0xf4));const _0x5c6f67=Object[_0x41e947(0xf6)](_0x58e2de)[_0x41e947(0x149)](async([_0x3a2a36,_0x2f8c2b])=>{const _0x29cec9=_0x41e947;try{await database_1[_0x29cec9(0xed)][_0x29cec9(0xf9)]['upsert']({'where':{'currency':_0x3a2a36['toLowerCase']()},'update':{'rate':_0x2f8c2b},'create':{'currency':_0x3a2a36[_0x29cec9(0x135)](),'rate':_0x2f8c2b}});}catch(_0x94e595){console[_0x29cec9(0x10b)](_0x29cec9(0xe5)+_0x3a2a36+':',_0x94e595);}});await Promise[_0x41e947(0x112)](_0x5c6f67),console[_0x41e947(0x102)](_0x41e947(0x111));}catch(_0x17b54c){console['error'](_0x41e947(0xe1),_0x17b54c);throw _0x17b54c;}}async[a53_0x18db79(0x109)](_0x40d23b){const _0x210b8f=a53_0x18db79,_0x1d84c2=_0x40d23b[_0x210b8f(0x135)]();if(_0x1d84c2===_0x210b8f(0xde))return 0x1;try{const _0x42f6c3=await database_1['default']['currencyRate'][_0x210b8f(0x12a)]({'where':{'currency':_0x1d84c2}});if(!_0x42f6c3)return console[_0x210b8f(0x117)](_0x210b8f(0xda)+_0x40d23b+',\x20using\x201\x20as\x20fallback'),0x1;return _0x42f6c3['rate'];}catch(_0x1473a0){return console[_0x210b8f(0x10b)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x40d23b+':',_0x1473a0),0x1;}}async[a53_0x18db79(0x103)](_0x387a45,_0x3020c2){const _0x3c799f=a53_0x18db79,_0x372f1b=_0x3020c2['toLowerCase']();if(_0x372f1b===_0x3c799f(0xde)){const _0x5b9c56=_0x387a45*(0x1+this[_0x3c799f(0xe8)]/0x64);return console[_0x3c799f(0x102)](_0x3c799f(0xd6)+this[_0x3c799f(0xe8)]+'%\x20markup\x20to\x20'+_0x387a45+'\x20USDT\x20=\x20'+_0x5b9c56[_0x3c799f(0xd4)](0x6)+_0x3c799f(0x119)),_0x5b9c56;}try{const _0x20a5ef=await this[_0x3c799f(0x109)](_0x372f1b),_0x3b03d2=_0x387a45/_0x20a5ef,_0x5c5f7b=_0x3b03d2*(0x1+this[_0x3c799f(0xe8)]/0x64);return console['log'](_0x3c799f(0x128)+_0x387a45+'\x20'+_0x3020c2['toUpperCase']()+'\x20to\x20'+_0x3b03d2['toFixed'](0x6)+_0x3c799f(0x110)+this[_0x3c799f(0xe8)]+_0x3c799f(0xf7)+_0x5c5f7b[_0x3c799f(0xd4)](0x6)+_0x3c799f(0x13f)+_0x20a5ef+')'),_0x5c5f7b;}catch(_0x843a15){console[_0x3c799f(0x10b)](_0x3c799f(0x12c)+_0x387a45+'\x20'+_0x3020c2+'\x20to\x20USDT:',_0x843a15);const _0x5467db=_0x387a45*(0x1+this[_0x3c799f(0xe8)]/0x64);return _0x5467db;}}async[a53_0x18db79(0xe7)](_0x163a8a){let _0x17a688=0x0;for(const {amount:_0x26d285,currency:_0x58d454}of _0x163a8a){const _0x4fbdf9=await this['convertToUSDT'](_0x26d285,_0x58d454);_0x17a688+=_0x4fbdf9;}return _0x17a688;}async['getAllRates'](){const _0x3e6f7b=a53_0x18db79;try{const _0x2da1b5=await database_1[_0x3e6f7b(0xed)][_0x3e6f7b(0xf9)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1630c4={'usdt':0x1};return _0x2da1b5[_0x3e6f7b(0x118)](_0x2f5ea7=>{_0x1630c4[_0x2f5ea7['currency']]=_0x2f5ea7['rate'];}),_0x1630c4;}catch(_0x2f6c40){return console['error'](_0x3e6f7b(0xe4),_0x2f6c40),{'usdt':0x1};}}async['getRatesStatus'](){const _0x23ec3f=a53_0x18db79;try{const [_0x5bd405,_0x1bcc2b,_0x474644]=await Promise[_0x23ec3f(0x10c)]([database_1[_0x23ec3f(0xed)]['currencyRate'][_0x23ec3f(0x140)](),database_1[_0x23ec3f(0xed)][_0x23ec3f(0xf9)][_0x23ec3f(0x131)]({'orderBy':{'updatedAt':_0x23ec3f(0x115)},'select':{'updatedAt':!![]}}),database_1[_0x23ec3f(0xed)][_0x23ec3f(0xf9)][_0x23ec3f(0x131)]({'orderBy':{'updatedAt':_0x23ec3f(0x132)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5bd405,'lastUpdated':_0x1bcc2b?.[_0x23ec3f(0x125)]||null,'oldestRate':_0x474644?.[_0x23ec3f(0x125)]||null,'markupPercentage':this[_0x23ec3f(0xe8)]};}catch(_0x41dd5a){return console[_0x23ec3f(0x10b)](_0x23ec3f(0x141),_0x41dd5a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0x4fe29a=a53_0x18db79;return this[_0x4fe29a(0xe8)];}}function a53_0x1a7e(_0x410035,_0x1fb10f){_0x410035=_0x410035-0xcf;const _0x4492a2=a53_0x4492();let _0x1a7e58=_0x4492a2[_0x410035];return _0x1a7e58;}exports[a53_0x18db79(0x139)]=CurrencyService,exports[a53_0x18db79(0xe3)]=new CurrencyService();