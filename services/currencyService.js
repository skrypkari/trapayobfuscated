'use strict';const a38_0x5e5e31=a38_0x15c0;(function(_0x38fb28,_0x1988e4){const _0x54bdb5=a38_0x15c0,_0x2fde37=_0x38fb28();while(!![]){try{const _0x579cb2=parseInt(_0x54bdb5(0xed))/0x1*(parseInt(_0x54bdb5(0xfa))/0x2)+-parseInt(_0x54bdb5(0xa2))/0x3*(parseInt(_0x54bdb5(0xff))/0x4)+parseInt(_0x54bdb5(0xbf))/0x5+-parseInt(_0x54bdb5(0xcd))/0x6+parseInt(_0x54bdb5(0xc2))/0x7*(-parseInt(_0x54bdb5(0x10e))/0x8)+parseInt(_0x54bdb5(0xa6))/0x9+-parseInt(_0x54bdb5(0x100))/0xa*(-parseInt(_0x54bdb5(0xc9))/0xb);if(_0x579cb2===_0x1988e4)break;else _0x2fde37['push'](_0x2fde37['shift']());}catch(_0x10b890){_0x2fde37['push'](_0x2fde37['shift']());}}}(a38_0x2c0c,0x27caa));function a38_0x2c0c(){const _0x1e8b7e=['try','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','currencyRate','CurrencyService','currencyService','startPeriodicUpdates','myr','ars','length','usdt','convertMultipleToUSDT','pkr','findFirst','clp','link','join','1510715yGuCdr','czk','getAllRates','5278LfrBND','nok','warn','convertToUSDT','CURRENCIES','toUpperCase','aed','11nceCnF','sgd','cad','✅\x20Currency\x20rates\x20updated\x20successfully','955800gmsPGK','getCurrencyRate','entries','bits','No\x20rate\x20found\x20for\x20currency:\x20','map','all','eth','toLowerCase','catch','__esModule','ngn','bhd','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','keys','mxn','bdt','xrp','MARKUP_PERCENTAGE','hkd','dot','statusText','twd','💱\x20Applied\x20','💱\x20Converted\x20','krw','kwd','updateCurrencyRates','log','inr','error','usd','1ItjaOm','❌\x20Failed\x20to\x20update\x20currency\x20rates:','sek','sats','?ids=tether&vs_currencies=','cny','upsert','xag','rate','\x20to\x20USDT:','gbp','\x20USDT','\x20USDT,\x20with\x20','91068XqCUzP','updatedAt','COINGECKO_URL','bmd','TesSoft\x20Payment\x20System/1.0','2068IsapFm','413630yjnqAh','Error\x20getting\x20all\x20rates:','tether','eos','uah','\x20to\x20','ltc','application/json','rub','xlm','idr','toFixed','vef','thb','24Qapaus','default','Initial\x20currency\x20rates\x20update\x20failed:','Failed\x20to\x20update\x20rate\x20for\x20','Periodic\x20currency\x20rates\x20update\x20failed:','1563FQsExK','https://api.coingecko.com/api/v3/simple/price','updateInterval','getRatesStatus','1843785EttwPt','desc','vnd','%\x20markup\x20=\x20','findUnique','\x20currencies','bch','nzd'];a38_0x2c0c=function(){return _0x1e8b7e;};return a38_0x2c0c();}var __importDefault=this&&this['__importDefault']||function(_0x51dd2b){const _0x2d3c2c=a38_0x15c0;return _0x51dd2b&&_0x51dd2b[_0x2d3c2c(0xd7)]?_0x51dd2b:{'default':_0x51dd2b};};Object['defineProperty'](exports,a38_0x5e5e31(0xd7),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x350638=a38_0x5e5e31;this[_0x350638(0xfc)]=_0x350638(0xa3),this[_0x350638(0xc6)]=['btc',_0x350638(0xd4),_0x350638(0x106),_0x350638(0xac),'bnb',_0x350638(0x103),_0x350638(0xde),_0x350638(0x109),_0x350638(0xbd),_0x350638(0xe1),'yfi',_0x350638(0xec),_0x350638(0xc8),_0x350638(0xb6),'aud',_0x350638(0xdd),_0x350638(0xd9),_0x350638(0xfd),'brl',_0x350638(0xcb),'chf',_0x350638(0xbc),_0x350638(0xf2),_0x350638(0xc0),'dkk','eur',_0x350638(0xf7),'gel',_0x350638(0xe0),'huf',_0x350638(0x10a),'ils',_0x350638(0xea),'jpy',_0x350638(0xe6),_0x350638(0xe7),'lkr','mmk',_0x350638(0xdc),_0x350638(0xb5),_0x350638(0xd8),_0x350638(0xc3),_0x350638(0xad),'php',_0x350638(0xba),'pln',_0x350638(0x108),'sar',_0x350638(0xef),_0x350638(0xca),_0x350638(0x10d),_0x350638(0xae),_0x350638(0xe3),_0x350638(0x104),_0x350638(0x10c),_0x350638(0xa8),'zar','xdr',_0x350638(0xf4),'xau',_0x350638(0xd0),_0x350638(0xf0)],this[_0x350638(0xa4)]=null,this[_0x350638(0xdf)]=0x3,this[_0x350638(0xb4)]();}['startPeriodicUpdates'](){const _0x3211dc=a38_0x5e5e31;this[_0x3211dc(0xe8)]()[_0x3211dc(0xd6)](_0x25c485=>{const _0x20858f=_0x3211dc;console[_0x20858f(0xeb)](_0x20858f(0x110),_0x25c485);}),this[_0x3211dc(0xa4)]=setInterval(async()=>{const _0x2ef578=_0x3211dc;try{await this[_0x2ef578(0xe8)]();}catch(_0x24d733){console[_0x2ef578(0xeb)](_0x2ef578(0xa1),_0x24d733);}},0x3c*0x3c*0x3e8),console['log'](_0x3211dc(0xb0));}['stopPeriodicUpdates'](){const _0x522d42=a38_0x5e5e31;this[_0x522d42(0xa4)]&&(clearInterval(this[_0x522d42(0xa4)]),this[_0x522d42(0xa4)]=null,console['log']('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x5e5e31(0xe8)](){const _0x18e558=a38_0x5e5e31;try{console[_0x18e558(0xe9)](_0x18e558(0xda));const _0x286dd0=this[_0x18e558(0xc6)][_0x18e558(0xbe)](','),_0x5ec7ae=this[_0x18e558(0xfc)]+_0x18e558(0xf1)+_0x286dd0,_0x1f472e=await fetch(_0x5ec7ae,{'headers':{'Accept':_0x18e558(0x107),'User-Agent':_0x18e558(0xfe)}});if(!_0x1f472e['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1f472e['status']+'\x20'+_0x1f472e[_0x18e558(0xe2)]);const _0x3baa9b=await _0x1f472e['json']();if(!_0x3baa9b[_0x18e558(0x102)])throw new Error(_0x18e558(0xaf));const _0x1fe6a1=_0x3baa9b[_0x18e558(0x102)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x18e558(0xdb)](_0x1fe6a1)[_0x18e558(0xb7)]+_0x18e558(0xab));const _0x2c6103=Object[_0x18e558(0xcf)](_0x1fe6a1)[_0x18e558(0xd2)](async([_0x3f654f,_0x2488b1])=>{const _0x3a7d7e=_0x18e558;try{await database_1[_0x3a7d7e(0x10f)][_0x3a7d7e(0xb1)][_0x3a7d7e(0xf3)]({'where':{'currency':_0x3f654f['toLowerCase']()},'update':{'rate':_0x2488b1},'create':{'currency':_0x3f654f[_0x3a7d7e(0xd5)](),'rate':_0x2488b1}});}catch(_0x2cf5b3){console[_0x3a7d7e(0xeb)](_0x3a7d7e(0xa0)+_0x3f654f+':',_0x2cf5b3);}});await Promise['allSettled'](_0x2c6103),console[_0x18e558(0xe9)](_0x18e558(0xcc));}catch(_0x84011){console[_0x18e558(0xeb)](_0x18e558(0xee),_0x84011);throw _0x84011;}}async[a38_0x5e5e31(0xce)](_0x38944f){const _0x2828f5=a38_0x5e5e31,_0x398f32=_0x38944f['toLowerCase']();if(_0x398f32===_0x2828f5(0xb8))return 0x1;try{const _0x374465=await database_1[_0x2828f5(0x10f)][_0x2828f5(0xb1)][_0x2828f5(0xaa)]({'where':{'currency':_0x398f32}});if(!_0x374465)return console[_0x2828f5(0xc4)](_0x2828f5(0xd1)+_0x38944f+',\x20using\x201\x20as\x20fallback'),0x1;return _0x374465[_0x2828f5(0xf5)];}catch(_0x1daf3e){return console[_0x2828f5(0xeb)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x38944f+':',_0x1daf3e),0x1;}}async[a38_0x5e5e31(0xc5)](_0x1e900d,_0x55e966){const _0x4dc7da=a38_0x5e5e31,_0x445e1a=_0x55e966[_0x4dc7da(0xd5)]();if(_0x445e1a==='usdt'){const _0x1a323d=_0x1e900d*(0x1+this[_0x4dc7da(0xdf)]/0x64);return console[_0x4dc7da(0xe9)](_0x4dc7da(0xe4)+this[_0x4dc7da(0xdf)]+'%\x20markup\x20to\x20'+_0x1e900d+'\x20USDT\x20=\x20'+_0x1a323d['toFixed'](0x6)+_0x4dc7da(0xf8)),_0x1a323d;}try{const _0x22abef=await this['getCurrencyRate'](_0x445e1a),_0x439ce2=_0x1e900d/_0x22abef,_0x2ff481=_0x439ce2*(0x1+this[_0x4dc7da(0xdf)]/0x64);return console[_0x4dc7da(0xe9)](_0x4dc7da(0xe5)+_0x1e900d+'\x20'+_0x55e966[_0x4dc7da(0xc7)]()+_0x4dc7da(0x105)+_0x439ce2[_0x4dc7da(0x10b)](0x6)+_0x4dc7da(0xf9)+this[_0x4dc7da(0xdf)]+_0x4dc7da(0xa9)+_0x2ff481[_0x4dc7da(0x10b)](0x6)+'\x20USDT\x20(rate:\x20'+_0x22abef+')'),_0x2ff481;}catch(_0x4354f0){console['error']('Error\x20converting\x20'+_0x1e900d+'\x20'+_0x55e966+_0x4dc7da(0xf6),_0x4354f0);const _0x201a46=_0x1e900d*(0x1+this[_0x4dc7da(0xdf)]/0x64);return _0x201a46;}}async[a38_0x5e5e31(0xb9)](_0x1d427f){const _0x5293ae=a38_0x5e5e31;let _0x57506e=0x0;for(const {amount:_0x5a647a,currency:_0x4a6a17}of _0x1d427f){const _0x5377a2=await this[_0x5293ae(0xc5)](_0x5a647a,_0x4a6a17);_0x57506e+=_0x5377a2;}return _0x57506e;}async[a38_0x5e5e31(0xc1)](){const _0x207d66=a38_0x5e5e31;try{const _0x573e10=await database_1['default'][_0x207d66(0xb1)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x2e3e35={'usdt':0x1};return _0x573e10['forEach'](_0x1e0024=>{_0x2e3e35[_0x1e0024['currency']]=_0x1e0024['rate'];}),_0x2e3e35;}catch(_0x2e3b69){return console['error'](_0x207d66(0x101),_0x2e3b69),{'usdt':0x1};}}async[a38_0x5e5e31(0xa5)](){const _0x26e0aa=a38_0x5e5e31;try{const [_0x2762cc,_0x2c725b,_0x6cbc49]=await Promise[_0x26e0aa(0xd3)]([database_1[_0x26e0aa(0x10f)]['currencyRate']['count'](),database_1[_0x26e0aa(0x10f)][_0x26e0aa(0xb1)][_0x26e0aa(0xbb)]({'orderBy':{'updatedAt':_0x26e0aa(0xa7)},'select':{'updatedAt':!![]}}),database_1[_0x26e0aa(0x10f)][_0x26e0aa(0xb1)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2762cc,'lastUpdated':_0x2c725b?.[_0x26e0aa(0xfb)]||null,'oldestRate':_0x6cbc49?.['updatedAt']||null,'markupPercentage':this[_0x26e0aa(0xdf)]};}catch(_0xdddef5){return console[_0x26e0aa(0xeb)]('Error\x20getting\x20rates\x20status:',_0xdddef5),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0xddf0df=a38_0x5e5e31;return this[_0xddf0df(0xdf)];}}function a38_0x15c0(_0x549329,_0x55e2a4){const _0x2c0c69=a38_0x2c0c();return a38_0x15c0=function(_0x15c044,_0x489542){_0x15c044=_0x15c044-0xa0;let _0xfccd7f=_0x2c0c69[_0x15c044];return _0xfccd7f;},a38_0x15c0(_0x549329,_0x55e2a4);}exports[a38_0x5e5e31(0xb2)]=CurrencyService,exports[a38_0x5e5e31(0xb3)]=new CurrencyService();