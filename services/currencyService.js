'use strict';const a43_0x3c9395=a43_0x5ae5;(function(_0x183432,_0x2be712){const _0x16c429=a43_0x5ae5,_0x42a686=_0x183432();while(!![]){try{const _0x136564=parseInt(_0x16c429(0x179))/0x1+parseInt(_0x16c429(0x145))/0x2+parseInt(_0x16c429(0x13b))/0x3+-parseInt(_0x16c429(0x15b))/0x4*(-parseInt(_0x16c429(0x17f))/0x5)+-parseInt(_0x16c429(0x182))/0x6+parseInt(_0x16c429(0x16b))/0x7*(-parseInt(_0x16c429(0x19c))/0x8)+parseInt(_0x16c429(0x162))/0x9*(-parseInt(_0x16c429(0x158))/0xa);if(_0x136564===_0x2be712)break;else _0x42a686['push'](_0x42a686['shift']());}catch(_0x24d7b1){_0x42a686['push'](_0x42a686['shift']());}}}(a43_0x342b,0xb99ba));function a43_0x342b(){const _0x344266=['huf','7lkXbES','czk','updateCurrencyRates','upsert','ngn','gbp','getCurrencyRate','stopPeriodicUpdates','xdr','allSettled','error','%\x20markup\x20to\x20','Periodic\x20currency\x20rates\x20update\x20failed:','eos','240576EaoRTw','uah','mmk','map','forEach','desc','628440qBoOKY','nok','getRatesStatus','6085884yFDdHm','MARKUP_PERCENTAGE','application/json','convertMultipleToUSDT','bdt','findFirst','eth',',\x20using\x201\x20as\x20fallback','log','✅\x20Currency\x20rates\x20updated\x20successfully','all','CoinGecko\x20API\x20error:\x20','sgd','No\x20rate\x20found\x20for\x20currency:\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','yfi','btc','vnd','thb','twd','inr','xrp','bch','updateInterval','json','link','9942896XgTxnV','../config/database','sar','kwd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','dkk','startPeriodicUpdates','xlm','bmd','__esModule','aud','gel','💱\x20Applied\x20','ltc','Error\x20getting\x20rates\x20status:','lkr','currency','bits','length','entries','?ids=tether&vs_currencies=','join','clp','💱\x20Converted\x20','4494360XkWFFR','sek','%\x20markup\x20=\x20','toUpperCase','xag','Error\x20getting\x20rate\x20for\x20currency\x20','\x20to\x20','usdt','Initial\x20currency\x20rates\x20update\x20failed:','\x20USDT\x20=\x20','2356188lIYRXw','defineProperty','https://api.coingecko.com/api/v3/simple/price','ils','mxn','statusText','krw','toFixed','status','findMany','CURRENCIES','updatedAt','rate','currencyRate','aed','tether','pln','convertToUSDT','Error\x20getting\x20all\x20rates:','2262170qbXoFv','eur','currencyService','32MmLiKS','findUnique','keys','\x20USDT','toLowerCase','bnb','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','36EMUxuP','\x20USDT,\x20with\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','usd','default','📊\x20Received\x20rates\x20for\x20','\x20currencies','chf'];a43_0x342b=function(){return _0x344266;};return a43_0x342b();}var __importDefault=this&&this['__importDefault']||function(_0x258f7b){const _0x19bcd6=a43_0x5ae5;return _0x258f7b&&_0x258f7b[_0x19bcd6(0x1a5)]?_0x258f7b:{'default':_0x258f7b};};function a43_0x5ae5(_0x5b840a,_0x5eaa82){const _0x342b22=a43_0x342b();return a43_0x5ae5=function(_0x5ae5fa,_0x88b42){_0x5ae5fa=_0x5ae5fa-0x134;let _0x2c5356=_0x342b22[_0x5ae5fa];return _0x2c5356;},a43_0x5ae5(_0x5b840a,_0x5eaa82);}Object[a43_0x3c9395(0x146)](exports,a43_0x3c9395(0x1a5),{'value':!![]}),exports[a43_0x3c9395(0x15a)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a43_0x3c9395(0x19d)));class CurrencyService{constructor(){const _0x34c192=a43_0x3c9395;this['COINGECKO_URL']=_0x34c192(0x147),this['CURRENCIES']=[_0x34c192(0x192),_0x34c192(0x188),_0x34c192(0x1a9),_0x34c192(0x198),_0x34c192(0x160),_0x34c192(0x178),_0x34c192(0x197),_0x34c192(0x1a3),_0x34c192(0x19b),'dot',_0x34c192(0x191),_0x34c192(0x165),_0x34c192(0x153),'ars',_0x34c192(0x1a6),_0x34c192(0x186),'bhd',_0x34c192(0x1a4),'brl','cad',_0x34c192(0x169),_0x34c192(0x139),'cny',_0x34c192(0x16c),_0x34c192(0x1a1),_0x34c192(0x159),_0x34c192(0x170),_0x34c192(0x1a7),'hkd',_0x34c192(0x16a),'idr',_0x34c192(0x148),_0x34c192(0x196),'jpy',_0x34c192(0x14b),_0x34c192(0x19f),_0x34c192(0x1ab),_0x34c192(0x17b),_0x34c192(0x149),'myr',_0x34c192(0x16f),_0x34c192(0x180),'nzd','php','pkr',_0x34c192(0x155),'rub',_0x34c192(0x19e),_0x34c192(0x13c),_0x34c192(0x18e),_0x34c192(0x194),'try',_0x34c192(0x195),_0x34c192(0x17a),'vef',_0x34c192(0x193),'zar',_0x34c192(0x173),_0x34c192(0x13f),'xau',_0x34c192(0x134),'sats'],this['updateInterval']=null,this[_0x34c192(0x183)]=-0x3,this[_0x34c192(0x1a2)]();}['startPeriodicUpdates'](){const _0xe1bf0c=a43_0x3c9395;this['updateCurrencyRates']()['catch'](_0x164701=>{const _0x17c038=a43_0x5ae5;console['error'](_0x17c038(0x143),_0x164701);}),this[_0xe1bf0c(0x199)]=setInterval(async()=>{const _0x222bc6=_0xe1bf0c;try{await this[_0x222bc6(0x16d)]();}catch(_0x4b0f66){console[_0x222bc6(0x175)](_0x222bc6(0x177),_0x4b0f66);}},0x3c*0x3c*0x3e8),console[_0xe1bf0c(0x18a)](_0xe1bf0c(0x164));}[a43_0x3c9395(0x172)](){const _0xd3f276=a43_0x3c9395;this['updateInterval']&&(clearInterval(this[_0xd3f276(0x199)]),this[_0xd3f276(0x199)]=null,console[_0xd3f276(0x18a)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a43_0x3c9395(0x16d)](){const _0x4a587e=a43_0x3c9395;try{console[_0x4a587e(0x18a)](_0x4a587e(0x161));const _0x337739=this[_0x4a587e(0x14f)][_0x4a587e(0x138)](','),_0xcb8767=this['COINGECKO_URL']+_0x4a587e(0x137)+_0x337739,_0x5de4d2=await fetch(_0xcb8767,{'headers':{'Accept':_0x4a587e(0x184),'User-Agent':'Payment\x20System/1.0'}});if(!_0x5de4d2['ok'])throw new Error(_0x4a587e(0x18d)+_0x5de4d2[_0x4a587e(0x14d)]+'\x20'+_0x5de4d2[_0x4a587e(0x14a)]);const _0x40bd2b=await _0x5de4d2[_0x4a587e(0x19a)]();if(!_0x40bd2b['tether'])throw new Error(_0x4a587e(0x1a0));const _0x4ff189=_0x40bd2b[_0x4a587e(0x154)];console['log'](_0x4a587e(0x167)+Object[_0x4a587e(0x15d)](_0x4ff189)[_0x4a587e(0x135)]+_0x4a587e(0x168));const _0x2d1f69=Object[_0x4a587e(0x136)](_0x4ff189)[_0x4a587e(0x17c)](async([_0x5c9e2d,_0x14fcbe])=>{const _0x303a2e=_0x4a587e;try{await database_1[_0x303a2e(0x166)][_0x303a2e(0x152)][_0x303a2e(0x16e)]({'where':{'currency':_0x5c9e2d[_0x303a2e(0x15f)]()},'update':{'rate':_0x14fcbe},'create':{'currency':_0x5c9e2d[_0x303a2e(0x15f)](),'rate':_0x14fcbe}});}catch(_0x49c09e){console[_0x303a2e(0x175)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x5c9e2d+':',_0x49c09e);}});await Promise[_0x4a587e(0x174)](_0x2d1f69),console[_0x4a587e(0x18a)](_0x4a587e(0x18b));}catch(_0x446313){console['error'](_0x4a587e(0x190),_0x446313);throw _0x446313;}}async[a43_0x3c9395(0x171)](_0x1b822e){const _0xa1adbf=a43_0x3c9395,_0x2033e4=_0x1b822e[_0xa1adbf(0x15f)]();if(_0x2033e4===_0xa1adbf(0x142))return 0x1;try{const _0x450fb6=await database_1[_0xa1adbf(0x166)][_0xa1adbf(0x152)][_0xa1adbf(0x15c)]({'where':{'currency':_0x2033e4}});if(!_0x450fb6)return console['warn'](_0xa1adbf(0x18f)+_0x1b822e+_0xa1adbf(0x189)),0x1;return _0x450fb6[_0xa1adbf(0x151)];}catch(_0x551d08){return console['error'](_0xa1adbf(0x140)+_0x1b822e+':',_0x551d08),0x1;}}async[a43_0x3c9395(0x156)](_0x3c081b,_0x430a79){const _0x3eed14=a43_0x3c9395,_0x57cff0=_0x430a79[_0x3eed14(0x15f)]();if(_0x57cff0===_0x3eed14(0x142)){const _0xe6fb05=_0x3c081b*(0x1+this[_0x3eed14(0x183)]/0x64);return console[_0x3eed14(0x18a)](_0x3eed14(0x1a8)+this['MARKUP_PERCENTAGE']+_0x3eed14(0x176)+_0x3c081b+_0x3eed14(0x144)+_0xe6fb05['toFixed'](0x6)+_0x3eed14(0x15e)),_0xe6fb05;}try{const _0x284e47=await this[_0x3eed14(0x171)](_0x57cff0),_0x2870ec=_0x3c081b/_0x284e47,_0x4c3463=_0x2870ec*(0x1+this[_0x3eed14(0x183)]/0x64);return console[_0x3eed14(0x18a)](_0x3eed14(0x13a)+_0x3c081b+'\x20'+_0x430a79[_0x3eed14(0x13e)]()+_0x3eed14(0x141)+_0x2870ec[_0x3eed14(0x14c)](0x6)+_0x3eed14(0x163)+this[_0x3eed14(0x183)]+_0x3eed14(0x13d)+_0x4c3463['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x284e47+')'),_0x4c3463;}catch(_0x29341b){console[_0x3eed14(0x175)]('Error\x20converting\x20'+_0x3c081b+'\x20'+_0x430a79+'\x20to\x20USDT:',_0x29341b);const _0x3e216f=_0x3c081b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3e216f;}}async[a43_0x3c9395(0x185)](_0x2d0951){const _0x3ef4e1=a43_0x3c9395;let _0x4f4927=0x0;for(const {amount:_0x11f94e,currency:_0x17c61f}of _0x2d0951){const _0x81995c=await this[_0x3ef4e1(0x156)](_0x11f94e,_0x17c61f);_0x4f4927+=_0x81995c;}return _0x4f4927;}async['getAllRates'](){const _0x1a3b00=a43_0x3c9395;try{const _0x35c281=await database_1[_0x1a3b00(0x166)][_0x1a3b00(0x152)][_0x1a3b00(0x14e)]({'select':{'currency':!![],'rate':!![]}}),_0x5cd765={'usdt':0x1};return _0x35c281[_0x1a3b00(0x17d)](_0x2dfada=>{const _0x116eb1=_0x1a3b00;_0x5cd765[_0x2dfada[_0x116eb1(0x1ac)]]=_0x2dfada['rate'];}),_0x5cd765;}catch(_0x59f54d){return console['error'](_0x1a3b00(0x157),_0x59f54d),{'usdt':0x1};}}async[a43_0x3c9395(0x181)](){const _0x106350=a43_0x3c9395;try{const [_0x1830ce,_0x2f22d1,_0x41880f]=await Promise[_0x106350(0x18c)]([database_1[_0x106350(0x166)][_0x106350(0x152)]['count'](),database_1['default']['currencyRate'][_0x106350(0x187)]({'orderBy':{'updatedAt':_0x106350(0x17e)},'select':{'updatedAt':!![]}}),database_1[_0x106350(0x166)][_0x106350(0x152)][_0x106350(0x187)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1830ce,'lastUpdated':_0x2f22d1?.[_0x106350(0x150)]||null,'oldestRate':_0x41880f?.['updatedAt']||null,'markupPercentage':this[_0x106350(0x183)]};}catch(_0x490b80){return console['error'](_0x106350(0x1aa),_0x490b80),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();