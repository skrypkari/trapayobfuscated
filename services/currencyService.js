'use strict';const a38_0x319e17=a38_0x3b1c;(function(_0x5e02b8,_0x171b7e){const _0x274946=a38_0x3b1c,_0x5b68e0=_0x5e02b8();while(!![]){try{const _0x424101=-parseInt(_0x274946(0x1c7))/0x1*(-parseInt(_0x274946(0x212))/0x2)+-parseInt(_0x274946(0x206))/0x3*(-parseInt(_0x274946(0x20b))/0x4)+-parseInt(_0x274946(0x1ca))/0x5*(-parseInt(_0x274946(0x1e6))/0x6)+-parseInt(_0x274946(0x1e2))/0x7+parseInt(_0x274946(0x1fd))/0x8*(-parseInt(_0x274946(0x224))/0x9)+-parseInt(_0x274946(0x1fb))/0xa+parseInt(_0x274946(0x1c1))/0xb*(parseInt(_0x274946(0x215))/0xc);if(_0x424101===_0x171b7e)break;else _0x5b68e0['push'](_0x5b68e0['shift']());}catch(_0x21f311){_0x5b68e0['push'](_0x5b68e0['shift']());}}}(a38_0x4939,0x60cdd));function a38_0x3b1c(_0x20ee71,_0x5047b7){const _0x4939ea=a38_0x4939();return a38_0x3b1c=function(_0x3b1c6b,_0x299db9){_0x3b1c6b=_0x3b1c6b-0x1b6;let _0x1e2be3=_0x4939ea[_0x3b1c6b];return _0x1e2be3;},a38_0x3b1c(_0x20ee71,_0x5047b7);}var __importDefault=this&&this[a38_0x319e17(0x1c8)]||function(_0x50a45e){const _0x277d76=a38_0x319e17;return _0x50a45e&&_0x50a45e[_0x277d76(0x218)]?_0x50a45e:{'default':_0x50a45e};};Object[a38_0x319e17(0x1bf)](exports,a38_0x319e17(0x218),{'value':!![]}),exports[a38_0x319e17(0x1c5)]=exports[a38_0x319e17(0x1f5)]=void 0x0;function a38_0x4939(){const _0x104311=['bhd','application/json','cny','toFixed','355278inROYQ','convertToUSDT','CURRENCIES','zar','2686404QLdTon','xdr','updateCurrencyRates','twd','Initial\x20currency\x20rates\x20update\x20failed:','default','MARKUP_PERCENTAGE','all','clp','desc','bmd','bch','ars','yfi','Error\x20converting\x20','CurrencyService','lkr','../config/database','czk','bits','currencyRate','2092100oXkgrD','✅\x20Currency\x20rates\x20updated\x20successfully','5944FgPPWh','gel','statusText','Periodic\x20currency\x20rates\x20update\x20failed:','Error\x20getting\x20all\x20rates:','rate','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','?ids=tether&vs_currencies=','status','148977imttiY','myr','allSettled','stopPeriodicUpdates','getCurrencyRate','12blTvWy','vef','\x20currencies','chf','sek','vnd','https://api.coingecko.com/api/v3/simple/price','180842GfZAyZ','jpy','eos','4176DHLcnZ','📊\x20Received\x20rates\x20for\x20','log','__esModule','\x20to\x20USDT:','dkk','updatedAt','❌\x20Failed\x20to\x20update\x20currency\x20rates:','join','inr','\x20USDT','asc','💱\x20Converted\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Error\x20getting\x20rate\x20for\x20currency\x20','6570IEFyFF','xau','php','uah','tether','aed','startPeriodicUpdates','xlm','length','eth','\x20to\x20','toLowerCase','rub','findUnique','btc','usd','toUpperCase','pkr','nzd','map','defineProperty','\x20USDT\x20=\x20','7601UyoRyZ','findFirst','getMarkupPercentage','upsert','currencyService','currency','4DaqLMV','__importDefault','TesSoft\x20Payment\x20System/1.0','5UFOgIY','gbp','Failed\x20to\x20update\x20rate\x20for\x20','huf','thb','warn','%\x20markup\x20=\x20','mxn','COINGECKO_URL','No\x20rate\x20found\x20for\x20currency:\x20','updateInterval','idr','mmk',',\x20using\x201\x20as\x20fallback','keys','error','CoinGecko\x20API\x20error:\x20','krw','usdt','xag'];a38_0x4939=function(){return _0x104311;};return a38_0x4939();}const database_1=__importDefault(require(a38_0x319e17(0x1f7)));class CurrencyService{constructor(){const _0x37d27d=a38_0x319e17;this[_0x37d27d(0x1d2)]=_0x37d27d(0x211),this[_0x37d27d(0x1e4)]=[_0x37d27d(0x1b9),_0x37d27d(0x22d),'ltc',_0x37d27d(0x1f1),'bnb',_0x37d27d(0x214),'xrp',_0x37d27d(0x22b),'link','dot',_0x37d27d(0x1f3),_0x37d27d(0x1ba),_0x37d27d(0x229),_0x37d27d(0x1f2),'aud','bdt',_0x37d27d(0x1de),_0x37d27d(0x1f0),'brl','cad',_0x37d27d(0x20e),_0x37d27d(0x1ee),_0x37d27d(0x1e0),_0x37d27d(0x1f8),_0x37d27d(0x21a),'eur',_0x37d27d(0x1cb),_0x37d27d(0x1fe),'hkd',_0x37d27d(0x1cd),_0x37d27d(0x1d5),'ils',_0x37d27d(0x21e),_0x37d27d(0x213),_0x37d27d(0x1db),'kwd',_0x37d27d(0x1f6),_0x37d27d(0x1d6),_0x37d27d(0x1d1),_0x37d27d(0x207),'ngn','nok',_0x37d27d(0x1bd),_0x37d27d(0x226),_0x37d27d(0x1bc),'pln',_0x37d27d(0x1b7),'sar',_0x37d27d(0x20f),'sgd',_0x37d27d(0x1ce),'try',_0x37d27d(0x1e9),_0x37d27d(0x227),_0x37d27d(0x20c),_0x37d27d(0x210),_0x37d27d(0x1e5),_0x37d27d(0x1e7),_0x37d27d(0x1dd),_0x37d27d(0x225),_0x37d27d(0x1f9),'sats'],this[_0x37d27d(0x1d4)]=null,this[_0x37d27d(0x1ec)]=0x3,this[_0x37d27d(0x22a)]();}[a38_0x319e17(0x22a)](){const _0x2c3fb2=a38_0x319e17;this['updateCurrencyRates']()['catch'](_0x325d56=>{const _0x3b7f54=a38_0x3b1c;console['error'](_0x3b7f54(0x1ea),_0x325d56);}),this[_0x2c3fb2(0x1d4)]=setInterval(async()=>{const _0x3ff313=_0x2c3fb2;try{await this[_0x3ff313(0x1e8)]();}catch(_0x10f5cb){console[_0x3ff313(0x1d9)](_0x3ff313(0x200),_0x10f5cb);}},0x3c*0x3c*0x3e8),console[_0x2c3fb2(0x217)](_0x2c3fb2(0x222));}[a38_0x319e17(0x209)](){const _0x2745b4=a38_0x319e17;this[_0x2745b4(0x1d4)]&&(clearInterval(this[_0x2745b4(0x1d4)]),this[_0x2745b4(0x1d4)]=null,console[_0x2745b4(0x217)](_0x2745b4(0x203)));}async[a38_0x319e17(0x1e8)](){const _0x344a09=a38_0x319e17;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x20c62b=this[_0x344a09(0x1e4)][_0x344a09(0x21d)](','),_0x18efab=this[_0x344a09(0x1d2)]+_0x344a09(0x204)+_0x20c62b,_0x4c4625=await fetch(_0x18efab,{'headers':{'Accept':_0x344a09(0x1df),'User-Agent':_0x344a09(0x1c9)}});if(!_0x4c4625['ok'])throw new Error(_0x344a09(0x1da)+_0x4c4625[_0x344a09(0x205)]+'\x20'+_0x4c4625[_0x344a09(0x1ff)]);const _0x47145a=await _0x4c4625['json']();if(!_0x47145a[_0x344a09(0x228)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x230888=_0x47145a[_0x344a09(0x228)];console[_0x344a09(0x217)](_0x344a09(0x216)+Object[_0x344a09(0x1d8)](_0x230888)[_0x344a09(0x22c)]+_0x344a09(0x20d));const _0x1d28d1=Object['entries'](_0x230888)[_0x344a09(0x1be)](async([_0x27a319,_0x5576bf])=>{const _0xdff96d=_0x344a09;try{await database_1[_0xdff96d(0x1eb)]['currencyRate'][_0xdff96d(0x1c4)]({'where':{'currency':_0x27a319[_0xdff96d(0x1b6)]()},'update':{'rate':_0x5576bf},'create':{'currency':_0x27a319[_0xdff96d(0x1b6)](),'rate':_0x5576bf}});}catch(_0x21132d){console[_0xdff96d(0x1d9)](_0xdff96d(0x1cc)+_0x27a319+':',_0x21132d);}});await Promise[_0x344a09(0x208)](_0x1d28d1),console[_0x344a09(0x217)](_0x344a09(0x1fc));}catch(_0x1cc53d){console[_0x344a09(0x1d9)](_0x344a09(0x21c),_0x1cc53d);throw _0x1cc53d;}}async[a38_0x319e17(0x20a)](_0x407438){const _0x517e27=a38_0x319e17,_0x56885a=_0x407438[_0x517e27(0x1b6)]();if(_0x56885a===_0x517e27(0x1dc))return 0x1;try{const _0x1f2b5b=await database_1[_0x517e27(0x1eb)][_0x517e27(0x1fa)][_0x517e27(0x1b8)]({'where':{'currency':_0x56885a}});if(!_0x1f2b5b)return console[_0x517e27(0x1cf)](_0x517e27(0x1d3)+_0x407438+_0x517e27(0x1d7)),0x1;return _0x1f2b5b['rate'];}catch(_0x529fad){return console[_0x517e27(0x1d9)](_0x517e27(0x223)+_0x407438+':',_0x529fad),0x1;}}async[a38_0x319e17(0x1e3)](_0x25c609,_0x5d6ba2){const _0x377e2b=a38_0x319e17,_0x3e1b25=_0x5d6ba2[_0x377e2b(0x1b6)]();if(_0x3e1b25===_0x377e2b(0x1dc)){const _0x1539bd=_0x25c609*(0x1+this[_0x377e2b(0x1ec)]/0x64);return console[_0x377e2b(0x217)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x25c609+_0x377e2b(0x1c0)+_0x1539bd[_0x377e2b(0x1e1)](0x6)+_0x377e2b(0x21f)),_0x1539bd;}try{const _0x101ab2=await this[_0x377e2b(0x20a)](_0x3e1b25),_0x4add99=_0x25c609/_0x101ab2,_0x1cc097=_0x4add99*(0x1+this[_0x377e2b(0x1ec)]/0x64);return console[_0x377e2b(0x217)](_0x377e2b(0x221)+_0x25c609+'\x20'+_0x5d6ba2[_0x377e2b(0x1bb)]()+_0x377e2b(0x22e)+_0x4add99[_0x377e2b(0x1e1)](0x6)+'\x20USDT,\x20with\x20'+this[_0x377e2b(0x1ec)]+_0x377e2b(0x1d0)+_0x1cc097[_0x377e2b(0x1e1)](0x6)+'\x20USDT\x20(rate:\x20'+_0x101ab2+')'),_0x1cc097;}catch(_0x2b5bcc){console[_0x377e2b(0x1d9)](_0x377e2b(0x1f4)+_0x25c609+'\x20'+_0x5d6ba2+_0x377e2b(0x219),_0x2b5bcc);const _0x539fd8=_0x25c609*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x539fd8;}}async['convertMultipleToUSDT'](_0x5d2bb1){const _0x2ac57e=a38_0x319e17;let _0x4f5a7a=0x0;for(const {amount:_0x33a393,currency:_0x5d99c3}of _0x5d2bb1){const _0x1c158d=await this[_0x2ac57e(0x1e3)](_0x33a393,_0x5d99c3);_0x4f5a7a+=_0x1c158d;}return _0x4f5a7a;}async['getAllRates'](){const _0x11a882=a38_0x319e17;try{const _0x4f577d=await database_1[_0x11a882(0x1eb)][_0x11a882(0x1fa)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x3ad72d={'usdt':0x1};return _0x4f577d['forEach'](_0x5e269a=>{const _0x3f7acf=_0x11a882;_0x3ad72d[_0x5e269a[_0x3f7acf(0x1c6)]]=_0x5e269a[_0x3f7acf(0x202)];}),_0x3ad72d;}catch(_0x23ce44){return console['error'](_0x11a882(0x201),_0x23ce44),{'usdt':0x1};}}async['getRatesStatus'](){const _0x56bb7d=a38_0x319e17;try{const [_0x90502c,_0x3826fd,_0x582e1e]=await Promise[_0x56bb7d(0x1ed)]([database_1[_0x56bb7d(0x1eb)]['currencyRate']['count'](),database_1[_0x56bb7d(0x1eb)][_0x56bb7d(0x1fa)][_0x56bb7d(0x1c2)]({'orderBy':{'updatedAt':_0x56bb7d(0x1ef)},'select':{'updatedAt':!![]}}),database_1[_0x56bb7d(0x1eb)][_0x56bb7d(0x1fa)][_0x56bb7d(0x1c2)]({'orderBy':{'updatedAt':_0x56bb7d(0x220)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x90502c,'lastUpdated':_0x3826fd?.[_0x56bb7d(0x21b)]||null,'oldestRate':_0x582e1e?.[_0x56bb7d(0x21b)]||null,'markupPercentage':this[_0x56bb7d(0x1ec)]};}catch(_0x629202){return console['error']('Error\x20getting\x20rates\x20status:',_0x629202),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x319e17(0x1c3)](){const _0x61dd08=a38_0x319e17;return this[_0x61dd08(0x1ec)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();