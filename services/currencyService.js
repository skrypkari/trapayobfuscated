'use strict';function a39_0x38ef(){const _0x353e59=['Error\x20getting\x20rates\x20status:','convertToUSDT','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','gel','Failed\x20to\x20update\x20rate\x20for\x20','\x20USDT\x20(rate:\x20','💱\x20Converted\x20','eos','catch','statusText','btc','brl','bmd','bhd','Error\x20getting\x20rate\x20for\x20currency\x20','TesSoft\x20Payment\x20System/1.0','thb','11855898LdOEaD','ltc','join','currencyService','usdt','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','default','xdr','COINGECKO_URL','26522968PvmHhu','nzd','clp','xrp','findUnique','2768274AyzTXW','💱\x20Applied\x20','allSettled','log','asc','60CGCfWp','9rECCwi','currency','MARKUP_PERCENTAGE','twd','Initial\x20currency\x20rates\x20update\x20failed:','stopPeriodicUpdates','krw','czk','updatedAt','Error\x20getting\x20all\x20rates:','error','defineProperty','length','https://api.coingecko.com/api/v3/simple/price','findFirst','convertMultipleToUSDT','267994gMDjtH','__importDefault','aed','mxn','No\x20rate\x20found\x20for\x20currency:\x20','idr','updateInterval','692406HzUWEc','\x20currencies','toFixed','uah','huf','12365101xDILyG','sek','myr','warn','bch','try','rate','yfi','toLowerCase','CurrencyService','eth','pln','keys','startPeriodicUpdates','\x20to\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','entries','currencyRate','toUpperCase','CoinGecko\x20API\x20error:\x20','zar','count','CURRENCIES','\x20to\x20USDT:','inr',',\x20using\x201\x20as\x20fallback','getMarkupPercentage','updateCurrencyRates','jpy','tether','forEach','✅\x20Currency\x20rates\x20updated\x20successfully','Error\x20converting\x20','findMany','rub','vef','cny','xag','192652pfLphn','../config/database','lkr','📊\x20Received\x20rates\x20for\x20','kwd','gbp','?ids=tether&vs_currencies=','php'];a39_0x38ef=function(){return _0x353e59;};return a39_0x38ef();}const a39_0x543bb2=a39_0x2ba0;(function(_0x167a1b,_0x1fc6b1){const _0x864a08=a39_0x2ba0,_0x5294a4=_0x167a1b();while(!![]){try{const _0x57cc26=parseInt(_0x864a08(0x115))/0x1+-parseInt(_0x864a08(0x11c))/0x2+parseInt(_0x864a08(0xff))/0x3+parseInt(_0x864a08(0x147))/0x4*(parseInt(_0x864a08(0x104))/0x5)+-parseInt(_0x864a08(0x160))/0x6+-parseInt(_0x864a08(0x121))/0x7+parseInt(_0x864a08(0x169))/0x8*(parseInt(_0x864a08(0x105))/0x9);if(_0x57cc26===_0x1fc6b1)break;else _0x5294a4['push'](_0x5294a4['shift']());}catch(_0x415d78){_0x5294a4['push'](_0x5294a4['shift']());}}}(a39_0x38ef,0xf307a));var __importDefault=this&&this[a39_0x543bb2(0x116)]||function(_0x2d2fce){return _0x2d2fce&&_0x2d2fce['__esModule']?_0x2d2fce:{'default':_0x2d2fce};};Object[a39_0x543bb2(0x110)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a39_0x543bb2(0x12a)]=void 0x0;const database_1=__importDefault(require(a39_0x543bb2(0x148)));function a39_0x2ba0(_0x54a401,_0x2eb7e3){const _0x38ef86=a39_0x38ef();return a39_0x2ba0=function(_0x2ba0e2,_0x53aef5){_0x2ba0e2=_0x2ba0e2-0xfd;let _0x1d49d5=_0x38ef86[_0x2ba0e2];return _0x1d49d5;},a39_0x2ba0(_0x54a401,_0x2eb7e3);}class CurrencyService{constructor(){const _0x471cb5=a39_0x543bb2;this[_0x471cb5(0x168)]=_0x471cb5(0x112),this[_0x471cb5(0x137)]=[_0x471cb5(0x159),_0x471cb5(0x12b),_0x471cb5(0x161),_0x471cb5(0x125),'bnb',_0x471cb5(0x156),_0x471cb5(0xfd),'xlm','link','dot',_0x471cb5(0x128),'usd',_0x471cb5(0x117),'ars','aud','bdt',_0x471cb5(0x15c),_0x471cb5(0x15b),_0x471cb5(0x15a),'cad','chf',_0x471cb5(0x16b),_0x471cb5(0x145),_0x471cb5(0x10c),'dkk','eur',_0x471cb5(0x14c),_0x471cb5(0x152),'hkd',_0x471cb5(0x120),_0x471cb5(0x11a),'ils',_0x471cb5(0x139),_0x471cb5(0x13d),_0x471cb5(0x10b),_0x471cb5(0x14b),_0x471cb5(0x149),'mmk',_0x471cb5(0x118),_0x471cb5(0x123),'ngn','nok',_0x471cb5(0x16a),_0x471cb5(0x14e),'pkr',_0x471cb5(0x12c),_0x471cb5(0x143),'sar',_0x471cb5(0x122),'sgd',_0x471cb5(0x15f),_0x471cb5(0x126),_0x471cb5(0x108),_0x471cb5(0x11f),_0x471cb5(0x144),'vnd',_0x471cb5(0x135),_0x471cb5(0x167),_0x471cb5(0x146),'xau','bits','sats'],this[_0x471cb5(0x11b)]=null,this[_0x471cb5(0x107)]=0x3,this[_0x471cb5(0x12e)]();}['startPeriodicUpdates'](){const _0x38ba8c=a39_0x543bb2;this['updateCurrencyRates']()[_0x38ba8c(0x157)](_0x33dd86=>{const _0x106246=_0x38ba8c;console[_0x106246(0x10f)](_0x106246(0x109),_0x33dd86);}),this['updateInterval']=setInterval(async()=>{const _0x171551=_0x38ba8c;try{await this[_0x171551(0x13c)]();}catch(_0x5c5c6a){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x5c5c6a);}},0x3c*0x3c*0x3e8),console[_0x38ba8c(0x102)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x543bb2(0x10a)](){const _0x53a6c7=a39_0x543bb2;this[_0x53a6c7(0x11b)]&&(clearInterval(this[_0x53a6c7(0x11b)]),this[_0x53a6c7(0x11b)]=null,console[_0x53a6c7(0x102)](_0x53a6c7(0x151)));}async[a39_0x543bb2(0x13c)](){const _0x2e37bb=a39_0x543bb2;try{console[_0x2e37bb(0x102)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x531498=this[_0x2e37bb(0x137)][_0x2e37bb(0x162)](','),_0x3d0e0b=this[_0x2e37bb(0x168)]+_0x2e37bb(0x14d)+_0x531498,_0x2ed7d5=await fetch(_0x3d0e0b,{'headers':{'Accept':'application/json','User-Agent':_0x2e37bb(0x15e)}});if(!_0x2ed7d5['ok'])throw new Error(_0x2e37bb(0x134)+_0x2ed7d5['status']+'\x20'+_0x2ed7d5[_0x2e37bb(0x158)]);const _0x5f5577=await _0x2ed7d5['json']();if(!_0x5f5577['tether'])throw new Error(_0x2e37bb(0x165));const _0x4d73af=_0x5f5577[_0x2e37bb(0x13e)];console['log'](_0x2e37bb(0x14a)+Object[_0x2e37bb(0x12d)](_0x4d73af)[_0x2e37bb(0x111)]+_0x2e37bb(0x11d));const _0x6f57d0=Object[_0x2e37bb(0x131)](_0x4d73af)['map'](async([_0x53ed40,_0x17d7a5])=>{const _0x34fdf5=_0x2e37bb;try{await database_1[_0x34fdf5(0x166)][_0x34fdf5(0x132)]['upsert']({'where':{'currency':_0x53ed40['toLowerCase']()},'update':{'rate':_0x17d7a5},'create':{'currency':_0x53ed40[_0x34fdf5(0x129)](),'rate':_0x17d7a5}});}catch(_0x181ebd){console[_0x34fdf5(0x10f)](_0x34fdf5(0x153)+_0x53ed40+':',_0x181ebd);}});await Promise[_0x2e37bb(0x101)](_0x6f57d0),console[_0x2e37bb(0x102)](_0x2e37bb(0x140));}catch(_0x4ebbda){console[_0x2e37bb(0x10f)](_0x2e37bb(0x130),_0x4ebbda);throw _0x4ebbda;}}async['getCurrencyRate'](_0x2ba9c6){const _0x3f7c41=a39_0x543bb2,_0x4184c1=_0x2ba9c6[_0x3f7c41(0x129)]();if(_0x4184c1===_0x3f7c41(0x164))return 0x1;try{const _0x4a14ca=await database_1['default'][_0x3f7c41(0x132)][_0x3f7c41(0xfe)]({'where':{'currency':_0x4184c1}});if(!_0x4a14ca)return console[_0x3f7c41(0x124)](_0x3f7c41(0x119)+_0x2ba9c6+_0x3f7c41(0x13a)),0x1;return _0x4a14ca[_0x3f7c41(0x127)];}catch(_0x1263e8){return console[_0x3f7c41(0x10f)](_0x3f7c41(0x15d)+_0x2ba9c6+':',_0x1263e8),0x1;}}async[a39_0x543bb2(0x150)](_0x459972,_0x9e8822){const _0x20d376=a39_0x543bb2,_0xd2e5c3=_0x9e8822[_0x20d376(0x129)]();if(_0xd2e5c3===_0x20d376(0x164)){const _0x5a6ab8=_0x459972*(0x1+this[_0x20d376(0x107)]/0x64);return console['log'](_0x20d376(0x100)+this[_0x20d376(0x107)]+'%\x20markup\x20to\x20'+_0x459972+'\x20USDT\x20=\x20'+_0x5a6ab8[_0x20d376(0x11e)](0x6)+'\x20USDT'),_0x5a6ab8;}try{const _0x405cd3=await this['getCurrencyRate'](_0xd2e5c3),_0x10a87c=_0x459972/_0x405cd3,_0x4f3537=_0x10a87c*(0x1+this[_0x20d376(0x107)]/0x64);return console[_0x20d376(0x102)](_0x20d376(0x155)+_0x459972+'\x20'+_0x9e8822[_0x20d376(0x133)]()+_0x20d376(0x12f)+_0x10a87c['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x20d376(0x107)]+'%\x20markup\x20=\x20'+_0x4f3537[_0x20d376(0x11e)](0x6)+_0x20d376(0x154)+_0x405cd3+')'),_0x4f3537;}catch(_0x1cd9aa){console[_0x20d376(0x10f)](_0x20d376(0x141)+_0x459972+'\x20'+_0x9e8822+_0x20d376(0x138),_0x1cd9aa);const _0x3950e0=_0x459972*(0x1+this[_0x20d376(0x107)]/0x64);return _0x3950e0;}}async[a39_0x543bb2(0x114)](_0x64f3f2){let _0x48c130=0x0;for(const {amount:_0x1e2c65,currency:_0x18b87c}of _0x64f3f2){const _0x189a42=await this['convertToUSDT'](_0x1e2c65,_0x18b87c);_0x48c130+=_0x189a42;}return _0x48c130;}async['getAllRates'](){const _0x2581cf=a39_0x543bb2;try{const _0x3409a9=await database_1['default'][_0x2581cf(0x132)][_0x2581cf(0x142)]({'select':{'currency':!![],'rate':!![]}}),_0xd048c={'usdt':0x1};return _0x3409a9[_0x2581cf(0x13f)](_0xa14cb0=>{const _0x51a7cc=_0x2581cf;_0xd048c[_0xa14cb0[_0x51a7cc(0x106)]]=_0xa14cb0[_0x51a7cc(0x127)];}),_0xd048c;}catch(_0x2205f4){return console[_0x2581cf(0x10f)](_0x2581cf(0x10e),_0x2205f4),{'usdt':0x1};}}async['getRatesStatus'](){const _0x24420d=a39_0x543bb2;try{const [_0x4af5b8,_0x23fd4e,_0x1e4851]=await Promise['all']([database_1[_0x24420d(0x166)][_0x24420d(0x132)][_0x24420d(0x136)](),database_1[_0x24420d(0x166)]['currencyRate'][_0x24420d(0x113)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x24420d(0x103)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4af5b8,'lastUpdated':_0x23fd4e?.['updatedAt']||null,'oldestRate':_0x1e4851?.[_0x24420d(0x10d)]||null,'markupPercentage':this[_0x24420d(0x107)]};}catch(_0x1031aa){return console[_0x24420d(0x10f)](_0x24420d(0x14f),_0x1031aa),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x24420d(0x107)]};}}[a39_0x543bb2(0x13b)](){const _0x46f39b=a39_0x543bb2;return this[_0x46f39b(0x107)];}}exports[a39_0x543bb2(0x12a)]=CurrencyService,exports[a39_0x543bb2(0x163)]=new CurrencyService();