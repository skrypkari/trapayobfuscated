'use strict';const a38_0x277e4b=a38_0x303d;function a38_0x303d(_0x41b6eb,_0x16a558){const _0x2ac41b=a38_0x2ac4();return a38_0x303d=function(_0x303d90,_0x2396bb){_0x303d90=_0x303d90-0xe7;let _0x22f6bd=_0x2ac41b[_0x303d90];return _0x22f6bd;},a38_0x303d(_0x41b6eb,_0x16a558);}(function(_0x27f5f2,_0x2dba5c){const _0x529988=a38_0x303d,_0x399b17=_0x27f5f2();while(!![]){try{const _0x2c8840=-parseInt(_0x529988(0x15d))/0x1+-parseInt(_0x529988(0x13e))/0x2+-parseInt(_0x529988(0x163))/0x3*(-parseInt(_0x529988(0x149))/0x4)+parseInt(_0x529988(0xe7))/0x5+-parseInt(_0x529988(0x13d))/0x6*(-parseInt(_0x529988(0x15a))/0x7)+-parseInt(_0x529988(0xf1))/0x8+parseInt(_0x529988(0x115))/0x9*(-parseInt(_0x529988(0x10e))/0xa);if(_0x2c8840===_0x2dba5c)break;else _0x399b17['push'](_0x399b17['shift']());}catch(_0x46b0bb){_0x399b17['push'](_0x399b17['shift']());}}}(a38_0x2ac4,0x98db9));var __importDefault=this&&this[a38_0x277e4b(0x152)]||function(_0x42f81a){const _0x15cc89=a38_0x277e4b;return _0x42f81a&&_0x42f81a[_0x15cc89(0x105)]?_0x42f81a:{'default':_0x42f81a};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x277e4b(0x145)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));function a38_0x2ac4(){const _0x6d9cb8=['Error\x20getting\x20all\x20rates:','huf','sgd','gbp','aud','💱\x20Converted\x20','__importDefault','\x20to\x20USDT:','No\x20rate\x20found\x20for\x20currency:\x20','rub','eur','clp','yfi','currencyRate','2924369pESfWo','bnb','rate','66591CpWBNo','updateInterval','forEach','💱\x20Applied\x20','eos','catch','247344jdlxwn','updateCurrencyRates','getAllRates','%\x20markup\x20to\x20','5864080dbXxnB','updatedAt','\x20USDT,\x20with\x20','convertToUSDT','ngn','MARKUP_PERCENTAGE','myr','btc',',\x20using\x201\x20as\x20fallback','kwd','7890736KWImBP','twd','join','krw','gel','php','\x20USDT\x20(rate:\x20','cad','ils','getRatesStatus','all','xau','czk','Failed\x20to\x20update\x20rate\x20for\x20','inr','https://api.coingecko.com/api/v3/simple/price','startPeriodicUpdates','hkd','CoinGecko\x20API\x20error:\x20','Error\x20getting\x20rate\x20for\x20currency\x20','__esModule','usd','toUpperCase','COINGECKO_URL','count','brl','link','Error\x20getting\x20rates\x20status:','json','10xfjyFy','mmk','getMarkupPercentage','log','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','findFirst','pkr','3639591hOpnhy','nok','findMany','application/json','bits','bch','currency','getCurrencyRate','Periodic\x20currency\x20rates\x20update\x20failed:','xlm','toLowerCase','allSettled','vnd','uah','?ids=tether&vs_currencies=','sats','vef','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','sek','asc','dkk','bhd','statusText','eth','\x20to\x20','stopPeriodicUpdates','TesSoft\x20Payment\x20System/1.0','%\x20markup\x20=\x20','\x20currencies','usdt','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','warn','ars','\x20USDT','status','sar','try','xrp','error','CurrencyService','6hHDCih','3668QljcbV','aed','mxn','desc','toFixed','convertMultipleToUSDT','keys','currencyService','xdr','nzd','lkr','24JQXAqf','tether','default'];a38_0x2ac4=function(){return _0x6d9cb8;};return a38_0x2ac4();}class CurrencyService{constructor(){const _0x448dea=a38_0x277e4b;this[_0x448dea(0x108)]=_0x448dea(0x100),this['CURRENCIES']=[_0x448dea(0xee),_0x448dea(0x12c),'ltc',_0x448dea(0x11a),_0x448dea(0x15b),_0x448dea(0x161),_0x448dea(0x13a),_0x448dea(0x11e),_0x448dea(0x10b),'dot',_0x448dea(0x158),_0x448dea(0x106),_0x448dea(0x13f),_0x448dea(0x135),_0x448dea(0x150),'bdt',_0x448dea(0x12a),'bmd',_0x448dea(0x10a),_0x448dea(0xf8),'chf',_0x448dea(0x157),'cny',_0x448dea(0xfd),_0x448dea(0x129),_0x448dea(0x156),_0x448dea(0x14f),_0x448dea(0xf5),_0x448dea(0x102),_0x448dea(0x14d),'idr',_0x448dea(0xf9),_0x448dea(0xff),'jpy',_0x448dea(0xf4),_0x448dea(0xf0),_0x448dea(0x148),_0x448dea(0x10f),_0x448dea(0x140),_0x448dea(0xed),_0x448dea(0xeb),_0x448dea(0x116),_0x448dea(0x147),_0x448dea(0xf6),_0x448dea(0x114),'pln',_0x448dea(0x155),_0x448dea(0x138),_0x448dea(0x127),_0x448dea(0x14e),'thb',_0x448dea(0x139),_0x448dea(0xf2),_0x448dea(0x122),_0x448dea(0x125),_0x448dea(0x121),'zar',_0x448dea(0x146),'xag',_0x448dea(0xfc),_0x448dea(0x119),_0x448dea(0x124)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x448dea(0x101)]();}[a38_0x277e4b(0x101)](){const _0x5817fc=a38_0x277e4b;this[_0x5817fc(0x164)]()[_0x5817fc(0x162)](_0x11dbff=>{const _0x501f5d=_0x5817fc;console[_0x501f5d(0x13b)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x11dbff);}),this['updateInterval']=setInterval(async()=>{const _0x1cc546=_0x5817fc;try{await this[_0x1cc546(0x164)]();}catch(_0xed9ab5){console[_0x1cc546(0x13b)](_0x1cc546(0x11d),_0xed9ab5);}},0x3c*0x3c*0x3e8),console[_0x5817fc(0x111)](_0x5817fc(0x133));}[a38_0x277e4b(0x12e)](){const _0xf5d80d=a38_0x277e4b;this[_0xf5d80d(0x15e)]&&(clearInterval(this[_0xf5d80d(0x15e)]),this['updateInterval']=null,console['log'](_0xf5d80d(0x126)));}async[a38_0x277e4b(0x164)](){const _0x2c5cee=a38_0x277e4b;try{console[_0x2c5cee(0x111)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xd65aff=this['CURRENCIES'][_0x2c5cee(0xf3)](','),_0xa0ceba=this[_0x2c5cee(0x108)]+_0x2c5cee(0x123)+_0xd65aff,_0x9a7515=await fetch(_0xa0ceba,{'headers':{'Accept':_0x2c5cee(0x118),'User-Agent':_0x2c5cee(0x12f)}});if(!_0x9a7515['ok'])throw new Error(_0x2c5cee(0x103)+_0x9a7515[_0x2c5cee(0x137)]+'\x20'+_0x9a7515[_0x2c5cee(0x12b)]);const _0x3b2fa1=await _0x9a7515[_0x2c5cee(0x10d)]();if(!_0x3b2fa1[_0x2c5cee(0x14a)])throw new Error(_0x2c5cee(0x112));const _0xa4edd1=_0x3b2fa1[_0x2c5cee(0x14a)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x2c5cee(0x144)](_0xa4edd1)['length']+_0x2c5cee(0x131));const _0x5de217=Object['entries'](_0xa4edd1)['map'](async([_0x38f0e3,_0x5e0a54])=>{const _0x4bb931=_0x2c5cee;try{await database_1[_0x4bb931(0x14b)][_0x4bb931(0x159)]['upsert']({'where':{'currency':_0x38f0e3[_0x4bb931(0x11f)]()},'update':{'rate':_0x5e0a54},'create':{'currency':_0x38f0e3[_0x4bb931(0x11f)](),'rate':_0x5e0a54}});}catch(_0xf65716){console[_0x4bb931(0x13b)](_0x4bb931(0xfe)+_0x38f0e3+':',_0xf65716);}});await Promise[_0x2c5cee(0x120)](_0x5de217),console[_0x2c5cee(0x111)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x6e15cc){console[_0x2c5cee(0x13b)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x6e15cc);throw _0x6e15cc;}}async['getCurrencyRate'](_0xbd8c9f){const _0x3eb182=a38_0x277e4b,_0x542ffd=_0xbd8c9f[_0x3eb182(0x11f)]();if(_0x542ffd==='usdt')return 0x1;try{const _0x27f180=await database_1['default'][_0x3eb182(0x159)]['findUnique']({'where':{'currency':_0x542ffd}});if(!_0x27f180)return console[_0x3eb182(0x134)](_0x3eb182(0x154)+_0xbd8c9f+_0x3eb182(0xef)),0x1;return _0x27f180[_0x3eb182(0x15c)];}catch(_0x4f8f6e){return console[_0x3eb182(0x13b)](_0x3eb182(0x104)+_0xbd8c9f+':',_0x4f8f6e),0x1;}}async[a38_0x277e4b(0xea)](_0x43bce6,_0x1cc455){const _0x48eb09=a38_0x277e4b,_0x1a2d19=_0x1cc455[_0x48eb09(0x11f)]();if(_0x1a2d19===_0x48eb09(0x132)){const _0x33e8b5=_0x43bce6*(0x1+this[_0x48eb09(0xec)]/0x64);return console['log'](_0x48eb09(0x160)+this[_0x48eb09(0xec)]+_0x48eb09(0x166)+_0x43bce6+'\x20USDT\x20=\x20'+_0x33e8b5['toFixed'](0x6)+_0x48eb09(0x136)),_0x33e8b5;}try{const _0x3d165f=await this[_0x48eb09(0x11c)](_0x1a2d19),_0x2aea47=_0x43bce6/_0x3d165f,_0x121fab=_0x2aea47*(0x1+this[_0x48eb09(0xec)]/0x64);return console[_0x48eb09(0x111)](_0x48eb09(0x151)+_0x43bce6+'\x20'+_0x1cc455[_0x48eb09(0x107)]()+_0x48eb09(0x12d)+_0x2aea47[_0x48eb09(0x142)](0x6)+_0x48eb09(0xe9)+this[_0x48eb09(0xec)]+_0x48eb09(0x130)+_0x121fab[_0x48eb09(0x142)](0x6)+_0x48eb09(0xf7)+_0x3d165f+')'),_0x121fab;}catch(_0x3d5fe7){console[_0x48eb09(0x13b)]('Error\x20converting\x20'+_0x43bce6+'\x20'+_0x1cc455+_0x48eb09(0x153),_0x3d5fe7);const _0x279024=_0x43bce6*(0x1+this[_0x48eb09(0xec)]/0x64);return _0x279024;}}async[a38_0x277e4b(0x143)](_0x147075){const _0x49decc=a38_0x277e4b;let _0xed6fbd=0x0;for(const {amount:_0x162f7f,currency:_0x3031b3}of _0x147075){const _0x581331=await this[_0x49decc(0xea)](_0x162f7f,_0x3031b3);_0xed6fbd+=_0x581331;}return _0xed6fbd;}async[a38_0x277e4b(0x165)](){const _0x1afc50=a38_0x277e4b;try{const _0x4127c3=await database_1['default'][_0x1afc50(0x159)][_0x1afc50(0x117)]({'select':{'currency':!![],'rate':!![]}}),_0x4e3346={'usdt':0x1};return _0x4127c3[_0x1afc50(0x15f)](_0x214040=>{const _0x480a4e=_0x1afc50;_0x4e3346[_0x214040[_0x480a4e(0x11b)]]=_0x214040[_0x480a4e(0x15c)];}),_0x4e3346;}catch(_0x3b4ccd){return console[_0x1afc50(0x13b)](_0x1afc50(0x14c),_0x3b4ccd),{'usdt':0x1};}}async[a38_0x277e4b(0xfa)](){const _0x21bc74=a38_0x277e4b;try{const [_0x843d50,_0x1ac0e5,_0x3365b1]=await Promise[_0x21bc74(0xfb)]([database_1[_0x21bc74(0x14b)][_0x21bc74(0x159)][_0x21bc74(0x109)](),database_1['default'][_0x21bc74(0x159)][_0x21bc74(0x113)]({'orderBy':{'updatedAt':_0x21bc74(0x141)},'select':{'updatedAt':!![]}}),database_1[_0x21bc74(0x14b)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x21bc74(0x128)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x843d50,'lastUpdated':_0x1ac0e5?.['updatedAt']||null,'oldestRate':_0x3365b1?.[_0x21bc74(0xe8)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0xd65eba){return console[_0x21bc74(0x13b)](_0x21bc74(0x10c),_0xd65eba),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x21bc74(0xec)]};}}[a38_0x277e4b(0x110)](){const _0x29fb94=a38_0x277e4b;return this[_0x29fb94(0xec)];}}exports[a38_0x277e4b(0x13c)]=CurrencyService,exports[a38_0x277e4b(0x145)]=new CurrencyService();