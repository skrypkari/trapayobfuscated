'use strict';const a38_0x19dcca=a38_0x3b92;(function(_0x665837,_0x519bb3){const _0x4badc9=a38_0x3b92,_0x39da1b=_0x665837();while(!![]){try{const _0x5cae99=parseInt(_0x4badc9(0xef))/0x1*(parseInt(_0x4badc9(0xc5))/0x2)+parseInt(_0x4badc9(0xc9))/0x3+parseInt(_0x4badc9(0xbb))/0x4*(-parseInt(_0x4badc9(0xed))/0x5)+parseInt(_0x4badc9(0xb9))/0x6*(parseInt(_0x4badc9(0x99))/0x7)+parseInt(_0x4badc9(0xb5))/0x8*(parseInt(_0x4badc9(0x86))/0x9)+parseInt(_0x4badc9(0xbe))/0xa+-parseInt(_0x4badc9(0x8b))/0xb;if(_0x5cae99===_0x519bb3)break;else _0x39da1b['push'](_0x39da1b['shift']());}catch(_0x1a3898){_0x39da1b['push'](_0x39da1b['shift']());}}}(a38_0x2073,0xbc87f));var __importDefault=this&&this[a38_0x19dcca(0x96)]||function(_0x55a344){const _0x43499f=a38_0x19dcca;return _0x55a344&&_0x55a344[_0x43499f(0xde)]?_0x55a344:{'default':_0x55a344};};Object[a38_0x19dcca(0x89)](exports,'__esModule',{'value':!![]}),exports[a38_0x19dcca(0xe7)]=exports[a38_0x19dcca(0xfa)]=void 0x0;const database_1=__importDefault(require(a38_0x19dcca(0xcc)));class CurrencyService{constructor(){const _0x1b8f81=a38_0x19dcca;this[_0x1b8f81(0x84)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x1b8f81(0x8a),_0x1b8f81(0xe3),_0x1b8f81(0xf9),_0x1b8f81(0xdc),_0x1b8f81(0xd9),_0x1b8f81(0xdd),_0x1b8f81(0xe9),_0x1b8f81(0x94),_0x1b8f81(0xd0),_0x1b8f81(0xf8),'yfi',_0x1b8f81(0x8e),_0x1b8f81(0xaa),_0x1b8f81(0x85),_0x1b8f81(0x9a),_0x1b8f81(0xbf),'bhd',_0x1b8f81(0xf6),'brl',_0x1b8f81(0x91),_0x1b8f81(0xbd),_0x1b8f81(0xdb),'cny',_0x1b8f81(0xd8),'dkk',_0x1b8f81(0xcd),_0x1b8f81(0xa0),_0x1b8f81(0xfd),_0x1b8f81(0x92),_0x1b8f81(0xca),_0x1b8f81(0xfb),_0x1b8f81(0xb0),_0x1b8f81(0xb6),'jpy',_0x1b8f81(0xf4),'kwd',_0x1b8f81(0xe1),_0x1b8f81(0x100),'mxn','myr',_0x1b8f81(0xf5),_0x1b8f81(0xa7),_0x1b8f81(0x87),_0x1b8f81(0xae),_0x1b8f81(0x8f),_0x1b8f81(0xb1),'rub','sar',_0x1b8f81(0xcf),_0x1b8f81(0x93),'thb',_0x1b8f81(0xf3),_0x1b8f81(0xe0),_0x1b8f81(0x88),_0x1b8f81(0x98),_0x1b8f81(0xf0),_0x1b8f81(0x101),_0x1b8f81(0xfe),_0x1b8f81(0x9f),_0x1b8f81(0xa1),_0x1b8f81(0xc0),'sats'],this['updateInterval']=null,this[_0x1b8f81(0xc2)]=0x3,this['startPeriodicUpdates']();}[a38_0x19dcca(0xc1)](){const _0x98c79b=a38_0x19dcca;this[_0x98c79b(0xc7)]()[_0x98c79b(0xab)](_0xd9949f=>{const _0x5ac409=_0x98c79b;console[_0x5ac409(0x9d)](_0x5ac409(0x9c),_0xd9949f);}),this[_0x98c79b(0xb3)]=setInterval(async()=>{const _0x24d4ae=_0x98c79b;try{await this[_0x24d4ae(0xc7)]();}catch(_0x4c2355){console[_0x24d4ae(0x9d)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x4c2355);}},0x3c*0x3c*0x3e8),console[_0x98c79b(0xd1)](_0x98c79b(0xeb));}[a38_0x19dcca(0x90)](){const _0x19dd2e=a38_0x19dcca;this[_0x19dd2e(0xb3)]&&(clearInterval(this[_0x19dd2e(0xb3)]),this[_0x19dd2e(0xb3)]=null,console[_0x19dd2e(0xd1)](_0x19dd2e(0xda)));}async[a38_0x19dcca(0xc7)](){const _0x47743a=a38_0x19dcca;try{console[_0x47743a(0xd1)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x3d3c5b=this[_0x47743a(0xd7)][_0x47743a(0xff)](','),_0x54bd1b=this[_0x47743a(0x84)]+_0x47743a(0xaf)+_0x3d3c5b,_0x216ef1=await fetch(_0x54bd1b,{'headers':{'Accept':_0x47743a(0xcb),'User-Agent':_0x47743a(0xbc)}});if(!_0x216ef1['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x216ef1['status']+'\x20'+_0x216ef1[_0x47743a(0xb2)]);const _0x4a37db=await _0x216ef1[_0x47743a(0xb4)]();if(!_0x4a37db[_0x47743a(0xdf)])throw new Error(_0x47743a(0xe8));const _0x20e333=_0x4a37db['tether'];console['log'](_0x47743a(0xec)+Object[_0x47743a(0xd2)](_0x20e333)[_0x47743a(0xa8)]+'\x20currencies');const _0x3fc0c9=Object[_0x47743a(0xa2)](_0x20e333)[_0x47743a(0x97)](async([_0x279644,_0x4789f8])=>{const _0x58320a=_0x47743a;try{await database_1[_0x58320a(0x9e)][_0x58320a(0xc6)]['upsert']({'where':{'currency':_0x279644[_0x58320a(0xe2)]()},'update':{'rate':_0x4789f8},'create':{'currency':_0x279644[_0x58320a(0xe2)](),'rate':_0x4789f8}});}catch(_0x5fa3e){console[_0x58320a(0x9d)](_0x58320a(0xe5)+_0x279644+':',_0x5fa3e);}});await Promise[_0x47743a(0xac)](_0x3fc0c9),console[_0x47743a(0xd1)](_0x47743a(0x9b));}catch(_0x24dd1a){console[_0x47743a(0x9d)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x24dd1a);throw _0x24dd1a;}}async['getCurrencyRate'](_0x2700e9){const _0x446711=a38_0x19dcca,_0x1573e1=_0x2700e9[_0x446711(0xe2)]();if(_0x1573e1==='usdt')return 0x1;try{const _0x37ab95=await database_1[_0x446711(0x9e)][_0x446711(0xc6)][_0x446711(0x8d)]({'where':{'currency':_0x1573e1}});if(!_0x37ab95)return console[_0x446711(0xb7)](_0x446711(0xe6)+_0x2700e9+_0x446711(0xf2)),0x1;return _0x37ab95['rate'];}catch(_0x5e2495){return console['error'](_0x446711(0xba)+_0x2700e9+':',_0x5e2495),0x1;}}async['convertToUSDT'](_0xc81890,_0x59a68e){const _0x141c47=a38_0x19dcca,_0x9152d5=_0x59a68e[_0x141c47(0xe2)]();if(_0x9152d5===_0x141c47(0x8c)){const _0x4ac226=_0xc81890*(0x1+this[_0x141c47(0xc2)]/0x64);return console[_0x141c47(0xd1)](_0x141c47(0xad)+this['MARKUP_PERCENTAGE']+_0x141c47(0xd5)+_0xc81890+'\x20USDT\x20=\x20'+_0x4ac226['toFixed'](0x6)+'\x20USDT'),_0x4ac226;}try{const _0x218534=await this[_0x141c47(0xf1)](_0x9152d5),_0x424ee5=_0xc81890/_0x218534,_0x516c6f=_0x424ee5*(0x1+this[_0x141c47(0xc2)]/0x64);return console[_0x141c47(0xd1)]('💱\x20Converted\x20'+_0xc81890+'\x20'+_0x59a68e[_0x141c47(0xa6)]()+_0x141c47(0xa9)+_0x424ee5[_0x141c47(0xf7)](0x6)+_0x141c47(0xd4)+this['MARKUP_PERCENTAGE']+_0x141c47(0xa4)+_0x516c6f[_0x141c47(0xf7)](0x6)+_0x141c47(0xa5)+_0x218534+')'),_0x516c6f;}catch(_0x3b422a){console['error'](_0x141c47(0xa3)+_0xc81890+'\x20'+_0x59a68e+_0x141c47(0xea),_0x3b422a);const _0x516777=_0xc81890*(0x1+this[_0x141c47(0xc2)]/0x64);return _0x516777;}}async['convertMultipleToUSDT'](_0x43a95f){const _0x1eb43a=a38_0x19dcca;let _0x3965e8=0x0;for(const {amount:_0x9dc3d5,currency:_0x1681af}of _0x43a95f){const _0x2c1cbc=await this[_0x1eb43a(0xee)](_0x9dc3d5,_0x1681af);_0x3965e8+=_0x2c1cbc;}return _0x3965e8;}async[a38_0x19dcca(0xfc)](){const _0x4180a0=a38_0x19dcca;try{const _0x2cf2d3=await database_1['default'][_0x4180a0(0xc6)][_0x4180a0(0xc8)]({'select':{'currency':!![],'rate':!![]}}),_0x13500b={'usdt':0x1};return _0x2cf2d3[_0x4180a0(0x95)](_0x5df11a=>{const _0x5c56f6=_0x4180a0;_0x13500b[_0x5df11a[_0x5c56f6(0x83)]]=_0x5df11a[_0x5c56f6(0xb8)];}),_0x13500b;}catch(_0x16d268){return console[_0x4180a0(0x9d)](_0x4180a0(0xce),_0x16d268),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4a999d=a38_0x19dcca;try{const [_0x24704d,_0x57924c,_0x553bbe]=await Promise[_0x4a999d(0xd3)]([database_1[_0x4a999d(0x9e)][_0x4a999d(0xc6)][_0x4a999d(0xc4)](),database_1[_0x4a999d(0x9e)][_0x4a999d(0xc6)][_0x4a999d(0x102)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x4a999d(0x9e)][_0x4a999d(0xc6)][_0x4a999d(0x102)]({'orderBy':{'updatedAt':_0x4a999d(0xd6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x24704d,'lastUpdated':_0x57924c?.[_0x4a999d(0xe4)]||null,'oldestRate':_0x553bbe?.[_0x4a999d(0xe4)]||null,'markupPercentage':this[_0x4a999d(0xc2)]};}catch(_0x3c55db){return console[_0x4a999d(0x9d)](_0x4a999d(0xc3),_0x3c55db),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0x41be37=a38_0x19dcca;return this[_0x41be37(0xc2)];}}function a38_0x2073(){const _0x17d085=['pln','statusText','updateInterval','json','56wZCvDe','inr','warn','rate','12252NLIAJT','Error\x20getting\x20rate\x20for\x20currency\x20','8SiaJWe','TesSoft\x20Payment\x20System/1.0','chf','6862430EVwVSF','bdt','bits','startPeriodicUpdates','MARKUP_PERCENTAGE','Error\x20getting\x20rates\x20status:','count','567306FoQxuZ','currencyRate','updateCurrencyRates','findMany','905691AFIUPG','huf','application/json','../config/database','eur','Error\x20getting\x20all\x20rates:','sek','link','log','keys','all','\x20USDT,\x20with\x20','%\x20markup\x20to\x20','asc','CURRENCIES','czk','bnb','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','clp','bch','eos','__esModule','tether','twd','lkr','toLowerCase','eth','updatedAt','Failed\x20to\x20update\x20rate\x20for\x20','No\x20rate\x20found\x20for\x20currency:\x20','currencyService','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','xrp','\x20to\x20USDT:','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','📊\x20Received\x20rates\x20for\x20','343715bodmOL','convertToUSDT','5vrtpCC','vnd','getCurrencyRate',',\x20using\x201\x20as\x20fallback','try','krw','ngn','bmd','toFixed','dot','ltc','CurrencyService','idr','getAllRates','gel','xdr','join','mmk','zar','findFirst','currency','COINGECKO_URL','ars','1318230hNPxDH','nzd','uah','defineProperty','btc','42072602hHUZfq','usdt','findUnique','usd','pkr','stopPeriodicUpdates','cad','hkd','sgd','xlm','forEach','__importDefault','map','vef','4466IcVZAD','aud','✅\x20Currency\x20rates\x20updated\x20successfully','Initial\x20currency\x20rates\x20update\x20failed:','error','default','xag','gbp','xau','entries','Error\x20converting\x20','%\x20markup\x20=\x20','\x20USDT\x20(rate:\x20','toUpperCase','nok','length','\x20to\x20','aed','catch','allSettled','💱\x20Applied\x20','php','?ids=tether&vs_currencies=','ils'];a38_0x2073=function(){return _0x17d085;};return a38_0x2073();}function a38_0x3b92(_0x55f329,_0xfc55a2){const _0x207388=a38_0x2073();return a38_0x3b92=function(_0x3b9204,_0x5656e2){_0x3b9204=_0x3b9204-0x83;let _0x2f2a07=_0x207388[_0x3b9204];return _0x2f2a07;},a38_0x3b92(_0x55f329,_0xfc55a2);}exports[a38_0x19dcca(0xfa)]=CurrencyService,exports[a38_0x19dcca(0xe7)]=new CurrencyService();