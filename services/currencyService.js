'use strict';const a38_0x9502af=a38_0x1b3b;(function(_0x473f6f,_0x1253d2){const _0x24cabe=a38_0x1b3b,_0x30f864=_0x473f6f();while(!![]){try{const _0x32ded2=parseInt(_0x24cabe(0x138))/0x1*(-parseInt(_0x24cabe(0x10e))/0x2)+-parseInt(_0x24cabe(0xd7))/0x3+-parseInt(_0x24cabe(0xd0))/0x4*(-parseInt(_0x24cabe(0x11b))/0x5)+-parseInt(_0x24cabe(0xf7))/0x6*(-parseInt(_0x24cabe(0xf2))/0x7)+parseInt(_0x24cabe(0x106))/0x8*(parseInt(_0x24cabe(0x117))/0x9)+parseInt(_0x24cabe(0x108))/0xa+parseInt(_0x24cabe(0x11f))/0xb*(-parseInt(_0x24cabe(0x112))/0xc);if(_0x32ded2===_0x1253d2)break;else _0x30f864['push'](_0x30f864['shift']());}catch(_0x56afd3){_0x30f864['push'](_0x30f864['shift']());}}}(a38_0x3510,0x750fc));var __importDefault=this&&this[a38_0x9502af(0x11e)]||function(_0x21e049){const _0x3be39d=a38_0x9502af;return _0x21e049&&_0x21e049[_0x3be39d(0xeb)]?_0x21e049:{'default':_0x21e049};};Object[a38_0x9502af(0xc6)](exports,a38_0x9502af(0xeb),{'value':!![]}),exports[a38_0x9502af(0x119)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x9502af(0xcf)));function a38_0x3510(){const _0x313cd5=['currency','xag','join','log','nzd','ltc','eth','inr','defineProperty','toLowerCase','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','upsert','📊\x20Received\x20rates\x20for\x20','ars','bits','ngn','nok','../config/database','4lILzjp','application/json','updateCurrencyRates','MARKUP_PERCENTAGE','xlm','length','json','1379532gKULee','eur','twd','aud','sar','map','rate','czk','allSettled','\x20USDT\x20=\x20','%\x20markup\x20=\x20','✅\x20Currency\x20rates\x20updated\x20successfully','zar','php','bch','btc','chf','Error\x20getting\x20rates\x20status:','%\x20markup\x20to\x20','pkr','__esModule','findFirst','mmk','\x20USDT','getRatesStatus','myr','idr','7axKReD','sats','dkk','kwd','gel','2941686mvSSKW','rub','vef','link','getCurrencyRate','startPeriodicUpdates','keys','\x20USDT,\x20with\x20','clp','eos','cny','💱\x20Converted\x20','getMarkupPercentage','tether','error','11720iyfvbQ','bnb','1760780WTVmHb','https://api.coingecko.com/api/v3/simple/price','hkd','catch','count','Error\x20getting\x20rate\x20for\x20currency\x20','1976ahRJNd','Failed\x20to\x20update\x20rate\x20for\x20','toFixed','Periodic\x20currency\x20rates\x20update\x20failed:','4066716SnBsGc','xau','bmd','CoinGecko\x20API\x20error:\x20','huf','4527HLaoCm','sek','currencyService','default','1543495sCXYUg','Error\x20getting\x20all\x20rates:','usdt','__importDefault','11bDyPVe','CurrencyService',',\x20using\x201\x20as\x20fallback','thb','vnd','krw','xrp','\x20to\x20USDT:','❌\x20Failed\x20to\x20update\x20currency\x20rates:','Initial\x20currency\x20rates\x20update\x20failed:','\x20USDT\x20(rate:\x20','currencyRate','yfi','lkr','brl','updateInterval','\x20to\x20','convertToUSDT','COINGECKO_URL','getAllRates','findUnique','\x20currencies','TesSoft\x20Payment\x20System/1.0','forEach','convertMultipleToUSDT','439hrplin','asc'];a38_0x3510=function(){return _0x313cd5;};return a38_0x3510();}function a38_0x1b3b(_0x581f7f,_0x1d7871){const _0x351047=a38_0x3510();return a38_0x1b3b=function(_0x1b3b7c,_0x56a08b){_0x1b3b7c=_0x1b3b7c-0xc5;let _0x3a2722=_0x351047[_0x1b3b7c];return _0x3a2722;},a38_0x1b3b(_0x581f7f,_0x1d7871);}class CurrencyService{constructor(){const _0x9ce91f=a38_0x9502af;this['COINGECKO_URL']=_0x9ce91f(0x109),this['CURRENCIES']=[_0x9ce91f(0xe6),_0x9ce91f(0x140),_0x9ce91f(0x13f),_0x9ce91f(0xe5),_0x9ce91f(0x107),_0x9ce91f(0x100),_0x9ce91f(0x125),_0x9ce91f(0xd4),_0x9ce91f(0xfa),'dot',_0x9ce91f(0x12b),'usd','aed',_0x9ce91f(0xcb),_0x9ce91f(0xda),'bdt','bhd',_0x9ce91f(0x114),_0x9ce91f(0x12d),'cad',_0x9ce91f(0xe7),_0x9ce91f(0xff),_0x9ce91f(0x101),_0x9ce91f(0xde),_0x9ce91f(0xf4),_0x9ce91f(0xd8),'gbp',_0x9ce91f(0xf6),_0x9ce91f(0x10a),_0x9ce91f(0x116),_0x9ce91f(0xf1),'ils',_0x9ce91f(0xc5),'jpy',_0x9ce91f(0x124),_0x9ce91f(0xf5),_0x9ce91f(0x12c),_0x9ce91f(0xed),'mxn',_0x9ce91f(0xf0),_0x9ce91f(0xcd),_0x9ce91f(0xce),_0x9ce91f(0x13e),_0x9ce91f(0xe4),_0x9ce91f(0xea),'pln',_0x9ce91f(0xf8),_0x9ce91f(0xdb),_0x9ce91f(0x118),'sgd',_0x9ce91f(0x122),'try',_0x9ce91f(0xd9),'uah',_0x9ce91f(0xf9),_0x9ce91f(0x123),_0x9ce91f(0xe3),'xdr',_0x9ce91f(0x13b),_0x9ce91f(0x113),_0x9ce91f(0xcc),_0x9ce91f(0xf3)],this['updateInterval']=null,this[_0x9ce91f(0xd3)]=0x3,this[_0x9ce91f(0xfc)]();}[a38_0x9502af(0xfc)](){const _0x4f7733=a38_0x9502af;this[_0x4f7733(0xd2)]()[_0x4f7733(0x10b)](_0x4e5460=>{const _0x1b6e8=_0x4f7733;console['error'](_0x1b6e8(0x128),_0x4e5460);}),this['updateInterval']=setInterval(async()=>{const _0x4bebf2=_0x4f7733;try{await this[_0x4bebf2(0xd2)]();}catch(_0x2b2fa6){console['error'](_0x4bebf2(0x111),_0x2b2fa6);}},0x3c*0x3c*0x3e8),console[_0x4f7733(0x13d)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x4e1337=a38_0x9502af;this[_0x4e1337(0x12e)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x4e1337(0x13d)](_0x4e1337(0xc8)));}async['updateCurrencyRates'](){const _0x50cd4b=a38_0x9502af;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x6cfd37=this['CURRENCIES'][_0x50cd4b(0x13c)](','),_0x2933ca=this[_0x50cd4b(0x131)]+'?ids=tether&vs_currencies='+_0x6cfd37,_0x590e1b=await fetch(_0x2933ca,{'headers':{'Accept':_0x50cd4b(0xd1),'User-Agent':_0x50cd4b(0x135)}});if(!_0x590e1b['ok'])throw new Error(_0x50cd4b(0x115)+_0x590e1b['status']+'\x20'+_0x590e1b['statusText']);const _0x4be083=await _0x590e1b[_0x50cd4b(0xd6)]();if(!_0x4be083[_0x50cd4b(0x104)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x4061be=_0x4be083['tether'];console['log'](_0x50cd4b(0xca)+Object[_0x50cd4b(0xfd)](_0x4061be)[_0x50cd4b(0xd5)]+_0x50cd4b(0x134));const _0x4d20d9=Object['entries'](_0x4061be)[_0x50cd4b(0xdc)](async([_0x35febc,_0x4e81cd])=>{const _0x486bfd=_0x50cd4b;try{await database_1['default'][_0x486bfd(0x12a)][_0x486bfd(0xc9)]({'where':{'currency':_0x35febc[_0x486bfd(0xc7)]()},'update':{'rate':_0x4e81cd},'create':{'currency':_0x35febc[_0x486bfd(0xc7)](),'rate':_0x4e81cd}});}catch(_0x2fd055){console[_0x486bfd(0x105)](_0x486bfd(0x10f)+_0x35febc+':',_0x2fd055);}});await Promise[_0x50cd4b(0xdf)](_0x4d20d9),console['log'](_0x50cd4b(0xe2));}catch(_0x4dc948){console[_0x50cd4b(0x105)](_0x50cd4b(0x127),_0x4dc948);throw _0x4dc948;}}async[a38_0x9502af(0xfb)](_0x49028b){const _0x2e8e4f=a38_0x9502af,_0x2f3fb1=_0x49028b['toLowerCase']();if(_0x2f3fb1===_0x2e8e4f(0x11d))return 0x1;try{const _0x1fd1fc=await database_1[_0x2e8e4f(0x11a)][_0x2e8e4f(0x12a)][_0x2e8e4f(0x133)]({'where':{'currency':_0x2f3fb1}});if(!_0x1fd1fc)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x49028b+_0x2e8e4f(0x121)),0x1;return _0x1fd1fc[_0x2e8e4f(0xdd)];}catch(_0x39045a){return console['error'](_0x2e8e4f(0x10d)+_0x49028b+':',_0x39045a),0x1;}}async[a38_0x9502af(0x130)](_0x36a613,_0x5e33a1){const _0x694094=a38_0x9502af,_0x43bdc8=_0x5e33a1[_0x694094(0xc7)]();if(_0x43bdc8===_0x694094(0x11d)){const _0x11131b=_0x36a613*(0x1+this[_0x694094(0xd3)]/0x64);return console['log']('💱\x20Applied\x20'+this[_0x694094(0xd3)]+_0x694094(0xe9)+_0x36a613+_0x694094(0xe0)+_0x11131b[_0x694094(0x110)](0x6)+_0x694094(0xee)),_0x11131b;}try{const _0x4dc0f8=await this[_0x694094(0xfb)](_0x43bdc8),_0x3ff778=_0x36a613/_0x4dc0f8,_0x393591=_0x3ff778*(0x1+this[_0x694094(0xd3)]/0x64);return console[_0x694094(0x13d)](_0x694094(0x102)+_0x36a613+'\x20'+_0x5e33a1['toUpperCase']()+_0x694094(0x12f)+_0x3ff778[_0x694094(0x110)](0x6)+_0x694094(0xfe)+this[_0x694094(0xd3)]+_0x694094(0xe1)+_0x393591['toFixed'](0x6)+_0x694094(0x129)+_0x4dc0f8+')'),_0x393591;}catch(_0x594a6d){console[_0x694094(0x105)]('Error\x20converting\x20'+_0x36a613+'\x20'+_0x5e33a1+_0x694094(0x126),_0x594a6d);const _0x51917f=_0x36a613*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x51917f;}}async[a38_0x9502af(0x137)](_0x4c75c3){let _0x42f039=0x0;for(const {amount:_0x2e83dc,currency:_0x3826a8}of _0x4c75c3){const _0x4d81f4=await this['convertToUSDT'](_0x2e83dc,_0x3826a8);_0x42f039+=_0x4d81f4;}return _0x42f039;}async[a38_0x9502af(0x132)](){const _0x1f7574=a38_0x9502af;try{const _0x31d183=await database_1[_0x1f7574(0x11a)][_0x1f7574(0x12a)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1e5a70={'usdt':0x1};return _0x31d183[_0x1f7574(0x136)](_0x419c25=>{const _0x14756e=_0x1f7574;_0x1e5a70[_0x419c25[_0x14756e(0x13a)]]=_0x419c25[_0x14756e(0xdd)];}),_0x1e5a70;}catch(_0x45fee3){return console['error'](_0x1f7574(0x11c),_0x45fee3),{'usdt':0x1};}}async[a38_0x9502af(0xef)](){const _0x1cad84=a38_0x9502af;try{const [_0x49fb76,_0x1559f9,_0x119563]=await Promise['all']([database_1[_0x1cad84(0x11a)][_0x1cad84(0x12a)][_0x1cad84(0x10c)](),database_1[_0x1cad84(0x11a)][_0x1cad84(0x12a)][_0x1cad84(0xec)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x1cad84(0x11a)][_0x1cad84(0x12a)]['findFirst']({'orderBy':{'updatedAt':_0x1cad84(0x139)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x49fb76,'lastUpdated':_0x1559f9?.['updatedAt']||null,'oldestRate':_0x119563?.['updatedAt']||null,'markupPercentage':this[_0x1cad84(0xd3)]};}catch(_0x4536f9){return console['error'](_0x1cad84(0xe8),_0x4536f9),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1cad84(0xd3)]};}}[a38_0x9502af(0x103)](){const _0x32baa0=a38_0x9502af;return this[_0x32baa0(0xd3)];}}exports[a38_0x9502af(0x120)]=CurrencyService,exports[a38_0x9502af(0x119)]=new CurrencyService();