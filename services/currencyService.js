'use strict';const a36_0xc6c4f6=a36_0x57af;(function(_0x2b19ff,_0x34951f){const _0x1da592=a36_0x57af,_0xed0308=_0x2b19ff();while(!![]){try{const _0x31cc62=-parseInt(_0x1da592(0x8d))/0x1*(parseInt(_0x1da592(0xbe))/0x2)+-parseInt(_0x1da592(0xc0))/0x3+-parseInt(_0x1da592(0xb8))/0x4*(-parseInt(_0x1da592(0xdb))/0x5)+parseInt(_0x1da592(0x86))/0x6+parseInt(_0x1da592(0xc8))/0x7+parseInt(_0x1da592(0x97))/0x8+parseInt(_0x1da592(0xaa))/0x9*(-parseInt(_0x1da592(0x70))/0xa);if(_0x31cc62===_0x34951f)break;else _0xed0308['push'](_0xed0308['shift']());}catch(_0x35ddef){_0xed0308['push'](_0xed0308['shift']());}}}(a36_0x4ef5,0xd23b7));function a36_0x57af(_0x52ccc8,_0x4bb575){const _0x4ef526=a36_0x4ef5();return a36_0x57af=function(_0x57afce,_0x50d53f){_0x57afce=_0x57afce-0x64;let _0x3edd83=_0x4ef526[_0x57afce];return _0x3edd83;},a36_0x57af(_0x52ccc8,_0x4bb575);}var __importDefault=this&&this['__importDefault']||function(_0xfd112f){return _0xfd112f&&_0xfd112f['__esModule']?_0xfd112f:{'default':_0xfd112f};};Object[a36_0xc6c4f6(0xd6)](exports,a36_0xc6c4f6(0x74),{'value':!![]}),exports['currencyService']=exports[a36_0xc6c4f6(0xc4)]=void 0x0;const database_1=__importDefault(require(a36_0xc6c4f6(0xda)));class CurrencyService{constructor(){const _0x8101d5=a36_0xc6c4f6;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x8101d5(0xca)]=[_0x8101d5(0xc2),_0x8101d5(0x92),_0x8101d5(0x98),_0x8101d5(0xe0),'bnb',_0x8101d5(0x9d),'xrp','xlm',_0x8101d5(0x7f),_0x8101d5(0xa1),_0x8101d5(0xb9),'usd',_0x8101d5(0x95),'ars',_0x8101d5(0xd1),_0x8101d5(0xc1),_0x8101d5(0xb5),'bmd',_0x8101d5(0x8e),_0x8101d5(0x6e),_0x8101d5(0xa5),_0x8101d5(0x72),_0x8101d5(0xb3),'czk','dkk',_0x8101d5(0xd8),'gbp',_0x8101d5(0xa2),_0x8101d5(0x89),_0x8101d5(0x8b),'idr',_0x8101d5(0xa6),_0x8101d5(0x87),_0x8101d5(0x7e),_0x8101d5(0xaf),'kwd',_0x8101d5(0xde),_0x8101d5(0xbf),'mxn',_0x8101d5(0xc7),_0x8101d5(0xcd),_0x8101d5(0x7d),'nzd',_0x8101d5(0x8c),_0x8101d5(0x73),_0x8101d5(0xb0),'rub',_0x8101d5(0x7c),_0x8101d5(0x9a),_0x8101d5(0x75),_0x8101d5(0xb1),_0x8101d5(0xc5),_0x8101d5(0x66),_0x8101d5(0xb2),_0x8101d5(0xd4),_0x8101d5(0x91),_0x8101d5(0xcb),_0x8101d5(0xb6),_0x8101d5(0x8f),_0x8101d5(0x6d),_0x8101d5(0x64),_0x8101d5(0x67)],this[_0x8101d5(0xa9)]=null,this[_0x8101d5(0xad)]=0x3,this[_0x8101d5(0xcf)]();}[a36_0xc6c4f6(0xcf)](){const _0x4ec913=a36_0xc6c4f6;this[_0x4ec913(0xc6)]()[_0x4ec913(0xd3)](_0x14cdfd=>{const _0x155555=_0x4ec913;console[_0x155555(0xbd)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x14cdfd);}),this['updateInterval']=setInterval(async()=>{const _0x13a85b=_0x4ec913;try{await this[_0x13a85b(0xc6)]();}catch(_0x17ef75){console[_0x13a85b(0xbd)](_0x13a85b(0x68),_0x17ef75);}},0x3c*0x3c*0x3e8),console['log'](_0x4ec913(0x9e));}[a36_0xc6c4f6(0x80)](){const _0x666969=a36_0xc6c4f6;this['updateInterval']&&(clearInterval(this[_0x666969(0xa9)]),this['updateInterval']=null,console['log'](_0x666969(0xc9)));}async['updateCurrencyRates'](){const _0x188454=a36_0xc6c4f6;try{console[_0x188454(0x65)](_0x188454(0xae));const _0x106a76=this[_0x188454(0xca)][_0x188454(0x76)](','),_0x22182a=this[_0x188454(0xac)]+_0x188454(0x77)+_0x106a76,_0x2518cd=await fetch(_0x22182a,{'headers':{'Accept':_0x188454(0x82),'User-Agent':_0x188454(0xdc)}});if(!_0x2518cd['ok'])throw new Error(_0x188454(0x9b)+_0x2518cd[_0x188454(0x6a)]+'\x20'+_0x2518cd[_0x188454(0x6f)]);const _0x168af4=await _0x2518cd[_0x188454(0x79)]();if(!_0x168af4['tether'])throw new Error(_0x188454(0x96));const _0x381641=_0x168af4[_0x188454(0xa4)];console['log'](_0x188454(0xa8)+Object['keys'](_0x381641)['length']+_0x188454(0x83));const _0x565de2=Object[_0x188454(0x7a)](_0x381641)['map'](async([_0x43552f,_0x2f7a50])=>{const _0xe53eb4=_0x188454;try{await database_1['default'][_0xe53eb4(0x71)]['upsert']({'where':{'currency':_0x43552f['toLowerCase']()},'update':{'rate':_0x2f7a50},'create':{'currency':_0x43552f[_0xe53eb4(0x8a)](),'rate':_0x2f7a50}});}catch(_0x303a69){console[_0xe53eb4(0xbd)](_0xe53eb4(0xd5)+_0x43552f+':',_0x303a69);}});await Promise[_0x188454(0x78)](_0x565de2),console[_0x188454(0x65)](_0x188454(0x7b));}catch(_0x40550a){console[_0x188454(0xbd)](_0x188454(0x85),_0x40550a);throw _0x40550a;}}async['getCurrencyRate'](_0x3f38aa){const _0x1e1f0c=a36_0xc6c4f6,_0x56966c=_0x3f38aa[_0x1e1f0c(0x8a)]();if(_0x56966c===_0x1e1f0c(0xcc))return 0x1;try{const _0x1d2582=await database_1[_0x1e1f0c(0xb4)]['currencyRate'][_0x1e1f0c(0x69)]({'where':{'currency':_0x56966c}});if(!_0x1d2582)return console['warn'](_0x1e1f0c(0x94)+_0x3f38aa+_0x1e1f0c(0xba)),0x1;return _0x1d2582['rate'];}catch(_0x5f4588){return console[_0x1e1f0c(0xbd)](_0x1e1f0c(0xa0)+_0x3f38aa+':',_0x5f4588),0x1;}}async[a36_0xc6c4f6(0x99)](_0x5f518e,_0x47c4fc){const _0x26b646=a36_0xc6c4f6,_0x221f42=_0x47c4fc[_0x26b646(0x8a)]();if(_0x221f42===_0x26b646(0xcc)){const _0x42ff23=_0x5f518e*(0x1+this[_0x26b646(0xad)]/0x64);return console[_0x26b646(0x65)](_0x26b646(0xd0)+this['MARKUP_PERCENTAGE']+_0x26b646(0x84)+_0x5f518e+_0x26b646(0x9f)+_0x42ff23[_0x26b646(0xd9)](0x6)+_0x26b646(0xa7)),_0x42ff23;}try{const _0x56bf4e=await this['getCurrencyRate'](_0x221f42),_0x4108cf=_0x5f518e/_0x56bf4e,_0x392a14=_0x4108cf*(0x1+this[_0x26b646(0xad)]/0x64);return console[_0x26b646(0x65)](_0x26b646(0xbb)+_0x5f518e+'\x20'+_0x47c4fc['toUpperCase']()+_0x26b646(0x93)+_0x4108cf[_0x26b646(0xd9)](0x6)+_0x26b646(0x88)+this[_0x26b646(0xad)]+_0x26b646(0xbc)+_0x392a14[_0x26b646(0xd9)](0x6)+'\x20USDT\x20(rate:\x20'+_0x56bf4e+')'),_0x392a14;}catch(_0x587c75){console[_0x26b646(0xbd)](_0x26b646(0xb7)+_0x5f518e+'\x20'+_0x47c4fc+_0x26b646(0x6c),_0x587c75);const _0x185fb5=_0x5f518e*(0x1+this[_0x26b646(0xad)]/0x64);return _0x185fb5;}}async[a36_0xc6c4f6(0xdf)](_0x2e2fba){const _0x1acf8a=a36_0xc6c4f6;let _0xee1fff=0x0;for(const {amount:_0x4ae420,currency:_0x309414}of _0x2e2fba){const _0x3fe679=await this[_0x1acf8a(0x99)](_0x4ae420,_0x309414);_0xee1fff+=_0x3fe679;}return _0xee1fff;}async[a36_0xc6c4f6(0x90)](){const _0x4fb75e=a36_0xc6c4f6;try{const _0x33ccec=await database_1[_0x4fb75e(0xb4)][_0x4fb75e(0x71)][_0x4fb75e(0xa3)]({'select':{'currency':!![],'rate':!![]}}),_0x32c765={'usdt':0x1};return _0x33ccec['forEach'](_0x148873=>{const _0xddd6cb=_0x4fb75e;_0x32c765[_0x148873['currency']]=_0x148873[_0xddd6cb(0xd2)];}),_0x32c765;}catch(_0x9dab0e){return console[_0x4fb75e(0xbd)](_0x4fb75e(0xce),_0x9dab0e),{'usdt':0x1};}}async['getRatesStatus'](){const _0xe2dafe=a36_0xc6c4f6;try{const [_0x1174b5,_0x3cb94e,_0x554b2f]=await Promise['all']([database_1[_0xe2dafe(0xb4)][_0xe2dafe(0x71)][_0xe2dafe(0xc3)](),database_1['default'][_0xe2dafe(0x71)][_0xe2dafe(0xd7)]({'orderBy':{'updatedAt':_0xe2dafe(0x9c)},'select':{'updatedAt':!![]}}),database_1[_0xe2dafe(0xb4)][_0xe2dafe(0x71)][_0xe2dafe(0xd7)]({'orderBy':{'updatedAt':_0xe2dafe(0x6b)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1174b5,'lastUpdated':_0x3cb94e?.[_0xe2dafe(0x81)]||null,'oldestRate':_0x554b2f?.['updatedAt']||null,'markupPercentage':this[_0xe2dafe(0xad)]};}catch(_0x5b8e0d){return console[_0xe2dafe(0xbd)]('Error\x20getting\x20rates\x20status:',_0x5b8e0d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xe2dafe(0xad)]};}}[a36_0xc6c4f6(0xdd)](){const _0x34a866=a36_0xc6c4f6;return this[_0x34a866(0xad)];}}function a36_0x4ef5(){const _0x1eaaba=['xau','cad','statusText','1085370KWbkMm','currencyRate','clp','pkr','__esModule','sgd','join','?ids=tether&vs_currencies=','allSettled','json','entries','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','sar','nok','jpy','link','stopPeriodicUpdates','updatedAt','application/json','\x20currencies','%\x20markup\x20to\x20','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','8277720mwswrA','inr','\x20USDT,\x20with\x20','hkd','toLowerCase','huf','php','3BqvoMM','brl','xag','getAllRates','vnd','eth','\x20to\x20','No\x20rate\x20found\x20for\x20currency:\x20','aed','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','2830856fXbDUJ','ltc','convertToUSDT','sek','CoinGecko\x20API\x20error:\x20','desc','eos','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20USDT\x20=\x20','Error\x20getting\x20rate\x20for\x20currency\x20','dot','gel','findMany','tether','chf','ils','\x20USDT','üìä\x20Received\x20rates\x20for\x20','updateInterval','36MmCsIf','currencyService','COINGECKO_URL','MARKUP_PERCENTAGE','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','krw','pln','thb','uah','cny','default','bhd','xdr','Error\x20converting\x20','716AtVgBo','yfi',',\x20using\x201\x20as\x20fallback','üí±\x20Converted\x20','%\x20markup\x20=\x20','error','329394hSbMdd','mmk','4615506ncMURr','bdt','btc','count','CurrencyService','try','updateCurrencyRates','myr','9314956jCvbhN','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','CURRENCIES','zar','usdt','ngn','Error\x20getting\x20all\x20rates:','startPeriodicUpdates','üí±\x20Applied\x20','aud','rate','catch','vef','Failed\x20to\x20update\x20rate\x20for\x20','defineProperty','findFirst','eur','toFixed','../config/database','7365uxJMsd','TesSoft\x20Payment\x20System/1.0','getMarkupPercentage','lkr','convertMultipleToUSDT','bch','bits','log','twd','sats','Periodic\x20currency\x20rates\x20update\x20failed:','findUnique','status','asc','\x20to\x20USDT:'];a36_0x4ef5=function(){return _0x1eaaba;};return a36_0x4ef5();}exports['CurrencyService']=CurrencyService,exports[a36_0xc6c4f6(0xab)]=new CurrencyService();