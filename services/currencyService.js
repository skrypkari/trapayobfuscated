'use strict';const a38_0x59baca=a38_0x4118;(function(_0x1efe37,_0x7affd9){const _0x2daaf9=a38_0x4118,_0x16a1df=_0x1efe37();while(!![]){try{const _0x943c9b=parseInt(_0x2daaf9(0xd5))/0x1+parseInt(_0x2daaf9(0x10f))/0x2*(parseInt(_0x2daaf9(0xd2))/0x3)+-parseInt(_0x2daaf9(0x105))/0x4*(-parseInt(_0x2daaf9(0x134))/0x5)+-parseInt(_0x2daaf9(0xe2))/0x6*(-parseInt(_0x2daaf9(0x102))/0x7)+parseInt(_0x2daaf9(0x12d))/0x8*(parseInt(_0x2daaf9(0x12e))/0x9)+-parseInt(_0x2daaf9(0xce))/0xa*(parseInt(_0x2daaf9(0xfb))/0xb)+-parseInt(_0x2daaf9(0xe8))/0xc;if(_0x943c9b===_0x7affd9)break;else _0x16a1df['push'](_0x16a1df['shift']());}catch(_0x5bd7b1){_0x16a1df['push'](_0x16a1df['shift']());}}}(a38_0xf84b,0x197a5));function a38_0x4118(_0x4a7001,_0x1a8b22){const _0xf84b72=a38_0xf84b();return a38_0x4118=function(_0x4118e8,_0x496d31){_0x4118e8=_0x4118e8-0xcc;let _0x3c4a9e=_0xf84b72[_0x4118e8];return _0x3c4a9e;},a38_0x4118(_0x4a7001,_0x1a8b22);}var __importDefault=this&&this['__importDefault']||function(_0xd72a4f){const _0x2344ca=a38_0x4118;return _0xd72a4f&&_0xd72a4f[_0x2344ca(0xec)]?_0xd72a4f:{'default':_0xd72a4f};};function a38_0xf84b(){const _0x56c10f=['getCurrencyRate','sar','Error\x20getting\x20rate\x20for\x20currency\x20','all','bits','COINGECKO_URL','updatedAt','chf','findFirst','upsert','Failed\x20to\x20update\x20rate\x20for\x20','pln','statusText','Periodic\x20currency\x20rates\x20update\x20failed:','\x20USDT,\x20with\x20','stopPeriodicUpdates','join','findUnique','length','brl','czk','bnb','usd','startPeriodicUpdates','asc','40icUDJd','291726CIjKId','twd','toUpperCase','ltc','getAllRates','currency','821235djgIMz','jpy','updateCurrencyRates','convertToUSDT','allSettled','sek','getMarkupPercentage','xrp','vef','ars','../config/database','gbp','btc','sats','855430lvBJqp','rub','catch','uah','27kBNtaP','gel','usdt','125183RfTyEX','pkr','zar','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','No\x20rate\x20found\x20for\x20currency:\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','krw','status','cny','currencyRate','desc','MARKUP_PERCENTAGE','mxn','71274HlHnDM','toFixed','kwd','findMany','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','bmd','6770448mjDIjw','xau','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','eur','__esModule','getRatesStatus','default','forEach','link','bch','error','https://api.coingecko.com/api/v3/simple/price','aud','ils','Initial\x20currency\x20rates\x20update\x20failed:','thb','myr','toLowerCase','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','11rUEFNs','idr','CurrencyService','✅\x20Currency\x20rates\x20updated\x20successfully','ngn','\x20to\x20','map','84XAwsnh','xlm',',\x20using\x201\x20as\x20fallback','4hCYDZE','aed','bhd','CURRENCIES','log','cad','updateInterval','defineProperty','tether','entries','35568akKisI','rate','?ids=tether&vs_currencies=','application/json','📊\x20Received\x20rates\x20for\x20'];a38_0xf84b=function(){return _0x56c10f;};return a38_0xf84b();}Object[a38_0x59baca(0x10c)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a38_0x59baca(0xfd)]=void 0x0;const database_1=__importDefault(require(a38_0x59baca(0x13e)));class CurrencyService{constructor(){const _0x30680b=a38_0x59baca;this[_0x30680b(0x119)]=_0x30680b(0xf3),this[_0x30680b(0x108)]=[_0x30680b(0xcc),'eth',_0x30680b(0x131),_0x30680b(0xf1),_0x30680b(0x129),'eos',_0x30680b(0x13b),_0x30680b(0x103),_0x30680b(0xf0),'dot','yfi',_0x30680b(0x12a),_0x30680b(0x106),_0x30680b(0x13d),_0x30680b(0xf4),'bdt',_0x30680b(0x107),_0x30680b(0xe7),_0x30680b(0x127),_0x30680b(0x10a),_0x30680b(0x11b),'clp',_0x30680b(0xdd),_0x30680b(0x128),'dkk',_0x30680b(0xeb),_0x30680b(0x13f),_0x30680b(0xd3),'hkd','huf',_0x30680b(0xfc),_0x30680b(0xf5),'inr',_0x30680b(0x135),_0x30680b(0xdb),_0x30680b(0xe4),'lkr','mmk',_0x30680b(0xe1),_0x30680b(0xf8),_0x30680b(0xff),'nok','nzd','php',_0x30680b(0xd6),_0x30680b(0x11f),_0x30680b(0xcf),_0x30680b(0x115),_0x30680b(0x139),'sgd',_0x30680b(0xf7),'try',_0x30680b(0x12f),_0x30680b(0xd1),_0x30680b(0x13c),'vnd',_0x30680b(0xd7),'xdr','xag',_0x30680b(0xe9),_0x30680b(0x118),_0x30680b(0xcd)],this['updateInterval']=null,this[_0x30680b(0xe0)]=0x3,this[_0x30680b(0x12b)]();}[a38_0x59baca(0x12b)](){const _0x10b706=a38_0x59baca;this['updateCurrencyRates']()[_0x10b706(0xd0)](_0x5dc2fb=>{const _0x1fd2ab=_0x10b706;console['error'](_0x1fd2ab(0xf6),_0x5dc2fb);}),this[_0x10b706(0x10b)]=setInterval(async()=>{const _0xd87bdf=_0x10b706;try{await this[_0xd87bdf(0x136)]();}catch(_0x58e10a){console[_0xd87bdf(0xf2)](_0xd87bdf(0x121),_0x58e10a);}},0x3c*0x3c*0x3e8),console[_0x10b706(0x109)](_0x10b706(0xea));}[a38_0x59baca(0x123)](){const _0x1798e6=a38_0x59baca;this[_0x1798e6(0x10b)]&&(clearInterval(this[_0x1798e6(0x10b)]),this[_0x1798e6(0x10b)]=null,console[_0x1798e6(0x109)](_0x1798e6(0xd8)));}async[a38_0x59baca(0x136)](){const _0x4001a0=a38_0x59baca;try{console[_0x4001a0(0x109)](_0x4001a0(0xfa));const _0x2e5d94=this[_0x4001a0(0x108)][_0x4001a0(0x124)](','),_0x2f0c6f=this['COINGECKO_URL']+_0x4001a0(0x111)+_0x2e5d94,_0x52363d=await fetch(_0x2f0c6f,{'headers':{'Accept':_0x4001a0(0x112),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x52363d['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x52363d[_0x4001a0(0xdc)]+'\x20'+_0x52363d[_0x4001a0(0x120)]);const _0x16c098=await _0x52363d['json']();if(!_0x16c098[_0x4001a0(0x10d)])throw new Error(_0x4001a0(0xe6));const _0x29999f=_0x16c098[_0x4001a0(0x10d)];console[_0x4001a0(0x109)](_0x4001a0(0x113)+Object['keys'](_0x29999f)[_0x4001a0(0x126)]+'\x20currencies');const _0x515fd0=Object[_0x4001a0(0x10e)](_0x29999f)[_0x4001a0(0x101)](async([_0x531839,_0x581eb8])=>{const _0x7403ad=_0x4001a0;try{await database_1[_0x7403ad(0xee)][_0x7403ad(0xde)][_0x7403ad(0x11d)]({'where':{'currency':_0x531839[_0x7403ad(0xf9)]()},'update':{'rate':_0x581eb8},'create':{'currency':_0x531839['toLowerCase'](),'rate':_0x581eb8}});}catch(_0x40c5c0){console['error'](_0x7403ad(0x11e)+_0x531839+':',_0x40c5c0);}});await Promise[_0x4001a0(0x138)](_0x515fd0),console[_0x4001a0(0x109)](_0x4001a0(0xfe));}catch(_0x694de8){console[_0x4001a0(0xf2)](_0x4001a0(0xda),_0x694de8);throw _0x694de8;}}async[a38_0x59baca(0x114)](_0x24ea7d){const _0x215f19=a38_0x59baca,_0x37616c=_0x24ea7d[_0x215f19(0xf9)]();if(_0x37616c===_0x215f19(0xd4))return 0x1;try{const _0x417b2e=await database_1[_0x215f19(0xee)][_0x215f19(0xde)][_0x215f19(0x125)]({'where':{'currency':_0x37616c}});if(!_0x417b2e)return console['warn'](_0x215f19(0xd9)+_0x24ea7d+_0x215f19(0x104)),0x1;return _0x417b2e[_0x215f19(0x110)];}catch(_0x211eb5){return console[_0x215f19(0xf2)](_0x215f19(0x116)+_0x24ea7d+':',_0x211eb5),0x1;}}async[a38_0x59baca(0x137)](_0x2a221f,_0x297b3a){const _0x4b0883=a38_0x59baca,_0x38b896=_0x297b3a['toLowerCase']();if(_0x38b896===_0x4b0883(0xd4)){const _0x498398=_0x2a221f*(0x1+this[_0x4b0883(0xe0)]/0x64);return console[_0x4b0883(0x109)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x2a221f+'\x20USDT\x20=\x20'+_0x498398[_0x4b0883(0xe3)](0x6)+'\x20USDT'),_0x498398;}try{const _0xa35379=await this[_0x4b0883(0x114)](_0x38b896),_0xdb35a2=_0x2a221f/_0xa35379,_0x1c479d=_0xdb35a2*(0x1+this[_0x4b0883(0xe0)]/0x64);return console['log']('💱\x20Converted\x20'+_0x2a221f+'\x20'+_0x297b3a[_0x4b0883(0x130)]()+_0x4b0883(0x100)+_0xdb35a2[_0x4b0883(0xe3)](0x6)+_0x4b0883(0x122)+this[_0x4b0883(0xe0)]+'%\x20markup\x20=\x20'+_0x1c479d[_0x4b0883(0xe3)](0x6)+'\x20USDT\x20(rate:\x20'+_0xa35379+')'),_0x1c479d;}catch(_0x4732ea){console[_0x4b0883(0xf2)]('Error\x20converting\x20'+_0x2a221f+'\x20'+_0x297b3a+'\x20to\x20USDT:',_0x4732ea);const _0x54a9ed=_0x2a221f*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x54a9ed;}}async['convertMultipleToUSDT'](_0x1675e8){const _0x1ebd43=a38_0x59baca;let _0x48b487=0x0;for(const {amount:_0x3f1614,currency:_0x5828fd}of _0x1675e8){const _0x1e5462=await this[_0x1ebd43(0x137)](_0x3f1614,_0x5828fd);_0x48b487+=_0x1e5462;}return _0x48b487;}async[a38_0x59baca(0x132)](){const _0x3d2335=a38_0x59baca;try{const _0x5737e6=await database_1[_0x3d2335(0xee)][_0x3d2335(0xde)][_0x3d2335(0xe5)]({'select':{'currency':!![],'rate':!![]}}),_0x42e31f={'usdt':0x1};return _0x5737e6[_0x3d2335(0xef)](_0x5773f9=>{const _0x17bbc4=_0x3d2335;_0x42e31f[_0x5773f9[_0x17bbc4(0x133)]]=_0x5773f9[_0x17bbc4(0x110)];}),_0x42e31f;}catch(_0x302c15){return console['error']('Error\x20getting\x20all\x20rates:',_0x302c15),{'usdt':0x1};}}async[a38_0x59baca(0xed)](){const _0x31e971=a38_0x59baca;try{const [_0x2c8164,_0x46a0d8,_0x3c0dc4]=await Promise[_0x31e971(0x117)]([database_1[_0x31e971(0xee)]['currencyRate']['count'](),database_1['default']['currencyRate'][_0x31e971(0x11c)]({'orderBy':{'updatedAt':_0x31e971(0xdf)},'select':{'updatedAt':!![]}}),database_1['default'][_0x31e971(0xde)][_0x31e971(0x11c)]({'orderBy':{'updatedAt':_0x31e971(0x12c)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2c8164,'lastUpdated':_0x46a0d8?.[_0x31e971(0x11a)]||null,'oldestRate':_0x3c0dc4?.[_0x31e971(0x11a)]||null,'markupPercentage':this[_0x31e971(0xe0)]};}catch(_0x110fd3){return console['error']('Error\x20getting\x20rates\x20status:',_0x110fd3),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x31e971(0xe0)]};}}[a38_0x59baca(0x13a)](){const _0x1c82d9=a38_0x59baca;return this[_0x1c82d9(0xe0)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();