'use strict';const a36_0x152f6a=a36_0x2b11;(function(_0x4dc06f,_0x529129){const _0x26790b=a36_0x2b11,_0x1d8987=_0x4dc06f();while(!![]){try{const _0xc54e86=-parseInt(_0x26790b(0x189))/0x1+parseInt(_0x26790b(0x178))/0x2+parseInt(_0x26790b(0x1bc))/0x3+parseInt(_0x26790b(0x17b))/0x4*(parseInt(_0x26790b(0x17d))/0x5)+-parseInt(_0x26790b(0x1a6))/0x6+parseInt(_0x26790b(0x169))/0x7+parseInt(_0x26790b(0x177))/0x8;if(_0xc54e86===_0x529129)break;else _0x1d8987['push'](_0x1d8987['shift']());}catch(_0x3fb09c){_0x1d8987['push'](_0x1d8987['shift']());}}}(a36_0x4a94,0xa2493));function a36_0x4a94(){const _0x3e32a6=['link','vef','Initial\x20currency\x20rates\x20update\x20failed:','ðŸ’±\x20Applied\x20','eos','xdr','\x20currencies','ltc','toFixed','tether','TesSoft\x20Payment\x20System/1.0','ðŸ“Š\x20Received\x20rates\x20for\x20','yfi','json','currencyService','1112427xciykF','CurrencyService','Error\x20getting\x20rate\x20for\x20currency\x20','CURRENCIES','all','Error\x20getting\x20rates\x20status:','Error\x20converting\x20','CoinGecko\x20API\x20error:\x20','default','\x20USDT,\x20with\x20','usdt','updateCurrencyRates','MARKUP_PERCENTAGE','getCurrencyRate','nzd','pkr','__esModule','rate','toLowerCase','gbp','sats','idr','findMany','xrp','Periodic\x20currency\x20rates\x20update\x20failed:','pln','log','sar','__importDefault','âœ…\x20Currency\x20rates\x20updated\x20successfully','ars','map','bch','mmk','getMarkupPercentage','entries','%\x20markup\x20=\x20','length','usd','czk','mxn','updatedAt','477344MLpUMb','startPeriodicUpdates','try','../config/database','inr','clp','bits','uah','currencyRate','nok','stopPeriodicUpdates','keys','application/json','convertToUSDT','8473696gOKOzf','2013384rIRhsw','myr','btc','14312usLbjQ','ðŸ’±\x20Converted\x20','270BSngnU','bhd','ils','No\x20rate\x20found\x20for\x20currency:\x20','dkk','bdt','getAllRates','forEach','gel','https://api.coingecko.com/api/v3/simple/price','krw','Error\x20getting\x20all\x20rates:','808569sIVESC','xlm','vnd',',\x20using\x201\x20as\x20fallback','warn','allSettled','zar','error','COINGECKO_URL','upsert','Failed\x20to\x20update\x20rate\x20for\x20','bnb','huf','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','%\x20markup\x20to\x20','\x20to\x20','aud','jpy','join','twd','lkr','eth','findFirst','asc','dot','count','updateInterval','eur','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','7348950PrJmuU','thb','convertMultipleToUSDT','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','sgd','xag','brl'];a36_0x4a94=function(){return _0x3e32a6;};return a36_0x4a94();}var __importDefault=this&&this[a36_0x152f6a(0x1d8)]||function(_0x4baaed){return _0x4baaed&&_0x4baaed['__esModule']?_0x4baaed:{'default':_0x4baaed};};Object['defineProperty'](exports,a36_0x152f6a(0x1cc),{'value':!![]}),exports[a36_0x152f6a(0x1bb)]=exports[a36_0x152f6a(0x1bd)]=void 0x0;function a36_0x2b11(_0x31fa27,_0x2e452d){const _0x4a94f7=a36_0x4a94();return a36_0x2b11=function(_0x2b11a0,_0x2b621e){_0x2b11a0=_0x2b11a0-0x165;let _0x4e8bdd=_0x4a94f7[_0x2b11a0];return _0x4e8bdd;},a36_0x2b11(_0x31fa27,_0x2e452d);}const database_1=__importDefault(require(a36_0x152f6a(0x16c)));class CurrencyService{constructor(){const _0x3ee179=a36_0x152f6a;this[_0x3ee179(0x191)]=_0x3ee179(0x186),this[_0x3ee179(0x1bf)]=[_0x3ee179(0x17a),_0x3ee179(0x19e),_0x3ee179(0x1b4),_0x3ee179(0x1dc),_0x3ee179(0x194),_0x3ee179(0x1b1),_0x3ee179(0x1d3),_0x3ee179(0x18a),_0x3ee179(0x1ad),_0x3ee179(0x1a1),_0x3ee179(0x1b9),_0x3ee179(0x165),'aed',_0x3ee179(0x1da),_0x3ee179(0x199),_0x3ee179(0x182),_0x3ee179(0x17e),'bmd',_0x3ee179(0x1ac),'cad','chf',_0x3ee179(0x16e),'cny',_0x3ee179(0x166),_0x3ee179(0x181),_0x3ee179(0x1a4),_0x3ee179(0x1cf),_0x3ee179(0x185),'hkd',_0x3ee179(0x195),_0x3ee179(0x1d1),_0x3ee179(0x17f),_0x3ee179(0x16d),_0x3ee179(0x19a),_0x3ee179(0x187),'kwd',_0x3ee179(0x19d),_0x3ee179(0x1dd),_0x3ee179(0x167),_0x3ee179(0x179),'ngn',_0x3ee179(0x172),_0x3ee179(0x1ca),'php',_0x3ee179(0x1cb),_0x3ee179(0x1d5),'rub',_0x3ee179(0x1d7),'sek',_0x3ee179(0x1aa),_0x3ee179(0x1a7),_0x3ee179(0x16b),_0x3ee179(0x19c),_0x3ee179(0x170),_0x3ee179(0x1ae),_0x3ee179(0x18b),_0x3ee179(0x18f),_0x3ee179(0x1b2),_0x3ee179(0x1ab),'xau',_0x3ee179(0x16f),_0x3ee179(0x1d0)],this[_0x3ee179(0x1a3)]=null,this[_0x3ee179(0x1c8)]=0x3,this[_0x3ee179(0x16a)]();}[a36_0x152f6a(0x16a)](){const _0x3ee98c=a36_0x152f6a;this[_0x3ee98c(0x1c7)]()['catch'](_0x275a50=>{const _0x1ee60e=_0x3ee98c;console['error'](_0x1ee60e(0x1af),_0x275a50);}),this[_0x3ee98c(0x1a3)]=setInterval(async()=>{const _0x29b6d4=_0x3ee98c;try{await this[_0x29b6d4(0x1c7)]();}catch(_0x24d3ff){console[_0x29b6d4(0x190)](_0x29b6d4(0x1d4),_0x24d3ff);}},0x3c*0x3c*0x3e8),console['log']('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a36_0x152f6a(0x173)](){const _0x52ff85=a36_0x152f6a;this['updateInterval']&&(clearInterval(this[_0x52ff85(0x1a3)]),this['updateInterval']=null,console[_0x52ff85(0x1d6)](_0x52ff85(0x1a9)));}async[a36_0x152f6a(0x1c7)](){const _0x495e85=a36_0x152f6a;try{console['log']('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x23c0c1=this[_0x495e85(0x1bf)][_0x495e85(0x19b)](','),_0x4a15a9=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x23c0c1,_0x57d94e=await fetch(_0x4a15a9,{'headers':{'Accept':_0x495e85(0x175),'User-Agent':_0x495e85(0x1b7)}});if(!_0x57d94e['ok'])throw new Error(_0x495e85(0x1c3)+_0x57d94e['status']+'\x20'+_0x57d94e['statusText']);const _0x3a6e2f=await _0x57d94e[_0x495e85(0x1ba)]();if(!_0x3a6e2f[_0x495e85(0x1b6)])throw new Error(_0x495e85(0x196));const _0x11dbff=_0x3a6e2f[_0x495e85(0x1b6)];console[_0x495e85(0x1d6)](_0x495e85(0x1b8)+Object[_0x495e85(0x174)](_0x11dbff)[_0x495e85(0x1e1)]+_0x495e85(0x1b3));const _0x1a626a=Object[_0x495e85(0x1df)](_0x11dbff)[_0x495e85(0x1db)](async([_0xfa65e7,_0x4eebe5])=>{const _0x4c42f3=_0x495e85;try{await database_1[_0x4c42f3(0x1c4)][_0x4c42f3(0x171)][_0x4c42f3(0x192)]({'where':{'currency':_0xfa65e7[_0x4c42f3(0x1ce)]()},'update':{'rate':_0x4eebe5},'create':{'currency':_0xfa65e7[_0x4c42f3(0x1ce)](),'rate':_0x4eebe5}});}catch(_0x120ede){console[_0x4c42f3(0x190)](_0x4c42f3(0x193)+_0xfa65e7+':',_0x120ede);}});await Promise[_0x495e85(0x18e)](_0x1a626a),console[_0x495e85(0x1d6)](_0x495e85(0x1d9));}catch(_0x52f9fc){console[_0x495e85(0x190)](_0x495e85(0x1a5),_0x52f9fc);throw _0x52f9fc;}}async[a36_0x152f6a(0x1c9)](_0x80cae4){const _0x59368f=a36_0x152f6a,_0x130fdc=_0x80cae4[_0x59368f(0x1ce)]();if(_0x130fdc==='usdt')return 0x1;try{const _0x3c4630=await database_1[_0x59368f(0x1c4)][_0x59368f(0x171)]['findUnique']({'where':{'currency':_0x130fdc}});if(!_0x3c4630)return console[_0x59368f(0x18d)](_0x59368f(0x180)+_0x80cae4+_0x59368f(0x18c)),0x1;return _0x3c4630[_0x59368f(0x1cd)];}catch(_0x40b850){return console[_0x59368f(0x190)](_0x59368f(0x1be)+_0x80cae4+':',_0x40b850),0x1;}}async[a36_0x152f6a(0x176)](_0x1e3895,_0x2ccc31){const _0x19db1a=a36_0x152f6a,_0x4d868f=_0x2ccc31[_0x19db1a(0x1ce)]();if(_0x4d868f===_0x19db1a(0x1c6)){const _0x59451a=_0x1e3895*(0x1+this[_0x19db1a(0x1c8)]/0x64);return console['log'](_0x19db1a(0x1b0)+this[_0x19db1a(0x1c8)]+_0x19db1a(0x197)+_0x1e3895+'\x20USDT\x20=\x20'+_0x59451a['toFixed'](0x6)+'\x20USDT'),_0x59451a;}try{const _0x26410c=await this[_0x19db1a(0x1c9)](_0x4d868f),_0x1ea825=_0x1e3895/_0x26410c,_0x24c928=_0x1ea825*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x19db1a(0x17c)+_0x1e3895+'\x20'+_0x2ccc31['toUpperCase']()+_0x19db1a(0x198)+_0x1ea825[_0x19db1a(0x1b5)](0x6)+_0x19db1a(0x1c5)+this[_0x19db1a(0x1c8)]+_0x19db1a(0x1e0)+_0x24c928[_0x19db1a(0x1b5)](0x6)+'\x20USDT\x20(rate:\x20'+_0x26410c+')'),_0x24c928;}catch(_0x5d5698){console['error'](_0x19db1a(0x1c2)+_0x1e3895+'\x20'+_0x2ccc31+'\x20to\x20USDT:',_0x5d5698);const _0x2bf30b=_0x1e3895*(0x1+this[_0x19db1a(0x1c8)]/0x64);return _0x2bf30b;}}async[a36_0x152f6a(0x1a8)](_0x15b0dd){const _0xc6a1fd=a36_0x152f6a;let _0x35a909=0x0;for(const {amount:_0x515ceb,currency:_0x544d39}of _0x15b0dd){const _0x361036=await this[_0xc6a1fd(0x176)](_0x515ceb,_0x544d39);_0x35a909+=_0x361036;}return _0x35a909;}async[a36_0x152f6a(0x183)](){const _0x9eae18=a36_0x152f6a;try{const _0xe046cf=await database_1['default']['currencyRate'][_0x9eae18(0x1d2)]({'select':{'currency':!![],'rate':!![]}}),_0x265bce={'usdt':0x1};return _0xe046cf[_0x9eae18(0x184)](_0x1cc7a3=>{const _0x14173e=_0x9eae18;_0x265bce[_0x1cc7a3['currency']]=_0x1cc7a3[_0x14173e(0x1cd)];}),_0x265bce;}catch(_0xc1976b){return console[_0x9eae18(0x190)](_0x9eae18(0x188),_0xc1976b),{'usdt':0x1};}}async['getRatesStatus'](){const _0xf6ebe8=a36_0x152f6a;try{const [_0x5c71d5,_0x4cb31f,_0x6b513f]=await Promise[_0xf6ebe8(0x1c0)]([database_1[_0xf6ebe8(0x1c4)][_0xf6ebe8(0x171)][_0xf6ebe8(0x1a2)](),database_1[_0xf6ebe8(0x1c4)]['currencyRate'][_0xf6ebe8(0x19f)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0xf6ebe8(0x1c4)][_0xf6ebe8(0x171)][_0xf6ebe8(0x19f)]({'orderBy':{'updatedAt':_0xf6ebe8(0x1a0)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5c71d5,'lastUpdated':_0x4cb31f?.[_0xf6ebe8(0x168)]||null,'oldestRate':_0x6b513f?.['updatedAt']||null,'markupPercentage':this[_0xf6ebe8(0x1c8)]};}catch(_0x276fc7){return console[_0xf6ebe8(0x190)](_0xf6ebe8(0x1c1),_0x276fc7),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xf6ebe8(0x1c8)]};}}[a36_0x152f6a(0x1de)](){const _0x205cee=a36_0x152f6a;return this[_0x205cee(0x1c8)];}}exports['CurrencyService']=CurrencyService,exports[a36_0x152f6a(0x1bb)]=new CurrencyService();