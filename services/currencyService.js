'use strict';const a38_0x3e0188=a38_0x31e7;(function(_0x1eb271,_0x4a982){const _0x296009=a38_0x31e7,_0xcf3727=_0x1eb271();while(!![]){try{const _0x1d65bd=parseInt(_0x296009(0x154))/0x1*(-parseInt(_0x296009(0x100))/0x2)+parseInt(_0x296009(0x113))/0x3+parseInt(_0x296009(0x144))/0x4+-parseInt(_0x296009(0xf8))/0x5+parseInt(_0x296009(0x139))/0x6*(-parseInt(_0x296009(0x135))/0x7)+-parseInt(_0x296009(0x115))/0x8*(-parseInt(_0x296009(0x11d))/0x9)+-parseInt(_0x296009(0x109))/0xa*(-parseInt(_0x296009(0x130))/0xb);if(_0x1d65bd===_0x4a982)break;else _0xcf3727['push'](_0xcf3727['shift']());}catch(_0x3da683){_0xcf3727['push'](_0xcf3727['shift']());}}}(a38_0x6af3,0x59819));var __importDefault=this&&this[a38_0x3e0188(0x129)]||function(_0x1ac3d8){const _0xf0748=a38_0x3e0188;return _0x1ac3d8&&_0x1ac3d8[_0xf0748(0x11b)]?_0x1ac3d8:{'default':_0x1ac3d8};};Object['defineProperty'](exports,a38_0x3e0188(0x11b),{'value':!![]}),exports[a38_0x3e0188(0x16a)]=exports[a38_0x3e0188(0x16d)]=void 0x0;const database_1=__importDefault(require(a38_0x3e0188(0x101)));class CurrencyService{constructor(){const _0x4d3134=a38_0x3e0188;this[_0x4d3134(0xf0)]=_0x4d3134(0x121),this[_0x4d3134(0x126)]=[_0x4d3134(0x128),'eth',_0x4d3134(0x12a),_0x4d3134(0x159),_0x4d3134(0x132),_0x4d3134(0x13d),_0x4d3134(0x158),_0x4d3134(0x102),_0x4d3134(0x14a),_0x4d3134(0x143),_0x4d3134(0x140),'usd',_0x4d3134(0x12d),_0x4d3134(0x131),_0x4d3134(0x134),_0x4d3134(0x10e),_0x4d3134(0x156),_0x4d3134(0x13b),_0x4d3134(0x12f),'cad',_0x4d3134(0x15e),_0x4d3134(0xf9),_0x4d3134(0xf6),_0x4d3134(0x120),'dkk',_0x4d3134(0xf5),_0x4d3134(0x14e),_0x4d3134(0x149),_0x4d3134(0xfd),'huf','idr',_0x4d3134(0x169),_0x4d3134(0x13e),_0x4d3134(0x160),'krw',_0x4d3134(0x10f),_0x4d3134(0x104),_0x4d3134(0x163),_0x4d3134(0x12e),_0x4d3134(0x141),_0x4d3134(0x118),'nok',_0x4d3134(0x14d),'php',_0x4d3134(0x166),_0x4d3134(0x122),_0x4d3134(0x14f),_0x4d3134(0x138),_0x4d3134(0x15f),_0x4d3134(0x147),_0x4d3134(0x14b),_0x4d3134(0xfc),_0x4d3134(0x16b),_0x4d3134(0x127),_0x4d3134(0xfe),_0x4d3134(0x114),_0x4d3134(0xf1),_0x4d3134(0x161),_0x4d3134(0x112),'xau',_0x4d3134(0x13f),_0x4d3134(0xfa)],this[_0x4d3134(0x119)]=null,this['MARKUP_PERCENTAGE']=0x3,this['startPeriodicUpdates']();}[a38_0x3e0188(0x116)](){const _0x4985ae=a38_0x3e0188;this[_0x4985ae(0x168)]()['catch'](_0x3bd9f0=>{const _0x52e854=_0x4985ae;console[_0x52e854(0x16c)](_0x52e854(0x11e),_0x3bd9f0);}),this[_0x4985ae(0x119)]=setInterval(async()=>{const _0x55d12e=_0x4985ae;try{await this[_0x55d12e(0x168)]();}catch(_0x6107b6){console[_0x55d12e(0x16c)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x6107b6);}},0x3c*0x3c*0x3e8),console[_0x4985ae(0x150)](_0x4985ae(0xfb));}[a38_0x3e0188(0x146)](){const _0x1f75bf=a38_0x3e0188;this[_0x1f75bf(0x119)]&&(clearInterval(this[_0x1f75bf(0x119)]),this[_0x1f75bf(0x119)]=null,console[_0x1f75bf(0x150)](_0x1f75bf(0x148)));}async[a38_0x3e0188(0x168)](){const _0x50a681=a38_0x3e0188;try{console[_0x50a681(0x150)](_0x50a681(0x13a));const _0x40e855=this['CURRENCIES'][_0x50a681(0x110)](','),_0x3b7919=this['COINGECKO_URL']+_0x50a681(0x14c)+_0x40e855,_0x504715=await fetch(_0x3b7919,{'headers':{'Accept':_0x50a681(0x11c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x504715['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x504715[_0x50a681(0x108)]+'\x20'+_0x504715['statusText']);const _0x2295ec=await _0x504715['json']();if(!_0x2295ec[_0x50a681(0x145)])throw new Error(_0x50a681(0x123));const _0x1b32f1=_0x2295ec[_0x50a681(0x145)];console[_0x50a681(0x150)](_0x50a681(0x167)+Object['keys'](_0x1b32f1)['length']+'\x20currencies');const _0x37f98b=Object[_0x50a681(0xf3)](_0x1b32f1)[_0x50a681(0x111)](async([_0x5cbcb9,_0x1b56e6])=>{const _0x4ddec5=_0x50a681;try{await database_1[_0x4ddec5(0x157)][_0x4ddec5(0x165)][_0x4ddec5(0xf2)]({'where':{'currency':_0x5cbcb9[_0x4ddec5(0x151)]()},'update':{'rate':_0x1b56e6},'create':{'currency':_0x5cbcb9['toLowerCase'](),'rate':_0x1b56e6}});}catch(_0x3a0fca){console[_0x4ddec5(0x16c)](_0x4ddec5(0x152)+_0x5cbcb9+':',_0x3a0fca);}});await Promise[_0x50a681(0x164)](_0x37f98b),console[_0x50a681(0x150)](_0x50a681(0x117));}catch(_0x3530bb){console[_0x50a681(0x16c)](_0x50a681(0x12c),_0x3530bb);throw _0x3530bb;}}async['getCurrencyRate'](_0x5af7ab){const _0x2b095f=a38_0x3e0188,_0x495dbb=_0x5af7ab['toLowerCase']();if(_0x495dbb===_0x2b095f(0x10c))return 0x1;try{const _0x7e53b2=await database_1[_0x2b095f(0x157)][_0x2b095f(0x165)][_0x2b095f(0x15d)]({'where':{'currency':_0x495dbb}});if(!_0x7e53b2)return console[_0x2b095f(0xef)](_0x2b095f(0xff)+_0x5af7ab+_0x2b095f(0x103)),0x1;return _0x7e53b2[_0x2b095f(0x124)];}catch(_0x8061dd){return console[_0x2b095f(0x16c)](_0x2b095f(0x13c)+_0x5af7ab+':',_0x8061dd),0x1;}}async[a38_0x3e0188(0x15c)](_0x3fc66d,_0x59906c){const _0x4e8342=a38_0x3e0188,_0x286d65=_0x59906c['toLowerCase']();if(_0x286d65===_0x4e8342(0x10c)){const _0x363ad7=_0x3fc66d*(0x1+this[_0x4e8342(0x107)]/0x64);return console[_0x4e8342(0x150)](_0x4e8342(0x10b)+this[_0x4e8342(0x107)]+_0x4e8342(0x10a)+_0x3fc66d+_0x4e8342(0x105)+_0x363ad7[_0x4e8342(0x155)](0x6)+'\x20USDT'),_0x363ad7;}try{const _0x2eee70=await this[_0x4e8342(0x137)](_0x286d65),_0x3097d4=_0x3fc66d/_0x2eee70,_0x5738b3=_0x3097d4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4e8342(0x150)](_0x4e8342(0xf7)+_0x3fc66d+'\x20'+_0x59906c['toUpperCase']()+_0x4e8342(0x162)+_0x3097d4[_0x4e8342(0x155)](0x6)+_0x4e8342(0x133)+this[_0x4e8342(0x107)]+'%\x20markup\x20=\x20'+_0x5738b3[_0x4e8342(0x155)](0x6)+'\x20USDT\x20(rate:\x20'+_0x2eee70+')'),_0x5738b3;}catch(_0x2ad287){console[_0x4e8342(0x16c)]('Error\x20converting\x20'+_0x3fc66d+'\x20'+_0x59906c+_0x4e8342(0x12b),_0x2ad287);const _0xe9dfb1=_0x3fc66d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0xe9dfb1;}}async['convertMultipleToUSDT'](_0x4892a8){let _0x352582=0x0;for(const {amount:_0x4ac226,currency:_0x7b8c}of _0x4892a8){const _0x304f35=await this['convertToUSDT'](_0x4ac226,_0x7b8c);_0x352582+=_0x304f35;}return _0x352582;}async['getAllRates'](){const _0x501647=a38_0x3e0188;try{const _0x4b0b51=await database_1[_0x501647(0x157)][_0x501647(0x165)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x4065cb={'usdt':0x1};return _0x4b0b51[_0x501647(0x136)](_0xa9680b=>{const _0x2a689a=_0x501647;_0x4065cb[_0xa9680b['currency']]=_0xa9680b[_0x2a689a(0x124)];}),_0x4065cb;}catch(_0x4fc301){return console['error'](_0x501647(0x15b),_0x4fc301),{'usdt':0x1};}}async[a38_0x3e0188(0x142)](){const _0x49fda8=a38_0x3e0188;try{const [_0x547d45,_0x564a4d,_0x880bfa]=await Promise[_0x49fda8(0x15a)]([database_1[_0x49fda8(0x157)][_0x49fda8(0x165)][_0x49fda8(0x153)](),database_1[_0x49fda8(0x157)]['currencyRate'][_0x49fda8(0x11f)]({'orderBy':{'updatedAt':_0x49fda8(0x106)},'select':{'updatedAt':!![]}}),database_1['default'][_0x49fda8(0x165)][_0x49fda8(0x11f)]({'orderBy':{'updatedAt':_0x49fda8(0x11a)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x547d45,'lastUpdated':_0x564a4d?.['updatedAt']||null,'oldestRate':_0x880bfa?.[_0x49fda8(0x125)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x38c71d){return console[_0x49fda8(0x16c)](_0x49fda8(0x10d),_0x38c71d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x49fda8(0x107)]};}}[a38_0x3e0188(0xf4)](){const _0xe0012c=a38_0x3e0188;return this[_0xe0012c(0x107)];}}exports[a38_0x3e0188(0x16d)]=CurrencyService,exports['currencyService']=new CurrencyService();function a38_0x31e7(_0x392fb3,_0x24a259){const _0x6af33e=a38_0x6af3();return a38_0x31e7=function(_0x31e747,_0x557e0e){_0x31e747=_0x31e747-0xef;let _0x167278=_0x6af33e[_0x31e747];return _0x167278;},a38_0x31e7(_0x392fb3,_0x24a259);}function a38_0x6af3(){const _0x1cbd59=['\x20USDT\x20=\x20','desc','MARKUP_PERCENTAGE','status','6469130ySNsuD','%\x20markup\x20to\x20','üí±\x20Applied\x20','usdt','Error\x20getting\x20rates\x20status:','bdt','kwd','join','map','xag','855762Nyytqb','vnd','368HHkjsE','startPeriodicUpdates','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','ngn','updateInterval','asc','__esModule','application/json','22032YzYSuY','Initial\x20currency\x20rates\x20update\x20failed:','findFirst','czk','https://api.coingecko.com/api/v3/simple/price','pln','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','rate','updatedAt','CURRENCIES','uah','btc','__importDefault','ltc','\x20to\x20USDT:','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','aed','mxn','brl','11jCEfRY','ars','bnb','\x20USDT,\x20with\x20','aud','77tHiUeN','forEach','getCurrencyRate','sar','381492MDJMiN','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bmd','Error\x20getting\x20rate\x20for\x20currency\x20','eos','inr','bits','yfi','myr','getRatesStatus','dot','1262000qRgpee','tether','stopPeriodicUpdates','sgd','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','gel','link','thb','?ids=tether&vs_currencies=','nzd','gbp','rub','log','toLowerCase','Failed\x20to\x20update\x20rate\x20for\x20','count','43518uAJnJm','toFixed','bhd','default','xrp','bch','all','Error\x20getting\x20all\x20rates:','convertToUSDT','findUnique','chf','sek','jpy','xdr','\x20to\x20','mmk','allSettled','currencyRate','pkr','üìä\x20Received\x20rates\x20for\x20','updateCurrencyRates','ils','currencyService','twd','error','CurrencyService','warn','COINGECKO_URL','zar','upsert','entries','getMarkupPercentage','eur','cny','üí±\x20Converted\x20','600920PVVkch','clp','sats','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','try','hkd','vef','No\x20rate\x20found\x20for\x20currency:\x20','8LCcgUS','../config/database','xlm',',\x20using\x201\x20as\x20fallback','lkr'];a38_0x6af3=function(){return _0x1cbd59;};return a38_0x6af3();}