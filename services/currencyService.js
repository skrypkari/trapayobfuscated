'use strict';const a36_0x2d4d40=a36_0x3f9e;(function(_0x16114b,_0x10834f){const _0x1f851b=a36_0x3f9e,_0x9c515a=_0x16114b();while(!![]){try{const _0x5ac225=-parseInt(_0x1f851b(0xf0))/0x1+parseInt(_0x1f851b(0xdb))/0x2+parseInt(_0x1f851b(0x101))/0x3+parseInt(_0x1f851b(0xbf))/0x4*(-parseInt(_0x1f851b(0xfa))/0x5)+parseInt(_0x1f851b(0x96))/0x6*(parseInt(_0x1f851b(0x100))/0x7)+parseInt(_0x1f851b(0xb0))/0x8*(parseInt(_0x1f851b(0x104))/0x9)+parseInt(_0x1f851b(0x8f))/0xa;if(_0x5ac225===_0x10834f)break;else _0x9c515a['push'](_0x9c515a['shift']());}catch(_0x2037da){_0x9c515a['push'](_0x9c515a['shift']());}}}(a36_0x291f,0xc08d8));function a36_0x291f(){const _0x5a6e04=['findUnique','allSettled','vef','tether','CoinGecko\x20API\x20error:\x20','pkr','desc','aud','\x20currencies','twd','nok','Initial\x20currency\x20rates\x20update\x20failed:','%\x20markup\x20=\x20','bch','\x20USDT','thb','573286oUqaDp','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','sek','xau','defineProperty','getAllRates','getCurrencyRate','toFixed','ars','ltc',',\x20using\x201\x20as\x20fallback','COINGECKO_URL','clp','xrp','xag','brl','bnb','%\x20markup\x20to\x20','ðŸ“Š\x20Received\x20rates\x20for\x20','error','forEach','1135489owgBHN','default','Error\x20converting\x20','nzd','__esModule','currencyRate','usdt','currencyService','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','czk','337335qfxnzf','jpy','usd','\x20to\x20','updateInterval','pln','1778714BdYXBX','3190881QtAaIt','convertMultipleToUSDT','No\x20rate\x20found\x20for\x20currency:\x20','701451vtMWTQ','MARKUP_PERCENTAGE','xlm','php','try','cad','../config/database','convertToUSDT','5740310aCPtmb','map','gbp','length','startPeriodicUpdates','log','sgd','12xBzRFe','updateCurrencyRates','json','currency','xdr','findFirst','dot','Error\x20getting\x20rate\x20for\x20currency\x20','status','Periodic\x20currency\x20rates\x20update\x20failed:','yfi','ðŸ’±\x20Converted\x20','sar','bhd','statusText','huf','lkr','bdt','eth','eur','kwd','\x20USDT,\x20with\x20','getRatesStatus','âœ…\x20Currency\x20rates\x20updated\x20successfully','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','mmk','24NFrJvk','sats','updatedAt','?ids=tether&vs_currencies=','entries','CurrencyService','vnd','Error\x20getting\x20rates\x20status:','toLowerCase','all','findMany','krw','catch','Failed\x20to\x20update\x20rate\x20for\x20','keys','44yfjxfJ','warn','aed','uah','myr','\x20to\x20USDT:','gel','upsert','bits','cny','mxn','ils'];a36_0x291f=function(){return _0x5a6e04;};return a36_0x291f();}var __importDefault=this&&this['__importDefault']||function(_0x5a73e4){const _0x242918=a36_0x3f9e;return _0x5a73e4&&_0x5a73e4[_0x242918(0xf4)]?_0x5a73e4:{'default':_0x5a73e4};};Object[a36_0x2d4d40(0xdf)](exports,a36_0x2d4d40(0xf4),{'value':!![]}),exports[a36_0x2d4d40(0xf7)]=exports[a36_0x2d4d40(0xb5)]=void 0x0;function a36_0x3f9e(_0x1ed65e,_0x266708){const _0x291fc1=a36_0x291f();return a36_0x3f9e=function(_0x3f9ed4,_0x55b4e0){_0x3f9ed4=_0x3f9ed4-0x8f;let _0x37b995=_0x291fc1[_0x3f9ed4];return _0x37b995;},a36_0x3f9e(_0x1ed65e,_0x266708);}const database_1=__importDefault(require(a36_0x2d4d40(0x10a)));class CurrencyService{constructor(){const _0x168ddc=a36_0x2d4d40;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=['btc',_0x168ddc(0xa8),_0x168ddc(0xe4),_0x168ddc(0xd8),_0x168ddc(0xeb),'eos',_0x168ddc(0xe8),_0x168ddc(0x106),'link',_0x168ddc(0x9c),_0x168ddc(0xa0),_0x168ddc(0xfc),_0x168ddc(0xc1),_0x168ddc(0xe3),_0x168ddc(0xd2),_0x168ddc(0xa7),_0x168ddc(0xa3),'bmd',_0x168ddc(0xea),_0x168ddc(0x109),'chf',_0x168ddc(0xe7),_0x168ddc(0xc8),_0x168ddc(0xf9),'dkk',_0x168ddc(0xa9),_0x168ddc(0x91),_0x168ddc(0xc5),'hkd',_0x168ddc(0xa5),'idr',_0x168ddc(0xca),'inr',_0x168ddc(0xfb),_0x168ddc(0xbb),_0x168ddc(0xaa),_0x168ddc(0xa6),_0x168ddc(0xaf),_0x168ddc(0xc9),_0x168ddc(0xc3),'ngn',_0x168ddc(0xd5),_0x168ddc(0xf3),_0x168ddc(0x107),_0x168ddc(0xd0),_0x168ddc(0xff),'rub',_0x168ddc(0xa2),_0x168ddc(0xdd),_0x168ddc(0x95),_0x168ddc(0xda),_0x168ddc(0x108),_0x168ddc(0xd4),_0x168ddc(0xc2),_0x168ddc(0xcd),_0x168ddc(0xb6),'zar',_0x168ddc(0x9a),_0x168ddc(0xe9),_0x168ddc(0xde),_0x168ddc(0xc7),_0x168ddc(0xb1)],this[_0x168ddc(0xfe)]=null,this[_0x168ddc(0x105)]=0x3,this['startPeriodicUpdates']();}[a36_0x2d4d40(0x93)](){const _0x5f4506=a36_0x2d4d40;this[_0x5f4506(0x97)]()[_0x5f4506(0xbc)](_0x43bd04=>{const _0x5b681c=_0x5f4506;console[_0x5b681c(0xee)](_0x5b681c(0xd6),_0x43bd04);}),this[_0x5f4506(0xfe)]=setInterval(async()=>{const _0x4b12f7=_0x5f4506;try{await this['updateCurrencyRates']();}catch(_0x3aebfa){console[_0x4b12f7(0xee)](_0x4b12f7(0x9f),_0x3aebfa);}},0x3c*0x3c*0x3e8),console[_0x5f4506(0x94)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x236751=a36_0x2d4d40;this[_0x236751(0xfe)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x236751(0x94)](_0x236751(0xdc)));}async['updateCurrencyRates'](){const _0x1ae393=a36_0x2d4d40;try{console['log']('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x57971b=this['CURRENCIES']['join'](','),_0x16d0e1=this[_0x1ae393(0xe6)]+_0x1ae393(0xb3)+_0x57971b,_0x17fd4d=await fetch(_0x16d0e1,{'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x17fd4d['ok'])throw new Error(_0x1ae393(0xcf)+_0x17fd4d[_0x1ae393(0x9e)]+'\x20'+_0x17fd4d[_0x1ae393(0xa4)]);const _0x569f68=await _0x17fd4d[_0x1ae393(0x98)]();if(!_0x569f68[_0x1ae393(0xce)])throw new Error(_0x1ae393(0xae));const _0x2ccfae=_0x569f68[_0x1ae393(0xce)];console[_0x1ae393(0x94)](_0x1ae393(0xed)+Object[_0x1ae393(0xbe)](_0x2ccfae)[_0x1ae393(0x92)]+_0x1ae393(0xd3));const _0x551b05=Object[_0x1ae393(0xb4)](_0x2ccfae)[_0x1ae393(0x90)](async([_0x35d666,_0x514ddb])=>{const _0xa31112=_0x1ae393;try{await database_1[_0xa31112(0xf1)][_0xa31112(0xf5)][_0xa31112(0xc6)]({'where':{'currency':_0x35d666[_0xa31112(0xb8)]()},'update':{'rate':_0x514ddb},'create':{'currency':_0x35d666[_0xa31112(0xb8)](),'rate':_0x514ddb}});}catch(_0x308bf3){console[_0xa31112(0xee)](_0xa31112(0xbd)+_0x35d666+':',_0x308bf3);}});await Promise[_0x1ae393(0xcc)](_0x551b05),console[_0x1ae393(0x94)](_0x1ae393(0xad));}catch(_0x3a6c9a){console[_0x1ae393(0xee)](_0x1ae393(0xf8),_0x3a6c9a);throw _0x3a6c9a;}}async[a36_0x2d4d40(0xe1)](_0x3e4374){const _0x42cd7b=a36_0x2d4d40,_0x175d2d=_0x3e4374['toLowerCase']();if(_0x175d2d===_0x42cd7b(0xf6))return 0x1;try{const _0x4970c1=await database_1[_0x42cd7b(0xf1)][_0x42cd7b(0xf5)][_0x42cd7b(0xcb)]({'where':{'currency':_0x175d2d}});if(!_0x4970c1)return console[_0x42cd7b(0xc0)](_0x42cd7b(0x103)+_0x3e4374+_0x42cd7b(0xe5)),0x1;return _0x4970c1['rate'];}catch(_0xc0720){return console[_0x42cd7b(0xee)](_0x42cd7b(0x9d)+_0x3e4374+':',_0xc0720),0x1;}}async[a36_0x2d4d40(0x10b)](_0x15be4f,_0x1d8fcc){const _0x1c0912=a36_0x2d4d40,_0x3d8e83=_0x1d8fcc['toLowerCase']();if(_0x3d8e83===_0x1c0912(0xf6)){const _0x3aa682=_0x15be4f*(0x1+this[_0x1c0912(0x105)]/0x64);return console['log']('ðŸ’±\x20Applied\x20'+this[_0x1c0912(0x105)]+_0x1c0912(0xec)+_0x15be4f+'\x20USDT\x20=\x20'+_0x3aa682[_0x1c0912(0xe2)](0x6)+_0x1c0912(0xd9)),_0x3aa682;}try{const _0x239694=await this[_0x1c0912(0xe1)](_0x3d8e83),_0x2ea4b4=_0x15be4f/_0x239694,_0x36b16a=_0x2ea4b4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x1c0912(0x94)](_0x1c0912(0xa1)+_0x15be4f+'\x20'+_0x1d8fcc['toUpperCase']()+_0x1c0912(0xfd)+_0x2ea4b4['toFixed'](0x6)+_0x1c0912(0xab)+this[_0x1c0912(0x105)]+_0x1c0912(0xd7)+_0x36b16a[_0x1c0912(0xe2)](0x6)+'\x20USDT\x20(rate:\x20'+_0x239694+')'),_0x36b16a;}catch(_0x5333e7){console[_0x1c0912(0xee)](_0x1c0912(0xf2)+_0x15be4f+'\x20'+_0x1d8fcc+_0x1c0912(0xc4),_0x5333e7);const _0x5c75f9=_0x15be4f*(0x1+this[_0x1c0912(0x105)]/0x64);return _0x5c75f9;}}async[a36_0x2d4d40(0x102)](_0x232227){let _0x2f57da=0x0;for(const {amount:_0x4bea18,currency:_0x5a3bb5}of _0x232227){const _0x505fcd=await this['convertToUSDT'](_0x4bea18,_0x5a3bb5);_0x2f57da+=_0x505fcd;}return _0x2f57da;}async[a36_0x2d4d40(0xe0)](){const _0x56171e=a36_0x2d4d40;try{const _0x185b8a=await database_1['default'][_0x56171e(0xf5)][_0x56171e(0xba)]({'select':{'currency':!![],'rate':!![]}}),_0x52307c={'usdt':0x1};return _0x185b8a[_0x56171e(0xef)](_0x28caf4=>{const _0x54ca74=_0x56171e;_0x52307c[_0x28caf4[_0x54ca74(0x99)]]=_0x28caf4['rate'];}),_0x52307c;}catch(_0x26a6d9){return console['error']('Error\x20getting\x20all\x20rates:',_0x26a6d9),{'usdt':0x1};}}async[a36_0x2d4d40(0xac)](){const _0x4bb8aa=a36_0x2d4d40;try{const [_0x3417f2,_0x27aa0c,_0x2e7ee6]=await Promise[_0x4bb8aa(0xb9)]([database_1[_0x4bb8aa(0xf1)]['currencyRate']['count'](),database_1['default'][_0x4bb8aa(0xf5)]['findFirst']({'orderBy':{'updatedAt':_0x4bb8aa(0xd1)},'select':{'updatedAt':!![]}}),database_1['default'][_0x4bb8aa(0xf5)][_0x4bb8aa(0x9b)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3417f2,'lastUpdated':_0x27aa0c?.[_0x4bb8aa(0xb2)]||null,'oldestRate':_0x2e7ee6?.[_0x4bb8aa(0xb2)]||null,'markupPercentage':this[_0x4bb8aa(0x105)]};}catch(_0x354c0f){return console[_0x4bb8aa(0xee)](_0x4bb8aa(0xb7),_0x354c0f),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4bb8aa(0x105)]};}}['getMarkupPercentage'](){const _0x223052=a36_0x2d4d40;return this[_0x223052(0x105)];}}exports[a36_0x2d4d40(0xb5)]=CurrencyService,exports[a36_0x2d4d40(0xf7)]=new CurrencyService();