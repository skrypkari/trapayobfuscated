'use strict';const a36_0x357ea6=a36_0x269b;(function(_0x2e4846,_0x241aff){const _0x2d4053=a36_0x269b,_0x421a45=_0x2e4846();while(!![]){try{const _0x54c4e2=parseInt(_0x2d4053(0x8d))/0x1*(-parseInt(_0x2d4053(0xa7))/0x2)+parseInt(_0x2d4053(0x90))/0x3+parseInt(_0x2d4053(0x9c))/0x4*(-parseInt(_0x2d4053(0xe9))/0x5)+parseInt(_0x2d4053(0xba))/0x6*(parseInt(_0x2d4053(0x8c))/0x7)+parseInt(_0x2d4053(0xe7))/0x8*(parseInt(_0x2d4053(0xa6))/0x9)+-parseInt(_0x2d4053(0xf8))/0xa+parseInt(_0x2d4053(0xe6))/0xb;if(_0x54c4e2===_0x241aff)break;else _0x421a45['push'](_0x421a45['shift']());}catch(_0x157761){_0x421a45['push'](_0x421a45['shift']());}}}(a36_0x212c,0x7580b));var __importDefault=this&&this['__importDefault']||function(_0x19aca1){return _0x19aca1&&_0x19aca1['__esModule']?_0x19aca1:{'default':_0x19aca1};};function a36_0x212c(){const _0x1503e5=['\x20to\x20','cad','currencyService','defineProperty','chf','ltc','xlm','application/json','warn','\x20USDT','CURRENCIES','24vbKoOT','\x20USDT\x20(rate:\x20','nok','myr','xdr','thb','aud',',\x20using\x201\x20as\x20fallback','keys','âœ…\x20Currency\x20rates\x20updated\x20successfully','updateInterval','sgd','upsert','convertMultipleToUSDT','Error\x20getting\x20all\x20rates:','\x20USDT\x20=\x20','updatedAt','pln','lkr','usd','brl','forEach','uah','ngn','bnb','ðŸ“Š\x20Received\x20rates\x20for\x20','bdt','currencyRate','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','sats','twd','default','\x20currencies','https://api.coingecko.com/api/v3/simple/price','toUpperCase','ðŸ’±\x20Converted\x20','Error\x20getting\x20rates\x20status:','jpy','MARKUP_PERCENTAGE','rate','vef','sar','ðŸ’±\x20Applied\x20','%\x20markup\x20to\x20','10817400cDfbzO','88032fzsLjU','getCurrencyRate','520765BNmcyl','error','length','bmd','mxn','xau','vnd','desc','kwd','link','bhd','xrp','findUnique','toFixed','aed','6347570lOffYJ','No\x20rate\x20found\x20for\x20currency:\x20','inr','btc','stopPeriodicUpdates','tether','bits','startPeriodicUpdates','convertToUSDT','currency','all','czk','catch','hkd','log','getAllRates','bch','map','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','findFirst','1001609rwumte','1JtlYiv','entries','CurrencyService','2866527mTIrjK','pkr','?ids=tether&vs_currencies=','clp','findMany','statusText','toLowerCase','cny','huf','try','php','idr','28rivTql','join','\x20USDT,\x20with\x20','dkk','xag','%\x20markup\x20=\x20','mmk','Initial\x20currency\x20rates\x20update\x20failed:','updateCurrencyRates','usdt','99cDGtVG','1574364BuuYIa','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','\x20to\x20USDT:','asc','allSettled','CoinGecko\x20API\x20error:\x20','COINGECKO_URL','__esModule'];a36_0x212c=function(){return _0x1503e5;};return a36_0x212c();}function a36_0x269b(_0x4504f5,_0x2ad05c){const _0x212c70=a36_0x212c();return a36_0x269b=function(_0x269bc5,_0x513b46){_0x269bc5=_0x269bc5-0x8a;let _0x5eb0fa=_0x212c70[_0x269bc5];return _0x5eb0fa;},a36_0x269b(_0x4504f5,_0x2ad05c);}Object[a36_0x357ea6(0xb2)](exports,a36_0x357ea6(0xae),{'value':!![]}),exports['currencyService']=exports[a36_0x357ea6(0x8f)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0xe944da=a36_0x357ea6;this['COINGECKO_URL']=_0xe944da(0xdb),this[_0xe944da(0xb9)]=[_0xe944da(0xfb),'eth',_0xe944da(0xb4),_0xe944da(0x108),_0xe944da(0xd2),'eos',_0xe944da(0xf4),_0xe944da(0xb5),_0xe944da(0xf2),'dot','yfi',_0xe944da(0xcd),_0xe944da(0xf7),'ars',_0xe944da(0xc0),_0xe944da(0xd4),_0xe944da(0xf3),_0xe944da(0xec),_0xe944da(0xce),_0xe944da(0xb0),_0xe944da(0xb3),_0xe944da(0x93),_0xe944da(0x97),_0xe944da(0x103),_0xe944da(0x9f),'eur','gbp','gel',_0xe944da(0x105),_0xe944da(0x98),_0xe944da(0x9b),'ils',_0xe944da(0xfa),_0xe944da(0xdf),'krw',_0xe944da(0xf1),_0xe944da(0xcc),_0xe944da(0xa2),_0xe944da(0xed),_0xe944da(0xbd),_0xe944da(0xd1),_0xe944da(0xbc),'nzd',_0xe944da(0x9a),_0xe944da(0x91),_0xe944da(0xcb),'rub',_0xe944da(0xe3),'sek',_0xe944da(0xc5),_0xe944da(0xbf),_0xe944da(0x99),_0xe944da(0xd8),_0xe944da(0xd0),_0xe944da(0xe2),_0xe944da(0xef),'zar',_0xe944da(0xbe),_0xe944da(0xa0),_0xe944da(0xee),_0xe944da(0xfe),_0xe944da(0xd7)],this[_0xe944da(0xc4)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0xe944da(0xff)]();}[a36_0x357ea6(0xff)](){const _0x2c3b57=a36_0x357ea6;this['updateCurrencyRates']()[_0x2c3b57(0x104)](_0x323042=>{const _0x2526b1=_0x2c3b57;console[_0x2526b1(0xea)](_0x2526b1(0xa3),_0x323042);}),this[_0x2c3b57(0xc4)]=setInterval(async()=>{const _0x42d21f=_0x2c3b57;try{await this[_0x42d21f(0xa4)]();}catch(_0x6d48a6){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x6d48a6);}},0x3c*0x3c*0x3e8),console[_0x2c3b57(0x106)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a36_0x357ea6(0xfc)](){const _0x445262=a36_0x357ea6;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x445262(0xc4)]=null,console[_0x445262(0x106)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a36_0x357ea6(0xa4)](){const _0x1e6708=a36_0x357ea6;try{console[_0x1e6708(0x106)](_0x1e6708(0xa8));const _0x1e8a90=this['CURRENCIES'][_0x1e6708(0x9d)](','),_0x4c83ed=this[_0x1e6708(0xad)]+_0x1e6708(0x92)+_0x1e8a90,_0x31e3dc=await fetch(_0x4c83ed,{'headers':{'Accept':_0x1e6708(0xb6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x31e3dc['ok'])throw new Error(_0x1e6708(0xac)+_0x31e3dc['status']+'\x20'+_0x31e3dc[_0x1e6708(0x95)]);const _0x1f2a1a=await _0x31e3dc['json']();if(!_0x1f2a1a[_0x1e6708(0xfd)])throw new Error(_0x1e6708(0x8a));const _0x2b3c00=_0x1f2a1a['tether'];console[_0x1e6708(0x106)](_0x1e6708(0xd3)+Object[_0x1e6708(0xc2)](_0x2b3c00)[_0x1e6708(0xeb)]+_0x1e6708(0xda));const _0x107a24=Object[_0x1e6708(0x8e)](_0x2b3c00)[_0x1e6708(0x109)](async([_0x122159,_0x25e750])=>{const _0x17fd30=_0x1e6708;try{await database_1['default'][_0x17fd30(0xd5)][_0x17fd30(0xc6)]({'where':{'currency':_0x122159['toLowerCase']()},'update':{'rate':_0x25e750},'create':{'currency':_0x122159[_0x17fd30(0x96)](),'rate':_0x25e750}});}catch(_0x1d0012){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x122159+':',_0x1d0012);}});await Promise[_0x1e6708(0xab)](_0x107a24),console['log'](_0x1e6708(0xc3));}catch(_0x37b23e){console[_0x1e6708(0xea)](_0x1e6708(0xd6),_0x37b23e);throw _0x37b23e;}}async['getCurrencyRate'](_0x3e2041){const _0x5b16a9=a36_0x357ea6,_0x27f45b=_0x3e2041[_0x5b16a9(0x96)]();if(_0x27f45b===_0x5b16a9(0xa5))return 0x1;try{const _0x1cf54f=await database_1[_0x5b16a9(0xd9)]['currencyRate'][_0x5b16a9(0xf5)]({'where':{'currency':_0x27f45b}});if(!_0x1cf54f)return console[_0x5b16a9(0xb7)](_0x5b16a9(0xf9)+_0x3e2041+_0x5b16a9(0xc1)),0x1;return _0x1cf54f[_0x5b16a9(0xe1)];}catch(_0x3d3182){return console[_0x5b16a9(0xea)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x3e2041+':',_0x3d3182),0x1;}}async[a36_0x357ea6(0x100)](_0x5c41f9,_0x499888){const _0x21136e=a36_0x357ea6,_0xbe0445=_0x499888[_0x21136e(0x96)]();if(_0xbe0445===_0x21136e(0xa5)){const _0x2a8d07=_0x5c41f9*(0x1+this[_0x21136e(0xe0)]/0x64);return console[_0x21136e(0x106)](_0x21136e(0xe4)+this[_0x21136e(0xe0)]+_0x21136e(0xe5)+_0x5c41f9+_0x21136e(0xc9)+_0x2a8d07[_0x21136e(0xf6)](0x6)+_0x21136e(0xb8)),_0x2a8d07;}try{const _0x2ac97d=await this[_0x21136e(0xe8)](_0xbe0445),_0x4592a8=_0x5c41f9/_0x2ac97d,_0x4ae9cb=_0x4592a8*(0x1+this[_0x21136e(0xe0)]/0x64);return console[_0x21136e(0x106)](_0x21136e(0xdd)+_0x5c41f9+'\x20'+_0x499888[_0x21136e(0xdc)]()+_0x21136e(0xaf)+_0x4592a8[_0x21136e(0xf6)](0x6)+_0x21136e(0x9e)+this[_0x21136e(0xe0)]+_0x21136e(0xa1)+_0x4ae9cb[_0x21136e(0xf6)](0x6)+_0x21136e(0xbb)+_0x2ac97d+')'),_0x4ae9cb;}catch(_0x2c58c7){console['error']('Error\x20converting\x20'+_0x5c41f9+'\x20'+_0x499888+_0x21136e(0xa9),_0x2c58c7);const _0x2b64af=_0x5c41f9*(0x1+this[_0x21136e(0xe0)]/0x64);return _0x2b64af;}}async[a36_0x357ea6(0xc7)](_0x3155f5){const _0x248abd=a36_0x357ea6;let _0x255590=0x0;for(const {amount:_0x59d73a,currency:_0x128d1a}of _0x3155f5){const _0x12611e=await this[_0x248abd(0x100)](_0x59d73a,_0x128d1a);_0x255590+=_0x12611e;}return _0x255590;}async[a36_0x357ea6(0x107)](){const _0x418950=a36_0x357ea6;try{const _0x188b96=await database_1[_0x418950(0xd9)][_0x418950(0xd5)][_0x418950(0x94)]({'select':{'currency':!![],'rate':!![]}}),_0x3b42d4={'usdt':0x1};return _0x188b96[_0x418950(0xcf)](_0x237e4c=>{const _0x20a8b1=_0x418950;_0x3b42d4[_0x237e4c[_0x20a8b1(0x101)]]=_0x237e4c[_0x20a8b1(0xe1)];}),_0x3b42d4;}catch(_0x37255a){return console[_0x418950(0xea)](_0x418950(0xc8),_0x37255a),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4978de=a36_0x357ea6;try{const [_0x48dfb4,_0x2b0d51,_0x150d0d]=await Promise[_0x4978de(0x102)]([database_1[_0x4978de(0xd9)]['currencyRate']['count'](),database_1[_0x4978de(0xd9)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x4978de(0xf0)},'select':{'updatedAt':!![]}}),database_1[_0x4978de(0xd9)][_0x4978de(0xd5)][_0x4978de(0x8b)]({'orderBy':{'updatedAt':_0x4978de(0xaa)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x48dfb4,'lastUpdated':_0x2b0d51?.[_0x4978de(0xca)]||null,'oldestRate':_0x150d0d?.[_0x4978de(0xca)]||null,'markupPercentage':this[_0x4978de(0xe0)]};}catch(_0x5d6aa1){return console['error'](_0x4978de(0xde),_0x5d6aa1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports[a36_0x357ea6(0x8f)]=CurrencyService,exports[a36_0x357ea6(0xb1)]=new CurrencyService();