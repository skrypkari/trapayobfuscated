'use strict';const a36_0x5f4b3a=a36_0x4d06;(function(_0x1fb802,_0x4ad7e5){const _0x2c5e8d=a36_0x4d06,_0x4ab9ec=_0x1fb802();while(!![]){try{const _0x273d64=-parseInt(_0x2c5e8d(0x1fb))/0x1*(-parseInt(_0x2c5e8d(0x206))/0x2)+-parseInt(_0x2c5e8d(0x1ed))/0x3+-parseInt(_0x2c5e8d(0x232))/0x4*(parseInt(_0x2c5e8d(0x228))/0x5)+parseInt(_0x2c5e8d(0x1e3))/0x6+-parseInt(_0x2c5e8d(0x1ec))/0x7+parseInt(_0x2c5e8d(0x201))/0x8*(parseInt(_0x2c5e8d(0x248))/0x9)+parseInt(_0x2c5e8d(0x203))/0xa;if(_0x273d64===_0x4ad7e5)break;else _0x4ab9ec['push'](_0x4ab9ec['shift']());}catch(_0x5485ad){_0x4ab9ec['push'](_0x4ab9ec['shift']());}}}(a36_0x34ab,0xcaf96));function a36_0x4d06(_0x3642b6,_0x3536f2){const _0x34ab35=a36_0x34ab();return a36_0x4d06=function(_0x4d067d,_0x5677d4){_0x4d067d=_0x4d067d-0x1dc;let _0x4de3f5=_0x34ab35[_0x4d067d];return _0x4de3f5;},a36_0x4d06(_0x3642b6,_0x3536f2);}var __importDefault=this&&this[a36_0x5f4b3a(0x23b)]||function(_0x3f6b6d){return _0x3f6b6d&&_0x3f6b6d['__esModule']?_0x3f6b6d:{'default':_0x3f6b6d};};Object[a36_0x5f4b3a(0x1fa)](exports,a36_0x5f4b3a(0x1e0),{'value':!![]}),exports[a36_0x5f4b3a(0x1e5)]=exports[a36_0x5f4b3a(0x247)]=void 0x0;function a36_0x34ab(){const _0x4ee0a3=['xdr','bch','aed','dot','CURRENCIES','4eRQnvB','ltc','default','updatedAt','%\x20markup\x20=\x20','\x20to\x20USDT:','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','%\x20markup\x20to\x20','aud','__importDefault','toUpperCase','ils','Periodic\x20currency\x20rates\x20update\x20failed:',',\x20using\x201\x20as\x20fallback','statusText','log','status','getAllRates','xlm','Error\x20getting\x20all\x20rates:','toFixed','CurrencyService','21699YfOxGU','bmd','pkr','sek','?ids=tether&vs_currencies=','findUnique','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xau','hkd','eur','vnd','sgd','Error\x20converting\x20','sar','count','upsert','application/json','getCurrencyRate','join','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','xag','error','bits','MARKUP_PERCENTAGE','__esModule','php','findFirst','7405854LilZLr','link','currencyService','map','bdt','try','keys','eth','convertMultipleToUSDT','10836042PTvdAq','4605798NfmwVm','currency','Failed\x20to\x20update\x20rate\x20for\x20','tether','mmk','rate','clp','../config/database','\x20USDT\x20(rate:\x20','convertToUSDT','\x20USDT,\x20with\x20','ngn','chf','defineProperty','13033AFhcAH','rub','czk','nzd','length','ðŸ“Š\x20Received\x20rates\x20for\x20','984LbWbJt','toLowerCase','27720610OHcgZQ','\x20USDT\x20=\x20','entries','194CeiiGV','thb','ðŸ’±\x20Converted\x20','bhd','kwd','\x20to\x20','catch','json','\x20USDT','usd','currencyRate','brl','COINGECKO_URL','yfi','usdt','idr','Error\x20getting\x20rate\x20for\x20currency\x20','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','stopPeriodicUpdates','ðŸ’±\x20Applied\x20','warn','desc','jpy','vef','bnb','cny','krw','getMarkupPercentage','pln','xrp','TesSoft\x20Payment\x20System/1.0','updateCurrencyRates','asc','\x20currencies','8262350XiRckR','startPeriodicUpdates','updateInterval','myr','cad'];a36_0x34ab=function(){return _0x4ee0a3;};return a36_0x34ab();}const database_1=__importDefault(require(a36_0x5f4b3a(0x1f4)));class CurrencyService{constructor(){const _0x26dca2=a36_0x5f4b3a;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x26dca2(0x231)]=['btc',_0x26dca2(0x1ea),_0x26dca2(0x233),_0x26dca2(0x22e),_0x26dca2(0x21e),'eos',_0x26dca2(0x223),_0x26dca2(0x244),_0x26dca2(0x1e4),_0x26dca2(0x230),_0x26dca2(0x213),_0x26dca2(0x20f),_0x26dca2(0x22f),'ars',_0x26dca2(0x23a),_0x26dca2(0x1e7),_0x26dca2(0x209),_0x26dca2(0x249),_0x26dca2(0x211),_0x26dca2(0x22c),_0x26dca2(0x1f9),_0x26dca2(0x1f3),_0x26dca2(0x21f),_0x26dca2(0x1fd),'dkk',_0x26dca2(0x251),'gbp','gel',_0x26dca2(0x250),'huf',_0x26dca2(0x215),_0x26dca2(0x23d),'inr',_0x26dca2(0x21c),_0x26dca2(0x220),_0x26dca2(0x20a),'lkr',_0x26dca2(0x1f1),'mxn',_0x26dca2(0x22b),_0x26dca2(0x1f8),'nok',_0x26dca2(0x1fe),_0x26dca2(0x1e1),_0x26dca2(0x24a),_0x26dca2(0x222),_0x26dca2(0x1fc),_0x26dca2(0x255),_0x26dca2(0x24b),_0x26dca2(0x253),_0x26dca2(0x207),_0x26dca2(0x1e8),'twd','uah',_0x26dca2(0x21d),_0x26dca2(0x252),'zar',_0x26dca2(0x22d),_0x26dca2(0x1dc),_0x26dca2(0x24f),_0x26dca2(0x1de),'sats'],this[_0x26dca2(0x22a)]=null,this[_0x26dca2(0x1df)]=0x3,this['startPeriodicUpdates']();}[a36_0x5f4b3a(0x229)](){const _0x2978d4=a36_0x5f4b3a;this[_0x2978d4(0x225)]()[_0x2978d4(0x20c)](_0x30d7eb=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x30d7eb);}),this['updateInterval']=setInterval(async()=>{const _0x5751a6=_0x2978d4;try{await this['updateCurrencyRates']();}catch(_0x25e10a){console[_0x5751a6(0x1dd)](_0x5751a6(0x23e),_0x25e10a);}},0x3c*0x3c*0x3e8),console[_0x2978d4(0x241)](_0x2978d4(0x24e));}[a36_0x5f4b3a(0x218)](){const _0x59df51=a36_0x5f4b3a;this[_0x59df51(0x22a)]&&(clearInterval(this[_0x59df51(0x22a)]),this[_0x59df51(0x22a)]=null,console['log'](_0x59df51(0x25b)));}async['updateCurrencyRates'](){const _0x38389=a36_0x5f4b3a;try{console[_0x38389(0x241)](_0x38389(0x217));const _0x12f230=this[_0x38389(0x231)][_0x38389(0x25a)](','),_0x11c9e8=this[_0x38389(0x212)]+_0x38389(0x24c)+_0x12f230,_0xb85068=await fetch(_0x11c9e8,{'headers':{'Accept':_0x38389(0x258),'User-Agent':_0x38389(0x224)}});if(!_0xb85068['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0xb85068[_0x38389(0x242)]+'\x20'+_0xb85068[_0x38389(0x240)]);const _0xe2c80b=await _0xb85068[_0x38389(0x20d)]();if(!_0xe2c80b[_0x38389(0x1f0)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x2152de=_0xe2c80b[_0x38389(0x1f0)];console['log'](_0x38389(0x200)+Object[_0x38389(0x1e9)](_0x2152de)[_0x38389(0x1ff)]+_0x38389(0x227));const _0x1a97cf=Object[_0x38389(0x205)](_0x2152de)[_0x38389(0x1e6)](async([_0x4c00ea,_0x177ac3])=>{const _0x7599fb=_0x38389;try{await database_1[_0x7599fb(0x234)][_0x7599fb(0x210)][_0x7599fb(0x257)]({'where':{'currency':_0x4c00ea[_0x7599fb(0x202)]()},'update':{'rate':_0x177ac3},'create':{'currency':_0x4c00ea[_0x7599fb(0x202)](),'rate':_0x177ac3}});}catch(_0x240d0f){console['error'](_0x7599fb(0x1ef)+_0x4c00ea+':',_0x240d0f);}});await Promise['allSettled'](_0x1a97cf),console[_0x38389(0x241)]('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0xbdbdad){console[_0x38389(0x1dd)](_0x38389(0x238),_0xbdbdad);throw _0xbdbdad;}}async[a36_0x5f4b3a(0x259)](_0xc12191){const _0x44e2e2=a36_0x5f4b3a,_0x51c4e5=_0xc12191[_0x44e2e2(0x202)]();if(_0x51c4e5==='usdt')return 0x1;try{const _0x409dfa=await database_1[_0x44e2e2(0x234)][_0x44e2e2(0x210)][_0x44e2e2(0x24d)]({'where':{'currency':_0x51c4e5}});if(!_0x409dfa)return console[_0x44e2e2(0x21a)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0xc12191+_0x44e2e2(0x23f)),0x1;return _0x409dfa[_0x44e2e2(0x1f2)];}catch(_0x3461e7){return console[_0x44e2e2(0x1dd)](_0x44e2e2(0x216)+_0xc12191+':',_0x3461e7),0x1;}}async[a36_0x5f4b3a(0x1f6)](_0x285411,_0x5d2b88){const _0x1acb5b=a36_0x5f4b3a,_0x1faeab=_0x5d2b88[_0x1acb5b(0x202)]();if(_0x1faeab===_0x1acb5b(0x214)){const _0x702795=_0x285411*(0x1+this[_0x1acb5b(0x1df)]/0x64);return console[_0x1acb5b(0x241)](_0x1acb5b(0x219)+this['MARKUP_PERCENTAGE']+_0x1acb5b(0x239)+_0x285411+_0x1acb5b(0x204)+_0x702795[_0x1acb5b(0x246)](0x6)+_0x1acb5b(0x20e)),_0x702795;}try{const _0x4dd19e=await this[_0x1acb5b(0x259)](_0x1faeab),_0x46007d=_0x285411/_0x4dd19e,_0x32a143=_0x46007d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x1acb5b(0x208)+_0x285411+'\x20'+_0x5d2b88[_0x1acb5b(0x23c)]()+_0x1acb5b(0x20b)+_0x46007d[_0x1acb5b(0x246)](0x6)+_0x1acb5b(0x1f7)+this[_0x1acb5b(0x1df)]+_0x1acb5b(0x236)+_0x32a143[_0x1acb5b(0x246)](0x6)+_0x1acb5b(0x1f5)+_0x4dd19e+')'),_0x32a143;}catch(_0x1fbc13){console[_0x1acb5b(0x1dd)](_0x1acb5b(0x254)+_0x285411+'\x20'+_0x5d2b88+_0x1acb5b(0x237),_0x1fbc13);const _0x32aa34=_0x285411*(0x1+this[_0x1acb5b(0x1df)]/0x64);return _0x32aa34;}}async[a36_0x5f4b3a(0x1eb)](_0x538b92){const _0x45cb3d=a36_0x5f4b3a;let _0x3b582a=0x0;for(const {amount:_0x7838bb,currency:_0x222874}of _0x538b92){const _0x497dd2=await this[_0x45cb3d(0x1f6)](_0x7838bb,_0x222874);_0x3b582a+=_0x497dd2;}return _0x3b582a;}async[a36_0x5f4b3a(0x243)](){const _0x2ec4c9=a36_0x5f4b3a;try{const _0x1eb8a9=await database_1[_0x2ec4c9(0x234)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x219e5f={'usdt':0x1};return _0x1eb8a9['forEach'](_0x8eb1cc=>{const _0x477e1b=_0x2ec4c9;_0x219e5f[_0x8eb1cc[_0x477e1b(0x1ee)]]=_0x8eb1cc[_0x477e1b(0x1f2)];}),_0x219e5f;}catch(_0x3e2bad){return console[_0x2ec4c9(0x1dd)](_0x2ec4c9(0x245),_0x3e2bad),{'usdt':0x1};}}async['getRatesStatus'](){const _0x7053b7=a36_0x5f4b3a;try{const [_0x5aae06,_0x5ddb5e,_0x1c64ef]=await Promise['all']([database_1[_0x7053b7(0x234)][_0x7053b7(0x210)][_0x7053b7(0x256)](),database_1[_0x7053b7(0x234)][_0x7053b7(0x210)][_0x7053b7(0x1e2)]({'orderBy':{'updatedAt':_0x7053b7(0x21b)},'select':{'updatedAt':!![]}}),database_1[_0x7053b7(0x234)][_0x7053b7(0x210)][_0x7053b7(0x1e2)]({'orderBy':{'updatedAt':_0x7053b7(0x226)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5aae06,'lastUpdated':_0x5ddb5e?.[_0x7053b7(0x235)]||null,'oldestRate':_0x1c64ef?.[_0x7053b7(0x235)]||null,'markupPercentage':this[_0x7053b7(0x1df)]};}catch(_0x379ada){return console[_0x7053b7(0x1dd)]('Error\x20getting\x20rates\x20status:',_0x379ada),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x7053b7(0x1df)]};}}[a36_0x5f4b3a(0x221)](){return this['MARKUP_PERCENTAGE'];}}exports[a36_0x5f4b3a(0x247)]=CurrencyService,exports['currencyService']=new CurrencyService();