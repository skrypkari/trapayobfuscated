'use strict';const a43_0x2702db=a43_0x1afe;(function(_0x1b9ed9,_0x24ab00){const _0x1e3417=a43_0x1afe,_0x7170c5=_0x1b9ed9();while(!![]){try{const _0x18265c=parseInt(_0x1e3417(0x194))/0x1+-parseInt(_0x1e3417(0x15d))/0x2+parseInt(_0x1e3417(0x1ab))/0x3*(parseInt(_0x1e3417(0x1d2))/0x4)+parseInt(_0x1e3417(0x1b0))/0x5+-parseInt(_0x1e3417(0x175))/0x6+parseInt(_0x1e3417(0x161))/0x7+-parseInt(_0x1e3417(0x1c7))/0x8*(-parseInt(_0x1e3417(0x16b))/0x9);if(_0x18265c===_0x24ab00)break;else _0x7170c5['push'](_0x7170c5['shift']());}catch(_0x585d9a){_0x7170c5['push'](_0x7170c5['shift']());}}}(a43_0x1b75,0x42134));var __importDefault=this&&this[a43_0x2702db(0x1ca)]||function(_0x5e80b0){const _0x59c6bc=a43_0x2702db;return _0x5e80b0&&_0x5e80b0[_0x59c6bc(0x1cd)]?_0x5e80b0:{'default':_0x5e80b0};};Object[a43_0x2702db(0x1cb)](exports,a43_0x2702db(0x1cd),{'value':!![]}),exports['currencyService']=exports[a43_0x2702db(0x163)]=void 0x0;function a43_0x1afe(_0x3fdfed,_0x102481){const _0x1b756c=a43_0x1b75();return a43_0x1afe=function(_0x1afee,_0x96c59b){_0x1afee=_0x1afee-0x15d;let _0x4e35df=_0x1b756c[_0x1afee];return _0x4e35df;},a43_0x1afe(_0x3fdfed,_0x102481);}const database_1=__importDefault(require(a43_0x2702db(0x185)));class CurrencyService{constructor(){const _0x47a056=a43_0x2702db;this[_0x47a056(0x1ad)]=_0x47a056(0x1d1),this[_0x47a056(0x19f)]=[_0x47a056(0x17a),_0x47a056(0x181),'ltc',_0x47a056(0x1ac),'bnb',_0x47a056(0x18c),'xrp','xlm',_0x47a056(0x18d),'dot',_0x47a056(0x15e),_0x47a056(0x193),'aed',_0x47a056(0x1a0),_0x47a056(0x183),'bdt',_0x47a056(0x18f),_0x47a056(0x174),_0x47a056(0x1bc),_0x47a056(0x1c0),'chf',_0x47a056(0x16f),'cny',_0x47a056(0x1b9),'dkk',_0x47a056(0x176),'gbp','gel',_0x47a056(0x16d),_0x47a056(0x16e),_0x47a056(0x1a3),_0x47a056(0x1c5),'inr','jpy','krw',_0x47a056(0x1c8),_0x47a056(0x19a),_0x47a056(0x19c),_0x47a056(0x1c3),_0x47a056(0x1b8),_0x47a056(0x180),'nok',_0x47a056(0x1ba),'php','pkr',_0x47a056(0x17d),_0x47a056(0x1d4),_0x47a056(0x1be),_0x47a056(0x191),_0x47a056(0x16a),_0x47a056(0x18e),'try',_0x47a056(0x19b),'uah',_0x47a056(0x18b),_0x47a056(0x1b5),_0x47a056(0x172),_0x47a056(0x1a6),_0x47a056(0x171),_0x47a056(0x1b3),_0x47a056(0x196),_0x47a056(0x1ce)],this[_0x47a056(0x189)]=null,this[_0x47a056(0x17b)]=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x127c1f=a43_0x2702db;this['updateCurrencyRates']()[_0x127c1f(0x160)](_0x7ba33=>{const _0x31f9eb=_0x127c1f;console[_0x31f9eb(0x1cc)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x7ba33);}),this[_0x127c1f(0x189)]=setInterval(async()=>{const _0x5042c6=_0x127c1f;try{await this[_0x5042c6(0x15f)]();}catch(_0x2efb82){console[_0x5042c6(0x1cc)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x2efb82);}},0x3c*0x3c*0x3e8),console[_0x127c1f(0x1c9)](_0x127c1f(0x1af));}[a43_0x2702db(0x190)](){const _0x1b21cf=a43_0x2702db;this[_0x1b21cf(0x189)]&&(clearInterval(this[_0x1b21cf(0x189)]),this[_0x1b21cf(0x189)]=null,console[_0x1b21cf(0x1c9)](_0x1b21cf(0x1aa)));}async['updateCurrencyRates'](){const _0x426195=a43_0x2702db;try{console['log'](_0x426195(0x1b7));const _0x2bdea4=this[_0x426195(0x19f)][_0x426195(0x197)](','),_0x5aec2c=this[_0x426195(0x1ad)]+_0x426195(0x1d3)+_0x2bdea4,_0x5941de=await fetch(_0x5aec2c,{'headers':{'Accept':'application/json','User-Agent':_0x426195(0x198)}});if(!_0x5941de['ok'])throw new Error(_0x426195(0x1ae)+_0x5941de[_0x426195(0x184)]+'\x20'+_0x5941de[_0x426195(0x19d)]);const _0x2560fd=await _0x5941de[_0x426195(0x169)]();if(!_0x2560fd[_0x426195(0x17c)])throw new Error(_0x426195(0x1cf));const _0x2e2784=_0x2560fd[_0x426195(0x17c)];console[_0x426195(0x1c9)](_0x426195(0x1a1)+Object['keys'](_0x2e2784)[_0x426195(0x162)]+_0x426195(0x1a2));const _0x4a5cc2=Object[_0x426195(0x167)](_0x2e2784)[_0x426195(0x179)](async([_0xfe692e,_0x3a7032])=>{const _0xbe3e49=_0x426195;try{await database_1['default'][_0xbe3e49(0x18a)][_0xbe3e49(0x17f)]({'where':{'currency':_0xfe692e['toLowerCase']()},'update':{'rate':_0x3a7032},'create':{'currency':_0xfe692e[_0xbe3e49(0x186)](),'rate':_0x3a7032}});}catch(_0xc25b3a){console[_0xbe3e49(0x1cc)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0xfe692e+':',_0xc25b3a);}});await Promise[_0x426195(0x182)](_0x4a5cc2),console['log'](_0x426195(0x19e));}catch(_0x14722b){console[_0x426195(0x1cc)](_0x426195(0x1b6),_0x14722b);throw _0x14722b;}}async[a43_0x2702db(0x1b4)](_0x3ea6e8){const _0x91356=a43_0x2702db,_0x343509=_0x3ea6e8['toLowerCase']();if(_0x343509==='usdt')return 0x1;try{const _0x23c5fd=await database_1[_0x91356(0x1a8)][_0x91356(0x18a)][_0x91356(0x192)]({'where':{'currency':_0x343509}});if(!_0x23c5fd)return console[_0x91356(0x168)](_0x91356(0x188)+_0x3ea6e8+',\x20using\x201\x20as\x20fallback'),0x1;return _0x23c5fd[_0x91356(0x1d0)];}catch(_0x39e292){return console[_0x91356(0x1cc)](_0x91356(0x17e)+_0x3ea6e8+':',_0x39e292),0x1;}}async['convertToUSDT'](_0xbd7a2b,_0x6a499b){const _0x45732b=a43_0x2702db,_0x38666e=_0x6a499b['toLowerCase']();if(_0x38666e===_0x45732b(0x1c6)){const _0x54f5ff=_0xbd7a2b*(0x1+this[_0x45732b(0x17b)]/0x64);return console['log'](_0x45732b(0x1bb)+this[_0x45732b(0x17b)]+'%\x20markup\x20to\x20'+_0xbd7a2b+_0x45732b(0x1a7)+_0x54f5ff[_0x45732b(0x164)](0x6)+_0x45732b(0x195)),_0x54f5ff;}try{const _0x2a6aa7=await this[_0x45732b(0x1b4)](_0x38666e),_0x14d830=_0xbd7a2b/_0x2a6aa7,_0x358d2b=_0x14d830*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x45732b(0x1c9)](_0x45732b(0x1a5)+_0xbd7a2b+'\x20'+_0x6a499b[_0x45732b(0x1a9)]()+_0x45732b(0x1c4)+_0x14d830[_0x45732b(0x164)](0x6)+_0x45732b(0x187)+this[_0x45732b(0x17b)]+_0x45732b(0x170)+_0x358d2b['toFixed'](0x6)+_0x45732b(0x1a4)+_0x2a6aa7+')'),_0x358d2b;}catch(_0x49aa31){console[_0x45732b(0x1cc)](_0x45732b(0x177)+_0xbd7a2b+'\x20'+_0x6a499b+_0x45732b(0x166),_0x49aa31);const _0x27cecb=_0xbd7a2b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x27cecb;}}async['convertMultipleToUSDT'](_0x52a798){const _0x361c61=a43_0x2702db;let _0x24b951=0x0;for(const {amount:_0x999bf3,currency:_0x5bbbcb}of _0x52a798){const _0xeb7d46=await this[_0x361c61(0x1bd)](_0x999bf3,_0x5bbbcb);_0x24b951+=_0xeb7d46;}return _0x24b951;}async[a43_0x2702db(0x1b2)](){const _0x5290b0=a43_0x2702db;try{const _0x49312c=await database_1[_0x5290b0(0x1a8)][_0x5290b0(0x18a)][_0x5290b0(0x199)]({'select':{'currency':!![],'rate':!![]}}),_0x35d9ff={'usdt':0x1};return _0x49312c['forEach'](_0x5d66b6=>{const _0x59eac8=_0x5290b0;_0x35d9ff[_0x5d66b6[_0x59eac8(0x165)]]=_0x5d66b6['rate'];}),_0x35d9ff;}catch(_0x10bce1){return console[_0x5290b0(0x1cc)]('Error\x20getting\x20all\x20rates:',_0x10bce1),{'usdt':0x1};}}async[a43_0x2702db(0x1b1)](){const _0x3da13a=a43_0x2702db;try{const [_0x1fd009,_0x14f45b,_0x240a4a]=await Promise['all']([database_1[_0x3da13a(0x1a8)][_0x3da13a(0x18a)]['count'](),database_1[_0x3da13a(0x1a8)][_0x3da13a(0x18a)]['findFirst']({'orderBy':{'updatedAt':_0x3da13a(0x1bf)},'select':{'updatedAt':!![]}}),database_1[_0x3da13a(0x1a8)][_0x3da13a(0x18a)]['findFirst']({'orderBy':{'updatedAt':_0x3da13a(0x1c2)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1fd009,'lastUpdated':_0x14f45b?.[_0x3da13a(0x173)]||null,'oldestRate':_0x240a4a?.[_0x3da13a(0x173)]||null,'markupPercentage':this[_0x3da13a(0x17b)]};}catch(_0x225080){return console[_0x3da13a(0x1cc)](_0x3da13a(0x1c1),_0x225080),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a43_0x2702db(0x16c)](){const _0x375479=a43_0x2702db;return this[_0x375479(0x17b)];}}function a43_0x1b75(){const _0x357180=['CurrencyService','toFixed','currency','\x20to\x20USDT:','entries','warn','json','sgd','18zflJHb','getMarkupPercentage','hkd','huf','clp','%\x20markup\x20=\x20','xag','zar','updatedAt','bmd','2934456yGiBju','eur','Error\x20converting\x20','currencyService','map','btc','MARKUP_PERCENTAGE','tether','pln','Error\x20getting\x20rate\x20for\x20currency\x20','upsert','ngn','eth','allSettled','aud','status','../config/database','toLowerCase','\x20USDT,\x20with\x20','No\x20rate\x20found\x20for\x20currency:\x20','updateInterval','currencyRate','vef','eos','link','thb','bhd','stopPeriodicUpdates','sek','findUnique','usd','335566ZUZnFa','\x20USDT','bits','join','Payment\x20System/1.0','findMany','lkr','twd','mmk','statusText','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','CURRENCIES','ars','üìä\x20Received\x20rates\x20for\x20','\x20currencies','idr','\x20USDT\x20(rate:\x20','üí±\x20Converted\x20','xdr','\x20USDT\x20=\x20','default','toUpperCase','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','51RmOJkm','bch','COINGECKO_URL','CoinGecko\x20API\x20error:\x20','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','2191360aoxRvq','getRatesStatus','getAllRates','xau','getCurrencyRate','vnd','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','myr','czk','nzd','üí±\x20Applied\x20','brl','convertToUSDT','sar','desc','cad','Error\x20getting\x20rates\x20status:','asc','mxn','\x20to\x20','ils','usdt','394448EVixdN','kwd','log','__importDefault','defineProperty','error','__esModule','sats','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','rate','https://api.coingecko.com/api/v3/simple/price','4988GUdoaL','?ids=tether&vs_currencies=','rub','538674PVXHoM','yfi','updateCurrencyRates','catch','947856rykTXe','length'];a43_0x1b75=function(){return _0x357180;};return a43_0x1b75();}exports[a43_0x2702db(0x163)]=CurrencyService,exports[a43_0x2702db(0x178)]=new CurrencyService();