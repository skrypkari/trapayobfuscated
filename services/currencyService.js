'use strict';const a36_0x1568f1=a36_0x30d5;(function(_0x3ba4fe,_0x35d549){const _0x3d0352=a36_0x30d5,_0x39a7a7=_0x3ba4fe();while(!![]){try{const _0x340561=-parseInt(_0x3d0352(0x241))/0x1+parseInt(_0x3d0352(0x24c))/0x2+parseInt(_0x3d0352(0x226))/0x3+-parseInt(_0x3d0352(0x230))/0x4+-parseInt(_0x3d0352(0x23c))/0x5+-parseInt(_0x3d0352(0x262))/0x6*(-parseInt(_0x3d0352(0x20c))/0x7)+-parseInt(_0x3d0352(0x212))/0x8;if(_0x340561===_0x35d549)break;else _0x39a7a7['push'](_0x39a7a7['shift']());}catch(_0x26c1ef){_0x39a7a7['push'](_0x39a7a7['shift']());}}}(a36_0x554a,0xe6a73));var __importDefault=this&&this[a36_0x1568f1(0x23b)]||function(_0x51e3b3){const _0x44da6f=a36_0x1568f1;return _0x51e3b3&&_0x51e3b3[_0x44da6f(0x205)]?_0x51e3b3:{'default':_0x51e3b3};};Object[a36_0x1568f1(0x213)](exports,a36_0x1568f1(0x205),{'value':!![]}),exports[a36_0x1568f1(0x20a)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a36_0x1568f1(0x208)));class CurrencyService{constructor(){const _0x1ba2d8=a36_0x1568f1;this['COINGECKO_URL']=_0x1ba2d8(0x25a),this['CURRENCIES']=['btc','eth','ltc','bch','bnb',_0x1ba2d8(0x257),_0x1ba2d8(0x249),_0x1ba2d8(0x207),_0x1ba2d8(0x211),_0x1ba2d8(0x256),_0x1ba2d8(0x245),'usd',_0x1ba2d8(0x252),_0x1ba2d8(0x260),_0x1ba2d8(0x1fd),'bdt','bhd',_0x1ba2d8(0x203),_0x1ba2d8(0x224),_0x1ba2d8(0x24b),'chf','clp',_0x1ba2d8(0x235),'czk',_0x1ba2d8(0x216),_0x1ba2d8(0x24a),_0x1ba2d8(0x1f4),_0x1ba2d8(0x206),'hkd',_0x1ba2d8(0x236),_0x1ba2d8(0x223),_0x1ba2d8(0x1f2),_0x1ba2d8(0x246),_0x1ba2d8(0x1f1),'krw',_0x1ba2d8(0x232),_0x1ba2d8(0x240),_0x1ba2d8(0x210),'mxn',_0x1ba2d8(0x25f),_0x1ba2d8(0x23a),_0x1ba2d8(0x221),_0x1ba2d8(0x263),'php',_0x1ba2d8(0x237),_0x1ba2d8(0x251),'rub',_0x1ba2d8(0x261),_0x1ba2d8(0x200),_0x1ba2d8(0x1fc),_0x1ba2d8(0x254),_0x1ba2d8(0x234),'twd','uah',_0x1ba2d8(0x238),_0x1ba2d8(0x22b),_0x1ba2d8(0x247),'xdr',_0x1ba2d8(0x255),_0x1ba2d8(0x258),_0x1ba2d8(0x243),_0x1ba2d8(0x250)],this[_0x1ba2d8(0x233)]=null,this['MARKUP_PERCENTAGE']=0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x13c344=a36_0x1568f1;this['updateCurrencyRates']()[_0x13c344(0x21e)](_0x405730=>{const _0x5cc220=_0x13c344;console[_0x5cc220(0x22a)](_0x5cc220(0x202),_0x405730);}),this['updateInterval']=setInterval(async()=>{const _0x18163d=_0x13c344;try{await this['updateCurrencyRates']();}catch(_0x41cdba){console[_0x18163d(0x22a)](_0x18163d(0x1fe),_0x41cdba);}},0x3c*0x3c*0x3e8),console[_0x13c344(0x23d)](_0x13c344(0x229));}['stopPeriodicUpdates'](){const _0x5b688f=a36_0x1568f1;this[_0x5b688f(0x233)]&&(clearInterval(this[_0x5b688f(0x233)]),this['updateInterval']=null,console[_0x5b688f(0x23d)](_0x5b688f(0x259)));}async[a36_0x1568f1(0x228)](){const _0x3e2486=a36_0x1568f1;try{console['log'](_0x3e2486(0x217));const _0x21e2cf=this[_0x3e2486(0x24d)][_0x3e2486(0x1f9)](','),_0x38ef4b=this[_0x3e2486(0x214)]+_0x3e2486(0x25b)+_0x21e2cf,_0x154696=await fetch(_0x38ef4b,{'headers':{'Accept':_0x3e2486(0x242),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x154696['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x154696[_0x3e2486(0x248)]+'\x20'+_0x154696[_0x3e2486(0x21a)]);const _0x2356b9=await _0x154696[_0x3e2486(0x266)]();if(!_0x2356b9[_0x3e2486(0x225)])throw new Error(_0x3e2486(0x25d));const _0x318dd8=_0x2356b9[_0x3e2486(0x225)];console[_0x3e2486(0x23d)](_0x3e2486(0x215)+Object['keys'](_0x318dd8)[_0x3e2486(0x1f3)]+'\x20currencies');const _0x74ee20=Object[_0x3e2486(0x20f)](_0x318dd8)[_0x3e2486(0x1fb)](async([_0x11272d,_0x2ab073])=>{const _0x492adf=_0x3e2486;try{await database_1[_0x492adf(0x204)]['currencyRate'][_0x492adf(0x201)]({'where':{'currency':_0x11272d[_0x492adf(0x267)]()},'update':{'rate':_0x2ab073},'create':{'currency':_0x11272d[_0x492adf(0x267)](),'rate':_0x2ab073}});}catch(_0x4e5702){console['error'](_0x492adf(0x222)+_0x11272d+':',_0x4e5702);}});await Promise[_0x3e2486(0x227)](_0x74ee20),console[_0x3e2486(0x23d)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x52ab52){console['error'](_0x3e2486(0x253),_0x52ab52);throw _0x52ab52;}}async[a36_0x1568f1(0x244)](_0x18df6d){const _0x586276=a36_0x1568f1,_0x2d71b9=_0x18df6d[_0x586276(0x267)]();if(_0x2d71b9==='usdt')return 0x1;try{const _0x95376a=await database_1[_0x586276(0x204)][_0x586276(0x22d)][_0x586276(0x24f)]({'where':{'currency':_0x2d71b9}});if(!_0x95376a)return console['warn'](_0x586276(0x23e)+_0x18df6d+_0x586276(0x1ff)),0x1;return _0x95376a[_0x586276(0x21d)];}catch(_0x547adf){return console[_0x586276(0x22a)](_0x586276(0x25c)+_0x18df6d+':',_0x547adf),0x1;}}async[a36_0x1568f1(0x1fa)](_0x5dfdeb,_0x1d3bdf){const _0xdd5a01=a36_0x1568f1,_0xcd151a=_0x1d3bdf[_0xdd5a01(0x267)]();if(_0xcd151a==='usdt'){const _0x216aee=_0x5dfdeb*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log']('üí±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x5dfdeb+_0xdd5a01(0x264)+_0x216aee['toFixed'](0x6)+'\x20USDT'),_0x216aee;}try{const _0x586eab=await this[_0xdd5a01(0x244)](_0xcd151a),_0x4066c6=_0x5dfdeb/_0x586eab,_0x26116c=_0x4066c6*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log']('üí±\x20Converted\x20'+_0x5dfdeb+'\x20'+_0x1d3bdf[_0xdd5a01(0x220)]()+_0xdd5a01(0x25e)+_0x4066c6['toFixed'](0x6)+_0xdd5a01(0x1f7)+this[_0xdd5a01(0x20b)]+_0xdd5a01(0x21b)+_0x26116c[_0xdd5a01(0x1f8)](0x6)+_0xdd5a01(0x24e)+_0x586eab+')'),_0x26116c;}catch(_0x1cd979){console[_0xdd5a01(0x22a)](_0xdd5a01(0x20e)+_0x5dfdeb+'\x20'+_0x1d3bdf+_0xdd5a01(0x22f),_0x1cd979);const _0x26f425=_0x5dfdeb*(0x1+this[_0xdd5a01(0x20b)]/0x64);return _0x26f425;}}async[a36_0x1568f1(0x265)](_0x3eac18){const _0x53469b=a36_0x1568f1;let _0x232149=0x0;for(const {amount:_0x20fb37,currency:_0x34b57a}of _0x3eac18){const _0x4c963f=await this[_0x53469b(0x1fa)](_0x20fb37,_0x34b57a);_0x232149+=_0x4c963f;}return _0x232149;}async[a36_0x1568f1(0x231)](){const _0x1e7c89=a36_0x1568f1;try{const _0xec40a8=await database_1[_0x1e7c89(0x204)][_0x1e7c89(0x22d)][_0x1e7c89(0x1f6)]({'select':{'currency':!![],'rate':!![]}}),_0xc3c66c={'usdt':0x1};return _0xec40a8[_0x1e7c89(0x218)](_0x2a2a73=>{const _0x81a422=_0x1e7c89;_0xc3c66c[_0x2a2a73[_0x81a422(0x20d)]]=_0x2a2a73[_0x81a422(0x21d)];}),_0xc3c66c;}catch(_0xb7da18){return console['error'](_0x1e7c89(0x21c),_0xb7da18),{'usdt':0x1};}}async['getRatesStatus'](){const _0x54fa66=a36_0x1568f1;try{const [_0x22b415,_0x3102da,_0x3028fa]=await Promise[_0x54fa66(0x219)]([database_1[_0x54fa66(0x204)][_0x54fa66(0x22d)][_0x54fa66(0x23f)](),database_1['default'][_0x54fa66(0x22d)][_0x54fa66(0x1f5)]({'orderBy':{'updatedAt':_0x54fa66(0x22e)},'select':{'updatedAt':!![]}}),database_1[_0x54fa66(0x204)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x22b415,'lastUpdated':_0x3102da?.[_0x54fa66(0x209)]||null,'oldestRate':_0x3028fa?.[_0x54fa66(0x209)]||null,'markupPercentage':this[_0x54fa66(0x20b)]};}catch(_0x3cf224){return console[_0x54fa66(0x22a)](_0x54fa66(0x22c),_0x3cf224),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x54fa66(0x20b)]};}}[a36_0x1568f1(0x21f)](){const _0x53e880=a36_0x1568f1;return this[_0x53e880(0x20b)];}}exports[a36_0x1568f1(0x239)]=CurrencyService,exports[a36_0x1568f1(0x20a)]=new CurrencyService();function a36_0x30d5(_0x1afeb8,_0x48d075){const _0x554a95=a36_0x554a();return a36_0x30d5=function(_0x30d570,_0x23e1f5){_0x30d570=_0x30d570-0x1f1;let _0x56721b=_0x554a95[_0x30d570];return _0x56721b;},a36_0x30d5(_0x1afeb8,_0x48d075);}function a36_0x554a(){const _0xa75e05=['ils','length','gbp','findFirst','findMany','\x20USDT,\x20with\x20','toFixed','join','convertToUSDT','map','sgd','aud','Periodic\x20currency\x20rates\x20update\x20failed:',',\x20using\x201\x20as\x20fallback','sek','upsert','Initial\x20currency\x20rates\x20update\x20failed:','bmd','default','__esModule','gel','xlm','../config/database','updatedAt','currencyService','MARKUP_PERCENTAGE','20601cTYizX','currency','Error\x20converting\x20','entries','mmk','link','1900160ndlLLX','defineProperty','COINGECKO_URL','üìä\x20Received\x20rates\x20for\x20','dkk','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','forEach','all','statusText','%\x20markup\x20=\x20','Error\x20getting\x20all\x20rates:','rate','catch','getMarkupPercentage','toUpperCase','nok','Failed\x20to\x20update\x20rate\x20for\x20','idr','brl','tether','547269CLxzLZ','allSettled','updateCurrencyRates','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','error','vnd','Error\x20getting\x20rates\x20status:','currencyRate','desc','\x20to\x20USDT:','324784OqfYwc','getAllRates','kwd','updateInterval','try','cny','huf','pkr','vef','CurrencyService','ngn','__importDefault','725085naHWcG','log','No\x20rate\x20found\x20for\x20currency:\x20','count','lkr','1249627YhMehJ','application/json','bits','getCurrencyRate','yfi','inr','zar','status','xrp','eur','cad','3444568EPPGGi','CURRENCIES','\x20USDT\x20(rate:\x20','findUnique','sats','pln','aed','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','thb','xag','dot','eos','xau','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','https://api.coingecko.com/api/v3/simple/price','?ids=tether&vs_currencies=','Error\x20getting\x20rate\x20for\x20currency\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20to\x20','myr','ars','sar','1536TYEbuJ','nzd','\x20USDT\x20=\x20','convertMultipleToUSDT','json','toLowerCase','jpy'];a36_0x554a=function(){return _0xa75e05;};return a36_0x554a();}