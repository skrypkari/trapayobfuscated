'use strict';const a38_0x1ec4cb=a38_0x57b7;function a38_0x57b7(_0x158990,_0x5c85c0){const _0x27db9b=a38_0x27db();return a38_0x57b7=function(_0x57b73f,_0x55b6c6){_0x57b73f=_0x57b73f-0x88;let _0x1c4002=_0x27db9b[_0x57b73f];return _0x1c4002;},a38_0x57b7(_0x158990,_0x5c85c0);}(function(_0x1a11f7,_0x5bd828){const _0x7de67f=a38_0x57b7,_0x18ae82=_0x1a11f7();while(!![]){try{const _0x13b9b8=parseInt(_0x7de67f(0x9d))/0x1+parseInt(_0x7de67f(0x8d))/0x2*(-parseInt(_0x7de67f(0xd7))/0x3)+-parseInt(_0x7de67f(0xd3))/0x4+parseInt(_0x7de67f(0x88))/0x5+parseInt(_0x7de67f(0xfd))/0x6*(parseInt(_0x7de67f(0xf2))/0x7)+-parseInt(_0x7de67f(0xfa))/0x8+parseInt(_0x7de67f(0x94))/0x9*(parseInt(_0x7de67f(0xc8))/0xa);if(_0x13b9b8===_0x5bd828)break;else _0x18ae82['push'](_0x18ae82['shift']());}catch(_0x2e83b9){_0x18ae82['push'](_0x18ae82['shift']());}}}(a38_0x27db,0xa98e9));var __importDefault=this&&this['__importDefault']||function(_0x58ed5e){const _0x36579a=a38_0x57b7;return _0x58ed5e&&_0x58ed5e[_0x36579a(0x9e)]?_0x58ed5e:{'default':_0x58ed5e};};function a38_0x27db(){const _0x2731c9=['getRatesStatus','Error\x20converting\x20','currencyRate','24QMFsuA','bhd','bdt','Error\x20getting\x20rates\x20status:','mxn','error','toFixed','Error\x20getting\x20rate\x20for\x20currency\x20','dot','✅\x20Currency\x20rates\x20updated\x20successfully','vef','defineProperty','sar','tether','❌\x20Failed\x20to\x20update\x20currency\x20rates:','%\x20markup\x20to\x20','catch','sek','yfi','MARKUP_PERCENTAGE','default','entries','rub','updatedAt','ars','findUnique','startPeriodicUpdates','2820622mpgYya','kwd','uah','gel','length','xag','huf','bch','7114928SRQcAQ','nzd','allSettled','12lKGyOe','log','../config/database','1448500IFlsSp','czk','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xlm','getCurrencyRate','144914VvwWku','toLowerCase','xau','currency','convertToUSDT','chf','application/json','125100tTtxDS','CurrencyService','CURRENCIES','toUpperCase','php','brl','sgd','btc','keys','1311671NOXeCZ','__esModule','\x20USDT\x20(rate:\x20','link','usdt','json','getMarkupPercentage','bits','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','nok','currencyService','ils','zar','getAllRates','bmd','aed','\x20to\x20USDT:','thb','eth','CoinGecko\x20API\x20error:\x20','Periodic\x20currency\x20rates\x20update\x20failed:','usd','updateInterval','TesSoft\x20Payment\x20System/1.0','desc','No\x20rate\x20found\x20for\x20currency:\x20','?ids=tether&vs_currencies=','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','dkk','findMany','Error\x20getting\x20all\x20rates:','krw','eur','updateCurrencyRates','all','mmk','\x20currencies','rate','findFirst','ltc','idr','jpy','status','60vtFYFU','warn','twd','cad','lkr','aud','Failed\x20to\x20update\x20rate\x20for\x20','pkr','cny','Initial\x20currency\x20rates\x20update\x20failed:','clp','1308544VEwlAw'];a38_0x27db=function(){return _0x2731c9;};return a38_0x27db();}Object[a38_0x1ec4cb(0xe2)](exports,a38_0x1ec4cb(0x9e),{'value':!![]}),exports[a38_0x1ec4cb(0xa7)]=exports[a38_0x1ec4cb(0x95)]=void 0x0;const database_1=__importDefault(require(a38_0x1ec4cb(0xff)));class CurrencyService{constructor(){const _0x5909ca=a38_0x1ec4cb;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x5909ca(0x96)]=[_0x5909ca(0x9b),_0x5909ca(0xaf),_0x5909ca(0xc4),_0x5909ca(0xf9),'bnb','eos','xrp',_0x5909ca(0x8b),_0x5909ca(0xa0),_0x5909ca(0xdf),_0x5909ca(0xe9),_0x5909ca(0xb2),_0x5909ca(0xac),_0x5909ca(0xef),_0x5909ca(0xcd),_0x5909ca(0xd9),_0x5909ca(0xd8),_0x5909ca(0xab),_0x5909ca(0x99),_0x5909ca(0xcb),_0x5909ca(0x92),_0x5909ca(0xd2),_0x5909ca(0xd0),_0x5909ca(0x89),_0x5909ca(0xb9),_0x5909ca(0xbd),'gbp',_0x5909ca(0xf5),'hkd',_0x5909ca(0xf8),_0x5909ca(0xc5),_0x5909ca(0xa8),'inr',_0x5909ca(0xc6),_0x5909ca(0xbc),_0x5909ca(0xf3),_0x5909ca(0xcc),_0x5909ca(0xc0),_0x5909ca(0xdb),'myr','ngn',_0x5909ca(0xa6),_0x5909ca(0xfb),_0x5909ca(0x98),_0x5909ca(0xcf),'pln',_0x5909ca(0xed),_0x5909ca(0xe3),_0x5909ca(0xe8),_0x5909ca(0x9a),_0x5909ca(0xae),'try',_0x5909ca(0xca),_0x5909ca(0xf4),_0x5909ca(0xe1),'vnd',_0x5909ca(0xa9),'xdr',_0x5909ca(0xf7),_0x5909ca(0x8f),_0x5909ca(0xa4),'sats'],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x5909ca(0xf1)]();}[a38_0x1ec4cb(0xf1)](){const _0x43ca56=a38_0x1ec4cb;this['updateCurrencyRates']()[_0x43ca56(0xe7)](_0xa3d89a=>{const _0x4a4f6c=_0x43ca56;console[_0x4a4f6c(0xdc)](_0x4a4f6c(0xd1),_0xa3d89a);}),this[_0x43ca56(0xb3)]=setInterval(async()=>{const _0x39bc70=_0x43ca56;try{await this[_0x39bc70(0xbe)]();}catch(_0x211a9c){console[_0x39bc70(0xdc)](_0x39bc70(0xb1),_0x211a9c);}},0x3c*0x3c*0x3e8),console[_0x43ca56(0xfe)](_0x43ca56(0x8a));}['stopPeriodicUpdates'](){const _0x1c74e2=a38_0x1ec4cb;this[_0x1c74e2(0xb3)]&&(clearInterval(this['updateInterval']),this[_0x1c74e2(0xb3)]=null,console[_0x1c74e2(0xfe)](_0x1c74e2(0xb8)));}async[a38_0x1ec4cb(0xbe)](){const _0x31646a=a38_0x1ec4cb;try{console[_0x31646a(0xfe)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x40b95d=this[_0x31646a(0x96)]['join'](','),_0x29484e=this['COINGECKO_URL']+_0x31646a(0xb7)+_0x40b95d,_0x5cb012=await fetch(_0x29484e,{'headers':{'Accept':_0x31646a(0x93),'User-Agent':_0x31646a(0xb4)}});if(!_0x5cb012['ok'])throw new Error(_0x31646a(0xb0)+_0x5cb012[_0x31646a(0xc7)]+'\x20'+_0x5cb012['statusText']);const _0xe8e318=await _0x5cb012[_0x31646a(0xa2)]();if(!_0xe8e318[_0x31646a(0xe4)])throw new Error(_0x31646a(0xa5));const _0xcb44e8=_0xe8e318['tether'];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x31646a(0x9c)](_0xcb44e8)[_0x31646a(0xf6)]+_0x31646a(0xc1));const _0x2da8f9=Object[_0x31646a(0xec)](_0xcb44e8)['map'](async([_0x3737e,_0x59c19c])=>{const _0x5e58f6=_0x31646a;try{await database_1['default'][_0x5e58f6(0xd6)]['upsert']({'where':{'currency':_0x3737e['toLowerCase']()},'update':{'rate':_0x59c19c},'create':{'currency':_0x3737e['toLowerCase'](),'rate':_0x59c19c}});}catch(_0x372af0){console[_0x5e58f6(0xdc)](_0x5e58f6(0xce)+_0x3737e+':',_0x372af0);}});await Promise[_0x31646a(0xfc)](_0x2da8f9),console[_0x31646a(0xfe)](_0x31646a(0xe0));}catch(_0x47d504){console[_0x31646a(0xdc)](_0x31646a(0xe5),_0x47d504);throw _0x47d504;}}async[a38_0x1ec4cb(0x8c)](_0x2ca234){const _0x3123ac=a38_0x1ec4cb,_0x10ac13=_0x2ca234[_0x3123ac(0x8e)]();if(_0x10ac13===_0x3123ac(0xa1))return 0x1;try{const _0x52503a=await database_1['default']['currencyRate'][_0x3123ac(0xf0)]({'where':{'currency':_0x10ac13}});if(!_0x52503a)return console[_0x3123ac(0xc9)](_0x3123ac(0xb6)+_0x2ca234+',\x20using\x201\x20as\x20fallback'),0x1;return _0x52503a[_0x3123ac(0xc2)];}catch(_0x33633b){return console[_0x3123ac(0xdc)](_0x3123ac(0xde)+_0x2ca234+':',_0x33633b),0x1;}}async[a38_0x1ec4cb(0x91)](_0x2c74b5,_0x528802){const _0x594e48=a38_0x1ec4cb,_0x26b469=_0x528802['toLowerCase']();if(_0x26b469==='usdt'){const _0x41bcf9=_0x2c74b5*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x594e48(0xfe)]('💱\x20Applied\x20'+this[_0x594e48(0xea)]+_0x594e48(0xe6)+_0x2c74b5+'\x20USDT\x20=\x20'+_0x41bcf9[_0x594e48(0xdd)](0x6)+'\x20USDT'),_0x41bcf9;}try{const _0x1fa642=await this[_0x594e48(0x8c)](_0x26b469),_0x31a9e1=_0x2c74b5/_0x1fa642,_0x347821=_0x31a9e1*(0x1+this[_0x594e48(0xea)]/0x64);return console[_0x594e48(0xfe)]('💱\x20Converted\x20'+_0x2c74b5+'\x20'+_0x528802[_0x594e48(0x97)]()+'\x20to\x20'+_0x31a9e1[_0x594e48(0xdd)](0x6)+'\x20USDT,\x20with\x20'+this[_0x594e48(0xea)]+'%\x20markup\x20=\x20'+_0x347821[_0x594e48(0xdd)](0x6)+_0x594e48(0x9f)+_0x1fa642+')'),_0x347821;}catch(_0x153785){console['error'](_0x594e48(0xd5)+_0x2c74b5+'\x20'+_0x528802+_0x594e48(0xad),_0x153785);const _0x565fb1=_0x2c74b5*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x565fb1;}}async['convertMultipleToUSDT'](_0x130a37){let _0x44983f=0x0;for(const {amount:_0x12a9ff,currency:_0x585d5c}of _0x130a37){const _0x38b95c=await this['convertToUSDT'](_0x12a9ff,_0x585d5c);_0x44983f+=_0x38b95c;}return _0x44983f;}async[a38_0x1ec4cb(0xaa)](){const _0x255b64=a38_0x1ec4cb;try{const _0x5da78b=await database_1['default'][_0x255b64(0xd6)][_0x255b64(0xba)]({'select':{'currency':!![],'rate':!![]}}),_0xd0ad53={'usdt':0x1};return _0x5da78b['forEach'](_0x5e8e5b=>{const _0x439a63=_0x255b64;_0xd0ad53[_0x5e8e5b[_0x439a63(0x90)]]=_0x5e8e5b[_0x439a63(0xc2)];}),_0xd0ad53;}catch(_0x1a0eff){return console[_0x255b64(0xdc)](_0x255b64(0xbb),_0x1a0eff),{'usdt':0x1};}}async[a38_0x1ec4cb(0xd4)](){const _0x16506e=a38_0x1ec4cb;try{const [_0x2264da,_0x49bcb5,_0x2d241d]=await Promise[_0x16506e(0xbf)]([database_1[_0x16506e(0xeb)]['currencyRate']['count'](),database_1[_0x16506e(0xeb)]['currencyRate'][_0x16506e(0xc3)]({'orderBy':{'updatedAt':_0x16506e(0xb5)},'select':{'updatedAt':!![]}}),database_1[_0x16506e(0xeb)][_0x16506e(0xd6)][_0x16506e(0xc3)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2264da,'lastUpdated':_0x49bcb5?.[_0x16506e(0xee)]||null,'oldestRate':_0x2d241d?.[_0x16506e(0xee)]||null,'markupPercentage':this[_0x16506e(0xea)]};}catch(_0x2092e3){return console[_0x16506e(0xdc)](_0x16506e(0xda),_0x2092e3),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x16506e(0xea)]};}}[a38_0x1ec4cb(0xa3)](){const _0x407327=a38_0x1ec4cb;return this[_0x407327(0xea)];}}exports[a38_0x1ec4cb(0x95)]=CurrencyService,exports[a38_0x1ec4cb(0xa7)]=new CurrencyService();