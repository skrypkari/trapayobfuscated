'use strict';const a38_0x40bea6=a38_0x2844;(function(_0x17aba7,_0x2aedc9){const _0x3b1d93=a38_0x2844,_0xfd59d5=_0x17aba7();while(!![]){try{const _0x5c2d12=-parseInt(_0x3b1d93(0xc8))/0x1+-parseInt(_0x3b1d93(0x8f))/0x2+-parseInt(_0x3b1d93(0xb8))/0x3+parseInt(_0x3b1d93(0x9b))/0x4+parseInt(_0x3b1d93(0xd7))/0x5+parseInt(_0x3b1d93(0xe9))/0x6+-parseInt(_0x3b1d93(0xdc))/0x7;if(_0x5c2d12===_0x2aedc9)break;else _0xfd59d5['push'](_0xfd59d5['shift']());}catch(_0xee8f30){_0xfd59d5['push'](_0xfd59d5['shift']());}}}(a38_0x5026,0x21be4));var __importDefault=this&&this[a38_0x40bea6(0xac)]||function(_0x41f61d){const _0x3c4fb8=a38_0x40bea6;return _0x41f61d&&_0x41f61d[_0x3c4fb8(0xa5)]?_0x41f61d:{'default':_0x41f61d};};function a38_0x5026(){const _0x3a3149=['ltc','getCurrencyRate','Error\x20getting\x20all\x20rates:','127512JDlsoN','lkr','MARKUP_PERCENTAGE','catch','btc','xrp','php','toUpperCase','sar','getMarkupPercentage','ars','allSettled','\x20USDT,\x20with\x20','default','updateCurrencyRates','currency','47563NpoOnl','pln','CURRENCIES','defineProperty','link','entries','pkr','cny','%\x20markup\x20to\x20','error','try','💱\x20Applied\x20','bdt','mmk','length','1007450mrCKLa','CurrencyService','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','bnb','bch','490350inRBDT','\x20to\x20USDT:','✅\x20Currency\x20rates\x20updated\x20successfully','rate','chf','updateInterval','Error\x20converting\x20','ngn','%\x20markup\x20=\x20','krw','kwd','getRatesStatus','log','1083198mLyHOn','convertToUSDT','rub','xlm','usd','dkk','updatedAt','count','gel','huf','all','nok','gbp','No\x20rate\x20found\x20for\x20currency:\x20','\x20USDT','statusText','jpy','czk','hkd','getAllRates','COINGECKO_URL','upsert','mxn','\x20USDT\x20=\x20','sats','twd',',\x20using\x201\x20as\x20fallback','warn','findUnique','Periodic\x20currency\x20rates\x20update\x20failed:','496288SYtgZn','keys','xag','Failed\x20to\x20update\x20rate\x20for\x20','bhd','tether','dot','toFixed','currencyRate','application/json','Error\x20getting\x20rate\x20for\x20currency\x20','usdt','657800nuWEgv','clp','idr','TesSoft\x20Payment\x20System/1.0','desc','vnd','stopPeriodicUpdates','📊\x20Received\x20rates\x20for\x20','currencyService','thb','__esModule','?ids=tether&vs_currencies=','yfi','myr','sgd','toLowerCase','convertMultipleToUSDT','__importDefault','Error\x20getting\x20rates\x20status:','❌\x20Failed\x20to\x20update\x20currency\x20rates:','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','map','\x20currencies','CoinGecko\x20API\x20error:\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','startPeriodicUpdates'];a38_0x5026=function(){return _0x3a3149;};return a38_0x5026();}Object[a38_0x40bea6(0xcb)](exports,a38_0x40bea6(0xa5),{'value':!![]}),exports['currencyService']=exports[a38_0x40bea6(0xd8)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a38_0x2844(_0x3e897e,_0x68769d){const _0x502656=a38_0x5026();return a38_0x2844=function(_0x2844df,_0x28de8f){_0x2844df=_0x2844df-0x7b;let _0x5ef9b2=_0x502656[_0x2844df];return _0x5ef9b2;},a38_0x2844(_0x3e897e,_0x68769d);}class CurrencyService{constructor(){const _0x1f5978=a38_0x40bea6;this[_0x1f5978(0x85)]='https://api.coingecko.com/api/v3/simple/price',this[_0x1f5978(0xca)]=[_0x1f5978(0xbc),'eth',_0x1f5978(0xb5),_0x1f5978(0xdb),_0x1f5978(0xda),'eos',_0x1f5978(0xbd),_0x1f5978(0xec),_0x1f5978(0xcc),_0x1f5978(0x95),_0x1f5978(0xa7),_0x1f5978(0xed),'aed',_0x1f5978(0xc2),'aud',_0x1f5978(0xd4),_0x1f5978(0x93),'bmd','brl','cad',_0x1f5978(0xe0),_0x1f5978(0x9c),_0x1f5978(0xcf),_0x1f5978(0x82),_0x1f5978(0xee),'eur',_0x1f5978(0x7d),_0x1f5978(0xf1),_0x1f5978(0x83),_0x1f5978(0xf2),_0x1f5978(0x9d),'ils','inr',_0x1f5978(0x81),_0x1f5978(0xe5),_0x1f5978(0xe6),_0x1f5978(0xb9),_0x1f5978(0xd5),_0x1f5978(0x87),_0x1f5978(0xa8),_0x1f5978(0xe3),_0x1f5978(0x7c),'nzd',_0x1f5978(0xbe),_0x1f5978(0xce),_0x1f5978(0xc9),_0x1f5978(0xeb),_0x1f5978(0xc0),'sek',_0x1f5978(0xa9),_0x1f5978(0xa4),_0x1f5978(0xd2),_0x1f5978(0x8a),'uah','vef',_0x1f5978(0xa0),'zar','xdr',_0x1f5978(0x91),'xau','bits',_0x1f5978(0x89)],this[_0x1f5978(0xe1)]=null,this[_0x1f5978(0xba)]=0x3,this[_0x1f5978(0xb4)]();}[a38_0x40bea6(0xb4)](){const _0x4cc729=a38_0x40bea6;this[_0x4cc729(0xc6)]()[_0x4cc729(0xbb)](_0x383fd5=>{const _0x4665f7=_0x4cc729;console[_0x4665f7(0xd1)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x383fd5);}),this['updateInterval']=setInterval(async()=>{const _0x5ad5cd=_0x4cc729;try{await this[_0x5ad5cd(0xc6)]();}catch(_0x2c852f){console[_0x5ad5cd(0xd1)](_0x5ad5cd(0x8e),_0x2c852f);}},0x3c*0x3c*0x3e8),console[_0x4cc729(0xe8)](_0x4cc729(0xb3));}[a38_0x40bea6(0xa1)](){const _0x537512=a38_0x40bea6;this[_0x537512(0xe1)]&&(clearInterval(this[_0x537512(0xe1)]),this['updateInterval']=null,console[_0x537512(0xe8)](_0x537512(0xd9)));}async['updateCurrencyRates'](){const _0x763ad7=a38_0x40bea6;try{console[_0x763ad7(0xe8)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x3616f6=this[_0x763ad7(0xca)]['join'](','),_0x43aa4e=this[_0x763ad7(0x85)]+_0x763ad7(0xa6)+_0x3616f6,_0x327c69=await fetch(_0x43aa4e,{'headers':{'Accept':_0x763ad7(0x98),'User-Agent':_0x763ad7(0x9e)}});if(!_0x327c69['ok'])throw new Error(_0x763ad7(0xb2)+_0x327c69['status']+'\x20'+_0x327c69[_0x763ad7(0x80)]);const _0x6b4cc7=await _0x327c69['json']();if(!_0x6b4cc7[_0x763ad7(0x94)])throw new Error(_0x763ad7(0xaf));const _0x2cd75a=_0x6b4cc7[_0x763ad7(0x94)];console['log'](_0x763ad7(0xa2)+Object[_0x763ad7(0x90)](_0x2cd75a)[_0x763ad7(0xd6)]+_0x763ad7(0xb1));const _0x17d9bd=Object[_0x763ad7(0xcd)](_0x2cd75a)[_0x763ad7(0xb0)](async([_0x373af1,_0x50f62d])=>{const _0x35f195=_0x763ad7;try{await database_1[_0x35f195(0xc5)][_0x35f195(0x97)][_0x35f195(0x86)]({'where':{'currency':_0x373af1[_0x35f195(0xaa)]()},'update':{'rate':_0x50f62d},'create':{'currency':_0x373af1[_0x35f195(0xaa)](),'rate':_0x50f62d}});}catch(_0x49bdd1){console[_0x35f195(0xd1)](_0x35f195(0x92)+_0x373af1+':',_0x49bdd1);}});await Promise[_0x763ad7(0xc3)](_0x17d9bd),console[_0x763ad7(0xe8)](_0x763ad7(0xde));}catch(_0x2408f9){console[_0x763ad7(0xd1)](_0x763ad7(0xae),_0x2408f9);throw _0x2408f9;}}async[a38_0x40bea6(0xb6)](_0xba430){const _0x36baa9=a38_0x40bea6,_0x407868=_0xba430[_0x36baa9(0xaa)]();if(_0x407868===_0x36baa9(0x9a))return 0x1;try{const _0x91312a=await database_1[_0x36baa9(0xc5)][_0x36baa9(0x97)][_0x36baa9(0x8d)]({'where':{'currency':_0x407868}});if(!_0x91312a)return console[_0x36baa9(0x8c)](_0x36baa9(0x7e)+_0xba430+_0x36baa9(0x8b)),0x1;return _0x91312a['rate'];}catch(_0x266dee){return console[_0x36baa9(0xd1)](_0x36baa9(0x99)+_0xba430+':',_0x266dee),0x1;}}async[a38_0x40bea6(0xea)](_0x41a490,_0x12dae6){const _0x42ddb3=a38_0x40bea6,_0x5ecca6=_0x12dae6[_0x42ddb3(0xaa)]();if(_0x5ecca6===_0x42ddb3(0x9a)){const _0x5e4610=_0x41a490*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x42ddb3(0xd3)+this['MARKUP_PERCENTAGE']+_0x42ddb3(0xd0)+_0x41a490+_0x42ddb3(0x88)+_0x5e4610[_0x42ddb3(0x96)](0x6)+_0x42ddb3(0x7f)),_0x5e4610;}try{const _0x270ce0=await this[_0x42ddb3(0xb6)](_0x5ecca6),_0x526984=_0x41a490/_0x270ce0,_0x501ceb=_0x526984*(0x1+this[_0x42ddb3(0xba)]/0x64);return console[_0x42ddb3(0xe8)]('💱\x20Converted\x20'+_0x41a490+'\x20'+_0x12dae6[_0x42ddb3(0xbf)]()+'\x20to\x20'+_0x526984[_0x42ddb3(0x96)](0x6)+_0x42ddb3(0xc4)+this[_0x42ddb3(0xba)]+_0x42ddb3(0xe4)+_0x501ceb[_0x42ddb3(0x96)](0x6)+'\x20USDT\x20(rate:\x20'+_0x270ce0+')'),_0x501ceb;}catch(_0x2bc712){console['error'](_0x42ddb3(0xe2)+_0x41a490+'\x20'+_0x12dae6+_0x42ddb3(0xdd),_0x2bc712);const _0x2c8891=_0x41a490*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x2c8891;}}async[a38_0x40bea6(0xab)](_0x5b711a){const _0x49bf93=a38_0x40bea6;let _0x1a0586=0x0;for(const {amount:_0x5e11e6,currency:_0x30e2e4}of _0x5b711a){const _0x4a1d61=await this[_0x49bf93(0xea)](_0x5e11e6,_0x30e2e4);_0x1a0586+=_0x4a1d61;}return _0x1a0586;}async[a38_0x40bea6(0x84)](){const _0x1fea60=a38_0x40bea6;try{const _0xbd8c56=await database_1[_0x1fea60(0xc5)][_0x1fea60(0x97)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x3fdd2f={'usdt':0x1};return _0xbd8c56['forEach'](_0x1f1b01=>{const _0x5248a6=_0x1fea60;_0x3fdd2f[_0x1f1b01[_0x5248a6(0xc7)]]=_0x1f1b01[_0x5248a6(0xdf)];}),_0x3fdd2f;}catch(_0x7ff27b){return console['error'](_0x1fea60(0xb7),_0x7ff27b),{'usdt':0x1};}}async[a38_0x40bea6(0xe7)](){const _0x4a42a0=a38_0x40bea6;try{const [_0x3d29b2,_0x4993d6,_0x3d8634]=await Promise[_0x4a42a0(0x7b)]([database_1[_0x4a42a0(0xc5)]['currencyRate'][_0x4a42a0(0xf0)](),database_1[_0x4a42a0(0xc5)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x4a42a0(0x9f)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate']['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3d29b2,'lastUpdated':_0x4993d6?.[_0x4a42a0(0xef)]||null,'oldestRate':_0x3d8634?.['updatedAt']||null,'markupPercentage':this[_0x4a42a0(0xba)]};}catch(_0x105e93){return console[_0x4a42a0(0xd1)](_0x4a42a0(0xad),_0x105e93),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x40bea6(0xc1)](){return this['MARKUP_PERCENTAGE'];}}exports[a38_0x40bea6(0xd8)]=CurrencyService,exports[a38_0x40bea6(0xa3)]=new CurrencyService();