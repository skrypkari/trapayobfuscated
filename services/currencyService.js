'use strict';function a36_0x3254(){const _0x38e726=['getMarkupPercentage','twd','Initial\x20currency\x20rates\x20update\x20failed:','rate','count','CURRENCIES','rub','getAllRates','No\x20rate\x20found\x20for\x20currency:\x20','nzd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','getRatesStatus','kwd','\x20USDT,\x20with\x20','currencyRate','getCurrencyRate','37795SurILr','pln','error','💱\x20Applied\x20','TesSoft\x20Payment\x20System/1.0','huf','Error\x20converting\x20','hkd','nok','thb','findFirst','mxn','convertMultipleToUSDT','defineProperty','CurrencyService','forEach','php','default','ars','tether','Error\x20getting\x20rates\x20status:','updatedAt','aed','inr','Failed\x20to\x20update\x20rate\x20for\x20','ngn','bdt','aud','updateInterval','log','toLowerCase','czk','bmd','xdr','dot','\x20USDT','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','toUpperCase','2006544XjcVlO','dkk','status','816914IqFgOH','bhd','btc','212429mCXXQe','21878253ioQvhJ','bits','xag','xau','cad','sek','currencyService','https://api.coingecko.com/api/v3/simple/price','\x20to\x20USDT:','map','bch','brl','asc','112okABem','catch','mmk','1629842GihUhK','gbp','COINGECKO_URL','❌\x20Failed\x20to\x20update\x20currency\x20rates:','startPeriodicUpdates','426wCKboF','all','vnd','pkr','lkr','sgd',',\x20using\x201\x20as\x20fallback','eth','%\x20markup\x20to\x20','length','uah','xlm','application/json','%\x20markup\x20=\x20','link','\x20currencies','toFixed','bnb','desc','MARKUP_PERCENTAGE','usdt','\x20USDT\x20=\x20','statusText','convertToUSDT','vef','updateCurrencyRates','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','jpy','try','1746060ZFcbUo','__esModule','gel','upsert','../config/database','clp','eur','chf','findUnique','📊\x20Received\x20rates\x20for\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','Error\x20getting\x20rate\x20for\x20currency\x20'];a36_0x3254=function(){return _0x38e726;};return a36_0x3254();}const a36_0x141d2e=a36_0x2235;(function(_0x2830de,_0x5be543){const _0x524db5=a36_0x2235,_0x5374d2=_0x2830de();while(!![]){try{const _0x128b8e=parseInt(_0x524db5(0x178))/0x1+parseInt(_0x524db5(0x18c))/0x2+parseInt(_0x524db5(0x175))/0x3+parseInt(_0x524db5(0x133))/0x4+parseInt(_0x524db5(0x14f))/0x5*(parseInt(_0x524db5(0x191))/0x6)+parseInt(_0x524db5(0x17b))/0x7*(-parseInt(_0x524db5(0x189))/0x8)+-parseInt(_0x524db5(0x17c))/0x9;if(_0x128b8e===_0x5be543)break;else _0x5374d2['push'](_0x5374d2['shift']());}catch(_0x2a15b3){_0x5374d2['push'](_0x5374d2['shift']());}}}(a36_0x3254,0x66140));var __importDefault=this&&this['__importDefault']||function(_0x4ee968){const _0x32699b=a36_0x2235;return _0x4ee968&&_0x4ee968[_0x32699b(0x134)]?_0x4ee968:{'default':_0x4ee968};};Object[a36_0x141d2e(0x15c)](exports,a36_0x141d2e(0x134),{'value':!![]}),exports[a36_0x141d2e(0x182)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a36_0x141d2e(0x137)));function a36_0x2235(_0xc63cb9,_0x8ce7f1){const _0x3254a2=a36_0x3254();return a36_0x2235=function(_0x223567,_0x1b51ad){_0x223567=_0x223567-0x129;let _0xe95f22=_0x3254a2[_0x223567];return _0xe95f22;},a36_0x2235(_0xc63cb9,_0x8ce7f1);}class CurrencyService{constructor(){const _0x329ac0=a36_0x141d2e;this[_0x329ac0(0x18e)]=_0x329ac0(0x183),this[_0x329ac0(0x144)]=[_0x329ac0(0x17a),_0x329ac0(0x198),'ltc',_0x329ac0(0x186),_0x329ac0(0x1a2),'eos','xrp',_0x329ac0(0x19c),_0x329ac0(0x19f),_0x329ac0(0x171),'yfi','usd',_0x329ac0(0x165),_0x329ac0(0x161),_0x329ac0(0x16a),_0x329ac0(0x169),_0x329ac0(0x179),_0x329ac0(0x16f),_0x329ac0(0x187),_0x329ac0(0x180),_0x329ac0(0x13a),_0x329ac0(0x138),'cny',_0x329ac0(0x16e),_0x329ac0(0x176),_0x329ac0(0x139),_0x329ac0(0x18d),_0x329ac0(0x135),_0x329ac0(0x156),_0x329ac0(0x154),'idr','ils',_0x329ac0(0x166),_0x329ac0(0x131),'krw',_0x329ac0(0x14b),_0x329ac0(0x195),_0x329ac0(0x18b),_0x329ac0(0x15a),'myr',_0x329ac0(0x168),_0x329ac0(0x157),_0x329ac0(0x148),_0x329ac0(0x15f),_0x329ac0(0x194),_0x329ac0(0x150),_0x329ac0(0x145),'sar',_0x329ac0(0x181),_0x329ac0(0x196),_0x329ac0(0x158),_0x329ac0(0x132),_0x329ac0(0x140),_0x329ac0(0x19b),_0x329ac0(0x12e),_0x329ac0(0x193),'zar',_0x329ac0(0x170),_0x329ac0(0x17e),_0x329ac0(0x17f),_0x329ac0(0x17d),'sats'],this[_0x329ac0(0x16b)]=null,this['MARKUP_PERCENTAGE']=0x3,this['startPeriodicUpdates']();}[a36_0x141d2e(0x190)](){const _0x54c004=a36_0x141d2e;this[_0x54c004(0x12f)]()[_0x54c004(0x18a)](_0x369de6=>{const _0x533bdd=_0x54c004;console[_0x533bdd(0x151)](_0x533bdd(0x141),_0x369de6);}),this['updateInterval']=setInterval(async()=>{const _0x49e05f=_0x54c004;try{await this['updateCurrencyRates']();}catch(_0xb2aff){console[_0x49e05f(0x151)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0xb2aff);}},0x3c*0x3c*0x3e8),console[_0x54c004(0x16c)](_0x54c004(0x149));}['stopPeriodicUpdates'](){const _0x544917=a36_0x141d2e;this[_0x544917(0x16b)]&&(clearInterval(this[_0x544917(0x16b)]),this['updateInterval']=null,console[_0x544917(0x16c)](_0x544917(0x173)));}async[a36_0x141d2e(0x12f)](){const _0x2e760c=a36_0x141d2e;try{console[_0x2e760c(0x16c)](_0x2e760c(0x130));const _0x43feff=this['CURRENCIES']['join'](','),_0x1a2f3b=this[_0x2e760c(0x18e)]+'?ids=tether&vs_currencies='+_0x43feff,_0x254f55=await fetch(_0x1a2f3b,{'headers':{'Accept':_0x2e760c(0x19d),'User-Agent':_0x2e760c(0x153)}});if(!_0x254f55['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x254f55[_0x2e760c(0x177)]+'\x20'+_0x254f55[_0x2e760c(0x12c)]);const _0x363bde=await _0x254f55['json']();if(!_0x363bde[_0x2e760c(0x162)])throw new Error(_0x2e760c(0x13d));const _0x42ae8e=_0x363bde['tether'];console[_0x2e760c(0x16c)](_0x2e760c(0x13c)+Object['keys'](_0x42ae8e)[_0x2e760c(0x19a)]+_0x2e760c(0x1a0));const _0x2067ad=Object['entries'](_0x42ae8e)[_0x2e760c(0x185)](async([_0x32b774,_0x1a9e87])=>{const _0x47960e=_0x2e760c;try{await database_1['default'][_0x47960e(0x14d)][_0x47960e(0x136)]({'where':{'currency':_0x32b774['toLowerCase']()},'update':{'rate':_0x1a9e87},'create':{'currency':_0x32b774[_0x47960e(0x16d)](),'rate':_0x1a9e87}});}catch(_0x3834d3){console[_0x47960e(0x151)](_0x47960e(0x167)+_0x32b774+':',_0x3834d3);}});await Promise['allSettled'](_0x2067ad),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4604c9){console[_0x2e760c(0x151)](_0x2e760c(0x18f),_0x4604c9);throw _0x4604c9;}}async['getCurrencyRate'](_0x47beaa){const _0x4dc2c5=a36_0x141d2e,_0x47bc4f=_0x47beaa[_0x4dc2c5(0x16d)]();if(_0x47bc4f===_0x4dc2c5(0x12a))return 0x1;try{const _0x4981d6=await database_1[_0x4dc2c5(0x160)][_0x4dc2c5(0x14d)][_0x4dc2c5(0x13b)]({'where':{'currency':_0x47bc4f}});if(!_0x4981d6)return console['warn'](_0x4dc2c5(0x147)+_0x47beaa+_0x4dc2c5(0x197)),0x1;return _0x4981d6[_0x4dc2c5(0x142)];}catch(_0x30a931){return console[_0x4dc2c5(0x151)](_0x4dc2c5(0x13e)+_0x47beaa+':',_0x30a931),0x1;}}async['convertToUSDT'](_0x39b2e3,_0x551afc){const _0x6f3369=a36_0x141d2e,_0x47b1fc=_0x551afc[_0x6f3369(0x16d)]();if(_0x47b1fc===_0x6f3369(0x12a)){const _0x3a4067=_0x39b2e3*(0x1+this[_0x6f3369(0x129)]/0x64);return console['log'](_0x6f3369(0x152)+this['MARKUP_PERCENTAGE']+_0x6f3369(0x199)+_0x39b2e3+_0x6f3369(0x12b)+_0x3a4067[_0x6f3369(0x1a1)](0x6)+_0x6f3369(0x172)),_0x3a4067;}try{const _0xb730b9=await this[_0x6f3369(0x14e)](_0x47b1fc),_0x35c4d4=_0x39b2e3/_0xb730b9,_0x44b4d4=_0x35c4d4*(0x1+this[_0x6f3369(0x129)]/0x64);return console[_0x6f3369(0x16c)]('💱\x20Converted\x20'+_0x39b2e3+'\x20'+_0x551afc[_0x6f3369(0x174)]()+'\x20to\x20'+_0x35c4d4[_0x6f3369(0x1a1)](0x6)+_0x6f3369(0x14c)+this[_0x6f3369(0x129)]+_0x6f3369(0x19e)+_0x44b4d4[_0x6f3369(0x1a1)](0x6)+'\x20USDT\x20(rate:\x20'+_0xb730b9+')'),_0x44b4d4;}catch(_0x51770e){console[_0x6f3369(0x151)](_0x6f3369(0x155)+_0x39b2e3+'\x20'+_0x551afc+_0x6f3369(0x184),_0x51770e);const _0x1b4cf1=_0x39b2e3*(0x1+this[_0x6f3369(0x129)]/0x64);return _0x1b4cf1;}}async[a36_0x141d2e(0x15b)](_0x2b8329){const _0x19b748=a36_0x141d2e;let _0x5b9fd7=0x0;for(const {amount:_0x53d558,currency:_0x3f5a06}of _0x2b8329){const _0xf6f725=await this[_0x19b748(0x12d)](_0x53d558,_0x3f5a06);_0x5b9fd7+=_0xf6f725;}return _0x5b9fd7;}async[a36_0x141d2e(0x146)](){const _0x47c2fb=a36_0x141d2e;try{const _0x1a3ebf=await database_1['default'][_0x47c2fb(0x14d)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x2c261b={'usdt':0x1};return _0x1a3ebf[_0x47c2fb(0x15e)](_0x5c39d6=>{const _0x33d236=_0x47c2fb;_0x2c261b[_0x5c39d6['currency']]=_0x5c39d6[_0x33d236(0x142)];}),_0x2c261b;}catch(_0x4d35d9){return console[_0x47c2fb(0x151)]('Error\x20getting\x20all\x20rates:',_0x4d35d9),{'usdt':0x1};}}async[a36_0x141d2e(0x14a)](){const _0x33b15d=a36_0x141d2e;try{const [_0x34aefa,_0x3ba24f,_0x4fa306]=await Promise[_0x33b15d(0x192)]([database_1[_0x33b15d(0x160)]['currencyRate'][_0x33b15d(0x143)](),database_1[_0x33b15d(0x160)][_0x33b15d(0x14d)][_0x33b15d(0x159)]({'orderBy':{'updatedAt':_0x33b15d(0x1a3)},'select':{'updatedAt':!![]}}),database_1[_0x33b15d(0x160)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x33b15d(0x188)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x34aefa,'lastUpdated':_0x3ba24f?.[_0x33b15d(0x164)]||null,'oldestRate':_0x4fa306?.[_0x33b15d(0x164)]||null,'markupPercentage':this[_0x33b15d(0x129)]};}catch(_0x351672){return console[_0x33b15d(0x151)](_0x33b15d(0x163),_0x351672),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x33b15d(0x129)]};}}[a36_0x141d2e(0x13f)](){const _0x1c7b70=a36_0x141d2e;return this[_0x1c7b70(0x129)];}}exports[a36_0x141d2e(0x15d)]=CurrencyService,exports[a36_0x141d2e(0x182)]=new CurrencyService();