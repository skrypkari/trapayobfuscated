'use strict';const a41_0x3d31e4=a41_0x1594;function a41_0x1594(_0x18953a,_0x5432bc){const _0x2b79c2=a41_0x2b79();return a41_0x1594=function(_0x159443,_0x95d9ed){_0x159443=_0x159443-0x126;let _0xcdba65=_0x2b79c2[_0x159443];return _0xcdba65;},a41_0x1594(_0x18953a,_0x5432bc);}function a41_0x2b79(){const _0x46dfec=['updateCurrencyRates','No\x20rate\x20found\x20for\x20currency:\x20','sar','entries','getRatesStatus','myr','brl','__esModule','\x20USDT','../config/database','join','125upcXuS','?ids=tether&vs_currencies=','sats','MARKUP_PERCENTAGE','default','thb','yfi','idr','catch','findFirst','updateInterval','hkd','toFixed','defineProperty','application/json','✅\x20Currency\x20rates\x20updated\x20successfully','link','Payment\x20System/1.0','toUpperCase','usd','2790zlivWi','ngn','%\x20markup\x20=\x20','huf','\x20USDT\x20=\x20','startPeriodicUpdates','2527434dLcAIA','json','bnb','updatedAt','xlm','usdt','456564xICytA','\x20to\x20USDT:','rub','eth','Failed\x20to\x20update\x20rate\x20for\x20','1994pOfRiR','Error\x20converting\x20','php','\x20to\x20','getMarkupPercentage','convertToUSDT','twd','xdr','findUnique','38277stLlIe','cad','vnd','status','ars','tether','asc','all','xag','%\x20markup\x20to\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','convertMultipleToUSDT','bhd','\x20USDT,\x20with\x20','upsert','Error\x20getting\x20rates\x20status:','kwd','11711696EYGMeq','eur','lkr','pln','COINGECKO_URL','statusText','1384TvBfAk','29719349VPkAJm','toLowerCase','eos','xrp','keys','currencyService','log','129948foBLyO','CurrencyService','cny','ltc','currencyRate',',\x20using\x201\x20as\x20fallback','btc','rate','forEach','ils','21PPieLT','❌\x20Failed\x20to\x20update\x20currency\x20rates:','getCurrencyRate','aed','gbp','zar','findMany','Error\x20getting\x20rate\x20for\x20currency\x20','💱\x20Applied\x20','📊\x20Received\x20rates\x20for\x20','clp','allSettled','krw','uah','error','bits','https://api.coingecko.com/api/v3/simple/price','currency','CURRENCIES','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','inr','desc','mmk'];a41_0x2b79=function(){return _0x46dfec;};return a41_0x2b79();}(function(_0x17387b,_0x5bbd27){const _0xb58399=a41_0x1594,_0x2429eb=_0x17387b();while(!![]){try{const _0x5061f2=-parseInt(_0xb58399(0x19e))/0x1*(parseInt(_0xb58399(0x145))/0x2)+-parseInt(_0xb58399(0x193))/0x3+parseInt(_0xb58399(0x14d))/0x4*(parseInt(_0xb58399(0x179))/0x5)+parseInt(_0xb58399(0x199))/0x6*(-parseInt(_0xb58399(0x157))/0x7)+-parseInt(_0xb58399(0x13f))/0x8+parseInt(_0xb58399(0x12e))/0x9*(parseInt(_0xb58399(0x18d))/0xa)+parseInt(_0xb58399(0x146))/0xb;if(_0x5061f2===_0x5bbd27)break;else _0x2429eb['push'](_0x2429eb['shift']());}catch(_0x667495){_0x2429eb['push'](_0x2429eb['shift']());}}}(a41_0x2b79,0xbfe1f));var __importDefault=this&&this['__importDefault']||function(_0x5cbc94){const _0x2733c9=a41_0x1594;return _0x5cbc94&&_0x5cbc94[_0x2733c9(0x175)]?_0x5cbc94:{'default':_0x5cbc94};};Object[a41_0x3d31e4(0x186)](exports,a41_0x3d31e4(0x175),{'value':!![]}),exports['currencyService']=exports[a41_0x3d31e4(0x14e)]=void 0x0;const database_1=__importDefault(require(a41_0x3d31e4(0x177)));class CurrencyService{constructor(){const _0x291d79=a41_0x3d31e4;this[_0x291d79(0x143)]=_0x291d79(0x167),this['CURRENCIES']=[_0x291d79(0x153),_0x291d79(0x19c),_0x291d79(0x150),'bch',_0x291d79(0x195),_0x291d79(0x148),_0x291d79(0x149),_0x291d79(0x197),_0x291d79(0x189),'dot',_0x291d79(0x17f),_0x291d79(0x18c),_0x291d79(0x15a),_0x291d79(0x132),'aud','bdt',_0x291d79(0x13a),'bmd',_0x291d79(0x174),_0x291d79(0x12f),'chf',_0x291d79(0x161),_0x291d79(0x14f),'czk','dkk',_0x291d79(0x140),_0x291d79(0x15b),'gel',_0x291d79(0x184),_0x291d79(0x190),_0x291d79(0x180),_0x291d79(0x156),_0x291d79(0x16b),'jpy',_0x291d79(0x163),_0x291d79(0x13e),_0x291d79(0x141),_0x291d79(0x16d),'mxn',_0x291d79(0x173),_0x291d79(0x18e),'nok','nzd',_0x291d79(0x127),'pkr',_0x291d79(0x142),_0x291d79(0x19b),_0x291d79(0x170),'sek','sgd',_0x291d79(0x17e),'try',_0x291d79(0x12b),_0x291d79(0x164),'vef',_0x291d79(0x130),_0x291d79(0x15c),_0x291d79(0x12c),_0x291d79(0x136),'xau',_0x291d79(0x166),_0x291d79(0x17b)],this[_0x291d79(0x183)]=null,this[_0x291d79(0x17c)]=-0x3,this['startPeriodicUpdates']();}[a41_0x3d31e4(0x192)](){const _0x3ec52e=a41_0x3d31e4;this[_0x3ec52e(0x16e)]()[_0x3ec52e(0x181)](_0x561049=>{const _0x158b88=_0x3ec52e;console[_0x158b88(0x165)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x561049);}),this[_0x3ec52e(0x183)]=setInterval(async()=>{try{await this['updateCurrencyRates']();}catch(_0xec1786){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0xec1786);}},0x3c*0x3c*0x3e8),console[_0x3ec52e(0x14c)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x2dfa7e=a41_0x3d31e4;this[_0x2dfa7e(0x183)]&&(clearInterval(this[_0x2dfa7e(0x183)]),this[_0x2dfa7e(0x183)]=null,console[_0x2dfa7e(0x14c)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a41_0x3d31e4(0x16e)](){const _0x36300e=a41_0x3d31e4;try{console[_0x36300e(0x14c)](_0x36300e(0x138));const _0x38a9d1=this[_0x36300e(0x169)][_0x36300e(0x178)](','),_0x3cd23a=this['COINGECKO_URL']+_0x36300e(0x17a)+_0x38a9d1,_0x35caec=await fetch(_0x3cd23a,{'headers':{'Accept':_0x36300e(0x187),'User-Agent':_0x36300e(0x18a)}});if(!_0x35caec['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x35caec[_0x36300e(0x131)]+'\x20'+_0x35caec[_0x36300e(0x144)]);const _0x2924f6=await _0x35caec[_0x36300e(0x194)]();if(!_0x2924f6['tether'])throw new Error(_0x36300e(0x16a));const _0x44acee=_0x2924f6[_0x36300e(0x133)];console['log'](_0x36300e(0x160)+Object[_0x36300e(0x14a)](_0x44acee)['length']+'\x20currencies');const _0x46beac=Object[_0x36300e(0x171)](_0x44acee)['map'](async([_0x1865e2,_0x4e6dc4])=>{const _0x295c93=_0x36300e;try{await database_1[_0x295c93(0x17d)][_0x295c93(0x151)][_0x295c93(0x13c)]({'where':{'currency':_0x1865e2[_0x295c93(0x147)]()},'update':{'rate':_0x4e6dc4},'create':{'currency':_0x1865e2[_0x295c93(0x147)](),'rate':_0x4e6dc4}});}catch(_0x35f1ab){console[_0x295c93(0x165)](_0x295c93(0x19d)+_0x1865e2+':',_0x35f1ab);}});await Promise[_0x36300e(0x162)](_0x46beac),console['log'](_0x36300e(0x188));}catch(_0x7c0ffe){console[_0x36300e(0x165)](_0x36300e(0x158),_0x7c0ffe);throw _0x7c0ffe;}}async[a41_0x3d31e4(0x159)](_0x85324b){const _0x5dc88c=a41_0x3d31e4,_0x3caa35=_0x85324b[_0x5dc88c(0x147)]();if(_0x3caa35==='usdt')return 0x1;try{const _0x2364bd=await database_1[_0x5dc88c(0x17d)][_0x5dc88c(0x151)][_0x5dc88c(0x12d)]({'where':{'currency':_0x3caa35}});if(!_0x2364bd)return console['warn'](_0x5dc88c(0x16f)+_0x85324b+_0x5dc88c(0x152)),0x1;return _0x2364bd[_0x5dc88c(0x154)];}catch(_0x3495ab){return console['error'](_0x5dc88c(0x15e)+_0x85324b+':',_0x3495ab),0x1;}}async[a41_0x3d31e4(0x12a)](_0x3d1dd8,_0x1fb771){const _0x193166=a41_0x3d31e4,_0xec8273=_0x1fb771[_0x193166(0x147)]();if(_0xec8273===_0x193166(0x198)){const _0x12c6dd=_0x3d1dd8*(0x1+this[_0x193166(0x17c)]/0x64);return console[_0x193166(0x14c)](_0x193166(0x15f)+this[_0x193166(0x17c)]+_0x193166(0x137)+_0x3d1dd8+_0x193166(0x191)+_0x12c6dd['toFixed'](0x6)+_0x193166(0x176)),_0x12c6dd;}try{const _0xdb30=await this[_0x193166(0x159)](_0xec8273),_0x1ce76b=_0x3d1dd8/_0xdb30,_0x17c441=_0x1ce76b*(0x1+this[_0x193166(0x17c)]/0x64);return console['log']('💱\x20Converted\x20'+_0x3d1dd8+'\x20'+_0x1fb771[_0x193166(0x18b)]()+_0x193166(0x128)+_0x1ce76b[_0x193166(0x185)](0x6)+_0x193166(0x13b)+this[_0x193166(0x17c)]+_0x193166(0x18f)+_0x17c441[_0x193166(0x185)](0x6)+'\x20USDT\x20(rate:\x20'+_0xdb30+')'),_0x17c441;}catch(_0x12f165){console[_0x193166(0x165)](_0x193166(0x126)+_0x3d1dd8+'\x20'+_0x1fb771+_0x193166(0x19a),_0x12f165);const _0x2b37ca=_0x3d1dd8*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x2b37ca;}}async[a41_0x3d31e4(0x139)](_0xac3298){const _0x3b4613=a41_0x3d31e4;let _0x504cf3=0x0;for(const {amount:_0x21747b,currency:_0x2a1262}of _0xac3298){const _0x449749=await this[_0x3b4613(0x12a)](_0x21747b,_0x2a1262);_0x504cf3+=_0x449749;}return _0x504cf3;}async['getAllRates'](){const _0x1b61d1=a41_0x3d31e4;try{const _0x15afe3=await database_1['default']['currencyRate'][_0x1b61d1(0x15d)]({'select':{'currency':!![],'rate':!![]}}),_0x39d1d3={'usdt':0x1};return _0x15afe3[_0x1b61d1(0x155)](_0x4d466f=>{const _0x4acc8c=_0x1b61d1;_0x39d1d3[_0x4d466f[_0x4acc8c(0x168)]]=_0x4d466f[_0x4acc8c(0x154)];}),_0x39d1d3;}catch(_0x4bbd37){return console[_0x1b61d1(0x165)]('Error\x20getting\x20all\x20rates:',_0x4bbd37),{'usdt':0x1};}}async[a41_0x3d31e4(0x172)](){const _0x5ce70=a41_0x3d31e4;try{const [_0x57a092,_0x3b112d,_0x44e18d]=await Promise[_0x5ce70(0x135)]([database_1[_0x5ce70(0x17d)]['currencyRate']['count'](),database_1[_0x5ce70(0x17d)][_0x5ce70(0x151)][_0x5ce70(0x182)]({'orderBy':{'updatedAt':_0x5ce70(0x16c)},'select':{'updatedAt':!![]}}),database_1[_0x5ce70(0x17d)]['currencyRate'][_0x5ce70(0x182)]({'orderBy':{'updatedAt':_0x5ce70(0x134)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x57a092,'lastUpdated':_0x3b112d?.[_0x5ce70(0x196)]||null,'oldestRate':_0x44e18d?.[_0x5ce70(0x196)]||null,'markupPercentage':this[_0x5ce70(0x17c)]};}catch(_0xd355ff){return console[_0x5ce70(0x165)](_0x5ce70(0x13d),_0xd355ff),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5ce70(0x17c)]};}}[a41_0x3d31e4(0x129)](){return this['MARKUP_PERCENTAGE'];}}exports[a41_0x3d31e4(0x14e)]=CurrencyService,exports[a41_0x3d31e4(0x14b)]=new CurrencyService();