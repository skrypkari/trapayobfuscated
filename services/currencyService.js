'use strict';function a38_0x2652(){const _0x57324c=['updateInterval','xdr','count','hkd','length','aud','5705lXPVoz','warn','ars','mmk','Error\x20converting\x20','currency','\x20USDT,\x20with\x20','Initial\x20currency\x20rates\x20update\x20failed:','application/json','toLowerCase','chf','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','czk','💱\x20Converted\x20','COINGECKO_URL','pkr','idr','tether','entries','49881490muevEc','huf','cny','1330830DenjuJ','%\x20markup\x20=\x20','gbp','inr','Error\x20getting\x20rates\x20status:','findFirst',',\x20using\x201\x20as\x20fallback','eth','log','bch','CURRENCIES','xag','convertToUSDT','Periodic\x20currency\x20rates\x20update\x20failed:','48mhFPYC','bmd','3736ICXbKO','59666dCHLjw','desc','nzd','%\x20markup\x20to\x20','\x20to\x20','toFixed','CurrencyService','\x20currencies','xlm','jpy','getAllRates','zar','\x20USDT','error','statusText','https://api.coingecko.com/api/v3/simple/price','eur','?ids=tether&vs_currencies=','lkr','brl','Failed\x20to\x20update\x20rate\x20for\x20','✅\x20Currency\x20rates\x20updated\x20successfully','btc','896VpIUNL','bnb','\x20USDT\x20=\x20','status','ngn','default','rub','convertMultipleToUSDT','findUnique','No\x20rate\x20found\x20for\x20currency:\x20','5430393QyINkJ','56077JYDmRN','cad','xrp','try','MARKUP_PERCENTAGE','4020870XpxoSI','pln','clp','TesSoft\x20Payment\x20System/1.0','thb','usdt','sgd','upsert','Error\x20getting\x20all\x20rates:','currencyRate','usd','mxn','php','dot','startPeriodicUpdates','ils','join','findMany','myr','bhd','keys','link','catch','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xau','eos','vef','asc','json','currencyService','ltc','💱\x20Applied\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','updateCurrencyRates','__esModule','getCurrencyRate','rate','toUpperCase','all','uah','sek','forEach','sar','updatedAt'];a38_0x2652=function(){return _0x57324c;};return a38_0x2652();}const a38_0x991423=a38_0x9140;(function(_0x339c20,_0x2d697a){const _0xeddb7f=a38_0x9140,_0x3eb1ca=_0x339c20();while(!![]){try{const _0x1d04e5=parseInt(_0xeddb7f(0x124))/0x1*(-parseInt(_0xeddb7f(0x121))/0x2)+parseInt(_0xeddb7f(0x113))/0x3+parseInt(_0xeddb7f(0x123))/0x4*(-parseInt(_0xeddb7f(0xfd))/0x5)+-parseInt(_0xeddb7f(0xcb))/0x6+-parseInt(_0xeddb7f(0xc6))/0x7*(parseInt(_0xeddb7f(0xbb))/0x8)+-parseInt(_0xeddb7f(0xc5))/0x9+parseInt(_0xeddb7f(0x110))/0xa;if(_0x1d04e5===_0x2d697a)break;else _0x3eb1ca['push'](_0x3eb1ca['shift']());}catch(_0xcc05e7){_0x3eb1ca['push'](_0x3eb1ca['shift']());}}}(a38_0x2652,0xba5bf));function a38_0x9140(_0x365360,_0x22d425){const _0x265263=a38_0x2652();return a38_0x9140=function(_0x91405a,_0x3af0d6){_0x91405a=_0x91405a-0xb0;let _0x579bc8=_0x265263[_0x91405a];return _0x579bc8;},a38_0x9140(_0x365360,_0x22d425);}var __importDefault=this&&this['__importDefault']||function(_0x493822){const _0x68f926=a38_0x9140;return _0x493822&&_0x493822[_0x68f926(0xed)]?_0x493822:{'default':_0x493822};};Object['defineProperty'](exports,a38_0x991423(0xed),{'value':!![]}),exports[a38_0x991423(0xe8)]=exports[a38_0x991423(0x12a)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x4ef0b7=a38_0x991423;this[_0x4ef0b7(0x10b)]=_0x4ef0b7(0xb3),this['CURRENCIES']=[_0x4ef0b7(0xba),_0x4ef0b7(0x11a),_0x4ef0b7(0xe9),_0x4ef0b7(0x11c),_0x4ef0b7(0xbc),_0x4ef0b7(0xe4),_0x4ef0b7(0xc8),_0x4ef0b7(0x12c),_0x4ef0b7(0xe0),_0x4ef0b7(0xd8),'yfi',_0x4ef0b7(0xd5),'aed',_0x4ef0b7(0xff),_0x4ef0b7(0xfc),'bdt',_0x4ef0b7(0xde),_0x4ef0b7(0x122),_0x4ef0b7(0xb7),_0x4ef0b7(0xc7),_0x4ef0b7(0x107),_0x4ef0b7(0xcd),_0x4ef0b7(0x112),_0x4ef0b7(0x109),'dkk',_0x4ef0b7(0xb4),_0x4ef0b7(0x115),'gel',_0x4ef0b7(0xfa),_0x4ef0b7(0x111),_0x4ef0b7(0x10d),_0x4ef0b7(0xda),_0x4ef0b7(0x116),_0x4ef0b7(0x12d),'krw','kwd',_0x4ef0b7(0xb6),_0x4ef0b7(0x100),_0x4ef0b7(0xd6),_0x4ef0b7(0xdd),_0x4ef0b7(0xbf),'nok',_0x4ef0b7(0x126),_0x4ef0b7(0xd7),_0x4ef0b7(0x10c),_0x4ef0b7(0xcc),_0x4ef0b7(0xc1),_0x4ef0b7(0xf5),_0x4ef0b7(0xf3),_0x4ef0b7(0xd1),_0x4ef0b7(0xcf),_0x4ef0b7(0xc9),'twd',_0x4ef0b7(0xf2),_0x4ef0b7(0xe5),'vnd',_0x4ef0b7(0x12f),_0x4ef0b7(0xf8),_0x4ef0b7(0x11e),_0x4ef0b7(0xe3),'bits','sats'],this[_0x4ef0b7(0xf7)]=null,this[_0x4ef0b7(0xca)]=0x3,this[_0x4ef0b7(0xd9)]();}['startPeriodicUpdates'](){const _0x3fa8f5=a38_0x991423;this[_0x3fa8f5(0xec)]()[_0x3fa8f5(0xe1)](_0x56b4db=>{const _0x2a06f6=_0x3fa8f5;console[_0x2a06f6(0xb1)](_0x2a06f6(0x104),_0x56b4db);}),this['updateInterval']=setInterval(async()=>{const _0xbc7a1=_0x3fa8f5;try{await this[_0xbc7a1(0xec)]();}catch(_0x975882){console['error'](_0xbc7a1(0x120),_0x975882);}},0x3c*0x3c*0x3e8),console[_0x3fa8f5(0x11b)](_0x3fa8f5(0xe2));}['stopPeriodicUpdates'](){const _0x271bd8=a38_0x991423;this[_0x271bd8(0xf7)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x271bd8(0x11b)](_0x271bd8(0xeb)));}async[a38_0x991423(0xec)](){const _0x231a54=a38_0x991423;try{console[_0x231a54(0x11b)](_0x231a54(0x108));const _0x1bf87b=this[_0x231a54(0x11d)][_0x231a54(0xdb)](','),_0x40485f=this[_0x231a54(0x10b)]+_0x231a54(0xb5)+_0x1bf87b,_0xd112ed=await fetch(_0x40485f,{'headers':{'Accept':_0x231a54(0x105),'User-Agent':_0x231a54(0xce)}});if(!_0xd112ed['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0xd112ed[_0x231a54(0xbe)]+'\x20'+_0xd112ed[_0x231a54(0xb2)]);const _0x5bce22=await _0xd112ed[_0x231a54(0xe7)]();if(!_0x5bce22[_0x231a54(0x10e)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x23bbcf=_0x5bce22[_0x231a54(0x10e)];console[_0x231a54(0x11b)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x231a54(0xdf)](_0x23bbcf)[_0x231a54(0xfb)]+_0x231a54(0x12b));const _0x1d07e0=Object[_0x231a54(0x10f)](_0x23bbcf)['map'](async([_0x5f26a3,_0x4281bf])=>{const _0x313bc0=_0x231a54;try{await database_1[_0x313bc0(0xc0)][_0x313bc0(0xd4)][_0x313bc0(0xd2)]({'where':{'currency':_0x5f26a3[_0x313bc0(0x106)]()},'update':{'rate':_0x4281bf},'create':{'currency':_0x5f26a3[_0x313bc0(0x106)](),'rate':_0x4281bf}});}catch(_0x1550e1){console[_0x313bc0(0xb1)](_0x313bc0(0xb8)+_0x5f26a3+':',_0x1550e1);}});await Promise['allSettled'](_0x1d07e0),console[_0x231a54(0x11b)](_0x231a54(0xb9));}catch(_0x43349c){console[_0x231a54(0xb1)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x43349c);throw _0x43349c;}}async['getCurrencyRate'](_0x1eb893){const _0x206939=a38_0x991423,_0x562330=_0x1eb893[_0x206939(0x106)]();if(_0x562330==='usdt')return 0x1;try{const _0x533962=await database_1[_0x206939(0xc0)][_0x206939(0xd4)][_0x206939(0xc3)]({'where':{'currency':_0x562330}});if(!_0x533962)return console[_0x206939(0xfe)](_0x206939(0xc4)+_0x1eb893+_0x206939(0x119)),0x1;return _0x533962[_0x206939(0xef)];}catch(_0x57803f){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1eb893+':',_0x57803f),0x1;}}async[a38_0x991423(0x11f)](_0x353331,_0x545ce9){const _0x57a3d0=a38_0x991423,_0x558e82=_0x545ce9['toLowerCase']();if(_0x558e82===_0x57a3d0(0xd0)){const _0x317456=_0x353331*(0x1+this[_0x57a3d0(0xca)]/0x64);return console[_0x57a3d0(0x11b)](_0x57a3d0(0xea)+this[_0x57a3d0(0xca)]+_0x57a3d0(0x127)+_0x353331+_0x57a3d0(0xbd)+_0x317456[_0x57a3d0(0x129)](0x6)+_0x57a3d0(0xb0)),_0x317456;}try{const _0x32427a=await this[_0x57a3d0(0xee)](_0x558e82),_0x3990b3=_0x353331/_0x32427a,_0x35e575=_0x3990b3*(0x1+this[_0x57a3d0(0xca)]/0x64);return console[_0x57a3d0(0x11b)](_0x57a3d0(0x10a)+_0x353331+'\x20'+_0x545ce9[_0x57a3d0(0xf0)]()+_0x57a3d0(0x128)+_0x3990b3[_0x57a3d0(0x129)](0x6)+_0x57a3d0(0x103)+this['MARKUP_PERCENTAGE']+_0x57a3d0(0x114)+_0x35e575['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x32427a+')'),_0x35e575;}catch(_0x43eb2d){console['error'](_0x57a3d0(0x101)+_0x353331+'\x20'+_0x545ce9+'\x20to\x20USDT:',_0x43eb2d);const _0x2135a1=_0x353331*(0x1+this[_0x57a3d0(0xca)]/0x64);return _0x2135a1;}}async[a38_0x991423(0xc2)](_0x32f3c3){const _0x5c6883=a38_0x991423;let _0x40e706=0x0;for(const {amount:_0x25df9c,currency:_0x1c4335}of _0x32f3c3){const _0x5ad04a=await this[_0x5c6883(0x11f)](_0x25df9c,_0x1c4335);_0x40e706+=_0x5ad04a;}return _0x40e706;}async[a38_0x991423(0x12e)](){const _0x3be0f8=a38_0x991423;try{const _0x408c68=await database_1[_0x3be0f8(0xc0)][_0x3be0f8(0xd4)][_0x3be0f8(0xdc)]({'select':{'currency':!![],'rate':!![]}}),_0x259be2={'usdt':0x1};return _0x408c68[_0x3be0f8(0xf4)](_0x54fe50=>{const _0x50f62f=_0x3be0f8;_0x259be2[_0x54fe50[_0x50f62f(0x102)]]=_0x54fe50[_0x50f62f(0xef)];}),_0x259be2;}catch(_0xd0645){return console['error'](_0x3be0f8(0xd3),_0xd0645),{'usdt':0x1};}}async['getRatesStatus'](){const _0x42bb1c=a38_0x991423;try{const [_0x5bddaf,_0x462453,_0x5ace77]=await Promise[_0x42bb1c(0xf1)]([database_1[_0x42bb1c(0xc0)][_0x42bb1c(0xd4)][_0x42bb1c(0xf9)](),database_1[_0x42bb1c(0xc0)][_0x42bb1c(0xd4)][_0x42bb1c(0x118)]({'orderBy':{'updatedAt':_0x42bb1c(0x125)},'select':{'updatedAt':!![]}}),database_1[_0x42bb1c(0xc0)][_0x42bb1c(0xd4)]['findFirst']({'orderBy':{'updatedAt':_0x42bb1c(0xe6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5bddaf,'lastUpdated':_0x462453?.[_0x42bb1c(0xf6)]||null,'oldestRate':_0x5ace77?.[_0x42bb1c(0xf6)]||null,'markupPercentage':this[_0x42bb1c(0xca)]};}catch(_0x5b3f11){return console['error'](_0x42bb1c(0x117),_0x5b3f11),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x42bb1c(0xca)]};}}['getMarkupPercentage'](){const _0x24522c=a38_0x991423;return this[_0x24522c(0xca)];}}exports[a38_0x991423(0x12a)]=CurrencyService,exports[a38_0x991423(0xe8)]=new CurrencyService();