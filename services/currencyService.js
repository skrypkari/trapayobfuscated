'use strict';const a41_0x271249=a41_0x24c7;(function(_0x28e5df,_0x1a1b51){const _0x259d9f=a41_0x24c7,_0x4c6153=_0x28e5df();while(!![]){try{const _0x45a0e1=parseInt(_0x259d9f(0x1ce))/0x1+parseInt(_0x259d9f(0x21a))/0x2*(-parseInt(_0x259d9f(0x200))/0x3)+parseInt(_0x259d9f(0x1c1))/0x4+parseInt(_0x259d9f(0x1dc))/0x5+-parseInt(_0x259d9f(0x1d6))/0x6+parseInt(_0x259d9f(0x209))/0x7+parseInt(_0x259d9f(0x1f2))/0x8*(parseInt(_0x259d9f(0x19e))/0x9);if(_0x45a0e1===_0x1a1b51)break;else _0x4c6153['push'](_0x4c6153['shift']());}catch(_0x2d4b65){_0x4c6153['push'](_0x4c6153['shift']());}}}(a41_0x3747,0x221d8));function a41_0x3747(){const _0x5ad062=['\x20to\x20USDT:','warn','vef','log','entries','gel','allSettled','clp','622972GUBpMj','czk','vnd','__esModule','sats','updateCurrencyRates','php','\x20to\x20','%\x20markup\x20=\x20','currencyRate','btc','\x20USDT\x20=\x20','chf','toFixed','?ids=tether&vs_currencies=','rate','usd','2018ESftEk','../config/database','mxn','findFirst','1089XhIWHk','join','xlm','MARKUP_PERCENTAGE','zar','getMarkupPercentage','Error\x20getting\x20rates\x20status:','📊\x20Received\x20rates\x20for\x20','cny','myr','dot','💱\x20Applied\x20','desc','Error\x20getting\x20all\x20rates:','keys','bdt','bits','count','findUnique','kwd','CurrencyService','ars','updatedAt','\x20USDT,\x20with\x20','gbp','thb','xag','Periodic\x20currency\x20rates\x20update\x20failed:','xau','\x20USDT\x20(rate:\x20','CoinGecko\x20API\x20error:\x20','No\x20rate\x20found\x20for\x20currency:\x20','getAllRates','xdr','startPeriodicUpdates','502360lklvOc','❌\x20Failed\x20to\x20update\x20currency\x20rates:','ils','xrp','pkr','\x20currencies','sek','default','inr','uah','convertToUSDT','bhd','bmd','37106ytARkU','json','yfi','nok','findMany','\x20USDT','CURRENCIES','ngn','1003536ZEDrEg','stopPeriodicUpdates','Failed\x20to\x20update\x20rate\x20for\x20','catch','dkk','eth','350770nBWnlK','jpy','https://api.coingecko.com/api/v3/simple/price','currency','usdt','map','currencyService','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','sar','bnb','Payment\x20System/1.0','link','error','bch','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','getRatesStatus','pln','statusText','Initial\x20currency\x20rates\x20update\x20failed:',',\x20using\x201\x20as\x20fallback','COINGECKO_URL','brl','152VfegCC','Error\x20getting\x20rate\x20for\x20currency\x20','application/json','aud','nzd','updateInterval','idr','toUpperCase','length','all','toLowerCase','Error\x20converting\x20','status','upsert','51uyxJUg'];a41_0x3747=function(){return _0x5ad062;};return a41_0x3747();}var __importDefault=this&&this['__importDefault']||function(_0x316d0d){const _0x1c9345=a41_0x24c7;return _0x316d0d&&_0x316d0d[_0x1c9345(0x20c)]?_0x316d0d:{'default':_0x316d0d};};Object['defineProperty'](exports,a41_0x271249(0x20c),{'value':!![]}),exports['currencyService']=exports[a41_0x271249(0x1b2)]=void 0x0;const database_1=__importDefault(require(a41_0x271249(0x19b)));class CurrencyService{constructor(){const _0x26cb8e=a41_0x271249;this[_0x26cb8e(0x1f0)]=_0x26cb8e(0x1de),this[_0x26cb8e(0x1d4)]=[_0x26cb8e(0x213),_0x26cb8e(0x1db),'ltc',_0x26cb8e(0x1e9),_0x26cb8e(0x1e5),'eos',_0x26cb8e(0x1c4),_0x26cb8e(0x1a0),_0x26cb8e(0x1e7),_0x26cb8e(0x1a8),_0x26cb8e(0x1d0),_0x26cb8e(0x219),'aed',_0x26cb8e(0x1b3),_0x26cb8e(0x1f5),_0x26cb8e(0x1ad),_0x26cb8e(0x1cc),_0x26cb8e(0x1cd),_0x26cb8e(0x1f1),'cad',_0x26cb8e(0x215),_0x26cb8e(0x208),_0x26cb8e(0x1a6),_0x26cb8e(0x20a),_0x26cb8e(0x1da),'eur',_0x26cb8e(0x1b6),_0x26cb8e(0x206),'hkd','huf',_0x26cb8e(0x1f8),_0x26cb8e(0x1c3),_0x26cb8e(0x1c9),_0x26cb8e(0x1dd),'krw',_0x26cb8e(0x1b1),'lkr','mmk',_0x26cb8e(0x19c),_0x26cb8e(0x1a7),_0x26cb8e(0x1d5),_0x26cb8e(0x1d1),_0x26cb8e(0x1f6),_0x26cb8e(0x20f),_0x26cb8e(0x1c5),_0x26cb8e(0x1ec),'rub',_0x26cb8e(0x1e4),_0x26cb8e(0x1c7),'sgd',_0x26cb8e(0x1b7),'try','twd',_0x26cb8e(0x1ca),_0x26cb8e(0x203),_0x26cb8e(0x20b),_0x26cb8e(0x1a2),_0x26cb8e(0x1bf),_0x26cb8e(0x1b8),_0x26cb8e(0x1ba),_0x26cb8e(0x1ae),_0x26cb8e(0x20d)],this[_0x26cb8e(0x1f7)]=null,this[_0x26cb8e(0x1a1)]=-0x3,this[_0x26cb8e(0x1c0)]();}[a41_0x271249(0x1c0)](){const _0x14babd=a41_0x271249;this[_0x14babd(0x20e)]()[_0x14babd(0x1d9)](_0x27f815=>{const _0x3ba481=_0x14babd;console[_0x3ba481(0x1e8)](_0x3ba481(0x1ee),_0x27f815);}),this[_0x14babd(0x1f7)]=setInterval(async()=>{const _0x4f6451=_0x14babd;try{await this[_0x4f6451(0x20e)]();}catch(_0x187893){console[_0x4f6451(0x1e8)](_0x4f6451(0x1b9),_0x187893);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a41_0x271249(0x1d7)](){const _0x43d6ba=a41_0x271249;this[_0x43d6ba(0x1f7)]&&(clearInterval(this[_0x43d6ba(0x1f7)]),this[_0x43d6ba(0x1f7)]=null,console[_0x43d6ba(0x204)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0xced723=a41_0x271249;try{console['log'](_0xced723(0x1e3));const _0x2fea41=this[_0xced723(0x1d4)][_0xced723(0x19f)](','),_0x14976b=this['COINGECKO_URL']+_0xced723(0x217)+_0x2fea41,_0x5a7c7f=await fetch(_0x14976b,{'headers':{'Accept':_0xced723(0x1f4),'User-Agent':_0xced723(0x1e6)}});if(!_0x5a7c7f['ok'])throw new Error(_0xced723(0x1bc)+_0x5a7c7f[_0xced723(0x1fe)]+'\x20'+_0x5a7c7f[_0xced723(0x1ed)]);const _0x269e6e=await _0x5a7c7f[_0xced723(0x1cf)]();if(!_0x269e6e['tether'])throw new Error(_0xced723(0x1ea));const _0x3cb7f9=_0x269e6e['tether'];console[_0xced723(0x204)](_0xced723(0x1a5)+Object[_0xced723(0x1ac)](_0x3cb7f9)[_0xced723(0x1fa)]+_0xced723(0x1c6));const _0xf1a363=Object[_0xced723(0x205)](_0x3cb7f9)[_0xced723(0x1e1)](async([_0x3c2c3c,_0x44d2ed])=>{const _0x41af34=_0xced723;try{await database_1[_0x41af34(0x1c8)][_0x41af34(0x212)][_0x41af34(0x1ff)]({'where':{'currency':_0x3c2c3c[_0x41af34(0x1fc)]()},'update':{'rate':_0x44d2ed},'create':{'currency':_0x3c2c3c['toLowerCase'](),'rate':_0x44d2ed}});}catch(_0xf8ef08){console[_0x41af34(0x1e8)](_0x41af34(0x1d8)+_0x3c2c3c+':',_0xf8ef08);}});await Promise[_0xced723(0x207)](_0xf1a363),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x5b517f){console[_0xced723(0x1e8)](_0xced723(0x1c2),_0x5b517f);throw _0x5b517f;}}async['getCurrencyRate'](_0x54e450){const _0x247b59=a41_0x271249,_0x38c790=_0x54e450[_0x247b59(0x1fc)]();if(_0x38c790===_0x247b59(0x1e0))return 0x1;try{const _0xdbbfba=await database_1[_0x247b59(0x1c8)][_0x247b59(0x212)][_0x247b59(0x1b0)]({'where':{'currency':_0x38c790}});if(!_0xdbbfba)return console[_0x247b59(0x202)](_0x247b59(0x1bd)+_0x54e450+_0x247b59(0x1ef)),0x1;return _0xdbbfba[_0x247b59(0x218)];}catch(_0x2fd80e){return console[_0x247b59(0x1e8)](_0x247b59(0x1f3)+_0x54e450+':',_0x2fd80e),0x1;}}async[a41_0x271249(0x1cb)](_0x5e256d,_0x458a04){const _0x18c822=a41_0x271249,_0x12961a=_0x458a04[_0x18c822(0x1fc)]();if(_0x12961a===_0x18c822(0x1e0)){const _0x3cc938=_0x5e256d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x18c822(0x1a9)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x5e256d+_0x18c822(0x214)+_0x3cc938['toFixed'](0x6)+_0x18c822(0x1d3)),_0x3cc938;}try{const _0x5aead1=await this['getCurrencyRate'](_0x12961a),_0xd7ee1=_0x5e256d/_0x5aead1,_0x4e2713=_0xd7ee1*(0x1+this[_0x18c822(0x1a1)]/0x64);return console[_0x18c822(0x204)]('💱\x20Converted\x20'+_0x5e256d+'\x20'+_0x458a04[_0x18c822(0x1f9)]()+_0x18c822(0x210)+_0xd7ee1['toFixed'](0x6)+_0x18c822(0x1b5)+this['MARKUP_PERCENTAGE']+_0x18c822(0x211)+_0x4e2713[_0x18c822(0x216)](0x6)+_0x18c822(0x1bb)+_0x5aead1+')'),_0x4e2713;}catch(_0xbc0a25){console[_0x18c822(0x1e8)](_0x18c822(0x1fd)+_0x5e256d+'\x20'+_0x458a04+_0x18c822(0x201),_0xbc0a25);const _0x5cc50b=_0x5e256d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x5cc50b;}}async['convertMultipleToUSDT'](_0xfe6223){let _0x3b7096=0x0;for(const {amount:_0x5e4e55,currency:_0x4faad4}of _0xfe6223){const _0x14cbf2=await this['convertToUSDT'](_0x5e4e55,_0x4faad4);_0x3b7096+=_0x14cbf2;}return _0x3b7096;}async[a41_0x271249(0x1be)](){const _0x397bdb=a41_0x271249;try{const _0x187788=await database_1['default'][_0x397bdb(0x212)][_0x397bdb(0x1d2)]({'select':{'currency':!![],'rate':!![]}}),_0x43f52c={'usdt':0x1};return _0x187788['forEach'](_0x2c1bcf=>{const _0x20a703=_0x397bdb;_0x43f52c[_0x2c1bcf[_0x20a703(0x1df)]]=_0x2c1bcf['rate'];}),_0x43f52c;}catch(_0x32aa0f){return console[_0x397bdb(0x1e8)](_0x397bdb(0x1ab),_0x32aa0f),{'usdt':0x1};}}async[a41_0x271249(0x1eb)](){const _0x34dd46=a41_0x271249;try{const [_0x38c466,_0x484c7c,_0x418e53]=await Promise[_0x34dd46(0x1fb)]([database_1[_0x34dd46(0x1c8)][_0x34dd46(0x212)][_0x34dd46(0x1af)](),database_1[_0x34dd46(0x1c8)][_0x34dd46(0x212)]['findFirst']({'orderBy':{'updatedAt':_0x34dd46(0x1aa)},'select':{'updatedAt':!![]}}),database_1[_0x34dd46(0x1c8)]['currencyRate'][_0x34dd46(0x19d)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x38c466,'lastUpdated':_0x484c7c?.[_0x34dd46(0x1b4)]||null,'oldestRate':_0x418e53?.['updatedAt']||null,'markupPercentage':this[_0x34dd46(0x1a1)]};}catch(_0x123579){return console[_0x34dd46(0x1e8)](_0x34dd46(0x1a4),_0x123579),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x34dd46(0x1a1)]};}}[a41_0x271249(0x1a3)](){return this['MARKUP_PERCENTAGE'];}}function a41_0x24c7(_0x324442,_0x49bcff){const _0x3747=a41_0x3747();return a41_0x24c7=function(_0x24c785,_0x3d8fbd){_0x24c785=_0x24c785-0x19b;let _0x597d9f=_0x3747[_0x24c785];return _0x597d9f;},a41_0x24c7(_0x324442,_0x49bcff);}exports[a41_0x271249(0x1b2)]=CurrencyService,exports[a41_0x271249(0x1e2)]=new CurrencyService();