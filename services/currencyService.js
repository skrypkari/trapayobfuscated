'use strict';const a38_0x25257c=a38_0xbf91;(function(_0x263c66,_0x44fb83){const _0x1b5cbb=a38_0xbf91,_0x43f26a=_0x263c66();while(!![]){try{const _0x433e89=-parseInt(_0x1b5cbb(0xf7))/0x1+-parseInt(_0x1b5cbb(0xc6))/0x2*(parseInt(_0x1b5cbb(0xda))/0x3)+-parseInt(_0x1b5cbb(0x10e))/0x4*(-parseInt(_0x1b5cbb(0xd9))/0x5)+-parseInt(_0x1b5cbb(0x10f))/0x6+parseInt(_0x1b5cbb(0xc5))/0x7*(parseInt(_0x1b5cbb(0x10a))/0x8)+parseInt(_0x1b5cbb(0xa9))/0x9*(parseInt(_0x1b5cbb(0xe9))/0xa)+-parseInt(_0x1b5cbb(0xb4))/0xb*(-parseInt(_0x1b5cbb(0xa8))/0xc);if(_0x433e89===_0x44fb83)break;else _0x43f26a['push'](_0x43f26a['shift']());}catch(_0x16f980){_0x43f26a['push'](_0x43f26a['shift']());}}}(a38_0xb4a2,0x6f7eb));function a38_0xb4a2(){const _0x2c0a7a=['pkr','inr','getCurrencyRate','8650EcFctU','\x20to\x20USDT:','bch','xlm','\x20currencies','findUnique','currencyRate','warn','hkd','default',',\x20using\x201\x20as\x20fallback','ltc','php','Error\x20getting\x20all\x20rates:','310805ToMWeF','%\x20markup\x20to\x20','length','catch','log','https://api.coingecko.com/api/v3/simple/price','startPeriodicUpdates','uah','getMarkupPercentage','vnd','desc','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','COINGECKO_URL','try','btc','Failed\x20to\x20update\x20rate\x20for\x20','%\x20markup\x20=\x20','rate','Periodic\x20currency\x20rates\x20update\x20failed:','133784tyOznh','TesSoft\x20Payment\x20System/1.0','join','No\x20rate\x20found\x20for\x20currency:\x20','12ayZZXh','5061852VogceF','entries','forEach','currency','CURRENCIES','Initial\x20currency\x20rates\x20update\x20failed:','myr','__esModule','xrp','thb','sgd','nok','pln','idr','eur','rub','twd','kwd','xag','huf','2404452MsihPO','6201TlJWsx','sats','updateCurrencyRates','json','error','\x20to\x20','brl','ngn','💱\x20Converted\x20','statusText','xdr','33KCWBAN','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','❌\x20Failed\x20to\x20update\x20currency\x20rates:','upsert','usd','findMany','📊\x20Received\x20rates\x20for\x20','updatedAt','allSettled','chf','\x20USDT\x20(rate:\x20','stopPeriodicUpdates','asc','currencyService','bits','sar','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','182furOFF','2Vnqvyw','💱\x20Applied\x20','bmd','aed','eth','toFixed','?ids=tether&vs_currencies=','clp','cad','aud','mxn','Error\x20getting\x20rate\x20for\x20currency\x20','CurrencyService','map','sek','zar','toLowerCase','\x20USDT','dot','606620AQSxAw','1154214neFzPP','MARKUP_PERCENTAGE','all','bhd','mmk','updateInterval','findFirst','usdt','link','defineProperty','convertToUSDT','ils'];a38_0xb4a2=function(){return _0x2c0a7a;};return a38_0xb4a2();}var __importDefault=this&&this['__importDefault']||function(_0x34bd31){return _0x34bd31&&_0x34bd31['__esModule']?_0x34bd31:{'default':_0x34bd31};};Object[a38_0x25257c(0xe3)](exports,a38_0x25257c(0x116),{'value':!![]}),exports[a38_0x25257c(0xc1)]=exports[a38_0x25257c(0xd2)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a38_0xbf91(_0x2aba9c,_0xa86123){const _0xb4a216=a38_0xb4a2();return a38_0xbf91=function(_0xbf910c,_0x531339){_0xbf910c=_0xbf910c-0xa1;let _0xb68236=_0xb4a216[_0xbf910c];return _0xb68236;},a38_0xbf91(_0x2aba9c,_0xa86123);}class CurrencyService{constructor(){const _0x17ef98=a38_0x25257c;this[_0x17ef98(0x103)]=_0x17ef98(0xfc),this[_0x17ef98(0x113)]=[_0x17ef98(0x105),_0x17ef98(0xca),_0x17ef98(0xf4),_0x17ef98(0xeb),'bnb','eos',_0x17ef98(0x117),_0x17ef98(0xec),_0x17ef98(0xe2),_0x17ef98(0xd8),'yfi',_0x17ef98(0xb8),_0x17ef98(0xc9),'ars',_0x17ef98(0xcf),'bdt',_0x17ef98(0xdd),_0x17ef98(0xc8),_0x17ef98(0xaf),_0x17ef98(0xce),_0x17ef98(0xbd),_0x17ef98(0xcd),'cny','czk','dkk',_0x17ef98(0xa2),'gbp','gel',_0x17ef98(0xf1),_0x17ef98(0xa7),_0x17ef98(0xa1),_0x17ef98(0xe5),_0x17ef98(0xe7),'jpy','krw',_0x17ef98(0xa5),'lkr',_0x17ef98(0xde),_0x17ef98(0xd0),_0x17ef98(0x115),_0x17ef98(0xb0),_0x17ef98(0x11a),'nzd',_0x17ef98(0xf5),_0x17ef98(0xe6),_0x17ef98(0x11b),_0x17ef98(0xa3),_0x17ef98(0xc3),_0x17ef98(0xd4),_0x17ef98(0x119),_0x17ef98(0x118),_0x17ef98(0x104),_0x17ef98(0xa4),_0x17ef98(0xfe),'vef',_0x17ef98(0x100),_0x17ef98(0xd5),_0x17ef98(0xb3),_0x17ef98(0xa6),'xau',_0x17ef98(0xc2),_0x17ef98(0xaa)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x17ef98(0xfd)]();}[a38_0x25257c(0xfd)](){const _0x3c3268=a38_0x25257c;this[_0x3c3268(0xab)]()[_0x3c3268(0xfa)](_0x58f4ad=>{const _0x36ab4a=_0x3c3268;console[_0x36ab4a(0xad)](_0x36ab4a(0x114),_0x58f4ad);}),this[_0x3c3268(0xdf)]=setInterval(async()=>{const _0x2dced0=_0x3c3268;try{await this[_0x2dced0(0xab)]();}catch(_0x273d84){console['error'](_0x2dced0(0x109),_0x273d84);}},0x3c*0x3c*0x3e8),console[_0x3c3268(0xfb)](_0x3c3268(0xc4));}[a38_0x25257c(0xbf)](){const _0x5bbbe4=a38_0x25257c;this[_0x5bbbe4(0xdf)]&&(clearInterval(this[_0x5bbbe4(0xdf)]),this[_0x5bbbe4(0xdf)]=null,console[_0x5bbbe4(0xfb)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x25257c(0xab)](){const _0x12116c=a38_0x25257c;try{console[_0x12116c(0xfb)](_0x12116c(0xb5));const _0x2b3ac4=this[_0x12116c(0x113)][_0x12116c(0x10c)](','),_0x5103a4=this[_0x12116c(0x103)]+_0x12116c(0xcc)+_0x2b3ac4,_0x46fbc6=await fetch(_0x5103a4,{'headers':{'Accept':'application/json','User-Agent':_0x12116c(0x10b)}});if(!_0x46fbc6['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x46fbc6['status']+'\x20'+_0x46fbc6[_0x12116c(0xb2)]);const _0x323014=await _0x46fbc6[_0x12116c(0xac)]();if(!_0x323014['tether'])throw new Error(_0x12116c(0x102));const _0x5cf749=_0x323014['tether'];console[_0x12116c(0xfb)](_0x12116c(0xba)+Object['keys'](_0x5cf749)[_0x12116c(0xf9)]+_0x12116c(0xed));const _0x4ffff0=Object[_0x12116c(0x110)](_0x5cf749)[_0x12116c(0xd3)](async([_0x196db5,_0x39a607])=>{const _0x767f46=_0x12116c;try{await database_1[_0x767f46(0xf2)]['currencyRate'][_0x767f46(0xb7)]({'where':{'currency':_0x196db5['toLowerCase']()},'update':{'rate':_0x39a607},'create':{'currency':_0x196db5[_0x767f46(0xd6)](),'rate':_0x39a607}});}catch(_0x1511e0){console['error'](_0x767f46(0x106)+_0x196db5+':',_0x1511e0);}});await Promise[_0x12116c(0xbc)](_0x4ffff0),console[_0x12116c(0xfb)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4c5737){console[_0x12116c(0xad)](_0x12116c(0xb6),_0x4c5737);throw _0x4c5737;}}async[a38_0x25257c(0xe8)](_0x5306a2){const _0x546df5=a38_0x25257c,_0x55c50c=_0x5306a2[_0x546df5(0xd6)]();if(_0x55c50c===_0x546df5(0xe1))return 0x1;try{const _0x508325=await database_1[_0x546df5(0xf2)][_0x546df5(0xef)][_0x546df5(0xee)]({'where':{'currency':_0x55c50c}});if(!_0x508325)return console[_0x546df5(0xf0)](_0x546df5(0x10d)+_0x5306a2+_0x546df5(0xf3)),0x1;return _0x508325[_0x546df5(0x108)];}catch(_0x2c6b68){return console['error'](_0x546df5(0xd1)+_0x5306a2+':',_0x2c6b68),0x1;}}async[a38_0x25257c(0xe4)](_0x524627,_0x388e2b){const _0x56f852=a38_0x25257c,_0x2a6ad7=_0x388e2b[_0x56f852(0xd6)]();if(_0x2a6ad7==='usdt'){const _0x13f89d=_0x524627*(0x1+this[_0x56f852(0xdb)]/0x64);return console[_0x56f852(0xfb)](_0x56f852(0xc7)+this['MARKUP_PERCENTAGE']+_0x56f852(0xf8)+_0x524627+'\x20USDT\x20=\x20'+_0x13f89d[_0x56f852(0xcb)](0x6)+_0x56f852(0xd7)),_0x13f89d;}try{const _0x12a7f0=await this[_0x56f852(0xe8)](_0x2a6ad7),_0xe468c2=_0x524627/_0x12a7f0,_0x125056=_0xe468c2*(0x1+this[_0x56f852(0xdb)]/0x64);return console['log'](_0x56f852(0xb1)+_0x524627+'\x20'+_0x388e2b['toUpperCase']()+_0x56f852(0xae)+_0xe468c2[_0x56f852(0xcb)](0x6)+'\x20USDT,\x20with\x20'+this[_0x56f852(0xdb)]+_0x56f852(0x107)+_0x125056[_0x56f852(0xcb)](0x6)+_0x56f852(0xbe)+_0x12a7f0+')'),_0x125056;}catch(_0xb48e72){console[_0x56f852(0xad)]('Error\x20converting\x20'+_0x524627+'\x20'+_0x388e2b+_0x56f852(0xea),_0xb48e72);const _0x3bc602=_0x524627*(0x1+this[_0x56f852(0xdb)]/0x64);return _0x3bc602;}}async['convertMultipleToUSDT'](_0x5b920a){const _0x3bd7ab=a38_0x25257c;let _0xe8b14e=0x0;for(const {amount:_0x46d171,currency:_0x2dd129}of _0x5b920a){const _0x41bc8c=await this[_0x3bd7ab(0xe4)](_0x46d171,_0x2dd129);_0xe8b14e+=_0x41bc8c;}return _0xe8b14e;}async['getAllRates'](){const _0x4751e6=a38_0x25257c;try{const _0x414661=await database_1[_0x4751e6(0xf2)][_0x4751e6(0xef)][_0x4751e6(0xb9)]({'select':{'currency':!![],'rate':!![]}}),_0x3b9139={'usdt':0x1};return _0x414661[_0x4751e6(0x111)](_0x1d612e=>{const _0x283508=_0x4751e6;_0x3b9139[_0x1d612e[_0x283508(0x112)]]=_0x1d612e[_0x283508(0x108)];}),_0x3b9139;}catch(_0x5e4061){return console[_0x4751e6(0xad)](_0x4751e6(0xf6),_0x5e4061),{'usdt':0x1};}}async['getRatesStatus'](){const _0x148d29=a38_0x25257c;try{const [_0x556bab,_0x4a233d,_0x1299e9]=await Promise[_0x148d29(0xdc)]([database_1[_0x148d29(0xf2)][_0x148d29(0xef)]['count'](),database_1['default'][_0x148d29(0xef)]['findFirst']({'orderBy':{'updatedAt':_0x148d29(0x101)},'select':{'updatedAt':!![]}}),database_1[_0x148d29(0xf2)][_0x148d29(0xef)][_0x148d29(0xe0)]({'orderBy':{'updatedAt':_0x148d29(0xc0)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x556bab,'lastUpdated':_0x4a233d?.['updatedAt']||null,'oldestRate':_0x1299e9?.[_0x148d29(0xbb)]||null,'markupPercentage':this[_0x148d29(0xdb)]};}catch(_0x5c5166){return console['error']('Error\x20getting\x20rates\x20status:',_0x5c5166),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x148d29(0xdb)]};}}[a38_0x25257c(0xff)](){const _0x56426d=a38_0x25257c;return this[_0x56426d(0xdb)];}}exports[a38_0x25257c(0xd2)]=CurrencyService,exports[a38_0x25257c(0xc1)]=new CurrencyService();