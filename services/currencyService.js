'use strict';const a38_0x8f5671=a38_0x3a57;(function(_0x566b69,_0x4b52ef){const _0x49ac55=a38_0x3a57,_0x29499e=_0x566b69();while(!![]){try{const _0x4eb69d=parseInt(_0x49ac55(0x1ee))/0x1*(parseInt(_0x49ac55(0x218))/0x2)+-parseInt(_0x49ac55(0x1cb))/0x3+-parseInt(_0x49ac55(0x20c))/0x4*(parseInt(_0x49ac55(0x205))/0x5)+parseInt(_0x49ac55(0x1f1))/0x6*(-parseInt(_0x49ac55(0x1e4))/0x7)+-parseInt(_0x49ac55(0x233))/0x8*(-parseInt(_0x49ac55(0x1d9))/0x9)+parseInt(_0x49ac55(0x21f))/0xa*(parseInt(_0x49ac55(0x23f))/0xb)+-parseInt(_0x49ac55(0x1c8))/0xc*(-parseInt(_0x49ac55(0x224))/0xd);if(_0x4eb69d===_0x4b52ef)break;else _0x29499e['push'](_0x29499e['shift']());}catch(_0x40fae8){_0x29499e['push'](_0x29499e['shift']());}}}(a38_0x2452,0x657e6));var __importDefault=this&&this[a38_0x8f5671(0x219)]||function(_0xf179f0){const _0x969c20=a38_0x8f5671;return _0xf179f0&&_0xf179f0[_0x969c20(0x208)]?_0xf179f0:{'default':_0xf179f0};};Object['defineProperty'](exports,a38_0x8f5671(0x208),{'value':!![]}),exports[a38_0x8f5671(0x229)]=exports[a38_0x8f5671(0x21b)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a38_0x3a57(_0xf88969,_0x4d8680){const _0x245294=a38_0x2452();return a38_0x3a57=function(_0x3a5759,_0x2e7af4){_0x3a5759=_0x3a5759-0x1c3;let _0x995237=_0x245294[_0x3a5759];return _0x995237;},a38_0x3a57(_0xf88969,_0x4d8680);}class CurrencyService{constructor(){const _0x34d467=a38_0x8f5671;this[_0x34d467(0x22f)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=['btc',_0x34d467(0x217),'ltc',_0x34d467(0x1d0),_0x34d467(0x1dd),_0x34d467(0x1f8),'xrp','xlm',_0x34d467(0x1ff),'dot',_0x34d467(0x1ef),_0x34d467(0x234),_0x34d467(0x1df),_0x34d467(0x1ec),_0x34d467(0x1f5),'bdt',_0x34d467(0x1f0),'bmd',_0x34d467(0x203),_0x34d467(0x23a),'chf','clp','cny',_0x34d467(0x238),'dkk',_0x34d467(0x1f2),_0x34d467(0x225),_0x34d467(0x1e6),_0x34d467(0x21e),_0x34d467(0x200),_0x34d467(0x22a),_0x34d467(0x1c3),'inr',_0x34d467(0x1d3),_0x34d467(0x21c),'kwd','lkr',_0x34d467(0x1dc),'mxn',_0x34d467(0x20a),_0x34d467(0x1fd),_0x34d467(0x1ce),_0x34d467(0x22c),_0x34d467(0x1c6),'pkr',_0x34d467(0x23b),_0x34d467(0x1f9),_0x34d467(0x1db),_0x34d467(0x211),_0x34d467(0x201),_0x34d467(0x1ed),'try',_0x34d467(0x215),_0x34d467(0x202),_0x34d467(0x1e2),_0x34d467(0x207),_0x34d467(0x1d5),_0x34d467(0x213),_0x34d467(0x1d2),_0x34d467(0x20d),_0x34d467(0x1e5),_0x34d467(0x1d6)],this[_0x34d467(0x1c7)]=null,this[_0x34d467(0x1f4)]=0x3,this[_0x34d467(0x1c9)]();}[a38_0x8f5671(0x1c9)](){const _0x36e217=a38_0x8f5671;this['updateCurrencyRates']()[_0x36e217(0x1c5)](_0x51a827=>{const _0x34aad7=_0x36e217;console['error'](_0x34aad7(0x22e),_0x51a827);}),this[_0x36e217(0x1c7)]=setInterval(async()=>{const _0x26541b=_0x36e217;try{await this['updateCurrencyRates']();}catch(_0x201c7e){console[_0x26541b(0x23e)](_0x26541b(0x1da),_0x201c7e);}},0x3c*0x3c*0x3e8),console[_0x36e217(0x23d)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x8f5671(0x1e8)](){const _0x2109e9=a38_0x8f5671;this[_0x2109e9(0x1c7)]&&(clearInterval(this[_0x2109e9(0x1c7)]),this['updateInterval']=null,console[_0x2109e9(0x23d)](_0x2109e9(0x1d4)));}async[a38_0x8f5671(0x240)](){const _0x6c6d52=a38_0x8f5671;try{console['log'](_0x6c6d52(0x1f3));const _0x13becd=this[_0x6c6d52(0x20f)]['join'](','),_0x15df7d=this[_0x6c6d52(0x22f)]+'?ids=tether&vs_currencies='+_0x13becd,_0x383eda=await fetch(_0x15df7d,{'headers':{'Accept':_0x6c6d52(0x1e3),'User-Agent':_0x6c6d52(0x1d7)}});if(!_0x383eda['ok'])throw new Error(_0x6c6d52(0x235)+_0x383eda[_0x6c6d52(0x20e)]+'\x20'+_0x383eda[_0x6c6d52(0x223)]);const _0x50c135=await _0x383eda[_0x6c6d52(0x204)]();if(!_0x50c135[_0x6c6d52(0x1de)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x4e427f=_0x50c135[_0x6c6d52(0x1de)];console['log'](_0x6c6d52(0x212)+Object[_0x6c6d52(0x228)](_0x4e427f)['length']+_0x6c6d52(0x1cc));const _0x58749a=Object['entries'](_0x4e427f)['map'](async([_0x23c076,_0x57c991])=>{const _0xc1c3b4=_0x6c6d52;try{await database_1[_0xc1c3b4(0x21a)][_0xc1c3b4(0x210)][_0xc1c3b4(0x1fe)]({'where':{'currency':_0x23c076['toLowerCase']()},'update':{'rate':_0x57c991},'create':{'currency':_0x23c076[_0xc1c3b4(0x220)](),'rate':_0x57c991}});}catch(_0x3a12e0){console[_0xc1c3b4(0x23e)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x23c076+':',_0x3a12e0);}});await Promise[_0x6c6d52(0x1e1)](_0x58749a),console[_0x6c6d52(0x23d)](_0x6c6d52(0x239));}catch(_0x1409f4){console[_0x6c6d52(0x23e)](_0x6c6d52(0x221),_0x1409f4);throw _0x1409f4;}}async[a38_0x8f5671(0x1ea)](_0x2d187c){const _0x2445a3=a38_0x8f5671,_0x2349f2=_0x2d187c[_0x2445a3(0x220)]();if(_0x2349f2==='usdt')return 0x1;try{const _0x5e5a90=await database_1['default'][_0x2445a3(0x210)][_0x2445a3(0x1ca)]({'where':{'currency':_0x2349f2}});if(!_0x5e5a90)return console['warn'](_0x2445a3(0x23c)+_0x2d187c+_0x2445a3(0x1d8)),0x1;return _0x5e5a90[_0x2445a3(0x1fb)];}catch(_0x59a09b){return console[_0x2445a3(0x23e)](_0x2445a3(0x20b)+_0x2d187c+':',_0x59a09b),0x1;}}async[a38_0x8f5671(0x1cf)](_0x1643ed,_0x59c6ff){const _0x14f896=a38_0x8f5671,_0x83aa92=_0x59c6ff['toLowerCase']();if(_0x83aa92===_0x14f896(0x226)){const _0x1b617d=_0x1643ed*(0x1+this[_0x14f896(0x1f4)]/0x64);return console['log'](_0x14f896(0x21d)+this[_0x14f896(0x1f4)]+_0x14f896(0x1d1)+_0x1643ed+'\x20USDT\x20=\x20'+_0x1b617d[_0x14f896(0x206)](0x6)+'\x20USDT'),_0x1b617d;}try{const _0x13fb86=await this[_0x14f896(0x1ea)](_0x83aa92),_0x21b187=_0x1643ed/_0x13fb86,_0x2b5233=_0x21b187*(0x1+this[_0x14f896(0x1f4)]/0x64);return console[_0x14f896(0x23d)](_0x14f896(0x230)+_0x1643ed+'\x20'+_0x59c6ff[_0x14f896(0x1c4)]()+_0x14f896(0x1f7)+_0x21b187[_0x14f896(0x206)](0x6)+_0x14f896(0x216)+this[_0x14f896(0x1f4)]+_0x14f896(0x231)+_0x2b5233[_0x14f896(0x206)](0x6)+_0x14f896(0x232)+_0x13fb86+')'),_0x2b5233;}catch(_0x3e35c6){console[_0x14f896(0x23e)](_0x14f896(0x22d)+_0x1643ed+'\x20'+_0x59c6ff+_0x14f896(0x1fc),_0x3e35c6);const _0x2c0031=_0x1643ed*(0x1+this[_0x14f896(0x1f4)]/0x64);return _0x2c0031;}}async[a38_0x8f5671(0x1f6)](_0x1f89b3){let _0x1398a6=0x0;for(const {amount:_0x37a0fd,currency:_0x2acd69}of _0x1f89b3){const _0x4fe363=await this['convertToUSDT'](_0x37a0fd,_0x2acd69);_0x1398a6+=_0x4fe363;}return _0x1398a6;}async[a38_0x8f5671(0x236)](){const _0xa4a8d6=a38_0x8f5671;try{const _0x16af8b=await database_1[_0xa4a8d6(0x21a)][_0xa4a8d6(0x210)][_0xa4a8d6(0x22b)]({'select':{'currency':!![],'rate':!![]}}),_0x551001={'usdt':0x1};return _0x16af8b['forEach'](_0x582ccf=>{const _0x1865ba=_0xa4a8d6;_0x551001[_0x582ccf[_0x1865ba(0x1e9)]]=_0x582ccf[_0x1865ba(0x1fb)];}),_0x551001;}catch(_0x320624){return console['error'](_0xa4a8d6(0x209),_0x320624),{'usdt':0x1};}}async[a38_0x8f5671(0x1fa)](){const _0x15a5e4=a38_0x8f5671;try{const [_0x20541,_0x2c6f2a,_0x5477a0]=await Promise[_0x15a5e4(0x1e0)]([database_1[_0x15a5e4(0x21a)][_0x15a5e4(0x210)][_0x15a5e4(0x1eb)](),database_1[_0x15a5e4(0x21a)][_0x15a5e4(0x210)][_0x15a5e4(0x237)]({'orderBy':{'updatedAt':_0x15a5e4(0x227)},'select':{'updatedAt':!![]}}),database_1[_0x15a5e4(0x21a)][_0x15a5e4(0x210)][_0x15a5e4(0x237)]({'orderBy':{'updatedAt':_0x15a5e4(0x214)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x20541,'lastUpdated':_0x2c6f2a?.['updatedAt']||null,'oldestRate':_0x5477a0?.[_0x15a5e4(0x1cd)]||null,'markupPercentage':this[_0x15a5e4(0x1f4)]};}catch(_0x322be1){return console[_0x15a5e4(0x23e)](_0x15a5e4(0x1e7),_0x322be1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x15a5e4(0x1f4)]};}}[a38_0x8f5671(0x222)](){const _0x14e183=a38_0x8f5671;return this[_0x14e183(0x1f4)];}}function a38_0x2452(){const _0x11e97b=['39onDVir','gbp','usdt','desc','keys','currencyService','idr','findMany','nzd','Error\x20converting\x20','Initial\x20currency\x20rates\x20update\x20failed:','COINGECKO_URL','üí±\x20Converted\x20','%\x20markup\x20=\x20','\x20USDT\x20(rate:\x20','2009480ZvQlAs','usd','CoinGecko\x20API\x20error:\x20','getAllRates','findFirst','czk','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','cad','pln','No\x20rate\x20found\x20for\x20currency:\x20','log','error','11tphlZQ','updateCurrencyRates','ils','toUpperCase','catch','php','updateInterval','1543860RavgXp','startPeriodicUpdates','findUnique','700383STNlvH','\x20currencies','updatedAt','nok','convertToUSDT','bch','%\x20markup\x20to\x20','xag','jpy','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','zar','sats','TesSoft\x20Payment\x20System/1.0',',\x20using\x201\x20as\x20fallback','27kAIyHf','Periodic\x20currency\x20rates\x20update\x20failed:','sar','mmk','bnb','tether','aed','all','allSettled','vef','application/json','4658227wwimFc','bits','gel','Error\x20getting\x20rates\x20status:','stopPeriodicUpdates','currency','getCurrencyRate','count','ars','thb','443777dujRPY','yfi','bhd','6LdMlEW','eur','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','MARKUP_PERCENTAGE','aud','convertMultipleToUSDT','\x20to\x20','eos','rub','getRatesStatus','rate','\x20to\x20USDT:','ngn','upsert','link','huf','sgd','uah','brl','json','73640NHlZop','toFixed','vnd','__esModule','Error\x20getting\x20all\x20rates:','myr','Error\x20getting\x20rate\x20for\x20currency\x20','168TLKEQL','xau','status','CURRENCIES','currencyRate','sek','üìä\x20Received\x20rates\x20for\x20','xdr','asc','twd','\x20USDT,\x20with\x20','eth','2AOOgfD','__importDefault','default','CurrencyService','krw','üí±\x20Applied\x20','hkd','3499190yXGlRB','toLowerCase','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','getMarkupPercentage','statusText'];a38_0x2452=function(){return _0x11e97b;};return a38_0x2452();}exports[a38_0x8f5671(0x21b)]=CurrencyService,exports[a38_0x8f5671(0x229)]=new CurrencyService();