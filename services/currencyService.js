'use strict';function a38_0x486e(){const _0x5f207a=['keys','bch','sgd','ars','10624914yNGely','dot','nok','join','xrp','krw','upsert','uah','clp','CurrencyService','warn','kwd','xau','pln','15149uPXRgX','📊\x20Received\x20rates\x20for\x20','try','40gdFQbG','No\x20rate\x20found\x20for\x20currency:\x20','jpy','log','COINGECKO_URL','cny','huf','error','link','statusText','Error\x20getting\x20rates\x20status:','asc','usd','currencyRate','desc','convertToUSDT','ngn','startPeriodicUpdates','7896756pfOoec','Periodic\x20currency\x20rates\x20update\x20failed:','toFixed','✅\x20Currency\x20rates\x20updated\x20successfully','pkr','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20to\x20USDT:','toUpperCase','8cYXpfG','94803TceWjo','Error\x20getting\x20rate\x20for\x20currency\x20','7085510oCwUyH','https://api.coingecko.com/api/v3/simple/price','getRatesStatus','all','thb','toLowerCase','application/json','xdr','allSettled','Error\x20getting\x20all\x20rates:','\x20USDT\x20=\x20','length','bdt','%\x20markup\x20=\x20','czk','%\x20markup\x20to\x20','sats','eth','stopPeriodicUpdates','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','status','3494880GcbMDJ','btc','findMany','?ids=tether&vs_currencies=','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','convertMultipleToUSDT','eur','cad','currency','getMarkupPercentage','mmk','entries','map','\x20USDT,\x20with\x20','bnb','currencyService','rate','findFirst','7302215tOsHfP','CURRENCIES','count','Failed\x20to\x20update\x20rate\x20for\x20','bits','updateCurrencyRates','catch','💱\x20Applied\x20','rub','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','updatedAt','vnd','gbp','defineProperty','ltc','__esModule','updateInterval','forEach','\x20USDT\x20(rate:\x20','eos','💱\x20Converted\x20','TesSoft\x20Payment\x20System/1.0','dkk','../config/database','brl','chf','tether','gel','162qGwBzr','twd','Error\x20converting\x20','getAllRates','default','myr','MARKUP_PERCENTAGE'];a38_0x486e=function(){return _0x5f207a;};return a38_0x486e();}const a38_0x4f7e2d=a38_0x1a24;function a38_0x1a24(_0x3ebaf4,_0x33e7d1){const _0x486e0c=a38_0x486e();return a38_0x1a24=function(_0x1a2400,_0x974dc0){_0x1a2400=_0x1a2400-0x151;let _0x34baca=_0x486e0c[_0x1a2400];return _0x34baca;},a38_0x1a24(_0x3ebaf4,_0x33e7d1);}(function(_0x3c32c5,_0x473eea){const _0x13a45b=a38_0x1a24,_0xa42b72=_0x3c32c5();while(!![]){try{const _0x20e603=parseInt(_0x13a45b(0x19f))/0x1*(parseInt(_0x13a45b(0x186))/0x2)+-parseInt(_0x13a45b(0x1bd))/0x3*(parseInt(_0x13a45b(0x1a2))/0x4)+-parseInt(_0x13a45b(0x16a))/0x5+parseInt(_0x13a45b(0x158))/0x6+parseInt(_0x13a45b(0x1b4))/0x7*(-parseInt(_0x13a45b(0x1bc))/0x8)+parseInt(_0x13a45b(0x191))/0x9+parseInt(_0x13a45b(0x1bf))/0xa;if(_0x20e603===_0x473eea)break;else _0xa42b72['push'](_0xa42b72['shift']());}catch(_0x4c639a){_0xa42b72['push'](_0xa42b72['shift']());}}}(a38_0x486e,0xc1de5));var __importDefault=this&&this['__importDefault']||function(_0x26b066){const _0x4d1d53=a38_0x1a24;return _0x26b066&&_0x26b066[_0x4d1d53(0x179)]?_0x26b066:{'default':_0x26b066};};Object[a38_0x4f7e2d(0x177)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x4f7e2d(0x181)));class CurrencyService{constructor(){const _0x52dbb6=a38_0x4f7e2d;this[_0x52dbb6(0x1a6)]=_0x52dbb6(0x1c0),this[_0x52dbb6(0x16b)]=[_0x52dbb6(0x159),_0x52dbb6(0x154),_0x52dbb6(0x178),_0x52dbb6(0x18e),_0x52dbb6(0x166),_0x52dbb6(0x17d),_0x52dbb6(0x195),'xlm',_0x52dbb6(0x1aa),_0x52dbb6(0x192),'yfi',_0x52dbb6(0x1ae),'aed',_0x52dbb6(0x190),'aud',_0x52dbb6(0x1cb),'bhd','bmd',_0x52dbb6(0x182),_0x52dbb6(0x15f),_0x52dbb6(0x183),_0x52dbb6(0x199),_0x52dbb6(0x1a7),_0x52dbb6(0x151),_0x52dbb6(0x180),_0x52dbb6(0x15e),_0x52dbb6(0x176),_0x52dbb6(0x185),'hkd',_0x52dbb6(0x1a8),'idr','ils','inr',_0x52dbb6(0x1a4),_0x52dbb6(0x196),_0x52dbb6(0x19c),'lkr',_0x52dbb6(0x162),'mxn',_0x52dbb6(0x18b),_0x52dbb6(0x1b2),_0x52dbb6(0x193),'nzd','php',_0x52dbb6(0x1b8),_0x52dbb6(0x19e),_0x52dbb6(0x172),'sar','sek',_0x52dbb6(0x18f),_0x52dbb6(0x1c3),_0x52dbb6(0x1a1),_0x52dbb6(0x187),_0x52dbb6(0x198),'vef',_0x52dbb6(0x175),'zar',_0x52dbb6(0x1c6),'xag',_0x52dbb6(0x19d),_0x52dbb6(0x16e),_0x52dbb6(0x153)],this['updateInterval']=null,this[_0x52dbb6(0x18c)]=0x3,this[_0x52dbb6(0x1b3)]();}[a38_0x4f7e2d(0x1b3)](){const _0x1c63ad=a38_0x4f7e2d;this[_0x1c63ad(0x16f)]()[_0x1c63ad(0x170)](_0x59b6f1=>{const _0x5da267=_0x1c63ad;console[_0x5da267(0x1a9)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x59b6f1);}),this[_0x1c63ad(0x17a)]=setInterval(async()=>{const _0xcf9a16=_0x1c63ad;try{await this[_0xcf9a16(0x16f)]();}catch(_0x4af6b5){console[_0xcf9a16(0x1a9)](_0xcf9a16(0x1b5),_0x4af6b5);}},0x3c*0x3c*0x3e8),console[_0x1c63ad(0x1a5)](_0x1c63ad(0x1b9));}[a38_0x4f7e2d(0x155)](){const _0x452d74=a38_0x4f7e2d;this[_0x452d74(0x17a)]&&(clearInterval(this[_0x452d74(0x17a)]),this['updateInterval']=null,console[_0x452d74(0x1a5)](_0x452d74(0x156)));}async[a38_0x4f7e2d(0x16f)](){const _0x44b7ce=a38_0x4f7e2d;try{console[_0x44b7ce(0x1a5)](_0x44b7ce(0x173));const _0x56beb1=this[_0x44b7ce(0x16b)][_0x44b7ce(0x194)](','),_0x59d647=this[_0x44b7ce(0x1a6)]+_0x44b7ce(0x15b)+_0x56beb1,_0x56e5c4=await fetch(_0x59d647,{'headers':{'Accept':_0x44b7ce(0x1c5),'User-Agent':_0x44b7ce(0x17f)}});if(!_0x56e5c4['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x56e5c4[_0x44b7ce(0x157)]+'\x20'+_0x56e5c4[_0x44b7ce(0x1ab)]);const _0x4b15d5=await _0x56e5c4['json']();if(!_0x4b15d5[_0x44b7ce(0x184)])throw new Error(_0x44b7ce(0x15c));const _0x4cb6a3=_0x4b15d5['tether'];console[_0x44b7ce(0x1a5)](_0x44b7ce(0x1a0)+Object[_0x44b7ce(0x18d)](_0x4cb6a3)[_0x44b7ce(0x1ca)]+'\x20currencies');const _0x160a17=Object[_0x44b7ce(0x163)](_0x4cb6a3)[_0x44b7ce(0x164)](async([_0x580e7c,_0x3e4c7f])=>{const _0x2ab37f=_0x44b7ce;try{await database_1['default'][_0x2ab37f(0x1af)][_0x2ab37f(0x197)]({'where':{'currency':_0x580e7c['toLowerCase']()},'update':{'rate':_0x3e4c7f},'create':{'currency':_0x580e7c[_0x2ab37f(0x1c4)](),'rate':_0x3e4c7f}});}catch(_0x4b96f1){console[_0x2ab37f(0x1a9)](_0x2ab37f(0x16d)+_0x580e7c+':',_0x4b96f1);}});await Promise[_0x44b7ce(0x1c7)](_0x160a17),console[_0x44b7ce(0x1a5)](_0x44b7ce(0x1b7));}catch(_0x3f298e){console[_0x44b7ce(0x1a9)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x3f298e);throw _0x3f298e;}}async['getCurrencyRate'](_0x1f538e){const _0x4d304c=a38_0x4f7e2d,_0x12745b=_0x1f538e[_0x4d304c(0x1c4)]();if(_0x12745b==='usdt')return 0x1;try{const _0x5225c6=await database_1['default'][_0x4d304c(0x1af)]['findUnique']({'where':{'currency':_0x12745b}});if(!_0x5225c6)return console[_0x4d304c(0x19b)](_0x4d304c(0x1a3)+_0x1f538e+',\x20using\x201\x20as\x20fallback'),0x1;return _0x5225c6[_0x4d304c(0x168)];}catch(_0x79fe8f){return console['error'](_0x4d304c(0x1be)+_0x1f538e+':',_0x79fe8f),0x1;}}async[a38_0x4f7e2d(0x1b1)](_0x13ad11,_0x1240ed){const _0x3e162b=a38_0x4f7e2d,_0x458ffe=_0x1240ed['toLowerCase']();if(_0x458ffe==='usdt'){const _0x55609d=_0x13ad11*(0x1+this[_0x3e162b(0x18c)]/0x64);return console[_0x3e162b(0x1a5)](_0x3e162b(0x171)+this[_0x3e162b(0x18c)]+_0x3e162b(0x152)+_0x13ad11+_0x3e162b(0x1c9)+_0x55609d[_0x3e162b(0x1b6)](0x6)+'\x20USDT'),_0x55609d;}try{const _0x161055=await this['getCurrencyRate'](_0x458ffe),_0x1a0726=_0x13ad11/_0x161055,_0xab2bd4=_0x1a0726*(0x1+this[_0x3e162b(0x18c)]/0x64);return console['log'](_0x3e162b(0x17e)+_0x13ad11+'\x20'+_0x1240ed[_0x3e162b(0x1bb)]()+'\x20to\x20'+_0x1a0726[_0x3e162b(0x1b6)](0x6)+_0x3e162b(0x165)+this['MARKUP_PERCENTAGE']+_0x3e162b(0x1cc)+_0xab2bd4[_0x3e162b(0x1b6)](0x6)+_0x3e162b(0x17c)+_0x161055+')'),_0xab2bd4;}catch(_0x294e41){console[_0x3e162b(0x1a9)](_0x3e162b(0x188)+_0x13ad11+'\x20'+_0x1240ed+_0x3e162b(0x1ba),_0x294e41);const _0x434b06=_0x13ad11*(0x1+this[_0x3e162b(0x18c)]/0x64);return _0x434b06;}}async[a38_0x4f7e2d(0x15d)](_0x10040e){let _0x25979f=0x0;for(const {amount:_0x18a27d,currency:_0x559b27}of _0x10040e){const _0x58d200=await this['convertToUSDT'](_0x18a27d,_0x559b27);_0x25979f+=_0x58d200;}return _0x25979f;}async[a38_0x4f7e2d(0x189)](){const _0xc953bd=a38_0x4f7e2d;try{const _0x486710=await database_1[_0xc953bd(0x18a)][_0xc953bd(0x1af)][_0xc953bd(0x15a)]({'select':{'currency':!![],'rate':!![]}}),_0x2e2376={'usdt':0x1};return _0x486710[_0xc953bd(0x17b)](_0x3cbf08=>{const _0x433284=_0xc953bd;_0x2e2376[_0x3cbf08[_0x433284(0x160)]]=_0x3cbf08['rate'];}),_0x2e2376;}catch(_0x482d13){return console[_0xc953bd(0x1a9)](_0xc953bd(0x1c8),_0x482d13),{'usdt':0x1};}}async[a38_0x4f7e2d(0x1c1)](){const _0x202ca7=a38_0x4f7e2d;try{const [_0xabb6f9,_0x49a238,_0xb35cc8]=await Promise[_0x202ca7(0x1c2)]([database_1[_0x202ca7(0x18a)]['currencyRate'][_0x202ca7(0x16c)](),database_1[_0x202ca7(0x18a)][_0x202ca7(0x1af)]['findFirst']({'orderBy':{'updatedAt':_0x202ca7(0x1b0)},'select':{'updatedAt':!![]}}),database_1[_0x202ca7(0x18a)]['currencyRate'][_0x202ca7(0x169)]({'orderBy':{'updatedAt':_0x202ca7(0x1ad)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xabb6f9,'lastUpdated':_0x49a238?.[_0x202ca7(0x174)]||null,'oldestRate':_0xb35cc8?.[_0x202ca7(0x174)]||null,'markupPercentage':this[_0x202ca7(0x18c)]};}catch(_0x47f9cc){return console[_0x202ca7(0x1a9)](_0x202ca7(0x1ac),_0x47f9cc),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x202ca7(0x18c)]};}}[a38_0x4f7e2d(0x161)](){const _0x2ba912=a38_0x4f7e2d;return this[_0x2ba912(0x18c)];}}exports[a38_0x4f7e2d(0x19a)]=CurrencyService,exports[a38_0x4f7e2d(0x167)]=new CurrencyService();