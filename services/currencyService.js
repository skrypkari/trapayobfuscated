'use strict';const a39_0x5d1c50=a39_0x395f;function a39_0x395f(_0x8bb4df,_0x46a23f){const _0x444480=a39_0x4444();return a39_0x395f=function(_0x395fae,_0x9ea2b6){_0x395fae=_0x395fae-0x157;let _0x4e1998=_0x444480[_0x395fae];return _0x4e1998;},a39_0x395f(_0x8bb4df,_0x46a23f);}(function(_0x18849a,_0x45682d){const _0x2e5e50=a39_0x395f,_0x49787d=_0x18849a();while(!![]){try{const _0x348464=parseInt(_0x2e5e50(0x1a2))/0x1*(-parseInt(_0x2e5e50(0x1b4))/0x2)+parseInt(_0x2e5e50(0x1c3))/0x3+-parseInt(_0x2e5e50(0x1c1))/0x4+-parseInt(_0x2e5e50(0x181))/0x5*(parseInt(_0x2e5e50(0x18a))/0x6)+parseInt(_0x2e5e50(0x168))/0x7*(parseInt(_0x2e5e50(0x190))/0x8)+parseInt(_0x2e5e50(0x1a7))/0x9*(parseInt(_0x2e5e50(0x1a8))/0xa)+-parseInt(_0x2e5e50(0x170))/0xb;if(_0x348464===_0x45682d)break;else _0x49787d['push'](_0x49787d['shift']());}catch(_0x362aeb){_0x49787d['push'](_0x49787d['shift']());}}}(a39_0x4444,0x87269));var __importDefault=this&&this['__importDefault']||function(_0x2e37b6){const _0x32fd93=a39_0x395f;return _0x2e37b6&&_0x2e37b6[_0x32fd93(0x1be)]?_0x2e37b6:{'default':_0x2e37b6};};function a39_0x4444(){const _0x3f225a=['findMany','toFixed','map','4079FKJbdl','❌\x20Failed\x20to\x20update\x20currency\x20rates:','chf','aed','default','149616rFVOOz','190yHpuMP','dot','vnd','?ids=tether&vs_currencies=','myr','bch','btc',',\x20using\x201\x20as\x20fallback','czk','bdt','bmd','https://api.coingecko.com/api/v3/simple/price','116WErIjY','updateInterval','zar','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','asc','bhd','warn','log','join','getMarkupPercentage','__esModule','✅\x20Currency\x20rates\x20updated\x20successfully','currencyService','349844PorsWQ','getCurrencyRate','2116509QefOyV','application/json','\x20USDT\x20=\x20','hkd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','clp','toLowerCase','nok','No\x20rate\x20found\x20for\x20currency:\x20','findUnique','\x20USDT,\x20with\x20','CurrencyService','\x20currencies','eos','brl','jpy','MARKUP_PERCENTAGE','currency','desc','cad','mxn','usdt','status','pln','CoinGecko\x20API\x20error:\x20','sek','xag','cny','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','error','idr','sar','💱\x20Converted\x20','aud','convertMultipleToUSDT','TesSoft\x20Payment\x20System/1.0','dkk','Initial\x20currency\x20rates\x20update\x20failed:','all','4424756BlOLnn','getRatesStatus','defineProperty','json','usd','upsert','Periodic\x20currency\x20rates\x20update\x20failed:','allSettled','2793461tpGVMC','yfi','\x20to\x20USDT:','count','mmk','eth','catch','pkr','\x20USDT','thb','../config/database','twd','CURRENCIES','rate','Error\x20getting\x20rates\x20status:','\x20to\x20','length','326185lHQZoH','📊\x20Received\x20rates\x20for\x20','entries','bits','Error\x20getting\x20rate\x20for\x20currency\x20','💱\x20Applied\x20','updatedAt','currencyRate','ils','48onlEAz','Failed\x20to\x20update\x20rate\x20for\x20','COINGECKO_URL','%\x20markup\x20=\x20','xrp','inr','8WWNQKX','sats','\x20USDT\x20(rate:\x20','findFirst','tether','startPeriodicUpdates','Error\x20converting\x20','convertToUSDT','getAllRates','updateCurrencyRates','gbp','try','forEach','krw','sgd'];a39_0x4444=function(){return _0x3f225a;};return a39_0x4444();}Object[a39_0x5d1c50(0x16a)](exports,a39_0x5d1c50(0x1be),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x5d1c50(0x17a)));class CurrencyService{constructor(){const _0x546c26=a39_0x5d1c50;this[_0x546c26(0x18c)]=_0x546c26(0x1b3),this[_0x546c26(0x17c)]=[_0x546c26(0x1ae),_0x546c26(0x175),'ltc',_0x546c26(0x1ad),'bnb',_0x546c26(0x1d0),_0x546c26(0x18e),'xlm','link',_0x546c26(0x1a9),_0x546c26(0x171),_0x546c26(0x16c),_0x546c26(0x1a5),'ars',_0x546c26(0x162),_0x546c26(0x1b1),_0x546c26(0x1b9),_0x546c26(0x1b2),_0x546c26(0x1d1),_0x546c26(0x1d6),_0x546c26(0x1a4),_0x546c26(0x1c8),_0x546c26(0x15c),_0x546c26(0x1b0),_0x546c26(0x165),'eur',_0x546c26(0x19a),'gel',_0x546c26(0x1c6),'huf',_0x546c26(0x15f),_0x546c26(0x189),_0x546c26(0x18f),_0x546c26(0x1d2),_0x546c26(0x19d),'kwd','lkr',_0x546c26(0x174),_0x546c26(0x1d7),_0x546c26(0x1ac),'ngn',_0x546c26(0x1ca),'nzd','php',_0x546c26(0x177),_0x546c26(0x158),'rub',_0x546c26(0x160),_0x546c26(0x15a),_0x546c26(0x19e),_0x546c26(0x179),_0x546c26(0x19b),_0x546c26(0x17b),'uah','vef',_0x546c26(0x1aa),_0x546c26(0x1b6),'xdr',_0x546c26(0x15b),'xau',_0x546c26(0x184),_0x546c26(0x191)],this['updateInterval']=null,this[_0x546c26(0x1d3)]=-0x3,this[_0x546c26(0x195)]();}[a39_0x5d1c50(0x195)](){const _0x129087=a39_0x5d1c50;this[_0x129087(0x199)]()[_0x129087(0x176)](_0x16f0f4=>{const _0x3092c6=_0x129087;console[_0x3092c6(0x15e)](_0x3092c6(0x166),_0x16f0f4);}),this[_0x129087(0x1b5)]=setInterval(async()=>{const _0x5126e8=_0x129087;try{await this[_0x5126e8(0x199)]();}catch(_0x4bbca3){console[_0x5126e8(0x15e)](_0x5126e8(0x16e),_0x4bbca3);}},0x3c*0x3c*0x3e8),console[_0x129087(0x1bb)](_0x129087(0x15d));}['stopPeriodicUpdates'](){const _0x14b5df=a39_0x5d1c50;this[_0x14b5df(0x1b5)]&&(clearInterval(this[_0x14b5df(0x1b5)]),this['updateInterval']=null,console[_0x14b5df(0x1bb)](_0x14b5df(0x1b7)));}async[a39_0x5d1c50(0x199)](){const _0x5fc82e=a39_0x5d1c50;try{console[_0x5fc82e(0x1bb)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x582e2d=this['CURRENCIES'][_0x5fc82e(0x1bc)](','),_0x403646=this[_0x5fc82e(0x18c)]+_0x5fc82e(0x1ab)+_0x582e2d,_0x568e9b=await fetch(_0x403646,{'headers':{'Accept':_0x5fc82e(0x1c4),'User-Agent':_0x5fc82e(0x164)}});if(!_0x568e9b['ok'])throw new Error(_0x5fc82e(0x159)+_0x568e9b[_0x5fc82e(0x157)]+'\x20'+_0x568e9b['statusText']);const _0x1ae533=await _0x568e9b[_0x5fc82e(0x16b)]();if(!_0x1ae533[_0x5fc82e(0x194)])throw new Error(_0x5fc82e(0x1c7));const _0x2e4a11=_0x1ae533[_0x5fc82e(0x194)];console[_0x5fc82e(0x1bb)](_0x5fc82e(0x182)+Object['keys'](_0x2e4a11)[_0x5fc82e(0x180)]+_0x5fc82e(0x1cf));const _0x486b65=Object[_0x5fc82e(0x183)](_0x2e4a11)[_0x5fc82e(0x1a1)](async([_0x4bedee,_0x17e9a7])=>{const _0x3d8b0f=_0x5fc82e;try{await database_1[_0x3d8b0f(0x1a6)]['currencyRate'][_0x3d8b0f(0x16d)]({'where':{'currency':_0x4bedee[_0x3d8b0f(0x1c9)]()},'update':{'rate':_0x17e9a7},'create':{'currency':_0x4bedee[_0x3d8b0f(0x1c9)](),'rate':_0x17e9a7}});}catch(_0x1dd3e7){console[_0x3d8b0f(0x15e)](_0x3d8b0f(0x18b)+_0x4bedee+':',_0x1dd3e7);}});await Promise[_0x5fc82e(0x16f)](_0x486b65),console[_0x5fc82e(0x1bb)](_0x5fc82e(0x1bf));}catch(_0x1df371){console[_0x5fc82e(0x15e)](_0x5fc82e(0x1a3),_0x1df371);throw _0x1df371;}}async['getCurrencyRate'](_0x29c569){const _0x251fb9=a39_0x5d1c50,_0x704c29=_0x29c569[_0x251fb9(0x1c9)]();if(_0x704c29===_0x251fb9(0x1d8))return 0x1;try{const _0x39ab47=await database_1['default'][_0x251fb9(0x188)][_0x251fb9(0x1cc)]({'where':{'currency':_0x704c29}});if(!_0x39ab47)return console[_0x251fb9(0x1ba)](_0x251fb9(0x1cb)+_0x29c569+_0x251fb9(0x1af)),0x1;return _0x39ab47[_0x251fb9(0x17d)];}catch(_0x144eda){return console[_0x251fb9(0x15e)](_0x251fb9(0x185)+_0x29c569+':',_0x144eda),0x1;}}async[a39_0x5d1c50(0x197)](_0x1e4237,_0x5a7379){const _0x26f14d=a39_0x5d1c50,_0x299d2c=_0x5a7379[_0x26f14d(0x1c9)]();if(_0x299d2c===_0x26f14d(0x1d8)){const _0x259a8e=_0x1e4237*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x26f14d(0x1bb)](_0x26f14d(0x186)+this[_0x26f14d(0x1d3)]+'%\x20markup\x20to\x20'+_0x1e4237+_0x26f14d(0x1c5)+_0x259a8e[_0x26f14d(0x1a0)](0x6)+_0x26f14d(0x178)),_0x259a8e;}try{const _0x4c7d21=await this[_0x26f14d(0x1c2)](_0x299d2c),_0x4251cb=_0x1e4237/_0x4c7d21,_0x42982f=_0x4251cb*(0x1+this[_0x26f14d(0x1d3)]/0x64);return console[_0x26f14d(0x1bb)](_0x26f14d(0x161)+_0x1e4237+'\x20'+_0x5a7379['toUpperCase']()+_0x26f14d(0x17f)+_0x4251cb[_0x26f14d(0x1a0)](0x6)+_0x26f14d(0x1cd)+this['MARKUP_PERCENTAGE']+_0x26f14d(0x18d)+_0x42982f['toFixed'](0x6)+_0x26f14d(0x192)+_0x4c7d21+')'),_0x42982f;}catch(_0x5591a1){console['error'](_0x26f14d(0x196)+_0x1e4237+'\x20'+_0x5a7379+_0x26f14d(0x172),_0x5591a1);const _0x39b20e=_0x1e4237*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x39b20e;}}async[a39_0x5d1c50(0x163)](_0x3bf3da){const _0x79854b=a39_0x5d1c50;let _0x38e045=0x0;for(const {amount:_0x2cf5e6,currency:_0xb4ee5c}of _0x3bf3da){const _0x2b988a=await this[_0x79854b(0x197)](_0x2cf5e6,_0xb4ee5c);_0x38e045+=_0x2b988a;}return _0x38e045;}async[a39_0x5d1c50(0x198)](){const _0x1eb442=a39_0x5d1c50;try{const _0x48b285=await database_1[_0x1eb442(0x1a6)]['currencyRate'][_0x1eb442(0x19f)]({'select':{'currency':!![],'rate':!![]}}),_0x6d7993={'usdt':0x1};return _0x48b285[_0x1eb442(0x19c)](_0x10ec42=>{const _0x101162=_0x1eb442;_0x6d7993[_0x10ec42[_0x101162(0x1d4)]]=_0x10ec42[_0x101162(0x17d)];}),_0x6d7993;}catch(_0x4f2c5b){return console['error']('Error\x20getting\x20all\x20rates:',_0x4f2c5b),{'usdt':0x1};}}async[a39_0x5d1c50(0x169)](){const _0x358ec2=a39_0x5d1c50;try{const [_0x3e73f0,_0x5e5f7d,_0x4b7d40]=await Promise[_0x358ec2(0x167)]([database_1[_0x358ec2(0x1a6)][_0x358ec2(0x188)][_0x358ec2(0x173)](),database_1[_0x358ec2(0x1a6)][_0x358ec2(0x188)][_0x358ec2(0x193)]({'orderBy':{'updatedAt':_0x358ec2(0x1d5)},'select':{'updatedAt':!![]}}),database_1['default'][_0x358ec2(0x188)][_0x358ec2(0x193)]({'orderBy':{'updatedAt':_0x358ec2(0x1b8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3e73f0,'lastUpdated':_0x5e5f7d?.['updatedAt']||null,'oldestRate':_0x4b7d40?.[_0x358ec2(0x187)]||null,'markupPercentage':this[_0x358ec2(0x1d3)]};}catch(_0x346c23){return console['error'](_0x358ec2(0x17e),_0x346c23),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x5d1c50(0x1bd)](){const _0x5a8766=a39_0x5d1c50;return this[_0x5a8766(0x1d3)];}}exports[a39_0x5d1c50(0x1ce)]=CurrencyService,exports[a39_0x5d1c50(0x1c0)]=new CurrencyService();