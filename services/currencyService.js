'use strict';const a36_0x6b2014=a36_0xe293;(function(_0x2c01ef,_0x442275){const _0x85c237=a36_0xe293,_0x3c1aa9=_0x2c01ef();while(!![]){try{const _0x586539=-parseInt(_0x85c237(0x90))/0x1+-parseInt(_0x85c237(0x97))/0x2+-parseInt(_0x85c237(0xc1))/0x3+parseInt(_0x85c237(0xe8))/0x4*(parseInt(_0x85c237(0xd3))/0x5)+parseInt(_0x85c237(0xc4))/0x6*(-parseInt(_0x85c237(0x8a))/0x7)+parseInt(_0x85c237(0xa2))/0x8*(parseInt(_0x85c237(0x9f))/0x9)+-parseInt(_0x85c237(0xbd))/0xa*(-parseInt(_0x85c237(0x8f))/0xb);if(_0x586539===_0x442275)break;else _0x3c1aa9['push'](_0x3c1aa9['shift']());}catch(_0x5aa6ad){_0x3c1aa9['push'](_0x3c1aa9['shift']());}}}(a36_0x1df8,0x2a6ad));var __importDefault=this&&this[a36_0x6b2014(0x8e)]||function(_0x150b3f){const _0x2b7666=a36_0x6b2014;return _0x150b3f&&_0x150b3f[_0x2b7666(0xd2)]?_0x150b3f:{'default':_0x150b3f};};Object[a36_0x6b2014(0xed)](exports,'__esModule',{'value':!![]}),exports[a36_0x6b2014(0xd6)]=exports[a36_0x6b2014(0x9c)]=void 0x0;function a36_0xe293(_0x1ad70d,_0x635734){const _0x1df81f=a36_0x1df8();return a36_0xe293=function(_0xe293d6,_0x1f31e0){_0xe293d6=_0xe293d6-0x86;let _0x20122d=_0x1df81f[_0xe293d6];return _0x20122d;},a36_0xe293(_0x1ad70d,_0x635734);}const database_1=__importDefault(require('../config/database'));function a36_0x1df8(){const _0x1dc599=['?ids=tether&vs_currencies=','\x20to\x20','getRatesStatus','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','error','cad','count','toUpperCase','convertMultipleToUSDT','COINGECKO_URL','bits','ils','CURRENCIES','updatedAt','length','mxn','xrp','380TrLoWy','%\x20markup\x20to\x20','Error\x20getting\x20all\x20rates:','sar','450789ziDqVY','📊\x20Received\x20rates\x20for\x20','ngn','462TNHfZF','yfi','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Failed\x20to\x20update\x20rate\x20for\x20','log','%\x20markup\x20=\x20','thb','json','eos','try','\x20USDT\x20(rate:\x20','clp','xag','pkr','__esModule','27585JrSTEy','mmk','💱\x20Applied\x20','currencyService','updateCurrencyRates','toLowerCase','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','czk','getMarkupPercentage','tether','currency','kwd','TesSoft\x20Payment\x20System/1.0','findFirst','warn','stopPeriodicUpdates','desc','MARKUP_PERCENTAGE','catch','CoinGecko\x20API\x20error:\x20','getCurrencyRate','52wZowWw','hkd','huf','aed','eth','defineProperty','No\x20rate\x20found\x20for\x20currency:\x20','findMany','uah','dkk','eur','startPeriodicUpdates','dot','bnb','nok','Initial\x20currency\x20rates\x20update\x20failed:','nzd','link','default','map','bdt','ars','myr','join','toFixed','idr','bmd','xlm','chf','twd','statusText','19292HEosYj','convertToUSDT','vnd','usd','__importDefault','163867dofYDb','302820JowhTw','php','zar','vef','brl','sats','currencyRate','219072EBYzIa','💱\x20Converted\x20','https://api.coingecko.com/api/v3/simple/price','rub','cny','CurrencyService','forEach','getAllRates','2796885JLjBMg','krw','rate','8DLDZPq','status','inr','application/json','Periodic\x20currency\x20rates\x20update\x20failed:','usdt',',\x20using\x201\x20as\x20fallback','bhd','updateInterval','\x20USDT\x20=\x20'];a36_0x1df8=function(){return _0x1dc599;};return a36_0x1df8();}class CurrencyService{constructor(){const _0x1d0aa0=a36_0x6b2014;this[_0x1d0aa0(0xb5)]=_0x1d0aa0(0x99),this[_0x1d0aa0(0xb8)]=['btc',_0x1d0aa0(0xec),'ltc','bch',_0x1d0aa0(0xf5),_0x1d0aa0(0xcc),_0x1d0aa0(0xbc),_0x1d0aa0(0x86),_0x1d0aa0(0xf9),_0x1d0aa0(0xf4),_0x1d0aa0(0xc5),_0x1d0aa0(0x8d),_0x1d0aa0(0xeb),_0x1d0aa0(0xfd),'aud',_0x1d0aa0(0xfc),_0x1d0aa0(0xa9),_0x1d0aa0(0x102),_0x1d0aa0(0x94),_0x1d0aa0(0xb1),_0x1d0aa0(0x87),_0x1d0aa0(0xcf),_0x1d0aa0(0x9b),_0x1d0aa0(0xda),_0x1d0aa0(0xf1),_0x1d0aa0(0xf2),'gbp','gel',_0x1d0aa0(0xe9),_0x1d0aa0(0xea),_0x1d0aa0(0x101),_0x1d0aa0(0xb7),_0x1d0aa0(0xa4),'jpy',_0x1d0aa0(0xa0),_0x1d0aa0(0xde),'lkr',_0x1d0aa0(0xd4),_0x1d0aa0(0xbb),_0x1d0aa0(0xfe),_0x1d0aa0(0xc3),_0x1d0aa0(0xf6),_0x1d0aa0(0xf8),_0x1d0aa0(0x91),_0x1d0aa0(0xd1),'pln',_0x1d0aa0(0x9a),_0x1d0aa0(0xc0),'sek','sgd',_0x1d0aa0(0xca),_0x1d0aa0(0xcd),_0x1d0aa0(0x88),_0x1d0aa0(0xf0),_0x1d0aa0(0x93),_0x1d0aa0(0x8c),_0x1d0aa0(0x92),'xdr',_0x1d0aa0(0xd0),'xau',_0x1d0aa0(0xb6),_0x1d0aa0(0x95)],this[_0x1d0aa0(0xaa)]=null,this[_0x1d0aa0(0xe4)]=0x3,this['startPeriodicUpdates']();}[a36_0x6b2014(0xf3)](){const _0x24aee8=a36_0x6b2014;this[_0x24aee8(0xd7)]()[_0x24aee8(0xe5)](_0x1a9ce6=>{const _0x3c7c6c=_0x24aee8;console[_0x3c7c6c(0xb0)](_0x3c7c6c(0xf7),_0x1a9ce6);}),this[_0x24aee8(0xaa)]=setInterval(async()=>{const _0x218e2f=_0x24aee8;try{await this['updateCurrencyRates']();}catch(_0x94aba8){console['error'](_0x218e2f(0xa6),_0x94aba8);}},0x3c*0x3c*0x3e8),console['log'](_0x24aee8(0xc6));}[a36_0x6b2014(0xe2)](){const _0x4c90b8=a36_0x6b2014;this[_0x4c90b8(0xaa)]&&(clearInterval(this[_0x4c90b8(0xaa)]),this[_0x4c90b8(0xaa)]=null,console[_0x4c90b8(0xc8)](_0x4c90b8(0xd9)));}async[a36_0x6b2014(0xd7)](){const _0xec5803=a36_0x6b2014;try{console[_0xec5803(0xc8)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x11a64e=this[_0xec5803(0xb8)][_0xec5803(0xff)](','),_0xb6e279=this['COINGECKO_URL']+_0xec5803(0xac)+_0x11a64e,_0x128365=await fetch(_0xb6e279,{'headers':{'Accept':_0xec5803(0xa5),'User-Agent':_0xec5803(0xdf)}});if(!_0x128365['ok'])throw new Error(_0xec5803(0xe6)+_0x128365[_0xec5803(0xa3)]+'\x20'+_0x128365[_0xec5803(0x89)]);const _0x97526=await _0x128365[_0xec5803(0xcb)]();if(!_0x97526[_0xec5803(0xdc)])throw new Error(_0xec5803(0xaf));const _0x179cd4=_0x97526[_0xec5803(0xdc)];console[_0xec5803(0xc8)](_0xec5803(0xc2)+Object['keys'](_0x179cd4)[_0xec5803(0xba)]+'\x20currencies');const _0x5e3434=Object['entries'](_0x179cd4)[_0xec5803(0xfb)](async([_0x2ee80e,_0x29ee83])=>{const _0x1aa84c=_0xec5803;try{await database_1['default'][_0x1aa84c(0x96)]['upsert']({'where':{'currency':_0x2ee80e['toLowerCase']()},'update':{'rate':_0x29ee83},'create':{'currency':_0x2ee80e[_0x1aa84c(0xd8)](),'rate':_0x29ee83}});}catch(_0x238b41){console[_0x1aa84c(0xb0)](_0x1aa84c(0xc7)+_0x2ee80e+':',_0x238b41);}});await Promise['allSettled'](_0x5e3434),console[_0xec5803(0xc8)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x549e83){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x549e83);throw _0x549e83;}}async[a36_0x6b2014(0xe7)](_0x1b947b){const _0x5defc2=a36_0x6b2014,_0x2cca78=_0x1b947b['toLowerCase']();if(_0x2cca78==='usdt')return 0x1;try{const _0x10b28e=await database_1['default'][_0x5defc2(0x96)]['findUnique']({'where':{'currency':_0x2cca78}});if(!_0x10b28e)return console[_0x5defc2(0xe1)](_0x5defc2(0xee)+_0x1b947b+_0x5defc2(0xa8)),0x1;return _0x10b28e[_0x5defc2(0xa1)];}catch(_0x5d0697){return console[_0x5defc2(0xb0)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1b947b+':',_0x5d0697),0x1;}}async[a36_0x6b2014(0x8b)](_0x2a08a5,_0x551e51){const _0x251f77=a36_0x6b2014,_0x2e491f=_0x551e51[_0x251f77(0xd8)]();if(_0x2e491f===_0x251f77(0xa7)){const _0x18fd17=_0x2a08a5*(0x1+this[_0x251f77(0xe4)]/0x64);return console['log'](_0x251f77(0xd5)+this[_0x251f77(0xe4)]+_0x251f77(0xbe)+_0x2a08a5+_0x251f77(0xab)+_0x18fd17['toFixed'](0x6)+'\x20USDT'),_0x18fd17;}try{const _0x25c1bf=await this[_0x251f77(0xe7)](_0x2e491f),_0x377658=_0x2a08a5/_0x25c1bf,_0x186f2d=_0x377658*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x251f77(0xc8)](_0x251f77(0x98)+_0x2a08a5+'\x20'+_0x551e51[_0x251f77(0xb3)]()+_0x251f77(0xad)+_0x377658[_0x251f77(0x100)](0x6)+'\x20USDT,\x20with\x20'+this[_0x251f77(0xe4)]+_0x251f77(0xc9)+_0x186f2d[_0x251f77(0x100)](0x6)+_0x251f77(0xce)+_0x25c1bf+')'),_0x186f2d;}catch(_0x1f2b32){console[_0x251f77(0xb0)]('Error\x20converting\x20'+_0x2a08a5+'\x20'+_0x551e51+'\x20to\x20USDT:',_0x1f2b32);const _0x27e232=_0x2a08a5*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x27e232;}}async[a36_0x6b2014(0xb4)](_0x2a1743){let _0x3c7aef=0x0;for(const {amount:_0x3b2a60,currency:_0x4619fc}of _0x2a1743){const _0x1de866=await this['convertToUSDT'](_0x3b2a60,_0x4619fc);_0x3c7aef+=_0x1de866;}return _0x3c7aef;}async[a36_0x6b2014(0x9e)](){const _0x144e76=a36_0x6b2014;try{const _0x511429=await database_1['default']['currencyRate'][_0x144e76(0xef)]({'select':{'currency':!![],'rate':!![]}}),_0x4ebe61={'usdt':0x1};return _0x511429[_0x144e76(0x9d)](_0x2994e7=>{const _0x34f488=_0x144e76;_0x4ebe61[_0x2994e7[_0x34f488(0xdd)]]=_0x2994e7['rate'];}),_0x4ebe61;}catch(_0x5e12f3){return console[_0x144e76(0xb0)](_0x144e76(0xbf),_0x5e12f3),{'usdt':0x1};}}async[a36_0x6b2014(0xae)](){const _0x50b086=a36_0x6b2014;try{const [_0x21f0a7,_0xb7183a,_0x421905]=await Promise['all']([database_1['default']['currencyRate'][_0x50b086(0xb2)](),database_1[_0x50b086(0xfa)][_0x50b086(0x96)][_0x50b086(0xe0)]({'orderBy':{'updatedAt':_0x50b086(0xe3)},'select':{'updatedAt':!![]}}),database_1[_0x50b086(0xfa)][_0x50b086(0x96)][_0x50b086(0xe0)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x21f0a7,'lastUpdated':_0xb7183a?.['updatedAt']||null,'oldestRate':_0x421905?.[_0x50b086(0xb9)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x16f71b){return console[_0x50b086(0xb0)]('Error\x20getting\x20rates\x20status:',_0x16f71b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x50b086(0xe4)]};}}[a36_0x6b2014(0xdb)](){return this['MARKUP_PERCENTAGE'];}}exports[a36_0x6b2014(0x9c)]=CurrencyService,exports['currencyService']=new CurrencyService();