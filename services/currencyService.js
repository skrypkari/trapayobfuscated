'use strict';function a38_0x2ee9(){const _0x4b1d5a=['usdt','inr','__importDefault','map','bhd','log','61880hjmxdC',',\x20using\x201\x20as\x20fallback','1axepAC','✅\x20Currency\x20rates\x20updated\x20successfully','keys','catch','pkr','warn','zar','?ids=tether&vs_currencies=','rate','cad','json','\x20USDT','mmk','7IYZxlP','bmd','upsert','CURRENCIES','defineProperty','Error\x20converting\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','findMany','Failed\x20to\x20update\x20rate\x20for\x20','Initial\x20currency\x20rates\x20update\x20failed:','bdt','xdr','toUpperCase','MARKUP_PERCENTAGE','myr','sgd','xag','getMarkupPercentage','convertMultipleToUSDT','brl','vef','COINGECKO_URL','❌\x20Failed\x20to\x20update\x20currency\x20rates:','entries','kwd','CurrencyService','902187RIxCDc','currencyService','16tCzTRk','../config/database','xau','updateCurrencyRates','575290YILAzL','findUnique','xrp','getCurrencyRate','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','asc','usd','sar','📊\x20Received\x20rates\x20for\x20','TesSoft\x20Payment\x20System/1.0','Error\x20getting\x20rate\x20for\x20currency\x20','eur','bnb','gbp','ngn','startPeriodicUpdates','uah','bits','No\x20rate\x20found\x20for\x20currency:\x20','Periodic\x20currency\x20rates\x20update\x20failed:','sats','php','__esModule','Error\x20getting\x20rates\x20status:','aed','thb','ltc','%\x20markup\x20=\x20','error','chf','forEach','lkr','application/json','idr','203670eAnLIi','all','toLowerCase','1025496xncOSG','\x20USDT\x20(rate:\x20','gel','currencyRate','findFirst','huf','nok','169925teNSat','pln','desc','try','sek','getAllRates','CoinGecko\x20API\x20error:\x20','nzd','tether','status','join','\x20USDT,\x20with\x20','bch','updatedAt','default','rub','mxn','length','vnd','currency','dkk','aud','hkd','convertToUSDT','jpy','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','updateInterval','btc','yfi','423129JoaZZV','%\x20markup\x20to\x20','toFixed','cny'];a38_0x2ee9=function(){return _0x4b1d5a;};return a38_0x2ee9();}const a38_0x5d1e74=a38_0x3d31;function a38_0x3d31(_0x452e53,_0x266513){const _0x2ee9c6=a38_0x2ee9();return a38_0x3d31=function(_0x3d3195,_0x4488ad){_0x3d3195=_0x3d3195-0x16c;let _0x3bc8ac=_0x2ee9c6[_0x3d3195];return _0x3bc8ac;},a38_0x3d31(_0x452e53,_0x266513);}(function(_0x30df82,_0x10e7fa){const _0x591ad1=a38_0x3d31,_0xca831=_0x30df82();while(!![]){try{const _0x9f33d1=parseInt(_0x591ad1(0x18b))/0x1*(parseInt(_0x591ad1(0x1da))/0x2)+parseInt(_0x591ad1(0x17f))/0x3+parseInt(_0x591ad1(0x1b4))/0x4*(-parseInt(_0x591ad1(0x1e4))/0x5)+-parseInt(_0x591ad1(0x1dd))/0x6*(parseInt(_0x591ad1(0x198))/0x7)+parseInt(_0x591ad1(0x189))/0x8+parseInt(_0x591ad1(0x1b2))/0x9+parseInt(_0x591ad1(0x1b8))/0xa;if(_0x9f33d1===_0x10e7fa)break;else _0xca831['push'](_0xca831['shift']());}catch(_0x349c6f){_0xca831['push'](_0xca831['shift']());}}}(a38_0x2ee9,0x18c99));var __importDefault=this&&this[a38_0x5d1e74(0x185)]||function(_0x5b5962){return _0x5b5962&&_0x5b5962['__esModule']?_0x5b5962:{'default':_0x5b5962};};Object[a38_0x5d1e74(0x19c)](exports,a38_0x5d1e74(0x1ce),{'value':!![]}),exports['currencyService']=exports[a38_0x5d1e74(0x1b1)]=void 0x0;const database_1=__importDefault(require(a38_0x5d1e74(0x1b5)));class CurrencyService{constructor(){const _0xee62b7=a38_0x5d1e74;this[_0xee62b7(0x1ad)]='https://api.coingecko.com/api/v3/simple/price',this[_0xee62b7(0x19b)]=[_0xee62b7(0x17d),'eth',_0xee62b7(0x1d2),_0xee62b7(0x16e),_0xee62b7(0x1c4),'eos',_0xee62b7(0x1ba),'xlm','link','dot',_0xee62b7(0x17e),_0xee62b7(0x1be),_0xee62b7(0x1d0),'ars',_0xee62b7(0x177),_0xee62b7(0x1a2),_0xee62b7(0x187),_0xee62b7(0x199),_0xee62b7(0x1ab),_0xee62b7(0x194),_0xee62b7(0x1d5),'clp',_0xee62b7(0x182),'czk',_0xee62b7(0x176),_0xee62b7(0x1c3),_0xee62b7(0x1c5),_0xee62b7(0x1df),_0xee62b7(0x178),_0xee62b7(0x1e2),_0xee62b7(0x1d9),'ils',_0xee62b7(0x184),_0xee62b7(0x17a),'krw',_0xee62b7(0x1b0),_0xee62b7(0x1d7),_0xee62b7(0x197),_0xee62b7(0x172),_0xee62b7(0x1a6),_0xee62b7(0x1c6),_0xee62b7(0x1e3),_0xee62b7(0x1eb),_0xee62b7(0x1cd),_0xee62b7(0x18f),_0xee62b7(0x1e5),_0xee62b7(0x171),_0xee62b7(0x1bf),_0xee62b7(0x1e8),_0xee62b7(0x1a7),_0xee62b7(0x1d1),_0xee62b7(0x1e7),'twd',_0xee62b7(0x1c8),_0xee62b7(0x1ac),_0xee62b7(0x174),_0xee62b7(0x191),_0xee62b7(0x1a3),_0xee62b7(0x1a8),_0xee62b7(0x1b6),_0xee62b7(0x1c9),_0xee62b7(0x1cc)],this[_0xee62b7(0x17c)]=null,this['MARKUP_PERCENTAGE']=0x3,this['startPeriodicUpdates']();}[a38_0x5d1e74(0x1c7)](){const _0x5a3d70=a38_0x5d1e74;this['updateCurrencyRates']()[_0x5a3d70(0x18e)](_0x38a851=>{const _0x494bbb=_0x5a3d70;console[_0x494bbb(0x1d4)](_0x494bbb(0x1a1),_0x38a851);}),this['updateInterval']=setInterval(async()=>{const _0x4fa4f7=_0x5a3d70;try{await this[_0x4fa4f7(0x1b7)]();}catch(_0x3ab8b1){console[_0x4fa4f7(0x1d4)](_0x4fa4f7(0x1cb),_0x3ab8b1);}},0x3c*0x3c*0x3e8),console[_0x5a3d70(0x188)](_0x5a3d70(0x19e));}['stopPeriodicUpdates'](){const _0x4a28b5=a38_0x5d1e74;this[_0x4a28b5(0x17c)]&&(clearInterval(this['updateInterval']),this[_0x4a28b5(0x17c)]=null,console['log'](_0x4a28b5(0x17b)));}async[a38_0x5d1e74(0x1b7)](){const _0x5632b2=a38_0x5d1e74;try{console['log'](_0x5632b2(0x1bc));const _0x5afc82=this[_0x5632b2(0x19b)][_0x5632b2(0x16c)](','),_0x10049e=this[_0x5632b2(0x1ad)]+_0x5632b2(0x192)+_0x5afc82,_0x4e1ce5=await fetch(_0x10049e,{'headers':{'Accept':_0x5632b2(0x1d8),'User-Agent':_0x5632b2(0x1c1)}});if(!_0x4e1ce5['ok'])throw new Error(_0x5632b2(0x1ea)+_0x4e1ce5[_0x5632b2(0x1ed)]+'\x20'+_0x4e1ce5['statusText']);const _0x448ff4=await _0x4e1ce5[_0x5632b2(0x195)]();if(!_0x448ff4[_0x5632b2(0x1ec)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x26ebad=_0x448ff4[_0x5632b2(0x1ec)];console[_0x5632b2(0x188)](_0x5632b2(0x1c0)+Object[_0x5632b2(0x18d)](_0x26ebad)[_0x5632b2(0x173)]+'\x20currencies');const _0x3d42c6=Object[_0x5632b2(0x1af)](_0x26ebad)[_0x5632b2(0x186)](async([_0x333e87,_0x2374b0])=>{const _0x4ddaa5=_0x5632b2;try{await database_1[_0x4ddaa5(0x170)][_0x4ddaa5(0x1e0)][_0x4ddaa5(0x19a)]({'where':{'currency':_0x333e87[_0x4ddaa5(0x1dc)]()},'update':{'rate':_0x2374b0},'create':{'currency':_0x333e87[_0x4ddaa5(0x1dc)](),'rate':_0x2374b0}});}catch(_0x5b08b9){console['error'](_0x4ddaa5(0x1a0)+_0x333e87+':',_0x5b08b9);}});await Promise['allSettled'](_0x3d42c6),console[_0x5632b2(0x188)](_0x5632b2(0x18c));}catch(_0x194673){console['error'](_0x5632b2(0x1ae),_0x194673);throw _0x194673;}}async[a38_0x5d1e74(0x1bb)](_0x1af384){const _0x164d97=a38_0x5d1e74,_0x1845c7=_0x1af384['toLowerCase']();if(_0x1845c7==='usdt')return 0x1;try{const _0x911263=await database_1[_0x164d97(0x170)]['currencyRate'][_0x164d97(0x1b9)]({'where':{'currency':_0x1845c7}});if(!_0x911263)return console[_0x164d97(0x190)](_0x164d97(0x1ca)+_0x1af384+_0x164d97(0x18a)),0x1;return _0x911263['rate'];}catch(_0x18baff){return console[_0x164d97(0x1d4)](_0x164d97(0x1c2)+_0x1af384+':',_0x18baff),0x1;}}async[a38_0x5d1e74(0x179)](_0x20170c,_0x36bd06){const _0x3fc175=a38_0x5d1e74,_0x5af91a=_0x36bd06[_0x3fc175(0x1dc)]();if(_0x5af91a===_0x3fc175(0x183)){const _0x212d4c=_0x20170c*(0x1+this[_0x3fc175(0x1a5)]/0x64);return console[_0x3fc175(0x188)]('💱\x20Applied\x20'+this[_0x3fc175(0x1a5)]+_0x3fc175(0x180)+_0x20170c+'\x20USDT\x20=\x20'+_0x212d4c[_0x3fc175(0x181)](0x6)+_0x3fc175(0x196)),_0x212d4c;}try{const _0xaadae4=await this['getCurrencyRate'](_0x5af91a),_0x360849=_0x20170c/_0xaadae4,_0x110ad8=_0x360849*(0x1+this[_0x3fc175(0x1a5)]/0x64);return console['log']('💱\x20Converted\x20'+_0x20170c+'\x20'+_0x36bd06[_0x3fc175(0x1a4)]()+'\x20to\x20'+_0x360849[_0x3fc175(0x181)](0x6)+_0x3fc175(0x16d)+this[_0x3fc175(0x1a5)]+_0x3fc175(0x1d3)+_0x110ad8['toFixed'](0x6)+_0x3fc175(0x1de)+_0xaadae4+')'),_0x110ad8;}catch(_0x1ba042){console[_0x3fc175(0x1d4)](_0x3fc175(0x19d)+_0x20170c+'\x20'+_0x36bd06+'\x20to\x20USDT:',_0x1ba042);const _0x558ebe=_0x20170c*(0x1+this[_0x3fc175(0x1a5)]/0x64);return _0x558ebe;}}async[a38_0x5d1e74(0x1aa)](_0x4788aa){const _0x375291=a38_0x5d1e74;let _0x2ce902=0x0;for(const {amount:_0x31ed46,currency:_0x1330da}of _0x4788aa){const _0x32e4ef=await this[_0x375291(0x179)](_0x31ed46,_0x1330da);_0x2ce902+=_0x32e4ef;}return _0x2ce902;}async[a38_0x5d1e74(0x1e9)](){const _0x2c4d99=a38_0x5d1e74;try{const _0xa0dbbf=await database_1[_0x2c4d99(0x170)][_0x2c4d99(0x1e0)][_0x2c4d99(0x19f)]({'select':{'currency':!![],'rate':!![]}}),_0x1fa8cb={'usdt':0x1};return _0xa0dbbf[_0x2c4d99(0x1d6)](_0x42e6a1=>{const _0x1b4f46=_0x2c4d99;_0x1fa8cb[_0x42e6a1[_0x1b4f46(0x175)]]=_0x42e6a1[_0x1b4f46(0x193)];}),_0x1fa8cb;}catch(_0x41ba76){return console[_0x2c4d99(0x1d4)]('Error\x20getting\x20all\x20rates:',_0x41ba76),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2ab10b=a38_0x5d1e74;try{const [_0x1d86ed,_0x5a95ab,_0x19d824]=await Promise[_0x2ab10b(0x1db)]([database_1[_0x2ab10b(0x170)][_0x2ab10b(0x1e0)]['count'](),database_1[_0x2ab10b(0x170)][_0x2ab10b(0x1e0)][_0x2ab10b(0x1e1)]({'orderBy':{'updatedAt':_0x2ab10b(0x1e6)},'select':{'updatedAt':!![]}}),database_1['default'][_0x2ab10b(0x1e0)][_0x2ab10b(0x1e1)]({'orderBy':{'updatedAt':_0x2ab10b(0x1bd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1d86ed,'lastUpdated':_0x5a95ab?.[_0x2ab10b(0x16f)]||null,'oldestRate':_0x19d824?.[_0x2ab10b(0x16f)]||null,'markupPercentage':this[_0x2ab10b(0x1a5)]};}catch(_0x18a7ad){return console[_0x2ab10b(0x1d4)](_0x2ab10b(0x1cf),_0x18a7ad),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2ab10b(0x1a5)]};}}[a38_0x5d1e74(0x1a9)](){const _0x12fbc1=a38_0x5d1e74;return this[_0x12fbc1(0x1a5)];}}exports[a38_0x5d1e74(0x1b1)]=CurrencyService,exports[a38_0x5d1e74(0x1b3)]=new CurrencyService();