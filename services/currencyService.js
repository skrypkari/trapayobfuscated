'use strict';const a38_0x7776dc=a38_0x5d91;(function(_0x2bf552,_0x5f7fe4){const _0x2d2f5e=a38_0x5d91,_0x5cb7ec=_0x2bf552();while(!![]){try{const _0x491d39=-parseInt(_0x2d2f5e(0x200))/0x1*(-parseInt(_0x2d2f5e(0x1ea))/0x2)+parseInt(_0x2d2f5e(0x22f))/0x3*(parseInt(_0x2d2f5e(0x211))/0x4)+parseInt(_0x2d2f5e(0x1c5))/0x5*(-parseInt(_0x2d2f5e(0x208))/0x6)+-parseInt(_0x2d2f5e(0x223))/0x7+-parseInt(_0x2d2f5e(0x1d2))/0x8*(-parseInt(_0x2d2f5e(0x21b))/0x9)+-parseInt(_0x2d2f5e(0x1e1))/0xa+-parseInt(_0x2d2f5e(0x1dd))/0xb*(parseInt(_0x2d2f5e(0x1f8))/0xc);if(_0x491d39===_0x5f7fe4)break;else _0x5cb7ec['push'](_0x5cb7ec['shift']());}catch(_0x111fa2){_0x5cb7ec['push'](_0x5cb7ec['shift']());}}}(a38_0x4358,0xeca3d));function a38_0x4358(){const _0x3a18c7=['220158gBJANU','bdt','\x20to\x20','toFixed','toUpperCase','tether','currencyRate','\x20currencies','usdt','508300zzVHYW','📊\x20Received\x20rates\x20for\x20','cad','MARKUP_PERCENTAGE','sek','https://api.coingecko.com/api/v3/simple/price','entries','eth','default','💱\x20Converted\x20','log','ltc','join','620952BAqPNH','findUnique','xau','currencyService','catch','Error\x20getting\x20all\x20rates:','COINGECKO_URL','Initial\x20currency\x20rates\x20update\x20failed:','getAllRates','getCurrencyRate','btc','1321353PTAdyE','inr','sats','ngn','5587930EdjbrR','gbp','xdr','ars','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','currency','link','keys','rate','42hUosah','CURRENCIES','eos','\x20USDT\x20(rate:\x20','__esModule','thb','vef','💱\x20Applied\x20','myr','CurrencyService','rub','updateCurrencyRates','TesSoft\x20Payment\x20System/1.0','jpy','36OLNMpD','ils','../config/database','Periodic\x20currency\x20rates\x20update\x20failed:','%\x20markup\x20to\x20','toLowerCase','kwd','lkr','110unabkY','bits','length','findFirst','?ids=tether&vs_currencies=','vnd','map','CoinGecko\x20API\x20error:\x20','42iVjxWu','idr','xrp','\x20USDT\x20=\x20','try','bmd','dkk','updateInterval','%\x20markup\x20=\x20','104HnlAzr','✅\x20Currency\x20rates\x20updated\x20successfully','cny','aud','error','mxn','uah','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','nzd','allSettled','216OFlsUn','mmk','\x20to\x20USDT:','convertToUSDT','Error\x20getting\x20rate\x20for\x20currency\x20','updatedAt','\x20USDT,\x20with\x20','getRatesStatus','8212001QhTIPL','brl','czk','aed','twd','bch','convertMultipleToUSDT','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','huf','usd','chf','php'];a38_0x4358=function(){return _0x3a18c7;};return a38_0x4358();}function a38_0x5d91(_0x1bc85b,_0x1ca5d4){const _0x4358e9=a38_0x4358();return a38_0x5d91=function(_0x5d916b,_0x25e1e2){_0x5d916b=_0x5d916b-0x1c4;let _0x41a82a=_0x4358e9[_0x5d916b];return _0x41a82a;},a38_0x5d91(_0x1bc85b,_0x1ca5d4);}var __importDefault=this&&this['__importDefault']||function(_0x5a87f3){return _0x5a87f3&&_0x5a87f3['__esModule']?_0x5a87f3:{'default':_0x5a87f3};};Object['defineProperty'](exports,a38_0x7776dc(0x1ee),{'value':!![]}),exports[a38_0x7776dc(0x1d5)]=exports[a38_0x7776dc(0x1f3)]=void 0x0;const database_1=__importDefault(require(a38_0x7776dc(0x1fa)));class CurrencyService{constructor(){const _0x80fceb=a38_0x7776dc;this[_0x80fceb(0x1d8)]=_0x80fceb(0x1ca),this[_0x80fceb(0x1eb)]=[_0x80fceb(0x1dc),_0x80fceb(0x1cc),_0x80fceb(0x1d0),_0x80fceb(0x228),'bnb',_0x80fceb(0x1ec),_0x80fceb(0x20a),'xlm',_0x80fceb(0x1e7),'dot','yfi',_0x80fceb(0x22c),_0x80fceb(0x226),_0x80fceb(0x1e4),_0x80fceb(0x214),_0x80fceb(0x230),'bhd',_0x80fceb(0x20d),_0x80fceb(0x224),_0x80fceb(0x1c7),_0x80fceb(0x22d),'clp',_0x80fceb(0x213),_0x80fceb(0x225),_0x80fceb(0x20e),'eur',_0x80fceb(0x1e2),'gel','hkd',_0x80fceb(0x22b),_0x80fceb(0x209),_0x80fceb(0x1f9),_0x80fceb(0x1de),_0x80fceb(0x1f7),'krw',_0x80fceb(0x1fe),_0x80fceb(0x1ff),_0x80fceb(0x21c),_0x80fceb(0x216),_0x80fceb(0x1f2),_0x80fceb(0x1e0),'nok',_0x80fceb(0x219),_0x80fceb(0x22e),'pkr','pln',_0x80fceb(0x1f4),'sar',_0x80fceb(0x1c9),'sgd',_0x80fceb(0x1ef),_0x80fceb(0x20c),_0x80fceb(0x227),_0x80fceb(0x217),_0x80fceb(0x1f0),_0x80fceb(0x205),'zar',_0x80fceb(0x1e3),'xag',_0x80fceb(0x1d4),_0x80fceb(0x201),_0x80fceb(0x1df)],this[_0x80fceb(0x20f)]=null,this[_0x80fceb(0x1c8)]=0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x22fd42=a38_0x7776dc;this[_0x22fd42(0x1f5)]()[_0x22fd42(0x1d6)](_0x13d23a=>{const _0x3caecb=_0x22fd42;console[_0x3caecb(0x215)](_0x3caecb(0x1d9),_0x13d23a);}),this[_0x22fd42(0x20f)]=setInterval(async()=>{const _0xae083a=_0x22fd42;try{await this['updateCurrencyRates']();}catch(_0x20fd1f){console[_0xae083a(0x215)](_0xae083a(0x1fb),_0x20fd1f);}},0x3c*0x3c*0x3e8),console[_0x22fd42(0x1cf)](_0x22fd42(0x218));}['stopPeriodicUpdates'](){const _0x56eb29=a38_0x7776dc;this[_0x56eb29(0x20f)]&&(clearInterval(this[_0x56eb29(0x20f)]),this['updateInterval']=null,console[_0x56eb29(0x1cf)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x7776dc(0x1f5)](){const _0x2bebd8=a38_0x7776dc;try{console['log'](_0x2bebd8(0x1e5));const _0x113c16=this[_0x2bebd8(0x1eb)][_0x2bebd8(0x1d1)](','),_0x3a391a=this['COINGECKO_URL']+_0x2bebd8(0x204)+_0x113c16,_0x4a3248=await fetch(_0x3a391a,{'headers':{'Accept':'application/json','User-Agent':_0x2bebd8(0x1f6)}});if(!_0x4a3248['ok'])throw new Error(_0x2bebd8(0x207)+_0x4a3248['status']+'\x20'+_0x4a3248['statusText']);const _0x2dd092=await _0x4a3248['json']();if(!_0x2dd092[_0x2bebd8(0x234)])throw new Error(_0x2bebd8(0x22a));const _0x2a99a9=_0x2dd092[_0x2bebd8(0x234)];console[_0x2bebd8(0x1cf)](_0x2bebd8(0x1c6)+Object[_0x2bebd8(0x1e8)](_0x2a99a9)[_0x2bebd8(0x202)]+_0x2bebd8(0x236));const _0x2be9dd=Object[_0x2bebd8(0x1cb)](_0x2a99a9)[_0x2bebd8(0x206)](async([_0x742497,_0x3910d8])=>{const _0x596c7e=_0x2bebd8;try{await database_1[_0x596c7e(0x1cd)][_0x596c7e(0x235)]['upsert']({'where':{'currency':_0x742497['toLowerCase']()},'update':{'rate':_0x3910d8},'create':{'currency':_0x742497[_0x596c7e(0x1fd)](),'rate':_0x3910d8}});}catch(_0x46e501){console[_0x596c7e(0x215)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x742497+':',_0x46e501);}});await Promise[_0x2bebd8(0x21a)](_0x2be9dd),console[_0x2bebd8(0x1cf)](_0x2bebd8(0x212));}catch(_0x2122a5){console[_0x2bebd8(0x215)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x2122a5);throw _0x2122a5;}}async[a38_0x7776dc(0x1db)](_0x58a6da){const _0x3065e5=a38_0x7776dc,_0x32b816=_0x58a6da[_0x3065e5(0x1fd)]();if(_0x32b816===_0x3065e5(0x1c4))return 0x1;try{const _0x3fb45b=await database_1[_0x3065e5(0x1cd)][_0x3065e5(0x235)][_0x3065e5(0x1d3)]({'where':{'currency':_0x32b816}});if(!_0x3fb45b)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x58a6da+',\x20using\x201\x20as\x20fallback'),0x1;return _0x3fb45b[_0x3065e5(0x1e9)];}catch(_0x5721fe){return console[_0x3065e5(0x215)](_0x3065e5(0x21f)+_0x58a6da+':',_0x5721fe),0x1;}}async[a38_0x7776dc(0x21e)](_0x54f2b5,_0x4ea33c){const _0x508dd1=a38_0x7776dc,_0x36d691=_0x4ea33c[_0x508dd1(0x1fd)]();if(_0x36d691==='usdt'){const _0x10a0f8=_0x54f2b5*(0x1+this[_0x508dd1(0x1c8)]/0x64);return console[_0x508dd1(0x1cf)](_0x508dd1(0x1f1)+this[_0x508dd1(0x1c8)]+_0x508dd1(0x1fc)+_0x54f2b5+_0x508dd1(0x20b)+_0x10a0f8[_0x508dd1(0x232)](0x6)+'\x20USDT'),_0x10a0f8;}try{const _0x2bcdf4=await this[_0x508dd1(0x1db)](_0x36d691),_0x161d02=_0x54f2b5/_0x2bcdf4,_0x348d30=_0x161d02*(0x1+this[_0x508dd1(0x1c8)]/0x64);return console['log'](_0x508dd1(0x1ce)+_0x54f2b5+'\x20'+_0x4ea33c[_0x508dd1(0x233)]()+_0x508dd1(0x231)+_0x161d02[_0x508dd1(0x232)](0x6)+_0x508dd1(0x221)+this[_0x508dd1(0x1c8)]+_0x508dd1(0x210)+_0x348d30[_0x508dd1(0x232)](0x6)+_0x508dd1(0x1ed)+_0x2bcdf4+')'),_0x348d30;}catch(_0x326997){console[_0x508dd1(0x215)]('Error\x20converting\x20'+_0x54f2b5+'\x20'+_0x4ea33c+_0x508dd1(0x21d),_0x326997);const _0x572c55=_0x54f2b5*(0x1+this[_0x508dd1(0x1c8)]/0x64);return _0x572c55;}}async[a38_0x7776dc(0x229)](_0x1b1f5b){let _0x21d904=0x0;for(const {amount:_0x32fbb8,currency:_0x176cf6}of _0x1b1f5b){const _0x2690f0=await this['convertToUSDT'](_0x32fbb8,_0x176cf6);_0x21d904+=_0x2690f0;}return _0x21d904;}async[a38_0x7776dc(0x1da)](){const _0x56ee07=a38_0x7776dc;try{const _0x5a3fdf=await database_1[_0x56ee07(0x1cd)][_0x56ee07(0x235)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x46d6d2={'usdt':0x1};return _0x5a3fdf['forEach'](_0x1679ed=>{const _0x64ad64=_0x56ee07;_0x46d6d2[_0x1679ed[_0x64ad64(0x1e6)]]=_0x1679ed[_0x64ad64(0x1e9)];}),_0x46d6d2;}catch(_0x125927){return console[_0x56ee07(0x215)](_0x56ee07(0x1d7),_0x125927),{'usdt':0x1};}}async[a38_0x7776dc(0x222)](){const _0x1d6cd6=a38_0x7776dc;try{const [_0x54d182,_0x5ac05f,_0x533402]=await Promise['all']([database_1['default']['currencyRate']['count'](),database_1[_0x1d6cd6(0x1cd)][_0x1d6cd6(0x235)][_0x1d6cd6(0x203)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x1d6cd6(0x1cd)]['currencyRate'][_0x1d6cd6(0x203)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x54d182,'lastUpdated':_0x5ac05f?.['updatedAt']||null,'oldestRate':_0x533402?.[_0x1d6cd6(0x220)]||null,'markupPercentage':this[_0x1d6cd6(0x1c8)]};}catch(_0x489c69){return console[_0x1d6cd6(0x215)]('Error\x20getting\x20rates\x20status:',_0x489c69),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1d6cd6(0x1c8)]};}}['getMarkupPercentage'](){const _0x4a08f8=a38_0x7776dc;return this[_0x4a08f8(0x1c8)];}}exports[a38_0x7776dc(0x1f3)]=CurrencyService,exports[a38_0x7776dc(0x1d5)]=new CurrencyService();