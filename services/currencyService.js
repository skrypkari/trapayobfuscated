'use strict';const a38_0x385022=a38_0x2ee6;(function(_0x196e5e,_0x4833d6){const _0x200094=a38_0x2ee6,_0x28395b=_0x196e5e();while(!![]){try{const _0x4ccb2b=parseInt(_0x200094(0x1c7))/0x1*(parseInt(_0x200094(0x217))/0x2)+parseInt(_0x200094(0x1cf))/0x3*(-parseInt(_0x200094(0x21e))/0x4)+parseInt(_0x200094(0x1d8))/0x5*(parseInt(_0x200094(0x1fc))/0x6)+-parseInt(_0x200094(0x238))/0x7+parseInt(_0x200094(0x1bd))/0x8+-parseInt(_0x200094(0x1ee))/0x9+parseInt(_0x200094(0x1bb))/0xa*(parseInt(_0x200094(0x1c3))/0xb);if(_0x4ccb2b===_0x4833d6)break;else _0x28395b['push'](_0x28395b['shift']());}catch(_0x51eb83){_0x28395b['push'](_0x28395b['shift']());}}}(a38_0x4b1f,0x82f0d));var __importDefault=this&&this[a38_0x385022(0x219)]||function(_0x14a16f){const _0x13945f=a38_0x385022;return _0x14a16f&&_0x14a16f[_0x13945f(0x1be)]?_0x14a16f:{'default':_0x14a16f};};function a38_0x2ee6(_0x36339c,_0x141767){const _0x4b1fdc=a38_0x4b1f();return a38_0x2ee6=function(_0x2ee69e,_0x57d09e){_0x2ee69e=_0x2ee69e-0x1bb;let _0x172853=_0x4b1fdc[_0x2ee69e];return _0x172853;},a38_0x2ee6(_0x36339c,_0x141767);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x385022(0x1f9)]=exports[a38_0x385022(0x1e7)]=void 0x0;const database_1=__importDefault(require(a38_0x385022(0x1fa)));function a38_0x4b1f(){const _0x532738=['error','toLowerCase','TesSoft\x20Payment\x20System/1.0',',\x20using\x201\x20as\x20fallback','\x20to\x20USDT:','convertMultipleToUSDT','statusText','all','asc','default','nok','convertToUSDT','5285154vzFjaz','15430JKPDLd','getAllRates','1183688rpyFxS','__esModule','gel','Error\x20getting\x20rates\x20status:','ars','\x20currencies','14113IUonMr','toUpperCase','Failed\x20to\x20update\x20rate\x20for\x20','getCurrencyRate','741512eSZNNU','map','?ids=tether&vs_currencies=','sar','usdt','currencyRate','dkk','bits','2495511LmKqEB','aud','startPeriodicUpdates','MARKUP_PERCENTAGE','application/json','updatedAt','💱\x20Converted\x20','count','rub','10XqCSnX','📊\x20Received\x20rates\x20for\x20','php','kwd','vnd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','log','currency','yfi','upsert','getRatesStatus','nzd','Error\x20getting\x20rate\x20for\x20currency\x20','thb','sgd','CurrencyService','No\x20rate\x20found\x20for\x20currency:\x20','huf','join','ngn','catch','krw','7354188RlilkT','mxn','\x20USDT','lkr','rate','allSettled','cad','cny','sats','xag','pln','currencyService','../config/database','forEach','213546JbXYLO','tether','\x20USDT\x20=\x20','status','jpy','xlm','xau','uah','myr','usd','clp','COINGECKO_URL','gbp','\x20USDT\x20(rate:\x20','stopPeriodicUpdates','zar','bdt','mmk','bmd','twd','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','xdr','%\x20markup\x20to\x20','warn','entries','\x20to\x20','try','2NlPOmu','\x20USDT,\x20with\x20','__importDefault','✅\x20Currency\x20rates\x20updated\x20successfully','bnb','length','bhd','4vQfuiF','Error\x20getting\x20all\x20rates:','Initial\x20currency\x20rates\x20update\x20failed:','hkd','updateInterval','toFixed','CoinGecko\x20API\x20error:\x20','getMarkupPercentage','desc','json','bch','https://api.coingecko.com/api/v3/simple/price','keys','findFirst'];a38_0x4b1f=function(){return _0x532738;};return a38_0x4b1f();}class CurrencyService{constructor(){const _0x3896d3=a38_0x385022;this[_0x3896d3(0x207)]=_0x3896d3(0x229),this['CURRENCIES']=['btc','eth','ltc',_0x3896d3(0x228),_0x3896d3(0x21b),'eos','xrp',_0x3896d3(0x201),'link','dot',_0x3896d3(0x1e0),_0x3896d3(0x205),'aed',_0x3896d3(0x1c1),_0x3896d3(0x1d0),_0x3896d3(0x20c),_0x3896d3(0x21d),_0x3896d3(0x20e),'brl',_0x3896d3(0x1f4),'chf',_0x3896d3(0x206),_0x3896d3(0x1f5),'czk',_0x3896d3(0x1cd),'eur',_0x3896d3(0x208),_0x3896d3(0x1bf),_0x3896d3(0x221),_0x3896d3(0x1e9),'idr','ils','inr',_0x3896d3(0x200),_0x3896d3(0x1ed),_0x3896d3(0x1db),_0x3896d3(0x1f1),_0x3896d3(0x20d),_0x3896d3(0x1ef),_0x3896d3(0x204),_0x3896d3(0x1eb),_0x3896d3(0x236),_0x3896d3(0x1e3),_0x3896d3(0x1da),'pkr',_0x3896d3(0x1f8),_0x3896d3(0x1d7),_0x3896d3(0x1ca),'sek',_0x3896d3(0x1e6),_0x3896d3(0x1e5),_0x3896d3(0x216),_0x3896d3(0x20f),_0x3896d3(0x203),'vef',_0x3896d3(0x1dc),_0x3896d3(0x20b),_0x3896d3(0x211),_0x3896d3(0x1f7),_0x3896d3(0x202),_0x3896d3(0x1ce),_0x3896d3(0x1f6)],this[_0x3896d3(0x222)]=null,this[_0x3896d3(0x1d2)]=0x3,this[_0x3896d3(0x1d1)]();}[a38_0x385022(0x1d1)](){const _0x6ed1e7=a38_0x385022;this['updateCurrencyRates']()[_0x6ed1e7(0x1ec)](_0x2118a6=>{const _0x4f41e7=_0x6ed1e7;console['error'](_0x4f41e7(0x220),_0x2118a6);}),this['updateInterval']=setInterval(async()=>{const _0x28306b=_0x6ed1e7;try{await this['updateCurrencyRates']();}catch(_0x13d665){console[_0x28306b(0x22c)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x13d665);}},0x3c*0x3c*0x3e8),console[_0x6ed1e7(0x1de)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x385022(0x20a)](){const _0x4224f5=a38_0x385022;this[_0x4224f5(0x222)]&&(clearInterval(this[_0x4224f5(0x222)]),this[_0x4224f5(0x222)]=null,console[_0x4224f5(0x1de)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x5507db=a38_0x385022;try{console[_0x5507db(0x1de)](_0x5507db(0x210));const _0xb58818=this['CURRENCIES'][_0x5507db(0x1ea)](','),_0x4248e4=this['COINGECKO_URL']+_0x5507db(0x1c9)+_0xb58818,_0x3cd6eb=await fetch(_0x4248e4,{'headers':{'Accept':_0x5507db(0x1d3),'User-Agent':_0x5507db(0x22e)}});if(!_0x3cd6eb['ok'])throw new Error(_0x5507db(0x224)+_0x3cd6eb[_0x5507db(0x1ff)]+'\x20'+_0x3cd6eb[_0x5507db(0x232)]);const _0x379080=await _0x3cd6eb[_0x5507db(0x227)]();if(!_0x379080[_0x5507db(0x1fd)])throw new Error(_0x5507db(0x1dd));const _0x1ccebd=_0x379080[_0x5507db(0x1fd)];console[_0x5507db(0x1de)](_0x5507db(0x1d9)+Object[_0x5507db(0x22a)](_0x1ccebd)[_0x5507db(0x21c)]+_0x5507db(0x1c2));const _0x15ead7=Object[_0x5507db(0x214)](_0x1ccebd)[_0x5507db(0x1c8)](async([_0x151648,_0x18347f])=>{const _0x3ee106=_0x5507db;try{await database_1[_0x3ee106(0x235)]['currencyRate'][_0x3ee106(0x1e1)]({'where':{'currency':_0x151648[_0x3ee106(0x22d)]()},'update':{'rate':_0x18347f},'create':{'currency':_0x151648[_0x3ee106(0x22d)](),'rate':_0x18347f}});}catch(_0x4edbaf){console[_0x3ee106(0x22c)](_0x3ee106(0x1c5)+_0x151648+':',_0x4edbaf);}});await Promise[_0x5507db(0x1f3)](_0x15ead7),console[_0x5507db(0x1de)](_0x5507db(0x21a));}catch(_0x497c8a){console[_0x5507db(0x22c)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x497c8a);throw _0x497c8a;}}async[a38_0x385022(0x1c6)](_0x1ef13e){const _0x1541ab=a38_0x385022,_0x253b61=_0x1ef13e['toLowerCase']();if(_0x253b61===_0x1541ab(0x1cb))return 0x1;try{const _0x4cc0ab=await database_1[_0x1541ab(0x235)][_0x1541ab(0x1cc)]['findUnique']({'where':{'currency':_0x253b61}});if(!_0x4cc0ab)return console[_0x1541ab(0x213)](_0x1541ab(0x1e8)+_0x1ef13e+_0x1541ab(0x22f)),0x1;return _0x4cc0ab[_0x1541ab(0x1f2)];}catch(_0xde605e){return console[_0x1541ab(0x22c)](_0x1541ab(0x1e4)+_0x1ef13e+':',_0xde605e),0x1;}}async['convertToUSDT'](_0x1acd9e,_0x76f372){const _0x2f51f9=a38_0x385022,_0x50ec5d=_0x76f372[_0x2f51f9(0x22d)]();if(_0x50ec5d===_0x2f51f9(0x1cb)){const _0x570831=_0x1acd9e*(0x1+this[_0x2f51f9(0x1d2)]/0x64);return console[_0x2f51f9(0x1de)]('💱\x20Applied\x20'+this[_0x2f51f9(0x1d2)]+_0x2f51f9(0x212)+_0x1acd9e+_0x2f51f9(0x1fe)+_0x570831['toFixed'](0x6)+_0x2f51f9(0x1f0)),_0x570831;}try{const _0x547e9f=await this[_0x2f51f9(0x1c6)](_0x50ec5d),_0x1b37d5=_0x1acd9e/_0x547e9f,_0x3ae2e3=_0x1b37d5*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x2f51f9(0x1de)](_0x2f51f9(0x1d5)+_0x1acd9e+'\x20'+_0x76f372[_0x2f51f9(0x1c4)]()+_0x2f51f9(0x215)+_0x1b37d5[_0x2f51f9(0x223)](0x6)+_0x2f51f9(0x218)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x3ae2e3[_0x2f51f9(0x223)](0x6)+_0x2f51f9(0x209)+_0x547e9f+')'),_0x3ae2e3;}catch(_0x2243de){console[_0x2f51f9(0x22c)]('Error\x20converting\x20'+_0x1acd9e+'\x20'+_0x76f372+_0x2f51f9(0x230),_0x2243de);const _0x395878=_0x1acd9e*(0x1+this[_0x2f51f9(0x1d2)]/0x64);return _0x395878;}}async[a38_0x385022(0x231)](_0x360b9e){const _0x437ac3=a38_0x385022;let _0x606a5c=0x0;for(const {amount:_0x3eac9d,currency:_0x22b6a5}of _0x360b9e){const _0x2ba6ab=await this[_0x437ac3(0x237)](_0x3eac9d,_0x22b6a5);_0x606a5c+=_0x2ba6ab;}return _0x606a5c;}async[a38_0x385022(0x1bc)](){const _0x2576b1=a38_0x385022;try{const _0x2b6005=await database_1['default'][_0x2576b1(0x1cc)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x3f3e49={'usdt':0x1};return _0x2b6005[_0x2576b1(0x1fb)](_0x146170=>{const _0xc80518=_0x2576b1;_0x3f3e49[_0x146170[_0xc80518(0x1df)]]=_0x146170[_0xc80518(0x1f2)];}),_0x3f3e49;}catch(_0x3f8ff1){return console[_0x2576b1(0x22c)](_0x2576b1(0x21f),_0x3f8ff1),{'usdt':0x1};}}async[a38_0x385022(0x1e2)](){const _0x39909b=a38_0x385022;try{const [_0x5cbc4a,_0x5205a9,_0x502d84]=await Promise[_0x39909b(0x233)]([database_1[_0x39909b(0x235)][_0x39909b(0x1cc)][_0x39909b(0x1d6)](),database_1['default'][_0x39909b(0x1cc)][_0x39909b(0x22b)]({'orderBy':{'updatedAt':_0x39909b(0x226)},'select':{'updatedAt':!![]}}),database_1[_0x39909b(0x235)][_0x39909b(0x1cc)][_0x39909b(0x22b)]({'orderBy':{'updatedAt':_0x39909b(0x234)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5cbc4a,'lastUpdated':_0x5205a9?.['updatedAt']||null,'oldestRate':_0x502d84?.[_0x39909b(0x1d4)]||null,'markupPercentage':this[_0x39909b(0x1d2)]};}catch(_0x273617){return console[_0x39909b(0x22c)](_0x39909b(0x1c0),_0x273617),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x39909b(0x1d2)]};}}[a38_0x385022(0x225)](){const _0x58751e=a38_0x385022;return this[_0x58751e(0x1d2)];}}exports[a38_0x385022(0x1e7)]=CurrencyService,exports[a38_0x385022(0x1f9)]=new CurrencyService();