'use strict';const a49_0x3803d2=a49_0x54be;function a49_0x54be(_0x2837bf,_0x192d11){_0x2837bf=_0x2837bf-0x83;const _0x14457f=a49_0x1445();let _0x54be1a=_0x14457f[_0x2837bf];return _0x54be1a;}(function(_0x3cd3af,_0x241b43){const _0x524b78=a49_0x54be,_0x59ac4a=_0x3cd3af();while(!![]){try{const _0x51ee22=-parseInt(_0x524b78(0xe4))/0x1+-parseInt(_0x524b78(0xad))/0x2*(-parseInt(_0x524b78(0x9b))/0x3)+parseInt(_0x524b78(0xf6))/0x4+-parseInt(_0x524b78(0xd6))/0x5*(parseInt(_0x524b78(0xa2))/0x6)+parseInt(_0x524b78(0xf0))/0x7*(-parseInt(_0x524b78(0xb1))/0x8)+parseInt(_0x524b78(0xa7))/0x9+parseInt(_0x524b78(0xba))/0xa*(parseInt(_0x524b78(0xc3))/0xb);if(_0x51ee22===_0x241b43)break;else _0x59ac4a['push'](_0x59ac4a['shift']());}catch(_0x2ee494){_0x59ac4a['push'](_0x59ac4a['shift']());}}}(a49_0x1445,0xe5756));var __importDefault=this&&this[a49_0x3803d2(0xbd)]||function(_0x52e62a){const _0x23d79e=a49_0x3803d2;return _0x52e62a&&_0x52e62a[_0x23d79e(0xfb)]?_0x52e62a:{'default':_0x52e62a};};Object[a49_0x3803d2(0x9a)](exports,a49_0x3803d2(0xfb),{'value':!![]}),exports['currencyService']=exports[a49_0x3803d2(0x92)]=void 0x0;const database_1=__importDefault(require(a49_0x3803d2(0xfc)));class CurrencyService{constructor(){const _0x5b3a5a=a49_0x3803d2;this[_0x5b3a5a(0xd8)]=_0x5b3a5a(0xfa),this[_0x5b3a5a(0xf5)]=[_0x5b3a5a(0xb4),'eth','ltc',_0x5b3a5a(0xed),_0x5b3a5a(0xb7),_0x5b3a5a(0xdb),_0x5b3a5a(0xd4),_0x5b3a5a(0x8f),'link','dot',_0x5b3a5a(0xa3),'usd','aed',_0x5b3a5a(0x9f),'aud',_0x5b3a5a(0x8c),_0x5b3a5a(0xa4),_0x5b3a5a(0x85),_0x5b3a5a(0xe9),_0x5b3a5a(0xde),_0x5b3a5a(0xdf),'clp',_0x5b3a5a(0xf4),_0x5b3a5a(0xcf),_0x5b3a5a(0xe1),'eur',_0x5b3a5a(0xbf),_0x5b3a5a(0xac),_0x5b3a5a(0xb6),'huf',_0x5b3a5a(0xef),_0x5b3a5a(0xe5),_0x5b3a5a(0xea),_0x5b3a5a(0x96),'krw',_0x5b3a5a(0xe0),_0x5b3a5a(0xa1),_0x5b3a5a(0x9d),_0x5b3a5a(0xa6),_0x5b3a5a(0xf3),_0x5b3a5a(0x83),_0x5b3a5a(0xd1),_0x5b3a5a(0x87),'php',_0x5b3a5a(0x89),_0x5b3a5a(0xeb),_0x5b3a5a(0xe7),_0x5b3a5a(0xf7),_0x5b3a5a(0xd9),_0x5b3a5a(0xc4),'thb',_0x5b3a5a(0x90),_0x5b3a5a(0xd0),_0x5b3a5a(0x9c),_0x5b3a5a(0xd7),'vnd',_0x5b3a5a(0xe3),_0x5b3a5a(0xa9),_0x5b3a5a(0xa0),_0x5b3a5a(0xc1),'bits',_0x5b3a5a(0xaa)],this[_0x5b3a5a(0xec)]=null,this[_0x5b3a5a(0xc9)]=-0x3,this[_0x5b3a5a(0xae)]();}[a49_0x3803d2(0xae)](){const _0x31f000=a49_0x3803d2;this[_0x31f000(0xe8)]()[_0x31f000(0x99)](_0x5edde0=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x5edde0);}),this[_0x31f000(0xec)]=setInterval(async()=>{const _0x22bf7c=_0x31f000;try{await this[_0x22bf7c(0xe8)]();}catch(_0x308f7e){console['error'](_0x22bf7c(0x8e),_0x308f7e);}},0x3c*0x3c*0x3e8),console[_0x31f000(0xb2)](_0x31f000(0xd5));}['stopPeriodicUpdates'](){const _0x29a8dd=a49_0x3803d2;this[_0x29a8dd(0xec)]&&(clearInterval(this[_0x29a8dd(0xec)]),this[_0x29a8dd(0xec)]=null,console[_0x29a8dd(0xb2)](_0x29a8dd(0x97)));}async[a49_0x3803d2(0xe8)](){const _0x57f04f=a49_0x3803d2;try{console[_0x57f04f(0xb2)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x5840fd=this[_0x57f04f(0xf5)][_0x57f04f(0xa8)](','),_0x4d0a14=this['COINGECKO_URL']+_0x57f04f(0xc6)+_0x5840fd,_0x4d7f7f=await fetch(_0x4d0a14,{'headers':{'Accept':_0x57f04f(0xbb),'User-Agent':_0x57f04f(0xee)}});if(!_0x4d7f7f['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x4d7f7f[_0x57f04f(0x94)]+'\x20'+_0x4d7f7f['statusText']);const _0x1d35b5=await _0x4d7f7f['json']();if(!_0x1d35b5['tether'])throw new Error(_0x57f04f(0xaf));const _0x421c58=_0x1d35b5[_0x57f04f(0xf8)];console[_0x57f04f(0xb2)](_0x57f04f(0xe6)+Object[_0x57f04f(0x84)](_0x421c58)[_0x57f04f(0x98)]+_0x57f04f(0xd3));const _0x36b8fd=Object['entries'](_0x421c58)[_0x57f04f(0xa5)](async([_0x1abc68,_0xff4e69])=>{const _0x2b2600=_0x57f04f;try{await database_1['default'][_0x2b2600(0xbc)][_0x2b2600(0x86)]({'where':{'currency':_0x1abc68['toLowerCase']()},'update':{'rate':_0xff4e69},'create':{'currency':_0x1abc68['toLowerCase'](),'rate':_0xff4e69}});}catch(_0x4e44f9){console[_0x2b2600(0xc2)](_0x2b2600(0xca)+_0x1abc68+':',_0x4e44f9);}});await Promise[_0x57f04f(0xf2)](_0x36b8fd),console[_0x57f04f(0xb2)](_0x57f04f(0xc7));}catch(_0x2dbc3b){console[_0x57f04f(0xc2)](_0x57f04f(0xe2),_0x2dbc3b);throw _0x2dbc3b;}}async[a49_0x3803d2(0xcb)](_0x2cf7cb){const _0x1e6d11=a49_0x3803d2,_0x1ea7a5=_0x2cf7cb[_0x1e6d11(0xb5)]();if(_0x1ea7a5==='usdt')return 0x1;try{const _0x2ebb27=await database_1['default'][_0x1e6d11(0xbc)][_0x1e6d11(0x91)]({'where':{'currency':_0x1ea7a5}});if(!_0x2ebb27)return console[_0x1e6d11(0xc0)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2cf7cb+',\x20using\x201\x20as\x20fallback'),0x1;return _0x2ebb27[_0x1e6d11(0xdd)];}catch(_0x1690bf){return console[_0x1e6d11(0xc2)](_0x1e6d11(0xbe)+_0x2cf7cb+':',_0x1690bf),0x1;}}async[a49_0x3803d2(0xb9)](_0x16ab36,_0x1389d0){const _0xf4e988=a49_0x3803d2,_0x11cc82=_0x1389d0['toLowerCase']();if(_0x11cc82===_0xf4e988(0xda)){const _0x4d0622=_0x16ab36*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0xf4e988(0xb2)](_0xf4e988(0xab)+this[_0xf4e988(0xc9)]+'%\x20markup\x20to\x20'+_0x16ab36+_0xf4e988(0xb8)+_0x4d0622[_0xf4e988(0xb0)](0x6)+_0xf4e988(0xdc)),_0x4d0622;}try{const _0x3d0733=await this[_0xf4e988(0xcb)](_0x11cc82),_0x385cdd=_0x16ab36/_0x3d0733,_0x24e68f=_0x385cdd*(0x1+this[_0xf4e988(0xc9)]/0x64);return console[_0xf4e988(0xb2)]('üí±\x20Converted\x20'+_0x16ab36+'\x20'+_0x1389d0[_0xf4e988(0xcd)]()+_0xf4e988(0xc8)+_0x385cdd[_0xf4e988(0xb0)](0x6)+_0xf4e988(0xce)+this[_0xf4e988(0xc9)]+'%\x20markup\x20=\x20'+_0x24e68f['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x3d0733+')'),_0x24e68f;}catch(_0x272a1e){console[_0xf4e988(0xc2)]('Error\x20converting\x20'+_0x16ab36+'\x20'+_0x1389d0+_0xf4e988(0x93),_0x272a1e);const _0x542a7e=_0x16ab36*(0x1+this[_0xf4e988(0xc9)]/0x64);return _0x542a7e;}}async[a49_0x3803d2(0x8b)](_0x56bf68){const _0x1bf69f=a49_0x3803d2;let _0x445753=0x0;for(const {amount:_0x33344e,currency:_0x3664f4}of _0x56bf68){const _0x913ed3=await this[_0x1bf69f(0xb9)](_0x33344e,_0x3664f4);_0x445753+=_0x913ed3;}return _0x445753;}async['getAllRates'](){const _0xd13d09=a49_0x3803d2;try{const _0x1e2df7=await database_1[_0xd13d09(0xd2)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x2941f2={'usdt':0x1};return _0x1e2df7[_0xd13d09(0xb3)](_0xdcb1e=>{const _0x34e0df=_0xd13d09;_0x2941f2[_0xdcb1e[_0x34e0df(0x95)]]=_0xdcb1e[_0x34e0df(0xdd)];}),_0x2941f2;}catch(_0x5697ea){return console[_0xd13d09(0xc2)](_0xd13d09(0xf1),_0x5697ea),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4d296e=a49_0x3803d2;try{const [_0x3f3ead,_0x4134cc,_0x27cfa5]=await Promise[_0x4d296e(0xcc)]([database_1[_0x4d296e(0xd2)]['currencyRate'][_0x4d296e(0x88)](),database_1[_0x4d296e(0xd2)][_0x4d296e(0xbc)][_0x4d296e(0xc5)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x4d296e(0xbc)][_0x4d296e(0xc5)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f3ead,'lastUpdated':_0x4134cc?.[_0x4d296e(0xf9)]||null,'oldestRate':_0x27cfa5?.[_0x4d296e(0xf9)]||null,'markupPercentage':this[_0x4d296e(0xc9)]};}catch(_0xfcc2e2){return console[_0x4d296e(0xc2)](_0x4d296e(0x8a),_0xfcc2e2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4d296e(0xc9)]};}}[a49_0x3803d2(0x9e)](){const _0x361175=a49_0x3803d2;return this[_0x361175(0xc9)];}}exports[a49_0x3803d2(0x92)]=CurrencyService,exports[a49_0x3803d2(0x8d)]=new CurrencyService();function a49_0x1445(){const _0x2db1ed=['findUnique','CurrencyService','\x20to\x20USDT:','status','currency','jpy','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','length','catch','defineProperty','1477818dautyP','uah','mmk','getMarkupPercentage','ars','xag','lkr','12WsBTKk','yfi','bhd','map','mxn','3301254vmPgBB','join','xdr','sats','üí±\x20Applied\x20','gel','2mYvxyH','startPeriodicUpdates','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','toFixed','13354856AwiVbz','log','forEach','btc','toLowerCase','hkd','bnb','\x20USDT\x20=\x20','convertToUSDT','30rLvogB','application/json','currencyRate','__importDefault','Error\x20getting\x20rate\x20for\x20currency\x20','gbp','warn','xau','error','13520177CUqZln','sgd','findFirst','?ids=tether&vs_currencies=','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','\x20to\x20','MARKUP_PERCENTAGE','Failed\x20to\x20update\x20rate\x20for\x20','getCurrencyRate','all','toUpperCase','\x20USDT,\x20with\x20','czk','twd','nok','default','\x20currencies','xrp','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','1349280IAAwOz','vef','COINGECKO_URL','sek','usdt','eos','\x20USDT','rate','cad','chf','kwd','dkk','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','zar','1488841MDzpgp','ils','üìä\x20Received\x20rates\x20for\x20','rub','updateCurrencyRates','brl','inr','pln','updateInterval','bch','Payment\x20System/1.0','idr','7nMcUZU','Error\x20getting\x20all\x20rates:','allSettled','myr','cny','CURRENCIES','364156egsCEU','sar','tether','updatedAt','https://api.coingecko.com/api/v3/simple/price','__esModule','../config/database','ngn','keys','bmd','upsert','nzd','count','pkr','Error\x20getting\x20rates\x20status:','convertMultipleToUSDT','bdt','currencyService','Periodic\x20currency\x20rates\x20update\x20failed:','xlm','try'];a49_0x1445=function(){return _0x2db1ed;};return a49_0x1445();}