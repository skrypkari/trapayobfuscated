'use strict';const a36_0x812de9=a36_0x5dd4;function a36_0x29c9(){const _0x23fe4e=['join','Periodic\x20currency\x20rates\x20update\x20failed:','tether','77083SAkthR',',\x20using\x201\x20as\x20fallback','2562fIuYFv','sgd','status','getRatesStatus','Error\x20getting\x20rates\x20status:','nok','ils','rate','idr','gel','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','catch','__esModule','\x20USDT\x20=\x20','php','1534134eBrsqu','ðŸ“Š\x20Received\x20rates\x20for\x20','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','sats','ngn','ðŸ’±\x20Applied\x20','bhd','usd','COINGECKO_URL','sar','kwd','gbp','all','toLowerCase','clp','rub','desc','mmk','bch','allSettled','Error\x20getting\x20rate\x20for\x20currency\x20','xag','8JlGvKw','currencyRate','Initial\x20currency\x20rates\x20update\x20failed:','cny','\x20USDT,\x20with\x20','MARKUP_PERCENTAGE','703054fqRquo','json','btc','dkk','../config/database','currencyService','error','\x20to\x20','240KNbhBM','vnd','uah','zar','pln','stopPeriodicUpdates','usdt','findUnique','getAllRates','CoinGecko\x20API\x20error:\x20','3695UHUQMZ','findFirst','TesSoft\x20Payment\x20System/1.0','inr','myr','thb','?ids=tether&vs_currencies=','convertToUSDT','entries','krw','bnb','__importDefault','bdt','328WQqqtg','toFixed','chf','ðŸ’±\x20Converted\x20','CurrencyService','xrp','42064BzWBwM','updateInterval','czk','default','ltc','log','357261AUaICY','brl','application/json','length','jpy','Error\x20converting\x20','statusText','\x20to\x20USDT:','try','lkr','asc','%\x20markup\x20to\x20','yfi','getCurrencyRate','vef','xdr','60309MtcNhy','CURRENCIES','sek','map','convertMultipleToUSDT','getMarkupPercentage','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','link','findMany','eur','defineProperty','startPeriodicUpdates','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','forEach','twd','cad','xau','eth','updateCurrencyRates','\x20USDT'];a36_0x29c9=function(){return _0x23fe4e;};return a36_0x29c9();}(function(_0x5b0ec8,_0x55a9ea){const _0x360b77=a36_0x5dd4,_0x239bcd=_0x5b0ec8();while(!![]){try{const _0x1468e1=-parseInt(_0x360b77(0xfe))/0x1+parseInt(_0x360b77(0xac))/0x2+-parseInt(_0x360b77(0xd7))/0x3*(parseInt(_0x360b77(0x126))/0x4)+parseInt(_0x360b77(0xbe))/0x5*(parseInt(_0x360b77(0x100))/0x6)+parseInt(_0x360b77(0x110))/0x7+parseInt(_0x360b77(0xcb))/0x8*(-parseInt(_0x360b77(0xe7))/0x9)+parseInt(_0x360b77(0xb4))/0xa*(-parseInt(_0x360b77(0xd1))/0xb);if(_0x1468e1===_0x55a9ea)break;else _0x239bcd['push'](_0x239bcd['shift']());}catch(_0x2b3e34){_0x239bcd['push'](_0x239bcd['shift']());}}}(a36_0x29c9,0x31eb4));var __importDefault=this&&this[a36_0x812de9(0xc9)]||function(_0x3afa88){const _0x5baa99=a36_0x812de9;return _0x3afa88&&_0x3afa88[_0x5baa99(0x10d)]?_0x3afa88:{'default':_0x3afa88};};Object[a36_0x812de9(0xf1)](exports,'__esModule',{'value':!![]}),exports[a36_0x812de9(0xb1)]=exports[a36_0x812de9(0xcf)]=void 0x0;const database_1=__importDefault(require(a36_0x812de9(0xb0)));class CurrencyService{constructor(){const _0x221db2=a36_0x812de9;this[_0x221db2(0x118)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x221db2(0xae),_0x221db2(0xf8),_0x221db2(0xd5),_0x221db2(0x122),_0x221db2(0xc8),'eos',_0x221db2(0xd0),'xlm',_0x221db2(0xee),'dot',_0x221db2(0xe3),_0x221db2(0x117),'aed','ars','aud',_0x221db2(0xca),_0x221db2(0x116),'bmd',_0x221db2(0xd8),_0x221db2(0xf6),_0x221db2(0xcd),_0x221db2(0x11e),_0x221db2(0xa9),_0x221db2(0xd3),_0x221db2(0xaf),_0x221db2(0xf0),_0x221db2(0x11b),_0x221db2(0x109),'hkd','huf',_0x221db2(0x108),_0x221db2(0x106),_0x221db2(0xc1),_0x221db2(0xdb),_0x221db2(0xc7),_0x221db2(0x11a),_0x221db2(0xe0),_0x221db2(0x121),'mxn',_0x221db2(0xc2),_0x221db2(0x114),_0x221db2(0x105),'nzd',_0x221db2(0x10f),'pkr',_0x221db2(0xb8),_0x221db2(0x11f),_0x221db2(0x119),_0x221db2(0xe9),_0x221db2(0x101),_0x221db2(0xc3),_0x221db2(0xdf),_0x221db2(0xf5),_0x221db2(0xb6),_0x221db2(0xe5),_0x221db2(0xb5),_0x221db2(0xb7),_0x221db2(0xe6),_0x221db2(0x125),_0x221db2(0xf7),'bits',_0x221db2(0x113)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x221db2(0xf2)]();}[a36_0x812de9(0xf2)](){const _0x106c68=a36_0x812de9;this[_0x106c68(0xf9)]()[_0x106c68(0x10c)](_0x2bc90a=>{const _0x20c993=_0x106c68;console[_0x20c993(0xb2)](_0x20c993(0xa8),_0x2bc90a);}),this[_0x106c68(0xd2)]=setInterval(async()=>{const _0x54e2c9=_0x106c68;try{await this[_0x54e2c9(0xf9)]();}catch(_0x558d30){console[_0x54e2c9(0xb2)](_0x54e2c9(0xfc),_0x558d30);}},0x3c*0x3c*0x3e8),console['log'](_0x106c68(0x112));}[a36_0x812de9(0xb9)](){const _0x200f2b=a36_0x812de9;this[_0x200f2b(0xd2)]&&(clearInterval(this[_0x200f2b(0xd2)]),this[_0x200f2b(0xd2)]=null,console[_0x200f2b(0xd6)](_0x200f2b(0x10a)));}async[a36_0x812de9(0xf9)](){const _0x5c32c7=a36_0x812de9;try{console[_0x5c32c7(0xd6)](_0x5c32c7(0x10b));const _0x38d57a=this[_0x5c32c7(0xe8)][_0x5c32c7(0xfb)](','),_0x291ccb=this[_0x5c32c7(0x118)]+_0x5c32c7(0xc4)+_0x38d57a,_0x1ec221=await fetch(_0x291ccb,{'headers':{'Accept':_0x5c32c7(0xd9),'User-Agent':_0x5c32c7(0xc0)}});if(!_0x1ec221['ok'])throw new Error(_0x5c32c7(0xbd)+_0x1ec221[_0x5c32c7(0x102)]+'\x20'+_0x1ec221[_0x5c32c7(0xdd)]);const _0x188b02=await _0x1ec221[_0x5c32c7(0xad)]();if(!_0x188b02['tether'])throw new Error(_0x5c32c7(0xed));const _0x2a2489=_0x188b02[_0x5c32c7(0xfd)];console[_0x5c32c7(0xd6)](_0x5c32c7(0x111)+Object['keys'](_0x2a2489)[_0x5c32c7(0xda)]+'\x20currencies');const _0x4aac93=Object[_0x5c32c7(0xc6)](_0x2a2489)[_0x5c32c7(0xea)](async([_0x520940,_0x3e3409])=>{const _0x26eb27=_0x5c32c7;try{await database_1[_0x26eb27(0xd4)][_0x26eb27(0xa7)]['upsert']({'where':{'currency':_0x520940[_0x26eb27(0x11d)]()},'update':{'rate':_0x3e3409},'create':{'currency':_0x520940['toLowerCase'](),'rate':_0x3e3409}});}catch(_0xcec7b){console[_0x26eb27(0xb2)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x520940+':',_0xcec7b);}});await Promise[_0x5c32c7(0x123)](_0x4aac93),console[_0x5c32c7(0xd6)]('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x23d8a5){console[_0x5c32c7(0xb2)](_0x5c32c7(0xf3),_0x23d8a5);throw _0x23d8a5;}}async[a36_0x812de9(0xe4)](_0x387a47){const _0x13978d=a36_0x812de9,_0x47f47a=_0x387a47[_0x13978d(0x11d)]();if(_0x47f47a===_0x13978d(0xba))return 0x1;try{const _0x4029b7=await database_1[_0x13978d(0xd4)][_0x13978d(0xa7)][_0x13978d(0xbb)]({'where':{'currency':_0x47f47a}});if(!_0x4029b7)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x387a47+_0x13978d(0xff)),0x1;return _0x4029b7[_0x13978d(0x107)];}catch(_0x65159b){return console[_0x13978d(0xb2)](_0x13978d(0x124)+_0x387a47+':',_0x65159b),0x1;}}async[a36_0x812de9(0xc5)](_0x1ef6a8,_0xd80dbf){const _0x55c709=a36_0x812de9,_0x11eceb=_0xd80dbf['toLowerCase']();if(_0x11eceb===_0x55c709(0xba)){const _0x39a71e=_0x1ef6a8*(0x1+this[_0x55c709(0xab)]/0x64);return console[_0x55c709(0xd6)](_0x55c709(0x115)+this[_0x55c709(0xab)]+_0x55c709(0xe2)+_0x1ef6a8+_0x55c709(0x10e)+_0x39a71e['toFixed'](0x6)+_0x55c709(0xfa)),_0x39a71e;}try{const _0x4863c7=await this[_0x55c709(0xe4)](_0x11eceb),_0x2740b2=_0x1ef6a8/_0x4863c7,_0x1aa04f=_0x2740b2*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x55c709(0xd6)](_0x55c709(0xce)+_0x1ef6a8+'\x20'+_0xd80dbf['toUpperCase']()+_0x55c709(0xb3)+_0x2740b2[_0x55c709(0xcc)](0x6)+_0x55c709(0xaa)+this[_0x55c709(0xab)]+'%\x20markup\x20=\x20'+_0x1aa04f[_0x55c709(0xcc)](0x6)+'\x20USDT\x20(rate:\x20'+_0x4863c7+')'),_0x1aa04f;}catch(_0x50ea7d){console[_0x55c709(0xb2)](_0x55c709(0xdc)+_0x1ef6a8+'\x20'+_0xd80dbf+_0x55c709(0xde),_0x50ea7d);const _0x3ffa71=_0x1ef6a8*(0x1+this[_0x55c709(0xab)]/0x64);return _0x3ffa71;}}async[a36_0x812de9(0xeb)](_0x5997f0){const _0x375a69=a36_0x812de9;let _0x4b7dd9=0x0;for(const {amount:_0x4c9173,currency:_0x5b7d29}of _0x5997f0){const _0x20ac43=await this[_0x375a69(0xc5)](_0x4c9173,_0x5b7d29);_0x4b7dd9+=_0x20ac43;}return _0x4b7dd9;}async[a36_0x812de9(0xbc)](){const _0x5d204e=a36_0x812de9;try{const _0x177cf2=await database_1[_0x5d204e(0xd4)][_0x5d204e(0xa7)][_0x5d204e(0xef)]({'select':{'currency':!![],'rate':!![]}}),_0x386649={'usdt':0x1};return _0x177cf2[_0x5d204e(0xf4)](_0xf43d3d=>{_0x386649[_0xf43d3d['currency']]=_0xf43d3d['rate'];}),_0x386649;}catch(_0x5ede1b){return console[_0x5d204e(0xb2)]('Error\x20getting\x20all\x20rates:',_0x5ede1b),{'usdt':0x1};}}async[a36_0x812de9(0x103)](){const _0x1a4240=a36_0x812de9;try{const [_0x187a0a,_0x41b932,_0x1e13c5]=await Promise[_0x1a4240(0x11c)]([database_1[_0x1a4240(0xd4)][_0x1a4240(0xa7)]['count'](),database_1[_0x1a4240(0xd4)]['currencyRate'][_0x1a4240(0xbf)]({'orderBy':{'updatedAt':_0x1a4240(0x120)},'select':{'updatedAt':!![]}}),database_1[_0x1a4240(0xd4)][_0x1a4240(0xa7)][_0x1a4240(0xbf)]({'orderBy':{'updatedAt':_0x1a4240(0xe1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x187a0a,'lastUpdated':_0x41b932?.['updatedAt']||null,'oldestRate':_0x1e13c5?.['updatedAt']||null,'markupPercentage':this[_0x1a4240(0xab)]};}catch(_0x2199f2){return console[_0x1a4240(0xb2)](_0x1a4240(0x104),_0x2199f2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1a4240(0xab)]};}}[a36_0x812de9(0xec)](){const _0x32aef0=a36_0x812de9;return this[_0x32aef0(0xab)];}}function a36_0x5dd4(_0x362570,_0x51ff97){const _0x29c96c=a36_0x29c9();return a36_0x5dd4=function(_0x5dd4d5,_0x59414b){_0x5dd4d5=_0x5dd4d5-0xa7;let _0x6e24d3=_0x29c96c[_0x5dd4d5];return _0x6e24d3;},a36_0x5dd4(_0x362570,_0x51ff97);}exports['CurrencyService']=CurrencyService,exports[a36_0x812de9(0xb1)]=new CurrencyService();