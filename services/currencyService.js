'use strict';const a58_0x2c21c9=a58_0x5d41;function a58_0x5d41(_0x176559,_0x8bf23d){_0x176559=_0x176559-0x66;const _0x4d90bb=a58_0x4d90();let _0x5d4147=_0x4d90bb[_0x176559];return _0x5d4147;}(function(_0x65949b,_0x4bee9a){const _0x4d08e1=a58_0x5d41,_0x5a43cd=_0x65949b();while(!![]){try{const _0x120dc6=-parseInt(_0x4d08e1(0xc3))/0x1+-parseInt(_0x4d08e1(0xd6))/0x2+-parseInt(_0x4d08e1(0xc0))/0x3+parseInt(_0x4d08e1(0x9c))/0x4*(parseInt(_0x4d08e1(0x90))/0x5)+parseInt(_0x4d08e1(0xde))/0x6+-parseInt(_0x4d08e1(0xb9))/0x7*(parseInt(_0x4d08e1(0x75))/0x8)+-parseInt(_0x4d08e1(0xc5))/0x9;if(_0x120dc6===_0x4bee9a)break;else _0x5a43cd['push'](_0x5a43cd['shift']());}catch(_0x39b966){_0x5a43cd['push'](_0x5a43cd['shift']());}}}(a58_0x4d90,0x5a502));var __importDefault=this&&this['__importDefault']||function(_0x172b10){const _0x1860bb=a58_0x5d41;return _0x172b10&&_0x172b10[_0x1860bb(0xd0)]?_0x172b10:{'default':_0x172b10};};Object[a58_0x2c21c9(0xc4)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a58_0x2c21c9(0xaf)]=void 0x0;function a58_0x4d90(){const _0x5f4928=['mmk','application/json','%\x20markup\x20=\x20','?ids=tether&vs_currencies=','\x20USDT,\x20with\x20','MARKUP_PERCENTAGE','124616QwiyHe','bch','updateCurrencyRates','findUnique','pkr','xlm','nok','aed','Periodic\x20currency\x20rates\x20update\x20failed:','cad','join','ðŸ“Š\x20Received\x20rates\x20for\x20','\x20USDT','krw','entries','bmd','eth','eur','json','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','findFirst','eos','currency','inr','No\x20rate\x20found\x20for\x20currency:\x20','convertMultipleToUSDT','getCurrencyRate','9060JSIeQy','getRatesStatus','count','default','\x20currencies','gbp','nzd','sek','vef','idr','\x20USDT\x20=\x20','cny','1516gKaTsH','âœ…\x20Currency\x20rates\x20updated\x20successfully','toFixed','error','currencyRate','vnd',',\x20using\x201\x20as\x20fallback','twd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','Error\x20converting\x20','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','length','catch','https://api.coingecko.com/api/v3/simple/price','try','all','jpy','getMarkupPercentage','Failed\x20to\x20update\x20rate\x20for\x20','CurrencyService','currencyService','COINGECKO_URL','stopPeriodicUpdates','warn','ðŸ’±\x20Converted\x20','convertToUSDT','usdt','CoinGecko\x20API\x20error:\x20','thb','21USxdPo','updateInterval','ars','xau','forEach','lkr','statusText','838098AcqMde','brl','xag','237713TgDjuJ','defineProperty','3139110hrZsdv','yfi','updatedAt','asc','\x20USDT\x20(rate:\x20','startPeriodicUpdates','log','Initial\x20currency\x20rates\x20update\x20failed:','\x20to\x20USDT:','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','bdt','__esModule','clp','pln','xdr','sgd','upsert','174624kdFuiW','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bhd','sats','rate','Error\x20getting\x20all\x20rates:','findMany','toLowerCase','4098516hCnunV','aud','map','myr','btc','\x20to\x20','ðŸ’±\x20Applied\x20','zar','Error\x20getting\x20rates\x20status:','rub','keys','bnb'];a58_0x4d90=function(){return _0x5f4928;};return a58_0x4d90();}const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x634b13=a58_0x2c21c9;this[_0x634b13(0xb1)]=_0x634b13(0xa9),this['CURRENCIES']=[_0x634b13(0x67),_0x634b13(0x85),'ltc',_0x634b13(0x76),_0x634b13(0x6e),_0x634b13(0x8a),'xrp',_0x634b13(0x7a),'link','dot',_0x634b13(0xc6),'usd',_0x634b13(0x7c),_0x634b13(0xbb),_0x634b13(0xdf),_0x634b13(0xcf),_0x634b13(0xd8),_0x634b13(0x84),_0x634b13(0xc1),_0x634b13(0x7e),'chf',_0x634b13(0xd1),_0x634b13(0x9b),'czk','dkk',_0x634b13(0x86),_0x634b13(0x95),'gel','hkd','huf',_0x634b13(0x99),'ils',_0x634b13(0x8c),_0x634b13(0xac),_0x634b13(0x82),'kwd',_0x634b13(0xbe),_0x634b13(0x6f),'mxn',_0x634b13(0x66),'ngn',_0x634b13(0x7b),_0x634b13(0x96),'php',_0x634b13(0x79),_0x634b13(0xd2),_0x634b13(0x6c),'sar',_0x634b13(0x97),_0x634b13(0xd4),_0x634b13(0xb8),_0x634b13(0xaa),_0x634b13(0xa3),'uah',_0x634b13(0x98),_0x634b13(0xa1),_0x634b13(0x6a),_0x634b13(0xd3),_0x634b13(0xc2),_0x634b13(0xbc),'bits',_0x634b13(0xd9)],this[_0x634b13(0xba)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x634b13(0xca)]();}[a58_0x2c21c9(0xca)](){const _0x5cc189=a58_0x2c21c9;this[_0x5cc189(0x77)]()[_0x5cc189(0xa8)](_0x438f00=>{const _0x18bada=_0x5cc189;console['error'](_0x18bada(0xcc),_0x438f00);}),this[_0x5cc189(0xba)]=setInterval(async()=>{const _0x8cb632=_0x5cc189;try{await this[_0x8cb632(0x77)]();}catch(_0x3e376e){console['error'](_0x8cb632(0x7d),_0x3e376e);}},0x3c*0x3c*0x3e8),console[_0x5cc189(0xcb)](_0x5cc189(0x88));}[a58_0x2c21c9(0xb2)](){const _0x2ed746=a58_0x2c21c9;this[_0x2ed746(0xba)]&&(clearInterval(this[_0x2ed746(0xba)]),this[_0x2ed746(0xba)]=null,console['log'](_0x2ed746(0xa6)));}async[a58_0x2c21c9(0x77)](){const _0x40e848=a58_0x2c21c9;try{console[_0x40e848(0xcb)](_0x40e848(0xd7));const _0x3e9454=this['CURRENCIES'][_0x40e848(0x7f)](','),_0x53061d=this[_0x40e848(0xb1)]+_0x40e848(0x72)+_0x3e9454,_0x7dae76=await fetch(_0x53061d,{'headers':{'Accept':_0x40e848(0x70),'User-Agent':'Payment\x20System/1.0'}});if(!_0x7dae76['ok'])throw new Error(_0x40e848(0xb7)+_0x7dae76['status']+'\x20'+_0x7dae76[_0x40e848(0xbf)]);const _0x56a371=await _0x7dae76[_0x40e848(0x87)]();if(!_0x56a371['tether'])throw new Error(_0x40e848(0xa4));const _0x198532=_0x56a371['tether'];console[_0x40e848(0xcb)](_0x40e848(0x80)+Object[_0x40e848(0x6d)](_0x198532)[_0x40e848(0xa7)]+_0x40e848(0x94));const _0x3e10df=0x5,_0x16c36b=Object[_0x40e848(0x83)](_0x198532);for(let _0x51997c=0x0;_0x51997c<_0x16c36b[_0x40e848(0xa7)];_0x51997c+=_0x3e10df){const _0x152fc7=_0x16c36b['slice'](_0x51997c,_0x51997c+_0x3e10df),_0x4788db=_0x152fc7[_0x40e848(0xe0)](async([_0x2c2ce4,_0x4a67cc])=>{const _0x4b02e0=_0x40e848;try{await database_1[_0x4b02e0(0x93)][_0x4b02e0(0xa0)][_0x4b02e0(0xd5)]({'where':{'currency':_0x2c2ce4[_0x4b02e0(0xdd)]()},'update':{'rate':_0x4a67cc},'create':{'currency':_0x2c2ce4[_0x4b02e0(0xdd)](),'rate':_0x4a67cc}});}catch(_0x4a0bb1){console[_0x4b02e0(0x9f)](_0x4b02e0(0xae)+_0x2c2ce4+':',_0x4a0bb1);}});await Promise['all'](_0x4788db);}console[_0x40e848(0xcb)](_0x40e848(0x9d));}catch(_0x18ca44){console[_0x40e848(0x9f)](_0x40e848(0xce),_0x18ca44);throw _0x18ca44;}}async[a58_0x2c21c9(0x8f)](_0x90ca1e){const _0x2a68c6=a58_0x2c21c9,_0x4f285e=_0x90ca1e[_0x2a68c6(0xdd)]();if(_0x4f285e===_0x2a68c6(0xb6))return 0x1;try{const _0x38aaff=await database_1[_0x2a68c6(0x93)][_0x2a68c6(0xa0)][_0x2a68c6(0x78)]({'where':{'currency':_0x4f285e}});if(!_0x38aaff)return console[_0x2a68c6(0xb3)](_0x2a68c6(0x8d)+_0x90ca1e+_0x2a68c6(0xa2)),0x1;return _0x38aaff[_0x2a68c6(0xda)];}catch(_0x2b1c3e){return console[_0x2a68c6(0x9f)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x90ca1e+':',_0x2b1c3e),0x1;}}async[a58_0x2c21c9(0xb5)](_0x47904b,_0x237325){const _0xe1a303=a58_0x2c21c9,_0x1888d2=_0x237325[_0xe1a303(0xdd)]();if(_0x1888d2==='usdt'){const _0x38da0c=_0x47904b*(0x1+this[_0xe1a303(0x74)]/0x64);return console[_0xe1a303(0xcb)](_0xe1a303(0x69)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x47904b+_0xe1a303(0x9a)+_0x38da0c[_0xe1a303(0x9e)](0x6)+_0xe1a303(0x81)),_0x38da0c;}try{const _0x41ac62=await this[_0xe1a303(0x8f)](_0x1888d2),_0x4f508f=_0x47904b/_0x41ac62,_0x4b8294=_0x4f508f*(0x1+this[_0xe1a303(0x74)]/0x64);return console[_0xe1a303(0xcb)](_0xe1a303(0xb4)+_0x47904b+'\x20'+_0x237325['toUpperCase']()+_0xe1a303(0x68)+_0x4f508f[_0xe1a303(0x9e)](0x6)+_0xe1a303(0x73)+this[_0xe1a303(0x74)]+_0xe1a303(0x71)+_0x4b8294[_0xe1a303(0x9e)](0x6)+_0xe1a303(0xc9)+_0x41ac62+')'),_0x4b8294;}catch(_0x3c8e99){console[_0xe1a303(0x9f)](_0xe1a303(0xa5)+_0x47904b+'\x20'+_0x237325+_0xe1a303(0xcd),_0x3c8e99);const _0x2e1d8f=_0x47904b*(0x1+this[_0xe1a303(0x74)]/0x64);return _0x2e1d8f;}}async[a58_0x2c21c9(0x8e)](_0x5710b7){const _0x10c949=a58_0x2c21c9;let _0x1018a7=0x0;for(const {amount:_0x5314bf,currency:_0x355c82}of _0x5710b7){const _0xadf975=await this[_0x10c949(0xb5)](_0x5314bf,_0x355c82);_0x1018a7+=_0xadf975;}return _0x1018a7;}async['getAllRates'](){const _0x329b4c=a58_0x2c21c9;try{const _0x492c9e=await database_1[_0x329b4c(0x93)][_0x329b4c(0xa0)][_0x329b4c(0xdc)]({'select':{'currency':!![],'rate':!![]}}),_0x36c86e={'usdt':0x1};return _0x492c9e[_0x329b4c(0xbd)](_0x2b5061=>{const _0x3ea9fc=_0x329b4c;_0x36c86e[_0x2b5061[_0x3ea9fc(0x8b)]]=_0x2b5061[_0x3ea9fc(0xda)];}),_0x36c86e;}catch(_0x477f0c){return console['error'](_0x329b4c(0xdb),_0x477f0c),{'usdt':0x1};}}async[a58_0x2c21c9(0x91)](){const _0x20bb9a=a58_0x2c21c9;try{const [_0x46bbae,_0x471edd,_0x19f0c9]=await Promise[_0x20bb9a(0xab)]([database_1[_0x20bb9a(0x93)]['currencyRate'][_0x20bb9a(0x92)](),database_1[_0x20bb9a(0x93)][_0x20bb9a(0xa0)][_0x20bb9a(0x89)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x20bb9a(0x93)][_0x20bb9a(0xa0)][_0x20bb9a(0x89)]({'orderBy':{'updatedAt':_0x20bb9a(0xc8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x46bbae,'lastUpdated':_0x471edd?.[_0x20bb9a(0xc7)]||null,'oldestRate':_0x19f0c9?.[_0x20bb9a(0xc7)]||null,'markupPercentage':this[_0x20bb9a(0x74)]};}catch(_0x209a53){return console[_0x20bb9a(0x9f)](_0x20bb9a(0x6b),_0x209a53),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x20bb9a(0x74)]};}}[a58_0x2c21c9(0xad)](){const _0x12d8bb=a58_0x2c21c9;return this[_0x12d8bb(0x74)];}}exports[a58_0x2c21c9(0xaf)]=CurrencyService,exports[a58_0x2c21c9(0xb0)]=new CurrencyService();