'use strict';const a36_0x442ad5=a36_0x52a6;(function(_0x1eea2e,_0x3c02ef){const _0x36eceb=a36_0x52a6,_0x394bbc=_0x1eea2e();while(!![]){try{const _0x3a7eaa=parseInt(_0x36eceb(0x1d4))/0x1*(-parseInt(_0x36eceb(0x20a))/0x2)+parseInt(_0x36eceb(0x1d1))/0x3+-parseInt(_0x36eceb(0x1cc))/0x4+parseInt(_0x36eceb(0x215))/0x5*(-parseInt(_0x36eceb(0x1dd))/0x6)+-parseInt(_0x36eceb(0x20b))/0x7*(-parseInt(_0x36eceb(0x1dc))/0x8)+parseInt(_0x36eceb(0x1d2))/0x9*(parseInt(_0x36eceb(0x1f4))/0xa)+parseInt(_0x36eceb(0x20c))/0xb;if(_0x3a7eaa===_0x3c02ef)break;else _0x394bbc['push'](_0x394bbc['shift']());}catch(_0x53030b){_0x394bbc['push'](_0x394bbc['shift']());}}}(a36_0x5c70,0x6ab36));var __importDefault=this&&this['__importDefault']||function(_0xe0c251){return _0xe0c251&&_0xe0c251['__esModule']?_0xe0c251:{'default':_0xe0c251};};function a36_0x52a6(_0x51e2e0,_0x4f827e){const _0x5c70c7=a36_0x5c70();return a36_0x52a6=function(_0x52a665,_0x491f18){_0x52a665=_0x52a665-0x1bb;let _0x39d00d=_0x5c70c7[_0x52a665];return _0x39d00d;},a36_0x52a6(_0x51e2e0,_0x4f827e);}Object[a36_0x442ad5(0x1eb)](exports,a36_0x442ad5(0x1e0),{'value':!![]}),exports[a36_0x442ad5(0x1f3)]=exports[a36_0x442ad5(0x227)]=void 0x0;function a36_0x5c70(){const _0x36aadd=['currencyService','10bNdVnD',',\x20using\x201\x20as\x20fallback','updateInterval','gel','https://api.coingecko.com/api/v3/simple/price','COINGECKO_URL','length','toFixed','join','eth','clp','sats','toLowerCase','💱\x20Applied\x20','\x20USDT\x20=\x20','krw','brl','desc','toUpperCase','pln','keys','Error\x20getting\x20rates\x20status:','2kJSrOY','14HwooNg','4918111mNWwon','aud','dot','sar','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','getMarkupPercentage','Error\x20getting\x20all\x20rates:','pkr','xag','15hWkxsQ','Periodic\x20currency\x20rates\x20update\x20failed:','php','convertToUSDT','eos','count','stopPeriodicUpdates','mxn','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','usdt','Failed\x20to\x20update\x20rate\x20for\x20','convertMultipleToUSDT','tether','\x20to\x20','xrp','ltc','yfi','\x20to\x20USDT:','CurrencyService','log','currency','link','xau','Error\x20converting\x20','chf','startPeriodicUpdates','bnb','rate','sgd','czk','%\x20markup\x20to\x20','uah','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','❌\x20Failed\x20to\x20update\x20currency\x20rates:','findMany','entries','zar','ars','\x20USDT\x20(rate:\x20','currencyRate','getRatesStatus','bdt','error','upsert','💱\x20Converted\x20','findFirst','kwd','all','775132flSZYH','CURRENCIES','vnd','asc','bch','1161630EjdDXk','5100309pDUFwe','bmd','612182opKFLk','updateCurrencyRates','updatedAt','jpy','MARKUP_PERCENTAGE','nok','sek','cad','2153832drHcbh','1392918GJNDcU','TesSoft\x20Payment\x20System/1.0','default','__esModule','Initial\x20currency\x20rates\x20update\x20failed:','xlm','application/json','inr','✅\x20Currency\x20rates\x20updated\x20successfully','findUnique','allSettled','../config/database','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','cny','defineProperty','ngn','warn','try','lkr','idr','thb','gbp'];a36_0x5c70=function(){return _0x36aadd;};return a36_0x5c70();}const database_1=__importDefault(require(a36_0x442ad5(0x1e8)));class CurrencyService{constructor(){const _0xa262ee=a36_0x442ad5;this[_0xa262ee(0x1f9)]=_0xa262ee(0x1f8),this[_0xa262ee(0x1cd)]=['btc',_0xa262ee(0x1fd),_0xa262ee(0x224),_0xa262ee(0x1d0),_0xa262ee(0x22f),_0xa262ee(0x219),_0xa262ee(0x223),_0xa262ee(0x1e2),_0xa262ee(0x22a),_0xa262ee(0x20e),_0xa262ee(0x225),'usd','aed',_0xa262ee(0x1c1),_0xa262ee(0x20d),_0xa262ee(0x1c5),'bhd',_0xa262ee(0x1d3),_0xa262ee(0x204),_0xa262ee(0x1db),_0xa262ee(0x22d),_0xa262ee(0x1fe),_0xa262ee(0x1ea),_0xa262ee(0x232),'dkk','eur',_0xa262ee(0x1f2),_0xa262ee(0x1f7),'hkd','huf',_0xa262ee(0x1f0),'ils',_0xa262ee(0x1e4),_0xa262ee(0x1d7),_0xa262ee(0x203),_0xa262ee(0x1ca),_0xa262ee(0x1ef),'mmk',_0xa262ee(0x21c),'myr',_0xa262ee(0x1ec),_0xa262ee(0x1d9),'nzd',_0xa262ee(0x217),_0xa262ee(0x213),_0xa262ee(0x207),'rub',_0xa262ee(0x20f),_0xa262ee(0x1da),_0xa262ee(0x231),_0xa262ee(0x1f1),_0xa262ee(0x1ee),'twd',_0xa262ee(0x1bb),'vef',_0xa262ee(0x1ce),_0xa262ee(0x1c0),'xdr',_0xa262ee(0x214),_0xa262ee(0x22b),'bits',_0xa262ee(0x1ff)],this[_0xa262ee(0x1f6)]=null,this[_0xa262ee(0x1d8)]=0x3,this[_0xa262ee(0x22e)]();}[a36_0x442ad5(0x22e)](){const _0x32b620=a36_0x442ad5;this[_0x32b620(0x1d5)]()['catch'](_0x546f58=>{const _0x427279=_0x32b620;console['error'](_0x427279(0x1e1),_0x546f58);}),this[_0x32b620(0x1f6)]=setInterval(async()=>{const _0x38ac6a=_0x32b620;try{await this['updateCurrencyRates']();}catch(_0x35f537){console[_0x38ac6a(0x1c6)](_0x38ac6a(0x216),_0x35f537);}},0x3c*0x3c*0x3e8),console[_0x32b620(0x228)](_0x32b620(0x1bc));}[a36_0x442ad5(0x21b)](){const _0x314920=a36_0x442ad5;this[_0x314920(0x1f6)]&&(clearInterval(this[_0x314920(0x1f6)]),this[_0x314920(0x1f6)]=null,console['log'](_0x314920(0x210)));}async[a36_0x442ad5(0x1d5)](){const _0x142ed1=a36_0x442ad5;try{console[_0x142ed1(0x228)](_0x142ed1(0x1e9));const _0x3c05a4=this[_0x142ed1(0x1cd)][_0x142ed1(0x1fc)](','),_0x3c1d1e=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x3c05a4,_0x1d6581=await fetch(_0x3c1d1e,{'headers':{'Accept':_0x142ed1(0x1e3),'User-Agent':_0x142ed1(0x1de)}});if(!_0x1d6581['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1d6581['status']+'\x20'+_0x1d6581['statusText']);const _0x4201b5=await _0x1d6581['json']();if(!_0x4201b5[_0x142ed1(0x221)])throw new Error(_0x142ed1(0x21d));const _0x5a719f=_0x4201b5['tether'];console[_0x142ed1(0x228)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x142ed1(0x208)](_0x5a719f)[_0x142ed1(0x1fa)]+'\x20currencies');const _0x2749e2=Object[_0x142ed1(0x1bf)](_0x5a719f)['map'](async([_0x584cc6,_0x3b4ba5])=>{const _0x72af21=_0x142ed1;try{await database_1[_0x72af21(0x1df)][_0x72af21(0x1c3)][_0x72af21(0x1c7)]({'where':{'currency':_0x584cc6[_0x72af21(0x200)]()},'update':{'rate':_0x3b4ba5},'create':{'currency':_0x584cc6[_0x72af21(0x200)](),'rate':_0x3b4ba5}});}catch(_0x38a3b1){console[_0x72af21(0x1c6)](_0x72af21(0x21f)+_0x584cc6+':',_0x38a3b1);}});await Promise[_0x142ed1(0x1e7)](_0x2749e2),console['log'](_0x142ed1(0x1e5));}catch(_0x9e1102){console[_0x142ed1(0x1c6)](_0x142ed1(0x1bd),_0x9e1102);throw _0x9e1102;}}async['getCurrencyRate'](_0x9c8177){const _0x562027=a36_0x442ad5,_0x1fe9e0=_0x9c8177[_0x562027(0x200)]();if(_0x1fe9e0===_0x562027(0x21e))return 0x1;try{const _0x2ef165=await database_1[_0x562027(0x1df)][_0x562027(0x1c3)][_0x562027(0x1e6)]({'where':{'currency':_0x1fe9e0}});if(!_0x2ef165)return console[_0x562027(0x1ed)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x9c8177+_0x562027(0x1f5)),0x1;return _0x2ef165['rate'];}catch(_0x290746){return console[_0x562027(0x1c6)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x9c8177+':',_0x290746),0x1;}}async[a36_0x442ad5(0x218)](_0x3d48f0,_0x1bb4db){const _0x5aee82=a36_0x442ad5,_0x148514=_0x1bb4db[_0x5aee82(0x200)]();if(_0x148514===_0x5aee82(0x21e)){const _0x293c47=_0x3d48f0*(0x1+this[_0x5aee82(0x1d8)]/0x64);return console['log'](_0x5aee82(0x201)+this[_0x5aee82(0x1d8)]+_0x5aee82(0x233)+_0x3d48f0+_0x5aee82(0x202)+_0x293c47['toFixed'](0x6)+'\x20USDT'),_0x293c47;}try{const _0x12459b=await this['getCurrencyRate'](_0x148514),_0x5525c1=_0x3d48f0/_0x12459b,_0x245e7d=_0x5525c1*(0x1+this[_0x5aee82(0x1d8)]/0x64);return console[_0x5aee82(0x228)](_0x5aee82(0x1c8)+_0x3d48f0+'\x20'+_0x1bb4db[_0x5aee82(0x206)]()+_0x5aee82(0x222)+_0x5525c1[_0x5aee82(0x1fb)](0x6)+'\x20USDT,\x20with\x20'+this[_0x5aee82(0x1d8)]+'%\x20markup\x20=\x20'+_0x245e7d['toFixed'](0x6)+_0x5aee82(0x1c2)+_0x12459b+')'),_0x245e7d;}catch(_0x4a7774){console[_0x5aee82(0x1c6)](_0x5aee82(0x22c)+_0x3d48f0+'\x20'+_0x1bb4db+_0x5aee82(0x226),_0x4a7774);const _0x140a43=_0x3d48f0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x140a43;}}async[a36_0x442ad5(0x220)](_0x60ad32){let _0x36f5e6=0x0;for(const {amount:_0x2fcf03,currency:_0x3fabca}of _0x60ad32){const _0x581d2a=await this['convertToUSDT'](_0x2fcf03,_0x3fabca);_0x36f5e6+=_0x581d2a;}return _0x36f5e6;}async['getAllRates'](){const _0x405267=a36_0x442ad5;try{const _0x38b527=await database_1[_0x405267(0x1df)][_0x405267(0x1c3)][_0x405267(0x1be)]({'select':{'currency':!![],'rate':!![]}}),_0x7ce8d3={'usdt':0x1};return _0x38b527['forEach'](_0x21aa0c=>{const _0x4620dc=_0x405267;_0x7ce8d3[_0x21aa0c[_0x4620dc(0x229)]]=_0x21aa0c[_0x4620dc(0x230)];}),_0x7ce8d3;}catch(_0x2d4ca1){return console[_0x405267(0x1c6)](_0x405267(0x212),_0x2d4ca1),{'usdt':0x1};}}async[a36_0x442ad5(0x1c4)](){const _0x393d19=a36_0x442ad5;try{const [_0xae5eb2,_0x1f35d4,_0x1ec9d5]=await Promise[_0x393d19(0x1cb)]([database_1[_0x393d19(0x1df)][_0x393d19(0x1c3)][_0x393d19(0x21a)](),database_1[_0x393d19(0x1df)][_0x393d19(0x1c3)][_0x393d19(0x1c9)]({'orderBy':{'updatedAt':_0x393d19(0x205)},'select':{'updatedAt':!![]}}),database_1['default'][_0x393d19(0x1c3)][_0x393d19(0x1c9)]({'orderBy':{'updatedAt':_0x393d19(0x1cf)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xae5eb2,'lastUpdated':_0x1f35d4?.[_0x393d19(0x1d6)]||null,'oldestRate':_0x1ec9d5?.[_0x393d19(0x1d6)]||null,'markupPercentage':this[_0x393d19(0x1d8)]};}catch(_0x3156c4){return console[_0x393d19(0x1c6)](_0x393d19(0x209),_0x3156c4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a36_0x442ad5(0x211)](){const _0x517a89=a36_0x442ad5;return this[_0x517a89(0x1d8)];}}exports[a36_0x442ad5(0x227)]=CurrencyService,exports[a36_0x442ad5(0x1f3)]=new CurrencyService();