'use strict';const a36_0x3a6b96=a36_0x3001;(function(_0x2bd62d,_0x144e7e){const _0x19d49b=a36_0x3001,_0x5a3da7=_0x2bd62d();while(!![]){try{const _0x4f9039=-parseInt(_0x19d49b(0xef))/0x1+parseInt(_0x19d49b(0xea))/0x2*(-parseInt(_0x19d49b(0x144))/0x3)+-parseInt(_0x19d49b(0x103))/0x4+-parseInt(_0x19d49b(0x12a))/0x5*(-parseInt(_0x19d49b(0x140))/0x6)+-parseInt(_0x19d49b(0xfc))/0x7+-parseInt(_0x19d49b(0xfd))/0x8*(-parseInt(_0x19d49b(0x11d))/0x9)+parseInt(_0x19d49b(0x129))/0xa;if(_0x4f9039===_0x144e7e)break;else _0x5a3da7['push'](_0x5a3da7['shift']());}catch(_0x7693c9){_0x5a3da7['push'](_0x5a3da7['shift']());}}}(a36_0x343f,0x7836f));var __importDefault=this&&this[a36_0x3a6b96(0xe7)]||function(_0x5473de){const _0x263728=a36_0x3a6b96;return _0x5473de&&_0x5473de[_0x263728(0x109)]?_0x5473de:{'default':_0x5473de};};function a36_0x343f(){const _0x35c7b8=['statusText','%\x20markup\x20=\x20','2695637gXlEal','618280IkBoSI','count','default','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','join','idr','714020wIqYvR','Error\x20getting\x20rates\x20status:','asc','currencyRate','length','bdt','__esModule','CoinGecko\x20API\x20error:\x20','\x20USDT','\x20to\x20USDT:','try','nok','gel','jpy','ðŸ’±\x20Applied\x20','âœ…\x20Currency\x20rates\x20updated\x20successfully','toLowerCase','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','CurrencyService','\x20currencies','\x20USDT\x20(rate:\x20','xlm','huf','sar','usd','catch','27KCCNNe','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','czk','updatedAt','zar','\x20USDT,\x20with\x20','sats','Periodic\x20currency\x20rates\x20update\x20failed:','krw','tether','xdr','MARKUP_PERCENTAGE','13513660tOhLvm','648360RLyEwp','ltc','ngn','?ids=tether&vs_currencies=','Initial\x20currency\x20rates\x20update\x20failed:','convertToUSDT','hkd','lkr','cad','nzd','eos','bch','inr','stopPeriodicUpdates','bnb','keys','getRatesStatus','pln','bhd','desc','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','../config/database','18HDUPlD','btc','ils','findMany','33hgQKTH','php','vef','Failed\x20to\x20update\x20rate\x20for\x20','map','gbp','mxn','xau','%\x20markup\x20to\x20','chf','application/json','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','sek','startPeriodicUpdates','kwd','pkr','\x20USDT\x20=\x20','updateCurrencyRates','findUnique','Error\x20getting\x20rate\x20for\x20currency\x20','warn',',\x20using\x201\x20as\x20fallback','mmk','defineProperty','updateInterval','toFixed','thb','\x20to\x20','usdt','toUpperCase','currencyService','aud','getCurrencyRate','yfi','clp','__importDefault','myr','getAllRates','36536EQNgDc','error','eth','CURRENCIES','all','715294jLSyMH','bits','allSettled','xag','ðŸ’±\x20Converted\x20','log','upsert','rate','forEach','No\x20rate\x20found\x20for\x20currency:\x20','dot'];a36_0x343f=function(){return _0x35c7b8;};return a36_0x343f();}Object[a36_0x3a6b96(0xdb)](exports,a36_0x3a6b96(0x109),{'value':!![]}),exports[a36_0x3a6b96(0xe2)]=exports[a36_0x3a6b96(0x115)]=void 0x0;function a36_0x3001(_0x5b8114,_0x17de9e){const _0x343f6d=a36_0x343f();return a36_0x3001=function(_0x30018f,_0x29f9cb){_0x30018f=_0x30018f-0xda;let _0x47b588=_0x343f6d[_0x30018f];return _0x47b588;},a36_0x3001(_0x5b8114,_0x17de9e);}const database_1=__importDefault(require(a36_0x3a6b96(0x13f)));class CurrencyService{constructor(){const _0x184106=a36_0x3a6b96;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x184106(0x141),_0x184106(0xec),_0x184106(0x12b),_0x184106(0x135),_0x184106(0x138),_0x184106(0x134),'xrp',_0x184106(0x118),'link',_0x184106(0xf9),_0x184106(0xe5),_0x184106(0x11b),'aed','ars',_0x184106(0xe3),_0x184106(0x108),_0x184106(0x13c),'bmd','brl',_0x184106(0x132),_0x184106(0x14d),_0x184106(0xe6),'cny',_0x184106(0x11f),'dkk','eur',_0x184106(0x149),_0x184106(0x10f),_0x184106(0x130),_0x184106(0x119),_0x184106(0x102),_0x184106(0x142),_0x184106(0x136),_0x184106(0x110),_0x184106(0x125),_0x184106(0x152),_0x184106(0x131),_0x184106(0xda),_0x184106(0x14a),_0x184106(0xe8),_0x184106(0x12c),_0x184106(0x10e),_0x184106(0x133),_0x184106(0x145),_0x184106(0x153),_0x184106(0x13b),'rub',_0x184106(0x11a),_0x184106(0x150),'sgd',_0x184106(0xde),_0x184106(0x10d),'twd','uah',_0x184106(0x146),'vnd',_0x184106(0x121),_0x184106(0x127),_0x184106(0xf2),_0x184106(0x14b),_0x184106(0xf0),_0x184106(0x123)],this[_0x184106(0xdc)]=null,this[_0x184106(0x128)]=0x3,this[_0x184106(0x151)]();}[a36_0x3a6b96(0x151)](){const _0x40d7d4=a36_0x3a6b96;this['updateCurrencyRates']()[_0x40d7d4(0x11c)](_0x18b1e5=>{const _0x1035e7=_0x40d7d4;console[_0x1035e7(0xeb)](_0x1035e7(0x12e),_0x18b1e5);}),this[_0x40d7d4(0xdc)]=setInterval(async()=>{const _0x2cb3ce=_0x40d7d4;try{await this[_0x2cb3ce(0x155)]();}catch(_0xe7acf4){console[_0x2cb3ce(0xeb)](_0x2cb3ce(0x124),_0xe7acf4);}},0x3c*0x3c*0x3e8),console[_0x40d7d4(0xf4)](_0x40d7d4(0x14f));}[a36_0x3a6b96(0x137)](){const _0x504b66=a36_0x3a6b96;this[_0x504b66(0xdc)]&&(clearInterval(this[_0x504b66(0xdc)]),this[_0x504b66(0xdc)]=null,console['log'](_0x504b66(0x13e)));}async['updateCurrencyRates'](){const _0xa6cfc6=a36_0x3a6b96;try{console['log'](_0xa6cfc6(0x11e));const _0x1c6f5e=this[_0xa6cfc6(0xed)][_0xa6cfc6(0x101)](','),_0x598957=this['COINGECKO_URL']+_0xa6cfc6(0x12d)+_0x1c6f5e,_0x58ea73=await fetch(_0x598957,{'headers':{'Accept':_0xa6cfc6(0x14e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x58ea73['ok'])throw new Error(_0xa6cfc6(0x10a)+_0x58ea73['status']+'\x20'+_0x58ea73[_0xa6cfc6(0xfa)]);const _0x7d94a1=await _0x58ea73['json']();if(!_0x7d94a1[_0xa6cfc6(0x126)])throw new Error(_0xa6cfc6(0x100));const _0x3a1f57=_0x7d94a1[_0xa6cfc6(0x126)];console[_0xa6cfc6(0xf4)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0xa6cfc6(0x139)](_0x3a1f57)[_0xa6cfc6(0x107)]+_0xa6cfc6(0x116));const _0x51e6b6=Object['entries'](_0x3a1f57)[_0xa6cfc6(0x148)](async([_0x19e298,_0x5224a4])=>{const _0xb27680=_0xa6cfc6;try{await database_1['default']['currencyRate'][_0xb27680(0xf5)]({'where':{'currency':_0x19e298['toLowerCase']()},'update':{'rate':_0x5224a4},'create':{'currency':_0x19e298['toLowerCase'](),'rate':_0x5224a4}});}catch(_0x2521ce){console[_0xb27680(0xeb)](_0xb27680(0x147)+_0x19e298+':',_0x2521ce);}});await Promise[_0xa6cfc6(0xf1)](_0x51e6b6),console['log'](_0xa6cfc6(0x112));}catch(_0x255a39){console[_0xa6cfc6(0xeb)](_0xa6cfc6(0x114),_0x255a39);throw _0x255a39;}}async[a36_0x3a6b96(0xe4)](_0x1a90ab){const _0x48a33b=a36_0x3a6b96,_0x54e232=_0x1a90ab[_0x48a33b(0x113)]();if(_0x54e232===_0x48a33b(0xe0))return 0x1;try{const _0x32b921=await database_1['default'][_0x48a33b(0x106)][_0x48a33b(0x156)]({'where':{'currency':_0x54e232}});if(!_0x32b921)return console[_0x48a33b(0x158)](_0x48a33b(0xf8)+_0x1a90ab+_0x48a33b(0x159)),0x1;return _0x32b921[_0x48a33b(0xf6)];}catch(_0x3f8353){return console[_0x48a33b(0xeb)](_0x48a33b(0x157)+_0x1a90ab+':',_0x3f8353),0x1;}}async[a36_0x3a6b96(0x12f)](_0x7e88f4,_0x1ae37d){const _0xaee1e1=a36_0x3a6b96,_0x3fccc5=_0x1ae37d['toLowerCase']();if(_0x3fccc5===_0xaee1e1(0xe0)){const _0x8f2598=_0x7e88f4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0xaee1e1(0x111)+this[_0xaee1e1(0x128)]+_0xaee1e1(0x14c)+_0x7e88f4+_0xaee1e1(0x154)+_0x8f2598[_0xaee1e1(0xdd)](0x6)+_0xaee1e1(0x10b)),_0x8f2598;}try{const _0x3e1499=await this[_0xaee1e1(0xe4)](_0x3fccc5),_0x5a6e11=_0x7e88f4/_0x3e1499,_0x139c80=_0x5a6e11*(0x1+this[_0xaee1e1(0x128)]/0x64);return console[_0xaee1e1(0xf4)](_0xaee1e1(0xf3)+_0x7e88f4+'\x20'+_0x1ae37d[_0xaee1e1(0xe1)]()+_0xaee1e1(0xdf)+_0x5a6e11[_0xaee1e1(0xdd)](0x6)+_0xaee1e1(0x122)+this['MARKUP_PERCENTAGE']+_0xaee1e1(0xfb)+_0x139c80['toFixed'](0x6)+_0xaee1e1(0x117)+_0x3e1499+')'),_0x139c80;}catch(_0x2b2d70){console['error']('Error\x20converting\x20'+_0x7e88f4+'\x20'+_0x1ae37d+_0xaee1e1(0x10c),_0x2b2d70);const _0x5ea5a2=_0x7e88f4*(0x1+this[_0xaee1e1(0x128)]/0x64);return _0x5ea5a2;}}async['convertMultipleToUSDT'](_0x3a6e62){const _0x369796=a36_0x3a6b96;let _0x16756e=0x0;for(const {amount:_0xb0b5e,currency:_0x4d5bfd}of _0x3a6e62){const _0x41a8de=await this[_0x369796(0x12f)](_0xb0b5e,_0x4d5bfd);_0x16756e+=_0x41a8de;}return _0x16756e;}async[a36_0x3a6b96(0xe9)](){const _0x3fe2d8=a36_0x3a6b96;try{const _0x264bd6=await database_1[_0x3fe2d8(0xff)]['currencyRate'][_0x3fe2d8(0x143)]({'select':{'currency':!![],'rate':!![]}}),_0xf7a6f4={'usdt':0x1};return _0x264bd6[_0x3fe2d8(0xf7)](_0x4414cd=>{const _0x5608f6=_0x3fe2d8;_0xf7a6f4[_0x4414cd['currency']]=_0x4414cd[_0x5608f6(0xf6)];}),_0xf7a6f4;}catch(_0x5f05ac){return console[_0x3fe2d8(0xeb)]('Error\x20getting\x20all\x20rates:',_0x5f05ac),{'usdt':0x1};}}async[a36_0x3a6b96(0x13a)](){const _0x24a5d=a36_0x3a6b96;try{const [_0x53e96b,_0x2d47af,_0x2cb155]=await Promise[_0x24a5d(0xee)]([database_1[_0x24a5d(0xff)][_0x24a5d(0x106)][_0x24a5d(0xfe)](),database_1[_0x24a5d(0xff)][_0x24a5d(0x106)]['findFirst']({'orderBy':{'updatedAt':_0x24a5d(0x13d)},'select':{'updatedAt':!![]}}),database_1[_0x24a5d(0xff)][_0x24a5d(0x106)]['findFirst']({'orderBy':{'updatedAt':_0x24a5d(0x105)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x53e96b,'lastUpdated':_0x2d47af?.[_0x24a5d(0x120)]||null,'oldestRate':_0x2cb155?.[_0x24a5d(0x120)]||null,'markupPercentage':this[_0x24a5d(0x128)]};}catch(_0x429051){return console[_0x24a5d(0xeb)](_0x24a5d(0x104),_0x429051),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x24a5d(0x128)]};}}['getMarkupPercentage'](){const _0x3b21a9=a36_0x3a6b96;return this[_0x3b21a9(0x128)];}}exports[a36_0x3a6b96(0x115)]=CurrencyService,exports[a36_0x3a6b96(0xe2)]=new CurrencyService();