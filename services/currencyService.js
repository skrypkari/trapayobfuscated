'use strict';const a38_0x18d005=a38_0x26e1;(function(_0x31aea8,_0x5cead5){const _0x251e60=a38_0x26e1,_0x397867=_0x31aea8();while(!![]){try{const _0x529b90=parseInt(_0x251e60(0x81))/0x1+-parseInt(_0x251e60(0xab))/0x2*(parseInt(_0x251e60(0xf8))/0x3)+-parseInt(_0x251e60(0xf6))/0x4+parseInt(_0x251e60(0xae))/0x5+parseInt(_0x251e60(0xe1))/0x6+-parseInt(_0x251e60(0x89))/0x7*(-parseInt(_0x251e60(0xfb))/0x8)+-parseInt(_0x251e60(0x8b))/0x9;if(_0x529b90===_0x5cead5)break;else _0x397867['push'](_0x397867['shift']());}catch(_0x566af8){_0x397867['push'](_0x397867['shift']());}}}(a38_0x3b9f,0xab579));var __importDefault=this&&this[a38_0x18d005(0xca)]||function(_0xc5c6d1){const _0x2ba455=a38_0x18d005;return _0xc5c6d1&&_0xc5c6d1[_0x2ba455(0xcb)]?_0xc5c6d1:{'default':_0xc5c6d1};};Object['defineProperty'](exports,a38_0x18d005(0xcb),{'value':!![]}),exports[a38_0x18d005(0xce)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x3c350c=a38_0x18d005;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x3c350c(0xea)]=['btc',_0x3c350c(0xe4),'ltc',_0x3c350c(0x83),_0x3c350c(0xb2),_0x3c350c(0xa6),_0x3c350c(0xf1),'xlm',_0x3c350c(0xb9),_0x3c350c(0x9c),_0x3c350c(0xa2),_0x3c350c(0x92),_0x3c350c(0x94),_0x3c350c(0x8a),_0x3c350c(0xc6),_0x3c350c(0x8c),_0x3c350c(0xd4),_0x3c350c(0xbb),_0x3c350c(0xbe),_0x3c350c(0xc9),_0x3c350c(0xdf),'clp','cny',_0x3c350c(0xd2),_0x3c350c(0x80),_0x3c350c(0xac),_0x3c350c(0x84),_0x3c350c(0xf5),_0x3c350c(0xf4),_0x3c350c(0xbf),'idr',_0x3c350c(0xe5),'inr',_0x3c350c(0xed),_0x3c350c(0xdc),_0x3c350c(0xf0),_0x3c350c(0xcf),_0x3c350c(0xe8),'mxn',_0x3c350c(0xb0),_0x3c350c(0x95),_0x3c350c(0xe0),_0x3c350c(0x7f),_0x3c350c(0xd9),_0x3c350c(0x88),_0x3c350c(0x9f),_0x3c350c(0x7e),_0x3c350c(0xbc),'sek',_0x3c350c(0x85),_0x3c350c(0xb3),_0x3c350c(0xd5),_0x3c350c(0xda),'uah','vef',_0x3c350c(0x9b),_0x3c350c(0xc7),_0x3c350c(0x8d),_0x3c350c(0xd0),'xau',_0x3c350c(0xa0),_0x3c350c(0xad)],this[_0x3c350c(0xe6)]=null,this[_0x3c350c(0xba)]=0x3,this[_0x3c350c(0xd1)]();}['startPeriodicUpdates'](){const _0x4468c1=a38_0x18d005;this['updateCurrencyRates']()[_0x4468c1(0xc5)](_0x2e696f=>{const _0x45cd89=_0x4468c1;console[_0x45cd89(0xdd)](_0x45cd89(0xeb),_0x2e696f);}),this[_0x4468c1(0xe6)]=setInterval(async()=>{const _0x49e6ac=_0x4468c1;try{await this[_0x49e6ac(0xec)]();}catch(_0x439c35){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x439c35);}},0x3c*0x3c*0x3e8),console[_0x4468c1(0x98)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x18d005(0xb5)](){const _0x1a614b=a38_0x18d005;this[_0x1a614b(0xe6)]&&(clearInterval(this['updateInterval']),this[_0x1a614b(0xe6)]=null,console[_0x1a614b(0x98)](_0x1a614b(0xb8)));}async[a38_0x18d005(0xec)](){const _0x2bed56=a38_0x18d005;try{console[_0x2bed56(0x98)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x3c9e70=this[_0x2bed56(0xea)][_0x2bed56(0xb6)](','),_0x334e54=this[_0x2bed56(0x96)]+_0x2bed56(0xc1)+_0x3c9e70,_0x5c85d6=await fetch(_0x334e54,{'headers':{'Accept':_0x2bed56(0xd7),'User-Agent':_0x2bed56(0xa1)}});if(!_0x5c85d6['ok'])throw new Error(_0x2bed56(0xde)+_0x5c85d6[_0x2bed56(0xf2)]+'\x20'+_0x5c85d6[_0x2bed56(0xa7)]);const _0x4e2e5e=await _0x5c85d6[_0x2bed56(0xb7)]();if(!_0x4e2e5e[_0x2bed56(0xe9)])throw new Error(_0x2bed56(0xb4));const _0xe31b58=_0x4e2e5e[_0x2bed56(0xe9)];console[_0x2bed56(0x98)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x2bed56(0xdb)](_0xe31b58)[_0x2bed56(0x90)]+_0x2bed56(0x91));const _0x33c3c8=Object['entries'](_0xe31b58)[_0x2bed56(0x9a)](async([_0x4fa272,_0x214c4a])=>{const _0x22a7f4=_0x2bed56;try{await database_1['default'][_0x22a7f4(0x86)]['upsert']({'where':{'currency':_0x4fa272[_0x22a7f4(0xef)]()},'update':{'rate':_0x214c4a},'create':{'currency':_0x4fa272['toLowerCase'](),'rate':_0x214c4a}});}catch(_0x237841){console[_0x22a7f4(0xdd)](_0x22a7f4(0xc0)+_0x4fa272+':',_0x237841);}});await Promise['allSettled'](_0x33c3c8),console[_0x2bed56(0x98)](_0x2bed56(0xa3));}catch(_0x39bcb8){console['error'](_0x2bed56(0xd8),_0x39bcb8);throw _0x39bcb8;}}async[a38_0x18d005(0xa5)](_0x39239e){const _0x159ee1=a38_0x18d005,_0x54b318=_0x39239e[_0x159ee1(0xef)]();if(_0x54b318==='usdt')return 0x1;try{const _0x13531e=await database_1[_0x159ee1(0xcc)][_0x159ee1(0x86)]['findUnique']({'where':{'currency':_0x54b318}});if(!_0x13531e)return console[_0x159ee1(0x93)](_0x159ee1(0xa8)+_0x39239e+_0x159ee1(0x99)),0x1;return _0x13531e[_0x159ee1(0x8f)];}catch(_0x258e2c){return console['error'](_0x159ee1(0xf7)+_0x39239e+':',_0x258e2c),0x1;}}async['convertToUSDT'](_0x4f89ce,_0x3c6d28){const _0x1e9381=a38_0x18d005,_0x3d339f=_0x3c6d28['toLowerCase']();if(_0x3d339f===_0x1e9381(0x82)){const _0x4b70cb=_0x4f89ce*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x1e9381(0x87)+this[_0x1e9381(0xba)]+_0x1e9381(0xd3)+_0x4f89ce+_0x1e9381(0xaa)+_0x4b70cb['toFixed'](0x6)+_0x1e9381(0x9e)),_0x4b70cb;}try{const _0x48ff63=await this['getCurrencyRate'](_0x3d339f),_0x4da18a=_0x4f89ce/_0x48ff63,_0x44de24=_0x4da18a*(0x1+this[_0x1e9381(0xba)]/0x64);return console[_0x1e9381(0x98)](_0x1e9381(0xd6)+_0x4f89ce+'\x20'+_0x3c6d28[_0x1e9381(0xe7)]()+'\x20to\x20'+_0x4da18a[_0x1e9381(0xbd)](0x6)+_0x1e9381(0xc3)+this['MARKUP_PERCENTAGE']+_0x1e9381(0xb1)+_0x44de24[_0x1e9381(0xbd)](0x6)+_0x1e9381(0xc2)+_0x48ff63+')'),_0x44de24;}catch(_0x5ddf9b){console[_0x1e9381(0xdd)]('Error\x20converting\x20'+_0x4f89ce+'\x20'+_0x3c6d28+'\x20to\x20USDT:',_0x5ddf9b);const _0x2364e8=_0x4f89ce*(0x1+this[_0x1e9381(0xba)]/0x64);return _0x2364e8;}}async[a38_0x18d005(0xaf)](_0x1b2a19){const _0x135b3e=a38_0x18d005;let _0x248223=0x0;for(const {amount:_0x3679eb,currency:_0x2bb85b}of _0x1b2a19){const _0x398d84=await this[_0x135b3e(0x8e)](_0x3679eb,_0x2bb85b);_0x248223+=_0x398d84;}return _0x248223;}async[a38_0x18d005(0xfa)](){const _0x583927=a38_0x18d005;try{const _0x245554=await database_1[_0x583927(0xcc)][_0x583927(0x86)][_0x583927(0xc8)]({'select':{'currency':!![],'rate':!![]}}),_0x50d8ea={'usdt':0x1};return _0x245554['forEach'](_0xb66841=>{const _0x14788f=_0x583927;_0x50d8ea[_0xb66841[_0x14788f(0xcd)]]=_0xb66841[_0x14788f(0x8f)];}),_0x50d8ea;}catch(_0x1300dd){return console[_0x583927(0xdd)](_0x583927(0xa4),_0x1300dd),{'usdt':0x1};}}async[a38_0x18d005(0xe3)](){const _0x3c332c=a38_0x18d005;try{const [_0x560257,_0x6b1f7,_0xfda8bd]=await Promise[_0x3c332c(0x97)]([database_1[_0x3c332c(0xcc)][_0x3c332c(0x86)][_0x3c332c(0x9d)](),database_1[_0x3c332c(0xcc)][_0x3c332c(0x86)]['findFirst']({'orderBy':{'updatedAt':_0x3c332c(0xc4)},'select':{'updatedAt':!![]}}),database_1['default'][_0x3c332c(0x86)]['findFirst']({'orderBy':{'updatedAt':_0x3c332c(0xee)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x560257,'lastUpdated':_0x6b1f7?.[_0x3c332c(0xf3)]||null,'oldestRate':_0xfda8bd?.[_0x3c332c(0xf3)]||null,'markupPercentage':this[_0x3c332c(0xba)]};}catch(_0x3e579b){return console[_0x3c332c(0xdd)](_0x3c332c(0xa9),_0x3e579b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3c332c(0xba)]};}}[a38_0x18d005(0xf9)](){const _0x5ec07c=a38_0x18d005;return this[_0x5ec07c(0xba)];}}function a38_0x26e1(_0x344de8,_0x37f28c){const _0x3b9f17=a38_0x3b9f();return a38_0x26e1=function(_0x26e116,_0xcda0fd){_0x26e116=_0x26e116-0x7e;let _0x376e59=_0x3b9f17[_0x26e116];return _0x376e59;},a38_0x26e1(_0x344de8,_0x37f28c);}function a38_0x3b9f(){const _0x3cbbb8=['4028268SiUelL','CurrencyService','getRatesStatus','eth','ils','updateInterval','toUpperCase','mmk','tether','CURRENCIES','Initial\x20currency\x20rates\x20update\x20failed:','updateCurrencyRates','jpy','asc','toLowerCase','kwd','xrp','status','updatedAt','hkd','gel','4385452FmRGTC','Error\x20getting\x20rate\x20for\x20currency\x20','3255036tUNIxe','getMarkupPercentage','getAllRates','211832dxRcTe','rub','nzd','dkk','1187187LuUHbS','usdt','bch','gbp','sgd','currencyRate','üí±\x20Applied\x20','pkr','371EAwrNp','ars','12651489LiSZuH','bdt','xdr','convertToUSDT','rate','length','\x20currencies','usd','warn','aed','ngn','COINGECKO_URL','all','log',',\x20using\x201\x20as\x20fallback','map','vnd','dot','count','\x20USDT','pln','bits','TesSoft\x20Payment\x20System/1.0','yfi','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','Error\x20getting\x20all\x20rates:','getCurrencyRate','eos','statusText','No\x20rate\x20found\x20for\x20currency:\x20','Error\x20getting\x20rates\x20status:','\x20USDT\x20=\x20','2pkXxrn','eur','sats','5134805XRfHua','convertMultipleToUSDT','myr','%\x20markup\x20=\x20','bnb','thb','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','stopPeriodicUpdates','join','json','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','link','MARKUP_PERCENTAGE','bmd','sar','toFixed','brl','huf','Failed\x20to\x20update\x20rate\x20for\x20','?ids=tether&vs_currencies=','\x20USDT\x20(rate:\x20','\x20USDT,\x20with\x20','desc','catch','aud','zar','findMany','cad','__importDefault','__esModule','default','currency','currencyService','lkr','xag','startPeriodicUpdates','czk','%\x20markup\x20to\x20','bhd','try','üí±\x20Converted\x20','application/json','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','php','twd','keys','krw','error','CoinGecko\x20API\x20error:\x20','chf','nok'];a38_0x3b9f=function(){return _0x3cbbb8;};return a38_0x3b9f();}exports[a38_0x18d005(0xe2)]=CurrencyService,exports['currencyService']=new CurrencyService();