'use strict';const a38_0x4a12f1=a38_0x2f62;(function(_0x350059,_0x19738a){const _0x2be0c2=a38_0x2f62,_0x37b3f1=_0x350059();while(!![]){try{const _0x5322dc=-parseInt(_0x2be0c2(0x205))/0x1*(parseInt(_0x2be0c2(0x1ee))/0x2)+-parseInt(_0x2be0c2(0x1c2))/0x3*(-parseInt(_0x2be0c2(0x1c5))/0x4)+-parseInt(_0x2be0c2(0x1ff))/0x5*(parseInt(_0x2be0c2(0x1c9))/0x6)+parseInt(_0x2be0c2(0x208))/0x7*(-parseInt(_0x2be0c2(0x1eb))/0x8)+parseInt(_0x2be0c2(0x229))/0x9+-parseInt(_0x2be0c2(0x217))/0xa+-parseInt(_0x2be0c2(0x1c1))/0xb*(-parseInt(_0x2be0c2(0x219))/0xc);if(_0x5322dc===_0x19738a)break;else _0x37b3f1['push'](_0x37b3f1['shift']());}catch(_0x3e28ae){_0x37b3f1['push'](_0x37b3f1['shift']());}}}(a38_0x27ad,0x477e6));function a38_0x27ad(){const _0x37bf07=['rate','try','findMany','\x20USDT\x20(rate:\x20','toFixed','Error\x20getting\x20rate\x20for\x20currency\x20','eur','ltc','link','nzd','\x20to\x20USDT:','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','__esModule','pln','updateCurrencyRates','pkr','xau','application/json','cny','btc','1072EgDcmA','bdt','CurrencyService','254kIUNLH','aud','dot','vnd','__importDefault','brl','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','💱\x20Applied\x20','thb','statusText','sgd','idr','yfi','getCurrencyRate','allSettled','desc','../config/database','15rvdIjZ','count','sek','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','currencyService','tether','3961SnLSVl','startPeriodicUpdates','currencyRate','12635EuQIlP','updatedAt','CURRENCIES','join','gel','sar','cad','toLowerCase','ars','usd','getRatesStatus','nok','Error\x20getting\x20all\x20rates:','mmk','xrp','4329430EfIXxX','czk','28956ROGqso','stopPeriodicUpdates','ngn','toUpperCase','error','CoinGecko\x20API\x20error:\x20','\x20USDT','default','aed','log','all','findFirst','currency','usdt','kwd','zar','4762863JDCofX','❌\x20Failed\x20to\x20update\x20currency\x20rates:','updateInterval','php','xlm','No\x20rate\x20found\x20for\x20currency:\x20','\x20USDT\x20=\x20','Failed\x20to\x20update\x20rate\x20for\x20','📊\x20Received\x20rates\x20for\x20','asc','jpy','ils','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','eos','xag','getMarkupPercentage','uah','bits','keys','status','Error\x20converting\x20','Error\x20getting\x20rates\x20status:','✅\x20Currency\x20rates\x20updated\x20successfully','convertMultipleToUSDT','4587TlYobR','390873OEjGfa','warn','defineProperty','4RTjkYv','MARKUP_PERCENTAGE','chf','Initial\x20currency\x20rates\x20update\x20failed:','390042AVaXYo','bhd','bch','dkk','COINGECKO_URL','inr','Periodic\x20currency\x20rates\x20update\x20failed:','https://api.coingecko.com/api/v3/simple/price','bmd','eth','\x20currencies','clp','%\x20markup\x20=\x20','twd'];a38_0x27ad=function(){return _0x37bf07;};return a38_0x27ad();}function a38_0x2f62(_0x2f7bfb,_0x53101d){const _0x27adcb=a38_0x27ad();return a38_0x2f62=function(_0x2f6226,_0x30ba9e){_0x2f6226=_0x2f6226-0x1be;let _0x51fa1b=_0x27adcb[_0x2f6226];return _0x51fa1b;},a38_0x2f62(_0x2f7bfb,_0x53101d);}var __importDefault=this&&this[a38_0x4a12f1(0x1f2)]||function(_0x3ac55f){const _0x371ac4=a38_0x4a12f1;return _0x3ac55f&&_0x3ac55f[_0x371ac4(0x1e3)]?_0x3ac55f:{'default':_0x3ac55f};};Object[a38_0x4a12f1(0x1c4)](exports,a38_0x4a12f1(0x1e3),{'value':!![]}),exports[a38_0x4a12f1(0x203)]=exports[a38_0x4a12f1(0x1ed)]=void 0x0;const database_1=__importDefault(require(a38_0x4a12f1(0x1fe)));class CurrencyService{constructor(){const _0x17e57f=a38_0x4a12f1;this[_0x17e57f(0x1cd)]=_0x17e57f(0x1d0),this[_0x17e57f(0x20a)]=[_0x17e57f(0x1ea),_0x17e57f(0x1d2),_0x17e57f(0x1de),_0x17e57f(0x1cb),'bnb',_0x17e57f(0x236),_0x17e57f(0x216),_0x17e57f(0x22d),_0x17e57f(0x1df),_0x17e57f(0x1f0),_0x17e57f(0x1fa),_0x17e57f(0x211),_0x17e57f(0x221),_0x17e57f(0x210),_0x17e57f(0x1ef),_0x17e57f(0x1ec),_0x17e57f(0x1ca),_0x17e57f(0x1d1),_0x17e57f(0x1f3),_0x17e57f(0x20e),_0x17e57f(0x1c7),_0x17e57f(0x1d4),_0x17e57f(0x1e9),_0x17e57f(0x218),_0x17e57f(0x1cc),_0x17e57f(0x1dd),'gbp',_0x17e57f(0x20c),'hkd','huf',_0x17e57f(0x1f9),_0x17e57f(0x234),_0x17e57f(0x1ce),_0x17e57f(0x233),'krw',_0x17e57f(0x227),'lkr',_0x17e57f(0x215),'mxn','myr',_0x17e57f(0x21b),_0x17e57f(0x213),_0x17e57f(0x1e0),_0x17e57f(0x22c),_0x17e57f(0x1e6),_0x17e57f(0x1e4),'rub',_0x17e57f(0x20d),_0x17e57f(0x201),_0x17e57f(0x1f8),_0x17e57f(0x1f6),_0x17e57f(0x1d8),_0x17e57f(0x1d6),_0x17e57f(0x239),'vef',_0x17e57f(0x1f1),_0x17e57f(0x228),'xdr',_0x17e57f(0x237),_0x17e57f(0x1e7),_0x17e57f(0x23a),'sats'],this[_0x17e57f(0x22b)]=null,this[_0x17e57f(0x1c6)]=0x3,this['startPeriodicUpdates']();}[a38_0x4a12f1(0x206)](){const _0x55c039=a38_0x4a12f1;this[_0x55c039(0x1e5)]()['catch'](_0x52e2cf=>{const _0x5a4309=_0x55c039;console['error'](_0x5a4309(0x1c8),_0x52e2cf);}),this[_0x55c039(0x22b)]=setInterval(async()=>{const _0x4b8659=_0x55c039;try{await this[_0x4b8659(0x1e5)]();}catch(_0x5e8e5e){console[_0x4b8659(0x21d)](_0x4b8659(0x1cf),_0x5e8e5e);}},0x3c*0x3c*0x3e8),console['log'](_0x55c039(0x1f4));}[a38_0x4a12f1(0x21a)](){const _0x5a67d5=a38_0x4a12f1;this[_0x5a67d5(0x22b)]&&(clearInterval(this[_0x5a67d5(0x22b)]),this[_0x5a67d5(0x22b)]=null,console[_0x5a67d5(0x222)](_0x5a67d5(0x1e2)));}async[a38_0x4a12f1(0x1e5)](){const _0x1db9e1=a38_0x4a12f1;try{console[_0x1db9e1(0x222)](_0x1db9e1(0x202));const _0x555df4=this[_0x1db9e1(0x20a)][_0x1db9e1(0x20b)](','),_0x148dcc=this[_0x1db9e1(0x1cd)]+'?ids=tether&vs_currencies='+_0x555df4,_0x59e409=await fetch(_0x148dcc,{'headers':{'Accept':_0x1db9e1(0x1e8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x59e409['ok'])throw new Error(_0x1db9e1(0x21e)+_0x59e409[_0x1db9e1(0x23c)]+'\x20'+_0x59e409[_0x1db9e1(0x1f7)]);const _0x2e246d=await _0x59e409['json']();if(!_0x2e246d['tether'])throw new Error(_0x1db9e1(0x235));const _0x35108f=_0x2e246d[_0x1db9e1(0x204)];console[_0x1db9e1(0x222)](_0x1db9e1(0x231)+Object[_0x1db9e1(0x23b)](_0x35108f)['length']+_0x1db9e1(0x1d3));const _0x21017f=Object['entries'](_0x35108f)['map'](async([_0x5c2adf,_0x56c232])=>{const _0x3a1018=_0x1db9e1;try{await database_1[_0x3a1018(0x220)][_0x3a1018(0x207)]['upsert']({'where':{'currency':_0x5c2adf['toLowerCase']()},'update':{'rate':_0x56c232},'create':{'currency':_0x5c2adf[_0x3a1018(0x20f)](),'rate':_0x56c232}});}catch(_0x382f32){console['error'](_0x3a1018(0x230)+_0x5c2adf+':',_0x382f32);}});await Promise[_0x1db9e1(0x1fc)](_0x21017f),console[_0x1db9e1(0x222)](_0x1db9e1(0x1bf));}catch(_0x3d397c){console[_0x1db9e1(0x21d)](_0x1db9e1(0x22a),_0x3d397c);throw _0x3d397c;}}async[a38_0x4a12f1(0x1fb)](_0x4f935c){const _0x2a05ee=a38_0x4a12f1,_0x1e759d=_0x4f935c['toLowerCase']();if(_0x1e759d===_0x2a05ee(0x226))return 0x1;try{const _0x2095e=await database_1['default'][_0x2a05ee(0x207)]['findUnique']({'where':{'currency':_0x1e759d}});if(!_0x2095e)return console[_0x2a05ee(0x1c3)](_0x2a05ee(0x22e)+_0x4f935c+',\x20using\x201\x20as\x20fallback'),0x1;return _0x2095e[_0x2a05ee(0x1d7)];}catch(_0x5e9325){return console[_0x2a05ee(0x21d)](_0x2a05ee(0x1dc)+_0x4f935c+':',_0x5e9325),0x1;}}async['convertToUSDT'](_0x33b531,_0x5e91a7){const _0x198397=a38_0x4a12f1,_0x312c05=_0x5e91a7['toLowerCase']();if(_0x312c05===_0x198397(0x226)){const _0x307ebe=_0x33b531*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x198397(0x1f5)+this[_0x198397(0x1c6)]+'%\x20markup\x20to\x20'+_0x33b531+_0x198397(0x22f)+_0x307ebe['toFixed'](0x6)+_0x198397(0x21f)),_0x307ebe;}try{const _0x1787e7=await this['getCurrencyRate'](_0x312c05),_0x50b1a6=_0x33b531/_0x1787e7,_0x333072=_0x50b1a6*(0x1+this[_0x198397(0x1c6)]/0x64);return console[_0x198397(0x222)]('💱\x20Converted\x20'+_0x33b531+'\x20'+_0x5e91a7[_0x198397(0x21c)]()+'\x20to\x20'+_0x50b1a6['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x198397(0x1c6)]+_0x198397(0x1d5)+_0x333072[_0x198397(0x1db)](0x6)+_0x198397(0x1da)+_0x1787e7+')'),_0x333072;}catch(_0x3feaf7){console[_0x198397(0x21d)](_0x198397(0x23d)+_0x33b531+'\x20'+_0x5e91a7+_0x198397(0x1e1),_0x3feaf7);const _0x1ba8ad=_0x33b531*(0x1+this[_0x198397(0x1c6)]/0x64);return _0x1ba8ad;}}async[a38_0x4a12f1(0x1c0)](_0x41ca9f){let _0x5bd864=0x0;for(const {amount:_0x196831,currency:_0x1ba5a8}of _0x41ca9f){const _0x5c10cc=await this['convertToUSDT'](_0x196831,_0x1ba5a8);_0x5bd864+=_0x5c10cc;}return _0x5bd864;}async['getAllRates'](){const _0x57c250=a38_0x4a12f1;try{const _0x4b496e=await database_1[_0x57c250(0x220)][_0x57c250(0x207)][_0x57c250(0x1d9)]({'select':{'currency':!![],'rate':!![]}}),_0x304b88={'usdt':0x1};return _0x4b496e['forEach'](_0x5a9be9=>{const _0x26a55c=_0x57c250;_0x304b88[_0x5a9be9[_0x26a55c(0x225)]]=_0x5a9be9[_0x26a55c(0x1d7)];}),_0x304b88;}catch(_0x52996a){return console[_0x57c250(0x21d)](_0x57c250(0x214),_0x52996a),{'usdt':0x1};}}async[a38_0x4a12f1(0x212)](){const _0x64b55a=a38_0x4a12f1;try{const [_0xd38d69,_0x3ca0fd,_0x22795e]=await Promise[_0x64b55a(0x223)]([database_1[_0x64b55a(0x220)]['currencyRate'][_0x64b55a(0x200)](),database_1[_0x64b55a(0x220)][_0x64b55a(0x207)][_0x64b55a(0x224)]({'orderBy':{'updatedAt':_0x64b55a(0x1fd)},'select':{'updatedAt':!![]}}),database_1[_0x64b55a(0x220)][_0x64b55a(0x207)]['findFirst']({'orderBy':{'updatedAt':_0x64b55a(0x232)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xd38d69,'lastUpdated':_0x3ca0fd?.[_0x64b55a(0x209)]||null,'oldestRate':_0x22795e?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x2b4e18){return console[_0x64b55a(0x21d)](_0x64b55a(0x1be),_0x2b4e18),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x64b55a(0x1c6)]};}}[a38_0x4a12f1(0x238)](){const _0x3d5a5f=a38_0x4a12f1;return this[_0x3d5a5f(0x1c6)];}}exports[a38_0x4a12f1(0x1ed)]=CurrencyService,exports[a38_0x4a12f1(0x203)]=new CurrencyService();