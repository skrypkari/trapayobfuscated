'use strict';function a49_0x4a70(){const _0x8d7ca2=['all','Error\x20converting\x20','139773tFBxYU','Error\x20getting\x20rates\x20status:','531iuPOBi','php','\x20USDT,\x20with\x20','updatedAt','log','__esModule','Failed\x20to\x20update\x20rate\x20for\x20','currencyRate','map','mmk','usdt','lkr','jpy','thb','chf','findUnique','statusText','cad','idr','currencyService','stopPeriodicUpdates','hkd','length','toLowerCase','\x20currencies','convertToUSDT','krw','../config/database','COINGECKO_URL','findMany','pln','currency','rate','forEach','55624RauDOr','\x20to\x20USDT:','twd','pkr','ðŸ“Š\x20Received\x20rates\x20for\x20','Error\x20getting\x20rate\x20for\x20currency\x20','eur','count','asc','nzd','findFirst','No\x20rate\x20found\x20for\x20currency:\x20','2586205lIlZbM','bdt','\x20USDT\x20=\x20','xdr','eos','\x20to\x20','zar','getRatesStatus','xau','getMarkupPercentage','updateInterval','tether','huf','xrp','try','Initial\x20currency\x20rates\x20update\x20failed:','getCurrencyRate','dot','Periodic\x20currency\x20rates\x20update\x20failed:','Payment\x20System/1.0','20sqdZdc','sgd','xlm','ars','link','default','Error\x20getting\x20all\x20rates:','error','%\x20markup\x20=\x20','bmd','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ltc','clp','czk','rub','convertMultipleToUSDT','updateCurrencyRates','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','12PlzhYZ','desc','getAllRates','inr','myr','688258YCwoAo','MARKUP_PERCENTAGE','defineProperty','join','yfi','toFixed','application/json','vnd','bits','startPeriodicUpdates','allSettled','7642830odYoJQ','183631ngkikA','CURRENCIES','eth','https://api.coingecko.com/api/v3/simple/price','btc','ils','dkk','CoinGecko\x20API\x20error:\x20','377982pLOjbR','json','bnb','toUpperCase','mxn','aud','status','âœ…\x20Currency\x20rates\x20updated\x20successfully'];a49_0x4a70=function(){return _0x8d7ca2;};return a49_0x4a70();}const a49_0x273414=a49_0x44fc;function a49_0x44fc(_0x3d7722,_0x3a2153){_0x3d7722=_0x3d7722-0x13c;const _0x4a70db=a49_0x4a70();let _0x44fcea=_0x4a70db[_0x3d7722];return _0x44fcea;}(function(_0x45373f,_0x50ffc6){const _0x5dfa73=a49_0x44fc,_0x3b44a0=_0x45373f();while(!![]){try{const _0x3896fa=parseInt(_0x5dfa73(0x1a4))/0x1+parseInt(_0x5dfa73(0x190))/0x2+-parseInt(_0x5dfa73(0x1ae))/0x3*(-parseInt(_0x5dfa73(0x179))/0x4)+parseInt(_0x5dfa73(0x165))/0x5+parseInt(_0x5dfa73(0x18b))/0x6*(parseInt(_0x5dfa73(0x19c))/0x7)+-parseInt(_0x5dfa73(0x159))/0x8*(parseInt(_0x5dfa73(0x1b0))/0x9)+-parseInt(_0x5dfa73(0x19b))/0xa;if(_0x3896fa===_0x50ffc6)break;else _0x3b44a0['push'](_0x3b44a0['shift']());}catch(_0x53776d){_0x3b44a0['push'](_0x3b44a0['shift']());}}}(a49_0x4a70,0x55837));var __importDefault=this&&this['__importDefault']||function(_0xca4a41){const _0x2b6254=a49_0x44fc;return _0xca4a41&&_0xca4a41[_0x2b6254(0x13c)]?_0xca4a41:{'default':_0xca4a41};};Object[a49_0x273414(0x192)](exports,a49_0x273414(0x13c),{'value':!![]}),exports[a49_0x273414(0x14a)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a49_0x273414(0x152)));class CurrencyService{constructor(){const _0xca0319=a49_0x273414;this[_0xca0319(0x153)]=_0xca0319(0x19f),this[_0xca0319(0x19d)]=[_0xca0319(0x1a0),_0xca0319(0x19e),_0xca0319(0x184),'bch',_0xca0319(0x1a6),_0xca0319(0x169),_0xca0319(0x172),_0xca0319(0x17b),_0xca0319(0x17d),_0xca0319(0x176),_0xca0319(0x194),'usd','aed',_0xca0319(0x17c),_0xca0319(0x1a9),_0xca0319(0x166),'bhd',_0xca0319(0x182),'brl',_0xca0319(0x148),_0xca0319(0x145),_0xca0319(0x185),'cny',_0xca0319(0x186),_0xca0319(0x1a2),_0xca0319(0x15f),'gbp','gel',_0xca0319(0x14c),_0xca0319(0x171),_0xca0319(0x149),_0xca0319(0x1a1),_0xca0319(0x18e),_0xca0319(0x143),_0xca0319(0x151),'kwd',_0xca0319(0x142),_0xca0319(0x140),_0xca0319(0x1a8),_0xca0319(0x18f),'ngn','nok',_0xca0319(0x162),_0xca0319(0x1b1),_0xca0319(0x15c),_0xca0319(0x155),_0xca0319(0x187),'sar','sek',_0xca0319(0x17a),_0xca0319(0x144),_0xca0319(0x173),_0xca0319(0x15b),'uah','vef',_0xca0319(0x197),_0xca0319(0x16b),_0xca0319(0x168),'xag',_0xca0319(0x16d),_0xca0319(0x198),'sats'],this[_0xca0319(0x16f)]=null,this[_0xca0319(0x191)]=-0x3,this['startPeriodicUpdates']();}[a49_0x273414(0x199)](){const _0x1c3473=a49_0x273414;this[_0x1c3473(0x189)]()['catch'](_0x3976d7=>{const _0x49447f=_0x1c3473;console['error'](_0x49447f(0x174),_0x3976d7);}),this[_0x1c3473(0x16f)]=setInterval(async()=>{const _0x5bb082=_0x1c3473;try{await this[_0x5bb082(0x189)]();}catch(_0x4b6bc4){console[_0x5bb082(0x180)](_0x5bb082(0x177),_0x4b6bc4);}},0x3c*0x3c*0x3e8),console[_0x1c3473(0x1b4)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a49_0x273414(0x14b)](){const _0x540a24=a49_0x273414;this[_0x540a24(0x16f)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x540a24(0x1b4)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a49_0x273414(0x189)](){const _0x134950=a49_0x273414;try{console[_0x134950(0x1b4)](_0x134950(0x183));const _0x37d903=this[_0x134950(0x19d)][_0x134950(0x193)](','),_0x22c868=this[_0x134950(0x153)]+'?ids=tether&vs_currencies='+_0x37d903,_0x4e59ea=await fetch(_0x22c868,{'headers':{'Accept':_0x134950(0x196),'User-Agent':_0x134950(0x178)}});if(!_0x4e59ea['ok'])throw new Error(_0x134950(0x1a3)+_0x4e59ea[_0x134950(0x1aa)]+'\x20'+_0x4e59ea[_0x134950(0x147)]);const _0x86f553=await _0x4e59ea[_0x134950(0x1a5)]();if(!_0x86f553[_0x134950(0x170)])throw new Error(_0x134950(0x18a));const _0x1f89a3=_0x86f553[_0x134950(0x170)];console[_0x134950(0x1b4)](_0x134950(0x15d)+Object['keys'](_0x1f89a3)[_0x134950(0x14d)]+_0x134950(0x14f));const _0x560cec=Object['entries'](_0x1f89a3)[_0x134950(0x13f)](async([_0x2aeaa8,_0x1cb672])=>{const _0x136d77=_0x134950;try{await database_1[_0x136d77(0x17e)]['currencyRate']['upsert']({'where':{'currency':_0x2aeaa8[_0x136d77(0x14e)]()},'update':{'rate':_0x1cb672},'create':{'currency':_0x2aeaa8[_0x136d77(0x14e)](),'rate':_0x1cb672}});}catch(_0x1b34e4){console[_0x136d77(0x180)](_0x136d77(0x13d)+_0x2aeaa8+':',_0x1b34e4);}});await Promise[_0x134950(0x19a)](_0x560cec),console['log'](_0x134950(0x1ab));}catch(_0x1dca16){console[_0x134950(0x180)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x1dca16);throw _0x1dca16;}}async[a49_0x273414(0x175)](_0x19b326){const _0x1c26f9=a49_0x273414,_0x5b1b83=_0x19b326[_0x1c26f9(0x14e)]();if(_0x5b1b83===_0x1c26f9(0x141))return 0x1;try{const _0x1e9dc1=await database_1['default'][_0x1c26f9(0x13e)][_0x1c26f9(0x146)]({'where':{'currency':_0x5b1b83}});if(!_0x1e9dc1)return console['warn'](_0x1c26f9(0x164)+_0x19b326+',\x20using\x201\x20as\x20fallback'),0x1;return _0x1e9dc1['rate'];}catch(_0x3d7b6b){return console[_0x1c26f9(0x180)](_0x1c26f9(0x15e)+_0x19b326+':',_0x3d7b6b),0x1;}}async[a49_0x273414(0x150)](_0x1b71bc,_0x22c2be){const _0x1f0b65=a49_0x273414,_0x56018b=_0x22c2be['toLowerCase']();if(_0x56018b===_0x1f0b65(0x141)){const _0x5e0ad7=_0x1b71bc*(0x1+this[_0x1f0b65(0x191)]/0x64);return console['log']('ðŸ’±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x1b71bc+_0x1f0b65(0x167)+_0x5e0ad7[_0x1f0b65(0x195)](0x6)+'\x20USDT'),_0x5e0ad7;}try{const _0x3bea25=await this['getCurrencyRate'](_0x56018b),_0x46e785=_0x1b71bc/_0x3bea25,_0x22f405=_0x46e785*(0x1+this[_0x1f0b65(0x191)]/0x64);return console['log']('ðŸ’±\x20Converted\x20'+_0x1b71bc+'\x20'+_0x22c2be[_0x1f0b65(0x1a7)]()+_0x1f0b65(0x16a)+_0x46e785[_0x1f0b65(0x195)](0x6)+_0x1f0b65(0x1b2)+this[_0x1f0b65(0x191)]+_0x1f0b65(0x181)+_0x22f405[_0x1f0b65(0x195)](0x6)+'\x20USDT\x20(rate:\x20'+_0x3bea25+')'),_0x22f405;}catch(_0xae982a){console['error'](_0x1f0b65(0x1ad)+_0x1b71bc+'\x20'+_0x22c2be+_0x1f0b65(0x15a),_0xae982a);const _0x54e381=_0x1b71bc*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x54e381;}}async[a49_0x273414(0x188)](_0x165fbd){const _0x190509=a49_0x273414;let _0x265fed=0x0;for(const {amount:_0x2f925d,currency:_0x5f5b01}of _0x165fbd){const _0x51d6a9=await this[_0x190509(0x150)](_0x2f925d,_0x5f5b01);_0x265fed+=_0x51d6a9;}return _0x265fed;}async[a49_0x273414(0x18d)](){const _0x5a7aec=a49_0x273414;try{const _0x4fc471=await database_1[_0x5a7aec(0x17e)][_0x5a7aec(0x13e)][_0x5a7aec(0x154)]({'select':{'currency':!![],'rate':!![]}}),_0x5dd0e7={'usdt':0x1};return _0x4fc471[_0x5a7aec(0x158)](_0x442121=>{const _0x45014b=_0x5a7aec;_0x5dd0e7[_0x442121[_0x45014b(0x156)]]=_0x442121[_0x45014b(0x157)];}),_0x5dd0e7;}catch(_0x3c88ca){return console[_0x5a7aec(0x180)](_0x5a7aec(0x17f),_0x3c88ca),{'usdt':0x1};}}async[a49_0x273414(0x16c)](){const _0x31621e=a49_0x273414;try{const [_0x422c70,_0x5ca089,_0x398d46]=await Promise[_0x31621e(0x1ac)]([database_1['default']['currencyRate'][_0x31621e(0x160)](),database_1[_0x31621e(0x17e)][_0x31621e(0x13e)][_0x31621e(0x163)]({'orderBy':{'updatedAt':_0x31621e(0x18c)},'select':{'updatedAt':!![]}}),database_1[_0x31621e(0x17e)][_0x31621e(0x13e)][_0x31621e(0x163)]({'orderBy':{'updatedAt':_0x31621e(0x161)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x422c70,'lastUpdated':_0x5ca089?.[_0x31621e(0x1b3)]||null,'oldestRate':_0x398d46?.[_0x31621e(0x1b3)]||null,'markupPercentage':this[_0x31621e(0x191)]};}catch(_0x5ebf6d){return console[_0x31621e(0x180)](_0x31621e(0x1af),_0x5ebf6d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a49_0x273414(0x16e)](){const _0x141f04=a49_0x273414;return this[_0x141f04(0x191)];}}exports['CurrencyService']=CurrencyService,exports[a49_0x273414(0x14a)]=new CurrencyService();