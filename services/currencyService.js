'use strict';const a39_0x15786b=a39_0x5ac1;function a39_0x5ac1(_0x27c868,_0x221281){const _0x323d6a=a39_0x323d();return a39_0x5ac1=function(_0x5ac1ab,_0x458cf1){_0x5ac1ab=_0x5ac1ab-0xb1;let _0x1cadf2=_0x323d6a[_0x5ac1ab];return _0x1cadf2;},a39_0x5ac1(_0x27c868,_0x221281);}(function(_0x4798e8,_0x3419a5){const _0x137a05=a39_0x5ac1,_0xf0533d=_0x4798e8();while(!![]){try{const _0x63f0e2=-parseInt(_0x137a05(0xe2))/0x1+-parseInt(_0x137a05(0x121))/0x2+parseInt(_0x137a05(0xdb))/0x3*(-parseInt(_0x137a05(0xb9))/0x4)+-parseInt(_0x137a05(0xd4))/0x5*(-parseInt(_0x137a05(0xf0))/0x6)+-parseInt(_0x137a05(0x102))/0x7+parseInt(_0x137a05(0xf7))/0x8+parseInt(_0x137a05(0x113))/0x9*(parseInt(_0x137a05(0x10c))/0xa);if(_0x63f0e2===_0x3419a5)break;else _0xf0533d['push'](_0xf0533d['shift']());}catch(_0x1be773){_0xf0533d['push'](_0xf0533d['shift']());}}}(a39_0x323d,0xe3d0f));var __importDefault=this&&this[a39_0x15786b(0x10d)]||function(_0x1fe92a){return _0x1fe92a&&_0x1fe92a['__esModule']?_0x1fe92a:{'default':_0x1fe92a};};Object[a39_0x15786b(0x104)](exports,a39_0x15786b(0xb4),{'value':!![]}),exports[a39_0x15786b(0xc7)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x4844a9=a39_0x15786b;this[_0x4844a9(0xe4)]=_0x4844a9(0xe5),this[_0x4844a9(0xb1)]=[_0x4844a9(0xc2),_0x4844a9(0xb6),_0x4844a9(0x119),_0x4844a9(0xf9),'bnb',_0x4844a9(0xd6),_0x4844a9(0xf4),'xlm',_0x4844a9(0x107),_0x4844a9(0xf1),_0x4844a9(0xe8),_0x4844a9(0xcc),_0x4844a9(0xcf),_0x4844a9(0xc6),'aud','bdt',_0x4844a9(0xec),_0x4844a9(0xce),'brl','cad',_0x4844a9(0x11a),'clp',_0x4844a9(0xd2),_0x4844a9(0x109),'dkk',_0x4844a9(0xd3),_0x4844a9(0xd5),_0x4844a9(0xef),_0x4844a9(0xbd),_0x4844a9(0xb3),_0x4844a9(0x112),_0x4844a9(0xe9),'inr',_0x4844a9(0x114),'krw','kwd',_0x4844a9(0xb7),_0x4844a9(0xf2),_0x4844a9(0xd7),'myr',_0x4844a9(0x11c),'nok',_0x4844a9(0x101),'php',_0x4844a9(0xf6),_0x4844a9(0xfb),'rub',_0x4844a9(0x10b),'sek',_0x4844a9(0x11d),_0x4844a9(0x11e),'try','twd',_0x4844a9(0x108),'vef',_0x4844a9(0xf5),_0x4844a9(0x120),_0x4844a9(0x103),_0x4844a9(0xf3),_0x4844a9(0xe0),_0x4844a9(0xd9),'sats'],this['updateInterval']=null,this[_0x4844a9(0x10a)]=-0x3,this[_0x4844a9(0xbb)]();}[a39_0x15786b(0xbb)](){const _0x5a8dfa=a39_0x15786b;this[_0x5a8dfa(0x111)]()['catch'](_0x5e886f=>{const _0x1178ad=_0x5a8dfa;console[_0x1178ad(0xea)](_0x1178ad(0xc3),_0x5e886f);}),this[_0x5a8dfa(0x11f)]=setInterval(async()=>{const _0x29dcea=_0x5a8dfa;try{await this[_0x29dcea(0x111)]();}catch(_0x57833b){console[_0x29dcea(0xea)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x57833b);}},0x3c*0x3c*0x3e8),console['log'](_0x5a8dfa(0xfc));}[a39_0x15786b(0xde)](){const _0x488e6e=a39_0x15786b;this[_0x488e6e(0x11f)]&&(clearInterval(this[_0x488e6e(0x11f)]),this[_0x488e6e(0x11f)]=null,console[_0x488e6e(0x100)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a39_0x15786b(0x111)](){const _0x5e62a7=a39_0x15786b;try{console[_0x5e62a7(0x100)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x51c68c=this[_0x5e62a7(0xb1)][_0x5e62a7(0xd1)](','),_0x58d5f9=this[_0x5e62a7(0xe4)]+'?ids=tether&vs_currencies='+_0x51c68c,_0x444228=await fetch(_0x58d5f9,{'headers':{'Accept':'application/json','User-Agent':_0x5e62a7(0xe3)}});if(!_0x444228['ok'])throw new Error(_0x5e62a7(0x105)+_0x444228['status']+'\x20'+_0x444228[_0x5e62a7(0xc0)]);const _0x9ed8d5=await _0x444228['json']();if(!_0x9ed8d5[_0x5e62a7(0x116)])throw new Error(_0x5e62a7(0xfa));const _0x3ac610=_0x9ed8d5[_0x5e62a7(0x116)];console['log']('üìä\x20Received\x20rates\x20for\x20'+Object[_0x5e62a7(0xd8)](_0x3ac610)[_0x5e62a7(0xfe)]+_0x5e62a7(0xb5));const _0x2e5852=Object[_0x5e62a7(0xee)](_0x3ac610)[_0x5e62a7(0xc1)](async([_0xfbe537,_0x5153ce])=>{const _0xdc7274=_0x5e62a7;try{await database_1['default'][_0xdc7274(0xcb)][_0xdc7274(0xe1)]({'where':{'currency':_0xfbe537['toLowerCase']()},'update':{'rate':_0x5153ce},'create':{'currency':_0xfbe537[_0xdc7274(0xba)](),'rate':_0x5153ce}});}catch(_0x5f1a0a){console[_0xdc7274(0xea)](_0xdc7274(0xff)+_0xfbe537+':',_0x5f1a0a);}});await Promise[_0x5e62a7(0x10e)](_0x2e5852),console[_0x5e62a7(0x100)](_0x5e62a7(0xdd));}catch(_0x448073){console[_0x5e62a7(0xea)](_0x5e62a7(0x110),_0x448073);throw _0x448073;}}async[a39_0x15786b(0x10f)](_0x2ae928){const _0x1c0fd1=a39_0x15786b,_0x14fbc4=_0x2ae928[_0x1c0fd1(0xba)]();if(_0x14fbc4==='usdt')return 0x1;try{const _0x2df359=await database_1[_0x1c0fd1(0xbe)]['currencyRate'][_0x1c0fd1(0xf8)]({'where':{'currency':_0x14fbc4}});if(!_0x2df359)return console[_0x1c0fd1(0xca)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2ae928+_0x1c0fd1(0xb2)),0x1;return _0x2df359[_0x1c0fd1(0xda)];}catch(_0x39f644){return console[_0x1c0fd1(0xea)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x2ae928+':',_0x39f644),0x1;}}async['convertToUSDT'](_0x195a4f,_0x55dee2){const _0x3a4082=a39_0x15786b,_0x50bb66=_0x55dee2[_0x3a4082(0xba)]();if(_0x50bb66==='usdt'){const _0x58b122=_0x195a4f*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3a4082(0x100)](_0x3a4082(0xbf)+this['MARKUP_PERCENTAGE']+_0x3a4082(0xb8)+_0x195a4f+'\x20USDT\x20=\x20'+_0x58b122[_0x3a4082(0xcd)](0x6)+'\x20USDT'),_0x58b122;}try{const _0x124915=await this[_0x3a4082(0x10f)](_0x50bb66),_0x21751c=_0x195a4f/_0x124915,_0x39bc4a=_0x21751c*(0x1+this[_0x3a4082(0x10a)]/0x64);return console['log'](_0x3a4082(0x118)+_0x195a4f+'\x20'+_0x55dee2[_0x3a4082(0xc8)]()+'\x20to\x20'+_0x21751c[_0x3a4082(0xcd)](0x6)+'\x20USDT,\x20with\x20'+this[_0x3a4082(0x10a)]+_0x3a4082(0xdf)+_0x39bc4a[_0x3a4082(0xcd)](0x6)+_0x3a4082(0xe7)+_0x124915+')'),_0x39bc4a;}catch(_0x52da0e){console[_0x3a4082(0xea)](_0x3a4082(0xed)+_0x195a4f+'\x20'+_0x55dee2+'\x20to\x20USDT:',_0x52da0e);const _0x7b967c=_0x195a4f*(0x1+this[_0x3a4082(0x10a)]/0x64);return _0x7b967c;}}async['convertMultipleToUSDT'](_0x35f6eb){const _0x49f860=a39_0x15786b;let _0x149364=0x0;for(const {amount:_0x122dfb,currency:_0x377787}of _0x35f6eb){const _0x151b47=await this[_0x49f860(0xc4)](_0x122dfb,_0x377787);_0x149364+=_0x151b47;}return _0x149364;}async['getAllRates'](){const _0x584303=a39_0x15786b;try{const _0x884d2=await database_1[_0x584303(0xbe)][_0x584303(0xcb)][_0x584303(0xbc)]({'select':{'currency':!![],'rate':!![]}}),_0x182ac4={'usdt':0x1};return _0x884d2[_0x584303(0xd0)](_0xcbe518=>{const _0x28b3d5=_0x584303;_0x182ac4[_0xcbe518[_0x28b3d5(0xc5)]]=_0xcbe518[_0x28b3d5(0xda)];}),_0x182ac4;}catch(_0x4bae92){return console[_0x584303(0xea)](_0x584303(0xe6),_0x4bae92),{'usdt':0x1};}}async['getRatesStatus'](){const _0x1ecc26=a39_0x15786b;try{const [_0x18269a,_0x5493b7,_0x5970ae]=await Promise[_0x1ecc26(0x117)]([database_1['default']['currencyRate']['count'](),database_1[_0x1ecc26(0xbe)][_0x1ecc26(0xcb)][_0x1ecc26(0x115)]({'orderBy':{'updatedAt':_0x1ecc26(0xc9)},'select':{'updatedAt':!![]}}),database_1[_0x1ecc26(0xbe)][_0x1ecc26(0xcb)]['findFirst']({'orderBy':{'updatedAt':_0x1ecc26(0x106)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x18269a,'lastUpdated':_0x5493b7?.['updatedAt']||null,'oldestRate':_0x5970ae?.[_0x1ecc26(0xdc)]||null,'markupPercentage':this[_0x1ecc26(0x10a)]};}catch(_0xfcbefa){return console[_0x1ecc26(0xea)](_0x1ecc26(0xfd),_0xfcbefa),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x15786b(0xeb)](){const _0x6df392=a39_0x15786b;return this[_0x6df392(0x10a)];}}exports[a39_0x15786b(0x11b)]=CurrencyService,exports[a39_0x15786b(0xc7)]=new CurrencyService();function a39_0x323d(){const _0x1fe577=['%\x20markup\x20to\x20','928yRsdnO','toLowerCase','startPeriodicUpdates','findMany','hkd','default','üí±\x20Applied\x20','statusText','map','btc','Initial\x20currency\x20rates\x20update\x20failed:','convertToUSDT','currency','ars','currencyService','toUpperCase','desc','warn','currencyRate','usd','toFixed','bmd','aed','forEach','join','cny','eur','65frGXaR','gbp','eos','mxn','keys','bits','rate','318dfixFt','updatedAt','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','stopPeriodicUpdates','%\x20markup\x20=\x20','xau','upsert','1207110FdHIEP','TesSoft\x20Payment\x20System/1.0','COINGECKO_URL','https://api.coingecko.com/api/v3/simple/price','Error\x20getting\x20all\x20rates:','\x20USDT\x20(rate:\x20','yfi','ils','error','getMarkupPercentage','bhd','Error\x20converting\x20','entries','gel','387618occpoL','dot','mmk','xag','xrp','vnd','pkr','8262720egnIcN','findUnique','bch','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','pln','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Error\x20getting\x20rates\x20status:','length','Failed\x20to\x20update\x20rate\x20for\x20','log','nzd','6804070mebJMP','xdr','defineProperty','CoinGecko\x20API\x20error:\x20','asc','link','uah','czk','MARKUP_PERCENTAGE','sar','21402620FgIOQR','__importDefault','allSettled','getCurrencyRate','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','updateCurrencyRates','idr','9QSUJgn','jpy','findFirst','tether','all','üí±\x20Converted\x20','ltc','chf','CurrencyService','ngn','sgd','thb','updateInterval','zar','1752188fFizHB','CURRENCIES',',\x20using\x201\x20as\x20fallback','huf','__esModule','\x20currencies','eth','lkr'];a39_0x323d=function(){return _0x1fe577;};return a39_0x323d();}