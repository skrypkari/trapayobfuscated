'use strict';const a38_0x4e072a=a38_0x5224;(function(_0x506d49,_0x1ee517){const _0x19b50e=a38_0x5224,_0x3723f7=_0x506d49();while(!![]){try{const _0x22fed0=-parseInt(_0x19b50e(0x146))/0x1+-parseInt(_0x19b50e(0x132))/0x2+-parseInt(_0x19b50e(0x123))/0x3+-parseInt(_0x19b50e(0x145))/0x4+parseInt(_0x19b50e(0x12e))/0x5*(parseInt(_0x19b50e(0x147))/0x6)+parseInt(_0x19b50e(0x122))/0x7+parseInt(_0x19b50e(0x14c))/0x8;if(_0x22fed0===_0x1ee517)break;else _0x3723f7['push'](_0x3723f7['shift']());}catch(_0x37bab9){_0x3723f7['push'](_0x3723f7['shift']());}}}(a38_0x40c0,0x73fdc));function a38_0x5224(_0x20478c,_0x5bcea6){const _0x40c0f5=a38_0x40c0();return a38_0x5224=function(_0x52247c,_0x2678f7){_0x52247c=_0x52247c-0xcf;let _0x503a3e=_0x40c0f5[_0x52247c];return _0x503a3e;},a38_0x5224(_0x20478c,_0x5bcea6);}var __importDefault=this&&this[a38_0x4e072a(0x13c)]||function(_0xf28a84){const _0xf8fc21=a38_0x4e072a;return _0xf28a84&&_0xf28a84[_0xf8fc21(0x13f)]?_0xf28a84:{'default':_0xf28a84};};Object[a38_0x4e072a(0x134)](exports,a38_0x4e072a(0x13f),{'value':!![]}),exports['currencyService']=exports[a38_0x4e072a(0x133)]=void 0x0;const database_1=__importDefault(require(a38_0x4e072a(0x106)));class CurrencyService{constructor(){const _0x2d642b=a38_0x4e072a;this[_0x2d642b(0x103)]=_0x2d642b(0x105),this['CURRENCIES']=[_0x2d642b(0x143),_0x2d642b(0x135),_0x2d642b(0x14e),_0x2d642b(0x13d),_0x2d642b(0x130),_0x2d642b(0x125),_0x2d642b(0x127),_0x2d642b(0xec),_0x2d642b(0x126),_0x2d642b(0x114),_0x2d642b(0xfc),_0x2d642b(0x115),_0x2d642b(0xd5),_0x2d642b(0x10e),'aud',_0x2d642b(0x14b),_0x2d642b(0xdb),_0x2d642b(0xe3),_0x2d642b(0x149),_0x2d642b(0xe4),_0x2d642b(0x142),_0x2d642b(0x12b),_0x2d642b(0x117),'czk','dkk',_0x2d642b(0x13b),_0x2d642b(0x121),_0x2d642b(0x102),_0x2d642b(0x100),_0x2d642b(0x12a),_0x2d642b(0xf3),_0x2d642b(0xd8),_0x2d642b(0xd7),_0x2d642b(0x131),_0x2d642b(0xfb),'kwd',_0x2d642b(0x10f),_0x2d642b(0xdc),'mxn',_0x2d642b(0xdf),'ngn','nok',_0x2d642b(0xe5),_0x2d642b(0x128),'pkr',_0x2d642b(0xeb),_0x2d642b(0xf1),_0x2d642b(0x111),_0x2d642b(0x11f),_0x2d642b(0xe1),_0x2d642b(0xd2),_0x2d642b(0xe8),_0x2d642b(0xf9),'uah',_0x2d642b(0xe9),_0x2d642b(0xee),_0x2d642b(0x137),'xdr',_0x2d642b(0x119),_0x2d642b(0x10c),_0x2d642b(0xfd),_0x2d642b(0xe0)],this[_0x2d642b(0x129)]=null,this[_0x2d642b(0xd9)]=0x3,this['startPeriodicUpdates']();}[a38_0x4e072a(0x124)](){const _0x392b4e=a38_0x4e072a;this[_0x392b4e(0x11a)]()['catch'](_0x2ab729=>{const _0x326780=_0x392b4e;console['error'](_0x326780(0x136),_0x2ab729);}),this['updateInterval']=setInterval(async()=>{const _0x5bdcb0=_0x392b4e;try{await this[_0x5bdcb0(0x11a)]();}catch(_0x3eb8e0){console['error'](_0x5bdcb0(0xde),_0x3eb8e0);}},0x3c*0x3c*0x3e8),console['log'](_0x392b4e(0x140));}['stopPeriodicUpdates'](){const _0x55c14b=a38_0x4e072a;this[_0x55c14b(0x129)]&&(clearInterval(this[_0x55c14b(0x129)]),this[_0x55c14b(0x129)]=null,console[_0x55c14b(0x10b)](_0x55c14b(0x141)));}async['updateCurrencyRates'](){const _0x402137=a38_0x4e072a;try{console[_0x402137(0x10b)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xea59a7=this[_0x402137(0x10a)][_0x402137(0x11c)](','),_0x1ad004=this[_0x402137(0x103)]+_0x402137(0xd1)+_0xea59a7,_0x2ddc79=await fetch(_0x1ad004,{'headers':{'Accept':_0x402137(0xd6),'User-Agent':_0x402137(0xda)}});if(!_0x2ddc79['ok'])throw new Error(_0x402137(0x104)+_0x2ddc79[_0x402137(0xd4)]+'\x20'+_0x2ddc79['statusText']);const _0x768a54=await _0x2ddc79['json']();if(!_0x768a54[_0x402137(0xef)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x168003=_0x768a54[_0x402137(0xef)];console[_0x402137(0x10b)](_0x402137(0x12d)+Object[_0x402137(0x12c)](_0x168003)['length']+_0x402137(0xea));const _0x4557f7=Object['entries'](_0x168003)[_0x402137(0x108)](async([_0x695743,_0x1176d3])=>{const _0x9ab042=_0x402137;try{await database_1['default'][_0x9ab042(0x139)]['upsert']({'where':{'currency':_0x695743[_0x9ab042(0xdd)]()},'update':{'rate':_0x1176d3},'create':{'currency':_0x695743['toLowerCase'](),'rate':_0x1176d3}});}catch(_0x2d64db){console[_0x9ab042(0x11e)](_0x9ab042(0xe2)+_0x695743+':',_0x2d64db);}});await Promise[_0x402137(0xff)](_0x4557f7),console[_0x402137(0x10b)](_0x402137(0xd3));}catch(_0x32c170){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x32c170);throw _0x32c170;}}async[a38_0x4e072a(0xf4)](_0x2a6c5d){const _0x403d97=a38_0x4e072a,_0x1dc4e9=_0x2a6c5d['toLowerCase']();if(_0x1dc4e9===_0x403d97(0x11b))return 0x1;try{const _0xeb139=await database_1[_0x403d97(0x12f)][_0x403d97(0x139)]['findUnique']({'where':{'currency':_0x1dc4e9}});if(!_0xeb139)return console[_0x403d97(0xcf)](_0x403d97(0x110)+_0x2a6c5d+_0x403d97(0x138)),0x1;return _0xeb139['rate'];}catch(_0x26d7ec){return console[_0x403d97(0x11e)](_0x403d97(0xf6)+_0x2a6c5d+':',_0x26d7ec),0x1;}}async[a38_0x4e072a(0x107)](_0x4f32ec,_0x52f01b){const _0x1cdf72=a38_0x4e072a,_0x370137=_0x52f01b[_0x1cdf72(0xdd)]();if(_0x370137===_0x1cdf72(0x11b)){const _0x48d868=_0x4f32ec*(0x1+this[_0x1cdf72(0xd9)]/0x64);return console[_0x1cdf72(0x10b)](_0x1cdf72(0xf2)+this[_0x1cdf72(0xd9)]+'%\x20markup\x20to\x20'+_0x4f32ec+_0x1cdf72(0x113)+_0x48d868[_0x1cdf72(0x148)](0x6)+_0x1cdf72(0x11d)),_0x48d868;}try{const _0x2d34fd=await this[_0x1cdf72(0xf4)](_0x370137),_0x465227=_0x4f32ec/_0x2d34fd,_0x3352c4=_0x465227*(0x1+this[_0x1cdf72(0xd9)]/0x64);return console[_0x1cdf72(0x10b)](_0x1cdf72(0x101)+_0x4f32ec+'\x20'+_0x52f01b[_0x1cdf72(0x116)]()+_0x1cdf72(0xfa)+_0x465227['toFixed'](0x6)+_0x1cdf72(0xf8)+this['MARKUP_PERCENTAGE']+_0x1cdf72(0xe6)+_0x3352c4['toFixed'](0x6)+_0x1cdf72(0x14d)+_0x2d34fd+')'),_0x3352c4;}catch(_0x2d4af0){console[_0x1cdf72(0x11e)](_0x1cdf72(0x109)+_0x4f32ec+'\x20'+_0x52f01b+_0x1cdf72(0x10d),_0x2d4af0);const _0x4bdb09=_0x4f32ec*(0x1+this[_0x1cdf72(0xd9)]/0x64);return _0x4bdb09;}}async[a38_0x4e072a(0x13a)](_0xb804f1){const _0xbda3db=a38_0x4e072a;let _0x54b119=0x0;for(const {amount:_0x1ac466,currency:_0x34960f}of _0xb804f1){const _0x2129f0=await this[_0xbda3db(0x107)](_0x1ac466,_0x34960f);_0x54b119+=_0x2129f0;}return _0x54b119;}async[a38_0x4e072a(0xd0)](){const _0x49d575=a38_0x4e072a;try{const _0x103f8d=await database_1['default'][_0x49d575(0x139)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x7c5a5d={'usdt':0x1};return _0x103f8d[_0x49d575(0xf7)](_0x2a4f25=>{const _0x51ae15=_0x49d575;_0x7c5a5d[_0x2a4f25[_0x51ae15(0xfe)]]=_0x2a4f25[_0x51ae15(0xf0)];}),_0x7c5a5d;}catch(_0x325ae1){return console['error'](_0x49d575(0x118),_0x325ae1),{'usdt':0x1};}}async[a38_0x4e072a(0x14a)](){const _0xb50bec=a38_0x4e072a;try{const [_0x33f361,_0x2a83e9,_0x37a0ed]=await Promise['all']([database_1[_0xb50bec(0x12f)][_0xb50bec(0x139)][_0xb50bec(0x120)](),database_1['default'][_0xb50bec(0x139)][_0xb50bec(0xe7)]({'orderBy':{'updatedAt':_0xb50bec(0x112)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0xb50bec(0xe7)]({'orderBy':{'updatedAt':_0xb50bec(0xed)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x33f361,'lastUpdated':_0x2a83e9?.[_0xb50bec(0x13e)]||null,'oldestRate':_0x37a0ed?.[_0xb50bec(0x13e)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x53480f){return console[_0xb50bec(0x11e)](_0xb50bec(0x144),_0x53480f),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}function a38_0x40c0(){const _0x5092aa=['Error\x20converting\x20','CURRENCIES','log','xau','\x20to\x20USDT:','ars','lkr','No\x20rate\x20found\x20for\x20currency:\x20','sar','desc','\x20USDT\x20=\x20','dot','usd','toUpperCase','cny','Error\x20getting\x20all\x20rates:','xag','updateCurrencyRates','usdt','join','\x20USDT','error','sek','count','gbp','2123142VWCLrr','2575377Fzohbz','startPeriodicUpdates','eos','link','xrp','php','updateInterval','huf','clp','keys','📊\x20Received\x20rates\x20for\x20','2179820raNVZb','default','bnb','jpy','427666mmyVgj','CurrencyService','defineProperty','eth','Initial\x20currency\x20rates\x20update\x20failed:','zar',',\x20using\x201\x20as\x20fallback','currencyRate','convertMultipleToUSDT','eur','__importDefault','bch','updatedAt','__esModule','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','chf','btc','Error\x20getting\x20rates\x20status:','735120KtiXhi','873714YdPDpg','12YIWNFS','toFixed','brl','getRatesStatus','bdt','11437216hWFVVG','\x20USDT\x20(rate:\x20','ltc','warn','getAllRates','?ids=tether&vs_currencies=','thb','✅\x20Currency\x20rates\x20updated\x20successfully','status','aed','application/json','inr','ils','MARKUP_PERCENTAGE','TesSoft\x20Payment\x20System/1.0','bhd','mmk','toLowerCase','Periodic\x20currency\x20rates\x20update\x20failed:','myr','sats','sgd','Failed\x20to\x20update\x20rate\x20for\x20','bmd','cad','nzd','%\x20markup\x20=\x20','findFirst','try','vef','\x20currencies','pln','xlm','asc','vnd','tether','rate','rub','💱\x20Applied\x20','idr','getCurrencyRate','currencyService','Error\x20getting\x20rate\x20for\x20currency\x20','forEach','\x20USDT,\x20with\x20','twd','\x20to\x20','krw','yfi','bits','currency','allSettled','hkd','💱\x20Converted\x20','gel','COINGECKO_URL','CoinGecko\x20API\x20error:\x20','https://api.coingecko.com/api/v3/simple/price','../config/database','convertToUSDT','map'];a38_0x40c0=function(){return _0x5092aa;};return a38_0x40c0();}exports[a38_0x4e072a(0x133)]=CurrencyService,exports[a38_0x4e072a(0xf5)]=new CurrencyService();