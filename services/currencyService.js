'use strict';function a39_0x2080(_0xde2b37,_0x320813){const _0x4d7bcc=a39_0x4d7b();return a39_0x2080=function(_0x208027,_0x29d33f){_0x208027=_0x208027-0xa1;let _0xbe69c0=_0x4d7bcc[_0x208027];return _0xbe69c0;},a39_0x2080(_0xde2b37,_0x320813);}const a39_0xe294b=a39_0x2080;function a39_0x4d7b(){const _0xc00d26=['zar','Error\x20converting\x20','application/json','dot','huf','48276RHedol','asc','CoinGecko\x20API\x20error:\x20','twd','💱\x20Converted\x20','CURRENCIES','183366VsfIRN','krw','json','%\x20markup\x20to\x20','MARKUP_PERCENTAGE','✅\x20Currency\x20rates\x20updated\x20successfully','brl','lkr','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20USDT','toLowerCase','cny','?ids=tether&vs_currencies=','❌\x20Failed\x20to\x20update\x20currency\x20rates:','usd','findUnique','czk','cad','sgd','stopPeriodicUpdates','1021818AmFsxh','vnd','updateCurrencyRates','clp','\x20to\x20USDT:','xag','eur','1069317BUFIDo','bmd','Periodic\x20currency\x20rates\x20update\x20failed:','getRatesStatus','Error\x20getting\x20rates\x20status:','try','TesSoft\x20Payment\x20System/1.0','sar','currencyService','currencyRate','join','\x20to\x20','eth','__importDefault','vef','defineProperty','keys','chf','pkr','pln','64hdNEXS','gbp','📊\x20Received\x20rates\x20for\x20','sats','mxn','rate','16655POttlU','CurrencyService','jpy','idr','124059AbCoco',',\x20using\x201\x20as\x20fallback','getMarkupPercentage','mmk','Error\x20getting\x20all\x20rates:','php','bnb','status','error','\x20USDT\x20(rate:\x20','hkd','%\x20markup\x20=\x20','convertToUSDT','startPeriodicUpdates','findFirst','warn','toUpperCase','currency','uah','\x20currencies','gel','desc','dkk','56sgqnLm','ars','log','900190OcIESU','ils','https://api.coingecko.com/api/v3/simple/price','Error\x20getting\x20rate\x20for\x20currency\x20','count','default','getCurrencyRate','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','__esModule','upsert','ltc','aed','toFixed','eos','xdr','yfi','xrp','all','No\x20rate\x20found\x20for\x20currency:\x20','\x20USDT\x20=\x20','tether','xlm','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','findMany','xau','COINGECKO_URL','updateInterval','kwd','usdt','../config/database','myr','bdt'];a39_0x4d7b=function(){return _0xc00d26;};return a39_0x4d7b();}(function(_0x11c40e,_0x5214cd){const _0x464384=a39_0x2080,_0x2b05be=_0x11c40e();while(!![]){try{const _0xebc28d=-parseInt(_0x464384(0xf2))/0x1+-parseInt(_0x464384(0x10c))/0x2+parseInt(_0x464384(0xb9))/0x3+-parseInt(_0x464384(0x109))/0x4*(parseInt(_0x464384(0xee))/0x5)+-parseInt(_0x464384(0xb3))/0x6+-parseInt(_0x464384(0xcd))/0x7+-parseInt(_0x464384(0xe8))/0x8*(-parseInt(_0x464384(0xd4))/0x9);if(_0xebc28d===_0x5214cd)break;else _0x2b05be['push'](_0x2b05be['shift']());}catch(_0xacb766){_0x2b05be['push'](_0x2b05be['shift']());}}}(a39_0x4d7b,0x39d12));var __importDefault=this&&this[a39_0xe294b(0xe1)]||function(_0x5c4f7d){const _0x319f51=a39_0xe294b;return _0x5c4f7d&&_0x5c4f7d[_0x319f51(0x114)]?_0x5c4f7d:{'default':_0x5c4f7d};};Object[a39_0xe294b(0xe3)](exports,'__esModule',{'value':!![]}),exports[a39_0xe294b(0xdc)]=exports[a39_0xe294b(0xef)]=void 0x0;const database_1=__importDefault(require(a39_0xe294b(0xab)));class CurrencyService{constructor(){const _0x337d35=a39_0xe294b;this['COINGECKO_URL']=_0x337d35(0x10e),this[_0x337d35(0xb8)]=['btc',_0x337d35(0xe0),_0x337d35(0x116),'bch',_0x337d35(0xf8),_0x337d35(0x119),_0x337d35(0x11c),_0x337d35(0xa3),'link',_0x337d35(0xb1),_0x337d35(0x11b),_0x337d35(0xc7),_0x337d35(0x117),_0x337d35(0x10a),'aud',_0x337d35(0xad),'bhd',_0x337d35(0xd5),_0x337d35(0xbf),_0x337d35(0xca),_0x337d35(0xe5),_0x337d35(0xd0),_0x337d35(0xc4),_0x337d35(0xc9),_0x337d35(0x108),_0x337d35(0xd3),_0x337d35(0xe9),_0x337d35(0x106),_0x337d35(0xfc),_0x337d35(0xb2),_0x337d35(0xf1),_0x337d35(0x10d),'inr',_0x337d35(0xf0),_0x337d35(0xba),_0x337d35(0xa9),_0x337d35(0xc0),_0x337d35(0xf5),_0x337d35(0xec),_0x337d35(0xac),'ngn','nok','nzd',_0x337d35(0xf7),_0x337d35(0xe6),_0x337d35(0xe7),'rub',_0x337d35(0xdb),'sek',_0x337d35(0xcb),'thb',_0x337d35(0xd9),_0x337d35(0xb6),_0x337d35(0x104),_0x337d35(0xe2),_0x337d35(0xce),_0x337d35(0xae),_0x337d35(0x11a),_0x337d35(0xd2),_0x337d35(0xa6),'bits',_0x337d35(0xeb)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x337d35(0xff)]();}[a39_0xe294b(0xff)](){const _0x4eb31c=a39_0xe294b;this[_0x4eb31c(0xcf)]()['catch'](_0x1d1923=>{const _0x4bd6b1=_0x4eb31c;console[_0x4bd6b1(0xfa)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x1d1923);}),this[_0x4eb31c(0xa8)]=setInterval(async()=>{const _0x4dac19=_0x4eb31c;try{await this[_0x4dac19(0xcf)]();}catch(_0x491dec){console['error'](_0x4dac19(0xd6),_0x491dec);}},0x3c*0x3c*0x3e8),console[_0x4eb31c(0x10b)](_0x4eb31c(0xa4));}[a39_0xe294b(0xcc)](){const _0x54b993=a39_0xe294b;this[_0x54b993(0xa8)]&&(clearInterval(this[_0x54b993(0xa8)]),this[_0x54b993(0xa8)]=null,console[_0x54b993(0x10b)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a39_0xe294b(0xcf)](){const _0x2e8e10=a39_0xe294b;try{console[_0x2e8e10(0x10b)](_0x2e8e10(0x113));const _0x378e9b=this[_0x2e8e10(0xb8)][_0x2e8e10(0xde)](','),_0x386483=this[_0x2e8e10(0xa7)]+_0x2e8e10(0xc5)+_0x378e9b,_0x1c0021=await fetch(_0x386483,{'headers':{'Accept':_0x2e8e10(0xb0),'User-Agent':_0x2e8e10(0xda)}});if(!_0x1c0021['ok'])throw new Error(_0x2e8e10(0xb5)+_0x1c0021[_0x2e8e10(0xf9)]+'\x20'+_0x1c0021['statusText']);const _0x26430e=await _0x1c0021[_0x2e8e10(0xbb)]();if(!_0x26430e[_0x2e8e10(0xa2)])throw new Error(_0x2e8e10(0xc1));const _0xb13bf6=_0x26430e[_0x2e8e10(0xa2)];console[_0x2e8e10(0x10b)](_0x2e8e10(0xea)+Object[_0x2e8e10(0xe4)](_0xb13bf6)['length']+_0x2e8e10(0x105));const _0x4b7317=Object['entries'](_0xb13bf6)['map'](async([_0x2313e6,_0x6f5672])=>{const _0x33238e=_0x2e8e10;try{await database_1['default'][_0x33238e(0xdd)][_0x33238e(0x115)]({'where':{'currency':_0x2313e6[_0x33238e(0xc3)]()},'update':{'rate':_0x6f5672},'create':{'currency':_0x2313e6[_0x33238e(0xc3)](),'rate':_0x6f5672}});}catch(_0x278f3d){console[_0x33238e(0xfa)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x2313e6+':',_0x278f3d);}});await Promise['allSettled'](_0x4b7317),console[_0x2e8e10(0x10b)](_0x2e8e10(0xbe));}catch(_0x58167a){console['error'](_0x2e8e10(0xc6),_0x58167a);throw _0x58167a;}}async['getCurrencyRate'](_0x13a4ba){const _0x29f2ae=a39_0xe294b,_0x3cbfb9=_0x13a4ba[_0x29f2ae(0xc3)]();if(_0x3cbfb9===_0x29f2ae(0xaa))return 0x1;try{const _0x550178=await database_1[_0x29f2ae(0x111)][_0x29f2ae(0xdd)][_0x29f2ae(0xc8)]({'where':{'currency':_0x3cbfb9}});if(!_0x550178)return console[_0x29f2ae(0x101)](_0x29f2ae(0x11e)+_0x13a4ba+_0x29f2ae(0xf3)),0x1;return _0x550178[_0x29f2ae(0xed)];}catch(_0x5845f5){return console['error'](_0x29f2ae(0x10f)+_0x13a4ba+':',_0x5845f5),0x1;}}async[a39_0xe294b(0xfe)](_0x523cae,_0x4d5846){const _0x7576f8=a39_0xe294b,_0x3b6a9f=_0x4d5846['toLowerCase']();if(_0x3b6a9f===_0x7576f8(0xaa)){const _0x584391=_0x523cae*(0x1+this[_0x7576f8(0xbd)]/0x64);return console[_0x7576f8(0x10b)]('💱\x20Applied\x20'+this[_0x7576f8(0xbd)]+_0x7576f8(0xbc)+_0x523cae+_0x7576f8(0xa1)+_0x584391[_0x7576f8(0x118)](0x6)+_0x7576f8(0xc2)),_0x584391;}try{const _0x451f12=await this[_0x7576f8(0x112)](_0x3b6a9f),_0x4accd4=_0x523cae/_0x451f12,_0x158c10=_0x4accd4*(0x1+this[_0x7576f8(0xbd)]/0x64);return console[_0x7576f8(0x10b)](_0x7576f8(0xb7)+_0x523cae+'\x20'+_0x4d5846[_0x7576f8(0x102)]()+_0x7576f8(0xdf)+_0x4accd4[_0x7576f8(0x118)](0x6)+'\x20USDT,\x20with\x20'+this[_0x7576f8(0xbd)]+_0x7576f8(0xfd)+_0x158c10[_0x7576f8(0x118)](0x6)+_0x7576f8(0xfb)+_0x451f12+')'),_0x158c10;}catch(_0x224584){console['error'](_0x7576f8(0xaf)+_0x523cae+'\x20'+_0x4d5846+_0x7576f8(0xd1),_0x224584);const _0x39bbfc=_0x523cae*(0x1+this[_0x7576f8(0xbd)]/0x64);return _0x39bbfc;}}async['convertMultipleToUSDT'](_0x39937c){const _0x1b74b6=a39_0xe294b;let _0x19638a=0x0;for(const {amount:_0x466fb9,currency:_0x45e77f}of _0x39937c){const _0x3a39b3=await this[_0x1b74b6(0xfe)](_0x466fb9,_0x45e77f);_0x19638a+=_0x3a39b3;}return _0x19638a;}async['getAllRates'](){const _0x426691=a39_0xe294b;try{const _0x5e96dc=await database_1['default']['currencyRate'][_0x426691(0xa5)]({'select':{'currency':!![],'rate':!![]}}),_0x15148d={'usdt':0x1};return _0x5e96dc['forEach'](_0x474dc9=>{const _0x4686ce=_0x426691;_0x15148d[_0x474dc9[_0x4686ce(0x103)]]=_0x474dc9[_0x4686ce(0xed)];}),_0x15148d;}catch(_0x215b64){return console[_0x426691(0xfa)](_0x426691(0xf6),_0x215b64),{'usdt':0x1};}}async[a39_0xe294b(0xd7)](){const _0x451c2c=a39_0xe294b;try{const [_0x50207f,_0x13e381,_0x6b1242]=await Promise[_0x451c2c(0x11d)]([database_1[_0x451c2c(0x111)]['currencyRate'][_0x451c2c(0x110)](),database_1[_0x451c2c(0x111)][_0x451c2c(0xdd)][_0x451c2c(0x100)]({'orderBy':{'updatedAt':_0x451c2c(0x107)},'select':{'updatedAt':!![]}}),database_1['default'][_0x451c2c(0xdd)][_0x451c2c(0x100)]({'orderBy':{'updatedAt':_0x451c2c(0xb4)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x50207f,'lastUpdated':_0x13e381?.['updatedAt']||null,'oldestRate':_0x6b1242?.['updatedAt']||null,'markupPercentage':this[_0x451c2c(0xbd)]};}catch(_0x2954eb){return console[_0x451c2c(0xfa)](_0x451c2c(0xd8),_0x2954eb),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x451c2c(0xbd)]};}}[a39_0xe294b(0xf4)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a39_0xe294b(0xdc)]=new CurrencyService();