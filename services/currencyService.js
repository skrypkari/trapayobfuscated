'use strict';const a58_0x178d18=a58_0x41a5;(function(_0x2e274c,_0x1ddb27){const _0x3e4c84=a58_0x41a5,_0x3284c2=_0x2e274c();while(!![]){try{const _0x2a8335=parseInt(_0x3e4c84(0x1d2))/0x1+-parseInt(_0x3e4c84(0x227))/0x2+-parseInt(_0x3e4c84(0x22f))/0x3+-parseInt(_0x3e4c84(0x210))/0x4+-parseInt(_0x3e4c84(0x22e))/0x5+-parseInt(_0x3e4c84(0x220))/0x6+parseInt(_0x3e4c84(0x1dd))/0x7*(parseInt(_0x3e4c84(0x1e3))/0x8);if(_0x2a8335===_0x1ddb27)break;else _0x3284c2['push'](_0x3284c2['shift']());}catch(_0x12502b){_0x3284c2['push'](_0x3284c2['shift']());}}}(a58_0x40c8,0x640a1));function a58_0x41a5(_0x282976,_0x2766ff){_0x282976=_0x282976-0x1cc;const _0x40c849=a58_0x40c8();let _0x41a5cb=_0x40c849[_0x282976];return _0x41a5cb;}var __importDefault=this&&this['__importDefault']||function(_0x20fed1){const _0x2fb182=a58_0x41a5;return _0x20fed1&&_0x20fed1[_0x2fb182(0x1e0)]?_0x20fed1:{'default':_0x20fed1};};Object['defineProperty'](exports,a58_0x178d18(0x1e0),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a58_0x178d18(0x21c)));class CurrencyService{constructor(){const _0x132b9f=a58_0x178d18;this[_0x132b9f(0x215)]=_0x132b9f(0x237),this['CURRENCIES']=[_0x132b9f(0x200),'eth','ltc','bch',_0x132b9f(0x205),_0x132b9f(0x217),_0x132b9f(0x229),'xlm','link',_0x132b9f(0x209),_0x132b9f(0x22c),_0x132b9f(0x1ea),_0x132b9f(0x207),_0x132b9f(0x1f8),_0x132b9f(0x20e),_0x132b9f(0x218),_0x132b9f(0x239),'bmd',_0x132b9f(0x1e9),_0x132b9f(0x1e7),_0x132b9f(0x1cf),_0x132b9f(0x1df),_0x132b9f(0x202),_0x132b9f(0x221),_0x132b9f(0x1f6),_0x132b9f(0x21a),'gbp','gel',_0x132b9f(0x1da),_0x132b9f(0x1f7),_0x132b9f(0x21e),_0x132b9f(0x1cc),_0x132b9f(0x224),'jpy',_0x132b9f(0x1ec),_0x132b9f(0x21d),_0x132b9f(0x1f2),_0x132b9f(0x228),'mxn',_0x132b9f(0x1db),_0x132b9f(0x20a),_0x132b9f(0x21f),_0x132b9f(0x1f5),_0x132b9f(0x233),_0x132b9f(0x235),_0x132b9f(0x1fc),_0x132b9f(0x225),_0x132b9f(0x1ff),'sek',_0x132b9f(0x1d5),'thb',_0x132b9f(0x242),_0x132b9f(0x1d3),_0x132b9f(0x240),_0x132b9f(0x212),_0x132b9f(0x21b),_0x132b9f(0x1cd),_0x132b9f(0x1e4),_0x132b9f(0x1d0),_0x132b9f(0x1e1),_0x132b9f(0x20d),_0x132b9f(0x232)],this[_0x132b9f(0x23f)]=null,this[_0x132b9f(0x201)]=-0x3,this[_0x132b9f(0x1f4)]();}[a58_0x178d18(0x1f4)](){const _0x14e6a6=a58_0x178d18;this[_0x14e6a6(0x1f9)]()[_0x14e6a6(0x234)](_0x2e4acf=>{const _0xecb9ad=_0x14e6a6;console[_0xecb9ad(0x23c)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x2e4acf);}),this[_0x14e6a6(0x23f)]=setInterval(async()=>{const _0x14be24=_0x14e6a6;try{await this[_0x14be24(0x1f9)]();}catch(_0x240407){console[_0x14be24(0x23c)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x240407);}},0x3c*0x3c*0x3e8),console[_0x14e6a6(0x1fa)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0xded214=a58_0x178d18;this['updateInterval']&&(clearInterval(this[_0xded214(0x23f)]),this['updateInterval']=null,console[_0xded214(0x1fa)](_0xded214(0x1d6)));}async[a58_0x178d18(0x1f9)](){const _0x1ad30e=a58_0x178d18;try{console[_0x1ad30e(0x1fa)](_0x1ad30e(0x1ef));const _0x2abaa9=this[_0x1ad30e(0x211)][_0x1ad30e(0x1ee)](','),_0x5f076c=this[_0x1ad30e(0x215)]+_0x1ad30e(0x213)+_0x2abaa9,_0x28a5b8=await fetch(_0x5f076c,{'headers':{'Accept':'application/json','User-Agent':_0x1ad30e(0x204)}});if(!_0x28a5b8['ok'])throw new Error(_0x1ad30e(0x1d7)+_0x28a5b8['status']+'\x20'+_0x28a5b8['statusText']);const _0x1e8965=await _0x28a5b8[_0x1ad30e(0x238)]();if(!_0x1e8965[_0x1ad30e(0x231)])throw new Error(_0x1ad30e(0x236));const _0x1d25d9=_0x1e8965[_0x1ad30e(0x231)];console[_0x1ad30e(0x1fa)](_0x1ad30e(0x219)+Object[_0x1ad30e(0x226)](_0x1d25d9)['length']+_0x1ad30e(0x230));const _0x3a6e41=0x5,_0x29a681=Object['entries'](_0x1d25d9);for(let _0x453f78=0x0;_0x453f78<_0x29a681[_0x1ad30e(0x1e8)];_0x453f78+=_0x3a6e41){const _0x4735f8=_0x29a681[_0x1ad30e(0x22d)](_0x453f78,_0x453f78+_0x3a6e41),_0x34b581=_0x4735f8[_0x1ad30e(0x1ed)](async([_0x394ff4,_0x593565])=>{const _0x11310c=_0x1ad30e;try{await database_1[_0x11310c(0x1ce)][_0x11310c(0x241)][_0x11310c(0x1e6)]({'where':{'currency':_0x394ff4[_0x11310c(0x203)]()},'update':{'rate':_0x593565},'create':{'currency':_0x394ff4['toLowerCase'](),'rate':_0x593565}});}catch(_0x176e1f){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x394ff4+':',_0x176e1f);}});await Promise[_0x1ad30e(0x1dc)](_0x34b581);}console[_0x1ad30e(0x1fa)](_0x1ad30e(0x20b));}catch(_0x1d3a73){console['error'](_0x1ad30e(0x1d4),_0x1d3a73);throw _0x1d3a73;}}async[a58_0x178d18(0x1e5)](_0x14f3a7){const _0x275ea2=a58_0x178d18,_0x40a227=_0x14f3a7[_0x275ea2(0x203)]();if(_0x40a227==='usdt')return 0x1;try{const _0x5ea62d=await database_1['default']['currencyRate'][_0x275ea2(0x1e2)]({'where':{'currency':_0x40a227}});if(!_0x5ea62d)return console[_0x275ea2(0x23d)](_0x275ea2(0x1d1)+_0x14f3a7+_0x275ea2(0x1f0)),0x1;return _0x5ea62d[_0x275ea2(0x22a)];}catch(_0x503476){return console[_0x275ea2(0x23c)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x14f3a7+':',_0x503476),0x1;}}async[a58_0x178d18(0x1fe)](_0x105665,_0x5d207e){const _0x12701a=a58_0x178d18,_0x53c73d=_0x5d207e[_0x12701a(0x203)]();if(_0x53c73d===_0x12701a(0x1de)){const _0xa18a3b=_0x105665*(0x1+this[_0x12701a(0x201)]/0x64);return console[_0x12701a(0x1fa)](_0x12701a(0x208)+this['MARKUP_PERCENTAGE']+_0x12701a(0x1d9)+_0x105665+_0x12701a(0x1fd)+_0xa18a3b[_0x12701a(0x23b)](0x6)+_0x12701a(0x222)),_0xa18a3b;}try{const _0x5abbbd=await this[_0x12701a(0x1e5)](_0x53c73d),_0x2cd81f=_0x105665/_0x5abbbd,_0x2332a7=_0x2cd81f*(0x1+this[_0x12701a(0x201)]/0x64);return console[_0x12701a(0x1fa)](_0x12701a(0x20f)+_0x105665+'\x20'+_0x5d207e[_0x12701a(0x23a)]()+_0x12701a(0x1d8)+_0x2cd81f[_0x12701a(0x23b)](0x6)+'\x20USDT,\x20with\x20'+this[_0x12701a(0x201)]+_0x12701a(0x1eb)+_0x2332a7[_0x12701a(0x23b)](0x6)+'\x20USDT\x20(rate:\x20'+_0x5abbbd+')'),_0x2332a7;}catch(_0xa43ad3){console['error']('Error\x20converting\x20'+_0x105665+'\x20'+_0x5d207e+'\x20to\x20USDT:',_0xa43ad3);const _0x1542ac=_0x105665*(0x1+this[_0x12701a(0x201)]/0x64);return _0x1542ac;}}async[a58_0x178d18(0x23e)](_0x1047da){const _0x279433=a58_0x178d18;let _0x4f2979=0x0;for(const {amount:_0x2878f3,currency:_0x544a0c}of _0x1047da){const _0x3bcc96=await this[_0x279433(0x1fe)](_0x2878f3,_0x544a0c);_0x4f2979+=_0x3bcc96;}return _0x4f2979;}async[a58_0x178d18(0x22b)](){const _0x3602e0=a58_0x178d18;try{const _0x4bd9c0=await database_1[_0x3602e0(0x1ce)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x5e7a73={'usdt':0x1};return _0x4bd9c0[_0x3602e0(0x1fb)](_0xed87cf=>{const _0x4bad87=_0x3602e0;_0x5e7a73[_0xed87cf['currency']]=_0xed87cf[_0x4bad87(0x22a)];}),_0x5e7a73;}catch(_0x561788){return console[_0x3602e0(0x23c)](_0x3602e0(0x214),_0x561788),{'usdt':0x1};}}async['getRatesStatus'](){const _0xaf56be=a58_0x178d18;try{const [_0x205228,_0x1ee631,_0x41143f]=await Promise[_0xaf56be(0x1dc)]([database_1[_0xaf56be(0x1ce)]['currencyRate'][_0xaf56be(0x206)](),database_1['default'][_0xaf56be(0x241)][_0xaf56be(0x216)]({'orderBy':{'updatedAt':_0xaf56be(0x1f3)},'select':{'updatedAt':!![]}}),database_1[_0xaf56be(0x1ce)][_0xaf56be(0x241)][_0xaf56be(0x216)]({'orderBy':{'updatedAt':_0xaf56be(0x1f1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x205228,'lastUpdated':_0x1ee631?.['updatedAt']||null,'oldestRate':_0x41143f?.['updatedAt']||null,'markupPercentage':this[_0xaf56be(0x201)]};}catch(_0x30deef){return console[_0xaf56be(0x23c)](_0xaf56be(0x223),_0x30deef),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a58_0x178d18(0x20c)](){const _0x595fdd=a58_0x178d18;return this[_0x595fdd(0x201)];}}function a58_0x40c8(){const _0x99f413=['hkd','myr','all','7CHOinF','usdt','clp','__esModule','xau','findUnique','21201832OEtDME','xdr','getCurrencyRate','upsert','cad','length','brl','usd','%\x20markup\x20=\x20','krw','map','join','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...',',\x20using\x201\x20as\x20fallback','asc','lkr','desc','startPeriodicUpdates','nzd','dkk','huf','ars','updateCurrencyRates','log','forEach','pln','\x20USDT\x20=\x20','convertToUSDT','sar','btc','MARKUP_PERCENTAGE','cny','toLowerCase','Payment\x20System/1.0','bnb','count','aed','üí±\x20Applied\x20','dot','ngn','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','getMarkupPercentage','bits','aud','üí±\x20Converted\x20','1753248vXVNXb','CURRENCIES','vef','?ids=tether&vs_currencies=','Error\x20getting\x20all\x20rates:','COINGECKO_URL','findFirst','eos','bdt','üìä\x20Received\x20rates\x20for\x20','eur','vnd','../config/database','kwd','idr','nok','3500814QBNFcT','czk','\x20USDT','Error\x20getting\x20rates\x20status:','inr','rub','keys','1143878eumNbP','mmk','xrp','rate','getAllRates','yfi','slice','327895NOTUAw','1981914KvoqVZ','\x20currencies','tether','sats','php','catch','pkr','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','https://api.coingecko.com/api/v3/simple/price','json','bhd','toUpperCase','toFixed','error','warn','convertMultipleToUSDT','updateInterval','uah','currencyRate','try','ils','zar','default','chf','xag','No\x20rate\x20found\x20for\x20currency:\x20','79469jrAmGy','twd','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','sgd','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','CoinGecko\x20API\x20error:\x20','\x20to\x20','%\x20markup\x20to\x20'];a58_0x40c8=function(){return _0x99f413;};return a58_0x40c8();}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();