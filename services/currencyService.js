'use strict';function a39_0x320a(_0x5be443,_0x1e2a8a){const _0x45366d=a39_0x4536();return a39_0x320a=function(_0x320a8d,_0x5a64bd){_0x320a8d=_0x320a8d-0x106;let _0x3cd37e=_0x45366d[_0x320a8d];return _0x3cd37e;},a39_0x320a(_0x5be443,_0x1e2a8a);}const a39_0x31aecd=a39_0x320a;function a39_0x4536(){const _0x6b9e1a=['currency','thb','mmk','findFirst','join','\x20to\x20USDT:','currencyService','huf','entries','Initial\x20currency\x20rates\x20update\x20failed:','CoinGecko\x20API\x20error:\x20','updateInterval','xag','status','10rwmLlL','sar','__importDefault','findMany','rub','\x20USDT\x20(rate:\x20','94094yFwJjn','upsert','updatedAt','uah','getCurrencyRate','__esModule','toLowerCase','allSettled','sats','cad','ngn','krw','CURRENCIES','bdt','Error\x20getting\x20rate\x20for\x20currency\x20','try','pln','count','Error\x20getting\x20rates\x20status:','\x20USDT\x20=\x20','aed','tether','gel','json','\x20currencies','defineProperty','log','findUnique','length','COINGECKO_URL','?ids=tether&vs_currencies=','error','catch','hkd','nok','74499GIMhIZ','../config/database','eos','37575pLtMJO','startPeriodicUpdates','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','https://api.coingecko.com/api/v3/simple/price','No\x20rate\x20found\x20for\x20currency:\x20','3160qTphSM','Error\x20getting\x20all\x20rates:','xrp','7034344eWmUfg','rate','bmd','mxn','\x20USDT','CurrencyService','5127174lzQTsI','eth','usd','zar','%\x20markup\x20to\x20','currencyRate','default','xdr','💱\x20Converted\x20','bhd','toFixed','3532424pdhKtI','%\x20markup\x20=\x20','updateCurrencyRates','getRatesStatus','sek','bch','twd','cny','dkk','warn','brl','forEach','aud','MARKUP_PERCENTAGE','ils','nzd','dot',',\x20using\x201\x20as\x20fallback','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','keys','\x20USDT,\x20with\x20','convertMultipleToUSDT','inr','ltc','czk','5JhhKQo','TesSoft\x20Payment\x20System/1.0','desc','idr','usdt','toUpperCase','kwd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','statusText','ars','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','vnd','Periodic\x20currency\x20rates\x20update\x20failed:','getMarkupPercentage','btc','pkr','application/json','myr','3968426xZDfcr'];a39_0x4536=function(){return _0x6b9e1a;};return a39_0x4536();}(function(_0x540cb9,_0x2a32b8){const _0x18d91b=a39_0x320a,_0x555030=_0x540cb9();while(!![]){try{const _0x3d8855=parseInt(_0x18d91b(0x130))/0x1*(parseInt(_0x18d91b(0x136))/0x2)+-parseInt(_0x18d91b(0x159))/0x3+-parseInt(_0x18d91b(0x175))/0x4*(-parseInt(_0x18d91b(0x10f))/0x5)+-parseInt(_0x18d91b(0x16a))/0x6+parseInt(_0x18d91b(0x121))/0x7+parseInt(_0x18d91b(0x164))/0x8+parseInt(_0x18d91b(0x15c))/0x9*(-parseInt(_0x18d91b(0x161))/0xa);if(_0x3d8855===_0x2a32b8)break;else _0x555030['push'](_0x555030['shift']());}catch(_0x4394c0){_0x555030['push'](_0x555030['shift']());}}}(a39_0x4536,0x92c25));var __importDefault=this&&this[a39_0x31aecd(0x132)]||function(_0x577394){const _0x473621=a39_0x31aecd;return _0x577394&&_0x577394[_0x473621(0x13b)]?_0x577394:{'default':_0x577394};};Object[a39_0x31aecd(0x14f)](exports,'__esModule',{'value':!![]}),exports[a39_0x31aecd(0x128)]=exports[a39_0x31aecd(0x169)]=void 0x0;const database_1=__importDefault(require(a39_0x31aecd(0x15a)));class CurrencyService{constructor(){const _0x57f557=a39_0x31aecd;this[_0x57f557(0x153)]=_0x57f557(0x15f),this[_0x57f557(0x142)]=[_0x57f557(0x11d),_0x57f557(0x16b),_0x57f557(0x10d),_0x57f557(0x17a),'bnb',_0x57f557(0x15b),_0x57f557(0x163),'xlm','link',_0x57f557(0x106),'yfi',_0x57f557(0x16c),_0x57f557(0x14a),_0x57f557(0x118),_0x57f557(0x181),_0x57f557(0x143),_0x57f557(0x173),_0x57f557(0x166),_0x57f557(0x17f),_0x57f557(0x13f),'chf','clp',_0x57f557(0x17c),_0x57f557(0x10e),_0x57f557(0x17d),'eur','gbp',_0x57f557(0x14c),_0x57f557(0x157),_0x57f557(0x129),_0x57f557(0x112),_0x57f557(0x183),_0x57f557(0x10c),'jpy',_0x57f557(0x141),_0x57f557(0x115),'lkr',_0x57f557(0x124),_0x57f557(0x167),_0x57f557(0x120),_0x57f557(0x140),_0x57f557(0x158),_0x57f557(0x184),'php',_0x57f557(0x11e),_0x57f557(0x146),_0x57f557(0x134),_0x57f557(0x131),_0x57f557(0x179),'sgd',_0x57f557(0x123),_0x57f557(0x145),_0x57f557(0x17b),_0x57f557(0x139),'vef',_0x57f557(0x11a),_0x57f557(0x16d),_0x57f557(0x171),_0x57f557(0x12e),'xau','bits',_0x57f557(0x13e)],this[_0x57f557(0x12d)]=null,this[_0x57f557(0x182)]=0x3,this['startPeriodicUpdates']();}[a39_0x31aecd(0x15d)](){const _0x4551cc=a39_0x31aecd;this['updateCurrencyRates']()[_0x4551cc(0x156)](_0xcd42aa=>{const _0xd92e0b=_0x4551cc;console[_0xd92e0b(0x155)](_0xd92e0b(0x12b),_0xcd42aa);}),this[_0x4551cc(0x12d)]=setInterval(async()=>{const _0xfcd2cc=_0x4551cc;try{await this[_0xfcd2cc(0x177)]();}catch(_0x3993ee){console[_0xfcd2cc(0x155)](_0xfcd2cc(0x11b),_0x3993ee);}},0x3c*0x3c*0x3e8),console[_0x4551cc(0x150)](_0x4551cc(0x15e));}['stopPeriodicUpdates'](){const _0x238358=a39_0x31aecd;this[_0x238358(0x12d)]&&(clearInterval(this[_0x238358(0x12d)]),this['updateInterval']=null,console[_0x238358(0x150)](_0x238358(0x119)));}async['updateCurrencyRates'](){const _0x26b675=a39_0x31aecd;try{console[_0x26b675(0x150)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xe35099=this['CURRENCIES'][_0x26b675(0x126)](','),_0x2f9823=this[_0x26b675(0x153)]+_0x26b675(0x154)+_0xe35099,_0x478588=await fetch(_0x2f9823,{'headers':{'Accept':_0x26b675(0x11f),'User-Agent':_0x26b675(0x110)}});if(!_0x478588['ok'])throw new Error(_0x26b675(0x12c)+_0x478588[_0x26b675(0x12f)]+'\x20'+_0x478588[_0x26b675(0x117)]);const _0x2a4012=await _0x478588[_0x26b675(0x14d)]();if(!_0x2a4012[_0x26b675(0x14b)])throw new Error(_0x26b675(0x108));const _0x38ef1a=_0x2a4012['tether'];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x26b675(0x109)](_0x38ef1a)[_0x26b675(0x152)]+_0x26b675(0x14e));const _0x197ef4=Object[_0x26b675(0x12a)](_0x38ef1a)['map'](async([_0x17e61f,_0x4c1050])=>{const _0x4b41b8=_0x26b675;try{await database_1[_0x4b41b8(0x170)]['currencyRate'][_0x4b41b8(0x137)]({'where':{'currency':_0x17e61f[_0x4b41b8(0x13c)]()},'update':{'rate':_0x4c1050},'create':{'currency':_0x17e61f[_0x4b41b8(0x13c)](),'rate':_0x4c1050}});}catch(_0x3cb83a){console[_0x4b41b8(0x155)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x17e61f+':',_0x3cb83a);}});await Promise[_0x26b675(0x13d)](_0x197ef4),console[_0x26b675(0x150)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4164e8){console['error'](_0x26b675(0x116),_0x4164e8);throw _0x4164e8;}}async['getCurrencyRate'](_0x237b22){const _0xbf95f9=a39_0x31aecd,_0x5777ed=_0x237b22[_0xbf95f9(0x13c)]();if(_0x5777ed===_0xbf95f9(0x113))return 0x1;try{const _0x20dd33=await database_1[_0xbf95f9(0x170)][_0xbf95f9(0x16f)][_0xbf95f9(0x151)]({'where':{'currency':_0x5777ed}});if(!_0x20dd33)return console[_0xbf95f9(0x17e)](_0xbf95f9(0x160)+_0x237b22+_0xbf95f9(0x107)),0x1;return _0x20dd33[_0xbf95f9(0x165)];}catch(_0x40ed07){return console[_0xbf95f9(0x155)](_0xbf95f9(0x144)+_0x237b22+':',_0x40ed07),0x1;}}async['convertToUSDT'](_0x2961e3,_0x1012e6){const _0x2165d7=a39_0x31aecd,_0x1bfddf=_0x1012e6[_0x2165d7(0x13c)]();if(_0x1bfddf===_0x2165d7(0x113)){const _0x4e6b9a=_0x2961e3*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x2165d7(0x150)]('💱\x20Applied\x20'+this[_0x2165d7(0x182)]+_0x2165d7(0x16e)+_0x2961e3+_0x2165d7(0x149)+_0x4e6b9a['toFixed'](0x6)+_0x2165d7(0x168)),_0x4e6b9a;}try{const _0x328d24=await this[_0x2165d7(0x13a)](_0x1bfddf),_0x4090fe=_0x2961e3/_0x328d24,_0x454ce2=_0x4090fe*(0x1+this[_0x2165d7(0x182)]/0x64);return console[_0x2165d7(0x150)](_0x2165d7(0x172)+_0x2961e3+'\x20'+_0x1012e6[_0x2165d7(0x114)]()+'\x20to\x20'+_0x4090fe[_0x2165d7(0x174)](0x6)+_0x2165d7(0x10a)+this[_0x2165d7(0x182)]+_0x2165d7(0x176)+_0x454ce2[_0x2165d7(0x174)](0x6)+_0x2165d7(0x135)+_0x328d24+')'),_0x454ce2;}catch(_0x295ff4){console[_0x2165d7(0x155)]('Error\x20converting\x20'+_0x2961e3+'\x20'+_0x1012e6+_0x2165d7(0x127),_0x295ff4);const _0x51c089=_0x2961e3*(0x1+this[_0x2165d7(0x182)]/0x64);return _0x51c089;}}async[a39_0x31aecd(0x10b)](_0x3fb465){let _0x8688b5=0x0;for(const {amount:_0x25567d,currency:_0x2377f0}of _0x3fb465){const _0x47d0ea=await this['convertToUSDT'](_0x25567d,_0x2377f0);_0x8688b5+=_0x47d0ea;}return _0x8688b5;}async['getAllRates'](){const _0x564bca=a39_0x31aecd;try{const _0x20ce79=await database_1[_0x564bca(0x170)][_0x564bca(0x16f)][_0x564bca(0x133)]({'select':{'currency':!![],'rate':!![]}}),_0x5c5e33={'usdt':0x1};return _0x20ce79[_0x564bca(0x180)](_0x45c5a8=>{const _0x4ee493=_0x564bca;_0x5c5e33[_0x45c5a8[_0x4ee493(0x122)]]=_0x45c5a8[_0x4ee493(0x165)];}),_0x5c5e33;}catch(_0x4503c5){return console[_0x564bca(0x155)](_0x564bca(0x162),_0x4503c5),{'usdt':0x1};}}async[a39_0x31aecd(0x178)](){const _0x679a89=a39_0x31aecd;try{const [_0x2960d1,_0x321fd3,_0x463fc4]=await Promise['all']([database_1[_0x679a89(0x170)]['currencyRate'][_0x679a89(0x147)](),database_1[_0x679a89(0x170)][_0x679a89(0x16f)]['findFirst']({'orderBy':{'updatedAt':_0x679a89(0x111)},'select':{'updatedAt':!![]}}),database_1[_0x679a89(0x170)][_0x679a89(0x16f)][_0x679a89(0x125)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2960d1,'lastUpdated':_0x321fd3?.[_0x679a89(0x138)]||null,'oldestRate':_0x463fc4?.[_0x679a89(0x138)]||null,'markupPercentage':this[_0x679a89(0x182)]};}catch(_0x5c9b5a){return console[_0x679a89(0x155)](_0x679a89(0x148),_0x5c9b5a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x679a89(0x182)]};}}[a39_0x31aecd(0x11c)](){const _0x34af18=a39_0x31aecd;return this[_0x34af18(0x182)];}}exports[a39_0x31aecd(0x169)]=CurrencyService,exports['currencyService']=new CurrencyService();