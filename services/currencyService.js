'use strict';function a38_0x1ef3(){const _0x5ef1ca=['link','bch','3624024ZFihHo','log','all','currencyService','bits','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','TesSoft\x20Payment\x20System/1.0','findFirst','__esModule','\x20USDT\x20(rate:\x20','cad','xag','length','uah','keys','btc','twd','2032AvDIuv','eur','getMarkupPercentage','chf','bdt','getRatesStatus','\x20USDT','convertMultipleToUSDT','bhd','%\x20markup\x20to\x20','yfi','gbp','default','usdt','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','mmk','count','✅\x20Currency\x20rates\x20updated\x20successfully','\x20to\x20','rub','ngn','xau','Failed\x20to\x20update\x20rate\x20for\x20','dkk','tether','warn','map','inr','findMany','thb','📊\x20Received\x20rates\x20for\x20','\x20USDT,\x20with\x20','idr','jpy','\x20USDT\x20=\x20','toUpperCase','eth','pln','myr','../config/database','findUnique','getAllRates','MARKUP_PERCENTAGE','2572381KrCICQ','mxn','updateInterval','\x20currencies','%\x20markup\x20=\x20','CurrencyService','nok','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','join','defineProperty','eos','sgd','try','4178245FFdaTD','upsert','currencyRate','lkr','\x20to\x20USDT:','json','convertToUSDT','application/json','krw','updateCurrencyRates','toLowerCase','cny','usd','23114637tzyfFJ','💱\x20Converted\x20','ars','💱\x20Applied\x20','toFixed','status','bnb','xlm','ltc','vef','Initial\x20currency\x20rates\x20update\x20failed:','Error\x20getting\x20all\x20rates:','huf','xdr','1422fhoEdU','czk','Error\x20getting\x20rate\x20for\x20currency\x20','COINGECKO_URL','aed','No\x20rate\x20found\x20for\x20currency:\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','3283216LppRou','zar','forEach','Error\x20getting\x20rates\x20status:','getCurrencyRate','asc','644871iyUsCH','CURRENCIES','sek','❌\x20Failed\x20to\x20update\x20currency\x20rates:','startPeriodicUpdates','error','rate','updatedAt','ils','kwd','24rHmGjV'];a38_0x1ef3=function(){return _0x5ef1ca;};return a38_0x1ef3();}const a38_0x3b0510=a38_0x26b9;(function(_0x1a22be,_0x36dbea){const _0x4ae269=a38_0x26b9,_0x95a473=_0x1a22be();while(!![]){try{const _0x105cf7=-parseInt(_0x4ae269(0xdf))/0x1+parseInt(_0x4ae269(0xfd))/0x2*(-parseInt(_0x4ae269(0xd2))/0x3)+-parseInt(_0x4ae269(0xec))/0x4+-parseInt(_0x4ae269(0x135))/0x5+parseInt(_0x4ae269(0xe9))/0x6*(parseInt(_0x4ae269(0x128))/0x7)+-parseInt(_0x4ae269(0xd9))/0x8+parseInt(_0x4ae269(0xc4))/0x9;if(_0x105cf7===_0x36dbea)break;else _0x95a473['push'](_0x95a473['shift']());}catch(_0x32119d){_0x95a473['push'](_0x95a473['shift']());}}}(a38_0x1ef3,0xb97a1));var __importDefault=this&&this['__importDefault']||function(_0x376142){const _0x49dfd8=a38_0x26b9;return _0x376142&&_0x376142[_0x49dfd8(0xf4)]?_0x376142:{'default':_0x376142};};function a38_0x26b9(_0x16ba74,_0xf6e80){const _0x1ef374=a38_0x1ef3();return a38_0x26b9=function(_0x26b938,_0x3e7df4){_0x26b938=_0x26b938-0xc4;let _0x229840=_0x1ef374[_0x26b938];return _0x229840;},a38_0x26b9(_0x16ba74,_0xf6e80);}Object[a38_0x3b0510(0x131)](exports,a38_0x3b0510(0xf4),{'value':!![]}),exports[a38_0x3b0510(0xef)]=exports[a38_0x3b0510(0x12d)]=void 0x0;const database_1=__importDefault(require(a38_0x3b0510(0x124)));class CurrencyService{constructor(){const _0x35b277=a38_0x3b0510;this[_0x35b277(0xd5)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x35b277(0xfb),_0x35b277(0x121),_0x35b277(0xcc),_0x35b277(0xeb),_0x35b277(0xca),_0x35b277(0x132),'xrp',_0x35b277(0xcb),_0x35b277(0xea),'dot',_0x35b277(0x107),_0x35b277(0x141),_0x35b277(0xd6),_0x35b277(0xc6),'aud',_0x35b277(0x101),_0x35b277(0x105),'bmd','brl',_0x35b277(0xf6),_0x35b277(0x100),'clp',_0x35b277(0x140),_0x35b277(0xd3),_0x35b277(0x114),_0x35b277(0xfe),_0x35b277(0x108),'gel','hkd',_0x35b277(0xd0),_0x35b277(0x11d),_0x35b277(0xe7),_0x35b277(0x118),_0x35b277(0x11e),_0x35b277(0x13d),_0x35b277(0xe8),_0x35b277(0x138),_0x35b277(0x10c),_0x35b277(0x129),_0x35b277(0x123),_0x35b277(0x111),_0x35b277(0x12e),'nzd','php','pkr',_0x35b277(0x122),_0x35b277(0x110),'sar',_0x35b277(0xe1),_0x35b277(0x133),_0x35b277(0x11a),_0x35b277(0x134),_0x35b277(0xfc),_0x35b277(0xf9),_0x35b277(0xcd),'vnd',_0x35b277(0xda),_0x35b277(0xd1),_0x35b277(0xf7),_0x35b277(0x112),_0x35b277(0xf0),'sats'],this[_0x35b277(0x12a)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x35b277(0xe3)]();}['startPeriodicUpdates'](){const _0x117aba=a38_0x3b0510;this[_0x117aba(0x13e)]()['catch'](_0x67f152=>{const _0x5509c0=_0x117aba;console['error'](_0x5509c0(0xce),_0x67f152);}),this[_0x117aba(0x12a)]=setInterval(async()=>{const _0xc9441a=_0x117aba;try{await this['updateCurrencyRates']();}catch(_0x207864){console[_0xc9441a(0xe4)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x207864);}},0x3c*0x3c*0x3e8),console['log'](_0x117aba(0xd8));}['stopPeriodicUpdates'](){const _0x5c151e=a38_0x3b0510;this[_0x5c151e(0x12a)]&&(clearInterval(this['updateInterval']),this[_0x5c151e(0x12a)]=null,console[_0x5c151e(0xed)](_0x5c151e(0xf1)));}async[a38_0x3b0510(0x13e)](){const _0x175cc7=a38_0x3b0510;try{console[_0x175cc7(0xed)](_0x175cc7(0x12f));const _0x435a30=this[_0x175cc7(0xe0)][_0x175cc7(0x130)](','),_0x27ae8e=this[_0x175cc7(0xd5)]+'?ids=tether&vs_currencies='+_0x435a30,_0x66a092=await fetch(_0x27ae8e,{'headers':{'Accept':_0x175cc7(0x13c),'User-Agent':_0x175cc7(0xf2)}});if(!_0x66a092['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x66a092[_0x175cc7(0xc9)]+'\x20'+_0x66a092['statusText']);const _0x2395d0=await _0x66a092[_0x175cc7(0x13a)]();if(!_0x2395d0[_0x175cc7(0x115)])throw new Error(_0x175cc7(0x10b));const _0x2f4561=_0x2395d0[_0x175cc7(0x115)];console['log'](_0x175cc7(0x11b)+Object[_0x175cc7(0xfa)](_0x2f4561)[_0x175cc7(0xf8)]+_0x175cc7(0x12b));const _0x31f6ff=Object['entries'](_0x2f4561)[_0x175cc7(0x117)](async([_0x4483d6,_0x4d7cfa])=>{const _0x28bf88=_0x175cc7;try{await database_1[_0x28bf88(0x109)][_0x28bf88(0x137)][_0x28bf88(0x136)]({'where':{'currency':_0x4483d6[_0x28bf88(0x13f)]()},'update':{'rate':_0x4d7cfa},'create':{'currency':_0x4483d6[_0x28bf88(0x13f)](),'rate':_0x4d7cfa}});}catch(_0x4d83f4){console[_0x28bf88(0xe4)](_0x28bf88(0x113)+_0x4483d6+':',_0x4d83f4);}});await Promise['allSettled'](_0x31f6ff),console[_0x175cc7(0xed)](_0x175cc7(0x10e));}catch(_0x2d3c5d){console[_0x175cc7(0xe4)](_0x175cc7(0xe2),_0x2d3c5d);throw _0x2d3c5d;}}async[a38_0x3b0510(0xdd)](_0x3bfdb1){const _0x4521ec=a38_0x3b0510,_0x56233e=_0x3bfdb1[_0x4521ec(0x13f)]();if(_0x56233e===_0x4521ec(0x10a))return 0x1;try{const _0x3d5323=await database_1['default'][_0x4521ec(0x137)][_0x4521ec(0x125)]({'where':{'currency':_0x56233e}});if(!_0x3d5323)return console[_0x4521ec(0x116)](_0x4521ec(0xd7)+_0x3bfdb1+',\x20using\x201\x20as\x20fallback'),0x1;return _0x3d5323[_0x4521ec(0xe5)];}catch(_0x50d86d){return console[_0x4521ec(0xe4)](_0x4521ec(0xd4)+_0x3bfdb1+':',_0x50d86d),0x1;}}async[a38_0x3b0510(0x13b)](_0x56471f,_0x4caa0b){const _0x4b65ec=a38_0x3b0510,_0x4e2383=_0x4caa0b[_0x4b65ec(0x13f)]();if(_0x4e2383===_0x4b65ec(0x10a)){const _0x4997c8=_0x56471f*(0x1+this[_0x4b65ec(0x127)]/0x64);return console['log'](_0x4b65ec(0xc7)+this[_0x4b65ec(0x127)]+_0x4b65ec(0x106)+_0x56471f+_0x4b65ec(0x11f)+_0x4997c8[_0x4b65ec(0xc8)](0x6)+_0x4b65ec(0x103)),_0x4997c8;}try{const _0xa72d8d=await this[_0x4b65ec(0xdd)](_0x4e2383),_0x579e5e=_0x56471f/_0xa72d8d,_0x592ae6=_0x579e5e*(0x1+this[_0x4b65ec(0x127)]/0x64);return console[_0x4b65ec(0xed)](_0x4b65ec(0xc5)+_0x56471f+'\x20'+_0x4caa0b[_0x4b65ec(0x120)]()+_0x4b65ec(0x10f)+_0x579e5e[_0x4b65ec(0xc8)](0x6)+_0x4b65ec(0x11c)+this[_0x4b65ec(0x127)]+_0x4b65ec(0x12c)+_0x592ae6['toFixed'](0x6)+_0x4b65ec(0xf5)+_0xa72d8d+')'),_0x592ae6;}catch(_0x9bf004){console[_0x4b65ec(0xe4)]('Error\x20converting\x20'+_0x56471f+'\x20'+_0x4caa0b+_0x4b65ec(0x139),_0x9bf004);const _0x39c1ed=_0x56471f*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x39c1ed;}}async[a38_0x3b0510(0x104)](_0x1099f9){const _0x73e2a8=a38_0x3b0510;let _0x3361b9=0x0;for(const {amount:_0x45eb90,currency:_0x313fdf}of _0x1099f9){const _0x4c0ddd=await this[_0x73e2a8(0x13b)](_0x45eb90,_0x313fdf);_0x3361b9+=_0x4c0ddd;}return _0x3361b9;}async[a38_0x3b0510(0x126)](){const _0x17d2d1=a38_0x3b0510;try{const _0xdeca5d=await database_1['default'][_0x17d2d1(0x137)][_0x17d2d1(0x119)]({'select':{'currency':!![],'rate':!![]}}),_0x2308ba={'usdt':0x1};return _0xdeca5d[_0x17d2d1(0xdb)](_0x3a0453=>{const _0x50bf48=_0x17d2d1;_0x2308ba[_0x3a0453['currency']]=_0x3a0453[_0x50bf48(0xe5)];}),_0x2308ba;}catch(_0x1c5360){return console[_0x17d2d1(0xe4)](_0x17d2d1(0xcf),_0x1c5360),{'usdt':0x1};}}async[a38_0x3b0510(0x102)](){const _0x15facc=a38_0x3b0510;try{const [_0xcd1350,_0x4f5a21,_0x5118b4]=await Promise[_0x15facc(0xee)]([database_1[_0x15facc(0x109)][_0x15facc(0x137)][_0x15facc(0x10d)](),database_1[_0x15facc(0x109)][_0x15facc(0x137)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x15facc(0x137)][_0x15facc(0xf3)]({'orderBy':{'updatedAt':_0x15facc(0xde)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xcd1350,'lastUpdated':_0x4f5a21?.[_0x15facc(0xe6)]||null,'oldestRate':_0x5118b4?.[_0x15facc(0xe6)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x47ca81){return console[_0x15facc(0xe4)](_0x15facc(0xdc),_0x47ca81),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x15facc(0x127)]};}}[a38_0x3b0510(0xff)](){const _0x5a9d36=a38_0x3b0510;return this[_0x5a9d36(0x127)];}}exports[a38_0x3b0510(0x12d)]=CurrencyService,exports['currencyService']=new CurrencyService();