'use strict';function a49_0x5242(){const _0x305cba=['usd','allSettled','catch','\x20USDT,\x20with\x20','toFixed','warn','336386YQboGN','CURRENCIES','gel','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','MARKUP_PERCENTAGE','updatedAt','40dkDRxQ','asc','getRatesStatus','eur','findFirst','71635CiAVse','rate','pkr','log','\x20USDT\x20(rate:\x20','243080PCOhGa','Failed\x20to\x20update\x20rate\x20for\x20','xrp','link','updateCurrencyRates','%\x20markup\x20to\x20','updateInterval','findUnique','status','findMany','keys','myr','rub','twd','\x20to\x20USDT:','Error\x20converting\x20','btc','cny','getMarkupPercentage','cad','error','join','bmd','bits','startPeriodicUpdates','desc','Periodic\x20currency\x20rates\x20update\x20failed:','usdt','ðŸ’±\x20Converted\x20','\x20to\x20','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','pln','2ykzRpt','81ZjkWjK','getCurrencyRate','?ids=tether&vs_currencies=','brl','getAllRates','tether','sats','1129386ihzVqr','ðŸ“Š\x20Received\x20rates\x20for\x20','kwd','COINGECKO_URL','vef','3829469zeejGd','sek','xdr','eos','No\x20rate\x20found\x20for\x20currency:\x20','application/json','ils','idr','733352GdJKjY','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','sar','uah','hkd','default','toLowerCase','dkk','all','thb','length','stopPeriodicUpdates','upsert','gbp','CoinGecko\x20API\x20error:\x20','currencyRate','convertToUSDT','1116048cNIQWK','__esModule','Error\x20getting\x20rates\x20status:','currencyService','../config/database','ars','dot','https://api.coingecko.com/api/v3/simple/price','Payment\x20System/1.0','defineProperty','nok','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','âœ…\x20Currency\x20rates\x20updated\x20successfully','\x20USDT\x20=\x20','inr','chf','CurrencyService','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','ngn','bdt','php','nzd','count','\x20currencies','__importDefault','toUpperCase'];a49_0x5242=function(){return _0x305cba;};return a49_0x5242();}const a49_0x50f999=a49_0x437d;function a49_0x437d(_0x42ddf6,_0x737548){_0x42ddf6=_0x42ddf6-0x173;const _0x524222=a49_0x5242();let _0x437de2=_0x524222[_0x42ddf6];return _0x437de2;}(function(_0x313729,_0x3c83b9){const _0x1fefbf=a49_0x437d,_0x372155=_0x313729();while(!![]){try{const _0x3c6c21=parseInt(_0x1fefbf(0x19c))/0x1*(parseInt(_0x1fefbf(0x1e2))/0x2)+parseInt(_0x1fefbf(0x1c2))/0x3+-parseInt(_0x1fefbf(0x1e8))/0x4*(parseInt(_0x1fefbf(0x177))/0x5)+parseInt(_0x1fefbf(0x1a4))/0x6+-parseInt(_0x1fefbf(0x1a9))/0x7+-parseInt(_0x1fefbf(0x1b1))/0x8+parseInt(_0x1fefbf(0x19d))/0x9*(parseInt(_0x1fefbf(0x17c))/0xa);if(_0x3c6c21===_0x3c83b9)break;else _0x372155['push'](_0x372155['shift']());}catch(_0x57af09){_0x372155['push'](_0x372155['shift']());}}}(a49_0x5242,0x51657));var __importDefault=this&&this[a49_0x50f999(0x1da)]||function(_0x287a7d){return _0x287a7d&&_0x287a7d['__esModule']?_0x287a7d:{'default':_0x287a7d};};Object[a49_0x50f999(0x1cb)](exports,a49_0x50f999(0x1c3),{'value':!![]}),exports[a49_0x50f999(0x1c5)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a49_0x50f999(0x1c6)));class CurrencyService{constructor(){const _0x52f267=a49_0x50f999;this[_0x52f267(0x1a7)]=_0x52f267(0x1c9),this['CURRENCIES']=[_0x52f267(0x18c),'eth','ltc','bch','bnb',_0x52f267(0x1ac),_0x52f267(0x17e),'xlm',_0x52f267(0x17f),_0x52f267(0x1c8),'yfi',_0x52f267(0x1dc),'aed',_0x52f267(0x1c7),'aud',_0x52f267(0x1d5),'bhd',_0x52f267(0x192),_0x52f267(0x1a0),_0x52f267(0x18f),_0x52f267(0x1d1),'clp',_0x52f267(0x18d),'czk',_0x52f267(0x1b8),_0x52f267(0x175),_0x52f267(0x1be),_0x52f267(0x1e4),_0x52f267(0x1b5),'huf',_0x52f267(0x1b0),_0x52f267(0x1af),_0x52f267(0x1d0),'jpy','krw',_0x52f267(0x1a6),'lkr','mmk','mxn',_0x52f267(0x187),_0x52f267(0x1d4),_0x52f267(0x1cc),_0x52f267(0x1d7),_0x52f267(0x1d6),_0x52f267(0x179),_0x52f267(0x19b),_0x52f267(0x188),_0x52f267(0x1b3),_0x52f267(0x1aa),'sgd',_0x52f267(0x1ba),'try',_0x52f267(0x189),_0x52f267(0x1b4),_0x52f267(0x1a8),'vnd','zar',_0x52f267(0x1ab),'xag','xau',_0x52f267(0x193),_0x52f267(0x1a3)],this['updateInterval']=null,this[_0x52f267(0x1e6)]=-0x3,this[_0x52f267(0x194)]();}[a49_0x50f999(0x194)](){const _0x3f4938=a49_0x50f999;this[_0x3f4938(0x180)]()[_0x3f4938(0x1de)](_0x152858=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x152858);}),this[_0x3f4938(0x182)]=setInterval(async()=>{const _0x2b775e=_0x3f4938;try{await this[_0x2b775e(0x180)]();}catch(_0x48a741){console[_0x2b775e(0x190)](_0x2b775e(0x196),_0x48a741);}},0x3c*0x3c*0x3e8),console[_0x3f4938(0x17a)](_0x3f4938(0x1e5));}[a49_0x50f999(0x1bc)](){const _0xa7bd0f=a49_0x50f999;this[_0xa7bd0f(0x182)]&&(clearInterval(this['updateInterval']),this[_0xa7bd0f(0x182)]=null,console['log'](_0xa7bd0f(0x1b2)));}async[a49_0x50f999(0x180)](){const _0x55fcc4=a49_0x50f999;try{console['log'](_0x55fcc4(0x19a));const _0x48263d=this[_0x55fcc4(0x1e3)][_0x55fcc4(0x191)](','),_0x1eb7ce=this['COINGECKO_URL']+_0x55fcc4(0x19f)+_0x48263d,_0x5d9a17=await fetch(_0x1eb7ce,{'headers':{'Accept':_0x55fcc4(0x1ae),'User-Agent':_0x55fcc4(0x1ca)}});if(!_0x5d9a17['ok'])throw new Error(_0x55fcc4(0x1bf)+_0x5d9a17[_0x55fcc4(0x184)]+'\x20'+_0x5d9a17['statusText']);const _0x253e32=await _0x5d9a17['json']();if(!_0x253e32['tether'])throw new Error(_0x55fcc4(0x1cd));const _0xf1f816=_0x253e32[_0x55fcc4(0x1a2)];console[_0x55fcc4(0x17a)](_0x55fcc4(0x1a5)+Object[_0x55fcc4(0x186)](_0xf1f816)[_0x55fcc4(0x1bb)]+_0x55fcc4(0x1d9));const _0x32da0d=Object['entries'](_0xf1f816)['map'](async([_0x29a331,_0x355697])=>{const _0x4e7c44=_0x55fcc4;try{await database_1[_0x4e7c44(0x1b6)][_0x4e7c44(0x1c0)][_0x4e7c44(0x1bd)]({'where':{'currency':_0x29a331['toLowerCase']()},'update':{'rate':_0x355697},'create':{'currency':_0x29a331[_0x4e7c44(0x1b7)](),'rate':_0x355697}});}catch(_0x45551c){console[_0x4e7c44(0x190)](_0x4e7c44(0x17d)+_0x29a331+':',_0x45551c);}});await Promise[_0x55fcc4(0x1dd)](_0x32da0d),console['log'](_0x55fcc4(0x1ce));}catch(_0x30bada){console[_0x55fcc4(0x190)](_0x55fcc4(0x1d3),_0x30bada);throw _0x30bada;}}async[a49_0x50f999(0x19e)](_0x4e25ef){const _0x7f78a5=a49_0x50f999,_0x55d8c6=_0x4e25ef[_0x7f78a5(0x1b7)]();if(_0x55d8c6===_0x7f78a5(0x197))return 0x1;try{const _0x4a1050=await database_1['default'][_0x7f78a5(0x1c0)][_0x7f78a5(0x183)]({'where':{'currency':_0x55d8c6}});if(!_0x4a1050)return console[_0x7f78a5(0x1e1)](_0x7f78a5(0x1ad)+_0x4e25ef+',\x20using\x201\x20as\x20fallback'),0x1;return _0x4a1050[_0x7f78a5(0x178)];}catch(_0x3abc2b){return console[_0x7f78a5(0x190)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x4e25ef+':',_0x3abc2b),0x1;}}async['convertToUSDT'](_0x1582ac,_0x153340){const _0x109a2c=a49_0x50f999,_0x35a3e4=_0x153340[_0x109a2c(0x1b7)]();if(_0x35a3e4===_0x109a2c(0x197)){const _0x4ee518=_0x1582ac*(0x1+this[_0x109a2c(0x1e6)]/0x64);return console[_0x109a2c(0x17a)]('ðŸ’±\x20Applied\x20'+this[_0x109a2c(0x1e6)]+_0x109a2c(0x181)+_0x1582ac+_0x109a2c(0x1cf)+_0x4ee518['toFixed'](0x6)+'\x20USDT'),_0x4ee518;}try{const _0x36c92b=await this['getCurrencyRate'](_0x35a3e4),_0x31ab2f=_0x1582ac/_0x36c92b,_0x274ad6=_0x31ab2f*(0x1+this[_0x109a2c(0x1e6)]/0x64);return console['log'](_0x109a2c(0x198)+_0x1582ac+'\x20'+_0x153340[_0x109a2c(0x1db)]()+_0x109a2c(0x199)+_0x31ab2f[_0x109a2c(0x1e0)](0x6)+_0x109a2c(0x1df)+this[_0x109a2c(0x1e6)]+'%\x20markup\x20=\x20'+_0x274ad6['toFixed'](0x6)+_0x109a2c(0x17b)+_0x36c92b+')'),_0x274ad6;}catch(_0x137b7a){console[_0x109a2c(0x190)](_0x109a2c(0x18b)+_0x1582ac+'\x20'+_0x153340+_0x109a2c(0x18a),_0x137b7a);const _0x1dc01b=_0x1582ac*(0x1+this[_0x109a2c(0x1e6)]/0x64);return _0x1dc01b;}}async['convertMultipleToUSDT'](_0x1b3ee4){const _0x22fc2b=a49_0x50f999;let _0x20d67a=0x0;for(const {amount:_0x2d8eb0,currency:_0x1f2ea9}of _0x1b3ee4){const _0x599ada=await this[_0x22fc2b(0x1c1)](_0x2d8eb0,_0x1f2ea9);_0x20d67a+=_0x599ada;}return _0x20d67a;}async[a49_0x50f999(0x1a1)](){const _0x1d75fa=a49_0x50f999;try{const _0x4b2242=await database_1['default'][_0x1d75fa(0x1c0)][_0x1d75fa(0x185)]({'select':{'currency':!![],'rate':!![]}}),_0x2ca567={'usdt':0x1};return _0x4b2242['forEach'](_0x31bae6=>{const _0x447f5c=_0x1d75fa;_0x2ca567[_0x31bae6['currency']]=_0x31bae6[_0x447f5c(0x178)];}),_0x2ca567;}catch(_0x3d2855){return console[_0x1d75fa(0x190)]('Error\x20getting\x20all\x20rates:',_0x3d2855),{'usdt':0x1};}}async[a49_0x50f999(0x174)](){const _0x431ac5=a49_0x50f999;try{const [_0x33eb07,_0x3dad92,_0x384ca4]=await Promise[_0x431ac5(0x1b9)]([database_1[_0x431ac5(0x1b6)]['currencyRate'][_0x431ac5(0x1d8)](),database_1['default']['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x431ac5(0x195)},'select':{'updatedAt':!![]}}),database_1[_0x431ac5(0x1b6)][_0x431ac5(0x1c0)][_0x431ac5(0x176)]({'orderBy':{'updatedAt':_0x431ac5(0x173)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x33eb07,'lastUpdated':_0x3dad92?.['updatedAt']||null,'oldestRate':_0x384ca4?.[_0x431ac5(0x1e7)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x509f66){return console['error'](_0x431ac5(0x1c4),_0x509f66),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x431ac5(0x1e6)]};}}[a49_0x50f999(0x18e)](){return this['MARKUP_PERCENTAGE'];}}exports[a49_0x50f999(0x1d2)]=CurrencyService,exports[a49_0x50f999(0x1c5)]=new CurrencyService();