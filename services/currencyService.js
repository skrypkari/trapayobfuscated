'use strict';const a39_0x4a9175=a39_0x2bb3;(function(_0x228f59,_0x5e92d8){const _0x599acf=a39_0x2bb3,_0x5623ff=_0x228f59();while(!![]){try{const _0x8604a0=parseInt(_0x599acf(0x14f))/0x1+-parseInt(_0x599acf(0x12b))/0x2+-parseInt(_0x599acf(0x121))/0x3+-parseInt(_0x599acf(0x103))/0x4+parseInt(_0x599acf(0x168))/0x5+-parseInt(_0x599acf(0x14a))/0x6*(-parseInt(_0x599acf(0x16b))/0x7)+-parseInt(_0x599acf(0x123))/0x8*(-parseInt(_0x599acf(0x122))/0x9);if(_0x8604a0===_0x5e92d8)break;else _0x5623ff['push'](_0x5623ff['shift']());}catch(_0x4de2af){_0x5623ff['push'](_0x5623ff['shift']());}}}(a39_0x1892,0xe7e87));function a39_0x2bb3(_0x3a5261,_0xb91416){const _0x18927a=a39_0x1892();return a39_0x2bb3=function(_0x2bb350,_0x3e31aa){_0x2bb350=_0x2bb350-0xff;let _0x3e10b6=_0x18927a[_0x2bb350];return _0x3e10b6;},a39_0x2bb3(_0x3a5261,_0xb91416);}function a39_0x1892(){const _0x1f5443=['lkr','join','MARKUP_PERCENTAGE','php','uah','No\x20rate\x20found\x20for\x20currency:\x20','📊\x20Received\x20rates\x20for\x20','getAllRates','\x20to\x20',',\x20using\x201\x20as\x20fallback','log','\x20USDT\x20=\x20','toUpperCase','brl','1812UpQEty','findUnique','mmk','clp','ltc','180653bfbuMm','rub','default','xag','count','updateInterval','mxn','application/json','json','\x20USDT','getCurrencyRate','krw','__importDefault','zar','convertToUSDT','../config/database','rate','warn','%\x20markup\x20=\x20','myr','sgd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','cny','tether','thb','7203525LCfpCq','bdt','keys','30849AFlqsQ','allSettled','startPeriodicUpdates','dkk','findFirst','findMany','COINGECKO_URL','updateCurrencyRates','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','chf','forEach','getRatesStatus','ils','gbp','3894348YOzmzB','toLowerCase','xlm','✅\x20Currency\x20rates\x20updated\x20successfully','error','ngn','currencyRate','Initial\x20currency\x20rates\x20update\x20failed:','pln','btc','__esModule','💱\x20Applied\x20','bch','currency','bhd','entries','toFixed','statusText','xdr','pkr','getMarkupPercentage','cad','catch','huf','%\x20markup\x20to\x20','usdt','Failed\x20to\x20update\x20rate\x20for\x20','asc','Periodic\x20currency\x20rates\x20update\x20failed:','vef','2923641AMPGwy','9CtYSAE','7328488pUnfYG','idr','💱\x20Converted\x20','\x20currencies','updatedAt','xrp','inr','sar','1940608mUKNDy','usd','Error\x20converting\x20','aud','currencyService','status','gel','all','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','stopPeriodicUpdates','CURRENCIES','Error\x20getting\x20rates\x20status:','dot','ars','Error\x20getting\x20all\x20rates:','convertMultipleToUSDT','xau'];a39_0x1892=function(){return _0x1f5443;};return a39_0x1892();}var __importDefault=this&&this[a39_0x4a9175(0x15b)]||function(_0x6a8f5a){const _0x39273f=a39_0x4a9175;return _0x6a8f5a&&_0x6a8f5a[_0x39273f(0x10d)]?_0x6a8f5a:{'default':_0x6a8f5a};};Object['defineProperty'](exports,a39_0x4a9175(0x10d),{'value':!![]}),exports[a39_0x4a9175(0x12f)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x4a9175(0x15e)));class CurrencyService{constructor(){const _0x2bf86b=a39_0x4a9175;this[_0x2bf86b(0x171)]='https://api.coingecko.com/api/v3/simple/price',this[_0x2bf86b(0x135)]=[_0x2bf86b(0x10c),'eth',_0x2bf86b(0x14e),_0x2bf86b(0x10f),'bnb','eos',_0x2bf86b(0x128),_0x2bf86b(0x105),'link',_0x2bf86b(0x137),'yfi',_0x2bf86b(0x12c),'aed',_0x2bf86b(0x138),_0x2bf86b(0x12e),_0x2bf86b(0x169),_0x2bf86b(0x111),'bmd',_0x2bf86b(0x149),_0x2bf86b(0x118),_0x2bf86b(0x174),_0x2bf86b(0x14d),_0x2bf86b(0x165),'czk',_0x2bf86b(0x16e),'eur',_0x2bf86b(0x102),_0x2bf86b(0x131),'hkd',_0x2bf86b(0x11a),_0x2bf86b(0x124),_0x2bf86b(0x101),_0x2bf86b(0x129),'jpy',_0x2bf86b(0x15a),'kwd',_0x2bf86b(0x13c),_0x2bf86b(0x14c),_0x2bf86b(0x155),_0x2bf86b(0x162),_0x2bf86b(0x108),'nok','nzd',_0x2bf86b(0x13f),_0x2bf86b(0x116),_0x2bf86b(0x10b),_0x2bf86b(0x150),_0x2bf86b(0x12a),'sek',_0x2bf86b(0x163),_0x2bf86b(0x167),'try','twd',_0x2bf86b(0x140),_0x2bf86b(0x120),'vnd',_0x2bf86b(0x15c),_0x2bf86b(0x115),_0x2bf86b(0x152),_0x2bf86b(0x13b),'bits','sats'],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x2bf86b(0x16d)]();}[a39_0x4a9175(0x16d)](){const _0x59632c=a39_0x4a9175;this['updateCurrencyRates']()[_0x59632c(0x119)](_0x190d1d=>{const _0x323cec=_0x59632c;console[_0x323cec(0x107)](_0x323cec(0x10a),_0x190d1d);}),this[_0x59632c(0x154)]=setInterval(async()=>{const _0x57e9dd=_0x59632c;try{await this['updateCurrencyRates']();}catch(_0x473fd8){console[_0x57e9dd(0x107)](_0x57e9dd(0x11f),_0x473fd8);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x4a9175(0x134)](){const _0x4d2a12=a39_0x4a9175;this[_0x4d2a12(0x154)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console['log'](_0x4d2a12(0x173)));}async[a39_0x4a9175(0x172)](){const _0x5bd4b4=a39_0x4a9175;try{console[_0x5bd4b4(0x146)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x5a3616=this[_0x5bd4b4(0x135)][_0x5bd4b4(0x13d)](','),_0x4cd6bf=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x5a3616,_0x37875a=await fetch(_0x4cd6bf,{'headers':{'Accept':_0x5bd4b4(0x156),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x37875a['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x37875a[_0x5bd4b4(0x130)]+'\x20'+_0x37875a[_0x5bd4b4(0x114)]);const _0x3d7190=await _0x37875a[_0x5bd4b4(0x157)]();if(!_0x3d7190[_0x5bd4b4(0x166)])throw new Error(_0x5bd4b4(0x133));const _0x19c69e=_0x3d7190[_0x5bd4b4(0x166)];console['log'](_0x5bd4b4(0x142)+Object[_0x5bd4b4(0x16a)](_0x19c69e)['length']+_0x5bd4b4(0x126));const _0x50f04b=Object[_0x5bd4b4(0x112)](_0x19c69e)['map'](async([_0x5f1610,_0x12f293])=>{const _0x234b86=_0x5bd4b4;try{await database_1['default'][_0x234b86(0x109)]['upsert']({'where':{'currency':_0x5f1610['toLowerCase']()},'update':{'rate':_0x12f293},'create':{'currency':_0x5f1610[_0x234b86(0x104)](),'rate':_0x12f293}});}catch(_0x2630b9){console[_0x234b86(0x107)](_0x234b86(0x11d)+_0x5f1610+':',_0x2630b9);}});await Promise[_0x5bd4b4(0x16c)](_0x50f04b),console[_0x5bd4b4(0x146)](_0x5bd4b4(0x106));}catch(_0x8f89bc){console[_0x5bd4b4(0x107)](_0x5bd4b4(0x164),_0x8f89bc);throw _0x8f89bc;}}async[a39_0x4a9175(0x159)](_0x1b8e7a){const _0x21abb6=a39_0x4a9175,_0x551252=_0x1b8e7a['toLowerCase']();if(_0x551252===_0x21abb6(0x11c))return 0x1;try{const _0xc6a555=await database_1[_0x21abb6(0x151)][_0x21abb6(0x109)][_0x21abb6(0x14b)]({'where':{'currency':_0x551252}});if(!_0xc6a555)return console[_0x21abb6(0x160)](_0x21abb6(0x141)+_0x1b8e7a+_0x21abb6(0x145)),0x1;return _0xc6a555[_0x21abb6(0x15f)];}catch(_0x14dfbb){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1b8e7a+':',_0x14dfbb),0x1;}}async[a39_0x4a9175(0x15d)](_0x132605,_0x1b2f8d){const _0x5ac834=a39_0x4a9175,_0x3ddcc9=_0x1b2f8d['toLowerCase']();if(_0x3ddcc9===_0x5ac834(0x11c)){const _0x3b7d9a=_0x132605*(0x1+this[_0x5ac834(0x13e)]/0x64);return console[_0x5ac834(0x146)](_0x5ac834(0x10e)+this[_0x5ac834(0x13e)]+_0x5ac834(0x11b)+_0x132605+_0x5ac834(0x147)+_0x3b7d9a[_0x5ac834(0x113)](0x6)+_0x5ac834(0x158)),_0x3b7d9a;}try{const _0x89f86d=await this[_0x5ac834(0x159)](_0x3ddcc9),_0x155b98=_0x132605/_0x89f86d,_0x175f2a=_0x155b98*(0x1+this[_0x5ac834(0x13e)]/0x64);return console['log'](_0x5ac834(0x125)+_0x132605+'\x20'+_0x1b2f8d[_0x5ac834(0x148)]()+_0x5ac834(0x144)+_0x155b98[_0x5ac834(0x113)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0x5ac834(0x161)+_0x175f2a[_0x5ac834(0x113)](0x6)+'\x20USDT\x20(rate:\x20'+_0x89f86d+')'),_0x175f2a;}catch(_0x3ea9e0){console['error'](_0x5ac834(0x12d)+_0x132605+'\x20'+_0x1b2f8d+'\x20to\x20USDT:',_0x3ea9e0);const _0x25652a=_0x132605*(0x1+this[_0x5ac834(0x13e)]/0x64);return _0x25652a;}}async[a39_0x4a9175(0x13a)](_0x398e9e){const _0x17bcaa=a39_0x4a9175;let _0x122e15=0x0;for(const {amount:_0x189029,currency:_0x406392}of _0x398e9e){const _0x39a4da=await this[_0x17bcaa(0x15d)](_0x189029,_0x406392);_0x122e15+=_0x39a4da;}return _0x122e15;}async[a39_0x4a9175(0x143)](){const _0x22b89c=a39_0x4a9175;try{const _0x137baa=await database_1[_0x22b89c(0x151)]['currencyRate'][_0x22b89c(0x170)]({'select':{'currency':!![],'rate':!![]}}),_0x1ddcee={'usdt':0x1};return _0x137baa[_0x22b89c(0xff)](_0x899dc9=>{const _0x1b5b6c=_0x22b89c;_0x1ddcee[_0x899dc9[_0x1b5b6c(0x110)]]=_0x899dc9[_0x1b5b6c(0x15f)];}),_0x1ddcee;}catch(_0x2c64b6){return console[_0x22b89c(0x107)](_0x22b89c(0x139),_0x2c64b6),{'usdt':0x1};}}async[a39_0x4a9175(0x100)](){const _0x467af2=a39_0x4a9175;try{const [_0xd31681,_0x3cff51,_0x49fa41]=await Promise[_0x467af2(0x132)]([database_1['default'][_0x467af2(0x109)][_0x467af2(0x153)](),database_1[_0x467af2(0x151)][_0x467af2(0x109)][_0x467af2(0x16f)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x467af2(0x151)][_0x467af2(0x109)][_0x467af2(0x16f)]({'orderBy':{'updatedAt':_0x467af2(0x11e)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xd31681,'lastUpdated':_0x3cff51?.[_0x467af2(0x127)]||null,'oldestRate':_0x49fa41?.[_0x467af2(0x127)]||null,'markupPercentage':this[_0x467af2(0x13e)]};}catch(_0x29720b){return console['error'](_0x467af2(0x136),_0x29720b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x467af2(0x13e)]};}}[a39_0x4a9175(0x117)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a39_0x4a9175(0x12f)]=new CurrencyService();