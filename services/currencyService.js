'use strict';const a38_0x9ff95c=a38_0x25d2;(function(_0x28e3b3,_0x81c510){const _0x26923c=a38_0x25d2,_0x395d2b=_0x28e3b3();while(!![]){try{const _0x2890cf=parseInt(_0x26923c(0x19c))/0x1+parseInt(_0x26923c(0x185))/0x2+-parseInt(_0x26923c(0x165))/0x3*(-parseInt(_0x26923c(0x176))/0x4)+parseInt(_0x26923c(0x180))/0x5*(-parseInt(_0x26923c(0x1bf))/0x6)+-parseInt(_0x26923c(0x1bb))/0x7*(parseInt(_0x26923c(0x19e))/0x8)+-parseInt(_0x26923c(0x190))/0x9+parseInt(_0x26923c(0x196))/0xa;if(_0x2890cf===_0x81c510)break;else _0x395d2b['push'](_0x395d2b['shift']());}catch(_0x53b81a){_0x395d2b['push'](_0x395d2b['shift']());}}}(a38_0x5e1b,0xad721));var __importDefault=this&&this[a38_0x9ff95c(0x15a)]||function(_0x24e40d){const _0x23ddfd=a38_0x9ff95c;return _0x24e40d&&_0x24e40d[_0x23ddfd(0x15d)]?_0x24e40d:{'default':_0x24e40d};};Object[a38_0x9ff95c(0x19d)](exports,a38_0x9ff95c(0x15d),{'value':!![]}),exports[a38_0x9ff95c(0x1b6)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));function a38_0x5e1b(){const _0x3940cc=['__importDefault','toLowerCase','upsert','__esModule','sek','Failed\x20to\x20update\x20rate\x20for\x20','Periodic\x20currency\x20rates\x20update\x20failed:','gel','hkd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','convertMultipleToUSDT','13197qxPqCF','rate','vef','No\x20rate\x20found\x20for\x20currency:\x20','php','xau','usdt','Error\x20getting\x20rate\x20for\x20currency\x20','count','zar','stopPeriodicUpdates','getCurrencyRate','\x20USDT\x20=\x20','length','chf','myr','map','1156eUswDB','\x20to\x20USDT:','\x20currencies','📊\x20Received\x20rates\x20for\x20','log','btc','bhd','forEach','aed','?ids=tether&vs_currencies=','75ULPcNW','cny','findFirst','bch','Error\x20getting\x20rates\x20status:','426188xkeXGN','error','sgd','mmk','entries','startPeriodicUpdates','findUnique','join','warn','MARKUP_PERCENTAGE','ngn','726840cUJgvR','idr','tether','yfi','Initial\x20currency\x20rates\x20update\x20failed:','findMany','4958370zrboWG','\x20USDT\x20(rate:\x20','all','Error\x20getting\x20all\x20rates:','usd','keys','599307SFmIYG','defineProperty','19816dJYntH','cad','status','CURRENCIES','Error\x20converting\x20','convertToUSDT','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','uah','toFixed','eur','💱\x20Applied\x20','jpy','sats','currency','desc','mxn','allSettled','brl','statusText','vnd','https://api.coingecko.com/api/v3/simple/price','updateCurrencyRates','❌\x20Failed\x20to\x20update\x20currency\x20rates:','\x20to\x20','currencyService','asc','xlm','getMarkupPercentage','updatedAt','2611ecVQOG','bdt','twd','eth','345774ongUkO','getAllRates','COINGECKO_URL','CoinGecko\x20API\x20error:\x20','\x20USDT,\x20with\x20','dkk','eos','application/json','link','kwd','inr','currencyRate','xdr','nok','bits','updateInterval','dot','clp','getRatesStatus','default','ars'];a38_0x5e1b=function(){return _0x3940cc;};return a38_0x5e1b();}function a38_0x25d2(_0x139a2e,_0x17984){const _0x5e1ba6=a38_0x5e1b();return a38_0x25d2=function(_0x25d221,_0xffebed){_0x25d221=_0x25d221-0x158;let _0x5cdad0=_0x5e1ba6[_0x25d221];return _0x5cdad0;},a38_0x25d2(_0x139a2e,_0x17984);}class CurrencyService{constructor(){const _0x4324ec=a38_0x9ff95c;this[_0x4324ec(0x1c1)]=_0x4324ec(0x1b2),this[_0x4324ec(0x1a1)]=[_0x4324ec(0x17b),_0x4324ec(0x1be),'ltc',_0x4324ec(0x183),'bnb',_0x4324ec(0x1c5),'xrp',_0x4324ec(0x1b8),_0x4324ec(0x1c7),_0x4324ec(0x1cf),_0x4324ec(0x193),_0x4324ec(0x19a),_0x4324ec(0x17e),_0x4324ec(0x159),'aud',_0x4324ec(0x1bc),_0x4324ec(0x17c),'bmd',_0x4324ec(0x1af),_0x4324ec(0x19f),_0x4324ec(0x173),_0x4324ec(0x1d0),_0x4324ec(0x181),'czk',_0x4324ec(0x1c4),_0x4324ec(0x1a7),'gbp',_0x4324ec(0x161),_0x4324ec(0x162),'huf',_0x4324ec(0x191),'ils',_0x4324ec(0x1c9),_0x4324ec(0x1a9),'krw',_0x4324ec(0x1c8),'lkr',_0x4324ec(0x188),_0x4324ec(0x1ad),_0x4324ec(0x174),_0x4324ec(0x18f),_0x4324ec(0x1cc),'nzd',_0x4324ec(0x169),'pkr','pln','rub','sar',_0x4324ec(0x15e),_0x4324ec(0x187),'thb','try',_0x4324ec(0x1bd),_0x4324ec(0x1a5),_0x4324ec(0x167),_0x4324ec(0x1b1),_0x4324ec(0x16e),_0x4324ec(0x1cb),'xag',_0x4324ec(0x16a),_0x4324ec(0x1cd),_0x4324ec(0x1aa)],this[_0x4324ec(0x1ce)]=null,this[_0x4324ec(0x18e)]=0x3,this[_0x4324ec(0x18a)]();}['startPeriodicUpdates'](){const _0x4d4703=a38_0x9ff95c;this[_0x4d4703(0x1b3)]()['catch'](_0x219479=>{const _0x343a84=_0x4d4703;console[_0x343a84(0x186)](_0x343a84(0x194),_0x219479);}),this[_0x4d4703(0x1ce)]=setInterval(async()=>{const _0x10f913=_0x4d4703;try{await this[_0x10f913(0x1b3)]();}catch(_0x11bfaf){console[_0x10f913(0x186)](_0x10f913(0x160),_0x11bfaf);}},0x3c*0x3c*0x3e8),console['log'](_0x4d4703(0x163));}[a38_0x9ff95c(0x16f)](){const _0x4f914c=a38_0x9ff95c;this[_0x4f914c(0x1ce)]&&(clearInterval(this[_0x4f914c(0x1ce)]),this[_0x4f914c(0x1ce)]=null,console[_0x4f914c(0x17a)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x2b6de7=a38_0x9ff95c;try{console[_0x2b6de7(0x17a)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x1f0a32=this[_0x2b6de7(0x1a1)][_0x2b6de7(0x18c)](','),_0x22fad4=this[_0x2b6de7(0x1c1)]+_0x2b6de7(0x17f)+_0x1f0a32,_0x29702e=await fetch(_0x22fad4,{'headers':{'Accept':_0x2b6de7(0x1c6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x29702e['ok'])throw new Error(_0x2b6de7(0x1c2)+_0x29702e[_0x2b6de7(0x1a0)]+'\x20'+_0x29702e[_0x2b6de7(0x1b0)]);const _0x5348d2=await _0x29702e['json']();if(!_0x5348d2[_0x2b6de7(0x192)])throw new Error(_0x2b6de7(0x1a4));const _0x8c9cb1=_0x5348d2[_0x2b6de7(0x192)];console[_0x2b6de7(0x17a)](_0x2b6de7(0x179)+Object[_0x2b6de7(0x19b)](_0x8c9cb1)[_0x2b6de7(0x172)]+_0x2b6de7(0x178));const _0x51d885=Object[_0x2b6de7(0x189)](_0x8c9cb1)[_0x2b6de7(0x175)](async([_0xf37773,_0x1e4ef8])=>{const _0x2c8c54=_0x2b6de7;try{await database_1['default'][_0x2c8c54(0x1ca)][_0x2c8c54(0x15c)]({'where':{'currency':_0xf37773[_0x2c8c54(0x15b)]()},'update':{'rate':_0x1e4ef8},'create':{'currency':_0xf37773['toLowerCase'](),'rate':_0x1e4ef8}});}catch(_0x356dbf){console['error'](_0x2c8c54(0x15f)+_0xf37773+':',_0x356dbf);}});await Promise[_0x2b6de7(0x1ae)](_0x51d885),console[_0x2b6de7(0x17a)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x994fc4){console[_0x2b6de7(0x186)](_0x2b6de7(0x1b4),_0x994fc4);throw _0x994fc4;}}async['getCurrencyRate'](_0xb2e1c2){const _0x3d161f=a38_0x9ff95c,_0x203152=_0xb2e1c2[_0x3d161f(0x15b)]();if(_0x203152==='usdt')return 0x1;try{const _0x38e062=await database_1[_0x3d161f(0x158)][_0x3d161f(0x1ca)][_0x3d161f(0x18b)]({'where':{'currency':_0x203152}});if(!_0x38e062)return console[_0x3d161f(0x18d)](_0x3d161f(0x168)+_0xb2e1c2+',\x20using\x201\x20as\x20fallback'),0x1;return _0x38e062[_0x3d161f(0x166)];}catch(_0x3a84e1){return console['error'](_0x3d161f(0x16c)+_0xb2e1c2+':',_0x3a84e1),0x1;}}async[a38_0x9ff95c(0x1a3)](_0x2661d4,_0x289113){const _0x50bdf5=a38_0x9ff95c,_0xf39ed2=_0x289113[_0x50bdf5(0x15b)]();if(_0xf39ed2===_0x50bdf5(0x16b)){const _0x3782e9=_0x2661d4*(0x1+this[_0x50bdf5(0x18e)]/0x64);return console[_0x50bdf5(0x17a)](_0x50bdf5(0x1a8)+this[_0x50bdf5(0x18e)]+'%\x20markup\x20to\x20'+_0x2661d4+_0x50bdf5(0x171)+_0x3782e9[_0x50bdf5(0x1a6)](0x6)+'\x20USDT'),_0x3782e9;}try{const _0x653a87=await this[_0x50bdf5(0x170)](_0xf39ed2),_0x4d106d=_0x2661d4/_0x653a87,_0x23dd8c=_0x4d106d*(0x1+this[_0x50bdf5(0x18e)]/0x64);return console[_0x50bdf5(0x17a)]('💱\x20Converted\x20'+_0x2661d4+'\x20'+_0x289113['toUpperCase']()+_0x50bdf5(0x1b5)+_0x4d106d[_0x50bdf5(0x1a6)](0x6)+_0x50bdf5(0x1c3)+this[_0x50bdf5(0x18e)]+'%\x20markup\x20=\x20'+_0x23dd8c[_0x50bdf5(0x1a6)](0x6)+_0x50bdf5(0x197)+_0x653a87+')'),_0x23dd8c;}catch(_0x2cd361){console[_0x50bdf5(0x186)](_0x50bdf5(0x1a2)+_0x2661d4+'\x20'+_0x289113+_0x50bdf5(0x177),_0x2cd361);const _0x270467=_0x2661d4*(0x1+this[_0x50bdf5(0x18e)]/0x64);return _0x270467;}}async[a38_0x9ff95c(0x164)](_0x36b3fb){let _0x510d83=0x0;for(const {amount:_0x3bc0df,currency:_0x11733d}of _0x36b3fb){const _0x1d8d17=await this['convertToUSDT'](_0x3bc0df,_0x11733d);_0x510d83+=_0x1d8d17;}return _0x510d83;}async[a38_0x9ff95c(0x1c0)](){const _0x2f7544=a38_0x9ff95c;try{const _0x592c91=await database_1['default'][_0x2f7544(0x1ca)][_0x2f7544(0x195)]({'select':{'currency':!![],'rate':!![]}}),_0x3e1be9={'usdt':0x1};return _0x592c91[_0x2f7544(0x17d)](_0x2c8170=>{const _0x5113bc=_0x2f7544;_0x3e1be9[_0x2c8170[_0x5113bc(0x1ab)]]=_0x2c8170[_0x5113bc(0x166)];}),_0x3e1be9;}catch(_0x1e219c){return console[_0x2f7544(0x186)](_0x2f7544(0x199),_0x1e219c),{'usdt':0x1};}}async[a38_0x9ff95c(0x1d1)](){const _0x550488=a38_0x9ff95c;try{const [_0x288e62,_0x1398bb,_0x3b927f]=await Promise[_0x550488(0x198)]([database_1[_0x550488(0x158)][_0x550488(0x1ca)][_0x550488(0x16d)](),database_1['default']['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x550488(0x1ac)},'select':{'updatedAt':!![]}}),database_1[_0x550488(0x158)][_0x550488(0x1ca)][_0x550488(0x182)]({'orderBy':{'updatedAt':_0x550488(0x1b7)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x288e62,'lastUpdated':_0x1398bb?.[_0x550488(0x1ba)]||null,'oldestRate':_0x3b927f?.['updatedAt']||null,'markupPercentage':this[_0x550488(0x18e)]};}catch(_0x5e970e){return console[_0x550488(0x186)](_0x550488(0x184),_0x5e970e),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x550488(0x18e)]};}}[a38_0x9ff95c(0x1b9)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a38_0x9ff95c(0x1b6)]=new CurrencyService();