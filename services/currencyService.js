'use strict';const a39_0x503883=a39_0x5679;(function(_0x531c18,_0x1f04ad){const _0x2d05b3=a39_0x5679,_0x56fe5b=_0x531c18();while(!![]){try{const _0xd04ea1=-parseInt(_0x2d05b3(0xd1))/0x1+parseInt(_0x2d05b3(0x11d))/0x2*(parseInt(_0x2d05b3(0xe5))/0x3)+-parseInt(_0x2d05b3(0xf0))/0x4+-parseInt(_0x2d05b3(0xc7))/0x5+-parseInt(_0x2d05b3(0x10c))/0x6*(parseInt(_0x2d05b3(0xd9))/0x7)+parseInt(_0x2d05b3(0xee))/0x8*(parseInt(_0x2d05b3(0x10a))/0x9)+parseInt(_0x2d05b3(0xcc))/0xa;if(_0xd04ea1===_0x1f04ad)break;else _0x56fe5b['push'](_0x56fe5b['shift']());}catch(_0x21b3b9){_0x56fe5b['push'](_0x56fe5b['shift']());}}}(a39_0x1f7f,0x4978f));var __importDefault=this&&this['__importDefault']||function(_0x347057){return _0x347057&&_0x347057['__esModule']?_0x347057:{'default':_0x347057};};Object['defineProperty'](exports,a39_0x503883(0xfc),{'value':!![]}),exports[a39_0x503883(0x10e)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x503883(0xf8)));function a39_0x5679(_0x13324b,_0x2722be){const _0x1f7fc9=a39_0x1f7f();return a39_0x5679=function(_0x567978,_0x3b08f9){_0x567978=_0x567978-0xc5;let _0x30f259=_0x1f7fc9[_0x567978];return _0x30f259;},a39_0x5679(_0x13324b,_0x2722be);}class CurrencyService{constructor(){const _0x11b753=a39_0x503883;this[_0x11b753(0xe0)]=_0x11b753(0x11f),this[_0x11b753(0x134)]=[_0x11b753(0xd8),'eth',_0x11b753(0x12f),_0x11b753(0xf6),'bnb',_0x11b753(0x11c),_0x11b753(0x131),_0x11b753(0x121),_0x11b753(0x111),'dot','yfi',_0x11b753(0xc5),_0x11b753(0x129),_0x11b753(0xd5),_0x11b753(0x110),_0x11b753(0xf1),'bhd','bmd','brl',_0x11b753(0x115),_0x11b753(0xdc),_0x11b753(0x107),'cny',_0x11b753(0x11b),'dkk',_0x11b753(0xf9),_0x11b753(0x112),'gel',_0x11b753(0xec),_0x11b753(0xd6),_0x11b753(0x135),_0x11b753(0x133),'inr',_0x11b753(0xfa),_0x11b753(0x11a),_0x11b753(0xeb),_0x11b753(0xc8),_0x11b753(0x118),_0x11b753(0xea),_0x11b753(0xe2),_0x11b753(0xc6),_0x11b753(0x102),_0x11b753(0x138),'php',_0x11b753(0x109),_0x11b753(0xf4),'rub',_0x11b753(0xca),_0x11b753(0x137),_0x11b753(0x10f),_0x11b753(0xcb),_0x11b753(0xcd),_0x11b753(0x13d),_0x11b753(0xe6),_0x11b753(0x13a),_0x11b753(0xdf),_0x11b753(0x127),'xdr','xag',_0x11b753(0x124),_0x11b753(0xfb),'sats'],this[_0x11b753(0x123)]=null,this[_0x11b753(0xe3)]=-0x3,this[_0x11b753(0x13b)]();}[a39_0x503883(0x13b)](){const _0x27115e=a39_0x503883;this[_0x27115e(0x120)]()[_0x27115e(0x130)](_0x37b110=>{const _0x5ca46b=_0x27115e;console[_0x5ca46b(0x12a)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x37b110);}),this[_0x27115e(0x123)]=setInterval(async()=>{const _0x40f367=_0x27115e;try{await this[_0x40f367(0x120)]();}catch(_0x13ac26){console['error'](_0x40f367(0x136),_0x13ac26);}},0x3c*0x3c*0x3e8),console[_0x27115e(0xcf)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x503883(0x103)](){const _0x21aaa7=a39_0x503883;this[_0x21aaa7(0x123)]&&(clearInterval(this[_0x21aaa7(0x123)]),this['updateInterval']=null,console[_0x21aaa7(0xcf)](_0x21aaa7(0xfd)));}async[a39_0x503883(0x120)](){const _0x3b5cb3=a39_0x503883;try{console['log']('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x42e660=this['CURRENCIES'][_0x3b5cb3(0x106)](','),_0x41f7ce=this[_0x3b5cb3(0xe0)]+_0x3b5cb3(0x116)+_0x42e660,_0xfd39eb=await fetch(_0x41f7ce,{'headers':{'Accept':_0x3b5cb3(0x114),'User-Agent':_0x3b5cb3(0xf2)}});if(!_0xfd39eb['ok'])throw new Error(_0x3b5cb3(0x100)+_0xfd39eb[_0x3b5cb3(0x108)]+'\x20'+_0xfd39eb[_0x3b5cb3(0x117)]);const _0x122a2b=await _0xfd39eb['json']();if(!_0x122a2b[_0x3b5cb3(0xe7)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x3fc3df=_0x122a2b[_0x3b5cb3(0xe7)];console[_0x3b5cb3(0xcf)](_0x3b5cb3(0xda)+Object[_0x3b5cb3(0xef)](_0x3fc3df)[_0x3b5cb3(0xce)]+'\x20currencies');const _0x1baba3=Object[_0x3b5cb3(0x126)](_0x3fc3df)['map'](async([_0xd87d27,_0xa146de])=>{const _0x2a3e06=_0x3b5cb3;try{await database_1[_0x2a3e06(0x11e)][_0x2a3e06(0x128)]['upsert']({'where':{'currency':_0xd87d27['toLowerCase']()},'update':{'rate':_0xa146de},'create':{'currency':_0xd87d27[_0x2a3e06(0x12d)](),'rate':_0xa146de}});}catch(_0x4d0a66){console[_0x2a3e06(0x12a)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0xd87d27+':',_0x4d0a66);}});await Promise[_0x3b5cb3(0xdd)](_0x1baba3),console[_0x3b5cb3(0xcf)](_0x3b5cb3(0x101));}catch(_0x419c4c){console[_0x3b5cb3(0x12a)](_0x3b5cb3(0x12c),_0x419c4c);throw _0x419c4c;}}async[a39_0x503883(0xd7)](_0x200d99){const _0x5b6dd2=a39_0x503883,_0x2247f5=_0x200d99['toLowerCase']();if(_0x2247f5==='usdt')return 0x1;try{const _0x3c76e8=await database_1[_0x5b6dd2(0x11e)]['currencyRate'][_0x5b6dd2(0x139)]({'where':{'currency':_0x2247f5}});if(!_0x3c76e8)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x200d99+_0x5b6dd2(0x10b)),0x1;return _0x3c76e8[_0x5b6dd2(0x12b)];}catch(_0x558c21){return console[_0x5b6dd2(0x12a)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x200d99+':',_0x558c21),0x1;}}async['convertToUSDT'](_0x3075f1,_0x23ed57){const _0x49171f=a39_0x503883,_0x4ee066=_0x23ed57[_0x49171f(0x12d)]();if(_0x4ee066===_0x49171f(0xc9)){const _0x13f8de=_0x3075f1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x49171f(0xcf)](_0x49171f(0x10d)+this['MARKUP_PERCENTAGE']+_0x49171f(0xdb)+_0x3075f1+_0x49171f(0xf7)+_0x13f8de['toFixed'](0x6)+_0x49171f(0xf5)),_0x13f8de;}try{const _0x499c4c=await this['getCurrencyRate'](_0x4ee066),_0xe0ce69=_0x3075f1/_0x499c4c,_0x19caee=_0xe0ce69*(0x1+this[_0x49171f(0xe3)]/0x64);return console['log']('üí±\x20Converted\x20'+_0x3075f1+'\x20'+_0x23ed57[_0x49171f(0x125)]()+_0x49171f(0x12e)+_0xe0ce69[_0x49171f(0xed)](0x6)+_0x49171f(0x132)+this[_0x49171f(0xe3)]+_0x49171f(0xd4)+_0x19caee[_0x49171f(0xed)](0x6)+'\x20USDT\x20(rate:\x20'+_0x499c4c+')'),_0x19caee;}catch(_0x187562){console[_0x49171f(0x12a)]('Error\x20converting\x20'+_0x3075f1+'\x20'+_0x23ed57+_0x49171f(0xf3),_0x187562);const _0x2887f7=_0x3075f1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x2887f7;}}async[a39_0x503883(0xde)](_0x42234e){const _0x5791d7=a39_0x503883;let _0xb2497=0x0;for(const {amount:_0x4834e1,currency:_0x42da69}of _0x42234e){const _0x91d4c6=await this[_0x5791d7(0xd0)](_0x4834e1,_0x42da69);_0xb2497+=_0x91d4c6;}return _0xb2497;}async[a39_0x503883(0x113)](){const _0x171345=a39_0x503883;try{const _0xf551f2=await database_1[_0x171345(0x11e)]['currencyRate'][_0x171345(0xd2)]({'select':{'currency':!![],'rate':!![]}}),_0x3837b4={'usdt':0x1};return _0xf551f2['forEach'](_0x5cc498=>{const _0xf6c6ed=_0x171345;_0x3837b4[_0x5cc498[_0xf6c6ed(0x119)]]=_0x5cc498['rate'];}),_0x3837b4;}catch(_0x23ec08){return console[_0x171345(0x12a)](_0x171345(0x122),_0x23ec08),{'usdt':0x1};}}async[a39_0x503883(0x105)](){const _0x2b0492=a39_0x503883;try{const [_0x20f145,_0x1edd22,_0xae4c6f]=await Promise[_0x2b0492(0xff)]([database_1[_0x2b0492(0x11e)][_0x2b0492(0x128)][_0x2b0492(0xe9)](),database_1[_0x2b0492(0x11e)][_0x2b0492(0x128)]['findFirst']({'orderBy':{'updatedAt':_0x2b0492(0xd3)},'select':{'updatedAt':!![]}}),database_1[_0x2b0492(0x11e)][_0x2b0492(0x128)][_0x2b0492(0xfe)]({'orderBy':{'updatedAt':_0x2b0492(0x104)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x20f145,'lastUpdated':_0x1edd22?.[_0x2b0492(0xe4)]||null,'oldestRate':_0xae4c6f?.[_0x2b0492(0xe4)]||null,'markupPercentage':this[_0x2b0492(0xe3)]};}catch(_0x4da4ba){return console[_0x2b0492(0x12a)](_0x2b0492(0xe8),_0x4da4ba),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2b0492(0xe3)]};}}[a39_0x503883(0xe1)](){const _0x4ed1f6=a39_0x503883;return this[_0x4ed1f6(0xe3)];}}exports[a39_0x503883(0x13c)]=CurrencyService,exports['currencyService']=new CurrencyService();function a39_0x1f7f(){const _0xc41bd4=['aud','link','gbp','getAllRates','application/json','cad','?ids=tether&vs_currencies=','statusText','mmk','currency','krw','czk','eos','2wYUgcI','default','https://api.coingecko.com/api/v3/simple/price','updateCurrencyRates','xlm','Error\x20getting\x20all\x20rates:','updateInterval','xau','toUpperCase','entries','zar','currencyRate','aed','error','rate','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','toLowerCase','\x20to\x20','ltc','catch','xrp','\x20USDT,\x20with\x20','ils','CURRENCIES','idr','Periodic\x20currency\x20rates\x20update\x20failed:','sek','nzd','findUnique','vef','startPeriodicUpdates','CurrencyService','twd','usd','ngn','736210MmMTey','lkr','usdt','sar','thb','8211420VEhUuH','try','length','log','convertToUSDT','365387eqhNZK','findMany','desc','%\x20markup\x20=\x20','ars','huf','getCurrencyRate','btc','19446gzxdKR','üìä\x20Received\x20rates\x20for\x20','%\x20markup\x20to\x20','chf','allSettled','convertMultipleToUSDT','vnd','COINGECKO_URL','getMarkupPercentage','myr','MARKUP_PERCENTAGE','updatedAt','758643BKFFqg','uah','tether','Error\x20getting\x20rates\x20status:','count','mxn','kwd','hkd','toFixed','2982488xczQuS','keys','1644088bcCoHQ','bdt','TesSoft\x20Payment\x20System/1.0','\x20to\x20USDT:','pln','\x20USDT','bch','\x20USDT\x20=\x20','../config/database','eur','jpy','bits','__esModule','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','findFirst','all','CoinGecko\x20API\x20error:\x20','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','nok','stopPeriodicUpdates','asc','getRatesStatus','join','clp','status','pkr','9MPLNlo',',\x20using\x201\x20as\x20fallback','480vAbuGR','üí±\x20Applied\x20','currencyService','sgd'];a39_0x1f7f=function(){return _0xc41bd4;};return a39_0x1f7f();}