'use strict';const a39_0x826b61=a39_0x49ed;(function(_0x39bc44,_0x439502){const _0x1acb64=a39_0x49ed,_0x274c66=_0x39bc44();while(!![]){try{const _0x337234=parseInt(_0x1acb64(0x12e))/0x1+parseInt(_0x1acb64(0x15b))/0x2*(parseInt(_0x1acb64(0x166))/0x3)+parseInt(_0x1acb64(0x190))/0x4*(-parseInt(_0x1acb64(0x14a))/0x5)+-parseInt(_0x1acb64(0x130))/0x6+parseInt(_0x1acb64(0x169))/0x7*(parseInt(_0x1acb64(0x161))/0x8)+-parseInt(_0x1acb64(0x14e))/0x9*(parseInt(_0x1acb64(0x156))/0xa)+-parseInt(_0x1acb64(0x185))/0xb*(-parseInt(_0x1acb64(0x194))/0xc);if(_0x337234===_0x439502)break;else _0x274c66['push'](_0x274c66['shift']());}catch(_0x1fcbe0){_0x274c66['push'](_0x274c66['shift']());}}}(a39_0x2a81,0xeab46));function a39_0x49ed(_0x586fbd,_0x60484){const _0x2a8100=a39_0x2a81();return a39_0x49ed=function(_0x49eddf,_0x586805){_0x49eddf=_0x49eddf-0x11a;let _0x342108=_0x2a8100[_0x49eddf];return _0x342108;},a39_0x49ed(_0x586fbd,_0x60484);}function a39_0x2a81(){const _0x3a4377=['xag','error','\x20USDT\x20(rate:\x20','try','startPeriodicUpdates','4885504zjylTk','vef','xdr','updatedAt','16543608RQRULk','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','link','bmd','ils','getMarkupPercentage','Error\x20getting\x20all\x20rates:','usdt','tether','asc','Periodic\x20currency\x20rates\x20update\x20failed:','eos','CurrencyService','\x20to\x20USDT:','%\x20markup\x20=\x20','bits','twd','\x20USDT,\x20with\x20','currencyService','json','sats','bch','\x20USDT\x20=\x20','currencyRate','487476PdpbTc','💱\x20Converted\x20','11438478ckwYtB','uah','updateInterval','clp','brl','thb','getRatesStatus','%\x20markup\x20to\x20','Initial\x20currency\x20rates\x20update\x20failed:','?ids=tether&vs_currencies=','bdt','myr','pkr',',\x20using\x201\x20as\x20fallback','toLowerCase','updateCurrencyRates','vnd','gbp','✅\x20Currency\x20rates\x20updated\x20successfully','Error\x20getting\x20rates\x20status:','btc','https://api.coingecko.com/api/v3/simple/price','findFirst','warn','CURRENCIES','Error\x20getting\x20rate\x20for\x20currency\x20','5RIyMXp','count','__esModule','yfi','9HqsVYP','desc','\x20currencies','entries','keys','toFixed','aud','cad','11165830WVSTZs','nzd','zar','sar','ars','2837386gHiYzT','\x20USDT','pln','convertToUSDT','default','rate','104SiYhAD','aed','TesSoft\x20Payment\x20System/1.0','MARKUP_PERCENTAGE','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','3DSOVuU','ngn','mxn','1034341cmkdSX','idr','findUnique','allSettled','../config/database','sek','dkk','status','log','rub','COINGECKO_URL','❌\x20Failed\x20to\x20update\x20currency\x20rates:','forEach','usd','bhd','xlm','kwd','huf','findMany','eur','getCurrencyRate','Failed\x20to\x20update\x20rate\x20for\x20','krw','cny','ltc','czk','mmk','hkd','11KOkmrk','📊\x20Received\x20rates\x20for\x20','Error\x20converting\x20','💱\x20Applied\x20','__importDefault','No\x20rate\x20found\x20for\x20currency:\x20'];a39_0x2a81=function(){return _0x3a4377;};return a39_0x2a81();}var __importDefault=this&&this[a39_0x826b61(0x189)]||function(_0x122fd2){const _0x7d700e=a39_0x826b61;return _0x122fd2&&_0x122fd2[_0x7d700e(0x14c)]?_0x122fd2:{'default':_0x122fd2};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a39_0x826b61(0x128)]=exports[a39_0x826b61(0x122)]=void 0x0;const database_1=__importDefault(require(a39_0x826b61(0x16d)));class CurrencyService{constructor(){const _0x5a8445=a39_0x826b61;this[_0x5a8445(0x173)]=_0x5a8445(0x145),this[_0x5a8445(0x148)]=[_0x5a8445(0x144),'eth',_0x5a8445(0x181),_0x5a8445(0x12b),'bnb',_0x5a8445(0x121),'xrp',_0x5a8445(0x178),_0x5a8445(0x196),'dot',_0x5a8445(0x14d),_0x5a8445(0x176),_0x5a8445(0x162),_0x5a8445(0x15a),_0x5a8445(0x154),_0x5a8445(0x13a),_0x5a8445(0x177),_0x5a8445(0x197),_0x5a8445(0x134),_0x5a8445(0x155),'chf',_0x5a8445(0x133),_0x5a8445(0x180),_0x5a8445(0x182),_0x5a8445(0x16f),_0x5a8445(0x17c),_0x5a8445(0x141),'gel',_0x5a8445(0x184),_0x5a8445(0x17a),_0x5a8445(0x16a),_0x5a8445(0x11a),'inr','jpy',_0x5a8445(0x17f),_0x5a8445(0x179),'lkr',_0x5a8445(0x183),_0x5a8445(0x168),_0x5a8445(0x13b),_0x5a8445(0x167),'nok',_0x5a8445(0x157),'php',_0x5a8445(0x13c),_0x5a8445(0x15d),_0x5a8445(0x172),_0x5a8445(0x159),_0x5a8445(0x16e),'sgd',_0x5a8445(0x135),_0x5a8445(0x18e),_0x5a8445(0x126),_0x5a8445(0x131),_0x5a8445(0x191),_0x5a8445(0x140),_0x5a8445(0x158),_0x5a8445(0x192),_0x5a8445(0x18b),'xau',_0x5a8445(0x125),_0x5a8445(0x12a)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x5a8445(0x18f)]();}[a39_0x826b61(0x18f)](){const _0x2ae7ea=a39_0x826b61;this[_0x2ae7ea(0x13f)]()['catch'](_0x5592f3=>{const _0x508967=_0x2ae7ea;console[_0x508967(0x18c)](_0x508967(0x138),_0x5592f3);}),this[_0x2ae7ea(0x132)]=setInterval(async()=>{const _0x362180=_0x2ae7ea;try{await this[_0x362180(0x13f)]();}catch(_0x4ec65f){console[_0x362180(0x18c)](_0x362180(0x120),_0x4ec65f);}},0x3c*0x3c*0x3e8),console[_0x2ae7ea(0x171)](_0x2ae7ea(0x165));}['stopPeriodicUpdates'](){const _0x27b30e=a39_0x826b61;this[_0x27b30e(0x132)]&&(clearInterval(this[_0x27b30e(0x132)]),this[_0x27b30e(0x132)]=null,console[_0x27b30e(0x171)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a39_0x826b61(0x13f)](){const _0x5bf6c6=a39_0x826b61;try{console[_0x5bf6c6(0x171)](_0x5bf6c6(0x195));const _0x4fe2db=this[_0x5bf6c6(0x148)]['join'](','),_0xa4a52f=this['COINGECKO_URL']+_0x5bf6c6(0x139)+_0x4fe2db,_0x4c737a=await fetch(_0xa4a52f,{'headers':{'Accept':'application/json','User-Agent':_0x5bf6c6(0x163)}});if(!_0x4c737a['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x4c737a[_0x5bf6c6(0x170)]+'\x20'+_0x4c737a['statusText']);const _0x260eb0=await _0x4c737a[_0x5bf6c6(0x129)]();if(!_0x260eb0[_0x5bf6c6(0x11e)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x51dc27=_0x260eb0['tether'];console[_0x5bf6c6(0x171)](_0x5bf6c6(0x186)+Object[_0x5bf6c6(0x152)](_0x51dc27)['length']+_0x5bf6c6(0x150));const _0x51bb3e=Object[_0x5bf6c6(0x151)](_0x51dc27)['map'](async([_0x44d9f2,_0x2e3cc5])=>{const _0x11a726=_0x5bf6c6;try{await database_1[_0x11a726(0x15f)]['currencyRate']['upsert']({'where':{'currency':_0x44d9f2[_0x11a726(0x13e)]()},'update':{'rate':_0x2e3cc5},'create':{'currency':_0x44d9f2[_0x11a726(0x13e)](),'rate':_0x2e3cc5}});}catch(_0xfc9447){console[_0x11a726(0x18c)](_0x11a726(0x17e)+_0x44d9f2+':',_0xfc9447);}});await Promise[_0x5bf6c6(0x16c)](_0x51bb3e),console[_0x5bf6c6(0x171)](_0x5bf6c6(0x142));}catch(_0x4da76f){console['error'](_0x5bf6c6(0x174),_0x4da76f);throw _0x4da76f;}}async[a39_0x826b61(0x17d)](_0x1c4dad){const _0x1420ed=a39_0x826b61,_0x11d89b=_0x1c4dad['toLowerCase']();if(_0x11d89b===_0x1420ed(0x11d))return 0x1;try{const _0x3ebb9b=await database_1['default']['currencyRate'][_0x1420ed(0x16b)]({'where':{'currency':_0x11d89b}});if(!_0x3ebb9b)return console[_0x1420ed(0x147)](_0x1420ed(0x18a)+_0x1c4dad+_0x1420ed(0x13d)),0x1;return _0x3ebb9b[_0x1420ed(0x160)];}catch(_0x542db5){return console[_0x1420ed(0x18c)](_0x1420ed(0x149)+_0x1c4dad+':',_0x542db5),0x1;}}async[a39_0x826b61(0x15e)](_0x43640b,_0x45a1f8){const _0x25ef47=a39_0x826b61,_0x4f89e3=_0x45a1f8[_0x25ef47(0x13e)]();if(_0x4f89e3===_0x25ef47(0x11d)){const _0x3ca2db=_0x43640b*(0x1+this[_0x25ef47(0x164)]/0x64);return console['log'](_0x25ef47(0x188)+this[_0x25ef47(0x164)]+_0x25ef47(0x137)+_0x43640b+_0x25ef47(0x12c)+_0x3ca2db[_0x25ef47(0x153)](0x6)+_0x25ef47(0x15c)),_0x3ca2db;}try{const _0x1c2584=await this['getCurrencyRate'](_0x4f89e3),_0xe6c98b=_0x43640b/_0x1c2584,_0x10cf84=_0xe6c98b*(0x1+this[_0x25ef47(0x164)]/0x64);return console[_0x25ef47(0x171)](_0x25ef47(0x12f)+_0x43640b+'\x20'+_0x45a1f8['toUpperCase']()+'\x20to\x20'+_0xe6c98b[_0x25ef47(0x153)](0x6)+_0x25ef47(0x127)+this[_0x25ef47(0x164)]+_0x25ef47(0x124)+_0x10cf84[_0x25ef47(0x153)](0x6)+_0x25ef47(0x18d)+_0x1c2584+')'),_0x10cf84;}catch(_0x2f3449){console[_0x25ef47(0x18c)](_0x25ef47(0x187)+_0x43640b+'\x20'+_0x45a1f8+_0x25ef47(0x123),_0x2f3449);const _0xce430a=_0x43640b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0xce430a;}}async['convertMultipleToUSDT'](_0x330634){const _0x388055=a39_0x826b61;let _0x19c94e=0x0;for(const {amount:_0xbaa26a,currency:_0x8c2d}of _0x330634){const _0x10c844=await this[_0x388055(0x15e)](_0xbaa26a,_0x8c2d);_0x19c94e+=_0x10c844;}return _0x19c94e;}async['getAllRates'](){const _0x4a46e7=a39_0x826b61;try{const _0x1bc5e4=await database_1[_0x4a46e7(0x15f)][_0x4a46e7(0x12d)][_0x4a46e7(0x17b)]({'select':{'currency':!![],'rate':!![]}}),_0x59145b={'usdt':0x1};return _0x1bc5e4[_0x4a46e7(0x175)](_0x16fadb=>{const _0x5daabb=_0x4a46e7;_0x59145b[_0x16fadb['currency']]=_0x16fadb[_0x5daabb(0x160)];}),_0x59145b;}catch(_0x331a14){return console[_0x4a46e7(0x18c)](_0x4a46e7(0x11c),_0x331a14),{'usdt':0x1};}}async[a39_0x826b61(0x136)](){const _0x582287=a39_0x826b61;try{const [_0x546491,_0x1cf5de,_0x40e09c]=await Promise['all']([database_1[_0x582287(0x15f)][_0x582287(0x12d)][_0x582287(0x14b)](),database_1[_0x582287(0x15f)][_0x582287(0x12d)][_0x582287(0x146)]({'orderBy':{'updatedAt':_0x582287(0x14f)},'select':{'updatedAt':!![]}}),database_1[_0x582287(0x15f)][_0x582287(0x12d)][_0x582287(0x146)]({'orderBy':{'updatedAt':_0x582287(0x11f)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x546491,'lastUpdated':_0x1cf5de?.[_0x582287(0x193)]||null,'oldestRate':_0x40e09c?.[_0x582287(0x193)]||null,'markupPercentage':this[_0x582287(0x164)]};}catch(_0x27f887){return console[_0x582287(0x18c)](_0x582287(0x143),_0x27f887),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x582287(0x164)]};}}[a39_0x826b61(0x11b)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a39_0x826b61(0x128)]=new CurrencyService();