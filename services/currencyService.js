'use strict';function a38_0x4174(){const _0x4197dc=['updateInterval','%\x20markup\x20=\x20','bmd','xag','count','php','bdt','tether','bnb','💱\x20Converted\x20','__importDefault','currency','findFirst','COINGECKO_URL','\x20USDT\x20(rate:\x20','length','📊\x20Received\x20rates\x20for\x20','updatedAt','aud','❌\x20Failed\x20to\x20update\x20currency\x20rates:','2893792ieVjlb','idr','aed','toUpperCase','eth','bch','rate','389884jAfPbX','TesSoft\x20Payment\x20System/1.0','__esModule','bits','bhd','findUnique','clp','../config/database','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ars','Failed\x20to\x20update\x20rate\x20for\x20','ngn','toFixed','\x20USDT','statusText','getRatesStatus','getCurrencyRate','usd','dot','czk','Periodic\x20currency\x20rates\x20update\x20failed:','link','entries','ltc','warn','pkr','convertMultipleToUSDT','findMany','zar','CoinGecko\x20API\x20error:\x20','currencyService','\x20to\x20','startPeriodicUpdates','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','status','keys','dkk','CURRENCIES','14Boxljt','%\x20markup\x20to\x20','error','1334307yxwFUi','upsert','https://api.coingecko.com/api/v3/simple/price','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','1362210HVjVcs','all','Error\x20getting\x20rates\x20status:','uah','ils','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','chf','💱\x20Applied\x20','catch','52695ubQiRo','sar','log','4730436vblroE','gbp','hkd','sgd','vnd','xrp','xau','mxn','convertToUSDT','rub',',\x20using\x201\x20as\x20fallback','join','8JGPUdK','Error\x20getting\x20rate\x20for\x20currency\x20','default','thb','cad','CurrencyService','Error\x20getting\x20all\x20rates:','pln','yfi','updateCurrencyRates','eos','json','desc','getMarkupPercentage','currencyRate','MARKUP_PERCENTAGE','btc','\x20USDT,\x20with\x20','toLowerCase','290994pgaUyt','No\x20rate\x20found\x20for\x20currency:\x20','vef','xdr','inr','map','\x20to\x20USDT:','stopPeriodicUpdates','\x20USDT\x20=\x20','allSettled'];a38_0x4174=function(){return _0x4197dc;};return a38_0x4174();}const a38_0x18f5c4=a38_0x4631;(function(_0x420a79,_0x318147){const _0x60d7d3=a38_0x4631,_0x361692=_0x420a79();while(!![]){try{const _0x3f8c81=parseInt(_0x60d7d3(0x1a9))/0x1+-parseInt(_0x60d7d3(0x201))/0x2+parseInt(_0x60d7d3(0x1d2))/0x3+parseInt(_0x60d7d3(0x1ee))/0x4*(parseInt(_0x60d7d3(0x1df))/0x5)+-parseInt(_0x60d7d3(0x1d6))/0x6*(-parseInt(_0x60d7d3(0x1cf))/0x7)+-parseInt(_0x60d7d3(0x1a2))/0x8+-parseInt(_0x60d7d3(0x1e2))/0x9;if(_0x3f8c81===_0x318147)break;else _0x361692['push'](_0x361692['shift']());}catch(_0x18cc2e){_0x361692['push'](_0x361692['shift']());}}}(a38_0x4174,0x439f0));function a38_0x4631(_0x24b02e,_0x3f9d2c){const _0x417484=a38_0x4174();return a38_0x4631=function(_0x4631d5,_0x27ec60){_0x4631d5=_0x4631d5-0x198;let _0x333387=_0x417484[_0x4631d5];return _0x333387;},a38_0x4631(_0x24b02e,_0x3f9d2c);}var __importDefault=this&&this[a38_0x18f5c4(0x198)]||function(_0x2d6db1){const _0x1ad4b2=a38_0x18f5c4;return _0x2d6db1&&_0x2d6db1[_0x1ad4b2(0x1ab)]?_0x2d6db1:{'default':_0x2d6db1};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x18f5c4(0x1c7)]=exports[a38_0x18f5c4(0x1f3)]=void 0x0;const database_1=__importDefault(require(a38_0x18f5c4(0x1b0)));class CurrencyService{constructor(){const _0x38b9b3=a38_0x18f5c4;this[_0x38b9b3(0x19b)]=_0x38b9b3(0x1d4),this[_0x38b9b3(0x1ce)]=[_0x38b9b3(0x1fe),_0x38b9b3(0x1a6),_0x38b9b3(0x1c0),_0x38b9b3(0x1a7),_0x38b9b3(0x213),_0x38b9b3(0x1f8),_0x38b9b3(0x1e7),'xlm',_0x38b9b3(0x1be),_0x38b9b3(0x1bb),_0x38b9b3(0x1f6),_0x38b9b3(0x1ba),_0x38b9b3(0x1a4),_0x38b9b3(0x1b2),_0x38b9b3(0x1a0),_0x38b9b3(0x211),_0x38b9b3(0x1ad),_0x38b9b3(0x20d),'brl',_0x38b9b3(0x1f2),_0x38b9b3(0x1dc),_0x38b9b3(0x1af),'cny',_0x38b9b3(0x1bc),_0x38b9b3(0x1cd),'eur',_0x38b9b3(0x1e3),'gel',_0x38b9b3(0x1e4),'huf',_0x38b9b3(0x1a3),_0x38b9b3(0x1da),_0x38b9b3(0x205),'jpy','krw','kwd','lkr','mmk',_0x38b9b3(0x1e9),'myr',_0x38b9b3(0x1b4),'nok','nzd',_0x38b9b3(0x210),_0x38b9b3(0x1c2),_0x38b9b3(0x1f5),_0x38b9b3(0x1eb),_0x38b9b3(0x1e0),'sek',_0x38b9b3(0x1e5),_0x38b9b3(0x1f1),'try','twd',_0x38b9b3(0x1d9),_0x38b9b3(0x203),_0x38b9b3(0x1e6),_0x38b9b3(0x1c5),_0x38b9b3(0x204),_0x38b9b3(0x20e),_0x38b9b3(0x1e8),_0x38b9b3(0x1ac),'sats'],this[_0x38b9b3(0x20b)]=null,this[_0x38b9b3(0x1fd)]=0x3,this[_0x38b9b3(0x1c9)]();}[a38_0x18f5c4(0x1c9)](){const _0x228e32=a38_0x18f5c4;this[_0x228e32(0x1f7)]()[_0x228e32(0x1de)](_0x520803=>{const _0xa84bd3=_0x228e32;console[_0xa84bd3(0x1d1)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x520803);}),this[_0x228e32(0x20b)]=setInterval(async()=>{const _0xcfedea=_0x228e32;try{await this[_0xcfedea(0x1f7)]();}catch(_0x53fa1d){console['error'](_0xcfedea(0x1bd),_0x53fa1d);}},0x3c*0x3c*0x3e8),console[_0x228e32(0x1e1)](_0x228e32(0x1ca));}[a38_0x18f5c4(0x208)](){const _0x5ae7cc=a38_0x18f5c4;this[_0x5ae7cc(0x20b)]&&(clearInterval(this[_0x5ae7cc(0x20b)]),this[_0x5ae7cc(0x20b)]=null,console[_0x5ae7cc(0x1e1)](_0x5ae7cc(0x1d5)));}async[a38_0x18f5c4(0x1f7)](){const _0x13706f=a38_0x18f5c4;try{console[_0x13706f(0x1e1)](_0x13706f(0x1b1));const _0x2139df=this[_0x13706f(0x1ce)][_0x13706f(0x1ed)](','),_0x4b2f2a=this[_0x13706f(0x19b)]+'?ids=tether&vs_currencies='+_0x2139df,_0x2f79e4=await fetch(_0x4b2f2a,{'headers':{'Accept':'application/json','User-Agent':_0x13706f(0x1aa)}});if(!_0x2f79e4['ok'])throw new Error(_0x13706f(0x1c6)+_0x2f79e4[_0x13706f(0x1cb)]+'\x20'+_0x2f79e4[_0x13706f(0x1b7)]);const _0x283356=await _0x2f79e4[_0x13706f(0x1f9)]();if(!_0x283356[_0x13706f(0x212)])throw new Error(_0x13706f(0x1db));const _0x4e2f7c=_0x283356['tether'];console[_0x13706f(0x1e1)](_0x13706f(0x19e)+Object[_0x13706f(0x1cc)](_0x4e2f7c)[_0x13706f(0x19d)]+'\x20currencies');const _0xfbe056=Object[_0x13706f(0x1bf)](_0x4e2f7c)[_0x13706f(0x206)](async([_0x1ce450,_0x1bdff9])=>{const _0x1d597d=_0x13706f;try{await database_1[_0x1d597d(0x1f0)][_0x1d597d(0x1fc)][_0x1d597d(0x1d3)]({'where':{'currency':_0x1ce450[_0x1d597d(0x200)]()},'update':{'rate':_0x1bdff9},'create':{'currency':_0x1ce450['toLowerCase'](),'rate':_0x1bdff9}});}catch(_0x2fe1eb){console[_0x1d597d(0x1d1)](_0x1d597d(0x1b3)+_0x1ce450+':',_0x2fe1eb);}});await Promise[_0x13706f(0x20a)](_0xfbe056),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x48120a){console['error'](_0x13706f(0x1a1),_0x48120a);throw _0x48120a;}}async[a38_0x18f5c4(0x1b9)](_0x2c80c9){const _0x1fbc5d=a38_0x18f5c4,_0x2083d3=_0x2c80c9['toLowerCase']();if(_0x2083d3==='usdt')return 0x1;try{const _0x2e29c2=await database_1[_0x1fbc5d(0x1f0)][_0x1fbc5d(0x1fc)][_0x1fbc5d(0x1ae)]({'where':{'currency':_0x2083d3}});if(!_0x2e29c2)return console[_0x1fbc5d(0x1c1)](_0x1fbc5d(0x202)+_0x2c80c9+_0x1fbc5d(0x1ec)),0x1;return _0x2e29c2[_0x1fbc5d(0x1a8)];}catch(_0x4580db){return console[_0x1fbc5d(0x1d1)](_0x1fbc5d(0x1ef)+_0x2c80c9+':',_0x4580db),0x1;}}async[a38_0x18f5c4(0x1ea)](_0x1f26c8,_0x5106c6){const _0x47ff7a=a38_0x18f5c4,_0x385bb1=_0x5106c6[_0x47ff7a(0x200)]();if(_0x385bb1==='usdt'){const _0x5331b3=_0x1f26c8*(0x1+this[_0x47ff7a(0x1fd)]/0x64);return console['log'](_0x47ff7a(0x1dd)+this[_0x47ff7a(0x1fd)]+_0x47ff7a(0x1d0)+_0x1f26c8+_0x47ff7a(0x209)+_0x5331b3['toFixed'](0x6)+_0x47ff7a(0x1b6)),_0x5331b3;}try{const _0x2d54aa=await this[_0x47ff7a(0x1b9)](_0x385bb1),_0x4fe700=_0x1f26c8/_0x2d54aa,_0x4a4e35=_0x4fe700*(0x1+this[_0x47ff7a(0x1fd)]/0x64);return console[_0x47ff7a(0x1e1)](_0x47ff7a(0x214)+_0x1f26c8+'\x20'+_0x5106c6[_0x47ff7a(0x1a5)]()+_0x47ff7a(0x1c8)+_0x4fe700[_0x47ff7a(0x1b5)](0x6)+_0x47ff7a(0x1ff)+this['MARKUP_PERCENTAGE']+_0x47ff7a(0x20c)+_0x4a4e35[_0x47ff7a(0x1b5)](0x6)+_0x47ff7a(0x19c)+_0x2d54aa+')'),_0x4a4e35;}catch(_0x5132b9){console[_0x47ff7a(0x1d1)]('Error\x20converting\x20'+_0x1f26c8+'\x20'+_0x5106c6+_0x47ff7a(0x207),_0x5132b9);const _0x3ee41b=_0x1f26c8*(0x1+this[_0x47ff7a(0x1fd)]/0x64);return _0x3ee41b;}}async[a38_0x18f5c4(0x1c3)](_0x57f0cc){const _0xac1ab3=a38_0x18f5c4;let _0x17c071=0x0;for(const {amount:_0x122ec9,currency:_0x34d980}of _0x57f0cc){const _0x2f168e=await this[_0xac1ab3(0x1ea)](_0x122ec9,_0x34d980);_0x17c071+=_0x2f168e;}return _0x17c071;}async['getAllRates'](){const _0x239e8d=a38_0x18f5c4;try{const _0x2b63a7=await database_1[_0x239e8d(0x1f0)][_0x239e8d(0x1fc)][_0x239e8d(0x1c4)]({'select':{'currency':!![],'rate':!![]}}),_0xb2d4c9={'usdt':0x1};return _0x2b63a7['forEach'](_0x3d2142=>{const _0x46918c=_0x239e8d;_0xb2d4c9[_0x3d2142[_0x46918c(0x199)]]=_0x3d2142['rate'];}),_0xb2d4c9;}catch(_0x6f66b5){return console[_0x239e8d(0x1d1)](_0x239e8d(0x1f4),_0x6f66b5),{'usdt':0x1};}}async[a38_0x18f5c4(0x1b8)](){const _0x420258=a38_0x18f5c4;try{const [_0x262798,_0x302eb3,_0x4aa6e5]=await Promise[_0x420258(0x1d7)]([database_1[_0x420258(0x1f0)][_0x420258(0x1fc)][_0x420258(0x20f)](),database_1[_0x420258(0x1f0)][_0x420258(0x1fc)]['findFirst']({'orderBy':{'updatedAt':_0x420258(0x1fa)},'select':{'updatedAt':!![]}}),database_1[_0x420258(0x1f0)][_0x420258(0x1fc)][_0x420258(0x19a)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x262798,'lastUpdated':_0x302eb3?.[_0x420258(0x19f)]||null,'oldestRate':_0x4aa6e5?.['updatedAt']||null,'markupPercentage':this[_0x420258(0x1fd)]};}catch(_0x448090){return console[_0x420258(0x1d1)](_0x420258(0x1d8),_0x448090),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x420258(0x1fd)]};}}[a38_0x18f5c4(0x1fb)](){return this['MARKUP_PERCENTAGE'];}}exports[a38_0x18f5c4(0x1f3)]=CurrencyService,exports['currencyService']=new CurrencyService();