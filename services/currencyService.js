'use strict';function a39_0x2324(){const _0x5b51a9=['pln','forEach','updateCurrencyRates','92138zjamfo','nzd','eur','CurrencyService','❌\x20Failed\x20to\x20update\x20currency\x20rates:','error','%\x20markup\x20=\x20','eos','hkd','upsert','1832500ZqsmLl','Failed\x20to\x20update\x20rate\x20for\x20','bhd','catch','currencyService','updateInterval','bdt','kwd','rate','keys','clp','tether','xrp','chf','sgd','593561dOYLtJ','aed','findMany','bits','toLowerCase','findFirst','vnd','\x20USDT,\x20with\x20','xlm','dkk','✅\x20Currency\x20rates\x20updated\x20successfully','xdr','%\x20markup\x20to\x20','mmk','257208dODzfz','Error\x20getting\x20rate\x20for\x20currency\x20','MARKUP_PERCENTAGE','\x20USDT','json','asc','huf','btc','usd','startPeriodicUpdates','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','5915408UXqDZg','CoinGecko\x20API\x20error:\x20','cny','stopPeriodicUpdates','xag','__esModule','allSettled','convertToUSDT','sats','myr','TesSoft\x20Payment\x20System/1.0','18TsfIku','entries','ltc','findUnique','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','ils','all','?ids=tether&vs_currencies=','default','currency','toUpperCase','try','getRatesStatus','usdt','twd','czk','inr','toFixed','bch','gel','Error\x20converting\x20',',\x20using\x201\x20as\x20fallback','convertMultipleToUSDT','mxn','application/json','brl','💱\x20Converted\x20','6133414tTnmrT','warn','updatedAt','rub','gbp','eth','pkr','currencyRate','xau','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','COINGECKO_URL','getMarkupPercentage','defineProperty','link','log','9ohUzpa','1203156AsnPJP','yfi','length','\x20currencies','ars','📊\x20Received\x20rates\x20for\x20','\x20USDT\x20(rate:\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','thb','Error\x20getting\x20all\x20rates:','map','💱\x20Applied\x20','\x20to\x20USDT:','\x20to\x20','sar'];a39_0x2324=function(){return _0x5b51a9;};return a39_0x2324();}const a39_0x4b6437=a39_0x1b73;(function(_0x5f4ae5,_0x1dffe7){const _0x2cecc2=a39_0x1b73,_0x1fafd6=_0x5f4ae5();while(!![]){try{const _0x23b6f1=parseInt(_0x2cecc2(0x158))/0x1+-parseInt(_0x2cecc2(0x13f))/0x2+-parseInt(_0x2cecc2(0x17c))/0x3*(-parseInt(_0x2cecc2(0x166))/0x4)+-parseInt(_0x2cecc2(0x149))/0x5+-parseInt(_0x2cecc2(0x12d))/0x6+parseInt(_0x2cecc2(0x11d))/0x7+parseInt(_0x2cecc2(0x171))/0x8*(-parseInt(_0x2cecc2(0x12c))/0x9);if(_0x23b6f1===_0x1dffe7)break;else _0x1fafd6['push'](_0x1fafd6['shift']());}catch(_0x1d8ff7){_0x1fafd6['push'](_0x1fafd6['shift']());}}}(a39_0x2324,0x7ad0e));var __importDefault=this&&this['__importDefault']||function(_0x333879){const _0x3a6c71=a39_0x1b73;return _0x333879&&_0x333879[_0x3a6c71(0x176)]?_0x333879:{'default':_0x333879};};function a39_0x1b73(_0x51d5d9,_0x38ec79){const _0x232491=a39_0x2324();return a39_0x1b73=function(_0x1b739d,_0x4db62c){_0x1b739d=_0x1b739d-0x10c;let _0x46b9f3=_0x232491[_0x1b739d];return _0x46b9f3;},a39_0x1b73(_0x51d5d9,_0x38ec79);}Object[a39_0x4b6437(0x129)](exports,'__esModule',{'value':!![]}),exports[a39_0x4b6437(0x14d)]=exports[a39_0x4b6437(0x142)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x406166=a39_0x4b6437;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x406166(0x16d),_0x406166(0x122),_0x406166(0x17e),_0x406166(0x114),'bnb',_0x406166(0x146),_0x406166(0x155),_0x406166(0x160),_0x406166(0x12a),'dot',_0x406166(0x12e),_0x406166(0x16e),_0x406166(0x159),_0x406166(0x131),'aud',_0x406166(0x14f),_0x406166(0x14b),'bmd',_0x406166(0x11b),'cad',_0x406166(0x156),_0x406166(0x153),_0x406166(0x173),_0x406166(0x111),_0x406166(0x161),_0x406166(0x141),_0x406166(0x121),_0x406166(0x115),_0x406166(0x147),_0x406166(0x16c),'idr',_0x406166(0x181),_0x406166(0x112),'jpy','krw',_0x406166(0x150),'lkr',_0x406166(0x165),_0x406166(0x119),_0x406166(0x17a),'ngn','nok',_0x406166(0x140),'php',_0x406166(0x123),_0x406166(0x13c),_0x406166(0x120),_0x406166(0x13b),'sek',_0x406166(0x157),_0x406166(0x135),_0x406166(0x10d),_0x406166(0x110),'uah','vef',_0x406166(0x15e),'zar',_0x406166(0x163),_0x406166(0x175),_0x406166(0x125),_0x406166(0x15b),_0x406166(0x179)],this[_0x406166(0x14e)]=null,this[_0x406166(0x168)]=0x3,this[_0x406166(0x16f)]();}['startPeriodicUpdates'](){const _0xc0b775=a39_0x4b6437;this[_0xc0b775(0x13e)]()[_0xc0b775(0x14c)](_0x544d0a=>{const _0x8db693=_0xc0b775;console[_0x8db693(0x144)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x544d0a);}),this[_0xc0b775(0x14e)]=setInterval(async()=>{const _0x13df39=_0xc0b775;try{await this[_0x13df39(0x13e)]();}catch(_0xcb2629){console[_0x13df39(0x144)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0xcb2629);}},0x3c*0x3c*0x3e8),console[_0xc0b775(0x12b)](_0xc0b775(0x134));}[a39_0x4b6437(0x174)](){const _0x481d37=a39_0x4b6437;this[_0x481d37(0x14e)]&&(clearInterval(this[_0x481d37(0x14e)]),this['updateInterval']=null,console[_0x481d37(0x12b)](_0x481d37(0x180)));}async[a39_0x4b6437(0x13e)](){const _0x3c30b4=a39_0x4b6437;try{console[_0x3c30b4(0x12b)](_0x3c30b4(0x170));const _0x4c886a=this['CURRENCIES']['join'](','),_0x55905f=this[_0x3c30b4(0x127)]+_0x3c30b4(0x183)+_0x4c886a,_0x2bde9b=await fetch(_0x55905f,{'headers':{'Accept':_0x3c30b4(0x11a),'User-Agent':_0x3c30b4(0x17b)}});if(!_0x2bde9b['ok'])throw new Error(_0x3c30b4(0x172)+_0x2bde9b['status']+'\x20'+_0x2bde9b['statusText']);const _0x242c72=await _0x2bde9b[_0x3c30b4(0x16a)]();if(!_0x242c72[_0x3c30b4(0x154)])throw new Error(_0x3c30b4(0x126));const _0x4c6368=_0x242c72[_0x3c30b4(0x154)];console[_0x3c30b4(0x12b)](_0x3c30b4(0x132)+Object[_0x3c30b4(0x152)](_0x4c6368)[_0x3c30b4(0x12f)]+_0x3c30b4(0x130));const _0x5ec6b1=Object[_0x3c30b4(0x17d)](_0x4c6368)[_0x3c30b4(0x137)](async([_0x1882b6,_0x40a62e])=>{const _0x438150=_0x3c30b4;try{await database_1[_0x438150(0x184)][_0x438150(0x124)][_0x438150(0x148)]({'where':{'currency':_0x1882b6['toLowerCase']()},'update':{'rate':_0x40a62e},'create':{'currency':_0x1882b6[_0x438150(0x15c)](),'rate':_0x40a62e}});}catch(_0x560b67){console[_0x438150(0x144)](_0x438150(0x14a)+_0x1882b6+':',_0x560b67);}});await Promise[_0x3c30b4(0x177)](_0x5ec6b1),console[_0x3c30b4(0x12b)](_0x3c30b4(0x162));}catch(_0x2cd075){console[_0x3c30b4(0x144)](_0x3c30b4(0x143),_0x2cd075);throw _0x2cd075;}}async['getCurrencyRate'](_0x59bc4c){const _0x51f955=a39_0x4b6437,_0x586ce1=_0x59bc4c[_0x51f955(0x15c)]();if(_0x586ce1==='usdt')return 0x1;try{const _0x270e1f=await database_1[_0x51f955(0x184)][_0x51f955(0x124)][_0x51f955(0x17f)]({'where':{'currency':_0x586ce1}});if(!_0x270e1f)return console[_0x51f955(0x11e)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x59bc4c+_0x51f955(0x117)),0x1;return _0x270e1f[_0x51f955(0x151)];}catch(_0x11f920){return console[_0x51f955(0x144)](_0x51f955(0x167)+_0x59bc4c+':',_0x11f920),0x1;}}async[a39_0x4b6437(0x178)](_0x5d0410,_0x207645){const _0x588434=a39_0x4b6437,_0x3027e1=_0x207645[_0x588434(0x15c)]();if(_0x3027e1===_0x588434(0x10f)){const _0x5b6543=_0x5d0410*(0x1+this[_0x588434(0x168)]/0x64);return console['log'](_0x588434(0x138)+this[_0x588434(0x168)]+_0x588434(0x164)+_0x5d0410+'\x20USDT\x20=\x20'+_0x5b6543[_0x588434(0x113)](0x6)+_0x588434(0x169)),_0x5b6543;}try{const _0x14f9ca=await this['getCurrencyRate'](_0x3027e1),_0x3cba22=_0x5d0410/_0x14f9ca,_0x1c46a4=_0x3cba22*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x588434(0x11c)+_0x5d0410+'\x20'+_0x207645[_0x588434(0x10c)]()+_0x588434(0x13a)+_0x3cba22[_0x588434(0x113)](0x6)+_0x588434(0x15f)+this[_0x588434(0x168)]+_0x588434(0x145)+_0x1c46a4[_0x588434(0x113)](0x6)+_0x588434(0x133)+_0x14f9ca+')'),_0x1c46a4;}catch(_0x4a14f9){console[_0x588434(0x144)](_0x588434(0x116)+_0x5d0410+'\x20'+_0x207645+_0x588434(0x139),_0x4a14f9);const _0x4f5d01=_0x5d0410*(0x1+this[_0x588434(0x168)]/0x64);return _0x4f5d01;}}async[a39_0x4b6437(0x118)](_0x3d1d48){const _0xc7ae2e=a39_0x4b6437;let _0x454b2c=0x0;for(const {amount:_0x1d21f5,currency:_0x59cd43}of _0x3d1d48){const _0x47e393=await this[_0xc7ae2e(0x178)](_0x1d21f5,_0x59cd43);_0x454b2c+=_0x47e393;}return _0x454b2c;}async['getAllRates'](){const _0x32ba08=a39_0x4b6437;try{const _0x5dcb06=await database_1[_0x32ba08(0x184)]['currencyRate'][_0x32ba08(0x15a)]({'select':{'currency':!![],'rate':!![]}}),_0x158b65={'usdt':0x1};return _0x5dcb06[_0x32ba08(0x13d)](_0x274a0e=>{const _0x82cc00=_0x32ba08;_0x158b65[_0x274a0e[_0x82cc00(0x185)]]=_0x274a0e[_0x82cc00(0x151)];}),_0x158b65;}catch(_0x231ade){return console[_0x32ba08(0x144)](_0x32ba08(0x136),_0x231ade),{'usdt':0x1};}}async[a39_0x4b6437(0x10e)](){const _0x4a4dc2=a39_0x4b6437;try{const [_0x3f8310,_0x51223a,_0x2996fd]=await Promise[_0x4a4dc2(0x182)]([database_1['default']['currencyRate']['count'](),database_1[_0x4a4dc2(0x184)][_0x4a4dc2(0x124)][_0x4a4dc2(0x15d)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x4a4dc2(0x184)][_0x4a4dc2(0x124)][_0x4a4dc2(0x15d)]({'orderBy':{'updatedAt':_0x4a4dc2(0x16b)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f8310,'lastUpdated':_0x51223a?.[_0x4a4dc2(0x11f)]||null,'oldestRate':_0x2996fd?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x20c47d){return console[_0x4a4dc2(0x144)]('Error\x20getting\x20rates\x20status:',_0x20c47d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4a4dc2(0x168)]};}}[a39_0x4b6437(0x128)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a39_0x4b6437(0x14d)]=new CurrencyService();