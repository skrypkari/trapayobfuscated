'use strict';const a38_0x23e37c=a38_0x2e03;(function(_0x50bab5,_0x2a73b1){const _0x530c3d=a38_0x2e03,_0x5699eb=_0x50bab5();while(!![]){try{const _0xd7a588=-parseInt(_0x530c3d(0xb9))/0x1*(parseInt(_0x530c3d(0xcc))/0x2)+parseInt(_0x530c3d(0x101))/0x3+parseInt(_0x530c3d(0xf0))/0x4*(parseInt(_0x530c3d(0xd2))/0x5)+-parseInt(_0x530c3d(0xf9))/0x6+-parseInt(_0x530c3d(0xbb))/0x7+-parseInt(_0x530c3d(0xf2))/0x8+-parseInt(_0x530c3d(0xaf))/0x9*(-parseInt(_0x530c3d(0xce))/0xa);if(_0xd7a588===_0x2a73b1)break;else _0x5699eb['push'](_0x5699eb['shift']());}catch(_0x5dcdb7){_0x5699eb['push'](_0x5699eb['shift']());}}}(a38_0x442f,0x931b9));var __importDefault=this&&this[a38_0x23e37c(0xd9)]||function(_0xcae870){const _0x3e11ba=a38_0x23e37c;return _0xcae870&&_0xcae870[_0x3e11ba(0xf1)]?_0xcae870:{'default':_0xcae870};};function a38_0x2e03(_0xda1512,_0x44d819){const _0x442f7d=a38_0x442f();return a38_0x2e03=function(_0x2e03da,_0x3396b7){_0x2e03da=_0x2e03da-0xa4;let _0xd4d993=_0x442f7d[_0x2e03da];return _0xd4d993;},a38_0x2e03(_0xda1512,_0x44d819);}Object[a38_0x23e37c(0xde)](exports,a38_0x23e37c(0xf1),{'value':!![]}),exports[a38_0x23e37c(0xbc)]=exports[a38_0x23e37c(0xaa)]=void 0x0;const database_1=__importDefault(require(a38_0x23e37c(0x106)));function a38_0x442f(){const _0x29f03c=['warn','xau','all','myr','lkr','272142xQLtIJ','asc','1790gTrFVh','length','krw','keys','115pfRLvw','vef','mxn','php','xrp','error','zar','__importDefault','thb','aed','allSettled','Error\x20converting\x20','defineProperty','convertMultipleToUSDT','toLowerCase','statusText','Error\x20getting\x20all\x20rates:','currency','czk','vnd','upsert','No\x20rate\x20found\x20for\x20currency:\x20','pln','\x20to\x20','https://api.coingecko.com/api/v3/simple/price','💱\x20Converted\x20','nzd','tether','cny','findFirst','100176iViiwA','__esModule','8629552xgPuVF','clp','sar','gbp','\x20USDT\x20(rate:\x20',',\x20using\x201\x20as\x20fallback','status','3160002PdSxdo','toUpperCase','COINGECKO_URL','convertToUSDT','updateCurrencyRates','rate','CURRENCIES','ils','1184010wEvlJs','%\x20markup\x20=\x20','bmd','huf','Error\x20getting\x20rate\x20for\x20currency\x20','../config/database','Error\x20getting\x20rates\x20status:','%\x20markup\x20to\x20','forEach','getCurrencyRate','findUnique','\x20to\x20USDT:','mmk','updateInterval','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','💱\x20Applied\x20','usd','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','jpy','currencyRate','entries','xag','default','?ids=tether&vs_currencies=','getAllRates','uah','Failed\x20to\x20update\x20rate\x20for\x20','CurrencyService','bits','toFixed','join','rub','146943tbVRiZ','bhd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','MARKUP_PERCENTAGE','catch','sgd','\x20USDT\x20=\x20','map','updatedAt','log','7EvtIud','bch','5129628khhCNb','currencyService','gel','\x20currencies','❌\x20Failed\x20to\x20update\x20currency\x20rates:','ltc','\x20USDT','✅\x20Currency\x20rates\x20updated\x20successfully','startPeriodicUpdates','eos','try','eur'];a38_0x442f=function(){return _0x29f03c;};return a38_0x442f();}class CurrencyService{constructor(){const _0x15cd05=a38_0x23e37c;this[_0x15cd05(0xfb)]=_0x15cd05(0xea),this['CURRENCIES']=['btc','eth',_0x15cd05(0xc0),_0x15cd05(0xba),'bnb',_0x15cd05(0xc4),_0x15cd05(0xd6),'xlm','link','dot','yfi',_0x15cd05(0x111),_0x15cd05(0xdb),'ars','aud','bdt',_0x15cd05(0xb0),_0x15cd05(0x103),'brl','cad','chf',_0x15cd05(0xf3),_0x15cd05(0xee),_0x15cd05(0xe4),'dkk',_0x15cd05(0xc6),_0x15cd05(0xf5),_0x15cd05(0xbd),'hkd',_0x15cd05(0x104),'idr',_0x15cd05(0x100),'inr',_0x15cd05(0x113),_0x15cd05(0xd0),'kwd',_0x15cd05(0xcb),_0x15cd05(0x10d),_0x15cd05(0xd4),_0x15cd05(0xca),'ngn','nok',_0x15cd05(0xec),_0x15cd05(0xd5),'pkr',_0x15cd05(0xe8),_0x15cd05(0xae),_0x15cd05(0xf4),'sek',_0x15cd05(0xb4),_0x15cd05(0xda),_0x15cd05(0xc5),'twd',_0x15cd05(0xa8),_0x15cd05(0xd3),_0x15cd05(0xe5),_0x15cd05(0xd8),'xdr',_0x15cd05(0xa4),_0x15cd05(0xc8),_0x15cd05(0xab),'sats'],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this['startPeriodicUpdates']();}[a38_0x23e37c(0xc3)](){const _0x158ecf=a38_0x23e37c;this[_0x158ecf(0xfd)]()[_0x158ecf(0xb3)](_0x4a267d=>{const _0x37eb73=_0x158ecf;console[_0x37eb73(0xd7)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x4a267d);}),this[_0x158ecf(0x10e)]=setInterval(async()=>{const _0x202b7d=_0x158ecf;try{await this[_0x202b7d(0xfd)]();}catch(_0x205b0d){console[_0x202b7d(0xd7)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x205b0d);}},0x3c*0x3c*0x3e8),console[_0x158ecf(0xb8)](_0x158ecf(0xb1));}['stopPeriodicUpdates'](){const _0x184805=a38_0x23e37c;this['updateInterval']&&(clearInterval(this[_0x184805(0x10e)]),this[_0x184805(0x10e)]=null,console[_0x184805(0xb8)](_0x184805(0x10f)));}async[a38_0x23e37c(0xfd)](){const _0xf16a91=a38_0x23e37c;try{console['log'](_0xf16a91(0x112));const _0x51860b=this[_0xf16a91(0xff)][_0xf16a91(0xad)](','),_0x3df0b4=this[_0xf16a91(0xfb)]+_0xf16a91(0xa6)+_0x51860b,_0x39e8d1=await fetch(_0x3df0b4,{'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x39e8d1['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x39e8d1[_0xf16a91(0xf8)]+'\x20'+_0x39e8d1[_0xf16a91(0xe1)]);const _0x34d275=await _0x39e8d1['json']();if(!_0x34d275[_0xf16a91(0xed)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x7292e=_0x34d275['tether'];console[_0xf16a91(0xb8)]('📊\x20Received\x20rates\x20for\x20'+Object[_0xf16a91(0xd1)](_0x7292e)[_0xf16a91(0xcf)]+_0xf16a91(0xbe));const _0x194e7a=Object[_0xf16a91(0x115)](_0x7292e)[_0xf16a91(0xb6)](async([_0x297646,_0x332dba])=>{const _0xc9ee76=_0xf16a91;try{await database_1['default'][_0xc9ee76(0x114)][_0xc9ee76(0xe6)]({'where':{'currency':_0x297646[_0xc9ee76(0xe0)]()},'update':{'rate':_0x332dba},'create':{'currency':_0x297646[_0xc9ee76(0xe0)](),'rate':_0x332dba}});}catch(_0x399e43){console[_0xc9ee76(0xd7)](_0xc9ee76(0xa9)+_0x297646+':',_0x399e43);}});await Promise[_0xf16a91(0xdc)](_0x194e7a),console[_0xf16a91(0xb8)](_0xf16a91(0xc2));}catch(_0x53b64c){console['error'](_0xf16a91(0xbf),_0x53b64c);throw _0x53b64c;}}async[a38_0x23e37c(0x10a)](_0x23ebf3){const _0x3a977a=a38_0x23e37c,_0x4eb1e2=_0x23ebf3[_0x3a977a(0xe0)]();if(_0x4eb1e2==='usdt')return 0x1;try{const _0x937da4=await database_1[_0x3a977a(0xa5)][_0x3a977a(0x114)][_0x3a977a(0x10b)]({'where':{'currency':_0x4eb1e2}});if(!_0x937da4)return console[_0x3a977a(0xc7)](_0x3a977a(0xe7)+_0x23ebf3+_0x3a977a(0xf7)),0x1;return _0x937da4['rate'];}catch(_0x3f717a){return console[_0x3a977a(0xd7)](_0x3a977a(0x105)+_0x23ebf3+':',_0x3f717a),0x1;}}async[a38_0x23e37c(0xfc)](_0x32b54d,_0x4e975a){const _0x527d8c=a38_0x23e37c,_0x2d0e58=_0x4e975a[_0x527d8c(0xe0)]();if(_0x2d0e58==='usdt'){const _0x373551=_0x32b54d*(0x1+this[_0x527d8c(0xb2)]/0x64);return console[_0x527d8c(0xb8)](_0x527d8c(0x110)+this['MARKUP_PERCENTAGE']+_0x527d8c(0x108)+_0x32b54d+_0x527d8c(0xb5)+_0x373551[_0x527d8c(0xac)](0x6)+_0x527d8c(0xc1)),_0x373551;}try{const _0x1e77a1=await this['getCurrencyRate'](_0x2d0e58),_0x3e2b65=_0x32b54d/_0x1e77a1,_0x4d3760=_0x3e2b65*(0x1+this[_0x527d8c(0xb2)]/0x64);return console[_0x527d8c(0xb8)](_0x527d8c(0xeb)+_0x32b54d+'\x20'+_0x4e975a[_0x527d8c(0xfa)]()+_0x527d8c(0xe9)+_0x3e2b65[_0x527d8c(0xac)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0x527d8c(0x102)+_0x4d3760[_0x527d8c(0xac)](0x6)+_0x527d8c(0xf6)+_0x1e77a1+')'),_0x4d3760;}catch(_0x53007d){console[_0x527d8c(0xd7)](_0x527d8c(0xdd)+_0x32b54d+'\x20'+_0x4e975a+_0x527d8c(0x10c),_0x53007d);const _0x5dea8f=_0x32b54d*(0x1+this[_0x527d8c(0xb2)]/0x64);return _0x5dea8f;}}async[a38_0x23e37c(0xdf)](_0x52ce45){const _0x2951cc=a38_0x23e37c;let _0x40be92=0x0;for(const {amount:_0x12d859,currency:_0x4661e0}of _0x52ce45){const _0x1f2912=await this[_0x2951cc(0xfc)](_0x12d859,_0x4661e0);_0x40be92+=_0x1f2912;}return _0x40be92;}async[a38_0x23e37c(0xa7)](){const _0x17d77f=a38_0x23e37c;try{const _0x75e8=await database_1[_0x17d77f(0xa5)][_0x17d77f(0x114)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x58cd4a={'usdt':0x1};return _0x75e8[_0x17d77f(0x109)](_0x2c3775=>{const _0x17fe99=_0x17d77f;_0x58cd4a[_0x2c3775[_0x17fe99(0xe3)]]=_0x2c3775[_0x17fe99(0xfe)];}),_0x58cd4a;}catch(_0x3cc659){return console['error'](_0x17d77f(0xe2),_0x3cc659),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4cc4e2=a38_0x23e37c;try{const [_0x43d6e9,_0x302072,_0x53339d]=await Promise[_0x4cc4e2(0xc9)]([database_1['default'][_0x4cc4e2(0x114)]['count'](),database_1['default']['currencyRate'][_0x4cc4e2(0xef)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x4cc4e2(0x114)][_0x4cc4e2(0xef)]({'orderBy':{'updatedAt':_0x4cc4e2(0xcd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x43d6e9,'lastUpdated':_0x302072?.[_0x4cc4e2(0xb7)]||null,'oldestRate':_0x53339d?.[_0x4cc4e2(0xb7)]||null,'markupPercentage':this[_0x4cc4e2(0xb2)]};}catch(_0x564f95){return console['error'](_0x4cc4e2(0x107),_0x564f95),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4cc4e2(0xb2)]};}}['getMarkupPercentage'](){const _0x59379d=a38_0x23e37c;return this[_0x59379d(0xb2)];}}exports[a38_0x23e37c(0xaa)]=CurrencyService,exports['currencyService']=new CurrencyService();