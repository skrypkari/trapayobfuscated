'use strict';const a38_0x5e1c49=a38_0x318b;(function(_0x5219bf,_0x20c4a9){const _0x41a391=a38_0x318b,_0x11bb89=_0x5219bf();while(!![]){try{const _0x25d83f=-parseInt(_0x41a391(0x251))/0x1*(-parseInt(_0x41a391(0x202))/0x2)+parseInt(_0x41a391(0x214))/0x3+-parseInt(_0x41a391(0x207))/0x4*(parseInt(_0x41a391(0x20b))/0x5)+parseInt(_0x41a391(0x1fd))/0x6+-parseInt(_0x41a391(0x20e))/0x7*(parseInt(_0x41a391(0x25d))/0x8)+-parseInt(_0x41a391(0x1ef))/0x9*(parseInt(_0x41a391(0x21c))/0xa)+parseInt(_0x41a391(0x25a))/0xb*(parseInt(_0x41a391(0x237))/0xc);if(_0x25d83f===_0x20c4a9)break;else _0x11bb89['push'](_0x11bb89['shift']());}catch(_0x484311){_0x11bb89['push'](_0x11bb89['shift']());}}}(a38_0x2cba,0x31ffc));var __importDefault=this&&this['__importDefault']||function(_0x415558){const _0x1cbf59=a38_0x318b;return _0x415558&&_0x415558[_0x1cbf59(0x22f)]?_0x415558:{'default':_0x415558};};Object[a38_0x5e1c49(0x1ec)](exports,a38_0x5e1c49(0x22f),{'value':!![]}),exports[a38_0x5e1c49(0x206)]=exports[a38_0x5e1c49(0x224)]=void 0x0;const database_1=__importDefault(require(a38_0x5e1c49(0x243)));function a38_0x318b(_0x489955,_0x4843f7){const _0x2cba6a=a38_0x2cba();return a38_0x318b=function(_0x318b1f,_0x83166d){_0x318b1f=_0x318b1f-0x1e7;let _0xc94a11=_0x2cba6a[_0x318b1f];return _0xc94a11;},a38_0x318b(_0x489955,_0x4843f7);}class CurrencyService{constructor(){const _0x67ebe3=a38_0x5e1c49;this[_0x67ebe3(0x23a)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=['btc',_0x67ebe3(0x23e),'ltc',_0x67ebe3(0x238),'bnb',_0x67ebe3(0x254),_0x67ebe3(0x255),_0x67ebe3(0x1f7),'link','dot',_0x67ebe3(0x245),'usd',_0x67ebe3(0x20a),_0x67ebe3(0x218),_0x67ebe3(0x203),'bdt',_0x67ebe3(0x216),'bmd',_0x67ebe3(0x211),'cad',_0x67ebe3(0x225),_0x67ebe3(0x210),_0x67ebe3(0x246),_0x67ebe3(0x229),_0x67ebe3(0x260),_0x67ebe3(0x247),_0x67ebe3(0x242),'gel',_0x67ebe3(0x249),'huf',_0x67ebe3(0x230),'ils',_0x67ebe3(0x21b),'jpy',_0x67ebe3(0x20f),_0x67ebe3(0x1f0),_0x67ebe3(0x1ea),_0x67ebe3(0x248),_0x67ebe3(0x1e8),_0x67ebe3(0x215),_0x67ebe3(0x252),'nok','nzd',_0x67ebe3(0x234),_0x67ebe3(0x209),'pln',_0x67ebe3(0x233),_0x67ebe3(0x250),_0x67ebe3(0x22d),'sgd',_0x67ebe3(0x1f6),_0x67ebe3(0x258),_0x67ebe3(0x25b),_0x67ebe3(0x1f5),_0x67ebe3(0x212),_0x67ebe3(0x223),_0x67ebe3(0x20c),'xdr',_0x67ebe3(0x208),_0x67ebe3(0x244),'bits','sats'],this[_0x67ebe3(0x24a)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x67ebe3(0x1e7)]();}[a38_0x5e1c49(0x1e7)](){const _0x27a012=a38_0x5e1c49;this[_0x27a012(0x1f9)]()['catch'](_0x3812a5=>{const _0xf28c45=_0x27a012;console[_0xf28c45(0x23b)](_0xf28c45(0x1f2),_0x3812a5);}),this[_0x27a012(0x24a)]=setInterval(async()=>{const _0x3abeed=_0x27a012;try{await this[_0x3abeed(0x1f9)]();}catch(_0x327ca5){console[_0x3abeed(0x23b)](_0x3abeed(0x1f8),_0x327ca5);}},0x3c*0x3c*0x3e8),console[_0x27a012(0x217)](_0x27a012(0x1f3));}[a38_0x5e1c49(0x226)](){const _0x529550=a38_0x5e1c49;this[_0x529550(0x24a)]&&(clearInterval(this['updateInterval']),this[_0x529550(0x24a)]=null,console[_0x529550(0x217)](_0x529550(0x241)));}async[a38_0x5e1c49(0x1f9)](){const _0x3c07b1=a38_0x5e1c49;try{console[_0x3c07b1(0x217)](_0x3c07b1(0x222));const _0x25b6cb=this[_0x3c07b1(0x213)][_0x3c07b1(0x220)](','),_0x3fb9bc=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x25b6cb,_0x53233b=await fetch(_0x3fb9bc,{'headers':{'Accept':_0x3c07b1(0x23c),'User-Agent':_0x3c07b1(0x25f)}});if(!_0x53233b['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x53233b[_0x3c07b1(0x1f4)]+'\x20'+_0x53233b[_0x3c07b1(0x1ff)]);const _0x1e2e52=await _0x53233b[_0x3c07b1(0x221)]();if(!_0x1e2e52['tether'])throw new Error(_0x3c07b1(0x236));const _0xbfaa1d=_0x1e2e52[_0x3c07b1(0x204)];console['log'](_0x3c07b1(0x20d)+Object[_0x3c07b1(0x239)](_0xbfaa1d)[_0x3c07b1(0x1fb)]+_0x3c07b1(0x22a));const _0x38062a=Object[_0x3c07b1(0x1fe)](_0xbfaa1d)['map'](async([_0x570211,_0x4f9799])=>{const _0x2376b5=_0x3c07b1;try{await database_1[_0x2376b5(0x1f1)][_0x2376b5(0x205)]['upsert']({'where':{'currency':_0x570211[_0x2376b5(0x1eb)]()},'update':{'rate':_0x4f9799},'create':{'currency':_0x570211['toLowerCase'](),'rate':_0x4f9799}});}catch(_0x2ed0e7){console[_0x2376b5(0x23b)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x570211+':',_0x2ed0e7);}});await Promise[_0x3c07b1(0x23d)](_0x38062a),console[_0x3c07b1(0x217)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x47fe6b){console[_0x3c07b1(0x23b)](_0x3c07b1(0x240),_0x47fe6b);throw _0x47fe6b;}}async['getCurrencyRate'](_0x5cc248){const _0x3fa9e4=a38_0x5e1c49,_0x5cd2df=_0x5cc248[_0x3fa9e4(0x1eb)]();if(_0x5cd2df==='usdt')return 0x1;try{const _0x1bf9d8=await database_1[_0x3fa9e4(0x1f1)][_0x3fa9e4(0x205)][_0x3fa9e4(0x227)]({'where':{'currency':_0x5cd2df}});if(!_0x1bf9d8)return console[_0x3fa9e4(0x1ed)](_0x3fa9e4(0x25c)+_0x5cc248+_0x3fa9e4(0x259)),0x1;return _0x1bf9d8[_0x3fa9e4(0x231)];}catch(_0x2dfc1b){return console[_0x3fa9e4(0x23b)](_0x3fa9e4(0x21e)+_0x5cc248+':',_0x2dfc1b),0x1;}}async[a38_0x5e1c49(0x24e)](_0x31f8c4,_0x510b9f){const _0x128e46=a38_0x5e1c49,_0x5538d4=_0x510b9f[_0x128e46(0x1eb)]();if(_0x5538d4==='usdt'){const _0x1b5022=_0x31f8c4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x128e46(0x217)](_0x128e46(0x23f)+this[_0x128e46(0x22c)]+_0x128e46(0x22e)+_0x31f8c4+_0x128e46(0x261)+_0x1b5022['toFixed'](0x6)+_0x128e46(0x25e)),_0x1b5022;}try{const _0x25a064=await this[_0x128e46(0x24b)](_0x5538d4),_0x1ec204=_0x31f8c4/_0x25a064,_0x45111e=_0x1ec204*(0x1+this[_0x128e46(0x22c)]/0x64);return console[_0x128e46(0x217)](_0x128e46(0x1e9)+_0x31f8c4+'\x20'+_0x510b9f[_0x128e46(0x21f)]()+_0x128e46(0x228)+_0x1ec204[_0x128e46(0x22b)](0x6)+_0x128e46(0x24d)+this['MARKUP_PERCENTAGE']+_0x128e46(0x256)+_0x45111e[_0x128e46(0x22b)](0x6)+'\x20USDT\x20(rate:\x20'+_0x25a064+')'),_0x45111e;}catch(_0x9c6e5e){console[_0x128e46(0x23b)](_0x128e46(0x24f)+_0x31f8c4+'\x20'+_0x510b9f+'\x20to\x20USDT:',_0x9c6e5e);const _0x2cd83e=_0x31f8c4*(0x1+this[_0x128e46(0x22c)]/0x64);return _0x2cd83e;}}async[a38_0x5e1c49(0x1fa)](_0x58e6c9){const _0x3c9f4d=a38_0x5e1c49;let _0x1d10d4=0x0;for(const {amount:_0x3e1c9e,currency:_0x4238ee}of _0x58e6c9){const _0x5eea87=await this[_0x3c9f4d(0x24e)](_0x3e1c9e,_0x4238ee);_0x1d10d4+=_0x5eea87;}return _0x1d10d4;}async[a38_0x5e1c49(0x24c)](){const _0x520e8c=a38_0x5e1c49;try{const _0x5e5294=await database_1[_0x520e8c(0x1f1)][_0x520e8c(0x205)][_0x520e8c(0x1ee)]({'select':{'currency':!![],'rate':!![]}}),_0x101baf={'usdt':0x1};return _0x5e5294[_0x520e8c(0x253)](_0x1fbef4=>{const _0x2f1a5d=_0x520e8c;_0x101baf[_0x1fbef4['currency']]=_0x1fbef4[_0x2f1a5d(0x231)];}),_0x101baf;}catch(_0x5a89a8){return console[_0x520e8c(0x23b)](_0x520e8c(0x1fc),_0x5a89a8),{'usdt':0x1};}}async[a38_0x5e1c49(0x257)](){const _0x45bb57=a38_0x5e1c49;try{const [_0x2f1966,_0x2dfcfb,_0x10b79e]=await Promise[_0x45bb57(0x200)]([database_1[_0x45bb57(0x1f1)]['currencyRate'][_0x45bb57(0x21d)](),database_1[_0x45bb57(0x1f1)][_0x45bb57(0x205)]['findFirst']({'orderBy':{'updatedAt':_0x45bb57(0x219)},'select':{'updatedAt':!![]}}),database_1['default'][_0x45bb57(0x205)][_0x45bb57(0x201)]({'orderBy':{'updatedAt':_0x45bb57(0x235)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2f1966,'lastUpdated':_0x2dfcfb?.[_0x45bb57(0x232)]||null,'oldestRate':_0x10b79e?.['updatedAt']||null,'markupPercentage':this[_0x45bb57(0x22c)]};}catch(_0x53ceac){return console[_0x45bb57(0x23b)](_0x45bb57(0x21a),_0x53ceac),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x45bb57(0x22c)]};}}['getMarkupPercentage'](){const _0x4136eb=a38_0x5e1c49;return this[_0x4136eb(0x22c)];}}exports[a38_0x5e1c49(0x224)]=CurrencyService,exports['currencyService']=new CurrencyService();function a38_0x2cba(){const _0x15e59c=['status','uah','thb','xlm','Periodic\x20currency\x20rates\x20update\x20failed:','updateCurrencyRates','convertMultipleToUSDT','length','Error\x20getting\x20all\x20rates:','1432968PReMOu','entries','statusText','all','findFirst','28238pINOwK','aud','tether','currencyRate','currencyService','626524zHbfkq','xag','pkr','aed','10acKfhe','zar','üìä\x20Received\x20rates\x20for\x20','675738nqmZCc','krw','clp','brl','vef','CURRENCIES','431799gzSbnl','myr','bhd','log','ars','desc','Error\x20getting\x20rates\x20status:','inr','10NZYJnQ','count','Error\x20getting\x20rate\x20for\x20currency\x20','toUpperCase','join','json','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','vnd','CurrencyService','chf','stopPeriodicUpdates','findUnique','\x20to\x20','czk','\x20currencies','toFixed','MARKUP_PERCENTAGE','sek','%\x20markup\x20to\x20','__esModule','idr','rate','updatedAt','rub','php','asc','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','672wFnFDt','bch','keys','COINGECKO_URL','error','application/json','allSettled','eth','üí±\x20Applied\x20','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','gbp','../config/database','xau','yfi','cny','eur','mmk','hkd','updateInterval','getCurrencyRate','getAllRates','\x20USDT,\x20with\x20','convertToUSDT','Error\x20converting\x20','sar','10uDAlCq','ngn','forEach','eos','xrp','%\x20markup\x20=\x20','getRatesStatus','try',',\x20using\x201\x20as\x20fallback','82819qdzNro','twd','No\x20rate\x20found\x20for\x20currency:\x20','8jaPmxo','\x20USDT','TesSoft\x20Payment\x20System/1.0','dkk','\x20USDT\x20=\x20','startPeriodicUpdates','mxn','üí±\x20Converted\x20','lkr','toLowerCase','defineProperty','warn','findMany','2978847UKSadN','kwd','default','Initial\x20currency\x20rates\x20update\x20failed:','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates'];a38_0x2cba=function(){return _0x15e59c;};return a38_0x2cba();}