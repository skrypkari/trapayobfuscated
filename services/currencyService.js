'use strict';const a38_0x4204e2=a38_0x55be;(function(_0x5c1ff2,_0x570c6d){const _0x2b8abb=a38_0x55be,_0x3b9f6=_0x5c1ff2();while(!![]){try{const _0x137d95=-parseInt(_0x2b8abb(0x15b))/0x1*(-parseInt(_0x2b8abb(0x185))/0x2)+-parseInt(_0x2b8abb(0x192))/0x3*(parseInt(_0x2b8abb(0x14c))/0x4)+-parseInt(_0x2b8abb(0x170))/0x5*(parseInt(_0x2b8abb(0x1ad))/0x6)+-parseInt(_0x2b8abb(0x171))/0x7+-parseInt(_0x2b8abb(0x142))/0x8+parseInt(_0x2b8abb(0x145))/0x9*(parseInt(_0x2b8abb(0x14e))/0xa)+parseInt(_0x2b8abb(0x19f))/0xb;if(_0x137d95===_0x570c6d)break;else _0x3b9f6['push'](_0x3b9f6['shift']());}catch(_0x1b7c9a){_0x3b9f6['push'](_0x3b9f6['shift']());}}}(a38_0x25d8,0xaba2c));var __importDefault=this&&this['__importDefault']||function(_0x24f697){const _0x486bdf=a38_0x55be;return _0x24f697&&_0x24f697[_0x486bdf(0x15a)]?_0x24f697:{'default':_0x24f697};};Object[a38_0x4204e2(0x182)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a38_0x4204e2(0x148)]=void 0x0;function a38_0x55be(_0x441190,_0x23cb95){const _0x25d8bc=a38_0x25d8();return a38_0x55be=function(_0x55be5f,_0x43cf5a){_0x55be5f=_0x55be5f-0x134;let _0x1a4ded=_0x25d8bc[_0x55be5f];return _0x1a4ded;},a38_0x55be(_0x441190,_0x23cb95);}const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x468f8d=a38_0x4204e2;this[_0x468f8d(0x15c)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x468f8d(0x165),_0x468f8d(0x139),_0x468f8d(0x180),_0x468f8d(0x173),_0x468f8d(0x17f),_0x468f8d(0x18d),'xrp','xlm',_0x468f8d(0x157),'dot',_0x468f8d(0x1ac),_0x468f8d(0x166),_0x468f8d(0x19e),_0x468f8d(0x181),'aud',_0x468f8d(0x169),_0x468f8d(0x15f),_0x468f8d(0x18b),_0x468f8d(0x16d),'cad',_0x468f8d(0x16f),_0x468f8d(0x153),_0x468f8d(0x172),_0x468f8d(0x16c),_0x468f8d(0x168),_0x468f8d(0x15d),'gbp',_0x468f8d(0x1a3),'hkd',_0x468f8d(0x13c),_0x468f8d(0x144),_0x468f8d(0x198),_0x468f8d(0x17e),_0x468f8d(0x158),_0x468f8d(0x190),_0x468f8d(0x19c),_0x468f8d(0x17c),'mmk',_0x468f8d(0x191),_0x468f8d(0x149),'ngn',_0x468f8d(0x197),_0x468f8d(0x13e),'php',_0x468f8d(0x159),_0x468f8d(0x16b),'rub','sar',_0x468f8d(0x189),_0x468f8d(0x14a),_0x468f8d(0x186),_0x468f8d(0x163),_0x468f8d(0x160),_0x468f8d(0x14b),_0x468f8d(0x17d),_0x468f8d(0x1a4),'zar','xdr','xag',_0x468f8d(0x13b),_0x468f8d(0x155),_0x468f8d(0x13d)],this[_0x468f8d(0x178)]=null,this[_0x468f8d(0x196)]=0x3,this['startPeriodicUpdates']();}[a38_0x4204e2(0x137)](){const _0x39bebe=a38_0x4204e2;this[_0x39bebe(0x161)]()[_0x39bebe(0x134)](_0xdba2c5=>{const _0x422b18=_0x39bebe;console[_0x422b18(0x147)](_0x422b18(0x17b),_0xdba2c5);}),this[_0x39bebe(0x178)]=setInterval(async()=>{const _0x5940b1=_0x39bebe;try{await this['updateCurrencyRates']();}catch(_0x2966d3){console[_0x5940b1(0x147)](_0x5940b1(0x193),_0x2966d3);}},0x3c*0x3c*0x3e8),console[_0x39bebe(0x19a)](_0x39bebe(0x135));}[a38_0x4204e2(0x162)](){const _0x3a7981=a38_0x4204e2;this[_0x3a7981(0x178)]&&(clearInterval(this[_0x3a7981(0x178)]),this['updateInterval']=null,console[_0x3a7981(0x19a)](_0x3a7981(0x1a9)));}async[a38_0x4204e2(0x161)](){const _0xad24b8=a38_0x4204e2;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x93c2b4=this['CURRENCIES'][_0xad24b8(0x175)](','),_0x393f02=this[_0xad24b8(0x15c)]+_0xad24b8(0x156)+_0x93c2b4,_0xe0f646=await fetch(_0x393f02,{'headers':{'Accept':_0xad24b8(0x1a1),'User-Agent':_0xad24b8(0x136)}});if(!_0xe0f646['ok'])throw new Error(_0xad24b8(0x19b)+_0xe0f646[_0xad24b8(0x174)]+'\x20'+_0xe0f646[_0xad24b8(0x16a)]);const _0x5b1569=await _0xe0f646[_0xad24b8(0x1aa)]();if(!_0x5b1569[_0xad24b8(0x18a)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x176379=_0x5b1569[_0xad24b8(0x18a)];console[_0xad24b8(0x19a)](_0xad24b8(0x167)+Object[_0xad24b8(0x164)](_0x176379)[_0xad24b8(0x18c)]+_0xad24b8(0x143));const _0x644099=Object[_0xad24b8(0x188)](_0x176379)[_0xad24b8(0x151)](async([_0x4ea700,_0x355771])=>{const _0x3948ab=_0xad24b8;try{await database_1[_0x3948ab(0x1ab)][_0x3948ab(0x138)]['upsert']({'where':{'currency':_0x4ea700['toLowerCase']()},'update':{'rate':_0x355771},'create':{'currency':_0x4ea700[_0x3948ab(0x146)](),'rate':_0x355771}});}catch(_0x17a6e2){console[_0x3948ab(0x147)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x4ea700+':',_0x17a6e2);}});await Promise[_0xad24b8(0x195)](_0x644099),console[_0xad24b8(0x19a)](_0xad24b8(0x1a8));}catch(_0x22e0f3){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x22e0f3);throw _0x22e0f3;}}async[a38_0x4204e2(0x184)](_0x2b6959){const _0x158d63=a38_0x4204e2,_0x1c7f74=_0x2b6959[_0x158d63(0x146)]();if(_0x1c7f74===_0x158d63(0x154))return 0x1;try{const _0x39fe15=await database_1[_0x158d63(0x1ab)][_0x158d63(0x138)]['findUnique']({'where':{'currency':_0x1c7f74}});if(!_0x39fe15)return console[_0x158d63(0x1a2)](_0x158d63(0x14d)+_0x2b6959+',\x20using\x201\x20as\x20fallback'),0x1;return _0x39fe15[_0x158d63(0x1a5)];}catch(_0x4e1c26){return console[_0x158d63(0x147)](_0x158d63(0x183)+_0x2b6959+':',_0x4e1c26),0x1;}}async['convertToUSDT'](_0x51087d,_0x38e6ac){const _0x36c72e=a38_0x4204e2,_0x569de1=_0x38e6ac[_0x36c72e(0x146)]();if(_0x569de1===_0x36c72e(0x154)){const _0x1bc3e2=_0x51087d*(0x1+this[_0x36c72e(0x196)]/0x64);return console['log']('💱\x20Applied\x20'+this[_0x36c72e(0x196)]+_0x36c72e(0x18e)+_0x51087d+'\x20USDT\x20=\x20'+_0x1bc3e2[_0x36c72e(0x16e)](0x6)+_0x36c72e(0x177)),_0x1bc3e2;}try{const _0x6daed5=await this[_0x36c72e(0x184)](_0x569de1),_0x2868c8=_0x51087d/_0x6daed5,_0x567fe7=_0x2868c8*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x36c72e(0x179)+_0x51087d+'\x20'+_0x38e6ac['toUpperCase']()+_0x36c72e(0x14f)+_0x2868c8[_0x36c72e(0x16e)](0x6)+'\x20USDT,\x20with\x20'+this[_0x36c72e(0x196)]+_0x36c72e(0x140)+_0x567fe7[_0x36c72e(0x16e)](0x6)+_0x36c72e(0x176)+_0x6daed5+')'),_0x567fe7;}catch(_0x17efb6){console[_0x36c72e(0x147)]('Error\x20converting\x20'+_0x51087d+'\x20'+_0x38e6ac+'\x20to\x20USDT:',_0x17efb6);const _0x12dea0=_0x51087d*(0x1+this[_0x36c72e(0x196)]/0x64);return _0x12dea0;}}async[a38_0x4204e2(0x194)](_0x3ccf64){const _0xa143b9=a38_0x4204e2;let _0xf17c6b=0x0;for(const {amount:_0x2fc66b,currency:_0x39b5fe}of _0x3ccf64){const _0x188ab6=await this[_0xa143b9(0x19d)](_0x2fc66b,_0x39b5fe);_0xf17c6b+=_0x188ab6;}return _0xf17c6b;}async['getAllRates'](){const _0x91bcea=a38_0x4204e2;try{const _0x5ef8b4=await database_1['default'][_0x91bcea(0x138)][_0x91bcea(0x150)]({'select':{'currency':!![],'rate':!![]}}),_0x28f813={'usdt':0x1};return _0x5ef8b4[_0x91bcea(0x199)](_0xf92bfd=>{const _0x21ba66=_0x91bcea;_0x28f813[_0xf92bfd[_0x21ba66(0x18f)]]=_0xf92bfd[_0x21ba66(0x1a5)];}),_0x28f813;}catch(_0x4ac5be){return console[_0x91bcea(0x147)](_0x91bcea(0x187),_0x4ac5be),{'usdt':0x1};}}async[a38_0x4204e2(0x152)](){const _0x324c5e=a38_0x4204e2;try{const [_0x342d4b,_0x499025,_0x3d7ec9]=await Promise[_0x324c5e(0x15e)]([database_1[_0x324c5e(0x1ab)][_0x324c5e(0x138)][_0x324c5e(0x1a7)](),database_1[_0x324c5e(0x1ab)][_0x324c5e(0x138)][_0x324c5e(0x13a)]({'orderBy':{'updatedAt':_0x324c5e(0x1a0)},'select':{'updatedAt':!![]}}),database_1[_0x324c5e(0x1ab)][_0x324c5e(0x138)][_0x324c5e(0x13a)]({'orderBy':{'updatedAt':_0x324c5e(0x17a)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x342d4b,'lastUpdated':_0x499025?.[_0x324c5e(0x1a6)]||null,'oldestRate':_0x3d7ec9?.[_0x324c5e(0x1a6)]||null,'markupPercentage':this[_0x324c5e(0x196)]};}catch(_0x189ff2){return console[_0x324c5e(0x147)](_0x324c5e(0x13f),_0x189ff2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x324c5e(0x196)]};}}['getMarkupPercentage'](){const _0x4c1a88=a38_0x4204e2;return this[_0x4c1a88(0x196)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x4204e2(0x141)]=new CurrencyService();function a38_0x25d8(){const _0x46b64b=['toLowerCase','error','CurrencyService','myr','sgd','uah','4BYZAdq','No\x20rate\x20found\x20for\x20currency:\x20','30BvkXAx','\x20to\x20','findMany','map','getRatesStatus','clp','usdt','bits','?ids=tether&vs_currencies=','link','jpy','pkr','__esModule','624126utCzNo','COINGECKO_URL','eur','all','bhd','twd','updateCurrencyRates','stopPeriodicUpdates','try','keys','btc','usd','📊\x20Received\x20rates\x20for\x20','dkk','bdt','statusText','pln','czk','brl','toFixed','chf','5XHEqhy','3755815WzJFVy','cny','bch','status','join','\x20USDT\x20(rate:\x20','\x20USDT','updateInterval','💱\x20Converted\x20','asc','Initial\x20currency\x20rates\x20update\x20failed:','lkr','vef','inr','bnb','ltc','ars','defineProperty','Error\x20getting\x20rate\x20for\x20currency\x20','getCurrencyRate','4EYoVIO','thb','Error\x20getting\x20all\x20rates:','entries','sek','tether','bmd','length','eos','%\x20markup\x20to\x20','currency','krw','mxn','598749CnRCZq','Periodic\x20currency\x20rates\x20update\x20failed:','convertMultipleToUSDT','allSettled','MARKUP_PERCENTAGE','nok','ils','forEach','log','CoinGecko\x20API\x20error:\x20','kwd','convertToUSDT','aed','29466305HwMiCn','desc','application/json','warn','gel','vnd','rate','updatedAt','count','✅\x20Currency\x20rates\x20updated\x20successfully','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','json','default','yfi','7990314drHGkE','catch','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','TesSoft\x20Payment\x20System/1.0','startPeriodicUpdates','currencyRate','eth','findFirst','xau','huf','sats','nzd','Error\x20getting\x20rates\x20status:','%\x20markup\x20=\x20','currencyService','11172144sZqDkm','\x20currencies','idr','721134CojuTE'];a38_0x25d8=function(){return _0x46b64b;};return a38_0x25d8();}