'use strict';const a39_0x315b83=a39_0xb14b;(function(_0x73a651,_0x3acf9f){const _0x113728=a39_0xb14b,_0x25368d=_0x73a651();while(!![]){try{const _0x2bcf27=-parseInt(_0x113728(0x15e))/0x1*(-parseInt(_0x113728(0x150))/0x2)+-parseInt(_0x113728(0x130))/0x3+-parseInt(_0x113728(0x173))/0x4+parseInt(_0x113728(0x197))/0x5+-parseInt(_0x113728(0x16e))/0x6+-parseInt(_0x113728(0x17a))/0x7+parseInt(_0x113728(0x126))/0x8*(parseInt(_0x113728(0x17b))/0x9);if(_0x2bcf27===_0x3acf9f)break;else _0x25368d['push'](_0x25368d['shift']());}catch(_0x5e3c31){_0x25368d['push'](_0x25368d['shift']());}}}(a39_0x9b9b,0x84010));var __importDefault=this&&this[a39_0x315b83(0x12d)]||function(_0x2f2e16){const _0x403845=a39_0x315b83;return _0x2f2e16&&_0x2f2e16[_0x403845(0x198)]?_0x2f2e16:{'default':_0x2f2e16};};function a39_0x9b9b(){const _0x1888f5=['zar','twd','nzd','usdt','getMarkupPercentage','gel','Initial\x20currency\x20rates\x20update\x20failed:','Periodic\x20currency\x20rates\x20update\x20failed:','thb','defineProperty','catch','bch','join','toFixed','brl','\x20USDT','myr','COINGECKO_URL','4285330QLlwbb','__esModule','bdt','status','findFirst','cny','\x20USDT\x20(rate:\x20','pln','pkr','updateCurrencyRates','toUpperCase','count','chf','12752ViBcJM','?ids=tether&vs_currencies=','mxn','log','xag','link','MARKUP_PERCENTAGE','__importDefault','toLowerCase','❌\x20Failed\x20to\x20update\x20currency\x20rates:','280608lRyaGr','startPeriodicUpdates','stopPeriodicUpdates','currencyService','Error\x20converting\x20','📊\x20Received\x20rates\x20for\x20','✅\x20Currency\x20rates\x20updated\x20successfully','getRatesStatus','%\x20markup\x20to\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','currency','statusText','No\x20rate\x20found\x20for\x20currency:\x20','all','💱\x20Converted\x20','huf','php','eth','https://api.coingecko.com/api/v3/simple/price','btc','sek','ngn','xlm','application/json','findMany','gbp','convertToUSDT','idr','bmd','usd','getCurrencyRate','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','94vxnwZH','💱\x20Applied\x20','allSettled','hkd','map','bits','forEach','CoinGecko\x20API\x20error:\x20',',\x20using\x201\x20as\x20fallback','mmk','findUnique','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20update\x20rate\x20for\x20','try','972RMkSjs','upsert','CurrencyService','length','rub','xdr','bnb','kwd','dkk','updatedAt','nok','desc','lkr','eos','jpy','tether','4568682mjtRIH','yfi','CURRENCIES','asc','updateInterval','2605260zXWeJn','bhd','\x20to\x20USDT:','aud','\x20USDT\x20=\x20','vnd','currencyRate','4632362hAgtbf','10197lHjhQU','entries','error','../config/database','default','%\x20markup\x20=\x20','\x20USDT,\x20with\x20','aed','clp','krw'];a39_0x9b9b=function(){return _0x1888f5;};return a39_0x9b9b();}Object[a39_0x315b83(0x18e)](exports,'__esModule',{'value':!![]}),exports[a39_0x315b83(0x133)]=exports[a39_0x315b83(0x160)]=void 0x0;function a39_0xb14b(_0x428b54,_0x4e39a0){const _0x9b9baf=a39_0x9b9b();return a39_0xb14b=function(_0xb14b3b,_0x419b2c){_0xb14b3b=_0xb14b3b-0x11d;let _0xbe7605=_0x9b9baf[_0xb14b3b];return _0xbe7605;},a39_0xb14b(_0x428b54,_0x4e39a0);}const database_1=__importDefault(require(a39_0x315b83(0x17e)));class CurrencyService{constructor(){const _0x197fa7=a39_0x315b83;this[_0x197fa7(0x196)]=_0x197fa7(0x142),this[_0x197fa7(0x170)]=[_0x197fa7(0x143),_0x197fa7(0x141),'ltc',_0x197fa7(0x190),_0x197fa7(0x164),_0x197fa7(0x16b),'xrp',_0x197fa7(0x146),_0x197fa7(0x12b),'dot',_0x197fa7(0x16f),_0x197fa7(0x14d),_0x197fa7(0x182),'ars',_0x197fa7(0x176),_0x197fa7(0x199),_0x197fa7(0x174),_0x197fa7(0x14c),_0x197fa7(0x193),'cad',_0x197fa7(0x125),_0x197fa7(0x183),_0x197fa7(0x11e),'czk',_0x197fa7(0x166),'eur',_0x197fa7(0x149),_0x197fa7(0x18a),_0x197fa7(0x153),_0x197fa7(0x13f),_0x197fa7(0x14b),'ils','inr',_0x197fa7(0x16c),_0x197fa7(0x184),_0x197fa7(0x165),_0x197fa7(0x16a),_0x197fa7(0x159),_0x197fa7(0x128),_0x197fa7(0x195),_0x197fa7(0x145),_0x197fa7(0x168),_0x197fa7(0x187),_0x197fa7(0x140),_0x197fa7(0x121),_0x197fa7(0x120),_0x197fa7(0x162),'sar',_0x197fa7(0x144),'sgd',_0x197fa7(0x18d),_0x197fa7(0x15d),_0x197fa7(0x186),'uah','vef',_0x197fa7(0x178),_0x197fa7(0x185),_0x197fa7(0x163),_0x197fa7(0x12a),'xau',_0x197fa7(0x155),'sats'],this[_0x197fa7(0x172)]=null,this[_0x197fa7(0x12c)]=0x3,this[_0x197fa7(0x131)]();}['startPeriodicUpdates'](){const _0x12f614=a39_0x315b83;this[_0x12f614(0x122)]()[_0x12f614(0x18f)](_0x5a1497=>{const _0x422ee8=_0x12f614;console[_0x422ee8(0x17d)](_0x422ee8(0x18b),_0x5a1497);}),this[_0x12f614(0x172)]=setInterval(async()=>{const _0x258874=_0x12f614;try{await this[_0x258874(0x122)]();}catch(_0x34c9e0){console[_0x258874(0x17d)](_0x258874(0x18c),_0x34c9e0);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x315b83(0x132)](){const _0x388087=a39_0x315b83;this[_0x388087(0x172)]&&(clearInterval(this[_0x388087(0x172)]),this[_0x388087(0x172)]=null,console['log'](_0x388087(0x139)));}async['updateCurrencyRates'](){const _0x27c34f=a39_0x315b83;try{console[_0x27c34f(0x129)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x24e03e=this['CURRENCIES'][_0x27c34f(0x191)](','),_0x4a42f9=this[_0x27c34f(0x196)]+_0x27c34f(0x127)+_0x24e03e,_0x5482b7=await fetch(_0x4a42f9,{'headers':{'Accept':_0x27c34f(0x147),'User-Agent':_0x27c34f(0x15b)}});if(!_0x5482b7['ok'])throw new Error(_0x27c34f(0x157)+_0x5482b7[_0x27c34f(0x19a)]+'\x20'+_0x5482b7[_0x27c34f(0x13b)]);const _0x1c71a6=await _0x5482b7['json']();if(!_0x1c71a6[_0x27c34f(0x16d)])throw new Error(_0x27c34f(0x14f));const _0x284df4=_0x1c71a6['tether'];console[_0x27c34f(0x129)](_0x27c34f(0x135)+Object['keys'](_0x284df4)[_0x27c34f(0x161)]+'\x20currencies');const _0x4c86a0=Object[_0x27c34f(0x17c)](_0x284df4)[_0x27c34f(0x154)](async([_0xcbc1c8,_0xadddb4])=>{const _0x3ea0e4=_0x27c34f;try{await database_1[_0x3ea0e4(0x17f)][_0x3ea0e4(0x179)][_0x3ea0e4(0x15f)]({'where':{'currency':_0xcbc1c8['toLowerCase']()},'update':{'rate':_0xadddb4},'create':{'currency':_0xcbc1c8['toLowerCase'](),'rate':_0xadddb4}});}catch(_0x3bc8af){console[_0x3ea0e4(0x17d)](_0x3ea0e4(0x15c)+_0xcbc1c8+':',_0x3bc8af);}});await Promise[_0x27c34f(0x152)](_0x4c86a0),console[_0x27c34f(0x129)](_0x27c34f(0x136));}catch(_0x4bbfda){console[_0x27c34f(0x17d)](_0x27c34f(0x12f),_0x4bbfda);throw _0x4bbfda;}}async['getCurrencyRate'](_0x284b49){const _0x348482=a39_0x315b83,_0x1f56de=_0x284b49[_0x348482(0x12e)]();if(_0x1f56de==='usdt')return 0x1;try{const _0x2624e6=await database_1[_0x348482(0x17f)][_0x348482(0x179)][_0x348482(0x15a)]({'where':{'currency':_0x1f56de}});if(!_0x2624e6)return console['warn'](_0x348482(0x13c)+_0x284b49+_0x348482(0x158)),0x1;return _0x2624e6['rate'];}catch(_0x2081a0){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x284b49+':',_0x2081a0),0x1;}}async[a39_0x315b83(0x14a)](_0xdfa95d,_0x512301){const _0x458140=a39_0x315b83,_0xacc3fa=_0x512301[_0x458140(0x12e)]();if(_0xacc3fa===_0x458140(0x188)){const _0x5eec2a=_0xdfa95d*(0x1+this[_0x458140(0x12c)]/0x64);return console[_0x458140(0x129)](_0x458140(0x151)+this[_0x458140(0x12c)]+_0x458140(0x138)+_0xdfa95d+_0x458140(0x177)+_0x5eec2a[_0x458140(0x192)](0x6)+_0x458140(0x194)),_0x5eec2a;}try{const _0x4f8a9e=await this[_0x458140(0x14e)](_0xacc3fa),_0x431346=_0xdfa95d/_0x4f8a9e,_0x272d79=_0x431346*(0x1+this[_0x458140(0x12c)]/0x64);return console[_0x458140(0x129)](_0x458140(0x13e)+_0xdfa95d+'\x20'+_0x512301[_0x458140(0x123)]()+'\x20to\x20'+_0x431346['toFixed'](0x6)+_0x458140(0x181)+this[_0x458140(0x12c)]+_0x458140(0x180)+_0x272d79[_0x458140(0x192)](0x6)+_0x458140(0x11f)+_0x4f8a9e+')'),_0x272d79;}catch(_0x38fd1e){console[_0x458140(0x17d)](_0x458140(0x134)+_0xdfa95d+'\x20'+_0x512301+_0x458140(0x175),_0x38fd1e);const _0x296143=_0xdfa95d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x296143;}}async['convertMultipleToUSDT'](_0x479c6a){const _0x2aa193=a39_0x315b83;let _0x18b21b=0x0;for(const {amount:_0x3e8c4a,currency:_0x30be82}of _0x479c6a){const _0x30d74f=await this[_0x2aa193(0x14a)](_0x3e8c4a,_0x30be82);_0x18b21b+=_0x30d74f;}return _0x18b21b;}async['getAllRates'](){const _0x11c2a9=a39_0x315b83;try{const _0x19a6ac=await database_1[_0x11c2a9(0x17f)][_0x11c2a9(0x179)][_0x11c2a9(0x148)]({'select':{'currency':!![],'rate':!![]}}),_0x4cea4f={'usdt':0x1};return _0x19a6ac[_0x11c2a9(0x156)](_0x477aa2=>{const _0x52b242=_0x11c2a9;_0x4cea4f[_0x477aa2[_0x52b242(0x13a)]]=_0x477aa2['rate'];}),_0x4cea4f;}catch(_0x2757b1){return console['error']('Error\x20getting\x20all\x20rates:',_0x2757b1),{'usdt':0x1};}}async[a39_0x315b83(0x137)](){const _0x5a6a95=a39_0x315b83;try{const [_0xbc0c5f,_0x2433c1,_0x4808a5]=await Promise[_0x5a6a95(0x13d)]([database_1['default']['currencyRate'][_0x5a6a95(0x124)](),database_1[_0x5a6a95(0x17f)][_0x5a6a95(0x179)][_0x5a6a95(0x11d)]({'orderBy':{'updatedAt':_0x5a6a95(0x169)},'select':{'updatedAt':!![]}}),database_1[_0x5a6a95(0x17f)][_0x5a6a95(0x179)][_0x5a6a95(0x11d)]({'orderBy':{'updatedAt':_0x5a6a95(0x171)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xbc0c5f,'lastUpdated':_0x2433c1?.['updatedAt']||null,'oldestRate':_0x4808a5?.[_0x5a6a95(0x167)]||null,'markupPercentage':this[_0x5a6a95(0x12c)]};}catch(_0x242837){return console[_0x5a6a95(0x17d)]('Error\x20getting\x20rates\x20status:',_0x242837),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x315b83(0x189)](){const _0x15a6db=a39_0x315b83;return this[_0x15a6db(0x12c)];}}exports['CurrencyService']=CurrencyService,exports[a39_0x315b83(0x133)]=new CurrencyService();