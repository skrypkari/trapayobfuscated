'use strict';const a36_0x1378cd=a36_0x5d28;(function(_0xb4bc02,_0x1a26e4){const _0x131d74=a36_0x5d28,_0x1182b0=_0xb4bc02();while(!![]){try{const _0x2e87b0=parseInt(_0x131d74(0x1f8))/0x1+parseInt(_0x131d74(0x208))/0x2+parseInt(_0x131d74(0x218))/0x3+-parseInt(_0x131d74(0x229))/0x4+parseInt(_0x131d74(0x206))/0x5*(-parseInt(_0x131d74(0x1b6))/0x6)+parseInt(_0x131d74(0x211))/0x7+parseInt(_0x131d74(0x20b))/0x8*(parseInt(_0x131d74(0x214))/0x9);if(_0x2e87b0===_0x1a26e4)break;else _0x1182b0['push'](_0x1182b0['shift']());}catch(_0x7b45d0){_0x1182b0['push'](_0x1182b0['shift']());}}}(a36_0x45d5,0x35078));var __importDefault=this&&this[a36_0x1378cd(0x1cb)]||function(_0x577ca4){return _0x577ca4&&_0x577ca4['__esModule']?_0x577ca4:{'default':_0x577ca4};};Object[a36_0x1378cd(0x1d3)](exports,'__esModule',{'value':!![]}),exports[a36_0x1378cd(0x224)]=exports[a36_0x1378cd(0x1ce)]=void 0x0;const database_1=__importDefault(require(a36_0x1378cd(0x204)));class CurrencyService{constructor(){const _0x4a6011=a36_0x1378cd;this[_0x4a6011(0x1e3)]=_0x4a6011(0x1f3),this[_0x4a6011(0x226)]=[_0x4a6011(0x1fc),_0x4a6011(0x1d5),_0x4a6011(0x1e0),_0x4a6011(0x1e6),_0x4a6011(0x20e),'eos',_0x4a6011(0x201),_0x4a6011(0x1be),_0x4a6011(0x20a),'dot',_0x4a6011(0x1dd),_0x4a6011(0x1ae),_0x4a6011(0x207),'ars',_0x4a6011(0x1bd),_0x4a6011(0x1af),_0x4a6011(0x222),_0x4a6011(0x21a),_0x4a6011(0x210),_0x4a6011(0x1f9),_0x4a6011(0x1f4),_0x4a6011(0x1f5),'cny',_0x4a6011(0x1eb),_0x4a6011(0x1fb),_0x4a6011(0x1d2),'gbp',_0x4a6011(0x1df),_0x4a6011(0x20f),_0x4a6011(0x1d6),_0x4a6011(0x1ca),_0x4a6011(0x1e2),_0x4a6011(0x1e9),_0x4a6011(0x1d9),_0x4a6011(0x1c7),_0x4a6011(0x1b2),_0x4a6011(0x1ba),_0x4a6011(0x203),_0x4a6011(0x1fa),_0x4a6011(0x1c3),_0x4a6011(0x220),_0x4a6011(0x202),_0x4a6011(0x1f2),_0x4a6011(0x1f0),_0x4a6011(0x1c6),_0x4a6011(0x1c8),_0x4a6011(0x20d),_0x4a6011(0x1ab),_0x4a6011(0x1d0),_0x4a6011(0x1b3),_0x4a6011(0x1bb),_0x4a6011(0x1e8),_0x4a6011(0x1b9),_0x4a6011(0x1fe),_0x4a6011(0x1c5),'vnd',_0x4a6011(0x1f6),_0x4a6011(0x1e7),_0x4a6011(0x1cc),_0x4a6011(0x1d8),'bits',_0x4a6011(0x21d)],this[_0x4a6011(0x228)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x4a6011(0x1c0)]();}[a36_0x1378cd(0x1c0)](){const _0x4520c1=a36_0x1378cd;this[_0x4520c1(0x217)]()[_0x4520c1(0x1d4)](_0x1568d7=>{const _0xa99200=_0x4520c1;console[_0xa99200(0x216)](_0xa99200(0x1de),_0x1568d7);}),this[_0x4520c1(0x228)]=setInterval(async()=>{const _0x4c7faf=_0x4520c1;try{await this['updateCurrencyRates']();}catch(_0x51d66c){console[_0x4c7faf(0x216)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x51d66c);}},0x3c*0x3c*0x3e8),console[_0x4520c1(0x1ef)](_0x4520c1(0x1da));}['stopPeriodicUpdates'](){const _0x33443b=a36_0x1378cd;this['updateInterval']&&(clearInterval(this[_0x33443b(0x228)]),this[_0x33443b(0x228)]=null,console['log'](_0x33443b(0x1aa)));}async[a36_0x1378cd(0x217)](){const _0x4b585f=a36_0x1378cd;try{console[_0x4b585f(0x1ef)](_0x4b585f(0x200));const _0x34f1db=this['CURRENCIES'][_0x4b585f(0x1e5)](','),_0x35aa9a=this['COINGECKO_URL']+_0x4b585f(0x1bf)+_0x34f1db,_0x5221b9=await fetch(_0x35aa9a,{'headers':{'Accept':_0x4b585f(0x21e),'User-Agent':_0x4b585f(0x22a)}});if(!_0x5221b9['ok'])throw new Error(_0x4b585f(0x1d1)+_0x5221b9['status']+'\x20'+_0x5221b9[_0x4b585f(0x1c4)]);const _0x5175f4=await _0x5221b9[_0x4b585f(0x1c2)]();if(!_0x5175f4['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x959734=_0x5175f4[_0x4b585f(0x1e4)];console[_0x4b585f(0x1ef)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x4b585f(0x1f1)](_0x959734)['length']+_0x4b585f(0x223));const _0x4a0764=Object[_0x4b585f(0x1ea)](_0x959734)[_0x4b585f(0x22b)](async([_0x4f275c,_0x2ad355])=>{const _0x2e6d85=_0x4b585f;try{await database_1['default'][_0x2e6d85(0x1b8)][_0x2e6d85(0x225)]({'where':{'currency':_0x4f275c[_0x2e6d85(0x219)]()},'update':{'rate':_0x2ad355},'create':{'currency':_0x4f275c['toLowerCase'](),'rate':_0x2ad355}});}catch(_0x151a8c){console['error'](_0x2e6d85(0x213)+_0x4f275c+':',_0x151a8c);}});await Promise[_0x4b585f(0x1b5)](_0x4a0764),console[_0x4b585f(0x1ef)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x13bda7){console[_0x4b585f(0x216)](_0x4b585f(0x1ad),_0x13bda7);throw _0x13bda7;}}async['getCurrencyRate'](_0x4b8414){const _0x38315e=a36_0x1378cd,_0x5166a1=_0x4b8414[_0x38315e(0x219)]();if(_0x5166a1==='usdt')return 0x1;try{const _0x2bcf34=await database_1[_0x38315e(0x1b0)]['currencyRate']['findUnique']({'where':{'currency':_0x5166a1}});if(!_0x2bcf34)return console['warn'](_0x38315e(0x20c)+_0x4b8414+_0x38315e(0x1cf)),0x1;return _0x2bcf34[_0x38315e(0x1c1)];}catch(_0x21f2ba){return console[_0x38315e(0x216)](_0x38315e(0x1b1)+_0x4b8414+':',_0x21f2ba),0x1;}}async[a36_0x1378cd(0x1ff)](_0x417f10,_0x3ed2e9){const _0x314ebd=a36_0x1378cd,_0x35b7a4=_0x3ed2e9['toLowerCase']();if(_0x35b7a4===_0x314ebd(0x1b7)){const _0x3dc73c=_0x417f10*(0x1+this[_0x314ebd(0x1d7)]/0x64);return console['log']('üí±\x20Applied\x20'+this[_0x314ebd(0x1d7)]+_0x314ebd(0x1bc)+_0x417f10+_0x314ebd(0x1cd)+_0x3dc73c[_0x314ebd(0x1db)](0x6)+_0x314ebd(0x215)),_0x3dc73c;}try{const _0x1cbfe6=await this[_0x314ebd(0x1ec)](_0x35b7a4),_0x2961a7=_0x417f10/_0x1cbfe6,_0x13400a=_0x2961a7*(0x1+this[_0x314ebd(0x1d7)]/0x64);return console['log'](_0x314ebd(0x221)+_0x417f10+'\x20'+_0x3ed2e9['toUpperCase']()+_0x314ebd(0x1b4)+_0x2961a7[_0x314ebd(0x1db)](0x6)+'\x20USDT,\x20with\x20'+this[_0x314ebd(0x1d7)]+_0x314ebd(0x1ed)+_0x13400a['toFixed'](0x6)+_0x314ebd(0x21c)+_0x1cbfe6+')'),_0x13400a;}catch(_0x258f87){console[_0x314ebd(0x216)](_0x314ebd(0x227)+_0x417f10+'\x20'+_0x3ed2e9+_0x314ebd(0x1c9),_0x258f87);const _0x381418=_0x417f10*(0x1+this[_0x314ebd(0x1d7)]/0x64);return _0x381418;}}async['convertMultipleToUSDT'](_0x1f95f0){const _0x138911=a36_0x1378cd;let _0x24a0ca=0x0;for(const {amount:_0x4f86c8,currency:_0x5a197a}of _0x1f95f0){const _0xc77547=await this[_0x138911(0x1ff)](_0x4f86c8,_0x5a197a);_0x24a0ca+=_0xc77547;}return _0x24a0ca;}async['getAllRates'](){const _0xbd9389=a36_0x1378cd;try{const _0x3f82b7=await database_1['default']['currencyRate'][_0xbd9389(0x1f7)]({'select':{'currency':!![],'rate':!![]}}),_0x5e82e4={'usdt':0x1};return _0x3f82b7[_0xbd9389(0x1dc)](_0xffcdd4=>{const _0xfc6c21=_0xbd9389;_0x5e82e4[_0xffcdd4[_0xfc6c21(0x209)]]=_0xffcdd4[_0xfc6c21(0x1c1)];}),_0x5e82e4;}catch(_0x3d0c54){return console[_0xbd9389(0x216)](_0xbd9389(0x205),_0x3d0c54),{'usdt':0x1};}}async[a36_0x1378cd(0x21f)](){const _0x1b4adf=a36_0x1378cd;try{const [_0x374956,_0x529c45,_0x5f124b]=await Promise[_0x1b4adf(0x212)]([database_1['default'][_0x1b4adf(0x1b8)][_0x1b4adf(0x21b)](),database_1[_0x1b4adf(0x1b0)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x1b4adf(0x1b8)][_0x1b4adf(0x1ee)]({'orderBy':{'updatedAt':_0x1b4adf(0x1e1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x374956,'lastUpdated':_0x529c45?.[_0x1b4adf(0x1fd)]||null,'oldestRate':_0x5f124b?.[_0x1b4adf(0x1fd)]||null,'markupPercentage':this[_0x1b4adf(0x1d7)]};}catch(_0x1110f4){return console['error']('Error\x20getting\x20rates\x20status:',_0x1110f4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1b4adf(0x1d7)]};}}[a36_0x1378cd(0x1ac)](){const _0x594d0f=a36_0x1378cd;return this[_0x594d0f(0x1d7)];}}function a36_0x5d28(_0x502c49,_0x142760){const _0x45d53c=a36_0x45d5();return a36_0x5d28=function(_0x5d2886,_0x4a4914){_0x5d2886=_0x5d2886-0x1aa;let _0xcfe4ef=_0x45d53c[_0x5d2886];return _0xcfe4ef;},a36_0x5d28(_0x502c49,_0x142760);}function a36_0x45d5(){const _0x442e7d=['findMany','63937IfkhaN','cad','mxn','dkk','btc','updatedAt','uah','convertToUSDT','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','xrp','nok','mmk','../config/database','Error\x20getting\x20all\x20rates:','515265oYCMhk','aed','143004jrNkFh','currency','link','6376ppbvCH','No\x20rate\x20found\x20for\x20currency:\x20','rub','bnb','hkd','brl','1554637KDtCKx','all','Failed\x20to\x20update\x20rate\x20for\x20','1242xSUtXW','\x20USDT','error','updateCurrencyRates','155838ndNlxN','toLowerCase','bmd','count','\x20USDT\x20(rate:\x20','sats','application/json','getRatesStatus','ngn','üí±\x20Converted\x20','bhd','\x20currencies','currencyService','upsert','CURRENCIES','Error\x20converting\x20','updateInterval','796804kreNNb','TesSoft\x20Payment\x20System/1.0','map','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','sar','getMarkupPercentage','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','usd','bdt','default','Error\x20getting\x20rate\x20for\x20currency\x20','kwd','sgd','\x20to\x20','allSettled','6CpsNox','usdt','currencyRate','twd','lkr','thb','%\x20markup\x20to\x20','aud','xlm','?ids=tether&vs_currencies=','startPeriodicUpdates','rate','json','myr','statusText','vef','pkr','krw','pln','\x20to\x20USDT:','idr','__importDefault','xag','\x20USDT\x20=\x20','CurrencyService',',\x20using\x201\x20as\x20fallback','sek','CoinGecko\x20API\x20error:\x20','eur','defineProperty','catch','eth','huf','MARKUP_PERCENTAGE','xau','jpy','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','toFixed','forEach','yfi','Initial\x20currency\x20rates\x20update\x20failed:','gel','ltc','asc','ils','COINGECKO_URL','tether','join','bch','xdr','try','inr','entries','czk','getCurrencyRate','%\x20markup\x20=\x20','findFirst','log','php','keys','nzd','https://api.coingecko.com/api/v3/simple/price','chf','clp','zar'];a36_0x45d5=function(){return _0x442e7d;};return a36_0x45d5();}exports[a36_0x1378cd(0x1ce)]=CurrencyService,exports[a36_0x1378cd(0x224)]=new CurrencyService();