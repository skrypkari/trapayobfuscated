'use strict';const a36_0x1a1a5f=a36_0x4aa3;(function(_0x13aa09,_0x217444){const _0x5cd62e=a36_0x4aa3,_0x3538b7=_0x13aa09();while(!![]){try{const _0x2c5e5d=parseInt(_0x5cd62e(0xf0))/0x1*(parseInt(_0x5cd62e(0xaf))/0x2)+parseInt(_0x5cd62e(0x7d))/0x3+-parseInt(_0x5cd62e(0xf5))/0x4+parseInt(_0x5cd62e(0xb8))/0x5+-parseInt(_0x5cd62e(0xb3))/0x6*(parseInt(_0x5cd62e(0xfb))/0x7)+-parseInt(_0x5cd62e(0xa8))/0x8*(-parseInt(_0x5cd62e(0xee))/0x9)+parseInt(_0x5cd62e(0xcb))/0xa;if(_0x2c5e5d===_0x217444)break;else _0x3538b7['push'](_0x3538b7['shift']());}catch(_0x3f04bd){_0x3538b7['push'](_0x3538b7['shift']());}}}(a36_0x30da,0x9f410));var __importDefault=this&&this[a36_0x1a1a5f(0x99)]||function(_0x1003d2){const _0x2ea2c7=a36_0x1a1a5f;return _0x1003d2&&_0x1003d2[_0x2ea2c7(0x8e)]?_0x1003d2:{'default':_0x1003d2};};Object['defineProperty'](exports,a36_0x1a1a5f(0x8e),{'value':!![]}),exports['currencyService']=exports[a36_0x1a1a5f(0xa6)]=void 0x0;const database_1=__importDefault(require(a36_0x1a1a5f(0xd8)));function a36_0x30da(){const _0x21afbf=['krw','💱\x20Applied\x20',',\x20using\x201\x20as\x20fallback','COINGECKO_URL','aud','forEach','1575TssqDH','count','2433uXcllQ','map','bnb','toLowerCase','vef','1124484eTBhSN','allSettled','ltc','asc','💱\x20Converted\x20','\x20currencies','5989151SArrJt','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','updatedAt','1283316bcuhCL','xag','getCurrencyRate','bhd','cad','thb','nok','json','chf','startPeriodicUpdates','sek','catch','length','findMany','czk','No\x20rate\x20found\x20for\x20currency:\x20','getMarkupPercentage','__esModule','join','\x20to\x20','%\x20markup\x20to\x20','toUpperCase','all','pkr','myr','eos','Periodic\x20currency\x20rates\x20update\x20failed:','uah','__importDefault','pln','tether','huf','gel','hkd','\x20to\x20USDT:','bdt','bits','updateCurrencyRates','eth','gbp','\x20USDT','CurrencyService','currencyRate','4904KtnOeh','Error\x20getting\x20rates\x20status:','jpy','updateInterval','error','bch','dot','70DXBzPa','❌\x20Failed\x20to\x20update\x20currency\x20rates:','getAllRates','log','6SmWTZq','try','xlm','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','Initial\x20currency\x20rates\x20update\x20failed:','5242055RmlyLr','twd','lkr','application/json','xau','CoinGecko\x20API\x20error:\x20','statusText','entries','mxn','clp','brl','usdt','desc','convertToUSDT','yfi','MARKUP_PERCENTAGE','ils','nzd','default','1204050lMnWWD','btc','stopPeriodicUpdates','findUnique','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','aed','php','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','✅\x20Currency\x20rates\x20updated\x20successfully','\x20USDT,\x20with\x20','toFixed','usd','status','../config/database','ngn','warn','convertMultipleToUSDT','xrp','Failed\x20to\x20update\x20rate\x20for\x20','?ids=tether&vs_currencies=','CURRENCIES','upsert','TesSoft\x20Payment\x20System/1.0','rub','Error\x20getting\x20all\x20rates:','zar','bmd','\x20USDT\x20=\x20','rate'];a36_0x30da=function(){return _0x21afbf;};return a36_0x30da();}class CurrencyService{constructor(){const _0xf30246=a36_0x1a1a5f;this[_0xf30246(0xeb)]='https://api.coingecko.com/api/v3/simple/price',this[_0xf30246(0xdf)]=[_0xf30246(0xcc),_0xf30246(0xa3),_0xf30246(0xf7),_0xf30246(0xad),_0xf30246(0xf2),_0xf30246(0x96),_0xf30246(0xdc),_0xf30246(0xb5),'link',_0xf30246(0xae),_0xf30246(0xc6),_0xf30246(0xd6),_0xf30246(0xd0),'ars',_0xf30246(0xec),_0xf30246(0xa0),_0xf30246(0x80),_0xf30246(0xe5),_0xf30246(0xc2),_0xf30246(0x81),_0xf30246(0x85),_0xf30246(0xc1),'cny',_0xf30246(0x8b),'dkk','eur',_0xf30246(0xa4),_0xf30246(0x9d),_0xf30246(0x9e),_0xf30246(0x9c),'idr',_0xf30246(0xc8),'inr',_0xf30246(0xaa),_0xf30246(0xe8),'kwd',_0xf30246(0xba),'mmk',_0xf30246(0xc0),_0xf30246(0x95),_0xf30246(0xd9),_0xf30246(0x83),_0xf30246(0xc9),_0xf30246(0xd1),_0xf30246(0x94),_0xf30246(0x9a),_0xf30246(0xe2),'sar',_0xf30246(0x87),'sgd',_0xf30246(0x82),_0xf30246(0xb4),_0xf30246(0xb9),_0xf30246(0x98),_0xf30246(0xf4),'vnd',_0xf30246(0xe4),'xdr',_0xf30246(0x7e),_0xf30246(0xbc),_0xf30246(0xa1),'sats'],this[_0xf30246(0xab)]=null,this[_0xf30246(0xc7)]=0x3,this['startPeriodicUpdates']();}[a36_0x1a1a5f(0x86)](){const _0x4bd0f1=a36_0x1a1a5f;this[_0x4bd0f1(0xa2)]()[_0x4bd0f1(0x88)](_0x41d9cc=>{const _0x47237f=_0x4bd0f1;console[_0x47237f(0xac)](_0x47237f(0xb7),_0x41d9cc);}),this[_0x4bd0f1(0xab)]=setInterval(async()=>{const _0x3bfabe=_0x4bd0f1;try{await this[_0x3bfabe(0xa2)]();}catch(_0x5403d9){console[_0x3bfabe(0xac)](_0x3bfabe(0x97),_0x5403d9);}},0x3c*0x3c*0x3e8),console[_0x4bd0f1(0xb2)](_0x4bd0f1(0xd2));}[a36_0x1a1a5f(0xcd)](){const _0x46e30b=a36_0x1a1a5f;this[_0x46e30b(0xab)]&&(clearInterval(this[_0x46e30b(0xab)]),this[_0x46e30b(0xab)]=null,console[_0x46e30b(0xb2)](_0x46e30b(0xb6)));}async[a36_0x1a1a5f(0xa2)](){const _0x299829=a36_0x1a1a5f;try{console[_0x299829(0xb2)](_0x299829(0xcf));const _0x519421=this[_0x299829(0xdf)][_0x299829(0x8f)](','),_0x9a6e32=this[_0x299829(0xeb)]+_0x299829(0xde)+_0x519421,_0x459e53=await fetch(_0x9a6e32,{'headers':{'Accept':_0x299829(0xbb),'User-Agent':_0x299829(0xe1)}});if(!_0x459e53['ok'])throw new Error(_0x299829(0xbd)+_0x459e53[_0x299829(0xd7)]+'\x20'+_0x459e53[_0x299829(0xbe)]);const _0xc81115=await _0x459e53[_0x299829(0x84)]();if(!_0xc81115['tether'])throw new Error(_0x299829(0x7b));const _0x40fe16=_0xc81115[_0x299829(0x9b)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object['keys'](_0x40fe16)[_0x299829(0x89)]+_0x299829(0xfa));const _0x2d21ea=Object[_0x299829(0xbf)](_0x40fe16)[_0x299829(0xf1)](async([_0x4b58d9,_0x4f69cb])=>{const _0xb0b9d7=_0x299829;try{await database_1[_0xb0b9d7(0xca)][_0xb0b9d7(0xa7)][_0xb0b9d7(0xe0)]({'where':{'currency':_0x4b58d9[_0xb0b9d7(0xf3)]()},'update':{'rate':_0x4f69cb},'create':{'currency':_0x4b58d9[_0xb0b9d7(0xf3)](),'rate':_0x4f69cb}});}catch(_0x57b5d5){console['error'](_0xb0b9d7(0xdd)+_0x4b58d9+':',_0x57b5d5);}});await Promise[_0x299829(0xf6)](_0x2d21ea),console[_0x299829(0xb2)](_0x299829(0xd3));}catch(_0x35bb93){console[_0x299829(0xac)](_0x299829(0xb0),_0x35bb93);throw _0x35bb93;}}async[a36_0x1a1a5f(0x7f)](_0x31105c){const _0xd0b8c=a36_0x1a1a5f,_0x480621=_0x31105c[_0xd0b8c(0xf3)]();if(_0x480621===_0xd0b8c(0xc3))return 0x1;try{const _0x4c135c=await database_1[_0xd0b8c(0xca)][_0xd0b8c(0xa7)][_0xd0b8c(0xce)]({'where':{'currency':_0x480621}});if(!_0x4c135c)return console[_0xd0b8c(0xda)](_0xd0b8c(0x8c)+_0x31105c+_0xd0b8c(0xea)),0x1;return _0x4c135c[_0xd0b8c(0xe7)];}catch(_0x5d65f4){return console[_0xd0b8c(0xac)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x31105c+':',_0x5d65f4),0x1;}}async['convertToUSDT'](_0x4186e5,_0x176a8e){const _0x9ce69=a36_0x1a1a5f,_0x548007=_0x176a8e[_0x9ce69(0xf3)]();if(_0x548007===_0x9ce69(0xc3)){const _0x80135f=_0x4186e5*(0x1+this[_0x9ce69(0xc7)]/0x64);return console['log'](_0x9ce69(0xe9)+this['MARKUP_PERCENTAGE']+_0x9ce69(0x91)+_0x4186e5+_0x9ce69(0xe6)+_0x80135f[_0x9ce69(0xd5)](0x6)+_0x9ce69(0xa5)),_0x80135f;}try{const _0x50d847=await this[_0x9ce69(0x7f)](_0x548007),_0xa71edc=_0x4186e5/_0x50d847,_0x140e5d=_0xa71edc*(0x1+this[_0x9ce69(0xc7)]/0x64);return console[_0x9ce69(0xb2)](_0x9ce69(0xf9)+_0x4186e5+'\x20'+_0x176a8e[_0x9ce69(0x92)]()+_0x9ce69(0x90)+_0xa71edc[_0x9ce69(0xd5)](0x6)+_0x9ce69(0xd4)+this[_0x9ce69(0xc7)]+'%\x20markup\x20=\x20'+_0x140e5d[_0x9ce69(0xd5)](0x6)+'\x20USDT\x20(rate:\x20'+_0x50d847+')'),_0x140e5d;}catch(_0x3f7df9){console[_0x9ce69(0xac)]('Error\x20converting\x20'+_0x4186e5+'\x20'+_0x176a8e+_0x9ce69(0x9f),_0x3f7df9);const _0x3e7ed3=_0x4186e5*(0x1+this[_0x9ce69(0xc7)]/0x64);return _0x3e7ed3;}}async[a36_0x1a1a5f(0xdb)](_0x1bdd25){const _0x22bc53=a36_0x1a1a5f;let _0xc5afdd=0x0;for(const {amount:_0x196479,currency:_0xa494fd}of _0x1bdd25){const _0x1add9d=await this[_0x22bc53(0xc5)](_0x196479,_0xa494fd);_0xc5afdd+=_0x1add9d;}return _0xc5afdd;}async[a36_0x1a1a5f(0xb1)](){const _0x371783=a36_0x1a1a5f;try{const _0x5e86d2=await database_1[_0x371783(0xca)]['currencyRate'][_0x371783(0x8a)]({'select':{'currency':!![],'rate':!![]}}),_0x14ba7d={'usdt':0x1};return _0x5e86d2[_0x371783(0xed)](_0x3fb062=>{const _0x55b72f=_0x371783;_0x14ba7d[_0x3fb062['currency']]=_0x3fb062[_0x55b72f(0xe7)];}),_0x14ba7d;}catch(_0x28ad95){return console[_0x371783(0xac)](_0x371783(0xe3),_0x28ad95),{'usdt':0x1};}}async['getRatesStatus'](){const _0x5a51b9=a36_0x1a1a5f;try{const [_0x4cb48f,_0x5c67ac,_0x1fe424]=await Promise[_0x5a51b9(0x93)]([database_1[_0x5a51b9(0xca)][_0x5a51b9(0xa7)][_0x5a51b9(0xef)](),database_1[_0x5a51b9(0xca)][_0x5a51b9(0xa7)]['findFirst']({'orderBy':{'updatedAt':_0x5a51b9(0xc4)},'select':{'updatedAt':!![]}}),database_1[_0x5a51b9(0xca)][_0x5a51b9(0xa7)]['findFirst']({'orderBy':{'updatedAt':_0x5a51b9(0xf8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4cb48f,'lastUpdated':_0x5c67ac?.[_0x5a51b9(0x7c)]||null,'oldestRate':_0x1fe424?.[_0x5a51b9(0x7c)]||null,'markupPercentage':this[_0x5a51b9(0xc7)]};}catch(_0x41c9df){return console[_0x5a51b9(0xac)](_0x5a51b9(0xa9),_0x41c9df),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5a51b9(0xc7)]};}}[a36_0x1a1a5f(0x8d)](){return this['MARKUP_PERCENTAGE'];}}function a36_0x4aa3(_0x4a37cd,_0x108a9a){const _0x30da2c=a36_0x30da();return a36_0x4aa3=function(_0x4aa3ef,_0x418b66){_0x4aa3ef=_0x4aa3ef-0x7b;let _0x2172c8=_0x30da2c[_0x4aa3ef];return _0x2172c8;},a36_0x4aa3(_0x4a37cd,_0x108a9a);}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();