'use strict';const a36_0x320815=a36_0x1f5f;(function(_0x1893ad,_0x41487a){const _0x4d284f=a36_0x1f5f,_0x4620d2=_0x1893ad();while(!![]){try{const _0x12f91f=-parseInt(_0x4d284f(0x1c1))/0x1*(-parseInt(_0x4d284f(0x16f))/0x2)+parseInt(_0x4d284f(0x14a))/0x3+-parseInt(_0x4d284f(0x1bd))/0x4+-parseInt(_0x4d284f(0x15b))/0x5*(parseInt(_0x4d284f(0x1b9))/0x6)+parseInt(_0x4d284f(0x170))/0x7+-parseInt(_0x4d284f(0x1bb))/0x8+parseInt(_0x4d284f(0x16a))/0x9;if(_0x12f91f===_0x41487a)break;else _0x4620d2['push'](_0x4620d2['shift']());}catch(_0x58b889){_0x4620d2['push'](_0x4620d2['shift']());}}}(a36_0x4ea9,0x70d96));var __importDefault=this&&this['__importDefault']||function(_0x18576b){return _0x18576b&&_0x18576b['__esModule']?_0x18576b:{'default':_0x18576b};};function a36_0x1f5f(_0x502ecd,_0x4f5a8f){const _0x4ea90b=a36_0x4ea9();return a36_0x1f5f=function(_0x1f5f6e,_0xd4ac04){_0x1f5f6e=_0x1f5f6e-0x13e;let _0x56f3fa=_0x4ea90b[_0x1f5f6e];return _0x56f3fa;},a36_0x1f5f(_0x502ecd,_0x4f5a8f);}Object['defineProperty'](exports,a36_0x320815(0x1b2),{'value':!![]}),exports[a36_0x320815(0x1b4)]=exports[a36_0x320815(0x17f)]=void 0x0;const database_1=__importDefault(require(a36_0x320815(0x19c)));class CurrencyService{constructor(){const _0x2a80c5=a36_0x320815;this['COINGECKO_URL']=_0x2a80c5(0x1a0),this['CURRENCIES']=[_0x2a80c5(0x142),_0x2a80c5(0x144),_0x2a80c5(0x1ab),'bch',_0x2a80c5(0x199),_0x2a80c5(0x151),_0x2a80c5(0x1a4),_0x2a80c5(0x18e),_0x2a80c5(0x18b),_0x2a80c5(0x150),_0x2a80c5(0x1af),_0x2a80c5(0x153),_0x2a80c5(0x158),_0x2a80c5(0x172),_0x2a80c5(0x179),_0x2a80c5(0x14d),'bhd',_0x2a80c5(0x164),_0x2a80c5(0x19d),_0x2a80c5(0x1a8),_0x2a80c5(0x146),'clp',_0x2a80c5(0x187),_0x2a80c5(0x1a1),_0x2a80c5(0x167),_0x2a80c5(0x198),_0x2a80c5(0x183),_0x2a80c5(0x188),'hkd','huf','idr',_0x2a80c5(0x162),_0x2a80c5(0x14e),_0x2a80c5(0x1ac),_0x2a80c5(0x169),_0x2a80c5(0x191),'lkr',_0x2a80c5(0x176),_0x2a80c5(0x178),_0x2a80c5(0x154),_0x2a80c5(0x14f),_0x2a80c5(0x190),'nzd','php',_0x2a80c5(0x155),_0x2a80c5(0x1b6),_0x2a80c5(0x19b),_0x2a80c5(0x16c),_0x2a80c5(0x13e),_0x2a80c5(0x18d),_0x2a80c5(0x16e),_0x2a80c5(0x1a5),_0x2a80c5(0x1b3),_0x2a80c5(0x141),_0x2a80c5(0x160),_0x2a80c5(0x171),_0x2a80c5(0x195),_0x2a80c5(0x157),_0x2a80c5(0x17e),_0x2a80c5(0x18f),_0x2a80c5(0x17b),_0x2a80c5(0x165)],this[_0x2a80c5(0x143)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x2a80c5(0x181)]();}[a36_0x320815(0x181)](){const _0x138bac=a36_0x320815;this[_0x138bac(0x152)]()[_0x138bac(0x156)](_0x5d02b1=>{const _0x47a65b=_0x138bac;console['error'](_0x47a65b(0x1a7),_0x5d02b1);}),this[_0x138bac(0x143)]=setInterval(async()=>{const _0x29cf71=_0x138bac;try{await this[_0x29cf71(0x152)]();}catch(_0x1b1f2f){console['error'](_0x29cf71(0x177),_0x1b1f2f);}},0x3c*0x3c*0x3e8),console[_0x138bac(0x1be)](_0x138bac(0x1ad));}[a36_0x320815(0x14c)](){const _0x438dd5=a36_0x320815;this[_0x438dd5(0x143)]&&(clearInterval(this[_0x438dd5(0x143)]),this[_0x438dd5(0x143)]=null,console['log'](_0x438dd5(0x1b8)));}async['updateCurrencyRates'](){const _0x72bb1c=a36_0x320815;try{console[_0x72bb1c(0x1be)](_0x72bb1c(0x1a6));const _0x140f98=this[_0x72bb1c(0x194)][_0x72bb1c(0x1bf)](','),_0x2b0aa6=this['COINGECKO_URL']+_0x72bb1c(0x15d)+_0x140f98,_0x4ce2f1=await fetch(_0x2b0aa6,{'headers':{'Accept':'application/json','User-Agent':_0x72bb1c(0x19e)}});if(!_0x4ce2f1['ok'])throw new Error(_0x72bb1c(0x16b)+_0x4ce2f1[_0x72bb1c(0x13f)]+'\x20'+_0x4ce2f1[_0x72bb1c(0x140)]);const _0x49abd2=await _0x4ce2f1[_0x72bb1c(0x19f)]();if(!_0x49abd2[_0x72bb1c(0x196)])throw new Error(_0x72bb1c(0x189));const _0x68430c=_0x49abd2[_0x72bb1c(0x196)];console[_0x72bb1c(0x1be)](_0x72bb1c(0x159)+Object[_0x72bb1c(0x1ae)](_0x68430c)[_0x72bb1c(0x1aa)]+_0x72bb1c(0x166));const _0x4bfbcb=Object[_0x72bb1c(0x1bc)](_0x68430c)['map'](async([_0x18cf9c,_0x426c88])=>{const _0x5d09c2=_0x72bb1c;try{await database_1['default']['currencyRate'][_0x5d09c2(0x1a2)]({'where':{'currency':_0x18cf9c['toLowerCase']()},'update':{'rate':_0x426c88},'create':{'currency':_0x18cf9c[_0x5d09c2(0x16d)](),'rate':_0x426c88}});}catch(_0x4012e2){console[_0x5d09c2(0x17a)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x18cf9c+':',_0x4012e2);}});await Promise[_0x72bb1c(0x148)](_0x4bfbcb),console['log'](_0x72bb1c(0x1ba));}catch(_0x25b0c4){console['error']('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x25b0c4);throw _0x25b0c4;}}async[a36_0x320815(0x15e)](_0x24ac0e){const _0x1f9fd2=a36_0x320815,_0x2cdeb3=_0x24ac0e[_0x1f9fd2(0x16d)]();if(_0x2cdeb3===_0x1f9fd2(0x145))return 0x1;try{const _0x57310b=await database_1[_0x1f9fd2(0x182)][_0x1f9fd2(0x1a9)]['findUnique']({'where':{'currency':_0x2cdeb3}});if(!_0x57310b)return console['warn'](_0x1f9fd2(0x1b1)+_0x24ac0e+_0x1f9fd2(0x161)),0x1;return _0x57310b[_0x1f9fd2(0x1b7)];}catch(_0x36a06e){return console[_0x1f9fd2(0x17a)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x24ac0e+':',_0x36a06e),0x1;}}async['convertToUSDT'](_0x2db7f5,_0x3c0fba){const _0x2bfe2a=a36_0x320815,_0x1c7403=_0x3c0fba[_0x2bfe2a(0x16d)]();if(_0x1c7403===_0x2bfe2a(0x145)){const _0x387226=_0x2db7f5*(0x1+this[_0x2bfe2a(0x192)]/0x64);return console['log'](_0x2bfe2a(0x1b5)+this[_0x2bfe2a(0x192)]+_0x2bfe2a(0x175)+_0x2db7f5+_0x2bfe2a(0x147)+_0x387226['toFixed'](0x6)+'\x20USDT'),_0x387226;}try{const _0x5b61a6=await this[_0x2bfe2a(0x15e)](_0x1c7403),_0x579fbe=_0x2db7f5/_0x5b61a6,_0x284eed=_0x579fbe*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x2bfe2a(0x1be)](_0x2bfe2a(0x17d)+_0x2db7f5+'\x20'+_0x3c0fba[_0x2bfe2a(0x185)]()+_0x2bfe2a(0x1c0)+_0x579fbe[_0x2bfe2a(0x149)](0x6)+'\x20USDT,\x20with\x20'+this[_0x2bfe2a(0x192)]+_0x2bfe2a(0x184)+_0x284eed[_0x2bfe2a(0x149)](0x6)+_0x2bfe2a(0x168)+_0x5b61a6+')'),_0x284eed;}catch(_0x281518){console['error'](_0x2bfe2a(0x186)+_0x2db7f5+'\x20'+_0x3c0fba+_0x2bfe2a(0x14b),_0x281518);const _0x2da937=_0x2db7f5*(0x1+this[_0x2bfe2a(0x192)]/0x64);return _0x2da937;}}async[a36_0x320815(0x1a3)](_0x59b223){const _0x11a610=a36_0x320815;let _0xaf22a8=0x0;for(const {amount:_0x22c48f,currency:_0x22e700}of _0x59b223){const _0x4fc13a=await this[_0x11a610(0x15c)](_0x22c48f,_0x22e700);_0xaf22a8+=_0x4fc13a;}return _0xaf22a8;}async['getAllRates'](){const _0x1eaffa=a36_0x320815;try{const _0x3af382=await database_1[_0x1eaffa(0x182)][_0x1eaffa(0x1a9)][_0x1eaffa(0x197)]({'select':{'currency':!![],'rate':!![]}}),_0x596ff5={'usdt':0x1};return _0x3af382[_0x1eaffa(0x15a)](_0x5af4f2=>{const _0x3993b6=_0x1eaffa;_0x596ff5[_0x5af4f2[_0x3993b6(0x18c)]]=_0x5af4f2[_0x3993b6(0x1b7)];}),_0x596ff5;}catch(_0x59b537){return console[_0x1eaffa(0x17a)](_0x1eaffa(0x174),_0x59b537),{'usdt':0x1};}}async[a36_0x320815(0x15f)](){const _0x50852f=a36_0x320815;try{const [_0x3f64a2,_0x18be3c,_0x53c7fd]=await Promise[_0x50852f(0x1b0)]([database_1[_0x50852f(0x182)]['currencyRate'][_0x50852f(0x193)](),database_1[_0x50852f(0x182)]['currencyRate'][_0x50852f(0x173)]({'orderBy':{'updatedAt':_0x50852f(0x19a)},'select':{'updatedAt':!![]}}),database_1[_0x50852f(0x182)][_0x50852f(0x1a9)][_0x50852f(0x173)]({'orderBy':{'updatedAt':_0x50852f(0x163)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f64a2,'lastUpdated':_0x18be3c?.[_0x50852f(0x18a)]||null,'oldestRate':_0x53c7fd?.[_0x50852f(0x18a)]||null,'markupPercentage':this[_0x50852f(0x192)]};}catch(_0x2c67ca){return console[_0x50852f(0x17a)](_0x50852f(0x180),_0x2c67ca),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a36_0x320815(0x17c)](){const _0x38274b=a36_0x320815;return this[_0x38274b(0x192)];}}exports[a36_0x320815(0x17f)]=CurrencyService,exports[a36_0x320815(0x1b4)]=new CurrencyService();function a36_0x4ea9(){const _0x323601=['CoinGecko\x20API\x20error:\x20','sar','toLowerCase','thb','489644qgoUOG','6204464ofTzDO','vnd','ars','findFirst','Error\x20getting\x20all\x20rates:','%\x20markup\x20to\x20','mmk','Periodic\x20currency\x20rates\x20update\x20failed:','mxn','aud','error','bits','getMarkupPercentage','ðŸ’±\x20Converted\x20','xag','CurrencyService','Error\x20getting\x20rates\x20status:','startPeriodicUpdates','default','gbp','%\x20markup\x20=\x20','toUpperCase','Error\x20converting\x20','cny','gel','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','updatedAt','link','currency','sgd','xlm','xau','nok','kwd','MARKUP_PERCENTAGE','count','CURRENCIES','zar','tether','findMany','eur','bnb','desc','rub','../config/database','brl','TesSoft\x20Payment\x20System/1.0','json','https://api.coingecko.com/api/v3/simple/price','czk','upsert','convertMultipleToUSDT','xrp','try','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Initial\x20currency\x20rates\x20update\x20failed:','cad','currencyRate','length','ltc','jpy','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','keys','yfi','all','No\x20rate\x20found\x20for\x20currency:\x20','__esModule','twd','currencyService','ðŸ’±\x20Applied\x20','pln','rate','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','1792452LWUcrr','âœ…\x20Currency\x20rates\x20updated\x20successfully','2970216ukiIrQ','entries','719316GzOfrx','log','join','\x20to\x20','1tCYEcE','sek','status','statusText','uah','btc','updateInterval','eth','usdt','chf','\x20USDT\x20=\x20','allSettled','toFixed','321789hdBUaQ','\x20to\x20USDT:','stopPeriodicUpdates','bdt','inr','ngn','dot','eos','updateCurrencyRates','usd','myr','pkr','catch','xdr','aed','ðŸ“Š\x20Received\x20rates\x20for\x20','forEach','15jKkGZb','convertToUSDT','?ids=tether&vs_currencies=','getCurrencyRate','getRatesStatus','vef',',\x20using\x201\x20as\x20fallback','ils','asc','bmd','sats','\x20currencies','dkk','\x20USDT\x20(rate:\x20','krw','6040125lGKCEF'];a36_0x4ea9=function(){return _0x323601;};return a36_0x4ea9();}