'use strict';const a36_0xc13dc1=a36_0x3bc1;function a36_0x3bc1(_0x20aca3,_0x931536){const _0x11501b=a36_0x1150();return a36_0x3bc1=function(_0x3bc181,_0x186e21){_0x3bc181=_0x3bc181-0x175;let _0x4dc038=_0x11501b[_0x3bc181];return _0x4dc038;},a36_0x3bc1(_0x20aca3,_0x931536);}(function(_0x239d6a,_0x27e8b2){const _0x22f4fc=a36_0x3bc1,_0x3cf47a=_0x239d6a();while(!![]){try{const _0x98b352=-parseInt(_0x22f4fc(0x1dc))/0x1+parseInt(_0x22f4fc(0x1d0))/0x2+-parseInt(_0x22f4fc(0x187))/0x3*(parseInt(_0x22f4fc(0x199))/0x4)+parseInt(_0x22f4fc(0x1a0))/0x5+parseInt(_0x22f4fc(0x1db))/0x6*(parseInt(_0x22f4fc(0x1b7))/0x7)+-parseInt(_0x22f4fc(0x182))/0x8+-parseInt(_0x22f4fc(0x1d3))/0x9*(-parseInt(_0x22f4fc(0x1c7))/0xa);if(_0x98b352===_0x27e8b2)break;else _0x3cf47a['push'](_0x3cf47a['shift']());}catch(_0xadf803){_0x3cf47a['push'](_0x3cf47a['shift']());}}}(a36_0x1150,0x863a4));var __importDefault=this&&this[a36_0xc13dc1(0x1d5)]||function(_0x35f735){const _0x220bac=a36_0xc13dc1;return _0x35f735&&_0x35f735[_0x220bac(0x1a7)]?_0x35f735:{'default':_0x35f735};};Object[a36_0xc13dc1(0x1c2)](exports,'__esModule',{'value':!![]}),exports[a36_0xc13dc1(0x17d)]=exports[a36_0xc13dc1(0x1cc)]=void 0x0;function a36_0x1150(){const _0x1127a0=['sats','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','cny','count','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','startPeriodicUpdates','twd','bch','https://api.coingecko.com/api/v3/simple/price','defineProperty','clp','log','thb','xdr','52790kbLHKX','json','\x20USDT\x20(rate:\x20','%\x20markup\x20=\x20','../config/database','CurrencyService','huf','chf','czk','2007846qgNJHM','eur','ars','531fIlLXQ','Error\x20getting\x20rate\x20for\x20currency\x20','__importDefault','nok','status','error','toFixed','eth','5876148ykSgfJ','588067kRinRN','CoinGecko\x20API\x20error:\x20','forEach',',\x20using\x201\x20as\x20fallback','findFirst','Error\x20getting\x20rates\x20status:','pkr','\x20USDT\x20=\x20','dot','desc','bhd','usd','\x20to\x20USDT:','allSettled','application/json','convertToUSDT','\x20currencies','\x20to\x20','currencyService','dkk','tether','try','xlm','5858440YhaUKZ','vnd','Error\x20converting\x20','map','warn','358932LxJvhI','ltc','getRatesStatus','Periodic\x20currency\x20rates\x20update\x20failed:','ðŸ“Š\x20Received\x20rates\x20for\x20','mmk','stopPeriodicUpdates','entries','cad','\x20USDT,\x20with\x20','\x20USDT','krw','ils','link','updatedAt','MARKUP_PERCENTAGE','lkr','updateInterval','16ooSXSx','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','aud','toLowerCase','uah','rate','Failed\x20to\x20update\x20rate\x20for\x20','270010scwkVE','getCurrencyRate','convertMultipleToUSDT','findUnique','asc','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','mxn','__esModule','updateCurrencyRates','eos','getAllRates','vef','findMany','currencyRate','default','xrp','CURRENCIES','usdt','php','âœ…\x20Currency\x20rates\x20updated\x20successfully','getMarkupPercentage','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','nzd','7XWrOsc','sgd'];a36_0x1150=function(){return _0x1127a0;};return a36_0x1150();}const database_1=__importDefault(require(a36_0xc13dc1(0x1cb)));class CurrencyService{constructor(){const _0x34a8c9=a36_0xc13dc1;this['COINGECKO_URL']=_0x34a8c9(0x1c1),this[_0x34a8c9(0x1b0)]=['btc',_0x34a8c9(0x1da),_0x34a8c9(0x188),_0x34a8c9(0x1c0),'bnb',_0x34a8c9(0x1a9),_0x34a8c9(0x1af),_0x34a8c9(0x181),_0x34a8c9(0x194),_0x34a8c9(0x1e4),'yfi',_0x34a8c9(0x176),'aed',_0x34a8c9(0x1d2),_0x34a8c9(0x19b),'bdt',_0x34a8c9(0x175),'bmd','brl',_0x34a8c9(0x18f),_0x34a8c9(0x1ce),_0x34a8c9(0x1c3),_0x34a8c9(0x1bb),_0x34a8c9(0x1cf),_0x34a8c9(0x17e),_0x34a8c9(0x1d1),'gbp','gel','hkd',_0x34a8c9(0x1cd),'idr',_0x34a8c9(0x193),'inr','jpy',_0x34a8c9(0x192),'kwd',_0x34a8c9(0x197),_0x34a8c9(0x18c),_0x34a8c9(0x1a6),'myr','ngn',_0x34a8c9(0x1d6),_0x34a8c9(0x1b6),_0x34a8c9(0x1b2),_0x34a8c9(0x1e2),'pln','rub','sar','sek',_0x34a8c9(0x1b8),_0x34a8c9(0x1c5),_0x34a8c9(0x180),_0x34a8c9(0x1bf),_0x34a8c9(0x19d),_0x34a8c9(0x1ab),_0x34a8c9(0x183),'zar',_0x34a8c9(0x1c6),'xag','xau','bits',_0x34a8c9(0x1b9)],this[_0x34a8c9(0x198)]=null,this[_0x34a8c9(0x196)]=0x3,this[_0x34a8c9(0x1be)]();}[a36_0xc13dc1(0x1be)](){const _0x3ea8ef=a36_0xc13dc1;this[_0x3ea8ef(0x1a8)]()['catch'](_0xc7bf7=>{const _0x5bc89a=_0x3ea8ef;console[_0x5bc89a(0x1d8)]('Initial\x20currency\x20rates\x20update\x20failed:',_0xc7bf7);}),this[_0x3ea8ef(0x198)]=setInterval(async()=>{const _0xe13261=_0x3ea8ef;try{await this[_0xe13261(0x1a8)]();}catch(_0x5efc6f){console[_0xe13261(0x1d8)](_0xe13261(0x18a),_0x5efc6f);}},0x3c*0x3c*0x3e8),console[_0x3ea8ef(0x1c4)](_0x3ea8ef(0x1bd));}[a36_0xc13dc1(0x18d)](){const _0x95f9e1=a36_0xc13dc1;this[_0x95f9e1(0x198)]&&(clearInterval(this[_0x95f9e1(0x198)]),this[_0x95f9e1(0x198)]=null,console[_0x95f9e1(0x1c4)](_0x95f9e1(0x1ba)));}async[a36_0xc13dc1(0x1a8)](){const _0x30b032=a36_0xc13dc1;try{console[_0x30b032(0x1c4)](_0x30b032(0x1b5));const _0x21828a=this[_0x30b032(0x1b0)]['join'](','),_0x14f3b4=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x21828a,_0x4fe9bd=await fetch(_0x14f3b4,{'headers':{'Accept':_0x30b032(0x179),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x4fe9bd['ok'])throw new Error(_0x30b032(0x1dd)+_0x4fe9bd[_0x30b032(0x1d7)]+'\x20'+_0x4fe9bd['statusText']);const _0x1f5092=await _0x4fe9bd[_0x30b032(0x1c8)]();if(!_0x1f5092[_0x30b032(0x17f)])throw new Error(_0x30b032(0x1a5));const _0x5ef16d=_0x1f5092['tether'];console[_0x30b032(0x1c4)](_0x30b032(0x18b)+Object['keys'](_0x5ef16d)['length']+_0x30b032(0x17b));const _0x2b1c35=Object[_0x30b032(0x18e)](_0x5ef16d)[_0x30b032(0x185)](async([_0x2d3f93,_0xb9c638])=>{const _0x233a41=_0x30b032;try{await database_1[_0x233a41(0x1ae)][_0x233a41(0x1ad)]['upsert']({'where':{'currency':_0x2d3f93['toLowerCase']()},'update':{'rate':_0xb9c638},'create':{'currency':_0x2d3f93[_0x233a41(0x19c)](),'rate':_0xb9c638}});}catch(_0x3ed7da){console[_0x233a41(0x1d8)](_0x233a41(0x19f)+_0x2d3f93+':',_0x3ed7da);}});await Promise[_0x30b032(0x178)](_0x2b1c35),console[_0x30b032(0x1c4)](_0x30b032(0x1b3));}catch(_0xa4c605){console[_0x30b032(0x1d8)](_0x30b032(0x19a),_0xa4c605);throw _0xa4c605;}}async[a36_0xc13dc1(0x1a1)](_0x579776){const _0xc93c80=a36_0xc13dc1,_0x65d6f0=_0x579776[_0xc93c80(0x19c)]();if(_0x65d6f0==='usdt')return 0x1;try{const _0x38c035=await database_1[_0xc93c80(0x1ae)][_0xc93c80(0x1ad)][_0xc93c80(0x1a3)]({'where':{'currency':_0x65d6f0}});if(!_0x38c035)return console[_0xc93c80(0x186)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x579776+_0xc93c80(0x1df)),0x1;return _0x38c035[_0xc93c80(0x19e)];}catch(_0x4c6c58){return console[_0xc93c80(0x1d8)](_0xc93c80(0x1d4)+_0x579776+':',_0x4c6c58),0x1;}}async[a36_0xc13dc1(0x17a)](_0x27b93b,_0x4a77f8){const _0x4a3d92=a36_0xc13dc1,_0x3c85fd=_0x4a77f8[_0x4a3d92(0x19c)]();if(_0x3c85fd===_0x4a3d92(0x1b1)){const _0x5f44cd=_0x27b93b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log']('ðŸ’±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x27b93b+_0x4a3d92(0x1e3)+_0x5f44cd[_0x4a3d92(0x1d9)](0x6)+_0x4a3d92(0x191)),_0x5f44cd;}try{const _0x209bef=await this[_0x4a3d92(0x1a1)](_0x3c85fd),_0x533851=_0x27b93b/_0x209bef,_0x2df603=_0x533851*(0x1+this[_0x4a3d92(0x196)]/0x64);return console[_0x4a3d92(0x1c4)]('ðŸ’±\x20Converted\x20'+_0x27b93b+'\x20'+_0x4a77f8['toUpperCase']()+_0x4a3d92(0x17c)+_0x533851[_0x4a3d92(0x1d9)](0x6)+_0x4a3d92(0x190)+this[_0x4a3d92(0x196)]+_0x4a3d92(0x1ca)+_0x2df603[_0x4a3d92(0x1d9)](0x6)+_0x4a3d92(0x1c9)+_0x209bef+')'),_0x2df603;}catch(_0x25675b){console['error'](_0x4a3d92(0x184)+_0x27b93b+'\x20'+_0x4a77f8+_0x4a3d92(0x177),_0x25675b);const _0x5c296b=_0x27b93b*(0x1+this[_0x4a3d92(0x196)]/0x64);return _0x5c296b;}}async[a36_0xc13dc1(0x1a2)](_0x3cd289){const _0x27150b=a36_0xc13dc1;let _0x1ff91d=0x0;for(const {amount:_0x391b1b,currency:_0x1bff58}of _0x3cd289){const _0x3f4d62=await this[_0x27150b(0x17a)](_0x391b1b,_0x1bff58);_0x1ff91d+=_0x3f4d62;}return _0x1ff91d;}async[a36_0xc13dc1(0x1aa)](){const _0x290de7=a36_0xc13dc1;try{const _0x31be47=await database_1[_0x290de7(0x1ae)][_0x290de7(0x1ad)][_0x290de7(0x1ac)]({'select':{'currency':!![],'rate':!![]}}),_0x508654={'usdt':0x1};return _0x31be47[_0x290de7(0x1de)](_0x219399=>{_0x508654[_0x219399['currency']]=_0x219399['rate'];}),_0x508654;}catch(_0x43315d){return console['error']('Error\x20getting\x20all\x20rates:',_0x43315d),{'usdt':0x1};}}async[a36_0xc13dc1(0x189)](){const _0x2a8de1=a36_0xc13dc1;try{const [_0x499f1d,_0x4e3dbe,_0x5e24ff]=await Promise['all']([database_1[_0x2a8de1(0x1ae)][_0x2a8de1(0x1ad)][_0x2a8de1(0x1bc)](),database_1[_0x2a8de1(0x1ae)][_0x2a8de1(0x1ad)][_0x2a8de1(0x1e0)]({'orderBy':{'updatedAt':_0x2a8de1(0x1e5)},'select':{'updatedAt':!![]}}),database_1[_0x2a8de1(0x1ae)][_0x2a8de1(0x1ad)][_0x2a8de1(0x1e0)]({'orderBy':{'updatedAt':_0x2a8de1(0x1a4)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x499f1d,'lastUpdated':_0x4e3dbe?.['updatedAt']||null,'oldestRate':_0x5e24ff?.[_0x2a8de1(0x195)]||null,'markupPercentage':this[_0x2a8de1(0x196)]};}catch(_0x3ee812){return console['error'](_0x2a8de1(0x1e1),_0x3ee812),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a36_0xc13dc1(0x1b4)](){const _0x11cab3=a36_0xc13dc1;return this[_0x11cab3(0x196)];}}exports[a36_0xc13dc1(0x1cc)]=CurrencyService,exports[a36_0xc13dc1(0x17d)]=new CurrencyService();