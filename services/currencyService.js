'use strict';const a39_0x43547a=a39_0x17c9;(function(_0x500432,_0x51f138){const _0x2f11ea=a39_0x17c9,_0x523e75=_0x500432();while(!![]){try{const _0x3c1da2=parseInt(_0x2f11ea(0x219))/0x1+parseInt(_0x2f11ea(0x1d8))/0x2+-parseInt(_0x2f11ea(0x1f3))/0x3*(-parseInt(_0x2f11ea(0x1eb))/0x4)+-parseInt(_0x2f11ea(0x214))/0x5*(-parseInt(_0x2f11ea(0x1b5))/0x6)+parseInt(_0x2f11ea(0x1d3))/0x7*(-parseInt(_0x2f11ea(0x1e7))/0x8)+-parseInt(_0x2f11ea(0x1d1))/0x9*(-parseInt(_0x2f11ea(0x203))/0xa)+parseInt(_0x2f11ea(0x1a1))/0xb*(-parseInt(_0x2f11ea(0x1bc))/0xc);if(_0x3c1da2===_0x51f138)break;else _0x523e75['push'](_0x523e75['shift']());}catch(_0x3fc031){_0x523e75['push'](_0x523e75['shift']());}}}(a39_0x45f6,0x36368));var __importDefault=this&&this[a39_0x43547a(0x1f6)]||function(_0x4ceac7){const _0x298589=a39_0x43547a;return _0x4ceac7&&_0x4ceac7[_0x298589(0x211)]?_0x4ceac7:{'default':_0x4ceac7};};Object[a39_0x43547a(0x1e5)](exports,a39_0x43547a(0x211),{'value':!![]}),exports[a39_0x43547a(0x1be)]=exports[a39_0x43547a(0x204)]=void 0x0;const database_1=__importDefault(require(a39_0x43547a(0x1a9)));function a39_0x45f6(){const _0x7c4098=['error','204996kDxrIn','findFirst','currencyService','ngn','stopPeriodicUpdates','usdt','sats','startPeriodicUpdates','convertToUSDT','sek','catch','toLowerCase','dkk','length','Error\x20getting\x20all\x20rates:','updateCurrencyRates','idr','tether','btc','default','Error\x20getting\x20rate\x20for\x20currency\x20','153oHiYTA','bdt','7JQINmC','usd','keys','lkr','statusText','586142XDjmKH','sgd','https://api.coingecko.com/api/v3/simple/price','\x20USDT,\x20with\x20','bits','findUnique','entries','xdr','bch','rate','eth','vef','Initial\x20currency\x20rates\x20update\x20failed:','defineProperty','bnb','1882256uQkLOZ','json','xau','forEach','504156tdoZvg','Periodic\x20currency\x20rates\x20update\x20failed:','mmk','asc','allSettled','CURRENCIES','hkd','getCurrencyRate','3ekIaOQ','\x20USDT','MARKUP_PERCENTAGE','__importDefault','\x20USDT\x20=\x20','rub','count','✅\x20Currency\x20rates\x20updated\x20successfully','inr','Error\x20getting\x20rates\x20status:','sar','pln','xlm','%\x20markup\x20to\x20','\x20to\x20USDT:','\x20currencies','137420eXoMef','CurrencyService','ltc','brl','map','aed','gbp','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','pkr','bhd','clp','currency','upsert','No\x20rate\x20found\x20for\x20currency:\x20','__esModule','myr','?ids=tether&vs_currencies=','127265ErmZdq','zar','cad','CoinGecko\x20API\x20error:\x20','uah','336931WXQFEa','huf','all','COINGECKO_URL','currencyRate',',\x20using\x201\x20as\x20fallback','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','mxn','status','aud','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','log','605MkAfiQ','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','getAllRates','convertMultipleToUSDT','application/json','toFixed','warn','link','../config/database','bmd','czk','ars','updatedAt','updateInterval','vnd','thb','getMarkupPercentage','gel','❌\x20Failed\x20to\x20update\x20currency\x20rates:','jpy','96WUwxry','xag','join','findMany','php','TesSoft\x20Payment\x20System/1.0'];a39_0x45f6=function(){return _0x7c4098;};return a39_0x45f6();}function a39_0x17c9(_0x113c3e,_0xa14d8){const _0x45f69c=a39_0x45f6();return a39_0x17c9=function(_0x17c967,_0x289f97){_0x17c967=_0x17c967-0x197;let _0x52ee3e=_0x45f69c[_0x17c967];return _0x52ee3e;},a39_0x17c9(_0x113c3e,_0xa14d8);}class CurrencyService{constructor(){const _0x39088e=a39_0x43547a;this['COINGECKO_URL']=_0x39088e(0x1da),this[_0x39088e(0x1f0)]=[_0x39088e(0x1ce),_0x39088e(0x1e2),_0x39088e(0x205),_0x39088e(0x1e0),_0x39088e(0x1e6),'eos','xrp',_0x39088e(0x1ff),_0x39088e(0x1a8),'dot','yfi',_0x39088e(0x1d4),_0x39088e(0x208),_0x39088e(0x1ac),_0x39088e(0x19e),_0x39088e(0x1d2),_0x39088e(0x20c),_0x39088e(0x1aa),_0x39088e(0x206),_0x39088e(0x216),'chf',_0x39088e(0x20d),'cny',_0x39088e(0x1ab),_0x39088e(0x1c8),'eur',_0x39088e(0x209),_0x39088e(0x1b2),_0x39088e(0x1f1),_0x39088e(0x21a),_0x39088e(0x1cc),'ils',_0x39088e(0x1fb),_0x39088e(0x1b4),'krw','kwd',_0x39088e(0x1d6),_0x39088e(0x1ed),_0x39088e(0x19c),_0x39088e(0x212),_0x39088e(0x1bf),'nok','nzd',_0x39088e(0x1b9),_0x39088e(0x20b),_0x39088e(0x1fe),_0x39088e(0x1f8),_0x39088e(0x1fd),_0x39088e(0x1c5),_0x39088e(0x1d9),_0x39088e(0x1b0),'try','twd',_0x39088e(0x218),_0x39088e(0x1e3),_0x39088e(0x1af),_0x39088e(0x215),_0x39088e(0x1df),_0x39088e(0x1b6),_0x39088e(0x1e9),_0x39088e(0x1dc),_0x39088e(0x1c2)],this[_0x39088e(0x1ae)]=null,this[_0x39088e(0x1f5)]=0x3,this[_0x39088e(0x1c3)]();}['startPeriodicUpdates'](){const _0x369278=a39_0x43547a;this[_0x369278(0x1cb)]()[_0x369278(0x1c6)](_0x2a9d02=>{const _0x14edb5=_0x369278;console['error'](_0x14edb5(0x1e4),_0x2a9d02);}),this[_0x369278(0x1ae)]=setInterval(async()=>{const _0x4d6807=_0x369278;try{await this[_0x4d6807(0x1cb)]();}catch(_0x2e7caf){console[_0x4d6807(0x1bb)](_0x4d6807(0x1ec),_0x2e7caf);}},0x3c*0x3c*0x3e8),console['log'](_0x369278(0x1a2));}[a39_0x43547a(0x1c0)](){const _0x4d386b=a39_0x43547a;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x4d386b(0x1ae)]=null,console[_0x4d386b(0x1a0)](_0x4d386b(0x20a)));}async[a39_0x43547a(0x1cb)](){const _0x380c5c=a39_0x43547a;try{console[_0x380c5c(0x1a0)](_0x380c5c(0x19f));const _0x203160=this[_0x380c5c(0x1f0)][_0x380c5c(0x1b7)](','),_0x59989e=this[_0x380c5c(0x198)]+_0x380c5c(0x213)+_0x203160,_0x10b70e=await fetch(_0x59989e,{'headers':{'Accept':_0x380c5c(0x1a5),'User-Agent':_0x380c5c(0x1ba)}});if(!_0x10b70e['ok'])throw new Error(_0x380c5c(0x217)+_0x10b70e[_0x380c5c(0x19d)]+'\x20'+_0x10b70e[_0x380c5c(0x1d7)]);const _0x5376d4=await _0x10b70e[_0x380c5c(0x1e8)]();if(!_0x5376d4[_0x380c5c(0x1cd)])throw new Error(_0x380c5c(0x19b));const _0x12c086=_0x5376d4[_0x380c5c(0x1cd)];console[_0x380c5c(0x1a0)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x380c5c(0x1d5)](_0x12c086)[_0x380c5c(0x1c9)]+_0x380c5c(0x202));const _0x3a106f=Object[_0x380c5c(0x1de)](_0x12c086)[_0x380c5c(0x207)](async([_0x395ca,_0x3a8f66])=>{const _0x5c1d16=_0x380c5c;try{await database_1['default'][_0x5c1d16(0x199)][_0x5c1d16(0x20f)]({'where':{'currency':_0x395ca[_0x5c1d16(0x1c7)]()},'update':{'rate':_0x3a8f66},'create':{'currency':_0x395ca[_0x5c1d16(0x1c7)](),'rate':_0x3a8f66}});}catch(_0x13b9ed){console[_0x5c1d16(0x1bb)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x395ca+':',_0x13b9ed);}});await Promise[_0x380c5c(0x1ef)](_0x3a106f),console[_0x380c5c(0x1a0)](_0x380c5c(0x1fa));}catch(_0x436a66){console[_0x380c5c(0x1bb)](_0x380c5c(0x1b3),_0x436a66);throw _0x436a66;}}async[a39_0x43547a(0x1f2)](_0x4f9034){const _0xde49c1=a39_0x43547a,_0xd683b0=_0x4f9034['toLowerCase']();if(_0xd683b0===_0xde49c1(0x1c1))return 0x1;try{const _0x15b3c1=await database_1[_0xde49c1(0x1cf)][_0xde49c1(0x199)][_0xde49c1(0x1dd)]({'where':{'currency':_0xd683b0}});if(!_0x15b3c1)return console[_0xde49c1(0x1a7)](_0xde49c1(0x210)+_0x4f9034+_0xde49c1(0x19a)),0x1;return _0x15b3c1['rate'];}catch(_0x93bfd1){return console[_0xde49c1(0x1bb)](_0xde49c1(0x1d0)+_0x4f9034+':',_0x93bfd1),0x1;}}async[a39_0x43547a(0x1c4)](_0x9a198f,_0x22055e){const _0x137c95=a39_0x43547a,_0x5b0761=_0x22055e[_0x137c95(0x1c7)]();if(_0x5b0761==='usdt'){const _0x2be835=_0x9a198f*(0x1+this[_0x137c95(0x1f5)]/0x64);return console[_0x137c95(0x1a0)]('💱\x20Applied\x20'+this[_0x137c95(0x1f5)]+_0x137c95(0x200)+_0x9a198f+_0x137c95(0x1f7)+_0x2be835[_0x137c95(0x1a6)](0x6)+_0x137c95(0x1f4)),_0x2be835;}try{const _0x44805f=await this[_0x137c95(0x1f2)](_0x5b0761),_0x209d5e=_0x9a198f/_0x44805f,_0x27280d=_0x209d5e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log']('💱\x20Converted\x20'+_0x9a198f+'\x20'+_0x22055e['toUpperCase']()+'\x20to\x20'+_0x209d5e[_0x137c95(0x1a6)](0x6)+_0x137c95(0x1db)+this[_0x137c95(0x1f5)]+'%\x20markup\x20=\x20'+_0x27280d[_0x137c95(0x1a6)](0x6)+'\x20USDT\x20(rate:\x20'+_0x44805f+')'),_0x27280d;}catch(_0x4c9e28){console['error']('Error\x20converting\x20'+_0x9a198f+'\x20'+_0x22055e+_0x137c95(0x201),_0x4c9e28);const _0x1acfe8=_0x9a198f*(0x1+this[_0x137c95(0x1f5)]/0x64);return _0x1acfe8;}}async[a39_0x43547a(0x1a4)](_0xf46566){const _0x77e816=a39_0x43547a;let _0x30d45e=0x0;for(const {amount:_0x31fc86,currency:_0x4cef63}of _0xf46566){const _0x415c1d=await this[_0x77e816(0x1c4)](_0x31fc86,_0x4cef63);_0x30d45e+=_0x415c1d;}return _0x30d45e;}async[a39_0x43547a(0x1a3)](){const _0x1a654f=a39_0x43547a;try{const _0x131389=await database_1['default'][_0x1a654f(0x199)][_0x1a654f(0x1b8)]({'select':{'currency':!![],'rate':!![]}}),_0x3e159={'usdt':0x1};return _0x131389[_0x1a654f(0x1ea)](_0x19c15d=>{const _0x34f957=_0x1a654f;_0x3e159[_0x19c15d[_0x34f957(0x20e)]]=_0x19c15d[_0x34f957(0x1e1)];}),_0x3e159;}catch(_0x650f1e){return console[_0x1a654f(0x1bb)](_0x1a654f(0x1ca),_0x650f1e),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2540d2=a39_0x43547a;try{const [_0x376631,_0x573884,_0x2d1faa]=await Promise[_0x2540d2(0x197)]([database_1[_0x2540d2(0x1cf)][_0x2540d2(0x199)][_0x2540d2(0x1f9)](),database_1[_0x2540d2(0x1cf)][_0x2540d2(0x199)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x2540d2(0x1cf)][_0x2540d2(0x199)][_0x2540d2(0x1bd)]({'orderBy':{'updatedAt':_0x2540d2(0x1ee)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x376631,'lastUpdated':_0x573884?.['updatedAt']||null,'oldestRate':_0x2d1faa?.[_0x2540d2(0x1ad)]||null,'markupPercentage':this[_0x2540d2(0x1f5)]};}catch(_0x426151){return console[_0x2540d2(0x1bb)](_0x2540d2(0x1fc),_0x426151),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x43547a(0x1b1)](){const _0x38d52f=a39_0x43547a;return this[_0x38d52f(0x1f5)];}}exports[a39_0x43547a(0x204)]=CurrencyService,exports[a39_0x43547a(0x1be)]=new CurrencyService();