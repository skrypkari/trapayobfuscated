'use strict';const a38_0x77e30a=a38_0x3427;(function(_0xb8fe2e,_0x5a68da){const _0x4207b6=a38_0x3427,_0x4a1684=_0xb8fe2e();while(!![]){try{const _0x2fb149=-parseInt(_0x4207b6(0x213))/0x1+parseInt(_0x4207b6(0x25c))/0x2+parseInt(_0x4207b6(0x244))/0x3*(-parseInt(_0x4207b6(0x25d))/0x4)+parseInt(_0x4207b6(0x271))/0x5*(-parseInt(_0x4207b6(0x21d))/0x6)+-parseInt(_0x4207b6(0x26b))/0x7*(-parseInt(_0x4207b6(0x202))/0x8)+parseInt(_0x4207b6(0x21f))/0x9+-parseInt(_0x4207b6(0x223))/0xa*(parseInt(_0x4207b6(0x251))/0xb);if(_0x2fb149===_0x5a68da)break;else _0x4a1684['push'](_0x4a1684['shift']());}catch(_0x3a965c){_0x4a1684['push'](_0x4a1684['shift']());}}}(a38_0x4aa1,0x365cf));function a38_0x4aa1(){const _0x808e5=['gbp','error','bhd','catch','16DZZgNJ','Failed\x20to\x20update\x20rate\x20for\x20','convertToUSDT','krw','eth','💱\x20Converted\x20','ars','nzd','bch','../config/database','ltc','php','currency','sar','__esModule','pln','Error\x20getting\x20all\x20rates:','134522AvcWlo','%\x20markup\x20to\x20','MARKUP_PERCENTAGE','No\x20rate\x20found\x20for\x20currency:\x20','rate','xrp','upsert','📊\x20Received\x20rates\x20for\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','findFirst','12eNQczE','https://api.coingecko.com/api/v3/simple/price','2692251JTVeRI','defineProperty','sgd','default','2359330EgLKhy','Error\x20getting\x20rate\x20for\x20currency\x20','\x20USDT\x20=\x20','yfi','CoinGecko\x20API\x20error:\x20','chf','xdr','mmk','zar','getMarkupPercentage','gel','COINGECKO_URL','❌\x20Failed\x20to\x20update\x20currency\x20rates:','dkk','convertMultipleToUSDT','usd','dot','uah','forEach','toFixed','all','czk','nok','inr','Error\x20converting\x20','status','getCurrencyRate','cad','getAllRates','log','twd','huf','pkr','9rkJzJw','updatedAt','Initial\x20currency\x20rates\x20update\x20failed:','ngn','application/json','myr','TesSoft\x20Payment\x20System/1.0','startPeriodicUpdates','kwd','aed','__importDefault','xag','updateInterval','11BbLHot','bnb','Error\x20getting\x20rates\x20status:','link','clp','getRatesStatus','eur','xlm','CurrencyService','try','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','408214YMpojX','365048iZDMmd','brl','json',',\x20using\x201\x20as\x20fallback','toUpperCase','btc','thb','%\x20markup\x20=\x20','stopPeriodicUpdates','findUnique','statusText','xau','jpy','💱\x20Applied\x20','1408729ktPMnu','rub','currencyRate','Periodic\x20currency\x20rates\x20update\x20failed:','toLowerCase','\x20to\x20USDT:','97070nYcSgc','vef','bits','usdt','vnd','tether','length','CURRENCIES','updateCurrencyRates','currencyService','bmd','allSettled'];a38_0x4aa1=function(){return _0x808e5;};return a38_0x4aa1();}var __importDefault=this&&this[a38_0x77e30a(0x24e)]||function(_0x17c792){const _0x389e56=a38_0x77e30a;return _0x17c792&&_0x17c792[_0x389e56(0x210)]?_0x17c792:{'default':_0x17c792};};Object[a38_0x77e30a(0x220)](exports,a38_0x77e30a(0x210),{'value':!![]}),exports[a38_0x77e30a(0x1fb)]=exports[a38_0x77e30a(0x259)]=void 0x0;const database_1=__importDefault(require(a38_0x77e30a(0x20b)));class CurrencyService{constructor(){const _0x399d0c=a38_0x77e30a;this[_0x399d0c(0x22e)]=_0x399d0c(0x21e),this['CURRENCIES']=[_0x399d0c(0x262),_0x399d0c(0x206),_0x399d0c(0x20c),_0x399d0c(0x20a),_0x399d0c(0x252),'eos',_0x399d0c(0x218),_0x399d0c(0x258),_0x399d0c(0x254),_0x399d0c(0x233),_0x399d0c(0x226),_0x399d0c(0x232),_0x399d0c(0x24d),_0x399d0c(0x208),'aud','bdt',_0x399d0c(0x200),_0x399d0c(0x1fc),_0x399d0c(0x25e),_0x399d0c(0x23e),_0x399d0c(0x228),_0x399d0c(0x255),'cny',_0x399d0c(0x238),_0x399d0c(0x230),_0x399d0c(0x257),_0x399d0c(0x1fe),_0x399d0c(0x22d),'hkd',_0x399d0c(0x242),'idr','ils',_0x399d0c(0x23a),_0x399d0c(0x269),_0x399d0c(0x205),_0x399d0c(0x24c),'lkr',_0x399d0c(0x22a),'mxn',_0x399d0c(0x249),_0x399d0c(0x247),_0x399d0c(0x239),_0x399d0c(0x209),_0x399d0c(0x20d),_0x399d0c(0x243),_0x399d0c(0x211),_0x399d0c(0x26c),_0x399d0c(0x20f),'sek',_0x399d0c(0x221),_0x399d0c(0x263),_0x399d0c(0x25a),_0x399d0c(0x241),_0x399d0c(0x234),_0x399d0c(0x1f3),_0x399d0c(0x1f6),_0x399d0c(0x22b),_0x399d0c(0x229),_0x399d0c(0x24f),_0x399d0c(0x268),_0x399d0c(0x1f4),'sats'],this[_0x399d0c(0x250)]=null,this[_0x399d0c(0x215)]=0x3,this[_0x399d0c(0x24b)]();}[a38_0x77e30a(0x24b)](){const _0x1b45de=a38_0x77e30a;this[_0x1b45de(0x1fa)]()[_0x1b45de(0x201)](_0xee5799=>{const _0x5fc569=_0x1b45de;console['error'](_0x5fc569(0x246),_0xee5799);}),this[_0x1b45de(0x250)]=setInterval(async()=>{const _0x178036=_0x1b45de;try{await this['updateCurrencyRates']();}catch(_0x2c7b2b){console[_0x178036(0x1ff)](_0x178036(0x26e),_0x2c7b2b);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x77e30a(0x265)](){const _0xe1f587=a38_0x77e30a;this[_0xe1f587(0x250)]&&(clearInterval(this[_0xe1f587(0x250)]),this[_0xe1f587(0x250)]=null,console[_0xe1f587(0x240)](_0xe1f587(0x21b)));}async['updateCurrencyRates'](){const _0x20010d=a38_0x77e30a;try{console[_0x20010d(0x240)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x3ef999=this[_0x20010d(0x1f9)]['join'](','),_0x917e10=this[_0x20010d(0x22e)]+'?ids=tether&vs_currencies='+_0x3ef999,_0x3bdb6c=await fetch(_0x917e10,{'headers':{'Accept':_0x20010d(0x248),'User-Agent':_0x20010d(0x24a)}});if(!_0x3bdb6c['ok'])throw new Error(_0x20010d(0x227)+_0x3bdb6c[_0x20010d(0x23c)]+'\x20'+_0x3bdb6c[_0x20010d(0x267)]);const _0x5915f8=await _0x3bdb6c[_0x20010d(0x25f)]();if(!_0x5915f8[_0x20010d(0x1f7)])throw new Error(_0x20010d(0x25b));const _0x59e325=_0x5915f8['tether'];console[_0x20010d(0x240)](_0x20010d(0x21a)+Object['keys'](_0x59e325)[_0x20010d(0x1f8)]+'\x20currencies');const _0x4557a6=Object['entries'](_0x59e325)['map'](async([_0x52019a,_0x55492b])=>{const _0x417417=_0x20010d;try{await database_1['default']['currencyRate'][_0x417417(0x219)]({'where':{'currency':_0x52019a[_0x417417(0x26f)]()},'update':{'rate':_0x55492b},'create':{'currency':_0x52019a[_0x417417(0x26f)](),'rate':_0x55492b}});}catch(_0x1796ec){console['error'](_0x417417(0x203)+_0x52019a+':',_0x1796ec);}});await Promise[_0x20010d(0x1fd)](_0x4557a6),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x56a73f){console['error'](_0x20010d(0x22f),_0x56a73f);throw _0x56a73f;}}async[a38_0x77e30a(0x23d)](_0x113928){const _0x5c1c7d=a38_0x77e30a,_0x5c80a4=_0x113928['toLowerCase']();if(_0x5c80a4===_0x5c1c7d(0x1f5))return 0x1;try{const _0x2301df=await database_1[_0x5c1c7d(0x222)][_0x5c1c7d(0x26d)][_0x5c1c7d(0x266)]({'where':{'currency':_0x5c80a4}});if(!_0x2301df)return console['warn'](_0x5c1c7d(0x216)+_0x113928+_0x5c1c7d(0x260)),0x1;return _0x2301df[_0x5c1c7d(0x217)];}catch(_0x2a04a7){return console[_0x5c1c7d(0x1ff)](_0x5c1c7d(0x224)+_0x113928+':',_0x2a04a7),0x1;}}async[a38_0x77e30a(0x204)](_0x4dee4c,_0x42b8f9){const _0x23e244=a38_0x77e30a,_0x518389=_0x42b8f9['toLowerCase']();if(_0x518389===_0x23e244(0x1f5)){const _0x34ff32=_0x4dee4c*(0x1+this[_0x23e244(0x215)]/0x64);return console[_0x23e244(0x240)](_0x23e244(0x26a)+this[_0x23e244(0x215)]+_0x23e244(0x214)+_0x4dee4c+_0x23e244(0x225)+_0x34ff32[_0x23e244(0x236)](0x6)+'\x20USDT'),_0x34ff32;}try{const _0x2e803c=await this[_0x23e244(0x23d)](_0x518389),_0x2f38c2=_0x4dee4c/_0x2e803c,_0x47fa00=_0x2f38c2*(0x1+this[_0x23e244(0x215)]/0x64);return console[_0x23e244(0x240)](_0x23e244(0x207)+_0x4dee4c+'\x20'+_0x42b8f9[_0x23e244(0x261)]()+'\x20to\x20'+_0x2f38c2[_0x23e244(0x236)](0x6)+'\x20USDT,\x20with\x20'+this[_0x23e244(0x215)]+_0x23e244(0x264)+_0x47fa00['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x2e803c+')'),_0x47fa00;}catch(_0x39242b){console['error'](_0x23e244(0x23b)+_0x4dee4c+'\x20'+_0x42b8f9+_0x23e244(0x270),_0x39242b);const _0x422018=_0x4dee4c*(0x1+this[_0x23e244(0x215)]/0x64);return _0x422018;}}async[a38_0x77e30a(0x231)](_0x5061eb){const _0x352640=a38_0x77e30a;let _0x243433=0x0;for(const {amount:_0x1bc399,currency:_0x148f2c}of _0x5061eb){const _0x4fe802=await this[_0x352640(0x204)](_0x1bc399,_0x148f2c);_0x243433+=_0x4fe802;}return _0x243433;}async[a38_0x77e30a(0x23f)](){const _0x5238d7=a38_0x77e30a;try{const _0x3e40ad=await database_1[_0x5238d7(0x222)][_0x5238d7(0x26d)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x283054={'usdt':0x1};return _0x3e40ad[_0x5238d7(0x235)](_0x51cf76=>{const _0x155174=_0x5238d7;_0x283054[_0x51cf76[_0x155174(0x20e)]]=_0x51cf76[_0x155174(0x217)];}),_0x283054;}catch(_0x263e2d){return console[_0x5238d7(0x1ff)](_0x5238d7(0x212),_0x263e2d),{'usdt':0x1};}}async[a38_0x77e30a(0x256)](){const _0x202167=a38_0x77e30a;try{const [_0x3ed4c6,_0x4ec491,_0x18c86e]=await Promise[_0x202167(0x237)]([database_1[_0x202167(0x222)][_0x202167(0x26d)]['count'](),database_1['default']['currencyRate']['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x202167(0x222)]['currencyRate'][_0x202167(0x21c)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3ed4c6,'lastUpdated':_0x4ec491?.['updatedAt']||null,'oldestRate':_0x18c86e?.[_0x202167(0x245)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x4cc743){return console[_0x202167(0x1ff)](_0x202167(0x253),_0x4cc743),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x202167(0x215)]};}}[a38_0x77e30a(0x22c)](){const _0x3dfadd=a38_0x77e30a;return this[_0x3dfadd(0x215)];}}function a38_0x3427(_0x58029c,_0x156480){const _0x4aa179=a38_0x4aa1();return a38_0x3427=function(_0x3427ac,_0x1aa24c){_0x3427ac=_0x3427ac-0x1f3;let _0xeb8d53=_0x4aa179[_0x3427ac];return _0xeb8d53;},a38_0x3427(_0x58029c,_0x156480);}exports[a38_0x77e30a(0x259)]=CurrencyService,exports[a38_0x77e30a(0x1fb)]=new CurrencyService();