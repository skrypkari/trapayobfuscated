'use strict';const a39_0x560884=a39_0x2a5e;(function(_0x13e383,_0x81574f){const _0x276e02=a39_0x2a5e,_0x3776b1=_0x13e383();while(!![]){try{const _0x35ee82=-parseInt(_0x276e02(0x14f))/0x1+-parseInt(_0x276e02(0x195))/0x2+-parseInt(_0x276e02(0x1b2))/0x3*(parseInt(_0x276e02(0x19d))/0x4)+parseInt(_0x276e02(0x16b))/0x5*(-parseInt(_0x276e02(0x1b5))/0x6)+parseInt(_0x276e02(0x17d))/0x7*(-parseInt(_0x276e02(0x1ba))/0x8)+-parseInt(_0x276e02(0x140))/0x9+-parseInt(_0x276e02(0x1a5))/0xa*(-parseInt(_0x276e02(0x172))/0xb);if(_0x35ee82===_0x81574f)break;else _0x3776b1['push'](_0x3776b1['shift']());}catch(_0x2e91cd){_0x3776b1['push'](_0x3776b1['shift']());}}}(a39_0x2305,0x8586b));var __importDefault=this&&this[a39_0x560884(0x14e)]||function(_0x3fe416){const _0x1ce3f5=a39_0x560884;return _0x3fe416&&_0x3fe416[_0x1ce3f5(0x194)]?_0x3fe416:{'default':_0x3fe416};};function a39_0x2a5e(_0x509440,_0x240814){const _0x23054c=a39_0x2305();return a39_0x2a5e=function(_0x2a5ee3,_0x526304){_0x2a5ee3=_0x2a5ee3-0x139;let _0x27f073=_0x23054c[_0x2a5ee3];return _0x27f073;},a39_0x2a5e(_0x509440,_0x240814);}function a39_0x2305(){const _0x2c6d3f=['xag','currencyService','61890CJdnjk','toFixed','aed','ars','Error\x20getting\x20rates\x20status:','23888hjTFRa','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','\x20to\x20USDT:','\x20USDT\x20(rate:\x20','kwd','twd','defineProperty','CoinGecko\x20API\x20error:\x20','try','getMarkupPercentage','error','1978173ppEaps','rub','getRatesStatus','currency','\x20to\x20','ltc','bdt','forEach','aud','huf','convertMultipleToUSDT','updateInterval','gel','gbp','__importDefault','386573sRohZl','xau','Initial\x20currency\x20rates\x20update\x20failed:','sats','sar','✅\x20Currency\x20rates\x20updated\x20successfully','mxn','rate','nzd',',\x20using\x201\x20as\x20fallback','clp','vnd','stopPeriodicUpdates','bhd','allSettled','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','krw','desc','chf','bits','czk','dot','length','updateCurrencyRates','application/json','entries','default','\x20USDT\x20=\x20','125nJjeDw','json','log','💱\x20Applied\x20','hkd','mmk','💱\x20Converted\x20','32759111KoyyKd','startPeriodicUpdates','toLowerCase','warn','getCurrencyRate','📊\x20Received\x20rates\x20for\x20','sgd','CURRENCIES','No\x20rate\x20found\x20for\x20currency:\x20','CurrencyService','❌\x20Failed\x20to\x20update\x20currency\x20rates:','35xFOyHI','xrp','lkr','Error\x20getting\x20all\x20rates:','ils','php','myr','updatedAt','?ids=tether&vs_currencies=','zar','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','\x20USDT','usdt','bnb','keys','eos','eth','jpy','upsert','btc','count','all','Error\x20getting\x20rate\x20for\x20currency\x20','__esModule','1926526NkLujY','thb','\x20USDT,\x20with\x20','../config/database','eur','%\x20markup\x20=\x20','toUpperCase','statusText','20nnXqew','getAllRates','xdr','yfi','inr','cny','pkr','Error\x20converting\x20','10iyjbto','currencyRate','findFirst','pln','sek','COINGECKO_URL','TesSoft\x20Payment\x20System/1.0','convertToUSDT','join','MARKUP_PERCENTAGE','dkk','https://api.coingecko.com/api/v3/simple/price','map','353244oSSSvy'];a39_0x2305=function(){return _0x2c6d3f;};return a39_0x2305();}Object[a39_0x560884(0x13b)](exports,a39_0x560884(0x194),{'value':!![]}),exports[a39_0x560884(0x1b4)]=exports[a39_0x560884(0x17b)]=void 0x0;const database_1=__importDefault(require(a39_0x560884(0x198)));class CurrencyService{constructor(){const _0x3bc4b0=a39_0x560884;this[_0x3bc4b0(0x1aa)]=_0x3bc4b0(0x1b0),this[_0x3bc4b0(0x179)]=[_0x3bc4b0(0x190),_0x3bc4b0(0x18d),_0x3bc4b0(0x145),'bch',_0x3bc4b0(0x18a),_0x3bc4b0(0x18c),_0x3bc4b0(0x17e),'xlm','link',_0x3bc4b0(0x164),_0x3bc4b0(0x1a0),'usd',_0x3bc4b0(0x1b7),_0x3bc4b0(0x1b8),_0x3bc4b0(0x148),_0x3bc4b0(0x146),_0x3bc4b0(0x15c),'bmd','brl','cad',_0x3bc4b0(0x161),_0x3bc4b0(0x159),_0x3bc4b0(0x1a2),_0x3bc4b0(0x163),_0x3bc4b0(0x1af),_0x3bc4b0(0x199),_0x3bc4b0(0x14d),_0x3bc4b0(0x14c),_0x3bc4b0(0x16f),_0x3bc4b0(0x149),'idr',_0x3bc4b0(0x181),_0x3bc4b0(0x1a1),_0x3bc4b0(0x18e),_0x3bc4b0(0x15f),_0x3bc4b0(0x139),_0x3bc4b0(0x17f),_0x3bc4b0(0x170),_0x3bc4b0(0x155),_0x3bc4b0(0x183),'ngn','nok',_0x3bc4b0(0x157),_0x3bc4b0(0x182),_0x3bc4b0(0x1a3),_0x3bc4b0(0x1a8),_0x3bc4b0(0x141),_0x3bc4b0(0x153),_0x3bc4b0(0x1a9),_0x3bc4b0(0x178),_0x3bc4b0(0x196),_0x3bc4b0(0x13d),_0x3bc4b0(0x13a),'uah','vef',_0x3bc4b0(0x15a),_0x3bc4b0(0x186),_0x3bc4b0(0x19f),_0x3bc4b0(0x1b3),_0x3bc4b0(0x150),_0x3bc4b0(0x162),_0x3bc4b0(0x152)],this[_0x3bc4b0(0x14b)]=null,this[_0x3bc4b0(0x1ae)]=0x3,this[_0x3bc4b0(0x173)]();}['startPeriodicUpdates'](){const _0x1c4289=a39_0x560884;this[_0x1c4289(0x166)]()['catch'](_0x5c86b6=>{const _0x1c0cc0=_0x1c4289;console[_0x1c0cc0(0x13f)](_0x1c0cc0(0x151),_0x5c86b6);}),this['updateInterval']=setInterval(async()=>{const _0x4fe6f1=_0x1c4289;try{await this[_0x4fe6f1(0x166)]();}catch(_0x878002){console[_0x4fe6f1(0x13f)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x878002);}},0x3c*0x3c*0x3e8),console[_0x1c4289(0x16d)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x560884(0x15b)](){const _0x147722=a39_0x560884;this['updateInterval']&&(clearInterval(this[_0x147722(0x14b)]),this[_0x147722(0x14b)]=null,console[_0x147722(0x16d)](_0x147722(0x187)));}async[a39_0x560884(0x166)](){const _0xd48111=a39_0x560884;try{console[_0xd48111(0x16d)](_0xd48111(0x1bb));const _0x23a173=this[_0xd48111(0x179)][_0xd48111(0x1ad)](','),_0x3fcc71=this[_0xd48111(0x1aa)]+_0xd48111(0x185)+_0x23a173,_0x3e78a2=await fetch(_0x3fcc71,{'headers':{'Accept':_0xd48111(0x167),'User-Agent':_0xd48111(0x1ab)}});if(!_0x3e78a2['ok'])throw new Error(_0xd48111(0x13c)+_0x3e78a2['status']+'\x20'+_0x3e78a2[_0xd48111(0x19c)]);const _0x1955af=await _0x3e78a2[_0xd48111(0x16c)]();if(!_0x1955af['tether'])throw new Error(_0xd48111(0x15e));const _0x16c518=_0x1955af['tether'];console[_0xd48111(0x16d)](_0xd48111(0x177)+Object[_0xd48111(0x18b)](_0x16c518)[_0xd48111(0x165)]+'\x20currencies');const _0x139f63=Object[_0xd48111(0x168)](_0x16c518)[_0xd48111(0x1b1)](async([_0x12b1fa,_0x1a4de4])=>{const _0xeca90b=_0xd48111;try{await database_1['default'][_0xeca90b(0x1a6)][_0xeca90b(0x18f)]({'where':{'currency':_0x12b1fa['toLowerCase']()},'update':{'rate':_0x1a4de4},'create':{'currency':_0x12b1fa[_0xeca90b(0x174)](),'rate':_0x1a4de4}});}catch(_0x1552f1){console[_0xeca90b(0x13f)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x12b1fa+':',_0x1552f1);}});await Promise[_0xd48111(0x15d)](_0x139f63),console[_0xd48111(0x16d)](_0xd48111(0x154));}catch(_0x1b5a25){console[_0xd48111(0x13f)](_0xd48111(0x17c),_0x1b5a25);throw _0x1b5a25;}}async[a39_0x560884(0x176)](_0x2dbd3d){const _0x2bd281=a39_0x560884,_0x5605fe=_0x2dbd3d[_0x2bd281(0x174)]();if(_0x5605fe===_0x2bd281(0x189))return 0x1;try{const _0x523b69=await database_1[_0x2bd281(0x169)][_0x2bd281(0x1a6)]['findUnique']({'where':{'currency':_0x5605fe}});if(!_0x523b69)return console[_0x2bd281(0x175)](_0x2bd281(0x17a)+_0x2dbd3d+_0x2bd281(0x158)),0x1;return _0x523b69[_0x2bd281(0x156)];}catch(_0x5500f9){return console[_0x2bd281(0x13f)](_0x2bd281(0x193)+_0x2dbd3d+':',_0x5500f9),0x1;}}async[a39_0x560884(0x1ac)](_0x1e4832,_0x5050d4){const _0x2183df=a39_0x560884,_0x1a3a8f=_0x5050d4[_0x2183df(0x174)]();if(_0x1a3a8f==='usdt'){const _0x33ff71=_0x1e4832*(0x1+this[_0x2183df(0x1ae)]/0x64);return console[_0x2183df(0x16d)](_0x2183df(0x16e)+this[_0x2183df(0x1ae)]+'%\x20markup\x20to\x20'+_0x1e4832+_0x2183df(0x16a)+_0x33ff71[_0x2183df(0x1b6)](0x6)+_0x2183df(0x188)),_0x33ff71;}try{const _0x5cbcd4=await this[_0x2183df(0x176)](_0x1a3a8f),_0x2436f2=_0x1e4832/_0x5cbcd4,_0x3247f4=_0x2436f2*(0x1+this[_0x2183df(0x1ae)]/0x64);return console[_0x2183df(0x16d)](_0x2183df(0x171)+_0x1e4832+'\x20'+_0x5050d4[_0x2183df(0x19b)]()+_0x2183df(0x144)+_0x2436f2['toFixed'](0x6)+_0x2183df(0x197)+this['MARKUP_PERCENTAGE']+_0x2183df(0x19a)+_0x3247f4['toFixed'](0x6)+_0x2183df(0x1bd)+_0x5cbcd4+')'),_0x3247f4;}catch(_0x44c74e){console[_0x2183df(0x13f)](_0x2183df(0x1a4)+_0x1e4832+'\x20'+_0x5050d4+_0x2183df(0x1bc),_0x44c74e);const _0x45ab97=_0x1e4832*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x45ab97;}}async[a39_0x560884(0x14a)](_0x3c0870){const _0x28681e=a39_0x560884;let _0x40ad4f=0x0;for(const {amount:_0x4fb019,currency:_0x1ab8de}of _0x3c0870){const _0xc6842=await this[_0x28681e(0x1ac)](_0x4fb019,_0x1ab8de);_0x40ad4f+=_0xc6842;}return _0x40ad4f;}async[a39_0x560884(0x19e)](){const _0x1e47df=a39_0x560884;try{const _0x35b6a5=await database_1[_0x1e47df(0x169)][_0x1e47df(0x1a6)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1472ed={'usdt':0x1};return _0x35b6a5[_0x1e47df(0x147)](_0x3db3be=>{const _0x62077c=_0x1e47df;_0x1472ed[_0x3db3be[_0x62077c(0x143)]]=_0x3db3be[_0x62077c(0x156)];}),_0x1472ed;}catch(_0x2b044d){return console[_0x1e47df(0x13f)](_0x1e47df(0x180),_0x2b044d),{'usdt':0x1};}}async[a39_0x560884(0x142)](){const _0x4761f5=a39_0x560884;try{const [_0x7d8013,_0x1c4844,_0x5cbb24]=await Promise[_0x4761f5(0x192)]([database_1[_0x4761f5(0x169)][_0x4761f5(0x1a6)][_0x4761f5(0x191)](),database_1[_0x4761f5(0x169)][_0x4761f5(0x1a6)][_0x4761f5(0x1a7)]({'orderBy':{'updatedAt':_0x4761f5(0x160)},'select':{'updatedAt':!![]}}),database_1[_0x4761f5(0x169)][_0x4761f5(0x1a6)][_0x4761f5(0x1a7)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x7d8013,'lastUpdated':_0x1c4844?.[_0x4761f5(0x184)]||null,'oldestRate':_0x5cbb24?.[_0x4761f5(0x184)]||null,'markupPercentage':this[_0x4761f5(0x1ae)]};}catch(_0x21b3a4){return console[_0x4761f5(0x13f)](_0x4761f5(0x1b9),_0x21b3a4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4761f5(0x1ae)]};}}[a39_0x560884(0x13e)](){const _0x3bb156=a39_0x560884;return this[_0x3bb156(0x1ae)];}}exports[a39_0x560884(0x17b)]=CurrencyService,exports[a39_0x560884(0x1b4)]=new CurrencyService();