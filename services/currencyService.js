'use strict';const a38_0x56d888=a38_0x485a;(function(_0x4b91b5,_0x1348c9){const _0x3d5df5=a38_0x485a,_0x432896=_0x4b91b5();while(!![]){try{const _0x2b7ed9=-parseInt(_0x3d5df5(0x19d))/0x1+-parseInt(_0x3d5df5(0x185))/0x2*(parseInt(_0x3d5df5(0x16a))/0x3)+parseInt(_0x3d5df5(0x19c))/0x4*(parseInt(_0x3d5df5(0x174))/0x5)+parseInt(_0x3d5df5(0x145))/0x6*(parseInt(_0x3d5df5(0x176))/0x7)+parseInt(_0x3d5df5(0x140))/0x8*(parseInt(_0x3d5df5(0x19b))/0x9)+parseInt(_0x3d5df5(0x165))/0xa+-parseInt(_0x3d5df5(0x1a0))/0xb;if(_0x2b7ed9===_0x1348c9)break;else _0x432896['push'](_0x432896['shift']());}catch(_0x350f20){_0x432896['push'](_0x432896['shift']());}}}(a38_0x50f0,0xcd6c6));var __importDefault=this&&this[a38_0x56d888(0x14c)]||function(_0x57a9e2){const _0xcfc2c7=a38_0x56d888;return _0x57a9e2&&_0x57a9e2[_0xcfc2c7(0x143)]?_0x57a9e2:{'default':_0x57a9e2};};Object['defineProperty'](exports,a38_0x56d888(0x143),{'value':!![]}),exports[a38_0x56d888(0x159)]=exports[a38_0x56d888(0x14b)]=void 0x0;const database_1=__importDefault(require(a38_0x56d888(0x1a1)));function a38_0x50f0(){const _0x5aeee2=['zar','jpy','mmk','updateCurrencyRates','lkr','allSettled','nzd','vnd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','warn','twd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','updateInterval','💱\x20Converted\x20','Failed\x20to\x20update\x20rate\x20for\x20','hkd','default','json','stopPeriodicUpdates','bhd','xau','findMany','813848sbWFHc','toUpperCase','startPeriodicUpdates','__esModule','pkr','366QcQXuJ','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','status','all','Error\x20getting\x20rates\x20status:','getCurrencyRate','CurrencyService','__importDefault','czk','tether','currency','bnb','\x20currencies','✅\x20Currency\x20rates\x20updated\x20successfully','brl','php','idr','sats','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','COINGECKO_URL','currencyService','pln','Error\x20getting\x20all\x20rates:','ils','ltc','count','thb',',\x20using\x201\x20as\x20fallback','dkk','rub','keys','link','11800300MwdCkK','ars','bits','eos','findUnique','291381ddbvro','cad','\x20to\x20USDT:','toFixed','Error\x20getting\x20rate\x20for\x20currency\x20','xrp','convertToUSDT','💱\x20Applied\x20','eur','inr','142465wqDvBv','usdt','83489kediDE','sek','findFirst','statusText','getMarkupPercentage','toLowerCase','gel','bch','application/json','huf','myr','CoinGecko\x20API\x20error:\x20','nok','getRatesStatus','?ids=tether&vs_currencies=','22vvMDXC','MARKUP_PERCENTAGE','TesSoft\x20Payment\x20System/1.0','https://api.coingecko.com/api/v3/simple/price','try','xlm','uah','updatedAt','upsert','\x20USDT\x20(rate:\x20','dot','map','usd','currencyRate','desc','error','bmd','CURRENCIES','kwd','eth','mxn','bdt','9AEjHHy','156MrpMBl','304749PxFUga','\x20USDT,\x20with\x20','log','9965725QSzTeu','../config/database'];a38_0x50f0=function(){return _0x5aeee2;};return a38_0x50f0();}function a38_0x485a(_0x148c56,_0x14a095){const _0x50f03a=a38_0x50f0();return a38_0x485a=function(_0x485adb,_0x635130){_0x485adb=_0x485adb-0x12c;let _0x2d201f=_0x50f03a[_0x485adb];return _0x2d201f;},a38_0x485a(_0x148c56,_0x14a095);}class CurrencyService{constructor(){const _0xdcd9f1=a38_0x56d888;this[_0xdcd9f1(0x158)]=_0xdcd9f1(0x188),this[_0xdcd9f1(0x196)]=['btc',_0xdcd9f1(0x198),_0xdcd9f1(0x15d),_0xdcd9f1(0x17d),_0xdcd9f1(0x150),_0xdcd9f1(0x168),_0xdcd9f1(0x16f),_0xdcd9f1(0x18a),_0xdcd9f1(0x164),_0xdcd9f1(0x18f),'yfi',_0xdcd9f1(0x191),'aed',_0xdcd9f1(0x166),'aud',_0xdcd9f1(0x19a),_0xdcd9f1(0x13d),_0xdcd9f1(0x195),_0xdcd9f1(0x153),_0xdcd9f1(0x16b),'chf','clp','cny',_0xdcd9f1(0x14d),_0xdcd9f1(0x161),_0xdcd9f1(0x172),'gbp',_0xdcd9f1(0x17c),_0xdcd9f1(0x139),_0xdcd9f1(0x17f),_0xdcd9f1(0x155),_0xdcd9f1(0x15c),_0xdcd9f1(0x173),_0xdcd9f1(0x1a3),'krw',_0xdcd9f1(0x197),_0xdcd9f1(0x12e),_0xdcd9f1(0x12c),_0xdcd9f1(0x199),_0xdcd9f1(0x180),'ngn',_0xdcd9f1(0x182),_0xdcd9f1(0x130),_0xdcd9f1(0x154),_0xdcd9f1(0x144),_0xdcd9f1(0x15a),_0xdcd9f1(0x162),'sar',_0xdcd9f1(0x177),'sgd',_0xdcd9f1(0x15f),_0xdcd9f1(0x189),_0xdcd9f1(0x134),_0xdcd9f1(0x18b),'vef',_0xdcd9f1(0x131),_0xdcd9f1(0x1a2),'xdr','xag',_0xdcd9f1(0x13e),_0xdcd9f1(0x167),_0xdcd9f1(0x156)],this[_0xdcd9f1(0x136)]=null,this[_0xdcd9f1(0x186)]=0x3,this[_0xdcd9f1(0x142)]();}[a38_0x56d888(0x142)](){const _0x1722ec=a38_0x56d888;this[_0x1722ec(0x12d)]()['catch'](_0x4ee430=>{const _0x51db10=_0x1722ec;console[_0x51db10(0x194)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x4ee430);}),this[_0x1722ec(0x136)]=setInterval(async()=>{const _0x26f78c=_0x1722ec;try{await this[_0x26f78c(0x12d)]();}catch(_0x475df0){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x475df0);}},0x3c*0x3c*0x3e8),console[_0x1722ec(0x19f)](_0x1722ec(0x132));}[a38_0x56d888(0x13c)](){const _0x3ebab1=a38_0x56d888;this['updateInterval']&&(clearInterval(this[_0x3ebab1(0x136)]),this[_0x3ebab1(0x136)]=null,console[_0x3ebab1(0x19f)](_0x3ebab1(0x146)));}async[a38_0x56d888(0x12d)](){const _0x1cef89=a38_0x56d888;try{console[_0x1cef89(0x19f)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x3f7284=this[_0x1cef89(0x196)]['join'](','),_0x104b39=this[_0x1cef89(0x158)]+_0x1cef89(0x184)+_0x3f7284,_0xf4317c=await fetch(_0x104b39,{'headers':{'Accept':_0x1cef89(0x17e),'User-Agent':_0x1cef89(0x187)}});if(!_0xf4317c['ok'])throw new Error(_0x1cef89(0x181)+_0xf4317c[_0x1cef89(0x147)]+'\x20'+_0xf4317c[_0x1cef89(0x179)]);const _0x31bfda=await _0xf4317c[_0x1cef89(0x13b)]();if(!_0x31bfda[_0x1cef89(0x14e)])throw new Error(_0x1cef89(0x157));const _0x2bace4=_0x31bfda[_0x1cef89(0x14e)];console[_0x1cef89(0x19f)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x1cef89(0x163)](_0x2bace4)['length']+_0x1cef89(0x151));const _0x43b812=Object['entries'](_0x2bace4)[_0x1cef89(0x190)](async([_0x38d94b,_0x180dc1])=>{const _0x23cc4b=_0x1cef89;try{await database_1['default'][_0x23cc4b(0x192)][_0x23cc4b(0x18d)]({'where':{'currency':_0x38d94b[_0x23cc4b(0x17b)]()},'update':{'rate':_0x180dc1},'create':{'currency':_0x38d94b[_0x23cc4b(0x17b)](),'rate':_0x180dc1}});}catch(_0x140806){console[_0x23cc4b(0x194)](_0x23cc4b(0x138)+_0x38d94b+':',_0x140806);}});await Promise[_0x1cef89(0x12f)](_0x43b812),console['log'](_0x1cef89(0x152));}catch(_0x448689){console['error'](_0x1cef89(0x135),_0x448689);throw _0x448689;}}async[a38_0x56d888(0x14a)](_0x240c44){const _0x58aa99=a38_0x56d888,_0x476d5c=_0x240c44[_0x58aa99(0x17b)]();if(_0x476d5c==='usdt')return 0x1;try{const _0x100110=await database_1[_0x58aa99(0x13a)][_0x58aa99(0x192)][_0x58aa99(0x169)]({'where':{'currency':_0x476d5c}});if(!_0x100110)return console[_0x58aa99(0x133)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x240c44+_0x58aa99(0x160)),0x1;return _0x100110['rate'];}catch(_0x241a15){return console[_0x58aa99(0x194)](_0x58aa99(0x16e)+_0x240c44+':',_0x241a15),0x1;}}async[a38_0x56d888(0x170)](_0x394040,_0x4fb66f){const _0x450750=a38_0x56d888,_0x10e748=_0x4fb66f[_0x450750(0x17b)]();if(_0x10e748===_0x450750(0x175)){const _0x191751=_0x394040*(0x1+this[_0x450750(0x186)]/0x64);return console[_0x450750(0x19f)](_0x450750(0x171)+this[_0x450750(0x186)]+'%\x20markup\x20to\x20'+_0x394040+'\x20USDT\x20=\x20'+_0x191751[_0x450750(0x16d)](0x6)+'\x20USDT'),_0x191751;}try{const _0xeb0a8f=await this[_0x450750(0x14a)](_0x10e748),_0x45d938=_0x394040/_0xeb0a8f,_0x76b870=_0x45d938*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x450750(0x137)+_0x394040+'\x20'+_0x4fb66f[_0x450750(0x141)]()+'\x20to\x20'+_0x45d938[_0x450750(0x16d)](0x6)+_0x450750(0x19e)+this[_0x450750(0x186)]+'%\x20markup\x20=\x20'+_0x76b870[_0x450750(0x16d)](0x6)+_0x450750(0x18e)+_0xeb0a8f+')'),_0x76b870;}catch(_0x1d55ae){console[_0x450750(0x194)]('Error\x20converting\x20'+_0x394040+'\x20'+_0x4fb66f+_0x450750(0x16c),_0x1d55ae);const _0xb4dfa7=_0x394040*(0x1+this[_0x450750(0x186)]/0x64);return _0xb4dfa7;}}async['convertMultipleToUSDT'](_0x4e08fa){const _0x585a13=a38_0x56d888;let _0x3dbfce=0x0;for(const {amount:_0x45388d,currency:_0x1c2575}of _0x4e08fa){const _0xc1e155=await this[_0x585a13(0x170)](_0x45388d,_0x1c2575);_0x3dbfce+=_0xc1e155;}return _0x3dbfce;}async['getAllRates'](){const _0x24c50a=a38_0x56d888;try{const _0x59e49f=await database_1[_0x24c50a(0x13a)][_0x24c50a(0x192)][_0x24c50a(0x13f)]({'select':{'currency':!![],'rate':!![]}}),_0x2d5479={'usdt':0x1};return _0x59e49f['forEach'](_0x4eba0c=>{const _0x10c1cd=_0x24c50a;_0x2d5479[_0x4eba0c[_0x10c1cd(0x14f)]]=_0x4eba0c['rate'];}),_0x2d5479;}catch(_0x24fc48){return console[_0x24c50a(0x194)](_0x24c50a(0x15b),_0x24fc48),{'usdt':0x1};}}async[a38_0x56d888(0x183)](){const _0x48d094=a38_0x56d888;try{const [_0x3bda37,_0xb9dbbb,_0x5be078]=await Promise[_0x48d094(0x148)]([database_1[_0x48d094(0x13a)][_0x48d094(0x192)][_0x48d094(0x15e)](),database_1[_0x48d094(0x13a)][_0x48d094(0x192)][_0x48d094(0x178)]({'orderBy':{'updatedAt':_0x48d094(0x193)},'select':{'updatedAt':!![]}}),database_1['default'][_0x48d094(0x192)][_0x48d094(0x178)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3bda37,'lastUpdated':_0xb9dbbb?.[_0x48d094(0x18c)]||null,'oldestRate':_0x5be078?.[_0x48d094(0x18c)]||null,'markupPercentage':this[_0x48d094(0x186)]};}catch(_0x439367){return console[_0x48d094(0x194)](_0x48d094(0x149),_0x439367),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x48d094(0x186)]};}}[a38_0x56d888(0x17a)](){const _0x3f377e=a38_0x56d888;return this[_0x3f377e(0x186)];}}exports[a38_0x56d888(0x14b)]=CurrencyService,exports[a38_0x56d888(0x159)]=new CurrencyService();