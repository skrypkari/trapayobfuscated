'use strict';const a51_0x2abb29=a51_0x22d2;function a51_0x37eb(){const _0x4e6f36=['findUnique','default','../config/database','entries','convertToUSDT','\x20currencies','log','âœ…\x20Currency\x20rates\x20updated\x20successfully','mxn','defineProperty','huf','CoinGecko\x20API\x20error:\x20','upsert','convertMultipleToUSDT','btc','findFirst','keys','count','Error\x20converting\x20','try','inr','stopPeriodicUpdates','vef','1262145rYsHEq','desc','brl','ðŸ’±\x20Converted\x20','getCurrencyRate','join','dot','myr','findMany','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','rate','ðŸ’±\x20Applied\x20','bmd','toFixed','3801170SykbPI','thb','all','\x20USDT\x20=\x20','uah','jpy','updatedAt','CURRENCIES','error','641655MOJiAp','length','vnd','6clhAYq','https://api.coingecko.com/api/v3/simple/price','Error\x20getting\x20rates\x20status:','kwd','\x20USDT\x20(rate:\x20','ils','nok','2741732PfWJWJ','link','\x20USDT,\x20with\x20','nzd','No\x20rate\x20found\x20for\x20currency:\x20','Error\x20getting\x20all\x20rates:','bnb','\x20USDT','getAllRates','chf','__esModule','statusText','hkd','gel','Error\x20getting\x20rate\x20for\x20currency\x20','asc','getMarkupPercentage','currency','pln','457386ihllrL','updateCurrencyRates','twd','currencyRate','idr','3aWlVOe','updateInterval','tether','ngn','bhd','48QdfgxT','application/json','forEach','%\x20markup\x20to\x20','%\x20markup\x20=\x20','startPeriodicUpdates','xrp','toLowerCase','php','xlm','usd','sats','3541131MNRByI','\x20to\x20','eos','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','toUpperCase','1qrkhFN','bits','bch','COINGECKO_URL','usdt','bdt','currencyService','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','MARKUP_PERCENTAGE','cad','rub','ars','830420suyeDd','mmk','CurrencyService','sgd','aud','ðŸ“Š\x20Received\x20rates\x20for\x20','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','yfi','map'];a51_0x37eb=function(){return _0x4e6f36;};return a51_0x37eb();}(function(_0x595315,_0x97d7fb){const _0x30e496=a51_0x22d2,_0x1e738a=_0x595315();while(!![]){try{const _0x71fd0f=parseInt(_0x30e496(0x1c6))/0x1*(parseInt(_0x30e496(0x1ab))/0x2)+-parseInt(_0x30e496(0x1b0))/0x3*(parseInt(_0x30e496(0x1d2))/0x4)+parseInt(_0x30e496(0x177))/0x5*(parseInt(_0x30e496(0x191))/0x6)+parseInt(_0x30e496(0x198))/0x7+-parseInt(_0x30e496(0x1b5))/0x8*(parseInt(_0x30e496(0x18e))/0x9)+parseInt(_0x30e496(0x185))/0xa+-parseInt(_0x30e496(0x1c1))/0xb;if(_0x71fd0f===_0x97d7fb)break;else _0x1e738a['push'](_0x1e738a['shift']());}catch(_0x346615){_0x1e738a['push'](_0x1e738a['shift']());}}}(a51_0x37eb,0x482c3));function a51_0x22d2(_0x57437b,_0x35af6e){_0x57437b=_0x57437b-0x16f;const _0x37ebf5=a51_0x37eb();let _0x22d234=_0x37ebf5[_0x57437b];return _0x22d234;}var __importDefault=this&&this['__importDefault']||function(_0x34bcff){const _0x2cac57=a51_0x22d2;return _0x34bcff&&_0x34bcff[_0x2cac57(0x1a2)]?_0x34bcff:{'default':_0x34bcff};};Object[a51_0x2abb29(0x1e4)](exports,a51_0x2abb29(0x1a2),{'value':!![]}),exports[a51_0x2abb29(0x1cc)]=exports[a51_0x2abb29(0x1d4)]=void 0x0;const database_1=__importDefault(require(a51_0x2abb29(0x1dd)));class CurrencyService{constructor(){const _0x3cbd04=a51_0x2abb29;this['COINGECKO_URL']=_0x3cbd04(0x192),this[_0x3cbd04(0x18c)]=[_0x3cbd04(0x1e9),'eth','ltc',_0x3cbd04(0x1c8),_0x3cbd04(0x19e),_0x3cbd04(0x1c3),_0x3cbd04(0x1bb),_0x3cbd04(0x1be),_0x3cbd04(0x199),_0x3cbd04(0x17d),_0x3cbd04(0x1d9),_0x3cbd04(0x1bf),'aed',_0x3cbd04(0x1d1),_0x3cbd04(0x1d6),_0x3cbd04(0x1cb),_0x3cbd04(0x1b4),_0x3cbd04(0x183),_0x3cbd04(0x179),_0x3cbd04(0x1cf),_0x3cbd04(0x1a1),'clp','cny','czk','dkk','eur','gbp',_0x3cbd04(0x1a5),_0x3cbd04(0x1a4),_0x3cbd04(0x1e5),_0x3cbd04(0x1af),_0x3cbd04(0x196),_0x3cbd04(0x174),_0x3cbd04(0x18a),'krw',_0x3cbd04(0x194),'lkr',_0x3cbd04(0x1d3),_0x3cbd04(0x1e3),_0x3cbd04(0x17e),_0x3cbd04(0x1b3),_0x3cbd04(0x197),_0x3cbd04(0x19b),_0x3cbd04(0x1bd),'pkr',_0x3cbd04(0x1aa),_0x3cbd04(0x1d0),'sar','sek',_0x3cbd04(0x1d5),_0x3cbd04(0x186),_0x3cbd04(0x173),_0x3cbd04(0x1ad),_0x3cbd04(0x189),_0x3cbd04(0x176),_0x3cbd04(0x190),'zar','xdr','xag','xau',_0x3cbd04(0x1c7),_0x3cbd04(0x1c0)],this[_0x3cbd04(0x1b1)]=null,this[_0x3cbd04(0x1ce)]=-0x3,this[_0x3cbd04(0x1ba)]();}[a51_0x2abb29(0x1ba)](){const _0x4f3e8c=a51_0x2abb29;this['updateCurrencyRates']()['catch'](_0x579e8e=>{const _0xae0b7b=a51_0x22d2;console[_0xae0b7b(0x18d)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x579e8e);}),this[_0x4f3e8c(0x1b1)]=setInterval(async()=>{const _0xf4c901=_0x4f3e8c;try{await this[_0xf4c901(0x1ac)]();}catch(_0x1aba49){console[_0xf4c901(0x18d)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x1aba49);}},0x3c*0x3c*0x3e8),console['log'](_0x4f3e8c(0x1cd));}[a51_0x2abb29(0x175)](){const _0x14f935=a51_0x2abb29;this['updateInterval']&&(clearInterval(this[_0x14f935(0x1b1)]),this[_0x14f935(0x1b1)]=null,console[_0x14f935(0x1e1)](_0x14f935(0x180)));}async[a51_0x2abb29(0x1ac)](){const _0xaf7345=a51_0x2abb29;try{console[_0xaf7345(0x1e1)]('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x2966be=this[_0xaf7345(0x18c)][_0xaf7345(0x17c)](','),_0x8f110b=this[_0xaf7345(0x1c9)]+'?ids=tether&vs_currencies='+_0x2966be,_0x2bebb1=await fetch(_0x8f110b,{'headers':{'Accept':_0xaf7345(0x1b6),'User-Agent':'Payment\x20System/1.0'}});if(!_0x2bebb1['ok'])throw new Error(_0xaf7345(0x1e6)+_0x2bebb1['status']+'\x20'+_0x2bebb1[_0xaf7345(0x1a3)]);const _0x3bfd39=await _0x2bebb1['json']();if(!_0x3bfd39[_0xaf7345(0x1b2)])throw new Error(_0xaf7345(0x1c4));const _0x15fc98=_0x3bfd39['tether'];console[_0xaf7345(0x1e1)](_0xaf7345(0x1d7)+Object[_0xaf7345(0x170)](_0x15fc98)[_0xaf7345(0x18f)]+_0xaf7345(0x1e0));const _0x1dd641=Object[_0xaf7345(0x1de)](_0x15fc98)[_0xaf7345(0x1da)](async([_0x1860e1,_0x5c0ff3])=>{const _0x6f1d67=_0xaf7345;try{await database_1[_0x6f1d67(0x1dc)][_0x6f1d67(0x1ae)][_0x6f1d67(0x1e7)]({'where':{'currency':_0x1860e1['toLowerCase']()},'update':{'rate':_0x5c0ff3},'create':{'currency':_0x1860e1['toLowerCase'](),'rate':_0x5c0ff3}});}catch(_0x4b113d){console[_0x6f1d67(0x18d)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x1860e1+':',_0x4b113d);}});await Promise['allSettled'](_0x1dd641),console[_0xaf7345(0x1e1)](_0xaf7345(0x1e2));}catch(_0x50b7f4){console['error'](_0xaf7345(0x1d8),_0x50b7f4);throw _0x50b7f4;}}async[a51_0x2abb29(0x17b)](_0x512ea4){const _0x4398f9=a51_0x2abb29,_0x112db3=_0x512ea4['toLowerCase']();if(_0x112db3===_0x4398f9(0x1ca))return 0x1;try{const _0x32338a=await database_1[_0x4398f9(0x1dc)][_0x4398f9(0x1ae)][_0x4398f9(0x1db)]({'where':{'currency':_0x112db3}});if(!_0x32338a)return console['warn'](_0x4398f9(0x19c)+_0x512ea4+',\x20using\x201\x20as\x20fallback'),0x1;return _0x32338a['rate'];}catch(_0x4587ad){return console[_0x4398f9(0x18d)](_0x4398f9(0x1a6)+_0x512ea4+':',_0x4587ad),0x1;}}async['convertToUSDT'](_0x93b8cc,_0x5e7212){const _0x12def2=a51_0x2abb29,_0x264d4a=_0x5e7212[_0x12def2(0x1bc)]();if(_0x264d4a==='usdt'){const _0x10c00a=_0x93b8cc*(0x1+this[_0x12def2(0x1ce)]/0x64);return console['log'](_0x12def2(0x182)+this['MARKUP_PERCENTAGE']+_0x12def2(0x1b8)+_0x93b8cc+_0x12def2(0x188)+_0x10c00a['toFixed'](0x6)+_0x12def2(0x19f)),_0x10c00a;}try{const _0x567ab8=await this[_0x12def2(0x17b)](_0x264d4a),_0x2fba1c=_0x93b8cc/_0x567ab8,_0x136375=_0x2fba1c*(0x1+this[_0x12def2(0x1ce)]/0x64);return console['log'](_0x12def2(0x17a)+_0x93b8cc+'\x20'+_0x5e7212[_0x12def2(0x1c5)]()+_0x12def2(0x1c2)+_0x2fba1c[_0x12def2(0x184)](0x6)+_0x12def2(0x19a)+this[_0x12def2(0x1ce)]+_0x12def2(0x1b9)+_0x136375[_0x12def2(0x184)](0x6)+_0x12def2(0x195)+_0x567ab8+')'),_0x136375;}catch(_0x171297){console[_0x12def2(0x18d)](_0x12def2(0x172)+_0x93b8cc+'\x20'+_0x5e7212+'\x20to\x20USDT:',_0x171297);const _0x32a869=_0x93b8cc*(0x1+this[_0x12def2(0x1ce)]/0x64);return _0x32a869;}}async[a51_0x2abb29(0x1e8)](_0x5e4b0f){const _0x1a930a=a51_0x2abb29;let _0x3216c9=0x0;for(const {amount:_0x2d627b,currency:_0xd5c299}of _0x5e4b0f){const _0x1f3790=await this[_0x1a930a(0x1df)](_0x2d627b,_0xd5c299);_0x3216c9+=_0x1f3790;}return _0x3216c9;}async[a51_0x2abb29(0x1a0)](){const _0x24b0ce=a51_0x2abb29;try{const _0x4f7ee9=await database_1['default']['currencyRate'][_0x24b0ce(0x17f)]({'select':{'currency':!![],'rate':!![]}}),_0xdf44e8={'usdt':0x1};return _0x4f7ee9[_0x24b0ce(0x1b7)](_0x54d679=>{const _0x4f753a=_0x24b0ce;_0xdf44e8[_0x54d679[_0x4f753a(0x1a9)]]=_0x54d679[_0x4f753a(0x181)];}),_0xdf44e8;}catch(_0x3c6f32){return console['error'](_0x24b0ce(0x19d),_0x3c6f32),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2097d9=a51_0x2abb29;try{const [_0x2f00ae,_0xdd88ff,_0x455493]=await Promise[_0x2097d9(0x187)]([database_1[_0x2097d9(0x1dc)][_0x2097d9(0x1ae)][_0x2097d9(0x171)](),database_1[_0x2097d9(0x1dc)][_0x2097d9(0x1ae)][_0x2097d9(0x16f)]({'orderBy':{'updatedAt':_0x2097d9(0x178)},'select':{'updatedAt':!![]}}),database_1[_0x2097d9(0x1dc)]['currencyRate'][_0x2097d9(0x16f)]({'orderBy':{'updatedAt':_0x2097d9(0x1a7)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2f00ae,'lastUpdated':_0xdd88ff?.[_0x2097d9(0x18b)]||null,'oldestRate':_0x455493?.[_0x2097d9(0x18b)]||null,'markupPercentage':this[_0x2097d9(0x1ce)]};}catch(_0x2a0b3a){return console[_0x2097d9(0x18d)](_0x2097d9(0x193),_0x2a0b3a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2097d9(0x1ce)]};}}[a51_0x2abb29(0x1a8)](){return this['MARKUP_PERCENTAGE'];}}exports[a51_0x2abb29(0x1d4)]=CurrencyService,exports[a51_0x2abb29(0x1cc)]=new CurrencyService();