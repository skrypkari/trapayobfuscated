'use strict';const a38_0x1dea18=a38_0x583e;(function(_0x48b9cf,_0x454903){const _0xa4959b=a38_0x583e,_0x108cf8=_0x48b9cf();while(!![]){try{const _0x5a48c4=-parseInt(_0xa4959b(0x22d))/0x1+-parseInt(_0xa4959b(0x1d4))/0x2*(-parseInt(_0xa4959b(0x221))/0x3)+parseInt(_0xa4959b(0x228))/0x4+parseInt(_0xa4959b(0x1e0))/0x5*(-parseInt(_0xa4959b(0x1ec))/0x6)+parseInt(_0xa4959b(0x1e8))/0x7*(-parseInt(_0xa4959b(0x1f6))/0x8)+-parseInt(_0xa4959b(0x20f))/0x9*(parseInt(_0xa4959b(0x205))/0xa)+parseInt(_0xa4959b(0x1dd))/0xb*(parseInt(_0xa4959b(0x1ef))/0xc);if(_0x5a48c4===_0x454903)break;else _0x108cf8['push'](_0x108cf8['shift']());}catch(_0x51f3da){_0x108cf8['push'](_0x108cf8['shift']());}}}(a38_0x4129,0xf3d1c));var __importDefault=this&&this[a38_0x1dea18(0x235)]||function(_0x1429df){const _0x2eed63=a38_0x1dea18;return _0x1429df&&_0x1429df[_0x2eed63(0x1e3)]?_0x1429df:{'default':_0x1429df};};function a38_0x4129(){const _0x1c7ec0=['147249azBhwc','Initial\x20currency\x20rates\x20update\x20failed:','myr','currencyRate','MARKUP_PERCENTAGE','💱\x20Converted\x20','allSettled','pln','📊\x20Received\x20rates\x20for\x20','nok','convertMultipleToUSDT','\x20currencies','%\x20markup\x20to\x20','convertToUSDT','brl','lkr','log','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','2492379OfrdMO','statusText','\x20USDT','default','xdr','join',',\x20using\x201\x20as\x20fallback','7595856pigbXV','getAllRates','entries','❌\x20Failed\x20to\x20update\x20currency\x20rates:','twd','429802ikbxZd','sek','No\x20rate\x20found\x20for\x20currency:\x20','bdt','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','mmk','usdt','eth','__importDefault','Failed\x20to\x20update\x20rate\x20for\x20','\x20to\x20','COINGECKO_URL','updateInterval','application/json','findFirst','thb','error','xau','json','sar','jpy','Error\x20getting\x20rates\x20status:','count','warn','getMarkupPercentage','dot','sgd','link','bnb','try','bits','TesSoft\x20Payment\x20System/1.0','bmd','ltc','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','4MXUpnQ','cny','toUpperCase','stopPeriodicUpdates','✅\x20Currency\x20rates\x20updated\x20successfully','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','updatedAt','desc','uah','22vglQDQ','../config/database','updateCurrencyRates','448285wsiEVR','hkd','rate','__esModule','startPeriodicUpdates','asc','ils','cad','3794OTFpKT','all','https://api.coingecko.com/api/v3/simple/price','idr','6MFnXqh','toLowerCase','nzd','5895216EDGlLh','findMany','Error\x20getting\x20all\x20rates:','aud','eur','💱\x20Applied\x20','xrp','21224BoWVTm','toFixed','currency','chf','getCurrencyRate','php','\x20USDT,\x20with\x20','length','CURRENCIES','vnd','xag','currencyService','\x20USDT\x20=\x20','\x20to\x20USDT:','tether','970aqybPr','%\x20markup\x20=\x20','CurrencyService','krw','CoinGecko\x20API\x20error:\x20','?ids=tether&vs_currencies=','Error\x20getting\x20rate\x20for\x20currency\x20','dkk','defineProperty','Periodic\x20currency\x20rates\x20update\x20failed:'];a38_0x4129=function(){return _0x1c7ec0;};return a38_0x4129();}function a38_0x583e(_0x5aa334,_0x19f0ae){const _0x412940=a38_0x4129();return a38_0x583e=function(_0x583e51,_0x3be478){_0x583e51=_0x583e51-0x1c6;let _0x1f6396=_0x412940[_0x583e51];return _0x1f6396;},a38_0x583e(_0x5aa334,_0x19f0ae);}Object[a38_0x1dea18(0x20d)](exports,a38_0x1dea18(0x1e3),{'value':!![]}),exports[a38_0x1dea18(0x201)]=exports[a38_0x1dea18(0x207)]=void 0x0;const database_1=__importDefault(require(a38_0x1dea18(0x1de)));class CurrencyService{constructor(){const _0x44e8fe=a38_0x1dea18;this[_0x44e8fe(0x238)]=_0x44e8fe(0x1ea),this[_0x44e8fe(0x1fe)]=['btc',_0x44e8fe(0x234),_0x44e8fe(0x1d2),'bch',_0x44e8fe(0x1cd),'eos',_0x44e8fe(0x1f5),'xlm',_0x44e8fe(0x1cc),_0x44e8fe(0x1ca),'yfi','usd','aed','ars',_0x44e8fe(0x1f2),_0x44e8fe(0x230),'bhd',_0x44e8fe(0x1d1),_0x44e8fe(0x21d),_0x44e8fe(0x1e7),_0x44e8fe(0x1f9),'clp',_0x44e8fe(0x1d5),'czk',_0x44e8fe(0x20c),_0x44e8fe(0x1f3),'gbp','gel',_0x44e8fe(0x1e1),'huf',_0x44e8fe(0x1eb),_0x44e8fe(0x1e6),'inr',_0x44e8fe(0x241),_0x44e8fe(0x208),'kwd',_0x44e8fe(0x21e),_0x44e8fe(0x232),'mxn',_0x44e8fe(0x211),'ngn',_0x44e8fe(0x218),_0x44e8fe(0x1ee),_0x44e8fe(0x1fb),'pkr',_0x44e8fe(0x216),'rub',_0x44e8fe(0x240),_0x44e8fe(0x22e),_0x44e8fe(0x1cb),_0x44e8fe(0x23c),_0x44e8fe(0x1ce),_0x44e8fe(0x22c),_0x44e8fe(0x1dc),'vef',_0x44e8fe(0x1ff),'zar',_0x44e8fe(0x225),_0x44e8fe(0x200),_0x44e8fe(0x23e),_0x44e8fe(0x1cf),'sats'],this['updateInterval']=null,this[_0x44e8fe(0x213)]=0x3,this[_0x44e8fe(0x1e4)]();}[a38_0x1dea18(0x1e4)](){const _0x1317f8=a38_0x1dea18;this['updateCurrencyRates']()['catch'](_0x4f300e=>{const _0x7dc301=a38_0x583e;console[_0x7dc301(0x23d)](_0x7dc301(0x210),_0x4f300e);}),this[_0x1317f8(0x239)]=setInterval(async()=>{const _0x4f537c=_0x1317f8;try{await this[_0x4f537c(0x1df)]();}catch(_0x2f9f01){console[_0x4f537c(0x23d)](_0x4f537c(0x20e),_0x2f9f01);}},0x3c*0x3c*0x3e8),console['log'](_0x1317f8(0x1d9));}[a38_0x1dea18(0x1d7)](){const _0x455288=a38_0x1dea18;this[_0x455288(0x239)]&&(clearInterval(this['updateInterval']),this[_0x455288(0x239)]=null,console[_0x455288(0x21f)](_0x455288(0x1d3)));}async[a38_0x1dea18(0x1df)](){const _0x39735f=a38_0x1dea18;try{console[_0x39735f(0x21f)](_0x39735f(0x220));const _0x3d800b=this[_0x39735f(0x1fe)][_0x39735f(0x226)](','),_0x4ac99e=this[_0x39735f(0x238)]+_0x39735f(0x20a)+_0x3d800b,_0x4283b9=await fetch(_0x4ac99e,{'headers':{'Accept':_0x39735f(0x23a),'User-Agent':_0x39735f(0x1d0)}});if(!_0x4283b9['ok'])throw new Error(_0x39735f(0x209)+_0x4283b9['status']+'\x20'+_0x4283b9[_0x39735f(0x222)]);const _0x3ed4b4=await _0x4283b9[_0x39735f(0x23f)]();if(!_0x3ed4b4[_0x39735f(0x204)])throw new Error(_0x39735f(0x231));const _0x44730d=_0x3ed4b4['tether'];console[_0x39735f(0x21f)](_0x39735f(0x217)+Object['keys'](_0x44730d)[_0x39735f(0x1fd)]+_0x39735f(0x21a));const _0x3d27fe=Object[_0x39735f(0x22a)](_0x44730d)['map'](async([_0x8ab902,_0x6d6b9])=>{const _0x24faab=_0x39735f;try{await database_1[_0x24faab(0x224)][_0x24faab(0x212)]['upsert']({'where':{'currency':_0x8ab902[_0x24faab(0x1ed)]()},'update':{'rate':_0x6d6b9},'create':{'currency':_0x8ab902[_0x24faab(0x1ed)](),'rate':_0x6d6b9}});}catch(_0x14eb9f){console[_0x24faab(0x23d)](_0x24faab(0x236)+_0x8ab902+':',_0x14eb9f);}});await Promise[_0x39735f(0x215)](_0x3d27fe),console['log'](_0x39735f(0x1d8));}catch(_0x3d59ec){console['error'](_0x39735f(0x22b),_0x3d59ec);throw _0x3d59ec;}}async[a38_0x1dea18(0x1fa)](_0x3aba91){const _0x11a724=a38_0x1dea18,_0x98df44=_0x3aba91[_0x11a724(0x1ed)]();if(_0x98df44===_0x11a724(0x233))return 0x1;try{const _0x340eb6=await database_1[_0x11a724(0x224)]['currencyRate']['findUnique']({'where':{'currency':_0x98df44}});if(!_0x340eb6)return console[_0x11a724(0x1c8)](_0x11a724(0x22f)+_0x3aba91+_0x11a724(0x227)),0x1;return _0x340eb6[_0x11a724(0x1e2)];}catch(_0x1ff2c9){return console[_0x11a724(0x23d)](_0x11a724(0x20b)+_0x3aba91+':',_0x1ff2c9),0x1;}}async[a38_0x1dea18(0x21c)](_0x533694,_0x590c7c){const _0x3d2b11=a38_0x1dea18,_0x2edaa5=_0x590c7c[_0x3d2b11(0x1ed)]();if(_0x2edaa5===_0x3d2b11(0x233)){const _0x221fa1=_0x533694*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3d2b11(0x21f)](_0x3d2b11(0x1f4)+this[_0x3d2b11(0x213)]+_0x3d2b11(0x21b)+_0x533694+_0x3d2b11(0x202)+_0x221fa1[_0x3d2b11(0x1f7)](0x6)+_0x3d2b11(0x223)),_0x221fa1;}try{const _0x42973b=await this[_0x3d2b11(0x1fa)](_0x2edaa5),_0x3390c1=_0x533694/_0x42973b,_0x2db149=_0x3390c1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3d2b11(0x21f)](_0x3d2b11(0x214)+_0x533694+'\x20'+_0x590c7c[_0x3d2b11(0x1d6)]()+_0x3d2b11(0x237)+_0x3390c1[_0x3d2b11(0x1f7)](0x6)+_0x3d2b11(0x1fc)+this[_0x3d2b11(0x213)]+_0x3d2b11(0x206)+_0x2db149['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x42973b+')'),_0x2db149;}catch(_0x2378d2){console[_0x3d2b11(0x23d)]('Error\x20converting\x20'+_0x533694+'\x20'+_0x590c7c+_0x3d2b11(0x203),_0x2378d2);const _0xe434a3=_0x533694*(0x1+this[_0x3d2b11(0x213)]/0x64);return _0xe434a3;}}async[a38_0x1dea18(0x219)](_0x73996){const _0xbbc643=a38_0x1dea18;let _0x1816c0=0x0;for(const {amount:_0x20c837,currency:_0x537fbd}of _0x73996){const _0x5d1e68=await this[_0xbbc643(0x21c)](_0x20c837,_0x537fbd);_0x1816c0+=_0x5d1e68;}return _0x1816c0;}async[a38_0x1dea18(0x229)](){const _0x4b0730=a38_0x1dea18;try{const _0x4dd8c1=await database_1['default'][_0x4b0730(0x212)][_0x4b0730(0x1f0)]({'select':{'currency':!![],'rate':!![]}}),_0x40bd8b={'usdt':0x1};return _0x4dd8c1['forEach'](_0x2b808b=>{const _0x513e4c=_0x4b0730;_0x40bd8b[_0x2b808b[_0x513e4c(0x1f8)]]=_0x2b808b[_0x513e4c(0x1e2)];}),_0x40bd8b;}catch(_0x21752d){return console[_0x4b0730(0x23d)](_0x4b0730(0x1f1),_0x21752d),{'usdt':0x1};}}async['getRatesStatus'](){const _0x17bb90=a38_0x1dea18;try{const [_0x36dd47,_0x49db3d,_0x35f716]=await Promise[_0x17bb90(0x1e9)]([database_1['default'][_0x17bb90(0x212)][_0x17bb90(0x1c7)](),database_1[_0x17bb90(0x224)][_0x17bb90(0x212)][_0x17bb90(0x23b)]({'orderBy':{'updatedAt':_0x17bb90(0x1db)},'select':{'updatedAt':!![]}}),database_1[_0x17bb90(0x224)][_0x17bb90(0x212)][_0x17bb90(0x23b)]({'orderBy':{'updatedAt':_0x17bb90(0x1e5)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x36dd47,'lastUpdated':_0x49db3d?.[_0x17bb90(0x1da)]||null,'oldestRate':_0x35f716?.[_0x17bb90(0x1da)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x5487d2){return console[_0x17bb90(0x23d)](_0x17bb90(0x1c6),_0x5487d2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x1dea18(0x1c9)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a38_0x1dea18(0x201)]=new CurrencyService();