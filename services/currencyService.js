'use strict';const a38_0x153444=a38_0x5569;(function(_0x3c6414,_0xd08e3){const _0x526e3a=a38_0x5569,_0x2a570f=_0x3c6414();while(!![]){try{const _0x2767a0=parseInt(_0x526e3a(0x195))/0x1*(parseInt(_0x526e3a(0x143))/0x2)+-parseInt(_0x526e3a(0x15b))/0x3*(-parseInt(_0x526e3a(0x14e))/0x4)+parseInt(_0x526e3a(0x12a))/0x5*(-parseInt(_0x526e3a(0x177))/0x6)+parseInt(_0x526e3a(0x189))/0x7+parseInt(_0x526e3a(0x134))/0x8+parseInt(_0x526e3a(0x15d))/0x9+-parseInt(_0x526e3a(0x139))/0xa*(parseInt(_0x526e3a(0x16e))/0xb);if(_0x2767a0===_0xd08e3)break;else _0x2a570f['push'](_0x2a570f['shift']());}catch(_0x10e59b){_0x2a570f['push'](_0x2a570f['shift']());}}}(a38_0x48d0,0xed1bf));function a38_0x5569(_0x449087,_0x1036a3){const _0x48d0f2=a38_0x48d0();return a38_0x5569=function(_0x556963,_0x3e517a){_0x556963=_0x556963-0x11d;let _0x1cab46=_0x48d0f2[_0x556963];return _0x1cab46;},a38_0x5569(_0x449087,_0x1036a3);}var __importDefault=this&&this[a38_0x153444(0x124)]||function(_0x4928a6){const _0x1d619f=a38_0x153444;return _0x4928a6&&_0x4928a6[_0x1d619f(0x175)]?_0x4928a6:{'default':_0x4928a6};};Object[a38_0x153444(0x16c)](exports,'__esModule',{'value':!![]}),exports[a38_0x153444(0x126)]=exports[a38_0x153444(0x176)]=void 0x0;function a38_0x48d0(){const _0x5b5db5=['💱\x20Converted\x20','pln','entries','Failed\x20to\x20update\x20rate\x20for\x20','1920JKuAXW','Error\x20converting\x20','aud','status','all','convertMultipleToUSDT','yfi','aed','findMany','ils','1012kNgDtG','Error\x20getting\x20all\x20rates:','bch','📊\x20Received\x20rates\x20for\x20','?ids=tether&vs_currencies=','catch','link','jpy','default','zar','allSettled','4568gTljJJ','TesSoft\x20Payment\x20System/1.0','xau','MARKUP_PERCENTAGE','ltc','chf','hkd','eth','toLowerCase','join','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','tether','myr','282jKLpdS','lkr','5715594Fumcgr','bdt','nok','forEach','eur','idr','CURRENCIES','updateInterval','rub','currency','btc','error','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','\x20to\x20USDT:','Initial\x20currency\x20rates\x20update\x20failed:','defineProperty','application/json','101079HvmPCU','uah','✅\x20Currency\x20rates\x20updated\x20successfully','gbp','Error\x20getting\x20rate\x20for\x20currency\x20','../config/database','Periodic\x20currency\x20rates\x20update\x20failed:','__esModule','CurrencyService','42GCSCfF','statusText','updatedAt','findUnique','asc','cad','usdt',',\x20using\x201\x20as\x20fallback','\x20to\x20','%\x20markup\x20=\x20','No\x20rate\x20found\x20for\x20currency:\x20','pkr','\x20USDT\x20=\x20','twd','nzd','thb','bhd','findFirst','4001928zAtytu','clp','toFixed','keys','mmk','xrp','startPeriodicUpdates','json','ars','eos','log','desc','1983IlLsNQ','sats','rate','sar','getCurrencyRate','bits','getAllRates','currencyRate','COINGECKO_URL','czk','updateCurrencyRates','__importDefault','%\x20markup\x20to\x20','currencyService','\x20USDT,\x20with\x20','convertToUSDT','💱\x20Applied\x20','546335kyFngP','getMarkupPercentage','sgd','\x20USDT','cny','count','php','kwd','brl','dot','9462720FGNYVg'];a38_0x48d0=function(){return _0x5b5db5;};return a38_0x48d0();}const database_1=__importDefault(require(a38_0x153444(0x173)));class CurrencyService{constructor(){const _0x35afa6=a38_0x153444;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x35afa6(0x163)]=[_0x35afa6(0x167),_0x35afa6(0x155),_0x35afa6(0x152),_0x35afa6(0x145),'bnb',_0x35afa6(0x192),_0x35afa6(0x18e),'xlm',_0x35afa6(0x149),_0x35afa6(0x133),_0x35afa6(0x13f),'usd',_0x35afa6(0x140),_0x35afa6(0x191),_0x35afa6(0x13b),_0x35afa6(0x15e),_0x35afa6(0x187),'bmd',_0x35afa6(0x132),_0x35afa6(0x17c),_0x35afa6(0x153),_0x35afa6(0x18a),_0x35afa6(0x12e),_0x35afa6(0x122),'dkk',_0x35afa6(0x161),_0x35afa6(0x171),'gel',_0x35afa6(0x154),'huf',_0x35afa6(0x162),_0x35afa6(0x142),'inr',_0x35afa6(0x14a),'krw',_0x35afa6(0x131),_0x35afa6(0x15c),_0x35afa6(0x18d),'mxn',_0x35afa6(0x15a),'ngn',_0x35afa6(0x15f),_0x35afa6(0x185),_0x35afa6(0x130),_0x35afa6(0x182),_0x35afa6(0x136),_0x35afa6(0x165),_0x35afa6(0x198),'sek',_0x35afa6(0x12c),_0x35afa6(0x186),'try',_0x35afa6(0x184),_0x35afa6(0x16f),'vef','vnd',_0x35afa6(0x14c),'xdr','xag',_0x35afa6(0x150),_0x35afa6(0x11e),_0x35afa6(0x196)],this[_0x35afa6(0x164)]=null,this[_0x35afa6(0x151)]=0x3,this[_0x35afa6(0x18f)]();}[a38_0x153444(0x18f)](){const _0x39d0f5=a38_0x153444;this[_0x39d0f5(0x123)]()[_0x39d0f5(0x148)](_0x486119=>{const _0x44d13e=_0x39d0f5;console[_0x44d13e(0x168)](_0x44d13e(0x16b),_0x486119);}),this[_0x39d0f5(0x164)]=setInterval(async()=>{const _0x2f28dd=_0x39d0f5;try{await this[_0x2f28dd(0x123)]();}catch(_0x552bb9){console[_0x2f28dd(0x168)](_0x2f28dd(0x174),_0x552bb9);}},0x3c*0x3c*0x3e8),console[_0x39d0f5(0x193)](_0x39d0f5(0x158));}['stopPeriodicUpdates'](){const _0x3578f8=a38_0x153444;this[_0x3578f8(0x164)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x3578f8(0x193)](_0x3578f8(0x169)));}async[a38_0x153444(0x123)](){const _0x37d7bc=a38_0x153444;try{console[_0x37d7bc(0x193)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x13f326=this[_0x37d7bc(0x163)][_0x37d7bc(0x157)](','),_0x10c2dd=this[_0x37d7bc(0x121)]+_0x37d7bc(0x147)+_0x13f326,_0x9d5ae3=await fetch(_0x10c2dd,{'headers':{'Accept':_0x37d7bc(0x16d),'User-Agent':_0x37d7bc(0x14f)}});if(!_0x9d5ae3['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x9d5ae3[_0x37d7bc(0x13c)]+'\x20'+_0x9d5ae3[_0x37d7bc(0x178)]);const _0x124e74=await _0x9d5ae3[_0x37d7bc(0x190)]();if(!_0x124e74[_0x37d7bc(0x159)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x5ce619=_0x124e74[_0x37d7bc(0x159)];console[_0x37d7bc(0x193)](_0x37d7bc(0x146)+Object[_0x37d7bc(0x18c)](_0x5ce619)['length']+'\x20currencies');const _0x178c96=Object[_0x37d7bc(0x137)](_0x5ce619)['map'](async([_0x343ca0,_0x4312e0])=>{const _0x1c115f=_0x37d7bc;try{await database_1[_0x1c115f(0x14b)][_0x1c115f(0x120)]['upsert']({'where':{'currency':_0x343ca0['toLowerCase']()},'update':{'rate':_0x4312e0},'create':{'currency':_0x343ca0[_0x1c115f(0x156)](),'rate':_0x4312e0}});}catch(_0x3f06d7){console[_0x1c115f(0x168)](_0x1c115f(0x138)+_0x343ca0+':',_0x3f06d7);}});await Promise[_0x37d7bc(0x14d)](_0x178c96),console[_0x37d7bc(0x193)](_0x37d7bc(0x170));}catch(_0x3d15f){console[_0x37d7bc(0x168)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x3d15f);throw _0x3d15f;}}async[a38_0x153444(0x11d)](_0x404b83){const _0xf0c075=a38_0x153444,_0x5ea08b=_0x404b83[_0xf0c075(0x156)]();if(_0x5ea08b===_0xf0c075(0x17d))return 0x1;try{const _0x588fd8=await database_1[_0xf0c075(0x14b)][_0xf0c075(0x120)][_0xf0c075(0x17a)]({'where':{'currency':_0x5ea08b}});if(!_0x588fd8)return console['warn'](_0xf0c075(0x181)+_0x404b83+_0xf0c075(0x17e)),0x1;return _0x588fd8[_0xf0c075(0x197)];}catch(_0x40fb56){return console['error'](_0xf0c075(0x172)+_0x404b83+':',_0x40fb56),0x1;}}async[a38_0x153444(0x128)](_0xb7e076,_0x3dd0ab){const _0x11110c=a38_0x153444,_0x427752=_0x3dd0ab[_0x11110c(0x156)]();if(_0x427752===_0x11110c(0x17d)){const _0x554867=_0xb7e076*(0x1+this[_0x11110c(0x151)]/0x64);return console[_0x11110c(0x193)](_0x11110c(0x129)+this[_0x11110c(0x151)]+_0x11110c(0x125)+_0xb7e076+_0x11110c(0x183)+_0x554867[_0x11110c(0x18b)](0x6)+_0x11110c(0x12d)),_0x554867;}try{const _0x1094ca=await this[_0x11110c(0x11d)](_0x427752),_0xf2cfbb=_0xb7e076/_0x1094ca,_0x337556=_0xf2cfbb*(0x1+this[_0x11110c(0x151)]/0x64);return console[_0x11110c(0x193)](_0x11110c(0x135)+_0xb7e076+'\x20'+_0x3dd0ab['toUpperCase']()+_0x11110c(0x17f)+_0xf2cfbb[_0x11110c(0x18b)](0x6)+_0x11110c(0x127)+this[_0x11110c(0x151)]+_0x11110c(0x180)+_0x337556['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x1094ca+')'),_0x337556;}catch(_0x2248d9){console['error'](_0x11110c(0x13a)+_0xb7e076+'\x20'+_0x3dd0ab+_0x11110c(0x16a),_0x2248d9);const _0x29d594=_0xb7e076*(0x1+this[_0x11110c(0x151)]/0x64);return _0x29d594;}}async[a38_0x153444(0x13e)](_0x382749){let _0xf1d5ad=0x0;for(const {amount:_0x2f0667,currency:_0x35e31}of _0x382749){const _0x201996=await this['convertToUSDT'](_0x2f0667,_0x35e31);_0xf1d5ad+=_0x201996;}return _0xf1d5ad;}async[a38_0x153444(0x11f)](){const _0x44c3d9=a38_0x153444;try{const _0x3128c5=await database_1[_0x44c3d9(0x14b)]['currencyRate'][_0x44c3d9(0x141)]({'select':{'currency':!![],'rate':!![]}}),_0x303223={'usdt':0x1};return _0x3128c5[_0x44c3d9(0x160)](_0x9509a3=>{const _0x3ce266=_0x44c3d9;_0x303223[_0x9509a3[_0x3ce266(0x166)]]=_0x9509a3[_0x3ce266(0x197)];}),_0x303223;}catch(_0x5e8b68){return console[_0x44c3d9(0x168)](_0x44c3d9(0x144),_0x5e8b68),{'usdt':0x1};}}async['getRatesStatus'](){const _0x5f1f36=a38_0x153444;try{const [_0x4469fa,_0x5226d4,_0x2822b3]=await Promise[_0x5f1f36(0x13d)]([database_1[_0x5f1f36(0x14b)][_0x5f1f36(0x120)][_0x5f1f36(0x12f)](),database_1[_0x5f1f36(0x14b)]['currencyRate'][_0x5f1f36(0x188)]({'orderBy':{'updatedAt':_0x5f1f36(0x194)},'select':{'updatedAt':!![]}}),database_1['default'][_0x5f1f36(0x120)]['findFirst']({'orderBy':{'updatedAt':_0x5f1f36(0x17b)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4469fa,'lastUpdated':_0x5226d4?.[_0x5f1f36(0x179)]||null,'oldestRate':_0x2822b3?.[_0x5f1f36(0x179)]||null,'markupPercentage':this[_0x5f1f36(0x151)]};}catch(_0x19836a){return console[_0x5f1f36(0x168)]('Error\x20getting\x20rates\x20status:',_0x19836a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x153444(0x12b)](){return this['MARKUP_PERCENTAGE'];}}exports[a38_0x153444(0x176)]=CurrencyService,exports[a38_0x153444(0x126)]=new CurrencyService();