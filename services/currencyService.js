'use strict';const a41_0x5e0b59=a41_0x1ae0;(function(_0x13457c,_0x2bee23){const _0x216c25=a41_0x1ae0,_0x140b54=_0x13457c();while(!![]){try{const _0x84cea9=parseInt(_0x216c25(0x1d1))/0x1+-parseInt(_0x216c25(0x192))/0x2*(parseInt(_0x216c25(0x1b7))/0x3)+parseInt(_0x216c25(0x1db))/0x4+-parseInt(_0x216c25(0x1ca))/0x5*(-parseInt(_0x216c25(0x1bb))/0x6)+-parseInt(_0x216c25(0x179))/0x7+-parseInt(_0x216c25(0x1c0))/0x8*(parseInt(_0x216c25(0x199))/0x9)+parseInt(_0x216c25(0x18f))/0xa*(-parseInt(_0x216c25(0x1d2))/0xb);if(_0x84cea9===_0x2bee23)break;else _0x140b54['push'](_0x140b54['shift']());}catch(_0x238140){_0x140b54['push'](_0x140b54['shift']());}}}(a41_0x1e9c,0xd01c6));var __importDefault=this&&this[a41_0x5e0b59(0x1ba)]||function(_0x2b2f77){const _0x339e49=a41_0x5e0b59;return _0x2b2f77&&_0x2b2f77[_0x339e49(0x191)]?_0x2b2f77:{'default':_0x2b2f77};};function a41_0x1e9c(){const _0x5f4f9a=['gel','?ids=tether&vs_currencies=','\x20currencies','idr','findUnique','❌\x20Failed\x20to\x20update\x20currency\x20rates:','stopPeriodicUpdates','upsert','xau','link','findMany','sek','thb','allSettled','No\x20rate\x20found\x20for\x20currency:\x20','%\x20markup\x20=\x20','mxn','💱\x20Applied\x20','401023xXWwcb','toFixed','Error\x20getting\x20rates\x20status:','\x20USDT\x20(rate:\x20','tether','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','updateCurrencyRates','brl','CURRENCIES','application/json','cad','all','usd','💱\x20Converted\x20','../config/database','eos','defineProperty','currencyService','bdt','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','getMarkupPercentage','convertMultipleToUSDT','75340zjoNNx','huf','__esModule','2HGiLCB','json','sgd','bits','uah','asc','default','576UmPKhf','\x20USDT\x20=\x20','xlm','entries','pkr','czk','try','toLowerCase','inr','xrp','xdr','dot','startPeriodicUpdates','warn','\x20to\x20USDT:','count','sats','getCurrencyRate','nzd','gbp','\x20USDT,\x20with\x20','\x20to\x20','aed','CurrencyService','error','getRatesStatus','bmd','log','desc','statusText','1656372FteCrn','sar','cny','__importDefault','60lmDcwt','\x20USDT','updateInterval','TesSoft\x20Payment\x20System/1.0','vef','53840NPhbCJ','Error\x20getting\x20rate\x20for\x20currency\x20','nok','lkr','pln','convertToUSDT','currencyRate','updatedAt','Failed\x20to\x20update\x20rate\x20for\x20','btc','439665bQhpEI','https://api.coingecko.com/api/v3/simple/price','Periodic\x20currency\x20rates\x20update\x20failed:','php','ltc','usdt','ils','1116376WjUvVc','638xCfBlX','keys','COINGECKO_URL','mmk','yfi','ngn','MARKUP_PERCENTAGE','bnb','%\x20markup\x20to\x20','1335284oCgByD','currency','krw','Initial\x20currency\x20rates\x20update\x20failed:'];a41_0x1e9c=function(){return _0x5f4f9a;};return a41_0x1e9c();}Object[a41_0x5e0b59(0x189)](exports,a41_0x5e0b59(0x191),{'value':!![]}),exports[a41_0x5e0b59(0x18a)]=exports[a41_0x5e0b59(0x1b0)]=void 0x0;function a41_0x1ae0(_0x1691d7,_0x52f7fe){const _0x1e9cae=a41_0x1e9c();return a41_0x1ae0=function(_0x1ae013,_0xff2a52){_0x1ae013=_0x1ae013-0x16f;let _0x46ac19=_0x1e9cae[_0x1ae013];return _0x46ac19;},a41_0x1ae0(_0x1691d7,_0x52f7fe);}const database_1=__importDefault(require(a41_0x5e0b59(0x187)));class CurrencyService{constructor(){const _0x39d825=a41_0x5e0b59;this['COINGECKO_URL']=_0x39d825(0x1cb),this[_0x39d825(0x181)]=[_0x39d825(0x1c9),'eth',_0x39d825(0x1ce),'bch',_0x39d825(0x1d9),_0x39d825(0x188),_0x39d825(0x1a2),_0x39d825(0x19b),_0x39d825(0x170),_0x39d825(0x1a4),_0x39d825(0x1d6),_0x39d825(0x185),_0x39d825(0x1af),'ars','aud',_0x39d825(0x18b),'bhd',_0x39d825(0x1b3),_0x39d825(0x180),_0x39d825(0x183),'chf','clp',_0x39d825(0x1b9),_0x39d825(0x19e),'dkk','eur',_0x39d825(0x1ac),_0x39d825(0x1df),'hkd',_0x39d825(0x190),_0x39d825(0x1e2),_0x39d825(0x1d0),_0x39d825(0x1a1),'jpy',_0x39d825(0x1dd),'kwd',_0x39d825(0x1c3),_0x39d825(0x1d5),_0x39d825(0x177),'myr',_0x39d825(0x1d7),_0x39d825(0x1c2),_0x39d825(0x1ab),_0x39d825(0x1cd),_0x39d825(0x19d),_0x39d825(0x1c4),'rub',_0x39d825(0x1b8),_0x39d825(0x172),_0x39d825(0x194),_0x39d825(0x173),_0x39d825(0x19f),'twd',_0x39d825(0x196),_0x39d825(0x1bf),'vnd','zar',_0x39d825(0x1a3),'xag',_0x39d825(0x16f),_0x39d825(0x195),_0x39d825(0x1a9)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x39d825(0x1a5)]();}['startPeriodicUpdates'](){const _0x35b043=a41_0x5e0b59;this[_0x35b043(0x17f)]()['catch'](_0x5db94d=>{const _0x5ed309=_0x35b043;console[_0x5ed309(0x1b1)](_0x5ed309(0x1de),_0x5db94d);}),this[_0x35b043(0x1bd)]=setInterval(async()=>{const _0x41bc11=_0x35b043;try{await this['updateCurrencyRates']();}catch(_0x21a1f1){console[_0x41bc11(0x1b1)](_0x41bc11(0x1cc),_0x21a1f1);}},0x3c*0x3c*0x3e8),console[_0x35b043(0x1b4)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a41_0x5e0b59(0x1e5)](){const _0x1785d9=a41_0x5e0b59;this[_0x1785d9(0x1bd)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x1785d9(0x1b4)](_0x1785d9(0x18c)));}async[a41_0x5e0b59(0x17f)](){const _0x17de7a=a41_0x5e0b59;try{console[_0x17de7a(0x1b4)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xf2d55d=this[_0x17de7a(0x181)]['join'](','),_0x179318=this[_0x17de7a(0x1d4)]+_0x17de7a(0x1e0)+_0xf2d55d,_0x118d82=await fetch(_0x179318,{'headers':{'Accept':_0x17de7a(0x182),'User-Agent':_0x17de7a(0x1be)}});if(!_0x118d82['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x118d82['status']+'\x20'+_0x118d82[_0x17de7a(0x1b6)]);const _0x45aa02=await _0x118d82[_0x17de7a(0x193)]();if(!_0x45aa02[_0x17de7a(0x17d)])throw new Error(_0x17de7a(0x17e));const _0xac6f94=_0x45aa02[_0x17de7a(0x17d)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x17de7a(0x1d3)](_0xac6f94)['length']+_0x17de7a(0x1e1));const _0x4e3063=Object[_0x17de7a(0x19c)](_0xac6f94)['map'](async([_0x5544df,_0x6fe517])=>{const _0x3948d1=_0x17de7a;try{await database_1['default'][_0x3948d1(0x1c6)][_0x3948d1(0x1e6)]({'where':{'currency':_0x5544df[_0x3948d1(0x1a0)]()},'update':{'rate':_0x6fe517},'create':{'currency':_0x5544df[_0x3948d1(0x1a0)](),'rate':_0x6fe517}});}catch(_0x1759fc){console[_0x3948d1(0x1b1)](_0x3948d1(0x1c8)+_0x5544df+':',_0x1759fc);}});await Promise[_0x17de7a(0x174)](_0x4e3063),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x5a667d){console[_0x17de7a(0x1b1)](_0x17de7a(0x1e4),_0x5a667d);throw _0x5a667d;}}async[a41_0x5e0b59(0x1aa)](_0x480af2){const _0x2d5eda=a41_0x5e0b59,_0x13bb97=_0x480af2['toLowerCase']();if(_0x13bb97===_0x2d5eda(0x1cf))return 0x1;try{const _0x4bea02=await database_1[_0x2d5eda(0x198)][_0x2d5eda(0x1c6)][_0x2d5eda(0x1e3)]({'where':{'currency':_0x13bb97}});if(!_0x4bea02)return console[_0x2d5eda(0x1a6)](_0x2d5eda(0x175)+_0x480af2+',\x20using\x201\x20as\x20fallback'),0x1;return _0x4bea02['rate'];}catch(_0x1031e8){return console[_0x2d5eda(0x1b1)](_0x2d5eda(0x1c1)+_0x480af2+':',_0x1031e8),0x1;}}async[a41_0x5e0b59(0x1c5)](_0x2097a3,_0x1a881e){const _0x5d2fe1=a41_0x5e0b59,_0x2ae3ea=_0x1a881e[_0x5d2fe1(0x1a0)]();if(_0x2ae3ea===_0x5d2fe1(0x1cf)){const _0x5a3887=_0x2097a3*(0x1+this[_0x5d2fe1(0x1d8)]/0x64);return console[_0x5d2fe1(0x1b4)](_0x5d2fe1(0x178)+this[_0x5d2fe1(0x1d8)]+_0x5d2fe1(0x1da)+_0x2097a3+_0x5d2fe1(0x19a)+_0x5a3887['toFixed'](0x6)+_0x5d2fe1(0x1bc)),_0x5a3887;}try{const _0xdea0f4=await this[_0x5d2fe1(0x1aa)](_0x2ae3ea),_0x370a69=_0x2097a3/_0xdea0f4,_0x3ab9a8=_0x370a69*(0x1+this[_0x5d2fe1(0x1d8)]/0x64);return console[_0x5d2fe1(0x1b4)](_0x5d2fe1(0x186)+_0x2097a3+'\x20'+_0x1a881e['toUpperCase']()+_0x5d2fe1(0x1ae)+_0x370a69[_0x5d2fe1(0x17a)](0x6)+_0x5d2fe1(0x1ad)+this[_0x5d2fe1(0x1d8)]+_0x5d2fe1(0x176)+_0x3ab9a8[_0x5d2fe1(0x17a)](0x6)+_0x5d2fe1(0x17c)+_0xdea0f4+')'),_0x3ab9a8;}catch(_0xdc3c79){console[_0x5d2fe1(0x1b1)]('Error\x20converting\x20'+_0x2097a3+'\x20'+_0x1a881e+_0x5d2fe1(0x1a7),_0xdc3c79);const _0x1f8e13=_0x2097a3*(0x1+this[_0x5d2fe1(0x1d8)]/0x64);return _0x1f8e13;}}async[a41_0x5e0b59(0x18e)](_0x3a998a){const _0x4e7b7c=a41_0x5e0b59;let _0x1498c9=0x0;for(const {amount:_0x488579,currency:_0x20726b}of _0x3a998a){const _0x20d786=await this[_0x4e7b7c(0x1c5)](_0x488579,_0x20726b);_0x1498c9+=_0x20d786;}return _0x1498c9;}async['getAllRates'](){const _0x3343a3=a41_0x5e0b59;try{const _0xf20585=await database_1[_0x3343a3(0x198)]['currencyRate'][_0x3343a3(0x171)]({'select':{'currency':!![],'rate':!![]}}),_0x1dba04={'usdt':0x1};return _0xf20585['forEach'](_0x2691d3=>{const _0x5974b2=_0x3343a3;_0x1dba04[_0x2691d3[_0x5974b2(0x1dc)]]=_0x2691d3['rate'];}),_0x1dba04;}catch(_0x5d4001){return console[_0x3343a3(0x1b1)]('Error\x20getting\x20all\x20rates:',_0x5d4001),{'usdt':0x1};}}async[a41_0x5e0b59(0x1b2)](){const _0x12ec0c=a41_0x5e0b59;try{const [_0x124754,_0x577f72,_0x4b69a7]=await Promise[_0x12ec0c(0x184)]([database_1['default'][_0x12ec0c(0x1c6)][_0x12ec0c(0x1a8)](),database_1[_0x12ec0c(0x198)][_0x12ec0c(0x1c6)]['findFirst']({'orderBy':{'updatedAt':_0x12ec0c(0x1b5)},'select':{'updatedAt':!![]}}),database_1[_0x12ec0c(0x198)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x12ec0c(0x197)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x124754,'lastUpdated':_0x577f72?.[_0x12ec0c(0x1c7)]||null,'oldestRate':_0x4b69a7?.[_0x12ec0c(0x1c7)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x3310d0){return console[_0x12ec0c(0x1b1)](_0x12ec0c(0x17b),_0x3310d0),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x12ec0c(0x1d8)]};}}[a41_0x5e0b59(0x18d)](){const _0x149aa7=a41_0x5e0b59;return this[_0x149aa7(0x1d8)];}}exports[a41_0x5e0b59(0x1b0)]=CurrencyService,exports[a41_0x5e0b59(0x18a)]=new CurrencyService();