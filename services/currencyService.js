'use strict';const a36_0x3434ae=a36_0x128a;(function(_0x50d91e,_0x5f0f8f){const _0x5ab3be=a36_0x128a,_0xddca16=_0x50d91e();while(!![]){try{const _0xba174e=parseInt(_0x5ab3be(0x101))/0x1+-parseInt(_0x5ab3be(0x104))/0x2*(parseInt(_0x5ab3be(0xbc))/0x3)+-parseInt(_0x5ab3be(0xf5))/0x4*(parseInt(_0x5ab3be(0x114))/0x5)+parseInt(_0x5ab3be(0xe7))/0x6*(-parseInt(_0x5ab3be(0xd2))/0x7)+-parseInt(_0x5ab3be(0xeb))/0x8*(-parseInt(_0x5ab3be(0xac))/0x9)+parseInt(_0x5ab3be(0xcf))/0xa*(-parseInt(_0x5ab3be(0xd0))/0xb)+parseInt(_0x5ab3be(0xaa))/0xc;if(_0xba174e===_0x5f0f8f)break;else _0xddca16['push'](_0xddca16['shift']());}catch(_0x34112c){_0xddca16['push'](_0xddca16['shift']());}}}(a36_0x1faf,0x339f4));var __importDefault=this&&this['__importDefault']||function(_0x29d825){const _0x3d8ddf=a36_0x128a;return _0x29d825&&_0x29d825[_0x3d8ddf(0xdf)]?_0x29d825:{'default':_0x29d825};};function a36_0x1faf(){const _0x1cacf3=['vef','TesSoft\x20Payment\x20System/1.0','\x20USDT,\x20with\x20','updatedAt','updateCurrencyRates','vnd','1443172QYVfkE','tether','bdt','clp','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','ils','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','usdt','ngn','link','sar','Failed\x20to\x20update\x20rate\x20for\x20','144676jtwTyE','getRatesStatus','toUpperCase','381748VNttXg','MARKUP_PERCENTAGE','lkr','CURRENCIES',',\x20using\x201\x20as\x20fallback','uah','Error\x20converting\x20','\x20USDT','getMarkupPercentage','error','warn','Error\x20getting\x20all\x20rates:','Periodic\x20currency\x20rates\x20update\x20failed:','xag','sats','keys','5BEsOrq','ðŸ’±\x20Applied\x20','eth','eur','Error\x20getting\x20rate\x20for\x20currency\x20','findFirst','json','mxn','currencyService','ðŸ’±\x20Converted\x20','myr','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','%\x20markup\x20=\x20','cny','Error\x20getting\x20rates\x20status:','bhd','thb','findUnique','ðŸ“Š\x20Received\x20rates\x20for\x20','inr','rub','gel','\x20to\x20USDT:','chf','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','statusText','9125892pPLTrI','\x20currencies','3766041BFzhGf','log','rate','Initial\x20currency\x20rates\x20update\x20failed:','toLowerCase','CoinGecko\x20API\x20error:\x20','btc','bmd','bnb','getAllRates','length','currencyRate','xau','defineProperty','gbp','sgd','3lrOvFE','join','COINGECKO_URL','try','xdr','nzd','pkr','convertMultipleToUSDT','startPeriodicUpdates','map','eos','czk','entries','kwd','https://api.coingecko.com/api/v3/simple/price','nok','sek','php','bits','2665210KURNYD','11zGATPE','brl','14KiygOX','updateInterval','convertToUSDT','huf','usd','aud','getCurrencyRate','?ids=tether&vs_currencies=','hkd','currency','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','krw','twd','__esModule','default','status','../config/database','%\x20markup\x20to\x20','catch','all','desc','881952qFOddh','aed','application/json','xrp','8AAzlgI','CurrencyService','jpy','findMany'];a36_0x1faf=function(){return _0x1cacf3;};return a36_0x1faf();}function a36_0x128a(_0x30b8ca,_0x1406d5){const _0x1faf3b=a36_0x1faf();return a36_0x128a=function(_0x128ad7,_0x270691){_0x128ad7=_0x128ad7-0x9c;let _0x5b4cdc=_0x1faf3b[_0x128ad7];return _0x5b4cdc;},a36_0x128a(_0x30b8ca,_0x1406d5);}Object[a36_0x3434ae(0xb9)](exports,a36_0x3434ae(0xdf),{'value':!![]}),exports[a36_0x3434ae(0x11c)]=exports[a36_0x3434ae(0xec)]=void 0x0;const database_1=__importDefault(require(a36_0x3434ae(0xe2)));class CurrencyService{constructor(){const _0x191f88=a36_0x3434ae;this[_0x191f88(0xbe)]=_0x191f88(0xca),this[_0x191f88(0x107)]=[_0x191f88(0xb2),_0x191f88(0x116),'ltc','bch',_0x191f88(0xb4),_0x191f88(0xc6),_0x191f88(0xea),'xlm',_0x191f88(0xfe),'dot','yfi',_0x191f88(0xd6),_0x191f88(0xe8),'ars',_0x191f88(0xd7),_0x191f88(0xf7),_0x191f88(0x9f),_0x191f88(0xb3),_0x191f88(0xd1),'cad',_0x191f88(0xa7),_0x191f88(0xf8),_0x191f88(0x9d),_0x191f88(0xc7),'dkk',_0x191f88(0x117),_0x191f88(0xba),_0x191f88(0xa5),_0x191f88(0xda),_0x191f88(0xd5),'idr',_0x191f88(0xfa),_0x191f88(0xa3),_0x191f88(0xed),_0x191f88(0xdd),_0x191f88(0xc9),_0x191f88(0x106),'mmk',_0x191f88(0x11b),_0x191f88(0x11e),_0x191f88(0xfd),_0x191f88(0xcb),_0x191f88(0xc1),_0x191f88(0xcd),_0x191f88(0xc2),'pln',_0x191f88(0xa4),_0x191f88(0xff),_0x191f88(0xcc),_0x191f88(0xbb),_0x191f88(0xa0),_0x191f88(0xbf),_0x191f88(0xde),_0x191f88(0x109),_0x191f88(0xef),_0x191f88(0xf4),'zar',_0x191f88(0xc0),_0x191f88(0x111),_0x191f88(0xb8),_0x191f88(0xce),_0x191f88(0x112)],this[_0x191f88(0xd3)]=null,this[_0x191f88(0x105)]=0x3,this['startPeriodicUpdates']();}[a36_0x3434ae(0xc4)](){const _0x27ee17=a36_0x3434ae;this[_0x27ee17(0xf3)]()[_0x27ee17(0xe4)](_0x56c551=>{const _0x1af7b5=_0x27ee17;console[_0x1af7b5(0x10d)](_0x1af7b5(0xaf),_0x56c551);}),this[_0x27ee17(0xd3)]=setInterval(async()=>{const _0x387b13=_0x27ee17;try{await this[_0x387b13(0xf3)]();}catch(_0x4356b9){console[_0x387b13(0x10d)](_0x387b13(0x110),_0x4356b9);}},0x3c*0x3c*0x3e8),console[_0x27ee17(0xad)](_0x27ee17(0x11f));}['stopPeriodicUpdates'](){const _0x389324=a36_0x3434ae;this[_0x389324(0xd3)]&&(clearInterval(this[_0x389324(0xd3)]),this[_0x389324(0xd3)]=null,console[_0x389324(0xad)](_0x389324(0xa8)));}async['updateCurrencyRates'](){const _0x8e9124=a36_0x3434ae;try{console[_0x8e9124(0xad)](_0x8e9124(0xdc));const _0x5bafa8=this[_0x8e9124(0x107)][_0x8e9124(0xbd)](','),_0x15390d=this[_0x8e9124(0xbe)]+_0x8e9124(0xd9)+_0x5bafa8,_0x1fbbd8=await fetch(_0x15390d,{'headers':{'Accept':_0x8e9124(0xe9),'User-Agent':_0x8e9124(0xf0)}});if(!_0x1fbbd8['ok'])throw new Error(_0x8e9124(0xb1)+_0x1fbbd8[_0x8e9124(0xe1)]+'\x20'+_0x1fbbd8[_0x8e9124(0xa9)]);const _0x184152=await _0x1fbbd8[_0x8e9124(0x11a)]();if(!_0x184152[_0x8e9124(0xf6)])throw new Error(_0x8e9124(0xf9));const _0x2cc02d=_0x184152[_0x8e9124(0xf6)];console[_0x8e9124(0xad)](_0x8e9124(0xa2)+Object[_0x8e9124(0x113)](_0x2cc02d)[_0x8e9124(0xb6)]+_0x8e9124(0xab));const _0x58cfaf=Object[_0x8e9124(0xc8)](_0x2cc02d)[_0x8e9124(0xc5)](async([_0x4f5302,_0x53b2c0])=>{const _0x28e3ee=_0x8e9124;try{await database_1[_0x28e3ee(0xe0)]['currencyRate']['upsert']({'where':{'currency':_0x4f5302[_0x28e3ee(0xb0)]()},'update':{'rate':_0x53b2c0},'create':{'currency':_0x4f5302[_0x28e3ee(0xb0)](),'rate':_0x53b2c0}});}catch(_0x4eaae5){console[_0x28e3ee(0x10d)](_0x28e3ee(0x100)+_0x4f5302+':',_0x4eaae5);}});await Promise['allSettled'](_0x58cfaf),console['log']('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x1c792c){console[_0x8e9124(0x10d)](_0x8e9124(0xfb),_0x1c792c);throw _0x1c792c;}}async[a36_0x3434ae(0xd8)](_0xd0e68e){const _0x3654f9=a36_0x3434ae,_0x21af58=_0xd0e68e['toLowerCase']();if(_0x21af58===_0x3654f9(0xfc))return 0x1;try{const _0x2b0a20=await database_1[_0x3654f9(0xe0)]['currencyRate'][_0x3654f9(0xa1)]({'where':{'currency':_0x21af58}});if(!_0x2b0a20)return console[_0x3654f9(0x10e)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0xd0e68e+_0x3654f9(0x108)),0x1;return _0x2b0a20[_0x3654f9(0xae)];}catch(_0x38684){return console[_0x3654f9(0x10d)](_0x3654f9(0x118)+_0xd0e68e+':',_0x38684),0x1;}}async[a36_0x3434ae(0xd4)](_0x277dde,_0x46bf53){const _0x3c3a1f=a36_0x3434ae,_0x1ea523=_0x46bf53[_0x3c3a1f(0xb0)]();if(_0x1ea523===_0x3c3a1f(0xfc)){const _0x32de01=_0x277dde*(0x1+this[_0x3c3a1f(0x105)]/0x64);return console['log'](_0x3c3a1f(0x115)+this[_0x3c3a1f(0x105)]+_0x3c3a1f(0xe3)+_0x277dde+'\x20USDT\x20=\x20'+_0x32de01['toFixed'](0x6)+_0x3c3a1f(0x10b)),_0x32de01;}try{const _0x70e463=await this[_0x3c3a1f(0xd8)](_0x1ea523),_0x4c11dd=_0x277dde/_0x70e463,_0x2f1171=_0x4c11dd*(0x1+this[_0x3c3a1f(0x105)]/0x64);return console[_0x3c3a1f(0xad)](_0x3c3a1f(0x11d)+_0x277dde+'\x20'+_0x46bf53[_0x3c3a1f(0x103)]()+'\x20to\x20'+_0x4c11dd['toFixed'](0x6)+_0x3c3a1f(0xf1)+this[_0x3c3a1f(0x105)]+_0x3c3a1f(0x9c)+_0x2f1171['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x70e463+')'),_0x2f1171;}catch(_0x5154c1){console[_0x3c3a1f(0x10d)](_0x3c3a1f(0x10a)+_0x277dde+'\x20'+_0x46bf53+_0x3c3a1f(0xa6),_0x5154c1);const _0x208af5=_0x277dde*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x208af5;}}async[a36_0x3434ae(0xc3)](_0x139ac4){let _0x1fa9b6=0x0;for(const {amount:_0x519d9b,currency:_0x511cde}of _0x139ac4){const _0xdba750=await this['convertToUSDT'](_0x519d9b,_0x511cde);_0x1fa9b6+=_0xdba750;}return _0x1fa9b6;}async[a36_0x3434ae(0xb5)](){const _0x3eeee1=a36_0x3434ae;try{const _0x125d9a=await database_1['default']['currencyRate'][_0x3eeee1(0xee)]({'select':{'currency':!![],'rate':!![]}}),_0x5efcc0={'usdt':0x1};return _0x125d9a['forEach'](_0x544943=>{const _0x215245=_0x3eeee1;_0x5efcc0[_0x544943[_0x215245(0xdb)]]=_0x544943[_0x215245(0xae)];}),_0x5efcc0;}catch(_0x5c1b53){return console[_0x3eeee1(0x10d)](_0x3eeee1(0x10f),_0x5c1b53),{'usdt':0x1};}}async[a36_0x3434ae(0x102)](){const _0x339d70=a36_0x3434ae;try{const [_0x47f1c9,_0x2d5e68,_0x26c4e9]=await Promise[_0x339d70(0xe5)]([database_1[_0x339d70(0xe0)][_0x339d70(0xb7)]['count'](),database_1[_0x339d70(0xe0)][_0x339d70(0xb7)]['findFirst']({'orderBy':{'updatedAt':_0x339d70(0xe6)},'select':{'updatedAt':!![]}}),database_1[_0x339d70(0xe0)][_0x339d70(0xb7)][_0x339d70(0x119)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x47f1c9,'lastUpdated':_0x2d5e68?.[_0x339d70(0xf2)]||null,'oldestRate':_0x26c4e9?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x128f0c){return console[_0x339d70(0x10d)](_0x339d70(0x9e),_0x128f0c),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x339d70(0x105)]};}}[a36_0x3434ae(0x10c)](){const _0x28ae02=a36_0x3434ae;return this[_0x28ae02(0x105)];}}exports[a36_0x3434ae(0xec)]=CurrencyService,exports[a36_0x3434ae(0x11c)]=new CurrencyService();