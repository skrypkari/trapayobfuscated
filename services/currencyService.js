'use strict';const a38_0x307a12=a38_0x5b93;(function(_0x5a3636,_0x2dcd5a){const _0x5772ea=a38_0x5b93,_0x499067=_0x5a3636();while(!![]){try{const _0x1cee10=-parseInt(_0x5772ea(0x240))/0x1*(-parseInt(_0x5772ea(0x244))/0x2)+-parseInt(_0x5772ea(0x23c))/0x3+parseInt(_0x5772ea(0x1fb))/0x4+parseInt(_0x5772ea(0x1f4))/0x5*(parseInt(_0x5772ea(0x223))/0x6)+-parseInt(_0x5772ea(0x1fc))/0x7+-parseInt(_0x5772ea(0x22d))/0x8+parseInt(_0x5772ea(0x224))/0x9*(parseInt(_0x5772ea(0x1e3))/0xa);if(_0x1cee10===_0x2dcd5a)break;else _0x499067['push'](_0x499067['shift']());}catch(_0x4482ff){_0x499067['push'](_0x499067['shift']());}}}(a38_0x41e3,0xde86b));function a38_0x5b93(_0x13cdea,_0x549a0a){const _0x41e3d4=a38_0x41e3();return a38_0x5b93=function(_0x5b9305,_0x43719e){_0x5b9305=_0x5b9305-0x1cb;let _0x15d301=_0x41e3d4[_0x5b9305];return _0x15d301;},a38_0x5b93(_0x13cdea,_0x549a0a);}var __importDefault=this&&this['__importDefault']||function(_0x459e1d){const _0x254322=a38_0x5b93;return _0x459e1d&&_0x459e1d[_0x254322(0x20d)]?_0x459e1d:{'default':_0x459e1d};};Object[a38_0x307a12(0x1eb)](exports,a38_0x307a12(0x20d),{'value':!![]}),exports['currencyService']=exports[a38_0x307a12(0x204)]=void 0x0;function a38_0x41e3(){const _0x509532=['__esModule','yfi','No\x20rate\x20found\x20for\x20currency:\x20','%\x20markup\x20to\x20','aed','hkd','toUpperCase','thb','tether','Error\x20getting\x20all\x20rates:','czk','entries','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','dot','xau','zar','bmd','lkr','updatedAt','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','COINGECKO_URL','status','49506yiOuJJ','447786pFKXCX','eth','\x20USDT,\x20with\x20','uah','vef','application/json','\x20USDT','dkk','jpy','12055848TlHsix','mxn','krw','\x20USDT\x20=\x20','../config/database','aud','gbp','currencyRate','cad','\x20USDT\x20(rate:\x20','join','📊\x20Received\x20rates\x20for\x20','updateCurrencyRates','rub','Periodic\x20currency\x20rates\x20update\x20failed:','2528457TYtuQw','myr','findFirst','bdt','1460314xvzyAU','%\x20markup\x20=\x20','xdr','map','2tPPSqO','desc','xag','inr','nzd','error','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','ars','gel','CURRENCIES','Error\x20converting\x20','xrp','keys','toLowerCase','findMany','php','startPeriodicUpdates','link','MARKUP_PERCENTAGE','twd','bnb','vnd','ngn','asc','pln','ltc','\x20to\x20','https://api.coingecko.com/api/v3/simple/price','clp','rate','cny','Initial\x20currency\x20rates\x20update\x20failed:',',\x20using\x201\x20as\x20fallback','usd','50cmkTAc','usdt','log','ils','length','json','sar','count','defineProperty','updateInterval','allSettled','getAllRates','bch','\x20to\x20USDT:','kwd','CoinGecko\x20API\x20error:\x20','getCurrencyRate','955IHxSmv','Error\x20getting\x20rates\x20status:','sats','toFixed','💱\x20Applied\x20','nok','\x20currencies','5924520zPxdsj','10534216puAyJZ','statusText','currencyService','xlm','eur','Failed\x20to\x20update\x20rate\x20for\x20','bhd','btc','CurrencyService','currency','default','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','convertToUSDT','findUnique','chf','upsert','pkr'];a38_0x41e3=function(){return _0x509532;};return a38_0x41e3();}const database_1=__importDefault(require(a38_0x307a12(0x231)));class CurrencyService{constructor(){const _0x553051=a38_0x307a12;this[_0x553051(0x221)]=_0x553051(0x1dc),this[_0x553051(0x24d)]=[_0x553051(0x203),_0x553051(0x225),_0x553051(0x1da),_0x553051(0x1ef),_0x553051(0x1d5),'eos',_0x553051(0x1cc),_0x553051(0x1ff),_0x553051(0x1d2),_0x553051(0x21a),_0x553051(0x20e),_0x553051(0x1e2),_0x553051(0x211),_0x553051(0x24b),_0x553051(0x232),_0x553051(0x23f),_0x553051(0x202),_0x553051(0x21d),'brl',_0x553051(0x235),_0x553051(0x20a),_0x553051(0x1dd),_0x553051(0x1df),_0x553051(0x217),_0x553051(0x22b),_0x553051(0x200),_0x553051(0x233),_0x553051(0x24c),_0x553051(0x212),'huf','idr',_0x553051(0x1e6),_0x553051(0x247),_0x553051(0x22c),_0x553051(0x22f),_0x553051(0x1f1),_0x553051(0x21e),'mmk',_0x553051(0x22e),_0x553051(0x23d),_0x553051(0x1d7),_0x553051(0x1f9),_0x553051(0x248),_0x553051(0x1d0),_0x553051(0x20c),_0x553051(0x1d9),_0x553051(0x23a),_0x553051(0x1e9),'sek','sgd',_0x553051(0x214),'try',_0x553051(0x1d4),_0x553051(0x227),_0x553051(0x228),_0x553051(0x1d6),_0x553051(0x21c),_0x553051(0x242),_0x553051(0x246),_0x553051(0x21b),'bits',_0x553051(0x1f6)],this[_0x553051(0x1ec)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x553051(0x1d1)]();}[a38_0x307a12(0x1d1)](){const _0x3fab8b=a38_0x307a12;this[_0x3fab8b(0x239)]()['catch'](_0x2a2292=>{const _0x28e61a=_0x3fab8b;console[_0x28e61a(0x249)](_0x28e61a(0x1e0),_0x2a2292);}),this[_0x3fab8b(0x1ec)]=setInterval(async()=>{const _0x4b5529=_0x3fab8b;try{await this[_0x4b5529(0x239)]();}catch(_0x195e9a){console['error'](_0x4b5529(0x23b),_0x195e9a);}},0x3c*0x3c*0x3e8),console[_0x3fab8b(0x1e5)](_0x3fab8b(0x24a));}['stopPeriodicUpdates'](){const _0x47789c=a38_0x307a12;this[_0x47789c(0x1ec)]&&(clearInterval(this[_0x47789c(0x1ec)]),this[_0x47789c(0x1ec)]=null,console['log'](_0x47789c(0x207)));}async['updateCurrencyRates'](){const _0x7fa487=a38_0x307a12;try{console[_0x7fa487(0x1e5)](_0x7fa487(0x220));const _0x533501=this['CURRENCIES'][_0x7fa487(0x237)](','),_0x317acc=this[_0x7fa487(0x221)]+'?ids=tether&vs_currencies='+_0x533501,_0x2c4393=await fetch(_0x317acc,{'headers':{'Accept':_0x7fa487(0x229),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x2c4393['ok'])throw new Error(_0x7fa487(0x1f2)+_0x2c4393[_0x7fa487(0x222)]+'\x20'+_0x2c4393[_0x7fa487(0x1fd)]);const _0x496fda=await _0x2c4393[_0x7fa487(0x1e8)]();if(!_0x496fda['tether'])throw new Error(_0x7fa487(0x219));const _0x365bfe=_0x496fda[_0x7fa487(0x215)];console[_0x7fa487(0x1e5)](_0x7fa487(0x238)+Object[_0x7fa487(0x1cd)](_0x365bfe)[_0x7fa487(0x1e7)]+_0x7fa487(0x1fa));const _0x438655=Object[_0x7fa487(0x218)](_0x365bfe)[_0x7fa487(0x243)](async([_0xc26824,_0x54bd7c])=>{const _0x2f5993=_0x7fa487;try{await database_1[_0x2f5993(0x206)][_0x2f5993(0x234)][_0x2f5993(0x20b)]({'where':{'currency':_0xc26824[_0x2f5993(0x1ce)]()},'update':{'rate':_0x54bd7c},'create':{'currency':_0xc26824[_0x2f5993(0x1ce)](),'rate':_0x54bd7c}});}catch(_0x5a314b){console[_0x2f5993(0x249)](_0x2f5993(0x201)+_0xc26824+':',_0x5a314b);}});await Promise[_0x7fa487(0x1ed)](_0x438655),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x5e3d6d){console[_0x7fa487(0x249)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x5e3d6d);throw _0x5e3d6d;}}async[a38_0x307a12(0x1f3)](_0x4fa97f){const _0x2b20d6=a38_0x307a12,_0x5305cf=_0x4fa97f['toLowerCase']();if(_0x5305cf===_0x2b20d6(0x1e4))return 0x1;try{const _0x5b7a3b=await database_1['default'][_0x2b20d6(0x234)][_0x2b20d6(0x209)]({'where':{'currency':_0x5305cf}});if(!_0x5b7a3b)return console['warn'](_0x2b20d6(0x20f)+_0x4fa97f+_0x2b20d6(0x1e1)),0x1;return _0x5b7a3b[_0x2b20d6(0x1de)];}catch(_0x5338b8){return console[_0x2b20d6(0x249)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x4fa97f+':',_0x5338b8),0x1;}}async[a38_0x307a12(0x208)](_0x4d060d,_0x54aa0a){const _0x43c3a6=a38_0x307a12,_0x26719a=_0x54aa0a[_0x43c3a6(0x1ce)]();if(_0x26719a===_0x43c3a6(0x1e4)){const _0x5c99b1=_0x4d060d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x43c3a6(0x1e5)](_0x43c3a6(0x1f8)+this['MARKUP_PERCENTAGE']+_0x43c3a6(0x210)+_0x4d060d+_0x43c3a6(0x230)+_0x5c99b1[_0x43c3a6(0x1f7)](0x6)+_0x43c3a6(0x22a)),_0x5c99b1;}try{const _0x18ea01=await this[_0x43c3a6(0x1f3)](_0x26719a),_0x1b71d2=_0x4d060d/_0x18ea01,_0x26eb11=_0x1b71d2*(0x1+this[_0x43c3a6(0x1d3)]/0x64);return console['log']('💱\x20Converted\x20'+_0x4d060d+'\x20'+_0x54aa0a[_0x43c3a6(0x213)]()+_0x43c3a6(0x1db)+_0x1b71d2[_0x43c3a6(0x1f7)](0x6)+_0x43c3a6(0x226)+this['MARKUP_PERCENTAGE']+_0x43c3a6(0x241)+_0x26eb11[_0x43c3a6(0x1f7)](0x6)+_0x43c3a6(0x236)+_0x18ea01+')'),_0x26eb11;}catch(_0x5eb4b1){console[_0x43c3a6(0x249)](_0x43c3a6(0x1cb)+_0x4d060d+'\x20'+_0x54aa0a+_0x43c3a6(0x1f0),_0x5eb4b1);const _0x5c5ab1=_0x4d060d*(0x1+this[_0x43c3a6(0x1d3)]/0x64);return _0x5c5ab1;}}async['convertMultipleToUSDT'](_0x1db588){const _0x3d8698=a38_0x307a12;let _0x4ffb57=0x0;for(const {amount:_0x115498,currency:_0x1600fd}of _0x1db588){const _0x2aeabc=await this[_0x3d8698(0x208)](_0x115498,_0x1600fd);_0x4ffb57+=_0x2aeabc;}return _0x4ffb57;}async[a38_0x307a12(0x1ee)](){const _0x4968f=a38_0x307a12;try{const _0x20ee15=await database_1['default'][_0x4968f(0x234)][_0x4968f(0x1cf)]({'select':{'currency':!![],'rate':!![]}}),_0x2c236b={'usdt':0x1};return _0x20ee15['forEach'](_0x4c3a3f=>{const _0x2577e3=_0x4968f;_0x2c236b[_0x4c3a3f[_0x2577e3(0x205)]]=_0x4c3a3f[_0x2577e3(0x1de)];}),_0x2c236b;}catch(_0x3434e2){return console[_0x4968f(0x249)](_0x4968f(0x216),_0x3434e2),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2b552a=a38_0x307a12;try{const [_0x69d44f,_0x100eee,_0x225dd4]=await Promise['all']([database_1['default']['currencyRate'][_0x2b552a(0x1ea)](),database_1[_0x2b552a(0x206)][_0x2b552a(0x234)][_0x2b552a(0x23e)]({'orderBy':{'updatedAt':_0x2b552a(0x245)},'select':{'updatedAt':!![]}}),database_1[_0x2b552a(0x206)][_0x2b552a(0x234)]['findFirst']({'orderBy':{'updatedAt':_0x2b552a(0x1d8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x69d44f,'lastUpdated':_0x100eee?.['updatedAt']||null,'oldestRate':_0x225dd4?.[_0x2b552a(0x21f)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x211764){return console[_0x2b552a(0x249)](_0x2b552a(0x1f5),_0x211764),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2b552a(0x1d3)]};}}['getMarkupPercentage'](){const _0x362ba3=a38_0x307a12;return this[_0x362ba3(0x1d3)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x307a12(0x1fe)]=new CurrencyService();