'use strict';const a39_0x43da43=a39_0x5b51;(function(_0x36c452,_0x451c07){const _0x1998e6=a39_0x5b51,_0x5b0901=_0x36c452();while(!![]){try{const _0x324905=-parseInt(_0x1998e6(0x154))/0x1+parseInt(_0x1998e6(0x173))/0x2*(-parseInt(_0x1998e6(0x157))/0x3)+parseInt(_0x1998e6(0x161))/0x4*(-parseInt(_0x1998e6(0x15c))/0x5)+-parseInt(_0x1998e6(0x181))/0x6*(parseInt(_0x1998e6(0x15d))/0x7)+-parseInt(_0x1998e6(0x153))/0x8*(parseInt(_0x1998e6(0x15b))/0x9)+parseInt(_0x1998e6(0x142))/0xa*(parseInt(_0x1998e6(0x14f))/0xb)+parseInt(_0x1998e6(0x12f))/0xc;if(_0x324905===_0x451c07)break;else _0x5b0901['push'](_0x5b0901['shift']());}catch(_0x55e49c){_0x5b0901['push'](_0x5b0901['shift']());}}}(a39_0x4693,0x78386));function a39_0x5b51(_0x3f46a5,_0x2414f5){const _0x46934d=a39_0x4693();return a39_0x5b51=function(_0x5b51b8,_0x5be9c2){_0x5b51b8=_0x5b51b8-0x10f;let _0x488be8=_0x46934d[_0x5b51b8];return _0x488be8;},a39_0x5b51(_0x3f46a5,_0x2414f5);}var __importDefault=this&&this[a39_0x43da43(0x16c)]||function(_0x2c2ae7){return _0x2c2ae7&&_0x2c2ae7['__esModule']?_0x2c2ae7:{'default':_0x2c2ae7};};Object[a39_0x43da43(0x122)](exports,a39_0x43da43(0x118),{'value':!![]}),exports[a39_0x43da43(0x16d)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x43da43(0x111)));function a39_0x4693(){const _0x46a629=['default','10644oWTnLR','map','Error\x20getting\x20rate\x20for\x20currency\x20','getCurrencyRate','brl','krw','ils','TesSoft\x20Payment\x20System/1.0','rub','../config/database','updateInterval','log','xlm','cny','COINGECKO_URL','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','__esModule','cad','eth','Error\x20converting\x20','pkr','myr','bnb','twd','gel','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','defineProperty','tether','clp',',\x20using\x201\x20as\x20fallback','💱\x20Applied\x20','✅\x20Currency\x20rates\x20updated\x20successfully','getRatesStatus','\x20USDT','getAllRates','statusText','sats','convertMultipleToUSDT','\x20currencies','27723360nGxOKa','error','findUnique','desc','Initial\x20currency\x20rates\x20update\x20failed:','sar','entries','mxn','getMarkupPercentage','findFirst','thb','%\x20markup\x20to\x20','jpy','idr','bits','uah','eos','aed','ltc','3110YfwuYT','try','link','rate','\x20to\x20','btc','bhd','huf','CurrencyService','updatedAt','allSettled','Periodic\x20currency\x20rates\x20update\x20failed:','usdt','21681RwhUFA','toFixed','php','lkr','1874472fpKuIy','662294KDmlxZ','\x20USDT\x20(rate:\x20','usd','798VNRFlH','eur','toLowerCase','ngn','18SGUQUv','55iDdbpc','938VXBXoV','Failed\x20to\x20update\x20rate\x20for\x20','https://api.coingecko.com/api/v3/simple/price','length','274732UjOMKV','catch','count','chf','updateCurrencyRates','upsert','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','CURRENCIES','bdt','%\x20markup\x20=\x20','sek','__importDefault','currencyService','currencyRate','gbp','xrp','❌\x20Failed\x20to\x20update\x20currency\x20rates:','toUpperCase','2306ryphRG','status','MARKUP_PERCENTAGE','sgd','nok','hkd','pln','yfi','CoinGecko\x20API\x20error:\x20','startPeriodicUpdates','forEach','bmd','convertToUSDT'];a39_0x4693=function(){return _0x46a629;};return a39_0x4693();}class CurrencyService{constructor(){const _0x1abe56=a39_0x43da43;this[_0x1abe56(0x116)]=_0x1abe56(0x15f),this['CURRENCIES']=[_0x1abe56(0x147),_0x1abe56(0x11a),_0x1abe56(0x141),'bch',_0x1abe56(0x11e),_0x1abe56(0x13f),_0x1abe56(0x170),_0x1abe56(0x114),_0x1abe56(0x144),'dot',_0x1abe56(0x17a),_0x1abe56(0x156),_0x1abe56(0x140),'ars','aud',_0x1abe56(0x169),_0x1abe56(0x148),_0x1abe56(0x17e),_0x1abe56(0x185),_0x1abe56(0x119),_0x1abe56(0x164),_0x1abe56(0x124),_0x1abe56(0x115),'czk','dkk',_0x1abe56(0x158),_0x1abe56(0x16f),_0x1abe56(0x120),_0x1abe56(0x178),_0x1abe56(0x149),_0x1abe56(0x13c),_0x1abe56(0x187),'inr',_0x1abe56(0x13b),_0x1abe56(0x186),'kwd',_0x1abe56(0x152),'mmk',_0x1abe56(0x136),_0x1abe56(0x11d),_0x1abe56(0x15a),_0x1abe56(0x177),'nzd',_0x1abe56(0x151),_0x1abe56(0x11c),_0x1abe56(0x179),_0x1abe56(0x110),_0x1abe56(0x134),_0x1abe56(0x16b),_0x1abe56(0x176),_0x1abe56(0x139),_0x1abe56(0x143),_0x1abe56(0x11f),_0x1abe56(0x13e),'vef','vnd','zar','xdr','xag','xau',_0x1abe56(0x13d),_0x1abe56(0x12c)],this['updateInterval']=null,this[_0x1abe56(0x175)]=-0x3,this[_0x1abe56(0x17c)]();}['startPeriodicUpdates'](){const _0x33c523=a39_0x43da43;this[_0x33c523(0x165)]()[_0x33c523(0x162)](_0x40ae25=>{const _0x15dc2b=_0x33c523;console[_0x15dc2b(0x130)](_0x15dc2b(0x133),_0x40ae25);}),this[_0x33c523(0x112)]=setInterval(async()=>{const _0x25d279=_0x33c523;try{await this['updateCurrencyRates']();}catch(_0x2ff4e1){console[_0x25d279(0x130)](_0x25d279(0x14d),_0x2ff4e1);}},0x3c*0x3c*0x3e8),console[_0x33c523(0x113)](_0x33c523(0x117));}['stopPeriodicUpdates'](){const _0x25fb74=a39_0x43da43;this['updateInterval']&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x25fb74(0x113)](_0x25fb74(0x121)));}async[a39_0x43da43(0x165)](){const _0x54bddc=a39_0x43da43;try{console[_0x54bddc(0x113)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x219e09=this[_0x54bddc(0x168)]['join'](','),_0x5a764f=this[_0x54bddc(0x116)]+'?ids=tether&vs_currencies='+_0x219e09,_0x1732a6=await fetch(_0x5a764f,{'headers':{'Accept':'application/json','User-Agent':_0x54bddc(0x10f)}});if(!_0x1732a6['ok'])throw new Error(_0x54bddc(0x17b)+_0x1732a6[_0x54bddc(0x174)]+'\x20'+_0x1732a6[_0x54bddc(0x12b)]);const _0xc4708e=await _0x1732a6['json']();if(!_0xc4708e[_0x54bddc(0x123)])throw new Error(_0x54bddc(0x167));const _0x1403b2=_0xc4708e[_0x54bddc(0x123)];console[_0x54bddc(0x113)]('📊\x20Received\x20rates\x20for\x20'+Object['keys'](_0x1403b2)[_0x54bddc(0x160)]+_0x54bddc(0x12e));const _0x1f002b=Object[_0x54bddc(0x135)](_0x1403b2)[_0x54bddc(0x182)](async([_0x521244,_0x513876])=>{const _0x345dd9=_0x54bddc;try{await database_1[_0x345dd9(0x180)][_0x345dd9(0x16e)][_0x345dd9(0x166)]({'where':{'currency':_0x521244[_0x345dd9(0x159)]()},'update':{'rate':_0x513876},'create':{'currency':_0x521244['toLowerCase'](),'rate':_0x513876}});}catch(_0x56d339){console['error'](_0x345dd9(0x15e)+_0x521244+':',_0x56d339);}});await Promise[_0x54bddc(0x14c)](_0x1f002b),console[_0x54bddc(0x113)](_0x54bddc(0x127));}catch(_0x4f0fcf){console[_0x54bddc(0x130)](_0x54bddc(0x171),_0x4f0fcf);throw _0x4f0fcf;}}async[a39_0x43da43(0x184)](_0x2983c5){const _0x16d54d=a39_0x43da43,_0x27cce1=_0x2983c5[_0x16d54d(0x159)]();if(_0x27cce1===_0x16d54d(0x14e))return 0x1;try{const _0x41a69e=await database_1[_0x16d54d(0x180)]['currencyRate'][_0x16d54d(0x131)]({'where':{'currency':_0x27cce1}});if(!_0x41a69e)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2983c5+_0x16d54d(0x125)),0x1;return _0x41a69e[_0x16d54d(0x145)];}catch(_0x408999){return console['error'](_0x16d54d(0x183)+_0x2983c5+':',_0x408999),0x1;}}async[a39_0x43da43(0x17f)](_0x8fbd96,_0x593eeb){const _0x3d6adf=a39_0x43da43,_0x12f3c5=_0x593eeb[_0x3d6adf(0x159)]();if(_0x12f3c5==='usdt'){const _0x1cfdbe=_0x8fbd96*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3d6adf(0x113)](_0x3d6adf(0x126)+this[_0x3d6adf(0x175)]+_0x3d6adf(0x13a)+_0x8fbd96+'\x20USDT\x20=\x20'+_0x1cfdbe[_0x3d6adf(0x150)](0x6)+_0x3d6adf(0x129)),_0x1cfdbe;}try{const _0x11be8f=await this['getCurrencyRate'](_0x12f3c5),_0x1bc9ee=_0x8fbd96/_0x11be8f,_0x1dfa84=_0x1bc9ee*(0x1+this[_0x3d6adf(0x175)]/0x64);return console[_0x3d6adf(0x113)]('💱\x20Converted\x20'+_0x8fbd96+'\x20'+_0x593eeb[_0x3d6adf(0x172)]()+_0x3d6adf(0x146)+_0x1bc9ee[_0x3d6adf(0x150)](0x6)+'\x20USDT,\x20with\x20'+this[_0x3d6adf(0x175)]+_0x3d6adf(0x16a)+_0x1dfa84['toFixed'](0x6)+_0x3d6adf(0x155)+_0x11be8f+')'),_0x1dfa84;}catch(_0x178aae){console[_0x3d6adf(0x130)](_0x3d6adf(0x11b)+_0x8fbd96+'\x20'+_0x593eeb+'\x20to\x20USDT:',_0x178aae);const _0x567b5e=_0x8fbd96*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x567b5e;}}async[a39_0x43da43(0x12d)](_0x69d468){const _0x5eaaa0=a39_0x43da43;let _0x195eca=0x0;for(const {amount:_0x51836f,currency:_0x333820}of _0x69d468){const _0x538a6e=await this[_0x5eaaa0(0x17f)](_0x51836f,_0x333820);_0x195eca+=_0x538a6e;}return _0x195eca;}async[a39_0x43da43(0x12a)](){const _0x121ce1=a39_0x43da43;try{const _0x1e103c=await database_1[_0x121ce1(0x180)][_0x121ce1(0x16e)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1c5478={'usdt':0x1};return _0x1e103c[_0x121ce1(0x17d)](_0x351acb=>{_0x1c5478[_0x351acb['currency']]=_0x351acb['rate'];}),_0x1c5478;}catch(_0x42026f){return console['error']('Error\x20getting\x20all\x20rates:',_0x42026f),{'usdt':0x1};}}async[a39_0x43da43(0x128)](){const _0x418415=a39_0x43da43;try{const [_0x136bd2,_0x4ecccb,_0x5409c2]=await Promise['all']([database_1[_0x418415(0x180)]['currencyRate'][_0x418415(0x163)](),database_1[_0x418415(0x180)]['currencyRate'][_0x418415(0x138)]({'orderBy':{'updatedAt':_0x418415(0x132)},'select':{'updatedAt':!![]}}),database_1[_0x418415(0x180)]['currencyRate'][_0x418415(0x138)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x136bd2,'lastUpdated':_0x4ecccb?.[_0x418415(0x14b)]||null,'oldestRate':_0x5409c2?.[_0x418415(0x14b)]||null,'markupPercentage':this[_0x418415(0x175)]};}catch(_0x1bcbc2){return console[_0x418415(0x130)]('Error\x20getting\x20rates\x20status:',_0x1bcbc2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x43da43(0x137)](){const _0x37ebe3=a39_0x43da43;return this[_0x37ebe3(0x175)];}}exports[a39_0x43da43(0x14a)]=CurrencyService,exports[a39_0x43da43(0x16d)]=new CurrencyService();