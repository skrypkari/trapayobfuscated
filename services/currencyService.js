'use strict';const a51_0x20b16b=a51_0x1b54;(function(_0x3097b6,_0x413a2f){const _0x3a5ad3=a51_0x1b54,_0x5844a7=_0x3097b6();while(!![]){try{const _0x17278f=-parseInt(_0x3a5ad3(0x1db))/0x1*(parseInt(_0x3a5ad3(0x1df))/0x2)+-parseInt(_0x3a5ad3(0x208))/0x3*(parseInt(_0x3a5ad3(0x241))/0x4)+parseInt(_0x3a5ad3(0x1f3))/0x5+-parseInt(_0x3a5ad3(0x1de))/0x6+-parseInt(_0x3a5ad3(0x1cf))/0x7+parseInt(_0x3a5ad3(0x1ef))/0x8*(-parseInt(_0x3a5ad3(0x1dd))/0x9)+-parseInt(_0x3a5ad3(0x21d))/0xa*(-parseInt(_0x3a5ad3(0x1eb))/0xb);if(_0x17278f===_0x413a2f)break;else _0x5844a7['push'](_0x5844a7['shift']());}catch(_0x3e1e72){_0x5844a7['push'](_0x5844a7['shift']());}}}(a51_0x5523,0x655c2));var __importDefault=this&&this[a51_0x20b16b(0x201)]||function(_0x59b496){const _0x14e9a9=a51_0x20b16b;return _0x59b496&&_0x59b496[_0x14e9a9(0x22b)]?_0x59b496:{'default':_0x59b496};};Object[a51_0x20b16b(0x226)](exports,a51_0x20b16b(0x22b),{'value':!![]}),exports[a51_0x20b16b(0x1d5)]=exports[a51_0x20b16b(0x205)]=void 0x0;const database_1=__importDefault(require(a51_0x20b16b(0x243)));class CurrencyService{constructor(){const _0x2eb406=a51_0x20b16b;this[_0x2eb406(0x22f)]='https://api.coingecko.com/api/v3/simple/price',this[_0x2eb406(0x1ec)]=[_0x2eb406(0x229),_0x2eb406(0x1f1),_0x2eb406(0x21a),_0x2eb406(0x1d7),'bnb',_0x2eb406(0x1fb),_0x2eb406(0x206),_0x2eb406(0x24c),_0x2eb406(0x215),_0x2eb406(0x203),_0x2eb406(0x20c),_0x2eb406(0x20b),_0x2eb406(0x221),_0x2eb406(0x1e5),_0x2eb406(0x210),_0x2eb406(0x214),'bhd','bmd',_0x2eb406(0x1d1),_0x2eb406(0x220),_0x2eb406(0x1ce),'clp',_0x2eb406(0x1e7),'czk',_0x2eb406(0x21c),_0x2eb406(0x23e),'gbp',_0x2eb406(0x1e0),'hkd','huf',_0x2eb406(0x22a),_0x2eb406(0x207),'inr',_0x2eb406(0x1e8),_0x2eb406(0x1d9),'kwd','lkr','mmk','mxn',_0x2eb406(0x1ed),'ngn','nok',_0x2eb406(0x20a),_0x2eb406(0x1e3),_0x2eb406(0x22d),_0x2eb406(0x23d),_0x2eb406(0x204),_0x2eb406(0x1d6),_0x2eb406(0x1d2),_0x2eb406(0x249),_0x2eb406(0x1ea),_0x2eb406(0x234),_0x2eb406(0x216),_0x2eb406(0x1ff),'vef',_0x2eb406(0x1d8),_0x2eb406(0x1fd),_0x2eb406(0x22e),_0x2eb406(0x240),_0x2eb406(0x238),_0x2eb406(0x24a),_0x2eb406(0x230)],this[_0x2eb406(0x211)]=null,this[_0x2eb406(0x237)]=-0x3,this[_0x2eb406(0x20e)]();}[a51_0x20b16b(0x20e)](){const _0x192742=a51_0x20b16b;this[_0x192742(0x1fc)]()[_0x192742(0x244)](_0x57b0b3=>{const _0x2fc3f3=_0x192742;console[_0x2fc3f3(0x1dc)](_0x2fc3f3(0x1e6),_0x57b0b3);}),this[_0x192742(0x211)]=setInterval(async()=>{const _0x4db469=_0x192742;try{await this[_0x4db469(0x1fc)]();}catch(_0x297d7d){console[_0x4db469(0x1dc)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x297d7d);}},0x3c*0x3c*0x3e8),console['log'](_0x192742(0x1d0));}['stopPeriodicUpdates'](){const _0x2a1827=a51_0x20b16b;this[_0x2a1827(0x211)]&&(clearInterval(this['updateInterval']),this[_0x2a1827(0x211)]=null,console[_0x2a1827(0x1f4)](_0x2a1827(0x222)));}async[a51_0x20b16b(0x1fc)](){const _0x572c99=a51_0x20b16b;try{console[_0x572c99(0x1f4)](_0x572c99(0x1d3));const _0x12160d=this[_0x572c99(0x1ec)][_0x572c99(0x1f5)](','),_0x525397=this[_0x572c99(0x22f)]+'?ids=tether&vs_currencies='+_0x12160d,_0x5e982d=await fetch(_0x525397,{'headers':{'Accept':_0x572c99(0x1e4),'User-Agent':_0x572c99(0x1f7)}});if(!_0x5e982d['ok'])throw new Error(_0x572c99(0x1ee)+_0x5e982d[_0x572c99(0x248)]+'\x20'+_0x5e982d[_0x572c99(0x21b)]);const _0x4ba07d=await _0x5e982d[_0x572c99(0x242)]();if(!_0x4ba07d[_0x572c99(0x218)])throw new Error(_0x572c99(0x227));const _0x3d3351=_0x4ba07d[_0x572c99(0x218)];console['log']('üìä\x20Received\x20rates\x20for\x20'+Object[_0x572c99(0x212)](_0x3d3351)['length']+_0x572c99(0x236));const _0x540b32=Object[_0x572c99(0x1f2)](_0x3d3351)[_0x572c99(0x245)](async([_0x36caa7,_0x3edf29])=>{const _0xd23fab=_0x572c99;try{await database_1[_0xd23fab(0x24b)]['currencyRate']['upsert']({'where':{'currency':_0x36caa7[_0xd23fab(0x217)]()},'update':{'rate':_0x3edf29},'create':{'currency':_0x36caa7[_0xd23fab(0x217)](),'rate':_0x3edf29}});}catch(_0x48294e){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x36caa7+':',_0x48294e);}});await Promise[_0x572c99(0x233)](_0x540b32),console[_0x572c99(0x1f4)](_0x572c99(0x1f8));}catch(_0x37b557){console[_0x572c99(0x1dc)](_0x572c99(0x20d),_0x37b557);throw _0x37b557;}}async[a51_0x20b16b(0x213)](_0x21d7e3){const _0x2f05cb=a51_0x20b16b,_0x556150=_0x21d7e3[_0x2f05cb(0x217)]();if(_0x556150===_0x2f05cb(0x200))return 0x1;try{const _0x2f8377=await database_1[_0x2f05cb(0x24b)][_0x2f05cb(0x21e)][_0x2f05cb(0x22c)]({'where':{'currency':_0x556150}});if(!_0x2f8377)return console[_0x2f05cb(0x21f)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x21d7e3+_0x2f05cb(0x1da)),0x1;return _0x2f8377[_0x2f05cb(0x23b)];}catch(_0x4e18b6){return console[_0x2f05cb(0x1dc)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x21d7e3+':',_0x4e18b6),0x1;}}async[a51_0x20b16b(0x235)](_0x2137eb,_0x197d2a){const _0x81633d=a51_0x20b16b,_0x15c22b=_0x197d2a[_0x81633d(0x217)]();if(_0x15c22b==='usdt'){const _0x3cce67=_0x2137eb*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x81633d(0x1f4)](_0x81633d(0x1fa)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x2137eb+_0x81633d(0x1e9)+_0x3cce67['toFixed'](0x6)+_0x81633d(0x1fe)),_0x3cce67;}try{const _0x4a4733=await this[_0x81633d(0x213)](_0x15c22b),_0x186ec1=_0x2137eb/_0x4a4733,_0x3db04c=_0x186ec1*(0x1+this[_0x81633d(0x237)]/0x64);return console[_0x81633d(0x1f4)]('üí±\x20Converted\x20'+_0x2137eb+'\x20'+_0x197d2a[_0x81633d(0x239)]()+_0x81633d(0x225)+_0x186ec1[_0x81633d(0x23f)](0x6)+_0x81633d(0x219)+this[_0x81633d(0x237)]+_0x81633d(0x1e2)+_0x3db04c[_0x81633d(0x23f)](0x6)+_0x81633d(0x232)+_0x4a4733+')'),_0x3db04c;}catch(_0x24f080){console[_0x81633d(0x1dc)](_0x81633d(0x209)+_0x2137eb+'\x20'+_0x197d2a+_0x81633d(0x1d4),_0x24f080);const _0xbf98a7=_0x2137eb*(0x1+this[_0x81633d(0x237)]/0x64);return _0xbf98a7;}}async[a51_0x20b16b(0x1f0)](_0x2b07ca){const _0x20c619=a51_0x20b16b;let _0x182b14=0x0;for(const {amount:_0x2f062d,currency:_0x22c45a}of _0x2b07ca){const _0x51c9e3=await this[_0x20c619(0x235)](_0x2f062d,_0x22c45a);_0x182b14+=_0x51c9e3;}return _0x182b14;}async[a51_0x20b16b(0x224)](){const _0x21b276=a51_0x20b16b;try{const _0x1367e7=await database_1[_0x21b276(0x24b)]['currencyRate'][_0x21b276(0x1e1)]({'select':{'currency':!![],'rate':!![]}}),_0x20918c={'usdt':0x1};return _0x1367e7[_0x21b276(0x23c)](_0x28f9c7=>{const _0x9f41ad=_0x21b276;_0x20918c[_0x28f9c7[_0x9f41ad(0x228)]]=_0x28f9c7[_0x9f41ad(0x23b)];}),_0x20918c;}catch(_0x3ee69b){return console[_0x21b276(0x1dc)](_0x21b276(0x231),_0x3ee69b),{'usdt':0x1};}}async[a51_0x20b16b(0x202)](){const _0x5c5254=a51_0x20b16b;try{const [_0x5c9549,_0x275f5a,_0x240a6e]=await Promise[_0x5c5254(0x223)]([database_1['default'][_0x5c5254(0x21e)][_0x5c5254(0x246)](),database_1[_0x5c5254(0x24b)][_0x5c5254(0x21e)]['findFirst']({'orderBy':{'updatedAt':_0x5c5254(0x1f6)},'select':{'updatedAt':!![]}}),database_1[_0x5c5254(0x24b)][_0x5c5254(0x21e)][_0x5c5254(0x1f9)]({'orderBy':{'updatedAt':_0x5c5254(0x20f)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5c9549,'lastUpdated':_0x275f5a?.['updatedAt']||null,'oldestRate':_0x240a6e?.[_0x5c5254(0x23a)]||null,'markupPercentage':this[_0x5c5254(0x237)]};}catch(_0x5c0db3){return console[_0x5c5254(0x1dc)]('Error\x20getting\x20rates\x20status:',_0x5c0db3),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a51_0x20b16b(0x247)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a51_0x20b16b(0x1d5)]=new CurrencyService();function a51_0x1b54(_0x23ed76,_0x4e54db){_0x23ed76=_0x23ed76-0x1ce;const _0x552388=a51_0x5523();let _0x1b54af=_0x552388[_0x23ed76];return _0x1b54af;}function a51_0x5523(){const _0x392331=['json','../config/database','catch','map','count','getMarkupPercentage','status','sgd','bits','default','xlm','chf','3513363ysMvsH','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','brl','sek','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','\x20to\x20USDT:','currencyService','sar','bch','vnd','krw',',\x20using\x201\x20as\x20fallback','11515LemTLM','error','9Bxntsc','91764bvmeoK','108MLBZnY','gel','findMany','%\x20markup\x20=\x20','php','application/json','ars','Initial\x20currency\x20rates\x20update\x20failed:','cny','jpy','\x20USDT\x20=\x20','thb','5599ITICzr','CURRENCIES','myr','CoinGecko\x20API\x20error:\x20','2399032jLTQpC','convertMultipleToUSDT','eth','entries','3222805itTUUS','log','join','desc','Payment\x20System/1.0','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','findFirst','üí±\x20Applied\x20','eos','updateCurrencyRates','zar','\x20USDT','uah','usdt','__importDefault','getRatesStatus','dot','rub','CurrencyService','xrp','ils','3rfKSqB','Error\x20converting\x20','nzd','usd','yfi','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','startPeriodicUpdates','asc','aud','updateInterval','keys','getCurrencyRate','bdt','link','twd','toLowerCase','tether','\x20USDT,\x20with\x20','ltc','statusText','dkk','28070JPXyQx','currencyRate','warn','cad','aed','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','all','getAllRates','\x20to\x20','defineProperty','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','currency','btc','idr','__esModule','findUnique','pkr','xdr','COINGECKO_URL','sats','Error\x20getting\x20all\x20rates:','\x20USDT\x20(rate:\x20','allSettled','try','convertToUSDT','\x20currencies','MARKUP_PERCENTAGE','xau','toUpperCase','updatedAt','rate','forEach','pln','eur','toFixed','xag','877048fGLVTD'];a51_0x5523=function(){return _0x392331;};return a51_0x5523();}