'use strict';const a38_0x1b3831=a38_0x1969;function a38_0x1969(_0x542fe7,_0x5a9fb8){const _0x7cf0bc=a38_0x7cf0();return a38_0x1969=function(_0x196912,_0x28dedc){_0x196912=_0x196912-0xa6;let _0x5d9995=_0x7cf0bc[_0x196912];return _0x5d9995;},a38_0x1969(_0x542fe7,_0x5a9fb8);}(function(_0x116988,_0xeaf700){const _0x4f08e0=a38_0x1969,_0x4a6729=_0x116988();while(!![]){try{const _0x29242c=-parseInt(_0x4f08e0(0x120))/0x1+-parseInt(_0x4f08e0(0xb7))/0x2*(parseInt(_0x4f08e0(0xdf))/0x3)+-parseInt(_0x4f08e0(0xc6))/0x4+-parseInt(_0x4f08e0(0xe5))/0x5+parseInt(_0x4f08e0(0xd2))/0x6*(-parseInt(_0x4f08e0(0xb4))/0x7)+-parseInt(_0x4f08e0(0x11d))/0x8+-parseInt(_0x4f08e0(0x119))/0x9*(-parseInt(_0x4f08e0(0x10a))/0xa);if(_0x29242c===_0xeaf700)break;else _0x4a6729['push'](_0x4a6729['shift']());}catch(_0x301d4c){_0x4a6729['push'](_0x4a6729['shift']());}}}(a38_0x7cf0,0x3774f));function a38_0x7cf0(){const _0x5dadc3=['convertMultipleToUSDT','cny','getCurrencyRate','xlm','bch','length','24bMemMl','stopPeriodicUpdates','bits','\x20USDT','status','eos','1564510uNabxI','vnd','statusText','findUnique','✅\x20Currency\x20rates\x20updated\x20successfully','\x20to\x20','count','json','rub','ltc','error','nok','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','myr','warn','eur','CoinGecko\x20API\x20error:\x20','twd','Error\x20getting\x20all\x20rates:','brl','czk','tether','gel','Error\x20getting\x20rate\x20for\x20currency\x20','\x20currencies','xdr','asc','updatedAt','usdt','__esModule','thb','allSettled','join','CURRENCIES','ngn','catch','1810PLgwnI','COINGECKO_URL','getRatesStatus','updateInterval','toLowerCase','krw','upsert','zar','toFixed','link','findFirst','vef','try','bnb','gbp','102249jTuyMU','getAllRates','sats','Periodic\x20currency\x20rates\x20update\x20failed:','2598792LzjyHV','\x20USDT\x20=\x20','mmk','354429JYcGyr','toUpperCase','chf','bmd','mxn','❌\x20Failed\x20to\x20update\x20currency\x20rates:','MARKUP_PERCENTAGE','CurrencyService','xag','currencyService','findMany','currencyRate','%\x20markup\x20=\x20','https://api.coingecko.com/api/v3/simple/price','../config/database','\x20to\x20USDT:','clp','\x20USDT,\x20with\x20','inr','21vXEXnO','entries','lkr','22690FdFRXw','log','application/json','php','Error\x20converting\x20','currency','No\x20rate\x20found\x20for\x20currency:\x20','forEach','convertToUSDT','pkr','desc','rate','yfi','Failed\x20to\x20update\x20rate\x20for\x20','aud','1616004jORyZb','updateCurrencyRates','bhd','💱\x20Converted\x20','📊\x20Received\x20rates\x20for\x20','cad','ars','nzd','eth','startPeriodicUpdates','%\x20markup\x20to\x20','xrp','684498snMRjz','defineProperty','Initial\x20currency\x20rates\x20update\x20failed:','default','getMarkupPercentage','btc','aed'];a38_0x7cf0=function(){return _0x5dadc3;};return a38_0x7cf0();}var __importDefault=this&&this['__importDefault']||function(_0x62a011){const _0x582be4=a38_0x1969;return _0x62a011&&_0x62a011[_0x582be4(0x103)]?_0x62a011:{'default':_0x62a011};};Object[a38_0x1b3831(0xd3)](exports,a38_0x1b3831(0x103),{'value':!![]}),exports[a38_0x1b3831(0xaa)]=exports[a38_0x1b3831(0xa8)]=void 0x0;const database_1=__importDefault(require(a38_0x1b3831(0xaf)));class CurrencyService{constructor(){const _0x5ab8ae=a38_0x1b3831;this[_0x5ab8ae(0x10b)]=_0x5ab8ae(0xae),this[_0x5ab8ae(0x107)]=[_0x5ab8ae(0xd7),_0x5ab8ae(0xce),_0x5ab8ae(0xee),_0x5ab8ae(0xdd),_0x5ab8ae(0x117),_0x5ab8ae(0xe4),_0x5ab8ae(0xd1),_0x5ab8ae(0xdc),_0x5ab8ae(0x113),'dot',_0x5ab8ae(0xc3),'usd',_0x5ab8ae(0xd8),_0x5ab8ae(0xcc),_0x5ab8ae(0xc5),'bdt',_0x5ab8ae(0xc8),_0x5ab8ae(0x123),_0x5ab8ae(0xf9),_0x5ab8ae(0xcb),_0x5ab8ae(0x122),_0x5ab8ae(0xb1),_0x5ab8ae(0xda),_0x5ab8ae(0xfa),'dkk',_0x5ab8ae(0xf5),_0x5ab8ae(0x118),_0x5ab8ae(0xfc),'hkd','huf','idr','ils',_0x5ab8ae(0xb3),'jpy',_0x5ab8ae(0x10f),'kwd',_0x5ab8ae(0xb6),_0x5ab8ae(0x11f),_0x5ab8ae(0x124),_0x5ab8ae(0xf3),_0x5ab8ae(0x108),_0x5ab8ae(0xf0),_0x5ab8ae(0xcd),_0x5ab8ae(0xba),_0x5ab8ae(0xc0),'pln',_0x5ab8ae(0xed),'sar','sek','sgd',_0x5ab8ae(0x104),_0x5ab8ae(0x116),_0x5ab8ae(0xf7),'uah',_0x5ab8ae(0x115),_0x5ab8ae(0xe6),_0x5ab8ae(0x111),_0x5ab8ae(0xff),_0x5ab8ae(0xa9),'xau',_0x5ab8ae(0xe1),_0x5ab8ae(0x11b)],this[_0x5ab8ae(0x10d)]=null,this[_0x5ab8ae(0xa7)]=0x3,this[_0x5ab8ae(0xcf)]();}[a38_0x1b3831(0xcf)](){const _0xa9db96=a38_0x1b3831;this[_0xa9db96(0xc7)]()[_0xa9db96(0x109)](_0x59abba=>{const _0x35f4e0=_0xa9db96;console[_0x35f4e0(0xef)](_0x35f4e0(0xd4),_0x59abba);}),this[_0xa9db96(0x10d)]=setInterval(async()=>{const _0x283789=_0xa9db96;try{await this[_0x283789(0xc7)]();}catch(_0x19635f){console[_0x283789(0xef)](_0x283789(0x11c),_0x19635f);}},0x3c*0x3c*0x3e8),console[_0xa9db96(0xb8)](_0xa9db96(0xf1));}[a38_0x1b3831(0xe0)](){const _0x1d8a27=a38_0x1b3831;this['updateInterval']&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x1d8a27(0xb8)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x1b3831(0xc7)](){const _0x3daff6=a38_0x1b3831;try{console['log'](_0x3daff6(0xf2));const _0x4f76f3=this[_0x3daff6(0x107)][_0x3daff6(0x106)](','),_0x55e110=this[_0x3daff6(0x10b)]+'?ids=tether&vs_currencies='+_0x4f76f3,_0x301ae1=await fetch(_0x55e110,{'headers':{'Accept':_0x3daff6(0xb9),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x301ae1['ok'])throw new Error(_0x3daff6(0xf6)+_0x301ae1[_0x3daff6(0xe3)]+'\x20'+_0x301ae1[_0x3daff6(0xe7)]);const _0x5f5cda=await _0x301ae1[_0x3daff6(0xec)]();if(!_0x5f5cda[_0x3daff6(0xfb)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x2b5282=_0x5f5cda[_0x3daff6(0xfb)];console[_0x3daff6(0xb8)](_0x3daff6(0xca)+Object['keys'](_0x2b5282)[_0x3daff6(0xde)]+_0x3daff6(0xfe));const _0x2065d1=Object[_0x3daff6(0xb5)](_0x2b5282)['map'](async([_0x1fb07c,_0x521f7d])=>{const _0x43d832=_0x3daff6;try{await database_1['default'][_0x43d832(0xac)][_0x43d832(0x110)]({'where':{'currency':_0x1fb07c[_0x43d832(0x10e)]()},'update':{'rate':_0x521f7d},'create':{'currency':_0x1fb07c[_0x43d832(0x10e)](),'rate':_0x521f7d}});}catch(_0x5841ba){console[_0x43d832(0xef)](_0x43d832(0xc4)+_0x1fb07c+':',_0x5841ba);}});await Promise[_0x3daff6(0x105)](_0x2065d1),console[_0x3daff6(0xb8)](_0x3daff6(0xe9));}catch(_0x3694a3){console[_0x3daff6(0xef)](_0x3daff6(0xa6),_0x3694a3);throw _0x3694a3;}}async['getCurrencyRate'](_0x300a31){const _0x49b9ff=a38_0x1b3831,_0x5782b2=_0x300a31['toLowerCase']();if(_0x5782b2===_0x49b9ff(0x102))return 0x1;try{const _0x1f3041=await database_1[_0x49b9ff(0xd5)][_0x49b9ff(0xac)][_0x49b9ff(0xe8)]({'where':{'currency':_0x5782b2}});if(!_0x1f3041)return console[_0x49b9ff(0xf4)](_0x49b9ff(0xbd)+_0x300a31+',\x20using\x201\x20as\x20fallback'),0x1;return _0x1f3041[_0x49b9ff(0xc2)];}catch(_0x23c067){return console['error'](_0x49b9ff(0xfd)+_0x300a31+':',_0x23c067),0x1;}}async[a38_0x1b3831(0xbf)](_0x377aca,_0x3576d1){const _0x3f3d15=a38_0x1b3831,_0x3856dd=_0x3576d1[_0x3f3d15(0x10e)]();if(_0x3856dd==='usdt'){const _0x44047e=_0x377aca*(0x1+this[_0x3f3d15(0xa7)]/0x64);return console[_0x3f3d15(0xb8)]('💱\x20Applied\x20'+this[_0x3f3d15(0xa7)]+_0x3f3d15(0xd0)+_0x377aca+_0x3f3d15(0x11e)+_0x44047e[_0x3f3d15(0x112)](0x6)+_0x3f3d15(0xe2)),_0x44047e;}try{const _0x3426d3=await this[_0x3f3d15(0xdb)](_0x3856dd),_0xf4d539=_0x377aca/_0x3426d3,_0x410216=_0xf4d539*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3f3d15(0xb8)](_0x3f3d15(0xc9)+_0x377aca+'\x20'+_0x3576d1[_0x3f3d15(0x121)]()+_0x3f3d15(0xea)+_0xf4d539['toFixed'](0x6)+_0x3f3d15(0xb2)+this[_0x3f3d15(0xa7)]+_0x3f3d15(0xad)+_0x410216[_0x3f3d15(0x112)](0x6)+'\x20USDT\x20(rate:\x20'+_0x3426d3+')'),_0x410216;}catch(_0x279fb6){console[_0x3f3d15(0xef)](_0x3f3d15(0xbb)+_0x377aca+'\x20'+_0x3576d1+_0x3f3d15(0xb0),_0x279fb6);const _0x599bec=_0x377aca*(0x1+this[_0x3f3d15(0xa7)]/0x64);return _0x599bec;}}async[a38_0x1b3831(0xd9)](_0x5e7886){const _0x27c0e5=a38_0x1b3831;let _0x2b8b48=0x0;for(const {amount:_0x3d8b3f,currency:_0x4dd929}of _0x5e7886){const _0x1265cb=await this[_0x27c0e5(0xbf)](_0x3d8b3f,_0x4dd929);_0x2b8b48+=_0x1265cb;}return _0x2b8b48;}async[a38_0x1b3831(0x11a)](){const _0x1a24eb=a38_0x1b3831;try{const _0x10785e=await database_1[_0x1a24eb(0xd5)][_0x1a24eb(0xac)][_0x1a24eb(0xab)]({'select':{'currency':!![],'rate':!![]}}),_0xb72226={'usdt':0x1};return _0x10785e[_0x1a24eb(0xbe)](_0x174ffa=>{const _0x19287c=_0x1a24eb;_0xb72226[_0x174ffa[_0x19287c(0xbc)]]=_0x174ffa['rate'];}),_0xb72226;}catch(_0x343178){return console[_0x1a24eb(0xef)](_0x1a24eb(0xf8),_0x343178),{'usdt':0x1};}}async[a38_0x1b3831(0x10c)](){const _0x28bb8e=a38_0x1b3831;try{const [_0x22e9ae,_0x34e68f,_0x5a5005]=await Promise['all']([database_1['default'][_0x28bb8e(0xac)][_0x28bb8e(0xeb)](),database_1[_0x28bb8e(0xd5)]['currencyRate'][_0x28bb8e(0x114)]({'orderBy':{'updatedAt':_0x28bb8e(0xc1)},'select':{'updatedAt':!![]}}),database_1[_0x28bb8e(0xd5)][_0x28bb8e(0xac)]['findFirst']({'orderBy':{'updatedAt':_0x28bb8e(0x100)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x22e9ae,'lastUpdated':_0x34e68f?.[_0x28bb8e(0x101)]||null,'oldestRate':_0x5a5005?.[_0x28bb8e(0x101)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0xad9cfc){return console[_0x28bb8e(0xef)]('Error\x20getting\x20rates\x20status:',_0xad9cfc),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x28bb8e(0xa7)]};}}[a38_0x1b3831(0xd6)](){const _0x28bbcb=a38_0x1b3831;return this[_0x28bbcb(0xa7)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x1b3831(0xaa)]=new CurrencyService();