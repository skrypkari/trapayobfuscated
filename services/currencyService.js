'use strict';const a43_0x53c0b6=a43_0x49f5;(function(_0x3fc0c8,_0x311c9f){const _0x3db822=a43_0x49f5,_0x105fa3=_0x3fc0c8();while(!![]){try{const _0x59188c=parseInt(_0x3db822(0x101))/0x1+parseInt(_0x3db822(0xf2))/0x2+parseInt(_0x3db822(0x10b))/0x3+-parseInt(_0x3db822(0x13e))/0x4*(-parseInt(_0x3db822(0x11d))/0x5)+-parseInt(_0x3db822(0x111))/0x6*(-parseInt(_0x3db822(0x14a))/0x7)+parseInt(_0x3db822(0x117))/0x8*(parseInt(_0x3db822(0xf7))/0x9)+parseInt(_0x3db822(0xf0))/0xa*(-parseInt(_0x3db822(0x148))/0xb);if(_0x59188c===_0x311c9f)break;else _0x105fa3['push'](_0x105fa3['shift']());}catch(_0x381436){_0x105fa3['push'](_0x105fa3['shift']());}}}(a43_0x4d41,0xdd317));function a43_0x49f5(_0x26b094,_0x421284){const _0x4d417f=a43_0x4d41();return a43_0x49f5=function(_0x49f5bf,_0x4fa9f0){_0x49f5bf=_0x49f5bf-0xd2;let _0x1683b2=_0x4d417f[_0x49f5bf];return _0x1683b2;},a43_0x49f5(_0x26b094,_0x421284);}var __importDefault=this&&this['__importDefault']||function(_0x101371){const _0x4c5f03=a43_0x49f5;return _0x101371&&_0x101371[_0x4c5f03(0x140)]?_0x101371:{'default':_0x101371};};function a43_0x4d41(){const _0x37e617=['currencyRate','\x20USDT\x20=\x20','\x20to\x20','link','bdt','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','239248wTkAei','Periodic\x20currency\x20rates\x20update\x20failed:','../config/database','zar','Error\x20converting\x20','vef','Payment\x20System/1.0','\x20USDT\x20(rate:\x20','entries','php','5290632ouPerJ','bmd','pkr','application/json','brl','Failed\x20to\x20update\x20rate\x20for\x20','6dKGDQf','getAllRates','toLowerCase','try','rate','toUpperCase','72kvdnDM','hkd','log','💱\x20Applied\x20','findFirst','No\x20rate\x20found\x20for\x20currency:\x20','25vlJtYX','CURRENCIES','\x20USDT,\x20with\x20','xau','xlm','jpy','updateInterval','asc','yfi','stopPeriodicUpdates','updateCurrencyRates','mxn','%\x20markup\x20=\x20','default','inr','rub',',\x20using\x201\x20as\x20fallback','xag','📊\x20Received\x20rates\x20for\x20','bch','tether','aud','czk','sats','statusText','thb','twd','krw','getCurrencyRate','chf','Error\x20getting\x20rates\x20status:','COINGECKO_URL','nzd','1162144oTmfAD','startPeriodicUpdates','__esModule','?ids=tether&vs_currencies=','keys','pln','toFixed','error','findMany','sek','110BBGTZB','\x20to\x20USDT:','9860473CHUuqG','\x20USDT','updatedAt','warn','💱\x20Converted\x20','count','usd','desc','kwd','lkr','defineProperty','convertToUSDT','gel','btc','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','status','sar','ils','findUnique','upsert','%\x20markup\x20to\x20','sgd','cny','aed','ltc','nok','usdt','dkk','bhd','allSettled','✅\x20Currency\x20rates\x20updated\x20successfully','6247700EZiXGu','MARKUP_PERCENTAGE','2847646mpfYiY','gbp','https://api.coingecko.com/api/v3/simple/price','catch','Initial\x20currency\x20rates\x20update\x20failed:','865773dxuCNr','vnd','myr','mmk'];a43_0x4d41=function(){return _0x37e617;};return a43_0x4d41();}Object[a43_0x53c0b6(0xdb)](exports,a43_0x53c0b6(0x140),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a43_0x53c0b6(0x103)));class CurrencyService{constructor(){const _0x5bd4d1=a43_0x53c0b6;this['COINGECKO_URL']=_0x5bd4d1(0xf4),this[_0x5bd4d1(0x11e)]=[_0x5bd4d1(0xde),'eth',_0x5bd4d1(0xe9),_0x5bd4d1(0x130),'bnb','eos','xrp',_0x5bd4d1(0x121),_0x5bd4d1(0xfe),'dot',_0x5bd4d1(0x125),_0x5bd4d1(0xd7),_0x5bd4d1(0xe8),'ars',_0x5bd4d1(0x132),_0x5bd4d1(0xff),_0x5bd4d1(0xed),_0x5bd4d1(0x10c),_0x5bd4d1(0x10f),'cad',_0x5bd4d1(0x13a),'clp',_0x5bd4d1(0xe7),_0x5bd4d1(0x133),_0x5bd4d1(0xec),'eur',_0x5bd4d1(0xf3),_0x5bd4d1(0xdd),_0x5bd4d1(0x118),'huf','idr',_0x5bd4d1(0xe2),_0x5bd4d1(0x12b),_0x5bd4d1(0x122),_0x5bd4d1(0x138),_0x5bd4d1(0xd9),_0x5bd4d1(0xda),_0x5bd4d1(0xfa),_0x5bd4d1(0x128),_0x5bd4d1(0xf9),'ngn',_0x5bd4d1(0xea),_0x5bd4d1(0x13d),_0x5bd4d1(0x10a),_0x5bd4d1(0x10d),_0x5bd4d1(0x143),_0x5bd4d1(0x12c),_0x5bd4d1(0xe1),_0x5bd4d1(0x147),_0x5bd4d1(0xe6),_0x5bd4d1(0x136),_0x5bd4d1(0x114),_0x5bd4d1(0x137),'uah',_0x5bd4d1(0x106),_0x5bd4d1(0xf8),_0x5bd4d1(0x104),'xdr',_0x5bd4d1(0x12e),_0x5bd4d1(0x120),'bits',_0x5bd4d1(0x134)],this[_0x5bd4d1(0x123)]=null,this[_0x5bd4d1(0xf1)]=-0x3,this['startPeriodicUpdates']();}[a43_0x53c0b6(0x13f)](){const _0x2ad08e=a43_0x53c0b6;this[_0x2ad08e(0x127)]()[_0x2ad08e(0xf5)](_0x4ddae4=>{const _0x449ece=_0x2ad08e;console[_0x449ece(0x145)](_0x449ece(0xf6),_0x4ddae4);}),this[_0x2ad08e(0x123)]=setInterval(async()=>{const _0x33901a=_0x2ad08e;try{await this[_0x33901a(0x127)]();}catch(_0x4586c9){console[_0x33901a(0x145)](_0x33901a(0x102),_0x4586c9);}},0x3c*0x3c*0x3e8),console['log'](_0x2ad08e(0xdf));}[a43_0x53c0b6(0x126)](){const _0x1ffb98=a43_0x53c0b6;this[_0x1ffb98(0x123)]&&(clearInterval(this['updateInterval']),this[_0x1ffb98(0x123)]=null,console['log']('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a43_0x53c0b6(0x127)](){const _0x4de619=a43_0x53c0b6;try{console[_0x4de619(0x119)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x4cee79=this[_0x4de619(0x11e)]['join'](','),_0x255114=this[_0x4de619(0x13c)]+_0x4de619(0x141)+_0x4cee79,_0x27aaa0=await fetch(_0x255114,{'headers':{'Accept':_0x4de619(0x10e),'User-Agent':_0x4de619(0x107)}});if(!_0x27aaa0['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x27aaa0[_0x4de619(0xe0)]+'\x20'+_0x27aaa0[_0x4de619(0x135)]);const _0x3c99eb=await _0x27aaa0['json']();if(!_0x3c99eb[_0x4de619(0x131)])throw new Error(_0x4de619(0x100));const _0x17788d=_0x3c99eb[_0x4de619(0x131)];console[_0x4de619(0x119)](_0x4de619(0x12f)+Object[_0x4de619(0x142)](_0x17788d)['length']+'\x20currencies');const _0x511c8c=Object[_0x4de619(0x109)](_0x17788d)['map'](async([_0x55fcf9,_0x195e90])=>{const _0x52058c=_0x4de619;try{await database_1[_0x52058c(0x12a)][_0x52058c(0xfb)][_0x52058c(0xe4)]({'where':{'currency':_0x55fcf9[_0x52058c(0x113)]()},'update':{'rate':_0x195e90},'create':{'currency':_0x55fcf9[_0x52058c(0x113)](),'rate':_0x195e90}});}catch(_0x335800){console[_0x52058c(0x145)](_0x52058c(0x110)+_0x55fcf9+':',_0x335800);}});await Promise[_0x4de619(0xee)](_0x511c8c),console['log'](_0x4de619(0xef));}catch(_0x3648c5){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x3648c5);throw _0x3648c5;}}async[a43_0x53c0b6(0x139)](_0x7a3c6a){const _0x5af3ec=a43_0x53c0b6,_0x48e842=_0x7a3c6a[_0x5af3ec(0x113)]();if(_0x48e842===_0x5af3ec(0xeb))return 0x1;try{const _0x241465=await database_1[_0x5af3ec(0x12a)][_0x5af3ec(0xfb)][_0x5af3ec(0xe3)]({'where':{'currency':_0x48e842}});if(!_0x241465)return console[_0x5af3ec(0xd4)](_0x5af3ec(0x11c)+_0x7a3c6a+_0x5af3ec(0x12d)),0x1;return _0x241465[_0x5af3ec(0x115)];}catch(_0x3e35d6){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x7a3c6a+':',_0x3e35d6),0x1;}}async[a43_0x53c0b6(0xdc)](_0x369169,_0x7bf1af){const _0x22962b=a43_0x53c0b6,_0x4bcab3=_0x7bf1af['toLowerCase']();if(_0x4bcab3===_0x22962b(0xeb)){const _0x23f2e3=_0x369169*(0x1+this[_0x22962b(0xf1)]/0x64);return console[_0x22962b(0x119)](_0x22962b(0x11a)+this[_0x22962b(0xf1)]+_0x22962b(0xe5)+_0x369169+_0x22962b(0xfc)+_0x23f2e3[_0x22962b(0x144)](0x6)+_0x22962b(0xd2)),_0x23f2e3;}try{const _0x137f12=await this['getCurrencyRate'](_0x4bcab3),_0x4b19cb=_0x369169/_0x137f12,_0x1791d0=_0x4b19cb*(0x1+this[_0x22962b(0xf1)]/0x64);return console[_0x22962b(0x119)](_0x22962b(0xd5)+_0x369169+'\x20'+_0x7bf1af[_0x22962b(0x116)]()+_0x22962b(0xfd)+_0x4b19cb[_0x22962b(0x144)](0x6)+_0x22962b(0x11f)+this[_0x22962b(0xf1)]+_0x22962b(0x129)+_0x1791d0['toFixed'](0x6)+_0x22962b(0x108)+_0x137f12+')'),_0x1791d0;}catch(_0x36d178){console[_0x22962b(0x145)](_0x22962b(0x105)+_0x369169+'\x20'+_0x7bf1af+_0x22962b(0x149),_0x36d178);const _0x5f3eb6=_0x369169*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x5f3eb6;}}async['convertMultipleToUSDT'](_0x545665){const _0x444d47=a43_0x53c0b6;let _0x532382=0x0;for(const {amount:_0x59fb69,currency:_0x643e1f}of _0x545665){const _0x27d638=await this[_0x444d47(0xdc)](_0x59fb69,_0x643e1f);_0x532382+=_0x27d638;}return _0x532382;}async[a43_0x53c0b6(0x112)](){const _0x16930e=a43_0x53c0b6;try{const _0x3f9693=await database_1['default']['currencyRate'][_0x16930e(0x146)]({'select':{'currency':!![],'rate':!![]}}),_0x4bb178={'usdt':0x1};return _0x3f9693['forEach'](_0x4dcf54=>{const _0x42352c=_0x16930e;_0x4bb178[_0x4dcf54['currency']]=_0x4dcf54[_0x42352c(0x115)];}),_0x4bb178;}catch(_0x563462){return console['error']('Error\x20getting\x20all\x20rates:',_0x563462),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2db298=a43_0x53c0b6;try{const [_0x3f42a0,_0x3edc3e,_0x744383]=await Promise['all']([database_1[_0x2db298(0x12a)][_0x2db298(0xfb)][_0x2db298(0xd6)](),database_1['default']['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x2db298(0xd8)},'select':{'updatedAt':!![]}}),database_1[_0x2db298(0x12a)]['currencyRate'][_0x2db298(0x11b)]({'orderBy':{'updatedAt':_0x2db298(0x124)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f42a0,'lastUpdated':_0x3edc3e?.[_0x2db298(0xd3)]||null,'oldestRate':_0x744383?.[_0x2db298(0xd3)]||null,'markupPercentage':this[_0x2db298(0xf1)]};}catch(_0x16a666){return console['error'](_0x2db298(0x13b),_0x16a666),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2db298(0xf1)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();