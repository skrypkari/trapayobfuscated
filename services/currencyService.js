'use strict';const a39_0x15a639=a39_0x1031;function a39_0x1031(_0x328c93,_0x243567){const _0x4160a5=a39_0x4160();return a39_0x1031=function(_0x1031a1,_0xac2c36){_0x1031a1=_0x1031a1-0x156;let _0x7058e0=_0x4160a5[_0x1031a1];return _0x7058e0;},a39_0x1031(_0x328c93,_0x243567);}(function(_0x5a3e0e,_0x58a56e){const _0x2788dd=a39_0x1031,_0xb9b7a4=_0x5a3e0e();while(!![]){try{const _0x450f0f=parseInt(_0x2788dd(0x1cc))/0x1*(parseInt(_0x2788dd(0x18a))/0x2)+-parseInt(_0x2788dd(0x159))/0x3+-parseInt(_0x2788dd(0x19f))/0x4+parseInt(_0x2788dd(0x1c7))/0x5+-parseInt(_0x2788dd(0x1be))/0x6*(parseInt(_0x2788dd(0x1ae))/0x7)+parseInt(_0x2788dd(0x189))/0x8+parseInt(_0x2788dd(0x1a3))/0x9*(parseInt(_0x2788dd(0x16e))/0xa);if(_0x450f0f===_0x58a56e)break;else _0xb9b7a4['push'](_0xb9b7a4['shift']());}catch(_0x11cdb7){_0xb9b7a4['push'](_0xb9b7a4['shift']());}}}(a39_0x4160,0xe9c84));var __importDefault=this&&this[a39_0x15a639(0x192)]||function(_0x1194ab){const _0x516f7d=a39_0x15a639;return _0x1194ab&&_0x1194ab[_0x516f7d(0x1a7)]?_0x1194ab:{'default':_0x1194ab};};function a39_0x4160(){const _0x4493bd=['sats','cny','getRatesStatus','convertToUSDT','tether','log','mxn','%\x20markup\x20to\x20','xdr','catch','\x20to\x20USDT:','870RQjFPd','inr','MARKUP_PERCENTAGE','Periodic\x20currency\x20rates\x20update\x20failed:','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','ltc','error','\x20to\x20','gel','stopPeriodicUpdates','Error\x20getting\x20rate\x20for\x20currency\x20','\x20USDT','brl','nzd','usdt','Error\x20getting\x20all\x20rates:','getCurrencyRate','dot','xrp','updatedAt','all','mmk','sek','bnb','findFirst','hkd','sgd','9457744PcVOym','126488MqxWzX','currencyRate','kwd','krw','czk','default','startPeriodicUpdates','defineProperty','__importDefault','toLowerCase','vef','getMarkupPercentage','?ids=tether&vs_currencies=','uah','getAllRates','bhd','eur','eos','rate','💱\x20Converted\x20','bdt','2390464jbcvyr','myr','usd','../config/database','145809vtDDZp','twd','length','xlm','__esModule','yfi','currencyService','xag','pkr','TesSoft\x20Payment\x20System/1.0','nok','28xkZNFV','chf','COINGECKO_URL','php','upsert','\x20currencies','No\x20rate\x20found\x20for\x20currency:\x20','CurrencyService','allSettled','findUnique','pln','bits','ngn','huf','btc','asc','1965558TxVfcY','map','jpy','💱\x20Applied\x20','aud','cad','ars','idr','CoinGecko\x20API\x20error:\x20','339885bAFbXA','entries','\x20USDT\x20=\x20','lkr','updateInterval','4jWflvJ','eth','keys','CURRENCIES','desc','vnd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','count','clp','141294KBirJX','try','currency','bch','rub','updateCurrencyRates','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','findMany','xau',',\x20using\x201\x20as\x20fallback'];a39_0x4160=function(){return _0x4493bd;};return a39_0x4160();}Object[a39_0x15a639(0x191)](exports,a39_0x15a639(0x1a7),{'value':!![]}),exports[a39_0x15a639(0x1a9)]=exports[a39_0x15a639(0x1b5)]=void 0x0;const database_1=__importDefault(require(a39_0x15a639(0x1a2)));class CurrencyService{constructor(){const _0x4fbec1=a39_0x15a639;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x4fbec1(0x1cf)]=[_0x4fbec1(0x1bc),_0x4fbec1(0x1cd),_0x4fbec1(0x173),_0x4fbec1(0x15c),_0x4fbec1(0x185),_0x4fbec1(0x19b),_0x4fbec1(0x180),_0x4fbec1(0x1a6),'link',_0x4fbec1(0x17f),_0x4fbec1(0x1a8),_0x4fbec1(0x1a1),'aed',_0x4fbec1(0x1c4),_0x4fbec1(0x1c2),_0x4fbec1(0x19e),_0x4fbec1(0x199),'bmd',_0x4fbec1(0x17a),_0x4fbec1(0x1c3),_0x4fbec1(0x1af),_0x4fbec1(0x158),_0x4fbec1(0x164),_0x4fbec1(0x18e),'dkk',_0x4fbec1(0x19a),'gbp',_0x4fbec1(0x176),_0x4fbec1(0x187),_0x4fbec1(0x1bb),_0x4fbec1(0x1c5),'ils',_0x4fbec1(0x16f),_0x4fbec1(0x1c0),_0x4fbec1(0x18d),_0x4fbec1(0x18c),_0x4fbec1(0x1ca),_0x4fbec1(0x183),_0x4fbec1(0x169),_0x4fbec1(0x1a0),_0x4fbec1(0x1ba),_0x4fbec1(0x1ad),_0x4fbec1(0x17b),_0x4fbec1(0x1b1),_0x4fbec1(0x1ab),_0x4fbec1(0x1b8),_0x4fbec1(0x15d),'sar',_0x4fbec1(0x184),_0x4fbec1(0x188),'thb',_0x4fbec1(0x15a),_0x4fbec1(0x1a4),_0x4fbec1(0x197),_0x4fbec1(0x194),_0x4fbec1(0x1d1),'zar',_0x4fbec1(0x16b),_0x4fbec1(0x1aa),_0x4fbec1(0x161),_0x4fbec1(0x1b9),_0x4fbec1(0x163)],this[_0x4fbec1(0x1cb)]=null,this[_0x4fbec1(0x170)]=-0x3,this[_0x4fbec1(0x190)]();}['startPeriodicUpdates'](){const _0x5cf881=a39_0x15a639;this[_0x5cf881(0x15e)]()[_0x5cf881(0x16c)](_0x52f18d=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x52f18d);}),this[_0x5cf881(0x1cb)]=setInterval(async()=>{const _0x32fdad=_0x5cf881;try{await this[_0x32fdad(0x15e)]();}catch(_0x31ab33){console[_0x32fdad(0x174)](_0x32fdad(0x171),_0x31ab33);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x15a639(0x177)](){const _0x1ece7c=a39_0x15a639;this[_0x1ece7c(0x1cb)]&&(clearInterval(this[_0x1ece7c(0x1cb)]),this[_0x1ece7c(0x1cb)]=null,console[_0x1ece7c(0x168)](_0x1ece7c(0x172)));}async[a39_0x15a639(0x15e)](){const _0x59169d=a39_0x15a639;try{console[_0x59169d(0x168)](_0x59169d(0x15f));const _0x8ff4f9=this[_0x59169d(0x1cf)]['join'](','),_0x73f0b3=this[_0x59169d(0x1b0)]+_0x59169d(0x196)+_0x8ff4f9,_0xe1238c=await fetch(_0x73f0b3,{'headers':{'Accept':'application/json','User-Agent':_0x59169d(0x1ac)}});if(!_0xe1238c['ok'])throw new Error(_0x59169d(0x1c6)+_0xe1238c['status']+'\x20'+_0xe1238c['statusText']);const _0x5cf437=await _0xe1238c['json']();if(!_0x5cf437[_0x59169d(0x167)])throw new Error(_0x59169d(0x156));const _0x405f95=_0x5cf437[_0x59169d(0x167)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x59169d(0x1ce)](_0x405f95)[_0x59169d(0x1a5)]+_0x59169d(0x1b3));const _0x4f4152=Object[_0x59169d(0x1c8)](_0x405f95)[_0x59169d(0x1bf)](async([_0x309288,_0xe6b29d])=>{const _0x37912a=_0x59169d;try{await database_1[_0x37912a(0x18f)][_0x37912a(0x18b)][_0x37912a(0x1b2)]({'where':{'currency':_0x309288[_0x37912a(0x193)]()},'update':{'rate':_0xe6b29d},'create':{'currency':_0x309288['toLowerCase'](),'rate':_0xe6b29d}});}catch(_0x4a1d2f){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x309288+':',_0x4a1d2f);}});await Promise[_0x59169d(0x1b6)](_0x4f4152),console[_0x59169d(0x168)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x126775){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x126775);throw _0x126775;}}async[a39_0x15a639(0x17e)](_0x179380){const _0xec41e9=a39_0x15a639,_0x12420a=_0x179380['toLowerCase']();if(_0x12420a===_0xec41e9(0x17c))return 0x1;try{const _0x3e3d74=await database_1[_0xec41e9(0x18f)][_0xec41e9(0x18b)][_0xec41e9(0x1b7)]({'where':{'currency':_0x12420a}});if(!_0x3e3d74)return console['warn'](_0xec41e9(0x1b4)+_0x179380+_0xec41e9(0x162)),0x1;return _0x3e3d74[_0xec41e9(0x19c)];}catch(_0x1e925b){return console[_0xec41e9(0x174)](_0xec41e9(0x178)+_0x179380+':',_0x1e925b),0x1;}}async[a39_0x15a639(0x166)](_0x2e44e0,_0x19aaae){const _0xc13a67=a39_0x15a639,_0x5bb49d=_0x19aaae['toLowerCase']();if(_0x5bb49d===_0xc13a67(0x17c)){const _0x3d7bd1=_0x2e44e0*(0x1+this[_0xc13a67(0x170)]/0x64);return console[_0xc13a67(0x168)](_0xc13a67(0x1c1)+this['MARKUP_PERCENTAGE']+_0xc13a67(0x16a)+_0x2e44e0+_0xc13a67(0x1c9)+_0x3d7bd1['toFixed'](0x6)+_0xc13a67(0x179)),_0x3d7bd1;}try{const _0x3d8782=await this[_0xc13a67(0x17e)](_0x5bb49d),_0x53bd55=_0x2e44e0/_0x3d8782,_0xf8974e=_0x53bd55*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0xc13a67(0x19d)+_0x2e44e0+'\x20'+_0x19aaae['toUpperCase']()+_0xc13a67(0x175)+_0x53bd55['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0xc13a67(0x170)]+'%\x20markup\x20=\x20'+_0xf8974e['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x3d8782+')'),_0xf8974e;}catch(_0x4920d9){console['error']('Error\x20converting\x20'+_0x2e44e0+'\x20'+_0x19aaae+_0xc13a67(0x16d),_0x4920d9);const _0x436adb=_0x2e44e0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x436adb;}}async['convertMultipleToUSDT'](_0x34b5ae){const _0x318c5e=a39_0x15a639;let _0xdd9f92=0x0;for(const {amount:_0x2567c6,currency:_0x1804e6}of _0x34b5ae){const _0x4b78af=await this[_0x318c5e(0x166)](_0x2567c6,_0x1804e6);_0xdd9f92+=_0x4b78af;}return _0xdd9f92;}async[a39_0x15a639(0x198)](){const _0x20799e=a39_0x15a639;try{const _0x40c848=await database_1[_0x20799e(0x18f)][_0x20799e(0x18b)][_0x20799e(0x160)]({'select':{'currency':!![],'rate':!![]}}),_0x40f174={'usdt':0x1};return _0x40c848['forEach'](_0x48df82=>{const _0x5d5da9=_0x20799e;_0x40f174[_0x48df82[_0x5d5da9(0x15b)]]=_0x48df82[_0x5d5da9(0x19c)];}),_0x40f174;}catch(_0x371dc2){return console[_0x20799e(0x174)](_0x20799e(0x17d),_0x371dc2),{'usdt':0x1};}}async[a39_0x15a639(0x165)](){const _0x526910=a39_0x15a639;try{const [_0x543d66,_0x50bafc,_0x5d9169]=await Promise[_0x526910(0x182)]([database_1[_0x526910(0x18f)][_0x526910(0x18b)][_0x526910(0x157)](),database_1['default']['currencyRate'][_0x526910(0x186)]({'orderBy':{'updatedAt':_0x526910(0x1d0)},'select':{'updatedAt':!![]}}),database_1[_0x526910(0x18f)][_0x526910(0x18b)][_0x526910(0x186)]({'orderBy':{'updatedAt':_0x526910(0x1bd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x543d66,'lastUpdated':_0x50bafc?.[_0x526910(0x181)]||null,'oldestRate':_0x5d9169?.[_0x526910(0x181)]||null,'markupPercentage':this[_0x526910(0x170)]};}catch(_0x4edeff){return console['error']('Error\x20getting\x20rates\x20status:',_0x4edeff),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x526910(0x170)]};}}[a39_0x15a639(0x195)](){const _0x37dcee=a39_0x15a639;return this[_0x37dcee(0x170)];}}exports[a39_0x15a639(0x1b5)]=CurrencyService,exports['currencyService']=new CurrencyService();