'use strict';const a43_0x25e20f=a43_0x284b;(function(_0x2a84c6,_0x534490){const _0x20ec44=a43_0x284b,_0x5ee3f2=_0x2a84c6();while(!![]){try{const _0x32f125=-parseInt(_0x20ec44(0xba))/0x1*(-parseInt(_0x20ec44(0xf0))/0x2)+parseInt(_0x20ec44(0xd7))/0x3*(-parseInt(_0x20ec44(0xe6))/0x4)+parseInt(_0x20ec44(0xd2))/0x5*(parseInt(_0x20ec44(0xa2))/0x6)+parseInt(_0x20ec44(0xc2))/0x7*(-parseInt(_0x20ec44(0xd4))/0x8)+-parseInt(_0x20ec44(0xb0))/0x9+-parseInt(_0x20ec44(0xaa))/0xa+-parseInt(_0x20ec44(0xb2))/0xb*(-parseInt(_0x20ec44(0xcc))/0xc);if(_0x32f125===_0x534490)break;else _0x5ee3f2['push'](_0x5ee3f2['shift']());}catch(_0xec51f5){_0x5ee3f2['push'](_0x5ee3f2['shift']());}}}(a43_0x5177,0xf3c2c));function a43_0x284b(_0x3f25c3,_0x334bec){const _0x5177db=a43_0x5177();return a43_0x284b=function(_0x284be0,_0x344f97){_0x284be0=_0x284be0-0x8f;let _0x214d33=_0x5177db[_0x284be0];return _0x214d33;},a43_0x284b(_0x3f25c3,_0x334bec);}var __importDefault=this&&this[a43_0x25e20f(0x9d)]||function(_0x3283da){const _0x25cce0=a43_0x25e20f;return _0x3283da&&_0x3283da[_0x25cce0(0x9b)]?_0x3283da:{'default':_0x3283da};};Object[a43_0x25e20f(0xc1)](exports,'__esModule',{'value':!![]}),exports[a43_0x25e20f(0xe8)]=exports[a43_0x25e20f(0xdf)]=void 0x0;function a43_0x5177(){const _0x3ed732=['join','aed','yfi','Error\x20converting\x20','getAllRates','bnb','ars','vef','bch','22410612ZfEBxG','xau','💱\x20Applied\x20','✅\x20Currency\x20rates\x20updated\x20successfully','inr','default','125PxgAYv','mmk','13395336YcmSXJ','\x20USDT,\x20with\x20','lkr','30VuIBwC','getRatesStatus','toLowerCase','%\x20markup\x20=\x20','czk','sgd','\x20to\x20','nok','CurrencyService','findFirst','xrp','cad','uah','keys','log','297592LfKkVw','bits','currencyService','myr','toFixed','?ids=tether&vs_currencies=','xlm','entries','warn','dot','2tTfKUe','convertToUSDT','xag','bhd','clp','rub','pkr','application/json','all','eth','json','sek','stopPeriodicUpdates','\x20to\x20USDT:','php','zar','updateInterval','asc','%\x20markup\x20to\x20','Initial\x20currency\x20rates\x20update\x20failed:','nzd','eur','sats','eos','tether','gbp','ils','getCurrencyRate','rate','📊\x20Received\x20rates\x20for\x20','cny','CURRENCIES','\x20currencies','mxn','btc','statusText','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','map','kwd','vnd','\x20USDT\x20(rate:\x20','updateCurrencyRates','count','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','error','__esModule','catch','__importDefault','bmd','xdr','aud','Payment\x20System/1.0','428202bdipaF','MARKUP_PERCENTAGE',',\x20using\x201\x20as\x20fallback','\x20USDT\x20=\x20','updatedAt','hkd','ngn','thb','14462410FHracW','desc','COINGECKO_URL','../config/database','jpy','upsert','3715488CvOTYP','usdt','11NVrEGZ','allSettled','No\x20rate\x20found\x20for\x20currency:\x20','status','twd','CoinGecko\x20API\x20error:\x20','pln','Failed\x20to\x20update\x20rate\x20for\x20','1624188UTLJgT','krw','ltc','toUpperCase','❌\x20Failed\x20to\x20update\x20currency\x20rates:','currency','currencyRate','defineProperty','7EkVxGd'];a43_0x5177=function(){return _0x3ed732;};return a43_0x5177();}const database_1=__importDefault(require(a43_0x25e20f(0xad)));class CurrencyService{constructor(){const _0x90f3c3=a43_0x25e20f;this[_0x90f3c3(0xac)]='https://api.coingecko.com/api/v3/simple/price',this[_0x90f3c3(0x10f)]=[_0x90f3c3(0x90),_0x90f3c3(0xf9),_0x90f3c3(0xbc),_0x90f3c3(0xcb),_0x90f3c3(0xc8),_0x90f3c3(0x107),_0x90f3c3(0xe1),_0x90f3c3(0xec),'link',_0x90f3c3(0xef),_0x90f3c3(0xc5),'usd',_0x90f3c3(0xc4),_0x90f3c3(0xc9),_0x90f3c3(0xa0),'bdt',_0x90f3c3(0xf3),_0x90f3c3(0x9e),'brl',_0x90f3c3(0xe2),'chf',_0x90f3c3(0xf4),_0x90f3c3(0x10e),_0x90f3c3(0xdb),'dkk',_0x90f3c3(0x105),_0x90f3c3(0x109),'gel',_0x90f3c3(0xa7),'huf','idr',_0x90f3c3(0x10a),_0x90f3c3(0xd0),_0x90f3c3(0xae),_0x90f3c3(0xbb),_0x90f3c3(0x94),_0x90f3c3(0xd6),_0x90f3c3(0xd3),_0x90f3c3(0x8f),_0x90f3c3(0xe9),_0x90f3c3(0xa8),_0x90f3c3(0xde),_0x90f3c3(0x104),_0x90f3c3(0xfe),_0x90f3c3(0xf6),_0x90f3c3(0xb8),_0x90f3c3(0xf5),'sar',_0x90f3c3(0xfb),_0x90f3c3(0xdc),_0x90f3c3(0xa9),'try',_0x90f3c3(0xb6),_0x90f3c3(0xe3),_0x90f3c3(0xca),_0x90f3c3(0x95),_0x90f3c3(0xff),_0x90f3c3(0x9f),_0x90f3c3(0xf2),_0x90f3c3(0xcd),_0x90f3c3(0xe7),_0x90f3c3(0x106)],this[_0x90f3c3(0x100)]=null,this['MARKUP_PERCENTAGE']=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x50335b=a43_0x25e20f;this[_0x50335b(0x97)]()[_0x50335b(0x9c)](_0x556a73=>{const _0x599a9d=_0x50335b;console[_0x599a9d(0x9a)](_0x599a9d(0x103),_0x556a73);}),this['updateInterval']=setInterval(async()=>{const _0x288297=_0x50335b;try{await this[_0x288297(0x97)]();}catch(_0xfcaebb){console[_0x288297(0x9a)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0xfcaebb);}},0x3c*0x3c*0x3e8),console[_0x50335b(0xe5)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a43_0x25e20f(0xfc)](){const _0x292964=a43_0x25e20f;this[_0x292964(0x100)]&&(clearInterval(this['updateInterval']),this[_0x292964(0x100)]=null,console[_0x292964(0xe5)](_0x292964(0x99)));}async[a43_0x25e20f(0x97)](){const _0x3f9d86=a43_0x25e20f;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x2685be=this[_0x3f9d86(0x10f)][_0x3f9d86(0xc3)](','),_0x182523=this[_0x3f9d86(0xac)]+_0x3f9d86(0xeb)+_0x2685be,_0x8cd1bf=await fetch(_0x182523,{'headers':{'Accept':_0x3f9d86(0xf7),'User-Agent':_0x3f9d86(0xa1)}});if(!_0x8cd1bf['ok'])throw new Error(_0x3f9d86(0xb7)+_0x8cd1bf[_0x3f9d86(0xb5)]+'\x20'+_0x8cd1bf[_0x3f9d86(0x91)]);const _0x14b3ca=await _0x8cd1bf[_0x3f9d86(0xfa)]();if(!_0x14b3ca[_0x3f9d86(0x108)])throw new Error(_0x3f9d86(0x92));const _0x5c2f15=_0x14b3ca[_0x3f9d86(0x108)];console[_0x3f9d86(0xe5)](_0x3f9d86(0x10d)+Object[_0x3f9d86(0xe4)](_0x5c2f15)['length']+_0x3f9d86(0x110));const _0x2dba4b=Object[_0x3f9d86(0xed)](_0x5c2f15)[_0x3f9d86(0x93)](async([_0x3cd053,_0x3834c0])=>{const _0x101aa2=_0x3f9d86;try{await database_1['default'][_0x101aa2(0xc0)][_0x101aa2(0xaf)]({'where':{'currency':_0x3cd053[_0x101aa2(0xd9)]()},'update':{'rate':_0x3834c0},'create':{'currency':_0x3cd053[_0x101aa2(0xd9)](),'rate':_0x3834c0}});}catch(_0x1ec334){console[_0x101aa2(0x9a)](_0x101aa2(0xb9)+_0x3cd053+':',_0x1ec334);}});await Promise[_0x3f9d86(0xb3)](_0x2dba4b),console[_0x3f9d86(0xe5)](_0x3f9d86(0xcf));}catch(_0x3dcf9f){console[_0x3f9d86(0x9a)](_0x3f9d86(0xbe),_0x3dcf9f);throw _0x3dcf9f;}}async[a43_0x25e20f(0x10b)](_0x301587){const _0x263e79=a43_0x25e20f,_0xb49591=_0x301587[_0x263e79(0xd9)]();if(_0xb49591===_0x263e79(0xb1))return 0x1;try{const _0x334e7d=await database_1[_0x263e79(0xd1)][_0x263e79(0xc0)]['findUnique']({'where':{'currency':_0xb49591}});if(!_0x334e7d)return console[_0x263e79(0xee)](_0x263e79(0xb4)+_0x301587+_0x263e79(0xa4)),0x1;return _0x334e7d[_0x263e79(0x10c)];}catch(_0x3a6a16){return console[_0x263e79(0x9a)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x301587+':',_0x3a6a16),0x1;}}async['convertToUSDT'](_0x2cea46,_0x289fc5){const _0xf2b8a3=a43_0x25e20f,_0x121866=_0x289fc5['toLowerCase']();if(_0x121866===_0xf2b8a3(0xb1)){const _0x563c0b=_0x2cea46*(0x1+this[_0xf2b8a3(0xa3)]/0x64);return console[_0xf2b8a3(0xe5)](_0xf2b8a3(0xce)+this[_0xf2b8a3(0xa3)]+_0xf2b8a3(0x102)+_0x2cea46+_0xf2b8a3(0xa5)+_0x563c0b['toFixed'](0x6)+'\x20USDT'),_0x563c0b;}try{const _0x4a6994=await this[_0xf2b8a3(0x10b)](_0x121866),_0x1331d9=_0x2cea46/_0x4a6994,_0x1e7179=_0x1331d9*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0xf2b8a3(0xe5)]('💱\x20Converted\x20'+_0x2cea46+'\x20'+_0x289fc5[_0xf2b8a3(0xbd)]()+_0xf2b8a3(0xdd)+_0x1331d9[_0xf2b8a3(0xea)](0x6)+_0xf2b8a3(0xd5)+this[_0xf2b8a3(0xa3)]+_0xf2b8a3(0xda)+_0x1e7179[_0xf2b8a3(0xea)](0x6)+_0xf2b8a3(0x96)+_0x4a6994+')'),_0x1e7179;}catch(_0x24439c){console[_0xf2b8a3(0x9a)](_0xf2b8a3(0xc6)+_0x2cea46+'\x20'+_0x289fc5+_0xf2b8a3(0xfd),_0x24439c);const _0x243094=_0x2cea46*(0x1+this[_0xf2b8a3(0xa3)]/0x64);return _0x243094;}}async['convertMultipleToUSDT'](_0x2e8f83){const _0x4df029=a43_0x25e20f;let _0x18565e=0x0;for(const {amount:_0x574176,currency:_0x47484b}of _0x2e8f83){const _0x149a69=await this[_0x4df029(0xf1)](_0x574176,_0x47484b);_0x18565e+=_0x149a69;}return _0x18565e;}async[a43_0x25e20f(0xc7)](){const _0x2c3037=a43_0x25e20f;try{const _0x3fe77a=await database_1[_0x2c3037(0xd1)][_0x2c3037(0xc0)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x267a2d={'usdt':0x1};return _0x3fe77a['forEach'](_0x47d244=>{const _0x5e9cd8=_0x2c3037;_0x267a2d[_0x47d244[_0x5e9cd8(0xbf)]]=_0x47d244[_0x5e9cd8(0x10c)];}),_0x267a2d;}catch(_0x277bbe){return console['error']('Error\x20getting\x20all\x20rates:',_0x277bbe),{'usdt':0x1};}}async[a43_0x25e20f(0xd8)](){const _0x353b02=a43_0x25e20f;try{const [_0x4a738e,_0x28eca8,_0xe96235]=await Promise[_0x353b02(0xf8)]([database_1[_0x353b02(0xd1)][_0x353b02(0xc0)][_0x353b02(0x98)](),database_1[_0x353b02(0xd1)][_0x353b02(0xc0)][_0x353b02(0xe0)]({'orderBy':{'updatedAt':_0x353b02(0xab)},'select':{'updatedAt':!![]}}),database_1[_0x353b02(0xd1)][_0x353b02(0xc0)][_0x353b02(0xe0)]({'orderBy':{'updatedAt':_0x353b02(0x101)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4a738e,'lastUpdated':_0x28eca8?.['updatedAt']||null,'oldestRate':_0xe96235?.[_0x353b02(0xa6)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x3749d6){return console[_0x353b02(0x9a)]('Error\x20getting\x20rates\x20status:',_0x3749d6),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x353b02(0xa3)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports[a43_0x25e20f(0xdf)]=CurrencyService,exports['currencyService']=new CurrencyService();