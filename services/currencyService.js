'use strict';const a39_0x20233b=a39_0x474f;(function(_0x429c31,_0x378c35){const _0x42f63a=a39_0x474f,_0x372c6c=_0x429c31();while(!![]){try{const _0x476ea8=parseInt(_0x42f63a(0x100))/0x1+-parseInt(_0x42f63a(0x105))/0x2+parseInt(_0x42f63a(0x99))/0x3*(parseInt(_0x42f63a(0xed))/0x4)+parseInt(_0x42f63a(0xee))/0x5+-parseInt(_0x42f63a(0xc5))/0x6+parseInt(_0x42f63a(0x92))/0x7+-parseInt(_0x42f63a(0xac))/0x8;if(_0x476ea8===_0x378c35)break;else _0x372c6c['push'](_0x372c6c['shift']());}catch(_0x1fc0ba){_0x372c6c['push'](_0x372c6c['shift']());}}}(a39_0x57da,0xb7484));function a39_0x57da(){const _0x390a0f=['xau','eos','catch','toUpperCase','join','nzd','uah','📊\x20Received\x20rates\x20for\x20','findMany','kwd','forEach','COINGECKO_URL','jpy','updatedAt','entries','CurrencyService','ars','MARKUP_PERCENTAGE','Error\x20getting\x20rates\x20status:','rate','nok','inr','eur','link','allSettled','rub','ltc','getMarkupPercentage','btc','aed','💱\x20Applied\x20','currencyService','Error\x20getting\x20all\x20rates:','sgd','bnb','217356japRuD','2956565oUzToF','vnd','count','💱\x20Converted\x20','Error\x20getting\x20rate\x20for\x20currency\x20','https://api.coingecko.com/api/v3/simple/price','tether','\x20USDT,\x20with\x20','error','ils','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','toFixed','Failed\x20to\x20update\x20rate\x20for\x20','Initial\x20currency\x20rates\x20update\x20failed:','xag','log','startPeriodicUpdates','convertMultipleToUSDT','1330233pWOCuM','../config/database','aud','usdt','updateInterval','470476gfMaAI','status','CURRENCIES','currency','currencyRate','default','updateCurrencyRates','9871309RZUJtF','application/json','pkr','mxn','lkr','json','\x20to\x20','24fXmPTK','\x20currencies','sats','sek','__esModule','vef','php','idr','gbp','bdt','hkd','pln','usd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','getRatesStatus','yfi','bch','brl','bmd','10317664UmzBqJ','keys','toLowerCase','\x20USDT','findFirst','Error\x20converting\x20','eth','%\x20markup\x20to\x20','krw','\x20to\x20USDT:','zar','warn','dot','getCurrencyRate','dkk','%\x20markup\x20=\x20','gel','findUnique','xdr','cad','map','upsert','CoinGecko\x20API\x20error:\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','8944650VwsxEx','\x20USDT\x20=\x20','TesSoft\x20Payment\x20System/1.0','statusText','convertToUSDT'];a39_0x57da=function(){return _0x390a0f;};return a39_0x57da();}var __importDefault=this&&this['__importDefault']||function(_0x2c5f83){const _0x3084c8=a39_0x474f;return _0x2c5f83&&_0x2c5f83[_0x3084c8(0x9d)]?_0x2c5f83:{'default':_0x2c5f83};};Object['defineProperty'](exports,a39_0x20233b(0x9d),{'value':!![]}),exports[a39_0x20233b(0xe9)]=exports[a39_0x20233b(0xd9)]=void 0x0;function a39_0x474f(_0x197a0f,_0x458319){const _0x57daaa=a39_0x57da();return a39_0x474f=function(_0x474f1a,_0x25fbff){_0x474f1a=_0x474f1a-0x8c;let _0xab691a=_0x57daaa[_0x474f1a];return _0xab691a;},a39_0x474f(_0x197a0f,_0x458319);}const database_1=__importDefault(require(a39_0x20233b(0x101)));class CurrencyService{constructor(){const _0x13b3de=a39_0x20233b;this[_0x13b3de(0xd5)]=_0x13b3de(0xf3),this[_0x13b3de(0x8d)]=[_0x13b3de(0xe6),_0x13b3de(0xb2),_0x13b3de(0xe4),_0x13b3de(0xa9),_0x13b3de(0xec),_0x13b3de(0xcb),'xrp','xlm',_0x13b3de(0xe1),_0x13b3de(0xb8),_0x13b3de(0xa8),_0x13b3de(0xa5),_0x13b3de(0xe7),_0x13b3de(0xda),_0x13b3de(0x102),_0x13b3de(0xa2),'bhd',_0x13b3de(0xab),_0x13b3de(0xaa),_0x13b3de(0xbf),'chf','clp','cny','czk',_0x13b3de(0xba),_0x13b3de(0xe0),_0x13b3de(0xa1),_0x13b3de(0xbc),_0x13b3de(0xa3),'huf',_0x13b3de(0xa0),_0x13b3de(0xf7),_0x13b3de(0xdf),_0x13b3de(0xd6),_0x13b3de(0xb4),_0x13b3de(0xd3),_0x13b3de(0x96),'mmk',_0x13b3de(0x95),'myr','ngn',_0x13b3de(0xde),_0x13b3de(0xcf),_0x13b3de(0x9f),_0x13b3de(0x94),_0x13b3de(0xa4),_0x13b3de(0xe3),'sar',_0x13b3de(0x9c),_0x13b3de(0xeb),'thb','try','twd',_0x13b3de(0xd0),_0x13b3de(0x9e),_0x13b3de(0xef),_0x13b3de(0xb6),_0x13b3de(0xbe),_0x13b3de(0xfc),_0x13b3de(0xca),'bits',_0x13b3de(0x9b)],this[_0x13b3de(0x104)]=null,this[_0x13b3de(0xdb)]=0x3,this[_0x13b3de(0xfe)]();}[a39_0x20233b(0xfe)](){const _0x50ebcc=a39_0x20233b;this[_0x50ebcc(0x91)]()[_0x50ebcc(0xcc)](_0x1a44c2=>{const _0x262f8c=_0x50ebcc;console['error'](_0x262f8c(0xfb),_0x1a44c2);}),this[_0x50ebcc(0x104)]=setInterval(async()=>{const _0x548b8f=_0x50ebcc;try{await this[_0x548b8f(0x91)]();}catch(_0x41d641){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x41d641);}},0x3c*0x3c*0x3e8),console['log'](_0x50ebcc(0xc3));}['stopPeriodicUpdates'](){const _0x4e4814=a39_0x20233b;this[_0x4e4814(0x104)]&&(clearInterval(this[_0x4e4814(0x104)]),this['updateInterval']=null,console[_0x4e4814(0xfd)](_0x4e4814(0xf8)));}async[a39_0x20233b(0x91)](){const _0x37436b=a39_0x20233b;try{console[_0x37436b(0xfd)](_0x37436b(0xc4));const _0x5d26e5=this['CURRENCIES'][_0x37436b(0xce)](','),_0x22051a=this[_0x37436b(0xd5)]+'?ids=tether&vs_currencies='+_0x5d26e5,_0x26e396=await fetch(_0x22051a,{'headers':{'Accept':_0x37436b(0x93),'User-Agent':_0x37436b(0xc7)}});if(!_0x26e396['ok'])throw new Error(_0x37436b(0xc2)+_0x26e396[_0x37436b(0x8c)]+'\x20'+_0x26e396[_0x37436b(0xc8)]);const _0x4e7aff=await _0x26e396[_0x37436b(0x97)]();if(!_0x4e7aff[_0x37436b(0xf4)])throw new Error(_0x37436b(0xa6));const _0xa8347f=_0x4e7aff[_0x37436b(0xf4)];console['log'](_0x37436b(0xd1)+Object[_0x37436b(0xad)](_0xa8347f)['length']+_0x37436b(0x9a));const _0x40fdee=Object[_0x37436b(0xd8)](_0xa8347f)[_0x37436b(0xc0)](async([_0xdd2e,_0x24d0c4])=>{const _0x266320=_0x37436b;try{await database_1[_0x266320(0x90)][_0x266320(0x8f)][_0x266320(0xc1)]({'where':{'currency':_0xdd2e[_0x266320(0xae)]()},'update':{'rate':_0x24d0c4},'create':{'currency':_0xdd2e['toLowerCase'](),'rate':_0x24d0c4}});}catch(_0x29ef67){console[_0x266320(0xf6)](_0x266320(0xfa)+_0xdd2e+':',_0x29ef67);}});await Promise[_0x37436b(0xe2)](_0x40fdee),console[_0x37436b(0xfd)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0xdebe11){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0xdebe11);throw _0xdebe11;}}async[a39_0x20233b(0xb9)](_0x26ca16){const _0x30d76d=a39_0x20233b,_0x14f973=_0x26ca16[_0x30d76d(0xae)]();if(_0x14f973==='usdt')return 0x1;try{const _0x5a3ac5=await database_1[_0x30d76d(0x90)][_0x30d76d(0x8f)][_0x30d76d(0xbd)]({'where':{'currency':_0x14f973}});if(!_0x5a3ac5)return console[_0x30d76d(0xb7)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x26ca16+',\x20using\x201\x20as\x20fallback'),0x1;return _0x5a3ac5[_0x30d76d(0xdd)];}catch(_0x42bf43){return console[_0x30d76d(0xf6)](_0x30d76d(0xf2)+_0x26ca16+':',_0x42bf43),0x1;}}async[a39_0x20233b(0xc9)](_0x4394f6,_0x2e9f34){const _0x4df4d2=a39_0x20233b,_0x26e998=_0x2e9f34[_0x4df4d2(0xae)]();if(_0x26e998===_0x4df4d2(0x103)){const _0x53e829=_0x4394f6*(0x1+this[_0x4df4d2(0xdb)]/0x64);return console[_0x4df4d2(0xfd)](_0x4df4d2(0xe8)+this[_0x4df4d2(0xdb)]+_0x4df4d2(0xb3)+_0x4394f6+_0x4df4d2(0xc6)+_0x53e829[_0x4df4d2(0xf9)](0x6)+_0x4df4d2(0xaf)),_0x53e829;}try{const _0x53ddd0=await this[_0x4df4d2(0xb9)](_0x26e998),_0x129eb1=_0x4394f6/_0x53ddd0,_0x4e4735=_0x129eb1*(0x1+this[_0x4df4d2(0xdb)]/0x64);return console['log'](_0x4df4d2(0xf1)+_0x4394f6+'\x20'+_0x2e9f34[_0x4df4d2(0xcd)]()+_0x4df4d2(0x98)+_0x129eb1[_0x4df4d2(0xf9)](0x6)+_0x4df4d2(0xf5)+this['MARKUP_PERCENTAGE']+_0x4df4d2(0xbb)+_0x4e4735['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x53ddd0+')'),_0x4e4735;}catch(_0x435e01){console['error'](_0x4df4d2(0xb1)+_0x4394f6+'\x20'+_0x2e9f34+_0x4df4d2(0xb5),_0x435e01);const _0x1e2235=_0x4394f6*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x1e2235;}}async[a39_0x20233b(0xff)](_0x10dc79){const _0x5dc4ad=a39_0x20233b;let _0x53c508=0x0;for(const {amount:_0x17a001,currency:_0x127abd}of _0x10dc79){const _0x23f32b=await this[_0x5dc4ad(0xc9)](_0x17a001,_0x127abd);_0x53c508+=_0x23f32b;}return _0x53c508;}async['getAllRates'](){const _0x2c42a3=a39_0x20233b;try{const _0x2eed1f=await database_1['default'][_0x2c42a3(0x8f)][_0x2c42a3(0xd2)]({'select':{'currency':!![],'rate':!![]}}),_0x385e95={'usdt':0x1};return _0x2eed1f[_0x2c42a3(0xd4)](_0x31040f=>{const _0x5eb79d=_0x2c42a3;_0x385e95[_0x31040f[_0x5eb79d(0x8e)]]=_0x31040f[_0x5eb79d(0xdd)];}),_0x385e95;}catch(_0x21b87f){return console[_0x2c42a3(0xf6)](_0x2c42a3(0xea),_0x21b87f),{'usdt':0x1};}}async[a39_0x20233b(0xa7)](){const _0x449b81=a39_0x20233b;try{const [_0xb5f380,_0x41a002,_0x1cd75d]=await Promise['all']([database_1['default'][_0x449b81(0x8f)][_0x449b81(0xf0)](),database_1[_0x449b81(0x90)][_0x449b81(0x8f)][_0x449b81(0xb0)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x449b81(0x90)][_0x449b81(0x8f)][_0x449b81(0xb0)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xb5f380,'lastUpdated':_0x41a002?.[_0x449b81(0xd7)]||null,'oldestRate':_0x1cd75d?.[_0x449b81(0xd7)]||null,'markupPercentage':this[_0x449b81(0xdb)]};}catch(_0x660188){return console[_0x449b81(0xf6)](_0x449b81(0xdc),_0x660188),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x20233b(0xe5)](){const _0x1ff1db=a39_0x20233b;return this[_0x1ff1db(0xdb)];}}exports[a39_0x20233b(0xd9)]=CurrencyService,exports['currencyService']=new CurrencyService();