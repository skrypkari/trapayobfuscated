'use strict';const a55_0x529082=a55_0x2930;(function(_0x16c6c5,_0xc76073){const _0x18ff52=a55_0x2930,_0xdf38db=_0x16c6c5();while(!![]){try{const _0x328ced=parseInt(_0x18ff52(0xd3))/0x1+parseInt(_0x18ff52(0xbb))/0x2+-parseInt(_0x18ff52(0xd5))/0x3*(-parseInt(_0x18ff52(0xd2))/0x4)+-parseInt(_0x18ff52(0xe5))/0x5+-parseInt(_0x18ff52(0xe6))/0x6*(-parseInt(_0x18ff52(0xee))/0x7)+-parseInt(_0x18ff52(0xaf))/0x8+-parseInt(_0x18ff52(0xe4))/0x9;if(_0x328ced===_0xc76073)break;else _0xdf38db['push'](_0xdf38db['shift']());}catch(_0x9fc914){_0xdf38db['push'](_0xdf38db['shift']());}}}(a55_0x367d,0x38032));var __importDefault=this&&this[a55_0x529082(0xbc)]||function(_0x1e629b){const _0x7f91e5=a55_0x529082;return _0x1e629b&&_0x1e629b[_0x7f91e5(0xf7)]?_0x1e629b:{'default':_0x1e629b};};function a55_0x367d(){const _0x5fb403=[',\x20using\x201\x20as\x20fallback','currencyService','\x20to\x20','MARKUP_PERCENTAGE','krw','join','xlm','757978RENokr','__importDefault','Error\x20getting\x20rate\x20for\x20currency\x20','usdt','mxn','status','xdr','brl','CurrencyService','bhd','usd','convertToUSDT','entries','\x20USDT\x20=\x20','idr','Payment\x20System/1.0','Initial\x20currency\x20rates\x20update\x20failed:','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','rate','allSettled','eur','\x20USDT\x20(rate:\x20','defineProperty','25528ajCcBx','323320jcGllD','stopPeriodicUpdates','12GQlLzv','toLowerCase','pkr','cad','Error\x20converting\x20','gel','twd','lkr','getRatesStatus','ils','php','findMany','No\x20rate\x20found\x20for\x20currency:\x20','updateInterval','getCurrencyRate','5238252iczMeO','2090paFhCn','82134kgQVTa','default','findFirst','gbp','myr','startPeriodicUpdates','vnd','../config/database','189GuvduI','tether','bdt','sar','xau','updatedAt','%\x20markup\x20to\x20','âœ…\x20Currency\x20rates\x20updated\x20successfully','catch','__esModule','application/json','\x20USDT','Failed\x20to\x20update\x20rate\x20for\x20','ðŸ’±\x20Applied\x20','Error\x20getting\x20all\x20rates:','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','czk','\x20to\x20USDT:','yfi','count','toUpperCase','length','Error\x20getting\x20rates\x20status:','getMarkupPercentage','toFixed','updateCurrencyRates','eth','ngn','ðŸ’±\x20Converted\x20','findUnique','thb','ltc','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','link','hkd','all','dot','uah','xrp','getAllRates','error','COINGECKO_URL','vef','statusText','\x20USDT,\x20with\x20','currencyRate','cny','pln','CURRENCIES','%\x20markup\x20=\x20','2284544nQmLRA','btc','log','nok','rub'];a55_0x367d=function(){return _0x5fb403;};return a55_0x367d();}function a55_0x2930(_0x535e4b,_0x3d80d7){_0x535e4b=_0x535e4b-0x94;const _0x367d2f=a55_0x367d();let _0x293000=_0x367d2f[_0x535e4b];return _0x293000;}Object[a55_0x529082(0xd1)](exports,'__esModule',{'value':!![]}),exports[a55_0x529082(0xb5)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a55_0x529082(0xed)));class CurrencyService{constructor(){const _0x51237c=a55_0x529082;this[_0x51237c(0xa6)]='https://api.coingecko.com/api/v3/simple/price',this[_0x51237c(0xad)]=[_0x51237c(0xb0),_0x51237c(0x97),_0x51237c(0x9c),'bch','bnb','eos',_0x51237c(0xa3),_0x51237c(0xba),_0x51237c(0x9e),_0x51237c(0xa1),_0x51237c(0x100),_0x51237c(0xc5),'aed','ars','aud',_0x51237c(0xf0),_0x51237c(0xc4),'bmd',_0x51237c(0xc2),_0x51237c(0xd8),'chf','clp',_0x51237c(0xab),_0x51237c(0xfe),'dkk',_0x51237c(0xcf),_0x51237c(0xe9),_0x51237c(0xda),_0x51237c(0x9f),'huf',_0x51237c(0xc9),_0x51237c(0xde),'inr','jpy',_0x51237c(0xb8),'kwd',_0x51237c(0xdc),'mmk',_0x51237c(0xbf),_0x51237c(0xea),_0x51237c(0x98),_0x51237c(0xb2),'nzd',_0x51237c(0xdf),_0x51237c(0xd7),_0x51237c(0xac),_0x51237c(0xb3),_0x51237c(0xf1),'sek','sgd',_0x51237c(0x9b),'try',_0x51237c(0xdb),_0x51237c(0xa2),_0x51237c(0xa7),_0x51237c(0xec),'zar',_0x51237c(0xc1),'xag',_0x51237c(0xf2),'bits','sats'],this[_0x51237c(0xe2)]=null,this[_0x51237c(0xb7)]=-0x3,this[_0x51237c(0xeb)]();}[a55_0x529082(0xeb)](){const _0x2e5f35=a55_0x529082;this[_0x2e5f35(0x96)]()[_0x2e5f35(0xf6)](_0x3b6afb=>{const _0x70707c=_0x2e5f35;console[_0x70707c(0xa5)](_0x70707c(0xcb),_0x3b6afb);}),this[_0x2e5f35(0xe2)]=setInterval(async()=>{const _0x4c4cb8=_0x2e5f35;try{await this[_0x4c4cb8(0x96)]();}catch(_0x3539fe){console[_0x4c4cb8(0xa5)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x3539fe);}},0x3c*0x3c*0x3e8),console[_0x2e5f35(0xb1)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a55_0x529082(0xd4)](){const _0x1c20ea=a55_0x529082;this[_0x1c20ea(0xe2)]&&(clearInterval(this[_0x1c20ea(0xe2)]),this['updateInterval']=null,console[_0x1c20ea(0xb1)](_0x1c20ea(0x9d)));}async[a55_0x529082(0x96)](){const _0x5d445b=a55_0x529082;try{console[_0x5d445b(0xb1)](_0x5d445b(0xfd));const _0x32c968=this['CURRENCIES'][_0x5d445b(0xb9)](','),_0x1778b7=this[_0x5d445b(0xa6)]+'?ids=tether&vs_currencies='+_0x32c968,_0x362ff9=await fetch(_0x1778b7,{'headers':{'Accept':_0x5d445b(0xf8),'User-Agent':_0x5d445b(0xca)}});if(!_0x362ff9['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x362ff9[_0x5d445b(0xc0)]+'\x20'+_0x362ff9[_0x5d445b(0xa8)]);const _0x1695a4=await _0x362ff9['json']();if(!_0x1695a4[_0x5d445b(0xef)])throw new Error(_0x5d445b(0xcc));const _0x1eed51=_0x1695a4[_0x5d445b(0xef)];console[_0x5d445b(0xb1)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object['keys'](_0x1eed51)[_0x5d445b(0x103)]+'\x20currencies');const _0x23aa68=Object[_0x5d445b(0xc7)](_0x1eed51)['map'](async([_0x2d9c7a,_0x58ce11])=>{const _0x3fcd22=_0x5d445b;try{await database_1['default'][_0x3fcd22(0xaa)]['upsert']({'where':{'currency':_0x2d9c7a[_0x3fcd22(0xd6)]()},'update':{'rate':_0x58ce11},'create':{'currency':_0x2d9c7a[_0x3fcd22(0xd6)](),'rate':_0x58ce11}});}catch(_0x882129){console[_0x3fcd22(0xa5)](_0x3fcd22(0xfa)+_0x2d9c7a+':',_0x882129);}});await Promise[_0x5d445b(0xce)](_0x23aa68),console['log'](_0x5d445b(0xf5));}catch(_0x43fb24){console[_0x5d445b(0xa5)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x43fb24);throw _0x43fb24;}}async['getCurrencyRate'](_0x46a932){const _0x340f83=a55_0x529082,_0x10828f=_0x46a932['toLowerCase']();if(_0x10828f===_0x340f83(0xbe))return 0x1;try{const _0x10edd7=await database_1[_0x340f83(0xe7)][_0x340f83(0xaa)][_0x340f83(0x9a)]({'where':{'currency':_0x10828f}});if(!_0x10edd7)return console['warn'](_0x340f83(0xe1)+_0x46a932+_0x340f83(0xb4)),0x1;return _0x10edd7[_0x340f83(0xcd)];}catch(_0x53699){return console[_0x340f83(0xa5)](_0x340f83(0xbd)+_0x46a932+':',_0x53699),0x1;}}async[a55_0x529082(0xc6)](_0x2150c0,_0x58fe3a){const _0x5d94dd=a55_0x529082,_0x4f314c=_0x58fe3a[_0x5d94dd(0xd6)]();if(_0x4f314c===_0x5d94dd(0xbe)){const _0x4e0342=_0x2150c0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5d94dd(0xb1)](_0x5d94dd(0xfb)+this['MARKUP_PERCENTAGE']+_0x5d94dd(0xf4)+_0x2150c0+_0x5d94dd(0xc8)+_0x4e0342[_0x5d94dd(0x95)](0x6)+_0x5d94dd(0xf9)),_0x4e0342;}try{const _0x12649a=await this[_0x5d94dd(0xe3)](_0x4f314c),_0x219a8=_0x2150c0/_0x12649a,_0x3b976c=_0x219a8*(0x1+this[_0x5d94dd(0xb7)]/0x64);return console[_0x5d94dd(0xb1)](_0x5d94dd(0x99)+_0x2150c0+'\x20'+_0x58fe3a[_0x5d94dd(0x102)]()+_0x5d94dd(0xb6)+_0x219a8[_0x5d94dd(0x95)](0x6)+_0x5d94dd(0xa9)+this[_0x5d94dd(0xb7)]+_0x5d94dd(0xae)+_0x3b976c['toFixed'](0x6)+_0x5d94dd(0xd0)+_0x12649a+')'),_0x3b976c;}catch(_0x46f451){console[_0x5d94dd(0xa5)](_0x5d94dd(0xd9)+_0x2150c0+'\x20'+_0x58fe3a+_0x5d94dd(0xff),_0x46f451);const _0x5476a6=_0x2150c0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x5476a6;}}async['convertMultipleToUSDT'](_0x19db24){const _0x11a583=a55_0x529082;let _0x1e590c=0x0;for(const {amount:_0x4af725,currency:_0x38d863}of _0x19db24){const _0x5d0a1d=await this[_0x11a583(0xc6)](_0x4af725,_0x38d863);_0x1e590c+=_0x5d0a1d;}return _0x1e590c;}async[a55_0x529082(0xa4)](){const _0x3663b9=a55_0x529082;try{const _0x611685=await database_1[_0x3663b9(0xe7)][_0x3663b9(0xaa)][_0x3663b9(0xe0)]({'select':{'currency':!![],'rate':!![]}}),_0x5a4029={'usdt':0x1};return _0x611685['forEach'](_0x2b312d=>{_0x5a4029[_0x2b312d['currency']]=_0x2b312d['rate'];}),_0x5a4029;}catch(_0x47593a){return console[_0x3663b9(0xa5)](_0x3663b9(0xfc),_0x47593a),{'usdt':0x1};}}async[a55_0x529082(0xdd)](){const _0x5ffa99=a55_0x529082;try{const [_0x367d2d,_0x1f89ad,_0xfe300a]=await Promise[_0x5ffa99(0xa0)]([database_1[_0x5ffa99(0xe7)][_0x5ffa99(0xaa)][_0x5ffa99(0x101)](),database_1[_0x5ffa99(0xe7)][_0x5ffa99(0xaa)][_0x5ffa99(0xe8)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x5ffa99(0xe7)]['currencyRate'][_0x5ffa99(0xe8)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x367d2d,'lastUpdated':_0x1f89ad?.[_0x5ffa99(0xf3)]||null,'oldestRate':_0xfe300a?.[_0x5ffa99(0xf3)]||null,'markupPercentage':this[_0x5ffa99(0xb7)]};}catch(_0x5b9187){return console[_0x5ffa99(0xa5)](_0x5ffa99(0x104),_0x5b9187),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5ffa99(0xb7)]};}}[a55_0x529082(0x94)](){const _0x750f55=a55_0x529082;return this[_0x750f55(0xb7)];}}exports[a55_0x529082(0xc3)]=CurrencyService,exports[a55_0x529082(0xb5)]=new CurrencyService();