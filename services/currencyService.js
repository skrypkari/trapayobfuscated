'use strict';const a49_0x5226c=a49_0x5099;(function(_0x338ed7,_0x512fb3){const _0x5295e5=a49_0x5099,_0xb0f3ba=_0x338ed7();while(!![]){try{const _0x130490=-parseInt(_0x5295e5(0x98))/0x1*(-parseInt(_0x5295e5(0xf9))/0x2)+parseInt(_0x5295e5(0xc3))/0x3+-parseInt(_0x5295e5(0xa2))/0x4+-parseInt(_0x5295e5(0xa5))/0x5+-parseInt(_0x5295e5(0xa0))/0x6*(parseInt(_0x5295e5(0xa1))/0x7)+parseInt(_0x5295e5(0x8d))/0x8*(-parseInt(_0x5295e5(0xe9))/0x9)+-parseInt(_0x5295e5(0xb3))/0xa*(-parseInt(_0x5295e5(0xad))/0xb);if(_0x130490===_0x512fb3)break;else _0xb0f3ba['push'](_0xb0f3ba['shift']());}catch(_0x6b46cc){_0xb0f3ba['push'](_0xb0f3ba['shift']());}}}(a49_0x3b77,0x47cd5));var __importDefault=this&&this[a49_0x5226c(0xf4)]||function(_0x140646){const _0x381b2d=a49_0x5226c;return _0x140646&&_0x140646[_0x381b2d(0xc1)]?_0x140646:{'default':_0x140646};};Object[a49_0x5226c(0xb8)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a49_0x5226c(0xcf)]=void 0x0;function a49_0x5099(_0x1c4f3b,_0x434537){_0x1c4f3b=_0x1c4f3b-0x82;const _0x3b7787=a49_0x3b77();let _0x50999e=_0x3b7787[_0x1c4f3b];return _0x50999e;}const database_1=__importDefault(require(a49_0x5226c(0xba)));function a49_0x3b77(){const _0x5463de=['sar','aed','allSettled','updateInterval','CoinGecko\x20API\x20error:\x20','twd','eos','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','ltc','bmd','1764VFXMpm','eth','COINGECKO_URL','toUpperCase','pln','currency','status','Initial\x20currency\x20rates\x20update\x20failed:','asc','Error\x20getting\x20rates\x20status:','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','__importDefault','xrp','\x20USDT','gel','thb','642bAWPrL','currencyRate','xag','Payment\x20System/1.0','nzd','try','\x20USDT,\x20with\x20','CURRENCIES','getRatesStatus','eur','application/json','pkr','tether','mmk','11168ZRGLMD','\x20USDT\x20=\x20','default','chf','findUnique','nok','\x20currencies','bdt','âœ…\x20Currency\x20rates\x20updated\x20successfully','rate','php','1446AQmTiu','bhd','clp','czk','cad','myr','\x20to\x20USDT:','upsert','1415658gIWMgC','7synIWu','1711544dvgayV','sats','xdr','1430270KYWwxk','dkk','%\x20markup\x20to\x20','btc','desc','dot','usdt','keys','2519sboWiF','getMarkupPercentage','updateCurrencyRates','log','xau','krw','41510HbTvEK','hkd','zar','Error\x20getting\x20rate\x20for\x20currency\x20','gbp','defineProperty','jpy','../config/database','aud','join','usd','lkr','bnb','ngn','__esModule','?ids=tether&vs_currencies=','308565spWpoW','vnd','getCurrencyRate','ðŸ’±\x20Applied\x20','No\x20rate\x20found\x20for\x20currency:\x20','sek','convertToUSDT','Error\x20converting\x20','ðŸ’±\x20Converted\x20','catch','toFixed','length','CurrencyService','cny','ils','mxn','statusText','count','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','toLowerCase','MARKUP_PERCENTAGE','rub','brl','stopPeriodicUpdates','idr','error','Failed\x20to\x20update\x20rate\x20for\x20','link'];a49_0x3b77=function(){return _0x5463de;};return a49_0x3b77();}class CurrencyService{constructor(){const _0x866aa9=a49_0x5226c;this[_0x866aa9(0xeb)]='https://api.coingecko.com/api/v3/simple/price',this[_0x866aa9(0x86)]=[_0x866aa9(0xa8),_0x866aa9(0xea),_0x866aa9(0xe7),'bch',_0x866aa9(0xbf),_0x866aa9(0xe5),_0x866aa9(0xf5),'xlm',_0x866aa9(0xde),_0x866aa9(0xaa),'yfi',_0x866aa9(0xbd),_0x866aa9(0xe0),'ars',_0x866aa9(0xbb),_0x866aa9(0x94),_0x866aa9(0x99),_0x866aa9(0xe8),_0x866aa9(0xd9),_0x866aa9(0x9c),_0x866aa9(0x90),_0x866aa9(0x9a),_0x866aa9(0xd0),_0x866aa9(0x9b),_0x866aa9(0xa6),_0x866aa9(0x88),_0x866aa9(0xb7),_0x866aa9(0xf7),_0x866aa9(0xb4),'huf',_0x866aa9(0xdb),_0x866aa9(0xd1),'inr',_0x866aa9(0xb9),_0x866aa9(0xb2),'kwd',_0x866aa9(0xbe),_0x866aa9(0x8c),_0x866aa9(0xd2),_0x866aa9(0x9d),_0x866aa9(0xc0),_0x866aa9(0x92),_0x866aa9(0x83),_0x866aa9(0x97),_0x866aa9(0x8a),_0x866aa9(0xed),_0x866aa9(0xd8),_0x866aa9(0xdf),_0x866aa9(0xc8),'sgd',_0x866aa9(0xf8),_0x866aa9(0x84),_0x866aa9(0xe4),'uah','vef',_0x866aa9(0xc4),_0x866aa9(0xb5),_0x866aa9(0xa4),_0x866aa9(0xfb),_0x866aa9(0xb1),'bits',_0x866aa9(0xa3)],this['updateInterval']=null,this[_0x866aa9(0xd7)]=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x29b713=a49_0x5226c;this[_0x29b713(0xaf)]()[_0x29b713(0xcc)](_0x48a07a=>{const _0x81baf0=_0x29b713;console[_0x81baf0(0xdc)](_0x81baf0(0xf0),_0x48a07a);}),this[_0x29b713(0xe2)]=setInterval(async()=>{const _0x4b5907=_0x29b713;try{await this[_0x4b5907(0xaf)]();}catch(_0x431222){console[_0x4b5907(0xdc)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x431222);}},0x3c*0x3c*0x3e8),console[_0x29b713(0xb0)](_0x29b713(0xf3));}[a49_0x5226c(0xda)](){const _0x3886c1=a49_0x5226c;this[_0x3886c1(0xe2)]&&(clearInterval(this[_0x3886c1(0xe2)]),this[_0x3886c1(0xe2)]=null,console['log'](_0x3886c1(0xd5)));}async['updateCurrencyRates'](){const _0x5325d7=a49_0x5226c;try{console[_0x5325d7(0xb0)]('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x426387=this[_0x5325d7(0x86)][_0x5325d7(0xbc)](','),_0x2b9993=this[_0x5325d7(0xeb)]+_0x5325d7(0xc2)+_0x426387,_0x420bbb=await fetch(_0x2b9993,{'headers':{'Accept':_0x5325d7(0x89),'User-Agent':_0x5325d7(0x82)}});if(!_0x420bbb['ok'])throw new Error(_0x5325d7(0xe3)+_0x420bbb[_0x5325d7(0xef)]+'\x20'+_0x420bbb[_0x5325d7(0xd3)]);const _0x2de1ae=await _0x420bbb['json']();if(!_0x2de1ae[_0x5325d7(0x8b)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x3cfbd7=_0x2de1ae['tether'];console[_0x5325d7(0xb0)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0x5325d7(0xac)](_0x3cfbd7)[_0x5325d7(0xce)]+_0x5325d7(0x93));const _0x47f3c2=Object['entries'](_0x3cfbd7)['map'](async([_0x232df9,_0x151e7b])=>{const _0x531b65=_0x5325d7;try{await database_1[_0x531b65(0x8f)][_0x531b65(0xfa)][_0x531b65(0x9f)]({'where':{'currency':_0x232df9['toLowerCase']()},'update':{'rate':_0x151e7b},'create':{'currency':_0x232df9[_0x531b65(0xd6)](),'rate':_0x151e7b}});}catch(_0x176df4){console['error'](_0x531b65(0xdd)+_0x232df9+':',_0x176df4);}});await Promise[_0x5325d7(0xe1)](_0x47f3c2),console['log'](_0x5325d7(0x95));}catch(_0x5926cd){console[_0x5325d7(0xdc)](_0x5325d7(0xe6),_0x5926cd);throw _0x5926cd;}}async[a49_0x5226c(0xc5)](_0x506c4d){const _0x21e4e0=a49_0x5226c,_0x3182b1=_0x506c4d[_0x21e4e0(0xd6)]();if(_0x3182b1==='usdt')return 0x1;try{const _0x1965aa=await database_1['default']['currencyRate'][_0x21e4e0(0x91)]({'where':{'currency':_0x3182b1}});if(!_0x1965aa)return console['warn'](_0x21e4e0(0xc7)+_0x506c4d+',\x20using\x201\x20as\x20fallback'),0x1;return _0x1965aa[_0x21e4e0(0x96)];}catch(_0x87e179){return console['error'](_0x21e4e0(0xb6)+_0x506c4d+':',_0x87e179),0x1;}}async[a49_0x5226c(0xc9)](_0x4efe96,_0x8b2568){const _0x344e78=a49_0x5226c,_0x3108a6=_0x8b2568[_0x344e78(0xd6)]();if(_0x3108a6===_0x344e78(0xab)){const _0x23aace=_0x4efe96*(0x1+this[_0x344e78(0xd7)]/0x64);return console[_0x344e78(0xb0)](_0x344e78(0xc6)+this[_0x344e78(0xd7)]+_0x344e78(0xa7)+_0x4efe96+_0x344e78(0x8e)+_0x23aace[_0x344e78(0xcd)](0x6)+_0x344e78(0xf6)),_0x23aace;}try{const _0x377cab=await this[_0x344e78(0xc5)](_0x3108a6),_0x362cf6=_0x4efe96/_0x377cab,_0x58019f=_0x362cf6*(0x1+this[_0x344e78(0xd7)]/0x64);return console[_0x344e78(0xb0)](_0x344e78(0xcb)+_0x4efe96+'\x20'+_0x8b2568[_0x344e78(0xec)]()+'\x20to\x20'+_0x362cf6[_0x344e78(0xcd)](0x6)+_0x344e78(0x85)+this[_0x344e78(0xd7)]+'%\x20markup\x20=\x20'+_0x58019f['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x377cab+')'),_0x58019f;}catch(_0x3b8d89){console[_0x344e78(0xdc)](_0x344e78(0xca)+_0x4efe96+'\x20'+_0x8b2568+_0x344e78(0x9e),_0x3b8d89);const _0x1dc866=_0x4efe96*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x1dc866;}}async['convertMultipleToUSDT'](_0x57b6d0){let _0x1bb95c=0x0;for(const {amount:_0x11eae3,currency:_0x3cb5ed}of _0x57b6d0){const _0x248890=await this['convertToUSDT'](_0x11eae3,_0x3cb5ed);_0x1bb95c+=_0x248890;}return _0x1bb95c;}async['getAllRates'](){const _0x20df3a=a49_0x5226c;try{const _0x562ef2=await database_1['default'][_0x20df3a(0xfa)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x5df0dc={'usdt':0x1};return _0x562ef2['forEach'](_0x17ccf3=>{const _0x3e8162=_0x20df3a;_0x5df0dc[_0x17ccf3[_0x3e8162(0xee)]]=_0x17ccf3[_0x3e8162(0x96)];}),_0x5df0dc;}catch(_0x1f3708){return console[_0x20df3a(0xdc)]('Error\x20getting\x20all\x20rates:',_0x1f3708),{'usdt':0x1};}}async[a49_0x5226c(0x87)](){const _0x316153=a49_0x5226c;try{const [_0x49bc80,_0x132567,_0x50b284]=await Promise['all']([database_1[_0x316153(0x8f)][_0x316153(0xfa)][_0x316153(0xd4)](),database_1[_0x316153(0x8f)][_0x316153(0xfa)]['findFirst']({'orderBy':{'updatedAt':_0x316153(0xa9)},'select':{'updatedAt':!![]}}),database_1[_0x316153(0x8f)][_0x316153(0xfa)]['findFirst']({'orderBy':{'updatedAt':_0x316153(0xf1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x49bc80,'lastUpdated':_0x132567?.['updatedAt']||null,'oldestRate':_0x50b284?.['updatedAt']||null,'markupPercentage':this[_0x316153(0xd7)]};}catch(_0x5a3be2){return console[_0x316153(0xdc)](_0x316153(0xf2),_0x5a3be2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x316153(0xd7)]};}}[a49_0x5226c(0xae)](){const _0x3e84c3=a49_0x5226c;return this[_0x3e84c3(0xd7)];}}exports[a49_0x5226c(0xcf)]=CurrencyService,exports['currencyService']=new CurrencyService();