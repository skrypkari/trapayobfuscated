'use strict';const a36_0x319d08=a36_0xd768;(function(_0x10b5f1,_0xadc77f){const _0x3d7e76=a36_0xd768,_0x24dbf5=_0x10b5f1();while(!![]){try{const _0x45233b=-parseInt(_0x3d7e76(0x14c))/0x1*(parseInt(_0x3d7e76(0x142))/0x2)+parseInt(_0x3d7e76(0x15a))/0x3+parseInt(_0x3d7e76(0x146))/0x4*(-parseInt(_0x3d7e76(0x112))/0x5)+parseInt(_0x3d7e76(0x14f))/0x6*(parseInt(_0x3d7e76(0x175))/0x7)+-parseInt(_0x3d7e76(0x118))/0x8*(parseInt(_0x3d7e76(0x104))/0x9)+-parseInt(_0x3d7e76(0x147))/0xa+parseInt(_0x3d7e76(0x12a))/0xb;if(_0x45233b===_0xadc77f)break;else _0x24dbf5['push'](_0x24dbf5['shift']());}catch(_0x4efe98){_0x24dbf5['push'](_0x24dbf5['shift']());}}}(a36_0x41a9,0x780e5));var __importDefault=this&&this['__importDefault']||function(_0x1df8ed){const _0x11add5=a36_0xd768;return _0x1df8ed&&_0x1df8ed[_0x11add5(0x13b)]?_0x1df8ed:{'default':_0x1df8ed};};function a36_0xd768(_0x422a78,_0x559388){const _0x41a9f9=a36_0x41a9();return a36_0xd768=function(_0xd7686e,_0x41b984){_0xd7686e=_0xd7686e-0x102;let _0x59e73f=_0x41a9f9[_0xd7686e];return _0x59e73f;},a36_0xd768(_0x422a78,_0x559388);}Object[a36_0x319d08(0x128)](exports,'__esModule',{'value':!![]}),exports[a36_0x319d08(0x108)]=exports[a36_0x319d08(0x162)]=void 0x0;function a36_0x41a9(){const _0x561c60=['🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','%\x20markup\x20=\x20','all','💱\x20Applied\x20','toFixed','cad','defineProperty','clp','15059671bCXhxZ','findUnique','📊\x20Received\x20rates\x20for\x20','dot','rate','currencyRate','thb','eos','catch','CURRENCIES','keys','vnd','dkk','uah','usdt','toLowerCase','kwd','__esModule','Error\x20getting\x20all\x20rates:','brl','json','statusText','updateCurrencyRates','ltc','18918JjWkCK','Failed\x20to\x20update\x20rate\x20for\x20','idr','getRatesStatus','4stKUHD','7973170hqBEGP','jpy','vef','default','inr','49yyTkJr','ils','\x20USDT\x20(rate:\x20','798MrAXOr','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','sar','findMany','ngn','sek','php','\x20USDT,\x20with\x20','log','findFirst','No\x20rate\x20found\x20for\x20currency:\x20','1247973ytJUbO','yfi','Error\x20getting\x20rates\x20status:',',\x20using\x201\x20as\x20fallback','lkr','pkr','eth','usd','CurrencyService','❌\x20Failed\x20to\x20update\x20currency\x20rates:','desc','try','Periodic\x20currency\x20rates\x20update\x20failed:','nzd','\x20USDT\x20=\x20','convertToUSDT','xdr','💱\x20Converted\x20','mxn','getCurrencyRate','Error\x20converting\x20','sats','sgd','xlm','asc','entries','CoinGecko\x20API\x20error:\x20','36547secVtq','czk','bch','currency','xag','gel','../config/database','tether','bmd','90gmkxuK','getAllRates','toUpperCase','startPeriodicUpdates','currencyService','updateInterval','hkd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','✅\x20Currency\x20rates\x20updated\x20successfully','\x20to\x20USDT:','zar','myr','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','updatedAt','1477790guqLNF','\x20currencies','stopPeriodicUpdates','%\x20markup\x20to\x20','bits','error','345064GIwvII','application/json','nok','COINGECKO_URL','?ids=tether&vs_currencies=','xrp','MARKUP_PERCENTAGE','aed','xau','huf'];a36_0x41a9=function(){return _0x561c60;};return a36_0x41a9();}const database_1=__importDefault(require(a36_0x319d08(0x17b)));class CurrencyService{constructor(){const _0x37359a=a36_0x319d08;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x37359a(0x133)]=['btc',_0x37359a(0x160),_0x37359a(0x141),_0x37359a(0x177),'bnb',_0x37359a(0x131),_0x37359a(0x11d),_0x37359a(0x171),'link',_0x37359a(0x12d),_0x37359a(0x15b),_0x37359a(0x161),_0x37359a(0x11f),'ars','aud','bdt','bhd',_0x37359a(0x103),_0x37359a(0x13d),_0x37359a(0x127),'chf',_0x37359a(0x129),'cny',_0x37359a(0x176),_0x37359a(0x136),'eur','gbp',_0x37359a(0x17a),_0x37359a(0x10a),_0x37359a(0x121),_0x37359a(0x144),_0x37359a(0x14d),_0x37359a(0x14b),_0x37359a(0x148),'krw',_0x37359a(0x13a),_0x37359a(0x15e),'mmk',_0x37359a(0x16c),_0x37359a(0x10f),_0x37359a(0x153),_0x37359a(0x11a),_0x37359a(0x167),_0x37359a(0x155),_0x37359a(0x15f),'pln','rub',_0x37359a(0x151),_0x37359a(0x154),_0x37359a(0x170),_0x37359a(0x130),_0x37359a(0x165),'twd',_0x37359a(0x137),_0x37359a(0x149),_0x37359a(0x135),_0x37359a(0x10e),_0x37359a(0x16a),_0x37359a(0x179),_0x37359a(0x120),_0x37359a(0x116),_0x37359a(0x16f)],this[_0x37359a(0x109)]=null,this[_0x37359a(0x11e)]=0x3,this[_0x37359a(0x107)]();}['startPeriodicUpdates'](){const _0x46acfe=a36_0x319d08;this[_0x46acfe(0x140)]()[_0x46acfe(0x132)](_0x49e71a=>{const _0x3215a5=_0x46acfe;console[_0x3215a5(0x117)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x49e71a);}),this['updateInterval']=setInterval(async()=>{const _0x392b9c=_0x46acfe;try{await this['updateCurrencyRates']();}catch(_0x329d55){console[_0x392b9c(0x117)](_0x392b9c(0x166),_0x329d55);}},0x3c*0x3c*0x3e8),console['log'](_0x46acfe(0x110));}[a36_0x319d08(0x114)](){const _0x11445c=a36_0x319d08;this['updateInterval']&&(clearInterval(this[_0x11445c(0x109)]),this[_0x11445c(0x109)]=null,console[_0x11445c(0x157)](_0x11445c(0x150)));}async[a36_0x319d08(0x140)](){const _0x557da9=a36_0x319d08;try{console['log'](_0x557da9(0x122));const _0x326536=this['CURRENCIES']['join'](','),_0x1b3bc3=this[_0x557da9(0x11b)]+_0x557da9(0x11c)+_0x326536,_0x3cca6f=await fetch(_0x1b3bc3,{'headers':{'Accept':_0x557da9(0x119),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x3cca6f['ok'])throw new Error(_0x557da9(0x174)+_0x3cca6f['status']+'\x20'+_0x3cca6f[_0x557da9(0x13f)]);const _0x84d56d=await _0x3cca6f[_0x557da9(0x13e)]();if(!_0x84d56d[_0x557da9(0x102)])throw new Error(_0x557da9(0x10b));const _0x45da48=_0x84d56d[_0x557da9(0x102)];console[_0x557da9(0x157)](_0x557da9(0x12c)+Object[_0x557da9(0x134)](_0x45da48)['length']+_0x557da9(0x113));const _0x5eb574=Object[_0x557da9(0x173)](_0x45da48)['map'](async([_0x297f07,_0x16f582])=>{const _0x47adee=_0x557da9;try{await database_1[_0x47adee(0x14a)][_0x47adee(0x12f)]['upsert']({'where':{'currency':_0x297f07[_0x47adee(0x139)]()},'update':{'rate':_0x16f582},'create':{'currency':_0x297f07['toLowerCase'](),'rate':_0x16f582}});}catch(_0x2b7e8b){console[_0x47adee(0x117)](_0x47adee(0x143)+_0x297f07+':',_0x2b7e8b);}});await Promise['allSettled'](_0x5eb574),console['log'](_0x557da9(0x10c));}catch(_0x479820){console[_0x557da9(0x117)](_0x557da9(0x163),_0x479820);throw _0x479820;}}async['getCurrencyRate'](_0x11c98f){const _0x516fa6=a36_0x319d08,_0x2b0b20=_0x11c98f[_0x516fa6(0x139)]();if(_0x2b0b20==='usdt')return 0x1;try{const _0x56f53a=await database_1[_0x516fa6(0x14a)][_0x516fa6(0x12f)][_0x516fa6(0x12b)]({'where':{'currency':_0x2b0b20}});if(!_0x56f53a)return console['warn'](_0x516fa6(0x159)+_0x11c98f+_0x516fa6(0x15d)),0x1;return _0x56f53a['rate'];}catch(_0x24906d){return console[_0x516fa6(0x117)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x11c98f+':',_0x24906d),0x1;}}async[a36_0x319d08(0x169)](_0x396383,_0x546ded){const _0x5814aa=a36_0x319d08,_0x3b6886=_0x546ded[_0x5814aa(0x139)]();if(_0x3b6886===_0x5814aa(0x138)){const _0x34902f=_0x396383*(0x1+this[_0x5814aa(0x11e)]/0x64);return console['log'](_0x5814aa(0x125)+this[_0x5814aa(0x11e)]+_0x5814aa(0x115)+_0x396383+_0x5814aa(0x168)+_0x34902f[_0x5814aa(0x126)](0x6)+'\x20USDT'),_0x34902f;}try{const _0x95a9dc=await this[_0x5814aa(0x16d)](_0x3b6886),_0x5a4d8c=_0x396383/_0x95a9dc,_0x43d33e=_0x5a4d8c*(0x1+this[_0x5814aa(0x11e)]/0x64);return console[_0x5814aa(0x157)](_0x5814aa(0x16b)+_0x396383+'\x20'+_0x546ded[_0x5814aa(0x106)]()+'\x20to\x20'+_0x5a4d8c[_0x5814aa(0x126)](0x6)+_0x5814aa(0x156)+this['MARKUP_PERCENTAGE']+_0x5814aa(0x123)+_0x43d33e[_0x5814aa(0x126)](0x6)+_0x5814aa(0x14e)+_0x95a9dc+')'),_0x43d33e;}catch(_0x1b8d26){console['error'](_0x5814aa(0x16e)+_0x396383+'\x20'+_0x546ded+_0x5814aa(0x10d),_0x1b8d26);const _0x3217c7=_0x396383*(0x1+this[_0x5814aa(0x11e)]/0x64);return _0x3217c7;}}async['convertMultipleToUSDT'](_0x5446ca){let _0x4c113c=0x0;for(const {amount:_0x45f3b4,currency:_0x61c9e7}of _0x5446ca){const _0x45de17=await this['convertToUSDT'](_0x45f3b4,_0x61c9e7);_0x4c113c+=_0x45de17;}return _0x4c113c;}async[a36_0x319d08(0x105)](){const _0x217a53=a36_0x319d08;try{const _0x144e22=await database_1[_0x217a53(0x14a)]['currencyRate'][_0x217a53(0x152)]({'select':{'currency':!![],'rate':!![]}}),_0x289a09={'usdt':0x1};return _0x144e22['forEach'](_0x336117=>{const _0x7de556=_0x217a53;_0x289a09[_0x336117[_0x7de556(0x178)]]=_0x336117[_0x7de556(0x12e)];}),_0x289a09;}catch(_0x2de5d4){return console[_0x217a53(0x117)](_0x217a53(0x13c),_0x2de5d4),{'usdt':0x1};}}async[a36_0x319d08(0x145)](){const _0x5d2802=a36_0x319d08;try{const [_0x3f971b,_0x31d274,_0x21aa57]=await Promise[_0x5d2802(0x124)]([database_1[_0x5d2802(0x14a)][_0x5d2802(0x12f)]['count'](),database_1[_0x5d2802(0x14a)][_0x5d2802(0x12f)]['findFirst']({'orderBy':{'updatedAt':_0x5d2802(0x164)},'select':{'updatedAt':!![]}}),database_1['default'][_0x5d2802(0x12f)][_0x5d2802(0x158)]({'orderBy':{'updatedAt':_0x5d2802(0x172)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f971b,'lastUpdated':_0x31d274?.[_0x5d2802(0x111)]||null,'oldestRate':_0x21aa57?.['updatedAt']||null,'markupPercentage':this[_0x5d2802(0x11e)]};}catch(_0x271a87){return console['error'](_0x5d2802(0x15c),_0x271a87),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5d2802(0x11e)]};}}['getMarkupPercentage'](){const _0x9343a4=a36_0x319d08;return this[_0x9343a4(0x11e)];}}exports['CurrencyService']=CurrencyService,exports[a36_0x319d08(0x108)]=new CurrencyService();