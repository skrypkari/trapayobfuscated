'use strict';const a39_0x2bdabd=a39_0x1612;function a39_0x1e9c(){const _0x25edce=['vnd','%\x20markup\x20=\x20','clp','Error\x20converting\x20','78GByhuz','warn','xlm','sats','sek','6ryVVoi','175ckcfBA','xau',',\x20using\x201\x20as\x20fallback','bdt','bits','Periodic\x20currency\x20rates\x20update\x20failed:','xag','findFirst','bhd','status','getRatesStatus','findMany','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','getCurrencyRate','\x20USDT\x20=\x20','forEach','myr','https://api.coingecko.com/api/v3/simple/price','350WykzLK','toFixed','convertMultipleToUSDT','link','kwd','usd','nok','convertToUSDT','vef','twd','\x20to\x20','\x20to\x20USDT:','xdr','currencyRate','bch','catch','mmk','sgd','ars','idr','huf','cad','entries','No\x20rate\x20found\x20for\x20currency:\x20','dot','findUnique','xrp','czk','defineProperty','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','php','8815NkaOZG','__importDefault','desc','count','8293ylJemE','allSettled','22pTEJRw','getMarkupPercentage','application/json','default','eur','CurrencyService','rate','asc','ngn','toUpperCase','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Initial\x20currency\x20rates\x20update\x20failed:','btc','25695SkGFBZ','thb','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','💱\x20Applied\x20','hkd','Error\x20getting\x20rate\x20for\x20currency\x20','toLowerCase','__esModule','Error\x20getting\x20rates\x20status:','Failed\x20to\x20update\x20rate\x20for\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','77TTKkFW','updateCurrencyRates','stopPeriodicUpdates','13832ASrsdX','282864PBIxxb','currency','eth','all','?ids=tether&vs_currencies=','9819927cCRXEI','pkr','updatedAt','rub','✅\x20Currency\x20rates\x20updated\x20successfully','\x20USDT\x20(rate:\x20','usdt','📊\x20Received\x20rates\x20for\x20','krw','316256aUAriS','💱\x20Converted\x20','inr','updateInterval','jpy','join','currencyService','error','startPeriodicUpdates','CURRENCIES','CoinGecko\x20API\x20error:\x20','log','length','\x20USDT','MARKUP_PERCENTAGE','nzd','getAllRates','pln','ils','../config/database'];a39_0x1e9c=function(){return _0x25edce;};return a39_0x1e9c();}(function(_0x28fbdd,_0x405679){const _0x174e83=a39_0x1612,_0x5830ea=_0x28fbdd();while(!![]){try{const _0x30898a=parseInt(_0x174e83(0x19b))/0x1*(-parseInt(_0x174e83(0x19d))/0x2)+parseInt(_0x174e83(0x165))/0x3*(-parseInt(_0x174e83(0x1c7))/0x4)+-parseInt(_0x174e83(0x197))/0x5*(parseInt(_0x174e83(0x160))/0x6)+-parseInt(_0x174e83(0x166))/0x7*(parseInt(_0x174e83(0x1b8))/0x8)+-parseInt(_0x174e83(0x1aa))/0x9*(parseInt(_0x174e83(0x178))/0xa)+-parseInt(_0x174e83(0x1b5))/0xb*(parseInt(_0x174e83(0x1b9))/0xc)+parseInt(_0x174e83(0x1be))/0xd;if(_0x30898a===_0x405679)break;else _0x5830ea['push'](_0x5830ea['shift']());}catch(_0x22d608){_0x5830ea['push'](_0x5830ea['shift']());}}}(a39_0x1e9c,0x2ab6b));function a39_0x1612(_0x3c61d0,_0x37bf20){const _0x1e9caa=a39_0x1e9c();return a39_0x1612=function(_0x161212,_0x382325){_0x161212=_0x161212-0x150;let _0x361aef=_0x1e9caa[_0x161212];return _0x361aef;},a39_0x1612(_0x3c61d0,_0x37bf20);}var __importDefault=this&&this[a39_0x2bdabd(0x198)]||function(_0x33c493){const _0x1cf296=a39_0x2bdabd;return _0x33c493&&_0x33c493[_0x1cf296(0x1b1)]?_0x33c493:{'default':_0x33c493};};Object[a39_0x2bdabd(0x194)](exports,a39_0x2bdabd(0x1b1),{'value':!![]}),exports[a39_0x2bdabd(0x1cd)]=exports[a39_0x2bdabd(0x1a2)]=void 0x0;const database_1=__importDefault(require(a39_0x2bdabd(0x15b)));class CurrencyService{constructor(){const _0x29e86b=a39_0x2bdabd;this['COINGECKO_URL']=_0x29e86b(0x177),this[_0x29e86b(0x151)]=[_0x29e86b(0x1a9),_0x29e86b(0x1bb),'ltc',_0x29e86b(0x186),'bnb','eos',_0x29e86b(0x192),_0x29e86b(0x162),_0x29e86b(0x17b),_0x29e86b(0x190),'yfi',_0x29e86b(0x17d),'aed',_0x29e86b(0x18a),'aud',_0x29e86b(0x169),_0x29e86b(0x16e),'bmd','brl',_0x29e86b(0x18d),'chf',_0x29e86b(0x15e),'cny',_0x29e86b(0x193),'dkk',_0x29e86b(0x1a1),'gbp','gel',_0x29e86b(0x1ae),_0x29e86b(0x18c),_0x29e86b(0x18b),_0x29e86b(0x15a),_0x29e86b(0x1c9),_0x29e86b(0x1cb),_0x29e86b(0x1c6),_0x29e86b(0x17c),'lkr',_0x29e86b(0x188),'mxn',_0x29e86b(0x176),_0x29e86b(0x1a5),_0x29e86b(0x17e),_0x29e86b(0x157),_0x29e86b(0x196),_0x29e86b(0x1bf),_0x29e86b(0x159),_0x29e86b(0x1c1),'sar',_0x29e86b(0x164),_0x29e86b(0x189),_0x29e86b(0x1ab),'try',_0x29e86b(0x181),'uah',_0x29e86b(0x180),_0x29e86b(0x15c),'zar',_0x29e86b(0x184),_0x29e86b(0x16c),_0x29e86b(0x167),_0x29e86b(0x16a),_0x29e86b(0x163)],this[_0x29e86b(0x1ca)]=null,this[_0x29e86b(0x156)]=-0x3,this[_0x29e86b(0x150)]();}[a39_0x2bdabd(0x150)](){const _0x54d8e2=a39_0x2bdabd;this['updateCurrencyRates']()[_0x54d8e2(0x187)](_0x2b624d=>{const _0x39aaff=_0x54d8e2;console['error'](_0x39aaff(0x1a8),_0x2b624d);}),this[_0x54d8e2(0x1ca)]=setInterval(async()=>{const _0x368dc5=_0x54d8e2;try{await this[_0x368dc5(0x1b6)]();}catch(_0x3e31e7){console[_0x368dc5(0x1ce)](_0x368dc5(0x16b),_0x3e31e7);}},0x3c*0x3c*0x3e8),console[_0x54d8e2(0x153)](_0x54d8e2(0x1a7));}[a39_0x2bdabd(0x1b7)](){const _0x23523b=a39_0x2bdabd;this[_0x23523b(0x1ca)]&&(clearInterval(this[_0x23523b(0x1ca)]),this[_0x23523b(0x1ca)]=null,console[_0x23523b(0x153)](_0x23523b(0x1ac)));}async[a39_0x2bdabd(0x1b6)](){const _0x2ab890=a39_0x2bdabd;try{console[_0x2ab890(0x153)](_0x2ab890(0x195));const _0x1a7e35=this['CURRENCIES'][_0x2ab890(0x1cc)](','),_0x577b78=this['COINGECKO_URL']+_0x2ab890(0x1bd)+_0x1a7e35,_0xe09906=await fetch(_0x577b78,{'headers':{'Accept':_0x2ab890(0x19f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0xe09906['ok'])throw new Error(_0x2ab890(0x152)+_0xe09906[_0x2ab890(0x16f)]+'\x20'+_0xe09906['statusText']);const _0x3efaee=await _0xe09906['json']();if(!_0x3efaee['tether'])throw new Error(_0x2ab890(0x172));const _0x3a3ab4=_0x3efaee['tether'];console[_0x2ab890(0x153)](_0x2ab890(0x1c5)+Object['keys'](_0x3a3ab4)[_0x2ab890(0x154)]+'\x20currencies');const _0x5f0852=Object[_0x2ab890(0x18e)](_0x3a3ab4)['map'](async([_0x509709,_0x106131])=>{const _0x2c2062=_0x2ab890;try{await database_1[_0x2c2062(0x1a0)][_0x2c2062(0x185)]['upsert']({'where':{'currency':_0x509709[_0x2c2062(0x1b0)]()},'update':{'rate':_0x106131},'create':{'currency':_0x509709[_0x2c2062(0x1b0)](),'rate':_0x106131}});}catch(_0x5c239d){console[_0x2c2062(0x1ce)](_0x2c2062(0x1b3)+_0x509709+':',_0x5c239d);}});await Promise[_0x2ab890(0x19c)](_0x5f0852),console[_0x2ab890(0x153)](_0x2ab890(0x1c2));}catch(_0x22c6fc){console[_0x2ab890(0x1ce)](_0x2ab890(0x1b4),_0x22c6fc);throw _0x22c6fc;}}async[a39_0x2bdabd(0x173)](_0x415d1d){const _0x525568=a39_0x2bdabd,_0x22dba0=_0x415d1d[_0x525568(0x1b0)]();if(_0x22dba0===_0x525568(0x1c4))return 0x1;try{const _0x3938e7=await database_1[_0x525568(0x1a0)][_0x525568(0x185)][_0x525568(0x191)]({'where':{'currency':_0x22dba0}});if(!_0x3938e7)return console[_0x525568(0x161)](_0x525568(0x18f)+_0x415d1d+_0x525568(0x168)),0x1;return _0x3938e7[_0x525568(0x1a3)];}catch(_0x41e28d){return console[_0x525568(0x1ce)](_0x525568(0x1af)+_0x415d1d+':',_0x41e28d),0x1;}}async[a39_0x2bdabd(0x17f)](_0xeef0f1,_0x888a69){const _0xc4399e=a39_0x2bdabd,_0x1674d1=_0x888a69['toLowerCase']();if(_0x1674d1==='usdt'){const _0x305880=_0xeef0f1*(0x1+this[_0xc4399e(0x156)]/0x64);return console[_0xc4399e(0x153)](_0xc4399e(0x1ad)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0xeef0f1+_0xc4399e(0x174)+_0x305880['toFixed'](0x6)+_0xc4399e(0x155)),_0x305880;}try{const _0x3947fc=await this[_0xc4399e(0x173)](_0x1674d1),_0x419372=_0xeef0f1/_0x3947fc,_0x355e7d=_0x419372*(0x1+this[_0xc4399e(0x156)]/0x64);return console['log'](_0xc4399e(0x1c8)+_0xeef0f1+'\x20'+_0x888a69[_0xc4399e(0x1a6)]()+_0xc4399e(0x182)+_0x419372['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0xc4399e(0x15d)+_0x355e7d[_0xc4399e(0x179)](0x6)+_0xc4399e(0x1c3)+_0x3947fc+')'),_0x355e7d;}catch(_0x367ffd){console['error'](_0xc4399e(0x15f)+_0xeef0f1+'\x20'+_0x888a69+_0xc4399e(0x183),_0x367ffd);const _0x45f4cf=_0xeef0f1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x45f4cf;}}async[a39_0x2bdabd(0x17a)](_0x303615){let _0x3725bf=0x0;for(const {amount:_0x220607,currency:_0x4add25}of _0x303615){const _0xc68bf4=await this['convertToUSDT'](_0x220607,_0x4add25);_0x3725bf+=_0xc68bf4;}return _0x3725bf;}async[a39_0x2bdabd(0x158)](){const _0x548b71=a39_0x2bdabd;try{const _0x54c3b2=await database_1[_0x548b71(0x1a0)][_0x548b71(0x185)][_0x548b71(0x171)]({'select':{'currency':!![],'rate':!![]}}),_0x48caf5={'usdt':0x1};return _0x54c3b2[_0x548b71(0x175)](_0x483806=>{const _0x18c20f=_0x548b71;_0x48caf5[_0x483806[_0x18c20f(0x1ba)]]=_0x483806[_0x18c20f(0x1a3)];}),_0x48caf5;}catch(_0x214331){return console[_0x548b71(0x1ce)]('Error\x20getting\x20all\x20rates:',_0x214331),{'usdt':0x1};}}async[a39_0x2bdabd(0x170)](){const _0x5b5321=a39_0x2bdabd;try{const [_0x3dbb11,_0x2040f9,_0x1dfc13]=await Promise[_0x5b5321(0x1bc)]([database_1[_0x5b5321(0x1a0)][_0x5b5321(0x185)][_0x5b5321(0x19a)](),database_1[_0x5b5321(0x1a0)][_0x5b5321(0x185)][_0x5b5321(0x16d)]({'orderBy':{'updatedAt':_0x5b5321(0x199)},'select':{'updatedAt':!![]}}),database_1[_0x5b5321(0x1a0)]['currencyRate'][_0x5b5321(0x16d)]({'orderBy':{'updatedAt':_0x5b5321(0x1a4)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3dbb11,'lastUpdated':_0x2040f9?.['updatedAt']||null,'oldestRate':_0x1dfc13?.[_0x5b5321(0x1c0)]||null,'markupPercentage':this[_0x5b5321(0x156)]};}catch(_0x4bdb83){return console[_0x5b5321(0x1ce)](_0x5b5321(0x1b2),_0x4bdb83),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5b5321(0x156)]};}}[a39_0x2bdabd(0x19e)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();