'use strict';const a38_0x1b8b1a=a38_0x333d;(function(_0x385b2f,_0x9935a7){const _0x4fa1a7=a38_0x333d,_0x288581=_0x385b2f();while(!![]){try{const _0x205c18=-parseInt(_0x4fa1a7(0x17e))/0x1+parseInt(_0x4fa1a7(0x122))/0x2+parseInt(_0x4fa1a7(0x107))/0x3*(-parseInt(_0x4fa1a7(0x167))/0x4)+-parseInt(_0x4fa1a7(0x146))/0x5*(parseInt(_0x4fa1a7(0x12c))/0x6)+parseInt(_0x4fa1a7(0x11a))/0x7*(parseInt(_0x4fa1a7(0x16d))/0x8)+-parseInt(_0x4fa1a7(0x10d))/0x9*(-parseInt(_0x4fa1a7(0x14f))/0xa)+parseInt(_0x4fa1a7(0x176))/0xb*(-parseInt(_0x4fa1a7(0x111))/0xc);if(_0x205c18===_0x9935a7)break;else _0x288581['push'](_0x288581['shift']());}catch(_0x4c157c){_0x288581['push'](_0x288581['shift']());}}}(a38_0x10d3,0x3b751));function a38_0x333d(_0x582469,_0x417bf4){const _0x10d3d9=a38_0x10d3();return a38_0x333d=function(_0x333d54,_0x105b5c){_0x333d54=_0x333d54-0xfd;let _0x46a050=_0x10d3d9[_0x333d54];return _0x46a050;},a38_0x333d(_0x582469,_0x417bf4);}var __importDefault=this&&this[a38_0x1b8b1a(0x138)]||function(_0x3ab697){const _0x3b9ffc=a38_0x1b8b1a;return _0x3ab697&&_0x3ab697[_0x3b9ffc(0x161)]?_0x3ab697:{'default':_0x3ab697};};Object[a38_0x1b8b1a(0x11f)](exports,a38_0x1b8b1a(0x161),{'value':!![]}),exports[a38_0x1b8b1a(0x173)]=exports[a38_0x1b8b1a(0x149)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x504174=a38_0x1b8b1a;this[_0x504174(0x15a)]=_0x504174(0x116),this['CURRENCIES']=[_0x504174(0x10c),_0x504174(0x105),_0x504174(0x178),'bch',_0x504174(0x103),_0x504174(0x16b),_0x504174(0x132),_0x504174(0x11c),_0x504174(0x157),_0x504174(0x145),_0x504174(0x169),_0x504174(0x13f),_0x504174(0x15d),_0x504174(0x14c),'aud',_0x504174(0x179),_0x504174(0x139),_0x504174(0x151),'brl',_0x504174(0x135),_0x504174(0x117),_0x504174(0x134),_0x504174(0x109),_0x504174(0x141),_0x504174(0x171),_0x504174(0x11e),'gbp',_0x504174(0x174),_0x504174(0x17b),_0x504174(0x108),_0x504174(0x10a),_0x504174(0x106),'inr',_0x504174(0x15e),_0x504174(0x113),_0x504174(0x130),'lkr',_0x504174(0x137),_0x504174(0xff),_0x504174(0x165),_0x504174(0x163),_0x504174(0x13a),'nzd',_0x504174(0x129),'pkr',_0x504174(0x112),_0x504174(0x15f),'sar',_0x504174(0x110),_0x504174(0x142),_0x504174(0x10f),_0x504174(0x123),_0x504174(0x118),_0x504174(0x170),'vef',_0x504174(0x154),'zar',_0x504174(0x177),_0x504174(0x13e),_0x504174(0xfd),'bits',_0x504174(0x144)],this[_0x504174(0x101)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x504174(0x114)]();}[a38_0x1b8b1a(0x114)](){const _0x464397=a38_0x1b8b1a;this['updateCurrencyRates']()[_0x464397(0x17c)](_0x3025b8=>{const _0x46eecb=_0x464397;console[_0x46eecb(0x156)](_0x46eecb(0x128),_0x3025b8);}),this['updateInterval']=setInterval(async()=>{const _0x437a1a=_0x464397;try{await this['updateCurrencyRates']();}catch(_0x100856){console['error'](_0x437a1a(0x140),_0x100856);}},0x3c*0x3c*0x3e8),console['log'](_0x464397(0x143));}[a38_0x1b8b1a(0x12f)](){const _0x52f0ba=a38_0x1b8b1a;this[_0x52f0ba(0x101)]&&(clearInterval(this[_0x52f0ba(0x101)]),this[_0x52f0ba(0x101)]=null,console[_0x52f0ba(0x17f)](_0x52f0ba(0x13b)));}async['updateCurrencyRates'](){const _0x3495ad=a38_0x1b8b1a;try{console[_0x3495ad(0x17f)](_0x3495ad(0x131));const _0x5729d9=this[_0x3495ad(0x126)][_0x3495ad(0x10e)](','),_0x46e773=this[_0x3495ad(0x15a)]+_0x3495ad(0x14b)+_0x5729d9,_0x58e89e=await fetch(_0x46e773,{'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x58e89e['ok'])throw new Error(_0x3495ad(0x11b)+_0x58e89e[_0x3495ad(0x147)]+'\x20'+_0x58e89e[_0x3495ad(0x14e)]);const _0x22ce82=await _0x58e89e[_0x3495ad(0x164)]();if(!_0x22ce82[_0x3495ad(0x100)])throw new Error(_0x3495ad(0x121));const _0x530ad3=_0x22ce82[_0x3495ad(0x100)];console[_0x3495ad(0x17f)](_0x3495ad(0xfe)+Object[_0x3495ad(0x16f)](_0x530ad3)[_0x3495ad(0x11d)]+_0x3495ad(0x158));const _0x41836d=Object['entries'](_0x530ad3)[_0x3495ad(0x15b)](async([_0x5167a3,_0x4da47a])=>{const _0x28a6c5=_0x3495ad;try{await database_1['default'][_0x28a6c5(0x166)][_0x28a6c5(0x160)]({'where':{'currency':_0x5167a3[_0x28a6c5(0x155)]()},'update':{'rate':_0x4da47a},'create':{'currency':_0x5167a3[_0x28a6c5(0x155)](),'rate':_0x4da47a}});}catch(_0x5e31e3){console['error'](_0x28a6c5(0x13d)+_0x5167a3+':',_0x5e31e3);}});await Promise[_0x3495ad(0x104)](_0x41836d),console[_0x3495ad(0x17f)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4fa341){console[_0x3495ad(0x156)](_0x3495ad(0x14a),_0x4fa341);throw _0x4fa341;}}async[a38_0x1b8b1a(0x148)](_0x3f1284){const _0x2d645b=a38_0x1b8b1a,_0x3f1a5e=_0x3f1284['toLowerCase']();if(_0x3f1a5e===_0x2d645b(0x115))return 0x1;try{const _0x4501e9=await database_1[_0x2d645b(0x16c)][_0x2d645b(0x166)][_0x2d645b(0x133)]({'where':{'currency':_0x3f1a5e}});if(!_0x4501e9)return console[_0x2d645b(0x16a)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x3f1284+_0x2d645b(0x17a)),0x1;return _0x4501e9['rate'];}catch(_0x4f5c6e){return console[_0x2d645b(0x156)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x3f1284+':',_0x4f5c6e),0x1;}}async['convertToUSDT'](_0x4d3aa0,_0x516a3d){const _0x492839=a38_0x1b8b1a,_0x5bd76e=_0x516a3d['toLowerCase']();if(_0x5bd76e===_0x492839(0x115)){const _0x194c89=_0x4d3aa0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x492839(0x17f)]('üí±\x20Applied\x20'+this[_0x492839(0x17d)]+_0x492839(0x12d)+_0x4d3aa0+_0x492839(0x13c)+_0x194c89['toFixed'](0x6)+_0x492839(0x102)),_0x194c89;}try{const _0x224335=await this['getCurrencyRate'](_0x5bd76e),_0xffac1=_0x4d3aa0/_0x224335,_0x512608=_0xffac1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x492839(0x17f)]('üí±\x20Converted\x20'+_0x4d3aa0+'\x20'+_0x516a3d[_0x492839(0x159)]()+'\x20to\x20'+_0xffac1[_0x492839(0x15c)](0x6)+_0x492839(0x119)+this[_0x492839(0x17d)]+_0x492839(0x12a)+_0x512608[_0x492839(0x15c)](0x6)+_0x492839(0x12b)+_0x224335+')'),_0x512608;}catch(_0x2fa296){console[_0x492839(0x156)](_0x492839(0x125)+_0x4d3aa0+'\x20'+_0x516a3d+_0x492839(0x12e),_0x2fa296);const _0x59c272=_0x4d3aa0*(0x1+this[_0x492839(0x17d)]/0x64);return _0x59c272;}}async['convertMultipleToUSDT'](_0x4c541c){const _0x52a2c2=a38_0x1b8b1a;let _0x277b4f=0x0;for(const {amount:_0x2c35c0,currency:_0x5628b7}of _0x4c541c){const _0x3a8b73=await this[_0x52a2c2(0x136)](_0x2c35c0,_0x5628b7);_0x277b4f+=_0x3a8b73;}return _0x277b4f;}async[a38_0x1b8b1a(0x124)](){const _0xdbbe44=a38_0x1b8b1a;try{const _0xb712ff=await database_1[_0xdbbe44(0x16c)][_0xdbbe44(0x166)][_0xdbbe44(0x150)]({'select':{'currency':!![],'rate':!![]}}),_0x4b6c46={'usdt':0x1};return _0xb712ff['forEach'](_0x260257=>{const _0x19415d=_0xdbbe44;_0x4b6c46[_0x260257[_0x19415d(0x162)]]=_0x260257[_0x19415d(0x16e)];}),_0x4b6c46;}catch(_0x5b1bf9){return console['error'](_0xdbbe44(0x153),_0x5b1bf9),{'usdt':0x1};}}async[a38_0x1b8b1a(0x127)](){const _0x2b139b=a38_0x1b8b1a;try{const [_0x31da9d,_0x4689a3,_0x339748]=await Promise[_0x2b139b(0x120)]([database_1['default'][_0x2b139b(0x166)][_0x2b139b(0x168)](),database_1[_0x2b139b(0x16c)][_0x2b139b(0x166)]['findFirst']({'orderBy':{'updatedAt':_0x2b139b(0x152)},'select':{'updatedAt':!![]}}),database_1[_0x2b139b(0x16c)][_0x2b139b(0x166)][_0x2b139b(0x14d)]({'orderBy':{'updatedAt':_0x2b139b(0x10b)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x31da9d,'lastUpdated':_0x4689a3?.['updatedAt']||null,'oldestRate':_0x339748?.[_0x2b139b(0x172)]||null,'markupPercentage':this[_0x2b139b(0x17d)]};}catch(_0x20ca13){return console[_0x2b139b(0x156)](_0x2b139b(0x175),_0x20ca13),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2b139b(0x17d)]};}}['getMarkupPercentage'](){const _0x58e309=a38_0x1b8b1a;return this[_0x58e309(0x17d)];}}function a38_0x10d3(){const _0x12518e=['catch','MARKUP_PERCENTAGE','46811lmpgHk','log','xau','üìä\x20Received\x20rates\x20for\x20','mxn','tether','updateInterval','\x20USDT','bnb','allSettled','eth','ils','220479aNsChE','huf','cny','idr','asc','btc','1503UDQSzp','join','thb','sek','12jPrBrP','pln','krw','startPeriodicUpdates','usdt','https://api.coingecko.com/api/v3/simple/price','chf','twd','\x20USDT,\x20with\x20','19621oxpInH','CoinGecko\x20API\x20error:\x20','xlm','length','eur','defineProperty','all','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','866816dtofQa','try','getAllRates','Error\x20converting\x20','CURRENCIES','getRatesStatus','Initial\x20currency\x20rates\x20update\x20failed:','php','%\x20markup\x20=\x20','\x20USDT\x20(rate:\x20','6mGIbta','%\x20markup\x20to\x20','\x20to\x20USDT:','stopPeriodicUpdates','kwd','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','xrp','findUnique','clp','cad','convertToUSDT','mmk','__importDefault','bhd','nok','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','\x20USDT\x20=\x20','Failed\x20to\x20update\x20rate\x20for\x20','xag','usd','Periodic\x20currency\x20rates\x20update\x20failed:','czk','sgd','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','sats','dot','1487935RdJnUj','status','getCurrencyRate','CurrencyService','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','?ids=tether&vs_currencies=','ars','findFirst','statusText','25910MDdkNr','findMany','bmd','desc','Error\x20getting\x20all\x20rates:','vnd','toLowerCase','error','link','\x20currencies','toUpperCase','COINGECKO_URL','map','toFixed','aed','jpy','rub','upsert','__esModule','currency','ngn','json','myr','currencyRate','8SjeosQ','count','yfi','warn','eos','default','8XTAGkW','rate','keys','uah','dkk','updatedAt','currencyService','gel','Error\x20getting\x20rates\x20status:','1473857ycDQCw','xdr','ltc','bdt',',\x20using\x201\x20as\x20fallback','hkd'];a38_0x10d3=function(){return _0x12518e;};return a38_0x10d3();}exports['CurrencyService']=CurrencyService,exports[a38_0x1b8b1a(0x173)]=new CurrencyService();