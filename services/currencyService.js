'use strict';const a38_0x164bb5=a38_0x3f83;(function(_0x161584,_0xb6329c){const _0x2bd937=a38_0x3f83,_0x39283b=_0x161584();while(!![]){try{const _0xa5a997=-parseInt(_0x2bd937(0x14f))/0x1*(-parseInt(_0x2bd937(0xeb))/0x2)+-parseInt(_0x2bd937(0x142))/0x3+-parseInt(_0x2bd937(0xf1))/0x4+-parseInt(_0x2bd937(0xf3))/0x5+parseInt(_0x2bd937(0x118))/0x6*(-parseInt(_0x2bd937(0x10b))/0x7)+-parseInt(_0x2bd937(0x12f))/0x8*(parseInt(_0x2bd937(0xea))/0x9)+-parseInt(_0x2bd937(0x127))/0xa*(-parseInt(_0x2bd937(0xfc))/0xb);if(_0xa5a997===_0xb6329c)break;else _0x39283b['push'](_0x39283b['shift']());}catch(_0x31e3ff){_0x39283b['push'](_0x39283b['shift']());}}}(a38_0x5705,0xc813b));function a38_0x5705(){const _0x4efc3e=['getAllRates','No\x20rate\x20found\x20for\x20currency:\x20','pln','chf','error','1208254OmroDi','pkr','MARKUP_PERCENTAGE','startPeriodicUpdates','entries','nok','try','eur','toFixed','✅\x20Currency\x20rates\x20updated\x20successfully','join','💱\x20Converted\x20','CoinGecko\x20API\x20error:\x20','convertMultipleToUSDT','CurrencyService','COINGECKO_URL','kwd','findMany','updateInterval','vef','eth','Initial\x20currency\x20rates\x20update\x20failed:','sek','ars','currencyRate','gbp','bits','findFirst','btc','defineProperty','currencyService','9azuBDc','2ERJrTv','mxn','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','💱\x20Applied\x20','aed','krw','3162824JZXYMX','mmk','1466010hKSwKc','xag','bmd','count','usdt','lkr','rub','getRatesStatus','TesSoft\x20Payment\x20System/1.0','77EufHUN','https://api.coingecko.com/api/v3/simple/price','CURRENCIES','tether','link','application/json','cad','keys','rate','ngn','bnb','length','\x20USDT\x20(rate:\x20','bhd','__importDefault','13181ZFTkGu','updatedAt','allSettled','dot','map','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Failed\x20to\x20update\x20rate\x20for\x20','jpy','Error\x20getting\x20rates\x20status:','%\x20markup\x20=\x20','xdr','sats','brl','4218feCveN','\x20currencies','Error\x20converting\x20','cny','statusText','myr','xrp','desc','bch','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','❌\x20Failed\x20to\x20update\x20currency\x20rates:','thb','findUnique','warn','\x20USDT\x20=\x20','6301910uCkVck','vnd','hkd','\x20to\x20','uah','eos','json','getCurrencyRate','8796880ndNfqE','sar','\x20USDT','\x20to\x20USDT:','status','xau','?ids=tether&vs_currencies=','log','toLowerCase','Periodic\x20currency\x20rates\x20update\x20failed:','xlm','default','../config/database','catch','upsert','%\x20markup\x20to\x20','__esModule','clp','Error\x20getting\x20all\x20rates:','3878427CYYPSG','nzd','\x20USDT,\x20with\x20','twd','zar','toUpperCase','inr','ils'];a38_0x5705=function(){return _0x4efc3e;};return a38_0x5705();}var __importDefault=this&&this[a38_0x164bb5(0x10a)]||function(_0x461e72){const _0x5e526b=a38_0x164bb5;return _0x461e72&&_0x461e72[_0x5e526b(0x13f)]?_0x461e72:{'default':_0x461e72};};Object[a38_0x164bb5(0x16c)](exports,'__esModule',{'value':!![]}),exports[a38_0x164bb5(0xe9)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x164bb5(0x13b)));class CurrencyService{constructor(){const _0x4209e3=a38_0x164bb5;this[_0x4209e3(0x15e)]=_0x4209e3(0xfd),this[_0x4209e3(0xfe)]=[_0x4209e3(0x16b),_0x4209e3(0x163),'ltc',_0x4209e3(0x120),_0x4209e3(0x106),_0x4209e3(0x12c),_0x4209e3(0x11e),_0x4209e3(0x139),_0x4209e3(0x100),_0x4209e3(0x10e),'yfi','usd',_0x4209e3(0xef),_0x4209e3(0x166),'aud','bdt',_0x4209e3(0x109),_0x4209e3(0xf5),_0x4209e3(0x117),_0x4209e3(0x102),_0x4209e3(0x14d),_0x4209e3(0x140),_0x4209e3(0x11b),'czk','dkk',_0x4209e3(0x156),_0x4209e3(0x168),'gel',_0x4209e3(0x129),'huf','idr',_0x4209e3(0x149),_0x4209e3(0x148),_0x4209e3(0x112),_0x4209e3(0xf0),_0x4209e3(0x15f),_0x4209e3(0xf8),_0x4209e3(0xf2),_0x4209e3(0xec),_0x4209e3(0x11d),_0x4209e3(0x105),_0x4209e3(0x154),_0x4209e3(0x143),'php',_0x4209e3(0x150),_0x4209e3(0x14c),_0x4209e3(0xf9),_0x4209e3(0x130),_0x4209e3(0x165),'sgd',_0x4209e3(0x123),_0x4209e3(0x155),_0x4209e3(0x145),_0x4209e3(0x12b),_0x4209e3(0x162),_0x4209e3(0x128),_0x4209e3(0x146),_0x4209e3(0x115),_0x4209e3(0xf4),_0x4209e3(0x134),_0x4209e3(0x169),_0x4209e3(0x116)],this[_0x4209e3(0x161)]=null,this[_0x4209e3(0x151)]=0x3,this[_0x4209e3(0x152)]();}['startPeriodicUpdates'](){const _0x43cb70=a38_0x164bb5;this['updateCurrencyRates']()[_0x43cb70(0x13c)](_0x88a7d1=>{const _0x42198e=_0x43cb70;console['error'](_0x42198e(0x164),_0x88a7d1);}),this['updateInterval']=setInterval(async()=>{const _0x1d667b=_0x43cb70;try{await this['updateCurrencyRates']();}catch(_0x6ce138){console[_0x1d667b(0x14e)](_0x1d667b(0x138),_0x6ce138);}},0x3c*0x3c*0x3e8),console[_0x43cb70(0x136)](_0x43cb70(0x110));}['stopPeriodicUpdates'](){const _0x520f5e=a38_0x164bb5;this[_0x520f5e(0x161)]&&(clearInterval(this['updateInterval']),this[_0x520f5e(0x161)]=null,console[_0x520f5e(0x136)](_0x520f5e(0x121)));}async['updateCurrencyRates'](){const _0x2cce06=a38_0x164bb5;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x7e7d03=this[_0x2cce06(0xfe)][_0x2cce06(0x159)](','),_0x19196b=this[_0x2cce06(0x15e)]+_0x2cce06(0x135)+_0x7e7d03,_0x899955=await fetch(_0x19196b,{'headers':{'Accept':_0x2cce06(0x101),'User-Agent':_0x2cce06(0xfb)}});if(!_0x899955['ok'])throw new Error(_0x2cce06(0x15b)+_0x899955[_0x2cce06(0x133)]+'\x20'+_0x899955[_0x2cce06(0x11c)]);const _0x1ec6fc=await _0x899955[_0x2cce06(0x12d)]();if(!_0x1ec6fc['tether'])throw new Error(_0x2cce06(0xed));const _0x1b114c=_0x1ec6fc[_0x2cce06(0xff)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x2cce06(0x103)](_0x1b114c)[_0x2cce06(0x107)]+_0x2cce06(0x119));const _0x1c0846=Object[_0x2cce06(0x153)](_0x1b114c)[_0x2cce06(0x10f)](async([_0x15d04a,_0x441dfe])=>{const _0x2ea580=_0x2cce06;try{await database_1['default'][_0x2ea580(0x167)][_0x2ea580(0x13d)]({'where':{'currency':_0x15d04a[_0x2ea580(0x137)]()},'update':{'rate':_0x441dfe},'create':{'currency':_0x15d04a[_0x2ea580(0x137)](),'rate':_0x441dfe}});}catch(_0x17ffd6){console[_0x2ea580(0x14e)](_0x2ea580(0x111)+_0x15d04a+':',_0x17ffd6);}});await Promise[_0x2cce06(0x10d)](_0x1c0846),console[_0x2cce06(0x136)](_0x2cce06(0x158));}catch(_0x2c5fb7){console[_0x2cce06(0x14e)](_0x2cce06(0x122),_0x2c5fb7);throw _0x2c5fb7;}}async[a38_0x164bb5(0x12e)](_0x1db721){const _0x36bc01=a38_0x164bb5,_0x3ce4a3=_0x1db721[_0x36bc01(0x137)]();if(_0x3ce4a3===_0x36bc01(0xf7))return 0x1;try{const _0x2d518b=await database_1[_0x36bc01(0x13a)][_0x36bc01(0x167)][_0x36bc01(0x124)]({'where':{'currency':_0x3ce4a3}});if(!_0x2d518b)return console[_0x36bc01(0x125)](_0x36bc01(0x14b)+_0x1db721+',\x20using\x201\x20as\x20fallback'),0x1;return _0x2d518b['rate'];}catch(_0x3664b7){return console[_0x36bc01(0x14e)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1db721+':',_0x3664b7),0x1;}}async['convertToUSDT'](_0x574b59,_0xbbd12e){const _0x3b2fc8=a38_0x164bb5,_0x378826=_0xbbd12e[_0x3b2fc8(0x137)]();if(_0x378826==='usdt'){const _0x1d9788=_0x574b59*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x3b2fc8(0xee)+this[_0x3b2fc8(0x151)]+_0x3b2fc8(0x13e)+_0x574b59+_0x3b2fc8(0x126)+_0x1d9788[_0x3b2fc8(0x157)](0x6)+_0x3b2fc8(0x131)),_0x1d9788;}try{const _0x120d00=await this[_0x3b2fc8(0x12e)](_0x378826),_0x5d4142=_0x574b59/_0x120d00,_0x154f06=_0x5d4142*(0x1+this[_0x3b2fc8(0x151)]/0x64);return console['log'](_0x3b2fc8(0x15a)+_0x574b59+'\x20'+_0xbbd12e[_0x3b2fc8(0x147)]()+_0x3b2fc8(0x12a)+_0x5d4142[_0x3b2fc8(0x157)](0x6)+_0x3b2fc8(0x144)+this[_0x3b2fc8(0x151)]+_0x3b2fc8(0x114)+_0x154f06[_0x3b2fc8(0x157)](0x6)+_0x3b2fc8(0x108)+_0x120d00+')'),_0x154f06;}catch(_0x412cf1){console[_0x3b2fc8(0x14e)](_0x3b2fc8(0x11a)+_0x574b59+'\x20'+_0xbbd12e+_0x3b2fc8(0x132),_0x412cf1);const _0x20cffa=_0x574b59*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x20cffa;}}async[a38_0x164bb5(0x15c)](_0x1a77ef){let _0xf49b03=0x0;for(const {amount:_0x248f1a,currency:_0xce6b2b}of _0x1a77ef){const _0x2f751a=await this['convertToUSDT'](_0x248f1a,_0xce6b2b);_0xf49b03+=_0x2f751a;}return _0xf49b03;}async[a38_0x164bb5(0x14a)](){const _0x2fd4b3=a38_0x164bb5;try{const _0xbcb0c1=await database_1[_0x2fd4b3(0x13a)][_0x2fd4b3(0x167)][_0x2fd4b3(0x160)]({'select':{'currency':!![],'rate':!![]}}),_0x2266bf={'usdt':0x1};return _0xbcb0c1['forEach'](_0x44f8eb=>{const _0x25ba75=_0x2fd4b3;_0x2266bf[_0x44f8eb['currency']]=_0x44f8eb[_0x25ba75(0x104)];}),_0x2266bf;}catch(_0x553e93){return console['error'](_0x2fd4b3(0x141),_0x553e93),{'usdt':0x1};}}async[a38_0x164bb5(0xfa)](){const _0x4d4d60=a38_0x164bb5;try{const [_0x113bac,_0xd8282f,_0x3fbe58]=await Promise['all']([database_1[_0x4d4d60(0x13a)][_0x4d4d60(0x167)][_0x4d4d60(0xf6)](),database_1[_0x4d4d60(0x13a)][_0x4d4d60(0x167)][_0x4d4d60(0x16a)]({'orderBy':{'updatedAt':_0x4d4d60(0x11f)},'select':{'updatedAt':!![]}}),database_1[_0x4d4d60(0x13a)][_0x4d4d60(0x167)][_0x4d4d60(0x16a)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x113bac,'lastUpdated':_0xd8282f?.[_0x4d4d60(0x10c)]||null,'oldestRate':_0x3fbe58?.[_0x4d4d60(0x10c)]||null,'markupPercentage':this[_0x4d4d60(0x151)]};}catch(_0x1dd690){return console[_0x4d4d60(0x14e)](_0x4d4d60(0x113),_0x1dd690),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4d4d60(0x151)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}function a38_0x3f83(_0x3603f9,_0x4a6271){const _0x5705a8=a38_0x5705();return a38_0x3f83=function(_0x3f8388,_0x717c3a){_0x3f8388=_0x3f8388-0xe9;let _0x5ed0bb=_0x5705a8[_0x3f8388];return _0x5ed0bb;},a38_0x3f83(_0x3603f9,_0x4a6271);}exports[a38_0x164bb5(0x15d)]=CurrencyService,exports[a38_0x164bb5(0xe9)]=new CurrencyService();