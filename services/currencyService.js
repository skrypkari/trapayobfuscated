'use strict';const a38_0x1445e5=a38_0x4102;(function(_0x5b05f2,_0x44a11f){const _0x133f53=a38_0x4102,_0x49eed1=_0x5b05f2();while(!![]){try{const _0x588fd2=-parseInt(_0x133f53(0x1bd))/0x1+parseInt(_0x133f53(0x15d))/0x2*(parseInt(_0x133f53(0x197))/0x3)+parseInt(_0x133f53(0x153))/0x4+-parseInt(_0x133f53(0x1b8))/0x5+-parseInt(_0x133f53(0x1a9))/0x6+parseInt(_0x133f53(0x1c4))/0x7*(-parseInt(_0x133f53(0x169))/0x8)+-parseInt(_0x133f53(0x1bc))/0x9*(-parseInt(_0x133f53(0x1b0))/0xa);if(_0x588fd2===_0x44a11f)break;else _0x49eed1['push'](_0x49eed1['shift']());}catch(_0x1f26b0){_0x49eed1['push'](_0x49eed1['shift']());}}}(a38_0x1073,0x3dfe8));function a38_0x4102(_0x48fac7,_0x420035){const _0x107318=a38_0x1073();return a38_0x4102=function(_0x410204,_0x14140e){_0x410204=_0x410204-0x152;let _0x2d3274=_0x107318[_0x410204];return _0x2d3274;},a38_0x4102(_0x48fac7,_0x420035);}function a38_0x1073(){const _0x2ee516=['application/json','nok','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','\x20currencies','error','keys','xag','rub','lkr','CoinGecko\x20API\x20error:\x20','Initial\x20currency\x20rates\x20update\x20failed:','vef','php','sats','gel','getRatesStatus','jpy','📊\x20Received\x20rates\x20for\x20','getAllRates','dot','../config/database','CurrencyService','join','xdr','yfi','\x20to\x20USDT:','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','toFixed','MARKUP_PERCENTAGE','50037AtMKKI','findFirst','bdt','updateInterval','xlm','krw','length','desc','all','try','Error\x20converting\x20','findMany','convertMultipleToUSDT','startPeriodicUpdates','COINGECKO_URL','updatedAt','map','usdt','651414vlJHsu','inr','twd','%\x20markup\x20=\x20','entries','json','toLowerCase','197310ODnNkd','?ids=tether&vs_currencies=','Periodic\x20currency\x20rates\x20update\x20failed:','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','cad','ngn','aud','ltc','1113170HTlJaV','upsert','chf','default','369DdeHWU','96673jpLqgl','link','brl','\x20USDT','warn','thb','updateCurrencyRates','14XXNmrn','ils','gbp','czk','btc','rate','log','%\x20markup\x20to\x20','1285832NXZFCJ','💱\x20Applied\x20','sar','Error\x20getting\x20rate\x20for\x20currency\x20','currencyRate','bhd','getCurrencyRate','aed','CURRENCIES','forEach','2BhePxe','bnb','tether','getMarkupPercentage','status','\x20USDT\x20=\x20','sek','eth','bch','zar','https://api.coingecko.com/api/v3/simple/price','__esModule','1861216bZEWSp','currencyService','count','cny','nzd','\x20USDT\x20(rate:\x20','__importDefault','convertToUSDT','eur','hkd','💱\x20Converted\x20','kwd','stopPeriodicUpdates','statusText','pkr',',\x20using\x201\x20as\x20fallback','dkk'];a38_0x1073=function(){return _0x2ee516;};return a38_0x1073();}var __importDefault=this&&this[a38_0x1445e5(0x16f)]||function(_0x1b3168){return _0x1b3168&&_0x1b3168['__esModule']?_0x1b3168:{'default':_0x1b3168};};Object['defineProperty'](exports,a38_0x1445e5(0x168),{'value':!![]}),exports[a38_0x1445e5(0x16a)]=exports[a38_0x1445e5(0x18f)]=void 0x0;const database_1=__importDefault(require(a38_0x1445e5(0x18e)));class CurrencyService{constructor(){const _0x366198=a38_0x1445e5;this[_0x366198(0x1a5)]=_0x366198(0x167),this[_0x366198(0x15b)]=[_0x366198(0x1c8),_0x366198(0x164),_0x366198(0x1b7),_0x366198(0x165),_0x366198(0x15e),'eos','xrp',_0x366198(0x19b),_0x366198(0x1be),_0x366198(0x18d),_0x366198(0x192),'usd',_0x366198(0x15a),'ars',_0x366198(0x1b6),_0x366198(0x199),_0x366198(0x158),'bmd',_0x366198(0x1bf),_0x366198(0x1b4),_0x366198(0x1ba),'clp',_0x366198(0x16c),_0x366198(0x1c7),_0x366198(0x179),_0x366198(0x171),_0x366198(0x1c6),_0x366198(0x188),_0x366198(0x172),'huf','idr',_0x366198(0x1c5),_0x366198(0x1aa),_0x366198(0x18a),_0x366198(0x19c),_0x366198(0x174),_0x366198(0x182),'mmk','mxn','myr',_0x366198(0x1b5),_0x366198(0x17b),_0x366198(0x16d),_0x366198(0x186),_0x366198(0x177),'pln',_0x366198(0x181),_0x366198(0x155),_0x366198(0x163),'sgd',_0x366198(0x1c2),_0x366198(0x1a0),_0x366198(0x1ab),'uah',_0x366198(0x185),'vnd',_0x366198(0x166),_0x366198(0x191),_0x366198(0x180),'xau','bits',_0x366198(0x187)],this[_0x366198(0x19a)]=null,this[_0x366198(0x196)]=0x3,this[_0x366198(0x1a4)]();}[a38_0x1445e5(0x1a4)](){const _0x5651ea=a38_0x1445e5;this[_0x5651ea(0x1c3)]()['catch'](_0x128b84=>{const _0x16db6e=_0x5651ea;console['error'](_0x16db6e(0x184),_0x128b84);}),this[_0x5651ea(0x19a)]=setInterval(async()=>{const _0x1fb4f3=_0x5651ea;try{await this[_0x1fb4f3(0x1c3)]();}catch(_0xbb1da){console[_0x1fb4f3(0x17e)](_0x1fb4f3(0x1b2),_0xbb1da);}},0x3c*0x3c*0x3e8),console[_0x5651ea(0x1ca)](_0x5651ea(0x1b3));}[a38_0x1445e5(0x175)](){const _0x22a114=a38_0x1445e5;this[_0x22a114(0x19a)]&&(clearInterval(this[_0x22a114(0x19a)]),this[_0x22a114(0x19a)]=null,console[_0x22a114(0x1ca)](_0x22a114(0x194)));}async[a38_0x1445e5(0x1c3)](){const _0x2c9b1c=a38_0x1445e5;try{console[_0x2c9b1c(0x1ca)](_0x2c9b1c(0x17c));const _0x294cc5=this[_0x2c9b1c(0x15b)][_0x2c9b1c(0x190)](','),_0x181f32=this[_0x2c9b1c(0x1a5)]+_0x2c9b1c(0x1b1)+_0x294cc5,_0x1529e7=await fetch(_0x181f32,{'headers':{'Accept':_0x2c9b1c(0x17a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x1529e7['ok'])throw new Error(_0x2c9b1c(0x183)+_0x1529e7[_0x2c9b1c(0x161)]+'\x20'+_0x1529e7[_0x2c9b1c(0x176)]);const _0x337787=await _0x1529e7[_0x2c9b1c(0x1ae)]();if(!_0x337787['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x5e4d55=_0x337787[_0x2c9b1c(0x15f)];console[_0x2c9b1c(0x1ca)](_0x2c9b1c(0x18b)+Object[_0x2c9b1c(0x17f)](_0x5e4d55)[_0x2c9b1c(0x19d)]+_0x2c9b1c(0x17d));const _0x1057a3=Object[_0x2c9b1c(0x1ad)](_0x5e4d55)[_0x2c9b1c(0x1a7)](async([_0x3b8c13,_0x29c7ed])=>{const _0x56d78b=_0x2c9b1c;try{await database_1[_0x56d78b(0x1bb)]['currencyRate'][_0x56d78b(0x1b9)]({'where':{'currency':_0x3b8c13[_0x56d78b(0x1af)]()},'update':{'rate':_0x29c7ed},'create':{'currency':_0x3b8c13[_0x56d78b(0x1af)](),'rate':_0x29c7ed}});}catch(_0x46d233){console[_0x56d78b(0x17e)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x3b8c13+':',_0x46d233);}});await Promise['allSettled'](_0x1057a3),console[_0x2c9b1c(0x1ca)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0xea86c){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0xea86c);throw _0xea86c;}}async['getCurrencyRate'](_0x5e6373){const _0x4d7abb=a38_0x1445e5,_0x55c8f8=_0x5e6373['toLowerCase']();if(_0x55c8f8===_0x4d7abb(0x1a8))return 0x1;try{const _0xc4fae4=await database_1[_0x4d7abb(0x1bb)][_0x4d7abb(0x157)]['findUnique']({'where':{'currency':_0x55c8f8}});if(!_0xc4fae4)return console[_0x4d7abb(0x1c1)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x5e6373+_0x4d7abb(0x178)),0x1;return _0xc4fae4[_0x4d7abb(0x1c9)];}catch(_0x557f8c){return console[_0x4d7abb(0x17e)](_0x4d7abb(0x156)+_0x5e6373+':',_0x557f8c),0x1;}}async[a38_0x1445e5(0x170)](_0x10154e,_0x553d7c){const _0x1a4ec5=a38_0x1445e5,_0x3a298a=_0x553d7c[_0x1a4ec5(0x1af)]();if(_0x3a298a==='usdt'){const _0x16f059=_0x10154e*(0x1+this[_0x1a4ec5(0x196)]/0x64);return console['log'](_0x1a4ec5(0x154)+this[_0x1a4ec5(0x196)]+_0x1a4ec5(0x152)+_0x10154e+_0x1a4ec5(0x162)+_0x16f059['toFixed'](0x6)+_0x1a4ec5(0x1c0)),_0x16f059;}try{const _0x27c46c=await this[_0x1a4ec5(0x159)](_0x3a298a),_0x36efac=_0x10154e/_0x27c46c,_0x302abf=_0x36efac*(0x1+this[_0x1a4ec5(0x196)]/0x64);return console[_0x1a4ec5(0x1ca)](_0x1a4ec5(0x173)+_0x10154e+'\x20'+_0x553d7c['toUpperCase']()+'\x20to\x20'+_0x36efac[_0x1a4ec5(0x195)](0x6)+'\x20USDT,\x20with\x20'+this[_0x1a4ec5(0x196)]+_0x1a4ec5(0x1ac)+_0x302abf[_0x1a4ec5(0x195)](0x6)+_0x1a4ec5(0x16e)+_0x27c46c+')'),_0x302abf;}catch(_0x50fa1c){console[_0x1a4ec5(0x17e)](_0x1a4ec5(0x1a1)+_0x10154e+'\x20'+_0x553d7c+_0x1a4ec5(0x193),_0x50fa1c);const _0x1ab47a=_0x10154e*(0x1+this[_0x1a4ec5(0x196)]/0x64);return _0x1ab47a;}}async[a38_0x1445e5(0x1a3)](_0x594be2){const _0x420b07=a38_0x1445e5;let _0x5ac114=0x0;for(const {amount:_0x1a017b,currency:_0x333a04}of _0x594be2){const _0x63dff3=await this[_0x420b07(0x170)](_0x1a017b,_0x333a04);_0x5ac114+=_0x63dff3;}return _0x5ac114;}async[a38_0x1445e5(0x18c)](){const _0x1c3aa3=a38_0x1445e5;try{const _0x23ddd9=await database_1[_0x1c3aa3(0x1bb)][_0x1c3aa3(0x157)][_0x1c3aa3(0x1a2)]({'select':{'currency':!![],'rate':!![]}}),_0x4a8c71={'usdt':0x1};return _0x23ddd9[_0x1c3aa3(0x15c)](_0x10c4f0=>{const _0x1cb4b4=_0x1c3aa3;_0x4a8c71[_0x10c4f0['currency']]=_0x10c4f0[_0x1cb4b4(0x1c9)];}),_0x4a8c71;}catch(_0xd40247){return console['error']('Error\x20getting\x20all\x20rates:',_0xd40247),{'usdt':0x1};}}async[a38_0x1445e5(0x189)](){const _0x2cb325=a38_0x1445e5;try{const [_0xd234ac,_0x2c0cf4,_0x2c151d]=await Promise[_0x2cb325(0x19f)]([database_1[_0x2cb325(0x1bb)][_0x2cb325(0x157)][_0x2cb325(0x16b)](),database_1[_0x2cb325(0x1bb)]['currencyRate'][_0x2cb325(0x198)]({'orderBy':{'updatedAt':_0x2cb325(0x19e)},'select':{'updatedAt':!![]}}),database_1[_0x2cb325(0x1bb)][_0x2cb325(0x157)][_0x2cb325(0x198)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xd234ac,'lastUpdated':_0x2c0cf4?.['updatedAt']||null,'oldestRate':_0x2c151d?.[_0x2cb325(0x1a6)]||null,'markupPercentage':this[_0x2cb325(0x196)]};}catch(_0x564193){return console[_0x2cb325(0x17e)]('Error\x20getting\x20rates\x20status:',_0x564193),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2cb325(0x196)]};}}[a38_0x1445e5(0x160)](){const _0x4ef7cf=a38_0x1445e5;return this[_0x4ef7cf(0x196)];}}exports[a38_0x1445e5(0x18f)]=CurrencyService,exports[a38_0x1445e5(0x16a)]=new CurrencyService();