'use strict';function a39_0x1aa6(){const _0x1f414d=['\x20USDT\x20=\x20','?ids=tether&vs_currencies=','📊\x20Received\x20rates\x20for\x20','btc','bdt','xlm','join','gbp','\x20to\x20','bhd','rate','tether','getAllRates','application/json','lkr','1295tFCPyo','\x20currencies','idr','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','ars','getRatesStatus','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Error\x20getting\x20all\x20rates:','CoinGecko\x20API\x20error:\x20','count','2KKrxKS','getMarkupPercentage','getCurrencyRate','Failed\x20to\x20update\x20rate\x20for\x20','💱\x20Applied\x20','json','nzd','updateCurrencyRates','inr','length','defineProperty','rub','✅\x20Currency\x20rates\x20updated\x20successfully','\x20USDT,\x20with\x20','findUnique','TesSoft\x20Payment\x20System/1.0','jpy','xag','xrp','bits','bmd','kwd','eos','MARKUP_PERCENTAGE','aed','gel','❌\x20Failed\x20to\x20update\x20currency\x20rates:','4561620rCkwuy','cny','3471135FlzJYg','desc','sek','Error\x20getting\x20rate\x20for\x20currency\x20','stopPeriodicUpdates','findFirst','currencyRate','nok','convertMultipleToUSDT','No\x20rate\x20found\x20for\x20currency:\x20','__esModule','eur','\x20USDT\x20(rate:\x20','updateInterval','map','currencyService','vef','updatedAt','yfi','allSettled','default','error','5862105xEuOgP','upsert','toFixed','catch','currency','\x20USDT','findMany','myr','4155305TChRFv','CurrencyService','vnd','aud','all','toUpperCase','log','Initial\x20currency\x20rates\x20update\x20failed:','status','ltc','280190fWqyVp','czk','pln','6473432HbBXeK','cad','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20to\x20USDT:','convertToUSDT','mxn','huf','CURRENCIES','krw','link','7938xbTJBw','asc','forEach','sats','entries','../config/database','usdt',',\x20using\x201\x20as\x20fallback','__importDefault','dot','toLowerCase','COINGECKO_URL','sgd'];a39_0x1aa6=function(){return _0x1f414d;};return a39_0x1aa6();}const a39_0x4698cc=a39_0x5a21;function a39_0x5a21(_0x4641fd,_0x26b122){const _0x1aa62c=a39_0x1aa6();return a39_0x5a21=function(_0x5a210f,_0x1912f9){_0x5a210f=_0x5a210f-0x1ef;let _0x2499a4=_0x1aa62c[_0x5a210f];return _0x2499a4;},a39_0x5a21(_0x4641fd,_0x26b122);}(function(_0x470a87,_0x2dc715){const _0x1713bb=a39_0x5a21,_0x5b20c9=_0x470a87();while(!![]){try{const _0x6c567f=parseInt(_0x1713bb(0x24c))/0x1+parseInt(_0x1713bb(0x207))/0x2*(-parseInt(_0x1713bb(0x224))/0x3)+parseInt(_0x1713bb(0x222))/0x4+parseInt(_0x1713bb(0x1fd))/0x5*(-parseInt(_0x1713bb(0x259))/0x6)+parseInt(_0x1713bb(0x242))/0x7+parseInt(_0x1713bb(0x24f))/0x8+-parseInt(_0x1713bb(0x23a))/0x9;if(_0x6c567f===_0x2dc715)break;else _0x5b20c9['push'](_0x5b20c9['shift']());}catch(_0x35e59f){_0x5b20c9['push'](_0x5b20c9['shift']());}}}(a39_0x1aa6,0xa4256));var __importDefault=this&&this[a39_0x4698cc(0x261)]||function(_0x47df55){const _0x4ba9a0=a39_0x4698cc;return _0x47df55&&_0x47df55[_0x4ba9a0(0x22e)]?_0x47df55:{'default':_0x47df55};};Object[a39_0x4698cc(0x211)](exports,'__esModule',{'value':!![]}),exports[a39_0x4698cc(0x233)]=exports[a39_0x4698cc(0x243)]=void 0x0;const database_1=__importDefault(require(a39_0x4698cc(0x25e)));class CurrencyService{constructor(){const _0x5d21f5=a39_0x4698cc;this[_0x5d21f5(0x264)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x5d21f5(0x1f1),'eth',_0x5d21f5(0x24b),'bch','bnb',_0x5d21f5(0x21d),_0x5d21f5(0x219),_0x5d21f5(0x1f3),_0x5d21f5(0x258),_0x5d21f5(0x262),_0x5d21f5(0x236),'usd',_0x5d21f5(0x21f),_0x5d21f5(0x201),_0x5d21f5(0x245),_0x5d21f5(0x1f2),_0x5d21f5(0x1f7),_0x5d21f5(0x21b),'brl',_0x5d21f5(0x250),'chf','clp',_0x5d21f5(0x223),_0x5d21f5(0x24d),'dkk',_0x5d21f5(0x22f),_0x5d21f5(0x1f5),_0x5d21f5(0x220),'hkd',_0x5d21f5(0x255),_0x5d21f5(0x1ff),'ils',_0x5d21f5(0x20f),_0x5d21f5(0x217),_0x5d21f5(0x257),_0x5d21f5(0x21c),_0x5d21f5(0x1fc),'mmk',_0x5d21f5(0x254),_0x5d21f5(0x241),'ngn',_0x5d21f5(0x22b),_0x5d21f5(0x20d),'php','pkr',_0x5d21f5(0x24e),_0x5d21f5(0x212),'sar',_0x5d21f5(0x226),_0x5d21f5(0x265),'thb','try','twd','uah',_0x5d21f5(0x234),_0x5d21f5(0x244),'zar','xdr',_0x5d21f5(0x218),'xau',_0x5d21f5(0x21a),_0x5d21f5(0x25c)],this[_0x5d21f5(0x231)]=null,this[_0x5d21f5(0x21e)]=0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x347ac9=a39_0x4698cc;this['updateCurrencyRates']()[_0x347ac9(0x23d)](_0x3ef436=>{const _0x5a1b81=_0x347ac9;console[_0x5a1b81(0x239)](_0x5a1b81(0x249),_0x3ef436);}),this[_0x347ac9(0x231)]=setInterval(async()=>{const _0xfe0cac=_0x347ac9;try{await this[_0xfe0cac(0x20e)]();}catch(_0x150afd){console[_0xfe0cac(0x239)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x150afd);}},0x3c*0x3c*0x3e8),console[_0x347ac9(0x248)](_0x347ac9(0x200));}[a39_0x4698cc(0x228)](){const _0xb9b49b=a39_0x4698cc;this[_0xb9b49b(0x231)]&&(clearInterval(this[_0xb9b49b(0x231)]),this['updateInterval']=null,console[_0xb9b49b(0x248)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a39_0x4698cc(0x20e)](){const _0xf5730b=a39_0x4698cc;try{console[_0xf5730b(0x248)](_0xf5730b(0x203));const _0x4036f7=this[_0xf5730b(0x256)][_0xf5730b(0x1f4)](','),_0x342b93=this[_0xf5730b(0x264)]+_0xf5730b(0x1ef)+_0x4036f7,_0x521fe3=await fetch(_0x342b93,{'headers':{'Accept':_0xf5730b(0x1fb),'User-Agent':_0xf5730b(0x216)}});if(!_0x521fe3['ok'])throw new Error(_0xf5730b(0x205)+_0x521fe3[_0xf5730b(0x24a)]+'\x20'+_0x521fe3['statusText']);const _0x5882af=await _0x521fe3[_0xf5730b(0x20c)]();if(!_0x5882af[_0xf5730b(0x1f9)])throw new Error(_0xf5730b(0x251));const _0x34b7b5=_0x5882af[_0xf5730b(0x1f9)];console[_0xf5730b(0x248)](_0xf5730b(0x1f0)+Object['keys'](_0x34b7b5)[_0xf5730b(0x210)]+_0xf5730b(0x1fe));const _0x24ded7=Object[_0xf5730b(0x25d)](_0x34b7b5)[_0xf5730b(0x232)](async([_0x37570c,_0x3d7e45])=>{const _0x45de30=_0xf5730b;try{await database_1[_0x45de30(0x238)][_0x45de30(0x22a)][_0x45de30(0x23b)]({'where':{'currency':_0x37570c[_0x45de30(0x263)]()},'update':{'rate':_0x3d7e45},'create':{'currency':_0x37570c['toLowerCase'](),'rate':_0x3d7e45}});}catch(_0x3c1651){console[_0x45de30(0x239)](_0x45de30(0x20a)+_0x37570c+':',_0x3c1651);}});await Promise[_0xf5730b(0x237)](_0x24ded7),console[_0xf5730b(0x248)](_0xf5730b(0x213));}catch(_0x307123){console['error'](_0xf5730b(0x221),_0x307123);throw _0x307123;}}async[a39_0x4698cc(0x209)](_0x2b9573){const _0x237632=a39_0x4698cc,_0x4413eb=_0x2b9573[_0x237632(0x263)]();if(_0x4413eb===_0x237632(0x25f))return 0x1;try{const _0x3cde03=await database_1[_0x237632(0x238)][_0x237632(0x22a)][_0x237632(0x215)]({'where':{'currency':_0x4413eb}});if(!_0x3cde03)return console['warn'](_0x237632(0x22d)+_0x2b9573+_0x237632(0x260)),0x1;return _0x3cde03[_0x237632(0x1f8)];}catch(_0x2d06c5){return console[_0x237632(0x239)](_0x237632(0x227)+_0x2b9573+':',_0x2d06c5),0x1;}}async[a39_0x4698cc(0x253)](_0x3ffb56,_0x5b3853){const _0x576233=a39_0x4698cc,_0x376c59=_0x5b3853[_0x576233(0x263)]();if(_0x376c59===_0x576233(0x25f)){const _0x50b716=_0x3ffb56*(0x1+this[_0x576233(0x21e)]/0x64);return console[_0x576233(0x248)](_0x576233(0x20b)+this[_0x576233(0x21e)]+'%\x20markup\x20to\x20'+_0x3ffb56+_0x576233(0x266)+_0x50b716[_0x576233(0x23c)](0x6)+_0x576233(0x23f)),_0x50b716;}try{const _0x28e160=await this[_0x576233(0x209)](_0x376c59),_0x4921fd=_0x3ffb56/_0x28e160,_0xbac200=_0x4921fd*(0x1+this[_0x576233(0x21e)]/0x64);return console[_0x576233(0x248)]('💱\x20Converted\x20'+_0x3ffb56+'\x20'+_0x5b3853[_0x576233(0x247)]()+_0x576233(0x1f6)+_0x4921fd['toFixed'](0x6)+_0x576233(0x214)+this[_0x576233(0x21e)]+'%\x20markup\x20=\x20'+_0xbac200[_0x576233(0x23c)](0x6)+_0x576233(0x230)+_0x28e160+')'),_0xbac200;}catch(_0x31f3e8){console['error']('Error\x20converting\x20'+_0x3ffb56+'\x20'+_0x5b3853+_0x576233(0x252),_0x31f3e8);const _0x595551=_0x3ffb56*(0x1+this[_0x576233(0x21e)]/0x64);return _0x595551;}}async[a39_0x4698cc(0x22c)](_0x34149a){const _0x2bab5d=a39_0x4698cc;let _0x2de7f4=0x0;for(const {amount:_0x42f002,currency:_0x978b92}of _0x34149a){const _0x3ac25f=await this[_0x2bab5d(0x253)](_0x42f002,_0x978b92);_0x2de7f4+=_0x3ac25f;}return _0x2de7f4;}async[a39_0x4698cc(0x1fa)](){const _0x2620db=a39_0x4698cc;try{const _0x260273=await database_1[_0x2620db(0x238)][_0x2620db(0x22a)][_0x2620db(0x240)]({'select':{'currency':!![],'rate':!![]}}),_0x5aa075={'usdt':0x1};return _0x260273[_0x2620db(0x25b)](_0x463fc1=>{const _0x145c87=_0x2620db;_0x5aa075[_0x463fc1[_0x145c87(0x23e)]]=_0x463fc1[_0x145c87(0x1f8)];}),_0x5aa075;}catch(_0x37e71a){return console['error'](_0x2620db(0x204),_0x37e71a),{'usdt':0x1};}}async[a39_0x4698cc(0x202)](){const _0x4e658f=a39_0x4698cc;try{const [_0x260834,_0x2e2ab6,_0x5a4c03]=await Promise[_0x4e658f(0x246)]([database_1['default'][_0x4e658f(0x22a)][_0x4e658f(0x206)](),database_1[_0x4e658f(0x238)][_0x4e658f(0x22a)][_0x4e658f(0x229)]({'orderBy':{'updatedAt':_0x4e658f(0x225)},'select':{'updatedAt':!![]}}),database_1[_0x4e658f(0x238)][_0x4e658f(0x22a)][_0x4e658f(0x229)]({'orderBy':{'updatedAt':_0x4e658f(0x25a)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x260834,'lastUpdated':_0x2e2ab6?.[_0x4e658f(0x235)]||null,'oldestRate':_0x5a4c03?.[_0x4e658f(0x235)]||null,'markupPercentage':this[_0x4e658f(0x21e)]};}catch(_0x29a6be){return console[_0x4e658f(0x239)]('Error\x20getting\x20rates\x20status:',_0x29a6be),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4e658f(0x21e)]};}}[a39_0x4698cc(0x208)](){const _0x62ba8a=a39_0x4698cc;return this[_0x62ba8a(0x21e)];}}exports[a39_0x4698cc(0x243)]=CurrencyService,exports['currencyService']=new CurrencyService();