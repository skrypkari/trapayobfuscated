'use strict';const a41_0x4cf3fd=a41_0x18ff;function a41_0x3558(){const _0x28d89f=['clp','ltc','huf','xdr','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','../config/database','hkd','getCurrencyRate','6814176izJNDo','currencyRate','stopPeriodicUpdates','\x20currencies','btc','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','upsert','convertToUSDT','mmk','convertMultipleToUSDT','default','%\x20markup\x20=\x20','twd','Error\x20getting\x20rate\x20for\x20currency\x20','eur','usd','link','ngn','updateInterval','allSettled','updateCurrencyRates','bhd','currency','findMany','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','❌\x20Failed\x20to\x20update\x20currency\x20rates:','myr','__esModule','MARKUP_PERCENTAGE','Error\x20getting\x20rates\x20status:','getRatesStatus','rate','zar','toUpperCase','lkr','currencyService','jpy','\x20USDT,\x20with\x20','eth','toFixed','10ZUReuZ','pkr','Initial\x20currency\x20rates\x20update\x20failed:','sats','json','warn','uah','toLowerCase','\x20USDT\x20(rate:\x20',',\x20using\x201\x20as\x20fallback','480558VzELXT','bdt','66tBVhWz','yfi','xrp','\x20to\x20','ars','log','aed','CurrencyService','gel','findFirst','28XMaVDZ','CoinGecko\x20API\x20error:\x20','eos','4188aceHDf','918432jZfVNO','brl','application/json','__importDefault','COINGECKO_URL','💱\x20Applied\x20','sar','error','all','4707414yTeaPQ','bmd','mxn','4570LEqiUd','updatedAt','kwd','💱\x20Converted\x20','entries','xag','inr','length','keys','forEach','sek','23962609sasEvm','aud','count','bnb','\x20USDT','startPeriodicUpdates','join','Error\x20getting\x20all\x20rates:','cny','map','Error\x20converting\x20','desc','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','tether','usdt','gbp','thb','\x20to\x20USDT:','2296oOqyok','chf','idr','dot','bch','📊\x20Received\x20rates\x20for\x20','xau','✅\x20Currency\x20rates\x20updated\x20successfully','?ids=tether&vs_currencies=','czk','CURRENCIES','getAllRates','status','krw'];a41_0x3558=function(){return _0x28d89f;};return a41_0x3558();}(function(_0x21dfd1,_0x43db93){const _0x25678e=a41_0x18ff,_0x3eb0c0=_0x21dfd1();while(!![]){try{const _0x2a973e=parseInt(_0x25678e(0x134))/0x1*(parseInt(_0x25678e(0x127))/0x2)+parseInt(_0x25678e(0x135))/0x3+parseInt(_0x25678e(0x15e))/0x4*(parseInt(_0x25678e(0x141))/0x5)+parseInt(_0x25678e(0x125))/0x6*(parseInt(_0x25678e(0x131))/0x7)+parseInt(_0x25678e(0x174))/0x8+parseInt(_0x25678e(0x13e))/0x9*(parseInt(_0x25678e(0x11b))/0xa)+-parseInt(_0x25678e(0x14c))/0xb;if(_0x2a973e===_0x43db93)break;else _0x3eb0c0['push'](_0x3eb0c0['shift']());}catch(_0x197c85){_0x3eb0c0['push'](_0x3eb0c0['shift']());}}}(a41_0x3558,0x7697b));function a41_0x18ff(_0x331ddb,_0x1f1230){const _0x355866=a41_0x3558();return a41_0x18ff=function(_0x18ffde,_0x5991aa){_0x18ffde=_0x18ffde-0x10d;let _0x251354=_0x355866[_0x18ffde];return _0x251354;},a41_0x18ff(_0x331ddb,_0x1f1230);}var __importDefault=this&&this[a41_0x4cf3fd(0x138)]||function(_0x4a6227){return _0x4a6227&&_0x4a6227['__esModule']?_0x4a6227:{'default':_0x4a6227};};Object['defineProperty'](exports,a41_0x4cf3fd(0x10e),{'value':!![]}),exports[a41_0x4cf3fd(0x116)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a41_0x4cf3fd(0x171)));class CurrencyService{constructor(){const _0x58ea47=a41_0x4cf3fd;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x58ea47(0x168)]=[_0x58ea47(0x178),_0x58ea47(0x119),_0x58ea47(0x16d),_0x58ea47(0x162),_0x58ea47(0x14f),_0x58ea47(0x133),_0x58ea47(0x129),'xlm',_0x58ea47(0x184),_0x58ea47(0x161),_0x58ea47(0x128),_0x58ea47(0x183),_0x58ea47(0x12d),_0x58ea47(0x12b),_0x58ea47(0x14d),_0x58ea47(0x126),_0x58ea47(0x189),_0x58ea47(0x13f),_0x58ea47(0x136),'cad',_0x58ea47(0x15f),_0x58ea47(0x16c),_0x58ea47(0x154),_0x58ea47(0x167),'dkk',_0x58ea47(0x182),_0x58ea47(0x15b),_0x58ea47(0x12f),_0x58ea47(0x172),_0x58ea47(0x16e),_0x58ea47(0x160),'ils',_0x58ea47(0x147),_0x58ea47(0x117),_0x58ea47(0x16b),_0x58ea47(0x143),_0x58ea47(0x115),_0x58ea47(0x17c),_0x58ea47(0x140),_0x58ea47(0x10d),_0x58ea47(0x185),'nok','nzd','php',_0x58ea47(0x11c),'pln','rub',_0x58ea47(0x13b),_0x58ea47(0x14b),'sgd',_0x58ea47(0x15c),'try',_0x58ea47(0x180),_0x58ea47(0x121),'vef','vnd',_0x58ea47(0x113),_0x58ea47(0x16f),_0x58ea47(0x146),_0x58ea47(0x164),'bits',_0x58ea47(0x11e)],this[_0x58ea47(0x186)]=null,this[_0x58ea47(0x10f)]=-0x3,this[_0x58ea47(0x151)]();}[a41_0x4cf3fd(0x151)](){const _0x4a2a35=a41_0x4cf3fd;this[_0x4a2a35(0x188)]()['catch'](_0x3aec5f=>{const _0x2a5d62=_0x4a2a35;console[_0x2a5d62(0x13c)](_0x2a5d62(0x11d),_0x3aec5f);}),this['updateInterval']=setInterval(async()=>{const _0x10f5c1=_0x4a2a35;try{await this[_0x10f5c1(0x188)]();}catch(_0x1a937f){console[_0x10f5c1(0x13c)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x1a937f);}},0x3c*0x3c*0x3e8),console[_0x4a2a35(0x12c)](_0x4a2a35(0x18c));}[a41_0x4cf3fd(0x176)](){const _0x1a9948=a41_0x4cf3fd;this['updateInterval']&&(clearInterval(this[_0x1a9948(0x186)]),this[_0x1a9948(0x186)]=null,console[_0x1a9948(0x12c)](_0x1a9948(0x170)));}async[a41_0x4cf3fd(0x188)](){const _0x38f146=a41_0x4cf3fd;try{console['log'](_0x38f146(0x179));const _0x14c8cd=this[_0x38f146(0x168)][_0x38f146(0x152)](','),_0x28fe87=this[_0x38f146(0x139)]+_0x38f146(0x166)+_0x14c8cd,_0x46da23=await fetch(_0x28fe87,{'headers':{'Accept':_0x38f146(0x137),'User-Agent':'Payment\x20System/1.0'}});if(!_0x46da23['ok'])throw new Error(_0x38f146(0x132)+_0x46da23[_0x38f146(0x16a)]+'\x20'+_0x46da23['statusText']);const _0x3b767d=await _0x46da23[_0x38f146(0x11f)]();if(!_0x3b767d[_0x38f146(0x159)])throw new Error(_0x38f146(0x158));const _0x15e976=_0x3b767d[_0x38f146(0x159)];console[_0x38f146(0x12c)](_0x38f146(0x163)+Object[_0x38f146(0x149)](_0x15e976)[_0x38f146(0x148)]+_0x38f146(0x177));const _0x4f9646=Object[_0x38f146(0x145)](_0x15e976)[_0x38f146(0x155)](async([_0x3c8a89,_0x43bc70])=>{const _0x215fcf=_0x38f146;try{await database_1['default'][_0x215fcf(0x175)][_0x215fcf(0x17a)]({'where':{'currency':_0x3c8a89[_0x215fcf(0x122)]()},'update':{'rate':_0x43bc70},'create':{'currency':_0x3c8a89[_0x215fcf(0x122)](),'rate':_0x43bc70}});}catch(_0x2a3ff2){console[_0x215fcf(0x13c)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x3c8a89+':',_0x2a3ff2);}});await Promise[_0x38f146(0x187)](_0x4f9646),console[_0x38f146(0x12c)](_0x38f146(0x165));}catch(_0x17db0c){console[_0x38f146(0x13c)](_0x38f146(0x18d),_0x17db0c);throw _0x17db0c;}}async[a41_0x4cf3fd(0x173)](_0xcaa6b0){const _0x40ec29=a41_0x4cf3fd,_0x1c90fe=_0xcaa6b0['toLowerCase']();if(_0x1c90fe===_0x40ec29(0x15a))return 0x1;try{const _0xbf57ef=await database_1[_0x40ec29(0x17e)][_0x40ec29(0x175)]['findUnique']({'where':{'currency':_0x1c90fe}});if(!_0xbf57ef)return console[_0x40ec29(0x120)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0xcaa6b0+_0x40ec29(0x124)),0x1;return _0xbf57ef[_0x40ec29(0x112)];}catch(_0x1b67ce){return console[_0x40ec29(0x13c)](_0x40ec29(0x181)+_0xcaa6b0+':',_0x1b67ce),0x1;}}async[a41_0x4cf3fd(0x17b)](_0x55d4c1,_0x350f70){const _0x332d72=a41_0x4cf3fd,_0x2b6e64=_0x350f70[_0x332d72(0x122)]();if(_0x2b6e64===_0x332d72(0x15a)){const _0x28e22d=_0x55d4c1*(0x1+this[_0x332d72(0x10f)]/0x64);return console[_0x332d72(0x12c)](_0x332d72(0x13a)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x55d4c1+'\x20USDT\x20=\x20'+_0x28e22d[_0x332d72(0x11a)](0x6)+_0x332d72(0x150)),_0x28e22d;}try{const _0x57590d=await this[_0x332d72(0x173)](_0x2b6e64),_0x2f558c=_0x55d4c1/_0x57590d,_0x479195=_0x2f558c*(0x1+this[_0x332d72(0x10f)]/0x64);return console[_0x332d72(0x12c)](_0x332d72(0x144)+_0x55d4c1+'\x20'+_0x350f70[_0x332d72(0x114)]()+_0x332d72(0x12a)+_0x2f558c[_0x332d72(0x11a)](0x6)+_0x332d72(0x118)+this[_0x332d72(0x10f)]+_0x332d72(0x17f)+_0x479195[_0x332d72(0x11a)](0x6)+_0x332d72(0x123)+_0x57590d+')'),_0x479195;}catch(_0x28eeec){console[_0x332d72(0x13c)](_0x332d72(0x156)+_0x55d4c1+'\x20'+_0x350f70+_0x332d72(0x15d),_0x28eeec);const _0x261f95=_0x55d4c1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x261f95;}}async[a41_0x4cf3fd(0x17d)](_0x21f155){let _0x5f2f5a=0x0;for(const {amount:_0x380829,currency:_0x3fae79}of _0x21f155){const _0x581a6d=await this['convertToUSDT'](_0x380829,_0x3fae79);_0x5f2f5a+=_0x581a6d;}return _0x5f2f5a;}async[a41_0x4cf3fd(0x169)](){const _0xa6521f=a41_0x4cf3fd;try{const _0x517a48=await database_1[_0xa6521f(0x17e)]['currencyRate'][_0xa6521f(0x18b)]({'select':{'currency':!![],'rate':!![]}}),_0x2cad40={'usdt':0x1};return _0x517a48[_0xa6521f(0x14a)](_0x18cd70=>{const _0xa99791=_0xa6521f;_0x2cad40[_0x18cd70[_0xa99791(0x18a)]]=_0x18cd70[_0xa99791(0x112)];}),_0x2cad40;}catch(_0x154337){return console[_0xa6521f(0x13c)](_0xa6521f(0x153),_0x154337),{'usdt':0x1};}}async[a41_0x4cf3fd(0x111)](){const _0x34d9f9=a41_0x4cf3fd;try{const [_0x5effde,_0x29a065,_0x130e51]=await Promise[_0x34d9f9(0x13d)]([database_1[_0x34d9f9(0x17e)][_0x34d9f9(0x175)][_0x34d9f9(0x14e)](),database_1[_0x34d9f9(0x17e)][_0x34d9f9(0x175)][_0x34d9f9(0x130)]({'orderBy':{'updatedAt':_0x34d9f9(0x157)},'select':{'updatedAt':!![]}}),database_1[_0x34d9f9(0x17e)][_0x34d9f9(0x175)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5effde,'lastUpdated':_0x29a065?.[_0x34d9f9(0x142)]||null,'oldestRate':_0x130e51?.['updatedAt']||null,'markupPercentage':this[_0x34d9f9(0x10f)]};}catch(_0x2dfe90){return console['error'](_0x34d9f9(0x110),_0x2dfe90),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x34d9f9(0x10f)]};}}['getMarkupPercentage'](){const _0x1a9c96=a41_0x4cf3fd;return this[_0x1a9c96(0x10f)];}}exports[a41_0x4cf3fd(0x12e)]=CurrencyService,exports['currencyService']=new CurrencyService();