'use strict';function a36_0x2c87(_0xfb688b,_0x17ce7f){const _0x64271c=a36_0x6427();return a36_0x2c87=function(_0x2c87dd,_0x140ecb){_0x2c87dd=_0x2c87dd-0xb9;let _0x533746=_0x64271c[_0x2c87dd];return _0x533746;},a36_0x2c87(_0xfb688b,_0x17ce7f);}const a36_0x262379=a36_0x2c87;(function(_0xcb7329,_0x1cd92e){const _0xddbb83=a36_0x2c87,_0x319b63=_0xcb7329();while(!![]){try{const _0x549036=parseInt(_0xddbb83(0xe3))/0x1*(parseInt(_0xddbb83(0xd3))/0x2)+-parseInt(_0xddbb83(0x101))/0x3*(parseInt(_0xddbb83(0xc1))/0x4)+-parseInt(_0xddbb83(0x11b))/0x5+-parseInt(_0xddbb83(0x12c))/0x6+parseInt(_0xddbb83(0xf5))/0x7*(parseInt(_0xddbb83(0x121))/0x8)+-parseInt(_0xddbb83(0x11a))/0x9+parseInt(_0xddbb83(0xe0))/0xa;if(_0x549036===_0x1cd92e)break;else _0x319b63['push'](_0x319b63['shift']());}catch(_0x2f9c9b){_0x319b63['push'](_0x319b63['shift']());}}}(a36_0x6427,0x2afca));var __importDefault=this&&this[a36_0x262379(0x115)]||function(_0x38106b){return _0x38106b&&_0x38106b['__esModule']?_0x38106b:{'default':_0x38106b};};Object[a36_0x262379(0x12b)](exports,'__esModule',{'value':!![]}),exports[a36_0x262379(0x130)]=exports[a36_0x262379(0x137)]=void 0x0;const database_1=__importDefault(require(a36_0x262379(0xc2)));function a36_0x6427(){const _0x9bd220=['gbp','log','usdt','✅\x20Currency\x20rates\x20updated\x20successfully','CoinGecko\x20API\x20error:\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','tether','rate','?ids=tether&vs_currencies=','Periodic\x20currency\x20rates\x20update\x20failed:','xrp','getAllRates','toFixed','php','\x20to\x20USDT:','Error\x20getting\x20rates\x20status:','588Cytnxm','startPeriodicUpdates','TesSoft\x20Payment\x20System/1.0','\x20USDT\x20(rate:\x20','inr','Failed\x20to\x20update\x20rate\x20for\x20','ltc',',\x20using\x201\x20as\x20fallback','huf','💱\x20Applied\x20','gel','getCurrencyRate','uah','4846780ECXesd','findMany','bnb','779oqBsDG','updatedAt','count','lkr','mxn','convertMultipleToUSDT','default','map','%\x20markup\x20to\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20USDT\x20=\x20','desc','bhd','📊\x20Received\x20rates\x20for\x20','kwd','xlm','ars','eur','14lVMmVR','krw','convertToUSDT','currencyRate','updateInterval','stopPeriodicUpdates','keys','\x20currencies','error','CURRENCIES','ngn','%\x20markup\x20=\x20','3QejPiI','sgd','myr','MARKUP_PERCENTAGE','zar','bmd','aud','dkk','nok','Initial\x20currency\x20rates\x20update\x20failed:','eth','updateCurrencyRates','brl','join','idr','cny','sar','findFirst','entries','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','__importDefault','No\x20rate\x20found\x20for\x20currency:\x20','status','pln','Error\x20getting\x20all\x20rates:','1443780cIobum','492130fTLrVs','\x20to\x20','currency','twd','Error\x20converting\x20','bdt','120216mzfzJs','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','usd','thb','nzd','warn','bits','COINGECKO_URL','all','allSettled','defineProperty','1113738bboRts','yfi','ils','json','currencyService','bch','sek','pkr','💱\x20Converted\x20','catch','link','CurrencyService','xdr','try','upsert','rub','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','vnd','toLowerCase','vef','\x20USDT','application/json','sats','492860ucMHlO','../config/database'];a36_0x6427=function(){return _0x9bd220;};return a36_0x6427();}class CurrencyService{constructor(){const _0x425549=a36_0x262379;this[_0x425549(0x128)]='https://api.coingecko.com/api/v3/simple/price',this[_0x425549(0xfe)]=['btc',_0x425549(0x10b),_0x425549(0xd9),_0x425549(0x131),_0x425549(0xe2),'eos',_0x425549(0xcd),_0x425549(0xf2),_0x425549(0x136),'dot',_0x425549(0x12d),_0x425549(0x123),'aed',_0x425549(0xf3),_0x425549(0x107),_0x425549(0x120),_0x425549(0xef),_0x425549(0x106),_0x425549(0x10d),'cad','chf','clp',_0x425549(0x110),'czk',_0x425549(0x108),_0x425549(0xf4),_0x425549(0xc3),_0x425549(0xdd),'hkd',_0x425549(0xdb),_0x425549(0x10f),_0x425549(0x12e),_0x425549(0xd7),'jpy',_0x425549(0xf6),_0x425549(0xf1),_0x425549(0xe6),'mmk',_0x425549(0xe7),_0x425549(0x103),_0x425549(0xff),_0x425549(0x109),_0x425549(0x125),_0x425549(0xd0),_0x425549(0x133),_0x425549(0x118),_0x425549(0xb9),_0x425549(0x111),_0x425549(0x132),_0x425549(0x102),_0x425549(0x124),_0x425549(0x139),_0x425549(0x11e),_0x425549(0xdf),_0x425549(0xbd),_0x425549(0xbb),_0x425549(0x105),_0x425549(0x138),'xag','xau',_0x425549(0x127),_0x425549(0xc0)],this[_0x425549(0xf9)]=null,this[_0x425549(0x104)]=0x3,this[_0x425549(0xd4)]();}[a36_0x262379(0xd4)](){const _0x5eeb17=a36_0x262379;this[_0x5eeb17(0x10c)]()[_0x5eeb17(0x135)](_0x29d986=>{const _0x9be7b1=_0x5eeb17;console[_0x9be7b1(0xfd)](_0x9be7b1(0x10a),_0x29d986);}),this['updateInterval']=setInterval(async()=>{const _0x36d4a5=_0x5eeb17;try{await this['updateCurrencyRates']();}catch(_0x52850d){console[_0x36d4a5(0xfd)](_0x36d4a5(0xcc),_0x52850d);}},0x3c*0x3c*0x3e8),console[_0x5eeb17(0xc4)](_0x5eeb17(0xec));}[a36_0x262379(0xfa)](){const _0x6eee1=a36_0x262379;this['updateInterval']&&(clearInterval(this[_0x6eee1(0xf9)]),this[_0x6eee1(0xf9)]=null,console[_0x6eee1(0xc4)](_0x6eee1(0xba)));}async[a36_0x262379(0x10c)](){const _0x5023a7=a36_0x262379;try{console[_0x5023a7(0xc4)](_0x5023a7(0x114));const _0x53d92b=this[_0x5023a7(0xfe)][_0x5023a7(0x10e)](','),_0x434569=this[_0x5023a7(0x128)]+_0x5023a7(0xcb)+_0x53d92b,_0x532fdd=await fetch(_0x434569,{'headers':{'Accept':_0x5023a7(0xbf),'User-Agent':_0x5023a7(0xd5)}});if(!_0x532fdd['ok'])throw new Error(_0x5023a7(0xc7)+_0x532fdd[_0x5023a7(0x117)]+'\x20'+_0x532fdd['statusText']);const _0x5eed56=await _0x532fdd[_0x5023a7(0x12f)]();if(!_0x5eed56[_0x5023a7(0xc9)])throw new Error(_0x5023a7(0x122));const _0x5db300=_0x5eed56[_0x5023a7(0xc9)];console[_0x5023a7(0xc4)](_0x5023a7(0xf0)+Object[_0x5023a7(0xfb)](_0x5db300)['length']+_0x5023a7(0xfc));const _0x3c2669=Object[_0x5023a7(0x113)](_0x5db300)[_0x5023a7(0xea)](async([_0x59adac,_0x23341f])=>{const _0x2ef387=_0x5023a7;try{await database_1['default'][_0x2ef387(0xf8)][_0x2ef387(0x13a)]({'where':{'currency':_0x59adac[_0x2ef387(0xbc)]()},'update':{'rate':_0x23341f},'create':{'currency':_0x59adac[_0x2ef387(0xbc)](),'rate':_0x23341f}});}catch(_0x3cbcf9){console['error'](_0x2ef387(0xd8)+_0x59adac+':',_0x3cbcf9);}});await Promise[_0x5023a7(0x12a)](_0x3c2669),console[_0x5023a7(0xc4)](_0x5023a7(0xc6));}catch(_0x2bd5a8){console['error'](_0x5023a7(0xc8),_0x2bd5a8);throw _0x2bd5a8;}}async[a36_0x262379(0xde)](_0x17042f){const _0x4d7737=a36_0x262379,_0x2a4c2e=_0x17042f[_0x4d7737(0xbc)]();if(_0x2a4c2e===_0x4d7737(0xc5))return 0x1;try{const _0xe65a64=await database_1[_0x4d7737(0xe9)][_0x4d7737(0xf8)]['findUnique']({'where':{'currency':_0x2a4c2e}});if(!_0xe65a64)return console[_0x4d7737(0x126)](_0x4d7737(0x116)+_0x17042f+_0x4d7737(0xda)),0x1;return _0xe65a64['rate'];}catch(_0xfa3c14){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x17042f+':',_0xfa3c14),0x1;}}async[a36_0x262379(0xf7)](_0x2165b3,_0x56ceef){const _0x435688=a36_0x262379,_0x42acdf=_0x56ceef[_0x435688(0xbc)]();if(_0x42acdf===_0x435688(0xc5)){const _0x1946d7=_0x2165b3*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x435688(0xc4)](_0x435688(0xdc)+this[_0x435688(0x104)]+_0x435688(0xeb)+_0x2165b3+_0x435688(0xed)+_0x1946d7[_0x435688(0xcf)](0x6)+_0x435688(0xbe)),_0x1946d7;}try{const _0x4c26a8=await this[_0x435688(0xde)](_0x42acdf),_0x9e5e0c=_0x2165b3/_0x4c26a8,_0x4c0f8f=_0x9e5e0c*(0x1+this[_0x435688(0x104)]/0x64);return console[_0x435688(0xc4)](_0x435688(0x134)+_0x2165b3+'\x20'+_0x56ceef['toUpperCase']()+_0x435688(0x11c)+_0x9e5e0c[_0x435688(0xcf)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0x435688(0x100)+_0x4c0f8f[_0x435688(0xcf)](0x6)+_0x435688(0xd6)+_0x4c26a8+')'),_0x4c0f8f;}catch(_0x4779eb){console[_0x435688(0xfd)](_0x435688(0x11f)+_0x2165b3+'\x20'+_0x56ceef+_0x435688(0xd1),_0x4779eb);const _0x24b6c9=_0x2165b3*(0x1+this[_0x435688(0x104)]/0x64);return _0x24b6c9;}}async[a36_0x262379(0xe8)](_0x2f3676){const _0x232b00=a36_0x262379;let _0x399beb=0x0;for(const {amount:_0x3e2259,currency:_0x20aa9a}of _0x2f3676){const _0x236c74=await this[_0x232b00(0xf7)](_0x3e2259,_0x20aa9a);_0x399beb+=_0x236c74;}return _0x399beb;}async[a36_0x262379(0xce)](){const _0x4834ba=a36_0x262379;try{const _0x583780=await database_1[_0x4834ba(0xe9)][_0x4834ba(0xf8)][_0x4834ba(0xe1)]({'select':{'currency':!![],'rate':!![]}}),_0x573356={'usdt':0x1};return _0x583780['forEach'](_0x4b4c4c=>{const _0x5f4e15=_0x4834ba;_0x573356[_0x4b4c4c[_0x5f4e15(0x11d)]]=_0x4b4c4c[_0x5f4e15(0xca)];}),_0x573356;}catch(_0x23d2eb){return console[_0x4834ba(0xfd)](_0x4834ba(0x119),_0x23d2eb),{'usdt':0x1};}}async['getRatesStatus'](){const _0x3fcc79=a36_0x262379;try{const [_0xe72473,_0x2339a9,_0x265cf0]=await Promise[_0x3fcc79(0x129)]([database_1[_0x3fcc79(0xe9)][_0x3fcc79(0xf8)][_0x3fcc79(0xe5)](),database_1[_0x3fcc79(0xe9)][_0x3fcc79(0xf8)][_0x3fcc79(0x112)]({'orderBy':{'updatedAt':_0x3fcc79(0xee)},'select':{'updatedAt':!![]}}),database_1[_0x3fcc79(0xe9)][_0x3fcc79(0xf8)][_0x3fcc79(0x112)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xe72473,'lastUpdated':_0x2339a9?.['updatedAt']||null,'oldestRate':_0x265cf0?.[_0x3fcc79(0xe4)]||null,'markupPercentage':this[_0x3fcc79(0x104)]};}catch(_0x9144c6){return console[_0x3fcc79(0xfd)](_0x3fcc79(0xd2),_0x9144c6),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0xdbc7d7=a36_0x262379;return this[_0xdbc7d7(0x104)];}}exports[a36_0x262379(0x137)]=CurrencyService,exports[a36_0x262379(0x130)]=new CurrencyService();