'use strict';const a58_0x94e3a5=a58_0xd561;(function(_0x52b136,_0xd18c1a){const _0x4e3635=a58_0xd561,_0x1d98a8=_0x52b136();while(!![]){try{const _0x559957=-parseInt(_0x4e3635(0xc7))/0x1+parseInt(_0x4e3635(0xe5))/0x2+-parseInt(_0x4e3635(0xcc))/0x3*(parseInt(_0x4e3635(0xc4))/0x4)+parseInt(_0x4e3635(0xc3))/0x5+parseInt(_0x4e3635(0xdb))/0x6*(-parseInt(_0x4e3635(0xdd))/0x7)+-parseInt(_0x4e3635(0xb0))/0x8+parseInt(_0x4e3635(0x8c))/0x9*(parseInt(_0x4e3635(0xad))/0xa);if(_0x559957===_0xd18c1a)break;else _0x1d98a8['push'](_0x1d98a8['shift']());}catch(_0x5173f0){_0x1d98a8['push'](_0x1d98a8['shift']());}}}(a58_0x2f5f,0xb0e93));var __importDefault=this&&this['__importDefault']||function(_0x429aea){return _0x429aea&&_0x429aea['__esModule']?_0x429aea:{'default':_0x429aea};};function a58_0xd561(_0x869693,_0x3f5c00){_0x869693=_0x869693-0x79;const _0x2f5f34=a58_0x2f5f();let _0xd56191=_0x2f5f34[_0x869693];return _0xd56191;}Object[a58_0x94e3a5(0x7d)](exports,'__esModule',{'value':!![]}),exports[a58_0x94e3a5(0x93)]=exports[a58_0x94e3a5(0xbd)]=void 0x0;function a58_0x2f5f(){const _0x352133=['desc','catch','status','getCurrencyRate','slice','%\x20markup\x20=\x20','CurrencyService','aud','convertMultipleToUSDT','\x20currencies','startPeriodicUpdates','stopPeriodicUpdates','775565UMRWnO','52NAypcK','btc','error','853071TmPIVH','getRatesStatus','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','updateCurrencyRates','124842CujibN','MARKUP_PERCENTAGE','upsert','krw','xrp','\x20USDT','entries','vnd','âœ…\x20Currency\x20rates\x20updated\x20successfully','ars','sgd','bmd','chf','Failed\x20to\x20update\x20rate\x20for\x20','\x20USDT\x20=\x20','2525514ULlDpB','forEach','21OfRyPe','findUnique','Error\x20getting\x20rates\x20status:','yfi','dkk','\x20USDT,\x20with\x20','myr','Initial\x20currency\x20rates\x20update\x20failed:','268510YQQnWQ','bnb','currencyRate','Error\x20converting\x20','kwd','findFirst','Error\x20getting\x20rate\x20for\x20currency\x20','usdt','\x20to\x20','xlm','%\x20markup\x20to\x20','ltc','cad','ðŸ“Š\x20Received\x20rates\x20for\x20','link','sar','xag','mxn','pkr','czk','defineProperty','gbp','application/json','cny','No\x20rate\x20found\x20for\x20currency:\x20','count','asc','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','CoinGecko\x20API\x20error:\x20','CURRENCIES','clp','gel','all','tether','json','117iFFjsh','rub','log','convertToUSDT','findMany','sek','hkd','currencyService','\x20to\x20USDT:','twd','php','bch','bits','huf','default','toLowerCase','Error\x20getting\x20all\x20rates:','updatedAt','Payment\x20System/1.0','getAllRates','xau','aed','updateInterval','length','dot','join','sats','currency','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','usd','map','statusText','eth','2719350oXRsyc','COINGECKO_URL','xdr','3544688VfRKPn','try','toFixed','getMarkupPercentage','eos','brl','rate'];a58_0x2f5f=function(){return _0x352133;};return a58_0x2f5f();}const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x2d4dc0=a58_0x94e3a5;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x2d4dc0(0xc5),_0x2d4dc0(0xac),_0x2d4dc0(0xf0),_0x2d4dc0(0x97),_0x2d4dc0(0xe6),_0x2d4dc0(0xb4),_0x2d4dc0(0xd0),_0x2d4dc0(0xee),_0x2d4dc0(0xf3),_0x2d4dc0(0xa4),_0x2d4dc0(0xe0),_0x2d4dc0(0xa9),_0x2d4dc0(0xa1),_0x2d4dc0(0xd5),_0x2d4dc0(0xbe),'bdt','bhd',_0x2d4dc0(0xd7),_0x2d4dc0(0xb5),_0x2d4dc0(0xf1),_0x2d4dc0(0xd8),_0x2d4dc0(0x87),_0x2d4dc0(0x80),_0x2d4dc0(0x7c),_0x2d4dc0(0xe1),'eur',_0x2d4dc0(0x7e),_0x2d4dc0(0x88),_0x2d4dc0(0x92),_0x2d4dc0(0x99),'idr','ils','inr','jpy',_0x2d4dc0(0xcf),_0x2d4dc0(0xe9),'lkr','mmk',_0x2d4dc0(0x7a),_0x2d4dc0(0xe3),'ngn','nok','nzd',_0x2d4dc0(0x96),_0x2d4dc0(0x7b),'pln',_0x2d4dc0(0x8d),_0x2d4dc0(0xf4),_0x2d4dc0(0x91),_0x2d4dc0(0xd6),'thb',_0x2d4dc0(0xb1),_0x2d4dc0(0x95),'uah','vef',_0x2d4dc0(0xd3),'zar',_0x2d4dc0(0xaf),_0x2d4dc0(0x79),_0x2d4dc0(0xa0),_0x2d4dc0(0x98),_0x2d4dc0(0xa6)],this[_0x2d4dc0(0xa2)]=null,this[_0x2d4dc0(0xcd)]=-0x3,this[_0x2d4dc0(0xc1)]();}['startPeriodicUpdates'](){const _0x372267=a58_0x94e3a5;this['updateCurrencyRates']()[_0x372267(0xb8)](_0x166840=>{const _0x50c727=_0x372267;console[_0x50c727(0xc6)](_0x50c727(0xe4),_0x166840);}),this['updateInterval']=setInterval(async()=>{const _0x52ce89=_0x372267;try{await this[_0x52ce89(0xcb)]();}catch(_0x102898){console[_0x52ce89(0xc6)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x102898);}},0x3c*0x3c*0x3e8),console[_0x372267(0x8e)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a58_0x94e3a5(0xc2)](){const _0x7cb8f0=a58_0x94e3a5;this[_0x7cb8f0(0xa2)]&&(clearInterval(this[_0x7cb8f0(0xa2)]),this[_0x7cb8f0(0xa2)]=null,console[_0x7cb8f0(0x8e)](_0x7cb8f0(0xa8)));}async[a58_0x94e3a5(0xcb)](){const _0x2473d0=a58_0x94e3a5;try{console[_0x2473d0(0x8e)](_0x2473d0(0x84));const _0x2c8e73=this[_0x2473d0(0x86)][_0x2473d0(0xa5)](','),_0x2f4037=this[_0x2473d0(0xae)]+'?ids=tether&vs_currencies='+_0x2c8e73,_0x36fdd2=await fetch(_0x2f4037,{'headers':{'Accept':_0x2473d0(0x7f),'User-Agent':_0x2473d0(0x9e)}});if(!_0x36fdd2['ok'])throw new Error(_0x2473d0(0x85)+_0x36fdd2[_0x2473d0(0xb9)]+'\x20'+_0x36fdd2[_0x2473d0(0xab)]);const _0x285489=await _0x36fdd2[_0x2473d0(0x8b)]();if(!_0x285489[_0x2473d0(0x8a)])throw new Error(_0x2473d0(0xc9));const _0x1f8c77=_0x285489['tether'];console[_0x2473d0(0x8e)](_0x2473d0(0xf2)+Object['keys'](_0x1f8c77)[_0x2473d0(0xa3)]+_0x2473d0(0xc0));const _0x3c497b=0x5,_0x44cb08=Object[_0x2473d0(0xd2)](_0x1f8c77);for(let _0x3943bb=0x0;_0x3943bb<_0x44cb08[_0x2473d0(0xa3)];_0x3943bb+=_0x3c497b){const _0x379c25=_0x44cb08[_0x2473d0(0xbb)](_0x3943bb,_0x3943bb+_0x3c497b),_0x480260=_0x379c25[_0x2473d0(0xaa)](async([_0x4719e9,_0x583f35])=>{const _0x358c3f=_0x2473d0;try{await database_1[_0x358c3f(0x9a)][_0x358c3f(0xe7)][_0x358c3f(0xce)]({'where':{'currency':_0x4719e9[_0x358c3f(0x9b)]()},'update':{'rate':_0x583f35},'create':{'currency':_0x4719e9[_0x358c3f(0x9b)](),'rate':_0x583f35}});}catch(_0x38af45){console[_0x358c3f(0xc6)](_0x358c3f(0xd9)+_0x4719e9+':',_0x38af45);}});await Promise[_0x2473d0(0x89)](_0x480260);}console[_0x2473d0(0x8e)](_0x2473d0(0xd4));}catch(_0x4a580f){console[_0x2473d0(0xc6)](_0x2473d0(0xca),_0x4a580f);throw _0x4a580f;}}async[a58_0x94e3a5(0xba)](_0x5a6652){const _0x5391d8=a58_0x94e3a5,_0x3d681a=_0x5a6652[_0x5391d8(0x9b)]();if(_0x3d681a===_0x5391d8(0xec))return 0x1;try{const _0x1558ba=await database_1['default']['currencyRate'][_0x5391d8(0xde)]({'where':{'currency':_0x3d681a}});if(!_0x1558ba)return console['warn'](_0x5391d8(0x81)+_0x5a6652+',\x20using\x201\x20as\x20fallback'),0x1;return _0x1558ba[_0x5391d8(0xb6)];}catch(_0x4f0128){return console[_0x5391d8(0xc6)](_0x5391d8(0xeb)+_0x5a6652+':',_0x4f0128),0x1;}}async[a58_0x94e3a5(0x8f)](_0x982c0a,_0x408f18){const _0x3a2e46=a58_0x94e3a5,_0x576c6d=_0x408f18[_0x3a2e46(0x9b)]();if(_0x576c6d==='usdt'){const _0x51d3b1=_0x982c0a*(0x1+this[_0x3a2e46(0xcd)]/0x64);return console[_0x3a2e46(0x8e)]('ðŸ’±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x3a2e46(0xef)+_0x982c0a+_0x3a2e46(0xda)+_0x51d3b1['toFixed'](0x6)+_0x3a2e46(0xd1)),_0x51d3b1;}try{const _0x19e07f=await this[_0x3a2e46(0xba)](_0x576c6d),_0x163d89=_0x982c0a/_0x19e07f,_0x5d78e8=_0x163d89*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3a2e46(0x8e)]('ðŸ’±\x20Converted\x20'+_0x982c0a+'\x20'+_0x408f18['toUpperCase']()+_0x3a2e46(0xed)+_0x163d89[_0x3a2e46(0xb2)](0x6)+_0x3a2e46(0xe2)+this[_0x3a2e46(0xcd)]+_0x3a2e46(0xbc)+_0x5d78e8[_0x3a2e46(0xb2)](0x6)+'\x20USDT\x20(rate:\x20'+_0x19e07f+')'),_0x5d78e8;}catch(_0x290f3b){console[_0x3a2e46(0xc6)](_0x3a2e46(0xe8)+_0x982c0a+'\x20'+_0x408f18+_0x3a2e46(0x94),_0x290f3b);const _0x1fdccd=_0x982c0a*(0x1+this[_0x3a2e46(0xcd)]/0x64);return _0x1fdccd;}}async[a58_0x94e3a5(0xbf)](_0xf90aac){let _0x1448fe=0x0;for(const {amount:_0x562557,currency:_0x4a43d8}of _0xf90aac){const _0x85c94d=await this['convertToUSDT'](_0x562557,_0x4a43d8);_0x1448fe+=_0x85c94d;}return _0x1448fe;}async[a58_0x94e3a5(0x9f)](){const _0x464d61=a58_0x94e3a5;try{const _0x57483f=await database_1[_0x464d61(0x9a)][_0x464d61(0xe7)][_0x464d61(0x90)]({'select':{'currency':!![],'rate':!![]}}),_0x475769={'usdt':0x1};return _0x57483f[_0x464d61(0xdc)](_0x2a7b6c=>{const _0x5bcc70=_0x464d61;_0x475769[_0x2a7b6c[_0x5bcc70(0xa7)]]=_0x2a7b6c['rate'];}),_0x475769;}catch(_0x7e2c44){return console[_0x464d61(0xc6)](_0x464d61(0x9c),_0x7e2c44),{'usdt':0x1};}}async[a58_0x94e3a5(0xc8)](){const _0x48fb39=a58_0x94e3a5;try{const [_0x58c16b,_0x13e426,_0x5bc66c]=await Promise[_0x48fb39(0x89)]([database_1['default'][_0x48fb39(0xe7)][_0x48fb39(0x82)](),database_1[_0x48fb39(0x9a)]['currencyRate'][_0x48fb39(0xea)]({'orderBy':{'updatedAt':_0x48fb39(0xb7)},'select':{'updatedAt':!![]}}),database_1['default'][_0x48fb39(0xe7)][_0x48fb39(0xea)]({'orderBy':{'updatedAt':_0x48fb39(0x83)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x58c16b,'lastUpdated':_0x13e426?.[_0x48fb39(0x9d)]||null,'oldestRate':_0x5bc66c?.[_0x48fb39(0x9d)]||null,'markupPercentage':this[_0x48fb39(0xcd)]};}catch(_0x2ddc4b){return console['error'](_0x48fb39(0xdf),_0x2ddc4b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x48fb39(0xcd)]};}}[a58_0x94e3a5(0xb3)](){const _0x34828f=a58_0x94e3a5;return this[_0x34828f(0xcd)];}}exports['CurrencyService']=CurrencyService,exports[a58_0x94e3a5(0x93)]=new CurrencyService();