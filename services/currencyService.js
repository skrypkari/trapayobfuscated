'use strict';const a38_0x779d44=a38_0x348f;(function(_0x58f799,_0x1ddfe2){const _0x4bd776=a38_0x348f,_0x5711b7=_0x58f799();while(!![]){try{const _0x15f4e6=-parseInt(_0x4bd776(0x11e))/0x1*(parseInt(_0x4bd776(0x18e))/0x2)+parseInt(_0x4bd776(0x17f))/0x3+-parseInt(_0x4bd776(0x147))/0x4*(parseInt(_0x4bd776(0x13a))/0x5)+parseInt(_0x4bd776(0x128))/0x6+parseInt(_0x4bd776(0x156))/0x7+parseInt(_0x4bd776(0x14e))/0x8*(-parseInt(_0x4bd776(0x199))/0x9)+parseInt(_0x4bd776(0x15d))/0xa;if(_0x15f4e6===_0x1ddfe2)break;else _0x5711b7['push'](_0x5711b7['shift']());}catch(_0x164d9e){_0x5711b7['push'](_0x5711b7['shift']());}}}(a38_0x154a,0x7f688));function a38_0x348f(_0x4a0ea3,_0x2a8f74){const _0x154a5d=a38_0x154a();return a38_0x348f=function(_0x348fe7,_0x210a4d){_0x348fe7=_0x348fe7-0x11b;let _0x35ca77=_0x154a5d[_0x348fe7];return _0x35ca77;},a38_0x348f(_0x4a0ea3,_0x2a8f74);}function a38_0x154a(){const _0x308e55=['eth','💱\x20Applied\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','Error\x20getting\x20rates\x20status:','%\x20markup\x20=\x20','CoinGecko\x20API\x20error:\x20','getRatesStatus','eos','krw','\x20to\x20USDT:','📊\x20Received\x20rates\x20for\x20','Error\x20converting\x20','\x20USDT\x20=\x20','updatedAt','2420255soilBP','clp','vnd','currencyService','desc','sek','idr','../config/database','xrp','vef','allSettled','entries','hkd','8jYAmBD','forEach','https://api.coingecko.com/api/v3/simple/price','getCurrencyRate',',\x20using\x201\x20as\x20fallback','startPeriodicUpdates','application/json','728AaAOIx','twd','map','__importDefault','php','join','aud','MARKUP_PERCENTAGE','5778458syxChW','TesSoft\x20Payment\x20System/1.0','sar','findMany','bmd','convertToUSDT','CurrencyService','6228900PDWHTF','default','rub','cny','Error\x20getting\x20rate\x20for\x20currency\x20','xag','toFixed','toUpperCase','count','zar','xdr','thb','nok','sgd','error','jpy','keys','__esModule','dot','\x20USDT\x20(rate:\x20','brl','warn','xau','currencyRate','btc','COINGECKO_URL','lkr','updateCurrencyRates','\x20to\x20','log','kwd','bits','pkr','getAllRates','673698ygQQPj','ars','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','czk','nzd','try','rate','Periodic\x20currency\x20rates\x20update\x20failed:','?ids=tether&vs_currencies=','ngn','cad','yfi','toLowerCase','uah','No\x20rate\x20found\x20for\x20currency:\x20','1036148VXgrNU','json','status','%\x20markup\x20to\x20','mmk','findUnique','catch','ltc','gbp','mxn','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','144AUsjtY','stopPeriodicUpdates','statusText','usd','1jPLIOW','upsert','convertMultipleToUSDT','Error\x20getting\x20all\x20rates:','usdt','updateInterval','link','bhd','tether','CURRENCIES','2019276ZoIrRL','all','sats','myr'];a38_0x154a=function(){return _0x308e55;};return a38_0x154a();}var __importDefault=this&&this[a38_0x779d44(0x151)]||function(_0x429c91){const _0x141983=a38_0x779d44;return _0x429c91&&_0x429c91[_0x141983(0x16e)]?_0x429c91:{'default':_0x429c91};};Object['defineProperty'](exports,a38_0x779d44(0x16e),{'value':!![]}),exports[a38_0x779d44(0x13d)]=exports[a38_0x779d44(0x15c)]=void 0x0;const database_1=__importDefault(require(a38_0x779d44(0x141)));class CurrencyService{constructor(){const _0x2e0fd1=a38_0x779d44;this[_0x2e0fd1(0x176)]=_0x2e0fd1(0x149),this[_0x2e0fd1(0x127)]=[_0x2e0fd1(0x175),_0x2e0fd1(0x12c),_0x2e0fd1(0x195),'bch','bnb',_0x2e0fd1(0x133),_0x2e0fd1(0x142),'xlm',_0x2e0fd1(0x124),_0x2e0fd1(0x16f),_0x2e0fd1(0x18a),_0x2e0fd1(0x11d),'aed',_0x2e0fd1(0x180),_0x2e0fd1(0x154),'bdt',_0x2e0fd1(0x125),_0x2e0fd1(0x15a),_0x2e0fd1(0x171),_0x2e0fd1(0x189),'chf',_0x2e0fd1(0x13b),_0x2e0fd1(0x160),_0x2e0fd1(0x182),'dkk','eur',_0x2e0fd1(0x196),'gel',_0x2e0fd1(0x146),'huf',_0x2e0fd1(0x140),'ils','inr',_0x2e0fd1(0x16c),_0x2e0fd1(0x134),_0x2e0fd1(0x17b),_0x2e0fd1(0x177),_0x2e0fd1(0x192),_0x2e0fd1(0x197),_0x2e0fd1(0x12b),_0x2e0fd1(0x188),_0x2e0fd1(0x169),_0x2e0fd1(0x183),_0x2e0fd1(0x152),_0x2e0fd1(0x17d),'pln',_0x2e0fd1(0x15f),_0x2e0fd1(0x158),_0x2e0fd1(0x13f),_0x2e0fd1(0x16a),_0x2e0fd1(0x168),_0x2e0fd1(0x184),_0x2e0fd1(0x14f),_0x2e0fd1(0x18c),_0x2e0fd1(0x143),_0x2e0fd1(0x13c),_0x2e0fd1(0x166),_0x2e0fd1(0x167),_0x2e0fd1(0x162),_0x2e0fd1(0x173),_0x2e0fd1(0x17c),_0x2e0fd1(0x12a)],this[_0x2e0fd1(0x123)]=null,this[_0x2e0fd1(0x155)]=0x3,this[_0x2e0fd1(0x14c)]();}[a38_0x779d44(0x14c)](){const _0x4f6eae=a38_0x779d44;this[_0x4f6eae(0x178)]()[_0x4f6eae(0x194)](_0x77cf41=>{const _0x44f940=_0x4f6eae;console[_0x44f940(0x16b)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x77cf41);}),this[_0x4f6eae(0x123)]=setInterval(async()=>{const _0x48b851=_0x4f6eae;try{await this[_0x48b851(0x178)]();}catch(_0x454bd2){console[_0x48b851(0x16b)](_0x48b851(0x186),_0x454bd2);}},0x3c*0x3c*0x3e8),console['log'](_0x4f6eae(0x198));}[a38_0x779d44(0x11b)](){const _0x568691=a38_0x779d44;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x568691(0x123)]=null,console[_0x568691(0x17a)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x779d44(0x178)](){const _0x56b029=a38_0x779d44;try{console[_0x56b029(0x17a)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x21466d=this[_0x56b029(0x127)][_0x56b029(0x153)](','),_0x2ae8da=this[_0x56b029(0x176)]+_0x56b029(0x187)+_0x21466d,_0x2e193c=await fetch(_0x2ae8da,{'headers':{'Accept':_0x56b029(0x14d),'User-Agent':_0x56b029(0x157)}});if(!_0x2e193c['ok'])throw new Error(_0x56b029(0x131)+_0x2e193c[_0x56b029(0x190)]+'\x20'+_0x2e193c[_0x56b029(0x11c)]);const _0x1dd228=await _0x2e193c[_0x56b029(0x18f)]();if(!_0x1dd228['tether'])throw new Error(_0x56b029(0x181));const _0x3efa40=_0x1dd228[_0x56b029(0x126)];console[_0x56b029(0x17a)](_0x56b029(0x136)+Object[_0x56b029(0x16d)](_0x3efa40)['length']+'\x20currencies');const _0x286b6d=Object[_0x56b029(0x145)](_0x3efa40)[_0x56b029(0x150)](async([_0xdca71c,_0x4a2d5f])=>{const _0x1492f4=_0x56b029;try{await database_1[_0x1492f4(0x15e)][_0x1492f4(0x174)][_0x1492f4(0x11f)]({'where':{'currency':_0xdca71c['toLowerCase']()},'update':{'rate':_0x4a2d5f},'create':{'currency':_0xdca71c[_0x1492f4(0x18b)](),'rate':_0x4a2d5f}});}catch(_0xac294b){console[_0x1492f4(0x16b)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0xdca71c+':',_0xac294b);}});await Promise[_0x56b029(0x144)](_0x286b6d),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x3e0600){console['error'](_0x56b029(0x12e),_0x3e0600);throw _0x3e0600;}}async[a38_0x779d44(0x14a)](_0x453c41){const _0x1eb684=a38_0x779d44,_0x987d72=_0x453c41[_0x1eb684(0x18b)]();if(_0x987d72===_0x1eb684(0x122))return 0x1;try{const _0x2be2bc=await database_1['default'][_0x1eb684(0x174)][_0x1eb684(0x193)]({'where':{'currency':_0x987d72}});if(!_0x2be2bc)return console[_0x1eb684(0x172)](_0x1eb684(0x18d)+_0x453c41+_0x1eb684(0x14b)),0x1;return _0x2be2bc['rate'];}catch(_0xc53f77){return console[_0x1eb684(0x16b)](_0x1eb684(0x161)+_0x453c41+':',_0xc53f77),0x1;}}async[a38_0x779d44(0x15b)](_0x2991c2,_0x38bbc4){const _0x2e0d39=a38_0x779d44,_0x408c44=_0x38bbc4[_0x2e0d39(0x18b)]();if(_0x408c44===_0x2e0d39(0x122)){const _0x2661a2=_0x2991c2*(0x1+this[_0x2e0d39(0x155)]/0x64);return console[_0x2e0d39(0x17a)](_0x2e0d39(0x12d)+this[_0x2e0d39(0x155)]+_0x2e0d39(0x191)+_0x2991c2+_0x2e0d39(0x138)+_0x2661a2[_0x2e0d39(0x163)](0x6)+'\x20USDT'),_0x2661a2;}try{const _0x8c851=await this[_0x2e0d39(0x14a)](_0x408c44),_0x3a7bc1=_0x2991c2/_0x8c851,_0x264729=_0x3a7bc1*(0x1+this[_0x2e0d39(0x155)]/0x64);return console['log']('💱\x20Converted\x20'+_0x2991c2+'\x20'+_0x38bbc4[_0x2e0d39(0x164)]()+_0x2e0d39(0x179)+_0x3a7bc1[_0x2e0d39(0x163)](0x6)+'\x20USDT,\x20with\x20'+this[_0x2e0d39(0x155)]+_0x2e0d39(0x130)+_0x264729[_0x2e0d39(0x163)](0x6)+_0x2e0d39(0x170)+_0x8c851+')'),_0x264729;}catch(_0xf3dfc){console[_0x2e0d39(0x16b)](_0x2e0d39(0x137)+_0x2991c2+'\x20'+_0x38bbc4+_0x2e0d39(0x135),_0xf3dfc);const _0x19f553=_0x2991c2*(0x1+this[_0x2e0d39(0x155)]/0x64);return _0x19f553;}}async[a38_0x779d44(0x120)](_0x453bd6){let _0x49a0c1=0x0;for(const {amount:_0x3a67b5,currency:_0x45c17c}of _0x453bd6){const _0x1e486e=await this['convertToUSDT'](_0x3a67b5,_0x45c17c);_0x49a0c1+=_0x1e486e;}return _0x49a0c1;}async[a38_0x779d44(0x17e)](){const _0x14221d=a38_0x779d44;try{const _0x4c4922=await database_1['default'][_0x14221d(0x174)][_0x14221d(0x159)]({'select':{'currency':!![],'rate':!![]}}),_0x19a4ca={'usdt':0x1};return _0x4c4922[_0x14221d(0x148)](_0x7abf80=>{const _0x1bde99=_0x14221d;_0x19a4ca[_0x7abf80['currency']]=_0x7abf80[_0x1bde99(0x185)];}),_0x19a4ca;}catch(_0x485cf8){return console[_0x14221d(0x16b)](_0x14221d(0x121),_0x485cf8),{'usdt':0x1};}}async[a38_0x779d44(0x132)](){const _0x326a9f=a38_0x779d44;try{const [_0x509e5f,_0x5e073e,_0x585c4b]=await Promise[_0x326a9f(0x129)]([database_1[_0x326a9f(0x15e)][_0x326a9f(0x174)][_0x326a9f(0x165)](),database_1[_0x326a9f(0x15e)][_0x326a9f(0x174)]['findFirst']({'orderBy':{'updatedAt':_0x326a9f(0x13e)},'select':{'updatedAt':!![]}}),database_1['default'][_0x326a9f(0x174)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x509e5f,'lastUpdated':_0x5e073e?.[_0x326a9f(0x139)]||null,'oldestRate':_0x585c4b?.['updatedAt']||null,'markupPercentage':this[_0x326a9f(0x155)]};}catch(_0x2bdc82){return console[_0x326a9f(0x16b)](_0x326a9f(0x12f),_0x2bdc82),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x326a9f(0x155)]};}}['getMarkupPercentage'](){const _0x52b5aa=a38_0x779d44;return this[_0x52b5aa(0x155)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x779d44(0x13d)]=new CurrencyService();