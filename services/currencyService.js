'use strict';const a38_0x1864a3=a38_0x6bfc;(function(_0x4e200a,_0x8fc44){const _0x3631d4=a38_0x6bfc,_0x30bdb9=_0x4e200a();while(!![]){try{const _0x38075f=-parseInt(_0x3631d4(0x18a))/0x1+-parseInt(_0x3631d4(0x19e))/0x2*(-parseInt(_0x3631d4(0x14b))/0x3)+-parseInt(_0x3631d4(0x158))/0x4*(parseInt(_0x3631d4(0x1a1))/0x5)+parseInt(_0x3631d4(0x191))/0x6+-parseInt(_0x3631d4(0x196))/0x7+-parseInt(_0x3631d4(0x165))/0x8*(parseInt(_0x3631d4(0x16d))/0x9)+-parseInt(_0x3631d4(0x169))/0xa*(-parseInt(_0x3631d4(0x179))/0xb);if(_0x38075f===_0x8fc44)break;else _0x30bdb9['push'](_0x30bdb9['shift']());}catch(_0x2cf270){_0x30bdb9['push'](_0x30bdb9['shift']());}}}(a38_0x1152,0xa9ba3));var __importDefault=this&&this[a38_0x1864a3(0x168)]||function(_0x304394){const _0x26d4c0=a38_0x1864a3;return _0x304394&&_0x304394[_0x26d4c0(0x1a7)]?_0x304394:{'default':_0x304394};};Object['defineProperty'](exports,a38_0x1864a3(0x1a7),{'value':!![]}),exports[a38_0x1864a3(0x17b)]=exports[a38_0x1864a3(0x19b)]=void 0x0;function a38_0x6bfc(_0x2fb774,_0x3a3986){const _0x115227=a38_0x1152();return a38_0x6bfc=function(_0x6bfc1,_0x517a8c){_0x6bfc1=_0x6bfc1-0x13f;let _0x31cf03=_0x115227[_0x6bfc1];return _0x31cf03;},a38_0x6bfc(_0x2fb774,_0x3a3986);}const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x2b844e=a38_0x1864a3;this['COINGECKO_URL']=_0x2b844e(0x16c),this['CURRENCIES']=[_0x2b844e(0x141),'eth',_0x2b844e(0x18d),_0x2b844e(0x1b6),_0x2b844e(0x144),_0x2b844e(0x173),_0x2b844e(0x16e),_0x2b844e(0x1a6),_0x2b844e(0x19c),_0x2b844e(0x146),_0x2b844e(0x197),_0x2b844e(0x18c),_0x2b844e(0x15c),_0x2b844e(0x1ab),_0x2b844e(0x18e),_0x2b844e(0x174),_0x2b844e(0x171),_0x2b844e(0x187),_0x2b844e(0x1a2),'cad',_0x2b844e(0x156),_0x2b844e(0x157),_0x2b844e(0x167),_0x2b844e(0x1aa),'dkk',_0x2b844e(0x142),_0x2b844e(0x151),_0x2b844e(0x1ad),_0x2b844e(0x1a3),_0x2b844e(0x15d),'idr',_0x2b844e(0x150),_0x2b844e(0x1b1),'jpy',_0x2b844e(0x154),'kwd',_0x2b844e(0x14c),'mmk',_0x2b844e(0x1a4),'myr',_0x2b844e(0x190),_0x2b844e(0x159),_0x2b844e(0x1b3),_0x2b844e(0x14d),_0x2b844e(0x15a),_0x2b844e(0x155),_0x2b844e(0x193),'sar','sek',_0x2b844e(0x17c),'thb',_0x2b844e(0x18b),_0x2b844e(0x13f),_0x2b844e(0x170),_0x2b844e(0x160),'vnd',_0x2b844e(0x184),_0x2b844e(0x166),'xag',_0x2b844e(0x1b0),_0x2b844e(0x14f),'sats'],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x2b844e(0x1ae)]();}['startPeriodicUpdates'](){const _0x11e735=a38_0x1864a3;this[_0x11e735(0x188)]()[_0x11e735(0x15b)](_0x12e357=>{const _0x2e0b64=_0x11e735;console[_0x2e0b64(0x153)](_0x2e0b64(0x16a),_0x12e357);}),this[_0x11e735(0x194)]=setInterval(async()=>{const _0x379c03=_0x11e735;try{await this[_0x379c03(0x188)]();}catch(_0x2cb51a){console[_0x379c03(0x153)](_0x379c03(0x183),_0x2cb51a);}},0x3c*0x3c*0x3e8),console[_0x11e735(0x17e)](_0x11e735(0x182));}['stopPeriodicUpdates'](){const _0x6e9b41=a38_0x1864a3;this['updateInterval']&&(clearInterval(this[_0x6e9b41(0x194)]),this[_0x6e9b41(0x194)]=null,console[_0x6e9b41(0x17e)](_0x6e9b41(0x178)));}async[a38_0x1864a3(0x188)](){const _0x34d16a=a38_0x1864a3;try{console['log'](_0x34d16a(0x192));const _0x4cace2=this[_0x34d16a(0x1a5)][_0x34d16a(0x164)](','),_0x447688=this[_0x34d16a(0x152)]+'?ids=tether&vs_currencies='+_0x4cace2,_0x36f0e6=await fetch(_0x447688,{'headers':{'Accept':_0x34d16a(0x1b7),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x36f0e6['ok'])throw new Error(_0x34d16a(0x161)+_0x36f0e6[_0x34d16a(0x17a)]+'\x20'+_0x36f0e6[_0x34d16a(0x1b2)]);const _0x432e14=await _0x36f0e6[_0x34d16a(0x1af)]();if(!_0x432e14[_0x34d16a(0x149)])throw new Error(_0x34d16a(0x1b4));const _0x4bd7a7=_0x432e14['tether'];console[_0x34d16a(0x17e)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x34d16a(0x186)](_0x4bd7a7)['length']+_0x34d16a(0x14a));const _0x3dc4e2=Object['entries'](_0x4bd7a7)['map'](async([_0xa10e0d,_0x37a0ba])=>{const _0x492bca=_0x34d16a;try{await database_1[_0x492bca(0x1a0)]['currencyRate'][_0x492bca(0x16f)]({'where':{'currency':_0xa10e0d[_0x492bca(0x16b)]()},'update':{'rate':_0x37a0ba},'create':{'currency':_0xa10e0d[_0x492bca(0x16b)](),'rate':_0x37a0ba}});}catch(_0x198678){console['error'](_0x492bca(0x199)+_0xa10e0d+':',_0x198678);}});await Promise['allSettled'](_0x3dc4e2),console[_0x34d16a(0x17e)](_0x34d16a(0x18f));}catch(_0x493ea0){console[_0x34d16a(0x153)](_0x34d16a(0x162),_0x493ea0);throw _0x493ea0;}}async['getCurrencyRate'](_0x57f018){const _0x2dd7da=a38_0x1864a3,_0x3c8005=_0x57f018['toLowerCase']();if(_0x3c8005===_0x2dd7da(0x175))return 0x1;try{const _0x25c1d2=await database_1[_0x2dd7da(0x1a0)]['currencyRate'][_0x2dd7da(0x1a9)]({'where':{'currency':_0x3c8005}});if(!_0x25c1d2)return console[_0x2dd7da(0x140)](_0x2dd7da(0x1b5)+_0x57f018+_0x2dd7da(0x198)),0x1;return _0x25c1d2[_0x2dd7da(0x147)];}catch(_0xd0b72f){return console[_0x2dd7da(0x153)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x57f018+':',_0xd0b72f),0x1;}}async[a38_0x1864a3(0x1ac)](_0x35a41f,_0x3f6a5c){const _0x2734d9=a38_0x1864a3,_0x5158dd=_0x3f6a5c[_0x2734d9(0x16b)]();if(_0x5158dd==='usdt'){const _0x571d09=_0x35a41f*(0x1+this[_0x2734d9(0x185)]/0x64);return console['log'](_0x2734d9(0x189)+this[_0x2734d9(0x185)]+'%\x20markup\x20to\x20'+_0x35a41f+_0x2734d9(0x177)+_0x571d09[_0x2734d9(0x176)](0x6)+_0x2734d9(0x19d)),_0x571d09;}try{const _0x459988=await this[_0x2734d9(0x180)](_0x5158dd),_0x39664a=_0x35a41f/_0x459988,_0x2e3cab=_0x39664a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x2734d9(0x17e)](_0x2734d9(0x1a8)+_0x35a41f+'\x20'+_0x3f6a5c[_0x2734d9(0x19a)]()+'\x20to\x20'+_0x39664a[_0x2734d9(0x176)](0x6)+_0x2734d9(0x148)+this['MARKUP_PERCENTAGE']+_0x2734d9(0x15f)+_0x2e3cab['toFixed'](0x6)+_0x2734d9(0x181)+_0x459988+')'),_0x2e3cab;}catch(_0x26277b){console[_0x2734d9(0x153)]('Error\x20converting\x20'+_0x35a41f+'\x20'+_0x3f6a5c+'\x20to\x20USDT:',_0x26277b);const _0x45f9b8=_0x35a41f*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x45f9b8;}}async['convertMultipleToUSDT'](_0x379680){const _0x584466=a38_0x1864a3;let _0x39b4f3=0x0;for(const {amount:_0x214da2,currency:_0x124143}of _0x379680){const _0x7b4e13=await this[_0x584466(0x1ac)](_0x214da2,_0x124143);_0x39b4f3+=_0x7b4e13;}return _0x39b4f3;}async[a38_0x1864a3(0x15e)](){const _0x4e04fb=a38_0x1864a3;try{const _0x2d3aeb=await database_1['default']['currencyRate'][_0x4e04fb(0x172)]({'select':{'currency':!![],'rate':!![]}}),_0x397454={'usdt':0x1};return _0x2d3aeb[_0x4e04fb(0x17d)](_0x5f1fc2=>{const _0x4cb08b=_0x4e04fb;_0x397454[_0x5f1fc2[_0x4cb08b(0x1b8)]]=_0x5f1fc2[_0x4cb08b(0x147)];}),_0x397454;}catch(_0x5b52a0){return console[_0x4e04fb(0x153)](_0x4e04fb(0x14e),_0x5b52a0),{'usdt':0x1};}}async['getRatesStatus'](){const _0x42f2d8=a38_0x1864a3;try{const [_0x3c187d,_0x5e2ddb,_0xe009f9]=await Promise[_0x42f2d8(0x143)]([database_1[_0x42f2d8(0x1a0)][_0x42f2d8(0x19f)]['count'](),database_1[_0x42f2d8(0x1a0)][_0x42f2d8(0x19f)][_0x42f2d8(0x17f)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x42f2d8(0x1a0)][_0x42f2d8(0x19f)][_0x42f2d8(0x17f)]({'orderBy':{'updatedAt':_0x42f2d8(0x145)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3c187d,'lastUpdated':_0x5e2ddb?.['updatedAt']||null,'oldestRate':_0xe009f9?.[_0x42f2d8(0x163)]||null,'markupPercentage':this[_0x42f2d8(0x185)]};}catch(_0x1b41f5){return console[_0x42f2d8(0x153)]('Error\x20getting\x20rates\x20status:',_0x1b41f5),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x1864a3(0x195)](){const _0x31c1e3=a38_0x1864a3;return this[_0x31c1e3(0x185)];}}exports[a38_0x1864a3(0x19b)]=CurrencyService,exports['currencyService']=new CurrencyService();function a38_0x1152(){const _0x146859=['üí±\x20Applied\x20','277312OuUOpX','try','usd','ltc','aud','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','ngn','1290606utqzuL','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','rub','updateInterval','getMarkupPercentage','8522059MSgagD','yfi',',\x20using\x201\x20as\x20fallback','Failed\x20to\x20update\x20rate\x20for\x20','toUpperCase','CurrencyService','link','\x20USDT','278728nbDarh','currencyRate','default','198790RomTPK','brl','hkd','mxn','CURRENCIES','xlm','__esModule','üí±\x20Converted\x20','findUnique','czk','ars','convertToUSDT','gel','startPeriodicUpdates','json','xau','inr','statusText','nzd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','No\x20rate\x20found\x20for\x20currency:\x20','bch','application/json','currency','twd','warn','btc','eur','all','bnb','asc','dot','rate','\x20USDT,\x20with\x20','tether','\x20currencies','18hVzUtj','lkr','php','Error\x20getting\x20all\x20rates:','bits','ils','gbp','COINGECKO_URL','error','krw','pln','chf','clp','52FOYzwK','nok','pkr','catch','aed','huf','getAllRates','%\x20markup\x20=\x20','vef','CoinGecko\x20API\x20error:\x20','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','updatedAt','join','344vpZNsa','xdr','cny','__importDefault','28151880RCCPYL','Initial\x20currency\x20rates\x20update\x20failed:','toLowerCase','https://api.coingecko.com/api/v3/simple/price','242721WzhyGb','xrp','upsert','uah','bhd','findMany','eos','bdt','usdt','toFixed','\x20USDT\x20=\x20','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','11OokQvB','status','currencyService','sgd','forEach','log','findFirst','getCurrencyRate','\x20USDT\x20(rate:\x20','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Periodic\x20currency\x20rates\x20update\x20failed:','zar','MARKUP_PERCENTAGE','keys','bmd','updateCurrencyRates'];a38_0x1152=function(){return _0x146859;};return a38_0x1152();}