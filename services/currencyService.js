'use strict';const a43_0xd7a178=a43_0x177e;(function(_0x30a5b8,_0x4008d2){const _0xf41ed2=a43_0x177e,_0xf5ec48=_0x30a5b8();while(!![]){try{const _0x5610c9=-parseInt(_0xf41ed2(0x13a))/0x1*(parseInt(_0xf41ed2(0x12a))/0x2)+-parseInt(_0xf41ed2(0x170))/0x3*(-parseInt(_0xf41ed2(0x145))/0x4)+parseInt(_0xf41ed2(0x164))/0x5+parseInt(_0xf41ed2(0x101))/0x6+parseInt(_0xf41ed2(0x11c))/0x7*(parseInt(_0xf41ed2(0x171))/0x8)+parseInt(_0xf41ed2(0x15d))/0x9+-parseInt(_0xf41ed2(0x11b))/0xa;if(_0x5610c9===_0x4008d2)break;else _0xf5ec48['push'](_0xf5ec48['shift']());}catch(_0x7c4931){_0xf5ec48['push'](_0xf5ec48['shift']());}}}(a43_0x310e,0xb69ba));function a43_0x177e(_0x49a24c,_0x1ceafd){const _0x310e7d=a43_0x310e();return a43_0x177e=function(_0x177ef6,_0xd4ccea){_0x177ef6=_0x177ef6-0x101;let _0x56f5c8=_0x310e7d[_0x177ef6];return _0x56f5c8;},a43_0x177e(_0x49a24c,_0x1ceafd);}var __importDefault=this&&this[a43_0xd7a178(0x150)]||function(_0x5aabd3){const _0x217dee=a43_0xd7a178;return _0x5aabd3&&_0x5aabd3[_0x217dee(0x134)]?_0x5aabd3:{'default':_0x5aabd3};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0xd7a178(0x126)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a43_0xd7a178(0x168)));class CurrencyService{constructor(){const _0x13a7f5=a43_0xd7a178;this[_0x13a7f5(0x108)]=_0x13a7f5(0x151),this[_0x13a7f5(0x124)]=[_0x13a7f5(0x163),'eth',_0x13a7f5(0x15c),_0x13a7f5(0x107),'bnb','eos',_0x13a7f5(0x154),_0x13a7f5(0x128),_0x13a7f5(0x110),_0x13a7f5(0x118),_0x13a7f5(0x137),_0x13a7f5(0x174),_0x13a7f5(0x10c),_0x13a7f5(0x162),'aud',_0x13a7f5(0x17c),_0x13a7f5(0x172),_0x13a7f5(0x13e),_0x13a7f5(0x127),_0x13a7f5(0x15e),'chf',_0x13a7f5(0x112),_0x13a7f5(0x115),_0x13a7f5(0x13c),_0x13a7f5(0x12d),_0x13a7f5(0x14d),_0x13a7f5(0x165),_0x13a7f5(0x17d),_0x13a7f5(0x136),'huf',_0x13a7f5(0x169),'ils',_0x13a7f5(0x119),'jpy',_0x13a7f5(0x140),_0x13a7f5(0x175),_0x13a7f5(0x10f),_0x13a7f5(0x155),'mxn',_0x13a7f5(0x133),_0x13a7f5(0x111),_0x13a7f5(0x16f),_0x13a7f5(0x123),_0x13a7f5(0x167),_0x13a7f5(0x10b),'pln',_0x13a7f5(0x106),_0x13a7f5(0x121),_0x13a7f5(0x102),_0x13a7f5(0x16a),'thb',_0x13a7f5(0x12f),'twd',_0x13a7f5(0x109),_0x13a7f5(0x12b),_0x13a7f5(0x132),_0x13a7f5(0x173),_0x13a7f5(0x144),_0x13a7f5(0x114),_0x13a7f5(0x105),'bits',_0x13a7f5(0x16e)],this[_0x13a7f5(0x152)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x13a7f5(0x176)]();}[a43_0xd7a178(0x176)](){const _0x1f7283=a43_0xd7a178;this['updateCurrencyRates']()[_0x1f7283(0x129)](_0x28fd40=>{const _0x39ffcf=_0x1f7283;console[_0x39ffcf(0x15f)](_0x39ffcf(0x15a),_0x28fd40);}),this['updateInterval']=setInterval(async()=>{const _0xe54104=_0x1f7283;try{await this[_0xe54104(0x12c)]();}catch(_0x6aa153){console[_0xe54104(0x15f)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x6aa153);}},0x3c*0x3c*0x3e8),console[_0x1f7283(0x11d)](_0x1f7283(0x13b));}[a43_0xd7a178(0x17b)](){const _0x4c8082=a43_0xd7a178;this['updateInterval']&&(clearInterval(this[_0x4c8082(0x152)]),this[_0x4c8082(0x152)]=null,console['log'](_0x4c8082(0x131)));}async[a43_0xd7a178(0x12c)](){const _0x115270=a43_0xd7a178;try{console[_0x115270(0x11d)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x1d749b=this[_0x115270(0x124)]['join'](','),_0x5ab4c2=this['COINGECKO_URL']+_0x115270(0x13d)+_0x1d749b,_0x5b22a8=await fetch(_0x5ab4c2,{'headers':{'Accept':_0x115270(0x146),'User-Agent':'Payment\x20System/1.0'}});if(!_0x5b22a8['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x5b22a8['status']+'\x20'+_0x5b22a8[_0x115270(0x103)]);const _0x5450f1=await _0x5b22a8['json']();if(!_0x5450f1['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x3362bf=_0x5450f1['tether'];console[_0x115270(0x11d)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x115270(0x104)](_0x3362bf)[_0x115270(0x130)]+_0x115270(0x141));const _0x5018d5=Object[_0x115270(0x158)](_0x3362bf)[_0x115270(0x10a)](async([_0x1990e4,_0x4bc39f])=>{const _0x1f45f5=_0x115270;try{await database_1['default']['currencyRate'][_0x1f45f5(0x177)]({'where':{'currency':_0x1990e4[_0x1f45f5(0x122)]()},'update':{'rate':_0x4bc39f},'create':{'currency':_0x1990e4[_0x1f45f5(0x122)](),'rate':_0x4bc39f}});}catch(_0x12f7d9){console[_0x1f45f5(0x15f)](_0x1f45f5(0x14b)+_0x1990e4+':',_0x12f7d9);}});await Promise[_0x115270(0x11f)](_0x5018d5),console['log'](_0x115270(0x157));}catch(_0x511d4f){console['error'](_0x115270(0x14c),_0x511d4f);throw _0x511d4f;}}async[a43_0xd7a178(0x116)](_0x3142a1){const _0x7ed388=a43_0xd7a178,_0x3e4571=_0x3142a1['toLowerCase']();if(_0x3e4571==='usdt')return 0x1;try{const _0x617f87=await database_1[_0x7ed388(0x11a)][_0x7ed388(0x148)][_0x7ed388(0x178)]({'where':{'currency':_0x3e4571}});if(!_0x617f87)return console[_0x7ed388(0x143)](_0x7ed388(0x113)+_0x3142a1+_0x7ed388(0x139)),0x1;return _0x617f87[_0x7ed388(0x153)];}catch(_0x40ef2f){return console[_0x7ed388(0x15f)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x3142a1+':',_0x40ef2f),0x1;}}async[a43_0xd7a178(0x159)](_0x27f1fa,_0x5438d6){const _0x4203e1=a43_0xd7a178,_0x5d7738=_0x5438d6['toLowerCase']();if(_0x5d7738==='usdt'){const _0x4135ee=_0x27f1fa*(0x1+this[_0x4203e1(0x142)]/0x64);return console[_0x4203e1(0x11d)](_0x4203e1(0x14a)+this[_0x4203e1(0x142)]+_0x4203e1(0x16d)+_0x27f1fa+'\x20USDT\x20=\x20'+_0x4135ee[_0x4203e1(0x138)](0x6)+_0x4203e1(0x16b)),_0x4135ee;}try{const _0x1b074c=await this[_0x4203e1(0x116)](_0x5d7738),_0x23dd9e=_0x27f1fa/_0x1b074c,_0x4f3bc9=_0x23dd9e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x4203e1(0x156)+_0x27f1fa+'\x20'+_0x5438d6[_0x4203e1(0x160)]()+_0x4203e1(0x12e)+_0x23dd9e['toFixed'](0x6)+_0x4203e1(0x10d)+this[_0x4203e1(0x142)]+'%\x20markup\x20=\x20'+_0x4f3bc9[_0x4203e1(0x138)](0x6)+'\x20USDT\x20(rate:\x20'+_0x1b074c+')'),_0x4f3bc9;}catch(_0x1b81f1){console[_0x4203e1(0x15f)](_0x4203e1(0x17a)+_0x27f1fa+'\x20'+_0x5438d6+_0x4203e1(0x14e),_0x1b81f1);const _0x3a970e=_0x27f1fa*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3a970e;}}async['convertMultipleToUSDT'](_0x1c439a){const _0x8eca05=a43_0xd7a178;let _0xfb0015=0x0;for(const {amount:_0xb8495b,currency:_0x4ec55a}of _0x1c439a){const _0x1dd409=await this[_0x8eca05(0x159)](_0xb8495b,_0x4ec55a);_0xfb0015+=_0x1dd409;}return _0xfb0015;}async[a43_0xd7a178(0x13f)](){const _0x29f7b5=a43_0xd7a178;try{const _0x2c08eb=await database_1[_0x29f7b5(0x11a)][_0x29f7b5(0x148)][_0x29f7b5(0x135)]({'select':{'currency':!![],'rate':!![]}}),_0x547630={'usdt':0x1};return _0x2c08eb[_0x29f7b5(0x14f)](_0x352f1e=>{const _0x4ad38e=_0x29f7b5;_0x547630[_0x352f1e[_0x4ad38e(0x149)]]=_0x352f1e[_0x4ad38e(0x153)];}),_0x547630;}catch(_0x3e30f5){return console[_0x29f7b5(0x15f)](_0x29f7b5(0x15b),_0x3e30f5),{'usdt':0x1};}}async[a43_0xd7a178(0x147)](){const _0x7d2698=a43_0xd7a178;try{const [_0x41a61e,_0x192b49,_0x380f5e]=await Promise[_0x7d2698(0x16c)]([database_1['default']['currencyRate'][_0x7d2698(0x120)](),database_1[_0x7d2698(0x11a)]['currencyRate'][_0x7d2698(0x166)]({'orderBy':{'updatedAt':_0x7d2698(0x179)},'select':{'updatedAt':!![]}}),database_1[_0x7d2698(0x11a)][_0x7d2698(0x148)][_0x7d2698(0x166)]({'orderBy':{'updatedAt':_0x7d2698(0x161)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x41a61e,'lastUpdated':_0x192b49?.[_0x7d2698(0x10e)]||null,'oldestRate':_0x380f5e?.[_0x7d2698(0x10e)]||null,'markupPercentage':this[_0x7d2698(0x142)]};}catch(_0x92d3f8){return console[_0x7d2698(0x15f)](_0x7d2698(0x117),_0x92d3f8),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x7d2698(0x142)]};}}[a43_0xd7a178(0x125)](){const _0x300563=a43_0xd7a178;return this[_0x300563(0x142)];}}function a43_0x310e(){const _0x3c4ea7=['cny','getCurrencyRate','Error\x20getting\x20rates\x20status:','dot','inr','default','29565790YRiUOZ','4964477uSzGQk','log','CurrencyService','allSettled','count','sar','toLowerCase','nzd','CURRENCIES','getMarkupPercentage','currencyService','brl','xlm','catch','1364274rcyVPZ','vef','updateCurrencyRates','dkk','\x20to\x20','try','length','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','vnd','myr','__esModule','findMany','hkd','yfi','toFixed',',\x20using\x201\x20as\x20fallback','1mzDzxr','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','czk','?ids=tether&vs_currencies=','bmd','getAllRates','krw','\x20currencies','MARKUP_PERCENTAGE','warn','xdr','4nIeDaG','application/json','getRatesStatus','currencyRate','currency','üí±\x20Applied\x20','Failed\x20to\x20update\x20rate\x20for\x20','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','eur','\x20to\x20USDT:','forEach','__importDefault','https://api.coingecko.com/api/v3/simple/price','updateInterval','rate','xrp','mmk','üí±\x20Converted\x20','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','entries','convertToUSDT','Initial\x20currency\x20rates\x20update\x20failed:','Error\x20getting\x20all\x20rates:','ltc','10001223kyuMax','cad','error','toUpperCase','asc','ars','btc','5552795ZmAEpt','gbp','findFirst','php','../config/database','idr','sgd','\x20USDT','all','%\x20markup\x20to\x20','sats','nok','3247761gkHGng','8rOnExw','bhd','zar','usd','kwd','startPeriodicUpdates','upsert','findUnique','desc','Error\x20converting\x20','stopPeriodicUpdates','bdt','gel','2238444vghWqJ','sek','statusText','keys','xau','rub','bch','COINGECKO_URL','uah','map','pkr','aed','\x20USDT,\x20with\x20','updatedAt','lkr','link','ngn','clp','No\x20rate\x20found\x20for\x20currency:\x20','xag'];a43_0x310e=function(){return _0x3c4ea7;};return a43_0x310e();}exports[a43_0xd7a178(0x11e)]=CurrencyService,exports[a43_0xd7a178(0x126)]=new CurrencyService();