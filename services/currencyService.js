'use strict';const a51_0x3e116d=a51_0x3702;(function(_0x34d197,_0x9a0474){const _0x55d33f=a51_0x3702,_0x49e4d9=_0x34d197();while(!![]){try{const _0x5c0d92=parseInt(_0x55d33f(0x229))/0x1+-parseInt(_0x55d33f(0x1e3))/0x2+-parseInt(_0x55d33f(0x225))/0x3*(parseInt(_0x55d33f(0x1c1))/0x4)+parseInt(_0x55d33f(0x1b7))/0x5*(-parseInt(_0x55d33f(0x1b1))/0x6)+parseInt(_0x55d33f(0x1fa))/0x7*(-parseInt(_0x55d33f(0x1f8))/0x8)+parseInt(_0x55d33f(0x209))/0x9*(parseInt(_0x55d33f(0x1ec))/0xa)+parseInt(_0x55d33f(0x20c))/0xb;if(_0x5c0d92===_0x9a0474)break;else _0x49e4d9['push'](_0x49e4d9['shift']());}catch(_0x40be2e){_0x49e4d9['push'](_0x49e4d9['shift']());}}}(a51_0x4572,0xb1a0a));function a51_0x3702(_0x40467a,_0x293dd7){_0x40467a=_0x40467a-0x1b1;const _0x4572e4=a51_0x4572();let _0x3702ad=_0x4572e4[_0x40467a];return _0x3702ad;}var __importDefault=this&&this[a51_0x3e116d(0x203)]||function(_0x1a45a4){const _0x1ba0a5=a51_0x3e116d;return _0x1a45a4&&_0x1a45a4[_0x1ba0a5(0x1da)]?_0x1a45a4:{'default':_0x1a45a4};};Object[a51_0x3e116d(0x221)](exports,'__esModule',{'value':!![]}),exports[a51_0x3e116d(0x210)]=exports[a51_0x3e116d(0x213)]=void 0x0;const database_1=__importDefault(require(a51_0x3e116d(0x1c3)));function a51_0x4572(){const _0x3b7c24=['CoinGecko\x20API\x20error:\x20','toFixed','eos','cad','length','map','kwd','âœ…\x20Currency\x20rates\x20updated\x20successfully','btc','__esModule','vnd','updateInterval','xdr','bits','ðŸ’±\x20Converted\x20','bmd','convertMultipleToUSDT','asc','920432NiGyaG','bch','\x20USDT\x20=\x20','toLowerCase','xag','ars','\x20to\x20USDT:','brl','bhd','157090VdZCnn','MARKUP_PERCENTAGE','mxn','Periodic\x20currency\x20rates\x20update\x20failed:','findMany','rate','ðŸ’±\x20Applied\x20','currencyRate','currency','getCurrencyRate','ltc','upsert','24iNGgyz','error','1645126koXhJY','Payment\x20System/1.0','stopPeriodicUpdates','nok','\x20USDT','forEach','desc','vef','ðŸ“Š\x20Received\x20rates\x20for\x20','__importDefault','log','sats','allSettled','jpy','Error\x20getting\x20all\x20rates:','657DZDDtn','gel','startPeriodicUpdates','16333966HnjTLH','huf','clp','CURRENCIES','currencyService','php','sar','CurrencyService','COINGECKO_URL','convertToUSDT','%\x20markup\x20=\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','findUnique','warn','Initial\x20currency\x20rates\x20update\x20failed:','findFirst','statusText','ils','krw','eth','chf','defineProperty','application/json','getAllRates','myr','820299rUlgMX','getRatesStatus','bnb','nzd','1381530BCppta','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','entries','link','try','1129794OgBUbK','catch','No\x20rate\x20found\x20for\x20currency:\x20','Error\x20converting\x20','xlm','eur','20uHbtJE','tether','?ids=tether&vs_currencies=','yfi','czk','xrp','pkr','hkd','default','aud','20LegaWX','uah','../config/database','keys','getMarkupPercentage','updatedAt','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','count','\x20USDT\x20(rate:\x20','updateCurrencyRates','mmk','aed','bdt','pln','inr','zar'];a51_0x4572=function(){return _0x3b7c24;};return a51_0x4572();}class CurrencyService{constructor(){const _0x71ad9f=a51_0x3e116d;this[_0x71ad9f(0x214)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x71ad9f(0x1d9),_0x71ad9f(0x21f),_0x71ad9f(0x1f6),_0x71ad9f(0x1e4),_0x71ad9f(0x227),_0x71ad9f(0x1d3),_0x71ad9f(0x1bc),_0x71ad9f(0x1b5),_0x71ad9f(0x22c),'dot',_0x71ad9f(0x1ba),'usd',_0x71ad9f(0x1cc),_0x71ad9f(0x1e8),_0x71ad9f(0x1c0),_0x71ad9f(0x1cd),_0x71ad9f(0x1eb),_0x71ad9f(0x1e0),_0x71ad9f(0x1ea),_0x71ad9f(0x1d4),_0x71ad9f(0x220),_0x71ad9f(0x20e),'cny',_0x71ad9f(0x1bb),'dkk',_0x71ad9f(0x1b6),'gbp',_0x71ad9f(0x20a),_0x71ad9f(0x1be),_0x71ad9f(0x20d),'idr',_0x71ad9f(0x21d),_0x71ad9f(0x1cf),_0x71ad9f(0x207),_0x71ad9f(0x21e),_0x71ad9f(0x1d7),'lkr',_0x71ad9f(0x1cb),_0x71ad9f(0x1ee),_0x71ad9f(0x224),'ngn',_0x71ad9f(0x1fd),_0x71ad9f(0x228),_0x71ad9f(0x211),_0x71ad9f(0x1bd),_0x71ad9f(0x1ce),'rub',_0x71ad9f(0x212),'sek','sgd','thb',_0x71ad9f(0x22d),'twd',_0x71ad9f(0x1c2),_0x71ad9f(0x201),_0x71ad9f(0x1db),_0x71ad9f(0x1d0),_0x71ad9f(0x1dd),_0x71ad9f(0x1e7),'xau',_0x71ad9f(0x1de),_0x71ad9f(0x205)],this[_0x71ad9f(0x1dc)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x71ad9f(0x20b)]();}[a51_0x3e116d(0x20b)](){const _0x4597ee=a51_0x3e116d;this[_0x4597ee(0x1ca)]()[_0x4597ee(0x1b2)](_0x27a1eb=>{const _0x1ccce1=_0x4597ee;console['error'](_0x1ccce1(0x21a),_0x27a1eb);}),this['updateInterval']=setInterval(async()=>{const _0x2e3cd7=_0x4597ee;try{await this['updateCurrencyRates']();}catch(_0x464fa2){console[_0x2e3cd7(0x1f9)](_0x2e3cd7(0x1ef),_0x464fa2);}},0x3c*0x3c*0x3e8),console['log']('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a51_0x3e116d(0x1fc)](){const _0xd87e43=a51_0x3e116d;this[_0xd87e43(0x1dc)]&&(clearInterval(this['updateInterval']),this[_0xd87e43(0x1dc)]=null,console[_0xd87e43(0x204)](_0xd87e43(0x1c7)));}async[a51_0x3e116d(0x1ca)](){const _0x18fe21=a51_0x3e116d;try{console['log']('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xf26211=this[_0x18fe21(0x20f)]['join'](','),_0x3fed2a=this[_0x18fe21(0x214)]+_0x18fe21(0x1b9)+_0xf26211,_0x4b25e0=await fetch(_0x3fed2a,{'headers':{'Accept':_0x18fe21(0x222),'User-Agent':_0x18fe21(0x1fb)}});if(!_0x4b25e0['ok'])throw new Error(_0x18fe21(0x1d1)+_0x4b25e0['status']+'\x20'+_0x4b25e0[_0x18fe21(0x21c)]);const _0x22e1cf=await _0x4b25e0['json']();if(!_0x22e1cf['tether'])throw new Error(_0x18fe21(0x217));const _0x4e9152=_0x22e1cf[_0x18fe21(0x1b8)];console[_0x18fe21(0x204)](_0x18fe21(0x202)+Object[_0x18fe21(0x1c4)](_0x4e9152)[_0x18fe21(0x1d5)]+'\x20currencies');const _0x591852=Object[_0x18fe21(0x22b)](_0x4e9152)[_0x18fe21(0x1d6)](async([_0x5c56fe,_0x51c309])=>{const _0x294ffd=_0x18fe21;try{await database_1[_0x294ffd(0x1bf)][_0x294ffd(0x1f3)][_0x294ffd(0x1f7)]({'where':{'currency':_0x5c56fe[_0x294ffd(0x1e6)]()},'update':{'rate':_0x51c309},'create':{'currency':_0x5c56fe[_0x294ffd(0x1e6)](),'rate':_0x51c309}});}catch(_0x292f20){console[_0x294ffd(0x1f9)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x5c56fe+':',_0x292f20);}});await Promise[_0x18fe21(0x206)](_0x591852),console['log'](_0x18fe21(0x1d8));}catch(_0x1fbbcd){console[_0x18fe21(0x1f9)](_0x18fe21(0x22a),_0x1fbbcd);throw _0x1fbbcd;}}async[a51_0x3e116d(0x1f5)](_0x4cb335){const _0x14b880=a51_0x3e116d,_0x4e80d4=_0x4cb335['toLowerCase']();if(_0x4e80d4==='usdt')return 0x1;try{const _0x2f68b1=await database_1[_0x14b880(0x1bf)][_0x14b880(0x1f3)][_0x14b880(0x218)]({'where':{'currency':_0x4e80d4}});if(!_0x2f68b1)return console[_0x14b880(0x219)](_0x14b880(0x1b3)+_0x4cb335+',\x20using\x201\x20as\x20fallback'),0x1;return _0x2f68b1[_0x14b880(0x1f1)];}catch(_0x14cf6a){return console[_0x14b880(0x1f9)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x4cb335+':',_0x14cf6a),0x1;}}async[a51_0x3e116d(0x215)](_0x18e8bd,_0xf42951){const _0x2360e=a51_0x3e116d,_0x1655ff=_0xf42951[_0x2360e(0x1e6)]();if(_0x1655ff==='usdt'){const _0xfccde1=_0x18e8bd*(0x1+this[_0x2360e(0x1ed)]/0x64);return console[_0x2360e(0x204)](_0x2360e(0x1f2)+this[_0x2360e(0x1ed)]+'%\x20markup\x20to\x20'+_0x18e8bd+_0x2360e(0x1e5)+_0xfccde1['toFixed'](0x6)+_0x2360e(0x1fe)),_0xfccde1;}try{const _0x5daeab=await this[_0x2360e(0x1f5)](_0x1655ff),_0x3190f3=_0x18e8bd/_0x5daeab,_0x4618a2=_0x3190f3*(0x1+this[_0x2360e(0x1ed)]/0x64);return console[_0x2360e(0x204)](_0x2360e(0x1df)+_0x18e8bd+'\x20'+_0xf42951['toUpperCase']()+'\x20to\x20'+_0x3190f3[_0x2360e(0x1d2)](0x6)+'\x20USDT,\x20with\x20'+this[_0x2360e(0x1ed)]+_0x2360e(0x216)+_0x4618a2['toFixed'](0x6)+_0x2360e(0x1c9)+_0x5daeab+')'),_0x4618a2;}catch(_0x55352c){console[_0x2360e(0x1f9)](_0x2360e(0x1b4)+_0x18e8bd+'\x20'+_0xf42951+_0x2360e(0x1e9),_0x55352c);const _0x224bdb=_0x18e8bd*(0x1+this[_0x2360e(0x1ed)]/0x64);return _0x224bdb;}}async[a51_0x3e116d(0x1e1)](_0x2a4e4b){const _0x3398f3=a51_0x3e116d;let _0x6e56f2=0x0;for(const {amount:_0x4683b2,currency:_0x257ca9}of _0x2a4e4b){const _0x123e7b=await this[_0x3398f3(0x215)](_0x4683b2,_0x257ca9);_0x6e56f2+=_0x123e7b;}return _0x6e56f2;}async[a51_0x3e116d(0x223)](){const _0x315e78=a51_0x3e116d;try{const _0x4ce4f4=await database_1[_0x315e78(0x1bf)][_0x315e78(0x1f3)][_0x315e78(0x1f0)]({'select':{'currency':!![],'rate':!![]}}),_0x537723={'usdt':0x1};return _0x4ce4f4[_0x315e78(0x1ff)](_0x9fd705=>{const _0x3c3b12=_0x315e78;_0x537723[_0x9fd705[_0x3c3b12(0x1f4)]]=_0x9fd705[_0x3c3b12(0x1f1)];}),_0x537723;}catch(_0x27409b){return console[_0x315e78(0x1f9)](_0x315e78(0x208),_0x27409b),{'usdt':0x1};}}async[a51_0x3e116d(0x226)](){const _0x3b4055=a51_0x3e116d;try{const [_0x5a6f70,_0x1c5f66,_0x309429]=await Promise['all']([database_1[_0x3b4055(0x1bf)][_0x3b4055(0x1f3)][_0x3b4055(0x1c8)](),database_1[_0x3b4055(0x1bf)][_0x3b4055(0x1f3)]['findFirst']({'orderBy':{'updatedAt':_0x3b4055(0x200)},'select':{'updatedAt':!![]}}),database_1[_0x3b4055(0x1bf)]['currencyRate'][_0x3b4055(0x21b)]({'orderBy':{'updatedAt':_0x3b4055(0x1e2)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5a6f70,'lastUpdated':_0x1c5f66?.[_0x3b4055(0x1c6)]||null,'oldestRate':_0x309429?.['updatedAt']||null,'markupPercentage':this[_0x3b4055(0x1ed)]};}catch(_0x512168){return console[_0x3b4055(0x1f9)]('Error\x20getting\x20rates\x20status:',_0x512168),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3b4055(0x1ed)]};}}[a51_0x3e116d(0x1c5)](){const _0x33d819=a51_0x3e116d;return this[_0x33d819(0x1ed)];}}exports[a51_0x3e116d(0x213)]=CurrencyService,exports[a51_0x3e116d(0x210)]=new CurrencyService();