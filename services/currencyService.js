'use strict';const a38_0x350a3a=a38_0x1549;(function(_0x3cf643,_0x5c7bc5){const _0x1d983f=a38_0x1549,_0x1cacad=_0x3cf643();while(!![]){try{const _0xa1eba6=parseInt(_0x1d983f(0x130))/0x1*(-parseInt(_0x1d983f(0x135))/0x2)+parseInt(_0x1d983f(0xfb))/0x3*(parseInt(_0x1d983f(0xee))/0x4)+-parseInt(_0x1d983f(0xf5))/0x5+parseInt(_0x1d983f(0xff))/0x6+-parseInt(_0x1d983f(0xda))/0x7+parseInt(_0x1d983f(0xfa))/0x8+parseInt(_0x1d983f(0xcf))/0x9;if(_0xa1eba6===_0x5c7bc5)break;else _0x1cacad['push'](_0x1cacad['shift']());}catch(_0x54b840){_0x1cacad['push'](_0x1cacad['shift']());}}}(a38_0x251a,0x42581));var __importDefault=this&&this['__importDefault']||function(_0x4cb358){const _0x2dc76a=a38_0x1549;return _0x4cb358&&_0x4cb358[_0x2dc76a(0x112)]?_0x4cb358:{'default':_0x4cb358};};Object[a38_0x350a3a(0xdd)](exports,a38_0x350a3a(0x112),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x385ee4=a38_0x350a3a;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x385ee4(0x11f)]=[_0x385ee4(0x129),'eth',_0x385ee4(0x104),_0x385ee4(0x134),'bnb',_0x385ee4(0x111),'xrp',_0x385ee4(0xed),_0x385ee4(0x106),'dot',_0x385ee4(0x117),'usd',_0x385ee4(0xe1),_0x385ee4(0xf9),'aud',_0x385ee4(0x10f),'bhd',_0x385ee4(0x121),_0x385ee4(0xdc),'cad','chf',_0x385ee4(0xcd),_0x385ee4(0x122),'czk',_0x385ee4(0xca),_0x385ee4(0xef),_0x385ee4(0x100),_0x385ee4(0x132),'hkd','huf',_0x385ee4(0xeb),'ils',_0x385ee4(0x109),_0x385ee4(0x107),_0x385ee4(0xec),_0x385ee4(0x108),'lkr',_0x385ee4(0xde),_0x385ee4(0xfe),_0x385ee4(0x12e),'ngn',_0x385ee4(0xf6),_0x385ee4(0x114),_0x385ee4(0x118),_0x385ee4(0x12f),'pln','rub',_0x385ee4(0xea),_0x385ee4(0xe0),_0x385ee4(0x110),'thb',_0x385ee4(0x12a),_0x385ee4(0x12c),_0x385ee4(0xf2),_0x385ee4(0xd9),_0x385ee4(0x137),_0x385ee4(0xd4),_0x385ee4(0xcb),'xag',_0x385ee4(0x10b),_0x385ee4(0xe8),'sats'],this[_0x385ee4(0xdf)]=null,this[_0x385ee4(0x123)]=0x3,this[_0x385ee4(0x11a)]();}[a38_0x350a3a(0x11a)](){const _0x5a7621=a38_0x350a3a;this[_0x5a7621(0xf1)]()['catch'](_0x1b2f31=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x1b2f31);}),this[_0x5a7621(0xdf)]=setInterval(async()=>{const _0x4c6e1e=_0x5a7621;try{await this['updateCurrencyRates']();}catch(_0x122720){console[_0x4c6e1e(0xd2)](_0x4c6e1e(0x12b),_0x122720);}},0x3c*0x3c*0x3e8),console[_0x5a7621(0xe4)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x350a3a(0x12d)](){const _0x527c12=a38_0x350a3a;this[_0x527c12(0xdf)]&&(clearInterval(this[_0x527c12(0xdf)]),this[_0x527c12(0xdf)]=null,console[_0x527c12(0xe4)](_0x527c12(0xe3)));}async[a38_0x350a3a(0xf1)](){const _0x789444=a38_0x350a3a;try{console[_0x789444(0xe4)](_0x789444(0xce));const _0x517e71=this[_0x789444(0x11f)][_0x789444(0xf7)](','),_0x1e6570=this[_0x789444(0x102)]+_0x789444(0xe2)+_0x517e71,_0xdb8e14=await fetch(_0x1e6570,{'headers':{'Accept':_0x789444(0xc8),'User-Agent':_0x789444(0x10c)}});if(!_0xdb8e14['ok'])throw new Error(_0x789444(0xd7)+_0xdb8e14[_0x789444(0x10d)]+'\x20'+_0xdb8e14[_0x789444(0x11b)]);const _0x351312=await _0xdb8e14[_0x789444(0x136)]();if(!_0x351312[_0x789444(0xc7)])throw new Error(_0x789444(0xd6));const _0x352616=_0x351312[_0x789444(0xc7)];console[_0x789444(0xe4)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x789444(0x105)](_0x352616)[_0x789444(0xe6)]+_0x789444(0xd0));const _0x5dde13=Object['entries'](_0x352616)[_0x789444(0x11c)](async([_0x328f13,_0x2687b2])=>{const _0xbc4dff=_0x789444;try{await database_1[_0xbc4dff(0xc9)]['currencyRate'][_0xbc4dff(0xe5)]({'where':{'currency':_0x328f13[_0xbc4dff(0xfc)]()},'update':{'rate':_0x2687b2},'create':{'currency':_0x328f13[_0xbc4dff(0xfc)](),'rate':_0x2687b2}});}catch(_0x5f19cf){console[_0xbc4dff(0xd2)](_0xbc4dff(0x11d)+_0x328f13+':',_0x5f19cf);}});await Promise['allSettled'](_0x5dde13),console['log'](_0x789444(0x120));}catch(_0x453475){console[_0x789444(0xd2)](_0x789444(0xfd),_0x453475);throw _0x453475;}}async['getCurrencyRate'](_0x5a4303){const _0x590724=a38_0x350a3a,_0x4c31bd=_0x5a4303[_0x590724(0xfc)]();if(_0x4c31bd===_0x590724(0x124))return 0x1;try{const _0x444d11=await database_1[_0x590724(0xc9)]['currencyRate']['findUnique']({'where':{'currency':_0x4c31bd}});if(!_0x444d11)return console['warn'](_0x590724(0xf8)+_0x5a4303+',\x20using\x201\x20as\x20fallback'),0x1;return _0x444d11[_0x590724(0x125)];}catch(_0x4b3062){return console[_0x590724(0xd2)](_0x590724(0xdb)+_0x5a4303+':',_0x4b3062),0x1;}}async[a38_0x350a3a(0xd5)](_0x5ceb5a,_0x4ebc07){const _0x1e4dab=a38_0x350a3a,_0x5261cf=_0x4ebc07[_0x1e4dab(0xfc)]();if(_0x5261cf===_0x1e4dab(0x124)){const _0x496125=_0x5ceb5a*(0x1+this[_0x1e4dab(0x123)]/0x64);return console[_0x1e4dab(0xe4)]('üí±\x20Applied\x20'+this[_0x1e4dab(0x123)]+_0x1e4dab(0xf4)+_0x5ceb5a+'\x20USDT\x20=\x20'+_0x496125[_0x1e4dab(0x115)](0x6)+'\x20USDT'),_0x496125;}try{const _0x543cd2=await this[_0x1e4dab(0x11e)](_0x5261cf),_0x492f20=_0x5ceb5a/_0x543cd2,_0x1625c8=_0x492f20*(0x1+this[_0x1e4dab(0x123)]/0x64);return console[_0x1e4dab(0xe4)](_0x1e4dab(0x10a)+_0x5ceb5a+'\x20'+_0x4ebc07[_0x1e4dab(0x126)]()+'\x20to\x20'+_0x492f20['toFixed'](0x6)+_0x1e4dab(0xd8)+this[_0x1e4dab(0x123)]+_0x1e4dab(0x128)+_0x1625c8[_0x1e4dab(0x115)](0x6)+_0x1e4dab(0xf0)+_0x543cd2+')'),_0x1625c8;}catch(_0x2e96b4){console[_0x1e4dab(0xd2)](_0x1e4dab(0xd3)+_0x5ceb5a+'\x20'+_0x4ebc07+_0x1e4dab(0x119),_0x2e96b4);const _0x4203a6=_0x5ceb5a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x4203a6;}}async[a38_0x350a3a(0x116)](_0x27b145){const _0x109ec7=a38_0x350a3a;let _0x1784fd=0x0;for(const {amount:_0x63b242,currency:_0xdb61c3}of _0x27b145){const _0x20990f=await this[_0x109ec7(0xd5)](_0x63b242,_0xdb61c3);_0x1784fd+=_0x20990f;}return _0x1784fd;}async[a38_0x350a3a(0xe9)](){const _0x258361=a38_0x350a3a;try{const _0x285dfa=await database_1[_0x258361(0xc9)][_0x258361(0x133)][_0x258361(0x10e)]({'select':{'currency':!![],'rate':!![]}}),_0xa85ed7={'usdt':0x1};return _0x285dfa['forEach'](_0xadd516=>{const _0x5e0def=_0x258361;_0xa85ed7[_0xadd516[_0x5e0def(0x101)]]=_0xadd516['rate'];}),_0xa85ed7;}catch(_0x4d3fb5){return console[_0x258361(0xd2)](_0x258361(0xf3),_0x4d3fb5),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4f4118=a38_0x350a3a;try{const [_0x1a7c92,_0xdfeea2,_0x1499d3]=await Promise[_0x4f4118(0x113)]([database_1[_0x4f4118(0xc9)][_0x4f4118(0x133)][_0x4f4118(0xcc)](),database_1[_0x4f4118(0xc9)][_0x4f4118(0x133)]['findFirst']({'orderBy':{'updatedAt':_0x4f4118(0xe7)},'select':{'updatedAt':!![]}}),database_1[_0x4f4118(0xc9)][_0x4f4118(0x133)]['findFirst']({'orderBy':{'updatedAt':_0x4f4118(0xd1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1a7c92,'lastUpdated':_0xdfeea2?.[_0x4f4118(0x131)]||null,'oldestRate':_0x1499d3?.[_0x4f4118(0x131)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x456a96){return console[_0x4f4118(0xd2)]('Error\x20getting\x20rates\x20status:',_0x456a96),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4f4118(0x123)]};}}[a38_0x350a3a(0x127)](){const _0x3e9ac8=a38_0x350a3a;return this[_0x3e9ac8(0x123)];}}function a38_0x1549(_0x455974,_0x59c2aa){const _0x251a5d=a38_0x251a();return a38_0x1549=function(_0x154938,_0x44612e){_0x154938=_0x154938-0xc7;let _0x35a8e2=_0x251a5d[_0x154938];return _0x35a8e2;},a38_0x1549(_0x455974,_0x59c2aa);}exports[a38_0x350a3a(0x103)]=CurrencyService,exports['currencyService']=new CurrencyService();function a38_0x251a(){const _0xf927ed=['json','vnd','tether','application/json','default','dkk','xdr','count','clp','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','4083318PBTUcA','\x20currencies','asc','error','Error\x20converting\x20','zar','convertToUSDT','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','CoinGecko\x20API\x20error:\x20','\x20USDT,\x20with\x20','vef','38388gppyyd','Error\x20getting\x20rate\x20for\x20currency\x20','brl','defineProperty','mmk','updateInterval','sek','aed','?ids=tether&vs_currencies=','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','log','upsert','length','desc','bits','getAllRates','sar','idr','krw','xlm','52712eQyLTq','eur','\x20USDT\x20(rate:\x20','updateCurrencyRates','uah','Error\x20getting\x20all\x20rates:','%\x20markup\x20to\x20','2284095HSOlmq','nok','join','No\x20rate\x20found\x20for\x20currency:\x20','ars','4138408bChIpe','6pVgztT','toLowerCase','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','mxn','352026IZahcb','gbp','currency','COINGECKO_URL','CurrencyService','ltc','keys','link','jpy','kwd','inr','üí±\x20Converted\x20','xau','TesSoft\x20Payment\x20System/1.0','status','findMany','bdt','sgd','eos','__esModule','all','nzd','toFixed','convertMultipleToUSDT','yfi','php','\x20to\x20USDT:','startPeriodicUpdates','statusText','map','Failed\x20to\x20update\x20rate\x20for\x20','getCurrencyRate','CURRENCIES','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','bmd','cny','MARKUP_PERCENTAGE','usdt','rate','toUpperCase','getMarkupPercentage','%\x20markup\x20=\x20','btc','try','Periodic\x20currency\x20rates\x20update\x20failed:','twd','stopPeriodicUpdates','myr','pkr','398cHjdhC','updatedAt','gel','currencyRate','bch','1618idKuYT'];a38_0x251a=function(){return _0xf927ed;};return a38_0x251a();}