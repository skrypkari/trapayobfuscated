'use strict';function a38_0x518a(){const _0xc9ec15=['tether','bmd','CURRENCIES','2981408Cqwlig','xrp','mmk','CurrencyService','usdt','link','No\x20rate\x20found\x20for\x20currency:\x20','stopPeriodicUpdates','✅\x20Currency\x20rates\x20updated\x20successfully','bdt','length','yfi','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','findFirst','Error\x20getting\x20rates\x20status:','vef','updateCurrencyRates','xag','vnd','error','myr','61352KoRQWq','keys','MARKUP_PERCENTAGE','sek','23797550ajpXjs','krw','../config/database','Error\x20getting\x20rate\x20for\x20currency\x20','inr','Failed\x20to\x20update\x20rate\x20for\x20','6113065TFgEYQ','desc','mxn','cny','\x20USDT','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','jpy','all','uah','currencyService','Initial\x20currency\x20rates\x20update\x20failed:','📊\x20Received\x20rates\x20for\x20','ltc','bnb','toUpperCase','6aXuPWi','💱\x20Applied\x20','sar','getCurrencyRate','sats','application/json','log','findMany','xdr','ars','Error\x20converting\x20','allSettled','💱\x20Converted\x20','aud','sgd','currencyRate','twd','php','3844506XpMVbk','btc','eos','startPeriodicUpdates','\x20USDT\x20(rate:\x20','dkk','rub','bch','status','default','clp','COINGECKO_URL','\x20currencies','dot','cad','count','xlm','Error\x20getting\x20all\x20rates:','toFixed','usd','kwd','upsert','❌\x20Failed\x20to\x20update\x20currency\x20rates:','findUnique','eur','980136SxKmHH','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','bits','TesSoft\x20Payment\x20System/1.0','convertMultipleToUSDT','CoinGecko\x20API\x20error:\x20','1203444jfXbeI','aed','getRatesStatus','1413nUxoER','__esModule','hkd','pln','14EsUyLB','\x20USDT,\x20with\x20','xau','statusText','convertToUSDT','idr','brl','chf','toLowerCase','updatedAt','eth','\x20to\x20','warn','updateInterval'];a38_0x518a=function(){return _0xc9ec15;};return a38_0x518a();}const a38_0x5a239e=a38_0x3cff;(function(_0x251f8d,_0x3a3ab3){const _0x48db49=a38_0x3cff,_0xdbf358=_0x251f8d();while(!![]){try{const _0x3c65bc=-parseInt(_0x48db49(0x1d1))/0x1+-parseInt(_0x48db49(0x242))/0x2+-parseInt(_0x48db49(0x217))/0x3*(-parseInt(_0x48db49(0x1e9))/0x4)+-parseInt(_0x48db49(0x208))/0x5+-parseInt(_0x48db49(0x229))/0x6*(parseInt(_0x48db49(0x1d8))/0x7)+parseInt(_0x48db49(0x1fe))/0x8*(parseInt(_0x48db49(0x1d4))/0x9)+parseInt(_0x48db49(0x202))/0xa;if(_0x3c65bc===_0x3a3ab3)break;else _0xdbf358['push'](_0xdbf358['shift']());}catch(_0x441bc1){_0xdbf358['push'](_0xdbf358['shift']());}}}(a38_0x518a,0xd6141));var __importDefault=this&&this['__importDefault']||function(_0x45add6){const _0x4c363e=a38_0x3cff;return _0x45add6&&_0x45add6[_0x4c363e(0x1d5)]?_0x45add6:{'default':_0x45add6};};function a38_0x3cff(_0x4ab2d5,_0x44cc50){const _0x518a49=a38_0x518a();return a38_0x3cff=function(_0x3cff83,_0x4634bb){_0x3cff83=_0x3cff83-0x1ce;let _0x27b1a2=_0x518a49[_0x3cff83];return _0x27b1a2;},a38_0x3cff(_0x4ab2d5,_0x44cc50);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x5a239e(0x211)]=exports[a38_0x5a239e(0x1ec)]=void 0x0;const database_1=__importDefault(require(a38_0x5a239e(0x204)));class CurrencyService{constructor(){const _0x489b8d=a38_0x5a239e;this[_0x489b8d(0x234)]='https://api.coingecko.com/api/v3/simple/price',this[_0x489b8d(0x1e8)]=[_0x489b8d(0x22a),_0x489b8d(0x1e2),_0x489b8d(0x214),_0x489b8d(0x230),_0x489b8d(0x215),_0x489b8d(0x22b),_0x489b8d(0x1ea),_0x489b8d(0x239),_0x489b8d(0x1ee),_0x489b8d(0x236),_0x489b8d(0x1f4),_0x489b8d(0x23c),_0x489b8d(0x1d2),_0x489b8d(0x220),_0x489b8d(0x224),_0x489b8d(0x1f2),'bhd',_0x489b8d(0x1e7),_0x489b8d(0x1de),_0x489b8d(0x237),_0x489b8d(0x1df),_0x489b8d(0x233),_0x489b8d(0x20b),'czk',_0x489b8d(0x22e),_0x489b8d(0x241),'gbp','gel',_0x489b8d(0x1d6),'huf',_0x489b8d(0x1dd),'ils',_0x489b8d(0x206),_0x489b8d(0x20e),_0x489b8d(0x203),_0x489b8d(0x23d),'lkr',_0x489b8d(0x1eb),_0x489b8d(0x20a),_0x489b8d(0x1fd),'ngn','nok','nzd',_0x489b8d(0x228),'pkr',_0x489b8d(0x1d7),_0x489b8d(0x22f),_0x489b8d(0x219),_0x489b8d(0x201),_0x489b8d(0x225),'thb','try',_0x489b8d(0x227),_0x489b8d(0x210),_0x489b8d(0x1f8),_0x489b8d(0x1fb),'zar',_0x489b8d(0x21f),_0x489b8d(0x1fa),_0x489b8d(0x1da),_0x489b8d(0x244),_0x489b8d(0x21b)],this[_0x489b8d(0x1e5)]=null,this[_0x489b8d(0x200)]=0x3,this[_0x489b8d(0x22c)]();}[a38_0x5a239e(0x22c)](){const _0x46f109=a38_0x5a239e;this[_0x46f109(0x1f9)]()['catch'](_0x4deb3f=>{const _0xbde4c8=_0x46f109;console[_0xbde4c8(0x1fc)](_0xbde4c8(0x212),_0x4deb3f);}),this[_0x46f109(0x1e5)]=setInterval(async()=>{const _0x5f5682=_0x46f109;try{await this[_0x5f5682(0x1f9)]();}catch(_0x411312){console[_0x5f5682(0x1fc)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x411312);}},0x3c*0x3c*0x3e8),console[_0x46f109(0x21d)](_0x46f109(0x1f5));}[a38_0x5a239e(0x1f0)](){const _0x524696=a38_0x5a239e;this['updateInterval']&&(clearInterval(this[_0x524696(0x1e5)]),this[_0x524696(0x1e5)]=null,console[_0x524696(0x21d)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x3361e6=a38_0x5a239e;try{console['log'](_0x3361e6(0x20d));const _0x386d1d=this[_0x3361e6(0x1e8)]['join'](','),_0x4e0463=this[_0x3361e6(0x234)]+'?ids=tether&vs_currencies='+_0x386d1d,_0x2966c2=await fetch(_0x4e0463,{'headers':{'Accept':_0x3361e6(0x21c),'User-Agent':_0x3361e6(0x1ce)}});if(!_0x2966c2['ok'])throw new Error(_0x3361e6(0x1d0)+_0x2966c2[_0x3361e6(0x231)]+'\x20'+_0x2966c2[_0x3361e6(0x1db)]);const _0x4913a9=await _0x2966c2['json']();if(!_0x4913a9[_0x3361e6(0x1e6)])throw new Error(_0x3361e6(0x243));const _0x173d90=_0x4913a9[_0x3361e6(0x1e6)];console[_0x3361e6(0x21d)](_0x3361e6(0x213)+Object[_0x3361e6(0x1ff)](_0x173d90)[_0x3361e6(0x1f3)]+_0x3361e6(0x235));const _0x317a23=Object['entries'](_0x173d90)['map'](async([_0x477539,_0x3c214d])=>{const _0x5b061d=_0x3361e6;try{await database_1['default'][_0x5b061d(0x226)][_0x5b061d(0x23e)]({'where':{'currency':_0x477539['toLowerCase']()},'update':{'rate':_0x3c214d},'create':{'currency':_0x477539['toLowerCase'](),'rate':_0x3c214d}});}catch(_0xce1341){console[_0x5b061d(0x1fc)](_0x5b061d(0x207)+_0x477539+':',_0xce1341);}});await Promise[_0x3361e6(0x222)](_0x317a23),console[_0x3361e6(0x21d)](_0x3361e6(0x1f1));}catch(_0x508e3a){console['error'](_0x3361e6(0x23f),_0x508e3a);throw _0x508e3a;}}async[a38_0x5a239e(0x21a)](_0x1522ad){const _0x398dc2=a38_0x5a239e,_0x55e34c=_0x1522ad[_0x398dc2(0x1e0)]();if(_0x55e34c==='usdt')return 0x1;try{const _0x721a57=await database_1[_0x398dc2(0x232)]['currencyRate'][_0x398dc2(0x240)]({'where':{'currency':_0x55e34c}});if(!_0x721a57)return console[_0x398dc2(0x1e4)](_0x398dc2(0x1ef)+_0x1522ad+',\x20using\x201\x20as\x20fallback'),0x1;return _0x721a57['rate'];}catch(_0xecb0a8){return console[_0x398dc2(0x1fc)](_0x398dc2(0x205)+_0x1522ad+':',_0xecb0a8),0x1;}}async[a38_0x5a239e(0x1dc)](_0x5b28b6,_0x247dfd){const _0x59ca0b=a38_0x5a239e,_0x5de001=_0x247dfd[_0x59ca0b(0x1e0)]();if(_0x5de001===_0x59ca0b(0x1ed)){const _0xfa6647=_0x5b28b6*(0x1+this[_0x59ca0b(0x200)]/0x64);return console[_0x59ca0b(0x21d)](_0x59ca0b(0x218)+this[_0x59ca0b(0x200)]+'%\x20markup\x20to\x20'+_0x5b28b6+'\x20USDT\x20=\x20'+_0xfa6647[_0x59ca0b(0x23b)](0x6)+_0x59ca0b(0x20c)),_0xfa6647;}try{const _0x1cae67=await this[_0x59ca0b(0x21a)](_0x5de001),_0x3a6abf=_0x5b28b6/_0x1cae67,_0x1c5979=_0x3a6abf*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x59ca0b(0x21d)](_0x59ca0b(0x223)+_0x5b28b6+'\x20'+_0x247dfd[_0x59ca0b(0x216)]()+_0x59ca0b(0x1e3)+_0x3a6abf[_0x59ca0b(0x23b)](0x6)+_0x59ca0b(0x1d9)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x1c5979[_0x59ca0b(0x23b)](0x6)+_0x59ca0b(0x22d)+_0x1cae67+')'),_0x1c5979;}catch(_0x408086){console[_0x59ca0b(0x1fc)](_0x59ca0b(0x221)+_0x5b28b6+'\x20'+_0x247dfd+'\x20to\x20USDT:',_0x408086);const _0x778643=_0x5b28b6*(0x1+this[_0x59ca0b(0x200)]/0x64);return _0x778643;}}async[a38_0x5a239e(0x1cf)](_0x152319){const _0x5b346b=a38_0x5a239e;let _0x29d1aa=0x0;for(const {amount:_0x367ad1,currency:_0x209438}of _0x152319){const _0x1af43c=await this[_0x5b346b(0x1dc)](_0x367ad1,_0x209438);_0x29d1aa+=_0x1af43c;}return _0x29d1aa;}async['getAllRates'](){const _0x3b6abe=a38_0x5a239e;try{const _0x4d4058=await database_1[_0x3b6abe(0x232)][_0x3b6abe(0x226)][_0x3b6abe(0x21e)]({'select':{'currency':!![],'rate':!![]}}),_0x2e77f1={'usdt':0x1};return _0x4d4058['forEach'](_0x4a1b7d=>{_0x2e77f1[_0x4a1b7d['currency']]=_0x4a1b7d['rate'];}),_0x2e77f1;}catch(_0x405952){return console[_0x3b6abe(0x1fc)](_0x3b6abe(0x23a),_0x405952),{'usdt':0x1};}}async[a38_0x5a239e(0x1d3)](){const _0x12d8fd=a38_0x5a239e;try{const [_0x241082,_0xa3f2af,_0x1f7f4a]=await Promise[_0x12d8fd(0x20f)]([database_1[_0x12d8fd(0x232)][_0x12d8fd(0x226)][_0x12d8fd(0x238)](),database_1['default'][_0x12d8fd(0x226)][_0x12d8fd(0x1f6)]({'orderBy':{'updatedAt':_0x12d8fd(0x209)},'select':{'updatedAt':!![]}}),database_1['default'][_0x12d8fd(0x226)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x241082,'lastUpdated':_0xa3f2af?.[_0x12d8fd(0x1e1)]||null,'oldestRate':_0x1f7f4a?.[_0x12d8fd(0x1e1)]||null,'markupPercentage':this[_0x12d8fd(0x200)]};}catch(_0x4c3af3){return console['error'](_0x12d8fd(0x1f7),_0x4c3af3),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x12d8fd(0x200)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a38_0x5a239e(0x211)]=new CurrencyService();