'use strict';const a38_0x46c404=a38_0x36d4;function a38_0x36d4(_0x44ae11,_0x53461e){const _0x2fd2eb=a38_0x2fd2();return a38_0x36d4=function(_0x36d46e,_0x21e81d){_0x36d46e=_0x36d46e-0x77;let _0x52660c=_0x2fd2eb[_0x36d46e];return _0x52660c;},a38_0x36d4(_0x44ae11,_0x53461e);}(function(_0x23f711,_0x5b5afd){const _0x252220=a38_0x36d4,_0x129a05=_0x23f711();while(!![]){try{const _0x11bf78=parseInt(_0x252220(0xb8))/0x1+-parseInt(_0x252220(0x8b))/0x2*(parseInt(_0x252220(0x83))/0x3)+-parseInt(_0x252220(0x95))/0x4+-parseInt(_0x252220(0xbc))/0x5*(-parseInt(_0x252220(0xbe))/0x6)+-parseInt(_0x252220(0xb2))/0x7*(parseInt(_0x252220(0x89))/0x8)+-parseInt(_0x252220(0xa7))/0x9+parseInt(_0x252220(0xeb))/0xa;if(_0x11bf78===_0x5b5afd)break;else _0x129a05['push'](_0x129a05['shift']());}catch(_0x4dd319){_0x129a05['push'](_0x129a05['shift']());}}}(a38_0x2fd2,0x789c1));var __importDefault=this&&this['__importDefault']||function(_0x20277d){const _0x84f79a=a38_0x36d4;return _0x20277d&&_0x20277d[_0x84f79a(0xc4)]?_0x20277d:{'default':_0x20277d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a38_0x46c404(0xdf)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x4394c8=a38_0x46c404;this[_0x4394c8(0xdd)]='https://api.coingecko.com/api/v3/simple/price',this[_0x4394c8(0xb4)]=['btc','eth',_0x4394c8(0xd3),'bch',_0x4394c8(0xc2),_0x4394c8(0xe4),'xrp',_0x4394c8(0x7b),_0x4394c8(0x9c),'dot',_0x4394c8(0x91),'usd',_0x4394c8(0xe5),_0x4394c8(0x88),_0x4394c8(0xe8),_0x4394c8(0xa6),_0x4394c8(0xf1),_0x4394c8(0xde),_0x4394c8(0xc7),_0x4394c8(0xf0),_0x4394c8(0xe0),'clp','cny',_0x4394c8(0x97),_0x4394c8(0xaf),_0x4394c8(0xcc),'gbp',_0x4394c8(0xbb),_0x4394c8(0xf2),_0x4394c8(0xed),_0x4394c8(0x9f),'ils',_0x4394c8(0xc9),'jpy',_0x4394c8(0xd8),_0x4394c8(0x8f),_0x4394c8(0x80),_0x4394c8(0xa0),_0x4394c8(0xd9),_0x4394c8(0x84),_0x4394c8(0x87),'nok','nzd',_0x4394c8(0x99),_0x4394c8(0xab),_0x4394c8(0x7c),_0x4394c8(0xc6),_0x4394c8(0xcb),_0x4394c8(0x8d),_0x4394c8(0xcf),_0x4394c8(0x7a),'try',_0x4394c8(0xe1),'uah',_0x4394c8(0xa1),_0x4394c8(0xf5),_0x4394c8(0xcd),_0x4394c8(0xa3),_0x4394c8(0x93),_0x4394c8(0x77),'bits',_0x4394c8(0x81)],this[_0x4394c8(0xb1)]=null,this[_0x4394c8(0xd1)]=0x3,this[_0x4394c8(0xba)]();}[a38_0x46c404(0xba)](){const _0x484f2f=a38_0x46c404;this[_0x484f2f(0xdb)]()[_0x484f2f(0xee)](_0x159c2b=>{const _0x1be482=_0x484f2f;console[_0x1be482(0x9d)](_0x1be482(0x9e),_0x159c2b);}),this['updateInterval']=setInterval(async()=>{const _0x1cafbb=_0x484f2f;try{await this[_0x1cafbb(0xdb)]();}catch(_0x5c4bc9){console['error'](_0x1cafbb(0x82),_0x5c4bc9);}},0x3c*0x3c*0x3e8),console['log'](_0x484f2f(0x7f));}[a38_0x46c404(0xf6)](){const _0x512963=a38_0x46c404;this[_0x512963(0xb1)]&&(clearInterval(this['updateInterval']),this[_0x512963(0xb1)]=null,console[_0x512963(0xae)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x46c404(0xdb)](){const _0x26ae62=a38_0x46c404;try{console[_0x26ae62(0xae)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x53280b=this['CURRENCIES'][_0x26ae62(0xaa)](','),_0x1324e3=this[_0x26ae62(0xdd)]+_0x26ae62(0x85)+_0x53280b,_0x284400=await fetch(_0x1324e3,{'headers':{'Accept':_0x26ae62(0x8c),'User-Agent':_0x26ae62(0xe2)}});if(!_0x284400['ok'])throw new Error(_0x26ae62(0x9b)+_0x284400['status']+'\x20'+_0x284400[_0x26ae62(0x79)]);const _0xc88f86=await _0x284400[_0x26ae62(0x92)]();if(!_0xc88f86[_0x26ae62(0xa9)])throw new Error(_0x26ae62(0xa8));const _0x111233=_0xc88f86[_0x26ae62(0xa9)];console[_0x26ae62(0xae)](_0x26ae62(0xb6)+Object[_0x26ae62(0xbf)](_0x111233)[_0x26ae62(0xa2)]+_0x26ae62(0x7e));const _0x192445=Object[_0x26ae62(0xc1)](_0x111233)[_0x26ae62(0xc3)](async([_0x47a14d,_0x33323e])=>{const _0x964b6b=_0x26ae62;try{await database_1['default'][_0x964b6b(0x86)][_0x964b6b(0xd2)]({'where':{'currency':_0x47a14d['toLowerCase']()},'update':{'rate':_0x33323e},'create':{'currency':_0x47a14d[_0x964b6b(0xef)](),'rate':_0x33323e}});}catch(_0x8849be){console['error'](_0x964b6b(0xce)+_0x47a14d+':',_0x8849be);}});await Promise['allSettled'](_0x192445),console[_0x26ae62(0xae)](_0x26ae62(0x8a));}catch(_0x5eef0e){console[_0x26ae62(0x9d)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x5eef0e);throw _0x5eef0e;}}async[a38_0x46c404(0xca)](_0x3ce09e){const _0x4095c1=a38_0x46c404,_0x59ee9f=_0x3ce09e[_0x4095c1(0xef)]();if(_0x59ee9f===_0x4095c1(0x90))return 0x1;try{const _0x380630=await database_1[_0x4095c1(0xd5)]['currencyRate'][_0x4095c1(0xd7)]({'where':{'currency':_0x59ee9f}});if(!_0x380630)return console[_0x4095c1(0xad)](_0x4095c1(0xb0)+_0x3ce09e+_0x4095c1(0xd4)),0x1;return _0x380630['rate'];}catch(_0x5a1b66){return console[_0x4095c1(0x9d)](_0x4095c1(0xe6)+_0x3ce09e+':',_0x5a1b66),0x1;}}async[a38_0x46c404(0x94)](_0x5e9b51,_0x196448){const _0x323f88=a38_0x46c404,_0x5e9ef2=_0x196448[_0x323f88(0xef)]();if(_0x5e9ef2===_0x323f88(0x90)){const _0x370dc6=_0x5e9b51*(0x1+this[_0x323f88(0xd1)]/0x64);return console[_0x323f88(0xae)](_0x323f88(0xd0)+this[_0x323f88(0xd1)]+_0x323f88(0xe9)+_0x5e9b51+_0x323f88(0xa5)+_0x370dc6[_0x323f88(0xb9)](0x6)+_0x323f88(0x78)),_0x370dc6;}try{const _0x2c5ae2=await this[_0x323f88(0xca)](_0x5e9ef2),_0x279a1a=_0x5e9b51/_0x2c5ae2,_0x3bf48a=_0x279a1a*(0x1+this[_0x323f88(0xd1)]/0x64);return console[_0x323f88(0xae)](_0x323f88(0xbd)+_0x5e9b51+'\x20'+_0x196448[_0x323f88(0x96)]()+_0x323f88(0xdc)+_0x279a1a[_0x323f88(0xb9)](0x6)+_0x323f88(0xb3)+this[_0x323f88(0xd1)]+_0x323f88(0xf3)+_0x3bf48a[_0x323f88(0xb9)](0x6)+_0x323f88(0xec)+_0x2c5ae2+')'),_0x3bf48a;}catch(_0x3fa70c){console[_0x323f88(0x9d)](_0x323f88(0xb5)+_0x5e9b51+'\x20'+_0x196448+_0x323f88(0xac),_0x3fa70c);const _0xadf8fe=_0x5e9b51*(0x1+this[_0x323f88(0xd1)]/0x64);return _0xadf8fe;}}async[a38_0x46c404(0xa4)](_0x2ab7ca){const _0x3deaa8=a38_0x46c404;let _0x167979=0x0;for(const {amount:_0x266b0c,currency:_0x258173}of _0x2ab7ca){const _0x418d=await this[_0x3deaa8(0x94)](_0x266b0c,_0x258173);_0x167979+=_0x418d;}return _0x167979;}async[a38_0x46c404(0xe7)](){const _0x36f264=a38_0x46c404;try{const _0x140641=await database_1[_0x36f264(0xd5)][_0x36f264(0x86)][_0x36f264(0x9a)]({'select':{'currency':!![],'rate':!![]}}),_0x4e9a8f={'usdt':0x1};return _0x140641[_0x36f264(0xc0)](_0x17c2e3=>{const _0x5f1dc5=_0x36f264;_0x4e9a8f[_0x17c2e3[_0x5f1dc5(0x98)]]=_0x17c2e3[_0x5f1dc5(0xda)];}),_0x4e9a8f;}catch(_0x54853a){return console['error'](_0x36f264(0xc5),_0x54853a),{'usdt':0x1};}}async['getRatesStatus'](){const _0xbd1749=a38_0x46c404;try{const [_0x162762,_0x40f402,_0x3515e5]=await Promise[_0xbd1749(0xb7)]([database_1[_0xbd1749(0xd5)][_0xbd1749(0x86)][_0xbd1749(0xea)](),database_1[_0xbd1749(0xd5)]['currencyRate'][_0xbd1749(0xf4)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0xbd1749(0xd5)]['currencyRate'][_0xbd1749(0xf4)]({'orderBy':{'updatedAt':_0xbd1749(0xc8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x162762,'lastUpdated':_0x40f402?.['updatedAt']||null,'oldestRate':_0x3515e5?.[_0xbd1749(0x8e)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x1b0874){return console[_0xbd1749(0x9d)](_0xbd1749(0xe3),_0x1b0874),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xbd1749(0xd1)]};}}[a38_0x46c404(0xd6)](){const _0x46a054=a38_0x46c404;return this[_0x46a054(0xd1)];}}exports[a38_0x46c404(0xdf)]=CurrencyService,exports[a38_0x46c404(0x7d)]=new CurrencyService();function a38_0x2fd2(){const _0x1d4935=['twd','TesSoft\x20Payment\x20System/1.0','Error\x20getting\x20rates\x20status:','eos','aed','Error\x20getting\x20rate\x20for\x20currency\x20','getAllRates','aud','%\x20markup\x20to\x20','count','26952180sbrVxm','\x20USDT\x20(rate:\x20','huf','catch','toLowerCase','cad','bhd','hkd','%\x20markup\x20=\x20','findFirst','vnd','stopPeriodicUpdates','xau','\x20USDT','statusText','thb','xlm','pln','currencyService','\x20currencies','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','lkr','sats','Periodic\x20currency\x20rates\x20update\x20failed:','3fBGWmz','myr','?ids=tether&vs_currencies=','currencyRate','ngn','ars','15336LjKMYe','✅\x20Currency\x20rates\x20updated\x20successfully','1350346HZGmew','application/json','sek','updatedAt','kwd','usdt','yfi','json','xag','convertToUSDT','3476656ASJtnF','toUpperCase','czk','currency','php','findMany','CoinGecko\x20API\x20error:\x20','link','error','Initial\x20currency\x20rates\x20update\x20failed:','idr','mmk','vef','length','xdr','convertMultipleToUSDT','\x20USDT\x20=\x20','bdt','6723855xMIwhv','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','tether','join','pkr','\x20to\x20USDT:','warn','log','dkk','No\x20rate\x20found\x20for\x20currency:\x20','updateInterval','3374NXYlfD','\x20USDT,\x20with\x20','CURRENCIES','Error\x20converting\x20','📊\x20Received\x20rates\x20for\x20','all','105240CEXWsc','toFixed','startPeriodicUpdates','gel','216425AiYbmX','💱\x20Converted\x20','126NmVAEv','keys','forEach','entries','bnb','map','__esModule','Error\x20getting\x20all\x20rates:','rub','brl','asc','inr','getCurrencyRate','sar','eur','zar','Failed\x20to\x20update\x20rate\x20for\x20','sgd','💱\x20Applied\x20','MARKUP_PERCENTAGE','upsert','ltc',',\x20using\x201\x20as\x20fallback','default','getMarkupPercentage','findUnique','krw','mxn','rate','updateCurrencyRates','\x20to\x20','COINGECKO_URL','bmd','CurrencyService','chf'];a38_0x2fd2=function(){return _0x1d4935;};return a38_0x2fd2();}