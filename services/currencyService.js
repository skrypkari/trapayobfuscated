'use strict';const a38_0x13ab89=a38_0x5215;(function(_0x4af2db,_0x2eba8e){const _0x336a02=a38_0x5215,_0x44e9b5=_0x4af2db();while(!![]){try{const _0x3609d6=-parseInt(_0x336a02(0x1bb))/0x1+-parseInt(_0x336a02(0x1b5))/0x2*(-parseInt(_0x336a02(0x1e2))/0x3)+parseInt(_0x336a02(0x203))/0x4+parseInt(_0x336a02(0x1a3))/0x5+-parseInt(_0x336a02(0x1ad))/0x6+parseInt(_0x336a02(0x1c4))/0x7+-parseInt(_0x336a02(0x1ca))/0x8*(-parseInt(_0x336a02(0x195))/0x9);if(_0x3609d6===_0x2eba8e)break;else _0x44e9b5['push'](_0x44e9b5['shift']());}catch(_0x47c5e7){_0x44e9b5['push'](_0x44e9b5['shift']());}}}(a38_0x1d82,0x8cbed));function a38_0x1d82(){const _0x1a8bae=['✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20currencies','2052888byygJT','getAllRates','sgd','link','sats','desc','bits','length','nok','pkr','updatedAt','zar','aud','findMany','all','%\x20markup\x20to\x20','CurrencyService','?ids=tether&vs_currencies=','asc','\x20to\x20USDT:','cad','vef','xau','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','6ktNlzh','findUnique','COINGECKO_URL','json','Error\x20getting\x20rates\x20status:','TesSoft\x20Payment\x20System/1.0','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','nzd','No\x20rate\x20found\x20for\x20currency:\x20','✅\x20Currency\x20rates\x20updated\x20successfully','twd','myr','\x20USDT\x20=\x20','vnd','status','thb','📊\x20Received\x20rates\x20for\x20','dkk','convertMultipleToUSDT','default','xrp','count','defineProperty','bch','ars','xag','yfi','usdt','__importDefault','uah','Periodic\x20currency\x20rates\x20update\x20failed:','error','chf','2297484EcJiPB','stopPeriodicUpdates','toFixed','__esModule','sek','currencyRate','💱\x20Converted\x20','hkd','pln','xdr','forEach','jpy','statusText','clp','bmd','9jEuzTB','bnb','\x20USDT,\x20with\x20','CURRENCIES','upsert','getCurrencyRate','btc','toLowerCase','convertToUSDT','gbp','updateInterval','\x20USDT\x20(rate:\x20','eur','ltc','3261325jpdLFj','currencyService','map','findFirst','aed','tether','getMarkupPercentage','gel','currency','../config/database','4546752vKYsCF','Error\x20converting\x20','kwd','ils','warn','💱\x20Applied\x20','getRatesStatus','czk','283826HhBLkG','Failed\x20to\x20update\x20rate\x20for\x20','lkr','bdt','MARKUP_PERCENTAGE','Initial\x20currency\x20rates\x20update\x20failed:','580915cfqOKj','mmk','updateCurrencyRates','bhd','entries','keys','cny','log','startPeriodicUpdates','1036889AKtKBi','❌\x20Failed\x20to\x20update\x20currency\x20rates:','dot','CoinGecko\x20API\x20error:\x20'];a38_0x1d82=function(){return _0x1a8bae;};return a38_0x1d82();}var __importDefault=this&&this[a38_0x13ab89(0x1fe)]||function(_0x55e78f){const _0x58f8b8=a38_0x13ab89;return _0x55e78f&&_0x55e78f[_0x58f8b8(0x206)]?_0x55e78f:{'default':_0x55e78f};};Object[a38_0x13ab89(0x1f8)](exports,a38_0x13ab89(0x206),{'value':!![]}),exports[a38_0x13ab89(0x1a4)]=exports[a38_0x13ab89(0x1da)]=void 0x0;const database_1=__importDefault(require(a38_0x13ab89(0x1ac)));class CurrencyService{constructor(){const _0x354ff7=a38_0x13ab89;this[_0x354ff7(0x1e4)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x354ff7(0x19b),'eth',_0x354ff7(0x1a2),_0x354ff7(0x1f9),_0x354ff7(0x196),'eos',_0x354ff7(0x1f6),'xlm',_0x354ff7(0x1cd),_0x354ff7(0x1c6),_0x354ff7(0x1fc),'usd',_0x354ff7(0x1a7),_0x354ff7(0x1fa),_0x354ff7(0x1d6),_0x354ff7(0x1b8),_0x354ff7(0x1be),_0x354ff7(0x194),'brl',_0x354ff7(0x1de),_0x354ff7(0x202),_0x354ff7(0x193),_0x354ff7(0x1c1),_0x354ff7(0x1b4),_0x354ff7(0x1f3),_0x354ff7(0x1a1),_0x354ff7(0x19e),_0x354ff7(0x1aa),_0x354ff7(0x18d),'huf','idr',_0x354ff7(0x1b0),'inr',_0x354ff7(0x191),'krw',_0x354ff7(0x1af),_0x354ff7(0x1b7),_0x354ff7(0x1bc),'mxn',_0x354ff7(0x1ed),'ngn',_0x354ff7(0x1d2),_0x354ff7(0x1e9),'php',_0x354ff7(0x1d3),_0x354ff7(0x18e),'rub','sar',_0x354ff7(0x207),_0x354ff7(0x1cc),_0x354ff7(0x1f1),'try',_0x354ff7(0x1ec),_0x354ff7(0x1ff),_0x354ff7(0x1df),_0x354ff7(0x1ef),_0x354ff7(0x1d5),_0x354ff7(0x18f),_0x354ff7(0x1fb),_0x354ff7(0x1e0),_0x354ff7(0x1d0),_0x354ff7(0x1ce)],this[_0x354ff7(0x19f)]=null,this[_0x354ff7(0x1b9)]=0x3,this[_0x354ff7(0x1c3)]();}[a38_0x13ab89(0x1c3)](){const _0x25927a=a38_0x13ab89;this[_0x25927a(0x1bd)]()['catch'](_0x147062=>{const _0x226ad8=_0x25927a;console[_0x226ad8(0x201)](_0x226ad8(0x1ba),_0x147062);}),this[_0x25927a(0x19f)]=setInterval(async()=>{const _0x43df05=_0x25927a;try{await this[_0x43df05(0x1bd)]();}catch(_0xf60435){console[_0x43df05(0x201)](_0x43df05(0x200),_0xf60435);}},0x3c*0x3c*0x3e8),console['log'](_0x25927a(0x1c8));}[a38_0x13ab89(0x204)](){const _0x5dadea=a38_0x13ab89;this[_0x5dadea(0x19f)]&&(clearInterval(this[_0x5dadea(0x19f)]),this['updateInterval']=null,console[_0x5dadea(0x1c2)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0xd4bb83=a38_0x13ab89;try{console[_0xd4bb83(0x1c2)](_0xd4bb83(0x1e8));const _0x180b0f=this[_0xd4bb83(0x198)]['join'](','),_0x8241c1=this[_0xd4bb83(0x1e4)]+_0xd4bb83(0x1db)+_0x180b0f,_0x530d0f=await fetch(_0x8241c1,{'headers':{'Accept':'application/json','User-Agent':_0xd4bb83(0x1e7)}});if(!_0x530d0f['ok'])throw new Error(_0xd4bb83(0x1c7)+_0x530d0f[_0xd4bb83(0x1f0)]+'\x20'+_0x530d0f[_0xd4bb83(0x192)]);const _0x319c5f=await _0x530d0f[_0xd4bb83(0x1e5)]();if(!_0x319c5f[_0xd4bb83(0x1a8)])throw new Error(_0xd4bb83(0x1e1));const _0x5d442c=_0x319c5f[_0xd4bb83(0x1a8)];console[_0xd4bb83(0x1c2)](_0xd4bb83(0x1f2)+Object[_0xd4bb83(0x1c0)](_0x5d442c)[_0xd4bb83(0x1d1)]+_0xd4bb83(0x1c9));const _0x26c10d=Object[_0xd4bb83(0x1bf)](_0x5d442c)[_0xd4bb83(0x1a5)](async([_0x33cae2,_0x2893c3])=>{const _0x180b7d=_0xd4bb83;try{await database_1['default'][_0x180b7d(0x208)][_0x180b7d(0x199)]({'where':{'currency':_0x33cae2[_0x180b7d(0x19c)]()},'update':{'rate':_0x2893c3},'create':{'currency':_0x33cae2[_0x180b7d(0x19c)](),'rate':_0x2893c3}});}catch(_0x5735b5){console[_0x180b7d(0x201)](_0x180b7d(0x1b6)+_0x33cae2+':',_0x5735b5);}});await Promise['allSettled'](_0x26c10d),console['log'](_0xd4bb83(0x1eb));}catch(_0xd2cf2){console[_0xd4bb83(0x201)](_0xd4bb83(0x1c5),_0xd2cf2);throw _0xd2cf2;}}async[a38_0x13ab89(0x19a)](_0x1f7d9d){const _0x250daa=a38_0x13ab89,_0x31689a=_0x1f7d9d['toLowerCase']();if(_0x31689a===_0x250daa(0x1fd))return 0x1;try{const _0x5604e4=await database_1[_0x250daa(0x1f5)]['currencyRate'][_0x250daa(0x1e3)]({'where':{'currency':_0x31689a}});if(!_0x5604e4)return console[_0x250daa(0x1b1)](_0x250daa(0x1ea)+_0x1f7d9d+',\x20using\x201\x20as\x20fallback'),0x1;return _0x5604e4['rate'];}catch(_0x589c3e){return console[_0x250daa(0x201)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1f7d9d+':',_0x589c3e),0x1;}}async[a38_0x13ab89(0x19d)](_0x32b4dc,_0x373368){const _0x15fc78=a38_0x13ab89,_0x182be9=_0x373368[_0x15fc78(0x19c)]();if(_0x182be9==='usdt'){const _0x1da611=_0x32b4dc*(0x1+this[_0x15fc78(0x1b9)]/0x64);return console[_0x15fc78(0x1c2)](_0x15fc78(0x1b2)+this[_0x15fc78(0x1b9)]+_0x15fc78(0x1d9)+_0x32b4dc+_0x15fc78(0x1ee)+_0x1da611[_0x15fc78(0x205)](0x6)+'\x20USDT'),_0x1da611;}try{const _0x5dc0d2=await this[_0x15fc78(0x19a)](_0x182be9),_0x6d045c=_0x32b4dc/_0x5dc0d2,_0x32630a=_0x6d045c*(0x1+this[_0x15fc78(0x1b9)]/0x64);return console[_0x15fc78(0x1c2)](_0x15fc78(0x18c)+_0x32b4dc+'\x20'+_0x373368['toUpperCase']()+'\x20to\x20'+_0x6d045c['toFixed'](0x6)+_0x15fc78(0x197)+this[_0x15fc78(0x1b9)]+'%\x20markup\x20=\x20'+_0x32630a[_0x15fc78(0x205)](0x6)+_0x15fc78(0x1a0)+_0x5dc0d2+')'),_0x32630a;}catch(_0x3c75ce){console['error'](_0x15fc78(0x1ae)+_0x32b4dc+'\x20'+_0x373368+_0x15fc78(0x1dd),_0x3c75ce);const _0x4f42f1=_0x32b4dc*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x4f42f1;}}async[a38_0x13ab89(0x1f4)](_0x309386){let _0x2760d1=0x0;for(const {amount:_0x23fda9,currency:_0x2d1ad1}of _0x309386){const _0x567d8f=await this['convertToUSDT'](_0x23fda9,_0x2d1ad1);_0x2760d1+=_0x567d8f;}return _0x2760d1;}async[a38_0x13ab89(0x1cb)](){const _0x78b25e=a38_0x13ab89;try{const _0x1fe016=await database_1[_0x78b25e(0x1f5)][_0x78b25e(0x208)][_0x78b25e(0x1d7)]({'select':{'currency':!![],'rate':!![]}}),_0x1e6dd9={'usdt':0x1};return _0x1fe016[_0x78b25e(0x190)](_0x156a5a=>{const _0x2cc499=_0x78b25e;_0x1e6dd9[_0x156a5a[_0x2cc499(0x1ab)]]=_0x156a5a['rate'];}),_0x1e6dd9;}catch(_0x27e1e8){return console[_0x78b25e(0x201)]('Error\x20getting\x20all\x20rates:',_0x27e1e8),{'usdt':0x1};}}async[a38_0x13ab89(0x1b3)](){const _0x17c5f4=a38_0x13ab89;try{const [_0xfd1caa,_0x5aa85c,_0x299646]=await Promise[_0x17c5f4(0x1d8)]([database_1[_0x17c5f4(0x1f5)][_0x17c5f4(0x208)][_0x17c5f4(0x1f7)](),database_1[_0x17c5f4(0x1f5)][_0x17c5f4(0x208)][_0x17c5f4(0x1a6)]({'orderBy':{'updatedAt':_0x17c5f4(0x1cf)},'select':{'updatedAt':!![]}}),database_1[_0x17c5f4(0x1f5)][_0x17c5f4(0x208)][_0x17c5f4(0x1a6)]({'orderBy':{'updatedAt':_0x17c5f4(0x1dc)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xfd1caa,'lastUpdated':_0x5aa85c?.[_0x17c5f4(0x1d4)]||null,'oldestRate':_0x299646?.['updatedAt']||null,'markupPercentage':this[_0x17c5f4(0x1b9)]};}catch(_0x59757a){return console['error'](_0x17c5f4(0x1e6),_0x59757a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x17c5f4(0x1b9)]};}}[a38_0x13ab89(0x1a9)](){return this['MARKUP_PERCENTAGE'];}}function a38_0x5215(_0x4655bf,_0x18996f){const _0x1d82d6=a38_0x1d82();return a38_0x5215=function(_0x5215c9,_0x162cef){_0x5215c9=_0x5215c9-0x18c;let _0x26188e=_0x1d82d6[_0x5215c9];return _0x26188e;},a38_0x5215(_0x4655bf,_0x18996f);}exports['CurrencyService']=CurrencyService,exports[a38_0x13ab89(0x1a4)]=new CurrencyService();