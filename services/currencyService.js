'use strict';const a38_0x5f2b18=a38_0x39d8;function a38_0x39d8(_0x5946d7,_0x569d77){const _0x3f63ad=a38_0x3f63();return a38_0x39d8=function(_0x39d8ed,_0x20b30e){_0x39d8ed=_0x39d8ed-0xe9;let _0x1783a4=_0x3f63ad[_0x39d8ed];return _0x1783a4;},a38_0x39d8(_0x5946d7,_0x569d77);}(function(_0x33a7bc,_0x1a10be){const _0x350f8d=a38_0x39d8,_0x2953d2=_0x33a7bc();while(!![]){try{const _0x56177d=-parseInt(_0x350f8d(0x119))/0x1*(parseInt(_0x350f8d(0x138))/0x2)+-parseInt(_0x350f8d(0xf5))/0x3*(-parseInt(_0x350f8d(0xf8))/0x4)+parseInt(_0x350f8d(0x11e))/0x5*(parseInt(_0x350f8d(0x102))/0x6)+parseInt(_0x350f8d(0x11b))/0x7*(-parseInt(_0x350f8d(0x121))/0x8)+-parseInt(_0x350f8d(0x156))/0x9*(parseInt(_0x350f8d(0x11d))/0xa)+parseInt(_0x350f8d(0xed))/0xb+parseInt(_0x350f8d(0x120))/0xc;if(_0x56177d===_0x1a10be)break;else _0x2953d2['push'](_0x2953d2['shift']());}catch(_0x4df6df){_0x2953d2['push'](_0x2953d2['shift']());}}}(a38_0x3f63,0xad2a4));var __importDefault=this&&this['__importDefault']||function(_0x493252){const _0xc0f62c=a38_0x39d8;return _0x493252&&_0x493252[_0xc0f62c(0x12e)]?_0x493252:{'default':_0x493252};};Object[a38_0x5f2b18(0x159)](exports,a38_0x5f2b18(0x12e),{'value':!![]}),exports[a38_0x5f2b18(0x10b)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x1f2c75=a38_0x5f2b18;this[_0x1f2c75(0x149)]=_0x1f2c75(0xfa),this[_0x1f2c75(0x152)]=[_0x1f2c75(0x143),'eth',_0x1f2c75(0x124),'bch','bnb',_0x1f2c75(0xfe),'xrp',_0x1f2c75(0x14a),_0x1f2c75(0x11f),_0x1f2c75(0x107),'yfi','usd',_0x1f2c75(0x14f),_0x1f2c75(0x11c),_0x1f2c75(0xea),_0x1f2c75(0x108),'bhd',_0x1f2c75(0x10f),_0x1f2c75(0x123),_0x1f2c75(0x128),_0x1f2c75(0x105),_0x1f2c75(0x153),_0x1f2c75(0x151),_0x1f2c75(0x13e),'dkk',_0x1f2c75(0xfb),_0x1f2c75(0xff),_0x1f2c75(0x13c),_0x1f2c75(0x115),'huf',_0x1f2c75(0xf6),_0x1f2c75(0x15c),'inr','jpy',_0x1f2c75(0xe9),_0x1f2c75(0x15e),_0x1f2c75(0x148),_0x1f2c75(0xf2),'mxn',_0x1f2c75(0x114),_0x1f2c75(0xf7),'nok',_0x1f2c75(0xf3),_0x1f2c75(0x130),_0x1f2c75(0x139),'pln',_0x1f2c75(0xef),_0x1f2c75(0x103),_0x1f2c75(0x155),_0x1f2c75(0x109),_0x1f2c75(0x12d),_0x1f2c75(0x135),'twd','uah',_0x1f2c75(0x104),_0x1f2c75(0x141),_0x1f2c75(0x14c),'xdr',_0x1f2c75(0x12a),'xau','bits','sats'],this[_0x1f2c75(0x147)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x1f2c75(0x146)]();}[a38_0x5f2b18(0x146)](){const _0x30412a=a38_0x5f2b18;this[_0x30412a(0x116)]()[_0x30412a(0xfd)](_0x526fe2=>{const _0x28d6b0=_0x30412a;console[_0x28d6b0(0x154)](_0x28d6b0(0x125),_0x526fe2);}),this[_0x30412a(0x147)]=setInterval(async()=>{const _0x3edacc=_0x30412a;try{await this[_0x3edacc(0x116)]();}catch(_0x3e3fb0){console[_0x3edacc(0x154)](_0x3edacc(0x145),_0x3e3fb0);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x5f2b18(0x131)](){const _0x381649=a38_0x5f2b18;this[_0x381649(0x147)]&&(clearInterval(this[_0x381649(0x147)]),this[_0x381649(0x147)]=null,console[_0x381649(0x133)](_0x381649(0x15a)));}async['updateCurrencyRates'](){const _0x7f7783=a38_0x5f2b18;try{console['log'](_0x7f7783(0xeb));const _0x4fc08c=this[_0x7f7783(0x152)][_0x7f7783(0x13a)](','),_0x4c9d2b=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x4fc08c,_0x5ef2c3=await fetch(_0x4c9d2b,{'headers':{'Accept':_0x7f7783(0x10d),'User-Agent':_0x7f7783(0x15d)}});if(!_0x5ef2c3['ok'])throw new Error(_0x7f7783(0x110)+_0x5ef2c3[_0x7f7783(0x14d)]+'\x20'+_0x5ef2c3[_0x7f7783(0xfc)]);const _0x3660a8=await _0x5ef2c3[_0x7f7783(0xf0)]();if(!_0x3660a8[_0x7f7783(0x112)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x3c9028=_0x3660a8['tether'];console[_0x7f7783(0x133)]('📊\x20Received\x20rates\x20for\x20'+Object['keys'](_0x3c9028)['length']+_0x7f7783(0x126));const _0x39d462=Object[_0x7f7783(0x14b)](_0x3c9028)[_0x7f7783(0xf1)](async([_0x499f8e,_0x58da7a])=>{const _0x524158=_0x7f7783;try{await database_1[_0x524158(0xf4)][_0x524158(0x136)]['upsert']({'where':{'currency':_0x499f8e[_0x524158(0x10a)]()},'update':{'rate':_0x58da7a},'create':{'currency':_0x499f8e[_0x524158(0x10a)](),'rate':_0x58da7a}});}catch(_0x3654e3){console[_0x524158(0x154)](_0x524158(0x157)+_0x499f8e+':',_0x3654e3);}});await Promise[_0x7f7783(0x111)](_0x39d462),console[_0x7f7783(0x133)](_0x7f7783(0x118));}catch(_0x499c5b){console[_0x7f7783(0x154)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x499c5b);throw _0x499c5b;}}async[a38_0x5f2b18(0x10e)](_0x89085b){const _0x537d72=a38_0x5f2b18,_0x2f103d=_0x89085b[_0x537d72(0x10a)]();if(_0x2f103d==='usdt')return 0x1;try{const _0x29bd8a=await database_1[_0x537d72(0xf4)][_0x537d72(0x136)][_0x537d72(0x14e)]({'where':{'currency':_0x2f103d}});if(!_0x29bd8a)return console[_0x537d72(0x150)](_0x537d72(0x10c)+_0x89085b+_0x537d72(0x15b)),0x1;return _0x29bd8a[_0x537d72(0x12c)];}catch(_0x29111d){return console[_0x537d72(0x154)](_0x537d72(0x137)+_0x89085b+':',_0x29111d),0x1;}}async['convertToUSDT'](_0x309be9,_0x38d307){const _0x1ffa1f=a38_0x5f2b18,_0x2fc6d5=_0x38d307[_0x1ffa1f(0x10a)]();if(_0x2fc6d5==='usdt'){const _0x336038=_0x309be9*(0x1+this[_0x1ffa1f(0xee)]/0x64);return console[_0x1ffa1f(0x133)](_0x1ffa1f(0x129)+this['MARKUP_PERCENTAGE']+_0x1ffa1f(0x12f)+_0x309be9+_0x1ffa1f(0x13b)+_0x336038[_0x1ffa1f(0x140)](0x6)+_0x1ffa1f(0x12b)),_0x336038;}try{const _0x3f30db=await this[_0x1ffa1f(0x10e)](_0x2fc6d5),_0x1a2e65=_0x309be9/_0x3f30db,_0x5efe62=_0x1a2e65*(0x1+this[_0x1ffa1f(0xee)]/0x64);return console[_0x1ffa1f(0x133)](_0x1ffa1f(0x122)+_0x309be9+'\x20'+_0x38d307[_0x1ffa1f(0x13f)]()+'\x20to\x20'+_0x1a2e65[_0x1ffa1f(0x140)](0x6)+'\x20USDT,\x20with\x20'+this[_0x1ffa1f(0xee)]+'%\x20markup\x20=\x20'+_0x5efe62[_0x1ffa1f(0x140)](0x6)+_0x1ffa1f(0x132)+_0x3f30db+')'),_0x5efe62;}catch(_0x51e4e0){console[_0x1ffa1f(0x154)](_0x1ffa1f(0x106)+_0x309be9+'\x20'+_0x38d307+_0x1ffa1f(0xf9),_0x51e4e0);const _0x244b2a=_0x309be9*(0x1+this[_0x1ffa1f(0xee)]/0x64);return _0x244b2a;}}async[a38_0x5f2b18(0x113)](_0x35b14d){const _0x10c543=a38_0x5f2b18;let _0x3ff527=0x0;for(const {amount:_0x409822,currency:_0x5d01cc}of _0x35b14d){const _0x369de2=await this[_0x10c543(0x144)](_0x409822,_0x5d01cc);_0x3ff527+=_0x369de2;}return _0x3ff527;}async[a38_0x5f2b18(0x127)](){const _0x43c3c7=a38_0x5f2b18;try{const _0x2a7fa4=await database_1[_0x43c3c7(0xf4)]['currencyRate'][_0x43c3c7(0x117)]({'select':{'currency':!![],'rate':!![]}}),_0x406498={'usdt':0x1};return _0x2a7fa4[_0x43c3c7(0x13d)](_0x1e35e0=>{const _0x308ee9=_0x43c3c7;_0x406498[_0x1e35e0[_0x308ee9(0x134)]]=_0x1e35e0[_0x308ee9(0x12c)];}),_0x406498;}catch(_0x148365){return console[_0x43c3c7(0x154)]('Error\x20getting\x20all\x20rates:',_0x148365),{'usdt':0x1};}}async['getRatesStatus'](){const _0x48c31c=a38_0x5f2b18;try{const [_0x17a3c7,_0x3ca64d,_0x20a07f]=await Promise[_0x48c31c(0x158)]([database_1[_0x48c31c(0xf4)]['currencyRate'][_0x48c31c(0x100)](),database_1[_0x48c31c(0xf4)][_0x48c31c(0x136)]['findFirst']({'orderBy':{'updatedAt':_0x48c31c(0xec)},'select':{'updatedAt':!![]}}),database_1[_0x48c31c(0xf4)][_0x48c31c(0x136)][_0x48c31c(0x11a)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x17a3c7,'lastUpdated':_0x3ca64d?.['updatedAt']||null,'oldestRate':_0x20a07f?.[_0x48c31c(0x142)]||null,'markupPercentage':this[_0x48c31c(0xee)]};}catch(_0x577994){return console['error']('Error\x20getting\x20rates\x20status:',_0x577994),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x5f2b18(0x101)](){const _0x100cc9=a38_0x5f2b18;return this[_0x100cc9(0xee)];}}function a38_0x3f63(){const _0x4e5b1d=['vef','chf','Error\x20converting\x20','dot','bdt','sgd','toLowerCase','currencyService','No\x20rate\x20found\x20for\x20currency:\x20','application/json','getCurrencyRate','bmd','CoinGecko\x20API\x20error:\x20','allSettled','tether','convertMultipleToUSDT','myr','hkd','updateCurrencyRates','findMany','✅\x20Currency\x20rates\x20updated\x20successfully','3188nprHfG','findFirst','7PDinHQ','ars','20jPEyuP','130pHVDns','link','10337184SIDghM','3683600HdYkFd','💱\x20Converted\x20','brl','ltc','Initial\x20currency\x20rates\x20update\x20failed:','\x20currencies','getAllRates','cad','💱\x20Applied\x20','xag','\x20USDT','rate','thb','__esModule','%\x20markup\x20to\x20','php','stopPeriodicUpdates','\x20USDT\x20(rate:\x20','log','currency','try','currencyRate','Error\x20getting\x20rate\x20for\x20currency\x20','866vLHHpW','pkr','join','\x20USDT\x20=\x20','gel','forEach','czk','toUpperCase','toFixed','vnd','updatedAt','btc','convertToUSDT','Periodic\x20currency\x20rates\x20update\x20failed:','startPeriodicUpdates','updateInterval','lkr','COINGECKO_URL','xlm','entries','zar','status','findUnique','aed','warn','cny','CURRENCIES','clp','error','sek','4854987evKbXn','Failed\x20to\x20update\x20rate\x20for\x20','all','defineProperty','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped',',\x20using\x201\x20as\x20fallback','ils','TesSoft\x20Payment\x20System/1.0','kwd','krw','aud','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','desc','13122681nnjVfc','MARKUP_PERCENTAGE','rub','json','map','mmk','nzd','default','2451333SMfIBO','idr','ngn','4kpBaLT','\x20to\x20USDT:','https://api.coingecko.com/api/v3/simple/price','eur','statusText','catch','eos','gbp','count','getMarkupPercentage','174810YpngUS','sar'];a38_0x3f63=function(){return _0x4e5b1d;};return a38_0x3f63();}exports['CurrencyService']=CurrencyService,exports[a38_0x5f2b18(0x10b)]=new CurrencyService();