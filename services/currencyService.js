'use strict';function a38_0x171a(){const _0x3205bf=['try','myr','%\x20markup\x20to\x20','583398mutymB','❌\x20Failed\x20to\x20update\x20currency\x20rates:','mxn','bch','dot','log','eos','TesSoft\x20Payment\x20System/1.0','application/json','__esModule','aud','twd','COINGECKO_URL','40ktKWxU','xau','xag','nzd','sats','upsert','status','asc','defineProperty','clp','bmd','2120HnlBWc','aed','toFixed','rub','count',',\x20using\x201\x20as\x20fallback','rate','bits','convertToUSDT','../config/database','sek','__importDefault','dkk','13BgIoSQ','toLowerCase','currencyRate','No\x20rate\x20found\x20for\x20currency:\x20','map','\x20to\x20USDT:','bdt','tether','keys','all','90CMSxuH','hkd','24666kiwliA','krw','CURRENCIES','\x20to\x20','lkr','Error\x20getting\x20all\x20rates:','toUpperCase','getRatesStatus','chf','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','desc','forEach','bnb','\x20USDT','usd','10205604SQEKyl','?ids=tether&vs_currencies=','bhd','ars','Error\x20getting\x20rates\x20status:','712547ZwFNPI','stopPeriodicUpdates','currency','eur','sgd','sar','CoinGecko\x20API\x20error:\x20','Initial\x20currency\x20rates\x20update\x20failed:','length','json','Periodic\x20currency\x20rates\x20update\x20failed:','413538HumSbl','2325936iZKIGS','eth','ngn','MARKUP_PERCENTAGE','usdt','updateCurrencyRates','updateInterval','nok','php','uah','vef','currencyService','default','CurrencyService','jpy','xrp','statusText','23863ldDbUx','link','zar','thb','https://api.coingecko.com/api/v3/simple/price','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xdr','61cVRrxM','\x20USDT\x20=\x20','updatedAt','findUnique','yfi','brl','error','findFirst','findMany','Failed\x20to\x20update\x20rate\x20for\x20','📊\x20Received\x20rates\x20for\x20','Error\x20getting\x20rate\x20for\x20currency\x20','3uxynys','cny','convertMultipleToUSDT','💱\x20Converted\x20','kwd'];a38_0x171a=function(){return _0x3205bf;};return a38_0x171a();}const a38_0x1bf909=a38_0x4ceb;(function(_0x2eb093,_0x5e54c1){const _0x3cf7c8=a38_0x4ceb,_0x335ab0=_0x2eb093();while(!![]){try{const _0x1f4a65=-parseInt(_0x3cf7c8(0x18e))/0x1*(-parseInt(_0x3cf7c8(0x1d3))/0x2)+-parseInt(_0x3cf7c8(0x19a))/0x3*(-parseInt(_0x3cf7c8(0x1f3))/0x4)+-parseInt(_0x3cf7c8(0x1af))/0x5*(-parseInt(_0x3cf7c8(0x1f2))/0x6)+parseInt(_0x3cf7c8(0x187))/0x7*(-parseInt(_0x3cf7c8(0x1ba))/0x8)+-parseInt(_0x3cf7c8(0x1a2))/0x9*(-parseInt(_0x3cf7c8(0x1d1))/0xa)+parseInt(_0x3cf7c8(0x1e7))/0xb+parseInt(_0x3cf7c8(0x1e2))/0xc*(-parseInt(_0x3cf7c8(0x1c7))/0xd);if(_0x1f4a65===_0x5e54c1)break;else _0x335ab0['push'](_0x335ab0['shift']());}catch(_0x550cdd){_0x335ab0['push'](_0x335ab0['shift']());}}}(a38_0x171a,0xbe4f0));var __importDefault=this&&this[a38_0x1bf909(0x1c5)]||function(_0x13994f){const _0x431a8e=a38_0x1bf909;return _0x13994f&&_0x13994f[_0x431a8e(0x1ab)]?_0x13994f:{'default':_0x13994f};};Object[a38_0x1bf909(0x1b7)](exports,a38_0x1bf909(0x1ab),{'value':!![]}),exports[a38_0x1bf909(0x181)]=exports['CurrencyService']=void 0x0;function a38_0x4ceb(_0x33eb5e,_0x26ed88){const _0x171aa1=a38_0x171a();return a38_0x4ceb=function(_0x4cebbc,_0x7ab715){_0x4cebbc=_0x4cebbc-0x17d;let _0x58ee56=_0x171aa1[_0x4cebbc];return _0x58ee56;},a38_0x4ceb(_0x33eb5e,_0x26ed88);}const database_1=__importDefault(require(a38_0x1bf909(0x1c3)));class CurrencyService{constructor(){const _0x5a44cd=a38_0x1bf909;this[_0x5a44cd(0x1ae)]=_0x5a44cd(0x18b),this[_0x5a44cd(0x1d5)]=['btc',_0x5a44cd(0x1f4),'ltc',_0x5a44cd(0x1a5),_0x5a44cd(0x1df),_0x5a44cd(0x1a8),_0x5a44cd(0x185),'xlm',_0x5a44cd(0x188),_0x5a44cd(0x1a6),_0x5a44cd(0x192),_0x5a44cd(0x1e1),_0x5a44cd(0x1bb),_0x5a44cd(0x1e5),_0x5a44cd(0x1ac),_0x5a44cd(0x1cd),_0x5a44cd(0x1e4),_0x5a44cd(0x1b9),_0x5a44cd(0x193),'cad',_0x5a44cd(0x1db),_0x5a44cd(0x1b8),_0x5a44cd(0x19b),'czk',_0x5a44cd(0x1c6),_0x5a44cd(0x1ea),'gbp','gel',_0x5a44cd(0x1d2),'huf','idr','ils','inr',_0x5a44cd(0x184),_0x5a44cd(0x1d4),_0x5a44cd(0x19e),_0x5a44cd(0x1d7),'mmk',_0x5a44cd(0x1a4),_0x5a44cd(0x1a0),_0x5a44cd(0x1f5),_0x5a44cd(0x17d),_0x5a44cd(0x1b2),_0x5a44cd(0x17e),'pkr','pln',_0x5a44cd(0x1bd),_0x5a44cd(0x1ec),_0x5a44cd(0x1c4),_0x5a44cd(0x1eb),_0x5a44cd(0x18a),_0x5a44cd(0x19f),_0x5a44cd(0x1ad),_0x5a44cd(0x17f),_0x5a44cd(0x180),'vnd',_0x5a44cd(0x189),_0x5a44cd(0x18d),_0x5a44cd(0x1b1),_0x5a44cd(0x1b0),_0x5a44cd(0x1c1),_0x5a44cd(0x1b3)],this[_0x5a44cd(0x1f9)]=null,this[_0x5a44cd(0x1f6)]=0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0xe1c4bc=a38_0x1bf909;this[_0xe1c4bc(0x1f8)]()['catch'](_0x2ae258=>{const _0x1d720c=_0xe1c4bc;console['error'](_0x1d720c(0x1ee),_0x2ae258);}),this[_0xe1c4bc(0x1f9)]=setInterval(async()=>{const _0x5cefad=_0xe1c4bc;try{await this[_0x5cefad(0x1f8)]();}catch(_0x45e92f){console[_0x5cefad(0x194)](_0x5cefad(0x1f1),_0x45e92f);}},0x3c*0x3c*0x3e8),console[_0xe1c4bc(0x1a7)](_0xe1c4bc(0x18c));}[a38_0x1bf909(0x1e8)](){const _0x233bcb=a38_0x1bf909;this[_0x233bcb(0x1f9)]&&(clearInterval(this[_0x233bcb(0x1f9)]),this['updateInterval']=null,console[_0x233bcb(0x1a7)](_0x233bcb(0x1dc)));}async['updateCurrencyRates'](){const _0x41224a=a38_0x1bf909;try{console[_0x41224a(0x1a7)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x3b037e=this['CURRENCIES']['join'](','),_0x382cc9=this[_0x41224a(0x1ae)]+_0x41224a(0x1e3)+_0x3b037e,_0x282aa6=await fetch(_0x382cc9,{'headers':{'Accept':_0x41224a(0x1aa),'User-Agent':_0x41224a(0x1a9)}});if(!_0x282aa6['ok'])throw new Error(_0x41224a(0x1ed)+_0x282aa6[_0x41224a(0x1b5)]+'\x20'+_0x282aa6[_0x41224a(0x186)]);const _0x523a58=await _0x282aa6[_0x41224a(0x1f0)]();if(!_0x523a58['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x43efb7=_0x523a58[_0x41224a(0x1ce)];console[_0x41224a(0x1a7)](_0x41224a(0x198)+Object[_0x41224a(0x1cf)](_0x43efb7)[_0x41224a(0x1ef)]+'\x20currencies');const _0x1b8a88=Object['entries'](_0x43efb7)[_0x41224a(0x1cb)](async([_0x224b4b,_0x4698cb])=>{const _0x4ee97d=_0x41224a;try{await database_1[_0x4ee97d(0x182)]['currencyRate'][_0x4ee97d(0x1b4)]({'where':{'currency':_0x224b4b[_0x4ee97d(0x1c8)]()},'update':{'rate':_0x4698cb},'create':{'currency':_0x224b4b[_0x4ee97d(0x1c8)](),'rate':_0x4698cb}});}catch(_0x4293e0){console[_0x4ee97d(0x194)](_0x4ee97d(0x197)+_0x224b4b+':',_0x4293e0);}});await Promise['allSettled'](_0x1b8a88),console[_0x41224a(0x1a7)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x3ff02d){console[_0x41224a(0x194)](_0x41224a(0x1a3),_0x3ff02d);throw _0x3ff02d;}}async['getCurrencyRate'](_0x503637){const _0x144e81=a38_0x1bf909,_0x44de4c=_0x503637[_0x144e81(0x1c8)]();if(_0x44de4c===_0x144e81(0x1f7))return 0x1;try{const _0x4e98bf=await database_1[_0x144e81(0x182)]['currencyRate'][_0x144e81(0x191)]({'where':{'currency':_0x44de4c}});if(!_0x4e98bf)return console['warn'](_0x144e81(0x1ca)+_0x503637+_0x144e81(0x1bf)),0x1;return _0x4e98bf['rate'];}catch(_0x329f2f){return console[_0x144e81(0x194)](_0x144e81(0x199)+_0x503637+':',_0x329f2f),0x1;}}async[a38_0x1bf909(0x1c2)](_0xd44e3d,_0x5bb045){const _0x430660=a38_0x1bf909,_0x48f131=_0x5bb045['toLowerCase']();if(_0x48f131===_0x430660(0x1f7)){const _0x382b67=_0xd44e3d*(0x1+this[_0x430660(0x1f6)]/0x64);return console[_0x430660(0x1a7)]('💱\x20Applied\x20'+this[_0x430660(0x1f6)]+_0x430660(0x1a1)+_0xd44e3d+_0x430660(0x18f)+_0x382b67['toFixed'](0x6)+_0x430660(0x1e0)),_0x382b67;}try{const _0x552015=await this['getCurrencyRate'](_0x48f131),_0x2286af=_0xd44e3d/_0x552015,_0x1202fe=_0x2286af*(0x1+this[_0x430660(0x1f6)]/0x64);return console['log'](_0x430660(0x19d)+_0xd44e3d+'\x20'+_0x5bb045[_0x430660(0x1d9)]()+_0x430660(0x1d6)+_0x2286af[_0x430660(0x1bc)](0x6)+'\x20USDT,\x20with\x20'+this[_0x430660(0x1f6)]+'%\x20markup\x20=\x20'+_0x1202fe[_0x430660(0x1bc)](0x6)+'\x20USDT\x20(rate:\x20'+_0x552015+')'),_0x1202fe;}catch(_0x428a7e){console[_0x430660(0x194)]('Error\x20converting\x20'+_0xd44e3d+'\x20'+_0x5bb045+_0x430660(0x1cc),_0x428a7e);const _0x341273=_0xd44e3d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x341273;}}async[a38_0x1bf909(0x19c)](_0x4284af){const _0xfb1f4c=a38_0x1bf909;let _0x5a29db=0x0;for(const {amount:_0xaf66b4,currency:_0x1e0693}of _0x4284af){const _0x1e4234=await this[_0xfb1f4c(0x1c2)](_0xaf66b4,_0x1e0693);_0x5a29db+=_0x1e4234;}return _0x5a29db;}async['getAllRates'](){const _0x296257=a38_0x1bf909;try{const _0x3aad89=await database_1['default'][_0x296257(0x1c9)][_0x296257(0x196)]({'select':{'currency':!![],'rate':!![]}}),_0x33d105={'usdt':0x1};return _0x3aad89[_0x296257(0x1de)](_0x196af5=>{const _0x11d903=_0x296257;_0x33d105[_0x196af5[_0x11d903(0x1e9)]]=_0x196af5[_0x11d903(0x1c0)];}),_0x33d105;}catch(_0x11c12e){return console[_0x296257(0x194)](_0x296257(0x1d8),_0x11c12e),{'usdt':0x1};}}async[a38_0x1bf909(0x1da)](){const _0x425e3c=a38_0x1bf909;try{const [_0x5f5f3a,_0x389d86,_0x3c0de9]=await Promise[_0x425e3c(0x1d0)]([database_1[_0x425e3c(0x182)][_0x425e3c(0x1c9)][_0x425e3c(0x1be)](),database_1[_0x425e3c(0x182)]['currencyRate'][_0x425e3c(0x195)]({'orderBy':{'updatedAt':_0x425e3c(0x1dd)},'select':{'updatedAt':!![]}}),database_1[_0x425e3c(0x182)][_0x425e3c(0x1c9)][_0x425e3c(0x195)]({'orderBy':{'updatedAt':_0x425e3c(0x1b6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5f5f3a,'lastUpdated':_0x389d86?.[_0x425e3c(0x190)]||null,'oldestRate':_0x3c0de9?.[_0x425e3c(0x190)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x283f3d){return console[_0x425e3c(0x194)](_0x425e3c(0x1e6),_0x283f3d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0x20da06=a38_0x1bf909;return this[_0x20da06(0x1f6)];}}exports[a38_0x1bf909(0x183)]=CurrencyService,exports[a38_0x1bf909(0x181)]=new CurrencyService();