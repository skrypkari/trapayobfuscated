'use strict';const a41_0x56a728=a41_0x4c05;(function(_0x53b07a,_0xd1120){const _0xa48dc3=a41_0x4c05,_0xbb9469=_0x53b07a();while(!![]){try{const _0x5336eb=-parseInt(_0xa48dc3(0x1c1))/0x1+parseInt(_0xa48dc3(0x227))/0x2*(-parseInt(_0xa48dc3(0x214))/0x3)+parseInt(_0xa48dc3(0x1f7))/0x4*(parseInt(_0xa48dc3(0x1e6))/0x5)+parseInt(_0xa48dc3(0x216))/0x6*(-parseInt(_0xa48dc3(0x1d7))/0x7)+parseInt(_0xa48dc3(0x1e5))/0x8+-parseInt(_0xa48dc3(0x220))/0x9+-parseInt(_0xa48dc3(0x1d3))/0xa*(-parseInt(_0xa48dc3(0x1d5))/0xb);if(_0x5336eb===_0xd1120)break;else _0xbb9469['push'](_0xbb9469['shift']());}catch(_0x43d77a){_0xbb9469['push'](_0xbb9469['shift']());}}}(a41_0x217a,0x6651f));var __importDefault=this&&this['__importDefault']||function(_0x1b16af){const _0x378697=a41_0x4c05;return _0x1b16af&&_0x1b16af[_0x378697(0x1fa)]?_0x1b16af:{'default':_0x1b16af};};Object[a41_0x56a728(0x20b)](exports,'__esModule',{'value':!![]}),exports[a41_0x56a728(0x1c5)]=exports[a41_0x56a728(0x212)]=void 0x0;const database_1=__importDefault(require(a41_0x56a728(0x211)));class CurrencyService{constructor(){const _0x4aa027=a41_0x56a728;this['COINGECKO_URL']=_0x4aa027(0x20e),this['CURRENCIES']=[_0x4aa027(0x223),_0x4aa027(0x20f),'ltc','bch','bnb',_0x4aa027(0x1df),_0x4aa027(0x1f8),_0x4aa027(0x224),_0x4aa027(0x1d1),_0x4aa027(0x20a),_0x4aa027(0x1e0),_0x4aa027(0x1bc),_0x4aa027(0x1b5),'ars',_0x4aa027(0x1bf),'bdt',_0x4aa027(0x1c8),_0x4aa027(0x1cf),'brl',_0x4aa027(0x219),_0x4aa027(0x1fc),'clp',_0x4aa027(0x22a),_0x4aa027(0x1c4),_0x4aa027(0x1cc),_0x4aa027(0x1f4),_0x4aa027(0x1cb),_0x4aa027(0x21f),_0x4aa027(0x1e8),_0x4aa027(0x20c),_0x4aa027(0x1e9),_0x4aa027(0x1b9),_0x4aa027(0x22e),_0x4aa027(0x22b),'krw','kwd','lkr',_0x4aa027(0x1ce),_0x4aa027(0x200),'myr',_0x4aa027(0x206),'nok','nzd',_0x4aa027(0x1dc),_0x4aa027(0x22f),_0x4aa027(0x208),_0x4aa027(0x1f9),_0x4aa027(0x209),_0x4aa027(0x1dd),_0x4aa027(0x1b2),_0x4aa027(0x213),_0x4aa027(0x1d8),_0x4aa027(0x1e1),'uah','vef',_0x4aa027(0x226),'zar',_0x4aa027(0x222),_0x4aa027(0x1da),_0x4aa027(0x215),'bits',_0x4aa027(0x1d0)],this[_0x4aa027(0x207)]=null,this[_0x4aa027(0x1f0)]=-0x3,this['startPeriodicUpdates']();}[a41_0x56a728(0x21a)](){const _0x5df6eb=a41_0x56a728;this[_0x5df6eb(0x221)]()['catch'](_0x1ee33a=>{const _0xf3e32=_0x5df6eb;console['error'](_0xf3e32(0x1ec),_0x1ee33a);}),this[_0x5df6eb(0x207)]=setInterval(async()=>{const _0x29375c=_0x5df6eb;try{await this[_0x29375c(0x221)]();}catch(_0x267ff5){console[_0x29375c(0x1c0)](_0x29375c(0x1d9),_0x267ff5);}},0x3c*0x3c*0x3e8),console[_0x5df6eb(0x1be)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a41_0x56a728(0x1c3)](){const _0x4e8051=a41_0x56a728;this[_0x4e8051(0x207)]&&(clearInterval(this[_0x4e8051(0x207)]),this[_0x4e8051(0x207)]=null,console['log'](_0x4e8051(0x21d)));}async[a41_0x56a728(0x221)](){const _0x262ca8=a41_0x56a728;try{console[_0x262ca8(0x1be)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x14a37a=this['CURRENCIES']['join'](','),_0x552ee4=this[_0x262ca8(0x1d6)]+_0x262ca8(0x1c9)+_0x14a37a,_0x8e20c=await fetch(_0x552ee4,{'headers':{'Accept':_0x262ca8(0x228),'User-Agent':_0x262ca8(0x205)}});if(!_0x8e20c['ok'])throw new Error(_0x262ca8(0x218)+_0x8e20c[_0x262ca8(0x1d2)]+'\x20'+_0x8e20c[_0x262ca8(0x210)]);const _0x43b3b6=await _0x8e20c[_0x262ca8(0x1ea)]();if(!_0x43b3b6[_0x262ca8(0x1f1)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x339ed3=_0x43b3b6[_0x262ca8(0x1f1)];console[_0x262ca8(0x1be)]('üìä\x20Received\x20rates\x20for\x20'+Object[_0x262ca8(0x1c7)](_0x339ed3)[_0x262ca8(0x20d)]+_0x262ca8(0x1e3));const _0x368644=Object[_0x262ca8(0x21b)](_0x339ed3)[_0x262ca8(0x230)](async([_0x8f8ba2,_0x5060c6])=>{const _0x4ee365=_0x262ca8;try{await database_1['default'][_0x4ee365(0x1b3)][_0x4ee365(0x1e7)]({'where':{'currency':_0x8f8ba2[_0x4ee365(0x229)]()},'update':{'rate':_0x5060c6},'create':{'currency':_0x8f8ba2['toLowerCase'](),'rate':_0x5060c6}});}catch(_0x6532c2){console[_0x4ee365(0x1c0)](_0x4ee365(0x203)+_0x8f8ba2+':',_0x6532c2);}});await Promise[_0x262ca8(0x1fe)](_0x368644),console['log'](_0x262ca8(0x1ed));}catch(_0x38d634){console[_0x262ca8(0x1c0)](_0x262ca8(0x1f2),_0x38d634);throw _0x38d634;}}async['getCurrencyRate'](_0x153909){const _0x2cb2a8=a41_0x56a728,_0x3049c6=_0x153909[_0x2cb2a8(0x229)]();if(_0x3049c6===_0x2cb2a8(0x1ef))return 0x1;try{const _0x661829=await database_1[_0x2cb2a8(0x1bb)][_0x2cb2a8(0x1b3)]['findUnique']({'where':{'currency':_0x3049c6}});if(!_0x661829)return console[_0x2cb2a8(0x1d4)](_0x2cb2a8(0x1cd)+_0x153909+_0x2cb2a8(0x201)),0x1;return _0x661829[_0x2cb2a8(0x202)];}catch(_0x138918){return console[_0x2cb2a8(0x1c0)](_0x2cb2a8(0x1fd)+_0x153909+':',_0x138918),0x1;}}async[a41_0x56a728(0x1ba)](_0x13a644,_0x2feadc){const _0x1f0d91=a41_0x56a728,_0x560b7c=_0x2feadc[_0x1f0d91(0x229)]();if(_0x560b7c===_0x1f0d91(0x1ef)){const _0x413346=_0x13a644*(0x1+this[_0x1f0d91(0x1f0)]/0x64);return console[_0x1f0d91(0x1be)](_0x1f0d91(0x1f6)+this[_0x1f0d91(0x1f0)]+_0x1f0d91(0x217)+_0x13a644+_0x1f0d91(0x1eb)+_0x413346[_0x1f0d91(0x225)](0x6)+_0x1f0d91(0x1b8)),_0x413346;}try{const _0x23c588=await this[_0x1f0d91(0x21c)](_0x560b7c),_0x2cb20d=_0x13a644/_0x23c588,_0x1e7c97=_0x2cb20d*(0x1+this[_0x1f0d91(0x1f0)]/0x64);return console['log']('üí±\x20Converted\x20'+_0x13a644+'\x20'+_0x2feadc[_0x1f0d91(0x1db)]()+_0x1f0d91(0x204)+_0x2cb20d[_0x1f0d91(0x225)](0x6)+_0x1f0d91(0x1de)+this['MARKUP_PERCENTAGE']+_0x1f0d91(0x1bd)+_0x1e7c97[_0x1f0d91(0x225)](0x6)+_0x1f0d91(0x1b7)+_0x23c588+')'),_0x1e7c97;}catch(_0x44f475){console[_0x1f0d91(0x1c0)](_0x1f0d91(0x1c2)+_0x13a644+'\x20'+_0x2feadc+_0x1f0d91(0x22d),_0x44f475);const _0x56b25d=_0x13a644*(0x1+this[_0x1f0d91(0x1f0)]/0x64);return _0x56b25d;}}async[a41_0x56a728(0x1ee)](_0x443136){let _0x446423=0x0;for(const {amount:_0xf7d49a,currency:_0x558815}of _0x443136){const _0x3a7d1c=await this['convertToUSDT'](_0xf7d49a,_0x558815);_0x446423+=_0x3a7d1c;}return _0x446423;}async[a41_0x56a728(0x22c)](){const _0x16e5d3=a41_0x56a728;try{const _0x4ca7a5=await database_1[_0x16e5d3(0x1bb)][_0x16e5d3(0x1b3)][_0x16e5d3(0x1ca)]({'select':{'currency':!![],'rate':!![]}}),_0x4143b1={'usdt':0x1};return _0x4ca7a5[_0x16e5d3(0x231)](_0x58de0b=>{const _0x32f176=_0x16e5d3;_0x4143b1[_0x58de0b[_0x32f176(0x1b6)]]=_0x58de0b[_0x32f176(0x202)];}),_0x4143b1;}catch(_0x4c6937){return console[_0x16e5d3(0x1c0)](_0x16e5d3(0x1e2),_0x4c6937),{'usdt':0x1};}}async[a41_0x56a728(0x1e4)](){const _0x12f7cd=a41_0x56a728;try{const [_0x2df337,_0x384da1,_0x29121f]=await Promise[_0x12f7cd(0x1f3)]([database_1[_0x12f7cd(0x1bb)][_0x12f7cd(0x1b3)][_0x12f7cd(0x1f5)](),database_1['default'][_0x12f7cd(0x1b3)][_0x12f7cd(0x1b4)]({'orderBy':{'updatedAt':_0x12f7cd(0x232)},'select':{'updatedAt':!![]}}),database_1[_0x12f7cd(0x1bb)][_0x12f7cd(0x1b3)][_0x12f7cd(0x1b4)]({'orderBy':{'updatedAt':_0x12f7cd(0x1fb)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2df337,'lastUpdated':_0x384da1?.[_0x12f7cd(0x1ff)]||null,'oldestRate':_0x29121f?.[_0x12f7cd(0x1ff)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x10c435){return console['error'](_0x12f7cd(0x1c6),_0x10c435),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a41_0x56a728(0x21e)](){return this['MARKUP_PERCENTAGE'];}}function a41_0x217a(){const _0x1d1f9c=['eth','statusText','../config/database','CurrencyService','thb','633cVbRMC','xau','810lUgNhn','%\x20markup\x20to\x20','CoinGecko\x20API\x20error:\x20','cad','startPeriodicUpdates','entries','getCurrencyRate','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','getMarkupPercentage','gel','7000380cdccoW','updateCurrencyRates','xdr','btc','xlm','toFixed','vnd','3098NRaNhz','application/json','toLowerCase','cny','jpy','getAllRates','\x20to\x20USDT:','inr','pkr','map','forEach','desc','sgd','currencyRate','findFirst','aed','currency','\x20USDT\x20(rate:\x20','\x20USDT','ils','convertToUSDT','default','usd','%\x20markup\x20=\x20','log','aud','error','739525ktoSqm','Error\x20converting\x20','stopPeriodicUpdates','czk','currencyService','Error\x20getting\x20rates\x20status:','keys','bhd','?ids=tether&vs_currencies=','findMany','gbp','dkk','No\x20rate\x20found\x20for\x20currency:\x20','mmk','bmd','sats','link','status','505570CgtskC','warn','286tXSQTL','COINGECKO_URL','20741NYjTuM','try','Periodic\x20currency\x20rates\x20update\x20failed:','xag','toUpperCase','php','sek','\x20USDT,\x20with\x20','eos','yfi','twd','Error\x20getting\x20all\x20rates:','\x20currencies','getRatesStatus','5242664azAgoJ','13285oADZKR','upsert','hkd','idr','json','\x20USDT\x20=\x20','Initial\x20currency\x20rates\x20update\x20failed:','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','convertMultipleToUSDT','usdt','MARKUP_PERCENTAGE','tether','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','all','eur','count','üí±\x20Applied\x20','1044NhqFFS','xrp','rub','__esModule','asc','chf','Error\x20getting\x20rate\x20for\x20currency\x20','allSettled','updatedAt','mxn',',\x20using\x201\x20as\x20fallback','rate','Failed\x20to\x20update\x20rate\x20for\x20','\x20to\x20','TesSoft\x20Payment\x20System/1.0','ngn','updateInterval','pln','sar','dot','defineProperty','huf','length','https://api.coingecko.com/api/v3/simple/price'];a41_0x217a=function(){return _0x1d1f9c;};return a41_0x217a();}function a41_0x4c05(_0x18d81a,_0x40626a){const _0x217a5a=a41_0x217a();return a41_0x4c05=function(_0x4c0546,_0x5003a1){_0x4c0546=_0x4c0546-0x1b2;let _0x5c25b0=_0x217a5a[_0x4c0546];return _0x5c25b0;},a41_0x4c05(_0x18d81a,_0x40626a);}exports[a41_0x56a728(0x212)]=CurrencyService,exports[a41_0x56a728(0x1c5)]=new CurrencyService();