'use strict';function a41_0x2d6a(){const _0x5bf4f6=['ngn','czk','vef','tether','status','xau','ils','catch','convertToUSDT','bits','usdt','huf','thb','bnb','Error\x20converting\x20','hkd','sar','sgd','\x20USDT,\x20with\x20','nok','krw','allSettled','2874354njescw','__esModule','keys','cny','8073TyOTNu','1432TgkNLI','297699wXzEzO','MARKUP_PERCENTAGE','5178lYgNSW','CurrencyService','vnd','61666kIQDJH','bch','Error\x20getting\x20rates\x20status:','xdr','uah','__importDefault','getRatesStatus','toLowerCase','ars','xrp','💱\x20Converted\x20','\x20to\x20','log','Error\x20getting\x20rate\x20for\x20currency\x20','currencyService','inr','../config/database','1816864lehuBj','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','✅\x20Currency\x20rates\x20updated\x20successfully','xag','updatedAt','%\x20markup\x20to\x20','Periodic\x20currency\x20rates\x20update\x20failed:','error','join','\x20USDT\x20(rate:\x20','currency','No\x20rate\x20found\x20for\x20currency:\x20','bhd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','https://api.coingecko.com/api/v3/simple/price','eur','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','Error\x20getting\x20all\x20rates:','map','btc','updateInterval','1330iPpKtq','startPeriodicUpdates','try','toFixed','currencyRate','bdt','mxn','clp','count','myr','entries','dot','length','updateCurrencyRates','104DZISAp','idr','sek','kwd','Initial\x20currency\x20rates\x20update\x20failed:','aed','findFirst','COINGECKO_URL','getAllRates','Payment\x20System/1.0','forEach','?ids=tether&vs_currencies=','warn','rub','sats','aud','zar','getMarkupPercentage','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','💱\x20Applied\x20','getCurrencyRate','692665quCmuC','rate','nzd','convertMultipleToUSDT','lkr','4CETFDt','findMany','gel','findUnique','default','dkk','xlm'];a41_0x2d6a=function(){return _0x5bf4f6;};return a41_0x2d6a();}const a41_0x5ba0bf=a41_0x4eff;(function(_0x562ab9,_0x9d9a3f){const _0x2065fd=a41_0x4eff,_0x372c44=_0x562ab9();while(!![]){try{const _0x157479=parseInt(_0x2065fd(0x162))/0x1*(-parseInt(_0x2065fd(0x12b))/0x2)+parseInt(_0x2065fd(0x129))/0x3*(parseInt(_0x2065fd(0x106))/0x4)+parseInt(_0x2065fd(0x101))/0x5+parseInt(_0x2065fd(0x123))/0x6+-parseInt(_0x2065fd(0x13f))/0x7+-parseInt(_0x2065fd(0x128))/0x8*(parseInt(_0x2065fd(0x127))/0x9)+-parseInt(_0x2065fd(0x154))/0xa*(-parseInt(_0x2065fd(0x12e))/0xb);if(_0x157479===_0x9d9a3f)break;else _0x372c44['push'](_0x372c44['shift']());}catch(_0x312706){_0x372c44['push'](_0x372c44['shift']());}}}(a41_0x2d6a,0xbcbbc));var __importDefault=this&&this[a41_0x5ba0bf(0x133)]||function(_0x281c3a){const _0x16dde4=a41_0x5ba0bf;return _0x281c3a&&_0x281c3a[_0x16dde4(0x124)]?_0x281c3a:{'default':_0x281c3a};};function a41_0x4eff(_0x5c824c,_0xd0111){const _0x2d6a49=a41_0x2d6a();return a41_0x4eff=function(_0x4eff3e,_0x4ba7b6){_0x4eff3e=_0x4eff3e-0xed;let _0x1f95f4=_0x2d6a49[_0x4eff3e];return _0x1f95f4;},a41_0x4eff(_0x5c824c,_0xd0111);}Object['defineProperty'](exports,a41_0x5ba0bf(0x124),{'value':!![]}),exports[a41_0x5ba0bf(0x13c)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a41_0x5ba0bf(0x13e)));class CurrencyService{constructor(){const _0x2a0e71=a41_0x5ba0bf;this[_0x2a0e71(0xf3)]=_0x2a0e71(0x14d),this['CURRENCIES']=[_0x2a0e71(0x152),'eth','ltc',_0x2a0e71(0x12f),_0x2a0e71(0x11a),'eos',_0x2a0e71(0x137),_0x2a0e71(0x10c),'link',_0x2a0e71(0x15f),'yfi','usd',_0x2a0e71(0xf1),_0x2a0e71(0x136),_0x2a0e71(0xfb),_0x2a0e71(0x159),_0x2a0e71(0x14b),'bmd','brl','cad','chf',_0x2a0e71(0x15b),_0x2a0e71(0x126),_0x2a0e71(0x10e),_0x2a0e71(0x10b),_0x2a0e71(0x14e),'gbp',_0x2a0e71(0x108),_0x2a0e71(0x11c),_0x2a0e71(0x118),_0x2a0e71(0xed),_0x2a0e71(0x113),_0x2a0e71(0x13d),'jpy',_0x2a0e71(0x121),_0x2a0e71(0xef),_0x2a0e71(0x105),'mmk',_0x2a0e71(0x15a),_0x2a0e71(0x15d),_0x2a0e71(0x10d),_0x2a0e71(0x120),_0x2a0e71(0x103),'php','pkr','pln',_0x2a0e71(0xf9),_0x2a0e71(0x11d),_0x2a0e71(0xee),_0x2a0e71(0x11e),_0x2a0e71(0x119),_0x2a0e71(0x156),'twd',_0x2a0e71(0x132),_0x2a0e71(0x10f),_0x2a0e71(0x12d),_0x2a0e71(0xfc),_0x2a0e71(0x131),_0x2a0e71(0x142),_0x2a0e71(0x112),_0x2a0e71(0x116),_0x2a0e71(0xfa)],this['updateInterval']=null,this[_0x2a0e71(0x12a)]=-0x3,this['startPeriodicUpdates']();}[a41_0x5ba0bf(0x155)](){const _0x3b5bf5=a41_0x5ba0bf;this[_0x3b5bf5(0x161)]()[_0x3b5bf5(0x114)](_0x5f10dd=>{const _0x278e95=_0x3b5bf5;console['error'](_0x278e95(0xf0),_0x5f10dd);}),this['updateInterval']=setInterval(async()=>{const _0x14c660=_0x3b5bf5;try{await this[_0x14c660(0x161)]();}catch(_0x30672d){console[_0x14c660(0x146)](_0x14c660(0x145),_0x30672d);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x219959=a41_0x5ba0bf;this[_0x219959(0x153)]&&(clearInterval(this[_0x219959(0x153)]),this[_0x219959(0x153)]=null,console['log'](_0x219959(0xfe)));}async[a41_0x5ba0bf(0x161)](){const _0x51d1fd=a41_0x5ba0bf;try{console[_0x51d1fd(0x13a)](_0x51d1fd(0x140));const _0x760e1b=this['CURRENCIES'][_0x51d1fd(0x147)](','),_0x4265a5=this[_0x51d1fd(0xf3)]+_0x51d1fd(0xf7)+_0x760e1b,_0x2984a8=await fetch(_0x4265a5,{'headers':{'Accept':'application/json','User-Agent':_0x51d1fd(0xf5)}});if(!_0x2984a8['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x2984a8[_0x51d1fd(0x111)]+'\x20'+_0x2984a8['statusText']);const _0x33f0ab=await _0x2984a8['json']();if(!_0x33f0ab[_0x51d1fd(0x110)])throw new Error(_0x51d1fd(0x14f));const _0x5683a3=_0x33f0ab[_0x51d1fd(0x110)];console[_0x51d1fd(0x13a)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x51d1fd(0x125)](_0x5683a3)[_0x51d1fd(0x160)]+'\x20currencies');const _0x5f5a6d=Object[_0x51d1fd(0x15e)](_0x5683a3)[_0x51d1fd(0x151)](async([_0x173df9,_0x6ddb01])=>{const _0x69f48a=_0x51d1fd;try{await database_1[_0x69f48a(0x10a)]['currencyRate']['upsert']({'where':{'currency':_0x173df9[_0x69f48a(0x135)]()},'update':{'rate':_0x6ddb01},'create':{'currency':_0x173df9[_0x69f48a(0x135)](),'rate':_0x6ddb01}});}catch(_0x402a06){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x173df9+':',_0x402a06);}});await Promise[_0x51d1fd(0x122)](_0x5f5a6d),console[_0x51d1fd(0x13a)](_0x51d1fd(0x141));}catch(_0x1a6eb4){console['error'](_0x51d1fd(0x14c),_0x1a6eb4);throw _0x1a6eb4;}}async[a41_0x5ba0bf(0x100)](_0x1d35a2){const _0x35fdb9=a41_0x5ba0bf,_0x55ab33=_0x1d35a2[_0x35fdb9(0x135)]();if(_0x55ab33==='usdt')return 0x1;try{const _0x185ee6=await database_1['default'][_0x35fdb9(0x158)][_0x35fdb9(0x109)]({'where':{'currency':_0x55ab33}});if(!_0x185ee6)return console[_0x35fdb9(0xf8)](_0x35fdb9(0x14a)+_0x1d35a2+',\x20using\x201\x20as\x20fallback'),0x1;return _0x185ee6[_0x35fdb9(0x102)];}catch(_0x44e773){return console[_0x35fdb9(0x146)](_0x35fdb9(0x13b)+_0x1d35a2+':',_0x44e773),0x1;}}async[a41_0x5ba0bf(0x115)](_0xf88d7c,_0x16cf9a){const _0x5105f2=a41_0x5ba0bf,_0x4c0572=_0x16cf9a[_0x5105f2(0x135)]();if(_0x4c0572===_0x5105f2(0x117)){const _0x2e4c44=_0xf88d7c*(0x1+this[_0x5105f2(0x12a)]/0x64);return console[_0x5105f2(0x13a)](_0x5105f2(0xff)+this['MARKUP_PERCENTAGE']+_0x5105f2(0x144)+_0xf88d7c+'\x20USDT\x20=\x20'+_0x2e4c44[_0x5105f2(0x157)](0x6)+'\x20USDT'),_0x2e4c44;}try{const _0x355579=await this[_0x5105f2(0x100)](_0x4c0572),_0x21e8aa=_0xf88d7c/_0x355579,_0x1433a7=_0x21e8aa*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5105f2(0x13a)](_0x5105f2(0x138)+_0xf88d7c+'\x20'+_0x16cf9a['toUpperCase']()+_0x5105f2(0x139)+_0x21e8aa[_0x5105f2(0x157)](0x6)+_0x5105f2(0x11f)+this[_0x5105f2(0x12a)]+'%\x20markup\x20=\x20'+_0x1433a7[_0x5105f2(0x157)](0x6)+_0x5105f2(0x148)+_0x355579+')'),_0x1433a7;}catch(_0x9ea3ba){console['error'](_0x5105f2(0x11b)+_0xf88d7c+'\x20'+_0x16cf9a+'\x20to\x20USDT:',_0x9ea3ba);const _0x518155=_0xf88d7c*(0x1+this[_0x5105f2(0x12a)]/0x64);return _0x518155;}}async[a41_0x5ba0bf(0x104)](_0x2ca445){const _0x3c34f3=a41_0x5ba0bf;let _0x5ea169=0x0;for(const {amount:_0x2ce7ee,currency:_0x567193}of _0x2ca445){const _0x17ce53=await this[_0x3c34f3(0x115)](_0x2ce7ee,_0x567193);_0x5ea169+=_0x17ce53;}return _0x5ea169;}async[a41_0x5ba0bf(0xf4)](){const _0x483669=a41_0x5ba0bf;try{const _0x326b63=await database_1[_0x483669(0x10a)][_0x483669(0x158)][_0x483669(0x107)]({'select':{'currency':!![],'rate':!![]}}),_0x5a9777={'usdt':0x1};return _0x326b63[_0x483669(0xf6)](_0x50333e=>{const _0x45c0ce=_0x483669;_0x5a9777[_0x50333e[_0x45c0ce(0x149)]]=_0x50333e['rate'];}),_0x5a9777;}catch(_0x49a19f){return console[_0x483669(0x146)](_0x483669(0x150),_0x49a19f),{'usdt':0x1};}}async[a41_0x5ba0bf(0x134)](){const _0x5470d0=a41_0x5ba0bf;try{const [_0x5f3226,_0x337de7,_0x15a493]=await Promise['all']([database_1[_0x5470d0(0x10a)]['currencyRate'][_0x5470d0(0x15c)](),database_1[_0x5470d0(0x10a)]['currencyRate'][_0x5470d0(0xf2)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x5470d0(0x10a)][_0x5470d0(0x158)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5f3226,'lastUpdated':_0x337de7?.['updatedAt']||null,'oldestRate':_0x15a493?.[_0x5470d0(0x143)]||null,'markupPercentage':this[_0x5470d0(0x12a)]};}catch(_0x109ccb){return console[_0x5470d0(0x146)](_0x5470d0(0x130),_0x109ccb),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5470d0(0x12a)]};}}[a41_0x5ba0bf(0xfd)](){return this['MARKUP_PERCENTAGE'];}}exports[a41_0x5ba0bf(0x12c)]=CurrencyService,exports['currencyService']=new CurrencyService();