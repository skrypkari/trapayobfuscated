'use strict';const a39_0x2a6614=a39_0x1800;function a39_0x4026(){const _0x297939=['length','log','../config/database','eur','vef','updateCurrencyRates','84jimrKs','?ids=tether&vs_currencies=','907405yJnHAm','bhd','TesSoft\x20Payment\x20System/1.0','aud','application/json','nzd','czk','json','catch','754140mdHMxZ','bnb','hkd','usd','rate','twd','\x20USDT,\x20with\x20',',\x20using\x201\x20as\x20fallback','uah','stopPeriodicUpdates','sek','2145584dLFyUD','kwd','currency','bmd','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','Error\x20getting\x20all\x20rates:','lkr','updateInterval','xlm','\x20to\x20','%\x20markup\x20=\x20','📊\x20Received\x20rates\x20for\x20','join','89782BBAWNJ','xdr','\x20USDT','eos','php','6frRZml','CURRENCIES','dot','try','entries','getRatesStatus','https://api.coingecko.com/api/v3/simple/price','Initial\x20currency\x20rates\x20update\x20failed:','gel','77eelXdZ','rub','convertMultipleToUSDT','nok','startPeriodicUpdates','eth','desc','\x20currencies','currencyRate','💱\x20Applied\x20','Failed\x20to\x20update\x20rate\x20for\x20','status','2775600mPaCXr','xrp','chf','warn','1FHkchq','all','getCurrencyRate','Error\x20converting\x20','sgd','aed','zar','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','2064wlApZa','toUpperCase','%\x20markup\x20to\x20','tether','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','thb','COINGECKO_URL','MARKUP_PERCENTAGE','idr','No\x20rate\x20found\x20for\x20currency:\x20','getAllRates','Periodic\x20currency\x20rates\x20update\x20failed:','sats','ils','13779yHiLNh','findFirst','Error\x20getting\x20rates\x20status:','bits','xau','myr','currencyService','__esModule','Error\x20getting\x20rate\x20for\x20currency\x20','toFixed','\x20to\x20USDT:','yfi','default','error','convertToUSDT','jpy','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','4950vIwVFN','xag','\x20USDT\x20(rate:\x20','brl','ngn','asc','statusText','❌\x20Failed\x20to\x20update\x20currency\x20rates:','usdt','CurrencyService','toLowerCase','updatedAt','mxn','getMarkupPercentage','map','findUnique','ltc'];a39_0x4026=function(){return _0x297939;};return a39_0x4026();}(function(_0x290d25,_0x177e90){const _0x1965d7=a39_0x1800,_0x1aae7b=_0x290d25();while(!![]){try{const _0x4c7d41=parseInt(_0x1965d7(0x12e))/0x1*(-parseInt(_0x1965d7(0x18f))/0x2)+-parseInt(_0x1965d7(0x144))/0x3*(-parseInt(_0x1965d7(0x16c))/0x4)+parseInt(_0x1965d7(0x16e))/0x5*(-parseInt(_0x1965d7(0x194))/0x6)+parseInt(_0x1965d7(0x182))/0x7+-parseInt(_0x1965d7(0x136))/0x8*(-parseInt(_0x1965d7(0x155))/0x9)+parseInt(_0x1965d7(0x1a9))/0xa+-parseInt(_0x1965d7(0x19d))/0xb*(parseInt(_0x1965d7(0x177))/0xc);if(_0x4c7d41===_0x177e90)break;else _0x1aae7b['push'](_0x1aae7b['shift']());}catch(_0x1e35cd){_0x1aae7b['push'](_0x1aae7b['shift']());}}}(a39_0x4026,0x261ea));function a39_0x1800(_0x5dc9bd,_0x40be1e){const _0x4026eb=a39_0x4026();return a39_0x1800=function(_0x18007b,_0x32d34d){_0x18007b=_0x18007b-0x12c;let _0x4fcb1c=_0x4026eb[_0x18007b];return _0x4fcb1c;},a39_0x1800(_0x5dc9bd,_0x40be1e);}var __importDefault=this&&this['__importDefault']||function(_0x1b6e43){const _0xe9a52e=a39_0x1800;return _0x1b6e43&&_0x1b6e43[_0xe9a52e(0x14b)]?_0x1b6e43:{'default':_0x1b6e43};};Object['defineProperty'](exports,a39_0x2a6614(0x14b),{'value':!![]}),exports[a39_0x2a6614(0x14a)]=exports[a39_0x2a6614(0x15e)]=void 0x0;const database_1=__importDefault(require(a39_0x2a6614(0x168)));class CurrencyService{constructor(){const _0x368c76=a39_0x2a6614;this[_0x368c76(0x13c)]=_0x368c76(0x19a),this[_0x368c76(0x195)]=['btc',_0x368c76(0x1a2),_0x368c76(0x165),'bch',_0x368c76(0x178),_0x368c76(0x192),_0x368c76(0x1aa),_0x368c76(0x18a),'link',_0x368c76(0x196),_0x368c76(0x14f),_0x368c76(0x17a),_0x368c76(0x133),'ars',_0x368c76(0x171),'bdt',_0x368c76(0x16f),_0x368c76(0x185),_0x368c76(0x158),'cad',_0x368c76(0x12c),'clp','cny',_0x368c76(0x174),'dkk',_0x368c76(0x169),'gbp',_0x368c76(0x19c),_0x368c76(0x179),'huf',_0x368c76(0x13e),_0x368c76(0x143),'inr',_0x368c76(0x153),'krw',_0x368c76(0x183),_0x368c76(0x188),'mmk',_0x368c76(0x161),_0x368c76(0x149),_0x368c76(0x159),_0x368c76(0x1a0),_0x368c76(0x173),_0x368c76(0x193),'pkr','pln',_0x368c76(0x19e),'sar',_0x368c76(0x181),_0x368c76(0x132),_0x368c76(0x13b),_0x368c76(0x197),_0x368c76(0x17c),_0x368c76(0x17f),_0x368c76(0x16a),'vnd',_0x368c76(0x134),_0x368c76(0x190),_0x368c76(0x156),_0x368c76(0x148),_0x368c76(0x147),_0x368c76(0x142)],this[_0x368c76(0x189)]=null,this[_0x368c76(0x13d)]=0x3,this[_0x368c76(0x1a1)]();}[a39_0x2a6614(0x1a1)](){const _0x21226a=a39_0x2a6614;this[_0x21226a(0x16b)]()[_0x21226a(0x176)](_0x12526c=>{const _0x27e45a=_0x21226a;console['error'](_0x27e45a(0x19b),_0x12526c);}),this[_0x21226a(0x189)]=setInterval(async()=>{const _0x10217a=_0x21226a;try{await this[_0x10217a(0x16b)]();}catch(_0x590ed0){console['error'](_0x10217a(0x141),_0x590ed0);}},0x3c*0x3c*0x3e8),console[_0x21226a(0x167)](_0x21226a(0x13a));}[a39_0x2a6614(0x180)](){const _0x525276=a39_0x2a6614;this[_0x525276(0x189)]&&(clearInterval(this[_0x525276(0x189)]),this[_0x525276(0x189)]=null,console['log'](_0x525276(0x186)));}async[a39_0x2a6614(0x16b)](){const _0x2acea2=a39_0x2a6614;try{console['log'](_0x2acea2(0x135));const _0x2e4eea=this[_0x2acea2(0x195)][_0x2acea2(0x18e)](','),_0x3ccf4c=this['COINGECKO_URL']+_0x2acea2(0x16d)+_0x2e4eea,_0x46c067=await fetch(_0x3ccf4c,{'headers':{'Accept':_0x2acea2(0x172),'User-Agent':_0x2acea2(0x170)}});if(!_0x46c067['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x46c067[_0x2acea2(0x1a8)]+'\x20'+_0x46c067[_0x2acea2(0x15b)]);const _0x41ec17=await _0x46c067[_0x2acea2(0x175)]();if(!_0x41ec17[_0x2acea2(0x139)])throw new Error(_0x2acea2(0x154));const _0x1a320c=_0x41ec17[_0x2acea2(0x139)];console[_0x2acea2(0x167)](_0x2acea2(0x18d)+Object['keys'](_0x1a320c)[_0x2acea2(0x166)]+_0x2acea2(0x1a4));const _0x655f38=Object[_0x2acea2(0x198)](_0x1a320c)[_0x2acea2(0x163)](async([_0x530895,_0x501537])=>{const _0x42c634=_0x2acea2;try{await database_1['default'][_0x42c634(0x1a5)]['upsert']({'where':{'currency':_0x530895[_0x42c634(0x15f)]()},'update':{'rate':_0x501537},'create':{'currency':_0x530895[_0x42c634(0x15f)](),'rate':_0x501537}});}catch(_0x1deb8c){console[_0x42c634(0x151)](_0x42c634(0x1a7)+_0x530895+':',_0x1deb8c);}});await Promise['allSettled'](_0x655f38),console[_0x2acea2(0x167)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x2f3740){console[_0x2acea2(0x151)](_0x2acea2(0x15c),_0x2f3740);throw _0x2f3740;}}async[a39_0x2a6614(0x130)](_0x4d9e29){const _0x44f9b8=a39_0x2a6614,_0x367574=_0x4d9e29['toLowerCase']();if(_0x367574===_0x44f9b8(0x15d))return 0x1;try{const _0x44c202=await database_1[_0x44f9b8(0x150)][_0x44f9b8(0x1a5)][_0x44f9b8(0x164)]({'where':{'currency':_0x367574}});if(!_0x44c202)return console[_0x44f9b8(0x12d)](_0x44f9b8(0x13f)+_0x4d9e29+_0x44f9b8(0x17e)),0x1;return _0x44c202[_0x44f9b8(0x17b)];}catch(_0x5785ee){return console['error'](_0x44f9b8(0x14c)+_0x4d9e29+':',_0x5785ee),0x1;}}async[a39_0x2a6614(0x152)](_0x1540bb,_0xb78819){const _0x8e7f62=a39_0x2a6614,_0x97b9db=_0xb78819['toLowerCase']();if(_0x97b9db===_0x8e7f62(0x15d)){const _0xb828b=_0x1540bb*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x8e7f62(0x167)](_0x8e7f62(0x1a6)+this['MARKUP_PERCENTAGE']+_0x8e7f62(0x138)+_0x1540bb+'\x20USDT\x20=\x20'+_0xb828b[_0x8e7f62(0x14d)](0x6)+_0x8e7f62(0x191)),_0xb828b;}try{const _0x219d9b=await this[_0x8e7f62(0x130)](_0x97b9db),_0x5989b8=_0x1540bb/_0x219d9b,_0x371c6f=_0x5989b8*(0x1+this[_0x8e7f62(0x13d)]/0x64);return console[_0x8e7f62(0x167)]('💱\x20Converted\x20'+_0x1540bb+'\x20'+_0xb78819[_0x8e7f62(0x137)]()+_0x8e7f62(0x18b)+_0x5989b8[_0x8e7f62(0x14d)](0x6)+_0x8e7f62(0x17d)+this['MARKUP_PERCENTAGE']+_0x8e7f62(0x18c)+_0x371c6f[_0x8e7f62(0x14d)](0x6)+_0x8e7f62(0x157)+_0x219d9b+')'),_0x371c6f;}catch(_0x6b8496){console[_0x8e7f62(0x151)](_0x8e7f62(0x131)+_0x1540bb+'\x20'+_0xb78819+_0x8e7f62(0x14e),_0x6b8496);const _0x3fa072=_0x1540bb*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3fa072;}}async[a39_0x2a6614(0x19f)](_0x4dd376){const _0x32d382=a39_0x2a6614;let _0x208a08=0x0;for(const {amount:_0x38c2b4,currency:_0x374251}of _0x4dd376){const _0x2440dc=await this[_0x32d382(0x152)](_0x38c2b4,_0x374251);_0x208a08+=_0x2440dc;}return _0x208a08;}async[a39_0x2a6614(0x140)](){const _0x5eeb8d=a39_0x2a6614;try{const _0x72df46=await database_1[_0x5eeb8d(0x150)][_0x5eeb8d(0x1a5)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x223398={'usdt':0x1};return _0x72df46['forEach'](_0x376447=>{const _0x5f0345=_0x5eeb8d;_0x223398[_0x376447[_0x5f0345(0x184)]]=_0x376447['rate'];}),_0x223398;}catch(_0x296c0f){return console['error'](_0x5eeb8d(0x187),_0x296c0f),{'usdt':0x1};}}async[a39_0x2a6614(0x199)](){const _0x1576db=a39_0x2a6614;try{const [_0x55f06c,_0x2445ac,_0x4d87fb]=await Promise[_0x1576db(0x12f)]([database_1[_0x1576db(0x150)][_0x1576db(0x1a5)]['count'](),database_1[_0x1576db(0x150)]['currencyRate'][_0x1576db(0x145)]({'orderBy':{'updatedAt':_0x1576db(0x1a3)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x1576db(0x145)]({'orderBy':{'updatedAt':_0x1576db(0x15a)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x55f06c,'lastUpdated':_0x2445ac?.[_0x1576db(0x160)]||null,'oldestRate':_0x4d87fb?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x4a0219){return console['error'](_0x1576db(0x146),_0x4a0219),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1576db(0x13d)]};}}[a39_0x2a6614(0x162)](){const _0x618ef4=a39_0x2a6614;return this[_0x618ef4(0x13d)];}}exports['CurrencyService']=CurrencyService,exports[a39_0x2a6614(0x14a)]=new CurrencyService();