'use strict';const a38_0x96ab95=a38_0x91e5;(function(_0x2c4fd4,_0x36227a){const _0x529d1d=a38_0x91e5,_0x321be6=_0x2c4fd4();while(!![]){try{const _0x209e99=parseInt(_0x529d1d(0x174))/0x1*(parseInt(_0x529d1d(0x125))/0x2)+-parseInt(_0x529d1d(0x12a))/0x3*(-parseInt(_0x529d1d(0x12f))/0x4)+-parseInt(_0x529d1d(0x142))/0x5*(parseInt(_0x529d1d(0x186))/0x6)+-parseInt(_0x529d1d(0x164))/0x7+-parseInt(_0x529d1d(0x13f))/0x8+parseInt(_0x529d1d(0x16a))/0x9+parseInt(_0x529d1d(0x19a))/0xa;if(_0x209e99===_0x36227a)break;else _0x321be6['push'](_0x321be6['shift']());}catch(_0x127275){_0x321be6['push'](_0x321be6['shift']());}}}(a38_0x544a,0x7393f));function a38_0x91e5(_0x407f62,_0x44f78b){const _0x544a9c=a38_0x544a();return a38_0x91e5=function(_0x91e55d,_0x2c5705){_0x91e55d=_0x91e55d-0x11f;let _0x25217a=_0x544a9c[_0x91e55d];return _0x25217a;},a38_0x91e5(_0x407f62,_0x44f78b);}var __importDefault=this&&this[a38_0x96ab95(0x167)]||function(_0x13743f){const _0x1cf822=a38_0x96ab95;return _0x13743f&&_0x13743f[_0x1cf822(0x128)]?_0x13743f:{'default':_0x13743f};};Object[a38_0x96ab95(0x176)](exports,a38_0x96ab95(0x128),{'value':!![]}),exports[a38_0x96ab95(0x159)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x2c1ed7=a38_0x96ab95;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x2c1ed7(0x172)]=[_0x2c1ed7(0x196),_0x2c1ed7(0x13b),_0x2c1ed7(0x152),_0x2c1ed7(0x121),'bnb','eos','xrp',_0x2c1ed7(0x179),_0x2c1ed7(0x151),_0x2c1ed7(0x146),_0x2c1ed7(0x140),_0x2c1ed7(0x171),_0x2c1ed7(0x126),'ars',_0x2c1ed7(0x144),_0x2c1ed7(0x138),_0x2c1ed7(0x130),_0x2c1ed7(0x14f),_0x2c1ed7(0x188),_0x2c1ed7(0x182),_0x2c1ed7(0x147),_0x2c1ed7(0x192),_0x2c1ed7(0x141),_0x2c1ed7(0x18d),'dkk',_0x2c1ed7(0x131),_0x2c1ed7(0x154),_0x2c1ed7(0x150),_0x2c1ed7(0x14b),'huf',_0x2c1ed7(0x161),'ils',_0x2c1ed7(0x143),_0x2c1ed7(0x16e),_0x2c1ed7(0x14c),_0x2c1ed7(0x120),'lkr',_0x2c1ed7(0x18c),_0x2c1ed7(0x136),_0x2c1ed7(0x160),_0x2c1ed7(0x137),'nok',_0x2c1ed7(0x15f),_0x2c1ed7(0x184),_0x2c1ed7(0x169),_0x2c1ed7(0x17a),_0x2c1ed7(0x12d),_0x2c1ed7(0x17d),_0x2c1ed7(0x14d),'sgd',_0x2c1ed7(0x180),_0x2c1ed7(0x177),_0x2c1ed7(0x18b),'uah','vef',_0x2c1ed7(0x190),_0x2c1ed7(0x17e),'xdr','xag',_0x2c1ed7(0x178),_0x2c1ed7(0x15b),_0x2c1ed7(0x18e)],this[_0x2c1ed7(0x18a)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x2c1ed7(0x168)]();}[a38_0x96ab95(0x168)](){const _0x5548a2=a38_0x96ab95;this['updateCurrencyRates']()[_0x5548a2(0x13a)](_0x54f361=>{const _0x14c364=_0x5548a2;console[_0x14c364(0x135)](_0x14c364(0x133),_0x54f361);}),this[_0x5548a2(0x18a)]=setInterval(async()=>{const _0x8ba8ba=_0x5548a2;try{await this[_0x8ba8ba(0x15e)]();}catch(_0x3a0824){console['error'](_0x8ba8ba(0x17b),_0x3a0824);}},0x3c*0x3c*0x3e8),console['log'](_0x5548a2(0x16b));}[a38_0x96ab95(0x156)](){const _0x516a7a=a38_0x96ab95;this[_0x516a7a(0x18a)]&&(clearInterval(this[_0x516a7a(0x18a)]),this[_0x516a7a(0x18a)]=null,console[_0x516a7a(0x197)](_0x516a7a(0x134)));}async[a38_0x96ab95(0x15e)](){const _0x270e66=a38_0x96ab95;try{console[_0x270e66(0x197)](_0x270e66(0x157));const _0x409038=this['CURRENCIES'][_0x270e66(0x16d)](','),_0x38ef3d=this['COINGECKO_URL']+_0x270e66(0x11f)+_0x409038,_0x498acd=await fetch(_0x38ef3d,{'headers':{'Accept':_0x270e66(0x12b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x498acd['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x498acd['status']+'\x20'+_0x498acd[_0x270e66(0x162)]);const _0x57907e=await _0x498acd[_0x270e66(0x139)]();if(!_0x57907e[_0x270e66(0x13d)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x5ac50a=_0x57907e[_0x270e66(0x13d)];console[_0x270e66(0x197)](_0x270e66(0x155)+Object[_0x270e66(0x18f)](_0x5ac50a)['length']+_0x270e66(0x16f));const _0xcf44d8=Object['entries'](_0x5ac50a)['map'](async([_0x4034a3,_0x1696a4])=>{const _0x1c62f1=_0x270e66;try{await database_1['default']['currencyRate']['upsert']({'where':{'currency':_0x4034a3[_0x1c62f1(0x166)]()},'update':{'rate':_0x1696a4},'create':{'currency':_0x4034a3[_0x1c62f1(0x166)](),'rate':_0x1696a4}});}catch(_0x1846b7){console[_0x1c62f1(0x135)](_0x1c62f1(0x122)+_0x4034a3+':',_0x1846b7);}});await Promise[_0x270e66(0x170)](_0xcf44d8),console[_0x270e66(0x197)](_0x270e66(0x132));}catch(_0x40e5a7){console['error'](_0x270e66(0x165),_0x40e5a7);throw _0x40e5a7;}}async[a38_0x96ab95(0x198)](_0x2a1a3c){const _0x340c55=a38_0x96ab95,_0x2b0112=_0x2a1a3c['toLowerCase']();if(_0x2b0112===_0x340c55(0x15c))return 0x1;try{const _0x102946=await database_1['default'][_0x340c55(0x175)][_0x340c55(0x124)]({'where':{'currency':_0x2b0112}});if(!_0x102946)return console['warn'](_0x340c55(0x127)+_0x2a1a3c+_0x340c55(0x15a)),0x1;return _0x102946[_0x340c55(0x13e)];}catch(_0x15e528){return console[_0x340c55(0x135)](_0x340c55(0x153)+_0x2a1a3c+':',_0x15e528),0x1;}}async[a38_0x96ab95(0x12e)](_0x57043a,_0x38d76a){const _0xd7024c=a38_0x96ab95,_0x2ebec6=_0x38d76a[_0xd7024c(0x166)]();if(_0x2ebec6==='usdt'){const _0x1dce28=_0x57043a*(0x1+this[_0xd7024c(0x149)]/0x64);return console[_0xd7024c(0x197)](_0xd7024c(0x16c)+this[_0xd7024c(0x149)]+'%\x20markup\x20to\x20'+_0x57043a+_0xd7024c(0x193)+_0x1dce28[_0xd7024c(0x15d)](0x6)+'\x20USDT'),_0x1dce28;}try{const _0x56fcd2=await this[_0xd7024c(0x198)](_0x2ebec6),_0x177177=_0x57043a/_0x56fcd2,_0x5592c6=_0x177177*(0x1+this[_0xd7024c(0x149)]/0x64);return console[_0xd7024c(0x197)](_0xd7024c(0x185)+_0x57043a+'\x20'+_0x38d76a[_0xd7024c(0x183)]()+_0xd7024c(0x129)+_0x177177[_0xd7024c(0x15d)](0x6)+_0xd7024c(0x195)+this[_0xd7024c(0x149)]+'%\x20markup\x20=\x20'+_0x5592c6[_0xd7024c(0x15d)](0x6)+_0xd7024c(0x173)+_0x56fcd2+')'),_0x5592c6;}catch(_0x16b6bf){console[_0xd7024c(0x135)](_0xd7024c(0x163)+_0x57043a+'\x20'+_0x38d76a+_0xd7024c(0x148),_0x16b6bf);const _0x29a015=_0x57043a*(0x1+this[_0xd7024c(0x149)]/0x64);return _0x29a015;}}async['convertMultipleToUSDT'](_0x40f28f){let _0x4ff359=0x0;for(const {amount:_0x1b3b8e,currency:_0x1c76fa}of _0x40f28f){const _0x5b8021=await this['convertToUSDT'](_0x1b3b8e,_0x1c76fa);_0x4ff359+=_0x5b8021;}return _0x4ff359;}async[a38_0x96ab95(0x17c)](){const _0x44c8c9=a38_0x96ab95;try{const _0x331c53=await database_1['default']['currencyRate'][_0x44c8c9(0x191)]({'select':{'currency':!![],'rate':!![]}}),_0x5576ef={'usdt':0x1};return _0x331c53[_0x44c8c9(0x187)](_0x143644=>{const _0x48180c=_0x44c8c9;_0x5576ef[_0x143644[_0x48180c(0x13c)]]=_0x143644['rate'];}),_0x5576ef;}catch(_0x16bcaa){return console[_0x44c8c9(0x135)](_0x44c8c9(0x145),_0x16bcaa),{'usdt':0x1};}}async[a38_0x96ab95(0x199)](){const _0x2f146e=a38_0x96ab95;try{const [_0x3253ea,_0x4c1453,_0x3256ac]=await Promise[_0x2f146e(0x12c)]([database_1['default'][_0x2f146e(0x175)][_0x2f146e(0x181)](),database_1[_0x2f146e(0x17f)][_0x2f146e(0x175)][_0x2f146e(0x14e)]({'orderBy':{'updatedAt':_0x2f146e(0x14a)},'select':{'updatedAt':!![]}}),database_1[_0x2f146e(0x17f)][_0x2f146e(0x175)][_0x2f146e(0x14e)]({'orderBy':{'updatedAt':_0x2f146e(0x194)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3253ea,'lastUpdated':_0x4c1453?.[_0x2f146e(0x123)]||null,'oldestRate':_0x3256ac?.[_0x2f146e(0x123)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x5f2653){return console['error']('Error\x20getting\x20rates\x20status:',_0x5f2653),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2f146e(0x149)]};}}[a38_0x96ab95(0x189)](){const _0x225db2=a38_0x96ab95;return this[_0x225db2(0x149)];}}function a38_0x544a(){const _0x3a03ad=['5608570QqNpdR','?ids=tether&vs_currencies=','kwd','bch','Failed\x20to\x20update\x20rate\x20for\x20','updatedAt','findUnique','555314mNMZsz','aed','No\x20rate\x20found\x20for\x20currency:\x20','__esModule','\x20to\x20','489ERpsoU','application/json','all','rub','convertToUSDT','10024JuzbER','bhd','eur','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','Initial\x20currency\x20rates\x20update\x20failed:','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','error','mxn','ngn','bdt','json','catch','eth','currency','tether','rate','3831168apiRrm','yfi','cny','5UOVrka','inr','aud','Error\x20getting\x20all\x20rates:','dot','chf','\x20to\x20USDT:','MARKUP_PERCENTAGE','desc','hkd','krw','sek','findFirst','bmd','gel','link','ltc','Error\x20getting\x20rate\x20for\x20currency\x20','gbp','üìä\x20Received\x20rates\x20for\x20','stopPeriodicUpdates','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','CurrencyService','currencyService',',\x20using\x201\x20as\x20fallback','bits','usdt','toFixed','updateCurrencyRates','nzd','myr','idr','statusText','Error\x20converting\x20','1116654HARRbh','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','toLowerCase','__importDefault','startPeriodicUpdates','pkr','3378132xGYmjt','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','üí±\x20Applied\x20','join','jpy','\x20currencies','allSettled','usd','CURRENCIES','\x20USDT\x20(rate:\x20','1VTSMks','currencyRate','defineProperty','try','xau','xlm','pln','Periodic\x20currency\x20rates\x20update\x20failed:','getAllRates','sar','zar','default','thb','count','cad','toUpperCase','php','üí±\x20Converted\x20','3063090cUjUsS','forEach','brl','getMarkupPercentage','updateInterval','twd','mmk','czk','sats','keys','vnd','findMany','clp','\x20USDT\x20=\x20','asc','\x20USDT,\x20with\x20','btc','log','getCurrencyRate','getRatesStatus'];a38_0x544a=function(){return _0x3a03ad;};return a38_0x544a();}exports[a38_0x96ab95(0x158)]=CurrencyService,exports[a38_0x96ab95(0x159)]=new CurrencyService();