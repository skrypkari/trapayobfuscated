'use strict';function a38_0x3caf(){const _0x1bdca8=['findMany','default','mxn','%\x20markup\x20=\x20','vef','aud','chf','COINGECKO_URL','xag','eos','xau','sek','log','currencyService','count','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','application/json','\x20USDT','3064pJENKA','thb','__esModule','cad','updateCurrencyRates','__importDefault','💱\x20Converted\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','Error\x20converting\x20','warn','huf','gbp','upsert','ltc','aed','?ids=tether&vs_currencies=','1003350pOoGfg','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','vnd','\x20currencies','try','status','1522964LgPVPw','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','error','6RnkdqA','defineProperty','sar','startPeriodicUpdates','usd','📊\x20Received\x20rates\x20for\x20','%\x20markup\x20to\x20','usdt','bhd','updatedAt','xrp','Error\x20getting\x20rates\x20status:','bmd','pkr','map','Initial\x20currency\x20rates\x20update\x20failed:','statusText','convertToUSDT','keys','dot','myr','czk','✅\x20Currency\x20rates\x20updated\x20successfully','kwd','uah','5LJGePB','2492392uUlQKy','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','toUpperCase','12384150ENsMZI','length','nzd','catch','mmk','toLowerCase','bch','CoinGecko\x20API\x20error:\x20','link','\x20USDT,\x20with\x20','eur','sgd','getCurrencyRate','6UyGObY','tether','convertMultipleToUSDT','gel','cny','Failed\x20to\x20update\x20rate\x20for\x20','getMarkupPercentage','ars','Error\x20getting\x20all\x20rates:','1032564apAGNQ','btc','idr','Periodic\x20currency\x20rates\x20update\x20failed:','xlm','twd','brl','jpy','krw','CurrencyService',',\x20using\x201\x20as\x20fallback','updateInterval','toFixed','asc','MARKUP_PERCENTAGE','10539ebyLIS','json','💱\x20Applied\x20','../config/database','nok','ngn','pln','\x20to\x20USDT:','CURRENCIES','inr','findFirst','\x20to\x20','getAllRates','15200185FShGzH','allSettled','rub','currencyRate','Error\x20getting\x20rate\x20for\x20currency\x20'];a38_0x3caf=function(){return _0x1bdca8;};return a38_0x3caf();}const a38_0xa15675=a38_0x1524;(function(_0x3e056e,_0x4500b3){const _0x20c476=a38_0x1524,_0x19ac7c=_0x3e056e();while(!![]){try{const _0x4209f0=parseInt(_0x20c476(0x147))/0x1+parseInt(_0x20c476(0x18a))/0x2*(parseInt(_0x20c476(0x193))/0x3)+parseInt(_0x20c476(0x190))/0x4*(-parseInt(_0x20c476(0x1ac))/0x5)+-parseInt(_0x20c476(0x13e))/0x6*(parseInt(_0x20c476(0x1ad))/0x7)+parseInt(_0x20c476(0x17a))/0x8*(-parseInt(_0x20c476(0x156))/0x9)+parseInt(_0x20c476(0x1b1))/0xa+-parseInt(_0x20c476(0x163))/0xb;if(_0x4209f0===_0x4500b3)break;else _0x19ac7c['push'](_0x19ac7c['shift']());}catch(_0x3522f7){_0x19ac7c['push'](_0x19ac7c['shift']());}}}(a38_0x3caf,0xaca84));var __importDefault=this&&this[a38_0xa15675(0x17f)]||function(_0x5c9970){const _0xe866a0=a38_0xa15675;return _0x5c9970&&_0x5c9970[_0xe866a0(0x17c)]?_0x5c9970:{'default':_0x5c9970};};Object[a38_0xa15675(0x194)](exports,a38_0xa15675(0x17c),{'value':!![]}),exports[a38_0xa15675(0x175)]=exports[a38_0xa15675(0x150)]=void 0x0;function a38_0x1524(_0x2765bc,_0x46f597){const _0x3cafcc=a38_0x3caf();return a38_0x1524=function(_0x1524e1,_0x94dc91){_0x1524e1=_0x1524e1-0x13b;let _0x3a9832=_0x3cafcc[_0x1524e1];return _0x3a9832;},a38_0x1524(_0x2765bc,_0x46f597);}const database_1=__importDefault(require(a38_0xa15675(0x159)));class CurrencyService{constructor(){const _0x1a5868=a38_0xa15675;this[_0x1a5868(0x16f)]='https://api.coingecko.com/api/v3/simple/price',this[_0x1a5868(0x15e)]=[_0x1a5868(0x148),'eth',_0x1a5868(0x187),_0x1a5868(0x1b7),'bnb',_0x1a5868(0x171),_0x1a5868(0x19d),_0x1a5868(0x14b),_0x1a5868(0x1b9),_0x1a5868(0x1a6),'yfi',_0x1a5868(0x197),_0x1a5868(0x188),_0x1a5868(0x145),_0x1a5868(0x16d),'bdt',_0x1a5868(0x19b),_0x1a5868(0x19f),_0x1a5868(0x14d),_0x1a5868(0x17d),_0x1a5868(0x16e),'clp',_0x1a5868(0x142),_0x1a5868(0x1a8),'dkk',_0x1a5868(0x13b),_0x1a5868(0x185),_0x1a5868(0x141),'hkd',_0x1a5868(0x184),_0x1a5868(0x149),'ils',_0x1a5868(0x15f),_0x1a5868(0x14e),_0x1a5868(0x14f),_0x1a5868(0x1aa),'lkr',_0x1a5868(0x1b5),_0x1a5868(0x16a),_0x1a5868(0x1a7),_0x1a5868(0x15b),_0x1a5868(0x15a),_0x1a5868(0x1b3),'php',_0x1a5868(0x1a0),_0x1a5868(0x15c),_0x1a5868(0x165),_0x1a5868(0x195),_0x1a5868(0x173),_0x1a5868(0x13c),_0x1a5868(0x17b),_0x1a5868(0x18e),_0x1a5868(0x14c),_0x1a5868(0x1ab),_0x1a5868(0x16c),_0x1a5868(0x18c),'zar','xdr',_0x1a5868(0x170),_0x1a5868(0x172),'bits','sats'],this[_0x1a5868(0x152)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x1a5868(0x196)]();}[a38_0xa15675(0x196)](){const _0x1ac3e2=a38_0xa15675;this[_0x1ac3e2(0x17e)]()[_0x1ac3e2(0x1b4)](_0x20f00e=>{const _0x339f2b=_0x1ac3e2;console[_0x339f2b(0x192)](_0x339f2b(0x1a2),_0x20f00e);}),this[_0x1ac3e2(0x152)]=setInterval(async()=>{const _0x260c93=_0x1ac3e2;try{await this[_0x260c93(0x17e)]();}catch(_0x3a1882){console[_0x260c93(0x192)](_0x260c93(0x14a),_0x3a1882);}},0x3c*0x3c*0x3e8),console[_0x1ac3e2(0x174)](_0x1ac3e2(0x177));}['stopPeriodicUpdates'](){const _0x1405e3=a38_0xa15675;this[_0x1405e3(0x152)]&&(clearInterval(this['updateInterval']),this[_0x1405e3(0x152)]=null,console['log'](_0x1405e3(0x18b)));}async[a38_0xa15675(0x17e)](){const _0x110adb=a38_0xa15675;try{console['log'](_0x110adb(0x191));const _0x16048f=this[_0x110adb(0x15e)]['join'](','),_0x1f328d=this[_0x110adb(0x16f)]+_0x110adb(0x189)+_0x16048f,_0x2d0940=await fetch(_0x1f328d,{'headers':{'Accept':_0x110adb(0x178),'User-Agent':_0x110adb(0x1ae)}});if(!_0x2d0940['ok'])throw new Error(_0x110adb(0x1b8)+_0x2d0940[_0x110adb(0x18f)]+'\x20'+_0x2d0940[_0x110adb(0x1a3)]);const _0x43e826=await _0x2d0940[_0x110adb(0x157)]();if(!_0x43e826[_0x110adb(0x13f)])throw new Error(_0x110adb(0x1af));const _0x1b4657=_0x43e826[_0x110adb(0x13f)];console[_0x110adb(0x174)](_0x110adb(0x198)+Object[_0x110adb(0x1a5)](_0x1b4657)[_0x110adb(0x1b2)]+_0x110adb(0x18d));const _0x328cc9=Object['entries'](_0x1b4657)[_0x110adb(0x1a1)](async([_0x55f740,_0x1b52ab])=>{const _0x266b64=_0x110adb;try{await database_1[_0x266b64(0x169)][_0x266b64(0x166)][_0x266b64(0x186)]({'where':{'currency':_0x55f740[_0x266b64(0x1b6)]()},'update':{'rate':_0x1b52ab},'create':{'currency':_0x55f740[_0x266b64(0x1b6)](),'rate':_0x1b52ab}});}catch(_0x23b112){console[_0x266b64(0x192)](_0x266b64(0x143)+_0x55f740+':',_0x23b112);}});await Promise[_0x110adb(0x164)](_0x328cc9),console[_0x110adb(0x174)](_0x110adb(0x1a9));}catch(_0x4db06a){console[_0x110adb(0x192)](_0x110adb(0x181),_0x4db06a);throw _0x4db06a;}}async[a38_0xa15675(0x13d)](_0x285c85){const _0x23aa25=a38_0xa15675,_0x4b83b4=_0x285c85['toLowerCase']();if(_0x4b83b4===_0x23aa25(0x19a))return 0x1;try{const _0x7b42f4=await database_1['default'][_0x23aa25(0x166)]['findUnique']({'where':{'currency':_0x4b83b4}});if(!_0x7b42f4)return console[_0x23aa25(0x183)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x285c85+_0x23aa25(0x151)),0x1;return _0x7b42f4['rate'];}catch(_0x7acbf3){return console[_0x23aa25(0x192)](_0x23aa25(0x167)+_0x285c85+':',_0x7acbf3),0x1;}}async[a38_0xa15675(0x1a4)](_0x32c318,_0x97746f){const _0x2239d6=a38_0xa15675,_0x9c6fb1=_0x97746f[_0x2239d6(0x1b6)]();if(_0x9c6fb1==='usdt'){const _0x27f1a0=_0x32c318*(0x1+this[_0x2239d6(0x155)]/0x64);return console[_0x2239d6(0x174)](_0x2239d6(0x158)+this[_0x2239d6(0x155)]+_0x2239d6(0x199)+_0x32c318+'\x20USDT\x20=\x20'+_0x27f1a0[_0x2239d6(0x153)](0x6)+_0x2239d6(0x179)),_0x27f1a0;}try{const _0x3024ea=await this[_0x2239d6(0x13d)](_0x9c6fb1),_0x3a27c8=_0x32c318/_0x3024ea,_0x5b7c73=_0x3a27c8*(0x1+this[_0x2239d6(0x155)]/0x64);return console[_0x2239d6(0x174)](_0x2239d6(0x180)+_0x32c318+'\x20'+_0x97746f[_0x2239d6(0x1b0)]()+_0x2239d6(0x161)+_0x3a27c8[_0x2239d6(0x153)](0x6)+_0x2239d6(0x1ba)+this[_0x2239d6(0x155)]+_0x2239d6(0x16b)+_0x5b7c73[_0x2239d6(0x153)](0x6)+'\x20USDT\x20(rate:\x20'+_0x3024ea+')'),_0x5b7c73;}catch(_0x1f761c){console[_0x2239d6(0x192)](_0x2239d6(0x182)+_0x32c318+'\x20'+_0x97746f+_0x2239d6(0x15d),_0x1f761c);const _0xe85d60=_0x32c318*(0x1+this[_0x2239d6(0x155)]/0x64);return _0xe85d60;}}async[a38_0xa15675(0x140)](_0x3c3eb2){const _0x4b29eb=a38_0xa15675;let _0x344f35=0x0;for(const {amount:_0x3afe25,currency:_0x330697}of _0x3c3eb2){const _0x31ec98=await this[_0x4b29eb(0x1a4)](_0x3afe25,_0x330697);_0x344f35+=_0x31ec98;}return _0x344f35;}async[a38_0xa15675(0x162)](){const _0x3cd1c2=a38_0xa15675;try{const _0x68351d=await database_1['default'][_0x3cd1c2(0x166)][_0x3cd1c2(0x168)]({'select':{'currency':!![],'rate':!![]}}),_0xf17c39={'usdt':0x1};return _0x68351d['forEach'](_0x2ef0ee=>{_0xf17c39[_0x2ef0ee['currency']]=_0x2ef0ee['rate'];}),_0xf17c39;}catch(_0x4492aa){return console[_0x3cd1c2(0x192)](_0x3cd1c2(0x146),_0x4492aa),{'usdt':0x1};}}async['getRatesStatus'](){const _0x19c02a=a38_0xa15675;try{const [_0x5d3190,_0x54d529,_0x4d205a]=await Promise['all']([database_1['default']['currencyRate'][_0x19c02a(0x176)](),database_1[_0x19c02a(0x169)][_0x19c02a(0x166)][_0x19c02a(0x160)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x19c02a(0x166)]['findFirst']({'orderBy':{'updatedAt':_0x19c02a(0x154)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5d3190,'lastUpdated':_0x54d529?.[_0x19c02a(0x19c)]||null,'oldestRate':_0x4d205a?.[_0x19c02a(0x19c)]||null,'markupPercentage':this[_0x19c02a(0x155)]};}catch(_0x7d3745){return console[_0x19c02a(0x192)](_0x19c02a(0x19e),_0x7d3745),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0xa15675(0x144)](){const _0x5acc27=a38_0xa15675;return this[_0x5acc27(0x155)];}}exports['CurrencyService']=CurrencyService,exports[a38_0xa15675(0x175)]=new CurrencyService();