'use strict';const a49_0x59da93=a49_0x58e7;(function(_0x3a4606,_0x5667c0){const _0x5f23aa=a49_0x58e7,_0x43ae7e=_0x3a4606();while(!![]){try{const _0x446ec0=parseInt(_0x5f23aa(0x152))/0x1+parseInt(_0x5f23aa(0x171))/0x2+-parseInt(_0x5f23aa(0x14d))/0x3*(-parseInt(_0x5f23aa(0x181))/0x4)+-parseInt(_0x5f23aa(0x1bc))/0x5+parseInt(_0x5f23aa(0x1b7))/0x6*(parseInt(_0x5f23aa(0x188))/0x7)+-parseInt(_0x5f23aa(0x178))/0x8+-parseInt(_0x5f23aa(0x170))/0x9*(parseInt(_0x5f23aa(0x158))/0xa);if(_0x446ec0===_0x5667c0)break;else _0x43ae7e['push'](_0x43ae7e['shift']());}catch(_0x3568ca){_0x43ae7e['push'](_0x43ae7e['shift']());}}}(a49_0x3306,0xc3227));function a49_0x3306(){const _0x3158c0=['getRatesStatus','âœ…\x20Currency\x20rates\x20updated\x20successfully','?ids=tether&vs_currencies=','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20currencies','forEach','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','convertMultipleToUSDT','sek','yfi','ðŸ’±\x20Converted\x20','jpy','nzd','%\x20markup\x20=\x20','bdt','1170726RmbJAO','mxn','bch','length','upsert','3890610TBcdGV','try','CURRENCIES','Error\x20getting\x20rates\x20status:','startPeriodicUpdates','uah','twd','xag','btc','217023pNkYGv','eur','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','eth','\x20USDT','1406365nlQWlA','rub','getCurrencyRate','entries','json','link','18260780ZuwgCv','catch','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','findFirst','No\x20rate\x20found\x20for\x20currency:\x20','eos','Payment\x20System/1.0','stopPeriodicUpdates','vef','Error\x20getting\x20rate\x20for\x20currency\x20','CoinGecko\x20API\x20error:\x20','Failed\x20to\x20update\x20rate\x20for\x20','chf','vnd','usd','idr','toUpperCase','sar','MARKUP_PERCENTAGE',',\x20using\x201\x20as\x20fallback','all','log','xlm','updateCurrencyRates','9kxiBTp','1754970mysylx','aud','Error\x20converting\x20','bmd','xdr','pln','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','7757088IjVUJz','allSettled','pkr','\x20USDT\x20=\x20','findUnique','warn','bnb','krw','zar','40OLxXlV','lkr','updateInterval','count','\x20USDT\x20(rate:\x20','currencyService','Error\x20getting\x20all\x20rates:','49vHqmgU','ltc','sats','usdt','thb','ðŸ’±\x20Applied\x20','toFixed','currency','rate','currencyRate','hkd','default','tether','nok','updatedAt','__esModule','cny','clp','error','convertToUSDT','application/json','xrp','ngn','__importDefault','ars','%\x20markup\x20to\x20','CurrencyService','keys','bits','huf','status','ils'];a49_0x3306=function(){return _0x3158c0;};return a49_0x3306();}var __importDefault=this&&this[a49_0x59da93(0x19f)]||function(_0x9be599){const _0x43f2e0=a49_0x59da93;return _0x9be599&&_0x9be599[_0x43f2e0(0x197)]?_0x9be599:{'default':_0x9be599};};Object['defineProperty'](exports,a49_0x59da93(0x197),{'value':!![]}),exports['currencyService']=exports[a49_0x59da93(0x1a2)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x1e1003=a49_0x59da93;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x1e1003(0x1be)]=[_0x1e1003(0x14c),_0x1e1003(0x150),_0x1e1003(0x189),_0x1e1003(0x1b9),_0x1e1003(0x17e),_0x1e1003(0x15d),_0x1e1003(0x19d),_0x1e1003(0x16e),_0x1e1003(0x157),'dot',_0x1e1003(0x1b1),_0x1e1003(0x166),'aed',_0x1e1003(0x1a0),_0x1e1003(0x172),_0x1e1003(0x1b6),'bhd',_0x1e1003(0x174),'brl','cad',_0x1e1003(0x164),_0x1e1003(0x199),_0x1e1003(0x198),'czk','dkk',_0x1e1003(0x14e),'gbp','gel',_0x1e1003(0x192),_0x1e1003(0x1a5),_0x1e1003(0x167),_0x1e1003(0x1a7),'inr',_0x1e1003(0x1b3),_0x1e1003(0x17f),'kwd',_0x1e1003(0x182),'mmk',_0x1e1003(0x1b8),'myr',_0x1e1003(0x19e),_0x1e1003(0x195),_0x1e1003(0x1b4),'php',_0x1e1003(0x17a),_0x1e1003(0x176),_0x1e1003(0x153),_0x1e1003(0x169),_0x1e1003(0x1b0),'sgd',_0x1e1003(0x18c),_0x1e1003(0x1bd),_0x1e1003(0x14a),_0x1e1003(0x149),_0x1e1003(0x160),_0x1e1003(0x165),_0x1e1003(0x180),_0x1e1003(0x175),_0x1e1003(0x14b),'xau',_0x1e1003(0x1a4),_0x1e1003(0x18a)],this[_0x1e1003(0x183)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x1e1003(0x1c0)]();}[a49_0x59da93(0x1c0)](){const _0xd3d6af=a49_0x59da93;this[_0xd3d6af(0x16f)]()[_0xd3d6af(0x159)](_0x2f962c=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x2f962c);}),this['updateInterval']=setInterval(async()=>{const _0xaa797f=_0xd3d6af;try{await this[_0xaa797f(0x16f)]();}catch(_0x20a3b8){console[_0xaa797f(0x19a)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x20a3b8);}},0x3c*0x3c*0x3e8),console[_0xd3d6af(0x16d)](_0xd3d6af(0x14f));}[a49_0x59da93(0x15f)](){const _0x3d213f=a49_0x59da93;this[_0x3d213f(0x183)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console['log'](_0x3d213f(0x177)));}async[a49_0x59da93(0x16f)](){const _0x346a81=a49_0x59da93;try{console[_0x346a81(0x16d)](_0x346a81(0x15a));const _0x45d3e2=this['CURRENCIES']['join'](','),_0xf8f6c8=this['COINGECKO_URL']+_0x346a81(0x1aa)+_0x45d3e2,_0x2a4f30=await fetch(_0xf8f6c8,{'headers':{'Accept':_0x346a81(0x19c),'User-Agent':_0x346a81(0x15e)}});if(!_0x2a4f30['ok'])throw new Error(_0x346a81(0x162)+_0x2a4f30[_0x346a81(0x1a6)]+'\x20'+_0x2a4f30['statusText']);const _0x392fd9=await _0x2a4f30[_0x346a81(0x156)]();if(!_0x392fd9[_0x346a81(0x194)])throw new Error(_0x346a81(0x1ab));const _0x426945=_0x392fd9[_0x346a81(0x194)];console[_0x346a81(0x16d)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0x346a81(0x1a3)](_0x426945)[_0x346a81(0x1ba)]+_0x346a81(0x1ac));const _0x2c310f=Object[_0x346a81(0x155)](_0x426945)['map'](async([_0x18d7fb,_0x14933c])=>{const _0x2f09db=_0x346a81;try{await database_1[_0x2f09db(0x193)][_0x2f09db(0x191)][_0x2f09db(0x1bb)]({'where':{'currency':_0x18d7fb['toLowerCase']()},'update':{'rate':_0x14933c},'create':{'currency':_0x18d7fb['toLowerCase'](),'rate':_0x14933c}});}catch(_0x1d1c36){console[_0x2f09db(0x19a)](_0x2f09db(0x163)+_0x18d7fb+':',_0x1d1c36);}});await Promise[_0x346a81(0x179)](_0x2c310f),console['log'](_0x346a81(0x1a9));}catch(_0x23ca67){console[_0x346a81(0x19a)](_0x346a81(0x1ae),_0x23ca67);throw _0x23ca67;}}async[a49_0x59da93(0x154)](_0x219b6a){const _0x37b00a=a49_0x59da93,_0x544222=_0x219b6a['toLowerCase']();if(_0x544222==='usdt')return 0x1;try{const _0x454cb9=await database_1[_0x37b00a(0x193)][_0x37b00a(0x191)][_0x37b00a(0x17c)]({'where':{'currency':_0x544222}});if(!_0x454cb9)return console[_0x37b00a(0x17d)](_0x37b00a(0x15c)+_0x219b6a+_0x37b00a(0x16b)),0x1;return _0x454cb9[_0x37b00a(0x190)];}catch(_0x5570c9){return console['error'](_0x37b00a(0x161)+_0x219b6a+':',_0x5570c9),0x1;}}async['convertToUSDT'](_0x1d3afc,_0x532542){const _0x11a291=a49_0x59da93,_0x2a1e4f=_0x532542['toLowerCase']();if(_0x2a1e4f===_0x11a291(0x18b)){const _0x4f50f4=_0x1d3afc*(0x1+this[_0x11a291(0x16a)]/0x64);return console[_0x11a291(0x16d)](_0x11a291(0x18d)+this[_0x11a291(0x16a)]+_0x11a291(0x1a1)+_0x1d3afc+_0x11a291(0x17b)+_0x4f50f4[_0x11a291(0x18e)](0x6)+_0x11a291(0x151)),_0x4f50f4;}try{const _0x262932=await this['getCurrencyRate'](_0x2a1e4f),_0x15b88b=_0x1d3afc/_0x262932,_0x1bc84d=_0x15b88b*(0x1+this[_0x11a291(0x16a)]/0x64);return console[_0x11a291(0x16d)](_0x11a291(0x1b2)+_0x1d3afc+'\x20'+_0x532542[_0x11a291(0x168)]()+'\x20to\x20'+_0x15b88b[_0x11a291(0x18e)](0x6)+'\x20USDT,\x20with\x20'+this[_0x11a291(0x16a)]+_0x11a291(0x1b5)+_0x1bc84d[_0x11a291(0x18e)](0x6)+_0x11a291(0x185)+_0x262932+')'),_0x1bc84d;}catch(_0x2efb9c){console[_0x11a291(0x19a)](_0x11a291(0x173)+_0x1d3afc+'\x20'+_0x532542+'\x20to\x20USDT:',_0x2efb9c);const _0xf76945=_0x1d3afc*(0x1+this[_0x11a291(0x16a)]/0x64);return _0xf76945;}}async[a49_0x59da93(0x1af)](_0x5ec57e){const _0x4b6b06=a49_0x59da93;let _0xd83510=0x0;for(const {amount:_0x3cc642,currency:_0x157ad0}of _0x5ec57e){const _0x46db5f=await this[_0x4b6b06(0x19b)](_0x3cc642,_0x157ad0);_0xd83510+=_0x46db5f;}return _0xd83510;}async['getAllRates'](){const _0x486f72=a49_0x59da93;try{const _0x5ed77c=await database_1[_0x486f72(0x193)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x55e379={'usdt':0x1};return _0x5ed77c[_0x486f72(0x1ad)](_0x24571b=>{const _0x54af7d=_0x486f72;_0x55e379[_0x24571b[_0x54af7d(0x18f)]]=_0x24571b[_0x54af7d(0x190)];}),_0x55e379;}catch(_0x2af034){return console[_0x486f72(0x19a)](_0x486f72(0x187),_0x2af034),{'usdt':0x1};}}async[a49_0x59da93(0x1a8)](){const _0x1edb7e=a49_0x59da93;try{const [_0x378ea7,_0x25dcc8,_0x1875d1]=await Promise[_0x1edb7e(0x16c)]([database_1['default'][_0x1edb7e(0x191)][_0x1edb7e(0x184)](),database_1['default']['currencyRate'][_0x1edb7e(0x15b)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x1edb7e(0x193)][_0x1edb7e(0x191)][_0x1edb7e(0x15b)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x378ea7,'lastUpdated':_0x25dcc8?.[_0x1edb7e(0x196)]||null,'oldestRate':_0x1875d1?.[_0x1edb7e(0x196)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x23f514){return console[_0x1edb7e(0x19a)](_0x1edb7e(0x1bf),_0x23f514),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1edb7e(0x16a)]};}}['getMarkupPercentage'](){const _0x76a29=a49_0x59da93;return this[_0x76a29(0x16a)];}}function a49_0x58e7(_0x59c9eb,_0x2e3d44){_0x59c9eb=_0x59c9eb-0x149;const _0x33061b=a49_0x3306();let _0x58e708=_0x33061b[_0x59c9eb];return _0x58e708;}exports['CurrencyService']=CurrencyService,exports[a49_0x59da93(0x186)]=new CurrencyService();