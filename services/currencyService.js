'use strict';const a38_0x28e16a=a38_0x4031;(function(_0x3933f7,_0x49be90){const _0x10ca16=a38_0x4031,_0x31284f=_0x3933f7();while(!![]){try{const _0x3461b4=parseInt(_0x10ca16(0x1c7))/0x1+-parseInt(_0x10ca16(0x191))/0x2*(-parseInt(_0x10ca16(0x1cd))/0x3)+-parseInt(_0x10ca16(0x1b3))/0x4*(-parseInt(_0x10ca16(0x192))/0x5)+-parseInt(_0x10ca16(0x1b4))/0x6+parseInt(_0x10ca16(0x205))/0x7*(-parseInt(_0x10ca16(0x1f2))/0x8)+parseInt(_0x10ca16(0x1c9))/0x9*(-parseInt(_0x10ca16(0x1d2))/0xa)+-parseInt(_0x10ca16(0x1a3))/0xb;if(_0x3461b4===_0x49be90)break;else _0x31284f['push'](_0x31284f['shift']());}catch(_0x3346ef){_0x31284f['push'](_0x31284f['shift']());}}}(a38_0x1d9c,0xda0f0));function a38_0x1d9c(){const _0x5f01e4=['keys','updateInterval','toUpperCase','Error\x20converting\x20','tether','usdt','entries','Periodic\x20currency\x20rates\x20update\x20failed:','bhd','Failed\x20to\x20update\x20rate\x20for\x20','ars','4YByyRZ','4030248BWzjBi','defineProperty','error','CurrencyService','startPeriodicUpdates','dkk','mmk','xrp','Error\x20getting\x20rates\x20status:','map','forEach','clp','dot','upsert','stopPeriodicUpdates','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','desc','__importDefault','usd','480829imUCVe','updateCurrencyRates','20763LvtAbt','krw','%\x20markup\x20to\x20','rate','6ELUZrB','yfi','nzd','inr','hkd','1060qqColf','sats','try','bits','asc','currencyService','\x20USDT\x20(rate:\x20','vnd','currencyRate','mxn','huf','TesSoft\x20Payment\x20System/1.0','thb','\x20USDT\x20=\x20','currency','default','length','kwd',',\x20using\x201\x20as\x20fallback','sar','getCurrencyRate','Error\x20getting\x20rate\x20for\x20currency\x20','\x20USDT,\x20with\x20','CURRENCIES','aed','No\x20rate\x20found\x20for\x20currency:\x20','catch','gbp','application/json','lkr','warn','cad','178072ysZVET','idr','zar','toLowerCase','sgd','Error\x20getting\x20all\x20rates:','json','%\x20markup\x20=\x20','MARKUP_PERCENTAGE','xag','pkr','php','findMany','sek','czk','convertToUSDT','Initial\x20currency\x20rates\x20update\x20failed:','updatedAt','\x20to\x20','7xPSUVq','../config/database','__esModule','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','twd','getAllRates','791524xoPHIS','7910165YnIrxG','toFixed','count','COINGECKO_URL','\x20to\x20USDT:','\x20currencies','all','link','eos','bmd','vef','log','📊\x20Received\x20rates\x20for\x20','✅\x20Currency\x20rates\x20updated\x20successfully','bnb','💱\x20Applied\x20','uah','11249799dnWAqP','brl','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','eth','❌\x20Failed\x20to\x20update\x20currency\x20rates:'];a38_0x1d9c=function(){return _0x5f01e4;};return a38_0x1d9c();}function a38_0x4031(_0x3c1a98,_0x482e7c){const _0x1d9cb2=a38_0x1d9c();return a38_0x4031=function(_0x403116,_0x8d06c6){_0x403116=_0x403116-0x18d;let _0x4937c2=_0x1d9cb2[_0x403116];return _0x4937c2;},a38_0x4031(_0x3c1a98,_0x482e7c);}var __importDefault=this&&this[a38_0x28e16a(0x1c5)]||function(_0x5988d5){const _0x4b791a=a38_0x28e16a;return _0x5988d5&&_0x5988d5[_0x4b791a(0x18d)]?_0x5988d5:{'default':_0x5988d5};};Object[a38_0x28e16a(0x1b5)](exports,a38_0x28e16a(0x18d),{'value':!![]}),exports['currencyService']=exports[a38_0x28e16a(0x1b7)]=void 0x0;const database_1=__importDefault(require(a38_0x28e16a(0x206)));class CurrencyService{constructor(){const _0x3cfaa3=a38_0x28e16a;this[_0x3cfaa3(0x195)]='https://api.coingecko.com/api/v3/simple/price',this[_0x3cfaa3(0x1e9)]=['btc',_0x3cfaa3(0x1a6),'ltc','bch',_0x3cfaa3(0x1a0),_0x3cfaa3(0x19a),_0x3cfaa3(0x1bb),'xlm',_0x3cfaa3(0x199),_0x3cfaa3(0x1c0),_0x3cfaa3(0x1ce),_0x3cfaa3(0x1c6),_0x3cfaa3(0x1ea),_0x3cfaa3(0x1b2),'aud','bdt',_0x3cfaa3(0x1b0),_0x3cfaa3(0x19b),_0x3cfaa3(0x1a4),_0x3cfaa3(0x1f1),'chf',_0x3cfaa3(0x1bf),'cny',_0x3cfaa3(0x200),_0x3cfaa3(0x1b9),'eur',_0x3cfaa3(0x1ed),'gel',_0x3cfaa3(0x1d1),_0x3cfaa3(0x1dc),_0x3cfaa3(0x1f3),'ils',_0x3cfaa3(0x1d0),'jpy',_0x3cfaa3(0x1ca),_0x3cfaa3(0x1e3),_0x3cfaa3(0x1ef),_0x3cfaa3(0x1ba),_0x3cfaa3(0x1db),'myr','ngn','nok',_0x3cfaa3(0x1cf),_0x3cfaa3(0x1fd),_0x3cfaa3(0x1fc),'pln','rub',_0x3cfaa3(0x1e5),_0x3cfaa3(0x1ff),_0x3cfaa3(0x1f6),_0x3cfaa3(0x1de),_0x3cfaa3(0x1d4),_0x3cfaa3(0x18f),_0x3cfaa3(0x1a2),_0x3cfaa3(0x19c),_0x3cfaa3(0x1d9),_0x3cfaa3(0x1f4),'xdr',_0x3cfaa3(0x1fb),'xau',_0x3cfaa3(0x1d5),_0x3cfaa3(0x1d3)],this['updateInterval']=null,this[_0x3cfaa3(0x1fa)]=0x3,this[_0x3cfaa3(0x1b8)]();}['startPeriodicUpdates'](){const _0x16e1b3=a38_0x28e16a;this[_0x16e1b3(0x1c8)]()[_0x16e1b3(0x1ec)](_0x22bdd4=>{const _0x150dd8=_0x16e1b3;console[_0x150dd8(0x1b6)](_0x150dd8(0x202),_0x22bdd4);}),this[_0x16e1b3(0x1a9)]=setInterval(async()=>{const _0x361453=_0x16e1b3;try{await this[_0x361453(0x1c8)]();}catch(_0x228ff4){console[_0x361453(0x1b6)](_0x361453(0x1af),_0x228ff4);}},0x3c*0x3c*0x3e8),console[_0x16e1b3(0x19d)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x28e16a(0x1c2)](){const _0x401021=a38_0x28e16a;this['updateInterval']&&(clearInterval(this[_0x401021(0x1a9)]),this['updateInterval']=null,console[_0x401021(0x19d)](_0x401021(0x1c3)));}async[a38_0x28e16a(0x1c8)](){const _0x15e547=a38_0x28e16a;try{console[_0x15e547(0x19d)](_0x15e547(0x1a5));const _0x3957b2=this[_0x15e547(0x1e9)]['join'](','),_0x46088b=this[_0x15e547(0x195)]+'?ids=tether&vs_currencies='+_0x3957b2,_0x2d0bfd=await fetch(_0x46088b,{'headers':{'Accept':_0x15e547(0x1ee),'User-Agent':_0x15e547(0x1dd)}});if(!_0x2d0bfd['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x2d0bfd['status']+'\x20'+_0x2d0bfd['statusText']);const _0x4fe794=await _0x2d0bfd[_0x15e547(0x1f8)]();if(!_0x4fe794[_0x15e547(0x1ac)])throw new Error(_0x15e547(0x18e));const _0x2783f9=_0x4fe794['tether'];console[_0x15e547(0x19d)](_0x15e547(0x19e)+Object[_0x15e547(0x1a8)](_0x2783f9)[_0x15e547(0x1e2)]+_0x15e547(0x197));const _0x28df9d=Object[_0x15e547(0x1ae)](_0x2783f9)[_0x15e547(0x1bd)](async([_0x2061e4,_0x2fc32f])=>{const _0x508963=_0x15e547;try{await database_1[_0x508963(0x1e1)][_0x508963(0x1da)][_0x508963(0x1c1)]({'where':{'currency':_0x2061e4[_0x508963(0x1f5)]()},'update':{'rate':_0x2fc32f},'create':{'currency':_0x2061e4[_0x508963(0x1f5)](),'rate':_0x2fc32f}});}catch(_0x3c7a60){console['error'](_0x508963(0x1b1)+_0x2061e4+':',_0x3c7a60);}});await Promise['allSettled'](_0x28df9d),console[_0x15e547(0x19d)](_0x15e547(0x19f));}catch(_0x41cf63){console[_0x15e547(0x1b6)](_0x15e547(0x1a7),_0x41cf63);throw _0x41cf63;}}async[a38_0x28e16a(0x1e6)](_0x2aaf13){const _0x59798e=a38_0x28e16a,_0x4247ee=_0x2aaf13[_0x59798e(0x1f5)]();if(_0x4247ee===_0x59798e(0x1ad))return 0x1;try{const _0x335151=await database_1[_0x59798e(0x1e1)][_0x59798e(0x1da)]['findUnique']({'where':{'currency':_0x4247ee}});if(!_0x335151)return console[_0x59798e(0x1f0)](_0x59798e(0x1eb)+_0x2aaf13+_0x59798e(0x1e4)),0x1;return _0x335151[_0x59798e(0x1cc)];}catch(_0x3be915){return console['error'](_0x59798e(0x1e7)+_0x2aaf13+':',_0x3be915),0x1;}}async[a38_0x28e16a(0x201)](_0x595ee1,_0x155868){const _0x128d85=a38_0x28e16a,_0x2f360b=_0x155868['toLowerCase']();if(_0x2f360b===_0x128d85(0x1ad)){const _0x153845=_0x595ee1*(0x1+this[_0x128d85(0x1fa)]/0x64);return console[_0x128d85(0x19d)](_0x128d85(0x1a1)+this['MARKUP_PERCENTAGE']+_0x128d85(0x1cb)+_0x595ee1+_0x128d85(0x1df)+_0x153845[_0x128d85(0x193)](0x6)+'\x20USDT'),_0x153845;}try{const _0xd7f138=await this['getCurrencyRate'](_0x2f360b),_0x25c8f3=_0x595ee1/_0xd7f138,_0xa4e251=_0x25c8f3*(0x1+this[_0x128d85(0x1fa)]/0x64);return console[_0x128d85(0x19d)]('💱\x20Converted\x20'+_0x595ee1+'\x20'+_0x155868[_0x128d85(0x1aa)]()+_0x128d85(0x204)+_0x25c8f3[_0x128d85(0x193)](0x6)+_0x128d85(0x1e8)+this['MARKUP_PERCENTAGE']+_0x128d85(0x1f9)+_0xa4e251[_0x128d85(0x193)](0x6)+_0x128d85(0x1d8)+_0xd7f138+')'),_0xa4e251;}catch(_0x151a5f){console[_0x128d85(0x1b6)](_0x128d85(0x1ab)+_0x595ee1+'\x20'+_0x155868+_0x128d85(0x196),_0x151a5f);const _0x347fd5=_0x595ee1*(0x1+this[_0x128d85(0x1fa)]/0x64);return _0x347fd5;}}async['convertMultipleToUSDT'](_0x214a77){let _0xe834a4=0x0;for(const {amount:_0x5addae,currency:_0x1983b2}of _0x214a77){const _0x3efa05=await this['convertToUSDT'](_0x5addae,_0x1983b2);_0xe834a4+=_0x3efa05;}return _0xe834a4;}async[a38_0x28e16a(0x190)](){const _0x1aab71=a38_0x28e16a;try{const _0x38349b=await database_1[_0x1aab71(0x1e1)][_0x1aab71(0x1da)][_0x1aab71(0x1fe)]({'select':{'currency':!![],'rate':!![]}}),_0x3f80ed={'usdt':0x1};return _0x38349b[_0x1aab71(0x1be)](_0xd9cd83=>{const _0x22824a=_0x1aab71;_0x3f80ed[_0xd9cd83[_0x22824a(0x1e0)]]=_0xd9cd83['rate'];}),_0x3f80ed;}catch(_0x11a057){return console[_0x1aab71(0x1b6)](_0x1aab71(0x1f7),_0x11a057),{'usdt':0x1};}}async['getRatesStatus'](){const _0x108a07=a38_0x28e16a;try{const [_0x58d011,_0x796268,_0x976523]=await Promise[_0x108a07(0x198)]([database_1[_0x108a07(0x1e1)][_0x108a07(0x1da)][_0x108a07(0x194)](),database_1[_0x108a07(0x1e1)][_0x108a07(0x1da)]['findFirst']({'orderBy':{'updatedAt':_0x108a07(0x1c4)},'select':{'updatedAt':!![]}}),database_1[_0x108a07(0x1e1)][_0x108a07(0x1da)]['findFirst']({'orderBy':{'updatedAt':_0x108a07(0x1d6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x58d011,'lastUpdated':_0x796268?.['updatedAt']||null,'oldestRate':_0x976523?.[_0x108a07(0x203)]||null,'markupPercentage':this[_0x108a07(0x1fa)]};}catch(_0x16caa4){return console[_0x108a07(0x1b6)](_0x108a07(0x1bc),_0x16caa4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x108a07(0x1fa)]};}}['getMarkupPercentage'](){const _0x5a426f=a38_0x28e16a;return this[_0x5a426f(0x1fa)];}}exports[a38_0x28e16a(0x1b7)]=CurrencyService,exports[a38_0x28e16a(0x1d7)]=new CurrencyService();