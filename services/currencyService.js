'use strict';const a36_0x1e6def=a36_0x2f74;(function(_0x298581,_0x440b07){const _0x2bd55c=a36_0x2f74,_0x129c35=_0x298581();while(!![]){try{const _0x3e1aca=parseInt(_0x2bd55c(0x20a))/0x1+parseInt(_0x2bd55c(0x232))/0x2*(-parseInt(_0x2bd55c(0x20d))/0x3)+-parseInt(_0x2bd55c(0x1c0))/0x4*(parseInt(_0x2bd55c(0x225))/0x5)+-parseInt(_0x2bd55c(0x223))/0x6+-parseInt(_0x2bd55c(0x1db))/0x7+parseInt(_0x2bd55c(0x214))/0x8*(parseInt(_0x2bd55c(0x1bf))/0x9)+parseInt(_0x2bd55c(0x1cc))/0xa;if(_0x3e1aca===_0x440b07)break;else _0x129c35['push'](_0x129c35['shift']());}catch(_0x1302bc){_0x129c35['push'](_0x129c35['shift']());}}}(a36_0x22ca,0xcba55));function a36_0x2f74(_0x493bdb,_0xef92fd){const _0x22ca7f=a36_0x22ca();return a36_0x2f74=function(_0x2f7497,_0x5e2e42){_0x2f7497=_0x2f7497-0x1b6;let _0x1411b6=_0x22ca7f[_0x2f7497];return _0x1411b6;},a36_0x2f74(_0x493bdb,_0xef92fd);}var __importDefault=this&&this[a36_0x1e6def(0x220)]||function(_0x2c8746){const _0x553a92=a36_0x1e6def;return _0x2c8746&&_0x2c8746[_0x553a92(0x1f5)]?_0x2c8746:{'default':_0x2c8746};};function a36_0x22ca(){const _0x57e336=['log','❌\x20Failed\x20to\x20update\x20currency\x20rates:','getAllRates','rub','statusText','\x20USDT,\x20with\x20','currency','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','defineProperty','cad','\x20to\x20','dot','map','10280354TGFzqr','usdt','Initial\x20currency\x20rates\x20update\x20failed:','yfi','💱\x20Converted\x20','bdt','php','eth','status',',\x20using\x201\x20as\x20fallback','getCurrencyRate','bits','Failed\x20to\x20update\x20rate\x20for\x20','chf','findUnique','💱\x20Applied\x20','pkr','desc','mxn','toLowerCase','count','huf','hkd','tether','eos','inr','__esModule','application/json','try','entries','nzd','cny','\x20to\x20USDT:','link','CurrencyService','upsert','ngn','currencyService','nok','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','updateCurrencyRates','mmk','updatedAt','ars','startPeriodicUpdates','warn','keys','669113pQShSH','sar','sgd','36360YEwAes','vef','ltc','lkr','Error\x20getting\x20rate\x20for\x20currency\x20','../config/database','xdr','8LehalY','CoinGecko\x20API\x20error:\x20','rate','btc','Error\x20getting\x20all\x20rates:','COINGECKO_URL','findFirst','%\x20markup\x20to\x20','Error\x20converting\x20','xau','ils','eur','__importDefault','%\x20markup\x20=\x20','bhd','9437628RmumDZ','czk','5EVunBv','updateInterval','📊\x20Received\x20rates\x20for\x20','bnb','thb','getRatesStatus','bmd','\x20USDT\x20(rate:\x20','error','?ids=tether&vs_currencies=','CURRENCIES','convertMultipleToUSDT','convertToUSDT','132CpNjFq','xlm','currencyRate','default','toFixed','zar','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','vnd','dkk','length','aud','uah','bch','11955006czngNc','206252FpiUYq','json','allSettled','brl','MARKUP_PERCENTAGE','findMany','krw','asc','Error\x20getting\x20rates\x20status:','\x20USDT','myr','aed','27297290EoSbdZ','jpy'];a36_0x22ca=function(){return _0x57e336;};return a36_0x22ca();}Object[a36_0x1e6def(0x1d6)](exports,a36_0x1e6def(0x1f5),{'value':!![]}),exports[a36_0x1e6def(0x200)]=exports[a36_0x1e6def(0x1fd)]=void 0x0;const database_1=__importDefault(require(a36_0x1e6def(0x212)));class CurrencyService{constructor(){const _0x50b96a=a36_0x1e6def;this[_0x50b96a(0x219)]='https://api.coingecko.com/api/v3/simple/price',this[_0x50b96a(0x22f)]=[_0x50b96a(0x217),_0x50b96a(0x1e2),_0x50b96a(0x20f),_0x50b96a(0x1be),_0x50b96a(0x228),_0x50b96a(0x1f3),'xrp',_0x50b96a(0x233),_0x50b96a(0x1fc),_0x50b96a(0x1d9),_0x50b96a(0x1de),'usd',_0x50b96a(0x1cb),_0x50b96a(0x206),_0x50b96a(0x1bc),_0x50b96a(0x1e0),_0x50b96a(0x222),_0x50b96a(0x22b),_0x50b96a(0x1c3),_0x50b96a(0x1d7),_0x50b96a(0x1e8),'clp',_0x50b96a(0x1fa),_0x50b96a(0x224),_0x50b96a(0x1ba),_0x50b96a(0x21f),'gbp','gel',_0x50b96a(0x1f1),_0x50b96a(0x1f0),'idr',_0x50b96a(0x21e),_0x50b96a(0x1f4),_0x50b96a(0x1cd),_0x50b96a(0x1c6),'kwd',_0x50b96a(0x210),_0x50b96a(0x204),_0x50b96a(0x1ed),_0x50b96a(0x1ca),_0x50b96a(0x1ff),_0x50b96a(0x201),_0x50b96a(0x1f9),_0x50b96a(0x1e1),_0x50b96a(0x1eb),'pln',_0x50b96a(0x1d1),_0x50b96a(0x20b),'sek',_0x50b96a(0x20c),_0x50b96a(0x229),_0x50b96a(0x1f7),'twd',_0x50b96a(0x1bd),_0x50b96a(0x20e),_0x50b96a(0x1b9),_0x50b96a(0x1b7),_0x50b96a(0x213),'xag',_0x50b96a(0x21d),_0x50b96a(0x1e6),'sats'],this[_0x50b96a(0x226)]=null,this[_0x50b96a(0x1c4)]=0x3,this[_0x50b96a(0x207)]();}[a36_0x1e6def(0x207)](){const _0x36a561=a36_0x1e6def;this['updateCurrencyRates']()['catch'](_0x35bd1a=>{const _0xcb67e9=a36_0x2f74;console[_0xcb67e9(0x22d)](_0xcb67e9(0x1dd),_0x35bd1a);}),this[_0x36a561(0x226)]=setInterval(async()=>{const _0x197550=_0x36a561;try{await this[_0x197550(0x203)]();}catch(_0x3af28d){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x3af28d);}},0x3c*0x3c*0x3e8),console[_0x36a561(0x1ce)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0xdee5ca=a36_0x1e6def;this[_0xdee5ca(0x226)]&&(clearInterval(this['updateInterval']),this[_0xdee5ca(0x226)]=null,console[_0xdee5ca(0x1ce)](_0xdee5ca(0x202)));}async[a36_0x1e6def(0x203)](){const _0x24be76=a36_0x1e6def;try{console[_0x24be76(0x1ce)](_0x24be76(0x1b8));const _0x46c42c=this['CURRENCIES']['join'](','),_0xa7e676=this[_0x24be76(0x219)]+_0x24be76(0x22e)+_0x46c42c,_0x6a52e1=await fetch(_0xa7e676,{'headers':{'Accept':_0x24be76(0x1f6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x6a52e1['ok'])throw new Error(_0x24be76(0x215)+_0x6a52e1[_0x24be76(0x1e3)]+'\x20'+_0x6a52e1[_0x24be76(0x1d2)]);const _0x52bae5=await _0x6a52e1[_0x24be76(0x1c1)]();if(!_0x52bae5[_0x24be76(0x1f2)])throw new Error(_0x24be76(0x1d5));const _0x1e74bd=_0x52bae5[_0x24be76(0x1f2)];console[_0x24be76(0x1ce)](_0x24be76(0x227)+Object[_0x24be76(0x209)](_0x1e74bd)[_0x24be76(0x1bb)]+'\x20currencies');const _0x2efdfe=Object[_0x24be76(0x1f8)](_0x1e74bd)[_0x24be76(0x1da)](async([_0x1b0434,_0x13f25c])=>{const _0x14e0c1=_0x24be76;try{await database_1['default']['currencyRate'][_0x14e0c1(0x1fe)]({'where':{'currency':_0x1b0434[_0x14e0c1(0x1ee)]()},'update':{'rate':_0x13f25c},'create':{'currency':_0x1b0434['toLowerCase'](),'rate':_0x13f25c}});}catch(_0x383a69){console[_0x14e0c1(0x22d)](_0x14e0c1(0x1e7)+_0x1b0434+':',_0x383a69);}});await Promise[_0x24be76(0x1c2)](_0x2efdfe),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x37557c){console[_0x24be76(0x22d)](_0x24be76(0x1cf),_0x37557c);throw _0x37557c;}}async[a36_0x1e6def(0x1e5)](_0x59281e){const _0x1bbdbe=a36_0x1e6def,_0x3fa0c6=_0x59281e[_0x1bbdbe(0x1ee)]();if(_0x3fa0c6===_0x1bbdbe(0x1dc))return 0x1;try{const _0x4cf489=await database_1[_0x1bbdbe(0x235)][_0x1bbdbe(0x234)][_0x1bbdbe(0x1e9)]({'where':{'currency':_0x3fa0c6}});if(!_0x4cf489)return console[_0x1bbdbe(0x208)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x59281e+_0x1bbdbe(0x1e4)),0x1;return _0x4cf489[_0x1bbdbe(0x216)];}catch(_0x1d9261){return console[_0x1bbdbe(0x22d)](_0x1bbdbe(0x211)+_0x59281e+':',_0x1d9261),0x1;}}async['convertToUSDT'](_0x573dd6,_0x486bc7){const _0x5c90eb=a36_0x1e6def,_0x5cb4a3=_0x486bc7[_0x5c90eb(0x1ee)]();if(_0x5cb4a3===_0x5c90eb(0x1dc)){const _0x47fd69=_0x573dd6*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5c90eb(0x1ce)](_0x5c90eb(0x1ea)+this[_0x5c90eb(0x1c4)]+_0x5c90eb(0x21b)+_0x573dd6+'\x20USDT\x20=\x20'+_0x47fd69[_0x5c90eb(0x1b6)](0x6)+_0x5c90eb(0x1c9)),_0x47fd69;}try{const _0x23e449=await this[_0x5c90eb(0x1e5)](_0x5cb4a3),_0x2058a5=_0x573dd6/_0x23e449,_0x4f4c15=_0x2058a5*(0x1+this[_0x5c90eb(0x1c4)]/0x64);return console['log'](_0x5c90eb(0x1df)+_0x573dd6+'\x20'+_0x486bc7['toUpperCase']()+_0x5c90eb(0x1d8)+_0x2058a5['toFixed'](0x6)+_0x5c90eb(0x1d3)+this['MARKUP_PERCENTAGE']+_0x5c90eb(0x221)+_0x4f4c15[_0x5c90eb(0x1b6)](0x6)+_0x5c90eb(0x22c)+_0x23e449+')'),_0x4f4c15;}catch(_0x265bf9){console[_0x5c90eb(0x22d)](_0x5c90eb(0x21c)+_0x573dd6+'\x20'+_0x486bc7+_0x5c90eb(0x1fb),_0x265bf9);const _0x31bc7c=_0x573dd6*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x31bc7c;}}async[a36_0x1e6def(0x230)](_0x3b8f5a){const _0x515110=a36_0x1e6def;let _0x2da416=0x0;for(const {amount:_0x2d2eaf,currency:_0x275689}of _0x3b8f5a){const _0x4e97e6=await this[_0x515110(0x231)](_0x2d2eaf,_0x275689);_0x2da416+=_0x4e97e6;}return _0x2da416;}async[a36_0x1e6def(0x1d0)](){const _0x430317=a36_0x1e6def;try{const _0x517b6e=await database_1[_0x430317(0x235)][_0x430317(0x234)][_0x430317(0x1c5)]({'select':{'currency':!![],'rate':!![]}}),_0x54ba84={'usdt':0x1};return _0x517b6e['forEach'](_0x27dfe6=>{const _0x30b607=_0x430317;_0x54ba84[_0x27dfe6[_0x30b607(0x1d4)]]=_0x27dfe6['rate'];}),_0x54ba84;}catch(_0x4334fe){return console[_0x430317(0x22d)](_0x430317(0x218),_0x4334fe),{'usdt':0x1};}}async[a36_0x1e6def(0x22a)](){const _0x1ac3be=a36_0x1e6def;try{const [_0x21f403,_0x20c73f,_0x137c00]=await Promise['all']([database_1['default'][_0x1ac3be(0x234)][_0x1ac3be(0x1ef)](),database_1[_0x1ac3be(0x235)][_0x1ac3be(0x234)][_0x1ac3be(0x21a)]({'orderBy':{'updatedAt':_0x1ac3be(0x1ec)},'select':{'updatedAt':!![]}}),database_1['default'][_0x1ac3be(0x234)]['findFirst']({'orderBy':{'updatedAt':_0x1ac3be(0x1c7)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x21f403,'lastUpdated':_0x20c73f?.[_0x1ac3be(0x205)]||null,'oldestRate':_0x137c00?.[_0x1ac3be(0x205)]||null,'markupPercentage':this[_0x1ac3be(0x1c4)]};}catch(_0x11654f){return console['error'](_0x1ac3be(0x1c8),_0x11654f),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1ac3be(0x1c4)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a36_0x1e6def(0x200)]=new CurrencyService();