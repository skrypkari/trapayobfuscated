'use strict';const a38_0x505ea6=a38_0x5a99;(function(_0x32743a,_0x413a03){const _0x126b2d=a38_0x5a99,_0x2d65e2=_0x32743a();while(!![]){try{const _0x5d82f1=parseInt(_0x126b2d(0x1f8))/0x1*(-parseInt(_0x126b2d(0x1d9))/0x2)+parseInt(_0x126b2d(0x224))/0x3+parseInt(_0x126b2d(0x21d))/0x4+parseInt(_0x126b2d(0x1e4))/0x5+-parseInt(_0x126b2d(0x1d7))/0x6*(parseInt(_0x126b2d(0x1fb))/0x7)+parseInt(_0x126b2d(0x202))/0x8*(-parseInt(_0x126b2d(0x1bd))/0x9)+-parseInt(_0x126b2d(0x1d6))/0xa*(-parseInt(_0x126b2d(0x1e2))/0xb);if(_0x5d82f1===_0x413a03)break;else _0x2d65e2['push'](_0x2d65e2['shift']());}catch(_0xbce1d){_0x2d65e2['push'](_0x2d65e2['shift']());}}}(a38_0x1c44,0xef831));var __importDefault=this&&this[a38_0x505ea6(0x21c)]||function(_0x5b8b72){return _0x5b8b72&&_0x5b8b72['__esModule']?_0x5b8b72:{'default':_0x5b8b72};};Object[a38_0x505ea6(0x1df)](exports,a38_0x505ea6(0x1ea),{'value':!![]}),exports['currencyService']=exports[a38_0x505ea6(0x1c9)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x22603a=a38_0x505ea6;this[_0x22603a(0x1ec)]='https://api.coingecko.com/api/v3/simple/price',this[_0x22603a(0x1d8)]=[_0x22603a(0x1fd),'eth',_0x22603a(0x1f4),'bch',_0x22603a(0x222),'eos',_0x22603a(0x1dd),'xlm',_0x22603a(0x20d),_0x22603a(0x229),_0x22603a(0x1d0),_0x22603a(0x1e8),_0x22603a(0x20c),'ars',_0x22603a(0x234),_0x22603a(0x230),'bhd',_0x22603a(0x1bc),_0x22603a(0x217),_0x22603a(0x1c6),'chf',_0x22603a(0x225),'cny','czk',_0x22603a(0x1e3),'eur',_0x22603a(0x20e),_0x22603a(0x201),_0x22603a(0x22d),_0x22603a(0x1c7),_0x22603a(0x1d3),_0x22603a(0x200),_0x22603a(0x1fe),_0x22603a(0x20b),_0x22603a(0x205),_0x22603a(0x215),_0x22603a(0x1e1),_0x22603a(0x1c5),_0x22603a(0x21b),_0x22603a(0x223),'ngn',_0x22603a(0x207),_0x22603a(0x1ef),'php',_0x22603a(0x1f6),_0x22603a(0x232),_0x22603a(0x1bb),_0x22603a(0x1c1),_0x22603a(0x235),_0x22603a(0x1c0),_0x22603a(0x21f),_0x22603a(0x20f),_0x22603a(0x203),_0x22603a(0x1e5),_0x22603a(0x1e9),'vnd',_0x22603a(0x233),_0x22603a(0x204),'xag','xau',_0x22603a(0x236),_0x22603a(0x1ed)],this[_0x22603a(0x1db)]=null,this['MARKUP_PERCENTAGE']=0x3,this['startPeriodicUpdates']();}[a38_0x505ea6(0x22c)](){const _0x1d2ff1=a38_0x505ea6;this[_0x1d2ff1(0x219)]()[_0x1d2ff1(0x1f7)](_0x37f426=>{const _0x44f20c=_0x1d2ff1;console[_0x44f20c(0x1cd)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x37f426);}),this[_0x1d2ff1(0x1db)]=setInterval(async()=>{const _0xa15f36=_0x1d2ff1;try{await this['updateCurrencyRates']();}catch(_0x21815a){console[_0xa15f36(0x1cd)](_0xa15f36(0x208),_0x21815a);}},0x3c*0x3c*0x3e8),console[_0x1d2ff1(0x1c8)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x505ea6(0x1c4)](){const _0x4f8b2a=a38_0x505ea6;this[_0x4f8b2a(0x1db)]&&(clearInterval(this[_0x4f8b2a(0x1db)]),this[_0x4f8b2a(0x1db)]=null,console[_0x4f8b2a(0x1c8)](_0x4f8b2a(0x221)));}async[a38_0x505ea6(0x219)](){const _0x48bd2f=a38_0x505ea6;try{console[_0x48bd2f(0x1c8)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x518448=this['CURRENCIES'][_0x48bd2f(0x1f3)](','),_0xa59976=this[_0x48bd2f(0x1ec)]+'?ids=tether&vs_currencies='+_0x518448,_0x3b461c=await fetch(_0xa59976,{'headers':{'Accept':_0x48bd2f(0x1d2),'User-Agent':_0x48bd2f(0x1e0)}});if(!_0x3b461c['ok'])throw new Error(_0x48bd2f(0x21e)+_0x3b461c[_0x48bd2f(0x1ff)]+'\x20'+_0x3b461c['statusText']);const _0x3c4ff8=await _0x3b461c[_0x48bd2f(0x22f)]();if(!_0x3c4ff8[_0x48bd2f(0x231)])throw new Error(_0x48bd2f(0x1d1));const _0x2d55a1=_0x3c4ff8[_0x48bd2f(0x231)];console['log']('üìä\x20Received\x20rates\x20for\x20'+Object['keys'](_0x2d55a1)[_0x48bd2f(0x216)]+_0x48bd2f(0x21a));const _0x194df4=Object[_0x48bd2f(0x1c2)](_0x2d55a1)[_0x48bd2f(0x1f1)](async([_0x16c6a1,_0x8d598])=>{const _0x3a0716=_0x48bd2f;try{await database_1['default'][_0x3a0716(0x1fa)][_0x3a0716(0x1eb)]({'where':{'currency':_0x16c6a1['toLowerCase']()},'update':{'rate':_0x8d598},'create':{'currency':_0x16c6a1['toLowerCase'](),'rate':_0x8d598}});}catch(_0x55e915){console[_0x3a0716(0x1cd)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x16c6a1+':',_0x55e915);}});await Promise[_0x48bd2f(0x1da)](_0x194df4),console[_0x48bd2f(0x1c8)](_0x48bd2f(0x210));}catch(_0x1b009f){console[_0x48bd2f(0x1cd)](_0x48bd2f(0x1f0),_0x1b009f);throw _0x1b009f;}}async[a38_0x505ea6(0x1fc)](_0x5c2f0a){const _0x4c9a4d=a38_0x505ea6,_0x1f4f38=_0x5c2f0a['toLowerCase']();if(_0x1f4f38===_0x4c9a4d(0x1f2))return 0x1;try{const _0x19136a=await database_1[_0x4c9a4d(0x1f9)][_0x4c9a4d(0x1fa)][_0x4c9a4d(0x1cc)]({'where':{'currency':_0x1f4f38}});if(!_0x19136a)return console[_0x4c9a4d(0x218)](_0x4c9a4d(0x213)+_0x5c2f0a+_0x4c9a4d(0x1de)),0x1;return _0x19136a['rate'];}catch(_0x39d2ce){return console[_0x4c9a4d(0x1cd)](_0x4c9a4d(0x212)+_0x5c2f0a+':',_0x39d2ce),0x1;}}async['convertToUSDT'](_0x3b1662,_0x34a12a){const _0x219060=a38_0x505ea6,_0x2c2926=_0x34a12a[_0x219060(0x206)]();if(_0x2c2926==='usdt'){const _0x364873=_0x3b1662*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x219060(0x1c8)](_0x219060(0x1cb)+this[_0x219060(0x1ee)]+_0x219060(0x22b)+_0x3b1662+_0x219060(0x1bf)+_0x364873[_0x219060(0x22a)](0x6)+_0x219060(0x214)),_0x364873;}try{const _0xd4136e=await this[_0x219060(0x1fc)](_0x2c2926),_0x2bc936=_0x3b1662/_0xd4136e,_0xec7e69=_0x2bc936*(0x1+this[_0x219060(0x1ee)]/0x64);return console[_0x219060(0x1c8)](_0x219060(0x22e)+_0x3b1662+'\x20'+_0x34a12a['toUpperCase']()+'\x20to\x20'+_0x2bc936[_0x219060(0x22a)](0x6)+_0x219060(0x1ca)+this[_0x219060(0x1ee)]+_0x219060(0x226)+_0xec7e69[_0x219060(0x22a)](0x6)+_0x219060(0x209)+_0xd4136e+')'),_0xec7e69;}catch(_0x3c41e2){console['error'](_0x219060(0x1ce)+_0x3b1662+'\x20'+_0x34a12a+'\x20to\x20USDT:',_0x3c41e2);const _0x268d72=_0x3b1662*(0x1+this[_0x219060(0x1ee)]/0x64);return _0x268d72;}}async[a38_0x505ea6(0x227)](_0x222d82){const _0x412d53=a38_0x505ea6;let _0x3e1bcc=0x0;for(const {amount:_0x3b50b8,currency:_0x5d4e44}of _0x222d82){const _0x4d843f=await this[_0x412d53(0x1e6)](_0x3b50b8,_0x5d4e44);_0x3e1bcc+=_0x4d843f;}return _0x3e1bcc;}async[a38_0x505ea6(0x1c3)](){const _0x3c383e=a38_0x505ea6;try{const _0x56ea5b=await database_1[_0x3c383e(0x1f9)]['currencyRate'][_0x3c383e(0x211)]({'select':{'currency':!![],'rate':!![]}}),_0x469938={'usdt':0x1};return _0x56ea5b['forEach'](_0x38f7a8=>{const _0x12196f=_0x3c383e;_0x469938[_0x38f7a8[_0x12196f(0x1cf)]]=_0x38f7a8[_0x12196f(0x1d5)];}),_0x469938;}catch(_0x1caaaa){return console[_0x3c383e(0x1cd)]('Error\x20getting\x20all\x20rates:',_0x1caaaa),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4cc3f2=a38_0x505ea6;try{const [_0x5e3244,_0x23911a,_0x414b52]=await Promise[_0x4cc3f2(0x1dc)]([database_1[_0x4cc3f2(0x1f9)][_0x4cc3f2(0x1fa)]['count'](),database_1[_0x4cc3f2(0x1f9)]['currencyRate'][_0x4cc3f2(0x220)]({'orderBy':{'updatedAt':_0x4cc3f2(0x1be)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x4cc3f2(0x220)]({'orderBy':{'updatedAt':_0x4cc3f2(0x1f5)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5e3244,'lastUpdated':_0x23911a?.[_0x4cc3f2(0x1d4)]||null,'oldestRate':_0x414b52?.[_0x4cc3f2(0x1d4)]||null,'markupPercentage':this[_0x4cc3f2(0x1ee)]};}catch(_0x5e2831){return console[_0x4cc3f2(0x1cd)](_0x4cc3f2(0x228),_0x5e2831),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x505ea6(0x1e7)](){const _0x574a43=a38_0x505ea6;return this[_0x574a43(0x1ee)];}}function a38_0x5a99(_0x317de9,_0x3f6888){const _0x1c4441=a38_0x1c44();return a38_0x5a99=function(_0x5a99eb,_0x3a69a1){_0x5a99eb=_0x5a99eb-0x1bb;let _0x4cc291=_0x1c4441[_0x5a99eb];return _0x4cc291;},a38_0x5a99(_0x317de9,_0x3f6888);}function a38_0x1c44(){const _0x3b3f98=['uah','convertToUSDT','getMarkupPercentage','usd','vef','__esModule','upsert','COINGECKO_URL','sats','MARKUP_PERCENTAGE','nzd','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','map','usdt','join','ltc','asc','pkr','catch','969722BaHGIU','default','currencyRate','2471UKBoFM','getCurrencyRate','btc','inr','status','ils','gel','1936NnZfBK','twd','xdr','krw','toLowerCase','nok','Periodic\x20currency\x20rates\x20update\x20failed:','\x20USDT\x20(rate:\x20','currencyService','jpy','aed','link','gbp','try','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','findMany','Error\x20getting\x20rate\x20for\x20currency\x20','No\x20rate\x20found\x20for\x20currency:\x20','\x20USDT','kwd','length','brl','warn','updateCurrencyRates','\x20currencies','mxn','__importDefault','1549020DULvHx','CoinGecko\x20API\x20error:\x20','thb','findFirst','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','bnb','myr','3455505MkwwFj','clp','%\x20markup\x20=\x20','convertMultipleToUSDT','Error\x20getting\x20rates\x20status:','dot','toFixed','%\x20markup\x20to\x20','startPeriodicUpdates','hkd','üí±\x20Converted\x20','json','bdt','tether','pln','zar','aud','sek','bits','rub','bmd','16083DFfUvL','desc','\x20USDT\x20=\x20','sgd','sar','entries','getAllRates','stopPeriodicUpdates','mmk','cad','huf','log','CurrencyService','\x20USDT,\x20with\x20','üí±\x20Applied\x20','findUnique','error','Error\x20converting\x20','currency','yfi','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','application/json','idr','updatedAt','rate','40QfzfRP','12792svpgiz','CURRENCIES','2JsyLjX','allSettled','updateInterval','all','xrp',',\x20using\x201\x20as\x20fallback','defineProperty','TesSoft\x20Payment\x20System/1.0','lkr','1045979agZjbm','dkk','6081835wLxAXd'];a38_0x1c44=function(){return _0x3b3f98;};return a38_0x1c44();}exports['CurrencyService']=CurrencyService,exports[a38_0x505ea6(0x20a)]=new CurrencyService();