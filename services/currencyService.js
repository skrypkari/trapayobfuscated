'use strict';const a38_0x284d16=a38_0x4f0e;(function(_0x2779fd,_0x5a9ebd){const _0x421bdc=a38_0x4f0e,_0x44b509=_0x2779fd();while(!![]){try{const _0x22c059=-parseInt(_0x421bdc(0x20d))/0x1+-parseInt(_0x421bdc(0x1f9))/0x2+-parseInt(_0x421bdc(0x202))/0x3*(parseInt(_0x421bdc(0x1f6))/0x4)+-parseInt(_0x421bdc(0x210))/0x5*(-parseInt(_0x421bdc(0x24b))/0x6)+-parseInt(_0x421bdc(0x233))/0x7+parseInt(_0x421bdc(0x206))/0x8+parseInt(_0x421bdc(0x207))/0x9;if(_0x22c059===_0x5a9ebd)break;else _0x44b509['push'](_0x44b509['shift']());}catch(_0x54fd46){_0x44b509['push'](_0x44b509['shift']());}}}(a38_0x3b48,0xdb6fd));function a38_0x4f0e(_0x819110,_0x5e61a5){const _0x3b48b1=a38_0x3b48();return a38_0x4f0e=function(_0x4f0eac,_0x1aa591){_0x4f0eac=_0x4f0eac-0x1f2;let _0x4a4f49=_0x3b48b1[_0x4f0eac];return _0x4a4f49;},a38_0x4f0e(_0x819110,_0x5e61a5);}var __importDefault=this&&this[a38_0x284d16(0x217)]||function(_0x3fdcef){return _0x3fdcef&&_0x3fdcef['__esModule']?_0x3fdcef:{'default':_0x3fdcef};};Object[a38_0x284d16(0x212)](exports,a38_0x284d16(0x25b),{'value':!![]}),exports[a38_0x284d16(0x229)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));function a38_0x3b48(){const _0x4dc15b=['jpy','upsert','usdt','pkr','sgd','warn','log','bmd','sats','\x20USDT','xlm','keys','bhd','tether','join','updateInterval','count','Error\x20getting\x20rate\x20for\x20currency\x20','huf','yfi','Periodic\x20currency\x20rates\x20update\x20failed:','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','asc','20508hHZntI','zar','gel','xau','Error\x20getting\x20rates\x20status:','dot','\x20USDT,\x20with\x20','vef','💱\x20Converted\x20','error','updateCurrencyRates','catch','https://api.coingecko.com/api/v3/simple/price','czk','\x20currencies','?ids=tether&vs_currencies=','__esModule','getCurrencyRate','ils','entries','toFixed','getRatesStatus','xrp','ngn','CURRENCIES','ars','bnb','twd','myr','default','findUnique','Failed\x20to\x20update\x20rate\x20for\x20','convertToUSDT','\x20to\x20USDT:','lkr','2596pcuQRu','gbp','nok','2663628xFRmsW','%\x20markup\x20to\x20','bits','statusText','uah','getMarkupPercentage','inr','getAllRates','rub','699XMirWY',',\x20using\x201\x20as\x20fallback','status','sek','2574440OdOJDj','35322471xKpQfO','findMany','btc','nzd','try','chf','1010707WNGgBn','aed','COINGECKO_URL','1035BvDLlT','%\x20markup\x20=\x20','defineProperty','CoinGecko\x20API\x20error:\x20','application/json','vnd','\x20to\x20','__importDefault','TesSoft\x20Payment\x20System/1.0','💱\x20Applied\x20','MARKUP_PERCENTAGE','currencyRate','updatedAt','pln','allSettled','eos','link','map','✅\x20Currency\x20rates\x20updated\x20successfully','length','findFirst','eth','startPeriodicUpdates','brl','❌\x20Failed\x20to\x20update\x20currency\x20rates:','currencyService','toLowerCase','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','eur','ltc','rate','clp','📊\x20Received\x20rates\x20for\x20','thb','bdt','10930493ltrtUt'];a38_0x3b48=function(){return _0x4dc15b;};return a38_0x3b48();}class CurrencyService{constructor(){const _0xa7d812=a38_0x284d16;this[_0xa7d812(0x20f)]=_0xa7d812(0x257),this[_0xa7d812(0x263)]=[_0xa7d812(0x209),_0xa7d812(0x225),_0xa7d812(0x22d),'bch',_0xa7d812(0x265),_0xa7d812(0x21f),_0xa7d812(0x261),_0xa7d812(0x23e),_0xa7d812(0x220),_0xa7d812(0x250),_0xa7d812(0x247),'usd',_0xa7d812(0x20e),_0xa7d812(0x264),'aud',_0xa7d812(0x232),_0xa7d812(0x240),_0xa7d812(0x23b),_0xa7d812(0x227),'cad',_0xa7d812(0x20c),_0xa7d812(0x22f),'cny',_0xa7d812(0x258),'dkk',_0xa7d812(0x22c),_0xa7d812(0x1f7),_0xa7d812(0x24d),'hkd',_0xa7d812(0x246),'idr',_0xa7d812(0x25d),_0xa7d812(0x1ff),_0xa7d812(0x234),'krw','kwd',_0xa7d812(0x1f5),'mmk','mxn',_0xa7d812(0x267),_0xa7d812(0x262),_0xa7d812(0x1f8),_0xa7d812(0x20a),'php',_0xa7d812(0x237),_0xa7d812(0x21d),_0xa7d812(0x201),'sar',_0xa7d812(0x205),_0xa7d812(0x238),_0xa7d812(0x231),_0xa7d812(0x20b),_0xa7d812(0x266),_0xa7d812(0x1fd),_0xa7d812(0x252),_0xa7d812(0x215),_0xa7d812(0x24c),'xdr','xag',_0xa7d812(0x24e),_0xa7d812(0x1fb),_0xa7d812(0x23c)],this[_0xa7d812(0x243)]=null,this[_0xa7d812(0x21a)]=0x3,this[_0xa7d812(0x226)]();}[a38_0x284d16(0x226)](){const _0x287451=a38_0x284d16;this[_0x287451(0x255)]()[_0x287451(0x256)](_0x1e103f=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x1e103f);}),this[_0x287451(0x243)]=setInterval(async()=>{const _0x5be9da=_0x287451;try{await this[_0x5be9da(0x255)]();}catch(_0x545165){console[_0x5be9da(0x254)](_0x5be9da(0x248),_0x545165);}},0x3c*0x3c*0x3e8),console[_0x287451(0x23a)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x517b05=a38_0x284d16;this[_0x517b05(0x243)]&&(clearInterval(this[_0x517b05(0x243)]),this[_0x517b05(0x243)]=null,console[_0x517b05(0x23a)](_0x517b05(0x249)));}async[a38_0x284d16(0x255)](){const _0x7ae363=a38_0x284d16;try{console[_0x7ae363(0x23a)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x6a4aca=this[_0x7ae363(0x263)][_0x7ae363(0x242)](','),_0xc69807=this[_0x7ae363(0x20f)]+_0x7ae363(0x25a)+_0x6a4aca,_0x3d426b=await fetch(_0xc69807,{'headers':{'Accept':_0x7ae363(0x214),'User-Agent':_0x7ae363(0x218)}});if(!_0x3d426b['ok'])throw new Error(_0x7ae363(0x213)+_0x3d426b[_0x7ae363(0x204)]+'\x20'+_0x3d426b[_0x7ae363(0x1fc)]);const _0x2561af=await _0x3d426b['json']();if(!_0x2561af[_0x7ae363(0x241)])throw new Error(_0x7ae363(0x22b));const _0x3fb41e=_0x2561af[_0x7ae363(0x241)];console[_0x7ae363(0x23a)](_0x7ae363(0x230)+Object[_0x7ae363(0x23f)](_0x3fb41e)[_0x7ae363(0x223)]+_0x7ae363(0x259));const _0xd918b4=Object[_0x7ae363(0x25e)](_0x3fb41e)[_0x7ae363(0x221)](async([_0x3250e1,_0x4331ea])=>{const _0xe0d217=_0x7ae363;try{await database_1[_0xe0d217(0x268)][_0xe0d217(0x21b)][_0xe0d217(0x235)]({'where':{'currency':_0x3250e1[_0xe0d217(0x22a)]()},'update':{'rate':_0x4331ea},'create':{'currency':_0x3250e1[_0xe0d217(0x22a)](),'rate':_0x4331ea}});}catch(_0x3ad725){console[_0xe0d217(0x254)](_0xe0d217(0x1f2)+_0x3250e1+':',_0x3ad725);}});await Promise[_0x7ae363(0x21e)](_0xd918b4),console['log'](_0x7ae363(0x222));}catch(_0x5b3dfd){console[_0x7ae363(0x254)](_0x7ae363(0x228),_0x5b3dfd);throw _0x5b3dfd;}}async[a38_0x284d16(0x25c)](_0x237fb2){const _0x2a6bd2=a38_0x284d16,_0x5d4b85=_0x237fb2['toLowerCase']();if(_0x5d4b85==='usdt')return 0x1;try{const _0x1c0203=await database_1[_0x2a6bd2(0x268)]['currencyRate'][_0x2a6bd2(0x269)]({'where':{'currency':_0x5d4b85}});if(!_0x1c0203)return console[_0x2a6bd2(0x239)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x237fb2+_0x2a6bd2(0x203)),0x1;return _0x1c0203[_0x2a6bd2(0x22e)];}catch(_0x2539a1){return console[_0x2a6bd2(0x254)](_0x2a6bd2(0x245)+_0x237fb2+':',_0x2539a1),0x1;}}async[a38_0x284d16(0x1f3)](_0x5693ae,_0x143ae5){const _0x4975df=a38_0x284d16,_0xeb4c0a=_0x143ae5[_0x4975df(0x22a)]();if(_0xeb4c0a===_0x4975df(0x236)){const _0x5d23a4=_0x5693ae*(0x1+this[_0x4975df(0x21a)]/0x64);return console[_0x4975df(0x23a)](_0x4975df(0x219)+this[_0x4975df(0x21a)]+_0x4975df(0x1fa)+_0x5693ae+'\x20USDT\x20=\x20'+_0x5d23a4[_0x4975df(0x25f)](0x6)+_0x4975df(0x23d)),_0x5d23a4;}try{const _0x1db2a0=await this[_0x4975df(0x25c)](_0xeb4c0a),_0x5ad249=_0x5693ae/_0x1db2a0,_0x5a4c73=_0x5ad249*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x4975df(0x253)+_0x5693ae+'\x20'+_0x143ae5['toUpperCase']()+_0x4975df(0x216)+_0x5ad249['toFixed'](0x6)+_0x4975df(0x251)+this['MARKUP_PERCENTAGE']+_0x4975df(0x211)+_0x5a4c73['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x1db2a0+')'),_0x5a4c73;}catch(_0x4ef61a){console[_0x4975df(0x254)]('Error\x20converting\x20'+_0x5693ae+'\x20'+_0x143ae5+_0x4975df(0x1f4),_0x4ef61a);const _0x2a002e=_0x5693ae*(0x1+this[_0x4975df(0x21a)]/0x64);return _0x2a002e;}}async['convertMultipleToUSDT'](_0x3bbec6){let _0x4e58fc=0x0;for(const {amount:_0x240960,currency:_0x2414f4}of _0x3bbec6){const _0xf705f8=await this['convertToUSDT'](_0x240960,_0x2414f4);_0x4e58fc+=_0xf705f8;}return _0x4e58fc;}async[a38_0x284d16(0x200)](){const _0x97188e=a38_0x284d16;try{const _0x3d51d4=await database_1[_0x97188e(0x268)][_0x97188e(0x21b)][_0x97188e(0x208)]({'select':{'currency':!![],'rate':!![]}}),_0x18f1ce={'usdt':0x1};return _0x3d51d4['forEach'](_0x6b0561=>{const _0x5dae29=_0x97188e;_0x18f1ce[_0x6b0561['currency']]=_0x6b0561[_0x5dae29(0x22e)];}),_0x18f1ce;}catch(_0x2dee6a){return console[_0x97188e(0x254)]('Error\x20getting\x20all\x20rates:',_0x2dee6a),{'usdt':0x1};}}async[a38_0x284d16(0x260)](){const _0x4a9478=a38_0x284d16;try{const [_0x185c9a,_0x50e817,_0x2b98d3]=await Promise['all']([database_1['default'][_0x4a9478(0x21b)][_0x4a9478(0x244)](),database_1['default'][_0x4a9478(0x21b)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x4a9478(0x268)][_0x4a9478(0x21b)][_0x4a9478(0x224)]({'orderBy':{'updatedAt':_0x4a9478(0x24a)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x185c9a,'lastUpdated':_0x50e817?.['updatedAt']||null,'oldestRate':_0x2b98d3?.[_0x4a9478(0x21c)]||null,'markupPercentage':this[_0x4a9478(0x21a)]};}catch(_0x50eec2){return console['error'](_0x4a9478(0x24f),_0x50eec2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4a9478(0x21a)]};}}[a38_0x284d16(0x1fe)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a38_0x284d16(0x229)]=new CurrencyService();