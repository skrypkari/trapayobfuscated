'use strict';const a53_0x3f7cd9=a53_0x1e31;(function(_0x2aeb99,_0x250212){const _0x4bbe45=a53_0x1e31,_0xa66fab=_0x2aeb99();while(!![]){try{const _0x4cf9d9=-parseInt(_0x4bbe45(0x1ad))/0x1*(parseInt(_0x4bbe45(0x1b8))/0x2)+-parseInt(_0x4bbe45(0x1c8))/0x3+-parseInt(_0x4bbe45(0x1a1))/0x4+-parseInt(_0x4bbe45(0x1e1))/0x5+parseInt(_0x4bbe45(0x1c3))/0x6+-parseInt(_0x4bbe45(0x1df))/0x7+-parseInt(_0x4bbe45(0x1fb))/0x8*(-parseInt(_0x4bbe45(0x1d6))/0x9);if(_0x4cf9d9===_0x250212)break;else _0xa66fab['push'](_0xa66fab['shift']());}catch(_0x26989d){_0xa66fab['push'](_0xa66fab['shift']());}}}(a53_0x5b63,0x66b00));function a53_0x1e31(_0x15a85b,_0x1581b2){_0x15a85b=_0x15a85b-0x186;const _0x5b63ad=a53_0x5b63();let _0x1e3114=_0x5b63ad[_0x15a85b];return _0x1e3114;}var __importDefault=this&&this['__importDefault']||function(_0x502aa8){const _0x2d004c=a53_0x1e31;return _0x502aa8&&_0x502aa8[_0x2d004c(0x1e2)]?_0x502aa8:{'default':_0x502aa8};};function a53_0x5b63(){const _0x2e5432=['getAllRates','startPeriodicUpdates','keys','CoinGecko\x20API\x20error:\x20','5335834UbPHaZ','hkd','3757385oeKHeC','__esModule','\x20to\x20','findUnique','getCurrencyRate','allSettled','aud','count','pkr','bch','aed','krw','myr','Periodic\x20currency\x20rates\x20update\x20failed:','bnb','%\x20markup\x20=\x20','all','currencyRate','brl','âœ…\x20Currency\x20rates\x20updated\x20successfully','currency','?ids=tether&vs_currencies=','currencyService','updatedAt','Payment\x20System/1.0','chf','26129176OCPVov','ils','CurrencyService','convertToUSDT','Error\x20getting\x20all\x20rates:','btc','jpy','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','ars','vnd','bhd','\x20USDT\x20=\x20','log','cad','ðŸ’±\x20Converted\x20',',\x20using\x201\x20as\x20fallback','MARKUP_PERCENTAGE','map','No\x20rate\x20found\x20for\x20currency:\x20','\x20currencies','thb','try','rate','../config/database','mmk','warn','mxn','Error\x20converting\x20','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','3221724ksYwWg','join','eur','default','findFirst','xag','convertMultipleToUSDT','sgd','toLowerCase','stopPeriodicUpdates','idr','application/json','79646GJMLmu','dot','usd','error','bmd','defineProperty','updateInterval','php','kwd','\x20USDT,\x20with\x20','Failed\x20to\x20update\x20rate\x20for\x20','8OQJSBZ','desc','sek','\x20to\x20USDT:','Error\x20getting\x20rates\x20status:','upsert','gbp','COINGECKO_URL','Initial\x20currency\x20rates\x20update\x20failed:','sats','status','2644098WWHqcw','eth','catch','eos','bits','1945404ywUVhT','toFixed','updateCurrencyRates','getMarkupPercentage','cny','https://api.coingecko.com/api/v3/simple/price','CURRENCIES','ðŸ’±\x20Applied\x20','ltc','nok','usdt','yfi','\x20USDT\x20(rate:\x20','zar','9uLkNIu','clp','Error\x20getting\x20rate\x20for\x20currency\x20','forEach','entries'];a53_0x5b63=function(){return _0x2e5432;};return a53_0x5b63();}Object[a53_0x3f7cd9(0x1b2)](exports,a53_0x3f7cd9(0x1e2),{'value':!![]}),exports[a53_0x3f7cd9(0x1f7)]=exports[a53_0x3f7cd9(0x186)]=void 0x0;const database_1=__importDefault(require(a53_0x3f7cd9(0x19b)));class CurrencyService{constructor(){const _0x256fb4=a53_0x3f7cd9;this[_0x256fb4(0x1bf)]=_0x256fb4(0x1cd),this[_0x256fb4(0x1ce)]=[_0x256fb4(0x189),_0x256fb4(0x1c4),_0x256fb4(0x1d0),_0x256fb4(0x1ea),_0x256fb4(0x1ef),_0x256fb4(0x1c6),'xrp','xlm','link',_0x256fb4(0x1ae),_0x256fb4(0x1d3),_0x256fb4(0x1af),_0x256fb4(0x1eb),_0x256fb4(0x18c),_0x256fb4(0x1e7),'bdt',_0x256fb4(0x18e),_0x256fb4(0x1b1),_0x256fb4(0x1f3),_0x256fb4(0x191),_0x256fb4(0x1fa),_0x256fb4(0x1d7),_0x256fb4(0x1cc),'czk','dkk',_0x256fb4(0x1a3),_0x256fb4(0x1be),'gel',_0x256fb4(0x1e0),'huf',_0x256fb4(0x1ab),_0x256fb4(0x1fc),'inr',_0x256fb4(0x18a),_0x256fb4(0x1ec),_0x256fb4(0x1b5),'lkr',_0x256fb4(0x19c),_0x256fb4(0x19e),_0x256fb4(0x1ed),'ngn',_0x256fb4(0x1d1),'nzd',_0x256fb4(0x1b4),_0x256fb4(0x1e9),'pln','rub','sar',_0x256fb4(0x1ba),_0x256fb4(0x1a8),_0x256fb4(0x198),_0x256fb4(0x199),'twd','uah','vef',_0x256fb4(0x18d),_0x256fb4(0x1d5),'xdr',_0x256fb4(0x1a6),'xau',_0x256fb4(0x1c7),_0x256fb4(0x1c1)],this[_0x256fb4(0x1b3)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x256fb4(0x1dc)]();}[a53_0x3f7cd9(0x1dc)](){const _0x56a0e3=a53_0x3f7cd9;this[_0x56a0e3(0x1ca)]()[_0x56a0e3(0x1c5)](_0x1c7005=>{const _0x364e1b=_0x56a0e3;console['error'](_0x364e1b(0x1c0),_0x1c7005);}),this[_0x56a0e3(0x1b3)]=setInterval(async()=>{const _0x540fea=_0x56a0e3;try{await this[_0x540fea(0x1ca)]();}catch(_0x4c4a30){console[_0x540fea(0x1b0)](_0x540fea(0x1ee),_0x4c4a30);}},0x3c*0x3c*0x3e8),console['log']('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a53_0x3f7cd9(0x1aa)](){const _0xb334f4=a53_0x3f7cd9;this[_0xb334f4(0x1b3)]&&(clearInterval(this[_0xb334f4(0x1b3)]),this[_0xb334f4(0x1b3)]=null,console['log']('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a53_0x3f7cd9(0x1ca)](){const _0x5934a9=a53_0x3f7cd9;try{console[_0x5934a9(0x190)](_0x5934a9(0x1a0));const _0x5ab8fa=this[_0x5934a9(0x1ce)][_0x5934a9(0x1a2)](','),_0x3dc830=this[_0x5934a9(0x1bf)]+_0x5934a9(0x1f6)+_0x5ab8fa,_0x41e9d5=await fetch(_0x3dc830,{'headers':{'Accept':_0x5934a9(0x1ac),'User-Agent':_0x5934a9(0x1f9)}});if(!_0x41e9d5['ok'])throw new Error(_0x5934a9(0x1de)+_0x41e9d5[_0x5934a9(0x1c2)]+'\x20'+_0x41e9d5['statusText']);const _0x9e017a=await _0x41e9d5['json']();if(!_0x9e017a['tether'])throw new Error(_0x5934a9(0x18b));const _0xb4c270=_0x9e017a['tether'];console[_0x5934a9(0x190)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0x5934a9(0x1dd)](_0xb4c270)['length']+_0x5934a9(0x197));const _0x470d73=Object[_0x5934a9(0x1da)](_0xb4c270)[_0x5934a9(0x195)](async([_0x188118,_0x2781a9])=>{const _0x3d85bb=_0x5934a9;try{await database_1[_0x3d85bb(0x1a4)][_0x3d85bb(0x1f2)][_0x3d85bb(0x1bd)]({'where':{'currency':_0x188118[_0x3d85bb(0x1a9)]()},'update':{'rate':_0x2781a9},'create':{'currency':_0x188118[_0x3d85bb(0x1a9)](),'rate':_0x2781a9}});}catch(_0x3bf51b){console[_0x3d85bb(0x1b0)](_0x3d85bb(0x1b7)+_0x188118+':',_0x3bf51b);}});await Promise[_0x5934a9(0x1e6)](_0x470d73),console[_0x5934a9(0x190)](_0x5934a9(0x1f4));}catch(_0x1f9218){console['error']('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x1f9218);throw _0x1f9218;}}async['getCurrencyRate'](_0x3ad5fb){const _0x11b7f1=a53_0x3f7cd9,_0x16d56c=_0x3ad5fb[_0x11b7f1(0x1a9)]();if(_0x16d56c===_0x11b7f1(0x1d2))return 0x1;try{const _0x84697f=await database_1[_0x11b7f1(0x1a4)][_0x11b7f1(0x1f2)][_0x11b7f1(0x1e4)]({'where':{'currency':_0x16d56c}});if(!_0x84697f)return console[_0x11b7f1(0x19d)](_0x11b7f1(0x196)+_0x3ad5fb+_0x11b7f1(0x193)),0x1;return _0x84697f[_0x11b7f1(0x19a)];}catch(_0x58c024){return console[_0x11b7f1(0x1b0)](_0x11b7f1(0x1d8)+_0x3ad5fb+':',_0x58c024),0x1;}}async[a53_0x3f7cd9(0x187)](_0x3c7815,_0x3220c4){const _0x549bba=a53_0x3f7cd9,_0x5bb94b=_0x3220c4[_0x549bba(0x1a9)]();if(_0x5bb94b===_0x549bba(0x1d2)){const _0x50deaf=_0x3c7815*(0x1+this[_0x549bba(0x194)]/0x64);return console[_0x549bba(0x190)](_0x549bba(0x1cf)+this[_0x549bba(0x194)]+'%\x20markup\x20to\x20'+_0x3c7815+_0x549bba(0x18f)+_0x50deaf['toFixed'](0x6)+'\x20USDT'),_0x50deaf;}try{const _0x15a95f=await this[_0x549bba(0x1e5)](_0x5bb94b),_0x53471e=_0x3c7815/_0x15a95f,_0x481138=_0x53471e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x549bba(0x190)](_0x549bba(0x192)+_0x3c7815+'\x20'+_0x3220c4['toUpperCase']()+_0x549bba(0x1e3)+_0x53471e[_0x549bba(0x1c9)](0x6)+_0x549bba(0x1b6)+this[_0x549bba(0x194)]+_0x549bba(0x1f0)+_0x481138['toFixed'](0x6)+_0x549bba(0x1d4)+_0x15a95f+')'),_0x481138;}catch(_0xc55b37){console[_0x549bba(0x1b0)](_0x549bba(0x19f)+_0x3c7815+'\x20'+_0x3220c4+_0x549bba(0x1bb),_0xc55b37);const _0x12c319=_0x3c7815*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x12c319;}}async[a53_0x3f7cd9(0x1a7)](_0x54f432){const _0x20d470=a53_0x3f7cd9;let _0x4d8399=0x0;for(const {amount:_0xec4d6b,currency:_0x1b0f3f}of _0x54f432){const _0x18f1e4=await this[_0x20d470(0x187)](_0xec4d6b,_0x1b0f3f);_0x4d8399+=_0x18f1e4;}return _0x4d8399;}async[a53_0x3f7cd9(0x1db)](){const _0x13864c=a53_0x3f7cd9;try{const _0x4137f8=await database_1[_0x13864c(0x1a4)][_0x13864c(0x1f2)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x24c782={'usdt':0x1};return _0x4137f8[_0x13864c(0x1d9)](_0x15309b=>{const _0x5d439a=_0x13864c;_0x24c782[_0x15309b[_0x5d439a(0x1f5)]]=_0x15309b[_0x5d439a(0x19a)];}),_0x24c782;}catch(_0x40e7b0){return console[_0x13864c(0x1b0)](_0x13864c(0x188),_0x40e7b0),{'usdt':0x1};}}async['getRatesStatus'](){const _0x5813a5=a53_0x3f7cd9;try{const [_0x319bcd,_0x1e8dd0,_0x56ef16]=await Promise[_0x5813a5(0x1f1)]([database_1[_0x5813a5(0x1a4)][_0x5813a5(0x1f2)][_0x5813a5(0x1e8)](),database_1[_0x5813a5(0x1a4)][_0x5813a5(0x1f2)][_0x5813a5(0x1a5)]({'orderBy':{'updatedAt':_0x5813a5(0x1b9)},'select':{'updatedAt':!![]}}),database_1[_0x5813a5(0x1a4)][_0x5813a5(0x1f2)][_0x5813a5(0x1a5)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x319bcd,'lastUpdated':_0x1e8dd0?.[_0x5813a5(0x1f8)]||null,'oldestRate':_0x56ef16?.[_0x5813a5(0x1f8)]||null,'markupPercentage':this[_0x5813a5(0x194)]};}catch(_0x329a88){return console[_0x5813a5(0x1b0)](_0x5813a5(0x1bc),_0x329a88),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5813a5(0x194)]};}}[a53_0x3f7cd9(0x1cb)](){return this['MARKUP_PERCENTAGE'];}}exports[a53_0x3f7cd9(0x186)]=CurrencyService,exports['currencyService']=new CurrencyService();