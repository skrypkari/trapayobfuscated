'use strict';const a58_0x319e14=a58_0x538e;(function(_0xb73ee8,_0x544d5d){const _0x304ad5=a58_0x538e,_0x11987c=_0xb73ee8();while(!![]){try{const _0x24891a=parseInt(_0x304ad5(0x111))/0x1+parseInt(_0x304ad5(0x17c))/0x2*(-parseInt(_0x304ad5(0x134))/0x3)+-parseInt(_0x304ad5(0x13f))/0x4+-parseInt(_0x304ad5(0x167))/0x5+-parseInt(_0x304ad5(0x10c))/0x6*(parseInt(_0x304ad5(0x163))/0x7)+-parseInt(_0x304ad5(0x14f))/0x8+parseInt(_0x304ad5(0x17a))/0x9;if(_0x24891a===_0x544d5d)break;else _0x11987c['push'](_0x11987c['shift']());}catch(_0xbedc00){_0x11987c['push'](_0x11987c['shift']());}}}(a58_0x3d01,0xcd151));var __importDefault=this&&this[a58_0x319e14(0x148)]||function(_0x18e8aa){const _0x3b7c0e=a58_0x319e14;return _0x18e8aa&&_0x18e8aa[_0x3b7c0e(0x171)]?_0x18e8aa:{'default':_0x18e8aa};};Object[a58_0x319e14(0x11b)](exports,'__esModule',{'value':!![]}),exports[a58_0x319e14(0x143)]=exports[a58_0x319e14(0x140)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0xe9c54a=a58_0x319e14;this[_0xe9c54a(0x16b)]='https://api.coingecko.com/api/v3/simple/price',this[_0xe9c54a(0x166)]=[_0xe9c54a(0x129),_0xe9c54a(0x13a),'ltc',_0xe9c54a(0x10b),_0xe9c54a(0x17d),_0xe9c54a(0x160),_0xe9c54a(0x15c),_0xe9c54a(0x159),_0xe9c54a(0x154),_0xe9c54a(0x11a),'yfi','usd',_0xe9c54a(0x14c),'ars','aud',_0xe9c54a(0x15d),'bhd','bmd',_0xe9c54a(0x152),'cad','chf',_0xe9c54a(0x15a),_0xe9c54a(0x114),'czk',_0xe9c54a(0x16d),_0xe9c54a(0x14d),_0xe9c54a(0x11f),'gel',_0xe9c54a(0x128),_0xe9c54a(0x115),_0xe9c54a(0x145),_0xe9c54a(0x13e),'inr',_0xe9c54a(0x177),_0xe9c54a(0x15e),_0xe9c54a(0x155),_0xe9c54a(0x117),'mmk','mxn',_0xe9c54a(0x109),'ngn','nok','nzd',_0xe9c54a(0x174),_0xe9c54a(0x173),_0xe9c54a(0x127),_0xe9c54a(0x118),_0xe9c54a(0x126),_0xe9c54a(0x161),'sgd','thb',_0xe9c54a(0x135),_0xe9c54a(0x13c),_0xe9c54a(0x12a),_0xe9c54a(0x17b),_0xe9c54a(0x133),_0xe9c54a(0x119),_0xe9c54a(0x15b),_0xe9c54a(0x138),_0xe9c54a(0x120),_0xe9c54a(0x125),'sats'],this[_0xe9c54a(0x12b)]=null,this[_0xe9c54a(0x131)]=-0x3,this[_0xe9c54a(0x13d)]();}[a58_0x319e14(0x13d)](){const _0x5118b7=a58_0x319e14;this[_0x5118b7(0x121)]()[_0x5118b7(0x113)](_0x562c5f=>{const _0x2f7301=_0x5118b7;console[_0x2f7301(0x116)](_0x2f7301(0x10e),_0x562c5f);}),this[_0x5118b7(0x12b)]=setInterval(async()=>{const _0x85dbd3=_0x5118b7;try{await this[_0x85dbd3(0x121)]();}catch(_0x40d93a){console[_0x85dbd3(0x116)](_0x85dbd3(0x139),_0x40d93a);}},0x3c*0x3c*0x3e8),console['log']('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a58_0x319e14(0x16e)](){const _0xc20340=a58_0x319e14;this['updateInterval']&&(clearInterval(this[_0xc20340(0x12b)]),this[_0xc20340(0x12b)]=null,console['log'](_0xc20340(0x12e)));}async[a58_0x319e14(0x121)](){const _0x400197=a58_0x319e14;try{console['log'](_0x400197(0x158));const _0x465f1a=this[_0x400197(0x166)][_0x400197(0x168)](','),_0x40a67d=this[_0x400197(0x16b)]+_0x400197(0x122)+_0x465f1a,_0x373376=await fetch(_0x40a67d,{'headers':{'Accept':_0x400197(0x144),'User-Agent':'Payment\x20System/1.0'}});if(!_0x373376['ok'])throw new Error(_0x400197(0x149)+_0x373376[_0x400197(0x147)]+'\x20'+_0x373376['statusText']);const _0x3efd25=await _0x373376['json']();if(!_0x3efd25['tether'])throw new Error(_0x400197(0x176));const _0x5c43f5=_0x3efd25['tether'];console[_0x400197(0x141)](_0x400197(0x179)+Object[_0x400197(0x162)](_0x5c43f5)[_0x400197(0x13b)]+_0x400197(0x110));const _0x2665c4=0x5,_0x5acc62=Object[_0x400197(0x14a)](_0x5c43f5);for(let _0x237386=0x0;_0x237386<_0x5acc62['length'];_0x237386+=_0x2665c4){const _0x2e1655=_0x5acc62[_0x400197(0x14e)](_0x237386,_0x237386+_0x2665c4),_0x507d16=_0x2e1655[_0x400197(0x16a)](async([_0x59c081,_0x386791])=>{const _0x463d09=_0x400197;try{await database_1[_0x463d09(0x11d)][_0x463d09(0x12f)][_0x463d09(0x15f)]({'where':{'currency':_0x59c081[_0x463d09(0x175)]()},'update':{'rate':_0x386791},'create':{'currency':_0x59c081['toLowerCase'](),'rate':_0x386791}});}catch(_0x34f900){console[_0x463d09(0x116)](_0x463d09(0x178)+_0x59c081+':',_0x34f900);}});await Promise[_0x400197(0x112)](_0x507d16);}console[_0x400197(0x141)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x36dea2){console['error'](_0x400197(0x12d),_0x36dea2);throw _0x36dea2;}}async[a58_0x319e14(0x14b)](_0x10d3bd){const _0x279af9=a58_0x319e14,_0x261d58=_0x10d3bd[_0x279af9(0x175)]();if(_0x261d58===_0x279af9(0x16c))return 0x1;try{const _0x3f6609=await database_1[_0x279af9(0x11d)]['currencyRate']['findUnique']({'where':{'currency':_0x261d58}});if(!_0x3f6609)return console[_0x279af9(0x169)](_0x279af9(0x146)+_0x10d3bd+_0x279af9(0x170)),0x1;return _0x3f6609[_0x279af9(0x157)];}catch(_0x470cfc){return console['error'](_0x279af9(0x137)+_0x10d3bd+':',_0x470cfc),0x1;}}async[a58_0x319e14(0x10d)](_0x3b4ead,_0x59daad){const _0xc90c2a=a58_0x319e14,_0x359327=_0x59daad['toLowerCase']();if(_0x359327===_0xc90c2a(0x16c)){const _0x70e3e1=_0x3b4ead*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0xc90c2a(0x141)](_0xc90c2a(0x124)+this[_0xc90c2a(0x131)]+'%\x20markup\x20to\x20'+_0x3b4ead+_0xc90c2a(0x11c)+_0x70e3e1[_0xc90c2a(0x172)](0x6)+_0xc90c2a(0x11e)),_0x70e3e1;}try{const _0x30c0e0=await this['getCurrencyRate'](_0x359327),_0x3e7cde=_0x3b4ead/_0x30c0e0,_0x51b08e=_0x3e7cde*(0x1+this[_0xc90c2a(0x131)]/0x64);return console[_0xc90c2a(0x141)](_0xc90c2a(0x132)+_0x3b4ead+'\x20'+_0x59daad[_0xc90c2a(0x164)]()+_0xc90c2a(0x10f)+_0x3e7cde['toFixed'](0x6)+_0xc90c2a(0x150)+this['MARKUP_PERCENTAGE']+_0xc90c2a(0x107)+_0x51b08e[_0xc90c2a(0x172)](0x6)+_0xc90c2a(0x153)+_0x30c0e0+')'),_0x51b08e;}catch(_0x1a86ce){console['error'](_0xc90c2a(0x151)+_0x3b4ead+'\x20'+_0x59daad+'\x20to\x20USDT:',_0x1a86ce);const _0x547245=_0x3b4ead*(0x1+this[_0xc90c2a(0x131)]/0x64);return _0x547245;}}async['convertMultipleToUSDT'](_0x33f0ba){let _0x108c62=0x0;for(const {amount:_0x131cb1,currency:_0x5ce30b}of _0x33f0ba){const _0x53ee69=await this['convertToUSDT'](_0x131cb1,_0x5ce30b);_0x108c62+=_0x53ee69;}return _0x108c62;}async['getAllRates'](){const _0x39b3d9=a58_0x319e14;try{const _0x100d28=await database_1[_0x39b3d9(0x11d)][_0x39b3d9(0x12f)][_0x39b3d9(0x10a)]({'select':{'currency':!![],'rate':!![]}}),_0x3217c4={'usdt':0x1};return _0x100d28['forEach'](_0x3b10c9=>{const _0x4ff62b=_0x39b3d9;_0x3217c4[_0x3b10c9[_0x4ff62b(0x165)]]=_0x3b10c9['rate'];}),_0x3217c4;}catch(_0x345dbf){return console[_0x39b3d9(0x116)]('Error\x20getting\x20all\x20rates:',_0x345dbf),{'usdt':0x1};}}async[a58_0x319e14(0x108)](){const _0x29c9d7=a58_0x319e14;try{const [_0x120a4a,_0x3ecfad,_0x576a04]=await Promise[_0x29c9d7(0x112)]([database_1['default']['currencyRate'][_0x29c9d7(0x130)](),database_1[_0x29c9d7(0x11d)]['currencyRate'][_0x29c9d7(0x142)]({'orderBy':{'updatedAt':_0x29c9d7(0x156)},'select':{'updatedAt':!![]}}),database_1[_0x29c9d7(0x11d)]['currencyRate'][_0x29c9d7(0x142)]({'orderBy':{'updatedAt':_0x29c9d7(0x16f)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x120a4a,'lastUpdated':_0x3ecfad?.[_0x29c9d7(0x136)]||null,'oldestRate':_0x576a04?.[_0x29c9d7(0x136)]||null,'markupPercentage':this[_0x29c9d7(0x131)]};}catch(_0x10c482){return console[_0x29c9d7(0x116)](_0x29c9d7(0x12c),_0x10c482),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a58_0x319e14(0x123)](){const _0x9a007e=a58_0x319e14;return this[_0x9a007e(0x131)];}}function a58_0x538e(_0x13cbca,_0x2775ee){_0x13cbca=_0x13cbca-0x107;const _0x3d01bc=a58_0x3d01();let _0x538ee8=_0x3d01bc[_0x13cbca];return _0x538ee8;}function a58_0x3d01(){const _0x13f449=['MARKUP_PERCENTAGE','üí±\x20Converted\x20','vnd','3MlipfR','try','updatedAt','Error\x20getting\x20rate\x20for\x20currency\x20','xag','Periodic\x20currency\x20rates\x20update\x20failed:','eth','length','twd','startPeriodicUpdates','ils','3375228mvvJXL','CurrencyService','log','findFirst','currencyService','application/json','idr','No\x20rate\x20found\x20for\x20currency:\x20','status','__importDefault','CoinGecko\x20API\x20error:\x20','entries','getCurrencyRate','aed','eur','slice','6155272OLYiHW','\x20USDT,\x20with\x20','Error\x20converting\x20','brl','\x20USDT\x20(rate:\x20','link','kwd','desc','rate','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','xlm','clp','xdr','xrp','bdt','krw','upsert','eos','sek','keys','13405kvVwUY','toUpperCase','currency','CURRENCIES','3580550OyFlAe','join','warn','map','COINGECKO_URL','usdt','dkk','stopPeriodicUpdates','asc',',\x20using\x201\x20as\x20fallback','__esModule','toFixed','pkr','php','toLowerCase','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','jpy','Failed\x20to\x20update\x20rate\x20for\x20','üìä\x20Received\x20rates\x20for\x20','42271623LYrSjT','vef','3339990IFrsed','bnb','%\x20markup\x20=\x20','getRatesStatus','myr','findMany','bch','510HFLcIq','convertToUSDT','Initial\x20currency\x20rates\x20update\x20failed:','\x20to\x20','\x20currencies','305266jMismw','all','catch','cny','huf','error','lkr','rub','zar','dot','defineProperty','\x20USDT\x20=\x20','default','\x20USDT','gbp','xau','updateCurrencyRates','?ids=tether&vs_currencies=','getMarkupPercentage','üí±\x20Applied\x20','bits','sar','pln','hkd','btc','uah','updateInterval','Error\x20getting\x20rates\x20status:','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','currencyRate','count'];a58_0x3d01=function(){return _0x13f449;};return a58_0x3d01();}exports[a58_0x319e14(0x140)]=CurrencyService,exports['currencyService']=new CurrencyService();