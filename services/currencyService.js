'use strict';const a38_0x25ccec=a38_0x3e75;(function(_0x2ba86a,_0x151c7e){const _0x74a836=a38_0x3e75,_0x24b29e=_0x2ba86a();while(!![]){try{const _0x47fdd2=-parseInt(_0x74a836(0xb1))/0x1+-parseInt(_0x74a836(0xd0))/0x2*(parseInt(_0x74a836(0x8e))/0x3)+parseInt(_0x74a836(0xcc))/0x4*(-parseInt(_0x74a836(0xa4))/0x5)+-parseInt(_0x74a836(0xd3))/0x6+-parseInt(_0x74a836(0x9a))/0x7+parseInt(_0x74a836(0xb4))/0x8*(-parseInt(_0x74a836(0xbe))/0x9)+-parseInt(_0x74a836(0x82))/0xa*(-parseInt(_0x74a836(0x93))/0xb);if(_0x47fdd2===_0x151c7e)break;else _0x24b29e['push'](_0x24b29e['shift']());}catch(_0x492a0d){_0x24b29e['push'](_0x24b29e['shift']());}}}(a38_0x30f1,0xd6380));function a38_0x3e75(_0x48ecc8,_0x4f9bc4){const _0x30f15f=a38_0x30f1();return a38_0x3e75=function(_0x3e7513,_0x49765c){_0x3e7513=_0x3e7513-0x78;let _0x58b9f4=_0x30f15f[_0x3e7513];return _0x58b9f4;},a38_0x3e75(_0x48ecc8,_0x4f9bc4);}function a38_0x30f1(){const _0x46198a=['forEach','Error\x20getting\x20rate\x20for\x20currency\x20','updateCurrencyRates','findMany','💱\x20Converted\x20','upsert','length','eos','error','❌\x20Failed\x20to\x20update\x20currency\x20rates:','rate','getRatesStatus','2145764XTndOF','usd','cny','findFirst','436182WazfZR','inr','\x20USDT','9866430DTFpHg','xlm','Periodic\x20currency\x20rates\x20update\x20failed:','\x20USDT\x20(rate:\x20','toFixed','nzd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20to\x20','convertMultipleToUSDT','jpy','CurrencyService','currencyRate','CoinGecko\x20API\x20error:\x20','bdt','convertToUSDT','findUnique','xdr','join','warn','updatedAt','hkd','sats','btc','\x20USDT\x20=\x20','lkr','thb','catch','sgd','MARKUP_PERCENTAGE','\x20to\x20USDT:','allSettled','krw','log','currencyService','dkk','270eDdNql','CURRENCIES','aed','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bits','default','bmd','💱\x20Applied\x20','keys','Failed\x20to\x20update\x20rate\x20for\x20','getMarkupPercentage','asc','18VABlsA','toLowerCase','statusText','dot','usdt','2576838MzREye','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','entries','czk','../config/database','Error\x20getting\x20rates\x20status:','status','8329657jmpsbJ','desc','getCurrencyRate','huf','toUpperCase','zar','pln','count','COINGECKO_URL','updateInterval','5iDgJdR','__esModule','📊\x20Received\x20rates\x20for\x20',',\x20using\x201\x20as\x20fallback','uah','sar','getAllRates','%\x20markup\x20to\x20','chf','myr','aud','vnd','\x20currencies','620047OOEyNA','vef','cad','64QsVNST','xrp','try','clp','gbp','idr','startPeriodicUpdates','xau','%\x20markup\x20=\x20','ngn','166653WXolOT','TesSoft\x20Payment\x20System/1.0'];a38_0x30f1=function(){return _0x46198a;};return a38_0x30f1();}var __importDefault=this&&this['__importDefault']||function(_0x3d4193){const _0x16aa6e=a38_0x3e75;return _0x3d4193&&_0x3d4193[_0x16aa6e(0xa5)]?_0x3d4193:{'default':_0x3d4193};};Object['defineProperty'](exports,a38_0x25ccec(0xa5),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x25ccec(0x97)));class CurrencyService{constructor(){const _0x171992=a38_0x25ccec;this[_0x171992(0xa2)]='https://api.coingecko.com/api/v3/simple/price',this[_0x171992(0x83)]=[_0x171992(0xe9),'eth','ltc','bch','bnb',_0x171992(0xc7),_0x171992(0xb5),_0x171992(0xd4),'link',_0x171992(0x91),'yfi',_0x171992(0xcd),_0x171992(0x84),'ars',_0x171992(0xae),_0x171992(0xe0),'bhd',_0x171992(0x88),'brl',_0x171992(0xb3),_0x171992(0xac),_0x171992(0xb7),_0x171992(0xce),_0x171992(0x96),_0x171992(0x81),'eur',_0x171992(0xb8),'gel',_0x171992(0xe7),_0x171992(0x9d),_0x171992(0xb9),'ils',_0x171992(0xd1),_0x171992(0xdc),_0x171992(0x7e),'kwd',_0x171992(0xeb),'mmk','mxn',_0x171992(0xad),_0x171992(0xbd),'nok',_0x171992(0xd8),'php','pkr',_0x171992(0xa0),'rub',_0x171992(0xa9),'sek',_0x171992(0x7a),_0x171992(0x78),_0x171992(0xb6),'twd',_0x171992(0xa8),_0x171992(0xb2),_0x171992(0xaf),_0x171992(0x9f),_0x171992(0xe3),'xag',_0x171992(0xbb),_0x171992(0x86),_0x171992(0xe8)],this['updateInterval']=null,this[_0x171992(0x7b)]=0x3,this[_0x171992(0xba)]();}[a38_0x25ccec(0xba)](){const _0xa5551d=a38_0x25ccec;this[_0xa5551d(0xc2)]()[_0xa5551d(0x79)](_0x3bf3f2=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x3bf3f2);}),this[_0xa5551d(0xa3)]=setInterval(async()=>{const _0x49f02a=_0xa5551d;try{await this[_0x49f02a(0xc2)]();}catch(_0x138746){console['error'](_0x49f02a(0xd5),_0x138746);}},0x3c*0x3c*0x3e8),console[_0xa5551d(0x7f)](_0xa5551d(0xd9));}['stopPeriodicUpdates'](){const _0x1a4c6a=a38_0x25ccec;this[_0x1a4c6a(0xa3)]&&(clearInterval(this[_0x1a4c6a(0xa3)]),this[_0x1a4c6a(0xa3)]=null,console[_0x1a4c6a(0x7f)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x1d842b=a38_0x25ccec;try{console[_0x1d842b(0x7f)](_0x1d842b(0x85));const _0x1b9258=this[_0x1d842b(0x83)][_0x1d842b(0xe4)](','),_0x1b2e85=this[_0x1d842b(0xa2)]+'?ids=tether&vs_currencies='+_0x1b9258,_0x412faf=await fetch(_0x1b2e85,{'headers':{'Accept':'application/json','User-Agent':_0x1d842b(0xbf)}});if(!_0x412faf['ok'])throw new Error(_0x1d842b(0xdf)+_0x412faf[_0x1d842b(0x99)]+'\x20'+_0x412faf[_0x1d842b(0x90)]);const _0x56fdc8=await _0x412faf['json']();if(!_0x56fdc8['tether'])throw new Error(_0x1d842b(0x94));const _0xa588ea=_0x56fdc8['tether'];console['log'](_0x1d842b(0xa6)+Object[_0x1d842b(0x8a)](_0xa588ea)[_0x1d842b(0xc6)]+_0x1d842b(0xb0));const _0x1d0d3b=Object[_0x1d842b(0x95)](_0xa588ea)['map'](async([_0x52c923,_0x39b396])=>{const _0x1d186b=_0x1d842b;try{await database_1[_0x1d186b(0x87)][_0x1d186b(0xde)][_0x1d186b(0xc5)]({'where':{'currency':_0x52c923[_0x1d186b(0x8f)]()},'update':{'rate':_0x39b396},'create':{'currency':_0x52c923[_0x1d186b(0x8f)](),'rate':_0x39b396}});}catch(_0x12d1dd){console['error'](_0x1d186b(0x8b)+_0x52c923+':',_0x12d1dd);}});await Promise[_0x1d842b(0x7d)](_0x1d0d3b),console[_0x1d842b(0x7f)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x2a3452){console[_0x1d842b(0xc8)](_0x1d842b(0xc9),_0x2a3452);throw _0x2a3452;}}async['getCurrencyRate'](_0x62e26c){const _0x15ea6d=a38_0x25ccec,_0x1df8f7=_0x62e26c[_0x15ea6d(0x8f)]();if(_0x1df8f7===_0x15ea6d(0x92))return 0x1;try{const _0x3b2501=await database_1[_0x15ea6d(0x87)][_0x15ea6d(0xde)][_0x15ea6d(0xe2)]({'where':{'currency':_0x1df8f7}});if(!_0x3b2501)return console[_0x15ea6d(0xe5)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x62e26c+_0x15ea6d(0xa7)),0x1;return _0x3b2501[_0x15ea6d(0xca)];}catch(_0x59d7fa){return console[_0x15ea6d(0xc8)](_0x15ea6d(0xc1)+_0x62e26c+':',_0x59d7fa),0x1;}}async[a38_0x25ccec(0xe1)](_0x57c78d,_0x1ef453){const _0x3abab8=a38_0x25ccec,_0x589f35=_0x1ef453[_0x3abab8(0x8f)]();if(_0x589f35==='usdt'){const _0x7b96eb=_0x57c78d*(0x1+this[_0x3abab8(0x7b)]/0x64);return console[_0x3abab8(0x7f)](_0x3abab8(0x89)+this[_0x3abab8(0x7b)]+_0x3abab8(0xab)+_0x57c78d+_0x3abab8(0xea)+_0x7b96eb[_0x3abab8(0xd7)](0x6)+_0x3abab8(0xd2)),_0x7b96eb;}try{const _0x458d37=await this[_0x3abab8(0x9c)](_0x589f35),_0x283ff1=_0x57c78d/_0x458d37,_0x288f8=_0x283ff1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3abab8(0x7f)](_0x3abab8(0xc4)+_0x57c78d+'\x20'+_0x1ef453[_0x3abab8(0x9e)]()+_0x3abab8(0xda)+_0x283ff1[_0x3abab8(0xd7)](0x6)+'\x20USDT,\x20with\x20'+this[_0x3abab8(0x7b)]+_0x3abab8(0xbc)+_0x288f8[_0x3abab8(0xd7)](0x6)+_0x3abab8(0xd6)+_0x458d37+')'),_0x288f8;}catch(_0x444836){console[_0x3abab8(0xc8)]('Error\x20converting\x20'+_0x57c78d+'\x20'+_0x1ef453+_0x3abab8(0x7c),_0x444836);const _0x1aa690=_0x57c78d*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x1aa690;}}async[a38_0x25ccec(0xdb)](_0x217d5a){let _0x43ecbd=0x0;for(const {amount:_0x5b9bea,currency:_0x5aa071}of _0x217d5a){const _0x961fae=await this['convertToUSDT'](_0x5b9bea,_0x5aa071);_0x43ecbd+=_0x961fae;}return _0x43ecbd;}async[a38_0x25ccec(0xaa)](){const _0x51bd36=a38_0x25ccec;try{const _0x5afea0=await database_1['default'][_0x51bd36(0xde)][_0x51bd36(0xc3)]({'select':{'currency':!![],'rate':!![]}}),_0x49e2fe={'usdt':0x1};return _0x5afea0[_0x51bd36(0xc0)](_0x5b29ba=>{const _0x5861d0=_0x51bd36;_0x49e2fe[_0x5b29ba['currency']]=_0x5b29ba[_0x5861d0(0xca)];}),_0x49e2fe;}catch(_0x1ea783){return console['error']('Error\x20getting\x20all\x20rates:',_0x1ea783),{'usdt':0x1};}}async[a38_0x25ccec(0xcb)](){const _0x5d5dba=a38_0x25ccec;try{const [_0x3f63c8,_0x15a6f4,_0xab16d7]=await Promise['all']([database_1[_0x5d5dba(0x87)][_0x5d5dba(0xde)][_0x5d5dba(0xa1)](),database_1[_0x5d5dba(0x87)]['currencyRate'][_0x5d5dba(0xcf)]({'orderBy':{'updatedAt':_0x5d5dba(0x9b)},'select':{'updatedAt':!![]}}),database_1[_0x5d5dba(0x87)][_0x5d5dba(0xde)][_0x5d5dba(0xcf)]({'orderBy':{'updatedAt':_0x5d5dba(0x8d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f63c8,'lastUpdated':_0x15a6f4?.['updatedAt']||null,'oldestRate':_0xab16d7?.[_0x5d5dba(0xe6)]||null,'markupPercentage':this[_0x5d5dba(0x7b)]};}catch(_0x432b35){return console[_0x5d5dba(0xc8)](_0x5d5dba(0x98),_0x432b35),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5d5dba(0x7b)]};}}[a38_0x25ccec(0x8c)](){const _0x5c6981=a38_0x25ccec;return this[_0x5c6981(0x7b)];}}exports[a38_0x25ccec(0xdd)]=CurrencyService,exports[a38_0x25ccec(0x80)]=new CurrencyService();