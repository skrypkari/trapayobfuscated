'use strict';const a58_0x22e522=a58_0x5485;(function(_0xc6bfc9,_0x40a572){const _0x1fe159=a58_0x5485,_0x274c78=_0xc6bfc9();while(!![]){try{const _0x213677=-parseInt(_0x1fe159(0x139))/0x1+parseInt(_0x1fe159(0xf8))/0x2+parseInt(_0x1fe159(0x131))/0x3+parseInt(_0x1fe159(0x142))/0x4+-parseInt(_0x1fe159(0x136))/0x5*(parseInt(_0x1fe159(0x124))/0x6)+-parseInt(_0x1fe159(0xf1))/0x7*(-parseInt(_0x1fe159(0x110))/0x8)+parseInt(_0x1fe159(0x11e))/0x9;if(_0x213677===_0x40a572)break;else _0x274c78['push'](_0x274c78['shift']());}catch(_0x415782){_0x274c78['push'](_0x274c78['shift']());}}}(a58_0x44d7,0xa6398));var __importDefault=this&&this[a58_0x22e522(0x13c)]||function(_0x3e7a66){return _0x3e7a66&&_0x3e7a66['__esModule']?_0x3e7a66:{'default':_0x3e7a66};};Object['defineProperty'](exports,a58_0x22e522(0x10e),{'value':!![]}),exports['currencyService']=exports[a58_0x22e522(0x118)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x4eb471=a58_0x22e522;this[_0x4eb471(0x10a)]=_0x4eb471(0xf3),this[_0x4eb471(0x106)]=['btc','eth',_0x4eb471(0x100),_0x4eb471(0x13b),_0x4eb471(0x12d),_0x4eb471(0x129),_0x4eb471(0x103),'xlm',_0x4eb471(0xfe),_0x4eb471(0x14c),_0x4eb471(0xff),_0x4eb471(0xfa),_0x4eb471(0x147),_0x4eb471(0x15b),_0x4eb471(0x104),_0x4eb471(0xf7),'bhd','bmd',_0x4eb471(0x114),_0x4eb471(0x161),_0x4eb471(0x15d),'clp',_0x4eb471(0x11b),_0x4eb471(0x15f),'dkk','eur',_0x4eb471(0x15a),_0x4eb471(0x12a),'hkd',_0x4eb471(0x113),_0x4eb471(0x133),'ils','inr',_0x4eb471(0xeb),_0x4eb471(0xf2),_0x4eb471(0x14a),_0x4eb471(0x10f),'mmk','mxn',_0x4eb471(0x101),_0x4eb471(0x128),_0x4eb471(0x10b),_0x4eb471(0xf5),_0x4eb471(0x138),_0x4eb471(0x109),_0x4eb471(0x14f),_0x4eb471(0x121),_0x4eb471(0x122),_0x4eb471(0x12c),_0x4eb471(0x102),_0x4eb471(0x13f),_0x4eb471(0x158),_0x4eb471(0x11d),_0x4eb471(0xf9),'vef','vnd',_0x4eb471(0x13e),'xdr',_0x4eb471(0x159),_0x4eb471(0xfd),_0x4eb471(0x11a),_0x4eb471(0x11f)],this[_0x4eb471(0x155)]=null,this[_0x4eb471(0x132)]=-0x3,this[_0x4eb471(0x135)]();}[a58_0x22e522(0x135)](){const _0x934514=a58_0x22e522;this['updateCurrencyRates']()[_0x934514(0x157)](_0x5ea2ab=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x5ea2ab);}),this[_0x934514(0x155)]=setInterval(async()=>{const _0x5d8e80=_0x934514;try{await this[_0x5d8e80(0x14b)]();}catch(_0x26ca2a){console['error'](_0x5d8e80(0x13a),_0x26ca2a);}},0x3c*0x3c*0x3e8),console[_0x934514(0x149)](_0x934514(0x112));}[a58_0x22e522(0x108)](){const _0x2abae8=a58_0x22e522;this[_0x2abae8(0x155)]&&(clearInterval(this['updateInterval']),this[_0x2abae8(0x155)]=null,console[_0x2abae8(0x149)](_0x2abae8(0x150)));}async['updateCurrencyRates'](){const _0x34f7e2=a58_0x22e522;try{console['log'](_0x34f7e2(0x130));const _0x460f24=this[_0x34f7e2(0x106)]['join'](','),_0x541c5d=this[_0x34f7e2(0x10a)]+'?ids=tether&vs_currencies='+_0x460f24,_0x55b49c=await fetch(_0x541c5d,{'headers':{'Accept':_0x34f7e2(0x15c),'User-Agent':_0x34f7e2(0x117)}});if(!_0x55b49c['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x55b49c[_0x34f7e2(0x10c)]+'\x20'+_0x55b49c['statusText']);const _0x547dec=await _0x55b49c['json']();if(!_0x547dec['tether'])throw new Error(_0x34f7e2(0x12f));const _0x16edaa=_0x547dec[_0x34f7e2(0x115)];console[_0x34f7e2(0x149)](_0x34f7e2(0x12b)+Object[_0x34f7e2(0x127)](_0x16edaa)['length']+_0x34f7e2(0x13d));const _0x1a4564=0x5,_0x51bf26=Object[_0x34f7e2(0x10d)](_0x16edaa);for(let _0x4edc81=0x0;_0x4edc81<_0x51bf26[_0x34f7e2(0xfc)];_0x4edc81+=_0x1a4564){const _0x5d6204=_0x51bf26['slice'](_0x4edc81,_0x4edc81+_0x1a4564),_0x54840f=_0x5d6204[_0x34f7e2(0x140)](async([_0x19f8f7,_0x709d])=>{const _0x36973e=_0x34f7e2;try{await database_1[_0x36973e(0x146)][_0x36973e(0x153)]['upsert']({'where':{'currency':_0x19f8f7[_0x36973e(0x12e)]()},'update':{'rate':_0x709d},'create':{'currency':_0x19f8f7[_0x36973e(0x12e)](),'rate':_0x709d}});}catch(_0x2c3927){console[_0x36973e(0x105)](_0x36973e(0xfb)+_0x19f8f7+':',_0x2c3927);}});await Promise[_0x34f7e2(0x116)](_0x54840f);}console[_0x34f7e2(0x149)](_0x34f7e2(0xf6));}catch(_0x214b95){console[_0x34f7e2(0x105)](_0x34f7e2(0x107),_0x214b95);throw _0x214b95;}}async[a58_0x22e522(0xf4)](_0x31ee0b){const _0x1db218=a58_0x22e522,_0xf450c9=_0x31ee0b[_0x1db218(0x12e)]();if(_0xf450c9===_0x1db218(0x141))return 0x1;try{const _0x56a65b=await database_1['default'][_0x1db218(0x153)][_0x1db218(0x111)]({'where':{'currency':_0xf450c9}});if(!_0x56a65b)return console['warn'](_0x1db218(0x156)+_0x31ee0b+_0x1db218(0xf0)),0x1;return _0x56a65b[_0x1db218(0xed)];}catch(_0x1fc636){return console[_0x1db218(0x105)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x31ee0b+':',_0x1fc636),0x1;}}async[a58_0x22e522(0x152)](_0x420713,_0x30b5ff){const _0x2b679e=a58_0x22e522,_0x52da37=_0x30b5ff[_0x2b679e(0x12e)]();if(_0x52da37===_0x2b679e(0x141)){const _0x1dcb45=_0x420713*(0x1+this[_0x2b679e(0x132)]/0x64);return console['log']('üí±\x20Applied\x20'+this[_0x2b679e(0x132)]+_0x2b679e(0x160)+_0x420713+_0x2b679e(0x134)+_0x1dcb45[_0x2b679e(0x14d)](0x6)+_0x2b679e(0x148)),_0x1dcb45;}try{const _0x781226=await this[_0x2b679e(0xf4)](_0x52da37),_0x30483a=_0x420713/_0x781226,_0x396bbd=_0x30483a*(0x1+this[_0x2b679e(0x132)]/0x64);return console[_0x2b679e(0x149)]('üí±\x20Converted\x20'+_0x420713+'\x20'+_0x30b5ff[_0x2b679e(0x125)]()+_0x2b679e(0x14e)+_0x30483a['toFixed'](0x6)+_0x2b679e(0x145)+this[_0x2b679e(0x132)]+'%\x20markup\x20=\x20'+_0x396bbd['toFixed'](0x6)+_0x2b679e(0x11c)+_0x781226+')'),_0x396bbd;}catch(_0x25375c){console['error'](_0x2b679e(0x123)+_0x420713+'\x20'+_0x30b5ff+_0x2b679e(0x126),_0x25375c);const _0x504b19=_0x420713*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x504b19;}}async[a58_0x22e522(0xee)](_0x231f31){const _0x326a9b=a58_0x22e522;let _0x258822=0x0;for(const {amount:_0x4997b7,currency:_0x4678b7}of _0x231f31){const _0x21c434=await this[_0x326a9b(0x152)](_0x4997b7,_0x4678b7);_0x258822+=_0x21c434;}return _0x258822;}async['getAllRates'](){const _0x4ebd2e=a58_0x22e522;try{const _0x4618c6=await database_1[_0x4ebd2e(0x146)][_0x4ebd2e(0x153)][_0x4ebd2e(0x120)]({'select':{'currency':!![],'rate':!![]}}),_0x5d5d30={'usdt':0x1};return _0x4618c6['forEach'](_0x396301=>{const _0x20303c=_0x4ebd2e;_0x5d5d30[_0x396301[_0x20303c(0xef)]]=_0x396301[_0x20303c(0xed)];}),_0x5d5d30;}catch(_0xb5f709){return console[_0x4ebd2e(0x105)]('Error\x20getting\x20all\x20rates:',_0xb5f709),{'usdt':0x1};}}async[a58_0x22e522(0x137)](){const _0xf98c89=a58_0x22e522;try{const [_0x10b70e,_0x8c96f7,_0x40eda2]=await Promise[_0xf98c89(0x116)]([database_1[_0xf98c89(0x146)][_0xf98c89(0x153)][_0xf98c89(0x119)](),database_1[_0xf98c89(0x146)][_0xf98c89(0x153)][_0xf98c89(0x154)]({'orderBy':{'updatedAt':_0xf98c89(0x15e)},'select':{'updatedAt':!![]}}),database_1[_0xf98c89(0x146)][_0xf98c89(0x153)][_0xf98c89(0x154)]({'orderBy':{'updatedAt':_0xf98c89(0x143)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x10b70e,'lastUpdated':_0x8c96f7?.[_0xf98c89(0xec)]||null,'oldestRate':_0x40eda2?.[_0xf98c89(0xec)]||null,'markupPercentage':this[_0xf98c89(0x132)]};}catch(_0x4b6002){return console['error']('Error\x20getting\x20rates\x20status:',_0x4b6002),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a58_0x22e522(0x144)](){const _0x4d4f14=a58_0x22e522;return this[_0x4d4f14(0x132)];}}function a58_0x5485(_0x6a7511,_0x5b084d){_0x6a7511=_0x6a7511-0xeb;const _0x44d7d2=a58_0x44d7();let _0x54855b=_0x44d7d2[_0x6a7511];return _0x54855b;}function a58_0x44d7(){const _0x31ec8e=['2454ZmuEoN','toUpperCase','\x20to\x20USDT:','keys','ngn','eos','gel','üìä\x20Received\x20rates\x20for\x20','sek','bnb','toLowerCase','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','2772399EOFGiN','MARKUP_PERCENTAGE','idr','\x20USDT\x20=\x20','startPeriodicUpdates','16015TziQGK','getRatesStatus','php','1051121TGCWXh','Periodic\x20currency\x20rates\x20update\x20failed:','bch','__importDefault','\x20currencies','zar','thb','map','usdt','756664OBJAau','asc','getMarkupPercentage','\x20USDT,\x20with\x20','default','aed','\x20USDT','log','kwd','updateCurrencyRates','dot','toFixed','\x20to\x20','pln','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','currencyService','convertToUSDT','currencyRate','findFirst','updateInterval','No\x20rate\x20found\x20for\x20currency:\x20','catch','try','xag','gbp','ars','application/json','chf','desc','czk','%\x20markup\x20to\x20','cad','jpy','updatedAt','rate','convertMultipleToUSDT','currency',',\x20using\x201\x20as\x20fallback','7777xSWkQN','krw','https://api.coingecko.com/api/v3/simple/price','getCurrencyRate','nzd','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','bdt','1948368VpbIIf','uah','usd','Failed\x20to\x20update\x20rate\x20for\x20','length','xau','link','yfi','ltc','myr','sgd','xrp','aud','error','CURRENCIES','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','stopPeriodicUpdates','pkr','COINGECKO_URL','nok','status','entries','__esModule','lkr','536QoRqrV','findUnique','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','huf','brl','tether','all','Payment\x20System/1.0','CurrencyService','count','bits','cny','\x20USDT\x20(rate:\x20','twd','7920756vpqdij','sats','findMany','rub','sar','Error\x20converting\x20'];a58_0x44d7=function(){return _0x31ec8e;};return a58_0x44d7();}exports[a58_0x22e522(0x118)]=CurrencyService,exports[a58_0x22e522(0x151)]=new CurrencyService();