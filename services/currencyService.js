'use strict';const a38_0x5b01e9=a38_0x3a96;(function(_0x4378e2,_0x1e5769){const _0x1b5b37=a38_0x3a96,_0x33afe6=_0x4378e2();while(!![]){try{const _0x282b18=parseInt(_0x1b5b37(0xf4))/0x1*(-parseInt(_0x1b5b37(0xef))/0x2)+parseInt(_0x1b5b37(0xf9))/0x3+-parseInt(_0x1b5b37(0x101))/0x4+parseInt(_0x1b5b37(0x11c))/0x5*(-parseInt(_0x1b5b37(0x10f))/0x6)+-parseInt(_0x1b5b37(0x102))/0x7+parseInt(_0x1b5b37(0x11f))/0x8+parseInt(_0x1b5b37(0x142))/0x9;if(_0x282b18===_0x1e5769)break;else _0x33afe6['push'](_0x33afe6['shift']());}catch(_0x37d175){_0x33afe6['push'](_0x33afe6['shift']());}}}(a38_0x1355,0x473d6));var __importDefault=this&&this[a38_0x5b01e9(0x10e)]||function(_0x5a3f2b){const _0x55387f=a38_0x5b01e9;return _0x5a3f2b&&_0x5a3f2b[_0x55387f(0x12e)]?_0x5a3f2b:{'default':_0x5a3f2b};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x5b01e9(0x154)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x275067=a38_0x5b01e9;this[_0x275067(0x143)]=_0x275067(0x11b),this[_0x275067(0x12c)]=[_0x275067(0x106),_0x275067(0xfb),_0x275067(0xe0),'bch',_0x275067(0x13c),_0x275067(0x12b),_0x275067(0x138),'xlm',_0x275067(0x157),_0x275067(0x10c),'yfi',_0x275067(0xe1),_0x275067(0xfc),_0x275067(0x144),'aud',_0x275067(0x13e),_0x275067(0x100),_0x275067(0xe3),_0x275067(0x125),_0x275067(0x145),'chf',_0x275067(0x14c),_0x275067(0x124),'czk','dkk',_0x275067(0x127),_0x275067(0x110),'gel',_0x275067(0x10a),_0x275067(0x148),_0x275067(0xfe),'ils',_0x275067(0x131),_0x275067(0xe4),'krw','kwd',_0x275067(0xf3),_0x275067(0xeb),_0x275067(0x140),_0x275067(0x103),_0x275067(0x12a),'nok',_0x275067(0xde),_0x275067(0x14a),_0x275067(0x151),_0x275067(0x117),_0x275067(0x14f),_0x275067(0xf7),_0x275067(0xe6),_0x275067(0xed),_0x275067(0x118),_0x275067(0x155),_0x275067(0x126),_0x275067(0x139),_0x275067(0x137),_0x275067(0x10b),'zar',_0x275067(0x105),_0x275067(0xe7),_0x275067(0x13f),_0x275067(0x111),_0x275067(0x153)],this[_0x275067(0x119)]=null,this[_0x275067(0x136)]=0x3,this[_0x275067(0xe9)]();}[a38_0x5b01e9(0xe9)](){const _0x5ac6ca=a38_0x5b01e9;this['updateCurrencyRates']()[_0x5ac6ca(0xec)](_0x34dc21=>{const _0x406216=_0x5ac6ca;console[_0x406216(0x11e)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x34dc21);}),this[_0x5ac6ca(0x119)]=setInterval(async()=>{const _0x50bba1=_0x5ac6ca;try{await this[_0x50bba1(0xf5)]();}catch(_0x10d2cc){console[_0x50bba1(0x11e)](_0x50bba1(0xf6),_0x10d2cc);}},0x3c*0x3c*0x3e8),console[_0x5ac6ca(0x129)](_0x5ac6ca(0x12d));}[a38_0x5b01e9(0x133)](){const _0x2d9e82=a38_0x5b01e9;this[_0x2d9e82(0x119)]&&(clearInterval(this['updateInterval']),this[_0x2d9e82(0x119)]=null,console['log'](_0x2d9e82(0xea)));}async['updateCurrencyRates'](){const _0x5ba5ca=a38_0x5b01e9;try{console['log']('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x40e3ce=this[_0x5ba5ca(0x12c)][_0x5ba5ca(0x13d)](','),_0x31b1a1=this[_0x5ba5ca(0x143)]+_0x5ba5ca(0x130)+_0x40e3ce,_0x861301=await fetch(_0x31b1a1,{'headers':{'Accept':'application/json','User-Agent':_0x5ba5ca(0xee)}});if(!_0x861301['ok'])throw new Error(_0x5ba5ca(0x128)+_0x861301[_0x5ba5ca(0x10d)]+'\x20'+_0x861301[_0x5ba5ca(0x14d)]);const _0xc3ae59=await _0x861301[_0x5ba5ca(0x147)]();if(!_0xc3ae59[_0x5ba5ca(0x11d)])throw new Error(_0x5ba5ca(0xf0));const _0xcc38aa=_0xc3ae59['tether'];console[_0x5ba5ca(0x129)](_0x5ba5ca(0x104)+Object[_0x5ba5ca(0x120)](_0xcc38aa)[_0x5ba5ca(0x149)]+_0x5ba5ca(0xfd));const _0x5f183b=Object[_0x5ba5ca(0x152)](_0xcc38aa)[_0x5ba5ca(0x116)](async([_0x101983,_0x2fd6de])=>{const _0x45b920=_0x5ba5ca;try{await database_1['default'][_0x45b920(0x107)]['upsert']({'where':{'currency':_0x101983[_0x45b920(0x121)]()},'update':{'rate':_0x2fd6de},'create':{'currency':_0x101983['toLowerCase'](),'rate':_0x2fd6de}});}catch(_0x1cb6a3){console[_0x45b920(0x11e)](_0x45b920(0x132)+_0x101983+':',_0x1cb6a3);}});await Promise[_0x5ba5ca(0xe2)](_0x5f183b),console[_0x5ba5ca(0x129)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4753b5){console[_0x5ba5ca(0x11e)](_0x5ba5ca(0x134),_0x4753b5);throw _0x4753b5;}}async['getCurrencyRate'](_0x1b3514){const _0x12f4f8=a38_0x5b01e9,_0x37d6fd=_0x1b3514[_0x12f4f8(0x121)]();if(_0x37d6fd===_0x12f4f8(0x14b))return 0x1;try{const _0x4265f4=await database_1['default']['currencyRate'][_0x12f4f8(0x112)]({'where':{'currency':_0x37d6fd}});if(!_0x4265f4)return console[_0x12f4f8(0x13b)](_0x12f4f8(0x14e)+_0x1b3514+_0x12f4f8(0xe5)),0x1;return _0x4265f4['rate'];}catch(_0x2b340){return console[_0x12f4f8(0x11e)](_0x12f4f8(0xff)+_0x1b3514+':',_0x2b340),0x1;}}async[a38_0x5b01e9(0xdf)](_0x27a7b0,_0x117d8c){const _0x5a5ba1=a38_0x5b01e9,_0x2bad0a=_0x117d8c[_0x5a5ba1(0x121)]();if(_0x2bad0a===_0x5a5ba1(0x14b)){const _0x3426ca=_0x27a7b0*(0x1+this[_0x5a5ba1(0x136)]/0x64);return console[_0x5a5ba1(0x129)](_0x5a5ba1(0x13a)+this[_0x5a5ba1(0x136)]+'%\x20markup\x20to\x20'+_0x27a7b0+_0x5a5ba1(0x114)+_0x3426ca[_0x5a5ba1(0x156)](0x6)+'\x20USDT'),_0x3426ca;}try{const _0x144ee1=await this[_0x5a5ba1(0x146)](_0x2bad0a),_0x29222b=_0x27a7b0/_0x144ee1,_0x522b41=_0x29222b*(0x1+this[_0x5a5ba1(0x136)]/0x64);return console['log']('üí±\x20Converted\x20'+_0x27a7b0+'\x20'+_0x117d8c[_0x5a5ba1(0x11a)]()+'\x20to\x20'+_0x29222b['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x5a5ba1(0x136)]+'%\x20markup\x20=\x20'+_0x522b41[_0x5a5ba1(0x156)](0x6)+_0x5a5ba1(0xfa)+_0x144ee1+')'),_0x522b41;}catch(_0x148952){console[_0x5a5ba1(0x11e)](_0x5a5ba1(0xf8)+_0x27a7b0+'\x20'+_0x117d8c+_0x5a5ba1(0x123),_0x148952);const _0x162d43=_0x27a7b0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x162d43;}}async['convertMultipleToUSDT'](_0x33f95d){let _0x4a6266=0x0;for(const {amount:_0x3f2734,currency:_0x2b5e0a}of _0x33f95d){const _0x33372f=await this['convertToUSDT'](_0x3f2734,_0x2b5e0a);_0x4a6266+=_0x33372f;}return _0x4a6266;}async['getAllRates'](){const _0x5a158e=a38_0x5b01e9;try{const _0x1c9828=await database_1[_0x5a158e(0x12f)][_0x5a158e(0x107)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x3669bf={'usdt':0x1};return _0x1c9828['forEach'](_0xca6392=>{const _0x3ebccb=_0x5a158e;_0x3669bf[_0xca6392[_0x3ebccb(0x108)]]=_0xca6392[_0x3ebccb(0xf2)];}),_0x3669bf;}catch(_0x2605f2){return console[_0x5a158e(0x11e)](_0x5a158e(0xe8),_0x2605f2),{'usdt':0x1};}}async[a38_0x5b01e9(0xf1)](){const _0xc5d231=a38_0x5b01e9;try{const [_0x1fbcf1,_0x514b59,_0x3eb084]=await Promise['all']([database_1[_0xc5d231(0x12f)][_0xc5d231(0x107)][_0xc5d231(0x115)](),database_1['default'][_0xc5d231(0x107)][_0xc5d231(0x135)]({'orderBy':{'updatedAt':_0xc5d231(0x113)},'select':{'updatedAt':!![]}}),database_1[_0xc5d231(0x12f)][_0xc5d231(0x107)][_0xc5d231(0x135)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1fbcf1,'lastUpdated':_0x514b59?.[_0xc5d231(0x150)]||null,'oldestRate':_0x3eb084?.[_0xc5d231(0x150)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x24922d){return console[_0xc5d231(0x11e)](_0xc5d231(0x141),_0x24922d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xc5d231(0x136)]};}}[a38_0x5b01e9(0x122)](){return this['MARKUP_PERCENTAGE'];}}function a38_0x3a96(_0x1408bc,_0x1e416c){const _0x1355d6=a38_0x1355();return a38_0x3a96=function(_0x3a9614,_0x30b8f8){_0x3a9614=_0x3a9614-0xde;let _0x59d631=_0x1355d6[_0x3a9614];return _0x59d631;},a38_0x3a96(_0x1408bc,_0x1e416c);}function a38_0x1355(){const _0x6d66ee=['üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','mmk','catch','sgd','TesSoft\x20Payment\x20System/1.0','2WzxcNg','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','getRatesStatus','rate','lkr','316700TsfVSm','updateCurrencyRates','Periodic\x20currency\x20rates\x20update\x20failed:','sar','Error\x20converting\x20','738954NvWBHB','\x20USDT\x20(rate:\x20','eth','aed','\x20currencies','idr','Error\x20getting\x20rate\x20for\x20currency\x20','bhd','1022088NvzXUY','1683696VUHiVX','myr','üìä\x20Received\x20rates\x20for\x20','xdr','btc','currencyRate','currency','CurrencyService','hkd','vnd','dot','status','__importDefault','1926WzYwWM','gbp','bits','findUnique','desc','\x20USDT\x20=\x20','count','map','pln','thb','updateInterval','toUpperCase','https://api.coingecko.com/api/v3/simple/price','6065EGvHUg','tether','error','4499200QawwCL','keys','toLowerCase','getMarkupPercentage','\x20to\x20USDT:','cny','brl','twd','eur','CoinGecko\x20API\x20error:\x20','log','ngn','eos','CURRENCIES','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','__esModule','default','?ids=tether&vs_currencies=','inr','Failed\x20to\x20update\x20rate\x20for\x20','stopPeriodicUpdates','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','findFirst','MARKUP_PERCENTAGE','vef','xrp','uah','üí±\x20Applied\x20','warn','bnb','join','bdt','xau','mxn','Error\x20getting\x20rates\x20status:','6166827onztad','COINGECKO_URL','ars','cad','getCurrencyRate','json','huf','length','php','usdt','clp','statusText','No\x20rate\x20found\x20for\x20currency:\x20','rub','updatedAt','pkr','entries','sats','currencyService','try','toFixed','link','nzd','convertToUSDT','ltc','usd','allSettled','bmd','jpy',',\x20using\x201\x20as\x20fallback','sek','xag','Error\x20getting\x20all\x20rates:','startPeriodicUpdates'];a38_0x1355=function(){return _0x6d66ee;};return a38_0x1355();}exports[a38_0x5b01e9(0x109)]=CurrencyService,exports['currencyService']=new CurrencyService();