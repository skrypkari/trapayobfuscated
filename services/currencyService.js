'use strict';function a36_0x5aa3(_0x2a83fe,_0x4978e9){const _0x527d3a=a36_0x527d();return a36_0x5aa3=function(_0x5aa351,_0x5b86fe){_0x5aa351=_0x5aa351-0xd3;let _0x113450=_0x527d3a[_0x5aa351];return _0x113450;},a36_0x5aa3(_0x2a83fe,_0x4978e9);}const a36_0x476cc7=a36_0x5aa3;(function(_0x133ce5,_0x2882a9){const _0x2e6fca=a36_0x5aa3,_0x25d0ce=_0x133ce5();while(!![]){try{const _0xf59918=parseInt(_0x2e6fca(0xdd))/0x1*(parseInt(_0x2e6fca(0x11d))/0x2)+parseInt(_0x2e6fca(0x101))/0x3+parseInt(_0x2e6fca(0x115))/0x4*(-parseInt(_0x2e6fca(0x138))/0x5)+parseInt(_0x2e6fca(0xe6))/0x6*(-parseInt(_0x2e6fca(0xfd))/0x7)+parseInt(_0x2e6fca(0x12a))/0x8+parseInt(_0x2e6fca(0xf1))/0x9*(-parseInt(_0x2e6fca(0xf3))/0xa)+-parseInt(_0x2e6fca(0x128))/0xb*(-parseInt(_0x2e6fca(0x129))/0xc);if(_0xf59918===_0x2882a9)break;else _0x25d0ce['push'](_0x25d0ce['shift']());}catch(_0x55c483){_0x25d0ce['push'](_0x25d0ce['shift']());}}}(a36_0x527d,0xe8c2b));var __importDefault=this&&this[a36_0x476cc7(0x13b)]||function(_0x69c0ea){const _0x39067=a36_0x476cc7;return _0x69c0ea&&_0x69c0ea[_0x39067(0x11f)]?_0x69c0ea:{'default':_0x69c0ea};};Object['defineProperty'](exports,a36_0x476cc7(0x11f),{'value':!![]}),exports[a36_0x476cc7(0x103)]=exports[a36_0x476cc7(0x107)]=void 0x0;const database_1=__importDefault(require(a36_0x476cc7(0xeb)));class CurrencyService{constructor(){const _0x34e05e=a36_0x476cc7;this[_0x34e05e(0x106)]=_0x34e05e(0x119),this[_0x34e05e(0x137)]=[_0x34e05e(0xe9),'eth',_0x34e05e(0x116),'bch',_0x34e05e(0x11e),_0x34e05e(0xe1),_0x34e05e(0x139),_0x34e05e(0x134),_0x34e05e(0xec),_0x34e05e(0x133),_0x34e05e(0x127),_0x34e05e(0x131),_0x34e05e(0x12f),'ars',_0x34e05e(0xd4),_0x34e05e(0x123),_0x34e05e(0x111),_0x34e05e(0x14a),_0x34e05e(0x124),_0x34e05e(0x130),_0x34e05e(0x12c),_0x34e05e(0x104),_0x34e05e(0xfc),_0x34e05e(0x118),_0x34e05e(0xe5),_0x34e05e(0x14e),_0x34e05e(0xf9),_0x34e05e(0x147),_0x34e05e(0x14d),_0x34e05e(0x150),'idr',_0x34e05e(0x11c),_0x34e05e(0xf7),_0x34e05e(0xe0),'krw',_0x34e05e(0xe7),_0x34e05e(0x132),_0x34e05e(0x113),_0x34e05e(0x13e),'myr',_0x34e05e(0x141),_0x34e05e(0x146),_0x34e05e(0xfa),_0x34e05e(0x144),'pkr',_0x34e05e(0xf2),_0x34e05e(0x10b),_0x34e05e(0xe2),'sek',_0x34e05e(0x135),_0x34e05e(0x120),_0x34e05e(0xd3),_0x34e05e(0x13f),'uah',_0x34e05e(0x10e),_0x34e05e(0x14f),_0x34e05e(0x108),_0x34e05e(0xd7),'xag',_0x34e05e(0x13a),_0x34e05e(0x12b),'sats'],this[_0x34e05e(0xea)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x34e05e(0xfb)]();}['startPeriodicUpdates'](){const _0x4ee101=a36_0x476cc7;this[_0x4ee101(0xf0)]()['catch'](_0x3dddf7=>{const _0x2a7daa=_0x4ee101;console[_0x2a7daa(0x13c)](_0x2a7daa(0x10c),_0x3dddf7);}),this[_0x4ee101(0xea)]=setInterval(async()=>{const _0x49bf98=_0x4ee101;try{await this[_0x49bf98(0xf0)]();}catch(_0x246cb1){console[_0x49bf98(0x13c)](_0x49bf98(0xdf),_0x246cb1);}},0x3c*0x3c*0x3e8),console['log'](_0x4ee101(0xdc));}[a36_0x476cc7(0x102)](){const _0x206e57=a36_0x476cc7;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x206e57(0xea)]=null,console[_0x206e57(0x114)](_0x206e57(0x112)));}async[a36_0x476cc7(0xf0)](){const _0x362afe=a36_0x476cc7;try{console[_0x362afe(0x114)](_0x362afe(0x10a));const _0xa50845=this[_0x362afe(0x137)][_0x362afe(0xff)](','),_0x24a16d=this[_0x362afe(0x106)]+_0x362afe(0x13d)+_0xa50845,_0x4d724=await fetch(_0x24a16d,{'headers':{'Accept':_0x362afe(0x10f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x4d724['ok'])throw new Error(_0x362afe(0xda)+_0x4d724[_0x362afe(0x12e)]+'\x20'+_0x4d724[_0x362afe(0x151)]);const _0x5bacdd=await _0x4d724[_0x362afe(0xd6)]();if(!_0x5bacdd['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x1b1299=_0x5bacdd[_0x362afe(0x100)];console[_0x362afe(0x114)](_0x362afe(0x117)+Object[_0x362afe(0x148)](_0x1b1299)[_0x362afe(0xf6)]+_0x362afe(0x11b));const _0x3bf509=Object[_0x362afe(0x11a)](_0x1b1299)['map'](async([_0xc12ca,_0x54e97c])=>{const _0x37e6ae=_0x362afe;try{await database_1[_0x37e6ae(0xf4)][_0x37e6ae(0x122)][_0x37e6ae(0x143)]({'where':{'currency':_0xc12ca[_0x37e6ae(0x136)]()},'update':{'rate':_0x54e97c},'create':{'currency':_0xc12ca[_0x37e6ae(0x136)](),'rate':_0x54e97c}});}catch(_0x15ae65){console[_0x37e6ae(0x13c)](_0x37e6ae(0xee)+_0xc12ca+':',_0x15ae65);}});await Promise[_0x362afe(0x125)](_0x3bf509),console['log'](_0x362afe(0xf8));}catch(_0xa66574){console[_0x362afe(0x13c)](_0x362afe(0x145),_0xa66574);throw _0xa66574;}}async['getCurrencyRate'](_0x3abf9a){const _0x4188d5=a36_0x476cc7,_0x58cfb1=_0x3abf9a['toLowerCase']();if(_0x58cfb1==='usdt')return 0x1;try{const _0x200e0e=await database_1['default']['currencyRate'][_0x4188d5(0xd5)]({'where':{'currency':_0x58cfb1}});if(!_0x200e0e)return console['warn'](_0x4188d5(0x121)+_0x3abf9a+_0x4188d5(0x126)),0x1;return _0x200e0e[_0x4188d5(0xfe)];}catch(_0x36e7b4){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x3abf9a+':',_0x36e7b4),0x1;}}async[a36_0x476cc7(0xdb)](_0x30c797,_0x10f9b0){const _0x450bd7=a36_0x476cc7,_0x21b7a6=_0x10f9b0['toLowerCase']();if(_0x21b7a6==='usdt'){const _0x40476b=_0x30c797*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x450bd7(0x114)](_0x450bd7(0x12d)+this[_0x450bd7(0x110)]+'%\x20markup\x20to\x20'+_0x30c797+'\x20USDT\x20=\x20'+_0x40476b[_0x450bd7(0x14c)](0x6)+_0x450bd7(0xe4)),_0x40476b;}try{const _0xcb92b1=await this[_0x450bd7(0x142)](_0x21b7a6),_0x574a73=_0x30c797/_0xcb92b1,_0x5e3bc4=_0x574a73*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x450bd7(0x114)]('üí±\x20Converted\x20'+_0x30c797+'\x20'+_0x10f9b0['toUpperCase']()+'\x20to\x20'+_0x574a73[_0x450bd7(0x14c)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0x450bd7(0x105)+_0x5e3bc4[_0x450bd7(0x14c)](0x6)+'\x20USDT\x20(rate:\x20'+_0xcb92b1+')'),_0x5e3bc4;}catch(_0x131669){console[_0x450bd7(0x13c)](_0x450bd7(0xde)+_0x30c797+'\x20'+_0x10f9b0+'\x20to\x20USDT:',_0x131669);const _0x37efb3=_0x30c797*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x37efb3;}}async[a36_0x476cc7(0x109)](_0x45afdc){const _0x5ad9db=a36_0x476cc7;let _0xb28225=0x0;for(const {amount:_0x516f79,currency:_0x4866fc}of _0x45afdc){const _0x5dc060=await this[_0x5ad9db(0xdb)](_0x516f79,_0x4866fc);_0xb28225+=_0x5dc060;}return _0xb28225;}async[a36_0x476cc7(0xef)](){const _0x2ee3e1=a36_0x476cc7;try{const _0x343f40=await database_1['default'][_0x2ee3e1(0x122)][_0x2ee3e1(0xed)]({'select':{'currency':!![],'rate':!![]}}),_0x3073dc={'usdt':0x1};return _0x343f40[_0x2ee3e1(0x140)](_0x113dae=>{const _0x387cfc=_0x2ee3e1;_0x3073dc[_0x113dae['currency']]=_0x113dae[_0x387cfc(0xfe)];}),_0x3073dc;}catch(_0x3dd2ef){return console[_0x2ee3e1(0x13c)]('Error\x20getting\x20all\x20rates:',_0x3dd2ef),{'usdt':0x1};}}async[a36_0x476cc7(0x14b)](){const _0xeb75a6=a36_0x476cc7;try{const [_0xc0b31,_0x5af795,_0xc6069]=await Promise[_0xeb75a6(0xf5)]([database_1['default']['currencyRate']['count'](),database_1[_0xeb75a6(0xf4)][_0xeb75a6(0x122)][_0xeb75a6(0xd9)]({'orderBy':{'updatedAt':_0xeb75a6(0xd8)},'select':{'updatedAt':!![]}}),database_1['default'][_0xeb75a6(0x122)]['findFirst']({'orderBy':{'updatedAt':_0xeb75a6(0x10d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xc0b31,'lastUpdated':_0x5af795?.[_0xeb75a6(0xe3)]||null,'oldestRate':_0xc6069?.[_0xeb75a6(0xe3)]||null,'markupPercentage':this[_0xeb75a6(0x110)]};}catch(_0x54e220){return console[_0xeb75a6(0x13c)](_0xeb75a6(0x149),_0x54e220),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xeb75a6(0x110)]};}}[a36_0x476cc7(0xe8)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a36_0x476cc7(0x103)]=new CurrencyService();function a36_0x527d(){const _0x9cb17a=['hkd','eur','vnd','huf','statusText','try','aud','findUnique','json','xdr','desc','findFirst','CoinGecko\x20API\x20error:\x20','convertToUSDT','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','2809AUgVCT','Error\x20converting\x20','Periodic\x20currency\x20rates\x20update\x20failed:','jpy','eos','sar','updatedAt','\x20USDT','dkk','18fLZeMF','kwd','getMarkupPercentage','btc','updateInterval','../config/database','link','findMany','Failed\x20to\x20update\x20rate\x20for\x20','getAllRates','updateCurrencyRates','11670372xnlQaT','pln','10uWVaHy','default','all','length','inr','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','gbp','nzd','startPeriodicUpdates','cny','3060953GqEQnp','rate','join','tether','4438437SMHUNg','stopPeriodicUpdates','currencyService','clp','%\x20markup\x20=\x20','COINGECKO_URL','CurrencyService','zar','convertMultipleToUSDT','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','rub','Initial\x20currency\x20rates\x20update\x20failed:','asc','vef','application/json','MARKUP_PERCENTAGE','bhd','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','mmk','log','79172bNPqwu','ltc','üìä\x20Received\x20rates\x20for\x20','czk','https://api.coingecko.com/api/v3/simple/price','entries','\x20currencies','ils','122KuuPNq','bnb','__esModule','thb','No\x20rate\x20found\x20for\x20currency:\x20','currencyRate','bdt','brl','allSettled',',\x20using\x201\x20as\x20fallback','yfi','8277313TMFaym','24KkQiwY','5307576KGJgQV','bits','chf','üí±\x20Applied\x20','status','aed','cad','usd','lkr','dot','xlm','sgd','toLowerCase','CURRENCIES','65oYOojL','xrp','xau','__importDefault','error','?ids=tether&vs_currencies=','mxn','twd','forEach','ngn','getCurrencyRate','upsert','php','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','nok','gel','keys','Error\x20getting\x20rates\x20status:','bmd','getRatesStatus','toFixed'];a36_0x527d=function(){return _0x9cb17a;};return a36_0x527d();}