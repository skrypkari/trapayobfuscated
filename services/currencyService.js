'use strict';const a38_0x5f23a8=a38_0x2a9e;(function(_0x329de2,_0x32cbf9){const _0x38496b=a38_0x2a9e,_0x41d116=_0x329de2();while(!![]){try{const _0x42e60a=-parseInt(_0x38496b(0x1f3))/0x1*(-parseInt(_0x38496b(0x1e1))/0x2)+-parseInt(_0x38496b(0x18e))/0x3+-parseInt(_0x38496b(0x1d3))/0x4*(-parseInt(_0x38496b(0x1ff))/0x5)+-parseInt(_0x38496b(0x1a1))/0x6+parseInt(_0x38496b(0x1f4))/0x7*(-parseInt(_0x38496b(0x1d4))/0x8)+parseInt(_0x38496b(0x1c8))/0x9*(parseInt(_0x38496b(0x1aa))/0xa)+parseInt(_0x38496b(0x1a6))/0xb*(parseInt(_0x38496b(0x18a))/0xc);if(_0x42e60a===_0x32cbf9)break;else _0x41d116['push'](_0x41d116['shift']());}catch(_0x22d837){_0x41d116['push'](_0x41d116['shift']());}}}(a38_0x10e0,0x32ffb));var __importDefault=this&&this[a38_0x5f23a8(0x1e2)]||function(_0x2f1eb5){return _0x2f1eb5&&_0x2f1eb5['__esModule']?_0x2f1eb5:{'default':_0x2f1eb5};};function a38_0x2a9e(_0x5d25a3,_0x5e0435){const _0x10e00c=a38_0x10e0();return a38_0x2a9e=function(_0x2a9e40,_0x45b861){_0x2a9e40=_0x2a9e40-0x18a;let _0x1e1a58=_0x10e00c[_0x2a9e40];return _0x1e1a58;},a38_0x2a9e(_0x5d25a3,_0x5e0435);}Object[a38_0x5f23a8(0x1dd)](exports,a38_0x5f23a8(0x1d2),{'value':!![]}),exports[a38_0x5f23a8(0x197)]=exports[a38_0x5f23a8(0x1be)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x5bf93e=a38_0x5f23a8;this[_0x5bf93e(0x1a4)]='https://api.coingecko.com/api/v3/simple/price',this[_0x5bf93e(0x1ad)]=[_0x5bf93e(0x1b6),_0x5bf93e(0x209),_0x5bf93e(0x199),_0x5bf93e(0x198),_0x5bf93e(0x1b0),'eos','xrp',_0x5bf93e(0x1e6),_0x5bf93e(0x19d),'dot',_0x5bf93e(0x1e0),_0x5bf93e(0x1f8),_0x5bf93e(0x1da),_0x5bf93e(0x1d7),_0x5bf93e(0x20a),_0x5bf93e(0x1c5),_0x5bf93e(0x1d1),_0x5bf93e(0x1ca),_0x5bf93e(0x1a7),_0x5bf93e(0x1ee),'chf',_0x5bf93e(0x200),_0x5bf93e(0x194),_0x5bf93e(0x1dc),_0x5bf93e(0x190),_0x5bf93e(0x19a),_0x5bf93e(0x19e),'gel',_0x5bf93e(0x195),_0x5bf93e(0x1c0),_0x5bf93e(0x1e8),'ils',_0x5bf93e(0x1b8),'jpy',_0x5bf93e(0x1db),_0x5bf93e(0x1c9),_0x5bf93e(0x1bc),_0x5bf93e(0x1f0),'mxn',_0x5bf93e(0x1de),_0x5bf93e(0x205),_0x5bf93e(0x1cf),_0x5bf93e(0x1b2),_0x5bf93e(0x1fc),_0x5bf93e(0x1d9),_0x5bf93e(0x1cd),_0x5bf93e(0x1ba),'sar',_0x5bf93e(0x1c4),'sgd',_0x5bf93e(0x1a2),_0x5bf93e(0x1e3),'twd',_0x5bf93e(0x1fb),_0x5bf93e(0x1b4),_0x5bf93e(0x1e4),_0x5bf93e(0x1bf),_0x5bf93e(0x207),'xag','xau',_0x5bf93e(0x1f7),_0x5bf93e(0x1b9)],this[_0x5bf93e(0x193)]=null,this[_0x5bf93e(0x19b)]=0x3,this[_0x5bf93e(0x204)]();}['startPeriodicUpdates'](){const _0x13f0cb=a38_0x5f23a8;this[_0x13f0cb(0x1c1)]()[_0x13f0cb(0x196)](_0x291d37=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x291d37);}),this['updateInterval']=setInterval(async()=>{const _0x5e96d4=_0x13f0cb;try{await this[_0x5e96d4(0x1c1)]();}catch(_0x4d62b2){console[_0x5e96d4(0x206)](_0x5e96d4(0x1d5),_0x4d62b2);}},0x3c*0x3c*0x3e8),console[_0x13f0cb(0x1a5)](_0x13f0cb(0x1fd));}[a38_0x5f23a8(0x19c)](){const _0x5aac06=a38_0x5f23a8;this[_0x5aac06(0x193)]&&(clearInterval(this[_0x5aac06(0x193)]),this[_0x5aac06(0x193)]=null,console[_0x5aac06(0x1a5)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0xe07c99=a38_0x5f23a8;try{console[_0xe07c99(0x1a5)](_0xe07c99(0x1b3));const _0x3735a7=this[_0xe07c99(0x1ad)][_0xe07c99(0x1cb)](','),_0x489703=this[_0xe07c99(0x1a4)]+'?ids=tether&vs_currencies='+_0x3735a7,_0x4cae4f=await fetch(_0x489703,{'headers':{'Accept':_0xe07c99(0x201),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x4cae4f['ok'])throw new Error(_0xe07c99(0x1f6)+_0x4cae4f[_0xe07c99(0x191)]+'\x20'+_0x4cae4f[_0xe07c99(0x1c6)]);const _0x12a2fe=await _0x4cae4f[_0xe07c99(0x1a0)]();if(!_0x12a2fe[_0xe07c99(0x1a8)])throw new Error(_0xe07c99(0x19f));const _0x3b96e8=_0x12a2fe[_0xe07c99(0x1a8)];console[_0xe07c99(0x1a5)](_0xe07c99(0x1b1)+Object['keys'](_0x3b96e8)['length']+_0xe07c99(0x1ae));const _0x2f41fe=Object[_0xe07c99(0x1f5)](_0x3b96e8)[_0xe07c99(0x192)](async([_0x3ff418,_0x1074bb])=>{const _0x54d305=_0xe07c99;try{await database_1[_0x54d305(0x1e9)][_0x54d305(0x18f)][_0x54d305(0x18d)]({'where':{'currency':_0x3ff418[_0x54d305(0x1ec)]()},'update':{'rate':_0x1074bb},'create':{'currency':_0x3ff418[_0x54d305(0x1ec)](),'rate':_0x1074bb}});}catch(_0x4677c3){console[_0x54d305(0x206)](_0x54d305(0x1ac)+_0x3ff418+':',_0x4677c3);}});await Promise['allSettled'](_0x2f41fe),console[_0xe07c99(0x1a5)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x55eb49){console[_0xe07c99(0x206)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x55eb49);throw _0x55eb49;}}async[a38_0x5f23a8(0x18c)](_0x475fa0){const _0x17050d=a38_0x5f23a8,_0x2c6f82=_0x475fa0[_0x17050d(0x1ec)]();if(_0x2c6f82==='usdt')return 0x1;try{const _0xdb3710=await database_1['default'][_0x17050d(0x18f)][_0x17050d(0x1fa)]({'where':{'currency':_0x2c6f82}});if(!_0xdb3710)return console[_0x17050d(0x1af)](_0x17050d(0x1ed)+_0x475fa0+',\x20using\x201\x20as\x20fallback'),0x1;return _0xdb3710[_0x17050d(0x1b5)];}catch(_0x87d087){return console[_0x17050d(0x206)](_0x17050d(0x1d6)+_0x475fa0+':',_0x87d087),0x1;}}async[a38_0x5f23a8(0x1c2)](_0x62addf,_0x5cddf2){const _0x1fd23b=a38_0x5f23a8,_0x23ecca=_0x5cddf2[_0x1fd23b(0x1ec)]();if(_0x23ecca==='usdt'){const _0x821040=_0x62addf*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x1fd23b(0x1a5)](_0x1fd23b(0x203)+this[_0x1fd23b(0x19b)]+_0x1fd23b(0x1e5)+_0x62addf+_0x1fd23b(0x1f2)+_0x821040[_0x1fd23b(0x1c3)](0x6)+_0x1fd23b(0x1ab)),_0x821040;}try{const _0x1de561=await this[_0x1fd23b(0x18c)](_0x23ecca),_0x254d44=_0x62addf/_0x1de561,_0x99e88b=_0x254d44*(0x1+this[_0x1fd23b(0x19b)]/0x64);return console[_0x1fd23b(0x1a5)](_0x1fd23b(0x1bb)+_0x62addf+'\x20'+_0x5cddf2[_0x1fd23b(0x1df)]()+_0x1fd23b(0x202)+_0x254d44[_0x1fd23b(0x1c3)](0x6)+_0x1fd23b(0x1c7)+this[_0x1fd23b(0x19b)]+_0x1fd23b(0x18b)+_0x99e88b[_0x1fd23b(0x1c3)](0x6)+_0x1fd23b(0x1a9)+_0x1de561+')'),_0x99e88b;}catch(_0x31fd7f){console[_0x1fd23b(0x206)](_0x1fd23b(0x1eb)+_0x62addf+'\x20'+_0x5cddf2+_0x1fd23b(0x1f9),_0x31fd7f);const _0x590038=_0x62addf*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x590038;}}async[a38_0x5f23a8(0x1bd)](_0x462f28){const _0x4ecf11=a38_0x5f23a8;let _0xdc1c0a=0x0;for(const {amount:_0x5d62ac,currency:_0x2b61bc}of _0x462f28){const _0x2e4302=await this[_0x4ecf11(0x1c2)](_0x5d62ac,_0x2b61bc);_0xdc1c0a+=_0x2e4302;}return _0xdc1c0a;}async[a38_0x5f23a8(0x1e7)](){const _0x17aef5=a38_0x5f23a8;try{const _0x2c57e0=await database_1[_0x17aef5(0x1e9)][_0x17aef5(0x18f)][_0x17aef5(0x1d0)]({'select':{'currency':!![],'rate':!![]}}),_0x24b667={'usdt':0x1};return _0x2c57e0['forEach'](_0x2487ce=>{const _0x263da5=_0x17aef5;_0x24b667[_0x2487ce[_0x263da5(0x1fe)]]=_0x2487ce[_0x263da5(0x1b5)];}),_0x24b667;}catch(_0x7501b2){return console[_0x17aef5(0x206)](_0x17aef5(0x1ce),_0x7501b2),{'usdt':0x1};}}async['getRatesStatus'](){const _0x13c3ca=a38_0x5f23a8;try{const [_0x58f0b6,_0x49e079,_0xbeb165]=await Promise[_0x13c3ca(0x1f1)]([database_1['default'][_0x13c3ca(0x18f)][_0x13c3ca(0x1d8)](),database_1[_0x13c3ca(0x1e9)][_0x13c3ca(0x18f)][_0x13c3ca(0x1ea)]({'orderBy':{'updatedAt':_0x13c3ca(0x208)},'select':{'updatedAt':!![]}}),database_1[_0x13c3ca(0x1e9)][_0x13c3ca(0x18f)]['findFirst']({'orderBy':{'updatedAt':_0x13c3ca(0x1b7)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x58f0b6,'lastUpdated':_0x49e079?.['updatedAt']||null,'oldestRate':_0xbeb165?.[_0x13c3ca(0x1a3)]||null,'markupPercentage':this[_0x13c3ca(0x19b)]};}catch(_0x170138){return console[_0x13c3ca(0x206)](_0x13c3ca(0x1cc),_0x170138),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x13c3ca(0x19b)]};}}[a38_0x5f23a8(0x1ef)](){const _0x5fbe09=a38_0x5f23a8;return this[_0x5fbe09(0x19b)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x5f23a8(0x197)]=new CurrencyService();function a38_0x10e0(){const _0x81165=['catch','currencyService','bch','ltc','eur','MARKUP_PERCENTAGE','stopPeriodicUpdates','link','gbp','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','json','2362680jnmzmb','thb','updatedAt','COINGECKO_URL','log','55EqdaDY','brl','tether','\x20USDT\x20(rate:\x20','8010tFFhdX','\x20USDT','Failed\x20to\x20update\x20rate\x20for\x20','CURRENCIES','\x20currencies','warn','bnb','📊\x20Received\x20rates\x20for\x20','nzd','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','vef','rate','btc','asc','inr','sats','rub','💱\x20Converted\x20','lkr','convertMultipleToUSDT','CurrencyService','zar','huf','updateCurrencyRates','convertToUSDT','toFixed','sek','bdt','statusText','\x20USDT,\x20with\x20','288mpkrPv','kwd','bmd','join','Error\x20getting\x20rates\x20status:','pln','Error\x20getting\x20all\x20rates:','nok','findMany','bhd','__esModule','4XKmdPE','72KJKfEH','Periodic\x20currency\x20rates\x20update\x20failed:','Error\x20getting\x20rate\x20for\x20currency\x20','ars','count','pkr','aed','krw','czk','defineProperty','myr','toUpperCase','yfi','64550bQnPKt','__importDefault','try','vnd','%\x20markup\x20to\x20','xlm','getAllRates','idr','default','findFirst','Error\x20converting\x20','toLowerCase','No\x20rate\x20found\x20for\x20currency:\x20','cad','getMarkupPercentage','mmk','all','\x20USDT\x20=\x20','2MYXDnO','84133BdMNkc','entries','CoinGecko\x20API\x20error:\x20','bits','usd','\x20to\x20USDT:','findUnique','uah','php','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','currency','352195ALsHTR','clp','application/json','\x20to\x20','💱\x20Applied\x20','startPeriodicUpdates','ngn','error','xdr','desc','eth','aud','2179884cCDzQV','%\x20markup\x20=\x20','getCurrencyRate','upsert','1074192kDONuZ','currencyRate','dkk','status','map','updateInterval','cny','hkd'];a38_0x10e0=function(){return _0x81165;};return a38_0x10e0();}