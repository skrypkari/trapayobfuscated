'use strict';const a38_0x14b387=a38_0x4d24;function a38_0x4e93(){const _0x22c9b8=['updatedAt','Error\x20getting\x20rate\x20for\x20currency\x20','sats','https://api.coingecko.com/api/v3/simple/price','xdr','MARKUP_PERCENTAGE','\x20USDT\x20=\x20','yfi','rub','6050XVrwZg','all','aud','vnd','getAllRates','mmk','ngn','✅\x20Currency\x20rates\x20updated\x20successfully','69097FpSKrb','../config/database','upsert','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','map','getMarkupPercentage','length','toFixed','COINGECKO_URL','Initial\x20currency\x20rates\x20update\x20failed:','findUnique','updateInterval','bnb','xrp','btc','cny','currencyService','usdt','aed','kwd','czk','defineProperty','jpy','currencyRate','vef','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','\x20USDT,\x20with\x20','\x20USDT\x20(rate:\x20','CURRENCIES','huf','getRatesStatus','gbp','eos','xau','statusText','try','lkr','%\x20markup\x20=\x20','status','toUpperCase','stopPeriodicUpdates','\x20currencies','%\x20markup\x20to\x20','2EBDfFj','bhd','log','9gzFhko','💱\x20Applied\x20','__importDefault','eur','warn','brl','mxn','pln','Error\x20getting\x20all\x20rates:','link','8095VmffYU','dkk','asc','zar','1656039GqbbvS','CoinGecko\x20API\x20error:\x20','14168peBuqZ','bdt','\x20to\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','nok','error','📊\x20Received\x20rates\x20for\x20','xag',',\x20using\x201\x20as\x20fallback','entries','Failed\x20to\x20update\x20rate\x20for\x20','findMany','💱\x20Converted\x20','5630ijtRQK','\x20to\x20USDT:','229020vFfCcp','xlm','366IIqvJU','desc','allSettled','297232pnmIlB','krw','application/json','bits','convertToUSDT','364rdRLPi','inr','eth','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','sar','rate','updateCurrencyRates','No\x20rate\x20found\x20for\x20currency:\x20','join','clp','thb','bmd','__esModule','ltc','getCurrencyRate','myr','sgd','nzd','?ids=tether&vs_currencies=','toLowerCase','default','startPeriodicUpdates','idr','gel','findFirst','json','keys','dot','CurrencyService','tether','php'];a38_0x4e93=function(){return _0x22c9b8;};return a38_0x4e93();}(function(_0x3899c1,_0x490cce){const _0x44eded=a38_0x4d24,_0x1a931f=_0x3899c1();while(!![]){try{const _0x52bca0=parseInt(_0x44eded(0x182))/0x1*(-parseInt(_0x44eded(0x195))/0x2)+parseInt(_0x44eded(0x193))/0x3+-parseInt(_0x44eded(0x1ae))/0x4*(-parseInt(_0x44eded(0x18f))/0x5)+parseInt(_0x44eded(0x1a6))/0x6*(-parseInt(_0x44eded(0x1de))/0x7)+-parseInt(_0x44eded(0x1a9))/0x8*(-parseInt(_0x44eded(0x185))/0x9)+-parseInt(_0x44eded(0x1a2))/0xa*(-parseInt(_0x44eded(0x1d6))/0xb)+-parseInt(_0x44eded(0x1a4))/0xc;if(_0x52bca0===_0x490cce)break;else _0x1a931f['push'](_0x1a931f['shift']());}catch(_0x4edad9){_0x1a931f['push'](_0x1a931f['shift']());}}}(a38_0x4e93,0x6448a));var __importDefault=this&&this[a38_0x14b387(0x187)]||function(_0x32ad2c){const _0x24161f=a38_0x14b387;return _0x32ad2c&&_0x32ad2c[_0x24161f(0x1ba)]?_0x32ad2c:{'default':_0x32ad2c};};Object[a38_0x14b387(0x16c)](exports,a38_0x14b387(0x1ba),{'value':!![]}),exports[a38_0x14b387(0x167)]=exports[a38_0x14b387(0x1ca)]=void 0x0;function a38_0x4d24(_0x80a5bb,_0x58f962){const _0x4e93b6=a38_0x4e93();return a38_0x4d24=function(_0x4d24d4,_0x37a0b8){_0x4d24d4=_0x4d24d4-0x15c;let _0x2a4761=_0x4e93b6[_0x4d24d4];return _0x2a4761;},a38_0x4d24(_0x80a5bb,_0x58f962);}const database_1=__importDefault(require(a38_0x14b387(0x1df)));class CurrencyService{constructor(){const _0x5e304c=a38_0x14b387;this[_0x5e304c(0x15f)]=_0x5e304c(0x1d0),this['CURRENCIES']=[_0x5e304c(0x165),_0x5e304c(0x1b0),_0x5e304c(0x1bb),'bch',_0x5e304c(0x163),_0x5e304c(0x177),_0x5e304c(0x164),_0x5e304c(0x1a5),_0x5e304c(0x18e),_0x5e304c(0x1c9),_0x5e304c(0x1d4),'usd',_0x5e304c(0x169),'ars',_0x5e304c(0x1d8),_0x5e304c(0x196),_0x5e304c(0x183),_0x5e304c(0x1b9),_0x5e304c(0x18a),'cad','chf',_0x5e304c(0x1b7),_0x5e304c(0x166),_0x5e304c(0x16b),_0x5e304c(0x190),_0x5e304c(0x188),_0x5e304c(0x176),_0x5e304c(0x1c5),'hkd',_0x5e304c(0x174),_0x5e304c(0x1c4),'ils',_0x5e304c(0x1af),_0x5e304c(0x16d),_0x5e304c(0x1aa),_0x5e304c(0x16a),_0x5e304c(0x17b),_0x5e304c(0x1db),_0x5e304c(0x18b),_0x5e304c(0x1bd),_0x5e304c(0x1dc),_0x5e304c(0x199),_0x5e304c(0x1bf),_0x5e304c(0x1cc),'pkr',_0x5e304c(0x18c),_0x5e304c(0x1d5),_0x5e304c(0x1b2),'sek',_0x5e304c(0x1be),_0x5e304c(0x1b8),_0x5e304c(0x17a),'twd','uah',_0x5e304c(0x16f),_0x5e304c(0x1d9),_0x5e304c(0x192),_0x5e304c(0x1d1),_0x5e304c(0x19c),_0x5e304c(0x178),_0x5e304c(0x1ac),_0x5e304c(0x1cf)],this[_0x5e304c(0x162)]=null,this[_0x5e304c(0x1d2)]=0x3,this[_0x5e304c(0x1c3)]();}[a38_0x14b387(0x1c3)](){const _0x365a84=a38_0x14b387;this[_0x365a84(0x1b4)]()['catch'](_0x53bbbf=>{const _0x91a566=_0x365a84;console[_0x91a566(0x19a)](_0x91a566(0x160),_0x53bbbf);}),this[_0x365a84(0x162)]=setInterval(async()=>{const _0x49eaf5=_0x365a84;try{await this[_0x49eaf5(0x1b4)]();}catch(_0x15bf81){console[_0x49eaf5(0x19a)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x15bf81);}},0x3c*0x3c*0x3e8),console[_0x365a84(0x184)](_0x365a84(0x198));}[a38_0x14b387(0x17f)](){const _0x530113=a38_0x14b387;this[_0x530113(0x162)]&&(clearInterval(this[_0x530113(0x162)]),this[_0x530113(0x162)]=null,console[_0x530113(0x184)](_0x530113(0x170)));}async[a38_0x14b387(0x1b4)](){const _0x37e2b1=a38_0x14b387;try{console[_0x37e2b1(0x184)](_0x37e2b1(0x1e1));const _0x1eef95=this[_0x37e2b1(0x173)][_0x37e2b1(0x1b6)](','),_0x297ea4=this[_0x37e2b1(0x15f)]+_0x37e2b1(0x1c0)+_0x1eef95,_0x45f7f8=await fetch(_0x297ea4,{'headers':{'Accept':_0x37e2b1(0x1ab),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x45f7f8['ok'])throw new Error(_0x37e2b1(0x194)+_0x45f7f8[_0x37e2b1(0x17d)]+'\x20'+_0x45f7f8[_0x37e2b1(0x179)]);const _0x491806=await _0x45f7f8[_0x37e2b1(0x1c7)]();if(!_0x491806[_0x37e2b1(0x1cb)])throw new Error(_0x37e2b1(0x1b1));const _0x19c715=_0x491806[_0x37e2b1(0x1cb)];console['log'](_0x37e2b1(0x19b)+Object[_0x37e2b1(0x1c8)](_0x19c715)[_0x37e2b1(0x15d)]+_0x37e2b1(0x180));const _0x621478=Object[_0x37e2b1(0x19e)](_0x19c715)[_0x37e2b1(0x1e2)](async([_0x5c491d,_0x35931a])=>{const _0xc02f69=_0x37e2b1;try{await database_1[_0xc02f69(0x1c2)][_0xc02f69(0x16e)][_0xc02f69(0x1e0)]({'where':{'currency':_0x5c491d[_0xc02f69(0x1c1)]()},'update':{'rate':_0x35931a},'create':{'currency':_0x5c491d[_0xc02f69(0x1c1)](),'rate':_0x35931a}});}catch(_0x3123a0){console['error'](_0xc02f69(0x19f)+_0x5c491d+':',_0x3123a0);}});await Promise[_0x37e2b1(0x1a8)](_0x621478),console['log'](_0x37e2b1(0x1dd));}catch(_0x345d3f){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x345d3f);throw _0x345d3f;}}async[a38_0x14b387(0x1bc)](_0x443b45){const _0x130c27=a38_0x14b387,_0x549fd5=_0x443b45[_0x130c27(0x1c1)]();if(_0x549fd5===_0x130c27(0x168))return 0x1;try{const _0x57b6b7=await database_1[_0x130c27(0x1c2)][_0x130c27(0x16e)][_0x130c27(0x161)]({'where':{'currency':_0x549fd5}});if(!_0x57b6b7)return console[_0x130c27(0x189)](_0x130c27(0x1b5)+_0x443b45+_0x130c27(0x19d)),0x1;return _0x57b6b7[_0x130c27(0x1b3)];}catch(_0x137c13){return console['error'](_0x130c27(0x1ce)+_0x443b45+':',_0x137c13),0x1;}}async[a38_0x14b387(0x1ad)](_0x5981fa,_0x42b026){const _0x214ba4=a38_0x14b387,_0x2fe32e=_0x42b026[_0x214ba4(0x1c1)]();if(_0x2fe32e===_0x214ba4(0x168)){const _0xbf8b13=_0x5981fa*(0x1+this[_0x214ba4(0x1d2)]/0x64);return console[_0x214ba4(0x184)](_0x214ba4(0x186)+this[_0x214ba4(0x1d2)]+_0x214ba4(0x181)+_0x5981fa+_0x214ba4(0x1d3)+_0xbf8b13[_0x214ba4(0x15e)](0x6)+'\x20USDT'),_0xbf8b13;}try{const _0x37ff29=await this[_0x214ba4(0x1bc)](_0x2fe32e),_0x23af26=_0x5981fa/_0x37ff29,_0x3f3bce=_0x23af26*(0x1+this[_0x214ba4(0x1d2)]/0x64);return console[_0x214ba4(0x184)](_0x214ba4(0x1a1)+_0x5981fa+'\x20'+_0x42b026[_0x214ba4(0x17e)]()+_0x214ba4(0x197)+_0x23af26['toFixed'](0x6)+_0x214ba4(0x171)+this[_0x214ba4(0x1d2)]+_0x214ba4(0x17c)+_0x3f3bce[_0x214ba4(0x15e)](0x6)+_0x214ba4(0x172)+_0x37ff29+')'),_0x3f3bce;}catch(_0x187bab){console[_0x214ba4(0x19a)]('Error\x20converting\x20'+_0x5981fa+'\x20'+_0x42b026+_0x214ba4(0x1a3),_0x187bab);const _0x309d74=_0x5981fa*(0x1+this[_0x214ba4(0x1d2)]/0x64);return _0x309d74;}}async['convertMultipleToUSDT'](_0x144268){let _0x5de8af=0x0;for(const {amount:_0x1c412f,currency:_0x32446a}of _0x144268){const _0x42db79=await this['convertToUSDT'](_0x1c412f,_0x32446a);_0x5de8af+=_0x42db79;}return _0x5de8af;}async[a38_0x14b387(0x1da)](){const _0x215953=a38_0x14b387;try{const _0x652403=await database_1[_0x215953(0x1c2)][_0x215953(0x16e)][_0x215953(0x1a0)]({'select':{'currency':!![],'rate':!![]}}),_0x4924ba={'usdt':0x1};return _0x652403['forEach'](_0x1d40d9=>{const _0x293611=_0x215953;_0x4924ba[_0x1d40d9['currency']]=_0x1d40d9[_0x293611(0x1b3)];}),_0x4924ba;}catch(_0x5a6ed3){return console[_0x215953(0x19a)](_0x215953(0x18d),_0x5a6ed3),{'usdt':0x1};}}async[a38_0x14b387(0x175)](){const _0x273acd=a38_0x14b387;try{const [_0x40de8d,_0x4d3482,_0x5a89c9]=await Promise[_0x273acd(0x1d7)]([database_1['default'][_0x273acd(0x16e)]['count'](),database_1[_0x273acd(0x1c2)]['currencyRate'][_0x273acd(0x1c6)]({'orderBy':{'updatedAt':_0x273acd(0x1a7)},'select':{'updatedAt':!![]}}),database_1[_0x273acd(0x1c2)][_0x273acd(0x16e)][_0x273acd(0x1c6)]({'orderBy':{'updatedAt':_0x273acd(0x191)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x40de8d,'lastUpdated':_0x4d3482?.[_0x273acd(0x1cd)]||null,'oldestRate':_0x5a89c9?.[_0x273acd(0x1cd)]||null,'markupPercentage':this[_0x273acd(0x1d2)]};}catch(_0x118214){return console[_0x273acd(0x19a)]('Error\x20getting\x20rates\x20status:',_0x118214),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x273acd(0x1d2)]};}}[a38_0x14b387(0x15c)](){const _0x2805c2=a38_0x14b387;return this[_0x2805c2(0x1d2)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x14b387(0x167)]=new CurrencyService();