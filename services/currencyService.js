'use strict';const a51_0x261d1e=a51_0x29c0;function a51_0x4202(){const _0x56a76e=['%\x20markup\x20to\x20','updateInterval','status','map','currency','sgd','toUpperCase','rate','bch','php','ars','gbp','json','Failed\x20to\x20update\x20rate\x20for\x20','\x20USDT\x20(rate:\x20','bits','6586916JZmNTW','getMarkupPercentage','czk','startPeriodicUpdates','__esModule','2310RdFJtq','join','brl','77620BNZBki','xau','%\x20markup\x20=\x20','CoinGecko\x20API\x20error:\x20','117267PxjlhW','COINGECKO_URL','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','__importDefault','toFixed','sek','zar','link','findFirst','chf','catch','mmk','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','yfi','jpy','updatedAt','rub','16572dHZZkQ','âœ…\x20Currency\x20rates\x20updated\x20successfully','xag','getCurrencyRate','upsert','360170qkqNeM','CurrencyService','allSettled','aud','ltc','statusText','getAllRates','531yqSomT','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','clp','sar','toLowerCase','ðŸ“Š\x20Received\x20rates\x20for\x20','xdr','CURRENCIES','convertToUSDT','asc','https://api.coingecko.com/api/v3/simple/price','default','\x20USDT','usd','log','entries','ngn','dkk','defineProperty','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','../config/database','length','convertMultipleToUSDT','\x20to\x20USDT:','\x20to\x20','usdt','eth','lkr','findUnique','cad','30zIXZNl','tether','application/json','currencyRate','MARKUP_PERCENTAGE','Payment\x20System/1.0','getRatesStatus','Error\x20converting\x20','8673217GAzaAv','bdt','xrp','nzd','uah','pkr','error','pln','vnd','thb','2095120efQUSR','updateCurrencyRates','forEach','ils','twd','vef','bmd','ðŸ’±\x20Applied\x20','keys','currencyService','nok','count','dot','?ids=tether&vs_currencies=','kwd','warn','desc'];a51_0x4202=function(){return _0x56a76e;};return a51_0x4202();}(function(_0x3895db,_0x5c62b3){const _0x116209=a51_0x29c0,_0x420a27=_0x3895db();while(!![]){try{const _0x47b767=parseInt(_0x116209(0x19d))/0x1+parseInt(_0x116209(0x162))/0x2*(parseInt(_0x116209(0x1a1))/0x3)+-parseInt(_0x116209(0x195))/0x4+-parseInt(_0x116209(0x19a))/0x5*(parseInt(_0x116209(0x1b2))/0x6)+parseInt(_0x116209(0x16a))/0x7+-parseInt(_0x116209(0x174))/0x8+-parseInt(_0x116209(0x144))/0x9*(-parseInt(_0x116209(0x1b7))/0xa);if(_0x47b767===_0x5c62b3)break;else _0x420a27['push'](_0x420a27['shift']());}catch(_0x22f2a6){_0x420a27['push'](_0x420a27['shift']());}}}(a51_0x4202,0xcde3e));var __importDefault=this&&this[a51_0x261d1e(0x1a4)]||function(_0x3822c6){const _0x331dfb=a51_0x261d1e;return _0x3822c6&&_0x3822c6[_0x331dfb(0x199)]?_0x3822c6:{'default':_0x3822c6};};function a51_0x29c0(_0xd7f910,_0x5a13f8){_0xd7f910=_0xd7f910-0x144;const _0x420299=a51_0x4202();let _0x29c02f=_0x420299[_0xd7f910];return _0x29c02f;}Object[a51_0x261d1e(0x156)](exports,a51_0x261d1e(0x199),{'value':!![]}),exports['currencyService']=exports[a51_0x261d1e(0x1b8)]=void 0x0;const database_1=__importDefault(require(a51_0x261d1e(0x158)));class CurrencyService{constructor(){const _0x532cd2=a51_0x261d1e;this[_0x532cd2(0x1a2)]=_0x532cd2(0x14e),this['CURRENCIES']=['btc',_0x532cd2(0x15e),_0x532cd2(0x1bb),_0x532cd2(0x18d),'bnb','eos',_0x532cd2(0x16c),'xlm',_0x532cd2(0x1a8),_0x532cd2(0x180),_0x532cd2(0x1ae),_0x532cd2(0x151),'aed',_0x532cd2(0x18f),_0x532cd2(0x1ba),_0x532cd2(0x16b),'bhd',_0x532cd2(0x17a),_0x532cd2(0x19c),_0x532cd2(0x161),_0x532cd2(0x1aa),_0x532cd2(0x146),'cny',_0x532cd2(0x197),_0x532cd2(0x155),'eur',_0x532cd2(0x190),'gel','hkd','huf','idr',_0x532cd2(0x177),'inr',_0x532cd2(0x1af),'krw',_0x532cd2(0x182),_0x532cd2(0x15f),_0x532cd2(0x1ac),'mxn','myr',_0x532cd2(0x154),_0x532cd2(0x17e),_0x532cd2(0x16d),_0x532cd2(0x18e),_0x532cd2(0x16f),_0x532cd2(0x171),_0x532cd2(0x1b1),_0x532cd2(0x147),_0x532cd2(0x1a6),_0x532cd2(0x18a),_0x532cd2(0x173),'try',_0x532cd2(0x178),_0x532cd2(0x16e),_0x532cd2(0x179),_0x532cd2(0x172),_0x532cd2(0x1a7),_0x532cd2(0x14a),_0x532cd2(0x1b4),_0x532cd2(0x19e),_0x532cd2(0x194),'sats'],this['updateInterval']=null,this[_0x532cd2(0x166)]=-0x3,this[_0x532cd2(0x198)]();}[a51_0x261d1e(0x198)](){const _0x47736d=a51_0x261d1e;this['updateCurrencyRates']()[_0x47736d(0x1ab)](_0x294090=>{const _0x5cefda=_0x47736d;console[_0x5cefda(0x170)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x294090);}),this[_0x47736d(0x186)]=setInterval(async()=>{const _0x40750c=_0x47736d;try{await this[_0x40750c(0x175)]();}catch(_0xe19a90){console[_0x40750c(0x170)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0xe19a90);}},0x3c*0x3c*0x3e8),console[_0x47736d(0x152)](_0x47736d(0x1ad));}['stopPeriodicUpdates'](){const _0x447071=a51_0x261d1e;this[_0x447071(0x186)]&&(clearInterval(this[_0x447071(0x186)]),this[_0x447071(0x186)]=null,console['log']('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a51_0x261d1e(0x175)](){const _0xa1f34f=a51_0x261d1e;try{console[_0xa1f34f(0x152)](_0xa1f34f(0x1a3));const _0x5a32a1=this[_0xa1f34f(0x14b)][_0xa1f34f(0x19b)](','),_0x2e6d82=this['COINGECKO_URL']+_0xa1f34f(0x181)+_0x5a32a1,_0x3fa35b=await fetch(_0x2e6d82,{'headers':{'Accept':_0xa1f34f(0x164),'User-Agent':_0xa1f34f(0x167)}});if(!_0x3fa35b['ok'])throw new Error(_0xa1f34f(0x1a0)+_0x3fa35b[_0xa1f34f(0x187)]+'\x20'+_0x3fa35b[_0xa1f34f(0x1bc)]);const _0x38cad0=await _0x3fa35b[_0xa1f34f(0x191)]();if(!_0x38cad0['tether'])throw new Error(_0xa1f34f(0x145));const _0x1c99c7=_0x38cad0[_0xa1f34f(0x163)];console[_0xa1f34f(0x152)](_0xa1f34f(0x149)+Object[_0xa1f34f(0x17c)](_0x1c99c7)[_0xa1f34f(0x159)]+'\x20currencies');const _0x2ee1e1=Object[_0xa1f34f(0x153)](_0x1c99c7)[_0xa1f34f(0x188)](async([_0x61ac75,_0x5bb40f])=>{const _0x3d0dc4=_0xa1f34f;try{await database_1[_0x3d0dc4(0x14f)][_0x3d0dc4(0x165)][_0x3d0dc4(0x1b6)]({'where':{'currency':_0x61ac75['toLowerCase']()},'update':{'rate':_0x5bb40f},'create':{'currency':_0x61ac75[_0x3d0dc4(0x148)](),'rate':_0x5bb40f}});}catch(_0x28c19e){console[_0x3d0dc4(0x170)](_0x3d0dc4(0x192)+_0x61ac75+':',_0x28c19e);}});await Promise[_0xa1f34f(0x1b9)](_0x2ee1e1),console['log'](_0xa1f34f(0x1b3));}catch(_0x1227a8){console['error'](_0xa1f34f(0x157),_0x1227a8);throw _0x1227a8;}}async['getCurrencyRate'](_0x2bc36f){const _0x16cbb0=a51_0x261d1e,_0x580e75=_0x2bc36f[_0x16cbb0(0x148)]();if(_0x580e75===_0x16cbb0(0x15d))return 0x1;try{const _0x2628c8=await database_1['default'][_0x16cbb0(0x165)][_0x16cbb0(0x160)]({'where':{'currency':_0x580e75}});if(!_0x2628c8)return console[_0x16cbb0(0x183)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2bc36f+',\x20using\x201\x20as\x20fallback'),0x1;return _0x2628c8[_0x16cbb0(0x18c)];}catch(_0x1b3d7b){return console[_0x16cbb0(0x170)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x2bc36f+':',_0x1b3d7b),0x1;}}async[a51_0x261d1e(0x14c)](_0xb91ab1,_0x126f2b){const _0x37c827=a51_0x261d1e,_0xd45e7b=_0x126f2b[_0x37c827(0x148)]();if(_0xd45e7b===_0x37c827(0x15d)){const _0x297bdb=_0xb91ab1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x37c827(0x17b)+this[_0x37c827(0x166)]+_0x37c827(0x185)+_0xb91ab1+'\x20USDT\x20=\x20'+_0x297bdb['toFixed'](0x6)+_0x37c827(0x150)),_0x297bdb;}try{const _0xff29f4=await this[_0x37c827(0x1b5)](_0xd45e7b),_0x33af8c=_0xb91ab1/_0xff29f4,_0x4121ee=_0x33af8c*(0x1+this[_0x37c827(0x166)]/0x64);return console['log']('ðŸ’±\x20Converted\x20'+_0xb91ab1+'\x20'+_0x126f2b[_0x37c827(0x18b)]()+_0x37c827(0x15c)+_0x33af8c[_0x37c827(0x1a5)](0x6)+'\x20USDT,\x20with\x20'+this[_0x37c827(0x166)]+_0x37c827(0x19f)+_0x4121ee[_0x37c827(0x1a5)](0x6)+_0x37c827(0x193)+_0xff29f4+')'),_0x4121ee;}catch(_0x4e0061){console[_0x37c827(0x170)](_0x37c827(0x169)+_0xb91ab1+'\x20'+_0x126f2b+_0x37c827(0x15b),_0x4e0061);const _0x70d111=_0xb91ab1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x70d111;}}async[a51_0x261d1e(0x15a)](_0x43dce7){const _0x2e5d48=a51_0x261d1e;let _0x1753f5=0x0;for(const {amount:_0xd9973f,currency:_0xd5a6a7}of _0x43dce7){const _0x335de4=await this[_0x2e5d48(0x14c)](_0xd9973f,_0xd5a6a7);_0x1753f5+=_0x335de4;}return _0x1753f5;}async[a51_0x261d1e(0x1bd)](){const _0x4b0884=a51_0x261d1e;try{const _0x40f9d5=await database_1[_0x4b0884(0x14f)][_0x4b0884(0x165)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x184632={'usdt':0x1};return _0x40f9d5[_0x4b0884(0x176)](_0x396e46=>{const _0x5d7a04=_0x4b0884;_0x184632[_0x396e46[_0x5d7a04(0x189)]]=_0x396e46[_0x5d7a04(0x18c)];}),_0x184632;}catch(_0x2a4772){return console['error']('Error\x20getting\x20all\x20rates:',_0x2a4772),{'usdt':0x1};}}async[a51_0x261d1e(0x168)](){const _0x14b274=a51_0x261d1e;try{const [_0x49398d,_0x1d0601,_0x4c38c0]=await Promise['all']([database_1[_0x14b274(0x14f)]['currencyRate'][_0x14b274(0x17f)](),database_1[_0x14b274(0x14f)][_0x14b274(0x165)][_0x14b274(0x1a9)]({'orderBy':{'updatedAt':_0x14b274(0x184)},'select':{'updatedAt':!![]}}),database_1['default'][_0x14b274(0x165)][_0x14b274(0x1a9)]({'orderBy':{'updatedAt':_0x14b274(0x14d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x49398d,'lastUpdated':_0x1d0601?.[_0x14b274(0x1b0)]||null,'oldestRate':_0x4c38c0?.[_0x14b274(0x1b0)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x461a10){return console[_0x14b274(0x170)]('Error\x20getting\x20rates\x20status:',_0x461a10),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x14b274(0x166)]};}}[a51_0x261d1e(0x196)](){const _0x54e448=a51_0x261d1e;return this[_0x54e448(0x166)];}}exports[a51_0x261d1e(0x1b8)]=CurrencyService,exports[a51_0x261d1e(0x17d)]=new CurrencyService();