'use strict';const a49_0x47451f=a49_0x4f33;(function(_0x1b7885,_0xfc02c8){const _0x4925f5=a49_0x4f33,_0x1ce775=_0x1b7885();while(!![]){try{const _0x320642=parseInt(_0x4925f5(0xd1))/0x1*(-parseInt(_0x4925f5(0x89))/0x2)+-parseInt(_0x4925f5(0xcf))/0x3+parseInt(_0x4925f5(0xac))/0x4*(-parseInt(_0x4925f5(0x8e))/0x5)+parseInt(_0x4925f5(0xe2))/0x6*(-parseInt(_0x4925f5(0x6f))/0x7)+-parseInt(_0x4925f5(0x8c))/0x8*(-parseInt(_0x4925f5(0xbd))/0x9)+parseInt(_0x4925f5(0x92))/0xa+parseInt(_0x4925f5(0xcc))/0xb;if(_0x320642===_0xfc02c8)break;else _0x1ce775['push'](_0x1ce775['shift']());}catch(_0x44f484){_0x1ce775['push'](_0x1ce775['shift']());}}}(a49_0x1939,0x45cf7));function a49_0x1939(){const _0x28c823=['aed','thb','eos','nok','getMarkupPercentage','3312726cnZujr','getAllRates','ltc','__importDefault','gel','bdt','tether','cny','Payment\x20System/1.0','forEach','7eawBCL','kwd','updatedAt','yfi','updateInterval','application/json','\x20USDT\x20=\x20','__esModule','getCurrencyRate','xau','dot','MARKUP_PERCENTAGE','bnb','log','findMany','dkk','clp','join','Error\x20getting\x20all\x20rates:','ðŸ’±\x20Converted\x20','keys','sek','uah','default','brl','rate','118810nhLFhw','?ids=tether&vs_currencies=','krw','600672JQnBWe','error','3305BhyjRI','xrp','btc','php','11100XEQHeB','catch','\x20to\x20','eth','https://api.coingecko.com/api/v3/simple/price','bhd','bch','Error\x20getting\x20rates\x20status:','CURRENCIES','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','chf','ars','sgd','mmk','\x20USDT\x20(rate:\x20','toLowerCase','pkr','myr','convertToUSDT',',\x20using\x201\x20as\x20fallback','lkr','rub','\x20currencies','mxn','entries','allSettled','1132UkGHWL','%\x20markup\x20to\x20','%\x20markup\x20=\x20','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','jpy','ils','length','currencyService','gbp','sar','Error\x20getting\x20rate\x20for\x20currency\x20','defineProperty','statusText','desc','findFirst','updateCurrencyRates','status','18ynrMPD','currency','nzd','toUpperCase','ngn','ðŸ’±\x20Applied\x20','asc','CurrencyService','pln','\x20to\x20USDT:','bits','link','âœ…\x20Currency\x20rates\x20updated\x20successfully','hkd','Periodic\x20currency\x20rates\x20update\x20failed:','12028016LCgAZv','usd','twd','480606UTyuXb','COINGECKO_URL','1TlPapn','cad','vef','usdt','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','CoinGecko\x20API\x20error:\x20','startPeriodicUpdates','\x20USDT','upsert','currencyRate','aud','toFixed'];a49_0x1939=function(){return _0x28c823;};return a49_0x1939();}var __importDefault=this&&this[a49_0x47451f(0x68)]||function(_0x1efe0e){const _0x6bb028=a49_0x47451f;return _0x1efe0e&&_0x1efe0e[_0x6bb028(0x76)]?_0x1efe0e:{'default':_0x1efe0e};};Object[a49_0x47451f(0xb7)](exports,a49_0x47451f(0x76),{'value':!![]}),exports[a49_0x47451f(0xb3)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));function a49_0x4f33(_0x534ed5,_0x5972e1){_0x534ed5=_0x534ed5-0x68;const _0x1939ee=a49_0x1939();let _0x4f3333=_0x1939ee[_0x534ed5];return _0x4f3333;}class CurrencyService{constructor(){const _0x484d3a=a49_0x47451f;this[_0x484d3a(0xd0)]=_0x484d3a(0x96),this[_0x484d3a(0x9a)]=[_0x484d3a(0x90),_0x484d3a(0x95),_0x484d3a(0xe4),_0x484d3a(0x98),_0x484d3a(0x7b),_0x484d3a(0xdf),_0x484d3a(0x8f),'xlm',_0x484d3a(0xc8),_0x484d3a(0x79),_0x484d3a(0x72),_0x484d3a(0xcd),_0x484d3a(0xdd),_0x484d3a(0x9d),_0x484d3a(0xdb),_0x484d3a(0x6a),_0x484d3a(0x97),'bmd',_0x484d3a(0x87),_0x484d3a(0xd2),_0x484d3a(0x9c),_0x484d3a(0x7f),_0x484d3a(0x6c),'czk',_0x484d3a(0x7e),'eur',_0x484d3a(0xb4),_0x484d3a(0x69),_0x484d3a(0xca),'huf','idr',_0x484d3a(0xb1),'inr',_0x484d3a(0xb0),_0x484d3a(0x8b),_0x484d3a(0x70),_0x484d3a(0xa6),_0x484d3a(0x9f),_0x484d3a(0xa9),_0x484d3a(0xa3),_0x484d3a(0xc1),_0x484d3a(0xe0),_0x484d3a(0xbf),_0x484d3a(0x91),_0x484d3a(0xa2),_0x484d3a(0xc5),_0x484d3a(0xa7),_0x484d3a(0xb5),_0x484d3a(0x84),_0x484d3a(0x9e),_0x484d3a(0xde),'try',_0x484d3a(0xce),_0x484d3a(0x85),_0x484d3a(0xd3),'vnd','zar','xdr','xag',_0x484d3a(0x78),_0x484d3a(0xc7),'sats'],this[_0x484d3a(0x73)]=null,this[_0x484d3a(0x7a)]=-0x3,this[_0x484d3a(0xd7)]();}[a49_0x47451f(0xd7)](){const _0x330181=a49_0x47451f;this[_0x330181(0xbb)]()[_0x330181(0x93)](_0x2a5d0d=>{const _0x274ee3=_0x330181;console[_0x274ee3(0x8d)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x2a5d0d);}),this[_0x330181(0x73)]=setInterval(async()=>{const _0x481d37=_0x330181;try{await this[_0x481d37(0xbb)]();}catch(_0x32ecce){console[_0x481d37(0x8d)](_0x481d37(0xcb),_0x32ecce);}},0x3c*0x3c*0x3e8),console[_0x330181(0x7c)](_0x330181(0xaf));}['stopPeriodicUpdates'](){const _0x469ecf=a49_0x47451f;this['updateInterval']&&(clearInterval(this[_0x469ecf(0x73)]),this[_0x469ecf(0x73)]=null,console['log'](_0x469ecf(0x9b)));}async[a49_0x47451f(0xbb)](){const _0x2c0916=a49_0x47451f;try{console['log'](_0x2c0916(0xd5));const _0x3f7b52=this[_0x2c0916(0x9a)][_0x2c0916(0x80)](','),_0x3be0ce=this[_0x2c0916(0xd0)]+_0x2c0916(0x8a)+_0x3f7b52,_0x536f91=await fetch(_0x3be0ce,{'headers':{'Accept':_0x2c0916(0x74),'User-Agent':_0x2c0916(0x6d)}});if(!_0x536f91['ok'])throw new Error(_0x2c0916(0xd6)+_0x536f91[_0x2c0916(0xbc)]+'\x20'+_0x536f91[_0x2c0916(0xb8)]);const _0x256a9d=await _0x536f91['json']();if(!_0x256a9d[_0x2c0916(0x6b)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x32a1db=_0x256a9d[_0x2c0916(0x6b)];console[_0x2c0916(0x7c)]('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0x2c0916(0x83)](_0x32a1db)[_0x2c0916(0xb2)]+_0x2c0916(0xa8));const _0x39bff6=Object[_0x2c0916(0xaa)](_0x32a1db)['map'](async([_0x5bf2bd,_0x31a794])=>{const _0x5d725a=_0x2c0916;try{await database_1[_0x5d725a(0x86)][_0x5d725a(0xda)][_0x5d725a(0xd9)]({'where':{'currency':_0x5bf2bd[_0x5d725a(0xa1)]()},'update':{'rate':_0x31a794},'create':{'currency':_0x5bf2bd[_0x5d725a(0xa1)](),'rate':_0x31a794}});}catch(_0x3c6a27){console[_0x5d725a(0x8d)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x5bf2bd+':',_0x3c6a27);}});await Promise[_0x2c0916(0xab)](_0x39bff6),console[_0x2c0916(0x7c)](_0x2c0916(0xc9));}catch(_0x67d3cb){console[_0x2c0916(0x8d)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x67d3cb);throw _0x67d3cb;}}async['getCurrencyRate'](_0x584956){const _0x22b935=a49_0x47451f,_0x39eed9=_0x584956['toLowerCase']();if(_0x39eed9===_0x22b935(0xd4))return 0x1;try{const _0xbc7b52=await database_1[_0x22b935(0x86)]['currencyRate']['findUnique']({'where':{'currency':_0x39eed9}});if(!_0xbc7b52)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x584956+_0x22b935(0xa5)),0x1;return _0xbc7b52[_0x22b935(0x88)];}catch(_0x23d54a){return console[_0x22b935(0x8d)](_0x22b935(0xb6)+_0x584956+':',_0x23d54a),0x1;}}async[a49_0x47451f(0xa4)](_0x52cae2,_0xeabbd0){const _0x28ba61=a49_0x47451f,_0x579ede=_0xeabbd0[_0x28ba61(0xa1)]();if(_0x579ede===_0x28ba61(0xd4)){const _0x2ea48e=_0x52cae2*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x28ba61(0xc2)+this[_0x28ba61(0x7a)]+_0x28ba61(0xad)+_0x52cae2+_0x28ba61(0x75)+_0x2ea48e[_0x28ba61(0xdc)](0x6)+_0x28ba61(0xd8)),_0x2ea48e;}try{const _0x55bf21=await this[_0x28ba61(0x77)](_0x579ede),_0x311db9=_0x52cae2/_0x55bf21,_0x29c649=_0x311db9*(0x1+this[_0x28ba61(0x7a)]/0x64);return console[_0x28ba61(0x7c)](_0x28ba61(0x82)+_0x52cae2+'\x20'+_0xeabbd0[_0x28ba61(0xc0)]()+_0x28ba61(0x94)+_0x311db9[_0x28ba61(0xdc)](0x6)+'\x20USDT,\x20with\x20'+this[_0x28ba61(0x7a)]+_0x28ba61(0xae)+_0x29c649[_0x28ba61(0xdc)](0x6)+_0x28ba61(0xa0)+_0x55bf21+')'),_0x29c649;}catch(_0xd01cd7){console['error']('Error\x20converting\x20'+_0x52cae2+'\x20'+_0xeabbd0+_0x28ba61(0xc6),_0xd01cd7);const _0x53a94b=_0x52cae2*(0x1+this[_0x28ba61(0x7a)]/0x64);return _0x53a94b;}}async['convertMultipleToUSDT'](_0x528de0){const _0x21fcb8=a49_0x47451f;let _0x46ec0c=0x0;for(const {amount:_0x3f6cf0,currency:_0x48e201}of _0x528de0){const _0x5b5dfa=await this[_0x21fcb8(0xa4)](_0x3f6cf0,_0x48e201);_0x46ec0c+=_0x5b5dfa;}return _0x46ec0c;}async[a49_0x47451f(0xe3)](){const _0x838d19=a49_0x47451f;try{const _0x5e5de8=await database_1[_0x838d19(0x86)][_0x838d19(0xda)][_0x838d19(0x7d)]({'select':{'currency':!![],'rate':!![]}}),_0x18ec8d={'usdt':0x1};return _0x5e5de8[_0x838d19(0x6e)](_0xda98d9=>{const _0x12e5ee=_0x838d19;_0x18ec8d[_0xda98d9[_0x12e5ee(0xbe)]]=_0xda98d9[_0x12e5ee(0x88)];}),_0x18ec8d;}catch(_0x57c935){return console[_0x838d19(0x8d)](_0x838d19(0x81),_0x57c935),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2d9026=a49_0x47451f;try{const [_0x1e6fe3,_0x5eff5c,_0x29736f]=await Promise['all']([database_1[_0x2d9026(0x86)]['currencyRate']['count'](),database_1[_0x2d9026(0x86)][_0x2d9026(0xda)][_0x2d9026(0xba)]({'orderBy':{'updatedAt':_0x2d9026(0xb9)},'select':{'updatedAt':!![]}}),database_1[_0x2d9026(0x86)][_0x2d9026(0xda)][_0x2d9026(0xba)]({'orderBy':{'updatedAt':_0x2d9026(0xc3)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1e6fe3,'lastUpdated':_0x5eff5c?.[_0x2d9026(0x71)]||null,'oldestRate':_0x29736f?.[_0x2d9026(0x71)]||null,'markupPercentage':this[_0x2d9026(0x7a)]};}catch(_0x2b2cc6){return console[_0x2d9026(0x8d)](_0x2d9026(0x99),_0x2b2cc6),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2d9026(0x7a)]};}}[a49_0x47451f(0xe1)](){return this['MARKUP_PERCENTAGE'];}}exports[a49_0x47451f(0xc4)]=CurrencyService,exports[a49_0x47451f(0xb3)]=new CurrencyService();