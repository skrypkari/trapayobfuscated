'use strict';const a36_0x1b8b52=a36_0x2ac1;(function(_0x586173,_0x5b5734){const _0x39a4d0=a36_0x2ac1,_0x582aef=_0x586173();while(!![]){try{const _0x11272f=-parseInt(_0x39a4d0(0x8b))/0x1+parseInt(_0x39a4d0(0xd9))/0x2+-parseInt(_0x39a4d0(0x66))/0x3*(-parseInt(_0x39a4d0(0xbc))/0x4)+-parseInt(_0x39a4d0(0x6a))/0x5+-parseInt(_0x39a4d0(0xa5))/0x6*(-parseInt(_0x39a4d0(0xd0))/0x7)+parseInt(_0x39a4d0(0xc9))/0x8+parseInt(_0x39a4d0(0x93))/0x9*(parseInt(_0x39a4d0(0xce))/0xa);if(_0x11272f===_0x5b5734)break;else _0x582aef['push'](_0x582aef['shift']());}catch(_0x54b19b){_0x582aef['push'](_0x582aef['shift']());}}}(a36_0x5d40,0x55c94));function a36_0x5d40(){const _0x3fa6c6=['krw','27sseoyj','idr','brl','\x20to\x20','1500525KAVhvk','toUpperCase','status','CurrencyService','getCurrencyRate','findFirst','updateCurrencyRates','toLowerCase','tether','catch','ðŸ’±\x20Converted\x20','dkk','ðŸ’±\x20Applied\x20','\x20USDT\x20(rate:\x20','getAllRates','currencyService','COINGECKO_URL','%\x20markup\x20to\x20','hkd','updateInterval','myr','error','getRatesStatus','startPeriodicUpdates','length','xag','Initial\x20currency\x20rates\x20update\x20failed:','MARKUP_PERCENTAGE','inr','mmk','TesSoft\x20Payment\x20System/1.0','Error\x20getting\x20rate\x20for\x20currency\x20','nzd','698013mZovXX','sek','gbp','default','toFixed','\x20USDT','findMany','https://api.coingecko.com/api/v3/simple/price','7633107ddkuhp','application/json','eos','%\x20markup\x20=\x20','cad','nok','bdt','statusText','aud','btc','asc','jpy','json','xlm','log','twd','rub','usdt','12MCxJNJ','findUnique','clp','updatedAt','allSettled','ltc','\x20USDT,\x20with\x20','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','link','try','currencyRate','\x20currencies','bits','../config/database','ðŸ“Š\x20Received\x20rates\x20for\x20','cny','all','uah','usd','\x20to\x20USDT:','aed','warn','vef','139096ulwPzY','desc','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','__esModule','pkr','CoinGecko\x20API\x20error:\x20','huf','eur','keys','entries','eth','ars','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','627376pesgeQ','No\x20rate\x20found\x20for\x20currency:\x20','lkr','count','sgd','10AXUeCK','mxn','78162KYbnkE','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','dot','join','rate','currency','defineProperty','bnb','Error\x20converting\x20','175310QStOpi','convertToUSDT','Error\x20getting\x20rates\x20status:','yfi','sar'];a36_0x5d40=function(){return _0x3fa6c6;};return a36_0x5d40();}var __importDefault=this&&this['__importDefault']||function(_0x28ff0f){const _0xe91476=a36_0x2ac1;return _0x28ff0f&&_0x28ff0f[_0xe91476(0xbf)]?_0x28ff0f:{'default':_0x28ff0f};};Object[a36_0x1b8b52(0xd6)](exports,a36_0x1b8b52(0xbf),{'value':!![]}),exports['currencyService']=exports[a36_0x1b8b52(0x6d)]=void 0x0;const database_1=__importDefault(require(a36_0x1b8b52(0xb2)));class CurrencyService{constructor(){const _0x2b755f=a36_0x1b8b52;this[_0x2b755f(0x7a)]=_0x2b755f(0x92),this['CURRENCIES']=[_0x2b755f(0x9c),_0x2b755f(0xc6),_0x2b755f(0xaa),'bch',_0x2b755f(0xd7),_0x2b755f(0x95),'xrp',_0x2b755f(0xa0),_0x2b755f(0xad),_0x2b755f(0xd2),_0x2b755f(0xdc),_0x2b755f(0xb7),_0x2b755f(0xb9),_0x2b755f(0xc7),_0x2b755f(0x9b),_0x2b755f(0x99),'bhd','bmd',_0x2b755f(0x68),_0x2b755f(0x97),'chf',_0x2b755f(0xa7),_0x2b755f(0xb4),'czk',_0x2b755f(0x75),_0x2b755f(0xc3),_0x2b755f(0x8d),'gel',_0x2b755f(0x7c),_0x2b755f(0xc2),_0x2b755f(0x67),'ils',_0x2b755f(0x86),_0x2b755f(0x9e),_0x2b755f(0xde),'kwd',_0x2b755f(0xcb),_0x2b755f(0x87),_0x2b755f(0xcf),_0x2b755f(0x7e),'ngn',_0x2b755f(0x98),_0x2b755f(0x8a),'php',_0x2b755f(0xc0),'pln',_0x2b755f(0xa3),_0x2b755f(0xdd),_0x2b755f(0x8c),_0x2b755f(0xcd),'thb',_0x2b755f(0xae),_0x2b755f(0xa2),_0x2b755f(0xb6),_0x2b755f(0xbb),'vnd','zar','xdr',_0x2b755f(0x83),'xau',_0x2b755f(0xb1),'sats'],this[_0x2b755f(0x7d)]=null,this[_0x2b755f(0x85)]=0x3,this[_0x2b755f(0x81)]();}[a36_0x1b8b52(0x81)](){const _0x231582=a36_0x1b8b52;this[_0x231582(0x70)]()[_0x231582(0x73)](_0x518b1d=>{const _0x41fb62=_0x231582;console[_0x41fb62(0x7f)](_0x41fb62(0x84),_0x518b1d);}),this[_0x231582(0x7d)]=setInterval(async()=>{const _0x1e60c0=_0x231582;try{await this[_0x1e60c0(0x70)]();}catch(_0x29490a){console[_0x1e60c0(0x7f)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x29490a);}},0x3c*0x3c*0x3e8),console[_0x231582(0xa1)](_0x231582(0xc8));}['stopPeriodicUpdates'](){const _0x3f2e94=a36_0x1b8b52;this['updateInterval']&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console['log'](_0x3f2e94(0xd1)));}async[a36_0x1b8b52(0x70)](){const _0x32651b=a36_0x1b8b52;try{console[_0x32651b(0xa1)](_0x32651b(0xac));const _0x359446=this['CURRENCIES'][_0x32651b(0xd3)](','),_0x143ad9=this[_0x32651b(0x7a)]+'?ids=tether&vs_currencies='+_0x359446,_0x15faa4=await fetch(_0x143ad9,{'headers':{'Accept':_0x32651b(0x94),'User-Agent':_0x32651b(0x88)}});if(!_0x15faa4['ok'])throw new Error(_0x32651b(0xc1)+_0x15faa4[_0x32651b(0x6c)]+'\x20'+_0x15faa4[_0x32651b(0x9a)]);const _0x1c9384=await _0x15faa4[_0x32651b(0x9f)]();if(!_0x1c9384[_0x32651b(0x72)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x2abedc=_0x1c9384[_0x32651b(0x72)];console[_0x32651b(0xa1)](_0x32651b(0xb3)+Object[_0x32651b(0xc4)](_0x2abedc)[_0x32651b(0x82)]+_0x32651b(0xb0));const _0x2fccd9=Object[_0x32651b(0xc5)](_0x2abedc)['map'](async([_0x46196b,_0x68d2c3])=>{const _0x9fa184=_0x32651b;try{await database_1[_0x9fa184(0x8e)][_0x9fa184(0xaf)]['upsert']({'where':{'currency':_0x46196b[_0x9fa184(0x71)]()},'update':{'rate':_0x68d2c3},'create':{'currency':_0x46196b[_0x9fa184(0x71)](),'rate':_0x68d2c3}});}catch(_0x4f7973){console[_0x9fa184(0x7f)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x46196b+':',_0x4f7973);}});await Promise[_0x32651b(0xa9)](_0x2fccd9),console[_0x32651b(0xa1)]('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4b62ea){console[_0x32651b(0x7f)](_0x32651b(0xbe),_0x4b62ea);throw _0x4b62ea;}}async[a36_0x1b8b52(0x6e)](_0x4b07ba){const _0x14f79a=a36_0x1b8b52,_0x29a005=_0x4b07ba[_0x14f79a(0x71)]();if(_0x29a005===_0x14f79a(0xa4))return 0x1;try{const _0x1573f4=await database_1['default'][_0x14f79a(0xaf)][_0x14f79a(0xa6)]({'where':{'currency':_0x29a005}});if(!_0x1573f4)return console[_0x14f79a(0xba)](_0x14f79a(0xca)+_0x4b07ba+',\x20using\x201\x20as\x20fallback'),0x1;return _0x1573f4[_0x14f79a(0xd4)];}catch(_0x7ce452){return console[_0x14f79a(0x7f)](_0x14f79a(0x89)+_0x4b07ba+':',_0x7ce452),0x1;}}async[a36_0x1b8b52(0xda)](_0x1cb474,_0x27abf9){const _0x152471=a36_0x1b8b52,_0x545a5d=_0x27abf9['toLowerCase']();if(_0x545a5d===_0x152471(0xa4)){const _0x17f61c=_0x1cb474*(0x1+this[_0x152471(0x85)]/0x64);return console[_0x152471(0xa1)](_0x152471(0x76)+this[_0x152471(0x85)]+_0x152471(0x7b)+_0x1cb474+'\x20USDT\x20=\x20'+_0x17f61c[_0x152471(0x8f)](0x6)+_0x152471(0x90)),_0x17f61c;}try{const _0x26482a=await this[_0x152471(0x6e)](_0x545a5d),_0x2b7dad=_0x1cb474/_0x26482a,_0x5e357f=_0x2b7dad*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x152471(0xa1)](_0x152471(0x74)+_0x1cb474+'\x20'+_0x27abf9[_0x152471(0x6b)]()+_0x152471(0x69)+_0x2b7dad[_0x152471(0x8f)](0x6)+_0x152471(0xab)+this['MARKUP_PERCENTAGE']+_0x152471(0x96)+_0x5e357f[_0x152471(0x8f)](0x6)+_0x152471(0x77)+_0x26482a+')'),_0x5e357f;}catch(_0x488142){console[_0x152471(0x7f)](_0x152471(0xd8)+_0x1cb474+'\x20'+_0x27abf9+_0x152471(0xb8),_0x488142);const _0x2e72c9=_0x1cb474*(0x1+this[_0x152471(0x85)]/0x64);return _0x2e72c9;}}async['convertMultipleToUSDT'](_0x3b5e11){const _0x1363cc=a36_0x1b8b52;let _0x49a694=0x0;for(const {amount:_0xcea392,currency:_0x17b485}of _0x3b5e11){const _0x2cea95=await this[_0x1363cc(0xda)](_0xcea392,_0x17b485);_0x49a694+=_0x2cea95;}return _0x49a694;}async[a36_0x1b8b52(0x78)](){const _0x2942e5=a36_0x1b8b52;try{const _0x535cec=await database_1[_0x2942e5(0x8e)]['currencyRate'][_0x2942e5(0x91)]({'select':{'currency':!![],'rate':!![]}}),_0x364e78={'usdt':0x1};return _0x535cec['forEach'](_0x1ee904=>{const _0x4ded12=_0x2942e5;_0x364e78[_0x1ee904[_0x4ded12(0xd5)]]=_0x1ee904[_0x4ded12(0xd4)];}),_0x364e78;}catch(_0x490658){return console[_0x2942e5(0x7f)]('Error\x20getting\x20all\x20rates:',_0x490658),{'usdt':0x1};}}async[a36_0x1b8b52(0x80)](){const _0x48c78d=a36_0x1b8b52;try{const [_0x415bab,_0x15dd4b,_0xa50928]=await Promise[_0x48c78d(0xb5)]([database_1[_0x48c78d(0x8e)][_0x48c78d(0xaf)][_0x48c78d(0xcc)](),database_1[_0x48c78d(0x8e)][_0x48c78d(0xaf)][_0x48c78d(0x6f)]({'orderBy':{'updatedAt':_0x48c78d(0xbd)},'select':{'updatedAt':!![]}}),database_1[_0x48c78d(0x8e)][_0x48c78d(0xaf)][_0x48c78d(0x6f)]({'orderBy':{'updatedAt':_0x48c78d(0x9d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x415bab,'lastUpdated':_0x15dd4b?.['updatedAt']||null,'oldestRate':_0xa50928?.[_0x48c78d(0xa8)]||null,'markupPercentage':this[_0x48c78d(0x85)]};}catch(_0x189bb1){return console['error'](_0x48c78d(0xdb),_0x189bb1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}function a36_0x2ac1(_0x3602e3,_0x182c3c){const _0x5d4042=a36_0x5d40();return a36_0x2ac1=function(_0x2ac18b,_0x435a45){_0x2ac18b=_0x2ac18b-0x66;let _0x4ff6d5=_0x5d4042[_0x2ac18b];return _0x4ff6d5;},a36_0x2ac1(_0x3602e3,_0x182c3c);}exports[a36_0x1b8b52(0x6d)]=CurrencyService,exports[a36_0x1b8b52(0x79)]=new CurrencyService();