'use strict';const a36_0xde57e4=a36_0x1c88;function a36_0x241b(){const _0x52c1e3=['currencyRate','cny','__esModule','huf','catch','currencyService','MARKUP_PERCENTAGE','2815540zyfAaX','json','CURRENCIES','3414897sbaulr','70vDrcNI','clp','bdt','\x20USDT\x20=\x20','1171216sNkMzA','ðŸ“Š\x20Received\x20rates\x20for\x20','../config/database','6KONoAH','aud','COINGECKO_URL','\x20to\x20','updateInterval','lkr','270174SjXnbF','xag','ars','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','chf','convertToUSDT','uah','ngn','âœ…\x20Currency\x20rates\x20updated\x20successfully','inr','warn','entries','php','%\x20markup\x20to\x20','xdr','dot','usd','CoinGecko\x20API\x20error:\x20','forEach','ðŸ’±\x20Applied\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','twd','bhd','length','__importDefault','eur','\x20USDT,\x20with\x20','49qupbDU','keys','ðŸ’±\x20Converted\x20','aed','getMarkupPercentage','dkk','pkr','error','Error\x20converting\x20','brl','rate','toLowerCase','getRatesStatus','myr','upsert','asc','497331GLYulo','zar',',\x20using\x201\x20as\x20fallback','pln','all','toFixed','jpy','kwd','stopPeriodicUpdates','bmd','xrp','getCurrencyRate','vnd','bits','hkd','\x20to\x20USDT:','sek','startPeriodicUpdates','ltc','defineProperty','\x20USDT','application/json','25498580gCKhOE','nok','allSettled','CurrencyService','?ids=tether&vs_currencies=','mxn','try','https://api.coingecko.com/api/v3/simple/price','%\x20markup\x20=\x20','log','Failed\x20to\x20update\x20rate\x20for\x20','btc','nzd','default','\x20currencies','198310qHMzTC','bch','gbp','updatedAt','getAllRates','currency','usdt','findFirst','tether','map','xau','count','eth','mmk','No\x20rate\x20found\x20for\x20currency:\x20','findUnique','Periodic\x20currency\x20rates\x20update\x20failed:','yfi','status','krw','bnb','convertMultipleToUSDT'];a36_0x241b=function(){return _0x52c1e3;};return a36_0x241b();}(function(_0x1ec27b,_0x187888){const _0x41f7cb=a36_0x1c88,_0x48fcdb=_0x1ec27b();while(!![]){try{const _0x1205ff=-parseInt(_0x41f7cb(0x1af))/0x1+parseInt(_0x41f7cb(0x1d7))/0x2*(-parseInt(_0x41f7cb(0x208))/0x3)+parseInt(_0x41f7cb(0x1cc))/0x4+parseInt(_0x41f7cb(0x1d0))/0x5*(-parseInt(_0x41f7cb(0x1dd))/0x6)+-parseInt(_0x41f7cb(0x1f8))/0x7*(parseInt(_0x41f7cb(0x1d4))/0x8)+-parseInt(_0x41f7cb(0x1cf))/0x9+parseInt(_0x41f7cb(0x1a0))/0xa;if(_0x1205ff===_0x187888)break;else _0x48fcdb['push'](_0x48fcdb['shift']());}catch(_0x271149){_0x48fcdb['push'](_0x48fcdb['shift']());}}}(a36_0x241b,0x7fcb9));var __importDefault=this&&this[a36_0xde57e4(0x1f5)]||function(_0x3387cd){return _0x3387cd&&_0x3387cd['__esModule']?_0x3387cd:{'default':_0x3387cd};};Object[a36_0xde57e4(0x19d)](exports,a36_0xde57e4(0x1c7),{'value':!![]}),exports[a36_0xde57e4(0x1ca)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a36_0xde57e4(0x1d6)));function a36_0x1c88(_0x59eecd,_0x17f505){const _0x241bd3=a36_0x241b();return a36_0x1c88=function(_0x1c88e4,_0x5f31f3){_0x1c88e4=_0x1c88e4-0x192;let _0x29e4f3=_0x241bd3[_0x1c88e4];return _0x29e4f3;},a36_0x1c88(_0x59eecd,_0x17f505);}class CurrencyService{constructor(){const _0x60a86f=a36_0xde57e4;this['COINGECKO_URL']=_0x60a86f(0x1a7),this['CURRENCIES']=[_0x60a86f(0x1ab),_0x60a86f(0x1bb),_0x60a86f(0x19c),_0x60a86f(0x1b0),_0x60a86f(0x1c3),'eos',_0x60a86f(0x194),'xlm','link',_0x60a86f(0x1ec),_0x60a86f(0x1c0),_0x60a86f(0x1ed),_0x60a86f(0x1fb),_0x60a86f(0x1df),_0x60a86f(0x1d8),_0x60a86f(0x1d2),_0x60a86f(0x1f3),_0x60a86f(0x193),_0x60a86f(0x201),'cad',_0x60a86f(0x1e1),_0x60a86f(0x1d1),_0x60a86f(0x1c6),'czk',_0x60a86f(0x1fd),_0x60a86f(0x1f6),_0x60a86f(0x1b1),'gel',_0x60a86f(0x198),_0x60a86f(0x1c8),'idr','ils',_0x60a86f(0x1e6),_0x60a86f(0x20e),_0x60a86f(0x1c2),_0x60a86f(0x20f),_0x60a86f(0x1dc),_0x60a86f(0x1bc),_0x60a86f(0x1a5),_0x60a86f(0x205),_0x60a86f(0x1e4),_0x60a86f(0x1a1),_0x60a86f(0x1ac),_0x60a86f(0x1e9),_0x60a86f(0x1fe),_0x60a86f(0x20b),'rub','sar',_0x60a86f(0x19a),'sgd','thb',_0x60a86f(0x1a6),_0x60a86f(0x1f2),_0x60a86f(0x1e3),'vef',_0x60a86f(0x196),_0x60a86f(0x209),_0x60a86f(0x1eb),_0x60a86f(0x1de),_0x60a86f(0x1b9),_0x60a86f(0x197),'sats'],this[_0x60a86f(0x1db)]=null,this[_0x60a86f(0x1cb)]=0x3,this[_0x60a86f(0x19b)]();}[a36_0xde57e4(0x19b)](){const _0x30fe86=a36_0xde57e4;this['updateCurrencyRates']()[_0x30fe86(0x1c9)](_0x494125=>{const _0x20ab31=_0x30fe86;console[_0x20ab31(0x1ff)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x494125);}),this[_0x30fe86(0x1db)]=setInterval(async()=>{const _0x4919cc=_0x30fe86;try{await this['updateCurrencyRates']();}catch(_0x44032c){console[_0x4919cc(0x1ff)](_0x4919cc(0x1bf),_0x44032c);}},0x3c*0x3c*0x3e8),console[_0x30fe86(0x1a9)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a36_0xde57e4(0x192)](){const _0x4ad3dd=a36_0xde57e4;this[_0x4ad3dd(0x1db)]&&(clearInterval(this[_0x4ad3dd(0x1db)]),this['updateInterval']=null,console[_0x4ad3dd(0x1a9)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x501cf1=a36_0xde57e4;try{console[_0x501cf1(0x1a9)](_0x501cf1(0x1e0));const _0x5d81c7=this[_0x501cf1(0x1ce)]['join'](','),_0x52dc3f=this[_0x501cf1(0x1d9)]+_0x501cf1(0x1a4)+_0x5d81c7,_0x59be31=await fetch(_0x52dc3f,{'headers':{'Accept':_0x501cf1(0x19f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x59be31['ok'])throw new Error(_0x501cf1(0x1ee)+_0x59be31[_0x501cf1(0x1c1)]+'\x20'+_0x59be31['statusText']);const _0x1c4f09=await _0x59be31[_0x501cf1(0x1cd)]();if(!_0x1c4f09[_0x501cf1(0x1b7)])throw new Error(_0x501cf1(0x1f1));const _0x39db7a=_0x1c4f09[_0x501cf1(0x1b7)];console[_0x501cf1(0x1a9)](_0x501cf1(0x1d5)+Object[_0x501cf1(0x1f9)](_0x39db7a)[_0x501cf1(0x1f4)]+_0x501cf1(0x1ae));const _0x322e54=Object[_0x501cf1(0x1e8)](_0x39db7a)[_0x501cf1(0x1b8)](async([_0x43c597,_0x3227b6])=>{const _0x46bc76=_0x501cf1;try{await database_1['default'][_0x46bc76(0x1c5)][_0x46bc76(0x206)]({'where':{'currency':_0x43c597['toLowerCase']()},'update':{'rate':_0x3227b6},'create':{'currency':_0x43c597[_0x46bc76(0x203)](),'rate':_0x3227b6}});}catch(_0x1325ce){console[_0x46bc76(0x1ff)](_0x46bc76(0x1aa)+_0x43c597+':',_0x1325ce);}});await Promise[_0x501cf1(0x1a2)](_0x322e54),console[_0x501cf1(0x1a9)](_0x501cf1(0x1e5));}catch(_0x43d368){console['error']('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x43d368);throw _0x43d368;}}async[a36_0xde57e4(0x195)](_0x5a3c08){const _0x4c5da6=a36_0xde57e4,_0x2450fb=_0x5a3c08['toLowerCase']();if(_0x2450fb===_0x4c5da6(0x1b5))return 0x1;try{const _0xb206e=await database_1['default'][_0x4c5da6(0x1c5)][_0x4c5da6(0x1be)]({'where':{'currency':_0x2450fb}});if(!_0xb206e)return console[_0x4c5da6(0x1e7)](_0x4c5da6(0x1bd)+_0x5a3c08+_0x4c5da6(0x20a)),0x1;return _0xb206e['rate'];}catch(_0x14f59f){return console[_0x4c5da6(0x1ff)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x5a3c08+':',_0x14f59f),0x1;}}async[a36_0xde57e4(0x1e2)](_0x5615c5,_0x12a5b3){const _0x3b5dea=a36_0xde57e4,_0x29f8d1=_0x12a5b3['toLowerCase']();if(_0x29f8d1===_0x3b5dea(0x1b5)){const _0xf0ffcd=_0x5615c5*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x3b5dea(0x1f0)+this[_0x3b5dea(0x1cb)]+_0x3b5dea(0x1ea)+_0x5615c5+_0x3b5dea(0x1d3)+_0xf0ffcd[_0x3b5dea(0x20d)](0x6)+_0x3b5dea(0x19e)),_0xf0ffcd;}try{const _0x393ad2=await this['getCurrencyRate'](_0x29f8d1),_0x262911=_0x5615c5/_0x393ad2,_0x3bf3a9=_0x262911*(0x1+this[_0x3b5dea(0x1cb)]/0x64);return console[_0x3b5dea(0x1a9)](_0x3b5dea(0x1fa)+_0x5615c5+'\x20'+_0x12a5b3['toUpperCase']()+_0x3b5dea(0x1da)+_0x262911['toFixed'](0x6)+_0x3b5dea(0x1f7)+this[_0x3b5dea(0x1cb)]+_0x3b5dea(0x1a8)+_0x3bf3a9[_0x3b5dea(0x20d)](0x6)+'\x20USDT\x20(rate:\x20'+_0x393ad2+')'),_0x3bf3a9;}catch(_0x58b246){console[_0x3b5dea(0x1ff)](_0x3b5dea(0x200)+_0x5615c5+'\x20'+_0x12a5b3+_0x3b5dea(0x199),_0x58b246);const _0x3cec5f=_0x5615c5*(0x1+this[_0x3b5dea(0x1cb)]/0x64);return _0x3cec5f;}}async[a36_0xde57e4(0x1c4)](_0x5aedcf){const _0xfd3592=a36_0xde57e4;let _0xd6feea=0x0;for(const {amount:_0x1edc12,currency:_0x5f4a3e}of _0x5aedcf){const _0x517d26=await this[_0xfd3592(0x1e2)](_0x1edc12,_0x5f4a3e);_0xd6feea+=_0x517d26;}return _0xd6feea;}async[a36_0xde57e4(0x1b3)](){const _0x29a5ea=a36_0xde57e4;try{const _0x3b8596=await database_1['default'][_0x29a5ea(0x1c5)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x5897d9={'usdt':0x1};return _0x3b8596[_0x29a5ea(0x1ef)](_0x269176=>{const _0x123a26=_0x29a5ea;_0x5897d9[_0x269176[_0x123a26(0x1b4)]]=_0x269176[_0x123a26(0x202)];}),_0x5897d9;}catch(_0x596229){return console['error']('Error\x20getting\x20all\x20rates:',_0x596229),{'usdt':0x1};}}async[a36_0xde57e4(0x204)](){const _0x4184cd=a36_0xde57e4;try{const [_0x56891d,_0x25a34e,_0x46df22]=await Promise[_0x4184cd(0x20c)]([database_1[_0x4184cd(0x1ad)][_0x4184cd(0x1c5)][_0x4184cd(0x1ba)](),database_1['default'][_0x4184cd(0x1c5)][_0x4184cd(0x1b6)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x4184cd(0x1ad)][_0x4184cd(0x1c5)][_0x4184cd(0x1b6)]({'orderBy':{'updatedAt':_0x4184cd(0x207)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x56891d,'lastUpdated':_0x25a34e?.[_0x4184cd(0x1b2)]||null,'oldestRate':_0x46df22?.[_0x4184cd(0x1b2)]||null,'markupPercentage':this[_0x4184cd(0x1cb)]};}catch(_0x2c6b73){return console[_0x4184cd(0x1ff)]('Error\x20getting\x20rates\x20status:',_0x2c6b73),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4184cd(0x1cb)]};}}[a36_0xde57e4(0x1fc)](){const _0x561f02=a36_0xde57e4;return this[_0x561f02(0x1cb)];}}exports[a36_0xde57e4(0x1a3)]=CurrencyService,exports[a36_0xde57e4(0x1ca)]=new CurrencyService();