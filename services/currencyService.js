'use strict';const a41_0x23220=a41_0x5ec5;(function(_0xe47cfa,_0x5e9fed){const _0x4033d5=a41_0x5ec5,_0x3fea06=_0xe47cfa();while(!![]){try{const _0x25333a=parseInt(_0x4033d5(0x10d))/0x1+parseInt(_0x4033d5(0xa8))/0x2*(-parseInt(_0x4033d5(0xee))/0x3)+-parseInt(_0x4033d5(0xd7))/0x4*(parseInt(_0x4033d5(0xcd))/0x5)+-parseInt(_0x4033d5(0xae))/0x6*(parseInt(_0x4033d5(0x11a))/0x7)+-parseInt(_0x4033d5(0x117))/0x8*(-parseInt(_0x4033d5(0xc7))/0x9)+parseInt(_0x4033d5(0xd9))/0xa*(-parseInt(_0x4033d5(0x119))/0xb)+parseInt(_0x4033d5(0xaa))/0xc;if(_0x25333a===_0x5e9fed)break;else _0x3fea06['push'](_0x3fea06['shift']());}catch(_0x5e2700){_0x3fea06['push'](_0x3fea06['shift']());}}}(a41_0x4612,0xb9273));function a41_0x5ec5(_0x1af4d0,_0x29a60d){const _0x4612d8=a41_0x4612();return a41_0x5ec5=function(_0x5ec5ec,_0x3f9182){_0x5ec5ec=_0x5ec5ec-0xa7;let _0x2b934f=_0x4612d8[_0x5ec5ec];return _0x2b934f;},a41_0x5ec5(_0x1af4d0,_0x29a60d);}var __importDefault=this&&this[a41_0x23220(0x112)]||function(_0xc59942){const _0x3f0d7d=a41_0x23220;return _0xc59942&&_0xc59942[_0x3f0d7d(0xfb)]?_0xc59942:{'default':_0xc59942};};Object['defineProperty'](exports,a41_0x23220(0xfb),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x34f03d=a41_0x23220;this[_0x34f03d(0xa9)]=_0x34f03d(0xdf),this['CURRENCIES']=[_0x34f03d(0x107),'eth',_0x34f03d(0xcb),'bch',_0x34f03d(0x10c),_0x34f03d(0xcf),'xrp',_0x34f03d(0xcc),_0x34f03d(0xc3),_0x34f03d(0xa7),_0x34f03d(0xb5),_0x34f03d(0xe5),'aed','ars',_0x34f03d(0xea),_0x34f03d(0xf7),_0x34f03d(0xff),_0x34f03d(0xe1),_0x34f03d(0x10b),'cad',_0x34f03d(0xda),_0x34f03d(0xd1),_0x34f03d(0x109),_0x34f03d(0xbd),_0x34f03d(0xc5),_0x34f03d(0xb1),_0x34f03d(0xe6),_0x34f03d(0xb7),'hkd','huf','idr',_0x34f03d(0xb3),_0x34f03d(0xe3),_0x34f03d(0x108),_0x34f03d(0x11e),_0x34f03d(0xb9),_0x34f03d(0xe9),_0x34f03d(0xc1),_0x34f03d(0x106),_0x34f03d(0x115),_0x34f03d(0xfe),_0x34f03d(0xf8),'nzd',_0x34f03d(0xeb),_0x34f03d(0x10e),_0x34f03d(0xc9),_0x34f03d(0x121),'sar',_0x34f03d(0x105),_0x34f03d(0xe2),_0x34f03d(0xf4),_0x34f03d(0x101),_0x34f03d(0xf3),_0x34f03d(0xc8),_0x34f03d(0x118),'vnd',_0x34f03d(0xaf),_0x34f03d(0xd3),_0x34f03d(0xd2),'xau',_0x34f03d(0xad),_0x34f03d(0xbc)],this[_0x34f03d(0xf0)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x34f03d(0xdd)]();}[a41_0x23220(0xdd)](){const _0xb8317f=a41_0x23220;this['updateCurrencyRates']()[_0xb8317f(0x10f)](_0x4d7949=>{const _0x431ed9=_0xb8317f;console['error'](_0x431ed9(0xfd),_0x4d7949);}),this[_0xb8317f(0xf0)]=setInterval(async()=>{const _0x513d3b=_0xb8317f;try{await this['updateCurrencyRates']();}catch(_0xa55b9){console[_0x513d3b(0xb0)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0xa55b9);}},0x3c*0x3c*0x3e8),console[_0xb8317f(0x11b)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a41_0x23220(0xe7)](){const _0xb0156a=a41_0x23220;this[_0xb0156a(0xf0)]&&(clearInterval(this[_0xb0156a(0xf0)]),this[_0xb0156a(0xf0)]=null,console['log'](_0xb0156a(0xbf)));}async[a41_0x23220(0xd5)](){const _0x519903=a41_0x23220;try{console[_0x519903(0x11b)](_0x519903(0xce));const _0x16d8fa=this[_0x519903(0xfa)][_0x519903(0x110)](','),_0x341bf5=this[_0x519903(0xa9)]+_0x519903(0x103)+_0x16d8fa,_0x15a03b=await fetch(_0x341bf5,{'headers':{'Accept':_0x519903(0xc4),'User-Agent':'Payment\x20System/1.0'}});if(!_0x15a03b['ok'])throw new Error(_0x519903(0xf2)+_0x15a03b['status']+'\x20'+_0x15a03b['statusText']);const _0x9b249b=await _0x15a03b[_0x519903(0xd0)]();if(!_0x9b249b[_0x519903(0xf1)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0xe9a525=_0x9b249b[_0x519903(0xf1)];console[_0x519903(0x11b)](_0x519903(0xb6)+Object['keys'](_0xe9a525)[_0x519903(0xf5)]+_0x519903(0xd8));const _0x3febad=Object['entries'](_0xe9a525)[_0x519903(0x102)](async([_0x3e54d0,_0x573fca])=>{const _0x1fd51c=_0x519903;try{await database_1[_0x1fd51c(0x114)][_0x1fd51c(0xba)]['upsert']({'where':{'currency':_0x3e54d0['toLowerCase']()},'update':{'rate':_0x573fca},'create':{'currency':_0x3e54d0[_0x1fd51c(0xed)](),'rate':_0x573fca}});}catch(_0x2ee175){console[_0x1fd51c(0xb0)](_0x1fd51c(0x113)+_0x3e54d0+':',_0x2ee175);}});await Promise['allSettled'](_0x3febad),console['log'](_0x519903(0x100));}catch(_0x5017ef){console[_0x519903(0xb0)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x5017ef);throw _0x5017ef;}}async[a41_0x23220(0xdb)](_0x5b2396){const _0x17ef57=a41_0x23220,_0x2cff88=_0x5b2396[_0x17ef57(0xed)]();if(_0x2cff88==='usdt')return 0x1;try{const _0x361eb2=await database_1[_0x17ef57(0x114)][_0x17ef57(0xba)][_0x17ef57(0xc2)]({'where':{'currency':_0x2cff88}});if(!_0x361eb2)return console[_0x17ef57(0xd4)](_0x17ef57(0x122)+_0x5b2396+_0x17ef57(0xac)),0x1;return _0x361eb2[_0x17ef57(0xe4)];}catch(_0x3b69ba){return console[_0x17ef57(0xb0)](_0x17ef57(0xbb)+_0x5b2396+':',_0x3b69ba),0x1;}}async[a41_0x23220(0x10a)](_0x4ed9bb,_0x1fff3b){const _0x5a594a=a41_0x23220,_0x4bba25=_0x1fff3b['toLowerCase']();if(_0x4bba25===_0x5a594a(0xca)){const _0x3dd494=_0x4ed9bb*(0x1+this[_0x5a594a(0x11d)]/0x64);return console[_0x5a594a(0x11b)](_0x5a594a(0x11f)+this[_0x5a594a(0x11d)]+_0x5a594a(0xef)+_0x4ed9bb+_0x5a594a(0xbe)+_0x3dd494[_0x5a594a(0xab)](0x6)+_0x5a594a(0xd6)),_0x3dd494;}try{const _0x2a0317=await this[_0x5a594a(0xdb)](_0x4bba25),_0x16115b=_0x4ed9bb/_0x2a0317,_0x38c6fc=_0x16115b*(0x1+this[_0x5a594a(0x11d)]/0x64);return console[_0x5a594a(0x11b)](_0x5a594a(0xec)+_0x4ed9bb+'\x20'+_0x1fff3b['toUpperCase']()+_0x5a594a(0x120)+_0x16115b[_0x5a594a(0xab)](0x6)+_0x5a594a(0x11c)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x38c6fc[_0x5a594a(0xab)](0x6)+'\x20USDT\x20(rate:\x20'+_0x2a0317+')'),_0x38c6fc;}catch(_0x35b7c3){console['error'](_0x5a594a(0x104)+_0x4ed9bb+'\x20'+_0x1fff3b+_0x5a594a(0xc6),_0x35b7c3);const _0x1361df=_0x4ed9bb*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x1361df;}}async[a41_0x23220(0xf9)](_0x21c021){let _0x4cb82e=0x0;for(const {amount:_0x3914f7,currency:_0x387de2}of _0x21c021){const _0x2c3c35=await this['convertToUSDT'](_0x3914f7,_0x387de2);_0x4cb82e+=_0x2c3c35;}return _0x4cb82e;}async[a41_0x23220(0xc0)](){const _0x1ed1bb=a41_0x23220;try{const _0x3e7294=await database_1['default'][_0x1ed1bb(0xba)][_0x1ed1bb(0xf6)]({'select':{'currency':!![],'rate':!![]}}),_0x5ab1fc={'usdt':0x1};return _0x3e7294[_0x1ed1bb(0xe8)](_0x45493b=>{const _0x1c1ad9=_0x1ed1bb;_0x5ab1fc[_0x45493b[_0x1c1ad9(0xfc)]]=_0x45493b[_0x1c1ad9(0xe4)];}),_0x5ab1fc;}catch(_0x79506d){return console[_0x1ed1bb(0xb0)]('Error\x20getting\x20all\x20rates:',_0x79506d),{'usdt':0x1};}}async[a41_0x23220(0xb4)](){const _0x12d823=a41_0x23220;try{const [_0x2eac4f,_0x31ef25,_0x4b0714]=await Promise[_0x12d823(0xe0)]([database_1['default'][_0x12d823(0xba)]['count'](),database_1[_0x12d823(0x114)][_0x12d823(0xba)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x12d823(0x114)][_0x12d823(0xba)][_0x12d823(0xb8)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2eac4f,'lastUpdated':_0x31ef25?.[_0x12d823(0xde)]||null,'oldestRate':_0x4b0714?.['updatedAt']||null,'markupPercentage':this[_0x12d823(0x11d)]};}catch(_0x528e1e){return console[_0x12d823(0xb0)](_0x12d823(0xb2),_0x528e1e),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x12d823(0x11d)]};}}[a41_0x23220(0xdc)](){const _0x22cdc3=a41_0x23220;return this[_0x22cdc3(0x11d)];}}exports[a41_0x23220(0x111)]=CurrencyService,exports[a41_0x23220(0x116)]=new CurrencyService();function a41_0x4612(){const _0x2e9d36=['bits','18BZnopS','zar','error','eur','Error\x20getting\x20rates\x20status:','ils','getRatesStatus','yfi','📊\x20Received\x20rates\x20for\x20','gel','findFirst','kwd','currencyRate','Error\x20getting\x20rate\x20for\x20currency\x20','sats','czk','\x20USDT\x20=\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','getAllRates','mmk','findUnique','link','application/json','dkk','\x20to\x20USDT:','2639799Sojovo','uah','pln','usdt','ltc','xlm','349795dBgiUG','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','eos','json','clp','xag','xdr','warn','updateCurrencyRates','\x20USDT','16ajjFKh','\x20currencies','899650cSvUTu','chf','getCurrencyRate','getMarkupPercentage','startPeriodicUpdates','updatedAt','https://api.coingecko.com/api/v3/simple/price','all','bmd','sgd','inr','rate','usd','gbp','stopPeriodicUpdates','forEach','lkr','aud','php','💱\x20Converted\x20','toLowerCase','16689QvBAij','%\x20markup\x20to\x20','updateInterval','tether','CoinGecko\x20API\x20error:\x20','twd','thb','length','findMany','bdt','nok','convertMultipleToUSDT','CURRENCIES','__esModule','currency','Initial\x20currency\x20rates\x20update\x20failed:','ngn','bhd','✅\x20Currency\x20rates\x20updated\x20successfully','try','map','?ids=tether&vs_currencies=','Error\x20converting\x20','sek','mxn','btc','jpy','cny','convertToUSDT','brl','bnb','717907kNsWos','pkr','catch','join','CurrencyService','__importDefault','Failed\x20to\x20update\x20rate\x20for\x20','default','myr','currencyService','40DSoBZW','vef','143VpQPIU','2264045FZXxQa','log','\x20USDT,\x20with\x20','MARKUP_PERCENTAGE','krw','💱\x20Applied\x20','\x20to\x20','rub','No\x20rate\x20found\x20for\x20currency:\x20','dot','530fRGREv','COINGECKO_URL','29613672SdPHkl','toFixed',',\x20using\x201\x20as\x20fallback'];a41_0x4612=function(){return _0x2e9d36;};return a41_0x4612();}