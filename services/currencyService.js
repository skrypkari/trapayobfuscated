'use strict';const a39_0x96067a=a39_0xf22a;function a39_0x44a2(){const _0x2208a6=['\x20USDT','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','nok','\x20USDT,\x20with\x20','16370640ndbcsj','updatedAt','bdt','ils','5755240VsfrsG','✅\x20Currency\x20rates\x20updated\x20successfully','allSettled','try','rate','%\x20markup\x20=\x20','php','Error\x20getting\x20rate\x20for\x20currency\x20','status','twd','7148154UXuKit','cad','CoinGecko\x20API\x20error:\x20','btc','\x20to\x20','toFixed','length','aud','count','TesSoft\x20Payment\x20System/1.0','15597FDhcSN','getMarkupPercentage','link','__esModule','xag','findFirst','pkr','updateCurrencyRates','all','stopPeriodicUpdates','\x20currencies','desc','eur','\x20to\x20USDT:','bhd','https://api.coingecko.com/api/v3/simple/price','findMany','convertToUSDT','error','bnb','json','keys','cny','\x20USDT\x20=\x20','COINGECKO_URL','jpy','kwd','ars','currency','📊\x20Received\x20rates\x20for\x20','convertMultipleToUSDT','nzd','myr','updateInterval','czk','currencyService','7348271ICVLOk','💱\x20Converted\x20','default','getCurrencyRate','log','gbp','MARKUP_PERCENTAGE','ltc','vnd','clp','xlm','1089436ChzaNF','lkr','xrp','pln','tether','findUnique','toUpperCase','getRatesStatus','uah','Error\x20getting\x20all\x20rates:','?ids=tether&vs_currencies=','bits','58iYKeOF',',\x20using\x201\x20as\x20fallback','join','488JATsxW','upsert','idr','inr','currencyRate','💱\x20Applied\x20','yfi','CurrencyService','CURRENCIES','xau','startPeriodicUpdates','statusText','brl','huf','toLowerCase','Error\x20converting\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','gel','sgd','sek','krw','usd','3yoGZND','Periodic\x20currency\x20rates\x20update\x20failed:','catch','34002kRohNy','eth','eos','entries','../config/database','getAllRates','defineProperty','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','usdt','asc','application/json','__importDefault'];a39_0x44a2=function(){return _0x2208a6;};return a39_0x44a2();}function a39_0xf22a(_0x413692,_0x333ffb){const _0x44a29e=a39_0x44a2();return a39_0xf22a=function(_0xf22ac6,_0x2f3757){_0xf22ac6=_0xf22ac6-0xcd;let _0x4936df=_0x44a29e[_0xf22ac6];return _0x4936df;},a39_0xf22a(_0x413692,_0x333ffb);}(function(_0x10157b,_0x2d83f6){const _0x15dfdc=a39_0xf22a,_0x152603=_0x10157b();while(!![]){try{const _0x2cb05c=-parseInt(_0x15dfdc(0xe8))/0x1*(-parseInt(_0x15dfdc(0x14b))/0x2)+parseInt(_0x15dfdc(0xe5))/0x3*(parseInt(_0x15dfdc(0x13f))/0x4)+-parseInt(_0x15dfdc(0xfc))/0x5+parseInt(_0x15dfdc(0x106))/0x6+parseInt(_0x15dfdc(0x134))/0x7+-parseInt(_0x15dfdc(0xcf))/0x8*(parseInt(_0x15dfdc(0x110))/0x9)+-parseInt(_0x15dfdc(0xf8))/0xa;if(_0x2cb05c===_0x2d83f6)break;else _0x152603['push'](_0x152603['shift']());}catch(_0x248ad7){_0x152603['push'](_0x152603['shift']());}}}(a39_0x44a2,0x93e08));var __importDefault=this&&this[a39_0x96067a(0xf3)]||function(_0x4b6190){const _0x2b2908=a39_0x96067a;return _0x4b6190&&_0x4b6190[_0x2b2908(0x113)]?_0x4b6190:{'default':_0x4b6190};};Object[a39_0x96067a(0xee)](exports,'__esModule',{'value':!![]}),exports[a39_0x96067a(0x133)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x96067a(0xec)));class CurrencyService{constructor(){const _0x1ed700=a39_0x96067a;this[_0x1ed700(0x128)]=_0x1ed700(0x11f),this[_0x1ed700(0xd7)]=[_0x1ed700(0x109),_0x1ed700(0xe9),_0x1ed700(0x13b),'bch',_0x1ed700(0x123),_0x1ed700(0xea),_0x1ed700(0x141),_0x1ed700(0x13e),_0x1ed700(0x112),'dot',_0x1ed700(0xd5),_0x1ed700(0xe4),'aed',_0x1ed700(0x12b),_0x1ed700(0x10d),_0x1ed700(0xfa),_0x1ed700(0x11e),'bmd',_0x1ed700(0xdb),_0x1ed700(0x107),'chf',_0x1ed700(0x13d),_0x1ed700(0x126),_0x1ed700(0x132),'dkk',_0x1ed700(0x11c),_0x1ed700(0x139),_0x1ed700(0xe0),'hkd',_0x1ed700(0xdc),_0x1ed700(0xd1),_0x1ed700(0xfb),_0x1ed700(0xd2),_0x1ed700(0x129),_0x1ed700(0xe3),_0x1ed700(0x12a),_0x1ed700(0x140),'mmk','mxn',_0x1ed700(0x130),'ngn',_0x1ed700(0xf6),_0x1ed700(0x12f),_0x1ed700(0x102),_0x1ed700(0x116),_0x1ed700(0x142),'rub','sar',_0x1ed700(0xe2),_0x1ed700(0xe1),'thb',_0x1ed700(0xff),_0x1ed700(0x105),_0x1ed700(0x147),'vef',_0x1ed700(0x13c),'zar','xdr',_0x1ed700(0x114),_0x1ed700(0xd8),_0x1ed700(0x14a),'sats'],this[_0x1ed700(0x131)]=null,this[_0x1ed700(0x13a)]=0x3,this[_0x1ed700(0xd9)]();}[a39_0x96067a(0xd9)](){const _0x4a3654=a39_0x96067a;this[_0x4a3654(0x117)]()[_0x4a3654(0xe7)](_0x4d3e40=>{const _0x22bac4=_0x4a3654;console[_0x22bac4(0x122)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x4d3e40);}),this['updateInterval']=setInterval(async()=>{const _0x552ada=_0x4a3654;try{await this['updateCurrencyRates']();}catch(_0x37701c){console['error'](_0x552ada(0xe6),_0x37701c);}},0x3c*0x3c*0x3e8),console[_0x4a3654(0x138)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x96067a(0x119)](){const _0x475c37=a39_0x96067a;this[_0x475c37(0x131)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console['log'](_0x475c37(0xef)));}async[a39_0x96067a(0x117)](){const _0x559288=a39_0x96067a;try{console[_0x559288(0x138)](_0x559288(0xdf));const _0x4d5fcc=this[_0x559288(0xd7)][_0x559288(0xce)](','),_0x4b09dc=this[_0x559288(0x128)]+_0x559288(0x149)+_0x4d5fcc,_0x3dfb88=await fetch(_0x4b09dc,{'headers':{'Accept':_0x559288(0xf2),'User-Agent':_0x559288(0x10f)}});if(!_0x3dfb88['ok'])throw new Error(_0x559288(0x108)+_0x3dfb88[_0x559288(0x104)]+'\x20'+_0x3dfb88[_0x559288(0xda)]);const _0x22115d=await _0x3dfb88[_0x559288(0x124)]();if(!_0x22115d[_0x559288(0x143)])throw new Error(_0x559288(0xf5));const _0x35ca99=_0x22115d[_0x559288(0x143)];console[_0x559288(0x138)](_0x559288(0x12d)+Object[_0x559288(0x125)](_0x35ca99)[_0x559288(0x10c)]+_0x559288(0x11a));const _0x1db2b6=Object[_0x559288(0xeb)](_0x35ca99)['map'](async([_0x221f8a,_0x5eb249])=>{const _0x4f345f=_0x559288;try{await database_1[_0x4f345f(0x136)][_0x4f345f(0xd3)][_0x4f345f(0xd0)]({'where':{'currency':_0x221f8a['toLowerCase']()},'update':{'rate':_0x5eb249},'create':{'currency':_0x221f8a[_0x4f345f(0xdd)](),'rate':_0x5eb249}});}catch(_0x386738){console[_0x4f345f(0x122)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x221f8a+':',_0x386738);}});await Promise[_0x559288(0xfe)](_0x1db2b6),console['log'](_0x559288(0xfd));}catch(_0x3a526b){console[_0x559288(0x122)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x3a526b);throw _0x3a526b;}}async[a39_0x96067a(0x137)](_0x2f92ab){const _0x4edb82=a39_0x96067a,_0x24b42d=_0x2f92ab[_0x4edb82(0xdd)]();if(_0x24b42d===_0x4edb82(0xf0))return 0x1;try{const _0x407b0c=await database_1[_0x4edb82(0x136)][_0x4edb82(0xd3)][_0x4edb82(0x144)]({'where':{'currency':_0x24b42d}});if(!_0x407b0c)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2f92ab+_0x4edb82(0xcd)),0x1;return _0x407b0c[_0x4edb82(0x100)];}catch(_0x236e0c){return console[_0x4edb82(0x122)](_0x4edb82(0x103)+_0x2f92ab+':',_0x236e0c),0x1;}}async[a39_0x96067a(0x121)](_0x34c37f,_0x46dca8){const _0x1b5ccd=a39_0x96067a,_0x101e87=_0x46dca8[_0x1b5ccd(0xdd)]();if(_0x101e87===_0x1b5ccd(0xf0)){const _0x344616=_0x34c37f*(0x1+this[_0x1b5ccd(0x13a)]/0x64);return console[_0x1b5ccd(0x138)](_0x1b5ccd(0xd4)+this[_0x1b5ccd(0x13a)]+'%\x20markup\x20to\x20'+_0x34c37f+_0x1b5ccd(0x127)+_0x344616['toFixed'](0x6)+_0x1b5ccd(0xf4)),_0x344616;}try{const _0x4a630c=await this[_0x1b5ccd(0x137)](_0x101e87),_0x47221a=_0x34c37f/_0x4a630c,_0xf611a9=_0x47221a*(0x1+this[_0x1b5ccd(0x13a)]/0x64);return console['log'](_0x1b5ccd(0x135)+_0x34c37f+'\x20'+_0x46dca8[_0x1b5ccd(0x145)]()+_0x1b5ccd(0x10a)+_0x47221a['toFixed'](0x6)+_0x1b5ccd(0xf7)+this[_0x1b5ccd(0x13a)]+_0x1b5ccd(0x101)+_0xf611a9[_0x1b5ccd(0x10b)](0x6)+'\x20USDT\x20(rate:\x20'+_0x4a630c+')'),_0xf611a9;}catch(_0x5f57ef){console[_0x1b5ccd(0x122)](_0x1b5ccd(0xde)+_0x34c37f+'\x20'+_0x46dca8+_0x1b5ccd(0x11d),_0x5f57ef);const _0x3f7c06=_0x34c37f*(0x1+this[_0x1b5ccd(0x13a)]/0x64);return _0x3f7c06;}}async[a39_0x96067a(0x12e)](_0x1f8aca){const _0x24f430=a39_0x96067a;let _0x3f798b=0x0;for(const {amount:_0xbbd73f,currency:_0x2cc888}of _0x1f8aca){const _0x5963f2=await this[_0x24f430(0x121)](_0xbbd73f,_0x2cc888);_0x3f798b+=_0x5963f2;}return _0x3f798b;}async[a39_0x96067a(0xed)](){const _0x3ef556=a39_0x96067a;try{const _0x5bce04=await database_1['default'][_0x3ef556(0xd3)][_0x3ef556(0x120)]({'select':{'currency':!![],'rate':!![]}}),_0x3f5b17={'usdt':0x1};return _0x5bce04['forEach'](_0xe12d38=>{const _0x1cc7c0=_0x3ef556;_0x3f5b17[_0xe12d38[_0x1cc7c0(0x12c)]]=_0xe12d38[_0x1cc7c0(0x100)];}),_0x3f5b17;}catch(_0x28b129){return console['error'](_0x3ef556(0x148),_0x28b129),{'usdt':0x1};}}async[a39_0x96067a(0x146)](){const _0x32d4c4=a39_0x96067a;try{const [_0xa98d2b,_0x5b01fe,_0x96ab6d]=await Promise[_0x32d4c4(0x118)]([database_1['default'][_0x32d4c4(0xd3)][_0x32d4c4(0x10e)](),database_1[_0x32d4c4(0x136)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x32d4c4(0x11b)},'select':{'updatedAt':!![]}}),database_1[_0x32d4c4(0x136)]['currencyRate'][_0x32d4c4(0x115)]({'orderBy':{'updatedAt':_0x32d4c4(0xf1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xa98d2b,'lastUpdated':_0x5b01fe?.[_0x32d4c4(0xf9)]||null,'oldestRate':_0x96ab6d?.['updatedAt']||null,'markupPercentage':this[_0x32d4c4(0x13a)]};}catch(_0x522949){return console[_0x32d4c4(0x122)]('Error\x20getting\x20rates\x20status:',_0x522949),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x96067a(0x111)](){const _0x542adf=a39_0x96067a;return this[_0x542adf(0x13a)];}}exports[a39_0x96067a(0xd6)]=CurrencyService,exports[a39_0x96067a(0x133)]=new CurrencyService();