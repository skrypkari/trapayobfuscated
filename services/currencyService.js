'use strict';const a38_0x56e760=a38_0x19e4;(function(_0x1c4c4f,_0x17a50b){const _0x502f36=a38_0x19e4,_0x113857=_0x1c4c4f();while(!![]){try{const _0x56b6d1=-parseInt(_0x502f36(0x22b))/0x1+-parseInt(_0x502f36(0x246))/0x2*(-parseInt(_0x502f36(0x1ef))/0x3)+-parseInt(_0x502f36(0x1e5))/0x4*(parseInt(_0x502f36(0x24d))/0x5)+parseInt(_0x502f36(0x1e2))/0x6+-parseInt(_0x502f36(0x212))/0x7+parseInt(_0x502f36(0x213))/0x8*(parseInt(_0x502f36(0x244))/0x9)+parseInt(_0x502f36(0x22a))/0xa;if(_0x56b6d1===_0x17a50b)break;else _0x113857['push'](_0x113857['shift']());}catch(_0x55c704){_0x113857['push'](_0x113857['shift']());}}}(a38_0x291b,0x7c101));function a38_0x19e4(_0x2743e0,_0xa43a93){const _0x291b35=a38_0x291b();return a38_0x19e4=function(_0x19e4ae,_0x53a1b1){_0x19e4ae=_0x19e4ae-0x1d6;let _0x3f7ec7=_0x291b35[_0x19e4ae];return _0x3f7ec7;},a38_0x19e4(_0x2743e0,_0xa43a93);}var __importDefault=this&&this[a38_0x56e760(0x1f6)]||function(_0x4ddbd8){const _0x1e13c3=a38_0x56e760;return _0x4ddbd8&&_0x4ddbd8[_0x1e13c3(0x214)]?_0x4ddbd8:{'default':_0x4ddbd8};};function a38_0x291b(){const _0x45f95e=['map','default','cny','desc','usdt','length','btc','asc','TesSoft\x20Payment\x20System/1.0','currency','sgd','myr','twd','203483RnfCxF','8fxEQUT','__esModule','currencyRate','count','krw','catch','MARKUP_PERCENTAGE','keys','gbp','defineProperty','eth','link','convertToUSDT','updatedAt','try','findFirst','xau','log','❌\x20Failed\x20to\x20update\x20currency\x20rates:','toLowerCase','xag','chf','cad','5242030TTVaJr','245668mEKgVR','ars','https://api.coingecko.com/api/v3/simple/price','updateInterval','error','hkd','jpy','Error\x20getting\x20rates\x20status:','status','php','brl','usd','dot','💱\x20Converted\x20','CURRENCIES','toUpperCase','toFixed','aed','\x20to\x20USDT:','sar','?ids=tether&vs_currencies=','bch','convertMultipleToUSDT','startPeriodicUpdates','CurrencyService','3258279XiSzro','mmk','946UqzmrY','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bnb','Error\x20getting\x20rate\x20for\x20currency\x20','allSettled','kwd','bmd','45UvSQZo','\x20USDT\x20=\x20','Error\x20converting\x20','\x20to\x20','pkr','Failed\x20to\x20update\x20rate\x20for\x20','ngn','../config/database','currencyService','\x20USDT,\x20with\x20','czk','clp','\x20currencies','aud','📊\x20Received\x20rates\x20for\x20','430098Ipqcvx','getCurrencyRate','upsert','115416ikDoKt',',\x20using\x201\x20as\x20fallback','uah','bdt','join','findMany','\x20USDT\x20(rate:\x20','sats','zar','application/json','537NqMMlu','entries','Initial\x20currency\x20rates\x20update\x20failed:','ils','rub','mxn','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','__importDefault','sek','dkk','CoinGecko\x20API\x20error:\x20','xlm','tether','huf','nok','idr','yfi','all','rate','updateCurrencyRates','lkr','Error\x20getting\x20all\x20rates:'];a38_0x291b=function(){return _0x45f95e;};return a38_0x291b();}Object[a38_0x56e760(0x21c)](exports,a38_0x56e760(0x214),{'value':!![]}),exports[a38_0x56e760(0x1db)]=exports[a38_0x56e760(0x243)]=void 0x0;const database_1=__importDefault(require(a38_0x56e760(0x1da)));class CurrencyService{constructor(){const _0xaee589=a38_0x56e760;this['COINGECKO_URL']=_0xaee589(0x22d),this[_0xaee589(0x239)]=[_0xaee589(0x20b),_0xaee589(0x21d),'ltc',_0xaee589(0x240),_0xaee589(0x248),'eos','xrp',_0xaee589(0x1fa),_0xaee589(0x21e),_0xaee589(0x237),_0xaee589(0x1ff),_0xaee589(0x236),_0xaee589(0x23c),_0xaee589(0x22c),_0xaee589(0x1e0),_0xaee589(0x1e8),'bhd',_0xaee589(0x24c),_0xaee589(0x235),_0xaee589(0x229),_0xaee589(0x228),_0xaee589(0x1de),_0xaee589(0x207),_0xaee589(0x1dd),_0xaee589(0x1f8),'eur',_0xaee589(0x21b),'gel',_0xaee589(0x230),_0xaee589(0x1fc),_0xaee589(0x1fe),_0xaee589(0x1f2),'inr',_0xaee589(0x231),_0xaee589(0x217),_0xaee589(0x24b),_0xaee589(0x203),_0xaee589(0x245),_0xaee589(0x1f4),_0xaee589(0x210),_0xaee589(0x1d9),_0xaee589(0x1fd),'nzd',_0xaee589(0x234),_0xaee589(0x1d7),'pln',_0xaee589(0x1f3),_0xaee589(0x23e),_0xaee589(0x1f7),_0xaee589(0x20f),'thb',_0xaee589(0x221),_0xaee589(0x211),_0xaee589(0x1e7),'vef','vnd',_0xaee589(0x1ed),'xdr',_0xaee589(0x227),_0xaee589(0x223),'bits',_0xaee589(0x1ec)],this[_0xaee589(0x22e)]=null,this[_0xaee589(0x219)]=0x3,this['startPeriodicUpdates']();}[a38_0x56e760(0x242)](){const _0xff228a=a38_0x56e760;this[_0xff228a(0x202)]()[_0xff228a(0x218)](_0x38d96a=>{const _0x4481d7=_0xff228a;console[_0x4481d7(0x22f)](_0x4481d7(0x1f1),_0x38d96a);}),this[_0xff228a(0x22e)]=setInterval(async()=>{const _0x5302d6=_0xff228a;try{await this[_0x5302d6(0x202)]();}catch(_0x5c4881){console[_0x5302d6(0x22f)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x5c4881);}},0x3c*0x3c*0x3e8),console['log'](_0xff228a(0x1f5));}['stopPeriodicUpdates'](){const _0x402cf2=a38_0x56e760;this['updateInterval']&&(clearInterval(this[_0x402cf2(0x22e)]),this[_0x402cf2(0x22e)]=null,console['log']('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x56e760(0x202)](){const _0x38c4fb=a38_0x56e760;try{console[_0x38c4fb(0x224)](_0x38c4fb(0x247));const _0x509a65=this[_0x38c4fb(0x239)][_0x38c4fb(0x1e9)](','),_0xca8aed=this['COINGECKO_URL']+_0x38c4fb(0x23f)+_0x509a65,_0x17977d=await fetch(_0xca8aed,{'headers':{'Accept':_0x38c4fb(0x1ee),'User-Agent':_0x38c4fb(0x20d)}});if(!_0x17977d['ok'])throw new Error(_0x38c4fb(0x1f9)+_0x17977d[_0x38c4fb(0x233)]+'\x20'+_0x17977d['statusText']);const _0x463d1c=await _0x17977d['json']();if(!_0x463d1c['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x188a4f=_0x463d1c[_0x38c4fb(0x1fb)];console[_0x38c4fb(0x224)](_0x38c4fb(0x1e1)+Object[_0x38c4fb(0x21a)](_0x188a4f)[_0x38c4fb(0x20a)]+_0x38c4fb(0x1df));const _0x29f1fa=Object[_0x38c4fb(0x1f0)](_0x188a4f)[_0x38c4fb(0x205)](async([_0x34d83a,_0x587e3f])=>{const _0x514a36=_0x38c4fb;try{await database_1[_0x514a36(0x206)][_0x514a36(0x215)][_0x514a36(0x1e4)]({'where':{'currency':_0x34d83a[_0x514a36(0x226)]()},'update':{'rate':_0x587e3f},'create':{'currency':_0x34d83a[_0x514a36(0x226)](),'rate':_0x587e3f}});}catch(_0x47f40c){console[_0x514a36(0x22f)](_0x514a36(0x1d8)+_0x34d83a+':',_0x47f40c);}});await Promise[_0x38c4fb(0x24a)](_0x29f1fa),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x512988){console[_0x38c4fb(0x22f)](_0x38c4fb(0x225),_0x512988);throw _0x512988;}}async['getCurrencyRate'](_0x4b43c0){const _0x34a4c5=a38_0x56e760,_0x5f474c=_0x4b43c0['toLowerCase']();if(_0x5f474c===_0x34a4c5(0x209))return 0x1;try{const _0xcd99e3=await database_1[_0x34a4c5(0x206)][_0x34a4c5(0x215)]['findUnique']({'where':{'currency':_0x5f474c}});if(!_0xcd99e3)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x4b43c0+_0x34a4c5(0x1e6)),0x1;return _0xcd99e3['rate'];}catch(_0x5d4ba6){return console[_0x34a4c5(0x22f)](_0x34a4c5(0x249)+_0x4b43c0+':',_0x5d4ba6),0x1;}}async[a38_0x56e760(0x21f)](_0x4ef35b,_0x13368f){const _0x17f191=a38_0x56e760,_0x2f5d01=_0x13368f[_0x17f191(0x226)]();if(_0x2f5d01==='usdt'){const _0xe8f1ba=_0x4ef35b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x17f191(0x224)]('💱\x20Applied\x20'+this[_0x17f191(0x219)]+'%\x20markup\x20to\x20'+_0x4ef35b+_0x17f191(0x24e)+_0xe8f1ba['toFixed'](0x6)+'\x20USDT'),_0xe8f1ba;}try{const _0x587546=await this[_0x17f191(0x1e3)](_0x2f5d01),_0x5af31a=_0x4ef35b/_0x587546,_0x373859=_0x5af31a*(0x1+this[_0x17f191(0x219)]/0x64);return console[_0x17f191(0x224)](_0x17f191(0x238)+_0x4ef35b+'\x20'+_0x13368f[_0x17f191(0x23a)]()+_0x17f191(0x1d6)+_0x5af31a[_0x17f191(0x23b)](0x6)+_0x17f191(0x1dc)+this[_0x17f191(0x219)]+'%\x20markup\x20=\x20'+_0x373859[_0x17f191(0x23b)](0x6)+_0x17f191(0x1eb)+_0x587546+')'),_0x373859;}catch(_0x1fa4ae){console[_0x17f191(0x22f)](_0x17f191(0x24f)+_0x4ef35b+'\x20'+_0x13368f+_0x17f191(0x23d),_0x1fa4ae);const _0x17d391=_0x4ef35b*(0x1+this[_0x17f191(0x219)]/0x64);return _0x17d391;}}async[a38_0x56e760(0x241)](_0x2b2910){let _0x5d9acb=0x0;for(const {amount:_0x479d54,currency:_0x500c5c}of _0x2b2910){const _0x754bc5=await this['convertToUSDT'](_0x479d54,_0x500c5c);_0x5d9acb+=_0x754bc5;}return _0x5d9acb;}async['getAllRates'](){const _0x10b55c=a38_0x56e760;try{const _0x32a655=await database_1[_0x10b55c(0x206)][_0x10b55c(0x215)][_0x10b55c(0x1ea)]({'select':{'currency':!![],'rate':!![]}}),_0x59d657={'usdt':0x1};return _0x32a655['forEach'](_0x4b89dc=>{const _0x4539da=_0x10b55c;_0x59d657[_0x4b89dc[_0x4539da(0x20e)]]=_0x4b89dc[_0x4539da(0x201)];}),_0x59d657;}catch(_0x48caf5){return console[_0x10b55c(0x22f)](_0x10b55c(0x204),_0x48caf5),{'usdt':0x1};}}async['getRatesStatus'](){const _0xb7b530=a38_0x56e760;try{const [_0x43190f,_0x51c5be,_0x32c2a8]=await Promise[_0xb7b530(0x200)]([database_1[_0xb7b530(0x206)][_0xb7b530(0x215)][_0xb7b530(0x216)](),database_1[_0xb7b530(0x206)][_0xb7b530(0x215)][_0xb7b530(0x222)]({'orderBy':{'updatedAt':_0xb7b530(0x208)},'select':{'updatedAt':!![]}}),database_1[_0xb7b530(0x206)][_0xb7b530(0x215)][_0xb7b530(0x222)]({'orderBy':{'updatedAt':_0xb7b530(0x20c)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x43190f,'lastUpdated':_0x51c5be?.['updatedAt']||null,'oldestRate':_0x32c2a8?.[_0xb7b530(0x220)]||null,'markupPercentage':this[_0xb7b530(0x219)]};}catch(_0x32caeb){return console[_0xb7b530(0x22f)](_0xb7b530(0x232),_0x32caeb),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xb7b530(0x219)]};}}['getMarkupPercentage'](){const _0x2b30ad=a38_0x56e760;return this[_0x2b30ad(0x219)];}}exports[a38_0x56e760(0x243)]=CurrencyService,exports[a38_0x56e760(0x1db)]=new CurrencyService();