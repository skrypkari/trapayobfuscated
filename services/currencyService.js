'use strict';const a49_0x3697cc=a49_0x559a;(function(_0x45adba,_0x20666f){const _0x4fc50b=a49_0x559a,_0xdcdc73=_0x45adba();while(!![]){try{const _0x21c937=-parseInt(_0x4fc50b(0x1d5))/0x1*(-parseInt(_0x4fc50b(0x1e9))/0x2)+parseInt(_0x4fc50b(0x1df))/0x3+-parseInt(_0x4fc50b(0x1fd))/0x4*(-parseInt(_0x4fc50b(0x1db))/0x5)+-parseInt(_0x4fc50b(0x1b5))/0x6+-parseInt(_0x4fc50b(0x1d6))/0x7+-parseInt(_0x4fc50b(0x19c))/0x8*(-parseInt(_0x4fc50b(0x184))/0x9)+parseInt(_0x4fc50b(0x1ac))/0xa*(parseInt(_0x4fc50b(0x195))/0xb);if(_0x21c937===_0x20666f)break;else _0xdcdc73['push'](_0xdcdc73['shift']());}catch(_0x1ace11){_0xdcdc73['push'](_0xdcdc73['shift']());}}}(a49_0x21f0,0x6cfa8));var __importDefault=this&&this[a49_0x3697cc(0x1f6)]||function(_0x3d04d4){return _0x3d04d4&&_0x3d04d4['__esModule']?_0x3d04d4:{'default':_0x3d04d4};};Object[a49_0x3697cc(0x1a3)](exports,a49_0x3697cc(0x1fe),{'value':!![]}),exports[a49_0x3697cc(0x1bd)]=exports['CurrencyService']=void 0x0;function a49_0x559a(_0x565a48,_0x1f5cc4){_0x565a48=_0x565a48-0x17d;const _0x21f043=a49_0x21f0();let _0x559a6b=_0x21f043[_0x565a48];return _0x559a6b;}const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x1a0587=a49_0x3697cc;this[_0x1a0587(0x1da)]=_0x1a0587(0x1ab),this[_0x1a0587(0x19d)]=[_0x1a0587(0x1c7),_0x1a0587(0x1b1),_0x1a0587(0x1c6),_0x1a0587(0x1b0),_0x1a0587(0x1dc),_0x1a0587(0x1b3),_0x1a0587(0x1d8),_0x1a0587(0x192),_0x1a0587(0x1e1),_0x1a0587(0x1f3),_0x1a0587(0x18c),_0x1a0587(0x1cf),_0x1a0587(0x180),_0x1a0587(0x17d),_0x1a0587(0x1e5),_0x1a0587(0x1af),'bhd','bmd','brl','cad','chf',_0x1a0587(0x1d9),_0x1a0587(0x1bc),'czk',_0x1a0587(0x1b7),_0x1a0587(0x1f1),_0x1a0587(0x190),_0x1a0587(0x199),_0x1a0587(0x197),_0x1a0587(0x1e8),_0x1a0587(0x19f),_0x1a0587(0x1c5),_0x1a0587(0x1ad),_0x1a0587(0x19e),_0x1a0587(0x1f9),_0x1a0587(0x18b),'lkr','mmk',_0x1a0587(0x1f0),_0x1a0587(0x1c4),_0x1a0587(0x1ae),_0x1a0587(0x1de),'nzd',_0x1a0587(0x187),_0x1a0587(0x185),_0x1a0587(0x1a0),_0x1a0587(0x1be),'sar',_0x1a0587(0x1e7),'sgd','thb',_0x1a0587(0x1ef),_0x1a0587(0x17e),_0x1a0587(0x1bf),_0x1a0587(0x18a),_0x1a0587(0x1ed),_0x1a0587(0x1cb),_0x1a0587(0x1a6),_0x1a0587(0x1a2),_0x1a0587(0x1cc),_0x1a0587(0x1e3),'sats'],this[_0x1a0587(0x1fa)]=null,this[_0x1a0587(0x1c9)]=-0x3,this[_0x1a0587(0x1dd)]();}[a49_0x3697cc(0x1dd)](){const _0x1c2909=a49_0x3697cc;this[_0x1c2909(0x1b4)]()[_0x1c2909(0x1c3)](_0x20f16d=>{const _0x592d23=_0x1c2909;console[_0x592d23(0x17f)](_0x592d23(0x1d1),_0x20f16d);}),this[_0x1c2909(0x1fa)]=setInterval(async()=>{const _0x46260f=_0x1c2909;try{await this[_0x46260f(0x1b4)]();}catch(_0x3f895a){console[_0x46260f(0x17f)](_0x46260f(0x18e),_0x3f895a);}},0x3c*0x3c*0x3e8),console['log'](_0x1c2909(0x1d4));}[a49_0x3697cc(0x1a9)](){const _0x120e71=a49_0x3697cc;this[_0x120e71(0x1fa)]&&(clearInterval(this[_0x120e71(0x1fa)]),this[_0x120e71(0x1fa)]=null,console[_0x120e71(0x1ba)](_0x120e71(0x1f2)));}async[a49_0x3697cc(0x1b4)](){const _0x58a635=a49_0x3697cc;try{console[_0x58a635(0x1ba)](_0x58a635(0x181));const _0x1a4b57=this['CURRENCIES'][_0x58a635(0x1f5)](','),_0x5f4072=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x1a4b57,_0x387743=await fetch(_0x5f4072,{'headers':{'Accept':_0x58a635(0x188),'User-Agent':_0x58a635(0x1a1)}});if(!_0x387743['ok'])throw new Error(_0x58a635(0x198)+_0x387743[_0x58a635(0x1a5)]+'\x20'+_0x387743[_0x58a635(0x1a7)]);const _0x192b2f=await _0x387743[_0x58a635(0x1e4)]();if(!_0x192b2f[_0x58a635(0x1ee)])throw new Error(_0x58a635(0x1e6));const _0xd6bb67=_0x192b2f['tether'];console['log']('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0x58a635(0x1a4)](_0xd6bb67)[_0x58a635(0x183)]+_0x58a635(0x1b9));const _0x399192=Object[_0x58a635(0x1a8)](_0xd6bb67)['map'](async([_0x13d9af,_0x40b0dc])=>{const _0x5d17e0=_0x58a635;try{await database_1[_0x5d17e0(0x193)][_0x5d17e0(0x1b2)]['upsert']({'where':{'currency':_0x13d9af['toLowerCase']()},'update':{'rate':_0x40b0dc},'create':{'currency':_0x13d9af[_0x5d17e0(0x18f)](),'rate':_0x40b0dc}});}catch(_0x456f23){console[_0x5d17e0(0x17f)](_0x5d17e0(0x1ea)+_0x13d9af+':',_0x456f23);}});await Promise[_0x58a635(0x1eb)](_0x399192),console[_0x58a635(0x1ba)]('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x28b01a){console['error']('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x28b01a);throw _0x28b01a;}}async[a49_0x3697cc(0x196)](_0xa623ae){const _0x5c0738=a49_0x3697cc,_0x21fb8c=_0xa623ae[_0x5c0738(0x18f)]();if(_0x21fb8c==='usdt')return 0x1;try{const _0x52e724=await database_1['default']['currencyRate'][_0x5c0738(0x1e0)]({'where':{'currency':_0x21fb8c}});if(!_0x52e724)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0xa623ae+_0x5c0738(0x1c0)),0x1;return _0x52e724[_0x5c0738(0x1d7)];}catch(_0x58296f){return console[_0x5c0738(0x17f)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0xa623ae+':',_0x58296f),0x1;}}async['convertToUSDT'](_0x256555,_0x7a312b){const _0x46590f=a49_0x3697cc,_0x3bd574=_0x7a312b[_0x46590f(0x18f)]();if(_0x3bd574===_0x46590f(0x1c1)){const _0x259ff7=_0x256555*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x46590f(0x1ba)](_0x46590f(0x1f8)+this[_0x46590f(0x1c9)]+_0x46590f(0x1c2)+_0x256555+_0x46590f(0x1fc)+_0x259ff7[_0x46590f(0x1f7)](0x6)+_0x46590f(0x1aa)),_0x259ff7;}try{const _0x20b03b=await this[_0x46590f(0x196)](_0x3bd574),_0x49130e=_0x256555/_0x20b03b,_0x1a44a8=_0x49130e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x46590f(0x1ba)](_0x46590f(0x1fb)+_0x256555+'\x20'+_0x7a312b[_0x46590f(0x1d2)]()+_0x46590f(0x1bb)+_0x49130e[_0x46590f(0x1f7)](0x6)+_0x46590f(0x189)+this[_0x46590f(0x1c9)]+_0x46590f(0x1b8)+_0x1a44a8['toFixed'](0x6)+_0x46590f(0x1d3)+_0x20b03b+')'),_0x1a44a8;}catch(_0x1c6a9a){console[_0x46590f(0x17f)](_0x46590f(0x1b6)+_0x256555+'\x20'+_0x7a312b+_0x46590f(0x1ce),_0x1c6a9a);const _0x1ea171=_0x256555*(0x1+this[_0x46590f(0x1c9)]/0x64);return _0x1ea171;}}async[a49_0x3697cc(0x19a)](_0x166653){const _0x33d7d0=a49_0x3697cc;let _0x46f873=0x0;for(const {amount:_0x3927d7,currency:_0x31b76d}of _0x166653){const _0x1d0178=await this[_0x33d7d0(0x1c8)](_0x3927d7,_0x31b76d);_0x46f873+=_0x1d0178;}return _0x46f873;}async[a49_0x3697cc(0x1ec)](){const _0x163ec3=a49_0x3697cc;try{const _0x3db573=await database_1[_0x163ec3(0x193)][_0x163ec3(0x1b2)][_0x163ec3(0x18d)]({'select':{'currency':!![],'rate':!![]}}),_0xe02b2d={'usdt':0x1};return _0x3db573['forEach'](_0x4b2f0c=>{const _0xfcb9a2=_0x163ec3;_0xe02b2d[_0x4b2f0c[_0xfcb9a2(0x186)]]=_0x4b2f0c[_0xfcb9a2(0x1d7)];}),_0xe02b2d;}catch(_0x1e739e){return console[_0x163ec3(0x17f)](_0x163ec3(0x1ca),_0x1e739e),{'usdt':0x1};}}async['getRatesStatus'](){const _0x15567a=a49_0x3697cc;try{const [_0x2bee56,_0x3d124a,_0x44da69]=await Promise[_0x15567a(0x1cd)]([database_1['default'][_0x15567a(0x1b2)][_0x15567a(0x191)](),database_1['default'][_0x15567a(0x1b2)][_0x15567a(0x1f4)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x15567a(0x193)][_0x15567a(0x1b2)][_0x15567a(0x1f4)]({'orderBy':{'updatedAt':_0x15567a(0x194)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2bee56,'lastUpdated':_0x3d124a?.[_0x15567a(0x182)]||null,'oldestRate':_0x44da69?.['updatedAt']||null,'markupPercentage':this[_0x15567a(0x1c9)]};}catch(_0x5f2651){return console[_0x15567a(0x17f)](_0x15567a(0x19b),_0x5f2651),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x15567a(0x1c9)]};}}[a49_0x3697cc(0x1e2)](){const _0x71a482=a49_0x3697cc;return this[_0x71a482(0x1c9)];}}function a49_0x21f0(){const _0x214d22=['idr','pln','Payment\x20System/1.0','xag','defineProperty','keys','status','xdr','statusText','entries','stopPeriodicUpdates','\x20USDT','https://api.coingecko.com/api/v3/simple/price','3397460xgATFf','inr','ngn','bdt','bch','eth','currencyRate','eos','updateCurrencyRates','1498392CzsRKE','Error\x20converting\x20','dkk','%\x20markup\x20=\x20','\x20currencies','log','\x20to\x20','cny','currencyService','rub','uah',',\x20using\x201\x20as\x20fallback','usdt','%\x20markup\x20to\x20','catch','myr','ils','ltc','btc','convertToUSDT','MARKUP_PERCENTAGE','Error\x20getting\x20all\x20rates:','zar','xau','all','\x20to\x20USDT:','usd','CurrencyService','Initial\x20currency\x20rates\x20update\x20failed:','toUpperCase','\x20USDT\x20(rate:\x20','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','2xAiivc','3603348rBifAF','rate','xrp','clp','COINGECKO_URL','244805QBQTRI','bnb','startPeriodicUpdates','nok','78720uZxBeU','findUnique','link','getMarkupPercentage','bits','json','aud','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','sek','huf','106156QeWgVn','Failed\x20to\x20update\x20rate\x20for\x20','allSettled','getAllRates','vnd','tether','try','mxn','eur','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','dot','findFirst','join','__importDefault','toFixed','ðŸ’±\x20Applied\x20','krw','updateInterval','ðŸ’±\x20Converted\x20','\x20USDT\x20=\x20','56tUJpRt','__esModule','ars','twd','error','aed','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','updatedAt','length','171MRhzzO','pkr','currency','php','application/json','\x20USDT,\x20with\x20','vef','kwd','yfi','findMany','Periodic\x20currency\x20rates\x20update\x20failed:','toLowerCase','gbp','count','xlm','default','asc','11FvzsPU','getCurrencyRate','hkd','CoinGecko\x20API\x20error:\x20','gel','convertMultipleToUSDT','Error\x20getting\x20rates\x20status:','22432UOkXss','CURRENCIES','jpy'];a49_0x21f0=function(){return _0x214d22;};return a49_0x21f0();}exports[a49_0x3697cc(0x1d0)]=CurrencyService,exports[a49_0x3697cc(0x1bd)]=new CurrencyService();