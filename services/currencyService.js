'use strict';const a36_0x2452dd=a36_0x5afd;function a36_0x5afd(_0xbb1c2,_0x389193){const _0x163f46=a36_0x163f();return a36_0x5afd=function(_0x5afdd0,_0x28b872){_0x5afdd0=_0x5afdd0-0x18d;let _0x323ceb=_0x163f46[_0x5afdd0];return _0x323ceb;},a36_0x5afd(_0xbb1c2,_0x389193);}(function(_0x4d8ca5,_0x134822){const _0xf98784=a36_0x5afd,_0x1e75bc=_0x4d8ca5();while(!![]){try{const _0x2b3e71=-parseInt(_0xf98784(0x1e5))/0x1*(parseInt(_0xf98784(0x1a1))/0x2)+parseInt(_0xf98784(0x192))/0x3*(-parseInt(_0xf98784(0x1ad))/0x4)+parseInt(_0xf98784(0x1a3))/0x5*(parseInt(_0xf98784(0x1be))/0x6)+-parseInt(_0xf98784(0x1b8))/0x7*(parseInt(_0xf98784(0x1e3))/0x8)+-parseInt(_0xf98784(0x1bf))/0x9+parseInt(_0xf98784(0x1f6))/0xa*(parseInt(_0xf98784(0x1ac))/0xb)+parseInt(_0xf98784(0x1ab))/0xc*(parseInt(_0xf98784(0x1b5))/0xd);if(_0x2b3e71===_0x134822)break;else _0x1e75bc['push'](_0x1e75bc['shift']());}catch(_0x16c071){_0x1e75bc['push'](_0x1e75bc['shift']());}}}(a36_0x163f,0x2d73c));function a36_0x163f(){const _0xafc973=['No\x20rate\x20found\x20for\x20currency:\x20','uah','CurrencyService','rate','%\x20markup\x20=\x20','4147JJtLEF','application/json','toUpperCase','6363iiTzrd','btc','%\x20markup\x20to\x20','usdt','allSettled','vef','1814412sacoJj','1439955oJCKPC','vnd','dkk','idr','updateCurrencyRates','💱\x20Applied\x20','sgd','aud','\x20USDT,\x20with\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','convertToUSDT','ils','COINGECKO_URL','json','pkr','tether','Initial\x20currency\x20rates\x20update\x20failed:','Error\x20getting\x20rate\x20for\x20currency\x20','sek','TesSoft\x20Payment\x20System/1.0','xau','\x20currencies','bnb','rub','thb','php','getAllRates','Failed\x20to\x20update\x20rate\x20for\x20','toLowerCase','CoinGecko\x20API\x20error:\x20','bits','startPeriodicUpdates','error','Error\x20getting\x20all\x20rates:','defineProperty','asc','816FSunCu','bmd','1afZdLv','warn','statusText','CURRENCIES','jpy','__esModule','sar','length','📊\x20Received\x20rates\x20for\x20','updateInterval','stopPeriodicUpdates','currencyRate','\x20to\x20','link','brl','gbp','usd','3466070FKlcnD','zar','toFixed','join','eur','huf','kwd','bdt','\x20USDT\x20=\x20','cny','krw','MARKUP_PERCENTAGE','nzd','twd','\x20USDT','ngn','eth','findMany','czk','default','dot','inr','bch','mmk','currencyService','108XVFEBh','Error\x20converting\x20','desc','yfi','map','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','getCurrencyRate','getRatesStatus','chf','findUnique','updatedAt','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','❌\x20Failed\x20to\x20update\x20currency\x20rates:','💱\x20Converted\x20','try','679654vNvRhD','xdr','5xsuCLC','findFirst',',\x20using\x201\x20as\x20fallback','Periodic\x20currency\x20rates\x20update\x20failed:','eos','__importDefault','\x20USDT\x20(rate:\x20','log','11676PUpPrT','11MGNoiZ','20076ilnDOi','Error\x20getting\x20rates\x20status:','xag'];a36_0x163f=function(){return _0xafc973;};return a36_0x163f();}var __importDefault=this&&this[a36_0x2452dd(0x1a8)]||function(_0xd6510f){const _0x4868f0=a36_0x2452dd;return _0xd6510f&&_0xd6510f[_0x4868f0(0x1ea)]?_0xd6510f:{'default':_0xd6510f};};Object[a36_0x2452dd(0x1e1)](exports,a36_0x2452dd(0x1ea),{'value':!![]}),exports[a36_0x2452dd(0x191)]=exports[a36_0x2452dd(0x1b2)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x18e7b5=a36_0x2452dd;this[_0x18e7b5(0x1cb)]='https://api.coingecko.com/api/v3/simple/price',this[_0x18e7b5(0x1e8)]=[_0x18e7b5(0x1b9),_0x18e7b5(0x206),'ltc',_0x18e7b5(0x18f),_0x18e7b5(0x1d5),_0x18e7b5(0x1a7),'xrp','xlm',_0x18e7b5(0x1f2),_0x18e7b5(0x18d),_0x18e7b5(0x195),_0x18e7b5(0x1f5),'aed','ars',_0x18e7b5(0x1c6),_0x18e7b5(0x1fd),'bhd',_0x18e7b5(0x1e4),_0x18e7b5(0x1f3),'cad',_0x18e7b5(0x19a),'clp',_0x18e7b5(0x1ff),_0x18e7b5(0x208),_0x18e7b5(0x1c1),_0x18e7b5(0x1fa),_0x18e7b5(0x1f4),'gel','hkd',_0x18e7b5(0x1fb),_0x18e7b5(0x1c2),_0x18e7b5(0x1ca),_0x18e7b5(0x18e),_0x18e7b5(0x1e9),_0x18e7b5(0x200),_0x18e7b5(0x1fc),'lkr',_0x18e7b5(0x190),'mxn','myr',_0x18e7b5(0x205),'nok',_0x18e7b5(0x202),_0x18e7b5(0x1d8),_0x18e7b5(0x1cd),'pln',_0x18e7b5(0x1d6),_0x18e7b5(0x1eb),_0x18e7b5(0x1d1),_0x18e7b5(0x1c5),_0x18e7b5(0x1d7),_0x18e7b5(0x1a0),_0x18e7b5(0x203),_0x18e7b5(0x1b1),_0x18e7b5(0x1bd),_0x18e7b5(0x1c0),_0x18e7b5(0x1f7),_0x18e7b5(0x1a2),_0x18e7b5(0x1af),_0x18e7b5(0x1d3),_0x18e7b5(0x1dd),'sats'],this[_0x18e7b5(0x1ee)]=null,this[_0x18e7b5(0x201)]=0x3,this[_0x18e7b5(0x1de)]();}['startPeriodicUpdates'](){const _0x123854=a36_0x2452dd;this[_0x123854(0x1c3)]()['catch'](_0x37f0ec=>{const _0x22f515=_0x123854;console[_0x22f515(0x1df)](_0x22f515(0x1cf),_0x37f0ec);}),this[_0x123854(0x1ee)]=setInterval(async()=>{const _0x331951=_0x123854;try{await this[_0x331951(0x1c3)]();}catch(_0x115500){console['error'](_0x331951(0x1a6),_0x115500);}},0x3c*0x3c*0x3e8),console[_0x123854(0x1aa)](_0x123854(0x197));}[a36_0x2452dd(0x1ef)](){const _0x281e87=a36_0x2452dd;this[_0x281e87(0x1ee)]&&(clearInterval(this['updateInterval']),this[_0x281e87(0x1ee)]=null,console[_0x281e87(0x1aa)](_0x281e87(0x1c8)));}async[a36_0x2452dd(0x1c3)](){const _0x51beb9=a36_0x2452dd;try{console[_0x51beb9(0x1aa)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x4df006=this[_0x51beb9(0x1e8)][_0x51beb9(0x1f9)](','),_0x44338e=this[_0x51beb9(0x1cb)]+'?ids=tether&vs_currencies='+_0x4df006,_0x2f9fa6=await fetch(_0x44338e,{'headers':{'Accept':_0x51beb9(0x1b6),'User-Agent':_0x51beb9(0x1d2)}});if(!_0x2f9fa6['ok'])throw new Error(_0x51beb9(0x1dc)+_0x2f9fa6['status']+'\x20'+_0x2f9fa6[_0x51beb9(0x1e7)]);const _0x28179a=await _0x2f9fa6[_0x51beb9(0x1cc)]();if(!_0x28179a['tether'])throw new Error(_0x51beb9(0x19d));const _0x80153b=_0x28179a[_0x51beb9(0x1ce)];console['log'](_0x51beb9(0x1ed)+Object['keys'](_0x80153b)[_0x51beb9(0x1ec)]+_0x51beb9(0x1d4));const _0x24a970=Object['entries'](_0x80153b)[_0x51beb9(0x196)](async([_0x573df6,_0x13b248])=>{const _0x37e629=_0x51beb9;try{await database_1[_0x37e629(0x209)][_0x37e629(0x1f0)]['upsert']({'where':{'currency':_0x573df6[_0x37e629(0x1db)]()},'update':{'rate':_0x13b248},'create':{'currency':_0x573df6['toLowerCase'](),'rate':_0x13b248}});}catch(_0x2a1522){console['error'](_0x37e629(0x1da)+_0x573df6+':',_0x2a1522);}});await Promise[_0x51beb9(0x1bc)](_0x24a970),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x3d5b2d){console[_0x51beb9(0x1df)](_0x51beb9(0x19e),_0x3d5b2d);throw _0x3d5b2d;}}async[a36_0x2452dd(0x198)](_0x2f5bce){const _0x421aab=a36_0x2452dd,_0x3a297d=_0x2f5bce[_0x421aab(0x1db)]();if(_0x3a297d===_0x421aab(0x1bb))return 0x1;try{const _0x352f77=await database_1[_0x421aab(0x209)][_0x421aab(0x1f0)][_0x421aab(0x19b)]({'where':{'currency':_0x3a297d}});if(!_0x352f77)return console[_0x421aab(0x1e6)](_0x421aab(0x1b0)+_0x2f5bce+_0x421aab(0x1a5)),0x1;return _0x352f77[_0x421aab(0x1b3)];}catch(_0xa066af){return console[_0x421aab(0x1df)](_0x421aab(0x1d0)+_0x2f5bce+':',_0xa066af),0x1;}}async[a36_0x2452dd(0x1c9)](_0x2c4a3f,_0x4761f4){const _0x5979cc=a36_0x2452dd,_0x1c771f=_0x4761f4['toLowerCase']();if(_0x1c771f==='usdt'){const _0x45c837=_0x2c4a3f*(0x1+this[_0x5979cc(0x201)]/0x64);return console['log'](_0x5979cc(0x1c4)+this[_0x5979cc(0x201)]+_0x5979cc(0x1ba)+_0x2c4a3f+_0x5979cc(0x1fe)+_0x45c837[_0x5979cc(0x1f8)](0x6)+_0x5979cc(0x204)),_0x45c837;}try{const _0x1c7578=await this['getCurrencyRate'](_0x1c771f),_0x40f7d1=_0x2c4a3f/_0x1c7578,_0xca0fe8=_0x40f7d1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x5979cc(0x19f)+_0x2c4a3f+'\x20'+_0x4761f4[_0x5979cc(0x1b7)]()+_0x5979cc(0x1f1)+_0x40f7d1[_0x5979cc(0x1f8)](0x6)+_0x5979cc(0x1c7)+this[_0x5979cc(0x201)]+_0x5979cc(0x1b4)+_0xca0fe8[_0x5979cc(0x1f8)](0x6)+_0x5979cc(0x1a9)+_0x1c7578+')'),_0xca0fe8;}catch(_0x3e0dd4){console[_0x5979cc(0x1df)](_0x5979cc(0x193)+_0x2c4a3f+'\x20'+_0x4761f4+'\x20to\x20USDT:',_0x3e0dd4);const _0x5ae169=_0x2c4a3f*(0x1+this[_0x5979cc(0x201)]/0x64);return _0x5ae169;}}async['convertMultipleToUSDT'](_0x33ac21){const _0x4e7001=a36_0x2452dd;let _0x10ba59=0x0;for(const {amount:_0x365f8,currency:_0x15c8c7}of _0x33ac21){const _0x2e9169=await this[_0x4e7001(0x1c9)](_0x365f8,_0x15c8c7);_0x10ba59+=_0x2e9169;}return _0x10ba59;}async[a36_0x2452dd(0x1d9)](){const _0x449708=a36_0x2452dd;try{const _0x285c32=await database_1['default']['currencyRate'][_0x449708(0x207)]({'select':{'currency':!![],'rate':!![]}}),_0x798dee={'usdt':0x1};return _0x285c32['forEach'](_0x17944f=>{_0x798dee[_0x17944f['currency']]=_0x17944f['rate'];}),_0x798dee;}catch(_0x4ec871){return console[_0x449708(0x1df)](_0x449708(0x1e0),_0x4ec871),{'usdt':0x1};}}async[a36_0x2452dd(0x199)](){const _0x2828db=a36_0x2452dd;try{const [_0x271d72,_0x3791c2,_0x2eae37]=await Promise['all']([database_1[_0x2828db(0x209)][_0x2828db(0x1f0)]['count'](),database_1[_0x2828db(0x209)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x2828db(0x194)},'select':{'updatedAt':!![]}}),database_1[_0x2828db(0x209)][_0x2828db(0x1f0)][_0x2828db(0x1a4)]({'orderBy':{'updatedAt':_0x2828db(0x1e2)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x271d72,'lastUpdated':_0x3791c2?.[_0x2828db(0x19c)]||null,'oldestRate':_0x2eae37?.[_0x2828db(0x19c)]||null,'markupPercentage':this[_0x2828db(0x201)]};}catch(_0x2d3254){return console[_0x2828db(0x1df)](_0x2828db(0x1ae),_0x2d3254),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0x47f3e4=a36_0x2452dd;return this[_0x47f3e4(0x201)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();