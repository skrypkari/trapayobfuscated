'use strict';const a38_0x45f22b=a38_0x545c;(function(_0x3639d9,_0x1908ff){const _0x10d123=a38_0x545c,_0x2dc321=_0x3639d9();while(!![]){try{const _0x525f40=parseInt(_0x10d123(0x158))/0x1+-parseInt(_0x10d123(0x188))/0x2*(-parseInt(_0x10d123(0x16f))/0x3)+-parseInt(_0x10d123(0x156))/0x4+-parseInt(_0x10d123(0x159))/0x5*(-parseInt(_0x10d123(0x189))/0x6)+-parseInt(_0x10d123(0x166))/0x7+parseInt(_0x10d123(0x14c))/0x8+-parseInt(_0x10d123(0x175))/0x9;if(_0x525f40===_0x1908ff)break;else _0x2dc321['push'](_0x2dc321['shift']());}catch(_0x43bcbc){_0x2dc321['push'](_0x2dc321['shift']());}}}(a38_0x4d38,0x3d4c1));function a38_0x545c(_0x123b33,_0x435cb2){const _0x4d3852=a38_0x4d38();return a38_0x545c=function(_0x545c5f,_0x314ac2){_0x545c5f=_0x545c5f-0x124;let _0x336af5=_0x4d3852[_0x545c5f];return _0x336af5;},a38_0x545c(_0x123b33,_0x435cb2);}var __importDefault=this&&this[a38_0x45f22b(0x19b)]||function(_0x281844){const _0x3bd6a2=a38_0x45f22b;return _0x281844&&_0x281844[_0x3bd6a2(0x17a)]?_0x281844:{'default':_0x281844};};Object[a38_0x45f22b(0x178)](exports,a38_0x45f22b(0x17a),{'value':!![]}),exports[a38_0x45f22b(0x18c)]=exports[a38_0x45f22b(0x13a)]=void 0x0;const database_1=__importDefault(require(a38_0x45f22b(0x199)));class CurrencyService{constructor(){const _0x4cdb21=a38_0x45f22b;this[_0x4cdb21(0x160)]=_0x4cdb21(0x16d),this[_0x4cdb21(0x13b)]=['btc',_0x4cdb21(0x146),'ltc',_0x4cdb21(0x187),_0x4cdb21(0x197),_0x4cdb21(0x17d),_0x4cdb21(0x177),_0x4cdb21(0x126),_0x4cdb21(0x179),_0x4cdb21(0x165),_0x4cdb21(0x162),_0x4cdb21(0x14b),_0x4cdb21(0x15c),'ars','aud',_0x4cdb21(0x140),_0x4cdb21(0x194),_0x4cdb21(0x137),_0x4cdb21(0x17b),'cad','chf',_0x4cdb21(0x193),_0x4cdb21(0x18b),'czk',_0x4cdb21(0x195),_0x4cdb21(0x173),'gbp',_0x4cdb21(0x196),_0x4cdb21(0x18d),_0x4cdb21(0x12d),_0x4cdb21(0x17e),_0x4cdb21(0x154),_0x4cdb21(0x131),'jpy','krw',_0x4cdb21(0x176),_0x4cdb21(0x19c),_0x4cdb21(0x128),_0x4cdb21(0x14e),_0x4cdb21(0x142),_0x4cdb21(0x15f),_0x4cdb21(0x184),'nzd',_0x4cdb21(0x182),_0x4cdb21(0x12a),_0x4cdb21(0x15e),_0x4cdb21(0x125),_0x4cdb21(0x183),'sek',_0x4cdb21(0x134),_0x4cdb21(0x181),_0x4cdb21(0x14f),'twd',_0x4cdb21(0x19d),'vef','vnd',_0x4cdb21(0x12f),_0x4cdb21(0x185),_0x4cdb21(0x18f),_0x4cdb21(0x133),_0x4cdb21(0x16e),_0x4cdb21(0x141)],this[_0x4cdb21(0x169)]=null,this[_0x4cdb21(0x12b)]=0x3,this['startPeriodicUpdates']();}[a38_0x45f22b(0x161)](){const _0x19af42=a38_0x45f22b;this[_0x19af42(0x17c)]()[_0x19af42(0x164)](_0x1ad574=>{const _0x5e7a32=_0x19af42;console[_0x5e7a32(0x143)](_0x5e7a32(0x150),_0x1ad574);}),this[_0x19af42(0x169)]=setInterval(async()=>{const _0x5eb61e=_0x19af42;try{await this[_0x5eb61e(0x17c)]();}catch(_0x3807e2){console[_0x5eb61e(0x143)](_0x5eb61e(0x13f),_0x3807e2);}},0x3c*0x3c*0x3e8),console[_0x19af42(0x172)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x45f22b(0x144)](){const _0x7668d3=a38_0x45f22b;this[_0x7668d3(0x169)]&&(clearInterval(this[_0x7668d3(0x169)]),this[_0x7668d3(0x169)]=null,console[_0x7668d3(0x172)](_0x7668d3(0x186)));}async['updateCurrencyRates'](){const _0x4d4684=a38_0x45f22b;try{console['log']('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x4c4cff=this[_0x4d4684(0x13b)][_0x4d4684(0x13c)](','),_0x21ae4f=this[_0x4d4684(0x160)]+_0x4d4684(0x16c)+_0x4c4cff,_0x3589b8=await fetch(_0x21ae4f,{'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x3589b8['ok'])throw new Error(_0x4d4684(0x163)+_0x3589b8[_0x4d4684(0x127)]+'\x20'+_0x3589b8[_0x4d4684(0x13d)]);const _0x4e6cfa=await _0x3589b8[_0x4d4684(0x192)]();if(!_0x4e6cfa['tether'])throw new Error(_0x4d4684(0x155));const _0x5609f5=_0x4e6cfa[_0x4d4684(0x16a)];console['log'](_0x4d4684(0x145)+Object[_0x4d4684(0x198)](_0x5609f5)['length']+_0x4d4684(0x18a));const _0x2c2098=Object[_0x4d4684(0x14a)](_0x5609f5)['map'](async([_0x434c54,_0x4ef915])=>{const _0x1e7f49=_0x4d4684;try{await database_1['default'][_0x1e7f49(0x18e)][_0x1e7f49(0x147)]({'where':{'currency':_0x434c54[_0x1e7f49(0x191)]()},'update':{'rate':_0x4ef915},'create':{'currency':_0x434c54[_0x1e7f49(0x191)](),'rate':_0x4ef915}});}catch(_0x2b39e1){console[_0x1e7f49(0x143)](_0x1e7f49(0x149)+_0x434c54+':',_0x2b39e1);}});await Promise[_0x4d4684(0x19a)](_0x2c2098),console[_0x4d4684(0x172)](_0x4d4684(0x132));}catch(_0x5434a9){console[_0x4d4684(0x143)](_0x4d4684(0x148),_0x5434a9);throw _0x5434a9;}}async[a38_0x45f22b(0x12c)](_0x58985c){const _0x58527f=a38_0x45f22b,_0x4405da=_0x58985c[_0x58527f(0x191)]();if(_0x4405da===_0x58527f(0x151))return 0x1;try{const _0x296b5b=await database_1[_0x58527f(0x14d)][_0x58527f(0x18e)][_0x58527f(0x15a)]({'where':{'currency':_0x4405da}});if(!_0x296b5b)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x58985c+',\x20using\x201\x20as\x20fallback'),0x1;return _0x296b5b['rate'];}catch(_0x3c7e85){return console[_0x58527f(0x143)](_0x58527f(0x167)+_0x58985c+':',_0x3c7e85),0x1;}}async[a38_0x45f22b(0x190)](_0x5c9a2d,_0x37ea01){const _0x380388=a38_0x45f22b,_0x53777c=_0x37ea01['toLowerCase']();if(_0x53777c===_0x380388(0x151)){const _0xf7fc9f=_0x5c9a2d*(0x1+this[_0x380388(0x12b)]/0x64);return console[_0x380388(0x172)](_0x380388(0x17f)+this[_0x380388(0x12b)]+_0x380388(0x13e)+_0x5c9a2d+'\x20USDT\x20=\x20'+_0xf7fc9f[_0x380388(0x174)](0x6)+'\x20USDT'),_0xf7fc9f;}try{const _0x120348=await this[_0x380388(0x12c)](_0x53777c),_0x1725a1=_0x5c9a2d/_0x120348,_0x110e3c=_0x1725a1*(0x1+this[_0x380388(0x12b)]/0x64);return console[_0x380388(0x172)](_0x380388(0x12e)+_0x5c9a2d+'\x20'+_0x37ea01[_0x380388(0x15b)]()+_0x380388(0x157)+_0x1725a1[_0x380388(0x174)](0x6)+'\x20USDT,\x20with\x20'+this[_0x380388(0x12b)]+_0x380388(0x138)+_0x110e3c[_0x380388(0x174)](0x6)+_0x380388(0x168)+_0x120348+')'),_0x110e3c;}catch(_0x3544e4){console[_0x380388(0x143)](_0x380388(0x171)+_0x5c9a2d+'\x20'+_0x37ea01+_0x380388(0x124),_0x3544e4);const _0x3bd536=_0x5c9a2d*(0x1+this[_0x380388(0x12b)]/0x64);return _0x3bd536;}}async[a38_0x45f22b(0x180)](_0x29221a){const _0xbb5bda=a38_0x45f22b;let _0xdac58e=0x0;for(const {amount:_0x133ae5,currency:_0x39813f}of _0x29221a){const _0x40a2b1=await this[_0xbb5bda(0x190)](_0x133ae5,_0x39813f);_0xdac58e+=_0x40a2b1;}return _0xdac58e;}async[a38_0x45f22b(0x136)](){const _0x3a9aea=a38_0x45f22b;try{const _0x236837=await database_1[_0x3a9aea(0x14d)][_0x3a9aea(0x18e)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1f345c={'usdt':0x1};return _0x236837[_0x3a9aea(0x170)](_0x138a1c=>{const _0x195381=_0x3a9aea;_0x1f345c[_0x138a1c[_0x195381(0x129)]]=_0x138a1c['rate'];}),_0x1f345c;}catch(_0x59b183){return console[_0x3a9aea(0x143)](_0x3a9aea(0x16b),_0x59b183),{'usdt':0x1};}}async['getRatesStatus'](){const _0x1e37ec=a38_0x45f22b;try{const [_0x4a90ca,_0x29073c,_0x459321]=await Promise['all']([database_1[_0x1e37ec(0x14d)][_0x1e37ec(0x18e)]['count'](),database_1[_0x1e37ec(0x14d)][_0x1e37ec(0x18e)][_0x1e37ec(0x130)]({'orderBy':{'updatedAt':_0x1e37ec(0x135)},'select':{'updatedAt':!![]}}),database_1[_0x1e37ec(0x14d)][_0x1e37ec(0x18e)][_0x1e37ec(0x130)]({'orderBy':{'updatedAt':_0x1e37ec(0x15d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4a90ca,'lastUpdated':_0x29073c?.[_0x1e37ec(0x152)]||null,'oldestRate':_0x459321?.[_0x1e37ec(0x152)]||null,'markupPercentage':this[_0x1e37ec(0x12b)]};}catch(_0x4842a4){return console[_0x1e37ec(0x143)](_0x1e37ec(0x153),_0x4842a4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x45f22b(0x139)](){const _0x1ad23b=a38_0x45f22b;return this[_0x1ad23b(0x12b)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x45f22b(0x18c)]=new CurrencyService();function a38_0x4d38(){const _0x41d9d5=['Error\x20getting\x20rates\x20status:','ils','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','1420832hBQxTq','\x20to\x20','28242aDRzrx','20285gXkLNE','findUnique','toUpperCase','aed','asc','pln','ngn','COINGECKO_URL','startPeriodicUpdates','yfi','CoinGecko\x20API\x20error:\x20','catch','dot','446411CDjLZC','Error\x20getting\x20rate\x20for\x20currency\x20','\x20USDT\x20(rate:\x20','updateInterval','tether','Error\x20getting\x20all\x20rates:','?ids=tether&vs_currencies=','https://api.coingecko.com/api/v3/simple/price','bits','783KRMeVB','forEach','Error\x20converting\x20','log','eur','toFixed','5380488RzzCLq','kwd','xrp','defineProperty','link','__esModule','brl','updateCurrencyRates','eos','idr','üí±\x20Applied\x20','convertMultipleToUSDT','thb','php','sar','nok','xdr','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','bch','3134DWUSFK','552HsPKjQ','\x20currencies','cny','currencyService','hkd','currencyRate','xag','convertToUSDT','toLowerCase','json','clp','bhd','dkk','gel','bnb','keys','../config/database','allSettled','__importDefault','lkr','uah','\x20to\x20USDT:','rub','xlm','status','mmk','currency','pkr','MARKUP_PERCENTAGE','getCurrencyRate','huf','üí±\x20Converted\x20','zar','findFirst','inr','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','xau','sgd','desc','getAllRates','bmd','%\x20markup\x20=\x20','getMarkupPercentage','CurrencyService','CURRENCIES','join','statusText','%\x20markup\x20to\x20','Periodic\x20currency\x20rates\x20update\x20failed:','bdt','sats','myr','error','stopPeriodicUpdates','üìä\x20Received\x20rates\x20for\x20','eth','upsert','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','Failed\x20to\x20update\x20rate\x20for\x20','entries','usd','3659304TeffoR','default','mxn','try','Initial\x20currency\x20rates\x20update\x20failed:','usdt','updatedAt'];a38_0x4d38=function(){return _0x41d9d5;};return a38_0x4d38();}