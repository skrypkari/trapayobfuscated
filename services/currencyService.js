'use strict';const a43_0x23c006=a43_0x56de;(function(_0x21d6ab,_0x21a4cc){const _0x1de574=a43_0x56de,_0x18e699=_0x21d6ab();while(!![]){try{const _0x45d5d2=-parseInt(_0x1de574(0xec))/0x1+-parseInt(_0x1de574(0xcd))/0x2*(-parseInt(_0x1de574(0xd8))/0x3)+-parseInt(_0x1de574(0xed))/0x4*(-parseInt(_0x1de574(0xdb))/0x5)+parseInt(_0x1de574(0x126))/0x6+parseInt(_0x1de574(0x123))/0x7+parseInt(_0x1de574(0x137))/0x8*(-parseInt(_0x1de574(0xcf))/0x9)+-parseInt(_0x1de574(0xd5))/0xa*(-parseInt(_0x1de574(0x11a))/0xb);if(_0x45d5d2===_0x21a4cc)break;else _0x18e699['push'](_0x18e699['shift']());}catch(_0x3548a9){_0x18e699['push'](_0x18e699['shift']());}}}(a43_0x136a,0x468fd));var __importDefault=this&&this[a43_0x23c006(0x116)]||function(_0x9834f4){return _0x9834f4&&_0x9834f4['__esModule']?_0x9834f4:{'default':_0x9834f4};};function a43_0x56de(_0x1c2bd,_0x27e1a4){const _0x136ac1=a43_0x136a();return a43_0x56de=function(_0x56debe,_0x5a578b){_0x56debe=_0x56debe-0xc3;let _0x4fb04e=_0x136ac1[_0x56debe];return _0x4fb04e;},a43_0x56de(_0x1c2bd,_0x27e1a4);}Object['defineProperty'](exports,a43_0x23c006(0xe0),{'value':!![]}),exports['currencyService']=exports[a43_0x23c006(0x107)]=void 0x0;function a43_0x136a(){const _0x2c0585=['convertToUSDT','__importDefault','toFixed','COINGECKO_URL','hkd','104786avfSkP','sgd','btc','xdr','cad','CURRENCIES','xau','desc','zar','482629mAnwwG','startPeriodicUpdates','✅\x20Currency\x20rates\x20updated\x20successfully','201006kVChLM','findUnique','usdt','bhd','clp','bits','https://api.coingecko.com/api/v3/simple/price','bdt','jpy','Error\x20getting\x20all\x20rates:','Error\x20converting\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xrp','lkr','\x20USDT','\x20to\x20USDT:','updateCurrencyRates','3056rvtBlR','nok',',\x20using\x201\x20as\x20fallback','xag','toUpperCase','eur','toLowerCase','getCurrencyRate','updatedAt','\x20currencies','Initial\x20currency\x20rates\x20update\x20failed:','dkk','❌\x20Failed\x20to\x20update\x20currency\x20rates:','updateInterval','266HxqXPK','application/json','8631lUWiMP','\x20to\x20','sats','log','eth','ars','140VLwYpo','MARKUP_PERCENTAGE','aud','11820FvvacV','CoinGecko\x20API\x20error:\x20','asc','1555JXcFJC','catch','%\x20markup\x20to\x20','entries','getAllRates','__esModule','Failed\x20to\x20update\x20rate\x20for\x20','currency','\x20USDT\x20(rate:\x20','No\x20rate\x20found\x20for\x20currency:\x20','vnd','pkr','gel','status','rate','length','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','236648ttjlfb','1700sqKSUC','join','getRatesStatus','ngn','czk','pln','📊\x20Received\x20rates\x20for\x20','Payment\x20System/1.0','currencyRate','chf','usd','findFirst','Error\x20getting\x20rates\x20status:','default','vef','krw','../config/database','currencyService','idr','yfi','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','mmk','tether','\x20USDT\x20=\x20','error','?ids=tether&vs_currencies=','CurrencyService','sar','link','sek','twd','ltc','json','thb','gbp','try','huf','upsert','map','bch'];a43_0x136a=function(){return _0x2c0585;};return a43_0x136a();}const database_1=__importDefault(require(a43_0x23c006(0xfd)));class CurrencyService{constructor(){const _0x28ef89=a43_0x23c006;this[_0x28ef89(0x118)]=_0x28ef89(0x12c),this[_0x28ef89(0x11f)]=[_0x28ef89(0x11c),_0x28ef89(0xd3),_0x28ef89(0x10c),_0x28ef89(0x114),'bnb','eos',_0x28ef89(0x132),'xlm',_0x28ef89(0x109),'dot',_0x28ef89(0x100),_0x28ef89(0xf7),'aed',_0x28ef89(0xd4),_0x28ef89(0xd7),_0x28ef89(0x12d),_0x28ef89(0x129),'bmd','brl',_0x28ef89(0x11e),_0x28ef89(0xf6),_0x28ef89(0x12a),'cny',_0x28ef89(0xf1),_0x28ef89(0xca),_0x28ef89(0xc4),_0x28ef89(0x10f),_0x28ef89(0xe7),_0x28ef89(0x119),_0x28ef89(0x111),_0x28ef89(0xff),'ils','inr',_0x28ef89(0x12e),_0x28ef89(0xfc),'kwd',_0x28ef89(0x133),_0x28ef89(0x102),'mxn','myr',_0x28ef89(0xf0),_0x28ef89(0x138),'nzd','php',_0x28ef89(0xe6),_0x28ef89(0xf2),'rub',_0x28ef89(0x108),_0x28ef89(0x10a),_0x28ef89(0x11b),_0x28ef89(0x10e),_0x28ef89(0x110),_0x28ef89(0x10b),'uah',_0x28ef89(0xfb),_0x28ef89(0xe5),_0x28ef89(0x122),_0x28ef89(0x11d),_0x28ef89(0x13a),_0x28ef89(0x120),_0x28ef89(0x12b),_0x28ef89(0xd1)],this[_0x28ef89(0xcc)]=null,this[_0x28ef89(0xd6)]=-0x3,this[_0x28ef89(0x124)]();}[a43_0x23c006(0x124)](){const _0x52b524=a43_0x23c006;this[_0x52b524(0x136)]()[_0x52b524(0xdc)](_0x1ffb5f=>{const _0x525e27=_0x52b524;console[_0x525e27(0x105)](_0x525e27(0xc9),_0x1ffb5f);}),this[_0x52b524(0xcc)]=setInterval(async()=>{const _0x681b14=_0x52b524;try{await this['updateCurrencyRates']();}catch(_0x3e23b4){console[_0x681b14(0x105)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x3e23b4);}},0x3c*0x3c*0x3e8),console[_0x52b524(0xd2)](_0x52b524(0x131));}['stopPeriodicUpdates'](){const _0x27fb14=a43_0x23c006;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x27fb14(0xcc)]=null,console[_0x27fb14(0xd2)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a43_0x23c006(0x136)](){const _0x351f56=a43_0x23c006;try{console[_0x351f56(0xd2)](_0x351f56(0xeb));const _0x241268=this[_0x351f56(0x11f)][_0x351f56(0xee)](','),_0x18bfb2=this[_0x351f56(0x118)]+_0x351f56(0x106)+_0x241268,_0x447296=await fetch(_0x18bfb2,{'headers':{'Accept':_0x351f56(0xce),'User-Agent':_0x351f56(0xf4)}});if(!_0x447296['ok'])throw new Error(_0x351f56(0xd9)+_0x447296[_0x351f56(0xe8)]+'\x20'+_0x447296['statusText']);const _0x424321=await _0x447296[_0x351f56(0x10d)]();if(!_0x424321[_0x351f56(0x103)])throw new Error(_0x351f56(0x101));const _0xd4d7ad=_0x424321[_0x351f56(0x103)];console[_0x351f56(0xd2)](_0x351f56(0xf3)+Object['keys'](_0xd4d7ad)[_0x351f56(0xea)]+_0x351f56(0xc8));const _0x3747fc=Object[_0x351f56(0xde)](_0xd4d7ad)[_0x351f56(0x113)](async([_0x3b7e08,_0x2a0897])=>{const _0x44bc07=_0x351f56;try{await database_1[_0x44bc07(0xfa)]['currencyRate'][_0x44bc07(0x112)]({'where':{'currency':_0x3b7e08['toLowerCase']()},'update':{'rate':_0x2a0897},'create':{'currency':_0x3b7e08[_0x44bc07(0xc5)](),'rate':_0x2a0897}});}catch(_0x221271){console[_0x44bc07(0x105)](_0x44bc07(0xe1)+_0x3b7e08+':',_0x221271);}});await Promise['allSettled'](_0x3747fc),console[_0x351f56(0xd2)](_0x351f56(0x125));}catch(_0x4aaf4a){console['error'](_0x351f56(0xcb),_0x4aaf4a);throw _0x4aaf4a;}}async[a43_0x23c006(0xc6)](_0x11fbfd){const _0x93a8f7=a43_0x23c006,_0x1551c5=_0x11fbfd['toLowerCase']();if(_0x1551c5===_0x93a8f7(0x128))return 0x1;try{const _0x3fed2c=await database_1[_0x93a8f7(0xfa)][_0x93a8f7(0xf5)][_0x93a8f7(0x127)]({'where':{'currency':_0x1551c5}});if(!_0x3fed2c)return console['warn'](_0x93a8f7(0xe4)+_0x11fbfd+_0x93a8f7(0x139)),0x1;return _0x3fed2c[_0x93a8f7(0xe9)];}catch(_0x47ceb6){return console[_0x93a8f7(0x105)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x11fbfd+':',_0x47ceb6),0x1;}}async[a43_0x23c006(0x115)](_0x5d6090,_0x4658f1){const _0x128bb0=a43_0x23c006,_0x5cb1ec=_0x4658f1['toLowerCase']();if(_0x5cb1ec===_0x128bb0(0x128)){const _0x30bc2c=_0x5d6090*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x128bb0(0xd2)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x128bb0(0xdd)+_0x5d6090+_0x128bb0(0x104)+_0x30bc2c[_0x128bb0(0x117)](0x6)+_0x128bb0(0x134)),_0x30bc2c;}try{const _0x2e4903=await this[_0x128bb0(0xc6)](_0x5cb1ec),_0x49df98=_0x5d6090/_0x2e4903,_0x83a3d1=_0x49df98*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log']('💱\x20Converted\x20'+_0x5d6090+'\x20'+_0x4658f1[_0x128bb0(0xc3)]()+_0x128bb0(0xd0)+_0x49df98[_0x128bb0(0x117)](0x6)+'\x20USDT,\x20with\x20'+this[_0x128bb0(0xd6)]+'%\x20markup\x20=\x20'+_0x83a3d1[_0x128bb0(0x117)](0x6)+_0x128bb0(0xe3)+_0x2e4903+')'),_0x83a3d1;}catch(_0x544b0d){console['error'](_0x128bb0(0x130)+_0x5d6090+'\x20'+_0x4658f1+_0x128bb0(0x135),_0x544b0d);const _0x317b92=_0x5d6090*(0x1+this[_0x128bb0(0xd6)]/0x64);return _0x317b92;}}async['convertMultipleToUSDT'](_0x338434){const _0xa68d0d=a43_0x23c006;let _0x63d420=0x0;for(const {amount:_0x14c412,currency:_0x4f6a1a}of _0x338434){const _0x38fa48=await this[_0xa68d0d(0x115)](_0x14c412,_0x4f6a1a);_0x63d420+=_0x38fa48;}return _0x63d420;}async[a43_0x23c006(0xdf)](){const _0x179897=a43_0x23c006;try{const _0x1d5fd5=await database_1[_0x179897(0xfa)][_0x179897(0xf5)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x270e22={'usdt':0x1};return _0x1d5fd5['forEach'](_0x56655e=>{const _0x345e0f=_0x179897;_0x270e22[_0x56655e[_0x345e0f(0xe2)]]=_0x56655e[_0x345e0f(0xe9)];}),_0x270e22;}catch(_0x25abc4){return console[_0x179897(0x105)](_0x179897(0x12f),_0x25abc4),{'usdt':0x1};}}async[a43_0x23c006(0xef)](){const _0x31a24a=a43_0x23c006;try{const [_0x3064bf,_0x2cc77,_0xa05c2f]=await Promise['all']([database_1[_0x31a24a(0xfa)][_0x31a24a(0xf5)]['count'](),database_1[_0x31a24a(0xfa)][_0x31a24a(0xf5)]['findFirst']({'orderBy':{'updatedAt':_0x31a24a(0x121)},'select':{'updatedAt':!![]}}),database_1[_0x31a24a(0xfa)][_0x31a24a(0xf5)][_0x31a24a(0xf8)]({'orderBy':{'updatedAt':_0x31a24a(0xda)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3064bf,'lastUpdated':_0x2cc77?.[_0x31a24a(0xc7)]||null,'oldestRate':_0xa05c2f?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x76b14f){return console[_0x31a24a(0x105)](_0x31a24a(0xf9),_0x76b14f),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x31a24a(0xd6)]};}}['getMarkupPercentage'](){const _0x5952ad=a43_0x23c006;return this[_0x5952ad(0xd6)];}}exports[a43_0x23c006(0x107)]=CurrencyService,exports[a43_0x23c006(0xfe)]=new CurrencyService();