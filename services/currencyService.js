'use strict';const a58_0x1aaefb=a58_0x31cf;(function(_0x3bc9a3,_0x4cd496){const _0x3fd050=a58_0x31cf,_0x243518=_0x3bc9a3();while(!![]){try{const _0x24c387=-parseInt(_0x3fd050(0x1ea))/0x1+-parseInt(_0x3fd050(0x226))/0x2+parseInt(_0x3fd050(0x1d6))/0x3*(parseInt(_0x3fd050(0x202))/0x4)+parseInt(_0x3fd050(0x1d9))/0x5*(parseInt(_0x3fd050(0x1e1))/0x6)+parseInt(_0x3fd050(0x229))/0x7*(parseInt(_0x3fd050(0x1db))/0x8)+-parseInt(_0x3fd050(0x212))/0x9+parseInt(_0x3fd050(0x1b9))/0xa;if(_0x24c387===_0x4cd496)break;else _0x243518['push'](_0x243518['shift']());}catch(_0x1dc430){_0x243518['push'](_0x243518['shift']());}}}(a58_0x32bb,0x921f5));function a58_0x32bb(){const _0x5a13a0=['\x20USDT,\x20with\x20','keys','ðŸ“Š\x20Received\x20rates\x20for\x20','kwd','getAllRates','updateInterval','bdt','myr','bits','length','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','gbp','rub','Periodic\x20currency\x20rates\x20update\x20failed:','startPeriodicUpdates','1907930guUKpl','twd','currency','2149kPBipW',',\x20using\x201\x20as\x20fallback','xrp','Error\x20getting\x20all\x20rates:','CoinGecko\x20API\x20error:\x20','cny','sats','dot','COINGECKO_URL','thb','1062210ccAEJb','MARKUP_PERCENTAGE','link','findUnique','uah','ltc','getMarkupPercentage','catch','currencyRate','ðŸ’±\x20Applied\x20','yfi','aed','Failed\x20to\x20update\x20rate\x20for\x20','toUpperCase','error','__esModule','ngn','mxn','brl','nok','âœ…\x20Currency\x20rates\x20updated\x20successfully','idr','log','eth','aud','lkr','\x20USDT\x20=\x20','getCurrencyRate','defineProperty','21bnSaTc','mmk','statusText','4844005kRjjRt','\x20USDT\x20(rate:\x20','6152PhBWQT','forEach','hkd','application/json','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','eur','6ciCuDt','all','ðŸ’±\x20Converted\x20','json','default','%\x20markup\x20=\x20','pkr','findFirst','convertToUSDT','349129DsNTSH','updateCurrencyRates','status','chf','slice','CURRENCIES','updatedAt','warn','xdr','sek','czk','desc','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','No\x20rate\x20found\x20for\x20currency:\x20','\x20to\x20','rate','upsert','stopPeriodicUpdates','tether','pln','usd','xau','vef','try','651980ljruTJ','sgd','gel','getRatesStatus','\x20to\x20USDT:','%\x20markup\x20to\x20','__importDefault','count','toFixed','ars','Initial\x20currency\x20rates\x20update\x20failed:','join','convertMultipleToUSDT','usdt','map','sar','4954131rhRMua','dkk','\x20currencies','toLowerCase','bch'];a58_0x32bb=function(){return _0x5a13a0;};return a58_0x32bb();}function a58_0x31cf(_0x5ed4c6,_0x396e32){_0x5ed4c6=_0x5ed4c6-0x1b8;const _0x32bb99=a58_0x32bb();let _0x31cf0d=_0x32bb99[_0x5ed4c6];return _0x31cf0d;}var __importDefault=this&&this[a58_0x1aaefb(0x208)]||function(_0x43e8c5){const _0x28dc76=a58_0x1aaefb;return _0x43e8c5&&_0x43e8c5[_0x28dc76(0x1c8)]?_0x43e8c5:{'default':_0x43e8c5};};Object[a58_0x1aaefb(0x1d5)](exports,a58_0x1aaefb(0x1c8),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x437db9=a58_0x1aaefb;this[_0x437db9(0x231)]='https://api.coingecko.com/api/v3/simple/price',this[_0x437db9(0x1ef)]=['btc',_0x437db9(0x1d0),_0x437db9(0x1be),_0x437db9(0x216),'bnb','eos',_0x437db9(0x22b),'xlm',_0x437db9(0x1bb),_0x437db9(0x230),_0x437db9(0x1c3),_0x437db9(0x1fe),_0x437db9(0x1c4),_0x437db9(0x20b),_0x437db9(0x1d1),_0x437db9(0x21d),'bhd','bmd',_0x437db9(0x1cb),'cad',_0x437db9(0x1ed),'clp',_0x437db9(0x22e),_0x437db9(0x1f4),_0x437db9(0x213),_0x437db9(0x1e0),_0x437db9(0x222),_0x437db9(0x204),_0x437db9(0x1dd),'huf',_0x437db9(0x1ce),'ils','inr','jpy','krw',_0x437db9(0x21a),_0x437db9(0x1d2),_0x437db9(0x1d7),_0x437db9(0x1ca),_0x437db9(0x21e),_0x437db9(0x1c9),_0x437db9(0x1cc),'nzd','php',_0x437db9(0x1e7),_0x437db9(0x1fd),_0x437db9(0x223),_0x437db9(0x211),_0x437db9(0x1f3),_0x437db9(0x203),_0x437db9(0x1b8),_0x437db9(0x201),_0x437db9(0x227),_0x437db9(0x1bd),_0x437db9(0x200),'vnd','zar',_0x437db9(0x1f2),'xag',_0x437db9(0x1ff),_0x437db9(0x21f),_0x437db9(0x22f)],this[_0x437db9(0x21c)]=null,this[_0x437db9(0x1ba)]=-0x3,this[_0x437db9(0x225)]();}[a58_0x1aaefb(0x225)](){const _0x2f6fa1=a58_0x1aaefb;this[_0x2f6fa1(0x1eb)]()[_0x2f6fa1(0x1c0)](_0x44c4c0=>{const _0x250e1b=_0x2f6fa1;console[_0x250e1b(0x1c7)](_0x250e1b(0x20c),_0x44c4c0);}),this[_0x2f6fa1(0x21c)]=setInterval(async()=>{const _0x428847=_0x2f6fa1;try{await this[_0x428847(0x1eb)]();}catch(_0x5da28a){console[_0x428847(0x1c7)](_0x428847(0x224),_0x5da28a);}},0x3c*0x3c*0x3e8),console[_0x2f6fa1(0x1cf)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a58_0x1aaefb(0x1fb)](){const _0x5492e9=a58_0x1aaefb;this[_0x5492e9(0x21c)]&&(clearInterval(this[_0x5492e9(0x21c)]),this[_0x5492e9(0x21c)]=null,console[_0x5492e9(0x1cf)](_0x5492e9(0x1f6)));}async[a58_0x1aaefb(0x1eb)](){const _0x5991e1=a58_0x1aaefb;try{console['log']('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x5e82d1=this[_0x5991e1(0x1ef)][_0x5991e1(0x20d)](','),_0x171be3=this[_0x5991e1(0x231)]+'?ids=tether&vs_currencies='+_0x5e82d1,_0x3f55d5=await fetch(_0x171be3,{'headers':{'Accept':_0x5991e1(0x1de),'User-Agent':'Payment\x20System/1.0'}});if(!_0x3f55d5['ok'])throw new Error(_0x5991e1(0x22d)+_0x3f55d5[_0x5991e1(0x1ec)]+'\x20'+_0x3f55d5[_0x5991e1(0x1d8)]);const _0x9119e3=await _0x3f55d5[_0x5991e1(0x1e4)]();if(!_0x9119e3[_0x5991e1(0x1fc)])throw new Error(_0x5991e1(0x1df));const _0x55a6a4=_0x9119e3[_0x5991e1(0x1fc)];console[_0x5991e1(0x1cf)](_0x5991e1(0x219)+Object[_0x5991e1(0x218)](_0x55a6a4)[_0x5991e1(0x220)]+_0x5991e1(0x214));const _0x22b4ad=0x5,_0x4a4555=Object['entries'](_0x55a6a4);for(let _0x4ea09a=0x0;_0x4ea09a<_0x4a4555[_0x5991e1(0x220)];_0x4ea09a+=_0x22b4ad){const _0x4064db=_0x4a4555[_0x5991e1(0x1ee)](_0x4ea09a,_0x4ea09a+_0x22b4ad),_0x5c97c0=_0x4064db[_0x5991e1(0x210)](async([_0x380857,_0x5d17c5])=>{const _0x341730=_0x5991e1;try{await database_1[_0x341730(0x1e5)][_0x341730(0x1c1)][_0x341730(0x1fa)]({'where':{'currency':_0x380857[_0x341730(0x215)]()},'update':{'rate':_0x5d17c5},'create':{'currency':_0x380857[_0x341730(0x215)](),'rate':_0x5d17c5}});}catch(_0x29ae95){console[_0x341730(0x1c7)](_0x341730(0x1c5)+_0x380857+':',_0x29ae95);}});await Promise[_0x5991e1(0x1e2)](_0x5c97c0);}console[_0x5991e1(0x1cf)](_0x5991e1(0x1cd));}catch(_0x2b4f4b){console['error'](_0x5991e1(0x221),_0x2b4f4b);throw _0x2b4f4b;}}async['getCurrencyRate'](_0x93f6dc){const _0x10f8b4=a58_0x1aaefb,_0x397a8f=_0x93f6dc[_0x10f8b4(0x215)]();if(_0x397a8f===_0x10f8b4(0x20f))return 0x1;try{const _0x793e0f=await database_1['default'][_0x10f8b4(0x1c1)][_0x10f8b4(0x1bc)]({'where':{'currency':_0x397a8f}});if(!_0x793e0f)return console[_0x10f8b4(0x1f1)](_0x10f8b4(0x1f7)+_0x93f6dc+_0x10f8b4(0x22a)),0x1;return _0x793e0f[_0x10f8b4(0x1f9)];}catch(_0x3954f9){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x93f6dc+':',_0x3954f9),0x1;}}async[a58_0x1aaefb(0x1e9)](_0x355da1,_0x162d00){const _0x5c2277=a58_0x1aaefb,_0x264663=_0x162d00[_0x5c2277(0x215)]();if(_0x264663===_0x5c2277(0x20f)){const _0x3f7fc1=_0x355da1*(0x1+this[_0x5c2277(0x1ba)]/0x64);return console[_0x5c2277(0x1cf)](_0x5c2277(0x1c2)+this[_0x5c2277(0x1ba)]+_0x5c2277(0x207)+_0x355da1+_0x5c2277(0x1d3)+_0x3f7fc1[_0x5c2277(0x20a)](0x6)+'\x20USDT'),_0x3f7fc1;}try{const _0x2d842a=await this[_0x5c2277(0x1d4)](_0x264663),_0x46d949=_0x355da1/_0x2d842a,_0x5b1c1d=_0x46d949*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5c2277(0x1cf)](_0x5c2277(0x1e3)+_0x355da1+'\x20'+_0x162d00[_0x5c2277(0x1c6)]()+_0x5c2277(0x1f8)+_0x46d949[_0x5c2277(0x20a)](0x6)+_0x5c2277(0x217)+this[_0x5c2277(0x1ba)]+_0x5c2277(0x1e6)+_0x5b1c1d[_0x5c2277(0x20a)](0x6)+_0x5c2277(0x1da)+_0x2d842a+')'),_0x5b1c1d;}catch(_0x4c20e5){console['error']('Error\x20converting\x20'+_0x355da1+'\x20'+_0x162d00+_0x5c2277(0x206),_0x4c20e5);const _0x80fbd=_0x355da1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x80fbd;}}async[a58_0x1aaefb(0x20e)](_0x397c5a){const _0x27cd05=a58_0x1aaefb;let _0xc5090c=0x0;for(const {amount:_0xa8f5d,currency:_0x2bbcee}of _0x397c5a){const _0x17dc8c=await this[_0x27cd05(0x1e9)](_0xa8f5d,_0x2bbcee);_0xc5090c+=_0x17dc8c;}return _0xc5090c;}async[a58_0x1aaefb(0x21b)](){const _0x10cf21=a58_0x1aaefb;try{const _0x21f714=await database_1[_0x10cf21(0x1e5)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x309c77={'usdt':0x1};return _0x21f714[_0x10cf21(0x1dc)](_0x547c43=>{const _0x40c4e3=_0x10cf21;_0x309c77[_0x547c43[_0x40c4e3(0x228)]]=_0x547c43['rate'];}),_0x309c77;}catch(_0x3daa4f){return console['error'](_0x10cf21(0x22c),_0x3daa4f),{'usdt':0x1};}}async[a58_0x1aaefb(0x205)](){const _0x1576e8=a58_0x1aaefb;try{const [_0x182a55,_0x818c2,_0x112f00]=await Promise['all']([database_1['default'][_0x1576e8(0x1c1)][_0x1576e8(0x209)](),database_1[_0x1576e8(0x1e5)][_0x1576e8(0x1c1)][_0x1576e8(0x1e8)]({'orderBy':{'updatedAt':_0x1576e8(0x1f5)},'select':{'updatedAt':!![]}}),database_1[_0x1576e8(0x1e5)]['currencyRate'][_0x1576e8(0x1e8)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x182a55,'lastUpdated':_0x818c2?.[_0x1576e8(0x1f0)]||null,'oldestRate':_0x112f00?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x3847b8){return console[_0x1576e8(0x1c7)]('Error\x20getting\x20rates\x20status:',_0x3847b8),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1576e8(0x1ba)]};}}[a58_0x1aaefb(0x1bf)](){const _0x5ea30d=a58_0x1aaefb;return this[_0x5ea30d(0x1ba)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();