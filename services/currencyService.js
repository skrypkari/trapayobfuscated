'use strict';const a38_0x31798f=a38_0x44e8;(function(_0x20d2d6,_0x267538){const _0x5e8266=a38_0x44e8,_0x446f19=_0x20d2d6();while(!![]){try{const _0x107683=parseInt(_0x5e8266(0xce))/0x1*(-parseInt(_0x5e8266(0x7f))/0x2)+parseInt(_0x5e8266(0x97))/0x3*(-parseInt(_0x5e8266(0x79))/0x4)+-parseInt(_0x5e8266(0xa7))/0x5+-parseInt(_0x5e8266(0xcd))/0x6+parseInt(_0x5e8266(0xbf))/0x7+parseInt(_0x5e8266(0xd7))/0x8+parseInt(_0x5e8266(0xa8))/0x9*(parseInt(_0x5e8266(0x94))/0xa);if(_0x107683===_0x267538)break;else _0x446f19['push'](_0x446f19['shift']());}catch(_0x53788c){_0x446f19['push'](_0x446f19['shift']());}}}(a38_0x3508,0x6b33f));var __importDefault=this&&this[a38_0x31798f(0x9a)]||function(_0x403800){const _0x4564be=a38_0x31798f;return _0x403800&&_0x403800[_0x4564be(0x6b)]?_0x403800:{'default':_0x403800};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;function a38_0x44e8(_0x14abeb,_0x5af928){const _0x350893=a38_0x3508();return a38_0x44e8=function(_0x44e869,_0x336317){_0x44e869=_0x44e869-0x69;let _0x2008a2=_0x350893[_0x44e869];return _0x2008a2;},a38_0x44e8(_0x14abeb,_0x5af928);}const database_1=__importDefault(require('../config/database'));function a38_0x3508(){const _0x5e0a8d=['catch','bhd','application/json','json','sar','getAllRates','rub','warn','3633830ZzfTiG','18WtpPGG','log','tether','rate','asc','toFixed','entries','convertMultipleToUSDT','count','ils','updateCurrencyRates','startPeriodicUpdates','usd','CURRENCIES','✅\x20Currency\x20rates\x20updated\x20successfully','convertToUSDT','currencyRate','myr','bits','map','Error\x20getting\x20all\x20rates:','mmk','COINGECKO_URL','5230176vOlDLx','Error\x20getting\x20rate\x20for\x20currency\x20','https://api.coingecko.com/api/v3/simple/price','aed','eur','updatedAt','Error\x20getting\x20rates\x20status:','\x20currencies','cad','%\x20markup\x20=\x20','eth','MARKUP_PERCENTAGE','ars','twd','5229240iSzSaE','827WTTCJA','error','vef','bch','Error\x20converting\x20','getRatesStatus','CoinGecko\x20API\x20error:\x20','ngn','\x20USDT\x20(rate:\x20','3745144pGLgXE','all','\x20USDT\x20=\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','findFirst','findUnique','\x20USDT,\x20with\x20','length','btc','bmd','__esModule','❌\x20Failed\x20to\x20update\x20currency\x20rates:','updateInterval','getCurrencyRate','\x20USDT','?ids=tether&vs_currencies=','dot','Initial\x20currency\x20rates\x20update\x20failed:',',\x20using\x201\x20as\x20fallback','keys','ltc','toLowerCase','inr','findMany','3472252KHrtGH','bdt','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','💱\x20Applied\x20','xrp','hkd','806poWqYX','gbp','yfi','try','default','sgd','krw','nok','toUpperCase','huf','link','TesSoft\x20Payment\x20System/1.0','dkk','chf','getMarkupPercentage','%\x20markup\x20to\x20','gel','pkr','xau','join','kwd','10117210sxqTWa','brl','\x20to\x20USDT:','3flwLga','lkr','php','__importDefault','usdt','sats','stopPeriodicUpdates','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...'];a38_0x3508=function(){return _0x5e0a8d;};return a38_0x3508();}class CurrencyService{constructor(){const _0x3f8ad6=a38_0x31798f;this[_0x3f8ad6(0xbe)]=_0x3f8ad6(0xc1),this['CURRENCIES']=[_0x3f8ad6(0x69),_0x3f8ad6(0xc9),_0x3f8ad6(0x75),_0x3f8ad6(0xd1),'bnb','eos',_0x3f8ad6(0x7d),'xlm',_0x3f8ad6(0x89),_0x3f8ad6(0x71),_0x3f8ad6(0x81),_0x3f8ad6(0xb4),_0x3f8ad6(0xc2),_0x3f8ad6(0xcb),'aud',_0x3f8ad6(0x7a),_0x3f8ad6(0xa0),_0x3f8ad6(0x6a),_0x3f8ad6(0x95),_0x3f8ad6(0xc7),_0x3f8ad6(0x8c),'clp','cny','czk',_0x3f8ad6(0x8b),_0x3f8ad6(0xc3),_0x3f8ad6(0x80),_0x3f8ad6(0x8f),_0x3f8ad6(0x7e),_0x3f8ad6(0x88),'idr',_0x3f8ad6(0xb1),_0x3f8ad6(0x77),'jpy',_0x3f8ad6(0x85),_0x3f8ad6(0x93),_0x3f8ad6(0x98),_0x3f8ad6(0xbd),'mxn',_0x3f8ad6(0xb9),_0x3f8ad6(0xd5),_0x3f8ad6(0x86),'nzd',_0x3f8ad6(0x99),_0x3f8ad6(0x90),'pln',_0x3f8ad6(0xa5),_0x3f8ad6(0xa3),'sek',_0x3f8ad6(0x84),'thb',_0x3f8ad6(0x82),_0x3f8ad6(0xcc),'uah',_0x3f8ad6(0xd0),'vnd','zar','xdr','xag',_0x3f8ad6(0x91),_0x3f8ad6(0xba),_0x3f8ad6(0x9c)],this[_0x3f8ad6(0x6d)]=null,this[_0x3f8ad6(0xca)]=0x3,this[_0x3f8ad6(0xb3)]();}[a38_0x31798f(0xb3)](){const _0x16cecc=a38_0x31798f;this[_0x16cecc(0xb2)]()[_0x16cecc(0x9f)](_0x2cedac=>{const _0x1f9fff=_0x16cecc;console[_0x1f9fff(0xcf)](_0x1f9fff(0x72),_0x2cedac);}),this['updateInterval']=setInterval(async()=>{const _0x4cdd0b=_0x16cecc;try{await this[_0x4cdd0b(0xb2)]();}catch(_0x16504c){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x16504c);}},0x3c*0x3c*0x3e8),console[_0x16cecc(0xa9)](_0x16cecc(0xda));}[a38_0x31798f(0x9d)](){const _0x47b734=a38_0x31798f;this[_0x47b734(0x6d)]&&(clearInterval(this['updateInterval']),this[_0x47b734(0x6d)]=null,console[_0x47b734(0xa9)](_0x47b734(0x7b)));}async[a38_0x31798f(0xb2)](){const _0x63810b=a38_0x31798f;try{console[_0x63810b(0xa9)](_0x63810b(0x9e));const _0x5be4f4=this[_0x63810b(0xb5)][_0x63810b(0x92)](','),_0x197890=this['COINGECKO_URL']+_0x63810b(0x70)+_0x5be4f4,_0x531238=await fetch(_0x197890,{'headers':{'Accept':_0x63810b(0xa1),'User-Agent':_0x63810b(0x8a)}});if(!_0x531238['ok'])throw new Error(_0x63810b(0xd4)+_0x531238['status']+'\x20'+_0x531238['statusText']);const _0x922456=await _0x531238[_0x63810b(0xa2)]();if(!_0x922456[_0x63810b(0xaa)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x31164a=_0x922456[_0x63810b(0xaa)];console[_0x63810b(0xa9)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x63810b(0x74)](_0x31164a)[_0x63810b(0xde)]+_0x63810b(0xc6));const _0x243d10=Object[_0x63810b(0xae)](_0x31164a)[_0x63810b(0xbb)](async([_0x4bcf86,_0x48a6da])=>{const _0x5c9779=_0x63810b;try{await database_1[_0x5c9779(0x83)][_0x5c9779(0xb8)]['upsert']({'where':{'currency':_0x4bcf86[_0x5c9779(0x76)]()},'update':{'rate':_0x48a6da},'create':{'currency':_0x4bcf86[_0x5c9779(0x76)](),'rate':_0x48a6da}});}catch(_0x4e5205){console[_0x5c9779(0xcf)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x4bcf86+':',_0x4e5205);}});await Promise['allSettled'](_0x243d10),console[_0x63810b(0xa9)](_0x63810b(0xb6));}catch(_0x4dbd20){console[_0x63810b(0xcf)](_0x63810b(0x6c),_0x4dbd20);throw _0x4dbd20;}}async['getCurrencyRate'](_0x58b297){const _0x304284=a38_0x31798f,_0x2e05b4=_0x58b297[_0x304284(0x76)]();if(_0x2e05b4===_0x304284(0x9b))return 0x1;try{const _0x59a8cd=await database_1['default'][_0x304284(0xb8)][_0x304284(0xdc)]({'where':{'currency':_0x2e05b4}});if(!_0x59a8cd)return console[_0x304284(0xa6)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x58b297+_0x304284(0x73)),0x1;return _0x59a8cd[_0x304284(0xab)];}catch(_0xd04af7){return console[_0x304284(0xcf)](_0x304284(0xc0)+_0x58b297+':',_0xd04af7),0x1;}}async['convertToUSDT'](_0x160d06,_0x58fbb2){const _0x261faa=a38_0x31798f,_0x2d9f7e=_0x58fbb2[_0x261faa(0x76)]();if(_0x2d9f7e===_0x261faa(0x9b)){const _0xa8754a=_0x160d06*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x261faa(0xa9)](_0x261faa(0x7c)+this[_0x261faa(0xca)]+_0x261faa(0x8e)+_0x160d06+_0x261faa(0xd9)+_0xa8754a[_0x261faa(0xad)](0x6)+_0x261faa(0x6f)),_0xa8754a;}try{const _0x42183a=await this[_0x261faa(0x6e)](_0x2d9f7e),_0x5c0bab=_0x160d06/_0x42183a,_0x3c50e5=_0x5c0bab*(0x1+this[_0x261faa(0xca)]/0x64);return console[_0x261faa(0xa9)]('💱\x20Converted\x20'+_0x160d06+'\x20'+_0x58fbb2[_0x261faa(0x87)]()+'\x20to\x20'+_0x5c0bab['toFixed'](0x6)+_0x261faa(0xdd)+this[_0x261faa(0xca)]+_0x261faa(0xc8)+_0x3c50e5[_0x261faa(0xad)](0x6)+_0x261faa(0xd6)+_0x42183a+')'),_0x3c50e5;}catch(_0x593e2c){console['error'](_0x261faa(0xd2)+_0x160d06+'\x20'+_0x58fbb2+_0x261faa(0x96),_0x593e2c);const _0x5009d1=_0x160d06*(0x1+this[_0x261faa(0xca)]/0x64);return _0x5009d1;}}async[a38_0x31798f(0xaf)](_0x25632b){const _0x4ea981=a38_0x31798f;let _0x3b1697=0x0;for(const {amount:_0x339874,currency:_0x4c09be}of _0x25632b){const _0x113526=await this[_0x4ea981(0xb7)](_0x339874,_0x4c09be);_0x3b1697+=_0x113526;}return _0x3b1697;}async[a38_0x31798f(0xa4)](){const _0x2bc3b7=a38_0x31798f;try{const _0x1b5729=await database_1[_0x2bc3b7(0x83)][_0x2bc3b7(0xb8)][_0x2bc3b7(0x78)]({'select':{'currency':!![],'rate':!![]}}),_0x210a70={'usdt':0x1};return _0x1b5729['forEach'](_0x165d6e=>{_0x210a70[_0x165d6e['currency']]=_0x165d6e['rate'];}),_0x210a70;}catch(_0x280461){return console['error'](_0x2bc3b7(0xbc),_0x280461),{'usdt':0x1};}}async[a38_0x31798f(0xd3)](){const _0x5f49e8=a38_0x31798f;try{const [_0x3db8e1,_0x3c7d22,_0x5cc912]=await Promise[_0x5f49e8(0xd8)]([database_1[_0x5f49e8(0x83)][_0x5f49e8(0xb8)][_0x5f49e8(0xb0)](),database_1[_0x5f49e8(0x83)][_0x5f49e8(0xb8)][_0x5f49e8(0xdb)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x5f49e8(0x83)][_0x5f49e8(0xb8)]['findFirst']({'orderBy':{'updatedAt':_0x5f49e8(0xac)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3db8e1,'lastUpdated':_0x3c7d22?.[_0x5f49e8(0xc4)]||null,'oldestRate':_0x5cc912?.[_0x5f49e8(0xc4)]||null,'markupPercentage':this[_0x5f49e8(0xca)]};}catch(_0x4639ae){return console[_0x5f49e8(0xcf)](_0x5f49e8(0xc5),_0x4639ae),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5f49e8(0xca)]};}}[a38_0x31798f(0x8d)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();