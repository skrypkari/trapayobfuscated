'use strict';const a38_0x4ec7f2=a38_0x5ad8;function a38_0x5ad8(_0x362079,_0x31da5e){const _0x505fdb=a38_0x505f();return a38_0x5ad8=function(_0x5ad83b,_0x25be9f){_0x5ad83b=_0x5ad83b-0x134;let _0x5572b1=_0x505fdb[_0x5ad83b];return _0x5572b1;},a38_0x5ad8(_0x362079,_0x31da5e);}(function(_0x3b9277,_0x34a6f6){const _0x5d5984=a38_0x5ad8,_0x2263af=_0x3b9277();while(!![]){try{const _0x32db9c=-parseInt(_0x5d5984(0x19e))/0x1+-parseInt(_0x5d5984(0x17c))/0x2+-parseInt(_0x5d5984(0x139))/0x3*(-parseInt(_0x5d5984(0x14f))/0x4)+parseInt(_0x5d5984(0x13e))/0x5*(-parseInt(_0x5d5984(0x1a0))/0x6)+parseInt(_0x5d5984(0x170))/0x7+-parseInt(_0x5d5984(0x191))/0x8+parseInt(_0x5d5984(0x149))/0x9*(parseInt(_0x5d5984(0x14e))/0xa);if(_0x32db9c===_0x34a6f6)break;else _0x2263af['push'](_0x2263af['shift']());}catch(_0x5eac2a){_0x2263af['push'](_0x2263af['shift']());}}}(a38_0x505f,0x6db46));var __importDefault=this&&this[a38_0x4ec7f2(0x146)]||function(_0x32eb71){const _0x5517f1=a38_0x4ec7f2;return _0x32eb71&&_0x32eb71[_0x5517f1(0x171)]?_0x32eb71:{'default':_0x32eb71};};Object[a38_0x4ec7f2(0x13d)](exports,a38_0x4ec7f2(0x171),{'value':!![]}),exports[a38_0x4ec7f2(0x1ab)]=exports['CurrencyService']=void 0x0;function a38_0x505f(){const _0x3c135d=['updateCurrencyRates','yfi','Error\x20getting\x20all\x20rates:','defineProperty','5JVzkpz','keys','findMany','\x20USDT\x20=\x20','\x20currencies','dot','Periodic\x20currency\x20rates\x20update\x20failed:','%\x20markup\x20=\x20','__importDefault','tether','json','13431735PIUBCN','findFirst','link','twd','ils','10KguURP','8gZWUos','updateInterval','kwd','toFixed','default','statusText','xdr','../config/database','sar','?ids=tether&vs_currencies=','❌\x20Failed\x20to\x20update\x20currency\x20rates:','php','length','entries','mxn','Error\x20getting\x20rate\x20for\x20currency\x20','uah','asc','bnb','dkk','✅\x20Currency\x20rates\x20updated\x20successfully','vnd','updatedAt','currencyRate','thb','convertToUSDT','usdt','pln','ars','zar','cny','\x20USDT\x20(rate:\x20','sek','3615584soznsc','__esModule','try','idr','allSettled','xrp','error','xlm','Error\x20getting\x20rates\x20status:','CoinGecko\x20API\x20error:\x20','COINGECKO_URL','TesSoft\x20Payment\x20System/1.0','986888ERlChW','\x20USDT,\x20with\x20','nok','pkr','join','map','rub','💱\x20Applied\x20','bmd','ngn','No\x20rate\x20found\x20for\x20currency:\x20','\x20to\x20USDT:','💱\x20Converted\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','%\x20markup\x20to\x20','application/json','czk','CURRENCIES','\x20USDT','forEach','eth','5842048WdqKCk','log','Failed\x20to\x20update\x20rate\x20for\x20','inr','nzd','getMarkupPercentage','bhd','all','aed','gel','clp','xag','sats','46806qzysmi','Error\x20converting\x20','1769598vOFdXR','getRatesStatus','catch','gbp','chf','rate','startPeriodicUpdates','getCurrencyRate','upsert','count','convertMultipleToUSDT','currencyService','toUpperCase','brl','MARKUP_PERCENTAGE','toLowerCase','eur','bdt','8793qBZdcG'];a38_0x505f=function(){return _0x3c135d;};return a38_0x505f();}const database_1=__importDefault(require(a38_0x4ec7f2(0x156)));class CurrencyService{constructor(){const _0xd597de=a38_0x4ec7f2;this[_0xd597de(0x17a)]='https://api.coingecko.com/api/v3/simple/price',this[_0xd597de(0x18d)]=['btc',_0xd597de(0x190),'ltc','bch',_0xd597de(0x161),'eos',_0xd597de(0x175),_0xd597de(0x177),_0xd597de(0x14b),_0xd597de(0x143),_0xd597de(0x13b),'usd',_0xd597de(0x199),_0xd597de(0x16b),'aud',_0xd597de(0x138),_0xd597de(0x197),_0xd597de(0x184),_0xd597de(0x134),'cad',_0xd597de(0x1a4),_0xd597de(0x19b),_0xd597de(0x16d),_0xd597de(0x18c),_0xd597de(0x162),_0xd597de(0x137),_0xd597de(0x1a3),_0xd597de(0x19a),'hkd','huf',_0xd597de(0x173),_0xd597de(0x14d),_0xd597de(0x194),'jpy','krw',_0xd597de(0x151),'lkr','mmk',_0xd597de(0x15d),'myr',_0xd597de(0x185),_0xd597de(0x17e),_0xd597de(0x195),_0xd597de(0x15a),_0xd597de(0x17f),_0xd597de(0x16a),_0xd597de(0x182),_0xd597de(0x157),_0xd597de(0x16f),'sgd',_0xd597de(0x167),_0xd597de(0x172),_0xd597de(0x14c),_0xd597de(0x15f),'vef',_0xd597de(0x164),_0xd597de(0x16c),_0xd597de(0x155),_0xd597de(0x19c),'xau','bits',_0xd597de(0x19d)],this[_0xd597de(0x150)]=null,this[_0xd597de(0x135)]=0x3,this[_0xd597de(0x1a6)]();}[a38_0x4ec7f2(0x1a6)](){const _0x29bba6=a38_0x4ec7f2;this['updateCurrencyRates']()[_0x29bba6(0x1a2)](_0x10ef9e=>{const _0x5c8ee7=_0x29bba6;console[_0x5c8ee7(0x176)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x10ef9e);}),this[_0x29bba6(0x150)]=setInterval(async()=>{const _0x317de9=_0x29bba6;try{await this[_0x317de9(0x13a)]();}catch(_0x5281bb){console[_0x317de9(0x176)](_0x317de9(0x144),_0x5281bb);}},0x3c*0x3c*0x3e8),console[_0x29bba6(0x192)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x100973=a38_0x4ec7f2;this[_0x100973(0x150)]&&(clearInterval(this[_0x100973(0x150)]),this[_0x100973(0x150)]=null,console[_0x100973(0x192)](_0x100973(0x189)));}async['updateCurrencyRates'](){const _0x5c1634=a38_0x4ec7f2;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x5ecc52=this[_0x5c1634(0x18d)][_0x5c1634(0x180)](','),_0x482d62=this['COINGECKO_URL']+_0x5c1634(0x158)+_0x5ecc52,_0x2edbc0=await fetch(_0x482d62,{'headers':{'Accept':_0x5c1634(0x18b),'User-Agent':_0x5c1634(0x17b)}});if(!_0x2edbc0['ok'])throw new Error(_0x5c1634(0x179)+_0x2edbc0['status']+'\x20'+_0x2edbc0[_0x5c1634(0x154)]);const _0x15ac9a=await _0x2edbc0[_0x5c1634(0x148)]();if(!_0x15ac9a[_0x5c1634(0x147)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x4dec2c=_0x15ac9a['tether'];console[_0x5c1634(0x192)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x5c1634(0x13f)](_0x4dec2c)[_0x5c1634(0x15b)]+_0x5c1634(0x142));const _0x51ca14=Object[_0x5c1634(0x15c)](_0x4dec2c)[_0x5c1634(0x181)](async([_0xf80fa7,_0x24ef98])=>{const _0x3ebd8f=_0x5c1634;try{await database_1['default'][_0x3ebd8f(0x166)][_0x3ebd8f(0x1a8)]({'where':{'currency':_0xf80fa7[_0x3ebd8f(0x136)]()},'update':{'rate':_0x24ef98},'create':{'currency':_0xf80fa7[_0x3ebd8f(0x136)](),'rate':_0x24ef98}});}catch(_0x401c89){console[_0x3ebd8f(0x176)](_0x3ebd8f(0x193)+_0xf80fa7+':',_0x401c89);}});await Promise[_0x5c1634(0x174)](_0x51ca14),console['log'](_0x5c1634(0x163));}catch(_0x2cd52e){console[_0x5c1634(0x176)](_0x5c1634(0x159),_0x2cd52e);throw _0x2cd52e;}}async[a38_0x4ec7f2(0x1a7)](_0x3b7c39){const _0x9231ae=a38_0x4ec7f2,_0x2f08aa=_0x3b7c39['toLowerCase']();if(_0x2f08aa===_0x9231ae(0x169))return 0x1;try{const _0x409a85=await database_1['default'][_0x9231ae(0x166)]['findUnique']({'where':{'currency':_0x2f08aa}});if(!_0x409a85)return console['warn'](_0x9231ae(0x186)+_0x3b7c39+',\x20using\x201\x20as\x20fallback'),0x1;return _0x409a85[_0x9231ae(0x1a5)];}catch(_0x36a026){return console['error'](_0x9231ae(0x15e)+_0x3b7c39+':',_0x36a026),0x1;}}async[a38_0x4ec7f2(0x168)](_0x4dec19,_0x484477){const _0x56ad44=a38_0x4ec7f2,_0x3c7f43=_0x484477['toLowerCase']();if(_0x3c7f43===_0x56ad44(0x169)){const _0x5b1fa4=_0x4dec19*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x56ad44(0x192)](_0x56ad44(0x183)+this[_0x56ad44(0x135)]+_0x56ad44(0x18a)+_0x4dec19+_0x56ad44(0x141)+_0x5b1fa4[_0x56ad44(0x152)](0x6)+_0x56ad44(0x18e)),_0x5b1fa4;}try{const _0x19cfe9=await this[_0x56ad44(0x1a7)](_0x3c7f43),_0x5a2cbf=_0x4dec19/_0x19cfe9,_0x33ad88=_0x5a2cbf*(0x1+this[_0x56ad44(0x135)]/0x64);return console[_0x56ad44(0x192)](_0x56ad44(0x188)+_0x4dec19+'\x20'+_0x484477[_0x56ad44(0x1ac)]()+'\x20to\x20'+_0x5a2cbf[_0x56ad44(0x152)](0x6)+_0x56ad44(0x17d)+this[_0x56ad44(0x135)]+_0x56ad44(0x145)+_0x33ad88[_0x56ad44(0x152)](0x6)+_0x56ad44(0x16e)+_0x19cfe9+')'),_0x33ad88;}catch(_0x2e9611){console[_0x56ad44(0x176)](_0x56ad44(0x19f)+_0x4dec19+'\x20'+_0x484477+_0x56ad44(0x187),_0x2e9611);const _0x70acdb=_0x4dec19*(0x1+this[_0x56ad44(0x135)]/0x64);return _0x70acdb;}}async[a38_0x4ec7f2(0x1aa)](_0x3f8d52){let _0x4b68be=0x0;for(const {amount:_0x108a24,currency:_0x34ac66}of _0x3f8d52){const _0x3f75b0=await this['convertToUSDT'](_0x108a24,_0x34ac66);_0x4b68be+=_0x3f75b0;}return _0x4b68be;}async['getAllRates'](){const _0xcbaa1f=a38_0x4ec7f2;try{const _0x4d97a0=await database_1['default'][_0xcbaa1f(0x166)][_0xcbaa1f(0x140)]({'select':{'currency':!![],'rate':!![]}}),_0x2c2f38={'usdt':0x1};return _0x4d97a0[_0xcbaa1f(0x18f)](_0x3bd509=>{const _0x1d89f4=_0xcbaa1f;_0x2c2f38[_0x3bd509['currency']]=_0x3bd509[_0x1d89f4(0x1a5)];}),_0x2c2f38;}catch(_0x1ce877){return console[_0xcbaa1f(0x176)](_0xcbaa1f(0x13c),_0x1ce877),{'usdt':0x1};}}async[a38_0x4ec7f2(0x1a1)](){const _0x42d9c0=a38_0x4ec7f2;try{const [_0x218b71,_0x38776d,_0x17f682]=await Promise[_0x42d9c0(0x198)]([database_1[_0x42d9c0(0x153)][_0x42d9c0(0x166)][_0x42d9c0(0x1a9)](),database_1['default']['currencyRate'][_0x42d9c0(0x14a)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x42d9c0(0x153)]['currencyRate'][_0x42d9c0(0x14a)]({'orderBy':{'updatedAt':_0x42d9c0(0x160)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x218b71,'lastUpdated':_0x38776d?.[_0x42d9c0(0x165)]||null,'oldestRate':_0x17f682?.[_0x42d9c0(0x165)]||null,'markupPercentage':this[_0x42d9c0(0x135)]};}catch(_0x208489){return console['error'](_0x42d9c0(0x178),_0x208489),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x42d9c0(0x135)]};}}[a38_0x4ec7f2(0x196)](){const _0x214057=a38_0x4ec7f2;return this[_0x214057(0x135)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();