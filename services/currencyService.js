'use strict';const a38_0x46a951=a38_0x34e5;function a38_0x3b5e(){const _0x11b505=['cad','dkk','findFirst','uah','sats','catch','yfi','gbp','toUpperCase',',\x20using\x201\x20as\x20fallback','getMarkupPercentage','pkr','getRatesStatus','myr','15768NdeNCJ','startPeriodicUpdates','kwd','Periodic\x20currency\x20rates\x20update\x20failed:','mmk','390kCBIgK','xdr','php','error','join','\x20USDT,\x20with\x20','currencyService','vef','nzd','bdt','ils','sek','log','gel','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','getCurrencyRate','Error\x20getting\x20rates\x20status:','map','upsert','\x20USDT','📊\x20Received\x20rates\x20for\x20','sar','Error\x20getting\x20rate\x20for\x20currency\x20','zar','1304322lyplDQ','length','defineProperty','CURRENCIES','stopPeriodicUpdates','pln','Failed\x20to\x20update\x20rate\x20for\x20','__importDefault','convertToUSDT','aed','desc','No\x20rate\x20found\x20for\x20currency:\x20','czk','findUnique','bnb','count','link','%\x20markup\x20to\x20','bch','ltc','aud','application/json','__esModule','updateInterval','\x20to\x20USDT:','huf','eur','vnd','lkr','%\x20markup\x20=\x20','jpy','hkd','MARKUP_PERCENTAGE','toLowerCase','1107505NhTQde','twd','1017CfCxSC','../config/database','chf','xlm','Error\x20getting\x20all\x20rates:','dot','Error\x20converting\x20','17270kzNkLP','COINGECKO_URL','forEach','1fCFNQm','?ids=tether&vs_currencies=','rate','default','1681053goouzc','updatedAt','bhd','status','rub','getAllRates','sgd','1740864ENPSlr','\x20to\x20','TesSoft\x20Payment\x20System/1.0','statusText','currencyRate','\x20USDT\x20(rate:\x20','tether','updateCurrencyRates','mxn','nok','convertMultipleToUSDT','brl','xau','Initial\x20currency\x20rates\x20update\x20failed:','\x20currencies','usdt','inr','warn','asc','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','json','allSettled','toFixed','entries','xrp','eos','currency','all','idr','clp','3363710GZEaLo'];a38_0x3b5e=function(){return _0x11b505;};return a38_0x3b5e();}(function(_0x43102d,_0x3ddc94){const _0x561631=a38_0x34e5,_0x394a7b=_0x43102d();while(!![]){try{const _0x1017c7=parseInt(_0x561631(0x23f))/0x1*(-parseInt(_0x561631(0x211))/0x2)+parseInt(_0x561631(0x243))/0x3+parseInt(_0x561631(0x1c7))/0x4+-parseInt(_0x561631(0x23c))/0x5*(parseInt(_0x561631(0x1f9))/0x6)+parseInt(_0x561631(0x233))/0x7+-parseInt(_0x561631(0x1f4))/0x8*(parseInt(_0x561631(0x235))/0x9)+parseInt(_0x561631(0x1e5))/0xa;if(_0x1017c7===_0x3ddc94)break;else _0x394a7b['push'](_0x394a7b['shift']());}catch(_0x35a012){_0x394a7b['push'](_0x394a7b['shift']());}}}(a38_0x3b5e,0x5f667));var __importDefault=this&&this[a38_0x46a951(0x218)]||function(_0x2e7190){const _0x206670=a38_0x46a951;return _0x2e7190&&_0x2e7190[_0x206670(0x227)]?_0x2e7190:{'default':_0x2e7190};};Object[a38_0x46a951(0x213)](exports,a38_0x46a951(0x227),{'value':!![]}),exports[a38_0x46a951(0x1ff)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x46a951(0x236)));function a38_0x34e5(_0x38bdb0,_0x5ed7b2){const _0x3b5eab=a38_0x3b5e();return a38_0x34e5=function(_0x34e5f8,_0x1c479e){_0x34e5f8=_0x34e5f8-0x1c6;let _0x42a144=_0x3b5eab[_0x34e5f8];return _0x42a144;},a38_0x34e5(_0x38bdb0,_0x5ed7b2);}class CurrencyService{constructor(){const _0x3dd2b7=a38_0x46a951;this[_0x3dd2b7(0x23d)]='https://api.coingecko.com/api/v3/simple/price',this[_0x3dd2b7(0x214)]=['btc','eth',_0x3dd2b7(0x224),_0x3dd2b7(0x223),_0x3dd2b7(0x21f),_0x3dd2b7(0x1e0),_0x3dd2b7(0x1df),_0x3dd2b7(0x238),_0x3dd2b7(0x221),_0x3dd2b7(0x23a),_0x3dd2b7(0x1ec),'usd',_0x3dd2b7(0x21a),'ars',_0x3dd2b7(0x225),_0x3dd2b7(0x202),_0x3dd2b7(0x245),'bmd',_0x3dd2b7(0x1d2),_0x3dd2b7(0x1e6),_0x3dd2b7(0x237),_0x3dd2b7(0x1e4),'cny',_0x3dd2b7(0x21d),_0x3dd2b7(0x1e7),_0x3dd2b7(0x22b),_0x3dd2b7(0x1ed),_0x3dd2b7(0x206),_0x3dd2b7(0x230),_0x3dd2b7(0x22a),_0x3dd2b7(0x1e3),_0x3dd2b7(0x203),_0x3dd2b7(0x1d7),_0x3dd2b7(0x22f),'krw',_0x3dd2b7(0x1f6),_0x3dd2b7(0x22d),_0x3dd2b7(0x1f8),_0x3dd2b7(0x1cf),_0x3dd2b7(0x1f3),'ngn',_0x3dd2b7(0x1d0),_0x3dd2b7(0x201),_0x3dd2b7(0x1fb),_0x3dd2b7(0x1f1),_0x3dd2b7(0x216),_0x3dd2b7(0x247),_0x3dd2b7(0x20e),_0x3dd2b7(0x204),_0x3dd2b7(0x1c6),'thb','try',_0x3dd2b7(0x234),_0x3dd2b7(0x1e9),_0x3dd2b7(0x200),_0x3dd2b7(0x22c),_0x3dd2b7(0x210),_0x3dd2b7(0x1fa),'xag',_0x3dd2b7(0x1d3),'bits',_0x3dd2b7(0x1ea)],this[_0x3dd2b7(0x228)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x3dd2b7(0x1f5)]();}[a38_0x46a951(0x1f5)](){const _0x3bdc94=a38_0x46a951;this['updateCurrencyRates']()[_0x3bdc94(0x1eb)](_0x222a0c=>{const _0x242390=_0x3bdc94;console[_0x242390(0x1fc)](_0x242390(0x1d4),_0x222a0c);}),this[_0x3bdc94(0x228)]=setInterval(async()=>{const _0xff2243=_0x3bdc94;try{await this['updateCurrencyRates']();}catch(_0x1cc548){console[_0xff2243(0x1fc)](_0xff2243(0x1f7),_0x1cc548);}},0x3c*0x3c*0x3e8),console['log'](_0x3bdc94(0x1da));}[a38_0x46a951(0x215)](){const _0x866aaf=a38_0x46a951;this[_0x866aaf(0x228)]&&(clearInterval(this[_0x866aaf(0x228)]),this[_0x866aaf(0x228)]=null,console[_0x866aaf(0x205)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x46a951(0x1ce)](){const _0x148b18=a38_0x46a951;try{console[_0x148b18(0x205)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x50e25a=this[_0x148b18(0x214)][_0x148b18(0x1fd)](','),_0xaeb839=this['COINGECKO_URL']+_0x148b18(0x240)+_0x50e25a,_0x300f3c=await fetch(_0xaeb839,{'headers':{'Accept':_0x148b18(0x226),'User-Agent':_0x148b18(0x1c9)}});if(!_0x300f3c['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x300f3c[_0x148b18(0x246)]+'\x20'+_0x300f3c[_0x148b18(0x1ca)]);const _0x2a8ac1=await _0x300f3c[_0x148b18(0x1db)]();if(!_0x2a8ac1[_0x148b18(0x1cd)])throw new Error(_0x148b18(0x207));const _0x435efd=_0x2a8ac1[_0x148b18(0x1cd)];console['log'](_0x148b18(0x20d)+Object['keys'](_0x435efd)[_0x148b18(0x212)]+_0x148b18(0x1d5));const _0x3aa689=Object[_0x148b18(0x1de)](_0x435efd)[_0x148b18(0x20a)](async([_0xcc1afe,_0x2a8d8f])=>{const _0x2eaeab=_0x148b18;try{await database_1['default'][_0x2eaeab(0x1cb)][_0x2eaeab(0x20b)]({'where':{'currency':_0xcc1afe[_0x2eaeab(0x232)]()},'update':{'rate':_0x2a8d8f},'create':{'currency':_0xcc1afe[_0x2eaeab(0x232)](),'rate':_0x2a8d8f}});}catch(_0x20b7f7){console[_0x2eaeab(0x1fc)](_0x2eaeab(0x217)+_0xcc1afe+':',_0x20b7f7);}});await Promise[_0x148b18(0x1dc)](_0x3aa689),console[_0x148b18(0x205)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x33dcf2){console[_0x148b18(0x1fc)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x33dcf2);throw _0x33dcf2;}}async[a38_0x46a951(0x208)](_0x59d224){const _0x1dcc90=a38_0x46a951,_0x4a79f2=_0x59d224[_0x1dcc90(0x232)]();if(_0x4a79f2==='usdt')return 0x1;try{const _0x2d7a61=await database_1[_0x1dcc90(0x242)]['currencyRate'][_0x1dcc90(0x21e)]({'where':{'currency':_0x4a79f2}});if(!_0x2d7a61)return console[_0x1dcc90(0x1d8)](_0x1dcc90(0x21c)+_0x59d224+_0x1dcc90(0x1ef)),0x1;return _0x2d7a61[_0x1dcc90(0x241)];}catch(_0x2baf5c){return console['error'](_0x1dcc90(0x20f)+_0x59d224+':',_0x2baf5c),0x1;}}async[a38_0x46a951(0x219)](_0x57d48b,_0x1cc842){const _0x1bf9f3=a38_0x46a951,_0x57310f=_0x1cc842[_0x1bf9f3(0x232)]();if(_0x57310f===_0x1bf9f3(0x1d6)){const _0x5360ff=_0x57d48b*(0x1+this[_0x1bf9f3(0x231)]/0x64);return console[_0x1bf9f3(0x205)]('💱\x20Applied\x20'+this[_0x1bf9f3(0x231)]+_0x1bf9f3(0x222)+_0x57d48b+'\x20USDT\x20=\x20'+_0x5360ff[_0x1bf9f3(0x1dd)](0x6)+_0x1bf9f3(0x20c)),_0x5360ff;}try{const _0x59c62d=await this[_0x1bf9f3(0x208)](_0x57310f),_0x23f210=_0x57d48b/_0x59c62d,_0x172c85=_0x23f210*(0x1+this[_0x1bf9f3(0x231)]/0x64);return console['log']('💱\x20Converted\x20'+_0x57d48b+'\x20'+_0x1cc842[_0x1bf9f3(0x1ee)]()+_0x1bf9f3(0x1c8)+_0x23f210['toFixed'](0x6)+_0x1bf9f3(0x1fe)+this['MARKUP_PERCENTAGE']+_0x1bf9f3(0x22e)+_0x172c85[_0x1bf9f3(0x1dd)](0x6)+_0x1bf9f3(0x1cc)+_0x59c62d+')'),_0x172c85;}catch(_0x1e04a0){console[_0x1bf9f3(0x1fc)](_0x1bf9f3(0x23b)+_0x57d48b+'\x20'+_0x1cc842+_0x1bf9f3(0x229),_0x1e04a0);const _0x55b8b8=_0x57d48b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x55b8b8;}}async[a38_0x46a951(0x1d1)](_0x21ac1e){let _0x429c8d=0x0;for(const {amount:_0x5ecd84,currency:_0x400737}of _0x21ac1e){const _0xa33bd5=await this['convertToUSDT'](_0x5ecd84,_0x400737);_0x429c8d+=_0xa33bd5;}return _0x429c8d;}async[a38_0x46a951(0x248)](){const _0x40cdac=a38_0x46a951;try{const _0x26bf2d=await database_1[_0x40cdac(0x242)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x353dd8={'usdt':0x1};return _0x26bf2d[_0x40cdac(0x23e)](_0x50a9e2=>{const _0x4ab469=_0x40cdac;_0x353dd8[_0x50a9e2[_0x4ab469(0x1e1)]]=_0x50a9e2['rate'];}),_0x353dd8;}catch(_0x2a5cd1){return console[_0x40cdac(0x1fc)](_0x40cdac(0x239),_0x2a5cd1),{'usdt':0x1};}}async[a38_0x46a951(0x1f2)](){const _0x4d7309=a38_0x46a951;try{const [_0x33c79d,_0xe168e5,_0x2f115c]=await Promise[_0x4d7309(0x1e2)]([database_1[_0x4d7309(0x242)][_0x4d7309(0x1cb)][_0x4d7309(0x220)](),database_1[_0x4d7309(0x242)][_0x4d7309(0x1cb)][_0x4d7309(0x1e8)]({'orderBy':{'updatedAt':_0x4d7309(0x21b)},'select':{'updatedAt':!![]}}),database_1['default'][_0x4d7309(0x1cb)][_0x4d7309(0x1e8)]({'orderBy':{'updatedAt':_0x4d7309(0x1d9)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x33c79d,'lastUpdated':_0xe168e5?.[_0x4d7309(0x244)]||null,'oldestRate':_0x2f115c?.[_0x4d7309(0x244)]||null,'markupPercentage':this[_0x4d7309(0x231)]};}catch(_0x302fbd){return console[_0x4d7309(0x1fc)](_0x4d7309(0x209),_0x302fbd),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x46a951(0x1f0)](){const _0x4ad26b=a38_0x46a951;return this[_0x4ad26b(0x231)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x46a951(0x1ff)]=new CurrencyService();