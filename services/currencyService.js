'use strict';const a36_0x50180d=a36_0x3da7;function a36_0x3da7(_0x315c4d,_0x126c7b){const _0x5531b9=a36_0x5531();return a36_0x3da7=function(_0x3da793,_0x5bc450){_0x3da793=_0x3da793-0x16a;let _0x10ac4c=_0x5531b9[_0x3da793];return _0x10ac4c;},a36_0x3da7(_0x315c4d,_0x126c7b);}(function(_0x163259,_0x46ae44){const _0x2bb44f=a36_0x3da7,_0x333478=_0x163259();while(!![]){try{const _0x53b6b1=parseInt(_0x2bb44f(0x191))/0x1*(-parseInt(_0x2bb44f(0x1d3))/0x2)+parseInt(_0x2bb44f(0x17b))/0x3*(-parseInt(_0x2bb44f(0x1cf))/0x4)+-parseInt(_0x2bb44f(0x1bc))/0x5+-parseInt(_0x2bb44f(0x18d))/0x6+parseInt(_0x2bb44f(0x1c3))/0x7*(-parseInt(_0x2bb44f(0x16d))/0x8)+parseInt(_0x2bb44f(0x17f))/0x9*(-parseInt(_0x2bb44f(0x19f))/0xa)+parseInt(_0x2bb44f(0x18e))/0xb;if(_0x53b6b1===_0x46ae44)break;else _0x333478['push'](_0x333478['shift']());}catch(_0x5c54b3){_0x333478['push'](_0x333478['shift']());}}}(a36_0x5531,0xf06cc));function a36_0x5531(){const _0x521bab=['cad','\x20USDT\x20=\x20','catch','3999240skuvGf','ltc','\x20currencies','getRatesStatus','zar','status','\x20to\x20','15036lMIaAZ','mmk','currencyRate','length','sar','xau','convertToUSDT','rub','clp','updateCurrencyRates','asc','krw','4ppRAnx','xdr','sgd','rate','2QemCAy','eos','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','gbp','link','currency','âœ…\x20Currency\x20rates\x20updated\x20successfully','toLowerCase','forEach','twd','default','updateInterval','pln','bdt','No\x20rate\x20found\x20for\x20currency:\x20','mxn','TesSoft\x20Payment\x20System/1.0','CurrencyService','updatedAt','gel','toUpperCase','try','4864LANWlV','keys','currencyService','toFixed','uah','chf','sek','statusText','czk','brl','ðŸ’±\x20Converted\x20','idr','eur','entries','4702449MFXuwx','aed','%\x20markup\x20to\x20','ars','9lSejSk','sats','desc','bnb','php','Periodic\x20currency\x20rates\x20update\x20failed:','getAllRates','dkk','usd','findFirst',',\x20using\x201\x20as\x20fallback','nok','convertMultipleToUSDT','getCurrencyRate','4571946mSxDTw','92355516gcCeIv','json','log','1920811ItFyon','defineProperty','https://api.coingecko.com/api/v3/simple/price','bch','yfi','ngn','myr','tether','lkr','inr','\x20USDT,\x20with\x20','eth','error','warn','10550590eGUXih','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','vef','pkr','Error\x20converting\x20','ðŸ“Š\x20Received\x20rates\x20for\x20','startPeriodicUpdates','MARKUP_PERCENTAGE','?ids=tether&vs_currencies=','vnd','stopPeriodicUpdates','COINGECKO_URL','bits','ðŸ’±\x20Applied\x20','CURRENCIES','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','ils','__esModule','bhd','getMarkupPercentage','__importDefault','findMany','Error\x20getting\x20all\x20rates:','bmd','aud'];a36_0x5531=function(){return _0x521bab;};return a36_0x5531();}var __importDefault=this&&this[a36_0x50180d(0x1b4)]||function(_0x5d5c4f){return _0x5d5c4f&&_0x5d5c4f['__esModule']?_0x5d5c4f:{'default':_0x5d5c4f};};Object[a36_0x50180d(0x192)](exports,a36_0x50180d(0x1b1),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x435f91=a36_0x50180d;this[_0x435f91(0x1aa)]=_0x435f91(0x193),this[_0x435f91(0x1ad)]=['btc',_0x435f91(0x19c),_0x435f91(0x1bd),_0x435f91(0x194),_0x435f91(0x182),_0x435f91(0x1d4),'xrp','xlm',_0x435f91(0x1d7),'dot',_0x435f91(0x195),_0x435f91(0x187),_0x435f91(0x17c),_0x435f91(0x17e),_0x435f91(0x1b8),_0x435f91(0x1e0),_0x435f91(0x1b2),_0x435f91(0x1b7),_0x435f91(0x176),_0x435f91(0x1b9),_0x435f91(0x172),_0x435f91(0x1cb),'cny',_0x435f91(0x175),_0x435f91(0x186),_0x435f91(0x179),_0x435f91(0x1d6),_0x435f91(0x16a),'hkd','huf',_0x435f91(0x178),_0x435f91(0x1b0),_0x435f91(0x19a),'jpy',_0x435f91(0x1ce),'kwd',_0x435f91(0x199),_0x435f91(0x1c4),_0x435f91(0x1e2),_0x435f91(0x197),_0x435f91(0x196),_0x435f91(0x18a),'nzd',_0x435f91(0x183),_0x435f91(0x1a2),_0x435f91(0x1df),_0x435f91(0x1ca),_0x435f91(0x1c7),_0x435f91(0x173),_0x435f91(0x1d1),'thb',_0x435f91(0x16c),_0x435f91(0x1dc),_0x435f91(0x171),_0x435f91(0x1a1),_0x435f91(0x1a8),_0x435f91(0x1c0),_0x435f91(0x1d0),'xag',_0x435f91(0x1c8),_0x435f91(0x1ab),_0x435f91(0x180)],this[_0x435f91(0x1de)]=null,this[_0x435f91(0x1a6)]=0x3,this[_0x435f91(0x1a5)]();}[a36_0x50180d(0x1a5)](){const _0x3e28c4=a36_0x50180d;this[_0x3e28c4(0x1cc)]()[_0x3e28c4(0x1bb)](_0x4f5cf2=>{const _0x395530=_0x3e28c4;console[_0x395530(0x19d)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x4f5cf2);}),this[_0x3e28c4(0x1de)]=setInterval(async()=>{const _0x556911=_0x3e28c4;try{await this[_0x556911(0x1cc)]();}catch(_0x28f5a7){console[_0x556911(0x19d)](_0x556911(0x184),_0x28f5a7);}},0x3c*0x3c*0x3e8),console[_0x3e28c4(0x190)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a36_0x50180d(0x1a9)](){const _0x4a34a7=a36_0x50180d;this['updateInterval']&&(clearInterval(this[_0x4a34a7(0x1de)]),this[_0x4a34a7(0x1de)]=null,console[_0x4a34a7(0x190)](_0x4a34a7(0x1a0)));}async[a36_0x50180d(0x1cc)](){const _0x2febc9=a36_0x50180d;try{console[_0x2febc9(0x190)](_0x2febc9(0x1d5));const _0x473289=this[_0x2febc9(0x1ad)]['join'](','),_0x486b99=this['COINGECKO_URL']+_0x2febc9(0x1a7)+_0x473289,_0x1d00ac=await fetch(_0x486b99,{'headers':{'Accept':'application/json','User-Agent':_0x2febc9(0x1e3)}});if(!_0x1d00ac['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1d00ac[_0x2febc9(0x1c1)]+'\x20'+_0x1d00ac[_0x2febc9(0x174)]);const _0x15dd08=await _0x1d00ac[_0x2febc9(0x18f)]();if(!_0x15dd08[_0x2febc9(0x198)])throw new Error(_0x2febc9(0x1af));const _0x4c008f=_0x15dd08['tether'];console[_0x2febc9(0x190)](_0x2febc9(0x1a4)+Object[_0x2febc9(0x16e)](_0x4c008f)[_0x2febc9(0x1c6)]+_0x2febc9(0x1be));const _0x4b5f1c=Object[_0x2febc9(0x17a)](_0x4c008f)['map'](async([_0xcf744,_0x4a89d9])=>{const _0x358fe2=_0x2febc9;try{await database_1[_0x358fe2(0x1dd)][_0x358fe2(0x1c5)]['upsert']({'where':{'currency':_0xcf744[_0x358fe2(0x1da)]()},'update':{'rate':_0x4a89d9},'create':{'currency':_0xcf744[_0x358fe2(0x1da)](),'rate':_0x4a89d9}});}catch(_0x4b157e){console[_0x358fe2(0x19d)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0xcf744+':',_0x4b157e);}});await Promise['allSettled'](_0x4b5f1c),console[_0x2febc9(0x190)](_0x2febc9(0x1d9));}catch(_0x464891){console[_0x2febc9(0x19d)](_0x2febc9(0x1ae),_0x464891);throw _0x464891;}}async['getCurrencyRate'](_0x285c91){const _0xd0bb5d=a36_0x50180d,_0x1deaef=_0x285c91[_0xd0bb5d(0x1da)]();if(_0x1deaef==='usdt')return 0x1;try{const _0x51457a=await database_1[_0xd0bb5d(0x1dd)]['currencyRate']['findUnique']({'where':{'currency':_0x1deaef}});if(!_0x51457a)return console[_0xd0bb5d(0x19e)](_0xd0bb5d(0x1e1)+_0x285c91+_0xd0bb5d(0x189)),0x1;return _0x51457a[_0xd0bb5d(0x1d2)];}catch(_0x146ff8){return console[_0xd0bb5d(0x19d)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x285c91+':',_0x146ff8),0x1;}}async[a36_0x50180d(0x1c9)](_0x131223,_0xe0b38){const _0x5ed502=a36_0x50180d,_0x4d7568=_0xe0b38[_0x5ed502(0x1da)]();if(_0x4d7568==='usdt'){const _0x2fbd7a=_0x131223*(0x1+this[_0x5ed502(0x1a6)]/0x64);return console[_0x5ed502(0x190)](_0x5ed502(0x1ac)+this['MARKUP_PERCENTAGE']+_0x5ed502(0x17d)+_0x131223+_0x5ed502(0x1ba)+_0x2fbd7a['toFixed'](0x6)+'\x20USDT'),_0x2fbd7a;}try{const _0x2c6794=await this[_0x5ed502(0x18c)](_0x4d7568),_0x5168aa=_0x131223/_0x2c6794,_0x502d3c=_0x5168aa*(0x1+this[_0x5ed502(0x1a6)]/0x64);return console[_0x5ed502(0x190)](_0x5ed502(0x177)+_0x131223+'\x20'+_0xe0b38[_0x5ed502(0x16b)]()+_0x5ed502(0x1c2)+_0x5168aa[_0x5ed502(0x170)](0x6)+_0x5ed502(0x19b)+this[_0x5ed502(0x1a6)]+'%\x20markup\x20=\x20'+_0x502d3c[_0x5ed502(0x170)](0x6)+'\x20USDT\x20(rate:\x20'+_0x2c6794+')'),_0x502d3c;}catch(_0x5eabff){console[_0x5ed502(0x19d)](_0x5ed502(0x1a3)+_0x131223+'\x20'+_0xe0b38+'\x20to\x20USDT:',_0x5eabff);const _0x16ff43=_0x131223*(0x1+this[_0x5ed502(0x1a6)]/0x64);return _0x16ff43;}}async[a36_0x50180d(0x18b)](_0x4fa56e){const _0x9032c=a36_0x50180d;let _0x3d17f1=0x0;for(const {amount:_0xd7f835,currency:_0x43a84d}of _0x4fa56e){const _0x26b80a=await this[_0x9032c(0x1c9)](_0xd7f835,_0x43a84d);_0x3d17f1+=_0x26b80a;}return _0x3d17f1;}async[a36_0x50180d(0x185)](){const _0x2c7823=a36_0x50180d;try{const _0x322a25=await database_1['default']['currencyRate'][_0x2c7823(0x1b5)]({'select':{'currency':!![],'rate':!![]}}),_0x20e058={'usdt':0x1};return _0x322a25[_0x2c7823(0x1db)](_0x42a697=>{const _0x356403=_0x2c7823;_0x20e058[_0x42a697[_0x356403(0x1d8)]]=_0x42a697[_0x356403(0x1d2)];}),_0x20e058;}catch(_0x42ee9b){return console[_0x2c7823(0x19d)](_0x2c7823(0x1b6),_0x42ee9b),{'usdt':0x1};}}async[a36_0x50180d(0x1bf)](){const _0x141ce3=a36_0x50180d;try{const [_0x2db98e,_0x57fbcb,_0x55724a]=await Promise['all']([database_1[_0x141ce3(0x1dd)][_0x141ce3(0x1c5)]['count'](),database_1[_0x141ce3(0x1dd)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x141ce3(0x181)},'select':{'updatedAt':!![]}}),database_1[_0x141ce3(0x1dd)][_0x141ce3(0x1c5)][_0x141ce3(0x188)]({'orderBy':{'updatedAt':_0x141ce3(0x1cd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2db98e,'lastUpdated':_0x57fbcb?.[_0x141ce3(0x1e5)]||null,'oldestRate':_0x55724a?.[_0x141ce3(0x1e5)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x2e0119){return console[_0x141ce3(0x19d)]('Error\x20getting\x20rates\x20status:',_0x2e0119),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x141ce3(0x1a6)]};}}[a36_0x50180d(0x1b3)](){return this['MARKUP_PERCENTAGE'];}}exports[a36_0x50180d(0x1e4)]=CurrencyService,exports[a36_0x50180d(0x16f)]=new CurrencyService();