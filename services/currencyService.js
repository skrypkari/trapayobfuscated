'use strict';const a38_0x37de76=a38_0x319c;(function(_0x1ee1bb,_0x8d5de8){const _0x1cac4d=a38_0x319c,_0x1f8d09=_0x1ee1bb();while(!![]){try{const _0x4ca8ce=-parseInt(_0x1cac4d(0x9e))/0x1*(parseInt(_0x1cac4d(0xb4))/0x2)+parseInt(_0x1cac4d(0xb0))/0x3+parseInt(_0x1cac4d(0xf1))/0x4+-parseInt(_0x1cac4d(0xf6))/0x5+-parseInt(_0x1cac4d(0xf9))/0x6*(parseInt(_0x1cac4d(0xda))/0x7)+-parseInt(_0x1cac4d(0xac))/0x8*(parseInt(_0x1cac4d(0xa9))/0x9)+parseInt(_0x1cac4d(0xb6))/0xa;if(_0x4ca8ce===_0x8d5de8)break;else _0x1f8d09['push'](_0x1f8d09['shift']());}catch(_0x5d1db5){_0x1f8d09['push'](_0x1f8d09['shift']());}}}(a38_0x2ab4,0xc09ad));function a38_0x319c(_0x43b172,_0x2ed357){const _0x2ab46a=a38_0x2ab4();return a38_0x319c=function(_0x319c3c,_0x2e224a){_0x319c3c=_0x319c3c-0x89;let _0x3a8cd4=_0x2ab46a[_0x319c3c];return _0x3a8cd4;},a38_0x319c(_0x43b172,_0x2ed357);}var __importDefault=this&&this[a38_0x37de76(0x95)]||function(_0x55e878){return _0x55e878&&_0x55e878['__esModule']?_0x55e878:{'default':_0x55e878};};Object[a38_0x37de76(0xa2)](exports,'__esModule',{'value':!![]}),exports[a38_0x37de76(0xc1)]=exports[a38_0x37de76(0xbd)]=void 0x0;const database_1=__importDefault(require(a38_0x37de76(0xfc)));class CurrencyService{constructor(){const _0x16d964=a38_0x37de76;this[_0x16d964(0xd2)]='https://api.coingecko.com/api/v3/simple/price',this[_0x16d964(0xb2)]=[_0x16d964(0x93),_0x16d964(0xed),_0x16d964(0xf0),'bch',_0x16d964(0x8c),_0x16d964(0x98),_0x16d964(0xe9),_0x16d964(0xe0),_0x16d964(0xd7),_0x16d964(0xce),_0x16d964(0xd1),'usd',_0x16d964(0xc0),_0x16d964(0xc5),_0x16d964(0x96),_0x16d964(0xb1),_0x16d964(0xd4),_0x16d964(0x9d),_0x16d964(0xf8),'cad',_0x16d964(0xd0),_0x16d964(0xf7),_0x16d964(0x8b),'czk',_0x16d964(0xb7),'eur','gbp',_0x16d964(0xb3),_0x16d964(0xc2),'huf',_0x16d964(0xf3),_0x16d964(0xca),_0x16d964(0xdd),_0x16d964(0xcb),_0x16d964(0xa3),_0x16d964(0xde),_0x16d964(0xc9),_0x16d964(0xb8),_0x16d964(0xdc),'myr','ngn',_0x16d964(0x92),_0x16d964(0x9a),_0x16d964(0xaa),_0x16d964(0xcc),_0x16d964(0xb5),_0x16d964(0x9c),'sar','sek','sgd',_0x16d964(0xae),_0x16d964(0xea),_0x16d964(0xa5),_0x16d964(0xa8),_0x16d964(0xdb),'vnd','zar',_0x16d964(0xaf),_0x16d964(0xc4),_0x16d964(0xd5),_0x16d964(0xd3),_0x16d964(0x9f)],this['updateInterval']=null,this[_0x16d964(0xe2)]=0x3,this[_0x16d964(0xfd)]();}[a38_0x37de76(0xfd)](){const _0x417b23=a38_0x37de76;this['updateCurrencyRates']()['catch'](_0x108c81=>{const _0x576041=a38_0x319c;console['error'](_0x576041(0xad),_0x108c81);}),this[_0x417b23(0xdf)]=setInterval(async()=>{const _0x37b05b=_0x417b23;try{await this[_0x37b05b(0x94)]();}catch(_0x5daf73){console[_0x37b05b(0xa1)](_0x37b05b(0xa4),_0x5daf73);}},0x3c*0x3c*0x3e8),console[_0x417b23(0xcd)](_0x417b23(0xbe));}[a38_0x37de76(0x89)](){const _0x2e5fec=a38_0x37de76;this[_0x2e5fec(0xdf)]&&(clearInterval(this[_0x2e5fec(0xdf)]),this[_0x2e5fec(0xdf)]=null,console[_0x2e5fec(0xcd)](_0x2e5fec(0x8a)));}async[a38_0x37de76(0x94)](){const _0x2228da=a38_0x37de76;try{console[_0x2228da(0xcd)](_0x2228da(0xec));const _0x2d4499=this[_0x2228da(0xb2)][_0x2228da(0xfa)](','),_0xd165dd=this[_0x2228da(0xd2)]+_0x2228da(0xe1)+_0x2d4499,_0x4ebec6=await fetch(_0xd165dd,{'headers':{'Accept':_0x2228da(0xe8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x4ebec6['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x4ebec6[_0x2228da(0xe4)]+'\x20'+_0x4ebec6['statusText']);const _0x23be1b=await _0x4ebec6[_0x2228da(0xe5)]();if(!_0x23be1b[_0x2228da(0xf4)])throw new Error(_0x2228da(0x90));const _0x529068=_0x23be1b[_0x2228da(0xf4)];console[_0x2228da(0xcd)](_0x2228da(0x91)+Object[_0x2228da(0xfe)](_0x529068)[_0x2228da(0xe3)]+'\x20currencies');const _0x96c95d=Object[_0x2228da(0xa7)](_0x529068)[_0x2228da(0x9b)](async([_0x5d15cd,_0x426194])=>{const _0x859836=_0x2228da;try{await database_1[_0x859836(0xbf)]['currencyRate']['upsert']({'where':{'currency':_0x5d15cd[_0x859836(0xc8)]()},'update':{'rate':_0x426194},'create':{'currency':_0x5d15cd[_0x859836(0xc8)](),'rate':_0x426194}});}catch(_0x18d4d1){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x5d15cd+':',_0x18d4d1);}});await Promise['allSettled'](_0x96c95d),console[_0x2228da(0xcd)](_0x2228da(0x8f));}catch(_0x721317){console[_0x2228da(0xa1)](_0x2228da(0x99),_0x721317);throw _0x721317;}}async[a38_0x37de76(0xcf)](_0x9140bf){const _0x2d3997=a38_0x37de76,_0x44e0d0=_0x9140bf['toLowerCase']();if(_0x44e0d0===_0x2d3997(0xe6))return 0x1;try{const _0x2b3c1c=await database_1['default']['currencyRate'][_0x2d3997(0xd8)]({'where':{'currency':_0x44e0d0}});if(!_0x2b3c1c)return console[_0x2d3997(0xb9)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x9140bf+',\x20using\x201\x20as\x20fallback'),0x1;return _0x2b3c1c[_0x2d3997(0xf2)];}catch(_0xbae1b3){return console[_0x2d3997(0xa1)](_0x2d3997(0xa6)+_0x9140bf+':',_0xbae1b3),0x1;}}async[a38_0x37de76(0xc6)](_0x411d63,_0x1860cf){const _0x5bb2cd=a38_0x37de76,_0x334811=_0x1860cf['toLowerCase']();if(_0x334811===_0x5bb2cd(0xe6)){const _0x21b2a9=_0x411d63*(0x1+this[_0x5bb2cd(0xe2)]/0x64);return console[_0x5bb2cd(0xcd)](_0x5bb2cd(0xee)+this['MARKUP_PERCENTAGE']+_0x5bb2cd(0xfb)+_0x411d63+_0x5bb2cd(0xbb)+_0x21b2a9[_0x5bb2cd(0xef)](0x6)+_0x5bb2cd(0x97)),_0x21b2a9;}try{const _0x493d89=await this[_0x5bb2cd(0xcf)](_0x334811),_0x531dfc=_0x411d63/_0x493d89,_0xf6080b=_0x531dfc*(0x1+this[_0x5bb2cd(0xe2)]/0x64);return console[_0x5bb2cd(0xcd)](_0x5bb2cd(0x8e)+_0x411d63+'\x20'+_0x1860cf[_0x5bb2cd(0xa0)]()+'\x20to\x20'+_0x531dfc[_0x5bb2cd(0xef)](0x6)+_0x5bb2cd(0xd6)+this[_0x5bb2cd(0xe2)]+_0x5bb2cd(0xab)+_0xf6080b[_0x5bb2cd(0xef)](0x6)+'\x20USDT\x20(rate:\x20'+_0x493d89+')'),_0xf6080b;}catch(_0x9fca72){console[_0x5bb2cd(0xa1)](_0x5bb2cd(0xe7)+_0x411d63+'\x20'+_0x1860cf+'\x20to\x20USDT:',_0x9fca72);const _0x1a5f7c=_0x411d63*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x1a5f7c;}}async[a38_0x37de76(0xc3)](_0x2c4f29){let _0x509dd5=0x0;for(const {amount:_0x424d73,currency:_0x5f32e0}of _0x2c4f29){const _0x41065f=await this['convertToUSDT'](_0x424d73,_0x5f32e0);_0x509dd5+=_0x41065f;}return _0x509dd5;}async['getAllRates'](){const _0x15e352=a38_0x37de76;try{const _0x28e5ab=await database_1[_0x15e352(0xbf)][_0x15e352(0xc7)][_0x15e352(0xf5)]({'select':{'currency':!![],'rate':!![]}}),_0x3e058b={'usdt':0x1};return _0x28e5ab['forEach'](_0x5cd9b8=>{const _0x1096d4=_0x15e352;_0x3e058b[_0x5cd9b8['currency']]=_0x5cd9b8[_0x1096d4(0xf2)];}),_0x3e058b;}catch(_0x5088a4){return console[_0x15e352(0xa1)]('Error\x20getting\x20all\x20rates:',_0x5088a4),{'usdt':0x1};}}async['getRatesStatus'](){const _0x1f403b=a38_0x37de76;try{const [_0x127fc8,_0x1b1542,_0x56278f]=await Promise['all']([database_1[_0x1f403b(0xbf)][_0x1f403b(0xc7)][_0x1f403b(0xd9)](),database_1[_0x1f403b(0xbf)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x1f403b(0xbf)][_0x1f403b(0xc7)]['findFirst']({'orderBy':{'updatedAt':_0x1f403b(0xbc)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x127fc8,'lastUpdated':_0x1b1542?.[_0x1f403b(0x8d)]||null,'oldestRate':_0x56278f?.[_0x1f403b(0x8d)]||null,'markupPercentage':this[_0x1f403b(0xe2)]};}catch(_0x47f830){return console[_0x1f403b(0xa1)](_0x1f403b(0xba),_0x47f830),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1f403b(0xe2)]};}}[a38_0x37de76(0xeb)](){const _0x3ef6cb=a38_0x37de76;return this[_0x3ef6cb(0xe2)];}}function a38_0x2ab4(){const _0x39e115=['error','defineProperty','krw','Periodic\x20currency\x20rates\x20update\x20failed:','twd','Error\x20getting\x20rate\x20for\x20currency\x20','entries','uah','261xRlgIp','php','%\x20markup\x20=\x20','203152yMcvNy','Initial\x20currency\x20rates\x20update\x20failed:','thb','xdr','2723970kZdgKw','bdt','CURRENCIES','gel','1732aAFsBu','pln','26084410ekZjNC','dkk','mmk','warn','Error\x20getting\x20rates\x20status:','\x20USDT\x20=\x20','asc','CurrencyService','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','default','aed','currencyService','hkd','convertMultipleToUSDT','xag','ars','convertToUSDT','currencyRate','toLowerCase','lkr','ils','jpy','pkr','log','dot','getCurrencyRate','chf','yfi','COINGECKO_URL','bits','bhd','xau','\x20USDT,\x20with\x20','link','findUnique','count','1939stnkdU','vef','mxn','inr','kwd','updateInterval','xlm','?ids=tether&vs_currencies=','MARKUP_PERCENTAGE','length','status','json','usdt','Error\x20converting\x20','application/json','xrp','try','getMarkupPercentage','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','eth','üí±\x20Applied\x20','toFixed','ltc','2025480sDQNJG','rate','idr','tether','findMany','4616285EBYmpR','clp','brl','22806HZxUHr','join','%\x20markup\x20to\x20','../config/database','startPeriodicUpdates','keys','stopPeriodicUpdates','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','cny','bnb','updatedAt','üí±\x20Converted\x20','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','üìä\x20Received\x20rates\x20for\x20','nok','btc','updateCurrencyRates','__importDefault','aud','\x20USDT','eos','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','nzd','map','rub','bmd','602lpCCKP','sats','toUpperCase'];a38_0x2ab4=function(){return _0x39e115;};return a38_0x2ab4();}exports[a38_0x37de76(0xbd)]=CurrencyService,exports[a38_0x37de76(0xc1)]=new CurrencyService();