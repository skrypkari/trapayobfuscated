'use strict';const a38_0xe85303=a38_0x4cc4;(function(_0x4903cc,_0x2aae4c){const _0x1c80e7=a38_0x4cc4,_0xebcb6=_0x4903cc();while(!![]){try{const _0x318068=-parseInt(_0x1c80e7(0x1dd))/0x1*(parseInt(_0x1c80e7(0x19e))/0x2)+parseInt(_0x1c80e7(0x1a2))/0x3*(parseInt(_0x1c80e7(0x1a0))/0x4)+-parseInt(_0x1c80e7(0x1cd))/0x5+parseInt(_0x1c80e7(0x1bc))/0x6+parseInt(_0x1c80e7(0x18f))/0x7*(parseInt(_0x1c80e7(0x1d2))/0x8)+parseInt(_0x1c80e7(0x199))/0x9*(parseInt(_0x1c80e7(0x1cf))/0xa)+-parseInt(_0x1c80e7(0x192))/0xb*(parseInt(_0x1c80e7(0x1d8))/0xc);if(_0x318068===_0x2aae4c)break;else _0xebcb6['push'](_0xebcb6['shift']());}catch(_0x4d177d){_0xebcb6['push'](_0xebcb6['shift']());}}}(a38_0x505d,0xad40f));function a38_0x4cc4(_0x5074a9,_0x4fd503){const _0x505de1=a38_0x505d();return a38_0x4cc4=function(_0x4cc49f,_0x4fd050){_0x4cc49f=_0x4cc49f-0x17e;let _0x4ce2b3=_0x505de1[_0x4cc49f];return _0x4ce2b3;},a38_0x4cc4(_0x5074a9,_0x4fd503);}function a38_0x505d(){const _0x4f0d5f=['dot','\x20USDT,\x20with\x20','desc','getAllRates','3570710aNzHUv','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','30IqRlJA','vnd','No\x20rate\x20found\x20for\x20currency:\x20','146056ciaULL','Error\x20getting\x20rate\x20for\x20currency\x20','MARKUP_PERCENTAGE','thb','log','__importDefault','309996ykOuCv','CurrencyService','bch','jpy','rate','1514Wjthxc','application/json','stopPeriodicUpdates','zar','yfi','xau','CoinGecko\x20API\x20error:\x20','bmd','kwd','twd','try','allSettled','../config/database','https://api.coingecko.com/api/v3/simple/price','Error\x20converting\x20','updateCurrencyRates','💱\x20Applied\x20','CURRENCIES','ltc','forEach','cad','tether','__esModule','json','krw','Error\x20getting\x20rates\x20status:','aud','dkk','link','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','keys','sats','bdt','findUnique','TesSoft\x20Payment\x20System/1.0','eth','hkd','bits','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','inr','map','Failed\x20to\x20update\x20rate\x20for\x20','error','warn','371DRTXMN','defineProperty','nok','649NUzdFd','bhd','usd','Error\x20getting\x20all\x20rates:','clp','❌\x20Failed\x20to\x20update\x20currency\x20rates:','huf','3811239GKCFIO','startPeriodicUpdates','vef','sar','Initial\x20currency\x20rates\x20update\x20failed:','1264WjNcjm','\x20currencies','4jKDhfs','getRatesStatus','2889867BRMMHS','btc','updateInterval','catch','ils','xlm','updatedAt','default','gbp','✅\x20Currency\x20rates\x20updated\x20successfully','toFixed','xdr','uah','%\x20markup\x20to\x20','bnb','Periodic\x20currency\x20rates\x20update\x20failed:','getCurrencyRate','findFirst','pln','📊\x20Received\x20rates\x20for\x20','\x20USDT\x20(rate:\x20','usdt','myr','rub','\x20USDT\x20=\x20','ars','4220766hvfcZU','asc','pkr','currencyRate','nzd','toLowerCase','\x20to\x20USDT:','eos','COINGECKO_URL','%\x20markup\x20=\x20','gel','sgd','💱\x20Converted\x20'];a38_0x505d=function(){return _0x4f0d5f;};return a38_0x505d();}var __importDefault=this&&this[a38_0xe85303(0x1d7)]||function(_0x2dec6d){const _0x26d6b9=a38_0xe85303;return _0x2dec6d&&_0x2dec6d[_0x26d6b9(0x1f3)]?_0x2dec6d:{'default':_0x2dec6d};};Object[a38_0xe85303(0x190)](exports,a38_0xe85303(0x1f3),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0xe85303(0x1e9)));class CurrencyService{constructor(){const _0x4e5bc4=a38_0xe85303;this[_0x4e5bc4(0x1c4)]=_0x4e5bc4(0x1ea),this[_0x4e5bc4(0x1ee)]=[_0x4e5bc4(0x1a3),_0x4e5bc4(0x186),_0x4e5bc4(0x1ef),_0x4e5bc4(0x1da),_0x4e5bc4(0x1b0),_0x4e5bc4(0x1c3),'xrp',_0x4e5bc4(0x1a7),_0x4e5bc4(0x17f),_0x4e5bc4(0x1c9),_0x4e5bc4(0x1e1),_0x4e5bc4(0x194),'aed',_0x4e5bc4(0x1bb),_0x4e5bc4(0x1f7),_0x4e5bc4(0x183),_0x4e5bc4(0x193),_0x4e5bc4(0x1e4),'brl',_0x4e5bc4(0x1f1),'chf',_0x4e5bc4(0x196),'cny','czk',_0x4e5bc4(0x17e),'eur',_0x4e5bc4(0x1aa),_0x4e5bc4(0x1c6),_0x4e5bc4(0x187),_0x4e5bc4(0x198),'idr',_0x4e5bc4(0x1a6),_0x4e5bc4(0x18a),_0x4e5bc4(0x1db),_0x4e5bc4(0x1f5),_0x4e5bc4(0x1e5),'lkr','mmk','mxn',_0x4e5bc4(0x1b8),'ngn',_0x4e5bc4(0x191),_0x4e5bc4(0x1c0),'php',_0x4e5bc4(0x1be),_0x4e5bc4(0x1b4),_0x4e5bc4(0x1b9),_0x4e5bc4(0x19c),'sek',_0x4e5bc4(0x1c7),_0x4e5bc4(0x1d5),_0x4e5bc4(0x1e7),_0x4e5bc4(0x1e6),_0x4e5bc4(0x1ae),_0x4e5bc4(0x19b),_0x4e5bc4(0x1d0),_0x4e5bc4(0x1e0),_0x4e5bc4(0x1ad),'xag',_0x4e5bc4(0x1e2),_0x4e5bc4(0x188),_0x4e5bc4(0x182)],this[_0x4e5bc4(0x1a4)]=null,this[_0x4e5bc4(0x1d4)]=0x3,this[_0x4e5bc4(0x19a)]();}['startPeriodicUpdates'](){const _0x35d73c=a38_0xe85303;this[_0x35d73c(0x1ec)]()[_0x35d73c(0x1a5)](_0x595de6=>{const _0x5b9209=_0x35d73c;console[_0x5b9209(0x18d)](_0x5b9209(0x19d),_0x595de6);}),this[_0x35d73c(0x1a4)]=setInterval(async()=>{const _0x443d25=_0x35d73c;try{await this[_0x443d25(0x1ec)]();}catch(_0x526a2e){console[_0x443d25(0x18d)](_0x443d25(0x1b1),_0x526a2e);}},0x3c*0x3c*0x3e8),console[_0x35d73c(0x1d6)](_0x35d73c(0x180));}[a38_0xe85303(0x1df)](){const _0x4cd911=a38_0xe85303;this[_0x4cd911(0x1a4)]&&(clearInterval(this[_0x4cd911(0x1a4)]),this[_0x4cd911(0x1a4)]=null,console[_0x4cd911(0x1d6)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0xe85303(0x1ec)](){const _0x46ff5d=a38_0xe85303;try{console['log'](_0x46ff5d(0x1ce));const _0x1472df=this[_0x46ff5d(0x1ee)]['join'](','),_0x580191=this[_0x46ff5d(0x1c4)]+'?ids=tether&vs_currencies='+_0x1472df,_0x355965=await fetch(_0x580191,{'headers':{'Accept':_0x46ff5d(0x1de),'User-Agent':_0x46ff5d(0x185)}});if(!_0x355965['ok'])throw new Error(_0x46ff5d(0x1e3)+_0x355965['status']+'\x20'+_0x355965['statusText']);const _0x3e1c15=await _0x355965[_0x46ff5d(0x1f4)]();if(!_0x3e1c15['tether'])throw new Error(_0x46ff5d(0x189));const _0x6a4bb8=_0x3e1c15[_0x46ff5d(0x1f2)];console[_0x46ff5d(0x1d6)](_0x46ff5d(0x1b5)+Object[_0x46ff5d(0x181)](_0x6a4bb8)['length']+_0x46ff5d(0x19f));const _0x39f58f=Object['entries'](_0x6a4bb8)[_0x46ff5d(0x18b)](async([_0x527947,_0xd4c650])=>{const _0x364766=_0x46ff5d;try{await database_1[_0x364766(0x1a9)][_0x364766(0x1bf)]['upsert']({'where':{'currency':_0x527947['toLowerCase']()},'update':{'rate':_0xd4c650},'create':{'currency':_0x527947[_0x364766(0x1c1)](),'rate':_0xd4c650}});}catch(_0x1f1462){console[_0x364766(0x18d)](_0x364766(0x18c)+_0x527947+':',_0x1f1462);}});await Promise[_0x46ff5d(0x1e8)](_0x39f58f),console['log'](_0x46ff5d(0x1ab));}catch(_0x35d1b3){console[_0x46ff5d(0x18d)](_0x46ff5d(0x197),_0x35d1b3);throw _0x35d1b3;}}async[a38_0xe85303(0x1b2)](_0x5534ff){const _0x24783f=a38_0xe85303,_0xa9d0d7=_0x5534ff[_0x24783f(0x1c1)]();if(_0xa9d0d7===_0x24783f(0x1b7))return 0x1;try{const _0x100f34=await database_1[_0x24783f(0x1a9)][_0x24783f(0x1bf)][_0x24783f(0x184)]({'where':{'currency':_0xa9d0d7}});if(!_0x100f34)return console[_0x24783f(0x18e)](_0x24783f(0x1d1)+_0x5534ff+',\x20using\x201\x20as\x20fallback'),0x1;return _0x100f34[_0x24783f(0x1dc)];}catch(_0x164226){return console[_0x24783f(0x18d)](_0x24783f(0x1d3)+_0x5534ff+':',_0x164226),0x1;}}async['convertToUSDT'](_0x543d37,_0xe38e35){const _0x2dab05=a38_0xe85303,_0x458d68=_0xe38e35[_0x2dab05(0x1c1)]();if(_0x458d68===_0x2dab05(0x1b7)){const _0x201de2=_0x543d37*(0x1+this[_0x2dab05(0x1d4)]/0x64);return console[_0x2dab05(0x1d6)](_0x2dab05(0x1ed)+this[_0x2dab05(0x1d4)]+_0x2dab05(0x1af)+_0x543d37+_0x2dab05(0x1ba)+_0x201de2[_0x2dab05(0x1ac)](0x6)+'\x20USDT'),_0x201de2;}try{const _0x9cba33=await this[_0x2dab05(0x1b2)](_0x458d68),_0x7e341b=_0x543d37/_0x9cba33,_0x1ff837=_0x7e341b*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x2dab05(0x1d6)](_0x2dab05(0x1c8)+_0x543d37+'\x20'+_0xe38e35['toUpperCase']()+'\x20to\x20'+_0x7e341b['toFixed'](0x6)+_0x2dab05(0x1ca)+this[_0x2dab05(0x1d4)]+_0x2dab05(0x1c5)+_0x1ff837[_0x2dab05(0x1ac)](0x6)+_0x2dab05(0x1b6)+_0x9cba33+')'),_0x1ff837;}catch(_0xbfc4c6){console[_0x2dab05(0x18d)](_0x2dab05(0x1eb)+_0x543d37+'\x20'+_0xe38e35+_0x2dab05(0x1c2),_0xbfc4c6);const _0x215342=_0x543d37*(0x1+this[_0x2dab05(0x1d4)]/0x64);return _0x215342;}}async['convertMultipleToUSDT'](_0xc7c978){let _0x35a927=0x0;for(const {amount:_0x438822,currency:_0x1e7bd1}of _0xc7c978){const _0x2289b0=await this['convertToUSDT'](_0x438822,_0x1e7bd1);_0x35a927+=_0x2289b0;}return _0x35a927;}async[a38_0xe85303(0x1cc)](){const _0x4e428c=a38_0xe85303;try{const _0x10c3ff=await database_1['default']['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x29dfb9={'usdt':0x1};return _0x10c3ff[_0x4e428c(0x1f0)](_0x8e846f=>{const _0x109dfe=_0x4e428c;_0x29dfb9[_0x8e846f['currency']]=_0x8e846f[_0x109dfe(0x1dc)];}),_0x29dfb9;}catch(_0x27d9a6){return console[_0x4e428c(0x18d)](_0x4e428c(0x195),_0x27d9a6),{'usdt':0x1};}}async[a38_0xe85303(0x1a1)](){const _0x11a427=a38_0xe85303;try{const [_0x254e98,_0xf34b36,_0x217743]=await Promise['all']([database_1[_0x11a427(0x1a9)][_0x11a427(0x1bf)]['count'](),database_1['default']['currencyRate'][_0x11a427(0x1b3)]({'orderBy':{'updatedAt':_0x11a427(0x1cb)},'select':{'updatedAt':!![]}}),database_1[_0x11a427(0x1a9)]['currencyRate'][_0x11a427(0x1b3)]({'orderBy':{'updatedAt':_0x11a427(0x1bd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x254e98,'lastUpdated':_0xf34b36?.[_0x11a427(0x1a8)]||null,'oldestRate':_0x217743?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x1d8524){return console[_0x11a427(0x18d)](_0x11a427(0x1f6),_0x1d8524),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x11a427(0x1d4)]};}}['getMarkupPercentage'](){const _0x537bde=a38_0xe85303;return this[_0x537bde(0x1d4)];}}exports[a38_0xe85303(0x1d9)]=CurrencyService,exports['currencyService']=new CurrencyService();