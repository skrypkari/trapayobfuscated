'use strict';const a41_0x5176c6=a41_0xa91f;function a41_0xe8fa(){const _0x4835fb=['entries','\x20currencies','eur','currencyService','gel','Error\x20getting\x20rate\x20for\x20currency\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','clp','huf','dkk','\x20to\x20USDT:','mmk',',\x20using\x201\x20as\x20fallback','pln','upsert','📊\x20Received\x20rates\x20for\x20','73779mybZHx','8nqtwoy','bnb','bch','warn','kwd','twd','getCurrencyRate','error','currency','vnd','findFirst','stopPeriodicUpdates','rate','inr','COINGECKO_URL','asc','allSettled','xag','bits','954065vlFjbW','rub','sar','559455EJqlGt','link','sek','sgd','usd','chf','%\x20markup\x20=\x20','?ids=tether&vs_currencies=','tether','No\x20rate\x20found\x20for\x20currency:\x20','keys','\x20USDT','bdt','idr','desc','%\x20markup\x20to\x20','php','jpy','getAllRates','uah','btc','147817CAzlsF','currencyRate','MARKUP_PERCENTAGE','lkr','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','defineProperty','startPeriodicUpdates','vef','💱\x20Converted\x20','convertToUSDT','https://api.coingecko.com/api/v3/simple/price','\x20to\x20','Initial\x20currency\x20rates\x20update\x20failed:','Error\x20getting\x20all\x20rates:','pkr','xlm','cad','eth','Error\x20converting\x20','../config/database','ars','map','zar','dot','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','gbp','aed','json','updatedAt','yfi','updateInterval','121126aUeajO','TesSoft\x20Payment\x20System/1.0','eos','getRatesStatus','getMarkupPercentage','sats','thb','application/json','1741240dWJLWs','✅\x20Currency\x20rates\x20updated\x20successfully','cny','ngn','usdt','\x20USDT\x20(rate:\x20','xdr','💱\x20Applied\x20','CURRENCIES','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','1367490GDmtlC','__importDefault','CurrencyService','Failed\x20to\x20update\x20rate\x20for\x20','default','toFixed','bmd','log','toLowerCase','czk','brl','updateCurrencyRates','try','ltc','all'];a41_0xe8fa=function(){return _0x4835fb;};return a41_0xe8fa();}(function(_0x154001,_0x17ad72){const _0x4a09f1=a41_0xa91f,_0xf32f32=_0x154001();while(!![]){try{const _0x2c64bd=-parseInt(_0x4a09f1(0x1ea))/0x1+parseInt(_0x4a09f1(0x209))/0x2+-parseInt(_0x4a09f1(0x23a))/0x3*(parseInt(_0x4a09f1(0x23b))/0x4)+parseInt(_0x4a09f1(0x251))/0x5+parseInt(_0x4a09f1(0x21b))/0x6+parseInt(_0x4a09f1(0x24e))/0x7+-parseInt(_0x4a09f1(0x211))/0x8;if(_0x2c64bd===_0x17ad72)break;else _0xf32f32['push'](_0xf32f32['shift']());}catch(_0x745277){_0xf32f32['push'](_0xf32f32['shift']());}}}(a41_0xe8fa,0x1dc96));function a41_0xa91f(_0x2726af,_0x43b833){const _0xe8fa5f=a41_0xe8fa();return a41_0xa91f=function(_0xa91ffd,_0x395902){_0xa91ffd=_0xa91ffd-0x1d6;let _0x43a080=_0xe8fa5f[_0xa91ffd];return _0x43a080;},a41_0xa91f(_0x2726af,_0x43b833);}var __importDefault=this&&this[a41_0x5176c6(0x21c)]||function(_0x45ed81){return _0x45ed81&&_0x45ed81['__esModule']?_0x45ed81:{'default':_0x45ed81};};Object[a41_0x5176c6(0x1ef)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a41_0x5176c6(0x21d)]=void 0x0;const database_1=__importDefault(require(a41_0x5176c6(0x1fd)));class CurrencyService{constructor(){const _0x68260a=a41_0x5176c6;this[_0x68260a(0x249)]=_0x68260a(0x1f4),this[_0x68260a(0x219)]=[_0x68260a(0x1e9),_0x68260a(0x1fb),_0x68260a(0x228),_0x68260a(0x23d),_0x68260a(0x23c),_0x68260a(0x20b),'xrp',_0x68260a(0x1f9),_0x68260a(0x1d6),_0x68260a(0x201),_0x68260a(0x207),_0x68260a(0x1d9),_0x68260a(0x204),_0x68260a(0x1fe),'aud',_0x68260a(0x1e1),'bhd',_0x68260a(0x221),_0x68260a(0x225),_0x68260a(0x1fa),_0x68260a(0x1da),_0x68260a(0x231),_0x68260a(0x213),_0x68260a(0x224),_0x68260a(0x233),_0x68260a(0x22c),_0x68260a(0x203),_0x68260a(0x22e),'hkd',_0x68260a(0x232),_0x68260a(0x1e2),'ils',_0x68260a(0x248),_0x68260a(0x1e6),'krw',_0x68260a(0x23f),_0x68260a(0x1ed),_0x68260a(0x235),'mxn','myr',_0x68260a(0x214),'nok','nzd',_0x68260a(0x1e5),_0x68260a(0x1f8),_0x68260a(0x237),_0x68260a(0x24f),_0x68260a(0x250),_0x68260a(0x1d7),_0x68260a(0x1d8),_0x68260a(0x20f),_0x68260a(0x227),_0x68260a(0x240),_0x68260a(0x1e8),_0x68260a(0x1f1),_0x68260a(0x244),_0x68260a(0x200),_0x68260a(0x217),_0x68260a(0x24c),'xau',_0x68260a(0x24d),_0x68260a(0x20e)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x68260a(0x1f0)]();}[a41_0x5176c6(0x1f0)](){const _0x5336b2=a41_0x5176c6;this[_0x5336b2(0x226)]()['catch'](_0x2f7f29=>{const _0x24f6b3=_0x5336b2;console[_0x24f6b3(0x242)](_0x24f6b3(0x1f6),_0x2f7f29);}),this[_0x5336b2(0x208)]=setInterval(async()=>{const _0x5f3b2d=_0x5336b2;try{await this[_0x5f3b2d(0x226)]();}catch(_0x2bda67){console[_0x5f3b2d(0x242)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x2bda67);}},0x3c*0x3c*0x3e8),console[_0x5336b2(0x222)](_0x5336b2(0x230));}[a41_0x5176c6(0x246)](){const _0x20a558=a41_0x5176c6;this[_0x20a558(0x208)]&&(clearInterval(this[_0x20a558(0x208)]),this['updateInterval']=null,console['log'](_0x20a558(0x1ee)));}async[a41_0x5176c6(0x226)](){const _0x8ba74d=a41_0x5176c6;try{console[_0x8ba74d(0x222)](_0x8ba74d(0x202));const _0xe5f6cf=this[_0x8ba74d(0x219)]['join'](','),_0xdfadf0=this[_0x8ba74d(0x249)]+_0x8ba74d(0x1dc)+_0xe5f6cf,_0x18b3d0=await fetch(_0xdfadf0,{'headers':{'Accept':_0x8ba74d(0x210),'User-Agent':_0x8ba74d(0x20a)}});if(!_0x18b3d0['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x18b3d0['status']+'\x20'+_0x18b3d0['statusText']);const _0x39105e=await _0x18b3d0[_0x8ba74d(0x205)]();if(!_0x39105e['tether'])throw new Error(_0x8ba74d(0x21a));const _0x23af4a=_0x39105e[_0x8ba74d(0x1dd)];console[_0x8ba74d(0x222)](_0x8ba74d(0x239)+Object[_0x8ba74d(0x1df)](_0x23af4a)['length']+_0x8ba74d(0x22b));const _0x289eb2=Object[_0x8ba74d(0x22a)](_0x23af4a)[_0x8ba74d(0x1ff)](async([_0x602e9b,_0x2db0a9])=>{const _0x15cba8=_0x8ba74d;try{await database_1['default']['currencyRate'][_0x15cba8(0x238)]({'where':{'currency':_0x602e9b[_0x15cba8(0x223)]()},'update':{'rate':_0x2db0a9},'create':{'currency':_0x602e9b[_0x15cba8(0x223)](),'rate':_0x2db0a9}});}catch(_0x5b55d0){console[_0x15cba8(0x242)](_0x15cba8(0x21e)+_0x602e9b+':',_0x5b55d0);}});await Promise[_0x8ba74d(0x24b)](_0x289eb2),console[_0x8ba74d(0x222)](_0x8ba74d(0x212));}catch(_0x1bf110){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x1bf110);throw _0x1bf110;}}async[a41_0x5176c6(0x241)](_0xedf2fb){const _0x3230bd=a41_0x5176c6,_0x2ee00c=_0xedf2fb['toLowerCase']();if(_0x2ee00c===_0x3230bd(0x215))return 0x1;try{const _0x18528c=await database_1[_0x3230bd(0x21f)][_0x3230bd(0x1eb)]['findUnique']({'where':{'currency':_0x2ee00c}});if(!_0x18528c)return console[_0x3230bd(0x23e)](_0x3230bd(0x1de)+_0xedf2fb+_0x3230bd(0x236)),0x1;return _0x18528c[_0x3230bd(0x247)];}catch(_0x5c4ac2){return console[_0x3230bd(0x242)](_0x3230bd(0x22f)+_0xedf2fb+':',_0x5c4ac2),0x1;}}async[a41_0x5176c6(0x1f3)](_0x198a7d,_0x371462){const _0x11fa00=a41_0x5176c6,_0x344ac8=_0x371462['toLowerCase']();if(_0x344ac8==='usdt'){const _0x51968c=_0x198a7d*(0x1+this[_0x11fa00(0x1ec)]/0x64);return console[_0x11fa00(0x222)](_0x11fa00(0x218)+this['MARKUP_PERCENTAGE']+_0x11fa00(0x1e4)+_0x198a7d+'\x20USDT\x20=\x20'+_0x51968c[_0x11fa00(0x220)](0x6)+_0x11fa00(0x1e0)),_0x51968c;}try{const _0xdf4343=await this[_0x11fa00(0x241)](_0x344ac8),_0xf32900=_0x198a7d/_0xdf4343,_0x54d71d=_0xf32900*(0x1+this[_0x11fa00(0x1ec)]/0x64);return console['log'](_0x11fa00(0x1f2)+_0x198a7d+'\x20'+_0x371462['toUpperCase']()+_0x11fa00(0x1f5)+_0xf32900['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x11fa00(0x1ec)]+_0x11fa00(0x1db)+_0x54d71d[_0x11fa00(0x220)](0x6)+_0x11fa00(0x216)+_0xdf4343+')'),_0x54d71d;}catch(_0x3babc5){console['error'](_0x11fa00(0x1fc)+_0x198a7d+'\x20'+_0x371462+_0x11fa00(0x234),_0x3babc5);const _0x2c51c2=_0x198a7d*(0x1+this[_0x11fa00(0x1ec)]/0x64);return _0x2c51c2;}}async['convertMultipleToUSDT'](_0x3f5663){let _0x5c191d=0x0;for(const {amount:_0x3bc29a,currency:_0x1b5311}of _0x3f5663){const _0x144d04=await this['convertToUSDT'](_0x3bc29a,_0x1b5311);_0x5c191d+=_0x144d04;}return _0x5c191d;}async[a41_0x5176c6(0x1e7)](){const _0x3905d2=a41_0x5176c6;try{const _0xe6305e=await database_1[_0x3905d2(0x21f)][_0x3905d2(0x1eb)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0xd42f54={'usdt':0x1};return _0xe6305e['forEach'](_0x207a69=>{const _0x3b4719=_0x3905d2;_0xd42f54[_0x207a69[_0x3b4719(0x243)]]=_0x207a69['rate'];}),_0xd42f54;}catch(_0x10261a){return console[_0x3905d2(0x242)](_0x3905d2(0x1f7),_0x10261a),{'usdt':0x1};}}async[a41_0x5176c6(0x20c)](){const _0x537e50=a41_0x5176c6;try{const [_0x154737,_0x4ea6fd,_0x1a8871]=await Promise[_0x537e50(0x229)]([database_1['default']['currencyRate']['count'](),database_1[_0x537e50(0x21f)][_0x537e50(0x1eb)]['findFirst']({'orderBy':{'updatedAt':_0x537e50(0x1e3)},'select':{'updatedAt':!![]}}),database_1[_0x537e50(0x21f)][_0x537e50(0x1eb)][_0x537e50(0x245)]({'orderBy':{'updatedAt':_0x537e50(0x24a)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x154737,'lastUpdated':_0x4ea6fd?.[_0x537e50(0x206)]||null,'oldestRate':_0x1a8871?.[_0x537e50(0x206)]||null,'markupPercentage':this[_0x537e50(0x1ec)]};}catch(_0xcfa3ca){return console['error']('Error\x20getting\x20rates\x20status:',_0xcfa3ca),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x537e50(0x1ec)]};}}[a41_0x5176c6(0x20d)](){const _0x50049d=a41_0x5176c6;return this[_0x50049d(0x1ec)];}}exports[a41_0x5176c6(0x21d)]=CurrencyService,exports[a41_0x5176c6(0x22d)]=new CurrencyService();