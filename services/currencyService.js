'use strict';const a51_0xeec5ae=a51_0x56a2;(function(_0x5218e4,_0x4f20e2){const _0xc1f1c2=a51_0x56a2,_0xcf48d2=_0x5218e4();while(!![]){try{const _0x4dcd60=-parseInt(_0xc1f1c2(0x12b))/0x1*(parseInt(_0xc1f1c2(0x174))/0x2)+-parseInt(_0xc1f1c2(0x136))/0x3+-parseInt(_0xc1f1c2(0x138))/0x4*(-parseInt(_0xc1f1c2(0x146))/0x5)+-parseInt(_0xc1f1c2(0x178))/0x6+parseInt(_0xc1f1c2(0x11c))/0x7*(-parseInt(_0xc1f1c2(0x183))/0x8)+parseInt(_0xc1f1c2(0x153))/0x9+parseInt(_0xc1f1c2(0x163))/0xa;if(_0x4dcd60===_0x4f20e2)break;else _0xcf48d2['push'](_0xcf48d2['shift']());}catch(_0x3d9dd0){_0xcf48d2['push'](_0xcf48d2['shift']());}}}(a51_0x4f35,0x9888e));var __importDefault=this&&this[a51_0xeec5ae(0x14f)]||function(_0x392394){const _0x286a4b=a51_0xeec5ae;return _0x392394&&_0x392394[_0x286a4b(0x18d)]?_0x392394:{'default':_0x392394};};Object['defineProperty'](exports,a51_0xeec5ae(0x18d),{'value':!![]}),exports[a51_0xeec5ae(0x17e)]=exports[a51_0xeec5ae(0x154)]=void 0x0;function a51_0x4f35(){const _0x761956=['dkk','\x20currencies','getRatesStatus','eur','upsert','warn','MARKUP_PERCENTAGE','krw','updateInterval','13734560PgICiw','usdt','pkr','stopPeriodicUpdates','\x20USDT','nok','thb','czk','CURRENCIES','error','rate','gbp','default','ltc','status','json','all','52XSIgIG','tether','uah','toUpperCase','5957676hmquDK','xrp','%\x20markup\x20to\x20','vef','asc','clp','currencyService','inr','map','rub','currencyRate','3202400NelMCH','hkd','\x20USDT\x20=\x20','toFixed','getMarkupPercentage','findMany','startPeriodicUpdates','https://api.coingecko.com/api/v3/simple/price','usd','\x20to\x20USDT:','__esModule','ðŸ’±\x20Converted\x20','ðŸ“Š\x20Received\x20rates\x20for\x20','getAllRates','join','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','xau','bdt','14VcDJOY','myr','idr','application/json','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','length','bnb','eth','toLowerCase','entries','aed','mxn','keys','mmk','29150rmWkyU','bits','ngn','vnd','updateCurrencyRates','xdr','catch','Failed\x20to\x20update\x20rate\x20for\x20','dot','COINGECKO_URL','chf','374001EABjTq','log','3595476BNrfBs','ars','kwd','convertMultipleToUSDT','getCurrencyRate','gel','updatedAt','zar','sek','count','sats','No\x20rate\x20found\x20for\x20currency:\x20','Error\x20converting\x20','%\x20markup\x20=\x20','5HttqxS','try','xlm','yfi','âœ…\x20Currency\x20rates\x20updated\x20successfully','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','bhd','cny','\x20USDT,\x20with\x20','__importDefault','findFirst','aud','desc','9257130HSkeFj','CurrencyService','convertToUSDT','eos','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','lkr','pln'];a51_0x4f35=function(){return _0x761956;};return a51_0x4f35();}const database_1=__importDefault(require('../config/database'));function a51_0x56a2(_0x3753b8,_0x1cabbc){_0x3753b8=_0x3753b8-0x119;const _0x4f354d=a51_0x4f35();let _0x56a2e1=_0x4f354d[_0x3753b8];return _0x56a2e1;}class CurrencyService{constructor(){const _0x38426c=a51_0xeec5ae;this[_0x38426c(0x134)]=_0x38426c(0x18a),this[_0x38426c(0x16b)]=['btc',_0x38426c(0x124),_0x38426c(0x170),'bch',_0x38426c(0x123),_0x38426c(0x156),_0x38426c(0x179),_0x38426c(0x148),'link',_0x38426c(0x133),_0x38426c(0x149),_0x38426c(0x18b),_0x38426c(0x127),_0x38426c(0x139),_0x38426c(0x151),_0x38426c(0x11b),_0x38426c(0x14c),'bmd','brl','cad',_0x38426c(0x135),_0x38426c(0x17d),_0x38426c(0x14d),_0x38426c(0x16a),_0x38426c(0x15a),_0x38426c(0x15d),_0x38426c(0x16e),_0x38426c(0x13d),_0x38426c(0x184),'huf',_0x38426c(0x11e),'ils',_0x38426c(0x17f),'jpy',_0x38426c(0x161),_0x38426c(0x13a),_0x38426c(0x158),_0x38426c(0x12a),_0x38426c(0x128),_0x38426c(0x11d),_0x38426c(0x12d),_0x38426c(0x168),'nzd','php',_0x38426c(0x165),_0x38426c(0x159),_0x38426c(0x181),'sar',_0x38426c(0x140),'sgd',_0x38426c(0x169),_0x38426c(0x147),'twd',_0x38426c(0x176),_0x38426c(0x17b),_0x38426c(0x12e),_0x38426c(0x13f),_0x38426c(0x130),'xag',_0x38426c(0x11a),_0x38426c(0x12c),_0x38426c(0x142)],this['updateInterval']=null,this[_0x38426c(0x160)]=-0x3,this[_0x38426c(0x189)]();}[a51_0xeec5ae(0x189)](){const _0x54d44f=a51_0xeec5ae;this['updateCurrencyRates']()[_0x54d44f(0x131)](_0x31a875=>{const _0x32745a=_0x54d44f;console[_0x32745a(0x16c)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x31a875);}),this[_0x54d44f(0x162)]=setInterval(async()=>{const _0x43c620=_0x54d44f;try{await this[_0x43c620(0x12f)]();}catch(_0x448407){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x448407);}},0x3c*0x3c*0x3e8),console[_0x54d44f(0x137)](_0x54d44f(0x157));}[a51_0xeec5ae(0x166)](){const _0x3a9b04=a51_0xeec5ae;this[_0x3a9b04(0x162)]&&(clearInterval(this[_0x3a9b04(0x162)]),this['updateInterval']=null,console[_0x3a9b04(0x137)](_0x3a9b04(0x121)));}async[a51_0xeec5ae(0x12f)](){const _0x4a2708=a51_0xeec5ae;try{console[_0x4a2708(0x137)](_0x4a2708(0x120));const _0x438c8a=this['CURRENCIES'][_0x4a2708(0x191)](','),_0x55028=this[_0x4a2708(0x134)]+'?ids=tether&vs_currencies='+_0x438c8a,_0x412af9=await fetch(_0x55028,{'headers':{'Accept':_0x4a2708(0x11f),'User-Agent':'Payment\x20System/1.0'}});if(!_0x412af9['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x412af9[_0x4a2708(0x171)]+'\x20'+_0x412af9['statusText']);const _0x24d57a=await _0x412af9[_0x4a2708(0x172)]();if(!_0x24d57a[_0x4a2708(0x175)])throw new Error(_0x4a2708(0x119));const _0x250819=_0x24d57a[_0x4a2708(0x175)];console['log'](_0x4a2708(0x18f)+Object[_0x4a2708(0x129)](_0x250819)[_0x4a2708(0x122)]+_0x4a2708(0x15b));const _0x50197a=Object[_0x4a2708(0x126)](_0x250819)[_0x4a2708(0x180)](async([_0x327a32,_0x2da00d])=>{const _0x241afb=_0x4a2708;try{await database_1['default'][_0x241afb(0x182)][_0x241afb(0x15e)]({'where':{'currency':_0x327a32[_0x241afb(0x125)]()},'update':{'rate':_0x2da00d},'create':{'currency':_0x327a32['toLowerCase'](),'rate':_0x2da00d}});}catch(_0x2f161d){console[_0x241afb(0x16c)](_0x241afb(0x132)+_0x327a32+':',_0x2f161d);}});await Promise['allSettled'](_0x50197a),console['log'](_0x4a2708(0x14a));}catch(_0x58add5){console[_0x4a2708(0x16c)](_0x4a2708(0x14b),_0x58add5);throw _0x58add5;}}async['getCurrencyRate'](_0xf0b769){const _0x218b90=a51_0xeec5ae,_0x7a122a=_0xf0b769['toLowerCase']();if(_0x7a122a===_0x218b90(0x164))return 0x1;try{const _0x4d816f=await database_1[_0x218b90(0x16f)][_0x218b90(0x182)]['findUnique']({'where':{'currency':_0x7a122a}});if(!_0x4d816f)return console[_0x218b90(0x15f)](_0x218b90(0x143)+_0xf0b769+',\x20using\x201\x20as\x20fallback'),0x1;return _0x4d816f[_0x218b90(0x16d)];}catch(_0xdcc686){return console[_0x218b90(0x16c)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0xf0b769+':',_0xdcc686),0x1;}}async['convertToUSDT'](_0x53ea6a,_0x303939){const _0x3adc17=a51_0xeec5ae,_0x747393=_0x303939[_0x3adc17(0x125)]();if(_0x747393===_0x3adc17(0x164)){const _0x163243=_0x53ea6a*(0x1+this[_0x3adc17(0x160)]/0x64);return console[_0x3adc17(0x137)]('ðŸ’±\x20Applied\x20'+this[_0x3adc17(0x160)]+_0x3adc17(0x17a)+_0x53ea6a+_0x3adc17(0x185)+_0x163243[_0x3adc17(0x186)](0x6)+_0x3adc17(0x167)),_0x163243;}try{const _0x37f41f=await this[_0x3adc17(0x13c)](_0x747393),_0x310b65=_0x53ea6a/_0x37f41f,_0x52d416=_0x310b65*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3adc17(0x137)](_0x3adc17(0x18e)+_0x53ea6a+'\x20'+_0x303939[_0x3adc17(0x177)]()+'\x20to\x20'+_0x310b65[_0x3adc17(0x186)](0x6)+_0x3adc17(0x14e)+this['MARKUP_PERCENTAGE']+_0x3adc17(0x145)+_0x52d416[_0x3adc17(0x186)](0x6)+'\x20USDT\x20(rate:\x20'+_0x37f41f+')'),_0x52d416;}catch(_0x3ca575){console[_0x3adc17(0x16c)](_0x3adc17(0x144)+_0x53ea6a+'\x20'+_0x303939+_0x3adc17(0x18c),_0x3ca575);const _0x2f71f9=_0x53ea6a*(0x1+this[_0x3adc17(0x160)]/0x64);return _0x2f71f9;}}async[a51_0xeec5ae(0x13b)](_0x1890d4){const _0x28cba9=a51_0xeec5ae;let _0x4c3749=0x0;for(const {amount:_0x55ed74,currency:_0x1497b2}of _0x1890d4){const _0x5f3467=await this[_0x28cba9(0x155)](_0x55ed74,_0x1497b2);_0x4c3749+=_0x5f3467;}return _0x4c3749;}async[a51_0xeec5ae(0x190)](){const _0x3bef7b=a51_0xeec5ae;try{const _0x50ab22=await database_1[_0x3bef7b(0x16f)][_0x3bef7b(0x182)][_0x3bef7b(0x188)]({'select':{'currency':!![],'rate':!![]}}),_0xbd12aa={'usdt':0x1};return _0x50ab22['forEach'](_0x38334e=>{const _0x148623=_0x3bef7b;_0xbd12aa[_0x38334e['currency']]=_0x38334e[_0x148623(0x16d)];}),_0xbd12aa;}catch(_0x19151b){return console[_0x3bef7b(0x16c)]('Error\x20getting\x20all\x20rates:',_0x19151b),{'usdt':0x1};}}async[a51_0xeec5ae(0x15c)](){const _0xe0e08b=a51_0xeec5ae;try{const [_0x322514,_0x2120d8,_0x3e9e51]=await Promise[_0xe0e08b(0x173)]([database_1[_0xe0e08b(0x16f)][_0xe0e08b(0x182)][_0xe0e08b(0x141)](),database_1[_0xe0e08b(0x16f)][_0xe0e08b(0x182)][_0xe0e08b(0x150)]({'orderBy':{'updatedAt':_0xe0e08b(0x152)},'select':{'updatedAt':!![]}}),database_1[_0xe0e08b(0x16f)]['currencyRate'][_0xe0e08b(0x150)]({'orderBy':{'updatedAt':_0xe0e08b(0x17c)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x322514,'lastUpdated':_0x2120d8?.['updatedAt']||null,'oldestRate':_0x3e9e51?.[_0xe0e08b(0x13e)]||null,'markupPercentage':this[_0xe0e08b(0x160)]};}catch(_0x2ac8b){return console[_0xe0e08b(0x16c)]('Error\x20getting\x20rates\x20status:',_0x2ac8b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xe0e08b(0x160)]};}}[a51_0xeec5ae(0x187)](){const _0xce46dd=a51_0xeec5ae;return this[_0xce46dd(0x160)];}}exports['CurrencyService']=CurrencyService,exports[a51_0xeec5ae(0x17e)]=new CurrencyService();