'use strict';const a43_0x1934e5=a43_0xc80b;function a43_0x1cdf(){const _0x19cce6=['cny','rate','desc','134814wlgWOY','\x20USDT\x20=\x20','pkr','json','eos','findFirst','sgd','czk','📊\x20Received\x20rates\x20for\x20','brl','map','https://api.coingecko.com/api/v3/simple/price','cad','\x20USDT,\x20with\x20','xau','default','✅\x20Currency\x20rates\x20updated\x20successfully','💱\x20Applied\x20','eth','clp','toUpperCase','krw','No\x20rate\x20found\x20for\x20currency:\x20','statusText','keys','Initial\x20currency\x20rates\x20update\x20failed:','dot','97692otwgUG','twd','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','currencyRate','xag','getCurrencyRate','Failed\x20to\x20update\x20rate\x20for\x20','findMany','ils','startPeriodicUpdates','entries','Payment\x20System/1.0','updatedAt','CURRENCIES','hkd','try','count','576kZuXeS','defineProperty','bdt','php','length','usdt','__esModule','Error\x20converting\x20','Periodic\x20currency\x20rates\x20update\x20failed:','warn','18WMTMdN','eur','vnd','aud','\x20USDT\x20(rate:\x20','dkk','getMarkupPercentage','application/json','mxn','MARKUP_PERCENTAGE','tether','bhd','💱\x20Converted\x20','convertToUSDT','4829391MExBZD','__importDefault','nok','catch','CoinGecko\x20API\x20error:\x20','kwd','xdr','currencyService','vef','all','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','CurrencyService','jpy','getAllRates','uah','zar','bmd','gel','toLowerCase','error','asc','sek','152935RjQXzm','btc','351082DiMnfS','pln','convertMultipleToUSDT','currency','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bch','\x20USDT','\x20to\x20','800308kJDsEl','huf','Error\x20getting\x20rates\x20status:','log','toFixed','updateInterval','14112ZHqnWz','gbp','updateCurrencyRates','myr','%\x20markup\x20to\x20','allSettled','forEach','yfi','sats','xlm','upsert','%\x20markup\x20=\x20','inr','getRatesStatus','\x20to\x20USDT:'];a43_0x1cdf=function(){return _0x19cce6;};return a43_0x1cdf();}(function(_0x3f500e,_0x4a992d){const _0x3237d9=a43_0xc80b,_0x497bce=_0x3f500e();while(!![]){try{const _0x598418=-parseInt(_0x3237d9(0x190))/0x1+-parseInt(_0x3237d9(0x170))/0x2+parseInt(_0x3237d9(0x1ab))/0x3+-parseInt(_0x3237d9(0x178))/0x4+parseInt(_0x3237d9(0x16e))/0x5*(-parseInt(_0x3237d9(0x14a))/0x6)+parseInt(_0x3237d9(0x17e))/0x7*(parseInt(_0x3237d9(0x1bc))/0x8)+parseInt(_0x3237d9(0x158))/0x9;if(_0x598418===_0x4a992d)break;else _0x497bce['push'](_0x497bce['shift']());}catch(_0x3901ab){_0x497bce['push'](_0x497bce['shift']());}}}(a43_0x1cdf,0x1b5fa));var __importDefault=this&&this[a43_0x1934e5(0x159)]||function(_0x378c80){const _0x2b8281=a43_0x1934e5;return _0x378c80&&_0x378c80[_0x2b8281(0x1c2)]?_0x378c80:{'default':_0x378c80};};Object[a43_0x1934e5(0x1bd)](exports,a43_0x1934e5(0x1c2),{'value':!![]}),exports[a43_0x1934e5(0x15f)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));function a43_0xc80b(_0x2adc2f,_0x38be0e){const _0x1cdf0e=a43_0x1cdf();return a43_0xc80b=function(_0xc80b71,_0x8d3fb5){_0xc80b71=_0xc80b71-0x148;let _0x4d6200=_0x1cdf0e[_0xc80b71];return _0x4d6200;},a43_0xc80b(_0x2adc2f,_0x38be0e);}class CurrencyService{constructor(){const _0x396572=a43_0x1934e5;this['COINGECKO_URL']=_0x396572(0x19b),this[_0x396572(0x1b8)]=[_0x396572(0x16f),_0x396572(0x1a2),'ltc',_0x396572(0x175),'bnb',_0x396572(0x194),'xrp',_0x396572(0x187),'link',_0x396572(0x1aa),_0x396572(0x185),'usd','aed','ars',_0x396572(0x14d),_0x396572(0x1be),_0x396572(0x155),_0x396572(0x168),_0x396572(0x199),_0x396572(0x19c),'chf',_0x396572(0x1a3),_0x396572(0x18d),_0x396572(0x197),_0x396572(0x14f),_0x396572(0x14b),_0x396572(0x17f),_0x396572(0x169),_0x396572(0x1b9),_0x396572(0x179),'idr',_0x396572(0x1b3),_0x396572(0x18a),_0x396572(0x164),_0x396572(0x1a5),_0x396572(0x15d),'lkr','mmk',_0x396572(0x152),_0x396572(0x181),'ngn',_0x396572(0x15a),'nzd',_0x396572(0x1bf),_0x396572(0x192),_0x396572(0x171),'rub','sar',_0x396572(0x16d),_0x396572(0x196),'thb',_0x396572(0x1ba),_0x396572(0x1ac),_0x396572(0x166),_0x396572(0x160),_0x396572(0x14c),_0x396572(0x167),_0x396572(0x15e),_0x396572(0x1af),_0x396572(0x19e),'bits',_0x396572(0x186)],this[_0x396572(0x17d)]=null,this['MARKUP_PERCENTAGE']=-0x3,this['startPeriodicUpdates']();}[a43_0x1934e5(0x1b4)](){const _0x400d30=a43_0x1934e5;this['updateCurrencyRates']()[_0x400d30(0x15b)](_0x23735d=>{const _0x127bb8=_0x400d30;console[_0x127bb8(0x16b)](_0x127bb8(0x1a9),_0x23735d);}),this['updateInterval']=setInterval(async()=>{const _0x20ad71=_0x400d30;try{await this[_0x20ad71(0x180)]();}catch(_0x364043){console[_0x20ad71(0x16b)](_0x20ad71(0x148),_0x364043);}},0x3c*0x3c*0x3e8),console[_0x400d30(0x17b)](_0x400d30(0x162));}['stopPeriodicUpdates'](){const _0x51c415=a43_0x1934e5;this[_0x51c415(0x17d)]&&(clearInterval(this[_0x51c415(0x17d)]),this[_0x51c415(0x17d)]=null,console['log'](_0x51c415(0x1ad)));}async['updateCurrencyRates'](){const _0x1e125e=a43_0x1934e5;try{console[_0x1e125e(0x17b)](_0x1e125e(0x174));const _0x4e6dc3=this[_0x1e125e(0x1b8)]['join'](','),_0x362cdd=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x4e6dc3,_0x5c09aa=await fetch(_0x362cdd,{'headers':{'Accept':_0x1e125e(0x151),'User-Agent':_0x1e125e(0x1b6)}});if(!_0x5c09aa['ok'])throw new Error(_0x1e125e(0x15c)+_0x5c09aa['status']+'\x20'+_0x5c09aa[_0x1e125e(0x1a7)]);const _0x566376=await _0x5c09aa[_0x1e125e(0x193)]();if(!_0x566376[_0x1e125e(0x154)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x505976=_0x566376['tether'];console[_0x1e125e(0x17b)](_0x1e125e(0x198)+Object[_0x1e125e(0x1a8)](_0x505976)[_0x1e125e(0x1c0)]+'\x20currencies');const _0x59c425=Object[_0x1e125e(0x1b5)](_0x505976)[_0x1e125e(0x19a)](async([_0x37f359,_0x194acf])=>{const _0xaeae57=_0x1e125e;try{await database_1[_0xaeae57(0x19f)]['currencyRate'][_0xaeae57(0x188)]({'where':{'currency':_0x37f359['toLowerCase']()},'update':{'rate':_0x194acf},'create':{'currency':_0x37f359[_0xaeae57(0x16a)](),'rate':_0x194acf}});}catch(_0x1bee5b){console['error'](_0xaeae57(0x1b1)+_0x37f359+':',_0x1bee5b);}});await Promise[_0x1e125e(0x183)](_0x59c425),console[_0x1e125e(0x17b)](_0x1e125e(0x1a0));}catch(_0x637eb6){console[_0x1e125e(0x16b)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x637eb6);throw _0x637eb6;}}async[a43_0x1934e5(0x1b0)](_0x51a715){const _0x37d931=a43_0x1934e5,_0x1712bd=_0x51a715[_0x37d931(0x16a)]();if(_0x1712bd===_0x37d931(0x1c1))return 0x1;try{const _0x22ce65=await database_1['default']['currencyRate']['findUnique']({'where':{'currency':_0x1712bd}});if(!_0x22ce65)return console[_0x37d931(0x149)](_0x37d931(0x1a6)+_0x51a715+',\x20using\x201\x20as\x20fallback'),0x1;return _0x22ce65[_0x37d931(0x18e)];}catch(_0x5322fe){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x51a715+':',_0x5322fe),0x1;}}async['convertToUSDT'](_0x5bc166,_0x55100f){const _0x3dcf16=a43_0x1934e5,_0x1c4485=_0x55100f['toLowerCase']();if(_0x1c4485===_0x3dcf16(0x1c1)){const _0x5e392d=_0x5bc166*(0x1+this[_0x3dcf16(0x153)]/0x64);return console[_0x3dcf16(0x17b)](_0x3dcf16(0x1a1)+this['MARKUP_PERCENTAGE']+_0x3dcf16(0x182)+_0x5bc166+_0x3dcf16(0x191)+_0x5e392d[_0x3dcf16(0x17c)](0x6)+_0x3dcf16(0x176)),_0x5e392d;}try{const _0x483f4e=await this[_0x3dcf16(0x1b0)](_0x1c4485),_0x624f74=_0x5bc166/_0x483f4e,_0x9485ea=_0x624f74*(0x1+this[_0x3dcf16(0x153)]/0x64);return console[_0x3dcf16(0x17b)](_0x3dcf16(0x156)+_0x5bc166+'\x20'+_0x55100f[_0x3dcf16(0x1a4)]()+_0x3dcf16(0x177)+_0x624f74['toFixed'](0x6)+_0x3dcf16(0x19d)+this['MARKUP_PERCENTAGE']+_0x3dcf16(0x189)+_0x9485ea[_0x3dcf16(0x17c)](0x6)+_0x3dcf16(0x14e)+_0x483f4e+')'),_0x9485ea;}catch(_0x1b77cb){console[_0x3dcf16(0x16b)](_0x3dcf16(0x1c3)+_0x5bc166+'\x20'+_0x55100f+_0x3dcf16(0x18c),_0x1b77cb);const _0x46f411=_0x5bc166*(0x1+this[_0x3dcf16(0x153)]/0x64);return _0x46f411;}}async[a43_0x1934e5(0x172)](_0x218d5c){const _0x551a45=a43_0x1934e5;let _0x43327d=0x0;for(const {amount:_0x3d43ad,currency:_0x5c8be3}of _0x218d5c){const _0x598626=await this[_0x551a45(0x157)](_0x3d43ad,_0x5c8be3);_0x43327d+=_0x598626;}return _0x43327d;}async[a43_0x1934e5(0x165)](){const _0x4a849c=a43_0x1934e5;try{const _0x248c1c=await database_1[_0x4a849c(0x19f)][_0x4a849c(0x1ae)][_0x4a849c(0x1b2)]({'select':{'currency':!![],'rate':!![]}}),_0xeea84e={'usdt':0x1};return _0x248c1c[_0x4a849c(0x184)](_0x509e43=>{const _0x40400d=_0x4a849c;_0xeea84e[_0x509e43[_0x40400d(0x173)]]=_0x509e43[_0x40400d(0x18e)];}),_0xeea84e;}catch(_0x360e7c){return console[_0x4a849c(0x16b)]('Error\x20getting\x20all\x20rates:',_0x360e7c),{'usdt':0x1};}}async[a43_0x1934e5(0x18b)](){const _0x25435a=a43_0x1934e5;try{const [_0x3f15ce,_0x4fea3e,_0x4d77d7]=await Promise[_0x25435a(0x161)]([database_1[_0x25435a(0x19f)]['currencyRate'][_0x25435a(0x1bb)](),database_1[_0x25435a(0x19f)]['currencyRate'][_0x25435a(0x195)]({'orderBy':{'updatedAt':_0x25435a(0x18f)},'select':{'updatedAt':!![]}}),database_1[_0x25435a(0x19f)][_0x25435a(0x1ae)]['findFirst']({'orderBy':{'updatedAt':_0x25435a(0x16c)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f15ce,'lastUpdated':_0x4fea3e?.[_0x25435a(0x1b7)]||null,'oldestRate':_0x4d77d7?.[_0x25435a(0x1b7)]||null,'markupPercentage':this[_0x25435a(0x153)]};}catch(_0x8ae9e2){return console[_0x25435a(0x16b)](_0x25435a(0x17a),_0x8ae9e2),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x25435a(0x153)]};}}[a43_0x1934e5(0x150)](){const _0x4ebf5c=a43_0x1934e5;return this[_0x4ebf5c(0x153)];}}exports[a43_0x1934e5(0x163)]=CurrencyService,exports[a43_0x1934e5(0x15f)]=new CurrencyService();