'use strict';const a38_0x55764d=a38_0x1f78;(function(_0x1ce13e,_0x39add7){const _0x5e9cd6=a38_0x1f78,_0x5ce7c4=_0x1ce13e();while(!![]){try{const _0x34b8cc=parseInt(_0x5e9cd6(0x197))/0x1+parseInt(_0x5e9cd6(0x1ef))/0x2+parseInt(_0x5e9cd6(0x1a4))/0x3+parseInt(_0x5e9cd6(0x1cd))/0x4+parseInt(_0x5e9cd6(0x1f3))/0x5*(-parseInt(_0x5e9cd6(0x1ce))/0x6)+-parseInt(_0x5e9cd6(0x1da))/0x7*(parseInt(_0x5e9cd6(0x1e1))/0x8)+parseInt(_0x5e9cd6(0x1d4))/0x9*(-parseInt(_0x5e9cd6(0x1bb))/0xa);if(_0x34b8cc===_0x39add7)break;else _0x5ce7c4['push'](_0x5ce7c4['shift']());}catch(_0x3c1d46){_0x5ce7c4['push'](_0x5ce7c4['shift']());}}}(a38_0x4806,0x215f6));function a38_0x1f78(_0x2fed4a,_0x441326){const _0x48065f=a38_0x4806();return a38_0x1f78=function(_0x1f784a,_0x149908){_0x1f784a=_0x1f784a-0x192;let _0x49f7e4=_0x48065f[_0x1f784a];return _0x49f7e4;},a38_0x1f78(_0x2fed4a,_0x441326);}var __importDefault=this&&this[a38_0x55764d(0x1af)]||function(_0x2c0174){const _0x161861=a38_0x55764d;return _0x2c0174&&_0x2c0174[_0x161861(0x1a8)]?_0x2c0174:{'default':_0x2c0174};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a38_0x55764d(0x1c3)]=void 0x0;const database_1=__importDefault(require(a38_0x55764d(0x1d1)));class CurrencyService{constructor(){const _0x421fc0=a38_0x55764d;this[_0x421fc0(0x1e3)]='https://api.coingecko.com/api/v3/simple/price',this[_0x421fc0(0x1c5)]=[_0x421fc0(0x1dd),'eth',_0x421fc0(0x1fe),_0x421fc0(0x1f6),_0x421fc0(0x1c1),'eos',_0x421fc0(0x199),'xlm','link',_0x421fc0(0x1cb),_0x421fc0(0x1e9),'usd',_0x421fc0(0x1ae),'ars','aud',_0x421fc0(0x1b6),_0x421fc0(0x1c8),_0x421fc0(0x1de),_0x421fc0(0x1b9),_0x421fc0(0x1ff),'chf',_0x421fc0(0x1c4),_0x421fc0(0x19f),'czk','dkk',_0x421fc0(0x1e5),'gbp',_0x421fc0(0x1aa),'hkd',_0x421fc0(0x1bc),'idr',_0x421fc0(0x19b),_0x421fc0(0x1db),_0x421fc0(0x1cc),_0x421fc0(0x1d2),_0x421fc0(0x1f7),_0x421fc0(0x1ec),'mmk',_0x421fc0(0x1e7),_0x421fc0(0x1d6),_0x421fc0(0x1f5),_0x421fc0(0x1d9),'nzd',_0x421fc0(0x1d7),'pkr',_0x421fc0(0x19d),_0x421fc0(0x19e),'sar','sek',_0x421fc0(0x1bd),_0x421fc0(0x1c2),_0x421fc0(0x1b4),_0x421fc0(0x1a0),_0x421fc0(0x1a6),_0x421fc0(0x19a),_0x421fc0(0x1a3),_0x421fc0(0x202),_0x421fc0(0x1fb),_0x421fc0(0x1a9),_0x421fc0(0x1cf),_0x421fc0(0x1ac),_0x421fc0(0x1f4)],this[_0x421fc0(0x1e8)]=null,this[_0x421fc0(0x204)]=0x3,this[_0x421fc0(0x1b0)]();}[a38_0x55764d(0x1b0)](){const _0x373cfd=a38_0x55764d;this[_0x373cfd(0x1a2)]()[_0x373cfd(0x1f2)](_0x1077c3=>{const _0x3c6c36=_0x373cfd;console[_0x3c6c36(0x1ed)](_0x3c6c36(0x194),_0x1077c3);}),this[_0x373cfd(0x1e8)]=setInterval(async()=>{const _0x37e26b=_0x373cfd;try{await this[_0x37e26b(0x1a2)]();}catch(_0x32e556){console[_0x37e26b(0x1ed)](_0x37e26b(0x1c7),_0x32e556);}},0x3c*0x3c*0x3e8),console[_0x373cfd(0x1e2)](_0x373cfd(0x1d5));}['stopPeriodicUpdates'](){const _0x27d8ea=a38_0x55764d;this[_0x27d8ea(0x1e8)]&&(clearInterval(this['updateInterval']),this[_0x27d8ea(0x1e8)]=null,console[_0x27d8ea(0x1e2)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x55764d(0x1a2)](){const _0x5f315c=a38_0x55764d;try{console[_0x5f315c(0x1e2)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xcb38f9=this[_0x5f315c(0x1c5)][_0x5f315c(0x1ab)](','),_0x35dc73=this[_0x5f315c(0x1e3)]+_0x5f315c(0x1d0)+_0xcb38f9,_0x539f17=await fetch(_0x35dc73,{'headers':{'Accept':_0x5f315c(0x1ea),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x539f17['ok'])throw new Error(_0x5f315c(0x1fd)+_0x539f17[_0x5f315c(0x1f9)]+'\x20'+_0x539f17['statusText']);const _0x401aa7=await _0x539f17[_0x5f315c(0x196)]();if(!_0x401aa7[_0x5f315c(0x1eb)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x435438=_0x401aa7['tether'];console['log'](_0x5f315c(0x1b7)+Object['keys'](_0x435438)[_0x5f315c(0x1b5)]+_0x5f315c(0x1b2));const _0x3b3ac9=Object[_0x5f315c(0x1e0)](_0x435438)[_0x5f315c(0x1ba)](async([_0x349ff2,_0x5b3821])=>{const _0x25d086=_0x5f315c;try{await database_1[_0x25d086(0x1ca)][_0x25d086(0x1c6)]['upsert']({'where':{'currency':_0x349ff2[_0x25d086(0x1f8)]()},'update':{'rate':_0x5b3821},'create':{'currency':_0x349ff2[_0x25d086(0x1f8)](),'rate':_0x5b3821}});}catch(_0x53fae3){console['error'](_0x25d086(0x1a5)+_0x349ff2+':',_0x53fae3);}});await Promise[_0x5f315c(0x1ad)](_0x3b3ac9),console[_0x5f315c(0x1e2)]('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x47583e){console[_0x5f315c(0x1ed)](_0x5f315c(0x1df),_0x47583e);throw _0x47583e;}}async[a38_0x55764d(0x1f0)](_0x54e84c){const _0x46f25e=a38_0x55764d,_0x4dce19=_0x54e84c['toLowerCase']();if(_0x4dce19===_0x46f25e(0x1b3))return 0x1;try{const _0x156692=await database_1[_0x46f25e(0x1ca)][_0x46f25e(0x1c6)][_0x46f25e(0x1c0)]({'where':{'currency':_0x4dce19}});if(!_0x156692)return console[_0x46f25e(0x198)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x54e84c+_0x46f25e(0x203)),0x1;return _0x156692[_0x46f25e(0x1ee)];}catch(_0x3e2af5){return console[_0x46f25e(0x1ed)](_0x46f25e(0x193)+_0x54e84c+':',_0x3e2af5),0x1;}}async[a38_0x55764d(0x1e4)](_0x124c01,_0x71ed71){const _0x5b36fa=a38_0x55764d,_0x4d0ab8=_0x71ed71[_0x5b36fa(0x1f8)]();if(_0x4d0ab8===_0x5b36fa(0x1b3)){const _0x38e79d=_0x124c01*(0x1+this[_0x5b36fa(0x204)]/0x64);return console['log']('üí±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x124c01+'\x20USDT\x20=\x20'+_0x38e79d[_0x5b36fa(0x1bf)](0x6)+_0x5b36fa(0x1c9)),_0x38e79d;}try{const _0x20d3b2=await this[_0x5b36fa(0x1f0)](_0x4d0ab8),_0x6c8638=_0x124c01/_0x20d3b2,_0x536bdb=_0x6c8638*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5b36fa(0x1e2)](_0x5b36fa(0x1b1)+_0x124c01+'\x20'+_0x71ed71[_0x5b36fa(0x200)]()+_0x5b36fa(0x1a1)+_0x6c8638[_0x5b36fa(0x1bf)](0x6)+_0x5b36fa(0x19c)+this[_0x5b36fa(0x204)]+'%\x20markup\x20=\x20'+_0x536bdb[_0x5b36fa(0x1bf)](0x6)+_0x5b36fa(0x1fc)+_0x20d3b2+')'),_0x536bdb;}catch(_0x40c0de){console['error']('Error\x20converting\x20'+_0x124c01+'\x20'+_0x71ed71+'\x20to\x20USDT:',_0x40c0de);const _0xb16e21=_0x124c01*(0x1+this[_0x5b36fa(0x204)]/0x64);return _0xb16e21;}}async[a38_0x55764d(0x1f1)](_0x8601e1){const _0x2e5a8d=a38_0x55764d;let _0x45a764=0x0;for(const {amount:_0x1a51de,currency:_0x4f7133}of _0x8601e1){const _0xf5124=await this[_0x2e5a8d(0x1e4)](_0x1a51de,_0x4f7133);_0x45a764+=_0xf5124;}return _0x45a764;}async[a38_0x55764d(0x192)](){const _0xc058c6=a38_0x55764d;try{const _0x2035ed=await database_1['default'][_0xc058c6(0x1c6)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x2fee89={'usdt':0x1};return _0x2035ed[_0xc058c6(0x1b8)](_0x43ab78=>{const _0x6735c9=_0xc058c6;_0x2fee89[_0x43ab78[_0x6735c9(0x1a7)]]=_0x43ab78[_0x6735c9(0x1ee)];}),_0x2fee89;}catch(_0x53a971){return console[_0xc058c6(0x1ed)](_0xc058c6(0x1d3),_0x53a971),{'usdt':0x1};}}async['getRatesStatus'](){const _0x5dc4a3=a38_0x55764d;try{const [_0x509d31,_0x4b8648,_0x285a17]=await Promise[_0x5dc4a3(0x1d8)]([database_1[_0x5dc4a3(0x1ca)][_0x5dc4a3(0x1c6)][_0x5dc4a3(0x1dc)](),database_1[_0x5dc4a3(0x1ca)][_0x5dc4a3(0x1c6)][_0x5dc4a3(0x1e6)]({'orderBy':{'updatedAt':_0x5dc4a3(0x201)},'select':{'updatedAt':!![]}}),database_1[_0x5dc4a3(0x1ca)][_0x5dc4a3(0x1c6)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x509d31,'lastUpdated':_0x4b8648?.[_0x5dc4a3(0x1fa)]||null,'oldestRate':_0x285a17?.[_0x5dc4a3(0x1fa)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x55fa8c){return console[_0x5dc4a3(0x1ed)]('Error\x20getting\x20rates\x20status:',_0x55fa8c),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5dc4a3(0x204)]};}}[a38_0x55764d(0x1be)](){const _0x16353a=a38_0x55764d;return this[_0x16353a(0x204)];}}function a38_0x4806(){const _0x30b1ae=['\x20USDT\x20(rate:\x20','CoinGecko\x20API\x20error:\x20','ltc','cad','toUpperCase','desc','zar',',\x20using\x201\x20as\x20fallback','MARKUP_PERCENTAGE','getAllRates','Error\x20getting\x20rate\x20for\x20currency\x20','Initial\x20currency\x20rates\x20update\x20failed:','currencyService','json','63160mcGbWk','warn','xrp','vef','ils','\x20USDT,\x20with\x20','pln','rub','cny','twd','\x20to\x20','updateCurrencyRates','vnd','238443sPdxnt','Failed\x20to\x20update\x20rate\x20for\x20','uah','currency','__esModule','xag','gel','join','bits','allSettled','aed','__importDefault','startPeriodicUpdates','üí±\x20Converted\x20','\x20currencies','usdt','try','length','bdt','üìä\x20Received\x20rates\x20for\x20','forEach','brl','map','70890vwjguJ','huf','sgd','getMarkupPercentage','toFixed','findUnique','bnb','thb','CurrencyService','clp','CURRENCIES','currencyRate','Periodic\x20currency\x20rates\x20update\x20failed:','bhd','\x20USDT','default','dot','jpy','765816IUJLAs','3450ekHTSh','xau','?ids=tether&vs_currencies=','../config/database','krw','Error\x20getting\x20all\x20rates:','297ORBjwv','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','myr','php','all','nok','14njgBXJ','inr','count','btc','bmd','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','entries','6624HvNuLs','log','COINGECKO_URL','convertToUSDT','eur','findFirst','mxn','updateInterval','yfi','application/json','tether','lkr','error','rate','539834jyJdLN','getCurrencyRate','convertMultipleToUSDT','catch','2015fWTlin','sats','ngn','bch','kwd','toLowerCase','status','updatedAt','xdr'];a38_0x4806=function(){return _0x30b1ae;};return a38_0x4806();}exports[a38_0x55764d(0x1c3)]=CurrencyService,exports[a38_0x55764d(0x195)]=new CurrencyService();