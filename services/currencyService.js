'use strict';const a38_0x56fc49=a38_0x2998;(function(_0x4ae244,_0x3e0f77){const _0x35f3a0=a38_0x2998,_0x57eda2=_0x4ae244();while(!![]){try{const _0x1e9b76=parseInt(_0x35f3a0(0x1c4))/0x1+-parseInt(_0x35f3a0(0x1ab))/0x2+-parseInt(_0x35f3a0(0x156))/0x3*(parseInt(_0x35f3a0(0x16f))/0x4)+-parseInt(_0x35f3a0(0x16c))/0x5+parseInt(_0x35f3a0(0x1b7))/0x6+-parseInt(_0x35f3a0(0x1bd))/0x7+parseInt(_0x35f3a0(0x16b))/0x8;if(_0x1e9b76===_0x3e0f77)break;else _0x57eda2['push'](_0x57eda2['shift']());}catch(_0x430cd6){_0x57eda2['push'](_0x57eda2['shift']());}}}(a38_0x2625,0xd721c));var __importDefault=this&&this[a38_0x56fc49(0x1be)]||function(_0x506688){const _0x55b915=a38_0x56fc49;return _0x506688&&_0x506688[_0x55b915(0x1c8)]?_0x506688:{'default':_0x506688};};Object[a38_0x56fc49(0x193)](exports,a38_0x56fc49(0x1c8),{'value':!![]}),exports[a38_0x56fc49(0x183)]=exports[a38_0x56fc49(0x159)]=void 0x0;const database_1=__importDefault(require(a38_0x56fc49(0x171)));function a38_0x2625(){const _0x447e5c=['getMarkupPercentage','dkk','aed','eos','currencyRate','%\x20markup\x20=\x20','📊\x20Received\x20rates\x20for\x20','getCurrencyRate','cad','tether','916396pqZemP','convertMultipleToUSDT','log','brl','jpy','map','xdr','count','vef','aud','eur','all','5564544fYHuTj','toFixed','error','huf','ils','krw','7720118mGoDNx','__importDefault','btc','bnb','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','getAllRates','bch','557680vjorPB','asc','bdt','sar','__esModule','💱\x20Applied\x20','entries','xau','xag','CURRENCIES','chf','bhd','xrp','sek','134904zIWPhr','catch',',\x20using\x201\x20as\x20fallback','CurrencyService','\x20to\x20USDT:','desc','updatedAt','?ids=tether&vs_currencies=','Error\x20getting\x20all\x20rates:','thb','json','✅\x20Currency\x20rates\x20updated\x20successfully','dot','length','updateCurrencyRates','nzd','default','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','COINGECKO_URL','kwd','cny','16152000qlqmJv','1037300OGQOSY','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20currencies','76UUYKAY','try','../config/database','Periodic\x20currency\x20rates\x20update\x20failed:','convertToUSDT','startPeriodicUpdates','Error\x20converting\x20','nok','rub','\x20USDT','join','zar','php','MARKUP_PERCENTAGE','hkd','findUnique','%\x20markup\x20to\x20','\x20USDT,\x20with\x20','myr','Error\x20getting\x20rate\x20for\x20currency\x20','currencyService','Initial\x20currency\x20rates\x20update\x20failed:','vnd','idr','No\x20rate\x20found\x20for\x20currency:\x20','findFirst','allSettled','uah','mxn','forEach','sgd','gel','Failed\x20to\x20update\x20rate\x20for\x20','toLowerCase','gbp','\x20to\x20','defineProperty','rate','currency','lkr','\x20USDT\x20(rate:\x20','link','usd','yfi','czk','CoinGecko\x20API\x20error:\x20','updateInterval','clp','ars','ngn'];a38_0x2625=function(){return _0x447e5c;};return a38_0x2625();}class CurrencyService{constructor(){const _0x465b9e=a38_0x56fc49;this[_0x465b9e(0x168)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x465b9e(0x1bf),'eth','ltc',_0x465b9e(0x1c3),_0x465b9e(0x1c0),_0x465b9e(0x1a4),_0x465b9e(0x154),'xlm',_0x465b9e(0x198),_0x465b9e(0x162),_0x465b9e(0x19a),_0x465b9e(0x199),_0x465b9e(0x1a3),_0x465b9e(0x19f),_0x465b9e(0x1b4),_0x465b9e(0x1c6),_0x465b9e(0x153),'bmd',_0x465b9e(0x1ae),_0x465b9e(0x1a9),_0x465b9e(0x1ce),_0x465b9e(0x19e),_0x465b9e(0x16a),_0x465b9e(0x19b),_0x465b9e(0x1a2),_0x465b9e(0x1b5),_0x465b9e(0x191),_0x465b9e(0x18e),_0x465b9e(0x17d),_0x465b9e(0x1ba),_0x465b9e(0x186),_0x465b9e(0x1bb),'inr',_0x465b9e(0x1af),_0x465b9e(0x1bc),_0x465b9e(0x169),_0x465b9e(0x196),'mmk',_0x465b9e(0x18b),_0x465b9e(0x181),_0x465b9e(0x1a0),_0x465b9e(0x176),_0x465b9e(0x165),_0x465b9e(0x17b),'pkr','pln',_0x465b9e(0x177),_0x465b9e(0x1c7),_0x465b9e(0x155),_0x465b9e(0x18d),_0x465b9e(0x15f),_0x465b9e(0x170),'twd',_0x465b9e(0x18a),_0x465b9e(0x1b3),_0x465b9e(0x185),_0x465b9e(0x17a),_0x465b9e(0x1b1),_0x465b9e(0x1cc),_0x465b9e(0x1cb),'bits','sats'],this[_0x465b9e(0x19d)]=null,this[_0x465b9e(0x17c)]=0x3,this[_0x465b9e(0x174)]();}[a38_0x56fc49(0x174)](){const _0x3b22fb=a38_0x56fc49;this['updateCurrencyRates']()[_0x3b22fb(0x157)](_0x519724=>{const _0x2c93f5=_0x3b22fb;console['error'](_0x2c93f5(0x184),_0x519724);}),this[_0x3b22fb(0x19d)]=setInterval(async()=>{const _0x4b6fd6=_0x3b22fb;try{await this['updateCurrencyRates']();}catch(_0x17f889){console[_0x4b6fd6(0x1b9)](_0x4b6fd6(0x172),_0x17f889);}},0x3c*0x3c*0x3e8),console[_0x3b22fb(0x1ad)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x294ce0=a38_0x56fc49;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x294ce0(0x19d)]=null,console[_0x294ce0(0x1ad)](_0x294ce0(0x167)));}async[a38_0x56fc49(0x164)](){const _0x5bbcec=a38_0x56fc49;try{console[_0x5bbcec(0x1ad)](_0x5bbcec(0x1c1));const _0x3a521d=this[_0x5bbcec(0x1cd)][_0x5bbcec(0x179)](','),_0x42c508=this[_0x5bbcec(0x168)]+_0x5bbcec(0x15d)+_0x3a521d,_0x1741eb=await fetch(_0x42c508,{'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x1741eb['ok'])throw new Error(_0x5bbcec(0x19c)+_0x1741eb['status']+'\x20'+_0x1741eb['statusText']);const _0x53f2c7=await _0x1741eb[_0x5bbcec(0x160)]();if(!_0x53f2c7[_0x5bbcec(0x1aa)])throw new Error(_0x5bbcec(0x16d));const _0x4e240e=_0x53f2c7['tether'];console[_0x5bbcec(0x1ad)](_0x5bbcec(0x1a7)+Object['keys'](_0x4e240e)[_0x5bbcec(0x163)]+_0x5bbcec(0x16e));const _0x3c8155=Object[_0x5bbcec(0x1ca)](_0x4e240e)[_0x5bbcec(0x1b0)](async([_0x3001ed,_0x1624fd])=>{const _0x1a5d47=_0x5bbcec;try{await database_1[_0x1a5d47(0x166)]['currencyRate']['upsert']({'where':{'currency':_0x3001ed[_0x1a5d47(0x190)]()},'update':{'rate':_0x1624fd},'create':{'currency':_0x3001ed[_0x1a5d47(0x190)](),'rate':_0x1624fd}});}catch(_0x5869ec){console['error'](_0x1a5d47(0x18f)+_0x3001ed+':',_0x5869ec);}});await Promise[_0x5bbcec(0x189)](_0x3c8155),console[_0x5bbcec(0x1ad)](_0x5bbcec(0x161));}catch(_0x2f4046){console[_0x5bbcec(0x1b9)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x2f4046);throw _0x2f4046;}}async[a38_0x56fc49(0x1a8)](_0x5a5f38){const _0x565d48=a38_0x56fc49,_0x1c8be8=_0x5a5f38[_0x565d48(0x190)]();if(_0x1c8be8==='usdt')return 0x1;try{const _0x11833b=await database_1['default']['currencyRate'][_0x565d48(0x17e)]({'where':{'currency':_0x1c8be8}});if(!_0x11833b)return console['warn'](_0x565d48(0x187)+_0x5a5f38+_0x565d48(0x158)),0x1;return _0x11833b[_0x565d48(0x194)];}catch(_0x55e8c7){return console[_0x565d48(0x1b9)](_0x565d48(0x182)+_0x5a5f38+':',_0x55e8c7),0x1;}}async[a38_0x56fc49(0x173)](_0x17c787,_0x19e4f6){const _0x2d46e0=a38_0x56fc49,_0x551ad4=_0x19e4f6[_0x2d46e0(0x190)]();if(_0x551ad4==='usdt'){const _0x43aed5=_0x17c787*(0x1+this[_0x2d46e0(0x17c)]/0x64);return console[_0x2d46e0(0x1ad)](_0x2d46e0(0x1c9)+this[_0x2d46e0(0x17c)]+_0x2d46e0(0x17f)+_0x17c787+'\x20USDT\x20=\x20'+_0x43aed5[_0x2d46e0(0x1b8)](0x6)+_0x2d46e0(0x178)),_0x43aed5;}try{const _0x32f446=await this[_0x2d46e0(0x1a8)](_0x551ad4),_0x3418dd=_0x17c787/_0x32f446,_0x49df3e=_0x3418dd*(0x1+this[_0x2d46e0(0x17c)]/0x64);return console['log']('💱\x20Converted\x20'+_0x17c787+'\x20'+_0x19e4f6['toUpperCase']()+_0x2d46e0(0x192)+_0x3418dd['toFixed'](0x6)+_0x2d46e0(0x180)+this['MARKUP_PERCENTAGE']+_0x2d46e0(0x1a6)+_0x49df3e[_0x2d46e0(0x1b8)](0x6)+_0x2d46e0(0x197)+_0x32f446+')'),_0x49df3e;}catch(_0xdfd424){console['error'](_0x2d46e0(0x175)+_0x17c787+'\x20'+_0x19e4f6+_0x2d46e0(0x15a),_0xdfd424);const _0x24114f=_0x17c787*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x24114f;}}async[a38_0x56fc49(0x1ac)](_0x60665a){const _0x3c27fa=a38_0x56fc49;let _0x439bf4=0x0;for(const {amount:_0x5c37e0,currency:_0x4d2fdd}of _0x60665a){const _0x45b3a0=await this[_0x3c27fa(0x173)](_0x5c37e0,_0x4d2fdd);_0x439bf4+=_0x45b3a0;}return _0x439bf4;}async[a38_0x56fc49(0x1c2)](){const _0x3570ee=a38_0x56fc49;try{const _0x291216=await database_1[_0x3570ee(0x166)][_0x3570ee(0x1a5)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x4637a0={'usdt':0x1};return _0x291216[_0x3570ee(0x18c)](_0x2cde77=>{const _0x121320=_0x3570ee;_0x4637a0[_0x2cde77[_0x121320(0x195)]]=_0x2cde77['rate'];}),_0x4637a0;}catch(_0x4a894f){return console[_0x3570ee(0x1b9)](_0x3570ee(0x15e),_0x4a894f),{'usdt':0x1};}}async['getRatesStatus'](){const _0x39a70a=a38_0x56fc49;try{const [_0x4b815d,_0x362569,_0x255d62]=await Promise[_0x39a70a(0x1b6)]([database_1[_0x39a70a(0x166)]['currencyRate'][_0x39a70a(0x1b2)](),database_1[_0x39a70a(0x166)]['currencyRate'][_0x39a70a(0x188)]({'orderBy':{'updatedAt':_0x39a70a(0x15b)},'select':{'updatedAt':!![]}}),database_1[_0x39a70a(0x166)]['currencyRate'][_0x39a70a(0x188)]({'orderBy':{'updatedAt':_0x39a70a(0x1c5)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4b815d,'lastUpdated':_0x362569?.[_0x39a70a(0x15c)]||null,'oldestRate':_0x255d62?.[_0x39a70a(0x15c)]||null,'markupPercentage':this[_0x39a70a(0x17c)]};}catch(_0x1fbc39){return console['error']('Error\x20getting\x20rates\x20status:',_0x1fbc39),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x39a70a(0x17c)]};}}[a38_0x56fc49(0x1a1)](){return this['MARKUP_PERCENTAGE'];}}function a38_0x2998(_0x4fe0ca,_0x3e2e62){const _0x26257b=a38_0x2625();return a38_0x2998=function(_0x29983f,_0x2758ec){_0x29983f=_0x29983f-0x153;let _0x45437d=_0x26257b[_0x29983f];return _0x45437d;},a38_0x2998(_0x4fe0ca,_0x3e2e62);}exports['CurrencyService']=CurrencyService,exports[a38_0x56fc49(0x183)]=new CurrencyService();