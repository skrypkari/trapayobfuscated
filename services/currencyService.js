'use strict';const a41_0x3a6df1=a41_0x69ef;function a41_0x5585(){const _0x1e789c=['eos','lkr','inr','\x20USDT\x20(rate:\x20','kwd','https://api.coingecko.com/api/v3/simple/price','sgd','pln','ngn','json','rate','CURRENCIES','cad','startPeriodicUpdates','currency','yfi','mmk','\x20to\x20','all','currencyService','tether','currencyRate','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','COINGECKO_URL','default','error','702284NENSKx','7920eDpJPO','vnd','✅\x20Currency\x20rates\x20updated\x20successfully','clp','1547726uWrjUc','try','thb','forEach','toLowerCase','keys','asc','length','count','xlm','2556NFyrEV','bits','30971960qulAGd','Periodic\x20currency\x20rates\x20update\x20failed:','xag','3ZeIPQx','\x20currencies','vef','MARKUP_PERCENTAGE','getCurrencyRate','Error\x20getting\x20all\x20rates:','\x20USDT,\x20with\x20','catch','14464368nTHNQy','dkk','dot','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','gbp','upsert','mxn','huf','xrp','cny','desc','updatedAt','usd','toUpperCase','php','link','map','../config/database','💱\x20Applied\x20','convertToUSDT','hkd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','log','xau','bmd','stopPeriodicUpdates','xdr','aed','toFixed','uah','updateCurrencyRates','pkr','convertMultipleToUSDT',',\x20using\x201\x20as\x20fallback','CurrencyService','ils','czk','TesSoft\x20Payment\x20System/1.0','Error\x20getting\x20rates\x20status:','16907148AVnwyq','gel','nok','getAllRates','updateInterval','myr','11476486oSFkhY','findUnique','📊\x20Received\x20rates\x20for\x20','sar','twd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','findFirst','No\x20rate\x20found\x20for\x20currency:\x20','sats','\x20USDT','nzd','\x20USDT\x20=\x20','1SxDKIk','__esModule','Error\x20getting\x20rate\x20for\x20currency\x20','eth','brl','usdt','%\x20markup\x20to\x20'];a41_0x5585=function(){return _0x1e789c;};return a41_0x5585();}(function(_0x27746a,_0x3e3c6c){const _0x267b60=a41_0x69ef,_0x810612=_0x27746a();while(!![]){try{const _0x4a4687=parseInt(_0x267b60(0x1f4))/0x1*(parseInt(_0x267b60(0x21a))/0x2)+-parseInt(_0x267b60(0x229))/0x3*(parseInt(_0x267b60(0x215))/0x4)+parseInt(_0x267b60(0x216))/0x5*(-parseInt(_0x267b60(0x224))/0x6)+parseInt(_0x267b60(0x1e8))/0x7+-parseInt(_0x267b60(0x231))/0x8+-parseInt(_0x267b60(0x1e2))/0x9+parseInt(_0x267b60(0x226))/0xa;if(_0x4a4687===_0x3e3c6c)break;else _0x810612['push'](_0x810612['shift']());}catch(_0x4d8f7b){_0x810612['push'](_0x810612['shift']());}}}(a41_0x5585,0xedb10));var __importDefault=this&&this['__importDefault']||function(_0x352fe2){const _0x4e26ea=a41_0x69ef;return _0x352fe2&&_0x352fe2[_0x4e26ea(0x1f5)]?_0x352fe2:{'default':_0x352fe2};};Object['defineProperty'](exports,a41_0x3a6df1(0x1f5),{'value':!![]}),exports[a41_0x3a6df1(0x20e)]=exports[a41_0x3a6df1(0x1dd)]=void 0x0;const database_1=__importDefault(require(a41_0x3a6df1(0x242)));class CurrencyService{constructor(){const _0x48703e=a41_0x3a6df1;this[_0x48703e(0x212)]=_0x48703e(0x200),this[_0x48703e(0x206)]=['btc',_0x48703e(0x1f7),'ltc','bch','bnb',_0x48703e(0x1fb),_0x48703e(0x239),_0x48703e(0x223),_0x48703e(0x240),_0x48703e(0x233),_0x48703e(0x20a),_0x48703e(0x23d),_0x48703e(0x1d6),'ars','aud','bdt','bhd',_0x48703e(0x1d3),_0x48703e(0x1f8),_0x48703e(0x207),'chf',_0x48703e(0x219),_0x48703e(0x23a),_0x48703e(0x1df),_0x48703e(0x232),'eur',_0x48703e(0x235),_0x48703e(0x1e3),_0x48703e(0x245),_0x48703e(0x238),'idr',_0x48703e(0x1de),_0x48703e(0x1fd),'jpy','krw',_0x48703e(0x1ff),_0x48703e(0x1fc),_0x48703e(0x20b),_0x48703e(0x237),_0x48703e(0x1e7),_0x48703e(0x203),_0x48703e(0x1e4),_0x48703e(0x1f2),_0x48703e(0x23f),_0x48703e(0x1da),_0x48703e(0x202),'rub',_0x48703e(0x1eb),'sek',_0x48703e(0x201),_0x48703e(0x21c),_0x48703e(0x21b),_0x48703e(0x1ec),_0x48703e(0x1d8),_0x48703e(0x22b),_0x48703e(0x217),'zar',_0x48703e(0x1d5),_0x48703e(0x228),_0x48703e(0x1d2),_0x48703e(0x225),_0x48703e(0x1f0)],this[_0x48703e(0x1e6)]=null,this[_0x48703e(0x22c)]=-0x3,this[_0x48703e(0x208)]();}['startPeriodicUpdates'](){const _0x8f1d17=a41_0x3a6df1;this[_0x8f1d17(0x1d9)]()[_0x8f1d17(0x230)](_0x3eefc1=>{const _0x32a8f6=_0x8f1d17;console[_0x32a8f6(0x214)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x3eefc1);}),this[_0x8f1d17(0x1e6)]=setInterval(async()=>{const _0x4307cd=_0x8f1d17;try{await this[_0x4307cd(0x1d9)]();}catch(_0x47ef03){console['error'](_0x4307cd(0x227),_0x47ef03);}},0x3c*0x3c*0x3e8),console['log'](_0x8f1d17(0x1ed));}[a41_0x3a6df1(0x1d4)](){const _0x3e14a7=a41_0x3a6df1;this['updateInterval']&&(clearInterval(this[_0x3e14a7(0x1e6)]),this[_0x3e14a7(0x1e6)]=null,console[_0x3e14a7(0x1d1)](_0x3e14a7(0x234)));}async[a41_0x3a6df1(0x1d9)](){const _0xbb8f3f=a41_0x3a6df1;try{console[_0xbb8f3f(0x1d1)](_0xbb8f3f(0x211));const _0xa3f18c=this[_0xbb8f3f(0x206)]['join'](','),_0x7eaf55=this[_0xbb8f3f(0x212)]+'?ids=tether&vs_currencies='+_0xa3f18c,_0x52206d=await fetch(_0x7eaf55,{'headers':{'Accept':'application/json','User-Agent':_0xbb8f3f(0x1e0)}});if(!_0x52206d['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x52206d['status']+'\x20'+_0x52206d['statusText']);const _0x1ece96=await _0x52206d[_0xbb8f3f(0x204)]();if(!_0x1ece96[_0xbb8f3f(0x20f)])throw new Error(_0xbb8f3f(0x246));const _0x539859=_0x1ece96['tether'];console[_0xbb8f3f(0x1d1)](_0xbb8f3f(0x1ea)+Object[_0xbb8f3f(0x21f)](_0x539859)[_0xbb8f3f(0x221)]+_0xbb8f3f(0x22a));const _0x76ee29=Object['entries'](_0x539859)[_0xbb8f3f(0x241)](async([_0x3f1032,_0x5d3a47])=>{const _0x1d3306=_0xbb8f3f;try{await database_1[_0x1d3306(0x213)][_0x1d3306(0x210)][_0x1d3306(0x236)]({'where':{'currency':_0x3f1032[_0x1d3306(0x21e)]()},'update':{'rate':_0x5d3a47},'create':{'currency':_0x3f1032[_0x1d3306(0x21e)](),'rate':_0x5d3a47}});}catch(_0x59a4b1){console[_0x1d3306(0x214)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x3f1032+':',_0x59a4b1);}});await Promise['allSettled'](_0x76ee29),console[_0xbb8f3f(0x1d1)](_0xbb8f3f(0x218));}catch(_0x4a5edb){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x4a5edb);throw _0x4a5edb;}}async[a41_0x3a6df1(0x22d)](_0x56b46f){const _0x2793ab=a41_0x3a6df1,_0xd426a6=_0x56b46f[_0x2793ab(0x21e)]();if(_0xd426a6===_0x2793ab(0x1f9))return 0x1;try{const _0x4a2658=await database_1[_0x2793ab(0x213)]['currencyRate'][_0x2793ab(0x1e9)]({'where':{'currency':_0xd426a6}});if(!_0x4a2658)return console['warn'](_0x2793ab(0x1ef)+_0x56b46f+_0x2793ab(0x1dc)),0x1;return _0x4a2658[_0x2793ab(0x205)];}catch(_0x4bd768){return console[_0x2793ab(0x214)](_0x2793ab(0x1f6)+_0x56b46f+':',_0x4bd768),0x1;}}async['convertToUSDT'](_0x30fe7a,_0x13df82){const _0x478d5=a41_0x3a6df1,_0x1d78b6=_0x13df82[_0x478d5(0x21e)]();if(_0x1d78b6===_0x478d5(0x1f9)){const _0x5cd567=_0x30fe7a*(0x1+this[_0x478d5(0x22c)]/0x64);return console[_0x478d5(0x1d1)](_0x478d5(0x243)+this[_0x478d5(0x22c)]+_0x478d5(0x1fa)+_0x30fe7a+_0x478d5(0x1f3)+_0x5cd567[_0x478d5(0x1d7)](0x6)+_0x478d5(0x1f1)),_0x5cd567;}try{const _0x28dbee=await this['getCurrencyRate'](_0x1d78b6),_0xeb78ed=_0x30fe7a/_0x28dbee,_0x3c6aab=_0xeb78ed*(0x1+this[_0x478d5(0x22c)]/0x64);return console[_0x478d5(0x1d1)]('💱\x20Converted\x20'+_0x30fe7a+'\x20'+_0x13df82[_0x478d5(0x23e)]()+_0x478d5(0x20c)+_0xeb78ed[_0x478d5(0x1d7)](0x6)+_0x478d5(0x22f)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x3c6aab['toFixed'](0x6)+_0x478d5(0x1fe)+_0x28dbee+')'),_0x3c6aab;}catch(_0x3bac81){console[_0x478d5(0x214)]('Error\x20converting\x20'+_0x30fe7a+'\x20'+_0x13df82+'\x20to\x20USDT:',_0x3bac81);const _0x514d74=_0x30fe7a*(0x1+this[_0x478d5(0x22c)]/0x64);return _0x514d74;}}async[a41_0x3a6df1(0x1db)](_0x4ce885){const _0x493165=a41_0x3a6df1;let _0x54e5ab=0x0;for(const {amount:_0x14527d,currency:_0x315e79}of _0x4ce885){const _0x254d40=await this[_0x493165(0x244)](_0x14527d,_0x315e79);_0x54e5ab+=_0x254d40;}return _0x54e5ab;}async[a41_0x3a6df1(0x1e5)](){const _0xc000bf=a41_0x3a6df1;try{const _0x2ddbb8=await database_1[_0xc000bf(0x213)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1b60c5={'usdt':0x1};return _0x2ddbb8[_0xc000bf(0x21d)](_0x57a525=>{const _0x1cca68=_0xc000bf;_0x1b60c5[_0x57a525[_0x1cca68(0x209)]]=_0x57a525[_0x1cca68(0x205)];}),_0x1b60c5;}catch(_0x547e32){return console[_0xc000bf(0x214)](_0xc000bf(0x22e),_0x547e32),{'usdt':0x1};}}async['getRatesStatus'](){const _0x1dd6c9=a41_0x3a6df1;try{const [_0x2ea148,_0x3ce8a0,_0x529776]=await Promise[_0x1dd6c9(0x20d)]([database_1[_0x1dd6c9(0x213)][_0x1dd6c9(0x210)][_0x1dd6c9(0x222)](),database_1['default'][_0x1dd6c9(0x210)][_0x1dd6c9(0x1ee)]({'orderBy':{'updatedAt':_0x1dd6c9(0x23b)},'select':{'updatedAt':!![]}}),database_1[_0x1dd6c9(0x213)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x1dd6c9(0x220)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2ea148,'lastUpdated':_0x3ce8a0?.['updatedAt']||null,'oldestRate':_0x529776?.[_0x1dd6c9(0x23c)]||null,'markupPercentage':this[_0x1dd6c9(0x22c)]};}catch(_0x47e917){return console['error'](_0x1dd6c9(0x1e1),_0x47e917),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1dd6c9(0x22c)]};}}['getMarkupPercentage'](){const _0x45c620=a41_0x3a6df1;return this[_0x45c620(0x22c)];}}function a41_0x69ef(_0x10d67a,_0x39223e){const _0x5585ba=a41_0x5585();return a41_0x69ef=function(_0x69ef52,_0x17eac4){_0x69ef52=_0x69ef52-0x1d1;let _0xce5e4c=_0x5585ba[_0x69ef52];return _0xce5e4c;},a41_0x69ef(_0x10d67a,_0x39223e);}exports['CurrencyService']=CurrencyService,exports[a41_0x3a6df1(0x20e)]=new CurrencyService();