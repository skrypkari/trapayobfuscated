'use strict';const a39_0x5ef7e4=a39_0x54ce;(function(_0x3d3cf7,_0x57b3b6){const _0x56a5d2=a39_0x54ce,_0x2a58a8=_0x3d3cf7();while(!![]){try{const _0x6f2be4=parseInt(_0x56a5d2(0xf8))/0x1+-parseInt(_0x56a5d2(0xd6))/0x2*(parseInt(_0x56a5d2(0xe6))/0x3)+-parseInt(_0x56a5d2(0x10a))/0x4*(-parseInt(_0x56a5d2(0xc3))/0x5)+-parseInt(_0x56a5d2(0xf6))/0x6*(-parseInt(_0x56a5d2(0xea))/0x7)+parseInt(_0x56a5d2(0xbe))/0x8*(parseInt(_0x56a5d2(0xbf))/0x9)+parseInt(_0x56a5d2(0xbb))/0xa+-parseInt(_0x56a5d2(0xc0))/0xb;if(_0x6f2be4===_0x57b3b6)break;else _0x2a58a8['push'](_0x2a58a8['shift']());}catch(_0x17470f){_0x2a58a8['push'](_0x2a58a8['shift']());}}}(a39_0x161e,0x5b4c4));function a39_0x161e(){const _0x48ed0a=['kwd','dkk','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','pkr','allSettled','No\x20rate\x20found\x20for\x20currency:\x20','Error\x20converting\x20','chf','log','124SgrAiO','bdt','count','usd','💱\x20Converted\x20','sar','__importDefault','xlm','warn','application/json','?ids=tether&vs_currencies=','catch','yfi','vnd','huf','CurrencyService','32061CfDaVQ','nzd','dot','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','7SOqKfq','gel','Failed\x20to\x20update\x20rate\x20for\x20','entries','jpy','currencyRate','xdr','MARKUP_PERCENTAGE','sats','CoinGecko\x20API\x20error:\x20','cad','gbp','4344366UgxPxg','💱\x20Applied\x20','523844JJlUZC','myr','Error\x20getting\x20all\x20rates:','rate','currencyService','bmd','xau','nok','eur','inr','bnb','ils','vef','lkr','mmk','czk','findFirst','link','729788TncyxC','default','xrp','updatedAt','__esModule','json','../config/database','ngn','📊\x20Received\x20rates\x20for\x20','toFixed','map','%\x20markup\x20=\x20','Initial\x20currency\x20rates\x20update\x20failed:','\x20USDT\x20=\x20','btc','eos','length','usdt','error','stopPeriodicUpdates','updateCurrencyRates','findUnique','❌\x20Failed\x20to\x20update\x20currency\x20rates:','aud','getCurrencyRate','status','sek','COINGECKO_URL','\x20to\x20USDT:','tether','uah','%\x20markup\x20to\x20','https://api.coingecko.com/api/v3/simple/price','updateInterval','zar','ltc','startPeriodicUpdates','thb','toUpperCase','ars','aed','desc','findMany','statusText','Periodic\x20currency\x20rates\x20update\x20failed:','3766410xFzVfD','asc','pln','36272tGMFBr','918BbgDJp','17575855LWpPAG','eth','clp','15CaWNao','\x20to\x20','TesSoft\x20Payment\x20System/1.0','Error\x20getting\x20rates\x20status:','rub','\x20USDT\x20(rate:\x20','defineProperty','krw','CURRENCIES','toLowerCase'];a39_0x161e=function(){return _0x48ed0a;};return a39_0x161e();}var __importDefault=this&&this[a39_0x5ef7e4(0xdc)]||function(_0x4f3203){const _0x2598ff=a39_0x5ef7e4;return _0x4f3203&&_0x4f3203[_0x2598ff(0x10e)]?_0x4f3203:{'default':_0x4f3203};};Object[a39_0x5ef7e4(0xc9)](exports,a39_0x5ef7e4(0x10e),{'value':!![]}),exports[a39_0x5ef7e4(0xfc)]=exports[a39_0x5ef7e4(0xe5)]=void 0x0;function a39_0x54ce(_0x204360,_0x497cfb){const _0x161ebf=a39_0x161e();return a39_0x54ce=function(_0x54ce93,_0x468082){_0x54ce93=_0x54ce93-0xb6;let _0x4fe1f4=_0x161ebf[_0x54ce93];return _0x4fe1f4;},a39_0x54ce(_0x204360,_0x497cfb);}const database_1=__importDefault(require(a39_0x5ef7e4(0x110)));class CurrencyService{constructor(){const _0x31d8d5=a39_0x5ef7e4;this[_0x31d8d5(0x125)]=_0x31d8d5(0x12a),this['CURRENCIES']=[_0x31d8d5(0x118),_0x31d8d5(0xc1),_0x31d8d5(0x12d),'bch',_0x31d8d5(0x102),_0x31d8d5(0x119),_0x31d8d5(0x10c),_0x31d8d5(0xdd),_0x31d8d5(0x109),_0x31d8d5(0xe8),_0x31d8d5(0xe2),_0x31d8d5(0xd9),_0x31d8d5(0xb6),_0x31d8d5(0x131),_0x31d8d5(0x121),_0x31d8d5(0xd7),'bhd',_0x31d8d5(0xfd),'brl',_0x31d8d5(0xf4),_0x31d8d5(0xd4),_0x31d8d5(0xc2),'cny',_0x31d8d5(0x107),_0x31d8d5(0xce),_0x31d8d5(0x100),_0x31d8d5(0xf5),_0x31d8d5(0xeb),'hkd',_0x31d8d5(0xe4),'idr',_0x31d8d5(0x103),_0x31d8d5(0x101),_0x31d8d5(0xee),_0x31d8d5(0xca),_0x31d8d5(0xcd),_0x31d8d5(0x105),_0x31d8d5(0x106),'mxn',_0x31d8d5(0xf9),_0x31d8d5(0x111),_0x31d8d5(0xff),_0x31d8d5(0xe7),'php',_0x31d8d5(0xd0),_0x31d8d5(0xbd),_0x31d8d5(0xc7),_0x31d8d5(0xdb),_0x31d8d5(0x124),'sgd',_0x31d8d5(0x12f),'try','twd',_0x31d8d5(0x128),_0x31d8d5(0x104),_0x31d8d5(0xe3),_0x31d8d5(0x12c),_0x31d8d5(0xf0),'xag',_0x31d8d5(0xfe),'bits',_0x31d8d5(0xf2)],this[_0x31d8d5(0x12b)]=null,this[_0x31d8d5(0xf1)]=0x3,this[_0x31d8d5(0x12e)]();}[a39_0x5ef7e4(0x12e)](){const _0x2cabff=a39_0x5ef7e4;this[_0x2cabff(0x11e)]()[_0x2cabff(0xe1)](_0x23188c=>{const _0x17b2ed=_0x2cabff;console[_0x17b2ed(0x11c)](_0x17b2ed(0x116),_0x23188c);}),this[_0x2cabff(0x12b)]=setInterval(async()=>{const _0x54e735=_0x2cabff;try{await this[_0x54e735(0x11e)]();}catch(_0x308066){console['error'](_0x54e735(0xba),_0x308066);}},0x3c*0x3c*0x3e8),console[_0x2cabff(0xd5)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x5ef7e4(0x11d)](){const _0xa91a0e=a39_0x5ef7e4;this[_0xa91a0e(0x12b)]&&(clearInterval(this[_0xa91a0e(0x12b)]),this[_0xa91a0e(0x12b)]=null,console[_0xa91a0e(0xd5)](_0xa91a0e(0xcf)));}async['updateCurrencyRates'](){const _0x139831=a39_0x5ef7e4;try{console['log'](_0x139831(0xe9));const _0x1377e3=this[_0x139831(0xcb)]['join'](','),_0x526b3e=this[_0x139831(0x125)]+_0x139831(0xe0)+_0x1377e3,_0x11109e=await fetch(_0x526b3e,{'headers':{'Accept':_0x139831(0xdf),'User-Agent':_0x139831(0xc5)}});if(!_0x11109e['ok'])throw new Error(_0x139831(0xf3)+_0x11109e[_0x139831(0x123)]+'\x20'+_0x11109e[_0x139831(0xb9)]);const _0x473596=await _0x11109e[_0x139831(0x10f)]();if(!_0x473596['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x4cd18c=_0x473596[_0x139831(0x127)];console[_0x139831(0xd5)](_0x139831(0x112)+Object['keys'](_0x4cd18c)[_0x139831(0x11a)]+'\x20currencies');const _0x376829=Object[_0x139831(0xed)](_0x4cd18c)[_0x139831(0x114)](async([_0x53bee0,_0x524311])=>{const _0x10b6fb=_0x139831;try{await database_1[_0x10b6fb(0x10b)][_0x10b6fb(0xef)]['upsert']({'where':{'currency':_0x53bee0[_0x10b6fb(0xcc)]()},'update':{'rate':_0x524311},'create':{'currency':_0x53bee0[_0x10b6fb(0xcc)](),'rate':_0x524311}});}catch(_0x52ee71){console[_0x10b6fb(0x11c)](_0x10b6fb(0xec)+_0x53bee0+':',_0x52ee71);}});await Promise[_0x139831(0xd1)](_0x376829),console[_0x139831(0xd5)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x7ff822){console[_0x139831(0x11c)](_0x139831(0x120),_0x7ff822);throw _0x7ff822;}}async[a39_0x5ef7e4(0x122)](_0x1bde93){const _0x223c41=a39_0x5ef7e4,_0x2190a5=_0x1bde93[_0x223c41(0xcc)]();if(_0x2190a5==='usdt')return 0x1;try{const _0x5c1fd0=await database_1[_0x223c41(0x10b)][_0x223c41(0xef)][_0x223c41(0x11f)]({'where':{'currency':_0x2190a5}});if(!_0x5c1fd0)return console[_0x223c41(0xde)](_0x223c41(0xd2)+_0x1bde93+',\x20using\x201\x20as\x20fallback'),0x1;return _0x5c1fd0[_0x223c41(0xfb)];}catch(_0x20397f){return console[_0x223c41(0x11c)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1bde93+':',_0x20397f),0x1;}}async['convertToUSDT'](_0x2bd26a,_0x52b0f5){const _0x11eaa1=a39_0x5ef7e4,_0x20d3af=_0x52b0f5[_0x11eaa1(0xcc)]();if(_0x20d3af===_0x11eaa1(0x11b)){const _0xb3db73=_0x2bd26a*(0x1+this[_0x11eaa1(0xf1)]/0x64);return console[_0x11eaa1(0xd5)](_0x11eaa1(0xf7)+this[_0x11eaa1(0xf1)]+_0x11eaa1(0x129)+_0x2bd26a+_0x11eaa1(0x117)+_0xb3db73['toFixed'](0x6)+'\x20USDT'),_0xb3db73;}try{const _0xe64cb0=await this[_0x11eaa1(0x122)](_0x20d3af),_0x5a3b0f=_0x2bd26a/_0xe64cb0,_0x1e67bf=_0x5a3b0f*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x11eaa1(0xda)+_0x2bd26a+'\x20'+_0x52b0f5[_0x11eaa1(0x130)]()+_0x11eaa1(0xc4)+_0x5a3b0f[_0x11eaa1(0x113)](0x6)+'\x20USDT,\x20with\x20'+this[_0x11eaa1(0xf1)]+_0x11eaa1(0x115)+_0x1e67bf['toFixed'](0x6)+_0x11eaa1(0xc8)+_0xe64cb0+')'),_0x1e67bf;}catch(_0x2a22e3){console['error'](_0x11eaa1(0xd3)+_0x2bd26a+'\x20'+_0x52b0f5+_0x11eaa1(0x126),_0x2a22e3);const _0x259bc9=_0x2bd26a*(0x1+this[_0x11eaa1(0xf1)]/0x64);return _0x259bc9;}}async['convertMultipleToUSDT'](_0x285ae3){let _0x176f25=0x0;for(const {amount:_0x3c2458,currency:_0x3245a2}of _0x285ae3){const _0x481c3e=await this['convertToUSDT'](_0x3c2458,_0x3245a2);_0x176f25+=_0x481c3e;}return _0x176f25;}async['getAllRates'](){const _0x43ac84=a39_0x5ef7e4;try{const _0x2871aa=await database_1['default']['currencyRate'][_0x43ac84(0xb8)]({'select':{'currency':!![],'rate':!![]}}),_0x4eead9={'usdt':0x1};return _0x2871aa['forEach'](_0x1a0954=>{const _0x4567ad=_0x43ac84;_0x4eead9[_0x1a0954['currency']]=_0x1a0954[_0x4567ad(0xfb)];}),_0x4eead9;}catch(_0x2de021){return console['error'](_0x43ac84(0xfa),_0x2de021),{'usdt':0x1};}}async['getRatesStatus'](){const _0x362810=a39_0x5ef7e4;try{const [_0x95f5e0,_0x3c0d4f,_0x34094c]=await Promise['all']([database_1[_0x362810(0x10b)][_0x362810(0xef)][_0x362810(0xd8)](),database_1[_0x362810(0x10b)]['currencyRate'][_0x362810(0x108)]({'orderBy':{'updatedAt':_0x362810(0xb7)},'select':{'updatedAt':!![]}}),database_1[_0x362810(0x10b)][_0x362810(0xef)][_0x362810(0x108)]({'orderBy':{'updatedAt':_0x362810(0xbc)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x95f5e0,'lastUpdated':_0x3c0d4f?.['updatedAt']||null,'oldestRate':_0x34094c?.[_0x362810(0x10d)]||null,'markupPercentage':this[_0x362810(0xf1)]};}catch(_0x16a005){return console[_0x362810(0x11c)](_0x362810(0xc6),_0x16a005),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x362810(0xf1)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports[a39_0x5ef7e4(0xe5)]=CurrencyService,exports['currencyService']=new CurrencyService();