'use strict';const a36_0x5145c8=a36_0x5cdb;(function(_0x123e0b,_0x2deb6e){const _0x386182=a36_0x5cdb,_0x11d12d=_0x123e0b();while(!![]){try{const _0x5bd094=-parseInt(_0x386182(0x203))/0x1*(parseInt(_0x386182(0x241))/0x2)+-parseInt(_0x386182(0x1ec))/0x3*(-parseInt(_0x386182(0x20f))/0x4)+-parseInt(_0x386182(0x20c))/0x5*(parseInt(_0x386182(0x223))/0x6)+parseInt(_0x386182(0x1fe))/0x7*(-parseInt(_0x386182(0x1f9))/0x8)+parseInt(_0x386182(0x23e))/0x9+parseInt(_0x386182(0x1d6))/0xa*(parseInt(_0x386182(0x225))/0xb)+-parseInt(_0x386182(0x236))/0xc;if(_0x5bd094===_0x2deb6e)break;else _0x11d12d['push'](_0x11d12d['shift']());}catch(_0x5c9cf9){_0x11d12d['push'](_0x11d12d['shift']());}}}(a36_0x2285,0xa60a2));function a36_0x5cdb(_0x5bf989,_0x3047da){const _0x228591=a36_0x2285();return a36_0x5cdb=function(_0x5cdbbc,_0x457c69){_0x5cdbbc=_0x5cdbbc-0x1cd;let _0x15a38b=_0x228591[_0x5cdbbc];return _0x15a38b;},a36_0x5cdb(_0x5bf989,_0x3047da);}var __importDefault=this&&this[a36_0x5145c8(0x244)]||function(_0x2f9802){const _0x4ae5ef=a36_0x5145c8;return _0x2f9802&&_0x2f9802[_0x4ae5ef(0x238)]?_0x2f9802:{'default':_0x2f9802};};function a36_0x2285(){const _0x4e5a54=['eur','xrp','kwd','application/json','Error\x20getting\x20all\x20rates:','btc','No\x20rate\x20found\x20for\x20currency:\x20','join','getRatesStatus','status','count','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','✅\x20Currency\x20rates\x20updated\x20successfully','\x20USDT\x20(rate:\x20','4521HykunT','\x20USDT,\x20with\x20','toFixed','getMarkupPercentage','dkk','pln','cny','vnd','clp','myr','Initial\x20currency\x20rates\x20update\x20failed:','getCurrencyRate','COINGECKO_URL','184aJlSGv','\x20currencies','php','startPeriodicUpdates','updateCurrencyRates','411880JmDFaQ','getAllRates','aud','error','findUnique','6824pRTOLH','xau','?ids=tether&vs_currencies=','toLowerCase','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','../config/database','Error\x20getting\x20rates\x20status:','sats','nok','5kwWrfj','yfi','tether','3512UUDaCF','bits','eos','vef','idr','pkr','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','all','❌\x20Failed\x20to\x20update\x20currency\x20rates:','statusText','MARKUP_PERCENTAGE','entries','convertMultipleToUSDT','Error\x20converting\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','updatedAt','Failed\x20to\x20update\x20rate\x20for\x20','hkd','findMany','forEach','748740EpDMPv','rate','11sVDSlK','bhd','\x20USDT','link','bdt','CoinGecko\x20API\x20error:\x20','https://api.coingecko.com/api/v3/simple/price','Error\x20getting\x20rate\x20for\x20currency\x20','findFirst','mxn','currencyRate','default','rub','sek','usdt','allSettled','convertToUSDT','8809320yvuvpL','%\x20markup\x20=\x20','__esModule','currency','gel','CurrencyService','currencyService','bnb','9641493KexyNs','brl','sar','202xQkbjy','huf','defineProperty','__importDefault','xag','krw','aed','upsert','sgd','warn','uah','💱\x20Converted\x20','ars','length','json','jpy','stopPeriodicUpdates','czk','11871190JqZPmb','twd','try','updateInterval','log','📊\x20Received\x20rates\x20for\x20','bch','keys'];a36_0x2285=function(){return _0x4e5a54;};return a36_0x2285();}Object[a36_0x5145c8(0x243)](exports,a36_0x5145c8(0x238),{'value':!![]}),exports[a36_0x5145c8(0x23c)]=exports[a36_0x5145c8(0x23b)]=void 0x0;const database_1=__importDefault(require(a36_0x5145c8(0x208)));class CurrencyService{constructor(){const _0x2fe2b3=a36_0x5145c8;this[_0x2fe2b3(0x1f8)]=_0x2fe2b3(0x22b),this['CURRENCIES']=[_0x2fe2b3(0x1e3),'eth','ltc',_0x2fe2b3(0x1dc),_0x2fe2b3(0x23d),_0x2fe2b3(0x211),_0x2fe2b3(0x1df),'xlm',_0x2fe2b3(0x228),'dot',_0x2fe2b3(0x20d),'usd',_0x2fe2b3(0x247),_0x2fe2b3(0x1d0),_0x2fe2b3(0x200),_0x2fe2b3(0x229),_0x2fe2b3(0x226),'bmd',_0x2fe2b3(0x23f),'cad','chf',_0x2fe2b3(0x1f4),_0x2fe2b3(0x1f2),_0x2fe2b3(0x1d5),_0x2fe2b3(0x1f0),_0x2fe2b3(0x1de),'gbp',_0x2fe2b3(0x23a),_0x2fe2b3(0x220),_0x2fe2b3(0x242),_0x2fe2b3(0x213),'ils','inr',_0x2fe2b3(0x1d3),_0x2fe2b3(0x246),_0x2fe2b3(0x1e0),'lkr','mmk',_0x2fe2b3(0x22e),_0x2fe2b3(0x1f5),'ngn',_0x2fe2b3(0x20b),'nzd',_0x2fe2b3(0x1fb),_0x2fe2b3(0x214),_0x2fe2b3(0x1f1),_0x2fe2b3(0x231),_0x2fe2b3(0x240),_0x2fe2b3(0x232),_0x2fe2b3(0x249),'thb',_0x2fe2b3(0x1d8),_0x2fe2b3(0x1d7),_0x2fe2b3(0x1ce),_0x2fe2b3(0x212),_0x2fe2b3(0x1f3),'zar','xdr',_0x2fe2b3(0x245),_0x2fe2b3(0x204),_0x2fe2b3(0x210),_0x2fe2b3(0x20a)],this[_0x2fe2b3(0x1d9)]=null,this[_0x2fe2b3(0x219)]=0x3,this[_0x2fe2b3(0x1fc)]();}[a36_0x5145c8(0x1fc)](){const _0x473d97=a36_0x5145c8;this[_0x473d97(0x1fd)]()['catch'](_0xd9be3d=>{const _0x5ba955=_0x473d97;console['error'](_0x5ba955(0x1f6),_0xd9be3d);}),this['updateInterval']=setInterval(async()=>{try{await this['updateCurrencyRates']();}catch(_0x37426f){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x37426f);}},0x3c*0x3c*0x3e8),console[_0x473d97(0x1da)](_0x473d97(0x207));}[a36_0x5145c8(0x1d4)](){const _0x3a0126=a36_0x5145c8;this[_0x3a0126(0x1d9)]&&(clearInterval(this['updateInterval']),this[_0x3a0126(0x1d9)]=null,console[_0x3a0126(0x1da)](_0x3a0126(0x215)));}async['updateCurrencyRates'](){const _0x18e44d=a36_0x5145c8;try{console[_0x18e44d(0x1da)](_0x18e44d(0x21d));const _0x4af622=this['CURRENCIES'][_0x18e44d(0x1e5)](','),_0x29072b=this['COINGECKO_URL']+_0x18e44d(0x205)+_0x4af622,_0xff95fd=await fetch(_0x29072b,{'headers':{'Accept':_0x18e44d(0x1e1),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0xff95fd['ok'])throw new Error(_0x18e44d(0x22a)+_0xff95fd[_0x18e44d(0x1e7)]+'\x20'+_0xff95fd[_0x18e44d(0x218)]);const _0x3f87b3=await _0xff95fd[_0x18e44d(0x1d2)]();if(!_0x3f87b3[_0x18e44d(0x20e)])throw new Error(_0x18e44d(0x1e9));const _0x4dffda=_0x3f87b3[_0x18e44d(0x20e)];console[_0x18e44d(0x1da)](_0x18e44d(0x1db)+Object[_0x18e44d(0x1dd)](_0x4dffda)[_0x18e44d(0x1d1)]+_0x18e44d(0x1fa));const _0x3010c7=Object[_0x18e44d(0x21a)](_0x4dffda)['map'](async([_0x170de9,_0x289518])=>{const _0x4f6eba=_0x18e44d;try{await database_1[_0x4f6eba(0x230)]['currencyRate'][_0x4f6eba(0x248)]({'where':{'currency':_0x170de9[_0x4f6eba(0x206)]()},'update':{'rate':_0x289518},'create':{'currency':_0x170de9[_0x4f6eba(0x206)](),'rate':_0x289518}});}catch(_0x2b2c05){console[_0x4f6eba(0x201)](_0x4f6eba(0x21f)+_0x170de9+':',_0x2b2c05);}});await Promise[_0x18e44d(0x234)](_0x3010c7),console[_0x18e44d(0x1da)](_0x18e44d(0x1ea));}catch(_0x455f3b){console['error'](_0x18e44d(0x217),_0x455f3b);throw _0x455f3b;}}async['getCurrencyRate'](_0x36c7d3){const _0x2ce657=a36_0x5145c8,_0x46ad5d=_0x36c7d3[_0x2ce657(0x206)]();if(_0x46ad5d===_0x2ce657(0x233))return 0x1;try{const _0x14140a=await database_1['default'][_0x2ce657(0x22f)][_0x2ce657(0x202)]({'where':{'currency':_0x46ad5d}});if(!_0x14140a)return console[_0x2ce657(0x1cd)](_0x2ce657(0x1e4)+_0x36c7d3+',\x20using\x201\x20as\x20fallback'),0x1;return _0x14140a[_0x2ce657(0x224)];}catch(_0x546c0b){return console[_0x2ce657(0x201)](_0x2ce657(0x22c)+_0x36c7d3+':',_0x546c0b),0x1;}}async[a36_0x5145c8(0x235)](_0x4578a5,_0xcac7e2){const _0x3e341b=a36_0x5145c8,_0x4bc1d8=_0xcac7e2[_0x3e341b(0x206)]();if(_0x4bc1d8===_0x3e341b(0x233)){const _0x4ea39e=_0x4578a5*(0x1+this[_0x3e341b(0x219)]/0x64);return console[_0x3e341b(0x1da)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x4578a5+'\x20USDT\x20=\x20'+_0x4ea39e['toFixed'](0x6)+_0x3e341b(0x227)),_0x4ea39e;}try{const _0x1705f9=await this[_0x3e341b(0x1f7)](_0x4bc1d8),_0x19aa56=_0x4578a5/_0x1705f9,_0x58ece4=_0x19aa56*(0x1+this[_0x3e341b(0x219)]/0x64);return console[_0x3e341b(0x1da)](_0x3e341b(0x1cf)+_0x4578a5+'\x20'+_0xcac7e2['toUpperCase']()+'\x20to\x20'+_0x19aa56[_0x3e341b(0x1ee)](0x6)+_0x3e341b(0x1ed)+this[_0x3e341b(0x219)]+_0x3e341b(0x237)+_0x58ece4['toFixed'](0x6)+_0x3e341b(0x1eb)+_0x1705f9+')'),_0x58ece4;}catch(_0x578d71){console[_0x3e341b(0x201)](_0x3e341b(0x21c)+_0x4578a5+'\x20'+_0xcac7e2+'\x20to\x20USDT:',_0x578d71);const _0x3ef061=_0x4578a5*(0x1+this[_0x3e341b(0x219)]/0x64);return _0x3ef061;}}async[a36_0x5145c8(0x21b)](_0x2bcab6){const _0x5c4743=a36_0x5145c8;let _0x4ced64=0x0;for(const {amount:_0x17f0c9,currency:_0x6ac22d}of _0x2bcab6){const _0x20c2e8=await this[_0x5c4743(0x235)](_0x17f0c9,_0x6ac22d);_0x4ced64+=_0x20c2e8;}return _0x4ced64;}async[a36_0x5145c8(0x1ff)](){const _0x257194=a36_0x5145c8;try{const _0x2295d4=await database_1[_0x257194(0x230)]['currencyRate'][_0x257194(0x221)]({'select':{'currency':!![],'rate':!![]}}),_0x2d27e9={'usdt':0x1};return _0x2295d4[_0x257194(0x222)](_0x5d364d=>{const _0x2f8fcf=_0x257194;_0x2d27e9[_0x5d364d[_0x2f8fcf(0x239)]]=_0x5d364d[_0x2f8fcf(0x224)];}),_0x2d27e9;}catch(_0x49c03b){return console[_0x257194(0x201)](_0x257194(0x1e2),_0x49c03b),{'usdt':0x1};}}async[a36_0x5145c8(0x1e6)](){const _0xb8a045=a36_0x5145c8;try{const [_0x4f8cad,_0x58b0e1,_0x1e3bbd]=await Promise[_0xb8a045(0x216)]([database_1[_0xb8a045(0x230)][_0xb8a045(0x22f)][_0xb8a045(0x1e8)](),database_1['default']['currencyRate'][_0xb8a045(0x22d)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0xb8a045(0x230)]['currencyRate'][_0xb8a045(0x22d)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4f8cad,'lastUpdated':_0x58b0e1?.[_0xb8a045(0x21e)]||null,'oldestRate':_0x1e3bbd?.['updatedAt']||null,'markupPercentage':this[_0xb8a045(0x219)]};}catch(_0x5b2d03){return console[_0xb8a045(0x201)](_0xb8a045(0x209),_0x5b2d03),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a36_0x5145c8(0x1ef)](){const _0x96e15b=a36_0x5145c8;return this[_0x96e15b(0x219)];}}exports[a36_0x5145c8(0x23b)]=CurrencyService,exports[a36_0x5145c8(0x23c)]=new CurrencyService();