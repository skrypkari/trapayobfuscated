'use strict';const a38_0x192eb=a38_0xb80d;(function(_0x5be00a,_0x1c1224){const _0x5485ad=a38_0xb80d,_0x38e20e=_0x5be00a();while(!![]){try{const _0x548d06=-parseInt(_0x5485ad(0x16f))/0x1+parseInt(_0x5485ad(0x190))/0x2*(-parseInt(_0x5485ad(0x1c6))/0x3)+parseInt(_0x5485ad(0x175))/0x4*(parseInt(_0x5485ad(0x17b))/0x5)+parseInt(_0x5485ad(0x18b))/0x6*(parseInt(_0x5485ad(0x19b))/0x7)+parseInt(_0x5485ad(0x17e))/0x8+-parseInt(_0x5485ad(0x1a0))/0x9*(parseInt(_0x5485ad(0x181))/0xa)+-parseInt(_0x5485ad(0x199))/0xb*(-parseInt(_0x5485ad(0x168))/0xc);if(_0x548d06===_0x1c1224)break;else _0x38e20e['push'](_0x38e20e['shift']());}catch(_0x571d8c){_0x38e20e['push'](_0x38e20e['shift']());}}}(a38_0xfe26,0x89fae));var __importDefault=this&&this[a38_0x192eb(0x1ad)]||function(_0x1cc7b4){const _0x367ccd=a38_0x192eb;return _0x1cc7b4&&_0x1cc7b4[_0x367ccd(0x1b5)]?_0x1cc7b4:{'default':_0x1cc7b4};};Object[a38_0x192eb(0x18a)](exports,a38_0x192eb(0x1b5),{'value':!![]}),exports[a38_0x192eb(0x1b1)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x192eb(0x156)));class CurrencyService{constructor(){const _0x26bde4=a38_0x192eb;this[_0x26bde4(0x1ca)]=_0x26bde4(0x191),this[_0x26bde4(0x180)]=[_0x26bde4(0x18c),_0x26bde4(0x1c7),_0x26bde4(0x16d),'bch',_0x26bde4(0x187),_0x26bde4(0x1ba),_0x26bde4(0x1be),'xlm','link','dot','yfi',_0x26bde4(0x18f),_0x26bde4(0x182),_0x26bde4(0x15f),_0x26bde4(0x16b),_0x26bde4(0x1ab),'bhd',_0x26bde4(0x15b),_0x26bde4(0x18e),_0x26bde4(0x1bd),_0x26bde4(0x1bc),_0x26bde4(0x188),_0x26bde4(0x1c8),'czk',_0x26bde4(0x167),_0x26bde4(0x160),_0x26bde4(0x158),_0x26bde4(0x1b8),_0x26bde4(0x171),'huf',_0x26bde4(0x1c4),'ils',_0x26bde4(0x17f),_0x26bde4(0x1a3),'krw',_0x26bde4(0x1a9),_0x26bde4(0x1b2),'mmk','mxn','myr','ngn','nok','nzd','php',_0x26bde4(0x166),'pln','rub',_0x26bde4(0x1a2),_0x26bde4(0x194),_0x26bde4(0x1b6),_0x26bde4(0x1c2),_0x26bde4(0x19d),_0x26bde4(0x1b3),'uah','vef',_0x26bde4(0x1c1),'zar',_0x26bde4(0x15c),'xag',_0x26bde4(0x196),'bits',_0x26bde4(0x176)],this[_0x26bde4(0x17d)]=null,this[_0x26bde4(0x15e)]=0x3,this[_0x26bde4(0x197)]();}[a38_0x192eb(0x197)](){const _0x5391ea=a38_0x192eb;this['updateCurrencyRates']()[_0x5391ea(0x17c)](_0x3fd805=>{const _0x26c3ac=_0x5391ea;console[_0x26c3ac(0x162)](_0x26c3ac(0x17a),_0x3fd805);}),this[_0x5391ea(0x17d)]=setInterval(async()=>{const _0x261bbb=_0x5391ea;try{await this[_0x261bbb(0x1a7)]();}catch(_0x19e098){console[_0x261bbb(0x162)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x19e098);}},0x3c*0x3c*0x3e8),console[_0x5391ea(0x186)](_0x5391ea(0x16c));}[a38_0x192eb(0x1b7)](){const _0xce4336=a38_0x192eb;this[_0xce4336(0x17d)]&&(clearInterval(this[_0xce4336(0x17d)]),this[_0xce4336(0x17d)]=null,console[_0xce4336(0x186)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x192eb(0x1a7)](){const _0x173995=a38_0x192eb;try{console[_0x173995(0x186)](_0x173995(0x1b0));const _0x252e10=this[_0x173995(0x180)]['join'](','),_0xb2d653=this['COINGECKO_URL']+_0x173995(0x19f)+_0x252e10,_0x52d5cc=await fetch(_0xb2d653,{'headers':{'Accept':_0x173995(0x1ac),'User-Agent':_0x173995(0x193)}});if(!_0x52d5cc['ok'])throw new Error(_0x173995(0x195)+_0x52d5cc[_0x173995(0x1bf)]+'\x20'+_0x52d5cc['statusText']);const _0x59e85f=await _0x52d5cc[_0x173995(0x1a1)]();if(!_0x59e85f[_0x173995(0x192)])throw new Error(_0x173995(0x157));const _0x4f92ee=_0x59e85f['tether'];console[_0x173995(0x186)]('üìä\x20Received\x20rates\x20for\x20'+Object['keys'](_0x4f92ee)[_0x173995(0x1af)]+_0x173995(0x1c9));const _0x3519bb=Object[_0x173995(0x184)](_0x4f92ee)[_0x173995(0x1a8)](async([_0x3ce449,_0x5fb51a])=>{const _0x27b8bf=_0x173995;try{await database_1[_0x27b8bf(0x1bb)]['currencyRate']['upsert']({'where':{'currency':_0x3ce449[_0x27b8bf(0x1cb)]()},'update':{'rate':_0x5fb51a},'create':{'currency':_0x3ce449['toLowerCase'](),'rate':_0x5fb51a}});}catch(_0x1e1b19){console['error'](_0x27b8bf(0x173)+_0x3ce449+':',_0x1e1b19);}});await Promise[_0x173995(0x163)](_0x3519bb),console['log'](_0x173995(0x165));}catch(_0x305276){console['error'](_0x173995(0x198),_0x305276);throw _0x305276;}}async[a38_0x192eb(0x172)](_0x4c14c8){const _0x1af8be=a38_0x192eb,_0x1e1d00=_0x4c14c8[_0x1af8be(0x1cb)]();if(_0x1e1d00==='usdt')return 0x1;try{const _0xeed7e7=await database_1[_0x1af8be(0x1bb)][_0x1af8be(0x18d)][_0x1af8be(0x183)]({'where':{'currency':_0x1e1d00}});if(!_0xeed7e7)return console[_0x1af8be(0x19e)](_0x1af8be(0x1a5)+_0x4c14c8+',\x20using\x201\x20as\x20fallback'),0x1;return _0xeed7e7[_0x1af8be(0x1b9)];}catch(_0x6da938){return console['error'](_0x1af8be(0x15a)+_0x4c14c8+':',_0x6da938),0x1;}}async[a38_0x192eb(0x1b4)](_0x153cda,_0x20aa81){const _0x4b51e2=a38_0x192eb,_0x55c3d7=_0x20aa81[_0x4b51e2(0x1cb)]();if(_0x55c3d7===_0x4b51e2(0x1ae)){const _0x307220=_0x153cda*(0x1+this[_0x4b51e2(0x15e)]/0x64);return console['log'](_0x4b51e2(0x16a)+this[_0x4b51e2(0x15e)]+_0x4b51e2(0x170)+_0x153cda+'\x20USDT\x20=\x20'+_0x307220[_0x4b51e2(0x1c0)](0x6)+'\x20USDT'),_0x307220;}try{const _0x27dbf9=await this[_0x4b51e2(0x172)](_0x55c3d7),_0x1fd7fa=_0x153cda/_0x27dbf9,_0xfbfb35=_0x1fd7fa*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4b51e2(0x186)](_0x4b51e2(0x1a6)+_0x153cda+'\x20'+_0x20aa81['toUpperCase']()+_0x4b51e2(0x16e)+_0x1fd7fa[_0x4b51e2(0x1c0)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0x4b51e2(0x19c)+_0xfbfb35['toFixed'](0x6)+_0x4b51e2(0x189)+_0x27dbf9+')'),_0xfbfb35;}catch(_0x541633){console[_0x4b51e2(0x162)](_0x4b51e2(0x15d)+_0x153cda+'\x20'+_0x20aa81+'\x20to\x20USDT:',_0x541633);const _0x413fb4=_0x153cda*(0x1+this[_0x4b51e2(0x15e)]/0x64);return _0x413fb4;}}async[a38_0x192eb(0x161)](_0x3ffb84){const _0x32b9e2=a38_0x192eb;let _0x9bb087=0x0;for(const {amount:_0x4a9a54,currency:_0x40a5f4}of _0x3ffb84){const _0x565ab9=await this[_0x32b9e2(0x1b4)](_0x4a9a54,_0x40a5f4);_0x9bb087+=_0x565ab9;}return _0x9bb087;}async[a38_0x192eb(0x179)](){const _0x217cce=a38_0x192eb;try{const _0x71cc0=await database_1[_0x217cce(0x1bb)]['currencyRate'][_0x217cce(0x1c5)]({'select':{'currency':!![],'rate':!![]}}),_0x3ae4d3={'usdt':0x1};return _0x71cc0[_0x217cce(0x159)](_0x18706f=>{const _0x53a62b=_0x217cce;_0x3ae4d3[_0x18706f[_0x53a62b(0x185)]]=_0x18706f['rate'];}),_0x3ae4d3;}catch(_0x48c2d5){return console[_0x217cce(0x162)]('Error\x20getting\x20all\x20rates:',_0x48c2d5),{'usdt':0x1};}}async[a38_0x192eb(0x1a4)](){const _0xa3c1ef=a38_0x192eb;try{const [_0x53c427,_0x122188,_0x40ead3]=await Promise[_0xa3c1ef(0x1aa)]([database_1[_0xa3c1ef(0x1bb)][_0xa3c1ef(0x18d)][_0xa3c1ef(0x178)](),database_1[_0xa3c1ef(0x1bb)][_0xa3c1ef(0x18d)][_0xa3c1ef(0x164)]({'orderBy':{'updatedAt':_0xa3c1ef(0x177)},'select':{'updatedAt':!![]}}),database_1['default'][_0xa3c1ef(0x18d)][_0xa3c1ef(0x164)]({'orderBy':{'updatedAt':_0xa3c1ef(0x169)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x53c427,'lastUpdated':_0x122188?.[_0xa3c1ef(0x19a)]||null,'oldestRate':_0x40ead3?.[_0xa3c1ef(0x19a)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x49d5c9){return console[_0xa3c1ef(0x162)](_0xa3c1ef(0x174),_0x49d5c9),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xa3c1ef(0x15e)]};}}['getMarkupPercentage'](){const _0x158f01=a38_0x192eb;return this[_0x158f01(0x15e)];}}function a38_0xb80d(_0x442f06,_0x34c974){const _0xfe261d=a38_0xfe26();return a38_0xb80d=function(_0xb80d5f,_0x46512b){_0xb80d5f=_0xb80d5f-0x156;let _0x1d7466=_0xfe261d[_0xb80d5f];return _0x1d7466;},a38_0xb80d(_0x442f06,_0x34c974);}exports[a38_0x192eb(0x1c3)]=CurrencyService,exports[a38_0x192eb(0x1b1)]=new CurrencyService();function a38_0xfe26(){const _0x59eec7=['../config/database','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','gbp','forEach','Error\x20getting\x20rate\x20for\x20currency\x20','bmd','xdr','Error\x20converting\x20','MARKUP_PERCENTAGE','ars','eur','convertMultipleToUSDT','error','allSettled','findFirst','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','pkr','dkk','1656DLRyLQ','asc','üí±\x20Applied\x20','aud','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','ltc','\x20to\x20','1107970BsmwUx','%\x20markup\x20to\x20','hkd','getCurrencyRate','Failed\x20to\x20update\x20rate\x20for\x20','Error\x20getting\x20rates\x20status:','52fBQAId','sats','desc','count','getAllRates','Initial\x20currency\x20rates\x20update\x20failed:','9560fRAeDk','catch','updateInterval','3960520tqTjAB','inr','CURRENCIES','6683320ViYrUu','aed','findUnique','entries','currency','log','bnb','clp','\x20USDT\x20(rate:\x20','defineProperty','2738274wDJyBd','btc','currencyRate','brl','usd','6108ufyiYf','https://api.coingecko.com/api/v3/simple/price','tether','TesSoft\x20Payment\x20System/1.0','sek','CoinGecko\x20API\x20error:\x20','xau','startPeriodicUpdates','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','113443xYETFr','updatedAt','7HzXFtA','%\x20markup\x20=\x20','try','warn','?ids=tether&vs_currencies=','9sWlWtu','json','sar','jpy','getRatesStatus','No\x20rate\x20found\x20for\x20currency:\x20','üí±\x20Converted\x20','updateCurrencyRates','map','kwd','all','bdt','application/json','__importDefault','usdt','length','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','currencyService','lkr','twd','convertToUSDT','__esModule','sgd','stopPeriodicUpdates','gel','rate','eos','default','chf','cad','xrp','status','toFixed','vnd','thb','CurrencyService','idr','findMany','57YuLiVo','eth','cny','\x20currencies','COINGECKO_URL','toLowerCase'];a38_0xfe26=function(){return _0x59eec7;};return a38_0xfe26();}