'use strict';const a38_0x382048=a38_0x2eee;(function(_0x26bc25,_0x5b2dcf){const _0x1497a2=a38_0x2eee,_0x171ff5=_0x26bc25();while(!![]){try{const _0x9b268a=-parseInt(_0x1497a2(0x234))/0x1*(parseInt(_0x1497a2(0x25f))/0x2)+-parseInt(_0x1497a2(0x22c))/0x3*(-parseInt(_0x1497a2(0x24d))/0x4)+parseInt(_0x1497a2(0x20e))/0x5+-parseInt(_0x1497a2(0x250))/0x6*(-parseInt(_0x1497a2(0x1ef))/0x7)+parseInt(_0x1497a2(0x246))/0x8*(-parseInt(_0x1497a2(0x1f6))/0x9)+-parseInt(_0x1497a2(0x267))/0xa+parseInt(_0x1497a2(0x1f4))/0xb*(parseInt(_0x1497a2(0x221))/0xc);if(_0x9b268a===_0x5b2dcf)break;else _0x171ff5['push'](_0x171ff5['shift']());}catch(_0x131a1d){_0x171ff5['push'](_0x171ff5['shift']());}}}(a38_0x3e29,0x6ea44));var __importDefault=this&&this[a38_0x382048(0x25c)]||function(_0x33b5f0){const _0x553415=a38_0x382048;return _0x33b5f0&&_0x33b5f0[_0x553415(0x1f0)]?_0x33b5f0:{'default':_0x33b5f0};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x382048(0x24a)]=exports[a38_0x382048(0x247)]=void 0x0;function a38_0x3e29(){const _0x4ed967=['currencyService','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','https://api.coingecko.com/api/v3/simple/price','3452ROyChw','getMarkupPercentage','brl','6KKxIha','length','cad','all','ars','toFixed','chf','updateInterval','Failed\x20to\x20update\x20rate\x20for\x20','xdr','huf','ngn','__importDefault','usd','xrp','384052zAcSpK','krw','bch','Error\x20converting\x20','entries','updateCurrencyRates','jpy','toUpperCase','2207320qqXIbc','ltc','../config/database','link','bdt','vef','lkr','1111978mqtauk','__esModule','sek','sgd','php','2048992VTtDDb','usdt','9hsVDNL','error','💱\x20Applied\x20','?ids=tether&vs_currencies=','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20USDT\x20(rate:\x20','CURRENCIES','eos','findMany','getCurrencyRate','json','uah','MARKUP_PERCENTAGE','bnb','%\x20markup\x20to\x20','aed','log','myr','\x20to\x20USDT:','Initial\x20currency\x20rates\x20update\x20failed:','COINGECKO_URL','nok','keys','\x20USDT,\x20with\x20','2479170Sqlkaz','tether','pln','eth','📊\x20Received\x20rates\x20for\x20','kwd','ils','cny','Error\x20getting\x20rate\x20for\x20currency\x20','Error\x20getting\x20all\x20rates:','updatedAt','aud',',\x20using\x201\x20as\x20fallback','No\x20rate\x20found\x20for\x20currency:\x20','eur','convertToUSDT','startPeriodicUpdates','Periodic\x20currency\x20rates\x20update\x20failed:','currencyRate','24BlaPEy','sar','CoinGecko\x20API\x20error:\x20','allSettled','findFirst','currency','clp','warn','toLowerCase','pkr','statusText','15RwwKBF','upsert','💱\x20Converted\x20','\x20USDT\x20=\x20','stopPeriodicUpdates','TesSoft\x20Payment\x20System/1.0','Error\x20getting\x20rates\x20status:','gbp','1DcTeNo','map','nzd','bmd','join','catch','xag','idr','❌\x20Failed\x20to\x20update\x20currency\x20rates:','yfi','vnd','\x20currencies','xau','inr','default','try','mxn','getAllRates','1324808iIkIBh','CurrencyService','application/json','asc'];a38_0x3e29=function(){return _0x4ed967;};return a38_0x3e29();}function a38_0x2eee(_0xd0c939,_0x249e37){const _0x3e291a=a38_0x3e29();return a38_0x2eee=function(_0x2eee69,_0x291c8c){_0x2eee69=_0x2eee69-0x1ea;let _0x36f9a4=_0x3e291a[_0x2eee69];return _0x36f9a4;},a38_0x2eee(_0xd0c939,_0x249e37);}const database_1=__importDefault(require(a38_0x382048(0x1ea)));class CurrencyService{constructor(){const _0x3999e6=a38_0x382048;this[_0x3999e6(0x20a)]=_0x3999e6(0x24c),this[_0x3999e6(0x1fc)]=['btc',_0x3999e6(0x211),_0x3999e6(0x268),_0x3999e6(0x261),_0x3999e6(0x203),_0x3999e6(0x1fd),_0x3999e6(0x25e),'xlm',_0x3999e6(0x1eb),'dot',_0x3999e6(0x23d),_0x3999e6(0x25d),_0x3999e6(0x205),_0x3999e6(0x254),_0x3999e6(0x219),_0x3999e6(0x1ec),'bhd',_0x3999e6(0x237),_0x3999e6(0x24f),_0x3999e6(0x252),_0x3999e6(0x256),_0x3999e6(0x227),_0x3999e6(0x215),'czk','dkk',_0x3999e6(0x21c),_0x3999e6(0x233),'gel','hkd',_0x3999e6(0x25a),_0x3999e6(0x23b),_0x3999e6(0x214),_0x3999e6(0x241),_0x3999e6(0x265),_0x3999e6(0x260),_0x3999e6(0x213),_0x3999e6(0x1ee),'mmk',_0x3999e6(0x244),_0x3999e6(0x207),_0x3999e6(0x25b),_0x3999e6(0x20b),_0x3999e6(0x236),_0x3999e6(0x1f3),_0x3999e6(0x22a),_0x3999e6(0x210),'rub',_0x3999e6(0x222),_0x3999e6(0x1f1),_0x3999e6(0x1f2),'thb',_0x3999e6(0x243),'twd',_0x3999e6(0x201),_0x3999e6(0x1ed),_0x3999e6(0x23e),'zar',_0x3999e6(0x259),_0x3999e6(0x23a),_0x3999e6(0x240),'bits','sats'],this[_0x3999e6(0x257)]=null,this[_0x3999e6(0x202)]=0x3,this[_0x3999e6(0x21e)]();}[a38_0x382048(0x21e)](){const _0x55d4e8=a38_0x382048;this[_0x55d4e8(0x264)]()[_0x55d4e8(0x239)](_0x4ac4c9=>{const _0x4eb520=_0x55d4e8;console[_0x4eb520(0x1f7)](_0x4eb520(0x209),_0x4ac4c9);}),this[_0x55d4e8(0x257)]=setInterval(async()=>{const _0x13d8a7=_0x55d4e8;try{await this[_0x13d8a7(0x264)]();}catch(_0x241c70){console[_0x13d8a7(0x1f7)](_0x13d8a7(0x21f),_0x241c70);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x382048(0x230)](){const _0x47eae9=a38_0x382048;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x47eae9(0x257)]=null,console[_0x47eae9(0x206)](_0x47eae9(0x24b)));}async[a38_0x382048(0x264)](){const _0xecb9b4=a38_0x382048;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x4c157d=this['CURRENCIES'][_0xecb9b4(0x238)](','),_0x6d74e7=this[_0xecb9b4(0x20a)]+_0xecb9b4(0x1f9)+_0x4c157d,_0x16844c=await fetch(_0x6d74e7,{'headers':{'Accept':_0xecb9b4(0x248),'User-Agent':_0xecb9b4(0x231)}});if(!_0x16844c['ok'])throw new Error(_0xecb9b4(0x223)+_0x16844c['status']+'\x20'+_0x16844c[_0xecb9b4(0x22b)]);const _0x2e9e77=await _0x16844c[_0xecb9b4(0x200)]();if(!_0x2e9e77['tether'])throw new Error(_0xecb9b4(0x1fa));const _0x32d3ad=_0x2e9e77[_0xecb9b4(0x20f)];console['log'](_0xecb9b4(0x212)+Object[_0xecb9b4(0x20c)](_0x32d3ad)[_0xecb9b4(0x251)]+_0xecb9b4(0x23f));const _0x2a4602=Object[_0xecb9b4(0x263)](_0x32d3ad)[_0xecb9b4(0x235)](async([_0x511aa2,_0x3b268b])=>{const _0xc8697f=_0xecb9b4;try{await database_1[_0xc8697f(0x242)][_0xc8697f(0x220)][_0xc8697f(0x22d)]({'where':{'currency':_0x511aa2[_0xc8697f(0x229)]()},'update':{'rate':_0x3b268b},'create':{'currency':_0x511aa2[_0xc8697f(0x229)](),'rate':_0x3b268b}});}catch(_0x3cc37f){console[_0xc8697f(0x1f7)](_0xc8697f(0x258)+_0x511aa2+':',_0x3cc37f);}});await Promise[_0xecb9b4(0x224)](_0x2a4602),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x2ddeb7){console[_0xecb9b4(0x1f7)](_0xecb9b4(0x23c),_0x2ddeb7);throw _0x2ddeb7;}}async['getCurrencyRate'](_0x2b0c43){const _0x4e0f91=a38_0x382048,_0x431412=_0x2b0c43[_0x4e0f91(0x229)]();if(_0x431412===_0x4e0f91(0x1f5))return 0x1;try{const _0x3b9cd6=await database_1[_0x4e0f91(0x242)]['currencyRate']['findUnique']({'where':{'currency':_0x431412}});if(!_0x3b9cd6)return console[_0x4e0f91(0x228)](_0x4e0f91(0x21b)+_0x2b0c43+_0x4e0f91(0x21a)),0x1;return _0x3b9cd6['rate'];}catch(_0x458cba){return console[_0x4e0f91(0x1f7)](_0x4e0f91(0x216)+_0x2b0c43+':',_0x458cba),0x1;}}async[a38_0x382048(0x21d)](_0x5369b5,_0x80efc8){const _0x3f0a9f=a38_0x382048,_0x16c8a3=_0x80efc8[_0x3f0a9f(0x229)]();if(_0x16c8a3===_0x3f0a9f(0x1f5)){const _0x2b6984=_0x5369b5*(0x1+this[_0x3f0a9f(0x202)]/0x64);return console['log'](_0x3f0a9f(0x1f8)+this[_0x3f0a9f(0x202)]+_0x3f0a9f(0x204)+_0x5369b5+_0x3f0a9f(0x22f)+_0x2b6984['toFixed'](0x6)+'\x20USDT'),_0x2b6984;}try{const _0x226648=await this[_0x3f0a9f(0x1ff)](_0x16c8a3),_0x332b05=_0x5369b5/_0x226648,_0x35c869=_0x332b05*(0x1+this[_0x3f0a9f(0x202)]/0x64);return console[_0x3f0a9f(0x206)](_0x3f0a9f(0x22e)+_0x5369b5+'\x20'+_0x80efc8[_0x3f0a9f(0x266)]()+'\x20to\x20'+_0x332b05[_0x3f0a9f(0x255)](0x6)+_0x3f0a9f(0x20d)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x35c869['toFixed'](0x6)+_0x3f0a9f(0x1fb)+_0x226648+')'),_0x35c869;}catch(_0x48fbf0){console[_0x3f0a9f(0x1f7)](_0x3f0a9f(0x262)+_0x5369b5+'\x20'+_0x80efc8+_0x3f0a9f(0x208),_0x48fbf0);const _0x55ece1=_0x5369b5*(0x1+this[_0x3f0a9f(0x202)]/0x64);return _0x55ece1;}}async['convertMultipleToUSDT'](_0x1e8556){const _0x589b8e=a38_0x382048;let _0x46e5bd=0x0;for(const {amount:_0x199d45,currency:_0x1ff858}of _0x1e8556){const _0x45c95d=await this[_0x589b8e(0x21d)](_0x199d45,_0x1ff858);_0x46e5bd+=_0x45c95d;}return _0x46e5bd;}async[a38_0x382048(0x245)](){const _0x594f93=a38_0x382048;try{const _0xaad7db=await database_1['default']['currencyRate'][_0x594f93(0x1fe)]({'select':{'currency':!![],'rate':!![]}}),_0x117fab={'usdt':0x1};return _0xaad7db['forEach'](_0xedc7d3=>{const _0x4d19f2=_0x594f93;_0x117fab[_0xedc7d3[_0x4d19f2(0x226)]]=_0xedc7d3['rate'];}),_0x117fab;}catch(_0x18c788){return console[_0x594f93(0x1f7)](_0x594f93(0x217),_0x18c788),{'usdt':0x1};}}async['getRatesStatus'](){const _0x175b7f=a38_0x382048;try{const [_0x5111fd,_0x4db7fc,_0x267269]=await Promise[_0x175b7f(0x253)]([database_1[_0x175b7f(0x242)]['currencyRate']['count'](),database_1[_0x175b7f(0x242)][_0x175b7f(0x220)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x175b7f(0x225)]({'orderBy':{'updatedAt':_0x175b7f(0x249)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5111fd,'lastUpdated':_0x4db7fc?.[_0x175b7f(0x218)]||null,'oldestRate':_0x267269?.['updatedAt']||null,'markupPercentage':this[_0x175b7f(0x202)]};}catch(_0x26a95c){return console[_0x175b7f(0x1f7)](_0x175b7f(0x232),_0x26a95c),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x175b7f(0x202)]};}}[a38_0x382048(0x24e)](){const _0x330753=a38_0x382048;return this[_0x330753(0x202)];}}exports[a38_0x382048(0x247)]=CurrencyService,exports[a38_0x382048(0x24a)]=new CurrencyService();