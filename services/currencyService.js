'use strict';const a39_0xcc13d4=a39_0x1837;(function(_0x3db8ee,_0x269fa5){const _0x5c6eb2=a39_0x1837,_0x469c44=_0x3db8ee();while(!![]){try{const _0x109be0=-parseInt(_0x5c6eb2(0x9e))/0x1*(-parseInt(_0x5c6eb2(0xb3))/0x2)+-parseInt(_0x5c6eb2(0x99))/0x3+-parseInt(_0x5c6eb2(0xa0))/0x4+parseInt(_0x5c6eb2(0xab))/0x5+parseInt(_0x5c6eb2(0xec))/0x6*(parseInt(_0x5c6eb2(0xcd))/0x7)+parseInt(_0x5c6eb2(0xf7))/0x8+-parseInt(_0x5c6eb2(0x109))/0x9*(parseInt(_0x5c6eb2(0xcc))/0xa);if(_0x109be0===_0x269fa5)break;else _0x469c44['push'](_0x469c44['shift']());}catch(_0x3e74b8){_0x469c44['push'](_0x469c44['shift']());}}}(a39_0x1136,0x322cd));var __importDefault=this&&this['__importDefault']||function(_0x3b1018){const _0x2a2e21=a39_0x1837;return _0x3b1018&&_0x3b1018[_0x2a2e21(0xb2)]?_0x3b1018:{'default':_0x3b1018};};Object['defineProperty'](exports,a39_0xcc13d4(0xb2),{'value':!![]}),exports[a39_0xcc13d4(0xa3)]=exports[a39_0xcc13d4(0xcb)]=void 0x0;const database_1=__importDefault(require(a39_0xcc13d4(0xfc)));class CurrencyService{constructor(){const _0x5531f6=a39_0xcc13d4;this[_0x5531f6(0xff)]=_0x5531f6(0xf4),this[_0x5531f6(0xa7)]=['btc','eth',_0x5531f6(0xdb),'bch','bnb',_0x5531f6(0x95),_0x5531f6(0xd0),_0x5531f6(0xd5),_0x5531f6(0xe0),_0x5531f6(0xd1),'yfi',_0x5531f6(0xd6),_0x5531f6(0xea),'ars','aud','bdt',_0x5531f6(0xfb),_0x5531f6(0xba),'brl',_0x5531f6(0xf3),_0x5531f6(0x98),'clp',_0x5531f6(0xb9),'czk',_0x5531f6(0x107),'eur',_0x5531f6(0xe4),_0x5531f6(0xc3),_0x5531f6(0xc7),_0x5531f6(0xb6),_0x5531f6(0xfa),_0x5531f6(0x100),_0x5531f6(0x9a),_0x5531f6(0xde),_0x5531f6(0xeb),_0x5531f6(0xca),_0x5531f6(0xf5),'mmk',_0x5531f6(0xaf),'myr',_0x5531f6(0x103),_0x5531f6(0xb5),_0x5531f6(0xdc),'php',_0x5531f6(0x94),_0x5531f6(0xe5),_0x5531f6(0x10a),_0x5531f6(0xb1),_0x5531f6(0x9d),'sgd',_0x5531f6(0xb8),'try',_0x5531f6(0xdf),_0x5531f6(0xfe),_0x5531f6(0xaa),_0x5531f6(0xf6),_0x5531f6(0xe7),_0x5531f6(0xf9),'xag',_0x5531f6(0xd8),_0x5531f6(0xd3),_0x5531f6(0xa5)],this[_0x5531f6(0xc0)]=null,this[_0x5531f6(0xbe)]=0x3,this[_0x5531f6(0xc9)]();}[a39_0xcc13d4(0xc9)](){const _0x45146f=a39_0xcc13d4;this['updateCurrencyRates']()['catch'](_0x4ae058=>{const _0x4348c7=a39_0x1837;console[_0x4348c7(0xed)](_0x4348c7(0xb7),_0x4ae058);}),this[_0x45146f(0xc0)]=setInterval(async()=>{const _0x116b8c=_0x45146f;try{await this['updateCurrencyRates']();}catch(_0x193a63){console[_0x116b8c(0xed)](_0x116b8c(0x108),_0x193a63);}},0x3c*0x3c*0x3e8),console[_0x45146f(0xad)](_0x45146f(0xbf));}[a39_0xcc13d4(0xce)](){const _0x5f36a4=a39_0xcc13d4;this[_0x5f36a4(0xc0)]&&(clearInterval(this[_0x5f36a4(0xc0)]),this[_0x5f36a4(0xc0)]=null,console[_0x5f36a4(0xad)](_0x5f36a4(0xc2)));}async[a39_0xcc13d4(0xef)](){const _0x47eb50=a39_0xcc13d4;try{console[_0x47eb50(0xad)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x139d67=this[_0x47eb50(0xa7)][_0x47eb50(0xbc)](','),_0x51ab7f=this[_0x47eb50(0xff)]+_0x47eb50(0xee)+_0x139d67,_0x529a7f=await fetch(_0x51ab7f,{'headers':{'Accept':_0x47eb50(0xe1),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x529a7f['ok'])throw new Error(_0x47eb50(0xa4)+_0x529a7f['status']+'\x20'+_0x529a7f['statusText']);const _0x4ea149=await _0x529a7f[_0x47eb50(0xbd)]();if(!_0x4ea149['tether'])throw new Error(_0x47eb50(0xc1));const _0x4d6463=_0x4ea149[_0x47eb50(0xae)];console['log'](_0x47eb50(0xf8)+Object[_0x47eb50(0xc4)](_0x4d6463)[_0x47eb50(0x96)]+_0x47eb50(0xc6));const _0x12f9f9=Object[_0x47eb50(0xc5)](_0x4d6463)[_0x47eb50(0xf1)](async([_0x779aa3,_0x3d168d])=>{const _0x30388b=_0x47eb50;try{await database_1[_0x30388b(0xda)]['currencyRate'][_0x30388b(0x9b)]({'where':{'currency':_0x779aa3['toLowerCase']()},'update':{'rate':_0x3d168d},'create':{'currency':_0x779aa3[_0x30388b(0xe3)](),'rate':_0x3d168d}});}catch(_0x5de3e5){console[_0x30388b(0xed)](_0x30388b(0xe2)+_0x779aa3+':',_0x5de3e5);}});await Promise['allSettled'](_0x12f9f9),console[_0x47eb50(0xad)](_0x47eb50(0xe9));}catch(_0x564058){console[_0x47eb50(0xed)](_0x47eb50(0xb4),_0x564058);throw _0x564058;}}async[a39_0xcc13d4(0xe8)](_0x2651f5){const _0x333f85=a39_0xcc13d4,_0xf2c160=_0x2651f5['toLowerCase']();if(_0xf2c160===_0x333f85(0x104))return 0x1;try{const _0x12340e=await database_1[_0x333f85(0xda)][_0x333f85(0xa2)][_0x333f85(0xd7)]({'where':{'currency':_0xf2c160}});if(!_0x12340e)return console[_0x333f85(0x9f)](_0x333f85(0xdd)+_0x2651f5+_0x333f85(0x9c)),0x1;return _0x12340e['rate'];}catch(_0x17df3f){return console[_0x333f85(0xed)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x2651f5+':',_0x17df3f),0x1;}}async[a39_0xcc13d4(0x102)](_0x52dbac,_0x3ce9cf){const _0x770920=a39_0xcc13d4,_0x1cd176=_0x3ce9cf[_0x770920(0xe3)]();if(_0x1cd176==='usdt'){const _0x247863=_0x52dbac*(0x1+this[_0x770920(0xbe)]/0x64);return console[_0x770920(0xad)]('üí±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x770920(0xbb)+_0x52dbac+'\x20USDT\x20=\x20'+_0x247863['toFixed'](0x6)+_0x770920(0xac)),_0x247863;}try{const _0x3ef956=await this[_0x770920(0xe8)](_0x1cd176),_0x2cb6b9=_0x52dbac/_0x3ef956,_0x518d63=_0x2cb6b9*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x770920(0xad)](_0x770920(0xfd)+_0x52dbac+'\x20'+_0x3ce9cf[_0x770920(0x97)]()+'\x20to\x20'+_0x2cb6b9[_0x770920(0x106)](0x6)+_0x770920(0xd9)+this[_0x770920(0xbe)]+_0x770920(0x101)+_0x518d63[_0x770920(0x106)](0x6)+_0x770920(0xd2)+_0x3ef956+')'),_0x518d63;}catch(_0x2af9f3){console['error'](_0x770920(0xa6)+_0x52dbac+'\x20'+_0x3ce9cf+'\x20to\x20USDT:',_0x2af9f3);const _0x2315fe=_0x52dbac*(0x1+this[_0x770920(0xbe)]/0x64);return _0x2315fe;}}async[a39_0xcc13d4(0xcf)](_0x7fc555){const _0x343133=a39_0xcc13d4;let _0x318097=0x0;for(const {amount:_0x4ab41d,currency:_0x6370cd}of _0x7fc555){const _0x54ff79=await this[_0x343133(0x102)](_0x4ab41d,_0x6370cd);_0x318097+=_0x54ff79;}return _0x318097;}async[a39_0xcc13d4(0xa9)](){const _0x4c947c=a39_0xcc13d4;try{const _0x1d34d1=await database_1[_0x4c947c(0xda)][_0x4c947c(0xa2)][_0x4c947c(0xe6)]({'select':{'currency':!![],'rate':!![]}}),_0x1ee1ce={'usdt':0x1};return _0x1d34d1[_0x4c947c(0xa8)](_0x3c52d4=>{_0x1ee1ce[_0x3c52d4['currency']]=_0x3c52d4['rate'];}),_0x1ee1ce;}catch(_0x12642c){return console[_0x4c947c(0xed)]('Error\x20getting\x20all\x20rates:',_0x12642c),{'usdt':0x1};}}async[a39_0xcc13d4(0x105)](){const _0x3093b7=a39_0xcc13d4;try{const [_0x5f3cab,_0x26b038,_0x16d05b]=await Promise[_0x3093b7(0xb0)]([database_1[_0x3093b7(0xda)][_0x3093b7(0xa2)][_0x3093b7(0xf0)](),database_1['default'][_0x3093b7(0xa2)]['findFirst']({'orderBy':{'updatedAt':_0x3093b7(0x10b)},'select':{'updatedAt':!![]}}),database_1[_0x3093b7(0xda)][_0x3093b7(0xa2)][_0x3093b7(0xa1)]({'orderBy':{'updatedAt':_0x3093b7(0xc8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5f3cab,'lastUpdated':_0x26b038?.[_0x3093b7(0xd4)]||null,'oldestRate':_0x16d05b?.[_0x3093b7(0xd4)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x15d9ed){return console[_0x3093b7(0xed)]('Error\x20getting\x20rates\x20status:',_0x15d9ed),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0xcc13d4(0xf2)](){const _0x3a6a06=a39_0xcc13d4;return this[_0x3a6a06(0xbe)];}}function a39_0x1136(){const _0x12ed4d=['count','map','getMarkupPercentage','cad','https://api.coingecko.com/api/v3/simple/price','lkr','vnd','2835336hIFnKi','üìä\x20Received\x20rates\x20for\x20','xdr','idr','bhd','../config/database','üí±\x20Converted\x20','uah','COINGECKO_URL','ils','%\x20markup\x20=\x20','convertToUSDT','ngn','usdt','getRatesStatus','toFixed','dkk','Periodic\x20currency\x20rates\x20update\x20failed:','167733gYjoJJ','rub','desc','pkr','eos','length','toUpperCase','chf','248469WRyLkH','inr','upsert',',\x20using\x201\x20as\x20fallback','sek','15313TBDTgk','warn','7896tEuBAM','findFirst','currencyRate','currencyService','CoinGecko\x20API\x20error:\x20','sats','Error\x20converting\x20','CURRENCIES','forEach','getAllRates','vef','490275EsCOaS','\x20USDT','log','tether','mxn','all','sar','__esModule','30klInYx','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','nok','huf','Initial\x20currency\x20rates\x20update\x20failed:','thb','cny','bmd','%\x20markup\x20to\x20','join','json','MARKUP_PERCENTAGE','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','updateInterval','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','gel','keys','entries','\x20currencies','hkd','asc','startPeriodicUpdates','kwd','CurrencyService','240VVBJal','35mTRkNC','stopPeriodicUpdates','convertMultipleToUSDT','xrp','dot','\x20USDT\x20(rate:\x20','bits','updatedAt','xlm','usd','findUnique','xau','\x20USDT,\x20with\x20','default','ltc','nzd','No\x20rate\x20found\x20for\x20currency:\x20','jpy','twd','link','application/json','Failed\x20to\x20update\x20rate\x20for\x20','toLowerCase','gbp','pln','findMany','zar','getCurrencyRate','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','aed','krw','66522MQTGQP','error','?ids=tether&vs_currencies=','updateCurrencyRates'];a39_0x1136=function(){return _0x12ed4d;};return a39_0x1136();}function a39_0x1837(_0x3b03cd,_0x47d5f7){const _0x11360c=a39_0x1136();return a39_0x1837=function(_0x1837cd,_0xf67fa0){_0x1837cd=_0x1837cd-0x94;let _0x4e396f=_0x11360c[_0x1837cd];return _0x4e396f;},a39_0x1837(_0x3b03cd,_0x47d5f7);}exports[a39_0xcc13d4(0xcb)]=CurrencyService,exports[a39_0xcc13d4(0xa3)]=new CurrencyService();