'use strict';const a38_0x1c842e=a38_0x500f;(function(_0x561734,_0x3d847d){const _0x49732f=a38_0x500f,_0x432605=_0x561734();while(!![]){try{const _0x3af5b7=-parseInt(_0x49732f(0xbc))/0x1+-parseInt(_0x49732f(0x108))/0x2+-parseInt(_0x49732f(0x11e))/0x3+parseInt(_0x49732f(0x118))/0x4*(parseInt(_0x49732f(0xe3))/0x5)+-parseInt(_0x49732f(0x102))/0x6*(parseInt(_0x49732f(0x10d))/0x7)+parseInt(_0x49732f(0xdd))/0x8+-parseInt(_0x49732f(0xfc))/0x9*(-parseInt(_0x49732f(0xf5))/0xa);if(_0x3af5b7===_0x3d847d)break;else _0x432605['push'](_0x432605['shift']());}catch(_0x3007b3){_0x432605['push'](_0x432605['shift']());}}}(a38_0x3015,0x1f7bd));function a38_0x500f(_0x555ca9,_0x6191e2){const _0x301522=a38_0x3015();return a38_0x500f=function(_0x500f9b,_0x2e1429){_0x500f9b=_0x500f9b-0xbc;let _0x4ed474=_0x301522[_0x500f9b];return _0x4ed474;},a38_0x500f(_0x555ca9,_0x6191e2);}var __importDefault=this&&this[a38_0x1c842e(0x105)]||function(_0x277a1d){const _0x625727=a38_0x1c842e;return _0x277a1d&&_0x277a1d[_0x625727(0xf8)]?_0x277a1d:{'default':_0x277a1d};};Object[a38_0x1c842e(0x11c)](exports,'__esModule',{'value':!![]}),exports[a38_0x1c842e(0xfb)]=exports[a38_0x1c842e(0x109)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x32a906=a38_0x1c842e;this[_0x32a906(0xc0)]=_0x32a906(0xe2),this[_0x32a906(0xc3)]=[_0x32a906(0xdf),'eth','ltc',_0x32a906(0x121),_0x32a906(0x10e),_0x32a906(0x129),_0x32a906(0xda),_0x32a906(0xce),_0x32a906(0xe1),'dot',_0x32a906(0x131),'usd',_0x32a906(0x114),_0x32a906(0xd8),_0x32a906(0x110),_0x32a906(0x116),_0x32a906(0x103),'bmd',_0x32a906(0x12f),_0x32a906(0xe6),_0x32a906(0xc7),_0x32a906(0xd0),_0x32a906(0xf7),_0x32a906(0xde),_0x32a906(0xfd),_0x32a906(0x11f),'gbp',_0x32a906(0x12c),'hkd','huf',_0x32a906(0xfa),_0x32a906(0xbe),'inr',_0x32a906(0xcd),'krw',_0x32a906(0xea),_0x32a906(0xcc),'mmk',_0x32a906(0x127),_0x32a906(0xed),'ngn',_0x32a906(0xfe),'nzd',_0x32a906(0x104),_0x32a906(0x10b),'pln',_0x32a906(0xc8),_0x32a906(0xdb),_0x32a906(0xf6),_0x32a906(0xef),_0x32a906(0xee),_0x32a906(0xe8),_0x32a906(0x122),_0x32a906(0xc1),'vef',_0x32a906(0x120),_0x32a906(0x11b),_0x32a906(0x11a),_0x32a906(0x10f),_0x32a906(0x12b),_0x32a906(0x128),_0x32a906(0x130)],this['updateInterval']=null,this[_0x32a906(0x12d)]=0x3,this[_0x32a906(0xe9)]();}['startPeriodicUpdates'](){const _0x5407b6=a38_0x1c842e;this[_0x5407b6(0xff)]()[_0x5407b6(0xc9)](_0x1e0e23=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x1e0e23);}),this['updateInterval']=setInterval(async()=>{const _0xab9320=_0x5407b6;try{await this[_0xab9320(0xff)]();}catch(_0x372774){console[_0xab9320(0xdc)](_0xab9320(0xd2),_0x372774);}},0x3c*0x3c*0x3e8),console['log'](_0x5407b6(0xd1));}[a38_0x1c842e(0xe0)](){const _0x4a0060=a38_0x1c842e;this[_0x4a0060(0xd6)]&&(clearInterval(this[_0x4a0060(0xd6)]),this[_0x4a0060(0xd6)]=null,console['log'](_0x4a0060(0x112)));}async[a38_0x1c842e(0xff)](){const _0x42f95f=a38_0x1c842e;try{console[_0x42f95f(0xca)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x50809b=this[_0x42f95f(0xc3)]['join'](','),_0x56bd05=this[_0x42f95f(0xc0)]+'?ids=tether&vs_currencies='+_0x50809b,_0x2bfd1d=await fetch(_0x56bd05,{'headers':{'Accept':_0x42f95f(0xf0),'User-Agent':_0x42f95f(0x111)}});if(!_0x2bfd1d['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x2bfd1d[_0x42f95f(0x115)]+'\x20'+_0x2bfd1d[_0x42f95f(0xd3)]);const _0x328e8e=await _0x2bfd1d[_0x42f95f(0xc2)]();if(!_0x328e8e[_0x42f95f(0xf3)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x14c90d=_0x328e8e[_0x42f95f(0xf3)];console['log'](_0x42f95f(0xcb)+Object['keys'](_0x14c90d)[_0x42f95f(0xc6)]+'\x20currencies');const _0x524e3a=Object[_0x42f95f(0xe7)](_0x14c90d)[_0x42f95f(0x117)](async([_0x563436,_0x69ce56])=>{const _0x49342a=_0x42f95f;try{await database_1[_0x49342a(0xec)][_0x49342a(0xc5)]['upsert']({'where':{'currency':_0x563436[_0x49342a(0xf2)]()},'update':{'rate':_0x69ce56},'create':{'currency':_0x563436[_0x49342a(0xf2)](),'rate':_0x69ce56}});}catch(_0x2ad90c){console[_0x49342a(0xdc)](_0x49342a(0xe5)+_0x563436+':',_0x2ad90c);}});await Promise[_0x42f95f(0xbf)](_0x524e3a),console[_0x42f95f(0xca)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x2db036){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x2db036);throw _0x2db036;}}async[a38_0x1c842e(0x124)](_0x23357e){const _0x1051b3=a38_0x1c842e,_0x564e37=_0x23357e[_0x1051b3(0xf2)]();if(_0x564e37===_0x1051b3(0x113))return 0x1;try{const _0x8f94ad=await database_1[_0x1051b3(0xec)][_0x1051b3(0xc5)][_0x1051b3(0xf1)]({'where':{'currency':_0x564e37}});if(!_0x8f94ad)return console[_0x1051b3(0x10a)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x23357e+_0x1051b3(0xc4)),0x1;return _0x8f94ad[_0x1051b3(0x12a)];}catch(_0x988eb2){return console[_0x1051b3(0xdc)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x23357e+':',_0x988eb2),0x1;}}async[a38_0x1c842e(0xe4)](_0x2a638a,_0x5d6199){const _0x2389e7=a38_0x1c842e,_0x4eb036=_0x5d6199[_0x2389e7(0xf2)]();if(_0x4eb036===_0x2389e7(0x113)){const _0x4973ce=_0x2a638a*(0x1+this[_0x2389e7(0x12d)]/0x64);return console[_0x2389e7(0xca)]('💱\x20Applied\x20'+this[_0x2389e7(0x12d)]+_0x2389e7(0x107)+_0x2a638a+_0x2389e7(0x100)+_0x4973ce[_0x2389e7(0xf9)](0x6)+_0x2389e7(0x119)),_0x4973ce;}try{const _0x5db87d=await this[_0x2389e7(0x124)](_0x4eb036),_0x144244=_0x2a638a/_0x5db87d,_0x165034=_0x144244*(0x1+this[_0x2389e7(0x12d)]/0x64);return console['log']('💱\x20Converted\x20'+_0x2a638a+'\x20'+_0x5d6199[_0x2389e7(0xcf)]()+_0x2389e7(0x11d)+_0x144244[_0x2389e7(0xf9)](0x6)+_0x2389e7(0x106)+this[_0x2389e7(0x12d)]+'%\x20markup\x20=\x20'+_0x165034['toFixed'](0x6)+_0x2389e7(0xf4)+_0x5db87d+')'),_0x165034;}catch(_0x46a4ff){console[_0x2389e7(0xdc)](_0x2389e7(0x101)+_0x2a638a+'\x20'+_0x5d6199+_0x2389e7(0x10c),_0x46a4ff);const _0x47be9a=_0x2a638a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x47be9a;}}async[a38_0x1c842e(0xd7)](_0xf4281f){const _0x1b399a=a38_0x1c842e;let _0x31e87e=0x0;for(const {amount:_0x5b495e,currency:_0x343e40}of _0xf4281f){const _0x5a5afb=await this[_0x1b399a(0xe4)](_0x5b495e,_0x343e40);_0x31e87e+=_0x5a5afb;}return _0x31e87e;}async['getAllRates'](){const _0x192fb8=a38_0x1c842e;try{const _0x17ab9f=await database_1['default']['currencyRate'][_0x192fb8(0xd9)]({'select':{'currency':!![],'rate':!![]}}),_0x206b3b={'usdt':0x1};return _0x17ab9f['forEach'](_0x3e05be=>{const _0x5a02d6=_0x192fb8;_0x206b3b[_0x3e05be[_0x5a02d6(0x123)]]=_0x3e05be['rate'];}),_0x206b3b;}catch(_0x3c01fb){return console['error'](_0x192fb8(0x125),_0x3c01fb),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2ee621=a38_0x1c842e;try{const [_0x580c73,_0x14a9d7,_0x13a3fc]=await Promise[_0x2ee621(0xd4)]([database_1[_0x2ee621(0xec)][_0x2ee621(0xc5)][_0x2ee621(0xd5)](),database_1[_0x2ee621(0xec)][_0x2ee621(0xc5)][_0x2ee621(0xeb)]({'orderBy':{'updatedAt':_0x2ee621(0x126)},'select':{'updatedAt':!![]}}),database_1[_0x2ee621(0xec)]['currencyRate'][_0x2ee621(0xeb)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x580c73,'lastUpdated':_0x14a9d7?.[_0x2ee621(0x12e)]||null,'oldestRate':_0x13a3fc?.[_0x2ee621(0x12e)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x357e5){return console[_0x2ee621(0xdc)]('Error\x20getting\x20rates\x20status:',_0x357e5),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2ee621(0x12d)]};}}[a38_0x1c842e(0xbd)](){const _0x390758=a38_0x1c842e;return this[_0x390758(0x12d)];}}exports[a38_0x1c842e(0x109)]=CurrencyService,exports[a38_0x1c842e(0xfb)]=new CurrencyService();function a38_0x3015(){const _0x502526=['rub','catch','log','📊\x20Received\x20rates\x20for\x20','lkr','jpy','xlm','toUpperCase','clp','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Periodic\x20currency\x20rates\x20update\x20failed:','statusText','all','count','updateInterval','convertMultipleToUSDT','ars','findMany','xrp','sar','error','804696yVkZTd','czk','btc','stopPeriodicUpdates','link','https://api.coingecko.com/api/v3/simple/price','85VHXzRB','convertToUSDT','Failed\x20to\x20update\x20rate\x20for\x20','cad','entries','try','startPeriodicUpdates','kwd','findFirst','default','myr','thb','sgd','application/json','findUnique','toLowerCase','tether','\x20USDT\x20(rate:\x20','2250010cMouFo','sek','cny','__esModule','toFixed','idr','currencyService','18mnqupZ','dkk','nok','updateCurrencyRates','\x20USDT\x20=\x20','Error\x20converting\x20','142278gVKpZd','bhd','php','__importDefault','\x20USDT,\x20with\x20','%\x20markup\x20to\x20','106398fKrltI','CurrencyService','warn','pkr','\x20to\x20USDT:','28HDciNa','bnb','xag','aud','TesSoft\x20Payment\x20System/1.0','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','usdt','aed','status','bdt','map','9592QFoFYF','\x20USDT','xdr','zar','defineProperty','\x20to\x20','362973EKrCnB','eur','vnd','bch','twd','currency','getCurrencyRate','Error\x20getting\x20all\x20rates:','desc','mxn','bits','eos','rate','xau','gel','MARKUP_PERCENTAGE','updatedAt','brl','sats','yfi','193356FBdyTj','getMarkupPercentage','ils','allSettled','COINGECKO_URL','uah','json','CURRENCIES',',\x20using\x201\x20as\x20fallback','currencyRate','length','chf'];a38_0x3015=function(){return _0x502526;};return a38_0x3015();}