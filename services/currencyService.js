'use strict';function a38_0x3a7b(_0x15010a,_0xc07edc){const _0x3a26d9=a38_0x3a26();return a38_0x3a7b=function(_0x3a7b2b,_0x1abce7){_0x3a7b2b=_0x3a7b2b-0x7d;let _0x5206fd=_0x3a26d9[_0x3a7b2b];return _0x5206fd;},a38_0x3a7b(_0x15010a,_0xc07edc);}const a38_0x4b7259=a38_0x3a7b;(function(_0x221d88,_0x48da13){const _0x3f0872=a38_0x3a7b,_0x134534=_0x221d88();while(!![]){try{const _0x57dabd=parseInt(_0x3f0872(0xee))/0x1*(parseInt(_0x3f0872(0xb2))/0x2)+-parseInt(_0x3f0872(0xfa))/0x3*(parseInt(_0x3f0872(0xf7))/0x4)+parseInt(_0x3f0872(0xbe))/0x5+-parseInt(_0x3f0872(0xe6))/0x6*(-parseInt(_0x3f0872(0x7d))/0x7)+parseInt(_0x3f0872(0x97))/0x8*(-parseInt(_0x3f0872(0x9e))/0x9)+parseInt(_0x3f0872(0x8e))/0xa+-parseInt(_0x3f0872(0xb6))/0xb;if(_0x57dabd===_0x48da13)break;else _0x134534['push'](_0x134534['shift']());}catch(_0xce5860){_0x134534['push'](_0x134534['shift']());}}}(a38_0x3a26,0x330f5));function a38_0x3a26(){const _0x52ed76=['%\x20markup\x20to\x20','MARKUP_PERCENTAGE','❌\x20Failed\x20to\x20update\x20currency\x20rates:','forEach','rub','brl','ngn','__esModule','3061620KGqkbo','currencyRate','toFixed','Error\x20getting\x20all\x20rates:','\x20currencies','json','getCurrencyRate','keys','jpy','333456kgCwew','ars','cad','hkd','💱\x20Applied\x20','btc','sats','27Pawozw','uah','startPeriodicUpdates','vnd','aed','https://api.coingecko.com/api/v3/simple/price','TesSoft\x20Payment\x20System/1.0','CoinGecko\x20API\x20error:\x20','idr','pln','all','getMarkupPercentage','log','findMany','eos','\x20USDT\x20=\x20','usdt','sek','lkr','Initial\x20currency\x20rates\x20update\x20failed:','8hHuKwY','currency','krw','kwd','1931765HePNym','zar','tether','join','bdt','updateCurrencyRates','clp','myr','537610mcsaiO','upsert','inr','CurrencyService','Error\x20getting\x20rates\x20status:','toLowerCase','Error\x20getting\x20rate\x20for\x20currency\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','getAllRates','aud','bch','?ids=tether&vs_currencies=','sgd','eur','currencyService','map','length','stopPeriodicUpdates','bnb','ltc','huf','📊\x20Received\x20rates\x20for\x20','bmd','findFirst','cny','__importDefault','💱\x20Converted\x20','allSettled','bits','bhd','gel','✅\x20Currency\x20rates\x20updated\x20successfully','try','mmk','twd','vef','thb','CURRENCIES','desc','default','1452bpaswe','getRatesStatus','xau','php','mxn','eth','asc','Failed\x20to\x20update\x20rate\x20for\x20','49009kqgKJx','xdr','xrp','czk','pkr','error','catch','No\x20rate\x20found\x20for\x20currency:\x20','nok','68jMkYbq','findUnique','dot','24978nXKPJX','entries','ils','\x20USDT\x20(rate:\x20','yfi','updatedAt','1204ncXxZA','updateInterval','dkk','toUpperCase','COINGECKO_URL','warn','%\x20markup\x20=\x20','convertToUSDT','status'];a38_0x3a26=function(){return _0x52ed76;};return a38_0x3a26();}var __importDefault=this&&this[a38_0x4b7259(0xd7)]||function(_0x42cf02){const _0x4da8c4=a38_0x4b7259;return _0x42cf02&&_0x42cf02[_0x4da8c4(0x8d)]?_0x42cf02:{'default':_0x42cf02};};Object['defineProperty'](exports,a38_0x4b7259(0x8d),{'value':!![]}),exports[a38_0x4b7259(0xcc)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x2f13b8=a38_0x4b7259;this[_0x2f13b8(0x81)]=_0x2f13b8(0xa3),this[_0x2f13b8(0xe3)]=[_0x2f13b8(0x9c),_0x2f13b8(0xeb),_0x2f13b8(0xd1),_0x2f13b8(0xc8),_0x2f13b8(0xd0),_0x2f13b8(0xac),_0x2f13b8(0xf0),'xlm','link',_0x2f13b8(0xf9),_0x2f13b8(0xfe),'usd',_0x2f13b8(0xa2),_0x2f13b8(0x98),_0x2f13b8(0xc7),_0x2f13b8(0xba),_0x2f13b8(0xdb),_0x2f13b8(0xd4),_0x2f13b8(0x8b),_0x2f13b8(0x99),'chf',_0x2f13b8(0xbc),_0x2f13b8(0xd6),_0x2f13b8(0xf1),_0x2f13b8(0x7f),_0x2f13b8(0xcb),'gbp',_0x2f13b8(0xdc),_0x2f13b8(0x9a),_0x2f13b8(0xd2),_0x2f13b8(0xa6),_0x2f13b8(0xfc),_0x2f13b8(0xc0),_0x2f13b8(0x96),_0x2f13b8(0xb4),_0x2f13b8(0xb5),_0x2f13b8(0xb0),_0x2f13b8(0xdf),_0x2f13b8(0xea),_0x2f13b8(0xbd),_0x2f13b8(0x8c),_0x2f13b8(0xf6),'nzd',_0x2f13b8(0xe9),_0x2f13b8(0xf2),_0x2f13b8(0xa7),_0x2f13b8(0x8a),'sar',_0x2f13b8(0xaf),_0x2f13b8(0xca),_0x2f13b8(0xe2),_0x2f13b8(0xde),_0x2f13b8(0xe0),_0x2f13b8(0x9f),_0x2f13b8(0xe1),_0x2f13b8(0xa1),_0x2f13b8(0xb7),_0x2f13b8(0xef),'xag',_0x2f13b8(0xe8),_0x2f13b8(0xda),_0x2f13b8(0x9d)],this[_0x2f13b8(0x7e)]=null,this[_0x2f13b8(0x87)]=0x3,this[_0x2f13b8(0xa0)]();}[a38_0x4b7259(0xa0)](){const _0x5bf4f1=a38_0x4b7259;this['updateCurrencyRates']()[_0x5bf4f1(0xf4)](_0x1ebb85=>{const _0x4bd617=_0x5bf4f1;console['error'](_0x4bd617(0xb1),_0x1ebb85);}),this[_0x5bf4f1(0x7e)]=setInterval(async()=>{const _0x27dc00=_0x5bf4f1;try{await this[_0x27dc00(0xbb)]();}catch(_0x348e7d){console[_0x27dc00(0xf3)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x348e7d);}},0x3c*0x3c*0x3e8),console[_0x5bf4f1(0xaa)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x4b7259(0xcf)](){const _0x5644c5=a38_0x4b7259;this[_0x5644c5(0x7e)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x5644c5(0xaa)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x3c5e2c=a38_0x4b7259;try{console[_0x3c5e2c(0xaa)](_0x3c5e2c(0xc5));const _0xd4f364=this[_0x3c5e2c(0xe3)][_0x3c5e2c(0xb9)](','),_0x2d7178=this['COINGECKO_URL']+_0x3c5e2c(0xc9)+_0xd4f364,_0x499b61=await fetch(_0x2d7178,{'headers':{'Accept':'application/json','User-Agent':_0x3c5e2c(0xa4)}});if(!_0x499b61['ok'])throw new Error(_0x3c5e2c(0xa5)+_0x499b61[_0x3c5e2c(0x85)]+'\x20'+_0x499b61['statusText']);const _0x479fc2=await _0x499b61[_0x3c5e2c(0x93)]();if(!_0x479fc2[_0x3c5e2c(0xb8)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x4eea26=_0x479fc2[_0x3c5e2c(0xb8)];console[_0x3c5e2c(0xaa)](_0x3c5e2c(0xd3)+Object[_0x3c5e2c(0x95)](_0x4eea26)[_0x3c5e2c(0xce)]+_0x3c5e2c(0x92));const _0xee2ec5=Object[_0x3c5e2c(0xfb)](_0x4eea26)[_0x3c5e2c(0xcd)](async([_0x2ab797,_0x42f5d4])=>{const _0x4d1bd6=_0x3c5e2c;try{await database_1['default'][_0x4d1bd6(0x8f)][_0x4d1bd6(0xbf)]({'where':{'currency':_0x2ab797[_0x4d1bd6(0xc3)]()},'update':{'rate':_0x42f5d4},'create':{'currency':_0x2ab797[_0x4d1bd6(0xc3)](),'rate':_0x42f5d4}});}catch(_0x31ed0d){console['error'](_0x4d1bd6(0xed)+_0x2ab797+':',_0x31ed0d);}});await Promise[_0x3c5e2c(0xd9)](_0xee2ec5),console[_0x3c5e2c(0xaa)](_0x3c5e2c(0xdd));}catch(_0x18fcd9){console[_0x3c5e2c(0xf3)](_0x3c5e2c(0x88),_0x18fcd9);throw _0x18fcd9;}}async[a38_0x4b7259(0x94)](_0x108967){const _0x39e4c5=a38_0x4b7259,_0x1edc6f=_0x108967[_0x39e4c5(0xc3)]();if(_0x1edc6f===_0x39e4c5(0xae))return 0x1;try{const _0x507963=await database_1[_0x39e4c5(0xe5)][_0x39e4c5(0x8f)][_0x39e4c5(0xf8)]({'where':{'currency':_0x1edc6f}});if(!_0x507963)return console[_0x39e4c5(0x82)](_0x39e4c5(0xf5)+_0x108967+',\x20using\x201\x20as\x20fallback'),0x1;return _0x507963['rate'];}catch(_0x326395){return console[_0x39e4c5(0xf3)](_0x39e4c5(0xc4)+_0x108967+':',_0x326395),0x1;}}async['convertToUSDT'](_0x3f7e46,_0x353940){const _0x35e4ee=a38_0x4b7259,_0x182749=_0x353940['toLowerCase']();if(_0x182749==='usdt'){const _0x18251e=_0x3f7e46*(0x1+this[_0x35e4ee(0x87)]/0x64);return console[_0x35e4ee(0xaa)](_0x35e4ee(0x9b)+this[_0x35e4ee(0x87)]+_0x35e4ee(0x86)+_0x3f7e46+_0x35e4ee(0xad)+_0x18251e[_0x35e4ee(0x90)](0x6)+'\x20USDT'),_0x18251e;}try{const _0x16dfdb=await this[_0x35e4ee(0x94)](_0x182749),_0x1f5727=_0x3f7e46/_0x16dfdb,_0x12af59=_0x1f5727*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x35e4ee(0xaa)](_0x35e4ee(0xd8)+_0x3f7e46+'\x20'+_0x353940[_0x35e4ee(0x80)]()+'\x20to\x20'+_0x1f5727['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x35e4ee(0x87)]+_0x35e4ee(0x83)+_0x12af59['toFixed'](0x6)+_0x35e4ee(0xfd)+_0x16dfdb+')'),_0x12af59;}catch(_0x4163b9){console[_0x35e4ee(0xf3)]('Error\x20converting\x20'+_0x3f7e46+'\x20'+_0x353940+'\x20to\x20USDT:',_0x4163b9);const _0x4b7147=_0x3f7e46*(0x1+this[_0x35e4ee(0x87)]/0x64);return _0x4b7147;}}async['convertMultipleToUSDT'](_0x5a9c74){const _0x3940f3=a38_0x4b7259;let _0x47c4e8=0x0;for(const {amount:_0x4fa36b,currency:_0xcb9a44}of _0x5a9c74){const _0x18fd50=await this[_0x3940f3(0x84)](_0x4fa36b,_0xcb9a44);_0x47c4e8+=_0x18fd50;}return _0x47c4e8;}async[a38_0x4b7259(0xc6)](){const _0x35ac7d=a38_0x4b7259;try{const _0x587ce8=await database_1[_0x35ac7d(0xe5)][_0x35ac7d(0x8f)][_0x35ac7d(0xab)]({'select':{'currency':!![],'rate':!![]}}),_0x580419={'usdt':0x1};return _0x587ce8[_0x35ac7d(0x89)](_0x3d5033=>{const _0x3457cb=_0x35ac7d;_0x580419[_0x3d5033[_0x3457cb(0xb3)]]=_0x3d5033['rate'];}),_0x580419;}catch(_0x3d73f8){return console[_0x35ac7d(0xf3)](_0x35ac7d(0x91),_0x3d73f8),{'usdt':0x1};}}async[a38_0x4b7259(0xe7)](){const _0x476e30=a38_0x4b7259;try{const [_0x1e87c6,_0x3f8861,_0x453164]=await Promise[_0x476e30(0xa8)]([database_1[_0x476e30(0xe5)]['currencyRate']['count'](),database_1[_0x476e30(0xe5)][_0x476e30(0x8f)][_0x476e30(0xd5)]({'orderBy':{'updatedAt':_0x476e30(0xe4)},'select':{'updatedAt':!![]}}),database_1[_0x476e30(0xe5)][_0x476e30(0x8f)][_0x476e30(0xd5)]({'orderBy':{'updatedAt':_0x476e30(0xec)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1e87c6,'lastUpdated':_0x3f8861?.[_0x476e30(0xff)]||null,'oldestRate':_0x453164?.[_0x476e30(0xff)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x28b493){return console[_0x476e30(0xf3)](_0x476e30(0xc2),_0x28b493),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x4b7259(0xa9)](){const _0x4a60d7=a38_0x4b7259;return this[_0x4a60d7(0x87)];}}exports[a38_0x4b7259(0xc1)]=CurrencyService,exports[a38_0x4b7259(0xcc)]=new CurrencyService();