'use strict';const a43_0x198360=a43_0x1f51;(function(_0x39cfa8,_0x260914){const _0x490be9=a43_0x1f51,_0x2e4cca=_0x39cfa8();while(!![]){try{const _0x2cf10a=parseInt(_0x490be9(0x1ea))/0x1*(-parseInt(_0x490be9(0x235))/0x2)+parseInt(_0x490be9(0x21e))/0x3*(-parseInt(_0x490be9(0x214))/0x4)+parseInt(_0x490be9(0x257))/0x5+-parseInt(_0x490be9(0x249))/0x6+parseInt(_0x490be9(0x256))/0x7+-parseInt(_0x490be9(0x1f0))/0x8+parseInt(_0x490be9(0x1f1))/0x9*(parseInt(_0x490be9(0x216))/0xa);if(_0x2cf10a===_0x260914)break;else _0x2e4cca['push'](_0x2e4cca['shift']());}catch(_0x5e1eec){_0x2e4cca['push'](_0x2e4cca['shift']());}}}(a43_0x5181,0x19725));var __importDefault=this&&this[a43_0x198360(0x20c)]||function(_0x5a3cf9){const _0x17b362=a43_0x198360;return _0x5a3cf9&&_0x5a3cf9[_0x17b362(0x248)]?_0x5a3cf9:{'default':_0x5a3cf9};};Object[a43_0x198360(0x212)](exports,a43_0x198360(0x248),{'value':!![]}),exports[a43_0x198360(0x224)]=exports[a43_0x198360(0x239)]=void 0x0;function a43_0x1f51(_0x45f13c,_0x2008d2){const _0x5181f2=a43_0x5181();return a43_0x1f51=function(_0x1f5159,_0x4e424d){_0x1f5159=_0x1f5159-0x1e7;let _0x353d79=_0x5181f2[_0x1f5159];return _0x353d79;},a43_0x1f51(_0x45f13c,_0x2008d2);}const database_1=__importDefault(require(a43_0x198360(0x1fd)));class CurrencyService{constructor(){const _0x15830e=a43_0x198360;this[_0x15830e(0x20d)]=_0x15830e(0x1fc),this[_0x15830e(0x217)]=['btc',_0x15830e(0x23d),_0x15830e(0x24e),'bch',_0x15830e(0x20a),_0x15830e(0x25a),'xrp',_0x15830e(0x218),_0x15830e(0x24f),_0x15830e(0x202),_0x15830e(0x205),_0x15830e(0x238),'aed',_0x15830e(0x22d),_0x15830e(0x231),_0x15830e(0x1ee),_0x15830e(0x22f),'bmd',_0x15830e(0x258),_0x15830e(0x209),_0x15830e(0x23e),'clp','cny',_0x15830e(0x1f8),_0x15830e(0x23a),_0x15830e(0x23f),_0x15830e(0x252),_0x15830e(0x222),'hkd',_0x15830e(0x246),_0x15830e(0x213),_0x15830e(0x233),_0x15830e(0x1ec),_0x15830e(0x1f6),'krw','kwd',_0x15830e(0x20b),'mmk',_0x15830e(0x208),_0x15830e(0x1e7),_0x15830e(0x1fe),_0x15830e(0x200),_0x15830e(0x1ed),_0x15830e(0x204),_0x15830e(0x1f2),_0x15830e(0x1fa),_0x15830e(0x1ef),_0x15830e(0x1ff),_0x15830e(0x243),_0x15830e(0x22c),'thb',_0x15830e(0x254),'twd',_0x15830e(0x21a),_0x15830e(0x206),'vnd','zar',_0x15830e(0x250),_0x15830e(0x240),_0x15830e(0x1f5),_0x15830e(0x247),_0x15830e(0x242)],this[_0x15830e(0x20f)]=null,this[_0x15830e(0x24c)]=-0x3,this[_0x15830e(0x241)]();}[a43_0x198360(0x241)](){const _0x139505=a43_0x198360;this[_0x139505(0x236)]()['catch'](_0x1defcc=>{const _0x56e0be=_0x139505;console[_0x56e0be(0x228)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x1defcc);}),this[_0x139505(0x20f)]=setInterval(async()=>{const _0x3d5d0b=_0x139505;try{await this[_0x3d5d0b(0x236)]();}catch(_0x494ccf){console['error'](_0x3d5d0b(0x226),_0x494ccf);}},0x3c*0x3c*0x3e8),console[_0x139505(0x1f7)](_0x139505(0x23b));}[a43_0x198360(0x219)](){const _0x56db51=a43_0x198360;this[_0x56db51(0x20f)]&&(clearInterval(this['updateInterval']),this[_0x56db51(0x20f)]=null,console[_0x56db51(0x1f7)](_0x56db51(0x255)));}async[a43_0x198360(0x236)](){const _0x477ea7=a43_0x198360;try{console[_0x477ea7(0x1f7)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x1ce583=this['CURRENCIES']['join'](','),_0x25be53=this[_0x477ea7(0x20d)]+_0x477ea7(0x24d)+_0x1ce583,_0x1dedf3=await fetch(_0x25be53,{'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}});if(!_0x1dedf3['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1dedf3[_0x477ea7(0x201)]+'\x20'+_0x1dedf3['statusText']);const _0xbb9957=await _0x1dedf3['json']();if(!_0xbb9957['tether'])throw new Error(_0x477ea7(0x1e9));const _0x322b78=_0xbb9957[_0x477ea7(0x245)];console[_0x477ea7(0x1f7)](_0x477ea7(0x259)+Object[_0x477ea7(0x230)](_0x322b78)[_0x477ea7(0x215)]+_0x477ea7(0x220));const _0x3e6b50=Object[_0x477ea7(0x22b)](_0x322b78)['map'](async([_0x236bda,_0x17f8dc])=>{const _0x106370=_0x477ea7;try{await database_1[_0x106370(0x1f3)]['currencyRate'][_0x106370(0x244)]({'where':{'currency':_0x236bda[_0x106370(0x21f)]()},'update':{'rate':_0x17f8dc},'create':{'currency':_0x236bda[_0x106370(0x21f)](),'rate':_0x17f8dc}});}catch(_0x370838){console[_0x106370(0x228)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x236bda+':',_0x370838);}});await Promise['allSettled'](_0x3e6b50),console['log']('‚úÖ\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4efe8b){console[_0x477ea7(0x228)](_0x477ea7(0x1e8),_0x4efe8b);throw _0x4efe8b;}}async['getCurrencyRate'](_0xeacee7){const _0x21fee6=a43_0x198360,_0x21976d=_0xeacee7['toLowerCase']();if(_0x21976d===_0x21fee6(0x223))return 0x1;try{const _0x1906ab=await database_1[_0x21fee6(0x1f3)][_0x21fee6(0x24b)][_0x21fee6(0x1eb)]({'where':{'currency':_0x21976d}});if(!_0x1906ab)return console[_0x21fee6(0x23c)](_0x21fee6(0x234)+_0xeacee7+_0x21fee6(0x225)),0x1;return _0x1906ab[_0x21fee6(0x21c)];}catch(_0x305fe8){return console[_0x21fee6(0x228)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0xeacee7+':',_0x305fe8),0x1;}}async[a43_0x198360(0x229)](_0x268b3b,_0x265589){const _0x5f3727=a43_0x198360,_0x40562b=_0x265589[_0x5f3727(0x21f)]();if(_0x40562b===_0x5f3727(0x223)){const _0x4bfe72=_0x268b3b*(0x1+this[_0x5f3727(0x24c)]/0x64);return console[_0x5f3727(0x1f7)](_0x5f3727(0x20e)+this[_0x5f3727(0x24c)]+_0x5f3727(0x207)+_0x268b3b+'\x20USDT\x20=\x20'+_0x4bfe72[_0x5f3727(0x253)](0x6)+_0x5f3727(0x211)),_0x4bfe72;}try{const _0x5daa8e=await this[_0x5f3727(0x237)](_0x40562b),_0x55bd65=_0x268b3b/_0x5daa8e,_0x1b7f4f=_0x55bd65*(0x1+this[_0x5f3727(0x24c)]/0x64);return console[_0x5f3727(0x1f7)]('üí±\x20Converted\x20'+_0x268b3b+'\x20'+_0x265589['toUpperCase']()+_0x5f3727(0x232)+_0x55bd65[_0x5f3727(0x253)](0x6)+'\x20USDT,\x20with\x20'+this[_0x5f3727(0x24c)]+_0x5f3727(0x221)+_0x1b7f4f[_0x5f3727(0x253)](0x6)+_0x5f3727(0x1f4)+_0x5daa8e+')'),_0x1b7f4f;}catch(_0x21a03a){console['error']('Error\x20converting\x20'+_0x268b3b+'\x20'+_0x265589+_0x5f3727(0x22e),_0x21a03a);const _0x3d98b5=_0x268b3b*(0x1+this[_0x5f3727(0x24c)]/0x64);return _0x3d98b5;}}async[a43_0x198360(0x210)](_0x638e58){let _0x1a921d=0x0;for(const {amount:_0x156ec6,currency:_0x1b3050}of _0x638e58){const _0x21deea=await this['convertToUSDT'](_0x156ec6,_0x1b3050);_0x1a921d+=_0x21deea;}return _0x1a921d;}async[a43_0x198360(0x227)](){const _0x16dc5f=a43_0x198360;try{const _0x452716=await database_1['default']['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1521f9={'usdt':0x1};return _0x452716['forEach'](_0x19f172=>{const _0xdc6921=a43_0x1f51;_0x1521f9[_0x19f172[_0xdc6921(0x21b)]]=_0x19f172[_0xdc6921(0x21c)];}),_0x1521f9;}catch(_0x3eba0a){return console['error'](_0x16dc5f(0x251),_0x3eba0a),{'usdt':0x1};}}async[a43_0x198360(0x203)](){const _0x45f544=a43_0x198360;try{const [_0x3311e7,_0xdefc6,_0x26475b]=await Promise[_0x45f544(0x1fb)]([database_1['default']['currencyRate']['count'](),database_1[_0x45f544(0x1f3)][_0x45f544(0x24b)][_0x45f544(0x21d)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x45f544(0x1f3)][_0x45f544(0x24b)][_0x45f544(0x21d)]({'orderBy':{'updatedAt':_0x45f544(0x1f9)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3311e7,'lastUpdated':_0xdefc6?.['updatedAt']||null,'oldestRate':_0x26475b?.[_0x45f544(0x22a)]||null,'markupPercentage':this[_0x45f544(0x24c)]};}catch(_0x455c9b){return console[_0x45f544(0x228)](_0x45f544(0x24a),_0x455c9b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x45f544(0x24c)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}function a43_0x5181(){const _0x467b7b=['https://api.coingecko.com/api/v3/simple/price','../config/database','ngn','sar','nok','status','dot','getRatesStatus','php','yfi','vef','%\x20markup\x20to\x20','mxn','cad','bnb','lkr','__importDefault','COINGECKO_URL','üí±\x20Applied\x20','updateInterval','convertMultipleToUSDT','\x20USDT','defineProperty','idr','1192YDpoIq','length','232850zesMPu','CURRENCIES','xlm','stopPeriodicUpdates','uah','currency','rate','findFirst','939SLkvNs','toLowerCase','\x20currencies','%\x20markup\x20=\x20','gel','usdt','currencyService',',\x20using\x201\x20as\x20fallback','Periodic\x20currency\x20rates\x20update\x20failed:','getAllRates','error','convertToUSDT','updatedAt','entries','sgd','ars','\x20to\x20USDT:','bhd','keys','aud','\x20to\x20','ils','No\x20rate\x20found\x20for\x20currency:\x20','13796rNvCfW','updateCurrencyRates','getCurrencyRate','usd','CurrencyService','dkk','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','warn','eth','chf','eur','xag','startPeriodicUpdates','sats','sek','upsert','tether','huf','bits','__esModule','356280JGyXAE','Error\x20getting\x20rates\x20status:','currencyRate','MARKUP_PERCENTAGE','?ids=tether&vs_currencies=','ltc','link','xdr','Error\x20getting\x20all\x20rates:','gbp','toFixed','try','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','230027YnwCjR','317590iaKPhz','brl','üìä\x20Received\x20rates\x20for\x20','eos','myr','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','17CxMfxv','findUnique','inr','nzd','bdt','rub','199480GsNbbo','117YKdQZb','pkr','default','\x20USDT\x20(rate:\x20','xau','jpy','log','czk','asc','pln','all'];a43_0x5181=function(){return _0x467b7b;};return a43_0x5181();}exports[a43_0x198360(0x239)]=CurrencyService,exports[a43_0x198360(0x224)]=new CurrencyService();