'use strict';const a38_0x107986=a38_0xf77a;(function(_0x16ffdc,_0x2e8676){const _0x56e912=a38_0xf77a,_0x29d37a=_0x16ffdc();while(!![]){try{const _0x572b11=parseInt(_0x56e912(0x1d0))/0x1*(-parseInt(_0x56e912(0x1b4))/0x2)+parseInt(_0x56e912(0x1bd))/0x3*(-parseInt(_0x56e912(0x1fb))/0x4)+-parseInt(_0x56e912(0x1b0))/0x5+parseInt(_0x56e912(0x1fd))/0x6+-parseInt(_0x56e912(0x20c))/0x7*(-parseInt(_0x56e912(0x18e))/0x8)+-parseInt(_0x56e912(0x190))/0x9*(-parseInt(_0x56e912(0x1c4))/0xa)+parseInt(_0x56e912(0x19c))/0xb;if(_0x572b11===_0x2e8676)break;else _0x29d37a['push'](_0x29d37a['shift']());}catch(_0x3ac726){_0x29d37a['push'](_0x29d37a['shift']());}}}(a38_0x1a35,0x4744e));var __importDefault=this&&this[a38_0x107986(0x1d7)]||function(_0x4a2590){const _0x5a55e1=a38_0x107986;return _0x4a2590&&_0x4a2590[_0x5a55e1(0x217)]?_0x4a2590:{'default':_0x4a2590};};Object[a38_0x107986(0x1a8)](exports,'__esModule',{'value':!![]}),exports[a38_0x107986(0x1e8)]=exports[a38_0x107986(0x18c)]=void 0x0;const database_1=__importDefault(require(a38_0x107986(0x1ab)));function a38_0x1a35(){const _0x5dad49=['yfi','uah','dkk','chf','map','xrp','pkr','forEach','aud','Error\x20getting\x20rates\x20status:','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','json','toLowerCase','gel','currencyService','\x20to\x20USDT:','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','myr','bnb','join','ils','Initial\x20currency\x20rates\x20update\x20failed:','💱\x20Applied\x20','twd','xag','getCurrencyRate','TesSoft\x20Payment\x20System/1.0','jpy','xlm','✅\x20Currency\x20rates\x20updated\x20successfully','log','sek','btc','604qtIhrM','tether','1157922YxIjbl','eth','currencyRate','mmk','getMarkupPercentage','huf','sgd','cny','link','%\x20markup\x20=\x20','toUpperCase','MARKUP_PERCENTAGE','CoinGecko\x20API\x20error:\x20','cad','?ids=tether&vs_currencies=','238707gDIbvc','lkr','📊\x20Received\x20rates\x20for\x20','php','vnd','bch','\x20to\x20','inr','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Failed\x20to\x20update\x20rate\x20for\x20','idr','__esModule','\x20USDT','catch','try','CurrencyService',',\x20using\x201\x20as\x20fallback','40ztAVsO','%\x20markup\x20to\x20','54FkNtRe','❌\x20Failed\x20to\x20update\x20currency\x20rates:','bits','nzd','thb','clp','ngn','keys','findFirst','usd','Error\x20getting\x20all\x20rates:','asc','7305012fVuUKQ','updateInterval','all','bmd','Error\x20converting\x20','Periodic\x20currency\x20rates\x20update\x20failed:','convertToUSDT','dot','kwd','\x20USDT,\x20with\x20','COINGECKO_URL','count','defineProperty','usdt','sar','../config/database','\x20currencies','findUnique','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','application/json','2387940ZlVuVN','desc','rate','findMany','2dFcMBL','eur','allSettled','ltc','\x20USDT\x20(rate:\x20','krw','zar','upsert','💱\x20Converted\x20','5595qFfDTZ','error','getRatesStatus','aed','entries','statusText','convertMultipleToUSDT','933260yQiqAY','rub','ars','https://api.coingecko.com/api/v3/simple/price','sats','vef','updateCurrencyRates','No\x20rate\x20found\x20for\x20currency:\x20','warn','startPeriodicUpdates','\x20USDT\x20=\x20','updatedAt','536419GLjEWC','default','pln','toFixed','mxn','nok','CURRENCIES','__importDefault','xdr','length'];a38_0x1a35=function(){return _0x5dad49;};return a38_0x1a35();}class CurrencyService{constructor(){const _0x32b846=a38_0x107986;this[_0x32b846(0x1a6)]=_0x32b846(0x1c7),this[_0x32b846(0x1d6)]=[_0x32b846(0x1fa),_0x32b846(0x1fe),_0x32b846(0x1b7),_0x32b846(0x211),_0x32b846(0x1ec),'eos',_0x32b846(0x1df),_0x32b846(0x1f6),_0x32b846(0x205),_0x32b846(0x1a3),_0x32b846(0x1da),_0x32b846(0x199),_0x32b846(0x1c0),_0x32b846(0x1c6),_0x32b846(0x1e2),'bdt','bhd',_0x32b846(0x19f),'brl',_0x32b846(0x20a),_0x32b846(0x1dd),_0x32b846(0x195),_0x32b846(0x204),'czk',_0x32b846(0x1dc),_0x32b846(0x1b5),'gbp',_0x32b846(0x1e7),'hkd',_0x32b846(0x202),_0x32b846(0x216),_0x32b846(0x1ee),_0x32b846(0x213),_0x32b846(0x1f5),_0x32b846(0x1b9),_0x32b846(0x1a4),_0x32b846(0x20d),_0x32b846(0x200),_0x32b846(0x1d4),_0x32b846(0x1eb),_0x32b846(0x196),_0x32b846(0x1d5),_0x32b846(0x193),_0x32b846(0x20f),_0x32b846(0x1e0),_0x32b846(0x1d2),_0x32b846(0x1c5),_0x32b846(0x1aa),_0x32b846(0x1f9),_0x32b846(0x203),_0x32b846(0x194),_0x32b846(0x18b),_0x32b846(0x1f1),_0x32b846(0x1db),_0x32b846(0x1c9),_0x32b846(0x210),_0x32b846(0x1ba),_0x32b846(0x1d8),_0x32b846(0x1f2),'xau',_0x32b846(0x192),_0x32b846(0x1c8)],this['updateInterval']=null,this[_0x32b846(0x208)]=0x3,this['startPeriodicUpdates']();}[a38_0x107986(0x1cd)](){const _0x503385=a38_0x107986;this[_0x503385(0x1ca)]()[_0x503385(0x219)](_0x2f4007=>{const _0x1d31d8=_0x503385;console[_0x1d31d8(0x1be)](_0x1d31d8(0x1ef),_0x2f4007);}),this[_0x503385(0x19d)]=setInterval(async()=>{const _0x554786=_0x503385;try{await this[_0x554786(0x1ca)]();}catch(_0x20e107){console[_0x554786(0x1be)](_0x554786(0x1a1),_0x20e107);}},0x3c*0x3c*0x3e8),console[_0x503385(0x1f8)](_0x503385(0x214));}['stopPeriodicUpdates'](){const _0x3fe59a=a38_0x107986;this[_0x3fe59a(0x19d)]&&(clearInterval(this[_0x3fe59a(0x19d)]),this[_0x3fe59a(0x19d)]=null,console[_0x3fe59a(0x1f8)](_0x3fe59a(0x1e4)));}async[a38_0x107986(0x1ca)](){const _0x79803b=a38_0x107986;try{console['log'](_0x79803b(0x1ae));const _0x593d34=this[_0x79803b(0x1d6)][_0x79803b(0x1ed)](','),_0x2cb330=this['COINGECKO_URL']+_0x79803b(0x20b)+_0x593d34,_0x4771bc=await fetch(_0x2cb330,{'headers':{'Accept':_0x79803b(0x1af),'User-Agent':_0x79803b(0x1f4)}});if(!_0x4771bc['ok'])throw new Error(_0x79803b(0x209)+_0x4771bc['status']+'\x20'+_0x4771bc[_0x79803b(0x1c2)]);const _0x23ce5c=await _0x4771bc[_0x79803b(0x1e5)]();if(!_0x23ce5c[_0x79803b(0x1fc)])throw new Error(_0x79803b(0x1ea));const _0x23f4c9=_0x23ce5c[_0x79803b(0x1fc)];console['log'](_0x79803b(0x20e)+Object[_0x79803b(0x197)](_0x23f4c9)[_0x79803b(0x1d9)]+_0x79803b(0x1ac));const _0x5c896d=Object[_0x79803b(0x1c1)](_0x23f4c9)[_0x79803b(0x1de)](async([_0x4f002f,_0x1e41ee])=>{const _0x581c46=_0x79803b;try{await database_1[_0x581c46(0x1d1)][_0x581c46(0x1ff)][_0x581c46(0x1bb)]({'where':{'currency':_0x4f002f[_0x581c46(0x1e6)]()},'update':{'rate':_0x1e41ee},'create':{'currency':_0x4f002f['toLowerCase'](),'rate':_0x1e41ee}});}catch(_0x59308c){console['error'](_0x581c46(0x215)+_0x4f002f+':',_0x59308c);}});await Promise[_0x79803b(0x1b6)](_0x5c896d),console[_0x79803b(0x1f8)](_0x79803b(0x1f7));}catch(_0x2369f3){console[_0x79803b(0x1be)](_0x79803b(0x191),_0x2369f3);throw _0x2369f3;}}async['getCurrencyRate'](_0x36d172){const _0xc45de8=a38_0x107986,_0x28fc67=_0x36d172[_0xc45de8(0x1e6)]();if(_0x28fc67===_0xc45de8(0x1a9))return 0x1;try{const _0x2d8145=await database_1['default'][_0xc45de8(0x1ff)][_0xc45de8(0x1ad)]({'where':{'currency':_0x28fc67}});if(!_0x2d8145)return console[_0xc45de8(0x1cc)](_0xc45de8(0x1cb)+_0x36d172+_0xc45de8(0x18d)),0x1;return _0x2d8145[_0xc45de8(0x1b2)];}catch(_0x55d504){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x36d172+':',_0x55d504),0x1;}}async[a38_0x107986(0x1a2)](_0x5f5db3,_0x827515){const _0x1230b7=a38_0x107986,_0x17e570=_0x827515[_0x1230b7(0x1e6)]();if(_0x17e570==='usdt'){const _0x580915=_0x5f5db3*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x1230b7(0x1f0)+this[_0x1230b7(0x208)]+_0x1230b7(0x18f)+_0x5f5db3+_0x1230b7(0x1ce)+_0x580915['toFixed'](0x6)+_0x1230b7(0x218)),_0x580915;}try{const _0x5516f2=await this[_0x1230b7(0x1f3)](_0x17e570),_0x242caf=_0x5f5db3/_0x5516f2,_0x140a6d=_0x242caf*(0x1+this[_0x1230b7(0x208)]/0x64);return console[_0x1230b7(0x1f8)](_0x1230b7(0x1bc)+_0x5f5db3+'\x20'+_0x827515[_0x1230b7(0x207)]()+_0x1230b7(0x212)+_0x242caf[_0x1230b7(0x1d3)](0x6)+_0x1230b7(0x1a5)+this[_0x1230b7(0x208)]+_0x1230b7(0x206)+_0x140a6d[_0x1230b7(0x1d3)](0x6)+_0x1230b7(0x1b8)+_0x5516f2+')'),_0x140a6d;}catch(_0x4e5521){console['error'](_0x1230b7(0x1a0)+_0x5f5db3+'\x20'+_0x827515+_0x1230b7(0x1e9),_0x4e5521);const _0x25c85e=_0x5f5db3*(0x1+this[_0x1230b7(0x208)]/0x64);return _0x25c85e;}}async[a38_0x107986(0x1c3)](_0x40cafe){const _0x3fcc58=a38_0x107986;let _0xd7e5c4=0x0;for(const {amount:_0x41f588,currency:_0xaffcab}of _0x40cafe){const _0x32322b=await this[_0x3fcc58(0x1a2)](_0x41f588,_0xaffcab);_0xd7e5c4+=_0x32322b;}return _0xd7e5c4;}async['getAllRates'](){const _0xbd8bc4=a38_0x107986;try{const _0x1b5eea=await database_1[_0xbd8bc4(0x1d1)][_0xbd8bc4(0x1ff)][_0xbd8bc4(0x1b3)]({'select':{'currency':!![],'rate':!![]}}),_0x3f3368={'usdt':0x1};return _0x1b5eea[_0xbd8bc4(0x1e1)](_0x19d6bc=>{const _0xe04660=_0xbd8bc4;_0x3f3368[_0x19d6bc['currency']]=_0x19d6bc[_0xe04660(0x1b2)];}),_0x3f3368;}catch(_0x6c6fd4){return console['error'](_0xbd8bc4(0x19a),_0x6c6fd4),{'usdt':0x1};}}async[a38_0x107986(0x1bf)](){const _0x56a64d=a38_0x107986;try{const [_0x443e72,_0x5feb3a,_0x196bf5]=await Promise[_0x56a64d(0x19e)]([database_1[_0x56a64d(0x1d1)][_0x56a64d(0x1ff)][_0x56a64d(0x1a7)](),database_1[_0x56a64d(0x1d1)][_0x56a64d(0x1ff)][_0x56a64d(0x198)]({'orderBy':{'updatedAt':_0x56a64d(0x1b1)},'select':{'updatedAt':!![]}}),database_1[_0x56a64d(0x1d1)][_0x56a64d(0x1ff)][_0x56a64d(0x198)]({'orderBy':{'updatedAt':_0x56a64d(0x19b)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x443e72,'lastUpdated':_0x5feb3a?.[_0x56a64d(0x1cf)]||null,'oldestRate':_0x196bf5?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x2bb35d){return console[_0x56a64d(0x1be)](_0x56a64d(0x1e3),_0x2bb35d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x56a64d(0x208)]};}}[a38_0x107986(0x201)](){const _0x34acfb=a38_0x107986;return this[_0x34acfb(0x208)];}}function a38_0xf77a(_0x2582e2,_0x23289c){const _0x1a3535=a38_0x1a35();return a38_0xf77a=function(_0xf77a1a,_0x26a646){_0xf77a1a=_0xf77a1a-0x18b;let _0x542ed9=_0x1a3535[_0xf77a1a];return _0x542ed9;},a38_0xf77a(_0x2582e2,_0x23289c);}exports['CurrencyService']=CurrencyService,exports[a38_0x107986(0x1e8)]=new CurrencyService();