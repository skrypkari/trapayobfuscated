'use strict';function a58_0x19aa(_0x3f5e61,_0x40d697){_0x3f5e61=_0x3f5e61-0xfc;const _0x11086f=a58_0x1108();let _0x19aaf9=_0x11086f[_0x3f5e61];return _0x19aaf9;}const a58_0x253ba6=a58_0x19aa;function a58_0x1108(){const _0x4e6dcd=['cny','warn','42CUlUEs','pkr','xrp','getCurrencyRate','bnb','forEach','mmk','https://api.coingecko.com/api/v3/simple/price','status','ðŸ’±\x20Applied\x20','xdr','rub','bhd','CurrencyService','sek','\x20currencies','default','toLowerCase','hkd','MARKUP_PERCENTAGE','\x20USDT,\x20with\x20','1149498WBcUop','Error\x20converting\x20','defineProperty','ltc','bmd','count','aud','vnd','keys','Payment\x20System/1.0','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','%\x20markup\x20=\x20','yfi','log','nok','kwd','Periodic\x20currency\x20rates\x20update\x20failed:','getRatesStatus','ils','\x20to\x20USDT:','Failed\x20to\x20update\x20rate\x20for\x20','toUpperCase','length','currencyRate','dot','lkr','bch','convertToUSDT','error','try','czk','aed','convertMultipleToUSDT','gel',',\x20using\x201\x20as\x20fallback','updateCurrencyRates','\x20USDT\x20=\x20','findUnique','Error\x20getting\x20rates\x20status:','thb','usdt','?ids=tether&vs_currencies=','xlm','clp','CURRENCIES','1397484xkBlIJ','tether','\x20USDT','5446704jkdNPA','ðŸ“Š\x20Received\x20rates\x20for\x20','442312BjonMm','__importDefault','../config/database','php','startPeriodicUpdates','868149bymNvc','ðŸ’±\x20Converted\x20','COINGECKO_URL','nzd','gbp','upsert','join','156243Scrnmg','application/json','65mlRKSS','zar','huf','map','eth','brl','findFirst','\x20USDT\x20(rate:\x20','updateInterval','ngn','Error\x20getting\x20rate\x20for\x20currency\x20','CoinGecko\x20API\x20error:\x20','all','statusText','vef','getMarkupPercentage','toFixed','50310639XvfVYq','inr','__esModule','sar','json','eos','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','rate','asc','bits','dkk','xag','xau'];a58_0x1108=function(){return _0x4e6dcd;};return a58_0x1108();}(function(_0x435125,_0x4d9c3f){const _0x59b019=a58_0x19aa,_0x481e26=_0x435125();while(!![]){try{const _0x55f599=-parseInt(_0x59b019(0x146))/0x1+-parseInt(_0x59b019(0x13c))/0x2+parseInt(_0x59b019(0x14d))/0x3+-parseInt(_0x59b019(0x141))/0x4*(parseInt(_0x59b019(0x14f))/0x5)+parseInt(_0x59b019(0x10e))/0x6*(-parseInt(_0x59b019(0x16f))/0x7)+-parseInt(_0x59b019(0x13f))/0x8+parseInt(_0x59b019(0x160))/0x9;if(_0x55f599===_0x4d9c3f)break;else _0x481e26['push'](_0x481e26['shift']());}catch(_0x3830ed){_0x481e26['push'](_0x481e26['shift']());}}}(a58_0x1108,0xc51f3));var __importDefault=this&&this[a58_0x253ba6(0x142)]||function(_0x11646c){return _0x11646c&&_0x11646c['__esModule']?_0x11646c:{'default':_0x11646c};};Object[a58_0x253ba6(0x110)](exports,a58_0x253ba6(0x162),{'value':!![]}),exports['currencyService']=exports[a58_0x253ba6(0x106)]=void 0x0;const database_1=__importDefault(require(a58_0x253ba6(0x143)));class CurrencyService{constructor(){const _0x23046a=a58_0x253ba6;this[_0x23046a(0x148)]=_0x23046a(0x100),this[_0x23046a(0x13b)]=['btc',_0x23046a(0x153),_0x23046a(0x111),_0x23046a(0x129),_0x23046a(0xfd),_0x23046a(0x165),_0x23046a(0x171),_0x23046a(0x139),'link',_0x23046a(0x127),_0x23046a(0x11b),'usd',_0x23046a(0x12e),'ars',_0x23046a(0x114),'bdt',_0x23046a(0x105),_0x23046a(0x112),_0x23046a(0x154),'cad','chf',_0x23046a(0x13a),_0x23046a(0x16d),_0x23046a(0x12d),_0x23046a(0x16a),'eur',_0x23046a(0x14a),_0x23046a(0x130),_0x23046a(0x10b),_0x23046a(0x151),'idr',_0x23046a(0x121),_0x23046a(0x161),'jpy','krw',_0x23046a(0x11e),_0x23046a(0x128),_0x23046a(0xff),'mxn','myr',_0x23046a(0x158),_0x23046a(0x11d),_0x23046a(0x149),_0x23046a(0x144),_0x23046a(0x170),'pln',_0x23046a(0x104),_0x23046a(0x163),_0x23046a(0x107),'sgd',_0x23046a(0x136),_0x23046a(0x12c),'twd','uah',_0x23046a(0x15d),_0x23046a(0x115),_0x23046a(0x150),_0x23046a(0x103),_0x23046a(0x16b),_0x23046a(0x16c),_0x23046a(0x169),'sats'],this[_0x23046a(0x157)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x23046a(0x145)]();}['startPeriodicUpdates'](){const _0x2a58e2=a58_0x253ba6;this['updateCurrencyRates']()['catch'](_0x26c30b=>{const _0x58be07=a58_0x19aa;console[_0x58be07(0x12b)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x26c30b);}),this['updateInterval']=setInterval(async()=>{const _0xbc13d2=a58_0x19aa;try{await this[_0xbc13d2(0x132)]();}catch(_0x55aba4){console['error'](_0xbc13d2(0x11f),_0x55aba4);}},0x3c*0x3c*0x3e8),console[_0x2a58e2(0x11c)](_0x2a58e2(0x119));}['stopPeriodicUpdates'](){const _0x5b6b08=a58_0x253ba6;this[_0x5b6b08(0x157)]&&(clearInterval(this[_0x5b6b08(0x157)]),this['updateInterval']=null,console[_0x5b6b08(0x11c)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a58_0x253ba6(0x132)](){const _0xb80495=a58_0x253ba6;try{console[_0xb80495(0x11c)](_0xb80495(0x118));const _0x3caf84=this[_0xb80495(0x13b)][_0xb80495(0x14c)](','),_0x3e283b=this[_0xb80495(0x148)]+_0xb80495(0x138)+_0x3caf84,_0x17e6b1=await fetch(_0x3e283b,{'headers':{'Accept':_0xb80495(0x14e),'User-Agent':_0xb80495(0x117)}});if(!_0x17e6b1['ok'])throw new Error(_0xb80495(0x15a)+_0x17e6b1[_0xb80495(0x101)]+'\x20'+_0x17e6b1[_0xb80495(0x15c)]);const _0x148bf4=await _0x17e6b1[_0xb80495(0x164)]();if(!_0x148bf4[_0xb80495(0x13d)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x14d7d8=_0x148bf4[_0xb80495(0x13d)];console[_0xb80495(0x11c)](_0xb80495(0x140)+Object[_0xb80495(0x116)](_0x14d7d8)[_0xb80495(0x125)]+_0xb80495(0x108));const _0x115d8f=0x5,_0x24b3f0=Object['entries'](_0x14d7d8);for(let _0x593470=0x0;_0x593470<_0x24b3f0[_0xb80495(0x125)];_0x593470+=_0x115d8f){const _0x3ad16d=_0x24b3f0['slice'](_0x593470,_0x593470+_0x115d8f),_0x293418=_0x3ad16d[_0xb80495(0x152)](async([_0x12bd10,_0x4153b3])=>{const _0x30a642=_0xb80495;try{await database_1[_0x30a642(0x109)][_0x30a642(0x126)][_0x30a642(0x14b)]({'where':{'currency':_0x12bd10[_0x30a642(0x10a)]()},'update':{'rate':_0x4153b3},'create':{'currency':_0x12bd10[_0x30a642(0x10a)](),'rate':_0x4153b3}});}catch(_0xf2767){console[_0x30a642(0x12b)](_0x30a642(0x123)+_0x12bd10+':',_0xf2767);}});await Promise[_0xb80495(0x15b)](_0x293418);}console[_0xb80495(0x11c)]('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x4fd305){console[_0xb80495(0x12b)](_0xb80495(0x166),_0x4fd305);throw _0x4fd305;}}async['getCurrencyRate'](_0x6c55e9){const _0x5aeadc=a58_0x253ba6,_0x5880bd=_0x6c55e9['toLowerCase']();if(_0x5880bd==='usdt')return 0x1;try{const _0x1a7c50=await database_1['default']['currencyRate'][_0x5aeadc(0x134)]({'where':{'currency':_0x5880bd}});if(!_0x1a7c50)return console[_0x5aeadc(0x16e)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x6c55e9+_0x5aeadc(0x131)),0x1;return _0x1a7c50['rate'];}catch(_0x3b62de){return console[_0x5aeadc(0x12b)](_0x5aeadc(0x159)+_0x6c55e9+':',_0x3b62de),0x1;}}async[a58_0x253ba6(0x12a)](_0x4f4d6b,_0x2bd70a){const _0x34abfb=a58_0x253ba6,_0x38966c=_0x2bd70a['toLowerCase']();if(_0x38966c===_0x34abfb(0x137)){const _0xa780ce=_0x4f4d6b*(0x1+this[_0x34abfb(0x10c)]/0x64);return console[_0x34abfb(0x11c)](_0x34abfb(0x102)+this[_0x34abfb(0x10c)]+'%\x20markup\x20to\x20'+_0x4f4d6b+_0x34abfb(0x133)+_0xa780ce['toFixed'](0x6)+_0x34abfb(0x13e)),_0xa780ce;}try{const _0x100f2e=await this[_0x34abfb(0xfc)](_0x38966c),_0x57df52=_0x4f4d6b/_0x100f2e,_0x51b3a8=_0x57df52*(0x1+this[_0x34abfb(0x10c)]/0x64);return console['log'](_0x34abfb(0x147)+_0x4f4d6b+'\x20'+_0x2bd70a[_0x34abfb(0x124)]()+'\x20to\x20'+_0x57df52['toFixed'](0x6)+_0x34abfb(0x10d)+this[_0x34abfb(0x10c)]+_0x34abfb(0x11a)+_0x51b3a8[_0x34abfb(0x15f)](0x6)+_0x34abfb(0x156)+_0x100f2e+')'),_0x51b3a8;}catch(_0x3806b5){console[_0x34abfb(0x12b)](_0x34abfb(0x10f)+_0x4f4d6b+'\x20'+_0x2bd70a+_0x34abfb(0x122),_0x3806b5);const _0xf61d40=_0x4f4d6b*(0x1+this[_0x34abfb(0x10c)]/0x64);return _0xf61d40;}}async[a58_0x253ba6(0x12f)](_0x579eb5){let _0x921155=0x0;for(const {amount:_0x2571a2,currency:_0x3d31b6}of _0x579eb5){const _0x1e8e21=await this['convertToUSDT'](_0x2571a2,_0x3d31b6);_0x921155+=_0x1e8e21;}return _0x921155;}async['getAllRates'](){const _0x340aa6=a58_0x253ba6;try{const _0x4e6196=await database_1[_0x340aa6(0x109)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x42e6f3={'usdt':0x1};return _0x4e6196[_0x340aa6(0xfe)](_0x5d46fe=>{const _0x31ef68=_0x340aa6;_0x42e6f3[_0x5d46fe['currency']]=_0x5d46fe[_0x31ef68(0x167)];}),_0x42e6f3;}catch(_0x519426){return console[_0x340aa6(0x12b)]('Error\x20getting\x20all\x20rates:',_0x519426),{'usdt':0x1};}}async[a58_0x253ba6(0x120)](){const _0x24488=a58_0x253ba6;try{const [_0x5b61f3,_0x2375d2,_0x174601]=await Promise[_0x24488(0x15b)]([database_1['default'][_0x24488(0x126)][_0x24488(0x113)](),database_1['default'][_0x24488(0x126)][_0x24488(0x155)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x24488(0x126)][_0x24488(0x155)]({'orderBy':{'updatedAt':_0x24488(0x168)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5b61f3,'lastUpdated':_0x2375d2?.['updatedAt']||null,'oldestRate':_0x174601?.['updatedAt']||null,'markupPercentage':this[_0x24488(0x10c)]};}catch(_0x361112){return console[_0x24488(0x12b)](_0x24488(0x135),_0x361112),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x24488(0x10c)]};}}[a58_0x253ba6(0x15e)](){const _0x2da8e8=a58_0x253ba6;return this[_0x2da8e8(0x10c)];}}exports[a58_0x253ba6(0x106)]=CurrencyService,exports['currencyService']=new CurrencyService();