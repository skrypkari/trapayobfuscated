'use strict';function a36_0x1ccd(){const _0x877e84=['thb','twd','huf','https://api.coingecko.com/api/v3/simple/price','eth','all','default','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20USDT','uah','ars',',\x20using\x201\x20as\x20fallback','../config/database','gbp','krw','updateInterval','join','getCurrencyRate','hkd','length','convertMultipleToUSDT','405447DOOyBM','sats','Error\x20getting\x20rates\x20status:','php','toUpperCase','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','1255gZvEja','zar','bhd','tether','sek','ils','1210772KiVqtg','Error\x20getting\x20all\x20rates:','currencyRate','xdr','rub','dkk','\x20currencies','asc','statusText','Periodic\x20currency\x20rates\x20update\x20failed:','forEach','findFirst','czk','upsert','brl','xau','4zfUdgw','usdt','💱\x20Applied\x20','chf','Error\x20getting\x20rate\x20for\x20currency\x20','299232vjOipq','CurrencyService','24822MiXFWC','📊\x20Received\x20rates\x20for\x20','xlm','nok','4635156aYVAge','rate','CURRENCIES','__esModule','MARKUP_PERCENTAGE','error','status','bdt','log','myr','toLowerCase','keys','dot','usd','nzd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','xrp','mmk','eur','idr','bch','CoinGecko\x20API\x20error:\x20','getMarkupPercentage','desc','mxn','convertToUSDT','vnd','toFixed','TesSoft\x20Payment\x20System/1.0','defineProperty','❌\x20Failed\x20to\x20update\x20currency\x20rates:','ltc','gel','eos','pkr','application/json','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','33983199aZIWug','updateCurrencyRates','map','yfi','aed','8912099bAjqcf','currencyService','catch','cad','link','findUnique','startPeriodicUpdates','bnb','sar','%\x20markup\x20to\x20','ngn','updatedAt'];a36_0x1ccd=function(){return _0x877e84;};return a36_0x1ccd();}const a36_0x28be71=a36_0x103d;(function(_0x3dd584,_0xe9936c){const _0x518b61=a36_0x103d,_0xc098b8=_0x3dd584();while(!![]){try{const _0x4f00e3=-parseInt(_0x518b61(0x14f))/0x1+-parseInt(_0x518b61(0x15f))/0x2*(parseInt(_0x518b61(0x143))/0x3)+-parseInt(_0x518b61(0x16a))/0x4+-parseInt(_0x518b61(0x149))/0x5*(-parseInt(_0x518b61(0x166))/0x6)+-parseInt(_0x518b61(0x194))/0x7+-parseInt(_0x518b61(0x164))/0x8+parseInt(_0x518b61(0x18f))/0x9;if(_0x4f00e3===_0xe9936c)break;else _0xc098b8['push'](_0xc098b8['shift']());}catch(_0x4c3acc){_0xc098b8['push'](_0xc098b8['shift']());}}}(a36_0x1ccd,0xd2e86));function a36_0x103d(_0x363612,_0x2301af){const _0x1ccd0b=a36_0x1ccd();return a36_0x103d=function(_0x103d79,_0x482b20){_0x103d79=_0x103d79-0x135;let _0x50cae5=_0x1ccd0b[_0x103d79];return _0x50cae5;},a36_0x103d(_0x363612,_0x2301af);}var __importDefault=this&&this['__importDefault']||function(_0x5ba78f){const _0x4b18d5=a36_0x103d;return _0x5ba78f&&_0x5ba78f[_0x4b18d5(0x16d)]?_0x5ba78f:{'default':_0x5ba78f};};Object[a36_0x28be71(0x187)](exports,a36_0x28be71(0x16d),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a36_0x28be71(0x13a)));class CurrencyService{constructor(){const _0x359bb5=a36_0x28be71;this['COINGECKO_URL']=_0x359bb5(0x1a3),this[_0x359bb5(0x16c)]=['btc',_0x359bb5(0x1a4),_0x359bb5(0x189),_0x359bb5(0x17e),_0x359bb5(0x19b),_0x359bb5(0x18b),_0x359bb5(0x17a),_0x359bb5(0x168),_0x359bb5(0x198),_0x359bb5(0x176),_0x359bb5(0x192),_0x359bb5(0x177),_0x359bb5(0x193),_0x359bb5(0x138),'aud',_0x359bb5(0x171),_0x359bb5(0x14b),'bmd',_0x359bb5(0x15d),_0x359bb5(0x197),_0x359bb5(0x162),'clp','cny',_0x359bb5(0x15b),_0x359bb5(0x154),_0x359bb5(0x17c),_0x359bb5(0x13b),_0x359bb5(0x18a),_0x359bb5(0x140),_0x359bb5(0x1a2),_0x359bb5(0x17d),_0x359bb5(0x14e),'inr','jpy',_0x359bb5(0x13c),'kwd','lkr',_0x359bb5(0x17b),_0x359bb5(0x182),_0x359bb5(0x173),_0x359bb5(0x19e),_0x359bb5(0x169),_0x359bb5(0x178),_0x359bb5(0x146),_0x359bb5(0x18c),'pln',_0x359bb5(0x153),_0x359bb5(0x19c),_0x359bb5(0x14d),'sgd',_0x359bb5(0x1a0),'try',_0x359bb5(0x1a1),_0x359bb5(0x137),'vef',_0x359bb5(0x184),_0x359bb5(0x14a),_0x359bb5(0x152),'xag',_0x359bb5(0x15e),'bits',_0x359bb5(0x144)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x359bb5(0x19a)]();}[a36_0x28be71(0x19a)](){const _0x31ef73=a36_0x28be71;this[_0x31ef73(0x190)]()[_0x31ef73(0x196)](_0x10205a=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x10205a);}),this[_0x31ef73(0x13d)]=setInterval(async()=>{const _0x4de31b=_0x31ef73;try{await this[_0x4de31b(0x190)]();}catch(_0x339fa6){console[_0x4de31b(0x16f)](_0x4de31b(0x158),_0x339fa6);}},0x3c*0x3c*0x3e8),console[_0x31ef73(0x172)](_0x31ef73(0x135));}['stopPeriodicUpdates'](){const _0x205d33=a36_0x28be71;this[_0x205d33(0x13d)]&&(clearInterval(this['updateInterval']),this[_0x205d33(0x13d)]=null,console[_0x205d33(0x172)](_0x205d33(0x18e)));}async['updateCurrencyRates'](){const _0x597534=a36_0x28be71;try{console[_0x597534(0x172)](_0x597534(0x148));const _0x3e91e7=this[_0x597534(0x16c)][_0x597534(0x13e)](','),_0x2d62c8=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x3e91e7,_0x468a98=await fetch(_0x2d62c8,{'headers':{'Accept':_0x597534(0x18d),'User-Agent':_0x597534(0x186)}});if(!_0x468a98['ok'])throw new Error(_0x597534(0x17f)+_0x468a98[_0x597534(0x170)]+'\x20'+_0x468a98[_0x597534(0x157)]);const _0x5c663a=await _0x468a98['json']();if(!_0x5c663a[_0x597534(0x14c)])throw new Error(_0x597534(0x179));const _0x1e04e3=_0x5c663a[_0x597534(0x14c)];console['log'](_0x597534(0x167)+Object[_0x597534(0x175)](_0x1e04e3)[_0x597534(0x141)]+_0x597534(0x155));const _0x234c77=Object['entries'](_0x1e04e3)[_0x597534(0x191)](async([_0x50f531,_0x4c9e2b])=>{const _0x182e34=_0x597534;try{await database_1[_0x182e34(0x1a6)][_0x182e34(0x151)][_0x182e34(0x15c)]({'where':{'currency':_0x50f531[_0x182e34(0x174)]()},'update':{'rate':_0x4c9e2b},'create':{'currency':_0x50f531['toLowerCase'](),'rate':_0x4c9e2b}});}catch(_0x46821c){console[_0x182e34(0x16f)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x50f531+':',_0x46821c);}});await Promise['allSettled'](_0x234c77),console[_0x597534(0x172)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x1a78ac){console[_0x597534(0x16f)](_0x597534(0x188),_0x1a78ac);throw _0x1a78ac;}}async[a36_0x28be71(0x13f)](_0xa1ba8c){const _0x5ea59c=a36_0x28be71,_0x45f4ac=_0xa1ba8c[_0x5ea59c(0x174)]();if(_0x45f4ac===_0x5ea59c(0x160))return 0x1;try{const _0x1a7413=await database_1[_0x5ea59c(0x1a6)]['currencyRate'][_0x5ea59c(0x199)]({'where':{'currency':_0x45f4ac}});if(!_0x1a7413)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0xa1ba8c+_0x5ea59c(0x139)),0x1;return _0x1a7413[_0x5ea59c(0x16b)];}catch(_0x62ad5c){return console['error'](_0x5ea59c(0x163)+_0xa1ba8c+':',_0x62ad5c),0x1;}}async[a36_0x28be71(0x183)](_0x4b0509,_0x346bef){const _0xb7e8cf=a36_0x28be71,_0x5f0b67=_0x346bef['toLowerCase']();if(_0x5f0b67===_0xb7e8cf(0x160)){const _0x1a8978=_0x4b0509*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0xb7e8cf(0x172)](_0xb7e8cf(0x161)+this['MARKUP_PERCENTAGE']+_0xb7e8cf(0x19d)+_0x4b0509+'\x20USDT\x20=\x20'+_0x1a8978['toFixed'](0x6)+_0xb7e8cf(0x136)),_0x1a8978;}try{const _0x2f7e60=await this[_0xb7e8cf(0x13f)](_0x5f0b67),_0x36e332=_0x4b0509/_0x2f7e60,_0x576fd3=_0x36e332*(0x1+this[_0xb7e8cf(0x16e)]/0x64);return console[_0xb7e8cf(0x172)]('💱\x20Converted\x20'+_0x4b0509+'\x20'+_0x346bef[_0xb7e8cf(0x147)]()+'\x20to\x20'+_0x36e332['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0xb7e8cf(0x16e)]+'%\x20markup\x20=\x20'+_0x576fd3[_0xb7e8cf(0x185)](0x6)+'\x20USDT\x20(rate:\x20'+_0x2f7e60+')'),_0x576fd3;}catch(_0x200583){console[_0xb7e8cf(0x16f)]('Error\x20converting\x20'+_0x4b0509+'\x20'+_0x346bef+'\x20to\x20USDT:',_0x200583);const _0x3cd75a=_0x4b0509*(0x1+this[_0xb7e8cf(0x16e)]/0x64);return _0x3cd75a;}}async[a36_0x28be71(0x142)](_0x14856a){let _0x396803=0x0;for(const {amount:_0x4086e0,currency:_0x32907e}of _0x14856a){const _0x38de0f=await this['convertToUSDT'](_0x4086e0,_0x32907e);_0x396803+=_0x38de0f;}return _0x396803;}async['getAllRates'](){const _0x3c186e=a36_0x28be71;try{const _0x14ec26=await database_1[_0x3c186e(0x1a6)][_0x3c186e(0x151)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x5dea8a={'usdt':0x1};return _0x14ec26[_0x3c186e(0x159)](_0x4e62df=>{const _0x342c81=_0x3c186e;_0x5dea8a[_0x4e62df['currency']]=_0x4e62df[_0x342c81(0x16b)];}),_0x5dea8a;}catch(_0x375d61){return console[_0x3c186e(0x16f)](_0x3c186e(0x150),_0x375d61),{'usdt':0x1};}}async['getRatesStatus'](){const _0x376a25=a36_0x28be71;try{const [_0x383d06,_0x4c3ef0,_0x235d54]=await Promise[_0x376a25(0x1a5)]([database_1[_0x376a25(0x1a6)]['currencyRate']['count'](),database_1['default'][_0x376a25(0x151)]['findFirst']({'orderBy':{'updatedAt':_0x376a25(0x181)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x376a25(0x15a)]({'orderBy':{'updatedAt':_0x376a25(0x156)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x383d06,'lastUpdated':_0x4c3ef0?.[_0x376a25(0x19f)]||null,'oldestRate':_0x235d54?.[_0x376a25(0x19f)]||null,'markupPercentage':this[_0x376a25(0x16e)]};}catch(_0x4e58fb){return console['error'](_0x376a25(0x145),_0x4e58fb),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x376a25(0x16e)]};}}[a36_0x28be71(0x180)](){const _0x4ebd6f=a36_0x28be71;return this[_0x4ebd6f(0x16e)];}}exports[a36_0x28be71(0x165)]=CurrencyService,exports[a36_0x28be71(0x195)]=new CurrencyService();