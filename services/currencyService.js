'use strict';const a58_0x11b744=a58_0x3233;(function(_0x8e2268,_0x7200f8){const _0x2e39d4=a58_0x3233,_0x1fe8ec=_0x8e2268();while(!![]){try{const _0x2ae4be=-parseInt(_0x2e39d4(0x22d))/0x1*(-parseInt(_0x2e39d4(0x201))/0x2)+parseInt(_0x2e39d4(0x253))/0x3*(parseInt(_0x2e39d4(0x1f1))/0x4)+-parseInt(_0x2e39d4(0x1df))/0x5*(parseInt(_0x2e39d4(0x1fe))/0x6)+-parseInt(_0x2e39d4(0x1ea))/0x7+parseInt(_0x2e39d4(0x226))/0x8*(parseInt(_0x2e39d4(0x256))/0x9)+-parseInt(_0x2e39d4(0x213))/0xa*(parseInt(_0x2e39d4(0x21b))/0xb)+-parseInt(_0x2e39d4(0x246))/0xc*(-parseInt(_0x2e39d4(0x1e3))/0xd);if(_0x2ae4be===_0x7200f8)break;else _0x1fe8ec['push'](_0x1fe8ec['shift']());}catch(_0x2223b3){_0x1fe8ec['push'](_0x1fe8ec['shift']());}}}(a58_0x27f4,0xf2f5c));function a58_0x3233(_0x2091eb,_0x56627c){_0x2091eb=_0x2091eb-0x1db;const _0x27f412=a58_0x27f4();let _0x323303=_0x27f412[_0x2091eb];return _0x323303;}var __importDefault=this&&this[a58_0x11b744(0x25f)]||function(_0xf98361){const _0x5aeb96=a58_0x11b744;return _0xf98361&&_0xf98361[_0x5aeb96(0x1fd)]?_0xf98361:{'default':_0xf98361};};Object['defineProperty'](exports,a58_0x11b744(0x1fd),{'value':!![]}),exports[a58_0x11b744(0x257)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a58_0x11b744(0x238)));class CurrencyService{constructor(){const _0x5ca29b=a58_0x11b744;this['COINGECKO_URL']=_0x5ca29b(0x202),this[_0x5ca29b(0x219)]=[_0x5ca29b(0x24d),_0x5ca29b(0x20a),_0x5ca29b(0x22b),'bch','bnb',_0x5ca29b(0x258),_0x5ca29b(0x232),_0x5ca29b(0x1de),_0x5ca29b(0x21a),_0x5ca29b(0x211),_0x5ca29b(0x24f),'usd',_0x5ca29b(0x230),_0x5ca29b(0x1eb),_0x5ca29b(0x221),'bdt',_0x5ca29b(0x1dd),'bmd',_0x5ca29b(0x217),_0x5ca29b(0x255),_0x5ca29b(0x222),_0x5ca29b(0x21f),_0x5ca29b(0x203),_0x5ca29b(0x1f0),_0x5ca29b(0x25d),_0x5ca29b(0x24c),_0x5ca29b(0x1db),_0x5ca29b(0x1f2),_0x5ca29b(0x1e1),_0x5ca29b(0x1ec),_0x5ca29b(0x220),_0x5ca29b(0x215),_0x5ca29b(0x249),_0x5ca29b(0x200),_0x5ca29b(0x21d),_0x5ca29b(0x1f8),_0x5ca29b(0x22e),_0x5ca29b(0x1f6),_0x5ca29b(0x1f5),_0x5ca29b(0x227),_0x5ca29b(0x1fc),'nok',_0x5ca29b(0x1e0),_0x5ca29b(0x210),_0x5ca29b(0x1e6),_0x5ca29b(0x241),_0x5ca29b(0x244),'sar',_0x5ca29b(0x237),'sgd',_0x5ca29b(0x1f3),_0x5ca29b(0x242),_0x5ca29b(0x21c),'uah',_0x5ca29b(0x22c),'vnd',_0x5ca29b(0x1dc),_0x5ca29b(0x1fa),_0x5ca29b(0x247),_0x5ca29b(0x223),_0x5ca29b(0x214),'sats'],this[_0x5ca29b(0x1e4)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x5ca29b(0x208)]();}[a58_0x11b744(0x208)](){const _0x3df1fd=a58_0x11b744;this[_0x3df1fd(0x254)]()[_0x3df1fd(0x228)](_0x330160=>{const _0x545673=_0x3df1fd;console[_0x545673(0x23e)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x330160);}),this[_0x3df1fd(0x1e4)]=setInterval(async()=>{const _0x5a0550=_0x3df1fd;try{await this[_0x5a0550(0x254)]();}catch(_0x39684b){console['error'](_0x5a0550(0x23d),_0x39684b);}},0x3c*0x3c*0x3e8),console[_0x3df1fd(0x204)](_0x3df1fd(0x23f));}[a58_0x11b744(0x20b)](){const _0x4f4cd5=a58_0x11b744;this[_0x4f4cd5(0x1e4)]&&(clearInterval(this[_0x4f4cd5(0x1e4)]),this['updateInterval']=null,console['log'](_0x4f4cd5(0x1f7)));}async['updateCurrencyRates'](){const _0x457b45=a58_0x11b744;try{console[_0x457b45(0x204)](_0x457b45(0x252));const _0x354b1f=this['CURRENCIES'][_0x457b45(0x225)](','),_0x8661c6=this[_0x457b45(0x248)]+_0x457b45(0x206)+_0x354b1f,_0x1528f3=await fetch(_0x8661c6,{'headers':{'Accept':_0x457b45(0x205),'User-Agent':_0x457b45(0x250)}});if(!_0x1528f3['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1528f3['status']+'\x20'+_0x1528f3['statusText']);const _0x3dddb0=await _0x1528f3['json']();if(!_0x3dddb0['tether'])throw new Error(_0x457b45(0x24b));const _0x5bfb49=_0x3dddb0[_0x457b45(0x209)];console[_0x457b45(0x204)](_0x457b45(0x21e)+Object[_0x457b45(0x22a)](_0x5bfb49)[_0x457b45(0x23a)]+_0x457b45(0x1f9));const _0x47a662=0x5,_0x1a4d75=Object[_0x457b45(0x212)](_0x5bfb49);for(let _0x194623=0x0;_0x194623<_0x1a4d75[_0x457b45(0x23a)];_0x194623+=_0x47a662){const _0x379065=_0x1a4d75[_0x457b45(0x243)](_0x194623,_0x194623+_0x47a662),_0x5b37f7=_0x379065[_0x457b45(0x20e)](async([_0x2eb04b,_0x51a692])=>{const _0x503405=_0x457b45;try{await database_1[_0x503405(0x24e)][_0x503405(0x233)][_0x503405(0x1ee)]({'where':{'currency':_0x2eb04b['toLowerCase']()},'update':{'rate':_0x51a692},'create':{'currency':_0x2eb04b['toLowerCase'](),'rate':_0x51a692}});}catch(_0x5d2e0b){console[_0x503405(0x23e)](_0x503405(0x1f4)+_0x2eb04b+':',_0x5d2e0b);}});await Promise[_0x457b45(0x234)](_0x5b37f7);}console[_0x457b45(0x204)](_0x457b45(0x22f));}catch(_0x10e708){console['error'](_0x457b45(0x1ed),_0x10e708);throw _0x10e708;}}async[a58_0x11b744(0x207)](_0x2e8e55){const _0x1b38e9=a58_0x11b744,_0x2a6945=_0x2e8e55[_0x1b38e9(0x218)]();if(_0x2a6945===_0x1b38e9(0x1ef))return 0x1;try{const _0x44f723=await database_1[_0x1b38e9(0x24e)]['currencyRate'][_0x1b38e9(0x20d)]({'where':{'currency':_0x2a6945}});if(!_0x44f723)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2e8e55+_0x1b38e9(0x25a)),0x1;return _0x44f723[_0x1b38e9(0x23b)];}catch(_0x1b2803){return console[_0x1b38e9(0x23e)](_0x1b38e9(0x259)+_0x2e8e55+':',_0x1b2803),0x1;}}async[a58_0x11b744(0x1e2)](_0x4e60b8,_0x33caee){const _0x1d156d=a58_0x11b744,_0x2bc8eb=_0x33caee[_0x1d156d(0x218)]();if(_0x2bc8eb==='usdt'){const _0x3172f1=_0x4e60b8*(0x1+this[_0x1d156d(0x245)]/0x64);return console[_0x1d156d(0x204)](_0x1d156d(0x25b)+this[_0x1d156d(0x245)]+_0x1d156d(0x1e7)+_0x4e60b8+_0x1d156d(0x229)+_0x3172f1['toFixed'](0x6)+'\x20USDT'),_0x3172f1;}try{const _0x1bb3bc=await this['getCurrencyRate'](_0x2bc8eb),_0x18eed0=_0x4e60b8/_0x1bb3bc,_0x5a6585=_0x18eed0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x1d156d(0x204)](_0x1d156d(0x240)+_0x4e60b8+'\x20'+_0x33caee['toUpperCase']()+_0x1d156d(0x1e8)+_0x18eed0['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x1d156d(0x245)]+_0x1d156d(0x231)+_0x5a6585['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x1bb3bc+')'),_0x5a6585;}catch(_0x55f157){console[_0x1d156d(0x23e)](_0x1d156d(0x1e5)+_0x4e60b8+'\x20'+_0x33caee+_0x1d156d(0x20c),_0x55f157);const _0x2784fa=_0x4e60b8*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x2784fa;}}async[a58_0x11b744(0x235)](_0x5e46de){const _0x4b8abb=a58_0x11b744;let _0xab0c9a=0x0;for(const {amount:_0x3b985d,currency:_0x8f24d0}of _0x5e46de){const _0x1d2fe3=await this[_0x4b8abb(0x1e2)](_0x3b985d,_0x8f24d0);_0xab0c9a+=_0x1d2fe3;}return _0xab0c9a;}async[a58_0x11b744(0x23c)](){const _0x101324=a58_0x11b744;try{const _0x56c928=await database_1[_0x101324(0x24e)]['currencyRate'][_0x101324(0x1e9)]({'select':{'currency':!![],'rate':!![]}}),_0x1036cc={'usdt':0x1};return _0x56c928['forEach'](_0x115acc=>{const _0x3afc03=_0x101324;_0x1036cc[_0x115acc[_0x3afc03(0x20f)]]=_0x115acc['rate'];}),_0x1036cc;}catch(_0x8b732f){return console[_0x101324(0x23e)](_0x101324(0x239),_0x8b732f),{'usdt':0x1};}}async[a58_0x11b744(0x24a)](){const _0x5dbb15=a58_0x11b744;try{const [_0x37d245,_0x2e4b67,_0x5aab61]=await Promise['all']([database_1[_0x5dbb15(0x24e)][_0x5dbb15(0x233)][_0x5dbb15(0x25e)](),database_1[_0x5dbb15(0x24e)][_0x5dbb15(0x233)][_0x5dbb15(0x216)]({'orderBy':{'updatedAt':_0x5dbb15(0x236)},'select':{'updatedAt':!![]}}),database_1[_0x5dbb15(0x24e)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x5dbb15(0x1ff)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x37d245,'lastUpdated':_0x2e4b67?.['updatedAt']||null,'oldestRate':_0x5aab61?.[_0x5dbb15(0x25c)]||null,'markupPercentage':this[_0x5dbb15(0x245)]};}catch(_0x4cf890){return console['error'](_0x5dbb15(0x251),_0x4cf890),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5dbb15(0x245)]};}}[a58_0x11b744(0x1fb)](){const _0x576760=a58_0x11b744;return this[_0x576760(0x245)];}}exports[a58_0x11b744(0x224)]=CurrencyService,exports[a58_0x11b744(0x257)]=new CurrencyService();function a58_0x27f4(){const _0x461810=['getRatesStatus','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','eur','btc','default','yfi','Payment\x20System/1.0','Error\x20getting\x20rates\x20status:','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','6eTXhVj','updateCurrencyRates','cad','27qbTlFJ','currencyService','eos','Error\x20getting\x20rate\x20for\x20currency\x20',',\x20using\x201\x20as\x20fallback','üí±\x20Applied\x20','updatedAt','dkk','count','__importDefault','gbp','zar','bhd','xlm','9290uHLxii','nzd','hkd','convertToUSDT','9627787DjoRzg','updateInterval','Error\x20converting\x20','pkr','%\x20markup\x20to\x20','\x20to\x20','findMany','7188881BViOsh','ars','huf','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','upsert','usdt','czk','2798072kEQOnu','gel','thb','Failed\x20to\x20update\x20rate\x20for\x20','mxn','mmk','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','kwd','\x20currencies','xdr','getMarkupPercentage','ngn','__esModule','4350ilNZtL','asc','jpy','6TCidpG','https://api.coingecko.com/api/v3/simple/price','cny','log','application/json','?ids=tether&vs_currencies=','getCurrencyRate','startPeriodicUpdates','tether','eth','stopPeriodicUpdates','\x20to\x20USDT:','findUnique','map','currency','php','dot','entries','1264210blcgJm','bits','ils','findFirst','brl','toLowerCase','CURRENCIES','link','66byrbZu','twd','krw','üìä\x20Received\x20rates\x20for\x20','clp','idr','aud','chf','xau','CurrencyService','join','2865848oNfTcm','myr','catch','\x20USDT\x20=\x20','keys','ltc','vef','304465OsuHcr','lkr','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','aed','%\x20markup\x20=\x20','xrp','currencyRate','all','convertMultipleToUSDT','desc','sek','../config/database','Error\x20getting\x20all\x20rates:','length','rate','getAllRates','Periodic\x20currency\x20rates\x20update\x20failed:','error','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','üí±\x20Converted\x20','pln','try','slice','rub','MARKUP_PERCENTAGE','12aTzjWd','xag','COINGECKO_URL','inr'];a58_0x27f4=function(){return _0x461810;};return a58_0x27f4();}