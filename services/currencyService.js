'use strict';const a41_0x27ec24=a41_0x4bbd;(function(_0x594d57,_0x5958dd){const _0x38949f=a41_0x4bbd,_0x3aa12e=_0x594d57();while(!![]){try{const _0x49b452=parseInt(_0x38949f(0x135))/0x1+-parseInt(_0x38949f(0x12e))/0x2+-parseInt(_0x38949f(0x127))/0x3+parseInt(_0x38949f(0x119))/0x4*(parseInt(_0x38949f(0x174))/0x5)+parseInt(_0x38949f(0x143))/0x6+-parseInt(_0x38949f(0x150))/0x7*(parseInt(_0x38949f(0x10c))/0x8)+-parseInt(_0x38949f(0x125))/0x9*(-parseInt(_0x38949f(0x13c))/0xa);if(_0x49b452===_0x5958dd)break;else _0x3aa12e['push'](_0x3aa12e['shift']());}catch(_0x464e3f){_0x3aa12e['push'](_0x3aa12e['shift']());}}}(a41_0x5723,0x7be5b));var __importDefault=this&&this[a41_0x27ec24(0x105)]||function(_0x531f2d){const _0x3836d5=a41_0x27ec24;return _0x531f2d&&_0x531f2d[_0x3836d5(0x116)]?_0x531f2d:{'default':_0x531f2d};};function a41_0x4bbd(_0x55b58f,_0x26d603){const _0x5723cd=a41_0x5723();return a41_0x4bbd=function(_0x4bbd02,_0x581b4e){_0x4bbd02=_0x4bbd02-0xf9;let _0x674fb8=_0x5723cd[_0x4bbd02];return _0x674fb8;},a41_0x4bbd(_0x55b58f,_0x26d603);}Object['defineProperty'](exports,a41_0x27ec24(0x116),{'value':!![]}),exports[a41_0x27ec24(0x10a)]=exports[a41_0x27ec24(0x111)]=void 0x0;const database_1=__importDefault(require(a41_0x27ec24(0x113)));function a41_0x5723(){const _0x1e36e7=['updateInterval','✅\x20Currency\x20rates\x20updated\x20successfully','rate','getCurrencyRate','getAllRates','xrp','\x20USDT\x20(rate:\x20','upsert','gbp','inr','sek','usdt','count','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','bdt','chf','findFirst','uah','eos','stopPeriodicUpdates','yfi','\x20USDT','670095sCxbVl','https://api.coingecko.com/api/v3/simple/price','log','forEach','toLowerCase','brl','aed','toFixed','mxn','Error\x20getting\x20all\x20rates:','application/json','Error\x20getting\x20rate\x20for\x20currency\x20','rub','mmk','__importDefault','thb','\x20to\x20','asc','link','currencyService','try','51016CXBCHp','dkk','💱\x20Converted\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Error\x20converting\x20','CurrencyService','ils','../config/database','hkd','vef','__esModule','allSettled','dot','24GRpksY','\x20currencies','cny','xau','ars','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','btc','convertMultipleToUSDT','length','desc','getRatesStatus','cad','9hCZPdt','COINGECKO_URL','907014sqOyKq','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','bnb','statusText','status','pln','?ids=tether&vs_currencies=','476534BvfMaf','currencyRate','keys','updatedAt','📊\x20Received\x20rates\x20for\x20','CURRENCIES','Periodic\x20currency\x20rates\x20update\x20failed:','419497cvwBlX','sgd','php','map','zar','bits','MARKUP_PERCENTAGE','5617130wQnNMQ','updateCurrencyRates','Error\x20getting\x20rates\x20status:','\x20USDT,\x20with\x20','default','entries','kwd','91500efBUTu','findMany',',\x20using\x201\x20as\x20fallback','xlm','%\x20markup\x20to\x20','nzd','xag','myr','bhd','%\x20markup\x20=\x20','CoinGecko\x20API\x20error:\x20','czk','krw','826xjJEqv','❌\x20Failed\x20to\x20update\x20currency\x20rates:','Failed\x20to\x20update\x20rate\x20for\x20','error','\x20USDT\x20=\x20','eth','ltc','clp','tether','join','xdr','catch','startPeriodicUpdates','huf'];a41_0x5723=function(){return _0x1e36e7;};return a41_0x5723();}class CurrencyService{constructor(){const _0x4e16c5=a41_0x27ec24;this['COINGECKO_URL']=_0x4e16c5(0x175),this[_0x4e16c5(0x133)]=[_0x4e16c5(0x11f),_0x4e16c5(0x155),_0x4e16c5(0x156),'bch',_0x4e16c5(0x129),_0x4e16c5(0x170),_0x4e16c5(0x163),_0x4e16c5(0x146),_0x4e16c5(0x109),_0x4e16c5(0x118),_0x4e16c5(0x172),'usd',_0x4e16c5(0xfd),_0x4e16c5(0x11d),'aud',_0x4e16c5(0x16c),_0x4e16c5(0x14b),'bmd',_0x4e16c5(0xfc),_0x4e16c5(0x124),_0x4e16c5(0x16d),_0x4e16c5(0x157),_0x4e16c5(0x11b),_0x4e16c5(0x14e),_0x4e16c5(0x10d),'eur',_0x4e16c5(0x166),'gel',_0x4e16c5(0x114),_0x4e16c5(0x15d),'idr',_0x4e16c5(0x112),_0x4e16c5(0x167),'jpy',_0x4e16c5(0x14f),_0x4e16c5(0x142),'lkr',_0x4e16c5(0x104),_0x4e16c5(0xff),_0x4e16c5(0x14a),'ngn','nok',_0x4e16c5(0x148),_0x4e16c5(0x137),'pkr',_0x4e16c5(0x12c),_0x4e16c5(0x103),'sar',_0x4e16c5(0x168),_0x4e16c5(0x136),_0x4e16c5(0x106),_0x4e16c5(0x10b),'twd',_0x4e16c5(0x16f),_0x4e16c5(0x115),'vnd',_0x4e16c5(0x139),_0x4e16c5(0x15a),_0x4e16c5(0x149),_0x4e16c5(0x11c),_0x4e16c5(0x13a),'sats'],this[_0x4e16c5(0x15e)]=null,this[_0x4e16c5(0x13b)]=-0x3,this[_0x4e16c5(0x15c)]();}[a41_0x27ec24(0x15c)](){const _0x33a745=a41_0x27ec24;this[_0x33a745(0x13d)]()[_0x33a745(0x15b)](_0x3c16cb=>{const _0x262ae0=_0x33a745;console[_0x262ae0(0x153)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x3c16cb);}),this[_0x33a745(0x15e)]=setInterval(async()=>{const _0x176989=_0x33a745;try{await this[_0x176989(0x13d)]();}catch(_0x2d6b58){console[_0x176989(0x153)](_0x176989(0x134),_0x2d6b58);}},0x3c*0x3c*0x3e8),console[_0x33a745(0xf9)](_0x33a745(0x10f));}[a41_0x27ec24(0x171)](){const _0x4f4b40=a41_0x27ec24;this['updateInterval']&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console['log'](_0x4f4b40(0x16b)));}async[a41_0x27ec24(0x13d)](){const _0x1c3b64=a41_0x27ec24;try{console[_0x1c3b64(0xf9)](_0x1c3b64(0x11e));const _0xaacf54=this[_0x1c3b64(0x133)][_0x1c3b64(0x159)](','),_0x3a02ef=this[_0x1c3b64(0x126)]+_0x1c3b64(0x12d)+_0xaacf54,_0x54308b=await fetch(_0x3a02ef,{'headers':{'Accept':_0x1c3b64(0x101),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x54308b['ok'])throw new Error(_0x1c3b64(0x14d)+_0x54308b[_0x1c3b64(0x12b)]+'\x20'+_0x54308b[_0x1c3b64(0x12a)]);const _0x19ffc4=await _0x54308b['json']();if(!_0x19ffc4[_0x1c3b64(0x158)])throw new Error(_0x1c3b64(0x128));const _0x18ba98=_0x19ffc4['tether'];console[_0x1c3b64(0xf9)](_0x1c3b64(0x132)+Object[_0x1c3b64(0x130)](_0x18ba98)[_0x1c3b64(0x121)]+_0x1c3b64(0x11a));const _0x134493=Object[_0x1c3b64(0x141)](_0x18ba98)[_0x1c3b64(0x138)](async([_0x21915b,_0x231efb])=>{const _0x4a0d27=_0x1c3b64;try{await database_1[_0x4a0d27(0x140)][_0x4a0d27(0x12f)][_0x4a0d27(0x165)]({'where':{'currency':_0x21915b['toLowerCase']()},'update':{'rate':_0x231efb},'create':{'currency':_0x21915b[_0x4a0d27(0xfb)](),'rate':_0x231efb}});}catch(_0xe9d359){console[_0x4a0d27(0x153)](_0x4a0d27(0x152)+_0x21915b+':',_0xe9d359);}});await Promise[_0x1c3b64(0x117)](_0x134493),console['log'](_0x1c3b64(0x15f));}catch(_0x1b4660){console[_0x1c3b64(0x153)](_0x1c3b64(0x151),_0x1b4660);throw _0x1b4660;}}async[a41_0x27ec24(0x161)](_0x2190d1){const _0x190bd0=a41_0x27ec24,_0x15c01f=_0x2190d1['toLowerCase']();if(_0x15c01f===_0x190bd0(0x169))return 0x1;try{const _0x5e6bfe=await database_1['default'][_0x190bd0(0x12f)]['findUnique']({'where':{'currency':_0x15c01f}});if(!_0x5e6bfe)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x2190d1+_0x190bd0(0x145)),0x1;return _0x5e6bfe[_0x190bd0(0x160)];}catch(_0x4aef21){return console[_0x190bd0(0x153)](_0x190bd0(0x102)+_0x2190d1+':',_0x4aef21),0x1;}}async['convertToUSDT'](_0xd3ffcd,_0x30b8b7){const _0x4723e3=a41_0x27ec24,_0x1c6641=_0x30b8b7['toLowerCase']();if(_0x1c6641===_0x4723e3(0x169)){const _0x4a812d=_0xd3ffcd*(0x1+this[_0x4723e3(0x13b)]/0x64);return console[_0x4723e3(0xf9)]('💱\x20Applied\x20'+this[_0x4723e3(0x13b)]+_0x4723e3(0x147)+_0xd3ffcd+_0x4723e3(0x154)+_0x4a812d[_0x4723e3(0xfe)](0x6)+_0x4723e3(0x173)),_0x4a812d;}try{const _0x12a84e=await this[_0x4723e3(0x161)](_0x1c6641),_0x376e14=_0xd3ffcd/_0x12a84e,_0xbf0a85=_0x376e14*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4723e3(0xf9)](_0x4723e3(0x10e)+_0xd3ffcd+'\x20'+_0x30b8b7['toUpperCase']()+_0x4723e3(0x107)+_0x376e14[_0x4723e3(0xfe)](0x6)+_0x4723e3(0x13f)+this[_0x4723e3(0x13b)]+_0x4723e3(0x14c)+_0xbf0a85['toFixed'](0x6)+_0x4723e3(0x164)+_0x12a84e+')'),_0xbf0a85;}catch(_0x4d7af){console['error'](_0x4723e3(0x110)+_0xd3ffcd+'\x20'+_0x30b8b7+'\x20to\x20USDT:',_0x4d7af);const _0x1de68f=_0xd3ffcd*(0x1+this[_0x4723e3(0x13b)]/0x64);return _0x1de68f;}}async[a41_0x27ec24(0x120)](_0x32c05e){let _0x8fc561=0x0;for(const {amount:_0x4659b1,currency:_0x532739}of _0x32c05e){const _0x404597=await this['convertToUSDT'](_0x4659b1,_0x532739);_0x8fc561+=_0x404597;}return _0x8fc561;}async[a41_0x27ec24(0x162)](){const _0x1f155c=a41_0x27ec24;try{const _0x43eeb2=await database_1[_0x1f155c(0x140)][_0x1f155c(0x12f)][_0x1f155c(0x144)]({'select':{'currency':!![],'rate':!![]}}),_0x3973aa={'usdt':0x1};return _0x43eeb2[_0x1f155c(0xfa)](_0x59fe90=>{_0x3973aa[_0x59fe90['currency']]=_0x59fe90['rate'];}),_0x3973aa;}catch(_0x69375a){return console[_0x1f155c(0x153)](_0x1f155c(0x100),_0x69375a),{'usdt':0x1};}}async[a41_0x27ec24(0x123)](){const _0x244e80=a41_0x27ec24;try{const [_0x596320,_0x148f58,_0x3a8eae]=await Promise['all']([database_1[_0x244e80(0x140)][_0x244e80(0x12f)][_0x244e80(0x16a)](),database_1[_0x244e80(0x140)][_0x244e80(0x12f)][_0x244e80(0x16e)]({'orderBy':{'updatedAt':_0x244e80(0x122)},'select':{'updatedAt':!![]}}),database_1[_0x244e80(0x140)]['currencyRate'][_0x244e80(0x16e)]({'orderBy':{'updatedAt':_0x244e80(0x108)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x596320,'lastUpdated':_0x148f58?.['updatedAt']||null,'oldestRate':_0x3a8eae?.[_0x244e80(0x131)]||null,'markupPercentage':this[_0x244e80(0x13b)]};}catch(_0x4af1a6){return console[_0x244e80(0x153)](_0x244e80(0x13e),_0x4af1a6),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x244e80(0x13b)]};}}['getMarkupPercentage'](){const _0x3f01a9=a41_0x27ec24;return this[_0x3f01a9(0x13b)];}}exports['CurrencyService']=CurrencyService,exports[a41_0x27ec24(0x10a)]=new CurrencyService();