'use strict';function a39_0xea11(_0x4c8d42,_0x42b235){const _0x5f3a3f=a39_0x5f3a();return a39_0xea11=function(_0xea113b,_0x1bac83){_0xea113b=_0xea113b-0x1cf;let _0x31c5ef=_0x5f3a3f[_0xea113b];return _0x31c5ef;},a39_0xea11(_0x4c8d42,_0x42b235);}const a39_0x2fd67e=a39_0xea11;(function(_0x493064,_0x44dfd6){const _0x11fffb=a39_0xea11,_0x282aa1=_0x493064();while(!![]){try{const _0x4cc0e5=parseInt(_0x11fffb(0x248))/0x1*(parseInt(_0x11fffb(0x1eb))/0x2)+parseInt(_0x11fffb(0x1f1))/0x3+parseInt(_0x11fffb(0x20c))/0x4*(-parseInt(_0x11fffb(0x1f9))/0x5)+-parseInt(_0x11fffb(0x1ee))/0x6*(parseInt(_0x11fffb(0x22b))/0x7)+-parseInt(_0x11fffb(0x21a))/0x8*(-parseInt(_0x11fffb(0x209))/0x9)+parseInt(_0x11fffb(0x224))/0xa+parseInt(_0x11fffb(0x1dd))/0xb*(-parseInt(_0x11fffb(0x20b))/0xc);if(_0x4cc0e5===_0x44dfd6)break;else _0x282aa1['push'](_0x282aa1['shift']());}catch(_0x516945){_0x282aa1['push'](_0x282aa1['shift']());}}}(a39_0x5f3a,0x85bd0));var __importDefault=this&&this[a39_0x2fd67e(0x1dc)]||function(_0x174944){return _0x174944&&_0x174944['__esModule']?_0x174944:{'default':_0x174944};};Object[a39_0x2fd67e(0x1e5)](exports,a39_0x2fd67e(0x21f),{'value':!![]}),exports[a39_0x2fd67e(0x1e7)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x2fd67e(0x1fd)));class CurrencyService{constructor(){const _0x7ad998=a39_0x2fd67e;this[_0x7ad998(0x1da)]=_0x7ad998(0x230),this[_0x7ad998(0x233)]=['btc','eth',_0x7ad998(0x218),_0x7ad998(0x1e2),_0x7ad998(0x234),_0x7ad998(0x1f8),_0x7ad998(0x1ea),_0x7ad998(0x1d2),'link',_0x7ad998(0x24a),'yfi',_0x7ad998(0x240),_0x7ad998(0x1db),'ars',_0x7ad998(0x205),_0x7ad998(0x1e1),_0x7ad998(0x1d7),_0x7ad998(0x1ff),_0x7ad998(0x20e),_0x7ad998(0x1f4),_0x7ad998(0x23f),_0x7ad998(0x23a),_0x7ad998(0x239),_0x7ad998(0x215),_0x7ad998(0x206),_0x7ad998(0x243),'gbp',_0x7ad998(0x226),_0x7ad998(0x21d),_0x7ad998(0x220),'idr',_0x7ad998(0x232),_0x7ad998(0x1e3),'jpy',_0x7ad998(0x231),'kwd','lkr',_0x7ad998(0x227),_0x7ad998(0x24b),_0x7ad998(0x222),'ngn',_0x7ad998(0x245),_0x7ad998(0x21e),'php',_0x7ad998(0x225),_0x7ad998(0x23b),'rub',_0x7ad998(0x1e0),_0x7ad998(0x221),_0x7ad998(0x22d),_0x7ad998(0x1e8),_0x7ad998(0x23d),_0x7ad998(0x1fe),_0x7ad998(0x1fb),_0x7ad998(0x20d),'vnd','zar',_0x7ad998(0x210),_0x7ad998(0x1f5),_0x7ad998(0x201),_0x7ad998(0x204),_0x7ad998(0x216)],this[_0x7ad998(0x219)]=null,this[_0x7ad998(0x1f2)]=0x3,this['startPeriodicUpdates']();}[a39_0x2fd67e(0x1ef)](){const _0x5a9acf=a39_0x2fd67e;this['updateCurrencyRates']()[_0x5a9acf(0x236)](_0x38605c=>{const _0x69479e=_0x5a9acf;console[_0x69479e(0x217)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x38605c);}),this[_0x5a9acf(0x219)]=setInterval(async()=>{const _0x452035=_0x5a9acf;try{await this['updateCurrencyRates']();}catch(_0x26f38a){console[_0x452035(0x217)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x26f38a);}},0x3c*0x3c*0x3e8),console[_0x5a9acf(0x1e6)](_0x5a9acf(0x249));}['stopPeriodicUpdates'](){const _0x40601e=a39_0x2fd67e;this[_0x40601e(0x219)]&&(clearInterval(this[_0x40601e(0x219)]),this[_0x40601e(0x219)]=null,console[_0x40601e(0x1e6)](_0x40601e(0x238)));}async[a39_0x2fd67e(0x203)](){const _0x134cb6=a39_0x2fd67e;try{console[_0x134cb6(0x1e6)](_0x134cb6(0x229));const _0xf73664=this[_0x134cb6(0x233)][_0x134cb6(0x23c)](','),_0x52c401=this[_0x134cb6(0x1da)]+'?ids=tether&vs_currencies='+_0xf73664,_0x148c9f=await fetch(_0x52c401,{'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x148c9f['ok'])throw new Error(_0x134cb6(0x1de)+_0x148c9f[_0x134cb6(0x244)]+'\x20'+_0x148c9f[_0x134cb6(0x1d0)]);const _0x46c7d0=await _0x148c9f[_0x134cb6(0x237)]();if(!_0x46c7d0[_0x134cb6(0x22c)])throw new Error(_0x134cb6(0x1ec));const _0x4f4959=_0x46c7d0[_0x134cb6(0x22c)];console[_0x134cb6(0x1e6)](_0x134cb6(0x247)+Object[_0x134cb6(0x20f)](_0x4f4959)[_0x134cb6(0x1f0)]+_0x134cb6(0x212));const _0x1aea0f=Object[_0x134cb6(0x223)](_0x4f4959)[_0x134cb6(0x246)](async([_0x44df73,_0x2def10])=>{const _0x22b988=_0x134cb6;try{await database_1[_0x22b988(0x208)][_0x22b988(0x235)]['upsert']({'where':{'currency':_0x44df73['toLowerCase']()},'update':{'rate':_0x2def10},'create':{'currency':_0x44df73[_0x22b988(0x1f3)](),'rate':_0x2def10}});}catch(_0x46912a){console[_0x22b988(0x217)](_0x22b988(0x1e4)+_0x44df73+':',_0x46912a);}});await Promise[_0x134cb6(0x1fa)](_0x1aea0f),console[_0x134cb6(0x1e6)](_0x134cb6(0x213));}catch(_0x27c83a){console[_0x134cb6(0x217)](_0x134cb6(0x1ed),_0x27c83a);throw _0x27c83a;}}async[a39_0x2fd67e(0x22a)](_0x46c69b){const _0x6063c0=a39_0x2fd67e,_0x2f6f7c=_0x46c69b['toLowerCase']();if(_0x2f6f7c===_0x6063c0(0x1df))return 0x1;try{const _0x31b8ab=await database_1[_0x6063c0(0x208)][_0x6063c0(0x235)][_0x6063c0(0x22e)]({'where':{'currency':_0x2f6f7c}});if(!_0x31b8ab)return console[_0x6063c0(0x1d1)](_0x6063c0(0x207)+_0x46c69b+_0x6063c0(0x1f6)),0x1;return _0x31b8ab[_0x6063c0(0x1d3)];}catch(_0x213df8){return console[_0x6063c0(0x217)](_0x6063c0(0x1d9)+_0x46c69b+':',_0x213df8),0x1;}}async[a39_0x2fd67e(0x21b)](_0x44ee5c,_0x3b7123){const _0x53bbda=a39_0x2fd67e,_0x3d867c=_0x3b7123[_0x53bbda(0x1f3)]();if(_0x3d867c===_0x53bbda(0x1df)){const _0x41a73c=_0x44ee5c*(0x1+this[_0x53bbda(0x1f2)]/0x64);return console[_0x53bbda(0x1e6)](_0x53bbda(0x1d5)+this[_0x53bbda(0x1f2)]+'%\x20markup\x20to\x20'+_0x44ee5c+'\x20USDT\x20=\x20'+_0x41a73c['toFixed'](0x6)+_0x53bbda(0x228)),_0x41a73c;}try{const _0x93409c=await this[_0x53bbda(0x22a)](_0x3d867c),_0x50a0cd=_0x44ee5c/_0x93409c,_0x1fdbc8=_0x50a0cd*(0x1+this[_0x53bbda(0x1f2)]/0x64);return console[_0x53bbda(0x1e6)]('üí±\x20Converted\x20'+_0x44ee5c+'\x20'+_0x3b7123[_0x53bbda(0x1d8)]()+'\x20to\x20'+_0x50a0cd[_0x53bbda(0x202)](0x6)+_0x53bbda(0x214)+this[_0x53bbda(0x1f2)]+'%\x20markup\x20=\x20'+_0x1fdbc8['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x93409c+')'),_0x1fdbc8;}catch(_0x464cf2){console[_0x53bbda(0x217)](_0x53bbda(0x1d4)+_0x44ee5c+'\x20'+_0x3b7123+'\x20to\x20USDT:',_0x464cf2);const _0x5db619=_0x44ee5c*(0x1+this[_0x53bbda(0x1f2)]/0x64);return _0x5db619;}}async[a39_0x2fd67e(0x242)](_0x2baf5c){let _0x31a12f=0x0;for(const {amount:_0x2d5d0a,currency:_0x107fc1}of _0x2baf5c){const _0x3d8c65=await this['convertToUSDT'](_0x2d5d0a,_0x107fc1);_0x31a12f+=_0x3d8c65;}return _0x31a12f;}async[a39_0x2fd67e(0x1cf)](){const _0xd5b9cb=a39_0x2fd67e;try{const _0x33270a=await database_1[_0xd5b9cb(0x208)][_0xd5b9cb(0x235)][_0xd5b9cb(0x1f7)]({'select':{'currency':!![],'rate':!![]}}),_0x4e25b1={'usdt':0x1};return _0x33270a[_0xd5b9cb(0x20a)](_0x4ebf34=>{const _0x3665fb=_0xd5b9cb;_0x4e25b1[_0x4ebf34[_0x3665fb(0x1fc)]]=_0x4ebf34['rate'];}),_0x4e25b1;}catch(_0x346bd6){return console[_0xd5b9cb(0x217)]('Error\x20getting\x20all\x20rates:',_0x346bd6),{'usdt':0x1};}}async['getRatesStatus'](){const _0x212758=a39_0x2fd67e;try{const [_0x213af3,_0x11b24e,_0x123d1c]=await Promise['all']([database_1['default']['currencyRate'][_0x212758(0x200)](),database_1[_0x212758(0x208)][_0x212758(0x235)][_0x212758(0x1d6)]({'orderBy':{'updatedAt':_0x212758(0x22f)},'select':{'updatedAt':!![]}}),database_1['default'][_0x212758(0x235)][_0x212758(0x1d6)]({'orderBy':{'updatedAt':_0x212758(0x241)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x213af3,'lastUpdated':_0x11b24e?.[_0x212758(0x23e)]||null,'oldestRate':_0x123d1c?.[_0x212758(0x23e)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x1956c7){return console['error'](_0x212758(0x21c),_0x1956c7),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a39_0x2fd67e(0x211)](){return this['MARKUP_PERCENTAGE'];}}exports[a39_0x2fd67e(0x1e9)]=CurrencyService,exports[a39_0x2fd67e(0x1e7)]=new CurrencyService();function a39_0x5f3a(){const _0x8c7384=['currencyService','thb','CurrencyService','xrp','11048qSYOoI','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','18rhKksH','startPeriodicUpdates','length','2164446OWfpdb','MARKUP_PERCENTAGE','toLowerCase','cad','xag',',\x20using\x201\x20as\x20fallback','findMany','eos','5mHDMpv','allSettled','uah','currency','../config/database','twd','bmd','count','xau','toFixed','updateCurrencyRates','bits','aud','dkk','No\x20rate\x20found\x20for\x20currency:\x20','default','53748JDKNUd','forEach','1865652rZPhgJ','4180964dFfGxP','vef','brl','keys','xdr','getMarkupPercentage','\x20currencies','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','\x20USDT,\x20with\x20','czk','sats','error','ltc','updateInterval','1200xPpcnJ','convertToUSDT','Error\x20getting\x20rates\x20status:','hkd','nzd','__esModule','huf','sek','myr','entries','6759980xwZksn','pkr','gel','mmk','\x20USDT','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','getCurrencyRate','1287601NLJBhO','tether','sgd','findUnique','desc','https://api.coingecko.com/api/v3/simple/price','krw','ils','CURRENCIES','bnb','currencyRate','catch','json','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','cny','clp','pln','join','try','updatedAt','chf','usd','asc','convertMultipleToUSDT','eur','status','nok','map','üìä\x20Received\x20rates\x20for\x20','142KiXYnJ','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','dot','mxn','getAllRates','statusText','warn','xlm','rate','Error\x20converting\x20','üí±\x20Applied\x20','findFirst','bhd','toUpperCase','Error\x20getting\x20rate\x20for\x20currency\x20','COINGECKO_URL','aed','__importDefault','66SADFet','CoinGecko\x20API\x20error:\x20','usdt','sar','bdt','bch','inr','Failed\x20to\x20update\x20rate\x20for\x20','defineProperty','log'];a39_0x5f3a=function(){return _0x8c7384;};return a39_0x5f3a();}