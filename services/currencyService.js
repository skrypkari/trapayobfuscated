'use strict';function a38_0x3dcc(){const _0x23f453=['bits','eos','No\x20rate\x20found\x20for\x20currency:\x20','dot','7vTtgfe','toUpperCase','COINGECKO_URL','gel','getAllRates','Periodic\x20currency\x20rates\x20update\x20failed:','xlm','sats','toFixed','\x20USDT\x20(rate:\x20','usd','ngn','__esModule','?ids=tether&vs_currencies=','bmd','eur','updatedAt','hkd','xag','default','findMany','catch','all','currencyService','cny','bnb','kwd','https://api.coingecko.com/api/v3/simple/price','allSettled','currencyRate','idr','jpy','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','aed','updateInterval','Error\x20getting\x20all\x20rates:','forEach','Error\x20converting\x20','clp','php','status','CURRENCIES','485752lWdDZz','entries','vef','convertToUSDT','toLowerCase','cad','usdt','json','TesSoft\x20Payment\x20System/1.0','✅\x20Currency\x20rates\x20updated\x20successfully','bdt','warn','startPeriodicUpdates','rate','defineProperty','lkr','brl','length','__importDefault','%\x20markup\x20to\x20','convertMultipleToUSDT','2428833ESnOpx','MARKUP_PERCENTAGE','eth','9364878AuUzyp','\x20USDT\x20=\x20','myr','Failed\x20to\x20update\x20rate\x20for\x20','uah','mmk',',\x20using\x201\x20as\x20fallback','zar','mxn','getMarkupPercentage','\x20USDT,\x20with\x20','asc','thb','xrp','updateCurrencyRates','6919096CcgcOa','bhd','twd','krw','pkr','pln','❌\x20Failed\x20to\x20update\x20currency\x20rates:','ltc','upsert','17532rtINpW','tether','czk','findFirst','\x20USDT','sek','30Kkmurn','📊\x20Received\x20rates\x20for\x20','getRatesStatus','\x20currencies','ars','log','stopPeriodicUpdates','Initial\x20currency\x20rates\x20update\x20failed:','error','837060sAGYgP','💱\x20Applied\x20','💱\x20Converted\x20','sgd','\x20to\x20','20mjSQIK','map','dkk','gbp','nok','getCurrencyRate','statusText','%\x20markup\x20=\x20','1659602qKFOsP'];a38_0x3dcc=function(){return _0x23f453;};return a38_0x3dcc();}const a38_0x5bfe98=a38_0x3304;(function(_0x1db7c3,_0x531912){const _0x337526=a38_0x3304,_0x1b26f6=_0x1db7c3();while(!![]){try{const _0x493574=parseInt(_0x337526(0x122))/0x1+-parseInt(_0x337526(0x13e))/0x2+-parseInt(_0x337526(0x107))/0x3+parseInt(_0x337526(0xf2))/0x4*(-parseInt(_0x337526(0x128))/0x5)+-parseInt(_0x337526(0x131))/0x6+-parseInt(_0x337526(0x143))/0x7*(-parseInt(_0x337526(0x119))/0x8)+-parseInt(_0x337526(0x10a))/0x9*(-parseInt(_0x337526(0x136))/0xa);if(_0x493574===_0x531912)break;else _0x1b26f6['push'](_0x1b26f6['shift']());}catch(_0x1e90ee){_0x1b26f6['push'](_0x1b26f6['shift']());}}}(a38_0x3dcc,0x6f511));function a38_0x3304(_0x56e38a,_0x19db14){const _0x3dccc4=a38_0x3dcc();return a38_0x3304=function(_0x3304cc,_0x40b6d0){_0x3304cc=_0x3304cc-0xec;let _0x16272f=_0x3dccc4[_0x3304cc];return _0x16272f;},a38_0x3304(_0x56e38a,_0x19db14);}var __importDefault=this&&this[a38_0x5bfe98(0x104)]||function(_0x21aed2){const _0x47c4a1=a38_0x5bfe98;return _0x21aed2&&_0x21aed2[_0x47c4a1(0x14f)]?_0x21aed2:{'default':_0x21aed2};};Object[a38_0x5bfe98(0x100)](exports,a38_0x5bfe98(0x14f),{'value':!![]}),exports[a38_0x5bfe98(0x15a)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x59673e=a38_0x5bfe98;this[_0x59673e(0x145)]=_0x59673e(0x15e),this[_0x59673e(0xf1)]=['btc',_0x59673e(0x109),_0x59673e(0x120),'bch',_0x59673e(0x15c),_0x59673e(0x140),_0x59673e(0x117),_0x59673e(0x149),'link',_0x59673e(0x142),'yfi',_0x59673e(0x14d),_0x59673e(0x164),_0x59673e(0x12c),'aud',_0x59673e(0xfc),_0x59673e(0x11a),_0x59673e(0x151),_0x59673e(0x102),_0x59673e(0xf7),'chf',_0x59673e(0xee),_0x59673e(0x15b),_0x59673e(0x124),_0x59673e(0x138),_0x59673e(0x152),_0x59673e(0x139),_0x59673e(0x146),_0x59673e(0x154),'huf',_0x59673e(0x161),'ils','inr',_0x59673e(0x162),_0x59673e(0x11c),_0x59673e(0x15d),_0x59673e(0x101),_0x59673e(0x10f),_0x59673e(0x112),_0x59673e(0x10c),_0x59673e(0x14e),_0x59673e(0x13a),'nzd',_0x59673e(0xef),_0x59673e(0x11d),_0x59673e(0x11e),'rub','sar',_0x59673e(0x127),_0x59673e(0x134),_0x59673e(0x116),'try',_0x59673e(0x11b),_0x59673e(0x10e),_0x59673e(0xf4),'vnd',_0x59673e(0x111),'xdr',_0x59673e(0x155),'xau',_0x59673e(0x13f),_0x59673e(0x14a)],this[_0x59673e(0x165)]=null,this[_0x59673e(0x108)]=0x3,this[_0x59673e(0xfe)]();}['startPeriodicUpdates'](){const _0xdfba24=a38_0x5bfe98;this[_0xdfba24(0x118)]()[_0xdfba24(0x158)](_0x37ece3=>{const _0x113c02=_0xdfba24;console['error'](_0x113c02(0x12f),_0x37ece3);}),this[_0xdfba24(0x165)]=setInterval(async()=>{const _0x3645f4=_0xdfba24;try{await this[_0x3645f4(0x118)]();}catch(_0x23e58f){console['error'](_0x3645f4(0x148),_0x23e58f);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x5bfe98(0x12e)](){const _0xe7ee2=a38_0x5bfe98;this['updateInterval']&&(clearInterval(this[_0xe7ee2(0x165)]),this[_0xe7ee2(0x165)]=null,console['log'](_0xe7ee2(0x163)));}async[a38_0x5bfe98(0x118)](){const _0x314297=a38_0x5bfe98;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xabc603=this[_0x314297(0xf1)]['join'](','),_0x2613fc=this[_0x314297(0x145)]+_0x314297(0x150)+_0xabc603,_0x1c52bb=await fetch(_0x2613fc,{'headers':{'Accept':'application/json','User-Agent':_0x314297(0xfa)}});if(!_0x1c52bb['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1c52bb[_0x314297(0xf0)]+'\x20'+_0x1c52bb[_0x314297(0x13c)]);const _0x15b670=await _0x1c52bb[_0x314297(0xf9)]();if(!_0x15b670[_0x314297(0x123)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x478fc4=_0x15b670[_0x314297(0x123)];console[_0x314297(0x12d)](_0x314297(0x129)+Object['keys'](_0x478fc4)[_0x314297(0x103)]+_0x314297(0x12b));const _0x1a6884=Object[_0x314297(0xf3)](_0x478fc4)[_0x314297(0x137)](async([_0x5a43c2,_0x556bc9])=>{const _0x252eb0=_0x314297;try{await database_1[_0x252eb0(0x156)][_0x252eb0(0x160)][_0x252eb0(0x121)]({'where':{'currency':_0x5a43c2[_0x252eb0(0xf6)]()},'update':{'rate':_0x556bc9},'create':{'currency':_0x5a43c2[_0x252eb0(0xf6)](),'rate':_0x556bc9}});}catch(_0x1238e5){console[_0x252eb0(0x130)](_0x252eb0(0x10d)+_0x5a43c2+':',_0x1238e5);}});await Promise[_0x314297(0x15f)](_0x1a6884),console[_0x314297(0x12d)](_0x314297(0xfb));}catch(_0x37d0ac){console[_0x314297(0x130)](_0x314297(0x11f),_0x37d0ac);throw _0x37d0ac;}}async[a38_0x5bfe98(0x13b)](_0x3b77e5){const _0x7c7260=a38_0x5bfe98,_0x4474f8=_0x3b77e5['toLowerCase']();if(_0x4474f8==='usdt')return 0x1;try{const _0x15f8a3=await database_1[_0x7c7260(0x156)][_0x7c7260(0x160)]['findUnique']({'where':{'currency':_0x4474f8}});if(!_0x15f8a3)return console[_0x7c7260(0xfd)](_0x7c7260(0x141)+_0x3b77e5+_0x7c7260(0x110)),0x1;return _0x15f8a3[_0x7c7260(0xff)];}catch(_0x4a9bdb){return console[_0x7c7260(0x130)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x3b77e5+':',_0x4a9bdb),0x1;}}async[a38_0x5bfe98(0xf5)](_0xda1473,_0x28e09c){const _0xbc676c=a38_0x5bfe98,_0x32401c=_0x28e09c[_0xbc676c(0xf6)]();if(_0x32401c===_0xbc676c(0xf8)){const _0x141215=_0xda1473*(0x1+this[_0xbc676c(0x108)]/0x64);return console[_0xbc676c(0x12d)](_0xbc676c(0x132)+this['MARKUP_PERCENTAGE']+_0xbc676c(0x105)+_0xda1473+_0xbc676c(0x10b)+_0x141215[_0xbc676c(0x14b)](0x6)+_0xbc676c(0x126)),_0x141215;}try{const _0x37f2b3=await this[_0xbc676c(0x13b)](_0x32401c),_0x41610a=_0xda1473/_0x37f2b3,_0x4b22de=_0x41610a*(0x1+this[_0xbc676c(0x108)]/0x64);return console[_0xbc676c(0x12d)](_0xbc676c(0x133)+_0xda1473+'\x20'+_0x28e09c[_0xbc676c(0x144)]()+_0xbc676c(0x135)+_0x41610a[_0xbc676c(0x14b)](0x6)+_0xbc676c(0x114)+this['MARKUP_PERCENTAGE']+_0xbc676c(0x13d)+_0x4b22de[_0xbc676c(0x14b)](0x6)+_0xbc676c(0x14c)+_0x37f2b3+')'),_0x4b22de;}catch(_0x22e4f3){console[_0xbc676c(0x130)](_0xbc676c(0xed)+_0xda1473+'\x20'+_0x28e09c+'\x20to\x20USDT:',_0x22e4f3);const _0x5872f3=_0xda1473*(0x1+this[_0xbc676c(0x108)]/0x64);return _0x5872f3;}}async[a38_0x5bfe98(0x106)](_0x1c1d78){const _0x5ab82d=a38_0x5bfe98;let _0x18d18a=0x0;for(const {amount:_0x11becb,currency:_0x1d590a}of _0x1c1d78){const _0x5ad763=await this[_0x5ab82d(0xf5)](_0x11becb,_0x1d590a);_0x18d18a+=_0x5ad763;}return _0x18d18a;}async[a38_0x5bfe98(0x147)](){const _0x260cf6=a38_0x5bfe98;try{const _0x3750c4=await database_1[_0x260cf6(0x156)][_0x260cf6(0x160)][_0x260cf6(0x157)]({'select':{'currency':!![],'rate':!![]}}),_0x127e2a={'usdt':0x1};return _0x3750c4[_0x260cf6(0xec)](_0x3fcb1c=>{const _0x437f5e=_0x260cf6;_0x127e2a[_0x3fcb1c['currency']]=_0x3fcb1c[_0x437f5e(0xff)];}),_0x127e2a;}catch(_0x5df73d){return console[_0x260cf6(0x130)](_0x260cf6(0x166),_0x5df73d),{'usdt':0x1};}}async[a38_0x5bfe98(0x12a)](){const _0x5417cc=a38_0x5bfe98;try{const [_0x4e8685,_0xaece72,_0x40fe11]=await Promise[_0x5417cc(0x159)]([database_1[_0x5417cc(0x156)][_0x5417cc(0x160)]['count'](),database_1[_0x5417cc(0x156)]['currencyRate'][_0x5417cc(0x125)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x5417cc(0x160)][_0x5417cc(0x125)]({'orderBy':{'updatedAt':_0x5417cc(0x115)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4e8685,'lastUpdated':_0xaece72?.[_0x5417cc(0x153)]||null,'oldestRate':_0x40fe11?.[_0x5417cc(0x153)]||null,'markupPercentage':this[_0x5417cc(0x108)]};}catch(_0x3e0005){return console[_0x5417cc(0x130)]('Error\x20getting\x20rates\x20status:',_0x3e0005),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5417cc(0x108)]};}}[a38_0x5bfe98(0x113)](){const _0x2a7a48=a38_0x5bfe98;return this[_0x2a7a48(0x108)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();