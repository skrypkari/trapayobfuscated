'use strict';const a38_0x461b0a=a38_0x3d0e;(function(_0xb5906d,_0x179670){const _0x5e606a=a38_0x3d0e,_0x2c89fc=_0xb5906d();while(!![]){try{const _0x4708c2=parseInt(_0x5e606a(0xb7))/0x1*(-parseInt(_0x5e606a(0xf9))/0x2)+-parseInt(_0x5e606a(0xcf))/0x3*(parseInt(_0x5e606a(0x11a))/0x4)+parseInt(_0x5e606a(0xcd))/0x5*(-parseInt(_0x5e606a(0x10b))/0x6)+-parseInt(_0x5e606a(0x103))/0x7+-parseInt(_0x5e606a(0xd7))/0x8*(-parseInt(_0x5e606a(0x125))/0x9)+parseInt(_0x5e606a(0xfc))/0xa*(parseInt(_0x5e606a(0xe0))/0xb)+parseInt(_0x5e606a(0xca))/0xc*(parseInt(_0x5e606a(0xdc))/0xd);if(_0x4708c2===_0x179670)break;else _0x2c89fc['push'](_0x2c89fc['shift']());}catch(_0x4fbe77){_0x2c89fc['push'](_0x2c89fc['shift']());}}}(a38_0xc278,0xda37e));function a38_0x3d0e(_0x2c107f,_0x421d79){const _0xc27823=a38_0xc278();return a38_0x3d0e=function(_0x3d0e19,_0x3f723c){_0x3d0e19=_0x3d0e19-0xb7;let _0x2d5161=_0xc27823[_0x3d0e19];return _0x2d5161;},a38_0x3d0e(_0x2c107f,_0x421d79);}function a38_0xc278(){const _0x45beac=['inr','614hbAuYa','log','bmd','379040FUEpbc','CURRENCIES','MARKUP_PERCENTAGE','desc','ils','jpy','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','3522855YQYOLQ','default','COINGECKO_URL','nok',',\x20using\x201\x20as\x20fallback','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','updateInterval','TesSoft\x20Payment\x20System/1.0','516mErTOp','yfi','💱\x20Converted\x20','getAllRates','huf','startPeriodicUpdates','rub','getCurrencyRate','\x20USDT\x20(rate:\x20','CurrencyService','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','upsert','length','\x20USDT','sats','56jeuAaq','zar','entries','link','cny','getRatesStatus','toFixed','rate','Error\x20getting\x20rates\x20status:','mmk','findFirst','18WiRgFJ','ltc','usd','tether','toLowerCase','%\x20markup\x20=\x20','application/json','Initial\x20currency\x20rates\x20update\x20failed:','%\x20markup\x20to\x20','vnd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','convertToUSDT','try','thb','847TELLVQ','currencyService','updatedAt','bhd','xag','chf','idr','xau','toUpperCase','dot','asc','join','krw','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','myr','__esModule','sar','error','currencyRate','24KoHXAI','xrp','keys','5145jqWkoj','aed','182352gcXfuR','findMany','hkd','xdr','catch','map','gel','status','3193144Kmmgsw','stopPeriodicUpdates','pkr','currency','aud','10210694txcVUx','czk','getMarkupPercentage','bdt','66qftuUZ','all','Periodic\x20currency\x20rates\x20update\x20failed:','\x20USDT\x20=\x20','No\x20rate\x20found\x20for\x20currency:\x20','pln','statusText','eos','forEach','defineProperty','convertMultipleToUSDT','json','ars','mxn','bnb','xlm','ngn','?ids=tether&vs_currencies=','Failed\x20to\x20update\x20rate\x20for\x20','warn','\x20to\x20USDT:','eth','✅\x20Currency\x20rates\x20updated\x20successfully','Error\x20getting\x20rate\x20for\x20currency\x20'];a38_0xc278=function(){return _0x45beac;};return a38_0xc278();}var __importDefault=this&&this['__importDefault']||function(_0x50060c){return _0x50060c&&_0x50060c['__esModule']?_0x50060c:{'default':_0x50060c};};Object[a38_0x461b0a(0xe9)](exports,a38_0x461b0a(0xc6),{'value':!![]}),exports[a38_0x461b0a(0xb8)]=exports[a38_0x461b0a(0x114)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x3332b4=a38_0x461b0a;this[_0x3332b4(0x105)]='https://api.coingecko.com/api/v3/simple/price',this[_0x3332b4(0xfd)]=['btc',_0x3332b4(0xf5),_0x3332b4(0x126),'bch',_0x3332b4(0xee),_0x3332b4(0xe7),_0x3332b4(0xcb),_0x3332b4(0xef),_0x3332b4(0x11d),_0x3332b4(0xc0),_0x3332b4(0x10c),_0x3332b4(0x127),_0x3332b4(0xce),_0x3332b4(0xec),_0x3332b4(0xdb),_0x3332b4(0xdf),_0x3332b4(0xba),_0x3332b4(0xfb),'brl','cad',_0x3332b4(0xbc),'clp',_0x3332b4(0x11e),_0x3332b4(0xdd),'dkk','eur','gbp',_0x3332b4(0xd5),_0x3332b4(0xd1),_0x3332b4(0x10f),_0x3332b4(0xbd),_0x3332b4(0x100),_0x3332b4(0xf8),_0x3332b4(0x101),_0x3332b4(0xc3),'kwd','lkr',_0x3332b4(0x123),_0x3332b4(0xed),_0x3332b4(0xc5),_0x3332b4(0xf0),_0x3332b4(0x106),'nzd','php',_0x3332b4(0xd9),_0x3332b4(0xe5),_0x3332b4(0x111),_0x3332b4(0xc7),'sek','sgd',_0x3332b4(0x132),_0x3332b4(0x131),'twd','uah','vef',_0x3332b4(0x12e),_0x3332b4(0x11b),_0x3332b4(0xd2),_0x3332b4(0xbb),_0x3332b4(0xbe),'bits',_0x3332b4(0x119)],this[_0x3332b4(0x109)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x3332b4(0x110)]();}['startPeriodicUpdates'](){const _0x34f551=a38_0x461b0a;this['updateCurrencyRates']()[_0x34f551(0xd3)](_0x57c9c1=>{const _0x3c8e1d=_0x34f551;console['error'](_0x3c8e1d(0x12c),_0x57c9c1);}),this[_0x34f551(0x109)]=setInterval(async()=>{const _0x3719a5=_0x34f551;try{await this['updateCurrencyRates']();}catch(_0x46f6a4){console[_0x3719a5(0xc8)](_0x3719a5(0xe2),_0x46f6a4);}},0x3c*0x3c*0x3e8),console['log'](_0x34f551(0x108));}[a38_0x461b0a(0xd8)](){const _0x5256cc=a38_0x461b0a;this[_0x5256cc(0x109)]&&(clearInterval(this[_0x5256cc(0x109)]),this[_0x5256cc(0x109)]=null,console[_0x5256cc(0xfa)](_0x5256cc(0xc4)));}async['updateCurrencyRates'](){const _0x10ed12=a38_0x461b0a;try{console['log'](_0x10ed12(0x115));const _0x1ab06c=this['CURRENCIES'][_0x10ed12(0xc2)](','),_0xd3982e=this['COINGECKO_URL']+_0x10ed12(0xf1)+_0x1ab06c,_0x40b833=await fetch(_0xd3982e,{'headers':{'Accept':_0x10ed12(0x12b),'User-Agent':_0x10ed12(0x10a)}});if(!_0x40b833['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x40b833[_0x10ed12(0xd6)]+'\x20'+_0x40b833[_0x10ed12(0xe6)]);const _0xfebb2b=await _0x40b833[_0x10ed12(0xeb)]();if(!_0xfebb2b[_0x10ed12(0x128)])throw new Error(_0x10ed12(0x102));const _0x1a0858=_0xfebb2b[_0x10ed12(0x128)];console[_0x10ed12(0xfa)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x10ed12(0xcc)](_0x1a0858)[_0x10ed12(0x117)]+'\x20currencies');const _0x42ab2f=Object[_0x10ed12(0x11c)](_0x1a0858)[_0x10ed12(0xd4)](async([_0x17c5a1,_0x2d8cbc])=>{const _0x51cc5f=_0x10ed12;try{await database_1[_0x51cc5f(0x104)][_0x51cc5f(0xc9)][_0x51cc5f(0x116)]({'where':{'currency':_0x17c5a1[_0x51cc5f(0x129)]()},'update':{'rate':_0x2d8cbc},'create':{'currency':_0x17c5a1[_0x51cc5f(0x129)](),'rate':_0x2d8cbc}});}catch(_0x1cb66c){console['error'](_0x51cc5f(0xf2)+_0x17c5a1+':',_0x1cb66c);}});await Promise['allSettled'](_0x42ab2f),console[_0x10ed12(0xfa)](_0x10ed12(0xf6));}catch(_0xb724ab){console[_0x10ed12(0xc8)](_0x10ed12(0x12f),_0xb724ab);throw _0xb724ab;}}async['getCurrencyRate'](_0x43335f){const _0x4d9378=a38_0x461b0a,_0x2d4126=_0x43335f[_0x4d9378(0x129)]();if(_0x2d4126==='usdt')return 0x1;try{const _0x6d6576=await database_1[_0x4d9378(0x104)][_0x4d9378(0xc9)]['findUnique']({'where':{'currency':_0x2d4126}});if(!_0x6d6576)return console[_0x4d9378(0xf3)](_0x4d9378(0xe4)+_0x43335f+_0x4d9378(0x107)),0x1;return _0x6d6576['rate'];}catch(_0x111226){return console[_0x4d9378(0xc8)](_0x4d9378(0xf7)+_0x43335f+':',_0x111226),0x1;}}async[a38_0x461b0a(0x130)](_0x4ccb44,_0xe0f324){const _0x16c0e0=a38_0x461b0a,_0x1038d8=_0xe0f324[_0x16c0e0(0x129)]();if(_0x1038d8==='usdt'){const _0x4cbcf6=_0x4ccb44*(0x1+this[_0x16c0e0(0xfe)]/0x64);return console[_0x16c0e0(0xfa)]('💱\x20Applied\x20'+this[_0x16c0e0(0xfe)]+_0x16c0e0(0x12d)+_0x4ccb44+_0x16c0e0(0xe3)+_0x4cbcf6[_0x16c0e0(0x120)](0x6)+_0x16c0e0(0x118)),_0x4cbcf6;}try{const _0x23f59d=await this[_0x16c0e0(0x112)](_0x1038d8),_0x1314c7=_0x4ccb44/_0x23f59d,_0x54ab37=_0x1314c7*(0x1+this[_0x16c0e0(0xfe)]/0x64);return console[_0x16c0e0(0xfa)](_0x16c0e0(0x10d)+_0x4ccb44+'\x20'+_0xe0f324[_0x16c0e0(0xbf)]()+'\x20to\x20'+_0x1314c7['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x16c0e0(0xfe)]+_0x16c0e0(0x12a)+_0x54ab37[_0x16c0e0(0x120)](0x6)+_0x16c0e0(0x113)+_0x23f59d+')'),_0x54ab37;}catch(_0x2c0c89){console[_0x16c0e0(0xc8)]('Error\x20converting\x20'+_0x4ccb44+'\x20'+_0xe0f324+_0x16c0e0(0xf4),_0x2c0c89);const _0x499ad8=_0x4ccb44*(0x1+this[_0x16c0e0(0xfe)]/0x64);return _0x499ad8;}}async[a38_0x461b0a(0xea)](_0x436a96){let _0x2ff30a=0x0;for(const {amount:_0x5a0679,currency:_0x20ba90}of _0x436a96){const _0xfaa9c1=await this['convertToUSDT'](_0x5a0679,_0x20ba90);_0x2ff30a+=_0xfaa9c1;}return _0x2ff30a;}async[a38_0x461b0a(0x10e)](){const _0x11dffd=a38_0x461b0a;try{const _0x503db6=await database_1[_0x11dffd(0x104)][_0x11dffd(0xc9)][_0x11dffd(0xd0)]({'select':{'currency':!![],'rate':!![]}}),_0x15a816={'usdt':0x1};return _0x503db6[_0x11dffd(0xe8)](_0x315e52=>{const _0x45e683=_0x11dffd;_0x15a816[_0x315e52[_0x45e683(0xda)]]=_0x315e52[_0x45e683(0x121)];}),_0x15a816;}catch(_0x2687ce){return console['error']('Error\x20getting\x20all\x20rates:',_0x2687ce),{'usdt':0x1};}}async[a38_0x461b0a(0x11f)](){const _0x3c92ca=a38_0x461b0a;try{const [_0x5df5a1,_0x5261fa,_0x493116]=await Promise[_0x3c92ca(0xe1)]([database_1[_0x3c92ca(0x104)][_0x3c92ca(0xc9)]['count'](),database_1[_0x3c92ca(0x104)][_0x3c92ca(0xc9)][_0x3c92ca(0x124)]({'orderBy':{'updatedAt':_0x3c92ca(0xff)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x3c92ca(0x124)]({'orderBy':{'updatedAt':_0x3c92ca(0xc1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5df5a1,'lastUpdated':_0x5261fa?.[_0x3c92ca(0xb9)]||null,'oldestRate':_0x493116?.[_0x3c92ca(0xb9)]||null,'markupPercentage':this[_0x3c92ca(0xfe)]};}catch(_0x413c7f){return console[_0x3c92ca(0xc8)](_0x3c92ca(0x122),_0x413c7f),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3c92ca(0xfe)]};}}[a38_0x461b0a(0xde)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a38_0x461b0a(0xb8)]=new CurrencyService();