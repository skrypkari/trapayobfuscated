'use strict';const a58_0x44288a=a58_0x518e;(function(_0x14ae5c,_0x3b2c8e){const _0x35135c=a58_0x518e,_0x2bcfcf=_0x14ae5c();while(!![]){try{const _0x87890a=parseInt(_0x35135c(0x1b7))/0x1*(-parseInt(_0x35135c(0x1e1))/0x2)+parseInt(_0x35135c(0x1cf))/0x3+parseInt(_0x35135c(0x1e0))/0x4+parseInt(_0x35135c(0x1e3))/0x5*(-parseInt(_0x35135c(0x19a))/0x6)+parseInt(_0x35135c(0x1bd))/0x7*(parseInt(_0x35135c(0x19f))/0x8)+parseInt(_0x35135c(0x1a2))/0x9*(parseInt(_0x35135c(0x1df))/0xa)+-parseInt(_0x35135c(0x190))/0xb;if(_0x87890a===_0x3b2c8e)break;else _0x2bcfcf['push'](_0x2bcfcf['shift']());}catch(_0x24e639){_0x2bcfcf['push'](_0x2bcfcf['shift']());}}}(a58_0x3c77,0x7fd71));var __importDefault=this&&this[a58_0x44288a(0x19b)]||function(_0x5566b3){const _0x4666e5=a58_0x44288a;return _0x5566b3&&_0x5566b3[_0x4666e5(0x188)]?_0x5566b3:{'default':_0x5566b3};};Object[a58_0x44288a(0x1d0)](exports,a58_0x44288a(0x188),{'value':!![]}),exports[a58_0x44288a(0x1b9)]=exports[a58_0x44288a(0x1c6)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x491ae3=a58_0x44288a;this[_0x491ae3(0x1ea)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x491ae3(0x191),_0x491ae3(0x1cd),_0x491ae3(0x1d5),_0x491ae3(0x17d),'bnb',_0x491ae3(0x1d3),'xrp',_0x491ae3(0x1d4),_0x491ae3(0x1cb),_0x491ae3(0x184),_0x491ae3(0x1e6),_0x491ae3(0x1a5),'aed',_0x491ae3(0x1da),'aud',_0x491ae3(0x1e9),_0x491ae3(0x189),_0x491ae3(0x1f2),_0x491ae3(0x1ac),_0x491ae3(0x17f),'chf',_0x491ae3(0x19c),_0x491ae3(0x1d6),'czk','dkk',_0x491ae3(0x1e2),_0x491ae3(0x1be),_0x491ae3(0x1bb),_0x491ae3(0x1e7),_0x491ae3(0x1c0),_0x491ae3(0x192),_0x491ae3(0x1ed),_0x491ae3(0x1ee),_0x491ae3(0x1e5),_0x491ae3(0x1c7),_0x491ae3(0x1c9),_0x491ae3(0x18d),_0x491ae3(0x1f7),'mxn','myr','ngn','nok','nzd',_0x491ae3(0x1bf),_0x491ae3(0x195),_0x491ae3(0x1f5),'rub',_0x491ae3(0x1db),_0x491ae3(0x1d7),_0x491ae3(0x193),_0x491ae3(0x1b1),_0x491ae3(0x196),_0x491ae3(0x187),'uah',_0x491ae3(0x1aa),_0x491ae3(0x1b3),_0x491ae3(0x1a7),_0x491ae3(0x186),_0x491ae3(0x1eb),_0x491ae3(0x1de),_0x491ae3(0x18c),_0x491ae3(0x1d2)],this[_0x491ae3(0x19e)]=null,this[_0x491ae3(0x181)]=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x50ba09=a58_0x44288a;this[_0x50ba09(0x1a3)]()[_0x50ba09(0x18e)](_0x130516=>{const _0x3c77d7=_0x50ba09;console[_0x3c77d7(0x1ad)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x130516);}),this[_0x50ba09(0x19e)]=setInterval(async()=>{const _0x3edf76=_0x50ba09;try{await this[_0x3edf76(0x1a3)]();}catch(_0x5c0ca5){console[_0x3edf76(0x1ad)](_0x3edf76(0x1a4),_0x5c0ca5);}},0x3c*0x3c*0x3e8),console[_0x50ba09(0x1a8)](_0x50ba09(0x1f0));}['stopPeriodicUpdates'](){const _0x37a15a=a58_0x44288a;this[_0x37a15a(0x19e)]&&(clearInterval(this[_0x37a15a(0x19e)]),this[_0x37a15a(0x19e)]=null,console[_0x37a15a(0x1a8)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a58_0x44288a(0x1a3)](){const _0x21a706=a58_0x44288a;try{console[_0x21a706(0x1a8)]('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x228faa=this[_0x21a706(0x1e4)][_0x21a706(0x1ce)](','),_0x57fec7=this[_0x21a706(0x1ea)]+'?ids=tether&vs_currencies='+_0x228faa,_0x530d78=await fetch(_0x57fec7,{'headers':{'Accept':_0x21a706(0x1f4),'User-Agent':_0x21a706(0x1ef)}});if(!_0x530d78['ok'])throw new Error(_0x21a706(0x1f8)+_0x530d78[_0x21a706(0x1ca)]+'\x20'+_0x530d78[_0x21a706(0x1c1)]);const _0x2af3c0=await _0x530d78[_0x21a706(0x1c2)]();if(!_0x2af3c0[_0x21a706(0x183)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x15666b=_0x2af3c0[_0x21a706(0x183)];console[_0x21a706(0x1a8)](_0x21a706(0x1c5)+Object[_0x21a706(0x1a1)](_0x15666b)[_0x21a706(0x1cc)]+'\x20currencies');const _0x3169d7=0x5,_0x133996=Object[_0x21a706(0x185)](_0x15666b);for(let _0x25dfae=0x0;_0x25dfae<_0x133996['length'];_0x25dfae+=_0x3169d7){const _0x2052da=_0x133996[_0x21a706(0x1d9)](_0x25dfae,_0x25dfae+_0x3169d7),_0x2b23f4=_0x2052da[_0x21a706(0x1c3)](async([_0xa4265d,_0x5d6f5d])=>{const _0x367651=_0x21a706;try{await database_1[_0x367651(0x19d)][_0x367651(0x194)]['upsert']({'where':{'currency':_0xa4265d[_0x367651(0x1b0)]()},'update':{'rate':_0x5d6f5d},'create':{'currency':_0xa4265d[_0x367651(0x1b0)](),'rate':_0x5d6f5d}});}catch(_0x58f25f){console[_0x367651(0x1ad)](_0x367651(0x18a)+_0xa4265d+':',_0x58f25f);}});await Promise[_0x21a706(0x1ae)](_0x2b23f4);}console[_0x21a706(0x1a8)](_0x21a706(0x1af));}catch(_0x4061f2){console[_0x21a706(0x1ad)](_0x21a706(0x1e8),_0x4061f2);throw _0x4061f2;}}async[a58_0x44288a(0x1b6)](_0x3bc722){const _0x2c6141=a58_0x44288a,_0x1258dc=_0x3bc722[_0x2c6141(0x1b0)]();if(_0x1258dc===_0x2c6141(0x18f))return 0x1;try{const _0x5abfa0=await database_1[_0x2c6141(0x19d)][_0x2c6141(0x194)][_0x2c6141(0x1f6)]({'where':{'currency':_0x1258dc}});if(!_0x5abfa0)return console[_0x2c6141(0x18b)](_0x2c6141(0x1c4)+_0x3bc722+_0x2c6141(0x1b4)),0x1;return _0x5abfa0[_0x2c6141(0x17e)];}catch(_0x1ed75f){return console[_0x2c6141(0x1ad)](_0x2c6141(0x182)+_0x3bc722+':',_0x1ed75f),0x1;}}async[a58_0x44288a(0x1dd)](_0x337115,_0x44d4f6){const _0x47baf4=a58_0x44288a,_0x102fe8=_0x44d4f6['toLowerCase']();if(_0x102fe8===_0x47baf4(0x18f)){const _0x1cb5a3=_0x337115*(0x1+this[_0x47baf4(0x181)]/0x64);return console[_0x47baf4(0x1a8)](_0x47baf4(0x1ec)+this[_0x47baf4(0x181)]+'%\x20markup\x20to\x20'+_0x337115+_0x47baf4(0x1d1)+_0x1cb5a3[_0x47baf4(0x1b2)](0x6)+_0x47baf4(0x1bc)),_0x1cb5a3;}try{const _0x1f3933=await this[_0x47baf4(0x1b6)](_0x102fe8),_0x920d38=_0x337115/_0x1f3933,_0x31124c=_0x920d38*(0x1+this[_0x47baf4(0x181)]/0x64);return console[_0x47baf4(0x1a8)](_0x47baf4(0x180)+_0x337115+'\x20'+_0x44d4f6[_0x47baf4(0x1ab)]()+_0x47baf4(0x1a0)+_0x920d38[_0x47baf4(0x1b2)](0x6)+_0x47baf4(0x199)+this['MARKUP_PERCENTAGE']+_0x47baf4(0x197)+_0x31124c[_0x47baf4(0x1b2)](0x6)+_0x47baf4(0x1a9)+_0x1f3933+')'),_0x31124c;}catch(_0x23b9cd){console['error']('Error\x20converting\x20'+_0x337115+'\x20'+_0x44d4f6+_0x47baf4(0x1b5),_0x23b9cd);const _0x2b8d1a=_0x337115*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x2b8d1a;}}async['convertMultipleToUSDT'](_0x21779d){const _0x20acdf=a58_0x44288a;let _0x5c7566=0x0;for(const {amount:_0x508b90,currency:_0x483a8e}of _0x21779d){const _0x352d2c=await this[_0x20acdf(0x1dd)](_0x508b90,_0x483a8e);_0x5c7566+=_0x352d2c;}return _0x5c7566;}async[a58_0x44288a(0x1c8)](){const _0x2b6dfa=a58_0x44288a;try{const _0x519dfe=await database_1[_0x2b6dfa(0x19d)][_0x2b6dfa(0x194)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x7d64d2={'usdt':0x1};return _0x519dfe[_0x2b6dfa(0x1ba)](_0x3f3164=>{const _0x542161=_0x2b6dfa;_0x7d64d2[_0x3f3164[_0x542161(0x1d8)]]=_0x3f3164[_0x542161(0x17e)];}),_0x7d64d2;}catch(_0x1be9a3){return console[_0x2b6dfa(0x1ad)]('Error\x20getting\x20all\x20rates:',_0x1be9a3),{'usdt':0x1};}}async[a58_0x44288a(0x198)](){const _0x595f8b=a58_0x44288a;try{const [_0x3f1809,_0x229f90,_0x24c1b3]=await Promise[_0x595f8b(0x1ae)]([database_1[_0x595f8b(0x19d)]['currencyRate'][_0x595f8b(0x1b8)](),database_1[_0x595f8b(0x19d)][_0x595f8b(0x194)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x595f8b(0x19d)][_0x595f8b(0x194)][_0x595f8b(0x1dc)]({'orderBy':{'updatedAt':_0x595f8b(0x1a6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3f1809,'lastUpdated':_0x229f90?.[_0x595f8b(0x1f3)]||null,'oldestRate':_0x24c1b3?.[_0x595f8b(0x1f3)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x5f0327){return console[_0x595f8b(0x1ad)](_0x595f8b(0x1f1),_0x5f0327),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x595f8b(0x181)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}function a58_0x518e(_0x4d8ffb,_0x385d92){_0x4d8ffb=_0x4d8ffb-0x17d;const _0x3c77fd=a58_0x3c77();let _0x518ef7=_0x3c77fd[_0x4d8ffb];return _0x518ef7;}exports[a58_0x44288a(0x1c6)]=CurrencyService,exports[a58_0x44288a(0x1b9)]=new CurrencyService();function a58_0x3c77(){const _0x40a6f4=['sgd','currencyRate','pkr','try','%\x20markup\x20=\x20','getRatesStatus','\x20USDT,\x20with\x20','234cPpAPQ','__importDefault','clp','default','updateInterval','845328JDENxN','\x20to\x20','keys','1018053PukJWZ','updateCurrencyRates','Periodic\x20currency\x20rates\x20update\x20failed:','usd','asc','zar','log','\x20USDT\x20(rate:\x20','vef','toUpperCase','brl','error','all','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','toLowerCase','thb','toFixed','vnd',',\x20using\x201\x20as\x20fallback','\x20to\x20USDT:','getCurrencyRate','101xGGVWM','count','currencyService','forEach','gel','\x20USDT','49hPICha','gbp','php','huf','statusText','json','map','No\x20rate\x20found\x20for\x20currency:\x20','üìä\x20Received\x20rates\x20for\x20','CurrencyService','krw','getAllRates','kwd','status','link','length','eth','join','954294aIqANb','defineProperty','\x20USDT\x20=\x20','sats','eos','xlm','ltc','cny','sek','currency','slice','ars','sar','findFirst','convertToUSDT','xau','90zCpqjB','559644Hqqbpu','11686StjAAz','eur','15285AmEoPQ','CURRENCIES','jpy','yfi','hkd','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','bdt','COINGECKO_URL','xag','üí±\x20Applied\x20','ils','inr','Payment\x20System/1.0','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','Error\x20getting\x20rates\x20status:','bmd','updatedAt','application/json','pln','findUnique','mmk','CoinGecko\x20API\x20error:\x20','bch','rate','cad','üí±\x20Converted\x20','MARKUP_PERCENTAGE','Error\x20getting\x20rate\x20for\x20currency\x20','tether','dot','entries','xdr','twd','__esModule','bhd','Failed\x20to\x20update\x20rate\x20for\x20','warn','bits','lkr','catch','usdt','10809975qNPBDy','btc','idr'];a58_0x3c77=function(){return _0x40a6f4;};return a58_0x3c77();}