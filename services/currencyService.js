'use strict';const a38_0x58b44d=a38_0x5e45;(function(_0x459769,_0x4b49a3){const _0x22ce40=a38_0x5e45,_0x367e79=_0x459769();while(!![]){try{const _0x258e0f=parseInt(_0x22ce40(0x1fb))/0x1*(-parseInt(_0x22ce40(0x1c5))/0x2)+parseInt(_0x22ce40(0x1f0))/0x3*(-parseInt(_0x22ce40(0x1ed))/0x4)+-parseInt(_0x22ce40(0x1bd))/0x5+parseInt(_0x22ce40(0x1b0))/0x6*(-parseInt(_0x22ce40(0x1c8))/0x7)+-parseInt(_0x22ce40(0x1f5))/0x8*(-parseInt(_0x22ce40(0x1d2))/0x9)+-parseInt(_0x22ce40(0x1a2))/0xa+parseInt(_0x22ce40(0x1ec))/0xb;if(_0x258e0f===_0x4b49a3)break;else _0x367e79['push'](_0x367e79['shift']());}catch(_0x149cc2){_0x367e79['push'](_0x367e79['shift']());}}}(a38_0x536b,0xbf623));function a38_0x5e45(_0x412b70,_0xa5bd4a){const _0x536b1b=a38_0x536b();return a38_0x5e45=function(_0x5e451b,_0x5b7191){_0x5e451b=_0x5e451b-0x1a2;let _0x581fc6=_0x536b1b[_0x5e451b];return _0x581fc6;},a38_0x5e45(_0x412b70,_0xa5bd4a);}function a38_0x536b(){const _0x14998d=['toUpperCase','json','myr','__importDefault','xau','sats','\x20to\x20USDT:','eur','clp','nok','default','51556626xFfjbr','104IpiJfz','getCurrencyRate','status','170229ecsUxA','toLowerCase','allSettled','Periodic\x20currency\x20rates\x20update\x20failed:','No\x20rate\x20found\x20for\x20currency:\x20','418904NpSnMC','findFirst','huf','map','krw','keys','368273MPieDv','ltc','join','\x20USDT,\x20with\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','\x20USDT\x20=\x20','inr','ils','dot','💱\x20Converted\x20','jpy','getMarkupPercentage','COINGECKO_URL','asc','forEach','hkd','TesSoft\x20Payment\x20System/1.0','uah','💱\x20Applied\x20','gel','catch','warn','eos','btc','kwd','https://api.coingecko.com/api/v3/simple/price','dkk','eth','yfi','xdr','?ids=tether&vs_currencies=','updateInterval','xlm','xrp','bch','upsert','Error\x20converting\x20','application/json','currencyRate','startPeriodicUpdates','8635170SzlwqZ','bdt','php','vef','getRatesStatus','\x20currencies','tether','findUnique','statusText','try',',\x20using\x201\x20as\x20fallback','Error\x20getting\x20rate\x20for\x20currency\x20','usdt','findMany','12nUukgd','updateCurrencyRates','Error\x20getting\x20rates\x20status:','bits','brl','getAllRates','sek','count','thb','\x20USDT\x20(rate:\x20','convertToUSDT','defineProperty','desc','7326810cpQQez','sgd','pkr','xag','%\x20markup\x20to\x20','ngn','__esModule','error','6ryhvUz','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','vnd','1793995QoDZNl','CurrencyService','sar','toFixed','entries','zar','lkr','currencyService','❌\x20Failed\x20to\x20update\x20currency\x20rates:','rub','261Dtwicm','bhd','mxn','CURRENCIES','nzd','log','updatedAt','chf','MARKUP_PERCENTAGE','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','currency','length','bnb','cny','convertMultipleToUSDT'];a38_0x536b=function(){return _0x14998d;};return a38_0x536b();}var __importDefault=this&&this[a38_0x58b44d(0x1e4)]||function(_0x27ecc9){const _0x39a636=a38_0x58b44d;return _0x27ecc9&&_0x27ecc9[_0x39a636(0x1c3)]?_0x27ecc9:{'default':_0x27ecc9};};Object[a38_0x58b44d(0x1bb)](exports,a38_0x58b44d(0x1c3),{'value':!![]}),exports[a38_0x58b44d(0x1cf)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x4bef5d=a38_0x58b44d;this['COINGECKO_URL']=_0x4bef5d(0x214),this[_0x4bef5d(0x1d5)]=[_0x4bef5d(0x212),_0x4bef5d(0x216),_0x4bef5d(0x1fc),_0x4bef5d(0x21d),_0x4bef5d(0x1de),_0x4bef5d(0x211),_0x4bef5d(0x21c),_0x4bef5d(0x21b),'link',_0x4bef5d(0x203),_0x4bef5d(0x217),'usd','aed','ars','aud',_0x4bef5d(0x1a3),_0x4bef5d(0x1d3),'bmd',_0x4bef5d(0x1b4),'cad',_0x4bef5d(0x1d9),_0x4bef5d(0x1e9),_0x4bef5d(0x1df),'czk',_0x4bef5d(0x215),_0x4bef5d(0x1e8),'gbp',_0x4bef5d(0x20e),_0x4bef5d(0x20a),_0x4bef5d(0x1f7),'idr',_0x4bef5d(0x202),_0x4bef5d(0x201),_0x4bef5d(0x205),_0x4bef5d(0x1f9),_0x4bef5d(0x213),_0x4bef5d(0x1ce),'mmk',_0x4bef5d(0x1d4),_0x4bef5d(0x1e3),_0x4bef5d(0x1c2),_0x4bef5d(0x1ea),_0x4bef5d(0x1d6),_0x4bef5d(0x1a4),_0x4bef5d(0x1bf),'pln',_0x4bef5d(0x1d1),_0x4bef5d(0x1ca),_0x4bef5d(0x1b6),_0x4bef5d(0x1be),_0x4bef5d(0x1b8),_0x4bef5d(0x1ab),'twd',_0x4bef5d(0x20c),_0x4bef5d(0x1a5),_0x4bef5d(0x1c7),_0x4bef5d(0x1cd),_0x4bef5d(0x218),_0x4bef5d(0x1c0),_0x4bef5d(0x1e5),_0x4bef5d(0x1b3),_0x4bef5d(0x1e6)],this[_0x4bef5d(0x21a)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x4bef5d(0x222)]();}[a38_0x58b44d(0x222)](){const _0x25ec9d=a38_0x58b44d;this['updateCurrencyRates']()[_0x25ec9d(0x20f)](_0x19db6f=>{const _0x8bb63e=_0x25ec9d;console[_0x8bb63e(0x1c4)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x19db6f);}),this[_0x25ec9d(0x21a)]=setInterval(async()=>{const _0x151b5e=_0x25ec9d;try{await this[_0x151b5e(0x1b1)]();}catch(_0x7c5203){console[_0x151b5e(0x1c4)](_0x151b5e(0x1f3),_0x7c5203);}},0x3c*0x3c*0x3e8),console['log'](_0x25ec9d(0x1db));}['stopPeriodicUpdates'](){const _0x17667c=a38_0x58b44d;this['updateInterval']&&(clearInterval(this[_0x17667c(0x21a)]),this[_0x17667c(0x21a)]=null,console['log']('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x58b44d(0x1b1)](){const _0x512683=a38_0x58b44d;try{console[_0x512683(0x1d7)](_0x512683(0x1ff));const _0x5048de=this['CURRENCIES'][_0x512683(0x1fd)](','),_0x10a7c1=this[_0x512683(0x207)]+_0x512683(0x219)+_0x5048de,_0x3cde30=await fetch(_0x10a7c1,{'headers':{'Accept':_0x512683(0x220),'User-Agent':_0x512683(0x20b)}});if(!_0x3cde30['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x3cde30[_0x512683(0x1ef)]+'\x20'+_0x3cde30[_0x512683(0x1aa)]);const _0x4273d0=await _0x3cde30[_0x512683(0x1e2)]();if(!_0x4273d0[_0x512683(0x1a8)])throw new Error(_0x512683(0x1c6));const _0x584d90=_0x4273d0[_0x512683(0x1a8)];console[_0x512683(0x1d7)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x512683(0x1fa)](_0x584d90)[_0x512683(0x1dd)]+_0x512683(0x1a7));const _0x3e80f6=Object[_0x512683(0x1cc)](_0x584d90)[_0x512683(0x1f8)](async([_0x3bb424,_0x548a29])=>{const _0x474186=_0x512683;try{await database_1[_0x474186(0x1eb)][_0x474186(0x221)][_0x474186(0x21e)]({'where':{'currency':_0x3bb424[_0x474186(0x1f1)]()},'update':{'rate':_0x548a29},'create':{'currency':_0x3bb424[_0x474186(0x1f1)](),'rate':_0x548a29}});}catch(_0x59b87a){console[_0x474186(0x1c4)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x3bb424+':',_0x59b87a);}});await Promise[_0x512683(0x1f2)](_0x3e80f6),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x221659){console['error'](_0x512683(0x1d0),_0x221659);throw _0x221659;}}async[a38_0x58b44d(0x1ee)](_0x1effd2){const _0x133d3f=a38_0x58b44d,_0x411be9=_0x1effd2[_0x133d3f(0x1f1)]();if(_0x411be9===_0x133d3f(0x1ae))return 0x1;try{const _0xb59aee=await database_1[_0x133d3f(0x1eb)][_0x133d3f(0x221)][_0x133d3f(0x1a9)]({'where':{'currency':_0x411be9}});if(!_0xb59aee)return console[_0x133d3f(0x210)](_0x133d3f(0x1f4)+_0x1effd2+_0x133d3f(0x1ac)),0x1;return _0xb59aee['rate'];}catch(_0x2ae4f3){return console['error'](_0x133d3f(0x1ad)+_0x1effd2+':',_0x2ae4f3),0x1;}}async[a38_0x58b44d(0x1ba)](_0x486693,_0x3b92a0){const _0x4f846e=a38_0x58b44d,_0x15a479=_0x3b92a0[_0x4f846e(0x1f1)]();if(_0x15a479===_0x4f846e(0x1ae)){const _0x40a4b9=_0x486693*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x4f846e(0x20d)+this[_0x4f846e(0x1da)]+_0x4f846e(0x1c1)+_0x486693+_0x4f846e(0x200)+_0x40a4b9[_0x4f846e(0x1cb)](0x6)+'\x20USDT'),_0x40a4b9;}try{const _0x3f287d=await this[_0x4f846e(0x1ee)](_0x15a479),_0x246ed2=_0x486693/_0x3f287d,_0x14cd80=_0x246ed2*(0x1+this[_0x4f846e(0x1da)]/0x64);return console[_0x4f846e(0x1d7)](_0x4f846e(0x204)+_0x486693+'\x20'+_0x3b92a0[_0x4f846e(0x1e1)]()+'\x20to\x20'+_0x246ed2['toFixed'](0x6)+_0x4f846e(0x1fe)+this[_0x4f846e(0x1da)]+'%\x20markup\x20=\x20'+_0x14cd80[_0x4f846e(0x1cb)](0x6)+_0x4f846e(0x1b9)+_0x3f287d+')'),_0x14cd80;}catch(_0x884ec4){console[_0x4f846e(0x1c4)](_0x4f846e(0x21f)+_0x486693+'\x20'+_0x3b92a0+_0x4f846e(0x1e7),_0x884ec4);const _0x1ed2ea=_0x486693*(0x1+this[_0x4f846e(0x1da)]/0x64);return _0x1ed2ea;}}async[a38_0x58b44d(0x1e0)](_0x11d0e1){const _0x299892=a38_0x58b44d;let _0x420667=0x0;for(const {amount:_0x22fecf,currency:_0x28f719}of _0x11d0e1){const _0x2df041=await this[_0x299892(0x1ba)](_0x22fecf,_0x28f719);_0x420667+=_0x2df041;}return _0x420667;}async[a38_0x58b44d(0x1b5)](){const _0x539299=a38_0x58b44d;try{const _0x371d02=await database_1[_0x539299(0x1eb)][_0x539299(0x221)][_0x539299(0x1af)]({'select':{'currency':!![],'rate':!![]}}),_0x3bfefa={'usdt':0x1};return _0x371d02[_0x539299(0x209)](_0x2f4483=>{const _0x2a2d8e=_0x539299;_0x3bfefa[_0x2f4483[_0x2a2d8e(0x1dc)]]=_0x2f4483['rate'];}),_0x3bfefa;}catch(_0x34a09d){return console[_0x539299(0x1c4)]('Error\x20getting\x20all\x20rates:',_0x34a09d),{'usdt':0x1};}}async[a38_0x58b44d(0x1a6)](){const _0x95756f=a38_0x58b44d;try{const [_0x304b2c,_0xc12b5,_0xe72f0d]=await Promise['all']([database_1[_0x95756f(0x1eb)][_0x95756f(0x221)][_0x95756f(0x1b7)](),database_1[_0x95756f(0x1eb)]['currencyRate'][_0x95756f(0x1f6)]({'orderBy':{'updatedAt':_0x95756f(0x1bc)},'select':{'updatedAt':!![]}}),database_1[_0x95756f(0x1eb)][_0x95756f(0x221)]['findFirst']({'orderBy':{'updatedAt':_0x95756f(0x208)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x304b2c,'lastUpdated':_0xc12b5?.[_0x95756f(0x1d8)]||null,'oldestRate':_0xe72f0d?.['updatedAt']||null,'markupPercentage':this[_0x95756f(0x1da)]};}catch(_0x28d487){return console['error'](_0x95756f(0x1b2),_0x28d487),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x95756f(0x1da)]};}}[a38_0x58b44d(0x206)](){const _0x159d83=a38_0x58b44d;return this[_0x159d83(0x1da)];}}exports[a38_0x58b44d(0x1c9)]=CurrencyService,exports[a38_0x58b44d(0x1cf)]=new CurrencyService();