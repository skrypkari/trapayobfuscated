'use strict';function a38_0x1349(){const _0x36ed8e=['currencyRate','1460628uprGfQ','__esModule','xlm','updateInterval','393990PZxFUU','currencyService','zar','all','sats','convertToUSDT','kwd','entries','map','CurrencyService','sgd','../config/database','ngn','ils','link','📊\x20Received\x20rates\x20for\x20','5968456cAcybd','Error\x20converting\x20','xag','MARKUP_PERCENTAGE','error','Periodic\x20currency\x20rates\x20update\x20failed:','nok','bnb','btc','myr','TesSoft\x20Payment\x20System/1.0','ars','CURRENCIES','sek','jpy','hkd','✅\x20Currency\x20rates\x20updated\x20successfully','37817Oymnkw','sar','\x20USDT','CoinGecko\x20API\x20error:\x20','count','updatedAt','asc','eur','aed','gbp','bhd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','huf','eos','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','xrp','usdt','\x20USDT,\x20with\x20','forEach','catch','clp','toLowerCase','dkk','updateCurrencyRates','4487njdlPv','statusText','startPeriodicUpdates','czk','toFixed','tether','chf','eth','rub','nzd','vef','findMany','%\x20markup\x20=\x20','\x20to\x20','getCurrencyRate','application/json','1309930QmgQHE','convertMultipleToUSDT','warn','getRatesStatus','bdt','💱\x20Applied\x20','join','pln','keys','php','upsert','__importDefault','Error\x20getting\x20rates\x20status:','56ygpNoN','\x20currencies','cny','desc','225HzcWzl','length','4441584RLbarm','log','❌\x20Failed\x20to\x20update\x20currency\x20rates:','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates',',\x20using\x201\x20as\x20fallback','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','twd','💱\x20Converted\x20','yfi','findFirst','pkr','findUnique','No\x20rate\x20found\x20for\x20currency:\x20','Error\x20getting\x20all\x20rates:','Error\x20getting\x20rate\x20for\x20currency\x20','default','rate','\x20USDT\x20=\x20','https://api.coingecko.com/api/v3/simple/price','16328DfEzTf','dot','lkr','mxn','Initial\x20currency\x20rates\x20update\x20failed:','brl','COINGECKO_URL','stopPeriodicUpdates'];a38_0x1349=function(){return _0x36ed8e;};return a38_0x1349();}const a38_0x54d3dc=a38_0x3898;function a38_0x3898(_0x312ce3,_0x5b3847){const _0x134998=a38_0x1349();return a38_0x3898=function(_0x389859,_0x4476d2){_0x389859=_0x389859-0xcf;let _0x5ae33e=_0x134998[_0x389859];return _0x5ae33e;},a38_0x3898(_0x312ce3,_0x5b3847);}(function(_0x373c58,_0x5af440){const _0x29047f=a38_0x3898,_0x178043=_0x373c58();while(!![]){try{const _0x112ee1=parseInt(_0x29047f(0xd3))/0x1*(-parseInt(_0x29047f(0x108))/0x2)+-parseInt(_0x29047f(0x12a))/0x3+-parseInt(_0x29047f(0x13e))/0x4+parseInt(_0x29047f(0x12e))/0x5+-parseInt(_0x29047f(0x10e))/0x6+-parseInt(_0x29047f(0xeb))/0x7*(-parseInt(_0x29047f(0x121))/0x8)+parseInt(_0x29047f(0x10c))/0x9*(parseInt(_0x29047f(0xfb))/0xa);if(_0x112ee1===_0x5af440)break;else _0x178043['push'](_0x178043['shift']());}catch(_0x4e55ec){_0x178043['push'](_0x178043['shift']());}}}(a38_0x1349,0xd7c3e));var __importDefault=this&&this[a38_0x54d3dc(0x106)]||function(_0x16dcfd){const _0x50f17=a38_0x54d3dc;return _0x16dcfd&&_0x16dcfd[_0x50f17(0x12b)]?_0x16dcfd:{'default':_0x16dcfd};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports[a38_0x54d3dc(0x137)]=void 0x0;const database_1=__importDefault(require(a38_0x54d3dc(0x139)));class CurrencyService{constructor(){const _0x518bdc=a38_0x54d3dc;this['COINGECKO_URL']=_0x518bdc(0x120),this['CURRENCIES']=[_0x518bdc(0x146),_0x518bdc(0xf2),'ltc','bch',_0x518bdc(0x145),_0x518bdc(0xe0),_0x518bdc(0xe2),_0x518bdc(0x12c),_0x518bdc(0x13c),_0x518bdc(0x122),_0x518bdc(0x116),'usd',_0x518bdc(0xdb),_0x518bdc(0x149),'aud',_0x518bdc(0xff),_0x518bdc(0xdd),'bmd',_0x518bdc(0x126),'cad',_0x518bdc(0xf1),_0x518bdc(0xe7),_0x518bdc(0x10a),_0x518bdc(0xee),_0x518bdc(0xe9),_0x518bdc(0xda),_0x518bdc(0xdc),'gel',_0x518bdc(0xd1),_0x518bdc(0xdf),'idr',_0x518bdc(0x13b),'inr',_0x518bdc(0xd0),'krw',_0x518bdc(0x134),_0x518bdc(0x123),'mmk',_0x518bdc(0x124),_0x518bdc(0x147),_0x518bdc(0x13a),_0x518bdc(0x144),_0x518bdc(0xf4),_0x518bdc(0x104),_0x518bdc(0x118),_0x518bdc(0x102),_0x518bdc(0xf3),_0x518bdc(0xd4),_0x518bdc(0xcf),_0x518bdc(0x138),'thb','try',_0x518bdc(0x114),'uah',_0x518bdc(0xf5),'vnd',_0x518bdc(0x130),'xdr',_0x518bdc(0x140),'xau','bits',_0x518bdc(0x132)],this[_0x518bdc(0x12d)]=null,this[_0x518bdc(0x141)]=0x3,this['startPeriodicUpdates']();}[a38_0x54d3dc(0xed)](){const _0x62be12=a38_0x54d3dc;this[_0x62be12(0xea)]()[_0x62be12(0xe6)](_0x472f56=>{const _0x27f542=_0x62be12;console['error'](_0x27f542(0x125),_0x472f56);}),this['updateInterval']=setInterval(async()=>{const _0x540a2a=_0x62be12;try{await this['updateCurrencyRates']();}catch(_0x48e338){console[_0x540a2a(0x142)](_0x540a2a(0x143),_0x48e338);}},0x3c*0x3c*0x3e8),console['log'](_0x62be12(0x111));}[a38_0x54d3dc(0x128)](){const _0x36eb5f=a38_0x54d3dc;this[_0x36eb5f(0x12d)]&&(clearInterval(this[_0x36eb5f(0x12d)]),this[_0x36eb5f(0x12d)]=null,console[_0x36eb5f(0x10f)](_0x36eb5f(0xe1)));}async[a38_0x54d3dc(0xea)](){const _0x330a64=a38_0x54d3dc;try{console[_0x330a64(0x10f)](_0x330a64(0x113));const _0x1a0579=this[_0x330a64(0x14a)][_0x330a64(0x101)](','),_0x32bb70=this[_0x330a64(0x127)]+'?ids=tether&vs_currencies='+_0x1a0579,_0x32911d=await fetch(_0x32bb70,{'headers':{'Accept':_0x330a64(0xfa),'User-Agent':_0x330a64(0x148)}});if(!_0x32911d['ok'])throw new Error(_0x330a64(0xd6)+_0x32911d['status']+'\x20'+_0x32911d[_0x330a64(0xec)]);const _0x10469a=await _0x32911d['json']();if(!_0x10469a[_0x330a64(0xf0)])throw new Error(_0x330a64(0xde));const _0x52f95a=_0x10469a[_0x330a64(0xf0)];console[_0x330a64(0x10f)](_0x330a64(0x13d)+Object[_0x330a64(0x103)](_0x52f95a)[_0x330a64(0x10d)]+_0x330a64(0x109));const _0x3c59bb=Object[_0x330a64(0x135)](_0x52f95a)[_0x330a64(0x136)](async([_0x2e1b2c,_0x1e8736])=>{const _0x19287f=_0x330a64;try{await database_1[_0x19287f(0x11d)][_0x19287f(0x129)][_0x19287f(0x105)]({'where':{'currency':_0x2e1b2c[_0x19287f(0xe8)]()},'update':{'rate':_0x1e8736},'create':{'currency':_0x2e1b2c['toLowerCase'](),'rate':_0x1e8736}});}catch(_0x3684ad){console[_0x19287f(0x142)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x2e1b2c+':',_0x3684ad);}});await Promise['allSettled'](_0x3c59bb),console['log'](_0x330a64(0xd2));}catch(_0x19587f){console[_0x330a64(0x142)](_0x330a64(0x110),_0x19587f);throw _0x19587f;}}async[a38_0x54d3dc(0xf9)](_0xed9e55){const _0x38b243=a38_0x54d3dc,_0x353323=_0xed9e55['toLowerCase']();if(_0x353323===_0x38b243(0xe3))return 0x1;try{const _0x1b47ff=await database_1[_0x38b243(0x11d)][_0x38b243(0x129)][_0x38b243(0x119)]({'where':{'currency':_0x353323}});if(!_0x1b47ff)return console[_0x38b243(0xfd)](_0x38b243(0x11a)+_0xed9e55+_0x38b243(0x112)),0x1;return _0x1b47ff['rate'];}catch(_0x159523){return console[_0x38b243(0x142)](_0x38b243(0x11c)+_0xed9e55+':',_0x159523),0x1;}}async[a38_0x54d3dc(0x133)](_0xe80721,_0x347052){const _0x1d94c4=a38_0x54d3dc,_0x5921c3=_0x347052[_0x1d94c4(0xe8)]();if(_0x5921c3===_0x1d94c4(0xe3)){const _0x39c0bd=_0xe80721*(0x1+this[_0x1d94c4(0x141)]/0x64);return console[_0x1d94c4(0x10f)](_0x1d94c4(0x100)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0xe80721+_0x1d94c4(0x11f)+_0x39c0bd['toFixed'](0x6)+_0x1d94c4(0xd5)),_0x39c0bd;}try{const _0x553e12=await this[_0x1d94c4(0xf9)](_0x5921c3),_0x21da6f=_0xe80721/_0x553e12,_0x127601=_0x21da6f*(0x1+this[_0x1d94c4(0x141)]/0x64);return console[_0x1d94c4(0x10f)](_0x1d94c4(0x115)+_0xe80721+'\x20'+_0x347052['toUpperCase']()+_0x1d94c4(0xf8)+_0x21da6f[_0x1d94c4(0xef)](0x6)+_0x1d94c4(0xe4)+this[_0x1d94c4(0x141)]+_0x1d94c4(0xf7)+_0x127601[_0x1d94c4(0xef)](0x6)+'\x20USDT\x20(rate:\x20'+_0x553e12+')'),_0x127601;}catch(_0x2cc341){console[_0x1d94c4(0x142)](_0x1d94c4(0x13f)+_0xe80721+'\x20'+_0x347052+'\x20to\x20USDT:',_0x2cc341);const _0x4f6936=_0xe80721*(0x1+this[_0x1d94c4(0x141)]/0x64);return _0x4f6936;}}async[a38_0x54d3dc(0xfc)](_0x415a1f){let _0xf6302c=0x0;for(const {amount:_0x4f7932,currency:_0x45ba86}of _0x415a1f){const _0x3d8b65=await this['convertToUSDT'](_0x4f7932,_0x45ba86);_0xf6302c+=_0x3d8b65;}return _0xf6302c;}async['getAllRates'](){const _0x5f24bf=a38_0x54d3dc;try{const _0x4da28c=await database_1['default'][_0x5f24bf(0x129)][_0x5f24bf(0xf6)]({'select':{'currency':!![],'rate':!![]}}),_0x2451de={'usdt':0x1};return _0x4da28c[_0x5f24bf(0xe5)](_0x41a486=>{const _0x52ab3f=_0x5f24bf;_0x2451de[_0x41a486['currency']]=_0x41a486[_0x52ab3f(0x11e)];}),_0x2451de;}catch(_0x3a264c){return console['error'](_0x5f24bf(0x11b),_0x3a264c),{'usdt':0x1};}}async[a38_0x54d3dc(0xfe)](){const _0x4dca25=a38_0x54d3dc;try{const [_0x3b292f,_0x4e6016,_0x4afaf5]=await Promise[_0x4dca25(0x131)]([database_1[_0x4dca25(0x11d)]['currencyRate'][_0x4dca25(0xd7)](),database_1['default'][_0x4dca25(0x129)][_0x4dca25(0x117)]({'orderBy':{'updatedAt':_0x4dca25(0x10b)},'select':{'updatedAt':!![]}}),database_1[_0x4dca25(0x11d)][_0x4dca25(0x129)]['findFirst']({'orderBy':{'updatedAt':_0x4dca25(0xd9)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3b292f,'lastUpdated':_0x4e6016?.['updatedAt']||null,'oldestRate':_0x4afaf5?.[_0x4dca25(0xd8)]||null,'markupPercentage':this[_0x4dca25(0x141)]};}catch(_0x1395bf){return console[_0x4dca25(0x142)](_0x4dca25(0x107),_0x1395bf),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4dca25(0x141)]};}}['getMarkupPercentage'](){const _0x376892=a38_0x54d3dc;return this[_0x376892(0x141)];}}exports[a38_0x54d3dc(0x137)]=CurrencyService,exports[a38_0x54d3dc(0x12f)]=new CurrencyService();