'use strict';const a58_0x2dadba=a58_0x126b;(function(_0x595143,_0x5654ca){const _0x393cb2=a58_0x126b,_0x5334ee=_0x595143();while(!![]){try{const _0x100aff=-parseInt(_0x393cb2(0x144))/0x1*(-parseInt(_0x393cb2(0x157))/0x2)+parseInt(_0x393cb2(0x137))/0x3+-parseInt(_0x393cb2(0x135))/0x4+parseInt(_0x393cb2(0x111))/0x5+-parseInt(_0x393cb2(0x141))/0x6*(-parseInt(_0x393cb2(0x121))/0x7)+parseInt(_0x393cb2(0x15e))/0x8+-parseInt(_0x393cb2(0x106))/0x9;if(_0x100aff===_0x5654ca)break;else _0x5334ee['push'](_0x5334ee['shift']());}catch(_0x491260){_0x5334ee['push'](_0x5334ee['shift']());}}}(a58_0x4b92,0xc4823));function a58_0x4b92(){const _0x270826=['brl','tether','\x20USDT,\x20with\x20','thb','status','ðŸ’±\x20Applied\x20','bhd','%\x20markup\x20=\x20','\x20currencies','log','kwd','dot','4864700XraLFm','âœ…\x20Currency\x20rates\x20updated\x20successfully','3375765ztQiiq','../config/database','catch','bmd','CoinGecko\x20API\x20error:\x20','No\x20rate\x20found\x20for\x20currency:\x20','gbp','COINGECKO_URL','Error\x20getting\x20rate\x20for\x20currency\x20','\x20USDT','72lKvtxI','idr','keys','83tihBtK','cad','findUnique','ars','MARKUP_PERCENTAGE','xrp','eur','sek','findMany','https://api.coingecko.com/api/v3/simple/price','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xau','toLowerCase','%\x20markup\x20to\x20','mxn','dkk','clp','bch','toUpperCase','27210FpEXHA','xdr','\x20USDT\x20(rate:\x20','getMarkupPercentage','CURRENCIES','myr','uah','11975552zJWKtg','aed','czk','\x20to\x20','huf','Error\x20getting\x20all\x20rates:','usdt','xag','eth','cny','sar','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','currencyService','Failed\x20to\x20update\x20rate\x20for\x20','ltc','zar','count','vnd','stopPeriodicUpdates','updateInterval','json','currency','map','ðŸ’±\x20Converted\x20','xlm','bnb','aud','default','twd','statusText','toFixed','updatedAt','all','vef','jpy','33998013UaQADR','asc','updateCurrencyRates','__importDefault','gel','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','CurrencyService','pln','\x20to\x20USDT:','join','error','3662905POzuAx','desc','defineProperty','Error\x20getting\x20rates\x20status:','startPeriodicUpdates','getCurrencyRate','convertToUSDT','currencyRate','?ids=tether&vs_currencies=','application/json','getAllRates','length','findFirst','sgd','Payment\x20System/1.0','eos','766871EsJOya','ðŸ“Š\x20Received\x20rates\x20for\x20','Error\x20converting\x20','krw','nzd','mmk','__esModule','link'];a58_0x4b92=function(){return _0x270826;};return a58_0x4b92();}function a58_0x126b(_0x515f91,_0x502de3){_0x515f91=_0x515f91-0xeb;const _0x4b92aa=a58_0x4b92();let _0x126b9b=_0x4b92aa[_0x515f91];return _0x126b9b;}var __importDefault=this&&this[a58_0x2dadba(0x109)]||function(_0x5c5c2b){const _0x12f221=a58_0x2dadba;return _0x5c5c2b&&_0x5c5c2b[_0x12f221(0x127)]?_0x5c5c2b:{'default':_0x5c5c2b};};Object[a58_0x2dadba(0x113)](exports,a58_0x2dadba(0x127),{'value':!![]}),exports[a58_0x2dadba(0xef)]=exports[a58_0x2dadba(0x10c)]=void 0x0;const database_1=__importDefault(require(a58_0x2dadba(0x138)));class CurrencyService{constructor(){const _0x57b47c=a58_0x2dadba;this[_0x57b47c(0x13e)]=_0x57b47c(0x14d),this[_0x57b47c(0x15b)]=['btc',_0x57b47c(0xeb),_0x57b47c(0xf1),_0x57b47c(0x155),_0x57b47c(0xfc),_0x57b47c(0x120),_0x57b47c(0x149),_0x57b47c(0xfb),_0x57b47c(0x128),_0x57b47c(0x134),'yfi','usd',_0x57b47c(0x15f),_0x57b47c(0x147),_0x57b47c(0xfd),'bdt',_0x57b47c(0x12f),_0x57b47c(0x13a),_0x57b47c(0x129),_0x57b47c(0x145),'chf',_0x57b47c(0x154),_0x57b47c(0xec),_0x57b47c(0x160),_0x57b47c(0x153),_0x57b47c(0x14a),_0x57b47c(0x13d),_0x57b47c(0x10a),'hkd',_0x57b47c(0x162),_0x57b47c(0x142),'ils','inr',_0x57b47c(0x105),_0x57b47c(0x124),_0x57b47c(0x133),'lkr',_0x57b47c(0x126),_0x57b47c(0x152),_0x57b47c(0x15c),'ngn','nok',_0x57b47c(0x125),'php','pkr',_0x57b47c(0x10d),'rub',_0x57b47c(0xed),_0x57b47c(0x14b),_0x57b47c(0x11e),_0x57b47c(0x12c),'try',_0x57b47c(0xff),_0x57b47c(0x15d),_0x57b47c(0x104),_0x57b47c(0xf4),_0x57b47c(0xf2),_0x57b47c(0x158),_0x57b47c(0x165),_0x57b47c(0x14f),'bits','sats'],this[_0x57b47c(0xf6)]=null,this[_0x57b47c(0x148)]=-0x3,this[_0x57b47c(0x115)]();}[a58_0x2dadba(0x115)](){const _0x212c1d=a58_0x2dadba;this[_0x212c1d(0x108)]()[_0x212c1d(0x139)](_0x234830=>{const _0x5689f8=_0x212c1d;console[_0x5689f8(0x110)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x234830);}),this['updateInterval']=setInterval(async()=>{const _0x3a4210=_0x212c1d;try{await this[_0x3a4210(0x108)]();}catch(_0x52aa54){console[_0x3a4210(0x110)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x52aa54);}},0x3c*0x3c*0x3e8),console[_0x212c1d(0x132)](_0x212c1d(0x14e));}[a58_0x2dadba(0xf5)](){const _0x4a8c07=a58_0x2dadba;this[_0x4a8c07(0xf6)]&&(clearInterval(this['updateInterval']),this[_0x4a8c07(0xf6)]=null,console[_0x4a8c07(0x132)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a58_0x2dadba(0x108)](){const _0x1c46f3=a58_0x2dadba;try{console['log'](_0x1c46f3(0x10b));const _0x3858f6=this['CURRENCIES'][_0x1c46f3(0x10f)](','),_0x3e32ca=this[_0x1c46f3(0x13e)]+_0x1c46f3(0x119)+_0x3858f6,_0x2ff391=await fetch(_0x3e32ca,{'headers':{'Accept':_0x1c46f3(0x11a),'User-Agent':_0x1c46f3(0x11f)}});if(!_0x2ff391['ok'])throw new Error(_0x1c46f3(0x13b)+_0x2ff391[_0x1c46f3(0x12d)]+'\x20'+_0x2ff391[_0x1c46f3(0x100)]);const _0x41cc2f=await _0x2ff391[_0x1c46f3(0xf7)]();if(!_0x41cc2f[_0x1c46f3(0x12a)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x369a1d=_0x41cc2f[_0x1c46f3(0x12a)];console[_0x1c46f3(0x132)](_0x1c46f3(0x122)+Object[_0x1c46f3(0x143)](_0x369a1d)['length']+_0x1c46f3(0x131));const _0x2fc119=0x5,_0x3ac9ae=Object['entries'](_0x369a1d);for(let _0x4e5646=0x0;_0x4e5646<_0x3ac9ae[_0x1c46f3(0x11c)];_0x4e5646+=_0x2fc119){const _0x4f4691=_0x3ac9ae['slice'](_0x4e5646,_0x4e5646+_0x2fc119),_0x3fab7f=_0x4f4691[_0x1c46f3(0xf9)](async([_0x36f358,_0x40f397])=>{const _0x130eef=_0x1c46f3;try{await database_1[_0x130eef(0xfe)][_0x130eef(0x118)]['upsert']({'where':{'currency':_0x36f358[_0x130eef(0x150)]()},'update':{'rate':_0x40f397},'create':{'currency':_0x36f358['toLowerCase'](),'rate':_0x40f397}});}catch(_0x1d9f8f){console[_0x130eef(0x110)](_0x130eef(0xf0)+_0x36f358+':',_0x1d9f8f);}});await Promise[_0x1c46f3(0x103)](_0x3fab7f);}console[_0x1c46f3(0x132)](_0x1c46f3(0x136));}catch(_0xc324a2){console[_0x1c46f3(0x110)](_0x1c46f3(0xee),_0xc324a2);throw _0xc324a2;}}async[a58_0x2dadba(0x116)](_0x4277ff){const _0x21880c=a58_0x2dadba,_0x4f9e0a=_0x4277ff[_0x21880c(0x150)]();if(_0x4f9e0a==='usdt')return 0x1;try{const _0x170744=await database_1[_0x21880c(0xfe)][_0x21880c(0x118)][_0x21880c(0x146)]({'where':{'currency':_0x4f9e0a}});if(!_0x170744)return console['warn'](_0x21880c(0x13c)+_0x4277ff+',\x20using\x201\x20as\x20fallback'),0x1;return _0x170744['rate'];}catch(_0x3fc254){return console[_0x21880c(0x110)](_0x21880c(0x13f)+_0x4277ff+':',_0x3fc254),0x1;}}async['convertToUSDT'](_0x1bb21e,_0x56b93e){const _0x53339a=a58_0x2dadba,_0x51ccdb=_0x56b93e[_0x53339a(0x150)]();if(_0x51ccdb===_0x53339a(0x164)){const _0x451f24=_0x1bb21e*(0x1+this[_0x53339a(0x148)]/0x64);return console[_0x53339a(0x132)](_0x53339a(0x12e)+this[_0x53339a(0x148)]+_0x53339a(0x151)+_0x1bb21e+'\x20USDT\x20=\x20'+_0x451f24[_0x53339a(0x101)](0x6)+_0x53339a(0x140)),_0x451f24;}try{const _0x1bea8b=await this[_0x53339a(0x116)](_0x51ccdb),_0x2aa3af=_0x1bb21e/_0x1bea8b,_0x3301fd=_0x2aa3af*(0x1+this[_0x53339a(0x148)]/0x64);return console[_0x53339a(0x132)](_0x53339a(0xfa)+_0x1bb21e+'\x20'+_0x56b93e[_0x53339a(0x156)]()+_0x53339a(0x161)+_0x2aa3af[_0x53339a(0x101)](0x6)+_0x53339a(0x12b)+this[_0x53339a(0x148)]+_0x53339a(0x130)+_0x3301fd['toFixed'](0x6)+_0x53339a(0x159)+_0x1bea8b+')'),_0x3301fd;}catch(_0x5583f8){console[_0x53339a(0x110)](_0x53339a(0x123)+_0x1bb21e+'\x20'+_0x56b93e+_0x53339a(0x10e),_0x5583f8);const _0x4ad027=_0x1bb21e*(0x1+this[_0x53339a(0x148)]/0x64);return _0x4ad027;}}async['convertMultipleToUSDT'](_0x28f86c){const _0x3edd79=a58_0x2dadba;let _0x393c88=0x0;for(const {amount:_0x56d573,currency:_0x33048d}of _0x28f86c){const _0x7bc4d=await this[_0x3edd79(0x117)](_0x56d573,_0x33048d);_0x393c88+=_0x7bc4d;}return _0x393c88;}async[a58_0x2dadba(0x11b)](){const _0x5b30b5=a58_0x2dadba;try{const _0x2d233f=await database_1['default'][_0x5b30b5(0x118)][_0x5b30b5(0x14c)]({'select':{'currency':!![],'rate':!![]}}),_0xf3b462={'usdt':0x1};return _0x2d233f['forEach'](_0x5860a8=>{const _0x3e027d=_0x5b30b5;_0xf3b462[_0x5860a8[_0x3e027d(0xf8)]]=_0x5860a8['rate'];}),_0xf3b462;}catch(_0x30e03b){return console[_0x5b30b5(0x110)](_0x5b30b5(0x163),_0x30e03b),{'usdt':0x1};}}async['getRatesStatus'](){const _0x428650=a58_0x2dadba;try{const [_0x4e8dfb,_0x45088a,_0x3b1461]=await Promise[_0x428650(0x103)]([database_1[_0x428650(0xfe)]['currencyRate'][_0x428650(0xf3)](),database_1[_0x428650(0xfe)][_0x428650(0x118)][_0x428650(0x11d)]({'orderBy':{'updatedAt':_0x428650(0x112)},'select':{'updatedAt':!![]}}),database_1[_0x428650(0xfe)][_0x428650(0x118)][_0x428650(0x11d)]({'orderBy':{'updatedAt':_0x428650(0x107)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4e8dfb,'lastUpdated':_0x45088a?.['updatedAt']||null,'oldestRate':_0x3b1461?.[_0x428650(0x102)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x5b40e0){return console[_0x428650(0x110)](_0x428650(0x114),_0x5b40e0),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x428650(0x148)]};}}[a58_0x2dadba(0x15a)](){const _0x380be1=a58_0x2dadba;return this[_0x380be1(0x148)];}}exports[a58_0x2dadba(0x10c)]=CurrencyService,exports[a58_0x2dadba(0xef)]=new CurrencyService();