'use strict';const a36_0xdb7d8a=a36_0x395d;(function(_0x5daa52,_0xbe2990){const _0x540f80=a36_0x395d,_0x19b00f=_0x5daa52();while(!![]){try{const _0x99046b=-parseInt(_0x540f80(0x131))/0x1+-parseInt(_0x540f80(0x18d))/0x2+parseInt(_0x540f80(0x143))/0x3+-parseInt(_0x540f80(0x12e))/0x4+-parseInt(_0x540f80(0x124))/0x5*(-parseInt(_0x540f80(0x133))/0x6)+-parseInt(_0x540f80(0x138))/0x7*(-parseInt(_0x540f80(0x181))/0x8)+-parseInt(_0x540f80(0x156))/0x9*(-parseInt(_0x540f80(0x14e))/0xa);if(_0x99046b===_0xbe2990)break;else _0x19b00f['push'](_0x19b00f['shift']());}catch(_0x2a3208){_0x19b00f['push'](_0x19b00f['shift']());}}}(a36_0x4251,0x67293));var __importDefault=this&&this[a36_0xdb7d8a(0x14d)]||function(_0x8a7297){return _0x8a7297&&_0x8a7297['__esModule']?_0x8a7297:{'default':_0x8a7297};};Object[a36_0xdb7d8a(0x11b)](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;function a36_0x395d(_0x9cf78d,_0x337157){const _0x425134=a36_0x4251();return a36_0x395d=function(_0x395d38,_0x56642d){_0x395d38=_0x395d38-0x114;let _0x677954=_0x425134[_0x395d38];return _0x677954;},a36_0x395d(_0x9cf78d,_0x337157);}const database_1=__importDefault(require(a36_0xdb7d8a(0x14f)));class CurrencyService{constructor(){const _0x4da839=a36_0xdb7d8a;this[_0x4da839(0x188)]='https://api.coingecko.com/api/v3/simple/price',this[_0x4da839(0x17f)]=[_0x4da839(0x118),_0x4da839(0x14c),'ltc','bch',_0x4da839(0x16d),_0x4da839(0x15c),'xrp',_0x4da839(0x141),_0x4da839(0x117),_0x4da839(0x18c),_0x4da839(0x153),_0x4da839(0x16f),_0x4da839(0x152),_0x4da839(0x15d),_0x4da839(0x158),_0x4da839(0x12a),_0x4da839(0x173),_0x4da839(0x146),_0x4da839(0x184),_0x4da839(0x151),_0x4da839(0x13a),_0x4da839(0x176),_0x4da839(0x180),_0x4da839(0x136),'dkk',_0x4da839(0x115),_0x4da839(0x122),_0x4da839(0x172),'hkd',_0x4da839(0x11d),_0x4da839(0x195),_0x4da839(0x11c),_0x4da839(0x178),_0x4da839(0x123),_0x4da839(0x13c),'kwd',_0x4da839(0x140),'mmk',_0x4da839(0x139),_0x4da839(0x163),'ngn',_0x4da839(0x127),_0x4da839(0x179),_0x4da839(0x155),'pkr',_0x4da839(0x14a),_0x4da839(0x12c),_0x4da839(0x15b),'sek',_0x4da839(0x114),_0x4da839(0x187),_0x4da839(0x160),_0x4da839(0x125),'uah',_0x4da839(0x12d),_0x4da839(0x193),'zar',_0x4da839(0x16b),_0x4da839(0x135),'xau',_0x4da839(0x14b),_0x4da839(0x189)],this[_0x4da839(0x148)]=null,this[_0x4da839(0x162)]=0x3,this[_0x4da839(0x18b)]();}['startPeriodicUpdates'](){const _0x1a303=a36_0xdb7d8a;this['updateCurrencyRates']()[_0x1a303(0x17d)](_0x5cef9f=>{const _0x409cff=_0x1a303;console['error'](_0x409cff(0x177),_0x5cef9f);}),this['updateInterval']=setInterval(async()=>{const _0x18f454=_0x1a303;try{await this['updateCurrencyRates']();}catch(_0x4185d7){console[_0x18f454(0x166)](_0x18f454(0x15e),_0x4185d7);}},0x3c*0x3c*0x3e8),console[_0x1a303(0x169)](_0x1a303(0x130));}[a36_0xdb7d8a(0x142)](){const _0x4f8e9a=a36_0xdb7d8a;this[_0x4f8e9a(0x148)]&&(clearInterval(this[_0x4f8e9a(0x148)]),this['updateInterval']=null,console['log'](_0x4f8e9a(0x185)));}async[a36_0xdb7d8a(0x11e)](){const _0x4cc4f7=a36_0xdb7d8a;try{console[_0x4cc4f7(0x169)](_0x4cc4f7(0x12b));const _0x58f0b1=this['CURRENCIES'][_0x4cc4f7(0x128)](','),_0x57ff1b=this['COINGECKO_URL']+_0x4cc4f7(0x119)+_0x58f0b1,_0x332d42=await fetch(_0x57ff1b,{'headers':{'Accept':_0x4cc4f7(0x16e),'User-Agent':_0x4cc4f7(0x157)}});if(!_0x332d42['ok'])throw new Error(_0x4cc4f7(0x11f)+_0x332d42[_0x4cc4f7(0x149)]+'\x20'+_0x332d42[_0x4cc4f7(0x17a)]);const _0x27fc25=await _0x332d42[_0x4cc4f7(0x18e)]();if(!_0x27fc25[_0x4cc4f7(0x194)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x3caa1b=_0x27fc25[_0x4cc4f7(0x194)];console['log'](_0x4cc4f7(0x13e)+Object[_0x4cc4f7(0x170)](_0x3caa1b)[_0x4cc4f7(0x183)]+_0x4cc4f7(0x15f));const _0x31349a=Object[_0x4cc4f7(0x120)](_0x3caa1b)[_0x4cc4f7(0x161)](async([_0x318cee,_0x31e24d])=>{const _0x391ccf=_0x4cc4f7;try{await database_1[_0x391ccf(0x16a)][_0x391ccf(0x137)][_0x391ccf(0x190)]({'where':{'currency':_0x318cee[_0x391ccf(0x171)]()},'update':{'rate':_0x31e24d},'create':{'currency':_0x318cee['toLowerCase'](),'rate':_0x31e24d}});}catch(_0x3cb101){console[_0x391ccf(0x166)](_0x391ccf(0x11a)+_0x318cee+':',_0x3cb101);}});await Promise[_0x4cc4f7(0x159)](_0x31349a),console[_0x4cc4f7(0x169)](_0x4cc4f7(0x132));}catch(_0x1a80e8){console[_0x4cc4f7(0x166)](_0x4cc4f7(0x196),_0x1a80e8);throw _0x1a80e8;}}async[a36_0xdb7d8a(0x165)](_0x12decc){const _0x4740b7=a36_0xdb7d8a,_0x3133b8=_0x12decc[_0x4740b7(0x171)]();if(_0x3133b8===_0x4740b7(0x174))return 0x1;try{const _0x308357=await database_1[_0x4740b7(0x16a)][_0x4740b7(0x137)][_0x4740b7(0x192)]({'where':{'currency':_0x3133b8}});if(!_0x308357)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x12decc+',\x20using\x201\x20as\x20fallback'),0x1;return _0x308357[_0x4740b7(0x17c)];}catch(_0x41dbf1){return console[_0x4740b7(0x166)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x12decc+':',_0x41dbf1),0x1;}}async[a36_0xdb7d8a(0x168)](_0x3d492b,_0xe494ee){const _0x2c9fff=a36_0xdb7d8a,_0x21da6a=_0xe494ee['toLowerCase']();if(_0x21da6a===_0x2c9fff(0x174)){const _0x9708ad=_0x3d492b*(0x1+this[_0x2c9fff(0x162)]/0x64);return console[_0x2c9fff(0x169)](_0x2c9fff(0x147)+this[_0x2c9fff(0x162)]+'%\x20markup\x20to\x20'+_0x3d492b+_0x2c9fff(0x144)+_0x9708ad[_0x2c9fff(0x15a)](0x6)+_0x2c9fff(0x116)),_0x9708ad;}try{const _0x12131c=await this['getCurrencyRate'](_0x21da6a),_0x42bd33=_0x3d492b/_0x12131c,_0x5052b3=_0x42bd33*(0x1+this[_0x2c9fff(0x162)]/0x64);return console[_0x2c9fff(0x169)](_0x2c9fff(0x126)+_0x3d492b+'\x20'+_0xe494ee[_0x2c9fff(0x145)]()+_0x2c9fff(0x154)+_0x42bd33[_0x2c9fff(0x15a)](0x6)+_0x2c9fff(0x13f)+this[_0x2c9fff(0x162)]+_0x2c9fff(0x175)+_0x5052b3[_0x2c9fff(0x15a)](0x6)+_0x2c9fff(0x167)+_0x12131c+')'),_0x5052b3;}catch(_0xc24d7c){console[_0x2c9fff(0x166)]('Error\x20converting\x20'+_0x3d492b+'\x20'+_0xe494ee+'\x20to\x20USDT:',_0xc24d7c);const _0x31997e=_0x3d492b*(0x1+this[_0x2c9fff(0x162)]/0x64);return _0x31997e;}}async[a36_0xdb7d8a(0x17e)](_0x1d028e){const _0x27439e=a36_0xdb7d8a;let _0xa33b85=0x0;for(const {amount:_0x571890,currency:_0x3681b4}of _0x1d028e){const _0x4b278f=await this[_0x27439e(0x168)](_0x571890,_0x3681b4);_0xa33b85+=_0x4b278f;}return _0xa33b85;}async[a36_0xdb7d8a(0x121)](){const _0x193d8b=a36_0xdb7d8a;try{const _0x49530a=await database_1[_0x193d8b(0x16a)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x5670aa={'usdt':0x1};return _0x49530a[_0x193d8b(0x18a)](_0x35f5f9=>{const _0xb7eb1=_0x193d8b;_0x5670aa[_0x35f5f9[_0xb7eb1(0x150)]]=_0x35f5f9[_0xb7eb1(0x17c)];}),_0x5670aa;}catch(_0x25d74b){return console[_0x193d8b(0x166)](_0x193d8b(0x134),_0x25d74b),{'usdt':0x1};}}async[a36_0xdb7d8a(0x13d)](){const _0x59cbf8=a36_0xdb7d8a;try{const [_0x56d247,_0x104bfa,_0x30422c]=await Promise[_0x59cbf8(0x129)]([database_1[_0x59cbf8(0x16a)][_0x59cbf8(0x137)][_0x59cbf8(0x18f)](),database_1['default'][_0x59cbf8(0x137)][_0x59cbf8(0x17b)]({'orderBy':{'updatedAt':_0x59cbf8(0x13b)},'select':{'updatedAt':!![]}}),database_1[_0x59cbf8(0x16a)][_0x59cbf8(0x137)][_0x59cbf8(0x17b)]({'orderBy':{'updatedAt':_0x59cbf8(0x16c)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x56d247,'lastUpdated':_0x104bfa?.[_0x59cbf8(0x12f)]||null,'oldestRate':_0x30422c?.['updatedAt']||null,'markupPercentage':this[_0x59cbf8(0x162)]};}catch(_0x4abf9d){return console[_0x59cbf8(0x166)](_0x59cbf8(0x164),_0x4abf9d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x59cbf8(0x162)]};}}[a36_0xdb7d8a(0x191)](){const _0x234921=a36_0xdb7d8a;return this[_0x234921(0x162)];}}exports[a36_0xdb7d8a(0x186)]=CurrencyService,exports[a36_0xdb7d8a(0x182)]=new CurrencyService();function a36_0x4251(){const _0x367057=['updateCurrencyRates','CoinGecko\x20API\x20error:\x20','entries','getAllRates','gbp','jpy','3571505AAClyL','twd','üí±\x20Converted\x20','nok','join','all','bdt','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','rub','vef','1106236abSpZt','updatedAt','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','774497BBeqOt','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','6ulNKbx','Error\x20getting\x20all\x20rates:','xag','czk','currencyRate','47698mmZAyI','mxn','chf','desc','krw','getRatesStatus','üìä\x20Received\x20rates\x20for\x20','\x20USDT,\x20with\x20','lkr','xlm','stopPeriodicUpdates','1370634JbCSHx','\x20USDT\x20=\x20','toUpperCase','bmd','üí±\x20Applied\x20','updateInterval','status','pln','bits','eth','__importDefault','653970ZCqDuf','../config/database','currency','cad','aed','yfi','\x20to\x20','php','135jBIzCw','TesSoft\x20Payment\x20System/1.0','aud','allSettled','toFixed','sar','eos','ars','Periodic\x20currency\x20rates\x20update\x20failed:','\x20currencies','try','map','MARKUP_PERCENTAGE','myr','Error\x20getting\x20rates\x20status:','getCurrencyRate','error','\x20USDT\x20(rate:\x20','convertToUSDT','log','default','xdr','asc','bnb','application/json','usd','keys','toLowerCase','gel','bhd','usdt','%\x20markup\x20=\x20','clp','Initial\x20currency\x20rates\x20update\x20failed:','inr','nzd','statusText','findFirst','rate','catch','convertMultipleToUSDT','CURRENCIES','cny','16IkNpZk','currencyService','length','brl','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','CurrencyService','thb','COINGECKO_URL','sats','forEach','startPeriodicUpdates','dot','1384318GSvOLB','json','count','upsert','getMarkupPercentage','findUnique','vnd','tether','idr','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','sgd','eur','\x20USDT','link','btc','?ids=tether&vs_currencies=','Failed\x20to\x20update\x20rate\x20for\x20','defineProperty','ils','huf'];a36_0x4251=function(){return _0x367057;};return a36_0x4251();}