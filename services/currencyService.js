'use strict';const a55_0x2ad9ea=a55_0x42f5;(function(_0x136773,_0x2da460){const _0x74efee=a55_0x42f5,_0x3e4c0a=_0x136773();while(!![]){try{const _0x51939c=parseInt(_0x74efee(0x1a2))/0x1*(-parseInt(_0x74efee(0x1a9))/0x2)+parseInt(_0x74efee(0x1cd))/0x3*(parseInt(_0x74efee(0x1b5))/0x4)+-parseInt(_0x74efee(0x208))/0x5*(parseInt(_0x74efee(0x1cc))/0x6)+parseInt(_0x74efee(0x206))/0x7*(parseInt(_0x74efee(0x1ed))/0x8)+parseInt(_0x74efee(0x1c9))/0x9+parseInt(_0x74efee(0x1fa))/0xa*(parseInt(_0x74efee(0x1e7))/0xb)+-parseInt(_0x74efee(0x1af))/0xc;if(_0x51939c===_0x2da460)break;else _0x3e4c0a['push'](_0x3e4c0a['shift']());}catch(_0x2666cf){_0x3e4c0a['push'](_0x3e4c0a['shift']());}}}(a55_0x4777,0x73789));function a55_0x4777(){const _0x1efd23=['czk','getAllRates','ngn','rate','status','convertToUSDT','krw','currency','gel','4783229xrnRRI','__esModule','keys','myr','gbp','uah','1653584LCeZyM','findFirst','\x20to\x20USDT:','default','currencyService','entries','xau','nok','php','updatedAt','upsert','sats','getRatesStatus','20UiGUZY','ils','clp','pln','usd','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','forEach','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','findMany','\x20to\x20','ðŸ“Š\x20Received\x20rates\x20for\x20','%\x20markup\x20to\x20','7ZAnqYY','zar','388345erNeLw','rub','ars','convertMultipleToUSDT','COINGECKO_URL','bhd','usdt','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','Periodic\x20currency\x20rates\x20update\x20failed:','bits','\x20USDT','desc','CURRENCIES','mmk','Error\x20getting\x20rate\x20for\x20currency\x20','length','chf','brl','bmd','Error\x20converting\x20','hkd','link','__importDefault','\x20USDT\x20(rate:\x20','vef','vnd','dkk','Initial\x20currency\x20rates\x20update\x20failed:','564310PPOCDX','application/json','dot','ðŸ’±\x20Converted\x20','\x20currencies',',\x20using\x201\x20as\x20fallback','asc','2gxXmtK','twd','join','error','sar','log','5865192ZhrgkH','try','currencyRate','jpy','Error\x20getting\x20rates\x20status:','xrp','42216UxcfRE','bch','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','toFixed','updateInterval','catch','Error\x20getting\x20all\x20rates:','getMarkupPercentage','sek','defineProperty','startPeriodicUpdates','cny','kwd','stopPeriodicUpdates','xdr','ltc','../config/database','tether','aed','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','2310525azRADQ','toLowerCase','map','12zZWZAH','99SBKivW','updateCurrencyRates','aud','btc','CurrencyService','?ids=tether&vs_currencies=','thb','nzd','lkr','toUpperCase','\x20USDT,\x20with\x20','inr','getCurrencyRate','MARKUP_PERCENTAGE','cad','Payment\x20System/1.0','huf'];a55_0x4777=function(){return _0x1efd23;};return a55_0x4777();}var __importDefault=this&&this[a55_0x2ad9ea(0x21e)]||function(_0x31c2d3){return _0x31c2d3&&_0x31c2d3['__esModule']?_0x31c2d3:{'default':_0x31c2d3};};function a55_0x42f5(_0x48d65e,_0x44baa7){_0x48d65e=_0x48d65e-0x19e;const _0x4777eb=a55_0x4777();let _0x42f55f=_0x4777eb[_0x48d65e];return _0x42f55f;}Object[a55_0x2ad9ea(0x1be)](exports,a55_0x2ad9ea(0x1e8),{'value':!![]}),exports[a55_0x2ad9ea(0x1f1)]=exports[a55_0x2ad9ea(0x1d1)]=void 0x0;const database_1=__importDefault(require(a55_0x2ad9ea(0x1c5)));class CurrencyService{constructor(){const _0x35d35a=a55_0x2ad9ea;this[_0x35d35a(0x20c)]='https://api.coingecko.com/api/v3/simple/price',this[_0x35d35a(0x214)]=[_0x35d35a(0x1d0),'eth',_0x35d35a(0x1c4),_0x35d35a(0x1b6),'bnb','eos',_0x35d35a(0x1b4),'xlm',_0x35d35a(0x21d),_0x35d35a(0x1a4),'yfi',_0x35d35a(0x1fe),_0x35d35a(0x1c7),_0x35d35a(0x20a),_0x35d35a(0x1cf),'bdt',_0x35d35a(0x20d),_0x35d35a(0x21a),_0x35d35a(0x219),_0x35d35a(0x1db),_0x35d35a(0x218),_0x35d35a(0x1fc),_0x35d35a(0x1c0),_0x35d35a(0x1de),_0x35d35a(0x1a0),'eur',_0x35d35a(0x1eb),_0x35d35a(0x1e6),_0x35d35a(0x21c),_0x35d35a(0x1dd),'idr',_0x35d35a(0x1fb),_0x35d35a(0x1d8),_0x35d35a(0x1b2),_0x35d35a(0x1e4),_0x35d35a(0x1c1),_0x35d35a(0x1d5),_0x35d35a(0x215),'mxn',_0x35d35a(0x1ea),_0x35d35a(0x1e0),_0x35d35a(0x1f4),_0x35d35a(0x1d4),_0x35d35a(0x1f5),'pkr',_0x35d35a(0x1fd),_0x35d35a(0x209),_0x35d35a(0x1ad),_0x35d35a(0x1bd),'sgd',_0x35d35a(0x1d3),_0x35d35a(0x1b0),_0x35d35a(0x1aa),_0x35d35a(0x1ec),_0x35d35a(0x19e),_0x35d35a(0x19f),_0x35d35a(0x207),_0x35d35a(0x1c3),'xag',_0x35d35a(0x1f3),_0x35d35a(0x211),_0x35d35a(0x1f8)],this['updateInterval']=null,this[_0x35d35a(0x1da)]=-0x3,this[_0x35d35a(0x1bf)]();}[a55_0x2ad9ea(0x1bf)](){const _0x4af941=a55_0x2ad9ea;this[_0x4af941(0x1ce)]()[_0x4af941(0x1ba)](_0x444972=>{const _0x287ab7=_0x4af941;console[_0x287ab7(0x1ac)](_0x287ab7(0x1a1),_0x444972);}),this['updateInterval']=setInterval(async()=>{const _0x222fbe=_0x4af941;try{await this[_0x222fbe(0x1ce)]();}catch(_0x4f3313){console[_0x222fbe(0x1ac)](_0x222fbe(0x210),_0x4f3313);}},0x3c*0x3c*0x3e8),console[_0x4af941(0x1ae)](_0x4af941(0x1c8));}[a55_0x2ad9ea(0x1c2)](){const _0x957576=a55_0x2ad9ea;this[_0x957576(0x1b9)]&&(clearInterval(this[_0x957576(0x1b9)]),this[_0x957576(0x1b9)]=null,console[_0x957576(0x1ae)](_0x957576(0x20f)));}async[a55_0x2ad9ea(0x1ce)](){const _0xa6184=a55_0x2ad9ea;try{console[_0xa6184(0x1ae)](_0xa6184(0x1b7));const _0x4b2261=this['CURRENCIES'][_0xa6184(0x1ab)](','),_0x5247a2=this[_0xa6184(0x20c)]+_0xa6184(0x1d2)+_0x4b2261,_0x59f5ed=await fetch(_0x5247a2,{'headers':{'Accept':_0xa6184(0x1a3),'User-Agent':_0xa6184(0x1dc)}});if(!_0x59f5ed['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x59f5ed[_0xa6184(0x1e2)]+'\x20'+_0x59f5ed['statusText']);const _0xbacf2b=await _0x59f5ed['json']();if(!_0xbacf2b[_0xa6184(0x1c6)])throw new Error(_0xa6184(0x201));const _0x2273ab=_0xbacf2b[_0xa6184(0x1c6)];console['log'](_0xa6184(0x204)+Object[_0xa6184(0x1e9)](_0x2273ab)[_0xa6184(0x217)]+_0xa6184(0x1a6));const _0x3a5cdc=Object[_0xa6184(0x1f2)](_0x2273ab)[_0xa6184(0x1cb)](async([_0x5bc697,_0x4d259e])=>{const _0x5e32a3=_0xa6184;try{await database_1[_0x5e32a3(0x1f0)][_0x5e32a3(0x1b1)][_0x5e32a3(0x1f7)]({'where':{'currency':_0x5bc697[_0x5e32a3(0x1ca)]()},'update':{'rate':_0x4d259e},'create':{'currency':_0x5bc697[_0x5e32a3(0x1ca)](),'rate':_0x4d259e}});}catch(_0x5b94b1){console[_0x5e32a3(0x1ac)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x5bc697+':',_0x5b94b1);}});await Promise['allSettled'](_0x3a5cdc),console['log']('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x58142a){console['error'](_0xa6184(0x1ff),_0x58142a);throw _0x58142a;}}async[a55_0x2ad9ea(0x1d9)](_0x5b848b){const _0x557977=a55_0x2ad9ea,_0xfc798d=_0x5b848b[_0x557977(0x1ca)]();if(_0xfc798d===_0x557977(0x20e))return 0x1;try{const _0x1d07c1=await database_1[_0x557977(0x1f0)][_0x557977(0x1b1)]['findUnique']({'where':{'currency':_0xfc798d}});if(!_0x1d07c1)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x5b848b+_0x557977(0x1a7)),0x1;return _0x1d07c1[_0x557977(0x1e1)];}catch(_0x55bb1b){return console['error'](_0x557977(0x216)+_0x5b848b+':',_0x55bb1b),0x1;}}async[a55_0x2ad9ea(0x1e3)](_0x4c59b7,_0x24cabb){const _0x29a053=a55_0x2ad9ea,_0x72f5e0=_0x24cabb['toLowerCase']();if(_0x72f5e0===_0x29a053(0x20e)){const _0x5e115a=_0x4c59b7*(0x1+this[_0x29a053(0x1da)]/0x64);return console[_0x29a053(0x1ae)]('ðŸ’±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x29a053(0x205)+_0x4c59b7+'\x20USDT\x20=\x20'+_0x5e115a[_0x29a053(0x1b8)](0x6)+_0x29a053(0x212)),_0x5e115a;}try{const _0xd17a77=await this['getCurrencyRate'](_0x72f5e0),_0x2fc75d=_0x4c59b7/_0xd17a77,_0x1fee76=_0x2fc75d*(0x1+this[_0x29a053(0x1da)]/0x64);return console[_0x29a053(0x1ae)](_0x29a053(0x1a5)+_0x4c59b7+'\x20'+_0x24cabb[_0x29a053(0x1d6)]()+_0x29a053(0x203)+_0x2fc75d[_0x29a053(0x1b8)](0x6)+_0x29a053(0x1d7)+this[_0x29a053(0x1da)]+'%\x20markup\x20=\x20'+_0x1fee76['toFixed'](0x6)+_0x29a053(0x21f)+_0xd17a77+')'),_0x1fee76;}catch(_0x43a5c9){console['error'](_0x29a053(0x21b)+_0x4c59b7+'\x20'+_0x24cabb+_0x29a053(0x1ef),_0x43a5c9);const _0x1b743e=_0x4c59b7*(0x1+this[_0x29a053(0x1da)]/0x64);return _0x1b743e;}}async[a55_0x2ad9ea(0x20b)](_0x3de2d4){const _0x4d5a75=a55_0x2ad9ea;let _0x96caec=0x0;for(const {amount:_0x4685e7,currency:_0x168633}of _0x3de2d4){const _0xb69ee1=await this[_0x4d5a75(0x1e3)](_0x4685e7,_0x168633);_0x96caec+=_0xb69ee1;}return _0x96caec;}async[a55_0x2ad9ea(0x1df)](){const _0x5efc52=a55_0x2ad9ea;try{const _0x6a2bf1=await database_1[_0x5efc52(0x1f0)][_0x5efc52(0x1b1)][_0x5efc52(0x202)]({'select':{'currency':!![],'rate':!![]}}),_0x5bfe45={'usdt':0x1};return _0x6a2bf1[_0x5efc52(0x200)](_0x3ea2b5=>{const _0x131839=_0x5efc52;_0x5bfe45[_0x3ea2b5[_0x131839(0x1e5)]]=_0x3ea2b5[_0x131839(0x1e1)];}),_0x5bfe45;}catch(_0x3b1543){return console[_0x5efc52(0x1ac)](_0x5efc52(0x1bb),_0x3b1543),{'usdt':0x1};}}async[a55_0x2ad9ea(0x1f9)](){const _0x51125c=a55_0x2ad9ea;try{const [_0x207440,_0x42e90a,_0x564b24]=await Promise['all']([database_1['default'][_0x51125c(0x1b1)]['count'](),database_1[_0x51125c(0x1f0)]['currencyRate'][_0x51125c(0x1ee)]({'orderBy':{'updatedAt':_0x51125c(0x213)},'select':{'updatedAt':!![]}}),database_1[_0x51125c(0x1f0)]['currencyRate'][_0x51125c(0x1ee)]({'orderBy':{'updatedAt':_0x51125c(0x1a8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x207440,'lastUpdated':_0x42e90a?.[_0x51125c(0x1f6)]||null,'oldestRate':_0x564b24?.[_0x51125c(0x1f6)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x1291e0){return console[_0x51125c(0x1ac)](_0x51125c(0x1b3),_0x1291e0),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x51125c(0x1da)]};}}[a55_0x2ad9ea(0x1bc)](){return this['MARKUP_PERCENTAGE'];}}exports[a55_0x2ad9ea(0x1d1)]=CurrencyService,exports[a55_0x2ad9ea(0x1f1)]=new CurrencyService();