'use strict';const a36_0x36f784=a36_0x3204;(function(_0x380500,_0x6257d9){const _0x479c58=a36_0x3204,_0x42fbdb=_0x380500();while(!![]){try{const _0x567b4f=-parseInt(_0x479c58(0x102))/0x1*(-parseInt(_0x479c58(0xb3))/0x2)+-parseInt(_0x479c58(0xf4))/0x3+parseInt(_0x479c58(0x107))/0x4+parseInt(_0x479c58(0xeb))/0x5+parseInt(_0x479c58(0x109))/0x6+parseInt(_0x479c58(0xb4))/0x7+parseInt(_0x479c58(0x113))/0x8*(-parseInt(_0x479c58(0xc8))/0x9);if(_0x567b4f===_0x6257d9)break;else _0x42fbdb['push'](_0x42fbdb['shift']());}catch(_0x43aabf){_0x42fbdb['push'](_0x42fbdb['shift']());}}}(a36_0x3278,0x89ec6));var __importDefault=this&&this[a36_0x36f784(0x11d)]||function(_0x376f64){return _0x376f64&&_0x376f64['__esModule']?_0x376f64:{'default':_0x376f64};};Object['defineProperty'](exports,a36_0x36f784(0x112),{'value':!![]}),exports[a36_0x36f784(0xa9)]=exports[a36_0x36f784(0xac)]=void 0x0;function a36_0x3204(_0x42a478,_0x2a9563){const _0x327821=a36_0x3278();return a36_0x3204=function(_0x32040b,_0x5e8952){_0x32040b=_0x32040b-0xa6;let _0x4bc3c5=_0x327821[_0x32040b];return _0x4bc3c5;},a36_0x3204(_0x42a478,_0x2a9563);}const database_1=__importDefault(require(a36_0x36f784(0x104)));class CurrencyService{constructor(){const _0x5b5459=a36_0x36f784;this[_0x5b5459(0x11e)]='https://api.coingecko.com/api/v3/simple/price',this[_0x5b5459(0x10a)]=[_0x5b5459(0xa7),_0x5b5459(0xbc),_0x5b5459(0xef),_0x5b5459(0xcf),_0x5b5459(0xba),_0x5b5459(0xa8),_0x5b5459(0x103),_0x5b5459(0xcc),_0x5b5459(0xb6),_0x5b5459(0xf5),_0x5b5459(0xdf),_0x5b5459(0xf8),_0x5b5459(0xdc),_0x5b5459(0xe7),_0x5b5459(0xf1),'bdt','bhd','bmd',_0x5b5459(0x116),_0x5b5459(0xd6),_0x5b5459(0x11b),_0x5b5459(0xc2),_0x5b5459(0xd8),_0x5b5459(0xd7),_0x5b5459(0xc5),'eur',_0x5b5459(0xfb),'gel',_0x5b5459(0xfa),_0x5b5459(0xf6),'idr',_0x5b5459(0x11c),_0x5b5459(0xc3),_0x5b5459(0xa6),'krw',_0x5b5459(0xb5),_0x5b5459(0x11f),'mmk',_0x5b5459(0x117),'myr',_0x5b5459(0xb1),_0x5b5459(0xcb),'nzd',_0x5b5459(0xc9),_0x5b5459(0xe8),_0x5b5459(0xe2),'rub','sar','sek',_0x5b5459(0x111),_0x5b5459(0xe1),_0x5b5459(0xe9),_0x5b5459(0xe6),'uah','vef',_0x5b5459(0x106),'zar',_0x5b5459(0xe0),'xag',_0x5b5459(0x11a),'bits',_0x5b5459(0xde)],this['updateInterval']=null,this[_0x5b5459(0xc4)]=0x3,this[_0x5b5459(0xf2)]();}[a36_0x36f784(0xf2)](){const _0x532136=a36_0x36f784;this[_0x532136(0x100)]()[_0x532136(0xed)](_0x26670d=>{const _0x7d8a81=_0x532136;console[_0x7d8a81(0xaf)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x26670d);}),this[_0x532136(0xcd)]=setInterval(async()=>{const _0x3b1f74=_0x532136;try{await this[_0x3b1f74(0x100)]();}catch(_0x5a2610){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x5a2610);}},0x3c*0x3c*0x3e8),console[_0x532136(0xbb)](_0x532136(0xd5));}[a36_0x36f784(0xfe)](){const _0x3ea921=a36_0x36f784;this[_0x3ea921(0xcd)]&&(clearInterval(this[_0x3ea921(0xcd)]),this[_0x3ea921(0xcd)]=null,console['log'](_0x3ea921(0xb0)));}async['updateCurrencyRates'](){const _0x51f2de=a36_0x36f784;try{console['log'](_0x51f2de(0xfc));const _0x5937e2=this[_0x51f2de(0x10a)][_0x51f2de(0xd0)](','),_0x39711b=this[_0x51f2de(0x11e)]+_0x51f2de(0xd2)+_0x5937e2,_0x4be4c2=await fetch(_0x39711b,{'headers':{'Accept':_0x51f2de(0xe5),'User-Agent':_0x51f2de(0xb7)}});if(!_0x4be4c2['ok'])throw new Error(_0x51f2de(0xb9)+_0x4be4c2[_0x51f2de(0x10d)]+'\x20'+_0x4be4c2[_0x51f2de(0xdd)]);const _0x1669e5=await _0x4be4c2[_0x51f2de(0xff)]();if(!_0x1669e5[_0x51f2de(0x115)])throw new Error(_0x51f2de(0x10c));const _0x333bb7=_0x1669e5[_0x51f2de(0x115)];console[_0x51f2de(0xbb)](_0x51f2de(0x10b)+Object[_0x51f2de(0x10e)](_0x333bb7)['length']+_0x51f2de(0xf0));const _0x244532=Object[_0x51f2de(0x114)](_0x333bb7)[_0x51f2de(0xee)](async([_0x4c51fa,_0xf7cf6])=>{const _0x311448=_0x51f2de;try{await database_1[_0x311448(0xda)][_0x311448(0xe3)][_0x311448(0xc7)]({'where':{'currency':_0x4c51fa['toLowerCase']()},'update':{'rate':_0xf7cf6},'create':{'currency':_0x4c51fa[_0x311448(0xae)](),'rate':_0xf7cf6}});}catch(_0x4433dd){console[_0x311448(0xaf)](_0x311448(0xfd)+_0x4c51fa+':',_0x4433dd);}});await Promise[_0x51f2de(0x105)](_0x244532),console[_0x51f2de(0xbb)](_0x51f2de(0x119));}catch(_0x18a59f){console[_0x51f2de(0xaf)](_0x51f2de(0x110),_0x18a59f);throw _0x18a59f;}}async[a36_0x36f784(0xbd)](_0x1a40be){const _0x1ede01=a36_0x36f784,_0x281251=_0x1a40be[_0x1ede01(0xae)]();if(_0x281251===_0x1ede01(0xf7))return 0x1;try{const _0x5b53bc=await database_1[_0x1ede01(0xda)][_0x1ede01(0xe3)][_0x1ede01(0xd9)]({'where':{'currency':_0x281251}});if(!_0x5b53bc)return console['warn']('No\x20rate\x20found\x20for\x20currency:\x20'+_0x1a40be+',\x20using\x201\x20as\x20fallback'),0x1;return _0x5b53bc[_0x1ede01(0xd3)];}catch(_0x287c84){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1a40be+':',_0x287c84),0x1;}}async['convertToUSDT'](_0x416c1a,_0x35da5e){const _0x146fe7=a36_0x36f784,_0x3141b0=_0x35da5e[_0x146fe7(0xae)]();if(_0x3141b0===_0x146fe7(0xf7)){const _0x620979=_0x416c1a*(0x1+this[_0x146fe7(0xc4)]/0x64);return console[_0x146fe7(0xbb)](_0x146fe7(0xca)+this[_0x146fe7(0xc4)]+_0x146fe7(0xce)+_0x416c1a+_0x146fe7(0xb8)+_0x620979['toFixed'](0x6)+_0x146fe7(0xdb)),_0x620979;}try{const _0x38be50=await this[_0x146fe7(0xbd)](_0x3141b0),_0x1e96f5=_0x416c1a/_0x38be50,_0x585baa=_0x1e96f5*(0x1+this[_0x146fe7(0xc4)]/0x64);return console[_0x146fe7(0xbb)]('üí±\x20Converted\x20'+_0x416c1a+'\x20'+_0x35da5e[_0x146fe7(0xec)]()+_0x146fe7(0xf9)+_0x1e96f5[_0x146fe7(0xc1)](0x6)+_0x146fe7(0x10f)+this['MARKUP_PERCENTAGE']+_0x146fe7(0xd4)+_0x585baa[_0x146fe7(0xc1)](0x6)+_0x146fe7(0xad)+_0x38be50+')'),_0x585baa;}catch(_0x3afbce){console['error'](_0x146fe7(0xab)+_0x416c1a+'\x20'+_0x35da5e+_0x146fe7(0xaa),_0x3afbce);const _0x3058c3=_0x416c1a*(0x1+this[_0x146fe7(0xc4)]/0x64);return _0x3058c3;}}async[a36_0x36f784(0x101)](_0x480011){let _0x2682d2=0x0;for(const {amount:_0x5a0801,currency:_0x4cbe5e}of _0x480011){const _0x31ee36=await this['convertToUSDT'](_0x5a0801,_0x4cbe5e);_0x2682d2+=_0x31ee36;}return _0x2682d2;}async['getAllRates'](){const _0x1543c7=a36_0x36f784;try{const _0xd618ed=await database_1[_0x1543c7(0xda)][_0x1543c7(0xe3)][_0x1543c7(0x108)]({'select':{'currency':!![],'rate':!![]}}),_0x1ef28c={'usdt':0x1};return _0xd618ed[_0x1543c7(0xbf)](_0x4d8986=>{const _0x1ed66f=_0x1543c7;_0x1ef28c[_0x4d8986[_0x1ed66f(0xb2)]]=_0x4d8986[_0x1ed66f(0xd3)];}),_0x1ef28c;}catch(_0x313ef0){return console[_0x1543c7(0xaf)](_0x1543c7(0xbe),_0x313ef0),{'usdt':0x1};}}async[a36_0x36f784(0xe4)](){const _0x5626ce=a36_0x36f784;try{const [_0x1a7e8c,_0x21732e,_0x10f290]=await Promise['all']([database_1[_0x5626ce(0xda)]['currencyRate']['count'](),database_1[_0x5626ce(0xda)][_0x5626ce(0xe3)][_0x5626ce(0xd1)]({'orderBy':{'updatedAt':_0x5626ce(0x118)},'select':{'updatedAt':!![]}}),database_1['default'][_0x5626ce(0xe3)][_0x5626ce(0xd1)]({'orderBy':{'updatedAt':_0x5626ce(0xc6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1a7e8c,'lastUpdated':_0x21732e?.[_0x5626ce(0xf3)]||null,'oldestRate':_0x10f290?.[_0x5626ce(0xf3)]||null,'markupPercentage':this[_0x5626ce(0xc4)]};}catch(_0x586f82){return console[_0x5626ce(0xaf)](_0x5626ce(0xea),_0x586f82),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5626ce(0xc4)]};}}[a36_0x36f784(0xc0)](){const _0x340f4f=a36_0x36f784;return this[_0x340f4f(0xc4)];}}function a36_0x3278(){const _0x3bca45=['%\x20markup\x20=\x20','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','cad','czk','cny','findUnique','default','\x20USDT','aed','statusText','sats','yfi','xdr','thb','pln','currencyRate','getRatesStatus','application/json','twd','ars','pkr','try','Error\x20getting\x20rates\x20status:','2411385sojxyp','toUpperCase','catch','map','ltc','\x20currencies','aud','startPeriodicUpdates','updatedAt','358677mWPMWK','dot','huf','usdt','usd','\x20to\x20','hkd','gbp','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Failed\x20to\x20update\x20rate\x20for\x20','stopPeriodicUpdates','json','updateCurrencyRates','convertMultipleToUSDT','6qfBjtV','xrp','../config/database','allSettled','vnd','311860abNdlz','findMany','6142962MgfvVw','CURRENCIES','üìä\x20Received\x20rates\x20for\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','status','keys','\x20USDT,\x20with\x20','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','sgd','__esModule','26472JVOnCP','entries','tether','brl','mxn','desc','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','xau','chf','ils','__importDefault','COINGECKO_URL','lkr','jpy','btc','eos','currencyService','\x20to\x20USDT:','Error\x20converting\x20','CurrencyService','\x20USDT\x20(rate:\x20','toLowerCase','error','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','ngn','currency','432hETdvG','6919969PnBPiL','kwd','link','TesSoft\x20Payment\x20System/1.0','\x20USDT\x20=\x20','CoinGecko\x20API\x20error:\x20','bnb','log','eth','getCurrencyRate','Error\x20getting\x20all\x20rates:','forEach','getMarkupPercentage','toFixed','clp','inr','MARKUP_PERCENTAGE','dkk','asc','upsert','5139lLEBtW','php','üí±\x20Applied\x20','nok','xlm','updateInterval','%\x20markup\x20to\x20','bch','join','findFirst','?ids=tether&vs_currencies=','rate'];a36_0x3278=function(){return _0x3bca45;};return a36_0x3278();}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();