'use strict';const a51_0x54bdb2=a51_0xac83;(function(_0x4107cf,_0x34b120){const _0x39c595=a51_0xac83,_0x1c0b09=_0x4107cf();while(!![]){try{const _0x4b7985=-parseInt(_0x39c595(0xd1))/0x1+-parseInt(_0x39c595(0xa2))/0x2+parseInt(_0x39c595(0x95))/0x3*(parseInt(_0x39c595(0xde))/0x4)+-parseInt(_0x39c595(0xb5))/0x5+-parseInt(_0x39c595(0x96))/0x6+-parseInt(_0x39c595(0x7d))/0x7+parseInt(_0x39c595(0xdd))/0x8;if(_0x4b7985===_0x34b120)break;else _0x1c0b09['push'](_0x1c0b09['shift']());}catch(_0x18d371){_0x1c0b09['push'](_0x1c0b09['shift']());}}}(a51_0x12d4,0x7221d));function a51_0x12d4(){const _0x18cd1f=['âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','desc','__esModule','MARKUP_PERCENTAGE',',\x20using\x201\x20as\x20fallback','currencyService','huf','ils','5424769dqGMhp','keys','Error\x20getting\x20rate\x20for\x20currency\x20','rate','status','myr','defineProperty','xag','Error\x20converting\x20','default','chf','\x20USDT\x20=\x20','zar','\x20USDT','nzd','uah','log','getCurrencyRate','rub','usdt','aed','updateInterval','ngn','eos','3DqPOxN','1878006Qxjigl','findFirst','tether','forEach','vef','\x20to\x20','convertMultipleToUSDT','kwd','\x20USDT,\x20with\x20','findMany','Periodic\x20currency\x20rates\x20update\x20failed:','yfi','1253152nvGRbJ','toUpperCase','bnb','lkr','upsert','idr','bmd','toFixed','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','jpy','Error\x20getting\x20all\x20rates:','cad','pln','CoinGecko\x20API\x20error:\x20','bhd','updatedAt','bits','Initial\x20currency\x20rates\x20update\x20failed:','try','3086065cbSUrJ','getAllRates','CurrencyService','gel','currency','Payment\x20System/1.0','CURRENCIES','../config/database','dot','ðŸ“Š\x20Received\x20rates\x20for\x20','czk','vnd','ltc','aud','error','ðŸ’±\x20Applied\x20','json','count','No\x20rate\x20found\x20for\x20currency:\x20','cny','inr','eur','sar','map','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','%\x20markup\x20to\x20','âœ…\x20Currency\x20rates\x20updated\x20successfully','clp','836418IgcQsn','convertToUSDT','brl','%\x20markup\x20=\x20','\x20to\x20USDT:','thb','currencyRate','findUnique','twd','mxn','toLowerCase','php','23525912fuaUtC','2779684YRgXju','mmk','eth','usd','krw','updateCurrencyRates'];a51_0x12d4=function(){return _0x18cd1f;};return a51_0x12d4();}var __importDefault=this&&this['__importDefault']||function(_0x44ba98){const _0x418621=a51_0xac83;return _0x44ba98&&_0x44ba98[_0x418621(0x77)]?_0x44ba98:{'default':_0x44ba98};};Object[a51_0x54bdb2(0x83)](exports,'__esModule',{'value':!![]}),exports[a51_0x54bdb2(0x7a)]=exports[a51_0x54bdb2(0xb7)]=void 0x0;const database_1=__importDefault(require(a51_0x54bdb2(0xbc)));function a51_0xac83(_0xcd0780,_0xda1ef3){_0xcd0780=_0xcd0780-0x75;const _0x12d415=a51_0x12d4();let _0xac830c=_0x12d415[_0xcd0780];return _0xac830c;}class CurrencyService{constructor(){const _0x3fffd0=a51_0x54bdb2;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this[_0x3fffd0(0xbb)]=['btc',_0x3fffd0(0xe0),_0x3fffd0(0xc1),'bch',_0x3fffd0(0xa4),_0x3fffd0(0x94),'xrp','xlm','link',_0x3fffd0(0xbd),_0x3fffd0(0xa1),_0x3fffd0(0xe1),_0x3fffd0(0x91),'ars',_0x3fffd0(0xc2),'bdt',_0x3fffd0(0xb0),_0x3fffd0(0xa8),_0x3fffd0(0xd3),_0x3fffd0(0xad),_0x3fffd0(0x87),_0x3fffd0(0xd0),_0x3fffd0(0xc8),_0x3fffd0(0xbf),'dkk',_0x3fffd0(0xca),'gbp',_0x3fffd0(0xb8),'hkd',_0x3fffd0(0x7b),_0x3fffd0(0xa7),_0x3fffd0(0x7c),_0x3fffd0(0xc9),_0x3fffd0(0xab),_0x3fffd0(0xe2),_0x3fffd0(0x9d),_0x3fffd0(0xa5),_0x3fffd0(0xdf),_0x3fffd0(0xda),_0x3fffd0(0x82),_0x3fffd0(0x93),'nok',_0x3fffd0(0x8b),_0x3fffd0(0xdc),'pkr',_0x3fffd0(0xae),_0x3fffd0(0x8f),_0x3fffd0(0xcb),'sek','sgd',_0x3fffd0(0xd6),_0x3fffd0(0xb4),_0x3fffd0(0xd9),_0x3fffd0(0x8c),_0x3fffd0(0x9a),_0x3fffd0(0xc0),_0x3fffd0(0x89),'xdr',_0x3fffd0(0x84),'xau',_0x3fffd0(0xb2),'sats'],this[_0x3fffd0(0x92)]=null,this[_0x3fffd0(0x78)]=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0xe2a9ee=a51_0x54bdb2;this[_0xe2a9ee(0xe3)]()['catch'](_0x533ab6=>{const _0x5d236b=_0xe2a9ee;console[_0x5d236b(0xc3)](_0x5d236b(0xb3),_0x533ab6);}),this[_0xe2a9ee(0x92)]=setInterval(async()=>{const _0x37dcd0=_0xe2a9ee;try{await this[_0x37dcd0(0xe3)]();}catch(_0x5e4a82){console['error'](_0x37dcd0(0xa0),_0x5e4a82);}},0x3c*0x3c*0x3e8),console[_0xe2a9ee(0x8d)](_0xe2a9ee(0x75));}['stopPeriodicUpdates'](){const _0x2ab8ac=a51_0x54bdb2;this[_0x2ab8ac(0x92)]&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x2ab8ac(0x8d)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a51_0x54bdb2(0xe3)](){const _0xf0adf6=a51_0x54bdb2;try{console[_0xf0adf6(0x8d)](_0xf0adf6(0xaa));const _0x18bc4d=this['CURRENCIES']['join'](','),_0x22c874=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x18bc4d,_0x4eed42=await fetch(_0x22c874,{'headers':{'Accept':'application/json','User-Agent':_0xf0adf6(0xba)}});if(!_0x4eed42['ok'])throw new Error(_0xf0adf6(0xaf)+_0x4eed42[_0xf0adf6(0x81)]+'\x20'+_0x4eed42['statusText']);const _0x1d4b8f=await _0x4eed42[_0xf0adf6(0xc5)]();if(!_0x1d4b8f[_0xf0adf6(0x98)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x541e22=_0x1d4b8f[_0xf0adf6(0x98)];console[_0xf0adf6(0x8d)](_0xf0adf6(0xbe)+Object[_0xf0adf6(0x7e)](_0x541e22)['length']+'\x20currencies');const _0x582b14=Object['entries'](_0x541e22)[_0xf0adf6(0xcc)](async([_0x179518,_0x543c3f])=>{const _0x4c4ccf=_0xf0adf6;try{await database_1[_0x4c4ccf(0x86)][_0x4c4ccf(0xd7)][_0x4c4ccf(0xa6)]({'where':{'currency':_0x179518['toLowerCase']()},'update':{'rate':_0x543c3f},'create':{'currency':_0x179518[_0x4c4ccf(0xdb)](),'rate':_0x543c3f}});}catch(_0x3780f8){console[_0x4c4ccf(0xc3)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x179518+':',_0x3780f8);}});await Promise['allSettled'](_0x582b14),console['log'](_0xf0adf6(0xcf));}catch(_0x7982b6){console['error'](_0xf0adf6(0xcd),_0x7982b6);throw _0x7982b6;}}async['getCurrencyRate'](_0x1047ee){const _0x31366f=a51_0x54bdb2,_0x120de9=_0x1047ee[_0x31366f(0xdb)]();if(_0x120de9==='usdt')return 0x1;try{const _0x4e0823=await database_1[_0x31366f(0x86)][_0x31366f(0xd7)][_0x31366f(0xd8)]({'where':{'currency':_0x120de9}});if(!_0x4e0823)return console['warn'](_0x31366f(0xc7)+_0x1047ee+_0x31366f(0x79)),0x1;return _0x4e0823['rate'];}catch(_0x112125){return console[_0x31366f(0xc3)](_0x31366f(0x7f)+_0x1047ee+':',_0x112125),0x1;}}async[a51_0x54bdb2(0xd2)](_0x54628a,_0x562ce9){const _0x55bedc=a51_0x54bdb2,_0x34d879=_0x562ce9[_0x55bedc(0xdb)]();if(_0x34d879===_0x55bedc(0x90)){const _0x1ff2d2=_0x54628a*(0x1+this[_0x55bedc(0x78)]/0x64);return console['log'](_0x55bedc(0xc4)+this[_0x55bedc(0x78)]+_0x55bedc(0xce)+_0x54628a+_0x55bedc(0x88)+_0x1ff2d2[_0x55bedc(0xa9)](0x6)+_0x55bedc(0x8a)),_0x1ff2d2;}try{const _0x4c356d=await this[_0x55bedc(0x8e)](_0x34d879),_0x4a17d6=_0x54628a/_0x4c356d,_0x31fd8a=_0x4a17d6*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x55bedc(0x8d)]('ðŸ’±\x20Converted\x20'+_0x54628a+'\x20'+_0x562ce9[_0x55bedc(0xa3)]()+_0x55bedc(0x9b)+_0x4a17d6['toFixed'](0x6)+_0x55bedc(0x9e)+this[_0x55bedc(0x78)]+_0x55bedc(0xd4)+_0x31fd8a[_0x55bedc(0xa9)](0x6)+'\x20USDT\x20(rate:\x20'+_0x4c356d+')'),_0x31fd8a;}catch(_0x3c6a61){console['error'](_0x55bedc(0x85)+_0x54628a+'\x20'+_0x562ce9+_0x55bedc(0xd5),_0x3c6a61);const _0x140bbc=_0x54628a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x140bbc;}}async[a51_0x54bdb2(0x9c)](_0x5ecc29){const _0x46bccd=a51_0x54bdb2;let _0x2f8d45=0x0;for(const {amount:_0x1f6484,currency:_0xfdceeb}of _0x5ecc29){const _0x1b798f=await this[_0x46bccd(0xd2)](_0x1f6484,_0xfdceeb);_0x2f8d45+=_0x1b798f;}return _0x2f8d45;}async[a51_0x54bdb2(0xb6)](){const _0x584d20=a51_0x54bdb2;try{const _0x2f9b26=await database_1[_0x584d20(0x86)]['currencyRate'][_0x584d20(0x9f)]({'select':{'currency':!![],'rate':!![]}}),_0x2642d3={'usdt':0x1};return _0x2f9b26[_0x584d20(0x99)](_0x25b42d=>{const _0x4bc50e=_0x584d20;_0x2642d3[_0x25b42d[_0x4bc50e(0xb9)]]=_0x25b42d[_0x4bc50e(0x80)];}),_0x2642d3;}catch(_0x49c226){return console[_0x584d20(0xc3)](_0x584d20(0xac),_0x49c226),{'usdt':0x1};}}async['getRatesStatus'](){const _0x2528b8=a51_0x54bdb2;try{const [_0x588ae8,_0x3ed21e,_0x5e52de]=await Promise['all']([database_1[_0x2528b8(0x86)][_0x2528b8(0xd7)][_0x2528b8(0xc6)](),database_1[_0x2528b8(0x86)]['currencyRate'][_0x2528b8(0x97)]({'orderBy':{'updatedAt':_0x2528b8(0x76)},'select':{'updatedAt':!![]}}),database_1[_0x2528b8(0x86)][_0x2528b8(0xd7)][_0x2528b8(0x97)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x588ae8,'lastUpdated':_0x3ed21e?.[_0x2528b8(0xb1)]||null,'oldestRate':_0x5e52de?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x4f6f12){return console[_0x2528b8(0xc3)]('Error\x20getting\x20rates\x20status:',_0x4f6f12),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x2528b8(0x78)]};}}['getMarkupPercentage'](){const _0x4020d4=a51_0x54bdb2;return this[_0x4020d4(0x78)];}}exports[a51_0x54bdb2(0xb7)]=CurrencyService,exports[a51_0x54bdb2(0x7a)]=new CurrencyService();