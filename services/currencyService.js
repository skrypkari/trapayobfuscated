'use strict';const a43_0x1d775d=a43_0x5458;(function(_0x130ccb,_0x3e22a4){const _0x4b9b7c=a43_0x5458,_0x2980b7=_0x130ccb();while(!![]){try{const _0x43db05=-parseInt(_0x4b9b7c(0xc2))/0x1*(parseInt(_0x4b9b7c(0xe2))/0x2)+-parseInt(_0x4b9b7c(0xac))/0x3+parseInt(_0x4b9b7c(0xf4))/0x4*(parseInt(_0x4b9b7c(0xc4))/0x5)+parseInt(_0x4b9b7c(0xce))/0x6*(-parseInt(_0x4b9b7c(0xca))/0x7)+-parseInt(_0x4b9b7c(0xe3))/0x8*(parseInt(_0x4b9b7c(0x7d))/0x9)+-parseInt(_0x4b9b7c(0xba))/0xa+-parseInt(_0x4b9b7c(0xe5))/0xb*(-parseInt(_0x4b9b7c(0xf0))/0xc);if(_0x43db05===_0x3e22a4)break;else _0x2980b7['push'](_0x2980b7['shift']());}catch(_0x32b50c){_0x2980b7['push'](_0x2980b7['shift']());}}}(a43_0x5cf0,0xe87c7));var __importDefault=this&&this['__importDefault']||function(_0xb7a7e7){const _0x1aa44e=a43_0x5458;return _0xb7a7e7&&_0xb7a7e7[_0x1aa44e(0xa5)]?_0xb7a7e7:{'default':_0xb7a7e7};};function a43_0x5458(_0x5d3a30,_0xcabe55){const _0x5cf011=a43_0x5cf0();return a43_0x5458=function(_0x54588a,_0x4cec78){_0x54588a=_0x54588a-0x7a;let _0x112e73=_0x5cf011[_0x54588a];return _0x112e73;},a43_0x5458(_0x5d3a30,_0xcabe55);}Object['defineProperty'](exports,a43_0x1d775d(0xa5),{'value':!![]}),exports[a43_0x1d775d(0xed)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a43_0x1d775d(0xd1)));function a43_0x5cf0(){const _0x3baac3=['vef','ltc','jpy','link','Error\x20getting\x20all\x20rates:','entries','zar','forEach','default','rate','bdt','__esModule','eth','startPeriodicUpdates','warn','currencyRate','czk','Payment\x20System/1.0','5471769bJoUkV','gbp','Failed\x20to\x20update\x20rate\x20for\x20','length','findUnique','php','hkd','thb','aud','keys','✅\x20Currency\x20rates\x20updated\x20successfully','CURRENCIES','inr','desc','5858180NclmbY','Error\x20getting\x20rates\x20status:','\x20USDT\x20(rate:\x20','sar','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','updatedAt','mxn','bmd','3937VbsShh','krw','73715BkoeaD','bch',',\x20using\x201\x20as\x20fallback','MARKUP_PERCENTAGE','yfi','nzd','3983XgRUNL','❌\x20Failed\x20to\x20update\x20currency\x20rates:','lkr','Error\x20getting\x20rate\x20for\x20currency\x20','1326FwYtLm','pln','idr','../config/database','CurrencyService','bnb','aed','Periodic\x20currency\x20rates\x20update\x20failed:','eos','map','💱\x20Applied\x20','COINGECKO_URL','\x20to\x20USDT:','xag','https://api.coingecko.com/api/v3/simple/price','getCurrencyRate','btc','?ids=tether&vs_currencies=','findFirst','statusText','772MJPowz','1258344kFnJzK','kwd','11XEKfdJ','mmk','toLowerCase','tether','dkk','usdt','sats','dot','currencyService','huf','all','64986780LpEBHx','updateCurrencyRates','getMarkupPercentage','application/json','188yfSpEQ','\x20USDT','bhd','currency','asc','status','getRatesStatus','getAllRates','brl','error','\x20USDT,\x20with\x20','63IgYuLN','log','%\x20markup\x20to\x20','upsert','cny','sek','vnd','bits','twd','toFixed','findMany','\x20USDT\x20=\x20','usd','toUpperCase','stopPeriodicUpdates','gel','myr','rub','convertToUSDT','convertMultipleToUSDT','xrp','CoinGecko\x20API\x20error:\x20','\x20currencies','xlm','eur','Error\x20converting\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','updateInterval','xau'];a43_0x5cf0=function(){return _0x3baac3;};return a43_0x5cf0();}class CurrencyService{constructor(){const _0xb98dfa=a43_0x1d775d;this[_0xb98dfa(0xd9)]=_0xb98dfa(0xdc),this[_0xb98dfa(0xb7)]=[_0xb98dfa(0xde),_0xb98dfa(0xa6),_0xb98dfa(0x9b),_0xb98dfa(0xc5),_0xb98dfa(0xd3),_0xb98dfa(0xd6),_0xb98dfa(0x91),_0xb98dfa(0x94),_0xb98dfa(0x9d),_0xb98dfa(0xec),_0xb98dfa(0xc8),_0xb98dfa(0x89),_0xb98dfa(0xd4),'ars',_0xb98dfa(0xb4),_0xb98dfa(0xa4),_0xb98dfa(0xf6),_0xb98dfa(0xc1),_0xb98dfa(0x7a),'cad','chf','clp',_0xb98dfa(0x81),_0xb98dfa(0xaa),_0xb98dfa(0xe9),_0xb98dfa(0x95),_0xb98dfa(0xad),_0xb98dfa(0x8c),_0xb98dfa(0xb2),_0xb98dfa(0xee),_0xb98dfa(0xd0),'ils',_0xb98dfa(0xb8),_0xb98dfa(0x9c),_0xb98dfa(0xc3),_0xb98dfa(0xe4),_0xb98dfa(0xcc),_0xb98dfa(0xe6),_0xb98dfa(0xc0),_0xb98dfa(0x8d),'ngn','nok',_0xb98dfa(0xc9),_0xb98dfa(0xb1),'pkr',_0xb98dfa(0xcf),_0xb98dfa(0x8e),_0xb98dfa(0xbd),_0xb98dfa(0x82),'sgd',_0xb98dfa(0xb3),'try',_0xb98dfa(0x85),'uah',_0xb98dfa(0x9a),_0xb98dfa(0x83),_0xb98dfa(0xa0),'xdr',_0xb98dfa(0xdb),_0xb98dfa(0x99),_0xb98dfa(0x84),_0xb98dfa(0xeb)],this[_0xb98dfa(0x98)]=null,this[_0xb98dfa(0xc7)]=-0x3,this[_0xb98dfa(0xa7)]();}[a43_0x1d775d(0xa7)](){const _0x1a42ae=a43_0x1d775d;this[_0x1a42ae(0xf1)]()['catch'](_0x2754a0=>{const _0x4b415d=_0x1a42ae;console[_0x4b415d(0x7b)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x2754a0);}),this[_0x1a42ae(0x98)]=setInterval(async()=>{const _0x5b6220=_0x1a42ae;try{await this['updateCurrencyRates']();}catch(_0x272b48){console[_0x5b6220(0x7b)](_0x5b6220(0xd5),_0x272b48);}},0x3c*0x3c*0x3e8),console[_0x1a42ae(0x7e)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a43_0x1d775d(0x8b)](){const _0x77b3b4=a43_0x1d775d;this[_0x77b3b4(0x98)]&&(clearInterval(this[_0x77b3b4(0x98)]),this[_0x77b3b4(0x98)]=null,console[_0x77b3b4(0x7e)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a43_0x1d775d(0xf1)](){const _0x4b0dc2=a43_0x1d775d;try{console[_0x4b0dc2(0x7e)](_0x4b0dc2(0x97));const _0x25adf5=this[_0x4b0dc2(0xb7)]['join'](','),_0x5c5f24=this[_0x4b0dc2(0xd9)]+_0x4b0dc2(0xdf)+_0x25adf5,_0x6560f4=await fetch(_0x5c5f24,{'headers':{'Accept':_0x4b0dc2(0xf3),'User-Agent':_0x4b0dc2(0xab)}});if(!_0x6560f4['ok'])throw new Error(_0x4b0dc2(0x92)+_0x6560f4[_0x4b0dc2(0xf9)]+'\x20'+_0x6560f4[_0x4b0dc2(0xe1)]);const _0x40be1a=await _0x6560f4['json']();if(!_0x40be1a['tether'])throw new Error(_0x4b0dc2(0xbe));const _0x164946=_0x40be1a[_0x4b0dc2(0xe8)];console['log']('📊\x20Received\x20rates\x20for\x20'+Object[_0x4b0dc2(0xb5)](_0x164946)[_0x4b0dc2(0xaf)]+_0x4b0dc2(0x93));const _0x259d6e=Object[_0x4b0dc2(0x9f)](_0x164946)[_0x4b0dc2(0xd7)](async([_0x5dafe4,_0x2ed351])=>{const _0x45bf05=_0x4b0dc2;try{await database_1['default']['currencyRate'][_0x45bf05(0x80)]({'where':{'currency':_0x5dafe4[_0x45bf05(0xe7)]()},'update':{'rate':_0x2ed351},'create':{'currency':_0x5dafe4['toLowerCase'](),'rate':_0x2ed351}});}catch(_0x1961df){console[_0x45bf05(0x7b)](_0x45bf05(0xae)+_0x5dafe4+':',_0x1961df);}});await Promise['allSettled'](_0x259d6e),console['log'](_0x4b0dc2(0xb6));}catch(_0x18bb3a){console[_0x4b0dc2(0x7b)](_0x4b0dc2(0xcb),_0x18bb3a);throw _0x18bb3a;}}async[a43_0x1d775d(0xdd)](_0xffe607){const _0x180d89=a43_0x1d775d,_0x381607=_0xffe607[_0x180d89(0xe7)]();if(_0x381607==='usdt')return 0x1;try{const _0x582c83=await database_1[_0x180d89(0xa2)]['currencyRate'][_0x180d89(0xb0)]({'where':{'currency':_0x381607}});if(!_0x582c83)return console[_0x180d89(0xa8)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0xffe607+_0x180d89(0xc6)),0x1;return _0x582c83[_0x180d89(0xa3)];}catch(_0x1283ff){return console['error'](_0x180d89(0xcd)+_0xffe607+':',_0x1283ff),0x1;}}async['convertToUSDT'](_0x275a58,_0x528b19){const _0x4a84ed=a43_0x1d775d,_0x19c3dc=_0x528b19['toLowerCase']();if(_0x19c3dc===_0x4a84ed(0xea)){const _0x50a673=_0x275a58*(0x1+this[_0x4a84ed(0xc7)]/0x64);return console[_0x4a84ed(0x7e)](_0x4a84ed(0xd8)+this[_0x4a84ed(0xc7)]+_0x4a84ed(0x7f)+_0x275a58+_0x4a84ed(0x88)+_0x50a673['toFixed'](0x6)+_0x4a84ed(0xf5)),_0x50a673;}try{const _0x34c95d=await this['getCurrencyRate'](_0x19c3dc),_0x269abd=_0x275a58/_0x34c95d,_0x41754b=_0x269abd*(0x1+this[_0x4a84ed(0xc7)]/0x64);return console[_0x4a84ed(0x7e)]('💱\x20Converted\x20'+_0x275a58+'\x20'+_0x528b19[_0x4a84ed(0x8a)]()+'\x20to\x20'+_0x269abd['toFixed'](0x6)+_0x4a84ed(0x7c)+this[_0x4a84ed(0xc7)]+'%\x20markup\x20=\x20'+_0x41754b[_0x4a84ed(0x86)](0x6)+_0x4a84ed(0xbc)+_0x34c95d+')'),_0x41754b;}catch(_0x547ec5){console['error'](_0x4a84ed(0x96)+_0x275a58+'\x20'+_0x528b19+_0x4a84ed(0xda),_0x547ec5);const _0xdc263c=_0x275a58*(0x1+this[_0x4a84ed(0xc7)]/0x64);return _0xdc263c;}}async[a43_0x1d775d(0x90)](_0x3332d2){const _0x1baccc=a43_0x1d775d;let _0x5449d1=0x0;for(const {amount:_0x5a53d0,currency:_0x52f1f2}of _0x3332d2){const _0x138c44=await this[_0x1baccc(0x8f)](_0x5a53d0,_0x52f1f2);_0x5449d1+=_0x138c44;}return _0x5449d1;}async[a43_0x1d775d(0xfb)](){const _0x4fd51c=a43_0x1d775d;try{const _0x334123=await database_1[_0x4fd51c(0xa2)][_0x4fd51c(0xa9)][_0x4fd51c(0x87)]({'select':{'currency':!![],'rate':!![]}}),_0x2e9ac9={'usdt':0x1};return _0x334123[_0x4fd51c(0xa1)](_0x595608=>{const _0x5e2aa7=_0x4fd51c;_0x2e9ac9[_0x595608[_0x5e2aa7(0xf7)]]=_0x595608[_0x5e2aa7(0xa3)];}),_0x2e9ac9;}catch(_0x280175){return console[_0x4fd51c(0x7b)](_0x4fd51c(0x9e),_0x280175),{'usdt':0x1};}}async[a43_0x1d775d(0xfa)](){const _0xa0795f=a43_0x1d775d;try{const [_0x1ac272,_0x19c37a,_0x3ed49f]=await Promise[_0xa0795f(0xef)]([database_1[_0xa0795f(0xa2)][_0xa0795f(0xa9)]['count'](),database_1['default'][_0xa0795f(0xa9)]['findFirst']({'orderBy':{'updatedAt':_0xa0795f(0xb9)},'select':{'updatedAt':!![]}}),database_1[_0xa0795f(0xa2)][_0xa0795f(0xa9)][_0xa0795f(0xe0)]({'orderBy':{'updatedAt':_0xa0795f(0xf8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1ac272,'lastUpdated':_0x19c37a?.[_0xa0795f(0xbf)]||null,'oldestRate':_0x3ed49f?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x37462e){return console[_0xa0795f(0x7b)](_0xa0795f(0xbb),_0x37462e),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xa0795f(0xc7)]};}}[a43_0x1d775d(0xf2)](){const _0x547e31=a43_0x1d775d;return this[_0x547e31(0xc7)];}}exports[a43_0x1d775d(0xd2)]=CurrencyService,exports[a43_0x1d775d(0xed)]=new CurrencyService();