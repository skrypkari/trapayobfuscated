'use strict';const a39_0x3a7e29=a39_0x3f57;function a39_0x3f57(_0x58ed1e,_0x254004){const _0x250678=a39_0x2506();return a39_0x3f57=function(_0x3f57fc,_0x1467a0){_0x3f57fc=_0x3f57fc-0x85;let _0x4c6837=_0x250678[_0x3f57fc];return _0x4c6837;},a39_0x3f57(_0x58ed1e,_0x254004);}function a39_0x2506(){const _0x1d7abe=['mxn','currencyService','xag','2108253sMHYBR','toLowerCase','status','twd','currencyRate','Failed\x20to\x20update\x20rate\x20for\x20','Error\x20getting\x20rate\x20for\x20currency\x20','dot','startPeriodicUpdates','statusText','findMany','desc','idr','inr','usdt','json','thb','Periodic\x20currency\x20rates\x20update\x20failed:','CurrencyService','currency','default','pkr','6333485IBKbQe','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','%\x20markup\x20to\x20','MARKUP_PERCENTAGE','\x20currencies','sek','stopPeriodicUpdates','krw','yfi','findFirst','eur','chf','bmd','tether','zar','xlm','mmk','kwd','563294YzwsYy','clp','all','application/json','keys','4IpgJLB','COINGECKO_URL','\x20to\x20','count','907140gDsgZF','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','getRatesStatus','bnb','nzd','link','2081112fxxeJd','getAllRates','2CoycOb','try','lkr','updatedAt','hkd','bhd','bdt','cad','aud','cny','allSettled','upsert','updateCurrencyRates','entries','uah','rub','eos','toFixed','brl','__esModule','pln','join','eth','log','ltc','forEach','💱\x20Converted\x20','xau','📊\x20Received\x20rates\x20for\x20','huf','CURRENCIES','defineProperty','bch','\x20USDT\x20(rate:\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','toUpperCase','getCurrencyRate','\x20USDT\x20=\x20','sats','10380249JrJMYv','__importDefault','asc','nok','findUnique','warn','error','CoinGecko\x20API\x20error:\x20','500750XxpvLq','dkk','✅\x20Currency\x20rates\x20updated\x20successfully','aed','ars','../config/database','myr','Error\x20converting\x20','Error\x20getting\x20rates\x20status:','8bZkHIF','\x20to\x20USDT:','gbp','updateInterval','💱\x20Applied\x20','usd'];a39_0x2506=function(){return _0x1d7abe;};return a39_0x2506();}(function(_0x2453c7,_0x5b945c){const _0xc88294=a39_0x3f57,_0x6d4b91=_0x2453c7();while(!![]){try{const _0x47cbd1=-parseInt(_0xc88294(0xcb))/0x1*(-parseInt(_0xc88294(0xba))/0x2)+parseInt(_0xc88294(0xc9))/0x3+parseInt(_0xc88294(0xbf))/0x4*(-parseInt(_0xc88294(0xa8))/0x5)+-parseInt(_0xc88294(0xc3))/0x6+-parseInt(_0xc88294(0x92))/0x7+parseInt(_0xc88294(0x89))/0x8*(parseInt(_0xc88294(0xf2))/0x9)+parseInt(_0xc88294(0xfa))/0xa;if(_0x47cbd1===_0x5b945c)break;else _0x6d4b91['push'](_0x6d4b91['shift']());}catch(_0x3673f3){_0x6d4b91['push'](_0x6d4b91['shift']());}}}(a39_0x2506,0xb4ff8));var __importDefault=this&&this[a39_0x3a7e29(0xf3)]||function(_0x7dadbb){const _0x37a4cb=a39_0x3a7e29;return _0x7dadbb&&_0x7dadbb[_0x37a4cb(0xde)]?_0x7dadbb:{'default':_0x7dadbb};};Object[a39_0x3a7e29(0xea)](exports,a39_0x3a7e29(0xde),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x3a7e29(0x85)));class CurrencyService{constructor(){const _0x1ccff2=a39_0x3a7e29;this[_0x1ccff2(0xc0)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=['btc',_0x1ccff2(0xe1),_0x1ccff2(0xe3),_0x1ccff2(0xeb),_0x1ccff2(0xc6),_0x1ccff2(0xdb),'xrp',_0x1ccff2(0xb7),_0x1ccff2(0xc8),_0x1ccff2(0x99),_0x1ccff2(0xb0),_0x1ccff2(0x8e),_0x1ccff2(0xfd),_0x1ccff2(0xfe),_0x1ccff2(0xd3),_0x1ccff2(0xd1),_0x1ccff2(0xd0),_0x1ccff2(0xb4),_0x1ccff2(0xdd),_0x1ccff2(0xd2),_0x1ccff2(0xb3),_0x1ccff2(0xbb),_0x1ccff2(0xd4),'czk',_0x1ccff2(0xfb),_0x1ccff2(0xb2),_0x1ccff2(0x8b),'gel',_0x1ccff2(0xcf),_0x1ccff2(0xe8),_0x1ccff2(0x9e),'ils',_0x1ccff2(0x9f),'jpy',_0x1ccff2(0xaf),_0x1ccff2(0xb9),_0x1ccff2(0xcd),_0x1ccff2(0xb8),_0x1ccff2(0x8f),_0x1ccff2(0x86),'ngn',_0x1ccff2(0xf5),_0x1ccff2(0xc7),'php',_0x1ccff2(0xa7),_0x1ccff2(0xdf),_0x1ccff2(0xda),'sar',_0x1ccff2(0xad),'sgd',_0x1ccff2(0xa2),_0x1ccff2(0xcc),_0x1ccff2(0x95),_0x1ccff2(0xd9),'vef','vnd',_0x1ccff2(0xb6),'xdr',_0x1ccff2(0x91),_0x1ccff2(0xe6),'bits',_0x1ccff2(0xf1)],this[_0x1ccff2(0x8c)]=null,this[_0x1ccff2(0xab)]=0x3,this['startPeriodicUpdates']();}[a39_0x3a7e29(0x9a)](){const _0x492826=a39_0x3a7e29;this[_0x492826(0xd7)]()['catch'](_0x20064e=>{const _0x4925d4=_0x492826;console[_0x4925d4(0xf8)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x20064e);}),this[_0x492826(0x8c)]=setInterval(async()=>{const _0x1b90be=_0x492826;try{await this[_0x1b90be(0xd7)]();}catch(_0x3544b0){console[_0x1b90be(0xf8)](_0x1b90be(0xa3),_0x3544b0);}},0x3c*0x3c*0x3e8),console[_0x492826(0xe2)](_0x492826(0xc4));}[a39_0x3a7e29(0xae)](){const _0x2f55e5=a39_0x3a7e29;this[_0x2f55e5(0x8c)]&&(clearInterval(this[_0x2f55e5(0x8c)]),this['updateInterval']=null,console['log']('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a39_0x3a7e29(0xd7)](){const _0x16a7a3=a39_0x3a7e29;try{console[_0x16a7a3(0xe2)](_0x16a7a3(0xa9));const _0x37d84a=this[_0x16a7a3(0xe9)][_0x16a7a3(0xe0)](','),_0x3d97e6=this[_0x16a7a3(0xc0)]+'?ids=tether&vs_currencies='+_0x37d84a,_0xa31538=await fetch(_0x3d97e6,{'headers':{'Accept':_0x16a7a3(0xbd),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0xa31538['ok'])throw new Error(_0x16a7a3(0xf9)+_0xa31538[_0x16a7a3(0x94)]+'\x20'+_0xa31538[_0x16a7a3(0x9b)]);const _0x528097=await _0xa31538[_0x16a7a3(0xa1)]();if(!_0x528097[_0x16a7a3(0xb5)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x4aa5c8=_0x528097[_0x16a7a3(0xb5)];console[_0x16a7a3(0xe2)](_0x16a7a3(0xe7)+Object[_0x16a7a3(0xbe)](_0x4aa5c8)['length']+_0x16a7a3(0xac));const _0x256633=Object[_0x16a7a3(0xd8)](_0x4aa5c8)['map'](async([_0xe8b980,_0x842bc2])=>{const _0x48542c=_0x16a7a3;try{await database_1[_0x48542c(0xa6)][_0x48542c(0x96)][_0x48542c(0xd6)]({'where':{'currency':_0xe8b980[_0x48542c(0x93)]()},'update':{'rate':_0x842bc2},'create':{'currency':_0xe8b980[_0x48542c(0x93)](),'rate':_0x842bc2}});}catch(_0x4a2116){console['error'](_0x48542c(0x97)+_0xe8b980+':',_0x4a2116);}});await Promise[_0x16a7a3(0xd5)](_0x256633),console['log'](_0x16a7a3(0xfc));}catch(_0x535507){console['error'](_0x16a7a3(0xed),_0x535507);throw _0x535507;}}async[a39_0x3a7e29(0xef)](_0x27b119){const _0x30c6a1=a39_0x3a7e29,_0x18b7b0=_0x27b119['toLowerCase']();if(_0x18b7b0===_0x30c6a1(0xa0))return 0x1;try{const _0x50b57c=await database_1['default'][_0x30c6a1(0x96)][_0x30c6a1(0xf6)]({'where':{'currency':_0x18b7b0}});if(!_0x50b57c)return console[_0x30c6a1(0xf7)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x27b119+',\x20using\x201\x20as\x20fallback'),0x1;return _0x50b57c['rate'];}catch(_0x35ce59){return console[_0x30c6a1(0xf8)](_0x30c6a1(0x98)+_0x27b119+':',_0x35ce59),0x1;}}async['convertToUSDT'](_0x2f3e38,_0x2e07cc){const _0x126d72=a39_0x3a7e29,_0x61b465=_0x2e07cc[_0x126d72(0x93)]();if(_0x61b465===_0x126d72(0xa0)){const _0xc64f7=_0x2f3e38*(0x1+this[_0x126d72(0xab)]/0x64);return console[_0x126d72(0xe2)](_0x126d72(0x8d)+this['MARKUP_PERCENTAGE']+_0x126d72(0xaa)+_0x2f3e38+_0x126d72(0xf0)+_0xc64f7[_0x126d72(0xdc)](0x6)+'\x20USDT'),_0xc64f7;}try{const _0x85f55a=await this['getCurrencyRate'](_0x61b465),_0x5ba6b5=_0x2f3e38/_0x85f55a,_0x3b7d64=_0x5ba6b5*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x126d72(0xe2)](_0x126d72(0xe5)+_0x2f3e38+'\x20'+_0x2e07cc[_0x126d72(0xee)]()+_0x126d72(0xc1)+_0x5ba6b5[_0x126d72(0xdc)](0x6)+'\x20USDT,\x20with\x20'+this[_0x126d72(0xab)]+'%\x20markup\x20=\x20'+_0x3b7d64['toFixed'](0x6)+_0x126d72(0xec)+_0x85f55a+')'),_0x3b7d64;}catch(_0x10d5cc){console[_0x126d72(0xf8)](_0x126d72(0x87)+_0x2f3e38+'\x20'+_0x2e07cc+_0x126d72(0x8a),_0x10d5cc);const _0x43b217=_0x2f3e38*(0x1+this[_0x126d72(0xab)]/0x64);return _0x43b217;}}async['convertMultipleToUSDT'](_0x3273d5){let _0x5caf98=0x0;for(const {amount:_0x36524c,currency:_0xdcdb77}of _0x3273d5){const _0x2d1e39=await this['convertToUSDT'](_0x36524c,_0xdcdb77);_0x5caf98+=_0x2d1e39;}return _0x5caf98;}async[a39_0x3a7e29(0xca)](){const _0x6eaf4b=a39_0x3a7e29;try{const _0x4c04c4=await database_1[_0x6eaf4b(0xa6)][_0x6eaf4b(0x96)][_0x6eaf4b(0x9c)]({'select':{'currency':!![],'rate':!![]}}),_0x5dafe3={'usdt':0x1};return _0x4c04c4[_0x6eaf4b(0xe4)](_0x429367=>{const _0x2a0a21=_0x6eaf4b;_0x5dafe3[_0x429367[_0x2a0a21(0xa5)]]=_0x429367['rate'];}),_0x5dafe3;}catch(_0x3add96){return console[_0x6eaf4b(0xf8)]('Error\x20getting\x20all\x20rates:',_0x3add96),{'usdt':0x1};}}async[a39_0x3a7e29(0xc5)](){const _0x20e276=a39_0x3a7e29;try{const [_0x173531,_0x5402ee,_0xd33a2c]=await Promise[_0x20e276(0xbc)]([database_1[_0x20e276(0xa6)][_0x20e276(0x96)][_0x20e276(0xc2)](),database_1[_0x20e276(0xa6)][_0x20e276(0x96)][_0x20e276(0xb1)]({'orderBy':{'updatedAt':_0x20e276(0x9d)},'select':{'updatedAt':!![]}}),database_1[_0x20e276(0xa6)]['currencyRate'][_0x20e276(0xb1)]({'orderBy':{'updatedAt':_0x20e276(0xf4)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x173531,'lastUpdated':_0x5402ee?.[_0x20e276(0xce)]||null,'oldestRate':_0xd33a2c?.[_0x20e276(0xce)]||null,'markupPercentage':this[_0x20e276(0xab)]};}catch(_0xa8da9b){return console[_0x20e276(0xf8)](_0x20e276(0x88),_0xa8da9b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x20e276(0xab)]};}}['getMarkupPercentage'](){return this['MARKUP_PERCENTAGE'];}}exports[a39_0x3a7e29(0xa4)]=CurrencyService,exports[a39_0x3a7e29(0x90)]=new CurrencyService();