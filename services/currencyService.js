'use strict';const a41_0x56f03f=a41_0x5842;(function(_0x4b7468,_0x548225){const _0x33238d=a41_0x5842,_0x58f5dc=_0x4b7468();while(!![]){try{const _0x2dc943=parseInt(_0x33238d(0x221))/0x1*(-parseInt(_0x33238d(0x24f))/0x2)+-parseInt(_0x33238d(0x208))/0x3+parseInt(_0x33238d(0x23b))/0x4+parseInt(_0x33238d(0x263))/0x5+parseInt(_0x33238d(0x21f))/0x6*(parseInt(_0x33238d(0x269))/0x7)+-parseInt(_0x33238d(0x26b))/0x8+parseInt(_0x33238d(0x236))/0x9*(parseInt(_0x33238d(0x204))/0xa);if(_0x2dc943===_0x548225)break;else _0x58f5dc['push'](_0x58f5dc['shift']());}catch(_0xa90144){_0x58f5dc['push'](_0x58f5dc['shift']());}}}(a41_0x36e7,0x1f849));function a41_0x5842(_0x170835,_0x24a22f){const _0x36e746=a41_0x36e7();return a41_0x5842=function(_0x584282,_0x1a3161){_0x584282=_0x584282-0x1f1;let _0x1bd20d=_0x36e746[_0x584282];return _0x1bd20d;},a41_0x5842(_0x170835,_0x24a22f);}var __importDefault=this&&this[a41_0x56f03f(0x200)]||function(_0x15e64b){const _0x4b52c8=a41_0x56f03f;return _0x15e64b&&_0x15e64b[_0x4b52c8(0x227)]?_0x15e64b:{'default':_0x15e64b};};Object[a41_0x56f03f(0x215)](exports,a41_0x56f03f(0x227),{'value':!![]}),exports['currencyService']=exports[a41_0x56f03f(0x253)]=void 0x0;const database_1=__importDefault(require(a41_0x56f03f(0x206)));function a41_0x36e7(){const _0x1859f7=['COINGECKO_URL','sgd','Error\x20getting\x20rate\x20for\x20currency\x20','bnb','try','Failed\x20to\x20update\x20rate\x20for\x20','ltc','517590KGPkZS','https://api.coingecko.com/api/v3/simple/price','tether','findMany','\x20to\x20USDT:','upsert','600852GbxokI','jpy','1862824LWwoRk','Error\x20getting\x20rates\x20status:','nzd','sats','eos','inr','\x20USDT\x20=\x20','Error\x20getting\x20all\x20rates:','MARKUP_PERCENTAGE','vnd','mmk','findUnique','\x20USDT','dot','CURRENCIES','statusText','php','Initial\x20currency\x20rates\x20update\x20failed:','thb','btc','__importDefault','toFixed','startPeriodicUpdates','updateCurrencyRates','2705750AApRJD','getCurrencyRate','../config/database','keys','616875kuDDxc','default','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','currency','clp','desc','twd','entries','cny','💱\x20Applied\x20','aed','huf','allSettled','defineProperty','\x20USDT,\x20with\x20','findFirst','usd','toLowerCase','bits','ngn','length','xrp','updatedAt','6SyDaTd','aud','105229ncZwfW','updateInterval','?ids=tether&vs_currencies=','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Error\x20converting\x20','idr','__esModule','vef','✅\x20Currency\x20rates\x20updated\x20successfully','xag','CoinGecko\x20API\x20error:\x20','mxn','bdt','all','getRatesStatus','kwd','%\x20markup\x20=\x20',',\x20using\x201\x20as\x20fallback','ils','getAllRates','xlm','9ukeEZe','sar','chf','📊\x20Received\x20rates\x20for\x20','status','851500VXpnSZ','warn','\x20USDT\x20(rate:\x20','convertToUSDT','bmd','pkr','sek','xdr','dkk','stopPeriodicUpdates','usdt','application/json','gbp','bhd','hkd','currencyRate','log','rub','krw','❌\x20Failed\x20to\x20update\x20currency\x20rates:','2VwYIZZ','cad','💱\x20Converted\x20','zar','CurrencyService','gel','error','xau','rate','join','No\x20rate\x20found\x20for\x20currency:\x20','map','ars'];a41_0x36e7=function(){return _0x1859f7;};return a41_0x36e7();}class CurrencyService{constructor(){const _0x113587=a41_0x56f03f;this[_0x113587(0x25c)]=_0x113587(0x264),this[_0x113587(0x1fa)]=[_0x113587(0x1ff),'eth',_0x113587(0x262),'bch',_0x113587(0x25f),_0x113587(0x26f),_0x113587(0x21d),_0x113587(0x235),'link',_0x113587(0x1f9),'yfi',_0x113587(0x218),_0x113587(0x212),_0x113587(0x25b),_0x113587(0x220),_0x113587(0x22d),_0x113587(0x248),_0x113587(0x23f),'brl',_0x113587(0x250),_0x113587(0x238),_0x113587(0x20c),_0x113587(0x210),'czk',_0x113587(0x243),'eur',_0x113587(0x247),_0x113587(0x254),_0x113587(0x249),_0x113587(0x213),_0x113587(0x226),_0x113587(0x233),_0x113587(0x1f1),_0x113587(0x26a),_0x113587(0x24d),_0x113587(0x230),'lkr',_0x113587(0x1f6),_0x113587(0x22c),'myr',_0x113587(0x21b),'nok',_0x113587(0x26d),_0x113587(0x1fc),_0x113587(0x240),'pln',_0x113587(0x24c),_0x113587(0x237),_0x113587(0x241),_0x113587(0x25d),_0x113587(0x1fe),_0x113587(0x260),_0x113587(0x20e),'uah',_0x113587(0x228),_0x113587(0x1f5),_0x113587(0x252),_0x113587(0x242),_0x113587(0x22a),_0x113587(0x256),_0x113587(0x21a),_0x113587(0x26e)],this[_0x113587(0x222)]=null,this[_0x113587(0x1f4)]=-0x3,this[_0x113587(0x202)]();}[a41_0x56f03f(0x202)](){const _0xccc8ae=a41_0x56f03f;this[_0xccc8ae(0x203)]()['catch'](_0x28d8d1=>{const _0x556af2=_0xccc8ae;console[_0x556af2(0x255)](_0x556af2(0x1fd),_0x28d8d1);}),this[_0xccc8ae(0x222)]=setInterval(async()=>{try{await this['updateCurrencyRates']();}catch(_0x2bd5c5){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x2bd5c5);}},0x3c*0x3c*0x3e8),console[_0xccc8ae(0x24b)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a41_0x56f03f(0x244)](){const _0x4bf188=a41_0x56f03f;this[_0x4bf188(0x222)]&&(clearInterval(this[_0x4bf188(0x222)]),this[_0x4bf188(0x222)]=null,console[_0x4bf188(0x24b)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a41_0x56f03f(0x203)](){const _0x5dd41d=a41_0x56f03f;try{console[_0x5dd41d(0x24b)](_0x5dd41d(0x224));const _0xeb0206=this[_0x5dd41d(0x1fa)][_0x5dd41d(0x258)](','),_0x37a647=this[_0x5dd41d(0x25c)]+_0x5dd41d(0x223)+_0xeb0206,_0xa868d9=await fetch(_0x37a647,{'headers':{'Accept':_0x5dd41d(0x246),'User-Agent':'Payment\x20System/1.0'}});if(!_0xa868d9['ok'])throw new Error(_0x5dd41d(0x22b)+_0xa868d9[_0x5dd41d(0x23a)]+'\x20'+_0xa868d9[_0x5dd41d(0x1fb)]);const _0x44ed48=await _0xa868d9['json']();if(!_0x44ed48['tether'])throw new Error(_0x5dd41d(0x20a));const _0x3c1818=_0x44ed48[_0x5dd41d(0x265)];console[_0x5dd41d(0x24b)](_0x5dd41d(0x239)+Object[_0x5dd41d(0x207)](_0x3c1818)[_0x5dd41d(0x21c)]+'\x20currencies');const _0x3502f9=Object[_0x5dd41d(0x20f)](_0x3c1818)[_0x5dd41d(0x25a)](async([_0x5b06bb,_0x5069af])=>{const _0x1c58cc=_0x5dd41d;try{await database_1[_0x1c58cc(0x209)][_0x1c58cc(0x24a)][_0x1c58cc(0x268)]({'where':{'currency':_0x5b06bb['toLowerCase']()},'update':{'rate':_0x5069af},'create':{'currency':_0x5b06bb[_0x1c58cc(0x219)](),'rate':_0x5069af}});}catch(_0x1f05ff){console[_0x1c58cc(0x255)](_0x1c58cc(0x261)+_0x5b06bb+':',_0x1f05ff);}});await Promise[_0x5dd41d(0x214)](_0x3502f9),console[_0x5dd41d(0x24b)](_0x5dd41d(0x229));}catch(_0x585ff7){console[_0x5dd41d(0x255)](_0x5dd41d(0x24e),_0x585ff7);throw _0x585ff7;}}async[a41_0x56f03f(0x205)](_0x49fb42){const _0x3cbe88=a41_0x56f03f,_0x31de09=_0x49fb42[_0x3cbe88(0x219)]();if(_0x31de09===_0x3cbe88(0x245))return 0x1;try{const _0x234982=await database_1[_0x3cbe88(0x209)][_0x3cbe88(0x24a)][_0x3cbe88(0x1f7)]({'where':{'currency':_0x31de09}});if(!_0x234982)return console[_0x3cbe88(0x23c)](_0x3cbe88(0x259)+_0x49fb42+_0x3cbe88(0x232)),0x1;return _0x234982['rate'];}catch(_0xbf9ca3){return console[_0x3cbe88(0x255)](_0x3cbe88(0x25e)+_0x49fb42+':',_0xbf9ca3),0x1;}}async['convertToUSDT'](_0x27f670,_0x587721){const _0x24229c=a41_0x56f03f,_0x250aa9=_0x587721[_0x24229c(0x219)]();if(_0x250aa9==='usdt'){const _0x48bf6f=_0x27f670*(0x1+this[_0x24229c(0x1f4)]/0x64);return console['log'](_0x24229c(0x211)+this[_0x24229c(0x1f4)]+'%\x20markup\x20to\x20'+_0x27f670+_0x24229c(0x1f2)+_0x48bf6f['toFixed'](0x6)+_0x24229c(0x1f8)),_0x48bf6f;}try{const _0x5665f1=await this[_0x24229c(0x205)](_0x250aa9),_0x2d3532=_0x27f670/_0x5665f1,_0x4120af=_0x2d3532*(0x1+this[_0x24229c(0x1f4)]/0x64);return console[_0x24229c(0x24b)](_0x24229c(0x251)+_0x27f670+'\x20'+_0x587721['toUpperCase']()+'\x20to\x20'+_0x2d3532['toFixed'](0x6)+_0x24229c(0x216)+this[_0x24229c(0x1f4)]+_0x24229c(0x231)+_0x4120af[_0x24229c(0x201)](0x6)+_0x24229c(0x23d)+_0x5665f1+')'),_0x4120af;}catch(_0x188a9b){console[_0x24229c(0x255)](_0x24229c(0x225)+_0x27f670+'\x20'+_0x587721+_0x24229c(0x267),_0x188a9b);const _0x2a3c62=_0x27f670*(0x1+this[_0x24229c(0x1f4)]/0x64);return _0x2a3c62;}}async['convertMultipleToUSDT'](_0x4c88ad){const _0x3ba3f2=a41_0x56f03f;let _0x11d879=0x0;for(const {amount:_0x277ade,currency:_0x21c03a}of _0x4c88ad){const _0x598280=await this[_0x3ba3f2(0x23e)](_0x277ade,_0x21c03a);_0x11d879+=_0x598280;}return _0x11d879;}async[a41_0x56f03f(0x234)](){const _0xd8d378=a41_0x56f03f;try{const _0x5554a4=await database_1[_0xd8d378(0x209)][_0xd8d378(0x24a)][_0xd8d378(0x266)]({'select':{'currency':!![],'rate':!![]}}),_0x5c028f={'usdt':0x1};return _0x5554a4['forEach'](_0x289df0=>{const _0xfec032=_0xd8d378;_0x5c028f[_0x289df0[_0xfec032(0x20b)]]=_0x289df0[_0xfec032(0x257)];}),_0x5c028f;}catch(_0x2c6f5b){return console['error'](_0xd8d378(0x1f3),_0x2c6f5b),{'usdt':0x1};}}async[a41_0x56f03f(0x22f)](){const _0x444e46=a41_0x56f03f;try{const [_0x42b96c,_0x1362d0,_0x315cea]=await Promise[_0x444e46(0x22e)]([database_1['default'][_0x444e46(0x24a)]['count'](),database_1[_0x444e46(0x209)][_0x444e46(0x24a)][_0x444e46(0x217)]({'orderBy':{'updatedAt':_0x444e46(0x20d)},'select':{'updatedAt':!![]}}),database_1[_0x444e46(0x209)][_0x444e46(0x24a)][_0x444e46(0x217)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x42b96c,'lastUpdated':_0x1362d0?.['updatedAt']||null,'oldestRate':_0x315cea?.[_0x444e46(0x21e)]||null,'markupPercentage':this[_0x444e46(0x1f4)]};}catch(_0x3b4c0e){return console[_0x444e46(0x255)](_0x444e46(0x26c),_0x3b4c0e),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x444e46(0x1f4)]};}}['getMarkupPercentage'](){const _0x3cf7d6=a41_0x56f03f;return this[_0x3cf7d6(0x1f4)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();