'use strict';const a51_0x5423b0=a51_0xe3f8;(function(_0x2fdea3,_0x3426a3){const _0x1fb1a5=a51_0xe3f8,_0x2fadbb=_0x2fdea3();while(!![]){try{const _0xca2bd1=-parseInt(_0x1fb1a5(0x139))/0x1+-parseInt(_0x1fb1a5(0x1a3))/0x2*(-parseInt(_0x1fb1a5(0x162))/0x3)+parseInt(_0x1fb1a5(0x13f))/0x4+parseInt(_0x1fb1a5(0x152))/0x5+parseInt(_0x1fb1a5(0x150))/0x6*(parseInt(_0x1fb1a5(0x178))/0x7)+parseInt(_0x1fb1a5(0x173))/0x8+-parseInt(_0x1fb1a5(0x174))/0x9;if(_0xca2bd1===_0x3426a3)break;else _0x2fadbb['push'](_0x2fadbb['shift']());}catch(_0x1f00b1){_0x2fadbb['push'](_0x2fadbb['shift']());}}}(a51_0x5c3a,0xf0077));function a51_0x5c3a(){const _0x365c11=['jpy','usdt','?ids=tether&vs_currencies=','Payment\x20System/1.0','8856102uWoOZg','php','4180075ABcYlL','dkk','bmd','join','bnb','nok','aed','idr','dot','stopPeriodicUpdates','sek','getMarkupPercentage','startPeriodicUpdates',',\x20using\x201\x20as\x20fallback','Periodic\x20currency\x20rates\x20update\x20failed:','eur','5361aWJowP','\x20USDT\x20=\x20','krw','tether','CURRENCIES','Error\x20getting\x20rate\x20for\x20currency\x20','length','allSettled','%\x20markup\x20to\x20','updateInterval','rate','%\x20markup\x20=\x20','brl','chf','gel','entries','\x20currencies','12501392XJKRXX','28821951LjSTDN','vef','upsert','bdt','7ePSDYD','__esModule','CurrencyService','defineProperty','xdr','sgd','getAllRates','toUpperCase','currencyRate','Failed\x20to\x20update\x20rate\x20for\x20','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','rub','vnd','lkr','toLowerCase','desc','forEach','ðŸ’±\x20Converted\x20','ils','Error\x20getting\x20rates\x20status:','ngn','__importDefault','currency','mxn','updateCurrencyRates','currencyService','\x20USDT,\x20with\x20','\x20to\x20USDT:','huf','\x20to\x20','default','status','updatedAt','usd','âœ…\x20Currency\x20rates\x20updated\x20successfully','getRatesStatus','error','bch','bits','ars','xau','inr','statusText','358weeRxn','json','kwd','czk','zar','yfi','convertMultipleToUSDT','Initial\x20currency\x20rates\x20update\x20failed:','No\x20rate\x20found\x20for\x20currency:\x20','thb','MARKUP_PERCENTAGE','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','CoinGecko\x20API\x20error:\x20','pln','sats','ðŸ“Š\x20Received\x20rates\x20for\x20','toFixed','findUnique','655877oDKVAs','getCurrencyRate','cad','COINGECKO_URL','myr','bhd','2587584tEZPGl','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','findFirst','aud','Error\x20converting\x20','log','nzd','btc','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','convertToUSDT','map','eth','catch'];a51_0x5c3a=function(){return _0x365c11;};return a51_0x5c3a();}var __importDefault=this&&this[a51_0x5423b0(0x18d)]||function(_0x15b580){const _0x252708=a51_0x5423b0;return _0x15b580&&_0x15b580[_0x252708(0x179)]?_0x15b580:{'default':_0x15b580};};Object[a51_0x5423b0(0x17b)](exports,a51_0x5423b0(0x179),{'value':!![]}),exports[a51_0x5423b0(0x191)]=exports[a51_0x5423b0(0x17a)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x3ca943=a51_0x5423b0;this[_0x3ca943(0x13c)]='https://api.coingecko.com/api/v3/simple/price',this[_0x3ca943(0x166)]=[_0x3ca943(0x146),_0x3ca943(0x14a),'ltc',_0x3ca943(0x19d),_0x3ca943(0x156),'eos','xrp','xlm','link',_0x3ca943(0x15a),_0x3ca943(0x12c),_0x3ca943(0x199),_0x3ca943(0x158),_0x3ca943(0x19f),_0x3ca943(0x142),_0x3ca943(0x177),_0x3ca943(0x13e),_0x3ca943(0x154),_0x3ca943(0x16e),_0x3ca943(0x13b),_0x3ca943(0x16f),'clp','cny',_0x3ca943(0x1a6),_0x3ca943(0x153),_0x3ca943(0x161),'gbp',_0x3ca943(0x170),'hkd',_0x3ca943(0x194),_0x3ca943(0x159),_0x3ca943(0x18a),_0x3ca943(0x1a1),_0x3ca943(0x14c),_0x3ca943(0x164),_0x3ca943(0x1a5),_0x3ca943(0x185),'mmk',_0x3ca943(0x18f),_0x3ca943(0x13d),_0x3ca943(0x18c),_0x3ca943(0x157),_0x3ca943(0x145),_0x3ca943(0x151),'pkr',_0x3ca943(0x134),_0x3ca943(0x183),'sar',_0x3ca943(0x15c),_0x3ca943(0x17d),_0x3ca943(0x130),'try','twd','uah',_0x3ca943(0x175),_0x3ca943(0x184),_0x3ca943(0x12b),_0x3ca943(0x17c),'xag',_0x3ca943(0x1a0),_0x3ca943(0x19e),_0x3ca943(0x135)],this[_0x3ca943(0x16b)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x3ca943(0x15e)]();}[a51_0x5423b0(0x15e)](){const _0x111dfb=a51_0x5423b0;this[_0x111dfb(0x190)]()[_0x111dfb(0x14b)](_0x35c70e=>{const _0x330039=_0x111dfb;console[_0x330039(0x19c)](_0x330039(0x12e),_0x35c70e);}),this[_0x111dfb(0x16b)]=setInterval(async()=>{const _0x337bca=_0x111dfb;try{await this[_0x337bca(0x190)]();}catch(_0x422084){console[_0x337bca(0x19c)](_0x337bca(0x160),_0x422084);}},0x3c*0x3c*0x3e8),console[_0x111dfb(0x144)](_0x111dfb(0x182));}[a51_0x5423b0(0x15b)](){const _0x3ebf53=a51_0x5423b0;this['updateInterval']&&(clearInterval(this[_0x3ebf53(0x16b)]),this[_0x3ebf53(0x16b)]=null,console[_0x3ebf53(0x144)](_0x3ebf53(0x132)));}async[a51_0x5423b0(0x190)](){const _0x154b71=a51_0x5423b0;try{console[_0x154b71(0x144)](_0x154b71(0x140));const _0x1d58cc=this[_0x154b71(0x166)][_0x154b71(0x155)](','),_0x54f1cb=this[_0x154b71(0x13c)]+_0x154b71(0x14e)+_0x1d58cc,_0x4db123=await fetch(_0x54f1cb,{'headers':{'Accept':'application/json','User-Agent':_0x154b71(0x14f)}});if(!_0x4db123['ok'])throw new Error(_0x154b71(0x133)+_0x4db123[_0x154b71(0x197)]+'\x20'+_0x4db123[_0x154b71(0x1a2)]);const _0x4b20e1=await _0x4db123[_0x154b71(0x1a4)]();if(!_0x4b20e1[_0x154b71(0x165)])throw new Error(_0x154b71(0x147));const _0x25bd1b=_0x4b20e1[_0x154b71(0x165)];console['log'](_0x154b71(0x136)+Object['keys'](_0x25bd1b)[_0x154b71(0x168)]+_0x154b71(0x172));const _0x3fbd80=Object[_0x154b71(0x171)](_0x25bd1b)[_0x154b71(0x149)](async([_0x25eab7,_0x4a8718])=>{const _0x33b7e0=_0x154b71;try{await database_1[_0x33b7e0(0x196)][_0x33b7e0(0x180)][_0x33b7e0(0x176)]({'where':{'currency':_0x25eab7[_0x33b7e0(0x186)]()},'update':{'rate':_0x4a8718},'create':{'currency':_0x25eab7[_0x33b7e0(0x186)](),'rate':_0x4a8718}});}catch(_0x568568){console['error'](_0x33b7e0(0x181)+_0x25eab7+':',_0x568568);}});await Promise[_0x154b71(0x169)](_0x3fbd80),console[_0x154b71(0x144)](_0x154b71(0x19a));}catch(_0x5112cb){console[_0x154b71(0x19c)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x5112cb);throw _0x5112cb;}}async['getCurrencyRate'](_0x1f6deb){const _0x43bc72=a51_0x5423b0,_0x23b40c=_0x1f6deb[_0x43bc72(0x186)]();if(_0x23b40c===_0x43bc72(0x14d))return 0x1;try{const _0x4c9d63=await database_1[_0x43bc72(0x196)][_0x43bc72(0x180)][_0x43bc72(0x138)]({'where':{'currency':_0x23b40c}});if(!_0x4c9d63)return console['warn'](_0x43bc72(0x12f)+_0x1f6deb+_0x43bc72(0x15f)),0x1;return _0x4c9d63[_0x43bc72(0x16c)];}catch(_0x1d8465){return console[_0x43bc72(0x19c)](_0x43bc72(0x167)+_0x1f6deb+':',_0x1d8465),0x1;}}async[a51_0x5423b0(0x148)](_0x2ce70e,_0x207331){const _0x7e2858=a51_0x5423b0,_0x48dac1=_0x207331[_0x7e2858(0x186)]();if(_0x48dac1===_0x7e2858(0x14d)){const _0x2ac349=_0x2ce70e*(0x1+this[_0x7e2858(0x131)]/0x64);return console[_0x7e2858(0x144)]('ðŸ’±\x20Applied\x20'+this[_0x7e2858(0x131)]+_0x7e2858(0x16a)+_0x2ce70e+_0x7e2858(0x163)+_0x2ac349[_0x7e2858(0x137)](0x6)+'\x20USDT'),_0x2ac349;}try{const _0x4c7dd2=await this[_0x7e2858(0x13a)](_0x48dac1),_0x513543=_0x2ce70e/_0x4c7dd2,_0x43571f=_0x513543*(0x1+this[_0x7e2858(0x131)]/0x64);return console[_0x7e2858(0x144)](_0x7e2858(0x189)+_0x2ce70e+'\x20'+_0x207331[_0x7e2858(0x17f)]()+_0x7e2858(0x195)+_0x513543[_0x7e2858(0x137)](0x6)+_0x7e2858(0x192)+this[_0x7e2858(0x131)]+_0x7e2858(0x16d)+_0x43571f[_0x7e2858(0x137)](0x6)+'\x20USDT\x20(rate:\x20'+_0x4c7dd2+')'),_0x43571f;}catch(_0x2400df){console['error'](_0x7e2858(0x143)+_0x2ce70e+'\x20'+_0x207331+_0x7e2858(0x193),_0x2400df);const _0x4f0a04=_0x2ce70e*(0x1+this[_0x7e2858(0x131)]/0x64);return _0x4f0a04;}}async[a51_0x5423b0(0x12d)](_0x1b3356){const _0x54d35a=a51_0x5423b0;let _0x264b11=0x0;for(const {amount:_0x360f22,currency:_0x57616b}of _0x1b3356){const _0x3da80f=await this[_0x54d35a(0x148)](_0x360f22,_0x57616b);_0x264b11+=_0x3da80f;}return _0x264b11;}async[a51_0x5423b0(0x17e)](){const _0x2a8e8e=a51_0x5423b0;try{const _0x2dacd1=await database_1[_0x2a8e8e(0x196)][_0x2a8e8e(0x180)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x238e5f={'usdt':0x1};return _0x2dacd1[_0x2a8e8e(0x188)](_0x5e1671=>{const _0x3e872b=_0x2a8e8e;_0x238e5f[_0x5e1671[_0x3e872b(0x18e)]]=_0x5e1671[_0x3e872b(0x16c)];}),_0x238e5f;}catch(_0x318cf9){return console['error']('Error\x20getting\x20all\x20rates:',_0x318cf9),{'usdt':0x1};}}async[a51_0x5423b0(0x19b)](){const _0x3b0c02=a51_0x5423b0;try{const [_0x5dd195,_0x526d2f,_0x56347b]=await Promise['all']([database_1[_0x3b0c02(0x196)]['currencyRate']['count'](),database_1[_0x3b0c02(0x196)][_0x3b0c02(0x180)][_0x3b0c02(0x141)]({'orderBy':{'updatedAt':_0x3b0c02(0x187)},'select':{'updatedAt':!![]}}),database_1[_0x3b0c02(0x196)][_0x3b0c02(0x180)]['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5dd195,'lastUpdated':_0x526d2f?.[_0x3b0c02(0x198)]||null,'oldestRate':_0x56347b?.[_0x3b0c02(0x198)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x7c0702){return console[_0x3b0c02(0x19c)](_0x3b0c02(0x18b),_0x7c0702),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3b0c02(0x131)]};}}[a51_0x5423b0(0x15d)](){return this['MARKUP_PERCENTAGE'];}}function a51_0xe3f8(_0x57d881,_0x33f563){_0x57d881=_0x57d881-0x12b;const _0x5c3add=a51_0x5c3a();let _0xe3f840=_0x5c3add[_0x57d881];return _0xe3f840;}exports[a51_0x5423b0(0x17a)]=CurrencyService,exports[a51_0x5423b0(0x191)]=new CurrencyService();