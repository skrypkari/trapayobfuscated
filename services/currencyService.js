'use strict';function a39_0x547a(){const _0x3e10f4=['status','Periodic\x20currency\x20rates\x20update\x20failed:','toLowerCase','allSettled','bhd','join','%\x20markup\x20to\x20','../config/database','yfi','cny','count','findMany','bdt','MARKUP_PERCENTAGE','aud','tether','getCurrencyRate','vef','ars','toFixed','__esModule','getAllRates','eth','catch','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','convertToUSDT','Error\x20converting\x20','lkr','chf','rub','276946WiXjsw','cad','Error\x20getting\x20all\x20rates:','updatedAt','json','currencyService','desc','stopPeriodicUpdates','CoinGecko\x20API\x20error:\x20','krw','default','3664041PGoCli','map','\x20USDT,\x20with\x20','288963fzbNYt','📊\x20Received\x20rates\x20for\x20','pkr','💱\x20Converted\x20','eos','twd','findUnique','kwd','rate','\x20USDT\x20(rate:\x20','gel','defineProperty','COINGECKO_URL','ils',',\x20using\x201\x20as\x20fallback','ngn','\x20USDT\x20=\x20','4grDefF','clp','5795945saNCgS','myr','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','currencyRate','asc','startPeriodicUpdates','mmk','thb','17539687ETUTlH','9167648yTuYWQ','updateCurrencyRates','gbp','vnd','idr','log','__importDefault','6BxSbcO','Failed\x20to\x20update\x20rate\x20for\x20','bmd','forEach','✅\x20Currency\x20rates\x20updated\x20successfully','\x20USDT','\x20to\x20','https://api.coingecko.com/api/v3/simple/price','xlm','TesSoft\x20Payment\x20System/1.0','CurrencyService','application/json','💱\x20Applied\x20','updateInterval','entries','Initial\x20currency\x20rates\x20update\x20failed:','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','%\x20markup\x20=\x20','try','dot','6658673ZVwnuI','8Doqvfi','warn','sgd','zar','eur','jpy','bnb','btc','No\x20rate\x20found\x20for\x20currency:\x20','all','xrp','sar','usd','mxn','currency','getMarkupPercentage','xau','bch','xdr','upsert','CURRENCIES','50XoCTHj','error','keys','Error\x20getting\x20rates\x20status:','usdt','inr','convertMultipleToUSDT'];a39_0x547a=function(){return _0x3e10f4;};return a39_0x547a();}const a39_0x4d4333=a39_0x2408;function a39_0x2408(_0x3dff7d,_0x34cf81){const _0x547afd=a39_0x547a();return a39_0x2408=function(_0x2408b9,_0x473a20){_0x2408b9=_0x2408b9-0x9c;let _0x557e7c=_0x547afd[_0x2408b9];return _0x557e7c;},a39_0x2408(_0x3dff7d,_0x34cf81);}(function(_0x1ab4dc,_0x181790){const _0x4055f8=a39_0x2408,_0xf2d84f=_0x1ab4dc();while(!![]){try{const _0x416af4=-parseInt(_0x4055f8(0xd2))/0x1*(-parseInt(_0x4055f8(0x118))/0x2)+-parseInt(_0x4055f8(0xdd))/0x3*(parseInt(_0x4055f8(0xf1))/0x4)+parseInt(_0x4055f8(0xf3))/0x5+parseInt(_0x4055f8(0x103))/0x6*(-parseInt(_0x4055f8(0x117))/0x7)+-parseInt(_0x4055f8(0xfc))/0x8+-parseInt(_0x4055f8(0xe0))/0x9*(-parseInt(_0x4055f8(0xad))/0xa)+parseInt(_0x4055f8(0xfb))/0xb;if(_0x416af4===_0x181790)break;else _0xf2d84f['push'](_0xf2d84f['shift']());}catch(_0xee3719){_0xf2d84f['push'](_0xf2d84f['shift']());}}}(a39_0x547a,0xabbfb));var __importDefault=this&&this[a39_0x4d4333(0x102)]||function(_0x4ffe04){return _0x4ffe04&&_0x4ffe04['__esModule']?_0x4ffe04:{'default':_0x4ffe04};};Object[a39_0x4d4333(0xeb)](exports,a39_0x4d4333(0xc8),{'value':!![]}),exports[a39_0x4d4333(0xd7)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x4d4333(0xbb)));class CurrencyService{constructor(){const _0x3e6aac=a39_0x4d4333;this[_0x3e6aac(0xec)]=_0x3e6aac(0x10a),this['CURRENCIES']=[_0x3e6aac(0x9f),_0x3e6aac(0xca),'ltc',_0x3e6aac(0xa9),_0x3e6aac(0x9e),_0x3e6aac(0xe4),_0x3e6aac(0xa2),_0x3e6aac(0x10b),'link',_0x3e6aac(0x116),_0x3e6aac(0xbc),_0x3e6aac(0xa4),'aed',_0x3e6aac(0xc6),_0x3e6aac(0xc2),_0x3e6aac(0xc0),_0x3e6aac(0xb8),_0x3e6aac(0x105),'brl',_0x3e6aac(0xd3),_0x3e6aac(0xd0),_0x3e6aac(0xf2),_0x3e6aac(0xbd),'czk','dkk',_0x3e6aac(0x9c),_0x3e6aac(0xfe),_0x3e6aac(0xea),'hkd','huf',_0x3e6aac(0x100),_0x3e6aac(0xed),_0x3e6aac(0xb2),_0x3e6aac(0x9d),_0x3e6aac(0xdb),_0x3e6aac(0xe7),_0x3e6aac(0xcf),_0x3e6aac(0xf9),_0x3e6aac(0xa5),_0x3e6aac(0xf4),_0x3e6aac(0xef),'nok','nzd','php',_0x3e6aac(0xe2),'pln',_0x3e6aac(0xd1),_0x3e6aac(0xa3),'sek',_0x3e6aac(0x11a),_0x3e6aac(0xfa),_0x3e6aac(0x115),_0x3e6aac(0xe5),'uah',_0x3e6aac(0xc5),_0x3e6aac(0xff),_0x3e6aac(0x11b),_0x3e6aac(0xaa),'xag',_0x3e6aac(0xa8),'bits','sats'],this[_0x3e6aac(0x110)]=null,this[_0x3e6aac(0xc1)]=0x3,this[_0x3e6aac(0xf8)]();}['startPeriodicUpdates'](){const _0x3f8de4=a39_0x4d4333;this[_0x3f8de4(0xfd)]()[_0x3f8de4(0xcb)](_0x804840=>{const _0x43c0b2=_0x3f8de4;console[_0x43c0b2(0xae)](_0x43c0b2(0x112),_0x804840);}),this[_0x3f8de4(0x110)]=setInterval(async()=>{const _0x342f24=_0x3f8de4;try{await this[_0x342f24(0xfd)]();}catch(_0x5ad498){console[_0x342f24(0xae)](_0x342f24(0xb5),_0x5ad498);}},0x3c*0x3c*0x3e8),console[_0x3f8de4(0x101)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x4d4333(0xd9)](){const _0x35d4a9=a39_0x4d4333;this[_0x35d4a9(0x110)]&&(clearInterval(this[_0x35d4a9(0x110)]),this[_0x35d4a9(0x110)]=null,console[_0x35d4a9(0x101)](_0x35d4a9(0xf5)));}async[a39_0x4d4333(0xfd)](){const _0x50f4d9=a39_0x4d4333;try{console[_0x50f4d9(0x101)](_0x50f4d9(0x113));const _0x547b1c=this[_0x50f4d9(0xac)][_0x50f4d9(0xb9)](','),_0x599227=this[_0x50f4d9(0xec)]+'?ids=tether&vs_currencies='+_0x547b1c,_0x2cbfa2=await fetch(_0x599227,{'headers':{'Accept':_0x50f4d9(0x10e),'User-Agent':_0x50f4d9(0x10c)}});if(!_0x2cbfa2['ok'])throw new Error(_0x50f4d9(0xda)+_0x2cbfa2[_0x50f4d9(0xb4)]+'\x20'+_0x2cbfa2['statusText']);const _0x411cd3=await _0x2cbfa2[_0x50f4d9(0xd6)]();if(!_0x411cd3['tether'])throw new Error(_0x50f4d9(0xcc));const _0x4511a2=_0x411cd3[_0x50f4d9(0xc3)];console['log'](_0x50f4d9(0xe1)+Object[_0x50f4d9(0xaf)](_0x4511a2)['length']+'\x20currencies');const _0x4aae4d=Object[_0x50f4d9(0x111)](_0x4511a2)[_0x50f4d9(0xde)](async([_0x3d3b3f,_0x4d6ba6])=>{const _0x3c896e=_0x50f4d9;try{await database_1[_0x3c896e(0xdc)]['currencyRate'][_0x3c896e(0xab)]({'where':{'currency':_0x3d3b3f[_0x3c896e(0xb6)]()},'update':{'rate':_0x4d6ba6},'create':{'currency':_0x3d3b3f['toLowerCase'](),'rate':_0x4d6ba6}});}catch(_0x3a8cc5){console[_0x3c896e(0xae)](_0x3c896e(0x104)+_0x3d3b3f+':',_0x3a8cc5);}});await Promise[_0x50f4d9(0xb7)](_0x4aae4d),console[_0x50f4d9(0x101)](_0x50f4d9(0x107));}catch(_0x2505d2){console[_0x50f4d9(0xae)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x2505d2);throw _0x2505d2;}}async['getCurrencyRate'](_0x2d9ca0){const _0x3afbf7=a39_0x4d4333,_0x40a786=_0x2d9ca0[_0x3afbf7(0xb6)]();if(_0x40a786===_0x3afbf7(0xb1))return 0x1;try{const _0x8f5534=await database_1[_0x3afbf7(0xdc)][_0x3afbf7(0xf6)][_0x3afbf7(0xe6)]({'where':{'currency':_0x40a786}});if(!_0x8f5534)return console[_0x3afbf7(0x119)](_0x3afbf7(0xa0)+_0x2d9ca0+_0x3afbf7(0xee)),0x1;return _0x8f5534[_0x3afbf7(0xe8)];}catch(_0x3d4d25){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x2d9ca0+':',_0x3d4d25),0x1;}}async[a39_0x4d4333(0xcd)](_0x5680a0,_0xe77718){const _0x19f3f1=a39_0x4d4333,_0x2b3e62=_0xe77718[_0x19f3f1(0xb6)]();if(_0x2b3e62===_0x19f3f1(0xb1)){const _0x16fa83=_0x5680a0*(0x1+this[_0x19f3f1(0xc1)]/0x64);return console[_0x19f3f1(0x101)](_0x19f3f1(0x10f)+this[_0x19f3f1(0xc1)]+_0x19f3f1(0xba)+_0x5680a0+_0x19f3f1(0xf0)+_0x16fa83[_0x19f3f1(0xc7)](0x6)+_0x19f3f1(0x108)),_0x16fa83;}try{const _0xa92144=await this[_0x19f3f1(0xc4)](_0x2b3e62),_0x669484=_0x5680a0/_0xa92144,_0x1c864f=_0x669484*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x19f3f1(0x101)](_0x19f3f1(0xe3)+_0x5680a0+'\x20'+_0xe77718['toUpperCase']()+_0x19f3f1(0x109)+_0x669484[_0x19f3f1(0xc7)](0x6)+_0x19f3f1(0xdf)+this[_0x19f3f1(0xc1)]+_0x19f3f1(0x114)+_0x1c864f[_0x19f3f1(0xc7)](0x6)+_0x19f3f1(0xe9)+_0xa92144+')'),_0x1c864f;}catch(_0x5c499a){console[_0x19f3f1(0xae)](_0x19f3f1(0xce)+_0x5680a0+'\x20'+_0xe77718+'\x20to\x20USDT:',_0x5c499a);const _0x51b36d=_0x5680a0*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x51b36d;}}async[a39_0x4d4333(0xb3)](_0x4c0de8){const _0x2a9ccd=a39_0x4d4333;let _0x41ae5d=0x0;for(const {amount:_0x45e655,currency:_0x51f201}of _0x4c0de8){const _0x13ecd0=await this[_0x2a9ccd(0xcd)](_0x45e655,_0x51f201);_0x41ae5d+=_0x13ecd0;}return _0x41ae5d;}async[a39_0x4d4333(0xc9)](){const _0x3e0653=a39_0x4d4333;try{const _0x362c52=await database_1['default']['currencyRate'][_0x3e0653(0xbf)]({'select':{'currency':!![],'rate':!![]}}),_0x54e6fe={'usdt':0x1};return _0x362c52[_0x3e0653(0x106)](_0x183d52=>{const _0xf4bcdd=_0x3e0653;_0x54e6fe[_0x183d52[_0xf4bcdd(0xa6)]]=_0x183d52[_0xf4bcdd(0xe8)];}),_0x54e6fe;}catch(_0x22aecb){return console[_0x3e0653(0xae)](_0x3e0653(0xd4),_0x22aecb),{'usdt':0x1};}}async['getRatesStatus'](){const _0x176b19=a39_0x4d4333;try{const [_0x45cea3,_0x2212c3,_0x2c9b7e]=await Promise[_0x176b19(0xa1)]([database_1[_0x176b19(0xdc)][_0x176b19(0xf6)][_0x176b19(0xbe)](),database_1[_0x176b19(0xdc)][_0x176b19(0xf6)]['findFirst']({'orderBy':{'updatedAt':_0x176b19(0xd8)},'select':{'updatedAt':!![]}}),database_1[_0x176b19(0xdc)][_0x176b19(0xf6)]['findFirst']({'orderBy':{'updatedAt':_0x176b19(0xf7)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x45cea3,'lastUpdated':_0x2212c3?.[_0x176b19(0xd5)]||null,'oldestRate':_0x2c9b7e?.[_0x176b19(0xd5)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x135d5d){return console[_0x176b19(0xae)](_0x176b19(0xb0),_0x135d5d),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x176b19(0xc1)]};}}[a39_0x4d4333(0xa7)](){const _0x3f4c0c=a39_0x4d4333;return this[_0x3f4c0c(0xc1)];}}exports[a39_0x4d4333(0x10d)]=CurrencyService,exports[a39_0x4d4333(0xd7)]=new CurrencyService();