'use strict';const a38_0x32faba=a38_0x49f8;(function(_0x456466,_0x52c754){const _0x49da0e=a38_0x49f8,_0x4189c8=_0x456466();while(!![]){try{const _0x563cfe=parseInt(_0x49da0e(0x1c8))/0x1+-parseInt(_0x49da0e(0x210))/0x2*(parseInt(_0x49da0e(0x1c9))/0x3)+parseInt(_0x49da0e(0x1e7))/0x4*(-parseInt(_0x49da0e(0x217))/0x5)+-parseInt(_0x49da0e(0x1fa))/0x6+-parseInt(_0x49da0e(0x1f8))/0x7*(-parseInt(_0x49da0e(0x1f2))/0x8)+-parseInt(_0x49da0e(0x237))/0x9+parseInt(_0x49da0e(0x20d))/0xa;if(_0x563cfe===_0x52c754)break;else _0x4189c8['push'](_0x4189c8['shift']());}catch(_0x4c0bf9){_0x4189c8['push'](_0x4189c8['shift']());}}}(a38_0x36a0,0xba712));var __importDefault=this&&this[a38_0x32faba(0x20c)]||function(_0x7a199d){const _0x37faa4=a38_0x32faba;return _0x7a199d&&_0x7a199d[_0x37faa4(0x231)]?_0x7a199d:{'default':_0x7a199d};};Object[a38_0x32faba(0x1c2)](exports,a38_0x32faba(0x231),{'value':!![]}),exports[a38_0x32faba(0x1df)]=exports[a38_0x32faba(0x1f9)]=void 0x0;function a38_0x49f8(_0x3b2e2c,_0x2364e9){const _0x36a093=a38_0x36a0();return a38_0x49f8=function(_0x49f8b5,_0x5a0608){_0x49f8b5=_0x49f8b5-0x1bb;let _0x52227=_0x36a093[_0x49f8b5];return _0x52227;},a38_0x49f8(_0x3b2e2c,_0x2364e9);}const database_1=__importDefault(require(a38_0x32faba(0x1c7)));class CurrencyService{constructor(){const _0x3c4aea=a38_0x32faba;this[_0x3c4aea(0x1fc)]=_0x3c4aea(0x22b),this['CURRENCIES']=[_0x3c4aea(0x22f),_0x3c4aea(0x232),'ltc',_0x3c4aea(0x1bb),_0x3c4aea(0x1da),'eos',_0x3c4aea(0x1e6),_0x3c4aea(0x1cc),_0x3c4aea(0x1d9),'dot',_0x3c4aea(0x1eb),_0x3c4aea(0x23a),_0x3c4aea(0x1dd),_0x3c4aea(0x1be),_0x3c4aea(0x1d5),_0x3c4aea(0x218),_0x3c4aea(0x216),_0x3c4aea(0x1f0),'brl','cad',_0x3c4aea(0x226),_0x3c4aea(0x1cf),'cny','czk',_0x3c4aea(0x21f),_0x3c4aea(0x236),_0x3c4aea(0x1f4),_0x3c4aea(0x233),_0x3c4aea(0x21c),_0x3c4aea(0x208),_0x3c4aea(0x23b),_0x3c4aea(0x1fd),_0x3c4aea(0x22d),_0x3c4aea(0x200),'krw','kwd',_0x3c4aea(0x239),_0x3c4aea(0x204),_0x3c4aea(0x1cb),_0x3c4aea(0x1ea),_0x3c4aea(0x1ef),_0x3c4aea(0x1db),_0x3c4aea(0x20f),'php','pkr',_0x3c4aea(0x22c),'rub','sar','sek',_0x3c4aea(0x214),'thb',_0x3c4aea(0x229),'twd',_0x3c4aea(0x1d6),_0x3c4aea(0x221),_0x3c4aea(0x1f6),_0x3c4aea(0x206),_0x3c4aea(0x1bc),_0x3c4aea(0x20e),_0x3c4aea(0x224),_0x3c4aea(0x212),_0x3c4aea(0x235)],this[_0x3c4aea(0x21b)]=null,this[_0x3c4aea(0x220)]=0x3,this[_0x3c4aea(0x1c3)]();}[a38_0x32faba(0x1c3)](){const _0x5ccab9=a38_0x32faba;this['updateCurrencyRates']()[_0x5ccab9(0x1f7)](_0x5c934f=>{const _0x185d2f=_0x5ccab9;console[_0x185d2f(0x211)](_0x185d2f(0x1f1),_0x5c934f);}),this['updateInterval']=setInterval(async()=>{const _0x489419=_0x5ccab9;try{await this[_0x489419(0x219)]();}catch(_0x22feb7){console[_0x489419(0x211)](_0x489419(0x1e4),_0x22feb7);}},0x3c*0x3c*0x3e8),console['log'](_0x5ccab9(0x215));}[a38_0x32faba(0x1ca)](){const _0x287868=a38_0x32faba;this[_0x287868(0x21b)]&&(clearInterval(this[_0x287868(0x21b)]),this[_0x287868(0x21b)]=null,console[_0x287868(0x1ee)](_0x287868(0x1e1)));}async['updateCurrencyRates'](){const _0x3fb255=a38_0x32faba;try{console[_0x3fb255(0x1ee)](_0x3fb255(0x1d2));const _0x1a0374=this[_0x3fb255(0x1ce)][_0x3fb255(0x203)](','),_0x41dc5c=this['COINGECKO_URL']+_0x3fb255(0x1c5)+_0x1a0374,_0x4b0616=await fetch(_0x41dc5c,{'headers':{'Accept':_0x3fb255(0x21e),'User-Agent':_0x3fb255(0x238)}});if(!_0x4b0616['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x4b0616[_0x3fb255(0x1ed)]+'\x20'+_0x4b0616[_0x3fb255(0x222)]);const _0x4fd214=await _0x4b0616[_0x3fb255(0x1bf)]();if(!_0x4fd214[_0x3fb255(0x202)])throw new Error(_0x3fb255(0x228));const _0x4bddd0=_0x4fd214[_0x3fb255(0x202)];console[_0x3fb255(0x1ee)](_0x3fb255(0x1d7)+Object['keys'](_0x4bddd0)[_0x3fb255(0x1dc)]+_0x3fb255(0x1ec));const _0x24d5e5=Object[_0x3fb255(0x21a)](_0x4bddd0)['map'](async([_0x51d29e,_0x1333bb])=>{const _0x5b905c=_0x3fb255;try{await database_1[_0x5b905c(0x227)][_0x5b905c(0x22a)][_0x5b905c(0x1d3)]({'where':{'currency':_0x51d29e[_0x5b905c(0x22e)]()},'update':{'rate':_0x1333bb},'create':{'currency':_0x51d29e[_0x5b905c(0x22e)](),'rate':_0x1333bb}});}catch(_0x55fc44){console[_0x5b905c(0x211)](_0x5b905c(0x1d4)+_0x51d29e+':',_0x55fc44);}});await Promise[_0x3fb255(0x1ff)](_0x24d5e5),console[_0x3fb255(0x1ee)](_0x3fb255(0x1e5));}catch(_0x282c65){console[_0x3fb255(0x211)](_0x3fb255(0x201),_0x282c65);throw _0x282c65;}}async[a38_0x32faba(0x1d8)](_0x17cb6f){const _0x2cf827=a38_0x32faba,_0x214dac=_0x17cb6f[_0x2cf827(0x22e)]();if(_0x214dac===_0x2cf827(0x1e2))return 0x1;try{const _0x243338=await database_1['default'][_0x2cf827(0x22a)][_0x2cf827(0x230)]({'where':{'currency':_0x214dac}});if(!_0x243338)return console['warn'](_0x2cf827(0x1d0)+_0x17cb6f+',\x20using\x201\x20as\x20fallback'),0x1;return _0x243338[_0x2cf827(0x1e3)];}catch(_0x3000df){return console[_0x2cf827(0x211)](_0x2cf827(0x225)+_0x17cb6f+':',_0x3000df),0x1;}}async['convertToUSDT'](_0x4d5564,_0x602a50){const _0x429535=a38_0x32faba,_0x2cb7d5=_0x602a50[_0x429535(0x22e)]();if(_0x2cb7d5===_0x429535(0x1e2)){const _0x353a70=_0x4d5564*(0x1+this[_0x429535(0x220)]/0x64);return console[_0x429535(0x1ee)](_0x429535(0x1fe)+this['MARKUP_PERCENTAGE']+_0x429535(0x1c4)+_0x4d5564+_0x429535(0x1c6)+_0x353a70[_0x429535(0x1f5)](0x6)+_0x429535(0x1cd)),_0x353a70;}try{const _0x310fa3=await this['getCurrencyRate'](_0x2cb7d5),_0x25b547=_0x4d5564/_0x310fa3,_0x50c089=_0x25b547*(0x1+this[_0x429535(0x220)]/0x64);return console[_0x429535(0x1ee)](_0x429535(0x1bd)+_0x4d5564+'\x20'+_0x602a50[_0x429535(0x1e9)]()+'\x20to\x20'+_0x25b547['toFixed'](0x6)+_0x429535(0x20a)+this[_0x429535(0x220)]+'%\x20markup\x20=\x20'+_0x50c089[_0x429535(0x1f5)](0x6)+_0x429535(0x1fb)+_0x310fa3+')'),_0x50c089;}catch(_0x27eb69){console[_0x429535(0x211)](_0x429535(0x223)+_0x4d5564+'\x20'+_0x602a50+'\x20to\x20USDT:',_0x27eb69);const _0x13e289=_0x4d5564*(0x1+this[_0x429535(0x220)]/0x64);return _0x13e289;}}async[a38_0x32faba(0x1de)](_0x20cab7){const _0x7ddde0=a38_0x32faba;let _0x3677b1=0x0;for(const {amount:_0x1088a3,currency:_0x35a64c}of _0x20cab7){const _0x91468=await this[_0x7ddde0(0x213)](_0x1088a3,_0x35a64c);_0x3677b1+=_0x91468;}return _0x3677b1;}async[a38_0x32faba(0x234)](){const _0xa677fd=a38_0x32faba;try{const _0x53f4d2=await database_1[_0xa677fd(0x227)][_0xa677fd(0x22a)][_0xa677fd(0x1c1)]({'select':{'currency':!![],'rate':!![]}}),_0xf52ffb={'usdt':0x1};return _0x53f4d2['forEach'](_0x10c8b3=>{const _0x10171=_0xa677fd;_0xf52ffb[_0x10c8b3[_0x10171(0x207)]]=_0x10c8b3['rate'];}),_0xf52ffb;}catch(_0x16edbc){return console[_0xa677fd(0x211)](_0xa677fd(0x209),_0x16edbc),{'usdt':0x1};}}async[a38_0x32faba(0x1f3)](){const _0x335ffa=a38_0x32faba;try{const [_0x2b74f8,_0xe1df74,_0x2d4649]=await Promise[_0x335ffa(0x1e0)]([database_1[_0x335ffa(0x227)]['currencyRate'][_0x335ffa(0x1c0)](),database_1[_0x335ffa(0x227)][_0x335ffa(0x22a)][_0x335ffa(0x21d)]({'orderBy':{'updatedAt':_0x335ffa(0x1d1)},'select':{'updatedAt':!![]}}),database_1[_0x335ffa(0x227)][_0x335ffa(0x22a)]['findFirst']({'orderBy':{'updatedAt':_0x335ffa(0x20b)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2b74f8,'lastUpdated':_0xe1df74?.[_0x335ffa(0x205)]||null,'oldestRate':_0x2d4649?.['updatedAt']||null,'markupPercentage':this[_0x335ffa(0x220)]};}catch(_0x2b2f42){return console[_0x335ffa(0x211)](_0x335ffa(0x1e8),_0x2b2f42),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x335ffa(0x220)]};}}['getMarkupPercentage'](){const _0x469ada=a38_0x32faba;return this[_0x469ada(0x220)];}}function a38_0x36a0(){const _0x201507=['%\x20markup\x20to\x20','?ids=tether&vs_currencies=','\x20USDT\x20=\x20','../config/database','1305719vbEXPC','498txuGld','stopPeriodicUpdates','mxn','xlm','\x20USDT','CURRENCIES','clp','No\x20rate\x20found\x20for\x20currency:\x20','desc','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','upsert','Failed\x20to\x20update\x20rate\x20for\x20','aud','uah','üìä\x20Received\x20rates\x20for\x20','getCurrencyRate','link','bnb','nok','length','aed','convertMultipleToUSDT','currencyService','all','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','usdt','rate','Periodic\x20currency\x20rates\x20update\x20failed:','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','xrp','8460PKszzG','Error\x20getting\x20rates\x20status:','toUpperCase','myr','yfi','\x20currencies','status','log','ngn','bmd','Initial\x20currency\x20rates\x20update\x20failed:','72DfrFVd','getRatesStatus','gbp','toFixed','vnd','catch','616245snedeb','CurrencyService','5667606IlrALW','\x20USDT\x20(rate:\x20','COINGECKO_URL','ils','üí±\x20Applied\x20','allSettled','jpy','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','tether','join','mmk','updatedAt','zar','currency','huf','Error\x20getting\x20all\x20rates:','\x20USDT,\x20with\x20','asc','__importDefault','23481200ZJvopO','xag','nzd','6806nhbVXk','error','bits','convertToUSDT','sgd','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','bhd','2435xGCYIT','bdt','updateCurrencyRates','entries','updateInterval','hkd','findFirst','application/json','dkk','MARKUP_PERCENTAGE','vef','statusText','Error\x20converting\x20','xau','Error\x20getting\x20rate\x20for\x20currency\x20','chf','default','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','try','currencyRate','https://api.coingecko.com/api/v3/simple/price','pln','inr','toLowerCase','btc','findUnique','__esModule','eth','gel','getAllRates','sats','eur','10286856vYTxMt','TesSoft\x20Payment\x20System/1.0','lkr','usd','idr','bch','xdr','üí±\x20Converted\x20','ars','json','count','findMany','defineProperty','startPeriodicUpdates'];a38_0x36a0=function(){return _0x201507;};return a38_0x36a0();}exports[a38_0x32faba(0x1f9)]=CurrencyService,exports[a38_0x32faba(0x1df)]=new CurrencyService();