'use strict';const a38_0x1938ed=a38_0x4629;(function(_0x13442c,_0x452df9){const _0x4ec962=a38_0x4629,_0x309338=_0x13442c();while(!![]){try{const _0x3a792c=parseInt(_0x4ec962(0x173))/0x1*(parseInt(_0x4ec962(0x153))/0x2)+-parseInt(_0x4ec962(0x176))/0x3+parseInt(_0x4ec962(0x1b1))/0x4+-parseInt(_0x4ec962(0x145))/0x5*(-parseInt(_0x4ec962(0x192))/0x6)+parseInt(_0x4ec962(0x1ae))/0x7*(-parseInt(_0x4ec962(0x1a1))/0x8)+-parseInt(_0x4ec962(0x1a0))/0x9*(-parseInt(_0x4ec962(0x19b))/0xa)+parseInt(_0x4ec962(0x146))/0xb*(-parseInt(_0x4ec962(0x14d))/0xc);if(_0x3a792c===_0x452df9)break;else _0x309338['push'](_0x309338['shift']());}catch(_0x950307){_0x309338['push'](_0x309338['shift']());}}}(a38_0x24c8,0xaad51));function a38_0x24c8(){const _0xddd085=['\x20USDT\x20=\x20','1614aQKpuZ','clp','idr','findFirst','Error\x20getting\x20rates\x20status:','Failed\x20to\x20update\x20rate\x20for\x20','bits','error','MARKUP_PERCENTAGE','332330WxAwWI','brl','convertToUSDT','dot','pkr','117MoAWwE','8KkeDGA','xag','updateCurrencyRates','jpy','eur','sgd','xrp','desc','uah','stopPeriodicUpdates','✅\x20Currency\x20rates\x20updated\x20successfully','No\x20rate\x20found\x20for\x20currency:\x20','\x20USDT,\x20with\x20','2771545mVolAs','hkd','currencyRate','2777992QZwsll','xdr','mxn','COINGECKO_URL','statusText','status','upsert','Error\x20getting\x20all\x20rates:','bnb','thb','cad','aed','bmd','currency','usd','__esModule','4840joTgdM','473cxDbjW','defineProperty','nok','log','ngn',',\x20using\x201\x20as\x20fallback','myr','188472vWfbci','aud','usdt','%\x20markup\x20=\x20','startPeriodicUpdates','convertMultipleToUSDT','2ugXaiD','bhd','https://api.coingecko.com/api/v3/simple/price','updatedAt','updateInterval','ars','toLowerCase','CoinGecko\x20API\x20error:\x20','getCurrencyRate','keys','TesSoft\x20Payment\x20System/1.0','?ids=tether&vs_currencies=','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','tether','rate','inr','rub','twd','currencyService','Initial\x20currency\x20rates\x20update\x20failed:','chf','cny','toFixed','findMany','vef','allSettled','CurrencyService','Error\x20getting\x20rate\x20for\x20currency\x20','map','Periodic\x20currency\x20rates\x20update\x20failed:','czk','bdt','1257065LrcgPf','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','php','2618886bEjzTe','__importDefault','kwd','length','dkk','\x20to\x20USDT:','eth','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','../config/database','\x20USDT\x20(rate:\x20','application/json','sats','lkr','btc','all','default','getMarkupPercentage','\x20currencies','sek','📊\x20Received\x20rates\x20for\x20','💱\x20Applied\x20','CURRENCIES','entries','try','xlm','❌\x20Failed\x20to\x20update\x20currency\x20rates:','count'];a38_0x24c8=function(){return _0xddd085;};return a38_0x24c8();}var __importDefault=this&&this[a38_0x1938ed(0x177)]||function(_0x31c5b4){const _0x4204b0=a38_0x1938ed;return _0x31c5b4&&_0x31c5b4[_0x4204b0(0x144)]?_0x31c5b4:{'default':_0x31c5b4};};function a38_0x4629(_0x2bccf3,_0x440a17){const _0x24c843=a38_0x24c8();return a38_0x4629=function(_0x4629ef,_0xeb8b53){_0x4629ef=_0x4629ef-0x13d;let _0x5d2aed=_0x24c843[_0x4629ef];return _0x5d2aed;},a38_0x4629(_0x2bccf3,_0x440a17);}Object[a38_0x1938ed(0x147)](exports,a38_0x1938ed(0x144),{'value':!![]}),exports[a38_0x1938ed(0x165)]=exports[a38_0x1938ed(0x16d)]=void 0x0;const database_1=__importDefault(require(a38_0x1938ed(0x17e)));class CurrencyService{constructor(){const _0x16f2f4=a38_0x1938ed;this[_0x16f2f4(0x1b4)]=_0x16f2f4(0x155),this['CURRENCIES']=[_0x16f2f4(0x183),_0x16f2f4(0x17c),'ltc','bch',_0x16f2f4(0x13d),'eos',_0x16f2f4(0x1a7),_0x16f2f4(0x18e),'link',_0x16f2f4(0x19e),'yfi',_0x16f2f4(0x143),_0x16f2f4(0x140),_0x16f2f4(0x158),_0x16f2f4(0x14e),_0x16f2f4(0x172),_0x16f2f4(0x154),_0x16f2f4(0x141),_0x16f2f4(0x19c),_0x16f2f4(0x13f),_0x16f2f4(0x167),_0x16f2f4(0x193),_0x16f2f4(0x168),_0x16f2f4(0x171),_0x16f2f4(0x17a),_0x16f2f4(0x1a5),'gbp','gel',_0x16f2f4(0x1af),'huf',_0x16f2f4(0x194),'ils',_0x16f2f4(0x162),_0x16f2f4(0x1a4),'krw',_0x16f2f4(0x178),_0x16f2f4(0x182),'mmk',_0x16f2f4(0x1b3),_0x16f2f4(0x14c),_0x16f2f4(0x14a),_0x16f2f4(0x148),'nzd',_0x16f2f4(0x175),_0x16f2f4(0x19f),'pln',_0x16f2f4(0x163),'sar',_0x16f2f4(0x188),_0x16f2f4(0x1a6),_0x16f2f4(0x13e),_0x16f2f4(0x18d),_0x16f2f4(0x164),_0x16f2f4(0x1a9),_0x16f2f4(0x16b),'vnd','zar',_0x16f2f4(0x1b2),_0x16f2f4(0x1a2),'xau',_0x16f2f4(0x198),_0x16f2f4(0x181)],this[_0x16f2f4(0x157)]=null,this[_0x16f2f4(0x19a)]=0x3,this[_0x16f2f4(0x151)]();}[a38_0x1938ed(0x151)](){const _0x5d0e73=a38_0x1938ed;this['updateCurrencyRates']()['catch'](_0x15c8a5=>{const _0x60681=a38_0x4629;console['error'](_0x60681(0x166),_0x15c8a5);}),this[_0x5d0e73(0x157)]=setInterval(async()=>{const _0x11cb1f=_0x5d0e73;try{await this['updateCurrencyRates']();}catch(_0x2678a8){console['error'](_0x11cb1f(0x170),_0x2678a8);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x1938ed(0x1aa)](){const _0x1c773a=a38_0x1938ed;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x1c773a(0x157)]=null,console['log'](_0x1c773a(0x15f)));}async[a38_0x1938ed(0x1a3)](){const _0x59ee36=a38_0x1938ed;try{console[_0x59ee36(0x149)](_0x59ee36(0x174));const _0x16772f=this[_0x59ee36(0x18b)]['join'](','),_0x3baa78=this['COINGECKO_URL']+_0x59ee36(0x15e)+_0x16772f,_0x3f552d=await fetch(_0x3baa78,{'headers':{'Accept':_0x59ee36(0x180),'User-Agent':_0x59ee36(0x15d)}});if(!_0x3f552d['ok'])throw new Error(_0x59ee36(0x15a)+_0x3f552d[_0x59ee36(0x1b6)]+'\x20'+_0x3f552d[_0x59ee36(0x1b5)]);const _0x12d8a2=await _0x3f552d['json']();if(!_0x12d8a2[_0x59ee36(0x160)])throw new Error(_0x59ee36(0x17d));const _0x238983=_0x12d8a2[_0x59ee36(0x160)];console['log'](_0x59ee36(0x189)+Object[_0x59ee36(0x15c)](_0x238983)[_0x59ee36(0x179)]+_0x59ee36(0x187));const _0x377409=Object[_0x59ee36(0x18c)](_0x238983)[_0x59ee36(0x16f)](async([_0x1e1768,_0x109765])=>{const _0x295226=_0x59ee36;try{await database_1['default'][_0x295226(0x1b0)][_0x295226(0x1b7)]({'where':{'currency':_0x1e1768['toLowerCase']()},'update':{'rate':_0x109765},'create':{'currency':_0x1e1768[_0x295226(0x159)](),'rate':_0x109765}});}catch(_0x5cb529){console['error'](_0x295226(0x197)+_0x1e1768+':',_0x5cb529);}});await Promise[_0x59ee36(0x16c)](_0x377409),console['log'](_0x59ee36(0x1ab));}catch(_0x32c336){console[_0x59ee36(0x199)](_0x59ee36(0x18f),_0x32c336);throw _0x32c336;}}async['getCurrencyRate'](_0x34fc03){const _0x269652=a38_0x1938ed,_0x407a6c=_0x34fc03[_0x269652(0x159)]();if(_0x407a6c===_0x269652(0x14f))return 0x1;try{const _0x57dd3d=await database_1[_0x269652(0x185)][_0x269652(0x1b0)]['findUnique']({'where':{'currency':_0x407a6c}});if(!_0x57dd3d)return console['warn'](_0x269652(0x1ac)+_0x34fc03+_0x269652(0x14b)),0x1;return _0x57dd3d['rate'];}catch(_0x3a9126){return console['error'](_0x269652(0x16e)+_0x34fc03+':',_0x3a9126),0x1;}}async[a38_0x1938ed(0x19d)](_0x150be2,_0x40091d){const _0x5a8490=a38_0x1938ed,_0x3c9012=_0x40091d[_0x5a8490(0x159)]();if(_0x3c9012===_0x5a8490(0x14f)){const _0x19e1a2=_0x150be2*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5a8490(0x149)](_0x5a8490(0x18a)+this[_0x5a8490(0x19a)]+'%\x20markup\x20to\x20'+_0x150be2+_0x5a8490(0x191)+_0x19e1a2['toFixed'](0x6)+'\x20USDT'),_0x19e1a2;}try{const _0x4e0c93=await this[_0x5a8490(0x15b)](_0x3c9012),_0x273079=_0x150be2/_0x4e0c93,_0x5127b5=_0x273079*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x5a8490(0x149)]('💱\x20Converted\x20'+_0x150be2+'\x20'+_0x40091d['toUpperCase']()+'\x20to\x20'+_0x273079['toFixed'](0x6)+_0x5a8490(0x1ad)+this['MARKUP_PERCENTAGE']+_0x5a8490(0x150)+_0x5127b5[_0x5a8490(0x169)](0x6)+_0x5a8490(0x17f)+_0x4e0c93+')'),_0x5127b5;}catch(_0x437b9b){console[_0x5a8490(0x199)]('Error\x20converting\x20'+_0x150be2+'\x20'+_0x40091d+_0x5a8490(0x17b),_0x437b9b);const _0x53c384=_0x150be2*(0x1+this[_0x5a8490(0x19a)]/0x64);return _0x53c384;}}async[a38_0x1938ed(0x152)](_0x1ed98e){const _0x18f0b6=a38_0x1938ed;let _0x3be2b6=0x0;for(const {amount:_0x129c1a,currency:_0x5d5d3a}of _0x1ed98e){const _0x5f2151=await this[_0x18f0b6(0x19d)](_0x129c1a,_0x5d5d3a);_0x3be2b6+=_0x5f2151;}return _0x3be2b6;}async['getAllRates'](){const _0x1003d3=a38_0x1938ed;try{const _0x3b0542=await database_1[_0x1003d3(0x185)]['currencyRate'][_0x1003d3(0x16a)]({'select':{'currency':!![],'rate':!![]}}),_0x259bc2={'usdt':0x1};return _0x3b0542['forEach'](_0x1e20e4=>{const _0x154aba=_0x1003d3;_0x259bc2[_0x1e20e4[_0x154aba(0x142)]]=_0x1e20e4[_0x154aba(0x161)];}),_0x259bc2;}catch(_0x5ebaa5){return console[_0x1003d3(0x199)](_0x1003d3(0x1b8),_0x5ebaa5),{'usdt':0x1};}}async['getRatesStatus'](){const _0x1031a9=a38_0x1938ed;try{const [_0x3e117d,_0xa81c91,_0xde1778]=await Promise[_0x1031a9(0x184)]([database_1[_0x1031a9(0x185)][_0x1031a9(0x1b0)][_0x1031a9(0x190)](),database_1[_0x1031a9(0x185)][_0x1031a9(0x1b0)][_0x1031a9(0x195)]({'orderBy':{'updatedAt':_0x1031a9(0x1a8)},'select':{'updatedAt':!![]}}),database_1[_0x1031a9(0x185)][_0x1031a9(0x1b0)][_0x1031a9(0x195)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3e117d,'lastUpdated':_0xa81c91?.[_0x1031a9(0x156)]||null,'oldestRate':_0xde1778?.[_0x1031a9(0x156)]||null,'markupPercentage':this[_0x1031a9(0x19a)]};}catch(_0x57b134){return console[_0x1031a9(0x199)](_0x1031a9(0x196),_0x57b134),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x1938ed(0x186)](){const _0x7f7034=a38_0x1938ed;return this[_0x7f7034(0x19a)];}}exports[a38_0x1938ed(0x16d)]=CurrencyService,exports['currencyService']=new CurrencyService();