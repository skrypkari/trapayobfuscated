'use strict';function a38_0x3896(){const _0x127933=['zar','count','all','mmk','tether','ngn','huf','getMarkupPercentage','toUpperCase','❌\x20Failed\x20to\x20update\x20currency\x20rates:','gel','btc','updateCurrencyRates','clp','statusText','Periodic\x20currency\x20rates\x20update\x20failed:','currency','Failed\x20to\x20update\x20rate\x20for\x20','dot','uah','\x20USDT','warn','sgd','stopPeriodicUpdates','gbp','💱\x20Applied\x20','convertToUSDT','asc','toFixed','3151701OHoaqk','sar','currencyRate','nzd','lkr','12447600ORUjVU','MARKUP_PERCENTAGE','toLowerCase','convertMultipleToUSDT','https://api.coingecko.com/api/v3/simple/price','mxn','ils','default',',\x20using\x201\x20as\x20fallback','allSettled','sek','45LgJDyn','bmd','21065odeDAP','twd','%\x20markup\x20=\x20','entries','bits','dkk','try','18clsVAZ','inr','map','usd','getCurrencyRate','2644872APTOZW','ltc','CurrencyService','thb','\x20USDT,\x20with\x20','286194aWBdyk','xau','rate','pln','bdt','xdr','nok','Error\x20getting\x20rates\x20status:','upsert','updatedAt','\x20to\x20USDT:','ars','findMany','startPeriodicUpdates','4636662JrVFVi','eth','findFirst','%\x20markup\x20to\x20','__esModule','297404YjWYPy','link','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','COINGECKO_URL','Error\x20getting\x20all\x20rates:','length','2hfYXBa','aud','bhd','status','../config/database','cad','💱\x20Converted\x20','xrp','eur','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','defineProperty','error','updateInterval','php','vef','rub','xlm','cny','\x20USDT\x20(rate:\x20','getRatesStatus','log','catch','kwd','TesSoft\x20Payment\x20System/1.0','bnb','CURRENCIES'];a38_0x3896=function(){return _0x127933;};return a38_0x3896();}const a38_0x5f5392=a38_0x1dcd;(function(_0x5cd455,_0x272b79){const _0x175e55=a38_0x1dcd,_0x177cdc=_0x5cd455();while(!![]){try{const _0x52160a=-parseInt(_0x175e55(0xf1))/0x1+parseInt(_0x175e55(0xa8))/0x2*(parseInt(_0x175e55(0x102))/0x3)+parseInt(_0x175e55(0xa2))/0x4*(parseInt(_0x175e55(0xef))/0x5)+parseInt(_0x175e55(0x9d))/0x6+-parseInt(_0x175e55(0xdf))/0x7+parseInt(_0x175e55(0xfd))/0x8*(parseInt(_0x175e55(0xf8))/0x9)+-parseInt(_0x175e55(0xe4))/0xa;if(_0x52160a===_0x272b79)break;else _0x177cdc['push'](_0x177cdc['shift']());}catch(_0x39f576){_0x177cdc['push'](_0x177cdc['shift']());}}}(a38_0x3896,0x75cb4));var __importDefault=this&&this['__importDefault']||function(_0x363819){return _0x363819&&_0x363819['__esModule']?_0x363819:{'default':_0x363819};};Object[a38_0x5f5392(0xb2)](exports,a38_0x5f5392(0xa1),{'value':!![]}),exports['currencyService']=exports[a38_0x5f5392(0xff)]=void 0x0;const database_1=__importDefault(require(a38_0x5f5392(0xac)));function a38_0x1dcd(_0x552c50,_0x3e55d1){const _0x38968a=a38_0x3896();return a38_0x1dcd=function(_0x1dcd58,_0x35be2a){_0x1dcd58=_0x1dcd58-0x97;let _0x59c03a=_0x38968a[_0x1dcd58];return _0x59c03a;},a38_0x1dcd(_0x552c50,_0x3e55d1);}class CurrencyService{constructor(){const _0xc71c4d=a38_0x5f5392;this[_0xc71c4d(0xa5)]=_0xc71c4d(0xe8),this[_0xc71c4d(0xc1)]=[_0xc71c4d(0xcd),_0xc71c4d(0x9e),_0xc71c4d(0xfe),'bch',_0xc71c4d(0xc0),'eos',_0xc71c4d(0xaf),_0xc71c4d(0xb8),_0xc71c4d(0xa3),_0xc71c4d(0xd4),'yfi',_0xc71c4d(0xfb),'aed',_0xc71c4d(0x9a),_0xc71c4d(0xa9),_0xc71c4d(0x106),_0xc71c4d(0xaa),_0xc71c4d(0xf0),'brl',_0xc71c4d(0xad),'chf',_0xc71c4d(0xcf),_0xc71c4d(0xb9),'czk',_0xc71c4d(0xf6),_0xc71c4d(0xb0),_0xc71c4d(0xda),_0xc71c4d(0xcc),'hkd',_0xc71c4d(0xc8),'idr',_0xc71c4d(0xea),_0xc71c4d(0xf9),'jpy','krw',_0xc71c4d(0xbe),_0xc71c4d(0xe3),_0xc71c4d(0xc5),_0xc71c4d(0xe9),'myr',_0xc71c4d(0xc7),_0xc71c4d(0x108),_0xc71c4d(0xe2),_0xc71c4d(0xb5),'pkr',_0xc71c4d(0x105),_0xc71c4d(0xb7),_0xc71c4d(0xe0),_0xc71c4d(0xee),_0xc71c4d(0xd8),_0xc71c4d(0x100),_0xc71c4d(0xf7),_0xc71c4d(0xf2),_0xc71c4d(0xd5),_0xc71c4d(0xb6),'vnd',_0xc71c4d(0xc2),_0xc71c4d(0x107),'xag',_0xc71c4d(0x103),_0xc71c4d(0xf5),'sats'],this[_0xc71c4d(0xb4)]=null,this[_0xc71c4d(0xe5)]=0x3,this['startPeriodicUpdates']();}[a38_0x5f5392(0x9c)](){const _0x57a65e=a38_0x5f5392;this['updateCurrencyRates']()[_0x57a65e(0xbd)](_0x423876=>{const _0x276d9c=_0x57a65e;console[_0x276d9c(0xb3)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x423876);}),this['updateInterval']=setInterval(async()=>{const _0x850eab=_0x57a65e;try{await this['updateCurrencyRates']();}catch(_0x1c4061){console['error'](_0x850eab(0xd1),_0x1c4061);}},0x3c*0x3c*0x3e8),console[_0x57a65e(0xbc)](_0x57a65e(0xa4));}[a38_0x5f5392(0xd9)](){const _0x3e3722=a38_0x5f5392;this[_0x3e3722(0xb4)]&&(clearInterval(this[_0x3e3722(0xb4)]),this[_0x3e3722(0xb4)]=null,console[_0x3e3722(0xbc)](_0x3e3722(0xb1)));}async[a38_0x5f5392(0xce)](){const _0x31b83f=a38_0x5f5392;try{console[_0x31b83f(0xbc)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x1367a4=this[_0x31b83f(0xc1)]['join'](','),_0x586a4a=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x1367a4,_0x34168f=await fetch(_0x586a4a,{'headers':{'Accept':'application/json','User-Agent':_0x31b83f(0xbf)}});if(!_0x34168f['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x34168f[_0x31b83f(0xab)]+'\x20'+_0x34168f[_0x31b83f(0xd0)]);const _0x25a064=await _0x34168f['json']();if(!_0x25a064[_0x31b83f(0xc6)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x2ef70a=_0x25a064[_0x31b83f(0xc6)];console[_0x31b83f(0xbc)]('📊\x20Received\x20rates\x20for\x20'+Object['keys'](_0x2ef70a)[_0x31b83f(0xa7)]+'\x20currencies');const _0x4d77fb=Object[_0x31b83f(0xf4)](_0x2ef70a)[_0x31b83f(0xfa)](async([_0x1f177c,_0x3dec2a])=>{const _0x39d90f=_0x31b83f;try{await database_1[_0x39d90f(0xeb)][_0x39d90f(0xe1)][_0x39d90f(0x97)]({'where':{'currency':_0x1f177c[_0x39d90f(0xe6)]()},'update':{'rate':_0x3dec2a},'create':{'currency':_0x1f177c[_0x39d90f(0xe6)](),'rate':_0x3dec2a}});}catch(_0x3ab787){console[_0x39d90f(0xb3)](_0x39d90f(0xd3)+_0x1f177c+':',_0x3ab787);}});await Promise[_0x31b83f(0xed)](_0x4d77fb),console[_0x31b83f(0xbc)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x531f08){console[_0x31b83f(0xb3)](_0x31b83f(0xcb),_0x531f08);throw _0x531f08;}}async[a38_0x5f5392(0xfc)](_0x52e81d){const _0x5f4abf=a38_0x5f5392,_0x2be27e=_0x52e81d[_0x5f4abf(0xe6)]();if(_0x2be27e==='usdt')return 0x1;try{const _0x1a145f=await database_1['default'][_0x5f4abf(0xe1)]['findUnique']({'where':{'currency':_0x2be27e}});if(!_0x1a145f)return console[_0x5f4abf(0xd7)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x52e81d+_0x5f4abf(0xec)),0x1;return _0x1a145f[_0x5f4abf(0x104)];}catch(_0x49376c){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x52e81d+':',_0x49376c),0x1;}}async[a38_0x5f5392(0xdc)](_0x37d23f,_0x40a76b){const _0x4d5e45=a38_0x5f5392,_0xa22a31=_0x40a76b[_0x4d5e45(0xe6)]();if(_0xa22a31==='usdt'){const _0x27aa03=_0x37d23f*(0x1+this[_0x4d5e45(0xe5)]/0x64);return console[_0x4d5e45(0xbc)](_0x4d5e45(0xdb)+this[_0x4d5e45(0xe5)]+_0x4d5e45(0xa0)+_0x37d23f+'\x20USDT\x20=\x20'+_0x27aa03[_0x4d5e45(0xde)](0x6)+_0x4d5e45(0xd6)),_0x27aa03;}try{const _0x24df07=await this[_0x4d5e45(0xfc)](_0xa22a31),_0x5eae9f=_0x37d23f/_0x24df07,_0x51b31=_0x5eae9f*(0x1+this[_0x4d5e45(0xe5)]/0x64);return console[_0x4d5e45(0xbc)](_0x4d5e45(0xae)+_0x37d23f+'\x20'+_0x40a76b[_0x4d5e45(0xca)]()+'\x20to\x20'+_0x5eae9f['toFixed'](0x6)+_0x4d5e45(0x101)+this[_0x4d5e45(0xe5)]+_0x4d5e45(0xf3)+_0x51b31[_0x4d5e45(0xde)](0x6)+_0x4d5e45(0xba)+_0x24df07+')'),_0x51b31;}catch(_0x4853ce){console[_0x4d5e45(0xb3)]('Error\x20converting\x20'+_0x37d23f+'\x20'+_0x40a76b+_0x4d5e45(0x99),_0x4853ce);const _0x15726b=_0x37d23f*(0x1+this[_0x4d5e45(0xe5)]/0x64);return _0x15726b;}}async[a38_0x5f5392(0xe7)](_0x32c90d){let _0x6c0405=0x0;for(const {amount:_0x2a900a,currency:_0xc7529b}of _0x32c90d){const _0x47c1ae=await this['convertToUSDT'](_0x2a900a,_0xc7529b);_0x6c0405+=_0x47c1ae;}return _0x6c0405;}async['getAllRates'](){const _0x295021=a38_0x5f5392;try{const _0x535f37=await database_1[_0x295021(0xeb)][_0x295021(0xe1)][_0x295021(0x9b)]({'select':{'currency':!![],'rate':!![]}}),_0x256052={'usdt':0x1};return _0x535f37['forEach'](_0x26ea42=>{const _0x4c2f21=_0x295021;_0x256052[_0x26ea42[_0x4c2f21(0xd2)]]=_0x26ea42[_0x4c2f21(0x104)];}),_0x256052;}catch(_0x1d9455){return console['error'](_0x295021(0xa6),_0x1d9455),{'usdt':0x1};}}async[a38_0x5f5392(0xbb)](){const _0x32fe53=a38_0x5f5392;try{const [_0x515406,_0x1d6d85,_0x36207e]=await Promise[_0x32fe53(0xc4)]([database_1[_0x32fe53(0xeb)]['currencyRate'][_0x32fe53(0xc3)](),database_1[_0x32fe53(0xeb)]['currencyRate'][_0x32fe53(0x9f)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x32fe53(0xeb)]['currencyRate'][_0x32fe53(0x9f)]({'orderBy':{'updatedAt':_0x32fe53(0xdd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x515406,'lastUpdated':_0x1d6d85?.[_0x32fe53(0x98)]||null,'oldestRate':_0x36207e?.['updatedAt']||null,'markupPercentage':this[_0x32fe53(0xe5)]};}catch(_0x4e74c0){return console[_0x32fe53(0xb3)](_0x32fe53(0x109),_0x4e74c0),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x5f5392(0xc9)](){const _0x2c527d=a38_0x5f5392;return this[_0x2c527d(0xe5)];}}exports[a38_0x5f5392(0xff)]=CurrencyService,exports['currencyService']=new CurrencyService();