'use strict';const a38_0x5c3bee=a38_0x5698;function a38_0xdcc2(){const _0x181f02=['mxn','336382QxUYSA','sats','\x20to\x20USDT:','lkr','❌\x20Failed\x20to\x20update\x20currency\x20rates:','all','currency','rub','bdt','xau','ltc','eos','2241120gXrKUT','allSettled','json','brl','16007189DZfogi','\x20USDT\x20=\x20','findUnique','desc','getCurrencyRate','nzd','jpy','gbp','6PbctBE','dkk','ngn','findFirst','cny','xag','ars','default','php','convertMultipleToUSDT','__esModule','COINGECKO_URL','sgd','💱\x20Applied\x20',',\x20using\x201\x20as\x20fallback','__importDefault','3nOgGhX','ils','\x20USDT','log','4097737xqLhJn','vef','📊\x20Received\x20rates\x20for\x20','updateInterval','application/json','yfi','toLowerCase','1866548qTLbsn','Error\x20getting\x20rates\x20status:','Error\x20converting\x20','bmd','tether','CURRENCIES','Periodic\x20currency\x20rates\x20update\x20failed:','✅\x20Currency\x20rates\x20updated\x20successfully','No\x20rate\x20found\x20for\x20currency:\x20','💱\x20Converted\x20','bnb','rate','convertToUSDT','bhd','link','currencyRate','11831096uhqdof','1082430msOZme','count','Error\x20getting\x20rate\x20for\x20currency\x20','vnd','gel','updatedAt','startPeriodicUpdates','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','dot','nok','xdr','asc','huf','updateCurrencyRates','chf','bch','cad','forEach','statusText','toFixed','aed','27akDBol','2wlQcrt','Failed\x20to\x20update\x20rate\x20for\x20','xrp','https://api.coingecko.com/api/v3/simple/price','upsert','CurrencyService','MARKUP_PERCENTAGE','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','usd','CoinGecko\x20API\x20error:\x20','\x20USDT,\x20with\x20','currencyService','hkd','keys','entries','try','inr','../config/database','\x20currencies','warn','btc','uah','toUpperCase','czk','map','krw','kwd','stopPeriodicUpdates','usdt','%\x20markup\x20=\x20','Error\x20getting\x20all\x20rates:','eth','error','join'];a38_0xdcc2=function(){return _0x181f02;};return a38_0xdcc2();}(function(_0x225ed1,_0x4cc7d7){const _0x2b7c95=a38_0x5698,_0x337dfa=_0x225ed1();while(!![]){try{const _0x37c004=-parseInt(_0x2b7c95(0x1b5))/0x1*(parseInt(_0x2b7c95(0x20f))/0x2)+-parseInt(_0x2b7c95(0x1dd))/0x3*(-parseInt(_0x2b7c95(0x1e8))/0x4)+parseInt(_0x2b7c95(0x1c1))/0x5+parseInt(_0x2b7c95(0x1cd))/0x6*(parseInt(_0x2b7c95(0x1e1))/0x7)+-parseInt(_0x2b7c95(0x1f8))/0x8+parseInt(_0x2b7c95(0x20e))/0x9*(-parseInt(_0x2b7c95(0x1f9))/0xa)+parseInt(_0x2b7c95(0x1c5))/0xb;if(_0x37c004===_0x4cc7d7)break;else _0x337dfa['push'](_0x337dfa['shift']());}catch(_0x88c219){_0x337dfa['push'](_0x337dfa['shift']());}}}(a38_0xdcc2,0xc715d));function a38_0x5698(_0x55ba34,_0x52832b){const _0xdcc276=a38_0xdcc2();return a38_0x5698=function(_0x5698c8,_0xbca24){_0x5698c8=_0x5698c8-0x1af;let _0x63fa2c=_0xdcc276[_0x5698c8];return _0x63fa2c;},a38_0x5698(_0x55ba34,_0x52832b);}var __importDefault=this&&this[a38_0x5c3bee(0x1dc)]||function(_0x54f538){const _0xce7649=a38_0x5c3bee;return _0x54f538&&_0x54f538[_0xce7649(0x1d7)]?_0x54f538:{'default':_0x54f538};};Object['defineProperty'](exports,a38_0x5c3bee(0x1d7),{'value':!![]}),exports[a38_0x5c3bee(0x21a)]=exports[a38_0x5c3bee(0x214)]=void 0x0;const database_1=__importDefault(require(a38_0x5c3bee(0x220)));class CurrencyService{constructor(){const _0x2bd456=a38_0x5c3bee;this[_0x2bd456(0x1d8)]=_0x2bd456(0x212),this[_0x2bd456(0x1ed)]=[_0x2bd456(0x223),_0x2bd456(0x1b1),_0x2bd456(0x1bf),_0x2bd456(0x208),_0x2bd456(0x1f2),_0x2bd456(0x1c0),_0x2bd456(0x211),'xlm',_0x2bd456(0x1f6),_0x2bd456(0x201),_0x2bd456(0x1e6),_0x2bd456(0x217),_0x2bd456(0x20d),_0x2bd456(0x1d3),'aud',_0x2bd456(0x1bd),_0x2bd456(0x1f5),_0x2bd456(0x1eb),_0x2bd456(0x1c4),_0x2bd456(0x209),_0x2bd456(0x207),'clp',_0x2bd456(0x1d1),_0x2bd456(0x226),_0x2bd456(0x1ce),'eur',_0x2bd456(0x1cc),_0x2bd456(0x1fd),_0x2bd456(0x21b),_0x2bd456(0x205),'idr',_0x2bd456(0x1de),_0x2bd456(0x21f),_0x2bd456(0x1cb),_0x2bd456(0x228),_0x2bd456(0x229),_0x2bd456(0x1b8),'mmk',_0x2bd456(0x1b4),'myr',_0x2bd456(0x1cf),_0x2bd456(0x202),_0x2bd456(0x1ca),_0x2bd456(0x1d5),'pkr','pln',_0x2bd456(0x1bc),'sar','sek',_0x2bd456(0x1d9),'thb',_0x2bd456(0x21e),'twd',_0x2bd456(0x224),_0x2bd456(0x1e2),_0x2bd456(0x1fc),'zar',_0x2bd456(0x203),_0x2bd456(0x1d2),_0x2bd456(0x1be),'bits',_0x2bd456(0x1b6)],this[_0x2bd456(0x1e4)]=null,this[_0x2bd456(0x215)]=0x3,this[_0x2bd456(0x1ff)]();}[a38_0x5c3bee(0x1ff)](){const _0x139748=a38_0x5c3bee;this[_0x139748(0x206)]()['catch'](_0x4caf70=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x4caf70);}),this['updateInterval']=setInterval(async()=>{const _0x13eeeb=_0x139748;try{await this['updateCurrencyRates']();}catch(_0xfc1002){console[_0x13eeeb(0x1b2)](_0x13eeeb(0x1ee),_0xfc1002);}},0x3c*0x3c*0x3e8),console[_0x139748(0x1e0)](_0x139748(0x200));}[a38_0x5c3bee(0x22a)](){const _0x58f31d=a38_0x5c3bee;this[_0x58f31d(0x1e4)]&&(clearInterval(this[_0x58f31d(0x1e4)]),this['updateInterval']=null,console[_0x58f31d(0x1e0)](_0x58f31d(0x216)));}async['updateCurrencyRates'](){const _0x7f198=a38_0x5c3bee;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x106eed=this[_0x7f198(0x1ed)][_0x7f198(0x1b3)](','),_0x540b5d=this[_0x7f198(0x1d8)]+'?ids=tether&vs_currencies='+_0x106eed,_0x3e4e88=await fetch(_0x540b5d,{'headers':{'Accept':_0x7f198(0x1e5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x3e4e88['ok'])throw new Error(_0x7f198(0x218)+_0x3e4e88['status']+'\x20'+_0x3e4e88[_0x7f198(0x20b)]);const _0xc082ed=await _0x3e4e88[_0x7f198(0x1c3)]();if(!_0xc082ed[_0x7f198(0x1ec)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x14487d=_0xc082ed[_0x7f198(0x1ec)];console[_0x7f198(0x1e0)](_0x7f198(0x1e3)+Object[_0x7f198(0x21c)](_0x14487d)['length']+_0x7f198(0x221));const _0x3c4185=Object[_0x7f198(0x21d)](_0x14487d)[_0x7f198(0x227)](async([_0x1a97eb,_0x49f0d3])=>{const _0xbc45b7=_0x7f198;try{await database_1[_0xbc45b7(0x1d4)][_0xbc45b7(0x1f7)][_0xbc45b7(0x213)]({'where':{'currency':_0x1a97eb[_0xbc45b7(0x1e7)]()},'update':{'rate':_0x49f0d3},'create':{'currency':_0x1a97eb[_0xbc45b7(0x1e7)](),'rate':_0x49f0d3}});}catch(_0x1da684){console[_0xbc45b7(0x1b2)](_0xbc45b7(0x210)+_0x1a97eb+':',_0x1da684);}});await Promise[_0x7f198(0x1c2)](_0x3c4185),console[_0x7f198(0x1e0)](_0x7f198(0x1ef));}catch(_0x56c9d7){console[_0x7f198(0x1b2)](_0x7f198(0x1b9),_0x56c9d7);throw _0x56c9d7;}}async[a38_0x5c3bee(0x1c9)](_0xe9d543){const _0x280d4e=a38_0x5c3bee,_0x1ddc11=_0xe9d543[_0x280d4e(0x1e7)]();if(_0x1ddc11===_0x280d4e(0x22b))return 0x1;try{const _0x14476d=await database_1[_0x280d4e(0x1d4)][_0x280d4e(0x1f7)][_0x280d4e(0x1c7)]({'where':{'currency':_0x1ddc11}});if(!_0x14476d)return console[_0x280d4e(0x222)](_0x280d4e(0x1f0)+_0xe9d543+_0x280d4e(0x1db)),0x1;return _0x14476d[_0x280d4e(0x1f3)];}catch(_0x3a105c){return console[_0x280d4e(0x1b2)](_0x280d4e(0x1fb)+_0xe9d543+':',_0x3a105c),0x1;}}async['convertToUSDT'](_0x479146,_0x57c231){const _0x544bd0=a38_0x5c3bee,_0x236183=_0x57c231[_0x544bd0(0x1e7)]();if(_0x236183==='usdt'){const _0x13ded0=_0x479146*(0x1+this[_0x544bd0(0x215)]/0x64);return console[_0x544bd0(0x1e0)](_0x544bd0(0x1da)+this[_0x544bd0(0x215)]+'%\x20markup\x20to\x20'+_0x479146+_0x544bd0(0x1c6)+_0x13ded0[_0x544bd0(0x20c)](0x6)+_0x544bd0(0x1df)),_0x13ded0;}try{const _0x46cc06=await this['getCurrencyRate'](_0x236183),_0x5e1a18=_0x479146/_0x46cc06,_0x4e6ef3=_0x5e1a18*(0x1+this[_0x544bd0(0x215)]/0x64);return console[_0x544bd0(0x1e0)](_0x544bd0(0x1f1)+_0x479146+'\x20'+_0x57c231[_0x544bd0(0x225)]()+'\x20to\x20'+_0x5e1a18[_0x544bd0(0x20c)](0x6)+_0x544bd0(0x219)+this[_0x544bd0(0x215)]+_0x544bd0(0x1af)+_0x4e6ef3[_0x544bd0(0x20c)](0x6)+'\x20USDT\x20(rate:\x20'+_0x46cc06+')'),_0x4e6ef3;}catch(_0x5b9aa1){console[_0x544bd0(0x1b2)](_0x544bd0(0x1ea)+_0x479146+'\x20'+_0x57c231+_0x544bd0(0x1b7),_0x5b9aa1);const _0x82b6fd=_0x479146*(0x1+this[_0x544bd0(0x215)]/0x64);return _0x82b6fd;}}async[a38_0x5c3bee(0x1d6)](_0x521d35){const _0x2c5d20=a38_0x5c3bee;let _0xce8378=0x0;for(const {amount:_0xa3fca4,currency:_0x28b309}of _0x521d35){const _0x217cbe=await this[_0x2c5d20(0x1f4)](_0xa3fca4,_0x28b309);_0xce8378+=_0x217cbe;}return _0xce8378;}async['getAllRates'](){const _0x37e37a=a38_0x5c3bee;try{const _0x48868e=await database_1['default'][_0x37e37a(0x1f7)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x5f369f={'usdt':0x1};return _0x48868e[_0x37e37a(0x20a)](_0x168282=>{const _0x1c9277=_0x37e37a;_0x5f369f[_0x168282[_0x1c9277(0x1bb)]]=_0x168282['rate'];}),_0x5f369f;}catch(_0xf4b2b0){return console[_0x37e37a(0x1b2)](_0x37e37a(0x1b0),_0xf4b2b0),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4dfcca=a38_0x5c3bee;try{const [_0x59696e,_0xde0656,_0x45ae6b]=await Promise[_0x4dfcca(0x1ba)]([database_1[_0x4dfcca(0x1d4)]['currencyRate'][_0x4dfcca(0x1fa)](),database_1[_0x4dfcca(0x1d4)][_0x4dfcca(0x1f7)][_0x4dfcca(0x1d0)]({'orderBy':{'updatedAt':_0x4dfcca(0x1c8)},'select':{'updatedAt':!![]}}),database_1[_0x4dfcca(0x1d4)]['currencyRate'][_0x4dfcca(0x1d0)]({'orderBy':{'updatedAt':_0x4dfcca(0x204)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x59696e,'lastUpdated':_0xde0656?.['updatedAt']||null,'oldestRate':_0x45ae6b?.[_0x4dfcca(0x1fe)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x519c44){return console[_0x4dfcca(0x1b2)](_0x4dfcca(0x1e9),_0x519c44),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4dfcca(0x215)]};}}['getMarkupPercentage'](){const _0x109602=a38_0x5c3bee;return this[_0x109602(0x215)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x5c3bee(0x21a)]=new CurrencyService();