'use strict';const a53_0x140064=a53_0x2a5f;(function(_0x2948e3,_0x330f56){const _0x312d47=a53_0x2a5f,_0x599a8b=_0x2948e3();while(!![]){try{const _0x47eb5b=-parseInt(_0x312d47(0x15d))/0x1+-parseInt(_0x312d47(0x13c))/0x2+-parseInt(_0x312d47(0x139))/0x3*(parseInt(_0x312d47(0x198))/0x4)+parseInt(_0x312d47(0x14d))/0x5+-parseInt(_0x312d47(0x191))/0x6*(-parseInt(_0x312d47(0x199))/0x7)+parseInt(_0x312d47(0x160))/0x8*(-parseInt(_0x312d47(0x145))/0x9)+parseInt(_0x312d47(0x188))/0xa*(parseInt(_0x312d47(0x18e))/0xb);if(_0x47eb5b===_0x330f56)break;else _0x599a8b['push'](_0x599a8b['shift']());}catch(_0x20776d){_0x599a8b['push'](_0x599a8b['shift']());}}}(a53_0x51ac,0xc1ec3));var __importDefault=this&&this[a53_0x140064(0x170)]||function(_0x40cab8){const _0x3b7744=a53_0x140064;return _0x40cab8&&_0x40cab8[_0x3b7744(0x166)]?_0x40cab8:{'default':_0x40cab8};};Object[a53_0x140064(0x186)](exports,a53_0x140064(0x166),{'value':!![]}),exports[a53_0x140064(0x128)]=exports[a53_0x140064(0x14c)]=void 0x0;const database_1=__importDefault(require(a53_0x140064(0x174)));function a53_0x2a5f(_0x975168,_0x571f7c){_0x975168=_0x975168-0x121;const _0x51aca0=a53_0x51ac();let _0x2a5f20=_0x51aca0[_0x975168];return _0x2a5f20;}class CurrencyService{constructor(){const _0x50d0c2=a53_0x140064;this[_0x50d0c2(0x179)]='https://api.coingecko.com/api/v3/simple/price',this[_0x50d0c2(0x15f)]=['btc',_0x50d0c2(0x19b),_0x50d0c2(0x173),_0x50d0c2(0x18a),'bnb','eos',_0x50d0c2(0x15b),_0x50d0c2(0x184),'link','dot',_0x50d0c2(0x12b),_0x50d0c2(0x19e),_0x50d0c2(0x12e),_0x50d0c2(0x12a),_0x50d0c2(0x18d),_0x50d0c2(0x150),_0x50d0c2(0x182),_0x50d0c2(0x12f),_0x50d0c2(0x193),_0x50d0c2(0x192),_0x50d0c2(0x157),_0x50d0c2(0x181),_0x50d0c2(0x140),_0x50d0c2(0x14f),_0x50d0c2(0x165),_0x50d0c2(0x17a),_0x50d0c2(0x17e),'gel',_0x50d0c2(0x1a0),_0x50d0c2(0x171),_0x50d0c2(0x137),_0x50d0c2(0x133),_0x50d0c2(0x19c),'jpy','krw',_0x50d0c2(0x158),_0x50d0c2(0x149),'mmk',_0x50d0c2(0x1a4),_0x50d0c2(0x124),_0x50d0c2(0x126),'nok',_0x50d0c2(0x127),'php',_0x50d0c2(0x17b),_0x50d0c2(0x197),_0x50d0c2(0x153),'sar',_0x50d0c2(0x18b),_0x50d0c2(0x144),_0x50d0c2(0x13b),_0x50d0c2(0x143),'twd',_0x50d0c2(0x148),_0x50d0c2(0x16b),_0x50d0c2(0x17f),'zar',_0x50d0c2(0x18f),_0x50d0c2(0x151),_0x50d0c2(0x185),_0x50d0c2(0x12d),_0x50d0c2(0x195)],this[_0x50d0c2(0x123)]=null,this['MARKUP_PERCENTAGE']=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x4e1ad1=a53_0x140064;this[_0x4e1ad1(0x16a)]()[_0x4e1ad1(0x169)](_0x40dc09=>{const _0x3fe751=_0x4e1ad1;console[_0x3fe751(0x189)](_0x3fe751(0x183),_0x40dc09);}),this[_0x4e1ad1(0x123)]=setInterval(async()=>{const _0x236271=_0x4e1ad1;try{await this['updateCurrencyRates']();}catch(_0x470006){console[_0x236271(0x189)](_0x236271(0x156),_0x470006);}},0x3c*0x3c*0x3e8),console['log'](_0x4e1ad1(0x172));}[a53_0x140064(0x177)](){const _0x10a308=a53_0x140064;this[_0x10a308(0x123)]&&(clearInterval(this[_0x10a308(0x123)]),this['updateInterval']=null,console[_0x10a308(0x19f)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x488e2a=a53_0x140064;try{console[_0x488e2a(0x19f)](_0x488e2a(0x13e));const _0x30885e=this[_0x488e2a(0x15f)][_0x488e2a(0x138)](','),_0x11794e=this[_0x488e2a(0x179)]+_0x488e2a(0x196)+_0x30885e,_0x41cb94=await fetch(_0x11794e,{'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}});if(!_0x41cb94['ok'])throw new Error(_0x488e2a(0x130)+_0x41cb94[_0x488e2a(0x131)]+'\x20'+_0x41cb94['statusText']);const _0x154001=await _0x41cb94[_0x488e2a(0x141)]();if(!_0x154001[_0x488e2a(0x1a1)])throw new Error(_0x488e2a(0x175));const _0x3c38af=_0x154001[_0x488e2a(0x1a1)];console[_0x488e2a(0x19f)](_0x488e2a(0x13d)+Object[_0x488e2a(0x135)](_0x3c38af)[_0x488e2a(0x13a)]+_0x488e2a(0x163));const _0xe9d2ed=Object[_0x488e2a(0x14b)](_0x3c38af)[_0x488e2a(0x147)](async([_0x35cb8c,_0x4f9acf])=>{const _0x36ac50=_0x488e2a;try{await database_1[_0x36ac50(0x180)][_0x36ac50(0x164)][_0x36ac50(0x18c)]({'where':{'currency':_0x35cb8c[_0x36ac50(0x194)]()},'update':{'rate':_0x4f9acf},'create':{'currency':_0x35cb8c[_0x36ac50(0x194)](),'rate':_0x4f9acf}});}catch(_0x156241){console['error'](_0x36ac50(0x187)+_0x35cb8c+':',_0x156241);}});await Promise[_0x488e2a(0x16e)](_0xe9d2ed),console[_0x488e2a(0x19f)](_0x488e2a(0x152));}catch(_0x8a4585){console['error'](_0x488e2a(0x16d),_0x8a4585);throw _0x8a4585;}}async[a53_0x140064(0x17c)](_0x5248d3){const _0x25e4ee=a53_0x140064,_0x82879a=_0x5248d3[_0x25e4ee(0x194)]();if(_0x82879a==='usdt')return 0x1;try{const _0xf91fee=await database_1[_0x25e4ee(0x180)][_0x25e4ee(0x164)][_0x25e4ee(0x146)]({'where':{'currency':_0x82879a}});if(!_0xf91fee)return console[_0x25e4ee(0x129)](_0x25e4ee(0x14a)+_0x5248d3+_0x25e4ee(0x121)),0x1;return _0xf91fee[_0x25e4ee(0x134)];}catch(_0x29b146){return console[_0x25e4ee(0x189)](_0x25e4ee(0x122)+_0x5248d3+':',_0x29b146),0x1;}}async['convertToUSDT'](_0x10022b,_0x476017){const _0x21cc04=a53_0x140064,_0x43a3f4=_0x476017[_0x21cc04(0x194)]();if(_0x43a3f4===_0x21cc04(0x155)){const _0x3d8339=_0x10022b*(0x1+this[_0x21cc04(0x16f)]/0x64);return console[_0x21cc04(0x19f)](_0x21cc04(0x17d)+this[_0x21cc04(0x16f)]+_0x21cc04(0x162)+_0x10022b+'\x20USDT\x20=\x20'+_0x3d8339[_0x21cc04(0x142)](0x6)+'\x20USDT'),_0x3d8339;}try{const _0x222797=await this[_0x21cc04(0x17c)](_0x43a3f4),_0x2ed1b1=_0x10022b/_0x222797,_0xdcac13=_0x2ed1b1*(0x1+this[_0x21cc04(0x16f)]/0x64);return console['log'](_0x21cc04(0x19d)+_0x10022b+'\x20'+_0x476017[_0x21cc04(0x154)]()+'\x20to\x20'+_0x2ed1b1[_0x21cc04(0x142)](0x6)+_0x21cc04(0x132)+this[_0x21cc04(0x16f)]+_0x21cc04(0x12c)+_0xdcac13['toFixed'](0x6)+_0x21cc04(0x1a2)+_0x222797+')'),_0xdcac13;}catch(_0x347e5e){console['error'](_0x21cc04(0x178)+_0x10022b+'\x20'+_0x476017+_0x21cc04(0x15c),_0x347e5e);const _0x4902d8=_0x10022b*(0x1+this[_0x21cc04(0x16f)]/0x64);return _0x4902d8;}}async[a53_0x140064(0x125)](_0x29899e){const _0x41cbf9=a53_0x140064;let _0x503bbc=0x0;for(const {amount:_0x168ce,currency:_0x2b7fc9}of _0x29899e){const _0x3062b1=await this[_0x41cbf9(0x15e)](_0x168ce,_0x2b7fc9);_0x503bbc+=_0x3062b1;}return _0x503bbc;}async[a53_0x140064(0x1a3)](){const _0x16991f=a53_0x140064;try{const _0x4cbc20=await database_1['default'][_0x16991f(0x164)][_0x16991f(0x15a)]({'select':{'currency':!![],'rate':!![]}}),_0x37a8be={'usdt':0x1};return _0x4cbc20[_0x16991f(0x161)](_0x59741c=>{const _0x5547b5=_0x16991f;_0x37a8be[_0x59741c[_0x5547b5(0x167)]]=_0x59741c['rate'];}),_0x37a8be;}catch(_0x65dfdc){return console[_0x16991f(0x189)](_0x16991f(0x168),_0x65dfdc),{'usdt':0x1};}}async[a53_0x140064(0x16c)](){const _0x4cd98d=a53_0x140064;try{const [_0x320297,_0x421361,_0x444dbe]=await Promise[_0x4cd98d(0x159)]([database_1['default'][_0x4cd98d(0x164)][_0x4cd98d(0x136)](),database_1['default']['currencyRate'][_0x4cd98d(0x14e)]({'orderBy':{'updatedAt':_0x4cd98d(0x13f)},'select':{'updatedAt':!![]}}),database_1[_0x4cd98d(0x180)][_0x4cd98d(0x164)][_0x4cd98d(0x14e)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x320297,'lastUpdated':_0x421361?.[_0x4cd98d(0x19a)]||null,'oldestRate':_0x444dbe?.[_0x4cd98d(0x19a)]||null,'markupPercentage':this[_0x4cd98d(0x16f)]};}catch(_0x326546){return console[_0x4cd98d(0x189)](_0x4cd98d(0x176),_0x326546),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4cd98d(0x16f)]};}}[a53_0x140064(0x190)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a53_0x140064(0x128)]=new CurrencyService();function a53_0x51ac(){const _0x5f4121=['czk','bdt','xag','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','rub','toUpperCase','usdt','Periodic\x20currency\x20rates\x20update\x20failed:','chf','kwd','all','findMany','xrp','\x20to\x20USDT:','1272646vjuGsz','convertToUSDT','CURRENCIES','895864JUTOOn','forEach','%\x20markup\x20to\x20','\x20currencies','currencyRate','dkk','__esModule','currency','Error\x20getting\x20all\x20rates:','catch','updateCurrencyRates','vef','getRatesStatus','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','allSettled','MARKUP_PERCENTAGE','__importDefault','huf','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','ltc','../config/database','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','Error\x20getting\x20rates\x20status:','stopPeriodicUpdates','Error\x20converting\x20','COINGECKO_URL','eur','pkr','getCurrencyRate','üí±\x20Applied\x20','gbp','vnd','default','clp','bhd','Initial\x20currency\x20rates\x20update\x20failed:','xlm','xau','defineProperty','Failed\x20to\x20update\x20rate\x20for\x20','5930OBFonX','error','bch','sek','upsert','aud','63899teVIvv','xdr','getMarkupPercentage','2311674bsXNxx','cad','brl','toLowerCase','sats','?ids=tether&vs_currencies=','pln','152WAspaH','21KwjQnu','updatedAt','eth','inr','üí±\x20Converted\x20','usd','log','hkd','tether','\x20USDT\x20(rate:\x20','getAllRates','mxn',',\x20using\x201\x20as\x20fallback','Error\x20getting\x20rate\x20for\x20currency\x20','updateInterval','myr','convertMultipleToUSDT','ngn','nzd','currencyService','warn','ars','yfi','%\x20markup\x20=\x20','bits','aed','bmd','CoinGecko\x20API\x20error:\x20','status','\x20USDT,\x20with\x20','ils','rate','keys','count','idr','join','82599CQJpGg','length','thb','2429604uoMsdT','üìä\x20Received\x20rates\x20for\x20','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','desc','cny','json','toFixed','try','sgd','63GAKBEZ','findUnique','map','uah','lkr','No\x20rate\x20found\x20for\x20currency:\x20','entries','CurrencyService','2556580tytNEU','findFirst'];a53_0x51ac=function(){return _0x5f4121;};return a53_0x51ac();}