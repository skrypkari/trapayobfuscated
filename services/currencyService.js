'use strict';const a39_0x57f8f6=a39_0x4406;(function(_0x33d873,_0x45f206){const _0x2ac2b8=a39_0x4406,_0x17df67=_0x33d873();while(!![]){try{const _0x2fd8be=-parseInt(_0x2ac2b8(0x185))/0x1+-parseInt(_0x2ac2b8(0x196))/0x2*(-parseInt(_0x2ac2b8(0x1e5))/0x3)+parseInt(_0x2ac2b8(0x1ed))/0x4*(parseInt(_0x2ac2b8(0x1e7))/0x5)+parseInt(_0x2ac2b8(0x1ea))/0x6*(-parseInt(_0x2ac2b8(0x1fb))/0x7)+parseInt(_0x2ac2b8(0x18c))/0x8*(parseInt(_0x2ac2b8(0x1f5))/0x9)+-parseInt(_0x2ac2b8(0x19c))/0xa+-parseInt(_0x2ac2b8(0x19a))/0xb*(-parseInt(_0x2ac2b8(0x1c0))/0xc);if(_0x2fd8be===_0x45f206)break;else _0x17df67['push'](_0x17df67['shift']());}catch(_0x4a0689){_0x17df67['push'](_0x17df67['shift']());}}}(a39_0x36c4,0x21c0b));function a39_0x36c4(){const _0x5625d4=['vnd','uah','usdt','152624kvcqtf','upsert','findMany','gbp','264YNoAIi','CoinGecko\x20API\x20error:\x20','1387170aoaqPZ','error','MARKUP_PERCENTAGE','toUpperCase','hkd','currency','updateCurrencyRates','bnb',',\x20using\x201\x20as\x20fallback','huf','COINGECKO_URL','toLowerCase','Error\x20converting\x20','currencyRate','CurrencyService','\x20currencies','bmd','status','bdt','jpy','ltc','json','startPeriodicUpdates','No\x20rate\x20found\x20for\x20currency:\x20','join','xlm','\x20to\x20USDT:','updatedAt','asc','\x20to\x20','eos','aud','%\x20markup\x20to\x20','xau','rub','\x20USDT','79188gVNrhA','xdr','❌\x20Failed\x20to\x20update\x20currency\x20rates:','zar','getAllRates','clp','Periodic\x20currency\x20rates\x20update\x20failed:','__esModule','https://api.coingecko.com/api/v3/simple/price','dkk','krw','mxn','sgd','convertToUSDT','convertMultipleToUSDT','💱\x20Converted\x20','findUnique','btc','default','getCurrencyRate','warn','bch','\x20USDT\x20=\x20','💱\x20Applied\x20','nok','__importDefault','Error\x20getting\x20rates\x20status:','✅\x20Currency\x20rates\x20updated\x20successfully','eth','sek','pkr','aed','application/json','twd','updateInterval','📊\x20Received\x20rates\x20for\x20','forEach','3nKtmaJ','Initial\x20currency\x20rates\x20update\x20failed:','5AqIzwg','getMarkupPercentage','inr','2406JsxMYe','defineProperty','\x20USDT,\x20with\x20','715620fUxKYl','ars','try','brl','bhd','length','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','desc','9513iBETsW','toFixed','allSettled','chf','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','findFirst','1855gcJfrX','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Error\x20getting\x20rate\x20for\x20currency\x20','xrp','rate','lkr','stopPeriodicUpdates','statusText','?ids=tether&vs_currencies=','czk','gel','34588FwDQOs','count','eur','log','catch','xag','Error\x20getting\x20all\x20rates:','32KWxbsy','currencyService','tether','Failed\x20to\x20update\x20rate\x20for\x20','nzd','keys','CURRENCIES'];a39_0x36c4=function(){return _0x5625d4;};return a39_0x36c4();}var __importDefault=this&&this[a39_0x57f8f6(0x1d9)]||function(_0x2c8e1c){const _0x509e7a=a39_0x57f8f6;return _0x2c8e1c&&_0x2c8e1c[_0x509e7a(0x1c7)]?_0x2c8e1c:{'default':_0x2c8e1c};};Object[a39_0x57f8f6(0x1eb)](exports,a39_0x57f8f6(0x1c7),{'value':!![]}),exports['currencyService']=exports[a39_0x57f8f6(0x1aa)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x35bcab=a39_0x57f8f6;this['COINGECKO_URL']=_0x35bcab(0x1c8),this[_0x35bcab(0x192)]=[_0x35bcab(0x1d1),_0x35bcab(0x1dc),_0x35bcab(0x1b0),_0x35bcab(0x1d5),_0x35bcab(0x1a3),_0x35bcab(0x1ba),_0x35bcab(0x1fe),_0x35bcab(0x1b5),'link','dot','yfi','usd',_0x35bcab(0x1df),_0x35bcab(0x1ee),_0x35bcab(0x1bb),_0x35bcab(0x1ae),_0x35bcab(0x1f1),_0x35bcab(0x1ac),_0x35bcab(0x1f0),'cad',_0x35bcab(0x1f8),_0x35bcab(0x1c5),'cny',_0x35bcab(0x183),_0x35bcab(0x1c9),_0x35bcab(0x187),_0x35bcab(0x199),_0x35bcab(0x184),_0x35bcab(0x1a0),_0x35bcab(0x1a5),'idr','ils',_0x35bcab(0x1e9),_0x35bcab(0x1af),_0x35bcab(0x1ca),'kwd',_0x35bcab(0x200),'mmk',_0x35bcab(0x1cb),'myr','ngn',_0x35bcab(0x1d8),_0x35bcab(0x190),'php',_0x35bcab(0x1de),'pln',_0x35bcab(0x1be),'sar',_0x35bcab(0x1dd),_0x35bcab(0x1cc),'thb',_0x35bcab(0x1ef),_0x35bcab(0x1e1),_0x35bcab(0x194),'vef',_0x35bcab(0x193),_0x35bcab(0x1c3),_0x35bcab(0x1c1),_0x35bcab(0x18a),_0x35bcab(0x1bd),'bits','sats'],this[_0x35bcab(0x1e2)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x35bcab(0x1b2)]();}[a39_0x57f8f6(0x1b2)](){const _0x5bf936=a39_0x57f8f6;this[_0x5bf936(0x1a2)]()[_0x5bf936(0x189)](_0xe823d7=>{const _0x35b2a0=_0x5bf936;console[_0x35b2a0(0x19d)](_0x35b2a0(0x1e6),_0xe823d7);}),this[_0x5bf936(0x1e2)]=setInterval(async()=>{const _0x4b220b=_0x5bf936;try{await this[_0x4b220b(0x1a2)]();}catch(_0x2ea890){console['error'](_0x4b220b(0x1c6),_0x2ea890);}},0x3c*0x3c*0x3e8),console[_0x5bf936(0x188)](_0x5bf936(0x1f9));}[a39_0x57f8f6(0x201)](){const _0xfb66c8=a39_0x57f8f6;this[_0xfb66c8(0x1e2)]&&(clearInterval(this['updateInterval']),this[_0xfb66c8(0x1e2)]=null,console[_0xfb66c8(0x188)](_0xfb66c8(0x1f3)));}async['updateCurrencyRates'](){const _0x1d58e7=a39_0x57f8f6;try{console[_0x1d58e7(0x188)](_0x1d58e7(0x1fc));const _0x10deab=this[_0x1d58e7(0x192)][_0x1d58e7(0x1b4)](','),_0x437540=this[_0x1d58e7(0x1a6)]+_0x1d58e7(0x182)+_0x10deab,_0xac5aab=await fetch(_0x437540,{'headers':{'Accept':_0x1d58e7(0x1e0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0xac5aab['ok'])throw new Error(_0x1d58e7(0x19b)+_0xac5aab[_0x1d58e7(0x1ad)]+'\x20'+_0xac5aab[_0x1d58e7(0x181)]);const _0x21a270=await _0xac5aab[_0x1d58e7(0x1b1)]();if(!_0x21a270['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x5687b9=_0x21a270[_0x1d58e7(0x18e)];console['log'](_0x1d58e7(0x1e3)+Object[_0x1d58e7(0x191)](_0x5687b9)[_0x1d58e7(0x1f2)]+_0x1d58e7(0x1ab));const _0x13eb53=Object['entries'](_0x5687b9)['map'](async([_0x438445,_0x4e513c])=>{const _0x3c719c=_0x1d58e7;try{await database_1['default'][_0x3c719c(0x1a9)][_0x3c719c(0x197)]({'where':{'currency':_0x438445['toLowerCase']()},'update':{'rate':_0x4e513c},'create':{'currency':_0x438445['toLowerCase'](),'rate':_0x4e513c}});}catch(_0x411766){console[_0x3c719c(0x19d)](_0x3c719c(0x18f)+_0x438445+':',_0x411766);}});await Promise[_0x1d58e7(0x1f7)](_0x13eb53),console[_0x1d58e7(0x188)](_0x1d58e7(0x1db));}catch(_0x247107){console[_0x1d58e7(0x19d)](_0x1d58e7(0x1c2),_0x247107);throw _0x247107;}}async['getCurrencyRate'](_0x4ba08a){const _0x995f77=a39_0x57f8f6,_0xc9b137=_0x4ba08a[_0x995f77(0x1a7)]();if(_0xc9b137===_0x995f77(0x195))return 0x1;try{const _0x3fdfb3=await database_1[_0x995f77(0x1d2)][_0x995f77(0x1a9)][_0x995f77(0x1d0)]({'where':{'currency':_0xc9b137}});if(!_0x3fdfb3)return console[_0x995f77(0x1d4)](_0x995f77(0x1b3)+_0x4ba08a+_0x995f77(0x1a4)),0x1;return _0x3fdfb3['rate'];}catch(_0x3712bd){return console[_0x995f77(0x19d)](_0x995f77(0x1fd)+_0x4ba08a+':',_0x3712bd),0x1;}}async[a39_0x57f8f6(0x1cd)](_0x3ac23a,_0x5aee97){const _0x38ee54=a39_0x57f8f6,_0x16fc4a=_0x5aee97[_0x38ee54(0x1a7)]();if(_0x16fc4a===_0x38ee54(0x195)){const _0x2b60ed=_0x3ac23a*(0x1+this[_0x38ee54(0x19e)]/0x64);return console[_0x38ee54(0x188)](_0x38ee54(0x1d7)+this['MARKUP_PERCENTAGE']+_0x38ee54(0x1bc)+_0x3ac23a+_0x38ee54(0x1d6)+_0x2b60ed[_0x38ee54(0x1f6)](0x6)+_0x38ee54(0x1bf)),_0x2b60ed;}try{const _0x5df46b=await this[_0x38ee54(0x1d3)](_0x16fc4a),_0x57d191=_0x3ac23a/_0x5df46b,_0x445d30=_0x57d191*(0x1+this[_0x38ee54(0x19e)]/0x64);return console[_0x38ee54(0x188)](_0x38ee54(0x1cf)+_0x3ac23a+'\x20'+_0x5aee97[_0x38ee54(0x19f)]()+_0x38ee54(0x1b9)+_0x57d191[_0x38ee54(0x1f6)](0x6)+_0x38ee54(0x1ec)+this[_0x38ee54(0x19e)]+'%\x20markup\x20=\x20'+_0x445d30['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x5df46b+')'),_0x445d30;}catch(_0x197a74){console[_0x38ee54(0x19d)](_0x38ee54(0x1a8)+_0x3ac23a+'\x20'+_0x5aee97+_0x38ee54(0x1b6),_0x197a74);const _0x353db7=_0x3ac23a*(0x1+this[_0x38ee54(0x19e)]/0x64);return _0x353db7;}}async[a39_0x57f8f6(0x1ce)](_0x1b835a){let _0x27a66f=0x0;for(const {amount:_0x23cb26,currency:_0x503d15}of _0x1b835a){const _0x277dde=await this['convertToUSDT'](_0x23cb26,_0x503d15);_0x27a66f+=_0x277dde;}return _0x27a66f;}async[a39_0x57f8f6(0x1c4)](){const _0x3632fc=a39_0x57f8f6;try{const _0x36d622=await database_1['default'][_0x3632fc(0x1a9)][_0x3632fc(0x198)]({'select':{'currency':!![],'rate':!![]}}),_0x1c7f55={'usdt':0x1};return _0x36d622[_0x3632fc(0x1e4)](_0x2c9f26=>{const _0x17f6d3=_0x3632fc;_0x1c7f55[_0x2c9f26[_0x17f6d3(0x1a1)]]=_0x2c9f26[_0x17f6d3(0x1ff)];}),_0x1c7f55;}catch(_0x1dab51){return console['error'](_0x3632fc(0x18b),_0x1dab51),{'usdt':0x1};}}async['getRatesStatus'](){const _0x30a2d4=a39_0x57f8f6;try{const [_0x6f3bef,_0xc9d15b,_0x491144]=await Promise['all']([database_1[_0x30a2d4(0x1d2)][_0x30a2d4(0x1a9)][_0x30a2d4(0x186)](),database_1[_0x30a2d4(0x1d2)]['currencyRate'][_0x30a2d4(0x1fa)]({'orderBy':{'updatedAt':_0x30a2d4(0x1f4)},'select':{'updatedAt':!![]}}),database_1[_0x30a2d4(0x1d2)][_0x30a2d4(0x1a9)][_0x30a2d4(0x1fa)]({'orderBy':{'updatedAt':_0x30a2d4(0x1b8)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x6f3bef,'lastUpdated':_0xc9d15b?.['updatedAt']||null,'oldestRate':_0x491144?.[_0x30a2d4(0x1b7)]||null,'markupPercentage':this[_0x30a2d4(0x19e)]};}catch(_0x3a9ed9){return console[_0x30a2d4(0x19d)](_0x30a2d4(0x1da),_0x3a9ed9),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x30a2d4(0x19e)]};}}[a39_0x57f8f6(0x1e8)](){const _0x502fa4=a39_0x57f8f6;return this[_0x502fa4(0x19e)];}}function a39_0x4406(_0x206314,_0x5208fa){const _0x36c40c=a39_0x36c4();return a39_0x4406=function(_0x44063f,_0x197ab2){_0x44063f=_0x44063f-0x181;let _0x1a1b25=_0x36c40c[_0x44063f];return _0x1a1b25;},a39_0x4406(_0x206314,_0x5208fa);}exports['CurrencyService']=CurrencyService,exports[a39_0x57f8f6(0x18d)]=new CurrencyService();