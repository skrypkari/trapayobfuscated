'use strict';const a36_0x420ffb=a36_0x5b58;(function(_0x61ab1b,_0x401e98){const _0x2ef69b=a36_0x5b58,_0x37d556=_0x61ab1b();while(!![]){try{const _0x29c6cb=-parseInt(_0x2ef69b(0x227))/0x1*(-parseInt(_0x2ef69b(0x1d1))/0x2)+-parseInt(_0x2ef69b(0x230))/0x3+-parseInt(_0x2ef69b(0x1cf))/0x4+-parseInt(_0x2ef69b(0x1c2))/0x5+-parseInt(_0x2ef69b(0x1fb))/0x6+-parseInt(_0x2ef69b(0x1bd))/0x7*(parseInt(_0x2ef69b(0x235))/0x8)+-parseInt(_0x2ef69b(0x203))/0x9*(-parseInt(_0x2ef69b(0x1f5))/0xa);if(_0x29c6cb===_0x401e98)break;else _0x37d556['push'](_0x37d556['shift']());}catch(_0x351e91){_0x37d556['push'](_0x37d556['shift']());}}}(a36_0x2ee6,0x7d470));var __importDefault=this&&this['__importDefault']||function(_0x2a999c){const _0x520694=a36_0x5b58;return _0x2a999c&&_0x2a999c[_0x520694(0x20d)]?_0x2a999c:{'default':_0x2a999c};};function a36_0x2ee6(){const _0x12fab2=['\x20USDT\x20=\x20','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','findFirst','💱\x20Applied\x20','\x20USDT\x20(rate:\x20','toFixed','\x20USDT,\x20with\x20','sek','sgd','rate','rub','desc','yfi','bch','startPeriodicUpdates','php','No\x20rate\x20found\x20for\x20currency:\x20','btc','kwd','Periodic\x20currency\x20rates\x20update\x20failed:','stopPeriodicUpdates','Error\x20getting\x20rates\x20status:','https://api.coingecko.com/api/v3/simple/price','xag','xdr','getCurrencyRate','huf','currencyService','\x20currencies','\x20to\x20','zar','149470ZXXNTC','usd','CURRENCIES','xrp','dot','CoinGecko\x20API\x20error:\x20','1599498FhlTGN','?ids=tether&vs_currencies=','xau','usdt','ars','idr','bhd','%\x20markup\x20to\x20','1341zFFMWR','error','aud','cny','❌\x20Failed\x20to\x20update\x20currency\x20rates:','uah','currency','length','getMarkupPercentage','count','__esModule','defineProperty','convertMultipleToUSDT','ngn','log','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','mmk','aed','updatedAt','pkr','twd','default','updateInterval','nok','Initial\x20currency\x20rates\x20update\x20failed:','vef','Error\x20converting\x20','czk','eur','nzd','xlm','eos','brl','currencyRate','thb','tether','1908YHaolD','ils','💱\x20Converted\x20','convertToUSDT','map','%\x20markup\x20=\x20','dkk','getAllRates','entries','2424105YNUDIz','COINGECKO_URL','toLowerCase','ltc','CurrencyService','160CUYgMM','bdt','bnb','asc','warn','\x20to\x20USDT:',',\x20using\x201\x20as\x20fallback','forEach','all','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','71239DScyhI','MARKUP_PERCENTAGE','chf','status','catch','3553470SkXwlB','TesSoft\x20Payment\x20System/1.0','sats','clp','findMany','Error\x20getting\x20all\x20rates:','cad','toUpperCase','upsert','updateCurrencyRates','bmd','lkr','eth','693980jloYCb','gel','470dkxxMh','📊\x20Received\x20rates\x20for\x20','jpy','\x20USDT','bits'];a36_0x2ee6=function(){return _0x12fab2;};return a36_0x2ee6();}function a36_0x5b58(_0x38536d,_0x4b7044){const _0x2ee695=a36_0x2ee6();return a36_0x5b58=function(_0x5b5885,_0x3beedc){_0x5b5885=_0x5b5885-0x1b5;let _0x549e5f=_0x2ee695[_0x5b5885];return _0x549e5f;},a36_0x5b58(_0x38536d,_0x4b7044);}Object[a36_0x420ffb(0x20e)](exports,a36_0x420ffb(0x20d),{'value':!![]}),exports[a36_0x420ffb(0x1f1)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x3599c8=a36_0x420ffb;this[_0x3599c8(0x231)]=_0x3599c8(0x1ec),this[_0x3599c8(0x1f7)]=[_0x3599c8(0x1e7),_0x3599c8(0x1ce),_0x3599c8(0x233),_0x3599c8(0x1e3),_0x3599c8(0x1b5),_0x3599c8(0x222),_0x3599c8(0x1f8),_0x3599c8(0x221),'link',_0x3599c8(0x1f9),_0x3599c8(0x1e2),_0x3599c8(0x1f6),_0x3599c8(0x214),_0x3599c8(0x1ff),_0x3599c8(0x205),_0x3599c8(0x236),_0x3599c8(0x201),_0x3599c8(0x1cc),_0x3599c8(0x223),_0x3599c8(0x1c8),_0x3599c8(0x1bf),_0x3599c8(0x1c5),_0x3599c8(0x206),_0x3599c8(0x21e),_0x3599c8(0x22d),_0x3599c8(0x21f),'gbp',_0x3599c8(0x1d0),'hkd',_0x3599c8(0x1f0),_0x3599c8(0x200),_0x3599c8(0x228),'inr',_0x3599c8(0x1d3),'krw',_0x3599c8(0x1e8),_0x3599c8(0x1cd),_0x3599c8(0x213),'mxn','myr',_0x3599c8(0x210),_0x3599c8(0x21a),_0x3599c8(0x220),_0x3599c8(0x1e5),_0x3599c8(0x216),'pln',_0x3599c8(0x1e0),'sar',_0x3599c8(0x1dd),_0x3599c8(0x1de),_0x3599c8(0x225),'try',_0x3599c8(0x217),_0x3599c8(0x208),_0x3599c8(0x21c),'vnd',_0x3599c8(0x1f4),_0x3599c8(0x1ee),_0x3599c8(0x1ed),_0x3599c8(0x1fd),_0x3599c8(0x1d5),_0x3599c8(0x1c4)],this[_0x3599c8(0x219)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x3599c8(0x1e4)]();}[a36_0x420ffb(0x1e4)](){const _0x43745c=a36_0x420ffb;this[_0x43745c(0x1cb)]()[_0x43745c(0x1c1)](_0x5cb57f=>{const _0x3bb6c0=_0x43745c;console[_0x3bb6c0(0x204)](_0x3bb6c0(0x21b),_0x5cb57f);}),this['updateInterval']=setInterval(async()=>{const _0x32761d=_0x43745c;try{await this[_0x32761d(0x1cb)]();}catch(_0x1b39ca){console['error'](_0x32761d(0x1e9),_0x1b39ca);}},0x3c*0x3c*0x3e8),console[_0x43745c(0x211)](_0x43745c(0x212));}[a36_0x420ffb(0x1ea)](){const _0x4f14db=a36_0x420ffb;this['updateInterval']&&(clearInterval(this[_0x4f14db(0x219)]),this[_0x4f14db(0x219)]=null,console[_0x4f14db(0x211)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a36_0x420ffb(0x1cb)](){const _0x5a6a97=a36_0x420ffb;try{console[_0x5a6a97(0x211)](_0x5a6a97(0x1bc));const _0x3de85d=this['CURRENCIES']['join'](','),_0x370ccb=this['COINGECKO_URL']+_0x5a6a97(0x1fc)+_0x3de85d,_0x5a9f70=await fetch(_0x370ccb,{'headers':{'Accept':'application/json','User-Agent':_0x5a6a97(0x1c3)}});if(!_0x5a9f70['ok'])throw new Error(_0x5a6a97(0x1fa)+_0x5a9f70[_0x5a6a97(0x1c0)]+'\x20'+_0x5a9f70['statusText']);const _0x52f3e0=await _0x5a9f70['json']();if(!_0x52f3e0[_0x5a6a97(0x226)])throw new Error(_0x5a6a97(0x1d7));const _0x2c91b3=_0x52f3e0[_0x5a6a97(0x226)];console[_0x5a6a97(0x211)](_0x5a6a97(0x1d2)+Object['keys'](_0x2c91b3)[_0x5a6a97(0x20a)]+_0x5a6a97(0x1f2));const _0x390f0d=Object[_0x5a6a97(0x22f)](_0x2c91b3)[_0x5a6a97(0x22b)](async([_0x57282b,_0x56c0db])=>{const _0x2405c7=_0x5a6a97;try{await database_1['default'][_0x2405c7(0x224)][_0x2405c7(0x1ca)]({'where':{'currency':_0x57282b['toLowerCase']()},'update':{'rate':_0x56c0db},'create':{'currency':_0x57282b[_0x2405c7(0x232)](),'rate':_0x56c0db}});}catch(_0xdbd766){console[_0x2405c7(0x204)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x57282b+':',_0xdbd766);}});await Promise['allSettled'](_0x390f0d),console[_0x5a6a97(0x211)]('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x282cc3){console[_0x5a6a97(0x204)](_0x5a6a97(0x207),_0x282cc3);throw _0x282cc3;}}async['getCurrencyRate'](_0x2f7f80){const _0x3a7418=a36_0x420ffb,_0x20ca43=_0x2f7f80[_0x3a7418(0x232)]();if(_0x20ca43===_0x3a7418(0x1fe))return 0x1;try{const _0x4095b7=await database_1['default'][_0x3a7418(0x224)]['findUnique']({'where':{'currency':_0x20ca43}});if(!_0x4095b7)return console[_0x3a7418(0x1b7)](_0x3a7418(0x1e6)+_0x2f7f80+_0x3a7418(0x1b9)),0x1;return _0x4095b7[_0x3a7418(0x1df)];}catch(_0x2c15cc){return console[_0x3a7418(0x204)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x2f7f80+':',_0x2c15cc),0x1;}}async[a36_0x420ffb(0x22a)](_0x17b8c4,_0x502923){const _0x3c5b90=a36_0x420ffb,_0x2f8e6c=_0x502923[_0x3c5b90(0x232)]();if(_0x2f8e6c===_0x3c5b90(0x1fe)){const _0x48eb7e=_0x17b8c4*(0x1+this[_0x3c5b90(0x1be)]/0x64);return console['log'](_0x3c5b90(0x1d9)+this[_0x3c5b90(0x1be)]+_0x3c5b90(0x202)+_0x17b8c4+_0x3c5b90(0x1d6)+_0x48eb7e['toFixed'](0x6)+_0x3c5b90(0x1d4)),_0x48eb7e;}try{const _0x223744=await this[_0x3c5b90(0x1ef)](_0x2f8e6c),_0x325087=_0x17b8c4/_0x223744,_0x2935d1=_0x325087*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3c5b90(0x211)](_0x3c5b90(0x229)+_0x17b8c4+'\x20'+_0x502923[_0x3c5b90(0x1c9)]()+_0x3c5b90(0x1f3)+_0x325087[_0x3c5b90(0x1db)](0x6)+_0x3c5b90(0x1dc)+this[_0x3c5b90(0x1be)]+_0x3c5b90(0x22c)+_0x2935d1['toFixed'](0x6)+_0x3c5b90(0x1da)+_0x223744+')'),_0x2935d1;}catch(_0x24e8c7){console['error'](_0x3c5b90(0x21d)+_0x17b8c4+'\x20'+_0x502923+_0x3c5b90(0x1b8),_0x24e8c7);const _0x2462e4=_0x17b8c4*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x2462e4;}}async[a36_0x420ffb(0x20f)](_0x8be167){const _0x18d246=a36_0x420ffb;let _0x31e4e9=0x0;for(const {amount:_0x3860ca,currency:_0x437666}of _0x8be167){const _0xc23845=await this[_0x18d246(0x22a)](_0x3860ca,_0x437666);_0x31e4e9+=_0xc23845;}return _0x31e4e9;}async[a36_0x420ffb(0x22e)](){const _0x3bf965=a36_0x420ffb;try{const _0x3057f9=await database_1[_0x3bf965(0x218)][_0x3bf965(0x224)][_0x3bf965(0x1c6)]({'select':{'currency':!![],'rate':!![]}}),_0x2f288b={'usdt':0x1};return _0x3057f9[_0x3bf965(0x1ba)](_0x48bb1b=>{const _0x5ecc89=_0x3bf965;_0x2f288b[_0x48bb1b[_0x5ecc89(0x209)]]=_0x48bb1b[_0x5ecc89(0x1df)];}),_0x2f288b;}catch(_0x2af194){return console['error'](_0x3bf965(0x1c7),_0x2af194),{'usdt':0x1};}}async['getRatesStatus'](){const _0x4e39ee=a36_0x420ffb;try{const [_0x13d0e5,_0x29bd08,_0x51b92e]=await Promise[_0x4e39ee(0x1bb)]([database_1[_0x4e39ee(0x218)][_0x4e39ee(0x224)][_0x4e39ee(0x20c)](),database_1[_0x4e39ee(0x218)][_0x4e39ee(0x224)][_0x4e39ee(0x1d8)]({'orderBy':{'updatedAt':_0x4e39ee(0x1e1)},'select':{'updatedAt':!![]}}),database_1[_0x4e39ee(0x218)][_0x4e39ee(0x224)][_0x4e39ee(0x1d8)]({'orderBy':{'updatedAt':_0x4e39ee(0x1b6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x13d0e5,'lastUpdated':_0x29bd08?.[_0x4e39ee(0x215)]||null,'oldestRate':_0x51b92e?.[_0x4e39ee(0x215)]||null,'markupPercentage':this[_0x4e39ee(0x1be)]};}catch(_0x5ab9b1){return console[_0x4e39ee(0x204)](_0x4e39ee(0x1eb),_0x5ab9b1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4e39ee(0x1be)]};}}[a36_0x420ffb(0x20b)](){const _0x805cb8=a36_0x420ffb;return this[_0x805cb8(0x1be)];}}exports[a36_0x420ffb(0x234)]=CurrencyService,exports[a36_0x420ffb(0x1f1)]=new CurrencyService();