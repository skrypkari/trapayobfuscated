'use strict';const a49_0x502bcf=a49_0x5a8d;function a49_0x5a8d(_0xc83e9a,_0x53e443){_0xc83e9a=_0xc83e9a-0x18b;const _0x4e5cd5=a49_0x4e5c();let _0x5a8d48=_0x4e5cd5[_0xc83e9a];return _0x5a8d48;}(function(_0x3df041,_0x43d799){const _0x17b3f7=a49_0x5a8d,_0x4cd710=_0x3df041();while(!![]){try{const _0x322a09=parseInt(_0x17b3f7(0x1ae))/0x1+-parseInt(_0x17b3f7(0x1c2))/0x2+-parseInt(_0x17b3f7(0x1cd))/0x3+-parseInt(_0x17b3f7(0x19f))/0x4+-parseInt(_0x17b3f7(0x19d))/0x5*(parseInt(_0x17b3f7(0x1bf))/0x6)+-parseInt(_0x17b3f7(0x1ac))/0x7+parseInt(_0x17b3f7(0x18c))/0x8*(parseInt(_0x17b3f7(0x1a9))/0x9);if(_0x322a09===_0x43d799)break;else _0x4cd710['push'](_0x4cd710['shift']());}catch(_0x44ff1a){_0x4cd710['push'](_0x4cd710['shift']());}}}(a49_0x4e5c,0x7ed8f));var __importDefault=this&&this[a49_0x502bcf(0x1b2)]||function(_0x139f59){return _0x139f59&&_0x139f59['__esModule']?_0x139f59:{'default':_0x139f59};};Object[a49_0x502bcf(0x1a3)](exports,a49_0x502bcf(0x1c3),{'value':!![]}),exports[a49_0x502bcf(0x1f1)]=exports[a49_0x502bcf(0x1be)]=void 0x0;const database_1=__importDefault(require(a49_0x502bcf(0x1b4)));function a49_0x4e5c(){const _0x41d119=['mxn','czk','findFirst','myr','No\x20rate\x20found\x20for\x20currency:\x20','bmd','dkk','\x20to\x20','vnd','Error\x20converting\x20','forEach','rub','sgd','toLowerCase','log',',\x20using\x201\x20as\x20fallback','usdt','catch','eos','%\x20markup\x20=\x20','status','ngn','pln','startPeriodicUpdates','entries','currencyRate','currencyService','tether','convertToUSDT','link','error','chf','allSettled','\x20USDT','getMarkupPercentage','sats','vef','jpy','ars','\x20USDT\x20=\x20','16dNcCmV','huf','uah','findUnique','COINGECKO_URL','updateCurrencyRates','sar','desc','ltc','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','gbp','pkr','\x20to\x20USDT:','bdt','MARKUP_PERCENTAGE','php','5ioLxvO','brl','3312732rnVYKW','length','xag','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','defineProperty','zar','application/json','bits','Error\x20getting\x20rate\x20for\x20currency\x20','toFixed','16543503fHZmCS','eur','sek','659449klZmBV','\x20USDT,\x20with\x20','473693BgKVMQ','updatedAt','xlm','aud','__importDefault','Error\x20getting\x20rates\x20status:','../config/database','aed','?ids=tether&vs_currencies=','upsert','map','%\x20markup\x20to\x20','cad','kwd','eth','lkr','CurrencyService','5801502whDKOJ','nzd','twd','1491784HyrkzD','__esModule','CURRENCIES','stopPeriodicUpdates','updateInterval','rate','\x20currencies','\x20USDT\x20(rate:\x20','krw','clp','getCurrencyRate','2985783HJXoMx','try','default','convertMultipleToUSDT','ðŸ“Š\x20Received\x20rates\x20for\x20','usd','count','âœ…\x20Currency\x20rates\x20updated\x20successfully','bch','join'];a49_0x4e5c=function(){return _0x41d119;};return a49_0x4e5c();}class CurrencyService{constructor(){const _0x1c576f=a49_0x502bcf;this['COINGECKO_URL']='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=['btc',_0x1c576f(0x1bc),_0x1c576f(0x194),_0x1c576f(0x1d5),'bnb',_0x1c576f(0x1e9),'xrp',_0x1c576f(0x1b0),_0x1c576f(0x1f4),'dot','yfi',_0x1c576f(0x1d2),_0x1c576f(0x1b5),_0x1c576f(0x1fd),_0x1c576f(0x1b1),_0x1c576f(0x19a),'bhd',_0x1c576f(0x1dc),_0x1c576f(0x19e),_0x1c576f(0x1ba),_0x1c576f(0x1f6),_0x1c576f(0x1cb),'cny',_0x1c576f(0x1d8),_0x1c576f(0x1dd),_0x1c576f(0x1aa),_0x1c576f(0x197),'gel','hkd',_0x1c576f(0x18d),'idr','ils','inr',_0x1c576f(0x1fc),_0x1c576f(0x1ca),_0x1c576f(0x1bb),_0x1c576f(0x1bd),'mmk',_0x1c576f(0x1d7),_0x1c576f(0x1da),_0x1c576f(0x1ec),'nok',_0x1c576f(0x1c0),_0x1c576f(0x19c),_0x1c576f(0x198),_0x1c576f(0x1ed),_0x1c576f(0x1e2),_0x1c576f(0x192),_0x1c576f(0x1ab),_0x1c576f(0x1e3),'thb',_0x1c576f(0x1ce),_0x1c576f(0x1c1),_0x1c576f(0x18e),_0x1c576f(0x1fb),_0x1c576f(0x1df),_0x1c576f(0x1a4),'xdr',_0x1c576f(0x1a1),'xau',_0x1c576f(0x1a6),_0x1c576f(0x1fa)],this[_0x1c576f(0x1c6)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x1c576f(0x1ee)]();}[a49_0x502bcf(0x1ee)](){const _0x18db9e=a49_0x502bcf;this[_0x18db9e(0x191)]()[_0x18db9e(0x1e8)](_0x14303d=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x14303d);}),this[_0x18db9e(0x1c6)]=setInterval(async()=>{const _0x3035db=_0x18db9e;try{await this[_0x3035db(0x191)]();}catch(_0x239b38){console[_0x3035db(0x1f5)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x239b38);}},0x3c*0x3c*0x3e8),console[_0x18db9e(0x1e5)](_0x18db9e(0x196));}[a49_0x502bcf(0x1c5)](){const _0x4a7094=a49_0x502bcf;this[_0x4a7094(0x1c6)]&&(clearInterval(this[_0x4a7094(0x1c6)]),this['updateInterval']=null,console[_0x4a7094(0x1e5)](_0x4a7094(0x195)));}async[a49_0x502bcf(0x191)](){const _0x3a2f74=a49_0x502bcf;try{console['log'](_0x3a2f74(0x1a2));const _0x474fe0=this[_0x3a2f74(0x1c4)][_0x3a2f74(0x1d6)](','),_0x41fa7d=this[_0x3a2f74(0x190)]+_0x3a2f74(0x1b6)+_0x474fe0,_0x2dcfaf=await fetch(_0x41fa7d,{'headers':{'Accept':_0x3a2f74(0x1a5),'User-Agent':'Payment\x20System/1.0'}});if(!_0x2dcfaf['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x2dcfaf[_0x3a2f74(0x1eb)]+'\x20'+_0x2dcfaf['statusText']);const _0x4ae04a=await _0x2dcfaf['json']();if(!_0x4ae04a[_0x3a2f74(0x1f2)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x49b38c=_0x4ae04a[_0x3a2f74(0x1f2)];console[_0x3a2f74(0x1e5)](_0x3a2f74(0x1d1)+Object['keys'](_0x49b38c)[_0x3a2f74(0x1a0)]+_0x3a2f74(0x1c8));const _0x225639=Object[_0x3a2f74(0x1ef)](_0x49b38c)[_0x3a2f74(0x1b8)](async([_0x22767a,_0x2b73f3])=>{const _0xfb6872=_0x3a2f74;try{await database_1[_0xfb6872(0x1cf)][_0xfb6872(0x1f0)][_0xfb6872(0x1b7)]({'where':{'currency':_0x22767a[_0xfb6872(0x1e4)]()},'update':{'rate':_0x2b73f3},'create':{'currency':_0x22767a[_0xfb6872(0x1e4)](),'rate':_0x2b73f3}});}catch(_0x50e452){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x22767a+':',_0x50e452);}});await Promise[_0x3a2f74(0x1f7)](_0x225639),console[_0x3a2f74(0x1e5)](_0x3a2f74(0x1d4));}catch(_0x76e35e){console[_0x3a2f74(0x1f5)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x76e35e);throw _0x76e35e;}}async[a49_0x502bcf(0x1cc)](_0x52e05c){const _0x1efa7b=a49_0x502bcf,_0x25d146=_0x52e05c[_0x1efa7b(0x1e4)]();if(_0x25d146===_0x1efa7b(0x1e7))return 0x1;try{const _0x37df84=await database_1[_0x1efa7b(0x1cf)]['currencyRate'][_0x1efa7b(0x18f)]({'where':{'currency':_0x25d146}});if(!_0x37df84)return console['warn'](_0x1efa7b(0x1db)+_0x52e05c+_0x1efa7b(0x1e6)),0x1;return _0x37df84['rate'];}catch(_0x54c6b9){return console[_0x1efa7b(0x1f5)](_0x1efa7b(0x1a7)+_0x52e05c+':',_0x54c6b9),0x1;}}async[a49_0x502bcf(0x1f3)](_0xbfc398,_0x16e8c2){const _0x4cfb6a=a49_0x502bcf,_0x2b3c56=_0x16e8c2[_0x4cfb6a(0x1e4)]();if(_0x2b3c56==='usdt'){const _0x342c87=_0xbfc398*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4cfb6a(0x1e5)]('ðŸ’±\x20Applied\x20'+this[_0x4cfb6a(0x19b)]+_0x4cfb6a(0x1b9)+_0xbfc398+_0x4cfb6a(0x18b)+_0x342c87[_0x4cfb6a(0x1a8)](0x6)+_0x4cfb6a(0x1f8)),_0x342c87;}try{const _0x36e7d3=await this['getCurrencyRate'](_0x2b3c56),_0x34985e=_0xbfc398/_0x36e7d3,_0x56a9e8=_0x34985e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4cfb6a(0x1e5)]('ðŸ’±\x20Converted\x20'+_0xbfc398+'\x20'+_0x16e8c2['toUpperCase']()+_0x4cfb6a(0x1de)+_0x34985e[_0x4cfb6a(0x1a8)](0x6)+_0x4cfb6a(0x1ad)+this[_0x4cfb6a(0x19b)]+_0x4cfb6a(0x1ea)+_0x56a9e8[_0x4cfb6a(0x1a8)](0x6)+_0x4cfb6a(0x1c9)+_0x36e7d3+')'),_0x56a9e8;}catch(_0x571241){console[_0x4cfb6a(0x1f5)](_0x4cfb6a(0x1e0)+_0xbfc398+'\x20'+_0x16e8c2+_0x4cfb6a(0x199),_0x571241);const _0x1702bc=_0xbfc398*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x1702bc;}}async[a49_0x502bcf(0x1d0)](_0x277ba7){const _0x37bcf7=a49_0x502bcf;let _0x35a150=0x0;for(const {amount:_0xfc4547,currency:_0x4d3a95}of _0x277ba7){const _0x161abf=await this[_0x37bcf7(0x1f3)](_0xfc4547,_0x4d3a95);_0x35a150+=_0x161abf;}return _0x35a150;}async['getAllRates'](){const _0x3d589e=a49_0x502bcf;try{const _0x359d24=await database_1[_0x3d589e(0x1cf)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x24e047={'usdt':0x1};return _0x359d24[_0x3d589e(0x1e1)](_0x2492cf=>{const _0xa323a0=_0x3d589e;_0x24e047[_0x2492cf['currency']]=_0x2492cf[_0xa323a0(0x1c7)];}),_0x24e047;}catch(_0x55dbf2){return console[_0x3d589e(0x1f5)]('Error\x20getting\x20all\x20rates:',_0x55dbf2),{'usdt':0x1};}}async['getRatesStatus'](){const _0x340823=a49_0x502bcf;try{const [_0x32389b,_0x580624,_0x4cf97d]=await Promise['all']([database_1[_0x340823(0x1cf)]['currencyRate'][_0x340823(0x1d3)](),database_1[_0x340823(0x1cf)][_0x340823(0x1f0)][_0x340823(0x1d9)]({'orderBy':{'updatedAt':_0x340823(0x193)},'select':{'updatedAt':!![]}}),database_1[_0x340823(0x1cf)]['currencyRate'][_0x340823(0x1d9)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x32389b,'lastUpdated':_0x580624?.[_0x340823(0x1af)]||null,'oldestRate':_0x4cf97d?.[_0x340823(0x1af)]||null,'markupPercentage':this[_0x340823(0x19b)]};}catch(_0x193277){return console[_0x340823(0x1f5)](_0x340823(0x1b3),_0x193277),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x340823(0x19b)]};}}[a49_0x502bcf(0x1f9)](){return this['MARKUP_PERCENTAGE'];}}exports[a49_0x502bcf(0x1be)]=CurrencyService,exports[a49_0x502bcf(0x1f1)]=new CurrencyService();