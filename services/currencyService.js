'use strict';const a38_0x32a2c2=a38_0x532b;(function(_0x3c961c,_0x344551){const _0x5a970b=a38_0x532b,_0x23dc6c=_0x3c961c();while(!![]){try{const _0x49e455=parseInt(_0x5a970b(0x11a))/0x1+-parseInt(_0x5a970b(0xbc))/0x2*(-parseInt(_0x5a970b(0xde))/0x3)+-parseInt(_0x5a970b(0xe6))/0x4*(-parseInt(_0x5a970b(0xb4))/0x5)+parseInt(_0x5a970b(0xa5))/0x6+-parseInt(_0x5a970b(0x114))/0x7*(parseInt(_0x5a970b(0xf9))/0x8)+-parseInt(_0x5a970b(0xb1))/0x9*(parseInt(_0x5a970b(0xcf))/0xa)+parseInt(_0x5a970b(0xd9))/0xb;if(_0x49e455===_0x344551)break;else _0x23dc6c['push'](_0x23dc6c['shift']());}catch(_0x3bc4fa){_0x23dc6c['push'](_0x23dc6c['shift']());}}}(a38_0x10b0,0xab899));function a38_0x532b(_0x4295d5,_0x55ba52){const _0x10b052=a38_0x10b0();return a38_0x532b=function(_0x532b86,_0x408e22){_0x532b86=_0x532b86-0xa4;let _0x4237b2=_0x10b052[_0x532b86];return _0x4237b2;},a38_0x532b(_0x4295d5,_0x55ba52);}var __importDefault=this&&this[a38_0x32a2c2(0xcd)]||function(_0x5148ef){const _0x5b9eb9=a38_0x32a2c2;return _0x5148ef&&_0x5148ef[_0x5b9eb9(0xc5)]?_0x5148ef:{'default':_0x5148ef};};Object[a38_0x32a2c2(0xa9)](exports,a38_0x32a2c2(0xc5),{'value':!![]}),exports['currencyService']=exports[a38_0x32a2c2(0xed)]=void 0x0;const database_1=__importDefault(require(a38_0x32a2c2(0xfe)));function a38_0x10b0(){const _0x1cd7d9=['keys','nok','629662qxVKjH','Initial\x20currency\x20rates\x20update\x20failed:','currencyRate','sgd','length','483fHQqAQ','krw','log','bdt','xrp','myr','count','vnd','8aYwCWm','bmd','MARKUP_PERCENTAGE','nzd','join','status','currency','CurrencyService','application/json','toLowerCase','sek','❌\x20Failed\x20to\x20update\x20currency\x20rates:','convertToUSDT','btc','bnb','aud','COINGECKO_URL','rate','ngn','3118816dphptP','all','dkk','Error\x20getting\x20rate\x20for\x20currency\x20','chf','../config/database','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','entries','idr','map','usd','clp','warn','bch','toUpperCase','link','toFixed',',\x20using\x201\x20as\x20fallback','usdt','getCurrencyRate','error','thb','aed','allSettled','Error\x20getting\x20rates\x20status:','\x20to\x20USDT:','dot','7tZnaAE','jpy','updateCurrencyRates','inr','php','startPeriodicUpdates','502182Pwutxm','\x20USDT\x20=\x20','%\x20markup\x20to\x20','\x20USDT','findUnique','Error\x20getting\x20all\x20rates:','ils','tether','\x20to\x20','6418854ngtrcw','📊\x20Received\x20rates\x20for\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','pkr','defineProperty','ars','json','zar','hkd','uah','sar','mmk','12618207IZEIqx','statusText','CURRENCIES','1127515IvXCqT','eur','eos','default','twd','ltc','kwd','pln','5146zJfHbs','Error\x20converting\x20','✅\x20Currency\x20rates\x20updated\x20successfully','lkr','desc','?ids=tether&vs_currencies=','yfi','gel','rub','__esModule','cny','bhd','huf','brl','Periodic\x20currency\x20rates\x20update\x20failed:','updateInterval','findFirst','__importDefault','vef','10XmjmcW','updatedAt','💱\x20Converted\x20','currencyService','xag','sats','upsert','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API'];a38_0x10b0=function(){return _0x1cd7d9;};return a38_0x10b0();}class CurrencyService{constructor(){const _0x58d288=a38_0x32a2c2;this[_0x58d288(0xf6)]='https://api.coingecko.com/api/v3/simple/price',this[_0x58d288(0xb3)]=[_0x58d288(0xf3),'eth',_0x58d288(0xb9),_0x58d288(0x106),_0x58d288(0xf4),_0x58d288(0xb6),_0x58d288(0xe2),'xlm',_0x58d288(0x108),_0x58d288(0x113),_0x58d288(0xc2),_0x58d288(0x103),_0x58d288(0x10f),_0x58d288(0xaa),_0x58d288(0xf5),_0x58d288(0xe1),_0x58d288(0xc7),_0x58d288(0xe7),_0x58d288(0xc9),'cad',_0x58d288(0xfd),_0x58d288(0x104),_0x58d288(0xc6),'czk',_0x58d288(0xfb),_0x58d288(0xb5),'gbp',_0x58d288(0xc3),_0x58d288(0xad),_0x58d288(0xc8),_0x58d288(0x101),_0x58d288(0x120),_0x58d288(0x117),_0x58d288(0x115),_0x58d288(0xdf),_0x58d288(0xba),_0x58d288(0xbf),_0x58d288(0xb0),'mxn',_0x58d288(0xe3),_0x58d288(0xf8),_0x58d288(0xd8),_0x58d288(0xe9),_0x58d288(0x118),_0x58d288(0xa8),_0x58d288(0xbb),_0x58d288(0xc4),_0x58d288(0xaf),_0x58d288(0xf0),_0x58d288(0xdc),_0x58d288(0x10e),'try',_0x58d288(0xb8),_0x58d288(0xae),_0x58d288(0xce),_0x58d288(0xe5),_0x58d288(0xac),'xdr',_0x58d288(0xd3),'xau','bits',_0x58d288(0xd4)],this[_0x58d288(0xcb)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x58d288(0x119)]();}['startPeriodicUpdates'](){const _0x55b4d9=a38_0x32a2c2;this[_0x55b4d9(0x116)]()['catch'](_0x19d954=>{const _0x154ceb=_0x55b4d9;console[_0x154ceb(0x10d)](_0x154ceb(0xda),_0x19d954);}),this[_0x55b4d9(0xcb)]=setInterval(async()=>{const _0x4fc9cf=_0x55b4d9;try{await this[_0x4fc9cf(0x116)]();}catch(_0x41966d){console[_0x4fc9cf(0x10d)](_0x4fc9cf(0xca),_0x41966d);}},0x3c*0x3c*0x3e8),console['log'](_0x55b4d9(0xa7));}['stopPeriodicUpdates'](){const _0x30b710=a38_0x32a2c2;this[_0x30b710(0xcb)]&&(clearInterval(this[_0x30b710(0xcb)]),this[_0x30b710(0xcb)]=null,console[_0x30b710(0xe0)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x32a2c2(0x116)](){const _0x184173=a38_0x32a2c2;try{console['log'](_0x184173(0xff));const _0x223572=this[_0x184173(0xb3)][_0x184173(0xea)](','),_0x493ca5=this[_0x184173(0xf6)]+_0x184173(0xc1)+_0x223572,_0x2af61c=await fetch(_0x493ca5,{'headers':{'Accept':_0x184173(0xee),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x2af61c['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x2af61c[_0x184173(0xeb)]+'\x20'+_0x2af61c[_0x184173(0xb2)]);const _0x111a9a=await _0x2af61c[_0x184173(0xab)]();if(!_0x111a9a[_0x184173(0x121)])throw new Error(_0x184173(0xd6));const _0x20a6f1=_0x111a9a['tether'];console[_0x184173(0xe0)](_0x184173(0xa6)+Object[_0x184173(0xd7)](_0x20a6f1)[_0x184173(0xdd)]+'\x20currencies');const _0x4640c6=Object[_0x184173(0x100)](_0x20a6f1)[_0x184173(0x102)](async([_0x12ec67,_0x38594e])=>{const _0xfe5e86=_0x184173;try{await database_1[_0xfe5e86(0xb7)]['currencyRate'][_0xfe5e86(0xd5)]({'where':{'currency':_0x12ec67['toLowerCase']()},'update':{'rate':_0x38594e},'create':{'currency':_0x12ec67[_0xfe5e86(0xef)](),'rate':_0x38594e}});}catch(_0xe0773f){console[_0xfe5e86(0x10d)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x12ec67+':',_0xe0773f);}});await Promise[_0x184173(0x110)](_0x4640c6),console[_0x184173(0xe0)](_0x184173(0xbe));}catch(_0x216f6d){console[_0x184173(0x10d)](_0x184173(0xf1),_0x216f6d);throw _0x216f6d;}}async[a38_0x32a2c2(0x10c)](_0x326f03){const _0x3a3404=a38_0x32a2c2,_0x23ae7d=_0x326f03['toLowerCase']();if(_0x23ae7d===_0x3a3404(0x10b))return 0x1;try{const _0x4c3dbc=await database_1['default'][_0x3a3404(0xdb)][_0x3a3404(0x11e)]({'where':{'currency':_0x23ae7d}});if(!_0x4c3dbc)return console[_0x3a3404(0x105)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x326f03+_0x3a3404(0x10a)),0x1;return _0x4c3dbc[_0x3a3404(0xf7)];}catch(_0x44bead){return console[_0x3a3404(0x10d)](_0x3a3404(0xfc)+_0x326f03+':',_0x44bead),0x1;}}async[a38_0x32a2c2(0xf2)](_0x4d86fd,_0x2ee5dc){const _0x3ca2e2=a38_0x32a2c2,_0x356380=_0x2ee5dc[_0x3ca2e2(0xef)]();if(_0x356380===_0x3ca2e2(0x10b)){const _0x1a9999=_0x4d86fd*(0x1+this[_0x3ca2e2(0xe8)]/0x64);return console[_0x3ca2e2(0xe0)]('💱\x20Applied\x20'+this[_0x3ca2e2(0xe8)]+_0x3ca2e2(0x11c)+_0x4d86fd+_0x3ca2e2(0x11b)+_0x1a9999[_0x3ca2e2(0x109)](0x6)+_0x3ca2e2(0x11d)),_0x1a9999;}try{const _0x1e9430=await this[_0x3ca2e2(0x10c)](_0x356380),_0x1b07ae=_0x4d86fd/_0x1e9430,_0x156109=_0x1b07ae*(0x1+this[_0x3ca2e2(0xe8)]/0x64);return console['log'](_0x3ca2e2(0xd1)+_0x4d86fd+'\x20'+_0x2ee5dc[_0x3ca2e2(0x107)]()+_0x3ca2e2(0xa4)+_0x1b07ae[_0x3ca2e2(0x109)](0x6)+'\x20USDT,\x20with\x20'+this[_0x3ca2e2(0xe8)]+'%\x20markup\x20=\x20'+_0x156109[_0x3ca2e2(0x109)](0x6)+'\x20USDT\x20(rate:\x20'+_0x1e9430+')'),_0x156109;}catch(_0x35d0c5){console['error'](_0x3ca2e2(0xbd)+_0x4d86fd+'\x20'+_0x2ee5dc+_0x3ca2e2(0x112),_0x35d0c5);const _0x18ab21=_0x4d86fd*(0x1+this[_0x3ca2e2(0xe8)]/0x64);return _0x18ab21;}}async['convertMultipleToUSDT'](_0x1bfc68){const _0x53a9a2=a38_0x32a2c2;let _0x5f1027=0x0;for(const {amount:_0x3837bd,currency:_0x453e10}of _0x1bfc68){const _0x49854f=await this[_0x53a9a2(0xf2)](_0x3837bd,_0x453e10);_0x5f1027+=_0x49854f;}return _0x5f1027;}async['getAllRates'](){const _0xd75652=a38_0x32a2c2;try{const _0x2798a8=await database_1[_0xd75652(0xb7)]['currencyRate']['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x33606e={'usdt':0x1};return _0x2798a8['forEach'](_0x37eacf=>{const _0x43cabe=_0xd75652;_0x33606e[_0x37eacf[_0x43cabe(0xec)]]=_0x37eacf['rate'];}),_0x33606e;}catch(_0x40c0dd){return console[_0xd75652(0x10d)](_0xd75652(0x11f),_0x40c0dd),{'usdt':0x1};}}async['getRatesStatus'](){const _0xb96d1f=a38_0x32a2c2;try{const [_0x3ca28b,_0x2cad95,_0x1b6071]=await Promise[_0xb96d1f(0xfa)]([database_1[_0xb96d1f(0xb7)][_0xb96d1f(0xdb)][_0xb96d1f(0xe4)](),database_1[_0xb96d1f(0xb7)]['currencyRate'][_0xb96d1f(0xcc)]({'orderBy':{'updatedAt':_0xb96d1f(0xc0)},'select':{'updatedAt':!![]}}),database_1[_0xb96d1f(0xb7)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3ca28b,'lastUpdated':_0x2cad95?.['updatedAt']||null,'oldestRate':_0x1b6071?.[_0xb96d1f(0xd0)]||null,'markupPercentage':this[_0xb96d1f(0xe8)]};}catch(_0x158b13){return console[_0xb96d1f(0x10d)](_0xb96d1f(0x111),_0x158b13),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xb96d1f(0xe8)]};}}['getMarkupPercentage'](){const _0x10fa14=a38_0x32a2c2;return this[_0x10fa14(0xe8)];}}exports[a38_0x32a2c2(0xed)]=CurrencyService,exports[a38_0x32a2c2(0xd2)]=new CurrencyService();