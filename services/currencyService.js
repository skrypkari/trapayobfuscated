'use strict';function a38_0x3b6d(_0x47a92f,_0x223719){const _0x3166a1=a38_0x3166();return a38_0x3b6d=function(_0x3b6d6d,_0x1d628f){_0x3b6d6d=_0x3b6d6d-0x158;let _0x4e77e8=_0x3166a1[_0x3b6d6d];return _0x4e77e8;},a38_0x3b6d(_0x47a92f,_0x223719);}const a38_0x49b60e=a38_0x3b6d;(function(_0x2ed029,_0xbdf0c2){const _0x566a7d=a38_0x3b6d,_0x497a6e=_0x2ed029();while(!![]){try{const _0x4bf94f=parseInt(_0x566a7d(0x165))/0x1*(-parseInt(_0x566a7d(0x169))/0x2)+parseInt(_0x566a7d(0x1a4))/0x3+-parseInt(_0x566a7d(0x164))/0x4*(-parseInt(_0x566a7d(0x17d))/0x5)+-parseInt(_0x566a7d(0x189))/0x6+-parseInt(_0x566a7d(0x15f))/0x7+-parseInt(_0x566a7d(0x15c))/0x8*(parseInt(_0x566a7d(0x17b))/0x9)+parseInt(_0x566a7d(0x1a5))/0xa*(parseInt(_0x566a7d(0x1ce))/0xb);if(_0x4bf94f===_0xbdf0c2)break;else _0x497a6e['push'](_0x497a6e['shift']());}catch(_0xafdbf0){_0x497a6e['push'](_0x497a6e['shift']());}}}(a38_0x3166,0xd7f2c));var __importDefault=this&&this[a38_0x49b60e(0x171)]||function(_0x181966){return _0x181966&&_0x181966['__esModule']?_0x181966:{'default':_0x181966};};Object[a38_0x49b60e(0x1a1)](exports,'__esModule',{'value':!![]}),exports[a38_0x49b60e(0x190)]=exports[a38_0x49b60e(0x182)]=void 0x0;const database_1=__importDefault(require(a38_0x49b60e(0x197)));class CurrencyService{constructor(){const _0x3d5d8d=a38_0x49b60e;this[_0x3d5d8d(0x1bd)]=_0x3d5d8d(0x161),this[_0x3d5d8d(0x196)]=['btc',_0x3d5d8d(0x199),_0x3d5d8d(0x160),_0x3d5d8d(0x1c2),_0x3d5d8d(0x185),_0x3d5d8d(0x1bb),'xrp','xlm',_0x3d5d8d(0x19d),_0x3d5d8d(0x17f),'yfi',_0x3d5d8d(0x168),_0x3d5d8d(0x1a3),_0x3d5d8d(0x194),_0x3d5d8d(0x1ca),_0x3d5d8d(0x15b),'bhd','bmd',_0x3d5d8d(0x1b0),'cad','chf',_0x3d5d8d(0x173),_0x3d5d8d(0x18f),_0x3d5d8d(0x181),_0x3d5d8d(0x1c8),_0x3d5d8d(0x1b5),_0x3d5d8d(0x172),'gel','hkd','huf',_0x3d5d8d(0x18d),_0x3d5d8d(0x1c6),_0x3d5d8d(0x1b1),_0x3d5d8d(0x1a8),_0x3d5d8d(0x1c1),'kwd',_0x3d5d8d(0x167),_0x3d5d8d(0x188),'mxn',_0x3d5d8d(0x1aa),'ngn',_0x3d5d8d(0x159),_0x3d5d8d(0x175),_0x3d5d8d(0x19a),_0x3d5d8d(0x1b7),_0x3d5d8d(0x18c),_0x3d5d8d(0x195),_0x3d5d8d(0x1b8),_0x3d5d8d(0x1ac),'sgd','thb',_0x3d5d8d(0x18e),_0x3d5d8d(0x1c3),_0x3d5d8d(0x1b9),'vef',_0x3d5d8d(0x1d0),_0x3d5d8d(0x1c5),_0x3d5d8d(0x170),_0x3d5d8d(0x1cd),_0x3d5d8d(0x1c9),_0x3d5d8d(0x1b6),'sats'],this[_0x3d5d8d(0x1ad)]=null,this[_0x3d5d8d(0x16c)]=0x3,this[_0x3d5d8d(0x1cb)]();}['startPeriodicUpdates'](){const _0x47414d=a38_0x49b60e;this[_0x47414d(0x191)]()[_0x47414d(0x1a9)](_0x2c7d46=>{const _0xd8e6de=_0x47414d;console[_0xd8e6de(0x1c4)](_0xd8e6de(0x1cc),_0x2c7d46);}),this['updateInterval']=setInterval(async()=>{const _0x1ffe66=_0x47414d;try{await this[_0x1ffe66(0x191)]();}catch(_0x1a4867){console[_0x1ffe66(0x1c4)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x1a4867);}},0x3c*0x3c*0x3e8),console[_0x47414d(0x179)](_0x47414d(0x1a6));}[a38_0x49b60e(0x1a7)](){const _0x318724=a38_0x49b60e;this[_0x318724(0x1ad)]&&(clearInterval(this[_0x318724(0x1ad)]),this['updateInterval']=null,console['log'](_0x318724(0x16a)));}async['updateCurrencyRates'](){const _0x390430=a38_0x49b60e;try{console['log'](_0x390430(0x16f));const _0x10ec73=this[_0x390430(0x196)][_0x390430(0x1b4)](','),_0x3d27a4=this[_0x390430(0x1bd)]+_0x390430(0x1ba)+_0x10ec73,_0x529293=await fetch(_0x3d27a4,{'headers':{'Accept':_0x390430(0x187),'User-Agent':_0x390430(0x16d)}});if(!_0x529293['ok'])throw new Error(_0x390430(0x15a)+_0x529293[_0x390430(0x18a)]+'\x20'+_0x529293[_0x390430(0x174)]);const _0x4e9c39=await _0x529293[_0x390430(0x183)]();if(!_0x4e9c39['tether'])throw new Error(_0x390430(0x1c7));const _0x33d360=_0x4e9c39['tether'];console[_0x390430(0x179)](_0x390430(0x180)+Object['keys'](_0x33d360)[_0x390430(0x178)]+_0x390430(0x17c));const _0x2911c2=Object['entries'](_0x33d360)[_0x390430(0x1af)](async([_0x4ef81d,_0x19a257])=>{const _0x366bba=_0x390430;try{await database_1[_0x366bba(0x1be)][_0x366bba(0x17e)][_0x366bba(0x1d1)]({'where':{'currency':_0x4ef81d['toLowerCase']()},'update':{'rate':_0x19a257},'create':{'currency':_0x4ef81d['toLowerCase'](),'rate':_0x19a257}});}catch(_0x184735){console[_0x366bba(0x1c4)](_0x366bba(0x198)+_0x4ef81d+':',_0x184735);}});await Promise['allSettled'](_0x2911c2),console[_0x390430(0x179)](_0x390430(0x15e));}catch(_0x1f63e0){console[_0x390430(0x1c4)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x1f63e0);throw _0x1f63e0;}}async[a38_0x49b60e(0x19e)](_0x5bbf00){const _0x46907b=a38_0x49b60e,_0x3f234b=_0x5bbf00['toLowerCase']();if(_0x3f234b===_0x46907b(0x193))return 0x1;try{const _0x212cef=await database_1[_0x46907b(0x1be)][_0x46907b(0x17e)][_0x46907b(0x184)]({'where':{'currency':_0x3f234b}});if(!_0x212cef)return console[_0x46907b(0x186)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x5bbf00+_0x46907b(0x19b)),0x1;return _0x212cef[_0x46907b(0x166)];}catch(_0x31f3e4){return console[_0x46907b(0x1c4)](_0x46907b(0x18b)+_0x5bbf00+':',_0x31f3e4),0x1;}}async[a38_0x49b60e(0x177)](_0x1d1002,_0x9771ea){const _0x551250=a38_0x49b60e,_0x5239dd=_0x9771ea[_0x551250(0x162)]();if(_0x5239dd===_0x551250(0x193)){const _0x1f1ca6=_0x1d1002*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x551250(0x179)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x551250(0x163)+_0x1d1002+_0x551250(0x19c)+_0x1f1ca6[_0x551250(0x16e)](0x6)+_0x551250(0x1b3)),_0x1f1ca6;}try{const _0x60a149=await this[_0x551250(0x19e)](_0x5239dd),_0xdade92=_0x1d1002/_0x60a149,_0x463ffa=_0xdade92*(0x1+this[_0x551250(0x16c)]/0x64);return console[_0x551250(0x179)](_0x551250(0x17a)+_0x1d1002+'\x20'+_0x9771ea[_0x551250(0x15d)]()+_0x551250(0x1bc)+_0xdade92[_0x551250(0x16e)](0x6)+_0x551250(0x1ab)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20=\x20'+_0x463ffa[_0x551250(0x16e)](0x6)+_0x551250(0x1bf)+_0x60a149+')'),_0x463ffa;}catch(_0x1d4496){console['error']('Error\x20converting\x20'+_0x1d1002+'\x20'+_0x9771ea+_0x551250(0x176),_0x1d4496);const _0x18d8c5=_0x1d1002*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x18d8c5;}}async[a38_0x49b60e(0x1a2)](_0x2c27fd){const _0x5b626a=a38_0x49b60e;let _0x34fbd1=0x0;for(const {amount:_0x58c4b8,currency:_0x204b91}of _0x2c27fd){const _0x20d0a5=await this[_0x5b626a(0x177)](_0x58c4b8,_0x204b91);_0x34fbd1+=_0x20d0a5;}return _0x34fbd1;}async[a38_0x49b60e(0x1d2)](){const _0x30dd4a=a38_0x49b60e;try{const _0x3c5d21=await database_1[_0x30dd4a(0x1be)][_0x30dd4a(0x17e)][_0x30dd4a(0x1b2)]({'select':{'currency':!![],'rate':!![]}}),_0x248245={'usdt':0x1};return _0x3c5d21[_0x30dd4a(0x1a0)](_0x9daff7=>{const _0x26b8f9=_0x30dd4a;_0x248245[_0x9daff7[_0x26b8f9(0x192)]]=_0x9daff7[_0x26b8f9(0x166)];}),_0x248245;}catch(_0x231248){return console['error']('Error\x20getting\x20all\x20rates:',_0x231248),{'usdt':0x1};}}async['getRatesStatus'](){const _0x5ea420=a38_0x49b60e;try{const [_0x18ea02,_0x117ed1,_0x5a8728]=await Promise[_0x5ea420(0x1c0)]([database_1[_0x5ea420(0x1be)][_0x5ea420(0x17e)]['count'](),database_1[_0x5ea420(0x1be)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x5ea420(0x1be)]['currencyRate'][_0x5ea420(0x158)]({'orderBy':{'updatedAt':_0x5ea420(0x1ae)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x18ea02,'lastUpdated':_0x117ed1?.[_0x5ea420(0x19f)]||null,'oldestRate':_0x5a8728?.[_0x5ea420(0x19f)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x2bc656){return console['error'](_0x5ea420(0x16b),_0x2bc656),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x49b60e(0x1cf)](){const _0x230d9b=a38_0x49b60e;return this[_0x230d9b(0x16c)];}}function a38_0x3166(){const _0x3d1b0d=['getMarkupPercentage','vnd','upsert','getAllRates','findFirst','nok','CoinGecko\x20API\x20error:\x20','bdt','3561904hnMuoJ','toUpperCase','✅\x20Currency\x20rates\x20updated\x20successfully','1484084kvZwkP','ltc','https://api.coingecko.com/api/v3/simple/price','toLowerCase','%\x20markup\x20to\x20','4892652zCphcc','2578fjFsdA','rate','lkr','usd','1268MFIRmb','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','Error\x20getting\x20rates\x20status:','MARKUP_PERCENTAGE','TesSoft\x20Payment\x20System/1.0','toFixed','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','xdr','__importDefault','gbp','clp','statusText','nzd','\x20to\x20USDT:','convertToUSDT','length','log','💱\x20Converted\x20','9mzdFcL','\x20currencies','5MsMKwu','currencyRate','dot','📊\x20Received\x20rates\x20for\x20','czk','CurrencyService','json','findUnique','bnb','warn','application/json','mmk','2523444mIGoOw','status','Error\x20getting\x20rate\x20for\x20currency\x20','pln','idr','try','cny','currencyService','updateCurrencyRates','currency','usdt','ars','rub','CURRENCIES','../config/database','Failed\x20to\x20update\x20rate\x20for\x20','eth','php',',\x20using\x201\x20as\x20fallback','\x20USDT\x20=\x20','link','getCurrencyRate','updatedAt','forEach','defineProperty','convertMultipleToUSDT','aed','5286078SvQaHS','910LCzYoo','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','stopPeriodicUpdates','jpy','catch','myr','\x20USDT,\x20with\x20','sek','updateInterval','asc','map','brl','inr','findMany','\x20USDT','join','eur','bits','pkr','sar','uah','?ids=tether&vs_currencies=','eos','\x20to\x20','COINGECKO_URL','default','\x20USDT\x20(rate:\x20','all','krw','bch','twd','error','zar','ils','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','dkk','xau','aud','startPeriodicUpdates','Initial\x20currency\x20rates\x20update\x20failed:','xag','73931vWbDRO'];a38_0x3166=function(){return _0x3d1b0d;};return a38_0x3166();}exports[a38_0x49b60e(0x182)]=CurrencyService,exports['currencyService']=new CurrencyService();