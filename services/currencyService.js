'use strict';const a38_0x2864f4=a38_0x37c7;(function(_0x5256fb,_0x471ead){const _0x35ed67=a38_0x37c7,_0x38f66a=_0x5256fb();while(!![]){try{const _0x33fa31=parseInt(_0x35ed67(0x160))/0x1+parseInt(_0x35ed67(0x1a8))/0x2+-parseInt(_0x35ed67(0x17b))/0x3+parseInt(_0x35ed67(0x1b9))/0x4+parseInt(_0x35ed67(0x157))/0x5*(parseInt(_0x35ed67(0x186))/0x6)+parseInt(_0x35ed67(0x1a3))/0x7+parseInt(_0x35ed67(0x1ab))/0x8*(-parseInt(_0x35ed67(0x149))/0x9);if(_0x33fa31===_0x471ead)break;else _0x38f66a['push'](_0x38f66a['shift']());}catch(_0x6d4de7){_0x38f66a['push'](_0x38f66a['shift']());}}}(a38_0x48d3,0x20ba7));function a38_0x37c7(_0x2e4749,_0x1db6ec){const _0x48d30d=a38_0x48d3();return a38_0x37c7=function(_0x37c74a,_0x5b8a95){_0x37c74a=_0x37c74a-0x148;let _0x4daba2=_0x48d30d[_0x37c74a];return _0x4daba2;},a38_0x37c7(_0x2e4749,_0x1db6ec);}function a38_0x48d3(){const _0x35ff7f=['startPeriodicUpdates','warn','ils','eth','getRatesStatus','try','length','statusText','ngn','usd','yfi','\x20USDT\x20=\x20','idr','%\x20markup\x20=\x20','getAllRates','1730939eCzDHo','convertToUSDT','\x20currencies','currencyRate','kwd','185144IbRALR','error','clp','112DVZWMk','allSettled','updateInterval','brl','default','\x20to\x20','bits','count','status','hkd','gel','log','updateCurrencyRates','aud','624816WhLTRq','Error\x20getting\x20rates\x20status:','__esModule','bdt','Error\x20converting\x20','vnd','upsert','aed','\x20to\x20USDT:','452106erdGkz','sats','btc','pkr','Failed\x20to\x20update\x20rate\x20for\x20','eur','?ids=tether&vs_currencies=','Initial\x20currency\x20rates\x20update\x20failed:','xau','xag','currency','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bmd','jpy','405Agmhak','__importDefault','nok','json','eos','forEach','Periodic\x20currency\x20rates\x20update\x20failed:','findMany','\x20USDT','234584XrgEVp','ars','gbp','nzd','defineProperty','updatedAt','myr','bnb','lkr','pln','xlm','huf','application/json','💱\x20Converted\x20','\x20USDT\x20(rate:\x20','usdt','COINGECKO_URL','%\x20markup\x20to\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','MARKUP_PERCENTAGE',',\x20using\x201\x20as\x20fallback','convertMultipleToUSDT','bch','mmk','../config/database','mxn','dkk','391179izEaYQ','findUnique','currencyService','inr','catch','toLowerCase','php','entries','desc','tether','✅\x20Currency\x20rates\x20updated\x20successfully','17562SyCcWU','rate','Error\x20getting\x20all\x20rates:','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','findFirst','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','zar','chf','toFixed','sek','xrp','cny','cad','Error\x20getting\x20rate\x20for\x20currency\x20'];a38_0x48d3=function(){return _0x35ff7f;};return a38_0x48d3();}var __importDefault=this&&this[a38_0x2864f4(0x158)]||function(_0x40b78e){const _0x342f7b=a38_0x2864f4;return _0x40b78e&&_0x40b78e[_0x342f7b(0x1bb)]?_0x40b78e:{'default':_0x40b78e};};Object[a38_0x2864f4(0x164)](exports,a38_0x2864f4(0x1bb),{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x2864f4(0x178)));class CurrencyService{constructor(){const _0x2b16e4=a38_0x2864f4;this[_0x2b16e4(0x170)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x2b16e4(0x14b),_0x2b16e4(0x197),'ltc',_0x2b16e4(0x176),_0x2b16e4(0x167),_0x2b16e4(0x15b),_0x2b16e4(0x190),_0x2b16e4(0x16a),'link','dot',_0x2b16e4(0x19e),_0x2b16e4(0x19d),_0x2b16e4(0x1c0),_0x2b16e4(0x161),_0x2b16e4(0x1b8),_0x2b16e4(0x1bc),'bhd',_0x2b16e4(0x155),_0x2b16e4(0x1ae),_0x2b16e4(0x192),_0x2b16e4(0x18d),_0x2b16e4(0x1aa),_0x2b16e4(0x191),'czk',_0x2b16e4(0x17a),_0x2b16e4(0x14e),_0x2b16e4(0x162),_0x2b16e4(0x1b5),_0x2b16e4(0x1b4),_0x2b16e4(0x16b),_0x2b16e4(0x1a0),_0x2b16e4(0x196),_0x2b16e4(0x17e),_0x2b16e4(0x156),'krw',_0x2b16e4(0x1a7),_0x2b16e4(0x168),_0x2b16e4(0x177),_0x2b16e4(0x179),_0x2b16e4(0x166),_0x2b16e4(0x19c),_0x2b16e4(0x159),_0x2b16e4(0x163),_0x2b16e4(0x181),_0x2b16e4(0x14c),_0x2b16e4(0x169),'rub','sar',_0x2b16e4(0x18f),'sgd','thb',_0x2b16e4(0x199),'twd','uah','vef',_0x2b16e4(0x1be),_0x2b16e4(0x18c),'xdr',_0x2b16e4(0x152),_0x2b16e4(0x151),_0x2b16e4(0x1b1),_0x2b16e4(0x14a)],this[_0x2b16e4(0x1ad)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x2b16e4(0x194)]();}[a38_0x2864f4(0x194)](){const _0x1e2dec=a38_0x2864f4;this['updateCurrencyRates']()[_0x1e2dec(0x17f)](_0x5ad6c2=>{const _0x46bd15=_0x1e2dec;console['error'](_0x46bd15(0x150),_0x5ad6c2);}),this[_0x1e2dec(0x1ad)]=setInterval(async()=>{const _0x137bfe=_0x1e2dec;try{await this[_0x137bfe(0x1b7)]();}catch(_0x407ac7){console['error'](_0x137bfe(0x15d),_0x407ac7);}},0x3c*0x3c*0x3e8),console[_0x1e2dec(0x1b6)](_0x1e2dec(0x18b));}['stopPeriodicUpdates'](){const _0x5e09c9=a38_0x2864f4;this['updateInterval']&&(clearInterval(this[_0x5e09c9(0x1ad)]),this[_0x5e09c9(0x1ad)]=null,console[_0x5e09c9(0x1b6)](_0x5e09c9(0x172)));}async[a38_0x2864f4(0x1b7)](){const _0x3a201b=a38_0x2864f4;try{console[_0x3a201b(0x1b6)](_0x3a201b(0x154));const _0x39d0cb=this['CURRENCIES']['join'](','),_0x4aebbf=this['COINGECKO_URL']+_0x3a201b(0x14f)+_0x39d0cb,_0x10ffd4=await fetch(_0x4aebbf,{'headers':{'Accept':_0x3a201b(0x16c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x10ffd4['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x10ffd4[_0x3a201b(0x1b3)]+'\x20'+_0x10ffd4[_0x3a201b(0x19b)]);const _0x187174=await _0x10ffd4[_0x3a201b(0x15a)]();if(!_0x187174[_0x3a201b(0x184)])throw new Error(_0x3a201b(0x189));const _0x348f0d=_0x187174[_0x3a201b(0x184)];console[_0x3a201b(0x1b6)]('📊\x20Received\x20rates\x20for\x20'+Object['keys'](_0x348f0d)[_0x3a201b(0x19a)]+_0x3a201b(0x1a5));const _0x1b4744=Object[_0x3a201b(0x182)](_0x348f0d)['map'](async([_0x3cbceb,_0x59e712])=>{const _0x4fb861=_0x3a201b;try{await database_1[_0x4fb861(0x1af)][_0x4fb861(0x1a6)][_0x4fb861(0x1bf)]({'where':{'currency':_0x3cbceb[_0x4fb861(0x180)]()},'update':{'rate':_0x59e712},'create':{'currency':_0x3cbceb[_0x4fb861(0x180)](),'rate':_0x59e712}});}catch(_0x21b3f6){console[_0x4fb861(0x1a9)](_0x4fb861(0x14d)+_0x3cbceb+':',_0x21b3f6);}});await Promise[_0x3a201b(0x1ac)](_0x1b4744),console['log'](_0x3a201b(0x185));}catch(_0x422c90){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x422c90);throw _0x422c90;}}async['getCurrencyRate'](_0x4a6b9a){const _0x5981da=a38_0x2864f4,_0x71c7b1=_0x4a6b9a[_0x5981da(0x180)]();if(_0x71c7b1===_0x5981da(0x16f))return 0x1;try{const _0x599071=await database_1[_0x5981da(0x1af)]['currencyRate'][_0x5981da(0x17c)]({'where':{'currency':_0x71c7b1}});if(!_0x599071)return console[_0x5981da(0x195)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x4a6b9a+_0x5981da(0x174)),0x1;return _0x599071['rate'];}catch(_0x40c118){return console['error'](_0x5981da(0x193)+_0x4a6b9a+':',_0x40c118),0x1;}}async[a38_0x2864f4(0x1a4)](_0x2eb858,_0x546684){const _0x19a59d=a38_0x2864f4,_0x5102b9=_0x546684['toLowerCase']();if(_0x5102b9===_0x19a59d(0x16f)){const _0x358e10=_0x2eb858*(0x1+this[_0x19a59d(0x173)]/0x64);return console[_0x19a59d(0x1b6)]('💱\x20Applied\x20'+this['MARKUP_PERCENTAGE']+_0x19a59d(0x171)+_0x2eb858+_0x19a59d(0x19f)+_0x358e10[_0x19a59d(0x18e)](0x6)+_0x19a59d(0x15f)),_0x358e10;}try{const _0x40083a=await this['getCurrencyRate'](_0x5102b9),_0x541142=_0x2eb858/_0x40083a,_0x2444e8=_0x541142*(0x1+this[_0x19a59d(0x173)]/0x64);return console['log'](_0x19a59d(0x16d)+_0x2eb858+'\x20'+_0x546684['toUpperCase']()+_0x19a59d(0x1b0)+_0x541142[_0x19a59d(0x18e)](0x6)+'\x20USDT,\x20with\x20'+this[_0x19a59d(0x173)]+_0x19a59d(0x1a1)+_0x2444e8[_0x19a59d(0x18e)](0x6)+_0x19a59d(0x16e)+_0x40083a+')'),_0x2444e8;}catch(_0x14f4a3){console[_0x19a59d(0x1a9)](_0x19a59d(0x1bd)+_0x2eb858+'\x20'+_0x546684+_0x19a59d(0x148),_0x14f4a3);const _0x333013=_0x2eb858*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x333013;}}async[a38_0x2864f4(0x175)](_0x271011){let _0x573348=0x0;for(const {amount:_0x15160,currency:_0x1cf828}of _0x271011){const _0x6bfecd=await this['convertToUSDT'](_0x15160,_0x1cf828);_0x573348+=_0x6bfecd;}return _0x573348;}async[a38_0x2864f4(0x1a2)](){const _0x407d0c=a38_0x2864f4;try{const _0x580119=await database_1[_0x407d0c(0x1af)][_0x407d0c(0x1a6)][_0x407d0c(0x15e)]({'select':{'currency':!![],'rate':!![]}}),_0xb626f6={'usdt':0x1};return _0x580119[_0x407d0c(0x15c)](_0x7a4189=>{const _0x4ad85e=_0x407d0c;_0xb626f6[_0x7a4189[_0x4ad85e(0x153)]]=_0x7a4189[_0x4ad85e(0x187)];}),_0xb626f6;}catch(_0x53d27e){return console[_0x407d0c(0x1a9)](_0x407d0c(0x188),_0x53d27e),{'usdt':0x1};}}async[a38_0x2864f4(0x198)](){const _0xf58c54=a38_0x2864f4;try{const [_0x19e11b,_0x4b8fe0,_0x15a9ce]=await Promise['all']([database_1[_0xf58c54(0x1af)][_0xf58c54(0x1a6)][_0xf58c54(0x1b2)](),database_1[_0xf58c54(0x1af)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0xf58c54(0x183)},'select':{'updatedAt':!![]}}),database_1[_0xf58c54(0x1af)][_0xf58c54(0x1a6)][_0xf58c54(0x18a)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x19e11b,'lastUpdated':_0x4b8fe0?.[_0xf58c54(0x165)]||null,'oldestRate':_0x15a9ce?.[_0xf58c54(0x165)]||null,'markupPercentage':this[_0xf58c54(0x173)]};}catch(_0xb7ddc0){return console[_0xf58c54(0x1a9)](_0xf58c54(0x1ba),_0xb7ddc0),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0xf58c54(0x173)]};}}['getMarkupPercentage'](){const _0x2d0ae2=a38_0x2864f4;return this[_0x2d0ae2(0x173)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x2864f4(0x17d)]=new CurrencyService();