'use strict';const a49_0x468ad8=a49_0x34c4;(function(_0x214a31,_0x4a00fe){const _0x371640=a49_0x34c4,_0x2ffa0f=_0x214a31();while(!![]){try{const _0x46f742=-parseInt(_0x371640(0x1ff))/0x1*(parseInt(_0x371640(0x245))/0x2)+-parseInt(_0x371640(0x212))/0x3+parseInt(_0x371640(0x1fb))/0x4*(-parseInt(_0x371640(0x240))/0x5)+parseInt(_0x371640(0x22e))/0x6*(-parseInt(_0x371640(0x252))/0x7)+parseInt(_0x371640(0x21b))/0x8+parseInt(_0x371640(0x237))/0x9*(parseInt(_0x371640(0x23b))/0xa)+-parseInt(_0x371640(0x24a))/0xb*(-parseInt(_0x371640(0x22b))/0xc);if(_0x46f742===_0x4a00fe)break;else _0x2ffa0f['push'](_0x2ffa0f['shift']());}catch(_0x87835){_0x2ffa0f['push'](_0x2ffa0f['shift']());}}}(a49_0x5c66,0xc93b1));function a49_0x5c66(){const _0x1f722f=['application/json','findMany','link','732687hTAApF','\x20USDT\x20=\x20','bmd','\x20to\x20',',\x20using\x201\x20as\x20fallback','pln','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','status','convertToUSDT','10782512QDkzDT','default','ngn','mxn','bnb','https://api.coingecko.com/api/v3/simple/price','kwd','CurrencyService','hkd','error','mmk','xau','tether','%\x20markup\x20to\x20','bdt','Periodic\x20currency\x20rates\x20update\x20failed:','23923092RmmpIK','rub','length','1067340KhLkna','count','aud','czk','myr','Error\x20getting\x20all\x20rates:','bhd','vnd','sar','386082HEIGJz','allSettled','Initial\x20currency\x20rates\x20update\x20failed:','eth','30dzHaDn','\x20USDT\x20(rate:\x20','asc','brl','toUpperCase','4727155UtNRvZ','findFirst','keys','log','eos','8CLwgIg','yfi','vef','__importDefault','bits','11jOBtNY','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','chf','usdt','sats','inr','bch','nzd','7suZjwE','%\x20markup\x20=\x20','\x20currencies','pkr','xag','updateInterval','warn','getCurrencyRate','COINGECKO_URL','ars','json','thb','ðŸ“Š\x20Received\x20rates\x20for\x20','dot','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','__esModule','\x20USDT,\x20with\x20','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','clp','xrp','ltc','nok','gbp','dkk','jpy','convertMultipleToUSDT','statusText','toFixed','cny','eur','usd','entries','gel','No\x20rate\x20found\x20for\x20currency:\x20','updateCurrencyRates','huf','MARKUP_PERCENTAGE','uah','desc','4pligRn','all','toLowerCase','Error\x20converting\x20','319577xENlTH','php','currencyRate','Payment\x20System/1.0','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','currencyService','Failed\x20to\x20update\x20rate\x20for\x20','getMarkupPercentage','updatedAt','currency','ðŸ’±\x20Converted\x20','join','sgd','\x20to\x20USDT:','rate','stopPeriodicUpdates'];a49_0x5c66=function(){return _0x1f722f;};return a49_0x5c66();}var __importDefault=this&&this[a49_0x468ad8(0x248)]||function(_0x5bceb6){const _0x25ae9f=a49_0x468ad8;return _0x5bceb6&&_0x5bceb6[_0x25ae9f(0x1e3)]?_0x5bceb6:{'default':_0x5bceb6};};Object['defineProperty'](exports,a49_0x468ad8(0x1e3),{'value':!![]}),exports[a49_0x468ad8(0x204)]=exports[a49_0x468ad8(0x222)]=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0xecb40f=a49_0x468ad8;this[_0xecb40f(0x25a)]=_0xecb40f(0x220),this['CURRENCIES']=['btc',_0xecb40f(0x23a),_0xecb40f(0x1e8),_0xecb40f(0x250),_0xecb40f(0x21f),_0xecb40f(0x244),_0xecb40f(0x1e7),'xlm',_0xecb40f(0x211),_0xecb40f(0x1e1),_0xecb40f(0x246),_0xecb40f(0x1f2),'aed',_0xecb40f(0x25b),_0xecb40f(0x230),_0xecb40f(0x229),_0xecb40f(0x234),_0xecb40f(0x214),_0xecb40f(0x23e),'cad',_0xecb40f(0x24c),_0xecb40f(0x1e6),_0xecb40f(0x1f0),_0xecb40f(0x231),_0xecb40f(0x1eb),_0xecb40f(0x1f1),_0xecb40f(0x1ea),_0xecb40f(0x1f4),_0xecb40f(0x223),_0xecb40f(0x1f7),'idr','ils',_0xecb40f(0x24f),_0xecb40f(0x1ec),'krw',_0xecb40f(0x221),'lkr',_0xecb40f(0x225),_0xecb40f(0x21e),_0xecb40f(0x232),_0xecb40f(0x21d),_0xecb40f(0x1e9),_0xecb40f(0x251),_0xecb40f(0x200),_0xecb40f(0x255),_0xecb40f(0x217),_0xecb40f(0x22c),_0xecb40f(0x236),'sek',_0xecb40f(0x20b),_0xecb40f(0x25d),'try','twd',_0xecb40f(0x1f9),_0xecb40f(0x247),_0xecb40f(0x235),'zar','xdr',_0xecb40f(0x256),_0xecb40f(0x226),_0xecb40f(0x249),_0xecb40f(0x24e)],this[_0xecb40f(0x257)]=null,this[_0xecb40f(0x1f8)]=-0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0xd5b647=a49_0x468ad8;this[_0xd5b647(0x1f6)]()['catch'](_0x447dae=>{const _0x224b31=_0xd5b647;console[_0x224b31(0x224)](_0x224b31(0x239),_0x447dae);}),this[_0xd5b647(0x257)]=setInterval(async()=>{const _0x4b2bb4=_0xd5b647;try{await this[_0x4b2bb4(0x1f6)]();}catch(_0x2dab7b){console[_0x4b2bb4(0x224)](_0x4b2bb4(0x22a),_0x2dab7b);}},0x3c*0x3c*0x3e8),console[_0xd5b647(0x243)](_0xd5b647(0x218));}[a49_0x468ad8(0x20e)](){const _0x5493f0=a49_0x468ad8;this['updateInterval']&&(clearInterval(this['updateInterval']),this[_0x5493f0(0x257)]=null,console[_0x5493f0(0x243)](_0x5493f0(0x24b)));}async['updateCurrencyRates'](){const _0x29b114=a49_0x468ad8;try{console['log'](_0x29b114(0x1e5));const _0x45a47f=this['CURRENCIES'][_0x29b114(0x20a)](','),_0xfa6cba=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x45a47f,_0x315550=await fetch(_0xfa6cba,{'headers':{'Accept':_0x29b114(0x20f),'User-Agent':_0x29b114(0x202)}});if(!_0x315550['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x315550[_0x29b114(0x219)]+'\x20'+_0x315550[_0x29b114(0x1ee)]);const _0x891a5=await _0x315550[_0x29b114(0x25c)]();if(!_0x891a5['tether'])throw new Error(_0x29b114(0x1e2));const _0x534389=_0x891a5[_0x29b114(0x227)];console[_0x29b114(0x243)](_0x29b114(0x25e)+Object[_0x29b114(0x242)](_0x534389)[_0x29b114(0x22d)]+_0x29b114(0x254));const _0x5e676d=Object[_0x29b114(0x1f3)](_0x534389)['map'](async([_0x5b64d9,_0x4bb64c])=>{const _0x105ed4=_0x29b114;try{await database_1[_0x105ed4(0x21c)]['currencyRate']['upsert']({'where':{'currency':_0x5b64d9['toLowerCase']()},'update':{'rate':_0x4bb64c},'create':{'currency':_0x5b64d9[_0x105ed4(0x1fd)](),'rate':_0x4bb64c}});}catch(_0x7669c7){console[_0x105ed4(0x224)](_0x105ed4(0x205)+_0x5b64d9+':',_0x7669c7);}});await Promise[_0x29b114(0x238)](_0x5e676d),console[_0x29b114(0x243)]('âœ…\x20Currency\x20rates\x20updated\x20successfully');}catch(_0xb83742){console[_0x29b114(0x224)](_0x29b114(0x203),_0xb83742);throw _0xb83742;}}async['getCurrencyRate'](_0x19c03c){const _0x3e97af=a49_0x468ad8,_0x21e8ed=_0x19c03c['toLowerCase']();if(_0x21e8ed==='usdt')return 0x1;try{const _0x442356=await database_1[_0x3e97af(0x21c)][_0x3e97af(0x201)]['findUnique']({'where':{'currency':_0x21e8ed}});if(!_0x442356)return console[_0x3e97af(0x258)](_0x3e97af(0x1f5)+_0x19c03c+_0x3e97af(0x216)),0x1;return _0x442356[_0x3e97af(0x20d)];}catch(_0x3d5aae){return console[_0x3e97af(0x224)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x19c03c+':',_0x3d5aae),0x1;}}async[a49_0x468ad8(0x21a)](_0x59924b,_0x2c77a3){const _0xdc0cba=a49_0x468ad8,_0x2a20f2=_0x2c77a3[_0xdc0cba(0x1fd)]();if(_0x2a20f2===_0xdc0cba(0x24d)){const _0x48deef=_0x59924b*(0x1+this[_0xdc0cba(0x1f8)]/0x64);return console[_0xdc0cba(0x243)]('ðŸ’±\x20Applied\x20'+this[_0xdc0cba(0x1f8)]+_0xdc0cba(0x228)+_0x59924b+_0xdc0cba(0x213)+_0x48deef[_0xdc0cba(0x1ef)](0x6)+'\x20USDT'),_0x48deef;}try{const _0x155c57=await this[_0xdc0cba(0x259)](_0x2a20f2),_0x45c8b7=_0x59924b/_0x155c57,_0x416b0e=_0x45c8b7*(0x1+this[_0xdc0cba(0x1f8)]/0x64);return console['log'](_0xdc0cba(0x209)+_0x59924b+'\x20'+_0x2c77a3[_0xdc0cba(0x23f)]()+_0xdc0cba(0x215)+_0x45c8b7[_0xdc0cba(0x1ef)](0x6)+_0xdc0cba(0x1e4)+this[_0xdc0cba(0x1f8)]+_0xdc0cba(0x253)+_0x416b0e['toFixed'](0x6)+_0xdc0cba(0x23c)+_0x155c57+')'),_0x416b0e;}catch(_0x27c4af){console['error'](_0xdc0cba(0x1fe)+_0x59924b+'\x20'+_0x2c77a3+_0xdc0cba(0x20c),_0x27c4af);const _0x56daa8=_0x59924b*(0x1+this[_0xdc0cba(0x1f8)]/0x64);return _0x56daa8;}}async[a49_0x468ad8(0x1ed)](_0x4d9bb3){let _0x2bf52a=0x0;for(const {amount:_0x27d7ce,currency:_0x2f1d8e}of _0x4d9bb3){const _0x33a7a3=await this['convertToUSDT'](_0x27d7ce,_0x2f1d8e);_0x2bf52a+=_0x33a7a3;}return _0x2bf52a;}async['getAllRates'](){const _0x3feded=a49_0x468ad8;try{const _0x89986e=await database_1[_0x3feded(0x21c)]['currencyRate'][_0x3feded(0x210)]({'select':{'currency':!![],'rate':!![]}}),_0x5d5c87={'usdt':0x1};return _0x89986e['forEach'](_0x16812a=>{const _0x276456=_0x3feded;_0x5d5c87[_0x16812a[_0x276456(0x208)]]=_0x16812a[_0x276456(0x20d)];}),_0x5d5c87;}catch(_0x484eea){return console[_0x3feded(0x224)](_0x3feded(0x233),_0x484eea),{'usdt':0x1};}}async['getRatesStatus'](){const _0x5bec85=a49_0x468ad8;try{const [_0xe18838,_0x4ae123,_0x14d5c1]=await Promise[_0x5bec85(0x1fc)]([database_1['default'][_0x5bec85(0x201)][_0x5bec85(0x22f)](),database_1['default'][_0x5bec85(0x201)]['findFirst']({'orderBy':{'updatedAt':_0x5bec85(0x1fa)},'select':{'updatedAt':!![]}}),database_1['default'][_0x5bec85(0x201)][_0x5bec85(0x241)]({'orderBy':{'updatedAt':_0x5bec85(0x23d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xe18838,'lastUpdated':_0x4ae123?.['updatedAt']||null,'oldestRate':_0x14d5c1?.[_0x5bec85(0x207)]||null,'markupPercentage':this[_0x5bec85(0x1f8)]};}catch(_0x5f353e){return console[_0x5bec85(0x224)]('Error\x20getting\x20rates\x20status:',_0x5f353e),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x5bec85(0x1f8)]};}}[a49_0x468ad8(0x206)](){return this['MARKUP_PERCENTAGE'];}}function a49_0x34c4(_0x12bf01,_0x276f5f){_0x12bf01=_0x12bf01-0x1e1;const _0x5c66e8=a49_0x5c66();let _0x34c490=_0x5c66e8[_0x12bf01];return _0x34c490;}exports[a49_0x468ad8(0x222)]=CurrencyService,exports[a49_0x468ad8(0x204)]=new CurrencyService();