'use strict';const a49_0x302491=a49_0x199c;(function(_0x20900f,_0x1c6030){const _0x41dfe6=a49_0x199c,_0x1d9bf7=_0x20900f();while(!![]){try{const _0x479cfc=parseInt(_0x41dfe6(0x104))/0x1+-parseInt(_0x41dfe6(0x102))/0x2*(parseInt(_0x41dfe6(0xdc))/0x3)+parseInt(_0x41dfe6(0x128))/0x4+parseInt(_0x41dfe6(0xfa))/0x5+parseInt(_0x41dfe6(0xef))/0x6*(-parseInt(_0x41dfe6(0x121))/0x7)+parseInt(_0x41dfe6(0x118))/0x8+parseInt(_0x41dfe6(0xd6))/0x9;if(_0x479cfc===_0x1c6030)break;else _0x1d9bf7['push'](_0x1d9bf7['shift']());}catch(_0xb3454b){_0x1d9bf7['push'](_0x1d9bf7['shift']());}}}(a49_0xfc29,0x601ad));var __importDefault=this&&this['__importDefault']||function(_0x2a5a26){return _0x2a5a26&&_0x2a5a26['__esModule']?_0x2a5a26:{'default':_0x2a5a26};};Object[a49_0x302491(0xfb)](exports,a49_0x302491(0x11c),{'value':!![]}),exports[a49_0x302491(0xd4)]=exports[a49_0x302491(0xc7)]=void 0x0;const database_1=__importDefault(require(a49_0x302491(0x110)));function a49_0xfc29(){const _0x477c8e=['allSettled','inr','sar','toUpperCase','application/json','brl','bdt','zar','bch','nzd','getMarkupPercentage','startPeriodicUpdates','count','xau','log','1866DMbWNT','chf','\x20currencies','gel','mmk','ils','kwd','asc','yfi','xag','jpy','52515JNmKiw','defineProperty','warn','?ids=tether&vs_currencies=','currencyRate','getRatesStatus','ngn','eur','82054tnKIrL','xlm','553031ruDgSm','Error\x20converting\x20','desc','all','link','mxn','findMany','https://api.coingecko.com/api/v3/simple/price','bnb','sgd','clp','idr','../config/database','error','keys','vef','ðŸ“Š\x20Received\x20rates\x20for\x20','usdt','length','Error\x20getting\x20rate\x20for\x20currency\x20','3569496lYDJFy','php','ars','status','__esModule','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','updateInterval','nok','map','8729iyVvhO','âœ…\x20Currency\x20rates\x20updated\x20successfully','aud','aed','eos','toFixed','\x20to\x20USDT:','1038172nwrUSM','join','%\x20markup\x20to\x20','json','convertToUSDT','ðŸ’±\x20Applied\x20','tether','cad','Initial\x20currency\x20rates\x20update\x20failed:','toLowerCase','updateCurrencyRates','try','rub','vnd','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','sats',',\x20using\x201\x20as\x20fallback','btc','getCurrencyRate','default','\x20USDT','rate','statusText','MARKUP_PERCENTAGE','convertMultipleToUSDT','CurrencyService','myr','No\x20rate\x20found\x20for\x20currency:\x20','stopPeriodicUpdates','sek','dkk','Error\x20getting\x20rates\x20status:','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','gbp','pln','Failed\x20to\x20update\x20rate\x20for\x20','\x20USDT\x20(rate:\x20','uah','currencyService','Error\x20getting\x20all\x20rates:','1886913TcHkEn','findFirst','%\x20markup\x20=\x20','huf','bits','upsert','51VaqYns','\x20USDT\x20=\x20','pkr','ltc'];a49_0xfc29=function(){return _0x477c8e;};return a49_0xfc29();}function a49_0x199c(_0x4c584b,_0x3827c1){_0x4c584b=_0x4c584b-0xb5;const _0xfc2938=a49_0xfc29();let _0x199cd9=_0xfc2938[_0x4c584b];return _0x199cd9;}class CurrencyService{constructor(){const _0x32e9e7=a49_0x302491;this['COINGECKO_URL']=_0x32e9e7(0x10b),this['CURRENCIES']=[_0x32e9e7(0xbf),'eth',_0x32e9e7(0xdf),_0x32e9e7(0xe8),_0x32e9e7(0x10c),_0x32e9e7(0x125),'xrp',_0x32e9e7(0x103),_0x32e9e7(0x108),'dot',_0x32e9e7(0xf7),'usd',_0x32e9e7(0x124),_0x32e9e7(0x11a),_0x32e9e7(0x123),_0x32e9e7(0xe6),'bhd','bmd',_0x32e9e7(0xe5),_0x32e9e7(0xb5),_0x32e9e7(0xf0),_0x32e9e7(0x10e),'cny','czk',_0x32e9e7(0xcc),_0x32e9e7(0x101),_0x32e9e7(0xcf),_0x32e9e7(0xf2),'hkd',_0x32e9e7(0xd9),_0x32e9e7(0x10f),_0x32e9e7(0xf4),_0x32e9e7(0xe1),_0x32e9e7(0xf9),'krw',_0x32e9e7(0xf5),'lkr',_0x32e9e7(0xf3),_0x32e9e7(0x109),_0x32e9e7(0xc8),_0x32e9e7(0x100),_0x32e9e7(0x11f),_0x32e9e7(0xe9),_0x32e9e7(0x119),_0x32e9e7(0xde),_0x32e9e7(0xd0),_0x32e9e7(0xba),_0x32e9e7(0xe2),_0x32e9e7(0xcb),_0x32e9e7(0x10d),'thb',_0x32e9e7(0xb9),'twd',_0x32e9e7(0xd3),_0x32e9e7(0x113),_0x32e9e7(0xbb),_0x32e9e7(0xe7),'xdr',_0x32e9e7(0xf8),_0x32e9e7(0xed),_0x32e9e7(0xda),_0x32e9e7(0xbd)],this[_0x32e9e7(0x11e)]=null,this[_0x32e9e7(0xc5)]=-0x3,this[_0x32e9e7(0xeb)]();}[a49_0x302491(0xeb)](){const _0xa4280=a49_0x302491;this[_0xa4280(0xb8)]()['catch'](_0x4729fb=>{const _0x5e80b6=_0xa4280;console[_0x5e80b6(0x111)](_0x5e80b6(0xb6),_0x4729fb);}),this['updateInterval']=setInterval(async()=>{const _0x1580c4=_0xa4280;try{await this[_0x1580c4(0xb8)]();}catch(_0x1f8494){console[_0x1580c4(0x111)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x1f8494);}},0x3c*0x3c*0x3e8),console[_0xa4280(0xee)](_0xa4280(0xce));}[a49_0x302491(0xca)](){const _0x5493d3=a49_0x302491;this[_0x5493d3(0x11e)]&&(clearInterval(this[_0x5493d3(0x11e)]),this[_0x5493d3(0x11e)]=null,console[_0x5493d3(0xee)](_0x5493d3(0x11d)));}async['updateCurrencyRates'](){const _0x3052d5=a49_0x302491;try{console[_0x3052d5(0xee)](_0x3052d5(0xbc));const _0x430ea9=this['CURRENCIES'][_0x3052d5(0x129)](','),_0x1f2254=this['COINGECKO_URL']+_0x3052d5(0xfd)+_0x430ea9,_0x5245e7=await fetch(_0x1f2254,{'headers':{'Accept':_0x3052d5(0xe4),'User-Agent':'Payment\x20System/1.0'}});if(!_0x5245e7['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x5245e7[_0x3052d5(0x11b)]+'\x20'+_0x5245e7[_0x3052d5(0xc4)]);const _0x2ea730=await _0x5245e7[_0x3052d5(0x12b)]();if(!_0x2ea730[_0x3052d5(0x12e)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x447c21=_0x2ea730['tether'];console[_0x3052d5(0xee)](_0x3052d5(0x114)+Object[_0x3052d5(0x112)](_0x447c21)[_0x3052d5(0x116)]+_0x3052d5(0xf1));const _0x299520=Object['entries'](_0x447c21)[_0x3052d5(0x120)](async([_0x548146,_0x1b609b])=>{const _0x534deb=_0x3052d5;try{await database_1[_0x534deb(0xc1)]['currencyRate'][_0x534deb(0xdb)]({'where':{'currency':_0x548146[_0x534deb(0xb7)]()},'update':{'rate':_0x1b609b},'create':{'currency':_0x548146[_0x534deb(0xb7)](),'rate':_0x1b609b}});}catch(_0x58f45e){console[_0x534deb(0x111)](_0x534deb(0xd1)+_0x548146+':',_0x58f45e);}});await Promise[_0x3052d5(0xe0)](_0x299520),console[_0x3052d5(0xee)](_0x3052d5(0x122));}catch(_0x2e3768){console['error']('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x2e3768);throw _0x2e3768;}}async[a49_0x302491(0xc0)](_0x4139de){const _0x2bf896=a49_0x302491,_0x2f8e96=_0x4139de[_0x2bf896(0xb7)]();if(_0x2f8e96==='usdt')return 0x1;try{const _0x104522=await database_1[_0x2bf896(0xc1)][_0x2bf896(0xfe)]['findUnique']({'where':{'currency':_0x2f8e96}});if(!_0x104522)return console[_0x2bf896(0xfc)](_0x2bf896(0xc9)+_0x4139de+_0x2bf896(0xbe)),0x1;return _0x104522[_0x2bf896(0xc3)];}catch(_0x356da6){return console[_0x2bf896(0x111)](_0x2bf896(0x117)+_0x4139de+':',_0x356da6),0x1;}}async[a49_0x302491(0x12c)](_0x5ef6e7,_0x51f1c1){const _0x5e613d=a49_0x302491,_0x41c196=_0x51f1c1[_0x5e613d(0xb7)]();if(_0x41c196===_0x5e613d(0x115)){const _0x1c3e70=_0x5ef6e7*(0x1+this[_0x5e613d(0xc5)]/0x64);return console[_0x5e613d(0xee)](_0x5e613d(0x12d)+this['MARKUP_PERCENTAGE']+_0x5e613d(0x12a)+_0x5ef6e7+_0x5e613d(0xdd)+_0x1c3e70[_0x5e613d(0x126)](0x6)+_0x5e613d(0xc2)),_0x1c3e70;}try{const _0x427f72=await this[_0x5e613d(0xc0)](_0x41c196),_0x12ac5c=_0x5ef6e7/_0x427f72,_0x244168=_0x12ac5c*(0x1+this[_0x5e613d(0xc5)]/0x64);return console[_0x5e613d(0xee)]('ðŸ’±\x20Converted\x20'+_0x5ef6e7+'\x20'+_0x51f1c1[_0x5e613d(0xe3)]()+'\x20to\x20'+_0x12ac5c[_0x5e613d(0x126)](0x6)+'\x20USDT,\x20with\x20'+this[_0x5e613d(0xc5)]+_0x5e613d(0xd8)+_0x244168[_0x5e613d(0x126)](0x6)+_0x5e613d(0xd2)+_0x427f72+')'),_0x244168;}catch(_0x511613){console['error'](_0x5e613d(0x105)+_0x5ef6e7+'\x20'+_0x51f1c1+_0x5e613d(0x127),_0x511613);const _0x2bc9f4=_0x5ef6e7*(0x1+this[_0x5e613d(0xc5)]/0x64);return _0x2bc9f4;}}async[a49_0x302491(0xc6)](_0x43eb5b){const _0x3bdb03=a49_0x302491;let _0x166be5=0x0;for(const {amount:_0x2d59a8,currency:_0x34f25e}of _0x43eb5b){const _0x5c9c16=await this[_0x3bdb03(0x12c)](_0x2d59a8,_0x34f25e);_0x166be5+=_0x5c9c16;}return _0x166be5;}async['getAllRates'](){const _0x3cd99f=a49_0x302491;try{const _0x201810=await database_1[_0x3cd99f(0xc1)][_0x3cd99f(0xfe)][_0x3cd99f(0x10a)]({'select':{'currency':!![],'rate':!![]}}),_0xd7804c={'usdt':0x1};return _0x201810['forEach'](_0x39b280=>{const _0x3c4244=_0x3cd99f;_0xd7804c[_0x39b280['currency']]=_0x39b280[_0x3c4244(0xc3)];}),_0xd7804c;}catch(_0x787415){return console[_0x3cd99f(0x111)](_0x3cd99f(0xd5),_0x787415),{'usdt':0x1};}}async[a49_0x302491(0xff)](){const _0x1a1438=a49_0x302491;try{const [_0x17f973,_0x318119,_0x484fd8]=await Promise[_0x1a1438(0x107)]([database_1['default'][_0x1a1438(0xfe)][_0x1a1438(0xec)](),database_1['default']['currencyRate'][_0x1a1438(0xd7)]({'orderBy':{'updatedAt':_0x1a1438(0x106)},'select':{'updatedAt':!![]}}),database_1[_0x1a1438(0xc1)]['currencyRate'][_0x1a1438(0xd7)]({'orderBy':{'updatedAt':_0x1a1438(0xf6)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x17f973,'lastUpdated':_0x318119?.['updatedAt']||null,'oldestRate':_0x484fd8?.['updatedAt']||null,'markupPercentage':this[_0x1a1438(0xc5)]};}catch(_0x27e8dc){return console['error'](_0x1a1438(0xcd),_0x27e8dc),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1a1438(0xc5)]};}}[a49_0x302491(0xea)](){const _0x18eb45=a49_0x302491;return this[_0x18eb45(0xc5)];}}exports[a49_0x302491(0xc7)]=CurrencyService,exports[a49_0x302491(0xd4)]=new CurrencyService();