'use strict';const a38_0x278652=a38_0x41dc;(function(_0x323b8f,_0x2739f6){const _0x1f0639=a38_0x41dc,_0x1ae7af=_0x323b8f();while(!![]){try{const _0x20385a=-parseInt(_0x1f0639(0x146))/0x1+-parseInt(_0x1f0639(0x179))/0x2+-parseInt(_0x1f0639(0x13c))/0x3*(-parseInt(_0x1f0639(0x150))/0x4)+parseInt(_0x1f0639(0x1a6))/0x5+-parseInt(_0x1f0639(0x14b))/0x6+-parseInt(_0x1f0639(0x186))/0x7*(parseInt(_0x1f0639(0x15f))/0x8)+-parseInt(_0x1f0639(0x182))/0x9*(-parseInt(_0x1f0639(0x177))/0xa);if(_0x20385a===_0x2739f6)break;else _0x1ae7af['push'](_0x1ae7af['shift']());}catch(_0x26393d){_0x1ae7af['push'](_0x1ae7af['shift']());}}}(a38_0x135f,0xf0178));function a38_0x135f(){const _0x37ebfd=['mmk','350dAylPo','__esModule','263588znEoUT','💱\x20Applied\x20','CoinGecko\x20API\x20error:\x20','Error\x20getting\x20all\x20rates:','xag','sar','xlm','myr','hkd','62433wsPFFI','CurrencyService','tether','Periodic\x20currency\x20rates\x20update\x20failed:','5523rKzmWV','status','nzd','all','rub','vef','join','dkk','eos','mxn','xau','allSettled','convertToUSDT','pkr','?ids=tether&vs_currencies=','📊\x20Received\x20rates\x20for\x20','getCurrencyRate','log','\x20USDT\x20=\x20','getRatesStatus','twd','bnb','\x20currencies','rate','findUnique','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','php','dot','sats','desc','\x20USDT','error','6545110bEmBRq','pln','sek','cad','currency','cny','bhd','stopPeriodicUpdates','chf','toUpperCase','link','Error\x20converting\x20','lkr','map','defineProperty','\x20USDT,\x20with\x20','updateCurrencyRates','96207PUXVPo','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','CURRENCIES','%\x20markup\x20=\x20','Error\x20getting\x20rate\x20for\x20currency\x20','MARKUP_PERCENTAGE','length','btc','currencyService','updatedAt','447673EbxaKx',',\x20using\x201\x20as\x20fallback','✅\x20Currency\x20rates\x20updated\x20successfully','convertMultipleToUSDT','json','4351944EOKVtd','clp','sgd','eur','krw','188JPheYC','aed','try','thb','ars','TesSoft\x20Payment\x20System/1.0','startPeriodicUpdates','jpy','xrp','nok','%\x20markup\x20to\x20','Initial\x20currency\x20rates\x20update\x20failed:','../config/database','warn','ils','7816TOWEaZ','catch','usd','idr','gel','toFixed','https://api.coingecko.com/api/v3/simple/price','vnd','eth','\x20USDT\x20(rate:\x20','count','entries','findFirst','bch','gbp','toLowerCase','bdt','default','updateInterval','currencyRate','getAllRates','Failed\x20to\x20update\x20rate\x20for\x20','COINGECKO_URL'];a38_0x135f=function(){return _0x37ebfd;};return a38_0x135f();}function a38_0x41dc(_0x4861c4,_0x54ab51){const _0x135fec=a38_0x135f();return a38_0x41dc=function(_0x41dc65,_0x3dd570){_0x41dc65=_0x41dc65-0x13c;let _0x3e4f5f=_0x135fec[_0x41dc65];return _0x3e4f5f;},a38_0x41dc(_0x4861c4,_0x54ab51);}var __importDefault=this&&this['__importDefault']||function(_0x43a726){const _0x4ff6cc=a38_0x41dc;return _0x43a726&&_0x43a726[_0x4ff6cc(0x178)]?_0x43a726:{'default':_0x43a726};};Object[a38_0x278652(0x1b4)](exports,a38_0x278652(0x178),{'value':!![]}),exports[a38_0x278652(0x144)]=exports[a38_0x278652(0x183)]=void 0x0;const database_1=__importDefault(require(a38_0x278652(0x15c)));class CurrencyService{constructor(){const _0x251d13=a38_0x278652;this[_0x251d13(0x175)]=_0x251d13(0x165),this[_0x251d13(0x13e)]=[_0x251d13(0x143),_0x251d13(0x167),'ltc',_0x251d13(0x16c),_0x251d13(0x19b),_0x251d13(0x18e),_0x251d13(0x158),_0x251d13(0x17f),_0x251d13(0x1b0),_0x251d13(0x1a1),'yfi',_0x251d13(0x161),_0x251d13(0x151),_0x251d13(0x154),'aud',_0x251d13(0x16f),_0x251d13(0x1ac),'bmd','brl',_0x251d13(0x1a9),_0x251d13(0x1ae),_0x251d13(0x14c),_0x251d13(0x1ab),'czk',_0x251d13(0x18d),_0x251d13(0x14e),_0x251d13(0x16d),_0x251d13(0x163),_0x251d13(0x181),'huf',_0x251d13(0x162),_0x251d13(0x15e),'inr',_0x251d13(0x157),_0x251d13(0x14f),'kwd',_0x251d13(0x1b2),_0x251d13(0x176),_0x251d13(0x18f),_0x251d13(0x180),'ngn',_0x251d13(0x159),_0x251d13(0x188),_0x251d13(0x1a0),_0x251d13(0x193),_0x251d13(0x1a7),_0x251d13(0x18a),_0x251d13(0x17e),_0x251d13(0x1a8),_0x251d13(0x14d),_0x251d13(0x153),_0x251d13(0x152),_0x251d13(0x19a),'uah',_0x251d13(0x18b),_0x251d13(0x166),'zar','xdr',_0x251d13(0x17d),_0x251d13(0x190),'bits',_0x251d13(0x1a2)],this[_0x251d13(0x171)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x251d13(0x156)]();}[a38_0x278652(0x156)](){const _0x2714fd=a38_0x278652;this[_0x2714fd(0x1b6)]()[_0x2714fd(0x160)](_0x1b4dee=>{const _0x5a7d28=_0x2714fd;console[_0x5a7d28(0x1a5)](_0x5a7d28(0x15b),_0x1b4dee);}),this[_0x2714fd(0x171)]=setInterval(async()=>{const _0x5e7bb7=_0x2714fd;try{await this[_0x5e7bb7(0x1b6)]();}catch(_0x42e3bf){console['error'](_0x5e7bb7(0x185),_0x42e3bf);}},0x3c*0x3c*0x3e8),console[_0x2714fd(0x197)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x278652(0x1ad)](){const _0x16241a=a38_0x278652;this[_0x16241a(0x171)]&&(clearInterval(this[_0x16241a(0x171)]),this[_0x16241a(0x171)]=null,console[_0x16241a(0x197)](_0x16241a(0x13d)));}async[a38_0x278652(0x1b6)](){const _0x1681f8=a38_0x278652;try{console['log'](_0x1681f8(0x19f));const _0x4ec554=this[_0x1681f8(0x13e)][_0x1681f8(0x18c)](','),_0x509644=this['COINGECKO_URL']+_0x1681f8(0x194)+_0x4ec554,_0xdc67e2=await fetch(_0x509644,{'headers':{'Accept':'application/json','User-Agent':_0x1681f8(0x155)}});if(!_0xdc67e2['ok'])throw new Error(_0x1681f8(0x17b)+_0xdc67e2[_0x1681f8(0x187)]+'\x20'+_0xdc67e2['statusText']);const _0x575d05=await _0xdc67e2[_0x1681f8(0x14a)]();if(!_0x575d05[_0x1681f8(0x184)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0xb1e802=_0x575d05[_0x1681f8(0x184)];console[_0x1681f8(0x197)](_0x1681f8(0x195)+Object['keys'](_0xb1e802)[_0x1681f8(0x142)]+_0x1681f8(0x19c));const _0x37399f=Object[_0x1681f8(0x16a)](_0xb1e802)[_0x1681f8(0x1b3)](async([_0x587488,_0x30b7a6])=>{const _0x59dbb4=_0x1681f8;try{await database_1['default'][_0x59dbb4(0x172)]['upsert']({'where':{'currency':_0x587488['toLowerCase']()},'update':{'rate':_0x30b7a6},'create':{'currency':_0x587488[_0x59dbb4(0x16e)](),'rate':_0x30b7a6}});}catch(_0x353c8c){console[_0x59dbb4(0x1a5)](_0x59dbb4(0x174)+_0x587488+':',_0x353c8c);}});await Promise[_0x1681f8(0x191)](_0x37399f),console['log'](_0x1681f8(0x148));}catch(_0x18084e){console[_0x1681f8(0x1a5)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x18084e);throw _0x18084e;}}async[a38_0x278652(0x196)](_0x4c35a5){const _0xaae62e=a38_0x278652,_0x4fad39=_0x4c35a5[_0xaae62e(0x16e)]();if(_0x4fad39==='usdt')return 0x1;try{const _0x23a73f=await database_1[_0xaae62e(0x170)]['currencyRate'][_0xaae62e(0x19e)]({'where':{'currency':_0x4fad39}});if(!_0x23a73f)return console[_0xaae62e(0x15d)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x4c35a5+_0xaae62e(0x147)),0x1;return _0x23a73f[_0xaae62e(0x19d)];}catch(_0x496f6d){return console[_0xaae62e(0x1a5)](_0xaae62e(0x140)+_0x4c35a5+':',_0x496f6d),0x1;}}async[a38_0x278652(0x192)](_0x2e5fd6,_0x10ccf1){const _0x38a3b6=a38_0x278652,_0x567f1c=_0x10ccf1[_0x38a3b6(0x16e)]();if(_0x567f1c==='usdt'){const _0xea7614=_0x2e5fd6*(0x1+this[_0x38a3b6(0x141)]/0x64);return console[_0x38a3b6(0x197)](_0x38a3b6(0x17a)+this[_0x38a3b6(0x141)]+_0x38a3b6(0x15a)+_0x2e5fd6+_0x38a3b6(0x198)+_0xea7614[_0x38a3b6(0x164)](0x6)+_0x38a3b6(0x1a4)),_0xea7614;}try{const _0x318f51=await this[_0x38a3b6(0x196)](_0x567f1c),_0x246a2a=_0x2e5fd6/_0x318f51,_0x547c96=_0x246a2a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x38a3b6(0x197)]('💱\x20Converted\x20'+_0x2e5fd6+'\x20'+_0x10ccf1[_0x38a3b6(0x1af)]()+'\x20to\x20'+_0x246a2a['toFixed'](0x6)+_0x38a3b6(0x1b5)+this[_0x38a3b6(0x141)]+_0x38a3b6(0x13f)+_0x547c96[_0x38a3b6(0x164)](0x6)+_0x38a3b6(0x168)+_0x318f51+')'),_0x547c96;}catch(_0x24b442){console[_0x38a3b6(0x1a5)](_0x38a3b6(0x1b1)+_0x2e5fd6+'\x20'+_0x10ccf1+'\x20to\x20USDT:',_0x24b442);const _0x36addd=_0x2e5fd6*(0x1+this[_0x38a3b6(0x141)]/0x64);return _0x36addd;}}async[a38_0x278652(0x149)](_0x351b93){const _0x5ea0bf=a38_0x278652;let _0x295b63=0x0;for(const {amount:_0x1061ec,currency:_0x336431}of _0x351b93){const _0x437578=await this[_0x5ea0bf(0x192)](_0x1061ec,_0x336431);_0x295b63+=_0x437578;}return _0x295b63;}async[a38_0x278652(0x173)](){const _0x677e23=a38_0x278652;try{const _0x114531=await database_1[_0x677e23(0x170)][_0x677e23(0x172)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x11ad9a={'usdt':0x1};return _0x114531['forEach'](_0x355abf=>{const _0x48ed73=_0x677e23;_0x11ad9a[_0x355abf[_0x48ed73(0x1aa)]]=_0x355abf[_0x48ed73(0x19d)];}),_0x11ad9a;}catch(_0x562645){return console[_0x677e23(0x1a5)](_0x677e23(0x17c),_0x562645),{'usdt':0x1};}}async[a38_0x278652(0x199)](){const _0x24e548=a38_0x278652;try{const [_0x5559b5,_0x2796ce,_0x3698d7]=await Promise[_0x24e548(0x189)]([database_1[_0x24e548(0x170)][_0x24e548(0x172)][_0x24e548(0x169)](),database_1[_0x24e548(0x170)][_0x24e548(0x172)][_0x24e548(0x16b)]({'orderBy':{'updatedAt':_0x24e548(0x1a3)},'select':{'updatedAt':!![]}}),database_1[_0x24e548(0x170)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5559b5,'lastUpdated':_0x2796ce?.[_0x24e548(0x145)]||null,'oldestRate':_0x3698d7?.[_0x24e548(0x145)]||null,'markupPercentage':this[_0x24e548(0x141)]};}catch(_0x142166){return console[_0x24e548(0x1a5)]('Error\x20getting\x20rates\x20status:',_0x142166),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x24e548(0x141)]};}}['getMarkupPercentage'](){const _0x1c37be=a38_0x278652;return this[_0x1c37be(0x141)];}}exports[a38_0x278652(0x183)]=CurrencyService,exports['currencyService']=new CurrencyService();