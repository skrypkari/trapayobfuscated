'use strict';const a36_0x415924=a36_0x31e8;function a36_0x3eb7(){const _0x18414e=['getCurrencyRate','\x20to\x20USDT:','5ugvlrI','lkr','asc','convertMultipleToUSDT','%\x20markup\x20=\x20','clp','all','ils','json','%\x20markup\x20to\x20','desc','bhd','5218353OoMXYf','9507492qiNNQt','stopPeriodicUpdates','dot','jpy','eth','xau','upsert','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','rub','statusText','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','krw','MARKUP_PERCENTAGE','warn','xrp','160114HfZJUD','__esModule','findFirst','6014010wrKKyP','forEach','CURRENCIES','myr','getMarkupPercentage','âœ…\x20Currency\x20rates\x20updated\x20successfully','defineProperty','eur','../config/database','\x20USDT,\x20with\x20','updateCurrencyRates','8nAhPNd','83433eiQouI','120CdGflj','sar','gel','btc','https://api.coingecko.com/api/v3/simple/price','rate','xlm','Periodic\x20currency\x20rates\x20update\x20failed:','brl','status','startPeriodicUpdates','bmd','vnd','sats','currencyService','33NSfWwb','tether','length','chf','ðŸ“Š\x20Received\x20rates\x20for\x20','ðŸ’±\x20Converted\x20','cad','yfi','ars','eos','Error\x20getting\x20all\x20rates:','keys','mxn','COINGECKO_URL','uah','aud','czk','__importDefault','try','1727061rUySyI','usdt','php','?ids=tether&vs_currencies=','currency','ltc','currencyRate','toFixed','log','xdr','nzd','sek','link','zar','\x20USDT','5PLmrdS',',\x20using\x201\x20as\x20fallback','convertToUSDT','twd','getAllRates','ngn','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','default','bnb','pkr','usd','updateInterval','error','xag','huf','bits','allSettled','aed','vef','CurrencyService','count','map','\x20currencies','idr','2332770hkJCtA','TesSoft\x20Payment\x20System/1.0','toLowerCase','findMany'];a36_0x3eb7=function(){return _0x18414e;};return a36_0x3eb7();}(function(_0x1d166c,_0x53afb2){const _0x3e7091=a36_0x31e8,_0x3db08c=_0x1d166c();while(!![]){try{const _0x3fc5d7=parseInt(_0x3e7091(0x14b))/0x1*(-parseInt(_0x3e7091(0x167))/0x2)+-parseInt(_0x3e7091(0x176))/0x3*(-parseInt(_0x3e7091(0x177))/0x4)+parseInt(_0x3e7091(0x1a8))/0x5*(parseInt(_0x3e7091(0x16a))/0x6)+-parseInt(_0x3e7091(0x199))/0x7+parseInt(_0x3e7091(0x175))/0x8*(-parseInt(_0x3e7091(0x157))/0x9)+-parseInt(_0x3e7091(0x145))/0xa*(parseInt(_0x3e7091(0x186))/0xb)+parseInt(_0x3e7091(0x158))/0xc;if(_0x3fc5d7===_0x53afb2)break;else _0x3db08c['push'](_0x3db08c['shift']());}catch(_0x25c6fd){_0x3db08c['push'](_0x3db08c['shift']());}}}(a36_0x3eb7,0xab75c));function a36_0x31e8(_0x10e1a1,_0x2b4463){const _0x3eb7bf=a36_0x3eb7();return a36_0x31e8=function(_0x31e835,_0x4fdb3d){_0x31e835=_0x31e835-0x136;let _0x1bd5c7=_0x3eb7bf[_0x31e835];return _0x1bd5c7;},a36_0x31e8(_0x10e1a1,_0x2b4463);}var __importDefault=this&&this[a36_0x415924(0x197)]||function(_0x133350){const _0x2715fd=a36_0x415924;return _0x133350&&_0x133350[_0x2715fd(0x168)]?_0x133350:{'default':_0x133350};};Object[a36_0x415924(0x170)](exports,a36_0x415924(0x168),{'value':!![]}),exports[a36_0x415924(0x185)]=exports[a36_0x415924(0x140)]=void 0x0;const database_1=__importDefault(require(a36_0x415924(0x172)));class CurrencyService{constructor(){const _0x2bd235=a36_0x415924;this[_0x2bd235(0x193)]=_0x2bd235(0x17b),this[_0x2bd235(0x16c)]=[_0x2bd235(0x17a),_0x2bd235(0x15c),_0x2bd235(0x19e),'bch',_0x2bd235(0x1b0),_0x2bd235(0x18f),_0x2bd235(0x166),_0x2bd235(0x17d),_0x2bd235(0x1a5),_0x2bd235(0x15a),_0x2bd235(0x18d),_0x2bd235(0x137),_0x2bd235(0x13e),_0x2bd235(0x18e),_0x2bd235(0x195),'bdt',_0x2bd235(0x156),_0x2bd235(0x182),_0x2bd235(0x17f),_0x2bd235(0x18c),_0x2bd235(0x189),_0x2bd235(0x150),'cny',_0x2bd235(0x196),'dkk',_0x2bd235(0x171),'gbp',_0x2bd235(0x179),'hkd',_0x2bd235(0x13b),_0x2bd235(0x144),_0x2bd235(0x152),'inr',_0x2bd235(0x15b),_0x2bd235(0x163),'kwd',_0x2bd235(0x14c),'mmk',_0x2bd235(0x192),_0x2bd235(0x16d),_0x2bd235(0x1ad),'nok',_0x2bd235(0x1a3),_0x2bd235(0x19b),_0x2bd235(0x136),'pln',_0x2bd235(0x160),_0x2bd235(0x178),_0x2bd235(0x1a4),'sgd','thb',_0x2bd235(0x198),_0x2bd235(0x1ab),_0x2bd235(0x194),_0x2bd235(0x13f),_0x2bd235(0x183),_0x2bd235(0x1a6),_0x2bd235(0x1a2),_0x2bd235(0x13a),_0x2bd235(0x15d),_0x2bd235(0x13c),_0x2bd235(0x184)],this[_0x2bd235(0x138)]=null,this[_0x2bd235(0x164)]=0x3,this['startPeriodicUpdates']();}[a36_0x415924(0x181)](){const _0x481822=a36_0x415924;this[_0x481822(0x174)]()['catch'](_0x45ae0e=>{const _0x10735e=_0x481822;console[_0x10735e(0x139)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x45ae0e);}),this[_0x481822(0x138)]=setInterval(async()=>{const _0x2e08a8=_0x481822;try{await this[_0x2e08a8(0x174)]();}catch(_0x773fed){console[_0x2e08a8(0x139)](_0x2e08a8(0x17e),_0x773fed);}},0x3c*0x3c*0x3e8),console['log'](_0x481822(0x1ae));}[a36_0x415924(0x159)](){const _0x47035b=a36_0x415924;this[_0x47035b(0x138)]&&(clearInterval(this[_0x47035b(0x138)]),this[_0x47035b(0x138)]=null,console['log']('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x291d25=a36_0x415924;try{console[_0x291d25(0x1a1)](_0x291d25(0x15f));const _0x44e592=this['CURRENCIES']['join'](','),_0x2df43b=this['COINGECKO_URL']+_0x291d25(0x19c)+_0x44e592,_0x34d83e=await fetch(_0x2df43b,{'headers':{'Accept':'application/json','User-Agent':_0x291d25(0x146)}});if(!_0x34d83e['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x34d83e[_0x291d25(0x180)]+'\x20'+_0x34d83e[_0x291d25(0x161)]);const _0xea16f1=await _0x34d83e[_0x291d25(0x153)]();if(!_0xea16f1[_0x291d25(0x187)])throw new Error(_0x291d25(0x162));const _0x5f2b88=_0xea16f1[_0x291d25(0x187)];console[_0x291d25(0x1a1)](_0x291d25(0x18a)+Object[_0x291d25(0x191)](_0x5f2b88)[_0x291d25(0x188)]+_0x291d25(0x143));const _0x283bcc=Object['entries'](_0x5f2b88)[_0x291d25(0x142)](async([_0xcd862f,_0x9b466])=>{const _0x58e441=_0x291d25;try{await database_1[_0x58e441(0x1af)]['currencyRate'][_0x58e441(0x15e)]({'where':{'currency':_0xcd862f[_0x58e441(0x147)]()},'update':{'rate':_0x9b466},'create':{'currency':_0xcd862f[_0x58e441(0x147)](),'rate':_0x9b466}});}catch(_0x12f8c0){console[_0x58e441(0x139)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0xcd862f+':',_0x12f8c0);}});await Promise[_0x291d25(0x13d)](_0x283bcc),console[_0x291d25(0x1a1)](_0x291d25(0x16f));}catch(_0x22f46b){console[_0x291d25(0x139)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x22f46b);throw _0x22f46b;}}async[a36_0x415924(0x149)](_0x19f5b1){const _0x40fe42=a36_0x415924,_0x4ca340=_0x19f5b1[_0x40fe42(0x147)]();if(_0x4ca340===_0x40fe42(0x19a))return 0x1;try{const _0x237029=await database_1[_0x40fe42(0x1af)][_0x40fe42(0x19f)]['findUnique']({'where':{'currency':_0x4ca340}});if(!_0x237029)return console[_0x40fe42(0x165)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x19f5b1+_0x40fe42(0x1a9)),0x1;return _0x237029[_0x40fe42(0x17c)];}catch(_0x211b85){return console[_0x40fe42(0x139)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x19f5b1+':',_0x211b85),0x1;}}async[a36_0x415924(0x1aa)](_0x2eb033,_0xf42b59){const _0x3cdda1=a36_0x415924,_0x52a3f3=_0xf42b59[_0x3cdda1(0x147)]();if(_0x52a3f3==='usdt'){const _0x5ccd5a=_0x2eb033*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x3cdda1(0x1a1)]('ðŸ’±\x20Applied\x20'+this[_0x3cdda1(0x164)]+_0x3cdda1(0x154)+_0x2eb033+'\x20USDT\x20=\x20'+_0x5ccd5a[_0x3cdda1(0x1a0)](0x6)+_0x3cdda1(0x1a7)),_0x5ccd5a;}try{const _0x2c0c13=await this['getCurrencyRate'](_0x52a3f3),_0x40b81b=_0x2eb033/_0x2c0c13,_0x59450a=_0x40b81b*(0x1+this[_0x3cdda1(0x164)]/0x64);return console['log'](_0x3cdda1(0x18b)+_0x2eb033+'\x20'+_0xf42b59['toUpperCase']()+'\x20to\x20'+_0x40b81b[_0x3cdda1(0x1a0)](0x6)+_0x3cdda1(0x173)+this[_0x3cdda1(0x164)]+_0x3cdda1(0x14f)+_0x59450a[_0x3cdda1(0x1a0)](0x6)+'\x20USDT\x20(rate:\x20'+_0x2c0c13+')'),_0x59450a;}catch(_0x5a1a70){console['error']('Error\x20converting\x20'+_0x2eb033+'\x20'+_0xf42b59+_0x3cdda1(0x14a),_0x5a1a70);const _0x16924e=_0x2eb033*(0x1+this[_0x3cdda1(0x164)]/0x64);return _0x16924e;}}async[a36_0x415924(0x14e)](_0x342af9){const _0x2c546b=a36_0x415924;let _0x16a81f=0x0;for(const {amount:_0x47abd5,currency:_0x230470}of _0x342af9){const _0x204566=await this[_0x2c546b(0x1aa)](_0x47abd5,_0x230470);_0x16a81f+=_0x204566;}return _0x16a81f;}async[a36_0x415924(0x1ac)](){const _0x51ce9b=a36_0x415924;try{const _0x390ff7=await database_1['default'][_0x51ce9b(0x19f)][_0x51ce9b(0x148)]({'select':{'currency':!![],'rate':!![]}}),_0x318f7c={'usdt':0x1};return _0x390ff7[_0x51ce9b(0x16b)](_0x4a2b7c=>{const _0x225d7e=_0x51ce9b;_0x318f7c[_0x4a2b7c[_0x225d7e(0x19d)]]=_0x4a2b7c[_0x225d7e(0x17c)];}),_0x318f7c;}catch(_0x37af5a){return console['error'](_0x51ce9b(0x190),_0x37af5a),{'usdt':0x1};}}async['getRatesStatus'](){const _0x1beca0=a36_0x415924;try{const [_0x2c6cf3,_0xb38637,_0x2328dd]=await Promise[_0x1beca0(0x151)]([database_1[_0x1beca0(0x1af)]['currencyRate'][_0x1beca0(0x141)](),database_1[_0x1beca0(0x1af)][_0x1beca0(0x19f)][_0x1beca0(0x169)]({'orderBy':{'updatedAt':_0x1beca0(0x155)},'select':{'updatedAt':!![]}}),database_1[_0x1beca0(0x1af)][_0x1beca0(0x19f)][_0x1beca0(0x169)]({'orderBy':{'updatedAt':_0x1beca0(0x14d)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2c6cf3,'lastUpdated':_0xb38637?.['updatedAt']||null,'oldestRate':_0x2328dd?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x537bbc){return console[_0x1beca0(0x139)]('Error\x20getting\x20rates\x20status:',_0x537bbc),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1beca0(0x164)]};}}[a36_0x415924(0x16e)](){return this['MARKUP_PERCENTAGE'];}}exports[a36_0x415924(0x140)]=CurrencyService,exports[a36_0x415924(0x185)]=new CurrencyService();