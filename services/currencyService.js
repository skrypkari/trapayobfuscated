'use strict';const a43_0x45c0ea=a43_0xea81;(function(_0x38a724,_0x573fee){const _0x190ce7=a43_0xea81,_0x1abada=_0x38a724();while(!![]){try{const _0x32be81=-parseInt(_0x190ce7(0xe2))/0x1*(-parseInt(_0x190ce7(0x125))/0x2)+parseInt(_0x190ce7(0xdd))/0x3*(parseInt(_0x190ce7(0x10b))/0x4)+parseInt(_0x190ce7(0xf5))/0x5+-parseInt(_0x190ce7(0x149))/0x6+-parseInt(_0x190ce7(0x14d))/0x7*(parseInt(_0x190ce7(0x108))/0x8)+-parseInt(_0x190ce7(0x112))/0x9+-parseInt(_0x190ce7(0x145))/0xa;if(_0x32be81===_0x573fee)break;else _0x1abada['push'](_0x1abada['shift']());}catch(_0x49ee2e){_0x1abada['push'](_0x1abada['shift']());}}}(a43_0x16e6,0xaf87f));var __importDefault=this&&this[a43_0x45c0ea(0x10e)]||function(_0x12c3b2){const _0x2cad12=a43_0x45c0ea;return _0x12c3b2&&_0x12c3b2[_0x2cad12(0xeb)]?_0x12c3b2:{'default':_0x12c3b2};};Object[a43_0x45c0ea(0x132)](exports,a43_0x45c0ea(0xeb),{'value':!![]}),exports['currencyService']=exports[a43_0x45c0ea(0x137)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a43_0xea81(_0x564469,_0x33297c){const _0x16e655=a43_0x16e6();return a43_0xea81=function(_0xea8161,_0x17504e){_0xea8161=_0xea8161-0xd6;let _0x5cd430=_0x16e655[_0xea8161];return _0x5cd430;},a43_0xea81(_0x564469,_0x33297c);}function a43_0x16e6(){const _0x5c2879=['xdr','bmd','34GKHflw','allSettled','Error\x20getting\x20rates\x20status:','kwd','lkr','krw','Error\x20getting\x20rate\x20for\x20currency\x20','toUpperCase','updateCurrencyRates','gel','convertMultipleToUSDT','idr','currencyRate','defineProperty','mxn','ils','myr','all','CurrencyService','No\x20rate\x20found\x20for\x20currency:\x20','Periodic\x20currency\x20rates\x20update\x20failed:','aud','✅\x20Currency\x20rates\x20updated\x20successfully','yfi','💱\x20Applied\x20','bhd','xau','gbp','uah','pkr','log','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','3145590ZpsaXP',',\x20using\x201\x20as\x20fallback','entries','btc','3090930LtBupZ','❌\x20Failed\x20to\x20update\x20currency\x20rates:','sats','startPeriodicUpdates','7OLiLeb','inr','clp','rub','%\x20markup\x20=\x20','findFirst','application/json','eth','aed','%\x20markup\x20to\x20','warn','getCurrencyRate','upsert','json','xrp','vef','hkd','usdt','223251XVBZdN','join','length','vnd','dot','46576JEaYQK','getMarkupPercentage','findUnique','\x20USDT\x20(rate:\x20','sar','Error\x20converting\x20','convertToUSDT','brl','updateInterval','__esModule','toFixed','try','xag','?ids=tether&vs_currencies=','getAllRates','forEach','statusText','ngn','\x20to\x20','4790880pjpVBu','https://api.coingecko.com/api/v3/simple/price','\x20to\x20USDT:','Payment\x20System/1.0','Error\x20getting\x20all\x20rates:','desc','sek','eos','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','MARKUP_PERCENTAGE','nok','chf','findMany','huf','count','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Failed\x20to\x20update\x20rate\x20for\x20','tether','usd','4541528CLjVZo','💱\x20Converted\x20','bch','56hGfjTt','COINGECKO_URL','📊\x20Received\x20rates\x20for\x20','__importDefault','nzd','error','updatedAt','6078834QVCYQQ','mmk','toLowerCase','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','jpy','status','thb','asc','zar','ars','ltc','default','getRatesStatus','\x20USDT,\x20with\x20','\x20currencies','rate','CURRENCIES'];a43_0x16e6=function(){return _0x5c2879;};return a43_0x16e6();}class CurrencyService{constructor(){const _0x4d8867=a43_0x45c0ea;this[_0x4d8867(0x10c)]=_0x4d8867(0xf6),this[_0x4d8867(0x122)]=[_0x4d8867(0x148),_0x4d8867(0x154),_0x4d8867(0x11c),_0x4d8867(0x10a),'bnb',_0x4d8867(0xfc),_0x4d8867(0xd9),'xlm','link',_0x4d8867(0xe1),_0x4d8867(0x13c),_0x4d8867(0x107),_0x4d8867(0x155),_0x4d8867(0x11b),_0x4d8867(0x13a),'bdt',_0x4d8867(0x13e),_0x4d8867(0x124),_0x4d8867(0xe9),'cad',_0x4d8867(0x100),_0x4d8867(0x14f),'cny','czk','dkk','eur',_0x4d8867(0x140),_0x4d8867(0x12e),_0x4d8867(0xdb),_0x4d8867(0x102),_0x4d8867(0x130),_0x4d8867(0x134),_0x4d8867(0x14e),_0x4d8867(0x116),_0x4d8867(0x12a),_0x4d8867(0x128),_0x4d8867(0x129),_0x4d8867(0x113),_0x4d8867(0x133),_0x4d8867(0x135),_0x4d8867(0xf3),_0x4d8867(0xff),_0x4d8867(0x10f),'php',_0x4d8867(0x142),'pln',_0x4d8867(0x150),_0x4d8867(0xe6),_0x4d8867(0xfb),'sgd',_0x4d8867(0x118),_0x4d8867(0xed),'twd',_0x4d8867(0x141),_0x4d8867(0xda),_0x4d8867(0xe0),_0x4d8867(0x11a),_0x4d8867(0x123),_0x4d8867(0xee),_0x4d8867(0x13f),'bits',_0x4d8867(0x14b)],this['updateInterval']=null,this[_0x4d8867(0xfe)]=-0x3,this[_0x4d8867(0x14c)]();}['startPeriodicUpdates'](){const _0x5af8f7=a43_0x45c0ea;this[_0x5af8f7(0x12d)]()['catch'](_0x4c0ac6=>{const _0x2ea84f=_0x5af8f7;console[_0x2ea84f(0x110)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x4c0ac6);}),this['updateInterval']=setInterval(async()=>{const _0x15a09=_0x5af8f7;try{await this[_0x15a09(0x12d)]();}catch(_0x47eabf){console['error'](_0x15a09(0x139),_0x47eabf);}},0x3c*0x3c*0x3e8),console['log'](_0x5af8f7(0x144));}['stopPeriodicUpdates'](){const _0x1bc249=a43_0x45c0ea;this[_0x1bc249(0xea)]&&(clearInterval(this[_0x1bc249(0xea)]),this[_0x1bc249(0xea)]=null,console[_0x1bc249(0x143)](_0x1bc249(0x115)));}async[a43_0x45c0ea(0x12d)](){const _0x563ca8=a43_0x45c0ea;try{console['log'](_0x563ca8(0x104));const _0x11be51=this[_0x563ca8(0x122)][_0x563ca8(0xde)](','),_0xaafb48=this[_0x563ca8(0x10c)]+_0x563ca8(0xef)+_0x11be51,_0x1663d6=await fetch(_0xaafb48,{'headers':{'Accept':_0x563ca8(0x153),'User-Agent':_0x563ca8(0xf8)}});if(!_0x1663d6['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x1663d6[_0x563ca8(0x117)]+'\x20'+_0x1663d6[_0x563ca8(0xf2)]);const _0x5bff27=await _0x1663d6[_0x563ca8(0xd8)]();if(!_0x5bff27['tether'])throw new Error(_0x563ca8(0xfd));const _0x24064a=_0x5bff27[_0x563ca8(0x106)];console[_0x563ca8(0x143)](_0x563ca8(0x10d)+Object['keys'](_0x24064a)[_0x563ca8(0xdf)]+_0x563ca8(0x120));const _0x300153=Object[_0x563ca8(0x147)](_0x24064a)['map'](async([_0x5fc6c7,_0x3c849c])=>{const _0x2299b0=_0x563ca8;try{await database_1[_0x2299b0(0x11d)][_0x2299b0(0x131)][_0x2299b0(0xd7)]({'where':{'currency':_0x5fc6c7[_0x2299b0(0x114)]()},'update':{'rate':_0x3c849c},'create':{'currency':_0x5fc6c7['toLowerCase'](),'rate':_0x3c849c}});}catch(_0x397199){console[_0x2299b0(0x110)](_0x2299b0(0x105)+_0x5fc6c7+':',_0x397199);}});await Promise[_0x563ca8(0x126)](_0x300153),console[_0x563ca8(0x143)](_0x563ca8(0x13b));}catch(_0xa71d26){console['error'](_0x563ca8(0x14a),_0xa71d26);throw _0xa71d26;}}async[a43_0x45c0ea(0xd6)](_0x1fe221){const _0x248c02=a43_0x45c0ea,_0x58f660=_0x1fe221[_0x248c02(0x114)]();if(_0x58f660==='usdt')return 0x1;try{const _0x37b308=await database_1[_0x248c02(0x11d)][_0x248c02(0x131)][_0x248c02(0xe4)]({'where':{'currency':_0x58f660}});if(!_0x37b308)return console[_0x248c02(0x157)](_0x248c02(0x138)+_0x1fe221+_0x248c02(0x146)),0x1;return _0x37b308[_0x248c02(0x121)];}catch(_0x3da16a){return console[_0x248c02(0x110)](_0x248c02(0x12b)+_0x1fe221+':',_0x3da16a),0x1;}}async['convertToUSDT'](_0x3980e8,_0x4d5293){const _0x52b4cb=a43_0x45c0ea,_0x4fc9dc=_0x4d5293['toLowerCase']();if(_0x4fc9dc===_0x52b4cb(0xdc)){const _0xb9af71=_0x3980e8*(0x1+this[_0x52b4cb(0xfe)]/0x64);return console['log'](_0x52b4cb(0x13d)+this[_0x52b4cb(0xfe)]+_0x52b4cb(0x156)+_0x3980e8+'\x20USDT\x20=\x20'+_0xb9af71[_0x52b4cb(0xec)](0x6)+'\x20USDT'),_0xb9af71;}try{const _0x192610=await this['getCurrencyRate'](_0x4fc9dc),_0x595f57=_0x3980e8/_0x192610,_0x48c998=_0x595f57*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x52b4cb(0x143)](_0x52b4cb(0x109)+_0x3980e8+'\x20'+_0x4d5293[_0x52b4cb(0x12c)]()+_0x52b4cb(0xf4)+_0x595f57[_0x52b4cb(0xec)](0x6)+_0x52b4cb(0x11f)+this[_0x52b4cb(0xfe)]+_0x52b4cb(0x151)+_0x48c998[_0x52b4cb(0xec)](0x6)+_0x52b4cb(0xe5)+_0x192610+')'),_0x48c998;}catch(_0x1805ca){console[_0x52b4cb(0x110)](_0x52b4cb(0xe7)+_0x3980e8+'\x20'+_0x4d5293+_0x52b4cb(0xf7),_0x1805ca);const _0x56ed9f=_0x3980e8*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x56ed9f;}}async[a43_0x45c0ea(0x12f)](_0x40937b){const _0xda0bb1=a43_0x45c0ea;let _0x326647=0x0;for(const {amount:_0x5edc0c,currency:_0x58c2af}of _0x40937b){const _0x40c405=await this[_0xda0bb1(0xe8)](_0x5edc0c,_0x58c2af);_0x326647+=_0x40c405;}return _0x326647;}async[a43_0x45c0ea(0xf0)](){const _0x5d6cd0=a43_0x45c0ea;try{const _0x1874f1=await database_1[_0x5d6cd0(0x11d)]['currencyRate'][_0x5d6cd0(0x101)]({'select':{'currency':!![],'rate':!![]}}),_0x33e9e9={'usdt':0x1};return _0x1874f1[_0x5d6cd0(0xf1)](_0x10d06c=>{_0x33e9e9[_0x10d06c['currency']]=_0x10d06c['rate'];}),_0x33e9e9;}catch(_0x15b03a){return console[_0x5d6cd0(0x110)](_0x5d6cd0(0xf9),_0x15b03a),{'usdt':0x1};}}async[a43_0x45c0ea(0x11e)](){const _0x50ac92=a43_0x45c0ea;try{const [_0xebed8d,_0x5e4c0a,_0x4cba53]=await Promise[_0x50ac92(0x136)]([database_1[_0x50ac92(0x11d)]['currencyRate'][_0x50ac92(0x103)](),database_1[_0x50ac92(0x11d)]['currencyRate'][_0x50ac92(0x152)]({'orderBy':{'updatedAt':_0x50ac92(0xfa)},'select':{'updatedAt':!![]}}),database_1[_0x50ac92(0x11d)][_0x50ac92(0x131)][_0x50ac92(0x152)]({'orderBy':{'updatedAt':_0x50ac92(0x119)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xebed8d,'lastUpdated':_0x5e4c0a?.[_0x50ac92(0x111)]||null,'oldestRate':_0x4cba53?.['updatedAt']||null,'markupPercentage':this[_0x50ac92(0xfe)]};}catch(_0x366562){return console[_0x50ac92(0x110)](_0x50ac92(0x127),_0x366562),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a43_0x45c0ea(0xe3)](){const _0x1483a3=a43_0x45c0ea;return this[_0x1483a3(0xfe)];}}exports[a43_0x45c0ea(0x137)]=CurrencyService,exports['currencyService']=new CurrencyService();