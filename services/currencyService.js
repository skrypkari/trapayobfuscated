'use strict';const a51_0x8f6185=a51_0x1f43;function a51_0xccac(){const _0xa03e9a=['\x20to\x20','Error\x20getting\x20all\x20rates:','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','%\x20markup\x20to\x20','No\x20rate\x20found\x20for\x20currency:\x20','pln','CoinGecko\x20API\x20error:\x20','ðŸ’±\x20Converted\x20','catch','updatedAt','3bnkzYv','convertMultipleToUSDT','?ids=tether&vs_currencies=','zar','findFirst','aed','__importDefault','map','MARKUP_PERCENTAGE','gbp','lkr','twd','log','join','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','ils','length','COINGECKO_URL','\x20USDT','bnb','myr','forEach','idr','krw','bhd','desc','eth','Payment\x20System/1.0','inr','getAllRates','627910wswcvm','usd','607327NtOPUT','xau','convertToUSDT','clp','Initial\x20currency\x20rates\x20update\x20failed:','default','49600XnBTbE','bdt','toLowerCase','thb','huf',',\x20using\x201\x20as\x20fallback','getRatesStatus','startPeriodicUpdates','sgd','getMarkupPercentage','status','currency','mxn','\x20currencies','xag','Error\x20getting\x20rate\x20for\x20currency\x20','updateCurrencyRates','php','CurrencyService','entries','mmk','sek','findMany','pkr','stopPeriodicUpdates','json','Failed\x20to\x20update\x20rate\x20for\x20','180dngHKO','xlm','6LMoBho','statusText','bch','82586RvyAtN','updateInterval','Periodic\x20currency\x20rates\x20update\x20failed:','all','tether','czk','\x20USDT,\x20with\x20','2981675bIUCQe','CURRENCIES','ðŸ“Š\x20Received\x20rates\x20for\x20','uah','ngn','warn','dot','\x20USDT\x20=\x20','getCurrencyRate','âœ…\x20Currency\x20rates\x20updated\x20successfully','1284724fJIXYG','vef','yfi','currencyService','toUpperCase','\x20USDT\x20(rate:\x20','11246770gqZJVE','rub','currencyRate','kwd','rate','jpy','Error\x20getting\x20rates\x20status:','\x20to\x20USDT:','__esModule','xdr','chf','findUnique','count','bits','vnd','allSettled','Error\x20converting\x20','ltc','error','../config/database','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','usdt','eos'];a51_0xccac=function(){return _0xa03e9a;};return a51_0xccac();}(function(_0x19e934,_0x452881){const _0x1737e3=a51_0x1f43,_0x4e5863=_0x19e934();while(!![]){try{const _0x4d8526=parseInt(_0x1737e3(0x1bd))/0x1+-parseInt(_0x1737e3(0x1e5))/0x2+parseInt(_0x1737e3(0x19f))/0x3*(parseInt(_0x1737e3(0x1f6))/0x4)+parseInt(_0x1737e3(0x1ec))/0x5+-parseInt(_0x1737e3(0x1e2))/0x6*(-parseInt(_0x1737e3(0x1bf))/0x7)+-parseInt(_0x1737e3(0x1c5))/0x8*(parseInt(_0x1737e3(0x1e0))/0x9)+-parseInt(_0x1737e3(0x1fc))/0xa;if(_0x4d8526===_0x452881)break;else _0x4e5863['push'](_0x4e5863['shift']());}catch(_0x132997){_0x4e5863['push'](_0x4e5863['shift']());}}}(a51_0xccac,0x538c9));var __importDefault=this&&this[a51_0x8f6185(0x1a5)]||function(_0x3db3ac){const _0x514f05=a51_0x8f6185;return _0x3db3ac&&_0x3db3ac[_0x514f05(0x204)]?_0x3db3ac:{'default':_0x3db3ac};};Object['defineProperty'](exports,a51_0x8f6185(0x204),{'value':!![]}),exports['currencyService']=exports[a51_0x8f6185(0x1d7)]=void 0x0;const database_1=__importDefault(require(a51_0x8f6185(0x20f)));class CurrencyService{constructor(){const _0x223adf=a51_0x8f6185;this[_0x223adf(0x1b0)]='https://api.coingecko.com/api/v3/simple/price',this[_0x223adf(0x1ed)]=['btc',_0x223adf(0x1b9),_0x223adf(0x20d),_0x223adf(0x1e4),_0x223adf(0x1b2),_0x223adf(0x212),'xrp',_0x223adf(0x1e1),'link',_0x223adf(0x1f2),_0x223adf(0x1f8),_0x223adf(0x1be),_0x223adf(0x1a4),'ars','aud',_0x223adf(0x1c6),_0x223adf(0x1b7),'bmd','brl','cad',_0x223adf(0x206),_0x223adf(0x1c2),'cny',_0x223adf(0x1ea),'dkk','eur',_0x223adf(0x1a8),'gel','hkd',_0x223adf(0x1c9),_0x223adf(0x1b5),_0x223adf(0x1ae),_0x223adf(0x1bb),_0x223adf(0x201),_0x223adf(0x1b6),_0x223adf(0x1ff),_0x223adf(0x1a9),_0x223adf(0x1d9),_0x223adf(0x1d1),_0x223adf(0x1b3),_0x223adf(0x1f0),'nok','nzd',_0x223adf(0x1d6),_0x223adf(0x1dc),_0x223adf(0x218),_0x223adf(0x1fd),'sar',_0x223adf(0x1da),_0x223adf(0x1cd),_0x223adf(0x1c8),'try',_0x223adf(0x1aa),_0x223adf(0x1ef),_0x223adf(0x1f7),_0x223adf(0x20a),_0x223adf(0x1a2),_0x223adf(0x205),_0x223adf(0x1d3),_0x223adf(0x1c0),_0x223adf(0x209),'sats'],this['updateInterval']=null,this[_0x223adf(0x1a7)]=-0x3,this[_0x223adf(0x1cc)]();}['startPeriodicUpdates'](){const _0x360197=a51_0x8f6185;this[_0x360197(0x1d5)]()[_0x360197(0x21b)](_0x3a58ad=>{const _0x4fda1a=_0x360197;console['error'](_0x4fda1a(0x1c3),_0x3a58ad);}),this[_0x360197(0x1e6)]=setInterval(async()=>{const _0x3f98bb=_0x360197;try{await this[_0x3f98bb(0x1d5)]();}catch(_0x4a6e11){console[_0x3f98bb(0x20e)](_0x3f98bb(0x1e7),_0x4a6e11);}},0x3c*0x3c*0x3e8),console[_0x360197(0x1ab)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a51_0x8f6185(0x1dd)](){const _0x3dbe2d=a51_0x8f6185;this[_0x3dbe2d(0x1e6)]&&(clearInterval(this[_0x3dbe2d(0x1e6)]),this[_0x3dbe2d(0x1e6)]=null,console['log'](_0x3dbe2d(0x210)));}async['updateCurrencyRates'](){const _0x5f4c55=a51_0x8f6185;try{console[_0x5f4c55(0x1ab)](_0x5f4c55(0x215));const _0xdb23a1=this[_0x5f4c55(0x1ed)][_0x5f4c55(0x1ac)](','),_0x100de4=this[_0x5f4c55(0x1b0)]+_0x5f4c55(0x1a1)+_0xdb23a1,_0x317ecf=await fetch(_0x100de4,{'headers':{'Accept':'application/json','User-Agent':_0x5f4c55(0x1ba)}});if(!_0x317ecf['ok'])throw new Error(_0x5f4c55(0x219)+_0x317ecf[_0x5f4c55(0x1cf)]+'\x20'+_0x317ecf[_0x5f4c55(0x1e3)]);const _0x4f6624=await _0x317ecf[_0x5f4c55(0x1de)]();if(!_0x4f6624[_0x5f4c55(0x1e9)])throw new Error(_0x5f4c55(0x1ad));const _0x1053c5=_0x4f6624[_0x5f4c55(0x1e9)];console[_0x5f4c55(0x1ab)](_0x5f4c55(0x1ee)+Object['keys'](_0x1053c5)[_0x5f4c55(0x1af)]+_0x5f4c55(0x1d2));const _0x36e84c=Object[_0x5f4c55(0x1d8)](_0x1053c5)[_0x5f4c55(0x1a6)](async([_0x28de06,_0xe3e412])=>{const _0x176ef4=_0x5f4c55;try{await database_1[_0x176ef4(0x1c4)][_0x176ef4(0x1fe)]['upsert']({'where':{'currency':_0x28de06['toLowerCase']()},'update':{'rate':_0xe3e412},'create':{'currency':_0x28de06['toLowerCase'](),'rate':_0xe3e412}});}catch(_0x2bc4c3){console[_0x176ef4(0x20e)](_0x176ef4(0x1df)+_0x28de06+':',_0x2bc4c3);}});await Promise[_0x5f4c55(0x20b)](_0x36e84c),console[_0x5f4c55(0x1ab)](_0x5f4c55(0x1f5));}catch(_0x2c8336){console[_0x5f4c55(0x20e)]('âŒ\x20Failed\x20to\x20update\x20currency\x20rates:',_0x2c8336);throw _0x2c8336;}}async[a51_0x8f6185(0x1f4)](_0xee2ba5){const _0x23923f=a51_0x8f6185,_0x293c7c=_0xee2ba5[_0x23923f(0x1c7)]();if(_0x293c7c===_0x23923f(0x211))return 0x1;try{const _0x325b02=await database_1[_0x23923f(0x1c4)][_0x23923f(0x1fe)][_0x23923f(0x207)]({'where':{'currency':_0x293c7c}});if(!_0x325b02)return console[_0x23923f(0x1f1)](_0x23923f(0x217)+_0xee2ba5+_0x23923f(0x1ca)),0x1;return _0x325b02[_0x23923f(0x200)];}catch(_0x49a656){return console[_0x23923f(0x20e)](_0x23923f(0x1d4)+_0xee2ba5+':',_0x49a656),0x1;}}async['convertToUSDT'](_0x554077,_0x799fd5){const _0xa725a6=a51_0x8f6185,_0x101495=_0x799fd5[_0xa725a6(0x1c7)]();if(_0x101495==='usdt'){const _0x27398a=_0x554077*(0x1+this[_0xa725a6(0x1a7)]/0x64);return console['log']('ðŸ’±\x20Applied\x20'+this[_0xa725a6(0x1a7)]+_0xa725a6(0x216)+_0x554077+_0xa725a6(0x1f3)+_0x27398a['toFixed'](0x6)+_0xa725a6(0x1b1)),_0x27398a;}try{const _0xbc2ec8=await this[_0xa725a6(0x1f4)](_0x101495),_0x402721=_0x554077/_0xbc2ec8,_0x2d8a0a=_0x402721*(0x1+this[_0xa725a6(0x1a7)]/0x64);return console[_0xa725a6(0x1ab)](_0xa725a6(0x21a)+_0x554077+'\x20'+_0x799fd5[_0xa725a6(0x1fa)]()+_0xa725a6(0x213)+_0x402721['toFixed'](0x6)+_0xa725a6(0x1eb)+this[_0xa725a6(0x1a7)]+'%\x20markup\x20=\x20'+_0x2d8a0a['toFixed'](0x6)+_0xa725a6(0x1fb)+_0xbc2ec8+')'),_0x2d8a0a;}catch(_0x3ee810){console[_0xa725a6(0x20e)](_0xa725a6(0x20c)+_0x554077+'\x20'+_0x799fd5+_0xa725a6(0x203),_0x3ee810);const _0x5bc596=_0x554077*(0x1+this[_0xa725a6(0x1a7)]/0x64);return _0x5bc596;}}async[a51_0x8f6185(0x1a0)](_0x4295fc){const _0x42873a=a51_0x8f6185;let _0x473613=0x0;for(const {amount:_0x27a645,currency:_0x117c4d}of _0x4295fc){const _0x1ade90=await this[_0x42873a(0x1c1)](_0x27a645,_0x117c4d);_0x473613+=_0x1ade90;}return _0x473613;}async[a51_0x8f6185(0x1bc)](){const _0x23bded=a51_0x8f6185;try{const _0x2b43ef=await database_1[_0x23bded(0x1c4)][_0x23bded(0x1fe)][_0x23bded(0x1db)]({'select':{'currency':!![],'rate':!![]}}),_0xdf94ab={'usdt':0x1};return _0x2b43ef[_0x23bded(0x1b4)](_0x4b3628=>{const _0x1606ef=_0x23bded;_0xdf94ab[_0x4b3628[_0x1606ef(0x1d0)]]=_0x4b3628[_0x1606ef(0x200)];}),_0xdf94ab;}catch(_0x43d3c0){return console[_0x23bded(0x20e)](_0x23bded(0x214),_0x43d3c0),{'usdt':0x1};}}async[a51_0x8f6185(0x1cb)](){const _0x39db90=a51_0x8f6185;try{const [_0x2c6050,_0x4f3772,_0x3bdce4]=await Promise[_0x39db90(0x1e8)]([database_1[_0x39db90(0x1c4)][_0x39db90(0x1fe)][_0x39db90(0x208)](),database_1[_0x39db90(0x1c4)][_0x39db90(0x1fe)]['findFirst']({'orderBy':{'updatedAt':_0x39db90(0x1b8)},'select':{'updatedAt':!![]}}),database_1[_0x39db90(0x1c4)][_0x39db90(0x1fe)][_0x39db90(0x1a3)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2c6050,'lastUpdated':_0x4f3772?.[_0x39db90(0x21c)]||null,'oldestRate':_0x3bdce4?.[_0x39db90(0x21c)]||null,'markupPercentage':this[_0x39db90(0x1a7)]};}catch(_0x4d232f){return console[_0x39db90(0x20e)](_0x39db90(0x202),_0x4d232f),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x39db90(0x1a7)]};}}[a51_0x8f6185(0x1ce)](){const _0x5ededb=a51_0x8f6185;return this[_0x5ededb(0x1a7)];}}function a51_0x1f43(_0x4ec8d0,_0x54c679){_0x4ec8d0=_0x4ec8d0-0x19f;const _0xccacc7=a51_0xccac();let _0x1f4315=_0xccacc7[_0x4ec8d0];return _0x1f4315;}exports[a51_0x8f6185(0x1d7)]=CurrencyService,exports[a51_0x8f6185(0x1f9)]=new CurrencyService();