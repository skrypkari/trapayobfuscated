'use strict';const a36_0x320d59=a36_0x12a3;function a36_0x12a3(_0x13c014,_0x477d5f){const _0x2c4523=a36_0x2c45();return a36_0x12a3=function(_0x12a37a,_0xc6244c){_0x12a37a=_0x12a37a-0x112;let _0x3201d4=_0x2c4523[_0x12a37a];return _0x3201d4;},a36_0x12a3(_0x13c014,_0x477d5f);}(function(_0x12a528,_0x157f12){const _0x5229af=a36_0x12a3,_0x4eec8d=_0x12a528();while(!![]){try{const _0x1703f3=-parseInt(_0x5229af(0x16a))/0x1+-parseInt(_0x5229af(0x133))/0x2*(parseInt(_0x5229af(0x167))/0x3)+parseInt(_0x5229af(0x11e))/0x4+-parseInt(_0x5229af(0x17f))/0x5*(-parseInt(_0x5229af(0x179))/0x6)+parseInt(_0x5229af(0x147))/0x7+-parseInt(_0x5229af(0x12e))/0x8*(parseInt(_0x5229af(0x164))/0x9)+-parseInt(_0x5229af(0x146))/0xa;if(_0x1703f3===_0x157f12)break;else _0x4eec8d['push'](_0x4eec8d['shift']());}catch(_0x3dc9fe){_0x4eec8d['push'](_0x4eec8d['shift']());}}}(a36_0x2c45,0x273ab));var __importDefault=this&&this['__importDefault']||function(_0x480019){const _0x7acb8c=a36_0x12a3;return _0x480019&&_0x480019[_0x7acb8c(0x15a)]?_0x480019:{'default':_0x480019};};function a36_0x2c45(){const _0x33fb0=['✅\x20Currency\x20rates\x20updated\x20successfully','vnd','usd','825640eXuQGR','\x20currencies','entries','Error\x20getting\x20all\x20rates:','updateCurrencyRates','2KXADrx','Error\x20getting\x20rates\x20status:','https://api.coingecko.com/api/v3/simple/price','bch','sgd','xag','ils','updatedAt','getAllRates','pkr','allSettled','currencyRate','Initial\x20currency\x20rates\x20update\x20failed:','keys','💱\x20Converted\x20','sek','chf','all','join','100470fpKmys','1427825lTJxAd','rate','czk','brl','gbp','COINGECKO_URL','defineProperty','\x20to\x20','MARKUP_PERCENTAGE','TesSoft\x20Payment\x20System/1.0','aed','tether','Error\x20getting\x20rate\x20for\x20currency\x20','convertMultipleToUSDT','error','convertToUSDT','No\x20rate\x20found\x20for\x20currency:\x20','getCurrencyRate','yfi','__esModule','thb','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','bdt','nzd','toFixed','nok','inr','warn','mxn','9vhpPol','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','ltc','823053wyhPYs','status','btc','142083kCvffy','getMarkupPercentage','eth','currencyService','bits','xau','lkr','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','ars','vef','findFirst','rub','twd','application/json','bnb','288AuQyxN','try','CURRENCIES','currency','Periodic\x20currency\x20rates\x20update\x20failed:','updateInterval','25495RyOfui','hkd','CurrencyService','toLowerCase','json','jpy','default','findUnique','Error\x20converting\x20','bmd','zar','cad','../config/database','bhd','ngn','catch','link','aud','dot','clp','xrp','966568ozUinU','usdt','findMany','php','%\x20markup\x20=\x20','getRatesStatus','xdr','log','huf','forEach',',\x20using\x201\x20as\x20fallback','eos','Failed\x20to\x20update\x20rate\x20for\x20'];a36_0x2c45=function(){return _0x33fb0;};return a36_0x2c45();}Object[a36_0x320d59(0x14d)](exports,a36_0x320d59(0x15a),{'value':!![]}),exports[a36_0x320d59(0x16d)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a36_0x320d59(0x115)));class CurrencyService{constructor(){const _0x1d8e12=a36_0x320d59;this[_0x1d8e12(0x14c)]=_0x1d8e12(0x135),this[_0x1d8e12(0x17b)]=[_0x1d8e12(0x169),_0x1d8e12(0x16c),_0x1d8e12(0x166),_0x1d8e12(0x136),_0x1d8e12(0x178),_0x1d8e12(0x129),_0x1d8e12(0x11d),'xlm',_0x1d8e12(0x119),_0x1d8e12(0x11b),_0x1d8e12(0x159),_0x1d8e12(0x12d),_0x1d8e12(0x151),_0x1d8e12(0x172),_0x1d8e12(0x11a),_0x1d8e12(0x15d),_0x1d8e12(0x116),_0x1d8e12(0x112),_0x1d8e12(0x14a),_0x1d8e12(0x114),_0x1d8e12(0x143),_0x1d8e12(0x11c),'cny',_0x1d8e12(0x149),'dkk','eur',_0x1d8e12(0x14b),'gel',_0x1d8e12(0x180),_0x1d8e12(0x126),'idr',_0x1d8e12(0x139),_0x1d8e12(0x161),_0x1d8e12(0x184),'krw','kwd',_0x1d8e12(0x170),'mmk',_0x1d8e12(0x163),'myr',_0x1d8e12(0x117),_0x1d8e12(0x160),_0x1d8e12(0x15e),_0x1d8e12(0x121),_0x1d8e12(0x13c),'pln',_0x1d8e12(0x175),'sar',_0x1d8e12(0x142),_0x1d8e12(0x137),_0x1d8e12(0x15b),_0x1d8e12(0x17a),_0x1d8e12(0x176),'uah',_0x1d8e12(0x173),_0x1d8e12(0x12c),_0x1d8e12(0x113),_0x1d8e12(0x124),_0x1d8e12(0x138),_0x1d8e12(0x16f),_0x1d8e12(0x16e),'sats'],this['updateInterval']=null,this[_0x1d8e12(0x14f)]=0x3,this['startPeriodicUpdates']();}['startPeriodicUpdates'](){const _0x26bf25=a36_0x320d59;this[_0x26bf25(0x132)]()[_0x26bf25(0x118)](_0x441cec=>{const _0x54f9a3=_0x26bf25;console[_0x54f9a3(0x155)](_0x54f9a3(0x13f),_0x441cec);}),this[_0x26bf25(0x17e)]=setInterval(async()=>{const _0xb16b3a=_0x26bf25;try{await this[_0xb16b3a(0x132)]();}catch(_0x40ce6f){console['error'](_0xb16b3a(0x17d),_0x40ce6f);}},0x3c*0x3c*0x3e8),console[_0x26bf25(0x125)](_0x26bf25(0x171));}['stopPeriodicUpdates'](){const _0x2b2d02=a36_0x320d59;this[_0x2b2d02(0x17e)]&&(clearInterval(this['updateInterval']),this[_0x2b2d02(0x17e)]=null,console[_0x2b2d02(0x125)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0xd74b26=a36_0x320d59;try{console['log'](_0xd74b26(0x165));const _0x11d635=this[_0xd74b26(0x17b)][_0xd74b26(0x145)](','),_0x136ce5=this[_0xd74b26(0x14c)]+'?ids=tether&vs_currencies='+_0x11d635,_0x7669ec=await fetch(_0x136ce5,{'headers':{'Accept':_0xd74b26(0x177),'User-Agent':_0xd74b26(0x150)}});if(!_0x7669ec['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x7669ec[_0xd74b26(0x168)]+'\x20'+_0x7669ec['statusText']);const _0x1d3e08=await _0x7669ec[_0xd74b26(0x183)]();if(!_0x1d3e08[_0xd74b26(0x152)])throw new Error(_0xd74b26(0x15c));const _0x2319e2=_0x1d3e08[_0xd74b26(0x152)];console[_0xd74b26(0x125)]('📊\x20Received\x20rates\x20for\x20'+Object[_0xd74b26(0x140)](_0x2319e2)['length']+_0xd74b26(0x12f));const _0x2a6af8=Object[_0xd74b26(0x130)](_0x2319e2)['map'](async([_0x41bf5f,_0x1a313b])=>{const _0x29f280=_0xd74b26;try{await database_1['default'][_0x29f280(0x13e)]['upsert']({'where':{'currency':_0x41bf5f['toLowerCase']()},'update':{'rate':_0x1a313b},'create':{'currency':_0x41bf5f[_0x29f280(0x182)](),'rate':_0x1a313b}});}catch(_0x1f66a3){console[_0x29f280(0x155)](_0x29f280(0x12a)+_0x41bf5f+':',_0x1f66a3);}});await Promise[_0xd74b26(0x13d)](_0x2a6af8),console[_0xd74b26(0x125)](_0xd74b26(0x12b));}catch(_0x21145a){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x21145a);throw _0x21145a;}}async[a36_0x320d59(0x158)](_0x5eb7b1){const _0x5c3494=a36_0x320d59,_0x45295f=_0x5eb7b1[_0x5c3494(0x182)]();if(_0x45295f===_0x5c3494(0x11f))return 0x1;try{const _0x1c3089=await database_1[_0x5c3494(0x185)][_0x5c3494(0x13e)][_0x5c3494(0x186)]({'where':{'currency':_0x45295f}});if(!_0x1c3089)return console[_0x5c3494(0x162)](_0x5c3494(0x157)+_0x5eb7b1+_0x5c3494(0x128)),0x1;return _0x1c3089[_0x5c3494(0x148)];}catch(_0x5957d0){return console[_0x5c3494(0x155)](_0x5c3494(0x153)+_0x5eb7b1+':',_0x5957d0),0x1;}}async[a36_0x320d59(0x156)](_0x319b71,_0x1d14d8){const _0x505573=a36_0x320d59,_0x2f341e=_0x1d14d8[_0x505573(0x182)]();if(_0x2f341e===_0x505573(0x11f)){const _0x3c8269=_0x319b71*(0x1+this[_0x505573(0x14f)]/0x64);return console['log']('💱\x20Applied\x20'+this[_0x505573(0x14f)]+'%\x20markup\x20to\x20'+_0x319b71+'\x20USDT\x20=\x20'+_0x3c8269['toFixed'](0x6)+'\x20USDT'),_0x3c8269;}try{const _0x347cd7=await this['getCurrencyRate'](_0x2f341e),_0x3697bb=_0x319b71/_0x347cd7,_0x3a61c2=_0x3697bb*(0x1+this[_0x505573(0x14f)]/0x64);return console['log'](_0x505573(0x141)+_0x319b71+'\x20'+_0x1d14d8['toUpperCase']()+_0x505573(0x14e)+_0x3697bb['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x505573(0x14f)]+_0x505573(0x122)+_0x3a61c2[_0x505573(0x15f)](0x6)+'\x20USDT\x20(rate:\x20'+_0x347cd7+')'),_0x3a61c2;}catch(_0x2a014a){console[_0x505573(0x155)](_0x505573(0x187)+_0x319b71+'\x20'+_0x1d14d8+'\x20to\x20USDT:',_0x2a014a);const _0x346694=_0x319b71*(0x1+this[_0x505573(0x14f)]/0x64);return _0x346694;}}async[a36_0x320d59(0x154)](_0x5f13a5){const _0x23e880=a36_0x320d59;let _0x2cbd82=0x0;for(const {amount:_0xaffdfd,currency:_0x29bcae}of _0x5f13a5){const _0x12f64c=await this[_0x23e880(0x156)](_0xaffdfd,_0x29bcae);_0x2cbd82+=_0x12f64c;}return _0x2cbd82;}async[a36_0x320d59(0x13b)](){const _0x471ca0=a36_0x320d59;try{const _0x4c07ac=await database_1[_0x471ca0(0x185)]['currencyRate'][_0x471ca0(0x120)]({'select':{'currency':!![],'rate':!![]}}),_0x721bbc={'usdt':0x1};return _0x4c07ac[_0x471ca0(0x127)](_0x5dd696=>{const _0x5ccbc5=_0x471ca0;_0x721bbc[_0x5dd696[_0x5ccbc5(0x17c)]]=_0x5dd696[_0x5ccbc5(0x148)];}),_0x721bbc;}catch(_0x36f853){return console[_0x471ca0(0x155)](_0x471ca0(0x131),_0x36f853),{'usdt':0x1};}}async[a36_0x320d59(0x123)](){const _0x3f7080=a36_0x320d59;try{const [_0x42240a,_0x448575,_0x513086]=await Promise[_0x3f7080(0x144)]([database_1['default'][_0x3f7080(0x13e)]['count'](),database_1['default'][_0x3f7080(0x13e)]['findFirst']({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default'][_0x3f7080(0x13e)][_0x3f7080(0x174)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x42240a,'lastUpdated':_0x448575?.[_0x3f7080(0x13a)]||null,'oldestRate':_0x513086?.[_0x3f7080(0x13a)]||null,'markupPercentage':this[_0x3f7080(0x14f)]};}catch(_0x176141){return console[_0x3f7080(0x155)](_0x3f7080(0x134),_0x176141),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x3f7080(0x14f)]};}}[a36_0x320d59(0x16b)](){const _0x260b21=a36_0x320d59;return this[_0x260b21(0x14f)];}}exports[a36_0x320d59(0x181)]=CurrencyService,exports['currencyService']=new CurrencyService();