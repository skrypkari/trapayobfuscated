'use strict';const a39_0x392a22=a39_0xfd94;(function(_0x8eaae5,_0x128e67){const _0x2dcc0e=a39_0xfd94,_0x4c95b0=_0x8eaae5();while(!![]){try{const _0x15a4d0=-parseInt(_0x2dcc0e(0x1c3))/0x1+-parseInt(_0x2dcc0e(0x197))/0x2*(-parseInt(_0x2dcc0e(0x17f))/0x3)+-parseInt(_0x2dcc0e(0x1e0))/0x4+-parseInt(_0x2dcc0e(0x1e7))/0x5+-parseInt(_0x2dcc0e(0x1be))/0x6*(-parseInt(_0x2dcc0e(0x17b))/0x7)+parseInt(_0x2dcc0e(0x183))/0x8+parseInt(_0x2dcc0e(0x193))/0x9*(-parseInt(_0x2dcc0e(0x182))/0xa);if(_0x15a4d0===_0x128e67)break;else _0x4c95b0['push'](_0x4c95b0['shift']());}catch(_0x35db82){_0x4c95b0['push'](_0x4c95b0['shift']());}}}(a39_0x1e9a,0x24384));function a39_0x1e9a(){const _0x436e06=['Periodic\x20currency\x20rates\x20update\x20failed:','mxn','eth','kwd','sek','MARKUP_PERCENTAGE','\x20USDT,\x20with\x20','zar','bdt','rub','cny','php','getAllRates','CoinGecko\x20API\x20error:\x20','gel','getMarkupPercentage','📊\x20Received\x20rates\x20for\x20','entries','?ids=tether&vs_currencies=','6qNjglZ','czk','all','jpy','startPeriodicUpdates','35385vSmRXH','CurrencyService','uah','✅\x20Currency\x20rates\x20updated\x20successfully','bits','toFixed','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xrp','warn','thb','allSettled','sats','pln','xlm','ils','\x20USDT\x20(rate:\x20','mmk','dkk','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bnb','nok','Error\x20getting\x20rate\x20for\x20currency\x20','vef','xau','updatedAt',',\x20using\x201\x20as\x20fallback','%\x20markup\x20to\x20','pkr','findFirst','506244KcOWBp','getCurrencyRate','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','upsert','eur','Failed\x20to\x20update\x20rate\x20for\x20','💱\x20Applied\x20','910775ZwMxJH','count','default','\x20to\x20USDT:','link','COINGECKO_URL','keys','ngn','bhd','btc','findMany','Initial\x20currency\x20rates\x20update\x20failed:','currency','currencyService','updateInterval','toLowerCase','findUnique','2009329FpPTve','forEach','toUpperCase','chf','390999xQqxEQ','dot','twd','118080dHfFAy','219200MNtZEi','bch','../config/database','defineProperty','convertToUSDT','TesSoft\x20Payment\x20System/1.0','inr','sgd','huf','\x20USDT\x20=\x20','idr','currencyRate','usdt','desc','stopPeriodicUpdates','rate','63SDdQnO','status','aed','xag','4PeTLbA','__importDefault','\x20to\x20','updateCurrencyRates','💱\x20Converted\x20','__esModule','No\x20rate\x20found\x20for\x20currency:\x20','map','error','eos','cad','lkr','json','getRatesStatus','CURRENCIES','aud','Error\x20getting\x20all\x20rates:','\x20currencies','ltc','log'];a39_0x1e9a=function(){return _0x436e06;};return a39_0x1e9a();}var __importDefault=this&&this[a39_0x392a22(0x198)]||function(_0x1a3ee3){const _0x1e88be=a39_0x392a22;return _0x1a3ee3&&_0x1a3ee3[_0x1e88be(0x19c)]?_0x1a3ee3:{'default':_0x1a3ee3};};Object[a39_0x392a22(0x186)](exports,'__esModule',{'value':!![]}),exports[a39_0x392a22(0x177)]=exports[a39_0x392a22(0x1c4)]=void 0x0;const database_1=__importDefault(require(a39_0x392a22(0x185)));function a39_0xfd94(_0x5cdab0,_0x13df1a){const _0x1e9a72=a39_0x1e9a();return a39_0xfd94=function(_0xfd947d,_0x212df2){_0xfd947d=_0xfd947d-0x171;let _0xea649d=_0x1e9a72[_0xfd947d];return _0xea649d;},a39_0xfd94(_0x5cdab0,_0x13df1a);}class CurrencyService{constructor(){const _0x43300c=a39_0x392a22;this[_0x43300c(0x1ec)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=[_0x43300c(0x173),_0x43300c(0x1ad),_0x43300c(0x1a9),_0x43300c(0x184),_0x43300c(0x1d6),_0x43300c(0x1a0),_0x43300c(0x1ca),_0x43300c(0x1d0),_0x43300c(0x1eb),_0x43300c(0x180),'yfi','usd',_0x43300c(0x195),'ars',_0x43300c(0x1a6),_0x43300c(0x1b3),_0x43300c(0x172),'bmd','brl',_0x43300c(0x1a1),_0x43300c(0x17e),'clp',_0x43300c(0x1b5),_0x43300c(0x1bf),_0x43300c(0x1d4),_0x43300c(0x1e4),'gbp',_0x43300c(0x1b9),'hkd',_0x43300c(0x18b),_0x43300c(0x18d),_0x43300c(0x1d1),_0x43300c(0x189),_0x43300c(0x1c1),'krw',_0x43300c(0x1ae),_0x43300c(0x1a2),_0x43300c(0x1d3),_0x43300c(0x1ac),'myr',_0x43300c(0x171),_0x43300c(0x1d7),'nzd',_0x43300c(0x1b6),_0x43300c(0x1de),_0x43300c(0x1cf),_0x43300c(0x1b4),'sar',_0x43300c(0x1af),_0x43300c(0x18a),_0x43300c(0x1cc),'try',_0x43300c(0x181),_0x43300c(0x1c5),_0x43300c(0x1d9),'vnd',_0x43300c(0x1b2),'xdr',_0x43300c(0x196),_0x43300c(0x1da),_0x43300c(0x1c7),_0x43300c(0x1ce)],this['updateInterval']=null,this[_0x43300c(0x1b0)]=-0x3,this[_0x43300c(0x1c2)]();}[a39_0x392a22(0x1c2)](){const _0x2d691b=a39_0x392a22;this[_0x2d691b(0x19a)]()['catch'](_0x476cf3=>{const _0x2b9a17=_0x2d691b;console[_0x2b9a17(0x19f)](_0x2b9a17(0x175),_0x476cf3);}),this['updateInterval']=setInterval(async()=>{const _0x564d25=_0x2d691b;try{await this[_0x564d25(0x19a)]();}catch(_0x409ec6){console['error'](_0x564d25(0x1ab),_0x409ec6);}},0x3c*0x3c*0x3e8),console[_0x2d691b(0x1aa)](_0x2d691b(0x1c9));}[a39_0x392a22(0x191)](){const _0x17e41b=a39_0x392a22;this[_0x17e41b(0x178)]&&(clearInterval(this[_0x17e41b(0x178)]),this[_0x17e41b(0x178)]=null,console[_0x17e41b(0x1aa)](_0x17e41b(0x1e2)));}async['updateCurrencyRates'](){const _0x62de98=a39_0x392a22;try{console[_0x62de98(0x1aa)](_0x62de98(0x1d5));const _0x451476=this[_0x62de98(0x1a5)]['join'](','),_0x51bf7e=this[_0x62de98(0x1ec)]+_0x62de98(0x1bd)+_0x451476,_0x176546=await fetch(_0x51bf7e,{'headers':{'Accept':'application/json','User-Agent':_0x62de98(0x188)}});if(!_0x176546['ok'])throw new Error(_0x62de98(0x1b8)+_0x176546[_0x62de98(0x194)]+'\x20'+_0x176546['statusText']);const _0x1e4e49=await _0x176546[_0x62de98(0x1a3)]();if(!_0x1e4e49['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x2ee89c=_0x1e4e49['tether'];console[_0x62de98(0x1aa)](_0x62de98(0x1bb)+Object[_0x62de98(0x1ed)](_0x2ee89c)['length']+_0x62de98(0x1a8));const _0x37fc38=Object[_0x62de98(0x1bc)](_0x2ee89c)[_0x62de98(0x19e)](async([_0x364304,_0xe86c31])=>{const _0x8fecfa=_0x62de98;try{await database_1[_0x8fecfa(0x1e9)][_0x8fecfa(0x18e)][_0x8fecfa(0x1e3)]({'where':{'currency':_0x364304[_0x8fecfa(0x179)]()},'update':{'rate':_0xe86c31},'create':{'currency':_0x364304[_0x8fecfa(0x179)](),'rate':_0xe86c31}});}catch(_0x506ef8){console[_0x8fecfa(0x19f)](_0x8fecfa(0x1e5)+_0x364304+':',_0x506ef8);}});await Promise[_0x62de98(0x1cd)](_0x37fc38),console[_0x62de98(0x1aa)](_0x62de98(0x1c6));}catch(_0x2786aa){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x2786aa);throw _0x2786aa;}}async[a39_0x392a22(0x1e1)](_0x5ab498){const _0x5f7360=a39_0x392a22,_0x549af2=_0x5ab498[_0x5f7360(0x179)]();if(_0x549af2==='usdt')return 0x1;try{const _0x4060b4=await database_1[_0x5f7360(0x1e9)][_0x5f7360(0x18e)][_0x5f7360(0x17a)]({'where':{'currency':_0x549af2}});if(!_0x4060b4)return console[_0x5f7360(0x1cb)](_0x5f7360(0x19d)+_0x5ab498+_0x5f7360(0x1dc)),0x1;return _0x4060b4[_0x5f7360(0x192)];}catch(_0xc46e42){return console[_0x5f7360(0x19f)](_0x5f7360(0x1d8)+_0x5ab498+':',_0xc46e42),0x1;}}async[a39_0x392a22(0x187)](_0xee04f1,_0x1a21d4){const _0x4cf1d8=a39_0x392a22,_0x453701=_0x1a21d4[_0x4cf1d8(0x179)]();if(_0x453701===_0x4cf1d8(0x18f)){const _0x32792f=_0xee04f1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x4cf1d8(0x1aa)](_0x4cf1d8(0x1e6)+this[_0x4cf1d8(0x1b0)]+_0x4cf1d8(0x1dd)+_0xee04f1+_0x4cf1d8(0x18c)+_0x32792f['toFixed'](0x6)+'\x20USDT'),_0x32792f;}try{const _0x5a590e=await this['getCurrencyRate'](_0x453701),_0xe3f34c=_0xee04f1/_0x5a590e,_0x5c3e19=_0xe3f34c*(0x1+this[_0x4cf1d8(0x1b0)]/0x64);return console['log'](_0x4cf1d8(0x19b)+_0xee04f1+'\x20'+_0x1a21d4[_0x4cf1d8(0x17d)]()+_0x4cf1d8(0x199)+_0xe3f34c[_0x4cf1d8(0x1c8)](0x6)+_0x4cf1d8(0x1b1)+this[_0x4cf1d8(0x1b0)]+'%\x20markup\x20=\x20'+_0x5c3e19[_0x4cf1d8(0x1c8)](0x6)+_0x4cf1d8(0x1d2)+_0x5a590e+')'),_0x5c3e19;}catch(_0x1a147a){console['error']('Error\x20converting\x20'+_0xee04f1+'\x20'+_0x1a21d4+_0x4cf1d8(0x1ea),_0x1a147a);const _0x435b65=_0xee04f1*(0x1+this[_0x4cf1d8(0x1b0)]/0x64);return _0x435b65;}}async['convertMultipleToUSDT'](_0x45dfa4){let _0x4bbd4a=0x0;for(const {amount:_0x2a6a32,currency:_0xe08d90}of _0x45dfa4){const _0x53c795=await this['convertToUSDT'](_0x2a6a32,_0xe08d90);_0x4bbd4a+=_0x53c795;}return _0x4bbd4a;}async[a39_0x392a22(0x1b7)](){const _0x39699a=a39_0x392a22;try{const _0x4731ff=await database_1[_0x39699a(0x1e9)][_0x39699a(0x18e)][_0x39699a(0x174)]({'select':{'currency':!![],'rate':!![]}}),_0x3b4159={'usdt':0x1};return _0x4731ff[_0x39699a(0x17c)](_0x2cba16=>{const _0x5b9ec8=_0x39699a;_0x3b4159[_0x2cba16[_0x5b9ec8(0x176)]]=_0x2cba16[_0x5b9ec8(0x192)];}),_0x3b4159;}catch(_0x42ac00){return console['error'](_0x39699a(0x1a7),_0x42ac00),{'usdt':0x1};}}async[a39_0x392a22(0x1a4)](){const _0x1475a1=a39_0x392a22;try{const [_0x233184,_0x5cd783,_0x39d013]=await Promise[_0x1475a1(0x1c0)]([database_1[_0x1475a1(0x1e9)][_0x1475a1(0x18e)][_0x1475a1(0x1e8)](),database_1['default'][_0x1475a1(0x18e)][_0x1475a1(0x1df)]({'orderBy':{'updatedAt':_0x1475a1(0x190)},'select':{'updatedAt':!![]}}),database_1[_0x1475a1(0x1e9)]['currencyRate'][_0x1475a1(0x1df)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x233184,'lastUpdated':_0x5cd783?.[_0x1475a1(0x1db)]||null,'oldestRate':_0x39d013?.[_0x1475a1(0x1db)]||null,'markupPercentage':this[_0x1475a1(0x1b0)]};}catch(_0x5751ca){return console[_0x1475a1(0x19f)]('Error\x20getting\x20rates\x20status:',_0x5751ca),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x1475a1(0x1b0)]};}}[a39_0x392a22(0x1ba)](){return this['MARKUP_PERCENTAGE'];}}exports[a39_0x392a22(0x1c4)]=CurrencyService,exports[a39_0x392a22(0x177)]=new CurrencyService();