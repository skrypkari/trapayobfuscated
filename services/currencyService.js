'use strict';const a36_0x1310db=a36_0x457c;(function(_0x449943,_0x57bf58){const _0x3e5bcb=a36_0x457c,_0x1aadd0=_0x449943();while(!![]){try{const _0x183012=-parseInt(_0x3e5bcb(0x17d))/0x1+parseInt(_0x3e5bcb(0x186))/0x2*(-parseInt(_0x3e5bcb(0x18d))/0x3)+-parseInt(_0x3e5bcb(0x1c1))/0x4+parseInt(_0x3e5bcb(0x1aa))/0x5*(parseInt(_0x3e5bcb(0x1d5))/0x6)+-parseInt(_0x3e5bcb(0x1a1))/0x7+-parseInt(_0x3e5bcb(0x1be))/0x8+-parseInt(_0x3e5bcb(0x1ab))/0x9*(-parseInt(_0x3e5bcb(0x1a5))/0xa);if(_0x183012===_0x57bf58)break;else _0x1aadd0['push'](_0x1aadd0['shift']());}catch(_0xd46645){_0x1aadd0['push'](_0x1aadd0['shift']());}}}(a36_0x1321,0x88269));var __importDefault=this&&this['__importDefault']||function(_0x402e6e){const _0x362c58=a36_0x457c;return _0x402e6e&&_0x402e6e[_0x362c58(0x183)]?_0x402e6e:{'default':_0x402e6e};};function a36_0x457c(_0x5748ba,_0x346ea5){const _0x1321e5=a36_0x1321();return a36_0x457c=function(_0x457c51,_0x14a2b6){_0x457c51=_0x457c51-0x173;let _0x12be77=_0x1321e5[_0x457c51];return _0x12be77;},a36_0x457c(_0x5748ba,_0x346ea5);}Object[a36_0x1310db(0x1f5)](exports,a36_0x1310db(0x183),{'value':!![]}),exports[a36_0x1310db(0x187)]=exports[a36_0x1310db(0x184)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a36_0x1321(){const _0x4cd636=['allSettled','49041hwmkOL','updateInterval','json','Periodic\x20currency\x20rates\x20update\x20failed:','usdt','hkd','map','xrp','bch','\x20USDT','ils','%\x20markup\x20=\x20','ars','yfi','keys','\x20USDT\x20(rate:\x20','CURRENCIES','updatedAt','startPeriodicUpdates','stopPeriodicUpdates','3264870BKnMjD','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','getCurrencyRate','nok','7460ctkcBF','vef','desc','mmk','clp','4115MKfOKB','36504UwPLvy','xau','💱\x20Converted\x20','findUnique','\x20USDT,\x20with\x20','huf','Error\x20getting\x20rate\x20for\x20currency\x20','forEach','dkk','pln','toLowerCase','bits','jpy','eur','twd','bdt',',\x20using\x201\x20as\x20fallback','asc','\x20currencies','5991936Qifrpu','rate','Error\x20getting\x20all\x20rates:','4399444QRwHkq','https://api.coingecko.com/api/v3/simple/price','sgd','📊\x20Received\x20rates\x20for\x20','aud','Error\x20converting\x20','tether','toFixed','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','ngn','No\x20rate\x20found\x20for\x20currency:\x20','cny','convertToUSDT','getMarkupPercentage','toUpperCase','join','bhd','convertMultipleToUSDT','❌\x20Failed\x20to\x20update\x20currency\x20rates:','findMany','5538RKtNdY','kwd','updateCurrencyRates','COINGECKO_URL','gbp','\x20to\x20USDT:','rub','usd','default','entries','mxn','warn','pkr','myr','findFirst','lkr','try','%\x20markup\x20to\x20','bmd','uah','link','dot','vnd','inr','currencyRate','catch','?ids=tether&vs_currencies=','xdr','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','xlm','eos','zar','defineProperty','xag','sek','TesSoft\x20Payment\x20System/1.0','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','upsert','getAllRates','log','Failed\x20to\x20update\x20rate\x20for\x20','aed','error','all','✅\x20Currency\x20rates\x20updated\x20successfully','242242IKkFRS','getRatesStatus','Error\x20getting\x20rates\x20status:','length','brl','MARKUP_PERCENTAGE','__esModule','CurrencyService','ltc','82AqXJcW','currencyService','bnb','chf','💱\x20Applied\x20','application/json'];a36_0x1321=function(){return _0x4cd636;};return a36_0x1321();}class CurrencyService{constructor(){const _0x18835e=a36_0x1310db;this[_0x18835e(0x1d8)]=_0x18835e(0x1c2),this[_0x18835e(0x19d)]=['btc','eth',_0x18835e(0x185),_0x18835e(0x195),_0x18835e(0x188),_0x18835e(0x1f3),_0x18835e(0x194),_0x18835e(0x1f2),_0x18835e(0x1e9),_0x18835e(0x1ea),_0x18835e(0x19a),_0x18835e(0x1dc),_0x18835e(0x179),_0x18835e(0x199),_0x18835e(0x1c5),_0x18835e(0x1ba),_0x18835e(0x1d1),_0x18835e(0x1e7),_0x18835e(0x181),'cad',_0x18835e(0x189),_0x18835e(0x1a9),_0x18835e(0x1cc),'czk',_0x18835e(0x1b3),_0x18835e(0x1b8),_0x18835e(0x1d9),'gel',_0x18835e(0x192),_0x18835e(0x1b0),'idr',_0x18835e(0x197),_0x18835e(0x1ec),_0x18835e(0x1b7),'krw',_0x18835e(0x1d6),_0x18835e(0x1e4),_0x18835e(0x1a8),_0x18835e(0x1df),_0x18835e(0x1e2),_0x18835e(0x1ca),_0x18835e(0x1a4),'nzd','php',_0x18835e(0x1e1),_0x18835e(0x1b4),_0x18835e(0x1db),'sar',_0x18835e(0x1f7),_0x18835e(0x1c3),'thb',_0x18835e(0x1e5),_0x18835e(0x1b9),_0x18835e(0x1e8),_0x18835e(0x1a6),_0x18835e(0x1eb),_0x18835e(0x1f4),_0x18835e(0x1f0),_0x18835e(0x1f6),_0x18835e(0x1ac),_0x18835e(0x1b6),'sats'],this['updateInterval']=null,this[_0x18835e(0x182)]=0x3,this[_0x18835e(0x19f)]();}['startPeriodicUpdates'](){const _0x5b7ec2=a36_0x1310db;this['updateCurrencyRates']()[_0x5b7ec2(0x1ee)](_0x52bd0a=>{const _0x4d722b=_0x5b7ec2;console[_0x4d722b(0x17a)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x52bd0a);}),this[_0x5b7ec2(0x18e)]=setInterval(async()=>{const _0x595be0=_0x5b7ec2;try{await this[_0x595be0(0x1d7)]();}catch(_0x7f2a37){console[_0x595be0(0x17a)](_0x595be0(0x190),_0x7f2a37);}},0x3c*0x3c*0x3e8),console[_0x5b7ec2(0x177)](_0x5b7ec2(0x1f1));}[a36_0x1310db(0x1a0)](){const _0x46a7e9=a36_0x1310db;this[_0x46a7e9(0x18e)]&&(clearInterval(this[_0x46a7e9(0x18e)]),this[_0x46a7e9(0x18e)]=null,console[_0x46a7e9(0x177)](_0x46a7e9(0x174)));}async[a36_0x1310db(0x1d7)](){const _0x28d246=a36_0x1310db;try{console[_0x28d246(0x177)](_0x28d246(0x1a2));const _0x66c080=this[_0x28d246(0x19d)][_0x28d246(0x1d0)](','),_0x374b3d=this[_0x28d246(0x1d8)]+_0x28d246(0x1ef)+_0x66c080,_0x4f55e4=await fetch(_0x374b3d,{'headers':{'Accept':_0x28d246(0x18b),'User-Agent':_0x28d246(0x173)}});if(!_0x4f55e4['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x4f55e4['status']+'\x20'+_0x4f55e4['statusText']);const _0x2c6219=await _0x4f55e4[_0x28d246(0x18f)]();if(!_0x2c6219[_0x28d246(0x1c7)])throw new Error(_0x28d246(0x1c9));const _0x2c98ea=_0x2c6219[_0x28d246(0x1c7)];console['log'](_0x28d246(0x1c4)+Object[_0x28d246(0x19b)](_0x2c98ea)[_0x28d246(0x180)]+_0x28d246(0x1bd));const _0x52b48a=Object[_0x28d246(0x1de)](_0x2c98ea)[_0x28d246(0x193)](async([_0x544a48,_0xfa2379])=>{const _0x2c50fe=_0x28d246;try{await database_1[_0x2c50fe(0x1dd)][_0x2c50fe(0x1ed)][_0x2c50fe(0x175)]({'where':{'currency':_0x544a48[_0x2c50fe(0x1b5)]()},'update':{'rate':_0xfa2379},'create':{'currency':_0x544a48['toLowerCase'](),'rate':_0xfa2379}});}catch(_0x1f06dd){console[_0x2c50fe(0x17a)](_0x2c50fe(0x178)+_0x544a48+':',_0x1f06dd);}});await Promise[_0x28d246(0x18c)](_0x52b48a),console[_0x28d246(0x177)](_0x28d246(0x17c));}catch(_0x293fae){console[_0x28d246(0x17a)](_0x28d246(0x1d3),_0x293fae);throw _0x293fae;}}async[a36_0x1310db(0x1a3)](_0x152149){const _0x48da98=a36_0x1310db,_0x39b197=_0x152149['toLowerCase']();if(_0x39b197===_0x48da98(0x191))return 0x1;try{const _0x35234a=await database_1[_0x48da98(0x1dd)][_0x48da98(0x1ed)][_0x48da98(0x1ae)]({'where':{'currency':_0x39b197}});if(!_0x35234a)return console[_0x48da98(0x1e0)](_0x48da98(0x1cb)+_0x152149+_0x48da98(0x1bb)),0x1;return _0x35234a[_0x48da98(0x1bf)];}catch(_0x35cf84){return console[_0x48da98(0x17a)](_0x48da98(0x1b1)+_0x152149+':',_0x35cf84),0x1;}}async['convertToUSDT'](_0x24f457,_0x593285){const _0x35804b=a36_0x1310db,_0x177b1d=_0x593285[_0x35804b(0x1b5)]();if(_0x177b1d===_0x35804b(0x191)){const _0x12e93e=_0x24f457*(0x1+this[_0x35804b(0x182)]/0x64);return console[_0x35804b(0x177)](_0x35804b(0x18a)+this[_0x35804b(0x182)]+_0x35804b(0x1e6)+_0x24f457+'\x20USDT\x20=\x20'+_0x12e93e[_0x35804b(0x1c8)](0x6)+_0x35804b(0x196)),_0x12e93e;}try{const _0x3302e3=await this[_0x35804b(0x1a3)](_0x177b1d),_0x1fdf03=_0x24f457/_0x3302e3,_0x409b1d=_0x1fdf03*(0x1+this[_0x35804b(0x182)]/0x64);return console[_0x35804b(0x177)](_0x35804b(0x1ad)+_0x24f457+'\x20'+_0x593285[_0x35804b(0x1cf)]()+'\x20to\x20'+_0x1fdf03[_0x35804b(0x1c8)](0x6)+_0x35804b(0x1af)+this[_0x35804b(0x182)]+_0x35804b(0x198)+_0x409b1d['toFixed'](0x6)+_0x35804b(0x19c)+_0x3302e3+')'),_0x409b1d;}catch(_0x42d40f){console[_0x35804b(0x17a)](_0x35804b(0x1c6)+_0x24f457+'\x20'+_0x593285+_0x35804b(0x1da),_0x42d40f);const _0x47be92=_0x24f457*(0x1+this[_0x35804b(0x182)]/0x64);return _0x47be92;}}async[a36_0x1310db(0x1d2)](_0x1a404f){const _0x4b1fd5=a36_0x1310db;let _0xeb7860=0x0;for(const {amount:_0x27346f,currency:_0xa164d1}of _0x1a404f){const _0x39304e=await this[_0x4b1fd5(0x1cd)](_0x27346f,_0xa164d1);_0xeb7860+=_0x39304e;}return _0xeb7860;}async[a36_0x1310db(0x176)](){const _0x259b32=a36_0x1310db;try{const _0x47be2b=await database_1[_0x259b32(0x1dd)][_0x259b32(0x1ed)][_0x259b32(0x1d4)]({'select':{'currency':!![],'rate':!![]}}),_0x5d67d8={'usdt':0x1};return _0x47be2b[_0x259b32(0x1b2)](_0x456a54=>{const _0xdfcfab=_0x259b32;_0x5d67d8[_0x456a54['currency']]=_0x456a54[_0xdfcfab(0x1bf)];}),_0x5d67d8;}catch(_0x3fde70){return console[_0x259b32(0x17a)](_0x259b32(0x1c0),_0x3fde70),{'usdt':0x1};}}async[a36_0x1310db(0x17e)](){const _0x31de1f=a36_0x1310db;try{const [_0x52a9d3,_0x467847,_0x28bcb2]=await Promise[_0x31de1f(0x17b)]([database_1[_0x31de1f(0x1dd)]['currencyRate']['count'](),database_1[_0x31de1f(0x1dd)][_0x31de1f(0x1ed)]['findFirst']({'orderBy':{'updatedAt':_0x31de1f(0x1a7)},'select':{'updatedAt':!![]}}),database_1[_0x31de1f(0x1dd)][_0x31de1f(0x1ed)][_0x31de1f(0x1e3)]({'orderBy':{'updatedAt':_0x31de1f(0x1bc)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x52a9d3,'lastUpdated':_0x467847?.['updatedAt']||null,'oldestRate':_0x28bcb2?.[_0x31de1f(0x19e)]||null,'markupPercentage':this[_0x31de1f(0x182)]};}catch(_0x19df7b){return console[_0x31de1f(0x17a)](_0x31de1f(0x17f),_0x19df7b),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x31de1f(0x182)]};}}[a36_0x1310db(0x1ce)](){const _0x689b04=a36_0x1310db;return this[_0x689b04(0x182)];}}exports[a36_0x1310db(0x184)]=CurrencyService,exports[a36_0x1310db(0x187)]=new CurrencyService();