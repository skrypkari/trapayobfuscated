'use strict';function a36_0x4d96(_0x531daf,_0x17148b){const _0x1d6866=a36_0x1d68();return a36_0x4d96=function(_0x4d9636,_0x501924){_0x4d9636=_0x4d9636-0x78;let _0x5323e0=_0x1d6866[_0x4d9636];return _0x5323e0;},a36_0x4d96(_0x531daf,_0x17148b);}function a36_0x1d68(){const _0x463e51=['Failed\x20to\x20update\x20rate\x20for\x20','%\x20markup\x20=\x20','eth','updateInterval','?ids=tether&vs_currencies=','clp','kwd','CURRENCIES','TesSoft\x20Payment\x20System/1.0','CoinGecko\x20API\x20error:\x20','findFirst','Initial\x20currency\x20rates\x20update\x20failed:','warn','4lxtlMe','../config/database','cad','application/json','rate','ngn','pkr','length','updateCurrencyRates','__importDefault','Error\x20getting\x20rate\x20for\x20currency\x20','\x20USDT\x20(rate:\x20','chf','allSettled','all','hkd','currencyRate','pln','sgd','%\x20markup\x20to\x20','bits','3938759iOQOrM','try','entries','toUpperCase','ltc','catch','toLowerCase','\x20to\x20','150icexjc','lkr','dot','usd','myr','CurrencyService','zar','cny','log','https://api.coingecko.com/api/v3/simple/price','thb','No\x20rate\x20found\x20for\x20currency:\x20','getMarkupPercentage','gel','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','8803818QGxLKT','5513665kBbqOH','MARKUP_PERCENTAGE','json','mmk','asc','usdt','map','191556fpjnjL','Error\x20getting\x20all\x20rates:','czk','twd','statusText','brl','ðŸ“Š\x20Received\x20rates\x20for\x20','gbp','default','Periodic\x20currency\x20rates\x20update\x20failed:','defineProperty','Error\x20getting\x20rates\x20status:','xlm','desc','bhd','xag','\x20to\x20USDT:','idr','rub','yfi','978jSvTno','Error\x20converting\x20','findUnique','11205075PsvjWt','toFixed','vef','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','\x20USDT\x20=\x20','bmd','bdt','nzd','getCurrencyRate','currencyService','stopPeriodicUpdates','upsert','ðŸ’±\x20Applied\x20','convertToUSDT','status','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','eur','keys','ðŸ’±\x20Converted\x20','krw','2926zUkvTe','sats','updatedAt','convertMultipleToUSDT','835970yrWoSB','join','php','getAllRates','getRatesStatus','eos','ils','__esModule','uah','error','tether','vnd','startPeriodicUpdates','\x20USDT','xdr','btc','296agGQQS','âœ…\x20Currency\x20rates\x20updated\x20successfully','xrp','inr'];a36_0x1d68=function(){return _0x463e51;};return a36_0x1d68();}const a36_0x482abd=a36_0x4d96;(function(_0x67f162,_0x21efd6){const _0x189256=a36_0x4d96,_0x29ee44=_0x67f162();while(!![]){try{const _0x44105f=parseInt(_0x189256(0xcb))/0x1+-parseInt(_0x189256(0xc7))/0x2*(-parseInt(_0x189256(0xb0))/0x3)+-parseInt(_0x189256(0xec))/0x4*(-parseInt(_0x189256(0x95))/0x5)+parseInt(_0x189256(0x94))/0x6+parseInt(_0x189256(0xb3))/0x7+parseInt(_0x189256(0xdb))/0x8*(parseInt(_0x189256(0x9c))/0x9)+-parseInt(_0x189256(0x85))/0xa*(parseInt(_0x189256(0x7d))/0xb);if(_0x44105f===_0x21efd6)break;else _0x29ee44['push'](_0x29ee44['shift']());}catch(_0x28f739){_0x29ee44['push'](_0x29ee44['shift']());}}}(a36_0x1d68,0xdbc2e));var __importDefault=this&&this[a36_0x482abd(0xf5)]||function(_0x5cd4e4){const _0x5d0c48=a36_0x482abd;return _0x5cd4e4&&_0x5cd4e4[_0x5d0c48(0xd2)]?_0x5cd4e4:{'default':_0x5cd4e4};};Object[a36_0x482abd(0xa6)](exports,'__esModule',{'value':!![]}),exports[a36_0x482abd(0xbc)]=exports[a36_0x482abd(0x8a)]=void 0x0;const database_1=__importDefault(require(a36_0x482abd(0xed)));class CurrencyService{constructor(){const _0x1488e7=a36_0x482abd;this['COINGECKO_URL']=_0x1488e7(0x8e),this[_0x1488e7(0xe6)]=[_0x1488e7(0xda),_0x1488e7(0xe1),_0x1488e7(0x81),'bch','bnb',_0x1488e7(0xd0),_0x1488e7(0xdd),_0x1488e7(0xa8),'link',_0x1488e7(0x87),_0x1488e7(0xaf),_0x1488e7(0x88),'aed','ars','aud',_0x1488e7(0xb9),_0x1488e7(0xaa),_0x1488e7(0xb8),_0x1488e7(0xa1),_0x1488e7(0xee),_0x1488e7(0xf8),_0x1488e7(0xe4),_0x1488e7(0x8c),_0x1488e7(0x9e),'dkk',_0x1488e7(0xc3),_0x1488e7(0xa3),_0x1488e7(0x92),_0x1488e7(0xfb),'huf',_0x1488e7(0xad),_0x1488e7(0xd1),_0x1488e7(0xde),'jpy',_0x1488e7(0xc6),_0x1488e7(0xe5),_0x1488e7(0x86),_0x1488e7(0x98),'mxn',_0x1488e7(0x89),_0x1488e7(0xf1),'nok',_0x1488e7(0xba),_0x1488e7(0xcd),_0x1488e7(0xf2),_0x1488e7(0x79),_0x1488e7(0xae),'sar','sek',_0x1488e7(0x7a),_0x1488e7(0x8f),_0x1488e7(0x7e),_0x1488e7(0x9f),_0x1488e7(0xd3),_0x1488e7(0xb5),_0x1488e7(0xd6),_0x1488e7(0x8b),_0x1488e7(0xd9),_0x1488e7(0xab),'xau',_0x1488e7(0x7c),_0x1488e7(0xc8)],this[_0x1488e7(0xe2)]=null,this[_0x1488e7(0x96)]=0x3,this[_0x1488e7(0xd7)]();}[a36_0x482abd(0xd7)](){const _0x552e27=a36_0x482abd;this['updateCurrencyRates']()[_0x552e27(0x82)](_0x5db5f8=>{const _0xb2cdcd=_0x552e27;console[_0xb2cdcd(0xd4)](_0xb2cdcd(0xea),_0x5db5f8);}),this[_0x552e27(0xe2)]=setInterval(async()=>{const _0x538c77=_0x552e27;try{await this[_0x538c77(0xf4)]();}catch(_0x169e24){console[_0x538c77(0xd4)](_0x538c77(0xa5),_0x169e24);}},0x3c*0x3c*0x3e8),console['log'](_0x552e27(0xc2));}[a36_0x482abd(0xbd)](){const _0x387027=a36_0x482abd;this['updateInterval']&&(clearInterval(this['updateInterval']),this['updateInterval']=null,console[_0x387027(0x8d)](_0x387027(0x93)));}async[a36_0x482abd(0xf4)](){const _0x55c00a=a36_0x482abd;try{console['log']('ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x43fa42=this[_0x55c00a(0xe6)][_0x55c00a(0xcc)](','),_0x129e61=this['COINGECKO_URL']+_0x55c00a(0xe3)+_0x43fa42,_0x7c9bc1=await fetch(_0x129e61,{'headers':{'Accept':_0x55c00a(0xef),'User-Agent':_0x55c00a(0xe7)}});if(!_0x7c9bc1['ok'])throw new Error(_0x55c00a(0xe8)+_0x7c9bc1[_0x55c00a(0xc1)]+'\x20'+_0x7c9bc1[_0x55c00a(0xa0)]);const _0x44b3aa=await _0x7c9bc1[_0x55c00a(0x97)]();if(!_0x44b3aa['tether'])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x36dd63=_0x44b3aa[_0x55c00a(0xd5)];console[_0x55c00a(0x8d)](_0x55c00a(0xa2)+Object[_0x55c00a(0xc4)](_0x36dd63)[_0x55c00a(0xf3)]+'\x20currencies');const _0x311279=Object[_0x55c00a(0x7f)](_0x36dd63)[_0x55c00a(0x9b)](async([_0x44e1e5,_0x3626b7])=>{const _0x17176c=_0x55c00a;try{await database_1[_0x17176c(0xa4)][_0x17176c(0x78)][_0x17176c(0xbe)]({'where':{'currency':_0x44e1e5[_0x17176c(0x83)]()},'update':{'rate':_0x3626b7},'create':{'currency':_0x44e1e5[_0x17176c(0x83)](),'rate':_0x3626b7}});}catch(_0x1bd949){console[_0x17176c(0xd4)](_0x17176c(0xdf)+_0x44e1e5+':',_0x1bd949);}});await Promise[_0x55c00a(0xf9)](_0x311279),console['log'](_0x55c00a(0xdc));}catch(_0x39eab1){console[_0x55c00a(0xd4)](_0x55c00a(0xb6),_0x39eab1);throw _0x39eab1;}}async[a36_0x482abd(0xbb)](_0xc2d5a7){const _0xc21ab1=a36_0x482abd,_0x338049=_0xc2d5a7['toLowerCase']();if(_0x338049==='usdt')return 0x1;try{const _0x27c264=await database_1[_0xc21ab1(0xa4)][_0xc21ab1(0x78)][_0xc21ab1(0xb2)]({'where':{'currency':_0x338049}});if(!_0x27c264)return console[_0xc21ab1(0xeb)](_0xc21ab1(0x90)+_0xc2d5a7+',\x20using\x201\x20as\x20fallback'),0x1;return _0x27c264[_0xc21ab1(0xf0)];}catch(_0x1bc590){return console[_0xc21ab1(0xd4)](_0xc21ab1(0xf6)+_0xc2d5a7+':',_0x1bc590),0x1;}}async[a36_0x482abd(0xc0)](_0x165c95,_0x3243af){const _0xb8140e=a36_0x482abd,_0x2c4522=_0x3243af['toLowerCase']();if(_0x2c4522===_0xb8140e(0x9a)){const _0x3210bd=_0x165c95*(0x1+this[_0xb8140e(0x96)]/0x64);return console[_0xb8140e(0x8d)](_0xb8140e(0xbf)+this[_0xb8140e(0x96)]+_0xb8140e(0x7b)+_0x165c95+_0xb8140e(0xb7)+_0x3210bd['toFixed'](0x6)+_0xb8140e(0xd8)),_0x3210bd;}try{const _0x3604a4=await this[_0xb8140e(0xbb)](_0x2c4522),_0x117570=_0x165c95/_0x3604a4,_0x208d7b=_0x117570*(0x1+this[_0xb8140e(0x96)]/0x64);return console[_0xb8140e(0x8d)](_0xb8140e(0xc5)+_0x165c95+'\x20'+_0x3243af[_0xb8140e(0x80)]()+_0xb8140e(0x84)+_0x117570[_0xb8140e(0xb4)](0x6)+'\x20USDT,\x20with\x20'+this['MARKUP_PERCENTAGE']+_0xb8140e(0xe0)+_0x208d7b['toFixed'](0x6)+_0xb8140e(0xf7)+_0x3604a4+')'),_0x208d7b;}catch(_0x5940e9){console[_0xb8140e(0xd4)](_0xb8140e(0xb1)+_0x165c95+'\x20'+_0x3243af+_0xb8140e(0xac),_0x5940e9);const _0xed713e=_0x165c95*(0x1+this[_0xb8140e(0x96)]/0x64);return _0xed713e;}}async[a36_0x482abd(0xca)](_0x24de5a){let _0x5b4c5f=0x0;for(const {amount:_0x21c214,currency:_0x14968a}of _0x24de5a){const _0x21a288=await this['convertToUSDT'](_0x21c214,_0x14968a);_0x5b4c5f+=_0x21a288;}return _0x5b4c5f;}async[a36_0x482abd(0xce)](){const _0x24c82a=a36_0x482abd;try{const _0x45167a=await database_1[_0x24c82a(0xa4)][_0x24c82a(0x78)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x49376c={'usdt':0x1};return _0x45167a['forEach'](_0x5141ad=>{const _0x2384c1=_0x24c82a;_0x49376c[_0x5141ad['currency']]=_0x5141ad[_0x2384c1(0xf0)];}),_0x49376c;}catch(_0x438337){return console['error'](_0x24c82a(0x9d),_0x438337),{'usdt':0x1};}}async[a36_0x482abd(0xcf)](){const _0x10a75f=a36_0x482abd;try{const [_0x4252d3,_0x53ce26,_0x917040]=await Promise[_0x10a75f(0xfa)]([database_1[_0x10a75f(0xa4)][_0x10a75f(0x78)]['count'](),database_1[_0x10a75f(0xa4)][_0x10a75f(0x78)]['findFirst']({'orderBy':{'updatedAt':_0x10a75f(0xa9)},'select':{'updatedAt':!![]}}),database_1[_0x10a75f(0xa4)][_0x10a75f(0x78)][_0x10a75f(0xe9)]({'orderBy':{'updatedAt':_0x10a75f(0x99)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x4252d3,'lastUpdated':_0x53ce26?.[_0x10a75f(0xc9)]||null,'oldestRate':_0x917040?.[_0x10a75f(0xc9)]||null,'markupPercentage':this[_0x10a75f(0x96)]};}catch(_0x588adc){return console[_0x10a75f(0xd4)](_0x10a75f(0xa7),_0x588adc),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x10a75f(0x96)]};}}[a36_0x482abd(0x91)](){const _0x1b0856=a36_0x482abd;return this[_0x1b0856(0x96)];}}exports[a36_0x482abd(0x8a)]=CurrencyService,exports[a36_0x482abd(0xbc)]=new CurrencyService();