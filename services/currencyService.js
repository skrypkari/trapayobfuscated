'use strict';const a38_0x5e80b3=a38_0x8bca;(function(_0x938d7,_0x2b03ef){const _0x3772b9=a38_0x8bca,_0x28af16=_0x938d7();while(!![]){try{const _0x171f26=parseInt(_0x3772b9(0xb8))/0x1+-parseInt(_0x3772b9(0x71))/0x2*(-parseInt(_0x3772b9(0xae))/0x3)+-parseInt(_0x3772b9(0xa6))/0x4+parseInt(_0x3772b9(0xc0))/0x5+-parseInt(_0x3772b9(0x69))/0x6*(-parseInt(_0x3772b9(0xda))/0x7)+parseInt(_0x3772b9(0x91))/0x8+parseInt(_0x3772b9(0x8d))/0x9*(-parseInt(_0x3772b9(0x79))/0xa);if(_0x171f26===_0x2b03ef)break;else _0x28af16['push'](_0x28af16['shift']());}catch(_0x212ede){_0x28af16['push'](_0x28af16['shift']());}}}(a38_0x3379,0x79559));function a38_0x8bca(_0x4785c7,_0x44c34c){const _0x33792c=a38_0x3379();return a38_0x8bca=function(_0x8bca29,_0x47592b){_0x8bca29=_0x8bca29-0x66;let _0x20e5fd=_0x33792c[_0x8bca29];return _0x20e5fd;},a38_0x8bca(_0x4785c7,_0x44c34c);}var __importDefault=this&&this[a38_0x5e80b3(0xe0)]||function(_0x50e4c4){return _0x50e4c4&&_0x50e4c4['__esModule']?_0x50e4c4:{'default':_0x50e4c4};};Object['defineProperty'](exports,a38_0x5e80b3(0xce),{'value':!![]}),exports[a38_0x5e80b3(0xb7)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x5e80b3(0x8a)));function a38_0x3379(){const _0x4fb280=['Error\x20getting\x20rates\x20status:','currencyService','939579qztRop','myr','error','count','\x20to\x20','xau','getRatesStatus','startPeriodicUpdates','3687200LvKCdl','sgd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','try','length','mxn','warn','findMany','json','eos','aud','Failed\x20to\x20update\x20rate\x20for\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','nzd','__esModule','updatedAt','xdr','eur','uah','\x20USDT','toLowerCase','cny','findUnique','📊\x20Received\x20rates\x20for\x20','xag','btc','14ANdwAx','💱\x20Applied\x20','map','eth','inr','catch','__importDefault','rub','zar','link','updateCurrencyRates','kwd','convertToUSDT','bch','php','krw','huf','allSettled','usdt','33006sNEjWd','\x20USDT\x20(rate:\x20','bdt','currencyRate','stopPeriodicUpdates','mmk','findFirst','all','23752tvFauT','xlm','clp','pkr','ltc','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','\x20currencies','toFixed','10Wxkayo','jpy','ngn','https://api.coingecko.com/api/v3/simple/price','💱\x20Converted\x20','updateInterval','COINGECKO_URL','forEach','dkk','sats','aed','application/json','gel','getAllRates','hkd','sek','✅\x20Currency\x20rates\x20updated\x20successfully','../config/database','\x20USDT\x20=\x20','\x20USDT,\x20with\x20','18175311AhLMYH','bmd','sar','czk','5136552cyOZne','Error\x20getting\x20all\x20rates:','getCurrencyRate','bnb','thb','%\x20markup\x20to\x20','No\x20rate\x20found\x20for\x20currency:\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','desc','toUpperCase','tether','statusText','ils','%\x20markup\x20=\x20','getMarkupPercentage','log','Error\x20getting\x20rate\x20for\x20currency\x20','entries','bhd','rate','Periodic\x20currency\x20rates\x20update\x20failed:','442104smOTMS','cad','join','lkr','vnd','MARKUP_PERCENTAGE','CURRENCIES','?ids=tether&vs_currencies=','75agfdpk','yfi','idr','default','convertMultipleToUSDT','chf','xrp','bits'];a38_0x3379=function(){return _0x4fb280;};return a38_0x3379();}class CurrencyService{constructor(){const _0x1da6b8=a38_0x5e80b3;this[_0x1da6b8(0x7f)]=_0x1da6b8(0x7c),this[_0x1da6b8(0xac)]=[_0x1da6b8(0xd9),_0x1da6b8(0xdd),_0x1da6b8(0x75),_0x1da6b8(0xe7),_0x1da6b8(0x94),_0x1da6b8(0xc9),_0x1da6b8(0xb4),_0x1da6b8(0x72),_0x1da6b8(0xe3),'dot',_0x1da6b8(0xaf),'usd',_0x1da6b8(0x83),'ars',_0x1da6b8(0xca),_0x1da6b8(0x6b),_0x1da6b8(0xa3),_0x1da6b8(0x8e),'brl',_0x1da6b8(0xa7),_0x1da6b8(0xb3),_0x1da6b8(0x73),_0x1da6b8(0xd5),_0x1da6b8(0x90),_0x1da6b8(0x81),_0x1da6b8(0xd1),'gbp',_0x1da6b8(0x85),_0x1da6b8(0x87),_0x1da6b8(0x66),_0x1da6b8(0xb0),_0x1da6b8(0x9d),_0x1da6b8(0xde),_0x1da6b8(0x7a),_0x1da6b8(0xe9),_0x1da6b8(0xe5),_0x1da6b8(0xa9),_0x1da6b8(0x6e),_0x1da6b8(0xc5),_0x1da6b8(0xb9),_0x1da6b8(0x7b),'nok',_0x1da6b8(0xcd),_0x1da6b8(0xe8),_0x1da6b8(0x74),'pln',_0x1da6b8(0xe1),_0x1da6b8(0x8f),_0x1da6b8(0x88),_0x1da6b8(0xc1),_0x1da6b8(0x95),_0x1da6b8(0xc3),'twd',_0x1da6b8(0xd2),'vef',_0x1da6b8(0xaa),_0x1da6b8(0xe2),_0x1da6b8(0xd0),_0x1da6b8(0xd8),_0x1da6b8(0xbd),_0x1da6b8(0xb5),_0x1da6b8(0x82)],this['updateInterval']=null,this[_0x1da6b8(0xab)]=0x3,this[_0x1da6b8(0xbf)]();}[a38_0x5e80b3(0xbf)](){const _0x279ceb=a38_0x5e80b3;this[_0x279ceb(0xe4)]()[_0x279ceb(0xdf)](_0x51300d=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x51300d);}),this[_0x279ceb(0x7e)]=setInterval(async()=>{const _0x348a79=_0x279ceb;try{await this[_0x348a79(0xe4)]();}catch(_0x4cb27e){console[_0x348a79(0xba)](_0x348a79(0xa5),_0x4cb27e);}},0x3c*0x3c*0x3e8),console[_0x279ceb(0xa0)](_0x279ceb(0xcc));}[a38_0x5e80b3(0x6d)](){const _0x31febb=a38_0x5e80b3;this[_0x31febb(0x7e)]&&(clearInterval(this[_0x31febb(0x7e)]),this[_0x31febb(0x7e)]=null,console[_0x31febb(0xa0)](_0x31febb(0x76)));}async[a38_0x5e80b3(0xe4)](){const _0x5f1db8=a38_0x5e80b3;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0xa254ec=this['CURRENCIES'][_0x5f1db8(0xa8)](','),_0x449b9f=this[_0x5f1db8(0x7f)]+_0x5f1db8(0xad)+_0xa254ec,_0x463b7e=await fetch(_0x449b9f,{'headers':{'Accept':_0x5f1db8(0x84),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x463b7e['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x463b7e['status']+'\x20'+_0x463b7e[_0x5f1db8(0x9c)]);const _0x20ace2=await _0x463b7e[_0x5f1db8(0xc8)]();if(!_0x20ace2[_0x5f1db8(0x9b)])throw new Error(_0x5f1db8(0xc2));const _0x497aad=_0x20ace2[_0x5f1db8(0x9b)];console[_0x5f1db8(0xa0)](_0x5f1db8(0xd7)+Object['keys'](_0x497aad)[_0x5f1db8(0xc4)]+_0x5f1db8(0x77));const _0x2341d7=Object[_0x5f1db8(0xa2)](_0x497aad)[_0x5f1db8(0xdc)](async([_0xce4878,_0x4049ec])=>{const _0x1acb3c=_0x5f1db8;try{await database_1['default'][_0x1acb3c(0x6c)]['upsert']({'where':{'currency':_0xce4878[_0x1acb3c(0xd4)]()},'update':{'rate':_0x4049ec},'create':{'currency':_0xce4878['toLowerCase'](),'rate':_0x4049ec}});}catch(_0x1a6ac8){console[_0x1acb3c(0xba)](_0x1acb3c(0xcb)+_0xce4878+':',_0x1a6ac8);}});await Promise[_0x5f1db8(0x67)](_0x2341d7),console[_0x5f1db8(0xa0)](_0x5f1db8(0x89));}catch(_0x16f453){console[_0x5f1db8(0xba)](_0x5f1db8(0x98),_0x16f453);throw _0x16f453;}}async[a38_0x5e80b3(0x93)](_0x270507){const _0x41e657=a38_0x5e80b3,_0x209d40=_0x270507[_0x41e657(0xd4)]();if(_0x209d40===_0x41e657(0x68))return 0x1;try{const _0x23cc77=await database_1['default'][_0x41e657(0x6c)][_0x41e657(0xd6)]({'where':{'currency':_0x209d40}});if(!_0x23cc77)return console[_0x41e657(0xc6)](_0x41e657(0x97)+_0x270507+',\x20using\x201\x20as\x20fallback'),0x1;return _0x23cc77[_0x41e657(0xa4)];}catch(_0x1e41e6){return console['error'](_0x41e657(0xa1)+_0x270507+':',_0x1e41e6),0x1;}}async[a38_0x5e80b3(0xe6)](_0x30e727,_0x21b567){const _0x3cbb07=a38_0x5e80b3,_0x59d558=_0x21b567['toLowerCase']();if(_0x59d558===_0x3cbb07(0x68)){const _0x33d635=_0x30e727*(0x1+this[_0x3cbb07(0xab)]/0x64);return console[_0x3cbb07(0xa0)](_0x3cbb07(0xdb)+this[_0x3cbb07(0xab)]+_0x3cbb07(0x96)+_0x30e727+_0x3cbb07(0x8b)+_0x33d635[_0x3cbb07(0x78)](0x6)+_0x3cbb07(0xd3)),_0x33d635;}try{const _0x36e0d2=await this[_0x3cbb07(0x93)](_0x59d558),_0x1d3dcd=_0x30e727/_0x36e0d2,_0x265bb9=_0x1d3dcd*(0x1+this[_0x3cbb07(0xab)]/0x64);return console[_0x3cbb07(0xa0)](_0x3cbb07(0x7d)+_0x30e727+'\x20'+_0x21b567[_0x3cbb07(0x9a)]()+_0x3cbb07(0xbc)+_0x1d3dcd[_0x3cbb07(0x78)](0x6)+_0x3cbb07(0x8c)+this[_0x3cbb07(0xab)]+_0x3cbb07(0x9e)+_0x265bb9['toFixed'](0x6)+_0x3cbb07(0x6a)+_0x36e0d2+')'),_0x265bb9;}catch(_0x15d1a0){console['error']('Error\x20converting\x20'+_0x30e727+'\x20'+_0x21b567+'\x20to\x20USDT:',_0x15d1a0);const _0x508df1=_0x30e727*(0x1+this[_0x3cbb07(0xab)]/0x64);return _0x508df1;}}async[a38_0x5e80b3(0xb2)](_0x45cce2){const _0x161a59=a38_0x5e80b3;let _0x58fc58=0x0;for(const {amount:_0x16a2b6,currency:_0x3e9560}of _0x45cce2){const _0x3c0038=await this[_0x161a59(0xe6)](_0x16a2b6,_0x3e9560);_0x58fc58+=_0x3c0038;}return _0x58fc58;}async[a38_0x5e80b3(0x86)](){const _0x560d34=a38_0x5e80b3;try{const _0xa93d70=await database_1['default'][_0x560d34(0x6c)][_0x560d34(0xc7)]({'select':{'currency':!![],'rate':!![]}}),_0x1cfe23={'usdt':0x1};return _0xa93d70[_0x560d34(0x80)](_0x3f3084=>{const _0x5ed679=_0x560d34;_0x1cfe23[_0x3f3084['currency']]=_0x3f3084[_0x5ed679(0xa4)];}),_0x1cfe23;}catch(_0x4f293a){return console[_0x560d34(0xba)](_0x560d34(0x92),_0x4f293a),{'usdt':0x1};}}async[a38_0x5e80b3(0xbe)](){const _0x26ea01=a38_0x5e80b3;try{const [_0x31c071,_0x103686,_0xba97cc]=await Promise[_0x26ea01(0x70)]([database_1[_0x26ea01(0xb1)][_0x26ea01(0x6c)][_0x26ea01(0xbb)](),database_1[_0x26ea01(0xb1)][_0x26ea01(0x6c)]['findFirst']({'orderBy':{'updatedAt':_0x26ea01(0x99)},'select':{'updatedAt':!![]}}),database_1[_0x26ea01(0xb1)][_0x26ea01(0x6c)][_0x26ea01(0x6f)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x31c071,'lastUpdated':_0x103686?.[_0x26ea01(0xcf)]||null,'oldestRate':_0xba97cc?.[_0x26ea01(0xcf)]||null,'markupPercentage':this[_0x26ea01(0xab)]};}catch(_0x5f54ef){return console['error'](_0x26ea01(0xb6),_0x5f54ef),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x5e80b3(0x9f)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a38_0x5e80b3(0xb7)]=new CurrencyService();