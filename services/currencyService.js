'use strict';const a39_0xb1ab58=a39_0x4cda;(function(_0x5a02f9,_0x1be231){const _0x3ec9c1=a39_0x4cda,_0x7f15f7=_0x5a02f9();while(!![]){try{const _0xc720ff=-parseInt(_0x3ec9c1(0x82))/0x1+parseInt(_0x3ec9c1(0x9d))/0x2+-parseInt(_0x3ec9c1(0xbb))/0x3+parseInt(_0x3ec9c1(0xa5))/0x4*(-parseInt(_0x3ec9c1(0xc4))/0x5)+-parseInt(_0x3ec9c1(0xad))/0x6*(parseInt(_0x3ec9c1(0xe0))/0x7)+parseInt(_0x3ec9c1(0xc1))/0x8*(-parseInt(_0x3ec9c1(0x78))/0x9)+parseInt(_0x3ec9c1(0x88))/0xa;if(_0xc720ff===_0x1be231)break;else _0x7f15f7['push'](_0x7f15f7['shift']());}catch(_0x1296f3){_0x7f15f7['push'](_0x7f15f7['shift']());}}}(a39_0x4fce,0x5877c));function a39_0x4cda(_0x389344,_0x2793d7){const _0x4fce12=a39_0x4fce();return a39_0x4cda=function(_0x4cda04,_0x12a05a){_0x4cda04=_0x4cda04-0x75;let _0x19b5fa=_0x4fce12[_0x4cda04];return _0x19b5fa;},a39_0x4cda(_0x389344,_0x2793d7);}function a39_0x4fce(){const _0x300c18=['TesSoft\x20Payment\x20System/1.0','790389aoYUkv','nok','ltc','log','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','eur','38120PZMFbg','link','__esModule','285805nMNVMP','xdr','Error\x20getting\x20rates\x20status:','lkr','\x20USDT\x20=\x20','sgd','catch','asc','kwd','chf','desc','updatedAt','currency','warn','default','myr','vnd','💱\x20Converted\x20','toFixed','findMany','length','?ids=tether&vs_currencies=','currencyService','Initial\x20currency\x20rates\x20update\x20failed:','usd','sar','mmk','\x20USDT,\x20with\x20','904631lRTPmb','cny','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','\x20currencies','all','php','findFirst','No\x20rate\x20found\x20for\x20currency:\x20','%\x20markup\x20to\x20','423VJBRGD','uah','pkr','gbp','../config/database','jpy','bdt','✅\x20Currency\x20rates\x20updated\x20successfully','inr','hkd','78290RvtiDV','clp','usdt','eos','vef','getCurrencyRate','15728510bLpAEr','eth','ars','sats','convertMultipleToUSDT','allSettled','Error\x20converting\x20','bits','startPeriodicUpdates','currencyRate','bhd','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','getMarkupPercentage','xag','tether','nzd','stopPeriodicUpdates','idr','ils','error','bnb','117094HGuavW','pln','toLowerCase','CoinGecko\x20API\x20error:\x20','💱\x20Applied\x20','📊\x20Received\x20rates\x20for\x20','defineProperty','CURRENCIES','4swPzsI','count','xlm','rate','\x20to\x20','convertToUSDT','updateCurrencyRates','MARKUP_PERCENTAGE','30NPvZud','krw','https://api.coingecko.com/api/v3/simple/price','xau','aed','\x20to\x20USDT:','sek','Error\x20getting\x20all\x20rates:','xrp','ngn','updateInterval','twd','COINGECKO_URL'];a39_0x4fce=function(){return _0x300c18;};return a39_0x4fce();}var __importDefault=this&&this['__importDefault']||function(_0x4b8188){const _0x1ee4a5=a39_0x4cda;return _0x4b8188&&_0x4b8188[_0x1ee4a5(0xc3)]?_0x4b8188:{'default':_0x4b8188};};Object[a39_0xb1ab58(0xa3)](exports,a39_0xb1ab58(0xc3),{'value':!![]}),exports[a39_0xb1ab58(0xda)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0xb1ab58(0x7c)));class CurrencyService{constructor(){const _0x4b8b6c=a39_0xb1ab58;this[_0x4b8b6c(0xb9)]=_0x4b8b6c(0xaf),this[_0x4b8b6c(0xa4)]=['btc',_0x4b8b6c(0x89),_0x4b8b6c(0xbd),'bch',_0x4b8b6c(0x9c),_0x4b8b6c(0x85),_0x4b8b6c(0xb5),_0x4b8b6c(0xa7),_0x4b8b6c(0xc2),'dot','yfi',_0x4b8b6c(0xdc),_0x4b8b6c(0xb1),_0x4b8b6c(0x8a),'aud',_0x4b8b6c(0x7e),_0x4b8b6c(0x92),'bmd','brl','cad',_0x4b8b6c(0xcd),_0x4b8b6c(0x83),_0x4b8b6c(0xe1),'czk','dkk',_0x4b8b6c(0xc0),_0x4b8b6c(0x7b),'gel',_0x4b8b6c(0x81),'huf',_0x4b8b6c(0x99),_0x4b8b6c(0x9a),_0x4b8b6c(0x80),_0x4b8b6c(0x7d),_0x4b8b6c(0xae),_0x4b8b6c(0xcc),_0x4b8b6c(0xc7),_0x4b8b6c(0xde),'mxn',_0x4b8b6c(0xd3),_0x4b8b6c(0xb6),_0x4b8b6c(0xbc),_0x4b8b6c(0x97),_0x4b8b6c(0xe5),_0x4b8b6c(0x7a),_0x4b8b6c(0x9e),'rub',_0x4b8b6c(0xdd),_0x4b8b6c(0xb3),_0x4b8b6c(0xc9),'thb','try',_0x4b8b6c(0xb8),_0x4b8b6c(0x79),_0x4b8b6c(0x86),_0x4b8b6c(0xd4),'zar',_0x4b8b6c(0xc5),_0x4b8b6c(0x95),_0x4b8b6c(0xb0),_0x4b8b6c(0x8f),_0x4b8b6c(0x8b)],this[_0x4b8b6c(0xb7)]=null,this[_0x4b8b6c(0xac)]=0x3,this[_0x4b8b6c(0x90)]();}[a39_0xb1ab58(0x90)](){const _0x1d69dc=a39_0xb1ab58;this[_0x1d69dc(0xab)]()[_0x1d69dc(0xca)](_0x4cbf58=>{const _0x4c7fe9=_0x1d69dc;console['error'](_0x4c7fe9(0xdb),_0x4cbf58);}),this['updateInterval']=setInterval(async()=>{const _0x4c5b94=_0x1d69dc;try{await this[_0x4c5b94(0xab)]();}catch(_0xaa8d8){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0xaa8d8);}},0x3c*0x3c*0x3e8),console[_0x1d69dc(0xbe)](_0x1d69dc(0xbf));}[a39_0xb1ab58(0x98)](){const _0x3b06af=a39_0xb1ab58;this['updateInterval']&&(clearInterval(this[_0x3b06af(0xb7)]),this['updateInterval']=null,console[_0x3b06af(0xbe)](_0x3b06af(0x93)));}async['updateCurrencyRates'](){const _0x1221bf=a39_0xb1ab58;try{console[_0x1221bf(0xbe)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x2a409f=this['CURRENCIES']['join'](','),_0x35eb49=this[_0x1221bf(0xb9)]+_0x1221bf(0xd9)+_0x2a409f,_0x3a2502=await fetch(_0x35eb49,{'headers':{'Accept':'application/json','User-Agent':_0x1221bf(0xba)}});if(!_0x3a2502['ok'])throw new Error(_0x1221bf(0xa0)+_0x3a2502['status']+'\x20'+_0x3a2502['statusText']);const _0x379554=await _0x3a2502['json']();if(!_0x379554[_0x1221bf(0x96)])throw new Error(_0x1221bf(0xe2));const _0x50554d=_0x379554[_0x1221bf(0x96)];console[_0x1221bf(0xbe)](_0x1221bf(0xa2)+Object['keys'](_0x50554d)[_0x1221bf(0xd8)]+_0x1221bf(0xe3));const _0x53f0f9=Object['entries'](_0x50554d)['map'](async([_0x11f9cd,_0x57ee85])=>{const _0x534313=_0x1221bf;try{await database_1[_0x534313(0xd2)][_0x534313(0x91)]['upsert']({'where':{'currency':_0x11f9cd[_0x534313(0x9f)]()},'update':{'rate':_0x57ee85},'create':{'currency':_0x11f9cd[_0x534313(0x9f)](),'rate':_0x57ee85}});}catch(_0x1f8f35){console[_0x534313(0x9b)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x11f9cd+':',_0x1f8f35);}});await Promise[_0x1221bf(0x8d)](_0x53f0f9),console[_0x1221bf(0xbe)](_0x1221bf(0x7f));}catch(_0x4e9094){console[_0x1221bf(0x9b)]('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x4e9094);throw _0x4e9094;}}async[a39_0xb1ab58(0x87)](_0x2318d2){const _0x39711a=a39_0xb1ab58,_0x45b5ff=_0x2318d2[_0x39711a(0x9f)]();if(_0x45b5ff===_0x39711a(0x84))return 0x1;try{const _0x3d745f=await database_1[_0x39711a(0xd2)][_0x39711a(0x91)]['findUnique']({'where':{'currency':_0x45b5ff}});if(!_0x3d745f)return console[_0x39711a(0xd1)](_0x39711a(0x76)+_0x2318d2+',\x20using\x201\x20as\x20fallback'),0x1;return _0x3d745f['rate'];}catch(_0x476e16){return console[_0x39711a(0x9b)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x2318d2+':',_0x476e16),0x1;}}async[a39_0xb1ab58(0xaa)](_0x169797,_0xa06186){const _0x5456c7=a39_0xb1ab58,_0x1bd23b=_0xa06186['toLowerCase']();if(_0x1bd23b===_0x5456c7(0x84)){const _0x5197c8=_0x169797*(0x1+this[_0x5456c7(0xac)]/0x64);return console[_0x5456c7(0xbe)](_0x5456c7(0xa1)+this[_0x5456c7(0xac)]+_0x5456c7(0x77)+_0x169797+_0x5456c7(0xc8)+_0x5197c8[_0x5456c7(0xd6)](0x6)+'\x20USDT'),_0x5197c8;}try{const _0x16844c=await this['getCurrencyRate'](_0x1bd23b),_0x358d91=_0x169797/_0x16844c,_0x15cd2c=_0x358d91*(0x1+this[_0x5456c7(0xac)]/0x64);return console['log'](_0x5456c7(0xd5)+_0x169797+'\x20'+_0xa06186['toUpperCase']()+_0x5456c7(0xa9)+_0x358d91[_0x5456c7(0xd6)](0x6)+_0x5456c7(0xdf)+this[_0x5456c7(0xac)]+'%\x20markup\x20=\x20'+_0x15cd2c[_0x5456c7(0xd6)](0x6)+'\x20USDT\x20(rate:\x20'+_0x16844c+')'),_0x15cd2c;}catch(_0xb2ccc2){console[_0x5456c7(0x9b)](_0x5456c7(0x8e)+_0x169797+'\x20'+_0xa06186+_0x5456c7(0xb2),_0xb2ccc2);const _0x52b0d8=_0x169797*(0x1+this[_0x5456c7(0xac)]/0x64);return _0x52b0d8;}}async[a39_0xb1ab58(0x8c)](_0x2c8ac2){const _0x3b6772=a39_0xb1ab58;let _0x4635f9=0x0;for(const {amount:_0x250e98,currency:_0x204d45}of _0x2c8ac2){const _0x29caaa=await this[_0x3b6772(0xaa)](_0x250e98,_0x204d45);_0x4635f9+=_0x29caaa;}return _0x4635f9;}async['getAllRates'](){const _0x1dc9b0=a39_0xb1ab58;try{const _0x32a3b1=await database_1[_0x1dc9b0(0xd2)][_0x1dc9b0(0x91)][_0x1dc9b0(0xd7)]({'select':{'currency':!![],'rate':!![]}}),_0x538ff0={'usdt':0x1};return _0x32a3b1['forEach'](_0x1dfef0=>{const _0x38e32f=_0x1dc9b0;_0x538ff0[_0x1dfef0[_0x38e32f(0xd0)]]=_0x1dfef0[_0x38e32f(0xa8)];}),_0x538ff0;}catch(_0x35e984){return console[_0x1dc9b0(0x9b)](_0x1dc9b0(0xb4),_0x35e984),{'usdt':0x1};}}async['getRatesStatus'](){const _0x415da1=a39_0xb1ab58;try{const [_0x1fa02a,_0x14db9c,_0x383ecb]=await Promise[_0x415da1(0xe4)]([database_1['default'][_0x415da1(0x91)][_0x415da1(0xa6)](),database_1[_0x415da1(0xd2)][_0x415da1(0x91)][_0x415da1(0x75)]({'orderBy':{'updatedAt':_0x415da1(0xce)},'select':{'updatedAt':!![]}}),database_1[_0x415da1(0xd2)]['currencyRate'][_0x415da1(0x75)]({'orderBy':{'updatedAt':_0x415da1(0xcb)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1fa02a,'lastUpdated':_0x14db9c?.[_0x415da1(0xcf)]||null,'oldestRate':_0x383ecb?.[_0x415da1(0xcf)]||null,'markupPercentage':this[_0x415da1(0xac)]};}catch(_0x22c1d8){return console[_0x415da1(0x9b)](_0x415da1(0xc6),_0x22c1d8),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x415da1(0xac)]};}}[a39_0xb1ab58(0x94)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();