'use strict';const a39_0x146553=a39_0x57a6;function a39_0x4e37(){const _0x2c88b4=['updatedAt','json','toFixed','allSettled','pln','Error\x20converting\x20','mmk','\x20USDT,\x20with\x20','Failed\x20to\x20update\x20rate\x20for\x20','kwd','convertToUSDT','CurrencyService','count','\x20to\x20USDT:','%\x20markup\x20to\x20','💱\x20Converted\x20','czk','updateInterval','\x20USDT','21GINKFM','getMarkupPercentage','toLowerCase','ngn','inr','default','✅\x20Currency\x20rates\x20updated\x20successfully','40140WWMejs','\x20USDT\x20(rate:\x20','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','aed','TesSoft\x20Payment\x20System/1.0','findFirst','gbp','Error\x20getting\x20all\x20rates:','sgd','yfi','stopPeriodicUpdates','eur','cny','ltc','1821080ilPZjg','https://api.coingecko.com/api/v3/simple/price','join','toUpperCase','\x20currencies','rate','log','gel','currencyRate','catch','971538oWundu','Initial\x20currency\x20rates\x20update\x20failed:','mxn','Error\x20getting\x20rates\x20status:','convertMultipleToUSDT','usdt','xag','hkd','nok','idr','sek','__esModule','status','twd','../config/database','try','\x20USDT\x20=\x20','__importDefault','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','sar','4020GnFmki','?ids=tether&vs_currencies=',',\x20using\x201\x20as\x20fallback','chf','1954995NblKeP','dkk','application/json','No\x20rate\x20found\x20for\x20currency:\x20','entries','pkr','bits','keys','4kbLqsJ','vnd','asc','aud','%\x20markup\x20=\x20','uah','ils','xlm','findMany','cad','ars','myr','bch','122430cWVjFs','xrp','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','startPeriodicUpdates','jpy','bdt','upsert','error','Periodic\x20currency\x20rates\x20update\x20failed:','CoinGecko\x20API\x20error:\x20','thb','sats','getRatesStatus','eos','449558YsXerr','findUnique','currencyService','nzd','forEach','bmd','brl','COINGECKO_URL','MARKUP_PERCENTAGE','getCurrencyRate','updateCurrencyRates','getAllRates','vef','bnb','📊\x20Received\x20rates\x20for\x20','bhd','rub','zar','eth','php','1671858CKZZUT'];a39_0x4e37=function(){return _0x2c88b4;};return a39_0x4e37();}(function(_0x3427a7,_0x32b5e9){const _0x1f3b64=a39_0x57a6,_0x5cc8d5=_0x3427a7();while(!![]){try{const _0x2c050b=parseInt(_0x1f3b64(0x215))/0x1+-parseInt(_0x1f3b64(0x207))/0x2+-parseInt(_0x1f3b64(0x1a7))/0x3+-parseInt(_0x1f3b64(0x1fa))/0x4*(parseInt(_0x1f3b64(0x1f2))/0x5)+parseInt(_0x1f3b64(0x1da))/0x6*(-parseInt(_0x1f3b64(0x1bb))/0x7)+-parseInt(_0x1f3b64(0x1d0))/0x8+-parseInt(_0x1f3b64(0x1c2))/0x9*(-parseInt(_0x1f3b64(0x1ee))/0xa);if(_0x2c050b===_0x32b5e9)break;else _0x5cc8d5['push'](_0x5cc8d5['shift']());}catch(_0x598151){_0x5cc8d5['push'](_0x5cc8d5['shift']());}}}(a39_0x4e37,0x7ed96));var __importDefault=this&&this[a39_0x146553(0x1eb)]||function(_0x117bc0){const _0x51013e=a39_0x146553;return _0x117bc0&&_0x117bc0[_0x51013e(0x1e5)]?_0x117bc0:{'default':_0x117bc0};};Object['defineProperty'](exports,a39_0x146553(0x1e5),{'value':!![]}),exports['currencyService']=exports[a39_0x146553(0x1b3)]=void 0x0;function a39_0x57a6(_0x238379,_0x323f4b){const _0x4e37ea=a39_0x4e37();return a39_0x57a6=function(_0x57a66b,_0x2bbbf9){_0x57a66b=_0x57a66b-0x1a6;let _0x382684=_0x4e37ea[_0x57a66b];return _0x382684;},a39_0x57a6(_0x238379,_0x323f4b);}const database_1=__importDefault(require(a39_0x146553(0x1e8)));class CurrencyService{constructor(){const _0x4c949e=a39_0x146553;this[_0x4c949e(0x21c)]=_0x4c949e(0x1d1),this['CURRENCIES']=['btc',_0x4c949e(0x227),_0x4c949e(0x1cf),_0x4c949e(0x206),_0x4c949e(0x222),_0x4c949e(0x214),_0x4c949e(0x208),_0x4c949e(0x201),'link','dot',_0x4c949e(0x1cb),'usd',_0x4c949e(0x1c5),_0x4c949e(0x204),_0x4c949e(0x1fd),_0x4c949e(0x20c),_0x4c949e(0x224),_0x4c949e(0x21a),_0x4c949e(0x21b),_0x4c949e(0x203),_0x4c949e(0x1f1),'clp',_0x4c949e(0x1ce),_0x4c949e(0x1b8),_0x4c949e(0x1f3),_0x4c949e(0x1cd),_0x4c949e(0x1c8),_0x4c949e(0x1d7),_0x4c949e(0x1e1),'huf',_0x4c949e(0x1e3),_0x4c949e(0x200),_0x4c949e(0x1bf),_0x4c949e(0x20b),'krw',_0x4c949e(0x1b1),'lkr',_0x4c949e(0x1ae),_0x4c949e(0x1dc),_0x4c949e(0x205),_0x4c949e(0x1be),_0x4c949e(0x1e2),_0x4c949e(0x218),_0x4c949e(0x1a6),_0x4c949e(0x1f7),_0x4c949e(0x1ac),_0x4c949e(0x225),_0x4c949e(0x1ed),_0x4c949e(0x1e4),_0x4c949e(0x1ca),_0x4c949e(0x211),_0x4c949e(0x1e9),_0x4c949e(0x1e7),_0x4c949e(0x1ff),_0x4c949e(0x221),_0x4c949e(0x1fb),_0x4c949e(0x226),'xdr',_0x4c949e(0x1e0),'xau',_0x4c949e(0x1f8),_0x4c949e(0x212)],this['updateInterval']=null,this[_0x4c949e(0x21d)]=0x3,this[_0x4c949e(0x20a)]();}['startPeriodicUpdates'](){const _0x5b5049=a39_0x146553;this['updateCurrencyRates']()[_0x5b5049(0x1d9)](_0x2041ba=>{const _0x4ad7c2=_0x5b5049;console[_0x4ad7c2(0x20e)](_0x4ad7c2(0x1db),_0x2041ba);}),this[_0x5b5049(0x1b9)]=setInterval(async()=>{const _0x52edbf=_0x5b5049;try{await this[_0x52edbf(0x21f)]();}catch(_0x3845d3){console[_0x52edbf(0x20e)](_0x52edbf(0x20f),_0x3845d3);}},0x3c*0x3c*0x3e8),console[_0x5b5049(0x1d6)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a39_0x146553(0x1cc)](){const _0x89c33a=a39_0x146553;this[_0x89c33a(0x1b9)]&&(clearInterval(this[_0x89c33a(0x1b9)]),this[_0x89c33a(0x1b9)]=null,console['log'](_0x89c33a(0x209)));}async['updateCurrencyRates'](){const _0x512d25=a39_0x146553;try{console['log'](_0x512d25(0x1c4));const _0xfb02b1=this['CURRENCIES'][_0x512d25(0x1d2)](','),_0x118770=this[_0x512d25(0x21c)]+_0x512d25(0x1ef)+_0xfb02b1,_0x852830=await fetch(_0x118770,{'headers':{'Accept':_0x512d25(0x1f4),'User-Agent':_0x512d25(0x1c6)}});if(!_0x852830['ok'])throw new Error(_0x512d25(0x210)+_0x852830[_0x512d25(0x1e6)]+'\x20'+_0x852830['statusText']);const _0x460ade=await _0x852830[_0x512d25(0x1a9)]();if(!_0x460ade['tether'])throw new Error(_0x512d25(0x1ec));const _0x4dd4bb=_0x460ade['tether'];console[_0x512d25(0x1d6)](_0x512d25(0x223)+Object[_0x512d25(0x1f9)](_0x4dd4bb)['length']+_0x512d25(0x1d4));const _0x5b90a0=Object[_0x512d25(0x1f6)](_0x4dd4bb)['map'](async([_0x21b90a,_0x10cef5])=>{const _0x17899b=_0x512d25;try{await database_1[_0x17899b(0x1c0)][_0x17899b(0x1d8)][_0x17899b(0x20d)]({'where':{'currency':_0x21b90a[_0x17899b(0x1bd)]()},'update':{'rate':_0x10cef5},'create':{'currency':_0x21b90a[_0x17899b(0x1bd)](),'rate':_0x10cef5}});}catch(_0xedd5c8){console[_0x17899b(0x20e)](_0x17899b(0x1b0)+_0x21b90a+':',_0xedd5c8);}});await Promise[_0x512d25(0x1ab)](_0x5b90a0),console[_0x512d25(0x1d6)](_0x512d25(0x1c1));}catch(_0x110045){console['error']('❌\x20Failed\x20to\x20update\x20currency\x20rates:',_0x110045);throw _0x110045;}}async[a39_0x146553(0x21e)](_0x4af878){const _0x472ccb=a39_0x146553,_0x3d3dba=_0x4af878[_0x472ccb(0x1bd)]();if(_0x3d3dba===_0x472ccb(0x1df))return 0x1;try{const _0x11d2d2=await database_1[_0x472ccb(0x1c0)][_0x472ccb(0x1d8)][_0x472ccb(0x216)]({'where':{'currency':_0x3d3dba}});if(!_0x11d2d2)return console['warn'](_0x472ccb(0x1f5)+_0x4af878+_0x472ccb(0x1f0)),0x1;return _0x11d2d2[_0x472ccb(0x1d5)];}catch(_0x4f75a4){return console[_0x472ccb(0x20e)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x4af878+':',_0x4f75a4),0x1;}}async[a39_0x146553(0x1b2)](_0x3b65e4,_0x5ec5dc){const _0x1c8296=a39_0x146553,_0x61bbdf=_0x5ec5dc['toLowerCase']();if(_0x61bbdf===_0x1c8296(0x1df)){const _0x5c611f=_0x3b65e4*(0x1+this[_0x1c8296(0x21d)]/0x64);return console['log']('💱\x20Applied\x20'+this[_0x1c8296(0x21d)]+_0x1c8296(0x1b6)+_0x3b65e4+_0x1c8296(0x1ea)+_0x5c611f[_0x1c8296(0x1aa)](0x6)+_0x1c8296(0x1ba)),_0x5c611f;}try{const _0x509245=await this[_0x1c8296(0x21e)](_0x61bbdf),_0x4ab85d=_0x3b65e4/_0x509245,_0x51fcda=_0x4ab85d*(0x1+this[_0x1c8296(0x21d)]/0x64);return console['log'](_0x1c8296(0x1b7)+_0x3b65e4+'\x20'+_0x5ec5dc[_0x1c8296(0x1d3)]()+'\x20to\x20'+_0x4ab85d[_0x1c8296(0x1aa)](0x6)+_0x1c8296(0x1af)+this[_0x1c8296(0x21d)]+_0x1c8296(0x1fe)+_0x51fcda['toFixed'](0x6)+_0x1c8296(0x1c3)+_0x509245+')'),_0x51fcda;}catch(_0x4f81d7){console[_0x1c8296(0x20e)](_0x1c8296(0x1ad)+_0x3b65e4+'\x20'+_0x5ec5dc+_0x1c8296(0x1b5),_0x4f81d7);const _0x47da51=_0x3b65e4*(0x1+this[_0x1c8296(0x21d)]/0x64);return _0x47da51;}}async[a39_0x146553(0x1de)](_0x2b8ad9){const _0x414bdc=a39_0x146553;let _0x413268=0x0;for(const {amount:_0x5decb0,currency:_0x13ad9d}of _0x2b8ad9){const _0x1f5587=await this[_0x414bdc(0x1b2)](_0x5decb0,_0x13ad9d);_0x413268+=_0x1f5587;}return _0x413268;}async[a39_0x146553(0x220)](){const _0x24d4e3=a39_0x146553;try{const _0x2c82e9=await database_1[_0x24d4e3(0x1c0)][_0x24d4e3(0x1d8)][_0x24d4e3(0x202)]({'select':{'currency':!![],'rate':!![]}}),_0x16e36f={'usdt':0x1};return _0x2c82e9[_0x24d4e3(0x219)](_0x168d69=>{const _0x2498c5=_0x24d4e3;_0x16e36f[_0x168d69['currency']]=_0x168d69[_0x2498c5(0x1d5)];}),_0x16e36f;}catch(_0x26e623){return console[_0x24d4e3(0x20e)](_0x24d4e3(0x1c9),_0x26e623),{'usdt':0x1};}}async[a39_0x146553(0x213)](){const _0x249f7b=a39_0x146553;try{const [_0x2d3672,_0x3a7cce,_0x36ccc7]=await Promise['all']([database_1[_0x249f7b(0x1c0)][_0x249f7b(0x1d8)][_0x249f7b(0x1b4)](),database_1['default'][_0x249f7b(0x1d8)][_0x249f7b(0x1c7)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x249f7b(0x1c7)]({'orderBy':{'updatedAt':_0x249f7b(0x1fc)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2d3672,'lastUpdated':_0x3a7cce?.[_0x249f7b(0x1a8)]||null,'oldestRate':_0x36ccc7?.[_0x249f7b(0x1a8)]||null,'markupPercentage':this[_0x249f7b(0x21d)]};}catch(_0x3fb632){return console[_0x249f7b(0x20e)](_0x249f7b(0x1dd),_0x3fb632),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x249f7b(0x21d)]};}}[a39_0x146553(0x1bc)](){const _0x400e9e=a39_0x146553;return this[_0x400e9e(0x21d)];}}exports[a39_0x146553(0x1b3)]=CurrencyService,exports[a39_0x146553(0x217)]=new CurrencyService();