'use strict';const a39_0x28e1e4=a39_0x2106;(function(_0x12df27,_0x5b4935){const _0x170944=a39_0x2106,_0x5a3269=_0x12df27();while(!![]){try{const _0x3bea26=parseInt(_0x170944(0x1b6))/0x1*(-parseInt(_0x170944(0x1d3))/0x2)+-parseInt(_0x170944(0x16d))/0x3+parseInt(_0x170944(0x159))/0x4*(parseInt(_0x170944(0x19b))/0x5)+parseInt(_0x170944(0x178))/0x6*(-parseInt(_0x170944(0x17a))/0x7)+-parseInt(_0x170944(0x1b2))/0x8*(parseInt(_0x170944(0x172))/0x9)+-parseInt(_0x170944(0x1ce))/0xa*(parseInt(_0x170944(0x19c))/0xb)+parseInt(_0x170944(0x15c))/0xc*(parseInt(_0x170944(0x1b3))/0xd);if(_0x3bea26===_0x5b4935)break;else _0x5a3269['push'](_0x5a3269['shift']());}catch(_0x1c2958){_0x5a3269['push'](_0x5a3269['shift']());}}}(a39_0x1f13,0x972c5));function a39_0x1f13(){const _0x5650e9=['vef','pln','keys','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','bhd','3460134rgWwWC','ltc','7nxXCzE','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','forEach','getRatesStatus','application/json','CurrencyService',',\x20using\x201\x20as\x20fallback','currency','findMany','updateInterval','nzd','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','startPeriodicUpdates','eur','clp','catch','CoinGecko\x20API\x20error:\x20','statusText','pkr','vnd','\x20to\x20','desc','rate','nok','json','cad','inr','✅\x20Currency\x20rates\x20updated\x20successfully','\x20USDT,\x20with\x20','xag','error','tether','dot','20rVNcFA','8548111TiywnA','Initial\x20currency\x20rates\x20update\x20failed:','twd','getMarkupPercentage','sek','bmd','ngn','\x20to\x20USDT:','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','link','usd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','currencyRate','getCurrencyRate','aud','mxn','COINGECKO_URL','TesSoft\x20Payment\x20System/1.0','💱\x20Converted\x20','php','uah','asc','16iXTIMX','4176419qsYUFa','currencyService','map','628819PKPIGH','defineProperty','huf','../config/database','jpy','gbp','chf','bnb','count','MARKUP_PERCENTAGE','mmk','convertMultipleToUSDT','myr','join','ils','allSettled','xlm','thb','xrp','updatedAt','log','toLowerCase','hkd','all','10HjTRLW','status','cny','entries','default','2gXQbyJ','\x20USDT\x20=\x20','stopPeriodicUpdates','sar','https://api.coingecko.com/api/v3/simple/price','Error\x20getting\x20all\x20rates:','\x20USDT','Error\x20converting\x20','405704Emuwrt','convertToUSDT','?ids=tether&vs_currencies=','120zXsbQk','CURRENCIES','findFirst','eos','bch','xdr','krw','sgd','length','toFixed','No\x20rate\x20found\x20for\x20currency:\x20','upsert','__esModule','dkk','bdt','zar','rub','452352kHBIYJ','Periodic\x20currency\x20rates\x20update\x20failed:','warn','updateCurrencyRates','xau','3895812gTfFQB'];a39_0x1f13=function(){return _0x5650e9;};return a39_0x1f13();}var __importDefault=this&&this['__importDefault']||function(_0x134878){const _0x2d2370=a39_0x2106;return _0x134878&&_0x134878[_0x2d2370(0x168)]?_0x134878:{'default':_0x134878};};Object[a39_0x28e1e4(0x1b7)](exports,a39_0x28e1e4(0x168),{'value':!![]}),exports[a39_0x28e1e4(0x1b4)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a39_0x28e1e4(0x1b9)));class CurrencyService{constructor(){const _0x2fb2ba=a39_0x28e1e4;this[_0x2fb2ba(0x1ac)]=_0x2fb2ba(0x155),this['CURRENCIES']=['btc','eth',_0x2fb2ba(0x179),_0x2fb2ba(0x160),_0x2fb2ba(0x1bd),_0x2fb2ba(0x15f),_0x2fb2ba(0x1c8),_0x2fb2ba(0x1c6),_0x2fb2ba(0x1a5),_0x2fb2ba(0x19a),'yfi',_0x2fb2ba(0x1a6),'aed','ars',_0x2fb2ba(0x1aa),_0x2fb2ba(0x16a),_0x2fb2ba(0x177),_0x2fb2ba(0x1a1),'brl',_0x2fb2ba(0x193),_0x2fb2ba(0x1bc),_0x2fb2ba(0x188),_0x2fb2ba(0x1d0),'czk',_0x2fb2ba(0x169),_0x2fb2ba(0x187),_0x2fb2ba(0x1bb),'gel',_0x2fb2ba(0x1cc),_0x2fb2ba(0x1b8),'idr',_0x2fb2ba(0x1c4),_0x2fb2ba(0x194),_0x2fb2ba(0x1ba),_0x2fb2ba(0x162),'kwd','lkr',_0x2fb2ba(0x1c0),_0x2fb2ba(0x1ab),_0x2fb2ba(0x1c2),_0x2fb2ba(0x1a2),_0x2fb2ba(0x191),_0x2fb2ba(0x184),_0x2fb2ba(0x1af),_0x2fb2ba(0x18c),_0x2fb2ba(0x174),_0x2fb2ba(0x16c),_0x2fb2ba(0x1d6),_0x2fb2ba(0x1a0),_0x2fb2ba(0x163),_0x2fb2ba(0x1c7),'try',_0x2fb2ba(0x19e),_0x2fb2ba(0x1b0),_0x2fb2ba(0x173),_0x2fb2ba(0x18d),_0x2fb2ba(0x16b),_0x2fb2ba(0x161),_0x2fb2ba(0x197),_0x2fb2ba(0x171),'bits','sats'],this[_0x2fb2ba(0x183)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x2fb2ba(0x186)]();}[a39_0x28e1e4(0x186)](){const _0x439aae=a39_0x28e1e4;this['updateCurrencyRates']()[_0x439aae(0x189)](_0x212e04=>{const _0x57349c=_0x439aae;console[_0x57349c(0x198)](_0x57349c(0x19d),_0x212e04);}),this[_0x439aae(0x183)]=setInterval(async()=>{const _0x4a517a=_0x439aae;try{await this[_0x4a517a(0x170)]();}catch(_0x5a1077){console['error'](_0x4a517a(0x16e),_0x5a1077);}},0x3c*0x3c*0x3e8),console['log'](_0x439aae(0x1a4));}[a39_0x28e1e4(0x1d5)](){const _0x5b36d9=a39_0x28e1e4;this[_0x5b36d9(0x183)]&&(clearInterval(this[_0x5b36d9(0x183)]),this[_0x5b36d9(0x183)]=null,console[_0x5b36d9(0x1ca)](_0x5b36d9(0x185)));}async['updateCurrencyRates'](){const _0x194c22=a39_0x28e1e4;try{console[_0x194c22(0x1ca)](_0x194c22(0x176));const _0x319ecf=this[_0x194c22(0x15d)][_0x194c22(0x1c3)](','),_0x4f5a88=this[_0x194c22(0x1ac)]+_0x194c22(0x15b)+_0x319ecf,_0x559d45=await fetch(_0x4f5a88,{'headers':{'Accept':_0x194c22(0x17e),'User-Agent':_0x194c22(0x1ad)}});if(!_0x559d45['ok'])throw new Error(_0x194c22(0x18a)+_0x559d45[_0x194c22(0x1cf)]+'\x20'+_0x559d45[_0x194c22(0x18b)]);const _0x7c75ba=await _0x559d45[_0x194c22(0x192)]();if(!_0x7c75ba[_0x194c22(0x199)])throw new Error(_0x194c22(0x17b));const _0x1b29c6=_0x7c75ba['tether'];console[_0x194c22(0x1ca)]('📊\x20Received\x20rates\x20for\x20'+Object[_0x194c22(0x175)](_0x1b29c6)[_0x194c22(0x164)]+'\x20currencies');const _0x22bdeb=Object[_0x194c22(0x1d1)](_0x1b29c6)[_0x194c22(0x1b5)](async([_0x392eaa,_0x576ebd])=>{const _0x3eb930=_0x194c22;try{await database_1[_0x3eb930(0x1d2)][_0x3eb930(0x1a8)][_0x3eb930(0x167)]({'where':{'currency':_0x392eaa[_0x3eb930(0x1cb)]()},'update':{'rate':_0x576ebd},'create':{'currency':_0x392eaa[_0x3eb930(0x1cb)](),'rate':_0x576ebd}});}catch(_0x5677e5){console[_0x3eb930(0x198)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x392eaa+':',_0x5677e5);}});await Promise[_0x194c22(0x1c5)](_0x22bdeb),console[_0x194c22(0x1ca)](_0x194c22(0x195));}catch(_0x43476c){console[_0x194c22(0x198)](_0x194c22(0x1a7),_0x43476c);throw _0x43476c;}}async[a39_0x28e1e4(0x1a9)](_0x26b2dd){const _0x44bdce=a39_0x28e1e4,_0xfed352=_0x26b2dd[_0x44bdce(0x1cb)]();if(_0xfed352==='usdt')return 0x1;try{const _0x58265b=await database_1[_0x44bdce(0x1d2)][_0x44bdce(0x1a8)]['findUnique']({'where':{'currency':_0xfed352}});if(!_0x58265b)return console[_0x44bdce(0x16f)](_0x44bdce(0x166)+_0x26b2dd+_0x44bdce(0x180)),0x1;return _0x58265b[_0x44bdce(0x190)];}catch(_0x8dde68){return console['error']('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x26b2dd+':',_0x8dde68),0x1;}}async[a39_0x28e1e4(0x15a)](_0x9554d1,_0x2000f8){const _0x422b2d=a39_0x28e1e4,_0x2b2792=_0x2000f8[_0x422b2d(0x1cb)]();if(_0x2b2792==='usdt'){const _0x3b53a8=_0x9554d1*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x422b2d(0x1ca)]('💱\x20Applied\x20'+this[_0x422b2d(0x1bf)]+'%\x20markup\x20to\x20'+_0x9554d1+_0x422b2d(0x1d4)+_0x3b53a8[_0x422b2d(0x165)](0x6)+_0x422b2d(0x157)),_0x3b53a8;}try{const _0x31983d=await this[_0x422b2d(0x1a9)](_0x2b2792),_0x5bfbf8=_0x9554d1/_0x31983d,_0x19df4b=_0x5bfbf8*(0x1+this[_0x422b2d(0x1bf)]/0x64);return console[_0x422b2d(0x1ca)](_0x422b2d(0x1ae)+_0x9554d1+'\x20'+_0x2000f8['toUpperCase']()+_0x422b2d(0x18e)+_0x5bfbf8[_0x422b2d(0x165)](0x6)+_0x422b2d(0x196)+this[_0x422b2d(0x1bf)]+'%\x20markup\x20=\x20'+_0x19df4b[_0x422b2d(0x165)](0x6)+'\x20USDT\x20(rate:\x20'+_0x31983d+')'),_0x19df4b;}catch(_0x3d7277){console[_0x422b2d(0x198)](_0x422b2d(0x158)+_0x9554d1+'\x20'+_0x2000f8+_0x422b2d(0x1a3),_0x3d7277);const _0x1b4e07=_0x9554d1*(0x1+this[_0x422b2d(0x1bf)]/0x64);return _0x1b4e07;}}async[a39_0x28e1e4(0x1c1)](_0x14403e){const _0x263cd6=a39_0x28e1e4;let _0x32a2c3=0x0;for(const {amount:_0x36e9dd,currency:_0x32f4e4}of _0x14403e){const _0x39fec5=await this[_0x263cd6(0x15a)](_0x36e9dd,_0x32f4e4);_0x32a2c3+=_0x39fec5;}return _0x32a2c3;}async['getAllRates'](){const _0x418335=a39_0x28e1e4;try{const _0x327001=await database_1['default'][_0x418335(0x1a8)][_0x418335(0x182)]({'select':{'currency':!![],'rate':!![]}}),_0x9fa2b7={'usdt':0x1};return _0x327001[_0x418335(0x17c)](_0x3c634f=>{const _0x4baf27=_0x418335;_0x9fa2b7[_0x3c634f[_0x4baf27(0x181)]]=_0x3c634f[_0x4baf27(0x190)];}),_0x9fa2b7;}catch(_0x48166c){return console[_0x418335(0x198)](_0x418335(0x156),_0x48166c),{'usdt':0x1};}}async[a39_0x28e1e4(0x17d)](){const _0x285013=a39_0x28e1e4;try{const [_0x39dc95,_0x3830f0,_0x2c01fa]=await Promise[_0x285013(0x1cd)]([database_1[_0x285013(0x1d2)][_0x285013(0x1a8)][_0x285013(0x1be)](),database_1['default']['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x285013(0x18f)},'select':{'updatedAt':!![]}}),database_1[_0x285013(0x1d2)][_0x285013(0x1a8)][_0x285013(0x15e)]({'orderBy':{'updatedAt':_0x285013(0x1b1)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x39dc95,'lastUpdated':_0x3830f0?.[_0x285013(0x1c9)]||null,'oldestRate':_0x2c01fa?.['updatedAt']||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0x11ac83){return console[_0x285013(0x198)]('Error\x20getting\x20rates\x20status:',_0x11ac83),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x285013(0x1bf)]};}}[a39_0x28e1e4(0x19f)](){const _0x14470f=a39_0x28e1e4;return this[_0x14470f(0x1bf)];}}function a39_0x2106(_0xb05bbe,_0x4c40ea){const _0x1f1321=a39_0x1f13();return a39_0x2106=function(_0x210654,_0x231322){_0x210654=_0x210654-0x155;let _0x544eb4=_0x1f1321[_0x210654];return _0x544eb4;},a39_0x2106(_0xb05bbe,_0x4c40ea);}exports[a39_0x28e1e4(0x17f)]=CurrencyService,exports['currencyService']=new CurrencyService();