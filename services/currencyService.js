'use strict';const a43_0x44a633=a43_0x2639;(function(_0x1aa5fb,_0x27ce65){const _0x4d361e=a43_0x2639,_0x23bd05=_0x1aa5fb();while(!![]){try{const _0x189685=-parseInt(_0x4d361e(0x1a0))/0x1*(-parseInt(_0x4d361e(0x1a3))/0x2)+-parseInt(_0x4d361e(0x1c8))/0x3+-parseInt(_0x4d361e(0x1d8))/0x4+parseInt(_0x4d361e(0x1af))/0x5+parseInt(_0x4d361e(0x1a6))/0x6+-parseInt(_0x4d361e(0x1e0))/0x7+parseInt(_0x4d361e(0x1ff))/0x8;if(_0x189685===_0x27ce65)break;else _0x23bd05['push'](_0x23bd05['shift']());}catch(_0x3ffb47){_0x23bd05['push'](_0x23bd05['shift']());}}}(a43_0x2c9f,0x39fad));var __importDefault=this&&this['__importDefault']||function(_0x57d843){const _0x97897d=a43_0x2639;return _0x57d843&&_0x57d843[_0x97897d(0x1cb)]?_0x57d843:{'default':_0x57d843};};function a43_0x2c9f(){const _0x13d816=['6xTOjsS','czk','bnb','44642TABkkY','stopPeriodicUpdates','defineProperty','1402698AezsDi','updatedAt','ars','%\x20markup\x20=\x20','currencyRate','Periodic\x20currency\x20rates\x20update\x20failed:','ngn','Payment\x20System/1.0','getMarkupPercentage','747980Jgqrum','asc','updateInterval','aud','statusText','usd','eur','application/json',',\x20using\x201\x20as\x20fallback','xag','eth','Error\x20getting\x20rates\x20status:','thb','toLowerCase','length','usdt','hkd','findUnique','warn','convertToUSDT','kwd','findFirst','\x20currencies','xrp','xdr','1424670UcAfMd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','rate','__esModule','xau','\x20to\x20USDT:','Error\x20converting\x20','vef','twd','../config/database','sek','forEach','myr','\x20USDT,\x20with\x20','findMany','nok','885968wLbidQ','gbp','mmk','No\x20rate\x20found\x20for\x20currency:\x20','toFixed','cny','huf','all','3242897XjadNc','bits','Failed\x20to\x20update\x20rate\x20for\x20','rub','allSettled','💱\x20Converted\x20','startPeriodicUpdates','dot','lkr','clp','entries','tether','eos','idr','count','📊\x20Received\x20rates\x20for\x20','currencyService','desc','map','sgd','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','convertMultipleToUSDT','getRatesStatus','getAllRates','currency','Error\x20getting\x20rate\x20for\x20currency\x20','join','COINGECKO_URL','error','sar','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','7038664VstihW','pln','btc','vnd','getCurrencyRate','upsert','CURRENCIES','\x20to\x20','keys','jpy','zar','log','yfi','sats','CurrencyService','\x20USDT\x20(rate:\x20','MARKUP_PERCENTAGE','php','link','dkk','ltc','bmd','bch','\x20USDT\x20=\x20','updateCurrencyRates','nzd','xlm','chf','default','💱\x20Applied\x20','CoinGecko\x20API\x20error:\x20','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'];a43_0x2c9f=function(){return _0x13d816;};return a43_0x2c9f();}function a43_0x2639(_0x1a73ac,_0x2d0e96){const _0x2c9f83=a43_0x2c9f();return a43_0x2639=function(_0x26395d,_0x19dd12){_0x26395d=_0x26395d-0x18d;let _0x28a277=_0x2c9f83[_0x26395d];return _0x28a277;},a43_0x2639(_0x1a73ac,_0x2d0e96);}Object[a43_0x44a633(0x1a5)](exports,a43_0x44a633(0x1cb),{'value':!![]}),exports['currencyService']=exports[a43_0x44a633(0x18e)]=void 0x0;const database_1=__importDefault(require(a43_0x44a633(0x1d1)));class CurrencyService{constructor(){const _0x1d7dc8=a43_0x44a633;this[_0x1d7dc8(0x1fb)]='https://api.coingecko.com/api/v3/simple/price',this[_0x1d7dc8(0x205)]=[_0x1d7dc8(0x201),_0x1d7dc8(0x1b9),_0x1d7dc8(0x194),_0x1d7dc8(0x196),_0x1d7dc8(0x1a2),_0x1d7dc8(0x1ec),_0x1d7dc8(0x1c6),_0x1d7dc8(0x19a),_0x1d7dc8(0x192),_0x1d7dc8(0x1e7),_0x1d7dc8(0x20b),_0x1d7dc8(0x1b4),'aed',_0x1d7dc8(0x1a8),_0x1d7dc8(0x1b2),'bdt','bhd',_0x1d7dc8(0x195),'brl','cad',_0x1d7dc8(0x19b),_0x1d7dc8(0x1e9),_0x1d7dc8(0x1dd),_0x1d7dc8(0x1a1),_0x1d7dc8(0x193),_0x1d7dc8(0x1b5),_0x1d7dc8(0x1d9),'gel',_0x1d7dc8(0x1bf),_0x1d7dc8(0x1de),_0x1d7dc8(0x1ed),'ils','inr',_0x1d7dc8(0x208),'krw',_0x1d7dc8(0x1c3),_0x1d7dc8(0x1e8),_0x1d7dc8(0x1da),'mxn',_0x1d7dc8(0x1d4),_0x1d7dc8(0x1ac),_0x1d7dc8(0x1d7),_0x1d7dc8(0x199),_0x1d7dc8(0x191),'pkr',_0x1d7dc8(0x200),_0x1d7dc8(0x1e3),_0x1d7dc8(0x1fd),_0x1d7dc8(0x1d2),_0x1d7dc8(0x1f3),_0x1d7dc8(0x1bb),'try',_0x1d7dc8(0x1d0),'uah',_0x1d7dc8(0x1cf),_0x1d7dc8(0x202),_0x1d7dc8(0x209),_0x1d7dc8(0x1c7),_0x1d7dc8(0x1b8),_0x1d7dc8(0x1cc),_0x1d7dc8(0x1e1),_0x1d7dc8(0x18d)],this[_0x1d7dc8(0x1b1)]=null,this[_0x1d7dc8(0x190)]=-0x3,this[_0x1d7dc8(0x1e6)]();}[a43_0x44a633(0x1e6)](){const _0x50a181=a43_0x44a633;this[_0x50a181(0x198)]()['catch'](_0x178f4a=>{console['error']('Initial\x20currency\x20rates\x20update\x20failed:',_0x178f4a);}),this[_0x50a181(0x1b1)]=setInterval(async()=>{const _0x95152=_0x50a181;try{await this['updateCurrencyRates']();}catch(_0x5e32ca){console[_0x95152(0x1fc)](_0x95152(0x1ab),_0x5e32ca);}},0x3c*0x3c*0x3e8),console['log'](_0x50a181(0x1f4));}[a43_0x44a633(0x1a4)](){const _0x26c4af=a43_0x44a633;this['updateInterval']&&(clearInterval(this[_0x26c4af(0x1b1)]),this[_0x26c4af(0x1b1)]=null,console[_0x26c4af(0x20a)](_0x26c4af(0x19f)));}async['updateCurrencyRates'](){const _0x51d265=a43_0x44a633;try{console[_0x51d265(0x20a)]('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x5ba7ec=this[_0x51d265(0x205)][_0x51d265(0x1fa)](','),_0x47d694=this[_0x51d265(0x1fb)]+'?ids=tether&vs_currencies='+_0x5ba7ec,_0x5c9425=await fetch(_0x47d694,{'headers':{'Accept':_0x51d265(0x1b6),'User-Agent':_0x51d265(0x1ad)}});if(!_0x5c9425['ok'])throw new Error(_0x51d265(0x19e)+_0x5c9425['status']+'\x20'+_0x5c9425[_0x51d265(0x1b3)]);const _0x25c196=await _0x5c9425['json']();if(!_0x25c196[_0x51d265(0x1eb)])throw new Error(_0x51d265(0x1fe));const _0x2969f9=_0x25c196['tether'];console['log'](_0x51d265(0x1ef)+Object[_0x51d265(0x207)](_0x2969f9)[_0x51d265(0x1bd)]+_0x51d265(0x1c5));const _0x1b258e=Object[_0x51d265(0x1ea)](_0x2969f9)[_0x51d265(0x1f2)](async([_0xd60a16,_0x401d2a])=>{const _0x707a8e=_0x51d265;try{await database_1[_0x707a8e(0x19c)][_0x707a8e(0x1aa)][_0x707a8e(0x204)]({'where':{'currency':_0xd60a16[_0x707a8e(0x1bc)]()},'update':{'rate':_0x401d2a},'create':{'currency':_0xd60a16[_0x707a8e(0x1bc)](),'rate':_0x401d2a}});}catch(_0x1fd098){console[_0x707a8e(0x1fc)](_0x707a8e(0x1e2)+_0xd60a16+':',_0x1fd098);}});await Promise[_0x51d265(0x1e4)](_0x1b258e),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x6d0fb3){console[_0x51d265(0x1fc)](_0x51d265(0x1c9),_0x6d0fb3);throw _0x6d0fb3;}}async[a43_0x44a633(0x203)](_0x17a713){const _0x52f257=a43_0x44a633,_0x1791ca=_0x17a713[_0x52f257(0x1bc)]();if(_0x1791ca===_0x52f257(0x1be))return 0x1;try{const _0xd0babf=await database_1[_0x52f257(0x19c)][_0x52f257(0x1aa)][_0x52f257(0x1c0)]({'where':{'currency':_0x1791ca}});if(!_0xd0babf)return console[_0x52f257(0x1c1)](_0x52f257(0x1db)+_0x17a713+_0x52f257(0x1b7)),0x1;return _0xd0babf[_0x52f257(0x1ca)];}catch(_0x4cedae){return console['error'](_0x52f257(0x1f9)+_0x17a713+':',_0x4cedae),0x1;}}async[a43_0x44a633(0x1c2)](_0x1c9243,_0xcc337f){const _0x252015=a43_0x44a633,_0x18e77c=_0xcc337f['toLowerCase']();if(_0x18e77c===_0x252015(0x1be)){const _0x22c917=_0x1c9243*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x252015(0x20a)](_0x252015(0x19d)+this[_0x252015(0x190)]+'%\x20markup\x20to\x20'+_0x1c9243+_0x252015(0x197)+_0x22c917[_0x252015(0x1dc)](0x6)+'\x20USDT'),_0x22c917;}try{const _0x310ceb=await this[_0x252015(0x203)](_0x18e77c),_0x125761=_0x1c9243/_0x310ceb,_0x2af9d4=_0x125761*(0x1+this[_0x252015(0x190)]/0x64);return console[_0x252015(0x20a)](_0x252015(0x1e5)+_0x1c9243+'\x20'+_0xcc337f['toUpperCase']()+_0x252015(0x206)+_0x125761[_0x252015(0x1dc)](0x6)+_0x252015(0x1d5)+this[_0x252015(0x190)]+_0x252015(0x1a9)+_0x2af9d4[_0x252015(0x1dc)](0x6)+_0x252015(0x18f)+_0x310ceb+')'),_0x2af9d4;}catch(_0x504d19){console[_0x252015(0x1fc)](_0x252015(0x1ce)+_0x1c9243+'\x20'+_0xcc337f+_0x252015(0x1cd),_0x504d19);const _0x437ad4=_0x1c9243*(0x1+this[_0x252015(0x190)]/0x64);return _0x437ad4;}}async[a43_0x44a633(0x1f5)](_0x46a18c){let _0x3cfbdc=0x0;for(const {amount:_0x41363f,currency:_0x250fd4}of _0x46a18c){const _0x43b7af=await this['convertToUSDT'](_0x41363f,_0x250fd4);_0x3cfbdc+=_0x43b7af;}return _0x3cfbdc;}async[a43_0x44a633(0x1f7)](){const _0xca32d4=a43_0x44a633;try{const _0x2c465b=await database_1[_0xca32d4(0x19c)]['currencyRate'][_0xca32d4(0x1d6)]({'select':{'currency':!![],'rate':!![]}}),_0x4d0a45={'usdt':0x1};return _0x2c465b[_0xca32d4(0x1d3)](_0x1156b9=>{const _0x176de8=_0xca32d4;_0x4d0a45[_0x1156b9[_0x176de8(0x1f8)]]=_0x1156b9[_0x176de8(0x1ca)];}),_0x4d0a45;}catch(_0x2f67e1){return console[_0xca32d4(0x1fc)]('Error\x20getting\x20all\x20rates:',_0x2f67e1),{'usdt':0x1};}}async[a43_0x44a633(0x1f6)](){const _0x4f055e=a43_0x44a633;try{const [_0x3c4eb8,_0x23d391,_0x1d8316]=await Promise[_0x4f055e(0x1df)]([database_1[_0x4f055e(0x19c)][_0x4f055e(0x1aa)][_0x4f055e(0x1ee)](),database_1[_0x4f055e(0x19c)][_0x4f055e(0x1aa)][_0x4f055e(0x1c4)]({'orderBy':{'updatedAt':_0x4f055e(0x1f1)},'select':{'updatedAt':!![]}}),database_1[_0x4f055e(0x19c)]['currencyRate']['findFirst']({'orderBy':{'updatedAt':_0x4f055e(0x1b0)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x3c4eb8,'lastUpdated':_0x23d391?.[_0x4f055e(0x1a7)]||null,'oldestRate':_0x1d8316?.[_0x4f055e(0x1a7)]||null,'markupPercentage':this['MARKUP_PERCENTAGE']};}catch(_0xb43ae1){return console['error'](_0x4f055e(0x1ba),_0xb43ae1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4f055e(0x190)]};}}[a43_0x44a633(0x1ae)](){const _0x1d96e5=a43_0x44a633;return this[_0x1d96e5(0x190)];}}exports['CurrencyService']=CurrencyService,exports[a43_0x44a633(0x1f0)]=new CurrencyService();