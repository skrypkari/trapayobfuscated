'use strict';const a39_0x2ff8e0=a39_0x170d;(function(_0x5c0032,_0x2b662a){const _0x11cbf1=a39_0x170d,_0x3df29d=_0x5c0032();while(!![]){try{const _0x36434b=parseInt(_0x11cbf1(0x244))/0x1*(-parseInt(_0x11cbf1(0x239))/0x2)+-parseInt(_0x11cbf1(0x226))/0x3*(-parseInt(_0x11cbf1(0x20b))/0x4)+-parseInt(_0x11cbf1(0x22b))/0x5+parseInt(_0x11cbf1(0x238))/0x6*(parseInt(_0x11cbf1(0x24e))/0x7)+-parseInt(_0x11cbf1(0x251))/0x8+-parseInt(_0x11cbf1(0x209))/0x9*(parseInt(_0x11cbf1(0x252))/0xa)+parseInt(_0x11cbf1(0x25d))/0xb;if(_0x36434b===_0x2b662a)break;else _0x3df29d['push'](_0x3df29d['shift']());}catch(_0x4fc91e){_0x3df29d['push'](_0x3df29d['shift']());}}}(a39_0x8594,0x1e81a));var __importDefault=this&&this[a39_0x2ff8e0(0x264)]||function(_0x443167){return _0x443167&&_0x443167['__esModule']?_0x443167:{'default':_0x443167};};Object[a39_0x2ff8e0(0x221)](exports,a39_0x2ff8e0(0x200),{'value':!![]}),exports[a39_0x2ff8e0(0x1f4)]=exports[a39_0x2ff8e0(0x259)]=void 0x0;const database_1=__importDefault(require(a39_0x2ff8e0(0x222)));function a39_0x8594(){const _0x1948a5=['gel','yfi','__esModule','rate','mmk','entries','lkr','json','findUnique','toLowerCase','xrp','7389HZItrw','btc','1156CrHQqn','Initial\x20currency\x20rates\x20update\x20failed:','uah','rub','✅\x20Currency\x20rates\x20updated\x20successfully','💱\x20Converted\x20','findMany','bmd','\x20USDT\x20(rate:\x20','sek','count','zar','bits','updatedAt','pkr','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','catch','statusText','warn','stopPeriodicUpdates','ngn','currency','defineProperty','../config/database','jpy','huf','sar','2307JHFEMn','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...',',\x20using\x201\x20as\x20fallback','Error\x20getting\x20all\x20rates:','eos','774825LjgCYF','map','Error\x20getting\x20rate\x20for\x20currency\x20','tether','xau','xlm','length','MARKUP_PERCENTAGE','clp','ils','forEach','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','startPeriodicUpdates','12ioFkqt','2qtGMZc','convertMultipleToUSDT','getCurrencyRate','\x20to\x20','findFirst','bhd','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','desc','join','No\x20rate\x20found\x20for\x20currency:\x20','sats','231839opPMnQ','xag','https://api.coingecko.com/api/v3/simple/price','usd','updateCurrencyRates','ars','dot','Periodic\x20currency\x20rates\x20update\x20failed:','CURRENCIES','convertToUSDT','649579HwKlWR','toUpperCase','keys','191920OcHZJw','930bOWeGL','nzd','default','💱\x20Applied\x20','bnb','toFixed','currencyRate','CurrencyService','ltc','Error\x20converting\x20','idr','2246926vZSMnQ','\x20currencies','mxn','usdt','application/json','krw','error','__importDefault','\x20USDT,\x20with\x20','bdt','czk','hkd','cad','❌\x20Failed\x20to\x20update\x20currency\x20rates:','COINGECKO_URL','\x20to\x20USDT:','myr','aud','updateInterval','link','sgd','currencyService','chf','vnd','upsert','aed','📊\x20Received\x20rates\x20for\x20','log','Failed\x20to\x20update\x20rate\x20for\x20','CoinGecko\x20API\x20error:\x20','getRatesStatus'];a39_0x8594=function(){return _0x1948a5;};return a39_0x8594();}function a39_0x170d(_0x3f817a,_0x206a00){const _0x859474=a39_0x8594();return a39_0x170d=function(_0x170dc5,_0x339d00){_0x170dc5=_0x170dc5-0x1e8;let _0x3f4a69=_0x859474[_0x170dc5];return _0x3f4a69;},a39_0x170d(_0x3f817a,_0x206a00);}class CurrencyService{constructor(){const _0x115ac8=a39_0x2ff8e0;this[_0x115ac8(0x1ed)]=_0x115ac8(0x246),this['CURRENCIES']=[_0x115ac8(0x20a),'eth',_0x115ac8(0x25a),'bch',_0x115ac8(0x256),_0x115ac8(0x22a),_0x115ac8(0x208),_0x115ac8(0x230),_0x115ac8(0x1f2),_0x115ac8(0x24a),_0x115ac8(0x1ff),_0x115ac8(0x247),_0x115ac8(0x1f8),_0x115ac8(0x249),_0x115ac8(0x1f0),_0x115ac8(0x1e8),_0x115ac8(0x23e),_0x115ac8(0x212),'brl',_0x115ac8(0x1eb),_0x115ac8(0x1f5),_0x115ac8(0x233),'cny',_0x115ac8(0x1e9),'dkk','eur','gbp',_0x115ac8(0x1fe),_0x115ac8(0x1ea),_0x115ac8(0x224),_0x115ac8(0x25c),_0x115ac8(0x234),'inr',_0x115ac8(0x223),_0x115ac8(0x262),'kwd',_0x115ac8(0x204),_0x115ac8(0x202),_0x115ac8(0x25f),_0x115ac8(0x1ef),_0x115ac8(0x21f),'nok',_0x115ac8(0x253),'php',_0x115ac8(0x219),'pln',_0x115ac8(0x20e),_0x115ac8(0x225),_0x115ac8(0x214),_0x115ac8(0x1f3),'thb','try','twd',_0x115ac8(0x20d),'vef',_0x115ac8(0x1f6),_0x115ac8(0x216),'xdr',_0x115ac8(0x245),_0x115ac8(0x22f),_0x115ac8(0x217),_0x115ac8(0x243)],this[_0x115ac8(0x1f1)]=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x115ac8(0x237)]();}[a39_0x2ff8e0(0x237)](){const _0xfe7f16=a39_0x2ff8e0;this[_0xfe7f16(0x248)]()[_0xfe7f16(0x21b)](_0x26ab99=>{const _0x4955c9=_0xfe7f16;console['error'](_0x4955c9(0x20c),_0x26ab99);}),this['updateInterval']=setInterval(async()=>{const _0x251026=_0xfe7f16;try{await this[_0x251026(0x248)]();}catch(_0x223233){console['error'](_0x251026(0x24b),_0x223233);}},0x3c*0x3c*0x3e8),console[_0xfe7f16(0x1fa)](_0xfe7f16(0x236));}[a39_0x2ff8e0(0x21e)](){const _0x209d2b=a39_0x2ff8e0;this[_0x209d2b(0x1f1)]&&(clearInterval(this[_0x209d2b(0x1f1)]),this[_0x209d2b(0x1f1)]=null,console[_0x209d2b(0x1fa)](_0x209d2b(0x23f)));}async[a39_0x2ff8e0(0x248)](){const _0x38bc34=a39_0x2ff8e0;try{console[_0x38bc34(0x1fa)](_0x38bc34(0x227));const _0x5bad14=this[_0x38bc34(0x24c)][_0x38bc34(0x241)](','),_0x36e99b=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x5bad14,_0x42788a=await fetch(_0x36e99b,{'headers':{'Accept':_0x38bc34(0x261),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x42788a['ok'])throw new Error(_0x38bc34(0x1fc)+_0x42788a['status']+'\x20'+_0x42788a[_0x38bc34(0x21c)]);const _0xf42fb=await _0x42788a[_0x38bc34(0x205)]();if(!_0xf42fb[_0x38bc34(0x22e)])throw new Error(_0x38bc34(0x21a));const _0x22c05a=_0xf42fb['tether'];console['log'](_0x38bc34(0x1f9)+Object[_0x38bc34(0x250)](_0x22c05a)[_0x38bc34(0x231)]+_0x38bc34(0x25e));const _0x377a06=Object[_0x38bc34(0x203)](_0x22c05a)[_0x38bc34(0x22c)](async([_0x3ce0e9,_0x145bc8])=>{const _0x57525=_0x38bc34;try{await database_1['default'][_0x57525(0x258)][_0x57525(0x1f7)]({'where':{'currency':_0x3ce0e9[_0x57525(0x207)]()},'update':{'rate':_0x145bc8},'create':{'currency':_0x3ce0e9[_0x57525(0x207)](),'rate':_0x145bc8}});}catch(_0x3f4cfc){console['error'](_0x57525(0x1fb)+_0x3ce0e9+':',_0x3f4cfc);}});await Promise['allSettled'](_0x377a06),console[_0x38bc34(0x1fa)](_0x38bc34(0x20f));}catch(_0x2dcaff){console['error'](_0x38bc34(0x1ec),_0x2dcaff);throw _0x2dcaff;}}async[a39_0x2ff8e0(0x23b)](_0x2107bb){const _0x199e3e=a39_0x2ff8e0,_0x4c1003=_0x2107bb[_0x199e3e(0x207)]();if(_0x4c1003==='usdt')return 0x1;try{const _0xd51162=await database_1['default'][_0x199e3e(0x258)][_0x199e3e(0x206)]({'where':{'currency':_0x4c1003}});if(!_0xd51162)return console[_0x199e3e(0x21d)](_0x199e3e(0x242)+_0x2107bb+_0x199e3e(0x228)),0x1;return _0xd51162[_0x199e3e(0x201)];}catch(_0x1ab33d){return console[_0x199e3e(0x263)](_0x199e3e(0x22d)+_0x2107bb+':',_0x1ab33d),0x1;}}async[a39_0x2ff8e0(0x24d)](_0x2d381a,_0x2538c8){const _0x392f57=a39_0x2ff8e0,_0x204ea4=_0x2538c8['toLowerCase']();if(_0x204ea4===_0x392f57(0x260)){const _0x26ee45=_0x2d381a*(0x1+this[_0x392f57(0x232)]/0x64);return console[_0x392f57(0x1fa)](_0x392f57(0x255)+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0x2d381a+'\x20USDT\x20=\x20'+_0x26ee45['toFixed'](0x6)+'\x20USDT'),_0x26ee45;}try{const _0x20e82d=await this[_0x392f57(0x23b)](_0x204ea4),_0x50fd81=_0x2d381a/_0x20e82d,_0x2f76bf=_0x50fd81*(0x1+this[_0x392f57(0x232)]/0x64);return console[_0x392f57(0x1fa)](_0x392f57(0x210)+_0x2d381a+'\x20'+_0x2538c8[_0x392f57(0x24f)]()+_0x392f57(0x23c)+_0x50fd81[_0x392f57(0x257)](0x6)+_0x392f57(0x265)+this[_0x392f57(0x232)]+'%\x20markup\x20=\x20'+_0x2f76bf['toFixed'](0x6)+_0x392f57(0x213)+_0x20e82d+')'),_0x2f76bf;}catch(_0x5172cb){console[_0x392f57(0x263)](_0x392f57(0x25b)+_0x2d381a+'\x20'+_0x2538c8+_0x392f57(0x1ee),_0x5172cb);const _0xe4fc1=_0x2d381a*(0x1+this[_0x392f57(0x232)]/0x64);return _0xe4fc1;}}async[a39_0x2ff8e0(0x23a)](_0xfe97da){const _0x985729=a39_0x2ff8e0;let _0x470615=0x0;for(const {amount:_0x18a6f1,currency:_0x35d6af}of _0xfe97da){const _0x4520b1=await this[_0x985729(0x24d)](_0x18a6f1,_0x35d6af);_0x470615+=_0x4520b1;}return _0x470615;}async['getAllRates'](){const _0x5caed0=a39_0x2ff8e0;try{const _0x468f1a=await database_1['default'][_0x5caed0(0x258)][_0x5caed0(0x211)]({'select':{'currency':!![],'rate':!![]}}),_0x13da46={'usdt':0x1};return _0x468f1a[_0x5caed0(0x235)](_0x5cfc37=>{const _0x13e09b=_0x5caed0;_0x13da46[_0x5cfc37[_0x13e09b(0x220)]]=_0x5cfc37[_0x13e09b(0x201)];}),_0x13da46;}catch(_0x2b6640){return console[_0x5caed0(0x263)](_0x5caed0(0x229),_0x2b6640),{'usdt':0x1};}}async[a39_0x2ff8e0(0x1fd)](){const _0x551ceb=a39_0x2ff8e0;try{const [_0x40cb3f,_0x11877b,_0x12e028]=await Promise['all']([database_1[_0x551ceb(0x254)][_0x551ceb(0x258)][_0x551ceb(0x215)](),database_1[_0x551ceb(0x254)]['currencyRate'][_0x551ceb(0x23d)]({'orderBy':{'updatedAt':_0x551ceb(0x240)},'select':{'updatedAt':!![]}}),database_1[_0x551ceb(0x254)][_0x551ceb(0x258)][_0x551ceb(0x23d)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x40cb3f,'lastUpdated':_0x11877b?.['updatedAt']||null,'oldestRate':_0x12e028?.[_0x551ceb(0x218)]||null,'markupPercentage':this[_0x551ceb(0x232)]};}catch(_0x362815){return console[_0x551ceb(0x263)]('Error\x20getting\x20rates\x20status:',_0x362815),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x551ceb(0x232)]};}}['getMarkupPercentage'](){const _0x4a0dcd=a39_0x2ff8e0;return this[_0x4a0dcd(0x232)];}}exports['CurrencyService']=CurrencyService,exports['currencyService']=new CurrencyService();