'use strict';const a36_0x1afdc0=a36_0x1bb1;(function(_0x5cd280,_0x31c589){const _0x460d3b=a36_0x1bb1,_0x2991f7=_0x5cd280();while(!![]){try{const _0x3dcda4=parseInt(_0x460d3b(0xf0))/0x1+-parseInt(_0x460d3b(0x107))/0x2*(parseInt(_0x460d3b(0xbe))/0x3)+parseInt(_0x460d3b(0xc9))/0x4*(parseInt(_0x460d3b(0xac))/0x5)+-parseInt(_0x460d3b(0xf8))/0x6*(parseInt(_0x460d3b(0x10c))/0x7)+-parseInt(_0x460d3b(0xc3))/0x8*(-parseInt(_0x460d3b(0xd4))/0x9)+-parseInt(_0x460d3b(0x100))/0xa+-parseInt(_0x460d3b(0x10a))/0xb;if(_0x3dcda4===_0x31c589)break;else _0x2991f7['push'](_0x2991f7['shift']());}catch(_0x1cbdd0){_0x2991f7['push'](_0x2991f7['shift']());}}}(a36_0x56f8,0xc9417));var __importDefault=this&&this[a36_0x1afdc0(0xd1)]||function(_0x391247){return _0x391247&&_0x391247['__esModule']?_0x391247:{'default':_0x391247};};function a36_0x56f8(){const _0x372839=['5riStuq','ðŸ“Š\x20Received\x20rates\x20for\x20','startPeriodicUpdates','Error\x20getting\x20rate\x20for\x20currency\x20','CoinGecko\x20API\x20error:\x20','defineProperty','âœ…\x20Currency\x20rates\x20updated\x20successfully','%\x20markup\x20=\x20','status','currencyRate','keys','toFixed','getMarkupPercentage','jpy','ils','count','Periodic\x20currency\x20rates\x20update\x20failed:','MARKUP_PERCENTAGE','29406aXUtCs','updateCurrencyRates','currency','sgd','ars','4355776EqOqaF',',\x20using\x201\x20as\x20fallback','xdr','desc','map','krw','6435932ptBckN','convertToUSDT','rate','cny','allSettled','error','updatedAt','TesSoft\x20Payment\x20System/1.0','__importDefault','Error\x20getting\x20all\x20rates:','bits','9slyEMC','idr','inr','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','currencyService','xau','xlm','entries','https://api.coingecko.com/api/v3/simple/price','vef','yfi','vnd','application/json','pln','getAllRates','usdt','findFirst','brl','convertMultipleToUSDT','thb','gbp','log','ltc','try','uah','php','findUnique','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','688999GOeGbh','aud','ðŸ’±\x20Applied\x20','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','%\x20markup\x20to\x20','default','\x20USDT\x20=\x20','Error\x20converting\x20','200058ttEzdI','__esModule','dot','chf','\x20to\x20USDT:','bmd','gel','?ids=tether&vs_currencies=','5093080QzWUaP','clp','CurrencyService','statusText','\x20USDT,\x20with\x20','stopPeriodicUpdates','usd','226OLFBUf','toUpperCase','myr','745217agqBUB','\x20USDT','70lwjtCb','Error\x20getting\x20rates\x20status:','\x20to\x20','nok','dkk','toLowerCase','updateInterval','eth','bdt','tether','COINGECKO_URL','huf','ngn','\x20currencies','czk','Initial\x20currency\x20rates\x20update\x20failed:','pkr','all','rub','mmk','sar','bhd','join','No\x20rate\x20found\x20for\x20currency:\x20','sats','forEach','CURRENCIES'];a36_0x56f8=function(){return _0x372839;};return a36_0x56f8();}function a36_0x1bb1(_0x4b5abf,_0xd47306){const _0x56f801=a36_0x56f8();return a36_0x1bb1=function(_0x1bb16c,_0x4389d4){_0x1bb16c=_0x1bb16c-0x95;let _0x513df3=_0x56f801[_0x1bb16c];return _0x513df3;},a36_0x1bb1(_0x4b5abf,_0xd47306);}Object[a36_0x1afdc0(0xb1)](exports,a36_0x1afdc0(0xf9),{'value':!![]}),exports[a36_0x1afdc0(0xd8)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require('../config/database'));class CurrencyService{constructor(){const _0x297144=a36_0x1afdc0;this['COINGECKO_URL']=_0x297144(0xdc),this['CURRENCIES']=['btc',_0x297144(0x98),_0x297144(0xea),'bch','bnb','eos','xrp',_0x297144(0xda),'link',_0x297144(0xfa),_0x297144(0xde),_0x297144(0x106),'aed',_0x297144(0xc2),_0x297144(0xf1),_0x297144(0x99),_0x297144(0xa6),_0x297144(0xfd),_0x297144(0xe5),'cad',_0x297144(0xfb),_0x297144(0x101),_0x297144(0xcc),_0x297144(0x9f),_0x297144(0x95),'eur',_0x297144(0xe8),_0x297144(0xfe),'hkd',_0x297144(0x9c),_0x297144(0xd5),_0x297144(0xba),_0x297144(0xd6),_0x297144(0xb9),_0x297144(0xc8),'kwd','lkr',_0x297144(0xa4),'mxn',_0x297144(0x109),_0x297144(0x9d),_0x297144(0x10f),'nzd',_0x297144(0xed),_0x297144(0xa1),_0x297144(0xe1),_0x297144(0xa3),_0x297144(0xa5),'sek',_0x297144(0xc1),_0x297144(0xe7),_0x297144(0xeb),'twd',_0x297144(0xec),_0x297144(0xdd),_0x297144(0xdf),'zar',_0x297144(0xc5),'xag',_0x297144(0xd9),_0x297144(0xd3),_0x297144(0xa9)],this['updateInterval']=null,this[_0x297144(0xbd)]=0x3,this[_0x297144(0xae)]();}['startPeriodicUpdates'](){const _0x2b917a=a36_0x1afdc0;this[_0x2b917a(0xbf)]()['catch'](_0x45b894=>{const _0x2c9b6f=_0x2b917a;console[_0x2c9b6f(0xce)](_0x2c9b6f(0xa0),_0x45b894);}),this[_0x2b917a(0x97)]=setInterval(async()=>{const _0x53d80c=_0x2b917a;try{await this[_0x53d80c(0xbf)]();}catch(_0x33eef3){console[_0x53d80c(0xce)](_0x53d80c(0xbc),_0x33eef3);}},0x3c*0x3c*0x3e8),console[_0x2b917a(0xe9)]('âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a36_0x1afdc0(0x105)](){const _0x5f271d=a36_0x1afdc0;this['updateInterval']&&(clearInterval(this[_0x5f271d(0x97)]),this[_0x5f271d(0x97)]=null,console[_0x5f271d(0xe9)]('ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a36_0x1afdc0(0xbf)](){const _0x5c5550=a36_0x1afdc0;try{console[_0x5c5550(0xe9)](_0x5c5550(0xef));const _0xce9d3e=this[_0x5c5550(0xab)][_0x5c5550(0xa7)](','),_0x396b14=this[_0x5c5550(0x9b)]+_0x5c5550(0xff)+_0xce9d3e,_0x5253c5=await fetch(_0x396b14,{'headers':{'Accept':_0x5c5550(0xe0),'User-Agent':_0x5c5550(0xd0)}});if(!_0x5253c5['ok'])throw new Error(_0x5c5550(0xb0)+_0x5253c5[_0x5c5550(0xb4)]+'\x20'+_0x5253c5[_0x5c5550(0x103)]);const _0x30f8ca=await _0x5253c5['json']();if(!_0x30f8ca[_0x5c5550(0x9a)])throw new Error(_0x5c5550(0xd7));const _0x26a0bf=_0x30f8ca[_0x5c5550(0x9a)];console[_0x5c5550(0xe9)](_0x5c5550(0xad)+Object[_0x5c5550(0xb6)](_0x26a0bf)['length']+_0x5c5550(0x9e));const _0x2daa03=Object[_0x5c5550(0xdb)](_0x26a0bf)[_0x5c5550(0xc7)](async([_0x5d515f,_0x50b788])=>{const _0x265e87=_0x5c5550;try{await database_1[_0x265e87(0xf5)][_0x265e87(0xb5)]['upsert']({'where':{'currency':_0x5d515f[_0x265e87(0x96)]()},'update':{'rate':_0x50b788},'create':{'currency':_0x5d515f[_0x265e87(0x96)](),'rate':_0x50b788}});}catch(_0x25800c){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x5d515f+':',_0x25800c);}});await Promise[_0x5c5550(0xcd)](_0x2daa03),console[_0x5c5550(0xe9)](_0x5c5550(0xb2));}catch(_0x1d2d98){console[_0x5c5550(0xce)](_0x5c5550(0xf3),_0x1d2d98);throw _0x1d2d98;}}async['getCurrencyRate'](_0x33f204){const _0x528f3f=a36_0x1afdc0,_0x2cbc89=_0x33f204[_0x528f3f(0x96)]();if(_0x2cbc89===_0x528f3f(0xe3))return 0x1;try{const _0x1c6439=await database_1[_0x528f3f(0xf5)][_0x528f3f(0xb5)][_0x528f3f(0xee)]({'where':{'currency':_0x2cbc89}});if(!_0x1c6439)return console['warn'](_0x528f3f(0xa8)+_0x33f204+_0x528f3f(0xc4)),0x1;return _0x1c6439['rate'];}catch(_0x5a8803){return console[_0x528f3f(0xce)](_0x528f3f(0xaf)+_0x33f204+':',_0x5a8803),0x1;}}async[a36_0x1afdc0(0xca)](_0x437578,_0x5090ce){const _0x538e2f=a36_0x1afdc0,_0x272bed=_0x5090ce[_0x538e2f(0x96)]();if(_0x272bed===_0x538e2f(0xe3)){const _0x2034bf=_0x437578*(0x1+this[_0x538e2f(0xbd)]/0x64);return console[_0x538e2f(0xe9)](_0x538e2f(0xf2)+this['MARKUP_PERCENTAGE']+_0x538e2f(0xf4)+_0x437578+_0x538e2f(0xf6)+_0x2034bf[_0x538e2f(0xb7)](0x6)+_0x538e2f(0x10b)),_0x2034bf;}try{const _0x161858=await this['getCurrencyRate'](_0x272bed),_0x516707=_0x437578/_0x161858,_0xc95aea=_0x516707*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x538e2f(0xe9)]('ðŸ’±\x20Converted\x20'+_0x437578+'\x20'+_0x5090ce[_0x538e2f(0x108)]()+_0x538e2f(0x10e)+_0x516707[_0x538e2f(0xb7)](0x6)+_0x538e2f(0x104)+this[_0x538e2f(0xbd)]+_0x538e2f(0xb3)+_0xc95aea[_0x538e2f(0xb7)](0x6)+'\x20USDT\x20(rate:\x20'+_0x161858+')'),_0xc95aea;}catch(_0x33275a){console[_0x538e2f(0xce)](_0x538e2f(0xf7)+_0x437578+'\x20'+_0x5090ce+_0x538e2f(0xfc),_0x33275a);const _0x3c7891=_0x437578*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3c7891;}}async[a36_0x1afdc0(0xe6)](_0x31eceb){const _0x551ae4=a36_0x1afdc0;let _0x4e6413=0x0;for(const {amount:_0x366c17,currency:_0x45392d}of _0x31eceb){const _0x1de13f=await this[_0x551ae4(0xca)](_0x366c17,_0x45392d);_0x4e6413+=_0x1de13f;}return _0x4e6413;}async[a36_0x1afdc0(0xe2)](){const _0x2b776b=a36_0x1afdc0;try{const _0x36a666=await database_1[_0x2b776b(0xf5)][_0x2b776b(0xb5)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x35404b={'usdt':0x1};return _0x36a666[_0x2b776b(0xaa)](_0x59bbca=>{const _0x53736f=_0x2b776b;_0x35404b[_0x59bbca[_0x53736f(0xc0)]]=_0x59bbca[_0x53736f(0xcb)];}),_0x35404b;}catch(_0x454be4){return console['error'](_0x2b776b(0xd2),_0x454be4),{'usdt':0x1};}}async['getRatesStatus'](){const _0x570991=a36_0x1afdc0;try{const [_0x186586,_0x30241e,_0x57debc]=await Promise[_0x570991(0xa2)]([database_1[_0x570991(0xf5)][_0x570991(0xb5)][_0x570991(0xbb)](),database_1['default'][_0x570991(0xb5)][_0x570991(0xe4)]({'orderBy':{'updatedAt':_0x570991(0xc6)},'select':{'updatedAt':!![]}}),database_1['default'][_0x570991(0xb5)][_0x570991(0xe4)]({'orderBy':{'updatedAt':'asc'},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x186586,'lastUpdated':_0x30241e?.[_0x570991(0xcf)]||null,'oldestRate':_0x57debc?.[_0x570991(0xcf)]||null,'markupPercentage':this[_0x570991(0xbd)]};}catch(_0xf4c958){return console[_0x570991(0xce)](_0x570991(0x10d),_0xf4c958),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a36_0x1afdc0(0xb8)](){return this['MARKUP_PERCENTAGE'];}}exports[a36_0x1afdc0(0x102)]=CurrencyService,exports['currencyService']=new CurrencyService();