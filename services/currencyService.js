'use strict';const a36_0x11c9ce=a36_0x275e;(function(_0x1a708a,_0x39c880){const _0x48dbd7=a36_0x275e,_0x2d7d22=_0x1a708a();while(!![]){try{const _0x509e96=-parseInt(_0x48dbd7(0x18c))/0x1+-parseInt(_0x48dbd7(0x176))/0x2*(parseInt(_0x48dbd7(0x198))/0x3)+-parseInt(_0x48dbd7(0x18d))/0x4+parseInt(_0x48dbd7(0x19a))/0x5+-parseInt(_0x48dbd7(0x1ad))/0x6*(parseInt(_0x48dbd7(0x15f))/0x7)+-parseInt(_0x48dbd7(0x19f))/0x8+parseInt(_0x48dbd7(0x156))/0x9;if(_0x509e96===_0x39c880)break;else _0x2d7d22['push'](_0x2d7d22['shift']());}catch(_0x532acc){_0x2d7d22['push'](_0x2d7d22['shift']());}}}(a36_0x5188,0x50218));function a36_0x275e(_0x2af837,_0x68b5cb){const _0x5188d8=a36_0x5188();return a36_0x275e=function(_0x275ef2,_0x338635){_0x275ef2=_0x275ef2-0x151;let _0x4b8af6=_0x5188d8[_0x275ef2];return _0x4b8af6;},a36_0x275e(_0x2af837,_0x68b5cb);}var __importDefault=this&&this[a36_0x11c9ce(0x1b6)]||function(_0x2e8b97){const _0x1080df=a36_0x11c9ce;return _0x2e8b97&&_0x2e8b97[_0x1080df(0x154)]?_0x2e8b97:{'default':_0x2e8b97};};Object[a36_0x11c9ce(0x1ab)](exports,'__esModule',{'value':!![]}),exports[a36_0x11c9ce(0x1b2)]=exports[a36_0x11c9ce(0x1b0)]=void 0x0;const database_1=__importDefault(require(a36_0x11c9ce(0x175)));class CurrencyService{constructor(){const _0x4d73e6=a36_0x11c9ce;this[_0x4d73e6(0x1c8)]=_0x4d73e6(0x180),this[_0x4d73e6(0x19c)]=['btc',_0x4d73e6(0x170),'ltc',_0x4d73e6(0x186),_0x4d73e6(0x16b),'eos','xrp',_0x4d73e6(0x192),_0x4d73e6(0x1bf),_0x4d73e6(0x1ba),_0x4d73e6(0x15c),_0x4d73e6(0x1ae),_0x4d73e6(0x171),_0x4d73e6(0x16c),_0x4d73e6(0x199),_0x4d73e6(0x174),_0x4d73e6(0x1b4),_0x4d73e6(0x183),'brl',_0x4d73e6(0x181),_0x4d73e6(0x167),'clp','cny',_0x4d73e6(0x184),_0x4d73e6(0x1b7),_0x4d73e6(0x1c6),_0x4d73e6(0x1aa),'gel',_0x4d73e6(0x187),_0x4d73e6(0x163),'idr',_0x4d73e6(0x18e),_0x4d73e6(0x16f),_0x4d73e6(0x1c7),'krw',_0x4d73e6(0x19e),'lkr','mmk',_0x4d73e6(0x172),'myr','ngn',_0x4d73e6(0x16e),_0x4d73e6(0x1bd),_0x4d73e6(0x1bc),_0x4d73e6(0x1c2),'pln',_0x4d73e6(0x185),_0x4d73e6(0x1c4),'sek','sgd',_0x4d73e6(0x168),'try',_0x4d73e6(0x164),_0x4d73e6(0x1c5),_0x4d73e6(0x160),'vnd',_0x4d73e6(0x195),_0x4d73e6(0x15d),_0x4d73e6(0x157),_0x4d73e6(0x15e),_0x4d73e6(0x1bb),'sats'],this[_0x4d73e6(0x1c1)]=null,this[_0x4d73e6(0x153)]=0x3,this[_0x4d73e6(0x1b9)]();}[a36_0x11c9ce(0x1b9)](){const _0x23d037=a36_0x11c9ce;this[_0x23d037(0x1c9)]()['catch'](_0x5783e4=>{const _0x2daa54=_0x23d037;console[_0x2daa54(0x196)]('Initial\x20currency\x20rates\x20update\x20failed:',_0x5783e4);}),this[_0x23d037(0x1c1)]=setInterval(async()=>{const _0x5d81d4=_0x23d037;try{await this[_0x5d81d4(0x1c9)]();}catch(_0x207bfb){console[_0x5d81d4(0x196)](_0x5d81d4(0x178),_0x207bfb);}},0x3c*0x3c*0x3e8),console['log'](_0x23d037(0x1a6));}[a36_0x11c9ce(0x190)](){const _0x2ba920=a36_0x11c9ce;this['updateInterval']&&(clearInterval(this[_0x2ba920(0x1c1)]),this[_0x2ba920(0x1c1)]=null,console[_0x2ba920(0x1a5)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a36_0x11c9ce(0x1c9)](){const _0x302b11=a36_0x11c9ce;try{console[_0x302b11(0x1a5)](_0x302b11(0x15b));const _0x32c0bb=this[_0x302b11(0x19c)][_0x302b11(0x17e)](','),_0x34b438=this[_0x302b11(0x1c8)]+_0x302b11(0x17a)+_0x32c0bb,_0x25799c=await fetch(_0x34b438,{'headers':{'Accept':_0x302b11(0x1c3),'User-Agent':_0x302b11(0x19b)}});if(!_0x25799c['ok'])throw new Error(_0x302b11(0x19d)+_0x25799c[_0x302b11(0x165)]+'\x20'+_0x25799c[_0x302b11(0x1b5)]);const _0x17a068=await _0x25799c[_0x302b11(0x1be)]();if(!_0x17a068['tether'])throw new Error(_0x302b11(0x18f));const _0x3184f9=_0x17a068[_0x302b11(0x1b3)];console[_0x302b11(0x1a5)](_0x302b11(0x191)+Object['keys'](_0x3184f9)[_0x302b11(0x15a)]+'\x20currencies');const _0x533292=Object[_0x302b11(0x1ca)](_0x3184f9)[_0x302b11(0x1a9)](async([_0x19dd9f,_0x2634d1])=>{const _0x1bb07d=_0x302b11;try{await database_1[_0x1bb07d(0x16a)][_0x1bb07d(0x1a4)][_0x1bb07d(0x162)]({'where':{'currency':_0x19dd9f[_0x1bb07d(0x152)]()},'update':{'rate':_0x2634d1},'create':{'currency':_0x19dd9f['toLowerCase'](),'rate':_0x2634d1}});}catch(_0x4d8c41){console['error'](_0x1bb07d(0x169)+_0x19dd9f+':',_0x4d8c41);}});await Promise[_0x302b11(0x17b)](_0x533292),console['log'](_0x302b11(0x16d));}catch(_0x423f91){console['error'](_0x302b11(0x17c),_0x423f91);throw _0x423f91;}}async[a36_0x11c9ce(0x177)](_0x14ffba){const _0x540d45=a36_0x11c9ce,_0x2c9be8=_0x14ffba[_0x540d45(0x152)]();if(_0x2c9be8===_0x540d45(0x1c0))return 0x1;try{const _0x9498c0=await database_1[_0x540d45(0x16a)][_0x540d45(0x1a4)][_0x540d45(0x1af)]({'where':{'currency':_0x2c9be8}});if(!_0x9498c0)return console[_0x540d45(0x17d)]('No\x20rate\x20found\x20for\x20currency:\x20'+_0x14ffba+_0x540d45(0x166)),0x1;return _0x9498c0['rate'];}catch(_0xeaa4d1){return console[_0x540d45(0x196)](_0x540d45(0x197)+_0x14ffba+':',_0xeaa4d1),0x1;}}async[a36_0x11c9ce(0x18a)](_0x4a04b2,_0x38f060){const _0x306e8d=a36_0x11c9ce,_0x1930ba=_0x38f060[_0x306e8d(0x152)]();if(_0x1930ba==='usdt'){const _0x88ab88=_0x4a04b2*(0x1+this[_0x306e8d(0x153)]/0x64);return console[_0x306e8d(0x1a5)](_0x306e8d(0x179)+this[_0x306e8d(0x153)]+_0x306e8d(0x1a0)+_0x4a04b2+_0x306e8d(0x18b)+_0x88ab88[_0x306e8d(0x193)](0x6)+_0x306e8d(0x189)),_0x88ab88;}try{const _0x4aceff=await this[_0x306e8d(0x177)](_0x1930ba),_0x15b3cb=_0x4a04b2/_0x4aceff,_0x3cb913=_0x15b3cb*(0x1+this[_0x306e8d(0x153)]/0x64);return console[_0x306e8d(0x1a5)](_0x306e8d(0x173)+_0x4a04b2+'\x20'+_0x38f060[_0x306e8d(0x161)]()+_0x306e8d(0x188)+_0x15b3cb['toFixed'](0x6)+_0x306e8d(0x1cb)+this[_0x306e8d(0x153)]+_0x306e8d(0x1b8)+_0x3cb913['toFixed'](0x6)+_0x306e8d(0x1a7)+_0x4aceff+')'),_0x3cb913;}catch(_0x2e6b8c){console['error'](_0x306e8d(0x1ac)+_0x4a04b2+'\x20'+_0x38f060+_0x306e8d(0x1a1),_0x2e6b8c);const _0x26d0d5=_0x4a04b2*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x26d0d5;}}async[a36_0x11c9ce(0x1a3)](_0x55f8ea){const _0x3c97b9=a36_0x11c9ce;let _0x528345=0x0;for(const {amount:_0x52bc82,currency:_0x424a17}of _0x55f8ea){const _0x49f9de=await this[_0x3c97b9(0x18a)](_0x52bc82,_0x424a17);_0x528345+=_0x49f9de;}return _0x528345;}async['getAllRates'](){const _0x446ee3=a36_0x11c9ce;try{const _0x30c6db=await database_1[_0x446ee3(0x16a)][_0x446ee3(0x1a4)][_0x446ee3(0x158)]({'select':{'currency':!![],'rate':!![]}}),_0x36cdba={'usdt':0x1};return _0x30c6db['forEach'](_0x178fd0=>{const _0x4bb234=_0x446ee3;_0x36cdba[_0x178fd0[_0x4bb234(0x1a2)]]=_0x178fd0[_0x4bb234(0x182)];}),_0x36cdba;}catch(_0x279ad2){return console[_0x446ee3(0x196)]('Error\x20getting\x20all\x20rates:',_0x279ad2),{'usdt':0x1};}}async['getRatesStatus'](){const _0x47c6b=a36_0x11c9ce;try{const [_0x2aab4e,_0x3fadf9,_0x2ba5da]=await Promise[_0x47c6b(0x1b1)]([database_1[_0x47c6b(0x16a)][_0x47c6b(0x1a4)][_0x47c6b(0x17f)](),database_1[_0x47c6b(0x16a)][_0x47c6b(0x1a4)]['findFirst']({'orderBy':{'updatedAt':_0x47c6b(0x1a8)},'select':{'updatedAt':!![]}}),database_1[_0x47c6b(0x16a)][_0x47c6b(0x1a4)][_0x47c6b(0x151)]({'orderBy':{'updatedAt':_0x47c6b(0x194)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2aab4e,'lastUpdated':_0x3fadf9?.[_0x47c6b(0x159)]||null,'oldestRate':_0x2ba5da?.[_0x47c6b(0x159)]||null,'markupPercentage':this[_0x47c6b(0x153)]};}catch(_0x307607){return console[_0x47c6b(0x196)]('Error\x20getting\x20rates\x20status:',_0x307607),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x47c6b(0x153)]};}}[a36_0x11c9ce(0x155)](){const _0x20cb69=a36_0x11c9ce;return this[_0x20cb69(0x153)];}}exports[a36_0x11c9ce(0x1b0)]=CurrencyService,exports[a36_0x11c9ce(0x1b2)]=new CurrencyService();function a36_0x5188(){const _0x45c479=['findFirst','toLowerCase','MARKUP_PERCENTAGE','__esModule','getMarkupPercentage','13073157jBMzOE','xag','findMany','updatedAt','length','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','yfi','xdr','xau','175LDelcO','vef','toUpperCase','upsert','huf','twd','status',',\x20using\x201\x20as\x20fallback','chf','thb','Failed\x20to\x20update\x20rate\x20for\x20','default','bnb','ars','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','nok','inr','eth','aed','mxn','üí±\x20Converted\x20','bdt','../config/database','68454tfTmtO','getCurrencyRate','Periodic\x20currency\x20rates\x20update\x20failed:','üí±\x20Applied\x20','?ids=tether&vs_currencies=','allSettled','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','warn','join','count','https://api.coingecko.com/api/v3/simple/price','cad','rate','bmd','czk','rub','bch','hkd','\x20to\x20','\x20USDT','convertToUSDT','\x20USDT\x20=\x20','21062JdtLfi','2245576RzuhiL','ils','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','stopPeriodicUpdates','üìä\x20Received\x20rates\x20for\x20','xlm','toFixed','asc','zar','error','Error\x20getting\x20rate\x20for\x20currency\x20','27MeKAEj','aud','414875YkTTvY','TesSoft\x20Payment\x20System/1.0','CURRENCIES','CoinGecko\x20API\x20error:\x20','kwd','2344664NOpvUw','%\x20markup\x20to\x20','\x20to\x20USDT:','currency','convertMultipleToUSDT','currencyRate','log','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20USDT\x20(rate:\x20','desc','map','gbp','defineProperty','Error\x20converting\x20','5700CxyYBK','usd','findUnique','CurrencyService','all','currencyService','tether','bhd','statusText','__importDefault','dkk','%\x20markup\x20=\x20','startPeriodicUpdates','dot','bits','php','nzd','json','link','usdt','updateInterval','pkr','application/json','sar','uah','eur','jpy','COINGECKO_URL','updateCurrencyRates','entries','\x20USDT,\x20with\x20'];a36_0x5188=function(){return _0x45c479;};return a36_0x5188();}