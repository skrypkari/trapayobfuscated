'use strict';const a41_0x1156c2=a41_0x641d;(function(_0x386ece,_0x442047){const _0x18ca88=a41_0x641d,_0xc3356=_0x386ece();while(!![]){try{const _0x234ae6=-parseInt(_0x18ca88(0x188))/0x1*(-parseInt(_0x18ca88(0x1f5))/0x2)+parseInt(_0x18ca88(0x198))/0x3*(parseInt(_0x18ca88(0x19d))/0x4)+parseInt(_0x18ca88(0x1e4))/0x5+-parseInt(_0x18ca88(0x1d6))/0x6*(parseInt(_0x18ca88(0x1de))/0x7)+parseInt(_0x18ca88(0x1d2))/0x8+parseInt(_0x18ca88(0x189))/0x9+-parseInt(_0x18ca88(0x194))/0xa;if(_0x234ae6===_0x442047)break;else _0xc3356['push'](_0xc3356['shift']());}catch(_0x96feca){_0xc3356['push'](_0xc3356['shift']());}}}(a41_0x4f39,0x49d4a));function a41_0x641d(_0x55d41b,_0xae00bd){const _0x4f399a=a41_0x4f39();return a41_0x641d=function(_0x641d75,_0x1bb7a9){_0x641d75=_0x641d75-0x187;let _0x12d334=_0x4f399a[_0x641d75];return _0x12d334;},a41_0x641d(_0x55d41b,_0xae00bd);}function a41_0x4f39(){const _0x57cfec=['findFirst','💱\x20Converted\x20','__esModule','xau','upsert','application/json','bits','bdt','updateInterval','updateCurrencyRates','../config/database','join','toLowerCase','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','__importDefault','bnb','Error\x20getting\x20rates\x20status:','rub','sgd','dkk','pln','defineProperty','eth','ltc','hkd','xdr','ngn','error','chf','keys','Error\x20converting\x20','getRatesStatus','startPeriodicUpdates','allSettled','\x20currencies','❌\x20Failed\x20to\x20update\x20currency\x20rates:','ils','xrp','sats','mxn','forEach','bmd','1605776szvtCN','default','aed','pkr','154188LXsmcl','Failed\x20to\x20update\x20rate\x20for\x20','thb','getMarkupPercentage','MARKUP_PERCENTAGE','💱\x20Applied\x20','inr','btc','77qMcwpG','sek','idr','cny','%\x20markup\x20to\x20','Error\x20getting\x20all\x20rates:','42545kbLYok','php','📊\x20Received\x20rates\x20for\x20','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','\x20to\x20USDT:','desc','%\x20markup\x20=\x20','aud','sar','length','ars','usdt','status','stopPeriodicUpdates','dot','nok','\x20USDT','2LQtmLa','CURRENCIES','link','yfi','brl','xag','\x20USDT,\x20with\x20','CurrencyService','asc','No\x20rate\x20found\x20for\x20currency:\x20','myr','getAllRates','nzd','currencyRate','gel','rate','toFixed','Payment\x20System/1.0','198919HRIVGS','3045654DsdZyB','entries','czk','json','mmk','huf','map','CoinGecko\x20API\x20error:\x20','twd','toUpperCase','vnd','5622820JRuxPG','Periodic\x20currency\x20rates\x20update\x20failed:','tether','log','1202442LoEwVq','convertMultipleToUSDT','jpy','gbp','https://api.coingecko.com/api/v3/simple/price','4ZCvnhn','✅\x20Currency\x20rates\x20updated\x20successfully','xlm','kwd','getCurrencyRate','COINGECKO_URL','eur','zar','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','Error\x20getting\x20rate\x20for\x20currency\x20','currencyService'];a41_0x4f39=function(){return _0x57cfec;};return a41_0x4f39();}var __importDefault=this&&this[a41_0x1156c2(0x1b6)]||function(_0x29df8e){const _0x31155e=a41_0x1156c2;return _0x29df8e&&_0x29df8e[_0x31155e(0x1aa)]?_0x29df8e:{'default':_0x29df8e};};Object[a41_0x1156c2(0x1bd)](exports,a41_0x1156c2(0x1aa),{'value':!![]}),exports[a41_0x1156c2(0x1a7)]=exports[a41_0x1156c2(0x1fc)]=void 0x0;const database_1=__importDefault(require(a41_0x1156c2(0x1b2)));class CurrencyService{constructor(){const _0x5e43ca=a41_0x1156c2;this[_0x5e43ca(0x1a2)]=_0x5e43ca(0x19c),this[_0x5e43ca(0x1f6)]=[_0x5e43ca(0x1dd),_0x5e43ca(0x1be),_0x5e43ca(0x1bf),'bch',_0x5e43ca(0x1b7),'eos',_0x5e43ca(0x1cd),_0x5e43ca(0x19f),_0x5e43ca(0x1f7),_0x5e43ca(0x1f2),_0x5e43ca(0x1f8),'usd',_0x5e43ca(0x1d4),_0x5e43ca(0x1ee),_0x5e43ca(0x1eb),_0x5e43ca(0x1af),'bhd',_0x5e43ca(0x1d1),_0x5e43ca(0x1f9),'cad',_0x5e43ca(0x1c4),'clp',_0x5e43ca(0x1e1),_0x5e43ca(0x18b),_0x5e43ca(0x1bb),_0x5e43ca(0x1a3),_0x5e43ca(0x19b),_0x5e43ca(0x203),_0x5e43ca(0x1c0),_0x5e43ca(0x18e),_0x5e43ca(0x1e0),_0x5e43ca(0x1cc),_0x5e43ca(0x1dc),_0x5e43ca(0x19a),'krw',_0x5e43ca(0x1a0),'lkr',_0x5e43ca(0x18d),_0x5e43ca(0x1cf),_0x5e43ca(0x1ff),_0x5e43ca(0x1c2),_0x5e43ca(0x1f3),_0x5e43ca(0x201),_0x5e43ca(0x1e5),_0x5e43ca(0x1d5),_0x5e43ca(0x1bc),_0x5e43ca(0x1b9),_0x5e43ca(0x1ec),_0x5e43ca(0x1df),_0x5e43ca(0x1ba),_0x5e43ca(0x1d8),'try',_0x5e43ca(0x191),'uah','vef',_0x5e43ca(0x193),_0x5e43ca(0x1a4),_0x5e43ca(0x1c1),_0x5e43ca(0x1fa),_0x5e43ca(0x1ab),_0x5e43ca(0x1ae),_0x5e43ca(0x1ce)],this[_0x5e43ca(0x1b0)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x5e43ca(0x1c8)]();}[a41_0x1156c2(0x1c8)](){const _0x2da1f2=a41_0x1156c2;this[_0x2da1f2(0x1b1)]()['catch'](_0xedd162=>{const _0x40427d=_0x2da1f2;console[_0x40427d(0x1c3)]('Initial\x20currency\x20rates\x20update\x20failed:',_0xedd162);}),this[_0x2da1f2(0x1b0)]=setInterval(async()=>{const _0x3be66f=_0x2da1f2;try{await this['updateCurrencyRates']();}catch(_0x5a4774){console['error'](_0x3be66f(0x195),_0x5a4774);}},0x3c*0x3c*0x3e8),console['log'](_0x2da1f2(0x1e7));}[a41_0x1156c2(0x1f1)](){const _0x1a8825=a41_0x1156c2;this[_0x1a8825(0x1b0)]&&(clearInterval(this['updateInterval']),this[_0x1a8825(0x1b0)]=null,console[_0x1a8825(0x197)]('🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async['updateCurrencyRates'](){const _0x4b7230=a41_0x1156c2;try{console[_0x4b7230(0x197)](_0x4b7230(0x1a5));const _0x32c0d7=this[_0x4b7230(0x1f6)][_0x4b7230(0x1b3)](','),_0xd1550e=this[_0x4b7230(0x1a2)]+'?ids=tether&vs_currencies='+_0x32c0d7,_0x3dfdec=await fetch(_0xd1550e,{'headers':{'Accept':_0x4b7230(0x1ad),'User-Agent':_0x4b7230(0x187)}});if(!_0x3dfdec['ok'])throw new Error(_0x4b7230(0x190)+_0x3dfdec[_0x4b7230(0x1f0)]+'\x20'+_0x3dfdec['statusText']);const _0x162dee=await _0x3dfdec[_0x4b7230(0x18c)]();if(!_0x162dee['tether'])throw new Error(_0x4b7230(0x1b5));const _0x253d31=_0x162dee[_0x4b7230(0x196)];console['log'](_0x4b7230(0x1e6)+Object[_0x4b7230(0x1c5)](_0x253d31)[_0x4b7230(0x1ed)]+_0x4b7230(0x1ca));const _0x41efae=Object[_0x4b7230(0x18a)](_0x253d31)[_0x4b7230(0x18f)](async([_0x1094f7,_0x405877])=>{const _0x3f6e19=_0x4b7230;try{await database_1[_0x3f6e19(0x1d3)][_0x3f6e19(0x202)][_0x3f6e19(0x1ac)]({'where':{'currency':_0x1094f7[_0x3f6e19(0x1b4)]()},'update':{'rate':_0x405877},'create':{'currency':_0x1094f7[_0x3f6e19(0x1b4)](),'rate':_0x405877}});}catch(_0x1ce62a){console[_0x3f6e19(0x1c3)](_0x3f6e19(0x1d7)+_0x1094f7+':',_0x1ce62a);}});await Promise[_0x4b7230(0x1c9)](_0x41efae),console[_0x4b7230(0x197)](_0x4b7230(0x19e));}catch(_0x432cbd){console[_0x4b7230(0x1c3)](_0x4b7230(0x1cb),_0x432cbd);throw _0x432cbd;}}async[a41_0x1156c2(0x1a1)](_0x1c38b7){const _0x2d5909=a41_0x1156c2,_0x368740=_0x1c38b7[_0x2d5909(0x1b4)]();if(_0x368740===_0x2d5909(0x1ef))return 0x1;try{const _0x404746=await database_1['default'][_0x2d5909(0x202)]['findUnique']({'where':{'currency':_0x368740}});if(!_0x404746)return console['warn'](_0x2d5909(0x1fe)+_0x1c38b7+',\x20using\x201\x20as\x20fallback'),0x1;return _0x404746[_0x2d5909(0x204)];}catch(_0x50eec2){return console[_0x2d5909(0x1c3)](_0x2d5909(0x1a6)+_0x1c38b7+':',_0x50eec2),0x1;}}async['convertToUSDT'](_0x21c319,_0x97db1b){const _0x586a5b=a41_0x1156c2,_0x4222af=_0x97db1b[_0x586a5b(0x1b4)]();if(_0x4222af===_0x586a5b(0x1ef)){const _0x564d43=_0x21c319*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x586a5b(0x197)](_0x586a5b(0x1db)+this['MARKUP_PERCENTAGE']+_0x586a5b(0x1e2)+_0x21c319+'\x20USDT\x20=\x20'+_0x564d43[_0x586a5b(0x205)](0x6)+_0x586a5b(0x1f4)),_0x564d43;}try{const _0x55d2be=await this['getCurrencyRate'](_0x4222af),_0x140596=_0x21c319/_0x55d2be,_0x17e62=_0x140596*(0x1+this[_0x586a5b(0x1da)]/0x64);return console[_0x586a5b(0x197)](_0x586a5b(0x1a9)+_0x21c319+'\x20'+_0x97db1b[_0x586a5b(0x192)]()+'\x20to\x20'+_0x140596[_0x586a5b(0x205)](0x6)+_0x586a5b(0x1fb)+this[_0x586a5b(0x1da)]+_0x586a5b(0x1ea)+_0x17e62['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x55d2be+')'),_0x17e62;}catch(_0x16eac0){console['error'](_0x586a5b(0x1c6)+_0x21c319+'\x20'+_0x97db1b+_0x586a5b(0x1e8),_0x16eac0);const _0x2fc1a8=_0x21c319*(0x1+this[_0x586a5b(0x1da)]/0x64);return _0x2fc1a8;}}async[a41_0x1156c2(0x199)](_0x2ddc28){let _0x1adf4d=0x0;for(const {amount:_0x4c0af5,currency:_0x28e52d}of _0x2ddc28){const _0x45d971=await this['convertToUSDT'](_0x4c0af5,_0x28e52d);_0x1adf4d+=_0x45d971;}return _0x1adf4d;}async[a41_0x1156c2(0x200)](){const _0x182617=a41_0x1156c2;try{const _0x1ac6c2=await database_1['default'][_0x182617(0x202)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x1bd42b={'usdt':0x1};return _0x1ac6c2[_0x182617(0x1d0)](_0x329cea=>{const _0x5bbddd=_0x182617;_0x1bd42b[_0x329cea['currency']]=_0x329cea[_0x5bbddd(0x204)];}),_0x1bd42b;}catch(_0x5dd211){return console['error'](_0x182617(0x1e3),_0x5dd211),{'usdt':0x1};}}async[a41_0x1156c2(0x1c7)](){const _0x57b68e=a41_0x1156c2;try{const [_0x402a81,_0x2e3100,_0x45ef98]=await Promise['all']([database_1['default'][_0x57b68e(0x202)]['count'](),database_1[_0x57b68e(0x1d3)]['currencyRate'][_0x57b68e(0x1a8)]({'orderBy':{'updatedAt':_0x57b68e(0x1e9)},'select':{'updatedAt':!![]}}),database_1[_0x57b68e(0x1d3)][_0x57b68e(0x202)][_0x57b68e(0x1a8)]({'orderBy':{'updatedAt':_0x57b68e(0x1fd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x402a81,'lastUpdated':_0x2e3100?.['updatedAt']||null,'oldestRate':_0x45ef98?.['updatedAt']||null,'markupPercentage':this[_0x57b68e(0x1da)]};}catch(_0x37a68e){return console[_0x57b68e(0x1c3)](_0x57b68e(0x1b8),_0x37a68e),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x57b68e(0x1da)]};}}[a41_0x1156c2(0x1d9)](){const _0x43ffb5=a41_0x1156c2;return this[_0x43ffb5(0x1da)];}}exports['CurrencyService']=CurrencyService,exports[a41_0x1156c2(0x1a7)]=new CurrencyService();