'use strict';const a38_0x49b8b5=a38_0xfa36;(function(_0xe639e3,_0xebf3b8){const _0x33a211=a38_0xfa36,_0x57453f=_0xe639e3();while(!![]){try{const _0x5dccd2=-parseInt(_0x33a211(0x168))/0x1*(-parseInt(_0x33a211(0x1b1))/0x2)+parseInt(_0x33a211(0x1a2))/0x3+-parseInt(_0x33a211(0x166))/0x4+parseInt(_0x33a211(0x186))/0x5+-parseInt(_0x33a211(0x1a4))/0x6+-parseInt(_0x33a211(0x1ad))/0x7+-parseInt(_0x33a211(0x18e))/0x8;if(_0x5dccd2===_0xebf3b8)break;else _0x57453f['push'](_0x57453f['shift']());}catch(_0x13f59f){_0x57453f['push'](_0x57453f['shift']());}}}(a38_0x3254,0xeac45));var __importDefault=this&&this[a38_0x49b8b5(0x178)]||function(_0x362a9b){const _0xd1b744=a38_0x49b8b5;return _0x362a9b&&_0x362a9b[_0xd1b744(0x19a)]?_0x362a9b:{'default':_0x362a9b};};function a38_0xfa36(_0x55b357,_0x286600){const _0x32547a=a38_0x3254();return a38_0xfa36=function(_0xfa3621,_0x398708){_0xfa3621=_0xfa3621-0x152;let _0x50a44c=_0x32547a[_0xfa3621];return _0x50a44c;},a38_0xfa36(_0x55b357,_0x286600);}Object[a38_0x49b8b5(0x19b)](exports,a38_0x49b8b5(0x19a),{'value':!![]}),exports[a38_0x49b8b5(0x197)]=exports[a38_0x49b8b5(0x1bc)]=void 0x0;const database_1=__importDefault(require(a38_0x49b8b5(0x164)));function a38_0x3254(){const _0x24787a=['eos','54kNVHsj','log','vef','findUnique','💱\x20Applied\x20','bhd','status','pln','application/json','COINGECKO_URL','tether','CurrencyService','asc','dkk','catch','cad','eur','getMarkupPercentage','link','Error\x20getting\x20rates\x20status:','ngn','bmd','MARKUP_PERCENTAGE','xdr','try','\x20USDT\x20=\x20','❌\x20Failed\x20to\x20update\x20currency\x20rates:','ils','xrp','xlm','brl','inr','Initial\x20currency\x20rates\x20update\x20failed:','hkd','bch','sgd','toFixed','No\x20rate\x20found\x20for\x20currency:\x20','usdt','bits','keys','mxn','../config/database','gel','1394432iLsbcQ','json','69587cqPwwS','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','Error\x20converting\x20','xau','jpy','clp','Error\x20getting\x20all\x20rates:','startPeriodicUpdates','bdt','uah','sek','error','rate','?ids=tether&vs_currencies=','getAllRates','default','__importDefault','getCurrencyRate','convertToUSDT','https://api.coingecko.com/api/v3/simple/price','xag',',\x20using\x201\x20as\x20fallback','desc','statusText','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','CoinGecko\x20API\x20error:\x20','vnd','updatedAt','upsert','count','6148425ccPSGD','findFirst','allSettled','gbp','%\x20markup\x20to\x20','\x20to\x20USDT:','\x20to\x20','\x20USDT','6195016BuBEHL','toUpperCase','findMany','currencyRate','bnb','updateInterval','stopPeriodicUpdates','TesSoft\x20Payment\x20System/1.0','💱\x20Converted\x20','currencyService','join','yfi','__esModule','defineProperty','getRatesStatus','thb','updateCurrencyRates','ars','aud','sar','3701973qrETJe','currency','2809476DDGHRX','CURRENCIES','pkr','📊\x20Received\x20rates\x20for\x20','dot','zar','lkr','huf','mmk','12527823SZMwpZ','toLowerCase','length'];a38_0x3254=function(){return _0x24787a;};return a38_0x3254();}class CurrencyService{constructor(){const _0x15adcb=a38_0x49b8b5;this[_0x15adcb(0x1ba)]=_0x15adcb(0x17b),this[_0x15adcb(0x1a5)]=['btc','eth','ltc',_0x15adcb(0x15c),_0x15adcb(0x192),_0x15adcb(0x1b0),_0x15adcb(0x156),_0x15adcb(0x157),_0x15adcb(0x1c3),_0x15adcb(0x1a8),_0x15adcb(0x199),'usd','aed',_0x15adcb(0x19f),_0x15adcb(0x1a0),_0x15adcb(0x170),_0x15adcb(0x1b6),_0x15adcb(0x1c6),_0x15adcb(0x158),_0x15adcb(0x1c0),'chf',_0x15adcb(0x16d),'cny','czk',_0x15adcb(0x1be),_0x15adcb(0x1c1),_0x15adcb(0x189),_0x15adcb(0x165),_0x15adcb(0x15b),_0x15adcb(0x1ab),'idr',_0x15adcb(0x155),_0x15adcb(0x159),_0x15adcb(0x16c),'krw','kwd',_0x15adcb(0x1aa),_0x15adcb(0x1ac),_0x15adcb(0x163),'myr',_0x15adcb(0x1c5),'nok','nzd','php',_0x15adcb(0x1a6),_0x15adcb(0x1b8),'rub',_0x15adcb(0x1a1),_0x15adcb(0x172),_0x15adcb(0x15d),_0x15adcb(0x19d),_0x15adcb(0x152),'twd',_0x15adcb(0x171),_0x15adcb(0x1b3),_0x15adcb(0x182),_0x15adcb(0x1a9),_0x15adcb(0x1c8),_0x15adcb(0x17c),_0x15adcb(0x16b),_0x15adcb(0x161),'sats'],this[_0x15adcb(0x193)]=null,this[_0x15adcb(0x1c7)]=0x3,this[_0x15adcb(0x16f)]();}[a38_0x49b8b5(0x16f)](){const _0x1d3cd5=a38_0x49b8b5;this[_0x1d3cd5(0x19e)]()[_0x1d3cd5(0x1bf)](_0x33514b=>{const _0x57ae4e=_0x1d3cd5;console[_0x57ae4e(0x173)](_0x57ae4e(0x15a),_0x33514b);}),this[_0x1d3cd5(0x193)]=setInterval(async()=>{const _0x53304b=_0x1d3cd5;try{await this[_0x53304b(0x19e)]();}catch(_0x64b37a){console[_0x53304b(0x173)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x64b37a);}},0x3c*0x3c*0x3e8),console[_0x1d3cd5(0x1b2)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a38_0x49b8b5(0x194)](){const _0x3f6124=a38_0x49b8b5;this[_0x3f6124(0x193)]&&(clearInterval(this[_0x3f6124(0x193)]),this[_0x3f6124(0x193)]=null,console[_0x3f6124(0x1b2)](_0x3f6124(0x169)));}async['updateCurrencyRates'](){const _0xc4cd1a=a38_0x49b8b5;try{console['log']('🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x2812d8=this[_0xc4cd1a(0x1a5)][_0xc4cd1a(0x198)](','),_0x464c0a=this[_0xc4cd1a(0x1ba)]+_0xc4cd1a(0x175)+_0x2812d8,_0x4e046d=await fetch(_0x464c0a,{'headers':{'Accept':_0xc4cd1a(0x1b9),'User-Agent':_0xc4cd1a(0x195)}});if(!_0x4e046d['ok'])throw new Error(_0xc4cd1a(0x181)+_0x4e046d[_0xc4cd1a(0x1b7)]+'\x20'+_0x4e046d[_0xc4cd1a(0x17f)]);const _0x408320=await _0x4e046d[_0xc4cd1a(0x167)]();if(!_0x408320[_0xc4cd1a(0x1bb)])throw new Error(_0xc4cd1a(0x180));const _0x31d9e4=_0x408320['tether'];console[_0xc4cd1a(0x1b2)](_0xc4cd1a(0x1a7)+Object[_0xc4cd1a(0x162)](_0x31d9e4)[_0xc4cd1a(0x1af)]+'\x20currencies');const _0x24e73d=Object['entries'](_0x31d9e4)['map'](async([_0xd472e3,_0x8c01ce])=>{const _0x1bc234=_0xc4cd1a;try{await database_1[_0x1bc234(0x177)][_0x1bc234(0x191)][_0x1bc234(0x184)]({'where':{'currency':_0xd472e3['toLowerCase']()},'update':{'rate':_0x8c01ce},'create':{'currency':_0xd472e3['toLowerCase'](),'rate':_0x8c01ce}});}catch(_0x19622a){console[_0x1bc234(0x173)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0xd472e3+':',_0x19622a);}});await Promise[_0xc4cd1a(0x188)](_0x24e73d),console['log']('✅\x20Currency\x20rates\x20updated\x20successfully');}catch(_0x51ab2a){console[_0xc4cd1a(0x173)](_0xc4cd1a(0x154),_0x51ab2a);throw _0x51ab2a;}}async[a38_0x49b8b5(0x179)](_0x660fde){const _0x3f5a8b=a38_0x49b8b5,_0x46619c=_0x660fde[_0x3f5a8b(0x1ae)]();if(_0x46619c===_0x3f5a8b(0x160))return 0x1;try{const _0x5d9aa7=await database_1[_0x3f5a8b(0x177)][_0x3f5a8b(0x191)][_0x3f5a8b(0x1b4)]({'where':{'currency':_0x46619c}});if(!_0x5d9aa7)return console['warn'](_0x3f5a8b(0x15f)+_0x660fde+_0x3f5a8b(0x17d)),0x1;return _0x5d9aa7['rate'];}catch(_0x582294){return console[_0x3f5a8b(0x173)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x660fde+':',_0x582294),0x1;}}async[a38_0x49b8b5(0x17a)](_0x564b1e,_0x5203ab){const _0x56d861=a38_0x49b8b5,_0x4d1392=_0x5203ab[_0x56d861(0x1ae)]();if(_0x4d1392===_0x56d861(0x160)){const _0x2fbf51=_0x564b1e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x56d861(0x1b2)](_0x56d861(0x1b5)+this[_0x56d861(0x1c7)]+_0x56d861(0x18a)+_0x564b1e+_0x56d861(0x153)+_0x2fbf51[_0x56d861(0x15e)](0x6)+_0x56d861(0x18d)),_0x2fbf51;}try{const _0x2903ba=await this[_0x56d861(0x179)](_0x4d1392),_0x31716c=_0x564b1e/_0x2903ba,_0x102b95=_0x31716c*(0x1+this[_0x56d861(0x1c7)]/0x64);return console[_0x56d861(0x1b2)](_0x56d861(0x196)+_0x564b1e+'\x20'+_0x5203ab[_0x56d861(0x18f)]()+_0x56d861(0x18c)+_0x31716c['toFixed'](0x6)+'\x20USDT,\x20with\x20'+this[_0x56d861(0x1c7)]+'%\x20markup\x20=\x20'+_0x102b95['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x2903ba+')'),_0x102b95;}catch(_0x46ac97){console[_0x56d861(0x173)](_0x56d861(0x16a)+_0x564b1e+'\x20'+_0x5203ab+_0x56d861(0x18b),_0x46ac97);const _0x38fd5c=_0x564b1e*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x38fd5c;}}async['convertMultipleToUSDT'](_0x3d037f){const _0xf0d602=a38_0x49b8b5;let _0x3f5478=0x0;for(const {amount:_0x12cbc0,currency:_0x5541ea}of _0x3d037f){const _0x28731d=await this[_0xf0d602(0x17a)](_0x12cbc0,_0x5541ea);_0x3f5478+=_0x28731d;}return _0x3f5478;}async[a38_0x49b8b5(0x176)](){const _0x124f38=a38_0x49b8b5;try{const _0x256089=await database_1[_0x124f38(0x177)][_0x124f38(0x191)][_0x124f38(0x190)]({'select':{'currency':!![],'rate':!![]}}),_0x2fabaa={'usdt':0x1};return _0x256089['forEach'](_0x3413d5=>{const _0x490bef=_0x124f38;_0x2fabaa[_0x3413d5[_0x490bef(0x1a3)]]=_0x3413d5[_0x490bef(0x174)];}),_0x2fabaa;}catch(_0x203dda){return console[_0x124f38(0x173)](_0x124f38(0x16e),_0x203dda),{'usdt':0x1};}}async[a38_0x49b8b5(0x19c)](){const _0x40648a=a38_0x49b8b5;try{const [_0x259c7b,_0x13b513,_0x2d3285]=await Promise['all']([database_1[_0x40648a(0x177)]['currencyRate'][_0x40648a(0x185)](),database_1[_0x40648a(0x177)]['currencyRate'][_0x40648a(0x187)]({'orderBy':{'updatedAt':_0x40648a(0x17e)},'select':{'updatedAt':!![]}}),database_1[_0x40648a(0x177)]['currencyRate'][_0x40648a(0x187)]({'orderBy':{'updatedAt':_0x40648a(0x1bd)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x259c7b,'lastUpdated':_0x13b513?.[_0x40648a(0x183)]||null,'oldestRate':_0x2d3285?.[_0x40648a(0x183)]||null,'markupPercentage':this[_0x40648a(0x1c7)]};}catch(_0x382a93){return console['error'](_0x40648a(0x1c4),_0x382a93),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a38_0x49b8b5(0x1c2)](){const _0x37bb56=a38_0x49b8b5;return this[_0x37bb56(0x1c7)];}}exports[a38_0x49b8b5(0x1bc)]=CurrencyService,exports[a38_0x49b8b5(0x197)]=new CurrencyService();