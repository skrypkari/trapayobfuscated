'use strict';const a49_0xa2a531=a49_0x1903;(function(_0x4f58e2,_0x5487f5){const _0x4007f0=a49_0x1903,_0x42f879=_0x4f58e2();while(!![]){try{const _0x3fc3b0=-parseInt(_0x4007f0(0x16f))/0x1*(-parseInt(_0x4007f0(0x176))/0x2)+parseInt(_0x4007f0(0x147))/0x3*(parseInt(_0x4007f0(0x185))/0x4)+-parseInt(_0x4007f0(0x1a8))/0x5*(-parseInt(_0x4007f0(0x153))/0x6)+-parseInt(_0x4007f0(0x173))/0x7*(parseInt(_0x4007f0(0x18f))/0x8)+-parseInt(_0x4007f0(0x1a2))/0x9*(-parseInt(_0x4007f0(0x157))/0xa)+-parseInt(_0x4007f0(0x16c))/0xb*(parseInt(_0x4007f0(0x14d))/0xc)+parseInt(_0x4007f0(0x1a3))/0xd*(parseInt(_0x4007f0(0x1a9))/0xe);if(_0x3fc3b0===_0x5487f5)break;else _0x42f879['push'](_0x42f879['shift']());}catch(_0x43b10e){_0x42f879['push'](_0x42f879['shift']());}}}(a49_0x213c,0x9692d));var __importDefault=this&&this[a49_0xa2a531(0x152)]||function(_0x4fdec2){const _0xb4e30e=a49_0xa2a531;return _0x4fdec2&&_0x4fdec2[_0xb4e30e(0x146)]?_0x4fdec2:{'default':_0x4fdec2};};function a49_0x1903(_0x15d4cb,_0x280b11){_0x15d4cb=_0x15d4cb-0x135;const _0x213ce9=a49_0x213c();let _0x1903f0=_0x213ce9[_0x15d4cb];return _0x1903f0;}Object[a49_0xa2a531(0x160)](exports,'__esModule',{'value':!![]}),exports[a49_0xa2a531(0x155)]=exports[a49_0xa2a531(0x14a)]=void 0x0;const database_1=__importDefault(require(a49_0xa2a531(0x19c)));class CurrencyService{constructor(){const _0x21e629=a49_0xa2a531;this[_0x21e629(0x150)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=['btc',_0x21e629(0x19f),_0x21e629(0x13a),_0x21e629(0x15d),'bnb',_0x21e629(0x181),'xrp',_0x21e629(0x171),_0x21e629(0x183),'dot','yfi','usd',_0x21e629(0x19e),_0x21e629(0x154),'aud',_0x21e629(0x159),_0x21e629(0x177),_0x21e629(0x1a6),_0x21e629(0x192),_0x21e629(0x14f),_0x21e629(0x18b),_0x21e629(0x14e),'cny','czk',_0x21e629(0x165),'eur','gbp','gel',_0x21e629(0x138),_0x21e629(0x142),_0x21e629(0x143),'ils',_0x21e629(0x16b),_0x21e629(0x17a),_0x21e629(0x140),_0x21e629(0x17e),'lkr',_0x21e629(0x14c),_0x21e629(0x1a0),_0x21e629(0x15e),_0x21e629(0x151),_0x21e629(0x15c),_0x21e629(0x189),_0x21e629(0x17d),_0x21e629(0x141),'pln',_0x21e629(0x168),_0x21e629(0x191),_0x21e629(0x158),'sgd','thb','try',_0x21e629(0x187),_0x21e629(0x164),_0x21e629(0x13f),_0x21e629(0x144),_0x21e629(0x166),'xdr',_0x21e629(0x174),_0x21e629(0x13e),'bits',_0x21e629(0x180)],this[_0x21e629(0x195)]=null,this[_0x21e629(0x18c)]=-0x3,this[_0x21e629(0x1a1)]();}[a49_0xa2a531(0x1a1)](){const _0x2e9042=a49_0xa2a531;this['updateCurrencyRates']()[_0x2e9042(0x1ac)](_0x3fcaaf=>{const _0x366cbd=_0x2e9042;console[_0x366cbd(0x139)](_0x366cbd(0x17b),_0x3fcaaf);}),this[_0x2e9042(0x195)]=setInterval(async()=>{const _0x148f51=_0x2e9042;try{await this[_0x148f51(0x188)]();}catch(_0x4cfa0d){console[_0x148f51(0x139)](_0x148f51(0x148),_0x4cfa0d);}},0x3c*0x3c*0x3e8),console[_0x2e9042(0x194)]('‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}['stopPeriodicUpdates'](){const _0x597a10=a49_0xa2a531;this[_0x597a10(0x195)]&&(clearInterval(this[_0x597a10(0x195)]),this[_0x597a10(0x195)]=null,console['log'](_0x597a10(0x135)));}async[a49_0xa2a531(0x188)](){const _0x1e254c=a49_0xa2a531;try{console[_0x1e254c(0x194)](_0x1e254c(0x1a7));const _0x3670cf=this[_0x1e254c(0x182)][_0x1e254c(0x15a)](','),_0x3a47c9=this[_0x1e254c(0x150)]+'?ids=tether&vs_currencies='+_0x3670cf,_0x3bf2c1=await fetch(_0x3a47c9,{'headers':{'Accept':_0x1e254c(0x170),'User-Agent':_0x1e254c(0x156)}});if(!_0x3bf2c1['ok'])throw new Error(_0x1e254c(0x184)+_0x3bf2c1[_0x1e254c(0x15f)]+'\x20'+_0x3bf2c1[_0x1e254c(0x13d)]);const _0x5a96d9=await _0x3bf2c1[_0x1e254c(0x169)]();if(!_0x5a96d9[_0x1e254c(0x13c)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x5324bd=_0x5a96d9[_0x1e254c(0x13c)];console[_0x1e254c(0x194)](_0x1e254c(0x16e)+Object[_0x1e254c(0x149)](_0x5324bd)[_0x1e254c(0x197)]+_0x1e254c(0x1ab));const _0x538e4f=Object[_0x1e254c(0x161)](_0x5324bd)['map'](async([_0x25725,_0x15b466])=>{const _0x548667=_0x1e254c;try{await database_1[_0x548667(0x136)][_0x548667(0x163)]['upsert']({'where':{'currency':_0x25725[_0x548667(0x172)]()},'update':{'rate':_0x15b466},'create':{'currency':_0x25725['toLowerCase'](),'rate':_0x15b466}});}catch(_0x3f5893){console[_0x548667(0x139)]('Failed\x20to\x20update\x20rate\x20for\x20'+_0x25725+':',_0x3f5893);}});await Promise[_0x1e254c(0x190)](_0x538e4f),console[_0x1e254c(0x194)](_0x1e254c(0x175));}catch(_0x125782){console[_0x1e254c(0x139)](_0x1e254c(0x1ad),_0x125782);throw _0x125782;}}async[a49_0xa2a531(0x13b)](_0x5c74a9){const _0x20231e=a49_0xa2a531,_0x49812b=_0x5c74a9[_0x20231e(0x172)]();if(_0x49812b==='usdt')return 0x1;try{const _0x7f5375=await database_1['default']['currencyRate']['findUnique']({'where':{'currency':_0x49812b}});if(!_0x7f5375)return console[_0x20231e(0x17c)](_0x20231e(0x193)+_0x5c74a9+_0x20231e(0x19a)),0x1;return _0x7f5375[_0x20231e(0x196)];}catch(_0x4f97bd){return console[_0x20231e(0x139)](_0x20231e(0x179)+_0x5c74a9+':',_0x4f97bd),0x1;}}async[a49_0xa2a531(0x16d)](_0xc77e76,_0x3d856e){const _0x5efb4b=a49_0xa2a531,_0x2cd2bb=_0x3d856e[_0x5efb4b(0x172)]();if(_0x2cd2bb==='usdt'){const _0x13d7d4=_0xc77e76*(0x1+this[_0x5efb4b(0x18c)]/0x64);return console[_0x5efb4b(0x194)]('üí±\x20Applied\x20'+this['MARKUP_PERCENTAGE']+'%\x20markup\x20to\x20'+_0xc77e76+_0x5efb4b(0x145)+_0x13d7d4['toFixed'](0x6)+'\x20USDT'),_0x13d7d4;}try{const _0x5aff37=await this[_0x5efb4b(0x13b)](_0x2cd2bb),_0x481020=_0xc77e76/_0x5aff37,_0x1991e9=_0x481020*(0x1+this[_0x5efb4b(0x18c)]/0x64);return console[_0x5efb4b(0x194)]('üí±\x20Converted\x20'+_0xc77e76+'\x20'+_0x3d856e[_0x5efb4b(0x18e)]()+_0x5efb4b(0x16a)+_0x481020[_0x5efb4b(0x1a4)](0x6)+_0x5efb4b(0x1ae)+this[_0x5efb4b(0x18c)]+_0x5efb4b(0x137)+_0x1991e9[_0x5efb4b(0x1a4)](0x6)+_0x5efb4b(0x19b)+_0x5aff37+')'),_0x1991e9;}catch(_0x3e2cd6){console[_0x5efb4b(0x139)](_0x5efb4b(0x198)+_0xc77e76+'\x20'+_0x3d856e+'\x20to\x20USDT:',_0x3e2cd6);const _0x1f04d1=_0xc77e76*(0x1+this[_0x5efb4b(0x18c)]/0x64);return _0x1f04d1;}}async[a49_0xa2a531(0x1af)](_0x1d31b5){let _0x121b31=0x0;for(const {amount:_0x4dba62,currency:_0x52d730}of _0x1d31b5){const _0x12e5a5=await this['convertToUSDT'](_0x4dba62,_0x52d730);_0x121b31+=_0x12e5a5;}return _0x121b31;}async[a49_0xa2a531(0x14b)](){const _0x16ce1e=a49_0xa2a531;try{const _0x251095=await database_1['default'][_0x16ce1e(0x163)][_0x16ce1e(0x162)]({'select':{'currency':!![],'rate':!![]}}),_0x198caa={'usdt':0x1};return _0x251095[_0x16ce1e(0x18a)](_0x1166ae=>{const _0x978b84=_0x16ce1e;_0x198caa[_0x1166ae[_0x978b84(0x167)]]=_0x1166ae['rate'];}),_0x198caa;}catch(_0x530112){return console['error'](_0x16ce1e(0x199),_0x530112),{'usdt':0x1};}}async['getRatesStatus'](){const _0x58fb25=a49_0xa2a531;try{const [_0x1843be,_0x373113,_0x21c44d]=await Promise[_0x58fb25(0x178)]([database_1['default'][_0x58fb25(0x163)][_0x58fb25(0x18d)](),database_1[_0x58fb25(0x136)]['currencyRate'][_0x58fb25(0x1a5)]({'orderBy':{'updatedAt':_0x58fb25(0x186)},'select':{'updatedAt':!![]}}),database_1['default'][_0x58fb25(0x163)]['findFirst']({'orderBy':{'updatedAt':_0x58fb25(0x15b)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x1843be,'lastUpdated':_0x373113?.[_0x58fb25(0x1aa)]||null,'oldestRate':_0x21c44d?.[_0x58fb25(0x1aa)]||null,'markupPercentage':this[_0x58fb25(0x18c)]};}catch(_0x43ee6a){return console[_0x58fb25(0x139)](_0x58fb25(0x19d),_0x43ee6a),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a49_0xa2a531(0x17f)](){const _0x30c9d5=a49_0xa2a531;return this[_0x30c9d5(0x18c)];}}function a49_0x213c(){const _0x49f25c=['vnd','\x20USDT\x20=\x20','__esModule','2622vQLKck','Periodic\x20currency\x20rates\x20update\x20failed:','keys','CurrencyService','getAllRates','mmk','3258852ncgSRa','clp','cad','COINGECKO_URL','ngn','__importDefault','3426156sZNJkN','ars','currencyService','Payment\x20System/1.0','4295630bmOERD','sek','bdt','join','asc','nok','bch','myr','status','defineProperty','entries','findMany','currencyRate','uah','dkk','zar','currency','rub','json','\x20to\x20','inr','44UZtjgy','convertToUSDT','üìä\x20Received\x20rates\x20for\x20','1kRKxsW','application/json','xlm','toLowerCase','1273055tZtpAm','xag','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','138246fNpyQb','bhd','all','Error\x20getting\x20rate\x20for\x20currency\x20','jpy','Initial\x20currency\x20rates\x20update\x20failed:','warn','php','kwd','getMarkupPercentage','sats','eos','CURRENCIES','link','CoinGecko\x20API\x20error:\x20','4792cgTZqm','desc','twd','updateCurrencyRates','nzd','forEach','chf','MARKUP_PERCENTAGE','count','toUpperCase','48ZuRwEO','allSettled','sar','brl','No\x20rate\x20found\x20for\x20currency:\x20','log','updateInterval','rate','length','Error\x20converting\x20','Error\x20getting\x20all\x20rates:',',\x20using\x201\x20as\x20fallback','\x20USDT\x20(rate:\x20','../config/database','Error\x20getting\x20rates\x20status:','aed','eth','mxn','startPeriodicUpdates','18lnGQsy','234aKsxOD','toFixed','findFirst','bmd','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','5sPZejF','192808nTHOZv','updatedAt','\x20currencies','catch','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','\x20USDT,\x20with\x20','convertMultipleToUSDT','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','default','%\x20markup\x20=\x20','hkd','error','ltc','getCurrencyRate','tether','statusText','xau','vef','krw','pkr','huf','idr'];a49_0x213c=function(){return _0x49f25c;};return a49_0x213c();}exports[a49_0xa2a531(0x14a)]=CurrencyService,exports[a49_0xa2a531(0x155)]=new CurrencyService();