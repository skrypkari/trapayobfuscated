'use strict';const a36_0x1206c6=a36_0x5ed5;(function(_0x321193,_0x8534ca){const _0x23dc79=a36_0x5ed5,_0x57a33e=_0x321193();while(!![]){try{const _0x31dbed=-parseInt(_0x23dc79(0x1c2))/0x1+parseInt(_0x23dc79(0x189))/0x2*(-parseInt(_0x23dc79(0x192))/0x3)+parseInt(_0x23dc79(0x17b))/0x4*(-parseInt(_0x23dc79(0x1db))/0x5)+-parseInt(_0x23dc79(0x191))/0x6*(-parseInt(_0x23dc79(0x198))/0x7)+parseInt(_0x23dc79(0x1bc))/0x8*(parseInt(_0x23dc79(0x1ac))/0x9)+-parseInt(_0x23dc79(0x1bb))/0xa+parseInt(_0x23dc79(0x1e1))/0xb;if(_0x31dbed===_0x8534ca)break;else _0x57a33e['push'](_0x57a33e['shift']());}catch(_0x417c5e){_0x57a33e['push'](_0x57a33e['shift']());}}}(a36_0x3736,0xb8963));function a36_0x5ed5(_0x399da8,_0x107c66){const _0x37362b=a36_0x3736();return a36_0x5ed5=function(_0x5ed5ac,_0x4f57de){_0x5ed5ac=_0x5ed5ac-0x169;let _0x445eb3=_0x37362b[_0x5ed5ac];return _0x445eb3;},a36_0x5ed5(_0x399da8,_0x107c66);}function a36_0x3736(){const _0x53bd10=['dkk','sar','\x20USDT\x20=\x20','convertMultipleToUSDT','hkd','ltc','989416gbMorJ','currencyRate','updateCurrencyRates','kwd','eur','toLowerCase','No\x20rate\x20found\x20for\x20currency:\x20','Failed\x20to\x20update\x20rate\x20for\x20','map','currency','tether','Initial\x20currency\x20rates\x20update\x20failed:','try','huf','1466712fddTnH','ngn','toUpperCase','CurrencyService','cny','gel','âŒ\x20Failed\x20to\x20update\x20currency\x20rates:','sek','66gBHUjk','3SZJlRx','yfi','json','lkr','default','desc','354151lwImBq','xag','ars','mxn','keys','CURRENCIES','brl','asc','eth','rub','\x20to\x20','sgd','usdt','twd','mmk','chf','?ids=tether&vs_currencies=','Error\x20getting\x20rate\x20for\x20currency\x20','defineProperty','pkr','9yThvxe','\x20USDT\x20(rate:\x20','nok','gbp','count','length','application/json','\x20USDT','entries','__esModule','link','uah','TesSoft\x20Payment\x20System/1.0','\x20USDT,\x20with\x20','getRatesStatus','369270BtvZzL','960728uTIhaD','error','âœ…\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','convertToUSDT','\x20to\x20USDT:','status','250020boxdmd','vef','allSettled','updateInterval','php','getAllRates','rate','ðŸ›‘\x20Currency\x20rates\x20periodic\x20updates\x20stopped','eos','inr','stopPeriodicUpdates','catch','findFirst','toFixed','ðŸ”„\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','findUnique','Error\x20getting\x20rates\x20status:','idr','https://api.coingecko.com/api/v3/simple/price','usd','statusText','bmd','log','%\x20markup\x20=\x20','xdr','20HmhoYR','getMarkupPercentage','pln','bdt','getCurrencyRate','../config/database','22980892foemRF','warn','currencyService','jpy','__importDefault','vnd','aed','MARKUP_PERCENTAGE','cad','ðŸ’±\x20Applied\x20','CoinGecko\x20API\x20error:\x20','startPeriodicUpdates','âœ…\x20Currency\x20rates\x20updated\x20successfully'];a36_0x3736=function(){return _0x53bd10;};return a36_0x3736();}var __importDefault=this&&this[a36_0x1206c6(0x16c)]||function(_0x525dba){const _0x1bca51=a36_0x1206c6;return _0x525dba&&_0x525dba[_0x1bca51(0x1b5)]?_0x525dba:{'default':_0x525dba};};Object[a36_0x1206c6(0x1aa)](exports,a36_0x1206c6(0x1b5),{'value':!![]}),exports[a36_0x1206c6(0x16a)]=exports[a36_0x1206c6(0x18c)]=void 0x0;const database_1=__importDefault(require(a36_0x1206c6(0x1e0)));class CurrencyService{constructor(){const _0x28b1cf=a36_0x1206c6;this['COINGECKO_URL']=_0x28b1cf(0x1d4),this[_0x28b1cf(0x19d)]=['btc',_0x28b1cf(0x1a0),_0x28b1cf(0x17a),'bch','bnb',_0x28b1cf(0x1ca),'xrp','xlm',_0x28b1cf(0x1b6),'dot',_0x28b1cf(0x193),_0x28b1cf(0x1d5),_0x28b1cf(0x16e),_0x28b1cf(0x19a),'aud',_0x28b1cf(0x1de),'bhd',_0x28b1cf(0x1d7),_0x28b1cf(0x19e),_0x28b1cf(0x170),_0x28b1cf(0x1a7),'clp',_0x28b1cf(0x18d),'czk',_0x28b1cf(0x175),_0x28b1cf(0x17f),_0x28b1cf(0x1af),_0x28b1cf(0x18e),_0x28b1cf(0x179),_0x28b1cf(0x188),_0x28b1cf(0x1d3),'ils',_0x28b1cf(0x1cb),_0x28b1cf(0x16b),'krw',_0x28b1cf(0x17e),_0x28b1cf(0x195),_0x28b1cf(0x1a6),_0x28b1cf(0x19b),'myr',_0x28b1cf(0x18a),_0x28b1cf(0x1ae),'nzd',_0x28b1cf(0x1c6),_0x28b1cf(0x1ab),_0x28b1cf(0x1dd),_0x28b1cf(0x1a1),_0x28b1cf(0x176),_0x28b1cf(0x190),_0x28b1cf(0x1a3),'thb',_0x28b1cf(0x187),_0x28b1cf(0x1a5),_0x28b1cf(0x1b7),_0x28b1cf(0x1c3),_0x28b1cf(0x16d),'zar',_0x28b1cf(0x1da),_0x28b1cf(0x199),'xau','bits','sats'],this[_0x28b1cf(0x1c5)]=null,this[_0x28b1cf(0x16f)]=0x3,this['startPeriodicUpdates']();}[a36_0x1206c6(0x173)](){const _0x9f1b97=a36_0x1206c6;this[_0x9f1b97(0x17d)]()[_0x9f1b97(0x1cd)](_0x86caa4=>{const _0x4b9146=_0x9f1b97;console[_0x4b9146(0x1bd)](_0x4b9146(0x186),_0x86caa4);}),this[_0x9f1b97(0x1c5)]=setInterval(async()=>{const _0x261cc6=_0x9f1b97;try{await this['updateCurrencyRates']();}catch(_0x4615d0){console[_0x261cc6(0x1bd)]('Periodic\x20currency\x20rates\x20update\x20failed:',_0x4615d0);}},0x3c*0x3c*0x3e8),console[_0x9f1b97(0x1d8)](_0x9f1b97(0x1be));}[a36_0x1206c6(0x1cc)](){const _0x1ba9f5=a36_0x1206c6;this[_0x1ba9f5(0x1c5)]&&(clearInterval(this[_0x1ba9f5(0x1c5)]),this['updateInterval']=null,console[_0x1ba9f5(0x1d8)](_0x1ba9f5(0x1c9)));}async['updateCurrencyRates'](){const _0x484d0f=a36_0x1206c6;try{console[_0x484d0f(0x1d8)](_0x484d0f(0x1d0));const _0x5d7c44=this[_0x484d0f(0x19d)]['join'](','),_0x5cf04a=this['COINGECKO_URL']+_0x484d0f(0x1a8)+_0x5d7c44,_0x199164=await fetch(_0x5cf04a,{'headers':{'Accept':_0x484d0f(0x1b2),'User-Agent':_0x484d0f(0x1b8)}});if(!_0x199164['ok'])throw new Error(_0x484d0f(0x172)+_0x199164[_0x484d0f(0x1c1)]+'\x20'+_0x199164[_0x484d0f(0x1d6)]);const _0x4b8b2b=await _0x199164[_0x484d0f(0x194)]();if(!_0x4b8b2b[_0x484d0f(0x185)])throw new Error('Invalid\x20response\x20format\x20from\x20CoinGecko\x20API');const _0x5a7c68=_0x4b8b2b[_0x484d0f(0x185)];console['log']('ðŸ“Š\x20Received\x20rates\x20for\x20'+Object[_0x484d0f(0x19c)](_0x5a7c68)[_0x484d0f(0x1b1)]+'\x20currencies');const _0x36ead5=Object[_0x484d0f(0x1b4)](_0x5a7c68)[_0x484d0f(0x183)](async([_0x4a946d,_0x3075df])=>{const _0x4c34e0=_0x484d0f;try{await database_1['default'][_0x4c34e0(0x17c)]['upsert']({'where':{'currency':_0x4a946d[_0x4c34e0(0x180)]()},'update':{'rate':_0x3075df},'create':{'currency':_0x4a946d['toLowerCase'](),'rate':_0x3075df}});}catch(_0xcbb061){console[_0x4c34e0(0x1bd)](_0x4c34e0(0x182)+_0x4a946d+':',_0xcbb061);}});await Promise[_0x484d0f(0x1c4)](_0x36ead5),console['log'](_0x484d0f(0x174));}catch(_0x2d4405){console[_0x484d0f(0x1bd)](_0x484d0f(0x18f),_0x2d4405);throw _0x2d4405;}}async[a36_0x1206c6(0x1df)](_0x4fb118){const _0x2c9838=a36_0x1206c6,_0x4676d4=_0x4fb118[_0x2c9838(0x180)]();if(_0x4676d4===_0x2c9838(0x1a4))return 0x1;try{const _0x14fac0=await database_1[_0x2c9838(0x196)]['currencyRate'][_0x2c9838(0x1d1)]({'where':{'currency':_0x4676d4}});if(!_0x14fac0)return console[_0x2c9838(0x169)](_0x2c9838(0x181)+_0x4fb118+',\x20using\x201\x20as\x20fallback'),0x1;return _0x14fac0[_0x2c9838(0x1c8)];}catch(_0x365898){return console[_0x2c9838(0x1bd)](_0x2c9838(0x1a9)+_0x4fb118+':',_0x365898),0x1;}}async['convertToUSDT'](_0x472988,_0x4cb644){const _0x137c02=a36_0x1206c6,_0x57eb23=_0x4cb644[_0x137c02(0x180)]();if(_0x57eb23==='usdt'){const _0x37f537=_0x472988*(0x1+this[_0x137c02(0x16f)]/0x64);return console[_0x137c02(0x1d8)](_0x137c02(0x171)+this[_0x137c02(0x16f)]+'%\x20markup\x20to\x20'+_0x472988+_0x137c02(0x177)+_0x37f537[_0x137c02(0x1cf)](0x6)+_0x137c02(0x1b3)),_0x37f537;}try{const _0x106038=await this[_0x137c02(0x1df)](_0x57eb23),_0x150ba3=_0x472988/_0x106038,_0x2f810f=_0x150ba3*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x137c02(0x1d8)]('ðŸ’±\x20Converted\x20'+_0x472988+'\x20'+_0x4cb644[_0x137c02(0x18b)]()+_0x137c02(0x1a2)+_0x150ba3[_0x137c02(0x1cf)](0x6)+_0x137c02(0x1b9)+this[_0x137c02(0x16f)]+_0x137c02(0x1d9)+_0x2f810f[_0x137c02(0x1cf)](0x6)+_0x137c02(0x1ad)+_0x106038+')'),_0x2f810f;}catch(_0x1aad0b){console[_0x137c02(0x1bd)]('Error\x20converting\x20'+_0x472988+'\x20'+_0x4cb644+_0x137c02(0x1c0),_0x1aad0b);const _0x3d76fb=_0x472988*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x3d76fb;}}async[a36_0x1206c6(0x178)](_0xec3627){const _0x3043a3=a36_0x1206c6;let _0x4df671=0x0;for(const {amount:_0x555896,currency:_0x18b482}of _0xec3627){const _0x4c6146=await this[_0x3043a3(0x1bf)](_0x555896,_0x18b482);_0x4df671+=_0x4c6146;}return _0x4df671;}async[a36_0x1206c6(0x1c7)](){const _0x169a6c=a36_0x1206c6;try{const _0x45cf09=await database_1[_0x169a6c(0x196)][_0x169a6c(0x17c)]['findMany']({'select':{'currency':!![],'rate':!![]}}),_0x429b95={'usdt':0x1};return _0x45cf09['forEach'](_0x1d4cfa=>{const _0x30e5b0=_0x169a6c;_0x429b95[_0x1d4cfa[_0x30e5b0(0x184)]]=_0x1d4cfa['rate'];}),_0x429b95;}catch(_0x20ec14){return console[_0x169a6c(0x1bd)]('Error\x20getting\x20all\x20rates:',_0x20ec14),{'usdt':0x1};}}async[a36_0x1206c6(0x1ba)](){const _0x4a6be2=a36_0x1206c6;try{const [_0x5ebaa8,_0xb484ff,_0x5753b2]=await Promise['all']([database_1[_0x4a6be2(0x196)]['currencyRate'][_0x4a6be2(0x1b0)](),database_1[_0x4a6be2(0x196)][_0x4a6be2(0x17c)][_0x4a6be2(0x1ce)]({'orderBy':{'updatedAt':_0x4a6be2(0x197)},'select':{'updatedAt':!![]}}),database_1[_0x4a6be2(0x196)][_0x4a6be2(0x17c)][_0x4a6be2(0x1ce)]({'orderBy':{'updatedAt':_0x4a6be2(0x19f)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x5ebaa8,'lastUpdated':_0xb484ff?.['updatedAt']||null,'oldestRate':_0x5753b2?.['updatedAt']||null,'markupPercentage':this[_0x4a6be2(0x16f)]};}catch(_0x53f701){return console[_0x4a6be2(0x1bd)](_0x4a6be2(0x1d2),_0x53f701),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x4a6be2(0x16f)]};}}[a36_0x1206c6(0x1dc)](){const _0x200d2c=a36_0x1206c6;return this[_0x200d2c(0x16f)];}}exports['CurrencyService']=CurrencyService,exports[a36_0x1206c6(0x16a)]=new CurrencyService();