'use strict';const a49_0x2dddb0=a49_0x29af;(function(_0x3f4636,_0x9a6ae8){const _0x556c18=a49_0x29af,_0x307c60=_0x3f4636();while(!![]){try{const _0x54e1b4=-parseInt(_0x556c18(0xfd))/0x1*(parseInt(_0x556c18(0x14f))/0x2)+parseInt(_0x556c18(0x122))/0x3*(parseInt(_0x556c18(0x148))/0x4)+-parseInt(_0x556c18(0x151))/0x5*(parseInt(_0x556c18(0xfb))/0x6)+-parseInt(_0x556c18(0x149))/0x7+parseInt(_0x556c18(0xfc))/0x8*(-parseInt(_0x556c18(0x13a))/0x9)+parseInt(_0x556c18(0x137))/0xa*(-parseInt(_0x556c18(0x167))/0xb)+parseInt(_0x556c18(0x144))/0xc;if(_0x54e1b4===_0x9a6ae8)break;else _0x307c60['push'](_0x307c60['shift']());}catch(_0x3bb501){_0x307c60['push'](_0x307c60['shift']());}}}(a49_0x2991,0xba69e));var __importDefault=this&&this[a49_0x2dddb0(0xf7)]||function(_0x5cd5ec){return _0x5cd5ec&&_0x5cd5ec['__esModule']?_0x5cd5ec:{'default':_0x5cd5ec};};Object[a49_0x2dddb0(0x11a)](exports,a49_0x2dddb0(0x11f),{'value':!![]}),exports[a49_0x2dddb0(0x124)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a49_0x2dddb0(0x105)));class CurrencyService{constructor(){const _0x1b6420=a49_0x2dddb0;this[_0x1b6420(0x10b)]='https://api.coingecko.com/api/v3/simple/price',this['CURRENCIES']=['btc','eth',_0x1b6420(0xff),_0x1b6420(0x136),_0x1b6420(0x123),_0x1b6420(0xfe),_0x1b6420(0x10a),_0x1b6420(0x139),_0x1b6420(0x146),_0x1b6420(0x112),_0x1b6420(0x160),_0x1b6420(0xed),_0x1b6420(0x101),_0x1b6420(0x14d),'aud',_0x1b6420(0x153),'bhd',_0x1b6420(0x130),_0x1b6420(0x12d),_0x1b6420(0x113),_0x1b6420(0x13e),'clp','cny',_0x1b6420(0x114),_0x1b6420(0x166),_0x1b6420(0x13d),_0x1b6420(0x11b),_0x1b6420(0x141),'hkd',_0x1b6420(0x117),_0x1b6420(0xec),_0x1b6420(0x14e),_0x1b6420(0x127),'jpy','krw',_0x1b6420(0x15e),_0x1b6420(0x115),'mmk',_0x1b6420(0x15f),_0x1b6420(0x10c),_0x1b6420(0x133),_0x1b6420(0x154),'nzd',_0x1b6420(0x14c),'pkr',_0x1b6420(0x106),_0x1b6420(0x120),_0x1b6420(0xf2),_0x1b6420(0x163),'sgd','thb',_0x1b6420(0xf9),'twd',_0x1b6420(0x108),_0x1b6420(0x158),'vnd',_0x1b6420(0x104),_0x1b6420(0x135),'xag',_0x1b6420(0x107),_0x1b6420(0x165),_0x1b6420(0xf4)],this[_0x1b6420(0x15d)]=null,this['MARKUP_PERCENTAGE']=-0x3,this[_0x1b6420(0x161)]();}[a49_0x2dddb0(0x161)](){const _0x43f8bb=a49_0x2dddb0;this[_0x43f8bb(0x147)]()[_0x43f8bb(0x118)](_0x2ed196=>{const _0x88f1e4=_0x43f8bb;console[_0x88f1e4(0x140)](_0x88f1e4(0xf6),_0x2ed196);}),this[_0x43f8bb(0x15d)]=setInterval(async()=>{const _0x4d96c8=_0x43f8bb;try{await this[_0x4d96c8(0x147)]();}catch(_0x5c82f6){console[_0x4d96c8(0x140)](_0x4d96c8(0x11c),_0x5c82f6);}},0x3c*0x3c*0x3e8),console[_0x43f8bb(0x157)](_0x43f8bb(0x129));}[a49_0x2dddb0(0x121)](){const _0x14bbb6=a49_0x2dddb0;this[_0x14bbb6(0x15d)]&&(clearInterval(this[_0x14bbb6(0x15d)]),this[_0x14bbb6(0x15d)]=null,console['log'](_0x14bbb6(0x143)));}async[a49_0x2dddb0(0x147)](){const _0x3d3b2e=a49_0x2dddb0;try{console[_0x3d3b2e(0x157)](_0x3d3b2e(0x119));const _0x504a71=this[_0x3d3b2e(0x152)]['join'](','),_0xb90878=this['COINGECKO_URL']+'?ids=tether&vs_currencies='+_0x504a71,_0x4ab666=await fetch(_0xb90878,{'headers':{'Accept':_0x3d3b2e(0x162),'User-Agent':'Payment\x20System/1.0'}});if(!_0x4ab666['ok'])throw new Error(_0x3d3b2e(0x12c)+_0x4ab666[_0x3d3b2e(0x103)]+'\x20'+_0x4ab666[_0x3d3b2e(0x11d)]);const _0x38e510=await _0x4ab666[_0x3d3b2e(0xf1)]();if(!_0x38e510['tether'])throw new Error(_0x3d3b2e(0xee));const _0x3f9bd3=_0x38e510[_0x3d3b2e(0x14b)];console[_0x3d3b2e(0x157)](_0x3d3b2e(0x13b)+Object[_0x3d3b2e(0x126)](_0x3f9bd3)['length']+_0x3d3b2e(0x132));const _0xcb7494=Object[_0x3d3b2e(0x142)](_0x3f9bd3)[_0x3d3b2e(0x131)](async([_0x202b25,_0x112130])=>{const _0x4b9300=_0x3d3b2e;try{await database_1[_0x4b9300(0xef)][_0x4b9300(0x156)][_0x4b9300(0xfa)]({'where':{'currency':_0x202b25['toLowerCase']()},'update':{'rate':_0x112130},'create':{'currency':_0x202b25[_0x4b9300(0x100)](),'rate':_0x112130}});}catch(_0x4b0059){console[_0x4b9300(0x140)](_0x4b9300(0xf0)+_0x202b25+':',_0x4b0059);}});await Promise[_0x3d3b2e(0x12a)](_0xcb7494),console[_0x3d3b2e(0x157)](_0x3d3b2e(0x10e));}catch(_0x3ab65a){console[_0x3d3b2e(0x140)](_0x3d3b2e(0x155),_0x3ab65a);throw _0x3ab65a;}}async[a49_0x2dddb0(0x13f)](_0x23f43a){const _0x16735c=a49_0x2dddb0,_0x43c708=_0x23f43a[_0x16735c(0x100)]();if(_0x43c708===_0x16735c(0x10d))return 0x1;try{const _0x70e1f0=await database_1[_0x16735c(0xef)][_0x16735c(0x156)][_0x16735c(0x134)]({'where':{'currency':_0x43c708}});if(!_0x70e1f0)return console[_0x16735c(0x15a)](_0x16735c(0x116)+_0x23f43a+',\x20using\x201\x20as\x20fallback'),0x1;return _0x70e1f0[_0x16735c(0x12b)];}catch(_0x349fc4){return console['error'](_0x16735c(0x110)+_0x23f43a+':',_0x349fc4),0x1;}}async['convertToUSDT'](_0x46b85a,_0x975ffa){const _0x128a2f=a49_0x2dddb0,_0x3b5073=_0x975ffa[_0x128a2f(0x100)]();if(_0x3b5073===_0x128a2f(0x10d)){const _0x583ca4=_0x46b85a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console['log'](_0x128a2f(0x12f)+this[_0x128a2f(0x102)]+_0x128a2f(0xf5)+_0x46b85a+_0x128a2f(0xf8)+_0x583ca4[_0x128a2f(0x11e)](0x6)+'\x20USDT'),_0x583ca4;}try{const _0x4672ca=await this['getCurrencyRate'](_0x3b5073),_0x17c80a=_0x46b85a/_0x4672ca,_0x208504=_0x17c80a*(0x1+this[_0x128a2f(0x102)]/0x64);return console[_0x128a2f(0x157)]('üí±\x20Converted\x20'+_0x46b85a+'\x20'+_0x975ffa[_0x128a2f(0x159)]()+'\x20to\x20'+_0x17c80a[_0x128a2f(0x11e)](0x6)+_0x128a2f(0xf3)+this[_0x128a2f(0x102)]+'%\x20markup\x20=\x20'+_0x208504['toFixed'](0x6)+'\x20USDT\x20(rate:\x20'+_0x4672ca+')'),_0x208504;}catch(_0x52449e){console['error'](_0x128a2f(0x13c)+_0x46b85a+'\x20'+_0x975ffa+_0x128a2f(0x150),_0x52449e);const _0x47bd3b=_0x46b85a*(0x1+this[_0x128a2f(0x102)]/0x64);return _0x47bd3b;}}async[a49_0x2dddb0(0x164)](_0x1f8fb2){const _0x311c01=a49_0x2dddb0;let _0x2fc2ed=0x0;for(const {amount:_0x441115,currency:_0x15f445}of _0x1f8fb2){const _0x277a7f=await this[_0x311c01(0x10f)](_0x441115,_0x15f445);_0x2fc2ed+=_0x277a7f;}return _0x2fc2ed;}async['getAllRates'](){const _0x58f7b0=a49_0x2dddb0;try{const _0x47b26a=await database_1['default'][_0x58f7b0(0x156)][_0x58f7b0(0x15b)]({'select':{'currency':!![],'rate':!![]}}),_0x1612f3={'usdt':0x1};return _0x47b26a[_0x58f7b0(0x125)](_0x42e9df=>{const _0x38ab6d=_0x58f7b0;_0x1612f3[_0x42e9df['currency']]=_0x42e9df[_0x38ab6d(0x12b)];}),_0x1612f3;}catch(_0x17aad2){return console[_0x58f7b0(0x140)]('Error\x20getting\x20all\x20rates:',_0x17aad2),{'usdt':0x1};}}async[a49_0x2dddb0(0x128)](){const _0x9bd037=a49_0x2dddb0;try{const [_0x2b8368,_0x5b8517,_0x133f01]=await Promise[_0x9bd037(0x145)]([database_1['default'][_0x9bd037(0x156)][_0x9bd037(0x109)](),database_1[_0x9bd037(0xef)][_0x9bd037(0x156)][_0x9bd037(0x15c)]({'orderBy':{'updatedAt':_0x9bd037(0x138)},'select':{'updatedAt':!![]}}),database_1['default'][_0x9bd037(0x156)][_0x9bd037(0x15c)]({'orderBy':{'updatedAt':_0x9bd037(0x111)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x2b8368,'lastUpdated':_0x5b8517?.[_0x9bd037(0x14a)]||null,'oldestRate':_0x133f01?.[_0x9bd037(0x14a)]||null,'markupPercentage':this[_0x9bd037(0x102)]};}catch(_0x37dae0){return console[_0x9bd037(0x140)](_0x9bd037(0x12e),_0x37dae0),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}['getMarkupPercentage'](){const _0x492e21=a49_0x2dddb0;return this[_0x492e21(0x102)];}}function a49_0x29af(_0x238b61,_0x59e39e){_0x238b61=_0x238b61-0xec;const _0x29914f=a49_0x2991();let _0x29af7a=_0x29914f[_0x238b61];return _0x29af7a;}exports['CurrencyService']=CurrencyService,exports[a49_0x2dddb0(0x124)]=new CurrencyService();function a49_0x2991(){const _0x2c7b27=['Initial\x20currency\x20rates\x20update\x20failed:','__importDefault','\x20USDT\x20=\x20','try','upsert','6YUOOeA','8apftXp','71359fqKCpT','eos','ltc','toLowerCase','aed','MARKUP_PERCENTAGE','status','zar','../config/database','pln','xau','uah','count','xrp','COINGECKO_URL','myr','usdt','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','convertToUSDT','Error\x20getting\x20rate\x20for\x20currency\x20','asc','dot','cad','czk','lkr','No\x20rate\x20found\x20for\x20currency:\x20','huf','catch','üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','defineProperty','gbp','Periodic\x20currency\x20rates\x20update\x20failed:','statusText','toFixed','__esModule','rub','stopPeriodicUpdates','9iKdDyu','bnb','currencyService','forEach','keys','inr','getRatesStatus','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','allSettled','rate','CoinGecko\x20API\x20error:\x20','brl','Error\x20getting\x20rates\x20status:','üí±\x20Applied\x20','bmd','map','\x20currencies','ngn','findUnique','xdr','bch','10RPhHGU','desc','xlm','11910861nVbyeq','üìä\x20Received\x20rates\x20for\x20','Error\x20converting\x20','eur','chf','getCurrencyRate','error','gel','entries','üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped','47780952tRRTYH','all','link','updateCurrencyRates','783476vxmxIp','973035rpGLAk','updatedAt','tether','php','ars','ils','16wujQZz','\x20to\x20USDT:','1547995XdNULe','CURRENCIES','bdt','nok','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','currencyRate','log','vef','toUpperCase','warn','findMany','findFirst','updateInterval','kwd','mxn','yfi','startPeriodicUpdates','application/json','sek','convertMultipleToUSDT','bits','dkk','16091878RJSOmr','idr','usd','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','default','Failed\x20to\x20update\x20rate\x20for\x20','json','sar','\x20USDT,\x20with\x20','sats','%\x20markup\x20to\x20'];a49_0x2991=function(){return _0x2c7b27;};return a49_0x2991();}