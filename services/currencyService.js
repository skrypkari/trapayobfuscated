'use strict';const a38_0x1be32c=a38_0x5af1;function a38_0x23ff(){const _0x205440=['sek','warn','25230UZfUFG','sar','toLowerCase','default','232338WiYTAe','stopPeriodicUpdates','getMarkupPercentage','\x20USDT,\x20with\x20','chf','\x20USDT','Failed\x20to\x20update\x20rate\x20for\x20','xdr','CurrencyService','xlm','Initial\x20currency\x20rates\x20update\x20failed:','json','83711npPVeV','bdt','usdt','?ids=tether&vs_currencies=','count','1357615fdgwTS','12503232FCHzTx','length','vef','toUpperCase','defineProperty','✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','log','❌\x20Failed\x20to\x20update\x20currency\x20rates:','10eXcxCs','aed','getCurrencyRate','aud','hkd','xau','\x20currencies','ars','vnd','\x20to\x20','asc','bch','currencyRate','📊\x20Received\x20rates\x20for\x20','mmk','CURRENCIES','twd','upsert','Error\x20converting\x20','statusText','updateInterval','__esModule','krw','%\x20markup\x20=\x20','cny','406vIPjtc','gbp','mxn','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','brl','\x20to\x20USDT:','2090576dZLTst','keys','✅\x20Currency\x20rates\x20updated\x20successfully','updateCurrencyRates','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','💱\x20Applied\x20','huf','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','findFirst','jpy','Periodic\x20currency\x20rates\x20update\x20failed:','btc','rate','error','xag','eur','tether','Error\x20getting\x20rates\x20status:','nok','Error\x20getting\x20all\x20rates:','findMany','MARKUP_PERCENTAGE','link','uah','clp',',\x20using\x201\x20as\x20fallback','convertToUSDT','getAllRates','%\x20markup\x20to\x20','rub','lkr','bmd','__importDefault','dot','currencyService','dkk','eos','myr','map','application/json','toFixed','\x20USDT\x20=\x20','startPeriodicUpdates','bits','xrp','cad','pkr','../config/database','ils','inr','No\x20rate\x20found\x20for\x20currency:\x20','zar','💱\x20Converted\x20','updatedAt','usd','eth','COINGECKO_URL','https://api.coingecko.com/api/v3/simple/price','3133768XYNunj'];a38_0x23ff=function(){return _0x205440;};return a38_0x23ff();}(function(_0x2659c4,_0x2299e0){const _0x31f7e0=a38_0x5af1,_0x37966d=_0x2659c4();while(!![]){try{const _0x4079b1=-parseInt(_0x31f7e0(0xe3))/0x1+-parseInt(_0x31f7e0(0xf1))/0x2*(-parseInt(_0x31f7e0(0xd7))/0x3)+-parseInt(_0x31f7e0(0x110))/0x4+-parseInt(_0x31f7e0(0xe8))/0x5+-parseInt(_0x31f7e0(0x14d))/0x6*(parseInt(_0x31f7e0(0x10a))/0x7)+-parseInt(_0x31f7e0(0x14a))/0x8+parseInt(_0x31f7e0(0xe9))/0x9;if(_0x4079b1===_0x2299e0)break;else _0x37966d['push'](_0x37966d['shift']());}catch(_0x47c5fe){_0x37966d['push'](_0x37966d['shift']());}}}(a38_0x23ff,0x4034d));function a38_0x5af1(_0x18c6b0,_0x37a559){const _0x23ff0f=a38_0x23ff();return a38_0x5af1=function(_0x5af11e,_0x304b30){_0x5af11e=_0x5af11e-0xd7;let _0x4d3ca0=_0x23ff0f[_0x5af11e];return _0x4d3ca0;},a38_0x5af1(_0x18c6b0,_0x37a559);}var __importDefault=this&&this[a38_0x1be32c(0x130)]||function(_0x246a73){const _0x2ad8c3=a38_0x1be32c;return _0x246a73&&_0x246a73[_0x2ad8c3(0x106)]?_0x246a73:{'default':_0x246a73};};Object[a38_0x1be32c(0xed)](exports,a38_0x1be32c(0x106),{'value':!![]}),exports[a38_0x1be32c(0x132)]=exports[a38_0x1be32c(0xdf)]=void 0x0;const database_1=__importDefault(require(a38_0x1be32c(0x13f)));class CurrencyService{constructor(){const _0x31a8c3=a38_0x1be32c;this[_0x31a8c3(0x148)]=_0x31a8c3(0x149),this[_0x31a8c3(0x100)]=[_0x31a8c3(0x11b),_0x31a8c3(0x147),'ltc',_0x31a8c3(0xfc),'bnb',_0x31a8c3(0x134),_0x31a8c3(0x13c),_0x31a8c3(0xe0),_0x31a8c3(0x126),_0x31a8c3(0x131),'yfi',_0x31a8c3(0x146),_0x31a8c3(0xf2),_0x31a8c3(0xf8),_0x31a8c3(0xf4),_0x31a8c3(0xe4),'bhd',_0x31a8c3(0x12f),_0x31a8c3(0x10e),_0x31a8c3(0x13d),_0x31a8c3(0xdb),_0x31a8c3(0x128),_0x31a8c3(0x109),'czk',_0x31a8c3(0x133),_0x31a8c3(0x11f),_0x31a8c3(0x10b),'gel',_0x31a8c3(0xf5),_0x31a8c3(0x116),'idr',_0x31a8c3(0x140),_0x31a8c3(0x141),_0x31a8c3(0x119),_0x31a8c3(0x107),'kwd',_0x31a8c3(0x12e),_0x31a8c3(0xff),_0x31a8c3(0x10c),_0x31a8c3(0x135),'ngn',_0x31a8c3(0x122),'nzd','php',_0x31a8c3(0x13e),'pln',_0x31a8c3(0x12d),_0x31a8c3(0x14e),_0x31a8c3(0x14b),'sgd','thb','try',_0x31a8c3(0x101),_0x31a8c3(0x127),_0x31a8c3(0xeb),_0x31a8c3(0xf9),_0x31a8c3(0x143),_0x31a8c3(0xde),_0x31a8c3(0x11e),_0x31a8c3(0xf6),_0x31a8c3(0x13b),'sats'],this[_0x31a8c3(0x105)]=null,this[_0x31a8c3(0x125)]=0x3,this[_0x31a8c3(0x13a)]();}[a38_0x1be32c(0x13a)](){const _0x331fbf=a38_0x1be32c;this[_0x331fbf(0x113)]()['catch'](_0x4ee269=>{const _0x4f2b58=_0x331fbf;console['error'](_0x4f2b58(0xe1),_0x4ee269);}),this[_0x331fbf(0x105)]=setInterval(async()=>{const _0x360f1c=_0x331fbf;try{await this['updateCurrencyRates']();}catch(_0x930bca){console[_0x360f1c(0x11d)](_0x360f1c(0x11a),_0x930bca);}},0x3c*0x3c*0x3e8),console[_0x331fbf(0xef)](_0x331fbf(0xee));}[a38_0x1be32c(0xd8)](){const _0x2b3646=a38_0x1be32c;this[_0x2b3646(0x105)]&&(clearInterval(this[_0x2b3646(0x105)]),this['updateInterval']=null,console[_0x2b3646(0xef)](_0x2b3646(0x117)));}async[a38_0x1be32c(0x113)](){const _0x3503b0=a38_0x1be32c;try{console[_0x3503b0(0xef)](_0x3503b0(0x114));const _0x8e4a0c=this[_0x3503b0(0x100)]['join'](','),_0x35879b=this[_0x3503b0(0x148)]+_0x3503b0(0xe6)+_0x8e4a0c,_0x515d2c=await fetch(_0x35879b,{'headers':{'Accept':_0x3503b0(0x137),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}});if(!_0x515d2c['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x515d2c['status']+'\x20'+_0x515d2c[_0x3503b0(0x104)]);const _0x52f2d8=await _0x515d2c[_0x3503b0(0xe2)]();if(!_0x52f2d8[_0x3503b0(0x120)])throw new Error(_0x3503b0(0x10d));const _0x57b294=_0x52f2d8[_0x3503b0(0x120)];console[_0x3503b0(0xef)](_0x3503b0(0xfe)+Object[_0x3503b0(0x111)](_0x57b294)[_0x3503b0(0xea)]+_0x3503b0(0xf7));const _0x46d87c=Object['entries'](_0x57b294)[_0x3503b0(0x136)](async([_0x1ac85b,_0x1f7261])=>{const _0x1fdfa0=_0x3503b0;try{await database_1['default']['currencyRate'][_0x1fdfa0(0x102)]({'where':{'currency':_0x1ac85b['toLowerCase']()},'update':{'rate':_0x1f7261},'create':{'currency':_0x1ac85b[_0x1fdfa0(0x14f)](),'rate':_0x1f7261}});}catch(_0x14bcf6){console[_0x1fdfa0(0x11d)](_0x1fdfa0(0xdd)+_0x1ac85b+':',_0x14bcf6);}});await Promise['allSettled'](_0x46d87c),console[_0x3503b0(0xef)](_0x3503b0(0x112));}catch(_0x263d0d){console[_0x3503b0(0x11d)](_0x3503b0(0xf0),_0x263d0d);throw _0x263d0d;}}async[a38_0x1be32c(0xf3)](_0x32c0d7){const _0x4aeec4=a38_0x1be32c,_0x2d6555=_0x32c0d7[_0x4aeec4(0x14f)]();if(_0x2d6555===_0x4aeec4(0xe5))return 0x1;try{const _0x432e04=await database_1[_0x4aeec4(0x150)][_0x4aeec4(0xfd)]['findUnique']({'where':{'currency':_0x2d6555}});if(!_0x432e04)return console[_0x4aeec4(0x14c)](_0x4aeec4(0x142)+_0x32c0d7+_0x4aeec4(0x129)),0x1;return _0x432e04[_0x4aeec4(0x11c)];}catch(_0x33893e){return console[_0x4aeec4(0x11d)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x32c0d7+':',_0x33893e),0x1;}}async['convertToUSDT'](_0x12c03a,_0x3db37a){const _0x539a4e=a38_0x1be32c,_0x318e99=_0x3db37a[_0x539a4e(0x14f)]();if(_0x318e99===_0x539a4e(0xe5)){const _0x2e80f3=_0x12c03a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return console[_0x539a4e(0xef)](_0x539a4e(0x115)+this[_0x539a4e(0x125)]+_0x539a4e(0x12c)+_0x12c03a+_0x539a4e(0x139)+_0x2e80f3[_0x539a4e(0x138)](0x6)+_0x539a4e(0xdc)),_0x2e80f3;}try{const _0x58cb8e=await this['getCurrencyRate'](_0x318e99),_0x2370c1=_0x12c03a/_0x58cb8e,_0x2967c4=_0x2370c1*(0x1+this[_0x539a4e(0x125)]/0x64);return console[_0x539a4e(0xef)](_0x539a4e(0x144)+_0x12c03a+'\x20'+_0x3db37a[_0x539a4e(0xec)]()+_0x539a4e(0xfa)+_0x2370c1['toFixed'](0x6)+_0x539a4e(0xda)+this['MARKUP_PERCENTAGE']+_0x539a4e(0x108)+_0x2967c4[_0x539a4e(0x138)](0x6)+'\x20USDT\x20(rate:\x20'+_0x58cb8e+')'),_0x2967c4;}catch(_0x15a7b8){console['error'](_0x539a4e(0x103)+_0x12c03a+'\x20'+_0x3db37a+_0x539a4e(0x10f),_0x15a7b8);const _0x374240=_0x12c03a*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x374240;}}async['convertMultipleToUSDT'](_0x4bfe2a){const _0x5c364c=a38_0x1be32c;let _0x7a77cb=0x0;for(const {amount:_0x5a6ade,currency:_0x14b976}of _0x4bfe2a){const _0x4bfc53=await this[_0x5c364c(0x12a)](_0x5a6ade,_0x14b976);_0x7a77cb+=_0x4bfc53;}return _0x7a77cb;}async[a38_0x1be32c(0x12b)](){const _0x494a66=a38_0x1be32c;try{const _0x39e826=await database_1[_0x494a66(0x150)]['currencyRate'][_0x494a66(0x124)]({'select':{'currency':!![],'rate':!![]}}),_0x344732={'usdt':0x1};return _0x39e826['forEach'](_0x2083da=>{const _0x50fd72=_0x494a66;_0x344732[_0x2083da['currency']]=_0x2083da[_0x50fd72(0x11c)];}),_0x344732;}catch(_0x310636){return console[_0x494a66(0x11d)](_0x494a66(0x123),_0x310636),{'usdt':0x1};}}async['getRatesStatus'](){const _0x573fef=a38_0x1be32c;try{const [_0x291f2e,_0x1691f2,_0x588ada]=await Promise['all']([database_1[_0x573fef(0x150)][_0x573fef(0xfd)][_0x573fef(0xe7)](),database_1[_0x573fef(0x150)]['currencyRate'][_0x573fef(0x118)]({'orderBy':{'updatedAt':'desc'},'select':{'updatedAt':!![]}}),database_1[_0x573fef(0x150)][_0x573fef(0xfd)][_0x573fef(0x118)]({'orderBy':{'updatedAt':_0x573fef(0xfb)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x291f2e,'lastUpdated':_0x1691f2?.[_0x573fef(0x145)]||null,'oldestRate':_0x588ada?.['updatedAt']||null,'markupPercentage':this[_0x573fef(0x125)]};}catch(_0xb9ca09){return console[_0x573fef(0x11d)](_0x573fef(0x121),_0xb9ca09),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x573fef(0x125)]};}}[a38_0x1be32c(0xd9)](){return this['MARKUP_PERCENTAGE'];}}exports['CurrencyService']=CurrencyService,exports[a38_0x1be32c(0x132)]=new CurrencyService();