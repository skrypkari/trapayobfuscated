'use strict';const a41_0xe41b63=a41_0x3a0d;(function(_0x148940,_0x6b1c){const _0x40830a=a41_0x3a0d,_0x2de52e=_0x148940();while(!![]){try{const _0xba808b=-parseInt(_0x40830a(0x1a7))/0x1+-parseInt(_0x40830a(0x19b))/0x2*(parseInt(_0x40830a(0x1ed))/0x3)+parseInt(_0x40830a(0x1a4))/0x4+parseInt(_0x40830a(0x18b))/0x5+-parseInt(_0x40830a(0x1fa))/0x6*(-parseInt(_0x40830a(0x1f9))/0x7)+-parseInt(_0x40830a(0x19e))/0x8*(parseInt(_0x40830a(0x1e4))/0x9)+parseInt(_0x40830a(0x19d))/0xa;if(_0xba808b===_0x6b1c)break;else _0x2de52e['push'](_0x2de52e['shift']());}catch(_0xfa3812){_0x2de52e['push'](_0x2de52e['shift']());}}}(a41_0x56c2,0xe3ee1));function a41_0x56c2(){const _0x577cb1=['265214qBhLkU','warn','7229570jRamcs','270888eCaPZb','currency','myr','json','updateCurrencyRates','Initial\x20currency\x20rates\x20update\x20failed:','1648004KAxkOd','asc','sar','728537oSFKTO','lkr','\x20to\x20','xdr','%\x20markup\x20to\x20','jpy','\x20USDT,\x20with\x20','📊\x20Received\x20rates\x20for\x20','application/json','entries','bmd','getCurrencyRate','dkk','Error\x20getting\x20all\x20rates:','upsert','vef','usdt','sgd','czk','xag','chf','💱\x20Applied\x20','bnb','convertToUSDT','aed',',\x20using\x201\x20as\x20fallback','btc','eur','tether','catch','No\x20rate\x20found\x20for\x20currency:\x20','💱\x20Converted\x20','dot','ils','defineProperty','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','ltc','currencyService','ars','join','mmk','updatedAt','xau','startPeriodicUpdates','Payment\x20System/1.0','uah','all','❌\x20Failed\x20to\x20update\x20currency\x20rates:','getAllRates','currencyRate','status','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','nzd','%\x20markup\x20=\x20','clp','findFirst','pkr','rate','✅\x20Currency\x20rates\x20updated\x20successfully','findMany','try','99gVHTfY','zar','stopPeriodicUpdates','getMarkupPercentage','Periodic\x20currency\x20rates\x20update\x20failed:','kwd','rub','idr','MARKUP_PERCENTAGE','21hUSRQs','COINGECKO_URL','\x20USDT','\x20USDT\x20(rate:\x20','cad','ngn','usd','findUnique','error','../config/database','twd','count','4836433LKDaat','6EKfpzJ','\x20to\x20USDT:','\x20currencies','nok','eth','CurrencyService','bits','pln','allSettled','inr','Failed\x20to\x20update\x20rate\x20for\x20','CURRENCIES','__esModule','krw','log','yfi','sek','toFixed','updateInterval','5684905zmWhmx','link','xlm','convertMultipleToUSDT','thb','xrp','keys','aud','default','?ids=tether&vs_currencies=','Error\x20getting\x20rate\x20for\x20currency\x20','desc','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','statusText','length','Error\x20converting\x20'];a41_0x56c2=function(){return _0x577cb1;};return a41_0x56c2();}function a41_0x3a0d(_0x24b829,_0x34e9aa){const _0x56c291=a41_0x56c2();return a41_0x3a0d=function(_0x3a0d5b,_0x4c2b33){_0x3a0d5b=_0x3a0d5b-0x185;let _0x55d43d=_0x56c291[_0x3a0d5b];return _0x55d43d;},a41_0x3a0d(_0x24b829,_0x34e9aa);}var __importDefault=this&&this['__importDefault']||function(_0x5194b1){const _0x30853b=a41_0x3a0d;return _0x5194b1&&_0x5194b1[_0x30853b(0x206)]?_0x5194b1:{'default':_0x5194b1};};Object[a41_0xe41b63(0x1c9)](exports,a41_0xe41b63(0x206),{'value':!![]}),exports[a41_0xe41b63(0x1cc)]=exports[a41_0xe41b63(0x1ff)]=void 0x0;const database_1=__importDefault(require(a41_0xe41b63(0x1f6)));class CurrencyService{constructor(){const _0x2c667a=a41_0xe41b63;this[_0x2c667a(0x1ee)]='https://api.coingecko.com/api/v3/simple/price',this[_0x2c667a(0x205)]=[_0x2c667a(0x1c1),_0x2c667a(0x1fe),_0x2c667a(0x1cb),'bch',_0x2c667a(0x1bd),'eos',_0x2c667a(0x190),_0x2c667a(0x18d),_0x2c667a(0x18c),_0x2c667a(0x1c7),_0x2c667a(0x187),_0x2c667a(0x1f3),_0x2c667a(0x1bf),_0x2c667a(0x1cd),_0x2c667a(0x192),'bdt','bhd',_0x2c667a(0x1b1),'brl',_0x2c667a(0x1f1),_0x2c667a(0x1bb),_0x2c667a(0x1dd),'cny',_0x2c667a(0x1b9),_0x2c667a(0x1b3),_0x2c667a(0x1c2),'gbp','gel','hkd','huf',_0x2c667a(0x1eb),_0x2c667a(0x1c8),_0x2c667a(0x203),_0x2c667a(0x1ac),_0x2c667a(0x185),_0x2c667a(0x1e9),_0x2c667a(0x1a8),_0x2c667a(0x1cf),'mxn',_0x2c667a(0x1a0),_0x2c667a(0x1f2),_0x2c667a(0x1fd),_0x2c667a(0x1db),'php',_0x2c667a(0x1df),_0x2c667a(0x201),_0x2c667a(0x1ea),_0x2c667a(0x1a6),_0x2c667a(0x188),_0x2c667a(0x1b8),_0x2c667a(0x18f),_0x2c667a(0x1e3),_0x2c667a(0x1f7),_0x2c667a(0x1d4),_0x2c667a(0x1b6),'vnd',_0x2c667a(0x1e5),_0x2c667a(0x1aa),_0x2c667a(0x1ba),_0x2c667a(0x1d1),_0x2c667a(0x200),'sats'],this[_0x2c667a(0x18a)]=null,this[_0x2c667a(0x1ec)]=-0x3,this['startPeriodicUpdates']();}[a41_0xe41b63(0x1d2)](){const _0x5d2654=a41_0xe41b63;this[_0x5d2654(0x1a2)]()[_0x5d2654(0x1c4)](_0x25737f=>{const _0x10db6e=_0x5d2654;console[_0x10db6e(0x1f5)](_0x10db6e(0x1a3),_0x25737f);}),this[_0x5d2654(0x18a)]=setInterval(async()=>{const _0x553156=_0x5d2654;try{await this[_0x553156(0x1a2)]();}catch(_0x4d8813){console[_0x553156(0x1f5)](_0x553156(0x1e8),_0x4d8813);}},0x3c*0x3c*0x3e8),console['log']('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a41_0xe41b63(0x1e6)](){const _0x233602=a41_0xe41b63;this[_0x233602(0x18a)]&&(clearInterval(this['updateInterval']),this[_0x233602(0x18a)]=null,console[_0x233602(0x186)](_0x233602(0x1ca)));}async[a41_0xe41b63(0x1a2)](){const _0x3b4194=a41_0xe41b63;try{console[_0x3b4194(0x186)](_0x3b4194(0x1da));const _0x447639=this[_0x3b4194(0x205)][_0x3b4194(0x1ce)](','),_0x36ff9f=this[_0x3b4194(0x1ee)]+_0x3b4194(0x194)+_0x447639,_0x106e29=await fetch(_0x36ff9f,{'headers':{'Accept':_0x3b4194(0x1af),'User-Agent':_0x3b4194(0x1d3)}});if(!_0x106e29['ok'])throw new Error('CoinGecko\x20API\x20error:\x20'+_0x106e29[_0x3b4194(0x1d9)]+'\x20'+_0x106e29[_0x3b4194(0x198)]);const _0x49861d=await _0x106e29[_0x3b4194(0x1a1)]();if(!_0x49861d[_0x3b4194(0x1c3)])throw new Error(_0x3b4194(0x197));const _0x3fdee0=_0x49861d['tether'];console[_0x3b4194(0x186)](_0x3b4194(0x1ae)+Object[_0x3b4194(0x191)](_0x3fdee0)[_0x3b4194(0x199)]+_0x3b4194(0x1fc));const _0x136665=Object[_0x3b4194(0x1b0)](_0x3fdee0)['map'](async([_0x43110d,_0x31eebb])=>{const _0xbc37fa=_0x3b4194;try{await database_1[_0xbc37fa(0x193)][_0xbc37fa(0x1d8)][_0xbc37fa(0x1b5)]({'where':{'currency':_0x43110d['toLowerCase']()},'update':{'rate':_0x31eebb},'create':{'currency':_0x43110d['toLowerCase'](),'rate':_0x31eebb}});}catch(_0x24944d){console['error'](_0xbc37fa(0x204)+_0x43110d+':',_0x24944d);}});await Promise[_0x3b4194(0x202)](_0x136665),console[_0x3b4194(0x186)](_0x3b4194(0x1e1));}catch(_0x103adb){console['error'](_0x3b4194(0x1d6),_0x103adb);throw _0x103adb;}}async['getCurrencyRate'](_0x324b4f){const _0x52b6bb=a41_0xe41b63,_0x49f98e=_0x324b4f['toLowerCase']();if(_0x49f98e==='usdt')return 0x1;try{const _0xdf45c=await database_1[_0x52b6bb(0x193)]['currencyRate'][_0x52b6bb(0x1f4)]({'where':{'currency':_0x49f98e}});if(!_0xdf45c)return console[_0x52b6bb(0x19c)](_0x52b6bb(0x1c5)+_0x324b4f+_0x52b6bb(0x1c0)),0x1;return _0xdf45c[_0x52b6bb(0x1e0)];}catch(_0x16f1f4){return console[_0x52b6bb(0x1f5)](_0x52b6bb(0x195)+_0x324b4f+':',_0x16f1f4),0x1;}}async['convertToUSDT'](_0x54b0ba,_0x567ef6){const _0x2fd343=a41_0xe41b63,_0x3f1637=_0x567ef6['toLowerCase']();if(_0x3f1637===_0x2fd343(0x1b7)){const _0x34ca18=_0x54b0ba*(0x1+this[_0x2fd343(0x1ec)]/0x64);return console[_0x2fd343(0x186)](_0x2fd343(0x1bc)+this[_0x2fd343(0x1ec)]+_0x2fd343(0x1ab)+_0x54b0ba+'\x20USDT\x20=\x20'+_0x34ca18[_0x2fd343(0x189)](0x6)+_0x2fd343(0x1ef)),_0x34ca18;}try{const _0x4a8d97=await this[_0x2fd343(0x1b2)](_0x3f1637),_0x33cfb0=_0x54b0ba/_0x4a8d97,_0x29af03=_0x33cfb0*(0x1+this[_0x2fd343(0x1ec)]/0x64);return console[_0x2fd343(0x186)](_0x2fd343(0x1c6)+_0x54b0ba+'\x20'+_0x567ef6['toUpperCase']()+_0x2fd343(0x1a9)+_0x33cfb0['toFixed'](0x6)+_0x2fd343(0x1ad)+this[_0x2fd343(0x1ec)]+_0x2fd343(0x1dc)+_0x29af03[_0x2fd343(0x189)](0x6)+_0x2fd343(0x1f0)+_0x4a8d97+')'),_0x29af03;}catch(_0x25ef04){console[_0x2fd343(0x1f5)](_0x2fd343(0x19a)+_0x54b0ba+'\x20'+_0x567ef6+_0x2fd343(0x1fb),_0x25ef04);const _0x3c1b85=_0x54b0ba*(0x1+this[_0x2fd343(0x1ec)]/0x64);return _0x3c1b85;}}async[a41_0xe41b63(0x18e)](_0x33119b){const _0x36c5a8=a41_0xe41b63;let _0x5cc16f=0x0;for(const {amount:_0x4353ed,currency:_0xc41d7}of _0x33119b){const _0x5370b4=await this[_0x36c5a8(0x1be)](_0x4353ed,_0xc41d7);_0x5cc16f+=_0x5370b4;}return _0x5cc16f;}async[a41_0xe41b63(0x1d7)](){const _0x5ce1cf=a41_0xe41b63;try{const _0x3285b9=await database_1[_0x5ce1cf(0x193)][_0x5ce1cf(0x1d8)][_0x5ce1cf(0x1e2)]({'select':{'currency':!![],'rate':!![]}}),_0x1f482a={'usdt':0x1};return _0x3285b9['forEach'](_0x573567=>{const _0x3fb637=_0x5ce1cf;_0x1f482a[_0x573567[_0x3fb637(0x19f)]]=_0x573567[_0x3fb637(0x1e0)];}),_0x1f482a;}catch(_0x6b57e2){return console['error'](_0x5ce1cf(0x1b4),_0x6b57e2),{'usdt':0x1};}}async['getRatesStatus'](){const _0x5e0389=a41_0xe41b63;try{const [_0xea3415,_0x38165e,_0x217caf]=await Promise[_0x5e0389(0x1d5)]([database_1[_0x5e0389(0x193)][_0x5e0389(0x1d8)][_0x5e0389(0x1f8)](),database_1[_0x5e0389(0x193)][_0x5e0389(0x1d8)]['findFirst']({'orderBy':{'updatedAt':_0x5e0389(0x196)},'select':{'updatedAt':!![]}}),database_1[_0x5e0389(0x193)][_0x5e0389(0x1d8)][_0x5e0389(0x1de)]({'orderBy':{'updatedAt':_0x5e0389(0x1a5)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xea3415,'lastUpdated':_0x38165e?.['updatedAt']||null,'oldestRate':_0x217caf?.[_0x5e0389(0x1d0)]||null,'markupPercentage':this[_0x5e0389(0x1ec)]};}catch(_0x47ccd7){return console[_0x5e0389(0x1f5)]('Error\x20getting\x20rates\x20status:',_0x47ccd7),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this['MARKUP_PERCENTAGE']};}}[a41_0xe41b63(0x1e7)](){const _0x317c72=a41_0xe41b63;return this[_0x317c72(0x1ec)];}}exports[a41_0xe41b63(0x1ff)]=CurrencyService,exports['currencyService']=new CurrencyService();