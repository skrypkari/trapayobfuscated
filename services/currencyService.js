'use strict';const a38_0x631bf1=a38_0xebe1;(function(_0x2a8b99,_0x5d6bd8){const _0x2c371f=a38_0xebe1,_0x13fba8=_0x2a8b99();while(!![]){try{const _0x30a238=parseInt(_0x2c371f(0x106))/0x1+parseInt(_0x2c371f(0x134))/0x2*(-parseInt(_0x2c371f(0xfa))/0x3)+-parseInt(_0x2c371f(0x172))/0x4*(parseInt(_0x2c371f(0x16d))/0x5)+-parseInt(_0x2c371f(0x11a))/0x6*(parseInt(_0x2c371f(0x15f))/0x7)+-parseInt(_0x2c371f(0x135))/0x8*(parseInt(_0x2c371f(0x160))/0x9)+parseInt(_0x2c371f(0x102))/0xa*(parseInt(_0x2c371f(0x126))/0xb)+-parseInt(_0x2c371f(0x14e))/0xc*(-parseInt(_0x2c371f(0x168))/0xd);if(_0x30a238===_0x5d6bd8)break;else _0x13fba8['push'](_0x13fba8['shift']());}catch(_0x2ee03d){_0x13fba8['push'](_0x13fba8['shift']());}}}(a38_0x341d,0xbb281));var __importDefault=this&&this[a38_0x631bf1(0x11f)]||function(_0x5665fa){return _0x5665fa&&_0x5665fa['__esModule']?_0x5665fa:{'default':_0x5665fa};};function a38_0xebe1(_0x223fc7,_0x543b09){const _0x341d11=a38_0x341d();return a38_0xebe1=function(_0xebe1aa,_0x4404e5){_0xebe1aa=_0xebe1aa-0xf0;let _0x18a14c=_0x341d11[_0xebe1aa];return _0x18a14c;},a38_0xebe1(_0x223fc7,_0x543b09);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x631bf1(0x16e)]=exports['CurrencyService']=void 0x0;const database_1=__importDefault(require(a38_0x631bf1(0x15d)));class CurrencyService{constructor(){const _0x201a5f=a38_0x631bf1;this['COINGECKO_URL']=_0x201a5f(0xf8),this[_0x201a5f(0xf3)]=[_0x201a5f(0x148),_0x201a5f(0x138),'ltc',_0x201a5f(0x110),'bnb',_0x201a5f(0xfd),_0x201a5f(0x12b),_0x201a5f(0x117),_0x201a5f(0x11d),_0x201a5f(0x11e),_0x201a5f(0x12d),_0x201a5f(0x174),_0x201a5f(0x13d),'ars',_0x201a5f(0x124),_0x201a5f(0x109),_0x201a5f(0x12a),_0x201a5f(0xf1),'brl',_0x201a5f(0x14b),'chf',_0x201a5f(0x128),_0x201a5f(0x146),_0x201a5f(0x119),_0x201a5f(0x122),'eur','gbp','gel',_0x201a5f(0x14a),_0x201a5f(0x136),_0x201a5f(0x151),_0x201a5f(0x15b),'inr',_0x201a5f(0x131),_0x201a5f(0x116),_0x201a5f(0x16c),_0x201a5f(0x16b),_0x201a5f(0x10d),_0x201a5f(0x104),'myr',_0x201a5f(0x143),_0x201a5f(0x170),_0x201a5f(0xf0),'php',_0x201a5f(0x12e),_0x201a5f(0x173),_0x201a5f(0x162),_0x201a5f(0x144),_0x201a5f(0x16f),_0x201a5f(0x171),_0x201a5f(0x13b),_0x201a5f(0x156),'twd',_0x201a5f(0x145),_0x201a5f(0x132),_0x201a5f(0xf4),_0x201a5f(0x153),_0x201a5f(0x10e),_0x201a5f(0x164),_0x201a5f(0x14d),_0x201a5f(0x10f),_0x201a5f(0x120)],this[_0x201a5f(0x147)]=null,this[_0x201a5f(0x121)]=0x3,this['startPeriodicUpdates']();}[a38_0x631bf1(0x16a)](){const _0x3c80f7=a38_0x631bf1;this[_0x3c80f7(0x129)]()[_0x3c80f7(0xfe)](_0x5eb361=>{const _0x526fc8=_0x3c80f7;console[_0x526fc8(0x13c)](_0x526fc8(0x107),_0x5eb361);}),this[_0x3c80f7(0x147)]=setInterval(async()=>{const _0x25bad4=_0x3c80f7;try{await this[_0x25bad4(0x129)]();}catch(_0x581864){console[_0x25bad4(0x13c)](_0x25bad4(0x13f),_0x581864);}},0x3c*0x3c*0x3e8),console[_0x3c80f7(0x10a)](_0x3c80f7(0x114));}[a38_0x631bf1(0x11c)](){const _0x1290d5=a38_0x631bf1;this[_0x1290d5(0x147)]&&(clearInterval(this['updateInterval']),this[_0x1290d5(0x147)]=null,console[_0x1290d5(0x10a)]('üõë\x20Currency\x20rates\x20periodic\x20updates\x20stopped'));}async[a38_0x631bf1(0x129)](){const _0x275a59=a38_0x631bf1;try{console['log']('üîÑ\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...');const _0x569bf7=this[_0x275a59(0xf3)][_0x275a59(0x125)](','),_0x5b6e41=this[_0x275a59(0x158)]+_0x275a59(0x149)+_0x569bf7,_0x32138c=await fetch(_0x5b6e41,{'headers':{'Accept':'application/json','User-Agent':_0x275a59(0x15c)}});if(!_0x32138c['ok'])throw new Error(_0x275a59(0x101)+_0x32138c[_0x275a59(0x157)]+'\x20'+_0x32138c[_0x275a59(0x167)]);const _0x1be65e=await _0x32138c[_0x275a59(0x140)]();if(!_0x1be65e[_0x275a59(0xf7)])throw new Error(_0x275a59(0x137));const _0x137a3c=_0x1be65e['tether'];console[_0x275a59(0x10a)](_0x275a59(0x14f)+Object[_0x275a59(0x169)](_0x137a3c)[_0x275a59(0x142)]+_0x275a59(0x133));const _0x1512f6=Object[_0x275a59(0x103)](_0x137a3c)[_0x275a59(0x166)](async([_0x56bcc7,_0x43fa46])=>{const _0x203303=_0x275a59;try{await database_1[_0x203303(0xfb)][_0x203303(0x100)][_0x203303(0x123)]({'where':{'currency':_0x56bcc7[_0x203303(0x12c)]()},'update':{'rate':_0x43fa46},'create':{'currency':_0x56bcc7['toLowerCase'](),'rate':_0x43fa46}});}catch(_0xb7b67e){console[_0x203303(0x13c)](_0x203303(0x113)+_0x56bcc7+':',_0xb7b67e);}});await Promise['allSettled'](_0x1512f6),console[_0x275a59(0x10a)](_0x275a59(0x150));}catch(_0x2494c8){console[_0x275a59(0x13c)](_0x275a59(0xf5),_0x2494c8);throw _0x2494c8;}}async[a38_0x631bf1(0x163)](_0x1651a4){const _0x1a1138=a38_0x631bf1,_0x3953e5=_0x1651a4[_0x1a1138(0x12c)]();if(_0x3953e5===_0x1a1138(0xf6))return 0x1;try{const _0x38ed9f=await database_1['default'][_0x1a1138(0x100)]['findUnique']({'where':{'currency':_0x3953e5}});if(!_0x38ed9f)return console[_0x1a1138(0x13e)](_0x1a1138(0x154)+_0x1651a4+_0x1a1138(0x105)),0x1;return _0x38ed9f[_0x1a1138(0x139)];}catch(_0x337e7a){return console[_0x1a1138(0x13c)]('Error\x20getting\x20rate\x20for\x20currency\x20'+_0x1651a4+':',_0x337e7a),0x1;}}async[a38_0x631bf1(0x161)](_0x2ac58f,_0x56d67f){const _0x88e76d=a38_0x631bf1,_0xbbcc1b=_0x56d67f[_0x88e76d(0x12c)]();if(_0xbbcc1b===_0x88e76d(0xf6)){const _0x3d38bc=_0x2ac58f*(0x1+this[_0x88e76d(0x121)]/0x64);return console[_0x88e76d(0x10a)](_0x88e76d(0x111)+this[_0x88e76d(0x121)]+_0x88e76d(0x15a)+_0x2ac58f+_0x88e76d(0x159)+_0x3d38bc[_0x88e76d(0x10b)](0x6)+_0x88e76d(0x11b)),_0x3d38bc;}try{const _0x424c4e=await this[_0x88e76d(0x163)](_0xbbcc1b),_0x36068c=_0x2ac58f/_0x424c4e,_0xc9e609=_0x36068c*(0x1+this[_0x88e76d(0x121)]/0x64);return console['log']('üí±\x20Converted\x20'+_0x2ac58f+'\x20'+_0x56d67f['toUpperCase']()+_0x88e76d(0xf2)+_0x36068c[_0x88e76d(0x10b)](0x6)+_0x88e76d(0x118)+this[_0x88e76d(0x121)]+_0x88e76d(0x115)+_0xc9e609['toFixed'](0x6)+_0x88e76d(0x14c)+_0x424c4e+')'),_0xc9e609;}catch(_0x34039c){console[_0x88e76d(0x13c)](_0x88e76d(0x15e)+_0x2ac58f+'\x20'+_0x56d67f+_0x88e76d(0x130),_0x34039c);const _0x1fc37b=_0x2ac58f*(0x1+this[_0x88e76d(0x121)]/0x64);return _0x1fc37b;}}async[a38_0x631bf1(0x108)](_0x17830d){const _0x172d37=a38_0x631bf1;let _0x3c9c23=0x0;for(const {amount:_0x34fd0a,currency:_0x935d8f}of _0x17830d){const _0x2f821a=await this[_0x172d37(0x161)](_0x34fd0a,_0x935d8f);_0x3c9c23+=_0x2f821a;}return _0x3c9c23;}async[a38_0x631bf1(0x165)](){const _0x24b67c=a38_0x631bf1;try{const _0x2133b9=await database_1[_0x24b67c(0xfb)][_0x24b67c(0x100)][_0x24b67c(0x112)]({'select':{'currency':!![],'rate':!![]}}),_0x32982e={'usdt':0x1};return _0x2133b9[_0x24b67c(0x141)](_0x574ead=>{const _0x2e5102=_0x24b67c;_0x32982e[_0x574ead[_0x2e5102(0xf9)]]=_0x574ead[_0x2e5102(0x139)];}),_0x32982e;}catch(_0x23d376){return console[_0x24b67c(0x13c)](_0x24b67c(0x10c),_0x23d376),{'usdt':0x1};}}async[a38_0x631bf1(0x12f)](){const _0x178214=a38_0x631bf1;try{const [_0xa85192,_0xb9acf2,_0x204993]=await Promise[_0x178214(0x155)]([database_1[_0x178214(0xfb)][_0x178214(0x100)][_0x178214(0xff)](),database_1[_0x178214(0xfb)][_0x178214(0x100)][_0x178214(0x13a)]({'orderBy':{'updatedAt':_0x178214(0xfc)},'select':{'updatedAt':!![]}}),database_1[_0x178214(0xfb)][_0x178214(0x100)][_0x178214(0x13a)]({'orderBy':{'updatedAt':_0x178214(0x127)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0xa85192,'lastUpdated':_0xb9acf2?.['updatedAt']||null,'oldestRate':_0x204993?.['updatedAt']||null,'markupPercentage':this[_0x178214(0x121)]};}catch(_0x1453d4){return console['error']('Error\x20getting\x20rates\x20status:',_0x1453d4),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x178214(0x121)]};}}[a38_0x631bf1(0x152)](){const _0x18bd73=a38_0x631bf1;return this[_0x18bd73(0x121)];}}exports['CurrencyService']=CurrencyService,exports[a38_0x631bf1(0x16e)]=new CurrencyService();function a38_0x341d(){const _0x1f3dcd=['Periodic\x20currency\x20rates\x20update\x20failed:','json','forEach','length','ngn','sar','uah','cny','updateInterval','btc','?ids=tether&vs_currencies=','hkd','cad','\x20USDT\x20(rate:\x20','xau','12sPprnh','üìä\x20Received\x20rates\x20for\x20','‚úÖ\x20Currency\x20rates\x20updated\x20successfully','idr','getMarkupPercentage','zar','No\x20rate\x20found\x20for\x20currency:\x20','all','try','status','COINGECKO_URL','\x20USDT\x20=\x20','%\x20markup\x20to\x20','ils','TesSoft\x20Payment\x20System/1.0','../config/database','Error\x20converting\x20','10325yUdpOl','9iToCsm','convertToUSDT','rub','getCurrencyRate','xag','getAllRates','map','statusText','27823315sMCYJS','keys','startPeriodicUpdates','lkr','kwd','5HSPjXP','currencyService','sek','nok','sgd','3618612giIwav','pln','usd','nzd','bmd','\x20to\x20','CURRENCIES','vnd','‚ùå\x20Failed\x20to\x20update\x20currency\x20rates:','usdt','tether','https://api.coingecko.com/api/v3/simple/price','currency','171lRLeLF','default','desc','eos','catch','count','currencyRate','CoinGecko\x20API\x20error:\x20','10LFfGXU','entries','mxn',',\x20using\x201\x20as\x20fallback','954618biCxEr','Initial\x20currency\x20rates\x20update\x20failed:','convertMultipleToUSDT','bdt','log','toFixed','Error\x20getting\x20all\x20rates:','mmk','xdr','bits','bch','üí±\x20Applied\x20','findMany','Failed\x20to\x20update\x20rate\x20for\x20','‚úÖ\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates','%\x20markup\x20=\x20','krw','xlm','\x20USDT,\x20with\x20','czk','5622rJnbSn','\x20USDT','stopPeriodicUpdates','link','dot','__importDefault','sats','MARKUP_PERCENTAGE','dkk','upsert','aud','join','9465181OyEcsp','asc','clp','updateCurrencyRates','bhd','xrp','toLowerCase','yfi','pkr','getRatesStatus','\x20to\x20USDT:','jpy','vef','\x20currencies','4828dSLxgq','6115400bZdCLo','huf','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','eth','rate','findFirst','thb','error','aed','warn'];a38_0x341d=function(){return _0x1f3dcd;};return a38_0x341d();}