'use strict';function a81_0x215e(){const _0x137e4=['‚ùå\x20No\x20payment\x20found,\x20checking\x20all\x20payments\x20for\x20debugging...','processNodaWebhook','sendShopWebhook','\x20(Status:\x20','message','KlymeService','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','oxapayService','plisioService','failed','üí∞\x20Removing\x20from\x20balance:\x20','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','amerService','AmPayTRYService','\x20for\x20AmPay\x20webhook','\x20\x20\x20-\x20Payment\x20ID\x20to\x20match:\x20','‚úÖ\x20AmPay\x20TRY\x20webhook\x20processed:\x20Payment\x20','log','klymeService',',\x20Status=','üìà\x20Payment\x20','client_transaction_id','96691uHEpZC','paymentId','WebhookService','MasterCard\x20payment\x20not\x20found:\x20','myxspend_','remitterName','üîÑ\x20Processing\x20CoinToPay\x20webhook:','./currencyService','üîÑ\x20Additional\x20data:','PlisioService','Error\x20processing\x20CoinToPay\x20webhook:','username','myxspend','coinToPay2Service','\x20status\x20updated\x20to\x20FAILED','payment.pending','üí∞\x20Amount\x20after\x20gateway\x20commission:\x20','Missing\x20client_transaction_id\x20in\x20AmPay\x20webhook','updatedAt','\x20for\x20MasterCard\x20webhook,\x20updating\x20status\x20from\x20','‚ùå\x20VISA\x20payment\x20not\x20found\x20for\x20ID:\x20','‚úÖ\x20Shop\x20','createdAt','payment_method','üìà\x20Payment\x20details:\x20oldStatus=\x22','‚ùå\x20No\x20payment\x20ID\x20extracted\x20from\x20MasterCard\x20webhook\x20data','‚ùå\x20Payment\x20not\x20found\x20for\x20Amer\x20webhook\x20with\x20ID:\x20','üìä\x20VISA\x20payment\x20found:\x20','amountUSDT','üîÑ\x20Processing\x20AmPay\x20webhook:','FAILED','üîÑ\x20AmPay\x20TRY\x20status\x20DECLINED\x20mapped\x20to\x20FAILED','./gateways/oxapayService','MASTERCARD','dateTime','additionalInfo','\x20(orderId:\x20','maxpara','No\x20payment\x20ID\x20in\x20Plisio\x20Gateway\x20webhook','cb5d6df763cde0f752ebd71ac606e95ff6b73926abfb4621ad95e99c423a2965d6f153b1647f7dcff315bf65dd749f72dbb40576','‚ùå\x20Error\x20processing\x20MyXSpend\x20webhook:','Found\x20payment\x20','‚ÑπÔ∏è\x20AmPay\x20status\x20','coinToPayService','\x20+\x20','paymentLinkId','MaxParaService','üîç\x20Search\x20result:\x20','gatewaySettings','Error\x20processing\x20MaxPara\x20webhook:','üìä\x20Amer\x20webhook\x20result:','üìä\x20KLYME\x20webhook:\x20Payment\x20','\x20->\x20','No\x20order_id\x20in\x20OxaPay\x20webhook','Query\x20params:','No\x20payment\x20ID\x20in\x20CoinToPay2\x20webhook','Error\x20processing\x20Plisio\x20webhook:','Webhook\x20event\x20','shop','./gateways/mastercardService','findUnique','‚ùå\x20Available\x20webhook\x20fields:','includes','paidAt','5GnOTyL','Payment\x20marked\x20as\x20CHARGEBACK\x20(no\x20penalty\x20specified)','loggerService','oxapay','processAmPayTRYWebhook','./gateways/rapydService','‚úÖ\x20Found\x20payment:\x20ID=','processCoinToPayWebhook','paymentMethod','939680EVHDWr','üí∞\x20Final\x20balance\x20after\x20chargeback:\x20','No\x20payment\x20ID\x20in\x20Noda\x20webhook','‚ÑπÔ∏è\x20MyXSpend\x20status\x20','REFUND','noda','convertToUSDT','\x20-\x20no\x20action\x20taken\x20(only\x20DECLINED\x20is\x20processed)','\x20updated:\x20currentPayments=','./gateways/klymeService','\x20commission:\x20','CoinToPayService','rapyd','Payment\x20not\x20found\x20for\x20CoinToPay\x20webhook:\x20','No\x20payment\x20ID\x20in\x20VISA\x20webhook','nodaService',',\x20gatewayPaymentId:\x20','S8jqtNdiYV1qZTkw1nPB','now','No\x20payment\x20ID\x20in\x20MasterCard\x20webhook','üîç\x20Available\x20VISA/MasterCard\x20payments\x20for\x20debugging:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','processMasterCardWebhook','\x20in\x20shop\x20','MAX_PARA_BASE_URL','‚úÖ\x20Found\x20payment\x20','\x20became\x20PAID\x20via\x20webhook,\x20updating\x20payment\x20link\x20counter','failureMessage','gatewayOrderId',':\x20type=','sendPaymentStatusNotification',',\x20currentPayments=','\x22,\x20newStatus=\x22','currentPayments','üì§\x20Shop\x20webhook\x20sent\x20to\x20','\x20\x20\x20-\x20Gateway:\x20visa/mastercard\x20or\x20mastercard','status','toISOString','Body\x20data:','\x20-\x20','üîÑ\x20updatePaymentStatus\x20called:\x20paymentId=','‚ùå\x20No\x20payment\x20ID\x20extracted\x20from\x20VISA\x20webhook\x20data','‚ùå\x20No\x20payment\x20ID\x20extracted\x20from\x20Amer\x20webhook\x20data','\x22,\x20orderId=\x22','‚ÑπÔ∏è\x20Decline\x20reason:\x20','No\x20payment\x20ID\x20in\x20CoinToPay\x20webhook','getGatewayCommission','bankId','üîÑ\x20Processing\x20AmPay\x20TRY\x20webhook:',',\x20using\x20default\x20commission\x2010%','no\x20balance\x20change','telegramBotService','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','status_addition_info','CoinToPay2Service','‚ùå\x20Payment\x20not\x20found\x20for\x20MyXSpend\x20customerOrderId:\x20','VISA\x20payment\x20not\x20found:\x20','toUpperCase','Not\x20found','üìä\x20Plisio\x20Gateway\x20webhook:\x20Payment\x20','Payment\x20not\x20found','\x20USDT\x20(chargeback\x20penalty\x20ONLY)',',\x20Card=****',',\x20Gateway=','30odyiRy','üîÑ\x20Processing\x20Rapyd\x20webhook:','cardBrand','processOxaPayWebhook','env','‚úÖ\x20Payment\x20link\x20','üîÑ\x20Processing\x20KLYME\x20webhook:','rapydService','\x20\x20\x20-\x20Will\x20search\x20in:\x20gatewayPaymentId,\x20gatewayOrderId,\x20id,\x20orderId','\x20=\x20','payment.success','\x20with\x20status\x20','cointopay','\x22,\x20id=\x22','amer','4xUdIxi','webhookLog','DECLINED','üè™\x20Shop\x20','system_id','visaMasterCardService','payment','remitterIban','payment.failed','üîç\x20MasterCard\x20webhook:\x20Searching\x20for\x20payment\x20with\x20ID:\x20','PAID','gatewayPaymentId','map','update','%\x20gateway\x20commission)','webhookEvents','üìä\x20Noda\x20webhook:\x20Payment\x20',',\x20newStatus=','Error\x20processing\x20Plisio\x20Gateway\x20webhook:','refund','maxParaService','üìä\x20MaxPara\x20webhook:\x20Payment\x20','SINGLE','MAX_PARA_API_KEY','keys','Payment\x20System/1.0','\x20status\x20change\x20does\x20not\x20trigger\x20payment\x20link\x20counter\x20update:\x20','üîç\x20Trying\x20to\x20find\x20VISA\x20payment\x20by\x20various\x20fields...','amount','üîÑ\x20MyXSpend\x20status\x20','visa/mastercard','chargeback','\x20current\x20balance:\x20','‚ÑπÔ∏è\x20AmPay\x20TRY\x20status\x20','Payment\x20','üí∞\x20Gateway\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20commission\x20for\x20shop\x20','\x20‚Üí\x20','default','‚ùå\x20No\x20client_transaction_id\x20found\x20in\x20AmPay\x20TRY\x20webhook','\x20not\x20found','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','ampay_try_','gateway','customerEmail','‚ùå\x20VISA\x20payment\x20failed\x20with\x20message:\x20','currencyService','COMPLETED','getPaymentStatusFromCallback','./telegramBotService','634221vundpi','‚ùå\x20Payment\x20not\x20found\x20for\x20AmPay\x20TRY\x20client_transaction_id:\x20','üîç\x20Found\x20VISA\x20payment:\x20ID=','cardLast4','\x20for\x20MyXSpend\x20webhook','\x20for\x20AmPay\x20TRY\x20webhook','Error\x20processing\x20KLYME\x20webhook:','type','errorMessage','text','IBAN','1108629lREbjB','balance','üìà\x20Found\x20payment\x20link\x20','push','plisio','EXPIRED','orderId','3047676asAKYm','logWebhookProcessed','https://maxpara.co','Payment\x20not\x20found:\x20','webhookUrl','./gateways/plisioService','üìä\x20VISA\x20webhook\x20result:','\x20mapped\x20to\x20FAILED','./gateways/maxParaService','created','toFixed','üìä\x20Rapyd\x20webhook:\x20Payment\x20','NodaService','cointopay2','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','klyme','üîç\x20Searching\x20for\x20VISA\x20payment\x20with\x20the\x20following\x20criteria:','CHARGEBACK','‚úÖ\x20MyXSpend\x20webhook\x20processed:\x20Payment\x20',',\x20using\x20default\x2010%','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction',',\x20GatewayPaymentId=','Payment\x20not\x20found\x20for\x20Rapyd\x20webhook:\x20','defineProperty','‚ùå\x20Error\x20processing\x20MasterCard\x20webhook:','paid','üí≥\x20Card\x20brand\x20detected:\x20','error','create','558876yyugUL','currency','chargebackAmount','shopId','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','2096968AydwaM',',\x20gatewayOrderId:\x20','No\x20payment\x20ID\x20in\x20KLYME\x20webhook','Bank\x20Card','findFirst','__esModule','üîÑ\x20Processing\x20OxaPay\x20webhook:','isArray','__importDefault','logWebhookError','mastercard','customerOrderId','length','unknown','processWebhook','Open\x20Banking','üìä\x20CoinToPay2\x20webhook:\x20Payment\x20','stringify','toLowerCase','visa_mastercard','txUrls','üìù\x20Reason:\x20','Payment\x20not\x20found\x20for\x20KLYME\x20webhook:\x20','Payment\x20not\x20found\x20for\x20MaxPara\x20webhook:\x20','../config/database','üìä\x20AmPay\x20TRY\x20webhook\x20data:','desc','POST','ampay_try','Missing\x20customerOrderId\x20in\x20MyXSpend\x20webhook','$transaction','tx_hash','\x20USDT\x20(payment\x20became\x20PAID,\x20after\x20','üí∞\x20Payment\x20','‚ùå\x20Failed\x20to\x20update\x20payment\x20link\x20counter:','ms)','parse','üìä\x20OxaPay\x20webhook:\x20Payment\x20','processKlymeWebhook','commission','./gateways/ampayTRYService','paymentLink','\x20balance\x20updated:\x20','updatePaymentStatus','processVisaWebhook','ampay','AmPayService',',\x20gateway\x20','Missing\x20client_transaction_id\x20in\x20AmPay\x20TRY\x20webhook','VisaMasterCardService','No\x20payment\x20ID\x20in\x20Amer\x20webhook','‚ùå\x20No\x20client_transaction_id\x20found\x20in\x20AmPay\x20webhook','üìä\x20Payment\x20status:\x20','üîÑ\x20Processing\x20Plisio\x20webhook:','No\x20additional\x20info','Payment\x20not\x20found\x20for\x20Plisio\x20Gateway\x20webhook:\x20','entries','\x20USDT','Error\x20processing\x20OxaPay\x20webhook:','plisio_gateway','amountAfterGatewayCommissionUSDT','system','settings','‚ùå\x20Error\x20processing\x20Amer\x20webhook:','üîç\x20VISA\x20payment\x20search\x20executed','sendPaymentNotification','üîÑ\x20Processing\x20Noda\x20webhook:','./gateways/coinToPayService','\x20to\x20','AmerService','ampayService','processMaxParaWebhook','findMany','‚úÖ\x20AmPay\x20webhook\x20processed:\x20Payment\x20','webhook_status_change_','expired','\x20status\x20'];a81_0x215e=function(){return _0x137e4;};return a81_0x215e();}const a81_0x598ab2=a81_0x31f7;(function(_0x149b04,_0x51e99e){const _0x57785f=a81_0x31f7,_0x4f3954=_0x149b04();while(!![]){try{const _0x571264=parseInt(_0x57785f(0x16b))/0x1*(-parseInt(_0x57785f(0x203))/0x2)+-parseInt(_0x57785f(0x265))/0x3+-parseInt(_0x57785f(0x26a))/0x4*(-parseInt(_0x57785f(0x1ab))/0x5)+parseInt(_0x57785f(0x248))/0x6+-parseInt(_0x57785f(0x236))/0x7+parseInt(_0x57785f(0x1b4))/0x8+-parseInt(_0x57785f(0x241))/0x9*(parseInt(_0x57785f(0x1f4))/0xa);if(_0x571264===_0x51e99e)break;else _0x4f3954['push'](_0x4f3954['shift']());}catch(_0x56b1eb){_0x4f3954['push'](_0x4f3954['shift']());}}}(a81_0x215e,0x4ba44));var __importDefault=this&&this[a81_0x598ab2(0x272)]||function(_0x1c0f16){const _0x3b3827=a81_0x598ab2;return _0x1c0f16&&_0x1c0f16[_0x3b3827(0x26f)]?_0x1c0f16:{'default':_0x1c0f16};};Object[a81_0x598ab2(0x25f)](exports,a81_0x598ab2(0x26f),{'value':!![]}),exports[a81_0x598ab2(0x16d)]=void 0x0;function a81_0x31f7(_0x147f27,_0x46ac21){_0x147f27=_0x147f27-0x157;const _0x215e5c=a81_0x215e();let _0x31f74d=_0x215e5c[_0x147f27];return _0x31f74d;}const database_1=__importDefault(require(a81_0x598ab2(0x282))),plisioService_1=require(a81_0x598ab2(0x24d)),rapydService_1=require(a81_0x598ab2(0x1b0)),nodaService_1=require('./gateways/nodaService'),coinToPayService_1=require(a81_0x598ab2(0x2ad)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),klymeService_1=require(a81_0x598ab2(0x1bd)),mastercardService_1=require(a81_0x598ab2(0x1a6)),amerService_1=require('./gateways/amerService'),ampayService_1=require('./gateways/ampayService'),ampayTRYService_1=require(a81_0x598ab2(0x292)),maxParaService_1=require(a81_0x598ab2(0x250)),oxapayService_1=require(a81_0x598ab2(0x18b)),telegramBotService_1=require(a81_0x598ab2(0x235)),currencyService_1=require(a81_0x598ab2(0x172)),loggerService_1=require('./loggerService');class WebhookService{constructor(){const _0x4edc91=a81_0x598ab2;this[_0x4edc91(0x15d)]=new plisioService_1[(_0x4edc91(0x174))](),this[_0x4edc91(0x1fb)]=new rapydService_1['RapydService'](),this[_0x4edc91(0x1c3)]=new nodaService_1[(_0x4edc91(0x254))](),this[_0x4edc91(0x196)]=new coinToPayService_1[(_0x4edc91(0x1bf))](),this[_0x4edc91(0x178)]=new coinToPay2Service_1[(_0x4edc91(0x1ea))](),this[_0x4edc91(0x167)]=new klymeService_1[(_0x4edc91(0x15a))](),this[_0x4edc91(0x208)]=new mastercardService_1[(_0x4edc91(0x29b))](),this[_0x4edc91(0x161)]=new amerService_1[(_0x4edc91(0x2af))](),this[_0x4edc91(0x2b0)]=new ampayService_1[(_0x4edc91(0x298))](),this['ampayTRYService']=new ampayTRYService_1[(_0x4edc91(0x162))](),this[_0x4edc91(0x217)]=new maxParaService_1[(_0x4edc91(0x199))]({'apiKey':process[_0x4edc91(0x1f8)][_0x4edc91(0x21a)]||_0x4edc91(0x192),'secretKey':process[_0x4edc91(0x1f8)]['MAX_PARA_SECRET_KEY']||_0x4edc91(0x1c5),'baseUrl':process['env'][_0x4edc91(0x1cc)]||_0x4edc91(0x24a)}),this[_0x4edc91(0x15c)]=new oxapayService_1['OxaPayService']();}async[a81_0x598ab2(0x295)](_0x1e91c7,_0x1c94cf,_0x3378bd){const _0x4c8db5=a81_0x598ab2;console[_0x4c8db5(0x166)](_0x4c8db5(0x1dc)+_0x1e91c7+_0x4c8db5(0x214)+_0x1c94cf),console[_0x4c8db5(0x166)](_0x4c8db5(0x173),_0x3378bd),await database_1['default'][_0x4c8db5(0x288)](async _0x47435c=>{const _0x661298=_0x4c8db5,_0x157059=await _0x47435c[_0x661298(0x209)][_0x661298(0x1a7)]({'where':{'id':_0x1e91c7},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x157059)throw new Error(_0x661298(0x225)+_0x1e91c7+_0x661298(0x22c));const _0x56f216=_0x157059['status'],_0x456ec3=_0x157059[_0x661298(0x1a5)];console[_0x661298(0x166)](_0x661298(0x28b)+_0x1e91c7+':\x20'+_0x56f216+_0x661298(0x19f)+_0x1c94cf),console[_0x661298(0x166)](_0x661298(0x206)+_0x456ec3[_0x661298(0x176)]+_0x661298(0x223)+_0x456ec3[_0x661298(0x242)]+'\x20USDT');const _0x4ae9b3={'status':_0x1c94cf[_0x661298(0x1ed)](),'updatedAt':new Date(),'statusChangedBy':_0x661298(0x2a7),'statusChangedAt':new Date()};_0x3378bd?.['failureMessage']&&(_0x4ae9b3[_0x661298(0x1cf)]=_0x3378bd[_0x661298(0x1cf)]);_0x3378bd?.[_0x661298(0x27e)]&&(_0x4ae9b3['txUrls']=JSON['stringify'](_0x3378bd[_0x661298(0x27e)]));_0x3378bd?.[_0x661298(0x239)]&&(_0x4ae9b3['cardLast4']=_0x3378bd['cardLast4']);_0x3378bd?.[_0x661298(0x1f6)]&&(_0x4ae9b3['cardBrand']=_0x3378bd[_0x661298(0x1f6)]);_0x3378bd?.[_0x661298(0x1b3)]&&(_0x4ae9b3[_0x661298(0x1b3)]=_0x3378bd[_0x661298(0x1b3)]);_0x3378bd?.[_0x661298(0x1e3)]&&(_0x4ae9b3[_0x661298(0x1e3)]=_0x3378bd[_0x661298(0x1e3)]);_0x3378bd?.[_0x661298(0x20a)]&&(_0x4ae9b3[_0x661298(0x20a)]=_0x3378bd[_0x661298(0x20a)]);_0x3378bd?.[_0x661298(0x170)]&&(_0x4ae9b3[_0x661298(0x170)]=_0x3378bd['remitterName']);let _0x54d515=_0x456ec3[_0x661298(0x242)],_0x417800='';if(_0x1c94cf[_0x661298(0x1ed)]()===_0x661298(0x20d)&&_0x56f216!==_0x661298(0x20d)){const _0x594f09=await currencyService_1[_0x661298(0x232)][_0x661298(0x1ba)](_0x157059[_0x661298(0x21f)],_0x157059[_0x661298(0x266)]),_0x5ef559=await this[_0x661298(0x1e2)](_0x456ec3['id'],_0x157059[_0x661298(0x22f)]),_0x2c3aaa=_0x594f09*(0x1-_0x5ef559/0x64);_0x54d515+=_0x2c3aaa,_0x417800='+'+_0x2c3aaa[_0x661298(0x252)](0x6)+_0x661298(0x28a)+_0x5ef559+_0x661298(0x211),_0x4ae9b3['amountUSDT']=_0x594f09,_0x4ae9b3[_0x661298(0x2a6)]=_0x2c3aaa,_0x4ae9b3['gatewayCommissionRate']=_0x5ef559,_0x4ae9b3[_0x661298(0x1aa)]=new Date(),console[_0x661298(0x166)]('üí∞\x20Converting\x20'+_0x157059[_0x661298(0x21f)]+'\x20'+_0x157059[_0x661298(0x266)]+'\x20->\x20'+_0x594f09[_0x661298(0x252)](0x6)+_0x661298(0x2a3)),console[_0x661298(0x166)](_0x661298(0x226)+_0x157059['gateway']+_0x661298(0x1be)+_0x5ef559+'%'),console['log'](_0x661298(0x17b)+_0x2c3aaa[_0x661298(0x252)](0x6)+_0x661298(0x2a3)),console['log']('üí∞\x20Adding\x20to\x20balance:\x20'+_0x456ec3['balance']+_0x661298(0x197)+_0x2c3aaa['toFixed'](0x6)+_0x661298(0x1fd)+_0x54d515['toFixed'](0x6)+_0x661298(0x2a3));}else{if(_0x56f216===_0x661298(0x20d)&&_0x1c94cf[_0x661298(0x1ed)]()!==_0x661298(0x20d)&&_0x1c94cf[_0x661298(0x1ed)]()!==_0x661298(0x259)){let _0x18714f;if(_0x157059[_0x661298(0x2a6)])_0x18714f=_0x157059['amountAfterGatewayCommissionUSDT'];else{if(_0x157059[_0x661298(0x187)]){const _0x261b59=await this[_0x661298(0x1e2)](_0x456ec3['id'],_0x157059[_0x661298(0x22f)]);_0x18714f=_0x157059[_0x661298(0x187)]*(0x1-_0x261b59/0x64);}else console[_0x661298(0x166)]('No\x20amountUSDT\x20found\x20for\x20payment,\x20nothing\x20to\x20remove\x20from\x20balance'),_0x18714f=0x0;}_0x18714f>0x0&&(_0x54d515-=_0x18714f,_0x417800='-'+_0x18714f[_0x661298(0x252)](0x6)+'\x20USDT\x20(payment\x20no\x20longer\x20PAID)',_0x4ae9b3[_0x661298(0x1aa)]=null,console[_0x661298(0x166)](_0x661298(0x15f)+_0x456ec3[_0x661298(0x242)]+_0x661298(0x1db)+_0x18714f[_0x661298(0x252)](0x6)+_0x661298(0x1fd)+_0x54d515[_0x661298(0x252)](0x6)+_0x661298(0x2a3)));}}if(_0x1c94cf[_0x661298(0x1ed)]()===_0x661298(0x259)){const _0x47ce01=_0x3378bd?.[_0x661298(0x267)]||0x0;console[_0x661298(0x166)](_0x661298(0x25c)),_0x47ce01>0x0?(_0x54d515-=_0x47ce01,_0x417800='-'+_0x47ce01[_0x661298(0x252)](0x6)+_0x661298(0x1f1),_0x4ae9b3[_0x661298(0x267)]=_0x47ce01,console[_0x661298(0x166)](_0x661298(0x160)+_0x47ce01[_0x661298(0x252)](0x6)+'\x20USDT'),console[_0x661298(0x166)](_0x661298(0x22d)),console[_0x661298(0x166)](_0x661298(0x1b5)+_0x54d515['toFixed'](0x6)+_0x661298(0x2a3))):(console[_0x661298(0x166)](_0x661298(0x1e8)),_0x417800=_0x661298(0x1ac));}const _0x54082f=await _0x47435c['payment'][_0x661298(0x210)]({'where':{'id':_0x1e91c7},'data':_0x4ae9b3});_0x54d515!==_0x456ec3[_0x661298(0x242)]&&(await _0x47435c[_0x661298(0x1a5)]['update']({'where':{'id':_0x456ec3['id']},'data':{'balance':_0x54d515}}),console['log'](_0x661298(0x180)+_0x456ec3[_0x661298(0x176)]+_0x661298(0x294)+_0x456ec3[_0x661298(0x242)]['toFixed'](0x6)+_0x661298(0x19f)+_0x54d515[_0x661298(0x252)](0x6)+_0x661298(0x2a3)),console[_0x661298(0x166)](_0x661298(0x27f)+_0x417800));await _0x47435c[_0x661298(0x204)]['create']({'data':{'paymentId':_0x1e91c7,'shopId':_0x456ec3['id'],'event':_0x661298(0x2b4)+_0x1c94cf['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x661298(0x27b)]({'oldStatus':_0x56f216,'newStatus':_0x1c94cf[_0x661298(0x1ed)](),'balanceChange':_0x417800||_0x661298(0x1e6),'oldBalance':_0x456ec3[_0x661298(0x242)],'newBalance':_0x54d515,'amountUSDT':_0x4ae9b3[_0x661298(0x187)],'additionalData':_0x3378bd,'timestamp':new Date()[_0x661298(0x1d9)]()})}}),await this[_0x661298(0x157)]({..._0x157059,..._0x54082f,'shop':_0x456ec3},_0x1c94cf[_0x661298(0x1ed)]()),await this[_0x661298(0x1d2)]({..._0x157059,..._0x54082f},_0x1c94cf[_0x661298(0x1ed)]());if(_0x56f216!=='PAID'&&_0x1c94cf[_0x661298(0x1ed)]()===_0x661298(0x20d)){console['log']('üìà\x20Payment\x20'+_0x1e91c7+_0x661298(0x1ce)),console[_0x661298(0x166)](_0x661298(0x183)+_0x56f216+_0x661298(0x1d4)+_0x1c94cf[_0x661298(0x1ed)]()+'\x22,\x20paymentLinkId=\x22'+_0x157059[_0x661298(0x198)]+'\x22');if(_0x157059[_0x661298(0x198)])try{const _0x78c0ac=await _0x47435c[_0x661298(0x293)][_0x661298(0x1a7)]({'where':{'id':_0x157059[_0x661298(0x198)]},'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}});if(_0x78c0ac){console[_0x661298(0x166)](_0x661298(0x243)+_0x78c0ac['id']+_0x661298(0x1d1)+_0x78c0ac[_0x661298(0x23d)]+_0x661298(0x1d3)+_0x78c0ac[_0x661298(0x1d5)]+',\x20status='+_0x78c0ac['status']);const _0x26204f=_0x78c0ac['currentPayments']+0x1,_0x2bbf06=_0x78c0ac['type']===_0x661298(0x219)?_0x661298(0x233):_0x78c0ac[_0x661298(0x1d8)];await _0x47435c['paymentLink']['update']({'where':{'id':_0x157059[_0x661298(0x198)]},'data':{'currentPayments':_0x26204f,'status':_0x2bbf06,'updatedAt':new Date()}}),console[_0x661298(0x166)](_0x661298(0x1f9)+_0x78c0ac['id']+_0x661298(0x1bc)+_0x78c0ac[_0x661298(0x1d5)]+_0x661298(0x19f)+_0x26204f+',\x20status='+_0x78c0ac[_0x661298(0x1d8)]+_0x661298(0x19f)+_0x2bbf06);}else console[_0x661298(0x166)]('‚ùå\x20Payment\x20link\x20'+_0x157059[_0x661298(0x198)]+_0x661298(0x22c));}catch(_0x5ad5a3){console[_0x661298(0x263)](_0x661298(0x28c),_0x5ad5a3);}else console[_0x661298(0x166)](_0x661298(0x169)+_0x1e91c7+_0x661298(0x15b));}else console[_0x661298(0x166)](_0x661298(0x169)+_0x1e91c7+_0x661298(0x21d)+_0x56f216+'\x20->\x20'+_0x1c94cf[_0x661298(0x1ed)]());});}async['processPlisioWebhook'](_0x580844){const _0x58fd15=a81_0x598ab2;console['log'](_0x58fd15(0x29f),_0x580844);try{const _0x1ac61b=await this[_0x58fd15(0x15d)][_0x58fd15(0x278)](_0x580844);if(!_0x1ac61b['paymentId'])throw new Error('No\x20payment\x20ID\x20in\x20Plisio\x20webhook');const _0x1dd114=await database_1[_0x58fd15(0x22a)][_0x58fd15(0x209)]['findFirst']({'where':{'gatewayOrderId':_0x1ac61b[_0x58fd15(0x16c)]}});if(!_0x1dd114){console[_0x58fd15(0x263)]('Payment\x20not\x20found\x20for\x20Plisio\x20webhook:\x20'+_0x1ac61b['paymentId']);return;}console[_0x58fd15(0x166)]('üìä\x20Plisio\x20webhook:\x20Payment\x20'+_0x1dd114['id']+_0x58fd15(0x2b6)+_0x1ac61b[_0x58fd15(0x1d8)]),await this[_0x58fd15(0x295)](_0x1dd114['id'],_0x1ac61b[_0x58fd15(0x1d8)],{'txUrls':_0x1ac61b[_0x58fd15(0x27e)]}),loggerService_1['loggerService'][_0x58fd15(0x249)](_0x58fd15(0x245),_0x1dd114['id'],_0x1dd114[_0x58fd15(0x1d8)],_0x1ac61b['status'],_0x580844);}catch(_0x42d114){console[_0x58fd15(0x263)](_0x58fd15(0x1a3),_0x42d114),loggerService_1['loggerService']['logWebhookError'](_0x58fd15(0x245),_0x42d114,_0x580844);throw _0x42d114;}}async['processPlisioGatewayWebhook'](_0x125541){const _0xf3b511=a81_0x598ab2;console[_0xf3b511(0x166)]('üîÑ\x20Processing\x20Plisio\x20Gateway\x20webhook:',_0x125541);try{const _0x2cfedc=await this['plisioService'][_0xf3b511(0x278)](_0x125541);if(!_0x2cfedc[_0xf3b511(0x16c)])throw new Error(_0xf3b511(0x191));const _0x3020b0=await database_1['default'][_0xf3b511(0x209)]['findFirst']({'where':{'gatewayOrderId':_0x2cfedc[_0xf3b511(0x16c)]}});if(!_0x3020b0){console[_0xf3b511(0x263)](_0xf3b511(0x2a1)+_0x2cfedc['paymentId']);return;}console['log'](_0xf3b511(0x1ef)+_0x3020b0['id']+_0xf3b511(0x2b6)+_0x2cfedc[_0xf3b511(0x1d8)]),await this['updatePaymentStatus'](_0x3020b0['id'],_0x2cfedc[_0xf3b511(0x1d8)],{'txUrls':_0x2cfedc[_0xf3b511(0x27e)]}),loggerService_1['loggerService'][_0xf3b511(0x249)](_0xf3b511(0x2a5),_0x3020b0['id'],_0x3020b0[_0xf3b511(0x1d8)],_0x2cfedc[_0xf3b511(0x1d8)],_0x125541);}catch(_0x426d56){console[_0xf3b511(0x263)](_0xf3b511(0x215),_0x426d56),loggerService_1['loggerService'][_0xf3b511(0x273)](_0xf3b511(0x2a5),_0x426d56,_0x125541);throw _0x426d56;}}async['processRapydWebhook'](_0x1d92d6){const _0x27a4a0=a81_0x598ab2;console[_0x27a4a0(0x166)](_0x27a4a0(0x1f5),_0x1d92d6);try{const _0x39d99a=await this['rapydService'][_0x27a4a0(0x278)](_0x1d92d6);if(!_0x39d99a['paymentId'])throw new Error('No\x20payment\x20ID\x20in\x20Rapyd\x20webhook');const _0x37ec37=await database_1['default'][_0x27a4a0(0x209)][_0x27a4a0(0x26e)]({'where':{'gatewayOrderId':_0x39d99a[_0x27a4a0(0x16c)]}});if(!_0x37ec37){console[_0x27a4a0(0x263)](_0x27a4a0(0x25e)+_0x39d99a[_0x27a4a0(0x16c)]);return;}console['log'](_0x27a4a0(0x253)+_0x37ec37['id']+_0x27a4a0(0x2b6)+_0x39d99a['status']),await this[_0x27a4a0(0x295)](_0x37ec37['id'],_0x39d99a[_0x27a4a0(0x1d8)],{'failureMessage':_0x39d99a[_0x27a4a0(0x1cf)],'cardLast4':_0x39d99a[_0x27a4a0(0x18e)]?.['cardLast4'],'cardBrand':_0x39d99a[_0x27a4a0(0x18e)]?.[_0x27a4a0(0x1f6)],'paymentMethod':_0x39d99a['additionalInfo']?.[_0x27a4a0(0x1b3)]}),loggerService_1['loggerService'][_0x27a4a0(0x249)](_0x27a4a0(0x1c0),_0x37ec37['id'],_0x37ec37[_0x27a4a0(0x1d8)],_0x39d99a['status'],_0x1d92d6);}catch(_0x4d279b){console[_0x27a4a0(0x263)]('Error\x20processing\x20Rapyd\x20webhook:',_0x4d279b),loggerService_1[_0x27a4a0(0x1ad)][_0x27a4a0(0x273)](_0x27a4a0(0x1c0),_0x4d279b,_0x1d92d6);throw _0x4d279b;}}async[a81_0x598ab2(0x2b8)](_0x4379bb){const _0x3db99c=a81_0x598ab2;console['log'](_0x3db99c(0x2ac),_0x4379bb);try{const _0x4c5711=await this[_0x3db99c(0x1c3)]['processWebhook'](_0x4379bb);if(!_0x4c5711[_0x3db99c(0x16c)])throw new Error(_0x3db99c(0x1b6));const _0x2f7f03=await database_1['default']['payment'][_0x3db99c(0x26e)]({'where':{'gatewayOrderId':_0x4c5711[_0x3db99c(0x16c)]}});if(!_0x2f7f03){console['error']('Payment\x20not\x20found\x20for\x20Noda\x20webhook:\x20'+_0x4c5711[_0x3db99c(0x16c)]);return;}console['log'](_0x3db99c(0x213)+_0x2f7f03['id']+_0x3db99c(0x2b6)+_0x4c5711[_0x3db99c(0x1d8)]),await this[_0x3db99c(0x295)](_0x2f7f03['id'],_0x4c5711['status'],{'bankId':_0x4c5711['additionalInfo']?.['bankId'],'remitterIban':_0x4c5711[_0x3db99c(0x18e)]?.[_0x3db99c(0x20a)],'remitterName':_0x4c5711[_0x3db99c(0x18e)]?.[_0x3db99c(0x170)],'paymentMethod':'Open\x20Banking'}),loggerService_1[_0x3db99c(0x1ad)][_0x3db99c(0x249)](_0x3db99c(0x1b9),_0x2f7f03['id'],_0x2f7f03['status'],_0x4c5711[_0x3db99c(0x1d8)],_0x4379bb);}catch(_0xe97c4e){console['error']('Error\x20processing\x20Noda\x20webhook:',_0xe97c4e),loggerService_1[_0x3db99c(0x1ad)][_0x3db99c(0x273)](_0x3db99c(0x1b9),_0xe97c4e,_0x4379bb);throw _0xe97c4e;}}async[a81_0x598ab2(0x1b2)](_0x280862){const _0xef27af=a81_0x598ab2;console[_0xef27af(0x166)](_0xef27af(0x171),_0x280862);try{const _0x2c2df5=await this[_0xef27af(0x196)][_0xef27af(0x278)](_0x280862);if(!_0x2c2df5[_0xef27af(0x16c)])throw new Error(_0xef27af(0x1e1));const _0x128bf0=await database_1['default'][_0xef27af(0x209)][_0xef27af(0x26e)]({'where':{'gatewayOrderId':_0x2c2df5[_0xef27af(0x16c)]}});if(!_0x128bf0){console['error'](_0xef27af(0x1c1)+_0x2c2df5['paymentId']);return;}console[_0xef27af(0x166)]('üìä\x20CoinToPay\x20webhook:\x20Payment\x20'+_0x128bf0['id']+_0xef27af(0x2b6)+_0x2c2df5['status']),await this[_0xef27af(0x295)](_0x128bf0['id'],_0x2c2df5[_0xef27af(0x1d8)],{'paymentMethod':'Open\x20Banking'}),loggerService_1['loggerService'][_0xef27af(0x249)]('cointopay',_0x128bf0['id'],_0x128bf0[_0xef27af(0x1d8)],_0x2c2df5[_0xef27af(0x1d8)],_0x280862);}catch(_0x15d8f4){console[_0xef27af(0x263)](_0xef27af(0x175),_0x15d8f4),loggerService_1[_0xef27af(0x1ad)][_0xef27af(0x273)](_0xef27af(0x200),_0x15d8f4,_0x280862);throw _0x15d8f4;}}async['processCoinToPay2Webhook'](_0x5dcb9f){const _0x1897be=a81_0x598ab2;console[_0x1897be(0x166)]('üîÑ\x20Processing\x20CoinToPay2\x20webhook:',_0x5dcb9f);try{const _0x18b107=await this['coinToPay2Service']['processWebhook'](_0x5dcb9f);if(!_0x18b107[_0x1897be(0x16c)])throw new Error(_0x1897be(0x1a2));const _0x4cff7e=await database_1[_0x1897be(0x22a)][_0x1897be(0x209)][_0x1897be(0x26e)]({'where':{'gatewayOrderId':_0x18b107[_0x1897be(0x16c)]}});if(!_0x4cff7e){console[_0x1897be(0x263)]('Payment\x20not\x20found\x20for\x20CoinToPay2\x20webhook:\x20'+_0x18b107[_0x1897be(0x16c)]);return;}console[_0x1897be(0x166)](_0x1897be(0x27a)+_0x4cff7e['id']+'\x20status\x20'+_0x18b107[_0x1897be(0x1d8)]),await this['updatePaymentStatus'](_0x4cff7e['id'],_0x18b107['status'],{'paymentMethod':_0x1897be(0x279)}),loggerService_1[_0x1897be(0x1ad)][_0x1897be(0x249)](_0x1897be(0x255),_0x4cff7e['id'],_0x4cff7e['status'],_0x18b107['status'],_0x5dcb9f);}catch(_0x1ce3fb){console[_0x1897be(0x263)]('Error\x20processing\x20CoinToPay2\x20webhook:',_0x1ce3fb),loggerService_1['loggerService'][_0x1897be(0x273)](_0x1897be(0x255),_0x1ce3fb,_0x5dcb9f);throw _0x1ce3fb;}}async[a81_0x598ab2(0x290)](_0x1baf53){const _0x1ff748=a81_0x598ab2;console[_0x1ff748(0x166)](_0x1ff748(0x1fa),_0x1baf53);try{const _0x16bc29=await this[_0x1ff748(0x167)][_0x1ff748(0x278)](_0x1baf53);if(!_0x16bc29[_0x1ff748(0x16c)])throw new Error(_0x1ff748(0x26c));const _0x533b30=await database_1[_0x1ff748(0x22a)][_0x1ff748(0x209)][_0x1ff748(0x26e)]({'where':{'gatewayOrderId':_0x16bc29['paymentId']}});if(!_0x533b30){console[_0x1ff748(0x263)](_0x1ff748(0x280)+_0x16bc29[_0x1ff748(0x16c)]);return;}console['log'](_0x1ff748(0x19e)+_0x533b30['id']+_0x1ff748(0x2b6)+_0x16bc29[_0x1ff748(0x1d8)]),await this[_0x1ff748(0x295)](_0x533b30['id'],_0x16bc29[_0x1ff748(0x1d8)],{'paymentMethod':_0x16bc29['additionalInfo']?.[_0x1ff748(0x182)]}),loggerService_1[_0x1ff748(0x1ad)]['logWebhookProcessed'](_0x1ff748(0x257),_0x533b30['id'],_0x533b30[_0x1ff748(0x1d8)],_0x16bc29[_0x1ff748(0x1d8)],_0x1baf53);}catch(_0xf09d2f){console[_0x1ff748(0x263)](_0x1ff748(0x23c),_0xf09d2f),loggerService_1['loggerService'][_0x1ff748(0x273)](_0x1ff748(0x257),_0xf09d2f,_0x1baf53);throw _0xf09d2f;}}async[a81_0x598ab2(0x296)](_0x4e7805){const _0x38fb26=a81_0x598ab2;console[_0x38fb26(0x166)]('üîÑ\x20Processing\x20VISA\x20webhook:',JSON[_0x38fb26(0x27b)](_0x4e7805,null,0x2));try{const _0x1a8eb5=await this['visaMasterCardService'][_0x38fb26(0x278)](_0x4e7805,'VISA');console['log'](_0x38fb26(0x24e),_0x1a8eb5);if(!_0x1a8eb5['paymentId']){console[_0x38fb26(0x263)](_0x38fb26(0x1dd)),console[_0x38fb26(0x263)]('‚ùå\x20Available\x20webhook\x20fields:',Object['keys'](_0x4e7805));throw new Error(_0x38fb26(0x1c2));}let _0x1ac8ea=null;console['log']('üîç\x20VISA\x20webhook:\x20Searching\x20for\x20payment\x20with\x20ID:\x20'+_0x1a8eb5[_0x38fb26(0x16c)]);if(_0x1a8eb5[_0x38fb26(0x16c)]){console[_0x38fb26(0x166)](_0x38fb26(0x21e)),console[_0x38fb26(0x166)](_0x38fb26(0x258)),console[_0x38fb26(0x166)](_0x38fb26(0x1d7)),console[_0x38fb26(0x166)](_0x38fb26(0x164)+_0x1a8eb5['paymentId']),console[_0x38fb26(0x166)](_0x38fb26(0x1fc)),_0x1ac8ea=await database_1[_0x38fb26(0x22a)][_0x38fb26(0x209)][_0x38fb26(0x26e)]({'where':{'AND':[{'OR':[{'gateway':_0x38fb26(0x221)},{'gateway':_0x38fb26(0x274)}]},{'OR':[{'gatewayPaymentId':_0x1a8eb5['paymentId']},{'gatewayOrderId':_0x1a8eb5[_0x38fb26(0x16c)]},{'id':_0x1a8eb5[_0x38fb26(0x16c)]},{'orderId':_0x1a8eb5[_0x38fb26(0x16c)]}]}]},'include':{'shop':{'include':{'settings':!![]}}}}),console[_0x38fb26(0x166)](_0x38fb26(0x2aa));if(_0x1ac8ea)console[_0x38fb26(0x166)](_0x38fb26(0x1b1)+_0x1ac8ea['id']+',\x20GatewayOrderId='+_0x1ac8ea[_0x38fb26(0x1d0)]+_0x38fb26(0x25d)+_0x1ac8ea[_0x38fb26(0x20e)]);else{console[_0x38fb26(0x166)](_0x38fb26(0x2b7));const _0x57bc39=await database_1['default'][_0x38fb26(0x209)]['findMany']({'where':{'gateway':_0x38fb26(0x221)},'select':{'id':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'orderId':!![],'cardLast4':!![],'status':!![]},'take':0xa,'orderBy':{'createdAt':_0x38fb26(0x284)}});console[_0x38fb26(0x166)]('üîç\x20Recent\x20visa/mastercard\x20payments\x20for\x20debugging:',_0x57bc39[_0x38fb26(0x20f)](_0x17d723=>_0x17d723['id']+_0x38fb26(0x18f)+_0x17d723[_0x38fb26(0x247)]+_0x38fb26(0x26b)+_0x17d723[_0x38fb26(0x1d0)]+_0x38fb26(0x1c4)+_0x17d723[_0x38fb26(0x20e)]+',\x20card:\x20****'+_0x17d723[_0x38fb26(0x239)]+')'));}console[_0x38fb26(0x166)]('üîç\x20VISA\x20payment\x20search\x20result:\x20'+(_0x1ac8ea?'Found':_0x38fb26(0x1ee))),_0x1ac8ea&&console[_0x38fb26(0x166)](_0x38fb26(0x238)+_0x1ac8ea['id']+_0x38fb26(0x1f3)+_0x1ac8ea[_0x38fb26(0x22f)]+_0x38fb26(0x168)+_0x1ac8ea[_0x38fb26(0x1d8)]+_0x38fb26(0x1f2)+_0x1ac8ea[_0x38fb26(0x239)]);}if(!_0x1ac8ea){console[_0x38fb26(0x263)](_0x38fb26(0x17f)+_0x1a8eb5[_0x38fb26(0x16c)]),loggerService_1[_0x38fb26(0x1ad)][_0x38fb26(0x273)]('visa',new Error(_0x38fb26(0x24b)+_0x1a8eb5['paymentId']),_0x4e7805);throw new Error(_0x38fb26(0x1ec)+_0x1a8eb5[_0x38fb26(0x16c)]);}console[_0x38fb26(0x166)](_0x38fb26(0x186)+_0x1ac8ea['id']+_0x38fb26(0x158)+_0x1ac8ea[_0x38fb26(0x1d8)]+_0x38fb26(0x229)+_0x1a8eb5[_0x38fb26(0x1d8)]+')');const _0x4005bf={};_0x1a8eb5[_0x38fb26(0x21f)]&&await database_1[_0x38fb26(0x22a)][_0x38fb26(0x209)]['update']({'where':{'id':_0x1ac8ea['id']},'data':{'amount':_0x1a8eb5[_0x38fb26(0x21f)],'updatedAt':new Date()}}),_0x1a8eb5[_0x38fb26(0x266)]&&await database_1[_0x38fb26(0x22a)][_0x38fb26(0x209)][_0x38fb26(0x210)]({'where':{'id':_0x1ac8ea['id']},'data':{'currency':_0x1a8eb5[_0x38fb26(0x266)],'updatedAt':new Date()}}),_0x1a8eb5[_0x38fb26(0x1d8)]===_0x38fb26(0x189)&&_0x1a8eb5[_0x38fb26(0x23e)]&&(_0x4005bf[_0x38fb26(0x1cf)]=_0x1a8eb5[_0x38fb26(0x23e)],console[_0x38fb26(0x166)](_0x38fb26(0x231)+_0x1a8eb5[_0x38fb26(0x23e)])),_0x1a8eb5[_0x38fb26(0x1f6)]&&(_0x4005bf[_0x38fb26(0x1f6)]=_0x1a8eb5[_0x38fb26(0x1f6)],console[_0x38fb26(0x166)](_0x38fb26(0x262)+_0x1a8eb5[_0x38fb26(0x1f6)])),_0x4005bf['paymentMethod']=_0x38fb26(0x26d),await this['updatePaymentStatus'](_0x1ac8ea['id'],_0x1a8eb5[_0x38fb26(0x1d8)],_0x4005bf),await database_1[_0x38fb26(0x22a)][_0x38fb26(0x204)][_0x38fb26(0x264)]({'data':{'paymentId':_0x1ac8ea['id'],'shopId':_0x1ac8ea[_0x38fb26(0x268)],'event':'visa_'+_0x1a8eb5[_0x38fb26(0x1d8)][_0x38fb26(0x27c)](),'statusCode':0xc8,'responseBody':JSON['stringify'](_0x1a8eb5)}}),await this['sendPaymentStatusNotification'](_0x1ac8ea,_0x1a8eb5[_0x38fb26(0x1d8)][_0x38fb26(0x1ed)]()),console[_0x38fb26(0x166)]('‚úÖ\x20VISA\x20webhook\x20processed\x20successfully\x20for\x20payment\x20'+_0x1ac8ea['id']);}catch(_0x3df52e){console[_0x38fb26(0x263)]('‚ùå\x20VISA\x20webhook\x20processing\x20failed:',_0x3df52e),loggerService_1[_0x38fb26(0x1ad)]['logWebhookError']('visa',_0x3df52e,_0x4e7805);throw _0x3df52e;}}async[a81_0x598ab2(0x1ca)](_0x57809a){const _0x463b15=a81_0x598ab2;console[_0x463b15(0x166)]('üîÑ\x20Processing\x20MasterCard\x20webhook:',JSON[_0x463b15(0x27b)](_0x57809a,null,0x2));try{const _0x24032a=await this[_0x463b15(0x208)][_0x463b15(0x278)](_0x57809a,_0x463b15(0x18c));console['log']('üìä\x20MasterCard\x20webhook\x20result:',_0x24032a);if(!_0x24032a[_0x463b15(0x16c)]){console[_0x463b15(0x263)](_0x463b15(0x184)),console[_0x463b15(0x263)]('‚ùå\x20Available\x20webhook\x20fields:',Object['keys'](_0x57809a));throw new Error(_0x463b15(0x1c7));}let _0x4bc782=null;console[_0x463b15(0x166)](_0x463b15(0x20c)+_0x24032a[_0x463b15(0x16c)]);_0x24032a[_0x463b15(0x16c)]&&(console[_0x463b15(0x166)]('üîç\x20Trying\x20to\x20find\x20MasterCard\x20payment\x20by\x20various\x20fields...'),_0x4bc782=await database_1['default'][_0x463b15(0x209)][_0x463b15(0x26e)]({'where':{'AND':[{'OR':[{'gateway':_0x463b15(0x27d)},{'gateway':_0x463b15(0x274)},{'gateway':_0x463b15(0x221)}]},{'OR':[{'gatewayPaymentId':_0x24032a[_0x463b15(0x16c)]},{'gatewayOrderId':_0x24032a[_0x463b15(0x16c)]},{'id':_0x24032a[_0x463b15(0x16c)]},{'orderId':_0x24032a[_0x463b15(0x16c)]}]}]}}),console[_0x463b15(0x166)](_0x463b15(0x19a)+(_0x4bc782?_0x463b15(0x194)+_0x4bc782['id']:_0x463b15(0x1f0))));if(!_0x4bc782){console[_0x463b15(0x263)]('‚ùå\x20Payment\x20not\x20found\x20for\x20MasterCard\x20webhook\x20with\x20ID:\x20'+_0x24032a[_0x463b15(0x16c)]),console[_0x463b15(0x263)]('üîç\x20Searched\x20by:\x20gatewayOrderId=\x22'+_0x24032a[_0x463b15(0x16c)]+_0x463b15(0x201)+_0x24032a[_0x463b15(0x16c)]+_0x463b15(0x1df)+_0x24032a[_0x463b15(0x16c)]+'\x22');const _0x2ee1b6=await database_1['default'][_0x463b15(0x209)][_0x463b15(0x2b2)]({'where':{'OR':[{'gateway':_0x463b15(0x274)},{'gateway':_0x463b15(0x27d)},{'gateway':_0x463b15(0x221)}]},'select':{'id':!![],'gateway':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'orderId':!![],'status':!![]},'orderBy':{'id':_0x463b15(0x284)},'take':0xf});console['log'](_0x463b15(0x1c8),_0x2ee1b6),loggerService_1['loggerService']['logWebhookError'](_0x463b15(0x274),new Error(_0x463b15(0x24b)+_0x24032a[_0x463b15(0x16c)]),_0x57809a);throw new Error(_0x463b15(0x16e)+_0x24032a[_0x463b15(0x16c)]);}console[_0x463b15(0x166)](_0x463b15(0x1cd)+_0x4bc782['id']+_0x463b15(0x17e)+_0x4bc782[_0x463b15(0x1d8)]+_0x463b15(0x2ae)+_0x24032a[_0x463b15(0x1d8)]);const _0x342ca5={};_0x24032a[_0x463b15(0x21f)]&&await database_1[_0x463b15(0x22a)][_0x463b15(0x209)]['update']({'where':{'id':_0x4bc782['id']},'data':{'amount':_0x24032a[_0x463b15(0x21f)],'updatedAt':new Date()}}),_0x24032a[_0x463b15(0x266)]&&await database_1[_0x463b15(0x22a)][_0x463b15(0x209)][_0x463b15(0x210)]({'where':{'id':_0x4bc782['id']},'data':{'currency':_0x24032a[_0x463b15(0x266)],'updatedAt':new Date()}}),_0x24032a['status']==='FAILED'&&_0x24032a['errorMessage']&&(_0x342ca5[_0x463b15(0x1cf)]=_0x24032a['errorMessage'],console[_0x463b15(0x166)]('‚ùå\x20MasterCard\x20payment\x20failed\x20with\x20message:\x20'+_0x24032a['errorMessage'])),_0x24032a[_0x463b15(0x1f6)]&&(_0x342ca5['cardBrand']=_0x24032a[_0x463b15(0x1f6)],console[_0x463b15(0x166)](_0x463b15(0x262)+_0x24032a['cardBrand'])),_0x342ca5['paymentMethod']=_0x463b15(0x26d),await this[_0x463b15(0x295)](_0x4bc782['id'],_0x24032a[_0x463b15(0x1d8)],_0x342ca5),loggerService_1[_0x463b15(0x1ad)][_0x463b15(0x249)](_0x463b15(0x274),_0x4bc782['id'],_0x4bc782[_0x463b15(0x1d8)],_0x24032a['status'],_0x57809a);}catch(_0x3f1f1c){console[_0x463b15(0x263)](_0x463b15(0x260),_0x3f1f1c),loggerService_1[_0x463b15(0x1ad)][_0x463b15(0x273)](_0x463b15(0x274),_0x3f1f1c,_0x57809a);throw _0x3f1f1c;}}async['processAmerWebhook'](_0x15e599){const _0x174948=a81_0x598ab2;console[_0x174948(0x166)]('üîÑ\x20Processing\x20Amer\x20webhook:',JSON[_0x174948(0x27b)](_0x15e599,null,0x2));try{const _0x5b2594=await this['amerService'][_0x174948(0x278)](_0x15e599);console[_0x174948(0x166)](_0x174948(0x19d),_0x5b2594);if(!_0x5b2594['paymentId']){console[_0x174948(0x263)](_0x174948(0x1de)),console[_0x174948(0x263)](_0x174948(0x1a8),Object[_0x174948(0x21b)](_0x15e599));throw new Error(_0x174948(0x29c));}let _0x50664b=null;console[_0x174948(0x166)]('üîç\x20Amer\x20webhook:\x20Searching\x20for\x20payment\x20with\x20ID:\x20'+_0x5b2594[_0x174948(0x16c)]),_0x50664b=await database_1['default'][_0x174948(0x209)]['findFirst']({'where':{'AND':[{'gateway':_0x174948(0x202)},{'OR':[{'gatewayPaymentId':_0x5b2594[_0x174948(0x16c)]},{'gatewayOrderId':_0x5b2594[_0x174948(0x16c)]},{'id':_0x5b2594[_0x174948(0x16c)]},{'orderId':_0x5b2594[_0x174948(0x16c)]}]}]}}),console[_0x174948(0x166)](_0x174948(0x19a)+(_0x50664b?'Found\x20payment\x20'+_0x50664b['id']:_0x174948(0x1f0)));if(!_0x50664b){console[_0x174948(0x263)](_0x174948(0x185)+_0x5b2594['paymentId']);return;}console['log']('üìä\x20Amer\x20webhook:\x20Payment\x20'+_0x50664b['id']+_0x174948(0x2b6)+_0x5b2594[_0x174948(0x1d8)]),await this[_0x174948(0x295)](_0x50664b['id'],_0x5b2594['status'],{'cardLast4':_0x5b2594['additionalInfo']?.['cardLast4'],'paymentMethod':_0x5b2594[_0x174948(0x18e)]?.['paymentMethod']});}catch(_0x571c45){console[_0x174948(0x263)](_0x174948(0x2a9),_0x571c45),loggerService_1[_0x174948(0x1ad)][_0x174948(0x273)]('amer',_0x571c45,_0x15e599);throw _0x571c45;}}async['processAmPayWebhook'](_0x2fd389){const _0x284e47=a81_0x598ab2;console[_0x284e47(0x166)](_0x284e47(0x188),JSON[_0x284e47(0x27b)](_0x2fd389,null,0x2));try{const _0x1120a5=_0x2fd389[_0x284e47(0x1d8)],_0x53e1ab=_0x2fd389['client_transaction_id'],_0xdc6fac=_0x2fd389[_0x284e47(0x207)],_0x44dad2=_0x2fd389[_0x284e47(0x182)],_0x4db823=_0x2fd389[_0x284e47(0x21f)],_0x441d8c=_0x2fd389[_0x284e47(0x266)],_0x2e74e3=_0x2fd389[_0x284e47(0x291)],_0x38549a=_0x2fd389['status_addition_info'];if(!_0x53e1ab){console[_0x284e47(0x263)](_0x284e47(0x29d));throw new Error(_0x284e47(0x17c));}console[_0x284e47(0x166)]('üìä\x20AmPay\x20webhook\x20data:',{'status':_0x1120a5,'clientTransactionId':_0x53e1ab,'systemId':_0xdc6fac,'paymentMethod':_0x44dad2,'amount':_0x4db823,'currency':_0x441d8c,'commission':_0x2e74e3,'statusAdditionInfo':_0x38549a});const _0x16ec36=await database_1[_0x284e47(0x22a)][_0x284e47(0x209)][_0x284e47(0x26e)]({'where':{'OR':[{'gatewayOrderId':_0x53e1ab},{'orderId':_0x53e1ab},{'id':_0x53e1ab},{'gatewayPaymentId':_0x53e1ab}]},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x16ec36){console['error']('‚ùå\x20Payment\x20not\x20found\x20for\x20AmPay\x20client_transaction_id:\x20'+_0x53e1ab);throw new Error(_0x284e47(0x24b)+_0x53e1ab);}console[_0x284e47(0x166)](_0x284e47(0x1cd)+_0x16ec36['id']+_0x284e47(0x163)),console[_0x284e47(0x166)](_0x284e47(0x29e)+_0x16ec36['status']+'\x20‚Üí\x20'+_0x1120a5),_0x1120a5===_0x284e47(0x205)?(console[_0x284e47(0x166)]('üîÑ\x20AmPay\x20status\x20DECLINED\x20mapped\x20to\x20FAILED'),await this[_0x284e47(0x295)](_0x16ec36['id'],'FAILED'),console[_0x284e47(0x166)](_0x284e47(0x2b3)+_0x16ec36['id']+_0x284e47(0x179)),console[_0x284e47(0x166)](_0x284e47(0x1e0)+(_0x38549a||_0x284e47(0x2a0)))):console[_0x284e47(0x166)](_0x284e47(0x195)+_0x1120a5+_0x284e47(0x1bb)),await database_1['default'][_0x284e47(0x204)]['create']({'data':{'paymentId':_0x16ec36['id'],'shopId':_0x16ec36[_0x284e47(0x268)],'event':'ampay_'+(_0x1120a5?.[_0x284e47(0x27c)]()||'unknown'),'statusCode':0xc8,'responseBody':JSON[_0x284e47(0x27b)](_0x2fd389)}}),loggerService_1[_0x284e47(0x1ad)][_0x284e47(0x249)](_0x284e47(0x297),_0x16ec36['id'],_0x16ec36[_0x284e47(0x1d8)],_0x1120a5===_0x284e47(0x205)?_0x284e47(0x189):_0x1120a5,_0x2fd389);}catch(_0x5ff4f0){console[_0x284e47(0x263)]('‚ùå\x20Error\x20processing\x20AmPay\x20webhook:',_0x5ff4f0),loggerService_1[_0x284e47(0x1ad)]['logWebhookError'](_0x284e47(0x297),_0x5ff4f0,_0x2fd389);throw _0x5ff4f0;}}async[a81_0x598ab2(0x1af)](_0x1f7661){const _0x547c99=a81_0x598ab2;console[_0x547c99(0x166)](_0x547c99(0x1e4),JSON[_0x547c99(0x27b)](_0x1f7661,null,0x2));try{const _0x58615e=_0x1f7661['status'],_0x21b2b1=_0x1f7661[_0x547c99(0x16a)],_0x1c7a0d=_0x1f7661[_0x547c99(0x207)],_0x135d4f=_0x1f7661['payment_method'],_0x166183=_0x1f7661['amount'],_0x2ab68e=_0x1f7661['currency'],_0x13228c=_0x1f7661[_0x547c99(0x291)],_0x230a8e=_0x1f7661[_0x547c99(0x1e9)];if(!_0x21b2b1){console['error'](_0x547c99(0x22b));throw new Error(_0x547c99(0x29a));}console[_0x547c99(0x166)](_0x547c99(0x283),{'status':_0x58615e,'clientTransactionId':_0x21b2b1,'systemId':_0x1c7a0d,'paymentMethod':_0x135d4f,'amount':_0x166183,'currency':_0x2ab68e,'commission':_0x13228c,'statusAdditionInfo':_0x230a8e});const _0x3c2bea=await database_1[_0x547c99(0x22a)]['payment'][_0x547c99(0x26e)]({'where':{'OR':[{'gatewayOrderId':_0x21b2b1},{'orderId':_0x21b2b1},{'id':_0x21b2b1},{'gatewayPaymentId':_0x21b2b1}]},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3c2bea){console[_0x547c99(0x263)](_0x547c99(0x237)+_0x21b2b1);throw new Error(_0x547c99(0x24b)+_0x21b2b1);}console[_0x547c99(0x166)](_0x547c99(0x1cd)+_0x3c2bea['id']+_0x547c99(0x23b)),console['log']('üìä\x20Payment\x20status:\x20'+_0x3c2bea['status']+'\x20‚Üí\x20'+_0x58615e),_0x58615e==='DECLINED'?(console[_0x547c99(0x166)](_0x547c99(0x18a)),await this[_0x547c99(0x295)](_0x3c2bea['id'],'FAILED'),console[_0x547c99(0x166)](_0x547c99(0x165)+_0x3c2bea['id']+_0x547c99(0x179)),console['log'](_0x547c99(0x1e0)+(_0x230a8e||'No\x20additional\x20info'))):console[_0x547c99(0x166)](_0x547c99(0x224)+_0x58615e+'\x20-\x20no\x20action\x20taken\x20(only\x20DECLINED\x20is\x20processed)'),await database_1[_0x547c99(0x22a)]['webhookLog'][_0x547c99(0x264)]({'data':{'paymentId':_0x3c2bea['id'],'shopId':_0x3c2bea[_0x547c99(0x268)],'event':_0x547c99(0x22e)+(_0x58615e?.[_0x547c99(0x27c)]()||_0x547c99(0x277)),'statusCode':0xc8,'responseBody':JSON['stringify'](_0x1f7661)}}),loggerService_1['loggerService'][_0x547c99(0x249)](_0x547c99(0x286),_0x3c2bea['id'],_0x3c2bea[_0x547c99(0x1d8)],_0x58615e===_0x547c99(0x205)?_0x547c99(0x189):_0x58615e,_0x1f7661);}catch(_0xca0955){console[_0x547c99(0x263)]('‚ùå\x20Error\x20processing\x20AmPay\x20TRY\x20webhook:',_0xca0955),loggerService_1[_0x547c99(0x1ad)]['logWebhookError'](_0x547c99(0x286),_0xca0955,_0x1f7661);throw _0xca0955;}}async[a81_0x598ab2(0x157)](_0x2fb566,_0x6ff5a5){const _0x3fc4b3=a81_0x598ab2,_0x57ad64=Date[_0x3fc4b3(0x1c6)]();try{const _0xd5c886=_0x2fb566[_0x3fc4b3(0x1a5)],_0x5a6758=_0xd5c886[_0x3fc4b3(0x2a8)];if(!_0x5a6758?.[_0x3fc4b3(0x24c)]){console[_0x3fc4b3(0x166)](_0x3fc4b3(0x1c9)+_0xd5c886['id']);return;}const _0x4a3637=_0x6ff5a5==='PAID'?_0x3fc4b3(0x1fe):_0x6ff5a5==='FAILED'?'payment.failed':_0x6ff5a5===_0x3fc4b3(0x246)?_0x3fc4b3(0x20b):_0x6ff5a5==='CHARGEBACK'?_0x3fc4b3(0x20b):_0x6ff5a5===_0x3fc4b3(0x1b8)?_0x3fc4b3(0x20b):_0x3fc4b3(0x17a);let _0x10cb62=[];if(_0x5a6758[_0x3fc4b3(0x212)])try{_0x10cb62=Array['isArray'](_0x5a6758[_0x3fc4b3(0x212)])?_0x5a6758['webhookEvents']:JSON[_0x3fc4b3(0x28e)](_0x5a6758[_0x3fc4b3(0x212)]);}catch(_0xfc7b11){console['error']('Error\x20parsing\x20webhook\x20events:',_0xfc7b11),_0x10cb62=[];}if(!_0x10cb62[_0x3fc4b3(0x1a9)](_0x4a3637)){console['log'](_0x3fc4b3(0x1a4)+_0x4a3637+'\x20not\x20enabled\x20for\x20shop\x20'+_0xd5c886['id']);return;}const _0x58c08a={'event':_0x4a3637,'payment':{'id':_0x2fb566['id'],'order_id':_0x2fb566[_0x3fc4b3(0x247)],'gateway_order_id':_0x2fb566[_0x3fc4b3(0x1d0)],'gateway':_0x2fb566[_0x3fc4b3(0x22f)],'amount':_0x2fb566[_0x3fc4b3(0x21f)],'currency':_0x2fb566[_0x3fc4b3(0x266)],'status':_0x6ff5a5[_0x3fc4b3(0x27c)](),'customer_email':_0x2fb566[_0x3fc4b3(0x230)],'customer_name':_0x2fb566['customerName'],'failure_message':_0x2fb566[_0x3fc4b3(0x1cf)],'tx_urls':_0x2fb566[_0x3fc4b3(0x27e)]?JSON[_0x3fc4b3(0x28e)](_0x2fb566['txUrls']):null,'created_at':_0x2fb566[_0x3fc4b3(0x181)],'updated_at':_0x2fb566[_0x3fc4b3(0x17d)]}},_0x4c182e=await fetch(_0x5a6758['webhookUrl'],{'method':_0x3fc4b3(0x285),'headers':{'Content-Type':'application/json','User-Agent':_0x3fc4b3(0x21c)},'body':JSON[_0x3fc4b3(0x27b)](_0x58c08a)}),_0x2de514=Date['now']()-_0x57ad64,_0x437bca=_0x4c182e['ok']?'Success':await _0x4c182e[_0x3fc4b3(0x23f)]();loggerService_1[_0x3fc4b3(0x1ad)]['logShopWebhookSent'](_0x2fb566[_0x3fc4b3(0x268)],_0x5a6758[_0x3fc4b3(0x24c)],_0x4a3637,_0x4c182e[_0x3fc4b3(0x1d8)],_0x2de514,_0x58c08a),console[_0x3fc4b3(0x166)](_0x3fc4b3(0x1d6)+_0x5a6758['webhookUrl']+_0x3fc4b3(0x1ff)+_0x4c182e[_0x3fc4b3(0x1d8)]+'\x20('+_0x2de514+_0x3fc4b3(0x28d));}catch(_0x2db21c){console[_0x3fc4b3(0x263)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x2db21c),loggerService_1[_0x3fc4b3(0x1ad)]['logShopWebhookError'](_0x2fb566[_0x3fc4b3(0x268)],_0x2fb566['shop']?.[_0x3fc4b3(0x2a8)]?.[_0x3fc4b3(0x24c)]||_0x3fc4b3(0x277),'webhook_send',_0x2db21c,{});}}async[a81_0x598ab2(0x1d2)](_0x52cbf1,_0x5cb180){const _0x3cda05=a81_0x598ab2;try{const _0x450c85={'PENDING':_0x3cda05(0x251),'PROCESSING':'processing','PAID':_0x3cda05(0x261),'FAILED':_0x3cda05(0x15e),'EXPIRED':_0x3cda05(0x2b5),'REFUND':_0x3cda05(0x216),'CHARGEBACK':_0x3cda05(0x222)},_0x5b6a49=_0x450c85[_0x5cb180];if(!_0x5b6a49||_0x5b6a49===_0x3cda05(0x251))return;await telegramBotService_1[_0x3cda05(0x1e7)][_0x3cda05(0x2ab)](_0x52cbf1[_0x3cda05(0x268)],_0x52cbf1,_0x5b6a49);}catch(_0x1eee88){console[_0x3cda05(0x263)](_0x3cda05(0x256),_0x1eee88);}}async[a81_0x598ab2(0x1e2)](_0x45b649,_0x23df50){const _0xfcb04f=a81_0x598ab2;try{const _0x11bb38=await database_1[_0xfcb04f(0x22a)][_0xfcb04f(0x1a5)]['findUnique']({'where':{'id':_0x45b649},'select':{'gatewaySettings':!![]}});if(!_0x11bb38?.[_0xfcb04f(0x19b)])return console[_0xfcb04f(0x166)](_0xfcb04f(0x227)+_0x45b649+_0xfcb04f(0x1e5)),0xa;const _0x2bee4d=JSON['parse'](_0x11bb38[_0xfcb04f(0x19b)]);for(const [_0xb7ecec,_0x27ccbc]of Object[_0xfcb04f(0x2a2)](_0x2bee4d)){if(_0xb7ecec[_0xfcb04f(0x27c)]()===_0x23df50[_0xfcb04f(0x27c)]()){const _0x3cb2af=_0x27ccbc[_0xfcb04f(0x291)]||0xa;return console[_0xfcb04f(0x166)]('Gateway\x20'+_0x23df50+_0xfcb04f(0x228)+_0x45b649+':\x20'+_0x3cb2af+'%'),_0x3cb2af;}}return console[_0xfcb04f(0x166)](_0xfcb04f(0x269)+_0x23df50+_0xfcb04f(0x1cb)+_0x45b649+_0xfcb04f(0x25b)),0xa;}catch(_0x410577){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x45b649+_0xfcb04f(0x299)+_0x23df50+':',_0x410577),0xa;}}async['processMyXSpendWebhook'](_0x550c5d,_0x2f732b){const _0x1c5f50=a81_0x598ab2;console[_0x1c5f50(0x166)]('üîÑ\x20Processing\x20MyXSpend\x20webhook:'),console['log'](_0x1c5f50(0x1a1),JSON[_0x1c5f50(0x27b)](_0x550c5d,null,0x2)),console[_0x1c5f50(0x166)](_0x1c5f50(0x1da),JSON[_0x1c5f50(0x27b)](_0x2f732b,null,0x2));try{const _0x5b4006=_0x550c5d[_0x1c5f50(0x275)]||_0x2f732b['customerOrderId'],_0x360e02=_0x550c5d[_0x1c5f50(0x1d8)]||_0x2f732b[_0x1c5f50(0x1d8)],_0x3a7f99=_0x550c5d[_0x1c5f50(0x21f)]||_0x2f732b[_0x1c5f50(0x21f)],_0xe6f2a8=_0x550c5d[_0x1c5f50(0x266)]||_0x2f732b[_0x1c5f50(0x266)],_0x571eaa=_0x550c5d[_0x1c5f50(0x18d)]||_0x2f732b['dateTime'];if(!_0x5b4006){console['error']('‚ùå\x20No\x20customerOrderId\x20found\x20in\x20MyXSpend\x20webhook');throw new Error(_0x1c5f50(0x287));}console[_0x1c5f50(0x166)]('üìä\x20MyXSpend\x20webhook\x20data:',{'customerOrderId':_0x5b4006,'status':_0x360e02,'amount':_0x3a7f99,'currency':_0xe6f2a8,'dateTime':_0x571eaa});const _0x3885e5=await database_1[_0x1c5f50(0x22a)][_0x1c5f50(0x209)][_0x1c5f50(0x26e)]({'where':{'OR':[{'gatewayOrderId':_0x5b4006},{'orderId':_0x5b4006},{'id':_0x5b4006},{'gatewayPaymentId':_0x5b4006}]},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3885e5){console['error'](_0x1c5f50(0x1eb)+_0x5b4006);throw new Error(_0x1c5f50(0x24b)+_0x5b4006);}console[_0x1c5f50(0x166)]('‚úÖ\x20Found\x20payment\x20'+_0x3885e5['id']+_0x1c5f50(0x23a)),console['log'](_0x1c5f50(0x29e)+_0x3885e5['status']+_0x1c5f50(0x229)+_0x360e02);let _0x58b6d5=_0x360e02?.[_0x1c5f50(0x1ed)]();_0x360e02===_0x1c5f50(0x189)||_0x360e02===_0x1c5f50(0x246)?(_0x58b6d5=_0x1c5f50(0x189),console[_0x1c5f50(0x166)](_0x1c5f50(0x220)+_0x360e02+_0x1c5f50(0x24f)),await this[_0x1c5f50(0x295)](_0x3885e5['id'],_0x58b6d5),console[_0x1c5f50(0x166)](_0x1c5f50(0x25a)+_0x3885e5['id']+_0x1c5f50(0x179))):console[_0x1c5f50(0x166)](_0x1c5f50(0x1b7)+_0x360e02+'\x20-\x20no\x20action\x20taken\x20(only\x20FAILED/EXPIRED\x20are\x20processed)'),await database_1[_0x1c5f50(0x22a)][_0x1c5f50(0x204)]['create']({'data':{'paymentId':_0x3885e5['id'],'shopId':_0x3885e5[_0x1c5f50(0x268)],'event':_0x1c5f50(0x16f)+(_0x360e02?.[_0x1c5f50(0x27c)]()||_0x1c5f50(0x277)),'statusCode':0xc8,'responseBody':JSON[_0x1c5f50(0x27b)]({'queryParams':_0x550c5d,'bodyData':_0x2f732b})}}),loggerService_1['loggerService'][_0x1c5f50(0x249)]('myxspend',_0x3885e5['id'],_0x3885e5['status'],_0x58b6d5||_0x360e02,{'queryParams':_0x550c5d,'bodyData':_0x2f732b});}catch(_0x43d64b){console[_0x1c5f50(0x263)](_0x1c5f50(0x193),_0x43d64b),loggerService_1[_0x1c5f50(0x1ad)][_0x1c5f50(0x273)](_0x1c5f50(0x177),_0x43d64b,{'queryParams':_0x550c5d,'bodyData':_0x2f732b});throw _0x43d64b;}}async[a81_0x598ab2(0x2b1)](_0x37cbee){const _0x22f2b7=a81_0x598ab2;console[_0x22f2b7(0x166)]('üîÑ\x20Processing\x20MaxPara\x20webhook:',_0x37cbee);try{const _0x6ab101=this['maxParaService'][_0x22f2b7(0x278)](_0x37cbee);if(!_0x6ab101[_0x22f2b7(0x16c)])throw new Error('No\x20payment\x20ID\x20in\x20MaxPara\x20webhook');const _0x329128=await database_1[_0x22f2b7(0x22a)][_0x22f2b7(0x209)][_0x22f2b7(0x26e)]({'where':{'gatewayOrderId':_0x6ab101[_0x22f2b7(0x16c)]}});if(!_0x329128){console['error'](_0x22f2b7(0x281)+_0x6ab101['paymentId']);return;}console[_0x22f2b7(0x166)](_0x22f2b7(0x218)+_0x329128['id']+_0x22f2b7(0x2b6)+_0x6ab101['status']),await this[_0x22f2b7(0x295)](_0x329128['id'],_0x6ab101['status'],{'paymentMethod':_0x22f2b7(0x240),'failureMessage':_0x6ab101[_0x22f2b7(0x18e)]?.[_0x22f2b7(0x159)]}),loggerService_1['loggerService'][_0x22f2b7(0x249)](_0x22f2b7(0x190),_0x329128['id'],_0x329128[_0x22f2b7(0x1d8)],_0x6ab101['status'],_0x37cbee);}catch(_0x215686){console[_0x22f2b7(0x263)](_0x22f2b7(0x19c),_0x215686),loggerService_1['loggerService']['logWebhookError'](_0x22f2b7(0x190),_0x215686,_0x37cbee);throw _0x215686;}}async[a81_0x598ab2(0x1f7)](_0x54fb51){const _0x263d62=a81_0x598ab2;console['log'](_0x263d62(0x270),_0x54fb51);try{const {track_id:_0x3e46e3,status:_0x5a60d6,order_id:_0x477544,txs:_0x3381ca}=_0x54fb51;if(!_0x477544)throw new Error(_0x263d62(0x1a0));const _0x41c512=await database_1[_0x263d62(0x22a)][_0x263d62(0x209)][_0x263d62(0x26e)]({'where':{'gatewayOrderId':_0x477544}});if(!_0x41c512){console[_0x263d62(0x263)]('Payment\x20not\x20found\x20for\x20OxaPay\x20webhook:\x20'+_0x477544);return;}console[_0x263d62(0x166)](_0x263d62(0x28f)+_0x41c512['id']+_0x263d62(0x2b6)+_0x5a60d6);const _0x7d2d15=this[_0x263d62(0x15c)][_0x263d62(0x234)](_0x5a60d6),_0xe2e572=[];if(_0x3381ca&&Array[_0x263d62(0x271)](_0x3381ca))for(const _0x33349b of _0x3381ca){_0x33349b[_0x263d62(0x289)]&&_0xe2e572[_0x263d62(0x244)](_0x33349b['tx_hash']);}await this[_0x263d62(0x295)](_0x41c512['id'],_0x7d2d15,{'txUrls':_0xe2e572[_0x263d62(0x276)]>0x0?_0xe2e572:undefined}),loggerService_1[_0x263d62(0x1ad)][_0x263d62(0x249)](_0x263d62(0x1ae),_0x41c512['id'],_0x41c512[_0x263d62(0x1d8)],_0x7d2d15,_0x54fb51);}catch(_0x59fc2e){console['error'](_0x263d62(0x2a4),_0x59fc2e),loggerService_1[_0x263d62(0x1ad)][_0x263d62(0x273)](_0x263d62(0x1ae),_0x59fc2e,_0x54fb51);throw _0x59fc2e;}}}exports[a81_0x598ab2(0x16d)]=WebhookService;