'use strict';const a81_0x118b53=a81_0x2ced;(function(_0x235f22,_0x4b20a3){const _0x311b62=a81_0x2ced,_0x483c68=_0x235f22();while(!![]){try{const _0x4a8b79=parseInt(_0x311b62(0x166))/0x1+parseInt(_0x311b62(0x1e2))/0x2*(-parseInt(_0x311b62(0x1c9))/0x3)+-parseInt(_0x311b62(0x1a1))/0x4*(-parseInt(_0x311b62(0x228))/0x5)+-parseInt(_0x311b62(0x1e3))/0x6*(parseInt(_0x311b62(0x24d))/0x7)+parseInt(_0x311b62(0x1a2))/0x8*(-parseInt(_0x311b62(0x1eb))/0x9)+-parseInt(_0x311b62(0x2ac))/0xa*(parseInt(_0x311b62(0x1f9))/0xb)+-parseInt(_0x311b62(0x283))/0xc*(-parseInt(_0x311b62(0x29f))/0xd);if(_0x4a8b79===_0x4b20a3)break;else _0x483c68['push'](_0x483c68['shift']());}catch(_0xe0939c){_0x483c68['push'](_0x483c68['shift']());}}}(a81_0x5f44,0x7ce3b));var __importDefault=this&&this['__importDefault']||function(_0x463517){const _0x3d8ed6=a81_0x2ced;return _0x463517&&_0x463517[_0x3d8ed6(0x2c0)]?_0x463517:{'default':_0x463517};};Object[a81_0x118b53(0x1bb)](exports,a81_0x118b53(0x2c0),{'value':!![]}),exports[a81_0x118b53(0x28b)]=void 0x0;function a81_0x5f44(){const _0x4bc28d=['‚ùå\x20Payment\x20not\x20found\x20for\x20MasterCard\x20webhook\x20with\x20ID:\x20','myxspend','updatedAt','No\x20payment\x20ID\x20in\x20Noda\x20webhook','\x20=\x20','No\x20payment\x20ID\x20in\x20MasterCard\x20webhook','No\x20payment\x20ID\x20in\x20Rapyd\x20webhook','üí∞\x20Adding\x20to\x20balance:\x20','visa_mastercard','ampayTRYService','remitterName','klymeService','Found','üìä\x20OxaPay\x20webhook:\x20Payment\x20','customerName','Payment\x20not\x20found\x20for\x20Noda\x20webhook:\x20','‚úÖ\x20AmPay\x20TRY\x20webhook\x20processed:\x20Payment\x20','210896sygHFu','\x20status\x20updated\x20to\x20FAILED','‚ùå\x20Payment\x20not\x20found\x20for\x20Amer\x20webhook\x20with\x20ID:\x20','Payment\x20System/1.0','SINGLE','message','expired','findFirst','PlisioService','üîÑ\x20Processing\x20Amer\x20webhook:','webhook_send','paymentMethod','\x20USDT\x20(chargeback\x20penalty\x20ONLY)','processAmPayWebhook','PAID','üìä\x20MyXSpend\x20webhook\x20data:','AmPayTRYService','\x20->\x20','‚ùå\x20VISA\x20payment\x20failed\x20with\x20message:\x20','\x20not\x20found','toFixed','\x20updated:\x20currentPayments=','processMyXSpendWebhook','üí∞\x20Payment\x20','Open\x20Banking','\x22,\x20newStatus=\x22','EXPIRED','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20‚Üí\x20','processVisaWebhook','ampay_try_','üîÑ\x20MyXSpend\x20status\x20',',\x20using\x20default\x20commission\x2010%','txUrls','https://maxpara.co','üîÑ\x20Processing\x20MasterCard\x20webhook:','‚ÑπÔ∏è\x20Decline\x20reason:\x20','üìä\x20AmPay\x20TRY\x20webhook\x20data:','üí∞\x20Converting\x20','üîÑ\x20Processing\x20Noda\x20webhook:','sendShopWebhook','visaMasterCardService','processNodaWebhook','CHARGEBACK','shopId','NodaService','üìä\x20Amer\x20webhook:\x20Payment\x20','application/json','Payment\x20not\x20found\x20for\x20Rapyd\x20webhook:\x20','currencyService','üîÑ\x20Processing\x20Plisio\x20webhook:','üí≥\x20Card\x20brand\x20detected:\x20','type','toUpperCase','1068KIOZSm','plisio_gateway','üîÑ\x20updatePaymentStatus\x20called:\x20paymentId=','logWebhookError','üìä\x20Noda\x20webhook:\x20Payment\x20','VISA\x20payment\x20not\x20found:\x20','oxapay','‚ùå\x20Payment\x20not\x20found\x20for\x20AmPay\x20client_transaction_id:\x20','WebhookService','paidAt','üîÑ\x20Processing\x20CoinToPay\x20webhook:','‚úÖ\x20Shop\x20','username','\x20became\x20PAID\x20via\x20webhook,\x20updating\x20payment\x20link\x20counter','‚ÑπÔ∏è\x20MyXSpend\x20status\x20','üìä\x20VISA\x20payment\x20found:\x20','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','ampay','findMany','updatePaymentStatus','processOxaPayWebhook','errorMessage','\x20-\x20','\x20commission\x20for\x20shop\x20','\x20balance\x20updated:\x20',',\x20gatewayOrderId:\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','üìä\x20Payment\x20status:\x20','379717lTsNrV',',\x20Status=','MAX_PARA_BASE_URL','üìä\x20CoinToPay\x20webhook:\x20Payment\x20','processPlisioGatewayWebhook','Payment\x20not\x20found\x20for\x20KLYME\x20webhook:\x20',',\x20gatewayPaymentId:\x20','Error\x20processing\x20Plisio\x20webhook:','visa','createdAt','sendPaymentStatusNotification','amerService','‚ÑπÔ∏è\x20AmPay\x20TRY\x20status\x20','104250UBdLsS','./gateways/nodaService','Payment\x20not\x20found','MAX_PARA_SECRET_KEY','includes','Payment\x20not\x20found\x20for\x20Plisio\x20webhook:\x20','additionalInfo','REFUND','‚ùå\x20Error\x20processing\x20AmPay\x20webhook:','findUnique','./gateways/coinToPay2Service','ms)','CoinToPayService','üìä\x20Plisio\x20Gateway\x20webhook:\x20Payment\x20','processCoinToPayWebhook','telegramBotService','No\x20order_id\x20in\x20OxaPay\x20webhook','CoinToPay2Service','desc','keys','__esModule','üí∞\x20Final\x20balance\x20after\x20chargeback:\x20','default','now','DECLINED','amer','üîç\x20Searched\x20by:\x20gatewayOrderId=\x22','tx_hash','‚úÖ\x20AmPay\x20webhook\x20processed:\x20Payment\x20','‚úÖ\x20Found\x20payment\x20','cointopay','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','üîÑ\x20Additional\x20data:','‚ùå\x20No\x20payment\x20ID\x20extracted\x20from\x20MasterCard\x20webhook\x20data','No\x20payment\x20ID\x20in\x20Amer\x20webhook','./gateways/oxapayService','79176xBGArg',',\x20using\x20default\x2010%','dateTime','‚ùå\x20No\x20payment\x20ID\x20extracted\x20from\x20VISA\x20webhook\x20data','Missing\x20client_transaction_id\x20in\x20AmPay\x20TRY\x20webhook','No\x20amountUSDT\x20found\x20for\x20payment,\x20nothing\x20to\x20remove\x20from\x20balance','./telegramBotService','map','FAILED','‚ùå\x20Failed\x20to\x20update\x20payment\x20link\x20counter:','No\x20payment\x20ID\x20in\x20KLYME\x20webhook','gateway','processRapydWebhook','coinToPayService','payment.pending','üì§\x20Shop\x20webhook\x20sent\x20to\x20','Not\x20found','gatewaySettings','üîÑ\x20Processing\x20KLYME\x20webhook:','‚ùå\x20No\x20customerOrderId\x20found\x20in\x20MyXSpend\x20webhook','processAmerWebhook','No\x20payment\x20ID\x20in\x20Plisio\x20Gateway\x20webhook','remitterIban','Missing\x20customerOrderId\x20in\x20MyXSpend\x20webhook','env','\x22,\x20paymentLinkId=\x22','payment_method','logWebhookProcessed','toISOString','üè™\x20Shop\x20','üìä\x20Rapyd\x20webhook:\x20Payment\x20','Error\x20processing\x20MaxPara\x20webhook:','\x20for\x20MyXSpend\x20webhook','‚úÖ\x20Payment\x20link\x20','üîç\x20VISA\x20payment\x20search\x20result:\x20','‚ùå\x20Error\x20processing\x20MasterCard\x20webhook:','chargeback','cb5d6df763cde0f752ebd71ac606e95ff6b73926abfb4621ad95e99c423a2965d6f153b1647f7dcff315bf65dd749f72dbb40576','logShopWebhookError','oxapayService',',\x20status=','üîç\x20Searching\x20for\x20VISA\x20payment\x20with\x20the\x20following\x20criteria:','bankId','\x20in\x20shop\x20','nodaService','paymentId','üìä\x20Plisio\x20webhook:\x20Payment\x20','visa_','parse','ampayService',',\x20currentPayments=','./currencyService','processKlymeWebhook','ampay_','mastercard','POST','üìä\x20MaxPara\x20webhook:\x20Payment\x20','processMaxParaWebhook','./gateways/amerService','19132AoBbxA','8sgPSNM',':\x20type=','AmerService','\x20-\x20no\x20action\x20taken\x20(only\x20FAILED/EXPIRED\x20are\x20processed)','logShopWebhookSent','Payment\x20not\x20found:\x20','cardBrand','üí∞\x20Amount\x20after\x20gateway\x20commission:\x20','üìä\x20KLYME\x20webhook:\x20Payment\x20','getGatewayCommission','plisio','No\x20payment\x20ID\x20in\x20Plisio\x20webhook','MasterCard\x20payment\x20not\x20found:\x20','MASTERCARD','S8jqtNdiYV1qZTkw1nPB','COMPLETED','stringify','chargebackAmount','status','shop','üîÑ\x20AmPay\x20status\x20DECLINED\x20mapped\x20to\x20FAILED','text','maxpara','üîÑ\x20Processing\x20Plisio\x20Gateway\x20webhook:','failed','defineProperty','Success','client_transaction_id','\x20-\x20no\x20action\x20taken\x20(only\x20DECLINED\x20is\x20processed)','error','isArray','Missing\x20client_transaction_id\x20in\x20AmPay\x20webhook','üîç\x20Amer\x20webhook:\x20Searching\x20for\x20payment\x20with\x20ID:\x20','balance','IBAN','payment','\x22,\x20id=\x22','system_id','coinToPay2Service','3333YrrsXW','Error\x20processing\x20Plisio\x20Gateway\x20webhook:','./gateways/rapydService','Error\x20processing\x20OxaPay\x20webhook:','\x20to\x20','commission','Error\x20processing\x20CoinToPay2\x20webhook:','processAmPayTRYWebhook','üîç\x20Search\x20result:\x20','create','gatewayOrderId','Error\x20processing\x20KLYME\x20webhook:','cointopay2','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','üîÑ\x20Processing\x20MaxPara\x20webhook:','\x20+\x20','log','paymentLinkId','üìä\x20VISA\x20webhook\x20result:','gatewayCommissionRate','üìä\x20MasterCard\x20webhook\x20result:','ampay_try','orderId','status_addition_info','Error\x20parsing\x20webhook\x20events:','1124pbxfHd','108JCEHbS','KlymeService','plisioService','paymentLink','üîç\x20VISA\x20webhook:\x20Searching\x20for\x20payment\x20with\x20ID:\x20','\x20USDT\x20(payment\x20became\x20PAID,\x20after\x20','./gateways/klymeService','Error\x20processing\x20Rapyd\x20webhook:','4249512pqZYUu','maxParaService','unknown',',\x20Gateway=','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','gatewayPaymentId','failureMessage','üîÑ\x20Processing\x20CoinToPay2\x20webhook:','no\x20balance\x20change','payment.failed','webhookLog','MAX_PARA_API_KEY','üîÑ\x20Processing\x20OxaPay\x20webhook:','‚ùå\x20MasterCard\x20payment\x20failed\x20with\x20message:\x20','825vTaAXc','noda','processWebhook','‚ùå\x20Available\x20webhook\x20fields:','\x20(orderId:\x20','VisaMasterCardService','amountUSDT','‚ùå\x20Error\x20processing\x20AmPay\x20TRY\x20webhook:','Error\x20processing\x20CoinToPay\x20webhook:','Body\x20data:','Payment\x20not\x20found\x20for\x20CoinToPay2\x20webhook:\x20','customerEmail','üìà\x20Payment\x20','processing','OxaPayService','visa/mastercard','currentPayments','‚ùå\x20Error\x20processing\x20Amer\x20webhook:','No\x20payment\x20ID\x20in\x20MaxPara\x20webhook','refund','length','Gateway\x20','\x20not\x20enabled\x20for\x20shop\x20','\x20with\x20status\x20','üîÑ\x20Processing\x20Rapyd\x20webhook:','üîç\x20VISA\x20payment\x20search\x20executed','\x20for\x20AmPay\x20webhook','rapydService','‚úÖ\x20Found\x20payment:\x20ID=','Found\x20payment\x20','RapydService','webhookUrl','%\x20gateway\x20commission)','\x20status\x20','\x20\x20\x20-\x20Payment\x20ID\x20to\x20match:\x20','‚úÖ\x20VISA\x20webhook\x20processed\x20successfully\x20for\x20payment\x20','$transaction','amountAfterGatewayCommissionUSDT','Query\x20params:','üìà\x20Found\x20payment\x20link\x20','Payment\x20marked\x20as\x20CHARGEBACK\x20(no\x20penalty\x20specified)','toLowerCase','Bank\x20Card','Payment\x20not\x20found\x20for\x20MaxPara\x20webhook:\x20','settings','webhookEvents','‚ùå\x20Payment\x20not\x20found\x20for\x20MyXSpend\x20customerOrderId:\x20','265buBDAi','getPaymentStatusFromCallback','üîÑ\x20Processing\x20AmPay\x20TRY\x20webhook:','currency','cardLast4','amount','webhook_status_change_','Payment\x20not\x20found\x20for\x20OxaPay\x20webhook:\x20','AmPayService','./gateways/mastercardService','system','üìà\x20Payment\x20details:\x20oldStatus=\x22','Payment\x20','üîç\x20Recent\x20visa/mastercard\x20payments\x20for\x20debugging:','üîÑ\x20Processing\x20AmPay\x20webhook:','\x20\x20\x20-\x20Gateway:\x20visa/mastercard\x20or\x20mastercard','\x20USDT','loggerService','update','üí∞\x20Removing\x20from\x20balance:\x20'];a81_0x5f44=function(){return _0x4bc28d;};return a81_0x5f44();}function a81_0x2ced(_0x4d9c08,_0x25e30c){_0x4d9c08=_0x4d9c08-0x15b;const _0x5f444e=a81_0x5f44();let _0x2cede0=_0x5f444e[_0x4d9c08];return _0x2cede0;}const database_1=__importDefault(require('../config/database')),plisioService_1=require('./gateways/plisioService'),rapydService_1=require(a81_0x118b53(0x1cb)),nodaService_1=require(a81_0x118b53(0x2ad)),coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a81_0x118b53(0x2b6)),klymeService_1=require(a81_0x118b53(0x1e9)),mastercardService_1=require(a81_0x118b53(0x231)),amerService_1=require(a81_0x118b53(0x1a0)),ampayService_1=require('./gateways/ampayService'),ampayTRYService_1=require('./gateways/ampayTRYService'),maxParaService_1=require('./gateways/maxParaService'),oxapayService_1=require(a81_0x118b53(0x165)),telegramBotService_1=require(a81_0x118b53(0x16c)),currencyService_1=require(a81_0x118b53(0x199)),loggerService_1=require('./loggerService');class WebhookService{constructor(){const _0x47aa62=a81_0x118b53;this[_0x47aa62(0x1e5)]=new plisioService_1[(_0x47aa62(0x255))](),this[_0x47aa62(0x214)]=new rapydService_1[(_0x47aa62(0x217))](),this[_0x47aa62(0x192)]=new nodaService_1[(_0x47aa62(0x27a))](),this[_0x47aa62(0x173)]=new coinToPayService_1[(_0x47aa62(0x2b8))](),this[_0x47aa62(0x1c8)]=new coinToPay2Service_1[(_0x47aa62(0x2bd))](),this[_0x47aa62(0x247)]=new klymeService_1[(_0x47aa62(0x1e4))](),this[_0x47aa62(0x276)]=new mastercardService_1[(_0x47aa62(0x1fe))](),this[_0x47aa62(0x2aa)]=new amerService_1[(_0x47aa62(0x1a4))](),this[_0x47aa62(0x197)]=new ampayService_1[(_0x47aa62(0x230))](),this[_0x47aa62(0x245)]=new ampayTRYService_1[(_0x47aa62(0x25d))](),this[_0x47aa62(0x1ec)]=new maxParaService_1['MaxParaService']({'apiKey':process['env'][_0x47aa62(0x1f6)]||_0x47aa62(0x18b),'secretKey':process['env'][_0x47aa62(0x2af)]||_0x47aa62(0x1b0),'baseUrl':process[_0x47aa62(0x17e)][_0x47aa62(0x2a1)]||_0x47aa62(0x26f)}),this[_0x47aa62(0x18d)]=new oxapayService_1[(_0x47aa62(0x207))]();}async[a81_0x118b53(0x296)](_0xcdff41,_0x1c4e58,_0x6e7038){const _0x1a174b=a81_0x118b53;console[_0x1a174b(0x1d9)](_0x1a174b(0x285)+_0xcdff41+',\x20newStatus='+_0x1c4e58),console[_0x1a174b(0x1d9)](_0x1a174b(0x162),_0x6e7038),await database_1[_0x1a174b(0x2c2)][_0x1a174b(0x21d)](async _0x7c4e66=>{const _0x398439=_0x1a174b,_0x239ff7=await _0x7c4e66[_0x398439(0x1c5)][_0x398439(0x2b5)]({'where':{'id':_0xcdff41},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x239ff7)throw new Error(_0x398439(0x234)+_0xcdff41+_0x398439(0x260));const _0x324f2b=_0x239ff7[_0x398439(0x1b4)],_0x26f29f=_0x239ff7[_0x398439(0x1b5)];console[_0x398439(0x1d9)](_0x398439(0x264)+_0xcdff41+':\x20'+_0x324f2b+_0x398439(0x25e)+_0x1c4e58),console[_0x398439(0x1d9)](_0x398439(0x183)+_0x26f29f[_0x398439(0x28f)]+'\x20current\x20balance:\x20'+_0x26f29f[_0x398439(0x1c3)]+_0x398439(0x238));const _0x5d6102={'status':_0x1c4e58[_0x398439(0x282)](),'updatedAt':new Date(),'statusChangedBy':_0x398439(0x232),'statusChangedAt':new Date()};_0x6e7038?.[_0x398439(0x1f1)]&&(_0x5d6102[_0x398439(0x1f1)]=_0x6e7038[_0x398439(0x1f1)]);_0x6e7038?.[_0x398439(0x26e)]&&(_0x5d6102[_0x398439(0x26e)]=JSON[_0x398439(0x1b2)](_0x6e7038[_0x398439(0x26e)]));_0x6e7038?.[_0x398439(0x22c)]&&(_0x5d6102[_0x398439(0x22c)]=_0x6e7038[_0x398439(0x22c)]);_0x6e7038?.[_0x398439(0x1a8)]&&(_0x5d6102[_0x398439(0x1a8)]=_0x6e7038[_0x398439(0x1a8)]);_0x6e7038?.[_0x398439(0x258)]&&(_0x5d6102[_0x398439(0x258)]=_0x6e7038[_0x398439(0x258)]);_0x6e7038?.['bankId']&&(_0x5d6102[_0x398439(0x190)]=_0x6e7038[_0x398439(0x190)]);_0x6e7038?.[_0x398439(0x17c)]&&(_0x5d6102[_0x398439(0x17c)]=_0x6e7038[_0x398439(0x17c)]);_0x6e7038?.[_0x398439(0x246)]&&(_0x5d6102[_0x398439(0x246)]=_0x6e7038[_0x398439(0x246)]);let _0xcaee46=_0x26f29f[_0x398439(0x1c3)],_0x2f953b='';if(_0x1c4e58[_0x398439(0x282)]()===_0x398439(0x25b)&&_0x324f2b!==_0x398439(0x25b)){const _0x440c04=await currencyService_1[_0x398439(0x27e)]['convertToUSDT'](_0x239ff7[_0x398439(0x22d)],_0x239ff7[_0x398439(0x22b)]),_0x5a2c43=await this['getGatewayCommission'](_0x26f29f['id'],_0x239ff7[_0x398439(0x171)]),_0x17472a=_0x440c04*(0x1-_0x5a2c43/0x64);_0xcaee46+=_0x17472a,_0x2f953b='+'+_0x17472a['toFixed'](0x6)+_0x398439(0x1e8)+_0x5a2c43+_0x398439(0x219),_0x5d6102[_0x398439(0x1ff)]=_0x440c04,_0x5d6102['amountAfterGatewayCommissionUSDT']=_0x17472a,_0x5d6102[_0x398439(0x1dc)]=_0x5a2c43,_0x5d6102[_0x398439(0x28c)]=new Date(),console[_0x398439(0x1d9)](_0x398439(0x273)+_0x239ff7[_0x398439(0x22d)]+'\x20'+_0x239ff7[_0x398439(0x22b)]+_0x398439(0x25e)+_0x440c04[_0x398439(0x261)](0x6)+_0x398439(0x238)),console['log']('üí∞\x20Gateway\x20'+_0x239ff7[_0x398439(0x171)]+'\x20commission:\x20'+_0x5a2c43+'%'),console[_0x398439(0x1d9)](_0x398439(0x1a9)+_0x17472a[_0x398439(0x261)](0x6)+_0x398439(0x238)),console[_0x398439(0x1d9)](_0x398439(0x243)+_0x26f29f['balance']+_0x398439(0x1d8)+_0x17472a[_0x398439(0x261)](0x6)+_0x398439(0x240)+_0xcaee46[_0x398439(0x261)](0x6)+_0x398439(0x238));}else{if(_0x324f2b===_0x398439(0x25b)&&_0x1c4e58[_0x398439(0x282)]()!==_0x398439(0x25b)&&_0x1c4e58['toUpperCase']()!==_0x398439(0x278)){let _0x4f7eb7;if(_0x239ff7['amountAfterGatewayCommissionUSDT'])_0x4f7eb7=_0x239ff7[_0x398439(0x21e)];else{if(_0x239ff7[_0x398439(0x1ff)]){const _0x1436bc=await this['getGatewayCommission'](_0x26f29f['id'],_0x239ff7['gateway']);_0x4f7eb7=_0x239ff7[_0x398439(0x1ff)]*(0x1-_0x1436bc/0x64);}else console[_0x398439(0x1d9)](_0x398439(0x16b)),_0x4f7eb7=0x0;}_0x4f7eb7>0x0&&(_0xcaee46-=_0x4f7eb7,_0x2f953b='-'+_0x4f7eb7[_0x398439(0x261)](0x6)+'\x20USDT\x20(payment\x20no\x20longer\x20PAID)',_0x5d6102[_0x398439(0x28c)]=null,console[_0x398439(0x1d9)](_0x398439(0x23b)+_0x26f29f[_0x398439(0x1c3)]+_0x398439(0x299)+_0x4f7eb7[_0x398439(0x261)](0x6)+_0x398439(0x240)+_0xcaee46[_0x398439(0x261)](0x6)+_0x398439(0x238)));}}if(_0x1c4e58['toUpperCase']()===_0x398439(0x278)){const _0x37ca9f=_0x6e7038?.[_0x398439(0x1b3)]||0x0;console[_0x398439(0x1d9)](_0x398439(0x1d6)),_0x37ca9f>0x0?(_0xcaee46-=_0x37ca9f,_0x2f953b='-'+_0x37ca9f['toFixed'](0x6)+_0x398439(0x259),_0x5d6102['chargebackAmount']=_0x37ca9f,console[_0x398439(0x1d9)](_0x398439(0x293)+_0x37ca9f[_0x398439(0x261)](0x6)+_0x398439(0x238)),console[_0x398439(0x1d9)](_0x398439(0x1ef)),console[_0x398439(0x1d9)](_0x398439(0x2c1)+_0xcaee46[_0x398439(0x261)](0x6)+_0x398439(0x238))):(console[_0x398439(0x1d9)]('‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x2f953b=_0x398439(0x221));}const _0xa73bca=await _0x7c4e66[_0x398439(0x1c5)][_0x398439(0x23a)]({'where':{'id':_0xcdff41},'data':_0x5d6102});_0xcaee46!==_0x26f29f['balance']&&(await _0x7c4e66[_0x398439(0x1b5)][_0x398439(0x23a)]({'where':{'id':_0x26f29f['id']},'data':{'balance':_0xcaee46}}),console[_0x398439(0x1d9)](_0x398439(0x28e)+_0x26f29f['username']+_0x398439(0x29b)+_0x26f29f[_0x398439(0x1c3)][_0x398439(0x261)](0x6)+'\x20->\x20'+_0xcaee46[_0x398439(0x261)](0x6)+'\x20USDT'),console[_0x398439(0x1d9)]('üìù\x20Reason:\x20'+_0x2f953b));await _0x7c4e66[_0x398439(0x1f5)][_0x398439(0x1d2)]({'data':{'paymentId':_0xcdff41,'shopId':_0x26f29f['id'],'event':_0x398439(0x22e)+_0x1c4e58[_0x398439(0x222)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x324f2b,'newStatus':_0x1c4e58[_0x398439(0x282)](),'balanceChange':_0x2f953b||_0x398439(0x1f3),'oldBalance':_0x26f29f[_0x398439(0x1c3)],'newBalance':_0xcaee46,'amountUSDT':_0x5d6102[_0x398439(0x1ff)],'additionalData':_0x6e7038,'timestamp':new Date()[_0x398439(0x182)]()})}}),await this[_0x398439(0x275)]({..._0x239ff7,..._0xa73bca,'shop':_0x26f29f},_0x1c4e58[_0x398439(0x282)]()),await this[_0x398439(0x2a9)]({..._0x239ff7,..._0xa73bca},_0x1c4e58[_0x398439(0x282)]());if(_0x324f2b!==_0x398439(0x25b)&&_0x1c4e58['toUpperCase']()===_0x398439(0x25b)){console[_0x398439(0x1d9)]('üìà\x20Payment\x20'+_0xcdff41+_0x398439(0x290)),console['log'](_0x398439(0x233)+_0x324f2b+_0x398439(0x266)+_0x1c4e58[_0x398439(0x282)]()+_0x398439(0x17f)+_0x239ff7[_0x398439(0x1da)]+'\x22');if(_0x239ff7[_0x398439(0x1da)])try{const _0x2b69e8=await _0x7c4e66[_0x398439(0x1e6)][_0x398439(0x2b5)]({'where':{'id':_0x239ff7['paymentLinkId']},'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}});if(_0x2b69e8){console['log'](_0x398439(0x220)+_0x2b69e8['id']+_0x398439(0x1a3)+_0x2b69e8[_0x398439(0x281)]+_0x398439(0x198)+_0x2b69e8[_0x398439(0x209)]+_0x398439(0x18e)+_0x2b69e8[_0x398439(0x1b4)]);const _0x215ab2=_0x2b69e8['currentPayments']+0x1,_0x5279a2=_0x2b69e8[_0x398439(0x281)]===_0x398439(0x251)?_0x398439(0x1b1):_0x2b69e8[_0x398439(0x1b4)];await _0x7c4e66[_0x398439(0x1e6)]['update']({'where':{'id':_0x239ff7[_0x398439(0x1da)]},'data':{'currentPayments':_0x215ab2,'status':_0x5279a2,'updatedAt':new Date()}}),console[_0x398439(0x1d9)](_0x398439(0x187)+_0x2b69e8['id']+_0x398439(0x262)+_0x2b69e8['currentPayments']+_0x398439(0x25e)+_0x215ab2+_0x398439(0x18e)+_0x2b69e8[_0x398439(0x1b4)]+'\x20->\x20'+_0x5279a2);}else console[_0x398439(0x1d9)]('‚ùå\x20Payment\x20link\x20'+_0x239ff7['paymentLinkId']+_0x398439(0x260));}catch(_0x26aeb5){console[_0x398439(0x1bf)](_0x398439(0x16f),_0x26aeb5);}else console['log'](_0x398439(0x205)+_0xcdff41+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}else console['log']('üìà\x20Payment\x20'+_0xcdff41+'\x20status\x20change\x20does\x20not\x20trigger\x20payment\x20link\x20counter\x20update:\x20'+_0x324f2b+_0x398439(0x25e)+_0x1c4e58[_0x398439(0x282)]());});}async['processPlisioWebhook'](_0x5d2a4a){const _0x3673a6=a81_0x118b53;console[_0x3673a6(0x1d9)](_0x3673a6(0x27f),_0x5d2a4a);try{const _0x59d9e9=await this[_0x3673a6(0x1e5)][_0x3673a6(0x1fb)](_0x5d2a4a);if(!_0x59d9e9[_0x3673a6(0x193)])throw new Error(_0x3673a6(0x1ad));const _0x208cd8=await database_1['default']['payment'][_0x3673a6(0x254)]({'where':{'gatewayOrderId':_0x59d9e9['paymentId']}});if(!_0x208cd8){console[_0x3673a6(0x1bf)](_0x3673a6(0x2b1)+_0x59d9e9['paymentId']);return;}console[_0x3673a6(0x1d9)](_0x3673a6(0x194)+_0x208cd8['id']+'\x20status\x20'+_0x59d9e9['status']),await this[_0x3673a6(0x296)](_0x208cd8['id'],_0x59d9e9[_0x3673a6(0x1b4)],{'txUrls':_0x59d9e9[_0x3673a6(0x26e)]}),loggerService_1[_0x3673a6(0x239)][_0x3673a6(0x181)](_0x3673a6(0x1ac),_0x208cd8['id'],_0x208cd8['status'],_0x59d9e9[_0x3673a6(0x1b4)],_0x5d2a4a);}catch(_0x233a7e){console[_0x3673a6(0x1bf)](_0x3673a6(0x2a6),_0x233a7e),loggerService_1[_0x3673a6(0x239)][_0x3673a6(0x286)]('plisio',_0x233a7e,_0x5d2a4a);throw _0x233a7e;}}async[a81_0x118b53(0x2a3)](_0x330468){const _0x266028=a81_0x118b53;console[_0x266028(0x1d9)](_0x266028(0x1b9),_0x330468);try{const _0x73ef31=await this[_0x266028(0x1e5)][_0x266028(0x1fb)](_0x330468);if(!_0x73ef31[_0x266028(0x193)])throw new Error(_0x266028(0x17b));const _0x439873=await database_1['default'][_0x266028(0x1c5)][_0x266028(0x254)]({'where':{'gatewayOrderId':_0x73ef31[_0x266028(0x193)]}});if(!_0x439873){console['error']('Payment\x20not\x20found\x20for\x20Plisio\x20Gateway\x20webhook:\x20'+_0x73ef31[_0x266028(0x193)]);return;}console['log'](_0x266028(0x2b9)+_0x439873['id']+_0x266028(0x21a)+_0x73ef31[_0x266028(0x1b4)]),await this[_0x266028(0x296)](_0x439873['id'],_0x73ef31[_0x266028(0x1b4)],{'txUrls':_0x73ef31[_0x266028(0x26e)]}),loggerService_1['loggerService'][_0x266028(0x181)](_0x266028(0x284),_0x439873['id'],_0x439873['status'],_0x73ef31[_0x266028(0x1b4)],_0x330468);}catch(_0x5b70ab){console[_0x266028(0x1bf)](_0x266028(0x1ca),_0x5b70ab),loggerService_1[_0x266028(0x239)][_0x266028(0x286)]('plisio_gateway',_0x5b70ab,_0x330468);throw _0x5b70ab;}}async[a81_0x118b53(0x172)](_0x1f8691){const _0x354dcb=a81_0x118b53;console[_0x354dcb(0x1d9)](_0x354dcb(0x211),_0x1f8691);try{const _0x277756=await this[_0x354dcb(0x214)][_0x354dcb(0x1fb)](_0x1f8691);if(!_0x277756[_0x354dcb(0x193)])throw new Error(_0x354dcb(0x242));const _0xc62320=await database_1[_0x354dcb(0x2c2)]['payment'][_0x354dcb(0x254)]({'where':{'gatewayOrderId':_0x277756['paymentId']}});if(!_0xc62320){console[_0x354dcb(0x1bf)](_0x354dcb(0x27d)+_0x277756[_0x354dcb(0x193)]);return;}console[_0x354dcb(0x1d9)](_0x354dcb(0x184)+_0xc62320['id']+_0x354dcb(0x21a)+_0x277756['status']),await this['updatePaymentStatus'](_0xc62320['id'],_0x277756[_0x354dcb(0x1b4)],{'failureMessage':_0x277756[_0x354dcb(0x1f1)],'cardLast4':_0x277756['additionalInfo']?.['cardLast4'],'paymentMethod':_0x277756[_0x354dcb(0x2b2)]?.['paymentMethod']}),loggerService_1[_0x354dcb(0x239)][_0x354dcb(0x181)]('rapyd',_0xc62320['id'],_0xc62320['status'],_0x277756['status'],_0x1f8691);}catch(_0x396aba){console[_0x354dcb(0x1bf)](_0x354dcb(0x1ea),_0x396aba),loggerService_1[_0x354dcb(0x239)][_0x354dcb(0x286)]('rapyd',_0x396aba,_0x1f8691);throw _0x396aba;}}async[a81_0x118b53(0x277)](_0x272138){const _0x437ade=a81_0x118b53;console[_0x437ade(0x1d9)](_0x437ade(0x274),_0x272138);try{const _0x2b1325=await this[_0x437ade(0x192)][_0x437ade(0x1fb)](_0x272138);if(!_0x2b1325[_0x437ade(0x193)])throw new Error(_0x437ade(0x23f));const _0x5a233b=await database_1[_0x437ade(0x2c2)][_0x437ade(0x1c5)][_0x437ade(0x254)]({'where':{'gatewayOrderId':_0x2b1325['paymentId']}});if(!_0x5a233b){console[_0x437ade(0x1bf)](_0x437ade(0x24b)+_0x2b1325[_0x437ade(0x193)]);return;}console[_0x437ade(0x1d9)](_0x437ade(0x287)+_0x5a233b['id']+_0x437ade(0x21a)+_0x2b1325[_0x437ade(0x1b4)]),await this['updatePaymentStatus'](_0x5a233b['id'],_0x2b1325['status'],{'bankId':_0x2b1325[_0x437ade(0x2b2)]?.[_0x437ade(0x190)],'remitterIban':_0x2b1325[_0x437ade(0x2b2)]?.[_0x437ade(0x17c)],'remitterName':_0x2b1325[_0x437ade(0x2b2)]?.[_0x437ade(0x246)],'paymentMethod':'Open\x20Banking'}),loggerService_1[_0x437ade(0x239)][_0x437ade(0x181)](_0x437ade(0x1fa),_0x5a233b['id'],_0x5a233b[_0x437ade(0x1b4)],_0x2b1325[_0x437ade(0x1b4)],_0x272138);}catch(_0x25fa6d){console[_0x437ade(0x1bf)]('Error\x20processing\x20Noda\x20webhook:',_0x25fa6d),loggerService_1[_0x437ade(0x239)][_0x437ade(0x286)](_0x437ade(0x1fa),_0x25fa6d,_0x272138);throw _0x25fa6d;}}async[a81_0x118b53(0x2ba)](_0x35057c){const _0x9636c4=a81_0x118b53;console[_0x9636c4(0x1d9)](_0x9636c4(0x28d),_0x35057c);try{const _0x2bfaa2=await this[_0x9636c4(0x173)]['processWebhook'](_0x35057c);if(!_0x2bfaa2[_0x9636c4(0x193)])throw new Error('No\x20payment\x20ID\x20in\x20CoinToPay\x20webhook');const _0x51f978=await database_1[_0x9636c4(0x2c2)]['payment'][_0x9636c4(0x254)]({'where':{'gatewayOrderId':_0x2bfaa2['paymentId']}});if(!_0x51f978){console['error']('Payment\x20not\x20found\x20for\x20CoinToPay\x20webhook:\x20'+_0x2bfaa2[_0x9636c4(0x193)]);return;}console['log'](_0x9636c4(0x2a2)+_0x51f978['id']+'\x20status\x20'+_0x2bfaa2[_0x9636c4(0x1b4)]),await this['updatePaymentStatus'](_0x51f978['id'],_0x2bfaa2[_0x9636c4(0x1b4)],{'paymentMethod':_0x9636c4(0x265)}),loggerService_1[_0x9636c4(0x239)][_0x9636c4(0x181)](_0x9636c4(0x160),_0x51f978['id'],_0x51f978[_0x9636c4(0x1b4)],_0x2bfaa2[_0x9636c4(0x1b4)],_0x35057c);}catch(_0x104a60){console[_0x9636c4(0x1bf)](_0x9636c4(0x201),_0x104a60),loggerService_1[_0x9636c4(0x239)][_0x9636c4(0x286)](_0x9636c4(0x160),_0x104a60,_0x35057c);throw _0x104a60;}}async['processCoinToPay2Webhook'](_0x325143){const _0x470728=a81_0x118b53;console['log'](_0x470728(0x1f2),_0x325143);try{const _0x2830fb=await this[_0x470728(0x1c8)][_0x470728(0x1fb)](_0x325143);if(!_0x2830fb[_0x470728(0x193)])throw new Error('No\x20payment\x20ID\x20in\x20CoinToPay2\x20webhook');const _0x375785=await database_1['default'][_0x470728(0x1c5)][_0x470728(0x254)]({'where':{'gatewayOrderId':_0x2830fb[_0x470728(0x193)]}});if(!_0x375785){console[_0x470728(0x1bf)](_0x470728(0x203)+_0x2830fb[_0x470728(0x193)]);return;}console[_0x470728(0x1d9)]('üìä\x20CoinToPay2\x20webhook:\x20Payment\x20'+_0x375785['id']+_0x470728(0x21a)+_0x2830fb['status']),await this[_0x470728(0x296)](_0x375785['id'],_0x2830fb['status'],{'paymentMethod':_0x470728(0x265)}),loggerService_1[_0x470728(0x239)][_0x470728(0x181)](_0x470728(0x1d5),_0x375785['id'],_0x375785[_0x470728(0x1b4)],_0x2830fb[_0x470728(0x1b4)],_0x325143);}catch(_0x11c090){console[_0x470728(0x1bf)](_0x470728(0x1cf),_0x11c090),loggerService_1[_0x470728(0x239)][_0x470728(0x286)](_0x470728(0x1d5),_0x11c090,_0x325143);throw _0x11c090;}}async[a81_0x118b53(0x19a)](_0x3570e9){const _0x56c0d4=a81_0x118b53;console['log'](_0x56c0d4(0x178),_0x3570e9);try{const _0x9f40eb=await this[_0x56c0d4(0x247)][_0x56c0d4(0x1fb)](_0x3570e9);if(!_0x9f40eb[_0x56c0d4(0x193)])throw new Error(_0x56c0d4(0x170));const _0x13d3a9=await database_1[_0x56c0d4(0x2c2)][_0x56c0d4(0x1c5)]['findFirst']({'where':{'gatewayOrderId':_0x9f40eb['paymentId']}});if(!_0x13d3a9){console['error'](_0x56c0d4(0x2a4)+_0x9f40eb[_0x56c0d4(0x193)]);return;}console['log'](_0x56c0d4(0x1aa)+_0x13d3a9['id']+'\x20status\x20'+_0x9f40eb['status']),await this[_0x56c0d4(0x296)](_0x13d3a9['id'],_0x9f40eb[_0x56c0d4(0x1b4)],{'paymentMethod':_0x9f40eb['additionalInfo']?.[_0x56c0d4(0x180)]}),loggerService_1[_0x56c0d4(0x239)][_0x56c0d4(0x181)]('klyme',_0x13d3a9['id'],_0x13d3a9[_0x56c0d4(0x1b4)],_0x9f40eb[_0x56c0d4(0x1b4)],_0x3570e9);}catch(_0x113efe){console[_0x56c0d4(0x1bf)](_0x56c0d4(0x1d4),_0x113efe),loggerService_1[_0x56c0d4(0x239)]['logWebhookError']('klyme',_0x113efe,_0x3570e9);throw _0x113efe;}}async[a81_0x118b53(0x26a)](_0x29406d){const _0xed7513=a81_0x118b53;console[_0xed7513(0x1d9)]('üîÑ\x20Processing\x20VISA\x20webhook:',JSON['stringify'](_0x29406d,null,0x2));try{const _0x3b2ff5=await this[_0xed7513(0x276)][_0xed7513(0x1fb)](_0x29406d,'VISA');console[_0xed7513(0x1d9)](_0xed7513(0x1db),_0x3b2ff5);if(!_0x3b2ff5['paymentId']){console[_0xed7513(0x1bf)](_0xed7513(0x169)),console[_0xed7513(0x1bf)](_0xed7513(0x1fc),Object[_0xed7513(0x2bf)](_0x29406d));throw new Error('No\x20payment\x20ID\x20in\x20VISA\x20webhook');}let _0x56157b=null;console[_0xed7513(0x1d9)](_0xed7513(0x1e7)+_0x3b2ff5[_0xed7513(0x193)]);if(_0x3b2ff5[_0xed7513(0x193)]){console[_0xed7513(0x1d9)]('üîç\x20Trying\x20to\x20find\x20VISA\x20payment\x20by\x20various\x20fields...'),console[_0xed7513(0x1d9)](_0xed7513(0x18f)),console[_0xed7513(0x1d9)](_0xed7513(0x237)),console[_0xed7513(0x1d9)](_0xed7513(0x21b)+_0x3b2ff5[_0xed7513(0x193)]),console['log']('\x20\x20\x20-\x20Will\x20search\x20in:\x20gatewayPaymentId,\x20gatewayOrderId,\x20id,\x20orderId'),_0x56157b=await database_1['default'][_0xed7513(0x1c5)][_0xed7513(0x254)]({'where':{'AND':[{'OR':[{'gateway':_0xed7513(0x208)},{'gateway':'mastercard'}]},{'OR':[{'gatewayPaymentId':_0x3b2ff5[_0xed7513(0x193)]},{'gatewayOrderId':_0x3b2ff5[_0xed7513(0x193)]},{'id':_0x3b2ff5[_0xed7513(0x193)]},{'orderId':_0x3b2ff5['paymentId']}]}]},'include':{'shop':{'include':{'settings':!![]}}}}),console[_0xed7513(0x1d9)](_0xed7513(0x212));if(_0x56157b)console['log'](_0xed7513(0x215)+_0x56157b['id']+',\x20GatewayOrderId='+_0x56157b['gatewayOrderId']+',\x20GatewayPaymentId='+_0x56157b[_0xed7513(0x1f0)]);else{console[_0xed7513(0x1d9)]('‚ùå\x20No\x20payment\x20found,\x20checking\x20all\x20payments\x20for\x20debugging...');const _0x3357a5=await database_1[_0xed7513(0x2c2)][_0xed7513(0x1c5)][_0xed7513(0x295)]({'where':{'gateway':_0xed7513(0x208)},'select':{'id':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'orderId':!![],'cardLast4':!![],'status':!![]},'take':0xa,'orderBy':{'createdAt':_0xed7513(0x2be)}});console['log'](_0xed7513(0x235),_0x3357a5[_0xed7513(0x16d)](_0x36202f=>_0x36202f['id']+_0xed7513(0x1fd)+_0x36202f['orderId']+_0xed7513(0x29c)+_0x36202f[_0xed7513(0x1d3)]+_0xed7513(0x2a5)+_0x36202f[_0xed7513(0x1f0)]+',\x20card:\x20****'+_0x36202f[_0xed7513(0x22c)]+')'));}console[_0xed7513(0x1d9)](_0xed7513(0x188)+(_0x56157b?_0xed7513(0x248):_0xed7513(0x176))),_0x56157b&&console['log']('üîç\x20Found\x20VISA\x20payment:\x20ID='+_0x56157b['id']+_0xed7513(0x1ee)+_0x56157b[_0xed7513(0x171)]+_0xed7513(0x2a0)+_0x56157b['status']+',\x20Card=****'+_0x56157b[_0xed7513(0x22c)]);}if(!_0x56157b){console[_0xed7513(0x1bf)]('‚ùå\x20VISA\x20payment\x20not\x20found\x20for\x20ID:\x20'+_0x3b2ff5[_0xed7513(0x193)]),loggerService_1[_0xed7513(0x239)][_0xed7513(0x286)](_0xed7513(0x2a7),new Error(_0xed7513(0x1a7)+_0x3b2ff5['paymentId']),_0x29406d);throw new Error(_0xed7513(0x288)+_0x3b2ff5[_0xed7513(0x193)]);}console['log'](_0xed7513(0x292)+_0x56157b['id']+'\x20(Status:\x20'+_0x56157b[_0xed7513(0x1b4)]+_0xed7513(0x269)+_0x3b2ff5[_0xed7513(0x1b4)]+')');const _0x495f5c={};_0x3b2ff5[_0xed7513(0x22d)]&&await database_1[_0xed7513(0x2c2)][_0xed7513(0x1c5)]['update']({'where':{'id':_0x56157b['id']},'data':{'amount':_0x3b2ff5[_0xed7513(0x22d)],'updatedAt':new Date()}}),_0x3b2ff5[_0xed7513(0x22b)]&&await database_1[_0xed7513(0x2c2)]['payment']['update']({'where':{'id':_0x56157b['id']},'data':{'currency':_0x3b2ff5[_0xed7513(0x22b)],'updatedAt':new Date()}}),_0x3b2ff5['status']===_0xed7513(0x16e)&&_0x3b2ff5[_0xed7513(0x298)]&&(_0x495f5c['failureMessage']=_0x3b2ff5['errorMessage'],console[_0xed7513(0x1d9)](_0xed7513(0x25f)+_0x3b2ff5['errorMessage'])),_0x3b2ff5[_0xed7513(0x1a8)]&&(_0x495f5c['cardBrand']=_0x3b2ff5[_0xed7513(0x1a8)],console[_0xed7513(0x1d9)](_0xed7513(0x280)+_0x3b2ff5[_0xed7513(0x1a8)])),_0x495f5c[_0xed7513(0x258)]=_0xed7513(0x223),await this[_0xed7513(0x296)](_0x56157b['id'],_0x3b2ff5[_0xed7513(0x1b4)],_0x495f5c),await database_1[_0xed7513(0x2c2)]['webhookLog']['create']({'data':{'paymentId':_0x56157b['id'],'shopId':_0x56157b['shopId'],'event':_0xed7513(0x195)+_0x3b2ff5[_0xed7513(0x1b4)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0xed7513(0x1b2)](_0x3b2ff5)}}),await this[_0xed7513(0x2a9)](_0x56157b,_0x3b2ff5['status']['toUpperCase']()),console['log'](_0xed7513(0x21c)+_0x56157b['id']);}catch(_0x114167){console['error']('‚ùå\x20VISA\x20webhook\x20processing\x20failed:',_0x114167),loggerService_1[_0xed7513(0x239)][_0xed7513(0x286)](_0xed7513(0x2a7),_0x114167,_0x29406d);throw _0x114167;}}async['processMasterCardWebhook'](_0x35c42b){const _0x499b77=a81_0x118b53;console['log'](_0x499b77(0x270),JSON[_0x499b77(0x1b2)](_0x35c42b,null,0x2));try{const _0x1fea1b=await this['visaMasterCardService'][_0x499b77(0x1fb)](_0x35c42b,_0x499b77(0x1af));console[_0x499b77(0x1d9)](_0x499b77(0x1dd),_0x1fea1b);if(!_0x1fea1b[_0x499b77(0x193)]){console[_0x499b77(0x1bf)](_0x499b77(0x163)),console['error'](_0x499b77(0x1fc),Object[_0x499b77(0x2bf)](_0x35c42b));throw new Error(_0x499b77(0x241));}let _0x4f0bb7=null;console[_0x499b77(0x1d9)]('üîç\x20MasterCard\x20webhook:\x20Searching\x20for\x20payment\x20with\x20ID:\x20'+_0x1fea1b[_0x499b77(0x193)]);_0x1fea1b[_0x499b77(0x193)]&&(console[_0x499b77(0x1d9)]('üîç\x20Trying\x20to\x20find\x20MasterCard\x20payment\x20by\x20various\x20fields...'),_0x4f0bb7=await database_1['default'][_0x499b77(0x1c5)]['findFirst']({'where':{'AND':[{'OR':[{'gateway':_0x499b77(0x244)},{'gateway':_0x499b77(0x19c)},{'gateway':'visa/mastercard'}]},{'OR':[{'gatewayPaymentId':_0x1fea1b[_0x499b77(0x193)]},{'gatewayOrderId':_0x1fea1b['paymentId']},{'id':_0x1fea1b[_0x499b77(0x193)]},{'orderId':_0x1fea1b[_0x499b77(0x193)]}]}]}}),console[_0x499b77(0x1d9)](_0x499b77(0x1d1)+(_0x4f0bb7?_0x499b77(0x216)+_0x4f0bb7['id']:_0x499b77(0x2ae))));if(!_0x4f0bb7){console[_0x499b77(0x1bf)](_0x499b77(0x23c)+_0x1fea1b['paymentId']),console[_0x499b77(0x1bf)](_0x499b77(0x15c)+_0x1fea1b[_0x499b77(0x193)]+_0x499b77(0x1c6)+_0x1fea1b[_0x499b77(0x193)]+'\x22,\x20orderId=\x22'+_0x1fea1b[_0x499b77(0x193)]+'\x22');const _0x463a8f=await database_1[_0x499b77(0x2c2)]['payment'][_0x499b77(0x295)]({'where':{'OR':[{'gateway':_0x499b77(0x19c)},{'gateway':'visa_mastercard'},{'gateway':_0x499b77(0x208)}]},'select':{'id':!![],'gateway':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'orderId':!![],'status':!![]},'orderBy':{'id':'desc'},'take':0xf});console[_0x499b77(0x1d9)]('üîç\x20Available\x20VISA/MasterCard\x20payments\x20for\x20debugging:',_0x463a8f),loggerService_1['loggerService'][_0x499b77(0x286)]('mastercard',new Error(_0x499b77(0x1a7)+_0x1fea1b[_0x499b77(0x193)]),_0x35c42b);throw new Error(_0x499b77(0x1ae)+_0x1fea1b[_0x499b77(0x193)]);}console[_0x499b77(0x1d9)]('‚úÖ\x20Found\x20payment\x20'+_0x4f0bb7['id']+'\x20for\x20MasterCard\x20webhook,\x20updating\x20status\x20from\x20'+_0x4f0bb7[_0x499b77(0x1b4)]+_0x499b77(0x1cd)+_0x1fea1b[_0x499b77(0x1b4)]);const _0x114f37={};_0x1fea1b[_0x499b77(0x22d)]&&await database_1[_0x499b77(0x2c2)][_0x499b77(0x1c5)][_0x499b77(0x23a)]({'where':{'id':_0x4f0bb7['id']},'data':{'amount':_0x1fea1b['amount'],'updatedAt':new Date()}}),_0x1fea1b[_0x499b77(0x22b)]&&await database_1[_0x499b77(0x2c2)][_0x499b77(0x1c5)][_0x499b77(0x23a)]({'where':{'id':_0x4f0bb7['id']},'data':{'currency':_0x1fea1b[_0x499b77(0x22b)],'updatedAt':new Date()}}),_0x1fea1b[_0x499b77(0x1b4)]===_0x499b77(0x16e)&&_0x1fea1b[_0x499b77(0x298)]&&(_0x114f37[_0x499b77(0x1f1)]=_0x1fea1b[_0x499b77(0x298)],console[_0x499b77(0x1d9)](_0x499b77(0x1f8)+_0x1fea1b[_0x499b77(0x298)])),_0x1fea1b[_0x499b77(0x1a8)]&&(_0x114f37['cardBrand']=_0x1fea1b[_0x499b77(0x1a8)],console[_0x499b77(0x1d9)](_0x499b77(0x280)+_0x1fea1b[_0x499b77(0x1a8)])),_0x114f37[_0x499b77(0x258)]=_0x499b77(0x223),await this[_0x499b77(0x296)](_0x4f0bb7['id'],_0x1fea1b[_0x499b77(0x1b4)],_0x114f37),loggerService_1['loggerService'][_0x499b77(0x181)](_0x499b77(0x19c),_0x4f0bb7['id'],_0x4f0bb7[_0x499b77(0x1b4)],_0x1fea1b['status'],_0x35c42b);}catch(_0x4cf7f8){console[_0x499b77(0x1bf)](_0x499b77(0x189),_0x4cf7f8),loggerService_1[_0x499b77(0x239)][_0x499b77(0x286)](_0x499b77(0x19c),_0x4cf7f8,_0x35c42b);throw _0x4cf7f8;}}async[a81_0x118b53(0x17a)](_0x304983){const _0x12c823=a81_0x118b53;console[_0x12c823(0x1d9)](_0x12c823(0x256),JSON[_0x12c823(0x1b2)](_0x304983,null,0x2));try{const _0x2f7b36=await this[_0x12c823(0x2aa)]['processWebhook'](_0x304983);console['log']('üìä\x20Amer\x20webhook\x20result:',_0x2f7b36);if(!_0x2f7b36[_0x12c823(0x193)]){console['error']('‚ùå\x20No\x20payment\x20ID\x20extracted\x20from\x20Amer\x20webhook\x20data'),console['error']('‚ùå\x20Available\x20webhook\x20fields:',Object[_0x12c823(0x2bf)](_0x304983));throw new Error(_0x12c823(0x164));}let _0x5adeec=null;console[_0x12c823(0x1d9)](_0x12c823(0x1c2)+_0x2f7b36['paymentId']),_0x5adeec=await database_1[_0x12c823(0x2c2)]['payment']['findFirst']({'where':{'AND':[{'gateway':_0x12c823(0x15b)},{'OR':[{'gatewayPaymentId':_0x2f7b36['paymentId']},{'gatewayOrderId':_0x2f7b36[_0x12c823(0x193)]},{'id':_0x2f7b36[_0x12c823(0x193)]},{'orderId':_0x2f7b36[_0x12c823(0x193)]}]}]}}),console[_0x12c823(0x1d9)]('üîç\x20Search\x20result:\x20'+(_0x5adeec?_0x12c823(0x216)+_0x5adeec['id']:_0x12c823(0x2ae)));if(!_0x5adeec){console['error'](_0x12c823(0x24f)+_0x2f7b36['paymentId']);return;}console[_0x12c823(0x1d9)](_0x12c823(0x27b)+_0x5adeec['id']+_0x12c823(0x21a)+_0x2f7b36[_0x12c823(0x1b4)]),await this[_0x12c823(0x296)](_0x5adeec['id'],_0x2f7b36['status'],{'cardLast4':_0x2f7b36[_0x12c823(0x2b2)]?.[_0x12c823(0x22c)],'paymentMethod':_0x2f7b36[_0x12c823(0x2b2)]?.[_0x12c823(0x258)]});}catch(_0x49693d){console['error'](_0x12c823(0x20a),_0x49693d),loggerService_1[_0x12c823(0x239)][_0x12c823(0x286)](_0x12c823(0x15b),_0x49693d,_0x304983);throw _0x49693d;}}async[a81_0x118b53(0x25a)](_0x14e22c){const _0x205127=a81_0x118b53;console[_0x205127(0x1d9)](_0x205127(0x236),JSON[_0x205127(0x1b2)](_0x14e22c,null,0x2));try{const _0x25b9e7=_0x14e22c[_0x205127(0x1b4)],_0x5e0aea=_0x14e22c[_0x205127(0x1bd)],_0x26a548=_0x14e22c[_0x205127(0x1c7)],_0x2c80f7=_0x14e22c[_0x205127(0x180)],_0x2a78f0=_0x14e22c[_0x205127(0x22d)],_0x5e61fa=_0x14e22c[_0x205127(0x22b)],_0xd16a0c=_0x14e22c[_0x205127(0x1ce)],_0x1a5f33=_0x14e22c[_0x205127(0x1e0)];if(!_0x5e0aea){console['error']('‚ùå\x20No\x20client_transaction_id\x20found\x20in\x20AmPay\x20webhook');throw new Error(_0x205127(0x1c1));}console[_0x205127(0x1d9)]('üìä\x20AmPay\x20webhook\x20data:',{'status':_0x25b9e7,'clientTransactionId':_0x5e0aea,'systemId':_0x26a548,'paymentMethod':_0x2c80f7,'amount':_0x2a78f0,'currency':_0x5e61fa,'commission':_0xd16a0c,'statusAdditionInfo':_0x1a5f33});const _0x7878b0=await database_1[_0x205127(0x2c2)]['payment'][_0x205127(0x254)]({'where':{'OR':[{'gatewayOrderId':_0x5e0aea},{'orderId':_0x5e0aea},{'id':_0x5e0aea},{'gatewayPaymentId':_0x5e0aea}]},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x7878b0){console['error'](_0x205127(0x28a)+_0x5e0aea);throw new Error('Payment\x20not\x20found:\x20'+_0x5e0aea);}console[_0x205127(0x1d9)](_0x205127(0x15f)+_0x7878b0['id']+_0x205127(0x213)),console[_0x205127(0x1d9)](_0x205127(0x29e)+_0x7878b0['status']+'\x20‚Üí\x20'+_0x25b9e7),_0x25b9e7===_0x205127(0x2c4)?(console['log'](_0x205127(0x1b6)),await this[_0x205127(0x296)](_0x7878b0['id'],_0x205127(0x16e)),console[_0x205127(0x1d9)](_0x205127(0x15e)+_0x7878b0['id']+_0x205127(0x24e)),console[_0x205127(0x1d9)](_0x205127(0x271)+(_0x1a5f33||'No\x20additional\x20info'))):console[_0x205127(0x1d9)]('‚ÑπÔ∏è\x20AmPay\x20status\x20'+_0x25b9e7+_0x205127(0x1be)),await database_1[_0x205127(0x2c2)][_0x205127(0x1f5)][_0x205127(0x1d2)]({'data':{'paymentId':_0x7878b0['id'],'shopId':_0x7878b0[_0x205127(0x279)],'event':_0x205127(0x19b)+(_0x25b9e7?.[_0x205127(0x222)]()||_0x205127(0x1ed)),'statusCode':0xc8,'responseBody':JSON[_0x205127(0x1b2)](_0x14e22c)}}),loggerService_1[_0x205127(0x239)][_0x205127(0x181)](_0x205127(0x294),_0x7878b0['id'],_0x7878b0[_0x205127(0x1b4)],_0x25b9e7===_0x205127(0x2c4)?_0x205127(0x16e):_0x25b9e7,_0x14e22c);}catch(_0x5b4bc5){console['error'](_0x205127(0x2b4),_0x5b4bc5),loggerService_1[_0x205127(0x239)]['logWebhookError'](_0x205127(0x294),_0x5b4bc5,_0x14e22c);throw _0x5b4bc5;}}async[a81_0x118b53(0x1d0)](_0x54776c){const _0x5e9c14=a81_0x118b53;console[_0x5e9c14(0x1d9)](_0x5e9c14(0x22a),JSON['stringify'](_0x54776c,null,0x2));try{const _0x1a1f80=_0x54776c[_0x5e9c14(0x1b4)],_0x16f7f8=_0x54776c[_0x5e9c14(0x1bd)],_0x2a1351=_0x54776c[_0x5e9c14(0x1c7)],_0x3e0348=_0x54776c[_0x5e9c14(0x180)],_0x50b082=_0x54776c[_0x5e9c14(0x22d)],_0x4fe425=_0x54776c[_0x5e9c14(0x22b)],_0x3c1e39=_0x54776c[_0x5e9c14(0x1ce)],_0x473cb8=_0x54776c[_0x5e9c14(0x1e0)];if(!_0x16f7f8){console[_0x5e9c14(0x1bf)]('‚ùå\x20No\x20client_transaction_id\x20found\x20in\x20AmPay\x20TRY\x20webhook');throw new Error(_0x5e9c14(0x16a));}console[_0x5e9c14(0x1d9)](_0x5e9c14(0x272),{'status':_0x1a1f80,'clientTransactionId':_0x16f7f8,'systemId':_0x2a1351,'paymentMethod':_0x3e0348,'amount':_0x50b082,'currency':_0x4fe425,'commission':_0x3c1e39,'statusAdditionInfo':_0x473cb8});const _0x465e6e=await database_1[_0x5e9c14(0x2c2)]['payment'][_0x5e9c14(0x254)]({'where':{'OR':[{'gatewayOrderId':_0x16f7f8},{'orderId':_0x16f7f8},{'id':_0x16f7f8},{'gatewayPaymentId':_0x16f7f8}]},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x465e6e){console['error']('‚ùå\x20Payment\x20not\x20found\x20for\x20AmPay\x20TRY\x20client_transaction_id:\x20'+_0x16f7f8);throw new Error(_0x5e9c14(0x1a7)+_0x16f7f8);}console[_0x5e9c14(0x1d9)](_0x5e9c14(0x15f)+_0x465e6e['id']+'\x20for\x20AmPay\x20TRY\x20webhook'),console['log'](_0x5e9c14(0x29e)+_0x465e6e[_0x5e9c14(0x1b4)]+_0x5e9c14(0x269)+_0x1a1f80),_0x1a1f80==='DECLINED'?(console[_0x5e9c14(0x1d9)]('üîÑ\x20AmPay\x20TRY\x20status\x20DECLINED\x20mapped\x20to\x20FAILED'),await this[_0x5e9c14(0x296)](_0x465e6e['id'],_0x5e9c14(0x16e)),console['log'](_0x5e9c14(0x24c)+_0x465e6e['id']+_0x5e9c14(0x24e)),console['log']('‚ÑπÔ∏è\x20Decline\x20reason:\x20'+(_0x473cb8||'No\x20additional\x20info'))):console['log'](_0x5e9c14(0x2ab)+_0x1a1f80+'\x20-\x20no\x20action\x20taken\x20(only\x20DECLINED\x20is\x20processed)'),await database_1[_0x5e9c14(0x2c2)][_0x5e9c14(0x1f5)][_0x5e9c14(0x1d2)]({'data':{'paymentId':_0x465e6e['id'],'shopId':_0x465e6e[_0x5e9c14(0x279)],'event':_0x5e9c14(0x26b)+(_0x1a1f80?.['toLowerCase']()||_0x5e9c14(0x1ed)),'statusCode':0xc8,'responseBody':JSON[_0x5e9c14(0x1b2)](_0x54776c)}}),loggerService_1[_0x5e9c14(0x239)][_0x5e9c14(0x181)](_0x5e9c14(0x1de),_0x465e6e['id'],_0x465e6e[_0x5e9c14(0x1b4)],_0x1a1f80==='DECLINED'?'FAILED':_0x1a1f80,_0x54776c);}catch(_0x1dfe2d){console[_0x5e9c14(0x1bf)](_0x5e9c14(0x200),_0x1dfe2d),loggerService_1[_0x5e9c14(0x239)][_0x5e9c14(0x286)](_0x5e9c14(0x1de),_0x1dfe2d,_0x54776c);throw _0x1dfe2d;}}async[a81_0x118b53(0x275)](_0x3212c1,_0x85289c){const _0x3f44c2=a81_0x118b53,_0x24d9c9=Date['now']();try{const _0x3b5e61=_0x3212c1[_0x3f44c2(0x1b5)],_0x57c014=_0x3b5e61['settings'];if(!_0x57c014?.[_0x3f44c2(0x218)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x3b5e61['id']);return;}const _0x575b9d=_0x85289c===_0x3f44c2(0x25b)?'payment.success':_0x85289c===_0x3f44c2(0x16e)?_0x3f44c2(0x1f4):_0x85289c==='EXPIRED'?'payment.failed':_0x85289c===_0x3f44c2(0x278)?_0x3f44c2(0x1f4):_0x85289c===_0x3f44c2(0x2b3)?_0x3f44c2(0x1f4):_0x3f44c2(0x174);let _0x230df8=[];if(_0x57c014[_0x3f44c2(0x226)])try{_0x230df8=Array['isArray'](_0x57c014['webhookEvents'])?_0x57c014[_0x3f44c2(0x226)]:JSON['parse'](_0x57c014[_0x3f44c2(0x226)]);}catch(_0x3bea00){console['error'](_0x3f44c2(0x1e1),_0x3bea00),_0x230df8=[];}if(!_0x230df8[_0x3f44c2(0x2b0)](_0x575b9d)){console[_0x3f44c2(0x1d9)]('Webhook\x20event\x20'+_0x575b9d+_0x3f44c2(0x20f)+_0x3b5e61['id']);return;}const _0x519655={'event':_0x575b9d,'payment':{'id':_0x3212c1['id'],'order_id':_0x3212c1[_0x3f44c2(0x1df)],'gateway_order_id':_0x3212c1['gatewayOrderId'],'gateway':_0x3212c1[_0x3f44c2(0x171)],'amount':_0x3212c1[_0x3f44c2(0x22d)],'currency':_0x3212c1[_0x3f44c2(0x22b)],'status':_0x85289c[_0x3f44c2(0x222)](),'customer_email':_0x3212c1[_0x3f44c2(0x204)],'customer_name':_0x3212c1[_0x3f44c2(0x24a)],'failure_message':_0x3212c1[_0x3f44c2(0x1f1)],'tx_urls':_0x3212c1[_0x3f44c2(0x26e)]?JSON[_0x3f44c2(0x196)](_0x3212c1[_0x3f44c2(0x26e)]):null,'created_at':_0x3212c1[_0x3f44c2(0x2a8)],'updated_at':_0x3212c1[_0x3f44c2(0x23e)]}},_0xa94edc=await fetch(_0x57c014[_0x3f44c2(0x218)],{'method':_0x3f44c2(0x19d),'headers':{'Content-Type':_0x3f44c2(0x27c),'User-Agent':_0x3f44c2(0x250)},'body':JSON[_0x3f44c2(0x1b2)](_0x519655)}),_0x3a20e5=Date[_0x3f44c2(0x2c3)]()-_0x24d9c9,_0x40a934=_0xa94edc['ok']?_0x3f44c2(0x1bc):await _0xa94edc[_0x3f44c2(0x1b7)]();loggerService_1[_0x3f44c2(0x239)][_0x3f44c2(0x1a6)](_0x3212c1['shopId'],_0x57c014[_0x3f44c2(0x218)],_0x575b9d,_0xa94edc[_0x3f44c2(0x1b4)],_0x3a20e5,_0x519655),console[_0x3f44c2(0x1d9)](_0x3f44c2(0x175)+_0x57c014['webhookUrl']+_0x3f44c2(0x210)+_0xa94edc[_0x3f44c2(0x1b4)]+'\x20('+_0x3a20e5+_0x3f44c2(0x2b7));}catch(_0x39eb0b){console[_0x3f44c2(0x1bf)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x39eb0b),loggerService_1[_0x3f44c2(0x239)][_0x3f44c2(0x18c)](_0x3212c1[_0x3f44c2(0x279)],_0x3212c1['shop']?.[_0x3f44c2(0x225)]?.[_0x3f44c2(0x218)]||'unknown',_0x3f44c2(0x257),_0x39eb0b,{});}}async['sendPaymentStatusNotification'](_0x5714ba,_0x5afbe6){const _0x11f3a3=a81_0x118b53;try{const _0x5eb9ac={'PENDING':'created','PROCESSING':_0x11f3a3(0x206),'PAID':'paid','FAILED':_0x11f3a3(0x1ba),'EXPIRED':_0x11f3a3(0x253),'REFUND':_0x11f3a3(0x20c),'CHARGEBACK':_0x11f3a3(0x18a)},_0x4817bf=_0x5eb9ac[_0x5afbe6];if(!_0x4817bf||_0x4817bf==='created')return;await telegramBotService_1[_0x11f3a3(0x2bb)]['sendPaymentNotification'](_0x5714ba[_0x11f3a3(0x279)],_0x5714ba,_0x4817bf);}catch(_0x15dafb){console[_0x11f3a3(0x1bf)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x15dafb);}}async[a81_0x118b53(0x1ab)](_0x1e22f3,_0x5ffe3b){const _0x53245c=a81_0x118b53;try{const _0x33438a=await database_1['default'][_0x53245c(0x1b5)][_0x53245c(0x2b5)]({'where':{'id':_0x1e22f3},'select':{'gatewaySettings':!![]}});if(!_0x33438a?.[_0x53245c(0x177)])return console[_0x53245c(0x1d9)](_0x53245c(0x161)+_0x1e22f3+_0x53245c(0x26d)),0xa;const _0x11b188=JSON[_0x53245c(0x196)](_0x33438a['gatewaySettings']);for(const [_0x31e91a,_0x5d0d30]of Object['entries'](_0x11b188)){if(_0x31e91a[_0x53245c(0x222)]()===_0x5ffe3b['toLowerCase']()){const _0x31277d=_0x5d0d30['commission']||0xa;return console[_0x53245c(0x1d9)](_0x53245c(0x20e)+_0x5ffe3b+_0x53245c(0x29a)+_0x1e22f3+':\x20'+_0x31277d+'%'),_0x31277d;}}return console['log'](_0x53245c(0x268)+_0x5ffe3b+_0x53245c(0x191)+_0x1e22f3+_0x53245c(0x167)),0xa;}catch(_0x493525){return console[_0x53245c(0x1bf)](_0x53245c(0x29d)+_0x1e22f3+',\x20gateway\x20'+_0x5ffe3b+':',_0x493525),0xa;}}async[a81_0x118b53(0x263)](_0x242cca,_0x449d69){const _0x18fd6b=a81_0x118b53;console[_0x18fd6b(0x1d9)]('üîÑ\x20Processing\x20MyXSpend\x20webhook:'),console[_0x18fd6b(0x1d9)](_0x18fd6b(0x21f),JSON[_0x18fd6b(0x1b2)](_0x242cca,null,0x2)),console[_0x18fd6b(0x1d9)](_0x18fd6b(0x202),JSON[_0x18fd6b(0x1b2)](_0x449d69,null,0x2));try{const _0x1bc6ac=_0x242cca['customerOrderId']||_0x449d69['customerOrderId'],_0x3c896d=_0x242cca[_0x18fd6b(0x1b4)]||_0x449d69[_0x18fd6b(0x1b4)],_0x25da43=_0x242cca['amount']||_0x449d69[_0x18fd6b(0x22d)],_0x12c38f=_0x242cca[_0x18fd6b(0x22b)]||_0x449d69[_0x18fd6b(0x22b)],_0x30acdd=_0x242cca[_0x18fd6b(0x168)]||_0x449d69['dateTime'];if(!_0x1bc6ac){console[_0x18fd6b(0x1bf)](_0x18fd6b(0x179));throw new Error(_0x18fd6b(0x17d));}console[_0x18fd6b(0x1d9)](_0x18fd6b(0x25c),{'customerOrderId':_0x1bc6ac,'status':_0x3c896d,'amount':_0x25da43,'currency':_0x12c38f,'dateTime':_0x30acdd});const _0x42cde5=await database_1[_0x18fd6b(0x2c2)][_0x18fd6b(0x1c5)][_0x18fd6b(0x254)]({'where':{'OR':[{'gatewayOrderId':_0x1bc6ac},{'orderId':_0x1bc6ac},{'id':_0x1bc6ac},{'gatewayPaymentId':_0x1bc6ac}]},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x42cde5){console[_0x18fd6b(0x1bf)](_0x18fd6b(0x227)+_0x1bc6ac);throw new Error(_0x18fd6b(0x1a7)+_0x1bc6ac);}console[_0x18fd6b(0x1d9)](_0x18fd6b(0x15f)+_0x42cde5['id']+_0x18fd6b(0x186)),console[_0x18fd6b(0x1d9)](_0x18fd6b(0x29e)+_0x42cde5[_0x18fd6b(0x1b4)]+'\x20‚Üí\x20'+_0x3c896d);let _0x3d3e59=_0x3c896d?.[_0x18fd6b(0x282)]();_0x3c896d===_0x18fd6b(0x16e)||_0x3c896d===_0x18fd6b(0x267)?(_0x3d3e59='FAILED',console[_0x18fd6b(0x1d9)](_0x18fd6b(0x26c)+_0x3c896d+'\x20mapped\x20to\x20FAILED'),await this[_0x18fd6b(0x296)](_0x42cde5['id'],_0x3d3e59),console['log']('‚úÖ\x20MyXSpend\x20webhook\x20processed:\x20Payment\x20'+_0x42cde5['id']+_0x18fd6b(0x24e))):console[_0x18fd6b(0x1d9)](_0x18fd6b(0x291)+_0x3c896d+_0x18fd6b(0x1a5)),await database_1[_0x18fd6b(0x2c2)]['webhookLog'][_0x18fd6b(0x1d2)]({'data':{'paymentId':_0x42cde5['id'],'shopId':_0x42cde5[_0x18fd6b(0x279)],'event':'myxspend_'+(_0x3c896d?.[_0x18fd6b(0x222)]()||_0x18fd6b(0x1ed)),'statusCode':0xc8,'responseBody':JSON[_0x18fd6b(0x1b2)]({'queryParams':_0x242cca,'bodyData':_0x449d69})}}),loggerService_1['loggerService'][_0x18fd6b(0x181)](_0x18fd6b(0x23d),_0x42cde5['id'],_0x42cde5['status'],_0x3d3e59||_0x3c896d,{'queryParams':_0x242cca,'bodyData':_0x449d69});}catch(_0x1c1c7c){console[_0x18fd6b(0x1bf)]('‚ùå\x20Error\x20processing\x20MyXSpend\x20webhook:',_0x1c1c7c),loggerService_1[_0x18fd6b(0x239)][_0x18fd6b(0x286)](_0x18fd6b(0x23d),_0x1c1c7c,{'queryParams':_0x242cca,'bodyData':_0x449d69});throw _0x1c1c7c;}}async[a81_0x118b53(0x19f)](_0x32b84d){const _0x576271=a81_0x118b53;console[_0x576271(0x1d9)](_0x576271(0x1d7),_0x32b84d);try{const _0x2e7edd=this['maxParaService']['processWebhook'](_0x32b84d);if(!_0x2e7edd[_0x576271(0x193)])throw new Error(_0x576271(0x20b));const _0x2f343c=await database_1['default'][_0x576271(0x1c5)][_0x576271(0x254)]({'where':{'gatewayOrderId':_0x2e7edd['paymentId']}});if(!_0x2f343c){console[_0x576271(0x1bf)](_0x576271(0x224)+_0x2e7edd['paymentId']);return;}console[_0x576271(0x1d9)](_0x576271(0x19e)+_0x2f343c['id']+_0x576271(0x21a)+_0x2e7edd[_0x576271(0x1b4)]),await this['updatePaymentStatus'](_0x2f343c['id'],_0x2e7edd['status'],{'paymentMethod':_0x576271(0x1c4),'failureMessage':_0x2e7edd[_0x576271(0x2b2)]?.[_0x576271(0x252)]}),loggerService_1[_0x576271(0x239)][_0x576271(0x181)](_0x576271(0x1b8),_0x2f343c['id'],_0x2f343c[_0x576271(0x1b4)],_0x2e7edd['status'],_0x32b84d);}catch(_0x2a81a5){console['error'](_0x576271(0x185),_0x2a81a5),loggerService_1[_0x576271(0x239)][_0x576271(0x286)](_0x576271(0x1b8),_0x2a81a5,_0x32b84d);throw _0x2a81a5;}}async[a81_0x118b53(0x297)](_0x2b1e0d){const _0x1aca5f=a81_0x118b53;console[_0x1aca5f(0x1d9)](_0x1aca5f(0x1f7),_0x2b1e0d);try{const {track_id:_0x11ac4f,status:_0x36b2df,order_id:_0x3796de,txs:_0xfd122f}=_0x2b1e0d;if(!_0x3796de)throw new Error(_0x1aca5f(0x2bc));const _0x11c2df=await database_1['default'][_0x1aca5f(0x1c5)][_0x1aca5f(0x254)]({'where':{'gatewayOrderId':_0x3796de}});if(!_0x11c2df){console[_0x1aca5f(0x1bf)](_0x1aca5f(0x22f)+_0x3796de);return;}console[_0x1aca5f(0x1d9)](_0x1aca5f(0x249)+_0x11c2df['id']+_0x1aca5f(0x21a)+_0x36b2df);const _0x520411=this[_0x1aca5f(0x18d)][_0x1aca5f(0x229)](_0x36b2df),_0x3147cc=[];if(_0xfd122f&&Array[_0x1aca5f(0x1c0)](_0xfd122f))for(const _0x3db900 of _0xfd122f){_0x3db900[_0x1aca5f(0x15d)]&&_0x3147cc['push'](_0x3db900[_0x1aca5f(0x15d)]);}await this['updatePaymentStatus'](_0x11c2df['id'],_0x520411,{'txUrls':_0x3147cc[_0x1aca5f(0x20d)]>0x0?_0x3147cc:undefined}),loggerService_1[_0x1aca5f(0x239)][_0x1aca5f(0x181)](_0x1aca5f(0x289),_0x11c2df['id'],_0x11c2df['status'],_0x520411,_0x2b1e0d);}catch(_0x276414){console[_0x1aca5f(0x1bf)](_0x1aca5f(0x1cc),_0x276414),loggerService_1['loggerService'][_0x1aca5f(0x286)](_0x1aca5f(0x289),_0x276414,_0x2b1e0d);throw _0x276414;}}}exports['WebhookService']=WebhookService;