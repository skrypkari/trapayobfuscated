'use strict';const a86_0x3add2e=a86_0x409a;(function(_0x4cf1bd,_0x200402){const _0x248e5d=a86_0x409a,_0x38ca43=_0x4cf1bd();while(!![]){try{const _0x491282=parseInt(_0x248e5d(0x106))/0x1+-parseInt(_0x248e5d(0x155))/0x2+-parseInt(_0x248e5d(0x1a8))/0x3*(-parseInt(_0x248e5d(0x14e))/0x4)+-parseInt(_0x248e5d(0x1b9))/0x5*(-parseInt(_0x248e5d(0x133))/0x6)+parseInt(_0x248e5d(0x125))/0x7+parseInt(_0x248e5d(0x192))/0x8*(parseInt(_0x248e5d(0x1aa))/0x9)+-parseInt(_0x248e5d(0xf3))/0xa;if(_0x491282===_0x200402)break;else _0x38ca43['push'](_0x38ca43['shift']());}catch(_0x836c5d){_0x38ca43['push'](_0x38ca43['shift']());}}}(a86_0x16c2,0x4f5ec));var __importDefault=this&&this[a86_0x3add2e(0x130)]||function(_0x3e98d2){const _0x50190a=a86_0x3add2e;return _0x3e98d2&&_0x3e98d2[_0x50190a(0x19f)]?_0x3e98d2:{'default':_0x3e98d2};};function a86_0x409a(_0x1dbda2,_0x52d086){_0x1dbda2=_0x1dbda2-0xed;const _0x16c2db=a86_0x16c2();let _0x409a15=_0x16c2db[_0x1dbda2];return _0x409a15;}Object[a86_0x3add2e(0x140)](exports,a86_0x3add2e(0x19f),{'value':!![]}),exports[a86_0x3add2e(0x174)]=void 0x0;const database_1=__importDefault(require(a86_0x3add2e(0x137))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a86_0x3add2e(0x12b))),speakeasy_1=__importDefault(require(a86_0x3add2e(0xfb))),qrcode_1=__importDefault(require(a86_0x3add2e(0x172))),currencyService_1=require(a86_0x3add2e(0x152)),paymentService_1=require(a86_0x3add2e(0x128)),gateway_1=require(a86_0x3add2e(0x142));function a86_0x16c2(){const _0x46d38a=['custom_','getPayoutStatistics','\x20USDT\x20(current\x20balance)','CHARGEBACK','username','PAID','getPaymentByShopAndId','erc20_usdc','disable2FA','compare','wallets','_sum','getShopProfile','test','üìÖ\x20Period\x20end:\x20','qrcode','event','ShopService','Payment\x20not\x20found','language','REJECTED','toString','polygon','usdcPolygonWallet','Noda','amountAfterGatewayCommissionUSDT',',\x20dateFrom:\x20','telegram','gateway','toLowerCase','sourceCurrency','Shop\x20not\x20found','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','totalPaidOut','round','getUTCDay','yesterday','PaymentService','USDT\x20Polygon','backupCodes','twoFactorToken','setUTCDate','Plisio','last_week','merchantUrl','setHours','status','8rpYIPT','asc','TrapaPay','usdcErcWallet','payment','getTime','network','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','AVAILABLE_GATEWAYS','txid','getMonth','webhookLog','all','__esModule','createPublicPayment','üìä\x20Shop\x20','getPayoutById','desc','üìä\x20Status\x20filter:\x20','üìÖ\x20Date\x20start:\x20','Webhook\x20returned\x20error:\x20','hex','536283JkRWIu','\x20backup\x20codes','3282453aodICA','UTC','twoFactorEnabled','setDate','amountUSDT','\x20USDT','currency','dailyRevenue','lte','this_week','delete','base32','testWebhook','name','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','6115oHtuip','isActive','amount','shop','2FA\x20token\x20is\x20required','USDC\x20Ethereum','last_month','sha256','fullName','test_gateway','getPaymentById','Payment\x20System/1.0\x20(Test)','getShopPayoutStats','createdAt','paymentGateways','revenue','30d','polygon_usdc','periodFrom','üåê\x20Method\x20filter:\x20','application/json','digest','count','Failed\x20to\x20send\x20webhook:\x20','settings','usdtPolygonWallet','enable2FA','14457690EnIBNJ','paymentId','filter','Invalid\x202FA\x20token\x20or\x20backup\x20code','USDT\x20TRC20','POST','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','paidAt','speakeasy','getUTCMonth','toDataURL','verify','90d','payout','stringify','test_payment_123','all_time','includes','KLYME\x20EU','629768PxozAT','\x20USDT\x20(total\x20payouts)','trc20','usdtTrcWallet','REFUND','toUpperCase','twoFactorSecret','No\x20webhook\x20URL\x20configured','getDate','findMany','usdtErcWallet','EXPIRED','length','\x20\x20\x20üìÖ\x20This\x20month:\x20','COMPLETED','paymentService','error','redirectUrl','PENDING','parse','getWebhookLogs','reduce','2FA\x20is\x20already\x20enabled','üìÖ\x20Custom\x20date\x20range:\x20','startsWith','üìä\x20Getting\x20statistics\x20for\x20shop\x20','update','splice','gateways','publicKey','test_order_123','3852562ELIBsh','üìÖ\x20Custom\x20period:\x20','isArray','./paymentService','secretKey','dailyPayments','crypto','getUTCFullYear','split','awaitingPayout','push','__importDefault',',\x20period:\x20','statusCode','942BuyYHd','erc20','Error\x20parsing\x20webhook\x20events:','webhookEvents','../config/database','toISOString','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','log','Test\x20webhook\x20sent\x20successfully\x20(','replace','statusText','responseBody','generateSecret','defineProperty','default','../types/gateway','üåê\x20Network\x20filter:\x20','webhookUrl','gte','Unknown\x20error','findFirst','\x20\x20\x20üíµ\x20Available\x20balance:\x20','availableBalance','shopUrl','thisMonth','updateWallets','updateShopProfile','4YvEICJ','getUTCDate','map','setup2FA','./currencyService','customerName','TrapaPay\x20(','289508WJrsIm','this_month','telegramId','Rapyd','formatNetworkName','randomBytes','USDT\x20BSC','generateDailyStatistics','getFullYear','get','findUnique','periodTo','balance','gatewaySettings'];a86_0x16c2=function(){return _0x46d38a;};return a86_0x16c2();}class ShopService{constructor(){const _0x599f5b=a86_0x3add2e;this[_0x599f5b(0x115)]=new paymentService_1[(_0x599f5b(0x188))]();}async[a86_0x3add2e(0x16f)](_0x593ad3){const _0x4a5cfc=a86_0x3add2e,_0x362be6=await database_1[_0x4a5cfc(0x141)][_0x4a5cfc(0x1bc)][_0x4a5cfc(0x15f)]({'where':{'id':_0x593ad3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x362be6)throw new Error(_0x4a5cfc(0x182));let _0x31d619=[];if(_0x362be6[_0x4a5cfc(0xf0)]?.['webhookEvents'])try{_0x31d619=Array[_0x4a5cfc(0x127)](_0x362be6[_0x4a5cfc(0xf0)][_0x4a5cfc(0x136)])?_0x362be6[_0x4a5cfc(0xf0)][_0x4a5cfc(0x136)]:JSON[_0x4a5cfc(0x119)](_0x362be6[_0x4a5cfc(0xf0)][_0x4a5cfc(0x136)]);}catch(_0x203057){console[_0x4a5cfc(0x116)](_0x4a5cfc(0x135),_0x203057),_0x31d619=[];}const _0x34ef24=gateway_1[_0x4a5cfc(0x19a)][_0x4a5cfc(0xf5)](_0x52d1c6=>_0x52d1c6[_0x4a5cfc(0x1ba)])[_0x4a5cfc(0x150)](_0x8dfaef=>_0x8dfaef['name']);let _0x569e1a=_0x362be6[_0x4a5cfc(0x1c7)]?JSON[_0x4a5cfc(0x119)](_0x362be6[_0x4a5cfc(0x1c7)]):[];return Array['isArray'](_0x569e1a)&&(_0x569e1a=_0x569e1a['map'](_0x2c224a=>_0x2c224a['replace'](/\s+/g,'_')['toLowerCase']())[_0x4a5cfc(0xf5)](_0x1b7383=>_0x34ef24[_0x4a5cfc(0x104)](_0x1b7383))),{'id':_0x362be6['id'],'fullName':_0x362be6[_0x4a5cfc(0x1b7)],'username':_0x362be6[_0x4a5cfc(0x167)],'telegramId':_0x362be6[_0x4a5cfc(0x17e)],'merchantUrl':_0x362be6[_0x4a5cfc(0x14a)],'gateways':_0x569e1a,'gatewaySettings':_0x362be6[_0x4a5cfc(0x162)]?JSON['parse'](_0x362be6[_0x4a5cfc(0x162)]):null,'publicKey':_0x362be6[_0x4a5cfc(0x123)],'secretKey':_0x362be6[_0x4a5cfc(0x129)],'webhookUrl':_0x362be6[_0x4a5cfc(0xf0)]?.[_0x4a5cfc(0x144)]||null,'webhookEvents':_0x31d619,'wallets':{'usdtPolygonWallet':_0x362be6[_0x4a5cfc(0xf1)],'usdtTrcWallet':_0x362be6[_0x4a5cfc(0x109)],'usdtErcWallet':_0x362be6['usdtErcWallet'],'usdcPolygonWallet':_0x362be6[_0x4a5cfc(0x17a)],'usdcErcWallet':_0x362be6[_0x4a5cfc(0x195)]},'status':_0x362be6[_0x4a5cfc(0x191)],'createdAt':_0x362be6[_0x4a5cfc(0x1c6)]};}async[a86_0x3add2e(0x14d)](_0x231b71,_0x2b0c9c){const _0x4ae09b=a86_0x3add2e,_0x78a9b={};_0x2b0c9c[_0x4ae09b(0x1c1)]&&(_0x78a9b[_0x4ae09b(0x1b7)]=_0x2b0c9c['fullName']);_0x2b0c9c[_0x4ae09b(0x157)]!==undefined&&(_0x78a9b['telegram']=_0x2b0c9c[_0x4ae09b(0x157)]||null);_0x2b0c9c['merchantUrl']&&(_0x78a9b[_0x4ae09b(0x14a)]=_0x2b0c9c[_0x4ae09b(0x18f)]);_0x2b0c9c[_0x4ae09b(0x122)]&&(_0x78a9b[_0x4ae09b(0x1c7)]=JSON[_0x4ae09b(0x101)](_0x2b0c9c[_0x4ae09b(0x122)]));_0x2b0c9c['gatewaySettings']&&(_0x78a9b[_0x4ae09b(0x162)]=JSON[_0x4ae09b(0x101)](_0x2b0c9c['gatewaySettings']));_0x2b0c9c[_0x4ae09b(0x16d)]&&(_0x2b0c9c[_0x4ae09b(0x16d)][_0x4ae09b(0xf1)]!==undefined&&(_0x78a9b['usdtPolygonWallet']=_0x2b0c9c[_0x4ae09b(0x16d)][_0x4ae09b(0xf1)]||null),_0x2b0c9c[_0x4ae09b(0x16d)][_0x4ae09b(0x109)]!==undefined&&(_0x78a9b[_0x4ae09b(0x109)]=_0x2b0c9c[_0x4ae09b(0x16d)][_0x4ae09b(0x109)]||null),_0x2b0c9c[_0x4ae09b(0x16d)][_0x4ae09b(0x110)]!==undefined&&(_0x78a9b[_0x4ae09b(0x110)]=_0x2b0c9c[_0x4ae09b(0x16d)][_0x4ae09b(0x110)]||null),_0x2b0c9c[_0x4ae09b(0x16d)][_0x4ae09b(0x17a)]!==undefined&&(_0x78a9b[_0x4ae09b(0x17a)]=_0x2b0c9c['wallets'][_0x4ae09b(0x17a)]||null));const _0xb7366c=await database_1[_0x4ae09b(0x141)][_0x4ae09b(0x1bc)]['update']({'where':{'id':_0x231b71},'data':_0x78a9b,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0xaa6986=[];if(_0xb7366c[_0x4ae09b(0xf0)]?.[_0x4ae09b(0x136)])try{_0xaa6986=Array['isArray'](_0xb7366c['settings'][_0x4ae09b(0x136)])?_0xb7366c[_0x4ae09b(0xf0)][_0x4ae09b(0x136)]:JSON[_0x4ae09b(0x119)](_0xb7366c[_0x4ae09b(0xf0)][_0x4ae09b(0x136)]);}catch(_0x42a980){console[_0x4ae09b(0x116)](_0x4ae09b(0x135),_0x42a980),_0xaa6986=[];}return{'id':_0xb7366c['id'],'fullName':_0xb7366c[_0x4ae09b(0x1b7)],'username':_0xb7366c['username'],'telegramId':_0xb7366c['telegram'],'merchantUrl':_0xb7366c[_0x4ae09b(0x14a)],'gateways':_0xb7366c[_0x4ae09b(0x1c7)]?JSON['parse'](_0xb7366c[_0x4ae09b(0x1c7)]):null,'gatewaySettings':_0xb7366c[_0x4ae09b(0x162)]?JSON['parse'](_0xb7366c[_0x4ae09b(0x162)]):null,'publicKey':_0xb7366c[_0x4ae09b(0x123)],'secretKey':_0xb7366c[_0x4ae09b(0x129)],'webhookUrl':_0xb7366c[_0x4ae09b(0xf0)]?.['webhookUrl']||null,'webhookEvents':_0xaa6986,'wallets':{'usdtPolygonWallet':_0xb7366c[_0x4ae09b(0xf1)],'usdtTrcWallet':_0xb7366c[_0x4ae09b(0x109)],'usdtErcWallet':_0xb7366c[_0x4ae09b(0x110)],'usdcPolygonWallet':_0xb7366c[_0x4ae09b(0x17a)],'usdcErcWallet':_0xb7366c[_0x4ae09b(0x195)]},'status':_0xb7366c['status'],'createdAt':_0xb7366c[_0x4ae09b(0x1c6)]};}async[a86_0x3add2e(0x14c)](_0x5aab79,_0x4487ba){const _0x586d40=a86_0x3add2e,_0x3c818c=await database_1[_0x586d40(0x141)][_0x586d40(0x1bc)][_0x586d40(0x15f)]({'where':{'id':_0x5aab79},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x3c818c)throw new Error(_0x586d40(0x182));if(_0x3c818c[_0x586d40(0x1ac)]){if(!_0x4487ba[_0x586d40(0x18b)])throw new Error(_0x586d40(0x1bd));const _0x3c4bce=speakeasy_1['default']['totp']['verify']({'secret':_0x3c818c[_0x586d40(0x10c)],'encoding':'base32','token':_0x4487ba[_0x586d40(0x18b)],'window':0x2});if(!_0x3c4bce){let _0x50a8dd=![];if(_0x3c818c['backupCodes']){const _0x1e8c37=JSON[_0x586d40(0x119)](_0x3c818c[_0x586d40(0x18a)]);for(let _0x144b4b=0x0;_0x144b4b<_0x1e8c37[_0x586d40(0x112)];_0x144b4b++){const _0x49ef8d=await bcryptjs_1['default'][_0x586d40(0x16c)](_0x4487ba[_0x586d40(0x18b)],_0x1e8c37[_0x144b4b]);if(_0x49ef8d){_0x50a8dd=!![],_0x1e8c37[_0x586d40(0x121)](_0x144b4b,0x1),await database_1[_0x586d40(0x141)][_0x586d40(0x1bc)][_0x586d40(0x120)]({'where':{'id':_0x5aab79},'data':{'backupCodes':JSON[_0x586d40(0x101)](_0x1e8c37)}});break;}}}if(!_0x50a8dd)throw new Error(_0x586d40(0xf6));}}const _0x4f88d3={};_0x4487ba[_0x586d40(0xf1)]!==undefined&&(_0x4f88d3[_0x586d40(0xf1)]=_0x4487ba['usdtPolygonWallet']||null),_0x4487ba[_0x586d40(0x109)]!==undefined&&(_0x4f88d3['usdtTrcWallet']=_0x4487ba[_0x586d40(0x109)]||null),_0x4487ba[_0x586d40(0x110)]!==undefined&&(_0x4f88d3[_0x586d40(0x110)]=_0x4487ba[_0x586d40(0x110)]||null),_0x4487ba[_0x586d40(0x17a)]!==undefined&&(_0x4f88d3[_0x586d40(0x17a)]=_0x4487ba['usdcPolygonWallet']||null),_0x4487ba['usdcErcWallet']!==undefined&&(_0x4f88d3[_0x586d40(0x195)]=_0x4487ba[_0x586d40(0x195)]||null),await database_1['default'][_0x586d40(0x1bc)][_0x586d40(0x120)]({'where':{'id':_0x5aab79},'data':_0x4f88d3});}async[a86_0x3add2e(0x1b6)](_0x2200d5){const _0xd9d19f=a86_0x3add2e,_0x3126f3=await database_1[_0xd9d19f(0x141)][_0xd9d19f(0x1bc)][_0xd9d19f(0x15f)]({'where':{'id':_0x2200d5},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3126f3?.[_0xd9d19f(0xf0)]?.[_0xd9d19f(0x144)])throw new Error(_0xd9d19f(0x10d));const _0x439346={'event':_0xd9d19f(0x170),'payment':{'id':_0xd9d19f(0x102),'order_id':_0xd9d19f(0x124),'gateway':_0xd9d19f(0x170),'amount':0x64,'currency':'USD','status':'paid','created_at':new Date()[_0xd9d19f(0x138)]()}};try{const _0x13ef1c=JSON[_0xd9d19f(0x101)](_0x439346),_0x58d9b0=crypto_1[_0xd9d19f(0x141)]['createHmac'](_0xd9d19f(0x1c0),_0x3126f3[_0xd9d19f(0x129)])[_0xd9d19f(0x120)](_0x13ef1c)[_0xd9d19f(0xed)](_0xd9d19f(0x1a7)),_0x3b4a0d=await fetch(_0x3126f3[_0xd9d19f(0xf0)]['webhookUrl'],{'method':_0xd9d19f(0xf8),'headers':{'Content-Type':_0xd9d19f(0x1cd),'User-Agent':_0xd9d19f(0x1c4),'X-Webhook-Signature':_0x58d9b0},'body':_0x13ef1c});return _0x3b4a0d['ok']?{'success':!![],'message':_0xd9d19f(0x13b)+_0x3b4a0d[_0xd9d19f(0x191)]+')'}:{'success':![],'message':_0xd9d19f(0x1a6)+_0x3b4a0d['status']+'\x20'+_0x3b4a0d[_0xd9d19f(0x13d)]};}catch(_0x4095a9){return{'success':![],'message':_0xd9d19f(0xef)+(_0x4095a9 instanceof Error?_0x4095a9['message']:_0xd9d19f(0x146))};}}async['createPayment'](_0x4a09a0){const _0x5f5683=a86_0x3add2e;return this[_0x5f5683(0x115)][_0x5f5683(0x1a0)]({'public_key':'','gateway':_0x4a09a0['gateway'],'order_id':'','amount':_0x4a09a0['amount'],'currency':_0x4a09a0[_0x5f5683(0x1b0)],'source_currency':_0x4a09a0[_0x5f5683(0x181)],'success_url':_0x4a09a0[_0x5f5683(0x117)],'fail_url':_0x4a09a0['redirectUrl'],'customer_email':_0x4a09a0['customerEmail'],'customer_name':_0x4a09a0[_0x5f5683(0x153)],'language':_0x4a09a0[_0x5f5683(0x176)]});}async['getPayments'](_0x47994,_0x5aafa4){const _0x20d119=a86_0x3add2e;return this[_0x20d119(0x115)]['getPaymentsByShop'](_0x47994,_0x5aafa4);}async[a86_0x3add2e(0x1c3)](_0x1b91f9,_0x3a9139){const _0xdfc3a7=a86_0x3add2e;return this[_0xdfc3a7(0x115)][_0xdfc3a7(0x169)](_0x1b91f9,_0x3a9139);}async['updatePayment'](_0x1a1e41,_0x1c5304,_0x13ee5c){const _0x36fd2a=a86_0x3add2e,_0x121704=await database_1['default'][_0x36fd2a(0x196)][_0x36fd2a(0x147)]({'where':{'id':_0x1c5304,'shopId':_0x1a1e41}});if(!_0x121704)throw new Error(_0x36fd2a(0x175));const _0x178d08=await database_1[_0x36fd2a(0x141)][_0x36fd2a(0x196)]['update']({'where':{'id':_0x1c5304},'data':{..._0x13ee5c,'updatedAt':new Date()}});return _0x178d08;}async['deletePayment'](_0x460d90,_0x5a0bbb){const _0x1a54c3=a86_0x3add2e,_0x445db2=await database_1[_0x1a54c3(0x141)][_0x1a54c3(0x196)]['findFirst']({'where':{'id':_0x5a0bbb,'shopId':_0x460d90}});if(!_0x445db2)throw new Error(_0x1a54c3(0x175));await database_1[_0x1a54c3(0x141)]['payment'][_0x1a54c3(0x1b4)]({'where':{'id':_0x5a0bbb}});}[a86_0x3add2e(0x159)](_0x51ae6b){const _0x5399e3=a86_0x3add2e,_0x265230={'polygon':_0x5399e3(0x189),'trc20':_0x5399e3(0xf7),'erc20':'USDT\x20ERC20','bsc':_0x5399e3(0x15b),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x5399e3(0x1be)};return _0x265230[_0x51ae6b]||_0x51ae6b;}async['getPayouts'](_0x5afc55,_0x1d07f1){const _0x414746=a86_0x3add2e,{page:_0x5aabb3,limit:_0x25b980,status:_0x3095e6,method:_0x19b933,network:_0x10ea59,dateFrom:_0x3c8124,dateTo:_0x525644,periodFrom:_0x34becd,periodTo:_0x4b84bf}=_0x1d07f1,_0x457a0a=(_0x5aabb3-0x1)*_0x25b980;console[_0x414746(0x13a)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x1d07f1);const _0x4489b9={'shopId':_0x5afc55};_0x3095e6&&(_0x4489b9[_0x414746(0x191)]=_0x3095e6['toUpperCase'](),console[_0x414746(0x13a)](_0x414746(0x1a4)+_0x3095e6[_0x414746(0x10b)]()));if(_0x19b933)_0x4489b9[_0x414746(0x198)]=_0x19b933,console[_0x414746(0x13a)](_0x414746(0x1cc)+_0x19b933);else _0x10ea59&&(_0x4489b9[_0x414746(0x198)]=_0x10ea59,console[_0x414746(0x13a)](_0x414746(0x143)+_0x10ea59));if(_0x3c8124||_0x525644||_0x34becd||_0x4b84bf){_0x4489b9['createdAt']={};if(_0x34becd){const _0x5952a5=new Date(_0x34becd);_0x5952a5['setHours'](0x0,0x0,0x0,0x1),_0x4489b9[_0x414746(0x1c6)][_0x414746(0x145)]=_0x5952a5,console[_0x414746(0x13a)]('üìÖ\x20Period\x20start:\x20'+_0x5952a5[_0x414746(0x138)]());}else{if(_0x3c8124){const _0x31e2e0=new Date(_0x3c8124);_0x31e2e0[_0x414746(0x190)](0x0,0x0,0x0,0x1),_0x4489b9[_0x414746(0x1c6)][_0x414746(0x145)]=_0x31e2e0,console['log'](_0x414746(0x1a5)+_0x31e2e0['toISOString']());}}if(_0x4b84bf){const _0x2994e8=new Date(_0x4b84bf);_0x2994e8['setHours'](0x17,0x3b,0x3b,0x3e7),_0x4489b9[_0x414746(0x1c6)][_0x414746(0x1b2)]=_0x2994e8,console[_0x414746(0x13a)](_0x414746(0x171)+_0x2994e8[_0x414746(0x138)]());}else{if(_0x525644){const _0x1fc433=new Date(_0x525644);_0x1fc433[_0x414746(0x190)](0x17,0x3b,0x3b,0x3e7),_0x4489b9[_0x414746(0x1c6)][_0x414746(0x1b2)]=_0x1fc433,console['log']('üìÖ\x20Date\x20end:\x20'+_0x1fc433['toISOString']());}}}console['log']('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x414746(0x101)](_0x4489b9,null,0x2));const [_0x59f7c8,_0x9bf86]=await Promise['all']([database_1[_0x414746(0x141)][_0x414746(0x100)]['findMany']({'where':_0x4489b9,'skip':_0x457a0a,'take':_0x25b980,'orderBy':{'createdAt':_0x414746(0x1a3)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x414746(0x141)][_0x414746(0x100)][_0x414746(0xee)]({'where':_0x4489b9})]);return{'payouts':_0x59f7c8['map'](_0x180a7f=>{const _0x527a07=_0x414746;let _0x2174a1=null;switch(_0x180a7f['network']){case _0x527a07(0x179):_0x2174a1=_0x180a7f[_0x527a07(0x1bc)][_0x527a07(0xf1)];break;case _0x527a07(0x108):_0x2174a1=_0x180a7f['shop'][_0x527a07(0x109)];break;case _0x527a07(0x134):_0x2174a1=_0x180a7f[_0x527a07(0x1bc)][_0x527a07(0x110)];break;case _0x527a07(0x1ca):_0x2174a1=_0x180a7f[_0x527a07(0x1bc)][_0x527a07(0x17a)];break;case _0x527a07(0x16a):_0x2174a1=_0x180a7f['shop'][_0x527a07(0x195)];break;}return{'id':_0x180a7f['id'],'amount':_0x180a7f[_0x527a07(0x1bb)],'network':this[_0x527a07(0x159)](_0x180a7f[_0x527a07(0x198)]),'wallet':_0x2174a1,'status':_0x180a7f[_0x527a07(0x191)],'txid':_0x180a7f['txid'],'notes':_0x180a7f['notes'],'periodFrom':_0x180a7f[_0x527a07(0x1cb)],'periodTo':_0x180a7f[_0x527a07(0x160)],'createdAt':_0x180a7f[_0x527a07(0x1c6)],'paidAt':_0x180a7f['paidAt']};}),'pagination':{'page':_0x5aabb3,'limit':_0x25b980,'total':_0x9bf86,'totalPages':Math['ceil'](_0x9bf86/_0x25b980)}};}async[a86_0x3add2e(0x1a2)](_0x7d055c,_0x5aa992){const _0x1f3c99=a86_0x3add2e,_0x382fe1=await database_1[_0x1f3c99(0x141)][_0x1f3c99(0x100)][_0x1f3c99(0x147)]({'where':{'id':_0x5aa992,'shopId':_0x7d055c}});if(!_0x382fe1)return null;return{'id':_0x382fe1['id'],'amount':_0x382fe1[_0x1f3c99(0x1bb)],'network':_0x382fe1[_0x1f3c99(0x198)],'status':_0x382fe1[_0x1f3c99(0x191)],'txid':_0x382fe1['txid'],'notes':_0x382fe1['notes'],'createdAt':_0x382fe1[_0x1f3c99(0x1c6)],'paidAt':_0x382fe1[_0x1f3c99(0xfa)]};}async[a86_0x3add2e(0x164)](_0x41cd56,_0x1ec8ae){const _0x503b65=a86_0x3add2e,_0xebaeb5=new Date();let _0x29f746,_0x20d9fd;switch(_0x1ec8ae){case _0x503b65(0x187):case'YESTERDAY':const _0xa528ba=new Date(_0xebaeb5);_0xa528ba[_0x503b65(0x1ad)](_0xa528ba[_0x503b65(0x10e)]()-0x1),_0x29f746=new Date(_0xa528ba),_0x29f746[_0x503b65(0x190)](0x0,0x0,0x0,0x0),_0x20d9fd=new Date(_0xa528ba),_0x20d9fd[_0x503b65(0x190)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x29f746=new Date(_0xebaeb5[_0x503b65(0x197)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x503b65(0x1c9):_0x29f746=new Date(_0xebaeb5['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x503b65(0xff):_0x29f746=new Date(_0xebaeb5[_0x503b65(0x197)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x29f746=new Date(_0xebaeb5[_0x503b65(0x197)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x2f7832={'gte':_0x29f746};_0x20d9fd&&(_0x2f7832[_0x503b65(0x1b2)]=_0x20d9fd);const [_0x4e6517,_0xa045d2,_0x546a12,_0x47e913,_0x114089,_0x566002]=await Promise[_0x503b65(0x19e)]([database_1[_0x503b65(0x141)][_0x503b65(0x100)][_0x503b65(0xee)]({'where':{'shopId':_0x41cd56,'createdAt':_0x2f7832}}),database_1[_0x503b65(0x141)][_0x503b65(0x100)][_0x503b65(0xee)]({'where':{'shopId':_0x41cd56,'status':_0x503b65(0x114),'createdAt':_0x2f7832}}),database_1[_0x503b65(0x141)][_0x503b65(0x100)][_0x503b65(0xee)]({'where':{'shopId':_0x41cd56,'status':_0x503b65(0x118),'createdAt':_0x2f7832}}),database_1[_0x503b65(0x141)][_0x503b65(0x100)][_0x503b65(0xee)]({'where':{'shopId':_0x41cd56,'status':_0x503b65(0x177),'createdAt':_0x2f7832}}),database_1[_0x503b65(0x141)]['payout'][_0x503b65(0x10f)]({'where':{'shopId':_0x41cd56,'createdAt':_0x2f7832},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x503b65(0x141)][_0x503b65(0x100)][_0x503b65(0x10f)]({'where':{'shopId':_0x41cd56},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3efd73=_0x114089['reduce']((_0x2c7cd9,_0x3dfd52)=>_0x2c7cd9+_0x3dfd52['amount'],0x0),_0x8f9f74=_0x114089[_0x503b65(0xf5)](_0x20d985=>_0x20d985[_0x503b65(0x191)]===_0x503b65(0x114))[_0x503b65(0x11b)]((_0x5b7aa0,_0x14da50)=>_0x5b7aa0+_0x14da50[_0x503b65(0x1bb)],0x0),_0x297bfc=_0x114089[_0x503b65(0xf5)](_0x2c103=>_0x2c103[_0x503b65(0x191)]==='PENDING')['reduce']((_0x32c9da,_0x336937)=>_0x32c9da+_0x336937[_0x503b65(0x1bb)],0x0),_0x112f5f=_0x114089[_0x503b65(0x11b)]((_0x2f5ce4,_0x411029)=>{const _0xf0f04=_0x503b65;return _0x2f5ce4[_0x411029['network']]=(_0x2f5ce4[_0x411029[_0xf0f04(0x198)]]||0x0)+0x1,_0x2f5ce4;},{}),_0x571c3e=_0x114089[_0x503b65(0x11b)]((_0x7ae87,_0x5ce914)=>{const _0x73462b=_0x503b65;return _0x7ae87[_0x5ce914[_0x73462b(0x191)]]=(_0x7ae87[_0x5ce914[_0x73462b(0x191)]]||0x0)+0x1,_0x7ae87;},{});return{'totalPayouts':_0x4e6517,'completedPayouts':_0xa045d2,'pendingPayouts':_0x546a12,'rejectedPayouts':_0x47e913,'totalAmount':_0x3efd73,'completedAmount':_0x8f9f74,'pendingAmount':_0x297bfc,'payoutsByMethod':_0x112f5f,'payoutsByStatus':_0x571c3e,'recentPayouts':_0x566002['map'](_0x55311=>({'id':_0x55311['id'],'shopId':_0x41cd56,'amount':_0x55311[_0x503b65(0x1bb)],'method':_0x55311[_0x503b65(0x198)],'status':_0x55311[_0x503b65(0x191)],'txid':_0x55311[_0x503b65(0x19b)],'createdAt':_0x55311[_0x503b65(0x1c6)],'paidAt':_0x55311[_0x503b65(0xfa)]}))};}async[a86_0x3add2e(0x1c5)](_0x346221){const _0xdbb76f=a86_0x3add2e;console[_0xdbb76f(0x13a)](_0xdbb76f(0x1b8)+_0x346221+'...');const _0x2a97fc=await database_1[_0xdbb76f(0x141)][_0xdbb76f(0x1bc)][_0xdbb76f(0x15f)]({'where':{'id':_0x346221},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2a97fc)throw new Error(_0xdbb76f(0x182));const _0x1183c1=new Date(),_0x257712=new Date(_0x1183c1[_0xdbb76f(0x15d)](),_0x1183c1['getMonth'](),0x1),_0x5a8cf3=new Date(_0x1183c1[_0xdbb76f(0x15d)](),_0x1183c1[_0xdbb76f(0x19c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x8bbdb7=await database_1[_0xdbb76f(0x141)][_0xdbb76f(0x100)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x346221,'createdAt':{'gte':_0x257712,'lte':_0x5a8cf3},'status':_0xdbb76f(0x114)}}),_0x4c6c53=_0x8bbdb7[_0xdbb76f(0x16e)]['amount']||0x0,_0x314e69={'availableBalance':Math[_0xdbb76f(0x185)](_0x2a97fc['balance']*0x64)/0x64,'totalPaidOut':Math[_0xdbb76f(0x185)](_0x2a97fc[_0xdbb76f(0x184)]*0x64)/0x64,'awaitingPayout':Math[_0xdbb76f(0x185)](_0x2a97fc[_0xdbb76f(0x161)]*0x64)/0x64,'thisMonth':Math[_0xdbb76f(0x185)](_0x4c6c53*0x64)/0x64};return console[_0xdbb76f(0x13a)](_0xdbb76f(0x1a1)+_0x2a97fc[_0xdbb76f(0x167)]+'\x20payout\x20statistics\x20calculated:'),console[_0xdbb76f(0x13a)](_0xdbb76f(0x148)+_0x314e69[_0xdbb76f(0x149)]+_0xdbb76f(0x165)),console[_0xdbb76f(0x13a)](_0xdbb76f(0xf9)+_0x314e69['totalPaidOut']+_0xdbb76f(0x107)),console[_0xdbb76f(0x13a)](_0xdbb76f(0x139)+_0x314e69[_0xdbb76f(0x12e)]+'\x20USDT\x20(current\x20balance)'),console[_0xdbb76f(0x13a)](_0xdbb76f(0x113)+_0x314e69[_0xdbb76f(0x14b)]+_0xdbb76f(0x1af)),_0x314e69;}['getGatewayDisplayName'](_0x42acdd){const _0x1109ea=a86_0x3add2e,_0x39e725={'test_gateway':'Test\x20Gateway','plisio':_0x1109ea(0x18d),'rapyd':_0x1109ea(0x158),'noda':_0x1109ea(0x17b),'cointopay':'CoinToPay','klyme_eu':_0x1109ea(0x105),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x39e725[_0x42acdd]||_0x42acdd;}async['getPayoutStats'](_0x433711){const _0x521676=a86_0x3add2e;return this[_0x521676(0x1c5)](_0x433711);}async[a86_0x3add2e(0x11a)](_0x274ba1,_0x12bc84){const _0x4e31db=a86_0x3add2e,{page:_0x372ac3,limit:_0x253708,paymentId:_0x1d12df}=_0x12bc84,_0x1231d4=(_0x372ac3-0x1)*_0x253708,_0x5c6fd4={'shopId':_0x274ba1};_0x1d12df&&(_0x5c6fd4[_0x4e31db(0xf4)]=_0x1d12df);const [_0x6b0fb7,_0x5f3123]=await Promise[_0x4e31db(0x19e)]([database_1[_0x4e31db(0x141)][_0x4e31db(0x19d)][_0x4e31db(0x10f)]({'where':_0x5c6fd4,'skip':_0x1231d4,'take':_0x253708,'orderBy':{'createdAt':_0x4e31db(0x1a3)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x4e31db(0x141)][_0x4e31db(0x19d)][_0x4e31db(0xee)]({'where':_0x5c6fd4})]);return{'logs':_0x6b0fb7['map'](_0x4e7752=>({'id':_0x4e7752['id'],'paymentId':_0x4e7752[_0x4e31db(0xf4)],'shopId':_0x4e7752['shopId'],'event':_0x4e7752[_0x4e31db(0x173)],'statusCode':_0x4e7752[_0x4e31db(0x132)],'retryCount':_0x4e7752['retryCount'],'responseBody':_0x4e7752[_0x4e31db(0x13e)],'createdAt':_0x4e7752[_0x4e31db(0x1c6)],'payment':_0x4e7752[_0x4e31db(0x196)]})),'pagination':{'page':_0x372ac3,'limit':_0x253708,'total':_0x5f3123,'totalPages':Math['ceil'](_0x5f3123/_0x253708)}};}async['getStatistics'](_0x3a88f2,_0x2a614c,_0x2dcd37,_0x432e9d,_0x5c5478){const _0x4ab8b4=a86_0x3add2e;console['log'](_0x4ab8b4(0x11f)+_0x3a88f2+_0x4ab8b4(0x131)+_0x2a614c+_0x4ab8b4(0x17d)+_0x2dcd37+',\x20dateTo:\x20'+_0x432e9d);const _0x4f5b05=_0x5c5478?new Date(_0x5c5478):new Date();let _0x4006c6,_0x3b5bfc;if(_0x2dcd37&&_0x432e9d){const _0x377623=new Date(_0x2dcd37),_0x6b5aa6=new Date(_0x432e9d);_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](_0x377623[_0x4ab8b4(0x12c)](),_0x377623[_0x4ab8b4(0xfc)](),_0x377623[_0x4ab8b4(0x14f)](),0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x6b5aa6[_0x4ab8b4(0x12c)](),_0x6b5aa6['getUTCMonth'](),_0x6b5aa6['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x4ab8b4(0x13a)](_0x4ab8b4(0x11d)+_0x4006c6[_0x4ab8b4(0x138)]()+'\x20to\x20'+_0x3b5bfc[_0x4ab8b4(0x138)]());}else{if(_0x2a614c&&_0x2a614c[_0x4ab8b4(0x11e)](_0x4ab8b4(0x163))){const _0x1e701a=_0x2a614c[_0x4ab8b4(0x13c)](_0x4ab8b4(0x163),'')[_0x4ab8b4(0x12d)]('_');if(_0x1e701a[_0x4ab8b4(0x112)]===0x2){const _0x3299fa=new Date(_0x1e701a[0x0]),_0xe1b61d=new Date(_0x1e701a[0x1]);_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](_0x3299fa['getUTCFullYear'](),_0x3299fa[_0x4ab8b4(0xfc)](),_0x3299fa[_0x4ab8b4(0x14f)](),0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0xe1b61d[_0x4ab8b4(0x12c)](),_0xe1b61d['getUTCMonth'](),_0xe1b61d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x4ab8b4(0x13a)](_0x4ab8b4(0x126)+_0x4006c6[_0x4ab8b4(0x138)]()+'\x20to\x20'+_0x3b5bfc[_0x4ab8b4(0x138)]());}else{const _0xf4bc4=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),_0x4f5b05['getUTCDate']()-0x1e));_0x4006c6=new Date(Date['UTC'](_0xf4bc4[_0x4ab8b4(0x12c)](),_0xf4bc4['getUTCMonth'](),_0xf4bc4['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date['UTC'](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05['getUTCMonth'](),_0x4f5b05['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x7109b2=_0x2a614c||_0x4ab8b4(0x156);switch(_0x7109b2[_0x4ab8b4(0x180)]()){case'today':_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),_0x4f5b05[_0x4ab8b4(0x14f)](),0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05['getUTCFullYear'](),_0x4f5b05[_0x4ab8b4(0xfc)](),_0x4f5b05['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x220410=new Date(_0x4f5b05);_0x220410[_0x4ab8b4(0x18c)](_0x220410[_0x4ab8b4(0x14f)]()-0x1),_0x4006c6=new Date(Date['UTC'](_0x220410[_0x4ab8b4(0x12c)](),_0x220410['getUTCMonth'](),_0x220410['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x220410['getUTCFullYear'](),_0x220410[_0x4ab8b4(0xfc)](),_0x220410[_0x4ab8b4(0x14f)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4ab8b4(0x1b3):const _0x2e0f9e=_0x4f5b05[_0x4ab8b4(0x186)](),_0x73a389=_0x2e0f9e===0x0?-0x6:0x1-_0x2e0f9e,_0x2143e1=_0x4f5b05['getUTCDate']()+_0x73a389;_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),_0x2143e1,0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05['getUTCMonth'](),_0x4f5b05[_0x4ab8b4(0x14f)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4ab8b4(0x18e):const _0x1b8d2c=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05['getUTCMonth'](),_0x4f5b05[_0x4ab8b4(0x14f)]()-0x7)),_0x1ee468=_0x1b8d2c[_0x4ab8b4(0x186)](),_0x2aa74a=_0x1ee468===0x0?-0x6:0x1-_0x1ee468,_0x580bae=_0x1b8d2c[_0x4ab8b4(0x14f)]()+_0x2aa74a;_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](_0x1b8d2c['getUTCFullYear'](),_0x1b8d2c[_0x4ab8b4(0xfc)](),_0x580bae,0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x1b8d2c[_0x4ab8b4(0x12c)](),_0x1b8d2c[_0x4ab8b4(0xfc)](),_0x580bae+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x4ab8b4(0x156):_0x4006c6=new Date(Date['UTC'](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),0x1,0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),_0x4f5b05['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x4ab8b4(0x1bf):_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05['getUTCFullYear'](),_0x4f5b05[_0x4ab8b4(0xfc)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4ab8b4(0x103):_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),_0x4f5b05['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x4006c6=new Date(Date[_0x4ab8b4(0x1ab)](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),0x1,0x0,0x0,0x0,0x0)),_0x3b5bfc=new Date(Date['UTC'](_0x4f5b05[_0x4ab8b4(0x12c)](),_0x4f5b05[_0x4ab8b4(0xfc)](),_0x4f5b05[_0x4ab8b4(0x14f)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x4ab8b4(0x13a)]('üìÖ\x20Final\x20date\x20range:\x20'+_0x4006c6[_0x4ab8b4(0x138)]()+'\x20to\x20'+_0x3b5bfc[_0x4ab8b4(0x138)]());const _0x59190d={'gte':_0x4006c6,'lte':_0x3b5bfc},[_0x1fa3bc,_0x29ea22,_0x4bbc82,_0x9ead13,_0x1c3bb8,_0xc75f71,_0x294403,_0x14bdf0,_0x29174a,_0x177fb6,_0x11e520]=await Promise[_0x4ab8b4(0x19e)]([database_1[_0x4ab8b4(0x141)][_0x4ab8b4(0x196)][_0x4ab8b4(0xee)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)},'status':{'notIn':[_0x4ab8b4(0x118),_0x4ab8b4(0x111)]},'createdAt':_0x59190d}}),database_1['default'][_0x4ab8b4(0x196)][_0x4ab8b4(0xee)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)},'status':_0x4ab8b4(0x168),'createdAt':_0x59190d}}),database_1[_0x4ab8b4(0x141)][_0x4ab8b4(0x196)][_0x4ab8b4(0xee)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)},'status':_0x4ab8b4(0x166)}}),database_1[_0x4ab8b4(0x141)][_0x4ab8b4(0x196)][_0x4ab8b4(0xee)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)},'status':_0x4ab8b4(0x10a)}}),database_1[_0x4ab8b4(0x141)][_0x4ab8b4(0x196)][_0x4ab8b4(0x10f)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':'test_gateway'},'status':_0x4ab8b4(0x168),'createdAt':_0x59190d},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x4ab8b4(0x196)][_0x4ab8b4(0x10f)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)}},'take':0x4,'orderBy':{'createdAt':_0x4ab8b4(0x1a3)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4ab8b4(0x141)][_0x4ab8b4(0x196)]['findMany']({'where':{'shopId':_0x3a88f2,'gateway':{'not':'test_gateway'},'createdAt':_0x59190d},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4ab8b4(0x193)}}),database_1[_0x4ab8b4(0x141)][_0x4ab8b4(0x196)][_0x4ab8b4(0xee)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)},'status':'PAID'}}),database_1[_0x4ab8b4(0x141)][_0x4ab8b4(0x196)][_0x4ab8b4(0x10f)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)},'status':_0x4ab8b4(0x168)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4ab8b4(0x141)]['shop'][_0x4ab8b4(0x15f)]({'where':{'id':_0x3a88f2},'select':{'balance':!![]}}),database_1['default'][_0x4ab8b4(0x196)][_0x4ab8b4(0x10f)]({'where':{'shopId':_0x3a88f2,'gateway':{'not':_0x4ab8b4(0x1c2)}},'select':{'gateway':!![]}})]),_0x26fa03={};for(const _0x16afa8 of _0x11e520){_0x16afa8['gateway']&&(_0x26fa03[_0x16afa8[_0x4ab8b4(0x17f)]]=(_0x26fa03[_0x16afa8[_0x4ab8b4(0x17f)]]||0x0)+0x1);}console[_0x4ab8b4(0x13a)]('üìä\x20Payments\x20by\x20gateway\x20(all\x20time):',_0x26fa03);let _0xba9d0=0x0,_0x2c0cd7=0x0;for(const _0x2a0589 of _0x1c3bb8){if(_0x2a0589['amountUSDT'])_0xba9d0+=_0x2a0589['amountUSDT'];else{const _0x328bd5=await currencyService_1['currencyService']['convertToUSDT'](_0x2a0589[_0x4ab8b4(0x1bb)],_0x2a0589[_0x4ab8b4(0x1b0)]);_0xba9d0+=_0x328bd5;}_0x2a0589['amountAfterGatewayCommissionUSDT']&&(_0x2c0cd7+=_0x2a0589[_0x4ab8b4(0x17c)]);}let _0x2f1313=0x0;for(const _0x585d3b of _0x29174a){_0x585d3b[_0x4ab8b4(0x17c)]&&(_0x2f1313+=_0x585d3b[_0x4ab8b4(0x17c)]);}const _0x28cc1c=this[_0x4ab8b4(0x15c)](_0x294403,_0x4006c6,_0x3b5bfc||_0x4f5b05),_0x3408ae=_0x1fa3bc>0x0?_0x29ea22/_0x1fa3bc*0x64:0x0,_0x5374e8=_0x14bdf0>0x0?_0x4bbc82/_0x14bdf0*0x64:0x0;return{'totalPayments':_0x1fa3bc,'successfulPayments':_0x29ea22,'totalRevenue':Math[_0x4ab8b4(0x185)](_0xba9d0*0x64)/0x64,'merchantEarnings':Math[_0x4ab8b4(0x185)](_0x2c0cd7*0x64)/0x64,'merchantTotalRevenue':Math[_0x4ab8b4(0x185)](_0x2f1313*0x64)/0x64,'payoutBalance':Math[_0x4ab8b4(0x185)]((_0x177fb6?.[_0x4ab8b4(0x161)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x3408ae*0x64)/0x64,'chargebackRate':Math[_0x4ab8b4(0x185)](_0x5374e8*0x64)/0x64,'chargebacks':_0x4bbc82,'refunds':_0x9ead13,'paymentsByGateway':_0x26fa03,'dailyRevenue':_0x28cc1c[_0x4ab8b4(0x1b1)],'dailyPayments':_0x28cc1c[_0x4ab8b4(0x12a)],'recentPayments':_0xc75f71[_0x4ab8b4(0x150)](_0x1e91ac=>({'id':_0x1e91ac['id'],'gateway':_0x1e91ac[_0x4ab8b4(0x17f)],'amount':_0x1e91ac[_0x4ab8b4(0x1bb)],'currency':_0x1e91ac[_0x4ab8b4(0x1b0)],'status':_0x1e91ac[_0x4ab8b4(0x191)],'createdAt':_0x1e91ac[_0x4ab8b4(0x1c6)]}))};}[a86_0x3add2e(0x15c)](_0x3e2938,_0x387a0d,_0x405d2a){const _0x4db51a=a86_0x3add2e,_0x4f8822=new Map(),_0x5f29ca=new Date(_0x387a0d);while(_0x5f29ca<=_0x405d2a){const _0x4c2424=_0x5f29ca['toISOString']()[_0x4db51a(0x12d)]('T')[0x0];_0x4f8822['set'](_0x4c2424,{'revenue':0x0,'count':0x0}),_0x5f29ca[_0x4db51a(0x1ad)](_0x5f29ca[_0x4db51a(0x10e)]()+0x1);}for(const _0x4af96e of _0x3e2938){const _0x5e7b9e=_0x4af96e[_0x4db51a(0x1c6)][_0x4db51a(0x138)]()['split']('T')[0x0],_0x155276=_0x4f8822[_0x4db51a(0x15e)](_0x5e7b9e);_0x155276&&(_0x155276[_0x4db51a(0xee)]+=0x1,_0x4af96e[_0x4db51a(0x191)]===_0x4db51a(0x168)&&_0x4af96e[_0x4db51a(0x1ae)]&&(_0x155276[_0x4db51a(0x1c8)]+=_0x4af96e[_0x4db51a(0x1ae)]));}const _0x2c967c=[],_0x4b0b0e=[];for(const [_0x1421d3,_0x31be5e]of _0x4f8822){_0x2c967c[_0x4db51a(0x12f)]({'date':_0x1421d3,'amount':Math[_0x4db51a(0x185)](_0x31be5e[_0x4db51a(0x1c8)]*0x64)/0x64}),_0x4b0b0e['push']({'date':_0x1421d3,'count':_0x31be5e[_0x4db51a(0xee)]});}return{'dailyRevenue':_0x2c967c,'dailyPayments':_0x4b0b0e};}['generateBackupCodes'](_0x26b318=0x8){const _0x3a9729=a86_0x3add2e,_0xc2e9ac=[];for(let _0x252259=0x0;_0x252259<_0x26b318;_0x252259++){const _0x4677e2=crypto_1[_0x3a9729(0x141)][_0x3a9729(0x15a)](0x4)[_0x3a9729(0x178)](_0x3a9729(0x1a7))['toUpperCase']();_0xc2e9ac['push'](_0x4677e2);}return _0xc2e9ac;}async[a86_0x3add2e(0x151)](_0x5e2df5){const _0x307bdb=a86_0x3add2e,_0x3c8785=await database_1[_0x307bdb(0x141)]['shop'][_0x307bdb(0x15f)]({'where':{'id':_0x5e2df5},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x3c8785)throw new Error(_0x307bdb(0x182));const _0x181b96=speakeasy_1['default'][_0x307bdb(0x13f)]({'name':_0x307bdb(0x154)+_0x3c8785['username']+')','issuer':_0x307bdb(0x194),'length':0x20}),_0x191899=await qrcode_1[_0x307bdb(0x141)][_0x307bdb(0xfd)](_0x181b96['otpauth_url']),_0x1290ed=this['generateBackupCodes'](0x8),_0x38f2de=await Promise['all'](_0x1290ed[_0x307bdb(0x150)](_0x3850cf=>bcryptjs_1[_0x307bdb(0x141)]['hash'](_0x3850cf,0xa)));return await database_1[_0x307bdb(0x141)][_0x307bdb(0x1bc)]['update']({'where':{'id':_0x5e2df5},'data':{'twoFactorSecret':_0x181b96[_0x307bdb(0x1b5)],'backupCodes':JSON['stringify'](_0x38f2de)}}),console[_0x307bdb(0x13a)](_0x307bdb(0x183)+_0x3c8785[_0x307bdb(0x167)]),console[_0x307bdb(0x13a)]('üîë\x20Generated\x20'+_0x1290ed[_0x307bdb(0x112)]+_0x307bdb(0x1a9)),{'secret':_0x181b96[_0x307bdb(0x1b5)],'qrCode':_0x191899,'manualEntryKey':_0x181b96[_0x307bdb(0x1b5)],'backupCodes':_0x1290ed};}async[a86_0x3add2e(0xf2)](_0x1ee796,_0x17e63e){const _0x391fea=a86_0x3add2e,_0x1ae47e=await database_1[_0x391fea(0x141)][_0x391fea(0x1bc)][_0x391fea(0x15f)]({'where':{'id':_0x1ee796},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x1ae47e)throw new Error(_0x391fea(0x182));if(!_0x1ae47e[_0x391fea(0x10c)])throw new Error(_0x391fea(0x199));if(_0x1ae47e[_0x391fea(0x1ac)])throw new Error(_0x391fea(0x11c));const _0x457ddc=speakeasy_1['default']['totp'][_0x391fea(0xfe)]({'secret':_0x1ae47e['twoFactorSecret'],'encoding':_0x391fea(0x1b5),'token':_0x17e63e,'window':0x2});if(!_0x457ddc)throw new Error('Invalid\x202FA\x20token');return await database_1[_0x391fea(0x141)][_0x391fea(0x1bc)][_0x391fea(0x120)]({'where':{'id':_0x1ee796},'data':{'twoFactorEnabled':!![]}}),console[_0x391fea(0x13a)]('üîê\x202FA\x20enabled\x20for\x20shop:\x20'+_0x1ae47e[_0x391fea(0x167)]),{'enabled':!![]};}async[a86_0x3add2e(0x16b)](_0x137584){const _0x429d66=a86_0x3add2e,_0x2dcb36=await database_1['default']['shop']['findUnique']({'where':{'id':_0x137584},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2dcb36)throw new Error(_0x429d66(0x182));await database_1['default'][_0x429d66(0x1bc)][_0x429d66(0x120)]({'where':{'id':_0x137584},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x429d66(0x13a)]('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x2dcb36[_0x429d66(0x167)]);}}exports['ShopService']=ShopService;