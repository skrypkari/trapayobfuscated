'use strict';const a82_0x1d1004=a82_0x458c;(function(_0x527109,_0xb8557b){const _0x332600=a82_0x458c,_0x2d870d=_0x527109();while(!![]){try{const _0x570f55=parseInt(_0x332600(0x1a8))/0x1*(-parseInt(_0x332600(0x206))/0x2)+parseInt(_0x332600(0x155))/0x3*(parseInt(_0x332600(0x1e4))/0x4)+parseInt(_0x332600(0x1b3))/0x5+-parseInt(_0x332600(0x1ab))/0x6*(parseInt(_0x332600(0x13c))/0x7)+-parseInt(_0x332600(0x1ea))/0x8+-parseInt(_0x332600(0x15f))/0x9*(-parseInt(_0x332600(0x1cc))/0xa)+parseInt(_0x332600(0x140))/0xb*(parseInt(_0x332600(0x14d))/0xc);if(_0x570f55===_0xb8557b)break;else _0x2d870d['push'](_0x2d870d['shift']());}catch(_0x43ec23){_0x2d870d['push'](_0x2d870d['shift']());}}}(a82_0x12a7,0xc64fc));var __importDefault=this&&this[a82_0x1d1004(0x1b2)]||function(_0x28a87b){const _0xf5c0d9=a82_0x1d1004;return _0x28a87b&&_0x28a87b[_0xf5c0d9(0x210)]?_0x28a87b:{'default':_0x28a87b};};Object['defineProperty'](exports,a82_0x1d1004(0x210),{'value':!![]}),exports[a82_0x1d1004(0x190)]=void 0x0;const database_1=__importDefault(require(a82_0x1d1004(0x16e))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a82_0x1d1004(0x1c4))),speakeasy_1=__importDefault(require(a82_0x1d1004(0x212))),qrcode_1=__importDefault(require(a82_0x1d1004(0x1de))),currencyService_1=require(a82_0x1d1004(0x1c7)),paymentService_1=require(a82_0x1d1004(0x157)),gateway_1=require(a82_0x1d1004(0x1a0));class ShopService{constructor(){this['paymentService']=new paymentService_1['PaymentService']();}async[a82_0x1d1004(0x17d)](_0x2b82f7){const _0x51dcf8=a82_0x1d1004,_0x405059=await database_1['default'][_0x51dcf8(0x19a)][_0x51dcf8(0x1cb)]({'where':{'id':_0x2b82f7},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x405059)throw new Error(_0x51dcf8(0x187));let _0x43c5ed=[];if(_0x405059[_0x51dcf8(0x175)]?.['webhookEvents'])try{_0x43c5ed=Array[_0x51dcf8(0x17f)](_0x405059[_0x51dcf8(0x175)][_0x51dcf8(0x19b)])?_0x405059[_0x51dcf8(0x175)]['webhookEvents']:JSON[_0x51dcf8(0x17e)](_0x405059[_0x51dcf8(0x175)]['webhookEvents']);}catch(_0x2669fc){console[_0x51dcf8(0x130)](_0x51dcf8(0x207),_0x2669fc),_0x43c5ed=[];}const _0x2a5d1b=gateway_1[_0x51dcf8(0x18b)][_0x51dcf8(0x1e6)](_0x172458=>_0x172458[_0x51dcf8(0x1c2)])[_0x51dcf8(0x199)](_0x12f905=>_0x12f905['name']);let _0x408cb4=_0x405059[_0x51dcf8(0x129)]?JSON[_0x51dcf8(0x17e)](_0x405059[_0x51dcf8(0x129)]):[];return Array[_0x51dcf8(0x17f)](_0x408cb4)&&(_0x408cb4=_0x408cb4['map'](_0x222832=>_0x222832[_0x51dcf8(0x132)](/\s+/g,'_')[_0x51dcf8(0x1ac)]())[_0x51dcf8(0x1e6)](_0x2f453e=>_0x2a5d1b['includes'](_0x2f453e))),{'id':_0x405059['id'],'fullName':_0x405059[_0x51dcf8(0x164)],'username':_0x405059[_0x51dcf8(0x20c)],'telegramId':_0x405059[_0x51dcf8(0x181)],'merchantUrl':_0x405059[_0x51dcf8(0x1f9)],'gateways':_0x408cb4,'gatewaySettings':_0x405059[_0x51dcf8(0x14f)]?JSON[_0x51dcf8(0x17e)](_0x405059[_0x51dcf8(0x14f)]):null,'publicKey':_0x405059['publicKey'],'secretKey':_0x405059[_0x51dcf8(0x167)],'webhookUrl':_0x405059['settings']?.[_0x51dcf8(0x203)]||null,'webhookEvents':_0x43c5ed,'wallets':{'usdtPolygonWallet':_0x405059['usdtPolygonWallet'],'usdtTrcWallet':_0x405059[_0x51dcf8(0x1c5)],'usdtErcWallet':_0x405059['usdtErcWallet'],'usdcPolygonWallet':_0x405059[_0x51dcf8(0x184)],'usdcErcWallet':_0x405059[_0x51dcf8(0x135)]},'status':_0x405059['status'],'createdAt':_0x405059[_0x51dcf8(0x1e1)]};}async['updateShopProfile'](_0x503b8f,_0x56d69d){const _0x26d0e1=a82_0x1d1004,_0x463c11={};_0x56d69d['fullName']&&(_0x463c11['name']=_0x56d69d['fullName']);_0x56d69d[_0x26d0e1(0x14a)]!==undefined&&(_0x463c11['telegram']=_0x56d69d['telegramId']||null);_0x56d69d[_0x26d0e1(0x16f)]&&(_0x463c11[_0x26d0e1(0x1f9)]=_0x56d69d[_0x26d0e1(0x16f)]);_0x56d69d[_0x26d0e1(0x159)]&&(_0x463c11[_0x26d0e1(0x129)]=JSON[_0x26d0e1(0x1d2)](_0x56d69d['gateways']));_0x56d69d['gatewaySettings']&&(_0x463c11['gatewaySettings']=JSON[_0x26d0e1(0x1d2)](_0x56d69d[_0x26d0e1(0x14f)]));_0x56d69d['wallets']&&(_0x56d69d[_0x26d0e1(0x20d)][_0x26d0e1(0x169)]!==undefined&&(_0x463c11[_0x26d0e1(0x169)]=_0x56d69d[_0x26d0e1(0x20d)]['usdtPolygonWallet']||null),_0x56d69d[_0x26d0e1(0x20d)][_0x26d0e1(0x1c5)]!==undefined&&(_0x463c11[_0x26d0e1(0x1c5)]=_0x56d69d['wallets']['usdtTrcWallet']||null),_0x56d69d[_0x26d0e1(0x20d)][_0x26d0e1(0x14b)]!==undefined&&(_0x463c11[_0x26d0e1(0x14b)]=_0x56d69d[_0x26d0e1(0x20d)][_0x26d0e1(0x14b)]||null),_0x56d69d[_0x26d0e1(0x20d)][_0x26d0e1(0x184)]!==undefined&&(_0x463c11[_0x26d0e1(0x184)]=_0x56d69d[_0x26d0e1(0x20d)][_0x26d0e1(0x184)]||null));const _0x25d426=await database_1[_0x26d0e1(0x15b)][_0x26d0e1(0x19a)]['update']({'where':{'id':_0x503b8f},'data':_0x463c11,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x3022dd=[];if(_0x25d426['settings']?.[_0x26d0e1(0x19b)])try{_0x3022dd=Array[_0x26d0e1(0x17f)](_0x25d426['settings'][_0x26d0e1(0x19b)])?_0x25d426[_0x26d0e1(0x175)][_0x26d0e1(0x19b)]:JSON[_0x26d0e1(0x17e)](_0x25d426[_0x26d0e1(0x175)][_0x26d0e1(0x19b)]);}catch(_0xa7f115){console[_0x26d0e1(0x130)](_0x26d0e1(0x207),_0xa7f115),_0x3022dd=[];}return{'id':_0x25d426['id'],'fullName':_0x25d426[_0x26d0e1(0x164)],'username':_0x25d426[_0x26d0e1(0x20c)],'telegramId':_0x25d426[_0x26d0e1(0x181)],'merchantUrl':_0x25d426['shopUrl'],'gateways':_0x25d426[_0x26d0e1(0x129)]?JSON[_0x26d0e1(0x17e)](_0x25d426[_0x26d0e1(0x129)]):null,'gatewaySettings':_0x25d426[_0x26d0e1(0x14f)]?JSON[_0x26d0e1(0x17e)](_0x25d426['gatewaySettings']):null,'publicKey':_0x25d426[_0x26d0e1(0x145)],'secretKey':_0x25d426[_0x26d0e1(0x167)],'webhookUrl':_0x25d426[_0x26d0e1(0x175)]?.[_0x26d0e1(0x203)]||null,'webhookEvents':_0x3022dd,'wallets':{'usdtPolygonWallet':_0x25d426[_0x26d0e1(0x169)],'usdtTrcWallet':_0x25d426[_0x26d0e1(0x1c5)],'usdtErcWallet':_0x25d426[_0x26d0e1(0x14b)],'usdcPolygonWallet':_0x25d426[_0x26d0e1(0x184)],'usdcErcWallet':_0x25d426[_0x26d0e1(0x135)]},'status':_0x25d426['status'],'createdAt':_0x25d426[_0x26d0e1(0x1e1)]};}async['updateWallets'](_0x4e869b,_0x39b329){const _0x5e7216=a82_0x1d1004,_0x15f618=await database_1[_0x5e7216(0x15b)][_0x5e7216(0x19a)]['findUnique']({'where':{'id':_0x4e869b},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x15f618)throw new Error('Shop\x20not\x20found');if(_0x15f618['twoFactorEnabled']){if(!_0x39b329[_0x5e7216(0x1be)])throw new Error(_0x5e7216(0x1e8));const _0x562433=speakeasy_1['default'][_0x5e7216(0x1fc)][_0x5e7216(0x156)]({'secret':_0x15f618[_0x5e7216(0x186)],'encoding':'base32','token':_0x39b329[_0x5e7216(0x1be)],'window':0x2});if(!_0x562433){let _0xe38b0=![];if(_0x15f618[_0x5e7216(0x139)]){const _0x1dc8d5=JSON[_0x5e7216(0x17e)](_0x15f618[_0x5e7216(0x139)]);for(let _0x3c8d7d=0x0;_0x3c8d7d<_0x1dc8d5[_0x5e7216(0x1a2)];_0x3c8d7d++){const _0x25f671=await bcryptjs_1[_0x5e7216(0x15b)][_0x5e7216(0x19c)](_0x39b329['twoFactorToken'],_0x1dc8d5[_0x3c8d7d]);if(_0x25f671){_0xe38b0=!![],_0x1dc8d5[_0x5e7216(0x213)](_0x3c8d7d,0x1),await database_1[_0x5e7216(0x15b)][_0x5e7216(0x19a)][_0x5e7216(0x1e5)]({'where':{'id':_0x4e869b},'data':{'backupCodes':JSON[_0x5e7216(0x1d2)](_0x1dc8d5)}});break;}}}if(!_0xe38b0)throw new Error(_0x5e7216(0x1d6));}}const _0xc0ffdf={};_0x39b329[_0x5e7216(0x169)]!==undefined&&(_0xc0ffdf[_0x5e7216(0x169)]=_0x39b329[_0x5e7216(0x169)]||null),_0x39b329[_0x5e7216(0x1c5)]!==undefined&&(_0xc0ffdf[_0x5e7216(0x1c5)]=_0x39b329[_0x5e7216(0x1c5)]||null),_0x39b329['usdtErcWallet']!==undefined&&(_0xc0ffdf[_0x5e7216(0x14b)]=_0x39b329['usdtErcWallet']||null),_0x39b329[_0x5e7216(0x184)]!==undefined&&(_0xc0ffdf[_0x5e7216(0x184)]=_0x39b329[_0x5e7216(0x184)]||null),_0x39b329[_0x5e7216(0x135)]!==undefined&&(_0xc0ffdf[_0x5e7216(0x135)]=_0x39b329['usdcErcWallet']||null),await database_1[_0x5e7216(0x15b)][_0x5e7216(0x19a)][_0x5e7216(0x1e5)]({'where':{'id':_0x4e869b},'data':_0xc0ffdf});}async[a82_0x1d1004(0x1ff)](_0x2ad8ef){const _0xc9eb62=a82_0x1d1004,_0x3ba6c9=await database_1['default'][_0xc9eb62(0x19a)]['findUnique']({'where':{'id':_0x2ad8ef},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3ba6c9?.[_0xc9eb62(0x175)]?.['webhookUrl'])throw new Error(_0xc9eb62(0x192));const _0x23c9aa={'event':_0xc9eb62(0x13e),'payment':{'id':_0xc9eb62(0x17c),'order_id':_0xc9eb62(0x128),'gateway':_0xc9eb62(0x13e),'amount':0x64,'currency':_0xc9eb62(0x1da),'status':_0xc9eb62(0x1db),'created_at':new Date()[_0xc9eb62(0x1bb)]()}};try{const _0x3029b9=JSON[_0xc9eb62(0x1d2)](_0x23c9aa),_0x24eff4=crypto_1[_0xc9eb62(0x15b)]['createHmac'](_0xc9eb62(0x125),_0x3ba6c9[_0xc9eb62(0x167)])[_0xc9eb62(0x1e5)](_0x3029b9)['digest'](_0xc9eb62(0x1ad)),_0x379c6b=await fetch(_0x3ba6c9[_0xc9eb62(0x175)][_0xc9eb62(0x203)],{'method':_0xc9eb62(0x16a),'headers':{'Content-Type':_0xc9eb62(0x1e7),'User-Agent':_0xc9eb62(0x1ed),'X-Webhook-Signature':_0x24eff4},'body':_0x3029b9});return _0x379c6b['ok']?{'success':!![],'message':_0xc9eb62(0x1e3)+_0x379c6b['status']+')'}:{'success':![],'message':_0xc9eb62(0x1c0)+_0x379c6b[_0xc9eb62(0x1b5)]+'\x20'+_0x379c6b[_0xc9eb62(0x127)]};}catch(_0x7ad5b0){return{'success':![],'message':_0xc9eb62(0x1a1)+(_0x7ad5b0 instanceof Error?_0x7ad5b0[_0xc9eb62(0x20e)]:_0xc9eb62(0x1af))};}}async[a82_0x1d1004(0x15d)](_0x3b32b0){const _0x2d268b=a82_0x1d1004;return this['paymentService'][_0x2d268b(0x1c3)]({'public_key':'','gateway':_0x3b32b0['gateway'],'order_id':undefined,'amount':_0x3b32b0['amount'],'currency':_0x3b32b0[_0x2d268b(0x1aa)],'source_currency':_0x3b32b0[_0x2d268b(0x1b8)],'usage':_0x3b32b0['usage'],'expires_at':_0x3b32b0[_0x2d268b(0x208)]?.[_0x2d268b(0x1bb)](),'success_url':_0x3b32b0[_0x2d268b(0x166)],'fail_url':_0x3b32b0[_0x2d268b(0x166)],'customer_email':_0x3b32b0['customerEmail'],'customer_name':_0x3b32b0['customerName'],'country':_0x3b32b0[_0x2d268b(0x12c)],'language':_0x3b32b0[_0x2d268b(0x138)],'amount_is_editable':_0x3b32b0[_0x2d268b(0x1bf)],'max_payments':_0x3b32b0[_0x2d268b(0x1fd)],'customer':_0x3b32b0[_0x2d268b(0x1fe)]});}async[a82_0x1d1004(0x1a9)](_0x39e6aa,_0x11335e){const _0x3d7ff0=a82_0x1d1004;return this[_0x3d7ff0(0x12e)][_0x3d7ff0(0x1f3)](_0x39e6aa,_0x11335e);}async['getPaymentById'](_0x216c1d,_0x2bf2e5){const _0x7b6d43=a82_0x1d1004;return this[_0x7b6d43(0x12e)]['getPaymentByShopAndId'](_0x216c1d,_0x2bf2e5);}async[a82_0x1d1004(0x123)](_0x290be4,_0x332e9c,_0x1fe7b7){const _0x48c3e1=a82_0x1d1004,_0x3d9573=await database_1[_0x48c3e1(0x15b)][_0x48c3e1(0x1dd)][_0x48c3e1(0x1b0)]({'where':{'id':_0x332e9c,'shopId':_0x290be4}});if(!_0x3d9573)throw new Error(_0x48c3e1(0x1f5));const _0x29084c=await database_1[_0x48c3e1(0x15b)][_0x48c3e1(0x1dd)][_0x48c3e1(0x1e5)]({'where':{'id':_0x332e9c},'data':{..._0x1fe7b7,'updatedAt':new Date()}});return _0x29084c;}async[a82_0x1d1004(0x193)](_0x42bba5,_0x3bbedc){const _0x31fb58=a82_0x1d1004,_0x1f7707=await database_1[_0x31fb58(0x15b)][_0x31fb58(0x1dd)][_0x31fb58(0x1b0)]({'where':{'id':_0x3bbedc,'shopId':_0x42bba5}});if(!_0x1f7707)throw new Error(_0x31fb58(0x1f5));await database_1['default'][_0x31fb58(0x1dd)][_0x31fb58(0x1d1)]({'where':{'id':_0x3bbedc}});}[a82_0x1d1004(0x15c)](_0x33cba0){const _0x1c5e8b=a82_0x1d1004,_0x49f1df={'polygon':_0x1c5e8b(0x209),'trc20':_0x1c5e8b(0x1f8),'erc20':_0x1c5e8b(0x170),'bsc':_0x1c5e8b(0x201),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x1c5e8b(0x12d)};return _0x49f1df[_0x33cba0]||_0x33cba0;}async['getPayouts'](_0x5eecfd,_0x2a7dfd){const _0x513030=a82_0x1d1004,{page:_0x545b90,limit:_0xf52e97,status:_0x44aed6,method:_0x30cca1,network:_0x1bef3d,dateFrom:_0xb62d44,dateTo:_0x2797a3,periodFrom:_0x1f8821,periodTo:_0x16a1bf}=_0x2a7dfd,_0x5f17a5=(_0x545b90-0x1)*_0xf52e97;console['log']('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x2a7dfd);const _0x58750f={'shopId':_0x5eecfd};_0x44aed6&&(_0x58750f['status']=_0x44aed6[_0x513030(0x194)](),console[_0x513030(0x205)](_0x513030(0x150)+_0x44aed6[_0x513030(0x194)]()));if(_0x30cca1)_0x58750f[_0x513030(0x19e)]=_0x30cca1,console[_0x513030(0x205)]('üåê\x20Method\x20filter:\x20'+_0x30cca1);else _0x1bef3d&&(_0x58750f['network']=_0x1bef3d,console[_0x513030(0x205)](_0x513030(0x162)+_0x1bef3d));if(_0xb62d44||_0x2797a3||_0x1f8821||_0x16a1bf){_0x58750f[_0x513030(0x1e1)]={};if(_0x1f8821){const _0x1504fb=new Date(_0x1f8821);_0x1504fb['setHours'](0x0,0x0,0x0,0x1),_0x58750f['createdAt'][_0x513030(0x1f7)]=_0x1504fb,console['log'](_0x513030(0x124)+_0x1504fb['toISOString']());}else{if(_0xb62d44){const _0x9d3e64=new Date(_0xb62d44);_0x9d3e64['setHours'](0x0,0x0,0x0,0x1),_0x58750f[_0x513030(0x1e1)][_0x513030(0x1f7)]=_0x9d3e64,console[_0x513030(0x205)](_0x513030(0x1d3)+_0x9d3e64['toISOString']());}}if(_0x16a1bf){const _0x4c9872=new Date(_0x16a1bf);_0x4c9872[_0x513030(0x151)](0x17,0x3b,0x3b,0x3e7),_0x58750f[_0x513030(0x1e1)][_0x513030(0x17a)]=_0x4c9872,console[_0x513030(0x205)](_0x513030(0x1e0)+_0x4c9872[_0x513030(0x1bb)]());}else{if(_0x2797a3){const _0x56fd8b=new Date(_0x2797a3);_0x56fd8b[_0x513030(0x151)](0x17,0x3b,0x3b,0x3e7),_0x58750f[_0x513030(0x1e1)][_0x513030(0x17a)]=_0x56fd8b,console[_0x513030(0x205)](_0x513030(0x161)+_0x56fd8b[_0x513030(0x1bb)]());}}}console[_0x513030(0x205)](_0x513030(0x1ef),JSON[_0x513030(0x1d2)](_0x58750f,null,0x2));const [_0x2f8aec,_0x2f0f30]=await Promise['all']([database_1[_0x513030(0x15b)]['payout'][_0x513030(0x1f1)]({'where':_0x58750f,'skip':_0x5f17a5,'take':_0xf52e97,'orderBy':{'createdAt':_0x513030(0x174)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x513030(0x15b)][_0x513030(0x214)][_0x513030(0x1bc)]({'where':_0x58750f})]);return{'payouts':_0x2f8aec['map'](_0x37378a=>{const _0x54e7df=_0x513030;let _0x23d81a=null;switch(_0x37378a['network']){case _0x54e7df(0x211):_0x23d81a=_0x37378a[_0x54e7df(0x19a)][_0x54e7df(0x169)];break;case _0x54e7df(0x1b7):_0x23d81a=_0x37378a[_0x54e7df(0x19a)][_0x54e7df(0x1c5)];break;case _0x54e7df(0x17b):_0x23d81a=_0x37378a[_0x54e7df(0x19a)][_0x54e7df(0x14b)];break;case _0x54e7df(0x197):_0x23d81a=_0x37378a[_0x54e7df(0x19a)]['usdcPolygonWallet'];break;case _0x54e7df(0x1a5):_0x23d81a=_0x37378a[_0x54e7df(0x19a)][_0x54e7df(0x135)];break;}return{'id':_0x37378a['id'],'amount':_0x37378a[_0x54e7df(0x195)],'network':this[_0x54e7df(0x15c)](_0x37378a[_0x54e7df(0x19e)]),'wallet':_0x23d81a,'status':_0x37378a['status'],'txid':_0x37378a[_0x54e7df(0x20b)],'notes':_0x37378a['notes'],'periodFrom':_0x37378a['periodFrom'],'periodTo':_0x37378a['periodTo'],'createdAt':_0x37378a[_0x54e7df(0x1e1)],'paidAt':_0x37378a[_0x54e7df(0x165)]};}),'pagination':{'page':_0x545b90,'limit':_0xf52e97,'total':_0x2f0f30,'totalPages':Math[_0x513030(0x1ce)](_0x2f0f30/_0xf52e97)}};}async[a82_0x1d1004(0x14e)](_0x14ffeb,_0x388e05){const _0x21e4b6=a82_0x1d1004,_0x2d78ff=await database_1['default'][_0x21e4b6(0x214)][_0x21e4b6(0x1b0)]({'where':{'id':_0x388e05,'shopId':_0x14ffeb}});if(!_0x2d78ff)return null;return{'id':_0x2d78ff['id'],'amount':_0x2d78ff[_0x21e4b6(0x195)],'network':_0x2d78ff[_0x21e4b6(0x19e)],'status':_0x2d78ff[_0x21e4b6(0x1b5)],'txid':_0x2d78ff[_0x21e4b6(0x20b)],'notes':_0x2d78ff[_0x21e4b6(0x1eb)],'createdAt':_0x2d78ff['createdAt'],'paidAt':_0x2d78ff[_0x21e4b6(0x165)]};}async[a82_0x1d1004(0x18a)](_0x1c0ecb,_0x1001f1){const _0x4ea433=a82_0x1d1004,_0x582d27=new Date();let _0x2d66f8,_0x1c9583;switch(_0x1001f1){case _0x4ea433(0x1a3):case _0x4ea433(0x204):const _0x5bbc3d=new Date(_0x582d27);_0x5bbc3d[_0x4ea433(0x1f4)](_0x5bbc3d[_0x4ea433(0x136)]()-0x1),_0x2d66f8=new Date(_0x5bbc3d),_0x2d66f8[_0x4ea433(0x151)](0x0,0x0,0x0,0x0),_0x1c9583=new Date(_0x5bbc3d),_0x1c9583['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x2d66f8=new Date(_0x582d27['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4ea433(0x1d5):_0x2d66f8=new Date(_0x582d27[_0x4ea433(0x18d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4ea433(0x1b9):_0x2d66f8=new Date(_0x582d27[_0x4ea433(0x18d)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2d66f8=new Date(_0x582d27[_0x4ea433(0x18d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x56aaa6={'gte':_0x2d66f8};_0x1c9583&&(_0x56aaa6['lte']=_0x1c9583);const [_0x162b94,_0x1a78b3,_0x5e016e,_0x340d5c,_0x309398,_0x5172c4]=await Promise[_0x4ea433(0x126)]([database_1['default'][_0x4ea433(0x214)]['count']({'where':{'shopId':_0x1c0ecb,'createdAt':_0x56aaa6}}),database_1['default'][_0x4ea433(0x214)][_0x4ea433(0x1bc)]({'where':{'shopId':_0x1c0ecb,'status':_0x4ea433(0x131),'createdAt':_0x56aaa6}}),database_1['default']['payout'][_0x4ea433(0x1bc)]({'where':{'shopId':_0x1c0ecb,'status':_0x4ea433(0x182),'createdAt':_0x56aaa6}}),database_1[_0x4ea433(0x15b)][_0x4ea433(0x214)][_0x4ea433(0x1bc)]({'where':{'shopId':_0x1c0ecb,'status':'REJECTED','createdAt':_0x56aaa6}}),database_1['default']['payout'][_0x4ea433(0x1f1)]({'where':{'shopId':_0x1c0ecb,'createdAt':_0x56aaa6},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x4ea433(0x15b)][_0x4ea433(0x214)][_0x4ea433(0x1f1)]({'where':{'shopId':_0x1c0ecb},'take':0xa,'orderBy':{'createdAt':_0x4ea433(0x174)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x2e0c50=_0x309398['reduce']((_0x19a836,_0x2bca65)=>_0x19a836+_0x2bca65[_0x4ea433(0x195)],0x0),_0xc36949=_0x309398[_0x4ea433(0x1e6)](_0x95eb11=>_0x95eb11[_0x4ea433(0x1b5)]==='COMPLETED')[_0x4ea433(0x152)]((_0x26c953,_0x16127f)=>_0x26c953+_0x16127f[_0x4ea433(0x195)],0x0),_0x30bfa6=_0x309398[_0x4ea433(0x1e6)](_0x1be2e3=>_0x1be2e3[_0x4ea433(0x1b5)]===_0x4ea433(0x182))[_0x4ea433(0x152)]((_0x354e1f,_0x2ffd20)=>_0x354e1f+_0x2ffd20[_0x4ea433(0x195)],0x0),_0x5d7873=_0x309398['reduce']((_0x1f3b96,_0x3c1430)=>{const _0x2b4e9f=_0x4ea433;return _0x1f3b96[_0x3c1430[_0x2b4e9f(0x19e)]]=(_0x1f3b96[_0x3c1430[_0x2b4e9f(0x19e)]]||0x0)+0x1,_0x1f3b96;},{}),_0x33c7aa=_0x309398['reduce']((_0x56e8e2,_0x966e09)=>{const _0x3df46a=_0x4ea433;return _0x56e8e2[_0x966e09[_0x3df46a(0x1b5)]]=(_0x56e8e2[_0x966e09['status']]||0x0)+0x1,_0x56e8e2;},{});return{'totalPayouts':_0x162b94,'completedPayouts':_0x1a78b3,'pendingPayouts':_0x5e016e,'rejectedPayouts':_0x340d5c,'totalAmount':_0x2e0c50,'completedAmount':_0xc36949,'pendingAmount':_0x30bfa6,'payoutsByMethod':_0x5d7873,'payoutsByStatus':_0x33c7aa,'recentPayouts':_0x5172c4[_0x4ea433(0x199)](_0x12c20b=>({'id':_0x12c20b['id'],'shopId':_0x1c0ecb,'amount':_0x12c20b[_0x4ea433(0x195)],'method':_0x12c20b[_0x4ea433(0x19e)],'status':_0x12c20b[_0x4ea433(0x1b5)],'txid':_0x12c20b['txid'],'createdAt':_0x12c20b['createdAt'],'paidAt':_0x12c20b[_0x4ea433(0x165)]}))};}async['getShopPayoutStats'](_0x303e61){const _0x20a267=a82_0x1d1004;console['log'](_0x20a267(0x18e)+_0x303e61+_0x20a267(0x178));const _0x34da75=await database_1['default']['shop'][_0x20a267(0x1cb)]({'where':{'id':_0x303e61},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x34da75)throw new Error(_0x20a267(0x187));const _0x34081e=new Date(),_0x32511c=new Date(_0x34081e[_0x20a267(0x1ee)](),_0x34081e[_0x20a267(0x1ba)](),0x1),_0x3f1d52=new Date(_0x34081e['getFullYear'](),_0x34081e['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3e8976=await database_1[_0x20a267(0x15b)]['payout'][_0x20a267(0x185)]({'_sum':{'amount':!![]},'where':{'shopId':_0x303e61,'createdAt':{'gte':_0x32511c,'lte':_0x3f1d52},'status':'COMPLETED'}}),_0xb7cef6=_0x3e8976['_sum'][_0x20a267(0x195)]||0x0,_0x136da7={'availableBalance':Math[_0x20a267(0x1c6)](_0x34da75[_0x20a267(0x1f2)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x34da75['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x20a267(0x1c6)](_0x34da75[_0x20a267(0x1f2)]*0x64)/0x64,'thisMonth':Math[_0x20a267(0x1c6)](_0xb7cef6*0x64)/0x64};return console['log']('üìä\x20Shop\x20'+_0x34da75[_0x20a267(0x20c)]+_0x20a267(0x1fa)),console[_0x20a267(0x205)](_0x20a267(0x148)+_0x136da7[_0x20a267(0x188)]+_0x20a267(0x1a4)),console['log']('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x136da7[_0x20a267(0x149)]+'\x20USDT\x20(total\x20payouts)'),console['log'](_0x20a267(0x1bd)+_0x136da7['awaitingPayout']+_0x20a267(0x1a4)),console['log'](_0x20a267(0x202)+_0x136da7[_0x20a267(0x1cd)]+'\x20USDT'),_0x136da7;}[a82_0x1d1004(0x143)](_0x1ff69e){const _0x3ccff7=a82_0x1d1004,_0x54e6e7={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x3ccff7(0x179),'noda':_0x3ccff7(0x168),'cointopay':_0x3ccff7(0x1df),'klyme_eu':_0x3ccff7(0x141),'klyme_gb':_0x3ccff7(0x1f6),'klyme_de':_0x3ccff7(0x134)};return _0x54e6e7[_0x1ff69e]||_0x1ff69e;}async[a82_0x1d1004(0x1b1)](_0xf78bca){const _0x405556=a82_0x1d1004;return this[_0x405556(0x133)](_0xf78bca);}async['getWebhookLogs'](_0x471ce7,_0x7910bf){const _0x52108f=a82_0x1d1004,{page:_0x49a9ca,limit:_0x458547,paymentId:_0x126b58}=_0x7910bf,_0x3656ca=(_0x49a9ca-0x1)*_0x458547,_0x4d1ecc={'shopId':_0x471ce7};_0x126b58&&(_0x4d1ecc[_0x52108f(0x177)]=_0x126b58);const [_0x2f6db5,_0x15faca]=await Promise[_0x52108f(0x126)]([database_1[_0x52108f(0x15b)][_0x52108f(0x18f)][_0x52108f(0x1f1)]({'where':_0x4d1ecc,'skip':_0x3656ca,'take':_0x458547,'orderBy':{'createdAt':_0x52108f(0x174)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x52108f(0x15b)][_0x52108f(0x18f)]['count']({'where':_0x4d1ecc})]);return{'logs':_0x2f6db5[_0x52108f(0x199)](_0x3c96b1=>({'id':_0x3c96b1['id'],'paymentId':_0x3c96b1['paymentId'],'shopId':_0x3c96b1[_0x52108f(0x154)],'event':_0x3c96b1[_0x52108f(0x14c)],'statusCode':_0x3c96b1[_0x52108f(0x12f)],'retryCount':_0x3c96b1[_0x52108f(0x147)],'responseBody':_0x3c96b1[_0x52108f(0x176)],'createdAt':_0x3c96b1[_0x52108f(0x1e1)],'payment':_0x3c96b1[_0x52108f(0x1dd)]})),'pagination':{'page':_0x49a9ca,'limit':_0x458547,'total':_0x15faca,'totalPages':Math['ceil'](_0x15faca/_0x458547)}};}async[a82_0x1d1004(0x1c9)](_0x2fb891,_0x1f82b8,_0x258fe4,_0x200f17,_0x2e8a44){const _0x35f1b3=a82_0x1d1004;console[_0x35f1b3(0x205)](_0x35f1b3(0x1fb)+_0x2fb891+_0x35f1b3(0x16c)+_0x1f82b8+_0x35f1b3(0x1f0)+_0x258fe4+_0x35f1b3(0x16b)+_0x200f17);const _0x1dbb8a=_0x2e8a44?new Date(_0x2e8a44):new Date();let _0x4187ec,_0x2acb83;if(_0x258fe4&&_0x200f17){const _0x49dc83=new Date(_0x258fe4),_0xf91b0e=new Date(_0x200f17);_0x4187ec=new Date(Date['UTC'](_0x49dc83[_0x35f1b3(0x19f)](),_0x49dc83[_0x35f1b3(0x16d)](),_0x49dc83[_0x35f1b3(0x1d7)](),0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date['UTC'](_0xf91b0e['getUTCFullYear'](),_0xf91b0e[_0x35f1b3(0x16d)](),_0xf91b0e['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x35f1b3(0x205)](_0x35f1b3(0x200)+_0x4187ec['toISOString']()+_0x35f1b3(0x172)+_0x2acb83[_0x35f1b3(0x1bb)]());}else{if(_0x1f82b8&&_0x1f82b8[_0x35f1b3(0x1e9)]('custom_')){const _0x2fcf1f=_0x1f82b8[_0x35f1b3(0x132)](_0x35f1b3(0x12b),'')[_0x35f1b3(0x144)]('_');if(_0x2fcf1f[_0x35f1b3(0x1a2)]===0x2){const _0xc1b948=new Date(_0x2fcf1f[0x0]),_0x115e00=new Date(_0x2fcf1f[0x1]);_0x4187ec=new Date(Date['UTC'](_0xc1b948['getUTCFullYear'](),_0xc1b948[_0x35f1b3(0x16d)](),_0xc1b948['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date['UTC'](_0x115e00['getUTCFullYear'](),_0x115e00[_0x35f1b3(0x16d)](),_0x115e00[_0x35f1b3(0x1d7)](),0x17,0x3b,0x3b,0x3e7)),console[_0x35f1b3(0x205)](_0x35f1b3(0x1b6)+_0x4187ec[_0x35f1b3(0x1bb)]()+_0x35f1b3(0x172)+_0x2acb83['toISOString']());}else{const _0x32eee2=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a['getUTCFullYear'](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a[_0x35f1b3(0x1d7)]()-0x1e));_0x4187ec=new Date(Date[_0x35f1b3(0x1d9)](_0x32eee2[_0x35f1b3(0x19f)](),_0x32eee2[_0x35f1b3(0x16d)](),_0x32eee2[_0x35f1b3(0x1d7)](),0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date['UTC'](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a['getUTCMonth'](),_0x1dbb8a['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x56158b=_0x1f82b8||_0x35f1b3(0x153);switch(_0x56158b[_0x35f1b3(0x1ac)]()){case _0x35f1b3(0x1b4):_0x4187ec=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a[_0x35f1b3(0x1d7)](),0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date['UTC'](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x35f1b3(0x1a3):const _0x2db20c=new Date(_0x1dbb8a);_0x2db20c[_0x35f1b3(0x160)](_0x2db20c['getUTCDate']()-0x1),_0x4187ec=new Date(Date[_0x35f1b3(0x1d9)](_0x2db20c[_0x35f1b3(0x19f)](),_0x2db20c[_0x35f1b3(0x16d)](),_0x2db20c[_0x35f1b3(0x1d7)](),0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date[_0x35f1b3(0x1d9)](_0x2db20c['getUTCFullYear'](),_0x2db20c[_0x35f1b3(0x16d)](),_0x2db20c[_0x35f1b3(0x1d7)](),0x17,0x3b,0x3b,0x3e7));break;case _0x35f1b3(0x180):const _0x57df7d=_0x1dbb8a[_0x35f1b3(0x146)](),_0x36cb06=_0x57df7d===0x0?-0x6:0x1-_0x57df7d,_0x3299cb=_0x1dbb8a[_0x35f1b3(0x1d7)]()+_0x36cb06;_0x4187ec=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a['getUTCMonth'](),_0x3299cb,0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a['getUTCFullYear'](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a[_0x35f1b3(0x1d7)](),0x17,0x3b,0x3b,0x3e7));break;case _0x35f1b3(0x183):const _0x143da0=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a['getUTCDate']()-0x7)),_0x10bc0f=_0x143da0['getUTCDay'](),_0x1af796=_0x10bc0f===0x0?-0x6:0x1-_0x10bc0f,_0x8bacd8=_0x143da0[_0x35f1b3(0x1d7)]()+_0x1af796;_0x4187ec=new Date(Date['UTC'](_0x143da0['getUTCFullYear'](),_0x143da0[_0x35f1b3(0x16d)](),_0x8bacd8,0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date['UTC'](_0x143da0['getUTCFullYear'](),_0x143da0['getUTCMonth'](),_0x8bacd8+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x35f1b3(0x153):_0x4187ec=new Date(Date['UTC'](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),0x1,0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a[_0x35f1b3(0x1d7)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x4187ec=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x4187ec=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date['UTC'](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a[_0x35f1b3(0x1d7)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x4187ec=new Date(Date[_0x35f1b3(0x1d9)](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x2acb83=new Date(Date['UTC'](_0x1dbb8a[_0x35f1b3(0x19f)](),_0x1dbb8a[_0x35f1b3(0x16d)](),_0x1dbb8a[_0x35f1b3(0x1d7)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x35f1b3(0x205)](_0x35f1b3(0x1a6)+_0x4187ec[_0x35f1b3(0x1bb)]()+'\x20to\x20'+_0x2acb83[_0x35f1b3(0x1bb)]());const _0x20abf7={'gte':_0x4187ec,'lte':_0x2acb83},[_0x3a9840,_0x493819,_0x33128e,_0x53df77,_0x434336,_0xfa57f2,_0x323668,_0x337252,_0x459940,_0x4071d4,_0xc3aece]=await Promise[_0x35f1b3(0x126)]([database_1[_0x35f1b3(0x15b)][_0x35f1b3(0x1dd)][_0x35f1b3(0x1bc)]({'where':{'shopId':_0x2fb891,'gateway':{'not':_0x35f1b3(0x137)},'status':{'notIn':['PENDING',_0x35f1b3(0x1cf)]},'createdAt':_0x20abf7}}),database_1[_0x35f1b3(0x15b)]['payment'][_0x35f1b3(0x1bc)]({'where':{'shopId':_0x2fb891,'gateway':{'not':'test_gateway'},'status':_0x35f1b3(0x13b),'createdAt':_0x20abf7}}),database_1['default'][_0x35f1b3(0x1dd)][_0x35f1b3(0x1bc)]({'where':{'shopId':_0x2fb891,'gateway':{'not':_0x35f1b3(0x137)},'status':'CHARGEBACK'}}),database_1['default']['payment'][_0x35f1b3(0x1bc)]({'where':{'shopId':_0x2fb891,'gateway':{'not':'test_gateway'},'status':_0x35f1b3(0x19d)}}),database_1[_0x35f1b3(0x15b)]['payment']['findMany']({'where':{'shopId':_0x2fb891,'gateway':{'not':_0x35f1b3(0x137)},'status':_0x35f1b3(0x13b),'createdAt':_0x20abf7},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x35f1b3(0x15b)][_0x35f1b3(0x1dd)]['findMany']({'where':{'shopId':_0x2fb891,'gateway':{'not':_0x35f1b3(0x137)}},'take':0x4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x35f1b3(0x15b)][_0x35f1b3(0x1dd)][_0x35f1b3(0x1f1)]({'where':{'shopId':_0x2fb891,'gateway':{'not':_0x35f1b3(0x137)},'createdAt':_0x20abf7},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x35f1b3(0x13f)}}),database_1[_0x35f1b3(0x15b)]['payment'][_0x35f1b3(0x1bc)]({'where':{'shopId':_0x2fb891,'gateway':{'not':'test_gateway'},'status':_0x35f1b3(0x13b)}}),database_1[_0x35f1b3(0x15b)][_0x35f1b3(0x1dd)][_0x35f1b3(0x1f1)]({'where':{'shopId':_0x2fb891,'gateway':{'not':'test_gateway'},'status':_0x35f1b3(0x13b)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x35f1b3(0x15b)][_0x35f1b3(0x19a)]['findUnique']({'where':{'id':_0x2fb891},'select':{'balance':!![]}}),database_1['default'][_0x35f1b3(0x1dd)][_0x35f1b3(0x1f1)]({'where':{'shopId':_0x2fb891,'gateway':{'not':_0x35f1b3(0x137)}},'select':{'gateway':!![]}})]),_0xb5b20d={};for(const _0x2a3801 of _0xc3aece){_0x2a3801[_0x35f1b3(0x15a)]&&(_0xb5b20d[_0x2a3801[_0x35f1b3(0x15a)]]=(_0xb5b20d[_0x2a3801['gateway']]||0x0)+0x1);}console[_0x35f1b3(0x205)](_0x35f1b3(0x1c8),_0xb5b20d);let _0x3eee37=0x0,_0x313738=0x0;for(const _0x3ed611 of _0x434336){if(_0x3ed611[_0x35f1b3(0x191)])_0x3eee37+=_0x3ed611[_0x35f1b3(0x191)];else{const _0x580efb=await currencyService_1[_0x35f1b3(0x1ae)][_0x35f1b3(0x1dc)](_0x3ed611[_0x35f1b3(0x195)],_0x3ed611[_0x35f1b3(0x1aa)]);_0x3eee37+=_0x580efb;}_0x3ed611[_0x35f1b3(0x1d8)]&&(_0x313738+=_0x3ed611['amountAfterGatewayCommissionUSDT']);}let _0x349e9c=0x0;for(const _0x28bb44 of _0x459940){_0x28bb44[_0x35f1b3(0x1d8)]&&(_0x349e9c+=_0x28bb44[_0x35f1b3(0x1d8)]);}const _0x3bf6c9=this[_0x35f1b3(0x18c)](_0x323668,_0x4187ec,_0x2acb83||_0x1dbb8a),_0x4d8af5=_0x3a9840>0x0?_0x493819/_0x3a9840*0x64:0x0,_0x279f3b=_0x337252>0x0?_0x33128e/_0x337252*0x64:0x0;return{'totalPayments':_0x3a9840,'successfulPayments':_0x493819,'totalRevenue':Math[_0x35f1b3(0x1c6)](_0x3eee37*0x64)/0x64,'merchantEarnings':Math[_0x35f1b3(0x1c6)](_0x313738*0x64)/0x64,'merchantTotalRevenue':Math[_0x35f1b3(0x1c6)](_0x349e9c*0x64)/0x64,'payoutBalance':Math[_0x35f1b3(0x1c6)]((_0x4071d4?.[_0x35f1b3(0x1f2)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x4d8af5*0x64)/0x64,'chargebackRate':Math[_0x35f1b3(0x1c6)](_0x279f3b*0x64)/0x64,'chargebacks':_0x33128e,'refunds':_0x53df77,'paymentsByGateway':_0xb5b20d,'dailyRevenue':_0x3bf6c9[_0x35f1b3(0x20a)],'dailyPayments':_0x3bf6c9[_0x35f1b3(0x1e2)],'recentPayments':_0xfa57f2['map'](_0x4a45e5=>({'id':_0x4a45e5['id'],'gateway':_0x4a45e5['gateway'],'amount':_0x4a45e5['amount'],'currency':_0x4a45e5['currency'],'status':_0x4a45e5[_0x35f1b3(0x1b5)],'createdAt':_0x4a45e5[_0x35f1b3(0x1e1)]}))};}['generateDailyStatistics'](_0x47a121,_0x573ec3,_0x23a39f){const _0x5a8ba7=a82_0x1d1004,_0x5d20f2=new Map(),_0x230f32=new Date(_0x573ec3);while(_0x230f32<=_0x23a39f){const _0x24bc83=_0x230f32[_0x5a8ba7(0x1bb)]()[_0x5a8ba7(0x144)]('T')[0x0];_0x5d20f2[_0x5a8ba7(0x13a)](_0x24bc83,{'revenue':0x0,'count':0x0}),_0x230f32[_0x5a8ba7(0x1f4)](_0x230f32[_0x5a8ba7(0x136)]()+0x1);}for(const _0x233bc7 of _0x47a121){const _0x370bc9=_0x233bc7[_0x5a8ba7(0x1e1)][_0x5a8ba7(0x1bb)]()[_0x5a8ba7(0x144)]('T')[0x0],_0x15564e=_0x5d20f2[_0x5a8ba7(0x1ca)](_0x370bc9);_0x15564e&&(_0x15564e[_0x5a8ba7(0x1bc)]+=0x1,_0x233bc7[_0x5a8ba7(0x1b5)]===_0x5a8ba7(0x13b)&&_0x233bc7[_0x5a8ba7(0x191)]&&(_0x15564e[_0x5a8ba7(0x13d)]+=_0x233bc7[_0x5a8ba7(0x191)]));}const _0x33660d=[],_0xa2cfd3=[];for(const [_0xc637c,_0x738a73]of _0x5d20f2){_0x33660d['push']({'date':_0xc637c,'amount':Math[_0x5a8ba7(0x1c6)](_0x738a73[_0x5a8ba7(0x13d)]*0x64)/0x64}),_0xa2cfd3['push']({'date':_0xc637c,'count':_0x738a73[_0x5a8ba7(0x1bc)]});}return{'dailyRevenue':_0x33660d,'dailyPayments':_0xa2cfd3};}[a82_0x1d1004(0x1c1)](_0x8d5780=0x8){const _0x3324c1=a82_0x1d1004,_0x1d9ae8=[];for(let _0x2e0dc6=0x0;_0x2e0dc6<_0x8d5780;_0x2e0dc6++){const _0x51f4c5=crypto_1['default'][_0x3324c1(0x142)](0x4)['toString'](_0x3324c1(0x1ad))[_0x3324c1(0x194)]();_0x1d9ae8['push'](_0x51f4c5);}return _0x1d9ae8;}async[a82_0x1d1004(0x189)](_0x1c73be){const _0x10615f=a82_0x1d1004,_0x44dffb=await database_1['default']['shop'][_0x10615f(0x1cb)]({'where':{'id':_0x1c73be},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x44dffb)throw new Error(_0x10615f(0x187));const _0x15bc6e=speakeasy_1['default']['generateSecret']({'name':'TrapaPay\x20('+_0x44dffb['username']+')','issuer':'TrapaPay','length':0x20}),_0x42596a=await qrcode_1[_0x10615f(0x15b)][_0x10615f(0x1d0)](_0x15bc6e[_0x10615f(0x198)]),_0x43337c=this[_0x10615f(0x1c1)](0x8),_0x1e9838=await Promise[_0x10615f(0x126)](_0x43337c[_0x10615f(0x199)](_0xc0c138=>bcryptjs_1[_0x10615f(0x15b)][_0x10615f(0x20f)](_0xc0c138,0xa)));return await database_1[_0x10615f(0x15b)]['shop']['update']({'where':{'id':_0x1c73be},'data':{'twoFactorSecret':_0x15bc6e[_0x10615f(0x173)],'backupCodes':JSON[_0x10615f(0x1d2)](_0x1e9838)}}),console[_0x10615f(0x205)]('üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x44dffb[_0x10615f(0x20c)]),console[_0x10615f(0x205)](_0x10615f(0x12a)+_0x43337c[_0x10615f(0x1a2)]+_0x10615f(0x196)),{'secret':_0x15bc6e[_0x10615f(0x173)],'qrCode':_0x42596a,'manualEntryKey':_0x15bc6e[_0x10615f(0x173)],'backupCodes':_0x43337c};}async[a82_0x1d1004(0x1a7)](_0x34a4ec,_0xbd8e91){const _0x365566=a82_0x1d1004,_0x119c41=await database_1[_0x365566(0x15b)][_0x365566(0x19a)][_0x365566(0x1cb)]({'where':{'id':_0x34a4ec},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x119c41)throw new Error(_0x365566(0x187));if(!_0x119c41['twoFactorSecret'])throw new Error(_0x365566(0x15e));if(_0x119c41[_0x365566(0x163)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x55806b=speakeasy_1['default'][_0x365566(0x1fc)][_0x365566(0x156)]({'secret':_0x119c41[_0x365566(0x186)],'encoding':'base32','token':_0xbd8e91,'window':0x2});if(!_0x55806b)throw new Error(_0x365566(0x171));return await database_1['default'][_0x365566(0x19a)][_0x365566(0x1e5)]({'where':{'id':_0x34a4ec},'data':{'twoFactorEnabled':!![]}}),console[_0x365566(0x205)](_0x365566(0x1ec)+_0x119c41[_0x365566(0x20c)]),{'enabled':!![]};}async[a82_0x1d1004(0x1d4)](_0x589801){const _0x255bb3=a82_0x1d1004,_0x573645=await database_1[_0x255bb3(0x15b)][_0x255bb3(0x19a)][_0x255bb3(0x1cb)]({'where':{'id':_0x589801},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x573645)throw new Error(_0x255bb3(0x187));await database_1[_0x255bb3(0x15b)]['shop'][_0x255bb3(0x1e5)]({'where':{'id':_0x589801},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log'](_0x255bb3(0x158)+_0x573645[_0x255bb3(0x20c)]);}}function a82_0x458c(_0x4a91f6,_0x47c5ff){_0x4a91f6=_0x4a91f6-0x123;const _0x12a706=a82_0x12a7();let _0x458c44=_0x12a706[_0x4a91f6];return _0x458c44;}exports[a82_0x1d1004(0x190)]=ShopService;function a82_0x12a7(){const _0x5a8081=[',\x20period:\x20','getUTCMonth','../config/database','merchantUrl','USDT\x20ERC20','Invalid\x202FA\x20token','\x20to\x20','base32','desc','settings','responseBody','paymentId','...','Rapyd','lte','erc20','test_payment_123','getShopProfile','parse','isArray','this_week','telegram','PENDING','last_week','usdcPolygonWallet','aggregate','twoFactorSecret','Shop\x20not\x20found','availableBalance','setup2FA','getPayoutStatistics','AVAILABLE_GATEWAYS','generateDailyStatistics','getTime','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','webhookLog','ShopService','amountUSDT','No\x20webhook\x20URL\x20configured','deletePayment','toUpperCase','amount','\x20backup\x20codes','polygon_usdc','otpauth_url','map','shop','webhookEvents','compare','REFUND','network','getUTCFullYear','../types/gateway','Failed\x20to\x20send\x20webhook:\x20','length','yesterday','\x20USDT\x20(current\x20balance)','erc20_usdc','üìÖ\x20Final\x20date\x20range:\x20','enable2FA','750832QidtQQ','getPayments','currency','6OfbbYl','toLowerCase','hex','currencyService','Unknown\x20error','findFirst','getPayoutStats','__importDefault','7683680YTdlTu','today','status','üìÖ\x20Custom\x20period:\x20','trc20','sourceCurrency','90d','getMonth','toISOString','count','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','twoFactorToken','amountIsEditable','Webhook\x20returned\x20error:\x20','generateBackupCodes','isActive','createPublicPayment','crypto','usdtTrcWallet','round','./currencyService','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','getStatistics','get','findUnique','10wnXWGj','thisMonth','ceil','EXPIRED','toDataURL','delete','stringify','üìÖ\x20Date\x20start:\x20','disable2FA','30d','Invalid\x202FA\x20token\x20or\x20backup\x20code','getUTCDate','amountAfterGatewayCommissionUSDT','UTC','USD','paid','convertToUSDT','payment','qrcode','CoinToPay','üìÖ\x20Period\x20end:\x20','createdAt','dailyPayments','Test\x20webhook\x20sent\x20successfully\x20(','1412Eolltw','update','filter','application/json','2FA\x20token\x20is\x20required','startsWith','12460584hshKtu','notes','üîê\x202FA\x20enabled\x20for\x20shop:\x20','Payment\x20System/1.0\x20(Test)','getFullYear','üìä\x20Final\x20WHERE\x20conditions:',',\x20dateFrom:\x20','findMany','balance','getPaymentsByShop','setDate','Payment\x20not\x20found','KLYME\x20GB','gte','USDT\x20TRC20','shopUrl','\x20payout\x20statistics\x20calculated:','üìä\x20Getting\x20statistics\x20for\x20shop\x20','totp','maxPayments','customer','testWebhook','üìÖ\x20Custom\x20date\x20range:\x20','USDT\x20BSC','\x20\x20\x20üìÖ\x20This\x20month:\x20','webhookUrl','YESTERDAY','log','4KamkYd','Error\x20parsing\x20webhook\x20events:','expiresAt','USDT\x20Polygon','dailyRevenue','txid','username','wallets','message','hash','__esModule','polygon','speakeasy','splice','payout','updatePayment','üìÖ\x20Period\x20start:\x20','sha256','all','statusText','test_order_123','paymentGateways','üîë\x20Generated\x20','custom_','country','USDC\x20Ethereum','paymentService','statusCode','error','COMPLETED','replace','getShopPayoutStats','KLYME\x20DE','usdcErcWallet','getDate','test_gateway','language','backupCodes','set','PAID','9836834pKYWro','revenue','test','asc','33xZvWlE','KLYME\x20EU','randomBytes','getGatewayDisplayName','split','publicKey','getUTCDay','retryCount','\x20\x20\x20üíµ\x20Available\x20balance:\x20','totalPaidOut','telegramId','usdtErcWallet','event','11823348raPtpi','getPayoutById','gatewaySettings','üìä\x20Status\x20filter:\x20','setHours','reduce','this_month','shopId','5793ZzIpCT','verify','./paymentService','üîê\x202FA\x20disabled\x20for\x20shop:\x20','gateways','gateway','default','formatNetworkName','createPayment','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','923103cRJzjE','setUTCDate','üìÖ\x20Date\x20end:\x20','üåê\x20Network\x20filter:\x20','twoFactorEnabled','name','paidAt','redirectUrl','secretKey','Noda','usdtPolygonWallet','POST',',\x20dateTo:\x20'];a82_0x12a7=function(){return _0x5a8081;};return a82_0x12a7();}