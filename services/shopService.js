'use strict';const a86_0x53df6c=a86_0x5cdb;(function(_0x373500,_0x1cbbc8){const _0x5d37c0=a86_0x5cdb,_0x1c1a40=_0x373500();while(!![]){try{const _0x22f59c=parseInt(_0x5d37c0(0x93))/0x1*(-parseInt(_0x5d37c0(0x160))/0x2)+-parseInt(_0x5d37c0(0x129))/0x3*(-parseInt(_0x5d37c0(0x92))/0x4)+parseInt(_0x5d37c0(0xa2))/0x5*(-parseInt(_0x5d37c0(0x13d))/0x6)+-parseInt(_0x5d37c0(0x15b))/0x7*(parseInt(_0x5d37c0(0x117))/0x8)+-parseInt(_0x5d37c0(0xe3))/0x9+-parseInt(_0x5d37c0(0xf0))/0xa+parseInt(_0x5d37c0(0x120))/0xb*(parseInt(_0x5d37c0(0xc0))/0xc);if(_0x22f59c===_0x1cbbc8)break;else _0x1c1a40['push'](_0x1c1a40['shift']());}catch(_0x3694c8){_0x1c1a40['push'](_0x1c1a40['shift']());}}}(a86_0x55af,0xf37d4));var __importDefault=this&&this[a86_0x53df6c(0x125)]||function(_0x3d91d0){const _0x350ad7=a86_0x53df6c;return _0x3d91d0&&_0x3d91d0[_0x350ad7(0x111)]?_0x3d91d0:{'default':_0x3d91d0};};Object['defineProperty'](exports,a86_0x53df6c(0x111),{'value':!![]}),exports[a86_0x53df6c(0xed)]=void 0x0;function a86_0x5cdb(_0x25ae68,_0x4ff385){_0x25ae68=_0x25ae68-0x70;const _0x55af64=a86_0x55af();let _0x5cdbd7=_0x55af64[_0x25ae68];return _0x5cdbd7;}const database_1=__importDefault(require(a86_0x53df6c(0xa0))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a86_0x53df6c(0x140))),speakeasy_1=__importDefault(require(a86_0x53df6c(0xb0))),qrcode_1=__importDefault(require('qrcode')),currencyService_1=require(a86_0x53df6c(0x156)),paymentService_1=require(a86_0x53df6c(0x134)),gateway_1=require('../types/gateway');class ShopService{constructor(){const _0x34189c=a86_0x53df6c;this[_0x34189c(0x14d)]=new paymentService_1[(_0x34189c(0xf5))]();}async[a86_0x53df6c(0xa4)](_0x12c8c9){const _0x3ccf05=a86_0x53df6c,_0x45c78f=await database_1[_0x3ccf05(0x13e)][_0x3ccf05(0x11b)][_0x3ccf05(0x87)]({'where':{'id':_0x12c8c9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x45c78f)throw new Error(_0x3ccf05(0x74));let _0x4359ae=[];if(_0x45c78f[_0x3ccf05(0x10f)]?.['webhookEvents'])try{_0x4359ae=Array[_0x3ccf05(0x105)](_0x45c78f[_0x3ccf05(0x10f)][_0x3ccf05(0xee)])?_0x45c78f[_0x3ccf05(0x10f)]['webhookEvents']:JSON[_0x3ccf05(0x107)](_0x45c78f['settings'][_0x3ccf05(0xee)]);}catch(_0x3b0c7c){console[_0x3ccf05(0x118)]('Error\x20parsing\x20webhook\x20events:',_0x3b0c7c),_0x4359ae=[];}const _0x5dc7d3=gateway_1[_0x3ccf05(0xe0)][_0x3ccf05(0x114)](_0x3c2b49=>_0x3c2b49[_0x3ccf05(0xf6)])[_0x3ccf05(0x13c)](_0x474008=>_0x474008[_0x3ccf05(0x112)]);let _0x4ca382=_0x45c78f[_0x3ccf05(0x79)]?JSON['parse'](_0x45c78f[_0x3ccf05(0x79)]):[];return Array['isArray'](_0x4ca382)&&(_0x4ca382=_0x4ca382[_0x3ccf05(0x13c)](_0x519937=>_0x519937[_0x3ccf05(0x71)](/\s+/g,'_')[_0x3ccf05(0x10e)]())[_0x3ccf05(0x114)](_0x513961=>_0x5dc7d3['includes'](_0x513961))),{'id':_0x45c78f['id'],'fullName':_0x45c78f['name'],'username':_0x45c78f[_0x3ccf05(0x161)],'telegramId':_0x45c78f[_0x3ccf05(0xfc)],'merchantUrl':_0x45c78f[_0x3ccf05(0xd0)],'gateways':_0x4ca382,'gatewaySettings':_0x45c78f['gatewaySettings']?JSON['parse'](_0x45c78f[_0x3ccf05(0x76)]):null,'publicKey':_0x45c78f[_0x3ccf05(0x141)],'secretKey':_0x45c78f['secretKey'],'webhookUrl':_0x45c78f['settings']?.['webhookUrl']||null,'webhookEvents':_0x4359ae,'wallets':{'usdtPolygonWallet':_0x45c78f['usdtPolygonWallet'],'usdtTrcWallet':_0x45c78f[_0x3ccf05(0x13a)],'usdtErcWallet':_0x45c78f[_0x3ccf05(0x88)],'usdcPolygonWallet':_0x45c78f[_0x3ccf05(0xde)],'usdcErcWallet':_0x45c78f[_0x3ccf05(0xbd)]},'status':_0x45c78f['status'],'createdAt':_0x45c78f['createdAt']};}async[a86_0x53df6c(0x86)](_0x526f1d,_0x4d8e45){const _0x10b334=a86_0x53df6c,_0x554513={};_0x4d8e45[_0x10b334(0xbb)]&&(_0x554513[_0x10b334(0x112)]=_0x4d8e45['fullName']);_0x4d8e45[_0x10b334(0x143)]!==undefined&&(_0x554513[_0x10b334(0xfc)]=_0x4d8e45['telegramId']||null);_0x4d8e45[_0x10b334(0xe7)]&&(_0x554513[_0x10b334(0xd0)]=_0x4d8e45[_0x10b334(0xe7)]);_0x4d8e45[_0x10b334(0xbc)]&&(_0x554513[_0x10b334(0x79)]=JSON[_0x10b334(0x9c)](_0x4d8e45[_0x10b334(0xbc)]));_0x4d8e45[_0x10b334(0x76)]&&(_0x554513['gatewaySettings']=JSON['stringify'](_0x4d8e45[_0x10b334(0x76)]));_0x4d8e45[_0x10b334(0xfe)]&&(_0x4d8e45[_0x10b334(0xfe)]['usdtPolygonWallet']!==undefined&&(_0x554513[_0x10b334(0x132)]=_0x4d8e45['wallets'][_0x10b334(0x132)]||null),_0x4d8e45[_0x10b334(0xfe)][_0x10b334(0x13a)]!==undefined&&(_0x554513['usdtTrcWallet']=_0x4d8e45[_0x10b334(0xfe)][_0x10b334(0x13a)]||null),_0x4d8e45[_0x10b334(0xfe)][_0x10b334(0x88)]!==undefined&&(_0x554513[_0x10b334(0x88)]=_0x4d8e45['wallets'][_0x10b334(0x88)]||null),_0x4d8e45[_0x10b334(0xfe)][_0x10b334(0xde)]!==undefined&&(_0x554513[_0x10b334(0xde)]=_0x4d8e45['wallets']['usdcPolygonWallet']||null));const _0x8f6839=await database_1[_0x10b334(0x13e)][_0x10b334(0x11b)]['update']({'where':{'id':_0x526f1d},'data':_0x554513,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x3e52ce=[];if(_0x8f6839['settings']?.[_0x10b334(0xee)])try{_0x3e52ce=Array['isArray'](_0x8f6839[_0x10b334(0x10f)][_0x10b334(0xee)])?_0x8f6839[_0x10b334(0x10f)]['webhookEvents']:JSON[_0x10b334(0x107)](_0x8f6839['settings'][_0x10b334(0xee)]);}catch(_0x20e83b){console[_0x10b334(0x118)](_0x10b334(0x14f),_0x20e83b),_0x3e52ce=[];}return{'id':_0x8f6839['id'],'fullName':_0x8f6839[_0x10b334(0x112)],'username':_0x8f6839[_0x10b334(0x161)],'telegramId':_0x8f6839['telegram'],'merchantUrl':_0x8f6839[_0x10b334(0xd0)],'gateways':_0x8f6839[_0x10b334(0x79)]?JSON['parse'](_0x8f6839[_0x10b334(0x79)]):null,'gatewaySettings':_0x8f6839[_0x10b334(0x76)]?JSON[_0x10b334(0x107)](_0x8f6839[_0x10b334(0x76)]):null,'publicKey':_0x8f6839[_0x10b334(0x141)],'secretKey':_0x8f6839[_0x10b334(0x15a)],'webhookUrl':_0x8f6839[_0x10b334(0x10f)]?.[_0x10b334(0x96)]||null,'webhookEvents':_0x3e52ce,'wallets':{'usdtPolygonWallet':_0x8f6839['usdtPolygonWallet'],'usdtTrcWallet':_0x8f6839[_0x10b334(0x13a)],'usdtErcWallet':_0x8f6839[_0x10b334(0x88)],'usdcPolygonWallet':_0x8f6839[_0x10b334(0xde)],'usdcErcWallet':_0x8f6839[_0x10b334(0xbd)]},'status':_0x8f6839[_0x10b334(0x104)],'createdAt':_0x8f6839[_0x10b334(0x138)]};}async[a86_0x53df6c(0x126)](_0x5a4068,_0xbc230f){const _0x41282b=a86_0x53df6c,_0x4beb67=await database_1[_0x41282b(0x13e)][_0x41282b(0x11b)][_0x41282b(0x87)]({'where':{'id':_0x5a4068},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x4beb67)throw new Error(_0x41282b(0x74));if(_0x4beb67['twoFactorEnabled']){if(!_0xbc230f[_0x41282b(0xd4)])throw new Error('2FA\x20token\x20is\x20required');const _0x58cd31=speakeasy_1[_0x41282b(0x13e)][_0x41282b(0x91)]['verify']({'secret':_0x4beb67[_0x41282b(0x11a)],'encoding':_0x41282b(0x139),'token':_0xbc230f[_0x41282b(0xd4)],'window':0x2});if(!_0x58cd31){let _0x356ff8=![];if(_0x4beb67['backupCodes']){const _0x2577fd=JSON[_0x41282b(0x107)](_0x4beb67['backupCodes']);for(let _0x3dc207=0x0;_0x3dc207<_0x2577fd['length'];_0x3dc207++){const _0x2be969=await bcryptjs_1['default'][_0x41282b(0x147)](_0xbc230f[_0x41282b(0xd4)],_0x2577fd[_0x3dc207]);if(_0x2be969){_0x356ff8=!![],_0x2577fd['splice'](_0x3dc207,0x1),await database_1[_0x41282b(0x13e)][_0x41282b(0x11b)][_0x41282b(0xdb)]({'where':{'id':_0x5a4068},'data':{'backupCodes':JSON['stringify'](_0x2577fd)}});break;}}}if(!_0x356ff8)throw new Error(_0x41282b(0x78));}}const _0x21d1c6={};_0xbc230f[_0x41282b(0x132)]!==undefined&&(_0x21d1c6[_0x41282b(0x132)]=_0xbc230f[_0x41282b(0x132)]||null),_0xbc230f[_0x41282b(0x13a)]!==undefined&&(_0x21d1c6[_0x41282b(0x13a)]=_0xbc230f[_0x41282b(0x13a)]||null),_0xbc230f[_0x41282b(0x88)]!==undefined&&(_0x21d1c6['usdtErcWallet']=_0xbc230f['usdtErcWallet']||null),_0xbc230f[_0x41282b(0xde)]!==undefined&&(_0x21d1c6[_0x41282b(0xde)]=_0xbc230f['usdcPolygonWallet']||null),_0xbc230f[_0x41282b(0xbd)]!==undefined&&(_0x21d1c6[_0x41282b(0xbd)]=_0xbc230f[_0x41282b(0xbd)]||null),await database_1[_0x41282b(0x13e)][_0x41282b(0x11b)][_0x41282b(0xdb)]({'where':{'id':_0x5a4068},'data':_0x21d1c6});}async['testWebhook'](_0x57848a){const _0x703af2=a86_0x53df6c,_0x4f87c5=await database_1['default'][_0x703af2(0x11b)][_0x703af2(0x87)]({'where':{'id':_0x57848a},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x4f87c5?.['settings']?.[_0x703af2(0x96)])throw new Error(_0x703af2(0x106));const _0x35b880={'event':'test','payment':{'id':_0x703af2(0xf2),'order_id':_0x703af2(0xd5),'gateway':_0x703af2(0x7f),'amount':0x64,'currency':_0x703af2(0xb9),'status':_0x703af2(0xb6),'created_at':new Date()['toISOString']()}};try{const _0x1585d1=JSON[_0x703af2(0x9c)](_0x35b880),_0x4b3377=crypto_1[_0x703af2(0x13e)][_0x703af2(0xcd)](_0x703af2(0x115),_0x4f87c5['secretKey'])[_0x703af2(0xdb)](_0x1585d1)[_0x703af2(0x159)](_0x703af2(0x14b)),_0xdf6cd7=await fetch(_0x4f87c5[_0x703af2(0x10f)][_0x703af2(0x96)],{'method':_0x703af2(0x137),'headers':{'Content-Type':_0x703af2(0x108),'User-Agent':'Payment\x20System/1.0\x20(Test)','X-Webhook-Signature':_0x4b3377},'body':_0x1585d1});return _0xdf6cd7['ok']?{'success':!![],'message':_0x703af2(0xe6)+_0xdf6cd7['status']+')'}:{'success':![],'message':_0x703af2(0x81)+_0xdf6cd7['status']+'\x20'+_0xdf6cd7[_0x703af2(0x94)]};}catch(_0x129092){return{'success':![],'message':_0x703af2(0x98)+(_0x129092 instanceof Error?_0x129092[_0x703af2(0x10a)]:_0x703af2(0x7d))};}}async[a86_0x53df6c(0x75)](_0x53ad48){const _0x1c9757=a86_0x53df6c;return this[_0x1c9757(0x14d)]['createPublicPayment']({'public_key':'','gateway':_0x53ad48[_0x1c9757(0x135)],'order_id':undefined,'amount':_0x53ad48[_0x1c9757(0xa5)],'currency':_0x53ad48[_0x1c9757(0x164)],'source_currency':_0x53ad48[_0x1c9757(0xfa)],'usage':_0x53ad48[_0x1c9757(0xa9)],'expires_at':_0x53ad48['expiresAt']?.[_0x1c9757(0x7c)](),'success_url':_0x53ad48['redirectUrl'],'fail_url':_0x53ad48[_0x1c9757(0xaa)],'customer_email':_0x53ad48[_0x1c9757(0x110)],'customer_name':_0x53ad48[_0x1c9757(0x113)],'country':_0x53ad48[_0x1c9757(0xd7)],'language':_0x53ad48['language'],'amount_is_editable':_0x53ad48[_0x1c9757(0xf7)],'max_payments':_0x53ad48['maxPayments'],'customer':_0x53ad48[_0x1c9757(0x7e)]});}async[a86_0x53df6c(0xcb)](_0x1c69fe,_0x2906fe){const _0x799a16=a86_0x53df6c;return this[_0x799a16(0x14d)]['getPaymentsByShop'](_0x1c69fe,_0x2906fe);}async[a86_0x53df6c(0x10b)](_0x2090fa,_0xc52fd7){const _0x3e20da=a86_0x53df6c;return this[_0x3e20da(0x14d)][_0x3e20da(0xd3)](_0x2090fa,_0xc52fd7);}async[a86_0x53df6c(0x102)](_0xfd948,_0x41989d,_0x448325){const _0x386fd3=a86_0x53df6c,_0x5529a3=await database_1[_0x386fd3(0x13e)][_0x386fd3(0xdc)][_0x386fd3(0x85)]({'where':{'id':_0x41989d,'shopId':_0xfd948}});if(!_0x5529a3)throw new Error(_0x386fd3(0xc3));const _0x2c0ba4=await database_1[_0x386fd3(0x13e)][_0x386fd3(0xdc)][_0x386fd3(0xdb)]({'where':{'id':_0x41989d},'data':{..._0x448325,'updatedAt':new Date()}});return _0x2c0ba4;}async[a86_0x53df6c(0x9a)](_0x5f2cd9,_0x5bb803){const _0x3f33c4=a86_0x53df6c,_0x29640e=await database_1[_0x3f33c4(0x13e)][_0x3f33c4(0xdc)][_0x3f33c4(0x85)]({'where':{'id':_0x5bb803,'shopId':_0x5f2cd9}});if(!_0x29640e)throw new Error(_0x3f33c4(0xc3));await database_1[_0x3f33c4(0x13e)][_0x3f33c4(0xdc)]['delete']({'where':{'id':_0x5bb803}});}[a86_0x53df6c(0xb2)](_0x352235){const _0x2a93ca=a86_0x53df6c,_0x5ed262={'polygon':_0x2a93ca(0x97),'trc20':'USDT\x20TRC20','erc20':_0x2a93ca(0x11d),'bsc':'USDT\x20BSC','polygon_usdc':_0x2a93ca(0x89),'erc20_usdc':_0x2a93ca(0x12a)};return _0x5ed262[_0x352235]||_0x352235;}async[a86_0x53df6c(0x15f)](_0x531189,_0x9ef154){const _0x2b8e77=a86_0x53df6c,{page:_0x1d824a,limit:_0x3e9f6d,status:_0x4a889c,method:_0x29d234,network:_0x17fa82,dateFrom:_0x147069,dateTo:_0x2645e0,periodFrom:_0x593ab4,periodTo:_0x12b966}=_0x9ef154,_0x23c16a=(_0x1d824a-0x1)*_0x3e9f6d;console[_0x2b8e77(0x149)](_0x2b8e77(0x90),_0x9ef154);const _0x541256={'shopId':_0x531189};_0x4a889c&&(_0x541256[_0x2b8e77(0x104)]=_0x4a889c[_0x2b8e77(0xff)](),console['log'](_0x2b8e77(0x82)+_0x4a889c['toUpperCase']()));if(_0x29d234)_0x541256['network']=_0x29d234,console[_0x2b8e77(0x149)](_0x2b8e77(0xad)+_0x29d234);else _0x17fa82&&(_0x541256[_0x2b8e77(0x101)]=_0x17fa82,console[_0x2b8e77(0x149)](_0x2b8e77(0xb8)+_0x17fa82));if(_0x147069||_0x2645e0||_0x593ab4||_0x12b966){_0x541256['createdAt']={};if(_0x593ab4){const _0x4ff1d3=new Date(_0x593ab4);_0x4ff1d3['setHours'](0x0,0x0,0x0,0x1),_0x541256[_0x2b8e77(0x138)]['gte']=_0x4ff1d3,console['log'](_0x2b8e77(0x130)+_0x4ff1d3[_0x2b8e77(0x7c)]());}else{if(_0x147069){const _0xcbf1a3=new Date(_0x147069);_0xcbf1a3[_0x2b8e77(0x15e)](0x0,0x0,0x0,0x1),_0x541256[_0x2b8e77(0x138)][_0x2b8e77(0xa6)]=_0xcbf1a3,console['log'](_0x2b8e77(0xc5)+_0xcbf1a3[_0x2b8e77(0x7c)]());}}if(_0x12b966){const _0x160257=new Date(_0x12b966);_0x160257[_0x2b8e77(0x15e)](0x17,0x3b,0x3b,0x3e7),_0x541256[_0x2b8e77(0x138)][_0x2b8e77(0xfb)]=_0x160257,console[_0x2b8e77(0x149)](_0x2b8e77(0x131)+_0x160257['toISOString']());}else{if(_0x2645e0){const _0x451efd=new Date(_0x2645e0);_0x451efd[_0x2b8e77(0x15e)](0x17,0x3b,0x3b,0x3e7),_0x541256[_0x2b8e77(0x138)][_0x2b8e77(0xfb)]=_0x451efd,console[_0x2b8e77(0x149)](_0x2b8e77(0x14c)+_0x451efd[_0x2b8e77(0x7c)]());}}}console['log'](_0x2b8e77(0x100),JSON[_0x2b8e77(0x9c)](_0x541256,null,0x2));const [_0x495b30,_0x1da96f]=await Promise['all']([database_1[_0x2b8e77(0x13e)][_0x2b8e77(0x8b)][_0x2b8e77(0x73)]({'where':_0x541256,'skip':_0x23c16a,'take':_0x3e9f6d,'orderBy':{'createdAt':_0x2b8e77(0xb1)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x2b8e77(0x13e)]['payout'][_0x2b8e77(0x8f)]({'where':_0x541256})]);return{'payouts':_0x495b30[_0x2b8e77(0x13c)](_0x71ce03=>{const _0x2e955a=_0x2b8e77;let _0x304543=null;switch(_0x71ce03[_0x2e955a(0x101)]){case _0x2e955a(0x12d):_0x304543=_0x71ce03[_0x2e955a(0x11b)][_0x2e955a(0x132)];break;case _0x2e955a(0x9b):_0x304543=_0x71ce03[_0x2e955a(0x11b)][_0x2e955a(0x13a)];break;case'erc20':_0x304543=_0x71ce03[_0x2e955a(0x11b)][_0x2e955a(0x88)];break;case _0x2e955a(0x7b):_0x304543=_0x71ce03[_0x2e955a(0x11b)][_0x2e955a(0xde)];break;case _0x2e955a(0xbe):_0x304543=_0x71ce03[_0x2e955a(0x11b)]['usdcErcWallet'];break;}return{'id':_0x71ce03['id'],'amount':_0x71ce03['amount'],'network':this[_0x2e955a(0xb2)](_0x71ce03[_0x2e955a(0x101)]),'wallet':_0x304543,'status':_0x71ce03[_0x2e955a(0x104)],'txid':_0x71ce03['txid'],'notes':_0x71ce03[_0x2e955a(0xe1)],'periodFrom':_0x71ce03[_0x2e955a(0xcc)],'periodTo':_0x71ce03[_0x2e955a(0xd1)],'createdAt':_0x71ce03['createdAt'],'paidAt':_0x71ce03['paidAt']};}),'pagination':{'page':_0x1d824a,'limit':_0x3e9f6d,'total':_0x1da96f,'totalPages':Math[_0x2b8e77(0x119)](_0x1da96f/_0x3e9f6d)}};}async[a86_0x53df6c(0xb5)](_0x4a971b,_0x328199){const _0x385066=a86_0x53df6c,_0x337d3c=await database_1['default'][_0x385066(0x8b)][_0x385066(0x85)]({'where':{'id':_0x328199,'shopId':_0x4a971b}});if(!_0x337d3c)return null;return{'id':_0x337d3c['id'],'amount':_0x337d3c['amount'],'network':_0x337d3c['network'],'status':_0x337d3c[_0x385066(0x104)],'txid':_0x337d3c['txid'],'notes':_0x337d3c['notes'],'createdAt':_0x337d3c['createdAt'],'paidAt':_0x337d3c[_0x385066(0xc7)]};}async[a86_0x53df6c(0xe2)](_0x117e9c,_0x4a5cc4){const _0x3407a1=a86_0x53df6c,_0x47e49e=new Date();let _0x42a8b7,_0x1fe3fc;switch(_0x4a5cc4){case _0x3407a1(0xa7):case'YESTERDAY':const _0x58af00=new Date(_0x47e49e);_0x58af00[_0x3407a1(0x15c)](_0x58af00[_0x3407a1(0x146)]()-0x1),_0x42a8b7=new Date(_0x58af00),_0x42a8b7[_0x3407a1(0x15e)](0x0,0x0,0x0,0x0),_0x1fe3fc=new Date(_0x58af00),_0x1fe3fc[_0x3407a1(0x15e)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x42a8b7=new Date(_0x47e49e[_0x3407a1(0x116)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3407a1(0xb7):_0x42a8b7=new Date(_0x47e49e[_0x3407a1(0x116)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3407a1(0x95):_0x42a8b7=new Date(_0x47e49e[_0x3407a1(0x116)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x42a8b7=new Date(_0x47e49e[_0x3407a1(0x116)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x26603e={'gte':_0x42a8b7};_0x1fe3fc&&(_0x26603e[_0x3407a1(0xfb)]=_0x1fe3fc);const [_0x3c6b4c,_0x27f346,_0x494a22,_0x494592,_0x4e5736,_0x361f83]=await Promise[_0x3407a1(0x136)]([database_1[_0x3407a1(0x13e)][_0x3407a1(0x8b)]['count']({'where':{'shopId':_0x117e9c,'createdAt':_0x26603e}}),database_1['default']['payout'][_0x3407a1(0x8f)]({'where':{'shopId':_0x117e9c,'status':_0x3407a1(0xcf),'createdAt':_0x26603e}}),database_1[_0x3407a1(0x13e)]['payout'][_0x3407a1(0x8f)]({'where':{'shopId':_0x117e9c,'status':_0x3407a1(0x155),'createdAt':_0x26603e}}),database_1[_0x3407a1(0x13e)][_0x3407a1(0x8b)][_0x3407a1(0x8f)]({'where':{'shopId':_0x117e9c,'status':_0x3407a1(0xd9),'createdAt':_0x26603e}}),database_1['default'][_0x3407a1(0x8b)][_0x3407a1(0x73)]({'where':{'shopId':_0x117e9c,'createdAt':_0x26603e},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x3407a1(0x13e)][_0x3407a1(0x8b)][_0x3407a1(0x73)]({'where':{'shopId':_0x117e9c},'take':0xa,'orderBy':{'createdAt':_0x3407a1(0xb1)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x1b3bee=_0x4e5736[_0x3407a1(0x158)]((_0xd0fca2,_0x1e761c)=>_0xd0fca2+_0x1e761c[_0x3407a1(0xa5)],0x0),_0x203994=_0x4e5736[_0x3407a1(0x114)](_0x197af2=>_0x197af2[_0x3407a1(0x104)]===_0x3407a1(0xcf))[_0x3407a1(0x158)]((_0x487e82,_0x2eeedc)=>_0x487e82+_0x2eeedc['amount'],0x0),_0x3cb5fc=_0x4e5736[_0x3407a1(0x114)](_0x4f5d52=>_0x4f5d52['status']===_0x3407a1(0x155))[_0x3407a1(0x158)]((_0x56e6d4,_0xc0770e)=>_0x56e6d4+_0xc0770e[_0x3407a1(0xa5)],0x0),_0x5ed621=_0x4e5736[_0x3407a1(0x158)]((_0x118b9b,_0x592a0f)=>{const _0x3ffb37=_0x3407a1;return _0x118b9b[_0x592a0f[_0x3ffb37(0x101)]]=(_0x118b9b[_0x592a0f[_0x3ffb37(0x101)]]||0x0)+0x1,_0x118b9b;},{}),_0x10f71d=_0x4e5736[_0x3407a1(0x158)]((_0x1e06a3,_0x88b79)=>{const _0x25e23c=_0x3407a1;return _0x1e06a3[_0x88b79[_0x25e23c(0x104)]]=(_0x1e06a3[_0x88b79['status']]||0x0)+0x1,_0x1e06a3;},{});return{'totalPayouts':_0x3c6b4c,'completedPayouts':_0x27f346,'pendingPayouts':_0x494a22,'rejectedPayouts':_0x494592,'totalAmount':_0x1b3bee,'completedAmount':_0x203994,'pendingAmount':_0x3cb5fc,'payoutsByMethod':_0x5ed621,'payoutsByStatus':_0x10f71d,'recentPayouts':_0x361f83[_0x3407a1(0x13c)](_0x5d1005=>({'id':_0x5d1005['id'],'shopId':_0x117e9c,'amount':_0x5d1005[_0x3407a1(0xa5)],'method':_0x5d1005['network'],'status':_0x5d1005[_0x3407a1(0x104)],'txid':_0x5d1005[_0x3407a1(0xae)],'createdAt':_0x5d1005['createdAt'],'paidAt':_0x5d1005[_0x3407a1(0xc7)]}))};}async[a86_0x53df6c(0x157)](_0x4c4c38){const _0x10592e=a86_0x53df6c;console[_0x10592e(0x149)]('üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x4c4c38+_0x10592e(0x14e));const _0x1639c2=await database_1[_0x10592e(0x13e)][_0x10592e(0x11b)]['findUnique']({'where':{'id':_0x4c4c38},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1639c2)throw new Error(_0x10592e(0x74));const _0xa175f6=new Date(),_0x303f9c=new Date(_0xa175f6[_0x10592e(0xea)](),_0xa175f6[_0x10592e(0x128)](),0x1),_0x39897f=new Date(_0xa175f6[_0x10592e(0xea)](),_0xa175f6['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3c725a=await database_1[_0x10592e(0x13e)][_0x10592e(0x8b)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x4c4c38,'createdAt':{'gte':_0x303f9c,'lte':_0x39897f},'status':'COMPLETED'}}),_0x470fc8=_0x3c725a[_0x10592e(0x11f)][_0x10592e(0xa5)]||0x0,_0x16ad5e={'availableBalance':Math[_0x10592e(0x7a)](_0x1639c2[_0x10592e(0xbf)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x1639c2['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x10592e(0x7a)](_0x1639c2[_0x10592e(0xbf)]*0x64)/0x64,'thisMonth':Math['round'](_0x470fc8*0x64)/0x64};return console[_0x10592e(0x149)](_0x10592e(0x163)+_0x1639c2['username']+_0x10592e(0xf9)),console[_0x10592e(0x149)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x16ad5e[_0x10592e(0x127)]+_0x10592e(0x142)),console[_0x10592e(0x149)](_0x10592e(0xef)+_0x16ad5e[_0x10592e(0xa8)]+_0x10592e(0x72)),console['log'](_0x10592e(0x165)+_0x16ad5e[_0x10592e(0xa1)]+_0x10592e(0x142)),console[_0x10592e(0x149)](_0x10592e(0x8e)+_0x16ad5e[_0x10592e(0x13f)]+_0x10592e(0xf4)),_0x16ad5e;}[a86_0x53df6c(0xc2)](_0x29db78){const _0x2e4577=a86_0x53df6c,_0x33368c={'test_gateway':'Test\x20Gateway','plisio':_0x2e4577(0x80),'rapyd':'Rapyd','noda':_0x2e4577(0x11c),'cointopay':_0x2e4577(0x9f),'klyme_eu':_0x2e4577(0xab),'klyme_gb':_0x2e4577(0x12e),'klyme_de':_0x2e4577(0x150)};return _0x33368c[_0x29db78]||_0x29db78;}async['getPayoutStats'](_0x56065c){const _0x47c846=a86_0x53df6c;return this[_0x47c846(0x157)](_0x56065c);}async[a86_0x53df6c(0x133)](_0x42006e,_0x35b3af){const _0xdea58b=a86_0x53df6c,{page:_0x46c211,limit:_0x325fb4,paymentId:_0x516310}=_0x35b3af,_0x3ebc40=(_0x46c211-0x1)*_0x325fb4,_0x5aa571={'shopId':_0x42006e};_0x516310&&(_0x5aa571[_0xdea58b(0x124)]=_0x516310);const [_0x26622b,_0x342c49]=await Promise[_0xdea58b(0x136)]([database_1[_0xdea58b(0x13e)]['webhookLog'][_0xdea58b(0x73)]({'where':_0x5aa571,'skip':_0x3ebc40,'take':_0x325fb4,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0xdea58b(0x13e)][_0xdea58b(0x70)][_0xdea58b(0x8f)]({'where':_0x5aa571})]);return{'logs':_0x26622b['map'](_0x18d449=>({'id':_0x18d449['id'],'paymentId':_0x18d449[_0xdea58b(0x124)],'shopId':_0x18d449[_0xdea58b(0xe4)],'event':_0x18d449['event'],'statusCode':_0x18d449[_0xdea58b(0xc4)],'retryCount':_0x18d449[_0xdea58b(0xa3)],'responseBody':_0x18d449[_0xdea58b(0x8c)],'createdAt':_0x18d449[_0xdea58b(0x138)],'payment':_0x18d449[_0xdea58b(0xdc)]})),'pagination':{'page':_0x46c211,'limit':_0x325fb4,'total':_0x342c49,'totalPages':Math[_0xdea58b(0x119)](_0x342c49/_0x325fb4)}};}async[a86_0x53df6c(0x9d)](_0x37ba7e,_0x3ee382,_0x1e875b,_0x5a9b10,_0x222e60){const _0x4657f0=a86_0x53df6c;console['log'](_0x4657f0(0x11e)+_0x37ba7e+_0x4657f0(0x153)+_0x3ee382+_0x4657f0(0xd6)+_0x1e875b+_0x4657f0(0x109)+_0x5a9b10);const _0x219c43=_0x222e60?new Date(_0x222e60):new Date();let _0x2913e3,_0x1a8958;if(_0x1e875b&&_0x5a9b10){const _0x5a24d8=new Date(_0x1e875b),_0x1be253=new Date(_0x5a9b10);_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x5a24d8[_0x4657f0(0x144)](),_0x5a24d8['getUTCMonth'](),_0x5a24d8[_0x4657f0(0xac)](),0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x1be253[_0x4657f0(0x144)](),_0x1be253[_0x4657f0(0x154)](),_0x1be253[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7)),console[_0x4657f0(0x149)](_0x4657f0(0xdf)+_0x2913e3['toISOString']()+_0x4657f0(0x121)+_0x1a8958[_0x4657f0(0x7c)]());}else{if(_0x3ee382&&_0x3ee382[_0x4657f0(0xfd)]('custom_')){const _0x2f0061=_0x3ee382[_0x4657f0(0x71)](_0x4657f0(0x148),'')['split']('_');if(_0x2f0061[_0x4657f0(0x152)]===0x2){const _0x5e201d=new Date(_0x2f0061[0x0]),_0x3e93e1=new Date(_0x2f0061[0x1]);_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x5e201d['getUTCFullYear'](),_0x5e201d[_0x4657f0(0x154)](),_0x5e201d[_0x4657f0(0xac)](),0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x3e93e1[_0x4657f0(0x144)](),_0x3e93e1[_0x4657f0(0x154)](),_0x3e93e1['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x4657f0(0x149)](_0x4657f0(0xce)+_0x2913e3[_0x4657f0(0x7c)]()+_0x4657f0(0x121)+_0x1a8958[_0x4657f0(0x7c)]());}else{const _0x402d59=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)]()-0x1e));_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x402d59['getUTCFullYear'](),_0x402d59[_0x4657f0(0x154)](),_0x402d59['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date['UTC'](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x5f3e28=_0x3ee382||_0x4657f0(0xd8);switch(_0x5f3e28[_0x4657f0(0x10e)]()){case _0x4657f0(0x84):_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)](),0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x5a413b=new Date(_0x219c43);_0x5a413b[_0x4657f0(0x166)](_0x5a413b['getUTCDate']()-0x1),_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x5a413b[_0x4657f0(0x144)](),_0x5a413b[_0x4657f0(0x154)](),_0x5a413b['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x5a413b[_0x4657f0(0x144)](),_0x5a413b['getUTCMonth'](),_0x5a413b[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4657f0(0xd2):const _0x20c065=_0x219c43[_0x4657f0(0xc9)](),_0x59387e=_0x20c065===0x0?-0x6:0x1-_0x20c065,_0x58a961=_0x219c43['getUTCDate']()+_0x59387e;_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x58a961,0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4657f0(0xf8):const _0x4789c5=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)]()-0x7)),_0x2d7fbc=_0x4789c5[_0x4657f0(0xc9)](),_0x38fd4b=_0x2d7fbc===0x0?-0x6:0x1-_0x2d7fbc,_0xfd3387=_0x4789c5['getUTCDate']()+_0x38fd4b;_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x4789c5[_0x4657f0(0x144)](),_0x4789c5['getUTCMonth'](),_0xfd3387,0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date['UTC'](_0x4789c5[_0x4657f0(0x144)](),_0x4789c5[_0x4657f0(0x154)](),_0xfd3387+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x4657f0(0xd8):_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),0x1,0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x219c43['getUTCFullYear'](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4657f0(0x15d):_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date['UTC'](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4657f0(0x83):_0x2913e3=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x219c43['getUTCFullYear'](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x2913e3=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),0x1,0x0,0x0,0x0,0x0)),_0x1a8958=new Date(Date[_0x4657f0(0x13b)](_0x219c43[_0x4657f0(0x144)](),_0x219c43[_0x4657f0(0x154)](),_0x219c43[_0x4657f0(0xac)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x4657f0(0x149)](_0x4657f0(0xb3)+_0x2913e3['toISOString']()+_0x4657f0(0x121)+_0x1a8958[_0x4657f0(0x7c)]());const _0x245504={'gte':_0x2913e3,'lte':_0x1a8958},[_0x1e7b28,_0x4e06da,_0x8ed3dd,_0x503fa3,_0x48ea2b,_0x45c089,_0x401418,_0x207a45,_0x6064b3,_0x2fec5c,_0x5c043e]=await Promise[_0x4657f0(0x136)]([database_1[_0x4657f0(0x13e)][_0x4657f0(0xdc)]['count']({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)},'status':{'notIn':[_0x4657f0(0x155),_0x4657f0(0x12f)]},'createdAt':_0x245504}}),database_1['default']['payment']['count']({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)},'status':_0x4657f0(0x12c),'createdAt':_0x245504}}),database_1['default'][_0x4657f0(0xdc)][_0x4657f0(0x8f)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)},'status':_0x4657f0(0xf3)}}),database_1[_0x4657f0(0x13e)][_0x4657f0(0xdc)][_0x4657f0(0x8f)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)},'status':_0x4657f0(0xec)}}),database_1[_0x4657f0(0x13e)][_0x4657f0(0xdc)][_0x4657f0(0x73)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)},'status':'PAID','createdAt':_0x245504},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x4657f0(0x13e)][_0x4657f0(0xdc)][_0x4657f0(0x73)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)}},'take':0x4,'orderBy':{'createdAt':_0x4657f0(0xb1)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4657f0(0x13e)]['payment'][_0x4657f0(0x73)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':'test_gateway'},'createdAt':_0x245504},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4657f0(0xca)}}),database_1[_0x4657f0(0x13e)]['payment'][_0x4657f0(0x8f)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)},'status':_0x4657f0(0x12c)}}),database_1[_0x4657f0(0x13e)][_0x4657f0(0xdc)][_0x4657f0(0x73)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)},'status':'PAID'},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4657f0(0x13e)][_0x4657f0(0x11b)]['findUnique']({'where':{'id':_0x37ba7e},'select':{'balance':!![]}}),database_1[_0x4657f0(0x13e)][_0x4657f0(0xdc)][_0x4657f0(0x73)]({'where':{'shopId':_0x37ba7e,'gateway':{'not':_0x4657f0(0x122)}},'select':{'gateway':!![]}})]),_0x3750ea={};for(const _0x256b0a of _0x5c043e){_0x256b0a[_0x4657f0(0x135)]&&(_0x3750ea[_0x256b0a[_0x4657f0(0x135)]]=(_0x3750ea[_0x256b0a['gateway']]||0x0)+0x1);}console['log'](_0x4657f0(0x99),_0x3750ea);let _0x3248eb=0x0,_0x1a1f8c=0x0;for(const _0x429631 of _0x48ea2b){if(_0x429631[_0x4657f0(0xdd)])_0x3248eb+=_0x429631[_0x4657f0(0xdd)];else{const _0x23e017=await currencyService_1['currencyService']['convertToUSDT'](_0x429631[_0x4657f0(0xa5)],_0x429631[_0x4657f0(0x164)]);_0x3248eb+=_0x23e017;}_0x429631[_0x4657f0(0x151)]&&(_0x1a1f8c+=_0x429631[_0x4657f0(0x151)]);}let _0x5761c8=0x0;for(const _0x101697 of _0x6064b3){_0x101697['amountAfterGatewayCommissionUSDT']&&(_0x5761c8+=_0x101697[_0x4657f0(0x151)]);}const _0xcc993=this[_0x4657f0(0xc6)](_0x401418,_0x2913e3,_0x1a8958||_0x219c43),_0x2d7b83=_0x1e7b28>0x0?_0x4e06da/_0x1e7b28*0x64:0x0,_0x3000a7=_0x207a45>0x0?_0x8ed3dd/_0x207a45*0x64:0x0;return{'totalPayments':_0x1e7b28,'successfulPayments':_0x4e06da,'totalRevenue':Math[_0x4657f0(0x7a)](_0x3248eb*0x64)/0x64,'merchantEarnings':Math[_0x4657f0(0x7a)](_0x1a1f8c*0x64)/0x64,'merchantTotalRevenue':Math[_0x4657f0(0x7a)](_0x5761c8*0x64)/0x64,'payoutBalance':Math['round']((_0x2fec5c?.[_0x4657f0(0xbf)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x4657f0(0x7a)](_0x2d7b83*0x64)/0x64,'chargebackRate':Math[_0x4657f0(0x7a)](_0x3000a7*0x64)/0x64,'chargebacks':_0x8ed3dd,'refunds':_0x503fa3,'paymentsByGateway':_0x3750ea,'dailyRevenue':_0xcc993[_0x4657f0(0x14a)],'dailyPayments':_0xcc993['dailyPayments'],'recentPayments':_0x45c089[_0x4657f0(0x13c)](_0x25d744=>({'id':_0x25d744['id'],'gateway':_0x25d744['gateway'],'amount':_0x25d744[_0x4657f0(0xa5)],'currency':_0x25d744[_0x4657f0(0x164)],'status':_0x25d744[_0x4657f0(0x104)],'createdAt':_0x25d744[_0x4657f0(0x138)]}))};}[a86_0x53df6c(0xc6)](_0x5882f4,_0x12a95b,_0x455c16){const _0x4a61fe=a86_0x53df6c,_0x70f4bc=new Map(),_0x3e8ae9=new Date(_0x12a95b);while(_0x3e8ae9<=_0x455c16){const _0x695e55=_0x3e8ae9[_0x4a61fe(0x7c)]()[_0x4a61fe(0xe9)]('T')[0x0];_0x70f4bc[_0x4a61fe(0xc8)](_0x695e55,{'revenue':0x0,'count':0x0}),_0x3e8ae9[_0x4a61fe(0x15c)](_0x3e8ae9[_0x4a61fe(0x146)]()+0x1);}for(const _0x346e67 of _0x5882f4){const _0x3da074=_0x346e67[_0x4a61fe(0x138)][_0x4a61fe(0x7c)]()[_0x4a61fe(0xe9)]('T')[0x0],_0x35776d=_0x70f4bc[_0x4a61fe(0x8d)](_0x3da074);_0x35776d&&(_0x35776d['count']+=0x1,_0x346e67['status']==='PAID'&&_0x346e67[_0x4a61fe(0xdd)]&&(_0x35776d[_0x4a61fe(0xda)]+=_0x346e67[_0x4a61fe(0xdd)]));}const _0x1d5373=[],_0x5cc947=[];for(const [_0xf56e63,_0x2124c9]of _0x70f4bc){_0x1d5373[_0x4a61fe(0x123)]({'date':_0xf56e63,'amount':Math['round'](_0x2124c9['revenue']*0x64)/0x64}),_0x5cc947[_0x4a61fe(0x123)]({'date':_0xf56e63,'count':_0x2124c9[_0x4a61fe(0x8f)]});}return{'dailyRevenue':_0x1d5373,'dailyPayments':_0x5cc947};}[a86_0x53df6c(0x10d)](_0x5596e5=0x8){const _0x57cf2a=a86_0x53df6c,_0x525813=[];for(let _0x249087=0x0;_0x249087<_0x5596e5;_0x249087++){const _0x2c0e5f=crypto_1[_0x57cf2a(0x13e)]['randomBytes'](0x4)[_0x57cf2a(0xf1)](_0x57cf2a(0x14b))[_0x57cf2a(0xff)]();_0x525813[_0x57cf2a(0x123)](_0x2c0e5f);}return _0x525813;}async['setup2FA'](_0x112e0e){const _0x1781a4=a86_0x53df6c,_0x171ebd=await database_1[_0x1781a4(0x13e)][_0x1781a4(0x11b)][_0x1781a4(0x87)]({'where':{'id':_0x112e0e},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x171ebd)throw new Error(_0x1781a4(0x74));const _0x3cea09=speakeasy_1[_0x1781a4(0x13e)][_0x1781a4(0x162)]({'name':_0x1781a4(0x145)+_0x171ebd['username']+')','issuer':_0x1781a4(0xaf),'length':0x20}),_0x23aa48=await qrcode_1[_0x1781a4(0x13e)][_0x1781a4(0x103)](_0x3cea09[_0x1781a4(0x9e)]),_0x100eed=this[_0x1781a4(0x10d)](0x8),_0x345b5f=await Promise[_0x1781a4(0x136)](_0x100eed[_0x1781a4(0x13c)](_0x39866e=>bcryptjs_1['default']['hash'](_0x39866e,0xa)));return await database_1['default'][_0x1781a4(0x11b)][_0x1781a4(0xdb)]({'where':{'id':_0x112e0e},'data':{'twoFactorSecret':_0x3cea09[_0x1781a4(0x139)],'backupCodes':JSON[_0x1781a4(0x9c)](_0x345b5f)}}),console['log'](_0x1781a4(0xc1)+_0x171ebd['username']),console[_0x1781a4(0x149)](_0x1781a4(0xeb)+_0x100eed[_0x1781a4(0x152)]+_0x1781a4(0xba)),{'secret':_0x3cea09[_0x1781a4(0x139)],'qrCode':_0x23aa48,'manualEntryKey':_0x3cea09[_0x1781a4(0x139)],'backupCodes':_0x100eed};}async[a86_0x53df6c(0xe5)](_0x11cccb,_0x107ec5){const _0x110667=a86_0x53df6c,_0x592a5b=await database_1[_0x110667(0x13e)][_0x110667(0x11b)]['findUnique']({'where':{'id':_0x11cccb},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x592a5b)throw new Error('Shop\x20not\x20found');if(!_0x592a5b[_0x110667(0x11a)])throw new Error(_0x110667(0xb4));if(_0x592a5b['twoFactorEnabled'])throw new Error(_0x110667(0x10c));const _0x5c53c1=speakeasy_1[_0x110667(0x13e)]['totp']['verify']({'secret':_0x592a5b[_0x110667(0x11a)],'encoding':_0x110667(0x139),'token':_0x107ec5,'window':0x2});if(!_0x5c53c1)throw new Error(_0x110667(0xe8));return await database_1[_0x110667(0x13e)][_0x110667(0x11b)][_0x110667(0xdb)]({'where':{'id':_0x11cccb},'data':{'twoFactorEnabled':!![]}}),console[_0x110667(0x149)](_0x110667(0x8a)+_0x592a5b[_0x110667(0x161)]),{'enabled':!![]};}async[a86_0x53df6c(0x77)](_0x32a0fb){const _0x574f21=a86_0x53df6c,_0x1b321b=await database_1['default'][_0x574f21(0x11b)]['findUnique']({'where':{'id':_0x32a0fb},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x1b321b)throw new Error(_0x574f21(0x74));await database_1[_0x574f21(0x13e)]['shop'][_0x574f21(0xdb)]({'where':{'id':_0x32a0fb},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log'](_0x574f21(0x12b)+_0x1b321b[_0x574f21(0x161)]);}}function a86_0x55af(){const _0x5df7e8=['revenue','update','payment','amountUSDT','usdcPolygonWallet','üìÖ\x20Custom\x20date\x20range:\x20','AVAILABLE_GATEWAYS','notes','getPayoutStatistics','15402312WTSZFX','shopId','enable2FA','Test\x20webhook\x20sent\x20successfully\x20(','merchantUrl','Invalid\x202FA\x20token','split','getFullYear','üîë\x20Generated\x20','REFUND','ShopService','webhookEvents','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','17092390WVlJbU','toString','test_payment_123','CHARGEBACK','\x20USDT','PaymentService','isActive','amountIsEditable','last_week','\x20payout\x20statistics\x20calculated:','sourceCurrency','lte','telegram','startsWith','wallets','toUpperCase','üìä\x20Final\x20WHERE\x20conditions:','network','updatePayment','toDataURL','status','isArray','No\x20webhook\x20URL\x20configured','parse','application/json',',\x20dateTo:\x20','message','getPaymentById','2FA\x20is\x20already\x20enabled','generateBackupCodes','toLowerCase','settings','customerEmail','__esModule','name','customerName','filter','sha256','getTime','1202928MykpoI','error','ceil','twoFactorSecret','shop','Noda','USDT\x20ERC20','üìä\x20Getting\x20statistics\x20for\x20shop\x20','_sum','33DSlcRm','\x20to\x20','test_gateway','push','paymentId','__importDefault','updateWallets','availableBalance','getMonth','4083189KviigR','USDC\x20Ethereum','üîê\x202FA\x20disabled\x20for\x20shop:\x20','PAID','polygon','KLYME\x20GB','EXPIRED','üìÖ\x20Period\x20start:\x20','üìÖ\x20Period\x20end:\x20','usdtPolygonWallet','getWebhookLogs','./paymentService','gateway','all','POST','createdAt','base32','usdtTrcWallet','UTC','map','95124HDmzmw','default','thisMonth','crypto','publicKey','\x20USDT\x20(current\x20balance)','telegramId','getUTCFullYear','TrapaPay\x20(','getDate','compare','custom_','log','dailyRevenue','hex','üìÖ\x20Date\x20end:\x20','paymentService','...','Error\x20parsing\x20webhook\x20events:','KLYME\x20DE','amountAfterGatewayCommissionUSDT','length',',\x20period:\x20','getUTCMonth','PENDING','./currencyService','getShopPayoutStats','reduce','digest','secretKey','21ALyfnB','setDate','last_month','setHours','getPayouts','70HzpAZL','username','generateSecret','üìä\x20Shop\x20','currency','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','setUTCDate','webhookLog','replace','\x20USDT\x20(total\x20payouts)','findMany','Shop\x20not\x20found','createPayment','gatewaySettings','disable2FA','Invalid\x202FA\x20token\x20or\x20backup\x20code','paymentGateways','round','polygon_usdc','toISOString','Unknown\x20error','customer','test','Plisio','Webhook\x20returned\x20error:\x20','üìä\x20Status\x20filter:\x20','all_time','today','findFirst','updateShopProfile','findUnique','usdtErcWallet','USDC\x20Polygon','üîê\x202FA\x20enabled\x20for\x20shop:\x20','payout','responseBody','get','\x20\x20\x20üìÖ\x20This\x20month:\x20','count','üí∞\x20Getting\x20payouts\x20with\x20filters:','totp','4ByarPX','34176ekCccN','statusText','90d','webhookUrl','USDT\x20Polygon','Failed\x20to\x20send\x20webhook:\x20','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','deletePayment','trc20','stringify','getStatistics','otpauth_url','CoinToPay','../config/database','awaitingPayout','370kZILDC','retryCount','getShopProfile','amount','gte','yesterday','totalPaidOut','usage','redirectUrl','KLYME\x20EU','getUTCDate','üåê\x20Method\x20filter:\x20','txid','TrapaPay','speakeasy','desc','formatNetworkName','üìÖ\x20Final\x20date\x20range:\x20','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','getPayoutById','paid','30d','üåê\x20Network\x20filter:\x20','USD','\x20backup\x20codes','fullName','gateways','usdcErcWallet','erc20_usdc','balance','23509320KjaUMY','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','getGatewayDisplayName','Payment\x20not\x20found','statusCode','üìÖ\x20Date\x20start:\x20','generateDailyStatistics','paidAt','set','getUTCDay','asc','getPayments','periodFrom','createHmac','üìÖ\x20Custom\x20period:\x20','COMPLETED','shopUrl','periodTo','this_week','getPaymentByShopAndId','twoFactorToken','test_order_123',',\x20dateFrom:\x20','country','this_month','REJECTED'];a86_0x55af=function(){return _0x5df7e8;};return a86_0x55af();}exports[a86_0x53df6c(0xed)]=ShopService;