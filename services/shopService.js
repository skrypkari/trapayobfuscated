'use strict';const a52_0x187f01=a52_0x41f7;(function(_0x47c910,_0x2c59fc){const _0x492baa=a52_0x41f7,_0x1ccfd1=_0x47c910();while(!![]){try{const _0x4a67bc=-parseInt(_0x492baa(0x123))/0x1*(-parseInt(_0x492baa(0x14c))/0x2)+-parseInt(_0x492baa(0xf5))/0x3*(parseInt(_0x492baa(0xd8))/0x4)+parseInt(_0x492baa(0x118))/0x5*(-parseInt(_0x492baa(0x107))/0x6)+parseInt(_0x492baa(0x131))/0x7+parseInt(_0x492baa(0x162))/0x8+-parseInt(_0x492baa(0x11c))/0x9*(parseInt(_0x492baa(0x15c))/0xa)+parseInt(_0x492baa(0x142))/0xb*(-parseInt(_0x492baa(0xf7))/0xc);if(_0x4a67bc===_0x2c59fc)break;else _0x1ccfd1['push'](_0x1ccfd1['shift']());}catch(_0x53b5c2){_0x1ccfd1['push'](_0x1ccfd1['shift']());}}}(a52_0x22eb,0x6c5a2));function a52_0x41f7(_0x4037e5,_0x1c4157){const _0x22eb58=a52_0x22eb();return a52_0x41f7=function(_0x41f738,_0x32ec65){_0x41f738=_0x41f738-0xcd;let _0x7fd33f=_0x22eb58[_0x41f738];return _0x7fd33f;},a52_0x41f7(_0x4037e5,_0x1c4157);}var __importDefault=this&&this[a52_0x187f01(0x13c)]||function(_0x4ea1e9){const _0x25ccc3=a52_0x187f01;return _0x4ea1e9&&_0x4ea1e9[_0x25ccc3(0xfe)]?_0x4ea1e9:{'default':_0x4ea1e9};};function a52_0x22eb(){const _0x150704=['getPayouts','5649609xNXTro','findUnique','dailyRevenue','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','createPayment','amountUSDT','lte','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','test_payment_123','currency','TesSoft\x20Payment\x20System/1.0\x20(Test)','__importDefault','getMonth','expiresAt','maxPayments','totalPaidOut','name','18359UcQlhb','isArray','No\x20webhook\x20URL\x20configured','Shop\x20not\x20found','Payment\x20not\x20found','status','getPayoutStats','round','usdcPolygonWallet','KLYME\x20GB','546538dmhryn','log','country','Plisio','_sum','paymentGateways','push','getDate','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','PENDING','redirectUrl','\x20payout\x20statistics\x20calculated:','Test\x20Gateway','reduce','defineProperty','gateway','200acRmwv','delete','gatewaySettings','shop','KLYME\x20DE','30d','2410016NojDeS','aggregate','Webhook\x20returned\x20error:\x20','usage','\x20\x20\x20üíµ\x20Available\x20balance:\x20','./paymentService','language','KLYME\x20EU','merchantUrl','wallets','currencyService','POST','getWebhookLogs','get','paidAt','...','getFullYear','amount','REJECTED','usdtPolygonWallet','500OfQZdq','usdtTrcWallet','./currencyService','testWebhook','test_order_123','USD','toISOString','Rapyd','Test\x20webhook\x20sent\x20successfully\x20(','statusText','telegramId','PAID','telegram','getPayoutById','error','map','getTime','webhookEvents','all','getGatewayDisplayName','generateDailyStatistics','getPaymentByShopAndId','gateways','webhookUrl','revenue','payment','customerName','parse','default','20478OXPNiE','publicKey','2172AaBLLx','update','usdtErcWallet','stringify','convertToUSDT','ShopService','updatePayment','__esModule','getStatistics','updateShopProfile','payout','application/json','findMany','shopUrl','asc','PaymentService','33924GyeJRy','test_gateway','availableBalance','count','\x20USDT','gte','90d','notes','txid','statusCode','paymentService','paymentId','getShopPayoutStats','\x20USDT\x20(current\x20balance)','thisMonth','Unknown\x20error','createdAt','10qvNKya','Error\x20parsing\x20webhook\x20events:','username','network','19989VXlSiu','findFirst','getPayments','fullName','ceil','webhookLog','test','2piFhjR','getShopProfile','awaitingPayout','üìä\x20Shop\x20','responseBody','updateWallets','filter','dailyPayments','balance','event','settings','desc','COMPLETED'];a52_0x22eb=function(){return _0x150704;};return a52_0x22eb();}Object[a52_0x187f01(0x15a)](exports,a52_0x187f01(0xfe),{'value':!![]}),exports[a52_0x187f01(0xfc)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a52_0x187f01(0xda)),paymentService_1=require(a52_0x187f01(0x167));class ShopService{constructor(){const _0xb432a2=a52_0x187f01;this['paymentService']=new paymentService_1[(_0xb432a2(0x106))]();}async[a52_0x187f01(0x124)](_0x33bb05){const _0x5934e1=a52_0x187f01,_0x3e3efb=await database_1['default']['shop']['findUnique']({'where':{'id':_0x33bb05},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x3e3efb)throw new Error('Shop\x20not\x20found');let _0x5a6431=[];if(_0x3e3efb[_0x5934e1(0x12d)]?.['webhookEvents'])try{_0x5a6431=Array['isArray'](_0x3e3efb[_0x5934e1(0x12d)]['webhookEvents'])?_0x3e3efb[_0x5934e1(0x12d)][_0x5934e1(0xe9)]:JSON[_0x5934e1(0xf3)](_0x3e3efb[_0x5934e1(0x12d)][_0x5934e1(0xe9)]);}catch(_0x136968){console[_0x5934e1(0xe6)](_0x5934e1(0x119),_0x136968),_0x5a6431=[];}return{'id':_0x3e3efb['id'],'fullName':_0x3e3efb[_0x5934e1(0x141)],'username':_0x3e3efb[_0x5934e1(0x11a)],'telegramId':_0x3e3efb[_0x5934e1(0xe4)],'merchantUrl':_0x3e3efb[_0x5934e1(0x104)],'gateways':_0x3e3efb[_0x5934e1(0x151)]?JSON['parse'](_0x3e3efb[_0x5934e1(0x151)]):null,'gatewaySettings':_0x3e3efb[_0x5934e1(0x15e)]?JSON[_0x5934e1(0xf3)](_0x3e3efb[_0x5934e1(0x15e)]):null,'publicKey':_0x3e3efb[_0x5934e1(0xf6)],'webhookUrl':_0x3e3efb[_0x5934e1(0x12d)]?.[_0x5934e1(0xef)]||null,'webhookEvents':_0x5a6431,'wallets':{'usdtPolygonWallet':_0x3e3efb['usdtPolygonWallet'],'usdtTrcWallet':_0x3e3efb[_0x5934e1(0xd9)],'usdtErcWallet':_0x3e3efb[_0x5934e1(0xf9)],'usdcPolygonWallet':_0x3e3efb[_0x5934e1(0x14a)]},'status':_0x3e3efb['status'],'createdAt':_0x3e3efb['createdAt']};}async[a52_0x187f01(0x100)](_0x435001,_0x38ce9a){const _0xd482bb=a52_0x187f01,_0x5e94f4={};_0x38ce9a[_0xd482bb(0x11f)]&&(_0x5e94f4[_0xd482bb(0x141)]=_0x38ce9a[_0xd482bb(0x11f)]);_0x38ce9a[_0xd482bb(0xe2)]!==undefined&&(_0x5e94f4['telegram']=_0x38ce9a[_0xd482bb(0xe2)]||null);_0x38ce9a[_0xd482bb(0x16a)]&&(_0x5e94f4[_0xd482bb(0x104)]=_0x38ce9a[_0xd482bb(0x16a)]);_0x38ce9a[_0xd482bb(0xee)]&&(_0x5e94f4[_0xd482bb(0x151)]=JSON[_0xd482bb(0xfa)](_0x38ce9a[_0xd482bb(0xee)]));_0x38ce9a[_0xd482bb(0x15e)]&&(_0x5e94f4['gatewaySettings']=JSON[_0xd482bb(0xfa)](_0x38ce9a[_0xd482bb(0x15e)]));_0x38ce9a[_0xd482bb(0xcd)]&&(_0x38ce9a[_0xd482bb(0xcd)][_0xd482bb(0xd7)]!==undefined&&(_0x5e94f4[_0xd482bb(0xd7)]=_0x38ce9a[_0xd482bb(0xcd)][_0xd482bb(0xd7)]||null),_0x38ce9a[_0xd482bb(0xcd)][_0xd482bb(0xd9)]!==undefined&&(_0x5e94f4[_0xd482bb(0xd9)]=_0x38ce9a[_0xd482bb(0xcd)]['usdtTrcWallet']||null),_0x38ce9a[_0xd482bb(0xcd)]['usdtErcWallet']!==undefined&&(_0x5e94f4[_0xd482bb(0xf9)]=_0x38ce9a[_0xd482bb(0xcd)][_0xd482bb(0xf9)]||null),_0x38ce9a[_0xd482bb(0xcd)]['usdcPolygonWallet']!==undefined&&(_0x5e94f4[_0xd482bb(0x14a)]=_0x38ce9a['wallets']['usdcPolygonWallet']||null));const _0x55d6c7=await database_1[_0xd482bb(0xf4)]['shop'][_0xd482bb(0xf8)]({'where':{'id':_0x435001},'data':_0x5e94f4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2a0687=[];if(_0x55d6c7[_0xd482bb(0x12d)]?.[_0xd482bb(0xe9)])try{_0x2a0687=Array[_0xd482bb(0x143)](_0x55d6c7['settings'][_0xd482bb(0xe9)])?_0x55d6c7[_0xd482bb(0x12d)][_0xd482bb(0xe9)]:JSON[_0xd482bb(0xf3)](_0x55d6c7['settings']['webhookEvents']);}catch(_0x5967b3){console[_0xd482bb(0xe6)](_0xd482bb(0x119),_0x5967b3),_0x2a0687=[];}return{'id':_0x55d6c7['id'],'fullName':_0x55d6c7[_0xd482bb(0x141)],'username':_0x55d6c7['username'],'telegramId':_0x55d6c7['telegram'],'merchantUrl':_0x55d6c7[_0xd482bb(0x104)],'gateways':_0x55d6c7['paymentGateways']?JSON[_0xd482bb(0xf3)](_0x55d6c7[_0xd482bb(0x151)]):null,'gatewaySettings':_0x55d6c7['gatewaySettings']?JSON['parse'](_0x55d6c7[_0xd482bb(0x15e)]):null,'publicKey':_0x55d6c7[_0xd482bb(0xf6)],'webhookUrl':_0x55d6c7[_0xd482bb(0x12d)]?.[_0xd482bb(0xef)]||null,'webhookEvents':_0x2a0687,'wallets':{'usdtPolygonWallet':_0x55d6c7[_0xd482bb(0xd7)],'usdtTrcWallet':_0x55d6c7[_0xd482bb(0xd9)],'usdtErcWallet':_0x55d6c7['usdtErcWallet'],'usdcPolygonWallet':_0x55d6c7[_0xd482bb(0x14a)]},'status':_0x55d6c7['status'],'createdAt':_0x55d6c7[_0xd482bb(0x117)]};}async[a52_0x187f01(0x128)](_0x4f5059,_0x3509de){const _0x1a0ed1=a52_0x187f01,_0x1f871e={};_0x3509de[_0x1a0ed1(0xd7)]!==undefined&&(_0x1f871e['usdtPolygonWallet']=_0x3509de[_0x1a0ed1(0xd7)]||null),_0x3509de[_0x1a0ed1(0xd9)]!==undefined&&(_0x1f871e[_0x1a0ed1(0xd9)]=_0x3509de['usdtTrcWallet']||null),_0x3509de['usdtErcWallet']!==undefined&&(_0x1f871e['usdtErcWallet']=_0x3509de[_0x1a0ed1(0xf9)]||null),_0x3509de[_0x1a0ed1(0x14a)]!==undefined&&(_0x1f871e[_0x1a0ed1(0x14a)]=_0x3509de[_0x1a0ed1(0x14a)]||null),await database_1[_0x1a0ed1(0xf4)][_0x1a0ed1(0x15f)]['update']({'where':{'id':_0x4f5059},'data':_0x1f871e});}async[a52_0x187f01(0xdb)](_0x4cb012){const _0x2ae26e=a52_0x187f01,_0x15c82c=await database_1[_0x2ae26e(0xf4)][_0x2ae26e(0x15f)]['findUnique']({'where':{'id':_0x4cb012},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x15c82c?.[_0x2ae26e(0x12d)]?.[_0x2ae26e(0xef)])throw new Error(_0x2ae26e(0x144));const _0x411fbe={'event':_0x2ae26e(0x122),'payment':{'id':_0x2ae26e(0x139),'order_id':_0x2ae26e(0xdc),'gateway':_0x2ae26e(0x122),'amount':0x64,'currency':_0x2ae26e(0xdd),'status':'paid','created_at':new Date()[_0x2ae26e(0xde)]()}};try{const _0x199282=await fetch(_0x15c82c[_0x2ae26e(0x12d)][_0x2ae26e(0xef)],{'method':_0x2ae26e(0xcf),'headers':{'Content-Type':_0x2ae26e(0x102),'User-Agent':_0x2ae26e(0x13b)},'body':JSON['stringify'](_0x411fbe)});return _0x199282['ok']?{'success':!![],'message':_0x2ae26e(0xe0)+_0x199282[_0x2ae26e(0x147)]+')'}:{'success':![],'message':_0x2ae26e(0x164)+_0x199282[_0x2ae26e(0x147)]+'\x20'+_0x199282[_0x2ae26e(0xe1)]};}catch(_0x4126c2){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x4126c2 instanceof Error?_0x4126c2['message']:_0x2ae26e(0x116))};}}async[a52_0x187f01(0x135)](_0x1ee438){const _0x4e5e2c=a52_0x187f01;return this[_0x4e5e2c(0x111)]['createPublicPayment']({'public_key':'','gateway':_0x1ee438['gateway'],'order_id':undefined,'amount':_0x1ee438[_0x4e5e2c(0xd5)],'currency':_0x1ee438[_0x4e5e2c(0x13a)],'source_currency':_0x1ee438['sourceCurrency'],'usage':_0x1ee438[_0x4e5e2c(0x165)],'expires_at':_0x1ee438[_0x4e5e2c(0x13e)]?.['toISOString'](),'success_url':_0x1ee438[_0x4e5e2c(0x156)],'fail_url':_0x1ee438[_0x4e5e2c(0x156)],'customer_email':_0x1ee438['customerEmail'],'customer_name':_0x1ee438[_0x4e5e2c(0xf2)],'country':_0x1ee438[_0x4e5e2c(0x14e)],'language':_0x1ee438[_0x4e5e2c(0x168)],'amount_is_editable':_0x1ee438['amountIsEditable'],'max_payments':_0x1ee438[_0x4e5e2c(0x13f)],'customer':_0x1ee438['customer']});}async[a52_0x187f01(0x11e)](_0x29f189,_0x4bba37){return this['paymentService']['getPaymentsByShop'](_0x29f189,_0x4bba37);}async['getPaymentById'](_0x80d8b8,_0x215e8e){const _0x588017=a52_0x187f01;return this[_0x588017(0x111)][_0x588017(0xed)](_0x80d8b8,_0x215e8e);}async[a52_0x187f01(0xfd)](_0x241411,_0x1e375b,_0x524c9d){const _0x49852e=a52_0x187f01,_0x4f8a43=await database_1[_0x49852e(0xf4)]['payment']['findFirst']({'where':{'id':_0x1e375b,'shopId':_0x241411}});if(!_0x4f8a43)throw new Error(_0x49852e(0x146));const _0x5100fa=await database_1[_0x49852e(0xf4)][_0x49852e(0xf1)][_0x49852e(0xf8)]({'where':{'id':_0x1e375b},'data':{..._0x524c9d,'updatedAt':new Date()}});return _0x5100fa;}async['deletePayment'](_0x48e05a,_0x2a6df8){const _0x44553a=a52_0x187f01,_0x1be4b0=await database_1[_0x44553a(0xf4)]['payment'][_0x44553a(0x11d)]({'where':{'id':_0x2a6df8,'shopId':_0x48e05a}});if(!_0x1be4b0)throw new Error('Payment\x20not\x20found');await database_1['default'][_0x44553a(0xf1)][_0x44553a(0x15d)]({'where':{'id':_0x2a6df8}});}async[a52_0x187f01(0x130)](_0x388490,_0x4d8d76){const _0x5df9b4=a52_0x187f01,{page:_0x414568,limit:_0x543a7f,status:_0x3b4052,method:_0x2bd981,dateFrom:_0x30c209,dateTo:_0x11f996,periodFrom:_0x104ba2,periodTo:_0x141440}=_0x4d8d76,_0x2c2b83=(_0x414568-0x1)*_0x543a7f,_0x397d46={'shopId':_0x388490};_0x3b4052&&(_0x397d46[_0x5df9b4(0x147)]=_0x3b4052['toUpperCase']());_0x2bd981&&(_0x397d46[_0x5df9b4(0x11b)]=_0x2bd981);if(_0x30c209||_0x11f996||_0x104ba2||_0x141440){_0x397d46[_0x5df9b4(0x117)]={};if(_0x104ba2)_0x397d46[_0x5df9b4(0x117)][_0x5df9b4(0x10c)]=new Date(_0x104ba2);else _0x30c209&&(_0x397d46['createdAt']['gte']=new Date(_0x30c209));if(_0x141440)_0x397d46[_0x5df9b4(0x117)][_0x5df9b4(0x137)]=new Date(_0x141440);else _0x11f996&&(_0x397d46['createdAt'][_0x5df9b4(0x137)]=new Date(_0x11f996));}const [_0x155f89,_0x425ac6]=await Promise[_0x5df9b4(0xea)]([database_1[_0x5df9b4(0xf4)][_0x5df9b4(0x101)][_0x5df9b4(0x103)]({'where':_0x397d46,'skip':_0x2c2b83,'take':_0x543a7f,'orderBy':{'createdAt':'desc'}}),database_1[_0x5df9b4(0xf4)]['payout']['count']({'where':_0x397d46})]);return{'payouts':_0x155f89[_0x5df9b4(0xe7)](_0x2e1bda=>({'id':_0x2e1bda['id'],'amount':_0x2e1bda[_0x5df9b4(0xd5)],'network':_0x2e1bda[_0x5df9b4(0x11b)],'status':_0x2e1bda[_0x5df9b4(0x147)],'txid':_0x2e1bda['txid'],'notes':_0x2e1bda[_0x5df9b4(0x10e)],'createdAt':_0x2e1bda[_0x5df9b4(0x117)],'paidAt':_0x2e1bda['paidAt']})),'pagination':{'page':_0x414568,'limit':_0x543a7f,'total':_0x425ac6,'totalPages':Math['ceil'](_0x425ac6/_0x543a7f)}};}async[a52_0x187f01(0xe5)](_0x9a3824,_0x3dc598){const _0x21d97b=a52_0x187f01,_0x47f123=await database_1['default'][_0x21d97b(0x101)][_0x21d97b(0x11d)]({'where':{'id':_0x3dc598,'shopId':_0x9a3824}});if(!_0x47f123)return null;return{'id':_0x47f123['id'],'amount':_0x47f123['amount'],'network':_0x47f123[_0x21d97b(0x11b)],'status':_0x47f123['status'],'txid':_0x47f123[_0x21d97b(0x10f)],'notes':_0x47f123[_0x21d97b(0x10e)],'createdAt':_0x47f123[_0x21d97b(0x117)],'paidAt':_0x47f123[_0x21d97b(0xd2)]};}async['getPayoutStatistics'](_0x440901,_0xf5d182){const _0x31f1fc=a52_0x187f01,_0x1347b2=new Date();let _0x2f8ba4;switch(_0xf5d182){case'7d':_0x2f8ba4=new Date(_0x1347b2[_0x31f1fc(0xe8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x31f1fc(0x161):_0x2f8ba4=new Date(_0x1347b2[_0x31f1fc(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x31f1fc(0x10d):_0x2f8ba4=new Date(_0x1347b2['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2f8ba4=new Date(_0x1347b2[_0x31f1fc(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x53fcea,_0x575f4a,_0x178351,_0x161cd1,_0x227014,_0xe92a3a]=await Promise[_0x31f1fc(0xea)]([database_1[_0x31f1fc(0xf4)]['payout']['count']({'where':{'shopId':_0x440901,'createdAt':{'gte':_0x2f8ba4}}}),database_1[_0x31f1fc(0xf4)][_0x31f1fc(0x101)][_0x31f1fc(0x10a)]({'where':{'shopId':_0x440901,'status':_0x31f1fc(0x12f),'createdAt':{'gte':_0x2f8ba4}}}),database_1[_0x31f1fc(0xf4)][_0x31f1fc(0x101)][_0x31f1fc(0x10a)]({'where':{'shopId':_0x440901,'status':_0x31f1fc(0x155),'createdAt':{'gte':_0x2f8ba4}}}),database_1[_0x31f1fc(0xf4)]['payout'][_0x31f1fc(0x10a)]({'where':{'shopId':_0x440901,'status':_0x31f1fc(0xd6),'createdAt':{'gte':_0x2f8ba4}}}),database_1[_0x31f1fc(0xf4)]['payout'][_0x31f1fc(0x103)]({'where':{'shopId':_0x440901,'createdAt':{'gte':_0x2f8ba4}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x31f1fc(0xf4)]['payout'][_0x31f1fc(0x103)]({'where':{'shopId':_0x440901},'take':0xa,'orderBy':{'createdAt':_0x31f1fc(0x12e)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x22f970=_0x227014[_0x31f1fc(0x159)]((_0x1e825c,_0x192e36)=>_0x1e825c+_0x192e36[_0x31f1fc(0xd5)],0x0),_0x43f0b6=_0x227014[_0x31f1fc(0x129)](_0x3ab8cc=>_0x3ab8cc[_0x31f1fc(0x147)]===_0x31f1fc(0x12f))[_0x31f1fc(0x159)]((_0x5ebd30,_0x4d30b3)=>_0x5ebd30+_0x4d30b3[_0x31f1fc(0xd5)],0x0),_0x3cf869=_0x227014[_0x31f1fc(0x129)](_0x21fbb0=>_0x21fbb0[_0x31f1fc(0x147)]==='PENDING')['reduce']((_0x1475f7,_0x59ae22)=>_0x1475f7+_0x59ae22['amount'],0x0),_0x1edc46=_0x227014[_0x31f1fc(0x159)]((_0x2ad39c,_0x240889)=>{const _0x4ab80b=_0x31f1fc;return _0x2ad39c[_0x240889[_0x4ab80b(0x11b)]]=(_0x2ad39c[_0x240889[_0x4ab80b(0x11b)]]||0x0)+0x1,_0x2ad39c;},{}),_0x2f7a4e=_0x227014['reduce']((_0x165549,_0x542b64)=>{const _0x7d180d=_0x31f1fc;return _0x165549[_0x542b64[_0x7d180d(0x147)]]=(_0x165549[_0x542b64[_0x7d180d(0x147)]]||0x0)+0x1,_0x165549;},{});return{'totalPayouts':_0x53fcea,'completedPayouts':_0x575f4a,'pendingPayouts':_0x178351,'rejectedPayouts':_0x161cd1,'totalAmount':_0x22f970,'completedAmount':_0x43f0b6,'pendingAmount':_0x3cf869,'payoutsByMethod':_0x1edc46,'payoutsByStatus':_0x2f7a4e,'recentPayouts':_0xe92a3a[_0x31f1fc(0xe7)](_0x4fce07=>({'id':_0x4fce07['id'],'shopId':_0x440901,'amount':_0x4fce07[_0x31f1fc(0xd5)],'method':_0x4fce07[_0x31f1fc(0x11b)],'status':_0x4fce07[_0x31f1fc(0x147)],'txid':_0x4fce07['txid'],'createdAt':_0x4fce07[_0x31f1fc(0x117)],'paidAt':_0x4fce07[_0x31f1fc(0xd2)]}))};}async[a52_0x187f01(0x113)](_0x572079){const _0x5041bb=a52_0x187f01;console[_0x5041bb(0x14d)](_0x5041bb(0x154)+_0x572079+_0x5041bb(0xd3));const _0x1a2553=await database_1[_0x5041bb(0xf4)][_0x5041bb(0x15f)][_0x5041bb(0x132)]({'where':{'id':_0x572079},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1a2553)throw new Error(_0x5041bb(0x145));const _0x55e2b1=new Date(),_0x3d1e54=new Date(_0x55e2b1[_0x5041bb(0xd4)](),_0x55e2b1[_0x5041bb(0x13d)](),0x1),_0x4b3ce8=new Date(_0x55e2b1[_0x5041bb(0xd4)](),_0x55e2b1[_0x5041bb(0x13d)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x34e091=await database_1[_0x5041bb(0xf4)]['payout'][_0x5041bb(0x163)]({'_sum':{'amount':!![]},'where':{'shopId':_0x572079,'createdAt':{'gte':_0x3d1e54,'lte':_0x4b3ce8},'status':_0x5041bb(0x12f)}}),_0x3a49ef=_0x34e091[_0x5041bb(0x150)][_0x5041bb(0xd5)]||0x0,_0x4f63a3={'availableBalance':Math['round'](_0x1a2553[_0x5041bb(0x12b)]*0x64)/0x64,'totalPaidOut':Math[_0x5041bb(0x149)](_0x1a2553[_0x5041bb(0x140)]*0x64)/0x64,'awaitingPayout':Math[_0x5041bb(0x149)](_0x1a2553[_0x5041bb(0x12b)]*0x64)/0x64,'thisMonth':Math[_0x5041bb(0x149)](_0x3a49ef*0x64)/0x64};return console[_0x5041bb(0x14d)](_0x5041bb(0x126)+_0x1a2553['username']+_0x5041bb(0x157)),console['log'](_0x5041bb(0x166)+_0x4f63a3[_0x5041bb(0x109)]+'\x20USDT\x20(current\x20balance)'),console[_0x5041bb(0x14d)](_0x5041bb(0x138)+_0x4f63a3[_0x5041bb(0x140)]+'\x20USDT\x20(total\x20payouts)'),console[_0x5041bb(0x14d)](_0x5041bb(0x134)+_0x4f63a3[_0x5041bb(0x125)]+_0x5041bb(0x114)),console[_0x5041bb(0x14d)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x4f63a3[_0x5041bb(0x115)]+_0x5041bb(0x10b)),_0x4f63a3;}[a52_0x187f01(0xeb)](_0x1c0993){const _0x35a4f5=a52_0x187f01,_0x330231={'test_gateway':_0x35a4f5(0x158),'plisio':_0x35a4f5(0x14f),'rapyd':_0x35a4f5(0xdf),'noda':'Noda','cointopay':'CoinToPay','klyme_eu':_0x35a4f5(0x169),'klyme_gb':_0x35a4f5(0x14b),'klyme_de':_0x35a4f5(0x160)};return _0x330231[_0x1c0993]||_0x1c0993;}async[a52_0x187f01(0x148)](_0x2f9d4c){const _0x44a516=a52_0x187f01;return this[_0x44a516(0x113)](_0x2f9d4c);}async[a52_0x187f01(0xd0)](_0x4eb138,_0x1b6e52){const _0x394d3d=a52_0x187f01,{page:_0x416e87,limit:_0x1f0916,paymentId:_0x1daef5}=_0x1b6e52,_0x1fa268=(_0x416e87-0x1)*_0x1f0916,_0x4f91bb={'shopId':_0x4eb138};_0x1daef5&&(_0x4f91bb[_0x394d3d(0x112)]=_0x1daef5);const [_0x51b770,_0x1dbec2]=await Promise[_0x394d3d(0xea)]([database_1[_0x394d3d(0xf4)][_0x394d3d(0x121)][_0x394d3d(0x103)]({'where':_0x4f91bb,'skip':_0x1fa268,'take':_0x1f0916,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x394d3d(0x121)][_0x394d3d(0x10a)]({'where':_0x4f91bb})]);return{'logs':_0x51b770[_0x394d3d(0xe7)](_0x495ead=>({'id':_0x495ead['id'],'paymentId':_0x495ead[_0x394d3d(0x112)],'shopId':_0x495ead['shopId'],'event':_0x495ead[_0x394d3d(0x12c)],'statusCode':_0x495ead[_0x394d3d(0x110)],'retryCount':_0x495ead['retryCount'],'responseBody':_0x495ead[_0x394d3d(0x127)],'createdAt':_0x495ead['createdAt'],'payment':_0x495ead[_0x394d3d(0xf1)]})),'pagination':{'page':_0x416e87,'limit':_0x1f0916,'total':_0x1dbec2,'totalPages':Math[_0x394d3d(0x120)](_0x1dbec2/_0x1f0916)}};}async[a52_0x187f01(0xff)](_0x5a6b59,_0x4ea780){const _0x3b10e5=a52_0x187f01,_0x3678e1=new Date();let _0x1ceafe;switch(_0x4ea780){case'7d':_0x1ceafe=new Date(_0x3678e1[_0x3b10e5(0xe8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x1ceafe=new Date(_0x3678e1[_0x3b10e5(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x1ceafe=new Date(_0x3678e1['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1ceafe=new Date(_0x3678e1[_0x3b10e5(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3aa8c1,_0x17474e,_0xf43772,_0x2194d3,_0x98dc3]=await Promise[_0x3b10e5(0xea)]([database_1['default'][_0x3b10e5(0xf1)][_0x3b10e5(0x10a)]({'where':{'shopId':_0x5a6b59,'gateway':{'not':_0x3b10e5(0x108)},'createdAt':{'gte':_0x1ceafe}}}),database_1[_0x3b10e5(0xf4)][_0x3b10e5(0xf1)]['count']({'where':{'shopId':_0x5a6b59,'gateway':{'not':_0x3b10e5(0x108)},'status':_0x3b10e5(0xe3),'createdAt':{'gte':_0x1ceafe}}}),database_1[_0x3b10e5(0xf4)][_0x3b10e5(0xf1)][_0x3b10e5(0x103)]({'where':{'shopId':_0x5a6b59,'gateway':{'not':_0x3b10e5(0x108)},'status':'PAID','createdAt':{'gte':_0x1ceafe}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3b10e5(0xf4)][_0x3b10e5(0xf1)][_0x3b10e5(0x103)]({'where':{'shopId':_0x5a6b59,'gateway':{'not':_0x3b10e5(0x108)}},'take':0xa,'orderBy':{'createdAt':_0x3b10e5(0x12e)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3b10e5(0xf4)]['payment'][_0x3b10e5(0x103)]({'where':{'shopId':_0x5a6b59,'gateway':{'not':_0x3b10e5(0x108)},'createdAt':{'gte':_0x1ceafe}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3b10e5(0x105)}})]);let _0x51274a=0x0;for(const _0x8ba5d7 of _0xf43772){if(_0x8ba5d7['amountUSDT'])_0x51274a+=_0x8ba5d7[_0x3b10e5(0x136)];else{const _0x8379ae=await currencyService_1[_0x3b10e5(0xce)][_0x3b10e5(0xfb)](_0x8ba5d7[_0x3b10e5(0xd5)],_0x8ba5d7[_0x3b10e5(0x13a)]);_0x51274a+=_0x8379ae;}}const _0x1761d3=this[_0x3b10e5(0xec)](_0x98dc3,_0x1ceafe,_0x3678e1),_0x26c86a=_0x3aa8c1>0x0?_0x17474e/_0x3aa8c1*0x64:0x0;return{'totalPayments':_0x3aa8c1,'successfulPayments':_0x17474e,'totalRevenue':Math['round'](_0x51274a*0x64)/0x64,'conversionRate':Math[_0x3b10e5(0x149)](_0x26c86a*0x64)/0x64,'dailyRevenue':_0x1761d3[_0x3b10e5(0x133)],'dailyPayments':_0x1761d3[_0x3b10e5(0x12a)],'recentPayments':_0x2194d3[_0x3b10e5(0xe7)](_0x1098d0=>({'id':_0x1098d0['id'],'gateway':_0x1098d0[_0x3b10e5(0x15b)],'amount':_0x1098d0[_0x3b10e5(0xd5)],'currency':_0x1098d0['currency'],'status':_0x1098d0[_0x3b10e5(0x147)],'createdAt':_0x1098d0[_0x3b10e5(0x117)]}))};}[a52_0x187f01(0xec)](_0x3824e2,_0x418805,_0x2394da){const _0x2566f0=a52_0x187f01,_0x25dd2a=new Map(),_0x33cff7=new Date(_0x418805);while(_0x33cff7<=_0x2394da){const _0x23ba54=_0x33cff7['toISOString']()['split']('T')[0x0];_0x25dd2a['set'](_0x23ba54,{'revenue':0x0,'count':0x0}),_0x33cff7['setDate'](_0x33cff7[_0x2566f0(0x153)]()+0x1);}for(const _0x32d9c5 of _0x3824e2){const _0x42e50c=_0x32d9c5['createdAt'][_0x2566f0(0xde)]()['split']('T')[0x0],_0x4fa207=_0x25dd2a[_0x2566f0(0xd1)](_0x42e50c);_0x4fa207&&(_0x4fa207[_0x2566f0(0x10a)]+=0x1,_0x32d9c5[_0x2566f0(0x147)]==='PAID'&&_0x32d9c5[_0x2566f0(0x136)]&&(_0x4fa207[_0x2566f0(0xf0)]+=_0x32d9c5['amountUSDT']));}const _0x391fdf=[],_0x311bc6=[];for(const [_0x3aadc6,_0x240c08]of _0x25dd2a){_0x391fdf['push']({'date':_0x3aadc6,'amount':Math['round'](_0x240c08[_0x2566f0(0xf0)]*0x64)/0x64}),_0x311bc6[_0x2566f0(0x152)]({'date':_0x3aadc6,'count':_0x240c08[_0x2566f0(0x10a)]});}return{'dailyRevenue':_0x391fdf,'dailyPayments':_0x311bc6};}}exports['ShopService']=ShopService;