'use strict';const a54_0x224610=a54_0x2c71;function a54_0x4c79(){const _0x504d3e=['getMonth','redirectUrl','gateway','revenue','Error\x20parsing\x20webhook\x20events:','COMPLETED','usdtErcWallet','getGatewayDisplayName','üìä\x20Shop\x20','asc','push','polygon','findMany','balance','status','test_order_123','USDT\x20ERC20','statusCode','all','setHours','polygon_usdc','txid','2352987retuSd','toUpperCase','PENDING','3421110RkQFcR','Rapyd','amountUSDT','Unknown\x20error','currencyService','USDT\x20BSC','round','getWebhookLogs','REJECTED','username','name','findFirst','findUnique','üìä\x20Status\x20filter:\x20','update','error','test','Shop\x20not\x20found','updatePayment','144UYQjuE','responseBody','toISOString','map','Noda','1758231HhgGEC','USDC\x20Polygon','gateways','customerEmail','getFullYear','USDT\x20TRC20','348821uFmvBd','PAID','getShopProfile','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','getStatistics','./paymentService','fullName','generateDailyStatistics','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','ceil','Plisio','getPaymentByShopAndId','usdcPolygonWallet','aggregate','set','30d','updateWallets','1920738icVnrm','shop','merchantUrl','testWebhook','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','totalPaidOut','customerName','paid','Test\x20webhook\x20sent\x20successfully\x20(','lte','\x20USDT\x20(total\x20payouts)','CoinToPay','_sum','convertToUSDT','retryCount','periodFrom','formatNetworkName','telegramId','shopUrl','getPayments','language','default','No\x20webhook\x20URL\x20configured','üìÖ\x20Date\x20start:\x20','ShopService','4bRKrNy','shopId','stringify','üåê\x20Network\x20filter:\x20','POST','publicKey','split','üí∞\x20Getting\x20payouts\x20with\x20filters:','PaymentService','filter','getTime','paymentId','amount','KLYME\x20DE','maxPayments','expiresAt','defineProperty','telegram','gatewaySettings','createPayment','desc','./currencyService','370830wxVUWR','gte','settings','USDT\x20Polygon','getPayoutById','network','awaitingPayout','Payment\x20not\x20found','KLYME\x20EU','__esModule','payment','üìÖ\x20Period\x20end:\x20','getPaymentsByShop','usdtPolygonWallet','\x20\x20\x20üìÖ\x20This\x20month:\x20','test_gateway','webhookUrl','isArray','delete','üìÖ\x20Date\x20end:\x20','\x20\x20\x20üíµ\x20Available\x20balance:\x20','periodTo','sourceCurrency','notes','wallets','thisMonth','90d','../config/database','usdtTrcWallet','parse','statusText','paymentService','message','webhookLog','deletePayment','updateShopProfile','createdAt','paymentGateways','count','3892380AuIJon','log','dailyRevenue','currency','setDate','reduce','webhookEvents','payout','\x20USDT\x20(current\x20balance)','country','paidAt'];a54_0x4c79=function(){return _0x504d3e;};return a54_0x4c79();}(function(_0x32269f,_0x1e3e89){const _0x120560=a54_0x2c71,_0x54520c=_0x32269f();while(!![]){try{const _0x15f9f4=parseInt(_0x120560(0x1ec))/0x1+-parseInt(_0x120560(0x1fd))/0x2+-parseInt(_0x120560(0x1ce))/0x3*(parseInt(_0x120560(0x216))/0x4)+-parseInt(_0x120560(0x1aa))/0x5+parseInt(_0x120560(0x22c))/0x6+-parseInt(_0x120560(0x1cb))/0x7+parseInt(_0x120560(0x1e1))/0x8*(parseInt(_0x120560(0x1e6))/0x9);if(_0x15f9f4===_0x1e3e89)break;else _0x54520c['push'](_0x54520c['shift']());}catch(_0x4cf70c){_0x54520c['push'](_0x54520c['shift']());}}}(a54_0x4c79,0xadc34));function a54_0x2c71(_0x4c85ca,_0x5ec193){const _0x4c7975=a54_0x4c79();return a54_0x2c71=function(_0x2c713b,_0x4a18f8){_0x2c713b=_0x2c713b-0x19c;let _0x289969=_0x4c7975[_0x2c713b];return _0x289969;},a54_0x2c71(_0x4c85ca,_0x5ec193);}var __importDefault=this&&this['__importDefault']||function(_0x41caf7){const _0x15e120=a54_0x2c71;return _0x41caf7&&_0x41caf7[_0x15e120(0x235)]?_0x41caf7:{'default':_0x41caf7};};Object[a54_0x224610(0x226)](exports,a54_0x224610(0x235),{'value':!![]}),exports[a54_0x224610(0x215)]=void 0x0;const database_1=__importDefault(require(a54_0x224610(0x19e))),currencyService_1=require(a54_0x224610(0x22b)),paymentService_1=require(a54_0x224610(0x1f1));class ShopService{constructor(){const _0x4319ed=a54_0x224610;this[_0x4319ed(0x1a2)]=new paymentService_1[(_0x4319ed(0x21e))]();}async[a54_0x224610(0x1ee)](_0x316aab){const _0x957dfd=a54_0x224610,_0x4ea500=await database_1[_0x957dfd(0x212)][_0x957dfd(0x1fe)]['findUnique']({'where':{'id':_0x316aab},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x4ea500)throw new Error(_0x957dfd(0x1df));let _0x1e493b=[];if(_0x4ea500[_0x957dfd(0x22e)]?.[_0x957dfd(0x1b0)])try{_0x1e493b=Array[_0x957dfd(0x23d)](_0x4ea500['settings'][_0x957dfd(0x1b0)])?_0x4ea500[_0x957dfd(0x22e)][_0x957dfd(0x1b0)]:JSON[_0x957dfd(0x1a0)](_0x4ea500['settings'][_0x957dfd(0x1b0)]);}catch(_0x54232f){console[_0x957dfd(0x1dd)]('Error\x20parsing\x20webhook\x20events:',_0x54232f),_0x1e493b=[];}return{'id':_0x4ea500['id'],'fullName':_0x4ea500[_0x957dfd(0x1d8)],'username':_0x4ea500[_0x957dfd(0x1d7)],'telegramId':_0x4ea500['telegram'],'merchantUrl':_0x4ea500[_0x957dfd(0x20f)],'gateways':_0x4ea500[_0x957dfd(0x1a8)]?JSON['parse'](_0x4ea500[_0x957dfd(0x1a8)]):null,'gatewaySettings':_0x4ea500['gatewaySettings']?JSON[_0x957dfd(0x1a0)](_0x4ea500[_0x957dfd(0x228)]):null,'publicKey':_0x4ea500[_0x957dfd(0x21b)],'webhookUrl':_0x4ea500[_0x957dfd(0x22e)]?.[_0x957dfd(0x23c)]||null,'webhookEvents':_0x1e493b,'wallets':{'usdtPolygonWallet':_0x4ea500[_0x957dfd(0x239)],'usdtTrcWallet':_0x4ea500[_0x957dfd(0x19f)],'usdtErcWallet':_0x4ea500[_0x957dfd(0x1bb)],'usdcPolygonWallet':_0x4ea500[_0x957dfd(0x1f8)]},'status':_0x4ea500[_0x957dfd(0x1c3)],'createdAt':_0x4ea500[_0x957dfd(0x1a7)]};}async[a54_0x224610(0x1a6)](_0x6aaa6e,_0x1571e7){const _0x25b76c=a54_0x224610,_0x46e717={};_0x1571e7[_0x25b76c(0x1f2)]&&(_0x46e717[_0x25b76c(0x1d8)]=_0x1571e7[_0x25b76c(0x1f2)]);_0x1571e7[_0x25b76c(0x20e)]!==undefined&&(_0x46e717[_0x25b76c(0x227)]=_0x1571e7[_0x25b76c(0x20e)]||null);_0x1571e7['merchantUrl']&&(_0x46e717['shopUrl']=_0x1571e7[_0x25b76c(0x1ff)]);_0x1571e7[_0x25b76c(0x1e8)]&&(_0x46e717[_0x25b76c(0x1a8)]=JSON[_0x25b76c(0x218)](_0x1571e7[_0x25b76c(0x1e8)]));_0x1571e7['gatewaySettings']&&(_0x46e717[_0x25b76c(0x228)]=JSON[_0x25b76c(0x218)](_0x1571e7['gatewaySettings']));_0x1571e7[_0x25b76c(0x244)]&&(_0x1571e7[_0x25b76c(0x244)][_0x25b76c(0x239)]!==undefined&&(_0x46e717[_0x25b76c(0x239)]=_0x1571e7[_0x25b76c(0x244)][_0x25b76c(0x239)]||null),_0x1571e7[_0x25b76c(0x244)][_0x25b76c(0x19f)]!==undefined&&(_0x46e717[_0x25b76c(0x19f)]=_0x1571e7[_0x25b76c(0x244)][_0x25b76c(0x19f)]||null),_0x1571e7[_0x25b76c(0x244)][_0x25b76c(0x1bb)]!==undefined&&(_0x46e717[_0x25b76c(0x1bb)]=_0x1571e7['wallets'][_0x25b76c(0x1bb)]||null),_0x1571e7[_0x25b76c(0x244)]['usdcPolygonWallet']!==undefined&&(_0x46e717[_0x25b76c(0x1f8)]=_0x1571e7[_0x25b76c(0x244)][_0x25b76c(0x1f8)]||null));const _0x1f9fa5=await database_1[_0x25b76c(0x212)][_0x25b76c(0x1fe)][_0x25b76c(0x1dc)]({'where':{'id':_0x6aaa6e},'data':_0x46e717,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2c78d1=[];if(_0x1f9fa5[_0x25b76c(0x22e)]?.['webhookEvents'])try{_0x2c78d1=Array[_0x25b76c(0x23d)](_0x1f9fa5[_0x25b76c(0x22e)][_0x25b76c(0x1b0)])?_0x1f9fa5[_0x25b76c(0x22e)][_0x25b76c(0x1b0)]:JSON[_0x25b76c(0x1a0)](_0x1f9fa5[_0x25b76c(0x22e)][_0x25b76c(0x1b0)]);}catch(_0x2c6f03){console[_0x25b76c(0x1dd)](_0x25b76c(0x1b9),_0x2c6f03),_0x2c78d1=[];}return{'id':_0x1f9fa5['id'],'fullName':_0x1f9fa5['name'],'username':_0x1f9fa5[_0x25b76c(0x1d7)],'telegramId':_0x1f9fa5[_0x25b76c(0x227)],'merchantUrl':_0x1f9fa5[_0x25b76c(0x20f)],'gateways':_0x1f9fa5[_0x25b76c(0x1a8)]?JSON[_0x25b76c(0x1a0)](_0x1f9fa5[_0x25b76c(0x1a8)]):null,'gatewaySettings':_0x1f9fa5[_0x25b76c(0x228)]?JSON[_0x25b76c(0x1a0)](_0x1f9fa5[_0x25b76c(0x228)]):null,'publicKey':_0x1f9fa5[_0x25b76c(0x21b)],'webhookUrl':_0x1f9fa5[_0x25b76c(0x22e)]?.[_0x25b76c(0x23c)]||null,'webhookEvents':_0x2c78d1,'wallets':{'usdtPolygonWallet':_0x1f9fa5[_0x25b76c(0x239)],'usdtTrcWallet':_0x1f9fa5[_0x25b76c(0x19f)],'usdtErcWallet':_0x1f9fa5[_0x25b76c(0x1bb)],'usdcPolygonWallet':_0x1f9fa5[_0x25b76c(0x1f8)]},'status':_0x1f9fa5[_0x25b76c(0x1c3)],'createdAt':_0x1f9fa5[_0x25b76c(0x1a7)]};}async[a54_0x224610(0x1fc)](_0x27ae7c,_0x932de5){const _0x2d6768=a54_0x224610,_0x37f515={};_0x932de5[_0x2d6768(0x239)]!==undefined&&(_0x37f515[_0x2d6768(0x239)]=_0x932de5[_0x2d6768(0x239)]||null),_0x932de5[_0x2d6768(0x19f)]!==undefined&&(_0x37f515[_0x2d6768(0x19f)]=_0x932de5[_0x2d6768(0x19f)]||null),_0x932de5['usdtErcWallet']!==undefined&&(_0x37f515[_0x2d6768(0x1bb)]=_0x932de5['usdtErcWallet']||null),_0x932de5['usdcPolygonWallet']!==undefined&&(_0x37f515[_0x2d6768(0x1f8)]=_0x932de5[_0x2d6768(0x1f8)]||null),await database_1[_0x2d6768(0x212)][_0x2d6768(0x1fe)][_0x2d6768(0x1dc)]({'where':{'id':_0x27ae7c},'data':_0x37f515});}async[a54_0x224610(0x200)](_0x22d047){const _0x58f401=a54_0x224610,_0x43fef2=await database_1[_0x58f401(0x212)][_0x58f401(0x1fe)]['findUnique']({'where':{'id':_0x22d047},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x43fef2?.[_0x58f401(0x22e)]?.[_0x58f401(0x23c)])throw new Error(_0x58f401(0x213));const _0x3fc051={'event':'test','payment':{'id':'test_payment_123','order_id':_0x58f401(0x1c4),'gateway':_0x58f401(0x1de),'amount':0x64,'currency':'USD','status':_0x58f401(0x204),'created_at':new Date()[_0x58f401(0x1e3)]()}};try{const _0x1d87a6=await fetch(_0x43fef2['settings'][_0x58f401(0x23c)],{'method':_0x58f401(0x21a),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON['stringify'](_0x3fc051)});return _0x1d87a6['ok']?{'success':!![],'message':_0x58f401(0x205)+_0x1d87a6['status']+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x1d87a6['status']+'\x20'+_0x1d87a6[_0x58f401(0x1a1)]};}catch(_0x41fd39){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x41fd39 instanceof Error?_0x41fd39[_0x58f401(0x1a3)]:_0x58f401(0x1d1))};}}async[a54_0x224610(0x229)](_0x2e6810){const _0x3a5cdc=a54_0x224610;return this['paymentService']['createPublicPayment']({'public_key':'','gateway':_0x2e6810[_0x3a5cdc(0x1b7)],'order_id':undefined,'amount':_0x2e6810['amount'],'currency':_0x2e6810[_0x3a5cdc(0x1ad)],'source_currency':_0x2e6810[_0x3a5cdc(0x242)],'usage':_0x2e6810['usage'],'expires_at':_0x2e6810[_0x3a5cdc(0x225)]?.[_0x3a5cdc(0x1e3)](),'success_url':_0x2e6810[_0x3a5cdc(0x1b6)],'fail_url':_0x2e6810[_0x3a5cdc(0x1b6)],'customer_email':_0x2e6810[_0x3a5cdc(0x1e9)],'customer_name':_0x2e6810[_0x3a5cdc(0x203)],'country':_0x2e6810[_0x3a5cdc(0x1b3)],'language':_0x2e6810[_0x3a5cdc(0x211)],'amount_is_editable':_0x2e6810['amountIsEditable'],'max_payments':_0x2e6810[_0x3a5cdc(0x224)],'customer':_0x2e6810['customer']});}async[a54_0x224610(0x210)](_0x26a080,_0x47d318){const _0x519d0d=a54_0x224610;return this[_0x519d0d(0x1a2)][_0x519d0d(0x238)](_0x26a080,_0x47d318);}async['getPaymentById'](_0x5be3f4,_0x3c51f4){const _0x4ba96d=a54_0x224610;return this['paymentService'][_0x4ba96d(0x1f7)](_0x5be3f4,_0x3c51f4);}async[a54_0x224610(0x1e0)](_0x414a95,_0x5d75ad,_0x2558b6){const _0x5505d0=a54_0x224610,_0xb47791=await database_1[_0x5505d0(0x212)][_0x5505d0(0x236)][_0x5505d0(0x1d9)]({'where':{'id':_0x5d75ad,'shopId':_0x414a95}});if(!_0xb47791)throw new Error('Payment\x20not\x20found');const _0x598bc0=await database_1[_0x5505d0(0x212)][_0x5505d0(0x236)][_0x5505d0(0x1dc)]({'where':{'id':_0x5d75ad},'data':{..._0x2558b6,'updatedAt':new Date()}});return _0x598bc0;}async[a54_0x224610(0x1a5)](_0x3472ee,_0x398568){const _0x47fe5d=a54_0x224610,_0x54b612=await database_1['default'][_0x47fe5d(0x236)]['findFirst']({'where':{'id':_0x398568,'shopId':_0x3472ee}});if(!_0x54b612)throw new Error(_0x47fe5d(0x233));await database_1[_0x47fe5d(0x212)]['payment'][_0x47fe5d(0x23e)]({'where':{'id':_0x398568}});}[a54_0x224610(0x20d)](_0x35cfd4){const _0x3c7b55=a54_0x224610,_0x2768ab={'polygon':_0x3c7b55(0x22f),'trc20':_0x3c7b55(0x1eb),'erc20':_0x3c7b55(0x1c5),'bsc':_0x3c7b55(0x1d3),'polygon_usdc':_0x3c7b55(0x1e7)};return _0x2768ab[_0x35cfd4]||_0x35cfd4;}async['getPayouts'](_0x29ab8d,_0x3f4542){const _0x4b41d2=a54_0x224610,{page:_0x178c41,limit:_0x5abd8e,status:_0x5986ec,method:_0x522993,network:_0xd60631,dateFrom:_0x23bd2c,dateTo:_0xf3f790,periodFrom:_0x4c2460,periodTo:_0x2ac010}=_0x3f4542,_0x3da9e6=(_0x178c41-0x1)*_0x5abd8e;console[_0x4b41d2(0x1ab)](_0x4b41d2(0x21d),_0x3f4542);const _0x4246d3={'shopId':_0x29ab8d};_0x5986ec&&(_0x4246d3[_0x4b41d2(0x1c3)]=_0x5986ec[_0x4b41d2(0x1cc)](),console[_0x4b41d2(0x1ab)](_0x4b41d2(0x1db)+_0x5986ec[_0x4b41d2(0x1cc)]()));if(_0x522993)_0x4246d3['network']=_0x522993,console[_0x4b41d2(0x1ab)]('üåê\x20Method\x20filter:\x20'+_0x522993);else _0xd60631&&(_0x4246d3[_0x4b41d2(0x231)]=_0xd60631,console[_0x4b41d2(0x1ab)](_0x4b41d2(0x219)+_0xd60631));if(_0x23bd2c||_0xf3f790||_0x4c2460||_0x2ac010){_0x4246d3[_0x4b41d2(0x1a7)]={};if(_0x4c2460){const _0x11a58a=new Date(_0x4c2460);_0x11a58a[_0x4b41d2(0x1c8)](0x0,0x0,0x0,0x0),_0x4246d3['createdAt'][_0x4b41d2(0x22d)]=_0x11a58a,console[_0x4b41d2(0x1ab)]('üìÖ\x20Period\x20start:\x20'+_0x11a58a['toISOString']());}else{if(_0x23bd2c){const _0x13e5a4=new Date(_0x23bd2c);_0x13e5a4['setHours'](0x0,0x0,0x0,0x0),_0x4246d3['createdAt'][_0x4b41d2(0x22d)]=_0x13e5a4,console[_0x4b41d2(0x1ab)](_0x4b41d2(0x214)+_0x13e5a4[_0x4b41d2(0x1e3)]());}}if(_0x2ac010){const _0x3407e0=new Date(_0x2ac010);_0x3407e0['setHours'](0x17,0x3b,0x3b,0x3e7),_0x4246d3[_0x4b41d2(0x1a7)][_0x4b41d2(0x206)]=_0x3407e0,console['log'](_0x4b41d2(0x237)+_0x3407e0[_0x4b41d2(0x1e3)]());}else{if(_0xf3f790){const _0x5683ef=new Date(_0xf3f790);_0x5683ef[_0x4b41d2(0x1c8)](0x17,0x3b,0x3b,0x3e7),_0x4246d3[_0x4b41d2(0x1a7)][_0x4b41d2(0x206)]=_0x5683ef,console[_0x4b41d2(0x1ab)](_0x4b41d2(0x23f)+_0x5683ef['toISOString']());}}}console[_0x4b41d2(0x1ab)]('üìä\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x4246d3,null,0x2));const [_0x4b417c,_0x1b9895]=await Promise[_0x4b41d2(0x1c7)]([database_1[_0x4b41d2(0x212)][_0x4b41d2(0x1b1)][_0x4b41d2(0x1c1)]({'where':_0x4246d3,'skip':_0x3da9e6,'take':_0x5abd8e,'orderBy':{'createdAt':_0x4b41d2(0x22a)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x4b41d2(0x212)][_0x4b41d2(0x1b1)][_0x4b41d2(0x1a9)]({'where':_0x4246d3})]);return{'payouts':_0x4b417c[_0x4b41d2(0x1e4)](_0xd7f2db=>{const _0x3638b9=_0x4b41d2;let _0xcb98fc=null;switch(_0xd7f2db['network']){case _0x3638b9(0x1c0):_0xcb98fc=_0xd7f2db[_0x3638b9(0x1fe)][_0x3638b9(0x239)];break;case'trc20':_0xcb98fc=_0xd7f2db[_0x3638b9(0x1fe)][_0x3638b9(0x19f)];break;case'erc20':_0xcb98fc=_0xd7f2db[_0x3638b9(0x1fe)][_0x3638b9(0x1bb)];break;case _0x3638b9(0x1c9):_0xcb98fc=_0xd7f2db[_0x3638b9(0x1fe)]['usdcPolygonWallet'];break;}return{'id':_0xd7f2db['id'],'amount':_0xd7f2db[_0x3638b9(0x222)],'network':this[_0x3638b9(0x20d)](_0xd7f2db[_0x3638b9(0x231)]),'wallet':_0xcb98fc,'status':_0xd7f2db[_0x3638b9(0x1c3)],'txid':_0xd7f2db[_0x3638b9(0x1ca)],'notes':_0xd7f2db[_0x3638b9(0x243)],'periodFrom':_0xd7f2db[_0x3638b9(0x20c)],'periodTo':_0xd7f2db[_0x3638b9(0x241)],'createdAt':_0xd7f2db['createdAt'],'paidAt':_0xd7f2db[_0x3638b9(0x1b4)]};}),'pagination':{'page':_0x178c41,'limit':_0x5abd8e,'total':_0x1b9895,'totalPages':Math[_0x4b41d2(0x1f5)](_0x1b9895/_0x5abd8e)}};}async[a54_0x224610(0x230)](_0x5cc1c8,_0x19ee68){const _0x49c25f=a54_0x224610,_0x15ecf0=await database_1[_0x49c25f(0x212)][_0x49c25f(0x1b1)][_0x49c25f(0x1d9)]({'where':{'id':_0x19ee68,'shopId':_0x5cc1c8}});if(!_0x15ecf0)return null;return{'id':_0x15ecf0['id'],'amount':_0x15ecf0[_0x49c25f(0x222)],'network':_0x15ecf0[_0x49c25f(0x231)],'status':_0x15ecf0[_0x49c25f(0x1c3)],'txid':_0x15ecf0[_0x49c25f(0x1ca)],'notes':_0x15ecf0[_0x49c25f(0x243)],'createdAt':_0x15ecf0[_0x49c25f(0x1a7)],'paidAt':_0x15ecf0[_0x49c25f(0x1b4)]};}async['getPayoutStatistics'](_0x5367d5,_0x259e7b){const _0x84588e=a54_0x224610,_0x18597d=new Date();let _0x49f422;switch(_0x259e7b){case'7d':_0x49f422=new Date(_0x18597d[_0x84588e(0x220)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x84588e(0x1fb):_0x49f422=new Date(_0x18597d[_0x84588e(0x220)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x84588e(0x19d):_0x49f422=new Date(_0x18597d[_0x84588e(0x220)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x49f422=new Date(_0x18597d['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x38990d,_0x6e1955,_0x2ba1a2,_0xd96cf1,_0xb58944,_0x34a3db]=await Promise[_0x84588e(0x1c7)]([database_1['default'][_0x84588e(0x1b1)]['count']({'where':{'shopId':_0x5367d5,'createdAt':{'gte':_0x49f422}}}),database_1['default'][_0x84588e(0x1b1)][_0x84588e(0x1a9)]({'where':{'shopId':_0x5367d5,'status':'COMPLETED','createdAt':{'gte':_0x49f422}}}),database_1[_0x84588e(0x212)][_0x84588e(0x1b1)][_0x84588e(0x1a9)]({'where':{'shopId':_0x5367d5,'status':_0x84588e(0x1cd),'createdAt':{'gte':_0x49f422}}}),database_1[_0x84588e(0x212)][_0x84588e(0x1b1)][_0x84588e(0x1a9)]({'where':{'shopId':_0x5367d5,'status':_0x84588e(0x1d6),'createdAt':{'gte':_0x49f422}}}),database_1[_0x84588e(0x212)][_0x84588e(0x1b1)][_0x84588e(0x1c1)]({'where':{'shopId':_0x5367d5,'createdAt':{'gte':_0x49f422}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x84588e(0x212)][_0x84588e(0x1b1)][_0x84588e(0x1c1)]({'where':{'shopId':_0x5367d5},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x1ce3ad=_0xb58944[_0x84588e(0x1af)]((_0x4ec546,_0x591c3a)=>_0x4ec546+_0x591c3a[_0x84588e(0x222)],0x0),_0x458bad=_0xb58944[_0x84588e(0x21f)](_0x4b7f94=>_0x4b7f94[_0x84588e(0x1c3)]===_0x84588e(0x1ba))[_0x84588e(0x1af)]((_0x3f4b47,_0x2cb90b)=>_0x3f4b47+_0x2cb90b['amount'],0x0),_0x4c643b=_0xb58944[_0x84588e(0x21f)](_0x329d05=>_0x329d05[_0x84588e(0x1c3)]===_0x84588e(0x1cd))['reduce']((_0x558d86,_0x5c0973)=>_0x558d86+_0x5c0973[_0x84588e(0x222)],0x0),_0x41758c=_0xb58944[_0x84588e(0x1af)]((_0x285e31,_0x5887ab)=>{const _0x5e2408=_0x84588e;return _0x285e31[_0x5887ab['network']]=(_0x285e31[_0x5887ab[_0x5e2408(0x231)]]||0x0)+0x1,_0x285e31;},{}),_0x66a079=_0xb58944[_0x84588e(0x1af)]((_0x62bbd1,_0x39fccf)=>{const _0x42f8c8=_0x84588e;return _0x62bbd1[_0x39fccf[_0x42f8c8(0x1c3)]]=(_0x62bbd1[_0x39fccf['status']]||0x0)+0x1,_0x62bbd1;},{});return{'totalPayouts':_0x38990d,'completedPayouts':_0x6e1955,'pendingPayouts':_0x2ba1a2,'rejectedPayouts':_0xd96cf1,'totalAmount':_0x1ce3ad,'completedAmount':_0x458bad,'pendingAmount':_0x4c643b,'payoutsByMethod':_0x41758c,'payoutsByStatus':_0x66a079,'recentPayouts':_0x34a3db[_0x84588e(0x1e4)](_0x2e980c=>({'id':_0x2e980c['id'],'shopId':_0x5367d5,'amount':_0x2e980c[_0x84588e(0x222)],'method':_0x2e980c[_0x84588e(0x231)],'status':_0x2e980c[_0x84588e(0x1c3)],'txid':_0x2e980c['txid'],'createdAt':_0x2e980c[_0x84588e(0x1a7)],'paidAt':_0x2e980c['paidAt']}))};}async['getShopPayoutStats'](_0x1c6560){const _0x3cb97e=a54_0x224610;console['log'](_0x3cb97e(0x1f4)+_0x1c6560+'...');const _0x25efbf=await database_1['default']['shop'][_0x3cb97e(0x1da)]({'where':{'id':_0x1c6560},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x25efbf)throw new Error('Shop\x20not\x20found');const _0x1b807b=new Date(),_0x4cefba=new Date(_0x1b807b[_0x3cb97e(0x1ea)](),_0x1b807b[_0x3cb97e(0x1b5)](),0x1),_0xcfc754=new Date(_0x1b807b[_0x3cb97e(0x1ea)](),_0x1b807b[_0x3cb97e(0x1b5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3d0331=await database_1[_0x3cb97e(0x212)]['payout'][_0x3cb97e(0x1f9)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1c6560,'createdAt':{'gte':_0x4cefba,'lte':_0xcfc754},'status':_0x3cb97e(0x1ba)}}),_0x36d821=_0x3d0331[_0x3cb97e(0x209)][_0x3cb97e(0x222)]||0x0,_0x106f1b={'availableBalance':Math[_0x3cb97e(0x1d4)](_0x25efbf[_0x3cb97e(0x1c2)]*0x64)/0x64,'totalPaidOut':Math[_0x3cb97e(0x1d4)](_0x25efbf[_0x3cb97e(0x202)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x25efbf['balance']*0x64)/0x64,'thisMonth':Math[_0x3cb97e(0x1d4)](_0x36d821*0x64)/0x64};return console[_0x3cb97e(0x1ab)](_0x3cb97e(0x1bd)+_0x25efbf[_0x3cb97e(0x1d7)]+'\x20payout\x20statistics\x20calculated:'),console[_0x3cb97e(0x1ab)](_0x3cb97e(0x240)+_0x106f1b['availableBalance']+_0x3cb97e(0x1b2)),console[_0x3cb97e(0x1ab)](_0x3cb97e(0x201)+_0x106f1b[_0x3cb97e(0x202)]+_0x3cb97e(0x207)),console[_0x3cb97e(0x1ab)](_0x3cb97e(0x1ef)+_0x106f1b[_0x3cb97e(0x232)]+_0x3cb97e(0x1b2)),console['log'](_0x3cb97e(0x23a)+_0x106f1b[_0x3cb97e(0x19c)]+'\x20USDT'),_0x106f1b;}[a54_0x224610(0x1bc)](_0x3f7e42){const _0x35eea7=a54_0x224610,_0x32e2d8={'test_gateway':'Test\x20Gateway','plisio':_0x35eea7(0x1f6),'rapyd':_0x35eea7(0x1cf),'noda':_0x35eea7(0x1e5),'cointopay':_0x35eea7(0x208),'klyme_eu':_0x35eea7(0x234),'klyme_gb':'KLYME\x20GB','klyme_de':_0x35eea7(0x223)};return _0x32e2d8[_0x3f7e42]||_0x3f7e42;}async['getPayoutStats'](_0x354283){return this['getShopPayoutStats'](_0x354283);}async[a54_0x224610(0x1d5)](_0x582901,_0x622e24){const _0x3b8b8a=a54_0x224610,{page:_0x2c3b16,limit:_0x372dfe,paymentId:_0x48f5ca}=_0x622e24,_0x4f1057=(_0x2c3b16-0x1)*_0x372dfe,_0x38485b={'shopId':_0x582901};_0x48f5ca&&(_0x38485b[_0x3b8b8a(0x221)]=_0x48f5ca);const [_0x14561a,_0x17054d]=await Promise['all']([database_1[_0x3b8b8a(0x212)][_0x3b8b8a(0x1a4)]['findMany']({'where':_0x38485b,'skip':_0x4f1057,'take':_0x372dfe,'orderBy':{'createdAt':_0x3b8b8a(0x22a)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x3b8b8a(0x212)][_0x3b8b8a(0x1a4)]['count']({'where':_0x38485b})]);return{'logs':_0x14561a['map'](_0x1ac7f6=>({'id':_0x1ac7f6['id'],'paymentId':_0x1ac7f6[_0x3b8b8a(0x221)],'shopId':_0x1ac7f6[_0x3b8b8a(0x217)],'event':_0x1ac7f6['event'],'statusCode':_0x1ac7f6[_0x3b8b8a(0x1c6)],'retryCount':_0x1ac7f6[_0x3b8b8a(0x20b)],'responseBody':_0x1ac7f6[_0x3b8b8a(0x1e2)],'createdAt':_0x1ac7f6[_0x3b8b8a(0x1a7)],'payment':_0x1ac7f6[_0x3b8b8a(0x236)]})),'pagination':{'page':_0x2c3b16,'limit':_0x372dfe,'total':_0x17054d,'totalPages':Math['ceil'](_0x17054d/_0x372dfe)}};}async[a54_0x224610(0x1f0)](_0x518ad5,_0x537c9e){const _0x21188a=a54_0x224610,_0x2868b7=new Date();let _0x2c1e39;switch(_0x537c9e){case'7d':_0x2c1e39=new Date(_0x2868b7['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2c1e39=new Date(_0x2868b7[_0x21188a(0x220)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x21188a(0x19d):_0x2c1e39=new Date(_0x2868b7[_0x21188a(0x220)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2c1e39=new Date(_0x2868b7[_0x21188a(0x220)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x366070,_0x4cefd1,_0x474336,_0x50a9ce,_0x1a5749]=await Promise[_0x21188a(0x1c7)]([database_1[_0x21188a(0x212)][_0x21188a(0x236)][_0x21188a(0x1a9)]({'where':{'shopId':_0x518ad5,'gateway':{'not':_0x21188a(0x23b)},'createdAt':{'gte':_0x2c1e39}}}),database_1[_0x21188a(0x212)][_0x21188a(0x236)][_0x21188a(0x1a9)]({'where':{'shopId':_0x518ad5,'gateway':{'not':_0x21188a(0x23b)},'status':_0x21188a(0x1ed),'createdAt':{'gte':_0x2c1e39}}}),database_1[_0x21188a(0x212)][_0x21188a(0x236)][_0x21188a(0x1c1)]({'where':{'shopId':_0x518ad5,'gateway':{'not':_0x21188a(0x23b)},'status':_0x21188a(0x1ed),'createdAt':{'gte':_0x2c1e39}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x21188a(0x212)]['payment'][_0x21188a(0x1c1)]({'where':{'shopId':_0x518ad5,'gateway':{'not':_0x21188a(0x23b)}},'take':0xa,'orderBy':{'createdAt':_0x21188a(0x22a)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x21188a(0x212)][_0x21188a(0x236)][_0x21188a(0x1c1)]({'where':{'shopId':_0x518ad5,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x2c1e39}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x21188a(0x1be)}})]);let _0x589b72=0x0;for(const _0x1112ff of _0x474336){if(_0x1112ff['amountUSDT'])_0x589b72+=_0x1112ff[_0x21188a(0x1d0)];else{const _0x3e900a=await currencyService_1[_0x21188a(0x1d2)][_0x21188a(0x20a)](_0x1112ff['amount'],_0x1112ff[_0x21188a(0x1ad)]);_0x589b72+=_0x3e900a;}}const _0xda7897=this[_0x21188a(0x1f3)](_0x1a5749,_0x2c1e39,_0x2868b7),_0x2d2a83=_0x366070>0x0?_0x4cefd1/_0x366070*0x64:0x0;return{'totalPayments':_0x366070,'successfulPayments':_0x4cefd1,'totalRevenue':Math[_0x21188a(0x1d4)](_0x589b72*0x64)/0x64,'conversionRate':Math[_0x21188a(0x1d4)](_0x2d2a83*0x64)/0x64,'dailyRevenue':_0xda7897[_0x21188a(0x1ac)],'dailyPayments':_0xda7897['dailyPayments'],'recentPayments':_0x50a9ce[_0x21188a(0x1e4)](_0x176b2d=>({'id':_0x176b2d['id'],'gateway':_0x176b2d[_0x21188a(0x1b7)],'amount':_0x176b2d[_0x21188a(0x222)],'currency':_0x176b2d[_0x21188a(0x1ad)],'status':_0x176b2d[_0x21188a(0x1c3)],'createdAt':_0x176b2d['createdAt']}))};}[a54_0x224610(0x1f3)](_0x2b96d8,_0x2091e5,_0x447018){const _0x46a4ea=a54_0x224610,_0x274e50=new Map(),_0x34623d=new Date(_0x2091e5);while(_0x34623d<=_0x447018){const _0x2141d=_0x34623d['toISOString']()['split']('T')[0x0];_0x274e50[_0x46a4ea(0x1fa)](_0x2141d,{'revenue':0x0,'count':0x0}),_0x34623d[_0x46a4ea(0x1ae)](_0x34623d['getDate']()+0x1);}for(const _0x5a3322 of _0x2b96d8){const _0x3ca8cf=_0x5a3322['createdAt'][_0x46a4ea(0x1e3)]()[_0x46a4ea(0x21c)]('T')[0x0],_0x3a4494=_0x274e50['get'](_0x3ca8cf);_0x3a4494&&(_0x3a4494[_0x46a4ea(0x1a9)]+=0x1,_0x5a3322[_0x46a4ea(0x1c3)]===_0x46a4ea(0x1ed)&&_0x5a3322[_0x46a4ea(0x1d0)]&&(_0x3a4494[_0x46a4ea(0x1b8)]+=_0x5a3322[_0x46a4ea(0x1d0)]));}const _0x427ff3=[],_0x284fbd=[];for(const [_0x5e110c,_0x5d54ae]of _0x274e50){_0x427ff3[_0x46a4ea(0x1bf)]({'date':_0x5e110c,'amount':Math[_0x46a4ea(0x1d4)](_0x5d54ae['revenue']*0x64)/0x64}),_0x284fbd['push']({'date':_0x5e110c,'count':_0x5d54ae['count']});}return{'dailyRevenue':_0x427ff3,'dailyPayments':_0x284fbd};}}exports[a54_0x224610(0x215)]=ShopService;