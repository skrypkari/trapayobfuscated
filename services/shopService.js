'use strict';const a60_0x22d05a=a60_0x7333;(function(_0x365d73,_0x57e053){const _0x5ab11a=a60_0x7333,_0x3a59bb=_0x365d73();while(!![]){try{const _0x244c33=parseInt(_0x5ab11a(0x117))/0x1+-parseInt(_0x5ab11a(0x151))/0x2*(-parseInt(_0x5ab11a(0x167))/0x3)+parseInt(_0x5ab11a(0x12a))/0x4+parseInt(_0x5ab11a(0xd6))/0x5+parseInt(_0x5ab11a(0x14a))/0x6*(parseInt(_0x5ab11a(0x114))/0x7)+parseInt(_0x5ab11a(0xe3))/0x8*(-parseInt(_0x5ab11a(0x106))/0x9)+-parseInt(_0x5ab11a(0xf1))/0xa*(parseInt(_0x5ab11a(0x139))/0xb);if(_0x244c33===_0x57e053)break;else _0x3a59bb['push'](_0x3a59bb['shift']());}catch(_0x31dcf1){_0x3a59bb['push'](_0x3a59bb['shift']());}}}(a60_0x1dc5,0x61819));var __importDefault=this&&this[a60_0x22d05a(0x104)]||function(_0x33c600){return _0x33c600&&_0x33c600['__esModule']?_0x33c600:{'default':_0x33c600};};Object[a60_0x22d05a(0x172)](exports,a60_0x22d05a(0x11e),{'value':!![]}),exports['ShopService']=void 0x0;function a60_0x7333(_0xfd1502,_0xa240d9){const _0x1dc520=a60_0x1dc5();return a60_0x7333=function(_0x73334c,_0x161a31){_0x73334c=_0x73334c-0xc2;let _0x1c698d=_0x1dc520[_0x73334c];return _0x1c698d;},a60_0x7333(_0xfd1502,_0xa240d9);}const database_1=__importDefault(require(a60_0x22d05a(0x13d))),currencyService_1=require(a60_0x22d05a(0x156)),paymentService_1=require('./paymentService');function a60_0x1dc5(){const _0x401035=['webhookEvents','aggregate','Error\x20parsing\x20webhook\x20events:','retryCount','balance','createPublicPayment','deletePayment','redirectUrl','thisMonth','__importDefault','updateShopProfile','1060218NsCBYU','shop','Shop\x20not\x20found','getDate','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','telegram','test_payment_123','getStatistics','createdAt','lte','getTime','revenue','...','erc20','7HVOUlS','currency','Noda','416927HYCJkj','\x20payout\x20statistics\x20calculated:','amountIsEditable','üìÖ\x20Date\x20end:\x20','split','availableBalance','country','__esModule','üìÖ\x20Date\x20start:\x20','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','get','getWebhookLogs','publicKey','getFullYear','\x20USDT\x20(current\x20balance)','USDT\x20Polygon','üìÖ\x20Period\x20end:\x20','getPaymentByShopAndId','usage','119740CPkvhm','\x20\x20\x20üìÖ\x20This\x20month:\x20','amount','getShopPayoutStats','txid','fullName','Failed\x20to\x20send\x20webhook:\x20','statusText','gateways','wallets','üåê\x20Network\x20filter:\x20','stringify','test','set','merchantUrl','8327oxJRnm','customerEmail','TesSoft\x20Payment\x20System/1.0\x20(Test)','filter','../config/database','count','trc20','REJECTED','Webhook\x20returned\x20error:\x20','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','usdcPolygonWallet','name','Test\x20webhook\x20sent\x20successfully\x20(','usdtErcWallet','CoinToPay','getPayoutById','paymentService','3374754BDwloo','getPayoutStatistics','responseBody','status','\x20\x20\x20üíµ\x20Available\x20balance:\x20','updateWallets','gatewaySettings','95260KCSXNE','notes','log','username','push','./currencyService','test_gateway','yesterday','PENDING','generateDailyStatistics','getPaymentsByShop','KLYME\x20GB','round','toLowerCase','formatNetworkName','setHours','desc','settings','asc','üìä\x20Final\x20WHERE\x20conditions:','all','Payment\x20not\x20found','48gOeHnn','statusCode','paidAt','getPaymentById','YESTERDAY','COMPLETED','customer','update','day','findUnique','üåê\x20Method\x20filter:\x20','defineProperty','gateway','network','convertToUSDT','polygon','getPayouts','paymentId','Rapyd','USDT\x20ERC20','parse','error','KLYME\x20DE','toISOString','USD','USDT\x20BSC','getPayments','testWebhook','shopId','paymentGateways','webhookUrl','30d','453425oJPovX','dailyPayments','message','toUpperCase','totalPaidOut','findMany','telegramId','default','PAID','amountUSDT','map','ceil','usdtPolygonWallet','16NQHHjO','currencyService','90d','isArray','usdtTrcWallet','setDate','findFirst','getMonth','periodTo','polygon_usdc','periodFrom','üí∞\x20Getting\x20payouts\x20with\x20filters:','\x20USDT\x20(total\x20payouts)','awaitingPayout','16210iWQiFp','payment','expiresAt','webhookLog','reduce','shopUrl','Plisio','payout','dailyRevenue','maxPayments'];a60_0x1dc5=function(){return _0x401035;};return a60_0x1dc5();}class ShopService{constructor(){const _0x2a21b6=a60_0x22d05a;this[_0x2a21b6(0x149)]=new paymentService_1['PaymentService']();}async['getShopProfile'](_0x2fe1b1){const _0xd9c690=a60_0x22d05a,_0x5c61b=await database_1[_0xd9c690(0xdd)]['shop'][_0xd9c690(0x170)]({'where':{'id':_0x2fe1b1},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x5c61b)throw new Error(_0xd9c690(0x108));let _0x57ba9d=[];if(_0x5c61b['settings']?.[_0xd9c690(0xfb)])try{_0x57ba9d=Array[_0xd9c690(0xe6)](_0x5c61b[_0xd9c690(0x162)]['webhookEvents'])?_0x5c61b[_0xd9c690(0x162)][_0xd9c690(0xfb)]:JSON[_0xd9c690(0xca)](_0x5c61b[_0xd9c690(0x162)][_0xd9c690(0xfb)]);}catch(_0x1ee16b){console[_0xd9c690(0xcb)]('Error\x20parsing\x20webhook\x20events:',_0x1ee16b),_0x57ba9d=[];}return{'id':_0x5c61b['id'],'fullName':_0x5c61b[_0xd9c690(0x144)],'username':_0x5c61b[_0xd9c690(0x154)],'telegramId':_0x5c61b[_0xd9c690(0x10b)],'merchantUrl':_0x5c61b[_0xd9c690(0xf6)],'gateways':_0x5c61b['paymentGateways']?JSON[_0xd9c690(0xca)](_0x5c61b['paymentGateways']):null,'gatewaySettings':_0x5c61b[_0xd9c690(0x150)]?JSON['parse'](_0x5c61b[_0xd9c690(0x150)]):null,'publicKey':_0x5c61b[_0xd9c690(0x123)],'webhookUrl':_0x5c61b[_0xd9c690(0x162)]?.[_0xd9c690(0xd4)]||null,'webhookEvents':_0x57ba9d,'wallets':{'usdtPolygonWallet':_0x5c61b[_0xd9c690(0xe2)],'usdtTrcWallet':_0x5c61b[_0xd9c690(0xe7)],'usdtErcWallet':_0x5c61b['usdtErcWallet'],'usdcPolygonWallet':_0x5c61b[_0xd9c690(0x143)]},'status':_0x5c61b[_0xd9c690(0x14d)],'createdAt':_0x5c61b[_0xd9c690(0x10e)]};}async[a60_0x22d05a(0x105)](_0x69cb69,_0x2ee708){const _0x372516=a60_0x22d05a,_0x182aca={};_0x2ee708[_0x372516(0x12f)]&&(_0x182aca[_0x372516(0x144)]=_0x2ee708['fullName']);_0x2ee708['telegramId']!==undefined&&(_0x182aca[_0x372516(0x10b)]=_0x2ee708[_0x372516(0xdc)]||null);_0x2ee708[_0x372516(0x138)]&&(_0x182aca[_0x372516(0xf6)]=_0x2ee708['merchantUrl']);_0x2ee708[_0x372516(0x132)]&&(_0x182aca[_0x372516(0xd3)]=JSON[_0x372516(0x135)](_0x2ee708['gateways']));_0x2ee708[_0x372516(0x150)]&&(_0x182aca['gatewaySettings']=JSON[_0x372516(0x135)](_0x2ee708[_0x372516(0x150)]));_0x2ee708[_0x372516(0x133)]&&(_0x2ee708['wallets'][_0x372516(0xe2)]!==undefined&&(_0x182aca[_0x372516(0xe2)]=_0x2ee708['wallets'][_0x372516(0xe2)]||null),_0x2ee708[_0x372516(0x133)][_0x372516(0xe7)]!==undefined&&(_0x182aca[_0x372516(0xe7)]=_0x2ee708['wallets'][_0x372516(0xe7)]||null),_0x2ee708[_0x372516(0x133)][_0x372516(0x146)]!==undefined&&(_0x182aca['usdtErcWallet']=_0x2ee708[_0x372516(0x133)]['usdtErcWallet']||null),_0x2ee708[_0x372516(0x133)][_0x372516(0x143)]!==undefined&&(_0x182aca['usdcPolygonWallet']=_0x2ee708['wallets']['usdcPolygonWallet']||null));const _0x20a4ef=await database_1[_0x372516(0xdd)][_0x372516(0x107)][_0x372516(0x16e)]({'where':{'id':_0x69cb69},'data':_0x182aca,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x12a79f=[];if(_0x20a4ef['settings']?.[_0x372516(0xfb)])try{_0x12a79f=Array['isArray'](_0x20a4ef[_0x372516(0x162)][_0x372516(0xfb)])?_0x20a4ef['settings'][_0x372516(0xfb)]:JSON['parse'](_0x20a4ef['settings']['webhookEvents']);}catch(_0x968ef0){console[_0x372516(0xcb)](_0x372516(0xfd),_0x968ef0),_0x12a79f=[];}return{'id':_0x20a4ef['id'],'fullName':_0x20a4ef[_0x372516(0x144)],'username':_0x20a4ef[_0x372516(0x154)],'telegramId':_0x20a4ef[_0x372516(0x10b)],'merchantUrl':_0x20a4ef[_0x372516(0xf6)],'gateways':_0x20a4ef['paymentGateways']?JSON['parse'](_0x20a4ef[_0x372516(0xd3)]):null,'gatewaySettings':_0x20a4ef[_0x372516(0x150)]?JSON[_0x372516(0xca)](_0x20a4ef[_0x372516(0x150)]):null,'publicKey':_0x20a4ef['publicKey'],'webhookUrl':_0x20a4ef['settings']?.['webhookUrl']||null,'webhookEvents':_0x12a79f,'wallets':{'usdtPolygonWallet':_0x20a4ef[_0x372516(0xe2)],'usdtTrcWallet':_0x20a4ef[_0x372516(0xe7)],'usdtErcWallet':_0x20a4ef[_0x372516(0x146)],'usdcPolygonWallet':_0x20a4ef[_0x372516(0x143)]},'status':_0x20a4ef[_0x372516(0x14d)],'createdAt':_0x20a4ef[_0x372516(0x10e)]};}async[a60_0x22d05a(0x14f)](_0x108171,_0x544ad5){const _0x468d96=a60_0x22d05a,_0x5aa54={};_0x544ad5[_0x468d96(0xe2)]!==undefined&&(_0x5aa54[_0x468d96(0xe2)]=_0x544ad5[_0x468d96(0xe2)]||null),_0x544ad5[_0x468d96(0xe7)]!==undefined&&(_0x5aa54[_0x468d96(0xe7)]=_0x544ad5[_0x468d96(0xe7)]||null),_0x544ad5[_0x468d96(0x146)]!==undefined&&(_0x5aa54[_0x468d96(0x146)]=_0x544ad5[_0x468d96(0x146)]||null),_0x544ad5[_0x468d96(0x143)]!==undefined&&(_0x5aa54[_0x468d96(0x143)]=_0x544ad5[_0x468d96(0x143)]||null),await database_1[_0x468d96(0xdd)][_0x468d96(0x107)][_0x468d96(0x16e)]({'where':{'id':_0x108171},'data':_0x5aa54});}async[a60_0x22d05a(0xd1)](_0x424745){const _0x1d298=a60_0x22d05a,_0x444751=await database_1['default']['shop'][_0x1d298(0x170)]({'where':{'id':_0x424745},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x444751?.[_0x1d298(0x162)]?.[_0x1d298(0xd4)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x132637={'event':_0x1d298(0x136),'payment':{'id':_0x1d298(0x10c),'order_id':'test_order_123','gateway':_0x1d298(0x136),'amount':0x64,'currency':_0x1d298(0xce),'status':'paid','created_at':new Date()[_0x1d298(0xcd)]()}};try{const _0x1efbc0=await fetch(_0x444751['settings'][_0x1d298(0xd4)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x1d298(0x13b)},'body':JSON[_0x1d298(0x135)](_0x132637)});return _0x1efbc0['ok']?{'success':!![],'message':_0x1d298(0x145)+_0x1efbc0['status']+')'}:{'success':![],'message':_0x1d298(0x141)+_0x1efbc0[_0x1d298(0x14d)]+'\x20'+_0x1efbc0[_0x1d298(0x131)]};}catch(_0xd6629d){return{'success':![],'message':_0x1d298(0x130)+(_0xd6629d instanceof Error?_0xd6629d[_0x1d298(0xd8)]:'Unknown\x20error')};}}async['createPayment'](_0x3f1e85){const _0x105525=a60_0x22d05a;return this['paymentService'][_0x105525(0x100)]({'public_key':'','gateway':_0x3f1e85['gateway'],'order_id':undefined,'amount':_0x3f1e85['amount'],'currency':_0x3f1e85[_0x105525(0x115)],'source_currency':_0x3f1e85['sourceCurrency'],'usage':_0x3f1e85[_0x105525(0x129)],'expires_at':_0x3f1e85[_0x105525(0xf3)]?.[_0x105525(0xcd)](),'success_url':_0x3f1e85[_0x105525(0x102)],'fail_url':_0x3f1e85[_0x105525(0x102)],'customer_email':_0x3f1e85[_0x105525(0x13a)],'customer_name':_0x3f1e85['customerName'],'country':_0x3f1e85[_0x105525(0x11d)],'language':_0x3f1e85['language'],'amount_is_editable':_0x3f1e85[_0x105525(0x119)],'max_payments':_0x3f1e85[_0x105525(0xfa)],'customer':_0x3f1e85[_0x105525(0x16d)]});}async[a60_0x22d05a(0xd0)](_0x1b8272,_0x11815f){const _0x1f2918=a60_0x22d05a;return this[_0x1f2918(0x149)][_0x1f2918(0x15b)](_0x1b8272,_0x11815f);}async[a60_0x22d05a(0x16a)](_0x85dff7,_0x567278){const _0x349254=a60_0x22d05a;return this[_0x349254(0x149)][_0x349254(0x128)](_0x85dff7,_0x567278);}async['updatePayment'](_0x3c7290,_0x264b83,_0x56b274){const _0x9c53a0=a60_0x22d05a,_0x17360e=await database_1[_0x9c53a0(0xdd)][_0x9c53a0(0xf2)][_0x9c53a0(0xe9)]({'where':{'id':_0x264b83,'shopId':_0x3c7290}});if(!_0x17360e)throw new Error(_0x9c53a0(0x166));const _0x58f778=await database_1[_0x9c53a0(0xdd)][_0x9c53a0(0xf2)][_0x9c53a0(0x16e)]({'where':{'id':_0x264b83},'data':{..._0x56b274,'updatedAt':new Date()}});return _0x58f778;}async[a60_0x22d05a(0x101)](_0x2a32e6,_0x485ac4){const _0x4ea1ad=a60_0x22d05a,_0x32bf46=await database_1[_0x4ea1ad(0xdd)][_0x4ea1ad(0xf2)][_0x4ea1ad(0xe9)]({'where':{'id':_0x485ac4,'shopId':_0x2a32e6}});if(!_0x32bf46)throw new Error(_0x4ea1ad(0x166));await database_1['default'][_0x4ea1ad(0xf2)]['delete']({'where':{'id':_0x485ac4}});}[a60_0x22d05a(0x15f)](_0x124f82){const _0x10c5fa=a60_0x22d05a,_0x539a90={'polygon':_0x10c5fa(0x126),'trc20':'USDT\x20TRC20','erc20':_0x10c5fa(0xc9),'bsc':_0x10c5fa(0xcf),'polygon_usdc':'USDC\x20Polygon'};return _0x539a90[_0x124f82]||_0x124f82;}async[a60_0x22d05a(0xc6)](_0x43a135,_0x3ec092){const _0x3c00ab=a60_0x22d05a,{page:_0x5922ef,limit:_0x20670c,status:_0x531d78,method:_0x345b09,network:_0x4e604d,dateFrom:_0x1f0457,dateTo:_0x461b84,periodFrom:_0x2f1fd9,periodTo:_0x9028f1}=_0x3ec092,_0x1d6a6c=(_0x5922ef-0x1)*_0x20670c;console[_0x3c00ab(0x153)](_0x3c00ab(0xee),_0x3ec092);const _0x1812ae={'shopId':_0x43a135};_0x531d78&&(_0x1812ae[_0x3c00ab(0x14d)]=_0x531d78[_0x3c00ab(0xd9)](),console['log']('üìä\x20Status\x20filter:\x20'+_0x531d78[_0x3c00ab(0xd9)]()));if(_0x345b09)_0x1812ae['network']=_0x345b09,console[_0x3c00ab(0x153)](_0x3c00ab(0x171)+_0x345b09);else _0x4e604d&&(_0x1812ae[_0x3c00ab(0xc3)]=_0x4e604d,console['log'](_0x3c00ab(0x134)+_0x4e604d));if(_0x1f0457||_0x461b84||_0x2f1fd9||_0x9028f1){_0x1812ae[_0x3c00ab(0x10e)]={};if(_0x2f1fd9){const _0x117449=new Date(_0x2f1fd9);_0x117449[_0x3c00ab(0x160)](0x0,0x0,0x0,0x0),_0x1812ae['createdAt']['gte']=_0x117449,console[_0x3c00ab(0x153)]('üìÖ\x20Period\x20start:\x20'+_0x117449['toISOString']());}else{if(_0x1f0457){const _0x36e1d9=new Date(_0x1f0457);_0x36e1d9[_0x3c00ab(0x160)](0x0,0x0,0x0,0x0),_0x1812ae[_0x3c00ab(0x10e)]['gte']=_0x36e1d9,console[_0x3c00ab(0x153)](_0x3c00ab(0x11f)+_0x36e1d9['toISOString']());}}if(_0x9028f1){const _0x25bc61=new Date(_0x9028f1);_0x25bc61[_0x3c00ab(0x160)](0x17,0x3b,0x3b,0x3e7),_0x1812ae[_0x3c00ab(0x10e)][_0x3c00ab(0x10f)]=_0x25bc61,console[_0x3c00ab(0x153)](_0x3c00ab(0x127)+_0x25bc61['toISOString']());}else{if(_0x461b84){const _0x1293d0=new Date(_0x461b84);_0x1293d0['setHours'](0x17,0x3b,0x3b,0x3e7),_0x1812ae[_0x3c00ab(0x10e)][_0x3c00ab(0x10f)]=_0x1293d0,console[_0x3c00ab(0x153)](_0x3c00ab(0x11a)+_0x1293d0[_0x3c00ab(0xcd)]());}}}console[_0x3c00ab(0x153)](_0x3c00ab(0x164),JSON[_0x3c00ab(0x135)](_0x1812ae,null,0x2));const [_0x349d8c,_0x2ff62b]=await Promise[_0x3c00ab(0x165)]([database_1['default'][_0x3c00ab(0xf8)][_0x3c00ab(0xdb)]({'where':_0x1812ae,'skip':_0x1d6a6c,'take':_0x20670c,'orderBy':{'createdAt':_0x3c00ab(0x161)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x3c00ab(0xdd)][_0x3c00ab(0xf8)][_0x3c00ab(0x13e)]({'where':_0x1812ae})]);return{'payouts':_0x349d8c[_0x3c00ab(0xe0)](_0x2782db=>{const _0x46fd3d=_0x3c00ab;let _0x32572e=null;switch(_0x2782db['network']){case _0x46fd3d(0xc5):_0x32572e=_0x2782db[_0x46fd3d(0x107)][_0x46fd3d(0xe2)];break;case _0x46fd3d(0x13f):_0x32572e=_0x2782db[_0x46fd3d(0x107)][_0x46fd3d(0xe7)];break;case _0x46fd3d(0x113):_0x32572e=_0x2782db['shop']['usdtErcWallet'];break;case _0x46fd3d(0xec):_0x32572e=_0x2782db['shop'][_0x46fd3d(0x143)];break;}return{'id':_0x2782db['id'],'amount':_0x2782db[_0x46fd3d(0x12c)],'network':this['formatNetworkName'](_0x2782db[_0x46fd3d(0xc3)]),'wallet':_0x32572e,'status':_0x2782db[_0x46fd3d(0x14d)],'txid':_0x2782db[_0x46fd3d(0x12e)],'notes':_0x2782db[_0x46fd3d(0x152)],'periodFrom':_0x2782db[_0x46fd3d(0xed)],'periodTo':_0x2782db[_0x46fd3d(0xeb)],'createdAt':_0x2782db[_0x46fd3d(0x10e)],'paidAt':_0x2782db['paidAt']};}),'pagination':{'page':_0x5922ef,'limit':_0x20670c,'total':_0x2ff62b,'totalPages':Math[_0x3c00ab(0xe1)](_0x2ff62b/_0x20670c)}};}async[a60_0x22d05a(0x148)](_0x4bcd1c,_0x42b1be){const _0x359b5a=a60_0x22d05a,_0x20b347=await database_1[_0x359b5a(0xdd)][_0x359b5a(0xf8)][_0x359b5a(0xe9)]({'where':{'id':_0x42b1be,'shopId':_0x4bcd1c}});if(!_0x20b347)return null;return{'id':_0x20b347['id'],'amount':_0x20b347[_0x359b5a(0x12c)],'network':_0x20b347['network'],'status':_0x20b347[_0x359b5a(0x14d)],'txid':_0x20b347[_0x359b5a(0x12e)],'notes':_0x20b347[_0x359b5a(0x152)],'createdAt':_0x20b347[_0x359b5a(0x10e)],'paidAt':_0x20b347[_0x359b5a(0x169)]};}async[a60_0x22d05a(0x14b)](_0x4abc10,_0x2cdd08){const _0x4e39ef=a60_0x22d05a,_0x430def=new Date();let _0x4bcff9,_0x349e0e;switch(_0x2cdd08){case _0x4e39ef(0x158):case _0x4e39ef(0x16b):const _0x174951=new Date(_0x430def);_0x174951['setDate'](_0x174951[_0x4e39ef(0x109)]()-0x1),_0x4bcff9=new Date(_0x174951),_0x4bcff9[_0x4e39ef(0x160)](0x0,0x0,0x0,0x0),_0x349e0e=new Date(_0x174951),_0x349e0e[_0x4e39ef(0x160)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x4bcff9=new Date(_0x430def['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4e39ef(0xd5):_0x4bcff9=new Date(_0x430def[_0x4e39ef(0x110)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4e39ef(0xe5):_0x4bcff9=new Date(_0x430def[_0x4e39ef(0x110)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4bcff9=new Date(_0x430def[_0x4e39ef(0x110)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x37fa6f={'gte':_0x4bcff9};_0x349e0e&&(_0x37fa6f[_0x4e39ef(0x10f)]=_0x349e0e);const [_0x3a7364,_0x5b9051,_0x37459b,_0x26a0aa,_0x222ebc,_0x45e968]=await Promise[_0x4e39ef(0x165)]([database_1[_0x4e39ef(0xdd)]['payout'][_0x4e39ef(0x13e)]({'where':{'shopId':_0x4abc10,'createdAt':_0x37fa6f}}),database_1['default'][_0x4e39ef(0xf8)][_0x4e39ef(0x13e)]({'where':{'shopId':_0x4abc10,'status':'COMPLETED','createdAt':_0x37fa6f}}),database_1['default']['payout'][_0x4e39ef(0x13e)]({'where':{'shopId':_0x4abc10,'status':_0x4e39ef(0x159),'createdAt':_0x37fa6f}}),database_1[_0x4e39ef(0xdd)][_0x4e39ef(0xf8)][_0x4e39ef(0x13e)]({'where':{'shopId':_0x4abc10,'status':_0x4e39ef(0x140),'createdAt':_0x37fa6f}}),database_1[_0x4e39ef(0xdd)]['payout'][_0x4e39ef(0xdb)]({'where':{'shopId':_0x4abc10,'createdAt':_0x37fa6f},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x4e39ef(0xdd)][_0x4e39ef(0xf8)][_0x4e39ef(0xdb)]({'where':{'shopId':_0x4abc10},'take':0xa,'orderBy':{'createdAt':_0x4e39ef(0x161)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x1788d1=_0x222ebc['reduce']((_0x566b27,_0x1c5beb)=>_0x566b27+_0x1c5beb[_0x4e39ef(0x12c)],0x0),_0x30fbda=_0x222ebc[_0x4e39ef(0x13c)](_0x2d2c59=>_0x2d2c59[_0x4e39ef(0x14d)]===_0x4e39ef(0x16c))[_0x4e39ef(0xf5)]((_0x15a89c,_0x55630f)=>_0x15a89c+_0x55630f[_0x4e39ef(0x12c)],0x0),_0x524322=_0x222ebc[_0x4e39ef(0x13c)](_0x17ad74=>_0x17ad74[_0x4e39ef(0x14d)]===_0x4e39ef(0x159))[_0x4e39ef(0xf5)]((_0x4678e9,_0x1ba3ba)=>_0x4678e9+_0x1ba3ba[_0x4e39ef(0x12c)],0x0),_0x2ccf43=_0x222ebc[_0x4e39ef(0xf5)]((_0x38665b,_0x3310c5)=>{const _0x176e96=_0x4e39ef;return _0x38665b[_0x3310c5[_0x176e96(0xc3)]]=(_0x38665b[_0x3310c5[_0x176e96(0xc3)]]||0x0)+0x1,_0x38665b;},{}),_0x37f354=_0x222ebc[_0x4e39ef(0xf5)]((_0x3ed111,_0x322fa5)=>{const _0x3d480e=_0x4e39ef;return _0x3ed111[_0x322fa5[_0x3d480e(0x14d)]]=(_0x3ed111[_0x322fa5['status']]||0x0)+0x1,_0x3ed111;},{});return{'totalPayouts':_0x3a7364,'completedPayouts':_0x5b9051,'pendingPayouts':_0x37459b,'rejectedPayouts':_0x26a0aa,'totalAmount':_0x1788d1,'completedAmount':_0x30fbda,'pendingAmount':_0x524322,'payoutsByMethod':_0x2ccf43,'payoutsByStatus':_0x37f354,'recentPayouts':_0x45e968[_0x4e39ef(0xe0)](_0x26a5f1=>({'id':_0x26a5f1['id'],'shopId':_0x4abc10,'amount':_0x26a5f1[_0x4e39ef(0x12c)],'method':_0x26a5f1['network'],'status':_0x26a5f1[_0x4e39ef(0x14d)],'txid':_0x26a5f1[_0x4e39ef(0x12e)],'createdAt':_0x26a5f1['createdAt'],'paidAt':_0x26a5f1[_0x4e39ef(0x169)]}))};}async[a60_0x22d05a(0x12d)](_0x1c197e){const _0x254eeb=a60_0x22d05a;console[_0x254eeb(0x153)](_0x254eeb(0x120)+_0x1c197e+_0x254eeb(0x112));const _0x4cc2b8=await database_1[_0x254eeb(0xdd)][_0x254eeb(0x107)][_0x254eeb(0x170)]({'where':{'id':_0x1c197e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4cc2b8)throw new Error(_0x254eeb(0x108));const _0x2eadf9=new Date(),_0x40cc21=new Date(_0x2eadf9[_0x254eeb(0x124)](),_0x2eadf9[_0x254eeb(0xea)](),0x1),_0x4acda5=new Date(_0x2eadf9[_0x254eeb(0x124)](),_0x2eadf9[_0x254eeb(0xea)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x39ef1b=await database_1[_0x254eeb(0xdd)][_0x254eeb(0xf8)][_0x254eeb(0xfc)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1c197e,'createdAt':{'gte':_0x40cc21,'lte':_0x4acda5},'status':_0x254eeb(0x16c)}}),_0x49627a=_0x39ef1b['_sum'][_0x254eeb(0x12c)]||0x0,_0x1d7667={'availableBalance':Math['round'](_0x4cc2b8[_0x254eeb(0xff)]*0x64)/0x64,'totalPaidOut':Math[_0x254eeb(0x15d)](_0x4cc2b8[_0x254eeb(0xda)]*0x64)/0x64,'awaitingPayout':Math[_0x254eeb(0x15d)](_0x4cc2b8['balance']*0x64)/0x64,'thisMonth':Math[_0x254eeb(0x15d)](_0x49627a*0x64)/0x64};return console[_0x254eeb(0x153)]('üìä\x20Shop\x20'+_0x4cc2b8[_0x254eeb(0x154)]+_0x254eeb(0x118)),console['log'](_0x254eeb(0x14e)+_0x1d7667[_0x254eeb(0x11c)]+'\x20USDT\x20(current\x20balance)'),console[_0x254eeb(0x153)](_0x254eeb(0x142)+_0x1d7667[_0x254eeb(0xda)]+_0x254eeb(0xef)),console['log'](_0x254eeb(0x10a)+_0x1d7667[_0x254eeb(0xf0)]+_0x254eeb(0x125)),console['log'](_0x254eeb(0x12b)+_0x1d7667[_0x254eeb(0x103)]+'\x20USDT'),_0x1d7667;}['getGatewayDisplayName'](_0x4ca050){const _0x25db92=a60_0x22d05a,_0x2e2dbe={'test_gateway':'Test\x20Gateway','plisio':_0x25db92(0xf7),'rapyd':_0x25db92(0xc8),'noda':_0x25db92(0x116),'cointopay':_0x25db92(0x147),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x25db92(0x15c),'klyme_de':_0x25db92(0xcc)};return _0x2e2dbe[_0x4ca050]||_0x4ca050;}async['getPayoutStats'](_0x20b845){return this['getShopPayoutStats'](_0x20b845);}async[a60_0x22d05a(0x122)](_0x4c499c,_0x2b5f0c){const _0x35afd2=a60_0x22d05a,{page:_0x15ac12,limit:_0x2f4d57,paymentId:_0x3c4908}=_0x2b5f0c,_0x1019fe=(_0x15ac12-0x1)*_0x2f4d57,_0xf9faab={'shopId':_0x4c499c};_0x3c4908&&(_0xf9faab[_0x35afd2(0xc7)]=_0x3c4908);const [_0x466b1c,_0x1b621b]=await Promise[_0x35afd2(0x165)]([database_1['default'][_0x35afd2(0xf4)][_0x35afd2(0xdb)]({'where':_0xf9faab,'skip':_0x1019fe,'take':_0x2f4d57,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x35afd2(0xdd)][_0x35afd2(0xf4)][_0x35afd2(0x13e)]({'where':_0xf9faab})]);return{'logs':_0x466b1c[_0x35afd2(0xe0)](_0x1b8590=>({'id':_0x1b8590['id'],'paymentId':_0x1b8590[_0x35afd2(0xc7)],'shopId':_0x1b8590[_0x35afd2(0xd2)],'event':_0x1b8590['event'],'statusCode':_0x1b8590[_0x35afd2(0x168)],'retryCount':_0x1b8590[_0x35afd2(0xfe)],'responseBody':_0x1b8590[_0x35afd2(0x14c)],'createdAt':_0x1b8590[_0x35afd2(0x10e)],'payment':_0x1b8590[_0x35afd2(0xf2)]})),'pagination':{'page':_0x15ac12,'limit':_0x2f4d57,'total':_0x1b621b,'totalPages':Math[_0x35afd2(0xe1)](_0x1b621b/_0x2f4d57)}};}async[a60_0x22d05a(0x10d)](_0x1ebae1,_0x1de3a3){const _0x4036fa=a60_0x22d05a,_0x5d3400=new Date();let _0x2c28c2,_0x9bdaf1;switch(_0x1de3a3[_0x4036fa(0x15e)]()){case _0x4036fa(0x16f):_0x2c28c2=new Date(_0x5d3400['getFullYear'](),_0x5d3400[_0x4036fa(0xea)](),_0x5d3400[_0x4036fa(0x109)](),0x0,0x0,0x0,0x0);break;case _0x4036fa(0x158):case _0x4036fa(0x16b):const _0x2634fb=new Date(_0x5d3400);_0x2634fb[_0x4036fa(0xe8)](_0x2634fb[_0x4036fa(0x109)]()-0x1),_0x2c28c2=new Date(_0x2634fb),_0x2c28c2[_0x4036fa(0x160)](0x0,0x0,0x0,0x0),_0x9bdaf1=new Date(_0x2634fb),_0x9bdaf1[_0x4036fa(0x160)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x2c28c2=new Date(_0x5d3400[_0x4036fa(0x110)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2c28c2=new Date(_0x5d3400[_0x4036fa(0x110)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4036fa(0xe5):_0x2c28c2=new Date(_0x5d3400['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2c28c2=new Date(_0x5d3400['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x392084={'gte':_0x2c28c2};_0x9bdaf1&&(_0x392084[_0x4036fa(0x10f)]=_0x9bdaf1);const [_0x3b0527,_0x10c6e9,_0x409ef9,_0x1ee651,_0x5453c2]=await Promise['all']([database_1[_0x4036fa(0xdd)][_0x4036fa(0xf2)][_0x4036fa(0x13e)]({'where':{'shopId':_0x1ebae1,'gateway':{'not':_0x4036fa(0x157)},'createdAt':_0x392084}}),database_1[_0x4036fa(0xdd)][_0x4036fa(0xf2)]['count']({'where':{'shopId':_0x1ebae1,'gateway':{'not':_0x4036fa(0x157)},'status':'PAID','createdAt':_0x392084}}),database_1[_0x4036fa(0xdd)][_0x4036fa(0xf2)][_0x4036fa(0xdb)]({'where':{'shopId':_0x1ebae1,'gateway':{'not':'test_gateway'},'status':_0x4036fa(0xde),'createdAt':_0x392084},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x4036fa(0xdd)][_0x4036fa(0xf2)][_0x4036fa(0xdb)]({'where':{'shopId':_0x1ebae1,'gateway':{'not':_0x4036fa(0x157)}},'take':0xa,'orderBy':{'createdAt':_0x4036fa(0x161)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x4036fa(0xf2)][_0x4036fa(0xdb)]({'where':{'shopId':_0x1ebae1,'gateway':{'not':_0x4036fa(0x157)},'createdAt':_0x392084},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4036fa(0x163)}})]);let _0x493350=0x0;for(const _0x2253b0 of _0x409ef9){if(_0x2253b0[_0x4036fa(0xdf)])_0x493350+=_0x2253b0[_0x4036fa(0xdf)];else{const _0xacf807=await currencyService_1[_0x4036fa(0xe4)][_0x4036fa(0xc4)](_0x2253b0['amount'],_0x2253b0['currency']);_0x493350+=_0xacf807;}}const _0x31aded=this['generateDailyStatistics'](_0x5453c2,_0x2c28c2,_0x9bdaf1||_0x5d3400),_0x25cce2=_0x3b0527>0x0?_0x10c6e9/_0x3b0527*0x64:0x0;return{'totalPayments':_0x3b0527,'successfulPayments':_0x10c6e9,'totalRevenue':Math[_0x4036fa(0x15d)](_0x493350*0x64)/0x64,'conversionRate':Math[_0x4036fa(0x15d)](_0x25cce2*0x64)/0x64,'dailyRevenue':_0x31aded[_0x4036fa(0xf9)],'dailyPayments':_0x31aded[_0x4036fa(0xd7)],'recentPayments':_0x1ee651[_0x4036fa(0xe0)](_0x4af4da=>({'id':_0x4af4da['id'],'gateway':_0x4af4da[_0x4036fa(0xc2)],'amount':_0x4af4da[_0x4036fa(0x12c)],'currency':_0x4af4da[_0x4036fa(0x115)],'status':_0x4af4da[_0x4036fa(0x14d)],'createdAt':_0x4af4da[_0x4036fa(0x10e)]}))};}[a60_0x22d05a(0x15a)](_0xeb850,_0x97413d,_0x2ebd9f){const _0x6bb32a=a60_0x22d05a,_0x11f497=new Map(),_0x296b24=new Date(_0x97413d);while(_0x296b24<=_0x2ebd9f){const _0x24e32b=_0x296b24['toISOString']()['split']('T')[0x0];_0x11f497[_0x6bb32a(0x137)](_0x24e32b,{'revenue':0x0,'count':0x0}),_0x296b24[_0x6bb32a(0xe8)](_0x296b24[_0x6bb32a(0x109)]()+0x1);}for(const _0x36f0d8 of _0xeb850){const _0x34e273=_0x36f0d8[_0x6bb32a(0x10e)][_0x6bb32a(0xcd)]()[_0x6bb32a(0x11b)]('T')[0x0],_0x569901=_0x11f497[_0x6bb32a(0x121)](_0x34e273);_0x569901&&(_0x569901[_0x6bb32a(0x13e)]+=0x1,_0x36f0d8[_0x6bb32a(0x14d)]===_0x6bb32a(0xde)&&_0x36f0d8[_0x6bb32a(0xdf)]&&(_0x569901['revenue']+=_0x36f0d8['amountUSDT']));}const _0x295f1a=[],_0x2b7c11=[];for(const [_0x3a5180,_0x3dc899]of _0x11f497){_0x295f1a['push']({'date':_0x3a5180,'amount':Math[_0x6bb32a(0x15d)](_0x3dc899[_0x6bb32a(0x111)]*0x64)/0x64}),_0x2b7c11[_0x6bb32a(0x155)]({'date':_0x3a5180,'count':_0x3dc899[_0x6bb32a(0x13e)]});}return{'dailyRevenue':_0x295f1a,'dailyPayments':_0x2b7c11};}}exports['ShopService']=ShopService;