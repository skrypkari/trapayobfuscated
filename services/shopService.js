'use strict';const a79_0x24b02e=a79_0x6918;(function(_0x5de191,_0x278945){const _0x4ca95b=a79_0x6918,_0x55c245=_0x5de191();while(!![]){try{const _0x59bfbb=-parseInt(_0x4ca95b(0xef))/0x1*(parseInt(_0x4ca95b(0x1a6))/0x2)+-parseInt(_0x4ca95b(0x1c3))/0x3+-parseInt(_0x4ca95b(0x168))/0x4+parseInt(_0x4ca95b(0x15b))/0x5*(parseInt(_0x4ca95b(0x1a0))/0x6)+parseInt(_0x4ca95b(0x15d))/0x7*(parseInt(_0x4ca95b(0x17c))/0x8)+parseInt(_0x4ca95b(0x177))/0x9*(-parseInt(_0x4ca95b(0x119))/0xa)+-parseInt(_0x4ca95b(0x127))/0xb*(-parseInt(_0x4ca95b(0x1cb))/0xc);if(_0x59bfbb===_0x278945)break;else _0x55c245['push'](_0x55c245['shift']());}catch(_0x1e3d02){_0x55c245['push'](_0x55c245['shift']());}}}(a79_0x330b,0x8d0b1));var __importDefault=this&&this[a79_0x24b02e(0x118)]||function(_0x24b5d1){const _0x472f55=a79_0x24b02e;return _0x24b5d1&&_0x24b5d1[_0x472f55(0x197)]?_0x24b5d1:{'default':_0x24b5d1};};function a79_0x6918(_0x1859d8,_0x3a9106){_0x1859d8=_0x1859d8-0xec;const _0x330b6b=a79_0x330b();let _0x691842=_0x330b6b[_0x1859d8];return _0x691842;}function a79_0x330b(){const _0x3c9c84=['AVAILABLE_GATEWAYS','generateDailyStatistics','getPaymentByShopAndId','createPayment','thisMonth','\x20USDT\x20(current\x20balance)','getFullYear','üîë\x20Generated\x20','USDC\x20Ethereum','balance','CHARGEBACK','statusText','redirectUrl','getPayouts','awaitingPayout','payment','üìÖ\x20Period\x20end:\x20','all','expiresAt','ceil','getPayoutStats','message','gateways','trc20','Payment\x20System/1.0\x20(Test)','telegram','speakeasy','deletePayment','ShopService','settings','Test\x20Gateway','twoFactorSecret','findMany','telegramId','REJECTED','dailyPayments','getWebhookLogs','status','totp','üåê\x20Network\x20filter:\x20','usdcPolygonWallet','network','twoFactorEnabled','PENDING','getPayoutById','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','REFUND','335wAbvPQ','toISOString','35HwUrNx','üìÖ\x20Period\x20start:\x20','payout','twoFactorToken','getShopProfile','No\x20webhook\x20URL\x20configured','today','toDataURL','KLYME\x20GB','amountAfterGatewayCommissionUSDT',',\x20dateTo:\x20','2756132CXproG','generateSecret','Payment\x20not\x20found','_sum','delete','this_month',',\x20dateFrom:\x20','paidAt','setHours','getUTCDay','fullName','Noda','paymentService','last_month','üí∞\x20Getting\x20payouts\x20with\x20filters:','1414593ITfhHo','round','90d','üìÖ\x20Custom\x20date\x20range:\x20','UTC','696656rcdjXQ','TrapaPay\x20(','otpauth_url','Unknown\x20error','setUTCDate','isActive','base32','getUTCFullYear','PAID','polygon_usdc','notes','webhookUrl','gte','yesterday','getPaymentById','convertToUSDT','üîê\x202FA\x20enabled\x20for\x20shop:\x20','üìä\x20Status\x20filter:\x20','./paymentService','findFirst','event','availableBalance','webhookEvents','gateway','txid','formatNetworkName','üìä\x20Getting\x20statistics\x20for\x20shop\x20','__esModule','erc20','getUTCMonth','username','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','Failed\x20to\x20send\x20webhook:\x20','parse','usdtTrcWallet','customer','25854yDVkIh','push','currency','usdtErcWallet','üìÖ\x20Final\x20date\x20range:\x20','shopId','365852xyVISH','usage','enable2FA','wallets','EXPIRED','count','defineProperty','Rapyd','üîê\x202FA\x20disabled\x20for\x20shop:\x20','\x20backup\x20codes','stringify','paymentId','crypto','../config/database','merchantUrl','filter','shop','reduce','getGatewayDisplayName','map','COMPLETED','gatewaySettings','this_week','updateWallets','webhookLog','./currencyService','üìä\x20Final\x20WHERE\x20conditions:','backupCodes','split','1861335FXBvNt','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','findUnique','erc20_usdc','30d','get','\x20USDT','test_gateway','26200644todiwK','last_week','getPaymentsByShop','randomBytes','length','3WTgKjc','\x20\x20\x20üíµ\x20Available\x20balance:\x20','getStatistics','setDate','isArray','publicKey','amountUSDT','updatePayment','CoinToPay','toLowerCase','generateBackupCodes','replace','splice','compare','log','...','üìÖ\x20Date\x20end:\x20','2FA\x20token\x20is\x20required','toUpperCase','statusCode','POST','getMonth','testWebhook','usdtPolygonWallet','update','currencyService','default','paid','createdAt','üìÖ\x20Custom\x20period:\x20','amountIsEditable','getTime','setup2FA','test','USDT\x20Polygon','\x20\x20\x20üìÖ\x20This\x20month:\x20','Error\x20parsing\x20webhook\x20events:','getPayments','qrcode','custom_','desc','__importDefault','30dLIoLk','dailyRevenue','usdcErcWallet','createPublicPayment','USDT\x20BSC','customerName','shopUrl','name','asc','amount','\x20to\x20','Shop\x20not\x20found','paymentGateways','lte','11Vteqxy','includes','maxPayments','getUTCDate','Invalid\x202FA\x20token'];a79_0x330b=function(){return _0x3c9c84;};return a79_0x330b();}Object[a79_0x24b02e(0x1ac)](exports,'__esModule',{'value':!![]}),exports[a79_0x24b02e(0x148)]=void 0x0;const database_1=__importDefault(require(a79_0x24b02e(0x1b3))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a79_0x24b02e(0x1b2))),speakeasy_1=__importDefault(require(a79_0x24b02e(0x146))),qrcode_1=__importDefault(require(a79_0x24b02e(0x115))),currencyService_1=require(a79_0x24b02e(0x1bf)),paymentService_1=require(a79_0x24b02e(0x18e)),gateway_1=require('../types/gateway');class ShopService{constructor(){const _0x4399b2=a79_0x24b02e;this[_0x4399b2(0x174)]=new paymentService_1['PaymentService']();}async[a79_0x24b02e(0x161)](_0x507fb0){const _0x516a4a=a79_0x24b02e,_0x57b3c8=await database_1[_0x516a4a(0x109)][_0x516a4a(0x1b6)][_0x516a4a(0x1c5)]({'where':{'id':_0x507fb0},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x57b3c8)throw new Error('Shop\x20not\x20found');let _0x3cba2f=[];if(_0x57b3c8['settings']?.['webhookEvents'])try{_0x3cba2f=Array['isArray'](_0x57b3c8[_0x516a4a(0x149)]['webhookEvents'])?_0x57b3c8[_0x516a4a(0x149)][_0x516a4a(0x192)]:JSON[_0x516a4a(0x19d)](_0x57b3c8[_0x516a4a(0x149)][_0x516a4a(0x192)]);}catch(_0x361869){console['error']('Error\x20parsing\x20webhook\x20events:',_0x361869),_0x3cba2f=[];}const _0x6dc338=gateway_1[_0x516a4a(0x12c)][_0x516a4a(0x1b5)](_0x7a2435=>_0x7a2435[_0x516a4a(0x181)])[_0x516a4a(0x1b9)](_0x288fca=>_0x288fca[_0x516a4a(0x120)]);let _0x28d5cd=_0x57b3c8['paymentGateways']?JSON['parse'](_0x57b3c8[_0x516a4a(0x125)]):[];return Array[_0x516a4a(0xf3)](_0x28d5cd)&&(_0x28d5cd=_0x28d5cd[_0x516a4a(0x1b9)](_0x2b3989=>_0x2b3989[_0x516a4a(0xfa)](/\s+/g,'_')[_0x516a4a(0xf8)]())[_0x516a4a(0x1b5)](_0x292f7a=>_0x6dc338[_0x516a4a(0x128)](_0x292f7a))),{'id':_0x57b3c8['id'],'fullName':_0x57b3c8['name'],'username':_0x57b3c8['username'],'telegramId':_0x57b3c8[_0x516a4a(0x145)],'merchantUrl':_0x57b3c8['shopUrl'],'gateways':_0x28d5cd,'gatewaySettings':_0x57b3c8[_0x516a4a(0x1bb)]?JSON[_0x516a4a(0x19d)](_0x57b3c8[_0x516a4a(0x1bb)]):null,'publicKey':_0x57b3c8[_0x516a4a(0xf4)],'webhookUrl':_0x57b3c8[_0x516a4a(0x149)]?.[_0x516a4a(0x187)]||null,'webhookEvents':_0x3cba2f,'wallets':{'usdtPolygonWallet':_0x57b3c8['usdtPolygonWallet'],'usdtTrcWallet':_0x57b3c8['usdtTrcWallet'],'usdtErcWallet':_0x57b3c8[_0x516a4a(0x1a3)],'usdcPolygonWallet':_0x57b3c8[_0x516a4a(0x154)],'usdcErcWallet':_0x57b3c8[_0x516a4a(0x11b)]},'status':_0x57b3c8[_0x516a4a(0x151)],'createdAt':_0x57b3c8['createdAt']};}async['updateShopProfile'](_0x52009b,_0x4cc354){const _0x493bf5=a79_0x24b02e,_0x52db20={};_0x4cc354[_0x493bf5(0x172)]&&(_0x52db20['name']=_0x4cc354[_0x493bf5(0x172)]);_0x4cc354[_0x493bf5(0x14d)]!==undefined&&(_0x52db20['telegram']=_0x4cc354[_0x493bf5(0x14d)]||null);_0x4cc354['merchantUrl']&&(_0x52db20[_0x493bf5(0x11f)]=_0x4cc354[_0x493bf5(0x1b4)]);_0x4cc354[_0x493bf5(0x142)]&&(_0x52db20['paymentGateways']=JSON['stringify'](_0x4cc354[_0x493bf5(0x142)]));_0x4cc354[_0x493bf5(0x1bb)]&&(_0x52db20[_0x493bf5(0x1bb)]=JSON[_0x493bf5(0x1b0)](_0x4cc354[_0x493bf5(0x1bb)]));_0x4cc354['wallets']&&(_0x4cc354[_0x493bf5(0x1a9)]['usdtPolygonWallet']!==undefined&&(_0x52db20[_0x493bf5(0x106)]=_0x4cc354[_0x493bf5(0x1a9)][_0x493bf5(0x106)]||null),_0x4cc354['wallets'][_0x493bf5(0x19e)]!==undefined&&(_0x52db20[_0x493bf5(0x19e)]=_0x4cc354[_0x493bf5(0x1a9)][_0x493bf5(0x19e)]||null),_0x4cc354[_0x493bf5(0x1a9)][_0x493bf5(0x1a3)]!==undefined&&(_0x52db20[_0x493bf5(0x1a3)]=_0x4cc354['wallets'][_0x493bf5(0x1a3)]||null),_0x4cc354[_0x493bf5(0x1a9)]['usdcPolygonWallet']!==undefined&&(_0x52db20['usdcPolygonWallet']=_0x4cc354['wallets'][_0x493bf5(0x154)]||null));const _0x2a1bc0=await database_1[_0x493bf5(0x109)]['shop'][_0x493bf5(0x107)]({'where':{'id':_0x52009b},'data':_0x52db20,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x11c36e=[];if(_0x2a1bc0[_0x493bf5(0x149)]?.[_0x493bf5(0x192)])try{_0x11c36e=Array['isArray'](_0x2a1bc0['settings'][_0x493bf5(0x192)])?_0x2a1bc0[_0x493bf5(0x149)][_0x493bf5(0x192)]:JSON['parse'](_0x2a1bc0[_0x493bf5(0x149)][_0x493bf5(0x192)]);}catch(_0xb6aed1){console['error'](_0x493bf5(0x113),_0xb6aed1),_0x11c36e=[];}return{'id':_0x2a1bc0['id'],'fullName':_0x2a1bc0[_0x493bf5(0x120)],'username':_0x2a1bc0[_0x493bf5(0x19a)],'telegramId':_0x2a1bc0['telegram'],'merchantUrl':_0x2a1bc0[_0x493bf5(0x11f)],'gateways':_0x2a1bc0[_0x493bf5(0x125)]?JSON[_0x493bf5(0x19d)](_0x2a1bc0[_0x493bf5(0x125)]):null,'gatewaySettings':_0x2a1bc0[_0x493bf5(0x1bb)]?JSON[_0x493bf5(0x19d)](_0x2a1bc0[_0x493bf5(0x1bb)]):null,'publicKey':_0x2a1bc0['publicKey'],'webhookUrl':_0x2a1bc0[_0x493bf5(0x149)]?.['webhookUrl']||null,'webhookEvents':_0x11c36e,'wallets':{'usdtPolygonWallet':_0x2a1bc0['usdtPolygonWallet'],'usdtTrcWallet':_0x2a1bc0[_0x493bf5(0x19e)],'usdtErcWallet':_0x2a1bc0[_0x493bf5(0x1a3)],'usdcPolygonWallet':_0x2a1bc0[_0x493bf5(0x154)],'usdcErcWallet':_0x2a1bc0[_0x493bf5(0x11b)]},'status':_0x2a1bc0[_0x493bf5(0x151)],'createdAt':_0x2a1bc0[_0x493bf5(0x10b)]};}async[a79_0x24b02e(0x1bd)](_0x2af1d9,_0x21849f){const _0x2a1c8a=a79_0x24b02e,_0x350a7e=await database_1[_0x2a1c8a(0x109)][_0x2a1c8a(0x1b6)][_0x2a1c8a(0x1c5)]({'where':{'id':_0x2af1d9},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x350a7e)throw new Error('Shop\x20not\x20found');if(_0x350a7e[_0x2a1c8a(0x156)]){if(!_0x21849f[_0x2a1c8a(0x160)])throw new Error(_0x2a1c8a(0x100));const _0x493611=speakeasy_1[_0x2a1c8a(0x109)][_0x2a1c8a(0x152)]['verify']({'secret':_0x350a7e[_0x2a1c8a(0x14b)],'encoding':_0x2a1c8a(0x182),'token':_0x21849f[_0x2a1c8a(0x160)],'window':0x2});if(!_0x493611){let _0x472d94=![];if(_0x350a7e[_0x2a1c8a(0x1c1)]){const _0x1da689=JSON[_0x2a1c8a(0x19d)](_0x350a7e[_0x2a1c8a(0x1c1)]);for(let _0x497f82=0x0;_0x497f82<_0x1da689['length'];_0x497f82++){const _0x4ea452=await bcryptjs_1['default'][_0x2a1c8a(0xfc)](_0x21849f[_0x2a1c8a(0x160)],_0x1da689[_0x497f82]);if(_0x4ea452){_0x472d94=!![],_0x1da689[_0x2a1c8a(0xfb)](_0x497f82,0x1),await database_1[_0x2a1c8a(0x109)][_0x2a1c8a(0x1b6)][_0x2a1c8a(0x107)]({'where':{'id':_0x2af1d9},'data':{'backupCodes':JSON[_0x2a1c8a(0x1b0)](_0x1da689)}});break;}}}if(!_0x472d94)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x108e05={};_0x21849f[_0x2a1c8a(0x106)]!==undefined&&(_0x108e05['usdtPolygonWallet']=_0x21849f['usdtPolygonWallet']||null),_0x21849f[_0x2a1c8a(0x19e)]!==undefined&&(_0x108e05[_0x2a1c8a(0x19e)]=_0x21849f['usdtTrcWallet']||null),_0x21849f[_0x2a1c8a(0x1a3)]!==undefined&&(_0x108e05[_0x2a1c8a(0x1a3)]=_0x21849f[_0x2a1c8a(0x1a3)]||null),_0x21849f['usdcPolygonWallet']!==undefined&&(_0x108e05[_0x2a1c8a(0x154)]=_0x21849f[_0x2a1c8a(0x154)]||null),_0x21849f[_0x2a1c8a(0x11b)]!==undefined&&(_0x108e05[_0x2a1c8a(0x11b)]=_0x21849f[_0x2a1c8a(0x11b)]||null),await database_1['default'][_0x2a1c8a(0x1b6)][_0x2a1c8a(0x107)]({'where':{'id':_0x2af1d9},'data':_0x108e05});}async[a79_0x24b02e(0x105)](_0x18aaa9){const _0x114108=a79_0x24b02e,_0x36b5bb=await database_1[_0x114108(0x109)]['shop'][_0x114108(0x1c5)]({'where':{'id':_0x18aaa9},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x36b5bb?.['settings']?.[_0x114108(0x187)])throw new Error(_0x114108(0x162));const _0x581dd9={'event':_0x114108(0x110),'payment':{'id':'test_payment_123','order_id':'test_order_123','gateway':_0x114108(0x110),'amount':0x64,'currency':'USD','status':_0x114108(0x10a),'created_at':new Date()['toISOString']()}};try{const _0x412b1f=await fetch(_0x36b5bb[_0x114108(0x149)]['webhookUrl'],{'method':_0x114108(0x103),'headers':{'Content-Type':'application/json','User-Agent':_0x114108(0x144)},'body':JSON[_0x114108(0x1b0)](_0x581dd9)});return _0x412b1f['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x412b1f['status']+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x412b1f[_0x114108(0x151)]+'\x20'+_0x412b1f[_0x114108(0x137)]};}catch(_0x106a6a){return{'success':![],'message':_0x114108(0x19c)+(_0x106a6a instanceof Error?_0x106a6a[_0x114108(0x141)]:_0x114108(0x17f))};}}async[a79_0x24b02e(0x12f)](_0x1a4d72){const _0x2a2ef3=a79_0x24b02e;return this[_0x2a2ef3(0x174)][_0x2a2ef3(0x11c)]({'public_key':'','gateway':_0x1a4d72[_0x2a2ef3(0x193)],'order_id':undefined,'amount':_0x1a4d72['amount'],'currency':_0x1a4d72[_0x2a2ef3(0x1a2)],'source_currency':_0x1a4d72['sourceCurrency'],'usage':_0x1a4d72[_0x2a2ef3(0x1a7)],'expires_at':_0x1a4d72[_0x2a2ef3(0x13e)]?.[_0x2a2ef3(0x15c)](),'success_url':_0x1a4d72[_0x2a2ef3(0x138)],'fail_url':_0x1a4d72[_0x2a2ef3(0x138)],'customer_email':_0x1a4d72['customerEmail'],'customer_name':_0x1a4d72[_0x2a2ef3(0x11e)],'country':_0x1a4d72['country'],'language':_0x1a4d72['language'],'amount_is_editable':_0x1a4d72[_0x2a2ef3(0x10d)],'max_payments':_0x1a4d72[_0x2a2ef3(0x129)],'customer':_0x1a4d72[_0x2a2ef3(0x19f)]});}async[a79_0x24b02e(0x114)](_0xf3538e,_0x28e100){const _0x147545=a79_0x24b02e;return this[_0x147545(0x174)][_0x147545(0xec)](_0xf3538e,_0x28e100);}async[a79_0x24b02e(0x18a)](_0x30dd85,_0xbbafd8){const _0x1d5a06=a79_0x24b02e;return this[_0x1d5a06(0x174)][_0x1d5a06(0x12e)](_0x30dd85,_0xbbafd8);}async[a79_0x24b02e(0xf6)](_0x16503b,_0xf4b3d2,_0x2655da){const _0x351911=a79_0x24b02e,_0x5aa9cb=await database_1['default'][_0x351911(0x13b)][_0x351911(0x18f)]({'where':{'id':_0xf4b3d2,'shopId':_0x16503b}});if(!_0x5aa9cb)throw new Error(_0x351911(0x16a));const _0x15d640=await database_1[_0x351911(0x109)][_0x351911(0x13b)][_0x351911(0x107)]({'where':{'id':_0xf4b3d2},'data':{..._0x2655da,'updatedAt':new Date()}});return _0x15d640;}async[a79_0x24b02e(0x147)](_0x155d0c,_0x5c9671){const _0x4f7586=a79_0x24b02e,_0x3fe7c5=await database_1[_0x4f7586(0x109)]['payment'][_0x4f7586(0x18f)]({'where':{'id':_0x5c9671,'shopId':_0x155d0c}});if(!_0x3fe7c5)throw new Error('Payment\x20not\x20found');await database_1[_0x4f7586(0x109)][_0x4f7586(0x13b)][_0x4f7586(0x16c)]({'where':{'id':_0x5c9671}});}['formatNetworkName'](_0x4d7621){const _0x25391d=a79_0x24b02e,_0x2ef2bd={'polygon':_0x25391d(0x111),'trc20':'USDT\x20TRC20','erc20':'USDT\x20ERC20','bsc':_0x25391d(0x11d),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x25391d(0x134)};return _0x2ef2bd[_0x4d7621]||_0x4d7621;}async[a79_0x24b02e(0x139)](_0x1e6284,_0x4bbec9){const _0x12dfe0=a79_0x24b02e,{page:_0x1096ae,limit:_0x14ccbe,status:_0x361dc1,method:_0x30685c,network:_0x4b799e,dateFrom:_0x4f477c,dateTo:_0x32cdbb,periodFrom:_0x3b2173,periodTo:_0x36329c}=_0x4bbec9,_0x118357=(_0x1096ae-0x1)*_0x14ccbe;console[_0x12dfe0(0xfd)](_0x12dfe0(0x176),_0x4bbec9);const _0x4452a3={'shopId':_0x1e6284};_0x361dc1&&(_0x4452a3['status']=_0x361dc1[_0x12dfe0(0x101)](),console[_0x12dfe0(0xfd)](_0x12dfe0(0x18d)+_0x361dc1[_0x12dfe0(0x101)]()));if(_0x30685c)_0x4452a3['network']=_0x30685c,console[_0x12dfe0(0xfd)]('üåê\x20Method\x20filter:\x20'+_0x30685c);else _0x4b799e&&(_0x4452a3[_0x12dfe0(0x155)]=_0x4b799e,console[_0x12dfe0(0xfd)](_0x12dfe0(0x153)+_0x4b799e));if(_0x4f477c||_0x32cdbb||_0x3b2173||_0x36329c){_0x4452a3[_0x12dfe0(0x10b)]={};if(_0x3b2173){const _0x24d8f0=new Date(_0x3b2173);_0x24d8f0[_0x12dfe0(0x170)](0x0,0x0,0x0,0x1),_0x4452a3[_0x12dfe0(0x10b)][_0x12dfe0(0x188)]=_0x24d8f0,console[_0x12dfe0(0xfd)](_0x12dfe0(0x15e)+_0x24d8f0[_0x12dfe0(0x15c)]());}else{if(_0x4f477c){const _0x5e897c=new Date(_0x4f477c);_0x5e897c[_0x12dfe0(0x170)](0x0,0x0,0x0,0x1),_0x4452a3[_0x12dfe0(0x10b)]['gte']=_0x5e897c,console[_0x12dfe0(0xfd)]('üìÖ\x20Date\x20start:\x20'+_0x5e897c[_0x12dfe0(0x15c)]());}}if(_0x36329c){const _0xe40cde=new Date(_0x36329c);_0xe40cde['setHours'](0x17,0x3b,0x3b,0x3e7),_0x4452a3[_0x12dfe0(0x10b)][_0x12dfe0(0x126)]=_0xe40cde,console['log'](_0x12dfe0(0x13c)+_0xe40cde[_0x12dfe0(0x15c)]());}else{if(_0x32cdbb){const _0xbc382e=new Date(_0x32cdbb);_0xbc382e[_0x12dfe0(0x170)](0x17,0x3b,0x3b,0x3e7),_0x4452a3[_0x12dfe0(0x10b)][_0x12dfe0(0x126)]=_0xbc382e,console[_0x12dfe0(0xfd)](_0x12dfe0(0xff)+_0xbc382e[_0x12dfe0(0x15c)]());}}}console[_0x12dfe0(0xfd)](_0x12dfe0(0x1c0),JSON[_0x12dfe0(0x1b0)](_0x4452a3,null,0x2));const [_0x54b197,_0x1820a9]=await Promise[_0x12dfe0(0x13d)]([database_1[_0x12dfe0(0x109)][_0x12dfe0(0x15f)]['findMany']({'where':_0x4452a3,'skip':_0x118357,'take':_0x14ccbe,'orderBy':{'createdAt':_0x12dfe0(0x117)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x12dfe0(0x109)]['payout']['count']({'where':_0x4452a3})]);return{'payouts':_0x54b197[_0x12dfe0(0x1b9)](_0x125018=>{const _0x21d93b=_0x12dfe0;let _0x916fa8=null;switch(_0x125018['network']){case'polygon':_0x916fa8=_0x125018[_0x21d93b(0x1b6)][_0x21d93b(0x106)];break;case _0x21d93b(0x143):_0x916fa8=_0x125018['shop'][_0x21d93b(0x19e)];break;case _0x21d93b(0x198):_0x916fa8=_0x125018[_0x21d93b(0x1b6)][_0x21d93b(0x1a3)];break;case _0x21d93b(0x185):_0x916fa8=_0x125018['shop'][_0x21d93b(0x154)];break;case _0x21d93b(0x1c6):_0x916fa8=_0x125018[_0x21d93b(0x1b6)][_0x21d93b(0x11b)];break;}return{'id':_0x125018['id'],'amount':_0x125018[_0x21d93b(0x122)],'network':this[_0x21d93b(0x195)](_0x125018[_0x21d93b(0x155)]),'wallet':_0x916fa8,'status':_0x125018[_0x21d93b(0x151)],'txid':_0x125018[_0x21d93b(0x194)],'notes':_0x125018[_0x21d93b(0x186)],'periodFrom':_0x125018['periodFrom'],'periodTo':_0x125018['periodTo'],'createdAt':_0x125018['createdAt'],'paidAt':_0x125018['paidAt']};}),'pagination':{'page':_0x1096ae,'limit':_0x14ccbe,'total':_0x1820a9,'totalPages':Math[_0x12dfe0(0x13f)](_0x1820a9/_0x14ccbe)}};}async[a79_0x24b02e(0x158)](_0x1875ba,_0x20b58b){const _0x3d7d32=a79_0x24b02e,_0x24a5e1=await database_1[_0x3d7d32(0x109)][_0x3d7d32(0x15f)][_0x3d7d32(0x18f)]({'where':{'id':_0x20b58b,'shopId':_0x1875ba}});if(!_0x24a5e1)return null;return{'id':_0x24a5e1['id'],'amount':_0x24a5e1['amount'],'network':_0x24a5e1[_0x3d7d32(0x155)],'status':_0x24a5e1['status'],'txid':_0x24a5e1['txid'],'notes':_0x24a5e1[_0x3d7d32(0x186)],'createdAt':_0x24a5e1[_0x3d7d32(0x10b)],'paidAt':_0x24a5e1[_0x3d7d32(0x16f)]};}async['getPayoutStatistics'](_0x5096cb,_0x5a9f2e){const _0x81e4c4=a79_0x24b02e,_0x485136=new Date();let _0x3bd22a,_0x231db9;switch(_0x5a9f2e){case _0x81e4c4(0x189):case'YESTERDAY':const _0x4fcd26=new Date(_0x485136);_0x4fcd26[_0x81e4c4(0xf2)](_0x4fcd26['getDate']()-0x1),_0x3bd22a=new Date(_0x4fcd26),_0x3bd22a[_0x81e4c4(0x170)](0x0,0x0,0x0,0x0),_0x231db9=new Date(_0x4fcd26),_0x231db9[_0x81e4c4(0x170)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x3bd22a=new Date(_0x485136['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x81e4c4(0x1c7):_0x3bd22a=new Date(_0x485136['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x81e4c4(0x179):_0x3bd22a=new Date(_0x485136[_0x81e4c4(0x10e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x3bd22a=new Date(_0x485136[_0x81e4c4(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x19ed07={'gte':_0x3bd22a};_0x231db9&&(_0x19ed07['lte']=_0x231db9);const [_0x2ce3d4,_0x24d4a6,_0x41f08,_0x12acba,_0x5ef2ee,_0x52f316]=await Promise[_0x81e4c4(0x13d)]([database_1[_0x81e4c4(0x109)]['payout'][_0x81e4c4(0x1ab)]({'where':{'shopId':_0x5096cb,'createdAt':_0x19ed07}}),database_1[_0x81e4c4(0x109)][_0x81e4c4(0x15f)][_0x81e4c4(0x1ab)]({'where':{'shopId':_0x5096cb,'status':_0x81e4c4(0x1ba),'createdAt':_0x19ed07}}),database_1[_0x81e4c4(0x109)][_0x81e4c4(0x15f)][_0x81e4c4(0x1ab)]({'where':{'shopId':_0x5096cb,'status':_0x81e4c4(0x157),'createdAt':_0x19ed07}}),database_1['default'][_0x81e4c4(0x15f)][_0x81e4c4(0x1ab)]({'where':{'shopId':_0x5096cb,'status':_0x81e4c4(0x14e),'createdAt':_0x19ed07}}),database_1['default'][_0x81e4c4(0x15f)][_0x81e4c4(0x14c)]({'where':{'shopId':_0x5096cb,'createdAt':_0x19ed07},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x81e4c4(0x109)][_0x81e4c4(0x15f)][_0x81e4c4(0x14c)]({'where':{'shopId':_0x5096cb},'take':0xa,'orderBy':{'createdAt':_0x81e4c4(0x117)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x5317ca=_0x5ef2ee[_0x81e4c4(0x1b7)]((_0x29d906,_0x2e07e6)=>_0x29d906+_0x2e07e6['amount'],0x0),_0x58a308=_0x5ef2ee[_0x81e4c4(0x1b5)](_0x3eedec=>_0x3eedec['status']===_0x81e4c4(0x1ba))['reduce']((_0x25faeb,_0x476a9f)=>_0x25faeb+_0x476a9f[_0x81e4c4(0x122)],0x0),_0x5db16b=_0x5ef2ee[_0x81e4c4(0x1b5)](_0x5cf1f0=>_0x5cf1f0[_0x81e4c4(0x151)]===_0x81e4c4(0x157))[_0x81e4c4(0x1b7)]((_0x112e95,_0x1492dd)=>_0x112e95+_0x1492dd['amount'],0x0),_0x3a871f=_0x5ef2ee['reduce']((_0x1ead7a,_0x1f7171)=>{const _0x4ced76=_0x81e4c4;return _0x1ead7a[_0x1f7171[_0x4ced76(0x155)]]=(_0x1ead7a[_0x1f7171[_0x4ced76(0x155)]]||0x0)+0x1,_0x1ead7a;},{}),_0x414911=_0x5ef2ee[_0x81e4c4(0x1b7)]((_0x18bfe9,_0x2301a7)=>{const _0x54adec=_0x81e4c4;return _0x18bfe9[_0x2301a7[_0x54adec(0x151)]]=(_0x18bfe9[_0x2301a7[_0x54adec(0x151)]]||0x0)+0x1,_0x18bfe9;},{});return{'totalPayouts':_0x2ce3d4,'completedPayouts':_0x24d4a6,'pendingPayouts':_0x41f08,'rejectedPayouts':_0x12acba,'totalAmount':_0x5317ca,'completedAmount':_0x58a308,'pendingAmount':_0x5db16b,'payoutsByMethod':_0x3a871f,'payoutsByStatus':_0x414911,'recentPayouts':_0x52f316[_0x81e4c4(0x1b9)](_0xdda75f=>({'id':_0xdda75f['id'],'shopId':_0x5096cb,'amount':_0xdda75f[_0x81e4c4(0x122)],'method':_0xdda75f[_0x81e4c4(0x155)],'status':_0xdda75f[_0x81e4c4(0x151)],'txid':_0xdda75f[_0x81e4c4(0x194)],'createdAt':_0xdda75f[_0x81e4c4(0x10b)],'paidAt':_0xdda75f['paidAt']}))};}async['getShopPayoutStats'](_0x45bdae){const _0x470d69=a79_0x24b02e;console[_0x470d69(0xfd)]('üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x45bdae+_0x470d69(0xfe));const _0x196f10=await database_1['default']['shop'][_0x470d69(0x1c5)]({'where':{'id':_0x45bdae},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x196f10)throw new Error(_0x470d69(0x124));const _0x5af6a1=new Date(),_0x110c2f=new Date(_0x5af6a1[_0x470d69(0x132)](),_0x5af6a1[_0x470d69(0x104)](),0x1),_0x20d136=new Date(_0x5af6a1[_0x470d69(0x132)](),_0x5af6a1[_0x470d69(0x104)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1a41ab=await database_1[_0x470d69(0x109)][_0x470d69(0x15f)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x45bdae,'createdAt':{'gte':_0x110c2f,'lte':_0x20d136},'status':_0x470d69(0x1ba)}}),_0x2a5845=_0x1a41ab[_0x470d69(0x16b)][_0x470d69(0x122)]||0x0,_0xbb5ee1={'availableBalance':Math[_0x470d69(0x178)](_0x196f10['balance']*0x64)/0x64,'totalPaidOut':Math['round'](_0x196f10['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math['round'](_0x196f10[_0x470d69(0x135)]*0x64)/0x64,'thisMonth':Math['round'](_0x2a5845*0x64)/0x64};return console['log']('üìä\x20Shop\x20'+_0x196f10[_0x470d69(0x19a)]+'\x20payout\x20statistics\x20calculated:'),console[_0x470d69(0xfd)](_0x470d69(0xf0)+_0xbb5ee1[_0x470d69(0x191)]+_0x470d69(0x131)),console[_0x470d69(0xfd)](_0x470d69(0x19b)+_0xbb5ee1['totalPaidOut']+'\x20USDT\x20(total\x20payouts)'),console[_0x470d69(0xfd)](_0x470d69(0x1c4)+_0xbb5ee1[_0x470d69(0x13a)]+_0x470d69(0x131)),console[_0x470d69(0xfd)](_0x470d69(0x112)+_0xbb5ee1[_0x470d69(0x130)]+_0x470d69(0x1c9)),_0xbb5ee1;}[a79_0x24b02e(0x1b8)](_0x13b4d9){const _0x79ad1d=a79_0x24b02e,_0x49c7ad={'test_gateway':_0x79ad1d(0x14a),'plisio':'Plisio','rapyd':_0x79ad1d(0x1ad),'noda':_0x79ad1d(0x173),'cointopay':_0x79ad1d(0xf7),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x79ad1d(0x165),'klyme_de':'KLYME\x20DE'};return _0x49c7ad[_0x13b4d9]||_0x13b4d9;}async[a79_0x24b02e(0x140)](_0x2c5431){return this['getShopPayoutStats'](_0x2c5431);}async[a79_0x24b02e(0x150)](_0x318122,_0x54c2c4){const _0x5d33f6=a79_0x24b02e,{page:_0x474e55,limit:_0x4df957,paymentId:_0x3b9d81}=_0x54c2c4,_0x1d111f=(_0x474e55-0x1)*_0x4df957,_0x259a31={'shopId':_0x318122};_0x3b9d81&&(_0x259a31['paymentId']=_0x3b9d81);const [_0x590157,_0x5a3a8e]=await Promise[_0x5d33f6(0x13d)]([database_1['default'][_0x5d33f6(0x1be)][_0x5d33f6(0x14c)]({'where':_0x259a31,'skip':_0x1d111f,'take':_0x4df957,'orderBy':{'createdAt':_0x5d33f6(0x117)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x5d33f6(0x109)]['webhookLog'][_0x5d33f6(0x1ab)]({'where':_0x259a31})]);return{'logs':_0x590157[_0x5d33f6(0x1b9)](_0x48bfe7=>({'id':_0x48bfe7['id'],'paymentId':_0x48bfe7[_0x5d33f6(0x1b1)],'shopId':_0x48bfe7[_0x5d33f6(0x1a5)],'event':_0x48bfe7[_0x5d33f6(0x190)],'statusCode':_0x48bfe7[_0x5d33f6(0x102)],'retryCount':_0x48bfe7['retryCount'],'responseBody':_0x48bfe7['responseBody'],'createdAt':_0x48bfe7[_0x5d33f6(0x10b)],'payment':_0x48bfe7[_0x5d33f6(0x13b)]})),'pagination':{'page':_0x474e55,'limit':_0x4df957,'total':_0x5a3a8e,'totalPages':Math[_0x5d33f6(0x13f)](_0x5a3a8e/_0x4df957)}};}async[a79_0x24b02e(0xf1)](_0x35e431,_0x182ca1,_0x7d09f9,_0x14593c,_0x271d99){const _0x46a303=a79_0x24b02e;console[_0x46a303(0xfd)](_0x46a303(0x196)+_0x35e431+',\x20period:\x20'+_0x182ca1+_0x46a303(0x16e)+_0x7d09f9+_0x46a303(0x167)+_0x14593c);const _0x4fe83e=_0x271d99?new Date(_0x271d99):new Date();let _0x44ce2b,_0x19bf18;if(_0x7d09f9&&_0x14593c){const _0x163a9b=new Date(_0x7d09f9),_0xe0067a=new Date(_0x14593c);_0x44ce2b=new Date(Date['UTC'](_0x163a9b['getUTCFullYear'](),_0x163a9b[_0x46a303(0x199)](),_0x163a9b[_0x46a303(0x12a)](),0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0xe0067a['getUTCFullYear'](),_0xe0067a[_0x46a303(0x199)](),_0xe0067a[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7)),console[_0x46a303(0xfd)](_0x46a303(0x17a)+_0x44ce2b[_0x46a303(0x15c)]()+_0x46a303(0x123)+_0x19bf18[_0x46a303(0x15c)]());}else{if(_0x182ca1&&_0x182ca1['startsWith']('custom_')){const _0xdbfae2=_0x182ca1[_0x46a303(0xfa)](_0x46a303(0x116),'')[_0x46a303(0x1c2)]('_');if(_0xdbfae2['length']===0x2){const _0xae3376=new Date(_0xdbfae2[0x0]),_0x21f755=new Date(_0xdbfae2[0x1]);_0x44ce2b=new Date(Date['UTC'](_0xae3376['getUTCFullYear'](),_0xae3376[_0x46a303(0x199)](),_0xae3376[_0x46a303(0x12a)](),0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x21f755[_0x46a303(0x183)](),_0x21f755[_0x46a303(0x199)](),_0x21f755[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7)),console[_0x46a303(0xfd)](_0x46a303(0x10c)+_0x44ce2b['toISOString']()+_0x46a303(0x123)+_0x19bf18[_0x46a303(0x15c)]());}else{const _0x40703c=new Date(Date['UTC'](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x4fe83e[_0x46a303(0x12a)]()-0x1e));_0x44ce2b=new Date(Date[_0x46a303(0x17b)](_0x40703c[_0x46a303(0x183)](),_0x40703c[_0x46a303(0x199)](),_0x40703c[_0x46a303(0x12a)](),0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x4fe83e['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x2f301a=_0x182ca1||_0x46a303(0x16d);switch(_0x2f301a[_0x46a303(0xf8)]()){case _0x46a303(0x163):_0x44ce2b=new Date(Date[_0x46a303(0x17b)](_0x4fe83e['getUTCFullYear'](),_0x4fe83e['getUTCMonth'](),_0x4fe83e['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x4fe83e[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;case _0x46a303(0x189):const _0x413d1f=new Date(_0x4fe83e);_0x413d1f[_0x46a303(0x180)](_0x413d1f[_0x46a303(0x12a)]()-0x1),_0x44ce2b=new Date(Date[_0x46a303(0x17b)](_0x413d1f[_0x46a303(0x183)](),_0x413d1f[_0x46a303(0x199)](),_0x413d1f['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x413d1f[_0x46a303(0x183)](),_0x413d1f[_0x46a303(0x199)](),_0x413d1f[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;case _0x46a303(0x1bc):const _0x59a432=_0x4fe83e[_0x46a303(0x171)](),_0x37145f=_0x59a432===0x0?-0x6:0x1-_0x59a432,_0x275cf7=_0x4fe83e['getUTCDate']()+_0x37145f;_0x44ce2b=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x275cf7,0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x4fe83e[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;case _0x46a303(0x1cc):const _0x20ddd6=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x4fe83e[_0x46a303(0x12a)]()-0x7)),_0x509036=_0x20ddd6[_0x46a303(0x171)](),_0x344068=_0x509036===0x0?-0x6:0x1-_0x509036,_0xb7daaf=_0x20ddd6[_0x46a303(0x12a)]()+_0x344068;_0x44ce2b=new Date(Date['UTC'](_0x20ddd6[_0x46a303(0x183)](),_0x20ddd6[_0x46a303(0x199)](),_0xb7daaf,0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x20ddd6['getUTCFullYear'](),_0x20ddd6[_0x46a303(0x199)](),_0xb7daaf+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x44ce2b=new Date(Date['UTC'](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),0x1,0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e['getUTCMonth'](),_0x4fe83e[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;case _0x46a303(0x175):_0x44ce2b=new Date(Date[_0x46a303(0x17b)](_0x4fe83e['getUTCFullYear'](),_0x4fe83e[_0x46a303(0x199)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x44ce2b=new Date(Date[_0x46a303(0x17b)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date['UTC'](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x4fe83e[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x44ce2b=new Date(Date[_0x46a303(0x17b)](_0x4fe83e['getUTCFullYear'](),_0x4fe83e[_0x46a303(0x199)](),0x1,0x0,0x0,0x0,0x0)),_0x19bf18=new Date(Date[_0x46a303(0x17b)](_0x4fe83e[_0x46a303(0x183)](),_0x4fe83e[_0x46a303(0x199)](),_0x4fe83e[_0x46a303(0x12a)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x46a303(0xfd)](_0x46a303(0x1a4)+_0x44ce2b['toISOString']()+_0x46a303(0x123)+_0x19bf18[_0x46a303(0x15c)]());const _0x4b3e25={'gte':_0x44ce2b,'lte':_0x19bf18},[_0x25c412,_0x3571c9,_0x5ce1ff,_0x36a4ac,_0x14c79a,_0x3e1ce1,_0x14016a,_0xb5a67,_0xf2716a,_0x13d0b0]=await Promise[_0x46a303(0x13d)]([database_1[_0x46a303(0x109)][_0x46a303(0x13b)][_0x46a303(0x1ab)]({'where':{'shopId':_0x35e431,'gateway':{'not':_0x46a303(0x1ca)},'status':{'notIn':[_0x46a303(0x157),_0x46a303(0x1aa)]},'createdAt':_0x4b3e25}}),database_1[_0x46a303(0x109)][_0x46a303(0x13b)]['count']({'where':{'shopId':_0x35e431,'gateway':{'not':_0x46a303(0x1ca)},'status':_0x46a303(0x184),'createdAt':_0x4b3e25}}),database_1[_0x46a303(0x109)][_0x46a303(0x13b)][_0x46a303(0x1ab)]({'where':{'shopId':_0x35e431,'gateway':{'not':'test_gateway'},'status':_0x46a303(0x136)}}),database_1[_0x46a303(0x109)]['payment'][_0x46a303(0x1ab)]({'where':{'shopId':_0x35e431,'gateway':{'not':_0x46a303(0x1ca)},'status':_0x46a303(0x15a)}}),database_1[_0x46a303(0x109)][_0x46a303(0x13b)][_0x46a303(0x14c)]({'where':{'shopId':_0x35e431,'gateway':{'not':'test_gateway'},'status':_0x46a303(0x184),'createdAt':_0x4b3e25},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x46a303(0x109)][_0x46a303(0x13b)][_0x46a303(0x14c)]({'where':{'shopId':_0x35e431,'gateway':{'not':_0x46a303(0x1ca)}},'take':0xa,'orderBy':{'createdAt':_0x46a303(0x117)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x46a303(0x13b)]['findMany']({'where':{'shopId':_0x35e431,'gateway':{'not':_0x46a303(0x1ca)},'createdAt':_0x4b3e25},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x46a303(0x121)}}),database_1[_0x46a303(0x109)][_0x46a303(0x13b)][_0x46a303(0x1ab)]({'where':{'shopId':_0x35e431,'gateway':{'not':_0x46a303(0x1ca)},'status':_0x46a303(0x184)}}),database_1[_0x46a303(0x109)][_0x46a303(0x13b)][_0x46a303(0x14c)]({'where':{'shopId':_0x35e431,'gateway':{'not':'test_gateway'},'status':'PAID'},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x46a303(0x109)][_0x46a303(0x1b6)][_0x46a303(0x1c5)]({'where':{'id':_0x35e431},'select':{'balance':!![]}})]);let _0x49d6fc=0x0,_0x47e1c2=0x0;for(const _0x582e5c of _0x14c79a){if(_0x582e5c['amountUSDT'])_0x49d6fc+=_0x582e5c['amountUSDT'];else{const _0x4e5120=await currencyService_1[_0x46a303(0x108)][_0x46a303(0x18b)](_0x582e5c[_0x46a303(0x122)],_0x582e5c['currency']);_0x49d6fc+=_0x4e5120;}_0x582e5c[_0x46a303(0x166)]&&(_0x47e1c2+=_0x582e5c[_0x46a303(0x166)]);}let _0x573bce=0x0;for(const _0x247299 of _0xf2716a){_0x247299[_0x46a303(0x166)]&&(_0x573bce+=_0x247299[_0x46a303(0x166)]);}const _0x3d94c3=this[_0x46a303(0x12d)](_0x14016a,_0x44ce2b,_0x19bf18||_0x4fe83e),_0x521ffa=_0x25c412>0x0?_0x3571c9/_0x25c412*0x64:0x0,_0x1607b0=_0xb5a67>0x0?_0x5ce1ff/_0xb5a67*0x64:0x0;return{'totalPayments':_0x25c412,'successfulPayments':_0x3571c9,'totalRevenue':Math[_0x46a303(0x178)](_0x49d6fc*0x64)/0x64,'merchantEarnings':Math[_0x46a303(0x178)](_0x47e1c2*0x64)/0x64,'merchantTotalRevenue':Math[_0x46a303(0x178)](_0x573bce*0x64)/0x64,'payoutBalance':Math['round']((_0x13d0b0?.[_0x46a303(0x135)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x46a303(0x178)](_0x521ffa*0x64)/0x64,'chargebackRate':Math[_0x46a303(0x178)](_0x1607b0*0x64)/0x64,'chargebacks':_0x5ce1ff,'refunds':_0x36a4ac,'dailyRevenue':_0x3d94c3[_0x46a303(0x11a)],'dailyPayments':_0x3d94c3[_0x46a303(0x14f)],'recentPayments':_0x3e1ce1[_0x46a303(0x1b9)](_0x48b81d=>({'id':_0x48b81d['id'],'gateway':_0x48b81d['gateway'],'amount':_0x48b81d[_0x46a303(0x122)],'currency':_0x48b81d['currency'],'status':_0x48b81d[_0x46a303(0x151)],'createdAt':_0x48b81d[_0x46a303(0x10b)]}))};}[a79_0x24b02e(0x12d)](_0x1325f7,_0x325c3c,_0x518f45){const _0x2ce3e8=a79_0x24b02e,_0x134416=new Map(),_0x5ee80a=new Date(_0x325c3c);while(_0x5ee80a<=_0x518f45){const _0x4f2b01=_0x5ee80a['toISOString']()[_0x2ce3e8(0x1c2)]('T')[0x0];_0x134416['set'](_0x4f2b01,{'revenue':0x0,'count':0x0}),_0x5ee80a[_0x2ce3e8(0xf2)](_0x5ee80a['getDate']()+0x1);}for(const _0x100856 of _0x1325f7){const _0x2ada45=_0x100856[_0x2ce3e8(0x10b)][_0x2ce3e8(0x15c)]()[_0x2ce3e8(0x1c2)]('T')[0x0],_0x594fd9=_0x134416[_0x2ce3e8(0x1c8)](_0x2ada45);_0x594fd9&&(_0x594fd9[_0x2ce3e8(0x1ab)]+=0x1,_0x100856['status']===_0x2ce3e8(0x184)&&_0x100856[_0x2ce3e8(0xf5)]&&(_0x594fd9['revenue']+=_0x100856[_0x2ce3e8(0xf5)]));}const _0x2f01eb=[],_0x4dae34=[];for(const [_0x58bb1d,_0x3002ea]of _0x134416){_0x2f01eb[_0x2ce3e8(0x1a1)]({'date':_0x58bb1d,'amount':Math[_0x2ce3e8(0x178)](_0x3002ea['revenue']*0x64)/0x64}),_0x4dae34['push']({'date':_0x58bb1d,'count':_0x3002ea[_0x2ce3e8(0x1ab)]});}return{'dailyRevenue':_0x2f01eb,'dailyPayments':_0x4dae34};}[a79_0x24b02e(0xf9)](_0x1c8297=0x8){const _0x32e117=a79_0x24b02e,_0x4f0f24=[];for(let _0x26122b=0x0;_0x26122b<_0x1c8297;_0x26122b++){const _0x4ff3bb=crypto_1[_0x32e117(0x109)][_0x32e117(0xed)](0x4)['toString']('hex')[_0x32e117(0x101)]();_0x4f0f24[_0x32e117(0x1a1)](_0x4ff3bb);}return _0x4f0f24;}async[a79_0x24b02e(0x10f)](_0x2c7974){const _0x2e2c0f=a79_0x24b02e,_0x3c4533=await database_1['default'][_0x2e2c0f(0x1b6)]['findUnique']({'where':{'id':_0x2c7974},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x3c4533)throw new Error(_0x2e2c0f(0x124));const _0x2857c4=speakeasy_1[_0x2e2c0f(0x109)][_0x2e2c0f(0x169)]({'name':_0x2e2c0f(0x17d)+_0x3c4533[_0x2e2c0f(0x19a)]+')','issuer':'TrapaPay','length':0x20}),_0x10f4fd=await qrcode_1[_0x2e2c0f(0x109)][_0x2e2c0f(0x164)](_0x2857c4[_0x2e2c0f(0x17e)]),_0x29eda6=this['generateBackupCodes'](0x8),_0x454cd6=await Promise['all'](_0x29eda6['map'](_0x37f995=>bcryptjs_1[_0x2e2c0f(0x109)]['hash'](_0x37f995,0xa)));return await database_1[_0x2e2c0f(0x109)][_0x2e2c0f(0x1b6)][_0x2e2c0f(0x107)]({'where':{'id':_0x2c7974},'data':{'twoFactorSecret':_0x2857c4['base32'],'backupCodes':JSON['stringify'](_0x454cd6)}}),console['log']('üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x3c4533[_0x2e2c0f(0x19a)]),console['log'](_0x2e2c0f(0x133)+_0x29eda6[_0x2e2c0f(0xee)]+_0x2e2c0f(0x1af)),{'secret':_0x2857c4[_0x2e2c0f(0x182)],'qrCode':_0x10f4fd,'manualEntryKey':_0x2857c4[_0x2e2c0f(0x182)],'backupCodes':_0x29eda6};}async[a79_0x24b02e(0x1a8)](_0x14b868,_0x2f82f2){const _0x3e9a4d=a79_0x24b02e,_0x5cc381=await database_1[_0x3e9a4d(0x109)]['shop']['findUnique']({'where':{'id':_0x14b868},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x5cc381)throw new Error(_0x3e9a4d(0x124));if(!_0x5cc381[_0x3e9a4d(0x14b)])throw new Error(_0x3e9a4d(0x159));if(_0x5cc381[_0x3e9a4d(0x156)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x5361bf=speakeasy_1[_0x3e9a4d(0x109)]['totp']['verify']({'secret':_0x5cc381['twoFactorSecret'],'encoding':'base32','token':_0x2f82f2,'window':0x2});if(!_0x5361bf)throw new Error(_0x3e9a4d(0x12b));return await database_1['default'][_0x3e9a4d(0x1b6)][_0x3e9a4d(0x107)]({'where':{'id':_0x14b868},'data':{'twoFactorEnabled':!![]}}),console[_0x3e9a4d(0xfd)](_0x3e9a4d(0x18c)+_0x5cc381['username']),{'enabled':!![]};}async['disable2FA'](_0x24bcd8){const _0x1a8406=a79_0x24b02e,_0x47329d=await database_1['default']['shop'][_0x1a8406(0x1c5)]({'where':{'id':_0x24bcd8},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x47329d)throw new Error(_0x1a8406(0x124));await database_1['default'][_0x1a8406(0x1b6)][_0x1a8406(0x107)]({'where':{'id':_0x24bcd8},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x1a8406(0xfd)](_0x1a8406(0x1ae)+_0x47329d[_0x1a8406(0x19a)]);}}exports[a79_0x24b02e(0x148)]=ShopService;