'use strict';const a53_0x1b130a=a53_0x4e24;(function(_0x3aae9e,_0x2cabf3){const _0x2c80bb=a53_0x4e24,_0x50fd8b=_0x3aae9e();while(!![]){try{const _0x4de8d4=parseInt(_0x2c80bb(0x14b))/0x1*(-parseInt(_0x2c80bb(0x152))/0x2)+-parseInt(_0x2c80bb(0x17a))/0x3*(parseInt(_0x2c80bb(0x100))/0x4)+parseInt(_0x2c80bb(0x116))/0x5*(parseInt(_0x2c80bb(0x143))/0x6)+-parseInt(_0x2c80bb(0x13a))/0x7*(parseInt(_0x2c80bb(0xf9))/0x8)+-parseInt(_0x2c80bb(0xfb))/0x9*(parseInt(_0x2c80bb(0x120))/0xa)+parseInt(_0x2c80bb(0x16e))/0xb*(parseInt(_0x2c80bb(0x11a))/0xc)+parseInt(_0x2c80bb(0x14d))/0xd;if(_0x4de8d4===_0x2cabf3)break;else _0x50fd8b['push'](_0x50fd8b['shift']());}catch(_0x57d917){_0x50fd8b['push'](_0x50fd8b['shift']());}}}(a53_0xab8d,0xab171));function a53_0xab8d(){const _0x212b09=['webhookEvents','gateway','revenue','CoinToPay','getShopPayoutStats','all','570581kZhaiT','default','desc','gatewaySettings','log','getFullYear','shop','\x20USDT','_sum','expiresAt','status','__importDefault','54YEekDL','wallets','testWebhook','polygon_usdc','awaitingPayout','webhookLog','Test\x20webhook\x20sent\x20successfully\x20(','currencyService','PENDING','ceil','totalPaidOut','gte','getPayoutById','getPaymentsByShop','toISOString','Shop\x20not\x20found','./currencyService','periodFrom','USDC\x20Polygon','KLYME\x20DE','customerEmail','Error\x20parsing\x20webhook\x20events:','\x20payout\x20statistics\x20calculated:','\x20USDT\x20(current\x20balance)','Webhook\x20returned\x20error:\x20','amount','Plisio','message','redirectUrl','Payment\x20not\x20found','merchantUrl','\x20USDT\x20(total\x20payouts)','8kaDyEB','findUnique','10179747vBjiXM','getGatewayDisplayName','trc20','webhookUrl','getPayouts','278228vCMZnH','parse','...','\x20\x20\x20📅\x20This\x20month:\x20','Failed\x20to\x20send\x20webhook:\x20','usdcPolygonWallet','payment','\x20\x20\x20💵\x20Available\x20balance:\x20','TesSoft\x20Payment\x20System/1.0\x20(Test)','statusText','getPaymentByShopAndId','findMany','KLYME\x20EU','customer','usdtPolygonWallet','notes','30d','paidAt','updateWallets','toUpperCase','findFirst','createdAt','5oNHmjJ','📊\x20Shop\x20','periodTo','USDT\x20TRC20','144MmwiPU','formatNetworkName','asc','responseBody','isArray','country','10ZKzHWI','REJECTED','USDT\x20ERC20','usdtErcWallet','USDT\x20Polygon','../config/database','stringify','split','COMPLETED','generateDailyStatistics','Unknown\x20error','round','lte','ShopService','getPayoutStats','network','getMonth','PaymentService','customerName','__esModule','map','USD','paid','maxPayments','publicKey','test_gateway','6116446ZjnxGp','defineProperty','paymentGateways','currency','thisMonth','shopUrl','getShopProfile','Test\x20Gateway','get','4160490fgTmFG','payout','gateways','name','set','application/json','aggregate','balance','5671cKPNuO','filter','44664685eXkTjf','txid','KLYME\x20GB','username','count','280kgGeTi','update','📊\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','paymentService','error','PAID','paymentId','event','fullName','usdtTrcWallet','statusCode','amountUSDT','settings','getTime','getDate','POST','sourceCurrency','erc20','90d','reduce','telegram','push'];a53_0xab8d=function(){return _0x212b09;};return a53_0xab8d();}var __importDefault=this&&this[a53_0x1b130a(0x179)]||function(_0x58f5f1){return _0x58f5f1&&_0x58f5f1['__esModule']?_0x58f5f1:{'default':_0x58f5f1};};Object[a53_0x1b130a(0x13b)](exports,a53_0x1b130a(0x133),{'value':!![]}),exports[a53_0x1b130a(0x12d)]=void 0x0;const database_1=__importDefault(require(a53_0x1b130a(0x125))),currencyService_1=require(a53_0x1b130a(0xe9)),paymentService_1=require('./paymentService');function a53_0x4e24(_0x4bceb0,_0x1d925a){const _0xab8dd=a53_0xab8d();return a53_0x4e24=function(_0x4e24b3,_0x366618){_0x4e24b3=_0x4e24b3-0xe9;let _0x576ec7=_0xab8dd[_0x4e24b3];return _0x576ec7;},a53_0x4e24(_0x4bceb0,_0x1d925a);}class ShopService{constructor(){const _0x4b64ab=a53_0x1b130a;this[_0x4b64ab(0x155)]=new paymentService_1[(_0x4b64ab(0x131))]();}async[a53_0x1b130a(0x140)](_0x16b6df){const _0x232add=a53_0x1b130a,_0x12b4a4=await database_1[_0x232add(0x16f)]['shop'][_0x232add(0xfa)]({'where':{'id':_0x16b6df},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x12b4a4)throw new Error(_0x232add(0x189));let _0x25bea8=[];if(_0x12b4a4[_0x232add(0x15e)]?.[_0x232add(0x168)])try{_0x25bea8=Array[_0x232add(0x11e)](_0x12b4a4[_0x232add(0x15e)][_0x232add(0x168)])?_0x12b4a4[_0x232add(0x15e)][_0x232add(0x168)]:JSON['parse'](_0x12b4a4[_0x232add(0x15e)][_0x232add(0x168)]);}catch(_0x23d03b){console[_0x232add(0x156)](_0x232add(0xee),_0x23d03b),_0x25bea8=[];}return{'id':_0x12b4a4['id'],'fullName':_0x12b4a4['name'],'username':_0x12b4a4[_0x232add(0x150)],'telegramId':_0x12b4a4['telegram'],'merchantUrl':_0x12b4a4[_0x232add(0x13f)],'gateways':_0x12b4a4[_0x232add(0x13c)]?JSON[_0x232add(0x101)](_0x12b4a4['paymentGateways']):null,'gatewaySettings':_0x12b4a4['gatewaySettings']?JSON[_0x232add(0x101)](_0x12b4a4[_0x232add(0x171)]):null,'publicKey':_0x12b4a4['publicKey'],'webhookUrl':_0x12b4a4[_0x232add(0x15e)]?.[_0x232add(0xfe)]||null,'webhookEvents':_0x25bea8,'wallets':{'usdtPolygonWallet':_0x12b4a4[_0x232add(0x10e)],'usdtTrcWallet':_0x12b4a4[_0x232add(0x15b)],'usdtErcWallet':_0x12b4a4[_0x232add(0x123)],'usdcPolygonWallet':_0x12b4a4[_0x232add(0x105)]},'status':_0x12b4a4[_0x232add(0x178)],'createdAt':_0x12b4a4[_0x232add(0x115)]};}async['updateShopProfile'](_0x33dd07,_0xb11c56){const _0x56f6c9=a53_0x1b130a,_0x5bb26e={};_0xb11c56[_0x56f6c9(0x15a)]&&(_0x5bb26e['name']=_0xb11c56[_0x56f6c9(0x15a)]);_0xb11c56['telegramId']!==undefined&&(_0x5bb26e[_0x56f6c9(0x166)]=_0xb11c56['telegramId']||null);_0xb11c56['merchantUrl']&&(_0x5bb26e['shopUrl']=_0xb11c56[_0x56f6c9(0xf7)]);_0xb11c56['gateways']&&(_0x5bb26e[_0x56f6c9(0x13c)]=JSON[_0x56f6c9(0x126)](_0xb11c56[_0x56f6c9(0x145)]));_0xb11c56[_0x56f6c9(0x171)]&&(_0x5bb26e['gatewaySettings']=JSON[_0x56f6c9(0x126)](_0xb11c56[_0x56f6c9(0x171)]));_0xb11c56['wallets']&&(_0xb11c56['wallets'][_0x56f6c9(0x10e)]!==undefined&&(_0x5bb26e[_0x56f6c9(0x10e)]=_0xb11c56[_0x56f6c9(0x17b)][_0x56f6c9(0x10e)]||null),_0xb11c56['wallets']['usdtTrcWallet']!==undefined&&(_0x5bb26e[_0x56f6c9(0x15b)]=_0xb11c56[_0x56f6c9(0x17b)]['usdtTrcWallet']||null),_0xb11c56[_0x56f6c9(0x17b)]['usdtErcWallet']!==undefined&&(_0x5bb26e[_0x56f6c9(0x123)]=_0xb11c56[_0x56f6c9(0x17b)][_0x56f6c9(0x123)]||null),_0xb11c56[_0x56f6c9(0x17b)][_0x56f6c9(0x105)]!==undefined&&(_0x5bb26e[_0x56f6c9(0x105)]=_0xb11c56[_0x56f6c9(0x17b)][_0x56f6c9(0x105)]||null));const _0x275f92=await database_1['default'][_0x56f6c9(0x174)][_0x56f6c9(0x153)]({'where':{'id':_0x33dd07},'data':_0x5bb26e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x3e3697=[];if(_0x275f92[_0x56f6c9(0x15e)]?.[_0x56f6c9(0x168)])try{_0x3e3697=Array[_0x56f6c9(0x11e)](_0x275f92[_0x56f6c9(0x15e)][_0x56f6c9(0x168)])?_0x275f92[_0x56f6c9(0x15e)]['webhookEvents']:JSON[_0x56f6c9(0x101)](_0x275f92[_0x56f6c9(0x15e)][_0x56f6c9(0x168)]);}catch(_0x1ef249){console[_0x56f6c9(0x156)](_0x56f6c9(0xee),_0x1ef249),_0x3e3697=[];}return{'id':_0x275f92['id'],'fullName':_0x275f92[_0x56f6c9(0x146)],'username':_0x275f92['username'],'telegramId':_0x275f92[_0x56f6c9(0x166)],'merchantUrl':_0x275f92['shopUrl'],'gateways':_0x275f92['paymentGateways']?JSON[_0x56f6c9(0x101)](_0x275f92[_0x56f6c9(0x13c)]):null,'gatewaySettings':_0x275f92['gatewaySettings']?JSON[_0x56f6c9(0x101)](_0x275f92['gatewaySettings']):null,'publicKey':_0x275f92[_0x56f6c9(0x138)],'webhookUrl':_0x275f92[_0x56f6c9(0x15e)]?.[_0x56f6c9(0xfe)]||null,'webhookEvents':_0x3e3697,'wallets':{'usdtPolygonWallet':_0x275f92[_0x56f6c9(0x10e)],'usdtTrcWallet':_0x275f92[_0x56f6c9(0x15b)],'usdtErcWallet':_0x275f92[_0x56f6c9(0x123)],'usdcPolygonWallet':_0x275f92['usdcPolygonWallet']},'status':_0x275f92[_0x56f6c9(0x178)],'createdAt':_0x275f92[_0x56f6c9(0x115)]};}async[a53_0x1b130a(0x112)](_0x3c48e2,_0x5a1563){const _0x151404=a53_0x1b130a,_0x2762be={};_0x5a1563[_0x151404(0x10e)]!==undefined&&(_0x2762be[_0x151404(0x10e)]=_0x5a1563[_0x151404(0x10e)]||null),_0x5a1563[_0x151404(0x15b)]!==undefined&&(_0x2762be[_0x151404(0x15b)]=_0x5a1563[_0x151404(0x15b)]||null),_0x5a1563[_0x151404(0x123)]!==undefined&&(_0x2762be['usdtErcWallet']=_0x5a1563['usdtErcWallet']||null),_0x5a1563[_0x151404(0x105)]!==undefined&&(_0x2762be[_0x151404(0x105)]=_0x5a1563[_0x151404(0x105)]||null),await database_1[_0x151404(0x16f)][_0x151404(0x174)][_0x151404(0x153)]({'where':{'id':_0x3c48e2},'data':_0x2762be});}async[a53_0x1b130a(0x17c)](_0x53bdfb){const _0x2549d6=a53_0x1b130a,_0xa03829=await database_1[_0x2549d6(0x16f)][_0x2549d6(0x174)][_0x2549d6(0xfa)]({'where':{'id':_0x53bdfb},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0xa03829?.['settings']?.[_0x2549d6(0xfe)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x13ba59={'event':'test','payment':{'id':'test_payment_123','order_id':'test_order_123','gateway':'test','amount':0x64,'currency':_0x2549d6(0x135),'status':_0x2549d6(0x136),'created_at':new Date()[_0x2549d6(0x188)]()}};try{const _0x4913ca=await fetch(_0xa03829['settings'][_0x2549d6(0xfe)],{'method':_0x2549d6(0x161),'headers':{'Content-Type':_0x2549d6(0x148),'User-Agent':_0x2549d6(0x108)},'body':JSON[_0x2549d6(0x126)](_0x13ba59)});return _0x4913ca['ok']?{'success':!![],'message':_0x2549d6(0x180)+_0x4913ca['status']+')'}:{'success':![],'message':_0x2549d6(0xf1)+_0x4913ca[_0x2549d6(0x178)]+'\x20'+_0x4913ca[_0x2549d6(0x109)]};}catch(_0x2c88a2){return{'success':![],'message':_0x2549d6(0x104)+(_0x2c88a2 instanceof Error?_0x2c88a2[_0x2549d6(0xf4)]:_0x2549d6(0x12a))};}}async['createPayment'](_0xf72a6a){const _0x13179b=a53_0x1b130a;return this['paymentService']['createPublicPayment']({'public_key':'','gateway':_0xf72a6a['gateway'],'order_id':undefined,'amount':_0xf72a6a['amount'],'currency':_0xf72a6a[_0x13179b(0x13d)],'source_currency':_0xf72a6a[_0x13179b(0x162)],'usage':_0xf72a6a['usage'],'expires_at':_0xf72a6a[_0x13179b(0x177)]?.['toISOString'](),'success_url':_0xf72a6a[_0x13179b(0xf5)],'fail_url':_0xf72a6a[_0x13179b(0xf5)],'customer_email':_0xf72a6a[_0x13179b(0xed)],'customer_name':_0xf72a6a[_0x13179b(0x132)],'country':_0xf72a6a[_0x13179b(0x11f)],'language':_0xf72a6a['language'],'amount_is_editable':_0xf72a6a['amountIsEditable'],'max_payments':_0xf72a6a[_0x13179b(0x137)],'customer':_0xf72a6a[_0x13179b(0x10d)]});}async['getPayments'](_0x45fc69,_0x4bbe48){const _0x3f2fed=a53_0x1b130a;return this['paymentService'][_0x3f2fed(0x187)](_0x45fc69,_0x4bbe48);}async['getPaymentById'](_0x530cb6,_0x22ca6f){const _0x13f752=a53_0x1b130a;return this[_0x13f752(0x155)][_0x13f752(0x10a)](_0x530cb6,_0x22ca6f);}async['updatePayment'](_0x8b7576,_0x18e98a,_0x29f143){const _0x4ecd78=a53_0x1b130a,_0x4f38a7=await database_1[_0x4ecd78(0x16f)][_0x4ecd78(0x106)][_0x4ecd78(0x114)]({'where':{'id':_0x18e98a,'shopId':_0x8b7576}});if(!_0x4f38a7)throw new Error(_0x4ecd78(0xf6));const _0x835cc=await database_1[_0x4ecd78(0x16f)][_0x4ecd78(0x106)][_0x4ecd78(0x153)]({'where':{'id':_0x18e98a},'data':{..._0x29f143,'updatedAt':new Date()}});return _0x835cc;}async['deletePayment'](_0x108e25,_0x2152a8){const _0x956840=a53_0x1b130a,_0x180832=await database_1[_0x956840(0x16f)][_0x956840(0x106)][_0x956840(0x114)]({'where':{'id':_0x2152a8,'shopId':_0x108e25}});if(!_0x180832)throw new Error(_0x956840(0xf6));await database_1[_0x956840(0x16f)]['payment']['delete']({'where':{'id':_0x2152a8}});}['formatNetworkName'](_0x1d8fe9){const _0x1bd0cf=a53_0x1b130a,_0x46656d={'polygon':_0x1bd0cf(0x124),'trc20':_0x1bd0cf(0x119),'erc20':_0x1bd0cf(0x122),'bsc':'USDT\x20BSC','polygon_usdc':_0x1bd0cf(0xeb)};return _0x46656d[_0x1d8fe9]||_0x1d8fe9;}async[a53_0x1b130a(0xff)](_0x4f79d5,_0x294efd){const _0xcb2b90=a53_0x1b130a,{page:_0x2cf2f1,limit:_0xe332d9,status:_0x81cef5,method:_0x5ae7f0,dateFrom:_0x3bf969,dateTo:_0x180163,periodFrom:_0xc83e73,periodTo:_0x17413b}=_0x294efd,_0x216336=(_0x2cf2f1-0x1)*_0xe332d9,_0x31e4fd={'shopId':_0x4f79d5};_0x81cef5&&(_0x31e4fd['status']=_0x81cef5[_0xcb2b90(0x113)]());_0x5ae7f0&&(_0x31e4fd['network']=_0x5ae7f0);if(_0x3bf969||_0x180163||_0xc83e73||_0x17413b){_0x31e4fd['createdAt']={};if(_0xc83e73)_0x31e4fd['createdAt']['gte']=new Date(_0xc83e73);else _0x3bf969&&(_0x31e4fd[_0xcb2b90(0x115)][_0xcb2b90(0x185)]=new Date(_0x3bf969));if(_0x17413b)_0x31e4fd['createdAt'][_0xcb2b90(0x12c)]=new Date(_0x17413b);else _0x180163&&(_0x31e4fd[_0xcb2b90(0x115)][_0xcb2b90(0x12c)]=new Date(_0x180163));}const [_0x2ac906,_0xdeae96]=await Promise[_0xcb2b90(0x16d)]([database_1['default'][_0xcb2b90(0x144)][_0xcb2b90(0x10b)]({'where':_0x31e4fd,'skip':_0x216336,'take':_0xe332d9,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0xcb2b90(0x16f)][_0xcb2b90(0x144)]['count']({'where':_0x31e4fd})]);return{'payouts':_0x2ac906[_0xcb2b90(0x134)](_0x52dbd4=>{const _0x3d5e4d=_0xcb2b90;let _0x228a38=null;switch(_0x52dbd4[_0x3d5e4d(0x12f)]){case'polygon':_0x228a38=_0x52dbd4['shop']['usdtPolygonWallet'];break;case _0x3d5e4d(0xfd):_0x228a38=_0x52dbd4[_0x3d5e4d(0x174)][_0x3d5e4d(0x15b)];break;case _0x3d5e4d(0x163):_0x228a38=_0x52dbd4[_0x3d5e4d(0x174)][_0x3d5e4d(0x123)];break;case _0x3d5e4d(0x17d):_0x228a38=_0x52dbd4[_0x3d5e4d(0x174)]['usdcPolygonWallet'];break;}return{'id':_0x52dbd4['id'],'amount':_0x52dbd4[_0x3d5e4d(0xf2)],'network':this[_0x3d5e4d(0x11b)](_0x52dbd4[_0x3d5e4d(0x12f)]),'wallet':_0x228a38,'status':_0x52dbd4[_0x3d5e4d(0x178)],'txid':_0x52dbd4[_0x3d5e4d(0x14e)],'notes':_0x52dbd4['notes'],'periodFrom':_0x52dbd4[_0x3d5e4d(0xea)],'periodTo':_0x52dbd4[_0x3d5e4d(0x118)],'createdAt':_0x52dbd4[_0x3d5e4d(0x115)],'paidAt':_0x52dbd4[_0x3d5e4d(0x111)]};}),'pagination':{'page':_0x2cf2f1,'limit':_0xe332d9,'total':_0xdeae96,'totalPages':Math[_0xcb2b90(0x183)](_0xdeae96/_0xe332d9)}};}async[a53_0x1b130a(0x186)](_0xbc03db,_0x56826b){const _0x1b59e5=a53_0x1b130a,_0x134b98=await database_1['default'][_0x1b59e5(0x144)][_0x1b59e5(0x114)]({'where':{'id':_0x56826b,'shopId':_0xbc03db}});if(!_0x134b98)return null;return{'id':_0x134b98['id'],'amount':_0x134b98[_0x1b59e5(0xf2)],'network':_0x134b98[_0x1b59e5(0x12f)],'status':_0x134b98['status'],'txid':_0x134b98[_0x1b59e5(0x14e)],'notes':_0x134b98[_0x1b59e5(0x10f)],'createdAt':_0x134b98[_0x1b59e5(0x115)],'paidAt':_0x134b98[_0x1b59e5(0x111)]};}async['getPayoutStatistics'](_0xb8a5f7,_0x5b4eb5){const _0x494320=a53_0x1b130a,_0x49619e=new Date();let _0x4696c5;switch(_0x5b4eb5){case'7d':_0x4696c5=new Date(_0x49619e[_0x494320(0x15f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4696c5=new Date(_0x49619e[_0x494320(0x15f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x494320(0x164):_0x4696c5=new Date(_0x49619e['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4696c5=new Date(_0x49619e[_0x494320(0x15f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4ae55a,_0x25df56,_0x49e97,_0x284813,_0x5a2cce,_0x1893b1]=await Promise['all']([database_1[_0x494320(0x16f)]['payout'][_0x494320(0x151)]({'where':{'shopId':_0xb8a5f7,'createdAt':{'gte':_0x4696c5}}}),database_1[_0x494320(0x16f)][_0x494320(0x144)][_0x494320(0x151)]({'where':{'shopId':_0xb8a5f7,'status':_0x494320(0x128),'createdAt':{'gte':_0x4696c5}}}),database_1[_0x494320(0x16f)][_0x494320(0x144)]['count']({'where':{'shopId':_0xb8a5f7,'status':_0x494320(0x182),'createdAt':{'gte':_0x4696c5}}}),database_1[_0x494320(0x16f)][_0x494320(0x144)]['count']({'where':{'shopId':_0xb8a5f7,'status':_0x494320(0x121),'createdAt':{'gte':_0x4696c5}}}),database_1[_0x494320(0x16f)]['payout'][_0x494320(0x10b)]({'where':{'shopId':_0xb8a5f7,'createdAt':{'gte':_0x4696c5}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x494320(0x16f)]['payout']['findMany']({'where':{'shopId':_0xb8a5f7},'take':0xa,'orderBy':{'createdAt':_0x494320(0x170)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x574c5b=_0x5a2cce[_0x494320(0x165)]((_0x45879e,_0x63f24b)=>_0x45879e+_0x63f24b['amount'],0x0),_0x4180d8=_0x5a2cce[_0x494320(0x14c)](_0x39f23a=>_0x39f23a[_0x494320(0x178)]===_0x494320(0x128))[_0x494320(0x165)]((_0xd27ae7,_0x17375b)=>_0xd27ae7+_0x17375b[_0x494320(0xf2)],0x0),_0x43e426=_0x5a2cce[_0x494320(0x14c)](_0xe3779e=>_0xe3779e[_0x494320(0x178)]===_0x494320(0x182))[_0x494320(0x165)]((_0x15c037,_0x10f62e)=>_0x15c037+_0x10f62e['amount'],0x0),_0x41cfb3=_0x5a2cce[_0x494320(0x165)]((_0x36729d,_0x2b9085)=>{const _0x554228=_0x494320;return _0x36729d[_0x2b9085[_0x554228(0x12f)]]=(_0x36729d[_0x2b9085[_0x554228(0x12f)]]||0x0)+0x1,_0x36729d;},{}),_0x49762e=_0x5a2cce[_0x494320(0x165)]((_0xbe8b5e,_0x293af9)=>{const _0x17b71d=_0x494320;return _0xbe8b5e[_0x293af9[_0x17b71d(0x178)]]=(_0xbe8b5e[_0x293af9[_0x17b71d(0x178)]]||0x0)+0x1,_0xbe8b5e;},{});return{'totalPayouts':_0x4ae55a,'completedPayouts':_0x25df56,'pendingPayouts':_0x49e97,'rejectedPayouts':_0x284813,'totalAmount':_0x574c5b,'completedAmount':_0x4180d8,'pendingAmount':_0x43e426,'payoutsByMethod':_0x41cfb3,'payoutsByStatus':_0x49762e,'recentPayouts':_0x1893b1[_0x494320(0x134)](_0x286cf2=>({'id':_0x286cf2['id'],'shopId':_0xb8a5f7,'amount':_0x286cf2[_0x494320(0xf2)],'method':_0x286cf2[_0x494320(0x12f)],'status':_0x286cf2[_0x494320(0x178)],'txid':_0x286cf2[_0x494320(0x14e)],'createdAt':_0x286cf2['createdAt'],'paidAt':_0x286cf2['paidAt']}))};}async['getShopPayoutStats'](_0xf92f8b){const _0x58c74e=a53_0x1b130a;console[_0x58c74e(0x172)](_0x58c74e(0x154)+_0xf92f8b+_0x58c74e(0x102));const _0x351617=await database_1[_0x58c74e(0x16f)][_0x58c74e(0x174)]['findUnique']({'where':{'id':_0xf92f8b},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x351617)throw new Error(_0x58c74e(0x189));const _0x482894=new Date(),_0x519838=new Date(_0x482894[_0x58c74e(0x173)](),_0x482894[_0x58c74e(0x130)](),0x1),_0x26ba23=new Date(_0x482894[_0x58c74e(0x173)](),_0x482894[_0x58c74e(0x130)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x25da51=await database_1[_0x58c74e(0x16f)][_0x58c74e(0x144)][_0x58c74e(0x149)]({'_sum':{'amount':!![]},'where':{'shopId':_0xf92f8b,'createdAt':{'gte':_0x519838,'lte':_0x26ba23},'status':_0x58c74e(0x128)}}),_0xa4207=_0x25da51[_0x58c74e(0x176)]['amount']||0x0,_0x274e94={'availableBalance':Math[_0x58c74e(0x12b)](_0x351617[_0x58c74e(0x14a)]*0x64)/0x64,'totalPaidOut':Math[_0x58c74e(0x12b)](_0x351617[_0x58c74e(0x184)]*0x64)/0x64,'awaitingPayout':Math[_0x58c74e(0x12b)](_0x351617[_0x58c74e(0x14a)]*0x64)/0x64,'thisMonth':Math[_0x58c74e(0x12b)](_0xa4207*0x64)/0x64};return console[_0x58c74e(0x172)](_0x58c74e(0x117)+_0x351617['username']+_0x58c74e(0xef)),console[_0x58c74e(0x172)](_0x58c74e(0x107)+_0x274e94['availableBalance']+_0x58c74e(0xf0)),console[_0x58c74e(0x172)]('\x20\x20\x20💰\x20Total\x20paid\x20out:\x20'+_0x274e94[_0x58c74e(0x184)]+_0x58c74e(0xf8)),console[_0x58c74e(0x172)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x274e94[_0x58c74e(0x17e)]+_0x58c74e(0xf0)),console[_0x58c74e(0x172)](_0x58c74e(0x103)+_0x274e94[_0x58c74e(0x13e)]+_0x58c74e(0x175)),_0x274e94;}[a53_0x1b130a(0xfc)](_0x4cd85e){const _0x5b4ecd=a53_0x1b130a,_0x30a1ac={'test_gateway':_0x5b4ecd(0x141),'plisio':_0x5b4ecd(0xf3),'rapyd':'Rapyd','noda':'Noda','cointopay':_0x5b4ecd(0x16b),'klyme_eu':_0x5b4ecd(0x10c),'klyme_gb':_0x5b4ecd(0x14f),'klyme_de':_0x5b4ecd(0xec)};return _0x30a1ac[_0x4cd85e]||_0x4cd85e;}async[a53_0x1b130a(0x12e)](_0x396e71){const _0x2041e8=a53_0x1b130a;return this[_0x2041e8(0x16c)](_0x396e71);}async['getWebhookLogs'](_0x1000e7,_0xaeb2ce){const _0x537957=a53_0x1b130a,{page:_0x466572,limit:_0x5f0beb,paymentId:_0x28bfe7}=_0xaeb2ce,_0x5df9eb=(_0x466572-0x1)*_0x5f0beb,_0x4ba9b3={'shopId':_0x1000e7};_0x28bfe7&&(_0x4ba9b3[_0x537957(0x158)]=_0x28bfe7);const [_0x4aaf51,_0x4de3f3]=await Promise[_0x537957(0x16d)]([database_1[_0x537957(0x16f)]['webhookLog']['findMany']({'where':_0x4ba9b3,'skip':_0x5df9eb,'take':_0x5f0beb,'orderBy':{'createdAt':_0x537957(0x170)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x537957(0x17f)]['count']({'where':_0x4ba9b3})]);return{'logs':_0x4aaf51[_0x537957(0x134)](_0x40b430=>({'id':_0x40b430['id'],'paymentId':_0x40b430[_0x537957(0x158)],'shopId':_0x40b430['shopId'],'event':_0x40b430[_0x537957(0x159)],'statusCode':_0x40b430[_0x537957(0x15c)],'retryCount':_0x40b430['retryCount'],'responseBody':_0x40b430[_0x537957(0x11d)],'createdAt':_0x40b430[_0x537957(0x115)],'payment':_0x40b430[_0x537957(0x106)]})),'pagination':{'page':_0x466572,'limit':_0x5f0beb,'total':_0x4de3f3,'totalPages':Math[_0x537957(0x183)](_0x4de3f3/_0x5f0beb)}};}async['getStatistics'](_0x4498ea,_0x5c41f4){const _0x456410=a53_0x1b130a,_0x4a5454=new Date();let _0x1674ae;switch(_0x5c41f4){case'7d':_0x1674ae=new Date(_0x4a5454[_0x456410(0x15f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x456410(0x110):_0x1674ae=new Date(_0x4a5454[_0x456410(0x15f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x1674ae=new Date(_0x4a5454[_0x456410(0x15f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1674ae=new Date(_0x4a5454['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x174cef,_0x572123,_0x215dc0,_0x4c52a2,_0xe026ed]=await Promise[_0x456410(0x16d)]([database_1[_0x456410(0x16f)][_0x456410(0x106)][_0x456410(0x151)]({'where':{'shopId':_0x4498ea,'gateway':{'not':_0x456410(0x139)},'createdAt':{'gte':_0x1674ae}}}),database_1['default'][_0x456410(0x106)][_0x456410(0x151)]({'where':{'shopId':_0x4498ea,'gateway':{'not':'test_gateway'},'status':_0x456410(0x157),'createdAt':{'gte':_0x1674ae}}}),database_1[_0x456410(0x16f)][_0x456410(0x106)][_0x456410(0x10b)]({'where':{'shopId':_0x4498ea,'gateway':{'not':_0x456410(0x139)},'status':_0x456410(0x157),'createdAt':{'gte':_0x1674ae}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x456410(0x16f)][_0x456410(0x106)][_0x456410(0x10b)]({'where':{'shopId':_0x4498ea,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x456410(0x16f)][_0x456410(0x106)][_0x456410(0x10b)]({'where':{'shopId':_0x4498ea,'gateway':{'not':_0x456410(0x139)},'createdAt':{'gte':_0x1674ae}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x456410(0x11c)}})]);let _0x219685=0x0;for(const _0x3baeee of _0x215dc0){if(_0x3baeee[_0x456410(0x15d)])_0x219685+=_0x3baeee['amountUSDT'];else{const _0xdc433f=await currencyService_1[_0x456410(0x181)]['convertToUSDT'](_0x3baeee[_0x456410(0xf2)],_0x3baeee[_0x456410(0x13d)]);_0x219685+=_0xdc433f;}}const _0x4db83c=this[_0x456410(0x129)](_0xe026ed,_0x1674ae,_0x4a5454),_0xb79146=_0x174cef>0x0?_0x572123/_0x174cef*0x64:0x0;return{'totalPayments':_0x174cef,'successfulPayments':_0x572123,'totalRevenue':Math[_0x456410(0x12b)](_0x219685*0x64)/0x64,'conversionRate':Math[_0x456410(0x12b)](_0xb79146*0x64)/0x64,'dailyRevenue':_0x4db83c['dailyRevenue'],'dailyPayments':_0x4db83c['dailyPayments'],'recentPayments':_0x4c52a2[_0x456410(0x134)](_0x58ca83=>({'id':_0x58ca83['id'],'gateway':_0x58ca83[_0x456410(0x169)],'amount':_0x58ca83[_0x456410(0xf2)],'currency':_0x58ca83[_0x456410(0x13d)],'status':_0x58ca83[_0x456410(0x178)],'createdAt':_0x58ca83[_0x456410(0x115)]}))};}[a53_0x1b130a(0x129)](_0x4cdc0f,_0x1af6fe,_0x3db7ef){const _0x52939e=a53_0x1b130a,_0x48bd5a=new Map(),_0x214233=new Date(_0x1af6fe);while(_0x214233<=_0x3db7ef){const _0x287c9c=_0x214233[_0x52939e(0x188)]()[_0x52939e(0x127)]('T')[0x0];_0x48bd5a[_0x52939e(0x147)](_0x287c9c,{'revenue':0x0,'count':0x0}),_0x214233['setDate'](_0x214233[_0x52939e(0x160)]()+0x1);}for(const _0x51db29 of _0x4cdc0f){const _0x512e9d=_0x51db29[_0x52939e(0x115)][_0x52939e(0x188)]()[_0x52939e(0x127)]('T')[0x0],_0x588b95=_0x48bd5a[_0x52939e(0x142)](_0x512e9d);_0x588b95&&(_0x588b95['count']+=0x1,_0x51db29['status']==='PAID'&&_0x51db29[_0x52939e(0x15d)]&&(_0x588b95[_0x52939e(0x16a)]+=_0x51db29['amountUSDT']));}const _0x49593c=[],_0x58f3fb=[];for(const [_0x3f7b30,_0x31d2fd]of _0x48bd5a){_0x49593c[_0x52939e(0x167)]({'date':_0x3f7b30,'amount':Math['round'](_0x31d2fd[_0x52939e(0x16a)]*0x64)/0x64}),_0x58f3fb[_0x52939e(0x167)]({'date':_0x3f7b30,'count':_0x31d2fd[_0x52939e(0x151)]});}return{'dailyRevenue':_0x49593c,'dailyPayments':_0x58f3fb};}}exports[a53_0x1b130a(0x12d)]=ShopService;