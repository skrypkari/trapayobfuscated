'use strict';const a54_0x86b8e2=a54_0x1834;(function(_0x87f2b8,_0xea2cbf){const _0x2593d1=a54_0x1834,_0xfefe70=_0x87f2b8();while(!![]){try{const _0x51311c=-parseInt(_0x2593d1(0x183))/0x1+-parseInt(_0x2593d1(0x1a1))/0x2+parseInt(_0x2593d1(0x18d))/0x3+-parseInt(_0x2593d1(0x219))/0x4+-parseInt(_0x2593d1(0x18c))/0x5*(parseInt(_0x2593d1(0x21d))/0x6)+-parseInt(_0x2593d1(0x1f0))/0x7*(parseInt(_0x2593d1(0x20a))/0x8)+parseInt(_0x2593d1(0x1b5))/0x9*(parseInt(_0x2593d1(0x180))/0xa);if(_0x51311c===_0xea2cbf)break;else _0xfefe70['push'](_0xfefe70['shift']());}catch(_0x61ed6d){_0xfefe70['push'](_0xfefe70['shift']());}}}(a54_0x4734,0x455d2));var __importDefault=this&&this['__importDefault']||function(_0x1379df){const _0x80c71a=a54_0x1834;return _0x1379df&&_0x1379df[_0x80c71a(0x1c8)]?_0x1379df:{'default':_0x1379df};};Object[a54_0x86b8e2(0x1eb)](exports,a54_0x86b8e2(0x1c8),{'value':!![]}),exports[a54_0x86b8e2(0x1b9)]=void 0x0;const database_1=__importDefault(require(a54_0x86b8e2(0x206))),currencyService_1=require(a54_0x86b8e2(0x17b)),paymentService_1=require('./paymentService');function a54_0x1834(_0x210669,_0x178777){const _0x47345c=a54_0x4734();return a54_0x1834=function(_0x183407,_0x5cc74f){_0x183407=_0x183407-0x16d;let _0x284c8e=_0x47345c[_0x183407];return _0x284c8e;},a54_0x1834(_0x210669,_0x178777);}function a54_0x4734(){const _0x5d1f46=['balance','üìÖ\x20Period\x20end:\x20','status','Error\x20parsing\x20webhook\x20events:','log','txid','usdcPolygonWallet','USDT\x20TRC20','getPayoutStats','üìä\x20Final\x20WHERE\x20conditions:','...','expiresAt','publicKey','currencyService','aggregate','REJECTED','wallets','shopUrl','defineProperty','deletePayment','toISOString','periodTo','currency','299033UQICme','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','redirectUrl','Payment\x20not\x20found','setDate','üìä\x20Status\x20filter:\x20','üåê\x20Method\x20filter:\x20','notes','revenue','ceil','statusCode','count','PENDING','trc20','getShopPayoutStats','getPaymentsByShop','telegramId','error','map','üåê\x20Network\x20filter:\x20','createPublicPayment','stringify','../config/database','default','createdAt','get','32lNCIkJ','telegram','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','PAID','USD','settings','payment','getWebhookLogs','testWebhook','KLYME\x20EU','usdtTrcWallet','getMonth','webhookEvents','periodFrom','sourceCurrency','2001804tGHUBM','erc20','gateway','all','318RSeita','generateDailyStatistics','event','getPaymentById','findFirst','message','set','toUpperCase','webhookLog','gateways','totalPaidOut','30d','maxPayments','KLYME\x20GB','convertToUSDT','./currencyService','findUnique','paymentGateways','network','split','346870HGsPXY','dailyRevenue','test_gateway','31254KvFNxb','getShopProfile','\x20USDT','Test\x20webhook\x20sent\x20successfully\x20(','dailyPayments','Webhook\x20returned\x20error:\x20','\x20USDT\x20(current\x20balance)','merchantUrl','usdtErcWallet','51685cloFbf','1287660DoZHvQ','90d','getFullYear','customerEmail','setHours','Noda','polygon','PaymentService','createPayment','update','updateShopProfile','Unknown\x20error','paymentId','KLYME\x20DE','parse','\x20USDT\x20(total\x20payouts)','webhookUrl','round','getDate','getPayoutStatistics','9296qEqzGa','filter','reduce','\x20\x20\x20üíµ\x20Available\x20balance:\x20','payout','amountUSDT','No\x20webhook\x20URL\x20configured','USDT\x20ERC20','getStatistics','\x20\x20\x20üìÖ\x20This\x20month:\x20','test_payment_123','getGatewayDisplayName','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','customerName','retryCount','test_order_123','gte','paymentService','polygon_usdc','USDT\x20BSC','288qWTHmH','üìÖ\x20Date\x20start:\x20','amount','statusText','ShopService','thisMonth','üìÖ\x20Period\x20start:\x20','COMPLETED','Shop\x20not\x20found','shop','isArray','asc','Plisio','usdtPolygonWallet','Failed\x20to\x20send\x20webhook:\x20','Rapyd','username','paidAt','name','__esModule','gatewaySettings','üìä\x20Shop\x20','responseBody','country','paid','TesSoft\x20Payment\x20System/1.0\x20(Test)','application/json','findMany','test','getTime','lte','awaitingPayout','desc','push','fullName','customer'];a54_0x4734=function(){return _0x5d1f46;};return a54_0x4734();}class ShopService{constructor(){const _0x5d4081=a54_0x86b8e2;this[_0x5d4081(0x1b2)]=new paymentService_1[(_0x5d4081(0x194))]();}async[a54_0x86b8e2(0x184)](_0x250b79){const _0x2cdc67=a54_0x86b8e2,_0x40dea9=await database_1[_0x2cdc67(0x207)][_0x2cdc67(0x1be)][_0x2cdc67(0x17c)]({'where':{'id':_0x250b79},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x40dea9)throw new Error(_0x2cdc67(0x1bd));let _0x1a2f29=[];if(_0x40dea9[_0x2cdc67(0x20f)]?.[_0x2cdc67(0x216)])try{_0x1a2f29=Array[_0x2cdc67(0x1bf)](_0x40dea9[_0x2cdc67(0x20f)][_0x2cdc67(0x216)])?_0x40dea9[_0x2cdc67(0x20f)][_0x2cdc67(0x216)]:JSON[_0x2cdc67(0x19b)](_0x40dea9[_0x2cdc67(0x20f)][_0x2cdc67(0x216)]);}catch(_0x21a54c){console['error'](_0x2cdc67(0x1dc),_0x21a54c),_0x1a2f29=[];}return{'id':_0x40dea9['id'],'fullName':_0x40dea9[_0x2cdc67(0x1c7)],'username':_0x40dea9[_0x2cdc67(0x1c5)],'telegramId':_0x40dea9[_0x2cdc67(0x20b)],'merchantUrl':_0x40dea9[_0x2cdc67(0x1ea)],'gateways':_0x40dea9[_0x2cdc67(0x17d)]?JSON[_0x2cdc67(0x19b)](_0x40dea9[_0x2cdc67(0x17d)]):null,'gatewaySettings':_0x40dea9['gatewaySettings']?JSON[_0x2cdc67(0x19b)](_0x40dea9[_0x2cdc67(0x1c9)]):null,'publicKey':_0x40dea9['publicKey'],'webhookUrl':_0x40dea9[_0x2cdc67(0x20f)]?.[_0x2cdc67(0x19d)]||null,'webhookEvents':_0x1a2f29,'wallets':{'usdtPolygonWallet':_0x40dea9['usdtPolygonWallet'],'usdtTrcWallet':_0x40dea9[_0x2cdc67(0x214)],'usdtErcWallet':_0x40dea9[_0x2cdc67(0x18b)],'usdcPolygonWallet':_0x40dea9['usdcPolygonWallet']},'status':_0x40dea9[_0x2cdc67(0x1db)],'createdAt':_0x40dea9[_0x2cdc67(0x208)]};}async[a54_0x86b8e2(0x197)](_0x53910a,_0x4d517b){const _0x4719a1=a54_0x86b8e2,_0x1d657a={};_0x4d517b[_0x4719a1(0x1d7)]&&(_0x1d657a[_0x4719a1(0x1c7)]=_0x4d517b['fullName']);_0x4d517b[_0x4719a1(0x200)]!==undefined&&(_0x1d657a[_0x4719a1(0x20b)]=_0x4d517b['telegramId']||null);_0x4d517b[_0x4719a1(0x18a)]&&(_0x1d657a['shopUrl']=_0x4d517b['merchantUrl']);_0x4d517b[_0x4719a1(0x175)]&&(_0x1d657a['paymentGateways']=JSON[_0x4719a1(0x205)](_0x4d517b[_0x4719a1(0x175)]));_0x4d517b[_0x4719a1(0x1c9)]&&(_0x1d657a['gatewaySettings']=JSON[_0x4719a1(0x205)](_0x4d517b['gatewaySettings']));_0x4d517b[_0x4719a1(0x1e9)]&&(_0x4d517b[_0x4719a1(0x1e9)][_0x4719a1(0x1c2)]!==undefined&&(_0x1d657a[_0x4719a1(0x1c2)]=_0x4d517b[_0x4719a1(0x1e9)][_0x4719a1(0x1c2)]||null),_0x4d517b[_0x4719a1(0x1e9)][_0x4719a1(0x214)]!==undefined&&(_0x1d657a['usdtTrcWallet']=_0x4d517b['wallets'][_0x4719a1(0x214)]||null),_0x4d517b[_0x4719a1(0x1e9)]['usdtErcWallet']!==undefined&&(_0x1d657a[_0x4719a1(0x18b)]=_0x4d517b[_0x4719a1(0x1e9)][_0x4719a1(0x18b)]||null),_0x4d517b['wallets']['usdcPolygonWallet']!==undefined&&(_0x1d657a[_0x4719a1(0x1df)]=_0x4d517b[_0x4719a1(0x1e9)]['usdcPolygonWallet']||null));const _0x3696aa=await database_1[_0x4719a1(0x207)][_0x4719a1(0x1be)][_0x4719a1(0x196)]({'where':{'id':_0x53910a},'data':_0x1d657a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x207ecf=[];if(_0x3696aa['settings']?.[_0x4719a1(0x216)])try{_0x207ecf=Array[_0x4719a1(0x1bf)](_0x3696aa[_0x4719a1(0x20f)][_0x4719a1(0x216)])?_0x3696aa['settings'][_0x4719a1(0x216)]:JSON[_0x4719a1(0x19b)](_0x3696aa[_0x4719a1(0x20f)][_0x4719a1(0x216)]);}catch(_0x5d13c0){console[_0x4719a1(0x201)](_0x4719a1(0x1dc),_0x5d13c0),_0x207ecf=[];}return{'id':_0x3696aa['id'],'fullName':_0x3696aa['name'],'username':_0x3696aa[_0x4719a1(0x1c5)],'telegramId':_0x3696aa[_0x4719a1(0x20b)],'merchantUrl':_0x3696aa[_0x4719a1(0x1ea)],'gateways':_0x3696aa[_0x4719a1(0x17d)]?JSON['parse'](_0x3696aa[_0x4719a1(0x17d)]):null,'gatewaySettings':_0x3696aa[_0x4719a1(0x1c9)]?JSON[_0x4719a1(0x19b)](_0x3696aa[_0x4719a1(0x1c9)]):null,'publicKey':_0x3696aa[_0x4719a1(0x1e5)],'webhookUrl':_0x3696aa[_0x4719a1(0x20f)]?.[_0x4719a1(0x19d)]||null,'webhookEvents':_0x207ecf,'wallets':{'usdtPolygonWallet':_0x3696aa[_0x4719a1(0x1c2)],'usdtTrcWallet':_0x3696aa['usdtTrcWallet'],'usdtErcWallet':_0x3696aa[_0x4719a1(0x18b)],'usdcPolygonWallet':_0x3696aa[_0x4719a1(0x1df)]},'status':_0x3696aa[_0x4719a1(0x1db)],'createdAt':_0x3696aa['createdAt']};}async['updateWallets'](_0x4fba13,_0x67ac6b){const _0x2f2c16=a54_0x86b8e2,_0x22c83f={};_0x67ac6b[_0x2f2c16(0x1c2)]!==undefined&&(_0x22c83f[_0x2f2c16(0x1c2)]=_0x67ac6b[_0x2f2c16(0x1c2)]||null),_0x67ac6b[_0x2f2c16(0x214)]!==undefined&&(_0x22c83f[_0x2f2c16(0x214)]=_0x67ac6b['usdtTrcWallet']||null),_0x67ac6b[_0x2f2c16(0x18b)]!==undefined&&(_0x22c83f[_0x2f2c16(0x18b)]=_0x67ac6b[_0x2f2c16(0x18b)]||null),_0x67ac6b[_0x2f2c16(0x1df)]!==undefined&&(_0x22c83f[_0x2f2c16(0x1df)]=_0x67ac6b[_0x2f2c16(0x1df)]||null),await database_1[_0x2f2c16(0x207)][_0x2f2c16(0x1be)][_0x2f2c16(0x196)]({'where':{'id':_0x4fba13},'data':_0x22c83f});}async[a54_0x86b8e2(0x212)](_0x5b3a89){const _0x2159c4=a54_0x86b8e2,_0x3e4dda=await database_1[_0x2159c4(0x207)][_0x2159c4(0x1be)]['findUnique']({'where':{'id':_0x5b3a89},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3e4dda?.[_0x2159c4(0x20f)]?.[_0x2159c4(0x19d)])throw new Error(_0x2159c4(0x1a7));const _0x365e3f={'event':'test','payment':{'id':_0x2159c4(0x1ab),'order_id':_0x2159c4(0x1b0),'gateway':_0x2159c4(0x1d1),'amount':0x64,'currency':_0x2159c4(0x20e),'status':_0x2159c4(0x1cd),'created_at':new Date()[_0x2159c4(0x1ed)]()}};try{const _0x150ccf=await fetch(_0x3e4dda[_0x2159c4(0x20f)][_0x2159c4(0x19d)],{'method':'POST','headers':{'Content-Type':_0x2159c4(0x1cf),'User-Agent':_0x2159c4(0x1ce)},'body':JSON[_0x2159c4(0x205)](_0x365e3f)});return _0x150ccf['ok']?{'success':!![],'message':_0x2159c4(0x186)+_0x150ccf[_0x2159c4(0x1db)]+')'}:{'success':![],'message':_0x2159c4(0x188)+_0x150ccf['status']+'\x20'+_0x150ccf[_0x2159c4(0x1b8)]};}catch(_0x341fd3){return{'success':![],'message':_0x2159c4(0x1c3)+(_0x341fd3 instanceof Error?_0x341fd3[_0x2159c4(0x171)]:_0x2159c4(0x198))};}}async[a54_0x86b8e2(0x195)](_0x50c424){const _0xe2e226=a54_0x86b8e2;return this[_0xe2e226(0x1b2)][_0xe2e226(0x204)]({'public_key':'','gateway':_0x50c424[_0xe2e226(0x21b)],'order_id':undefined,'amount':_0x50c424[_0xe2e226(0x1b7)],'currency':_0x50c424[_0xe2e226(0x1ef)],'source_currency':_0x50c424[_0xe2e226(0x218)],'usage':_0x50c424['usage'],'expires_at':_0x50c424[_0xe2e226(0x1e4)]?.['toISOString'](),'success_url':_0x50c424[_0xe2e226(0x1f2)],'fail_url':_0x50c424[_0xe2e226(0x1f2)],'customer_email':_0x50c424[_0xe2e226(0x190)],'customer_name':_0x50c424[_0xe2e226(0x1ae)],'country':_0x50c424[_0xe2e226(0x1cc)],'language':_0x50c424['language'],'amount_is_editable':_0x50c424['amountIsEditable'],'max_payments':_0x50c424[_0xe2e226(0x178)],'customer':_0x50c424[_0xe2e226(0x1d8)]});}async['getPayments'](_0x3a3ee7,_0x5da664){const _0x8ba095=a54_0x86b8e2;return this['paymentService'][_0x8ba095(0x1ff)](_0x3a3ee7,_0x5da664);}async[a54_0x86b8e2(0x16f)](_0x184e42,_0xa3f6a7){const _0x55af91=a54_0x86b8e2;return this[_0x55af91(0x1b2)]['getPaymentByShopAndId'](_0x184e42,_0xa3f6a7);}async['updatePayment'](_0x274cce,_0x346dbc,_0x1021dc){const _0x50d60c=a54_0x86b8e2,_0x24fa36=await database_1[_0x50d60c(0x207)][_0x50d60c(0x210)][_0x50d60c(0x170)]({'where':{'id':_0x346dbc,'shopId':_0x274cce}});if(!_0x24fa36)throw new Error(_0x50d60c(0x1f3));const _0x1c124e=await database_1[_0x50d60c(0x207)][_0x50d60c(0x210)][_0x50d60c(0x196)]({'where':{'id':_0x346dbc},'data':{..._0x1021dc,'updatedAt':new Date()}});return _0x1c124e;}async[a54_0x86b8e2(0x1ec)](_0x540042,_0x1182c7){const _0x1e63bd=a54_0x86b8e2,_0x32f46d=await database_1[_0x1e63bd(0x207)][_0x1e63bd(0x210)]['findFirst']({'where':{'id':_0x1182c7,'shopId':_0x540042}});if(!_0x32f46d)throw new Error(_0x1e63bd(0x1f3));await database_1[_0x1e63bd(0x207)][_0x1e63bd(0x210)]['delete']({'where':{'id':_0x1182c7}});}['formatNetworkName'](_0x304caa){const _0x5eedb9=a54_0x86b8e2,_0x37f491={'polygon':'USDT\x20Polygon','trc20':_0x5eedb9(0x1e0),'erc20':_0x5eedb9(0x1a8),'bsc':_0x5eedb9(0x1b4),'polygon_usdc':'USDC\x20Polygon'};return _0x37f491[_0x304caa]||_0x304caa;}async['getPayouts'](_0x3aea9a,_0x12df51){const _0x781af9=a54_0x86b8e2,{page:_0x2e3ec8,limit:_0x43d17d,status:_0x36d707,method:_0x5ae35e,network:_0x38f32b,dateFrom:_0x541140,dateTo:_0x2407ad,periodFrom:_0x9d1466,periodTo:_0x3016d5}=_0x12df51,_0x3d5a72=(_0x2e3ec8-0x1)*_0x43d17d;console[_0x781af9(0x1dd)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x12df51);const _0x470239={'shopId':_0x3aea9a};_0x36d707&&(_0x470239[_0x781af9(0x1db)]=_0x36d707[_0x781af9(0x173)](),console[_0x781af9(0x1dd)](_0x781af9(0x1f5)+_0x36d707[_0x781af9(0x173)]()));if(_0x5ae35e)_0x470239[_0x781af9(0x17e)]=_0x5ae35e,console[_0x781af9(0x1dd)](_0x781af9(0x1f6)+_0x5ae35e);else _0x38f32b&&(_0x470239[_0x781af9(0x17e)]=_0x38f32b,console['log'](_0x781af9(0x203)+_0x38f32b));if(_0x541140||_0x2407ad||_0x9d1466||_0x3016d5){_0x470239['createdAt']={};if(_0x9d1466){const _0x4cf8c4=new Date(_0x9d1466);_0x4cf8c4[_0x781af9(0x191)](0x0,0x0,0x0,0x0),_0x470239[_0x781af9(0x208)][_0x781af9(0x1b1)]=_0x4cf8c4,console[_0x781af9(0x1dd)](_0x781af9(0x1bb)+_0x4cf8c4['toISOString']());}else{if(_0x541140){const _0x328587=new Date(_0x541140);_0x328587[_0x781af9(0x191)](0x0,0x0,0x0,0x0),_0x470239[_0x781af9(0x208)][_0x781af9(0x1b1)]=_0x328587,console[_0x781af9(0x1dd)](_0x781af9(0x1b6)+_0x328587[_0x781af9(0x1ed)]());}}if(_0x3016d5){const _0x10d9e5=new Date(_0x3016d5);_0x10d9e5['setHours'](0x17,0x3b,0x3b,0x3e7),_0x470239[_0x781af9(0x208)][_0x781af9(0x1d3)]=_0x10d9e5,console['log'](_0x781af9(0x1da)+_0x10d9e5[_0x781af9(0x1ed)]());}else{if(_0x2407ad){const _0x402670=new Date(_0x2407ad);_0x402670[_0x781af9(0x191)](0x17,0x3b,0x3b,0x3e7),_0x470239[_0x781af9(0x208)][_0x781af9(0x1d3)]=_0x402670,console[_0x781af9(0x1dd)]('üìÖ\x20Date\x20end:\x20'+_0x402670['toISOString']());}}}console['log'](_0x781af9(0x1e2),JSON[_0x781af9(0x205)](_0x470239,null,0x2));const [_0x32d076,_0x4e4496]=await Promise[_0x781af9(0x21c)]([database_1['default'][_0x781af9(0x1a5)][_0x781af9(0x1d0)]({'where':_0x470239,'skip':_0x3d5a72,'take':_0x43d17d,'orderBy':{'createdAt':_0x781af9(0x1d5)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x781af9(0x207)]['payout']['count']({'where':_0x470239})]);return{'payouts':_0x32d076[_0x781af9(0x202)](_0x5e81da=>{const _0x58ff5b=_0x781af9;let _0x1d8f52=null;switch(_0x5e81da[_0x58ff5b(0x17e)]){case _0x58ff5b(0x193):_0x1d8f52=_0x5e81da[_0x58ff5b(0x1be)]['usdtPolygonWallet'];break;case _0x58ff5b(0x1fd):_0x1d8f52=_0x5e81da['shop'][_0x58ff5b(0x214)];break;case _0x58ff5b(0x21a):_0x1d8f52=_0x5e81da[_0x58ff5b(0x1be)][_0x58ff5b(0x18b)];break;case _0x58ff5b(0x1b3):_0x1d8f52=_0x5e81da[_0x58ff5b(0x1be)][_0x58ff5b(0x1df)];break;}return{'id':_0x5e81da['id'],'amount':_0x5e81da[_0x58ff5b(0x1b7)],'network':this['formatNetworkName'](_0x5e81da[_0x58ff5b(0x17e)]),'wallet':_0x1d8f52,'status':_0x5e81da[_0x58ff5b(0x1db)],'txid':_0x5e81da[_0x58ff5b(0x1de)],'notes':_0x5e81da[_0x58ff5b(0x1f7)],'periodFrom':_0x5e81da[_0x58ff5b(0x217)],'periodTo':_0x5e81da[_0x58ff5b(0x1ee)],'createdAt':_0x5e81da['createdAt'],'paidAt':_0x5e81da[_0x58ff5b(0x1c6)]};}),'pagination':{'page':_0x2e3ec8,'limit':_0x43d17d,'total':_0x4e4496,'totalPages':Math[_0x781af9(0x1f9)](_0x4e4496/_0x43d17d)}};}async['getPayoutById'](_0x211476,_0x155d51){const _0x355d19=a54_0x86b8e2,_0x4b02c4=await database_1[_0x355d19(0x207)][_0x355d19(0x1a5)][_0x355d19(0x170)]({'where':{'id':_0x155d51,'shopId':_0x211476}});if(!_0x4b02c4)return null;return{'id':_0x4b02c4['id'],'amount':_0x4b02c4[_0x355d19(0x1b7)],'network':_0x4b02c4['network'],'status':_0x4b02c4[_0x355d19(0x1db)],'txid':_0x4b02c4[_0x355d19(0x1de)],'notes':_0x4b02c4[_0x355d19(0x1f7)],'createdAt':_0x4b02c4[_0x355d19(0x208)],'paidAt':_0x4b02c4['paidAt']};}async[a54_0x86b8e2(0x1a0)](_0x315c49,_0x2212c7){const _0x918df1=a54_0x86b8e2,_0x1cc76b=new Date();let _0x48da90;switch(_0x2212c7){case'7d':_0x48da90=new Date(_0x1cc76b['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x918df1(0x177):_0x48da90=new Date(_0x1cc76b[_0x918df1(0x1d2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x918df1(0x18e):_0x48da90=new Date(_0x1cc76b['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x48da90=new Date(_0x1cc76b[_0x918df1(0x1d2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x28338b,_0x1d2e17,_0x3fd466,_0x3b3785,_0x1258c6,_0x357912]=await Promise[_0x918df1(0x21c)]([database_1[_0x918df1(0x207)]['payout'][_0x918df1(0x1fb)]({'where':{'shopId':_0x315c49,'createdAt':{'gte':_0x48da90}}}),database_1[_0x918df1(0x207)][_0x918df1(0x1a5)][_0x918df1(0x1fb)]({'where':{'shopId':_0x315c49,'status':_0x918df1(0x1bc),'createdAt':{'gte':_0x48da90}}}),database_1['default']['payout'][_0x918df1(0x1fb)]({'where':{'shopId':_0x315c49,'status':_0x918df1(0x1fc),'createdAt':{'gte':_0x48da90}}}),database_1['default'][_0x918df1(0x1a5)][_0x918df1(0x1fb)]({'where':{'shopId':_0x315c49,'status':_0x918df1(0x1e8),'createdAt':{'gte':_0x48da90}}}),database_1['default']['payout'][_0x918df1(0x1d0)]({'where':{'shopId':_0x315c49,'createdAt':{'gte':_0x48da90}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x918df1(0x207)][_0x918df1(0x1a5)][_0x918df1(0x1d0)]({'where':{'shopId':_0x315c49},'take':0xa,'orderBy':{'createdAt':_0x918df1(0x1d5)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x231053=_0x1258c6['reduce']((_0x577e41,_0x3e3444)=>_0x577e41+_0x3e3444[_0x918df1(0x1b7)],0x0),_0x5a4016=_0x1258c6[_0x918df1(0x1a2)](_0x495bdf=>_0x495bdf[_0x918df1(0x1db)]===_0x918df1(0x1bc))[_0x918df1(0x1a3)]((_0xaf0536,_0x4a0f50)=>_0xaf0536+_0x4a0f50['amount'],0x0),_0xe024f7=_0x1258c6[_0x918df1(0x1a2)](_0x5d59ce=>_0x5d59ce[_0x918df1(0x1db)]===_0x918df1(0x1fc))[_0x918df1(0x1a3)]((_0x18f26c,_0x56cfe6)=>_0x18f26c+_0x56cfe6[_0x918df1(0x1b7)],0x0),_0x5af812=_0x1258c6[_0x918df1(0x1a3)]((_0x4ff9da,_0x3e86ef)=>{const _0x427646=_0x918df1;return _0x4ff9da[_0x3e86ef[_0x427646(0x17e)]]=(_0x4ff9da[_0x3e86ef[_0x427646(0x17e)]]||0x0)+0x1,_0x4ff9da;},{}),_0x24612b=_0x1258c6[_0x918df1(0x1a3)]((_0x284194,_0x307cae)=>{const _0x18fe35=_0x918df1;return _0x284194[_0x307cae[_0x18fe35(0x1db)]]=(_0x284194[_0x307cae[_0x18fe35(0x1db)]]||0x0)+0x1,_0x284194;},{});return{'totalPayouts':_0x28338b,'completedPayouts':_0x1d2e17,'pendingPayouts':_0x3fd466,'rejectedPayouts':_0x3b3785,'totalAmount':_0x231053,'completedAmount':_0x5a4016,'pendingAmount':_0xe024f7,'payoutsByMethod':_0x5af812,'payoutsByStatus':_0x24612b,'recentPayouts':_0x357912[_0x918df1(0x202)](_0x5862d8=>({'id':_0x5862d8['id'],'shopId':_0x315c49,'amount':_0x5862d8['amount'],'method':_0x5862d8[_0x918df1(0x17e)],'status':_0x5862d8['status'],'txid':_0x5862d8[_0x918df1(0x1de)],'createdAt':_0x5862d8['createdAt'],'paidAt':_0x5862d8[_0x918df1(0x1c6)]}))};}async[a54_0x86b8e2(0x1fe)](_0x37d569){const _0x2cf20b=a54_0x86b8e2;console[_0x2cf20b(0x1dd)](_0x2cf20b(0x1f1)+_0x37d569+_0x2cf20b(0x1e3));const _0x510f24=await database_1[_0x2cf20b(0x207)][_0x2cf20b(0x1be)][_0x2cf20b(0x17c)]({'where':{'id':_0x37d569},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x510f24)throw new Error('Shop\x20not\x20found');const _0x3323bb=new Date(),_0x975c6c=new Date(_0x3323bb[_0x2cf20b(0x18f)](),_0x3323bb[_0x2cf20b(0x215)](),0x1),_0x3edf62=new Date(_0x3323bb[_0x2cf20b(0x18f)](),_0x3323bb['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x37ce7e=await database_1[_0x2cf20b(0x207)][_0x2cf20b(0x1a5)][_0x2cf20b(0x1e7)]({'_sum':{'amount':!![]},'where':{'shopId':_0x37d569,'createdAt':{'gte':_0x975c6c,'lte':_0x3edf62},'status':_0x2cf20b(0x1bc)}}),_0x8521ef=_0x37ce7e['_sum'][_0x2cf20b(0x1b7)]||0x0,_0x5b8207={'availableBalance':Math[_0x2cf20b(0x19e)](_0x510f24[_0x2cf20b(0x1d9)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x510f24[_0x2cf20b(0x176)]*0x64)/0x64,'awaitingPayout':Math[_0x2cf20b(0x19e)](_0x510f24[_0x2cf20b(0x1d9)]*0x64)/0x64,'thisMonth':Math[_0x2cf20b(0x19e)](_0x8521ef*0x64)/0x64};return console[_0x2cf20b(0x1dd)](_0x2cf20b(0x1ca)+_0x510f24[_0x2cf20b(0x1c5)]+'\x20payout\x20statistics\x20calculated:'),console[_0x2cf20b(0x1dd)](_0x2cf20b(0x1a4)+_0x5b8207['availableBalance']+_0x2cf20b(0x189)),console[_0x2cf20b(0x1dd)](_0x2cf20b(0x20c)+_0x5b8207[_0x2cf20b(0x176)]+_0x2cf20b(0x19c)),console[_0x2cf20b(0x1dd)](_0x2cf20b(0x1ad)+_0x5b8207[_0x2cf20b(0x1d4)]+_0x2cf20b(0x189)),console['log'](_0x2cf20b(0x1aa)+_0x5b8207[_0x2cf20b(0x1ba)]+_0x2cf20b(0x185)),_0x5b8207;}[a54_0x86b8e2(0x1ac)](_0x37baba){const _0x50fb2e=a54_0x86b8e2,_0x3c7390={'test_gateway':'Test\x20Gateway','plisio':_0x50fb2e(0x1c1),'rapyd':_0x50fb2e(0x1c4),'noda':_0x50fb2e(0x192),'cointopay':'CoinToPay','klyme_eu':_0x50fb2e(0x213),'klyme_gb':_0x50fb2e(0x179),'klyme_de':_0x50fb2e(0x19a)};return _0x3c7390[_0x37baba]||_0x37baba;}async[a54_0x86b8e2(0x1e1)](_0x8ace8c){const _0x439c7b=a54_0x86b8e2;return this[_0x439c7b(0x1fe)](_0x8ace8c);}async[a54_0x86b8e2(0x211)](_0xf40b18,_0x205569){const _0x286d8b=a54_0x86b8e2,{page:_0x509c3b,limit:_0x3097f9,paymentId:_0x355253}=_0x205569,_0x387850=(_0x509c3b-0x1)*_0x3097f9,_0x5e80d3={'shopId':_0xf40b18};_0x355253&&(_0x5e80d3['paymentId']=_0x355253);const [_0x388fb2,_0x5f321c]=await Promise[_0x286d8b(0x21c)]([database_1[_0x286d8b(0x207)][_0x286d8b(0x174)][_0x286d8b(0x1d0)]({'where':_0x5e80d3,'skip':_0x387850,'take':_0x3097f9,'orderBy':{'createdAt':_0x286d8b(0x1d5)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x286d8b(0x207)][_0x286d8b(0x174)]['count']({'where':_0x5e80d3})]);return{'logs':_0x388fb2['map'](_0x31e42b=>({'id':_0x31e42b['id'],'paymentId':_0x31e42b[_0x286d8b(0x199)],'shopId':_0x31e42b['shopId'],'event':_0x31e42b[_0x286d8b(0x16e)],'statusCode':_0x31e42b[_0x286d8b(0x1fa)],'retryCount':_0x31e42b[_0x286d8b(0x1af)],'responseBody':_0x31e42b[_0x286d8b(0x1cb)],'createdAt':_0x31e42b[_0x286d8b(0x208)],'payment':_0x31e42b['payment']})),'pagination':{'page':_0x509c3b,'limit':_0x3097f9,'total':_0x5f321c,'totalPages':Math[_0x286d8b(0x1f9)](_0x5f321c/_0x3097f9)}};}async[a54_0x86b8e2(0x1a9)](_0x950ee3,_0x4fd14d){const _0x11edbc=a54_0x86b8e2,_0x23c0df=new Date();let _0x5dcdec;switch(_0x4fd14d){case'7d':_0x5dcdec=new Date(_0x23c0df[_0x11edbc(0x1d2)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x11edbc(0x177):_0x5dcdec=new Date(_0x23c0df['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x11edbc(0x18e):_0x5dcdec=new Date(_0x23c0df[_0x11edbc(0x1d2)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5dcdec=new Date(_0x23c0df[_0x11edbc(0x1d2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x6add69,_0x2eac4d,_0x32d029,_0x35ab63,_0x2eb010]=await Promise[_0x11edbc(0x21c)]([database_1['default'][_0x11edbc(0x210)][_0x11edbc(0x1fb)]({'where':{'shopId':_0x950ee3,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x5dcdec}}}),database_1['default'][_0x11edbc(0x210)][_0x11edbc(0x1fb)]({'where':{'shopId':_0x950ee3,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0x5dcdec}}}),database_1['default'][_0x11edbc(0x210)][_0x11edbc(0x1d0)]({'where':{'shopId':_0x950ee3,'gateway':{'not':_0x11edbc(0x182)},'status':_0x11edbc(0x20d),'createdAt':{'gte':_0x5dcdec}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x11edbc(0x210)][_0x11edbc(0x1d0)]({'where':{'shopId':_0x950ee3,'gateway':{'not':_0x11edbc(0x182)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x11edbc(0x207)][_0x11edbc(0x210)][_0x11edbc(0x1d0)]({'where':{'shopId':_0x950ee3,'gateway':{'not':_0x11edbc(0x182)},'createdAt':{'gte':_0x5dcdec}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x11edbc(0x1c0)}})]);let _0x452727=0x0;for(const _0x20b18f of _0x32d029){if(_0x20b18f[_0x11edbc(0x1a6)])_0x452727+=_0x20b18f['amountUSDT'];else{const _0x1f89c3=await currencyService_1[_0x11edbc(0x1e6)][_0x11edbc(0x17a)](_0x20b18f[_0x11edbc(0x1b7)],_0x20b18f[_0x11edbc(0x1ef)]);_0x452727+=_0x1f89c3;}}const _0x475cc6=this['generateDailyStatistics'](_0x2eb010,_0x5dcdec,_0x23c0df),_0x133635=_0x6add69>0x0?_0x2eac4d/_0x6add69*0x64:0x0;return{'totalPayments':_0x6add69,'successfulPayments':_0x2eac4d,'totalRevenue':Math[_0x11edbc(0x19e)](_0x452727*0x64)/0x64,'conversionRate':Math[_0x11edbc(0x19e)](_0x133635*0x64)/0x64,'dailyRevenue':_0x475cc6[_0x11edbc(0x181)],'dailyPayments':_0x475cc6[_0x11edbc(0x187)],'recentPayments':_0x35ab63['map'](_0x25599e=>({'id':_0x25599e['id'],'gateway':_0x25599e[_0x11edbc(0x21b)],'amount':_0x25599e[_0x11edbc(0x1b7)],'currency':_0x25599e['currency'],'status':_0x25599e[_0x11edbc(0x1db)],'createdAt':_0x25599e[_0x11edbc(0x208)]}))};}[a54_0x86b8e2(0x16d)](_0x2a872c,_0x3de716,_0x4f2ead){const _0x2fbfcd=a54_0x86b8e2,_0x169d52=new Map(),_0x462fd4=new Date(_0x3de716);while(_0x462fd4<=_0x4f2ead){const _0x537420=_0x462fd4[_0x2fbfcd(0x1ed)]()[_0x2fbfcd(0x17f)]('T')[0x0];_0x169d52[_0x2fbfcd(0x172)](_0x537420,{'revenue':0x0,'count':0x0}),_0x462fd4[_0x2fbfcd(0x1f4)](_0x462fd4[_0x2fbfcd(0x19f)]()+0x1);}for(const _0x8be1e2 of _0x2a872c){const _0x1ef3dd=_0x8be1e2['createdAt'][_0x2fbfcd(0x1ed)]()['split']('T')[0x0],_0x48560b=_0x169d52[_0x2fbfcd(0x209)](_0x1ef3dd);_0x48560b&&(_0x48560b[_0x2fbfcd(0x1fb)]+=0x1,_0x8be1e2[_0x2fbfcd(0x1db)]===_0x2fbfcd(0x20d)&&_0x8be1e2[_0x2fbfcd(0x1a6)]&&(_0x48560b[_0x2fbfcd(0x1f8)]+=_0x8be1e2[_0x2fbfcd(0x1a6)]));}const _0x696047=[],_0x3a1ce0=[];for(const [_0x92a51d,_0x38a8cd]of _0x169d52){_0x696047[_0x2fbfcd(0x1d6)]({'date':_0x92a51d,'amount':Math[_0x2fbfcd(0x19e)](_0x38a8cd[_0x2fbfcd(0x1f8)]*0x64)/0x64}),_0x3a1ce0[_0x2fbfcd(0x1d6)]({'date':_0x92a51d,'count':_0x38a8cd['count']});}return{'dailyRevenue':_0x696047,'dailyPayments':_0x3a1ce0};}}exports[a54_0x86b8e2(0x1b9)]=ShopService;