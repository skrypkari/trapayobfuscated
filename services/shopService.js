'use strict';const a56_0x3b2f46=a56_0x32e2;(function(_0x598b74,_0x1b1150){const _0x556799=a56_0x32e2,_0x45261f=_0x598b74();while(!![]){try{const _0x3ecb94=parseInt(_0x556799(0x1e4))/0x1*(parseInt(_0x556799(0x1db))/0x2)+parseInt(_0x556799(0x153))/0x3+parseInt(_0x556799(0x16b))/0x4*(parseInt(_0x556799(0x1b4))/0x5)+-parseInt(_0x556799(0x1a0))/0x6+-parseInt(_0x556799(0x1d7))/0x7+parseInt(_0x556799(0x1aa))/0x8*(parseInt(_0x556799(0x1d5))/0x9)+-parseInt(_0x556799(0x1c6))/0xa;if(_0x3ecb94===_0x1b1150)break;else _0x45261f['push'](_0x45261f['shift']());}catch(_0x46df34){_0x45261f['push'](_0x45261f['shift']());}}}(a56_0x283c,0xe0532));var __importDefault=this&&this[a56_0x3b2f46(0x141)]||function(_0x194293){const _0x5d66c2=a56_0x3b2f46;return _0x194293&&_0x194293[_0x5d66c2(0x1a9)]?_0x194293:{'default':_0x194293};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a56_0x3b2f46(0x15e)]=void 0x0;function a56_0x32e2(_0x8fe7d7,_0x34cdba){const _0x283cd2=a56_0x283c();return a56_0x32e2=function(_0x32e271,_0x3c051e){_0x32e271=_0x32e271-0x13d;let _0x40714c=_0x283cd2[_0x32e271];return _0x40714c;},a56_0x32e2(_0x8fe7d7,_0x34cdba);}const database_1=__importDefault(require('../config/database')),currencyService_1=require('./currencyService'),paymentService_1=require('./paymentService');class ShopService{constructor(){const _0x585a03=a56_0x3b2f46;this['paymentService']=new paymentService_1[(_0x585a03(0x1e6))]();}async[a56_0x3b2f46(0x1a8)](_0x51d95d){const _0x52acbf=a56_0x3b2f46,_0x5bed4e=await database_1[_0x52acbf(0x185)]['shop'][_0x52acbf(0x178)]({'where':{'id':_0x51d95d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x5bed4e)throw new Error('Shop\x20not\x20found');let _0x137287=[];if(_0x5bed4e[_0x52acbf(0x1e1)]?.[_0x52acbf(0x1ab)])try{_0x137287=Array[_0x52acbf(0x1c1)](_0x5bed4e[_0x52acbf(0x1e1)][_0x52acbf(0x1ab)])?_0x5bed4e[_0x52acbf(0x1e1)]['webhookEvents']:JSON['parse'](_0x5bed4e['settings'][_0x52acbf(0x1ab)]);}catch(_0x21f792){console['error']('Error\x20parsing\x20webhook\x20events:',_0x21f792),_0x137287=[];}return{'id':_0x5bed4e['id'],'fullName':_0x5bed4e['name'],'username':_0x5bed4e[_0x52acbf(0x14b)],'telegramId':_0x5bed4e[_0x52acbf(0x148)],'merchantUrl':_0x5bed4e[_0x52acbf(0x1bb)],'gateways':_0x5bed4e['paymentGateways']?JSON['parse'](_0x5bed4e[_0x52acbf(0x1b6)]):null,'gatewaySettings':_0x5bed4e[_0x52acbf(0x152)]?JSON[_0x52acbf(0x16d)](_0x5bed4e[_0x52acbf(0x152)]):null,'publicKey':_0x5bed4e[_0x52acbf(0x1ad)],'webhookUrl':_0x5bed4e['settings']?.['webhookUrl']||null,'webhookEvents':_0x137287,'wallets':{'usdtPolygonWallet':_0x5bed4e[_0x52acbf(0x187)],'usdtTrcWallet':_0x5bed4e[_0x52acbf(0x1cc)],'usdtErcWallet':_0x5bed4e[_0x52acbf(0x1e0)],'usdcPolygonWallet':_0x5bed4e[_0x52acbf(0x19a)]},'status':_0x5bed4e['status'],'createdAt':_0x5bed4e['createdAt']};}async[a56_0x3b2f46(0x1c4)](_0x526173,_0x2db6b9){const _0x1a286c=a56_0x3b2f46,_0x5a5b94={};_0x2db6b9[_0x1a286c(0x198)]&&(_0x5a5b94[_0x1a286c(0x142)]=_0x2db6b9[_0x1a286c(0x198)]);_0x2db6b9[_0x1a286c(0x1a1)]!==undefined&&(_0x5a5b94[_0x1a286c(0x148)]=_0x2db6b9[_0x1a286c(0x1a1)]||null);_0x2db6b9[_0x1a286c(0x1de)]&&(_0x5a5b94[_0x1a286c(0x1bb)]=_0x2db6b9[_0x1a286c(0x1de)]);_0x2db6b9[_0x1a286c(0x1b3)]&&(_0x5a5b94['paymentGateways']=JSON['stringify'](_0x2db6b9[_0x1a286c(0x1b3)]));_0x2db6b9[_0x1a286c(0x152)]&&(_0x5a5b94[_0x1a286c(0x152)]=JSON[_0x1a286c(0x197)](_0x2db6b9['gatewaySettings']));_0x2db6b9[_0x1a286c(0x15c)]&&(_0x2db6b9[_0x1a286c(0x15c)]['usdtPolygonWallet']!==undefined&&(_0x5a5b94[_0x1a286c(0x187)]=_0x2db6b9[_0x1a286c(0x15c)]['usdtPolygonWallet']||null),_0x2db6b9[_0x1a286c(0x15c)][_0x1a286c(0x1cc)]!==undefined&&(_0x5a5b94[_0x1a286c(0x1cc)]=_0x2db6b9[_0x1a286c(0x15c)]['usdtTrcWallet']||null),_0x2db6b9['wallets'][_0x1a286c(0x1e0)]!==undefined&&(_0x5a5b94[_0x1a286c(0x1e0)]=_0x2db6b9[_0x1a286c(0x15c)]['usdtErcWallet']||null),_0x2db6b9['wallets']['usdcPolygonWallet']!==undefined&&(_0x5a5b94['usdcPolygonWallet']=_0x2db6b9['wallets'][_0x1a286c(0x19a)]||null));const _0x541e12=await database_1[_0x1a286c(0x185)][_0x1a286c(0x1d3)][_0x1a286c(0x181)]({'where':{'id':_0x526173},'data':_0x5a5b94,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0xbe6624=[];if(_0x541e12[_0x1a286c(0x1e1)]?.[_0x1a286c(0x1ab)])try{_0xbe6624=Array[_0x1a286c(0x1c1)](_0x541e12[_0x1a286c(0x1e1)][_0x1a286c(0x1ab)])?_0x541e12[_0x1a286c(0x1e1)][_0x1a286c(0x1ab)]:JSON[_0x1a286c(0x16d)](_0x541e12[_0x1a286c(0x1e1)][_0x1a286c(0x1ab)]);}catch(_0x431f25){console[_0x1a286c(0x166)](_0x1a286c(0x146),_0x431f25),_0xbe6624=[];}return{'id':_0x541e12['id'],'fullName':_0x541e12['name'],'username':_0x541e12[_0x1a286c(0x14b)],'telegramId':_0x541e12[_0x1a286c(0x148)],'merchantUrl':_0x541e12[_0x1a286c(0x1bb)],'gateways':_0x541e12['paymentGateways']?JSON[_0x1a286c(0x16d)](_0x541e12[_0x1a286c(0x1b6)]):null,'gatewaySettings':_0x541e12['gatewaySettings']?JSON[_0x1a286c(0x16d)](_0x541e12[_0x1a286c(0x152)]):null,'publicKey':_0x541e12[_0x1a286c(0x1ad)],'webhookUrl':_0x541e12[_0x1a286c(0x1e1)]?.['webhookUrl']||null,'webhookEvents':_0xbe6624,'wallets':{'usdtPolygonWallet':_0x541e12[_0x1a286c(0x187)],'usdtTrcWallet':_0x541e12[_0x1a286c(0x1cc)],'usdtErcWallet':_0x541e12[_0x1a286c(0x1e0)],'usdcPolygonWallet':_0x541e12['usdcPolygonWallet']},'status':_0x541e12['status'],'createdAt':_0x541e12[_0x1a286c(0x155)]};}async['updateWallets'](_0x9d2632,_0x23abd9){const _0x3880ae=a56_0x3b2f46,_0x543b96={};_0x23abd9['usdtPolygonWallet']!==undefined&&(_0x543b96[_0x3880ae(0x187)]=_0x23abd9['usdtPolygonWallet']||null),_0x23abd9['usdtTrcWallet']!==undefined&&(_0x543b96['usdtTrcWallet']=_0x23abd9[_0x3880ae(0x1cc)]||null),_0x23abd9['usdtErcWallet']!==undefined&&(_0x543b96['usdtErcWallet']=_0x23abd9[_0x3880ae(0x1e0)]||null),_0x23abd9[_0x3880ae(0x19a)]!==undefined&&(_0x543b96[_0x3880ae(0x19a)]=_0x23abd9[_0x3880ae(0x19a)]||null),await database_1['default']['shop'][_0x3880ae(0x181)]({'where':{'id':_0x9d2632},'data':_0x543b96});}async[a56_0x3b2f46(0x18c)](_0x53b79f){const _0x24ebf3=a56_0x3b2f46,_0x33b46d=await database_1[_0x24ebf3(0x185)][_0x24ebf3(0x1d3)][_0x24ebf3(0x178)]({'where':{'id':_0x53b79f},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x33b46d?.['settings']?.[_0x24ebf3(0x1a5)])throw new Error(_0x24ebf3(0x1a2));const _0x48dccc={'event':_0x24ebf3(0x13d),'payment':{'id':_0x24ebf3(0x1d8),'order_id':_0x24ebf3(0x15f),'gateway':'test','amount':0x64,'currency':_0x24ebf3(0x18b),'status':_0x24ebf3(0x154),'created_at':new Date()[_0x24ebf3(0x170)]()}};try{const _0x162d15=await fetch(_0x33b46d['settings'][_0x24ebf3(0x1a5)],{'method':_0x24ebf3(0x1cd),'headers':{'Content-Type':'application/json','User-Agent':_0x24ebf3(0x14d)},'body':JSON['stringify'](_0x48dccc)});return _0x162d15['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x162d15[_0x24ebf3(0x19b)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x162d15[_0x24ebf3(0x19b)]+'\x20'+_0x162d15[_0x24ebf3(0x1d9)]};}catch(_0x2563b1){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x2563b1 instanceof Error?_0x2563b1[_0x24ebf3(0x1c8)]:_0x24ebf3(0x145))};}}async[a56_0x3b2f46(0x17b)](_0x457ce1){const _0x1fcfed=a56_0x3b2f46;return this[_0x1fcfed(0x1d4)]['createPublicPayment']({'public_key':'','gateway':_0x457ce1['gateway'],'order_id':undefined,'amount':_0x457ce1[_0x1fcfed(0x1b8)],'currency':_0x457ce1[_0x1fcfed(0x1bf)],'source_currency':_0x457ce1[_0x1fcfed(0x17f)],'usage':_0x457ce1['usage'],'expires_at':_0x457ce1[_0x1fcfed(0x144)]?.[_0x1fcfed(0x170)](),'success_url':_0x457ce1['redirectUrl'],'fail_url':_0x457ce1['redirectUrl'],'customer_email':_0x457ce1[_0x1fcfed(0x15a)],'customer_name':_0x457ce1[_0x1fcfed(0x1b2)],'country':_0x457ce1['country'],'language':_0x457ce1[_0x1fcfed(0x1a4)],'amount_is_editable':_0x457ce1[_0x1fcfed(0x1c9)],'max_payments':_0x457ce1[_0x1fcfed(0x1b1)],'customer':_0x457ce1[_0x1fcfed(0x19c)]});}async['getPayments'](_0x134ab8,_0x364403){const _0x5a2e8a=a56_0x3b2f46;return this[_0x5a2e8a(0x1d4)][_0x5a2e8a(0x1c2)](_0x134ab8,_0x364403);}async[a56_0x3b2f46(0x1b9)](_0x1bdb16,_0x16a5c4){const _0x10b6f1=a56_0x3b2f46;return this['paymentService'][_0x10b6f1(0x19e)](_0x1bdb16,_0x16a5c4);}async[a56_0x3b2f46(0x1dc)](_0x1042ed,_0x559de1,_0x1a0db0){const _0x2eb844=a56_0x3b2f46,_0x2490f5=await database_1[_0x2eb844(0x185)]['payment'][_0x2eb844(0x161)]({'where':{'id':_0x559de1,'shopId':_0x1042ed}});if(!_0x2490f5)throw new Error(_0x2eb844(0x1be));const _0x4c9515=await database_1[_0x2eb844(0x185)][_0x2eb844(0x14e)]['update']({'where':{'id':_0x559de1},'data':{..._0x1a0db0,'updatedAt':new Date()}});return _0x4c9515;}async[a56_0x3b2f46(0x151)](_0x593f81,_0x52ac1a){const _0x4f3996=a56_0x3b2f46,_0x39b688=await database_1[_0x4f3996(0x185)][_0x4f3996(0x14e)][_0x4f3996(0x161)]({'where':{'id':_0x52ac1a,'shopId':_0x593f81}});if(!_0x39b688)throw new Error(_0x4f3996(0x1be));await database_1[_0x4f3996(0x185)][_0x4f3996(0x14e)][_0x4f3996(0x14c)]({'where':{'id':_0x52ac1a}});}[a56_0x3b2f46(0x172)](_0x4ba0ef){const _0xb9854e=a56_0x3b2f46,_0x2f9248={'polygon':_0xb9854e(0x1d2),'trc20':_0xb9854e(0x193),'erc20':_0xb9854e(0x1d0),'bsc':_0xb9854e(0x1e5),'polygon_usdc':_0xb9854e(0x14a)};return _0x2f9248[_0x4ba0ef]||_0x4ba0ef;}async[a56_0x3b2f46(0x150)](_0x1ea430,_0x90ab5a){const _0x402201=a56_0x3b2f46,{page:_0x4029cf,limit:_0x569661,status:_0x2a3407,method:_0x53f0c4,network:_0x46f801,dateFrom:_0x645aac,dateTo:_0x110896,periodFrom:_0x63dce9,periodTo:_0x484bac}=_0x90ab5a,_0x1ba019=(_0x4029cf-0x1)*_0x569661;console[_0x402201(0x1af)](_0x402201(0x1b0),_0x90ab5a);const _0x47d2bc={'shopId':_0x1ea430};_0x2a3407&&(_0x47d2bc[_0x402201(0x19b)]=_0x2a3407[_0x402201(0x1d1)](),console[_0x402201(0x1af)](_0x402201(0x190)+_0x2a3407[_0x402201(0x1d1)]()));if(_0x53f0c4)_0x47d2bc['network']=_0x53f0c4,console[_0x402201(0x1af)](_0x402201(0x19f)+_0x53f0c4);else _0x46f801&&(_0x47d2bc[_0x402201(0x169)]=_0x46f801,console['log']('🌐\x20Network\x20filter:\x20'+_0x46f801));if(_0x645aac||_0x110896||_0x63dce9||_0x484bac){_0x47d2bc[_0x402201(0x155)]={};if(_0x63dce9){const _0x3b313b=new Date(_0x63dce9);_0x3b313b[_0x402201(0x16e)](0x0,0x0,0x0,0x0),_0x47d2bc['createdAt'][_0x402201(0x1b7)]=_0x3b313b,console[_0x402201(0x1af)](_0x402201(0x157)+_0x3b313b[_0x402201(0x170)]());}else{if(_0x645aac){const _0x1de95e=new Date(_0x645aac);_0x1de95e[_0x402201(0x16e)](0x0,0x0,0x0,0x0),_0x47d2bc['createdAt'][_0x402201(0x1b7)]=_0x1de95e,console['log'](_0x402201(0x179)+_0x1de95e['toISOString']());}}if(_0x484bac){const _0x2218f8=new Date(_0x484bac);_0x2218f8[_0x402201(0x16e)](0x17,0x3b,0x3b,0x3e7),_0x47d2bc[_0x402201(0x155)][_0x402201(0x1ca)]=_0x2218f8,console[_0x402201(0x1af)](_0x402201(0x18e)+_0x2218f8[_0x402201(0x170)]());}else{if(_0x110896){const _0x3eea15=new Date(_0x110896);_0x3eea15['setHours'](0x17,0x3b,0x3b,0x3e7),_0x47d2bc[_0x402201(0x155)][_0x402201(0x1ca)]=_0x3eea15,console[_0x402201(0x1af)](_0x402201(0x17e)+_0x3eea15['toISOString']());}}}console[_0x402201(0x1af)](_0x402201(0x1cb),JSON['stringify'](_0x47d2bc,null,0x2));const [_0x5ac3db,_0x171087]=await Promise[_0x402201(0x1bd)]([database_1[_0x402201(0x185)]['payout']['findMany']({'where':_0x47d2bc,'skip':_0x1ba019,'take':_0x569661,'orderBy':{'createdAt':_0x402201(0x147)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x402201(0x167)]['count']({'where':_0x47d2bc})]);return{'payouts':_0x5ac3db[_0x402201(0x164)](_0x96f8e2=>{const _0x3b7fce=_0x402201;let _0x49a79e=null;switch(_0x96f8e2[_0x3b7fce(0x169)]){case _0x3b7fce(0x192):_0x49a79e=_0x96f8e2[_0x3b7fce(0x1d3)]['usdtPolygonWallet'];break;case _0x3b7fce(0x156):_0x49a79e=_0x96f8e2[_0x3b7fce(0x1d3)][_0x3b7fce(0x1cc)];break;case _0x3b7fce(0x1ce):_0x49a79e=_0x96f8e2[_0x3b7fce(0x1d3)]['usdtErcWallet'];break;case _0x3b7fce(0x168):_0x49a79e=_0x96f8e2['shop'][_0x3b7fce(0x19a)];break;}return{'id':_0x96f8e2['id'],'amount':_0x96f8e2['amount'],'network':this[_0x3b7fce(0x172)](_0x96f8e2[_0x3b7fce(0x169)]),'wallet':_0x49a79e,'status':_0x96f8e2['status'],'txid':_0x96f8e2[_0x3b7fce(0x194)],'notes':_0x96f8e2['notes'],'periodFrom':_0x96f8e2[_0x3b7fce(0x1e7)],'periodTo':_0x96f8e2['periodTo'],'createdAt':_0x96f8e2[_0x3b7fce(0x155)],'paidAt':_0x96f8e2[_0x3b7fce(0x15b)]};}),'pagination':{'page':_0x4029cf,'limit':_0x569661,'total':_0x171087,'totalPages':Math[_0x402201(0x1cf)](_0x171087/_0x569661)}};}async['getPayoutById'](_0xcecf30,_0x2b05a7){const _0xee34aa=a56_0x3b2f46,_0x365b8b=await database_1[_0xee34aa(0x185)]['payout'][_0xee34aa(0x161)]({'where':{'id':_0x2b05a7,'shopId':_0xcecf30}});if(!_0x365b8b)return null;return{'id':_0x365b8b['id'],'amount':_0x365b8b['amount'],'network':_0x365b8b[_0xee34aa(0x169)],'status':_0x365b8b[_0xee34aa(0x19b)],'txid':_0x365b8b[_0xee34aa(0x194)],'notes':_0x365b8b['notes'],'createdAt':_0x365b8b[_0xee34aa(0x155)],'paidAt':_0x365b8b[_0xee34aa(0x15b)]};}async[a56_0x3b2f46(0x188)](_0x5c3e77,_0x2646bc){const _0x4c17fe=a56_0x3b2f46,_0x314d2c=new Date();let _0x448607;switch(_0x2646bc){case'7d':_0x448607=new Date(_0x314d2c[_0x4c17fe(0x13e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4c17fe(0x158):_0x448607=new Date(_0x314d2c[_0x4c17fe(0x13e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4c17fe(0x160):_0x448607=new Date(_0x314d2c[_0x4c17fe(0x13e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x448607=new Date(_0x314d2c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x64afed,_0x4ddbaa,_0x3972d6,_0x275736,_0x26e9af,_0x2fde99]=await Promise[_0x4c17fe(0x1bd)]([database_1['default'][_0x4c17fe(0x167)][_0x4c17fe(0x149)]({'where':{'shopId':_0x5c3e77,'createdAt':{'gte':_0x448607}}}),database_1[_0x4c17fe(0x185)][_0x4c17fe(0x167)][_0x4c17fe(0x149)]({'where':{'shopId':_0x5c3e77,'status':_0x4c17fe(0x171),'createdAt':{'gte':_0x448607}}}),database_1[_0x4c17fe(0x185)]['payout'][_0x4c17fe(0x149)]({'where':{'shopId':_0x5c3e77,'status':_0x4c17fe(0x1ba),'createdAt':{'gte':_0x448607}}}),database_1[_0x4c17fe(0x185)]['payout'][_0x4c17fe(0x149)]({'where':{'shopId':_0x5c3e77,'status':_0x4c17fe(0x1e3),'createdAt':{'gte':_0x448607}}}),database_1[_0x4c17fe(0x185)][_0x4c17fe(0x167)]['findMany']({'where':{'shopId':_0x5c3e77,'createdAt':{'gte':_0x448607}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x4c17fe(0x185)]['payout'][_0x4c17fe(0x1ae)]({'where':{'shopId':_0x5c3e77},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x169039=_0x26e9af[_0x4c17fe(0x18f)]((_0x27f2d6,_0x2ffa7e)=>_0x27f2d6+_0x2ffa7e[_0x4c17fe(0x1b8)],0x0),_0x29d250=_0x26e9af[_0x4c17fe(0x1a6)](_0x1d7927=>_0x1d7927[_0x4c17fe(0x19b)]===_0x4c17fe(0x171))['reduce']((_0x5b4ebc,_0x9ea434)=>_0x5b4ebc+_0x9ea434[_0x4c17fe(0x1b8)],0x0),_0x5a5bad=_0x26e9af[_0x4c17fe(0x1a6)](_0x3780fc=>_0x3780fc[_0x4c17fe(0x19b)]==='PENDING')[_0x4c17fe(0x18f)]((_0x44c423,_0x2b1da6)=>_0x44c423+_0x2b1da6['amount'],0x0),_0x2132bd=_0x26e9af[_0x4c17fe(0x18f)]((_0x5205b1,_0x35dbf3)=>{const _0x44847c=_0x4c17fe;return _0x5205b1[_0x35dbf3[_0x44847c(0x169)]]=(_0x5205b1[_0x35dbf3[_0x44847c(0x169)]]||0x0)+0x1,_0x5205b1;},{}),_0x542f92=_0x26e9af['reduce']((_0x4314a6,_0x51ce8d)=>{const _0x115d0d=_0x4c17fe;return _0x4314a6[_0x51ce8d[_0x115d0d(0x19b)]]=(_0x4314a6[_0x51ce8d[_0x115d0d(0x19b)]]||0x0)+0x1,_0x4314a6;},{});return{'totalPayouts':_0x64afed,'completedPayouts':_0x4ddbaa,'pendingPayouts':_0x3972d6,'rejectedPayouts':_0x275736,'totalAmount':_0x169039,'completedAmount':_0x29d250,'pendingAmount':_0x5a5bad,'payoutsByMethod':_0x2132bd,'payoutsByStatus':_0x542f92,'recentPayouts':_0x2fde99[_0x4c17fe(0x164)](_0x2c3b4a=>({'id':_0x2c3b4a['id'],'shopId':_0x5c3e77,'amount':_0x2c3b4a['amount'],'method':_0x2c3b4a[_0x4c17fe(0x169)],'status':_0x2c3b4a[_0x4c17fe(0x19b)],'txid':_0x2c3b4a[_0x4c17fe(0x194)],'createdAt':_0x2c3b4a[_0x4c17fe(0x155)],'paidAt':_0x2c3b4a[_0x4c17fe(0x15b)]}))};}async[a56_0x3b2f46(0x1a7)](_0x342048){const _0x2ef5ff=a56_0x3b2f46;console[_0x2ef5ff(0x1af)](_0x2ef5ff(0x1dd)+_0x342048+'...');const _0x112fda=await database_1[_0x2ef5ff(0x185)][_0x2ef5ff(0x1d3)][_0x2ef5ff(0x178)]({'where':{'id':_0x342048},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x112fda)throw new Error(_0x2ef5ff(0x19d));const _0x34044a=new Date(),_0x1bb43b=new Date(_0x34044a[_0x2ef5ff(0x174)](),_0x34044a['getMonth'](),0x1),_0x59926b=new Date(_0x34044a[_0x2ef5ff(0x174)](),_0x34044a[_0x2ef5ff(0x191)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4fe01d=await database_1[_0x2ef5ff(0x185)][_0x2ef5ff(0x167)][_0x2ef5ff(0x1df)]({'_sum':{'amount':!![]},'where':{'shopId':_0x342048,'createdAt':{'gte':_0x1bb43b,'lte':_0x59926b},'status':_0x2ef5ff(0x171)}}),_0x1fb7e4=_0x4fe01d['_sum'][_0x2ef5ff(0x1b8)]||0x0,_0x4c7a68={'availableBalance':Math['round'](_0x112fda[_0x2ef5ff(0x18d)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x112fda[_0x2ef5ff(0x1d6)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x112fda[_0x2ef5ff(0x18d)]*0x64)/0x64,'thisMonth':Math[_0x2ef5ff(0x1e8)](_0x1fb7e4*0x64)/0x64};return console[_0x2ef5ff(0x1af)](_0x2ef5ff(0x1ac)+_0x112fda[_0x2ef5ff(0x14b)]+_0x2ef5ff(0x184)),console['log'](_0x2ef5ff(0x1c5)+_0x4c7a68[_0x2ef5ff(0x162)]+'\x20USDT\x20(current\x20balance)'),console[_0x2ef5ff(0x1af)](_0x2ef5ff(0x140)+_0x4c7a68['totalPaidOut']+_0x2ef5ff(0x159)),console[_0x2ef5ff(0x1af)](_0x2ef5ff(0x186)+_0x4c7a68[_0x2ef5ff(0x1b5)]+_0x2ef5ff(0x165)),console[_0x2ef5ff(0x1af)](_0x2ef5ff(0x196)+_0x4c7a68['thisMonth']+'\x20USDT'),_0x4c7a68;}[a56_0x3b2f46(0x13f)](_0x143c14){const _0x506945=a56_0x3b2f46,_0x5a5633={'test_gateway':_0x506945(0x183),'plisio':_0x506945(0x16a),'rapyd':'Rapyd','noda':'Noda','cointopay':_0x506945(0x173),'klyme_eu':_0x506945(0x17a),'klyme_gb':_0x506945(0x199),'klyme_de':_0x506945(0x14f)};return _0x5a5633[_0x143c14]||_0x143c14;}async[a56_0x3b2f46(0x143)](_0x42b15a){const _0x470134=a56_0x3b2f46;return this[_0x470134(0x1a7)](_0x42b15a);}async[a56_0x3b2f46(0x163)](_0x5e4030,_0x4ded48){const _0x107245=a56_0x3b2f46,{page:_0x35a9d1,limit:_0x4f4483,paymentId:_0x890cb5}=_0x4ded48,_0x5db42f=(_0x35a9d1-0x1)*_0x4f4483,_0x509df1={'shopId':_0x5e4030};_0x890cb5&&(_0x509df1[_0x107245(0x175)]=_0x890cb5);const [_0x30ac0b,_0x55547b]=await Promise[_0x107245(0x1bd)]([database_1[_0x107245(0x185)]['webhookLog'][_0x107245(0x1ae)]({'where':_0x509df1,'skip':_0x5db42f,'take':_0x4f4483,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x107245(0x185)][_0x107245(0x177)][_0x107245(0x149)]({'where':_0x509df1})]);return{'logs':_0x30ac0b['map'](_0x2026c3=>({'id':_0x2026c3['id'],'paymentId':_0x2026c3[_0x107245(0x175)],'shopId':_0x2026c3['shopId'],'event':_0x2026c3[_0x107245(0x16c)],'statusCode':_0x2026c3['statusCode'],'retryCount':_0x2026c3[_0x107245(0x1bc)],'responseBody':_0x2026c3['responseBody'],'createdAt':_0x2026c3[_0x107245(0x155)],'payment':_0x2026c3['payment']})),'pagination':{'page':_0x35a9d1,'limit':_0x4f4483,'total':_0x55547b,'totalPages':Math['ceil'](_0x55547b/_0x4f4483)}};}async['getStatistics'](_0x114931,_0xa45849){const _0x328dd5=a56_0x3b2f46,_0x1093aa=new Date();let _0x160cd1;switch(_0xa45849){case'7d':_0x160cd1=new Date(_0x1093aa[_0x328dd5(0x13e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x328dd5(0x158):_0x160cd1=new Date(_0x1093aa[_0x328dd5(0x13e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x160cd1=new Date(_0x1093aa[_0x328dd5(0x13e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x160cd1=new Date(_0x1093aa[_0x328dd5(0x13e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4173a8,_0x5b335e,_0x2f4c6c,_0x445ac0,_0x554b6b]=await Promise[_0x328dd5(0x1bd)]([database_1[_0x328dd5(0x185)][_0x328dd5(0x14e)][_0x328dd5(0x149)]({'where':{'shopId':_0x114931,'gateway':{'not':_0x328dd5(0x1a3)},'createdAt':{'gte':_0x160cd1}}}),database_1['default']['payment'][_0x328dd5(0x149)]({'where':{'shopId':_0x114931,'gateway':{'not':_0x328dd5(0x1a3)},'status':_0x328dd5(0x1da),'createdAt':{'gte':_0x160cd1}}}),database_1[_0x328dd5(0x185)][_0x328dd5(0x14e)][_0x328dd5(0x1ae)]({'where':{'shopId':_0x114931,'gateway':{'not':_0x328dd5(0x1a3)},'status':_0x328dd5(0x1da),'createdAt':{'gte':_0x160cd1}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x328dd5(0x185)][_0x328dd5(0x14e)][_0x328dd5(0x1ae)]({'where':{'shopId':_0x114931,'gateway':{'not':_0x328dd5(0x1a3)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x328dd5(0x185)][_0x328dd5(0x14e)][_0x328dd5(0x1ae)]({'where':{'shopId':_0x114931,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x160cd1}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x328dd5(0x1c7)}})]);let _0x4a0781=0x0;for(const _0x1be045 of _0x2f4c6c){if(_0x1be045['amountUSDT'])_0x4a0781+=_0x1be045[_0x328dd5(0x1e2)];else{const _0xd40efd=await currencyService_1['currencyService'][_0x328dd5(0x15d)](_0x1be045[_0x328dd5(0x1b8)],_0x1be045[_0x328dd5(0x1bf)]);_0x4a0781+=_0xd40efd;}}const _0x15e35f=this[_0x328dd5(0x16f)](_0x554b6b,_0x160cd1,_0x1093aa),_0x4ec0e0=_0x4173a8>0x0?_0x5b335e/_0x4173a8*0x64:0x0;return{'totalPayments':_0x4173a8,'successfulPayments':_0x5b335e,'totalRevenue':Math[_0x328dd5(0x1e8)](_0x4a0781*0x64)/0x64,'conversionRate':Math[_0x328dd5(0x1e8)](_0x4ec0e0*0x64)/0x64,'dailyRevenue':_0x15e35f[_0x328dd5(0x180)],'dailyPayments':_0x15e35f[_0x328dd5(0x1c3)],'recentPayments':_0x445ac0[_0x328dd5(0x164)](_0x30114b=>({'id':_0x30114b['id'],'gateway':_0x30114b[_0x328dd5(0x189)],'amount':_0x30114b['amount'],'currency':_0x30114b[_0x328dd5(0x1bf)],'status':_0x30114b['status'],'createdAt':_0x30114b[_0x328dd5(0x155)]}))};}[a56_0x3b2f46(0x16f)](_0x1deba9,_0x5e150e,_0x570414){const _0x567a7f=a56_0x3b2f46,_0x33625e=new Map(),_0x4d9377=new Date(_0x5e150e);while(_0x4d9377<=_0x570414){const _0x598e9a=_0x4d9377['toISOString']()[_0x567a7f(0x17c)]('T')[0x0];_0x33625e[_0x567a7f(0x182)](_0x598e9a,{'revenue':0x0,'count':0x0}),_0x4d9377[_0x567a7f(0x1c0)](_0x4d9377[_0x567a7f(0x195)]()+0x1);}for(const _0x8b7592 of _0x1deba9){const _0x37c3d2=_0x8b7592[_0x567a7f(0x155)]['toISOString']()[_0x567a7f(0x17c)]('T')[0x0],_0x185d5c=_0x33625e[_0x567a7f(0x17d)](_0x37c3d2);_0x185d5c&&(_0x185d5c[_0x567a7f(0x149)]+=0x1,_0x8b7592['status']===_0x567a7f(0x1da)&&_0x8b7592[_0x567a7f(0x1e2)]&&(_0x185d5c[_0x567a7f(0x18a)]+=_0x8b7592[_0x567a7f(0x1e2)]));}const _0x5efd6c=[],_0x322e43=[];for(const [_0x291655,_0x1c1554]of _0x33625e){_0x5efd6c[_0x567a7f(0x176)]({'date':_0x291655,'amount':Math[_0x567a7f(0x1e8)](_0x1c1554[_0x567a7f(0x18a)]*0x64)/0x64}),_0x322e43[_0x567a7f(0x176)]({'date':_0x291655,'count':_0x1c1554['count']});}return{'dailyRevenue':_0x5efd6c,'dailyPayments':_0x322e43};}}function a56_0x283c(){const _0x5ac48d=['ShopService','test_order_123','90d','findFirst','availableBalance','getWebhookLogs','map','\x20USDT\x20(current\x20balance)','error','payout','polygon_usdc','network','Plisio','8aGigiP','event','parse','setHours','generateDailyStatistics','toISOString','COMPLETED','formatNetworkName','CoinToPay','getFullYear','paymentId','push','webhookLog','findUnique','📅\x20Date\x20start:\x20','KLYME\x20EU','createPayment','split','get','📅\x20Date\x20end:\x20','sourceCurrency','dailyRevenue','update','set','Test\x20Gateway','\x20payout\x20statistics\x20calculated:','default','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','usdtPolygonWallet','getPayoutStatistics','gateway','revenue','USD','testWebhook','balance','📅\x20Period\x20end:\x20','reduce','📊\x20Status\x20filter:\x20','getMonth','polygon','USDT\x20TRC20','txid','getDate','\x20\x20\x20📅\x20This\x20month:\x20','stringify','fullName','KLYME\x20GB','usdcPolygonWallet','status','customer','Shop\x20not\x20found','getPaymentByShopAndId','🌐\x20Method\x20filter:\x20','1616634YIpWYt','telegramId','No\x20webhook\x20URL\x20configured','test_gateway','language','webhookUrl','filter','getShopPayoutStats','getShopProfile','__esModule','3432XCuKDE','webhookEvents','📊\x20Shop\x20','publicKey','findMany','log','💰\x20Getting\x20payouts\x20with\x20filters:','maxPayments','customerName','gateways','2029220OMPOTX','awaitingPayout','paymentGateways','gte','amount','getPaymentById','PENDING','shopUrl','retryCount','all','Payment\x20not\x20found','currency','setDate','isArray','getPaymentsByShop','dailyPayments','updateShopProfile','\x20\x20\x20💵\x20Available\x20balance:\x20','17974440MUHQSs','asc','message','amountIsEditable','lte','📊\x20Final\x20WHERE\x20conditions:','usdtTrcWallet','POST','erc20','ceil','USDT\x20ERC20','toUpperCase','USDT\x20Polygon','shop','paymentService','33291VsktYV','totalPaidOut','7895398dOUZXp','test_payment_123','statusText','PAID','10ExcGcH','updatePayment','📊\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','merchantUrl','aggregate','usdtErcWallet','settings','amountUSDT','REJECTED','44201kRsTHt','USDT\x20BSC','PaymentService','periodFrom','round','test','getTime','getGatewayDisplayName','\x20\x20\x20💰\x20Total\x20paid\x20out:\x20','__importDefault','name','getPayoutStats','expiresAt','Unknown\x20error','Error\x20parsing\x20webhook\x20events:','desc','telegram','count','USDC\x20Polygon','username','delete','TesSoft\x20Payment\x20System/1.0\x20(Test)','payment','KLYME\x20DE','getPayouts','deletePayment','gatewaySettings','4482201TUwyfD','paid','createdAt','trc20','📅\x20Period\x20start:\x20','30d','\x20USDT\x20(total\x20payouts)','customerEmail','paidAt','wallets','convertToUSDT'];a56_0x283c=function(){return _0x5ac48d;};return a56_0x283c();}exports[a56_0x3b2f46(0x15e)]=ShopService;