'use strict';const a53_0x36e5b0=a53_0x246a;(function(_0x384216,_0xe86a16){const _0x234c76=a53_0x246a,_0x35f6da=_0x384216();while(!![]){try{const _0x350cc5=parseInt(_0x234c76(0x105))/0x1+parseInt(_0x234c76(0x120))/0x2+parseInt(_0x234c76(0xd5))/0x3+parseInt(_0x234c76(0x102))/0x4+-parseInt(_0x234c76(0xea))/0x5*(-parseInt(_0x234c76(0xa2))/0x6)+-parseInt(_0x234c76(0xac))/0x7*(parseInt(_0x234c76(0xd0))/0x8)+-parseInt(_0x234c76(0xb7))/0x9;if(_0x350cc5===_0xe86a16)break;else _0x35f6da['push'](_0x35f6da['shift']());}catch(_0x2ae895){_0x35f6da['push'](_0x35f6da['shift']());}}}(a53_0x452e,0xb3fa2));var __importDefault=this&&this[a53_0x36e5b0(0x104)]||function(_0x54ba08){const _0x3215ff=a53_0x36e5b0;return _0x54ba08&&_0x54ba08[_0x3215ff(0xaa)]?_0x54ba08:{'default':_0x54ba08};};Object['defineProperty'](exports,a53_0x36e5b0(0xaa),{'value':!![]}),exports[a53_0x36e5b0(0xe3)]=void 0x0;function a53_0x452e(){const _0x4bd26e=['PENDING','\x20USDT\x20(current\x20balance)','ShopService','all','delete','COMPLETED','Webhook\x20returned\x20error:\x20','publicKey','formatNetworkName','1782215VkKdqm','language','getPayoutStats','Shop\x20not\x20found','webhookEvents','Failed\x20to\x20send\x20webhook:\x20','fullName','dailyRevenue','createPublicPayment','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','responseBody','getPayoutById','toISOString','findMany','getPayoutStatistics','getWebhookLogs','test_payment_123','generateDailyStatistics','findFirst','USDT\x20BSC','telegram','createdAt','updateWallets','getFullYear','2842760sRgNkP','usdtErcWallet','__importDefault','595246DaMimQ','isArray','balance','split','notes','amountUSDT','USDT\x20ERC20','paidAt','getPayments','getTime','periodFrom','findUnique','message','reduce','shopId','default','log','testWebhook','ceil','currency','set','Rapyd','status','update','map','round','\x20USDT','894132lVtHZn','test_gateway','\x20\x20\x20üìÖ\x20This\x20month:\x20','PaymentService','gateway','\x20USDT\x20(total\x20payouts)','USDC\x20Polygon','Error\x20parsing\x20webhook\x20events:','parse','./paymentService','Plisio','username','expiresAt','KLYME\x20DE','dailyPayments','test','payout','revenue','PAID','filter','push','wallets','statusText','getGatewayDisplayName','redirectUrl','periodTo','deletePayment','webhookLog','awaitingPayout','getPaymentByShopAndId','test_order_123','../config/database','gte','shop','country','18dBzrkv','getPayouts','Test\x20Gateway','asc','createPayment','totalPaidOut','error','availableBalance','__esModule','get','3115SGxNHo','merchantUrl','aggregate','maxPayments','customer','_sum','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','paymentGateways','usdtTrcWallet','Payment\x20not\x20found','getStatistics','22043034AvMliQ','paymentService','txid','setDate','Test\x20webhook\x20sent\x20successfully\x20(','amountIsEditable','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','USDT\x20TRC20','USD','lte','event','getShopPayoutStats','\x20\x20\x20üíµ\x20Available\x20balance:\x20','currencyService','network','CoinToPay','getPaymentById','getDate','desc','gateways','KLYME\x20EU','toUpperCase','count','90d','telegramId','488uGCtyV','\x20payout\x20statistics\x20calculated:','gatewaySettings','shopUrl','settings','1173678cfNwKB','paymentId','getMonth','statusCode','name','stringify','usdcPolygonWallet','payment','webhookUrl','amount','usdtPolygonWallet','30d'];a53_0x452e=function(){return _0x4bd26e;};return a53_0x452e();}const database_1=__importDefault(require(a53_0x36e5b0(0x9e))),currencyService_1=require('./currencyService'),paymentService_1=require(a53_0x36e5b0(0x129));function a53_0x246a(_0x407b43,_0x3a5352){const _0x452e61=a53_0x452e();return a53_0x246a=function(_0x246a75,_0x2c3f91){_0x246a75=_0x246a75-0x9a;let _0x185b79=_0x452e61[_0x246a75];return _0x185b79;},a53_0x246a(_0x407b43,_0x3a5352);}class ShopService{constructor(){const _0x5e9641=a53_0x36e5b0;this['paymentService']=new paymentService_1[(_0x5e9641(0x123))]();}async['getShopProfile'](_0xb1b462){const _0x400b46=a53_0x36e5b0,_0x478250=await database_1[_0x400b46(0x114)][_0x400b46(0xa0)][_0x400b46(0x110)]({'where':{'id':_0xb1b462},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x478250)throw new Error(_0x400b46(0xed));let _0x504064=[];if(_0x478250[_0x400b46(0xd4)]?.[_0x400b46(0xee)])try{_0x504064=Array[_0x400b46(0x106)](_0x478250['settings']['webhookEvents'])?_0x478250['settings'][_0x400b46(0xee)]:JSON[_0x400b46(0x128)](_0x478250[_0x400b46(0xd4)][_0x400b46(0xee)]);}catch(_0x316c89){console[_0x400b46(0xa8)]('Error\x20parsing\x20webhook\x20events:',_0x316c89),_0x504064=[];}return{'id':_0x478250['id'],'fullName':_0x478250['name'],'username':_0x478250[_0x400b46(0x12b)],'telegramId':_0x478250[_0x400b46(0xfe)],'merchantUrl':_0x478250[_0x400b46(0xd3)],'gateways':_0x478250['paymentGateways']?JSON[_0x400b46(0x128)](_0x478250[_0x400b46(0xb3)]):null,'gatewaySettings':_0x478250['gatewaySettings']?JSON[_0x400b46(0x128)](_0x478250[_0x400b46(0xd2)]):null,'publicKey':_0x478250[_0x400b46(0xe8)],'webhookUrl':_0x478250[_0x400b46(0xd4)]?.[_0x400b46(0xdd)]||null,'webhookEvents':_0x504064,'wallets':{'usdtPolygonWallet':_0x478250[_0x400b46(0xdf)],'usdtTrcWallet':_0x478250[_0x400b46(0xb4)],'usdtErcWallet':_0x478250[_0x400b46(0x103)],'usdcPolygonWallet':_0x478250[_0x400b46(0xdb)]},'status':_0x478250[_0x400b46(0x11b)],'createdAt':_0x478250[_0x400b46(0xff)]};}async['updateShopProfile'](_0x287851,_0x5b1604){const _0x4477c7=a53_0x36e5b0,_0x12decb={};_0x5b1604['fullName']&&(_0x12decb['name']=_0x5b1604[_0x4477c7(0xf0)]);_0x5b1604['telegramId']!==undefined&&(_0x12decb['telegram']=_0x5b1604[_0x4477c7(0xcf)]||null);_0x5b1604['merchantUrl']&&(_0x12decb[_0x4477c7(0xd3)]=_0x5b1604[_0x4477c7(0xad)]);_0x5b1604[_0x4477c7(0xca)]&&(_0x12decb[_0x4477c7(0xb3)]=JSON[_0x4477c7(0xda)](_0x5b1604[_0x4477c7(0xca)]));_0x5b1604['gatewaySettings']&&(_0x12decb[_0x4477c7(0xd2)]=JSON[_0x4477c7(0xda)](_0x5b1604['gatewaySettings']));_0x5b1604[_0x4477c7(0x135)]&&(_0x5b1604[_0x4477c7(0x135)]['usdtPolygonWallet']!==undefined&&(_0x12decb['usdtPolygonWallet']=_0x5b1604[_0x4477c7(0x135)]['usdtPolygonWallet']||null),_0x5b1604[_0x4477c7(0x135)]['usdtTrcWallet']!==undefined&&(_0x12decb['usdtTrcWallet']=_0x5b1604[_0x4477c7(0x135)][_0x4477c7(0xb4)]||null),_0x5b1604[_0x4477c7(0x135)][_0x4477c7(0x103)]!==undefined&&(_0x12decb[_0x4477c7(0x103)]=_0x5b1604[_0x4477c7(0x135)][_0x4477c7(0x103)]||null),_0x5b1604['wallets'][_0x4477c7(0xdb)]!==undefined&&(_0x12decb[_0x4477c7(0xdb)]=_0x5b1604[_0x4477c7(0x135)][_0x4477c7(0xdb)]||null));const _0x565617=await database_1[_0x4477c7(0x114)][_0x4477c7(0xa0)][_0x4477c7(0x11c)]({'where':{'id':_0x287851},'data':_0x12decb,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x42799c=[];if(_0x565617[_0x4477c7(0xd4)]?.[_0x4477c7(0xee)])try{_0x42799c=Array[_0x4477c7(0x106)](_0x565617[_0x4477c7(0xd4)][_0x4477c7(0xee)])?_0x565617[_0x4477c7(0xd4)][_0x4477c7(0xee)]:JSON[_0x4477c7(0x128)](_0x565617[_0x4477c7(0xd4)][_0x4477c7(0xee)]);}catch(_0x6fa8b2){console[_0x4477c7(0xa8)](_0x4477c7(0x127),_0x6fa8b2),_0x42799c=[];}return{'id':_0x565617['id'],'fullName':_0x565617[_0x4477c7(0xd9)],'username':_0x565617['username'],'telegramId':_0x565617['telegram'],'merchantUrl':_0x565617['shopUrl'],'gateways':_0x565617[_0x4477c7(0xb3)]?JSON[_0x4477c7(0x128)](_0x565617[_0x4477c7(0xb3)]):null,'gatewaySettings':_0x565617[_0x4477c7(0xd2)]?JSON[_0x4477c7(0x128)](_0x565617[_0x4477c7(0xd2)]):null,'publicKey':_0x565617[_0x4477c7(0xe8)],'webhookUrl':_0x565617[_0x4477c7(0xd4)]?.[_0x4477c7(0xdd)]||null,'webhookEvents':_0x42799c,'wallets':{'usdtPolygonWallet':_0x565617['usdtPolygonWallet'],'usdtTrcWallet':_0x565617['usdtTrcWallet'],'usdtErcWallet':_0x565617['usdtErcWallet'],'usdcPolygonWallet':_0x565617[_0x4477c7(0xdb)]},'status':_0x565617[_0x4477c7(0x11b)],'createdAt':_0x565617[_0x4477c7(0xff)]};}async[a53_0x36e5b0(0x100)](_0x211aa5,_0x219b74){const _0x4f0ca7=a53_0x36e5b0,_0x54fe93={};_0x219b74[_0x4f0ca7(0xdf)]!==undefined&&(_0x54fe93[_0x4f0ca7(0xdf)]=_0x219b74['usdtPolygonWallet']||null),_0x219b74[_0x4f0ca7(0xb4)]!==undefined&&(_0x54fe93[_0x4f0ca7(0xb4)]=_0x219b74[_0x4f0ca7(0xb4)]||null),_0x219b74[_0x4f0ca7(0x103)]!==undefined&&(_0x54fe93[_0x4f0ca7(0x103)]=_0x219b74[_0x4f0ca7(0x103)]||null),_0x219b74[_0x4f0ca7(0xdb)]!==undefined&&(_0x54fe93['usdcPolygonWallet']=_0x219b74[_0x4f0ca7(0xdb)]||null),await database_1[_0x4f0ca7(0x114)][_0x4f0ca7(0xa0)][_0x4f0ca7(0x11c)]({'where':{'id':_0x211aa5},'data':_0x54fe93});}async[a53_0x36e5b0(0x116)](_0x327059){const _0x2c445c=a53_0x36e5b0,_0x336cf6=await database_1[_0x2c445c(0x114)][_0x2c445c(0xa0)][_0x2c445c(0x110)]({'where':{'id':_0x327059},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x336cf6?.[_0x2c445c(0xd4)]?.[_0x2c445c(0xdd)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x5d3ddc={'event':_0x2c445c(0x12f),'payment':{'id':_0x2c445c(0xfa),'order_id':_0x2c445c(0x9d),'gateway':_0x2c445c(0x12f),'amount':0x64,'currency':_0x2c445c(0xbf),'status':'paid','created_at':new Date()[_0x2c445c(0xf6)]()}};try{const _0x30400a=await fetch(_0x336cf6[_0x2c445c(0xd4)][_0x2c445c(0xdd)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x2c445c(0xda)](_0x5d3ddc)});return _0x30400a['ok']?{'success':!![],'message':_0x2c445c(0xbb)+_0x30400a['status']+')'}:{'success':![],'message':_0x2c445c(0xe7)+_0x30400a[_0x2c445c(0x11b)]+'\x20'+_0x30400a[_0x2c445c(0x136)]};}catch(_0x42ed84){return{'success':![],'message':_0x2c445c(0xef)+(_0x42ed84 instanceof Error?_0x42ed84[_0x2c445c(0x111)]:'Unknown\x20error')};}}async[a53_0x36e5b0(0xa6)](_0x3db2e9){const _0x1c52ee=a53_0x36e5b0;return this[_0x1c52ee(0xb8)][_0x1c52ee(0xf2)]({'public_key':'','gateway':_0x3db2e9[_0x1c52ee(0x124)],'order_id':undefined,'amount':_0x3db2e9[_0x1c52ee(0xde)],'currency':_0x3db2e9[_0x1c52ee(0x118)],'source_currency':_0x3db2e9['sourceCurrency'],'usage':_0x3db2e9['usage'],'expires_at':_0x3db2e9[_0x1c52ee(0x12c)]?.[_0x1c52ee(0xf6)](),'success_url':_0x3db2e9[_0x1c52ee(0x138)],'fail_url':_0x3db2e9[_0x1c52ee(0x138)],'customer_email':_0x3db2e9['customerEmail'],'customer_name':_0x3db2e9['customerName'],'country':_0x3db2e9[_0x1c52ee(0xa1)],'language':_0x3db2e9[_0x1c52ee(0xeb)],'amount_is_editable':_0x3db2e9[_0x1c52ee(0xbc)],'max_payments':_0x3db2e9[_0x1c52ee(0xaf)],'customer':_0x3db2e9[_0x1c52ee(0xb0)]});}async[a53_0x36e5b0(0x10d)](_0x3866a7,_0x3aff1c){return this['paymentService']['getPaymentsByShop'](_0x3866a7,_0x3aff1c);}async[a53_0x36e5b0(0xc7)](_0x47397f,_0xe4e8aa){const _0x3c1900=a53_0x36e5b0;return this[_0x3c1900(0xb8)][_0x3c1900(0x9c)](_0x47397f,_0xe4e8aa);}async['updatePayment'](_0x4e6201,_0x2c5ebc,_0x2b1d0c){const _0xfa7932=a53_0x36e5b0,_0x42dae0=await database_1[_0xfa7932(0x114)]['payment']['findFirst']({'where':{'id':_0x2c5ebc,'shopId':_0x4e6201}});if(!_0x42dae0)throw new Error('Payment\x20not\x20found');const _0x55aa57=await database_1[_0xfa7932(0x114)][_0xfa7932(0xdc)][_0xfa7932(0x11c)]({'where':{'id':_0x2c5ebc},'data':{..._0x2b1d0c,'updatedAt':new Date()}});return _0x55aa57;}async[a53_0x36e5b0(0x13a)](_0x195588,_0x28ae81){const _0x2a1fdf=a53_0x36e5b0,_0x545953=await database_1[_0x2a1fdf(0x114)]['payment'][_0x2a1fdf(0xfc)]({'where':{'id':_0x28ae81,'shopId':_0x195588}});if(!_0x545953)throw new Error(_0x2a1fdf(0xb5));await database_1[_0x2a1fdf(0x114)][_0x2a1fdf(0xdc)][_0x2a1fdf(0xe5)]({'where':{'id':_0x28ae81}});}[a53_0x36e5b0(0xe9)](_0x83784f){const _0xea284e=a53_0x36e5b0,_0x4a4817={'polygon':'USDT\x20Polygon','trc20':_0xea284e(0xbe),'erc20':_0xea284e(0x10b),'bsc':_0xea284e(0xfd),'polygon_usdc':_0xea284e(0x126)};return _0x4a4817[_0x83784f]||_0x83784f;}async[a53_0x36e5b0(0xa3)](_0x9275d1,_0x4c14be){const _0x3eab59=a53_0x36e5b0,{page:_0x3a9cd6,limit:_0x51e665,status:_0x3dddd9,method:_0x20ab9c,dateFrom:_0x4b1569,dateTo:_0x55fe58,periodFrom:_0x5a6784,periodTo:_0x494cee}=_0x4c14be,_0x58046e=(_0x3a9cd6-0x1)*_0x51e665,_0x3d2afd={'shopId':_0x9275d1};_0x3dddd9&&(_0x3d2afd[_0x3eab59(0x11b)]=_0x3dddd9[_0x3eab59(0xcc)]());_0x20ab9c&&(_0x3d2afd['network']=_0x20ab9c);if(_0x4b1569||_0x55fe58||_0x5a6784||_0x494cee){_0x3d2afd[_0x3eab59(0xff)]={};if(_0x5a6784)_0x3d2afd['createdAt'][_0x3eab59(0x9f)]=new Date(_0x5a6784);else _0x4b1569&&(_0x3d2afd[_0x3eab59(0xff)][_0x3eab59(0x9f)]=new Date(_0x4b1569));if(_0x494cee)_0x3d2afd['createdAt'][_0x3eab59(0xc0)]=new Date(_0x494cee);else _0x55fe58&&(_0x3d2afd[_0x3eab59(0xff)][_0x3eab59(0xc0)]=new Date(_0x55fe58));}const [_0x167a2d,_0x33141b]=await Promise['all']([database_1[_0x3eab59(0x114)][_0x3eab59(0x130)][_0x3eab59(0xf7)]({'where':_0x3d2afd,'skip':_0x58046e,'take':_0x51e665,'orderBy':{'createdAt':_0x3eab59(0xc9)}}),database_1[_0x3eab59(0x114)][_0x3eab59(0x130)][_0x3eab59(0xcd)]({'where':_0x3d2afd})]);return{'payouts':_0x167a2d['map'](_0x22bf86=>({'id':_0x22bf86['id'],'amount':_0x22bf86[_0x3eab59(0xde)],'network':this['formatNetworkName'](_0x22bf86[_0x3eab59(0xc5)]),'status':_0x22bf86[_0x3eab59(0x11b)],'txid':_0x22bf86[_0x3eab59(0xb9)],'notes':_0x22bf86[_0x3eab59(0x109)],'periodFrom':_0x22bf86[_0x3eab59(0x10f)],'periodTo':_0x22bf86[_0x3eab59(0x139)],'createdAt':_0x22bf86['createdAt'],'paidAt':_0x22bf86[_0x3eab59(0x10c)]})),'pagination':{'page':_0x3a9cd6,'limit':_0x51e665,'total':_0x33141b,'totalPages':Math[_0x3eab59(0x117)](_0x33141b/_0x51e665)}};}async[a53_0x36e5b0(0xf5)](_0x3f3e76,_0x7b2ab9){const _0x31d518=a53_0x36e5b0,_0x4548ec=await database_1['default'][_0x31d518(0x130)][_0x31d518(0xfc)]({'where':{'id':_0x7b2ab9,'shopId':_0x3f3e76}});if(!_0x4548ec)return null;return{'id':_0x4548ec['id'],'amount':_0x4548ec[_0x31d518(0xde)],'network':_0x4548ec[_0x31d518(0xc5)],'status':_0x4548ec[_0x31d518(0x11b)],'txid':_0x4548ec[_0x31d518(0xb9)],'notes':_0x4548ec[_0x31d518(0x109)],'createdAt':_0x4548ec[_0x31d518(0xff)],'paidAt':_0x4548ec['paidAt']};}async[a53_0x36e5b0(0xf8)](_0x2336da,_0x31cd11){const _0x4b5ce5=a53_0x36e5b0,_0x561900=new Date();let _0x345595;switch(_0x31cd11){case'7d':_0x345595=new Date(_0x561900[_0x4b5ce5(0x10e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x345595=new Date(_0x561900[_0x4b5ce5(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4b5ce5(0xce):_0x345595=new Date(_0x561900['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x345595=new Date(_0x561900[_0x4b5ce5(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x477922,_0x3260cf,_0x4922da,_0xb947e5,_0x4895a8,_0x56925c]=await Promise[_0x4b5ce5(0xe4)]([database_1[_0x4b5ce5(0x114)][_0x4b5ce5(0x130)][_0x4b5ce5(0xcd)]({'where':{'shopId':_0x2336da,'createdAt':{'gte':_0x345595}}}),database_1['default'][_0x4b5ce5(0x130)][_0x4b5ce5(0xcd)]({'where':{'shopId':_0x2336da,'status':_0x4b5ce5(0xe6),'createdAt':{'gte':_0x345595}}}),database_1[_0x4b5ce5(0x114)][_0x4b5ce5(0x130)][_0x4b5ce5(0xcd)]({'where':{'shopId':_0x2336da,'status':'PENDING','createdAt':{'gte':_0x345595}}}),database_1[_0x4b5ce5(0x114)][_0x4b5ce5(0x130)][_0x4b5ce5(0xcd)]({'where':{'shopId':_0x2336da,'status':'REJECTED','createdAt':{'gte':_0x345595}}}),database_1['default'][_0x4b5ce5(0x130)]['findMany']({'where':{'shopId':_0x2336da,'createdAt':{'gte':_0x345595}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x4b5ce5(0x130)][_0x4b5ce5(0xf7)]({'where':{'shopId':_0x2336da},'take':0xa,'orderBy':{'createdAt':_0x4b5ce5(0xc9)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x56bc09=_0x4895a8['reduce']((_0x1135b8,_0x508409)=>_0x1135b8+_0x508409[_0x4b5ce5(0xde)],0x0),_0x3163d4=_0x4895a8[_0x4b5ce5(0x133)](_0xa9e1b3=>_0xa9e1b3[_0x4b5ce5(0x11b)]===_0x4b5ce5(0xe6))[_0x4b5ce5(0x112)]((_0x13f664,_0x1e87ab)=>_0x13f664+_0x1e87ab['amount'],0x0),_0x30cca8=_0x4895a8[_0x4b5ce5(0x133)](_0x519e55=>_0x519e55[_0x4b5ce5(0x11b)]===_0x4b5ce5(0xe1))[_0x4b5ce5(0x112)]((_0x5c12e0,_0x29ad2d)=>_0x5c12e0+_0x29ad2d[_0x4b5ce5(0xde)],0x0),_0x51cc5c=_0x4895a8[_0x4b5ce5(0x112)]((_0x4f8a32,_0x525abd)=>{const _0x3a0435=_0x4b5ce5;return _0x4f8a32[_0x525abd[_0x3a0435(0xc5)]]=(_0x4f8a32[_0x525abd[_0x3a0435(0xc5)]]||0x0)+0x1,_0x4f8a32;},{}),_0x31d465=_0x4895a8[_0x4b5ce5(0x112)]((_0x23262a,_0x4d3ce0)=>{const _0x37e707=_0x4b5ce5;return _0x23262a[_0x4d3ce0[_0x37e707(0x11b)]]=(_0x23262a[_0x4d3ce0[_0x37e707(0x11b)]]||0x0)+0x1,_0x23262a;},{});return{'totalPayouts':_0x477922,'completedPayouts':_0x3260cf,'pendingPayouts':_0x4922da,'rejectedPayouts':_0xb947e5,'totalAmount':_0x56bc09,'completedAmount':_0x3163d4,'pendingAmount':_0x30cca8,'payoutsByMethod':_0x51cc5c,'payoutsByStatus':_0x31d465,'recentPayouts':_0x56925c[_0x4b5ce5(0x11d)](_0xdcebcd=>({'id':_0xdcebcd['id'],'shopId':_0x2336da,'amount':_0xdcebcd[_0x4b5ce5(0xde)],'method':_0xdcebcd['network'],'status':_0xdcebcd[_0x4b5ce5(0x11b)],'txid':_0xdcebcd[_0x4b5ce5(0xb9)],'createdAt':_0xdcebcd[_0x4b5ce5(0xff)],'paidAt':_0xdcebcd[_0x4b5ce5(0x10c)]}))};}async['getShopPayoutStats'](_0x14535c){const _0x2bf8e7=a53_0x36e5b0;console['log'](_0x2bf8e7(0xf3)+_0x14535c+'...');const _0x2b9f98=await database_1[_0x2bf8e7(0x114)][_0x2bf8e7(0xa0)][_0x2bf8e7(0x110)]({'where':{'id':_0x14535c},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2b9f98)throw new Error(_0x2bf8e7(0xed));const _0x2fcc00=new Date(),_0x115aaa=new Date(_0x2fcc00[_0x2bf8e7(0x101)](),_0x2fcc00[_0x2bf8e7(0xd7)](),0x1),_0xfd22c0=new Date(_0x2fcc00[_0x2bf8e7(0x101)](),_0x2fcc00[_0x2bf8e7(0xd7)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x38d2f7=await database_1[_0x2bf8e7(0x114)][_0x2bf8e7(0x130)][_0x2bf8e7(0xae)]({'_sum':{'amount':!![]},'where':{'shopId':_0x14535c,'createdAt':{'gte':_0x115aaa,'lte':_0xfd22c0},'status':_0x2bf8e7(0xe6)}}),_0x13a63b=_0x38d2f7[_0x2bf8e7(0xb1)][_0x2bf8e7(0xde)]||0x0,_0xa858fc={'availableBalance':Math[_0x2bf8e7(0x11e)](_0x2b9f98['balance']*0x64)/0x64,'totalPaidOut':Math[_0x2bf8e7(0x11e)](_0x2b9f98[_0x2bf8e7(0xa7)]*0x64)/0x64,'awaitingPayout':Math[_0x2bf8e7(0x11e)](_0x2b9f98[_0x2bf8e7(0x107)]*0x64)/0x64,'thisMonth':Math[_0x2bf8e7(0x11e)](_0x13a63b*0x64)/0x64};return console['log']('üìä\x20Shop\x20'+_0x2b9f98[_0x2bf8e7(0x12b)]+_0x2bf8e7(0xd1)),console['log'](_0x2bf8e7(0xc3)+_0xa858fc[_0x2bf8e7(0xa9)]+_0x2bf8e7(0xe2)),console[_0x2bf8e7(0x115)](_0x2bf8e7(0xb2)+_0xa858fc['totalPaidOut']+_0x2bf8e7(0x125)),console[_0x2bf8e7(0x115)](_0x2bf8e7(0xbd)+_0xa858fc[_0x2bf8e7(0x9b)]+'\x20USDT\x20(current\x20balance)'),console[_0x2bf8e7(0x115)](_0x2bf8e7(0x122)+_0xa858fc['thisMonth']+_0x2bf8e7(0x11f)),_0xa858fc;}[a53_0x36e5b0(0x137)](_0x1f25c2){const _0x265418=a53_0x36e5b0,_0x421e7a={'test_gateway':_0x265418(0xa4),'plisio':_0x265418(0x12a),'rapyd':_0x265418(0x11a),'noda':'Noda','cointopay':_0x265418(0xc6),'klyme_eu':_0x265418(0xcb),'klyme_gb':'KLYME\x20GB','klyme_de':_0x265418(0x12d)};return _0x421e7a[_0x1f25c2]||_0x1f25c2;}async[a53_0x36e5b0(0xec)](_0x1cf28b){const _0x2df840=a53_0x36e5b0;return this[_0x2df840(0xc2)](_0x1cf28b);}async[a53_0x36e5b0(0xf9)](_0x530a1c,_0x410745){const _0x398ac3=a53_0x36e5b0,{page:_0x80822d,limit:_0x598006,paymentId:_0xa3c706}=_0x410745,_0x32692e=(_0x80822d-0x1)*_0x598006,_0x3b7028={'shopId':_0x530a1c};_0xa3c706&&(_0x3b7028[_0x398ac3(0xd6)]=_0xa3c706);const [_0x2481f7,_0x3b10ea]=await Promise['all']([database_1[_0x398ac3(0x114)][_0x398ac3(0x9a)][_0x398ac3(0xf7)]({'where':_0x3b7028,'skip':_0x32692e,'take':_0x598006,'orderBy':{'createdAt':_0x398ac3(0xc9)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x398ac3(0x114)]['webhookLog']['count']({'where':_0x3b7028})]);return{'logs':_0x2481f7[_0x398ac3(0x11d)](_0x36ff62=>({'id':_0x36ff62['id'],'paymentId':_0x36ff62[_0x398ac3(0xd6)],'shopId':_0x36ff62[_0x398ac3(0x113)],'event':_0x36ff62[_0x398ac3(0xc1)],'statusCode':_0x36ff62[_0x398ac3(0xd8)],'retryCount':_0x36ff62['retryCount'],'responseBody':_0x36ff62[_0x398ac3(0xf4)],'createdAt':_0x36ff62['createdAt'],'payment':_0x36ff62['payment']})),'pagination':{'page':_0x80822d,'limit':_0x598006,'total':_0x3b10ea,'totalPages':Math[_0x398ac3(0x117)](_0x3b10ea/_0x598006)}};}async[a53_0x36e5b0(0xb6)](_0x21c5b4,_0x54a176){const _0x5d0392=a53_0x36e5b0,_0x526747=new Date();let _0x4d4358;switch(_0x54a176){case'7d':_0x4d4358=new Date(_0x526747['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5d0392(0xe0):_0x4d4358=new Date(_0x526747[_0x5d0392(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5d0392(0xce):_0x4d4358=new Date(_0x526747[_0x5d0392(0x10e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4d4358=new Date(_0x526747[_0x5d0392(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x29f7f4,_0x14420f,_0x524921,_0x1b88c3,_0x259ee9]=await Promise[_0x5d0392(0xe4)]([database_1[_0x5d0392(0x114)][_0x5d0392(0xdc)][_0x5d0392(0xcd)]({'where':{'shopId':_0x21c5b4,'gateway':{'not':_0x5d0392(0x121)},'createdAt':{'gte':_0x4d4358}}}),database_1['default'][_0x5d0392(0xdc)][_0x5d0392(0xcd)]({'where':{'shopId':_0x21c5b4,'gateway':{'not':_0x5d0392(0x121)},'status':_0x5d0392(0x132),'createdAt':{'gte':_0x4d4358}}}),database_1[_0x5d0392(0x114)][_0x5d0392(0xdc)][_0x5d0392(0xf7)]({'where':{'shopId':_0x21c5b4,'gateway':{'not':'test_gateway'},'status':_0x5d0392(0x132),'createdAt':{'gte':_0x4d4358}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x5d0392(0xdc)][_0x5d0392(0xf7)]({'where':{'shopId':_0x21c5b4,'gateway':{'not':_0x5d0392(0x121)}},'take':0xa,'orderBy':{'createdAt':_0x5d0392(0xc9)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5d0392(0x114)]['payment']['findMany']({'where':{'shopId':_0x21c5b4,'gateway':{'not':_0x5d0392(0x121)},'createdAt':{'gte':_0x4d4358}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x5d0392(0xa5)}})]);let _0x1a7af9=0x0;for(const _0x24c538 of _0x524921){if(_0x24c538[_0x5d0392(0x10a)])_0x1a7af9+=_0x24c538[_0x5d0392(0x10a)];else{const _0x45d7de=await currencyService_1[_0x5d0392(0xc4)]['convertToUSDT'](_0x24c538[_0x5d0392(0xde)],_0x24c538[_0x5d0392(0x118)]);_0x1a7af9+=_0x45d7de;}}const _0x525306=this[_0x5d0392(0xfb)](_0x259ee9,_0x4d4358,_0x526747),_0x550d61=_0x29f7f4>0x0?_0x14420f/_0x29f7f4*0x64:0x0;return{'totalPayments':_0x29f7f4,'successfulPayments':_0x14420f,'totalRevenue':Math[_0x5d0392(0x11e)](_0x1a7af9*0x64)/0x64,'conversionRate':Math[_0x5d0392(0x11e)](_0x550d61*0x64)/0x64,'dailyRevenue':_0x525306[_0x5d0392(0xf1)],'dailyPayments':_0x525306[_0x5d0392(0x12e)],'recentPayments':_0x1b88c3[_0x5d0392(0x11d)](_0x66335d=>({'id':_0x66335d['id'],'gateway':_0x66335d[_0x5d0392(0x124)],'amount':_0x66335d['amount'],'currency':_0x66335d[_0x5d0392(0x118)],'status':_0x66335d[_0x5d0392(0x11b)],'createdAt':_0x66335d[_0x5d0392(0xff)]}))};}[a53_0x36e5b0(0xfb)](_0x31328f,_0x131a6a,_0x5f3ae9){const _0x3f1e5a=a53_0x36e5b0,_0x2684a9=new Map(),_0x45f7d1=new Date(_0x131a6a);while(_0x45f7d1<=_0x5f3ae9){const _0x290c92=_0x45f7d1['toISOString']()[_0x3f1e5a(0x108)]('T')[0x0];_0x2684a9[_0x3f1e5a(0x119)](_0x290c92,{'revenue':0x0,'count':0x0}),_0x45f7d1[_0x3f1e5a(0xba)](_0x45f7d1[_0x3f1e5a(0xc8)]()+0x1);}for(const _0x4566a1 of _0x31328f){const _0x4e5ca3=_0x4566a1[_0x3f1e5a(0xff)][_0x3f1e5a(0xf6)]()[_0x3f1e5a(0x108)]('T')[0x0],_0x347f1f=_0x2684a9[_0x3f1e5a(0xab)](_0x4e5ca3);_0x347f1f&&(_0x347f1f[_0x3f1e5a(0xcd)]+=0x1,_0x4566a1[_0x3f1e5a(0x11b)]==='PAID'&&_0x4566a1[_0x3f1e5a(0x10a)]&&(_0x347f1f[_0x3f1e5a(0x131)]+=_0x4566a1[_0x3f1e5a(0x10a)]));}const _0x4c7bf8=[],_0xfeac1d=[];for(const [_0x2a557c,_0xa90711]of _0x2684a9){_0x4c7bf8[_0x3f1e5a(0x134)]({'date':_0x2a557c,'amount':Math[_0x3f1e5a(0x11e)](_0xa90711[_0x3f1e5a(0x131)]*0x64)/0x64}),_0xfeac1d['push']({'date':_0x2a557c,'count':_0xa90711[_0x3f1e5a(0xcd)]});}return{'dailyRevenue':_0x4c7bf8,'dailyPayments':_0xfeac1d};}}exports[a53_0x36e5b0(0xe3)]=ShopService;