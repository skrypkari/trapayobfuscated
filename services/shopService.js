'use strict';function a51_0x2140(_0x1c63d7,_0x3f969b){const _0x3f3bc2=a51_0x3f3b();return a51_0x2140=function(_0x2140c5,_0x3c06ae){_0x2140c5=_0x2140c5-0x15e;let _0x18b050=_0x3f3bc2[_0x2140c5];return _0x18b050;},a51_0x2140(_0x1c63d7,_0x3f969b);}const a51_0x2839c3=a51_0x2140;(function(_0x152be8,_0x4d2967){const _0x346ab3=a51_0x2140,_0x383310=_0x152be8();while(!![]){try{const _0x9d794a=-parseInt(_0x346ab3(0x163))/0x1*(parseInt(_0x346ab3(0x1df))/0x2)+parseInt(_0x346ab3(0x1ba))/0x3+-parseInt(_0x346ab3(0x1d1))/0x4*(parseInt(_0x346ab3(0x196))/0x5)+-parseInt(_0x346ab3(0x1ed))/0x6*(parseInt(_0x346ab3(0x1e1))/0x7)+-parseInt(_0x346ab3(0x1f2))/0x8+-parseInt(_0x346ab3(0x1de))/0x9*(-parseInt(_0x346ab3(0x192))/0xa)+parseInt(_0x346ab3(0x1d7))/0xb;if(_0x9d794a===_0x4d2967)break;else _0x383310['push'](_0x383310['shift']());}catch(_0x3227f0){_0x383310['push'](_0x383310['shift']());}}}(a51_0x3f3b,0xe9b6b));var __importDefault=this&&this[a51_0x2839c3(0x1dd)]||function(_0x3fc511){const _0x277ce6=a51_0x2839c3;return _0x3fc511&&_0x3fc511[_0x277ce6(0x164)]?_0x3fc511:{'default':_0x3fc511};};function a51_0x3f3b(){const _0x5c1a3c=['paymentId','PAID','aggregate','Noda','amountUSDT','./paymentService','gte','paymentService','REJECTED','\x20\x20\x20üíµ\x20Available\x20balance:\x20','Error\x20parsing\x20webhook\x20events:','update','amount','application/json','webhookEvents','txid','message','KLYME\x20GB','\x20USDT','push','shop','currency','sourceCurrency','createPublicPayment','USD','getPayoutById','error','retryCount','expiresAt','test','getStatistics','delete','Unknown\x20error','revenue','\x20USDT\x20(current\x20balance)','159579Qnfdud','responseBody','thisMonth','getMonth','country','PENDING','30d','desc','toUpperCase','publicKey','customerEmail','totalPaidOut','shopId','count','test_gateway','getPayouts','test_payment_123','parse','gatewaySettings','log','redirectUrl','\x20\x20\x20üìÖ\x20This\x20month:\x20','convertToUSDT','16YAKIJQ','username','updateWallets','payment','statusText','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','4893845WxfaRD','dailyPayments','default','telegram','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','generateDailyStatistics','__importDefault','9YxLUxH','432228wEoiWo','maxPayments','1193318vhsdWj','getTime','usdtTrcWallet','findUnique','settings','amountIsEditable','updatePayment','COMPLETED','all','./currencyService','getShopProfile','currencyService','6FaXkAq','statusCode','filter','split','createPayment','2211184cjfrIk','KLYME\x20EU','webhookLog','No\x20webhook\x20URL\x20configured','findFirst','customerName','balance','getShopPayoutStats','wallets','Shop\x20not\x20found','testWebhook','defineProperty','gateway','CoinToPay','_sum','3zEvHnJ','__esModule','getFullYear','ceil','ShopService','name','usdtPolygonWallet','usdtErcWallet','customer','usage','getWebhookLogs','getPaymentsByShop','Payment\x20not\x20found','updateShopProfile','setDate','stringify','getDate','getPaymentById','PaymentService','toISOString','deletePayment','usdcPolygonWallet','language','createdAt','status','webhookUrl','merchantUrl','paymentGateways','paidAt','map','asc','lte','Test\x20Gateway','\x20USDT\x20(total\x20payouts)','payout','90d','test_order_123','findMany','Rapyd','availableBalance','round','getPayments','awaitingPayout','network','shopUrl','paid','gateways','17427530xtYmbR','telegramId','reduce','dailyRevenue','235420JMsbzv'];a51_0x3f3b=function(){return _0x5c1a3c;};return a51_0x3f3b();}Object[a51_0x2839c3(0x15f)](exports,a51_0x2839c3(0x164),{'value':!![]}),exports[a51_0x2839c3(0x167)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a51_0x2839c3(0x1ea)),paymentService_1=require(a51_0x2839c3(0x19c));class ShopService{constructor(){const _0x52af15=a51_0x2839c3;this[_0x52af15(0x19e)]=new paymentService_1[(_0x52af15(0x175))]();}async[a51_0x2839c3(0x1eb)](_0x3578f2){const _0x58e80a=a51_0x2839c3,_0x2b2a57=await database_1[_0x58e80a(0x1d9)][_0x58e80a(0x1ab)][_0x58e80a(0x1e4)]({'where':{'id':_0x3578f2},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2b2a57)throw new Error(_0x58e80a(0x1fb));let _0x57de0c=[];if(_0x2b2a57[_0x58e80a(0x1e5)]?.[_0x58e80a(0x1a5)])try{_0x57de0c=Array['isArray'](_0x2b2a57[_0x58e80a(0x1e5)][_0x58e80a(0x1a5)])?_0x2b2a57[_0x58e80a(0x1e5)][_0x58e80a(0x1a5)]:JSON[_0x58e80a(0x1cb)](_0x2b2a57[_0x58e80a(0x1e5)][_0x58e80a(0x1a5)]);}catch(_0x2efe4b){console[_0x58e80a(0x1b1)]('Error\x20parsing\x20webhook\x20events:',_0x2efe4b),_0x57de0c=[];}return{'id':_0x2b2a57['id'],'fullName':_0x2b2a57[_0x58e80a(0x168)],'username':_0x2b2a57[_0x58e80a(0x1d2)],'telegramId':_0x2b2a57[_0x58e80a(0x1da)],'merchantUrl':_0x2b2a57[_0x58e80a(0x18f)],'gateways':_0x2b2a57[_0x58e80a(0x17e)]?JSON[_0x58e80a(0x1cb)](_0x2b2a57[_0x58e80a(0x17e)]):null,'gatewaySettings':_0x2b2a57['gatewaySettings']?JSON['parse'](_0x2b2a57[_0x58e80a(0x1cc)]):null,'publicKey':_0x2b2a57[_0x58e80a(0x1c3)],'webhookUrl':_0x2b2a57[_0x58e80a(0x1e5)]?.['webhookUrl']||null,'webhookEvents':_0x57de0c,'wallets':{'usdtPolygonWallet':_0x2b2a57[_0x58e80a(0x169)],'usdtTrcWallet':_0x2b2a57[_0x58e80a(0x1e3)],'usdtErcWallet':_0x2b2a57[_0x58e80a(0x16a)],'usdcPolygonWallet':_0x2b2a57['usdcPolygonWallet']},'status':_0x2b2a57[_0x58e80a(0x17b)],'createdAt':_0x2b2a57[_0x58e80a(0x17a)]};}async[a51_0x2839c3(0x170)](_0x122567,_0x306a95){const _0x5d692d=a51_0x2839c3,_0x67c705={};_0x306a95['fullName']&&(_0x67c705['name']=_0x306a95['fullName']);_0x306a95[_0x5d692d(0x193)]!==undefined&&(_0x67c705['telegram']=_0x306a95[_0x5d692d(0x193)]||null);_0x306a95[_0x5d692d(0x17d)]&&(_0x67c705[_0x5d692d(0x18f)]=_0x306a95[_0x5d692d(0x17d)]);_0x306a95['gateways']&&(_0x67c705['paymentGateways']=JSON['stringify'](_0x306a95[_0x5d692d(0x191)]));_0x306a95[_0x5d692d(0x1cc)]&&(_0x67c705[_0x5d692d(0x1cc)]=JSON[_0x5d692d(0x172)](_0x306a95[_0x5d692d(0x1cc)]));_0x306a95[_0x5d692d(0x1fa)]&&(_0x306a95[_0x5d692d(0x1fa)][_0x5d692d(0x169)]!==undefined&&(_0x67c705[_0x5d692d(0x169)]=_0x306a95[_0x5d692d(0x1fa)][_0x5d692d(0x169)]||null),_0x306a95[_0x5d692d(0x1fa)][_0x5d692d(0x1e3)]!==undefined&&(_0x67c705['usdtTrcWallet']=_0x306a95[_0x5d692d(0x1fa)][_0x5d692d(0x1e3)]||null),_0x306a95[_0x5d692d(0x1fa)][_0x5d692d(0x16a)]!==undefined&&(_0x67c705['usdtErcWallet']=_0x306a95[_0x5d692d(0x1fa)]['usdtErcWallet']||null),_0x306a95[_0x5d692d(0x1fa)][_0x5d692d(0x178)]!==undefined&&(_0x67c705[_0x5d692d(0x178)]=_0x306a95[_0x5d692d(0x1fa)][_0x5d692d(0x178)]||null));const _0x2d8544=await database_1[_0x5d692d(0x1d9)][_0x5d692d(0x1ab)][_0x5d692d(0x1a2)]({'where':{'id':_0x122567},'data':_0x67c705,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x27f865=[];if(_0x2d8544['settings']?.[_0x5d692d(0x1a5)])try{_0x27f865=Array['isArray'](_0x2d8544['settings'][_0x5d692d(0x1a5)])?_0x2d8544[_0x5d692d(0x1e5)][_0x5d692d(0x1a5)]:JSON[_0x5d692d(0x1cb)](_0x2d8544[_0x5d692d(0x1e5)][_0x5d692d(0x1a5)]);}catch(_0x56918b){console['error'](_0x5d692d(0x1a1),_0x56918b),_0x27f865=[];}return{'id':_0x2d8544['id'],'fullName':_0x2d8544[_0x5d692d(0x168)],'username':_0x2d8544['username'],'telegramId':_0x2d8544[_0x5d692d(0x1da)],'merchantUrl':_0x2d8544[_0x5d692d(0x18f)],'gateways':_0x2d8544[_0x5d692d(0x17e)]?JSON[_0x5d692d(0x1cb)](_0x2d8544[_0x5d692d(0x17e)]):null,'gatewaySettings':_0x2d8544[_0x5d692d(0x1cc)]?JSON['parse'](_0x2d8544[_0x5d692d(0x1cc)]):null,'publicKey':_0x2d8544[_0x5d692d(0x1c3)],'webhookUrl':_0x2d8544[_0x5d692d(0x1e5)]?.[_0x5d692d(0x17c)]||null,'webhookEvents':_0x27f865,'wallets':{'usdtPolygonWallet':_0x2d8544[_0x5d692d(0x169)],'usdtTrcWallet':_0x2d8544[_0x5d692d(0x1e3)],'usdtErcWallet':_0x2d8544['usdtErcWallet'],'usdcPolygonWallet':_0x2d8544[_0x5d692d(0x178)]},'status':_0x2d8544['status'],'createdAt':_0x2d8544['createdAt']};}async[a51_0x2839c3(0x1d3)](_0x4670f3,_0x5e9476){const _0x10b2ec=a51_0x2839c3,_0x45acf8={};_0x5e9476[_0x10b2ec(0x169)]!==undefined&&(_0x45acf8[_0x10b2ec(0x169)]=_0x5e9476[_0x10b2ec(0x169)]||null),_0x5e9476[_0x10b2ec(0x1e3)]!==undefined&&(_0x45acf8[_0x10b2ec(0x1e3)]=_0x5e9476[_0x10b2ec(0x1e3)]||null),_0x5e9476['usdtErcWallet']!==undefined&&(_0x45acf8[_0x10b2ec(0x16a)]=_0x5e9476[_0x10b2ec(0x16a)]||null),_0x5e9476['usdcPolygonWallet']!==undefined&&(_0x45acf8['usdcPolygonWallet']=_0x5e9476[_0x10b2ec(0x178)]||null),await database_1['default'][_0x10b2ec(0x1ab)][_0x10b2ec(0x1a2)]({'where':{'id':_0x4670f3},'data':_0x45acf8});}async[a51_0x2839c3(0x15e)](_0x4cab9e){const _0x3e03e=a51_0x2839c3,_0x3942fa=await database_1['default'][_0x3e03e(0x1ab)][_0x3e03e(0x1e4)]({'where':{'id':_0x4cab9e},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3942fa?.[_0x3e03e(0x1e5)]?.[_0x3e03e(0x17c)])throw new Error(_0x3e03e(0x1f5));const _0x58feff={'event':_0x3e03e(0x1b4),'payment':{'id':_0x3e03e(0x1ca),'order_id':_0x3e03e(0x187),'gateway':_0x3e03e(0x1b4),'amount':0x64,'currency':_0x3e03e(0x1af),'status':_0x3e03e(0x190),'created_at':new Date()['toISOString']()}};try{const _0x4accba=await fetch(_0x3942fa['settings']['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x3e03e(0x1a4),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x3e03e(0x172)](_0x58feff)});return _0x4accba['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x4accba['status']+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x4accba['status']+'\x20'+_0x4accba[_0x3e03e(0x1d5)]};}catch(_0x3e79e1){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x3e79e1 instanceof Error?_0x3e79e1[_0x3e03e(0x1a7)]:_0x3e03e(0x1b7))};}}async[a51_0x2839c3(0x1f1)](_0x365e80){const _0x257102=a51_0x2839c3;return this['paymentService'][_0x257102(0x1ae)]({'public_key':'','gateway':_0x365e80[_0x257102(0x160)],'order_id':undefined,'amount':_0x365e80[_0x257102(0x1a3)],'currency':_0x365e80[_0x257102(0x1ac)],'source_currency':_0x365e80[_0x257102(0x1ad)],'usage':_0x365e80[_0x257102(0x16c)],'expires_at':_0x365e80[_0x257102(0x1b3)]?.['toISOString'](),'success_url':_0x365e80[_0x257102(0x1ce)],'fail_url':_0x365e80[_0x257102(0x1ce)],'customer_email':_0x365e80[_0x257102(0x1c4)],'customer_name':_0x365e80[_0x257102(0x1f7)],'country':_0x365e80[_0x257102(0x1be)],'language':_0x365e80[_0x257102(0x179)],'amount_is_editable':_0x365e80[_0x257102(0x1e6)],'max_payments':_0x365e80[_0x257102(0x1e0)],'customer':_0x365e80[_0x257102(0x16b)]});}async[a51_0x2839c3(0x18c)](_0x1bf11a,_0x31dc5c){const _0x2ab9fa=a51_0x2839c3;return this[_0x2ab9fa(0x19e)][_0x2ab9fa(0x16e)](_0x1bf11a,_0x31dc5c);}async[a51_0x2839c3(0x174)](_0x519745,_0x1183af){const _0x26d53a=a51_0x2839c3;return this[_0x26d53a(0x19e)]['getPaymentByShopAndId'](_0x519745,_0x1183af);}async[a51_0x2839c3(0x1e7)](_0xcdb985,_0x5b4d95,_0x19e9f6){const _0x34abd9=a51_0x2839c3,_0x15798d=await database_1['default'][_0x34abd9(0x1d4)][_0x34abd9(0x1f6)]({'where':{'id':_0x5b4d95,'shopId':_0xcdb985}});if(!_0x15798d)throw new Error('Payment\x20not\x20found');const _0x4fd9c0=await database_1[_0x34abd9(0x1d9)][_0x34abd9(0x1d4)][_0x34abd9(0x1a2)]({'where':{'id':_0x5b4d95},'data':{..._0x19e9f6,'updatedAt':new Date()}});return _0x4fd9c0;}async[a51_0x2839c3(0x177)](_0x521419,_0x3039d6){const _0x28c890=a51_0x2839c3,_0x8c37ed=await database_1[_0x28c890(0x1d9)]['payment'][_0x28c890(0x1f6)]({'where':{'id':_0x3039d6,'shopId':_0x521419}});if(!_0x8c37ed)throw new Error(_0x28c890(0x16f));await database_1[_0x28c890(0x1d9)][_0x28c890(0x1d4)][_0x28c890(0x1b6)]({'where':{'id':_0x3039d6}});}async[a51_0x2839c3(0x1c9)](_0x531f83,_0xeb8917){const _0x1963c8=a51_0x2839c3,{page:_0x22989d,limit:_0x3882bf,status:_0x442162,method:_0x3eac7e,dateFrom:_0x1edfbf,dateTo:_0x4d986a,periodFrom:_0x52fbda,periodTo:_0x596271}=_0xeb8917,_0x2c84b9=(_0x22989d-0x1)*_0x3882bf,_0x2deb8f={'shopId':_0x531f83};_0x442162&&(_0x2deb8f[_0x1963c8(0x17b)]=_0x442162[_0x1963c8(0x1c2)]());_0x3eac7e&&(_0x2deb8f[_0x1963c8(0x18e)]=_0x3eac7e);if(_0x1edfbf||_0x4d986a||_0x52fbda||_0x596271){_0x2deb8f[_0x1963c8(0x17a)]={};if(_0x52fbda)_0x2deb8f[_0x1963c8(0x17a)]['gte']=new Date(_0x52fbda);else _0x1edfbf&&(_0x2deb8f[_0x1963c8(0x17a)][_0x1963c8(0x19d)]=new Date(_0x1edfbf));if(_0x596271)_0x2deb8f[_0x1963c8(0x17a)]['lte']=new Date(_0x596271);else _0x4d986a&&(_0x2deb8f[_0x1963c8(0x17a)][_0x1963c8(0x182)]=new Date(_0x4d986a));}const [_0x106f38,_0x18a3d1]=await Promise[_0x1963c8(0x1e9)]([database_1['default'][_0x1963c8(0x185)][_0x1963c8(0x188)]({'where':_0x2deb8f,'skip':_0x2c84b9,'take':_0x3882bf,'orderBy':{'createdAt':'desc'}}),database_1[_0x1963c8(0x1d9)][_0x1963c8(0x185)][_0x1963c8(0x1c7)]({'where':_0x2deb8f})]);return{'payouts':_0x106f38[_0x1963c8(0x180)](_0x41f308=>({'id':_0x41f308['id'],'amount':_0x41f308[_0x1963c8(0x1a3)],'network':_0x41f308[_0x1963c8(0x18e)],'status':_0x41f308['status'],'txid':_0x41f308[_0x1963c8(0x1a6)],'notes':_0x41f308['notes'],'createdAt':_0x41f308[_0x1963c8(0x17a)],'paidAt':_0x41f308[_0x1963c8(0x17f)]})),'pagination':{'page':_0x22989d,'limit':_0x3882bf,'total':_0x18a3d1,'totalPages':Math[_0x1963c8(0x166)](_0x18a3d1/_0x3882bf)}};}async[a51_0x2839c3(0x1b0)](_0x1d17d2,_0x268a85){const _0x143828=a51_0x2839c3,_0x5ef897=await database_1['default'][_0x143828(0x185)][_0x143828(0x1f6)]({'where':{'id':_0x268a85,'shopId':_0x1d17d2}});if(!_0x5ef897)return null;return{'id':_0x5ef897['id'],'amount':_0x5ef897[_0x143828(0x1a3)],'network':_0x5ef897['network'],'status':_0x5ef897[_0x143828(0x17b)],'txid':_0x5ef897[_0x143828(0x1a6)],'notes':_0x5ef897['notes'],'createdAt':_0x5ef897[_0x143828(0x17a)],'paidAt':_0x5ef897[_0x143828(0x17f)]};}async['getPayoutStatistics'](_0x44d05c,_0x330864){const _0x12b9c7=a51_0x2839c3,_0x2e551c=new Date();let _0x3370a4;switch(_0x330864){case'7d':_0x3370a4=new Date(_0x2e551c[_0x12b9c7(0x1e2)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x12b9c7(0x1c0):_0x3370a4=new Date(_0x2e551c[_0x12b9c7(0x1e2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x12b9c7(0x186):_0x3370a4=new Date(_0x2e551c['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x3370a4=new Date(_0x2e551c[_0x12b9c7(0x1e2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x9eb4d5,_0x27b794,_0x110f8e,_0x3cfe90,_0x52647d,_0x24d4e6]=await Promise[_0x12b9c7(0x1e9)]([database_1[_0x12b9c7(0x1d9)][_0x12b9c7(0x185)][_0x12b9c7(0x1c7)]({'where':{'shopId':_0x44d05c,'createdAt':{'gte':_0x3370a4}}}),database_1['default'][_0x12b9c7(0x185)][_0x12b9c7(0x1c7)]({'where':{'shopId':_0x44d05c,'status':_0x12b9c7(0x1e8),'createdAt':{'gte':_0x3370a4}}}),database_1[_0x12b9c7(0x1d9)][_0x12b9c7(0x185)][_0x12b9c7(0x1c7)]({'where':{'shopId':_0x44d05c,'status':_0x12b9c7(0x1bf),'createdAt':{'gte':_0x3370a4}}}),database_1['default']['payout'][_0x12b9c7(0x1c7)]({'where':{'shopId':_0x44d05c,'status':_0x12b9c7(0x19f),'createdAt':{'gte':_0x3370a4}}}),database_1['default'][_0x12b9c7(0x185)][_0x12b9c7(0x188)]({'where':{'shopId':_0x44d05c,'createdAt':{'gte':_0x3370a4}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x12b9c7(0x1d9)]['payout'][_0x12b9c7(0x188)]({'where':{'shopId':_0x44d05c},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x24ad30=_0x52647d[_0x12b9c7(0x194)]((_0x77fe00,_0x1dd0b8)=>_0x77fe00+_0x1dd0b8['amount'],0x0),_0xcbee3d=_0x52647d[_0x12b9c7(0x1ef)](_0x29a2f0=>_0x29a2f0['status']===_0x12b9c7(0x1e8))[_0x12b9c7(0x194)]((_0x3c4637,_0x4b346d)=>_0x3c4637+_0x4b346d[_0x12b9c7(0x1a3)],0x0),_0x500663=_0x52647d[_0x12b9c7(0x1ef)](_0x192bb6=>_0x192bb6[_0x12b9c7(0x17b)]==='PENDING')[_0x12b9c7(0x194)]((_0x5d1f5e,_0x56bf24)=>_0x5d1f5e+_0x56bf24[_0x12b9c7(0x1a3)],0x0),_0x1e86dd=_0x52647d[_0x12b9c7(0x194)]((_0x2fe1ad,_0x3b62b4)=>{const _0x3a9b29=_0x12b9c7;return _0x2fe1ad[_0x3b62b4[_0x3a9b29(0x18e)]]=(_0x2fe1ad[_0x3b62b4[_0x3a9b29(0x18e)]]||0x0)+0x1,_0x2fe1ad;},{}),_0x473b27=_0x52647d['reduce']((_0x2e9f6b,_0x403a9b)=>{const _0x958e03=_0x12b9c7;return _0x2e9f6b[_0x403a9b[_0x958e03(0x17b)]]=(_0x2e9f6b[_0x403a9b[_0x958e03(0x17b)]]||0x0)+0x1,_0x2e9f6b;},{});return{'totalPayouts':_0x9eb4d5,'completedPayouts':_0x27b794,'pendingPayouts':_0x110f8e,'rejectedPayouts':_0x3cfe90,'totalAmount':_0x24ad30,'completedAmount':_0xcbee3d,'pendingAmount':_0x500663,'payoutsByMethod':_0x1e86dd,'payoutsByStatus':_0x473b27,'recentPayouts':_0x24d4e6[_0x12b9c7(0x180)](_0x20c865=>({'id':_0x20c865['id'],'shopId':_0x44d05c,'amount':_0x20c865['amount'],'method':_0x20c865['network'],'status':_0x20c865[_0x12b9c7(0x17b)],'txid':_0x20c865['txid'],'createdAt':_0x20c865[_0x12b9c7(0x17a)],'paidAt':_0x20c865[_0x12b9c7(0x17f)]}))};}async[a51_0x2839c3(0x1f9)](_0x20beec){const _0x2ad7d8=a51_0x2839c3;console['log'](_0x2ad7d8(0x1db)+_0x20beec+'...');const _0x404151=await database_1[_0x2ad7d8(0x1d9)]['shop']['findUnique']({'where':{'id':_0x20beec},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x404151)throw new Error(_0x2ad7d8(0x1fb));const _0x2756f3=new Date(),_0x19f383=new Date(_0x2756f3[_0x2ad7d8(0x165)](),_0x2756f3['getMonth'](),0x1),_0x1849a7=new Date(_0x2756f3[_0x2ad7d8(0x165)](),_0x2756f3[_0x2ad7d8(0x1bd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3fd5f6=await database_1[_0x2ad7d8(0x1d9)][_0x2ad7d8(0x185)][_0x2ad7d8(0x199)]({'_sum':{'amount':!![]},'where':{'shopId':_0x20beec,'createdAt':{'gte':_0x19f383,'lte':_0x1849a7},'status':_0x2ad7d8(0x1e8)}}),_0x309019=_0x3fd5f6[_0x2ad7d8(0x162)][_0x2ad7d8(0x1a3)]||0x0,_0x2d2b0f={'availableBalance':Math['round'](_0x404151[_0x2ad7d8(0x1f8)]*0x64)/0x64,'totalPaidOut':Math[_0x2ad7d8(0x18b)](_0x404151[_0x2ad7d8(0x1c5)]*0x64)/0x64,'awaitingPayout':Math[_0x2ad7d8(0x18b)](_0x404151[_0x2ad7d8(0x1f8)]*0x64)/0x64,'thisMonth':Math[_0x2ad7d8(0x18b)](_0x309019*0x64)/0x64};return console['log']('üìä\x20Shop\x20'+_0x404151[_0x2ad7d8(0x1d2)]+'\x20payout\x20statistics\x20calculated:'),console[_0x2ad7d8(0x1cd)](_0x2ad7d8(0x1a0)+_0x2d2b0f[_0x2ad7d8(0x18a)]+_0x2ad7d8(0x1b9)),console[_0x2ad7d8(0x1cd)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x2d2b0f[_0x2ad7d8(0x1c5)]+_0x2ad7d8(0x184)),console['log'](_0x2ad7d8(0x1d6)+_0x2d2b0f[_0x2ad7d8(0x18d)]+'\x20USDT\x20(current\x20balance)'),console[_0x2ad7d8(0x1cd)](_0x2ad7d8(0x1cf)+_0x2d2b0f[_0x2ad7d8(0x1bc)]+_0x2ad7d8(0x1a9)),_0x2d2b0f;}['getGatewayDisplayName'](_0x5ef2da){const _0x258e59=a51_0x2839c3,_0xdf7ade={'test_gateway':_0x258e59(0x183),'plisio':'Plisio','rapyd':_0x258e59(0x189),'noda':_0x258e59(0x19a),'cointopay':_0x258e59(0x161),'klyme_eu':_0x258e59(0x1f3),'klyme_gb':_0x258e59(0x1a8),'klyme_de':'KLYME\x20DE'};return _0xdf7ade[_0x5ef2da]||_0x5ef2da;}async['getPayoutStats'](_0x254978){return this['getShopPayoutStats'](_0x254978);}async[a51_0x2839c3(0x16d)](_0x15211d,_0x1ca712){const _0x2dd828=a51_0x2839c3,{page:_0x208171,limit:_0x5ce962,paymentId:_0x5c8308}=_0x1ca712,_0x4de6ae=(_0x208171-0x1)*_0x5ce962,_0x1b8fbc={'shopId':_0x15211d};_0x5c8308&&(_0x1b8fbc['paymentId']=_0x5c8308);const [_0x24bcac,_0x426402]=await Promise[_0x2dd828(0x1e9)]([database_1[_0x2dd828(0x1d9)][_0x2dd828(0x1f4)][_0x2dd828(0x188)]({'where':_0x1b8fbc,'skip':_0x4de6ae,'take':_0x5ce962,'orderBy':{'createdAt':_0x2dd828(0x1c1)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2dd828(0x1d9)][_0x2dd828(0x1f4)][_0x2dd828(0x1c7)]({'where':_0x1b8fbc})]);return{'logs':_0x24bcac[_0x2dd828(0x180)](_0x498132=>({'id':_0x498132['id'],'paymentId':_0x498132[_0x2dd828(0x197)],'shopId':_0x498132[_0x2dd828(0x1c6)],'event':_0x498132['event'],'statusCode':_0x498132[_0x2dd828(0x1ee)],'retryCount':_0x498132[_0x2dd828(0x1b2)],'responseBody':_0x498132[_0x2dd828(0x1bb)],'createdAt':_0x498132[_0x2dd828(0x17a)],'payment':_0x498132[_0x2dd828(0x1d4)]})),'pagination':{'page':_0x208171,'limit':_0x5ce962,'total':_0x426402,'totalPages':Math[_0x2dd828(0x166)](_0x426402/_0x5ce962)}};}async[a51_0x2839c3(0x1b5)](_0x2e602b,_0x22ce8f){const _0x58d924=a51_0x2839c3,_0x5c9b27=new Date();let _0x12c092;switch(_0x22ce8f){case'7d':_0x12c092=new Date(_0x5c9b27['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x58d924(0x1c0):_0x12c092=new Date(_0x5c9b27[_0x58d924(0x1e2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x58d924(0x186):_0x12c092=new Date(_0x5c9b27[_0x58d924(0x1e2)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x12c092=new Date(_0x5c9b27[_0x58d924(0x1e2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x376c08,_0x5a6e2e,_0x2e4356,_0x4f2de2,_0x5ba979]=await Promise['all']([database_1[_0x58d924(0x1d9)][_0x58d924(0x1d4)]['count']({'where':{'shopId':_0x2e602b,'gateway':{'not':_0x58d924(0x1c8)},'createdAt':{'gte':_0x12c092}}}),database_1[_0x58d924(0x1d9)][_0x58d924(0x1d4)][_0x58d924(0x1c7)]({'where':{'shopId':_0x2e602b,'gateway':{'not':_0x58d924(0x1c8)},'status':_0x58d924(0x198),'createdAt':{'gte':_0x12c092}}}),database_1[_0x58d924(0x1d9)]['payment'][_0x58d924(0x188)]({'where':{'shopId':_0x2e602b,'gateway':{'not':'test_gateway'},'status':_0x58d924(0x198),'createdAt':{'gte':_0x12c092}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x58d924(0x1d9)][_0x58d924(0x1d4)]['findMany']({'where':{'shopId':_0x2e602b,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x58d924(0x1c1)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x58d924(0x1d4)][_0x58d924(0x188)]({'where':{'shopId':_0x2e602b,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x12c092}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x58d924(0x181)}})]);let _0x303337=0x0;for(const _0x2d35a3 of _0x2e4356){if(_0x2d35a3[_0x58d924(0x19b)])_0x303337+=_0x2d35a3[_0x58d924(0x19b)];else{const _0x3a6ed7=await currencyService_1[_0x58d924(0x1ec)][_0x58d924(0x1d0)](_0x2d35a3[_0x58d924(0x1a3)],_0x2d35a3[_0x58d924(0x1ac)]);_0x303337+=_0x3a6ed7;}}const _0x1e6500=this['generateDailyStatistics'](_0x5ba979,_0x12c092,_0x5c9b27),_0x1f0ee7=_0x376c08>0x0?_0x5a6e2e/_0x376c08*0x64:0x0;return{'totalPayments':_0x376c08,'successfulPayments':_0x5a6e2e,'totalRevenue':Math[_0x58d924(0x18b)](_0x303337*0x64)/0x64,'conversionRate':Math[_0x58d924(0x18b)](_0x1f0ee7*0x64)/0x64,'dailyRevenue':_0x1e6500[_0x58d924(0x195)],'dailyPayments':_0x1e6500[_0x58d924(0x1d8)],'recentPayments':_0x4f2de2[_0x58d924(0x180)](_0x15fd08=>({'id':_0x15fd08['id'],'gateway':_0x15fd08[_0x58d924(0x160)],'amount':_0x15fd08[_0x58d924(0x1a3)],'currency':_0x15fd08[_0x58d924(0x1ac)],'status':_0x15fd08[_0x58d924(0x17b)],'createdAt':_0x15fd08[_0x58d924(0x17a)]}))};}[a51_0x2839c3(0x1dc)](_0x11744c,_0x39a3bf,_0x44fe48){const _0x16e4cb=a51_0x2839c3,_0x506048=new Map(),_0x2a12d1=new Date(_0x39a3bf);while(_0x2a12d1<=_0x44fe48){const _0x497dfa=_0x2a12d1['toISOString']()[_0x16e4cb(0x1f0)]('T')[0x0];_0x506048['set'](_0x497dfa,{'revenue':0x0,'count':0x0}),_0x2a12d1[_0x16e4cb(0x171)](_0x2a12d1[_0x16e4cb(0x173)]()+0x1);}for(const _0x3a293e of _0x11744c){const _0xc60005=_0x3a293e[_0x16e4cb(0x17a)][_0x16e4cb(0x176)]()[_0x16e4cb(0x1f0)]('T')[0x0],_0x38b5f9=_0x506048['get'](_0xc60005);_0x38b5f9&&(_0x38b5f9[_0x16e4cb(0x1c7)]+=0x1,_0x3a293e[_0x16e4cb(0x17b)]===_0x16e4cb(0x198)&&_0x3a293e[_0x16e4cb(0x19b)]&&(_0x38b5f9[_0x16e4cb(0x1b8)]+=_0x3a293e['amountUSDT']));}const _0x210418=[],_0x4aa41d=[];for(const [_0x215958,_0x16965d]of _0x506048){_0x210418[_0x16e4cb(0x1aa)]({'date':_0x215958,'amount':Math[_0x16e4cb(0x18b)](_0x16965d['revenue']*0x64)/0x64}),_0x4aa41d[_0x16e4cb(0x1aa)]({'date':_0x215958,'count':_0x16965d['count']});}return{'dailyRevenue':_0x210418,'dailyPayments':_0x4aa41d};}}exports[a51_0x2839c3(0x167)]=ShopService;