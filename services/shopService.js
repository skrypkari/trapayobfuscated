'use strict';const a53_0x4e5fd7=a53_0x7c8d;(function(_0x2f0715,_0x366a8a){const _0x249009=a53_0x7c8d,_0xf0b14b=_0x2f0715();while(!![]){try{const _0x1d4a7b=parseInt(_0x249009(0x218))/0x1+-parseInt(_0x249009(0x1ff))/0x2+-parseInt(_0x249009(0x258))/0x3+parseInt(_0x249009(0x1f0))/0x4*(parseInt(_0x249009(0x1fe))/0x5)+parseInt(_0x249009(0x213))/0x6+parseInt(_0x249009(0x270))/0x7+parseInt(_0x249009(0x202))/0x8*(-parseInt(_0x249009(0x1e8))/0x9);if(_0x1d4a7b===_0x366a8a)break;else _0xf0b14b['push'](_0xf0b14b['shift']());}catch(_0x3c676e){_0xf0b14b['push'](_0xf0b14b['shift']());}}}(a53_0x1979,0xd8b79));function a53_0x7c8d(_0x2bcac2,_0x560f80){const _0x197994=a53_0x1979();return a53_0x7c8d=function(_0x7c8d52,_0x29942d){_0x7c8d52=_0x7c8d52-0x1dc;let _0x5b3a19=_0x197994[_0x7c8d52];return _0x5b3a19;},a53_0x7c8d(_0x2bcac2,_0x560f80);}var __importDefault=this&&this[a53_0x4e5fd7(0x201)]||function(_0x7474c8){return _0x7474c8&&_0x7474c8['__esModule']?_0x7474c8:{'default':_0x7474c8};};function a53_0x1979(){const _0x2699e8=['getWebhookLogs','USDT\x20ERC20','getPayouts','testWebhook','Payment\x20not\x20found','getShopPayoutStats','reduce','ShopService','statusCode','ceil','balance','settings','count','gateways','paymentService','paidAt','Test\x20Gateway','90d','16407SHXctf','error','usdtErcWallet','awaitingPayout','getPayoutStatistics','message','event','TesSoft\x20Payment\x20System/1.0\x20(Test)','4LQteXz','getStatistics','PENDING','log','\x20\x20\x20📅\x20This\x20month:\x20','getDate','toISOString','map','getPayoutById','getPaymentsByShop','network','default','responseBody','updateWallets','2972615wvSOjT','54704QCbddd','getPaymentById','__importDefault','6168RAofnK','USDT\x20TRC20','paymentId','getTime','getFullYear','findMany','Shop\x20not\x20found','lte','publicKey','isArray','set','test_order_123','merchantUrl','test','desc','paid','KLYME\x20DE','2490576tPpYbd','payment','usdtTrcWallet','CoinToPay','retryCount','985165ytCPAZ','update','gatewaySettings','getMonth','\x20\x20\x20💰\x20Total\x20paid\x20out:\x20','thisMonth','maxPayments','COMPLETED','totalPaidOut','currency','formatNetworkName','findFirst','statusText','createPublicPayment','language','dailyRevenue','sourceCurrency','updateShopProfile','name','get','generateDailyStatistics','expiresAt','../config/database','USD','push','country','dailyPayments','convertToUSDT','telegram','USDT\x20BSC','payout','notes','filter','findUnique','createdAt','shopUrl','revenue','Test\x20webhook\x20sent\x20successfully\x20(','gateway','defineProperty','getGatewayDisplayName','./currencyService','No\x20webhook\x20URL\x20configured','...','shopId','paymentGateways','all','./paymentService','shop','getPaymentByShopAndId','telegramId','Noda','wallets','POST','stringify','setDate','txid','toUpperCase','currencyService','asc','amountUSDT','\x20\x20\x20💵\x20Available\x20balance:\x20','periodTo','usdtPolygonWallet','1904202scXItx','delete','periodFrom','fullName','webhookUrl','test_gateway','usdcPolygonWallet','aggregate','parse','USDC\x20Polygon','status','PAID','customerName','redirectUrl','split','round','__esModule','Plisio','username','PaymentService','gte','amount','usage','30d','6723556cfLfJK','test_payment_123','_sum','📊\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','KLYME\x20GB','Error\x20parsing\x20webhook\x20events:','webhookEvents','customer','updatePayment','deletePayment'];a53_0x1979=function(){return _0x2699e8;};return a53_0x1979();}Object[a53_0x4e5fd7(0x23f)](exports,a53_0x4e5fd7(0x268),{'value':!![]}),exports[a53_0x4e5fd7(0x1dd)]=void 0x0;const database_1=__importDefault(require(a53_0x4e5fd7(0x22e))),currencyService_1=require(a53_0x4e5fd7(0x241)),paymentService_1=require(a53_0x4e5fd7(0x247));class ShopService{constructor(){const _0x44a64c=a53_0x4e5fd7;this[_0x44a64c(0x1e4)]=new paymentService_1[(_0x44a64c(0x26b))]();}async['getShopProfile'](_0x57b7d4){const _0x19e691=a53_0x4e5fd7,_0x237fce=await database_1[_0x19e691(0x1fb)][_0x19e691(0x248)][_0x19e691(0x239)]({'where':{'id':_0x57b7d4},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x237fce)throw new Error(_0x19e691(0x208));let _0x3225da=[];if(_0x237fce['settings']?.[_0x19e691(0x276)])try{_0x3225da=Array[_0x19e691(0x20b)](_0x237fce['settings']['webhookEvents'])?_0x237fce[_0x19e691(0x1e1)][_0x19e691(0x276)]:JSON[_0x19e691(0x260)](_0x237fce['settings'][_0x19e691(0x276)]);}catch(_0x40c3dd){console[_0x19e691(0x1e9)](_0x19e691(0x275),_0x40c3dd),_0x3225da=[];}return{'id':_0x237fce['id'],'fullName':_0x237fce[_0x19e691(0x22a)],'username':_0x237fce[_0x19e691(0x26a)],'telegramId':_0x237fce[_0x19e691(0x234)],'merchantUrl':_0x237fce['shopUrl'],'gateways':_0x237fce[_0x19e691(0x245)]?JSON['parse'](_0x237fce[_0x19e691(0x245)]):null,'gatewaySettings':_0x237fce[_0x19e691(0x21a)]?JSON['parse'](_0x237fce[_0x19e691(0x21a)]):null,'publicKey':_0x237fce[_0x19e691(0x20a)],'webhookUrl':_0x237fce[_0x19e691(0x1e1)]?.[_0x19e691(0x25c)]||null,'webhookEvents':_0x3225da,'wallets':{'usdtPolygonWallet':_0x237fce[_0x19e691(0x257)],'usdtTrcWallet':_0x237fce[_0x19e691(0x215)],'usdtErcWallet':_0x237fce['usdtErcWallet'],'usdcPolygonWallet':_0x237fce[_0x19e691(0x25e)]},'status':_0x237fce[_0x19e691(0x262)],'createdAt':_0x237fce[_0x19e691(0x23a)]};}async[a53_0x4e5fd7(0x229)](_0x5941de,_0x342d38){const _0x487267=a53_0x4e5fd7,_0x44d5ca={};_0x342d38[_0x487267(0x25b)]&&(_0x44d5ca[_0x487267(0x22a)]=_0x342d38[_0x487267(0x25b)]);_0x342d38[_0x487267(0x24a)]!==undefined&&(_0x44d5ca[_0x487267(0x234)]=_0x342d38['telegramId']||null);_0x342d38['merchantUrl']&&(_0x44d5ca[_0x487267(0x23b)]=_0x342d38[_0x487267(0x20e)]);_0x342d38[_0x487267(0x1e3)]&&(_0x44d5ca['paymentGateways']=JSON[_0x487267(0x24e)](_0x342d38['gateways']));_0x342d38['gatewaySettings']&&(_0x44d5ca[_0x487267(0x21a)]=JSON[_0x487267(0x24e)](_0x342d38['gatewaySettings']));_0x342d38[_0x487267(0x24c)]&&(_0x342d38[_0x487267(0x24c)]['usdtPolygonWallet']!==undefined&&(_0x44d5ca[_0x487267(0x257)]=_0x342d38['wallets'][_0x487267(0x257)]||null),_0x342d38[_0x487267(0x24c)][_0x487267(0x215)]!==undefined&&(_0x44d5ca['usdtTrcWallet']=_0x342d38['wallets']['usdtTrcWallet']||null),_0x342d38[_0x487267(0x24c)]['usdtErcWallet']!==undefined&&(_0x44d5ca[_0x487267(0x1ea)]=_0x342d38[_0x487267(0x24c)][_0x487267(0x1ea)]||null),_0x342d38['wallets'][_0x487267(0x25e)]!==undefined&&(_0x44d5ca[_0x487267(0x25e)]=_0x342d38[_0x487267(0x24c)][_0x487267(0x25e)]||null));const _0x585eab=await database_1[_0x487267(0x1fb)][_0x487267(0x248)]['update']({'where':{'id':_0x5941de},'data':_0x44d5ca,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x1ee5e5=[];if(_0x585eab['settings']?.[_0x487267(0x276)])try{_0x1ee5e5=Array[_0x487267(0x20b)](_0x585eab[_0x487267(0x1e1)][_0x487267(0x276)])?_0x585eab[_0x487267(0x1e1)]['webhookEvents']:JSON[_0x487267(0x260)](_0x585eab[_0x487267(0x1e1)][_0x487267(0x276)]);}catch(_0x3f3d2c){console['error'](_0x487267(0x275),_0x3f3d2c),_0x1ee5e5=[];}return{'id':_0x585eab['id'],'fullName':_0x585eab['name'],'username':_0x585eab[_0x487267(0x26a)],'telegramId':_0x585eab[_0x487267(0x234)],'merchantUrl':_0x585eab['shopUrl'],'gateways':_0x585eab['paymentGateways']?JSON[_0x487267(0x260)](_0x585eab['paymentGateways']):null,'gatewaySettings':_0x585eab[_0x487267(0x21a)]?JSON[_0x487267(0x260)](_0x585eab[_0x487267(0x21a)]):null,'publicKey':_0x585eab['publicKey'],'webhookUrl':_0x585eab['settings']?.[_0x487267(0x25c)]||null,'webhookEvents':_0x1ee5e5,'wallets':{'usdtPolygonWallet':_0x585eab[_0x487267(0x257)],'usdtTrcWallet':_0x585eab['usdtTrcWallet'],'usdtErcWallet':_0x585eab['usdtErcWallet'],'usdcPolygonWallet':_0x585eab[_0x487267(0x25e)]},'status':_0x585eab['status'],'createdAt':_0x585eab[_0x487267(0x23a)]};}async[a53_0x4e5fd7(0x1fd)](_0x316e8a,_0x33165e){const _0x3901ca=a53_0x4e5fd7,_0x37e585={};_0x33165e[_0x3901ca(0x257)]!==undefined&&(_0x37e585[_0x3901ca(0x257)]=_0x33165e['usdtPolygonWallet']||null),_0x33165e[_0x3901ca(0x215)]!==undefined&&(_0x37e585['usdtTrcWallet']=_0x33165e[_0x3901ca(0x215)]||null),_0x33165e['usdtErcWallet']!==undefined&&(_0x37e585['usdtErcWallet']=_0x33165e[_0x3901ca(0x1ea)]||null),_0x33165e[_0x3901ca(0x25e)]!==undefined&&(_0x37e585[_0x3901ca(0x25e)]=_0x33165e['usdcPolygonWallet']||null),await database_1[_0x3901ca(0x1fb)][_0x3901ca(0x248)]['update']({'where':{'id':_0x316e8a},'data':_0x37e585});}async[a53_0x4e5fd7(0x27d)](_0x56ce0a){const _0x3e6235=a53_0x4e5fd7,_0x5545c3=await database_1[_0x3e6235(0x1fb)]['shop'][_0x3e6235(0x239)]({'where':{'id':_0x56ce0a},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x5545c3?.[_0x3e6235(0x1e1)]?.['webhookUrl'])throw new Error(_0x3e6235(0x242));const _0x357561={'event':_0x3e6235(0x20f),'payment':{'id':_0x3e6235(0x271),'order_id':_0x3e6235(0x20d),'gateway':_0x3e6235(0x20f),'amount':0x64,'currency':_0x3e6235(0x22f),'status':_0x3e6235(0x211),'created_at':new Date()[_0x3e6235(0x1f6)]()}};try{const _0x8f4dd5=await fetch(_0x5545c3[_0x3e6235(0x1e1)]['webhookUrl'],{'method':_0x3e6235(0x24d),'headers':{'Content-Type':'application/json','User-Agent':_0x3e6235(0x1ef)},'body':JSON[_0x3e6235(0x24e)](_0x357561)});return _0x8f4dd5['ok']?{'success':!![],'message':_0x3e6235(0x23d)+_0x8f4dd5[_0x3e6235(0x262)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x8f4dd5[_0x3e6235(0x262)]+'\x20'+_0x8f4dd5[_0x3e6235(0x224)]};}catch(_0x415229){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x415229 instanceof Error?_0x415229[_0x3e6235(0x1ed)]:'Unknown\x20error')};}}async['createPayment'](_0x56ba8a){const _0x391e92=a53_0x4e5fd7;return this[_0x391e92(0x1e4)][_0x391e92(0x225)]({'public_key':'','gateway':_0x56ba8a['gateway'],'order_id':undefined,'amount':_0x56ba8a['amount'],'currency':_0x56ba8a[_0x391e92(0x221)],'source_currency':_0x56ba8a[_0x391e92(0x228)],'usage':_0x56ba8a[_0x391e92(0x26e)],'expires_at':_0x56ba8a[_0x391e92(0x22d)]?.[_0x391e92(0x1f6)](),'success_url':_0x56ba8a[_0x391e92(0x265)],'fail_url':_0x56ba8a[_0x391e92(0x265)],'customer_email':_0x56ba8a['customerEmail'],'customer_name':_0x56ba8a[_0x391e92(0x264)],'country':_0x56ba8a[_0x391e92(0x231)],'language':_0x56ba8a[_0x391e92(0x226)],'amount_is_editable':_0x56ba8a['amountIsEditable'],'max_payments':_0x56ba8a[_0x391e92(0x21e)],'customer':_0x56ba8a[_0x391e92(0x277)]});}async['getPayments'](_0x1a47bf,_0x4d9812){const _0x83619e=a53_0x4e5fd7;return this[_0x83619e(0x1e4)][_0x83619e(0x1f9)](_0x1a47bf,_0x4d9812);}async[a53_0x4e5fd7(0x200)](_0x273d1f,_0x5daed0){const _0x29a709=a53_0x4e5fd7;return this['paymentService'][_0x29a709(0x249)](_0x273d1f,_0x5daed0);}async[a53_0x4e5fd7(0x278)](_0x5adeef,_0x5c1645,_0x22e1cc){const _0x1148ec=a53_0x4e5fd7,_0x23cdb9=await database_1['default'][_0x1148ec(0x214)][_0x1148ec(0x223)]({'where':{'id':_0x5c1645,'shopId':_0x5adeef}});if(!_0x23cdb9)throw new Error(_0x1148ec(0x27e));const _0x1c091f=await database_1['default'][_0x1148ec(0x214)][_0x1148ec(0x219)]({'where':{'id':_0x5c1645},'data':{..._0x22e1cc,'updatedAt':new Date()}});return _0x1c091f;}async[a53_0x4e5fd7(0x279)](_0xa6aa25,_0x52db99){const _0x484249=a53_0x4e5fd7,_0x16bbe4=await database_1[_0x484249(0x1fb)]['payment'][_0x484249(0x223)]({'where':{'id':_0x52db99,'shopId':_0xa6aa25}});if(!_0x16bbe4)throw new Error(_0x484249(0x27e));await database_1[_0x484249(0x1fb)]['payment'][_0x484249(0x259)]({'where':{'id':_0x52db99}});}[a53_0x4e5fd7(0x222)](_0x34efc2){const _0x4dc8b0=a53_0x4e5fd7,_0xbca126={'polygon':'USDT\x20Polygon','trc20':_0x4dc8b0(0x203),'erc20':_0x4dc8b0(0x27b),'bsc':_0x4dc8b0(0x235),'polygon_usdc':_0x4dc8b0(0x261)};return _0xbca126[_0x34efc2]||_0x34efc2;}async[a53_0x4e5fd7(0x27c)](_0x21d1bb,_0x2d2b59){const _0x4fe9d3=a53_0x4e5fd7,{page:_0x1b4549,limit:_0x150a56,status:_0x197e84,method:_0x248a7d,dateFrom:_0x5d0e77,dateTo:_0x190640,periodFrom:_0x30fffa,periodTo:_0x4284f9}=_0x2d2b59,_0x54bd4e=(_0x1b4549-0x1)*_0x150a56,_0x3f78ab={'shopId':_0x21d1bb};_0x197e84&&(_0x3f78ab[_0x4fe9d3(0x262)]=_0x197e84[_0x4fe9d3(0x251)]());_0x248a7d&&(_0x3f78ab[_0x4fe9d3(0x1fa)]=_0x248a7d);if(_0x5d0e77||_0x190640||_0x30fffa||_0x4284f9){_0x3f78ab[_0x4fe9d3(0x23a)]={};if(_0x30fffa)_0x3f78ab[_0x4fe9d3(0x23a)][_0x4fe9d3(0x26c)]=new Date(_0x30fffa);else _0x5d0e77&&(_0x3f78ab[_0x4fe9d3(0x23a)][_0x4fe9d3(0x26c)]=new Date(_0x5d0e77));if(_0x4284f9)_0x3f78ab['createdAt'][_0x4fe9d3(0x209)]=new Date(_0x4284f9);else _0x190640&&(_0x3f78ab[_0x4fe9d3(0x23a)][_0x4fe9d3(0x209)]=new Date(_0x190640));}const [_0x2d9210,_0x2f62ae]=await Promise['all']([database_1[_0x4fe9d3(0x1fb)]['payout']['findMany']({'where':_0x3f78ab,'skip':_0x54bd4e,'take':_0x150a56,'orderBy':{'createdAt':_0x4fe9d3(0x210)}}),database_1[_0x4fe9d3(0x1fb)]['payout']['count']({'where':_0x3f78ab})]);return{'payouts':_0x2d9210[_0x4fe9d3(0x1f7)](_0x16b679=>({'id':_0x16b679['id'],'amount':_0x16b679[_0x4fe9d3(0x26d)],'network':this[_0x4fe9d3(0x222)](_0x16b679[_0x4fe9d3(0x1fa)]),'status':_0x16b679[_0x4fe9d3(0x262)],'txid':_0x16b679[_0x4fe9d3(0x250)],'notes':_0x16b679['notes'],'periodFrom':_0x16b679[_0x4fe9d3(0x25a)],'periodTo':_0x16b679[_0x4fe9d3(0x256)],'createdAt':_0x16b679['createdAt'],'paidAt':_0x16b679['paidAt']})),'pagination':{'page':_0x1b4549,'limit':_0x150a56,'total':_0x2f62ae,'totalPages':Math[_0x4fe9d3(0x1df)](_0x2f62ae/_0x150a56)}};}async[a53_0x4e5fd7(0x1f8)](_0x4bf702,_0x3af133){const _0x4948cc=a53_0x4e5fd7,_0x3f9b5d=await database_1[_0x4948cc(0x1fb)][_0x4948cc(0x236)][_0x4948cc(0x223)]({'where':{'id':_0x3af133,'shopId':_0x4bf702}});if(!_0x3f9b5d)return null;return{'id':_0x3f9b5d['id'],'amount':_0x3f9b5d[_0x4948cc(0x26d)],'network':_0x3f9b5d[_0x4948cc(0x1fa)],'status':_0x3f9b5d[_0x4948cc(0x262)],'txid':_0x3f9b5d[_0x4948cc(0x250)],'notes':_0x3f9b5d[_0x4948cc(0x237)],'createdAt':_0x3f9b5d[_0x4948cc(0x23a)],'paidAt':_0x3f9b5d[_0x4948cc(0x1e5)]};}async[a53_0x4e5fd7(0x1ec)](_0x135abf,_0x5ca75a){const _0x29b847=a53_0x4e5fd7,_0x502a71=new Date();let _0x3304e7;switch(_0x5ca75a){case'7d':_0x3304e7=new Date(_0x502a71['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x29b847(0x26f):_0x3304e7=new Date(_0x502a71[_0x29b847(0x205)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x29b847(0x1e7):_0x3304e7=new Date(_0x502a71[_0x29b847(0x205)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x3304e7=new Date(_0x502a71[_0x29b847(0x205)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x136e14,_0x11059e,_0x1393cd,_0x498b57,_0x92034c,_0x4aa874]=await Promise[_0x29b847(0x246)]([database_1['default'][_0x29b847(0x236)]['count']({'where':{'shopId':_0x135abf,'createdAt':{'gte':_0x3304e7}}}),database_1[_0x29b847(0x1fb)][_0x29b847(0x236)][_0x29b847(0x1e2)]({'where':{'shopId':_0x135abf,'status':_0x29b847(0x21f),'createdAt':{'gte':_0x3304e7}}}),database_1[_0x29b847(0x1fb)][_0x29b847(0x236)][_0x29b847(0x1e2)]({'where':{'shopId':_0x135abf,'status':_0x29b847(0x1f2),'createdAt':{'gte':_0x3304e7}}}),database_1[_0x29b847(0x1fb)][_0x29b847(0x236)][_0x29b847(0x1e2)]({'where':{'shopId':_0x135abf,'status':'REJECTED','createdAt':{'gte':_0x3304e7}}}),database_1['default'][_0x29b847(0x236)][_0x29b847(0x207)]({'where':{'shopId':_0x135abf,'createdAt':{'gte':_0x3304e7}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x29b847(0x1fb)]['payout']['findMany']({'where':{'shopId':_0x135abf},'take':0xa,'orderBy':{'createdAt':_0x29b847(0x210)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0xe32aac=_0x92034c['reduce']((_0xaca5d5,_0x278317)=>_0xaca5d5+_0x278317[_0x29b847(0x26d)],0x0),_0x572e44=_0x92034c[_0x29b847(0x238)](_0x3f07d5=>_0x3f07d5['status']==='COMPLETED')['reduce']((_0x5b55a3,_0x154f2b)=>_0x5b55a3+_0x154f2b[_0x29b847(0x26d)],0x0),_0x6560af=_0x92034c[_0x29b847(0x238)](_0x213be6=>_0x213be6[_0x29b847(0x262)]===_0x29b847(0x1f2))['reduce']((_0x4c48bd,_0x27278f)=>_0x4c48bd+_0x27278f[_0x29b847(0x26d)],0x0),_0x3cb9d7=_0x92034c[_0x29b847(0x1dc)]((_0x3639a1,_0x3f8152)=>{const _0x34322c=_0x29b847;return _0x3639a1[_0x3f8152['network']]=(_0x3639a1[_0x3f8152[_0x34322c(0x1fa)]]||0x0)+0x1,_0x3639a1;},{}),_0x382b81=_0x92034c[_0x29b847(0x1dc)]((_0x5b137a,_0x14c8eb)=>{const _0x1049b3=_0x29b847;return _0x5b137a[_0x14c8eb[_0x1049b3(0x262)]]=(_0x5b137a[_0x14c8eb['status']]||0x0)+0x1,_0x5b137a;},{});return{'totalPayouts':_0x136e14,'completedPayouts':_0x11059e,'pendingPayouts':_0x1393cd,'rejectedPayouts':_0x498b57,'totalAmount':_0xe32aac,'completedAmount':_0x572e44,'pendingAmount':_0x6560af,'payoutsByMethod':_0x3cb9d7,'payoutsByStatus':_0x382b81,'recentPayouts':_0x4aa874['map'](_0x504122=>({'id':_0x504122['id'],'shopId':_0x135abf,'amount':_0x504122[_0x29b847(0x26d)],'method':_0x504122[_0x29b847(0x1fa)],'status':_0x504122[_0x29b847(0x262)],'txid':_0x504122['txid'],'createdAt':_0x504122[_0x29b847(0x23a)],'paidAt':_0x504122[_0x29b847(0x1e5)]}))};}async[a53_0x4e5fd7(0x27f)](_0x140f03){const _0x2bb325=a53_0x4e5fd7;console[_0x2bb325(0x1f3)](_0x2bb325(0x273)+_0x140f03+_0x2bb325(0x243));const _0xd8f6b8=await database_1[_0x2bb325(0x1fb)][_0x2bb325(0x248)][_0x2bb325(0x239)]({'where':{'id':_0x140f03},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xd8f6b8)throw new Error(_0x2bb325(0x208));const _0x57bed3=new Date(),_0x4cd677=new Date(_0x57bed3[_0x2bb325(0x206)](),_0x57bed3[_0x2bb325(0x21b)](),0x1),_0x35e1d9=new Date(_0x57bed3['getFullYear'](),_0x57bed3[_0x2bb325(0x21b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x417c2e=await database_1[_0x2bb325(0x1fb)][_0x2bb325(0x236)][_0x2bb325(0x25f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x140f03,'createdAt':{'gte':_0x4cd677,'lte':_0x35e1d9},'status':_0x2bb325(0x21f)}}),_0xb057ae=_0x417c2e[_0x2bb325(0x272)][_0x2bb325(0x26d)]||0x0,_0x36e52c={'availableBalance':Math[_0x2bb325(0x267)](_0xd8f6b8[_0x2bb325(0x1e0)]*0x64)/0x64,'totalPaidOut':Math['round'](_0xd8f6b8[_0x2bb325(0x220)]*0x64)/0x64,'awaitingPayout':Math[_0x2bb325(0x267)](_0xd8f6b8[_0x2bb325(0x1e0)]*0x64)/0x64,'thisMonth':Math[_0x2bb325(0x267)](_0xb057ae*0x64)/0x64};return console['log']('📊\x20Shop\x20'+_0xd8f6b8['username']+'\x20payout\x20statistics\x20calculated:'),console[_0x2bb325(0x1f3)](_0x2bb325(0x255)+_0x36e52c['availableBalance']+'\x20USDT\x20(current\x20balance)'),console['log'](_0x2bb325(0x21c)+_0x36e52c[_0x2bb325(0x220)]+'\x20USDT\x20(total\x20payouts)'),console[_0x2bb325(0x1f3)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x36e52c[_0x2bb325(0x1eb)]+'\x20USDT\x20(current\x20balance)'),console[_0x2bb325(0x1f3)](_0x2bb325(0x1f4)+_0x36e52c[_0x2bb325(0x21d)]+'\x20USDT'),_0x36e52c;}[a53_0x4e5fd7(0x240)](_0x36dd74){const _0x1efc1d=a53_0x4e5fd7,_0x15544b={'test_gateway':_0x1efc1d(0x1e6),'plisio':_0x1efc1d(0x269),'rapyd':'Rapyd','noda':_0x1efc1d(0x24b),'cointopay':_0x1efc1d(0x216),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x1efc1d(0x274),'klyme_de':_0x1efc1d(0x212)};return _0x15544b[_0x36dd74]||_0x36dd74;}async['getPayoutStats'](_0x23ad1f){return this['getShopPayoutStats'](_0x23ad1f);}async[a53_0x4e5fd7(0x27a)](_0x4e0a00,_0x450b5e){const _0x4b680b=a53_0x4e5fd7,{page:_0x402603,limit:_0x69ab92,paymentId:_0x4520bc}=_0x450b5e,_0xc34f23=(_0x402603-0x1)*_0x69ab92,_0x85a49e={'shopId':_0x4e0a00};_0x4520bc&&(_0x85a49e[_0x4b680b(0x204)]=_0x4520bc);const [_0x1591ec,_0x2221d1]=await Promise[_0x4b680b(0x246)]([database_1[_0x4b680b(0x1fb)]['webhookLog'][_0x4b680b(0x207)]({'where':_0x85a49e,'skip':_0xc34f23,'take':_0x69ab92,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default']['webhookLog'][_0x4b680b(0x1e2)]({'where':_0x85a49e})]);return{'logs':_0x1591ec[_0x4b680b(0x1f7)](_0x2427d4=>({'id':_0x2427d4['id'],'paymentId':_0x2427d4[_0x4b680b(0x204)],'shopId':_0x2427d4[_0x4b680b(0x244)],'event':_0x2427d4[_0x4b680b(0x1ee)],'statusCode':_0x2427d4[_0x4b680b(0x1de)],'retryCount':_0x2427d4[_0x4b680b(0x217)],'responseBody':_0x2427d4[_0x4b680b(0x1fc)],'createdAt':_0x2427d4[_0x4b680b(0x23a)],'payment':_0x2427d4[_0x4b680b(0x214)]})),'pagination':{'page':_0x402603,'limit':_0x69ab92,'total':_0x2221d1,'totalPages':Math['ceil'](_0x2221d1/_0x69ab92)}};}async[a53_0x4e5fd7(0x1f1)](_0x390105,_0x295259){const _0x2088c8=a53_0x4e5fd7,_0x3bb225=new Date();let _0x39e693;switch(_0x295259){case'7d':_0x39e693=new Date(_0x3bb225['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2088c8(0x26f):_0x39e693=new Date(_0x3bb225[_0x2088c8(0x205)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x39e693=new Date(_0x3bb225['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x39e693=new Date(_0x3bb225[_0x2088c8(0x205)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x204132,_0x1feb33,_0x30900d,_0x3a8da1,_0x450a73]=await Promise[_0x2088c8(0x246)]([database_1[_0x2088c8(0x1fb)][_0x2088c8(0x214)][_0x2088c8(0x1e2)]({'where':{'shopId':_0x390105,'gateway':{'not':_0x2088c8(0x25d)},'createdAt':{'gte':_0x39e693}}}),database_1[_0x2088c8(0x1fb)][_0x2088c8(0x214)]['count']({'where':{'shopId':_0x390105,'gateway':{'not':'test_gateway'},'status':_0x2088c8(0x263),'createdAt':{'gte':_0x39e693}}}),database_1[_0x2088c8(0x1fb)][_0x2088c8(0x214)][_0x2088c8(0x207)]({'where':{'shopId':_0x390105,'gateway':{'not':_0x2088c8(0x25d)},'status':_0x2088c8(0x263),'createdAt':{'gte':_0x39e693}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x2088c8(0x1fb)][_0x2088c8(0x214)][_0x2088c8(0x207)]({'where':{'shopId':_0x390105,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x2088c8(0x210)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x2088c8(0x1fb)][_0x2088c8(0x214)]['findMany']({'where':{'shopId':_0x390105,'gateway':{'not':_0x2088c8(0x25d)},'createdAt':{'gte':_0x39e693}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x2088c8(0x253)}})]);let _0x386170=0x0;for(const _0x190ecb of _0x30900d){if(_0x190ecb[_0x2088c8(0x254)])_0x386170+=_0x190ecb[_0x2088c8(0x254)];else{const _0x2a60cb=await currencyService_1[_0x2088c8(0x252)][_0x2088c8(0x233)](_0x190ecb['amount'],_0x190ecb[_0x2088c8(0x221)]);_0x386170+=_0x2a60cb;}}const _0x5c187d=this['generateDailyStatistics'](_0x450a73,_0x39e693,_0x3bb225),_0x20e1aa=_0x204132>0x0?_0x1feb33/_0x204132*0x64:0x0;return{'totalPayments':_0x204132,'successfulPayments':_0x1feb33,'totalRevenue':Math[_0x2088c8(0x267)](_0x386170*0x64)/0x64,'conversionRate':Math[_0x2088c8(0x267)](_0x20e1aa*0x64)/0x64,'dailyRevenue':_0x5c187d[_0x2088c8(0x227)],'dailyPayments':_0x5c187d[_0x2088c8(0x232)],'recentPayments':_0x3a8da1[_0x2088c8(0x1f7)](_0x48ef60=>({'id':_0x48ef60['id'],'gateway':_0x48ef60[_0x2088c8(0x23e)],'amount':_0x48ef60[_0x2088c8(0x26d)],'currency':_0x48ef60[_0x2088c8(0x221)],'status':_0x48ef60[_0x2088c8(0x262)],'createdAt':_0x48ef60[_0x2088c8(0x23a)]}))};}[a53_0x4e5fd7(0x22c)](_0x3c8b33,_0x9c4d21,_0x38cd0a){const _0x3a2b5e=a53_0x4e5fd7,_0x1c5505=new Map(),_0x527b79=new Date(_0x9c4d21);while(_0x527b79<=_0x38cd0a){const _0x3c50c9=_0x527b79['toISOString']()[_0x3a2b5e(0x266)]('T')[0x0];_0x1c5505[_0x3a2b5e(0x20c)](_0x3c50c9,{'revenue':0x0,'count':0x0}),_0x527b79[_0x3a2b5e(0x24f)](_0x527b79[_0x3a2b5e(0x1f5)]()+0x1);}for(const _0x164997 of _0x3c8b33){const _0x469286=_0x164997[_0x3a2b5e(0x23a)][_0x3a2b5e(0x1f6)]()[_0x3a2b5e(0x266)]('T')[0x0],_0x593869=_0x1c5505[_0x3a2b5e(0x22b)](_0x469286);_0x593869&&(_0x593869[_0x3a2b5e(0x1e2)]+=0x1,_0x164997[_0x3a2b5e(0x262)]===_0x3a2b5e(0x263)&&_0x164997[_0x3a2b5e(0x254)]&&(_0x593869[_0x3a2b5e(0x23c)]+=_0x164997[_0x3a2b5e(0x254)]));}const _0x414220=[],_0x222bd4=[];for(const [_0x584911,_0x334c38]of _0x1c5505){_0x414220['push']({'date':_0x584911,'amount':Math[_0x3a2b5e(0x267)](_0x334c38[_0x3a2b5e(0x23c)]*0x64)/0x64}),_0x222bd4[_0x3a2b5e(0x230)]({'date':_0x584911,'count':_0x334c38['count']});}return{'dailyRevenue':_0x414220,'dailyPayments':_0x222bd4};}}exports['ShopService']=ShopService;