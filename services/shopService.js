'use strict';const a54_0x49f268=a54_0x287e;function a54_0x287e(_0x4e7d78,_0x5b5270){const _0x128abc=a54_0x128a();return a54_0x287e=function(_0x287ecf,_0x4c154a){_0x287ecf=_0x287ecf-0x1d4;let _0x1a730f=_0x128abc[_0x287ecf];return _0x1a730f;},a54_0x287e(_0x4e7d78,_0x5b5270);}(function(_0x563056,_0x3e05d){const _0xd3c9ac=a54_0x287e,_0x2fe271=_0x563056();while(!![]){try{const _0x4f50fd=-parseInt(_0xd3c9ac(0x20e))/0x1+parseInt(_0xd3c9ac(0x236))/0x2*(parseInt(_0xd3c9ac(0x272))/0x3)+parseInt(_0xd3c9ac(0x22e))/0x4+parseInt(_0xd3c9ac(0x27a))/0x5*(-parseInt(_0xd3c9ac(0x241))/0x6)+-parseInt(_0xd3c9ac(0x26f))/0x7+-parseInt(_0xd3c9ac(0x1e9))/0x8+parseInt(_0xd3c9ac(0x281))/0x9*(parseInt(_0xd3c9ac(0x251))/0xa);if(_0x4f50fd===_0x3e05d)break;else _0x2fe271['push'](_0x2fe271['shift']());}catch(_0x1bd8c7){_0x2fe271['push'](_0x2fe271['shift']());}}}(a54_0x128a,0x4963e));var __importDefault=this&&this[a54_0x49f268(0x24f)]||function(_0x332ec4){return _0x332ec4&&_0x332ec4['__esModule']?_0x332ec4:{'default':_0x332ec4};};Object[a54_0x49f268(0x24d)](exports,'__esModule',{'value':!![]}),exports[a54_0x49f268(0x21f)]=void 0x0;const database_1=__importDefault(require(a54_0x49f268(0x1ef))),currencyService_1=require(a54_0x49f268(0x238)),paymentService_1=require(a54_0x49f268(0x244));class ShopService{constructor(){const _0x4c9c14=a54_0x49f268;this[_0x4c9c14(0x26b)]=new paymentService_1[(_0x4c9c14(0x1f5))]();}async[a54_0x49f268(0x1e0)](_0x5b5068){const _0x14f459=a54_0x49f268,_0x19f514=await database_1['default'][_0x14f459(0x273)][_0x14f459(0x1e1)]({'where':{'id':_0x5b5068},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x19f514)throw new Error(_0x14f459(0x258));let _0x1a3ac8=[];if(_0x19f514['settings']?.[_0x14f459(0x220)])try{_0x1a3ac8=Array[_0x14f459(0x1d7)](_0x19f514[_0x14f459(0x208)][_0x14f459(0x220)])?_0x19f514[_0x14f459(0x208)][_0x14f459(0x220)]:JSON[_0x14f459(0x22a)](_0x19f514[_0x14f459(0x208)][_0x14f459(0x220)]);}catch(_0x41fe44){console['error'](_0x14f459(0x235),_0x41fe44),_0x1a3ac8=[];}return{'id':_0x19f514['id'],'fullName':_0x19f514['name'],'username':_0x19f514[_0x14f459(0x21e)],'telegramId':_0x19f514[_0x14f459(0x1f3)],'merchantUrl':_0x19f514[_0x14f459(0x260)],'gateways':_0x19f514['paymentGateways']?JSON[_0x14f459(0x22a)](_0x19f514[_0x14f459(0x1e3)]):null,'gatewaySettings':_0x19f514[_0x14f459(0x261)]?JSON['parse'](_0x19f514[_0x14f459(0x261)]):null,'publicKey':_0x19f514[_0x14f459(0x264)],'webhookUrl':_0x19f514['settings']?.[_0x14f459(0x240)]||null,'webhookEvents':_0x1a3ac8,'wallets':{'usdtPolygonWallet':_0x19f514[_0x14f459(0x1de)],'usdtTrcWallet':_0x19f514[_0x14f459(0x268)],'usdtErcWallet':_0x19f514['usdtErcWallet'],'usdcPolygonWallet':_0x19f514[_0x14f459(0x27b)]},'status':_0x19f514[_0x14f459(0x263)],'createdAt':_0x19f514[_0x14f459(0x26d)]};}async[a54_0x49f268(0x228)](_0x588013,_0x19c833){const _0x1e6fec=a54_0x49f268,_0x53dfe2={};_0x19c833[_0x1e6fec(0x213)]&&(_0x53dfe2[_0x1e6fec(0x216)]=_0x19c833[_0x1e6fec(0x213)]);_0x19c833[_0x1e6fec(0x23f)]!==undefined&&(_0x53dfe2[_0x1e6fec(0x1f3)]=_0x19c833[_0x1e6fec(0x23f)]||null);_0x19c833[_0x1e6fec(0x20c)]&&(_0x53dfe2[_0x1e6fec(0x260)]=_0x19c833[_0x1e6fec(0x20c)]);_0x19c833[_0x1e6fec(0x1d9)]&&(_0x53dfe2[_0x1e6fec(0x1e3)]=JSON[_0x1e6fec(0x27f)](_0x19c833[_0x1e6fec(0x1d9)]));_0x19c833['gatewaySettings']&&(_0x53dfe2[_0x1e6fec(0x261)]=JSON['stringify'](_0x19c833['gatewaySettings']));_0x19c833[_0x1e6fec(0x23b)]&&(_0x19c833[_0x1e6fec(0x23b)][_0x1e6fec(0x1de)]!==undefined&&(_0x53dfe2[_0x1e6fec(0x1de)]=_0x19c833[_0x1e6fec(0x23b)][_0x1e6fec(0x1de)]||null),_0x19c833[_0x1e6fec(0x23b)][_0x1e6fec(0x268)]!==undefined&&(_0x53dfe2['usdtTrcWallet']=_0x19c833[_0x1e6fec(0x23b)][_0x1e6fec(0x268)]||null),_0x19c833[_0x1e6fec(0x23b)]['usdtErcWallet']!==undefined&&(_0x53dfe2[_0x1e6fec(0x206)]=_0x19c833[_0x1e6fec(0x23b)][_0x1e6fec(0x206)]||null),_0x19c833[_0x1e6fec(0x23b)]['usdcPolygonWallet']!==undefined&&(_0x53dfe2[_0x1e6fec(0x27b)]=_0x19c833['wallets'][_0x1e6fec(0x27b)]||null));const _0x576775=await database_1['default'][_0x1e6fec(0x273)][_0x1e6fec(0x23e)]({'where':{'id':_0x588013},'data':_0x53dfe2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x210b9d=[];if(_0x576775[_0x1e6fec(0x208)]?.[_0x1e6fec(0x220)])try{_0x210b9d=Array[_0x1e6fec(0x1d7)](_0x576775[_0x1e6fec(0x208)][_0x1e6fec(0x220)])?_0x576775[_0x1e6fec(0x208)][_0x1e6fec(0x220)]:JSON[_0x1e6fec(0x22a)](_0x576775[_0x1e6fec(0x208)][_0x1e6fec(0x220)]);}catch(_0x595584){console[_0x1e6fec(0x222)](_0x1e6fec(0x235),_0x595584),_0x210b9d=[];}return{'id':_0x576775['id'],'fullName':_0x576775[_0x1e6fec(0x216)],'username':_0x576775['username'],'telegramId':_0x576775[_0x1e6fec(0x1f3)],'merchantUrl':_0x576775[_0x1e6fec(0x260)],'gateways':_0x576775[_0x1e6fec(0x1e3)]?JSON[_0x1e6fec(0x22a)](_0x576775['paymentGateways']):null,'gatewaySettings':_0x576775[_0x1e6fec(0x261)]?JSON[_0x1e6fec(0x22a)](_0x576775['gatewaySettings']):null,'publicKey':_0x576775['publicKey'],'webhookUrl':_0x576775[_0x1e6fec(0x208)]?.[_0x1e6fec(0x240)]||null,'webhookEvents':_0x210b9d,'wallets':{'usdtPolygonWallet':_0x576775['usdtPolygonWallet'],'usdtTrcWallet':_0x576775[_0x1e6fec(0x268)],'usdtErcWallet':_0x576775[_0x1e6fec(0x206)],'usdcPolygonWallet':_0x576775[_0x1e6fec(0x27b)]},'status':_0x576775[_0x1e6fec(0x263)],'createdAt':_0x576775[_0x1e6fec(0x26d)]};}async['updateWallets'](_0x54eadb,_0x52e5d1){const _0x8f9b3=a54_0x49f268,_0xd2174b={};_0x52e5d1[_0x8f9b3(0x1de)]!==undefined&&(_0xd2174b[_0x8f9b3(0x1de)]=_0x52e5d1['usdtPolygonWallet']||null),_0x52e5d1[_0x8f9b3(0x268)]!==undefined&&(_0xd2174b[_0x8f9b3(0x268)]=_0x52e5d1[_0x8f9b3(0x268)]||null),_0x52e5d1[_0x8f9b3(0x206)]!==undefined&&(_0xd2174b[_0x8f9b3(0x206)]=_0x52e5d1['usdtErcWallet']||null),_0x52e5d1['usdcPolygonWallet']!==undefined&&(_0xd2174b[_0x8f9b3(0x27b)]=_0x52e5d1[_0x8f9b3(0x27b)]||null),await database_1[_0x8f9b3(0x1f6)][_0x8f9b3(0x273)][_0x8f9b3(0x23e)]({'where':{'id':_0x54eadb},'data':_0xd2174b});}async[a54_0x49f268(0x276)](_0xcda040){const _0x33a1d4=a54_0x49f268,_0x44a753=await database_1['default'][_0x33a1d4(0x273)][_0x33a1d4(0x1e1)]({'where':{'id':_0xcda040},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x44a753?.[_0x33a1d4(0x208)]?.[_0x33a1d4(0x240)])throw new Error(_0x33a1d4(0x223));const _0x148b73={'event':_0x33a1d4(0x1ea),'payment':{'id':_0x33a1d4(0x1d5),'order_id':_0x33a1d4(0x25c),'gateway':_0x33a1d4(0x1ea),'amount':0x64,'currency':'USD','status':_0x33a1d4(0x1f9),'created_at':new Date()['toISOString']()}};try{const _0x3ae07c=await fetch(_0x44a753[_0x33a1d4(0x208)][_0x33a1d4(0x240)],{'method':_0x33a1d4(0x1ee),'headers':{'Content-Type':_0x33a1d4(0x22c),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x33a1d4(0x27f)](_0x148b73)});return _0x3ae07c['ok']?{'success':!![],'message':_0x33a1d4(0x256)+_0x3ae07c[_0x33a1d4(0x263)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x3ae07c[_0x33a1d4(0x263)]+'\x20'+_0x3ae07c[_0x33a1d4(0x253)]};}catch(_0xb50152){return{'success':![],'message':_0x33a1d4(0x234)+(_0xb50152 instanceof Error?_0xb50152[_0x33a1d4(0x215)]:_0x33a1d4(0x248))};}}async[a54_0x49f268(0x270)](_0x38a08b){const _0x4014cd=a54_0x49f268;return this['paymentService'][_0x4014cd(0x20d)]({'public_key':'','gateway':_0x38a08b[_0x4014cd(0x25f)],'order_id':undefined,'amount':_0x38a08b[_0x4014cd(0x205)],'currency':_0x38a08b['currency'],'source_currency':_0x38a08b[_0x4014cd(0x27c)],'usage':_0x38a08b['usage'],'expires_at':_0x38a08b[_0x4014cd(0x221)]?.[_0x4014cd(0x254)](),'success_url':_0x38a08b[_0x4014cd(0x252)],'fail_url':_0x38a08b[_0x4014cd(0x252)],'customer_email':_0x38a08b[_0x4014cd(0x279)],'customer_name':_0x38a08b[_0x4014cd(0x26c)],'country':_0x38a08b[_0x4014cd(0x1e4)],'language':_0x38a08b[_0x4014cd(0x21b)],'amount_is_editable':_0x38a08b[_0x4014cd(0x1fb)],'max_payments':_0x38a08b['maxPayments'],'customer':_0x38a08b[_0x4014cd(0x237)]});}async[a54_0x49f268(0x243)](_0x145d78,_0x29c8ed){const _0xa1dd5c=a54_0x49f268;return this[_0xa1dd5c(0x26b)][_0xa1dd5c(0x214)](_0x145d78,_0x29c8ed);}async[a54_0x49f268(0x1f0)](_0x410182,_0x52fb3a){return this['paymentService']['getPaymentByShopAndId'](_0x410182,_0x52fb3a);}async['updatePayment'](_0xa13c29,_0x19fd47,_0xa9e86f){const _0x51809a=a54_0x49f268,_0x1c8f3a=await database_1['default'][_0x51809a(0x20b)]['findFirst']({'where':{'id':_0x19fd47,'shopId':_0xa13c29}});if(!_0x1c8f3a)throw new Error('Payment\x20not\x20found');const _0x116009=await database_1['default'][_0x51809a(0x20b)][_0x51809a(0x23e)]({'where':{'id':_0x19fd47},'data':{..._0xa9e86f,'updatedAt':new Date()}});return _0x116009;}async[a54_0x49f268(0x259)](_0x4819b8,_0x2107af){const _0x38c2b4=a54_0x49f268,_0x37df46=await database_1[_0x38c2b4(0x1f6)][_0x38c2b4(0x20b)][_0x38c2b4(0x262)]({'where':{'id':_0x2107af,'shopId':_0x4819b8}});if(!_0x37df46)throw new Error('Payment\x20not\x20found');await database_1[_0x38c2b4(0x1f6)][_0x38c2b4(0x20b)][_0x38c2b4(0x1eb)]({'where':{'id':_0x2107af}});}['formatNetworkName'](_0x9846a4){const _0x30fe47=a54_0x49f268,_0x5d8493={'polygon':'USDT\x20Polygon','trc20':_0x30fe47(0x21d),'erc20':'USDT\x20ERC20','bsc':_0x30fe47(0x1e6),'polygon_usdc':'USDC\x20Polygon'};return _0x5d8493[_0x9846a4]||_0x9846a4;}async[a54_0x49f268(0x24c)](_0x21cc9b,_0x4544f4){const _0x66fef7=a54_0x49f268,{page:_0x1f01ce,limit:_0x7ae2ea,status:_0x485a17,method:_0x18171c,network:_0x4901b3,dateFrom:_0x59e3f8,dateTo:_0x43debf,periodFrom:_0x1b5674,periodTo:_0x47c326}=_0x4544f4,_0x2fd1f6=(_0x1f01ce-0x1)*_0x7ae2ea;console[_0x66fef7(0x1f8)](_0x66fef7(0x1ff),_0x4544f4);const _0x1b0f3b={'shopId':_0x21cc9b};_0x485a17&&(_0x1b0f3b['status']=_0x485a17[_0x66fef7(0x1e5)](),console[_0x66fef7(0x1f8)](_0x66fef7(0x25a)+_0x485a17[_0x66fef7(0x1e5)]()));if(_0x18171c)_0x1b0f3b['network']=_0x18171c,console[_0x66fef7(0x1f8)](_0x66fef7(0x1d4)+_0x18171c);else _0x4901b3&&(_0x1b0f3b[_0x66fef7(0x271)]=_0x4901b3,console[_0x66fef7(0x1f8)](_0x66fef7(0x1fc)+_0x4901b3));if(_0x59e3f8||_0x43debf||_0x1b5674||_0x47c326){_0x1b0f3b[_0x66fef7(0x26d)]={};if(_0x1b5674){const _0x104ef8=new Date(_0x1b5674);_0x104ef8[_0x66fef7(0x1fd)](0x0,0x0,0x0,0x0),_0x1b0f3b[_0x66fef7(0x26d)][_0x66fef7(0x211)]=_0x104ef8,console[_0x66fef7(0x1f8)](_0x66fef7(0x1ec)+_0x104ef8[_0x66fef7(0x254)]());}else{if(_0x59e3f8){const _0x4c47e2=new Date(_0x59e3f8);_0x4c47e2[_0x66fef7(0x1fd)](0x0,0x0,0x0,0x0),_0x1b0f3b[_0x66fef7(0x26d)][_0x66fef7(0x211)]=_0x4c47e2,console[_0x66fef7(0x1f8)](_0x66fef7(0x267)+_0x4c47e2[_0x66fef7(0x254)]());}}if(_0x47c326){const _0x30d6d5=new Date(_0x47c326);_0x30d6d5[_0x66fef7(0x1fd)](0x17,0x3b,0x3b,0x3e7),_0x1b0f3b['createdAt']['lte']=_0x30d6d5,console[_0x66fef7(0x1f8)]('📅\x20Period\x20end:\x20'+_0x30d6d5['toISOString']());}else{if(_0x43debf){const _0x199bc9=new Date(_0x43debf);_0x199bc9[_0x66fef7(0x1fd)](0x17,0x3b,0x3b,0x3e7),_0x1b0f3b['createdAt'][_0x66fef7(0x233)]=_0x199bc9,console['log'](_0x66fef7(0x1db)+_0x199bc9[_0x66fef7(0x254)]());}}}console['log']('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x66fef7(0x27f)](_0x1b0f3b,null,0x2));const [_0x5df0eb,_0x396d6a]=await Promise[_0x66fef7(0x25d)]([database_1[_0x66fef7(0x1f6)]['payout']['findMany']({'where':_0x1b0f3b,'skip':_0x2fd1f6,'take':_0x7ae2ea,'orderBy':{'createdAt':_0x66fef7(0x269)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x66fef7(0x1f6)][_0x66fef7(0x245)][_0x66fef7(0x277)]({'where':_0x1b0f3b})]);return{'payouts':_0x5df0eb[_0x66fef7(0x1df)](_0x3ee29e=>{const _0x1cc9ad=_0x66fef7;let _0x7e795b=null;switch(_0x3ee29e['network']){case _0x1cc9ad(0x27d):_0x7e795b=_0x3ee29e[_0x1cc9ad(0x273)]['usdtPolygonWallet'];break;case _0x1cc9ad(0x247):_0x7e795b=_0x3ee29e[_0x1cc9ad(0x273)][_0x1cc9ad(0x268)];break;case _0x1cc9ad(0x26a):_0x7e795b=_0x3ee29e[_0x1cc9ad(0x273)][_0x1cc9ad(0x206)];break;case _0x1cc9ad(0x200):_0x7e795b=_0x3ee29e[_0x1cc9ad(0x273)][_0x1cc9ad(0x27b)];break;}return{'id':_0x3ee29e['id'],'amount':_0x3ee29e[_0x1cc9ad(0x205)],'network':this[_0x1cc9ad(0x242)](_0x3ee29e[_0x1cc9ad(0x271)]),'wallet':_0x7e795b,'status':_0x3ee29e[_0x1cc9ad(0x263)],'txid':_0x3ee29e[_0x1cc9ad(0x210)],'notes':_0x3ee29e['notes'],'periodFrom':_0x3ee29e[_0x1cc9ad(0x1f2)],'periodTo':_0x3ee29e[_0x1cc9ad(0x1ed)],'createdAt':_0x3ee29e[_0x1cc9ad(0x26d)],'paidAt':_0x3ee29e[_0x1cc9ad(0x1fa)]};}),'pagination':{'page':_0x1f01ce,'limit':_0x7ae2ea,'total':_0x396d6a,'totalPages':Math['ceil'](_0x396d6a/_0x7ae2ea)}};}async[a54_0x49f268(0x22d)](_0x11f86e,_0x2c1841){const _0x4adaf7=a54_0x49f268,_0x13f47c=await database_1['default'][_0x4adaf7(0x245)][_0x4adaf7(0x262)]({'where':{'id':_0x2c1841,'shopId':_0x11f86e}});if(!_0x13f47c)return null;return{'id':_0x13f47c['id'],'amount':_0x13f47c['amount'],'network':_0x13f47c[_0x4adaf7(0x271)],'status':_0x13f47c['status'],'txid':_0x13f47c[_0x4adaf7(0x210)],'notes':_0x13f47c['notes'],'createdAt':_0x13f47c[_0x4adaf7(0x26d)],'paidAt':_0x13f47c['paidAt']};}async[a54_0x49f268(0x204)](_0x3ae9cc,_0x42a937){const _0x3fc5d9=a54_0x49f268,_0x413a6e=new Date();let _0x44f3c8;switch(_0x42a937){case'7d':_0x44f3c8=new Date(_0x413a6e[_0x3fc5d9(0x22f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3fc5d9(0x274):_0x44f3c8=new Date(_0x413a6e[_0x3fc5d9(0x22f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3fc5d9(0x1fe):_0x44f3c8=new Date(_0x413a6e[_0x3fc5d9(0x22f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x44f3c8=new Date(_0x413a6e[_0x3fc5d9(0x22f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x531b60,_0x288ee0,_0x461606,_0x1c3a74,_0x25d853,_0x4f5067]=await Promise[_0x3fc5d9(0x25d)]([database_1[_0x3fc5d9(0x1f6)][_0x3fc5d9(0x245)][_0x3fc5d9(0x277)]({'where':{'shopId':_0x3ae9cc,'createdAt':{'gte':_0x44f3c8}}}),database_1[_0x3fc5d9(0x1f6)][_0x3fc5d9(0x245)][_0x3fc5d9(0x277)]({'where':{'shopId':_0x3ae9cc,'status':_0x3fc5d9(0x27e),'createdAt':{'gte':_0x44f3c8}}}),database_1['default'][_0x3fc5d9(0x245)]['count']({'where':{'shopId':_0x3ae9cc,'status':_0x3fc5d9(0x229),'createdAt':{'gte':_0x44f3c8}}}),database_1[_0x3fc5d9(0x1f6)][_0x3fc5d9(0x245)][_0x3fc5d9(0x277)]({'where':{'shopId':_0x3ae9cc,'status':_0x3fc5d9(0x226),'createdAt':{'gte':_0x44f3c8}}}),database_1['default'][_0x3fc5d9(0x245)][_0x3fc5d9(0x26e)]({'where':{'shopId':_0x3ae9cc,'createdAt':{'gte':_0x44f3c8}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x3fc5d9(0x1f6)]['payout']['findMany']({'where':{'shopId':_0x3ae9cc},'take':0xa,'orderBy':{'createdAt':_0x3fc5d9(0x269)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x5addd2=_0x25d853[_0x3fc5d9(0x246)]((_0x5e8e8e,_0x548ffe)=>_0x5e8e8e+_0x548ffe[_0x3fc5d9(0x205)],0x0),_0x1d90de=_0x25d853['filter'](_0x9f0fb7=>_0x9f0fb7[_0x3fc5d9(0x263)]===_0x3fc5d9(0x27e))[_0x3fc5d9(0x246)]((_0x4c5876,_0x282d80)=>_0x4c5876+_0x282d80[_0x3fc5d9(0x205)],0x0),_0x451f16=_0x25d853[_0x3fc5d9(0x202)](_0x3ab44f=>_0x3ab44f['status']==='PENDING')['reduce']((_0x2a5c66,_0xf4206f)=>_0x2a5c66+_0xf4206f[_0x3fc5d9(0x205)],0x0),_0x45405e=_0x25d853[_0x3fc5d9(0x246)]((_0x467985,_0x203de0)=>{const _0x56f729=_0x3fc5d9;return _0x467985[_0x203de0[_0x56f729(0x271)]]=(_0x467985[_0x203de0[_0x56f729(0x271)]]||0x0)+0x1,_0x467985;},{}),_0x5d3ae2=_0x25d853[_0x3fc5d9(0x246)]((_0x41a4c0,_0x5dfc39)=>{const _0x4a5f25=_0x3fc5d9;return _0x41a4c0[_0x5dfc39['status']]=(_0x41a4c0[_0x5dfc39[_0x4a5f25(0x263)]]||0x0)+0x1,_0x41a4c0;},{});return{'totalPayouts':_0x531b60,'completedPayouts':_0x288ee0,'pendingPayouts':_0x461606,'rejectedPayouts':_0x1c3a74,'totalAmount':_0x5addd2,'completedAmount':_0x1d90de,'pendingAmount':_0x451f16,'payoutsByMethod':_0x45405e,'payoutsByStatus':_0x5d3ae2,'recentPayouts':_0x4f5067[_0x3fc5d9(0x1df)](_0x5c4e49=>({'id':_0x5c4e49['id'],'shopId':_0x3ae9cc,'amount':_0x5c4e49['amount'],'method':_0x5c4e49[_0x3fc5d9(0x271)],'status':_0x5c4e49[_0x3fc5d9(0x263)],'txid':_0x5c4e49[_0x3fc5d9(0x210)],'createdAt':_0x5c4e49['createdAt'],'paidAt':_0x5c4e49[_0x3fc5d9(0x1fa)]}))};}async[a54_0x49f268(0x23c)](_0x1c9fc1){const _0x30723a=a54_0x49f268;console[_0x30723a(0x1f8)](_0x30723a(0x24e)+_0x1c9fc1+_0x30723a(0x20a));const _0x36291d=await database_1[_0x30723a(0x1f6)][_0x30723a(0x273)]['findUnique']({'where':{'id':_0x1c9fc1},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x36291d)throw new Error(_0x30723a(0x258));const _0xc7d673=new Date(),_0x42fc20=new Date(_0xc7d673[_0x30723a(0x239)](),_0xc7d673[_0x30723a(0x22b)](),0x1),_0x5695df=new Date(_0xc7d673[_0x30723a(0x239)](),_0xc7d673[_0x30723a(0x22b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x45335f=await database_1[_0x30723a(0x1f6)][_0x30723a(0x245)][_0x30723a(0x224)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1c9fc1,'createdAt':{'gte':_0x42fc20,'lte':_0x5695df},'status':'COMPLETED'}}),_0x3f1aad=_0x45335f[_0x30723a(0x249)][_0x30723a(0x205)]||0x0,_0xff875a={'availableBalance':Math[_0x30723a(0x1d6)](_0x36291d[_0x30723a(0x21a)]*0x64)/0x64,'totalPaidOut':Math[_0x30723a(0x1d6)](_0x36291d[_0x30723a(0x25b)]*0x64)/0x64,'awaitingPayout':Math[_0x30723a(0x1d6)](_0x36291d['balance']*0x64)/0x64,'thisMonth':Math[_0x30723a(0x1d6)](_0x3f1aad*0x64)/0x64};return console[_0x30723a(0x1f8)](_0x30723a(0x203)+_0x36291d[_0x30723a(0x21e)]+_0x30723a(0x280)),console[_0x30723a(0x1f8)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0xff875a[_0x30723a(0x257)]+_0x30723a(0x24b)),console[_0x30723a(0x1f8)]('\x20\x20\x20💰\x20Total\x20paid\x20out:\x20'+_0xff875a['totalPaidOut']+_0x30723a(0x266)),console[_0x30723a(0x1f8)](_0x30723a(0x275)+_0xff875a['awaitingPayout']+_0x30723a(0x24b)),console[_0x30723a(0x1f8)](_0x30723a(0x250)+_0xff875a[_0x30723a(0x23d)]+_0x30723a(0x1dc)),_0xff875a;}[a54_0x49f268(0x25e)](_0xd8d0d9){const _0x220e30=a54_0x49f268,_0x5505ad={'test_gateway':_0x220e30(0x20f),'plisio':_0x220e30(0x231),'rapyd':_0x220e30(0x209),'noda':'Noda','cointopay':_0x220e30(0x1f1),'klyme_eu':_0x220e30(0x1e7),'klyme_gb':_0x220e30(0x1dd),'klyme_de':'KLYME\x20DE'};return _0x5505ad[_0xd8d0d9]||_0xd8d0d9;}async[a54_0x49f268(0x232)](_0xacc1dd){return this['getShopPayoutStats'](_0xacc1dd);}async[a54_0x49f268(0x278)](_0xfb9d47,_0x3b4dcd){const _0x2bb4e9=a54_0x49f268,{page:_0x5e0d18,limit:_0x2100cc,paymentId:_0xfdc0cc}=_0x3b4dcd,_0x181d49=(_0x5e0d18-0x1)*_0x2100cc,_0x220ea1={'shopId':_0xfb9d47};_0xfdc0cc&&(_0x220ea1['paymentId']=_0xfdc0cc);const [_0x1bed84,_0x5751f1]=await Promise[_0x2bb4e9(0x25d)]([database_1[_0x2bb4e9(0x1f6)][_0x2bb4e9(0x255)][_0x2bb4e9(0x26e)]({'where':_0x220ea1,'skip':_0x181d49,'take':_0x2100cc,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2bb4e9(0x1f6)][_0x2bb4e9(0x255)][_0x2bb4e9(0x277)]({'where':_0x220ea1})]);return{'logs':_0x1bed84[_0x2bb4e9(0x1df)](_0x2c257b=>({'id':_0x2c257b['id'],'paymentId':_0x2c257b[_0x2bb4e9(0x1e8)],'shopId':_0x2c257b[_0x2bb4e9(0x218)],'event':_0x2c257b['event'],'statusCode':_0x2c257b[_0x2bb4e9(0x201)],'retryCount':_0x2c257b[_0x2bb4e9(0x219)],'responseBody':_0x2c257b['responseBody'],'createdAt':_0x2c257b[_0x2bb4e9(0x26d)],'payment':_0x2c257b[_0x2bb4e9(0x20b)]})),'pagination':{'page':_0x5e0d18,'limit':_0x2100cc,'total':_0x5751f1,'totalPages':Math[_0x2bb4e9(0x227)](_0x5751f1/_0x2100cc)}};}async[a54_0x49f268(0x207)](_0x2611d2,_0x31788b){const _0x322c64=a54_0x49f268,_0x5a85e6=new Date();let _0x24d7bb;switch(_0x31788b){case'7d':_0x24d7bb=new Date(_0x5a85e6[_0x322c64(0x22f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x322c64(0x274):_0x24d7bb=new Date(_0x5a85e6[_0x322c64(0x22f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x322c64(0x1fe):_0x24d7bb=new Date(_0x5a85e6[_0x322c64(0x22f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x24d7bb=new Date(_0x5a85e6['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4f146e,_0xe136a8,_0x14c30c,_0x3ecfcc,_0x425790]=await Promise[_0x322c64(0x25d)]([database_1[_0x322c64(0x1f6)][_0x322c64(0x20b)][_0x322c64(0x277)]({'where':{'shopId':_0x2611d2,'gateway':{'not':_0x322c64(0x1f7)},'createdAt':{'gte':_0x24d7bb}}}),database_1[_0x322c64(0x1f6)][_0x322c64(0x20b)][_0x322c64(0x277)]({'where':{'shopId':_0x2611d2,'gateway':{'not':_0x322c64(0x1f7)},'status':_0x322c64(0x1e2),'createdAt':{'gte':_0x24d7bb}}}),database_1[_0x322c64(0x1f6)]['payment'][_0x322c64(0x26e)]({'where':{'shopId':_0x2611d2,'gateway':{'not':_0x322c64(0x1f7)},'status':_0x322c64(0x1e2),'createdAt':{'gte':_0x24d7bb}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x322c64(0x1f6)]['payment'][_0x322c64(0x26e)]({'where':{'shopId':_0x2611d2,'gateway':{'not':_0x322c64(0x1f7)}},'take':0xa,'orderBy':{'createdAt':_0x322c64(0x269)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x322c64(0x20b)][_0x322c64(0x26e)]({'where':{'shopId':_0x2611d2,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x24d7bb}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x322c64(0x24a)}})]);let _0x12a2ec=0x0;for(const _0x3f4e89 of _0x14c30c){if(_0x3f4e89['amountUSDT'])_0x12a2ec+=_0x3f4e89['amountUSDT'];else{const _0x1354fe=await currencyService_1['currencyService'][_0x322c64(0x23a)](_0x3f4e89[_0x322c64(0x205)],_0x3f4e89[_0x322c64(0x265)]);_0x12a2ec+=_0x1354fe;}}const _0x192578=this[_0x322c64(0x1da)](_0x425790,_0x24d7bb,_0x5a85e6),_0x3bab66=_0x4f146e>0x0?_0xe136a8/_0x4f146e*0x64:0x0;return{'totalPayments':_0x4f146e,'successfulPayments':_0xe136a8,'totalRevenue':Math[_0x322c64(0x1d6)](_0x12a2ec*0x64)/0x64,'conversionRate':Math[_0x322c64(0x1d6)](_0x3bab66*0x64)/0x64,'dailyRevenue':_0x192578['dailyRevenue'],'dailyPayments':_0x192578['dailyPayments'],'recentPayments':_0x3ecfcc[_0x322c64(0x1df)](_0x19db01=>({'id':_0x19db01['id'],'gateway':_0x19db01[_0x322c64(0x25f)],'amount':_0x19db01[_0x322c64(0x205)],'currency':_0x19db01[_0x322c64(0x265)],'status':_0x19db01[_0x322c64(0x263)],'createdAt':_0x19db01['createdAt']}))};}[a54_0x49f268(0x1da)](_0x2376fe,_0x945629,_0x2271dc){const _0x15e0f4=a54_0x49f268,_0xb3a59c=new Map(),_0x187448=new Date(_0x945629);while(_0x187448<=_0x2271dc){const _0x47fd57=_0x187448['toISOString']()[_0x15e0f4(0x217)]('T')[0x0];_0xb3a59c[_0x15e0f4(0x21c)](_0x47fd57,{'revenue':0x0,'count':0x0}),_0x187448[_0x15e0f4(0x212)](_0x187448[_0x15e0f4(0x230)]()+0x1);}for(const _0xa3c847 of _0x2376fe){const _0x1cdcdc=_0xa3c847[_0x15e0f4(0x26d)][_0x15e0f4(0x254)]()[_0x15e0f4(0x217)]('T')[0x0],_0x230f6a=_0xb3a59c['get'](_0x1cdcdc);_0x230f6a&&(_0x230f6a['count']+=0x1,_0xa3c847['status']===_0x15e0f4(0x1e2)&&_0xa3c847[_0x15e0f4(0x1d8)]&&(_0x230f6a['revenue']+=_0xa3c847[_0x15e0f4(0x1d8)]));}const _0x172b1b=[],_0x4f98a6=[];for(const [_0x4b3825,_0x2dcfb7]of _0xb3a59c){_0x172b1b[_0x15e0f4(0x225)]({'date':_0x4b3825,'amount':Math[_0x15e0f4(0x1d6)](_0x2dcfb7[_0x15e0f4(0x1f4)]*0x64)/0x64}),_0x4f98a6[_0x15e0f4(0x225)]({'date':_0x4b3825,'count':_0x2dcfb7[_0x15e0f4(0x277)]});}return{'dailyRevenue':_0x172b1b,'dailyPayments':_0x4f98a6};}}function a54_0x128a(){const _0x1853df=['📊\x20Shop\x20','getPayoutStatistics','amount','usdtErcWallet','getStatistics','settings','Rapyd','...','payment','merchantUrl','createPublicPayment','117690VMEzZx','Test\x20Gateway','txid','gte','setDate','fullName','getPaymentsByShop','message','name','split','shopId','retryCount','balance','language','set','USDT\x20TRC20','username','ShopService','webhookEvents','expiresAt','error','No\x20webhook\x20URL\x20configured','aggregate','push','REJECTED','ceil','updateShopProfile','PENDING','parse','getMonth','application/json','getPayoutById','1074088CRhVaO','getTime','getDate','Plisio','getPayoutStats','lte','Failed\x20to\x20send\x20webhook:\x20','Error\x20parsing\x20webhook\x20events:','210128urWTkP','customer','./currencyService','getFullYear','convertToUSDT','wallets','getShopPayoutStats','thisMonth','update','telegramId','webhookUrl','920088aFtxQX','formatNetworkName','getPayments','./paymentService','payout','reduce','trc20','Unknown\x20error','_sum','asc','\x20USDT\x20(current\x20balance)','getPayouts','defineProperty','📊\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','__importDefault','\x20\x20\x20📅\x20This\x20month:\x20','150830IdguQX','redirectUrl','statusText','toISOString','webhookLog','Test\x20webhook\x20sent\x20successfully\x20(','availableBalance','Shop\x20not\x20found','deletePayment','📊\x20Status\x20filter:\x20','totalPaidOut','test_order_123','all','getGatewayDisplayName','gateway','shopUrl','gatewaySettings','findFirst','status','publicKey','currency','\x20USDT\x20(total\x20payouts)','📅\x20Date\x20start:\x20','usdtTrcWallet','desc','erc20','paymentService','customerName','createdAt','findMany','2916781pJjzMJ','createPayment','network','3vKiHfS','shop','30d','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','testWebhook','count','getWebhookLogs','customerEmail','5BoSSDQ','usdcPolygonWallet','sourceCurrency','polygon','COMPLETED','stringify','\x20payout\x20statistics\x20calculated:','468twYPrk','🌐\x20Method\x20filter:\x20','test_payment_123','round','isArray','amountUSDT','gateways','generateDailyStatistics','📅\x20Date\x20end:\x20','\x20USDT','KLYME\x20GB','usdtPolygonWallet','map','getShopProfile','findUnique','PAID','paymentGateways','country','toUpperCase','USDT\x20BSC','KLYME\x20EU','paymentId','1356600JYqHyV','test','delete','📅\x20Period\x20start:\x20','periodTo','POST','../config/database','getPaymentById','CoinToPay','periodFrom','telegram','revenue','PaymentService','default','test_gateway','log','paid','paidAt','amountIsEditable','🌐\x20Network\x20filter:\x20','setHours','90d','💰\x20Getting\x20payouts\x20with\x20filters:','polygon_usdc','statusCode','filter'];a54_0x128a=function(){return _0x1853df;};return a54_0x128a();}exports[a54_0x49f268(0x21f)]=ShopService;