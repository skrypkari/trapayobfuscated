'use strict';const a56_0x3c75ff=a56_0x238e;(function(_0x18ebcb,_0x16d5e8){const _0x2e3297=a56_0x238e,_0x52fac2=_0x18ebcb();while(!![]){try{const _0x33217c=parseInt(_0x2e3297(0x120))/0x1+-parseInt(_0x2e3297(0xe6))/0x2+parseInt(_0x2e3297(0xc4))/0x3+-parseInt(_0x2e3297(0xb9))/0x4+-parseInt(_0x2e3297(0xa8))/0x5*(-parseInt(_0x2e3297(0x109))/0x6)+parseInt(_0x2e3297(0x12f))/0x7+-parseInt(_0x2e3297(0x110))/0x8;if(_0x33217c===_0x16d5e8)break;else _0x52fac2['push'](_0x52fac2['shift']());}catch(_0xffb632){_0x52fac2['push'](_0x52fac2['shift']());}}}(a56_0x17e3,0xc80b3));function a56_0x238e(_0x48fd55,_0x4bfd09){const _0x17e348=a56_0x17e3();return a56_0x238e=function(_0x238e6e,_0x490b39){_0x238e6e=_0x238e6e-0x80;let _0x56eca5=_0x17e348[_0x238e6e];return _0x56eca5;},a56_0x238e(_0x48fd55,_0x4bfd09);}function a56_0x17e3(){const _0xfdb733=['balance','1555505Cyalrm','No\x20webhook\x20URL\x20configured','network','wallets','getFullYear','gateway','\x20\x20\x20üìÖ\x20This\x20month:\x20','webhookEvents','dailyPayments','currency','count','periodFrom','update','isArray','Error\x20parsing\x20webhook\x20events:','amountUSDT','usage','parse','Failed\x20to\x20send\x20webhook:\x20','usdtPolygonWallet','KLYME\x20DE','getDate','telegram','findMany','toISOString','log','statusCode','setHours','sourceCurrency','ceil','paymentGateways','shopId','shopUrl','POST','Test\x20Gateway','txid','defineProperty','üìÖ\x20Date\x20start:\x20','createdAt','üåê\x20Method\x20filter:\x20','PAID','üìä\x20Status\x20filter:\x20','USDT\x20ERC20','username','4524745mrnwOd','convertToUSDT','generateDailyStatistics','application/json','gateways','all','push','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','üìÖ\x20Period\x20end:\x20','customerEmail','language','createPayment','updatePayment','filter','country','event','üìä\x20Shop\x20','3964996HReJdQ','_sum','./currencyService','usdtTrcWallet','paidAt','PaymentService','30d','trc20','payment','getPayouts','USD','3337662WIZxlt','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','erc20','getWebhookLogs','getPaymentByShopAndId','getPayoutStats','telegramId','updateShopProfile','revenue','expiresAt','payout','polygon_usdc','shop','test_gateway','usdtErcWallet','gte','error','asc','desc','USDT\x20BSC','Unknown\x20error','retryCount','\x20USDT\x20(current\x20balance)','amountIsEditable','Webhook\x20returned\x20error:\x20','Rapyd','dailyRevenue','./paymentService','default','webhookLog','USDC\x20Polygon','delete','paymentService','lte','1687712pKDbaY','aggregate','getTime','üìÖ\x20Date\x20end:\x20','getPaymentById','merchantUrl','totalPaidOut','map','__importDefault','findFirst','Payment\x20not\x20found','REJECTED','split','webhookUrl','paid','\x20USDT\x20(total\x20payouts)','customer','USDT\x20Polygon','TesSoft\x20Payment\x20System/1.0\x20(Test)','settings','fullName','Noda','statusText','notes','Test\x20webhook\x20sent\x20successfully\x20(','findUnique','ShopService','testWebhook','test','USDT\x20TRC20','getMonth','getShopPayoutStats','round','Plisio','90d','6NRdqta','test_payment_123','gatewaySettings','name','awaitingPayout','formatNetworkName','üåê\x20Network\x20filter:\x20','1248416IDYwsE','createPublicPayment','setDate','maxPayments','customerName','reduce','test_order_123','usdcPolygonWallet','__esModule','KLYME\x20GB','message','amount','KLYME\x20EU','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','getPayoutById','paymentId','570818AAJnWk','toUpperCase','üí∞\x20Getting\x20payouts\x20with\x20filters:','periodTo','publicKey','responseBody','set','availableBalance','deletePayment','status','redirectUrl','getPayoutStatistics','stringify','polygon'];a56_0x17e3=function(){return _0xfdb733;};return a56_0x17e3();}var __importDefault=this&&this[a56_0x3c75ff(0xee)]||function(_0x4f4856){const _0x47c9f3=a56_0x3c75ff;return _0x4f4856&&_0x4f4856[_0x47c9f3(0x118)]?_0x4f4856:{'default':_0x4f4856};};Object[a56_0x3c75ff(0xa0)](exports,'__esModule',{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a56_0x3c75ff(0xbb)),paymentService_1=require(a56_0x3c75ff(0xdf));class ShopService{constructor(){const _0x35fe6a=a56_0x3c75ff;this[_0x35fe6a(0xe4)]=new paymentService_1[(_0x35fe6a(0xbe))]();}async['getShopProfile'](_0x1bfd2f){const _0x4f5096=a56_0x3c75ff,_0x597f11=await database_1['default']['shop'][_0x4f5096(0xff)]({'where':{'id':_0x1bfd2f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x597f11)throw new Error('Shop\x20not\x20found');let _0x5962f9=[];if(_0x597f11['settings']?.[_0x4f5096(0x83)])try{_0x5962f9=Array[_0x4f5096(0x89)](_0x597f11[_0x4f5096(0xf9)][_0x4f5096(0x83)])?_0x597f11[_0x4f5096(0xf9)][_0x4f5096(0x83)]:JSON[_0x4f5096(0x8d)](_0x597f11['settings'][_0x4f5096(0x83)]);}catch(_0x1f2d71){console[_0x4f5096(0xd4)](_0x4f5096(0x8a),_0x1f2d71),_0x5962f9=[];}return{'id':_0x597f11['id'],'fullName':_0x597f11[_0x4f5096(0x10c)],'username':_0x597f11['username'],'telegramId':_0x597f11[_0x4f5096(0x92)],'merchantUrl':_0x597f11[_0x4f5096(0x9c)],'gateways':_0x597f11[_0x4f5096(0x9a)]?JSON[_0x4f5096(0x8d)](_0x597f11['paymentGateways']):null,'gatewaySettings':_0x597f11['gatewaySettings']?JSON[_0x4f5096(0x8d)](_0x597f11[_0x4f5096(0x10b)]):null,'publicKey':_0x597f11[_0x4f5096(0x124)],'webhookUrl':_0x597f11[_0x4f5096(0xf9)]?.[_0x4f5096(0xf3)]||null,'webhookEvents':_0x5962f9,'wallets':{'usdtPolygonWallet':_0x597f11[_0x4f5096(0x8f)],'usdtTrcWallet':_0x597f11['usdtTrcWallet'],'usdtErcWallet':_0x597f11[_0x4f5096(0xd2)],'usdcPolygonWallet':_0x597f11[_0x4f5096(0x117)]},'status':_0x597f11[_0x4f5096(0x129)],'createdAt':_0x597f11['createdAt']};}async[a56_0x3c75ff(0xcb)](_0x4d294f,_0x2cc37c){const _0x223d8e=a56_0x3c75ff,_0x5d8031={};_0x2cc37c[_0x223d8e(0xfa)]&&(_0x5d8031['name']=_0x2cc37c[_0x223d8e(0xfa)]);_0x2cc37c[_0x223d8e(0xca)]!==undefined&&(_0x5d8031['telegram']=_0x2cc37c['telegramId']||null);_0x2cc37c[_0x223d8e(0xeb)]&&(_0x5d8031[_0x223d8e(0x9c)]=_0x2cc37c[_0x223d8e(0xeb)]);_0x2cc37c[_0x223d8e(0xac)]&&(_0x5d8031[_0x223d8e(0x9a)]=JSON[_0x223d8e(0x12c)](_0x2cc37c['gateways']));_0x2cc37c[_0x223d8e(0x10b)]&&(_0x5d8031[_0x223d8e(0x10b)]=JSON[_0x223d8e(0x12c)](_0x2cc37c['gatewaySettings']));_0x2cc37c[_0x223d8e(0x132)]&&(_0x2cc37c[_0x223d8e(0x132)][_0x223d8e(0x8f)]!==undefined&&(_0x5d8031[_0x223d8e(0x8f)]=_0x2cc37c[_0x223d8e(0x132)][_0x223d8e(0x8f)]||null),_0x2cc37c[_0x223d8e(0x132)][_0x223d8e(0xbc)]!==undefined&&(_0x5d8031[_0x223d8e(0xbc)]=_0x2cc37c[_0x223d8e(0x132)][_0x223d8e(0xbc)]||null),_0x2cc37c[_0x223d8e(0x132)][_0x223d8e(0xd2)]!==undefined&&(_0x5d8031[_0x223d8e(0xd2)]=_0x2cc37c['wallets'][_0x223d8e(0xd2)]||null),_0x2cc37c[_0x223d8e(0x132)][_0x223d8e(0x117)]!==undefined&&(_0x5d8031[_0x223d8e(0x117)]=_0x2cc37c['wallets']['usdcPolygonWallet']||null));const _0x1c10e8=await database_1[_0x223d8e(0xe0)][_0x223d8e(0xd0)]['update']({'where':{'id':_0x4d294f},'data':_0x5d8031,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x132e44=[];if(_0x1c10e8[_0x223d8e(0xf9)]?.[_0x223d8e(0x83)])try{_0x132e44=Array[_0x223d8e(0x89)](_0x1c10e8[_0x223d8e(0xf9)][_0x223d8e(0x83)])?_0x1c10e8['settings']['webhookEvents']:JSON['parse'](_0x1c10e8['settings'][_0x223d8e(0x83)]);}catch(_0x227305){console['error'](_0x223d8e(0x8a),_0x227305),_0x132e44=[];}return{'id':_0x1c10e8['id'],'fullName':_0x1c10e8[_0x223d8e(0x10c)],'username':_0x1c10e8[_0x223d8e(0xa7)],'telegramId':_0x1c10e8[_0x223d8e(0x92)],'merchantUrl':_0x1c10e8['shopUrl'],'gateways':_0x1c10e8['paymentGateways']?JSON[_0x223d8e(0x8d)](_0x1c10e8[_0x223d8e(0x9a)]):null,'gatewaySettings':_0x1c10e8[_0x223d8e(0x10b)]?JSON[_0x223d8e(0x8d)](_0x1c10e8[_0x223d8e(0x10b)]):null,'publicKey':_0x1c10e8[_0x223d8e(0x124)],'webhookUrl':_0x1c10e8[_0x223d8e(0xf9)]?.[_0x223d8e(0xf3)]||null,'webhookEvents':_0x132e44,'wallets':{'usdtPolygonWallet':_0x1c10e8[_0x223d8e(0x8f)],'usdtTrcWallet':_0x1c10e8['usdtTrcWallet'],'usdtErcWallet':_0x1c10e8[_0x223d8e(0xd2)],'usdcPolygonWallet':_0x1c10e8[_0x223d8e(0x117)]},'status':_0x1c10e8[_0x223d8e(0x129)],'createdAt':_0x1c10e8['createdAt']};}async['updateWallets'](_0x5b6baa,_0x4a3860){const _0x847781=a56_0x3c75ff,_0x58b762={};_0x4a3860[_0x847781(0x8f)]!==undefined&&(_0x58b762[_0x847781(0x8f)]=_0x4a3860['usdtPolygonWallet']||null),_0x4a3860[_0x847781(0xbc)]!==undefined&&(_0x58b762[_0x847781(0xbc)]=_0x4a3860['usdtTrcWallet']||null),_0x4a3860[_0x847781(0xd2)]!==undefined&&(_0x58b762['usdtErcWallet']=_0x4a3860[_0x847781(0xd2)]||null),_0x4a3860[_0x847781(0x117)]!==undefined&&(_0x58b762[_0x847781(0x117)]=_0x4a3860[_0x847781(0x117)]||null),await database_1[_0x847781(0xe0)]['shop'][_0x847781(0x88)]({'where':{'id':_0x5b6baa},'data':_0x58b762});}async[a56_0x3c75ff(0x101)](_0x32f0d9){const _0x3150f9=a56_0x3c75ff,_0x59fa04=await database_1[_0x3150f9(0xe0)][_0x3150f9(0xd0)]['findUnique']({'where':{'id':_0x32f0d9},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x59fa04?.[_0x3150f9(0xf9)]?.[_0x3150f9(0xf3)])throw new Error(_0x3150f9(0x130));const _0x2d0b2f={'event':'test','payment':{'id':_0x3150f9(0x10a),'order_id':_0x3150f9(0x116),'gateway':_0x3150f9(0x102),'amount':0x64,'currency':_0x3150f9(0xc3),'status':_0x3150f9(0xf4),'created_at':new Date()[_0x3150f9(0x94)]()}};try{const _0x4542bd=await fetch(_0x59fa04[_0x3150f9(0xf9)]['webhookUrl'],{'method':_0x3150f9(0x9d),'headers':{'Content-Type':_0x3150f9(0xab),'User-Agent':_0x3150f9(0xf8)},'body':JSON[_0x3150f9(0x12c)](_0x2d0b2f)});return _0x4542bd['ok']?{'success':!![],'message':_0x3150f9(0xfe)+_0x4542bd[_0x3150f9(0x129)]+')'}:{'success':![],'message':_0x3150f9(0xdc)+_0x4542bd['status']+'\x20'+_0x4542bd[_0x3150f9(0xfc)]};}catch(_0x12e348){return{'success':![],'message':_0x3150f9(0x8e)+(_0x12e348 instanceof Error?_0x12e348[_0x3150f9(0x11a)]:_0x3150f9(0xd8))};}}async[a56_0x3c75ff(0xb3)](_0x20de65){const _0x1316b0=a56_0x3c75ff;return this[_0x1316b0(0xe4)][_0x1316b0(0x111)]({'public_key':'','gateway':_0x20de65['gateway'],'order_id':undefined,'amount':_0x20de65[_0x1316b0(0x11b)],'currency':_0x20de65[_0x1316b0(0x85)],'source_currency':_0x20de65[_0x1316b0(0x98)],'usage':_0x20de65[_0x1316b0(0x8c)],'expires_at':_0x20de65[_0x1316b0(0xcd)]?.[_0x1316b0(0x94)](),'success_url':_0x20de65[_0x1316b0(0x12a)],'fail_url':_0x20de65[_0x1316b0(0x12a)],'customer_email':_0x20de65[_0x1316b0(0xb1)],'customer_name':_0x20de65[_0x1316b0(0x114)],'country':_0x20de65[_0x1316b0(0xb6)],'language':_0x20de65[_0x1316b0(0xb2)],'amount_is_editable':_0x20de65[_0x1316b0(0xdb)],'max_payments':_0x20de65[_0x1316b0(0x113)],'customer':_0x20de65[_0x1316b0(0xf6)]});}async['getPayments'](_0xae8ab3,_0x2c5e0b){const _0x3bd10e=a56_0x3c75ff;return this[_0x3bd10e(0xe4)]['getPaymentsByShop'](_0xae8ab3,_0x2c5e0b);}async[a56_0x3c75ff(0xea)](_0x13bbbf,_0x316443){const _0x447446=a56_0x3c75ff;return this['paymentService'][_0x447446(0xc8)](_0x13bbbf,_0x316443);}async[a56_0x3c75ff(0xb4)](_0x4e3a99,_0x579712,_0x5d7814){const _0x109a55=a56_0x3c75ff,_0x2f1bfc=await database_1[_0x109a55(0xe0)][_0x109a55(0xc1)][_0x109a55(0xef)]({'where':{'id':_0x579712,'shopId':_0x4e3a99}});if(!_0x2f1bfc)throw new Error(_0x109a55(0xf0));const _0x3c5d53=await database_1['default']['payment'][_0x109a55(0x88)]({'where':{'id':_0x579712},'data':{..._0x5d7814,'updatedAt':new Date()}});return _0x3c5d53;}async[a56_0x3c75ff(0x128)](_0x12ce76,_0x19517a){const _0x3d99bc=a56_0x3c75ff,_0x10b137=await database_1[_0x3d99bc(0xe0)]['payment']['findFirst']({'where':{'id':_0x19517a,'shopId':_0x12ce76}});if(!_0x10b137)throw new Error('Payment\x20not\x20found');await database_1[_0x3d99bc(0xe0)][_0x3d99bc(0xc1)][_0x3d99bc(0xe3)]({'where':{'id':_0x19517a}});}['formatNetworkName'](_0x61724e){const _0x32f06b=a56_0x3c75ff,_0x4bfea4={'polygon':_0x32f06b(0xf7),'trc20':_0x32f06b(0x103),'erc20':_0x32f06b(0xa6),'bsc':_0x32f06b(0xd7),'polygon_usdc':_0x32f06b(0xe2)};return _0x4bfea4[_0x61724e]||_0x61724e;}async[a56_0x3c75ff(0xc2)](_0x22e921,_0x18e3a5){const _0x221e0d=a56_0x3c75ff,{page:_0x276146,limit:_0x120065,status:_0x455f3c,method:_0x53730c,network:_0x468282,dateFrom:_0x5a3b61,dateTo:_0x3b5619,periodFrom:_0x5ad777,periodTo:_0x46ee25}=_0x18e3a5,_0x34edd8=(_0x276146-0x1)*_0x120065;console[_0x221e0d(0x95)](_0x221e0d(0x122),_0x18e3a5);const _0x4bffe4={'shopId':_0x22e921};_0x455f3c&&(_0x4bffe4[_0x221e0d(0x129)]=_0x455f3c['toUpperCase'](),console['log'](_0x221e0d(0xa5)+_0x455f3c[_0x221e0d(0x121)]()));if(_0x53730c)_0x4bffe4[_0x221e0d(0x131)]=_0x53730c,console[_0x221e0d(0x95)](_0x221e0d(0xa3)+_0x53730c);else _0x468282&&(_0x4bffe4[_0x221e0d(0x131)]=_0x468282,console[_0x221e0d(0x95)](_0x221e0d(0x10f)+_0x468282));if(_0x5a3b61||_0x3b5619||_0x5ad777||_0x46ee25){_0x4bffe4[_0x221e0d(0xa2)]={};if(_0x5ad777){const _0x64dfba=new Date(_0x5ad777);_0x64dfba['setHours'](0x0,0x0,0x0,0x0),_0x4bffe4[_0x221e0d(0xa2)][_0x221e0d(0xd3)]=_0x64dfba,console[_0x221e0d(0x95)]('üìÖ\x20Period\x20start:\x20'+_0x64dfba[_0x221e0d(0x94)]());}else{if(_0x5a3b61){const _0x340b46=new Date(_0x5a3b61);_0x340b46[_0x221e0d(0x97)](0x0,0x0,0x0,0x0),_0x4bffe4['createdAt'][_0x221e0d(0xd3)]=_0x340b46,console[_0x221e0d(0x95)](_0x221e0d(0xa1)+_0x340b46[_0x221e0d(0x94)]());}}if(_0x46ee25){const _0x7e7fdc=new Date(_0x46ee25);_0x7e7fdc[_0x221e0d(0x97)](0x17,0x3b,0x3b,0x3e7),_0x4bffe4[_0x221e0d(0xa2)]['lte']=_0x7e7fdc,console[_0x221e0d(0x95)](_0x221e0d(0xb0)+_0x7e7fdc['toISOString']());}else{if(_0x3b5619){const _0x564a4d=new Date(_0x3b5619);_0x564a4d[_0x221e0d(0x97)](0x17,0x3b,0x3b,0x3e7),_0x4bffe4[_0x221e0d(0xa2)][_0x221e0d(0xe5)]=_0x564a4d,console[_0x221e0d(0x95)](_0x221e0d(0xe9)+_0x564a4d['toISOString']());}}}console['log']('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x221e0d(0x12c)](_0x4bffe4,null,0x2));const [_0x4778ef,_0xfe780]=await Promise[_0x221e0d(0xad)]([database_1[_0x221e0d(0xe0)]['payout'][_0x221e0d(0x93)]({'where':_0x4bffe4,'skip':_0x34edd8,'take':_0x120065,'orderBy':{'createdAt':_0x221e0d(0xd6)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x221e0d(0xce)]['count']({'where':_0x4bffe4})]);return{'payouts':_0x4778ef['map'](_0x188880=>{const _0x196ce6=_0x221e0d;let _0xfe744e=null;switch(_0x188880[_0x196ce6(0x131)]){case _0x196ce6(0x12d):_0xfe744e=_0x188880[_0x196ce6(0xd0)][_0x196ce6(0x8f)];break;case _0x196ce6(0xc0):_0xfe744e=_0x188880[_0x196ce6(0xd0)][_0x196ce6(0xbc)];break;case _0x196ce6(0xc6):_0xfe744e=_0x188880['shop']['usdtErcWallet'];break;case _0x196ce6(0xcf):_0xfe744e=_0x188880[_0x196ce6(0xd0)][_0x196ce6(0x117)];break;}return{'id':_0x188880['id'],'amount':_0x188880[_0x196ce6(0x11b)],'network':this[_0x196ce6(0x10e)](_0x188880[_0x196ce6(0x131)]),'wallet':_0xfe744e,'status':_0x188880[_0x196ce6(0x129)],'txid':_0x188880[_0x196ce6(0x9f)],'notes':_0x188880[_0x196ce6(0xfd)],'periodFrom':_0x188880[_0x196ce6(0x87)],'periodTo':_0x188880[_0x196ce6(0x123)],'createdAt':_0x188880['createdAt'],'paidAt':_0x188880['paidAt']};}),'pagination':{'page':_0x276146,'limit':_0x120065,'total':_0xfe780,'totalPages':Math[_0x221e0d(0x99)](_0xfe780/_0x120065)}};}async[a56_0x3c75ff(0x11e)](_0x42dcca,_0x312a34){const _0x15f897=a56_0x3c75ff,_0x26d727=await database_1[_0x15f897(0xe0)]['payout'][_0x15f897(0xef)]({'where':{'id':_0x312a34,'shopId':_0x42dcca}});if(!_0x26d727)return null;return{'id':_0x26d727['id'],'amount':_0x26d727['amount'],'network':_0x26d727[_0x15f897(0x131)],'status':_0x26d727[_0x15f897(0x129)],'txid':_0x26d727[_0x15f897(0x9f)],'notes':_0x26d727[_0x15f897(0xfd)],'createdAt':_0x26d727[_0x15f897(0xa2)],'paidAt':_0x26d727[_0x15f897(0xbd)]};}async[a56_0x3c75ff(0x12b)](_0x591e1a,_0x41eca){const _0x193278=a56_0x3c75ff,_0x1a8556=new Date();let _0x5902e0;switch(_0x41eca){case'7d':_0x5902e0=new Date(_0x1a8556[_0x193278(0xe8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x193278(0xbf):_0x5902e0=new Date(_0x1a8556[_0x193278(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x193278(0x108):_0x5902e0=new Date(_0x1a8556[_0x193278(0xe8)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5902e0=new Date(_0x1a8556[_0x193278(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x198e6d,_0x156dcb,_0x241646,_0x578bce,_0x242468,_0xad8f9d]=await Promise['all']([database_1[_0x193278(0xe0)][_0x193278(0xce)][_0x193278(0x86)]({'where':{'shopId':_0x591e1a,'createdAt':{'gte':_0x5902e0}}}),database_1[_0x193278(0xe0)][_0x193278(0xce)][_0x193278(0x86)]({'where':{'shopId':_0x591e1a,'status':'COMPLETED','createdAt':{'gte':_0x5902e0}}}),database_1[_0x193278(0xe0)][_0x193278(0xce)][_0x193278(0x86)]({'where':{'shopId':_0x591e1a,'status':'PENDING','createdAt':{'gte':_0x5902e0}}}),database_1[_0x193278(0xe0)][_0x193278(0xce)][_0x193278(0x86)]({'where':{'shopId':_0x591e1a,'status':_0x193278(0xf1),'createdAt':{'gte':_0x5902e0}}}),database_1['default']['payout'][_0x193278(0x93)]({'where':{'shopId':_0x591e1a,'createdAt':{'gte':_0x5902e0}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x193278(0xe0)]['payout'][_0x193278(0x93)]({'where':{'shopId':_0x591e1a},'take':0xa,'orderBy':{'createdAt':_0x193278(0xd6)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x49bb8e=_0x242468[_0x193278(0x115)]((_0x35c46c,_0x1b79ca)=>_0x35c46c+_0x1b79ca['amount'],0x0),_0x1347e1=_0x242468[_0x193278(0xb5)](_0x3096cc=>_0x3096cc[_0x193278(0x129)]==='COMPLETED')[_0x193278(0x115)]((_0x8e4d6a,_0x1c50ba)=>_0x8e4d6a+_0x1c50ba['amount'],0x0),_0x56f24c=_0x242468[_0x193278(0xb5)](_0x54c63d=>_0x54c63d[_0x193278(0x129)]==='PENDING')[_0x193278(0x115)]((_0x443037,_0x2cb8a1)=>_0x443037+_0x2cb8a1['amount'],0x0),_0x34b6d3=_0x242468[_0x193278(0x115)]((_0x5ff029,_0x4d571f)=>{const _0x3af817=_0x193278;return _0x5ff029[_0x4d571f['network']]=(_0x5ff029[_0x4d571f[_0x3af817(0x131)]]||0x0)+0x1,_0x5ff029;},{}),_0x529a32=_0x242468[_0x193278(0x115)]((_0x336659,_0x5323cf)=>{const _0x439345=_0x193278;return _0x336659[_0x5323cf[_0x439345(0x129)]]=(_0x336659[_0x5323cf[_0x439345(0x129)]]||0x0)+0x1,_0x336659;},{});return{'totalPayouts':_0x198e6d,'completedPayouts':_0x156dcb,'pendingPayouts':_0x241646,'rejectedPayouts':_0x578bce,'totalAmount':_0x49bb8e,'completedAmount':_0x1347e1,'pendingAmount':_0x56f24c,'payoutsByMethod':_0x34b6d3,'payoutsByStatus':_0x529a32,'recentPayouts':_0xad8f9d[_0x193278(0xed)](_0x347619=>({'id':_0x347619['id'],'shopId':_0x591e1a,'amount':_0x347619[_0x193278(0x11b)],'method':_0x347619[_0x193278(0x131)],'status':_0x347619[_0x193278(0x129)],'txid':_0x347619[_0x193278(0x9f)],'createdAt':_0x347619[_0x193278(0xa2)],'paidAt':_0x347619['paidAt']}))};}async[a56_0x3c75ff(0x105)](_0x9b575e){const _0xdb7145=a56_0x3c75ff;console[_0xdb7145(0x95)](_0xdb7145(0x11d)+_0x9b575e+'...');const _0x4c8033=await database_1[_0xdb7145(0xe0)]['shop']['findUnique']({'where':{'id':_0x9b575e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4c8033)throw new Error('Shop\x20not\x20found');const _0x3c7600=new Date(),_0x128389=new Date(_0x3c7600['getFullYear'](),_0x3c7600['getMonth'](),0x1),_0x1f17a4=new Date(_0x3c7600[_0xdb7145(0x80)](),_0x3c7600[_0xdb7145(0x104)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x56dc5e=await database_1[_0xdb7145(0xe0)][_0xdb7145(0xce)][_0xdb7145(0xe7)]({'_sum':{'amount':!![]},'where':{'shopId':_0x9b575e,'createdAt':{'gte':_0x128389,'lte':_0x1f17a4},'status':'COMPLETED'}}),_0x2e5f4e=_0x56dc5e[_0xdb7145(0xba)]['amount']||0x0,_0x42650b={'availableBalance':Math['round'](_0x4c8033[_0xdb7145(0x12e)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x4c8033[_0xdb7145(0xec)]*0x64)/0x64,'awaitingPayout':Math[_0xdb7145(0x106)](_0x4c8033[_0xdb7145(0x12e)]*0x64)/0x64,'thisMonth':Math[_0xdb7145(0x106)](_0x2e5f4e*0x64)/0x64};return console[_0xdb7145(0x95)](_0xdb7145(0xb8)+_0x4c8033['username']+'\x20payout\x20statistics\x20calculated:'),console[_0xdb7145(0x95)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x42650b[_0xdb7145(0x127)]+'\x20USDT\x20(current\x20balance)'),console[_0xdb7145(0x95)](_0xdb7145(0xc5)+_0x42650b['totalPaidOut']+_0xdb7145(0xf5)),console[_0xdb7145(0x95)](_0xdb7145(0xaf)+_0x42650b[_0xdb7145(0x10d)]+_0xdb7145(0xda)),console[_0xdb7145(0x95)](_0xdb7145(0x82)+_0x42650b['thisMonth']+'\x20USDT'),_0x42650b;}['getGatewayDisplayName'](_0xdc281a){const _0x5e6941=a56_0x3c75ff,_0x43259f={'test_gateway':_0x5e6941(0x9e),'plisio':_0x5e6941(0x107),'rapyd':_0x5e6941(0xdd),'noda':_0x5e6941(0xfb),'cointopay':'CoinToPay','klyme_eu':_0x5e6941(0x11c),'klyme_gb':_0x5e6941(0x119),'klyme_de':_0x5e6941(0x90)};return _0x43259f[_0xdc281a]||_0xdc281a;}async[a56_0x3c75ff(0xc9)](_0x2f2c67){return this['getShopPayoutStats'](_0x2f2c67);}async[a56_0x3c75ff(0xc7)](_0xe86dc,_0x458bf2){const _0x361833=a56_0x3c75ff,{page:_0x3f3ae5,limit:_0x1f58dc,paymentId:_0x14984f}=_0x458bf2,_0x39afa6=(_0x3f3ae5-0x1)*_0x1f58dc,_0x8bcf39={'shopId':_0xe86dc};_0x14984f&&(_0x8bcf39[_0x361833(0x11f)]=_0x14984f);const [_0x543007,_0x25f4bc]=await Promise[_0x361833(0xad)]([database_1[_0x361833(0xe0)][_0x361833(0xe1)][_0x361833(0x93)]({'where':_0x8bcf39,'skip':_0x39afa6,'take':_0x1f58dc,'orderBy':{'createdAt':_0x361833(0xd6)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x361833(0xe0)]['webhookLog'][_0x361833(0x86)]({'where':_0x8bcf39})]);return{'logs':_0x543007['map'](_0x207540=>({'id':_0x207540['id'],'paymentId':_0x207540[_0x361833(0x11f)],'shopId':_0x207540[_0x361833(0x9b)],'event':_0x207540[_0x361833(0xb7)],'statusCode':_0x207540[_0x361833(0x96)],'retryCount':_0x207540[_0x361833(0xd9)],'responseBody':_0x207540[_0x361833(0x125)],'createdAt':_0x207540[_0x361833(0xa2)],'payment':_0x207540[_0x361833(0xc1)]})),'pagination':{'page':_0x3f3ae5,'limit':_0x1f58dc,'total':_0x25f4bc,'totalPages':Math[_0x361833(0x99)](_0x25f4bc/_0x1f58dc)}};}async['getStatistics'](_0x295761,_0x95b96d){const _0x2b55f4=a56_0x3c75ff,_0x7bebd7=new Date();let _0x496c86;switch(_0x95b96d){case'7d':_0x496c86=new Date(_0x7bebd7[_0x2b55f4(0xe8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2b55f4(0xbf):_0x496c86=new Date(_0x7bebd7[_0x2b55f4(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x496c86=new Date(_0x7bebd7[_0x2b55f4(0xe8)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x496c86=new Date(_0x7bebd7[_0x2b55f4(0xe8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x499279,_0x294c13,_0x32bf0b,_0x5114d7,_0x80a88d]=await Promise[_0x2b55f4(0xad)]([database_1[_0x2b55f4(0xe0)][_0x2b55f4(0xc1)][_0x2b55f4(0x86)]({'where':{'shopId':_0x295761,'gateway':{'not':_0x2b55f4(0xd1)},'createdAt':{'gte':_0x496c86}}}),database_1[_0x2b55f4(0xe0)]['payment'][_0x2b55f4(0x86)]({'where':{'shopId':_0x295761,'gateway':{'not':'test_gateway'},'status':_0x2b55f4(0xa4),'createdAt':{'gte':_0x496c86}}}),database_1['default']['payment'][_0x2b55f4(0x93)]({'where':{'shopId':_0x295761,'gateway':{'not':'test_gateway'},'status':_0x2b55f4(0xa4),'createdAt':{'gte':_0x496c86}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x2b55f4(0xc1)][_0x2b55f4(0x93)]({'where':{'shopId':_0x295761,'gateway':{'not':_0x2b55f4(0xd1)}},'take':0xa,'orderBy':{'createdAt':_0x2b55f4(0xd6)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x2b55f4(0xe0)][_0x2b55f4(0xc1)][_0x2b55f4(0x93)]({'where':{'shopId':_0x295761,'gateway':{'not':_0x2b55f4(0xd1)},'createdAt':{'gte':_0x496c86}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x2b55f4(0xd5)}})]);let _0x5a312a=0x0;for(const _0x50d5f8 of _0x32bf0b){if(_0x50d5f8['amountUSDT'])_0x5a312a+=_0x50d5f8['amountUSDT'];else{const _0xdc45e4=await currencyService_1['currencyService'][_0x2b55f4(0xa9)](_0x50d5f8[_0x2b55f4(0x11b)],_0x50d5f8['currency']);_0x5a312a+=_0xdc45e4;}}const _0x118c5b=this[_0x2b55f4(0xaa)](_0x80a88d,_0x496c86,_0x7bebd7),_0x2ea0c1=_0x499279>0x0?_0x294c13/_0x499279*0x64:0x0;return{'totalPayments':_0x499279,'successfulPayments':_0x294c13,'totalRevenue':Math[_0x2b55f4(0x106)](_0x5a312a*0x64)/0x64,'conversionRate':Math[_0x2b55f4(0x106)](_0x2ea0c1*0x64)/0x64,'dailyRevenue':_0x118c5b[_0x2b55f4(0xde)],'dailyPayments':_0x118c5b[_0x2b55f4(0x84)],'recentPayments':_0x5114d7[_0x2b55f4(0xed)](_0x52e288=>({'id':_0x52e288['id'],'gateway':_0x52e288[_0x2b55f4(0x81)],'amount':_0x52e288[_0x2b55f4(0x11b)],'currency':_0x52e288['currency'],'status':_0x52e288[_0x2b55f4(0x129)],'createdAt':_0x52e288[_0x2b55f4(0xa2)]}))};}[a56_0x3c75ff(0xaa)](_0x2e6f10,_0x51a807,_0x5664ee){const _0x2403d9=a56_0x3c75ff,_0x6b3bfb=new Map(),_0x581e91=new Date(_0x51a807);while(_0x581e91<=_0x5664ee){const _0x59e737=_0x581e91[_0x2403d9(0x94)]()[_0x2403d9(0xf2)]('T')[0x0];_0x6b3bfb[_0x2403d9(0x126)](_0x59e737,{'revenue':0x0,'count':0x0}),_0x581e91[_0x2403d9(0x112)](_0x581e91[_0x2403d9(0x91)]()+0x1);}for(const _0x352433 of _0x2e6f10){const _0x5cc529=_0x352433[_0x2403d9(0xa2)]['toISOString']()[_0x2403d9(0xf2)]('T')[0x0],_0x3217d6=_0x6b3bfb['get'](_0x5cc529);_0x3217d6&&(_0x3217d6[_0x2403d9(0x86)]+=0x1,_0x352433[_0x2403d9(0x129)]===_0x2403d9(0xa4)&&_0x352433['amountUSDT']&&(_0x3217d6['revenue']+=_0x352433[_0x2403d9(0x8b)]));}const _0x61bbee=[],_0x3f4415=[];for(const [_0x124a9e,_0x355179]of _0x6b3bfb){_0x61bbee[_0x2403d9(0xae)]({'date':_0x124a9e,'amount':Math[_0x2403d9(0x106)](_0x355179[_0x2403d9(0xcc)]*0x64)/0x64}),_0x3f4415[_0x2403d9(0xae)]({'date':_0x124a9e,'count':_0x355179[_0x2403d9(0x86)]});}return{'dailyRevenue':_0x61bbee,'dailyPayments':_0x3f4415};}}exports[a56_0x3c75ff(0x100)]=ShopService;