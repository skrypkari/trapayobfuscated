'use strict';const a54_0x50f829=a54_0x8dbb;(function(_0x97df78,_0x34d829){const _0x29a1d7=a54_0x8dbb,_0x4ae237=_0x97df78();while(!![]){try{const _0x1b4d03=-parseInt(_0x29a1d7(0x205))/0x1+-parseInt(_0x29a1d7(0x1b6))/0x2+parseInt(_0x29a1d7(0x24e))/0x3+parseInt(_0x29a1d7(0x23a))/0x4+parseInt(_0x29a1d7(0x1a5))/0x5+-parseInt(_0x29a1d7(0x23c))/0x6*(-parseInt(_0x29a1d7(0x1d2))/0x7)+-parseInt(_0x29a1d7(0x1fa))/0x8;if(_0x1b4d03===_0x34d829)break;else _0x4ae237['push'](_0x4ae237['shift']());}catch(_0x11fb92){_0x4ae237['push'](_0x4ae237['shift']());}}}(a54_0x2070,0x9abe8));var __importDefault=this&&this[a54_0x50f829(0x1c1)]||function(_0x347e78){return _0x347e78&&_0x347e78['__esModule']?_0x347e78:{'default':_0x347e78};};Object[a54_0x50f829(0x1c3)](exports,a54_0x50f829(0x20a),{'value':!![]}),exports[a54_0x50f829(0x20e)]=void 0x0;const database_1=__importDefault(require(a54_0x50f829(0x21b))),currencyService_1=require(a54_0x50f829(0x223)),paymentService_1=require('./paymentService');function a54_0x2070(){const _0x2492de=['2125236ZBczuu','createdAt','statusCode','usdtErcWallet','log','map','updateWallets','fullName','shopId','test_payment_123','30d','__importDefault','amount','defineProperty','üìÖ\x20Period\x20end:\x20','üìä\x20Shop\x20','language','all','usdtPolygonWallet','status','currency','balance','Shop\x20not\x20found','parse','sourceCurrency','publicKey','USDT\x20ERC20','settings','7GWnJql','...','findFirst','gte','dailyRevenue','stringify','test_gateway','periodFrom','test_order_123','telegramId','USDT\x20Polygon','Noda','generateDailyStatistics','amountUSDT','Test\x20webhook\x20sent\x20successfully\x20(','gateways','polygon','aggregate','\x20\x20\x20üíµ\x20Available\x20balance:\x20','getWebhookLogs','filter','event','COMPLETED','Plisio','paymentId','getPayoutById','setDate','paidAt','redirectUrl','push','findMany','üìä\x20Status\x20filter:\x20','telegram','getTime','txid','getPayoutStats','trc20','formatNetworkName','paymentService','isArray','1121464OZydLI','\x20payout\x20statistics\x20calculated:','getFullYear','Error\x20parsing\x20webhook\x20events:','payout','üåê\x20Method\x20filter:\x20','thisMonth','getStatistics','gateway','username','name','1241948sQzVAD','test','getPayoutStatistics','awaitingPayout','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','__esModule','getPaymentsByShop','periodTo','shop','ShopService','PAID','shopUrl','default','getPayouts','split','Payment\x20not\x20found','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','USDC\x20Polygon','testWebhook','desc','usdtTrcWallet','CoinToPay','../config/database','createPublicPayment','reduce','webhookUrl','USDT\x20TRC20','maxPayments','findUnique','REJECTED','./currencyService','notes','usdcPolygonWallet','lte','\x20USDT\x20(current\x20balance)','network','üìä\x20Final\x20WHERE\x20conditions:','updatePayment','\x20\x20\x20üìÖ\x20This\x20month:\x20','message','responseBody','createPayment','getGatewayDisplayName','convertToUSDT','set','POST','retryCount','getPayments','setHours','PaymentService','wallets','getShopProfile','üìÖ\x20Date\x20start:\x20','4360040nvgSZm','updateShopProfile','1931718lExJIo','üåê\x20Network\x20filter:\x20','currencyService','toUpperCase','getPaymentByShopAndId','polygon_usdc','statusText','paid','Test\x20Gateway','getShopPayoutStats','gatewaySettings','round','error','country','availableBalance','webhookEvents','getMonth','Rapyd','3099918TDzzsX','get','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','Webhook\x20returned\x20error:\x20','üí∞\x20Getting\x20payouts\x20with\x20filters:','ceil','payment','üìÖ\x20Period\x20start:\x20','toISOString','3166560KtrjYV','expiresAt','Failed\x20to\x20send\x20webhook:\x20','KLYME\x20EU','revenue','webhookLog','paymentGateways','customer','No\x20webhook\x20URL\x20configured','count','customerName','update','application/json','totalPaidOut','\x20USDT\x20(total\x20payouts)','USD','deletePayment'];a54_0x2070=function(){return _0x2492de;};return a54_0x2070();}function a54_0x8dbb(_0x379fa9,_0x28ff38){const _0x207065=a54_0x2070();return a54_0x8dbb=function(_0x8dbb9d,_0xaef095){_0x8dbb9d=_0x8dbb9d-0x1a2;let _0x5585a7=_0x207065[_0x8dbb9d];return _0x5585a7;},a54_0x8dbb(_0x379fa9,_0x28ff38);}class ShopService{constructor(){const _0x5631cd=a54_0x50f829;this[_0x5631cd(0x1f8)]=new paymentService_1[(_0x5631cd(0x236))]();}async[a54_0x50f829(0x238)](_0x15a09d){const _0x3a98b2=a54_0x50f829,_0x461902=await database_1[_0x3a98b2(0x211)]['shop'][_0x3a98b2(0x221)]({'where':{'id':_0x15a09d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x461902)throw new Error(_0x3a98b2(0x1cc));let _0x322992=[];if(_0x461902[_0x3a98b2(0x1d1)]?.[_0x3a98b2(0x24b)])try{_0x322992=Array[_0x3a98b2(0x1f9)](_0x461902['settings'][_0x3a98b2(0x24b)])?_0x461902[_0x3a98b2(0x1d1)]['webhookEvents']:JSON[_0x3a98b2(0x1cd)](_0x461902[_0x3a98b2(0x1d1)][_0x3a98b2(0x24b)]);}catch(_0x263002){console['error'](_0x3a98b2(0x1fd),_0x263002),_0x322992=[];}return{'id':_0x461902['id'],'fullName':_0x461902[_0x3a98b2(0x204)],'username':_0x461902[_0x3a98b2(0x203)],'telegramId':_0x461902[_0x3a98b2(0x1f2)],'merchantUrl':_0x461902[_0x3a98b2(0x210)],'gateways':_0x461902[_0x3a98b2(0x1ab)]?JSON[_0x3a98b2(0x1cd)](_0x461902[_0x3a98b2(0x1ab)]):null,'gatewaySettings':_0x461902['gatewaySettings']?JSON[_0x3a98b2(0x1cd)](_0x461902[_0x3a98b2(0x246)]):null,'publicKey':_0x461902['publicKey'],'webhookUrl':_0x461902[_0x3a98b2(0x1d1)]?.[_0x3a98b2(0x21e)]||null,'webhookEvents':_0x322992,'wallets':{'usdtPolygonWallet':_0x461902[_0x3a98b2(0x1c8)],'usdtTrcWallet':_0x461902[_0x3a98b2(0x219)],'usdtErcWallet':_0x461902[_0x3a98b2(0x1b9)],'usdcPolygonWallet':_0x461902[_0x3a98b2(0x225)]},'status':_0x461902[_0x3a98b2(0x1c9)],'createdAt':_0x461902[_0x3a98b2(0x1b7)]};}async[a54_0x50f829(0x23b)](_0x1a2dc4,_0x5584fd){const _0x38ad63=a54_0x50f829,_0x3baea2={};_0x5584fd[_0x38ad63(0x1bd)]&&(_0x3baea2[_0x38ad63(0x204)]=_0x5584fd[_0x38ad63(0x1bd)]);_0x5584fd['telegramId']!==undefined&&(_0x3baea2[_0x38ad63(0x1f2)]=_0x5584fd[_0x38ad63(0x1db)]||null);_0x5584fd['merchantUrl']&&(_0x3baea2['shopUrl']=_0x5584fd['merchantUrl']);_0x5584fd['gateways']&&(_0x3baea2[_0x38ad63(0x1ab)]=JSON[_0x38ad63(0x1d7)](_0x5584fd[_0x38ad63(0x1e1)]));_0x5584fd['gatewaySettings']&&(_0x3baea2[_0x38ad63(0x246)]=JSON[_0x38ad63(0x1d7)](_0x5584fd[_0x38ad63(0x246)]));_0x5584fd[_0x38ad63(0x237)]&&(_0x5584fd['wallets'][_0x38ad63(0x1c8)]!==undefined&&(_0x3baea2[_0x38ad63(0x1c8)]=_0x5584fd[_0x38ad63(0x237)][_0x38ad63(0x1c8)]||null),_0x5584fd['wallets'][_0x38ad63(0x219)]!==undefined&&(_0x3baea2[_0x38ad63(0x219)]=_0x5584fd[_0x38ad63(0x237)]['usdtTrcWallet']||null),_0x5584fd['wallets']['usdtErcWallet']!==undefined&&(_0x3baea2[_0x38ad63(0x1b9)]=_0x5584fd['wallets'][_0x38ad63(0x1b9)]||null),_0x5584fd[_0x38ad63(0x237)][_0x38ad63(0x225)]!==undefined&&(_0x3baea2[_0x38ad63(0x225)]=_0x5584fd[_0x38ad63(0x237)][_0x38ad63(0x225)]||null));const _0xa1c211=await database_1[_0x38ad63(0x211)][_0x38ad63(0x20d)]['update']({'where':{'id':_0x1a2dc4},'data':_0x3baea2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x14ff5a=[];if(_0xa1c211['settings']?.[_0x38ad63(0x24b)])try{_0x14ff5a=Array['isArray'](_0xa1c211[_0x38ad63(0x1d1)]['webhookEvents'])?_0xa1c211['settings'][_0x38ad63(0x24b)]:JSON[_0x38ad63(0x1cd)](_0xa1c211[_0x38ad63(0x1d1)][_0x38ad63(0x24b)]);}catch(_0x4265d0){console[_0x38ad63(0x248)]('Error\x20parsing\x20webhook\x20events:',_0x4265d0),_0x14ff5a=[];}return{'id':_0xa1c211['id'],'fullName':_0xa1c211[_0x38ad63(0x204)],'username':_0xa1c211['username'],'telegramId':_0xa1c211[_0x38ad63(0x1f2)],'merchantUrl':_0xa1c211[_0x38ad63(0x210)],'gateways':_0xa1c211[_0x38ad63(0x1ab)]?JSON[_0x38ad63(0x1cd)](_0xa1c211[_0x38ad63(0x1ab)]):null,'gatewaySettings':_0xa1c211[_0x38ad63(0x246)]?JSON['parse'](_0xa1c211[_0x38ad63(0x246)]):null,'publicKey':_0xa1c211[_0x38ad63(0x1cf)],'webhookUrl':_0xa1c211[_0x38ad63(0x1d1)]?.[_0x38ad63(0x21e)]||null,'webhookEvents':_0x14ff5a,'wallets':{'usdtPolygonWallet':_0xa1c211[_0x38ad63(0x1c8)],'usdtTrcWallet':_0xa1c211[_0x38ad63(0x219)],'usdtErcWallet':_0xa1c211['usdtErcWallet'],'usdcPolygonWallet':_0xa1c211['usdcPolygonWallet']},'status':_0xa1c211[_0x38ad63(0x1c9)],'createdAt':_0xa1c211[_0x38ad63(0x1b7)]};}async[a54_0x50f829(0x1bc)](_0x7bca0d,_0x535a52){const _0x7d6edb=a54_0x50f829,_0x196517={};_0x535a52[_0x7d6edb(0x1c8)]!==undefined&&(_0x196517[_0x7d6edb(0x1c8)]=_0x535a52['usdtPolygonWallet']||null),_0x535a52[_0x7d6edb(0x219)]!==undefined&&(_0x196517['usdtTrcWallet']=_0x535a52[_0x7d6edb(0x219)]||null),_0x535a52[_0x7d6edb(0x1b9)]!==undefined&&(_0x196517[_0x7d6edb(0x1b9)]=_0x535a52[_0x7d6edb(0x1b9)]||null),_0x535a52[_0x7d6edb(0x225)]!==undefined&&(_0x196517[_0x7d6edb(0x225)]=_0x535a52[_0x7d6edb(0x225)]||null),await database_1['default']['shop'][_0x7d6edb(0x1b0)]({'where':{'id':_0x7bca0d},'data':_0x196517});}async[a54_0x50f829(0x217)](_0xbc7b69){const _0x23eb45=a54_0x50f829,_0x7e007b=await database_1[_0x23eb45(0x211)]['shop'][_0x23eb45(0x221)]({'where':{'id':_0xbc7b69},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x7e007b?.[_0x23eb45(0x1d1)]?.[_0x23eb45(0x21e)])throw new Error(_0x23eb45(0x1ad));const _0x23b624={'event':_0x23eb45(0x206),'payment':{'id':_0x23eb45(0x1bf),'order_id':_0x23eb45(0x1da),'gateway':'test','amount':0x64,'currency':_0x23eb45(0x1b4),'status':_0x23eb45(0x243),'created_at':new Date()['toISOString']()}};try{const _0x43c9f6=await fetch(_0x7e007b['settings']['webhookUrl'],{'method':_0x23eb45(0x232),'headers':{'Content-Type':_0x23eb45(0x1b1),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x23eb45(0x1d7)](_0x23b624)});return _0x43c9f6['ok']?{'success':!![],'message':_0x23eb45(0x1e0)+_0x43c9f6[_0x23eb45(0x1c9)]+')'}:{'success':![],'message':_0x23eb45(0x251)+_0x43c9f6['status']+'\x20'+_0x43c9f6[_0x23eb45(0x242)]};}catch(_0x3afc86){return{'success':![],'message':_0x23eb45(0x1a7)+(_0x3afc86 instanceof Error?_0x3afc86[_0x23eb45(0x22c)]:'Unknown\x20error')};}}async[a54_0x50f829(0x22e)](_0x2a822a){const _0x57f3a5=a54_0x50f829;return this[_0x57f3a5(0x1f8)][_0x57f3a5(0x21c)]({'public_key':'','gateway':_0x2a822a['gateway'],'order_id':undefined,'amount':_0x2a822a[_0x57f3a5(0x1c2)],'currency':_0x2a822a[_0x57f3a5(0x1ca)],'source_currency':_0x2a822a[_0x57f3a5(0x1ce)],'usage':_0x2a822a['usage'],'expires_at':_0x2a822a[_0x57f3a5(0x1a6)]?.['toISOString'](),'success_url':_0x2a822a[_0x57f3a5(0x1ee)],'fail_url':_0x2a822a['redirectUrl'],'customer_email':_0x2a822a['customerEmail'],'customer_name':_0x2a822a[_0x57f3a5(0x1af)],'country':_0x2a822a[_0x57f3a5(0x249)],'language':_0x2a822a[_0x57f3a5(0x1c6)],'amount_is_editable':_0x2a822a['amountIsEditable'],'max_payments':_0x2a822a[_0x57f3a5(0x220)],'customer':_0x2a822a[_0x57f3a5(0x1ac)]});}async[a54_0x50f829(0x234)](_0x4a456b,_0x5bbacd){const _0x22b42f=a54_0x50f829;return this[_0x22b42f(0x1f8)][_0x22b42f(0x20b)](_0x4a456b,_0x5bbacd);}async['getPaymentById'](_0x368ff4,_0x3e3d52){const _0x28e7cc=a54_0x50f829;return this[_0x28e7cc(0x1f8)][_0x28e7cc(0x240)](_0x368ff4,_0x3e3d52);}async[a54_0x50f829(0x22a)](_0x2db85c,_0x3e1eac,_0x3f4d1f){const _0x234dc6=a54_0x50f829,_0x51581d=await database_1[_0x234dc6(0x211)]['payment'][_0x234dc6(0x1d4)]({'where':{'id':_0x3e1eac,'shopId':_0x2db85c}});if(!_0x51581d)throw new Error('Payment\x20not\x20found');const _0x1cde23=await database_1[_0x234dc6(0x211)][_0x234dc6(0x1a2)]['update']({'where':{'id':_0x3e1eac},'data':{..._0x3f4d1f,'updatedAt':new Date()}});return _0x1cde23;}async[a54_0x50f829(0x1b5)](_0x31f1a4,_0x2e3647){const _0x7889e3=a54_0x50f829,_0x96d8f5=await database_1[_0x7889e3(0x211)][_0x7889e3(0x1a2)]['findFirst']({'where':{'id':_0x2e3647,'shopId':_0x31f1a4}});if(!_0x96d8f5)throw new Error(_0x7889e3(0x214));await database_1['default'][_0x7889e3(0x1a2)]['delete']({'where':{'id':_0x2e3647}});}[a54_0x50f829(0x1f7)](_0x30b5bf){const _0x12be6b=a54_0x50f829,_0x1824f2={'polygon':_0x12be6b(0x1dc),'trc20':_0x12be6b(0x21f),'erc20':_0x12be6b(0x1d0),'bsc':'USDT\x20BSC','polygon_usdc':_0x12be6b(0x216)};return _0x1824f2[_0x30b5bf]||_0x30b5bf;}async[a54_0x50f829(0x212)](_0x5a5224,_0xce21d8){const _0xc12995=a54_0x50f829,{page:_0x1f0211,limit:_0xda715,status:_0x2c7ca0,method:_0xa3b3a7,network:_0x4017ec,dateFrom:_0x54c3d5,dateTo:_0x2d3532,periodFrom:_0x4f5432,periodTo:_0x1d3f01}=_0xce21d8,_0x31cf4d=(_0x1f0211-0x1)*_0xda715;console[_0xc12995(0x1ba)](_0xc12995(0x252),_0xce21d8);const _0x371883={'shopId':_0x5a5224};_0x2c7ca0&&(_0x371883[_0xc12995(0x1c9)]=_0x2c7ca0[_0xc12995(0x23f)](),console['log'](_0xc12995(0x1f1)+_0x2c7ca0[_0xc12995(0x23f)]()));if(_0xa3b3a7)_0x371883['network']=_0xa3b3a7,console[_0xc12995(0x1ba)](_0xc12995(0x1ff)+_0xa3b3a7);else _0x4017ec&&(_0x371883[_0xc12995(0x228)]=_0x4017ec,console[_0xc12995(0x1ba)](_0xc12995(0x23d)+_0x4017ec));if(_0x54c3d5||_0x2d3532||_0x4f5432||_0x1d3f01){_0x371883[_0xc12995(0x1b7)]={};if(_0x4f5432){const _0x6de74d=new Date(_0x4f5432);_0x6de74d[_0xc12995(0x235)](0x0,0x0,0x0,0x0),_0x371883['createdAt'][_0xc12995(0x1d5)]=_0x6de74d,console['log'](_0xc12995(0x1a3)+_0x6de74d[_0xc12995(0x1a4)]());}else{if(_0x54c3d5){const _0x2c31da=new Date(_0x54c3d5);_0x2c31da[_0xc12995(0x235)](0x0,0x0,0x0,0x0),_0x371883['createdAt'][_0xc12995(0x1d5)]=_0x2c31da,console[_0xc12995(0x1ba)](_0xc12995(0x239)+_0x2c31da[_0xc12995(0x1a4)]());}}if(_0x1d3f01){const _0x3dd750=new Date(_0x1d3f01);_0x3dd750[_0xc12995(0x235)](0x17,0x3b,0x3b,0x3e7),_0x371883[_0xc12995(0x1b7)]['lte']=_0x3dd750,console[_0xc12995(0x1ba)](_0xc12995(0x1c4)+_0x3dd750[_0xc12995(0x1a4)]());}else{if(_0x2d3532){const _0x584681=new Date(_0x2d3532);_0x584681['setHours'](0x17,0x3b,0x3b,0x3e7),_0x371883[_0xc12995(0x1b7)][_0xc12995(0x226)]=_0x584681,console[_0xc12995(0x1ba)]('üìÖ\x20Date\x20end:\x20'+_0x584681['toISOString']());}}}console[_0xc12995(0x1ba)](_0xc12995(0x229),JSON[_0xc12995(0x1d7)](_0x371883,null,0x2));const [_0xb89dea,_0x496e04]=await Promise[_0xc12995(0x1c7)]([database_1[_0xc12995(0x211)]['payout'][_0xc12995(0x1f0)]({'where':_0x371883,'skip':_0x31cf4d,'take':_0xda715,'orderBy':{'createdAt':_0xc12995(0x218)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default']['payout'][_0xc12995(0x1ae)]({'where':_0x371883})]);return{'payouts':_0xb89dea[_0xc12995(0x1bb)](_0x13df9b=>{const _0xb9e012=_0xc12995;let _0x42de69=null;switch(_0x13df9b[_0xb9e012(0x228)]){case _0xb9e012(0x1e2):_0x42de69=_0x13df9b['shop'][_0xb9e012(0x1c8)];break;case _0xb9e012(0x1f6):_0x42de69=_0x13df9b[_0xb9e012(0x20d)][_0xb9e012(0x219)];break;case'erc20':_0x42de69=_0x13df9b['shop'][_0xb9e012(0x1b9)];break;case _0xb9e012(0x241):_0x42de69=_0x13df9b[_0xb9e012(0x20d)][_0xb9e012(0x225)];break;}return{'id':_0x13df9b['id'],'amount':_0x13df9b[_0xb9e012(0x1c2)],'network':this[_0xb9e012(0x1f7)](_0x13df9b[_0xb9e012(0x228)]),'wallet':_0x42de69,'status':_0x13df9b['status'],'txid':_0x13df9b['txid'],'notes':_0x13df9b[_0xb9e012(0x224)],'periodFrom':_0x13df9b[_0xb9e012(0x1d9)],'periodTo':_0x13df9b[_0xb9e012(0x20c)],'createdAt':_0x13df9b[_0xb9e012(0x1b7)],'paidAt':_0x13df9b[_0xb9e012(0x1ed)]};}),'pagination':{'page':_0x1f0211,'limit':_0xda715,'total':_0x496e04,'totalPages':Math[_0xc12995(0x253)](_0x496e04/_0xda715)}};}async[a54_0x50f829(0x1eb)](_0x2f5369,_0x3f1120){const _0x17c04b=a54_0x50f829,_0x268a6d=await database_1['default']['payout'][_0x17c04b(0x1d4)]({'where':{'id':_0x3f1120,'shopId':_0x2f5369}});if(!_0x268a6d)return null;return{'id':_0x268a6d['id'],'amount':_0x268a6d['amount'],'network':_0x268a6d[_0x17c04b(0x228)],'status':_0x268a6d['status'],'txid':_0x268a6d['txid'],'notes':_0x268a6d['notes'],'createdAt':_0x268a6d[_0x17c04b(0x1b7)],'paidAt':_0x268a6d[_0x17c04b(0x1ed)]};}async[a54_0x50f829(0x207)](_0x67c89,_0x4abe3d){const _0x4245a4=a54_0x50f829,_0x425423=new Date();let _0x26d9d6;switch(_0x4abe3d){case'7d':_0x26d9d6=new Date(_0x425423['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4245a4(0x1c0):_0x26d9d6=new Date(_0x425423[_0x4245a4(0x1f3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x26d9d6=new Date(_0x425423[_0x4245a4(0x1f3)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x26d9d6=new Date(_0x425423['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4e89ae,_0xe3287d,_0x423be5,_0x54c0fa,_0x4207ad,_0x259368]=await Promise[_0x4245a4(0x1c7)]([database_1[_0x4245a4(0x211)][_0x4245a4(0x1fe)]['count']({'where':{'shopId':_0x67c89,'createdAt':{'gte':_0x26d9d6}}}),database_1[_0x4245a4(0x211)][_0x4245a4(0x1fe)][_0x4245a4(0x1ae)]({'where':{'shopId':_0x67c89,'status':_0x4245a4(0x1e8),'createdAt':{'gte':_0x26d9d6}}}),database_1[_0x4245a4(0x211)][_0x4245a4(0x1fe)][_0x4245a4(0x1ae)]({'where':{'shopId':_0x67c89,'status':'PENDING','createdAt':{'gte':_0x26d9d6}}}),database_1[_0x4245a4(0x211)][_0x4245a4(0x1fe)][_0x4245a4(0x1ae)]({'where':{'shopId':_0x67c89,'status':_0x4245a4(0x222),'createdAt':{'gte':_0x26d9d6}}}),database_1['default'][_0x4245a4(0x1fe)]['findMany']({'where':{'shopId':_0x67c89,'createdAt':{'gte':_0x26d9d6}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x4245a4(0x1fe)][_0x4245a4(0x1f0)]({'where':{'shopId':_0x67c89},'take':0xa,'orderBy':{'createdAt':_0x4245a4(0x218)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0xf215c1=_0x4207ad[_0x4245a4(0x21d)]((_0x36e988,_0x5ef9a6)=>_0x36e988+_0x5ef9a6[_0x4245a4(0x1c2)],0x0),_0x15549d=_0x4207ad[_0x4245a4(0x1e6)](_0x4f741f=>_0x4f741f[_0x4245a4(0x1c9)]===_0x4245a4(0x1e8))[_0x4245a4(0x21d)]((_0x3ba44c,_0x4f1856)=>_0x3ba44c+_0x4f1856['amount'],0x0),_0x5ea8c9=_0x4207ad[_0x4245a4(0x1e6)](_0x3527d2=>_0x3527d2[_0x4245a4(0x1c9)]==='PENDING')[_0x4245a4(0x21d)]((_0x13c793,_0x46cc6d)=>_0x13c793+_0x46cc6d[_0x4245a4(0x1c2)],0x0),_0x2c4354=_0x4207ad[_0x4245a4(0x21d)]((_0x187c26,_0x4d947e)=>{const _0x15748c=_0x4245a4;return _0x187c26[_0x4d947e[_0x15748c(0x228)]]=(_0x187c26[_0x4d947e[_0x15748c(0x228)]]||0x0)+0x1,_0x187c26;},{}),_0x110314=_0x4207ad[_0x4245a4(0x21d)]((_0x32f37d,_0x1bfff3)=>{const _0xb10567=_0x4245a4;return _0x32f37d[_0x1bfff3[_0xb10567(0x1c9)]]=(_0x32f37d[_0x1bfff3[_0xb10567(0x1c9)]]||0x0)+0x1,_0x32f37d;},{});return{'totalPayouts':_0x4e89ae,'completedPayouts':_0xe3287d,'pendingPayouts':_0x423be5,'rejectedPayouts':_0x54c0fa,'totalAmount':_0xf215c1,'completedAmount':_0x15549d,'pendingAmount':_0x5ea8c9,'payoutsByMethod':_0x2c4354,'payoutsByStatus':_0x110314,'recentPayouts':_0x259368[_0x4245a4(0x1bb)](_0x58ef48=>({'id':_0x58ef48['id'],'shopId':_0x67c89,'amount':_0x58ef48[_0x4245a4(0x1c2)],'method':_0x58ef48['network'],'status':_0x58ef48[_0x4245a4(0x1c9)],'txid':_0x58ef48[_0x4245a4(0x1f4)],'createdAt':_0x58ef48[_0x4245a4(0x1b7)],'paidAt':_0x58ef48[_0x4245a4(0x1ed)]}))};}async[a54_0x50f829(0x245)](_0xe2b3){const _0x806d60=a54_0x50f829;console[_0x806d60(0x1ba)](_0x806d60(0x215)+_0xe2b3+_0x806d60(0x1d3));const _0x2d1447=await database_1[_0x806d60(0x211)][_0x806d60(0x20d)][_0x806d60(0x221)]({'where':{'id':_0xe2b3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2d1447)throw new Error(_0x806d60(0x1cc));const _0x486f5a=new Date(),_0x4a0889=new Date(_0x486f5a['getFullYear'](),_0x486f5a[_0x806d60(0x24c)](),0x1),_0x22b0e8=new Date(_0x486f5a[_0x806d60(0x1fc)](),_0x486f5a[_0x806d60(0x24c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x129f47=await database_1[_0x806d60(0x211)][_0x806d60(0x1fe)][_0x806d60(0x1e3)]({'_sum':{'amount':!![]},'where':{'shopId':_0xe2b3,'createdAt':{'gte':_0x4a0889,'lte':_0x22b0e8},'status':'COMPLETED'}}),_0x70db97=_0x129f47['_sum']['amount']||0x0,_0x4db30a={'availableBalance':Math[_0x806d60(0x247)](_0x2d1447[_0x806d60(0x1cb)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x2d1447[_0x806d60(0x1b2)]*0x64)/0x64,'awaitingPayout':Math[_0x806d60(0x247)](_0x2d1447[_0x806d60(0x1cb)]*0x64)/0x64,'thisMonth':Math[_0x806d60(0x247)](_0x70db97*0x64)/0x64};return console[_0x806d60(0x1ba)](_0x806d60(0x1c5)+_0x2d1447['username']+_0x806d60(0x1fb)),console['log'](_0x806d60(0x1e4)+_0x4db30a[_0x806d60(0x24a)]+_0x806d60(0x227)),console[_0x806d60(0x1ba)](_0x806d60(0x209)+_0x4db30a[_0x806d60(0x1b2)]+_0x806d60(0x1b3)),console[_0x806d60(0x1ba)](_0x806d60(0x250)+_0x4db30a[_0x806d60(0x208)]+'\x20USDT\x20(current\x20balance)'),console[_0x806d60(0x1ba)](_0x806d60(0x22b)+_0x4db30a[_0x806d60(0x200)]+'\x20USDT'),_0x4db30a;}[a54_0x50f829(0x22f)](_0x5869e3){const _0x44e7ca=a54_0x50f829,_0x233ab9={'test_gateway':_0x44e7ca(0x244),'plisio':_0x44e7ca(0x1e9),'rapyd':_0x44e7ca(0x24d),'noda':_0x44e7ca(0x1dd),'cointopay':_0x44e7ca(0x21a),'klyme_eu':_0x44e7ca(0x1a8),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x233ab9[_0x5869e3]||_0x5869e3;}async[a54_0x50f829(0x1f5)](_0xfc49b){const _0x6c2aa=a54_0x50f829;return this[_0x6c2aa(0x245)](_0xfc49b);}async[a54_0x50f829(0x1e5)](_0x446de7,_0x15fdac){const _0x34a003=a54_0x50f829,{page:_0x502f21,limit:_0x3adcc2,paymentId:_0x56ccab}=_0x15fdac,_0x4b0809=(_0x502f21-0x1)*_0x3adcc2,_0x23a1cb={'shopId':_0x446de7};_0x56ccab&&(_0x23a1cb[_0x34a003(0x1ea)]=_0x56ccab);const [_0x586968,_0x1f9fa1]=await Promise[_0x34a003(0x1c7)]([database_1[_0x34a003(0x211)]['webhookLog'][_0x34a003(0x1f0)]({'where':_0x23a1cb,'skip':_0x4b0809,'take':_0x3adcc2,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x34a003(0x211)][_0x34a003(0x1aa)][_0x34a003(0x1ae)]({'where':_0x23a1cb})]);return{'logs':_0x586968['map'](_0x1ace8f=>({'id':_0x1ace8f['id'],'paymentId':_0x1ace8f[_0x34a003(0x1ea)],'shopId':_0x1ace8f[_0x34a003(0x1be)],'event':_0x1ace8f[_0x34a003(0x1e7)],'statusCode':_0x1ace8f[_0x34a003(0x1b8)],'retryCount':_0x1ace8f[_0x34a003(0x233)],'responseBody':_0x1ace8f[_0x34a003(0x22d)],'createdAt':_0x1ace8f[_0x34a003(0x1b7)],'payment':_0x1ace8f[_0x34a003(0x1a2)]})),'pagination':{'page':_0x502f21,'limit':_0x3adcc2,'total':_0x1f9fa1,'totalPages':Math[_0x34a003(0x253)](_0x1f9fa1/_0x3adcc2)}};}async[a54_0x50f829(0x201)](_0x22af9d,_0x31b60d){const _0x3e5304=a54_0x50f829,_0x419b36=new Date();let _0xcd3879;switch(_0x31b60d){case'7d':_0xcd3879=new Date(_0x419b36[_0x3e5304(0x1f3)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3e5304(0x1c0):_0xcd3879=new Date(_0x419b36[_0x3e5304(0x1f3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0xcd3879=new Date(_0x419b36[_0x3e5304(0x1f3)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xcd3879=new Date(_0x419b36[_0x3e5304(0x1f3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x56e653,_0x3530ad,_0x12b04d,_0x290656,_0x2844a0]=await Promise[_0x3e5304(0x1c7)]([database_1[_0x3e5304(0x211)]['payment'][_0x3e5304(0x1ae)]({'where':{'shopId':_0x22af9d,'gateway':{'not':_0x3e5304(0x1d8)},'createdAt':{'gte':_0xcd3879}}}),database_1['default'][_0x3e5304(0x1a2)][_0x3e5304(0x1ae)]({'where':{'shopId':_0x22af9d,'gateway':{'not':_0x3e5304(0x1d8)},'status':_0x3e5304(0x20f),'createdAt':{'gte':_0xcd3879}}}),database_1[_0x3e5304(0x211)]['payment'][_0x3e5304(0x1f0)]({'where':{'shopId':_0x22af9d,'gateway':{'not':_0x3e5304(0x1d8)},'status':_0x3e5304(0x20f),'createdAt':{'gte':_0xcd3879}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3e5304(0x211)][_0x3e5304(0x1a2)][_0x3e5304(0x1f0)]({'where':{'shopId':_0x22af9d,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x3e5304(0x218)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3e5304(0x211)][_0x3e5304(0x1a2)][_0x3e5304(0x1f0)]({'where':{'shopId':_0x22af9d,'gateway':{'not':_0x3e5304(0x1d8)},'createdAt':{'gte':_0xcd3879}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x5c491d=0x0;for(const _0x8109d2 of _0x12b04d){if(_0x8109d2[_0x3e5304(0x1df)])_0x5c491d+=_0x8109d2['amountUSDT'];else{const _0x22691d=await currencyService_1[_0x3e5304(0x23e)][_0x3e5304(0x230)](_0x8109d2[_0x3e5304(0x1c2)],_0x8109d2[_0x3e5304(0x1ca)]);_0x5c491d+=_0x22691d;}}const _0x1e75ef=this[_0x3e5304(0x1de)](_0x2844a0,_0xcd3879,_0x419b36),_0x1ba87f=_0x56e653>0x0?_0x3530ad/_0x56e653*0x64:0x0;return{'totalPayments':_0x56e653,'successfulPayments':_0x3530ad,'totalRevenue':Math[_0x3e5304(0x247)](_0x5c491d*0x64)/0x64,'conversionRate':Math[_0x3e5304(0x247)](_0x1ba87f*0x64)/0x64,'dailyRevenue':_0x1e75ef[_0x3e5304(0x1d6)],'dailyPayments':_0x1e75ef['dailyPayments'],'recentPayments':_0x290656[_0x3e5304(0x1bb)](_0x247301=>({'id':_0x247301['id'],'gateway':_0x247301[_0x3e5304(0x202)],'amount':_0x247301[_0x3e5304(0x1c2)],'currency':_0x247301[_0x3e5304(0x1ca)],'status':_0x247301[_0x3e5304(0x1c9)],'createdAt':_0x247301[_0x3e5304(0x1b7)]}))};}[a54_0x50f829(0x1de)](_0x6a7683,_0x305282,_0x17457e){const _0x24120e=a54_0x50f829,_0x236e04=new Map(),_0x5de015=new Date(_0x305282);while(_0x5de015<=_0x17457e){const _0x188418=_0x5de015[_0x24120e(0x1a4)]()['split']('T')[0x0];_0x236e04[_0x24120e(0x231)](_0x188418,{'revenue':0x0,'count':0x0}),_0x5de015[_0x24120e(0x1ec)](_0x5de015['getDate']()+0x1);}for(const _0x5eb851 of _0x6a7683){const _0x6f51fa=_0x5eb851[_0x24120e(0x1b7)][_0x24120e(0x1a4)]()[_0x24120e(0x213)]('T')[0x0],_0x394370=_0x236e04[_0x24120e(0x24f)](_0x6f51fa);_0x394370&&(_0x394370['count']+=0x1,_0x5eb851[_0x24120e(0x1c9)]===_0x24120e(0x20f)&&_0x5eb851[_0x24120e(0x1df)]&&(_0x394370[_0x24120e(0x1a9)]+=_0x5eb851[_0x24120e(0x1df)]));}const _0x1fe441=[],_0x455797=[];for(const [_0x40ba8d,_0x1c4264]of _0x236e04){_0x1fe441[_0x24120e(0x1ef)]({'date':_0x40ba8d,'amount':Math[_0x24120e(0x247)](_0x1c4264[_0x24120e(0x1a9)]*0x64)/0x64}),_0x455797[_0x24120e(0x1ef)]({'date':_0x40ba8d,'count':_0x1c4264['count']});}return{'dailyRevenue':_0x1fe441,'dailyPayments':_0x455797};}}exports['ShopService']=ShopService;