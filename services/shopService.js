'use strict';const a86_0x27974e=a86_0x235b;(function(_0x5ed55a,_0x42ce2c){const _0x5eefc4=a86_0x235b,_0x4ddbdc=_0x5ed55a();while(!![]){try{const _0x17b586=parseInt(_0x5eefc4(0x23b))/0x1*(-parseInt(_0x5eefc4(0x256))/0x2)+-parseInt(_0x5eefc4(0x219))/0x3*(parseInt(_0x5eefc4(0x22a))/0x4)+-parseInt(_0x5eefc4(0x185))/0x5+parseInt(_0x5eefc4(0x1f1))/0x6*(-parseInt(_0x5eefc4(0x1fb))/0x7)+parseInt(_0x5eefc4(0x1c3))/0x8+parseInt(_0x5eefc4(0x237))/0x9+parseInt(_0x5eefc4(0x22e))/0xa;if(_0x17b586===_0x42ce2c)break;else _0x4ddbdc['push'](_0x4ddbdc['shift']());}catch(_0x190f8a){_0x4ddbdc['push'](_0x4ddbdc['shift']());}}}(a86_0x58eb,0xc8aa7));var __importDefault=this&&this[a86_0x27974e(0x251)]||function(_0x4cbd1d){return _0x4cbd1d&&_0x4cbd1d['__esModule']?_0x4cbd1d:{'default':_0x4cbd1d};};function a86_0x58eb(){const _0x434db5=['shopUrl3','setDate','üìÖ\x20Final\x20date\x20range:\x20','COMPLETED','totalPaidOut','üìä\x20Getting\x20statistics\x20for\x20shop\x20','KLYME\x20GB','\x20\x20\x20üìÖ\x20This\x20month:\x20','all_time','lte','disable2FA','notes','status','merchantUrl3','getPaymentByShopAndId','telegramId','fullName','./currencyService','2932800iuYDRQ','paid','includes','üìÖ\x20Period\x20start:\x20','\x20payout\x20statistics\x20calculated:','yesterday','USDT\x20ERC20','hex','test','merchantUrl2','Error\x20parsing\x20webhook\x20events:','üåê\x20Network\x20filter:\x20','qrcode','REFUND',',\x20period:\x20','getPayoutStats','test_order_123','settings','getPayouts','thisMonth','last_week','getShopPayoutStats','getTime','usdcPolygonWallet','crypto','setUTCDate','twoFactorToken','üîê\x202FA\x20disabled\x20for\x20shop:\x20','CHARGEBACK','ceil','parse','USDT\x20Polygon','getStatistics','paymentService','\x20backup\x20codes','custom_','error','redirectUrl','getPayments','trc20','language','30d','split','test_gateway','twoFactorEnabled','count','678jjxzJt','gatewaySettings','default','findUnique','shopUrl','USDT\x20TRC20','dailyPayments',',\x20dateTo:\x20','üìä\x20Status\x20filter:\x20','webhookEvents','99106xGJtIl','findFirst','payout','2FA\x20is\x20already\x20enabled','set','get','generateDailyStatistics','Unknown\x20error','getUTCDate','filter','startsWith','üåê\x20Method\x20filter:\x20','base32','erc20_usdc','periodFrom','formatNetworkName','round','ShopService','USDC\x20Ethereum','splice','EXPIRED','getDate','secretKey','PAID','webhookUrl','twoFactorSecret','paidAt','polygon','90d','üîê\x202FA\x20enabled\x20for\x20shop:\x20','831WuqlVu','Plisio','Invalid\x202FA\x20token','update','TrapaPay\x20(','length','getPayoutStatistics','webhookLog','shopUrl4','generateBackupCodes','name','üìä\x20Final\x20WHERE\x20conditions:','periodTo','Webhook\x20returned\x20error:\x20','setup2FA','deletePayment','usdtPolygonWallet','3220nFeZTT','getUTCDay','./paymentService','\x20\x20\x20üíµ\x20Available\x20balance:\x20','40706460aBcIMm','username','YESTERDAY','getFullYear','usdcErcWallet','Failed\x20to\x20send\x20webhook:\x20','publicKey','Noda','2FA\x20token\x20is\x20required','5888214zygpal','amountUSDT','...','getWebhookLogs','56680ZpqeQg','digest','map','UTC','\x20USDT\x20(current\x20balance)','getUTCFullYear','usdtTrcWallet','enable2FA','sha256','balance','wallets','../types/gateway','isArray','defineProperty','USD','event','log','amountAfterGatewayCommissionUSDT','shop','PENDING','getUTCMonth','üìÖ\x20Date\x20start:\x20','__importDefault','__esModule','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','shopUrl2','createdAt','52xhxYhF','currency','getGatewayDisplayName','_sum','getPayoutById','telegram','getMonth','REJECTED','all','merchantUrl4','generateSecret','hash','setHours','push','currencyService','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','this_month','4865230eetlkx','usdtErcWallet','backupCodes','revenue','convertToUSDT','üìÖ\x20Period\x20end:\x20','amount','merchantUrl','network','responseBody','shopId','üí∞\x20Getting\x20payouts\x20with\x20filters:','\x20to\x20','availableBalance','üîë\x20Generated\x20','otpauth_url','Payment\x20not\x20found','sourceCurrency','reduce','totp','this_week','payment','gte','getPaymentById','Rapyd','stringify','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','txid','Shop\x20not\x20found','speakeasy','randomBytes','toISOString','gateway','compare','paymentGateways','findMany','Test\x20webhook\x20sent\x20successfully\x20(','toUpperCase','toLowerCase','paymentId','\x20USDT','statusText','gateways','\x20USDT\x20(total\x20payouts)'];a86_0x58eb=function(){return _0x434db5;};return a86_0x58eb();}Object[a86_0x27974e(0x248)](exports,a86_0x27974e(0x252),{'value':!![]}),exports[a86_0x27974e(0x20c)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a86_0x27974e(0x1db))),speakeasy_1=__importDefault(require(a86_0x27974e(0x1a2))),qrcode_1=__importDefault(require(a86_0x27974e(0x1cf))),currencyService_1=require(a86_0x27974e(0x1c2)),paymentService_1=require(a86_0x27974e(0x22c)),gateway_1=require(a86_0x27974e(0x246));class ShopService{constructor(){const _0x5cc959=a86_0x27974e;this[_0x5cc959(0x1e4)]=new paymentService_1['PaymentService']();}async['getShopProfile'](_0x4b8eb3){const _0x3db78d=a86_0x27974e,_0x5a33ec=await database_1[_0x3db78d(0x1f3)]['shop']['findUnique']({'where':{'id':_0x4b8eb3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x5a33ec)throw new Error(_0x3db78d(0x1a1));let _0x5e1ff2=[];if(_0x5a33ec[_0x3db78d(0x1d4)]?.[_0x3db78d(0x1fa)])try{_0x5e1ff2=Array[_0x3db78d(0x247)](_0x5a33ec['settings']['webhookEvents'])?_0x5a33ec['settings'][_0x3db78d(0x1fa)]:JSON[_0x3db78d(0x1e1)](_0x5a33ec[_0x3db78d(0x1d4)][_0x3db78d(0x1fa)]);}catch(_0x240dea){console[_0x3db78d(0x1e7)](_0x3db78d(0x1cd),_0x240dea),_0x5e1ff2=[];}const _0x3af412=gateway_1['AVAILABLE_GATEWAYS'][_0x3db78d(0x204)](_0x269aa5=>_0x269aa5['isActive'])[_0x3db78d(0x23d)](_0x4472f5=>_0x4472f5[_0x3db78d(0x223)]);let _0xc4bd48=_0x5a33ec['paymentGateways']?JSON[_0x3db78d(0x1e1)](_0x5a33ec['paymentGateways']):[];return Array['isArray'](_0xc4bd48)&&(_0xc4bd48=_0xc4bd48[_0x3db78d(0x23d)](_0x4be502=>_0x4be502['replace'](/\s+/g,'_')[_0x3db78d(0x1ab)]())[_0x3db78d(0x204)](_0x208afc=>_0x3af412[_0x3db78d(0x1c5)](_0x208afc))),{'id':_0x5a33ec['id'],'fullName':_0x5a33ec[_0x3db78d(0x223)],'username':_0x5a33ec['username'],'telegramId':_0x5a33ec[_0x3db78d(0x25b)],'merchantUrl':_0x5a33ec[_0x3db78d(0x1f5)],'merchantUrl2':_0x5a33ec[_0x3db78d(0x254)],'merchantUrl3':_0x5a33ec[_0x3db78d(0x1b1)],'merchantUrl4':_0x5a33ec['shopUrl4'],'gateways':_0xc4bd48,'gatewaySettings':_0x5a33ec['gatewaySettings']?JSON['parse'](_0x5a33ec[_0x3db78d(0x1f2)]):null,'publicKey':_0x5a33ec[_0x3db78d(0x234)],'secretKey':_0x5a33ec[_0x3db78d(0x211)],'webhookUrl':_0x5a33ec['settings']?.['webhookUrl']||null,'webhookEvents':_0x5e1ff2,'wallets':{'usdtPolygonWallet':_0x5a33ec[_0x3db78d(0x229)],'usdtTrcWallet':_0x5a33ec[_0x3db78d(0x241)],'usdtErcWallet':_0x5a33ec[_0x3db78d(0x186)],'usdcPolygonWallet':_0x5a33ec[_0x3db78d(0x1da)],'usdcErcWallet':_0x5a33ec[_0x3db78d(0x232)]},'status':_0x5a33ec[_0x3db78d(0x1bd)],'createdAt':_0x5a33ec['createdAt']};}async['updateShopProfile'](_0x1f9681,_0x16cbb8){const _0x214ef4=a86_0x27974e,_0x1068bd={};_0x16cbb8[_0x214ef4(0x1c1)]&&(_0x1068bd['name']=_0x16cbb8[_0x214ef4(0x1c1)]);_0x16cbb8['telegramId']!==undefined&&(_0x1068bd[_0x214ef4(0x25b)]=_0x16cbb8[_0x214ef4(0x1c0)]||null);_0x16cbb8[_0x214ef4(0x18c)]&&(_0x1068bd[_0x214ef4(0x1f5)]=_0x16cbb8[_0x214ef4(0x18c)]);_0x16cbb8[_0x214ef4(0x1cc)]!==undefined&&(_0x1068bd[_0x214ef4(0x254)]=_0x16cbb8[_0x214ef4(0x1cc)]||null);_0x16cbb8[_0x214ef4(0x1be)]!==undefined&&(_0x1068bd[_0x214ef4(0x1b1)]=_0x16cbb8[_0x214ef4(0x1be)]||null);_0x16cbb8[_0x214ef4(0x25f)]!==undefined&&(_0x1068bd[_0x214ef4(0x221)]=_0x16cbb8[_0x214ef4(0x25f)]||null);_0x16cbb8['gateways']&&(_0x1068bd[_0x214ef4(0x1a7)]=JSON['stringify'](_0x16cbb8[_0x214ef4(0x1af)]));_0x16cbb8[_0x214ef4(0x1f2)]&&(_0x1068bd[_0x214ef4(0x1f2)]=JSON[_0x214ef4(0x19e)](_0x16cbb8['gatewaySettings']));_0x16cbb8[_0x214ef4(0x245)]&&(_0x16cbb8[_0x214ef4(0x245)]['usdtPolygonWallet']!==undefined&&(_0x1068bd['usdtPolygonWallet']=_0x16cbb8['wallets'][_0x214ef4(0x229)]||null),_0x16cbb8['wallets']['usdtTrcWallet']!==undefined&&(_0x1068bd['usdtTrcWallet']=_0x16cbb8['wallets'][_0x214ef4(0x241)]||null),_0x16cbb8[_0x214ef4(0x245)]['usdtErcWallet']!==undefined&&(_0x1068bd[_0x214ef4(0x186)]=_0x16cbb8[_0x214ef4(0x245)]['usdtErcWallet']||null),_0x16cbb8[_0x214ef4(0x245)][_0x214ef4(0x1da)]!==undefined&&(_0x1068bd[_0x214ef4(0x1da)]=_0x16cbb8[_0x214ef4(0x245)][_0x214ef4(0x1da)]||null));const _0x557068=await database_1['default']['shop'][_0x214ef4(0x21c)]({'where':{'id':_0x1f9681},'data':_0x1068bd,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x32c436=[];if(_0x557068[_0x214ef4(0x1d4)]?.[_0x214ef4(0x1fa)])try{_0x32c436=Array[_0x214ef4(0x247)](_0x557068['settings'][_0x214ef4(0x1fa)])?_0x557068[_0x214ef4(0x1d4)]['webhookEvents']:JSON[_0x214ef4(0x1e1)](_0x557068[_0x214ef4(0x1d4)][_0x214ef4(0x1fa)]);}catch(_0x574fdb){console[_0x214ef4(0x1e7)]('Error\x20parsing\x20webhook\x20events:',_0x574fdb),_0x32c436=[];}return{'id':_0x557068['id'],'fullName':_0x557068['name'],'username':_0x557068['username'],'telegramId':_0x557068[_0x214ef4(0x25b)],'merchantUrl':_0x557068[_0x214ef4(0x1f5)],'merchantUrl2':_0x557068[_0x214ef4(0x254)],'merchantUrl3':_0x557068[_0x214ef4(0x1b1)],'merchantUrl4':_0x557068[_0x214ef4(0x221)],'gateways':_0x557068[_0x214ef4(0x1a7)]?JSON[_0x214ef4(0x1e1)](_0x557068[_0x214ef4(0x1a7)]):null,'gatewaySettings':_0x557068[_0x214ef4(0x1f2)]?JSON[_0x214ef4(0x1e1)](_0x557068[_0x214ef4(0x1f2)]):null,'publicKey':_0x557068[_0x214ef4(0x234)],'secretKey':_0x557068[_0x214ef4(0x211)],'webhookUrl':_0x557068[_0x214ef4(0x1d4)]?.[_0x214ef4(0x213)]||null,'webhookEvents':_0x32c436,'wallets':{'usdtPolygonWallet':_0x557068['usdtPolygonWallet'],'usdtTrcWallet':_0x557068[_0x214ef4(0x241)],'usdtErcWallet':_0x557068['usdtErcWallet'],'usdcPolygonWallet':_0x557068[_0x214ef4(0x1da)],'usdcErcWallet':_0x557068[_0x214ef4(0x232)]},'status':_0x557068[_0x214ef4(0x1bd)],'createdAt':_0x557068['createdAt']};}async['updateWallets'](_0x288dbb,_0x1068d1){const _0x702611=a86_0x27974e,_0x3d8c2f=await database_1['default']['shop']['findUnique']({'where':{'id':_0x288dbb},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x3d8c2f)throw new Error(_0x702611(0x1a1));if(_0x3d8c2f[_0x702611(0x1ef)]){if(!_0x1068d1[_0x702611(0x1dd)])throw new Error(_0x702611(0x236));const _0x340065=speakeasy_1[_0x702611(0x1f3)][_0x702611(0x198)]['verify']({'secret':_0x3d8c2f[_0x702611(0x214)],'encoding':'base32','token':_0x1068d1[_0x702611(0x1dd)],'window':0x2});if(!_0x340065){let _0x490f1d=![];if(_0x3d8c2f[_0x702611(0x187)]){const _0x2555e8=JSON['parse'](_0x3d8c2f[_0x702611(0x187)]);for(let _0x4c5ffd=0x0;_0x4c5ffd<_0x2555e8[_0x702611(0x21e)];_0x4c5ffd++){const _0x57c42d=await bcryptjs_1[_0x702611(0x1f3)][_0x702611(0x1a6)](_0x1068d1['twoFactorToken'],_0x2555e8[_0x4c5ffd]);if(_0x57c42d){_0x490f1d=!![],_0x2555e8[_0x702611(0x20e)](_0x4c5ffd,0x1),await database_1[_0x702611(0x1f3)][_0x702611(0x24d)]['update']({'where':{'id':_0x288dbb},'data':{'backupCodes':JSON[_0x702611(0x19e)](_0x2555e8)}});break;}}}if(!_0x490f1d)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x559092={};_0x1068d1[_0x702611(0x229)]!==undefined&&(_0x559092['usdtPolygonWallet']=_0x1068d1['usdtPolygonWallet']||null),_0x1068d1[_0x702611(0x241)]!==undefined&&(_0x559092[_0x702611(0x241)]=_0x1068d1[_0x702611(0x241)]||null),_0x1068d1[_0x702611(0x186)]!==undefined&&(_0x559092[_0x702611(0x186)]=_0x1068d1[_0x702611(0x186)]||null),_0x1068d1['usdcPolygonWallet']!==undefined&&(_0x559092[_0x702611(0x1da)]=_0x1068d1[_0x702611(0x1da)]||null),_0x1068d1[_0x702611(0x232)]!==undefined&&(_0x559092[_0x702611(0x232)]=_0x1068d1[_0x702611(0x232)]||null),await database_1[_0x702611(0x1f3)][_0x702611(0x24d)]['update']({'where':{'id':_0x288dbb},'data':_0x559092});}async['testWebhook'](_0x53870f){const _0x58b4ab=a86_0x27974e,_0x1975af=await database_1[_0x58b4ab(0x1f3)][_0x58b4ab(0x24d)]['findUnique']({'where':{'id':_0x53870f},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x1975af?.['settings']?.[_0x58b4ab(0x213)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x39e7c8={'event':_0x58b4ab(0x1cb),'payment':{'id':'test_payment_123','order_id':_0x58b4ab(0x1d3),'gateway':_0x58b4ab(0x1cb),'amount':0x64,'currency':_0x58b4ab(0x249),'status':_0x58b4ab(0x1c4),'created_at':new Date()['toISOString']()}};try{const _0x580215=JSON['stringify'](_0x39e7c8),_0x53d424=crypto_1[_0x58b4ab(0x1f3)]['createHmac'](_0x58b4ab(0x243),_0x1975af[_0x58b4ab(0x211)])[_0x58b4ab(0x21c)](_0x580215)[_0x58b4ab(0x23c)](_0x58b4ab(0x1ca)),_0x18b9f1=await fetch(_0x1975af[_0x58b4ab(0x1d4)][_0x58b4ab(0x213)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0\x20(Test)','X-Webhook-Signature':_0x53d424},'body':_0x580215});return _0x18b9f1['ok']?{'success':!![],'message':_0x58b4ab(0x1a9)+_0x18b9f1['status']+')'}:{'success':![],'message':_0x58b4ab(0x226)+_0x18b9f1[_0x58b4ab(0x1bd)]+'\x20'+_0x18b9f1[_0x58b4ab(0x1ae)]};}catch(_0x4a66fd){return{'success':![],'message':_0x58b4ab(0x233)+(_0x4a66fd instanceof Error?_0x4a66fd['message']:_0x58b4ab(0x202))};}}async['createPayment'](_0x2b6746){const _0x2ae67d=a86_0x27974e;return this[_0x2ae67d(0x1e4)]['createPublicPayment']({'public_key':'','gateway':_0x2b6746[_0x2ae67d(0x1a5)],'order_id':'','amount':_0x2b6746['amount'],'currency':_0x2b6746[_0x2ae67d(0x257)],'source_currency':_0x2b6746[_0x2ae67d(0x196)],'success_url':_0x2b6746[_0x2ae67d(0x1e8)],'fail_url':_0x2b6746['redirectUrl'],'customer_email':_0x2b6746['customerEmail'],'customer_name':_0x2b6746['customerName'],'language':_0x2b6746[_0x2ae67d(0x1eb)]});}async[a86_0x27974e(0x1e9)](_0x3ce73d,_0x786cc3){const _0x1f6bf1=a86_0x27974e;return this[_0x1f6bf1(0x1e4)]['getPaymentsByShop'](_0x3ce73d,_0x786cc3);}async[a86_0x27974e(0x19c)](_0x24354d,_0x32ac22){const _0x1f519a=a86_0x27974e;return this[_0x1f519a(0x1e4)][_0x1f519a(0x1bf)](_0x24354d,_0x32ac22);}async['updatePayment'](_0x11dbe2,_0x2b916a,_0x10037c){const _0x2f8432=a86_0x27974e,_0x57b5da=await database_1['default'][_0x2f8432(0x19a)][_0x2f8432(0x1fc)]({'where':{'id':_0x2b916a,'shopId':_0x11dbe2}});if(!_0x57b5da)throw new Error(_0x2f8432(0x195));const _0x48e682=await database_1[_0x2f8432(0x1f3)][_0x2f8432(0x19a)][_0x2f8432(0x21c)]({'where':{'id':_0x2b916a},'data':{..._0x10037c,'updatedAt':new Date()}});return _0x48e682;}async[a86_0x27974e(0x228)](_0x171a04,_0xd3d88b){const _0x5b42e1=a86_0x27974e,_0x538708=await database_1[_0x5b42e1(0x1f3)][_0x5b42e1(0x19a)][_0x5b42e1(0x1fc)]({'where':{'id':_0xd3d88b,'shopId':_0x171a04}});if(!_0x538708)throw new Error(_0x5b42e1(0x195));await database_1[_0x5b42e1(0x1f3)][_0x5b42e1(0x19a)]['delete']({'where':{'id':_0xd3d88b}});}[a86_0x27974e(0x20a)](_0x30f9bb){const _0x45ac73=a86_0x27974e,_0x19f7bd={'polygon':_0x45ac73(0x1e2),'trc20':_0x45ac73(0x1f6),'erc20':_0x45ac73(0x1c9),'bsc':'USDT\x20BSC','polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x45ac73(0x20d)};return _0x19f7bd[_0x30f9bb]||_0x30f9bb;}async[a86_0x27974e(0x1d5)](_0xb134ef,_0x2882d4){const _0x4d8a0f=a86_0x27974e,{page:_0x5db336,limit:_0x31bec5,status:_0x6e91d6,method:_0x379fc9,network:_0x158fda,dateFrom:_0x131217,dateTo:_0x50881f,periodFrom:_0x4ed521,periodTo:_0x3756bd}=_0x2882d4,_0x43ded6=(_0x5db336-0x1)*_0x31bec5;console[_0x4d8a0f(0x24b)](_0x4d8a0f(0x190),_0x2882d4);const _0xaac905={'shopId':_0xb134ef};_0x6e91d6&&(_0xaac905[_0x4d8a0f(0x1bd)]=_0x6e91d6[_0x4d8a0f(0x1aa)](),console['log'](_0x4d8a0f(0x1f9)+_0x6e91d6[_0x4d8a0f(0x1aa)]()));if(_0x379fc9)_0xaac905[_0x4d8a0f(0x18d)]=_0x379fc9,console[_0x4d8a0f(0x24b)](_0x4d8a0f(0x206)+_0x379fc9);else _0x158fda&&(_0xaac905[_0x4d8a0f(0x18d)]=_0x158fda,console[_0x4d8a0f(0x24b)](_0x4d8a0f(0x1ce)+_0x158fda));if(_0x131217||_0x50881f||_0x4ed521||_0x3756bd){_0xaac905['createdAt']={};if(_0x4ed521){const _0x46a95c=new Date(_0x4ed521);_0x46a95c[_0x4d8a0f(0x262)](0x0,0x0,0x0,0x1),_0xaac905[_0x4d8a0f(0x255)][_0x4d8a0f(0x19b)]=_0x46a95c,console[_0x4d8a0f(0x24b)](_0x4d8a0f(0x1c6)+_0x46a95c[_0x4d8a0f(0x1a4)]());}else{if(_0x131217){const _0x1f407c=new Date(_0x131217);_0x1f407c[_0x4d8a0f(0x262)](0x0,0x0,0x0,0x1),_0xaac905[_0x4d8a0f(0x255)][_0x4d8a0f(0x19b)]=_0x1f407c,console[_0x4d8a0f(0x24b)](_0x4d8a0f(0x250)+_0x1f407c[_0x4d8a0f(0x1a4)]());}}if(_0x3756bd){const _0x4d8d69=new Date(_0x3756bd);_0x4d8d69['setHours'](0x17,0x3b,0x3b,0x3e7),_0xaac905[_0x4d8a0f(0x255)][_0x4d8a0f(0x1ba)]=_0x4d8d69,console[_0x4d8a0f(0x24b)](_0x4d8a0f(0x18a)+_0x4d8d69[_0x4d8a0f(0x1a4)]());}else{if(_0x50881f){const _0x3358aa=new Date(_0x50881f);_0x3358aa[_0x4d8a0f(0x262)](0x17,0x3b,0x3b,0x3e7),_0xaac905[_0x4d8a0f(0x255)][_0x4d8a0f(0x1ba)]=_0x3358aa,console['log']('üìÖ\x20Date\x20end:\x20'+_0x3358aa['toISOString']());}}}console[_0x4d8a0f(0x24b)](_0x4d8a0f(0x224),JSON[_0x4d8a0f(0x19e)](_0xaac905,null,0x2));const [_0x463a77,_0x457bef]=await Promise['all']([database_1[_0x4d8a0f(0x1f3)][_0x4d8a0f(0x1fd)][_0x4d8a0f(0x1a8)]({'where':_0xaac905,'skip':_0x43ded6,'take':_0x31bec5,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x4d8a0f(0x1f3)][_0x4d8a0f(0x1fd)][_0x4d8a0f(0x1f0)]({'where':_0xaac905})]);return{'payouts':_0x463a77[_0x4d8a0f(0x23d)](_0x5b265a=>{const _0x4655ed=_0x4d8a0f;let _0x2f91cf=null;switch(_0x5b265a[_0x4655ed(0x18d)]){case _0x4655ed(0x216):_0x2f91cf=_0x5b265a['shop'][_0x4655ed(0x229)];break;case _0x4655ed(0x1ea):_0x2f91cf=_0x5b265a[_0x4655ed(0x24d)][_0x4655ed(0x241)];break;case'erc20':_0x2f91cf=_0x5b265a['shop'][_0x4655ed(0x186)];break;case'polygon_usdc':_0x2f91cf=_0x5b265a[_0x4655ed(0x24d)]['usdcPolygonWallet'];break;case _0x4655ed(0x208):_0x2f91cf=_0x5b265a[_0x4655ed(0x24d)][_0x4655ed(0x232)];break;}return{'id':_0x5b265a['id'],'amount':_0x5b265a[_0x4655ed(0x18b)],'network':this[_0x4655ed(0x20a)](_0x5b265a['network']),'wallet':_0x2f91cf,'status':_0x5b265a[_0x4655ed(0x1bd)],'txid':_0x5b265a[_0x4655ed(0x1a0)],'notes':_0x5b265a[_0x4655ed(0x1bc)],'periodFrom':_0x5b265a[_0x4655ed(0x209)],'periodTo':_0x5b265a[_0x4655ed(0x225)],'createdAt':_0x5b265a[_0x4655ed(0x255)],'paidAt':_0x5b265a[_0x4655ed(0x215)]};}),'pagination':{'page':_0x5db336,'limit':_0x31bec5,'total':_0x457bef,'totalPages':Math[_0x4d8a0f(0x1e0)](_0x457bef/_0x31bec5)}};}async[a86_0x27974e(0x25a)](_0x1ee0b8,_0x5d8301){const _0x1bae70=a86_0x27974e,_0x5f4870=await database_1[_0x1bae70(0x1f3)][_0x1bae70(0x1fd)][_0x1bae70(0x1fc)]({'where':{'id':_0x5d8301,'shopId':_0x1ee0b8}});if(!_0x5f4870)return null;return{'id':_0x5f4870['id'],'amount':_0x5f4870[_0x1bae70(0x18b)],'network':_0x5f4870['network'],'status':_0x5f4870[_0x1bae70(0x1bd)],'txid':_0x5f4870[_0x1bae70(0x1a0)],'notes':_0x5f4870[_0x1bae70(0x1bc)],'createdAt':_0x5f4870[_0x1bae70(0x255)],'paidAt':_0x5f4870[_0x1bae70(0x215)]};}async[a86_0x27974e(0x21f)](_0x3d48bc,_0x1ca897){const _0x438199=a86_0x27974e,_0x2406c2=new Date();let _0x2db80c,_0x2ff1ac;switch(_0x1ca897){case _0x438199(0x1c8):case _0x438199(0x230):const _0x35c8c1=new Date(_0x2406c2);_0x35c8c1['setDate'](_0x35c8c1['getDate']()-0x1),_0x2db80c=new Date(_0x35c8c1),_0x2db80c[_0x438199(0x262)](0x0,0x0,0x0,0x0),_0x2ff1ac=new Date(_0x35c8c1),_0x2ff1ac['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x2db80c=new Date(_0x2406c2[_0x438199(0x1d9)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x438199(0x1ec):_0x2db80c=new Date(_0x2406c2['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x438199(0x217):_0x2db80c=new Date(_0x2406c2[_0x438199(0x1d9)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2db80c=new Date(_0x2406c2[_0x438199(0x1d9)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x42ccbd={'gte':_0x2db80c};_0x2ff1ac&&(_0x42ccbd[_0x438199(0x1ba)]=_0x2ff1ac);const [_0x3d9397,_0xd69b83,_0x39d94e,_0x3034cc,_0x1cb47c,_0x30ff70]=await Promise[_0x438199(0x25e)]([database_1[_0x438199(0x1f3)][_0x438199(0x1fd)][_0x438199(0x1f0)]({'where':{'shopId':_0x3d48bc,'createdAt':_0x42ccbd}}),database_1[_0x438199(0x1f3)][_0x438199(0x1fd)][_0x438199(0x1f0)]({'where':{'shopId':_0x3d48bc,'status':_0x438199(0x1b4),'createdAt':_0x42ccbd}}),database_1[_0x438199(0x1f3)][_0x438199(0x1fd)][_0x438199(0x1f0)]({'where':{'shopId':_0x3d48bc,'status':_0x438199(0x24e),'createdAt':_0x42ccbd}}),database_1[_0x438199(0x1f3)]['payout'][_0x438199(0x1f0)]({'where':{'shopId':_0x3d48bc,'status':_0x438199(0x25d),'createdAt':_0x42ccbd}}),database_1[_0x438199(0x1f3)][_0x438199(0x1fd)][_0x438199(0x1a8)]({'where':{'shopId':_0x3d48bc,'createdAt':_0x42ccbd},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x438199(0x1fd)]['findMany']({'where':{'shopId':_0x3d48bc},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0xb3ba0e=_0x1cb47c[_0x438199(0x197)]((_0x52c2b1,_0x15ce5b)=>_0x52c2b1+_0x15ce5b[_0x438199(0x18b)],0x0),_0x597b6f=_0x1cb47c[_0x438199(0x204)](_0xc23202=>_0xc23202[_0x438199(0x1bd)]==='COMPLETED')[_0x438199(0x197)]((_0x18d7a3,_0x44137c)=>_0x18d7a3+_0x44137c[_0x438199(0x18b)],0x0),_0x22a3ed=_0x1cb47c[_0x438199(0x204)](_0x1c9423=>_0x1c9423['status']===_0x438199(0x24e))['reduce']((_0x4a3541,_0x10b6aa)=>_0x4a3541+_0x10b6aa[_0x438199(0x18b)],0x0),_0x31c007=_0x1cb47c[_0x438199(0x197)]((_0x2a18ef,_0x50fd60)=>{const _0x17099d=_0x438199;return _0x2a18ef[_0x50fd60[_0x17099d(0x18d)]]=(_0x2a18ef[_0x50fd60[_0x17099d(0x18d)]]||0x0)+0x1,_0x2a18ef;},{}),_0x3f09cd=_0x1cb47c['reduce']((_0xb95fec,_0x5b6751)=>{return _0xb95fec[_0x5b6751['status']]=(_0xb95fec[_0x5b6751['status']]||0x0)+0x1,_0xb95fec;},{});return{'totalPayouts':_0x3d9397,'completedPayouts':_0xd69b83,'pendingPayouts':_0x39d94e,'rejectedPayouts':_0x3034cc,'totalAmount':_0xb3ba0e,'completedAmount':_0x597b6f,'pendingAmount':_0x22a3ed,'payoutsByMethod':_0x31c007,'payoutsByStatus':_0x3f09cd,'recentPayouts':_0x30ff70[_0x438199(0x23d)](_0x5c46e4=>({'id':_0x5c46e4['id'],'shopId':_0x3d48bc,'amount':_0x5c46e4[_0x438199(0x18b)],'method':_0x5c46e4['network'],'status':_0x5c46e4[_0x438199(0x1bd)],'txid':_0x5c46e4['txid'],'createdAt':_0x5c46e4[_0x438199(0x255)],'paidAt':_0x5c46e4[_0x438199(0x215)]}))};}async[a86_0x27974e(0x1d8)](_0x14898a){const _0x35b495=a86_0x27974e;console[_0x35b495(0x24b)](_0x35b495(0x253)+_0x14898a+_0x35b495(0x239));const _0x1990e0=await database_1['default'][_0x35b495(0x24d)]['findUnique']({'where':{'id':_0x14898a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1990e0)throw new Error('Shop\x20not\x20found');const _0xddca12=new Date(),_0x2bc868=new Date(_0xddca12[_0x35b495(0x231)](),_0xddca12['getMonth'](),0x1),_0xc13e49=new Date(_0xddca12['getFullYear'](),_0xddca12[_0x35b495(0x25c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xfc9372=await database_1['default'][_0x35b495(0x1fd)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x14898a,'createdAt':{'gte':_0x2bc868,'lte':_0xc13e49},'status':_0x35b495(0x1b4)}}),_0x471a87=_0xfc9372[_0x35b495(0x259)][_0x35b495(0x18b)]||0x0,_0x3e8e96={'availableBalance':Math[_0x35b495(0x20b)](_0x1990e0[_0x35b495(0x244)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x1990e0[_0x35b495(0x1b5)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x1990e0['balance']*0x64)/0x64,'thisMonth':Math[_0x35b495(0x20b)](_0x471a87*0x64)/0x64};return console[_0x35b495(0x24b)]('üìä\x20Shop\x20'+_0x1990e0[_0x35b495(0x22f)]+_0x35b495(0x1c7)),console[_0x35b495(0x24b)](_0x35b495(0x22d)+_0x3e8e96[_0x35b495(0x192)]+_0x35b495(0x23f)),console[_0x35b495(0x24b)](_0x35b495(0x19f)+_0x3e8e96[_0x35b495(0x1b5)]+_0x35b495(0x1b0)),console['log']('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x3e8e96['awaitingPayout']+_0x35b495(0x23f)),console[_0x35b495(0x24b)](_0x35b495(0x1b8)+_0x3e8e96[_0x35b495(0x1d6)]+_0x35b495(0x1ad)),_0x3e8e96;}[a86_0x27974e(0x258)](_0x4d4347){const _0x4ec7a6=a86_0x27974e,_0x3ebb24={'test_gateway':'Test\x20Gateway','plisio':_0x4ec7a6(0x21a),'rapyd':_0x4ec7a6(0x19d),'noda':_0x4ec7a6(0x235),'cointopay':'CoinToPay','klyme_eu':'KLYME\x20EU','klyme_gb':_0x4ec7a6(0x1b7),'klyme_de':'KLYME\x20DE'};return _0x3ebb24[_0x4d4347]||_0x4d4347;}async[a86_0x27974e(0x1d2)](_0x10cf67){const _0x5e25a4=a86_0x27974e;return this[_0x5e25a4(0x1d8)](_0x10cf67);}async[a86_0x27974e(0x23a)](_0x1486ec,_0x35e7aa){const _0x109422=a86_0x27974e,{page:_0x3316c5,limit:_0x492343,paymentId:_0x43e215}=_0x35e7aa,_0x4951da=(_0x3316c5-0x1)*_0x492343,_0x55353f={'shopId':_0x1486ec};_0x43e215&&(_0x55353f[_0x109422(0x1ac)]=_0x43e215);const [_0x58d1aa,_0x4ef1a4]=await Promise[_0x109422(0x25e)]([database_1['default'][_0x109422(0x220)][_0x109422(0x1a8)]({'where':_0x55353f,'skip':_0x4951da,'take':_0x492343,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x109422(0x220)]['count']({'where':_0x55353f})]);return{'logs':_0x58d1aa[_0x109422(0x23d)](_0x3ad9a3=>({'id':_0x3ad9a3['id'],'paymentId':_0x3ad9a3['paymentId'],'shopId':_0x3ad9a3[_0x109422(0x18f)],'event':_0x3ad9a3[_0x109422(0x24a)],'statusCode':_0x3ad9a3['statusCode'],'retryCount':_0x3ad9a3['retryCount'],'responseBody':_0x3ad9a3[_0x109422(0x18e)],'createdAt':_0x3ad9a3[_0x109422(0x255)],'payment':_0x3ad9a3[_0x109422(0x19a)]})),'pagination':{'page':_0x3316c5,'limit':_0x492343,'total':_0x4ef1a4,'totalPages':Math[_0x109422(0x1e0)](_0x4ef1a4/_0x492343)}};}async[a86_0x27974e(0x1e3)](_0x712149,_0x385220,_0x10b71b,_0x3dd50a,_0x4b47ba){const _0x2fba54=a86_0x27974e;console['log'](_0x2fba54(0x1b6)+_0x712149+_0x2fba54(0x1d1)+_0x385220+',\x20dateFrom:\x20'+_0x10b71b+_0x2fba54(0x1f8)+_0x3dd50a);const _0x3549c4=_0x4b47ba?new Date(_0x4b47ba):new Date();let _0x5c7cac,_0xf12210;if(_0x10b71b&&_0x3dd50a){const _0x571641=new Date(_0x10b71b),_0x50d5cf=new Date(_0x3dd50a);_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x571641[_0x2fba54(0x240)](),_0x571641[_0x2fba54(0x24f)](),_0x571641[_0x2fba54(0x203)](),0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date[_0x2fba54(0x23e)](_0x50d5cf[_0x2fba54(0x240)](),_0x50d5cf[_0x2fba54(0x24f)](),_0x50d5cf['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console['log']('üìÖ\x20Custom\x20date\x20range:\x20'+_0x5c7cac[_0x2fba54(0x1a4)]()+'\x20to\x20'+_0xf12210[_0x2fba54(0x1a4)]());}else{if(_0x385220&&_0x385220[_0x2fba54(0x205)](_0x2fba54(0x1e6))){const _0x1029fa=_0x385220['replace'](_0x2fba54(0x1e6),'')[_0x2fba54(0x1ed)]('_');if(_0x1029fa['length']===0x2){const _0x2fb081=new Date(_0x1029fa[0x0]),_0x2cf4ea=new Date(_0x1029fa[0x1]);_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x2fb081['getUTCFullYear'](),_0x2fb081[_0x2fba54(0x24f)](),_0x2fb081[_0x2fba54(0x203)](),0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date['UTC'](_0x2cf4ea[_0x2fba54(0x240)](),_0x2cf4ea[_0x2fba54(0x24f)](),_0x2cf4ea[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7)),console[_0x2fba54(0x24b)]('üìÖ\x20Custom\x20period:\x20'+_0x5c7cac[_0x2fba54(0x1a4)]()+_0x2fba54(0x191)+_0xf12210['toISOString']());}else{const _0x218c62=new Date(Date[_0x2fba54(0x23e)](_0x3549c4['getUTCFullYear'](),_0x3549c4[_0x2fba54(0x24f)](),_0x3549c4['getUTCDate']()-0x1e));_0x5c7cac=new Date(Date['UTC'](_0x218c62['getUTCFullYear'](),_0x218c62[_0x2fba54(0x24f)](),_0x218c62[_0x2fba54(0x203)](),0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date['UTC'](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4['getUTCMonth'](),_0x3549c4[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x5da3f3=_0x385220||_0x2fba54(0x184);switch(_0x5da3f3[_0x2fba54(0x1ab)]()){case'today':_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x3549c4['getUTCFullYear'](),_0x3549c4['getUTCMonth'](),_0x3549c4[_0x2fba54(0x203)](),0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date[_0x2fba54(0x23e)](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4[_0x2fba54(0x24f)](),_0x3549c4[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2fba54(0x1c8):const _0x1daf59=new Date(_0x3549c4);_0x1daf59[_0x2fba54(0x1dc)](_0x1daf59[_0x2fba54(0x203)]()-0x1),_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x1daf59[_0x2fba54(0x240)](),_0x1daf59['getUTCMonth'](),_0x1daf59[_0x2fba54(0x203)](),0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date[_0x2fba54(0x23e)](_0x1daf59[_0x2fba54(0x240)](),_0x1daf59[_0x2fba54(0x24f)](),_0x1daf59[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2fba54(0x199):const _0x1b7551=_0x3549c4[_0x2fba54(0x22b)](),_0x5ec88f=_0x1b7551===0x0?-0x6:0x1-_0x1b7551,_0x1e6d5b=_0x3549c4[_0x2fba54(0x203)]()+_0x5ec88f;_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4[_0x2fba54(0x24f)](),_0x1e6d5b,0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date[_0x2fba54(0x23e)](_0x3549c4['getUTCFullYear'](),_0x3549c4[_0x2fba54(0x24f)](),_0x3549c4[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2fba54(0x1d7):const _0x17a2b8=new Date(Date[_0x2fba54(0x23e)](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4['getUTCMonth'](),_0x3549c4[_0x2fba54(0x203)]()-0x7)),_0xab08c=_0x17a2b8[_0x2fba54(0x22b)](),_0xa557b0=_0xab08c===0x0?-0x6:0x1-_0xab08c,_0x190a09=_0x17a2b8[_0x2fba54(0x203)]()+_0xa557b0;_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x17a2b8[_0x2fba54(0x240)](),_0x17a2b8[_0x2fba54(0x24f)](),_0x190a09,0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date[_0x2fba54(0x23e)](_0x17a2b8['getUTCFullYear'](),_0x17a2b8[_0x2fba54(0x24f)](),_0x190a09+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x2fba54(0x184):_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4[_0x2fba54(0x24f)](),0x1,0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date['UTC'](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4[_0x2fba54(0x24f)](),_0x3549c4[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x5c7cac=new Date(Date[_0x2fba54(0x23e)](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4[_0x2fba54(0x24f)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date[_0x2fba54(0x23e)](_0x3549c4['getUTCFullYear'](),_0x3549c4['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2fba54(0x1b9):_0x5c7cac=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date['UTC'](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4[_0x2fba54(0x24f)](),_0x3549c4[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x5c7cac=new Date(Date['UTC'](_0x3549c4['getUTCFullYear'](),_0x3549c4['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0xf12210=new Date(Date[_0x2fba54(0x23e)](_0x3549c4[_0x2fba54(0x240)](),_0x3549c4[_0x2fba54(0x24f)](),_0x3549c4[_0x2fba54(0x203)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x2fba54(0x24b)](_0x2fba54(0x1b3)+_0x5c7cac[_0x2fba54(0x1a4)]()+'\x20to\x20'+_0xf12210[_0x2fba54(0x1a4)]());const _0x456948={'gte':_0x5c7cac,'lte':_0xf12210},[_0x1799bf,_0x4cc0c9,_0x349584,_0x3dc941,_0x189955,_0x204f92,_0x3f63c2,_0x46aee5,_0x25e870,_0x3c3ec5,_0x4c69d8]=await Promise['all']([database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1f0)]({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)},'status':{'notIn':[_0x2fba54(0x24e),_0x2fba54(0x20f)]},'createdAt':_0x456948}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1f0)]({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)},'status':_0x2fba54(0x212),'createdAt':_0x456948}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1f0)]({'where':{'shopId':_0x712149,'gateway':{'not':'test_gateway'},'status':_0x2fba54(0x1df)}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1f0)]({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)},'status':_0x2fba54(0x1d0)}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1a8)]({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)},'status':'PAID','createdAt':_0x456948},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x2fba54(0x1f3)]['payment']['findMany']({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)}},'take':0x4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1a8)]({'where':{'shopId':_0x712149,'gateway':{'not':'test_gateway'},'createdAt':_0x456948},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}}),database_1[_0x2fba54(0x1f3)]['payment'][_0x2fba54(0x1f0)]({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)},'status':_0x2fba54(0x212)}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1a8)]({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)},'status':_0x2fba54(0x212)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x24d)][_0x2fba54(0x1f4)]({'where':{'id':_0x712149},'select':{'balance':!![]}}),database_1[_0x2fba54(0x1f3)][_0x2fba54(0x19a)][_0x2fba54(0x1a8)]({'where':{'shopId':_0x712149,'gateway':{'not':_0x2fba54(0x1ee)}},'select':{'gateway':!![]}})]),_0x3d8752={};for(const _0x6340c7 of _0x4c69d8){_0x6340c7[_0x2fba54(0x1a5)]&&(_0x3d8752[_0x6340c7[_0x2fba54(0x1a5)]]=(_0x3d8752[_0x6340c7[_0x2fba54(0x1a5)]]||0x0)+0x1);}console['log'](_0x2fba54(0x183),_0x3d8752);let _0x40a304=0x0,_0x288600=0x0;for(const _0xebed47 of _0x189955){if(_0xebed47[_0x2fba54(0x238)])_0x40a304+=_0xebed47[_0x2fba54(0x238)];else{const _0x253979=await currencyService_1[_0x2fba54(0x182)][_0x2fba54(0x189)](_0xebed47[_0x2fba54(0x18b)],_0xebed47[_0x2fba54(0x257)]);_0x40a304+=_0x253979;}_0xebed47[_0x2fba54(0x24c)]&&(_0x288600+=_0xebed47[_0x2fba54(0x24c)]);}let _0x39ff3e=0x0;for(const _0x479e25 of _0x25e870){_0x479e25[_0x2fba54(0x24c)]&&(_0x39ff3e+=_0x479e25['amountAfterGatewayCommissionUSDT']);}const _0x3b9d86=this[_0x2fba54(0x201)](_0x3f63c2,_0x5c7cac,_0xf12210||_0x3549c4),_0x200947=_0x1799bf>0x0?_0x4cc0c9/_0x1799bf*0x64:0x0,_0x1906f9=_0x46aee5>0x0?_0x349584/_0x46aee5*0x64:0x0;return{'totalPayments':_0x1799bf,'successfulPayments':_0x4cc0c9,'totalRevenue':Math[_0x2fba54(0x20b)](_0x40a304*0x64)/0x64,'merchantEarnings':Math['round'](_0x288600*0x64)/0x64,'merchantTotalRevenue':Math[_0x2fba54(0x20b)](_0x39ff3e*0x64)/0x64,'payoutBalance':Math[_0x2fba54(0x20b)]((_0x3c3ec5?.[_0x2fba54(0x244)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x2fba54(0x20b)](_0x200947*0x64)/0x64,'chargebackRate':Math[_0x2fba54(0x20b)](_0x1906f9*0x64)/0x64,'chargebacks':_0x349584,'refunds':_0x3dc941,'paymentsByGateway':_0x3d8752,'dailyRevenue':_0x3b9d86['dailyRevenue'],'dailyPayments':_0x3b9d86[_0x2fba54(0x1f7)],'recentPayments':_0x204f92['map'](_0x33fa5d=>({'id':_0x33fa5d['id'],'gateway':_0x33fa5d[_0x2fba54(0x1a5)],'amount':_0x33fa5d[_0x2fba54(0x18b)],'currency':_0x33fa5d[_0x2fba54(0x257)],'status':_0x33fa5d[_0x2fba54(0x1bd)],'createdAt':_0x33fa5d[_0x2fba54(0x255)]}))};}[a86_0x27974e(0x201)](_0x3b0374,_0x38e139,_0x4b72ad){const _0x31243c=a86_0x27974e,_0x4e2e1f=new Map(),_0x59e561=new Date(_0x38e139);while(_0x59e561<=_0x4b72ad){const _0xd41442=_0x59e561[_0x31243c(0x1a4)]()[_0x31243c(0x1ed)]('T')[0x0];_0x4e2e1f[_0x31243c(0x1ff)](_0xd41442,{'revenue':0x0,'count':0x0}),_0x59e561[_0x31243c(0x1b2)](_0x59e561[_0x31243c(0x210)]()+0x1);}for(const _0x486fb7 of _0x3b0374){const _0x4c3476=_0x486fb7[_0x31243c(0x255)]['toISOString']()[_0x31243c(0x1ed)]('T')[0x0],_0x22e01a=_0x4e2e1f[_0x31243c(0x200)](_0x4c3476);_0x22e01a&&(_0x22e01a['count']+=0x1,_0x486fb7[_0x31243c(0x1bd)]==='PAID'&&_0x486fb7[_0x31243c(0x238)]&&(_0x22e01a[_0x31243c(0x188)]+=_0x486fb7[_0x31243c(0x238)]));}const _0x2d853e=[],_0x26c8ad=[];for(const [_0x4922e8,_0x8ad832]of _0x4e2e1f){_0x2d853e[_0x31243c(0x181)]({'date':_0x4922e8,'amount':Math['round'](_0x8ad832[_0x31243c(0x188)]*0x64)/0x64}),_0x26c8ad[_0x31243c(0x181)]({'date':_0x4922e8,'count':_0x8ad832[_0x31243c(0x1f0)]});}return{'dailyRevenue':_0x2d853e,'dailyPayments':_0x26c8ad};}[a86_0x27974e(0x222)](_0x1a3ddb=0x8){const _0x3fbf47=a86_0x27974e,_0x5a8176=[];for(let _0x511fd2=0x0;_0x511fd2<_0x1a3ddb;_0x511fd2++){const _0x11913c=crypto_1[_0x3fbf47(0x1f3)][_0x3fbf47(0x1a3)](0x4)['toString'](_0x3fbf47(0x1ca))[_0x3fbf47(0x1aa)]();_0x5a8176[_0x3fbf47(0x181)](_0x11913c);}return _0x5a8176;}async[a86_0x27974e(0x227)](_0x5d023d){const _0x4dc402=a86_0x27974e,_0x2621b8=await database_1['default'][_0x4dc402(0x24d)][_0x4dc402(0x1f4)]({'where':{'id':_0x5d023d},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2621b8)throw new Error(_0x4dc402(0x1a1));const _0x2f1c29=speakeasy_1[_0x4dc402(0x1f3)][_0x4dc402(0x260)]({'name':_0x4dc402(0x21d)+_0x2621b8[_0x4dc402(0x22f)]+')','issuer':'TrapaPay','length':0x20}),_0x2abf85=await qrcode_1[_0x4dc402(0x1f3)]['toDataURL'](_0x2f1c29[_0x4dc402(0x194)]),_0x47ef29=this[_0x4dc402(0x222)](0x8),_0xce68f5=await Promise[_0x4dc402(0x25e)](_0x47ef29['map'](_0x55f980=>bcryptjs_1[_0x4dc402(0x1f3)][_0x4dc402(0x261)](_0x55f980,0xa)));return await database_1['default'][_0x4dc402(0x24d)][_0x4dc402(0x21c)]({'where':{'id':_0x5d023d},'data':{'twoFactorSecret':_0x2f1c29[_0x4dc402(0x207)],'backupCodes':JSON[_0x4dc402(0x19e)](_0xce68f5)}}),console[_0x4dc402(0x24b)]('üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x2621b8[_0x4dc402(0x22f)]),console[_0x4dc402(0x24b)](_0x4dc402(0x193)+_0x47ef29[_0x4dc402(0x21e)]+_0x4dc402(0x1e5)),{'secret':_0x2f1c29[_0x4dc402(0x207)],'qrCode':_0x2abf85,'manualEntryKey':_0x2f1c29['base32'],'backupCodes':_0x47ef29};}async[a86_0x27974e(0x242)](_0x3099df,_0x1f5ff4){const _0x1969e2=a86_0x27974e,_0xd70e65=await database_1[_0x1969e2(0x1f3)][_0x1969e2(0x24d)][_0x1969e2(0x1f4)]({'where':{'id':_0x3099df},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0xd70e65)throw new Error(_0x1969e2(0x1a1));if(!_0xd70e65[_0x1969e2(0x214)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0xd70e65[_0x1969e2(0x1ef)])throw new Error(_0x1969e2(0x1fe));const _0x34a03c=speakeasy_1[_0x1969e2(0x1f3)][_0x1969e2(0x198)]['verify']({'secret':_0xd70e65[_0x1969e2(0x214)],'encoding':_0x1969e2(0x207),'token':_0x1f5ff4,'window':0x2});if(!_0x34a03c)throw new Error(_0x1969e2(0x21b));return await database_1[_0x1969e2(0x1f3)][_0x1969e2(0x24d)]['update']({'where':{'id':_0x3099df},'data':{'twoFactorEnabled':!![]}}),console[_0x1969e2(0x24b)](_0x1969e2(0x218)+_0xd70e65[_0x1969e2(0x22f)]),{'enabled':!![]};}async[a86_0x27974e(0x1bb)](_0x23ed55){const _0x5953fe=a86_0x27974e,_0x2bc362=await database_1[_0x5953fe(0x1f3)][_0x5953fe(0x24d)][_0x5953fe(0x1f4)]({'where':{'id':_0x23ed55},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2bc362)throw new Error(_0x5953fe(0x1a1));await database_1[_0x5953fe(0x1f3)]['shop'][_0x5953fe(0x21c)]({'where':{'id':_0x23ed55},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x5953fe(0x24b)](_0x5953fe(0x1de)+_0x2bc362[_0x5953fe(0x22f)]);}}function a86_0x235b(_0x3830e9,_0x3f11a7){_0x3830e9=_0x3830e9-0x181;const _0x58eb76=a86_0x58eb();let _0x235be6=_0x58eb76[_0x3830e9];return _0x235be6;}exports[a86_0x27974e(0x20c)]=ShopService;