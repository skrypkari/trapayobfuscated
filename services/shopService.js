'use strict';const a51_0x165283=a51_0x4f08;(function(_0x519833,_0xaf3dd5){const _0x860401=a51_0x4f08,_0xdf339f=_0x519833();while(!![]){try{const _0x569bec=-parseInt(_0x860401(0x129))/0x1*(parseInt(_0x860401(0xbe))/0x2)+-parseInt(_0x860401(0xa7))/0x3*(-parseInt(_0x860401(0x117))/0x4)+parseInt(_0x860401(0x109))/0x5+parseInt(_0x860401(0xcd))/0x6*(-parseInt(_0x860401(0xd9))/0x7)+-parseInt(_0x860401(0xf0))/0x8*(-parseInt(_0x860401(0x130))/0x9)+parseInt(_0x860401(0xb2))/0xa+parseInt(_0x860401(0x115))/0xb;if(_0x569bec===_0xaf3dd5)break;else _0xdf339f['push'](_0xdf339f['shift']());}catch(_0x252426){_0xdf339f['push'](_0xdf339f['shift']());}}}(a51_0x4b89,0xc55da));function a51_0x4b89(){const _0x1f7e22=['parse','getStatistics','22264HjWsJb','defineProperty','\x20gateway\x20settings:','shop','error','getPayoutById','Rapyd','usdtErcWallet','Plisio','updateShopProfile','\x20paid\x20payments\x20for\x20shop\x20','customer','maxPayments','merchantPaid','shopId','username','getWebhookLogs','fullName','test_gateway','PAID',',\x20commission:\x20','webhookEvents','getShopProfile','Test\x20webhook\x20sent\x20successfully\x20(','test','5558740lsTwdH','convertToUSDT','event','round','Shop\x20not\x20found','./paymentService','getFullYear','usage','Test\x20Gateway','redirectUrl','KLYME\x20EU','30d','8914829XLJTQq','isArray','1724jLngNU','getGatewayDisplayName','POST','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','\x20USDT,\x20merchantPaid:\x20','findUnique','KLYME\x20DE','\x20\x20\x20üìÖ\x20This\x20month:\x20','...','thisMonth','amount','findMany','gatewaySettings','testWebhook','paymentId','Noda','getMonth','Payment\x20not\x20found','1wFPpTi','getShopPayoutStats','Error\x20processing\x20payment\x20','network','\x20USDT','currencyService','payout','207fnWSeH','stringify','PaymentService','getPayoutStatistics','ceil','expiresAt','log','status','map','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','update','toISOString','shopUrl','Webhook\x20returned\x20error:\x20','2931xudjdU','retryCount','__esModule','Error\x20parsing\x20webhook\x20events:','reduce','merchantUrl','amountIsEditable','webhookUrl','default','txid','Error\x20parsing\x20gateway\x20settings:','9043570NREXvb','telegram','usdcPolygonWallet','paid','getPayoutStats','language','all','deletePayment','findFirst','length','application/json','availableBalance','1790102QWjiCr','usdtPolygonWallet','settings','delete','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','üí∞\x20Found\x20','getTime','notes','USD','90d','name','publicKey','country','payment','desc','507846Jeqnzs','statusCode','paidAt','\x20\x20\x20üíµ\x20Available\x20balance:\x20','Failed\x20to\x20send\x20webhook:\x20','currency','KLYME\x20GB','createdAt','message','gateway','wallets','Unknown\x20error','133iFUCzO','paymentGateways','filter','usdtTrcWallet','statusText','updateWallets','count','createPayment','getPaymentById','./currencyService','test_payment_123','commission','getPaymentsByShop','responseBody','getPayouts','paymentService','gateways','COMPLETED','toFixed','webhookLog','\x20USDT\x20(after\x20commission)'];a51_0x4b89=function(){return _0x1f7e22;};return a51_0x4b89();}var __importDefault=this&&this['__importDefault']||function(_0x1c8318){const _0x5a603d=a51_0x4f08;return _0x1c8318&&_0x1c8318[_0x5a603d(0xa9)]?_0x1c8318:{'default':_0x1c8318};};Object[a51_0x165283(0xf1)](exports,a51_0x165283(0xa9),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a51_0x165283(0xe2)),paymentService_1=require(a51_0x165283(0x10e));function a51_0x4f08(_0x5b59da,_0x551980){const _0x4b891e=a51_0x4b89();return a51_0x4f08=function(_0x4f08ce,_0xe3baf){_0x4f08ce=_0x4f08ce-0xa3;let _0x32b9d5=_0x4b891e[_0x4f08ce];return _0x32b9d5;},a51_0x4f08(_0x5b59da,_0x551980);}class ShopService{constructor(){const _0x5180e9=a51_0x165283;this[_0x5180e9(0xe8)]=new paymentService_1[(_0x5180e9(0x132))]();}async[a51_0x165283(0x106)](_0xa32131){const _0xd3f5bf=a51_0x165283,_0x21c2fd=await database_1[_0xd3f5bf(0xaf)]['shop'][_0xd3f5bf(0x11c)]({'where':{'id':_0xa32131},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x21c2fd)throw new Error(_0xd3f5bf(0x10d));let _0x361924=[];if(_0x21c2fd[_0xd3f5bf(0xc0)]?.[_0xd3f5bf(0x105)])try{_0x361924=Array['isArray'](_0x21c2fd[_0xd3f5bf(0xc0)][_0xd3f5bf(0x105)])?_0x21c2fd[_0xd3f5bf(0xc0)][_0xd3f5bf(0x105)]:JSON[_0xd3f5bf(0xee)](_0x21c2fd[_0xd3f5bf(0xc0)]['webhookEvents']);}catch(_0x493c35){console[_0xd3f5bf(0xf4)](_0xd3f5bf(0xaa),_0x493c35),_0x361924=[];}return{'id':_0x21c2fd['id'],'fullName':_0x21c2fd[_0xd3f5bf(0xc8)],'username':_0x21c2fd[_0xd3f5bf(0xff)],'telegramId':_0x21c2fd[_0xd3f5bf(0xb3)],'merchantUrl':_0x21c2fd['shopUrl'],'gateways':_0x21c2fd[_0xd3f5bf(0xda)]?JSON['parse'](_0x21c2fd[_0xd3f5bf(0xda)]):null,'gatewaySettings':_0x21c2fd[_0xd3f5bf(0x123)]?JSON[_0xd3f5bf(0xee)](_0x21c2fd[_0xd3f5bf(0x123)]):null,'publicKey':_0x21c2fd[_0xd3f5bf(0xc9)],'webhookUrl':_0x21c2fd['settings']?.[_0xd3f5bf(0xae)]||null,'webhookEvents':_0x361924,'wallets':{'usdtPolygonWallet':_0x21c2fd[_0xd3f5bf(0xbf)],'usdtTrcWallet':_0x21c2fd[_0xd3f5bf(0xdc)],'usdtErcWallet':_0x21c2fd[_0xd3f5bf(0xf7)],'usdcPolygonWallet':_0x21c2fd[_0xd3f5bf(0xb4)]},'status':_0x21c2fd[_0xd3f5bf(0x137)],'createdAt':_0x21c2fd[_0xd3f5bf(0xd4)]};}async[a51_0x165283(0xf9)](_0x53806e,_0x4540bc){const _0x5078fe=a51_0x165283,_0x1f8819={};_0x4540bc[_0x5078fe(0x101)]&&(_0x1f8819['name']=_0x4540bc[_0x5078fe(0x101)]);_0x4540bc['telegramId']!==undefined&&(_0x1f8819[_0x5078fe(0xb3)]=_0x4540bc['telegramId']||null);_0x4540bc[_0x5078fe(0xac)]&&(_0x1f8819[_0x5078fe(0xa5)]=_0x4540bc['merchantUrl']);_0x4540bc[_0x5078fe(0xe9)]&&(_0x1f8819[_0x5078fe(0xda)]=JSON[_0x5078fe(0x131)](_0x4540bc['gateways']));_0x4540bc[_0x5078fe(0x123)]&&(_0x1f8819[_0x5078fe(0x123)]=JSON[_0x5078fe(0x131)](_0x4540bc[_0x5078fe(0x123)]));_0x4540bc[_0x5078fe(0xd7)]&&(_0x4540bc[_0x5078fe(0xd7)][_0x5078fe(0xbf)]!==undefined&&(_0x1f8819['usdtPolygonWallet']=_0x4540bc[_0x5078fe(0xd7)][_0x5078fe(0xbf)]||null),_0x4540bc[_0x5078fe(0xd7)]['usdtTrcWallet']!==undefined&&(_0x1f8819[_0x5078fe(0xdc)]=_0x4540bc[_0x5078fe(0xd7)][_0x5078fe(0xdc)]||null),_0x4540bc[_0x5078fe(0xd7)][_0x5078fe(0xf7)]!==undefined&&(_0x1f8819[_0x5078fe(0xf7)]=_0x4540bc[_0x5078fe(0xd7)][_0x5078fe(0xf7)]||null),_0x4540bc[_0x5078fe(0xd7)]['usdcPolygonWallet']!==undefined&&(_0x1f8819['usdcPolygonWallet']=_0x4540bc['wallets'][_0x5078fe(0xb4)]||null));const _0x444611=await database_1['default'][_0x5078fe(0xf3)][_0x5078fe(0xa3)]({'where':{'id':_0x53806e},'data':_0x1f8819,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x4b1331=[];if(_0x444611['settings']?.[_0x5078fe(0x105)])try{_0x4b1331=Array[_0x5078fe(0x116)](_0x444611[_0x5078fe(0xc0)]['webhookEvents'])?_0x444611[_0x5078fe(0xc0)][_0x5078fe(0x105)]:JSON[_0x5078fe(0xee)](_0x444611[_0x5078fe(0xc0)][_0x5078fe(0x105)]);}catch(_0x185cb1){console[_0x5078fe(0xf4)]('Error\x20parsing\x20webhook\x20events:',_0x185cb1),_0x4b1331=[];}return{'id':_0x444611['id'],'fullName':_0x444611[_0x5078fe(0xc8)],'username':_0x444611[_0x5078fe(0xff)],'telegramId':_0x444611['telegram'],'merchantUrl':_0x444611[_0x5078fe(0xa5)],'gateways':_0x444611[_0x5078fe(0xda)]?JSON['parse'](_0x444611[_0x5078fe(0xda)]):null,'gatewaySettings':_0x444611[_0x5078fe(0x123)]?JSON[_0x5078fe(0xee)](_0x444611['gatewaySettings']):null,'publicKey':_0x444611[_0x5078fe(0xc9)],'webhookUrl':_0x444611[_0x5078fe(0xc0)]?.[_0x5078fe(0xae)]||null,'webhookEvents':_0x4b1331,'wallets':{'usdtPolygonWallet':_0x444611[_0x5078fe(0xbf)],'usdtTrcWallet':_0x444611[_0x5078fe(0xdc)],'usdtErcWallet':_0x444611[_0x5078fe(0xf7)],'usdcPolygonWallet':_0x444611[_0x5078fe(0xb4)]},'status':_0x444611['status'],'createdAt':_0x444611[_0x5078fe(0xd4)]};}async[a51_0x165283(0xde)](_0x445f93,_0x2cebab){const _0xa0d82f=a51_0x165283,_0x157453={};_0x2cebab[_0xa0d82f(0xbf)]!==undefined&&(_0x157453[_0xa0d82f(0xbf)]=_0x2cebab[_0xa0d82f(0xbf)]||null),_0x2cebab[_0xa0d82f(0xdc)]!==undefined&&(_0x157453['usdtTrcWallet']=_0x2cebab[_0xa0d82f(0xdc)]||null),_0x2cebab[_0xa0d82f(0xf7)]!==undefined&&(_0x157453[_0xa0d82f(0xf7)]=_0x2cebab[_0xa0d82f(0xf7)]||null),_0x2cebab[_0xa0d82f(0xb4)]!==undefined&&(_0x157453[_0xa0d82f(0xb4)]=_0x2cebab['usdcPolygonWallet']||null),await database_1['default']['shop'][_0xa0d82f(0xa3)]({'where':{'id':_0x445f93},'data':_0x157453});}async[a51_0x165283(0x124)](_0x596aa4){const _0x1e0fc4=a51_0x165283,_0x7984a3=await database_1[_0x1e0fc4(0xaf)][_0x1e0fc4(0xf3)][_0x1e0fc4(0x11c)]({'where':{'id':_0x596aa4},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x7984a3?.[_0x1e0fc4(0xc0)]?.[_0x1e0fc4(0xae)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x1623cf={'event':_0x1e0fc4(0x108),'payment':{'id':_0x1e0fc4(0xe3),'order_id':'test_order_123','gateway':_0x1e0fc4(0x108),'amount':0x64,'currency':_0x1e0fc4(0xc6),'status':_0x1e0fc4(0xb5),'created_at':new Date()[_0x1e0fc4(0xa4)]()}};try{const _0x2bf946=await fetch(_0x7984a3[_0x1e0fc4(0xc0)]['webhookUrl'],{'method':_0x1e0fc4(0x119),'headers':{'Content-Type':_0x1e0fc4(0xbc),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x1e0fc4(0x131)](_0x1623cf)});return _0x2bf946['ok']?{'success':!![],'message':_0x1e0fc4(0x107)+_0x2bf946[_0x1e0fc4(0x137)]+')'}:{'success':![],'message':_0x1e0fc4(0xa6)+_0x2bf946[_0x1e0fc4(0x137)]+'\x20'+_0x2bf946[_0x1e0fc4(0xdd)]};}catch(_0x46be90){return{'success':![],'message':_0x1e0fc4(0xd1)+(_0x46be90 instanceof Error?_0x46be90[_0x1e0fc4(0xd5)]:_0x1e0fc4(0xd8))};}}async[a51_0x165283(0xe0)](_0x41c9dc){const _0x43af0d=a51_0x165283;return this[_0x43af0d(0xe8)]['createPublicPayment']({'public_key':'','gateway':_0x41c9dc[_0x43af0d(0xd6)],'order_id':undefined,'amount':_0x41c9dc[_0x43af0d(0x121)],'currency':_0x41c9dc['currency'],'source_currency':_0x41c9dc['sourceCurrency'],'usage':_0x41c9dc[_0x43af0d(0x110)],'expires_at':_0x41c9dc[_0x43af0d(0x135)]?.[_0x43af0d(0xa4)](),'success_url':_0x41c9dc[_0x43af0d(0x112)],'fail_url':_0x41c9dc[_0x43af0d(0x112)],'customer_email':_0x41c9dc['customerEmail'],'customer_name':_0x41c9dc['customerName'],'country':_0x41c9dc[_0x43af0d(0xca)],'language':_0x41c9dc[_0x43af0d(0xb7)],'amount_is_editable':_0x41c9dc[_0x43af0d(0xad)],'max_payments':_0x41c9dc[_0x43af0d(0xfc)],'customer':_0x41c9dc[_0x43af0d(0xfb)]});}async['getPayments'](_0x294f98,_0x1ffd15){const _0x17c570=a51_0x165283;return this[_0x17c570(0xe8)][_0x17c570(0xe5)](_0x294f98,_0x1ffd15);}async[a51_0x165283(0xe1)](_0xd1c5c6,_0x5a6cf6){const _0x3a3edb=a51_0x165283;return this[_0x3a3edb(0xe8)]['getPaymentByShopAndId'](_0xd1c5c6,_0x5a6cf6);}async['updatePayment'](_0x3ba86a,_0x294bf1,_0x1c10ca){const _0x2ea99d=a51_0x165283,_0x57699f=await database_1[_0x2ea99d(0xaf)][_0x2ea99d(0xcb)][_0x2ea99d(0xba)]({'where':{'id':_0x294bf1,'shopId':_0x3ba86a}});if(!_0x57699f)throw new Error('Payment\x20not\x20found');const _0x550309=await database_1[_0x2ea99d(0xaf)][_0x2ea99d(0xcb)][_0x2ea99d(0xa3)]({'where':{'id':_0x294bf1},'data':{..._0x1c10ca,'updatedAt':new Date()}});return _0x550309;}async[a51_0x165283(0xb9)](_0x381d89,_0x534670){const _0x30f101=a51_0x165283,_0x18d759=await database_1[_0x30f101(0xaf)][_0x30f101(0xcb)][_0x30f101(0xba)]({'where':{'id':_0x534670,'shopId':_0x381d89}});if(!_0x18d759)throw new Error(_0x30f101(0x128));await database_1['default'][_0x30f101(0xcb)][_0x30f101(0xc1)]({'where':{'id':_0x534670}});}async[a51_0x165283(0xe7)](_0x5e5909,_0x31c95e){const _0x20cf3b=a51_0x165283,{page:_0x2ae2c4,limit:_0x3f3421,status:_0x52416c,method:_0x3fe37b,dateFrom:_0x58259d,dateTo:_0x2595be}=_0x31c95e,_0xef86d=(_0x2ae2c4-0x1)*_0x3f3421,_0x4c5af0={'shopId':_0x5e5909};_0x52416c&&(_0x4c5af0[_0x20cf3b(0x137)]=_0x52416c['toUpperCase']());_0x3fe37b&&(_0x4c5af0['network']=_0x3fe37b);(_0x58259d||_0x2595be)&&(_0x4c5af0[_0x20cf3b(0xd4)]={},_0x58259d&&(_0x4c5af0[_0x20cf3b(0xd4)]['gte']=new Date(_0x58259d)),_0x2595be&&(_0x4c5af0[_0x20cf3b(0xd4)]['lte']=new Date(_0x2595be)));const [_0x15b9d8,_0x3540c3]=await Promise[_0x20cf3b(0xb8)]([database_1[_0x20cf3b(0xaf)][_0x20cf3b(0x12f)][_0x20cf3b(0x122)]({'where':_0x4c5af0,'skip':_0xef86d,'take':_0x3f3421,'orderBy':{'createdAt':_0x20cf3b(0xcc)}}),database_1[_0x20cf3b(0xaf)]['payout']['count']({'where':_0x4c5af0})]);return{'payouts':_0x15b9d8[_0x20cf3b(0x138)](_0x2157b2=>({'id':_0x2157b2['id'],'amount':_0x2157b2[_0x20cf3b(0x121)],'network':_0x2157b2['network'],'status':_0x2157b2[_0x20cf3b(0x137)],'txid':_0x2157b2[_0x20cf3b(0xb0)],'notes':_0x2157b2[_0x20cf3b(0xc5)],'createdAt':_0x2157b2[_0x20cf3b(0xd4)],'paidAt':_0x2157b2[_0x20cf3b(0xcf)]})),'pagination':{'page':_0x2ae2c4,'limit':_0x3f3421,'total':_0x3540c3,'totalPages':Math['ceil'](_0x3540c3/_0x3f3421)}};}async[a51_0x165283(0xf5)](_0xe0a6ee,_0x2999c7){const _0x24132f=a51_0x165283,_0x3040a5=await database_1['default'][_0x24132f(0x12f)]['findFirst']({'where':{'id':_0x2999c7,'shopId':_0xe0a6ee}});if(!_0x3040a5)return null;return{'id':_0x3040a5['id'],'amount':_0x3040a5[_0x24132f(0x121)],'network':_0x3040a5[_0x24132f(0x12c)],'status':_0x3040a5[_0x24132f(0x137)],'txid':_0x3040a5[_0x24132f(0xb0)],'notes':_0x3040a5['notes'],'createdAt':_0x3040a5[_0x24132f(0xd4)],'paidAt':_0x3040a5[_0x24132f(0xcf)]};}async[a51_0x165283(0x133)](_0x15ae2e,_0x1dceb6){const _0x19ea22=a51_0x165283,_0x3e233e=new Date();let _0x3da0eb;switch(_0x1dceb6){case'7d':_0x3da0eb=new Date(_0x3e233e[_0x19ea22(0xc4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x3da0eb=new Date(_0x3e233e['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x19ea22(0xc7):_0x3da0eb=new Date(_0x3e233e[_0x19ea22(0xc4)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x3da0eb=new Date(_0x3e233e['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4a6765,_0x1ef7ba,_0x339c35,_0x1741c6,_0x5daf23,_0x38204b]=await Promise[_0x19ea22(0xb8)]([database_1[_0x19ea22(0xaf)][_0x19ea22(0x12f)][_0x19ea22(0xdf)]({'where':{'shopId':_0x15ae2e,'createdAt':{'gte':_0x3da0eb}}}),database_1[_0x19ea22(0xaf)][_0x19ea22(0x12f)][_0x19ea22(0xdf)]({'where':{'shopId':_0x15ae2e,'status':'COMPLETED','createdAt':{'gte':_0x3da0eb}}}),database_1['default'][_0x19ea22(0x12f)]['count']({'where':{'shopId':_0x15ae2e,'status':'PENDING','createdAt':{'gte':_0x3da0eb}}}),database_1[_0x19ea22(0xaf)][_0x19ea22(0x12f)][_0x19ea22(0xdf)]({'where':{'shopId':_0x15ae2e,'status':'REJECTED','createdAt':{'gte':_0x3da0eb}}}),database_1[_0x19ea22(0xaf)][_0x19ea22(0x12f)]['findMany']({'where':{'shopId':_0x15ae2e,'createdAt':{'gte':_0x3da0eb}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x19ea22(0x12f)]['findMany']({'where':{'shopId':_0x15ae2e},'take':0xa,'orderBy':{'createdAt':_0x19ea22(0xcc)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x4075c2=_0x5daf23[_0x19ea22(0xab)]((_0x3a1607,_0xda24f1)=>_0x3a1607+_0xda24f1[_0x19ea22(0x121)],0x0),_0x236dfc=_0x5daf23[_0x19ea22(0xdb)](_0x6771c7=>_0x6771c7['status']===_0x19ea22(0xea))[_0x19ea22(0xab)]((_0x6cdb2e,_0x59f274)=>_0x6cdb2e+_0x59f274['amount'],0x0),_0x511ba9=_0x5daf23['filter'](_0xbd7833=>_0xbd7833[_0x19ea22(0x137)]==='PENDING')[_0x19ea22(0xab)]((_0x2b0bb1,_0x2860d4)=>_0x2b0bb1+_0x2860d4[_0x19ea22(0x121)],0x0),_0x5f2c16=_0x5daf23[_0x19ea22(0xab)]((_0x1f477e,_0x316a3a)=>{return _0x1f477e[_0x316a3a['network']]=(_0x1f477e[_0x316a3a['network']]||0x0)+0x1,_0x1f477e;},{}),_0x5065b1=_0x5daf23['reduce']((_0x7c9c95,_0x48767e)=>{const _0x40562a=_0x19ea22;return _0x7c9c95[_0x48767e[_0x40562a(0x137)]]=(_0x7c9c95[_0x48767e[_0x40562a(0x137)]]||0x0)+0x1,_0x7c9c95;},{});return{'totalPayouts':_0x4a6765,'completedPayouts':_0x1ef7ba,'pendingPayouts':_0x339c35,'rejectedPayouts':_0x1741c6,'totalAmount':_0x4075c2,'completedAmount':_0x236dfc,'pendingAmount':_0x511ba9,'payoutsByMethod':_0x5f2c16,'payoutsByStatus':_0x5065b1,'recentPayouts':_0x38204b[_0x19ea22(0x138)](_0x31209a=>({'id':_0x31209a['id'],'shopId':_0x15ae2e,'amount':_0x31209a[_0x19ea22(0x121)],'method':_0x31209a[_0x19ea22(0x12c)],'status':_0x31209a[_0x19ea22(0x137)],'txid':_0x31209a[_0x19ea22(0xb0)],'createdAt':_0x31209a[_0x19ea22(0xd4)],'paidAt':_0x31209a[_0x19ea22(0xcf)]}))};}async[a51_0x165283(0x12a)](_0x2ead0a){const _0x37354b=a51_0x165283;console[_0x37354b(0x136)](_0x37354b(0xc2)+_0x2ead0a+_0x37354b(0x11f));const _0xdd5021=await database_1[_0x37354b(0xaf)]['shop'][_0x37354b(0x11c)]({'where':{'id':_0x2ead0a},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});if(!_0xdd5021)throw new Error(_0x37354b(0x10d));let _0x400d4b={};if(_0xdd5021[_0x37354b(0x123)])try{_0x400d4b=JSON['parse'](_0xdd5021[_0x37354b(0x123)]),console[_0x37354b(0x136)]('üìä\x20Shop\x20'+_0xdd5021['username']+_0x37354b(0xf2),_0x400d4b);}catch(_0x1dd46d){console[_0x37354b(0xf4)](_0x37354b(0xb1),_0x1dd46d),_0x400d4b={};}const _0x2a6219=await database_1['default'][_0x37354b(0xcb)][_0x37354b(0x122)]({'where':{'shopId':_0x2ead0a,'status':_0x37354b(0x103),'gateway':{'not':_0x37354b(0x102)},'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![]}});console[_0x37354b(0x136)](_0x37354b(0xc3)+_0x2a6219[_0x37354b(0xbb)]+_0x37354b(0xfa)+_0xdd5021[_0x37354b(0xff)]);let _0x49fd66=0x0,_0x1c70c2=0x0,_0x2ee574=0x0;for(const _0x50fd1c of _0x2a6219){try{const _0x5ca827=await currencyService_1[_0x37354b(0x12e)][_0x37354b(0x10a)](_0x50fd1c[_0x37354b(0x121)],_0x50fd1c['currency']),_0x1058b5=this[_0x37354b(0x118)](_0x50fd1c[_0x37354b(0xd6)]),_0x448b5a=_0x400d4b[_0x1058b5],_0x245ea8=_0x448b5a?.[_0x37354b(0xe4)]||0xa,_0x377ec7=_0x5ca827*(0x1-_0x245ea8/0x64);console[_0x37354b(0x136)]('üí∞\x20Payment\x20'+_0x50fd1c['id']+':\x20'+_0x5ca827[_0x37354b(0xeb)](0x2)+'\x20USDT,\x20gateway:\x20'+_0x1058b5+_0x37354b(0x104)+_0x245ea8+'%,\x20after\x20commission:\x20'+_0x377ec7[_0x37354b(0xeb)](0x2)+_0x37354b(0x11b)+_0x50fd1c[_0x37354b(0xfd)]),_0x50fd1c[_0x37354b(0xfd)]?_0x49fd66+=_0x377ec7:(_0x1c70c2+=_0x5ca827,_0x2ee574+=_0x377ec7);}catch(_0x2fb062){console[_0x37354b(0xf4)](_0x37354b(0x12b)+_0x50fd1c['id']+':',_0x2fb062);}}const _0x5521da=new Date(),_0x4b1d5f=new Date(_0x5521da[_0x37354b(0x10f)](),_0x5521da['getMonth'](),0x1),_0x363991=new Date(_0x5521da[_0x37354b(0x10f)](),_0x5521da[_0x37354b(0x127)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2f5842=await database_1[_0x37354b(0xaf)][_0x37354b(0x12f)][_0x37354b(0x122)]({'where':{'shopId':_0x2ead0a,'createdAt':{'gte':_0x4b1d5f,'lte':_0x363991},'status':'COMPLETED'},'select':{'amount':!![]}}),_0x315ffe=_0x2f5842[_0x37354b(0xab)]((_0x41a964,_0x590b1d)=>_0x41a964+_0x590b1d[_0x37354b(0x121)],0x0),_0x29d317={'availableBalance':Math[_0x37354b(0x10c)](_0x1c70c2*0x64)/0x64,'totalPaidOut':Math[_0x37354b(0x10c)](_0x49fd66*0x64)/0x64,'awaitingPayout':Math['round'](_0x2ee574*0x64)/0x64,'thisMonth':Math[_0x37354b(0x10c)](_0x315ffe*0x64)/0x64};return console[_0x37354b(0x136)]('üìä\x20Shop\x20'+_0xdd5021[_0x37354b(0xff)]+'\x20payout\x20statistics\x20calculated:'),console[_0x37354b(0x136)](_0x37354b(0xd0)+_0x29d317[_0x37354b(0xbd)]+'\x20USDT\x20(before\x20commission)'),console['log'](_0x37354b(0x139)+_0x29d317['totalPaidOut']+_0x37354b(0xed)),console[_0x37354b(0x136)](_0x37354b(0x11a)+_0x29d317['awaitingPayout']+'\x20USDT\x20(after\x20commission)'),console[_0x37354b(0x136)](_0x37354b(0x11e)+_0x29d317[_0x37354b(0x120)]+_0x37354b(0x12d)),_0x29d317;}[a51_0x165283(0x118)](_0x595f67){const _0x22a5b7=a51_0x165283,_0x36f991={'test_gateway':_0x22a5b7(0x111),'plisio':_0x22a5b7(0xf8),'rapyd':_0x22a5b7(0xf6),'noda':_0x22a5b7(0x126),'cointopay':'CoinToPay','klyme_eu':_0x22a5b7(0x113),'klyme_gb':_0x22a5b7(0xd3),'klyme_de':_0x22a5b7(0x11d)};return _0x36f991[_0x595f67]||_0x595f67;}async[a51_0x165283(0xb6)](_0x32d78e){const _0x3ff2cf=a51_0x165283;return this[_0x3ff2cf(0x12a)](_0x32d78e);}async[a51_0x165283(0x100)](_0x3ca9a0,_0x4db2f1){const _0x46ad42=a51_0x165283,{page:_0x439225,limit:_0x1c780c,paymentId:_0x5bd691}=_0x4db2f1,_0x1210bd=(_0x439225-0x1)*_0x1c780c,_0x20d87e={'shopId':_0x3ca9a0};_0x5bd691&&(_0x20d87e[_0x46ad42(0x125)]=_0x5bd691);const [_0x30ab17,_0x59328d]=await Promise[_0x46ad42(0xb8)]([database_1[_0x46ad42(0xaf)][_0x46ad42(0xec)][_0x46ad42(0x122)]({'where':_0x20d87e,'skip':_0x1210bd,'take':_0x1c780c,'orderBy':{'createdAt':_0x46ad42(0xcc)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x46ad42(0xaf)][_0x46ad42(0xec)][_0x46ad42(0xdf)]({'where':_0x20d87e})]);return{'logs':_0x30ab17[_0x46ad42(0x138)](_0x55ae28=>({'id':_0x55ae28['id'],'paymentId':_0x55ae28[_0x46ad42(0x125)],'shopId':_0x55ae28[_0x46ad42(0xfe)],'event':_0x55ae28[_0x46ad42(0x10b)],'statusCode':_0x55ae28[_0x46ad42(0xce)],'retryCount':_0x55ae28[_0x46ad42(0xa8)],'responseBody':_0x55ae28[_0x46ad42(0xe6)],'createdAt':_0x55ae28[_0x46ad42(0xd4)],'payment':_0x55ae28[_0x46ad42(0xcb)]})),'pagination':{'page':_0x439225,'limit':_0x1c780c,'total':_0x59328d,'totalPages':Math[_0x46ad42(0x134)](_0x59328d/_0x1c780c)}};}async[a51_0x165283(0xef)](_0x5a2f03,_0x3e1ff3){const _0x2ecf5c=a51_0x165283,_0x3524c0=new Date();let _0x16c998;switch(_0x3e1ff3){case'7d':_0x16c998=new Date(_0x3524c0[_0x2ecf5c(0xc4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2ecf5c(0x114):_0x16c998=new Date(_0x3524c0[_0x2ecf5c(0xc4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2ecf5c(0xc7):_0x16c998=new Date(_0x3524c0[_0x2ecf5c(0xc4)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x16c998=new Date(_0x3524c0[_0x2ecf5c(0xc4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4e7093,_0x2eee08,_0x227919,_0x5b22a1]=await Promise[_0x2ecf5c(0xb8)]([database_1['default']['payment'][_0x2ecf5c(0xdf)]({'where':{'shopId':_0x5a2f03,'createdAt':{'gte':_0x16c998}}}),database_1['default'][_0x2ecf5c(0xcb)][_0x2ecf5c(0xdf)]({'where':{'shopId':_0x5a2f03,'status':'PAID','createdAt':{'gte':_0x16c998}}}),database_1[_0x2ecf5c(0xaf)]['payment'][_0x2ecf5c(0x122)]({'where':{'shopId':_0x5a2f03,'status':'PAID','createdAt':{'gte':_0x16c998}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x2ecf5c(0xcb)][_0x2ecf5c(0x122)]({'where':{'shopId':_0x5a2f03},'take':0xa,'orderBy':{'createdAt':_0x2ecf5c(0xcc)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}})]);let _0x55a780=0x0;for(const _0x23c7bc of _0x227919){const _0xafb6f=await currencyService_1[_0x2ecf5c(0x12e)][_0x2ecf5c(0x10a)](_0x23c7bc[_0x2ecf5c(0x121)],_0x23c7bc[_0x2ecf5c(0xd2)]);_0x55a780+=_0xafb6f;}const _0x564155=_0x4e7093>0x0?_0x2eee08/_0x4e7093*0x64:0x0;return{'totalPayments':_0x4e7093,'successfulPayments':_0x2eee08,'totalRevenue':Math[_0x2ecf5c(0x10c)](_0x55a780*0x64)/0x64,'conversionRate':Math[_0x2ecf5c(0x10c)](_0x564155*0x64)/0x64,'recentPayments':_0x5b22a1[_0x2ecf5c(0x138)](_0x4b203f=>({'id':_0x4b203f['id'],'gateway':_0x4b203f[_0x2ecf5c(0xd6)],'amount':_0x4b203f[_0x2ecf5c(0x121)],'currency':_0x4b203f[_0x2ecf5c(0xd2)],'status':_0x4b203f[_0x2ecf5c(0x137)],'createdAt':_0x4b203f[_0x2ecf5c(0xd4)]}))};}}exports['ShopService']=ShopService;