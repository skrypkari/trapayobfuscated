'use strict';const a58_0xd0d3c9=a58_0x42f2;(function(_0x40fb47,_0x5a1a00){const _0x23dc80=a58_0x42f2,_0x2c9a6c=_0x40fb47();while(!![]){try{const _0x2f35bf=-parseInt(_0x23dc80(0x295))/0x1*(-parseInt(_0x23dc80(0x244))/0x2)+parseInt(_0x23dc80(0x210))/0x3*(parseInt(_0x23dc80(0x228))/0x4)+parseInt(_0x23dc80(0x216))/0x5+-parseInt(_0x23dc80(0x22a))/0x6+parseInt(_0x23dc80(0x29c))/0x7*(parseInt(_0x23dc80(0x22c))/0x8)+parseInt(_0x23dc80(0x20b))/0x9+parseInt(_0x23dc80(0x28e))/0xa*(-parseInt(_0x23dc80(0x21f))/0xb);if(_0x2f35bf===_0x5a1a00)break;else _0x2c9a6c['push'](_0x2c9a6c['shift']());}catch(_0x4452ba){_0x2c9a6c['push'](_0x2c9a6c['shift']());}}}(a58_0x5d62,0xcfd61));function a58_0x42f2(_0x62098,_0x5b2cde){const _0x5d623c=a58_0x5d62();return a58_0x42f2=function(_0x42f28a,_0x3d8583){_0x42f28a=_0x42f28a-0x1f1;let _0x452cf5=_0x5d623c[_0x42f28a];return _0x452cf5;},a58_0x42f2(_0x62098,_0x5b2cde);}var __importDefault=this&&this[a58_0xd0d3c9(0x211)]||function(_0x311aed){const _0x1a1ae3=a58_0xd0d3c9;return _0x311aed&&_0x311aed[_0x1a1ae3(0x265)]?_0x311aed:{'default':_0x311aed};};Object[a58_0xd0d3c9(0x247)](exports,a58_0xd0d3c9(0x265),{'value':!![]}),exports[a58_0xd0d3c9(0x23f)]=void 0x0;function a58_0x5d62(){const _0x3f7c50=['filter','PAID','üìÖ\x20Period\x20end:\x20','stringify','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','getWebhookLogs','KLYME\x20GB','webhookEvents','merchantUrl','shop','paid','getPayouts','Noda','count','usage','10jJlHfV','username','paymentId','toUpperCase','USDT\x20ERC20','findMany','dailyRevenue','35Iiiwrl','aggregate','setDate','map','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','retryCount','createPublicPayment','7xZYIEK','publicKey','shopUrl','KLYME\x20DE','getPaymentsByShop','üìä\x20Final\x20WHERE\x20conditions:','update','maxPayments','notes','Webhook\x20returned\x20error:\x20','round','Payment\x20not\x20found','üìÖ\x20Period\x20start:\x20','payout','getPaymentById','amount','get','updateShopProfile','test','90d','trc20','PENDING','parse','reduce','telegram','üìä\x20Shop\x20','_sum','usdcPolygonWallet','redirectUrl','9212940OGerQc','getPayoutStatistics','getShopProfile','\x20\x20\x20üíµ\x20Available\x20balance:\x20','network','6IScwnM','__importDefault','test_gateway','Error\x20parsing\x20webhook\x20events:','Plisio','getPayoutById','5797400fxIfzq','test_payment_123','createPayment','periodFrom','gatewaySettings','asc','getShopPayoutStats','gateways','Rapyd','20516177rUwMqe','log','all','Test\x20webhook\x20sent\x20successfully\x20(','generateDailyStatistics','setHours','toISOString','push','fullName','1568324FQDtNl','TesSoft\x20Payment\x20System/1.0\x20(Test)','6222372idhzxC','amountUSDT','6271112ZJynGE','getPayoutStats','PaymentService','paymentService','error','../config/database','customer','createdAt','üìä\x20Status\x20filter:\x20','desc','\x20\x20\x20üìÖ\x20This\x20month:\x20','application/json','USD','wallets','KLYME\x20EU','üåê\x20Network\x20filter:\x20','getDate','\x20USDT\x20(current\x20balance)','polygon_usdc','ShopService','COMPLETED','telegramId','deletePayment','30d','130EUNUeg','üìÖ\x20Date\x20start:\x20','usdtErcWallet','defineProperty','name','balance','paymentGateways','default','formatNetworkName','revenue','testWebhook','POST','status','expiresAt','currencyService','usdtPolygonWallet','txid','...','getPaymentByShopAndId','customerEmail','convertToUSDT','usdtTrcWallet','amountIsEditable','\x20payout\x20statistics\x20calculated:','payment','split','üí∞\x20Getting\x20payouts\x20with\x20filters:','language','statusCode','./currencyService','Shop\x20not\x20found','USDT\x20TRC20','findFirst','__esModule','webhookLog','isArray','getGatewayDisplayName','awaitingPayout','availableBalance','gte','settings','Unknown\x20error','getMonth','getPayments','lte','totalPaidOut','currency','findUnique','getTime','customerName','No\x20webhook\x20URL\x20configured','gateway','getFullYear','webhookUrl','shopId','USDT\x20Polygon','ceil','paidAt','statusText'];a58_0x5d62=function(){return _0x3f7c50;};return a58_0x5d62();}const database_1=__importDefault(require(a58_0xd0d3c9(0x231))),currencyService_1=require(a58_0xd0d3c9(0x261)),paymentService_1=require('./paymentService');class ShopService{constructor(){const _0x24efc5=a58_0xd0d3c9;this[_0x24efc5(0x22f)]=new paymentService_1[(_0x24efc5(0x22e))]();}async[a58_0xd0d3c9(0x20d)](_0x45e9c3){const _0x1312f7=a58_0xd0d3c9,_0x21430e=await database_1[_0x1312f7(0x24b)][_0x1312f7(0x288)][_0x1312f7(0x273)]({'where':{'id':_0x45e9c3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x21430e)throw new Error(_0x1312f7(0x262));let _0x4765db=[];if(_0x21430e[_0x1312f7(0x26c)]?.['webhookEvents'])try{_0x4765db=Array[_0x1312f7(0x267)](_0x21430e[_0x1312f7(0x26c)][_0x1312f7(0x286)])?_0x21430e[_0x1312f7(0x26c)][_0x1312f7(0x286)]:JSON[_0x1312f7(0x204)](_0x21430e[_0x1312f7(0x26c)][_0x1312f7(0x286)]);}catch(_0x2ed067){console[_0x1312f7(0x230)](_0x1312f7(0x213),_0x2ed067),_0x4765db=[];}return{'id':_0x21430e['id'],'fullName':_0x21430e[_0x1312f7(0x248)],'username':_0x21430e[_0x1312f7(0x28f)],'telegramId':_0x21430e[_0x1312f7(0x206)],'merchantUrl':_0x21430e['shopUrl'],'gateways':_0x21430e[_0x1312f7(0x24a)]?JSON['parse'](_0x21430e[_0x1312f7(0x24a)]):null,'gatewaySettings':_0x21430e[_0x1312f7(0x21a)]?JSON[_0x1312f7(0x204)](_0x21430e['gatewaySettings']):null,'publicKey':_0x21430e[_0x1312f7(0x29d)],'webhookUrl':_0x21430e['settings']?.['webhookUrl']||null,'webhookEvents':_0x4765db,'wallets':{'usdtPolygonWallet':_0x21430e[_0x1312f7(0x253)],'usdtTrcWallet':_0x21430e[_0x1312f7(0x259)],'usdtErcWallet':_0x21430e['usdtErcWallet'],'usdcPolygonWallet':_0x21430e[_0x1312f7(0x209)]},'status':_0x21430e['status'],'createdAt':_0x21430e[_0x1312f7(0x233)]};}async[a58_0xd0d3c9(0x1ff)](_0x49c9e1,_0x5ba87b){const _0x53ba70=a58_0xd0d3c9,_0x99a6de={};_0x5ba87b[_0x53ba70(0x227)]&&(_0x99a6de['name']=_0x5ba87b['fullName']);_0x5ba87b['telegramId']!==undefined&&(_0x99a6de[_0x53ba70(0x206)]=_0x5ba87b[_0x53ba70(0x241)]||null);_0x5ba87b['merchantUrl']&&(_0x99a6de['shopUrl']=_0x5ba87b[_0x53ba70(0x287)]);_0x5ba87b[_0x53ba70(0x21d)]&&(_0x99a6de[_0x53ba70(0x24a)]=JSON[_0x53ba70(0x282)](_0x5ba87b[_0x53ba70(0x21d)]));_0x5ba87b[_0x53ba70(0x21a)]&&(_0x99a6de[_0x53ba70(0x21a)]=JSON[_0x53ba70(0x282)](_0x5ba87b['gatewaySettings']));_0x5ba87b[_0x53ba70(0x239)]&&(_0x5ba87b[_0x53ba70(0x239)][_0x53ba70(0x253)]!==undefined&&(_0x99a6de[_0x53ba70(0x253)]=_0x5ba87b[_0x53ba70(0x239)][_0x53ba70(0x253)]||null),_0x5ba87b[_0x53ba70(0x239)][_0x53ba70(0x259)]!==undefined&&(_0x99a6de[_0x53ba70(0x259)]=_0x5ba87b[_0x53ba70(0x239)]['usdtTrcWallet']||null),_0x5ba87b[_0x53ba70(0x239)][_0x53ba70(0x246)]!==undefined&&(_0x99a6de[_0x53ba70(0x246)]=_0x5ba87b['wallets']['usdtErcWallet']||null),_0x5ba87b[_0x53ba70(0x239)][_0x53ba70(0x209)]!==undefined&&(_0x99a6de[_0x53ba70(0x209)]=_0x5ba87b[_0x53ba70(0x239)]['usdcPolygonWallet']||null));const _0x3852fb=await database_1[_0x53ba70(0x24b)][_0x53ba70(0x288)][_0x53ba70(0x1f4)]({'where':{'id':_0x49c9e1},'data':_0x99a6de,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0xdc3dfa=[];if(_0x3852fb['settings']?.['webhookEvents'])try{_0xdc3dfa=Array[_0x53ba70(0x267)](_0x3852fb[_0x53ba70(0x26c)][_0x53ba70(0x286)])?_0x3852fb[_0x53ba70(0x26c)][_0x53ba70(0x286)]:JSON[_0x53ba70(0x204)](_0x3852fb[_0x53ba70(0x26c)][_0x53ba70(0x286)]);}catch(_0x208bf0){console[_0x53ba70(0x230)](_0x53ba70(0x213),_0x208bf0),_0xdc3dfa=[];}return{'id':_0x3852fb['id'],'fullName':_0x3852fb[_0x53ba70(0x248)],'username':_0x3852fb[_0x53ba70(0x28f)],'telegramId':_0x3852fb[_0x53ba70(0x206)],'merchantUrl':_0x3852fb[_0x53ba70(0x29e)],'gateways':_0x3852fb[_0x53ba70(0x24a)]?JSON[_0x53ba70(0x204)](_0x3852fb[_0x53ba70(0x24a)]):null,'gatewaySettings':_0x3852fb[_0x53ba70(0x21a)]?JSON[_0x53ba70(0x204)](_0x3852fb[_0x53ba70(0x21a)]):null,'publicKey':_0x3852fb[_0x53ba70(0x29d)],'webhookUrl':_0x3852fb['settings']?.[_0x53ba70(0x279)]||null,'webhookEvents':_0xdc3dfa,'wallets':{'usdtPolygonWallet':_0x3852fb[_0x53ba70(0x253)],'usdtTrcWallet':_0x3852fb['usdtTrcWallet'],'usdtErcWallet':_0x3852fb[_0x53ba70(0x246)],'usdcPolygonWallet':_0x3852fb[_0x53ba70(0x209)]},'status':_0x3852fb[_0x53ba70(0x250)],'createdAt':_0x3852fb[_0x53ba70(0x233)]};}async['updateWallets'](_0x4e116e,_0x31f645){const _0x4443e0=a58_0xd0d3c9,_0x5f44eb={};_0x31f645[_0x4443e0(0x253)]!==undefined&&(_0x5f44eb[_0x4443e0(0x253)]=_0x31f645['usdtPolygonWallet']||null),_0x31f645[_0x4443e0(0x259)]!==undefined&&(_0x5f44eb[_0x4443e0(0x259)]=_0x31f645[_0x4443e0(0x259)]||null),_0x31f645[_0x4443e0(0x246)]!==undefined&&(_0x5f44eb[_0x4443e0(0x246)]=_0x31f645[_0x4443e0(0x246)]||null),_0x31f645[_0x4443e0(0x209)]!==undefined&&(_0x5f44eb[_0x4443e0(0x209)]=_0x31f645[_0x4443e0(0x209)]||null),await database_1[_0x4443e0(0x24b)]['shop'][_0x4443e0(0x1f4)]({'where':{'id':_0x4e116e},'data':_0x5f44eb});}async[a58_0xd0d3c9(0x24e)](_0x203f49){const _0x5be334=a58_0xd0d3c9,_0x22b02f=await database_1[_0x5be334(0x24b)][_0x5be334(0x288)][_0x5be334(0x273)]({'where':{'id':_0x203f49},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x22b02f?.[_0x5be334(0x26c)]?.[_0x5be334(0x279)])throw new Error(_0x5be334(0x276));const _0x47143c={'event':_0x5be334(0x200),'payment':{'id':_0x5be334(0x217),'order_id':'test_order_123','gateway':_0x5be334(0x200),'amount':0x64,'currency':_0x5be334(0x238),'status':_0x5be334(0x289),'created_at':new Date()['toISOString']()}};try{const _0xf81348=await fetch(_0x22b02f[_0x5be334(0x26c)][_0x5be334(0x279)],{'method':_0x5be334(0x24f),'headers':{'Content-Type':_0x5be334(0x237),'User-Agent':_0x5be334(0x229)},'body':JSON[_0x5be334(0x282)](_0x47143c)});return _0xf81348['ok']?{'success':!![],'message':_0x5be334(0x222)+_0xf81348[_0x5be334(0x250)]+')'}:{'success':![],'message':_0x5be334(0x1f7)+_0xf81348['status']+'\x20'+_0xf81348[_0x5be334(0x27e)]};}catch(_0x153906){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x153906 instanceof Error?_0x153906['message']:_0x5be334(0x26d))};}}async[a58_0xd0d3c9(0x218)](_0x144485){const _0x29e956=a58_0xd0d3c9;return this[_0x29e956(0x22f)][_0x29e956(0x29b)]({'public_key':'','gateway':_0x144485[_0x29e956(0x277)],'order_id':undefined,'amount':_0x144485[_0x29e956(0x1fd)],'currency':_0x144485[_0x29e956(0x272)],'source_currency':_0x144485['sourceCurrency'],'usage':_0x144485[_0x29e956(0x28d)],'expires_at':_0x144485[_0x29e956(0x251)]?.[_0x29e956(0x225)](),'success_url':_0x144485[_0x29e956(0x20a)],'fail_url':_0x144485[_0x29e956(0x20a)],'customer_email':_0x144485[_0x29e956(0x257)],'customer_name':_0x144485[_0x29e956(0x275)],'country':_0x144485['country'],'language':_0x144485[_0x29e956(0x25f)],'amount_is_editable':_0x144485[_0x29e956(0x25a)],'max_payments':_0x144485[_0x29e956(0x1f5)],'customer':_0x144485[_0x29e956(0x232)]});}async[a58_0xd0d3c9(0x26f)](_0x527aa2,_0x199983){const _0x152d29=a58_0xd0d3c9;return this['paymentService'][_0x152d29(0x1f2)](_0x527aa2,_0x199983);}async[a58_0xd0d3c9(0x1fc)](_0x29e5e0,_0x1a605b){const _0x24bf3c=a58_0xd0d3c9;return this[_0x24bf3c(0x22f)][_0x24bf3c(0x256)](_0x29e5e0,_0x1a605b);}async['updatePayment'](_0x30b4d7,_0x385aed,_0x22740c){const _0x2e61ec=a58_0xd0d3c9,_0xea50d5=await database_1['default'][_0x2e61ec(0x25c)][_0x2e61ec(0x264)]({'where':{'id':_0x385aed,'shopId':_0x30b4d7}});if(!_0xea50d5)throw new Error(_0x2e61ec(0x1f9));const _0x54e505=await database_1[_0x2e61ec(0x24b)]['payment'][_0x2e61ec(0x1f4)]({'where':{'id':_0x385aed},'data':{..._0x22740c,'updatedAt':new Date()}});return _0x54e505;}async[a58_0xd0d3c9(0x242)](_0xc1b163,_0x26239e){const _0x362b7c=a58_0xd0d3c9,_0x2f943e=await database_1[_0x362b7c(0x24b)]['payment'][_0x362b7c(0x264)]({'where':{'id':_0x26239e,'shopId':_0xc1b163}});if(!_0x2f943e)throw new Error('Payment\x20not\x20found');await database_1[_0x362b7c(0x24b)][_0x362b7c(0x25c)]['delete']({'where':{'id':_0x26239e}});}[a58_0xd0d3c9(0x24c)](_0xf011e){const _0x19c525=a58_0xd0d3c9,_0x1c8181={'polygon':_0x19c525(0x27b),'trc20':_0x19c525(0x263),'erc20':_0x19c525(0x292),'bsc':'USDT\x20BSC','polygon_usdc':'USDC\x20Polygon'};return _0x1c8181[_0xf011e]||_0xf011e;}async[a58_0xd0d3c9(0x28a)](_0x275947,_0x5deb0e){const _0x253c7d=a58_0xd0d3c9,{page:_0x490cc7,limit:_0x5e77f6,status:_0x2e561e,method:_0xda95f,network:_0x5a8302,dateFrom:_0x1d35c8,dateTo:_0x532006,periodFrom:_0x59cc0d,periodTo:_0x37ac10}=_0x5deb0e,_0x50f257=(_0x490cc7-0x1)*_0x5e77f6;console[_0x253c7d(0x220)](_0x253c7d(0x25e),_0x5deb0e);const _0x21fa3f={'shopId':_0x275947};_0x2e561e&&(_0x21fa3f[_0x253c7d(0x250)]=_0x2e561e['toUpperCase'](),console[_0x253c7d(0x220)](_0x253c7d(0x234)+_0x2e561e[_0x253c7d(0x291)]()));if(_0xda95f)_0x21fa3f[_0x253c7d(0x20f)]=_0xda95f,console[_0x253c7d(0x220)]('üåê\x20Method\x20filter:\x20'+_0xda95f);else _0x5a8302&&(_0x21fa3f[_0x253c7d(0x20f)]=_0x5a8302,console['log'](_0x253c7d(0x23b)+_0x5a8302));if(_0x1d35c8||_0x532006||_0x59cc0d||_0x37ac10){_0x21fa3f['createdAt']={};if(_0x59cc0d){const _0x42134a=new Date(_0x59cc0d);_0x42134a['setHours'](0x0,0x0,0x0,0x0),_0x21fa3f['createdAt'][_0x253c7d(0x26b)]=_0x42134a,console[_0x253c7d(0x220)](_0x253c7d(0x1fa)+_0x42134a['toISOString']());}else{if(_0x1d35c8){const _0x89bb84=new Date(_0x1d35c8);_0x89bb84[_0x253c7d(0x224)](0x0,0x0,0x0,0x0),_0x21fa3f['createdAt']['gte']=_0x89bb84,console[_0x253c7d(0x220)](_0x253c7d(0x245)+_0x89bb84[_0x253c7d(0x225)]());}}if(_0x37ac10){const _0x4faadb=new Date(_0x37ac10);_0x4faadb['setHours'](0x17,0x3b,0x3b,0x3e7),_0x21fa3f[_0x253c7d(0x233)][_0x253c7d(0x270)]=_0x4faadb,console[_0x253c7d(0x220)](_0x253c7d(0x281)+_0x4faadb['toISOString']());}else{if(_0x532006){const _0x52ae81=new Date(_0x532006);_0x52ae81['setHours'](0x17,0x3b,0x3b,0x3e7),_0x21fa3f[_0x253c7d(0x233)][_0x253c7d(0x270)]=_0x52ae81,console['log']('üìÖ\x20Date\x20end:\x20'+_0x52ae81[_0x253c7d(0x225)]());}}}console[_0x253c7d(0x220)](_0x253c7d(0x1f3),JSON[_0x253c7d(0x282)](_0x21fa3f,null,0x2));const [_0x509fd6,_0x2e5aed]=await Promise[_0x253c7d(0x221)]([database_1['default'][_0x253c7d(0x1fb)][_0x253c7d(0x293)]({'where':_0x21fa3f,'skip':_0x50f257,'take':_0x5e77f6,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x253c7d(0x1fb)][_0x253c7d(0x28c)]({'where':_0x21fa3f})]);return{'payouts':_0x509fd6[_0x253c7d(0x298)](_0x48374b=>{const _0x239452=_0x253c7d;let _0x38ac74=null;switch(_0x48374b[_0x239452(0x20f)]){case'polygon':_0x38ac74=_0x48374b[_0x239452(0x288)][_0x239452(0x253)];break;case _0x239452(0x202):_0x38ac74=_0x48374b[_0x239452(0x288)][_0x239452(0x259)];break;case'erc20':_0x38ac74=_0x48374b[_0x239452(0x288)][_0x239452(0x246)];break;case _0x239452(0x23e):_0x38ac74=_0x48374b['shop'][_0x239452(0x209)];break;}return{'id':_0x48374b['id'],'amount':_0x48374b[_0x239452(0x1fd)],'network':this[_0x239452(0x24c)](_0x48374b['network']),'wallet':_0x38ac74,'status':_0x48374b[_0x239452(0x250)],'txid':_0x48374b[_0x239452(0x254)],'notes':_0x48374b[_0x239452(0x1f6)],'periodFrom':_0x48374b[_0x239452(0x219)],'periodTo':_0x48374b['periodTo'],'createdAt':_0x48374b[_0x239452(0x233)],'paidAt':_0x48374b[_0x239452(0x27d)]};}),'pagination':{'page':_0x490cc7,'limit':_0x5e77f6,'total':_0x2e5aed,'totalPages':Math['ceil'](_0x2e5aed/_0x5e77f6)}};}async[a58_0xd0d3c9(0x215)](_0x3c79a1,_0x3d0db2){const _0x2258d3=a58_0xd0d3c9,_0xd614cc=await database_1[_0x2258d3(0x24b)][_0x2258d3(0x1fb)][_0x2258d3(0x264)]({'where':{'id':_0x3d0db2,'shopId':_0x3c79a1}});if(!_0xd614cc)return null;return{'id':_0xd614cc['id'],'amount':_0xd614cc['amount'],'network':_0xd614cc[_0x2258d3(0x20f)],'status':_0xd614cc[_0x2258d3(0x250)],'txid':_0xd614cc[_0x2258d3(0x254)],'notes':_0xd614cc[_0x2258d3(0x1f6)],'createdAt':_0xd614cc[_0x2258d3(0x233)],'paidAt':_0xd614cc['paidAt']};}async[a58_0xd0d3c9(0x20c)](_0x551649,_0x1f30ed){const _0x235bf0=a58_0xd0d3c9,_0x5905ea=new Date();let _0x413c42;switch(_0x1f30ed){case'7d':_0x413c42=new Date(_0x5905ea[_0x235bf0(0x274)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x235bf0(0x243):_0x413c42=new Date(_0x5905ea[_0x235bf0(0x274)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x235bf0(0x201):_0x413c42=new Date(_0x5905ea['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x413c42=new Date(_0x5905ea[_0x235bf0(0x274)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1bae9f,_0x2026a6,_0x4ca6b1,_0x334856,_0x68a45e,_0x2a4191]=await Promise[_0x235bf0(0x221)]([database_1[_0x235bf0(0x24b)]['payout'][_0x235bf0(0x28c)]({'where':{'shopId':_0x551649,'createdAt':{'gte':_0x413c42}}}),database_1[_0x235bf0(0x24b)][_0x235bf0(0x1fb)][_0x235bf0(0x28c)]({'where':{'shopId':_0x551649,'status':'COMPLETED','createdAt':{'gte':_0x413c42}}}),database_1['default'][_0x235bf0(0x1fb)][_0x235bf0(0x28c)]({'where':{'shopId':_0x551649,'status':_0x235bf0(0x203),'createdAt':{'gte':_0x413c42}}}),database_1[_0x235bf0(0x24b)][_0x235bf0(0x1fb)]['count']({'where':{'shopId':_0x551649,'status':'REJECTED','createdAt':{'gte':_0x413c42}}}),database_1[_0x235bf0(0x24b)][_0x235bf0(0x1fb)]['findMany']({'where':{'shopId':_0x551649,'createdAt':{'gte':_0x413c42}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x235bf0(0x24b)][_0x235bf0(0x1fb)][_0x235bf0(0x293)]({'where':{'shopId':_0x551649},'take':0xa,'orderBy':{'createdAt':_0x235bf0(0x235)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3a5d12=_0x68a45e[_0x235bf0(0x205)]((_0x3e5137,_0x23fd12)=>_0x3e5137+_0x23fd12['amount'],0x0),_0x103511=_0x68a45e[_0x235bf0(0x27f)](_0x531867=>_0x531867[_0x235bf0(0x250)]===_0x235bf0(0x240))[_0x235bf0(0x205)]((_0x3990b2,_0x54bdc1)=>_0x3990b2+_0x54bdc1[_0x235bf0(0x1fd)],0x0),_0x324b47=_0x68a45e[_0x235bf0(0x27f)](_0x5c6c2f=>_0x5c6c2f[_0x235bf0(0x250)]===_0x235bf0(0x203))[_0x235bf0(0x205)]((_0x139784,_0x1a996c)=>_0x139784+_0x1a996c[_0x235bf0(0x1fd)],0x0),_0x356b4b=_0x68a45e[_0x235bf0(0x205)]((_0x386c4d,_0x4adbe5)=>{const _0x45c140=_0x235bf0;return _0x386c4d[_0x4adbe5[_0x45c140(0x20f)]]=(_0x386c4d[_0x4adbe5[_0x45c140(0x20f)]]||0x0)+0x1,_0x386c4d;},{}),_0x2b356=_0x68a45e[_0x235bf0(0x205)]((_0x259301,_0x21beed)=>{const _0x4a7f91=_0x235bf0;return _0x259301[_0x21beed[_0x4a7f91(0x250)]]=(_0x259301[_0x21beed['status']]||0x0)+0x1,_0x259301;},{});return{'totalPayouts':_0x1bae9f,'completedPayouts':_0x2026a6,'pendingPayouts':_0x4ca6b1,'rejectedPayouts':_0x334856,'totalAmount':_0x3a5d12,'completedAmount':_0x103511,'pendingAmount':_0x324b47,'payoutsByMethod':_0x356b4b,'payoutsByStatus':_0x2b356,'recentPayouts':_0x2a4191['map'](_0x277d69=>({'id':_0x277d69['id'],'shopId':_0x551649,'amount':_0x277d69[_0x235bf0(0x1fd)],'method':_0x277d69[_0x235bf0(0x20f)],'status':_0x277d69[_0x235bf0(0x250)],'txid':_0x277d69[_0x235bf0(0x254)],'createdAt':_0x277d69[_0x235bf0(0x233)],'paidAt':_0x277d69[_0x235bf0(0x27d)]}))};}async[a58_0xd0d3c9(0x21c)](_0xed33ba){const _0xef42c=a58_0xd0d3c9;console[_0xef42c(0x220)](_0xef42c(0x283)+_0xed33ba+_0xef42c(0x255));const _0xd4484a=await database_1[_0xef42c(0x24b)][_0xef42c(0x288)]['findUnique']({'where':{'id':_0xed33ba},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xd4484a)throw new Error(_0xef42c(0x262));const _0x5dc7c4=new Date(),_0x5a81e5=new Date(_0x5dc7c4['getFullYear'](),_0x5dc7c4[_0xef42c(0x26e)](),0x1),_0x35f1fc=new Date(_0x5dc7c4[_0xef42c(0x278)](),_0x5dc7c4[_0xef42c(0x26e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2ea6c4=await database_1[_0xef42c(0x24b)][_0xef42c(0x1fb)][_0xef42c(0x296)]({'_sum':{'amount':!![]},'where':{'shopId':_0xed33ba,'createdAt':{'gte':_0x5a81e5,'lte':_0x35f1fc},'status':_0xef42c(0x240)}}),_0x537de7=_0x2ea6c4[_0xef42c(0x208)][_0xef42c(0x1fd)]||0x0,_0x172169={'availableBalance':Math[_0xef42c(0x1f8)](_0xd4484a[_0xef42c(0x249)]*0x64)/0x64,'totalPaidOut':Math[_0xef42c(0x1f8)](_0xd4484a['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0xef42c(0x1f8)](_0xd4484a[_0xef42c(0x249)]*0x64)/0x64,'thisMonth':Math[_0xef42c(0x1f8)](_0x537de7*0x64)/0x64};return console[_0xef42c(0x220)](_0xef42c(0x207)+_0xd4484a[_0xef42c(0x28f)]+_0xef42c(0x25b)),console['log'](_0xef42c(0x20e)+_0x172169[_0xef42c(0x26a)]+_0xef42c(0x23d)),console[_0xef42c(0x220)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x172169[_0xef42c(0x271)]+'\x20USDT\x20(total\x20payouts)'),console['log'](_0xef42c(0x299)+_0x172169[_0xef42c(0x269)]+_0xef42c(0x23d)),console[_0xef42c(0x220)](_0xef42c(0x236)+_0x172169['thisMonth']+'\x20USDT'),_0x172169;}[a58_0xd0d3c9(0x268)](_0x88ab48){const _0x42657e=a58_0xd0d3c9,_0x3aa77c={'test_gateway':'Test\x20Gateway','plisio':_0x42657e(0x214),'rapyd':_0x42657e(0x21e),'noda':_0x42657e(0x28b),'cointopay':'CoinToPay','klyme_eu':_0x42657e(0x23a),'klyme_gb':_0x42657e(0x285),'klyme_de':_0x42657e(0x1f1)};return _0x3aa77c[_0x88ab48]||_0x88ab48;}async[a58_0xd0d3c9(0x22d)](_0x50ad22){const _0x26dc3f=a58_0xd0d3c9;return this[_0x26dc3f(0x21c)](_0x50ad22);}async[a58_0xd0d3c9(0x284)](_0x311b58,_0x269c45){const _0x260f22=a58_0xd0d3c9,{page:_0x16c3a7,limit:_0x2716f4,paymentId:_0x44eee2}=_0x269c45,_0x1cccaa=(_0x16c3a7-0x1)*_0x2716f4,_0xc67709={'shopId':_0x311b58};_0x44eee2&&(_0xc67709['paymentId']=_0x44eee2);const [_0x17ae2d,_0x29b06c]=await Promise[_0x260f22(0x221)]([database_1[_0x260f22(0x24b)][_0x260f22(0x266)][_0x260f22(0x293)]({'where':_0xc67709,'skip':_0x1cccaa,'take':_0x2716f4,'orderBy':{'createdAt':_0x260f22(0x235)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x260f22(0x24b)]['webhookLog'][_0x260f22(0x28c)]({'where':_0xc67709})]);return{'logs':_0x17ae2d[_0x260f22(0x298)](_0x1ea1fb=>({'id':_0x1ea1fb['id'],'paymentId':_0x1ea1fb[_0x260f22(0x290)],'shopId':_0x1ea1fb[_0x260f22(0x27a)],'event':_0x1ea1fb['event'],'statusCode':_0x1ea1fb[_0x260f22(0x260)],'retryCount':_0x1ea1fb[_0x260f22(0x29a)],'responseBody':_0x1ea1fb['responseBody'],'createdAt':_0x1ea1fb[_0x260f22(0x233)],'payment':_0x1ea1fb[_0x260f22(0x25c)]})),'pagination':{'page':_0x16c3a7,'limit':_0x2716f4,'total':_0x29b06c,'totalPages':Math[_0x260f22(0x27c)](_0x29b06c/_0x2716f4)}};}async['getStatistics'](_0xe894ae,_0x2f6f93){const _0x1ca826=a58_0xd0d3c9,_0x150041=new Date();let _0x5ee2f4;switch(_0x2f6f93){case'7d':_0x5ee2f4=new Date(_0x150041[_0x1ca826(0x274)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1ca826(0x243):_0x5ee2f4=new Date(_0x150041[_0x1ca826(0x274)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1ca826(0x201):_0x5ee2f4=new Date(_0x150041[_0x1ca826(0x274)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5ee2f4=new Date(_0x150041[_0x1ca826(0x274)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x12707b,_0x3360d3,_0x26838c,_0x1b697c,_0x5a6c72]=await Promise[_0x1ca826(0x221)]([database_1[_0x1ca826(0x24b)][_0x1ca826(0x25c)][_0x1ca826(0x28c)]({'where':{'shopId':_0xe894ae,'gateway':{'not':_0x1ca826(0x212)},'createdAt':{'gte':_0x5ee2f4}}}),database_1[_0x1ca826(0x24b)][_0x1ca826(0x25c)][_0x1ca826(0x28c)]({'where':{'shopId':_0xe894ae,'gateway':{'not':_0x1ca826(0x212)},'status':'PAID','createdAt':{'gte':_0x5ee2f4}}}),database_1[_0x1ca826(0x24b)]['payment'][_0x1ca826(0x293)]({'where':{'shopId':_0xe894ae,'gateway':{'not':_0x1ca826(0x212)},'status':_0x1ca826(0x280),'createdAt':{'gte':_0x5ee2f4}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x1ca826(0x25c)][_0x1ca826(0x293)]({'where':{'shopId':_0xe894ae,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x1ca826(0x235)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x1ca826(0x24b)][_0x1ca826(0x25c)][_0x1ca826(0x293)]({'where':{'shopId':_0xe894ae,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x5ee2f4}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x1ca826(0x21b)}})]);let _0x198b80=0x0;for(const _0x20ade2 of _0x26838c){if(_0x20ade2[_0x1ca826(0x22b)])_0x198b80+=_0x20ade2[_0x1ca826(0x22b)];else{const _0x580256=await currencyService_1[_0x1ca826(0x252)][_0x1ca826(0x258)](_0x20ade2['amount'],_0x20ade2['currency']);_0x198b80+=_0x580256;}}const _0x3ab36e=this[_0x1ca826(0x223)](_0x5a6c72,_0x5ee2f4,_0x150041),_0x487380=_0x12707b>0x0?_0x3360d3/_0x12707b*0x64:0x0;return{'totalPayments':_0x12707b,'successfulPayments':_0x3360d3,'totalRevenue':Math[_0x1ca826(0x1f8)](_0x198b80*0x64)/0x64,'conversionRate':Math[_0x1ca826(0x1f8)](_0x487380*0x64)/0x64,'dailyRevenue':_0x3ab36e[_0x1ca826(0x294)],'dailyPayments':_0x3ab36e['dailyPayments'],'recentPayments':_0x1b697c[_0x1ca826(0x298)](_0x122d71=>({'id':_0x122d71['id'],'gateway':_0x122d71['gateway'],'amount':_0x122d71[_0x1ca826(0x1fd)],'currency':_0x122d71[_0x1ca826(0x272)],'status':_0x122d71['status'],'createdAt':_0x122d71[_0x1ca826(0x233)]}))};}[a58_0xd0d3c9(0x223)](_0x5d06d5,_0x55f0c5,_0x58f526){const _0x4bf148=a58_0xd0d3c9,_0x1e3875=new Map(),_0x364b8a=new Date(_0x55f0c5);while(_0x364b8a<=_0x58f526){const _0x5985d3=_0x364b8a[_0x4bf148(0x225)]()[_0x4bf148(0x25d)]('T')[0x0];_0x1e3875['set'](_0x5985d3,{'revenue':0x0,'count':0x0}),_0x364b8a[_0x4bf148(0x297)](_0x364b8a[_0x4bf148(0x23c)]()+0x1);}for(const _0x11a4c5 of _0x5d06d5){const _0x6e75ca=_0x11a4c5['createdAt']['toISOString']()[_0x4bf148(0x25d)]('T')[0x0],_0x48aae2=_0x1e3875[_0x4bf148(0x1fe)](_0x6e75ca);_0x48aae2&&(_0x48aae2[_0x4bf148(0x28c)]+=0x1,_0x11a4c5[_0x4bf148(0x250)]==='PAID'&&_0x11a4c5['amountUSDT']&&(_0x48aae2['revenue']+=_0x11a4c5['amountUSDT']));}const _0x2ebbd4=[],_0x5cfec7=[];for(const [_0x5d362a,_0xe5b0a5]of _0x1e3875){_0x2ebbd4[_0x4bf148(0x226)]({'date':_0x5d362a,'amount':Math[_0x4bf148(0x1f8)](_0xe5b0a5[_0x4bf148(0x24d)]*0x64)/0x64}),_0x5cfec7[_0x4bf148(0x226)]({'date':_0x5d362a,'count':_0xe5b0a5[_0x4bf148(0x28c)]});}return{'dailyRevenue':_0x2ebbd4,'dailyPayments':_0x5cfec7};}}exports[a58_0xd0d3c9(0x23f)]=ShopService;