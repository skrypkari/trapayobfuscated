'use strict';const a54_0x4c2fc2=a54_0xd1e8;(function(_0x5579ed,_0x49f599){const _0x2ed346=a54_0xd1e8,_0x41dcf2=_0x5579ed();while(!![]){try{const _0x492646=-parseInt(_0x2ed346(0x15e))/0x1*(-parseInt(_0x2ed346(0x171))/0x2)+-parseInt(_0x2ed346(0x185))/0x3*(-parseInt(_0x2ed346(0x118))/0x4)+parseInt(_0x2ed346(0x147))/0x5+parseInt(_0x2ed346(0x101))/0x6*(-parseInt(_0x2ed346(0xff))/0x7)+-parseInt(_0x2ed346(0x139))/0x8+parseInt(_0x2ed346(0x161))/0x9+-parseInt(_0x2ed346(0x11c))/0xa*(parseInt(_0x2ed346(0xeb))/0xb);if(_0x492646===_0x49f599)break;else _0x41dcf2['push'](_0x41dcf2['shift']());}catch(_0x563cfa){_0x41dcf2['push'](_0x41dcf2['shift']());}}}(a54_0x39b7,0xc4ec9));function a54_0xd1e8(_0x1fea36,_0x3226c5){const _0x39b753=a54_0x39b7();return a54_0xd1e8=function(_0xd1e8d5,_0x1fa9a1){_0xd1e8d5=_0xd1e8d5-0xdd;let _0x17bf19=_0x39b753[_0xd1e8d5];return _0x17bf19;},a54_0xd1e8(_0x1fea36,_0x3226c5);}function a54_0x39b7(){const _0x4de1a2=['formatNetworkName','thisMonth','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','country','paymentService','createdAt','log','30d','10MvuJhc','USDT\x20BSC','split','usdcPolygonWallet','dailyRevenue','availableBalance','redirectUrl','Rapyd','toUpperCase','stringify','getTime','asc','KLYME\x20DE','üí∞\x20Getting\x20payouts\x20with\x20filters:','test_order_123','generateDailyStatistics','totalPaidOut','Plisio','toISOString','event','36VgIiKQ','./paymentService','üåê\x20Network\x20filter:\x20','\x20payout\x20statistics\x20calculated:','trc20','test','retryCount','usdtPolygonWallet','gateway','name','network','getStatistics','statusText','getPayouts','update','Payment\x20not\x20found','750387kJyiwA','90d','awaitingPayout','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','CoinToPay','amount','reduce','default','findUnique','parse','usdtTrcWallet','dailyPayments','gateways','publicKey','findFirst','push','üìä\x20Status\x20filter:\x20','fullName','getPayoutStats','language','7kWnrmi','erc20','462684XwDVrp','wallets','usdtErcWallet','paymentGateways','PaymentService','payout','shopUrl','...','Error\x20parsing\x20webhook\x20events:','amountUSDT','currency','customerName','deletePayment','üìÖ\x20Date\x20end:\x20','settings','ceil','filter','usage','paidAt','Test\x20webhook\x20sent\x20successfully\x20(','delete','PENDING','setDate','321732RvAdtw','notes','getPayoutById','webhookEvents','460axLnek','\x20USDT','USDT\x20TRC20','revenue','count','application/json','isArray','get','error','lte','\x20\x20\x20üìÖ\x20This\x20month:\x20','periodFrom','convertToUSDT','expiresAt','shopId','testWebhook','gatewaySettings','desc','customerEmail','test_payment_123','getGatewayDisplayName','currencyService','shop','POST','amountIsEditable','telegram','webhookLog','Shop\x20not\x20found','round','3910264gfkGyA','all','periodTo','telegramId','map','\x20USDT\x20(current\x20balance)','üìä\x20Final\x20WHERE\x20conditions:','üìÖ\x20Date\x20start:\x20','username','üåê\x20Method\x20filter:\x20','getMonth','createPayment','message','getShopPayoutStats','7560930gBwxcm','customer','paymentId','PAID','__importDefault','USDC\x20Polygon','createPublicPayment','\x20\x20\x20üíµ\x20Available\x20balance:\x20','merchantUrl','payment','txid','updatePayment','_sum','test_gateway','setHours','getFullYear','TesSoft\x20Payment\x20System/1.0\x20(Test)','COMPLETED','findMany','status','REJECTED','Test\x20Gateway','webhookUrl','162926eXMZjY','getPayoutStatistics','aggregate','10966212fKQLcz','getPayments','USD','./currencyService','gte','__esModule','getPaymentById','ShopService'];a54_0x39b7=function(){return _0x4de1a2;};return a54_0x39b7();}var __importDefault=this&&this[a54_0x4c2fc2(0x14b)]||function(_0x5599a5){const _0xe05f82=a54_0x4c2fc2;return _0x5599a5&&_0x5599a5[_0xe05f82(0x166)]?_0x5599a5:{'default':_0x5599a5};};Object['defineProperty'](exports,a54_0x4c2fc2(0x166),{'value':!![]}),exports[a54_0x4c2fc2(0x168)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a54_0x4c2fc2(0x164)),paymentService_1=require(a54_0x4c2fc2(0x186));class ShopService{constructor(){const _0x2dd8a5=a54_0x4c2fc2;this[_0x2dd8a5(0x16d)]=new paymentService_1[(_0x2dd8a5(0x105))]();}async['getShopProfile'](_0x1bf5e3){const _0xbd1c30=a54_0x4c2fc2,_0x12668e=await database_1[_0xbd1c30(0xf2)][_0xbd1c30(0x132)][_0xbd1c30(0xf3)]({'where':{'id':_0x1bf5e3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x12668e)throw new Error(_0xbd1c30(0x137));let _0xe8941=[];if(_0x12668e[_0xbd1c30(0x10f)]?.[_0xbd1c30(0x11b)])try{_0xe8941=Array[_0xbd1c30(0x122)](_0x12668e[_0xbd1c30(0x10f)]['webhookEvents'])?_0x12668e[_0xbd1c30(0x10f)]['webhookEvents']:JSON[_0xbd1c30(0xf4)](_0x12668e[_0xbd1c30(0x10f)]['webhookEvents']);}catch(_0x5b858f){console[_0xbd1c30(0x124)](_0xbd1c30(0x109),_0x5b858f),_0xe8941=[];}return{'id':_0x12668e['id'],'fullName':_0x12668e['name'],'username':_0x12668e[_0xbd1c30(0x141)],'telegramId':_0x12668e[_0xbd1c30(0x135)],'merchantUrl':_0x12668e[_0xbd1c30(0x107)],'gateways':_0x12668e[_0xbd1c30(0x104)]?JSON['parse'](_0x12668e[_0xbd1c30(0x104)]):null,'gatewaySettings':_0x12668e[_0xbd1c30(0x12c)]?JSON[_0xbd1c30(0xf4)](_0x12668e[_0xbd1c30(0x12c)]):null,'publicKey':_0x12668e[_0xbd1c30(0xf8)],'webhookUrl':_0x12668e[_0xbd1c30(0x10f)]?.[_0xbd1c30(0x15d)]||null,'webhookEvents':_0xe8941,'wallets':{'usdtPolygonWallet':_0x12668e[_0xbd1c30(0xe2)],'usdtTrcWallet':_0x12668e[_0xbd1c30(0xf5)],'usdtErcWallet':_0x12668e[_0xbd1c30(0x103)],'usdcPolygonWallet':_0x12668e['usdcPolygonWallet']},'status':_0x12668e[_0xbd1c30(0x15a)],'createdAt':_0x12668e[_0xbd1c30(0x16e)]};}async['updateShopProfile'](_0x14a55b,_0x67f5fb){const _0xd565f0=a54_0x4c2fc2,_0x3e949e={};_0x67f5fb[_0xd565f0(0xfc)]&&(_0x3e949e['name']=_0x67f5fb[_0xd565f0(0xfc)]);_0x67f5fb['telegramId']!==undefined&&(_0x3e949e['telegram']=_0x67f5fb[_0xd565f0(0x13c)]||null);_0x67f5fb[_0xd565f0(0x14f)]&&(_0x3e949e[_0xd565f0(0x107)]=_0x67f5fb[_0xd565f0(0x14f)]);_0x67f5fb[_0xd565f0(0xf7)]&&(_0x3e949e[_0xd565f0(0x104)]=JSON[_0xd565f0(0x17a)](_0x67f5fb[_0xd565f0(0xf7)]));_0x67f5fb[_0xd565f0(0x12c)]&&(_0x3e949e[_0xd565f0(0x12c)]=JSON['stringify'](_0x67f5fb[_0xd565f0(0x12c)]));_0x67f5fb[_0xd565f0(0x102)]&&(_0x67f5fb[_0xd565f0(0x102)]['usdtPolygonWallet']!==undefined&&(_0x3e949e[_0xd565f0(0xe2)]=_0x67f5fb[_0xd565f0(0x102)][_0xd565f0(0xe2)]||null),_0x67f5fb[_0xd565f0(0x102)][_0xd565f0(0xf5)]!==undefined&&(_0x3e949e[_0xd565f0(0xf5)]=_0x67f5fb[_0xd565f0(0x102)]['usdtTrcWallet']||null),_0x67f5fb[_0xd565f0(0x102)]['usdtErcWallet']!==undefined&&(_0x3e949e['usdtErcWallet']=_0x67f5fb['wallets'][_0xd565f0(0x103)]||null),_0x67f5fb[_0xd565f0(0x102)][_0xd565f0(0x174)]!==undefined&&(_0x3e949e[_0xd565f0(0x174)]=_0x67f5fb[_0xd565f0(0x102)]['usdcPolygonWallet']||null));const _0x59b374=await database_1[_0xd565f0(0xf2)][_0xd565f0(0x132)][_0xd565f0(0xe9)]({'where':{'id':_0x14a55b},'data':_0x3e949e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x557a07=[];if(_0x59b374[_0xd565f0(0x10f)]?.[_0xd565f0(0x11b)])try{_0x557a07=Array[_0xd565f0(0x122)](_0x59b374['settings']['webhookEvents'])?_0x59b374[_0xd565f0(0x10f)][_0xd565f0(0x11b)]:JSON[_0xd565f0(0xf4)](_0x59b374[_0xd565f0(0x10f)]['webhookEvents']);}catch(_0x1eb85c){console['error'](_0xd565f0(0x109),_0x1eb85c),_0x557a07=[];}return{'id':_0x59b374['id'],'fullName':_0x59b374[_0xd565f0(0xe4)],'username':_0x59b374['username'],'telegramId':_0x59b374['telegram'],'merchantUrl':_0x59b374[_0xd565f0(0x107)],'gateways':_0x59b374[_0xd565f0(0x104)]?JSON['parse'](_0x59b374[_0xd565f0(0x104)]):null,'gatewaySettings':_0x59b374[_0xd565f0(0x12c)]?JSON[_0xd565f0(0xf4)](_0x59b374[_0xd565f0(0x12c)]):null,'publicKey':_0x59b374['publicKey'],'webhookUrl':_0x59b374[_0xd565f0(0x10f)]?.[_0xd565f0(0x15d)]||null,'webhookEvents':_0x557a07,'wallets':{'usdtPolygonWallet':_0x59b374[_0xd565f0(0xe2)],'usdtTrcWallet':_0x59b374[_0xd565f0(0xf5)],'usdtErcWallet':_0x59b374[_0xd565f0(0x103)],'usdcPolygonWallet':_0x59b374[_0xd565f0(0x174)]},'status':_0x59b374['status'],'createdAt':_0x59b374[_0xd565f0(0x16e)]};}async['updateWallets'](_0x1a2411,_0x3295d2){const _0x121a2a=a54_0x4c2fc2,_0x409cd3={};_0x3295d2[_0x121a2a(0xe2)]!==undefined&&(_0x409cd3[_0x121a2a(0xe2)]=_0x3295d2['usdtPolygonWallet']||null),_0x3295d2[_0x121a2a(0xf5)]!==undefined&&(_0x409cd3[_0x121a2a(0xf5)]=_0x3295d2[_0x121a2a(0xf5)]||null),_0x3295d2['usdtErcWallet']!==undefined&&(_0x409cd3[_0x121a2a(0x103)]=_0x3295d2[_0x121a2a(0x103)]||null),_0x3295d2[_0x121a2a(0x174)]!==undefined&&(_0x409cd3[_0x121a2a(0x174)]=_0x3295d2[_0x121a2a(0x174)]||null),await database_1['default'][_0x121a2a(0x132)]['update']({'where':{'id':_0x1a2411},'data':_0x409cd3});}async[a54_0x4c2fc2(0x12b)](_0x518207){const _0x1b53ab=a54_0x4c2fc2,_0x1e4356=await database_1[_0x1b53ab(0xf2)][_0x1b53ab(0x132)][_0x1b53ab(0xf3)]({'where':{'id':_0x518207},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x1e4356?.[_0x1b53ab(0x10f)]?.['webhookUrl'])throw new Error('No\x20webhook\x20URL\x20configured');const _0x2e6e83={'event':_0x1b53ab(0xe0),'payment':{'id':_0x1b53ab(0x12f),'order_id':_0x1b53ab(0x17f),'gateway':_0x1b53ab(0xe0),'amount':0x64,'currency':_0x1b53ab(0x163),'status':'paid','created_at':new Date()[_0x1b53ab(0x183)]()}};try{const _0x4fecc8=await fetch(_0x1e4356[_0x1b53ab(0x10f)][_0x1b53ab(0x15d)],{'method':_0x1b53ab(0x133),'headers':{'Content-Type':_0x1b53ab(0x121),'User-Agent':_0x1b53ab(0x157)},'body':JSON[_0x1b53ab(0x17a)](_0x2e6e83)});return _0x4fecc8['ok']?{'success':!![],'message':_0x1b53ab(0x114)+_0x4fecc8[_0x1b53ab(0x15a)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x4fecc8[_0x1b53ab(0x15a)]+'\x20'+_0x4fecc8[_0x1b53ab(0xe7)]};}catch(_0x5235c3){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x5235c3 instanceof Error?_0x5235c3[_0x1b53ab(0x145)]:'Unknown\x20error')};}}async[a54_0x4c2fc2(0x144)](_0x129ae0){const _0x666abd=a54_0x4c2fc2;return this['paymentService'][_0x666abd(0x14d)]({'public_key':'','gateway':_0x129ae0[_0x666abd(0xe3)],'order_id':undefined,'amount':_0x129ae0[_0x666abd(0xf0)],'currency':_0x129ae0['currency'],'source_currency':_0x129ae0['sourceCurrency'],'usage':_0x129ae0[_0x666abd(0x112)],'expires_at':_0x129ae0[_0x666abd(0x129)]?.[_0x666abd(0x183)](),'success_url':_0x129ae0[_0x666abd(0x177)],'fail_url':_0x129ae0[_0x666abd(0x177)],'customer_email':_0x129ae0[_0x666abd(0x12e)],'customer_name':_0x129ae0[_0x666abd(0x10c)],'country':_0x129ae0[_0x666abd(0x16c)],'language':_0x129ae0[_0x666abd(0xfe)],'amount_is_editable':_0x129ae0[_0x666abd(0x134)],'max_payments':_0x129ae0['maxPayments'],'customer':_0x129ae0[_0x666abd(0x148)]});}async[a54_0x4c2fc2(0x162)](_0x4737b0,_0x1c2747){const _0x206eb3=a54_0x4c2fc2;return this[_0x206eb3(0x16d)]['getPaymentsByShop'](_0x4737b0,_0x1c2747);}async[a54_0x4c2fc2(0x167)](_0x3e365d,_0x43e077){const _0x3778e2=a54_0x4c2fc2;return this[_0x3778e2(0x16d)]['getPaymentByShopAndId'](_0x3e365d,_0x43e077);}async[a54_0x4c2fc2(0x152)](_0x30ec5d,_0x5c8574,_0x2ed1eb){const _0x2ae449=a54_0x4c2fc2,_0x795549=await database_1[_0x2ae449(0xf2)]['payment'][_0x2ae449(0xf9)]({'where':{'id':_0x5c8574,'shopId':_0x30ec5d}});if(!_0x795549)throw new Error(_0x2ae449(0xea));const _0x56106a=await database_1[_0x2ae449(0xf2)][_0x2ae449(0x150)]['update']({'where':{'id':_0x5c8574},'data':{..._0x2ed1eb,'updatedAt':new Date()}});return _0x56106a;}async[a54_0x4c2fc2(0x10d)](_0x45620a,_0xe3c1a3){const _0x185be6=a54_0x4c2fc2,_0x235301=await database_1[_0x185be6(0xf2)][_0x185be6(0x150)]['findFirst']({'where':{'id':_0xe3c1a3,'shopId':_0x45620a}});if(!_0x235301)throw new Error(_0x185be6(0xea));await database_1[_0x185be6(0xf2)][_0x185be6(0x150)][_0x185be6(0x115)]({'where':{'id':_0xe3c1a3}});}[a54_0x4c2fc2(0x169)](_0xa76642){const _0x20b8bd=a54_0x4c2fc2,_0x4ee237={'polygon':'USDT\x20Polygon','trc20':_0x20b8bd(0x11e),'erc20':'USDT\x20ERC20','bsc':_0x20b8bd(0x172),'polygon_usdc':_0x20b8bd(0x14c)};return _0x4ee237[_0xa76642]||_0xa76642;}async[a54_0x4c2fc2(0xe8)](_0x6885b,_0x4860f9){const _0x232560=a54_0x4c2fc2,{page:_0x317630,limit:_0x25a835,status:_0x136f7c,method:_0xc3251a,network:_0x54cc3a,dateFrom:_0x224fd9,dateTo:_0x15c4ab,periodFrom:_0x2a9d00,periodTo:_0x3f2620}=_0x4860f9,_0x1bd703=(_0x317630-0x1)*_0x25a835;console[_0x232560(0x16f)](_0x232560(0x17e),_0x4860f9);const _0xadccbe={'shopId':_0x6885b};_0x136f7c&&(_0xadccbe[_0x232560(0x15a)]=_0x136f7c[_0x232560(0x179)](),console[_0x232560(0x16f)](_0x232560(0xfb)+_0x136f7c[_0x232560(0x179)]()));if(_0xc3251a)_0xadccbe[_0x232560(0xe5)]=_0xc3251a,console[_0x232560(0x16f)](_0x232560(0x142)+_0xc3251a);else _0x54cc3a&&(_0xadccbe[_0x232560(0xe5)]=_0x54cc3a,console[_0x232560(0x16f)](_0x232560(0xdd)+_0x54cc3a));if(_0x224fd9||_0x15c4ab||_0x2a9d00||_0x3f2620){_0xadccbe[_0x232560(0x16e)]={};if(_0x2a9d00){const _0x2601f7=new Date(_0x2a9d00);_0x2601f7[_0x232560(0x155)](0x0,0x0,0x0,0x0),_0xadccbe[_0x232560(0x16e)][_0x232560(0x165)]=_0x2601f7,console[_0x232560(0x16f)]('üìÖ\x20Period\x20start:\x20'+_0x2601f7[_0x232560(0x183)]());}else{if(_0x224fd9){const _0x372922=new Date(_0x224fd9);_0x372922['setHours'](0x0,0x0,0x0,0x0),_0xadccbe[_0x232560(0x16e)][_0x232560(0x165)]=_0x372922,console[_0x232560(0x16f)](_0x232560(0x140)+_0x372922[_0x232560(0x183)]());}}if(_0x3f2620){const _0x44feaa=new Date(_0x3f2620);_0x44feaa[_0x232560(0x155)](0x17,0x3b,0x3b,0x3e7),_0xadccbe[_0x232560(0x16e)][_0x232560(0x125)]=_0x44feaa,console[_0x232560(0x16f)]('üìÖ\x20Period\x20end:\x20'+_0x44feaa[_0x232560(0x183)]());}else{if(_0x15c4ab){const _0x26abd4=new Date(_0x15c4ab);_0x26abd4[_0x232560(0x155)](0x17,0x3b,0x3b,0x3e7),_0xadccbe['createdAt'][_0x232560(0x125)]=_0x26abd4,console[_0x232560(0x16f)](_0x232560(0x10e)+_0x26abd4['toISOString']());}}}console[_0x232560(0x16f)](_0x232560(0x13f),JSON[_0x232560(0x17a)](_0xadccbe,null,0x2));const [_0x247d11,_0x118f03]=await Promise[_0x232560(0x13a)]([database_1[_0x232560(0xf2)][_0x232560(0x106)]['findMany']({'where':_0xadccbe,'skip':_0x1bd703,'take':_0x25a835,'orderBy':{'createdAt':_0x232560(0x12d)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x232560(0x106)]['count']({'where':_0xadccbe})]);return{'payouts':_0x247d11[_0x232560(0x13d)](_0x1eda84=>{const _0x28fda1=_0x232560;let _0x98471=null;switch(_0x1eda84[_0x28fda1(0xe5)]){case'polygon':_0x98471=_0x1eda84[_0x28fda1(0x132)][_0x28fda1(0xe2)];break;case _0x28fda1(0xdf):_0x98471=_0x1eda84['shop']['usdtTrcWallet'];break;case _0x28fda1(0x100):_0x98471=_0x1eda84[_0x28fda1(0x132)][_0x28fda1(0x103)];break;case'polygon_usdc':_0x98471=_0x1eda84[_0x28fda1(0x132)][_0x28fda1(0x174)];break;}return{'id':_0x1eda84['id'],'amount':_0x1eda84[_0x28fda1(0xf0)],'network':this[_0x28fda1(0x169)](_0x1eda84[_0x28fda1(0xe5)]),'wallet':_0x98471,'status':_0x1eda84[_0x28fda1(0x15a)],'txid':_0x1eda84['txid'],'notes':_0x1eda84['notes'],'periodFrom':_0x1eda84[_0x28fda1(0x127)],'periodTo':_0x1eda84[_0x28fda1(0x13b)],'createdAt':_0x1eda84[_0x28fda1(0x16e)],'paidAt':_0x1eda84[_0x28fda1(0x113)]};}),'pagination':{'page':_0x317630,'limit':_0x25a835,'total':_0x118f03,'totalPages':Math['ceil'](_0x118f03/_0x25a835)}};}async[a54_0x4c2fc2(0x11a)](_0x1fce3c,_0x80ce0f){const _0x32af2a=a54_0x4c2fc2,_0x57f120=await database_1[_0x32af2a(0xf2)]['payout'][_0x32af2a(0xf9)]({'where':{'id':_0x80ce0f,'shopId':_0x1fce3c}});if(!_0x57f120)return null;return{'id':_0x57f120['id'],'amount':_0x57f120['amount'],'network':_0x57f120[_0x32af2a(0xe5)],'status':_0x57f120[_0x32af2a(0x15a)],'txid':_0x57f120[_0x32af2a(0x151)],'notes':_0x57f120[_0x32af2a(0x119)],'createdAt':_0x57f120[_0x32af2a(0x16e)],'paidAt':_0x57f120[_0x32af2a(0x113)]};}async[a54_0x4c2fc2(0x15f)](_0x599107,_0x49c2e7){const _0x543657=a54_0x4c2fc2,_0x22da2c=new Date();let _0xb1f7f8;switch(_0x49c2e7){case'7d':_0xb1f7f8=new Date(_0x22da2c['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0xb1f7f8=new Date(_0x22da2c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x543657(0xec):_0xb1f7f8=new Date(_0x22da2c[_0x543657(0x17b)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xb1f7f8=new Date(_0x22da2c[_0x543657(0x17b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x320f9e,_0x5e28cc,_0x3b27df,_0x14732f,_0x237d2e,_0x4b2eda]=await Promise[_0x543657(0x13a)]([database_1[_0x543657(0xf2)][_0x543657(0x106)][_0x543657(0x120)]({'where':{'shopId':_0x599107,'createdAt':{'gte':_0xb1f7f8}}}),database_1[_0x543657(0xf2)][_0x543657(0x106)][_0x543657(0x120)]({'where':{'shopId':_0x599107,'status':_0x543657(0x158),'createdAt':{'gte':_0xb1f7f8}}}),database_1['default'][_0x543657(0x106)]['count']({'where':{'shopId':_0x599107,'status':_0x543657(0x116),'createdAt':{'gte':_0xb1f7f8}}}),database_1[_0x543657(0xf2)]['payout']['count']({'where':{'shopId':_0x599107,'status':_0x543657(0x15b),'createdAt':{'gte':_0xb1f7f8}}}),database_1['default'][_0x543657(0x106)][_0x543657(0x159)]({'where':{'shopId':_0x599107,'createdAt':{'gte':_0xb1f7f8}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x543657(0xf2)][_0x543657(0x106)][_0x543657(0x159)]({'where':{'shopId':_0x599107},'take':0xa,'orderBy':{'createdAt':_0x543657(0x12d)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x53b9ea=_0x237d2e[_0x543657(0xf1)]((_0x587506,_0x31b3d5)=>_0x587506+_0x31b3d5[_0x543657(0xf0)],0x0),_0x41de25=_0x237d2e[_0x543657(0x111)](_0xbd84bd=>_0xbd84bd[_0x543657(0x15a)]===_0x543657(0x158))['reduce']((_0x49fb71,_0x3b629e)=>_0x49fb71+_0x3b629e[_0x543657(0xf0)],0x0),_0x31e1ca=_0x237d2e[_0x543657(0x111)](_0x563426=>_0x563426['status']===_0x543657(0x116))['reduce']((_0x47c252,_0x2479d2)=>_0x47c252+_0x2479d2[_0x543657(0xf0)],0x0),_0x5a66da=_0x237d2e[_0x543657(0xf1)]((_0x427d1e,_0x42e02a)=>{const _0x2729db=_0x543657;return _0x427d1e[_0x42e02a['network']]=(_0x427d1e[_0x42e02a[_0x2729db(0xe5)]]||0x0)+0x1,_0x427d1e;},{}),_0x22f82e=_0x237d2e[_0x543657(0xf1)]((_0x9e7f93,_0x51ddf8)=>{const _0x52774a=_0x543657;return _0x9e7f93[_0x51ddf8[_0x52774a(0x15a)]]=(_0x9e7f93[_0x51ddf8['status']]||0x0)+0x1,_0x9e7f93;},{});return{'totalPayouts':_0x320f9e,'completedPayouts':_0x5e28cc,'pendingPayouts':_0x3b27df,'rejectedPayouts':_0x14732f,'totalAmount':_0x53b9ea,'completedAmount':_0x41de25,'pendingAmount':_0x31e1ca,'payoutsByMethod':_0x5a66da,'payoutsByStatus':_0x22f82e,'recentPayouts':_0x4b2eda[_0x543657(0x13d)](_0x4315ad=>({'id':_0x4315ad['id'],'shopId':_0x599107,'amount':_0x4315ad[_0x543657(0xf0)],'method':_0x4315ad[_0x543657(0xe5)],'status':_0x4315ad[_0x543657(0x15a)],'txid':_0x4315ad['txid'],'createdAt':_0x4315ad[_0x543657(0x16e)],'paidAt':_0x4315ad['paidAt']}))};}async['getShopPayoutStats'](_0x810e13){const _0x3ba9d4=a54_0x4c2fc2;console['log'](_0x3ba9d4(0x16b)+_0x810e13+_0x3ba9d4(0x108));const _0x38e200=await database_1[_0x3ba9d4(0xf2)][_0x3ba9d4(0x132)][_0x3ba9d4(0xf3)]({'where':{'id':_0x810e13},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x38e200)throw new Error(_0x3ba9d4(0x137));const _0x292834=new Date(),_0x4c741e=new Date(_0x292834[_0x3ba9d4(0x156)](),_0x292834[_0x3ba9d4(0x143)](),0x1),_0x4e136e=new Date(_0x292834['getFullYear'](),_0x292834[_0x3ba9d4(0x143)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x24146a=await database_1[_0x3ba9d4(0xf2)]['payout'][_0x3ba9d4(0x160)]({'_sum':{'amount':!![]},'where':{'shopId':_0x810e13,'createdAt':{'gte':_0x4c741e,'lte':_0x4e136e},'status':_0x3ba9d4(0x158)}}),_0x13a6f1=_0x24146a[_0x3ba9d4(0x153)][_0x3ba9d4(0xf0)]||0x0,_0x3e9476={'availableBalance':Math[_0x3ba9d4(0x138)](_0x38e200['balance']*0x64)/0x64,'totalPaidOut':Math['round'](_0x38e200[_0x3ba9d4(0x181)]*0x64)/0x64,'awaitingPayout':Math[_0x3ba9d4(0x138)](_0x38e200['balance']*0x64)/0x64,'thisMonth':Math['round'](_0x13a6f1*0x64)/0x64};return console[_0x3ba9d4(0x16f)]('üìä\x20Shop\x20'+_0x38e200['username']+_0x3ba9d4(0xde)),console[_0x3ba9d4(0x16f)](_0x3ba9d4(0x14e)+_0x3e9476[_0x3ba9d4(0x176)]+_0x3ba9d4(0x13e)),console['log'](_0x3ba9d4(0xee)+_0x3e9476[_0x3ba9d4(0x181)]+'\x20USDT\x20(total\x20payouts)'),console['log']('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x3e9476[_0x3ba9d4(0xed)]+_0x3ba9d4(0x13e)),console['log'](_0x3ba9d4(0x126)+_0x3e9476[_0x3ba9d4(0x16a)]+_0x3ba9d4(0x11d)),_0x3e9476;}[a54_0x4c2fc2(0x130)](_0x3da821){const _0x655f2=a54_0x4c2fc2,_0x4efe7d={'test_gateway':_0x655f2(0x15c),'plisio':_0x655f2(0x182),'rapyd':_0x655f2(0x178),'noda':'Noda','cointopay':_0x655f2(0xef),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x655f2(0x17d)};return _0x4efe7d[_0x3da821]||_0x3da821;}async[a54_0x4c2fc2(0xfd)](_0x5605b0){const _0x37ce97=a54_0x4c2fc2;return this[_0x37ce97(0x146)](_0x5605b0);}async['getWebhookLogs'](_0x253163,_0x2d3070){const _0x2206ae=a54_0x4c2fc2,{page:_0x139e31,limit:_0x2d1df6,paymentId:_0x2d799c}=_0x2d3070,_0x3e81ef=(_0x139e31-0x1)*_0x2d1df6,_0x15ec11={'shopId':_0x253163};_0x2d799c&&(_0x15ec11[_0x2206ae(0x149)]=_0x2d799c);const [_0x10689f,_0x51e66b]=await Promise[_0x2206ae(0x13a)]([database_1['default'][_0x2206ae(0x136)]['findMany']({'where':_0x15ec11,'skip':_0x3e81ef,'take':_0x2d1df6,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x2206ae(0x136)]['count']({'where':_0x15ec11})]);return{'logs':_0x10689f[_0x2206ae(0x13d)](_0x13f8dc=>({'id':_0x13f8dc['id'],'paymentId':_0x13f8dc[_0x2206ae(0x149)],'shopId':_0x13f8dc[_0x2206ae(0x12a)],'event':_0x13f8dc[_0x2206ae(0x184)],'statusCode':_0x13f8dc['statusCode'],'retryCount':_0x13f8dc[_0x2206ae(0xe1)],'responseBody':_0x13f8dc['responseBody'],'createdAt':_0x13f8dc[_0x2206ae(0x16e)],'payment':_0x13f8dc[_0x2206ae(0x150)]})),'pagination':{'page':_0x139e31,'limit':_0x2d1df6,'total':_0x51e66b,'totalPages':Math[_0x2206ae(0x110)](_0x51e66b/_0x2d1df6)}};}async[a54_0x4c2fc2(0xe6)](_0x544d3e,_0x177c92){const _0x39c0a6=a54_0x4c2fc2,_0x28c55f=new Date();let _0xbede4c;switch(_0x177c92){case'7d':_0xbede4c=new Date(_0x28c55f[_0x39c0a6(0x17b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x39c0a6(0x170):_0xbede4c=new Date(_0x28c55f['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x39c0a6(0xec):_0xbede4c=new Date(_0x28c55f[_0x39c0a6(0x17b)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xbede4c=new Date(_0x28c55f['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x41ec13,_0x5a9700,_0x5c27b7,_0x124383,_0x5f131c]=await Promise['all']([database_1[_0x39c0a6(0xf2)][_0x39c0a6(0x150)]['count']({'where':{'shopId':_0x544d3e,'gateway':{'not':_0x39c0a6(0x154)},'createdAt':{'gte':_0xbede4c}}}),database_1[_0x39c0a6(0xf2)]['payment'][_0x39c0a6(0x120)]({'where':{'shopId':_0x544d3e,'gateway':{'not':'test_gateway'},'status':_0x39c0a6(0x14a),'createdAt':{'gte':_0xbede4c}}}),database_1[_0x39c0a6(0xf2)][_0x39c0a6(0x150)][_0x39c0a6(0x159)]({'where':{'shopId':_0x544d3e,'gateway':{'not':'test_gateway'},'status':_0x39c0a6(0x14a),'createdAt':{'gte':_0xbede4c}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x39c0a6(0xf2)][_0x39c0a6(0x150)][_0x39c0a6(0x159)]({'where':{'shopId':_0x544d3e,'gateway':{'not':_0x39c0a6(0x154)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x39c0a6(0xf2)][_0x39c0a6(0x150)][_0x39c0a6(0x159)]({'where':{'shopId':_0x544d3e,'gateway':{'not':_0x39c0a6(0x154)},'createdAt':{'gte':_0xbede4c}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x39c0a6(0x17c)}})]);let _0x152283=0x0;for(const _0x329575 of _0x5c27b7){if(_0x329575['amountUSDT'])_0x152283+=_0x329575[_0x39c0a6(0x10a)];else{const _0x541173=await currencyService_1[_0x39c0a6(0x131)][_0x39c0a6(0x128)](_0x329575[_0x39c0a6(0xf0)],_0x329575[_0x39c0a6(0x10b)]);_0x152283+=_0x541173;}}const _0x5c8694=this[_0x39c0a6(0x180)](_0x5f131c,_0xbede4c,_0x28c55f),_0x25d28b=_0x41ec13>0x0?_0x5a9700/_0x41ec13*0x64:0x0;return{'totalPayments':_0x41ec13,'successfulPayments':_0x5a9700,'totalRevenue':Math[_0x39c0a6(0x138)](_0x152283*0x64)/0x64,'conversionRate':Math['round'](_0x25d28b*0x64)/0x64,'dailyRevenue':_0x5c8694[_0x39c0a6(0x175)],'dailyPayments':_0x5c8694[_0x39c0a6(0xf6)],'recentPayments':_0x124383[_0x39c0a6(0x13d)](_0x5bbad5=>({'id':_0x5bbad5['id'],'gateway':_0x5bbad5[_0x39c0a6(0xe3)],'amount':_0x5bbad5[_0x39c0a6(0xf0)],'currency':_0x5bbad5['currency'],'status':_0x5bbad5[_0x39c0a6(0x15a)],'createdAt':_0x5bbad5['createdAt']}))};}[a54_0x4c2fc2(0x180)](_0x3162e0,_0x1d5533,_0x4dc9da){const _0x586faa=a54_0x4c2fc2,_0xed5442=new Map(),_0x4dadb8=new Date(_0x1d5533);while(_0x4dadb8<=_0x4dc9da){const _0x1a2fd9=_0x4dadb8[_0x586faa(0x183)]()[_0x586faa(0x173)]('T')[0x0];_0xed5442['set'](_0x1a2fd9,{'revenue':0x0,'count':0x0}),_0x4dadb8[_0x586faa(0x117)](_0x4dadb8['getDate']()+0x1);}for(const _0x3da319 of _0x3162e0){const _0x329a56=_0x3da319[_0x586faa(0x16e)][_0x586faa(0x183)]()['split']('T')[0x0],_0x2f74bf=_0xed5442[_0x586faa(0x123)](_0x329a56);_0x2f74bf&&(_0x2f74bf[_0x586faa(0x120)]+=0x1,_0x3da319[_0x586faa(0x15a)]===_0x586faa(0x14a)&&_0x3da319[_0x586faa(0x10a)]&&(_0x2f74bf[_0x586faa(0x11f)]+=_0x3da319[_0x586faa(0x10a)]));}const _0x1473f9=[],_0x3a47c2=[];for(const [_0x1471b5,_0x4e46da]of _0xed5442){_0x1473f9[_0x586faa(0xfa)]({'date':_0x1471b5,'amount':Math[_0x586faa(0x138)](_0x4e46da[_0x586faa(0x11f)]*0x64)/0x64}),_0x3a47c2[_0x586faa(0xfa)]({'date':_0x1471b5,'count':_0x4e46da['count']});}return{'dailyRevenue':_0x1473f9,'dailyPayments':_0x3a47c2};}}exports[a54_0x4c2fc2(0x168)]=ShopService;