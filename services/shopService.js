'use strict';const a77_0x269a70=a77_0x2101;(function(_0x2e8870,_0x33ee6f){const _0x14a823=a77_0x2101,_0x3e5192=_0x2e8870();while(!![]){try{const _0x478e43=parseInt(_0x14a823(0x114))/0x1+parseInt(_0x14a823(0x16f))/0x2+parseInt(_0x14a823(0xee))/0x3*(-parseInt(_0x14a823(0x13b))/0x4)+-parseInt(_0x14a823(0xd7))/0x5+-parseInt(_0x14a823(0x14e))/0x6+parseInt(_0x14a823(0xec))/0x7+parseInt(_0x14a823(0x98))/0x8*(parseInt(_0x14a823(0xc7))/0x9);if(_0x478e43===_0x33ee6f)break;else _0x3e5192['push'](_0x3e5192['shift']());}catch(_0x1e0fa1){_0x3e5192['push'](_0x3e5192['shift']());}}}(a77_0x2151,0x332f7));var __importDefault=this&&this['__importDefault']||function(_0x243af8){const _0x2a8f01=a77_0x2101;return _0x243af8&&_0x243af8[_0x2a8f01(0xcd)]?_0x243af8:{'default':_0x243af8};};function a77_0x2101(_0x26f252,_0x1e4ca9){_0x26f252=_0x26f252-0x93;const _0x21513b=a77_0x2151();let _0x21019=_0x21513b[_0x26f252];return _0x21019;}Object[a77_0x269a70(0x10f)](exports,a77_0x269a70(0xcd),{'value':!![]}),exports[a77_0x269a70(0xa1)]=void 0x0;const database_1=__importDefault(require(a77_0x269a70(0xd5))),bcryptjs_1=__importDefault(require(a77_0x269a70(0x10e))),crypto_1=__importDefault(require('crypto')),speakeasy_1=__importDefault(require(a77_0x269a70(0x14d))),qrcode_1=__importDefault(require(a77_0x269a70(0x142))),currencyService_1=require(a77_0x269a70(0x11d)),paymentService_1=require(a77_0x269a70(0xd2)),gateway_1=require(a77_0x269a70(0xdd));class ShopService{constructor(){const _0x23ae22=a77_0x269a70;this[_0x23ae22(0xf3)]=new paymentService_1['PaymentService']();}async[a77_0x269a70(0x147)](_0x2d6bb1){const _0x422d0a=a77_0x269a70,_0x2f00c4=await database_1[_0x422d0a(0x124)][_0x422d0a(0xc8)][_0x422d0a(0x136)]({'where':{'id':_0x2d6bb1},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2f00c4)throw new Error(_0x422d0a(0x95));let _0x43a8e4=[];if(_0x2f00c4[_0x422d0a(0x15e)]?.[_0x422d0a(0x12f)])try{_0x43a8e4=Array[_0x422d0a(0xc5)](_0x2f00c4[_0x422d0a(0x15e)][_0x422d0a(0x12f)])?_0x2f00c4['settings'][_0x422d0a(0x12f)]:JSON['parse'](_0x2f00c4[_0x422d0a(0x15e)]['webhookEvents']);}catch(_0x3ee5fa){console['error'](_0x422d0a(0x97),_0x3ee5fa),_0x43a8e4=[];}const _0x579250=gateway_1[_0x422d0a(0x122)][_0x422d0a(0xcf)](_0x5e093c=>_0x5e093c['isActive'])['map'](_0x4e5218=>_0x4e5218[_0x422d0a(0x166)]);let _0xb2a3a4=_0x2f00c4[_0x422d0a(0x110)]?JSON[_0x422d0a(0xbf)](_0x2f00c4[_0x422d0a(0x110)]):[];return Array['isArray'](_0xb2a3a4)&&(_0xb2a3a4=_0xb2a3a4['filter'](_0xa7dfa2=>_0x579250['includes'](_0xa7dfa2))),{'id':_0x2f00c4['id'],'fullName':_0x2f00c4[_0x422d0a(0x166)],'username':_0x2f00c4['username'],'telegramId':_0x2f00c4[_0x422d0a(0xa0)],'merchantUrl':_0x2f00c4[_0x422d0a(0xe9)],'gateways':_0xb2a3a4,'gatewaySettings':_0x2f00c4[_0x422d0a(0x9e)]?JSON[_0x422d0a(0xbf)](_0x2f00c4[_0x422d0a(0x9e)]):null,'publicKey':_0x2f00c4[_0x422d0a(0xc2)],'webhookUrl':_0x2f00c4[_0x422d0a(0x15e)]?.['webhookUrl']||null,'webhookEvents':_0x43a8e4,'wallets':{'usdtPolygonWallet':_0x2f00c4[_0x422d0a(0x164)],'usdtTrcWallet':_0x2f00c4['usdtTrcWallet'],'usdtErcWallet':_0x2f00c4[_0x422d0a(0x104)],'usdcPolygonWallet':_0x2f00c4['usdcPolygonWallet'],'usdcErcWallet':_0x2f00c4[_0x422d0a(0x116)]},'status':_0x2f00c4[_0x422d0a(0x14c)],'createdAt':_0x2f00c4[_0x422d0a(0xe3)]};}async[a77_0x269a70(0x146)](_0x2cb43e,_0x141463){const _0x44f773=a77_0x269a70,_0x450999={};_0x141463['fullName']&&(_0x450999[_0x44f773(0x166)]=_0x141463['fullName']);_0x141463[_0x44f773(0xbe)]!==undefined&&(_0x450999[_0x44f773(0xa0)]=_0x141463['telegramId']||null);_0x141463[_0x44f773(0x151)]&&(_0x450999[_0x44f773(0xe9)]=_0x141463[_0x44f773(0x151)]);_0x141463[_0x44f773(0xc1)]&&(_0x450999['paymentGateways']=JSON[_0x44f773(0xe2)](_0x141463[_0x44f773(0xc1)]));_0x141463[_0x44f773(0x9e)]&&(_0x450999[_0x44f773(0x9e)]=JSON['stringify'](_0x141463[_0x44f773(0x9e)]));_0x141463[_0x44f773(0x163)]&&(_0x141463['wallets'][_0x44f773(0x164)]!==undefined&&(_0x450999['usdtPolygonWallet']=_0x141463[_0x44f773(0x163)][_0x44f773(0x164)]||null),_0x141463['wallets']['usdtTrcWallet']!==undefined&&(_0x450999[_0x44f773(0x11b)]=_0x141463[_0x44f773(0x163)][_0x44f773(0x11b)]||null),_0x141463[_0x44f773(0x163)][_0x44f773(0x104)]!==undefined&&(_0x450999[_0x44f773(0x104)]=_0x141463['wallets'][_0x44f773(0x104)]||null),_0x141463[_0x44f773(0x163)][_0x44f773(0xc4)]!==undefined&&(_0x450999[_0x44f773(0xc4)]=_0x141463['wallets'][_0x44f773(0xc4)]||null));const _0x2b8de4=await database_1[_0x44f773(0x124)][_0x44f773(0xc8)][_0x44f773(0x9a)]({'where':{'id':_0x2cb43e},'data':_0x450999,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x5e84a5=[];if(_0x2b8de4[_0x44f773(0x15e)]?.['webhookEvents'])try{_0x5e84a5=Array[_0x44f773(0xc5)](_0x2b8de4[_0x44f773(0x15e)][_0x44f773(0x12f)])?_0x2b8de4[_0x44f773(0x15e)][_0x44f773(0x12f)]:JSON[_0x44f773(0xbf)](_0x2b8de4[_0x44f773(0x15e)][_0x44f773(0x12f)]);}catch(_0x3f9916){console[_0x44f773(0x119)](_0x44f773(0x97),_0x3f9916),_0x5e84a5=[];}return{'id':_0x2b8de4['id'],'fullName':_0x2b8de4[_0x44f773(0x166)],'username':_0x2b8de4[_0x44f773(0xeb)],'telegramId':_0x2b8de4['telegram'],'merchantUrl':_0x2b8de4[_0x44f773(0xe9)],'gateways':_0x2b8de4[_0x44f773(0x110)]?JSON[_0x44f773(0xbf)](_0x2b8de4[_0x44f773(0x110)]):null,'gatewaySettings':_0x2b8de4['gatewaySettings']?JSON['parse'](_0x2b8de4['gatewaySettings']):null,'publicKey':_0x2b8de4[_0x44f773(0xc2)],'webhookUrl':_0x2b8de4['settings']?.['webhookUrl']||null,'webhookEvents':_0x5e84a5,'wallets':{'usdtPolygonWallet':_0x2b8de4['usdtPolygonWallet'],'usdtTrcWallet':_0x2b8de4[_0x44f773(0x11b)],'usdtErcWallet':_0x2b8de4[_0x44f773(0x104)],'usdcPolygonWallet':_0x2b8de4[_0x44f773(0xc4)],'usdcErcWallet':_0x2b8de4['usdcErcWallet']},'status':_0x2b8de4[_0x44f773(0x14c)],'createdAt':_0x2b8de4['createdAt']};}async[a77_0x269a70(0x15f)](_0xdbcec6,_0x1a315a){const _0x1566cd=a77_0x269a70,_0x4a3556=await database_1[_0x1566cd(0x124)][_0x1566cd(0xc8)][_0x1566cd(0x136)]({'where':{'id':_0xdbcec6},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x4a3556)throw new Error(_0x1566cd(0x95));if(_0x4a3556['twoFactorEnabled']){if(!_0x1a315a[_0x1566cd(0xf6)])throw new Error(_0x1566cd(0xa3));const _0x2f93e9=speakeasy_1[_0x1566cd(0x124)]['totp'][_0x1566cd(0xe8)]({'secret':_0x4a3556[_0x1566cd(0x161)],'encoding':'base32','token':_0x1a315a['twoFactorToken'],'window':0x2});if(!_0x2f93e9){let _0xef8757=![];if(_0x4a3556[_0x1566cd(0x101)]){const _0x52c9c0=JSON[_0x1566cd(0xbf)](_0x4a3556[_0x1566cd(0x101)]);for(let _0x468cd6=0x0;_0x468cd6<_0x52c9c0[_0x1566cd(0xe1)];_0x468cd6++){const _0x5717a2=await bcryptjs_1[_0x1566cd(0x124)][_0x1566cd(0x129)](_0x1a315a[_0x1566cd(0xf6)],_0x52c9c0[_0x468cd6]);if(_0x5717a2){_0xef8757=!![],_0x52c9c0[_0x1566cd(0x153)](_0x468cd6,0x1),await database_1[_0x1566cd(0x124)][_0x1566cd(0xc8)]['update']({'where':{'id':_0xdbcec6},'data':{'backupCodes':JSON[_0x1566cd(0xe2)](_0x52c9c0)}});break;}}}if(!_0xef8757)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x2102bd={};_0x1a315a[_0x1566cd(0x164)]!==undefined&&(_0x2102bd[_0x1566cd(0x164)]=_0x1a315a['usdtPolygonWallet']||null),_0x1a315a[_0x1566cd(0x11b)]!==undefined&&(_0x2102bd['usdtTrcWallet']=_0x1a315a[_0x1566cd(0x11b)]||null),_0x1a315a[_0x1566cd(0x104)]!==undefined&&(_0x2102bd['usdtErcWallet']=_0x1a315a['usdtErcWallet']||null),_0x1a315a[_0x1566cd(0xc4)]!==undefined&&(_0x2102bd[_0x1566cd(0xc4)]=_0x1a315a[_0x1566cd(0xc4)]||null),_0x1a315a[_0x1566cd(0x116)]!==undefined&&(_0x2102bd[_0x1566cd(0x116)]=_0x1a315a['usdcErcWallet']||null),await database_1['default'][_0x1566cd(0xc8)][_0x1566cd(0x9a)]({'where':{'id':_0xdbcec6},'data':_0x2102bd});}async[a77_0x269a70(0x150)](_0x227e0f){const _0x443945=a77_0x269a70,_0x424395=await database_1[_0x443945(0x124)][_0x443945(0xc8)]['findUnique']({'where':{'id':_0x227e0f},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x424395?.[_0x443945(0x15e)]?.[_0x443945(0x152)])throw new Error(_0x443945(0xfc));const _0x50a079={'event':_0x443945(0x10b),'payment':{'id':'test_payment_123','order_id':_0x443945(0x11a),'gateway':_0x443945(0x10b),'amount':0x64,'currency':_0x443945(0x158),'status':_0x443945(0xf8),'created_at':new Date()[_0x443945(0xd4)]()}};try{const _0x4ceb8b=await fetch(_0x424395['settings'][_0x443945(0x152)],{'method':_0x443945(0x9f),'headers':{'Content-Type':_0x443945(0x127),'User-Agent':_0x443945(0x165)},'body':JSON[_0x443945(0xe2)](_0x50a079)});return _0x4ceb8b['ok']?{'success':!![],'message':_0x443945(0x13c)+_0x4ceb8b[_0x443945(0x14c)]+')'}:{'success':![],'message':_0x443945(0x14f)+_0x4ceb8b[_0x443945(0x14c)]+'\x20'+_0x4ceb8b[_0x443945(0xfe)]};}catch(_0x54ed13){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x54ed13 instanceof Error?_0x54ed13['message']:_0x443945(0xea))};}}async[a77_0x269a70(0xa7)](_0x56318d){const _0x4b3251=a77_0x269a70;return this[_0x4b3251(0xf3)][_0x4b3251(0x9c)]({'public_key':'','gateway':_0x56318d[_0x4b3251(0x96)],'order_id':undefined,'amount':_0x56318d[_0x4b3251(0x9b)],'currency':_0x56318d[_0x4b3251(0x9d)],'source_currency':_0x56318d[_0x4b3251(0x162)],'usage':_0x56318d[_0x4b3251(0x11f)],'expires_at':_0x56318d[_0x4b3251(0x14a)]?.[_0x4b3251(0xd4)](),'success_url':_0x56318d[_0x4b3251(0xd1)],'fail_url':_0x56318d[_0x4b3251(0xd1)],'customer_email':_0x56318d[_0x4b3251(0x135)],'customer_name':_0x56318d[_0x4b3251(0xb2)],'country':_0x56318d[_0x4b3251(0xe7)],'language':_0x56318d['language'],'amount_is_editable':_0x56318d[_0x4b3251(0x121)],'max_payments':_0x56318d[_0x4b3251(0x145)],'customer':_0x56318d['customer']});}async['getPayments'](_0x7a66df,_0x1d2066){return this['paymentService']['getPaymentsByShop'](_0x7a66df,_0x1d2066);}async[a77_0x269a70(0xae)](_0x4b0409,_0x14801c){const _0x2e53d1=a77_0x269a70;return this[_0x2e53d1(0xf3)][_0x2e53d1(0xf5)](_0x4b0409,_0x14801c);}async['updatePayment'](_0x19704e,_0x5dda32,_0x1d1c13){const _0x5e6498=a77_0x269a70,_0x57a41c=await database_1[_0x5e6498(0x124)][_0x5e6498(0x15d)][_0x5e6498(0xa4)]({'where':{'id':_0x5dda32,'shopId':_0x19704e}});if(!_0x57a41c)throw new Error(_0x5e6498(0x12e));const _0x4bc072=await database_1[_0x5e6498(0x124)]['payment'][_0x5e6498(0x9a)]({'where':{'id':_0x5dda32},'data':{..._0x1d1c13,'updatedAt':new Date()}});return _0x4bc072;}async[a77_0x269a70(0x12d)](_0x44ce7a,_0x5c0273){const _0xd26aac=a77_0x269a70,_0x3ed271=await database_1[_0xd26aac(0x124)][_0xd26aac(0x15d)][_0xd26aac(0xa4)]({'where':{'id':_0x5c0273,'shopId':_0x44ce7a}});if(!_0x3ed271)throw new Error(_0xd26aac(0x12e));await database_1[_0xd26aac(0x124)][_0xd26aac(0x15d)]['delete']({'where':{'id':_0x5c0273}});}[a77_0x269a70(0xe4)](_0x1e3936){const _0x1447c7=a77_0x269a70,_0x5222cd={'polygon':_0x1447c7(0x140),'trc20':'USDT\x20TRC20','erc20':_0x1447c7(0x16b),'bsc':_0x1447c7(0xaf),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x1447c7(0x148)};return _0x5222cd[_0x1e3936]||_0x1e3936;}async['getPayouts'](_0x4cd1a5,_0x2a23b0){const _0x3e7a71=a77_0x269a70,{page:_0x861cb2,limit:_0x44d0e4,status:_0x5896b5,method:_0x1979d3,network:_0x405bcb,dateFrom:_0x302a4a,dateTo:_0x40b6b0,periodFrom:_0x1edfdd,periodTo:_0x2304bb}=_0x2a23b0,_0x349d2e=(_0x861cb2-0x1)*_0x44d0e4;console[_0x3e7a71(0xb3)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x2a23b0);const _0x1b83ea={'shopId':_0x4cd1a5};_0x5896b5&&(_0x1b83ea['status']=_0x5896b5['toUpperCase'](),console['log'](_0x3e7a71(0x16c)+_0x5896b5[_0x3e7a71(0x144)]()));if(_0x1979d3)_0x1b83ea['network']=_0x1979d3,console[_0x3e7a71(0xb3)](_0x3e7a71(0xad)+_0x1979d3);else _0x405bcb&&(_0x1b83ea[_0x3e7a71(0x11c)]=_0x405bcb,console['log'](_0x3e7a71(0xb7)+_0x405bcb));if(_0x302a4a||_0x40b6b0||_0x1edfdd||_0x2304bb){_0x1b83ea['createdAt']={};if(_0x1edfdd){const _0x1e702d=new Date(_0x1edfdd);_0x1e702d['setHours'](0x0,0x0,0x0,0x1),_0x1b83ea[_0x3e7a71(0xe3)]['gte']=_0x1e702d,console[_0x3e7a71(0xb3)](_0x3e7a71(0x15c)+_0x1e702d['toISOString']());}else{if(_0x302a4a){const _0x4bed67=new Date(_0x302a4a);_0x4bed67[_0x3e7a71(0x130)](0x0,0x0,0x0,0x1),_0x1b83ea[_0x3e7a71(0xe3)]['gte']=_0x4bed67,console['log']('üìÖ\x20Date\x20start:\x20'+_0x4bed67['toISOString']());}}if(_0x2304bb){const _0x4f1055=new Date(_0x2304bb);_0x4f1055[_0x3e7a71(0x130)](0x17,0x3b,0x3b,0x3e7),_0x1b83ea['createdAt'][_0x3e7a71(0xbb)]=_0x4f1055,console[_0x3e7a71(0xb3)](_0x3e7a71(0xc3)+_0x4f1055[_0x3e7a71(0xd4)]());}else{if(_0x40b6b0){const _0xc29528=new Date(_0x40b6b0);_0xc29528[_0x3e7a71(0x130)](0x17,0x3b,0x3b,0x3e7),_0x1b83ea[_0x3e7a71(0xe3)][_0x3e7a71(0xbb)]=_0xc29528,console[_0x3e7a71(0xb3)]('üìÖ\x20Date\x20end:\x20'+_0xc29528['toISOString']());}}}console[_0x3e7a71(0xb3)](_0x3e7a71(0x141),JSON['stringify'](_0x1b83ea,null,0x2));const [_0x514a27,_0x128e14]=await Promise[_0x3e7a71(0xab)]([database_1[_0x3e7a71(0x124)]['payout'][_0x3e7a71(0xf0)]({'where':_0x1b83ea,'skip':_0x349d2e,'take':_0x44d0e4,'orderBy':{'createdAt':_0x3e7a71(0x157)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x3e7a71(0x124)]['payout'][_0x3e7a71(0x103)]({'where':_0x1b83ea})]);return{'payouts':_0x514a27[_0x3e7a71(0x99)](_0x23f6d0=>{const _0x112684=_0x3e7a71;let _0x477310=null;switch(_0x23f6d0['network']){case _0x112684(0x107):_0x477310=_0x23f6d0[_0x112684(0xc8)][_0x112684(0x164)];break;case _0x112684(0xca):_0x477310=_0x23f6d0[_0x112684(0xc8)][_0x112684(0x11b)];break;case _0x112684(0xb0):_0x477310=_0x23f6d0[_0x112684(0xc8)][_0x112684(0x104)];break;case _0x112684(0xdb):_0x477310=_0x23f6d0['shop'][_0x112684(0xc4)];break;case'erc20_usdc':_0x477310=_0x23f6d0['shop'][_0x112684(0x116)];break;}return{'id':_0x23f6d0['id'],'amount':_0x23f6d0[_0x112684(0x9b)],'network':this[_0x112684(0xe4)](_0x23f6d0['network']),'wallet':_0x477310,'status':_0x23f6d0['status'],'txid':_0x23f6d0[_0x112684(0x125)],'notes':_0x23f6d0['notes'],'periodFrom':_0x23f6d0[_0x112684(0x137)],'periodTo':_0x23f6d0[_0x112684(0x115)],'createdAt':_0x23f6d0[_0x112684(0xe3)],'paidAt':_0x23f6d0[_0x112684(0xa6)]};}),'pagination':{'page':_0x861cb2,'limit':_0x44d0e4,'total':_0x128e14,'totalPages':Math['ceil'](_0x128e14/_0x44d0e4)}};}async[a77_0x269a70(0xcb)](_0x5ed86d,_0x3ca4be){const _0x2a4c3a=a77_0x269a70,_0x228089=await database_1[_0x2a4c3a(0x124)][_0x2a4c3a(0x15a)][_0x2a4c3a(0xa4)]({'where':{'id':_0x3ca4be,'shopId':_0x5ed86d}});if(!_0x228089)return null;return{'id':_0x228089['id'],'amount':_0x228089[_0x2a4c3a(0x9b)],'network':_0x228089['network'],'status':_0x228089[_0x2a4c3a(0x14c)],'txid':_0x228089[_0x2a4c3a(0x125)],'notes':_0x228089[_0x2a4c3a(0x10a)],'createdAt':_0x228089[_0x2a4c3a(0xe3)],'paidAt':_0x228089[_0x2a4c3a(0xa6)]};}async[a77_0x269a70(0xfb)](_0x43b372,_0xb7b0d8){const _0x27ecfc=a77_0x269a70,_0x37db56=new Date();let _0x4b1ac7,_0x4e49e1;switch(_0xb7b0d8){case _0x27ecfc(0x143):case _0x27ecfc(0xe6):const _0x4b8c18=new Date(_0x37db56);_0x4b8c18[_0x27ecfc(0x13f)](_0x4b8c18[_0x27ecfc(0xb6)]()-0x1),_0x4b1ac7=new Date(_0x4b8c18),_0x4b1ac7[_0x27ecfc(0x130)](0x0,0x0,0x0,0x0),_0x4e49e1=new Date(_0x4b8c18),_0x4e49e1[_0x27ecfc(0x130)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x4b1ac7=new Date(_0x37db56[_0x27ecfc(0xb1)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4b1ac7=new Date(_0x37db56[_0x27ecfc(0xb1)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x27ecfc(0x170):_0x4b1ac7=new Date(_0x37db56[_0x27ecfc(0xb1)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4b1ac7=new Date(_0x37db56[_0x27ecfc(0xb1)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x43d3ae={'gte':_0x4b1ac7};_0x4e49e1&&(_0x43d3ae['lte']=_0x4e49e1);const [_0x269bc8,_0x54a55f,_0x4d13ee,_0xd7ff8a,_0x27a8b1,_0x4f6a79]=await Promise['all']([database_1[_0x27ecfc(0x124)][_0x27ecfc(0x15a)][_0x27ecfc(0x103)]({'where':{'shopId':_0x43b372,'createdAt':_0x43d3ae}}),database_1[_0x27ecfc(0x124)][_0x27ecfc(0x15a)][_0x27ecfc(0x103)]({'where':{'shopId':_0x43b372,'status':'COMPLETED','createdAt':_0x43d3ae}}),database_1[_0x27ecfc(0x124)][_0x27ecfc(0x15a)][_0x27ecfc(0x103)]({'where':{'shopId':_0x43b372,'status':'PENDING','createdAt':_0x43d3ae}}),database_1[_0x27ecfc(0x124)][_0x27ecfc(0x15a)][_0x27ecfc(0x103)]({'where':{'shopId':_0x43b372,'status':_0x27ecfc(0xdf),'createdAt':_0x43d3ae}}),database_1[_0x27ecfc(0x124)][_0x27ecfc(0x15a)]['findMany']({'where':{'shopId':_0x43b372,'createdAt':_0x43d3ae},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x27ecfc(0x124)][_0x27ecfc(0x15a)][_0x27ecfc(0xf0)]({'where':{'shopId':_0x43b372},'take':0xa,'orderBy':{'createdAt':_0x27ecfc(0x157)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x204719=_0x27a8b1[_0x27ecfc(0xb9)]((_0x1fe9a0,_0x3049b0)=>_0x1fe9a0+_0x3049b0['amount'],0x0),_0x3f85a7=_0x27a8b1['filter'](_0x3c5877=>_0x3c5877[_0x27ecfc(0x14c)]===_0x27ecfc(0x12a))[_0x27ecfc(0xb9)]((_0x4d5c10,_0x431adf)=>_0x4d5c10+_0x431adf[_0x27ecfc(0x9b)],0x0),_0x486bc3=_0x27a8b1[_0x27ecfc(0xcf)](_0x46e53b=>_0x46e53b[_0x27ecfc(0x14c)]===_0x27ecfc(0xc9))[_0x27ecfc(0xb9)]((_0x290b02,_0x400d95)=>_0x290b02+_0x400d95['amount'],0x0),_0x3cfc8a=_0x27a8b1[_0x27ecfc(0xb9)]((_0x59adb8,_0x96282b)=>{const _0x219ef6=_0x27ecfc;return _0x59adb8[_0x96282b[_0x219ef6(0x11c)]]=(_0x59adb8[_0x96282b[_0x219ef6(0x11c)]]||0x0)+0x1,_0x59adb8;},{}),_0x6322b=_0x27a8b1[_0x27ecfc(0xb9)]((_0x56d523,_0x3c01c0)=>{const _0x2dbec0=_0x27ecfc;return _0x56d523[_0x3c01c0[_0x2dbec0(0x14c)]]=(_0x56d523[_0x3c01c0[_0x2dbec0(0x14c)]]||0x0)+0x1,_0x56d523;},{});return{'totalPayouts':_0x269bc8,'completedPayouts':_0x54a55f,'pendingPayouts':_0x4d13ee,'rejectedPayouts':_0xd7ff8a,'totalAmount':_0x204719,'completedAmount':_0x3f85a7,'pendingAmount':_0x486bc3,'payoutsByMethod':_0x3cfc8a,'payoutsByStatus':_0x6322b,'recentPayouts':_0x4f6a79[_0x27ecfc(0x99)](_0x2f159d=>({'id':_0x2f159d['id'],'shopId':_0x43b372,'amount':_0x2f159d['amount'],'method':_0x2f159d[_0x27ecfc(0x11c)],'status':_0x2f159d[_0x27ecfc(0x14c)],'txid':_0x2f159d[_0x27ecfc(0x125)],'createdAt':_0x2f159d[_0x27ecfc(0xe3)],'paidAt':_0x2f159d[_0x27ecfc(0xa6)]}))};}async[a77_0x269a70(0xc6)](_0x34bad2){const _0x5bf0fd=a77_0x269a70;console[_0x5bf0fd(0xb3)](_0x5bf0fd(0x10c)+_0x34bad2+'...');const _0x5cbb03=await database_1[_0x5bf0fd(0x124)]['shop']['findUnique']({'where':{'id':_0x34bad2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5cbb03)throw new Error(_0x5bf0fd(0x95));const _0x3f7218=new Date(),_0x1e5330=new Date(_0x3f7218[_0x5bf0fd(0x108)](),_0x3f7218[_0x5bf0fd(0xd8)](),0x1),_0x75760e=new Date(_0x3f7218[_0x5bf0fd(0x108)](),_0x3f7218[_0x5bf0fd(0xd8)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5e29db=await database_1[_0x5bf0fd(0x124)][_0x5bf0fd(0x15a)][_0x5bf0fd(0xf4)]({'_sum':{'amount':!![]},'where':{'shopId':_0x34bad2,'createdAt':{'gte':_0x1e5330,'lte':_0x75760e},'status':'COMPLETED'}}),_0x36042d=_0x5e29db[_0x5bf0fd(0x94)][_0x5bf0fd(0x9b)]||0x0,_0x3cfe0e={'availableBalance':Math[_0x5bf0fd(0xa5)](_0x5cbb03[_0x5bf0fd(0xd3)]*0x64)/0x64,'totalPaidOut':Math[_0x5bf0fd(0xa5)](_0x5cbb03[_0x5bf0fd(0xbc)]*0x64)/0x64,'awaitingPayout':Math[_0x5bf0fd(0xa5)](_0x5cbb03[_0x5bf0fd(0xd3)]*0x64)/0x64,'thisMonth':Math[_0x5bf0fd(0xa5)](_0x36042d*0x64)/0x64};return console['log'](_0x5bf0fd(0x93)+_0x5cbb03[_0x5bf0fd(0xeb)]+_0x5bf0fd(0xd6)),console[_0x5bf0fd(0xb3)](_0x5bf0fd(0x159)+_0x3cfe0e[_0x5bf0fd(0xed)]+_0x5bf0fd(0xd9)),console[_0x5bf0fd(0xb3)](_0x5bf0fd(0x123)+_0x3cfe0e[_0x5bf0fd(0xbc)]+_0x5bf0fd(0x172)),console[_0x5bf0fd(0xb3)](_0x5bf0fd(0x10d)+_0x3cfe0e[_0x5bf0fd(0xac)]+'\x20USDT\x20(current\x20balance)'),console[_0x5bf0fd(0xb3)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x3cfe0e['thisMonth']+_0x5bf0fd(0xf7)),_0x3cfe0e;}[a77_0x269a70(0x132)](_0x42fefa){const _0x3fcc54=a77_0x269a70,_0x48de4c={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x3fcc54(0x171),'noda':_0x3fcc54(0x133),'cointopay':_0x3fcc54(0x15b),'klyme_eu':_0x3fcc54(0x102),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x48de4c[_0x42fefa]||_0x42fefa;}async['getPayoutStats'](_0x10586f){const _0x264ecf=a77_0x269a70;return this[_0x264ecf(0xc6)](_0x10586f);}async[a77_0x269a70(0xc0)](_0x6a7871,_0x446f88){const _0x31b9e1=a77_0x269a70,{page:_0x58b555,limit:_0x2f558a,paymentId:_0x9194a5}=_0x446f88,_0x67fba6=(_0x58b555-0x1)*_0x2f558a,_0x1653dd={'shopId':_0x6a7871};_0x9194a5&&(_0x1653dd['paymentId']=_0x9194a5);const [_0x29edc2,_0x240693]=await Promise[_0x31b9e1(0xab)]([database_1['default'][_0x31b9e1(0x154)][_0x31b9e1(0xf0)]({'where':_0x1653dd,'skip':_0x67fba6,'take':_0x2f558a,'orderBy':{'createdAt':_0x31b9e1(0x157)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x31b9e1(0x124)][_0x31b9e1(0x154)][_0x31b9e1(0x103)]({'where':_0x1653dd})]);return{'logs':_0x29edc2[_0x31b9e1(0x99)](_0x47538d=>({'id':_0x47538d['id'],'paymentId':_0x47538d[_0x31b9e1(0xfd)],'shopId':_0x47538d['shopId'],'event':_0x47538d['event'],'statusCode':_0x47538d[_0x31b9e1(0x12c)],'retryCount':_0x47538d[_0x31b9e1(0x112)],'responseBody':_0x47538d[_0x31b9e1(0x139)],'createdAt':_0x47538d[_0x31b9e1(0xe3)],'payment':_0x47538d[_0x31b9e1(0x15d)]})),'pagination':{'page':_0x58b555,'limit':_0x2f558a,'total':_0x240693,'totalPages':Math['ceil'](_0x240693/_0x2f558a)}};}async[a77_0x269a70(0x138)](_0x480d58,_0xa51aea,_0x47a6b8,_0x483a64,_0x868926){const _0xa3b251=a77_0x269a70;console[_0xa3b251(0xb3)](_0xa3b251(0xb5)+_0x480d58+_0xa3b251(0x16a)+_0xa51aea+_0xa3b251(0xf1)+_0x47a6b8+_0xa3b251(0x131)+_0x483a64);const _0x2f4883=_0x868926?new Date(_0x868926):new Date();let _0x5eb6c3,_0x47d493;if(_0x47a6b8&&_0x483a64){const _0x1e6d7b=new Date(_0x47a6b8),_0x2435ff=new Date(_0x483a64);_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x1e6d7b[_0xa3b251(0xbd)](),_0x1e6d7b['getUTCMonth'](),_0x1e6d7b[_0xa3b251(0xff)](),0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date['UTC'](_0x2435ff[_0xa3b251(0xbd)](),_0x2435ff['getUTCMonth'](),_0x2435ff[_0xa3b251(0xff)](),0x17,0x3b,0x3b,0x3e7)),console[_0xa3b251(0xb3)]('üìÖ\x20Custom\x20date\x20range:\x20'+_0x5eb6c3[_0xa3b251(0xd4)]()+'\x20to\x20'+_0x47d493[_0xa3b251(0xd4)]());}else{if(_0xa51aea&&_0xa51aea[_0xa3b251(0xf2)]('custom_')){const _0x8a350e=_0xa51aea[_0xa3b251(0x167)]('custom_','')['split']('_');if(_0x8a350e[_0xa3b251(0xe1)]===0x2){const _0x9f5c7d=new Date(_0x8a350e[0x0]),_0x1809e8=new Date(_0x8a350e[0x1]);_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x9f5c7d[_0xa3b251(0xbd)](),_0x9f5c7d[_0xa3b251(0x120)](),_0x9f5c7d[_0xa3b251(0xff)](),0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x1809e8['getUTCFullYear'](),_0x1809e8[_0xa3b251(0x120)](),_0x1809e8[_0xa3b251(0xff)](),0x17,0x3b,0x3b,0x3e7)),console[_0xa3b251(0xb3)]('üìÖ\x20Custom\x20period:\x20'+_0x5eb6c3[_0xa3b251(0xd4)]()+_0xa3b251(0xb4)+_0x47d493[_0xa3b251(0xd4)]());}else{const _0x47afd8=new Date(Date[_0xa3b251(0x13d)](_0x2f4883['getUTCFullYear'](),_0x2f4883[_0xa3b251(0x120)](),_0x2f4883[_0xa3b251(0xff)]()-0x1e));_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x47afd8[_0xa3b251(0xbd)](),_0x47afd8[_0xa3b251(0x120)](),_0x47afd8[_0xa3b251(0xff)](),0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883[_0xa3b251(0x120)](),_0x2f4883[_0xa3b251(0xff)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x557ed6=_0xa51aea||_0xa3b251(0x128);switch(_0x557ed6[_0xa3b251(0x16d)]()){case _0xa3b251(0x118):_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x2f4883['getUTCFullYear'](),_0x2f4883[_0xa3b251(0x120)](),_0x2f4883[_0xa3b251(0xff)](),0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883['getUTCMonth'](),_0x2f4883[_0xa3b251(0xff)](),0x17,0x3b,0x3b,0x3e7));break;case _0xa3b251(0x143):const _0x17da16=new Date(_0x2f4883);_0x17da16[_0xa3b251(0xda)](_0x17da16['getUTCDate']()-0x1),_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x17da16[_0xa3b251(0xbd)](),_0x17da16['getUTCMonth'](),_0x17da16['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date['UTC'](_0x17da16[_0xa3b251(0xbd)](),_0x17da16['getUTCMonth'](),_0x17da16[_0xa3b251(0xff)](),0x17,0x3b,0x3b,0x3e7));break;case _0xa3b251(0xba):const _0x300f3d=_0x2f4883['getUTCDay'](),_0xd02140=_0x300f3d===0x0?-0x6:0x1-_0x300f3d,_0x400df6=_0x2f4883[_0xa3b251(0xff)]()+_0xd02140;_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883[_0xa3b251(0x120)](),_0x400df6,0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x2f4883['getUTCFullYear'](),_0x2f4883[_0xa3b251(0x120)](),_0x2f4883['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0xa3b251(0x14b):const _0x59af00=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883[_0xa3b251(0x120)](),_0x2f4883[_0xa3b251(0xff)]()-0x7)),_0x13de1c=_0x59af00[_0xa3b251(0xe0)](),_0x270610=_0x13de1c===0x0?-0x6:0x1-_0x13de1c,_0x4370ae=_0x59af00[_0xa3b251(0xff)]()+_0x270610;_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x59af00['getUTCFullYear'](),_0x59af00[_0xa3b251(0x120)](),_0x4370ae,0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x59af00['getUTCFullYear'](),_0x59af00['getUTCMonth'](),_0x4370ae+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0xa3b251(0x128):_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883[_0xa3b251(0x120)](),0x1,0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883[_0xa3b251(0x120)](),_0x2f4883[_0xa3b251(0xff)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x2f4883['getUTCFullYear'](),_0x2f4883[_0xa3b251(0x120)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x2f4883['getUTCFullYear'](),_0x2f4883[_0xa3b251(0x120)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0xa3b251(0xb8):_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883[_0xa3b251(0x120)](),_0x2f4883['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x5eb6c3=new Date(Date[_0xa3b251(0x13d)](_0x2f4883[_0xa3b251(0xbd)](),_0x2f4883[_0xa3b251(0x120)](),0x1,0x0,0x0,0x0,0x0)),_0x47d493=new Date(Date[_0xa3b251(0x13d)](_0x2f4883['getUTCFullYear'](),_0x2f4883['getUTCMonth'](),_0x2f4883[_0xa3b251(0xff)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0xa3b251(0xb3)](_0xa3b251(0xaa)+_0x5eb6c3['toISOString']()+'\x20to\x20'+_0x47d493['toISOString']());const _0x370559={'gte':_0x5eb6c3,'lte':_0x47d493},[_0x532b50,_0x5013a2,_0x362edf,_0x48f9b6,_0x3c0a97,_0x4dba93,_0x332877,_0x1aa070,_0x4216a1,_0x500f3b]=await Promise[_0xa3b251(0xab)]([database_1[_0xa3b251(0x124)]['payment'][_0xa3b251(0x103)]({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)},'status':{'notIn':['PENDING',_0xa3b251(0xce)]},'createdAt':_0x370559}}),database_1['default'][_0xa3b251(0x15d)][_0xa3b251(0x103)]({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)},'status':_0xa3b251(0xcc),'createdAt':_0x370559}}),database_1[_0xa3b251(0x124)][_0xa3b251(0x15d)][_0xa3b251(0x103)]({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)},'status':_0xa3b251(0xef)}}),database_1['default'][_0xa3b251(0x15d)]['count']({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)},'status':_0xa3b251(0x126)}}),database_1[_0xa3b251(0x124)]['payment'][_0xa3b251(0xf0)]({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)},'status':_0xa3b251(0xcc),'createdAt':_0x370559},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1['default']['payment'][_0xa3b251(0xf0)]({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)}},'take':0xa,'orderBy':{'createdAt':_0xa3b251(0x157)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0xa3b251(0x124)][_0xa3b251(0x15d)][_0xa3b251(0xf0)]({'where':{'shopId':_0x480d58,'gateway':{'not':'test_gateway'},'createdAt':_0x370559},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0xa3b251(0xde)}}),database_1['default']['payment'][_0xa3b251(0x103)]({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)},'status':'PAID'}}),database_1[_0xa3b251(0x124)][_0xa3b251(0x15d)][_0xa3b251(0xf0)]({'where':{'shopId':_0x480d58,'gateway':{'not':_0xa3b251(0xf9)},'status':_0xa3b251(0xcc)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0xa3b251(0xc8)]['findUnique']({'where':{'id':_0x480d58},'select':{'balance':!![]}})]);let _0xd222f1=0x0,_0x504c3c=0x0;for(const _0x1ea138 of _0x3c0a97){if(_0x1ea138[_0xa3b251(0x168)])_0xd222f1+=_0x1ea138[_0xa3b251(0x168)];else{const _0xa9283a=await currencyService_1[_0xa3b251(0x13a)]['convertToUSDT'](_0x1ea138['amount'],_0x1ea138[_0xa3b251(0x9d)]);_0xd222f1+=_0xa9283a;}_0x1ea138[_0xa3b251(0x117)]&&(_0x504c3c+=_0x1ea138[_0xa3b251(0x117)]);}let _0x519761=0x0;for(const _0x580cd3 of _0x4216a1){_0x580cd3[_0xa3b251(0x117)]&&(_0x519761+=_0x580cd3[_0xa3b251(0x117)]);}const _0x980f9b=this[_0xa3b251(0x109)](_0x332877,_0x5eb6c3,_0x47d493||_0x2f4883),_0x37e2a8=_0x532b50>0x0?_0x5013a2/_0x532b50*0x64:0x0,_0x88d5cb=_0x1aa070>0x0?_0x362edf/_0x1aa070*0x64:0x0;return{'totalPayments':_0x532b50,'successfulPayments':_0x5013a2,'totalRevenue':Math[_0xa3b251(0xa5)](_0xd222f1*0x64)/0x64,'merchantEarnings':Math[_0xa3b251(0xa5)](_0x504c3c*0x64)/0x64,'merchantTotalRevenue':Math[_0xa3b251(0xa5)](_0x519761*0x64)/0x64,'payoutBalance':Math['round']((_0x500f3b?.[_0xa3b251(0xd3)]||0x0)*0x64)/0x64,'conversionRate':Math[_0xa3b251(0xa5)](_0x37e2a8*0x64)/0x64,'chargebackRate':Math[_0xa3b251(0xa5)](_0x88d5cb*0x64)/0x64,'chargebacks':_0x362edf,'refunds':_0x48f9b6,'dailyRevenue':_0x980f9b['dailyRevenue'],'dailyPayments':_0x980f9b[_0xa3b251(0x13e)],'recentPayments':_0x4dba93[_0xa3b251(0x99)](_0x19149a=>({'id':_0x19149a['id'],'gateway':_0x19149a[_0xa3b251(0x96)],'amount':_0x19149a['amount'],'currency':_0x19149a[_0xa3b251(0x9d)],'status':_0x19149a[_0xa3b251(0x14c)],'createdAt':_0x19149a['createdAt']}))};}['generateDailyStatistics'](_0x145f9b,_0x27e0e6,_0x1d196a){const _0x53cd61=a77_0x269a70,_0xe28964=new Map(),_0x5db1b5=new Date(_0x27e0e6);while(_0x5db1b5<=_0x1d196a){const _0x3d5c8c=_0x5db1b5['toISOString']()[_0x53cd61(0xa8)]('T')[0x0];_0xe28964[_0x53cd61(0x100)](_0x3d5c8c,{'revenue':0x0,'count':0x0}),_0x5db1b5['setDate'](_0x5db1b5[_0x53cd61(0xb6)]()+0x1);}for(const _0x670d2d of _0x145f9b){const _0x21e94c=_0x670d2d[_0x53cd61(0xe3)]['toISOString']()[_0x53cd61(0xa8)]('T')[0x0],_0x2f9e6f=_0xe28964[_0x53cd61(0xe5)](_0x21e94c);_0x2f9e6f&&(_0x2f9e6f[_0x53cd61(0x103)]+=0x1,_0x670d2d[_0x53cd61(0x14c)]===_0x53cd61(0xcc)&&_0x670d2d[_0x53cd61(0x168)]&&(_0x2f9e6f[_0x53cd61(0x16e)]+=_0x670d2d['amountUSDT']));}const _0x419231=[],_0x5cfa0b=[];for(const [_0x5181b8,_0x235227]of _0xe28964){_0x419231['push']({'date':_0x5181b8,'amount':Math[_0x53cd61(0xa5)](_0x235227['revenue']*0x64)/0x64}),_0x5cfa0b[_0x53cd61(0x160)]({'date':_0x5181b8,'count':_0x235227[_0x53cd61(0x103)]});}return{'dailyRevenue':_0x419231,'dailyPayments':_0x5cfa0b};}[a77_0x269a70(0xdc)](_0x1953df=0x8){const _0x56ce6c=a77_0x269a70,_0x13f729=[];for(let _0x587dc5=0x0;_0x587dc5<_0x1953df;_0x587dc5++){const _0xab9861=crypto_1[_0x56ce6c(0x124)][_0x56ce6c(0xa9)](0x4)[_0x56ce6c(0x169)]('hex')[_0x56ce6c(0x144)]();_0x13f729[_0x56ce6c(0x160)](_0xab9861);}return _0x13f729;}async[a77_0x269a70(0x111)](_0x496bd6){const _0x443010=a77_0x269a70,_0x2982a7=await database_1[_0x443010(0x124)][_0x443010(0xc8)]['findUnique']({'where':{'id':_0x496bd6},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2982a7)throw new Error(_0x443010(0x95));const _0x4405c5=speakeasy_1[_0x443010(0x124)][_0x443010(0x113)]({'name':_0x443010(0xfa)+_0x2982a7[_0x443010(0xeb)]+')','issuer':'TrapaPay','length':0x20}),_0x3ee938=await qrcode_1['default'][_0x443010(0x156)](_0x4405c5[_0x443010(0x11e)]),_0x41e7aa=this[_0x443010(0xdc)](0x8),_0x256230=await Promise['all'](_0x41e7aa[_0x443010(0x99)](_0x33b0e2=>bcryptjs_1['default'][_0x443010(0xa2)](_0x33b0e2,0xa)));return await database_1[_0x443010(0x124)][_0x443010(0xc8)][_0x443010(0x9a)]({'where':{'id':_0x496bd6},'data':{'twoFactorSecret':_0x4405c5[_0x443010(0x149)],'backupCodes':JSON[_0x443010(0xe2)](_0x256230)}}),console[_0x443010(0xb3)](_0x443010(0x134)+_0x2982a7['username']),console[_0x443010(0xb3)]('üîë\x20Generated\x20'+_0x41e7aa[_0x443010(0xe1)]+'\x20backup\x20codes'),{'secret':_0x4405c5[_0x443010(0x149)],'qrCode':_0x3ee938,'manualEntryKey':_0x4405c5[_0x443010(0x149)],'backupCodes':_0x41e7aa};}async[a77_0x269a70(0x105)](_0xeffe1f,_0x2ef4f1){const _0x19ad02=a77_0x269a70,_0x1c2f98=await database_1[_0x19ad02(0x124)][_0x19ad02(0xc8)][_0x19ad02(0x136)]({'where':{'id':_0xeffe1f},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x1c2f98)throw new Error(_0x19ad02(0x95));if(!_0x1c2f98[_0x19ad02(0x161)])throw new Error(_0x19ad02(0x155));if(_0x1c2f98[_0x19ad02(0xd0)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x3db551=speakeasy_1[_0x19ad02(0x124)]['totp']['verify']({'secret':_0x1c2f98['twoFactorSecret'],'encoding':_0x19ad02(0x149),'token':_0x2ef4f1,'window':0x2});if(!_0x3db551)throw new Error(_0x19ad02(0x12b));return await database_1['default']['shop'][_0x19ad02(0x9a)]({'where':{'id':_0xeffe1f},'data':{'twoFactorEnabled':!![]}}),console[_0x19ad02(0xb3)](_0x19ad02(0x106)+_0x1c2f98[_0x19ad02(0xeb)]),{'enabled':!![]};}async['disable2FA'](_0x64551f){const _0x4d462a=a77_0x269a70,_0x3db197=await database_1[_0x4d462a(0x124)][_0x4d462a(0xc8)][_0x4d462a(0x136)]({'where':{'id':_0x64551f},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x3db197)throw new Error('Shop\x20not\x20found');await database_1[_0x4d462a(0x124)][_0x4d462a(0xc8)][_0x4d462a(0x9a)]({'where':{'id':_0x64551f},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x4d462a(0xb3)]('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x3db197[_0x4d462a(0xeb)]);}}exports[a77_0x269a70(0xa1)]=ShopService;function a77_0x2151(){const _0x527c2e=['paymentService','aggregate','getPaymentByShopAndId','twoFactorToken','\x20USDT','paid','test_gateway','TrapaPay\x20(','getPayoutStatistics','No\x20webhook\x20URL\x20configured','paymentId','statusText','getUTCDate','set','backupCodes','KLYME\x20EU','count','usdtErcWallet','enable2FA','üîê\x202FA\x20enabled\x20for\x20shop:\x20','polygon','getFullYear','generateDailyStatistics','notes','test','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','bcryptjs','defineProperty','paymentGateways','setup2FA','retryCount','generateSecret','171267qnPdpG','periodTo','usdcErcWallet','amountAfterGatewayCommissionUSDT','today','error','test_order_123','usdtTrcWallet','network','./currencyService','otpauth_url','usage','getUTCMonth','amountIsEditable','AVAILABLE_GATEWAYS','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','default','txid','REFUND','application/json','this_month','compare','COMPLETED','Invalid\x202FA\x20token','statusCode','deletePayment','Payment\x20not\x20found','webhookEvents','setHours',',\x20dateTo:\x20','getGatewayDisplayName','Noda','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','customerEmail','findUnique','periodFrom','getStatistics','responseBody','currencyService','4lEqwAz','Test\x20webhook\x20sent\x20successfully\x20(','UTC','dailyPayments','setDate','USDT\x20Polygon','üìä\x20Final\x20WHERE\x20conditions:','qrcode','yesterday','toUpperCase','maxPayments','updateShopProfile','getShopProfile','USDC\x20Ethereum','base32','expiresAt','last_week','status','speakeasy','439332kvAEMR','Webhook\x20returned\x20error:\x20','testWebhook','merchantUrl','webhookUrl','splice','webhookLog','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','toDataURL','desc','USD','\x20\x20\x20üíµ\x20Available\x20balance:\x20','payout','CoinToPay','üìÖ\x20Period\x20start:\x20','payment','settings','updateWallets','push','twoFactorSecret','sourceCurrency','wallets','usdtPolygonWallet','Payment\x20System/1.0\x20(Test)','name','replace','amountUSDT','toString',',\x20period:\x20','USDT\x20ERC20','üìä\x20Status\x20filter:\x20','toLowerCase','revenue','628478xdHfZh','90d','Rapyd','\x20USDT\x20(total\x20payouts)','üìä\x20Shop\x20','_sum','Shop\x20not\x20found','gateway','Error\x20parsing\x20webhook\x20events:','548264UreNTM','map','update','amount','createPublicPayment','currency','gatewaySettings','POST','telegram','ShopService','hash','2FA\x20token\x20is\x20required','findFirst','round','paidAt','createPayment','split','randomBytes','üìÖ\x20Final\x20date\x20range:\x20','all','awaitingPayout','üåê\x20Method\x20filter:\x20','getPaymentById','USDT\x20BSC','erc20','getTime','customerName','log','\x20to\x20','üìä\x20Getting\x20statistics\x20for\x20shop\x20','getDate','üåê\x20Network\x20filter:\x20','all_time','reduce','this_week','lte','totalPaidOut','getUTCFullYear','telegramId','parse','getWebhookLogs','gateways','publicKey','üìÖ\x20Period\x20end:\x20','usdcPolygonWallet','isArray','getShopPayoutStats','9LKbiHr','shop','PENDING','trc20','getPayoutById','PAID','__esModule','EXPIRED','filter','twoFactorEnabled','redirectUrl','./paymentService','balance','toISOString','../config/database','\x20payout\x20statistics\x20calculated:','556360pRagIN','getMonth','\x20USDT\x20(current\x20balance)','setUTCDate','polygon_usdc','generateBackupCodes','../types/gateway','asc','REJECTED','getUTCDay','length','stringify','createdAt','formatNetworkName','get','YESTERDAY','country','verify','shopUrl','Unknown\x20error','username','281407oYEYRE','availableBalance','600273MLZlwj','CHARGEBACK','findMany',',\x20dateFrom:\x20','startsWith'];a77_0x2151=function(){return _0x527c2e;};return a77_0x2151();}