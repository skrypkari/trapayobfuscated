'use strict';const a54_0x3f1a7e=a54_0x4a48;function a54_0x4a48(_0x1e8159,_0x5c31c9){const _0x8a88dc=a54_0x8a88();return a54_0x4a48=function(_0x4a481d,_0x8803ec){_0x4a481d=_0x4a481d-0x75;let _0x52c6e1=_0x8a88dc[_0x4a481d];return _0x52c6e1;},a54_0x4a48(_0x1e8159,_0x5c31c9);}(function(_0x1c9f25,_0x129671){const _0x1e620b=a54_0x4a48,_0x52585b=_0x1c9f25();while(!![]){try{const _0x49016c=-parseInt(_0x1e620b(0xfd))/0x1+-parseInt(_0x1e620b(0x7e))/0x2+-parseInt(_0x1e620b(0x11a))/0x3+-parseInt(_0x1e620b(0xf8))/0x4*(-parseInt(_0x1e620b(0xd8))/0x5)+parseInt(_0x1e620b(0x10b))/0x6*(-parseInt(_0x1e620b(0x124))/0x7)+parseInt(_0x1e620b(0xb7))/0x8*(parseInt(_0x1e620b(0xe3))/0x9)+parseInt(_0x1e620b(0x105))/0xa;if(_0x49016c===_0x129671)break;else _0x52585b['push'](_0x52585b['shift']());}catch(_0x5e2943){_0x52585b['push'](_0x52585b['shift']());}}}(a54_0x8a88,0xcc331));var __importDefault=this&&this[a54_0x3f1a7e(0x81)]||function(_0x16def5){const _0x2f818d=a54_0x3f1a7e;return _0x16def5&&_0x16def5[_0x2f818d(0x125)]?_0x16def5:{'default':_0x16def5};};function a54_0x8a88(){const _0x1098f2=['erc20','üìÖ\x20Date\x20start:\x20','CoinToPay','gte','paid','Rapyd','üìÖ\x20Period\x20start:\x20','Shop\x20not\x20found','publicKey','txid','setDate','Noda','gatewaySettings','settings','usage','./currencyService','üìÖ\x20Date\x20end:\x20','dailyRevenue','USDT\x20BSC','customerEmail','currency','getPayoutStats','REJECTED','dailyPayments','\x20payout\x20statistics\x20calculated:','set','testWebhook','responseBody','usdcPolygonWallet','getShopProfile','1972870JbfoAA','../config/database','Test\x20webhook\x20sent\x20successfully\x20(','paymentGateways','amount','error','findUnique','webhookEvents','split','payout','event','486aTNWGm','push','getWebhookLogs','map','aggregate','üìÖ\x20Period\x20end:\x20','PENDING','üìä\x20Final\x20WHERE\x20conditions:','usdtPolygonWallet','USDT\x20TRC20','shop','getPayouts','amountIsEditable','USD','getGatewayDisplayName','payment','getPaymentsByShop','log','customer','periodTo','status','16JEShzl','POST','default','createPublicPayment','updateWallets','1190874AaMlah','stringify','customerName','90d','üìä\x20Status\x20filter:\x20','statusCode','setHours','_sum','18164960bxzEqw','telegram','wallets','redirectUrl','ceil','getShopPayoutStats','18372HKsFiw','currencyService','createPayment','Payment\x20not\x20found','getDate','awaitingPayout','country','getMonth','Failed\x20to\x20send\x20webhook:\x20','notes','getTime','name','\x20USDT','gateways','getPayments','1564548YjFcmA','statusText','webhookUrl','telegramId','test_gateway','formatNetworkName','message','desc','üåê\x20Network\x20filter:\x20','update','1687BAfEvl','__esModule','Webhook\x20returned\x20error:\x20','all','USDT\x20ERC20','...','count','usdtErcWallet','No\x20webhook\x20URL\x20configured','shopUrl','COMPLETED','573058WBhGdv','polygon','polygon_usdc','__importDefault','paymentService','deletePayment','gateway','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','getPayoutStatistics','updateShopProfile','Test\x20Gateway','reduce','username','getFullYear','üìä\x20Shop\x20','üåê\x20Method\x20filter:\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','lte','convertToUSDT','USDT\x20Polygon','Unknown\x20error','toUpperCase','PAID','ShopService','expiresAt','webhookLog','round','totalPaidOut','isArray','findMany','trc20','usdtTrcWallet','getStatistics','paymentId','filter','generateDailyStatistics','PaymentService','parse','test','sourceCurrency','USDC\x20Polygon','createdAt','shopId','30d','toISOString','TesSoft\x20Payment\x20System/1.0\x20(Test)','üí∞\x20Getting\x20payouts\x20with\x20filters:','fullName','revenue','paidAt','thisMonth','balance','findFirst','\x20USDT\x20(current\x20balance)','retryCount','network','getPaymentByShopAndId','26440iPFvMQ','delete','amountUSDT'];a54_0x8a88=function(){return _0x1098f2;};return a54_0x8a88();}Object['defineProperty'](exports,a54_0x3f1a7e(0x125),{'value':!![]}),exports[a54_0x3f1a7e(0x95)]=void 0x0;const database_1=__importDefault(require(a54_0x3f1a7e(0xd9))),currencyService_1=require(a54_0x3f1a7e(0xc9)),paymentService_1=require('./paymentService');class ShopService{constructor(){const _0x2502a0=a54_0x3f1a7e;this[_0x2502a0(0x82)]=new paymentService_1[(_0x2502a0(0xa2))]();}async[a54_0x3f1a7e(0xd7)](_0x279181){const _0x106960=a54_0x3f1a7e,_0x50cb31=await database_1[_0x106960(0xfa)][_0x106960(0xed)][_0x106960(0xde)]({'where':{'id':_0x279181},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x50cb31)throw new Error(_0x106960(0xc1));let _0x338ce6=[];if(_0x50cb31['settings']?.[_0x106960(0xdf)])try{_0x338ce6=Array['isArray'](_0x50cb31[_0x106960(0xc7)][_0x106960(0xdf)])?_0x50cb31[_0x106960(0xc7)][_0x106960(0xdf)]:JSON[_0x106960(0xa3)](_0x50cb31['settings']['webhookEvents']);}catch(_0x19b230){console[_0x106960(0xdd)]('Error\x20parsing\x20webhook\x20events:',_0x19b230),_0x338ce6=[];}return{'id':_0x50cb31['id'],'fullName':_0x50cb31[_0x106960(0x116)],'username':_0x50cb31['username'],'telegramId':_0x50cb31['telegram'],'merchantUrl':_0x50cb31[_0x106960(0x7c)],'gateways':_0x50cb31['paymentGateways']?JSON[_0x106960(0xa3)](_0x50cb31[_0x106960(0xdb)]):null,'gatewaySettings':_0x50cb31[_0x106960(0xc6)]?JSON[_0x106960(0xa3)](_0x50cb31[_0x106960(0xc6)]):null,'publicKey':_0x50cb31[_0x106960(0xc2)],'webhookUrl':_0x50cb31[_0x106960(0xc7)]?.['webhookUrl']||null,'webhookEvents':_0x338ce6,'wallets':{'usdtPolygonWallet':_0x50cb31['usdtPolygonWallet'],'usdtTrcWallet':_0x50cb31[_0x106960(0x9d)],'usdtErcWallet':_0x50cb31['usdtErcWallet'],'usdcPolygonWallet':_0x50cb31[_0x106960(0xd6)]},'status':_0x50cb31['status'],'createdAt':_0x50cb31[_0x106960(0xa7)]};}async[a54_0x3f1a7e(0x87)](_0x585670,_0x483b93){const _0xcabbd4=a54_0x3f1a7e,_0x42f391={};_0x483b93[_0xcabbd4(0xad)]&&(_0x42f391[_0xcabbd4(0x116)]=_0x483b93[_0xcabbd4(0xad)]);_0x483b93['telegramId']!==undefined&&(_0x42f391[_0xcabbd4(0x106)]=_0x483b93[_0xcabbd4(0x11d)]||null);_0x483b93['merchantUrl']&&(_0x42f391[_0xcabbd4(0x7c)]=_0x483b93['merchantUrl']);_0x483b93[_0xcabbd4(0x118)]&&(_0x42f391[_0xcabbd4(0xdb)]=JSON[_0xcabbd4(0xfe)](_0x483b93[_0xcabbd4(0x118)]));_0x483b93[_0xcabbd4(0xc6)]&&(_0x42f391[_0xcabbd4(0xc6)]=JSON[_0xcabbd4(0xfe)](_0x483b93['gatewaySettings']));_0x483b93[_0xcabbd4(0x107)]&&(_0x483b93['wallets'][_0xcabbd4(0xeb)]!==undefined&&(_0x42f391[_0xcabbd4(0xeb)]=_0x483b93[_0xcabbd4(0x107)][_0xcabbd4(0xeb)]||null),_0x483b93[_0xcabbd4(0x107)][_0xcabbd4(0x9d)]!==undefined&&(_0x42f391[_0xcabbd4(0x9d)]=_0x483b93[_0xcabbd4(0x107)][_0xcabbd4(0x9d)]||null),_0x483b93[_0xcabbd4(0x107)][_0xcabbd4(0x7a)]!==undefined&&(_0x42f391[_0xcabbd4(0x7a)]=_0x483b93['wallets'][_0xcabbd4(0x7a)]||null),_0x483b93['wallets'][_0xcabbd4(0xd6)]!==undefined&&(_0x42f391[_0xcabbd4(0xd6)]=_0x483b93[_0xcabbd4(0x107)][_0xcabbd4(0xd6)]||null));const _0x46ff97=await database_1[_0xcabbd4(0xfa)][_0xcabbd4(0xed)][_0xcabbd4(0x123)]({'where':{'id':_0x585670},'data':_0x42f391,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2ce7fb=[];if(_0x46ff97[_0xcabbd4(0xc7)]?.[_0xcabbd4(0xdf)])try{_0x2ce7fb=Array[_0xcabbd4(0x9a)](_0x46ff97[_0xcabbd4(0xc7)]['webhookEvents'])?_0x46ff97['settings'][_0xcabbd4(0xdf)]:JSON[_0xcabbd4(0xa3)](_0x46ff97['settings'][_0xcabbd4(0xdf)]);}catch(_0x2e1939){console[_0xcabbd4(0xdd)]('Error\x20parsing\x20webhook\x20events:',_0x2e1939),_0x2ce7fb=[];}return{'id':_0x46ff97['id'],'fullName':_0x46ff97[_0xcabbd4(0x116)],'username':_0x46ff97[_0xcabbd4(0x8a)],'telegramId':_0x46ff97[_0xcabbd4(0x106)],'merchantUrl':_0x46ff97[_0xcabbd4(0x7c)],'gateways':_0x46ff97[_0xcabbd4(0xdb)]?JSON[_0xcabbd4(0xa3)](_0x46ff97[_0xcabbd4(0xdb)]):null,'gatewaySettings':_0x46ff97[_0xcabbd4(0xc6)]?JSON[_0xcabbd4(0xa3)](_0x46ff97[_0xcabbd4(0xc6)]):null,'publicKey':_0x46ff97[_0xcabbd4(0xc2)],'webhookUrl':_0x46ff97['settings']?.[_0xcabbd4(0x11c)]||null,'webhookEvents':_0x2ce7fb,'wallets':{'usdtPolygonWallet':_0x46ff97[_0xcabbd4(0xeb)],'usdtTrcWallet':_0x46ff97['usdtTrcWallet'],'usdtErcWallet':_0x46ff97[_0xcabbd4(0x7a)],'usdcPolygonWallet':_0x46ff97[_0xcabbd4(0xd6)]},'status':_0x46ff97[_0xcabbd4(0xf7)],'createdAt':_0x46ff97['createdAt']};}async[a54_0x3f1a7e(0xfc)](_0x4752b2,_0x334dca){const _0x5c3550=a54_0x3f1a7e,_0x4d5a43={};_0x334dca[_0x5c3550(0xeb)]!==undefined&&(_0x4d5a43[_0x5c3550(0xeb)]=_0x334dca[_0x5c3550(0xeb)]||null),_0x334dca['usdtTrcWallet']!==undefined&&(_0x4d5a43['usdtTrcWallet']=_0x334dca[_0x5c3550(0x9d)]||null),_0x334dca['usdtErcWallet']!==undefined&&(_0x4d5a43[_0x5c3550(0x7a)]=_0x334dca[_0x5c3550(0x7a)]||null),_0x334dca[_0x5c3550(0xd6)]!==undefined&&(_0x4d5a43[_0x5c3550(0xd6)]=_0x334dca[_0x5c3550(0xd6)]||null),await database_1[_0x5c3550(0xfa)][_0x5c3550(0xed)][_0x5c3550(0x123)]({'where':{'id':_0x4752b2},'data':_0x4d5a43});}async[a54_0x3f1a7e(0xd4)](_0x247b46){const _0x53d7c3=a54_0x3f1a7e,_0xedc138=await database_1[_0x53d7c3(0xfa)][_0x53d7c3(0xed)][_0x53d7c3(0xde)]({'where':{'id':_0x247b46},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0xedc138?.[_0x53d7c3(0xc7)]?.[_0x53d7c3(0x11c)])throw new Error(_0x53d7c3(0x7b));const _0x450d6a={'event':_0x53d7c3(0xa4),'payment':{'id':'test_payment_123','order_id':'test_order_123','gateway':_0x53d7c3(0xa4),'amount':0x64,'currency':_0x53d7c3(0xf0),'status':_0x53d7c3(0xbe),'created_at':new Date()[_0x53d7c3(0xaa)]()}};try{const _0x13ab3c=await fetch(_0xedc138[_0x53d7c3(0xc7)]['webhookUrl'],{'method':_0x53d7c3(0xf9),'headers':{'Content-Type':'application/json','User-Agent':_0x53d7c3(0xab)},'body':JSON[_0x53d7c3(0xfe)](_0x450d6a)});return _0x13ab3c['ok']?{'success':!![],'message':_0x53d7c3(0xda)+_0x13ab3c['status']+')'}:{'success':![],'message':_0x53d7c3(0x75)+_0x13ab3c['status']+'\x20'+_0x13ab3c[_0x53d7c3(0x11b)]};}catch(_0x4a2db8){return{'success':![],'message':_0x53d7c3(0x113)+(_0x4a2db8 instanceof Error?_0x4a2db8[_0x53d7c3(0x120)]:_0x53d7c3(0x92))};}}async[a54_0x3f1a7e(0x10d)](_0x3ed28c){const _0x321cef=a54_0x3f1a7e;return this['paymentService'][_0x321cef(0xfb)]({'public_key':'','gateway':_0x3ed28c['gateway'],'order_id':undefined,'amount':_0x3ed28c[_0x321cef(0xdc)],'currency':_0x3ed28c[_0x321cef(0xce)],'source_currency':_0x3ed28c[_0x321cef(0xa5)],'usage':_0x3ed28c[_0x321cef(0xc8)],'expires_at':_0x3ed28c[_0x321cef(0x96)]?.[_0x321cef(0xaa)](),'success_url':_0x3ed28c[_0x321cef(0x108)],'fail_url':_0x3ed28c[_0x321cef(0x108)],'customer_email':_0x3ed28c[_0x321cef(0xcd)],'customer_name':_0x3ed28c[_0x321cef(0xff)],'country':_0x3ed28c[_0x321cef(0x111)],'language':_0x3ed28c['language'],'amount_is_editable':_0x3ed28c[_0x321cef(0xef)],'max_payments':_0x3ed28c['maxPayments'],'customer':_0x3ed28c[_0x321cef(0xf5)]});}async[a54_0x3f1a7e(0x119)](_0x3ffd92,_0x89ef1b){const _0x462b8d=a54_0x3f1a7e;return this[_0x462b8d(0x82)][_0x462b8d(0xf3)](_0x3ffd92,_0x89ef1b);}async['getPaymentById'](_0x24f3ba,_0x53ca27){const _0x1937d4=a54_0x3f1a7e;return this['paymentService'][_0x1937d4(0xb6)](_0x24f3ba,_0x53ca27);}async['updatePayment'](_0x307f4e,_0x5b6081,_0x100d1c){const _0x4db635=a54_0x3f1a7e,_0x26f126=await database_1['default']['payment'][_0x4db635(0xb2)]({'where':{'id':_0x5b6081,'shopId':_0x307f4e}});if(!_0x26f126)throw new Error(_0x4db635(0x10e));const _0x301810=await database_1['default'][_0x4db635(0xf2)][_0x4db635(0x123)]({'where':{'id':_0x5b6081},'data':{..._0x100d1c,'updatedAt':new Date()}});return _0x301810;}async[a54_0x3f1a7e(0x83)](_0x3ff3fb,_0x162937){const _0x45c349=a54_0x3f1a7e,_0xcea330=await database_1[_0x45c349(0xfa)][_0x45c349(0xf2)][_0x45c349(0xb2)]({'where':{'id':_0x162937,'shopId':_0x3ff3fb}});if(!_0xcea330)throw new Error(_0x45c349(0x10e));await database_1[_0x45c349(0xfa)][_0x45c349(0xf2)][_0x45c349(0xb8)]({'where':{'id':_0x162937}});}[a54_0x3f1a7e(0x11f)](_0x51e625){const _0x29b5b8=a54_0x3f1a7e,_0x2bbb0={'polygon':_0x29b5b8(0x91),'trc20':_0x29b5b8(0xec),'erc20':_0x29b5b8(0x77),'bsc':_0x29b5b8(0xcc),'polygon_usdc':_0x29b5b8(0xa6)};return _0x2bbb0[_0x51e625]||_0x51e625;}async[a54_0x3f1a7e(0xee)](_0x205b3d,_0xe9bad4){const _0x34cc30=a54_0x3f1a7e,{page:_0x973eae,limit:_0x5c68e7,status:_0x5b9437,method:_0x1afba2,network:_0xc8fb00,dateFrom:_0x4275f3,dateTo:_0x3627e6,periodFrom:_0x205820,periodTo:_0x5d216d}=_0xe9bad4,_0x13e877=(_0x973eae-0x1)*_0x5c68e7;console[_0x34cc30(0xf4)](_0x34cc30(0xac),_0xe9bad4);const _0x4f2e92={'shopId':_0x205b3d};_0x5b9437&&(_0x4f2e92[_0x34cc30(0xf7)]=_0x5b9437[_0x34cc30(0x93)](),console[_0x34cc30(0xf4)](_0x34cc30(0x101)+_0x5b9437[_0x34cc30(0x93)]()));if(_0x1afba2)_0x4f2e92['network']=_0x1afba2,console[_0x34cc30(0xf4)](_0x34cc30(0x8d)+_0x1afba2);else _0xc8fb00&&(_0x4f2e92[_0x34cc30(0xb5)]=_0xc8fb00,console[_0x34cc30(0xf4)](_0x34cc30(0x122)+_0xc8fb00));if(_0x4275f3||_0x3627e6||_0x205820||_0x5d216d){_0x4f2e92['createdAt']={};if(_0x205820){const _0x1aafde=new Date(_0x205820);_0x1aafde[_0x34cc30(0x103)](0x0,0x0,0x0,0x0),_0x4f2e92[_0x34cc30(0xa7)]['gte']=_0x1aafde,console[_0x34cc30(0xf4)](_0x34cc30(0xc0)+_0x1aafde['toISOString']());}else{if(_0x4275f3){const _0x3d59f3=new Date(_0x4275f3);_0x3d59f3[_0x34cc30(0x103)](0x0,0x0,0x0,0x0),_0x4f2e92[_0x34cc30(0xa7)][_0x34cc30(0xbd)]=_0x3d59f3,console['log'](_0x34cc30(0xbb)+_0x3d59f3[_0x34cc30(0xaa)]());}}if(_0x5d216d){const _0x116783=new Date(_0x5d216d);_0x116783[_0x34cc30(0x103)](0x17,0x3b,0x3b,0x3e7),_0x4f2e92[_0x34cc30(0xa7)][_0x34cc30(0x8f)]=_0x116783,console[_0x34cc30(0xf4)](_0x34cc30(0xe8)+_0x116783[_0x34cc30(0xaa)]());}else{if(_0x3627e6){const _0x3b2d11=new Date(_0x3627e6);_0x3b2d11[_0x34cc30(0x103)](0x17,0x3b,0x3b,0x3e7),_0x4f2e92['createdAt'][_0x34cc30(0x8f)]=_0x3b2d11,console['log'](_0x34cc30(0xca)+_0x3b2d11[_0x34cc30(0xaa)]());}}}console[_0x34cc30(0xf4)](_0x34cc30(0xea),JSON['stringify'](_0x4f2e92,null,0x2));const [_0x63c8c7,_0x19e4f7]=await Promise[_0x34cc30(0x76)]([database_1['default'][_0x34cc30(0xe1)][_0x34cc30(0x9b)]({'where':_0x4f2e92,'skip':_0x13e877,'take':_0x5c68e7,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x34cc30(0xfa)][_0x34cc30(0xe1)][_0x34cc30(0x79)]({'where':_0x4f2e92})]);return{'payouts':_0x63c8c7[_0x34cc30(0xe6)](_0x3ef9da=>{const _0x1000ad=_0x34cc30;let _0x159eb6=null;switch(_0x3ef9da[_0x1000ad(0xb5)]){case _0x1000ad(0x7f):_0x159eb6=_0x3ef9da[_0x1000ad(0xed)][_0x1000ad(0xeb)];break;case _0x1000ad(0x9c):_0x159eb6=_0x3ef9da[_0x1000ad(0xed)][_0x1000ad(0x9d)];break;case _0x1000ad(0xba):_0x159eb6=_0x3ef9da[_0x1000ad(0xed)][_0x1000ad(0x7a)];break;case _0x1000ad(0x80):_0x159eb6=_0x3ef9da[_0x1000ad(0xed)][_0x1000ad(0xd6)];break;}return{'id':_0x3ef9da['id'],'amount':_0x3ef9da[_0x1000ad(0xdc)],'network':this['formatNetworkName'](_0x3ef9da['network']),'wallet':_0x159eb6,'status':_0x3ef9da[_0x1000ad(0xf7)],'txid':_0x3ef9da[_0x1000ad(0xc3)],'notes':_0x3ef9da[_0x1000ad(0x114)],'periodFrom':_0x3ef9da['periodFrom'],'periodTo':_0x3ef9da[_0x1000ad(0xf6)],'createdAt':_0x3ef9da[_0x1000ad(0xa7)],'paidAt':_0x3ef9da['paidAt']};}),'pagination':{'page':_0x973eae,'limit':_0x5c68e7,'total':_0x19e4f7,'totalPages':Math[_0x34cc30(0x109)](_0x19e4f7/_0x5c68e7)}};}async['getPayoutById'](_0x37085c,_0x11aa6b){const _0x4e4296=a54_0x3f1a7e,_0x43a51f=await database_1[_0x4e4296(0xfa)][_0x4e4296(0xe1)][_0x4e4296(0xb2)]({'where':{'id':_0x11aa6b,'shopId':_0x37085c}});if(!_0x43a51f)return null;return{'id':_0x43a51f['id'],'amount':_0x43a51f['amount'],'network':_0x43a51f[_0x4e4296(0xb5)],'status':_0x43a51f[_0x4e4296(0xf7)],'txid':_0x43a51f[_0x4e4296(0xc3)],'notes':_0x43a51f[_0x4e4296(0x114)],'createdAt':_0x43a51f[_0x4e4296(0xa7)],'paidAt':_0x43a51f[_0x4e4296(0xaf)]};}async[a54_0x3f1a7e(0x86)](_0x348773,_0x2a03c8){const _0x8cf59c=a54_0x3f1a7e,_0x56f0ae=new Date();let _0x461f7e;switch(_0x2a03c8){case'7d':_0x461f7e=new Date(_0x56f0ae['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x8cf59c(0xa9):_0x461f7e=new Date(_0x56f0ae[_0x8cf59c(0x115)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x8cf59c(0x100):_0x461f7e=new Date(_0x56f0ae[_0x8cf59c(0x115)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x461f7e=new Date(_0x56f0ae['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1a9be9,_0x492d3e,_0x502e8b,_0x59fcaa,_0x3cb2b8,_0x1f58ec]=await Promise[_0x8cf59c(0x76)]([database_1[_0x8cf59c(0xfa)][_0x8cf59c(0xe1)][_0x8cf59c(0x79)]({'where':{'shopId':_0x348773,'createdAt':{'gte':_0x461f7e}}}),database_1[_0x8cf59c(0xfa)][_0x8cf59c(0xe1)][_0x8cf59c(0x79)]({'where':{'shopId':_0x348773,'status':_0x8cf59c(0x7d),'createdAt':{'gte':_0x461f7e}}}),database_1[_0x8cf59c(0xfa)][_0x8cf59c(0xe1)]['count']({'where':{'shopId':_0x348773,'status':_0x8cf59c(0xe9),'createdAt':{'gte':_0x461f7e}}}),database_1[_0x8cf59c(0xfa)]['payout'][_0x8cf59c(0x79)]({'where':{'shopId':_0x348773,'status':_0x8cf59c(0xd0),'createdAt':{'gte':_0x461f7e}}}),database_1[_0x8cf59c(0xfa)]['payout']['findMany']({'where':{'shopId':_0x348773,'createdAt':{'gte':_0x461f7e}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x8cf59c(0xe1)][_0x8cf59c(0x9b)]({'where':{'shopId':_0x348773},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3ab532=_0x3cb2b8[_0x8cf59c(0x89)]((_0x4612fb,_0x5a744b)=>_0x4612fb+_0x5a744b[_0x8cf59c(0xdc)],0x0),_0x54f916=_0x3cb2b8[_0x8cf59c(0xa0)](_0x156d0d=>_0x156d0d[_0x8cf59c(0xf7)]==='COMPLETED')[_0x8cf59c(0x89)]((_0x382d70,_0x5a0d1a)=>_0x382d70+_0x5a0d1a[_0x8cf59c(0xdc)],0x0),_0x19e663=_0x3cb2b8[_0x8cf59c(0xa0)](_0x171e02=>_0x171e02[_0x8cf59c(0xf7)]===_0x8cf59c(0xe9))[_0x8cf59c(0x89)]((_0x48d31b,_0x5cd9b4)=>_0x48d31b+_0x5cd9b4[_0x8cf59c(0xdc)],0x0),_0x9b3626=_0x3cb2b8[_0x8cf59c(0x89)]((_0x517e3c,_0xf3fd04)=>{const _0x1a3666=_0x8cf59c;return _0x517e3c[_0xf3fd04[_0x1a3666(0xb5)]]=(_0x517e3c[_0xf3fd04[_0x1a3666(0xb5)]]||0x0)+0x1,_0x517e3c;},{}),_0x4dda0c=_0x3cb2b8['reduce']((_0x286f99,_0x38e14c)=>{const _0x35ff9c=_0x8cf59c;return _0x286f99[_0x38e14c['status']]=(_0x286f99[_0x38e14c[_0x35ff9c(0xf7)]]||0x0)+0x1,_0x286f99;},{});return{'totalPayouts':_0x1a9be9,'completedPayouts':_0x492d3e,'pendingPayouts':_0x502e8b,'rejectedPayouts':_0x59fcaa,'totalAmount':_0x3ab532,'completedAmount':_0x54f916,'pendingAmount':_0x19e663,'payoutsByMethod':_0x9b3626,'payoutsByStatus':_0x4dda0c,'recentPayouts':_0x1f58ec[_0x8cf59c(0xe6)](_0x5c19d4=>({'id':_0x5c19d4['id'],'shopId':_0x348773,'amount':_0x5c19d4['amount'],'method':_0x5c19d4['network'],'status':_0x5c19d4[_0x8cf59c(0xf7)],'txid':_0x5c19d4[_0x8cf59c(0xc3)],'createdAt':_0x5c19d4[_0x8cf59c(0xa7)],'paidAt':_0x5c19d4[_0x8cf59c(0xaf)]}))};}async[a54_0x3f1a7e(0x10a)](_0x559f61){const _0x259a18=a54_0x3f1a7e;console[_0x259a18(0xf4)](_0x259a18(0x85)+_0x559f61+_0x259a18(0x78));const _0x20e4ea=await database_1[_0x259a18(0xfa)][_0x259a18(0xed)][_0x259a18(0xde)]({'where':{'id':_0x559f61},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x20e4ea)throw new Error(_0x259a18(0xc1));const _0xc27359=new Date(),_0x19fff8=new Date(_0xc27359['getFullYear'](),_0xc27359[_0x259a18(0x112)](),0x1),_0x171b00=new Date(_0xc27359[_0x259a18(0x8b)](),_0xc27359[_0x259a18(0x112)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x56330a=await database_1[_0x259a18(0xfa)]['payout'][_0x259a18(0xe7)]({'_sum':{'amount':!![]},'where':{'shopId':_0x559f61,'createdAt':{'gte':_0x19fff8,'lte':_0x171b00},'status':_0x259a18(0x7d)}}),_0x39249d=_0x56330a[_0x259a18(0x104)][_0x259a18(0xdc)]||0x0,_0x1d1758={'availableBalance':Math[_0x259a18(0x98)](_0x20e4ea[_0x259a18(0xb1)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x20e4ea[_0x259a18(0x99)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x20e4ea[_0x259a18(0xb1)]*0x64)/0x64,'thisMonth':Math[_0x259a18(0x98)](_0x39249d*0x64)/0x64};return console[_0x259a18(0xf4)](_0x259a18(0x8c)+_0x20e4ea['username']+_0x259a18(0xd2)),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x1d1758['availableBalance']+_0x259a18(0xb3)),console[_0x259a18(0xf4)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x1d1758[_0x259a18(0x99)]+'\x20USDT\x20(total\x20payouts)'),console['log'](_0x259a18(0x8e)+_0x1d1758[_0x259a18(0x110)]+_0x259a18(0xb3)),console[_0x259a18(0xf4)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x1d1758[_0x259a18(0xb0)]+_0x259a18(0x117)),_0x1d1758;}[a54_0x3f1a7e(0xf1)](_0x409bba){const _0x52e45c=a54_0x3f1a7e,_0x52f7b5={'test_gateway':_0x52e45c(0x88),'plisio':'Plisio','rapyd':_0x52e45c(0xbf),'noda':_0x52e45c(0xc5),'cointopay':_0x52e45c(0xbc),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x52f7b5[_0x409bba]||_0x409bba;}async[a54_0x3f1a7e(0xcf)](_0x431822){return this['getShopPayoutStats'](_0x431822);}async[a54_0x3f1a7e(0xe5)](_0x3438f3,_0x1f891b){const _0x2ee045=a54_0x3f1a7e,{page:_0x518f08,limit:_0x362bd1,paymentId:_0x36f2be}=_0x1f891b,_0xfb29c9=(_0x518f08-0x1)*_0x362bd1,_0x2e4f64={'shopId':_0x3438f3};_0x36f2be&&(_0x2e4f64[_0x2ee045(0x9f)]=_0x36f2be);const [_0x200313,_0x2198b9]=await Promise[_0x2ee045(0x76)]([database_1[_0x2ee045(0xfa)][_0x2ee045(0x97)][_0x2ee045(0x9b)]({'where':_0x2e4f64,'skip':_0xfb29c9,'take':_0x362bd1,'orderBy':{'createdAt':_0x2ee045(0x121)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2ee045(0xfa)][_0x2ee045(0x97)][_0x2ee045(0x79)]({'where':_0x2e4f64})]);return{'logs':_0x200313[_0x2ee045(0xe6)](_0x4c05cf=>({'id':_0x4c05cf['id'],'paymentId':_0x4c05cf[_0x2ee045(0x9f)],'shopId':_0x4c05cf[_0x2ee045(0xa8)],'event':_0x4c05cf[_0x2ee045(0xe2)],'statusCode':_0x4c05cf[_0x2ee045(0x102)],'retryCount':_0x4c05cf[_0x2ee045(0xb4)],'responseBody':_0x4c05cf[_0x2ee045(0xd5)],'createdAt':_0x4c05cf[_0x2ee045(0xa7)],'payment':_0x4c05cf[_0x2ee045(0xf2)]})),'pagination':{'page':_0x518f08,'limit':_0x362bd1,'total':_0x2198b9,'totalPages':Math['ceil'](_0x2198b9/_0x362bd1)}};}async[a54_0x3f1a7e(0x9e)](_0x450936,_0x1066d2){const _0x549068=a54_0x3f1a7e,_0xea5be3=new Date();let _0x18323c;switch(_0x1066d2){case'7d':_0x18323c=new Date(_0xea5be3['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x549068(0xa9):_0x18323c=new Date(_0xea5be3[_0x549068(0x115)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x549068(0x100):_0x18323c=new Date(_0xea5be3[_0x549068(0x115)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x18323c=new Date(_0xea5be3[_0x549068(0x115)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5aecf8,_0xa86d13,_0x47a180,_0x1d0d98,_0x46cd88]=await Promise[_0x549068(0x76)]([database_1['default']['payment']['count']({'where':{'shopId':_0x450936,'gateway':{'not':_0x549068(0x11e)},'createdAt':{'gte':_0x18323c}}}),database_1['default'][_0x549068(0xf2)][_0x549068(0x79)]({'where':{'shopId':_0x450936,'gateway':{'not':_0x549068(0x11e)},'status':_0x549068(0x94),'createdAt':{'gte':_0x18323c}}}),database_1['default'][_0x549068(0xf2)]['findMany']({'where':{'shopId':_0x450936,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0x18323c}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x549068(0xf2)][_0x549068(0x9b)]({'where':{'shopId':_0x450936,'gateway':{'not':_0x549068(0x11e)}},'take':0xa,'orderBy':{'createdAt':_0x549068(0x121)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x549068(0xfa)]['payment'][_0x549068(0x9b)]({'where':{'shopId':_0x450936,'gateway':{'not':_0x549068(0x11e)},'createdAt':{'gte':_0x18323c}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x2a873d=0x0;for(const _0x2b4ad4 of _0x47a180){if(_0x2b4ad4[_0x549068(0xb9)])_0x2a873d+=_0x2b4ad4[_0x549068(0xb9)];else{const _0x2c7aa4=await currencyService_1[_0x549068(0x10c)][_0x549068(0x90)](_0x2b4ad4[_0x549068(0xdc)],_0x2b4ad4['currency']);_0x2a873d+=_0x2c7aa4;}}const _0x5f4b8a=this[_0x549068(0xa1)](_0x46cd88,_0x18323c,_0xea5be3),_0x3d3f6b=_0x5aecf8>0x0?_0xa86d13/_0x5aecf8*0x64:0x0;return{'totalPayments':_0x5aecf8,'successfulPayments':_0xa86d13,'totalRevenue':Math[_0x549068(0x98)](_0x2a873d*0x64)/0x64,'conversionRate':Math[_0x549068(0x98)](_0x3d3f6b*0x64)/0x64,'dailyRevenue':_0x5f4b8a[_0x549068(0xcb)],'dailyPayments':_0x5f4b8a[_0x549068(0xd1)],'recentPayments':_0x1d0d98[_0x549068(0xe6)](_0x96fc8b=>({'id':_0x96fc8b['id'],'gateway':_0x96fc8b[_0x549068(0x84)],'amount':_0x96fc8b['amount'],'currency':_0x96fc8b[_0x549068(0xce)],'status':_0x96fc8b[_0x549068(0xf7)],'createdAt':_0x96fc8b[_0x549068(0xa7)]}))};}[a54_0x3f1a7e(0xa1)](_0x3c2817,_0x330131,_0x506ca5){const _0x17e258=a54_0x3f1a7e,_0x522886=new Map(),_0x19cc3f=new Date(_0x330131);while(_0x19cc3f<=_0x506ca5){const _0x5747a2=_0x19cc3f[_0x17e258(0xaa)]()[_0x17e258(0xe0)]('T')[0x0];_0x522886[_0x17e258(0xd3)](_0x5747a2,{'revenue':0x0,'count':0x0}),_0x19cc3f[_0x17e258(0xc4)](_0x19cc3f[_0x17e258(0x10f)]()+0x1);}for(const _0x5c97ac of _0x3c2817){const _0x577974=_0x5c97ac[_0x17e258(0xa7)][_0x17e258(0xaa)]()[_0x17e258(0xe0)]('T')[0x0],_0x27d070=_0x522886['get'](_0x577974);_0x27d070&&(_0x27d070['count']+=0x1,_0x5c97ac[_0x17e258(0xf7)]===_0x17e258(0x94)&&_0x5c97ac[_0x17e258(0xb9)]&&(_0x27d070['revenue']+=_0x5c97ac[_0x17e258(0xb9)]));}const _0x561073=[],_0x587964=[];for(const [_0x26c327,_0x20053e]of _0x522886){_0x561073[_0x17e258(0xe4)]({'date':_0x26c327,'amount':Math[_0x17e258(0x98)](_0x20053e[_0x17e258(0xae)]*0x64)/0x64}),_0x587964[_0x17e258(0xe4)]({'date':_0x26c327,'count':_0x20053e['count']});}return{'dailyRevenue':_0x561073,'dailyPayments':_0x587964};}}exports['ShopService']=ShopService;