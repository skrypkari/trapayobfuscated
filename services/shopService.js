'use strict';const a79_0x167e33=a79_0x577a;(function(_0x20a90d,_0x30130c){const _0x5558b9=a79_0x577a,_0x202e08=_0x20a90d();while(!![]){try{const _0x9296fc=parseInt(_0x5558b9(0x247))/0x1+-parseInt(_0x5558b9(0x20f))/0x2+-parseInt(_0x5558b9(0x263))/0x3+-parseInt(_0x5558b9(0x1f7))/0x4*(-parseInt(_0x5558b9(0x297))/0x5)+-parseInt(_0x5558b9(0x273))/0x6*(-parseInt(_0x5558b9(0x1fb))/0x7)+parseInt(_0x5558b9(0x1f9))/0x8*(parseInt(_0x5558b9(0x255))/0x9)+-parseInt(_0x5558b9(0x2b7))/0xa;if(_0x9296fc===_0x30130c)break;else _0x202e08['push'](_0x202e08['shift']());}catch(_0x3c1e83){_0x202e08['push'](_0x202e08['shift']());}}}(a79_0x596d,0xdbaa6));var __importDefault=this&&this['__importDefault']||function(_0x134705){const _0x381bdd=a79_0x577a;return _0x134705&&_0x134705[_0x381bdd(0x213)]?_0x134705:{'default':_0x134705};};function a79_0x596d(){const _0x184238=['paidAt','verify','fullName',',\x20dateFrom:\x20','updatePayment','round','twoFactorSecret','parse','testWebhook','erc20','split','generateDailyStatistics','682560oXBeqL','usdcErcWallet','USDC\x20Ethereum','payment','üìä\x20Shop\x20','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','getMonth','amount','CoinToPay','TrapaPay','Payment\x20not\x20found','getPayoutStats','status','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','qrcode','otpauth_url','shopId','./paymentService','currencyService','updateShopProfile','getWebhookLogs','gte','webhookUrl','randomBytes','Shop\x20not\x20found','findUnique','Plisio','wallets','yesterday','awaitingPayout','getPayoutStatistics','amountUSDT','crypto','balance','filter','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','sourceCurrency','totalPaidOut','_sum','gateways','USDT\x20ERC20','986412aGGylf','totp','48iakJcY','paid','182rRsVKl','\x20USDT\x20(current\x20balance)','USDT\x20BSC','merchantUrl','../types/gateway','periodTo','responseBody','Test\x20webhook\x20sent\x20successfully\x20(',',\x20period:\x20','stringify','2FA\x20is\x20already\x20enabled','aggregate','network','maxPayments','gateway','Error\x20parsing\x20webhook\x20events:','splice','trc20','all_time','disable2FA','895980SQxLPc','all','set','üìÖ\x20Custom\x20period:\x20','__esModule','\x20USDT\x20(total\x20payouts)','thisMonth','backupCodes','shop','ShopService','customerName','...','enable2FA','USD','\x20payout\x20statistics\x20calculated:','USDT\x20TRC20','YESTERDAY','\x20to\x20','No\x20webhook\x20URL\x20configured','CHARGEBACK','\x20\x20\x20üíµ\x20Available\x20balance:\x20','name','telegram','getUTCDay','paymentId','hash','updateWallets','event','get','Test\x20Gateway','üîë\x20Generated\x20','telegramId','getDate','delete','KLYME\x20GB','generateBackupCodes','hex','üìÖ\x20Period\x20end:\x20','username','map','getGatewayDisplayName','Invalid\x202FA\x20token\x20or\x20backup\x20code','asc','custom_','isActive','üìÖ\x20Date\x20start:\x20','KLYME\x20EU','bcryptjs','speakeasy','getPaymentsByShop','findMany','startsWith','REJECTED','üìÖ\x20Final\x20date\x20range:\x20','usdtTrcWallet','COMPLETED','801397MezhFO','getFullYear','Payment\x20System/1.0\x20(Test)','twoFactorToken','availableBalance','createPublicPayment','amountAfterGatewayCommissionUSDT','twoFactorEnabled','getPaymentById','count','reduce','toISOString','UTC','üåê\x20Network\x20filter:\x20','2626146HhZEMC','getUTCDate','default','customerEmail','usage','includes','setHours','log','this_month','gatewaySettings','last_week','üìÖ\x20Period\x20start:\x20','generateSecret','test_order_123','4159302YBiasw','usdtErcWallet','getTime','PAID','this_week','30d','usdtPolygonWallet','\x20\x20\x20üìÖ\x20This\x20month:\x20','Failed\x20to\x20send\x20webhook:\x20','payout','replace','defineProperty','polygon','createdAt','push','üîê\x202FA\x20enabled\x20for\x20shop:\x20','846bTOhwP','update','statusCode','shopUrl',',\x20dateTo:\x20','getShopPayoutStats','webhookEvents','dailyRevenue','revenue','./currencyService','getUTCFullYear','usdcPolygonWallet','Rapyd','Unknown\x20error','\x20USDT','getPaymentByShopAndId','test_gateway','notes','base32','\x20backup\x20codes','currency','Webhook\x20returned\x20error:\x20','settings','setDate','statusText','USDC\x20Polygon','toLowerCase','lte','paymentService','toDataURL','PaymentService','redirectUrl','toUpperCase','formatNetworkName','publicKey','üìä\x20Final\x20WHERE\x20conditions:','5qOyAda','ceil','PENDING','txid','isArray','paymentGateways','üìä\x20Status\x20filter:\x20','test','language','desc','webhookLog','Invalid\x202FA\x20token','test_payment_123','getStatistics','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','getUTCMonth','üìÖ\x20Custom\x20date\x20range:\x20','findFirst','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','TrapaPay\x20('];a79_0x596d=function(){return _0x184238;};return a79_0x596d();}function a79_0x577a(_0x29a72c,_0x2af22b){_0x29a72c=_0x29a72c-0x1dd;const _0x596da0=a79_0x596d();let _0x577a44=_0x596da0[_0x29a72c];return _0x577a44;}Object[a79_0x167e33(0x26e)](exports,a79_0x167e33(0x213),{'value':!![]}),exports[a79_0x167e33(0x218)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a79_0x167e33(0x23e))),crypto_1=__importDefault(require(a79_0x167e33(0x1ee))),speakeasy_1=__importDefault(require(a79_0x167e33(0x23f))),qrcode_1=__importDefault(require(a79_0x167e33(0x2c5))),currencyService_1=require(a79_0x167e33(0x27c)),paymentService_1=require(a79_0x167e33(0x1df)),gateway_1=require(a79_0x167e33(0x1ff));class ShopService{constructor(){const _0x3a612f=a79_0x167e33;this['paymentService']=new paymentService_1[(_0x3a612f(0x291))]();}async['getShopProfile'](_0x36f974){const _0x3aa665=a79_0x167e33,_0x274500=await database_1['default'][_0x3aa665(0x217)][_0x3aa665(0x1e7)]({'where':{'id':_0x36f974},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x274500)throw new Error('Shop\x20not\x20found');let _0x21b1d6=[];if(_0x274500[_0x3aa665(0x289)]?.[_0x3aa665(0x279)])try{_0x21b1d6=Array[_0x3aa665(0x29b)](_0x274500[_0x3aa665(0x289)][_0x3aa665(0x279)])?_0x274500[_0x3aa665(0x289)][_0x3aa665(0x279)]:JSON[_0x3aa665(0x2b2)](_0x274500[_0x3aa665(0x289)][_0x3aa665(0x279)]);}catch(_0x5b8041){console['error'](_0x3aa665(0x20a),_0x5b8041),_0x21b1d6=[];}const _0x20f2b4=gateway_1['AVAILABLE_GATEWAYS'][_0x3aa665(0x1f0)](_0x36684e=>_0x36684e[_0x3aa665(0x23b)])['map'](_0x154da3=>_0x154da3[_0x3aa665(0x224)]);let _0x479c18=_0x274500[_0x3aa665(0x29c)]?JSON[_0x3aa665(0x2b2)](_0x274500[_0x3aa665(0x29c)]):[];return Array[_0x3aa665(0x29b)](_0x479c18)&&(_0x479c18=_0x479c18[_0x3aa665(0x236)](_0x3cbf94=>_0x3cbf94[_0x3aa665(0x26d)](/\s+/g,'_')[_0x3aa665(0x28d)]())[_0x3aa665(0x1f0)](_0xebd46a=>_0x20f2b4[_0x3aa665(0x25a)](_0xebd46a))),{'id':_0x274500['id'],'fullName':_0x274500[_0x3aa665(0x224)],'username':_0x274500['username'],'telegramId':_0x274500[_0x3aa665(0x225)],'merchantUrl':_0x274500[_0x3aa665(0x276)],'gateways':_0x479c18,'gatewaySettings':_0x274500['gatewaySettings']?JSON[_0x3aa665(0x2b2)](_0x274500['gatewaySettings']):null,'publicKey':_0x274500[_0x3aa665(0x295)],'webhookUrl':_0x274500[_0x3aa665(0x289)]?.[_0x3aa665(0x1e4)]||null,'webhookEvents':_0x21b1d6,'wallets':{'usdtPolygonWallet':_0x274500[_0x3aa665(0x269)],'usdtTrcWallet':_0x274500[_0x3aa665(0x245)],'usdtErcWallet':_0x274500[_0x3aa665(0x264)],'usdcPolygonWallet':_0x274500[_0x3aa665(0x27e)],'usdcErcWallet':_0x274500['usdcErcWallet']},'status':_0x274500[_0x3aa665(0x2c3)],'createdAt':_0x274500[_0x3aa665(0x270)]};}async[a79_0x167e33(0x1e1)](_0x37450e,_0x43f25d){const _0x510eed=a79_0x167e33,_0x50f322={};_0x43f25d[_0x510eed(0x2ad)]&&(_0x50f322[_0x510eed(0x224)]=_0x43f25d['fullName']);_0x43f25d[_0x510eed(0x22e)]!==undefined&&(_0x50f322[_0x510eed(0x225)]=_0x43f25d[_0x510eed(0x22e)]||null);_0x43f25d[_0x510eed(0x1fe)]&&(_0x50f322[_0x510eed(0x276)]=_0x43f25d['merchantUrl']);_0x43f25d[_0x510eed(0x1f5)]&&(_0x50f322[_0x510eed(0x29c)]=JSON['stringify'](_0x43f25d[_0x510eed(0x1f5)]));_0x43f25d[_0x510eed(0x25e)]&&(_0x50f322['gatewaySettings']=JSON['stringify'](_0x43f25d[_0x510eed(0x25e)]));_0x43f25d[_0x510eed(0x1e9)]&&(_0x43f25d[_0x510eed(0x1e9)][_0x510eed(0x269)]!==undefined&&(_0x50f322[_0x510eed(0x269)]=_0x43f25d[_0x510eed(0x1e9)]['usdtPolygonWallet']||null),_0x43f25d[_0x510eed(0x1e9)][_0x510eed(0x245)]!==undefined&&(_0x50f322[_0x510eed(0x245)]=_0x43f25d[_0x510eed(0x1e9)][_0x510eed(0x245)]||null),_0x43f25d[_0x510eed(0x1e9)][_0x510eed(0x264)]!==undefined&&(_0x50f322[_0x510eed(0x264)]=_0x43f25d[_0x510eed(0x1e9)][_0x510eed(0x264)]||null),_0x43f25d['wallets'][_0x510eed(0x27e)]!==undefined&&(_0x50f322[_0x510eed(0x27e)]=_0x43f25d[_0x510eed(0x1e9)][_0x510eed(0x27e)]||null));const _0x5ae7c6=await database_1['default']['shop'][_0x510eed(0x274)]({'where':{'id':_0x37450e},'data':_0x50f322,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x3272ba=[];if(_0x5ae7c6[_0x510eed(0x289)]?.[_0x510eed(0x279)])try{_0x3272ba=Array[_0x510eed(0x29b)](_0x5ae7c6[_0x510eed(0x289)][_0x510eed(0x279)])?_0x5ae7c6[_0x510eed(0x289)][_0x510eed(0x279)]:JSON['parse'](_0x5ae7c6[_0x510eed(0x289)][_0x510eed(0x279)]);}catch(_0x441e49){console['error'](_0x510eed(0x20a),_0x441e49),_0x3272ba=[];}return{'id':_0x5ae7c6['id'],'fullName':_0x5ae7c6['name'],'username':_0x5ae7c6[_0x510eed(0x235)],'telegramId':_0x5ae7c6[_0x510eed(0x225)],'merchantUrl':_0x5ae7c6['shopUrl'],'gateways':_0x5ae7c6[_0x510eed(0x29c)]?JSON[_0x510eed(0x2b2)](_0x5ae7c6['paymentGateways']):null,'gatewaySettings':_0x5ae7c6[_0x510eed(0x25e)]?JSON[_0x510eed(0x2b2)](_0x5ae7c6[_0x510eed(0x25e)]):null,'publicKey':_0x5ae7c6[_0x510eed(0x295)],'webhookUrl':_0x5ae7c6[_0x510eed(0x289)]?.['webhookUrl']||null,'webhookEvents':_0x3272ba,'wallets':{'usdtPolygonWallet':_0x5ae7c6[_0x510eed(0x269)],'usdtTrcWallet':_0x5ae7c6[_0x510eed(0x245)],'usdtErcWallet':_0x5ae7c6[_0x510eed(0x264)],'usdcPolygonWallet':_0x5ae7c6[_0x510eed(0x27e)],'usdcErcWallet':_0x5ae7c6[_0x510eed(0x2b8)]},'status':_0x5ae7c6[_0x510eed(0x2c3)],'createdAt':_0x5ae7c6['createdAt']};}async[a79_0x167e33(0x229)](_0x40bfd7,_0x301812){const _0x9399fa=a79_0x167e33,_0x357ee1=await database_1[_0x9399fa(0x257)][_0x9399fa(0x217)][_0x9399fa(0x1e7)]({'where':{'id':_0x40bfd7},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x357ee1)throw new Error('Shop\x20not\x20found');if(_0x357ee1[_0x9399fa(0x24e)]){if(!_0x301812['twoFactorToken'])throw new Error('2FA\x20token\x20is\x20required');const _0xa8433c=speakeasy_1[_0x9399fa(0x257)][_0x9399fa(0x1f8)]['verify']({'secret':_0x357ee1['twoFactorSecret'],'encoding':'base32','token':_0x301812[_0x9399fa(0x24a)],'window':0x2});if(!_0xa8433c){let _0x355418=![];if(_0x357ee1[_0x9399fa(0x216)]){const _0x1a6303=JSON[_0x9399fa(0x2b2)](_0x357ee1['backupCodes']);for(let _0x5031e8=0x0;_0x5031e8<_0x1a6303['length'];_0x5031e8++){const _0x57a58e=await bcryptjs_1[_0x9399fa(0x257)]['compare'](_0x301812['twoFactorToken'],_0x1a6303[_0x5031e8]);if(_0x57a58e){_0x355418=!![],_0x1a6303[_0x9399fa(0x20b)](_0x5031e8,0x1),await database_1[_0x9399fa(0x257)][_0x9399fa(0x217)][_0x9399fa(0x274)]({'where':{'id':_0x40bfd7},'data':{'backupCodes':JSON[_0x9399fa(0x204)](_0x1a6303)}});break;}}}if(!_0x355418)throw new Error(_0x9399fa(0x238));}}const _0x2bf63={};_0x301812[_0x9399fa(0x269)]!==undefined&&(_0x2bf63[_0x9399fa(0x269)]=_0x301812[_0x9399fa(0x269)]||null),_0x301812[_0x9399fa(0x245)]!==undefined&&(_0x2bf63[_0x9399fa(0x245)]=_0x301812[_0x9399fa(0x245)]||null),_0x301812['usdtErcWallet']!==undefined&&(_0x2bf63['usdtErcWallet']=_0x301812[_0x9399fa(0x264)]||null),_0x301812[_0x9399fa(0x27e)]!==undefined&&(_0x2bf63['usdcPolygonWallet']=_0x301812[_0x9399fa(0x27e)]||null),_0x301812[_0x9399fa(0x2b8)]!==undefined&&(_0x2bf63[_0x9399fa(0x2b8)]=_0x301812[_0x9399fa(0x2b8)]||null),await database_1[_0x9399fa(0x257)][_0x9399fa(0x217)][_0x9399fa(0x274)]({'where':{'id':_0x40bfd7},'data':_0x2bf63});}async[a79_0x167e33(0x2b3)](_0x1a9660){const _0x357972=a79_0x167e33,_0x6053fa=await database_1[_0x357972(0x257)][_0x357972(0x217)]['findUnique']({'where':{'id':_0x1a9660},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x6053fa?.[_0x357972(0x289)]?.[_0x357972(0x1e4)])throw new Error(_0x357972(0x221));const _0x26654d={'event':'test','payment':{'id':_0x357972(0x2a3),'order_id':_0x357972(0x262),'gateway':_0x357972(0x29e),'amount':0x64,'currency':_0x357972(0x21c),'status':_0x357972(0x1fa),'created_at':new Date()['toISOString']()}};try{const _0x3de699=await fetch(_0x6053fa[_0x357972(0x289)]['webhookUrl'],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x357972(0x249)},'body':JSON[_0x357972(0x204)](_0x26654d)});return _0x3de699['ok']?{'success':!![],'message':_0x357972(0x202)+_0x3de699['status']+')'}:{'success':![],'message':_0x357972(0x288)+_0x3de699[_0x357972(0x2c3)]+'\x20'+_0x3de699[_0x357972(0x28b)]};}catch(_0x5284b7){return{'success':![],'message':_0x357972(0x26b)+(_0x5284b7 instanceof Error?_0x5284b7['message']:_0x357972(0x280))};}}async['createPayment'](_0x12dc9a){const _0x9725d5=a79_0x167e33;return this[_0x9725d5(0x28f)][_0x9725d5(0x24c)]({'public_key':'','gateway':_0x12dc9a['gateway'],'order_id':undefined,'amount':_0x12dc9a[_0x9725d5(0x2be)],'currency':_0x12dc9a[_0x9725d5(0x287)],'source_currency':_0x12dc9a[_0x9725d5(0x1f2)],'usage':_0x12dc9a[_0x9725d5(0x259)],'expires_at':_0x12dc9a['expiresAt']?.[_0x9725d5(0x252)](),'success_url':_0x12dc9a[_0x9725d5(0x292)],'fail_url':_0x12dc9a[_0x9725d5(0x292)],'customer_email':_0x12dc9a[_0x9725d5(0x258)],'customer_name':_0x12dc9a[_0x9725d5(0x219)],'country':_0x12dc9a['country'],'language':_0x12dc9a[_0x9725d5(0x29f)],'amount_is_editable':_0x12dc9a['amountIsEditable'],'max_payments':_0x12dc9a[_0x9725d5(0x208)],'customer':_0x12dc9a['customer']});}async['getPayments'](_0x3fa015,_0x531ade){const _0x3075dd=a79_0x167e33;return this[_0x3075dd(0x28f)][_0x3075dd(0x240)](_0x3fa015,_0x531ade);}async[a79_0x167e33(0x24f)](_0xb079c2,_0xf2f420){const _0x4d8af7=a79_0x167e33;return this[_0x4d8af7(0x28f)][_0x4d8af7(0x282)](_0xb079c2,_0xf2f420);}async[a79_0x167e33(0x2af)](_0x8ce9ff,_0x4ac681,_0x1393f2){const _0x282cfc=a79_0x167e33,_0x1eb28c=await database_1[_0x282cfc(0x257)]['payment'][_0x282cfc(0x2a8)]({'where':{'id':_0x4ac681,'shopId':_0x8ce9ff}});if(!_0x1eb28c)throw new Error('Payment\x20not\x20found');const _0x4f391c=await database_1[_0x282cfc(0x257)][_0x282cfc(0x2ba)][_0x282cfc(0x274)]({'where':{'id':_0x4ac681},'data':{..._0x1393f2,'updatedAt':new Date()}});return _0x4f391c;}async['deletePayment'](_0x3edfac,_0x21f017){const _0x18d88f=a79_0x167e33,_0x3b5711=await database_1[_0x18d88f(0x257)][_0x18d88f(0x2ba)]['findFirst']({'where':{'id':_0x21f017,'shopId':_0x3edfac}});if(!_0x3b5711)throw new Error(_0x18d88f(0x2c1));await database_1['default'][_0x18d88f(0x2ba)][_0x18d88f(0x230)]({'where':{'id':_0x21f017}});}[a79_0x167e33(0x294)](_0x3e1f9f){const _0x36b169=a79_0x167e33,_0x3c7591={'polygon':'USDT\x20Polygon','trc20':_0x36b169(0x21e),'erc20':_0x36b169(0x1f6),'bsc':_0x36b169(0x1fd),'polygon_usdc':_0x36b169(0x28c),'erc20_usdc':_0x36b169(0x2b9)};return _0x3c7591[_0x3e1f9f]||_0x3e1f9f;}async['getPayouts'](_0x2da896,_0x380f31){const _0x5420a9=a79_0x167e33,{page:_0x43634c,limit:_0x143019,status:_0x579114,method:_0x3b7750,network:_0x47810f,dateFrom:_0x31ccad,dateTo:_0x37f981,periodFrom:_0x1d7e72,periodTo:_0x1c48e1}=_0x380f31,_0x355748=(_0x43634c-0x1)*_0x143019;console[_0x5420a9(0x25c)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x380f31);const _0x481b99={'shopId':_0x2da896};_0x579114&&(_0x481b99['status']=_0x579114[_0x5420a9(0x293)](),console[_0x5420a9(0x25c)](_0x5420a9(0x29d)+_0x579114[_0x5420a9(0x293)]()));if(_0x3b7750)_0x481b99['network']=_0x3b7750,console[_0x5420a9(0x25c)]('üåê\x20Method\x20filter:\x20'+_0x3b7750);else _0x47810f&&(_0x481b99[_0x5420a9(0x207)]=_0x47810f,console[_0x5420a9(0x25c)](_0x5420a9(0x254)+_0x47810f));if(_0x31ccad||_0x37f981||_0x1d7e72||_0x1c48e1){_0x481b99[_0x5420a9(0x270)]={};if(_0x1d7e72){const _0x1a2842=new Date(_0x1d7e72);_0x1a2842[_0x5420a9(0x25b)](0x0,0x0,0x0,0x1),_0x481b99['createdAt'][_0x5420a9(0x1e3)]=_0x1a2842,console[_0x5420a9(0x25c)](_0x5420a9(0x260)+_0x1a2842['toISOString']());}else{if(_0x31ccad){const _0x18b284=new Date(_0x31ccad);_0x18b284[_0x5420a9(0x25b)](0x0,0x0,0x0,0x1),_0x481b99[_0x5420a9(0x270)]['gte']=_0x18b284,console['log'](_0x5420a9(0x23c)+_0x18b284[_0x5420a9(0x252)]());}}if(_0x1c48e1){const _0x3a9a51=new Date(_0x1c48e1);_0x3a9a51[_0x5420a9(0x25b)](0x17,0x3b,0x3b,0x3e7),_0x481b99[_0x5420a9(0x270)][_0x5420a9(0x28e)]=_0x3a9a51,console[_0x5420a9(0x25c)](_0x5420a9(0x234)+_0x3a9a51['toISOString']());}else{if(_0x37f981){const _0x27e77d=new Date(_0x37f981);_0x27e77d[_0x5420a9(0x25b)](0x17,0x3b,0x3b,0x3e7),_0x481b99[_0x5420a9(0x270)][_0x5420a9(0x28e)]=_0x27e77d,console[_0x5420a9(0x25c)]('üìÖ\x20Date\x20end:\x20'+_0x27e77d['toISOString']());}}}console[_0x5420a9(0x25c)](_0x5420a9(0x296),JSON[_0x5420a9(0x204)](_0x481b99,null,0x2));const [_0xa18482,_0x4f2934]=await Promise['all']([database_1['default']['payout'][_0x5420a9(0x241)]({'where':_0x481b99,'skip':_0x355748,'take':_0x143019,'orderBy':{'createdAt':_0x5420a9(0x2a0)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x5420a9(0x257)][_0x5420a9(0x26c)]['count']({'where':_0x481b99})]);return{'payouts':_0xa18482[_0x5420a9(0x236)](_0x57e315=>{const _0x5a4ae6=_0x5420a9;let _0x4c0bea=null;switch(_0x57e315['network']){case _0x5a4ae6(0x26f):_0x4c0bea=_0x57e315[_0x5a4ae6(0x217)][_0x5a4ae6(0x269)];break;case _0x5a4ae6(0x20c):_0x4c0bea=_0x57e315['shop'][_0x5a4ae6(0x245)];break;case _0x5a4ae6(0x2b4):_0x4c0bea=_0x57e315[_0x5a4ae6(0x217)][_0x5a4ae6(0x264)];break;case'polygon_usdc':_0x4c0bea=_0x57e315[_0x5a4ae6(0x217)][_0x5a4ae6(0x27e)];break;case'erc20_usdc':_0x4c0bea=_0x57e315[_0x5a4ae6(0x217)][_0x5a4ae6(0x2b8)];break;}return{'id':_0x57e315['id'],'amount':_0x57e315[_0x5a4ae6(0x2be)],'network':this[_0x5a4ae6(0x294)](_0x57e315[_0x5a4ae6(0x207)]),'wallet':_0x4c0bea,'status':_0x57e315[_0x5a4ae6(0x2c3)],'txid':_0x57e315[_0x5a4ae6(0x29a)],'notes':_0x57e315[_0x5a4ae6(0x284)],'periodFrom':_0x57e315['periodFrom'],'periodTo':_0x57e315[_0x5a4ae6(0x200)],'createdAt':_0x57e315[_0x5a4ae6(0x270)],'paidAt':_0x57e315[_0x5a4ae6(0x2ab)]};}),'pagination':{'page':_0x43634c,'limit':_0x143019,'total':_0x4f2934,'totalPages':Math[_0x5420a9(0x298)](_0x4f2934/_0x143019)}};}async['getPayoutById'](_0x42cdb4,_0x3e599a){const _0x11629c=a79_0x167e33,_0x5c1b3d=await database_1[_0x11629c(0x257)]['payout'][_0x11629c(0x2a8)]({'where':{'id':_0x3e599a,'shopId':_0x42cdb4}});if(!_0x5c1b3d)return null;return{'id':_0x5c1b3d['id'],'amount':_0x5c1b3d['amount'],'network':_0x5c1b3d[_0x11629c(0x207)],'status':_0x5c1b3d[_0x11629c(0x2c3)],'txid':_0x5c1b3d[_0x11629c(0x29a)],'notes':_0x5c1b3d['notes'],'createdAt':_0x5c1b3d[_0x11629c(0x270)],'paidAt':_0x5c1b3d[_0x11629c(0x2ab)]};}async[a79_0x167e33(0x1ec)](_0x28635b,_0x2f2faa){const _0x50bbdf=a79_0x167e33,_0x5dc6ec=new Date();let _0x597dd1,_0x58fe9c;switch(_0x2f2faa){case _0x50bbdf(0x1ea):case _0x50bbdf(0x21f):const _0x20a31b=new Date(_0x5dc6ec);_0x20a31b[_0x50bbdf(0x28a)](_0x20a31b[_0x50bbdf(0x22f)]()-0x1),_0x597dd1=new Date(_0x20a31b),_0x597dd1[_0x50bbdf(0x25b)](0x0,0x0,0x0,0x0),_0x58fe9c=new Date(_0x20a31b),_0x58fe9c[_0x50bbdf(0x25b)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x597dd1=new Date(_0x5dc6ec[_0x50bbdf(0x265)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x50bbdf(0x268):_0x597dd1=new Date(_0x5dc6ec['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x597dd1=new Date(_0x5dc6ec['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x597dd1=new Date(_0x5dc6ec[_0x50bbdf(0x265)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x1c9a1a={'gte':_0x597dd1};_0x58fe9c&&(_0x1c9a1a[_0x50bbdf(0x28e)]=_0x58fe9c);const [_0x4bedc7,_0x4df253,_0x323e30,_0x5561a9,_0x44fd7d,_0x410034]=await Promise[_0x50bbdf(0x210)]([database_1['default'][_0x50bbdf(0x26c)][_0x50bbdf(0x250)]({'where':{'shopId':_0x28635b,'createdAt':_0x1c9a1a}}),database_1['default']['payout'][_0x50bbdf(0x250)]({'where':{'shopId':_0x28635b,'status':_0x50bbdf(0x246),'createdAt':_0x1c9a1a}}),database_1[_0x50bbdf(0x257)][_0x50bbdf(0x26c)][_0x50bbdf(0x250)]({'where':{'shopId':_0x28635b,'status':_0x50bbdf(0x299),'createdAt':_0x1c9a1a}}),database_1[_0x50bbdf(0x257)][_0x50bbdf(0x26c)][_0x50bbdf(0x250)]({'where':{'shopId':_0x28635b,'status':_0x50bbdf(0x243),'createdAt':_0x1c9a1a}}),database_1[_0x50bbdf(0x257)][_0x50bbdf(0x26c)][_0x50bbdf(0x241)]({'where':{'shopId':_0x28635b,'createdAt':_0x1c9a1a},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x50bbdf(0x257)][_0x50bbdf(0x26c)]['findMany']({'where':{'shopId':_0x28635b},'take':0xa,'orderBy':{'createdAt':_0x50bbdf(0x2a0)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x11d866=_0x44fd7d[_0x50bbdf(0x251)]((_0x270fd3,_0x4ba630)=>_0x270fd3+_0x4ba630[_0x50bbdf(0x2be)],0x0),_0x16c9a4=_0x44fd7d[_0x50bbdf(0x1f0)](_0x11e1cb=>_0x11e1cb[_0x50bbdf(0x2c3)]==='COMPLETED')[_0x50bbdf(0x251)]((_0x2bc30c,_0x23cc0a)=>_0x2bc30c+_0x23cc0a['amount'],0x0),_0x5d1f3b=_0x44fd7d[_0x50bbdf(0x1f0)](_0x2789eb=>_0x2789eb[_0x50bbdf(0x2c3)]===_0x50bbdf(0x299))['reduce']((_0x296475,_0x19a755)=>_0x296475+_0x19a755[_0x50bbdf(0x2be)],0x0),_0x4e6314=_0x44fd7d[_0x50bbdf(0x251)]((_0xfccad4,_0x5466ad)=>{const _0x2c40cd=_0x50bbdf;return _0xfccad4[_0x5466ad[_0x2c40cd(0x207)]]=(_0xfccad4[_0x5466ad[_0x2c40cd(0x207)]]||0x0)+0x1,_0xfccad4;},{}),_0x5147b7=_0x44fd7d[_0x50bbdf(0x251)]((_0x189a3e,_0x594921)=>{const _0x476bbd=_0x50bbdf;return _0x189a3e[_0x594921['status']]=(_0x189a3e[_0x594921[_0x476bbd(0x2c3)]]||0x0)+0x1,_0x189a3e;},{});return{'totalPayouts':_0x4bedc7,'completedPayouts':_0x4df253,'pendingPayouts':_0x323e30,'rejectedPayouts':_0x5561a9,'totalAmount':_0x11d866,'completedAmount':_0x16c9a4,'pendingAmount':_0x5d1f3b,'payoutsByMethod':_0x4e6314,'payoutsByStatus':_0x5147b7,'recentPayouts':_0x410034[_0x50bbdf(0x236)](_0x3140b0=>({'id':_0x3140b0['id'],'shopId':_0x28635b,'amount':_0x3140b0[_0x50bbdf(0x2be)],'method':_0x3140b0['network'],'status':_0x3140b0[_0x50bbdf(0x2c3)],'txid':_0x3140b0[_0x50bbdf(0x29a)],'createdAt':_0x3140b0[_0x50bbdf(0x270)],'paidAt':_0x3140b0[_0x50bbdf(0x2ab)]}))};}async[a79_0x167e33(0x278)](_0x24e082){const _0x2879e7=a79_0x167e33;console[_0x2879e7(0x25c)](_0x2879e7(0x2c4)+_0x24e082+_0x2879e7(0x21a));const _0x2f8ae5=await database_1[_0x2879e7(0x257)]['shop'][_0x2879e7(0x1e7)]({'where':{'id':_0x24e082},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2f8ae5)throw new Error(_0x2879e7(0x1e6));const _0x2038fa=new Date(),_0x2c0f57=new Date(_0x2038fa['getFullYear'](),_0x2038fa['getMonth'](),0x1),_0x486770=new Date(_0x2038fa[_0x2879e7(0x248)](),_0x2038fa[_0x2879e7(0x2bd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x56c36f=await database_1[_0x2879e7(0x257)][_0x2879e7(0x26c)][_0x2879e7(0x206)]({'_sum':{'amount':!![]},'where':{'shopId':_0x24e082,'createdAt':{'gte':_0x2c0f57,'lte':_0x486770},'status':'COMPLETED'}}),_0x5976ff=_0x56c36f[_0x2879e7(0x1f4)][_0x2879e7(0x2be)]||0x0,_0x3cf4b={'availableBalance':Math[_0x2879e7(0x2b0)](_0x2f8ae5[_0x2879e7(0x1ef)]*0x64)/0x64,'totalPaidOut':Math[_0x2879e7(0x2b0)](_0x2f8ae5['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x2879e7(0x2b0)](_0x2f8ae5[_0x2879e7(0x1ef)]*0x64)/0x64,'thisMonth':Math[_0x2879e7(0x2b0)](_0x5976ff*0x64)/0x64};return console[_0x2879e7(0x25c)](_0x2879e7(0x2bb)+_0x2f8ae5[_0x2879e7(0x235)]+_0x2879e7(0x21d)),console[_0x2879e7(0x25c)](_0x2879e7(0x223)+_0x3cf4b[_0x2879e7(0x24b)]+'\x20USDT\x20(current\x20balance)'),console[_0x2879e7(0x25c)](_0x2879e7(0x2bc)+_0x3cf4b[_0x2879e7(0x1f3)]+_0x2879e7(0x214)),console[_0x2879e7(0x25c)](_0x2879e7(0x2a5)+_0x3cf4b[_0x2879e7(0x1eb)]+_0x2879e7(0x1fc)),console[_0x2879e7(0x25c)](_0x2879e7(0x26a)+_0x3cf4b[_0x2879e7(0x215)]+_0x2879e7(0x281)),_0x3cf4b;}[a79_0x167e33(0x237)](_0x1e0f8f){const _0x293ad8=a79_0x167e33,_0x45d6ae={'test_gateway':_0x293ad8(0x22c),'plisio':_0x293ad8(0x1e8),'rapyd':_0x293ad8(0x27f),'noda':'Noda','cointopay':_0x293ad8(0x2bf),'klyme_eu':_0x293ad8(0x23d),'klyme_gb':_0x293ad8(0x231),'klyme_de':'KLYME\x20DE'};return _0x45d6ae[_0x1e0f8f]||_0x1e0f8f;}async[a79_0x167e33(0x2c2)](_0x52e33c){const _0x3887a0=a79_0x167e33;return this[_0x3887a0(0x278)](_0x52e33c);}async[a79_0x167e33(0x1e2)](_0x5ae92c,_0x2bd221){const _0x2275b9=a79_0x167e33,{page:_0x3d5571,limit:_0x15eb79,paymentId:_0x433aaa}=_0x2bd221,_0x5b4ebe=(_0x3d5571-0x1)*_0x15eb79,_0x145056={'shopId':_0x5ae92c};_0x433aaa&&(_0x145056[_0x2275b9(0x227)]=_0x433aaa);const [_0x111ee3,_0x3c12e6]=await Promise[_0x2275b9(0x210)]([database_1[_0x2275b9(0x257)][_0x2275b9(0x2a1)][_0x2275b9(0x241)]({'where':_0x145056,'skip':_0x5b4ebe,'take':_0x15eb79,'orderBy':{'createdAt':_0x2275b9(0x2a0)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x2275b9(0x2a1)][_0x2275b9(0x250)]({'where':_0x145056})]);return{'logs':_0x111ee3[_0x2275b9(0x236)](_0xd13808=>({'id':_0xd13808['id'],'paymentId':_0xd13808[_0x2275b9(0x227)],'shopId':_0xd13808[_0x2275b9(0x1de)],'event':_0xd13808[_0x2275b9(0x22a)],'statusCode':_0xd13808[_0x2275b9(0x275)],'retryCount':_0xd13808['retryCount'],'responseBody':_0xd13808[_0x2275b9(0x201)],'createdAt':_0xd13808[_0x2275b9(0x270)],'payment':_0xd13808[_0x2275b9(0x2ba)]})),'pagination':{'page':_0x3d5571,'limit':_0x15eb79,'total':_0x3c12e6,'totalPages':Math[_0x2275b9(0x298)](_0x3c12e6/_0x15eb79)}};}async[a79_0x167e33(0x2a4)](_0x1a02bc,_0x29360d,_0x46f4c6,_0x596569,_0x1655eb){const _0x169d49=a79_0x167e33;console['log']('üìä\x20Getting\x20statistics\x20for\x20shop\x20'+_0x1a02bc+_0x169d49(0x203)+_0x29360d+_0x169d49(0x2ae)+_0x46f4c6+_0x169d49(0x277)+_0x596569);const _0x23ad98=_0x1655eb?new Date(_0x1655eb):new Date();let _0x5097a8,_0x3d3499;if(_0x46f4c6&&_0x596569){const _0x38db79=new Date(_0x46f4c6),_0x659b70=new Date(_0x596569);_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x38db79['getUTCFullYear'](),_0x38db79['getUTCMonth'](),_0x38db79[_0x169d49(0x256)](),0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x659b70[_0x169d49(0x27d)](),_0x659b70[_0x169d49(0x2a6)](),_0x659b70[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7)),console[_0x169d49(0x25c)](_0x169d49(0x2a7)+_0x5097a8['toISOString']()+_0x169d49(0x220)+_0x3d3499[_0x169d49(0x252)]());}else{if(_0x29360d&&_0x29360d[_0x169d49(0x242)](_0x169d49(0x23a))){const _0x3993a8=_0x29360d['replace'](_0x169d49(0x23a),'')[_0x169d49(0x2b5)]('_');if(_0x3993a8['length']===0x2){const _0x2fb5d3=new Date(_0x3993a8[0x0]),_0x5af74d=new Date(_0x3993a8[0x1]);_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x2fb5d3[_0x169d49(0x27d)](),_0x2fb5d3[_0x169d49(0x2a6)](),_0x2fb5d3[_0x169d49(0x256)](),0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x5af74d['getUTCFullYear'](),_0x5af74d['getUTCMonth'](),_0x5af74d[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7)),console[_0x169d49(0x25c)](_0x169d49(0x212)+_0x5097a8[_0x169d49(0x252)]()+_0x169d49(0x220)+_0x3d3499[_0x169d49(0x252)]());}else{const _0x1c9b90=new Date(Date['UTC'](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98['getUTCMonth'](),_0x23ad98[_0x169d49(0x256)]()-0x1e));_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x1c9b90[_0x169d49(0x27d)](),_0x1c9b90[_0x169d49(0x2a6)](),_0x1c9b90[_0x169d49(0x256)](),0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x23ad98['getUTCFullYear'](),_0x23ad98[_0x169d49(0x2a6)](),_0x23ad98[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x4bfa97=_0x29360d||_0x169d49(0x25d);switch(_0x4bfa97[_0x169d49(0x28d)]()){case'today':_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)](),_0x23ad98[_0x169d49(0x256)](),0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)](),_0x23ad98[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x1a7fde=new Date(_0x23ad98);_0x1a7fde['setUTCDate'](_0x1a7fde[_0x169d49(0x256)]()-0x1),_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x1a7fde[_0x169d49(0x27d)](),_0x1a7fde[_0x169d49(0x2a6)](),_0x1a7fde['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x1a7fde['getUTCFullYear'](),_0x1a7fde['getUTCMonth'](),_0x1a7fde[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7));break;case _0x169d49(0x267):const _0x50d682=_0x23ad98['getUTCDay'](),_0x18d9f5=_0x50d682===0x0?-0x6:0x1-_0x50d682,_0x1c2d7e=_0x23ad98[_0x169d49(0x256)]()+_0x18d9f5;_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)](),_0x1c2d7e,0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)](),_0x23ad98[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7));break;case _0x169d49(0x25f):const _0x103d4e=new Date(Date[_0x169d49(0x253)](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)](),_0x23ad98[_0x169d49(0x256)]()-0x7)),_0x454325=_0x103d4e[_0x169d49(0x226)](),_0x435053=_0x454325===0x0?-0x6:0x1-_0x454325,_0x1025f5=_0x103d4e['getUTCDate']()+_0x435053;_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x103d4e[_0x169d49(0x27d)](),_0x103d4e[_0x169d49(0x2a6)](),_0x1025f5,0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x103d4e[_0x169d49(0x27d)](),_0x103d4e[_0x169d49(0x2a6)](),_0x1025f5+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x169d49(0x25d):_0x5097a8=new Date(Date[_0x169d49(0x253)](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)](),0x1,0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date['UTC'](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)](),_0x23ad98[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x5097a8=new Date(Date['UTC'](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98[_0x169d49(0x2a6)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x23ad98['getUTCFullYear'](),_0x23ad98['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x169d49(0x20d):_0x5097a8=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date[_0x169d49(0x253)](_0x23ad98['getUTCFullYear'](),_0x23ad98[_0x169d49(0x2a6)](),_0x23ad98[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x5097a8=new Date(Date['UTC'](_0x23ad98['getUTCFullYear'](),_0x23ad98[_0x169d49(0x2a6)](),0x1,0x0,0x0,0x0,0x0)),_0x3d3499=new Date(Date['UTC'](_0x23ad98[_0x169d49(0x27d)](),_0x23ad98['getUTCMonth'](),_0x23ad98[_0x169d49(0x256)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x169d49(0x25c)](_0x169d49(0x244)+_0x5097a8['toISOString']()+_0x169d49(0x220)+_0x3d3499[_0x169d49(0x252)]());const _0xf7ad85={'gte':_0x5097a8,'lte':_0x3d3499},[_0x28b9b6,_0x2c0e23,_0x5aa06f,_0x2f6a32,_0x2d1b09,_0x11e4e1,_0x57e055,_0xd19f4a,_0xe11119,_0x3a7489]=await Promise[_0x169d49(0x210)]([database_1[_0x169d49(0x257)][_0x169d49(0x2ba)][_0x169d49(0x250)]({'where':{'shopId':_0x1a02bc,'gateway':{'not':_0x169d49(0x283)},'status':{'notIn':[_0x169d49(0x299),'EXPIRED']},'createdAt':_0xf7ad85}}),database_1[_0x169d49(0x257)]['payment'][_0x169d49(0x250)]({'where':{'shopId':_0x1a02bc,'gateway':{'not':'test_gateway'},'status':_0x169d49(0x266),'createdAt':_0xf7ad85}}),database_1[_0x169d49(0x257)][_0x169d49(0x2ba)]['count']({'where':{'shopId':_0x1a02bc,'gateway':{'not':_0x169d49(0x283)},'status':_0x169d49(0x222)}}),database_1['default'][_0x169d49(0x2ba)][_0x169d49(0x250)]({'where':{'shopId':_0x1a02bc,'gateway':{'not':'test_gateway'},'status':'REFUND'}}),database_1['default']['payment']['findMany']({'where':{'shopId':_0x1a02bc,'gateway':{'not':_0x169d49(0x283)},'status':'PAID','createdAt':_0xf7ad85},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x169d49(0x257)]['payment'][_0x169d49(0x241)]({'where':{'shopId':_0x1a02bc,'gateway':{'not':_0x169d49(0x283)}},'take':0xa,'orderBy':{'createdAt':_0x169d49(0x2a0)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x169d49(0x257)][_0x169d49(0x2ba)][_0x169d49(0x241)]({'where':{'shopId':_0x1a02bc,'gateway':{'not':_0x169d49(0x283)},'createdAt':_0xf7ad85},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x169d49(0x239)}}),database_1['default'][_0x169d49(0x2ba)][_0x169d49(0x250)]({'where':{'shopId':_0x1a02bc,'gateway':{'not':_0x169d49(0x283)},'status':'PAID'}}),database_1[_0x169d49(0x257)][_0x169d49(0x2ba)][_0x169d49(0x241)]({'where':{'shopId':_0x1a02bc,'gateway':{'not':_0x169d49(0x283)},'status':'PAID'},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x169d49(0x257)]['shop'][_0x169d49(0x1e7)]({'where':{'id':_0x1a02bc},'select':{'balance':!![]}})]);let _0x541ca5=0x0,_0x3adfea=0x0;for(const _0x317b77 of _0x2d1b09){if(_0x317b77[_0x169d49(0x1ed)])_0x541ca5+=_0x317b77[_0x169d49(0x1ed)];else{const _0x325f97=await currencyService_1[_0x169d49(0x1e0)]['convertToUSDT'](_0x317b77['amount'],_0x317b77['currency']);_0x541ca5+=_0x325f97;}_0x317b77[_0x169d49(0x24d)]&&(_0x3adfea+=_0x317b77[_0x169d49(0x24d)]);}let _0x491f74=0x0;for(const _0x5065d4 of _0xe11119){_0x5065d4['amountAfterGatewayCommissionUSDT']&&(_0x491f74+=_0x5065d4['amountAfterGatewayCommissionUSDT']);}const _0x3fc3ce=this[_0x169d49(0x2b6)](_0x57e055,_0x5097a8,_0x3d3499||_0x23ad98),_0x304539=_0x28b9b6>0x0?_0x2c0e23/_0x28b9b6*0x64:0x0,_0x1daa8c=_0xd19f4a>0x0?_0x5aa06f/_0xd19f4a*0x64:0x0;return{'totalPayments':_0x28b9b6,'successfulPayments':_0x2c0e23,'totalRevenue':Math[_0x169d49(0x2b0)](_0x541ca5*0x64)/0x64,'merchantEarnings':Math[_0x169d49(0x2b0)](_0x3adfea*0x64)/0x64,'merchantTotalRevenue':Math[_0x169d49(0x2b0)](_0x491f74*0x64)/0x64,'payoutBalance':Math[_0x169d49(0x2b0)]((_0x3a7489?.[_0x169d49(0x1ef)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x169d49(0x2b0)](_0x304539*0x64)/0x64,'chargebackRate':Math[_0x169d49(0x2b0)](_0x1daa8c*0x64)/0x64,'chargebacks':_0x5aa06f,'refunds':_0x2f6a32,'dailyRevenue':_0x3fc3ce[_0x169d49(0x27a)],'dailyPayments':_0x3fc3ce['dailyPayments'],'recentPayments':_0x11e4e1[_0x169d49(0x236)](_0x35de9e=>({'id':_0x35de9e['id'],'gateway':_0x35de9e[_0x169d49(0x209)],'amount':_0x35de9e[_0x169d49(0x2be)],'currency':_0x35de9e['currency'],'status':_0x35de9e['status'],'createdAt':_0x35de9e[_0x169d49(0x270)]}))};}[a79_0x167e33(0x2b6)](_0x5ca51d,_0x5d8d5b,_0x11054d){const _0x483d31=a79_0x167e33,_0x47188e=new Map(),_0x4bd78c=new Date(_0x5d8d5b);while(_0x4bd78c<=_0x11054d){const _0x166f2d=_0x4bd78c[_0x483d31(0x252)]()[_0x483d31(0x2b5)]('T')[0x0];_0x47188e[_0x483d31(0x211)](_0x166f2d,{'revenue':0x0,'count':0x0}),_0x4bd78c['setDate'](_0x4bd78c[_0x483d31(0x22f)]()+0x1);}for(const _0x4467bb of _0x5ca51d){const _0x206985=_0x4467bb[_0x483d31(0x270)]['toISOString']()[_0x483d31(0x2b5)]('T')[0x0],_0x33688c=_0x47188e[_0x483d31(0x22b)](_0x206985);_0x33688c&&(_0x33688c['count']+=0x1,_0x4467bb[_0x483d31(0x2c3)]===_0x483d31(0x266)&&_0x4467bb['amountUSDT']&&(_0x33688c['revenue']+=_0x4467bb['amountUSDT']));}const _0x8c94b3=[],_0x481fe3=[];for(const [_0x38b330,_0x4b80d0]of _0x47188e){_0x8c94b3[_0x483d31(0x271)]({'date':_0x38b330,'amount':Math[_0x483d31(0x2b0)](_0x4b80d0[_0x483d31(0x27b)]*0x64)/0x64}),_0x481fe3['push']({'date':_0x38b330,'count':_0x4b80d0[_0x483d31(0x250)]});}return{'dailyRevenue':_0x8c94b3,'dailyPayments':_0x481fe3};}[a79_0x167e33(0x232)](_0x16e06f=0x8){const _0x140ee0=a79_0x167e33,_0x3cd821=[];for(let _0x10dde4=0x0;_0x10dde4<_0x16e06f;_0x10dde4++){const _0x32c4f7=crypto_1[_0x140ee0(0x257)][_0x140ee0(0x1e5)](0x4)['toString'](_0x140ee0(0x233))[_0x140ee0(0x293)]();_0x3cd821['push'](_0x32c4f7);}return _0x3cd821;}async['setup2FA'](_0x4b87d7){const _0x36540c=a79_0x167e33,_0x13e085=await database_1[_0x36540c(0x257)][_0x36540c(0x217)][_0x36540c(0x1e7)]({'where':{'id':_0x4b87d7},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x13e085)throw new Error(_0x36540c(0x1e6));const _0x53f84e=speakeasy_1[_0x36540c(0x257)][_0x36540c(0x261)]({'name':_0x36540c(0x2aa)+_0x13e085['username']+')','issuer':_0x36540c(0x2c0),'length':0x20}),_0x5c2c10=await qrcode_1[_0x36540c(0x257)][_0x36540c(0x290)](_0x53f84e[_0x36540c(0x1dd)]),_0xc9008f=this[_0x36540c(0x232)](0x8),_0x57a1d1=await Promise[_0x36540c(0x210)](_0xc9008f[_0x36540c(0x236)](_0x55cc58=>bcryptjs_1[_0x36540c(0x257)][_0x36540c(0x228)](_0x55cc58,0xa)));return await database_1[_0x36540c(0x257)]['shop'][_0x36540c(0x274)]({'where':{'id':_0x4b87d7},'data':{'twoFactorSecret':_0x53f84e['base32'],'backupCodes':JSON[_0x36540c(0x204)](_0x57a1d1)}}),console[_0x36540c(0x25c)](_0x36540c(0x1f1)+_0x13e085[_0x36540c(0x235)]),console[_0x36540c(0x25c)](_0x36540c(0x22d)+_0xc9008f['length']+_0x36540c(0x286)),{'secret':_0x53f84e['base32'],'qrCode':_0x5c2c10,'manualEntryKey':_0x53f84e[_0x36540c(0x285)],'backupCodes':_0xc9008f};}async[a79_0x167e33(0x21b)](_0x176de5,_0xe029){const _0x35d615=a79_0x167e33,_0x488655=await database_1[_0x35d615(0x257)][_0x35d615(0x217)][_0x35d615(0x1e7)]({'where':{'id':_0x176de5},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x488655)throw new Error(_0x35d615(0x1e6));if(!_0x488655[_0x35d615(0x2b1)])throw new Error(_0x35d615(0x2a9));if(_0x488655[_0x35d615(0x24e)])throw new Error(_0x35d615(0x205));const _0x2f9a24=speakeasy_1[_0x35d615(0x257)][_0x35d615(0x1f8)][_0x35d615(0x2ac)]({'secret':_0x488655[_0x35d615(0x2b1)],'encoding':_0x35d615(0x285),'token':_0xe029,'window':0x2});if(!_0x2f9a24)throw new Error(_0x35d615(0x2a2));return await database_1[_0x35d615(0x257)][_0x35d615(0x217)][_0x35d615(0x274)]({'where':{'id':_0x176de5},'data':{'twoFactorEnabled':!![]}}),console[_0x35d615(0x25c)](_0x35d615(0x272)+_0x488655[_0x35d615(0x235)]),{'enabled':!![]};}async[a79_0x167e33(0x20e)](_0x5001c2){const _0x3c7d28=a79_0x167e33,_0x43c167=await database_1[_0x3c7d28(0x257)][_0x3c7d28(0x217)][_0x3c7d28(0x1e7)]({'where':{'id':_0x5001c2},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x43c167)throw new Error(_0x3c7d28(0x1e6));await database_1[_0x3c7d28(0x257)][_0x3c7d28(0x217)][_0x3c7d28(0x274)]({'where':{'id':_0x5001c2},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x3c7d28(0x25c)]('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x43c167[_0x3c7d28(0x235)]);}}exports[a79_0x167e33(0x218)]=ShopService;