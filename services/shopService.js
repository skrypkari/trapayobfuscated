'use strict';const a58_0x262b0f=a58_0x5387;(function(_0x468a27,_0x56451b){const _0x4bea18=a58_0x5387,_0x4f6923=_0x468a27();while(!![]){try{const _0x4c9e2b=-parseInt(_0x4bea18(0x169))/0x1+parseInt(_0x4bea18(0x162))/0x2*(parseInt(_0x4bea18(0x1e8))/0x3)+parseInt(_0x4bea18(0x15f))/0x4+-parseInt(_0x4bea18(0x1c9))/0x5*(-parseInt(_0x4bea18(0x1ba))/0x6)+parseInt(_0x4bea18(0x1f8))/0x7+parseInt(_0x4bea18(0x1ce))/0x8*(-parseInt(_0x4bea18(0x18e))/0x9)+parseInt(_0x4bea18(0x182))/0xa*(-parseInt(_0x4bea18(0x179))/0xb);if(_0x4c9e2b===_0x56451b)break;else _0x4f6923['push'](_0x4f6923['shift']());}catch(_0x360a85){_0x4f6923['push'](_0x4f6923['shift']());}}}(a58_0xbf4d,0xcee1f));function a58_0x5387(_0x42f40b,_0x1dae5f){const _0xbf4d41=a58_0xbf4d();return a58_0x5387=function(_0x538755,_0x391008){_0x538755=_0x538755-0x150;let _0x4eed35=_0xbf4d41[_0x538755];return _0x4eed35;},a58_0x5387(_0x42f40b,_0x1dae5f);}var __importDefault=this&&this[a58_0x262b0f(0x178)]||function(_0x24e1c3){return _0x24e1c3&&_0x24e1c3['__esModule']?_0x24e1c3:{'default':_0x24e1c3};};Object[a58_0x262b0f(0x183)](exports,'__esModule',{'value':!![]}),exports[a58_0x262b0f(0x16e)]=void 0x0;const database_1=__importDefault(require(a58_0x262b0f(0x18d))),currencyService_1=require('./currencyService'),paymentService_1=require(a58_0x262b0f(0x176));function a58_0xbf4d(){const _0x16a0df=['USDT\x20Polygon','REJECTED','gateways','polygon_usdc','Test\x20Gateway','YESTERDAY','8418221ZcUOfs','paidAt','trc20','test','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','findUnique','maxPayments','lte','getTime','balance','awaitingPayout','yesterday','telegram','language','reduce','ceil','customerEmail','updateWallets','KLYME\x20EU','getPaymentByShopAndId','revenue','redirectUrl','error','usdtTrcWallet','payout','1227560YaIYFC','formatNetworkName','üìÖ\x20Date\x20end:\x20','4YHYDgA','webhookLog','webhookEvents','message','split','Shop\x20not\x20found','setHours','1532220JnBTsQ','createPublicPayment','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','periodTo','stringify','ShopService','üìÖ\x20Date\x20start:\x20','usdtErcWallet','üí∞\x20Getting\x20payouts\x20with\x20filters:','USD','\x20USDT\x20(current\x20balance)','gte','Unknown\x20error','./paymentService','responseBody','__importDefault','11nOrUop','getFullYear','PAID','currencyService','createPayment','\x20USDT\x20(total\x20payouts)','txid','shop','Payment\x20not\x20found','5076850PqYCVf','defineProperty','usage','status','set','merchantUrl','desc','test_order_123','settings','application/json','updatePayment','../config/database','27DUewpl','aggregate','push','delete','name','test_payment_123','webhookUrl','default','getShopProfile','polygon','...','country','amountIsEditable','periodFrom','isArray','map','customer','getWebhookLogs','USDT\x20TRC20','log','Rapyd','createdAt','Failed\x20to\x20send\x20webhook:\x20','No\x20webhook\x20URL\x20configured','getPayouts','_sum','customerName','getPaymentsByShop','KLYME\x20DE','erc20','findMany','update','usdcPolygonWallet','statusText','getGatewayDisplayName','findFirst','üìä\x20Final\x20WHERE\x20conditions:','filter','getPayoutById','getMonth','amountUSDT','amount','30d','dailyPayments','1855554lfDvxe','parse','toISOString','Webhook\x20returned\x20error:\x20','expiresAt','PaymentService','notes','getDate','Test\x20webhook\x20sent\x20successfully\x20(','count','USDT\x20ERC20','toLowerCase','USDC\x20Polygon','payment','PENDING','15rzSgAn','shopUrl','toUpperCase','Error\x20parsing\x20webhook\x20events:','publicKey','3022768kQetZh','retryCount','currency','COMPLETED','setDate','paymentGateways','test_gateway','get','getStatistics','usdtPolygonWallet','\x20\x20\x20üìÖ\x20This\x20month:\x20','updateShopProfile','\x20\x20\x20üíµ\x20Available\x20balance:\x20','generateDailyStatistics','gatewaySettings','username','round','90d','day','wallets','deletePayment','all','paymentService','totalPaidOut','üåê\x20Method\x20filter:\x20','üìÖ\x20Period\x20end:\x20','2375346lOBxRW','gateway','network','Plisio','getShopPayoutStats','asc','availableBalance','sourceCurrency','üåê\x20Network\x20filter:\x20','fullName'];a58_0xbf4d=function(){return _0x16a0df;};return a58_0xbf4d();}class ShopService{constructor(){const _0x1f5816=a58_0x262b0f;this[_0x1f5816(0x1e4)]=new paymentService_1[(_0x1f5816(0x1bf))]();}async[a58_0x262b0f(0x196)](_0x238afb){const _0x2e246c=a58_0x262b0f,_0x44fea4=await database_1[_0x2e246c(0x195)][_0x2e246c(0x180)][_0x2e246c(0x1fd)]({'where':{'id':_0x238afb},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x44fea4)throw new Error(_0x2e246c(0x167));let _0x346bc4=[];if(_0x44fea4[_0x2e246c(0x18a)]?.[_0x2e246c(0x164)])try{_0x346bc4=Array[_0x2e246c(0x19c)](_0x44fea4['settings'][_0x2e246c(0x164)])?_0x44fea4[_0x2e246c(0x18a)]['webhookEvents']:JSON['parse'](_0x44fea4['settings'][_0x2e246c(0x164)]);}catch(_0x4e4519){console[_0x2e246c(0x15c)](_0x2e246c(0x1cc),_0x4e4519),_0x346bc4=[];}return{'id':_0x44fea4['id'],'fullName':_0x44fea4[_0x2e246c(0x192)],'username':_0x44fea4['username'],'telegramId':_0x44fea4['telegram'],'merchantUrl':_0x44fea4[_0x2e246c(0x1ca)],'gateways':_0x44fea4[_0x2e246c(0x1d3)]?JSON[_0x2e246c(0x1bb)](_0x44fea4[_0x2e246c(0x1d3)]):null,'gatewaySettings':_0x44fea4[_0x2e246c(0x1dc)]?JSON[_0x2e246c(0x1bb)](_0x44fea4[_0x2e246c(0x1dc)]):null,'publicKey':_0x44fea4['publicKey'],'webhookUrl':_0x44fea4[_0x2e246c(0x18a)]?.['webhookUrl']||null,'webhookEvents':_0x346bc4,'wallets':{'usdtPolygonWallet':_0x44fea4[_0x2e246c(0x1d7)],'usdtTrcWallet':_0x44fea4[_0x2e246c(0x15d)],'usdtErcWallet':_0x44fea4[_0x2e246c(0x170)],'usdcPolygonWallet':_0x44fea4[_0x2e246c(0x1ae)]},'status':_0x44fea4[_0x2e246c(0x185)],'createdAt':_0x44fea4[_0x2e246c(0x1a3)]};}async[a58_0x262b0f(0x1d9)](_0x850c04,_0x58cb48){const _0x3ece3e=a58_0x262b0f,_0x328a00={};_0x58cb48[_0x3ece3e(0x1f1)]&&(_0x328a00[_0x3ece3e(0x192)]=_0x58cb48[_0x3ece3e(0x1f1)]);_0x58cb48['telegramId']!==undefined&&(_0x328a00[_0x3ece3e(0x152)]=_0x58cb48['telegramId']||null);_0x58cb48[_0x3ece3e(0x187)]&&(_0x328a00[_0x3ece3e(0x1ca)]=_0x58cb48[_0x3ece3e(0x187)]);_0x58cb48[_0x3ece3e(0x1f4)]&&(_0x328a00['paymentGateways']=JSON[_0x3ece3e(0x16d)](_0x58cb48['gateways']));_0x58cb48[_0x3ece3e(0x1dc)]&&(_0x328a00[_0x3ece3e(0x1dc)]=JSON[_0x3ece3e(0x16d)](_0x58cb48[_0x3ece3e(0x1dc)]));_0x58cb48[_0x3ece3e(0x1e1)]&&(_0x58cb48[_0x3ece3e(0x1e1)][_0x3ece3e(0x1d7)]!==undefined&&(_0x328a00[_0x3ece3e(0x1d7)]=_0x58cb48[_0x3ece3e(0x1e1)][_0x3ece3e(0x1d7)]||null),_0x58cb48[_0x3ece3e(0x1e1)][_0x3ece3e(0x15d)]!==undefined&&(_0x328a00[_0x3ece3e(0x15d)]=_0x58cb48[_0x3ece3e(0x1e1)][_0x3ece3e(0x15d)]||null),_0x58cb48[_0x3ece3e(0x1e1)][_0x3ece3e(0x170)]!==undefined&&(_0x328a00['usdtErcWallet']=_0x58cb48[_0x3ece3e(0x1e1)][_0x3ece3e(0x170)]||null),_0x58cb48[_0x3ece3e(0x1e1)][_0x3ece3e(0x1ae)]!==undefined&&(_0x328a00[_0x3ece3e(0x1ae)]=_0x58cb48[_0x3ece3e(0x1e1)]['usdcPolygonWallet']||null));const _0x4e4c28=await database_1[_0x3ece3e(0x195)]['shop'][_0x3ece3e(0x1ad)]({'where':{'id':_0x850c04},'data':_0x328a00,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0xb9e8a3=[];if(_0x4e4c28[_0x3ece3e(0x18a)]?.[_0x3ece3e(0x164)])try{_0xb9e8a3=Array['isArray'](_0x4e4c28['settings'][_0x3ece3e(0x164)])?_0x4e4c28['settings'][_0x3ece3e(0x164)]:JSON[_0x3ece3e(0x1bb)](_0x4e4c28[_0x3ece3e(0x18a)][_0x3ece3e(0x164)]);}catch(_0x413491){console[_0x3ece3e(0x15c)]('Error\x20parsing\x20webhook\x20events:',_0x413491),_0xb9e8a3=[];}return{'id':_0x4e4c28['id'],'fullName':_0x4e4c28[_0x3ece3e(0x192)],'username':_0x4e4c28[_0x3ece3e(0x1dd)],'telegramId':_0x4e4c28[_0x3ece3e(0x152)],'merchantUrl':_0x4e4c28[_0x3ece3e(0x1ca)],'gateways':_0x4e4c28[_0x3ece3e(0x1d3)]?JSON[_0x3ece3e(0x1bb)](_0x4e4c28[_0x3ece3e(0x1d3)]):null,'gatewaySettings':_0x4e4c28[_0x3ece3e(0x1dc)]?JSON[_0x3ece3e(0x1bb)](_0x4e4c28[_0x3ece3e(0x1dc)]):null,'publicKey':_0x4e4c28[_0x3ece3e(0x1cd)],'webhookUrl':_0x4e4c28[_0x3ece3e(0x18a)]?.[_0x3ece3e(0x194)]||null,'webhookEvents':_0xb9e8a3,'wallets':{'usdtPolygonWallet':_0x4e4c28[_0x3ece3e(0x1d7)],'usdtTrcWallet':_0x4e4c28['usdtTrcWallet'],'usdtErcWallet':_0x4e4c28['usdtErcWallet'],'usdcPolygonWallet':_0x4e4c28[_0x3ece3e(0x1ae)]},'status':_0x4e4c28[_0x3ece3e(0x185)],'createdAt':_0x4e4c28[_0x3ece3e(0x1a3)]};}async[a58_0x262b0f(0x157)](_0x10e310,_0x2592ee){const _0x1ba4e9=a58_0x262b0f,_0x102352={};_0x2592ee[_0x1ba4e9(0x1d7)]!==undefined&&(_0x102352[_0x1ba4e9(0x1d7)]=_0x2592ee['usdtPolygonWallet']||null),_0x2592ee[_0x1ba4e9(0x15d)]!==undefined&&(_0x102352[_0x1ba4e9(0x15d)]=_0x2592ee[_0x1ba4e9(0x15d)]||null),_0x2592ee[_0x1ba4e9(0x170)]!==undefined&&(_0x102352[_0x1ba4e9(0x170)]=_0x2592ee[_0x1ba4e9(0x170)]||null),_0x2592ee['usdcPolygonWallet']!==undefined&&(_0x102352['usdcPolygonWallet']=_0x2592ee[_0x1ba4e9(0x1ae)]||null),await database_1[_0x1ba4e9(0x195)][_0x1ba4e9(0x180)]['update']({'where':{'id':_0x10e310},'data':_0x102352});}async['testWebhook'](_0x25c6b5){const _0x112f0d=a58_0x262b0f,_0x13c1fd=await database_1['default'][_0x112f0d(0x180)][_0x112f0d(0x1fd)]({'where':{'id':_0x25c6b5},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x13c1fd?.[_0x112f0d(0x18a)]?.['webhookUrl'])throw new Error(_0x112f0d(0x1a5));const _0x31ac71={'event':_0x112f0d(0x1fb),'payment':{'id':_0x112f0d(0x193),'order_id':_0x112f0d(0x189),'gateway':_0x112f0d(0x1fb),'amount':0x64,'currency':_0x112f0d(0x172),'status':'paid','created_at':new Date()['toISOString']()}};try{const _0x1a76ff=await fetch(_0x13c1fd['settings'][_0x112f0d(0x194)],{'method':'POST','headers':{'Content-Type':_0x112f0d(0x18b),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x112f0d(0x16d)](_0x31ac71)});return _0x1a76ff['ok']?{'success':!![],'message':_0x112f0d(0x1c2)+_0x1a76ff[_0x112f0d(0x185)]+')'}:{'success':![],'message':_0x112f0d(0x1bd)+_0x1a76ff['status']+'\x20'+_0x1a76ff[_0x112f0d(0x1af)]};}catch(_0x353d06){return{'success':![],'message':_0x112f0d(0x1a4)+(_0x353d06 instanceof Error?_0x353d06[_0x112f0d(0x165)]:_0x112f0d(0x175))};}}async[a58_0x262b0f(0x17d)](_0x2b17c0){const _0x2bf191=a58_0x262b0f;return this[_0x2bf191(0x1e4)][_0x2bf191(0x16a)]({'public_key':'','gateway':_0x2b17c0[_0x2bf191(0x1e9)],'order_id':undefined,'amount':_0x2b17c0[_0x2bf191(0x1b7)],'currency':_0x2b17c0[_0x2bf191(0x1d0)],'source_currency':_0x2b17c0[_0x2bf191(0x1ef)],'usage':_0x2b17c0[_0x2bf191(0x184)],'expires_at':_0x2b17c0[_0x2bf191(0x1be)]?.[_0x2bf191(0x1bc)](),'success_url':_0x2b17c0[_0x2bf191(0x15b)],'fail_url':_0x2b17c0[_0x2bf191(0x15b)],'customer_email':_0x2b17c0[_0x2bf191(0x156)],'customer_name':_0x2b17c0[_0x2bf191(0x1a8)],'country':_0x2b17c0[_0x2bf191(0x199)],'language':_0x2b17c0[_0x2bf191(0x153)],'amount_is_editable':_0x2b17c0[_0x2bf191(0x19a)],'max_payments':_0x2b17c0[_0x2bf191(0x1fe)],'customer':_0x2b17c0[_0x2bf191(0x19e)]});}async['getPayments'](_0x3b4e2a,_0x570bfd){const _0x11e2c6=a58_0x262b0f;return this[_0x11e2c6(0x1e4)][_0x11e2c6(0x1a9)](_0x3b4e2a,_0x570bfd);}async['getPaymentById'](_0x58b628,_0x4e31dc){const _0x2767e9=a58_0x262b0f;return this[_0x2767e9(0x1e4)][_0x2767e9(0x159)](_0x58b628,_0x4e31dc);}async[a58_0x262b0f(0x18c)](_0x315401,_0x34f92f,_0x1034cc){const _0x291989=a58_0x262b0f,_0x24563a=await database_1[_0x291989(0x195)][_0x291989(0x1c7)][_0x291989(0x1b1)]({'where':{'id':_0x34f92f,'shopId':_0x315401}});if(!_0x24563a)throw new Error(_0x291989(0x181));const _0x33a637=await database_1['default']['payment'][_0x291989(0x1ad)]({'where':{'id':_0x34f92f},'data':{..._0x1034cc,'updatedAt':new Date()}});return _0x33a637;}async[a58_0x262b0f(0x1e2)](_0x103bf7,_0x4f0574){const _0x44bb1f=a58_0x262b0f,_0x137e1d=await database_1[_0x44bb1f(0x195)][_0x44bb1f(0x1c7)][_0x44bb1f(0x1b1)]({'where':{'id':_0x4f0574,'shopId':_0x103bf7}});if(!_0x137e1d)throw new Error(_0x44bb1f(0x181));await database_1[_0x44bb1f(0x195)][_0x44bb1f(0x1c7)][_0x44bb1f(0x191)]({'where':{'id':_0x4f0574}});}[a58_0x262b0f(0x160)](_0xc2cf9e){const _0x57e8a2=a58_0x262b0f,_0xfd197a={'polygon':_0x57e8a2(0x1f2),'trc20':_0x57e8a2(0x1a0),'erc20':_0x57e8a2(0x1c4),'bsc':'USDT\x20BSC','polygon_usdc':_0x57e8a2(0x1c6)};return _0xfd197a[_0xc2cf9e]||_0xc2cf9e;}async[a58_0x262b0f(0x1a6)](_0x1f708c,_0x91e19b){const _0x5a887e=a58_0x262b0f,{page:_0x49548b,limit:_0x16a152,status:_0x4f1a3f,method:_0x5c5b7c,network:_0x21d40f,dateFrom:_0x2984fb,dateTo:_0x5f16c2,periodFrom:_0xbf9efc,periodTo:_0x192940}=_0x91e19b,_0x2047d4=(_0x49548b-0x1)*_0x16a152;console[_0x5a887e(0x1a1)](_0x5a887e(0x171),_0x91e19b);const _0x21d94a={'shopId':_0x1f708c};_0x4f1a3f&&(_0x21d94a[_0x5a887e(0x185)]=_0x4f1a3f[_0x5a887e(0x1cb)](),console[_0x5a887e(0x1a1)]('üìä\x20Status\x20filter:\x20'+_0x4f1a3f[_0x5a887e(0x1cb)]()));if(_0x5c5b7c)_0x21d94a['network']=_0x5c5b7c,console[_0x5a887e(0x1a1)](_0x5a887e(0x1e6)+_0x5c5b7c);else _0x21d40f&&(_0x21d94a[_0x5a887e(0x1ea)]=_0x21d40f,console[_0x5a887e(0x1a1)](_0x5a887e(0x1f0)+_0x21d40f));if(_0x2984fb||_0x5f16c2||_0xbf9efc||_0x192940){_0x21d94a['createdAt']={};if(_0xbf9efc){const _0x2afd7f=new Date(_0xbf9efc);_0x2afd7f[_0x5a887e(0x168)](0x0,0x0,0x0,0x0),_0x21d94a[_0x5a887e(0x1a3)][_0x5a887e(0x174)]=_0x2afd7f,console['log']('üìÖ\x20Period\x20start:\x20'+_0x2afd7f[_0x5a887e(0x1bc)]());}else{if(_0x2984fb){const _0x43a651=new Date(_0x2984fb);_0x43a651[_0x5a887e(0x168)](0x0,0x0,0x0,0x0),_0x21d94a[_0x5a887e(0x1a3)][_0x5a887e(0x174)]=_0x43a651,console[_0x5a887e(0x1a1)](_0x5a887e(0x16f)+_0x43a651['toISOString']());}}if(_0x192940){const _0x27a64b=new Date(_0x192940);_0x27a64b['setHours'](0x17,0x3b,0x3b,0x3e7),_0x21d94a[_0x5a887e(0x1a3)][_0x5a887e(0x1ff)]=_0x27a64b,console['log'](_0x5a887e(0x1e7)+_0x27a64b['toISOString']());}else{if(_0x5f16c2){const _0x4eceaf=new Date(_0x5f16c2);_0x4eceaf[_0x5a887e(0x168)](0x17,0x3b,0x3b,0x3e7),_0x21d94a[_0x5a887e(0x1a3)][_0x5a887e(0x1ff)]=_0x4eceaf,console[_0x5a887e(0x1a1)](_0x5a887e(0x161)+_0x4eceaf[_0x5a887e(0x1bc)]());}}}console[_0x5a887e(0x1a1)](_0x5a887e(0x1b2),JSON['stringify'](_0x21d94a,null,0x2));const [_0x58c707,_0x46de25]=await Promise[_0x5a887e(0x1e3)]([database_1[_0x5a887e(0x195)][_0x5a887e(0x15e)]['findMany']({'where':_0x21d94a,'skip':_0x2047d4,'take':_0x16a152,'orderBy':{'createdAt':_0x5a887e(0x188)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x5a887e(0x195)]['payout'][_0x5a887e(0x1c3)]({'where':_0x21d94a})]);return{'payouts':_0x58c707[_0x5a887e(0x19d)](_0x18fbf5=>{const _0x38a489=_0x5a887e;let _0xa666e2=null;switch(_0x18fbf5['network']){case _0x38a489(0x197):_0xa666e2=_0x18fbf5['shop'][_0x38a489(0x1d7)];break;case _0x38a489(0x1fa):_0xa666e2=_0x18fbf5[_0x38a489(0x180)][_0x38a489(0x15d)];break;case _0x38a489(0x1ab):_0xa666e2=_0x18fbf5[_0x38a489(0x180)][_0x38a489(0x170)];break;case _0x38a489(0x1f5):_0xa666e2=_0x18fbf5[_0x38a489(0x180)][_0x38a489(0x1ae)];break;}return{'id':_0x18fbf5['id'],'amount':_0x18fbf5[_0x38a489(0x1b7)],'network':this[_0x38a489(0x160)](_0x18fbf5[_0x38a489(0x1ea)]),'wallet':_0xa666e2,'status':_0x18fbf5[_0x38a489(0x185)],'txid':_0x18fbf5[_0x38a489(0x17f)],'notes':_0x18fbf5['notes'],'periodFrom':_0x18fbf5[_0x38a489(0x19b)],'periodTo':_0x18fbf5[_0x38a489(0x16c)],'createdAt':_0x18fbf5[_0x38a489(0x1a3)],'paidAt':_0x18fbf5['paidAt']};}),'pagination':{'page':_0x49548b,'limit':_0x16a152,'total':_0x46de25,'totalPages':Math[_0x5a887e(0x155)](_0x46de25/_0x16a152)}};}async[a58_0x262b0f(0x1b4)](_0xea4404,_0x201f0f){const _0x10b954=a58_0x262b0f,_0xc742db=await database_1[_0x10b954(0x195)]['payout'][_0x10b954(0x1b1)]({'where':{'id':_0x201f0f,'shopId':_0xea4404}});if(!_0xc742db)return null;return{'id':_0xc742db['id'],'amount':_0xc742db[_0x10b954(0x1b7)],'network':_0xc742db[_0x10b954(0x1ea)],'status':_0xc742db[_0x10b954(0x185)],'txid':_0xc742db[_0x10b954(0x17f)],'notes':_0xc742db[_0x10b954(0x1c0)],'createdAt':_0xc742db[_0x10b954(0x1a3)],'paidAt':_0xc742db[_0x10b954(0x1f9)]};}async['getPayoutStatistics'](_0x1e162e,_0x427f6f){const _0xdac9e=a58_0x262b0f,_0x127444=new Date();let _0x154cfa,_0x573f92;switch(_0x427f6f){case'yesterday':case _0xdac9e(0x1f7):const _0x9c2756=new Date(_0x127444);_0x9c2756['setDate'](_0x9c2756[_0xdac9e(0x1c1)]()-0x1),_0x154cfa=new Date(_0x9c2756),_0x154cfa[_0xdac9e(0x168)](0x0,0x0,0x0,0x0),_0x573f92=new Date(_0x9c2756),_0x573f92['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x154cfa=new Date(_0x127444[_0xdac9e(0x200)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xdac9e(0x1b8):_0x154cfa=new Date(_0x127444[_0xdac9e(0x200)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x154cfa=new Date(_0x127444['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x154cfa=new Date(_0x127444['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x262e5a={'gte':_0x154cfa};_0x573f92&&(_0x262e5a[_0xdac9e(0x1ff)]=_0x573f92);const [_0x30b637,_0x2acedd,_0x383937,_0x10d823,_0x23bbd1,_0x275a90]=await Promise[_0xdac9e(0x1e3)]([database_1[_0xdac9e(0x195)][_0xdac9e(0x15e)][_0xdac9e(0x1c3)]({'where':{'shopId':_0x1e162e,'createdAt':_0x262e5a}}),database_1[_0xdac9e(0x195)][_0xdac9e(0x15e)][_0xdac9e(0x1c3)]({'where':{'shopId':_0x1e162e,'status':_0xdac9e(0x1d1),'createdAt':_0x262e5a}}),database_1[_0xdac9e(0x195)][_0xdac9e(0x15e)][_0xdac9e(0x1c3)]({'where':{'shopId':_0x1e162e,'status':'PENDING','createdAt':_0x262e5a}}),database_1[_0xdac9e(0x195)]['payout'][_0xdac9e(0x1c3)]({'where':{'shopId':_0x1e162e,'status':_0xdac9e(0x1f3),'createdAt':_0x262e5a}}),database_1[_0xdac9e(0x195)][_0xdac9e(0x15e)]['findMany']({'where':{'shopId':_0x1e162e,'createdAt':_0x262e5a},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0xdac9e(0x195)]['payout'][_0xdac9e(0x1ac)]({'where':{'shopId':_0x1e162e},'take':0xa,'orderBy':{'createdAt':_0xdac9e(0x188)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x14c5b6=_0x23bbd1[_0xdac9e(0x154)]((_0x4417d3,_0x46d49f)=>_0x4417d3+_0x46d49f['amount'],0x0),_0x391cf5=_0x23bbd1[_0xdac9e(0x1b3)](_0x324c28=>_0x324c28[_0xdac9e(0x185)]===_0xdac9e(0x1d1))[_0xdac9e(0x154)]((_0x53fe42,_0x320df2)=>_0x53fe42+_0x320df2[_0xdac9e(0x1b7)],0x0),_0x13cf6a=_0x23bbd1[_0xdac9e(0x1b3)](_0x29def1=>_0x29def1[_0xdac9e(0x185)]===_0xdac9e(0x1c8))[_0xdac9e(0x154)]((_0x3e7819,_0x299e75)=>_0x3e7819+_0x299e75[_0xdac9e(0x1b7)],0x0),_0x288d61=_0x23bbd1[_0xdac9e(0x154)]((_0x38f69b,_0x351cdd)=>{const _0xbb9456=_0xdac9e;return _0x38f69b[_0x351cdd[_0xbb9456(0x1ea)]]=(_0x38f69b[_0x351cdd[_0xbb9456(0x1ea)]]||0x0)+0x1,_0x38f69b;},{}),_0x560ef7=_0x23bbd1[_0xdac9e(0x154)]((_0x5a4533,_0x3fc08d)=>{const _0x16e311=_0xdac9e;return _0x5a4533[_0x3fc08d['status']]=(_0x5a4533[_0x3fc08d[_0x16e311(0x185)]]||0x0)+0x1,_0x5a4533;},{});return{'totalPayouts':_0x30b637,'completedPayouts':_0x2acedd,'pendingPayouts':_0x383937,'rejectedPayouts':_0x10d823,'totalAmount':_0x14c5b6,'completedAmount':_0x391cf5,'pendingAmount':_0x13cf6a,'payoutsByMethod':_0x288d61,'payoutsByStatus':_0x560ef7,'recentPayouts':_0x275a90['map'](_0x4b9049=>({'id':_0x4b9049['id'],'shopId':_0x1e162e,'amount':_0x4b9049[_0xdac9e(0x1b7)],'method':_0x4b9049['network'],'status':_0x4b9049[_0xdac9e(0x185)],'txid':_0x4b9049[_0xdac9e(0x17f)],'createdAt':_0x4b9049[_0xdac9e(0x1a3)],'paidAt':_0x4b9049[_0xdac9e(0x1f9)]}))};}async[a58_0x262b0f(0x1ec)](_0x20e4ca){const _0x48c27b=a58_0x262b0f;console[_0x48c27b(0x1a1)](_0x48c27b(0x1fc)+_0x20e4ca+_0x48c27b(0x198));const _0x479976=await database_1['default'][_0x48c27b(0x180)][_0x48c27b(0x1fd)]({'where':{'id':_0x20e4ca},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x479976)throw new Error(_0x48c27b(0x167));const _0x42bdc5=new Date(),_0x45c809=new Date(_0x42bdc5['getFullYear'](),_0x42bdc5[_0x48c27b(0x1b5)](),0x1),_0x57538c=new Date(_0x42bdc5[_0x48c27b(0x17a)](),_0x42bdc5[_0x48c27b(0x1b5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x154bf8=await database_1[_0x48c27b(0x195)][_0x48c27b(0x15e)][_0x48c27b(0x18f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x20e4ca,'createdAt':{'gte':_0x45c809,'lte':_0x57538c},'status':_0x48c27b(0x1d1)}}),_0x226b95=_0x154bf8[_0x48c27b(0x1a7)][_0x48c27b(0x1b7)]||0x0,_0x4710d3={'availableBalance':Math[_0x48c27b(0x1de)](_0x479976[_0x48c27b(0x201)]*0x64)/0x64,'totalPaidOut':Math[_0x48c27b(0x1de)](_0x479976['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x48c27b(0x1de)](_0x479976[_0x48c27b(0x201)]*0x64)/0x64,'thisMonth':Math[_0x48c27b(0x1de)](_0x226b95*0x64)/0x64};return console['log']('üìä\x20Shop\x20'+_0x479976[_0x48c27b(0x1dd)]+'\x20payout\x20statistics\x20calculated:'),console[_0x48c27b(0x1a1)](_0x48c27b(0x1da)+_0x4710d3[_0x48c27b(0x1ee)]+_0x48c27b(0x173)),console[_0x48c27b(0x1a1)](_0x48c27b(0x16b)+_0x4710d3[_0x48c27b(0x1e5)]+_0x48c27b(0x17e)),console[_0x48c27b(0x1a1)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x4710d3[_0x48c27b(0x150)]+_0x48c27b(0x173)),console[_0x48c27b(0x1a1)](_0x48c27b(0x1d8)+_0x4710d3['thisMonth']+'\x20USDT'),_0x4710d3;}[a58_0x262b0f(0x1b0)](_0x65f2a1){const _0x14d2f8=a58_0x262b0f,_0x2b2f19={'test_gateway':_0x14d2f8(0x1f6),'plisio':_0x14d2f8(0x1eb),'rapyd':_0x14d2f8(0x1a2),'noda':'Noda','cointopay':'CoinToPay','klyme_eu':_0x14d2f8(0x158),'klyme_gb':'KLYME\x20GB','klyme_de':_0x14d2f8(0x1aa)};return _0x2b2f19[_0x65f2a1]||_0x65f2a1;}async['getPayoutStats'](_0x30b02d){const _0x49b973=a58_0x262b0f;return this[_0x49b973(0x1ec)](_0x30b02d);}async[a58_0x262b0f(0x19f)](_0x4048dd,_0x2be279){const _0x17aece=a58_0x262b0f,{page:_0x49a191,limit:_0x4ee289,paymentId:_0x83ec7e}=_0x2be279,_0x2df11d=(_0x49a191-0x1)*_0x4ee289,_0x5d32b5={'shopId':_0x4048dd};_0x83ec7e&&(_0x5d32b5['paymentId']=_0x83ec7e);const [_0x5221b4,_0x10feb8]=await Promise[_0x17aece(0x1e3)]([database_1[_0x17aece(0x195)][_0x17aece(0x163)][_0x17aece(0x1ac)]({'where':_0x5d32b5,'skip':_0x2df11d,'take':_0x4ee289,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x17aece(0x195)][_0x17aece(0x163)][_0x17aece(0x1c3)]({'where':_0x5d32b5})]);return{'logs':_0x5221b4[_0x17aece(0x19d)](_0x499c14=>({'id':_0x499c14['id'],'paymentId':_0x499c14['paymentId'],'shopId':_0x499c14['shopId'],'event':_0x499c14['event'],'statusCode':_0x499c14['statusCode'],'retryCount':_0x499c14[_0x17aece(0x1cf)],'responseBody':_0x499c14[_0x17aece(0x177)],'createdAt':_0x499c14[_0x17aece(0x1a3)],'payment':_0x499c14[_0x17aece(0x1c7)]})),'pagination':{'page':_0x49a191,'limit':_0x4ee289,'total':_0x10feb8,'totalPages':Math[_0x17aece(0x155)](_0x10feb8/_0x4ee289)}};}async[a58_0x262b0f(0x1d6)](_0x3c44c0,_0x884ab3){const _0xdc8476=a58_0x262b0f,_0x4e4210=new Date();let _0x4b0f70,_0x2a9250;switch(_0x884ab3[_0xdc8476(0x1c5)]()){case _0xdc8476(0x1e0):_0x4b0f70=new Date(_0x4e4210[_0xdc8476(0x17a)](),_0x4e4210[_0xdc8476(0x1b5)](),_0x4e4210[_0xdc8476(0x1c1)](),0x0,0x0,0x0,0x0);break;case _0xdc8476(0x151):case'YESTERDAY':const _0x4ca0a2=new Date(_0x4e4210);_0x4ca0a2[_0xdc8476(0x1d2)](_0x4ca0a2[_0xdc8476(0x1c1)]()-0x1),_0x4b0f70=new Date(_0x4ca0a2),_0x4b0f70['setHours'](0x0,0x0,0x0,0x0),_0x2a9250=new Date(_0x4ca0a2),_0x2a9250['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x4b0f70=new Date(_0x4e4210['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4b0f70=new Date(_0x4e4210[_0xdc8476(0x200)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xdc8476(0x1df):_0x4b0f70=new Date(_0x4e4210[_0xdc8476(0x200)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4b0f70=new Date(_0x4e4210[_0xdc8476(0x200)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x337958={'gte':_0x4b0f70};_0x2a9250&&(_0x337958[_0xdc8476(0x1ff)]=_0x2a9250);const [_0x543ccf,_0xf3c6d9,_0x45a553,_0x42408b,_0x2a8ee9]=await Promise[_0xdc8476(0x1e3)]([database_1['default']['payment'][_0xdc8476(0x1c3)]({'where':{'shopId':_0x3c44c0,'gateway':{'not':'test_gateway'},'createdAt':_0x337958}}),database_1['default']['payment']['count']({'where':{'shopId':_0x3c44c0,'gateway':{'not':_0xdc8476(0x1d4)},'status':_0xdc8476(0x17b),'createdAt':_0x337958}}),database_1[_0xdc8476(0x195)][_0xdc8476(0x1c7)][_0xdc8476(0x1ac)]({'where':{'shopId':_0x3c44c0,'gateway':{'not':_0xdc8476(0x1d4)},'status':_0xdc8476(0x17b),'createdAt':_0x337958},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0xdc8476(0x195)][_0xdc8476(0x1c7)][_0xdc8476(0x1ac)]({'where':{'shopId':_0x3c44c0,'gateway':{'not':_0xdc8476(0x1d4)}},'take':0xa,'orderBy':{'createdAt':_0xdc8476(0x188)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0xdc8476(0x195)][_0xdc8476(0x1c7)]['findMany']({'where':{'shopId':_0x3c44c0,'gateway':{'not':'test_gateway'},'createdAt':_0x337958},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0xdc8476(0x1ed)}})]);let _0x1cd446=0x0;for(const _0x4967b1 of _0x45a553){if(_0x4967b1[_0xdc8476(0x1b6)])_0x1cd446+=_0x4967b1[_0xdc8476(0x1b6)];else{const _0x175b7f=await currencyService_1[_0xdc8476(0x17c)]['convertToUSDT'](_0x4967b1[_0xdc8476(0x1b7)],_0x4967b1[_0xdc8476(0x1d0)]);_0x1cd446+=_0x175b7f;}}const _0x315d91=this[_0xdc8476(0x1db)](_0x2a8ee9,_0x4b0f70,_0x2a9250||_0x4e4210),_0x5544e2=_0x543ccf>0x0?_0xf3c6d9/_0x543ccf*0x64:0x0;return{'totalPayments':_0x543ccf,'successfulPayments':_0xf3c6d9,'totalRevenue':Math['round'](_0x1cd446*0x64)/0x64,'conversionRate':Math[_0xdc8476(0x1de)](_0x5544e2*0x64)/0x64,'dailyRevenue':_0x315d91['dailyRevenue'],'dailyPayments':_0x315d91[_0xdc8476(0x1b9)],'recentPayments':_0x42408b[_0xdc8476(0x19d)](_0x3b93c7=>({'id':_0x3b93c7['id'],'gateway':_0x3b93c7[_0xdc8476(0x1e9)],'amount':_0x3b93c7['amount'],'currency':_0x3b93c7[_0xdc8476(0x1d0)],'status':_0x3b93c7[_0xdc8476(0x185)],'createdAt':_0x3b93c7[_0xdc8476(0x1a3)]}))};}[a58_0x262b0f(0x1db)](_0x4a2db3,_0x3645c7,_0x575aa3){const _0x3671d5=a58_0x262b0f,_0xc6e9cb=new Map(),_0x399015=new Date(_0x3645c7);while(_0x399015<=_0x575aa3){const _0x7ba85c=_0x399015['toISOString']()[_0x3671d5(0x166)]('T')[0x0];_0xc6e9cb[_0x3671d5(0x186)](_0x7ba85c,{'revenue':0x0,'count':0x0}),_0x399015['setDate'](_0x399015[_0x3671d5(0x1c1)]()+0x1);}for(const _0x3c2cac of _0x4a2db3){const _0x2c4e29=_0x3c2cac[_0x3671d5(0x1a3)][_0x3671d5(0x1bc)]()[_0x3671d5(0x166)]('T')[0x0],_0xe1a10a=_0xc6e9cb[_0x3671d5(0x1d5)](_0x2c4e29);_0xe1a10a&&(_0xe1a10a['count']+=0x1,_0x3c2cac[_0x3671d5(0x185)]==='PAID'&&_0x3c2cac[_0x3671d5(0x1b6)]&&(_0xe1a10a[_0x3671d5(0x15a)]+=_0x3c2cac[_0x3671d5(0x1b6)]));}const _0x4254a8=[],_0x282df7=[];for(const [_0x4ee165,_0x35eaa7]of _0xc6e9cb){_0x4254a8['push']({'date':_0x4ee165,'amount':Math[_0x3671d5(0x1de)](_0x35eaa7[_0x3671d5(0x15a)]*0x64)/0x64}),_0x282df7[_0x3671d5(0x190)]({'date':_0x4ee165,'count':_0x35eaa7[_0x3671d5(0x1c3)]});}return{'dailyRevenue':_0x4254a8,'dailyPayments':_0x282df7};}}exports[a58_0x262b0f(0x16e)]=ShopService;