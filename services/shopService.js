'use strict';const a86_0x3e1333=a86_0x5300;(function(_0x161401,_0x554d24){const _0x5bd191=a86_0x5300,_0x44a2fc=_0x161401();while(!![]){try{const _0x1da947=parseInt(_0x5bd191(0x254))/0x1+parseInt(_0x5bd191(0x2c0))/0x2*(parseInt(_0x5bd191(0x27c))/0x3)+parseInt(_0x5bd191(0x241))/0x4*(parseInt(_0x5bd191(0x1d9))/0x5)+parseInt(_0x5bd191(0x28a))/0x6*(-parseInt(_0x5bd191(0x285))/0x7)+parseInt(_0x5bd191(0x1f1))/0x8+parseInt(_0x5bd191(0x1f9))/0x9+-parseInt(_0x5bd191(0x1ff))/0xa;if(_0x1da947===_0x554d24)break;else _0x44a2fc['push'](_0x44a2fc['shift']());}catch(_0x1e0d8a){_0x44a2fc['push'](_0x44a2fc['shift']());}}}(a86_0x5463,0x449cb));function a86_0x5300(_0x4baeea,_0x4691a1){_0x4baeea=_0x4baeea-0x1cd;const _0x546379=a86_0x5463();let _0x53006e=_0x546379[_0x4baeea];return _0x53006e;}function a86_0x5463(){const _0x578922=['push','Test\x20Gateway','webhookEvents','CHARGEBACK','paymentGateways','amount','includes','ðŸ“…\x20Period\x20start:\x20',',\x20period:\x20','findFirst','__esModule','\x20payout\x20statistics\x20calculated:','reduce','customer','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','90d','REFUND','stringify','setUTCDate','PAID','disable2FA','Plisio','paymentId','totalPaidOut','telegram','getTime','No\x20webhook\x20URL\x20configured','split','hash','COMPLETED','ðŸ“Š\x20Shop\x20','getMonth','formatNetworkName','./paymentService','shop','setDate','getUTCDay','map','Noda','\x20backup\x20codes','awaitingPayout','responseBody','AVAILABLE_GATEWAYS','ðŸ“Š\x20Payments\x20by\x20gateway\x20(all\x20time):','lte',',\x20dateFrom:\x20','generateSecret','552364nicNxo','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','customerEmail','getPaymentById','EXPIRED','Shop\x20not\x20found','Payment\x20not\x20found','\x20to\x20','Webhook\x20returned\x20error:\x20','ShopService','name','USDT\x20TRC20','ðŸŒ\x20Method\x20filter:\x20','isArray','findMany','publicKey','this_month','fullName','update','89912GttSdt','shopUrl','ðŸ“…\x20Date\x20start:\x20','Rapyd','last_week','ðŸ“…\x20Final\x20date\x20range:\x20','log','Invalid\x202FA\x20token','filter','toString','settings','toISOString','payment','application/json','ceil','periodTo','...','country','test','bcryptjs','yesterday','statusCode','error','compare','qrcode','getPayoutById','erc20','speakeasy','\x20USDT','hex','usdcErcWallet','gateways','username','polygon','parse','YESTERDAY','sha256','2FA\x20is\x20already\x20enabled','getShopPayoutStats','twoFactorToken','21gnNifr','getPayoutStatistics','status','usage','thisMonth','webhookLog','USDT\x20ERC20','last_month','ðŸ“…\x20Custom\x20date\x20range:\x20','118895fTtEJI','setup2FA','updateWallets','merchantUrl','paidAt','114driRKl','secretKey','enable2FA','PaymentService','getGatewayDisplayName','USDC\x20Polygon','splice','network','createPayment','retryCount','getPayments','getPayoutStats','../types/gateway','paymentService','updatePayment','set','base32','notes','REJECTED','setHours','backupCodes','desc','usdtErcWallet','currency','Unknown\x20error','30d','polygon_usdc','isActive','otpauth_url','gatewaySettings','\x20USDT\x20(total\x20payouts)','amountUSDT','PENDING','\x20\x20\x20ðŸ’°\x20Total\x20paid\x20out:\x20','balance','this_week','maxPayments','toDataURL','generateBackupCodes','erc20_usdc','sourceCurrency','amountAfterGatewayCommissionUSDT','ðŸ“Š\x20Status\x20filter:\x20','\x20USDT\x20(current\x20balance)','UTC','language','convertToUSDT','../config/database','createHmac','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','TrapaPay\x20(','digest','length','2FA\x20token\x20is\x20required','148942RAMWWL','wallets','toUpperCase','Test\x20webhook\x20sent\x20successfully\x20(','ðŸ“…\x20Date\x20end:\x20','txid','ðŸ“Š\x20Getting\x20statistics\x20for\x20shop\x20','availableBalance','getPaymentsByShop','updateShopProfile','count','getUTCFullYear','getUTCMonth','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','redirectUrl','customerName','5xMfspX','gte','Invalid\x202FA\x20token\x20or\x20backup\x20code','all','Error\x20parsing\x20webhook\x20events:','KLYME\x20DE','KLYME\x20EU','getDate','__importDefault','toLowerCase','createdAt','twoFactorEnabled','usdcPolygonWallet','telegramId','getFullYear','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','ðŸ”‘\x20Generated\x20','twoFactorSecret','getUTCDate','periodFrom','dailyRevenue','KLYME\x20GB','payout','webhookUrl','1132744VSESlU','getPayouts','dailyPayments','usdtPolygonWallet','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','ðŸ“Š\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','deletePayment','test_order_123','1273779jyRllP','TrapaPay','round','default','gateway','all_time','4286740bMSGAk','aggregate','CoinToPay','message','getWebhookLogs','custom_','delete','USD','event','./currencyService','replace','Payment\x20System/1.0\x20(Test)','usdtTrcWallet','generateDailyStatistics','ðŸ“Š\x20Final\x20WHERE\x20conditions:','defineProperty','test_gateway','findUnique','currencyService'];a86_0x5463=function(){return _0x578922;};return a86_0x5463();}var __importDefault=this&&this[a86_0x3e1333(0x1e1)]||function(_0xf5f934){const _0x3816a0=a86_0x3e1333;return _0xf5f934&&_0xf5f934[_0x3816a0(0x21c)]?_0xf5f934:{'default':_0xf5f934};};Object[a86_0x3e1333(0x20e)](exports,a86_0x3e1333(0x21c),{'value':!![]}),exports[a86_0x3e1333(0x24a)]=void 0x0;const database_1=__importDefault(require(a86_0x3e1333(0x2b9))),bcryptjs_1=__importDefault(require(a86_0x3e1333(0x267))),crypto_1=__importDefault(require('crypto')),speakeasy_1=__importDefault(require(a86_0x3e1333(0x26f))),qrcode_1=__importDefault(require(a86_0x3e1333(0x26c))),currencyService_1=require(a86_0x3e1333(0x208)),paymentService_1=require(a86_0x3e1333(0x233)),gateway_1=require(a86_0x3e1333(0x296));class ShopService{constructor(){const _0x5a74a4=a86_0x3e1333;this['paymentService']=new paymentService_1[(_0x5a74a4(0x28d))]();}async['getShopProfile'](_0x4a813e){const _0x2aa8c7=a86_0x3e1333,_0x28ec36=await database_1[_0x2aa8c7(0x1fc)][_0x2aa8c7(0x234)][_0x2aa8c7(0x210)]({'where':{'id':_0x4a813e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x28ec36)throw new Error(_0x2aa8c7(0x246));let _0x59f7f6=[];if(_0x28ec36['settings']?.[_0x2aa8c7(0x214)])try{_0x59f7f6=Array[_0x2aa8c7(0x24e)](_0x28ec36['settings'][_0x2aa8c7(0x214)])?_0x28ec36[_0x2aa8c7(0x25e)][_0x2aa8c7(0x214)]:JSON[_0x2aa8c7(0x276)](_0x28ec36['settings'][_0x2aa8c7(0x214)]);}catch(_0x82eb9f){console[_0x2aa8c7(0x26a)](_0x2aa8c7(0x1dd),_0x82eb9f),_0x59f7f6=[];}const _0x18a262=gateway_1[_0x2aa8c7(0x23c)][_0x2aa8c7(0x25c)](_0x87176b=>_0x87176b[_0x2aa8c7(0x2a5)])['map'](_0x5f097b=>_0x5f097b[_0x2aa8c7(0x24b)]);let _0x535675=_0x28ec36[_0x2aa8c7(0x216)]?JSON[_0x2aa8c7(0x276)](_0x28ec36['paymentGateways']):[];return Array[_0x2aa8c7(0x24e)](_0x535675)&&(_0x535675=_0x535675[_0x2aa8c7(0x237)](_0x36353f=>_0x36353f['replace'](/\s+/g,'_')[_0x2aa8c7(0x1e2)]())[_0x2aa8c7(0x25c)](_0x233394=>_0x18a262[_0x2aa8c7(0x218)](_0x233394))),{'id':_0x28ec36['id'],'fullName':_0x28ec36[_0x2aa8c7(0x24b)],'username':_0x28ec36[_0x2aa8c7(0x274)],'telegramId':_0x28ec36['telegram'],'merchantUrl':_0x28ec36[_0x2aa8c7(0x255)],'gateways':_0x535675,'gatewaySettings':_0x28ec36[_0x2aa8c7(0x2a7)]?JSON[_0x2aa8c7(0x276)](_0x28ec36[_0x2aa8c7(0x2a7)]):null,'publicKey':_0x28ec36[_0x2aa8c7(0x250)],'secretKey':_0x28ec36[_0x2aa8c7(0x28b)],'webhookUrl':_0x28ec36[_0x2aa8c7(0x25e)]?.[_0x2aa8c7(0x1f0)]||null,'webhookEvents':_0x59f7f6,'wallets':{'usdtPolygonWallet':_0x28ec36[_0x2aa8c7(0x1f4)],'usdtTrcWallet':_0x28ec36[_0x2aa8c7(0x20b)],'usdtErcWallet':_0x28ec36['usdtErcWallet'],'usdcPolygonWallet':_0x28ec36[_0x2aa8c7(0x1e5)],'usdcErcWallet':_0x28ec36[_0x2aa8c7(0x272)]},'status':_0x28ec36['status'],'createdAt':_0x28ec36['createdAt']};}async[a86_0x3e1333(0x1d2)](_0x528ee2,_0x3e62a6){const _0x573984=a86_0x3e1333,_0x209779={};_0x3e62a6[_0x573984(0x252)]&&(_0x209779[_0x573984(0x24b)]=_0x3e62a6[_0x573984(0x252)]);_0x3e62a6[_0x573984(0x1e6)]!==undefined&&(_0x209779[_0x573984(0x22a)]=_0x3e62a6[_0x573984(0x1e6)]||null);_0x3e62a6[_0x573984(0x288)]&&(_0x209779[_0x573984(0x255)]=_0x3e62a6[_0x573984(0x288)]);_0x3e62a6['gateways']&&(_0x209779[_0x573984(0x216)]=JSON[_0x573984(0x223)](_0x3e62a6[_0x573984(0x273)]));_0x3e62a6[_0x573984(0x2a7)]&&(_0x209779[_0x573984(0x2a7)]=JSON[_0x573984(0x223)](_0x3e62a6[_0x573984(0x2a7)]));_0x3e62a6['wallets']&&(_0x3e62a6['wallets'][_0x573984(0x1f4)]!==undefined&&(_0x209779[_0x573984(0x1f4)]=_0x3e62a6[_0x573984(0x2c1)]['usdtPolygonWallet']||null),_0x3e62a6['wallets']['usdtTrcWallet']!==undefined&&(_0x209779[_0x573984(0x20b)]=_0x3e62a6[_0x573984(0x2c1)]['usdtTrcWallet']||null),_0x3e62a6['wallets'][_0x573984(0x2a0)]!==undefined&&(_0x209779[_0x573984(0x2a0)]=_0x3e62a6['wallets'][_0x573984(0x2a0)]||null),_0x3e62a6['wallets']['usdcPolygonWallet']!==undefined&&(_0x209779[_0x573984(0x1e5)]=_0x3e62a6[_0x573984(0x2c1)][_0x573984(0x1e5)]||null));const _0x26b4b6=await database_1[_0x573984(0x1fc)][_0x573984(0x234)][_0x573984(0x253)]({'where':{'id':_0x528ee2},'data':_0x209779,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x792ee=[];if(_0x26b4b6[_0x573984(0x25e)]?.[_0x573984(0x214)])try{_0x792ee=Array[_0x573984(0x24e)](_0x26b4b6[_0x573984(0x25e)][_0x573984(0x214)])?_0x26b4b6[_0x573984(0x25e)][_0x573984(0x214)]:JSON[_0x573984(0x276)](_0x26b4b6[_0x573984(0x25e)][_0x573984(0x214)]);}catch(_0x2b02ec){console[_0x573984(0x26a)](_0x573984(0x1dd),_0x2b02ec),_0x792ee=[];}return{'id':_0x26b4b6['id'],'fullName':_0x26b4b6[_0x573984(0x24b)],'username':_0x26b4b6[_0x573984(0x274)],'telegramId':_0x26b4b6['telegram'],'merchantUrl':_0x26b4b6[_0x573984(0x255)],'gateways':_0x26b4b6[_0x573984(0x216)]?JSON[_0x573984(0x276)](_0x26b4b6[_0x573984(0x216)]):null,'gatewaySettings':_0x26b4b6[_0x573984(0x2a7)]?JSON[_0x573984(0x276)](_0x26b4b6[_0x573984(0x2a7)]):null,'publicKey':_0x26b4b6[_0x573984(0x250)],'secretKey':_0x26b4b6['secretKey'],'webhookUrl':_0x26b4b6[_0x573984(0x25e)]?.[_0x573984(0x1f0)]||null,'webhookEvents':_0x792ee,'wallets':{'usdtPolygonWallet':_0x26b4b6[_0x573984(0x1f4)],'usdtTrcWallet':_0x26b4b6[_0x573984(0x20b)],'usdtErcWallet':_0x26b4b6[_0x573984(0x2a0)],'usdcPolygonWallet':_0x26b4b6['usdcPolygonWallet'],'usdcErcWallet':_0x26b4b6['usdcErcWallet']},'status':_0x26b4b6['status'],'createdAt':_0x26b4b6[_0x573984(0x1e3)]};}async[a86_0x3e1333(0x287)](_0x3a08a6,_0xd0348e){const _0x87bb2b=a86_0x3e1333,_0x3b732a=await database_1[_0x87bb2b(0x1fc)][_0x87bb2b(0x234)][_0x87bb2b(0x210)]({'where':{'id':_0x3a08a6},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x3b732a)throw new Error(_0x87bb2b(0x246));if(_0x3b732a[_0x87bb2b(0x1e4)]){if(!_0xd0348e[_0x87bb2b(0x27b)])throw new Error(_0x87bb2b(0x2bf));const _0x4511fc=speakeasy_1[_0x87bb2b(0x1fc)]['totp']['verify']({'secret':_0x3b732a[_0x87bb2b(0x1ea)],'encoding':_0x87bb2b(0x29a),'token':_0xd0348e['twoFactorToken'],'window':0x2});if(!_0x4511fc){let _0x38d740=![];if(_0x3b732a[_0x87bb2b(0x29e)]){const _0x548304=JSON[_0x87bb2b(0x276)](_0x3b732a[_0x87bb2b(0x29e)]);for(let _0x284115=0x0;_0x284115<_0x548304[_0x87bb2b(0x2be)];_0x284115++){const _0xffc2ee=await bcryptjs_1[_0x87bb2b(0x1fc)][_0x87bb2b(0x26b)](_0xd0348e[_0x87bb2b(0x27b)],_0x548304[_0x284115]);if(_0xffc2ee){_0x38d740=!![],_0x548304[_0x87bb2b(0x290)](_0x284115,0x1),await database_1[_0x87bb2b(0x1fc)][_0x87bb2b(0x234)][_0x87bb2b(0x253)]({'where':{'id':_0x3a08a6},'data':{'backupCodes':JSON[_0x87bb2b(0x223)](_0x548304)}});break;}}}if(!_0x38d740)throw new Error(_0x87bb2b(0x1db));}}const _0x4e0b29={};_0xd0348e[_0x87bb2b(0x1f4)]!==undefined&&(_0x4e0b29[_0x87bb2b(0x1f4)]=_0xd0348e['usdtPolygonWallet']||null),_0xd0348e[_0x87bb2b(0x20b)]!==undefined&&(_0x4e0b29[_0x87bb2b(0x20b)]=_0xd0348e[_0x87bb2b(0x20b)]||null),_0xd0348e[_0x87bb2b(0x2a0)]!==undefined&&(_0x4e0b29['usdtErcWallet']=_0xd0348e[_0x87bb2b(0x2a0)]||null),_0xd0348e[_0x87bb2b(0x1e5)]!==undefined&&(_0x4e0b29[_0x87bb2b(0x1e5)]=_0xd0348e['usdcPolygonWallet']||null),_0xd0348e['usdcErcWallet']!==undefined&&(_0x4e0b29[_0x87bb2b(0x272)]=_0xd0348e[_0x87bb2b(0x272)]||null),await database_1['default'][_0x87bb2b(0x234)][_0x87bb2b(0x253)]({'where':{'id':_0x3a08a6},'data':_0x4e0b29});}async['testWebhook'](_0x1c5a79){const _0x27023c=a86_0x3e1333,_0x16ea0a=await database_1[_0x27023c(0x1fc)][_0x27023c(0x234)][_0x27023c(0x210)]({'where':{'id':_0x1c5a79},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x16ea0a?.[_0x27023c(0x25e)]?.[_0x27023c(0x1f0)])throw new Error(_0x27023c(0x22c));const _0x8bd825={'event':_0x27023c(0x266),'payment':{'id':'test_payment_123','order_id':_0x27023c(0x1f8),'gateway':_0x27023c(0x266),'amount':0x64,'currency':_0x27023c(0x206),'status':'paid','created_at':new Date()['toISOString']()}};try{const _0x2ca24b=JSON['stringify'](_0x8bd825),_0x4e9441=crypto_1['default'][_0x27023c(0x2ba)](_0x27023c(0x278),_0x16ea0a[_0x27023c(0x28b)])['update'](_0x2ca24b)[_0x27023c(0x2bd)](_0x27023c(0x271)),_0x14e5d8=await fetch(_0x16ea0a[_0x27023c(0x25e)][_0x27023c(0x1f0)],{'method':'POST','headers':{'Content-Type':_0x27023c(0x261),'User-Agent':_0x27023c(0x20a),'X-Webhook-Signature':_0x4e9441},'body':_0x2ca24b});return _0x14e5d8['ok']?{'success':!![],'message':_0x27023c(0x2c3)+_0x14e5d8[_0x27023c(0x27e)]+')'}:{'success':![],'message':_0x27023c(0x249)+_0x14e5d8[_0x27023c(0x27e)]+'\x20'+_0x14e5d8['statusText']};}catch(_0x25923f){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x25923f instanceof Error?_0x25923f[_0x27023c(0x202)]:_0x27023c(0x2a2))};}}async[a86_0x3e1333(0x292)](_0x595247){const _0x35519d=a86_0x3e1333;return this[_0x35519d(0x297)]['createPublicPayment']({'public_key':'','gateway':_0x595247[_0x35519d(0x1fd)],'order_id':undefined,'amount':_0x595247[_0x35519d(0x217)],'currency':_0x595247[_0x35519d(0x2a1)],'source_currency':_0x595247[_0x35519d(0x2b2)],'usage':_0x595247[_0x35519d(0x27f)],'expires_at':_0x595247['expiresAt']?.[_0x35519d(0x25f)](),'success_url':_0x595247[_0x35519d(0x1d7)],'fail_url':_0x595247[_0x35519d(0x1d7)],'customer_email':_0x595247[_0x35519d(0x243)],'customer_name':_0x595247[_0x35519d(0x1d8)],'country':_0x595247[_0x35519d(0x265)],'language':_0x595247[_0x35519d(0x2b7)],'amount_is_editable':_0x595247['amountIsEditable'],'max_payments':_0x595247[_0x35519d(0x2ae)],'customer':_0x595247[_0x35519d(0x21f)]});}async[a86_0x3e1333(0x294)](_0x58f382,_0x11c360){const _0x4cadef=a86_0x3e1333;return this[_0x4cadef(0x297)][_0x4cadef(0x1d1)](_0x58f382,_0x11c360);}async[a86_0x3e1333(0x244)](_0x560aad,_0x21e943){const _0x570631=a86_0x3e1333;return this[_0x570631(0x297)]['getPaymentByShopAndId'](_0x560aad,_0x21e943);}async[a86_0x3e1333(0x298)](_0x680309,_0x22845b,_0x20e23d){const _0x8531a4=a86_0x3e1333,_0x13a408=await database_1[_0x8531a4(0x1fc)]['payment'][_0x8531a4(0x21b)]({'where':{'id':_0x22845b,'shopId':_0x680309}});if(!_0x13a408)throw new Error(_0x8531a4(0x247));const _0x29980f=await database_1[_0x8531a4(0x1fc)][_0x8531a4(0x260)][_0x8531a4(0x253)]({'where':{'id':_0x22845b},'data':{..._0x20e23d,'updatedAt':new Date()}});return _0x29980f;}async[a86_0x3e1333(0x1f7)](_0x1952e9,_0x2a845c){const _0x517652=a86_0x3e1333,_0x24a61f=await database_1[_0x517652(0x1fc)][_0x517652(0x260)][_0x517652(0x21b)]({'where':{'id':_0x2a845c,'shopId':_0x1952e9}});if(!_0x24a61f)throw new Error(_0x517652(0x247));await database_1[_0x517652(0x1fc)]['payment'][_0x517652(0x205)]({'where':{'id':_0x2a845c}});}[a86_0x3e1333(0x232)](_0x59780f){const _0x31457c=a86_0x3e1333,_0x357e2d={'polygon':'USDT\x20Polygon','trc20':_0x31457c(0x24c),'erc20':_0x31457c(0x282),'bsc':'USDT\x20BSC','polygon_usdc':_0x31457c(0x28f),'erc20_usdc':'USDC\x20Ethereum'};return _0x357e2d[_0x59780f]||_0x59780f;}async[a86_0x3e1333(0x1f2)](_0x336294,_0x56006d){const _0x23c015=a86_0x3e1333,{page:_0x38fbaf,limit:_0x4215c8,status:_0x1c5a5e,method:_0x3100cf,network:_0x38ea2a,dateFrom:_0xc68c53,dateTo:_0x216d4b,periodFrom:_0x2be875,periodTo:_0x41996a}=_0x56006d,_0x48918f=(_0x38fbaf-0x1)*_0x4215c8;console[_0x23c015(0x25a)]('ðŸ’°\x20Getting\x20payouts\x20with\x20filters:',_0x56006d);const _0x223e44={'shopId':_0x336294};_0x1c5a5e&&(_0x223e44[_0x23c015(0x27e)]=_0x1c5a5e[_0x23c015(0x2c2)](),console['log'](_0x23c015(0x2b4)+_0x1c5a5e[_0x23c015(0x2c2)]()));if(_0x3100cf)_0x223e44[_0x23c015(0x291)]=_0x3100cf,console['log'](_0x23c015(0x24d)+_0x3100cf);else _0x38ea2a&&(_0x223e44[_0x23c015(0x291)]=_0x38ea2a,console['log']('ðŸŒ\x20Network\x20filter:\x20'+_0x38ea2a));if(_0xc68c53||_0x216d4b||_0x2be875||_0x41996a){_0x223e44[_0x23c015(0x1e3)]={};if(_0x2be875){const _0x3dc22a=new Date(_0x2be875);_0x3dc22a[_0x23c015(0x29d)](0x0,0x0,0x0,0x1),_0x223e44[_0x23c015(0x1e3)]['gte']=_0x3dc22a,console[_0x23c015(0x25a)](_0x23c015(0x219)+_0x3dc22a[_0x23c015(0x25f)]());}else{if(_0xc68c53){const _0x556f2e=new Date(_0xc68c53);_0x556f2e[_0x23c015(0x29d)](0x0,0x0,0x0,0x1),_0x223e44['createdAt'][_0x23c015(0x1da)]=_0x556f2e,console[_0x23c015(0x25a)](_0x23c015(0x256)+_0x556f2e[_0x23c015(0x25f)]());}}if(_0x41996a){const _0x1e67af=new Date(_0x41996a);_0x1e67af[_0x23c015(0x29d)](0x17,0x3b,0x3b,0x3e7),_0x223e44[_0x23c015(0x1e3)][_0x23c015(0x23e)]=_0x1e67af,console['log']('ðŸ“…\x20Period\x20end:\x20'+_0x1e67af[_0x23c015(0x25f)]());}else{if(_0x216d4b){const _0x379ddc=new Date(_0x216d4b);_0x379ddc[_0x23c015(0x29d)](0x17,0x3b,0x3b,0x3e7),_0x223e44[_0x23c015(0x1e3)]['lte']=_0x379ddc,console[_0x23c015(0x25a)](_0x23c015(0x1cd)+_0x379ddc[_0x23c015(0x25f)]());}}}console[_0x23c015(0x25a)](_0x23c015(0x20d),JSON[_0x23c015(0x223)](_0x223e44,null,0x2));const [_0x1cd693,_0x2eb0ab]=await Promise[_0x23c015(0x1dc)]([database_1['default'][_0x23c015(0x1ef)][_0x23c015(0x24f)]({'where':_0x223e44,'skip':_0x48918f,'take':_0x4215c8,'orderBy':{'createdAt':_0x23c015(0x29f)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x23c015(0x1fc)]['payout'][_0x23c015(0x1d3)]({'where':_0x223e44})]);return{'payouts':_0x1cd693[_0x23c015(0x237)](_0x1a82ba=>{const _0x2e3ecd=_0x23c015;let _0x468be6=null;switch(_0x1a82ba['network']){case _0x2e3ecd(0x275):_0x468be6=_0x1a82ba[_0x2e3ecd(0x234)][_0x2e3ecd(0x1f4)];break;case'trc20':_0x468be6=_0x1a82ba[_0x2e3ecd(0x234)][_0x2e3ecd(0x20b)];break;case _0x2e3ecd(0x26e):_0x468be6=_0x1a82ba[_0x2e3ecd(0x234)][_0x2e3ecd(0x2a0)];break;case _0x2e3ecd(0x2a4):_0x468be6=_0x1a82ba[_0x2e3ecd(0x234)][_0x2e3ecd(0x1e5)];break;case _0x2e3ecd(0x2b1):_0x468be6=_0x1a82ba[_0x2e3ecd(0x234)][_0x2e3ecd(0x272)];break;}return{'id':_0x1a82ba['id'],'amount':_0x1a82ba[_0x2e3ecd(0x217)],'network':this[_0x2e3ecd(0x232)](_0x1a82ba[_0x2e3ecd(0x291)]),'wallet':_0x468be6,'status':_0x1a82ba['status'],'txid':_0x1a82ba[_0x2e3ecd(0x1ce)],'notes':_0x1a82ba[_0x2e3ecd(0x29b)],'periodFrom':_0x1a82ba[_0x2e3ecd(0x1ec)],'periodTo':_0x1a82ba[_0x2e3ecd(0x263)],'createdAt':_0x1a82ba[_0x2e3ecd(0x1e3)],'paidAt':_0x1a82ba['paidAt']};}),'pagination':{'page':_0x38fbaf,'limit':_0x4215c8,'total':_0x2eb0ab,'totalPages':Math[_0x23c015(0x262)](_0x2eb0ab/_0x4215c8)}};}async[a86_0x3e1333(0x26d)](_0x553809,_0x163b2b){const _0x2afe71=a86_0x3e1333,_0x1c1991=await database_1['default'][_0x2afe71(0x1ef)][_0x2afe71(0x21b)]({'where':{'id':_0x163b2b,'shopId':_0x553809}});if(!_0x1c1991)return null;return{'id':_0x1c1991['id'],'amount':_0x1c1991['amount'],'network':_0x1c1991[_0x2afe71(0x291)],'status':_0x1c1991['status'],'txid':_0x1c1991['txid'],'notes':_0x1c1991[_0x2afe71(0x29b)],'createdAt':_0x1c1991[_0x2afe71(0x1e3)],'paidAt':_0x1c1991[_0x2afe71(0x289)]};}async[a86_0x3e1333(0x27d)](_0x2da7c4,_0x4a73a2){const _0x8d45d2=a86_0x3e1333,_0x18ac7e=new Date();let _0xa53467,_0x4888c3;switch(_0x4a73a2){case'yesterday':case _0x8d45d2(0x277):const _0x4d83ef=new Date(_0x18ac7e);_0x4d83ef[_0x8d45d2(0x235)](_0x4d83ef['getDate']()-0x1),_0xa53467=new Date(_0x4d83ef),_0xa53467[_0x8d45d2(0x29d)](0x0,0x0,0x0,0x0),_0x4888c3=new Date(_0x4d83ef),_0x4888c3[_0x8d45d2(0x29d)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0xa53467=new Date(_0x18ac7e[_0x8d45d2(0x22b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x8d45d2(0x2a3):_0xa53467=new Date(_0x18ac7e['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x8d45d2(0x221):_0xa53467=new Date(_0x18ac7e['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xa53467=new Date(_0x18ac7e[_0x8d45d2(0x22b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x480d82={'gte':_0xa53467};_0x4888c3&&(_0x480d82[_0x8d45d2(0x23e)]=_0x4888c3);const [_0x44ac60,_0x3cfc52,_0x1b582c,_0x233ac2,_0x44eefa,_0x480716]=await Promise[_0x8d45d2(0x1dc)]([database_1['default'][_0x8d45d2(0x1ef)]['count']({'where':{'shopId':_0x2da7c4,'createdAt':_0x480d82}}),database_1['default'][_0x8d45d2(0x1ef)][_0x8d45d2(0x1d3)]({'where':{'shopId':_0x2da7c4,'status':_0x8d45d2(0x22f),'createdAt':_0x480d82}}),database_1[_0x8d45d2(0x1fc)][_0x8d45d2(0x1ef)][_0x8d45d2(0x1d3)]({'where':{'shopId':_0x2da7c4,'status':'PENDING','createdAt':_0x480d82}}),database_1['default']['payout'][_0x8d45d2(0x1d3)]({'where':{'shopId':_0x2da7c4,'status':_0x8d45d2(0x29c),'createdAt':_0x480d82}}),database_1[_0x8d45d2(0x1fc)][_0x8d45d2(0x1ef)][_0x8d45d2(0x24f)]({'where':{'shopId':_0x2da7c4,'createdAt':_0x480d82},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x8d45d2(0x1ef)][_0x8d45d2(0x24f)]({'where':{'shopId':_0x2da7c4},'take':0xa,'orderBy':{'createdAt':_0x8d45d2(0x29f)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x58da11=_0x44eefa['reduce']((_0x5526ea,_0x944560)=>_0x5526ea+_0x944560[_0x8d45d2(0x217)],0x0),_0x19cdbe=_0x44eefa['filter'](_0x320494=>_0x320494[_0x8d45d2(0x27e)]===_0x8d45d2(0x22f))[_0x8d45d2(0x21e)]((_0x3bdf7b,_0x12b805)=>_0x3bdf7b+_0x12b805[_0x8d45d2(0x217)],0x0),_0x200c91=_0x44eefa[_0x8d45d2(0x25c)](_0x433967=>_0x433967[_0x8d45d2(0x27e)]===_0x8d45d2(0x2aa))[_0x8d45d2(0x21e)]((_0x275278,_0x3bf3cb)=>_0x275278+_0x3bf3cb[_0x8d45d2(0x217)],0x0),_0x796d34=_0x44eefa[_0x8d45d2(0x21e)]((_0x2eae92,_0x3b3754)=>{const _0x4f85ea=_0x8d45d2;return _0x2eae92[_0x3b3754['network']]=(_0x2eae92[_0x3b3754[_0x4f85ea(0x291)]]||0x0)+0x1,_0x2eae92;},{}),_0x530de0=_0x44eefa[_0x8d45d2(0x21e)]((_0x27326c,_0x53d1aa)=>{const _0xde3a1=_0x8d45d2;return _0x27326c[_0x53d1aa[_0xde3a1(0x27e)]]=(_0x27326c[_0x53d1aa[_0xde3a1(0x27e)]]||0x0)+0x1,_0x27326c;},{});return{'totalPayouts':_0x44ac60,'completedPayouts':_0x3cfc52,'pendingPayouts':_0x1b582c,'rejectedPayouts':_0x233ac2,'totalAmount':_0x58da11,'completedAmount':_0x19cdbe,'pendingAmount':_0x200c91,'payoutsByMethod':_0x796d34,'payoutsByStatus':_0x530de0,'recentPayouts':_0x480716[_0x8d45d2(0x237)](_0x278556=>({'id':_0x278556['id'],'shopId':_0x2da7c4,'amount':_0x278556[_0x8d45d2(0x217)],'method':_0x278556[_0x8d45d2(0x291)],'status':_0x278556[_0x8d45d2(0x27e)],'txid':_0x278556['txid'],'createdAt':_0x278556[_0x8d45d2(0x1e3)],'paidAt':_0x278556[_0x8d45d2(0x289)]}))};}async[a86_0x3e1333(0x27a)](_0x1a3dce){const _0x7ce470=a86_0x3e1333;console[_0x7ce470(0x25a)](_0x7ce470(0x1f6)+_0x1a3dce+_0x7ce470(0x264));const _0x3c5d7d=await database_1[_0x7ce470(0x1fc)][_0x7ce470(0x234)][_0x7ce470(0x210)]({'where':{'id':_0x1a3dce},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3c5d7d)throw new Error(_0x7ce470(0x246));const _0x2f4841=new Date(),_0x5a62de=new Date(_0x2f4841[_0x7ce470(0x1e7)](),_0x2f4841[_0x7ce470(0x231)](),0x1),_0x4dcce3=new Date(_0x2f4841['getFullYear'](),_0x2f4841[_0x7ce470(0x231)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x42ab84=await database_1[_0x7ce470(0x1fc)][_0x7ce470(0x1ef)][_0x7ce470(0x200)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1a3dce,'createdAt':{'gte':_0x5a62de,'lte':_0x4dcce3},'status':_0x7ce470(0x22f)}}),_0x23b555=_0x42ab84['_sum'][_0x7ce470(0x217)]||0x0,_0x382a15={'availableBalance':Math['round'](_0x3c5d7d['balance']*0x64)/0x64,'totalPaidOut':Math[_0x7ce470(0x1fb)](_0x3c5d7d['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math['round'](_0x3c5d7d[_0x7ce470(0x2ac)]*0x64)/0x64,'thisMonth':Math[_0x7ce470(0x1fb)](_0x23b555*0x64)/0x64};return console[_0x7ce470(0x25a)](_0x7ce470(0x230)+_0x3c5d7d['username']+_0x7ce470(0x21d)),console[_0x7ce470(0x25a)](_0x7ce470(0x1f5)+_0x382a15[_0x7ce470(0x1d0)]+_0x7ce470(0x2b5)),console[_0x7ce470(0x25a)](_0x7ce470(0x2ab)+_0x382a15[_0x7ce470(0x229)]+_0x7ce470(0x2a8)),console[_0x7ce470(0x25a)](_0x7ce470(0x220)+_0x382a15[_0x7ce470(0x23a)]+_0x7ce470(0x2b5)),console[_0x7ce470(0x25a)]('\x20\x20\x20ðŸ“…\x20This\x20month:\x20'+_0x382a15[_0x7ce470(0x280)]+_0x7ce470(0x270)),_0x382a15;}[a86_0x3e1333(0x28e)](_0x3e2b8b){const _0x4179c9=a86_0x3e1333,_0x128593={'test_gateway':_0x4179c9(0x213),'plisio':_0x4179c9(0x227),'rapyd':_0x4179c9(0x257),'noda':_0x4179c9(0x238),'cointopay':_0x4179c9(0x201),'klyme_eu':_0x4179c9(0x1df),'klyme_gb':_0x4179c9(0x1ee),'klyme_de':_0x4179c9(0x1de)};return _0x128593[_0x3e2b8b]||_0x3e2b8b;}async[a86_0x3e1333(0x295)](_0x1ae488){return this['getShopPayoutStats'](_0x1ae488);}async[a86_0x3e1333(0x203)](_0x323f4f,_0x124c07){const _0x24b2ce=a86_0x3e1333,{page:_0x409fb5,limit:_0x5019f8,paymentId:_0x33c6c4}=_0x124c07,_0xd06709=(_0x409fb5-0x1)*_0x5019f8,_0x128c1c={'shopId':_0x323f4f};_0x33c6c4&&(_0x128c1c[_0x24b2ce(0x228)]=_0x33c6c4);const [_0x474bcd,_0x229d7c]=await Promise[_0x24b2ce(0x1dc)]([database_1[_0x24b2ce(0x1fc)][_0x24b2ce(0x281)][_0x24b2ce(0x24f)]({'where':_0x128c1c,'skip':_0xd06709,'take':_0x5019f8,'orderBy':{'createdAt':_0x24b2ce(0x29f)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default']['webhookLog']['count']({'where':_0x128c1c})]);return{'logs':_0x474bcd[_0x24b2ce(0x237)](_0x46ad59=>({'id':_0x46ad59['id'],'paymentId':_0x46ad59['paymentId'],'shopId':_0x46ad59['shopId'],'event':_0x46ad59[_0x24b2ce(0x207)],'statusCode':_0x46ad59[_0x24b2ce(0x269)],'retryCount':_0x46ad59[_0x24b2ce(0x293)],'responseBody':_0x46ad59[_0x24b2ce(0x23b)],'createdAt':_0x46ad59[_0x24b2ce(0x1e3)],'payment':_0x46ad59[_0x24b2ce(0x260)]})),'pagination':{'page':_0x409fb5,'limit':_0x5019f8,'total':_0x229d7c,'totalPages':Math['ceil'](_0x229d7c/_0x5019f8)}};}async['getStatistics'](_0xa172c5,_0x4d8ee0,_0x3fbf20,_0x16136a,_0x485acd){const _0x52211a=a86_0x3e1333;console['log'](_0x52211a(0x1cf)+_0xa172c5+_0x52211a(0x21a)+_0x4d8ee0+_0x52211a(0x23f)+_0x3fbf20+',\x20dateTo:\x20'+_0x16136a);const _0x649264=_0x485acd?new Date(_0x485acd):new Date();let _0x5cffaf,_0x14c94a;if(_0x3fbf20&&_0x16136a){const _0x435515=new Date(_0x3fbf20),_0x212f43=new Date(_0x16136a);_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x435515[_0x52211a(0x1d4)](),_0x435515['getUTCMonth'](),_0x435515[_0x52211a(0x1eb)](),0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date['UTC'](_0x212f43[_0x52211a(0x1d4)](),_0x212f43[_0x52211a(0x1d5)](),_0x212f43[_0x52211a(0x1eb)](),0x17,0x3b,0x3b,0x3e7)),console[_0x52211a(0x25a)](_0x52211a(0x284)+_0x5cffaf[_0x52211a(0x25f)]()+_0x52211a(0x248)+_0x14c94a['toISOString']());}else{if(_0x4d8ee0&&_0x4d8ee0['startsWith']('custom_')){const _0x43730e=_0x4d8ee0[_0x52211a(0x209)](_0x52211a(0x204),'')[_0x52211a(0x22d)]('_');if(_0x43730e[_0x52211a(0x2be)]===0x2){const _0x2e6a96=new Date(_0x43730e[0x0]),_0x5de2b8=new Date(_0x43730e[0x1]);_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x2e6a96[_0x52211a(0x1d4)](),_0x2e6a96[_0x52211a(0x1d5)](),_0x2e6a96['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date[_0x52211a(0x2b6)](_0x5de2b8[_0x52211a(0x1d4)](),_0x5de2b8[_0x52211a(0x1d5)](),_0x5de2b8[_0x52211a(0x1eb)](),0x17,0x3b,0x3b,0x3e7)),console['log']('ðŸ“…\x20Custom\x20period:\x20'+_0x5cffaf[_0x52211a(0x25f)]()+_0x52211a(0x248)+_0x14c94a[_0x52211a(0x25f)]());}else{const _0xff8285=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264['getUTCMonth'](),_0x649264[_0x52211a(0x1eb)]()-0x1e));_0x5cffaf=new Date(Date['UTC'](_0xff8285[_0x52211a(0x1d4)](),_0xff8285['getUTCMonth'](),_0xff8285[_0x52211a(0x1eb)](),0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264['getUTCMonth'](),_0x649264[_0x52211a(0x1eb)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x5327c3=_0x4d8ee0||'this_month';switch(_0x5327c3[_0x52211a(0x1e2)]()){case'today':_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264[_0x52211a(0x1d5)](),_0x649264[_0x52211a(0x1eb)](),0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264[_0x52211a(0x1d5)](),_0x649264[_0x52211a(0x1eb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x52211a(0x268):const _0x3374b4=new Date(_0x649264);_0x3374b4[_0x52211a(0x224)](_0x3374b4['getUTCDate']()-0x1),_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x3374b4[_0x52211a(0x1d4)](),_0x3374b4[_0x52211a(0x1d5)](),_0x3374b4[_0x52211a(0x1eb)](),0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date[_0x52211a(0x2b6)](_0x3374b4[_0x52211a(0x1d4)](),_0x3374b4[_0x52211a(0x1d5)](),_0x3374b4['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x52211a(0x2ad):const _0x1a6d8f=_0x649264[_0x52211a(0x236)](),_0x343e9b=_0x1a6d8f===0x0?-0x6:0x1-_0x1a6d8f,_0xe6f254=_0x649264[_0x52211a(0x1eb)]()+_0x343e9b;_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264[_0x52211a(0x1d5)](),_0xe6f254,0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date['UTC'](_0x649264['getUTCFullYear'](),_0x649264[_0x52211a(0x1d5)](),_0x649264[_0x52211a(0x1eb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x52211a(0x258):const _0x22663f=new Date(Date['UTC'](_0x649264['getUTCFullYear'](),_0x649264['getUTCMonth'](),_0x649264[_0x52211a(0x1eb)]()-0x7)),_0x3334a4=_0x22663f['getUTCDay'](),_0x200160=_0x3334a4===0x0?-0x6:0x1-_0x3334a4,_0x720aa6=_0x22663f[_0x52211a(0x1eb)]()+_0x200160;_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x22663f['getUTCFullYear'](),_0x22663f['getUTCMonth'](),_0x720aa6,0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date['UTC'](_0x22663f[_0x52211a(0x1d4)](),_0x22663f['getUTCMonth'](),_0x720aa6+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x52211a(0x251):_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264[_0x52211a(0x1d5)](),0x1,0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264[_0x52211a(0x1d5)](),_0x649264[_0x52211a(0x1eb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x52211a(0x283):_0x5cffaf=new Date(Date['UTC'](_0x649264[_0x52211a(0x1d4)](),_0x649264['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date['UTC'](_0x649264[_0x52211a(0x1d4)](),_0x649264[_0x52211a(0x1d5)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x52211a(0x1fe):_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date[_0x52211a(0x2b6)](_0x649264[_0x52211a(0x1d4)](),_0x649264[_0x52211a(0x1d5)](),_0x649264[_0x52211a(0x1eb)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x5cffaf=new Date(Date[_0x52211a(0x2b6)](_0x649264['getUTCFullYear'](),_0x649264[_0x52211a(0x1d5)](),0x1,0x0,0x0,0x0,0x0)),_0x14c94a=new Date(Date['UTC'](_0x649264[_0x52211a(0x1d4)](),_0x649264['getUTCMonth'](),_0x649264['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x52211a(0x25a)](_0x52211a(0x259)+_0x5cffaf[_0x52211a(0x25f)]()+'\x20to\x20'+_0x14c94a['toISOString']());const _0x18b4f7={'gte':_0x5cffaf,'lte':_0x14c94a},[_0x2588a9,_0x4be177,_0x55e8be,_0x5e857c,_0x2cfbe1,_0x1ba2d4,_0x4731b2,_0x30ed96,_0x582832,_0x3af8db,_0x398210]=await Promise[_0x52211a(0x1dc)]([database_1[_0x52211a(0x1fc)][_0x52211a(0x260)][_0x52211a(0x1d3)]({'where':{'shopId':_0xa172c5,'gateway':{'not':_0x52211a(0x20f)},'status':{'notIn':['PENDING',_0x52211a(0x245)]},'createdAt':_0x18b4f7}}),database_1[_0x52211a(0x1fc)]['payment']['count']({'where':{'shopId':_0xa172c5,'gateway':{'not':_0x52211a(0x20f)},'status':'PAID','createdAt':_0x18b4f7}}),database_1[_0x52211a(0x1fc)]['payment']['count']({'where':{'shopId':_0xa172c5,'gateway':{'not':_0x52211a(0x20f)},'status':_0x52211a(0x215)}}),database_1[_0x52211a(0x1fc)][_0x52211a(0x260)][_0x52211a(0x1d3)]({'where':{'shopId':_0xa172c5,'gateway':{'not':_0x52211a(0x20f)},'status':_0x52211a(0x222)}}),database_1[_0x52211a(0x1fc)][_0x52211a(0x260)]['findMany']({'where':{'shopId':_0xa172c5,'gateway':{'not':_0x52211a(0x20f)},'status':'PAID','createdAt':_0x18b4f7},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x52211a(0x1fc)][_0x52211a(0x260)]['findMany']({'where':{'shopId':_0xa172c5,'gateway':{'not':'test_gateway'}},'take':0x4,'orderBy':{'createdAt':_0x52211a(0x29f)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x52211a(0x1fc)]['payment'][_0x52211a(0x24f)]({'where':{'shopId':_0xa172c5,'gateway':{'not':'test_gateway'},'createdAt':_0x18b4f7},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}}),database_1[_0x52211a(0x1fc)]['payment']['count']({'where':{'shopId':_0xa172c5,'gateway':{'not':_0x52211a(0x20f)},'status':_0x52211a(0x225)}}),database_1[_0x52211a(0x1fc)][_0x52211a(0x260)][_0x52211a(0x24f)]({'where':{'shopId':_0xa172c5,'gateway':{'not':'test_gateway'},'status':'PAID'},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x52211a(0x234)][_0x52211a(0x210)]({'where':{'id':_0xa172c5},'select':{'balance':!![]}}),database_1[_0x52211a(0x1fc)][_0x52211a(0x260)]['findMany']({'where':{'shopId':_0xa172c5,'gateway':{'not':_0x52211a(0x20f)}},'select':{'gateway':!![]}})]),_0x55699a={};for(const _0x381cf5 of _0x398210){_0x381cf5[_0x52211a(0x1fd)]&&(_0x55699a[_0x381cf5[_0x52211a(0x1fd)]]=(_0x55699a[_0x381cf5['gateway']]||0x0)+0x1);}console[_0x52211a(0x25a)](_0x52211a(0x23d),_0x55699a);let _0x3cf5c1=0x0,_0x2d6f5f=0x0;for(const _0x2bf1e0 of _0x2cfbe1){if(_0x2bf1e0[_0x52211a(0x2a9)])_0x3cf5c1+=_0x2bf1e0[_0x52211a(0x2a9)];else{const _0x91dfbb=await currencyService_1[_0x52211a(0x211)][_0x52211a(0x2b8)](_0x2bf1e0[_0x52211a(0x217)],_0x2bf1e0[_0x52211a(0x2a1)]);_0x3cf5c1+=_0x91dfbb;}_0x2bf1e0[_0x52211a(0x2b3)]&&(_0x2d6f5f+=_0x2bf1e0[_0x52211a(0x2b3)]);}let _0x32dbaf=0x0;for(const _0x4edc7d of _0x582832){_0x4edc7d[_0x52211a(0x2b3)]&&(_0x32dbaf+=_0x4edc7d[_0x52211a(0x2b3)]);}const _0x16c23b=this[_0x52211a(0x20c)](_0x4731b2,_0x5cffaf,_0x14c94a||_0x649264),_0x1042b7=_0x2588a9>0x0?_0x4be177/_0x2588a9*0x64:0x0,_0x3f3f4e=_0x30ed96>0x0?_0x55e8be/_0x30ed96*0x64:0x0;return{'totalPayments':_0x2588a9,'successfulPayments':_0x4be177,'totalRevenue':Math[_0x52211a(0x1fb)](_0x3cf5c1*0x64)/0x64,'merchantEarnings':Math[_0x52211a(0x1fb)](_0x2d6f5f*0x64)/0x64,'merchantTotalRevenue':Math[_0x52211a(0x1fb)](_0x32dbaf*0x64)/0x64,'payoutBalance':Math[_0x52211a(0x1fb)]((_0x3af8db?.[_0x52211a(0x2ac)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x52211a(0x1fb)](_0x1042b7*0x64)/0x64,'chargebackRate':Math[_0x52211a(0x1fb)](_0x3f3f4e*0x64)/0x64,'chargebacks':_0x55e8be,'refunds':_0x5e857c,'paymentsByGateway':_0x55699a,'dailyRevenue':_0x16c23b[_0x52211a(0x1ed)],'dailyPayments':_0x16c23b[_0x52211a(0x1f3)],'recentPayments':_0x1ba2d4['map'](_0x168acd=>({'id':_0x168acd['id'],'gateway':_0x168acd[_0x52211a(0x1fd)],'amount':_0x168acd[_0x52211a(0x217)],'currency':_0x168acd[_0x52211a(0x2a1)],'status':_0x168acd[_0x52211a(0x27e)],'createdAt':_0x168acd[_0x52211a(0x1e3)]}))};}[a86_0x3e1333(0x20c)](_0x1e38af,_0x3aabde,_0x21aace){const _0x5103e7=a86_0x3e1333,_0x5121d7=new Map(),_0x1f2f44=new Date(_0x3aabde);while(_0x1f2f44<=_0x21aace){const _0x408af2=_0x1f2f44[_0x5103e7(0x25f)]()['split']('T')[0x0];_0x5121d7[_0x5103e7(0x299)](_0x408af2,{'revenue':0x0,'count':0x0}),_0x1f2f44['setDate'](_0x1f2f44[_0x5103e7(0x1e0)]()+0x1);}for(const _0x4e1e29 of _0x1e38af){const _0x56645d=_0x4e1e29['createdAt'][_0x5103e7(0x25f)]()[_0x5103e7(0x22d)]('T')[0x0],_0x32a2c5=_0x5121d7['get'](_0x56645d);_0x32a2c5&&(_0x32a2c5[_0x5103e7(0x1d3)]+=0x1,_0x4e1e29[_0x5103e7(0x27e)]==='PAID'&&_0x4e1e29[_0x5103e7(0x2a9)]&&(_0x32a2c5['revenue']+=_0x4e1e29[_0x5103e7(0x2a9)]));}const _0x45acea=[],_0x3b2be6=[];for(const [_0xa9b937,_0xc80f37]of _0x5121d7){_0x45acea[_0x5103e7(0x212)]({'date':_0xa9b937,'amount':Math[_0x5103e7(0x1fb)](_0xc80f37['revenue']*0x64)/0x64}),_0x3b2be6[_0x5103e7(0x212)]({'date':_0xa9b937,'count':_0xc80f37[_0x5103e7(0x1d3)]});}return{'dailyRevenue':_0x45acea,'dailyPayments':_0x3b2be6};}[a86_0x3e1333(0x2b0)](_0x225c17=0x8){const _0x2f9a73=a86_0x3e1333,_0x6bedcb=[];for(let _0x3faa8f=0x0;_0x3faa8f<_0x225c17;_0x3faa8f++){const _0x1b67b5=crypto_1[_0x2f9a73(0x1fc)]['randomBytes'](0x4)[_0x2f9a73(0x25d)](_0x2f9a73(0x271))[_0x2f9a73(0x2c2)]();_0x6bedcb[_0x2f9a73(0x212)](_0x1b67b5);}return _0x6bedcb;}async[a86_0x3e1333(0x286)](_0xd11ac9){const _0x397127=a86_0x3e1333,_0x539e6c=await database_1['default'][_0x397127(0x234)][_0x397127(0x210)]({'where':{'id':_0xd11ac9},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x539e6c)throw new Error(_0x397127(0x246));const _0x3264de=speakeasy_1[_0x397127(0x1fc)][_0x397127(0x240)]({'name':_0x397127(0x2bc)+_0x539e6c[_0x397127(0x274)]+')','issuer':_0x397127(0x1fa),'length':0x20}),_0x2ce6f8=await qrcode_1[_0x397127(0x1fc)][_0x397127(0x2af)](_0x3264de[_0x397127(0x2a6)]),_0x21dad9=this[_0x397127(0x2b0)](0x8),_0xa91894=await Promise[_0x397127(0x1dc)](_0x21dad9['map'](_0x20c1b7=>bcryptjs_1[_0x397127(0x1fc)][_0x397127(0x22e)](_0x20c1b7,0xa)));return await database_1[_0x397127(0x1fc)][_0x397127(0x234)][_0x397127(0x253)]({'where':{'id':_0xd11ac9},'data':{'twoFactorSecret':_0x3264de[_0x397127(0x29a)],'backupCodes':JSON[_0x397127(0x223)](_0xa91894)}}),console['log'](_0x397127(0x2bb)+_0x539e6c['username']),console[_0x397127(0x25a)](_0x397127(0x1e9)+_0x21dad9['length']+_0x397127(0x239)),{'secret':_0x3264de['base32'],'qrCode':_0x2ce6f8,'manualEntryKey':_0x3264de[_0x397127(0x29a)],'backupCodes':_0x21dad9};}async[a86_0x3e1333(0x28c)](_0x3b4c33,_0x390a30){const _0x415b7b=a86_0x3e1333,_0x3e86dc=await database_1[_0x415b7b(0x1fc)][_0x415b7b(0x234)][_0x415b7b(0x210)]({'where':{'id':_0x3b4c33},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x3e86dc)throw new Error('Shop\x20not\x20found');if(!_0x3e86dc[_0x415b7b(0x1ea)])throw new Error(_0x415b7b(0x242));if(_0x3e86dc[_0x415b7b(0x1e4)])throw new Error(_0x415b7b(0x279));const _0x2a8246=speakeasy_1[_0x415b7b(0x1fc)]['totp']['verify']({'secret':_0x3e86dc[_0x415b7b(0x1ea)],'encoding':_0x415b7b(0x29a),'token':_0x390a30,'window':0x2});if(!_0x2a8246)throw new Error(_0x415b7b(0x25b));return await database_1[_0x415b7b(0x1fc)]['shop']['update']({'where':{'id':_0x3b4c33},'data':{'twoFactorEnabled':!![]}}),console[_0x415b7b(0x25a)](_0x415b7b(0x1d6)+_0x3e86dc[_0x415b7b(0x274)]),{'enabled':!![]};}async[a86_0x3e1333(0x226)](_0x115af6){const _0x31edbc=a86_0x3e1333,_0x28cc5b=await database_1['default'][_0x31edbc(0x234)][_0x31edbc(0x210)]({'where':{'id':_0x115af6},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x28cc5b)throw new Error('Shop\x20not\x20found');await database_1['default'][_0x31edbc(0x234)][_0x31edbc(0x253)]({'where':{'id':_0x115af6},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x31edbc(0x25a)](_0x31edbc(0x1e8)+_0x28cc5b[_0x31edbc(0x274)]);}}exports[a86_0x3e1333(0x24a)]=ShopService;