'use strict';const a53_0x23872e=a53_0x19ac;(function(_0x5dc7bb,_0x5dce7b){const _0x407025=a53_0x19ac,_0x13c93d=_0x5dc7bb();while(!![]){try{const _0x53c8c6=parseInt(_0x407025(0xbd))/0x1+-parseInt(_0x407025(0x96))/0x2*(-parseInt(_0x407025(0xbe))/0x3)+-parseInt(_0x407025(0xad))/0x4*(-parseInt(_0x407025(0xf3))/0x5)+parseInt(_0x407025(0x81))/0x6+parseInt(_0x407025(0xe8))/0x7*(-parseInt(_0x407025(0x73))/0x8)+-parseInt(_0x407025(0xcb))/0x9+-parseInt(_0x407025(0x100))/0xa;if(_0x53c8c6===_0x5dce7b)break;else _0x13c93d['push'](_0x13c93d['shift']());}catch(_0x3c9247){_0x13c93d['push'](_0x13c93d['shift']());}}}(a53_0x2f8f,0xbb5bc));function a53_0x19ac(_0xa73e3,_0x4d7202){const _0x2f8f29=a53_0x2f8f();return a53_0x19ac=function(_0x19ac59,_0x1c59c3){_0x19ac59=_0x19ac59-0x68;let _0x18c7fb=_0x2f8f29[_0x19ac59];return _0x18c7fb;},a53_0x19ac(_0xa73e3,_0x4d7202);}var __importDefault=this&&this[a53_0x23872e(0x103)]||function(_0x64a499){const _0x3c9c3a=a53_0x23872e;return _0x64a499&&_0x64a499[_0x3c9c3a(0xf2)]?_0x64a499:{'default':_0x64a499};};Object[a53_0x23872e(0x10d)](exports,'__esModule',{'value':!![]}),exports[a53_0x23872e(0xa3)]=void 0x0;const database_1=__importDefault(require(a53_0x23872e(0xd5))),currencyService_1=require(a53_0x23872e(0xc8)),paymentService_1=require(a53_0x23872e(0xc1));function a53_0x2f8f(){const _0x31a1b6=['customerEmail','convertToUSDT','parse','toISOString','createPayment','desc','getFullYear','getStatistics','shopUrl','POST','createdAt','2832FbcaXN','set','üìä\x20Final\x20WHERE\x20conditions:','\x20\x20\x20üíµ\x20Available\x20balance:\x20','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','delete','usdtTrcWallet','No\x20webhook\x20URL\x20configured','COMPLETED','usdtPolygonWallet','gte','Test\x20Gateway','error','paymentService','2454468WPrIeg','testWebhook','totalPaidOut','test','getPaymentById','formatNetworkName','üåê\x20Network\x20filter:\x20','update','USDT\x20TRC20','availableBalance','paymentId','üìÖ\x20Period\x20end:\x20','amountUSDT','expiresAt','updateShopProfile','gatewaySettings','dailyRevenue','maxPayments','webhookEvents','round','Shop\x20not\x20found','12742ayekpb','Webhook\x20returned\x20error:\x20','balance','event','updateWallets','KLYME\x20GB','telegramId','merchantUrl','lte','test_order_123','customerName','stringify','USDT\x20BSC','ShopService','usdcPolygonWallet','üìÖ\x20Date\x20end:\x20','toUpperCase','paid','currency','usage','getMonth','\x20USDT','periodTo','1167900mjhQGF','Rapyd','name','üìä\x20Shop\x20','getGatewayDisplayName','gateway','Failed\x20to\x20send\x20webhook:\x20','30d','updatePayment','90d','payment','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','asc','ceil','all','reduce','1214009xmMQck','381EZfcIT','status','retryCount','./paymentService','createPublicPayment','redirectUrl','telegram','webhookUrl','TesSoft\x20Payment\x20System/1.0\x20(Test)','getTime','./currencyService','setHours','getPaymentByShopAndId','2821806xnKMBB','count','USDT\x20Polygon','usdtErcWallet','üìä\x20Status\x20filter:\x20','sourceCurrency','txid','Error\x20parsing\x20webhook\x20events:','thisMonth','revenue','../config/database','findUnique','split','erc20','map','settings','Unknown\x20error','test_payment_123','amountIsEditable','\x20\x20\x20üìÖ\x20This\x20month:\x20','CoinToPay','currencyService','paymentGateways','periodFrom','PaymentService','gateways','test_gateway','üåê\x20Method\x20filter:\x20','notes','10514zVkVXi','username','getWebhookLogs','polygon_usdc','log','trc20','generateDailyStatistics','getShopPayoutStats','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','üìÖ\x20Date\x20start:\x20','__esModule','10iYkjuf','webhookLog','deletePayment','payout','\x20USDT\x20(total\x20payouts)','KLYME\x20EU','PAID','shopId','statusCode','PENDING','default','fullName','üìÖ\x20Period\x20start:\x20','14034920PngdoX','dailyPayments','isArray','__importDefault','shop','filter','getPayoutStats','amount','getPayoutStatistics','\x20USDT\x20(current\x20balance)','wallets','paidAt','findMany','defineProperty','network','aggregate','Payment\x20not\x20found','push','statusText'];a53_0x2f8f=function(){return _0x31a1b6;};return a53_0x2f8f();}class ShopService{constructor(){const _0x22ce1d=a53_0x23872e;this[_0x22ce1d(0x80)]=new paymentService_1[(_0x22ce1d(0xe3))]();}async['getShopProfile'](_0x121efd){const _0x32e7a0=a53_0x23872e,_0x207b04=await database_1[_0x32e7a0(0xfd)][_0x32e7a0(0x104)]['findUnique']({'where':{'id':_0x121efd},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x207b04)throw new Error(_0x32e7a0(0x95));let _0x151dd1=[];if(_0x207b04[_0x32e7a0(0xda)]?.['webhookEvents'])try{_0x151dd1=Array[_0x32e7a0(0x102)](_0x207b04[_0x32e7a0(0xda)][_0x32e7a0(0x93)])?_0x207b04['settings'][_0x32e7a0(0x93)]:JSON[_0x32e7a0(0x6a)](_0x207b04['settings'][_0x32e7a0(0x93)]);}catch(_0x211915){console[_0x32e7a0(0x7f)](_0x32e7a0(0xd2),_0x211915),_0x151dd1=[];}return{'id':_0x207b04['id'],'fullName':_0x207b04[_0x32e7a0(0xaf)],'username':_0x207b04[_0x32e7a0(0xe9)],'telegramId':_0x207b04[_0x32e7a0(0xc4)],'merchantUrl':_0x207b04[_0x32e7a0(0x70)],'gateways':_0x207b04[_0x32e7a0(0xe1)]?JSON['parse'](_0x207b04[_0x32e7a0(0xe1)]):null,'gatewaySettings':_0x207b04['gatewaySettings']?JSON[_0x32e7a0(0x6a)](_0x207b04[_0x32e7a0(0x90)]):null,'publicKey':_0x207b04['publicKey'],'webhookUrl':_0x207b04['settings']?.[_0x32e7a0(0xc5)]||null,'webhookEvents':_0x151dd1,'wallets':{'usdtPolygonWallet':_0x207b04[_0x32e7a0(0x7c)],'usdtTrcWallet':_0x207b04[_0x32e7a0(0x79)],'usdtErcWallet':_0x207b04[_0x32e7a0(0xce)],'usdcPolygonWallet':_0x207b04[_0x32e7a0(0xa4)]},'status':_0x207b04[_0x32e7a0(0xbf)],'createdAt':_0x207b04[_0x32e7a0(0x72)]};}async[a53_0x23872e(0x8f)](_0x50117f,_0x3284c2){const _0x4750d1=a53_0x23872e,_0x682b61={};_0x3284c2['fullName']&&(_0x682b61[_0x4750d1(0xaf)]=_0x3284c2[_0x4750d1(0xfe)]);_0x3284c2[_0x4750d1(0x9c)]!==undefined&&(_0x682b61['telegram']=_0x3284c2[_0x4750d1(0x9c)]||null);_0x3284c2[_0x4750d1(0x9d)]&&(_0x682b61[_0x4750d1(0x70)]=_0x3284c2[_0x4750d1(0x9d)]);_0x3284c2[_0x4750d1(0xe4)]&&(_0x682b61['paymentGateways']=JSON['stringify'](_0x3284c2[_0x4750d1(0xe4)]));_0x3284c2[_0x4750d1(0x90)]&&(_0x682b61[_0x4750d1(0x90)]=JSON['stringify'](_0x3284c2['gatewaySettings']));_0x3284c2[_0x4750d1(0x10a)]&&(_0x3284c2[_0x4750d1(0x10a)][_0x4750d1(0x7c)]!==undefined&&(_0x682b61[_0x4750d1(0x7c)]=_0x3284c2[_0x4750d1(0x10a)][_0x4750d1(0x7c)]||null),_0x3284c2[_0x4750d1(0x10a)][_0x4750d1(0x79)]!==undefined&&(_0x682b61['usdtTrcWallet']=_0x3284c2[_0x4750d1(0x10a)]['usdtTrcWallet']||null),_0x3284c2[_0x4750d1(0x10a)][_0x4750d1(0xce)]!==undefined&&(_0x682b61[_0x4750d1(0xce)]=_0x3284c2['wallets'][_0x4750d1(0xce)]||null),_0x3284c2['wallets'][_0x4750d1(0xa4)]!==undefined&&(_0x682b61[_0x4750d1(0xa4)]=_0x3284c2['wallets']['usdcPolygonWallet']||null));const _0x4e2590=await database_1[_0x4750d1(0xfd)][_0x4750d1(0x104)]['update']({'where':{'id':_0x50117f},'data':_0x682b61,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x48b8f4=[];if(_0x4e2590[_0x4750d1(0xda)]?.[_0x4750d1(0x93)])try{_0x48b8f4=Array[_0x4750d1(0x102)](_0x4e2590['settings'][_0x4750d1(0x93)])?_0x4e2590[_0x4750d1(0xda)][_0x4750d1(0x93)]:JSON['parse'](_0x4e2590[_0x4750d1(0xda)][_0x4750d1(0x93)]);}catch(_0x3cf422){console[_0x4750d1(0x7f)](_0x4750d1(0xd2),_0x3cf422),_0x48b8f4=[];}return{'id':_0x4e2590['id'],'fullName':_0x4e2590['name'],'username':_0x4e2590['username'],'telegramId':_0x4e2590[_0x4750d1(0xc4)],'merchantUrl':_0x4e2590[_0x4750d1(0x70)],'gateways':_0x4e2590[_0x4750d1(0xe1)]?JSON['parse'](_0x4e2590['paymentGateways']):null,'gatewaySettings':_0x4e2590['gatewaySettings']?JSON['parse'](_0x4e2590['gatewaySettings']):null,'publicKey':_0x4e2590['publicKey'],'webhookUrl':_0x4e2590[_0x4750d1(0xda)]?.[_0x4750d1(0xc5)]||null,'webhookEvents':_0x48b8f4,'wallets':{'usdtPolygonWallet':_0x4e2590[_0x4750d1(0x7c)],'usdtTrcWallet':_0x4e2590[_0x4750d1(0x79)],'usdtErcWallet':_0x4e2590[_0x4750d1(0xce)],'usdcPolygonWallet':_0x4e2590['usdcPolygonWallet']},'status':_0x4e2590[_0x4750d1(0xbf)],'createdAt':_0x4e2590[_0x4750d1(0x72)]};}async[a53_0x23872e(0x9a)](_0x107abe,_0x28ec16){const _0x575662=a53_0x23872e,_0x1ff397={};_0x28ec16['usdtPolygonWallet']!==undefined&&(_0x1ff397['usdtPolygonWallet']=_0x28ec16[_0x575662(0x7c)]||null),_0x28ec16[_0x575662(0x79)]!==undefined&&(_0x1ff397[_0x575662(0x79)]=_0x28ec16[_0x575662(0x79)]||null),_0x28ec16[_0x575662(0xce)]!==undefined&&(_0x1ff397[_0x575662(0xce)]=_0x28ec16[_0x575662(0xce)]||null),_0x28ec16[_0x575662(0xa4)]!==undefined&&(_0x1ff397[_0x575662(0xa4)]=_0x28ec16['usdcPolygonWallet']||null),await database_1[_0x575662(0xfd)][_0x575662(0x104)][_0x575662(0x88)]({'where':{'id':_0x107abe},'data':_0x1ff397});}async[a53_0x23872e(0x82)](_0x1cbb6f){const _0x3f367c=a53_0x23872e,_0x1e62ed=await database_1[_0x3f367c(0xfd)][_0x3f367c(0x104)][_0x3f367c(0xd6)]({'where':{'id':_0x1cbb6f},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x1e62ed?.[_0x3f367c(0xda)]?.[_0x3f367c(0xc5)])throw new Error(_0x3f367c(0x7a));const _0x7e082e={'event':_0x3f367c(0x84),'payment':{'id':_0x3f367c(0xdc),'order_id':_0x3f367c(0x9f),'gateway':'test','amount':0x64,'currency':'USD','status':_0x3f367c(0xa7),'created_at':new Date()['toISOString']()}};try{const _0x59d98f=await fetch(_0x1e62ed[_0x3f367c(0xda)][_0x3f367c(0xc5)],{'method':_0x3f367c(0x71),'headers':{'Content-Type':'application/json','User-Agent':_0x3f367c(0xc6)},'body':JSON[_0x3f367c(0xa1)](_0x7e082e)});return _0x59d98f['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x59d98f['status']+')'}:{'success':![],'message':_0x3f367c(0x97)+_0x59d98f[_0x3f367c(0xbf)]+'\x20'+_0x59d98f[_0x3f367c(0x112)]};}catch(_0xa0b001){return{'success':![],'message':_0x3f367c(0xb3)+(_0xa0b001 instanceof Error?_0xa0b001['message']:_0x3f367c(0xdb))};}}async[a53_0x23872e(0x6c)](_0xbcb47a){const _0x1c91c0=a53_0x23872e;return this[_0x1c91c0(0x80)][_0x1c91c0(0xc2)]({'public_key':'','gateway':_0xbcb47a[_0x1c91c0(0xb2)],'order_id':undefined,'amount':_0xbcb47a[_0x1c91c0(0x107)],'currency':_0xbcb47a[_0x1c91c0(0xa8)],'source_currency':_0xbcb47a[_0x1c91c0(0xd0)],'usage':_0xbcb47a[_0x1c91c0(0xa9)],'expires_at':_0xbcb47a[_0x1c91c0(0x8e)]?.[_0x1c91c0(0x6b)](),'success_url':_0xbcb47a[_0x1c91c0(0xc3)],'fail_url':_0xbcb47a[_0x1c91c0(0xc3)],'customer_email':_0xbcb47a[_0x1c91c0(0x68)],'customer_name':_0xbcb47a[_0x1c91c0(0xa0)],'country':_0xbcb47a['country'],'language':_0xbcb47a['language'],'amount_is_editable':_0xbcb47a[_0x1c91c0(0xdd)],'max_payments':_0xbcb47a[_0x1c91c0(0x92)],'customer':_0xbcb47a['customer']});}async['getPayments'](_0x37bfd0,_0xbb3b0a){const _0x41f170=a53_0x23872e;return this[_0x41f170(0x80)]['getPaymentsByShop'](_0x37bfd0,_0xbb3b0a);}async[a53_0x23872e(0x85)](_0x224142,_0x18bd5a){const _0x5cec9b=a53_0x23872e;return this['paymentService'][_0x5cec9b(0xca)](_0x224142,_0x18bd5a);}async[a53_0x23872e(0xb5)](_0x50c1ea,_0x2fd4fa,_0x500e25){const _0x4b4dec=a53_0x23872e,_0x55675e=await database_1[_0x4b4dec(0xfd)][_0x4b4dec(0xb7)]['findFirst']({'where':{'id':_0x2fd4fa,'shopId':_0x50c1ea}});if(!_0x55675e)throw new Error(_0x4b4dec(0x110));const _0x3cbfb4=await database_1[_0x4b4dec(0xfd)][_0x4b4dec(0xb7)]['update']({'where':{'id':_0x2fd4fa},'data':{..._0x500e25,'updatedAt':new Date()}});return _0x3cbfb4;}async[a53_0x23872e(0xf5)](_0x166ad2,_0x4f6f84){const _0x2f4079=a53_0x23872e,_0x159cee=await database_1['default'][_0x2f4079(0xb7)]['findFirst']({'where':{'id':_0x4f6f84,'shopId':_0x166ad2}});if(!_0x159cee)throw new Error(_0x2f4079(0x110));await database_1[_0x2f4079(0xfd)]['payment'][_0x2f4079(0x78)]({'where':{'id':_0x4f6f84}});}['formatNetworkName'](_0x4f2a77){const _0x35b7a9=a53_0x23872e,_0x282aca={'polygon':_0x35b7a9(0xcd),'trc20':_0x35b7a9(0x89),'erc20':'USDT\x20ERC20','bsc':_0x35b7a9(0xa2),'polygon_usdc':'USDC\x20Polygon'};return _0x282aca[_0x4f2a77]||_0x4f2a77;}async['getPayouts'](_0xade2f8,_0x5d99bf){const _0x5f3dd3=a53_0x23872e,{page:_0x443c9b,limit:_0x429ed9,status:_0x476655,method:_0x337711,network:_0x1f2c91,dateFrom:_0x41a277,dateTo:_0x3ab7de,periodFrom:_0x5537ca,periodTo:_0x4a740f}=_0x5d99bf,_0x2321f5=(_0x443c9b-0x1)*_0x429ed9;console['log']('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x5d99bf);const _0x3e4133={'shopId':_0xade2f8};_0x476655&&(_0x3e4133[_0x5f3dd3(0xbf)]=_0x476655[_0x5f3dd3(0xa6)](),console['log'](_0x5f3dd3(0xcf)+_0x476655[_0x5f3dd3(0xa6)]()));if(_0x337711)_0x3e4133[_0x5f3dd3(0x10e)]=_0x337711,console[_0x5f3dd3(0xec)](_0x5f3dd3(0xe6)+_0x337711);else _0x1f2c91&&(_0x3e4133['network']=_0x1f2c91,console[_0x5f3dd3(0xec)](_0x5f3dd3(0x87)+_0x1f2c91));if(_0x41a277||_0x3ab7de||_0x5537ca||_0x4a740f){_0x3e4133[_0x5f3dd3(0x72)]={};if(_0x5537ca){const _0x344d5a=new Date(_0x5537ca);_0x344d5a[_0x5f3dd3(0xc9)](0x0,0x0,0x0,0x0),_0x3e4133[_0x5f3dd3(0x72)]['gte']=_0x344d5a,console['log'](_0x5f3dd3(0xff)+_0x344d5a[_0x5f3dd3(0x6b)]());}else{if(_0x41a277){const _0x2b4249=new Date(_0x41a277);_0x2b4249['setHours'](0x0,0x0,0x0,0x0),_0x3e4133[_0x5f3dd3(0x72)][_0x5f3dd3(0x7d)]=_0x2b4249,console['log'](_0x5f3dd3(0xf1)+_0x2b4249[_0x5f3dd3(0x6b)]());}}if(_0x4a740f){const _0x12ed5b=new Date(_0x4a740f);_0x12ed5b['setHours'](0x17,0x3b,0x3b,0x3e7),_0x3e4133[_0x5f3dd3(0x72)][_0x5f3dd3(0x9e)]=_0x12ed5b,console[_0x5f3dd3(0xec)](_0x5f3dd3(0x8c)+_0x12ed5b[_0x5f3dd3(0x6b)]());}else{if(_0x3ab7de){const _0x2a09d4=new Date(_0x3ab7de);_0x2a09d4[_0x5f3dd3(0xc9)](0x17,0x3b,0x3b,0x3e7),_0x3e4133[_0x5f3dd3(0x72)]['lte']=_0x2a09d4,console['log'](_0x5f3dd3(0xa5)+_0x2a09d4[_0x5f3dd3(0x6b)]());}}}console[_0x5f3dd3(0xec)](_0x5f3dd3(0x75),JSON['stringify'](_0x3e4133,null,0x2));const [_0xdddd96,_0x4aae8c]=await Promise[_0x5f3dd3(0xbb)]([database_1[_0x5f3dd3(0xfd)][_0x5f3dd3(0xf6)][_0x5f3dd3(0x10c)]({'where':_0x3e4133,'skip':_0x2321f5,'take':_0x429ed9,'orderBy':{'createdAt':_0x5f3dd3(0x6d)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x5f3dd3(0xfd)]['payout'][_0x5f3dd3(0xcc)]({'where':_0x3e4133})]);return{'payouts':_0xdddd96[_0x5f3dd3(0xd9)](_0x2708d4=>{const _0x18fec7=_0x5f3dd3;let _0x12526e=null;switch(_0x2708d4[_0x18fec7(0x10e)]){case'polygon':_0x12526e=_0x2708d4[_0x18fec7(0x104)]['usdtPolygonWallet'];break;case _0x18fec7(0xed):_0x12526e=_0x2708d4[_0x18fec7(0x104)][_0x18fec7(0x79)];break;case _0x18fec7(0xd8):_0x12526e=_0x2708d4[_0x18fec7(0x104)][_0x18fec7(0xce)];break;case _0x18fec7(0xeb):_0x12526e=_0x2708d4[_0x18fec7(0x104)][_0x18fec7(0xa4)];break;}return{'id':_0x2708d4['id'],'amount':_0x2708d4[_0x18fec7(0x107)],'network':this[_0x18fec7(0x86)](_0x2708d4[_0x18fec7(0x10e)]),'wallet':_0x12526e,'status':_0x2708d4['status'],'txid':_0x2708d4[_0x18fec7(0xd1)],'notes':_0x2708d4['notes'],'periodFrom':_0x2708d4[_0x18fec7(0xe2)],'periodTo':_0x2708d4[_0x18fec7(0xac)],'createdAt':_0x2708d4[_0x18fec7(0x72)],'paidAt':_0x2708d4['paidAt']};}),'pagination':{'page':_0x443c9b,'limit':_0x429ed9,'total':_0x4aae8c,'totalPages':Math['ceil'](_0x4aae8c/_0x429ed9)}};}async['getPayoutById'](_0x405c97,_0x3808ec){const _0x1fec40=a53_0x23872e,_0x7d3e39=await database_1[_0x1fec40(0xfd)][_0x1fec40(0xf6)]['findFirst']({'where':{'id':_0x3808ec,'shopId':_0x405c97}});if(!_0x7d3e39)return null;return{'id':_0x7d3e39['id'],'amount':_0x7d3e39[_0x1fec40(0x107)],'network':_0x7d3e39['network'],'status':_0x7d3e39[_0x1fec40(0xbf)],'txid':_0x7d3e39[_0x1fec40(0xd1)],'notes':_0x7d3e39[_0x1fec40(0xe7)],'createdAt':_0x7d3e39['createdAt'],'paidAt':_0x7d3e39[_0x1fec40(0x10b)]};}async[a53_0x23872e(0x108)](_0x4e7ae1,_0x154069){const _0x37e5ab=a53_0x23872e,_0x188ae4=new Date();let _0x18940d;switch(_0x154069){case'7d':_0x18940d=new Date(_0x188ae4[_0x37e5ab(0xc7)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x37e5ab(0xb4):_0x18940d=new Date(_0x188ae4[_0x37e5ab(0xc7)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x37e5ab(0xb6):_0x18940d=new Date(_0x188ae4[_0x37e5ab(0xc7)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x18940d=new Date(_0x188ae4[_0x37e5ab(0xc7)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x44a039,_0x3f6f5b,_0x2a9e7b,_0x4b3171,_0x4880d0,_0x322104]=await Promise[_0x37e5ab(0xbb)]([database_1[_0x37e5ab(0xfd)][_0x37e5ab(0xf6)]['count']({'where':{'shopId':_0x4e7ae1,'createdAt':{'gte':_0x18940d}}}),database_1[_0x37e5ab(0xfd)][_0x37e5ab(0xf6)][_0x37e5ab(0xcc)]({'where':{'shopId':_0x4e7ae1,'status':_0x37e5ab(0x7b),'createdAt':{'gte':_0x18940d}}}),database_1[_0x37e5ab(0xfd)][_0x37e5ab(0xf6)][_0x37e5ab(0xcc)]({'where':{'shopId':_0x4e7ae1,'status':_0x37e5ab(0xfc),'createdAt':{'gte':_0x18940d}}}),database_1[_0x37e5ab(0xfd)]['payout']['count']({'where':{'shopId':_0x4e7ae1,'status':'REJECTED','createdAt':{'gte':_0x18940d}}}),database_1[_0x37e5ab(0xfd)]['payout'][_0x37e5ab(0x10c)]({'where':{'shopId':_0x4e7ae1,'createdAt':{'gte':_0x18940d}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default']['payout'][_0x37e5ab(0x10c)]({'where':{'shopId':_0x4e7ae1},'take':0xa,'orderBy':{'createdAt':_0x37e5ab(0x6d)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x27b5fe=_0x4880d0[_0x37e5ab(0xbc)]((_0x18f5ea,_0x554f84)=>_0x18f5ea+_0x554f84['amount'],0x0),_0x136f6e=_0x4880d0[_0x37e5ab(0x105)](_0x1dd93f=>_0x1dd93f['status']===_0x37e5ab(0x7b))[_0x37e5ab(0xbc)]((_0x3dc3ad,_0x268a77)=>_0x3dc3ad+_0x268a77[_0x37e5ab(0x107)],0x0),_0x441310=_0x4880d0[_0x37e5ab(0x105)](_0x5adf2a=>_0x5adf2a[_0x37e5ab(0xbf)]===_0x37e5ab(0xfc))['reduce']((_0xc16857,_0x3eb0f5)=>_0xc16857+_0x3eb0f5[_0x37e5ab(0x107)],0x0),_0x1db35c=_0x4880d0[_0x37e5ab(0xbc)]((_0x5aa92b,_0x3b4b3e)=>{const _0x5cfd1d=_0x37e5ab;return _0x5aa92b[_0x3b4b3e[_0x5cfd1d(0x10e)]]=(_0x5aa92b[_0x3b4b3e[_0x5cfd1d(0x10e)]]||0x0)+0x1,_0x5aa92b;},{}),_0x3757c0=_0x4880d0['reduce']((_0xfde9c7,_0x19c9d9)=>{const _0x337b29=_0x37e5ab;return _0xfde9c7[_0x19c9d9[_0x337b29(0xbf)]]=(_0xfde9c7[_0x19c9d9[_0x337b29(0xbf)]]||0x0)+0x1,_0xfde9c7;},{});return{'totalPayouts':_0x44a039,'completedPayouts':_0x3f6f5b,'pendingPayouts':_0x2a9e7b,'rejectedPayouts':_0x4b3171,'totalAmount':_0x27b5fe,'completedAmount':_0x136f6e,'pendingAmount':_0x441310,'payoutsByMethod':_0x1db35c,'payoutsByStatus':_0x3757c0,'recentPayouts':_0x322104[_0x37e5ab(0xd9)](_0x1c9ee1=>({'id':_0x1c9ee1['id'],'shopId':_0x4e7ae1,'amount':_0x1c9ee1[_0x37e5ab(0x107)],'method':_0x1c9ee1['network'],'status':_0x1c9ee1[_0x37e5ab(0xbf)],'txid':_0x1c9ee1[_0x37e5ab(0xd1)],'createdAt':_0x1c9ee1['createdAt'],'paidAt':_0x1c9ee1[_0x37e5ab(0x10b)]}))};}async[a53_0x23872e(0xef)](_0x42bebc){const _0x5c9c5b=a53_0x23872e;console['log'](_0x5c9c5b(0x77)+_0x42bebc+'...');const _0x5d0305=await database_1[_0x5c9c5b(0xfd)][_0x5c9c5b(0x104)][_0x5c9c5b(0xd6)]({'where':{'id':_0x42bebc},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5d0305)throw new Error(_0x5c9c5b(0x95));const _0x173c01=new Date(),_0x30158a=new Date(_0x173c01[_0x5c9c5b(0x6e)](),_0x173c01[_0x5c9c5b(0xaa)](),0x1),_0x75d9bf=new Date(_0x173c01[_0x5c9c5b(0x6e)](),_0x173c01[_0x5c9c5b(0xaa)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x554559=await database_1['default'][_0x5c9c5b(0xf6)][_0x5c9c5b(0x10f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x42bebc,'createdAt':{'gte':_0x30158a,'lte':_0x75d9bf},'status':_0x5c9c5b(0x7b)}}),_0x33c925=_0x554559['_sum'][_0x5c9c5b(0x107)]||0x0,_0x32d30a={'availableBalance':Math[_0x5c9c5b(0x94)](_0x5d0305[_0x5c9c5b(0x98)]*0x64)/0x64,'totalPaidOut':Math[_0x5c9c5b(0x94)](_0x5d0305[_0x5c9c5b(0x83)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x5d0305['balance']*0x64)/0x64,'thisMonth':Math[_0x5c9c5b(0x94)](_0x33c925*0x64)/0x64};return console[_0x5c9c5b(0xec)](_0x5c9c5b(0xb0)+_0x5d0305[_0x5c9c5b(0xe9)]+'\x20payout\x20statistics\x20calculated:'),console['log'](_0x5c9c5b(0x76)+_0x32d30a[_0x5c9c5b(0x8a)]+_0x5c9c5b(0x109)),console[_0x5c9c5b(0xec)](_0x5c9c5b(0xb8)+_0x32d30a['totalPaidOut']+_0x5c9c5b(0xf7)),console['log'](_0x5c9c5b(0xf0)+_0x32d30a['awaitingPayout']+_0x5c9c5b(0x109)),console['log'](_0x5c9c5b(0xde)+_0x32d30a[_0x5c9c5b(0xd3)]+_0x5c9c5b(0xab)),_0x32d30a;}[a53_0x23872e(0xb1)](_0x41b957){const _0x2b0f06=a53_0x23872e,_0x13de85={'test_gateway':_0x2b0f06(0x7e),'plisio':'Plisio','rapyd':_0x2b0f06(0xae),'noda':'Noda','cointopay':_0x2b0f06(0xdf),'klyme_eu':_0x2b0f06(0xf8),'klyme_gb':_0x2b0f06(0x9b),'klyme_de':'KLYME\x20DE'};return _0x13de85[_0x41b957]||_0x41b957;}async[a53_0x23872e(0x106)](_0x24aa10){const _0x58934a=a53_0x23872e;return this[_0x58934a(0xef)](_0x24aa10);}async[a53_0x23872e(0xea)](_0x38190a,_0x16d3ba){const _0x5675fe=a53_0x23872e,{page:_0x37b89f,limit:_0x4a9cd2,paymentId:_0x137b07}=_0x16d3ba,_0x8e8a70=(_0x37b89f-0x1)*_0x4a9cd2,_0x257944={'shopId':_0x38190a};_0x137b07&&(_0x257944['paymentId']=_0x137b07);const [_0x21b3c2,_0x20e61e]=await Promise[_0x5675fe(0xbb)]([database_1[_0x5675fe(0xfd)][_0x5675fe(0xf4)]['findMany']({'where':_0x257944,'skip':_0x8e8a70,'take':_0x4a9cd2,'orderBy':{'createdAt':_0x5675fe(0x6d)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x5675fe(0xfd)][_0x5675fe(0xf4)]['count']({'where':_0x257944})]);return{'logs':_0x21b3c2['map'](_0x430335=>({'id':_0x430335['id'],'paymentId':_0x430335[_0x5675fe(0x8b)],'shopId':_0x430335[_0x5675fe(0xfa)],'event':_0x430335[_0x5675fe(0x99)],'statusCode':_0x430335[_0x5675fe(0xfb)],'retryCount':_0x430335[_0x5675fe(0xc0)],'responseBody':_0x430335['responseBody'],'createdAt':_0x430335[_0x5675fe(0x72)],'payment':_0x430335[_0x5675fe(0xb7)]})),'pagination':{'page':_0x37b89f,'limit':_0x4a9cd2,'total':_0x20e61e,'totalPages':Math[_0x5675fe(0xba)](_0x20e61e/_0x4a9cd2)}};}async[a53_0x23872e(0x6f)](_0x280414,_0x2dfd4d){const _0x879a78=a53_0x23872e,_0x570e4b=new Date();let _0x170e7c;switch(_0x2dfd4d){case'7d':_0x170e7c=new Date(_0x570e4b[_0x879a78(0xc7)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x879a78(0xb4):_0x170e7c=new Date(_0x570e4b[_0x879a78(0xc7)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x879a78(0xb6):_0x170e7c=new Date(_0x570e4b[_0x879a78(0xc7)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x170e7c=new Date(_0x570e4b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4ebb27,_0x2f2e13,_0x440dec,_0x517d82,_0x5f426f]=await Promise['all']([database_1[_0x879a78(0xfd)][_0x879a78(0xb7)][_0x879a78(0xcc)]({'where':{'shopId':_0x280414,'gateway':{'not':_0x879a78(0xe5)},'createdAt':{'gte':_0x170e7c}}}),database_1['default']['payment']['count']({'where':{'shopId':_0x280414,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0x170e7c}}}),database_1['default'][_0x879a78(0xb7)][_0x879a78(0x10c)]({'where':{'shopId':_0x280414,'gateway':{'not':_0x879a78(0xe5)},'status':_0x879a78(0xf9),'createdAt':{'gte':_0x170e7c}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x879a78(0xb7)][_0x879a78(0x10c)]({'where':{'shopId':_0x280414,'gateway':{'not':_0x879a78(0xe5)}},'take':0xa,'orderBy':{'createdAt':_0x879a78(0x6d)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x879a78(0xfd)][_0x879a78(0xb7)][_0x879a78(0x10c)]({'where':{'shopId':_0x280414,'gateway':{'not':_0x879a78(0xe5)},'createdAt':{'gte':_0x170e7c}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x879a78(0xb9)}})]);let _0x4dffcb=0x0;for(const _0x45ec63 of _0x440dec){if(_0x45ec63[_0x879a78(0x8d)])_0x4dffcb+=_0x45ec63[_0x879a78(0x8d)];else{const _0x5a2dc0=await currencyService_1[_0x879a78(0xe0)][_0x879a78(0x69)](_0x45ec63[_0x879a78(0x107)],_0x45ec63[_0x879a78(0xa8)]);_0x4dffcb+=_0x5a2dc0;}}const _0x2f385d=this[_0x879a78(0xee)](_0x5f426f,_0x170e7c,_0x570e4b),_0xc107eb=_0x4ebb27>0x0?_0x2f2e13/_0x4ebb27*0x64:0x0;return{'totalPayments':_0x4ebb27,'successfulPayments':_0x2f2e13,'totalRevenue':Math[_0x879a78(0x94)](_0x4dffcb*0x64)/0x64,'conversionRate':Math[_0x879a78(0x94)](_0xc107eb*0x64)/0x64,'dailyRevenue':_0x2f385d[_0x879a78(0x91)],'dailyPayments':_0x2f385d[_0x879a78(0x101)],'recentPayments':_0x517d82[_0x879a78(0xd9)](_0x4e2fe9=>({'id':_0x4e2fe9['id'],'gateway':_0x4e2fe9[_0x879a78(0xb2)],'amount':_0x4e2fe9[_0x879a78(0x107)],'currency':_0x4e2fe9[_0x879a78(0xa8)],'status':_0x4e2fe9[_0x879a78(0xbf)],'createdAt':_0x4e2fe9[_0x879a78(0x72)]}))};}[a53_0x23872e(0xee)](_0x467fbe,_0x2b73e9,_0x54c62f){const _0x1cce75=a53_0x23872e,_0x58215d=new Map(),_0x5ac536=new Date(_0x2b73e9);while(_0x5ac536<=_0x54c62f){const _0x500486=_0x5ac536[_0x1cce75(0x6b)]()[_0x1cce75(0xd7)]('T')[0x0];_0x58215d[_0x1cce75(0x74)](_0x500486,{'revenue':0x0,'count':0x0}),_0x5ac536['setDate'](_0x5ac536['getDate']()+0x1);}for(const _0x2109b5 of _0x467fbe){const _0xeaed5d=_0x2109b5[_0x1cce75(0x72)][_0x1cce75(0x6b)]()[_0x1cce75(0xd7)]('T')[0x0],_0x180a96=_0x58215d['get'](_0xeaed5d);_0x180a96&&(_0x180a96[_0x1cce75(0xcc)]+=0x1,_0x2109b5['status']===_0x1cce75(0xf9)&&_0x2109b5[_0x1cce75(0x8d)]&&(_0x180a96['revenue']+=_0x2109b5[_0x1cce75(0x8d)]));}const _0x3d5b83=[],_0x35d0af=[];for(const [_0x5ba74a,_0x132076]of _0x58215d){_0x3d5b83[_0x1cce75(0x111)]({'date':_0x5ba74a,'amount':Math[_0x1cce75(0x94)](_0x132076[_0x1cce75(0xd4)]*0x64)/0x64}),_0x35d0af[_0x1cce75(0x111)]({'date':_0x5ba74a,'count':_0x132076['count']});}return{'dailyRevenue':_0x3d5b83,'dailyPayments':_0x35d0af};}}exports['ShopService']=ShopService;