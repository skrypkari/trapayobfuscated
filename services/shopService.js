'use strict';const a86_0xf0bd72=a86_0x56ff;(function(_0x5303e9,_0x364ca3){const _0x19e06c=a86_0x56ff,_0x48801f=_0x5303e9();while(!![]){try{const _0x2dba1b=-parseInt(_0x19e06c(0x272))/0x1*(parseInt(_0x19e06c(0x237))/0x2)+parseInt(_0x19e06c(0x256))/0x3+-parseInt(_0x19e06c(0x295))/0x4+-parseInt(_0x19e06c(0x249))/0x5*(-parseInt(_0x19e06c(0x28d))/0x6)+parseInt(_0x19e06c(0x1d4))/0x7*(parseInt(_0x19e06c(0x283))/0x8)+parseInt(_0x19e06c(0x245))/0x9+-parseInt(_0x19e06c(0x238))/0xa;if(_0x2dba1b===_0x364ca3)break;else _0x48801f['push'](_0x48801f['shift']());}catch(_0x35ec77){_0x48801f['push'](_0x48801f['shift']());}}}(a86_0x3be0,0xa3a9d));var __importDefault=this&&this[a86_0xf0bd72(0x278)]||function(_0x2e2fd1){const _0x1f1ae7=a86_0xf0bd72;return _0x2e2fd1&&_0x2e2fd1[_0x1f1ae7(0x26b)]?_0x2e2fd1:{'default':_0x2e2fd1};};function a86_0x56ff(_0x10594c,_0x11fc67){_0x10594c=_0x10594c-0x1bd;const _0x3be0a3=a86_0x3be0();let _0x56ff93=_0x3be0a3[_0x10594c];return _0x56ff93;}function a86_0x3be0(){const _0x3eaccc=['\x20\x20\x20â³\x20Awaiting\x20payout:\x20','KLYME\x20EU','test','status','verify','get','this_week','statusText','merchantUrl','filter','periodTo','Payment\x20not\x20found','USDC\x20Polygon','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','map','181144uCZAEt','4965910LxbcGC','trc20','yesterday','\x20payout\x20statistics\x20calculated:','fullName','ðŸ“Š\x20Final\x20WHERE\x20conditions:','webhookLog','paymentGateways','includes','./paymentService','thisMonth','retryCount','PAID','11110104SAxKFI','getPayments','ðŸ“…\x20Date\x20end:\x20','gateway','762985eLRjOT','getMonth','ðŸ“…\x20Date\x20start:\x20','getTime','bcryptjs','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','generateBackupCodes','ðŸ“Š\x20Shop\x20','getShopProfile','USDT\x20ERC20','...','../types/gateway','createdAt','410676hdtlNi','toString','enable2FA','amountUSDT','round','updateWallets','REJECTED','KLYME\x20DE','Test\x20webhook\x20sent\x20successfully\x20(','usdcErcWallet','disable2FA','getPaymentById','ShopService','test_payment_123','COMPLETED','usdtErcWallet','telegramId','paid','set','UTC','getDate','__esModule','createPublicPayment','statusCode','this_month','USDT\x20BSC','revenue','formatNetworkName','3plENtA','2FA\x20token\x20is\x20required','ðŸŒ\x20Method\x20filter:\x20','erc20','settings','polygon_usdc','__importDefault','amount','last_month','setUTCDate','Invalid\x202FA\x20token','usdtPolygonWallet','Rapyd','90d','awaitingPayout','error','getUTCDay','4847424GsmOFE','getPayoutStats','availableBalance','qrcode','balance','gatewaySettings','USDC\x20Ethereum','CoinToPay','sha256','ðŸ’°\x20Getting\x20payouts\x20with\x20filters:','6XfkgCh','parse','today','AVAILABLE_GATEWAYS','Failed\x20to\x20send\x20webhook:\x20','Error\x20parsing\x20webhook\x20events:','findUnique','paidAt','5188516PtuDTG','message','USD','toLowerCase','toUpperCase','language','notes','paymentService','usdcPolygonWallet','getStatistics','getUTCFullYear','default','shop','update','all','ðŸ“…\x20Custom\x20period:\x20','../config/database','2FA\x20is\x20already\x20enabled','\x20USDT\x20(current\x20balance)','PENDING','TrapaPay\x20(','findFirst','_sum','Shop\x20not\x20found','findMany','network','ðŸ”‘\x20Generated\x20','Invalid\x202FA\x20token\x20or\x20backup\x20code','getPayoutById','username','wallets','isArray','split','application/json','setDate','count',',\x20dateFrom:\x20','secretKey','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','14GyZEPC','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','customerName','payout','hex','log','redirectUrl','generateSecret','No\x20webhook\x20URL\x20configured','test_gateway','compare','ðŸ“…\x20Custom\x20date\x20range:\x20','twoFactorEnabled','PaymentService','erc20_usdc','deletePayment','custom_','shopUrl','USDT\x20Polygon','createHmac','responseBody','ðŸ“Š\x20Status\x20filter:\x20','telegram','testWebhook','createPayment','webhookUrl','periodFrom','twoFactorSecret','\x20backup\x20codes','shopId','name','toDataURL','\x20to\x20','splice','dailyPayments','Payment\x20System/1.0\x20(Test)','usdtTrcWallet','\x20USDT','event','test_order_123','crypto','Unknown\x20error','generateDailyStatistics','currency','backupCodes','convertToUSDT','POST','getUTCMonth','webhookEvents','reduce','stringify','txid','startsWith','setHours','\x20USDT\x20(total\x20payouts)','getUTCDate','push','paymentId','ceil','./currencyService','toISOString','asc','ðŸ“…\x20Period\x20start:\x20','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','Test\x20Gateway','getFullYear','base32','gateways','dailyRevenue','twoFactorToken','publicKey','ðŸ“…\x20Final\x20date\x20range:\x20','totp','lte','aggregate','totalPaidOut','ðŸ“Š\x20Getting\x20statistics\x20for\x20shop\x20','desc','amountAfterGatewayCommissionUSDT','payment','getShopPayoutStats','updateShopProfile','KLYME\x20GB','defineProperty'];a86_0x3be0=function(){return _0x3eaccc;};return a86_0x3be0();}Object[a86_0xf0bd72(0x227)](exports,a86_0xf0bd72(0x26b),{'value':!![]}),exports[a86_0xf0bd72(0x262)]=void 0x0;const database_1=__importDefault(require(a86_0xf0bd72(0x1bd))),bcryptjs_1=__importDefault(require(a86_0xf0bd72(0x24d))),crypto_1=__importDefault(require(a86_0xf0bd72(0x1fc))),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a86_0xf0bd72(0x286))),currencyService_1=require(a86_0xf0bd72(0x20f)),paymentService_1=require(a86_0xf0bd72(0x241)),gateway_1=require(a86_0xf0bd72(0x254));class ShopService{constructor(){const _0x19ee3e=a86_0xf0bd72;this['paymentService']=new paymentService_1[(_0x19ee3e(0x1e1))]();}async[a86_0xf0bd72(0x251)](_0xa8d6){const _0x52b0ee=a86_0xf0bd72,_0x41278c=await database_1[_0x52b0ee(0x2a0)][_0x52b0ee(0x2a1)][_0x52b0ee(0x293)]({'where':{'id':_0xa8d6},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x41278c)throw new Error('Shop\x20not\x20found');let _0x4c8b83=[];if(_0x41278c['settings']?.[_0x52b0ee(0x204)])try{_0x4c8b83=Array[_0x52b0ee(0x1cc)](_0x41278c[_0x52b0ee(0x276)][_0x52b0ee(0x204)])?_0x41278c['settings']['webhookEvents']:JSON[_0x52b0ee(0x28e)](_0x41278c[_0x52b0ee(0x276)]['webhookEvents']);}catch(_0xbbe773){console[_0x52b0ee(0x281)](_0x52b0ee(0x292),_0xbbe773),_0x4c8b83=[];}const _0x2ad55e=gateway_1[_0x52b0ee(0x290)][_0x52b0ee(0x231)](_0x220806=>_0x220806['isActive'])[_0x52b0ee(0x236)](_0x603556=>_0x603556[_0x52b0ee(0x1f2)]);let _0x4f4cf4=_0x41278c[_0x52b0ee(0x23f)]?JSON['parse'](_0x41278c[_0x52b0ee(0x23f)]):[];return Array[_0x52b0ee(0x1cc)](_0x4f4cf4)&&(_0x4f4cf4=_0x4f4cf4[_0x52b0ee(0x236)](_0x42b49e=>_0x42b49e['replace'](/\s+/g,'_')['toLowerCase']())[_0x52b0ee(0x231)](_0x351bc8=>_0x2ad55e[_0x52b0ee(0x240)](_0x351bc8))),{'id':_0x41278c['id'],'fullName':_0x41278c[_0x52b0ee(0x1f2)],'username':_0x41278c[_0x52b0ee(0x1ca)],'telegramId':_0x41278c[_0x52b0ee(0x1ea)],'merchantUrl':_0x41278c[_0x52b0ee(0x1e5)],'gateways':_0x4f4cf4,'gatewaySettings':_0x41278c[_0x52b0ee(0x288)]?JSON[_0x52b0ee(0x28e)](_0x41278c[_0x52b0ee(0x288)]):null,'publicKey':_0x41278c[_0x52b0ee(0x21a)],'secretKey':_0x41278c[_0x52b0ee(0x1d2)],'webhookUrl':_0x41278c[_0x52b0ee(0x276)]?.[_0x52b0ee(0x1ed)]||null,'webhookEvents':_0x4c8b83,'wallets':{'usdtPolygonWallet':_0x41278c[_0x52b0ee(0x27d)],'usdtTrcWallet':_0x41278c[_0x52b0ee(0x1f8)],'usdtErcWallet':_0x41278c[_0x52b0ee(0x265)],'usdcPolygonWallet':_0x41278c[_0x52b0ee(0x29d)],'usdcErcWallet':_0x41278c[_0x52b0ee(0x25f)]},'status':_0x41278c['status'],'createdAt':_0x41278c[_0x52b0ee(0x255)]};}async[a86_0xf0bd72(0x225)](_0x1e2c9f,_0x1a16b3){const _0x5b09f2=a86_0xf0bd72,_0x4427aa={};_0x1a16b3['fullName']&&(_0x4427aa[_0x5b09f2(0x1f2)]=_0x1a16b3[_0x5b09f2(0x23c)]);_0x1a16b3[_0x5b09f2(0x266)]!==undefined&&(_0x4427aa[_0x5b09f2(0x1ea)]=_0x1a16b3[_0x5b09f2(0x266)]||null);_0x1a16b3[_0x5b09f2(0x230)]&&(_0x4427aa[_0x5b09f2(0x1e5)]=_0x1a16b3[_0x5b09f2(0x230)]);_0x1a16b3[_0x5b09f2(0x217)]&&(_0x4427aa[_0x5b09f2(0x23f)]=JSON[_0x5b09f2(0x206)](_0x1a16b3[_0x5b09f2(0x217)]));_0x1a16b3[_0x5b09f2(0x288)]&&(_0x4427aa[_0x5b09f2(0x288)]=JSON[_0x5b09f2(0x206)](_0x1a16b3[_0x5b09f2(0x288)]));_0x1a16b3[_0x5b09f2(0x1cb)]&&(_0x1a16b3[_0x5b09f2(0x1cb)]['usdtPolygonWallet']!==undefined&&(_0x4427aa[_0x5b09f2(0x27d)]=_0x1a16b3[_0x5b09f2(0x1cb)][_0x5b09f2(0x27d)]||null),_0x1a16b3[_0x5b09f2(0x1cb)][_0x5b09f2(0x1f8)]!==undefined&&(_0x4427aa[_0x5b09f2(0x1f8)]=_0x1a16b3['wallets'][_0x5b09f2(0x1f8)]||null),_0x1a16b3[_0x5b09f2(0x1cb)][_0x5b09f2(0x265)]!==undefined&&(_0x4427aa[_0x5b09f2(0x265)]=_0x1a16b3['wallets'][_0x5b09f2(0x265)]||null),_0x1a16b3[_0x5b09f2(0x1cb)][_0x5b09f2(0x29d)]!==undefined&&(_0x4427aa['usdcPolygonWallet']=_0x1a16b3[_0x5b09f2(0x1cb)][_0x5b09f2(0x29d)]||null));const _0x5d9e0b=await database_1['default'][_0x5b09f2(0x2a1)][_0x5b09f2(0x2a2)]({'where':{'id':_0x1e2c9f},'data':_0x4427aa,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2199d2=[];if(_0x5d9e0b[_0x5b09f2(0x276)]?.[_0x5b09f2(0x204)])try{_0x2199d2=Array[_0x5b09f2(0x1cc)](_0x5d9e0b[_0x5b09f2(0x276)][_0x5b09f2(0x204)])?_0x5d9e0b[_0x5b09f2(0x276)][_0x5b09f2(0x204)]:JSON[_0x5b09f2(0x28e)](_0x5d9e0b[_0x5b09f2(0x276)][_0x5b09f2(0x204)]);}catch(_0x1b550a){console['error'](_0x5b09f2(0x292),_0x1b550a),_0x2199d2=[];}return{'id':_0x5d9e0b['id'],'fullName':_0x5d9e0b[_0x5b09f2(0x1f2)],'username':_0x5d9e0b[_0x5b09f2(0x1ca)],'telegramId':_0x5d9e0b[_0x5b09f2(0x1ea)],'merchantUrl':_0x5d9e0b[_0x5b09f2(0x1e5)],'gateways':_0x5d9e0b['paymentGateways']?JSON[_0x5b09f2(0x28e)](_0x5d9e0b[_0x5b09f2(0x23f)]):null,'gatewaySettings':_0x5d9e0b[_0x5b09f2(0x288)]?JSON[_0x5b09f2(0x28e)](_0x5d9e0b['gatewaySettings']):null,'publicKey':_0x5d9e0b[_0x5b09f2(0x21a)],'secretKey':_0x5d9e0b['secretKey'],'webhookUrl':_0x5d9e0b[_0x5b09f2(0x276)]?.[_0x5b09f2(0x1ed)]||null,'webhookEvents':_0x2199d2,'wallets':{'usdtPolygonWallet':_0x5d9e0b[_0x5b09f2(0x27d)],'usdtTrcWallet':_0x5d9e0b[_0x5b09f2(0x1f8)],'usdtErcWallet':_0x5d9e0b[_0x5b09f2(0x265)],'usdcPolygonWallet':_0x5d9e0b['usdcPolygonWallet'],'usdcErcWallet':_0x5d9e0b['usdcErcWallet']},'status':_0x5d9e0b['status'],'createdAt':_0x5d9e0b['createdAt']};}async[a86_0xf0bd72(0x25b)](_0xe8e435,_0x2f9aac){const _0x30d944=a86_0xf0bd72,_0x5624d0=await database_1[_0x30d944(0x2a0)][_0x30d944(0x2a1)][_0x30d944(0x293)]({'where':{'id':_0xe8e435},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x5624d0)throw new Error(_0x30d944(0x1c4));if(_0x5624d0['twoFactorEnabled']){if(!_0x2f9aac[_0x30d944(0x219)])throw new Error(_0x30d944(0x273));const _0x3907b7=speakeasy_1[_0x30d944(0x2a0)][_0x30d944(0x21c)][_0x30d944(0x22c)]({'secret':_0x5624d0[_0x30d944(0x1ef)],'encoding':_0x30d944(0x216),'token':_0x2f9aac[_0x30d944(0x219)],'window':0x2});if(!_0x3907b7){let _0x336714=![];if(_0x5624d0['backupCodes']){const _0x3034c3=JSON['parse'](_0x5624d0[_0x30d944(0x200)]);for(let _0x3f3fa4=0x0;_0x3f3fa4<_0x3034c3['length'];_0x3f3fa4++){const _0x4bea61=await bcryptjs_1[_0x30d944(0x2a0)][_0x30d944(0x1de)](_0x2f9aac[_0x30d944(0x219)],_0x3034c3[_0x3f3fa4]);if(_0x4bea61){_0x336714=!![],_0x3034c3[_0x30d944(0x1f5)](_0x3f3fa4,0x1),await database_1['default'][_0x30d944(0x2a1)][_0x30d944(0x2a2)]({'where':{'id':_0xe8e435},'data':{'backupCodes':JSON[_0x30d944(0x206)](_0x3034c3)}});break;}}}if(!_0x336714)throw new Error(_0x30d944(0x1c8));}}const _0x1fc7e5={};_0x2f9aac[_0x30d944(0x27d)]!==undefined&&(_0x1fc7e5[_0x30d944(0x27d)]=_0x2f9aac[_0x30d944(0x27d)]||null),_0x2f9aac['usdtTrcWallet']!==undefined&&(_0x1fc7e5['usdtTrcWallet']=_0x2f9aac[_0x30d944(0x1f8)]||null),_0x2f9aac[_0x30d944(0x265)]!==undefined&&(_0x1fc7e5['usdtErcWallet']=_0x2f9aac['usdtErcWallet']||null),_0x2f9aac[_0x30d944(0x29d)]!==undefined&&(_0x1fc7e5[_0x30d944(0x29d)]=_0x2f9aac[_0x30d944(0x29d)]||null),_0x2f9aac[_0x30d944(0x25f)]!==undefined&&(_0x1fc7e5[_0x30d944(0x25f)]=_0x2f9aac[_0x30d944(0x25f)]||null),await database_1[_0x30d944(0x2a0)][_0x30d944(0x2a1)][_0x30d944(0x2a2)]({'where':{'id':_0xe8e435},'data':_0x1fc7e5});}async[a86_0xf0bd72(0x1eb)](_0x1d1c35){const _0x35dc96=a86_0xf0bd72,_0x26272c=await database_1['default'][_0x35dc96(0x2a1)]['findUnique']({'where':{'id':_0x1d1c35},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x26272c?.[_0x35dc96(0x276)]?.[_0x35dc96(0x1ed)])throw new Error(_0x35dc96(0x1dc));const _0x10ea06={'event':_0x35dc96(0x22a),'payment':{'id':_0x35dc96(0x263),'order_id':_0x35dc96(0x1fb),'gateway':'test','amount':0x64,'currency':_0x35dc96(0x297),'status':_0x35dc96(0x267),'created_at':new Date()[_0x35dc96(0x210)]()}};try{const _0x2ddecc=JSON[_0x35dc96(0x206)](_0x10ea06),_0x1ea4ca=crypto_1[_0x35dc96(0x2a0)][_0x35dc96(0x1e7)](_0x35dc96(0x28b),_0x26272c[_0x35dc96(0x1d2)])[_0x35dc96(0x2a2)](_0x2ddecc)['digest'](_0x35dc96(0x1d8)),_0x1f48de=await fetch(_0x26272c['settings'][_0x35dc96(0x1ed)],{'method':_0x35dc96(0x202),'headers':{'Content-Type':_0x35dc96(0x1ce),'User-Agent':_0x35dc96(0x1f7),'X-Webhook-Signature':_0x1ea4ca},'body':_0x2ddecc});return _0x1f48de['ok']?{'success':!![],'message':_0x35dc96(0x25e)+_0x1f48de['status']+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x1f48de[_0x35dc96(0x22b)]+'\x20'+_0x1f48de[_0x35dc96(0x22f)]};}catch(_0x1cbeec){return{'success':![],'message':_0x35dc96(0x291)+(_0x1cbeec instanceof Error?_0x1cbeec[_0x35dc96(0x296)]:_0x35dc96(0x1fd))};}}async[a86_0xf0bd72(0x1ec)](_0x59daaa){const _0x5f56af=a86_0xf0bd72;return this['paymentService'][_0x5f56af(0x26c)]({'public_key':'','gateway':_0x59daaa[_0x5f56af(0x248)],'order_id':'','amount':_0x59daaa[_0x5f56af(0x279)],'currency':_0x59daaa[_0x5f56af(0x1ff)],'source_currency':_0x59daaa['sourceCurrency'],'success_url':_0x59daaa[_0x5f56af(0x1da)],'fail_url':_0x59daaa[_0x5f56af(0x1da)],'customer_email':_0x59daaa['customerEmail'],'customer_name':_0x59daaa[_0x5f56af(0x1d6)],'language':_0x59daaa[_0x5f56af(0x29a)]});}async[a86_0xf0bd72(0x246)](_0x5b6d4d,_0x33546d){const _0x3227b4=a86_0xf0bd72;return this[_0x3227b4(0x29c)]['getPaymentsByShop'](_0x5b6d4d,_0x33546d);}async[a86_0xf0bd72(0x261)](_0x2c0a48,_0x5a0ec8){const _0x15f6eb=a86_0xf0bd72;return this[_0x15f6eb(0x29c)]['getPaymentByShopAndId'](_0x2c0a48,_0x5a0ec8);}async['updatePayment'](_0x589b51,_0x29db76,_0x3a0e6e){const _0x53d0aa=a86_0xf0bd72,_0x4efef2=await database_1['default'][_0x53d0aa(0x223)][_0x53d0aa(0x1c2)]({'where':{'id':_0x29db76,'shopId':_0x589b51}});if(!_0x4efef2)throw new Error(_0x53d0aa(0x233));const _0x2c86d3=await database_1[_0x53d0aa(0x2a0)][_0x53d0aa(0x223)]['update']({'where':{'id':_0x29db76},'data':{..._0x3a0e6e,'updatedAt':new Date()}});return _0x2c86d3;}async[a86_0xf0bd72(0x1e3)](_0x1350f2,_0x4673f4){const _0x4c5913=a86_0xf0bd72,_0xc00c65=await database_1[_0x4c5913(0x2a0)][_0x4c5913(0x223)][_0x4c5913(0x1c2)]({'where':{'id':_0x4673f4,'shopId':_0x1350f2}});if(!_0xc00c65)throw new Error(_0x4c5913(0x233));await database_1[_0x4c5913(0x2a0)][_0x4c5913(0x223)]['delete']({'where':{'id':_0x4673f4}});}[a86_0xf0bd72(0x271)](_0x10b52f){const _0x2b9dfa=a86_0xf0bd72,_0x2930cf={'polygon':_0x2b9dfa(0x1e6),'trc20':'USDT\x20TRC20','erc20':_0x2b9dfa(0x252),'bsc':_0x2b9dfa(0x26f),'polygon_usdc':_0x2b9dfa(0x234),'erc20_usdc':_0x2b9dfa(0x289)};return _0x2930cf[_0x10b52f]||_0x10b52f;}async['getPayouts'](_0x1b7e0b,_0x45d0c8){const _0x36cddf=a86_0xf0bd72,{page:_0x1a9230,limit:_0x4d75b5,status:_0x4df654,method:_0x257317,network:_0x450b57,dateFrom:_0x5565c1,dateTo:_0x439beb,periodFrom:_0x5aeb71,periodTo:_0x26a279}=_0x45d0c8,_0x510029=(_0x1a9230-0x1)*_0x4d75b5;console[_0x36cddf(0x1d9)](_0x36cddf(0x28c),_0x45d0c8);const _0x85894c={'shopId':_0x1b7e0b};_0x4df654&&(_0x85894c[_0x36cddf(0x22b)]=_0x4df654['toUpperCase'](),console[_0x36cddf(0x1d9)](_0x36cddf(0x1e9)+_0x4df654[_0x36cddf(0x299)]()));if(_0x257317)_0x85894c[_0x36cddf(0x1c6)]=_0x257317,console[_0x36cddf(0x1d9)](_0x36cddf(0x274)+_0x257317);else _0x450b57&&(_0x85894c[_0x36cddf(0x1c6)]=_0x450b57,console[_0x36cddf(0x1d9)]('ðŸŒ\x20Network\x20filter:\x20'+_0x450b57));if(_0x5565c1||_0x439beb||_0x5aeb71||_0x26a279){_0x85894c[_0x36cddf(0x255)]={};if(_0x5aeb71){const _0x20c074=new Date(_0x5aeb71);_0x20c074[_0x36cddf(0x209)](0x0,0x0,0x0,0x1),_0x85894c[_0x36cddf(0x255)]['gte']=_0x20c074,console['log'](_0x36cddf(0x212)+_0x20c074[_0x36cddf(0x210)]());}else{if(_0x5565c1){const _0x285749=new Date(_0x5565c1);_0x285749[_0x36cddf(0x209)](0x0,0x0,0x0,0x1),_0x85894c[_0x36cddf(0x255)]['gte']=_0x285749,console[_0x36cddf(0x1d9)](_0x36cddf(0x24b)+_0x285749[_0x36cddf(0x210)]());}}if(_0x26a279){const _0x5f548c=new Date(_0x26a279);_0x5f548c[_0x36cddf(0x209)](0x17,0x3b,0x3b,0x3e7),_0x85894c[_0x36cddf(0x255)]['lte']=_0x5f548c,console[_0x36cddf(0x1d9)]('ðŸ“…\x20Period\x20end:\x20'+_0x5f548c[_0x36cddf(0x210)]());}else{if(_0x439beb){const _0x1b222d=new Date(_0x439beb);_0x1b222d['setHours'](0x17,0x3b,0x3b,0x3e7),_0x85894c[_0x36cddf(0x255)][_0x36cddf(0x21d)]=_0x1b222d,console['log'](_0x36cddf(0x247)+_0x1b222d[_0x36cddf(0x210)]());}}}console[_0x36cddf(0x1d9)](_0x36cddf(0x23d),JSON['stringify'](_0x85894c,null,0x2));const [_0x3fc5df,_0x170a27]=await Promise[_0x36cddf(0x2a3)]([database_1[_0x36cddf(0x2a0)][_0x36cddf(0x1d7)]['findMany']({'where':_0x85894c,'skip':_0x510029,'take':_0x4d75b5,'orderBy':{'createdAt':_0x36cddf(0x221)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x36cddf(0x2a0)][_0x36cddf(0x1d7)][_0x36cddf(0x1d0)]({'where':_0x85894c})]);return{'payouts':_0x3fc5df['map'](_0xac9cee=>{const _0x2baefa=_0x36cddf;let _0x2c9e58=null;switch(_0xac9cee['network']){case'polygon':_0x2c9e58=_0xac9cee[_0x2baefa(0x2a1)][_0x2baefa(0x27d)];break;case _0x2baefa(0x239):_0x2c9e58=_0xac9cee[_0x2baefa(0x2a1)][_0x2baefa(0x1f8)];break;case _0x2baefa(0x275):_0x2c9e58=_0xac9cee[_0x2baefa(0x2a1)]['usdtErcWallet'];break;case _0x2baefa(0x277):_0x2c9e58=_0xac9cee[_0x2baefa(0x2a1)][_0x2baefa(0x29d)];break;case _0x2baefa(0x1e2):_0x2c9e58=_0xac9cee[_0x2baefa(0x2a1)][_0x2baefa(0x25f)];break;}return{'id':_0xac9cee['id'],'amount':_0xac9cee[_0x2baefa(0x279)],'network':this[_0x2baefa(0x271)](_0xac9cee[_0x2baefa(0x1c6)]),'wallet':_0x2c9e58,'status':_0xac9cee[_0x2baefa(0x22b)],'txid':_0xac9cee[_0x2baefa(0x207)],'notes':_0xac9cee['notes'],'periodFrom':_0xac9cee[_0x2baefa(0x1ee)],'periodTo':_0xac9cee[_0x2baefa(0x232)],'createdAt':_0xac9cee[_0x2baefa(0x255)],'paidAt':_0xac9cee[_0x2baefa(0x294)]};}),'pagination':{'page':_0x1a9230,'limit':_0x4d75b5,'total':_0x170a27,'totalPages':Math[_0x36cddf(0x20e)](_0x170a27/_0x4d75b5)}};}async[a86_0xf0bd72(0x1c9)](_0x2bc38c,_0x4f59de){const _0x1cc0a4=a86_0xf0bd72,_0x21454e=await database_1[_0x1cc0a4(0x2a0)]['payout'][_0x1cc0a4(0x1c2)]({'where':{'id':_0x4f59de,'shopId':_0x2bc38c}});if(!_0x21454e)return null;return{'id':_0x21454e['id'],'amount':_0x21454e[_0x1cc0a4(0x279)],'network':_0x21454e[_0x1cc0a4(0x1c6)],'status':_0x21454e['status'],'txid':_0x21454e[_0x1cc0a4(0x207)],'notes':_0x21454e[_0x1cc0a4(0x29b)],'createdAt':_0x21454e[_0x1cc0a4(0x255)],'paidAt':_0x21454e[_0x1cc0a4(0x294)]};}async['getPayoutStatistics'](_0xe4d2bd,_0x446682){const _0x326094=a86_0xf0bd72,_0x1c1a44=new Date();let _0x2387e2,_0x257b21;switch(_0x446682){case _0x326094(0x23a):case'YESTERDAY':const _0x52de1b=new Date(_0x1c1a44);_0x52de1b[_0x326094(0x1cf)](_0x52de1b[_0x326094(0x26a)]()-0x1),_0x2387e2=new Date(_0x52de1b),_0x2387e2[_0x326094(0x209)](0x0,0x0,0x0,0x0),_0x257b21=new Date(_0x52de1b),_0x257b21[_0x326094(0x209)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x2387e2=new Date(_0x1c1a44[_0x326094(0x24c)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2387e2=new Date(_0x1c1a44['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x326094(0x27f):_0x2387e2=new Date(_0x1c1a44[_0x326094(0x24c)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2387e2=new Date(_0x1c1a44[_0x326094(0x24c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x1b08c3={'gte':_0x2387e2};_0x257b21&&(_0x1b08c3['lte']=_0x257b21);const [_0x59a71,_0x282097,_0xff716,_0x27fcbe,_0x43bdb1,_0x8bae1a]=await Promise[_0x326094(0x2a3)]([database_1[_0x326094(0x2a0)]['payout']['count']({'where':{'shopId':_0xe4d2bd,'createdAt':_0x1b08c3}}),database_1[_0x326094(0x2a0)][_0x326094(0x1d7)][_0x326094(0x1d0)]({'where':{'shopId':_0xe4d2bd,'status':_0x326094(0x264),'createdAt':_0x1b08c3}}),database_1[_0x326094(0x2a0)][_0x326094(0x1d7)][_0x326094(0x1d0)]({'where':{'shopId':_0xe4d2bd,'status':_0x326094(0x1c0),'createdAt':_0x1b08c3}}),database_1[_0x326094(0x2a0)][_0x326094(0x1d7)][_0x326094(0x1d0)]({'where':{'shopId':_0xe4d2bd,'status':_0x326094(0x25c),'createdAt':_0x1b08c3}}),database_1[_0x326094(0x2a0)][_0x326094(0x1d7)]['findMany']({'where':{'shopId':_0xe4d2bd,'createdAt':_0x1b08c3},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x326094(0x1d7)]['findMany']({'where':{'shopId':_0xe4d2bd},'take':0xa,'orderBy':{'createdAt':_0x326094(0x221)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x425f4=_0x43bdb1[_0x326094(0x205)]((_0x1e0bd7,_0x2671fc)=>_0x1e0bd7+_0x2671fc['amount'],0x0),_0x6773c=_0x43bdb1[_0x326094(0x231)](_0x5a92b1=>_0x5a92b1[_0x326094(0x22b)]===_0x326094(0x264))['reduce']((_0xd4c5bf,_0xa3aced)=>_0xd4c5bf+_0xa3aced[_0x326094(0x279)],0x0),_0x5eafa3=_0x43bdb1[_0x326094(0x231)](_0x60d2de=>_0x60d2de[_0x326094(0x22b)]===_0x326094(0x1c0))[_0x326094(0x205)]((_0x5ea65b,_0x16d118)=>_0x5ea65b+_0x16d118['amount'],0x0),_0x3aa6bf=_0x43bdb1[_0x326094(0x205)]((_0x4aedd8,_0x40c8e2)=>{const _0x2a166f=_0x326094;return _0x4aedd8[_0x40c8e2[_0x2a166f(0x1c6)]]=(_0x4aedd8[_0x40c8e2[_0x2a166f(0x1c6)]]||0x0)+0x1,_0x4aedd8;},{}),_0x3c0c26=_0x43bdb1[_0x326094(0x205)]((_0x24c471,_0x2e34e3)=>{const _0x510f3f=_0x326094;return _0x24c471[_0x2e34e3[_0x510f3f(0x22b)]]=(_0x24c471[_0x2e34e3['status']]||0x0)+0x1,_0x24c471;},{});return{'totalPayouts':_0x59a71,'completedPayouts':_0x282097,'pendingPayouts':_0xff716,'rejectedPayouts':_0x27fcbe,'totalAmount':_0x425f4,'completedAmount':_0x6773c,'pendingAmount':_0x5eafa3,'payoutsByMethod':_0x3aa6bf,'payoutsByStatus':_0x3c0c26,'recentPayouts':_0x8bae1a['map'](_0x332106=>({'id':_0x332106['id'],'shopId':_0xe4d2bd,'amount':_0x332106['amount'],'method':_0x332106[_0x326094(0x1c6)],'status':_0x332106[_0x326094(0x22b)],'txid':_0x332106[_0x326094(0x207)],'createdAt':_0x332106['createdAt'],'paidAt':_0x332106[_0x326094(0x294)]}))};}async['getShopPayoutStats'](_0x1d2b44){const _0x3b8543=a86_0xf0bd72;console[_0x3b8543(0x1d9)]('ðŸ“Š\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x1d2b44+_0x3b8543(0x253));const _0x20e8e3=await database_1['default'][_0x3b8543(0x2a1)][_0x3b8543(0x293)]({'where':{'id':_0x1d2b44},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x20e8e3)throw new Error(_0x3b8543(0x1c4));const _0xefdd6a=new Date(),_0x4287a2=new Date(_0xefdd6a['getFullYear'](),_0xefdd6a[_0x3b8543(0x24a)](),0x1),_0x33deab=new Date(_0xefdd6a[_0x3b8543(0x215)](),_0xefdd6a['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x218a13=await database_1['default']['payout'][_0x3b8543(0x21e)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1d2b44,'createdAt':{'gte':_0x4287a2,'lte':_0x33deab},'status':_0x3b8543(0x264)}}),_0x3dd29f=_0x218a13[_0x3b8543(0x1c3)][_0x3b8543(0x279)]||0x0,_0x632f41={'availableBalance':Math[_0x3b8543(0x25a)](_0x20e8e3[_0x3b8543(0x287)]*0x64)/0x64,'totalPaidOut':Math[_0x3b8543(0x25a)](_0x20e8e3[_0x3b8543(0x21f)]*0x64)/0x64,'awaitingPayout':Math[_0x3b8543(0x25a)](_0x20e8e3[_0x3b8543(0x287)]*0x64)/0x64,'thisMonth':Math['round'](_0x3dd29f*0x64)/0x64};return console[_0x3b8543(0x1d9)](_0x3b8543(0x250)+_0x20e8e3[_0x3b8543(0x1ca)]+_0x3b8543(0x23b)),console[_0x3b8543(0x1d9)]('\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20'+_0x632f41[_0x3b8543(0x285)]+'\x20USDT\x20(current\x20balance)'),console[_0x3b8543(0x1d9)]('\x20\x20\x20ðŸ’°\x20Total\x20paid\x20out:\x20'+_0x632f41[_0x3b8543(0x21f)]+_0x3b8543(0x20a)),console[_0x3b8543(0x1d9)](_0x3b8543(0x228)+_0x632f41[_0x3b8543(0x280)]+_0x3b8543(0x1bf)),console['log'](_0x3b8543(0x213)+_0x632f41[_0x3b8543(0x242)]+_0x3b8543(0x1f9)),_0x632f41;}['getGatewayDisplayName'](_0x35bd1e){const _0x21aa29=a86_0xf0bd72,_0x329f42={'test_gateway':_0x21aa29(0x214),'plisio':'Plisio','rapyd':_0x21aa29(0x27e),'noda':'Noda','cointopay':_0x21aa29(0x28a),'klyme_eu':_0x21aa29(0x229),'klyme_gb':_0x21aa29(0x226),'klyme_de':_0x21aa29(0x25d)};return _0x329f42[_0x35bd1e]||_0x35bd1e;}async[a86_0xf0bd72(0x284)](_0x57949f){const _0x2a8a96=a86_0xf0bd72;return this[_0x2a8a96(0x224)](_0x57949f);}async['getWebhookLogs'](_0x36f783,_0x352e6e){const _0xb571a1=a86_0xf0bd72,{page:_0x138b5f,limit:_0x2c5390,paymentId:_0x42c76c}=_0x352e6e,_0x1eb48a=(_0x138b5f-0x1)*_0x2c5390,_0x3e5ec9={'shopId':_0x36f783};_0x42c76c&&(_0x3e5ec9['paymentId']=_0x42c76c);const [_0x47ecaf,_0x3bd7db]=await Promise[_0xb571a1(0x2a3)]([database_1[_0xb571a1(0x2a0)][_0xb571a1(0x23e)][_0xb571a1(0x1c5)]({'where':_0x3e5ec9,'skip':_0x1eb48a,'take':_0x2c5390,'orderBy':{'createdAt':_0xb571a1(0x221)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0xb571a1(0x2a0)][_0xb571a1(0x23e)][_0xb571a1(0x1d0)]({'where':_0x3e5ec9})]);return{'logs':_0x47ecaf['map'](_0x493da0=>({'id':_0x493da0['id'],'paymentId':_0x493da0[_0xb571a1(0x20d)],'shopId':_0x493da0[_0xb571a1(0x1f1)],'event':_0x493da0[_0xb571a1(0x1fa)],'statusCode':_0x493da0[_0xb571a1(0x26d)],'retryCount':_0x493da0[_0xb571a1(0x243)],'responseBody':_0x493da0[_0xb571a1(0x1e8)],'createdAt':_0x493da0['createdAt'],'payment':_0x493da0['payment']})),'pagination':{'page':_0x138b5f,'limit':_0x2c5390,'total':_0x3bd7db,'totalPages':Math['ceil'](_0x3bd7db/_0x2c5390)}};}async[a86_0xf0bd72(0x29e)](_0xc0f7b5,_0x4d6cc7,_0x2ca705,_0x551c7c,_0x3b4c77){const _0x48a32b=a86_0xf0bd72;console[_0x48a32b(0x1d9)](_0x48a32b(0x220)+_0xc0f7b5+',\x20period:\x20'+_0x4d6cc7+_0x48a32b(0x1d1)+_0x2ca705+',\x20dateTo:\x20'+_0x551c7c);const _0x4e751a=_0x3b4c77?new Date(_0x3b4c77):new Date();let _0x5ae77b,_0x2ada5c;if(_0x2ca705&&_0x551c7c){const _0x148f89=new Date(_0x2ca705),_0x586172=new Date(_0x551c7c);_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x148f89['getUTCFullYear'](),_0x148f89['getUTCMonth'](),_0x148f89[_0x48a32b(0x20b)](),0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date[_0x48a32b(0x269)](_0x586172[_0x48a32b(0x29f)](),_0x586172[_0x48a32b(0x203)](),_0x586172[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7)),console[_0x48a32b(0x1d9)](_0x48a32b(0x1df)+_0x5ae77b['toISOString']()+_0x48a32b(0x1f4)+_0x2ada5c[_0x48a32b(0x210)]());}else{if(_0x4d6cc7&&_0x4d6cc7[_0x48a32b(0x208)](_0x48a32b(0x1e4))){const _0x14c316=_0x4d6cc7['replace'](_0x48a32b(0x1e4),'')['split']('_');if(_0x14c316['length']===0x2){const _0x318863=new Date(_0x14c316[0x0]),_0x45a0d1=new Date(_0x14c316[0x1]);_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x318863[_0x48a32b(0x29f)](),_0x318863['getUTCMonth'](),_0x318863[_0x48a32b(0x20b)](),0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date['UTC'](_0x45a0d1['getUTCFullYear'](),_0x45a0d1['getUTCMonth'](),_0x45a0d1[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7)),console[_0x48a32b(0x1d9)](_0x48a32b(0x2a4)+_0x5ae77b[_0x48a32b(0x210)]()+_0x48a32b(0x1f4)+_0x2ada5c[_0x48a32b(0x210)]());}else{const _0x36a8fd=new Date(Date[_0x48a32b(0x269)](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)](),_0x4e751a[_0x48a32b(0x20b)]()-0x1e));_0x5ae77b=new Date(Date['UTC'](_0x36a8fd[_0x48a32b(0x29f)](),_0x36a8fd['getUTCMonth'](),_0x36a8fd['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date['UTC'](_0x4e751a['getUTCFullYear'](),_0x4e751a['getUTCMonth'](),_0x4e751a['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x25a2cf=_0x4d6cc7||_0x48a32b(0x26e);switch(_0x25a2cf[_0x48a32b(0x298)]()){case _0x48a32b(0x28f):_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)](),_0x4e751a['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date['UTC'](_0x4e751a['getUTCFullYear'](),_0x4e751a[_0x48a32b(0x203)](),_0x4e751a[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48a32b(0x23a):const _0x1285c8=new Date(_0x4e751a);_0x1285c8[_0x48a32b(0x27b)](_0x1285c8[_0x48a32b(0x20b)]()-0x1),_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x1285c8[_0x48a32b(0x29f)](),_0x1285c8[_0x48a32b(0x203)](),_0x1285c8[_0x48a32b(0x20b)](),0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date[_0x48a32b(0x269)](_0x1285c8['getUTCFullYear'](),_0x1285c8[_0x48a32b(0x203)](),_0x1285c8[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48a32b(0x22e):const _0x5e7784=_0x4e751a['getUTCDay'](),_0x54cd9a=_0x5e7784===0x0?-0x6:0x1-_0x5e7784,_0x4be1fb=_0x4e751a[_0x48a32b(0x20b)]()+_0x54cd9a;_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)](),_0x4be1fb,0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date['UTC'](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)](),_0x4e751a[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0x3e5f94=new Date(Date[_0x48a32b(0x269)](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)](),_0x4e751a[_0x48a32b(0x20b)]()-0x7)),_0x7baf=_0x3e5f94[_0x48a32b(0x282)](),_0x1c176e=_0x7baf===0x0?-0x6:0x1-_0x7baf,_0x5a5213=_0x3e5f94[_0x48a32b(0x20b)]()+_0x1c176e;_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x3e5f94['getUTCFullYear'](),_0x3e5f94[_0x48a32b(0x203)](),_0x5a5213,0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date['UTC'](_0x3e5f94[_0x48a32b(0x29f)](),_0x3e5f94[_0x48a32b(0x203)](),_0x5a5213+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)](),0x1,0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date[_0x48a32b(0x269)](_0x4e751a['getUTCFullYear'](),_0x4e751a['getUTCMonth'](),_0x4e751a[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48a32b(0x27a):_0x5ae77b=new Date(Date[_0x48a32b(0x269)](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date['UTC'](_0x4e751a['getUTCFullYear'](),_0x4e751a[_0x48a32b(0x203)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x5ae77b=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date[_0x48a32b(0x269)](_0x4e751a[_0x48a32b(0x29f)](),_0x4e751a[_0x48a32b(0x203)](),_0x4e751a[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x5ae77b=new Date(Date['UTC'](_0x4e751a['getUTCFullYear'](),_0x4e751a['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x2ada5c=new Date(Date[_0x48a32b(0x269)](_0x4e751a['getUTCFullYear'](),_0x4e751a[_0x48a32b(0x203)](),_0x4e751a[_0x48a32b(0x20b)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x48a32b(0x1d9)](_0x48a32b(0x21b)+_0x5ae77b[_0x48a32b(0x210)]()+'\x20to\x20'+_0x2ada5c[_0x48a32b(0x210)]());const _0x391c03={'gte':_0x5ae77b,'lte':_0x2ada5c},[_0x96a90,_0x48bc97,_0x9cdcc7,_0x282f28,_0x5305e7,_0x39f60b,_0x3f0860,_0x5625a7,_0x4f684e,_0x811637,_0x532aca]=await Promise[_0x48a32b(0x2a3)]([database_1[_0x48a32b(0x2a0)][_0x48a32b(0x223)][_0x48a32b(0x1d0)]({'where':{'shopId':_0xc0f7b5,'gateway':{'not':_0x48a32b(0x1dd)},'status':{'notIn':[_0x48a32b(0x1c0),'EXPIRED']},'createdAt':_0x391c03}}),database_1[_0x48a32b(0x2a0)][_0x48a32b(0x223)][_0x48a32b(0x1d0)]({'where':{'shopId':_0xc0f7b5,'gateway':{'not':'test_gateway'},'status':_0x48a32b(0x244),'createdAt':_0x391c03}}),database_1[_0x48a32b(0x2a0)][_0x48a32b(0x223)][_0x48a32b(0x1d0)]({'where':{'shopId':_0xc0f7b5,'gateway':{'not':'test_gateway'},'status':'CHARGEBACK'}}),database_1['default'][_0x48a32b(0x223)]['count']({'where':{'shopId':_0xc0f7b5,'gateway':{'not':_0x48a32b(0x1dd)},'status':'REFUND'}}),database_1[_0x48a32b(0x2a0)]['payment'][_0x48a32b(0x1c5)]({'where':{'shopId':_0xc0f7b5,'gateway':{'not':_0x48a32b(0x1dd)},'status':'PAID','createdAt':_0x391c03},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x48a32b(0x2a0)]['payment']['findMany']({'where':{'shopId':_0xc0f7b5,'gateway':{'not':_0x48a32b(0x1dd)}},'take':0x4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x48a32b(0x2a0)]['payment'][_0x48a32b(0x1c5)]({'where':{'shopId':_0xc0f7b5,'gateway':{'not':_0x48a32b(0x1dd)},'createdAt':_0x391c03},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x48a32b(0x211)}}),database_1[_0x48a32b(0x2a0)][_0x48a32b(0x223)][_0x48a32b(0x1d0)]({'where':{'shopId':_0xc0f7b5,'gateway':{'not':_0x48a32b(0x1dd)},'status':_0x48a32b(0x244)}}),database_1['default']['payment'][_0x48a32b(0x1c5)]({'where':{'shopId':_0xc0f7b5,'gateway':{'not':'test_gateway'},'status':_0x48a32b(0x244)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x48a32b(0x2a0)][_0x48a32b(0x2a1)]['findUnique']({'where':{'id':_0xc0f7b5},'select':{'balance':!![]}}),database_1[_0x48a32b(0x2a0)][_0x48a32b(0x223)]['findMany']({'where':{'shopId':_0xc0f7b5,'gateway':{'not':'test_gateway'}},'select':{'gateway':!![]}})]),_0x567e22={};for(const _0x365650 of _0x532aca){_0x365650['gateway']&&(_0x567e22[_0x365650[_0x48a32b(0x248)]]=(_0x567e22[_0x365650[_0x48a32b(0x248)]]||0x0)+0x1);}console[_0x48a32b(0x1d9)]('ðŸ“Š\x20Payments\x20by\x20gateway\x20(all\x20time):',_0x567e22);let _0x1bc22c=0x0,_0x4693e4=0x0;for(const _0x272c00 of _0x5305e7){if(_0x272c00[_0x48a32b(0x259)])_0x1bc22c+=_0x272c00[_0x48a32b(0x259)];else{const _0x5bfab6=await currencyService_1['currencyService'][_0x48a32b(0x201)](_0x272c00[_0x48a32b(0x279)],_0x272c00['currency']);_0x1bc22c+=_0x5bfab6;}_0x272c00['amountAfterGatewayCommissionUSDT']&&(_0x4693e4+=_0x272c00[_0x48a32b(0x222)]);}let _0x3a559a=0x0;for(const _0x3865ce of _0x4f684e){_0x3865ce[_0x48a32b(0x222)]&&(_0x3a559a+=_0x3865ce[_0x48a32b(0x222)]);}const _0x2fa376=this[_0x48a32b(0x1fe)](_0x3f0860,_0x5ae77b,_0x2ada5c||_0x4e751a),_0x14b02b=_0x96a90>0x0?_0x48bc97/_0x96a90*0x64:0x0,_0xad26c7=_0x5625a7>0x0?_0x9cdcc7/_0x5625a7*0x64:0x0;return{'totalPayments':_0x96a90,'successfulPayments':_0x48bc97,'totalRevenue':Math['round'](_0x1bc22c*0x64)/0x64,'merchantEarnings':Math[_0x48a32b(0x25a)](_0x4693e4*0x64)/0x64,'merchantTotalRevenue':Math[_0x48a32b(0x25a)](_0x3a559a*0x64)/0x64,'payoutBalance':Math[_0x48a32b(0x25a)]((_0x811637?.['balance']||0x0)*0x64)/0x64,'conversionRate':Math[_0x48a32b(0x25a)](_0x14b02b*0x64)/0x64,'chargebackRate':Math['round'](_0xad26c7*0x64)/0x64,'chargebacks':_0x9cdcc7,'refunds':_0x282f28,'paymentsByGateway':_0x567e22,'dailyRevenue':_0x2fa376[_0x48a32b(0x218)],'dailyPayments':_0x2fa376[_0x48a32b(0x1f6)],'recentPayments':_0x39f60b[_0x48a32b(0x236)](_0x538782=>({'id':_0x538782['id'],'gateway':_0x538782[_0x48a32b(0x248)],'amount':_0x538782[_0x48a32b(0x279)],'currency':_0x538782[_0x48a32b(0x1ff)],'status':_0x538782[_0x48a32b(0x22b)],'createdAt':_0x538782['createdAt']}))};}[a86_0xf0bd72(0x1fe)](_0x40fad9,_0x1d0eec,_0x54509f){const _0x159c83=a86_0xf0bd72,_0x154947=new Map(),_0x4f8e1b=new Date(_0x1d0eec);while(_0x4f8e1b<=_0x54509f){const _0x26af2e=_0x4f8e1b[_0x159c83(0x210)]()['split']('T')[0x0];_0x154947[_0x159c83(0x268)](_0x26af2e,{'revenue':0x0,'count':0x0}),_0x4f8e1b[_0x159c83(0x1cf)](_0x4f8e1b[_0x159c83(0x26a)]()+0x1);}for(const _0x49bc53 of _0x40fad9){const _0x191cb8=_0x49bc53[_0x159c83(0x255)][_0x159c83(0x210)]()[_0x159c83(0x1cd)]('T')[0x0],_0x5aa08d=_0x154947[_0x159c83(0x22d)](_0x191cb8);_0x5aa08d&&(_0x5aa08d[_0x159c83(0x1d0)]+=0x1,_0x49bc53[_0x159c83(0x22b)]===_0x159c83(0x244)&&_0x49bc53[_0x159c83(0x259)]&&(_0x5aa08d['revenue']+=_0x49bc53['amountUSDT']));}const _0x32de88=[],_0x33a25c=[];for(const [_0x41f7c8,_0x38e322]of _0x154947){_0x32de88[_0x159c83(0x20c)]({'date':_0x41f7c8,'amount':Math[_0x159c83(0x25a)](_0x38e322[_0x159c83(0x270)]*0x64)/0x64}),_0x33a25c[_0x159c83(0x20c)]({'date':_0x41f7c8,'count':_0x38e322[_0x159c83(0x1d0)]});}return{'dailyRevenue':_0x32de88,'dailyPayments':_0x33a25c};}[a86_0xf0bd72(0x24f)](_0x122dda=0x8){const _0x75483e=a86_0xf0bd72,_0x1dc0a3=[];for(let _0x42d777=0x0;_0x42d777<_0x122dda;_0x42d777++){const _0x4cc5c3=crypto_1['default']['randomBytes'](0x4)[_0x75483e(0x257)](_0x75483e(0x1d8))[_0x75483e(0x299)]();_0x1dc0a3[_0x75483e(0x20c)](_0x4cc5c3);}return _0x1dc0a3;}async['setup2FA'](_0x17607c){const _0x5de69a=a86_0xf0bd72,_0x210157=await database_1[_0x5de69a(0x2a0)][_0x5de69a(0x2a1)][_0x5de69a(0x293)]({'where':{'id':_0x17607c},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x210157)throw new Error(_0x5de69a(0x1c4));const _0xdc0369=speakeasy_1[_0x5de69a(0x2a0)][_0x5de69a(0x1db)]({'name':_0x5de69a(0x1c1)+_0x210157[_0x5de69a(0x1ca)]+')','issuer':'TrapaPay','length':0x20}),_0x4455df=await qrcode_1[_0x5de69a(0x2a0)][_0x5de69a(0x1f3)](_0xdc0369['otpauth_url']),_0x100f93=this[_0x5de69a(0x24f)](0x8),_0x1875fc=await Promise['all'](_0x100f93['map'](_0x57c7f2=>bcryptjs_1[_0x5de69a(0x2a0)]['hash'](_0x57c7f2,0xa)));return await database_1[_0x5de69a(0x2a0)][_0x5de69a(0x2a1)]['update']({'where':{'id':_0x17607c},'data':{'twoFactorSecret':_0xdc0369['base32'],'backupCodes':JSON[_0x5de69a(0x206)](_0x1875fc)}}),console[_0x5de69a(0x1d9)](_0x5de69a(0x1d3)+_0x210157['username']),console['log'](_0x5de69a(0x1c7)+_0x100f93['length']+_0x5de69a(0x1f0)),{'secret':_0xdc0369[_0x5de69a(0x216)],'qrCode':_0x4455df,'manualEntryKey':_0xdc0369[_0x5de69a(0x216)],'backupCodes':_0x100f93};}async[a86_0xf0bd72(0x258)](_0x34b03b,_0x249080){const _0x51ee2d=a86_0xf0bd72,_0x23d41a=await database_1['default'][_0x51ee2d(0x2a1)]['findUnique']({'where':{'id':_0x34b03b},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x23d41a)throw new Error(_0x51ee2d(0x1c4));if(!_0x23d41a[_0x51ee2d(0x1ef)])throw new Error(_0x51ee2d(0x24e));if(_0x23d41a[_0x51ee2d(0x1e0)])throw new Error(_0x51ee2d(0x1be));const _0xc384d0=speakeasy_1[_0x51ee2d(0x2a0)][_0x51ee2d(0x21c)]['verify']({'secret':_0x23d41a[_0x51ee2d(0x1ef)],'encoding':_0x51ee2d(0x216),'token':_0x249080,'window':0x2});if(!_0xc384d0)throw new Error(_0x51ee2d(0x27c));return await database_1[_0x51ee2d(0x2a0)][_0x51ee2d(0x2a1)]['update']({'where':{'id':_0x34b03b},'data':{'twoFactorEnabled':!![]}}),console[_0x51ee2d(0x1d9)](_0x51ee2d(0x1d5)+_0x23d41a[_0x51ee2d(0x1ca)]),{'enabled':!![]};}async[a86_0xf0bd72(0x260)](_0x3cf977){const _0x5c58ae=a86_0xf0bd72,_0x5c41e8=await database_1[_0x5c58ae(0x2a0)][_0x5c58ae(0x2a1)][_0x5c58ae(0x293)]({'where':{'id':_0x3cf977},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5c41e8)throw new Error(_0x5c58ae(0x1c4));await database_1[_0x5c58ae(0x2a0)][_0x5c58ae(0x2a1)][_0x5c58ae(0x2a2)]({'where':{'id':_0x3cf977},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x5c58ae(0x1d9)](_0x5c58ae(0x235)+_0x5c41e8['username']);}}exports[a86_0xf0bd72(0x262)]=ShopService;