'use strict';const a77_0x14cc47=a77_0x45b9;(function(_0x4a5860,_0x4468f1){const _0x3408f0=a77_0x45b9,_0x214835=_0x4a5860();while(!![]){try{const _0x416f9c=parseInt(_0x3408f0(0x1b7))/0x1*(-parseInt(_0x3408f0(0x18e))/0x2)+-parseInt(_0x3408f0(0x213))/0x3+parseInt(_0x3408f0(0x1c4))/0x4*(-parseInt(_0x3408f0(0x1ba))/0x5)+-parseInt(_0x3408f0(0x13d))/0x6*(parseInt(_0x3408f0(0x1f7))/0x7)+parseInt(_0x3408f0(0x1e8))/0x8+-parseInt(_0x3408f0(0x1fb))/0x9*(-parseInt(_0x3408f0(0x19d))/0xa)+parseInt(_0x3408f0(0x157))/0xb;if(_0x416f9c===_0x4468f1)break;else _0x214835['push'](_0x214835['shift']());}catch(_0x31b7b9){_0x214835['push'](_0x214835['shift']());}}}(a77_0x22bf,0xb0b8a));function a77_0x45b9(_0x45522f,_0x216058){_0x45522f=_0x45522f-0x133;const _0x22bf9a=a77_0x22bf();let _0x45b909=_0x22bf9a[_0x45522f];return _0x45b909;}var __importDefault=this&&this[a77_0x14cc47(0x214)]||function(_0x108cbb){const _0x18ed29=a77_0x14cc47;return _0x108cbb&&_0x108cbb[_0x18ed29(0x164)]?_0x108cbb:{'default':_0x108cbb};};Object[a77_0x14cc47(0x1c5)](exports,a77_0x14cc47(0x164),{'value':!![]}),exports[a77_0x14cc47(0x1c2)]=void 0x0;const database_1=__importDefault(require(a77_0x14cc47(0x16f))),bcryptjs_1=__importDefault(require(a77_0x14cc47(0x1da))),crypto_1=__importDefault(require(a77_0x14cc47(0x19c))),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a77_0x14cc47(0x218))),currencyService_1=require(a77_0x14cc47(0x16c)),paymentService_1=require(a77_0x14cc47(0x172)),gateway_1=require(a77_0x14cc47(0x20e));function a77_0x22bf(){const _0x5ddd77=['Plisio','default','Failed\x20to\x20send\x20webhook:\x20','this_month','dailyPayments','\x20to\x20','paymentService','round','gatewaySettings','Webhook\x20returned\x20error:\x20','findUnique','toUpperCase','USDC\x20Ethereum','1930103KrWxoO','üìä\x20Shop\x20','status','findFirst','81PzHhvZ','txid','generateSecret','deletePayment','gte','polygon','error','webhookLog','REFUND','currency','getStatistics','retryCount','üîê\x202FA\x20enabled\x20for\x20shop:\x20','üìÖ\x20Period\x20start:\x20','REJECTED','ceil','\x20USDT\x20(total\x20payouts)','webhookUrl','test_gateway','../types/gateway','getUTCDate','usdtErcWallet','getTime','paid','1128516vwjNCw','__importDefault','createdAt','USDT\x20Polygon','telegram','qrcode','COMPLETED','PaymentService','merchantUrl','Test\x20webhook\x20sent\x20successfully\x20(','getGatewayDisplayName','redirectUrl','test_order_123','replace','trc20','getUTCMonth','18xDmKqj','customerEmail','getDate','üìÖ\x20Period\x20end:\x20','\x20payout\x20statistics\x20calculated:','üìä\x20Final\x20WHERE\x20conditions:','_sum','amountAfterGatewayCommissionUSDT','responseBody','log','Payment\x20System/1.0\x20(Test)','createPayment','Invalid\x202FA\x20token','üìä\x20Status\x20filter:\x20','twoFactorToken','publicKey','setDate','TrapaPay\x20(','üåê\x20Network\x20filter:\x20','Shop\x20not\x20found','POST','filter',',\x20period:\x20','No\x20webhook\x20URL\x20configured','otpauth_url','setUTCDate','19384970jECCel','sourceCurrency','totp','disable2FA','PENDING','usdtPolygonWallet','map','totalPaidOut','AVAILABLE_GATEWAYS','all','generateBackupCodes','application/json','wallets','__esModule','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','getUTCFullYear','usdcErcWallet','parse','splice','üîë\x20Generated\x20','base32','./currencyService','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','updateWallets','../config/database','message','network','./paymentService','üìÖ\x20Custom\x20period:\x20','Unknown\x20error','twoFactorSecret','amountUSDT','formatNetworkName','currencyService','amountIsEditable','getFullYear','amount','test_payment_123','notes','lte','\x20\x20\x20üìÖ\x20This\x20month:\x20','getShopProfile','webhookEvents','expiresAt','username','convertToUSDT','\x20USDT\x20(current\x20balance)','PAID','KLYME\x20GB','\x20USDT','generateDailyStatistics','last_week','üåê\x20Method\x20filter:\x20','USDT\x20ERC20','payment','1537606JqPQAM','Error\x20parsing\x20webhook\x20events:','count','set','üìÖ\x20Date\x20start:\x20','isActive','includes','30d','asc','üìä\x20Getting\x20statistics\x20for\x20shop\x20','enable2FA','aggregate','language','randomBytes','crypto','1137880LJYNtB','paymentGateways','country','name','push','UTC','twoFactorEnabled','revenue','telegramId','Payment\x20not\x20found','compare','\x20\x20\x20üíµ\x20Available\x20balance:\x20','custom_','gateways','shop','Noda','toISOString','getShopPayoutStats','fullName','2FA\x20is\x20already\x20enabled','\x20backup\x20codes','findMany','getMonth','reduce','hex','üìÖ\x20Final\x20date\x20range:\x20','1uTUuMx','update','shopUrl','10cOTXkt','getWebhookLogs','YESTERDAY','usdtTrcWallet','stringify','settings','updateShopProfile','length','ShopService','customer','2441756ucmIJk','defineProperty','get','thisMonth','split','TrapaPay','EXPIRED','last_month','Rapyd','awaitingPayout','gateway','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','startsWith','verify','desc','2FA\x20token\x20is\x20required','periodTo','erc20_usdc','getUTCDay','setup2FA','backupCodes','getPaymentByShopAndId','bcryptjs','getPayments','getPaymentById','isArray','balance',',\x20dateTo:\x20','setHours',',\x20dateFrom:\x20','payout','testWebhook','CHARGEBACK','paidAt','KLYME\x20DE','shopId','9044224rzHYqy','usdcPolygonWallet'];a77_0x22bf=function(){return _0x5ddd77;};return a77_0x22bf();}class ShopService{constructor(){const _0x6b060a=a77_0x14cc47;this[_0x6b060a(0x1f0)]=new paymentService_1[(_0x6b060a(0x134))]();}async[a77_0x14cc47(0x180)](_0x236766){const _0x42cec5=a77_0x14cc47,_0x3ecaad=await database_1['default'][_0x42cec5(0x1ab)][_0x42cec5(0x1f4)]({'where':{'id':_0x236766},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x3ecaad)throw new Error(_0x42cec5(0x150));let _0x5c1348=[];if(_0x3ecaad[_0x42cec5(0x1bf)]?.[_0x42cec5(0x181)])try{_0x5c1348=Array[_0x42cec5(0x1dd)](_0x3ecaad['settings'][_0x42cec5(0x181)])?_0x3ecaad[_0x42cec5(0x1bf)]['webhookEvents']:JSON[_0x42cec5(0x168)](_0x3ecaad[_0x42cec5(0x1bf)]['webhookEvents']);}catch(_0x588566){console[_0x42cec5(0x201)]('Error\x20parsing\x20webhook\x20events:',_0x588566),_0x5c1348=[];}const _0x5eea82=gateway_1[_0x42cec5(0x15f)]['filter'](_0x404ed0=>_0x404ed0[_0x42cec5(0x193)])[_0x42cec5(0x15d)](_0x478b59=>_0x478b59[_0x42cec5(0x1a0)]);let _0x4ea577=_0x3ecaad[_0x42cec5(0x19e)]?JSON['parse'](_0x3ecaad[_0x42cec5(0x19e)]):[];return Array[_0x42cec5(0x1dd)](_0x4ea577)&&(_0x4ea577=_0x4ea577[_0x42cec5(0x152)](_0x480670=>_0x5eea82[_0x42cec5(0x194)](_0x480670))),{'id':_0x3ecaad['id'],'fullName':_0x3ecaad[_0x42cec5(0x1a0)],'username':_0x3ecaad[_0x42cec5(0x183)],'telegramId':_0x3ecaad[_0x42cec5(0x217)],'merchantUrl':_0x3ecaad[_0x42cec5(0x1b9)],'gateways':_0x4ea577,'gatewaySettings':_0x3ecaad['gatewaySettings']?JSON[_0x42cec5(0x168)](_0x3ecaad[_0x42cec5(0x1f2)]):null,'publicKey':_0x3ecaad[_0x42cec5(0x14c)],'webhookUrl':_0x3ecaad[_0x42cec5(0x1bf)]?.[_0x42cec5(0x20c)]||null,'webhookEvents':_0x5c1348,'wallets':{'usdtPolygonWallet':_0x3ecaad[_0x42cec5(0x15c)],'usdtTrcWallet':_0x3ecaad[_0x42cec5(0x1bd)],'usdtErcWallet':_0x3ecaad[_0x42cec5(0x210)],'usdcPolygonWallet':_0x3ecaad[_0x42cec5(0x1e9)],'usdcErcWallet':_0x3ecaad[_0x42cec5(0x167)]},'status':_0x3ecaad[_0x42cec5(0x1f9)],'createdAt':_0x3ecaad[_0x42cec5(0x215)]};}async[a77_0x14cc47(0x1c0)](_0x420888,_0x452e47){const _0x37a7bb=a77_0x14cc47,_0x1b1d4f={};_0x452e47[_0x37a7bb(0x1af)]&&(_0x1b1d4f[_0x37a7bb(0x1a0)]=_0x452e47[_0x37a7bb(0x1af)]);_0x452e47[_0x37a7bb(0x1a5)]!==undefined&&(_0x1b1d4f[_0x37a7bb(0x217)]=_0x452e47[_0x37a7bb(0x1a5)]||null);_0x452e47[_0x37a7bb(0x135)]&&(_0x1b1d4f[_0x37a7bb(0x1b9)]=_0x452e47[_0x37a7bb(0x135)]);_0x452e47[_0x37a7bb(0x1aa)]&&(_0x1b1d4f['paymentGateways']=JSON['stringify'](_0x452e47[_0x37a7bb(0x1aa)]));_0x452e47[_0x37a7bb(0x1f2)]&&(_0x1b1d4f['gatewaySettings']=JSON[_0x37a7bb(0x1be)](_0x452e47[_0x37a7bb(0x1f2)]));_0x452e47['wallets']&&(_0x452e47[_0x37a7bb(0x163)]['usdtPolygonWallet']!==undefined&&(_0x1b1d4f[_0x37a7bb(0x15c)]=_0x452e47[_0x37a7bb(0x163)][_0x37a7bb(0x15c)]||null),_0x452e47[_0x37a7bb(0x163)][_0x37a7bb(0x1bd)]!==undefined&&(_0x1b1d4f['usdtTrcWallet']=_0x452e47[_0x37a7bb(0x163)][_0x37a7bb(0x1bd)]||null),_0x452e47[_0x37a7bb(0x163)][_0x37a7bb(0x210)]!==undefined&&(_0x1b1d4f[_0x37a7bb(0x210)]=_0x452e47[_0x37a7bb(0x163)][_0x37a7bb(0x210)]||null),_0x452e47[_0x37a7bb(0x163)]['usdcPolygonWallet']!==undefined&&(_0x1b1d4f[_0x37a7bb(0x1e9)]=_0x452e47[_0x37a7bb(0x163)]['usdcPolygonWallet']||null));const _0x145f15=await database_1[_0x37a7bb(0x1eb)]['shop']['update']({'where':{'id':_0x420888},'data':_0x1b1d4f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x181302=[];if(_0x145f15[_0x37a7bb(0x1bf)]?.[_0x37a7bb(0x181)])try{_0x181302=Array[_0x37a7bb(0x1dd)](_0x145f15[_0x37a7bb(0x1bf)][_0x37a7bb(0x181)])?_0x145f15[_0x37a7bb(0x1bf)]['webhookEvents']:JSON[_0x37a7bb(0x168)](_0x145f15[_0x37a7bb(0x1bf)]['webhookEvents']);}catch(_0x4d0ac1){console[_0x37a7bb(0x201)](_0x37a7bb(0x18f),_0x4d0ac1),_0x181302=[];}return{'id':_0x145f15['id'],'fullName':_0x145f15[_0x37a7bb(0x1a0)],'username':_0x145f15[_0x37a7bb(0x183)],'telegramId':_0x145f15[_0x37a7bb(0x217)],'merchantUrl':_0x145f15[_0x37a7bb(0x1b9)],'gateways':_0x145f15[_0x37a7bb(0x19e)]?JSON[_0x37a7bb(0x168)](_0x145f15[_0x37a7bb(0x19e)]):null,'gatewaySettings':_0x145f15['gatewaySettings']?JSON['parse'](_0x145f15[_0x37a7bb(0x1f2)]):null,'publicKey':_0x145f15[_0x37a7bb(0x14c)],'webhookUrl':_0x145f15[_0x37a7bb(0x1bf)]?.[_0x37a7bb(0x20c)]||null,'webhookEvents':_0x181302,'wallets':{'usdtPolygonWallet':_0x145f15[_0x37a7bb(0x15c)],'usdtTrcWallet':_0x145f15[_0x37a7bb(0x1bd)],'usdtErcWallet':_0x145f15[_0x37a7bb(0x210)],'usdcPolygonWallet':_0x145f15[_0x37a7bb(0x1e9)],'usdcErcWallet':_0x145f15['usdcErcWallet']},'status':_0x145f15['status'],'createdAt':_0x145f15[_0x37a7bb(0x215)]};}async[a77_0x14cc47(0x16e)](_0x3dd83a,_0x3bd3c3){const _0x518a4b=a77_0x14cc47,_0x449e97=await database_1['default'][_0x518a4b(0x1ab)][_0x518a4b(0x1f4)]({'where':{'id':_0x3dd83a},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x449e97)throw new Error(_0x518a4b(0x150));if(_0x449e97[_0x518a4b(0x1a3)]){if(!_0x3bd3c3[_0x518a4b(0x14b)])throw new Error(_0x518a4b(0x1d3));const _0xc85ad6=speakeasy_1['default']['totp'][_0x518a4b(0x1d1)]({'secret':_0x449e97['twoFactorSecret'],'encoding':_0x518a4b(0x16b),'token':_0x3bd3c3['twoFactorToken'],'window':0x2});if(!_0xc85ad6){let _0x11c404=![];if(_0x449e97['backupCodes']){const _0x1aeccb=JSON['parse'](_0x449e97[_0x518a4b(0x1d8)]);for(let _0x2a8749=0x0;_0x2a8749<_0x1aeccb['length'];_0x2a8749++){const _0x287936=await bcryptjs_1[_0x518a4b(0x1eb)][_0x518a4b(0x1a7)](_0x3bd3c3[_0x518a4b(0x14b)],_0x1aeccb[_0x2a8749]);if(_0x287936){_0x11c404=!![],_0x1aeccb[_0x518a4b(0x169)](_0x2a8749,0x1),await database_1[_0x518a4b(0x1eb)][_0x518a4b(0x1ab)]['update']({'where':{'id':_0x3dd83a},'data':{'backupCodes':JSON[_0x518a4b(0x1be)](_0x1aeccb)}});break;}}}if(!_0x11c404)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x19c1d5={};_0x3bd3c3['usdtPolygonWallet']!==undefined&&(_0x19c1d5[_0x518a4b(0x15c)]=_0x3bd3c3[_0x518a4b(0x15c)]||null),_0x3bd3c3[_0x518a4b(0x1bd)]!==undefined&&(_0x19c1d5[_0x518a4b(0x1bd)]=_0x3bd3c3['usdtTrcWallet']||null),_0x3bd3c3[_0x518a4b(0x210)]!==undefined&&(_0x19c1d5[_0x518a4b(0x210)]=_0x3bd3c3[_0x518a4b(0x210)]||null),_0x3bd3c3[_0x518a4b(0x1e9)]!==undefined&&(_0x19c1d5[_0x518a4b(0x1e9)]=_0x3bd3c3[_0x518a4b(0x1e9)]||null),_0x3bd3c3[_0x518a4b(0x167)]!==undefined&&(_0x19c1d5['usdcErcWallet']=_0x3bd3c3[_0x518a4b(0x167)]||null),await database_1[_0x518a4b(0x1eb)][_0x518a4b(0x1ab)]['update']({'where':{'id':_0x3dd83a},'data':_0x19c1d5});}async[a77_0x14cc47(0x1e3)](_0x5eb246){const _0x4934f4=a77_0x14cc47,_0x46a6e0=await database_1[_0x4934f4(0x1eb)][_0x4934f4(0x1ab)][_0x4934f4(0x1f4)]({'where':{'id':_0x5eb246},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x46a6e0?.[_0x4934f4(0x1bf)]?.['webhookUrl'])throw new Error(_0x4934f4(0x154));const _0x11f5df={'event':'test','payment':{'id':_0x4934f4(0x17c),'order_id':_0x4934f4(0x139),'gateway':'test','amount':0x64,'currency':'USD','status':_0x4934f4(0x212),'created_at':new Date()[_0x4934f4(0x1ad)]()}};try{const _0x19878c=await fetch(_0x46a6e0[_0x4934f4(0x1bf)][_0x4934f4(0x20c)],{'method':_0x4934f4(0x151),'headers':{'Content-Type':_0x4934f4(0x162),'User-Agent':_0x4934f4(0x147)},'body':JSON['stringify'](_0x11f5df)});return _0x19878c['ok']?{'success':!![],'message':_0x4934f4(0x136)+_0x19878c[_0x4934f4(0x1f9)]+')'}:{'success':![],'message':_0x4934f4(0x1f3)+_0x19878c[_0x4934f4(0x1f9)]+'\x20'+_0x19878c['statusText']};}catch(_0x2e97a4){return{'success':![],'message':_0x4934f4(0x1ec)+(_0x2e97a4 instanceof Error?_0x2e97a4[_0x4934f4(0x170)]:_0x4934f4(0x174))};}}async[a77_0x14cc47(0x148)](_0x3cf3d6){const _0x17a11d=a77_0x14cc47;return this['paymentService']['createPublicPayment']({'public_key':'','gateway':_0x3cf3d6[_0x17a11d(0x1ce)],'order_id':undefined,'amount':_0x3cf3d6[_0x17a11d(0x17b)],'currency':_0x3cf3d6[_0x17a11d(0x204)],'source_currency':_0x3cf3d6[_0x17a11d(0x158)],'usage':_0x3cf3d6['usage'],'expires_at':_0x3cf3d6[_0x17a11d(0x182)]?.[_0x17a11d(0x1ad)](),'success_url':_0x3cf3d6[_0x17a11d(0x138)],'fail_url':_0x3cf3d6[_0x17a11d(0x138)],'customer_email':_0x3cf3d6[_0x17a11d(0x13e)],'customer_name':_0x3cf3d6['customerName'],'country':_0x3cf3d6[_0x17a11d(0x19f)],'language':_0x3cf3d6[_0x17a11d(0x19a)],'amount_is_editable':_0x3cf3d6[_0x17a11d(0x179)],'max_payments':_0x3cf3d6['maxPayments'],'customer':_0x3cf3d6[_0x17a11d(0x1c3)]});}async[a77_0x14cc47(0x1db)](_0x4a4b17,_0x5824ac){const _0x2e8fc9=a77_0x14cc47;return this[_0x2e8fc9(0x1f0)]['getPaymentsByShop'](_0x4a4b17,_0x5824ac);}async[a77_0x14cc47(0x1dc)](_0x139e94,_0x1e82ad){const _0x5aa225=a77_0x14cc47;return this[_0x5aa225(0x1f0)][_0x5aa225(0x1d9)](_0x139e94,_0x1e82ad);}async['updatePayment'](_0x3c3214,_0x3ea351,_0x59a3c1){const _0x5f120f=a77_0x14cc47,_0x31b92d=await database_1[_0x5f120f(0x1eb)][_0x5f120f(0x18d)][_0x5f120f(0x1fa)]({'where':{'id':_0x3ea351,'shopId':_0x3c3214}});if(!_0x31b92d)throw new Error(_0x5f120f(0x1a6));const _0x13c32e=await database_1[_0x5f120f(0x1eb)]['payment'][_0x5f120f(0x1b8)]({'where':{'id':_0x3ea351},'data':{..._0x59a3c1,'updatedAt':new Date()}});return _0x13c32e;}async[a77_0x14cc47(0x1fe)](_0x282872,_0x30101d){const _0x5c9560=a77_0x14cc47,_0x2d4b28=await database_1[_0x5c9560(0x1eb)][_0x5c9560(0x18d)][_0x5c9560(0x1fa)]({'where':{'id':_0x30101d,'shopId':_0x282872}});if(!_0x2d4b28)throw new Error(_0x5c9560(0x1a6));await database_1[_0x5c9560(0x1eb)]['payment']['delete']({'where':{'id':_0x30101d}});}['formatNetworkName'](_0x14bf4d){const _0x53884b=a77_0x14cc47,_0x42db2b={'polygon':_0x53884b(0x216),'trc20':'USDT\x20TRC20','erc20':_0x53884b(0x18c),'bsc':'USDT\x20BSC','polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x53884b(0x1f6)};return _0x42db2b[_0x14bf4d]||_0x14bf4d;}async['getPayouts'](_0xa473e6,_0x196b9a){const _0x42ed21=a77_0x14cc47,{page:_0xa42ca0,limit:_0x5753b2,status:_0x485cb0,method:_0x1f26a5,network:_0x2e0e26,dateFrom:_0x525858,dateTo:_0x1138df,periodFrom:_0x17f241,periodTo:_0x5c37d8}=_0x196b9a,_0x1a2c4f=(_0xa42ca0-0x1)*_0x5753b2;console[_0x42ed21(0x146)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x196b9a);const _0xe37d3b={'shopId':_0xa473e6};_0x485cb0&&(_0xe37d3b['status']=_0x485cb0[_0x42ed21(0x1f5)](),console[_0x42ed21(0x146)](_0x42ed21(0x14a)+_0x485cb0[_0x42ed21(0x1f5)]()));if(_0x1f26a5)_0xe37d3b[_0x42ed21(0x171)]=_0x1f26a5,console[_0x42ed21(0x146)](_0x42ed21(0x18b)+_0x1f26a5);else _0x2e0e26&&(_0xe37d3b[_0x42ed21(0x171)]=_0x2e0e26,console[_0x42ed21(0x146)](_0x42ed21(0x14f)+_0x2e0e26));if(_0x525858||_0x1138df||_0x17f241||_0x5c37d8){_0xe37d3b[_0x42ed21(0x215)]={};if(_0x17f241){const _0x8b75f6=new Date(_0x17f241);_0x8b75f6['setHours'](0x0,0x0,0x0,0x1),_0xe37d3b[_0x42ed21(0x215)][_0x42ed21(0x1ff)]=_0x8b75f6,console[_0x42ed21(0x146)](_0x42ed21(0x208)+_0x8b75f6['toISOString']());}else{if(_0x525858){const _0x38fdb3=new Date(_0x525858);_0x38fdb3[_0x42ed21(0x1e0)](0x0,0x0,0x0,0x1),_0xe37d3b['createdAt']['gte']=_0x38fdb3,console[_0x42ed21(0x146)](_0x42ed21(0x192)+_0x38fdb3[_0x42ed21(0x1ad)]());}}if(_0x5c37d8){const _0x263cd5=new Date(_0x5c37d8);_0x263cd5['setHours'](0x17,0x3b,0x3b,0x3e7),_0xe37d3b[_0x42ed21(0x215)][_0x42ed21(0x17e)]=_0x263cd5,console['log'](_0x42ed21(0x140)+_0x263cd5['toISOString']());}else{if(_0x1138df){const _0x100efc=new Date(_0x1138df);_0x100efc[_0x42ed21(0x1e0)](0x17,0x3b,0x3b,0x3e7),_0xe37d3b[_0x42ed21(0x215)]['lte']=_0x100efc,console['log']('üìÖ\x20Date\x20end:\x20'+_0x100efc[_0x42ed21(0x1ad)]());}}}console['log'](_0x42ed21(0x142),JSON[_0x42ed21(0x1be)](_0xe37d3b,null,0x2));const [_0x30e5cf,_0x4833cc]=await Promise[_0x42ed21(0x160)]([database_1[_0x42ed21(0x1eb)]['payout'][_0x42ed21(0x1b2)]({'where':_0xe37d3b,'skip':_0x1a2c4f,'take':_0x5753b2,'orderBy':{'createdAt':_0x42ed21(0x1d2)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x42ed21(0x1eb)][_0x42ed21(0x1e2)][_0x42ed21(0x190)]({'where':_0xe37d3b})]);return{'payouts':_0x30e5cf[_0x42ed21(0x15d)](_0xca113a=>{const _0x30a703=_0x42ed21;let _0x590629=null;switch(_0xca113a[_0x30a703(0x171)]){case _0x30a703(0x200):_0x590629=_0xca113a[_0x30a703(0x1ab)]['usdtPolygonWallet'];break;case _0x30a703(0x13b):_0x590629=_0xca113a[_0x30a703(0x1ab)]['usdtTrcWallet'];break;case'erc20':_0x590629=_0xca113a[_0x30a703(0x1ab)][_0x30a703(0x210)];break;case'polygon_usdc':_0x590629=_0xca113a['shop']['usdcPolygonWallet'];break;case _0x30a703(0x1d5):_0x590629=_0xca113a[_0x30a703(0x1ab)][_0x30a703(0x167)];break;}return{'id':_0xca113a['id'],'amount':_0xca113a[_0x30a703(0x17b)],'network':this[_0x30a703(0x177)](_0xca113a['network']),'wallet':_0x590629,'status':_0xca113a[_0x30a703(0x1f9)],'txid':_0xca113a[_0x30a703(0x1fc)],'notes':_0xca113a[_0x30a703(0x17d)],'periodFrom':_0xca113a['periodFrom'],'periodTo':_0xca113a[_0x30a703(0x1d4)],'createdAt':_0xca113a[_0x30a703(0x215)],'paidAt':_0xca113a[_0x30a703(0x1e5)]};}),'pagination':{'page':_0xa42ca0,'limit':_0x5753b2,'total':_0x4833cc,'totalPages':Math[_0x42ed21(0x20a)](_0x4833cc/_0x5753b2)}};}async['getPayoutById'](_0x2af5f6,_0x2a4f5d){const _0xeb4590=a77_0x14cc47,_0x1b31ca=await database_1[_0xeb4590(0x1eb)][_0xeb4590(0x1e2)][_0xeb4590(0x1fa)]({'where':{'id':_0x2a4f5d,'shopId':_0x2af5f6}});if(!_0x1b31ca)return null;return{'id':_0x1b31ca['id'],'amount':_0x1b31ca['amount'],'network':_0x1b31ca['network'],'status':_0x1b31ca[_0xeb4590(0x1f9)],'txid':_0x1b31ca['txid'],'notes':_0x1b31ca[_0xeb4590(0x17d)],'createdAt':_0x1b31ca['createdAt'],'paidAt':_0x1b31ca[_0xeb4590(0x1e5)]};}async['getPayoutStatistics'](_0x32021b,_0xca8789){const _0x32540f=a77_0x14cc47,_0x5f464b=new Date();let _0x5968dd,_0x694bf1;switch(_0xca8789){case'yesterday':case _0x32540f(0x1bc):const _0xf48bf1=new Date(_0x5f464b);_0xf48bf1[_0x32540f(0x14d)](_0xf48bf1[_0x32540f(0x13f)]()-0x1),_0x5968dd=new Date(_0xf48bf1),_0x5968dd[_0x32540f(0x1e0)](0x0,0x0,0x0,0x0),_0x694bf1=new Date(_0xf48bf1),_0x694bf1[_0x32540f(0x1e0)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x5968dd=new Date(_0x5f464b['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x32540f(0x195):_0x5968dd=new Date(_0x5f464b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x5968dd=new Date(_0x5f464b[_0x32540f(0x211)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5968dd=new Date(_0x5f464b[_0x32540f(0x211)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0xc200dc={'gte':_0x5968dd};_0x694bf1&&(_0xc200dc[_0x32540f(0x17e)]=_0x694bf1);const [_0x1eeff0,_0x2b6f32,_0x3a3cb6,_0x5c53ad,_0x3dc1d6,_0x5b94f5]=await Promise[_0x32540f(0x160)]([database_1[_0x32540f(0x1eb)][_0x32540f(0x1e2)]['count']({'where':{'shopId':_0x32021b,'createdAt':_0xc200dc}}),database_1[_0x32540f(0x1eb)][_0x32540f(0x1e2)][_0x32540f(0x190)]({'where':{'shopId':_0x32021b,'status':_0x32540f(0x133),'createdAt':_0xc200dc}}),database_1[_0x32540f(0x1eb)]['payout'][_0x32540f(0x190)]({'where':{'shopId':_0x32021b,'status':_0x32540f(0x15b),'createdAt':_0xc200dc}}),database_1[_0x32540f(0x1eb)][_0x32540f(0x1e2)][_0x32540f(0x190)]({'where':{'shopId':_0x32021b,'status':_0x32540f(0x209),'createdAt':_0xc200dc}}),database_1['default'][_0x32540f(0x1e2)][_0x32540f(0x1b2)]({'where':{'shopId':_0x32021b,'createdAt':_0xc200dc},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x32540f(0x1eb)][_0x32540f(0x1e2)]['findMany']({'where':{'shopId':_0x32021b},'take':0xa,'orderBy':{'createdAt':_0x32540f(0x1d2)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0xb42310=_0x3dc1d6[_0x32540f(0x1b4)]((_0x4ba0e3,_0x320ac4)=>_0x4ba0e3+_0x320ac4[_0x32540f(0x17b)],0x0),_0x47b4ae=_0x3dc1d6[_0x32540f(0x152)](_0x37c34b=>_0x37c34b[_0x32540f(0x1f9)]==='COMPLETED')[_0x32540f(0x1b4)]((_0x27486d,_0x4a5c6f)=>_0x27486d+_0x4a5c6f[_0x32540f(0x17b)],0x0),_0x127114=_0x3dc1d6[_0x32540f(0x152)](_0x22e3ec=>_0x22e3ec[_0x32540f(0x1f9)]==='PENDING')[_0x32540f(0x1b4)]((_0x2b88bf,_0x8bf195)=>_0x2b88bf+_0x8bf195['amount'],0x0),_0x5b6b9e=_0x3dc1d6[_0x32540f(0x1b4)]((_0x4c7128,_0xa373cf)=>{const _0x323237=_0x32540f;return _0x4c7128[_0xa373cf[_0x323237(0x171)]]=(_0x4c7128[_0xa373cf['network']]||0x0)+0x1,_0x4c7128;},{}),_0x5cf4ba=_0x3dc1d6['reduce']((_0x1800c3,_0x5862b8)=>{const _0x3412b7=_0x32540f;return _0x1800c3[_0x5862b8['status']]=(_0x1800c3[_0x5862b8[_0x3412b7(0x1f9)]]||0x0)+0x1,_0x1800c3;},{});return{'totalPayouts':_0x1eeff0,'completedPayouts':_0x2b6f32,'pendingPayouts':_0x3a3cb6,'rejectedPayouts':_0x5c53ad,'totalAmount':_0xb42310,'completedAmount':_0x47b4ae,'pendingAmount':_0x127114,'payoutsByMethod':_0x5b6b9e,'payoutsByStatus':_0x5cf4ba,'recentPayouts':_0x5b94f5[_0x32540f(0x15d)](_0x123bff=>({'id':_0x123bff['id'],'shopId':_0x32021b,'amount':_0x123bff[_0x32540f(0x17b)],'method':_0x123bff[_0x32540f(0x171)],'status':_0x123bff['status'],'txid':_0x123bff[_0x32540f(0x1fc)],'createdAt':_0x123bff[_0x32540f(0x215)],'paidAt':_0x123bff[_0x32540f(0x1e5)]}))};}async[a77_0x14cc47(0x1ae)](_0x7c1e8e){const _0x1cd02d=a77_0x14cc47;console[_0x1cd02d(0x146)](_0x1cd02d(0x165)+_0x7c1e8e+'...');const _0x48b189=await database_1['default'][_0x1cd02d(0x1ab)]['findUnique']({'where':{'id':_0x7c1e8e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x48b189)throw new Error(_0x1cd02d(0x150));const _0x162935=new Date(),_0x2e31e8=new Date(_0x162935[_0x1cd02d(0x17a)](),_0x162935['getMonth'](),0x1),_0x1c7da0=new Date(_0x162935['getFullYear'](),_0x162935[_0x1cd02d(0x1b3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x14abd1=await database_1['default'][_0x1cd02d(0x1e2)][_0x1cd02d(0x199)]({'_sum':{'amount':!![]},'where':{'shopId':_0x7c1e8e,'createdAt':{'gte':_0x2e31e8,'lte':_0x1c7da0},'status':'COMPLETED'}}),_0x512eb9=_0x14abd1[_0x1cd02d(0x143)][_0x1cd02d(0x17b)]||0x0,_0x16cdd4={'availableBalance':Math['round'](_0x48b189[_0x1cd02d(0x1de)]*0x64)/0x64,'totalPaidOut':Math[_0x1cd02d(0x1f1)](_0x48b189[_0x1cd02d(0x15e)]*0x64)/0x64,'awaitingPayout':Math[_0x1cd02d(0x1f1)](_0x48b189[_0x1cd02d(0x1de)]*0x64)/0x64,'thisMonth':Math[_0x1cd02d(0x1f1)](_0x512eb9*0x64)/0x64};return console['log'](_0x1cd02d(0x1f8)+_0x48b189[_0x1cd02d(0x183)]+_0x1cd02d(0x141)),console['log'](_0x1cd02d(0x1a8)+_0x16cdd4['availableBalance']+_0x1cd02d(0x185)),console[_0x1cd02d(0x146)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x16cdd4['totalPaidOut']+_0x1cd02d(0x20b)),console['log'](_0x1cd02d(0x1cf)+_0x16cdd4[_0x1cd02d(0x1cd)]+'\x20USDT\x20(current\x20balance)'),console[_0x1cd02d(0x146)](_0x1cd02d(0x17f)+_0x16cdd4[_0x1cd02d(0x1c7)]+_0x1cd02d(0x188)),_0x16cdd4;}[a77_0x14cc47(0x137)](_0x1eb824){const _0x44e956=a77_0x14cc47,_0x4b7f0d={'test_gateway':'Test\x20Gateway','plisio':_0x44e956(0x1ea),'rapyd':_0x44e956(0x1cc),'noda':_0x44e956(0x1ac),'cointopay':'CoinToPay','klyme_eu':'KLYME\x20EU','klyme_gb':_0x44e956(0x187),'klyme_de':_0x44e956(0x1e6)};return _0x4b7f0d[_0x1eb824]||_0x1eb824;}async['getPayoutStats'](_0x384d96){const _0x249e69=a77_0x14cc47;return this[_0x249e69(0x1ae)](_0x384d96);}async[a77_0x14cc47(0x1bb)](_0xe21590,_0x55c545){const _0x46d9e3=a77_0x14cc47,{page:_0x2cdfe3,limit:_0x54cebc,paymentId:_0x5485b8}=_0x55c545,_0x1b6ab5=(_0x2cdfe3-0x1)*_0x54cebc,_0x1eca71={'shopId':_0xe21590};_0x5485b8&&(_0x1eca71['paymentId']=_0x5485b8);const [_0x1179c9,_0x5b5b84]=await Promise[_0x46d9e3(0x160)]([database_1[_0x46d9e3(0x1eb)][_0x46d9e3(0x202)][_0x46d9e3(0x1b2)]({'where':_0x1eca71,'skip':_0x1b6ab5,'take':_0x54cebc,'orderBy':{'createdAt':_0x46d9e3(0x1d2)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x46d9e3(0x1eb)][_0x46d9e3(0x202)][_0x46d9e3(0x190)]({'where':_0x1eca71})]);return{'logs':_0x1179c9[_0x46d9e3(0x15d)](_0x2c75fa=>({'id':_0x2c75fa['id'],'paymentId':_0x2c75fa['paymentId'],'shopId':_0x2c75fa[_0x46d9e3(0x1e7)],'event':_0x2c75fa['event'],'statusCode':_0x2c75fa['statusCode'],'retryCount':_0x2c75fa[_0x46d9e3(0x206)],'responseBody':_0x2c75fa[_0x46d9e3(0x145)],'createdAt':_0x2c75fa[_0x46d9e3(0x215)],'payment':_0x2c75fa['payment']})),'pagination':{'page':_0x2cdfe3,'limit':_0x54cebc,'total':_0x5b5b84,'totalPages':Math[_0x46d9e3(0x20a)](_0x5b5b84/_0x54cebc)}};}async[a77_0x14cc47(0x205)](_0x5b4b2a,_0x2f17f9,_0x1762f2,_0x4a2bb9,_0x2f4af1){const _0x159fee=a77_0x14cc47;console[_0x159fee(0x146)](_0x159fee(0x197)+_0x5b4b2a+_0x159fee(0x153)+_0x2f17f9+_0x159fee(0x1e1)+_0x1762f2+_0x159fee(0x1df)+_0x4a2bb9);const _0x379335=_0x2f4af1?new Date(_0x2f4af1):new Date();let _0x2cbe22,_0x266f17;if(_0x1762f2&&_0x4a2bb9){const _0x10f9c1=new Date(_0x1762f2),_0x2ecb9e=new Date(_0x4a2bb9);_0x2cbe22=new Date(Date[_0x159fee(0x1a2)](_0x10f9c1[_0x159fee(0x166)](),_0x10f9c1['getUTCMonth'](),_0x10f9c1[_0x159fee(0x20f)](),0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x2ecb9e[_0x159fee(0x166)](),_0x2ecb9e[_0x159fee(0x13c)](),_0x2ecb9e[_0x159fee(0x20f)](),0x17,0x3b,0x3b,0x3e7)),console[_0x159fee(0x146)]('üìÖ\x20Custom\x20date\x20range:\x20'+_0x2cbe22[_0x159fee(0x1ad)]()+_0x159fee(0x1ef)+_0x266f17[_0x159fee(0x1ad)]());}else{if(_0x2f17f9&&_0x2f17f9[_0x159fee(0x1d0)](_0x159fee(0x1a9))){const _0x2d59ed=_0x2f17f9[_0x159fee(0x13a)](_0x159fee(0x1a9),'')['split']('_');if(_0x2d59ed[_0x159fee(0x1c1)]===0x2){const _0x5530b0=new Date(_0x2d59ed[0x0]),_0x558a09=new Date(_0x2d59ed[0x1]);_0x2cbe22=new Date(Date[_0x159fee(0x1a2)](_0x5530b0[_0x159fee(0x166)](),_0x5530b0[_0x159fee(0x13c)](),_0x5530b0[_0x159fee(0x20f)](),0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x558a09[_0x159fee(0x166)](),_0x558a09['getUTCMonth'](),_0x558a09[_0x159fee(0x20f)](),0x17,0x3b,0x3b,0x3e7)),console[_0x159fee(0x146)](_0x159fee(0x173)+_0x2cbe22['toISOString']()+'\x20to\x20'+_0x266f17[_0x159fee(0x1ad)]());}else{const _0x10820e=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),_0x379335[_0x159fee(0x20f)]()-0x1e));_0x2cbe22=new Date(Date['UTC'](_0x10820e['getUTCFullYear'](),_0x10820e[_0x159fee(0x13c)](),_0x10820e[_0x159fee(0x20f)](),0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),_0x379335[_0x159fee(0x20f)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x39709c=_0x2f17f9||_0x159fee(0x1ed);switch(_0x39709c['toLowerCase']()){case'today':_0x2cbe22=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),_0x379335[_0x159fee(0x20f)](),0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date['UTC'](_0x379335[_0x159fee(0x166)](),_0x379335['getUTCMonth'](),_0x379335[_0x159fee(0x20f)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x2a886a=new Date(_0x379335);_0x2a886a[_0x159fee(0x156)](_0x2a886a['getUTCDate']()-0x1),_0x2cbe22=new Date(Date['UTC'](_0x2a886a[_0x159fee(0x166)](),_0x2a886a[_0x159fee(0x13c)](),_0x2a886a[_0x159fee(0x20f)](),0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x2a886a[_0x159fee(0x166)](),_0x2a886a['getUTCMonth'](),_0x2a886a[_0x159fee(0x20f)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x2ed6cc=_0x379335[_0x159fee(0x1d6)](),_0xacc79e=_0x2ed6cc===0x0?-0x6:0x1-_0x2ed6cc,_0x94ddfe=_0x379335[_0x159fee(0x20f)]()+_0xacc79e;_0x2cbe22=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),_0x94ddfe,0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date['UTC'](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),_0x379335['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x159fee(0x18a):const _0x3ce319=new Date(Date[_0x159fee(0x1a2)](_0x379335['getUTCFullYear'](),_0x379335[_0x159fee(0x13c)](),_0x379335[_0x159fee(0x20f)]()-0x7)),_0x244503=_0x3ce319[_0x159fee(0x1d6)](),_0x365d21=_0x244503===0x0?-0x6:0x1-_0x244503,_0x123429=_0x3ce319[_0x159fee(0x20f)]()+_0x365d21;_0x2cbe22=new Date(Date['UTC'](_0x3ce319['getUTCFullYear'](),_0x3ce319[_0x159fee(0x13c)](),_0x123429,0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x3ce319[_0x159fee(0x166)](),_0x3ce319[_0x159fee(0x13c)](),_0x123429+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x159fee(0x1ed):_0x2cbe22=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),0x1,0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335['getUTCMonth'](),_0x379335[_0x159fee(0x20f)](),0x17,0x3b,0x3b,0x3e7));break;case _0x159fee(0x1cb):_0x2cbe22=new Date(Date['UTC'](_0x379335[_0x159fee(0x166)](),_0x379335['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x379335['getUTCFullYear'](),_0x379335[_0x159fee(0x13c)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x2cbe22=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date['UTC'](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),_0x379335['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x2cbe22=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),0x1,0x0,0x0,0x0,0x0)),_0x266f17=new Date(Date[_0x159fee(0x1a2)](_0x379335[_0x159fee(0x166)](),_0x379335[_0x159fee(0x13c)](),_0x379335['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x159fee(0x146)](_0x159fee(0x1b6)+_0x2cbe22[_0x159fee(0x1ad)]()+_0x159fee(0x1ef)+_0x266f17[_0x159fee(0x1ad)]());const _0x2f51ba={'gte':_0x2cbe22,'lte':_0x266f17},[_0x2234ee,_0x153495,_0x14d5a2,_0x1644bb,_0xd2e3fd,_0xda164e,_0x3e9c4b,_0x16930d,_0x49a57a,_0x5c3f46]=await Promise['all']([database_1[_0x159fee(0x1eb)][_0x159fee(0x18d)]['count']({'where':{'shopId':_0x5b4b2a,'gateway':{'not':_0x159fee(0x20d)},'status':{'notIn':[_0x159fee(0x15b),_0x159fee(0x1ca)]},'createdAt':_0x2f51ba}}),database_1[_0x159fee(0x1eb)][_0x159fee(0x18d)][_0x159fee(0x190)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':_0x159fee(0x20d)},'status':_0x159fee(0x186),'createdAt':_0x2f51ba}}),database_1['default'][_0x159fee(0x18d)][_0x159fee(0x190)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':_0x159fee(0x20d)},'status':_0x159fee(0x1e4)}}),database_1[_0x159fee(0x1eb)][_0x159fee(0x18d)][_0x159fee(0x190)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':'test_gateway'},'status':_0x159fee(0x203)}}),database_1[_0x159fee(0x1eb)][_0x159fee(0x18d)][_0x159fee(0x1b2)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':_0x159fee(0x20d)},'status':_0x159fee(0x186),'createdAt':_0x2f51ba},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x159fee(0x1eb)][_0x159fee(0x18d)][_0x159fee(0x1b2)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x159fee(0x1d2)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x159fee(0x1eb)]['payment'][_0x159fee(0x1b2)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':_0x159fee(0x20d)},'createdAt':_0x2f51ba},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x159fee(0x196)}}),database_1[_0x159fee(0x1eb)][_0x159fee(0x18d)][_0x159fee(0x190)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':'test_gateway'},'status':_0x159fee(0x186)}}),database_1[_0x159fee(0x1eb)][_0x159fee(0x18d)][_0x159fee(0x1b2)]({'where':{'shopId':_0x5b4b2a,'gateway':{'not':_0x159fee(0x20d)},'status':_0x159fee(0x186)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x159fee(0x1eb)][_0x159fee(0x1ab)]['findUnique']({'where':{'id':_0x5b4b2a},'select':{'balance':!![]}})]);let _0x18590f=0x0,_0x59c6a4=0x0;for(const _0x20885d of _0xd2e3fd){if(_0x20885d[_0x159fee(0x176)])_0x18590f+=_0x20885d[_0x159fee(0x176)];else{const _0x4986fd=await currencyService_1[_0x159fee(0x178)][_0x159fee(0x184)](_0x20885d[_0x159fee(0x17b)],_0x20885d[_0x159fee(0x204)]);_0x18590f+=_0x4986fd;}_0x20885d['amountAfterGatewayCommissionUSDT']&&(_0x59c6a4+=_0x20885d['amountAfterGatewayCommissionUSDT']);}let _0x1fdb9f=0x0;for(const _0x31265d of _0x49a57a){_0x31265d[_0x159fee(0x144)]&&(_0x1fdb9f+=_0x31265d[_0x159fee(0x144)]);}const _0x5a76ab=this[_0x159fee(0x189)](_0x3e9c4b,_0x2cbe22,_0x266f17||_0x379335),_0x4614c6=_0x2234ee>0x0?_0x153495/_0x2234ee*0x64:0x0,_0x1dd93b=_0x16930d>0x0?_0x14d5a2/_0x16930d*0x64:0x0;return{'totalPayments':_0x2234ee,'successfulPayments':_0x153495,'totalRevenue':Math['round'](_0x18590f*0x64)/0x64,'merchantEarnings':Math['round'](_0x59c6a4*0x64)/0x64,'merchantTotalRevenue':Math['round'](_0x1fdb9f*0x64)/0x64,'payoutBalance':Math[_0x159fee(0x1f1)]((_0x5c3f46?.[_0x159fee(0x1de)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x4614c6*0x64)/0x64,'chargebackRate':Math[_0x159fee(0x1f1)](_0x1dd93b*0x64)/0x64,'chargebacks':_0x14d5a2,'refunds':_0x1644bb,'dailyRevenue':_0x5a76ab['dailyRevenue'],'dailyPayments':_0x5a76ab[_0x159fee(0x1ee)],'recentPayments':_0xda164e[_0x159fee(0x15d)](_0x1d9b26=>({'id':_0x1d9b26['id'],'gateway':_0x1d9b26[_0x159fee(0x1ce)],'amount':_0x1d9b26[_0x159fee(0x17b)],'currency':_0x1d9b26[_0x159fee(0x204)],'status':_0x1d9b26[_0x159fee(0x1f9)],'createdAt':_0x1d9b26['createdAt']}))};}[a77_0x14cc47(0x189)](_0xade612,_0x2ec0ac,_0x4beca5){const _0x23a92b=a77_0x14cc47,_0x24b334=new Map(),_0x30b576=new Date(_0x2ec0ac);while(_0x30b576<=_0x4beca5){const _0x582bd1=_0x30b576[_0x23a92b(0x1ad)]()[_0x23a92b(0x1c8)]('T')[0x0];_0x24b334[_0x23a92b(0x191)](_0x582bd1,{'revenue':0x0,'count':0x0}),_0x30b576[_0x23a92b(0x14d)](_0x30b576['getDate']()+0x1);}for(const _0x4fd702 of _0xade612){const _0x3e3818=_0x4fd702[_0x23a92b(0x215)]['toISOString']()[_0x23a92b(0x1c8)]('T')[0x0],_0x51872c=_0x24b334[_0x23a92b(0x1c6)](_0x3e3818);_0x51872c&&(_0x51872c['count']+=0x1,_0x4fd702[_0x23a92b(0x1f9)]==='PAID'&&_0x4fd702[_0x23a92b(0x176)]&&(_0x51872c[_0x23a92b(0x1a4)]+=_0x4fd702['amountUSDT']));}const _0x31ceda=[],_0x21b83c=[];for(const [_0x2a2973,_0x5f5d84]of _0x24b334){_0x31ceda[_0x23a92b(0x1a1)]({'date':_0x2a2973,'amount':Math[_0x23a92b(0x1f1)](_0x5f5d84[_0x23a92b(0x1a4)]*0x64)/0x64}),_0x21b83c[_0x23a92b(0x1a1)]({'date':_0x2a2973,'count':_0x5f5d84['count']});}return{'dailyRevenue':_0x31ceda,'dailyPayments':_0x21b83c};}['generateBackupCodes'](_0x5d62ad=0x8){const _0x3d6326=a77_0x14cc47,_0x51b98d=[];for(let _0x19d58b=0x0;_0x19d58b<_0x5d62ad;_0x19d58b++){const _0x48562c=crypto_1[_0x3d6326(0x1eb)][_0x3d6326(0x19b)](0x4)['toString'](_0x3d6326(0x1b5))[_0x3d6326(0x1f5)]();_0x51b98d[_0x3d6326(0x1a1)](_0x48562c);}return _0x51b98d;}async[a77_0x14cc47(0x1d7)](_0x625f0){const _0x183c85=a77_0x14cc47,_0x162230=await database_1[_0x183c85(0x1eb)][_0x183c85(0x1ab)][_0x183c85(0x1f4)]({'where':{'id':_0x625f0},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x162230)throw new Error(_0x183c85(0x150));const _0x50bd1f=speakeasy_1[_0x183c85(0x1eb)][_0x183c85(0x1fd)]({'name':_0x183c85(0x14e)+_0x162230[_0x183c85(0x183)]+')','issuer':_0x183c85(0x1c9),'length':0x20}),_0x5a14ca=await qrcode_1[_0x183c85(0x1eb)]['toDataURL'](_0x50bd1f[_0x183c85(0x155)]),_0x25d286=this[_0x183c85(0x161)](0x8),_0x2f7465=await Promise[_0x183c85(0x160)](_0x25d286['map'](_0x161b79=>bcryptjs_1[_0x183c85(0x1eb)]['hash'](_0x161b79,0xa)));return await database_1[_0x183c85(0x1eb)]['shop'][_0x183c85(0x1b8)]({'where':{'id':_0x625f0},'data':{'twoFactorSecret':_0x50bd1f[_0x183c85(0x16b)],'backupCodes':JSON['stringify'](_0x2f7465)}}),console[_0x183c85(0x146)](_0x183c85(0x16d)+_0x162230[_0x183c85(0x183)]),console['log'](_0x183c85(0x16a)+_0x25d286['length']+_0x183c85(0x1b1)),{'secret':_0x50bd1f[_0x183c85(0x16b)],'qrCode':_0x5a14ca,'manualEntryKey':_0x50bd1f['base32'],'backupCodes':_0x25d286};}async[a77_0x14cc47(0x198)](_0xb82db5,_0x4c86b8){const _0x1f6c60=a77_0x14cc47,_0x36c8c6=await database_1[_0x1f6c60(0x1eb)]['shop'][_0x1f6c60(0x1f4)]({'where':{'id':_0xb82db5},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x36c8c6)throw new Error(_0x1f6c60(0x150));if(!_0x36c8c6[_0x1f6c60(0x175)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x36c8c6['twoFactorEnabled'])throw new Error(_0x1f6c60(0x1b0));const _0x447e3d=speakeasy_1['default'][_0x1f6c60(0x159)][_0x1f6c60(0x1d1)]({'secret':_0x36c8c6['twoFactorSecret'],'encoding':_0x1f6c60(0x16b),'token':_0x4c86b8,'window':0x2});if(!_0x447e3d)throw new Error(_0x1f6c60(0x149));return await database_1[_0x1f6c60(0x1eb)][_0x1f6c60(0x1ab)][_0x1f6c60(0x1b8)]({'where':{'id':_0xb82db5},'data':{'twoFactorEnabled':!![]}}),console[_0x1f6c60(0x146)](_0x1f6c60(0x207)+_0x36c8c6[_0x1f6c60(0x183)]),{'enabled':!![]};}async[a77_0x14cc47(0x15a)](_0x9ec76c){const _0x33f988=a77_0x14cc47,_0x4585e3=await database_1['default'][_0x33f988(0x1ab)][_0x33f988(0x1f4)]({'where':{'id':_0x9ec76c},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4585e3)throw new Error(_0x33f988(0x150));await database_1[_0x33f988(0x1eb)][_0x33f988(0x1ab)][_0x33f988(0x1b8)]({'where':{'id':_0x9ec76c},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log']('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x4585e3['username']);}}exports[a77_0x14cc47(0x1c2)]=ShopService;