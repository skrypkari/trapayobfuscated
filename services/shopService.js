'use strict';function a86_0x19ad(){const _0x30c102=['paymentGateways','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','__esModule','notes','generateSecret','USDC\x20Polygon','shopId','twoFactorEnabled','polygon_usdc','generateBackupCodes','getFullYear','ðŸ“Š\x20Final\x20WHERE\x20conditions:','Test\x20webhook\x20sent\x20successfully\x20(','all','amountAfterGatewayCommissionUSDT','totp','last_week','../config/database','hash','toDataURL',',\x20dateTo:\x20','ShopService','TrapaPay','status','event','amountIsEditable','toUpperCase','\x20payout\x20statistics\x20calculated:','webhookLog','getPaymentById','digest','PaymentService','setHours','generateDailyStatistics','trc20','polygon','dailyRevenue','30d','all_time','gatewaySettings','ðŸ“…\x20Final\x20date\x20range:\x20','usdtErcWallet','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','reduce','getUTCMonth','\x20USDT\x20(current\x20balance)','revenue','updatePayment','getWebhookLogs','...','USDT\x20Polygon','CHARGEBACK','replace','dailyPayments','PAID','twoFactorToken','UTC','Shop\x20not\x20found','base32','Error\x20parsing\x20webhook\x20events:','updateWallets','Test\x20Gateway','getPaymentsByShop','ðŸ“…\x20Date\x20end:\x20','message','sourceCurrency','yesterday','CoinToPay','crypto','this_week','getUTCFullYear','usdtPolygonWallet','convertToUSDT','currency','payout','periodTo','getTime','EXPIRED','getPaymentByShopAndId','getDate','custom_','name','shop','USDT\x20TRC20','application/json','customerName','username','getPayments','last_month','COMPLETED','4nCVOad','getPayoutStats','408162SOsbcD','No\x20webhook\x20URL\x20configured','deletePayment','getUTCDate','\x20USDT','test_gateway','\x20\x20\x20ðŸ’°\x20Total\x20paid\x20out:\x20','length','1607969ILpyzl','count','40bYNchd','getStatistics','today','network','\x20USDT\x20(total\x20payouts)','paymentId','createHmac','2FA\x20token\x20is\x20required','\x20to\x20',',\x20period:\x20','gte','1253yQmCfU','getShopProfile','findFirst','ðŸ“…\x20Period\x20end:\x20','merchantUrl','payment','erc20','publicKey','push','txid','filter','splice','randomBytes','isActive','otpauth_url','createdAt','testWebhook','country','../types/gateway','shopUrl','stringify','round','setDate','settings','thisMonth','Unknown\x20error','telegram','balance','telegramId','compare','setup2FA','webhookEvents','48537KkwUOl','KLYME\x20EU','usdtTrcWallet','45816ePnQJU','./paymentService','secretKey','amount','isArray','paidAt','ðŸ“Š\x20Payments\x20by\x20gateway\x20(all\x20time):','USD','hex','webhookUrl','1482MxShlD','this_month','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','map','default','USDT\x20ERC20','test_order_123','YESTERDAY','totalPaidOut','getMonth','ðŸ“Š\x20Status\x20filter:\x20','getPayoutStatistics','getUTCDay','usdcErcWallet','REFUND','5864QNrRxE','findMany','ðŸ“…\x20Date\x20start:\x20','usdcPolygonWallet','lte','backupCodes','amountUSDT','periodFrom','getGatewayDisplayName','update','Noda','bcryptjs','setUTCDate','defineProperty','log','./currencyService','__importDefault','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','test_payment_123','delete','updateShopProfile','get','includes','paymentService','ceil','Failed\x20to\x20send\x20webhook:\x20','Plisio','65500QBWjZv','disable2FA','twoFactorSecret','statusText','toLowerCase','PENDING','ðŸ”‘\x20Generated\x20','\x20backup\x20codes','wallets','maxPayments','customer','redirectUrl','speakeasy','enable2FA','usage','split','90d','test','gateways','Webhook\x20returned\x20error:\x20','ðŸ“Š\x20Shop\x20','statusCode','USDT\x20BSC','fullName','formatNetworkName','language','desc','toISOString','error','responseBody','createPayment','Payment\x20not\x20found','findUnique','getPayouts','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','3985QvmDan','parse','gateway','POST','_sum'];a86_0x19ad=function(){return _0x30c102;};return a86_0x19ad();}const a86_0x10476f=a86_0x53e2;(function(_0x1beffc,_0x3a59e9){const _0x3b309d=a86_0x53e2,_0x18ec57=_0x1beffc();while(!![]){try{const _0x290510=parseInt(_0x3b309d(0x197))/0x1+-parseInt(_0x3b309d(0x1cb))/0x2+parseInt(_0x3b309d(0x15f))/0x3*(-parseInt(_0x3b309d(0x15d))/0x4)+parseInt(_0x3b309d(0x1ee))/0x5*(parseInt(_0x3b309d(0x1a1))/0x6)+-parseInt(_0x3b309d(0x174))/0x7*(parseInt(_0x3b309d(0x1b0))/0x8)+-parseInt(_0x3b309d(0x194))/0x9*(-parseInt(_0x3b309d(0x169))/0xa)+parseInt(_0x3b309d(0x167))/0xb;if(_0x290510===_0x3a59e9)break;else _0x18ec57['push'](_0x18ec57['shift']());}catch(_0x24dcff){_0x18ec57['push'](_0x18ec57['shift']());}}}(a86_0x19ad,0x1af4f));var __importDefault=this&&this[a86_0x10476f(0x1c0)]||function(_0x54455f){const _0x4de40b=a86_0x10476f;return _0x54455f&&_0x54455f[_0x4de40b(0x1f5)]?_0x54455f:{'default':_0x54455f};};Object[a86_0x10476f(0x1bd)](exports,a86_0x10476f(0x1f5),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require(a86_0x10476f(0x114))),bcryptjs_1=__importDefault(require(a86_0x10476f(0x1bb))),crypto_1=__importDefault(require(a86_0x10476f(0x147))),speakeasy_1=__importDefault(require(a86_0x10476f(0x1d7))),qrcode_1=__importDefault(require('qrcode')),currencyService_1=require(a86_0x10476f(0x1bf)),paymentService_1=require(a86_0x10476f(0x198)),gateway_1=require(a86_0x10476f(0x186));class ShopService{constructor(){const _0x4f51c3=a86_0x10476f;this[_0x4f51c3(0x1c7)]=new paymentService_1[(_0x4f51c3(0x122))]();}async[a86_0x10476f(0x175)](_0x197a9b){const _0x23b740=a86_0x10476f,_0x589b6c=await database_1['default'][_0x23b740(0x155)][_0x23b740(0x1eb)]({'where':{'id':_0x197a9b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x589b6c)throw new Error(_0x23b740(0x13c));let _0x3bf07c=[];if(_0x589b6c['settings']?.[_0x23b740(0x193)])try{_0x3bf07c=Array[_0x23b740(0x19b)](_0x589b6c['settings'][_0x23b740(0x193)])?_0x589b6c['settings'][_0x23b740(0x193)]:JSON[_0x23b740(0x1ef)](_0x589b6c['settings'][_0x23b740(0x193)]);}catch(_0x547201){console[_0x23b740(0x1e7)](_0x23b740(0x13e),_0x547201),_0x3bf07c=[];}const _0x4592fb=gateway_1['AVAILABLE_GATEWAYS'][_0x23b740(0x17e)](_0x3c2565=>_0x3c2565[_0x23b740(0x181)])[_0x23b740(0x1a4)](_0x2c7e76=>_0x2c7e76[_0x23b740(0x154)]);let _0x48b650=_0x589b6c[_0x23b740(0x1f3)]?JSON[_0x23b740(0x1ef)](_0x589b6c[_0x23b740(0x1f3)]):[];return Array[_0x23b740(0x19b)](_0x48b650)&&(_0x48b650=_0x48b650[_0x23b740(0x1a4)](_0x1fccac=>_0x1fccac[_0x23b740(0x137)](/\s+/g,'_')[_0x23b740(0x1cf)]())[_0x23b740(0x17e)](_0x26226e=>_0x4592fb[_0x23b740(0x1c6)](_0x26226e))),{'id':_0x589b6c['id'],'fullName':_0x589b6c[_0x23b740(0x154)],'username':_0x589b6c['username'],'telegramId':_0x589b6c[_0x23b740(0x18e)],'merchantUrl':_0x589b6c[_0x23b740(0x187)],'gateways':_0x48b650,'gatewaySettings':_0x589b6c[_0x23b740(0x12a)]?JSON[_0x23b740(0x1ef)](_0x589b6c[_0x23b740(0x12a)]):null,'publicKey':_0x589b6c[_0x23b740(0x17b)],'secretKey':_0x589b6c[_0x23b740(0x199)],'webhookUrl':_0x589b6c[_0x23b740(0x18b)]?.[_0x23b740(0x1a0)]||null,'webhookEvents':_0x3bf07c,'wallets':{'usdtPolygonWallet':_0x589b6c[_0x23b740(0x14a)],'usdtTrcWallet':_0x589b6c[_0x23b740(0x196)],'usdtErcWallet':_0x589b6c[_0x23b740(0x12c)],'usdcPolygonWallet':_0x589b6c[_0x23b740(0x1b3)],'usdcErcWallet':_0x589b6c['usdcErcWallet']},'status':_0x589b6c['status'],'createdAt':_0x589b6c[_0x23b740(0x183)]};}async[a86_0x10476f(0x1c4)](_0x2a6af6,_0x36debe){const _0x1a4654=a86_0x10476f,_0x4db879={};_0x36debe[_0x1a4654(0x1e2)]&&(_0x4db879['name']=_0x36debe[_0x1a4654(0x1e2)]);_0x36debe[_0x1a4654(0x190)]!==undefined&&(_0x4db879['telegram']=_0x36debe['telegramId']||null);_0x36debe[_0x1a4654(0x178)]&&(_0x4db879[_0x1a4654(0x187)]=_0x36debe['merchantUrl']);_0x36debe[_0x1a4654(0x1dd)]&&(_0x4db879[_0x1a4654(0x1f3)]=JSON[_0x1a4654(0x188)](_0x36debe[_0x1a4654(0x1dd)]));_0x36debe[_0x1a4654(0x12a)]&&(_0x4db879[_0x1a4654(0x12a)]=JSON[_0x1a4654(0x188)](_0x36debe[_0x1a4654(0x12a)]));_0x36debe[_0x1a4654(0x1d3)]&&(_0x36debe['wallets'][_0x1a4654(0x14a)]!==undefined&&(_0x4db879[_0x1a4654(0x14a)]=_0x36debe[_0x1a4654(0x1d3)][_0x1a4654(0x14a)]||null),_0x36debe[_0x1a4654(0x1d3)][_0x1a4654(0x196)]!==undefined&&(_0x4db879[_0x1a4654(0x196)]=_0x36debe[_0x1a4654(0x1d3)][_0x1a4654(0x196)]||null),_0x36debe['wallets'][_0x1a4654(0x12c)]!==undefined&&(_0x4db879[_0x1a4654(0x12c)]=_0x36debe[_0x1a4654(0x1d3)][_0x1a4654(0x12c)]||null),_0x36debe[_0x1a4654(0x1d3)]['usdcPolygonWallet']!==undefined&&(_0x4db879[_0x1a4654(0x1b3)]=_0x36debe[_0x1a4654(0x1d3)][_0x1a4654(0x1b3)]||null));const _0x110736=await database_1[_0x1a4654(0x1a5)][_0x1a4654(0x155)]['update']({'where':{'id':_0x2a6af6},'data':_0x4db879,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x44b3cc=[];if(_0x110736['settings']?.[_0x1a4654(0x193)])try{_0x44b3cc=Array['isArray'](_0x110736[_0x1a4654(0x18b)]['webhookEvents'])?_0x110736[_0x1a4654(0x18b)]['webhookEvents']:JSON['parse'](_0x110736[_0x1a4654(0x18b)][_0x1a4654(0x193)]);}catch(_0x3d87a4){console[_0x1a4654(0x1e7)]('Error\x20parsing\x20webhook\x20events:',_0x3d87a4),_0x44b3cc=[];}return{'id':_0x110736['id'],'fullName':_0x110736[_0x1a4654(0x154)],'username':_0x110736['username'],'telegramId':_0x110736[_0x1a4654(0x18e)],'merchantUrl':_0x110736['shopUrl'],'gateways':_0x110736[_0x1a4654(0x1f3)]?JSON[_0x1a4654(0x1ef)](_0x110736[_0x1a4654(0x1f3)]):null,'gatewaySettings':_0x110736[_0x1a4654(0x12a)]?JSON[_0x1a4654(0x1ef)](_0x110736['gatewaySettings']):null,'publicKey':_0x110736['publicKey'],'secretKey':_0x110736[_0x1a4654(0x199)],'webhookUrl':_0x110736[_0x1a4654(0x18b)]?.[_0x1a4654(0x1a0)]||null,'webhookEvents':_0x44b3cc,'wallets':{'usdtPolygonWallet':_0x110736[_0x1a4654(0x14a)],'usdtTrcWallet':_0x110736[_0x1a4654(0x196)],'usdtErcWallet':_0x110736[_0x1a4654(0x12c)],'usdcPolygonWallet':_0x110736[_0x1a4654(0x1b3)],'usdcErcWallet':_0x110736[_0x1a4654(0x1ae)]},'status':_0x110736['status'],'createdAt':_0x110736[_0x1a4654(0x183)]};}async[a86_0x10476f(0x13f)](_0x492fc9,_0x1650a2){const _0x153d7c=a86_0x10476f,_0x40bd97=await database_1['default'][_0x153d7c(0x155)][_0x153d7c(0x1eb)]({'where':{'id':_0x492fc9},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x40bd97)throw new Error(_0x153d7c(0x13c));if(_0x40bd97[_0x153d7c(0x1fa)]){if(!_0x1650a2['twoFactorToken'])throw new Error(_0x153d7c(0x170));const _0x1e8df0=speakeasy_1[_0x153d7c(0x1a5)][_0x153d7c(0x112)]['verify']({'secret':_0x40bd97[_0x153d7c(0x1cd)],'encoding':'base32','token':_0x1650a2[_0x153d7c(0x13a)],'window':0x2});if(!_0x1e8df0){let _0xdb1bf9=![];if(_0x40bd97[_0x153d7c(0x1b5)]){const _0x204e8c=JSON[_0x153d7c(0x1ef)](_0x40bd97['backupCodes']);for(let _0x25c26d=0x0;_0x25c26d<_0x204e8c[_0x153d7c(0x166)];_0x25c26d++){const _0x4cc344=await bcryptjs_1[_0x153d7c(0x1a5)][_0x153d7c(0x191)](_0x1650a2[_0x153d7c(0x13a)],_0x204e8c[_0x25c26d]);if(_0x4cc344){_0xdb1bf9=!![],_0x204e8c[_0x153d7c(0x17f)](_0x25c26d,0x1),await database_1['default'][_0x153d7c(0x155)][_0x153d7c(0x1b9)]({'where':{'id':_0x492fc9},'data':{'backupCodes':JSON[_0x153d7c(0x188)](_0x204e8c)}});break;}}}if(!_0xdb1bf9)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x45446f={};_0x1650a2['usdtPolygonWallet']!==undefined&&(_0x45446f['usdtPolygonWallet']=_0x1650a2['usdtPolygonWallet']||null),_0x1650a2[_0x153d7c(0x196)]!==undefined&&(_0x45446f[_0x153d7c(0x196)]=_0x1650a2[_0x153d7c(0x196)]||null),_0x1650a2['usdtErcWallet']!==undefined&&(_0x45446f['usdtErcWallet']=_0x1650a2['usdtErcWallet']||null),_0x1650a2[_0x153d7c(0x1b3)]!==undefined&&(_0x45446f[_0x153d7c(0x1b3)]=_0x1650a2[_0x153d7c(0x1b3)]||null),_0x1650a2['usdcErcWallet']!==undefined&&(_0x45446f['usdcErcWallet']=_0x1650a2[_0x153d7c(0x1ae)]||null),await database_1[_0x153d7c(0x1a5)][_0x153d7c(0x155)]['update']({'where':{'id':_0x492fc9},'data':_0x45446f});}async[a86_0x10476f(0x184)](_0xde5d9){const _0x126334=a86_0x10476f,_0x469359=await database_1['default'][_0x126334(0x155)][_0x126334(0x1eb)]({'where':{'id':_0xde5d9},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x469359?.[_0x126334(0x18b)]?.[_0x126334(0x1a0)])throw new Error(_0x126334(0x160));const _0x384f2c={'event':_0x126334(0x1dc),'payment':{'id':_0x126334(0x1c2),'order_id':_0x126334(0x1a7),'gateway':_0x126334(0x1dc),'amount':0x64,'currency':_0x126334(0x19e),'status':'paid','created_at':new Date()[_0x126334(0x1e6)]()}};try{const _0x542115=JSON[_0x126334(0x188)](_0x384f2c),_0x59a0ea=crypto_1['default'][_0x126334(0x16f)]('sha256',_0x469359[_0x126334(0x199)])['update'](_0x542115)[_0x126334(0x121)](_0x126334(0x19f)),_0x35678e=await fetch(_0x469359['settings'][_0x126334(0x1a0)],{'method':_0x126334(0x1f1),'headers':{'Content-Type':_0x126334(0x157),'User-Agent':'Payment\x20System/1.0\x20(Test)','X-Webhook-Signature':_0x59a0ea},'body':_0x542115});return _0x35678e['ok']?{'success':!![],'message':_0x126334(0x1ff)+_0x35678e['status']+')'}:{'success':![],'message':_0x126334(0x1de)+_0x35678e[_0x126334(0x11a)]+'\x20'+_0x35678e[_0x126334(0x1ce)]};}catch(_0x700130){return{'success':![],'message':_0x126334(0x1c9)+(_0x700130 instanceof Error?_0x700130[_0x126334(0x143)]:_0x126334(0x18d))};}}async[a86_0x10476f(0x1e9)](_0x21c0bf){const _0x4eeda5=a86_0x10476f;return this[_0x4eeda5(0x1c7)]['createPublicPayment']({'public_key':'','gateway':_0x21c0bf[_0x4eeda5(0x1f0)],'order_id':undefined,'amount':_0x21c0bf[_0x4eeda5(0x19a)],'currency':_0x21c0bf[_0x4eeda5(0x14c)],'source_currency':_0x21c0bf[_0x4eeda5(0x144)],'usage':_0x21c0bf[_0x4eeda5(0x1d9)],'expires_at':_0x21c0bf['expiresAt']?.[_0x4eeda5(0x1e6)](),'success_url':_0x21c0bf[_0x4eeda5(0x1d6)],'fail_url':_0x21c0bf[_0x4eeda5(0x1d6)],'customer_email':_0x21c0bf['customerEmail'],'customer_name':_0x21c0bf[_0x4eeda5(0x158)],'country':_0x21c0bf[_0x4eeda5(0x185)],'language':_0x21c0bf[_0x4eeda5(0x1e4)],'amount_is_editable':_0x21c0bf[_0x4eeda5(0x11c)],'max_payments':_0x21c0bf[_0x4eeda5(0x1d4)],'customer':_0x21c0bf[_0x4eeda5(0x1d5)]});}async[a86_0x10476f(0x15a)](_0x40994a,_0x44a02e){const _0x32bc7a=a86_0x10476f;return this['paymentService'][_0x32bc7a(0x141)](_0x40994a,_0x44a02e);}async[a86_0x10476f(0x120)](_0x4bdb73,_0xa666a){const _0x5610c6=a86_0x10476f;return this['paymentService'][_0x5610c6(0x151)](_0x4bdb73,_0xa666a);}async[a86_0x10476f(0x132)](_0x190a0e,_0x823e41,_0x1f3938){const _0x6f73bd=a86_0x10476f,_0x51d848=await database_1['default'][_0x6f73bd(0x179)][_0x6f73bd(0x176)]({'where':{'id':_0x823e41,'shopId':_0x190a0e}});if(!_0x51d848)throw new Error('Payment\x20not\x20found');const _0x1700c0=await database_1[_0x6f73bd(0x1a5)][_0x6f73bd(0x179)][_0x6f73bd(0x1b9)]({'where':{'id':_0x823e41},'data':{..._0x1f3938,'updatedAt':new Date()}});return _0x1700c0;}async[a86_0x10476f(0x161)](_0x28bd65,_0x4ea1de){const _0x546665=a86_0x10476f,_0x5132a1=await database_1['default'][_0x546665(0x179)][_0x546665(0x176)]({'where':{'id':_0x4ea1de,'shopId':_0x28bd65}});if(!_0x5132a1)throw new Error(_0x546665(0x1ea));await database_1[_0x546665(0x1a5)][_0x546665(0x179)][_0x546665(0x1c3)]({'where':{'id':_0x4ea1de}});}[a86_0x10476f(0x1e3)](_0x3ee25a){const _0x1d6643=a86_0x10476f,_0x461c7c={'polygon':_0x1d6643(0x135),'trc20':_0x1d6643(0x156),'erc20':_0x1d6643(0x1a6),'bsc':_0x1d6643(0x1e1),'polygon_usdc':_0x1d6643(0x1f8),'erc20_usdc':'USDC\x20Ethereum'};return _0x461c7c[_0x3ee25a]||_0x3ee25a;}async[a86_0x10476f(0x1ec)](_0x66e06b,_0x1bde23){const _0x2907fd=a86_0x10476f,{page:_0x13c834,limit:_0x129aff,status:_0x1507e5,method:_0x4a7aae,network:_0x50cecb,dateFrom:_0x404b9b,dateTo:_0x3239d7,periodFrom:_0x5d73e9,periodTo:_0x59cba0}=_0x1bde23,_0x55db9e=(_0x13c834-0x1)*_0x129aff;console['log']('ðŸ’°\x20Getting\x20payouts\x20with\x20filters:',_0x1bde23);const _0x18c781={'shopId':_0x66e06b};_0x1507e5&&(_0x18c781[_0x2907fd(0x11a)]=_0x1507e5[_0x2907fd(0x11d)](),console[_0x2907fd(0x1be)](_0x2907fd(0x1ab)+_0x1507e5['toUpperCase']()));if(_0x4a7aae)_0x18c781[_0x2907fd(0x16c)]=_0x4a7aae,console[_0x2907fd(0x1be)]('ðŸŒ\x20Method\x20filter:\x20'+_0x4a7aae);else _0x50cecb&&(_0x18c781[_0x2907fd(0x16c)]=_0x50cecb,console[_0x2907fd(0x1be)]('ðŸŒ\x20Network\x20filter:\x20'+_0x50cecb));if(_0x404b9b||_0x3239d7||_0x5d73e9||_0x59cba0){_0x18c781[_0x2907fd(0x183)]={};if(_0x5d73e9){const _0x269470=new Date(_0x5d73e9);_0x269470['setHours'](0x0,0x0,0x0,0x1),_0x18c781[_0x2907fd(0x183)][_0x2907fd(0x173)]=_0x269470,console[_0x2907fd(0x1be)]('ðŸ“…\x20Period\x20start:\x20'+_0x269470[_0x2907fd(0x1e6)]());}else{if(_0x404b9b){const _0x33aa78=new Date(_0x404b9b);_0x33aa78[_0x2907fd(0x123)](0x0,0x0,0x0,0x1),_0x18c781[_0x2907fd(0x183)]['gte']=_0x33aa78,console[_0x2907fd(0x1be)](_0x2907fd(0x1b2)+_0x33aa78[_0x2907fd(0x1e6)]());}}if(_0x59cba0){const _0x50e503=new Date(_0x59cba0);_0x50e503[_0x2907fd(0x123)](0x17,0x3b,0x3b,0x3e7),_0x18c781[_0x2907fd(0x183)]['lte']=_0x50e503,console[_0x2907fd(0x1be)](_0x2907fd(0x177)+_0x50e503[_0x2907fd(0x1e6)]());}else{if(_0x3239d7){const _0x4d84af=new Date(_0x3239d7);_0x4d84af[_0x2907fd(0x123)](0x17,0x3b,0x3b,0x3e7),_0x18c781[_0x2907fd(0x183)]['lte']=_0x4d84af,console['log'](_0x2907fd(0x142)+_0x4d84af[_0x2907fd(0x1e6)]());}}}console[_0x2907fd(0x1be)](_0x2907fd(0x1fe),JSON[_0x2907fd(0x188)](_0x18c781,null,0x2));const [_0x492d1f,_0x151b89]=await Promise['all']([database_1[_0x2907fd(0x1a5)][_0x2907fd(0x14d)][_0x2907fd(0x1b1)]({'where':_0x18c781,'skip':_0x55db9e,'take':_0x129aff,'orderBy':{'createdAt':_0x2907fd(0x1e5)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x2907fd(0x1a5)][_0x2907fd(0x14d)][_0x2907fd(0x168)]({'where':_0x18c781})]);return{'payouts':_0x492d1f[_0x2907fd(0x1a4)](_0x466332=>{const _0x2b18d7=_0x2907fd;let _0x16da6e=null;switch(_0x466332[_0x2b18d7(0x16c)]){case _0x2b18d7(0x126):_0x16da6e=_0x466332['shop'][_0x2b18d7(0x14a)];break;case _0x2b18d7(0x125):_0x16da6e=_0x466332[_0x2b18d7(0x155)][_0x2b18d7(0x196)];break;case _0x2b18d7(0x17a):_0x16da6e=_0x466332[_0x2b18d7(0x155)]['usdtErcWallet'];break;case _0x2b18d7(0x1fb):_0x16da6e=_0x466332['shop'][_0x2b18d7(0x1b3)];break;case'erc20_usdc':_0x16da6e=_0x466332[_0x2b18d7(0x155)][_0x2b18d7(0x1ae)];break;}return{'id':_0x466332['id'],'amount':_0x466332['amount'],'network':this['formatNetworkName'](_0x466332[_0x2b18d7(0x16c)]),'wallet':_0x16da6e,'status':_0x466332['status'],'txid':_0x466332[_0x2b18d7(0x17d)],'notes':_0x466332[_0x2b18d7(0x1f6)],'periodFrom':_0x466332[_0x2b18d7(0x1b7)],'periodTo':_0x466332[_0x2b18d7(0x14e)],'createdAt':_0x466332[_0x2b18d7(0x183)],'paidAt':_0x466332[_0x2b18d7(0x19c)]};}),'pagination':{'page':_0x13c834,'limit':_0x129aff,'total':_0x151b89,'totalPages':Math[_0x2907fd(0x1c8)](_0x151b89/_0x129aff)}};}async['getPayoutById'](_0x1a3a09,_0x5b98ed){const _0x3ab37f=a86_0x10476f,_0x23fc64=await database_1[_0x3ab37f(0x1a5)][_0x3ab37f(0x14d)][_0x3ab37f(0x176)]({'where':{'id':_0x5b98ed,'shopId':_0x1a3a09}});if(!_0x23fc64)return null;return{'id':_0x23fc64['id'],'amount':_0x23fc64[_0x3ab37f(0x19a)],'network':_0x23fc64[_0x3ab37f(0x16c)],'status':_0x23fc64[_0x3ab37f(0x11a)],'txid':_0x23fc64[_0x3ab37f(0x17d)],'notes':_0x23fc64['notes'],'createdAt':_0x23fc64['createdAt'],'paidAt':_0x23fc64[_0x3ab37f(0x19c)]};}async[a86_0x10476f(0x1ac)](_0x3bab69,_0x10ebde){const _0x574867=a86_0x10476f,_0x2c248f=new Date();let _0x1e3436,_0x40b291;switch(_0x10ebde){case'yesterday':case _0x574867(0x1a8):const _0xd45f00=new Date(_0x2c248f);_0xd45f00[_0x574867(0x18a)](_0xd45f00[_0x574867(0x152)]()-0x1),_0x1e3436=new Date(_0xd45f00),_0x1e3436['setHours'](0x0,0x0,0x0,0x0),_0x40b291=new Date(_0xd45f00),_0x40b291[_0x574867(0x123)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x1e3436=new Date(_0x2c248f['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x574867(0x128):_0x1e3436=new Date(_0x2c248f[_0x574867(0x14f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x574867(0x1db):_0x1e3436=new Date(_0x2c248f[_0x574867(0x14f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1e3436=new Date(_0x2c248f['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x3a120d={'gte':_0x1e3436};_0x40b291&&(_0x3a120d[_0x574867(0x1b4)]=_0x40b291);const [_0x289a96,_0x4e790d,_0x20654c,_0x33240b,_0x47697c,_0x3a9ae6]=await Promise[_0x574867(0x110)]([database_1['default']['payout']['count']({'where':{'shopId':_0x3bab69,'createdAt':_0x3a120d}}),database_1[_0x574867(0x1a5)]['payout'][_0x574867(0x168)]({'where':{'shopId':_0x3bab69,'status':_0x574867(0x15c),'createdAt':_0x3a120d}}),database_1[_0x574867(0x1a5)][_0x574867(0x14d)][_0x574867(0x168)]({'where':{'shopId':_0x3bab69,'status':_0x574867(0x1d0),'createdAt':_0x3a120d}}),database_1[_0x574867(0x1a5)][_0x574867(0x14d)]['count']({'where':{'shopId':_0x3bab69,'status':'REJECTED','createdAt':_0x3a120d}}),database_1[_0x574867(0x1a5)][_0x574867(0x14d)][_0x574867(0x1b1)]({'where':{'shopId':_0x3bab69,'createdAt':_0x3a120d},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x574867(0x1a5)][_0x574867(0x14d)][_0x574867(0x1b1)]({'where':{'shopId':_0x3bab69},'take':0xa,'orderBy':{'createdAt':_0x574867(0x1e5)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x380a96=_0x47697c[_0x574867(0x12e)]((_0x23b75f,_0x1ea710)=>_0x23b75f+_0x1ea710[_0x574867(0x19a)],0x0),_0x173b88=_0x47697c[_0x574867(0x17e)](_0x445d92=>_0x445d92[_0x574867(0x11a)]===_0x574867(0x15c))[_0x574867(0x12e)]((_0x53a42f,_0x34cbb1)=>_0x53a42f+_0x34cbb1[_0x574867(0x19a)],0x0),_0x298f16=_0x47697c[_0x574867(0x17e)](_0x45bc7a=>_0x45bc7a[_0x574867(0x11a)]===_0x574867(0x1d0))[_0x574867(0x12e)]((_0x49f11b,_0x187c7c)=>_0x49f11b+_0x187c7c[_0x574867(0x19a)],0x0),_0x35a215=_0x47697c['reduce']((_0x321a9a,_0x52b537)=>{const _0x226e86=_0x574867;return _0x321a9a[_0x52b537[_0x226e86(0x16c)]]=(_0x321a9a[_0x52b537[_0x226e86(0x16c)]]||0x0)+0x1,_0x321a9a;},{}),_0x221883=_0x47697c[_0x574867(0x12e)]((_0x442cb5,_0x2fa836)=>{const _0x4fa19b=_0x574867;return _0x442cb5[_0x2fa836[_0x4fa19b(0x11a)]]=(_0x442cb5[_0x2fa836['status']]||0x0)+0x1,_0x442cb5;},{});return{'totalPayouts':_0x289a96,'completedPayouts':_0x4e790d,'pendingPayouts':_0x20654c,'rejectedPayouts':_0x33240b,'totalAmount':_0x380a96,'completedAmount':_0x173b88,'pendingAmount':_0x298f16,'payoutsByMethod':_0x35a215,'payoutsByStatus':_0x221883,'recentPayouts':_0x3a9ae6['map'](_0x4858f7=>({'id':_0x4858f7['id'],'shopId':_0x3bab69,'amount':_0x4858f7[_0x574867(0x19a)],'method':_0x4858f7[_0x574867(0x16c)],'status':_0x4858f7[_0x574867(0x11a)],'txid':_0x4858f7['txid'],'createdAt':_0x4858f7[_0x574867(0x183)],'paidAt':_0x4858f7[_0x574867(0x19c)]}))};}async['getShopPayoutStats'](_0x1d3a75){const _0x291073=a86_0x10476f;console['log']('ðŸ“Š\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x1d3a75+_0x291073(0x134));const _0x59ae60=await database_1[_0x291073(0x1a5)][_0x291073(0x155)][_0x291073(0x1eb)]({'where':{'id':_0x1d3a75},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x59ae60)throw new Error(_0x291073(0x13c));const _0x1231d8=new Date(),_0x4c7695=new Date(_0x1231d8[_0x291073(0x1fd)](),_0x1231d8[_0x291073(0x1aa)](),0x1),_0x1ca330=new Date(_0x1231d8['getFullYear'](),_0x1231d8['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x21d302=await database_1['default'][_0x291073(0x14d)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x1d3a75,'createdAt':{'gte':_0x4c7695,'lte':_0x1ca330},'status':_0x291073(0x15c)}}),_0x102c59=_0x21d302[_0x291073(0x1f2)][_0x291073(0x19a)]||0x0,_0x42e709={'availableBalance':Math[_0x291073(0x189)](_0x59ae60[_0x291073(0x18f)]*0x64)/0x64,'totalPaidOut':Math[_0x291073(0x189)](_0x59ae60[_0x291073(0x1a9)]*0x64)/0x64,'awaitingPayout':Math[_0x291073(0x189)](_0x59ae60['balance']*0x64)/0x64,'thisMonth':Math['round'](_0x102c59*0x64)/0x64};return console['log'](_0x291073(0x1df)+_0x59ae60[_0x291073(0x159)]+_0x291073(0x11e)),console[_0x291073(0x1be)](_0x291073(0x1a3)+_0x42e709['availableBalance']+_0x291073(0x130)),console[_0x291073(0x1be)](_0x291073(0x165)+_0x42e709[_0x291073(0x1a9)]+_0x291073(0x16d)),console[_0x291073(0x1be)]('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x42e709['awaitingPayout']+_0x291073(0x130)),console[_0x291073(0x1be)](_0x291073(0x12d)+_0x42e709[_0x291073(0x18c)]+_0x291073(0x163)),_0x42e709;}[a86_0x10476f(0x1b8)](_0x13d48e){const _0x5c7060=a86_0x10476f,_0x3291b5={'test_gateway':_0x5c7060(0x140),'plisio':_0x5c7060(0x1ca),'rapyd':'Rapyd','noda':_0x5c7060(0x1ba),'cointopay':_0x5c7060(0x146),'klyme_eu':_0x5c7060(0x195),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x3291b5[_0x13d48e]||_0x13d48e;}async[a86_0x10476f(0x15e)](_0x1040f8){return this['getShopPayoutStats'](_0x1040f8);}async[a86_0x10476f(0x133)](_0x5708fd,_0x54ff7c){const _0x5d75ed=a86_0x10476f,{page:_0x10eaf9,limit:_0x204f39,paymentId:_0x14db52}=_0x54ff7c,_0x56db31=(_0x10eaf9-0x1)*_0x204f39,_0x5a18ef={'shopId':_0x5708fd};_0x14db52&&(_0x5a18ef['paymentId']=_0x14db52);const [_0x22ca1a,_0x18a15f]=await Promise[_0x5d75ed(0x110)]([database_1['default'][_0x5d75ed(0x11f)][_0x5d75ed(0x1b1)]({'where':_0x5a18ef,'skip':_0x56db31,'take':_0x204f39,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x5d75ed(0x1a5)][_0x5d75ed(0x11f)][_0x5d75ed(0x168)]({'where':_0x5a18ef})]);return{'logs':_0x22ca1a[_0x5d75ed(0x1a4)](_0x23c4cf=>({'id':_0x23c4cf['id'],'paymentId':_0x23c4cf[_0x5d75ed(0x16e)],'shopId':_0x23c4cf[_0x5d75ed(0x1f9)],'event':_0x23c4cf[_0x5d75ed(0x11b)],'statusCode':_0x23c4cf[_0x5d75ed(0x1e0)],'retryCount':_0x23c4cf['retryCount'],'responseBody':_0x23c4cf[_0x5d75ed(0x1e8)],'createdAt':_0x23c4cf[_0x5d75ed(0x183)],'payment':_0x23c4cf['payment']})),'pagination':{'page':_0x10eaf9,'limit':_0x204f39,'total':_0x18a15f,'totalPages':Math[_0x5d75ed(0x1c8)](_0x18a15f/_0x204f39)}};}async[a86_0x10476f(0x16a)](_0x9f6dab,_0x287651,_0x4a2137,_0x5421b7,_0x49abd2){const _0x48d096=a86_0x10476f;console['log']('ðŸ“Š\x20Getting\x20statistics\x20for\x20shop\x20'+_0x9f6dab+_0x48d096(0x172)+_0x287651+',\x20dateFrom:\x20'+_0x4a2137+_0x48d096(0x117)+_0x5421b7);const _0x915a18=_0x49abd2?new Date(_0x49abd2):new Date();let _0x42eb13,_0x52fc6c;if(_0x4a2137&&_0x5421b7){const _0x1918e7=new Date(_0x4a2137),_0x1fef2e=new Date(_0x5421b7);_0x42eb13=new Date(Date['UTC'](_0x1918e7[_0x48d096(0x149)](),_0x1918e7['getUTCMonth'](),_0x1918e7[_0x48d096(0x162)](),0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date[_0x48d096(0x13b)](_0x1fef2e[_0x48d096(0x149)](),_0x1fef2e[_0x48d096(0x12f)](),_0x1fef2e[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7)),console[_0x48d096(0x1be)]('ðŸ“…\x20Custom\x20date\x20range:\x20'+_0x42eb13[_0x48d096(0x1e6)]()+'\x20to\x20'+_0x52fc6c[_0x48d096(0x1e6)]());}else{if(_0x287651&&_0x287651['startsWith'](_0x48d096(0x153))){const _0x476317=_0x287651['replace'](_0x48d096(0x153),'')[_0x48d096(0x1da)]('_');if(_0x476317[_0x48d096(0x166)]===0x2){const _0x39027e=new Date(_0x476317[0x0]),_0xe0df8b=new Date(_0x476317[0x1]);_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x39027e[_0x48d096(0x149)](),_0x39027e[_0x48d096(0x12f)](),_0x39027e['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date['UTC'](_0xe0df8b[_0x48d096(0x149)](),_0xe0df8b[_0x48d096(0x12f)](),_0xe0df8b[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7)),console[_0x48d096(0x1be)]('ðŸ“…\x20Custom\x20period:\x20'+_0x42eb13[_0x48d096(0x1e6)]()+_0x48d096(0x171)+_0x52fc6c[_0x48d096(0x1e6)]());}else{const _0x1e8808=new Date(Date['UTC'](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)](),_0x915a18[_0x48d096(0x162)]()-0x1e));_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x1e8808[_0x48d096(0x149)](),_0x1e8808[_0x48d096(0x12f)](),_0x1e8808[_0x48d096(0x162)](),0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date['UTC'](_0x915a18['getUTCFullYear'](),_0x915a18[_0x48d096(0x12f)](),_0x915a18['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x1c36cc=_0x287651||_0x48d096(0x1a2);switch(_0x1c36cc['toLowerCase']()){case _0x48d096(0x16b):_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x915a18[_0x48d096(0x149)](),_0x915a18['getUTCMonth'](),_0x915a18[_0x48d096(0x162)](),0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date['UTC'](_0x915a18['getUTCFullYear'](),_0x915a18[_0x48d096(0x12f)](),_0x915a18[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48d096(0x145):const _0x94d85=new Date(_0x915a18);_0x94d85[_0x48d096(0x1bc)](_0x94d85['getUTCDate']()-0x1),_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x94d85[_0x48d096(0x149)](),_0x94d85[_0x48d096(0x12f)](),_0x94d85[_0x48d096(0x162)](),0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date[_0x48d096(0x13b)](_0x94d85[_0x48d096(0x149)](),_0x94d85[_0x48d096(0x12f)](),_0x94d85[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48d096(0x148):const _0x59c98e=_0x915a18[_0x48d096(0x1ad)](),_0x53ebb5=_0x59c98e===0x0?-0x6:0x1-_0x59c98e,_0x48cb0d=_0x915a18['getUTCDate']()+_0x53ebb5;_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x915a18[_0x48d096(0x149)](),_0x915a18['getUTCMonth'](),_0x48cb0d,0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date['UTC'](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)](),_0x915a18[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48d096(0x113):const _0x58663b=new Date(Date[_0x48d096(0x13b)](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)](),_0x915a18[_0x48d096(0x162)]()-0x7)),_0x35041e=_0x58663b[_0x48d096(0x1ad)](),_0x173a88=_0x35041e===0x0?-0x6:0x1-_0x35041e,_0x2edeca=_0x58663b['getUTCDate']()+_0x173a88;_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x58663b[_0x48d096(0x149)](),_0x58663b[_0x48d096(0x12f)](),_0x2edeca,0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date[_0x48d096(0x13b)](_0x58663b[_0x48d096(0x149)](),_0x58663b[_0x48d096(0x12f)](),_0x2edeca+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x48d096(0x1a2):_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x915a18['getUTCFullYear'](),_0x915a18[_0x48d096(0x12f)](),0x1,0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date['UTC'](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)](),_0x915a18[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48d096(0x15b):_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date[_0x48d096(0x13b)](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x48d096(0x129):_0x42eb13=new Date(Date[_0x48d096(0x13b)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date[_0x48d096(0x13b)](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)](),_0x915a18[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x42eb13=new Date(Date[_0x48d096(0x13b)](_0x915a18['getUTCFullYear'](),_0x915a18[_0x48d096(0x12f)](),0x1,0x0,0x0,0x0,0x0)),_0x52fc6c=new Date(Date['UTC'](_0x915a18[_0x48d096(0x149)](),_0x915a18[_0x48d096(0x12f)](),_0x915a18[_0x48d096(0x162)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x48d096(0x1be)](_0x48d096(0x12b)+_0x42eb13[_0x48d096(0x1e6)]()+_0x48d096(0x171)+_0x52fc6c[_0x48d096(0x1e6)]());const _0x41412a={'gte':_0x42eb13,'lte':_0x52fc6c},[_0x13ee20,_0x126758,_0x5423d2,_0x58b9c3,_0x4bbcab,_0x3c383a,_0x51dfef,_0x3ffc88,_0x4132a4,_0x376491,_0x9f4c55]=await Promise[_0x48d096(0x110)]([database_1['default']['payment']['count']({'where':{'shopId':_0x9f6dab,'gateway':{'not':_0x48d096(0x164)},'status':{'notIn':['PENDING',_0x48d096(0x150)]},'createdAt':_0x41412a}}),database_1[_0x48d096(0x1a5)]['payment'][_0x48d096(0x168)]({'where':{'shopId':_0x9f6dab,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':_0x41412a}}),database_1[_0x48d096(0x1a5)]['payment'][_0x48d096(0x168)]({'where':{'shopId':_0x9f6dab,'gateway':{'not':_0x48d096(0x164)},'status':_0x48d096(0x136)}}),database_1[_0x48d096(0x1a5)][_0x48d096(0x179)]['count']({'where':{'shopId':_0x9f6dab,'gateway':{'not':'test_gateway'},'status':_0x48d096(0x1af)}}),database_1[_0x48d096(0x1a5)]['payment']['findMany']({'where':{'shopId':_0x9f6dab,'gateway':{'not':_0x48d096(0x164)},'status':_0x48d096(0x139),'createdAt':_0x41412a},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x48d096(0x1a5)][_0x48d096(0x179)][_0x48d096(0x1b1)]({'where':{'shopId':_0x9f6dab,'gateway':{'not':'test_gateway'}},'take':0x4,'orderBy':{'createdAt':_0x48d096(0x1e5)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x48d096(0x179)][_0x48d096(0x1b1)]({'where':{'shopId':_0x9f6dab,'gateway':{'not':_0x48d096(0x164)},'createdAt':_0x41412a},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}}),database_1[_0x48d096(0x1a5)][_0x48d096(0x179)]['count']({'where':{'shopId':_0x9f6dab,'gateway':{'not':_0x48d096(0x164)},'status':_0x48d096(0x139)}}),database_1[_0x48d096(0x1a5)][_0x48d096(0x179)]['findMany']({'where':{'shopId':_0x9f6dab,'gateway':{'not':_0x48d096(0x164)},'status':_0x48d096(0x139)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x48d096(0x1a5)]['shop'][_0x48d096(0x1eb)]({'where':{'id':_0x9f6dab},'select':{'balance':!![]}}),database_1[_0x48d096(0x1a5)][_0x48d096(0x179)][_0x48d096(0x1b1)]({'where':{'shopId':_0x9f6dab,'gateway':{'not':'test_gateway'}},'select':{'gateway':!![]}})]),_0x8c9162={};for(const _0x46ddb8 of _0x9f4c55){_0x46ddb8[_0x48d096(0x1f0)]&&(_0x8c9162[_0x46ddb8['gateway']]=(_0x8c9162[_0x46ddb8['gateway']]||0x0)+0x1);}console[_0x48d096(0x1be)](_0x48d096(0x19d),_0x8c9162);let _0x46997a=0x0,_0x1a3613=0x0;for(const _0x50391d of _0x4bbcab){if(_0x50391d[_0x48d096(0x1b6)])_0x46997a+=_0x50391d['amountUSDT'];else{const _0x53244a=await currencyService_1['currencyService'][_0x48d096(0x14b)](_0x50391d[_0x48d096(0x19a)],_0x50391d[_0x48d096(0x14c)]);_0x46997a+=_0x53244a;}_0x50391d[_0x48d096(0x111)]&&(_0x1a3613+=_0x50391d[_0x48d096(0x111)]);}let _0x13c624=0x0;for(const _0x63f3e1 of _0x4132a4){_0x63f3e1[_0x48d096(0x111)]&&(_0x13c624+=_0x63f3e1[_0x48d096(0x111)]);}const _0x3ba0ae=this['generateDailyStatistics'](_0x51dfef,_0x42eb13,_0x52fc6c||_0x915a18),_0x49ca6b=_0x13ee20>0x0?_0x126758/_0x13ee20*0x64:0x0,_0xb0d46f=_0x3ffc88>0x0?_0x5423d2/_0x3ffc88*0x64:0x0;return{'totalPayments':_0x13ee20,'successfulPayments':_0x126758,'totalRevenue':Math[_0x48d096(0x189)](_0x46997a*0x64)/0x64,'merchantEarnings':Math[_0x48d096(0x189)](_0x1a3613*0x64)/0x64,'merchantTotalRevenue':Math[_0x48d096(0x189)](_0x13c624*0x64)/0x64,'payoutBalance':Math[_0x48d096(0x189)]((_0x376491?.[_0x48d096(0x18f)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x48d096(0x189)](_0x49ca6b*0x64)/0x64,'chargebackRate':Math['round'](_0xb0d46f*0x64)/0x64,'chargebacks':_0x5423d2,'refunds':_0x58b9c3,'paymentsByGateway':_0x8c9162,'dailyRevenue':_0x3ba0ae[_0x48d096(0x127)],'dailyPayments':_0x3ba0ae[_0x48d096(0x138)],'recentPayments':_0x3c383a[_0x48d096(0x1a4)](_0x5447a2=>({'id':_0x5447a2['id'],'gateway':_0x5447a2[_0x48d096(0x1f0)],'amount':_0x5447a2[_0x48d096(0x19a)],'currency':_0x5447a2[_0x48d096(0x14c)],'status':_0x5447a2['status'],'createdAt':_0x5447a2['createdAt']}))};}[a86_0x10476f(0x124)](_0xc1f422,_0x1d587d,_0x12708e){const _0x4879e3=a86_0x10476f,_0x1d2404=new Map(),_0x18dc7a=new Date(_0x1d587d);while(_0x18dc7a<=_0x12708e){const _0x5bdeb5=_0x18dc7a[_0x4879e3(0x1e6)]()['split']('T')[0x0];_0x1d2404['set'](_0x5bdeb5,{'revenue':0x0,'count':0x0}),_0x18dc7a[_0x4879e3(0x18a)](_0x18dc7a[_0x4879e3(0x152)]()+0x1);}for(const _0x9696f8 of _0xc1f422){const _0x2de967=_0x9696f8[_0x4879e3(0x183)][_0x4879e3(0x1e6)]()[_0x4879e3(0x1da)]('T')[0x0],_0x51e727=_0x1d2404[_0x4879e3(0x1c5)](_0x2de967);_0x51e727&&(_0x51e727['count']+=0x1,_0x9696f8[_0x4879e3(0x11a)]===_0x4879e3(0x139)&&_0x9696f8[_0x4879e3(0x1b6)]&&(_0x51e727['revenue']+=_0x9696f8[_0x4879e3(0x1b6)]));}const _0xb5e698=[],_0x29a765=[];for(const [_0x3dc87f,_0x38ea93]of _0x1d2404){_0xb5e698[_0x4879e3(0x17c)]({'date':_0x3dc87f,'amount':Math[_0x4879e3(0x189)](_0x38ea93[_0x4879e3(0x131)]*0x64)/0x64}),_0x29a765[_0x4879e3(0x17c)]({'date':_0x3dc87f,'count':_0x38ea93[_0x4879e3(0x168)]});}return{'dailyRevenue':_0xb5e698,'dailyPayments':_0x29a765};}[a86_0x10476f(0x1fc)](_0x3503ae=0x8){const _0x4dd74b=a86_0x10476f,_0x4ed254=[];for(let _0x3b04eb=0x0;_0x3b04eb<_0x3503ae;_0x3b04eb++){const _0x495acc=crypto_1['default'][_0x4dd74b(0x180)](0x4)['toString'](_0x4dd74b(0x19f))[_0x4dd74b(0x11d)]();_0x4ed254['push'](_0x495acc);}return _0x4ed254;}async[a86_0x10476f(0x192)](_0x4d0945){const _0x49ff32=a86_0x10476f,_0x4e501f=await database_1[_0x49ff32(0x1a5)]['shop'][_0x49ff32(0x1eb)]({'where':{'id':_0x4d0945},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4e501f)throw new Error(_0x49ff32(0x13c));const _0x1dcb86=speakeasy_1['default'][_0x49ff32(0x1f7)]({'name':'TrapaPay\x20('+_0x4e501f['username']+')','issuer':_0x49ff32(0x119),'length':0x20}),_0x17296f=await qrcode_1[_0x49ff32(0x1a5)][_0x49ff32(0x116)](_0x1dcb86[_0x49ff32(0x182)]),_0x5ed02c=this['generateBackupCodes'](0x8),_0x1bcc7c=await Promise[_0x49ff32(0x110)](_0x5ed02c[_0x49ff32(0x1a4)](_0x17125c=>bcryptjs_1['default'][_0x49ff32(0x115)](_0x17125c,0xa)));return await database_1[_0x49ff32(0x1a5)]['shop']['update']({'where':{'id':_0x4d0945},'data':{'twoFactorSecret':_0x1dcb86['base32'],'backupCodes':JSON['stringify'](_0x1bcc7c)}}),console[_0x49ff32(0x1be)](_0x49ff32(0x1ed)+_0x4e501f['username']),console[_0x49ff32(0x1be)](_0x49ff32(0x1d1)+_0x5ed02c[_0x49ff32(0x166)]+_0x49ff32(0x1d2)),{'secret':_0x1dcb86[_0x49ff32(0x13d)],'qrCode':_0x17296f,'manualEntryKey':_0x1dcb86['base32'],'backupCodes':_0x5ed02c};}async[a86_0x10476f(0x1d8)](_0xb0906d,_0x5d5aa2){const _0x16159a=a86_0x10476f,_0x2c8d41=await database_1[_0x16159a(0x1a5)][_0x16159a(0x155)][_0x16159a(0x1eb)]({'where':{'id':_0xb0906d},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x2c8d41)throw new Error(_0x16159a(0x13c));if(!_0x2c8d41[_0x16159a(0x1cd)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x2c8d41[_0x16159a(0x1fa)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x59556b=speakeasy_1[_0x16159a(0x1a5)]['totp']['verify']({'secret':_0x2c8d41['twoFactorSecret'],'encoding':_0x16159a(0x13d),'token':_0x5d5aa2,'window':0x2});if(!_0x59556b)throw new Error('Invalid\x202FA\x20token');return await database_1[_0x16159a(0x1a5)][_0x16159a(0x155)]['update']({'where':{'id':_0xb0906d},'data':{'twoFactorEnabled':!![]}}),console[_0x16159a(0x1be)](_0x16159a(0x1f4)+_0x2c8d41['username']),{'enabled':!![]};}async[a86_0x10476f(0x1cc)](_0x20e4f4){const _0x4f6d6b=a86_0x10476f,_0x5538d0=await database_1[_0x4f6d6b(0x1a5)]['shop'][_0x4f6d6b(0x1eb)]({'where':{'id':_0x20e4f4},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5538d0)throw new Error(_0x4f6d6b(0x13c));await database_1[_0x4f6d6b(0x1a5)][_0x4f6d6b(0x155)][_0x4f6d6b(0x1b9)]({'where':{'id':_0x20e4f4},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log'](_0x4f6d6b(0x1c1)+_0x5538d0['username']);}}function a86_0x53e2(_0x2561d8,_0x3473ee){_0x2561d8=_0x2561d8-0x110;const _0x19ad37=a86_0x19ad();let _0x53e284=_0x19ad37[_0x2561d8];return _0x53e284;}exports[a86_0x10476f(0x118)]=ShopService;