'use strict';function a86_0x20a5(_0x171902,_0x22fcc9){_0x171902=_0x171902-0xbc;const _0x29033f=a86_0x2903();let _0x20a5c3=_0x29033f[_0x171902];return _0x20a5c3;}const a86_0x278ab8=a86_0x20a5;(function(_0x470cfe,_0x4460b6){const _0x4747be=a86_0x20a5,_0x201d46=_0x470cfe();while(!![]){try{const _0x1073cc=parseInt(_0x4747be(0x15b))/0x1*(-parseInt(_0x4747be(0xed))/0x2)+-parseInt(_0x4747be(0x14a))/0x3*(parseInt(_0x4747be(0x125))/0x4)+-parseInt(_0x4747be(0x19e))/0x5+-parseInt(_0x4747be(0x1a2))/0x6+-parseInt(_0x4747be(0x124))/0x7+parseInt(_0x4747be(0xce))/0x8*(-parseInt(_0x4747be(0x112))/0x9)+-parseInt(_0x4747be(0x168))/0xa*(-parseInt(_0x4747be(0x17f))/0xb);if(_0x1073cc===_0x4460b6)break;else _0x201d46['push'](_0x201d46['shift']());}catch(_0x1f75a8){_0x201d46['push'](_0x201d46['shift']());}}}(a86_0x2903,0x94e11));var __importDefault=this&&this[a86_0x278ab8(0x163)]||function(_0x248625){const _0x5623c6=a86_0x278ab8;return _0x248625&&_0x248625[_0x5623c6(0x142)]?_0x248625:{'default':_0x248625};};Object[a86_0x278ab8(0x18f)](exports,a86_0x278ab8(0x142),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a86_0x278ab8(0x158))),crypto_1=__importDefault(require(a86_0x278ab8(0x10e))),speakeasy_1=__importDefault(require(a86_0x278ab8(0x185))),qrcode_1=__importDefault(require(a86_0x278ab8(0x130))),currencyService_1=require(a86_0x278ab8(0xd0)),paymentService_1=require(a86_0x278ab8(0x100)),gateway_1=require(a86_0x278ab8(0x10d));class ShopService{constructor(){const _0x1b47e3=a86_0x278ab8;this[_0x1b47e3(0x181)]=new paymentService_1['PaymentService']();}async[a86_0x278ab8(0x11f)](_0x183d48){const _0x2ed9bb=a86_0x278ab8,_0x44038f=await database_1['default']['shop'][_0x2ed9bb(0x148)]({'where':{'id':_0x183d48},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x44038f)throw new Error(_0x2ed9bb(0xd2));let _0x2b8b12=[];if(_0x44038f[_0x2ed9bb(0x128)]?.[_0x2ed9bb(0xcc)])try{_0x2b8b12=Array[_0x2ed9bb(0xfa)](_0x44038f[_0x2ed9bb(0x128)][_0x2ed9bb(0xcc)])?_0x44038f['settings'][_0x2ed9bb(0xcc)]:JSON[_0x2ed9bb(0x134)](_0x44038f[_0x2ed9bb(0x128)][_0x2ed9bb(0xcc)]);}catch(_0x5ce278){console[_0x2ed9bb(0x11b)](_0x2ed9bb(0xbf),_0x5ce278),_0x2b8b12=[];}const _0x580343=gateway_1[_0x2ed9bb(0x145)][_0x2ed9bb(0x17d)](_0x27533f=>_0x27533f[_0x2ed9bb(0xdc)])[_0x2ed9bb(0x1a7)](_0x2d9301=>_0x2d9301['name']);let _0x331e43=_0x44038f[_0x2ed9bb(0xe3)]?JSON[_0x2ed9bb(0x134)](_0x44038f[_0x2ed9bb(0xe3)]):[];return Array['isArray'](_0x331e43)&&(_0x331e43=_0x331e43[_0x2ed9bb(0x1a7)](_0x3cc452=>_0x3cc452[_0x2ed9bb(0xe5)](/\s+/g,'_')['toLowerCase']())[_0x2ed9bb(0x17d)](_0x44ac1f=>_0x580343['includes'](_0x44ac1f))),{'id':_0x44038f['id'],'fullName':_0x44038f['name'],'username':_0x44038f[_0x2ed9bb(0x15d)],'telegramId':_0x44038f['telegram'],'merchantUrl':_0x44038f[_0x2ed9bb(0xe9)],'gateways':_0x331e43,'gatewaySettings':_0x44038f[_0x2ed9bb(0x177)]?JSON[_0x2ed9bb(0x134)](_0x44038f[_0x2ed9bb(0x177)]):null,'publicKey':_0x44038f[_0x2ed9bb(0x10c)],'secretKey':_0x44038f[_0x2ed9bb(0x151)],'webhookUrl':_0x44038f[_0x2ed9bb(0x128)]?.[_0x2ed9bb(0x139)]||null,'webhookEvents':_0x2b8b12,'wallets':{'usdtPolygonWallet':_0x44038f[_0x2ed9bb(0x149)],'usdtTrcWallet':_0x44038f[_0x2ed9bb(0x118)],'usdtErcWallet':_0x44038f[_0x2ed9bb(0x123)],'usdcPolygonWallet':_0x44038f[_0x2ed9bb(0x16e)],'usdcErcWallet':_0x44038f[_0x2ed9bb(0x164)]},'status':_0x44038f[_0x2ed9bb(0x12f)],'createdAt':_0x44038f[_0x2ed9bb(0xbd)]};}async['updateShopProfile'](_0x1cd534,_0x315307){const _0x434f13=a86_0x278ab8,_0x596424={};_0x315307[_0x434f13(0xf5)]&&(_0x596424[_0x434f13(0xc3)]=_0x315307[_0x434f13(0xf5)]);_0x315307['telegramId']!==undefined&&(_0x596424[_0x434f13(0x184)]=_0x315307[_0x434f13(0x198)]||null);_0x315307[_0x434f13(0x188)]&&(_0x596424['shopUrl']=_0x315307[_0x434f13(0x188)]);_0x315307['gateways']&&(_0x596424[_0x434f13(0xe3)]=JSON['stringify'](_0x315307['gateways']));_0x315307[_0x434f13(0x177)]&&(_0x596424[_0x434f13(0x177)]=JSON[_0x434f13(0x133)](_0x315307['gatewaySettings']));_0x315307['wallets']&&(_0x315307['wallets'][_0x434f13(0x149)]!==undefined&&(_0x596424[_0x434f13(0x149)]=_0x315307[_0x434f13(0x155)]['usdtPolygonWallet']||null),_0x315307[_0x434f13(0x155)][_0x434f13(0x118)]!==undefined&&(_0x596424['usdtTrcWallet']=_0x315307[_0x434f13(0x155)][_0x434f13(0x118)]||null),_0x315307['wallets'][_0x434f13(0x123)]!==undefined&&(_0x596424[_0x434f13(0x123)]=_0x315307[_0x434f13(0x155)][_0x434f13(0x123)]||null),_0x315307[_0x434f13(0x155)][_0x434f13(0x16e)]!==undefined&&(_0x596424[_0x434f13(0x16e)]=_0x315307['wallets']['usdcPolygonWallet']||null));const _0x2babaa=await database_1[_0x434f13(0x108)][_0x434f13(0x16d)][_0x434f13(0x173)]({'where':{'id':_0x1cd534},'data':_0x596424,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2c3bfb=[];if(_0x2babaa[_0x434f13(0x128)]?.[_0x434f13(0xcc)])try{_0x2c3bfb=Array[_0x434f13(0xfa)](_0x2babaa[_0x434f13(0x128)][_0x434f13(0xcc)])?_0x2babaa[_0x434f13(0x128)]['webhookEvents']:JSON[_0x434f13(0x134)](_0x2babaa[_0x434f13(0x128)][_0x434f13(0xcc)]);}catch(_0x397d74){console[_0x434f13(0x11b)](_0x434f13(0xbf),_0x397d74),_0x2c3bfb=[];}return{'id':_0x2babaa['id'],'fullName':_0x2babaa[_0x434f13(0xc3)],'username':_0x2babaa[_0x434f13(0x15d)],'telegramId':_0x2babaa[_0x434f13(0x184)],'merchantUrl':_0x2babaa[_0x434f13(0xe9)],'gateways':_0x2babaa[_0x434f13(0xe3)]?JSON['parse'](_0x2babaa['paymentGateways']):null,'gatewaySettings':_0x2babaa[_0x434f13(0x177)]?JSON[_0x434f13(0x134)](_0x2babaa['gatewaySettings']):null,'publicKey':_0x2babaa[_0x434f13(0x10c)],'secretKey':_0x2babaa[_0x434f13(0x151)],'webhookUrl':_0x2babaa[_0x434f13(0x128)]?.[_0x434f13(0x139)]||null,'webhookEvents':_0x2c3bfb,'wallets':{'usdtPolygonWallet':_0x2babaa[_0x434f13(0x149)],'usdtTrcWallet':_0x2babaa[_0x434f13(0x118)],'usdtErcWallet':_0x2babaa[_0x434f13(0x123)],'usdcPolygonWallet':_0x2babaa[_0x434f13(0x16e)],'usdcErcWallet':_0x2babaa['usdcErcWallet']},'status':_0x2babaa[_0x434f13(0x12f)],'createdAt':_0x2babaa[_0x434f13(0xbd)]};}async[a86_0x278ab8(0x175)](_0x720ae1,_0xe1e7b6){const _0x4b5ba5=a86_0x278ab8,_0x1871cd=await database_1[_0x4b5ba5(0x108)]['shop']['findUnique']({'where':{'id':_0x720ae1},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x1871cd)throw new Error(_0x4b5ba5(0xd2));if(_0x1871cd[_0x4b5ba5(0x19c)]){if(!_0xe1e7b6[_0x4b5ba5(0x165)])throw new Error(_0x4b5ba5(0x170));const _0x46088f=speakeasy_1[_0x4b5ba5(0x108)][_0x4b5ba5(0x1a1)]['verify']({'secret':_0x1871cd[_0x4b5ba5(0x10f)],'encoding':_0x4b5ba5(0x167),'token':_0xe1e7b6['twoFactorToken'],'window':0x2});if(!_0x46088f){let _0x2d048a=![];if(_0x1871cd['backupCodes']){const _0x4cb6a6=JSON[_0x4b5ba5(0x134)](_0x1871cd[_0x4b5ba5(0xef)]);for(let _0x397ff3=0x0;_0x397ff3<_0x4cb6a6[_0x4b5ba5(0x154)];_0x397ff3++){const _0x113936=await bcryptjs_1[_0x4b5ba5(0x108)][_0x4b5ba5(0x161)](_0xe1e7b6[_0x4b5ba5(0x165)],_0x4cb6a6[_0x397ff3]);if(_0x113936){_0x2d048a=!![],_0x4cb6a6[_0x4b5ba5(0x12b)](_0x397ff3,0x1),await database_1[_0x4b5ba5(0x108)][_0x4b5ba5(0x16d)][_0x4b5ba5(0x173)]({'where':{'id':_0x720ae1},'data':{'backupCodes':JSON[_0x4b5ba5(0x133)](_0x4cb6a6)}});break;}}}if(!_0x2d048a)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x30ef2b={};_0xe1e7b6[_0x4b5ba5(0x149)]!==undefined&&(_0x30ef2b['usdtPolygonWallet']=_0xe1e7b6[_0x4b5ba5(0x149)]||null),_0xe1e7b6['usdtTrcWallet']!==undefined&&(_0x30ef2b['usdtTrcWallet']=_0xe1e7b6[_0x4b5ba5(0x118)]||null),_0xe1e7b6[_0x4b5ba5(0x123)]!==undefined&&(_0x30ef2b[_0x4b5ba5(0x123)]=_0xe1e7b6[_0x4b5ba5(0x123)]||null),_0xe1e7b6[_0x4b5ba5(0x16e)]!==undefined&&(_0x30ef2b['usdcPolygonWallet']=_0xe1e7b6[_0x4b5ba5(0x16e)]||null),_0xe1e7b6[_0x4b5ba5(0x164)]!==undefined&&(_0x30ef2b[_0x4b5ba5(0x164)]=_0xe1e7b6[_0x4b5ba5(0x164)]||null),await database_1[_0x4b5ba5(0x108)][_0x4b5ba5(0x16d)][_0x4b5ba5(0x173)]({'where':{'id':_0x720ae1},'data':_0x30ef2b});}async['testWebhook'](_0xeaf6ae){const _0x45ca71=a86_0x278ab8,_0x230603=await database_1[_0x45ca71(0x108)][_0x45ca71(0x16d)][_0x45ca71(0x148)]({'where':{'id':_0xeaf6ae},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x230603?.[_0x45ca71(0x128)]?.[_0x45ca71(0x139)])throw new Error(_0x45ca71(0x119));const _0x1e5bbc={'event':_0x45ca71(0x12d),'payment':{'id':_0x45ca71(0xf7),'order_id':_0x45ca71(0xfb),'gateway':_0x45ca71(0x12d),'amount':0x64,'currency':_0x45ca71(0x169),'status':_0x45ca71(0x174),'created_at':new Date()['toISOString']()}};try{const _0x49cfd7=JSON[_0x45ca71(0x133)](_0x1e5bbc),_0x323873=crypto_1['default'][_0x45ca71(0xea)]('sha256',_0x230603[_0x45ca71(0x151)])['update'](_0x49cfd7)['digest'](_0x45ca71(0x172)),_0x3fd4f3=await fetch(_0x230603[_0x45ca71(0x128)][_0x45ca71(0x139)],{'method':'POST','headers':{'Content-Type':_0x45ca71(0x111),'User-Agent':_0x45ca71(0x19d),'X-Webhook-Signature':_0x323873},'body':_0x49cfd7});return _0x3fd4f3['ok']?{'success':!![],'message':_0x45ca71(0x13c)+_0x3fd4f3['status']+')'}:{'success':![],'message':_0x45ca71(0xc0)+_0x3fd4f3[_0x45ca71(0x12f)]+'\x20'+_0x3fd4f3[_0x45ca71(0x152)]};}catch(_0x8ff3bc){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x8ff3bc instanceof Error?_0x8ff3bc[_0x45ca71(0x199)]:'Unknown\x20error')};}}async['createPayment'](_0xf3c527){const _0x159168=a86_0x278ab8;return this[_0x159168(0x181)][_0x159168(0x16a)]({'public_key':'','gateway':_0xf3c527[_0x159168(0xf0)],'order_id':'','amount':_0xf3c527[_0x159168(0x160)],'currency':_0xf3c527[_0x159168(0x16f)],'source_currency':_0xf3c527['sourceCurrency'],'success_url':_0xf3c527[_0x159168(0xc1)],'fail_url':_0xf3c527[_0x159168(0xc1)],'customer_email':_0xf3c527[_0x159168(0x14c)],'customer_name':_0xf3c527['customerName'],'language':_0xf3c527[_0x159168(0xf6)]});}async[a86_0x278ab8(0x189)](_0x355366,_0x3f5cef){const _0x176454=a86_0x278ab8;return this[_0x176454(0x181)][_0x176454(0x103)](_0x355366,_0x3f5cef);}async[a86_0x278ab8(0x1a6)](_0x413274,_0xe21d43){const _0x5b4ebf=a86_0x278ab8;return this[_0x5b4ebf(0x181)][_0x5b4ebf(0xe1)](_0x413274,_0xe21d43);}async['updatePayment'](_0x52ca19,_0x28935e,_0x2f8711){const _0x1a45b1=a86_0x278ab8,_0x5e973a=await database_1[_0x1a45b1(0x108)][_0x1a45b1(0x136)][_0x1a45b1(0x129)]({'where':{'id':_0x28935e,'shopId':_0x52ca19}});if(!_0x5e973a)throw new Error(_0x1a45b1(0x18e));const _0x2ea520=await database_1[_0x1a45b1(0x108)][_0x1a45b1(0x136)][_0x1a45b1(0x173)]({'where':{'id':_0x28935e},'data':{..._0x2f8711,'updatedAt':new Date()}});return _0x2ea520;}async[a86_0x278ab8(0x120)](_0x2ac411,_0x4fa988){const _0x17a22b=a86_0x278ab8,_0xb7b9ba=await database_1[_0x17a22b(0x108)]['payment'][_0x17a22b(0x129)]({'where':{'id':_0x4fa988,'shopId':_0x2ac411}});if(!_0xb7b9ba)throw new Error('Payment\x20not\x20found');await database_1[_0x17a22b(0x108)][_0x17a22b(0x136)]['delete']({'where':{'id':_0x4fa988}});}[a86_0x278ab8(0x126)](_0xe16911){const _0x29e077=a86_0x278ab8,_0x55d4f0={'polygon':_0x29e077(0xd3),'trc20':_0x29e077(0x18b),'erc20':_0x29e077(0x121),'bsc':'USDT\x20BSC','polygon_usdc':_0x29e077(0x132),'erc20_usdc':_0x29e077(0xee)};return _0x55d4f0[_0xe16911]||_0xe16911;}async[a86_0x278ab8(0x10a)](_0x124c8e,_0x19261a){const _0x2fcf90=a86_0x278ab8,{page:_0x30e617,limit:_0x2fcc2e,status:_0x181835,method:_0x354045,network:_0x7a2229,dateFrom:_0x51a574,dateTo:_0x401419,periodFrom:_0x3fa890,periodTo:_0x3ccb19}=_0x19261a,_0x2a5dd4=(_0x30e617-0x1)*_0x2fcc2e;console[_0x2fcf90(0xeb)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x19261a);const _0x497712={'shopId':_0x124c8e};_0x181835&&(_0x497712[_0x2fcf90(0x12f)]=_0x181835[_0x2fcf90(0xc2)](),console[_0x2fcf90(0xeb)](_0x2fcf90(0x197)+_0x181835[_0x2fcf90(0xc2)]()));if(_0x354045)_0x497712[_0x2fcf90(0xf9)]=_0x354045,console[_0x2fcf90(0xeb)]('üåê\x20Method\x20filter:\x20'+_0x354045);else _0x7a2229&&(_0x497712[_0x2fcf90(0xf9)]=_0x7a2229,console[_0x2fcf90(0xeb)](_0x2fcf90(0x17b)+_0x7a2229));if(_0x51a574||_0x401419||_0x3fa890||_0x3ccb19){_0x497712[_0x2fcf90(0xbd)]={};if(_0x3fa890){const _0x444089=new Date(_0x3fa890);_0x444089[_0x2fcf90(0xe6)](0x0,0x0,0x0,0x1),_0x497712[_0x2fcf90(0xbd)][_0x2fcf90(0x11e)]=_0x444089,console[_0x2fcf90(0xeb)](_0x2fcf90(0x156)+_0x444089[_0x2fcf90(0x13b)]());}else{if(_0x51a574){const _0x4dc627=new Date(_0x51a574);_0x4dc627[_0x2fcf90(0xe6)](0x0,0x0,0x0,0x1),_0x497712['createdAt'][_0x2fcf90(0x11e)]=_0x4dc627,console[_0x2fcf90(0xeb)](_0x2fcf90(0x1a4)+_0x4dc627[_0x2fcf90(0x13b)]());}}if(_0x3ccb19){const _0x2e3e98=new Date(_0x3ccb19);_0x2e3e98[_0x2fcf90(0xe6)](0x17,0x3b,0x3b,0x3e7),_0x497712['createdAt'][_0x2fcf90(0x18c)]=_0x2e3e98,console[_0x2fcf90(0xeb)](_0x2fcf90(0xfe)+_0x2e3e98['toISOString']());}else{if(_0x401419){const _0x31404f=new Date(_0x401419);_0x31404f['setHours'](0x17,0x3b,0x3b,0x3e7),_0x497712[_0x2fcf90(0xbd)][_0x2fcf90(0x18c)]=_0x31404f,console[_0x2fcf90(0xeb)](_0x2fcf90(0xd4)+_0x31404f[_0x2fcf90(0x13b)]());}}}console[_0x2fcf90(0xeb)](_0x2fcf90(0x183),JSON[_0x2fcf90(0x133)](_0x497712,null,0x2));const [_0x2ad9ef,_0xf5ad8]=await Promise[_0x2fcf90(0xca)]([database_1['default'][_0x2fcf90(0xf1)]['findMany']({'where':_0x497712,'skip':_0x2a5dd4,'take':_0x2fcc2e,'orderBy':{'createdAt':_0x2fcf90(0x179)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x2fcf90(0x108)][_0x2fcf90(0xf1)][_0x2fcf90(0x13a)]({'where':_0x497712})]);return{'payouts':_0x2ad9ef['map'](_0x73fde6=>{const _0x3e17ad=_0x2fcf90;let _0x3f5808=null;switch(_0x73fde6[_0x3e17ad(0xf9)]){case _0x3e17ad(0x102):_0x3f5808=_0x73fde6[_0x3e17ad(0x16d)][_0x3e17ad(0x149)];break;case _0x3e17ad(0x18d):_0x3f5808=_0x73fde6[_0x3e17ad(0x16d)]['usdtTrcWallet'];break;case'erc20':_0x3f5808=_0x73fde6[_0x3e17ad(0x16d)][_0x3e17ad(0x123)];break;case'polygon_usdc':_0x3f5808=_0x73fde6[_0x3e17ad(0x16d)][_0x3e17ad(0x16e)];break;case _0x3e17ad(0xc7):_0x3f5808=_0x73fde6[_0x3e17ad(0x16d)]['usdcErcWallet'];break;}return{'id':_0x73fde6['id'],'amount':_0x73fde6[_0x3e17ad(0x160)],'network':this[_0x3e17ad(0x126)](_0x73fde6[_0x3e17ad(0xf9)]),'wallet':_0x3f5808,'status':_0x73fde6['status'],'txid':_0x73fde6[_0x3e17ad(0x115)],'notes':_0x73fde6[_0x3e17ad(0xfd)],'periodFrom':_0x73fde6[_0x3e17ad(0x17a)],'periodTo':_0x73fde6[_0x3e17ad(0x182)],'createdAt':_0x73fde6[_0x3e17ad(0xbd)],'paidAt':_0x73fde6[_0x3e17ad(0x192)]};}),'pagination':{'page':_0x30e617,'limit':_0x2fcc2e,'total':_0xf5ad8,'totalPages':Math[_0x2fcf90(0xcf)](_0xf5ad8/_0x2fcc2e)}};}async['getPayoutById'](_0x1a1d3f,_0x22149b){const _0x55ae62=a86_0x278ab8,_0x2cef64=await database_1[_0x55ae62(0x108)]['payout'][_0x55ae62(0x129)]({'where':{'id':_0x22149b,'shopId':_0x1a1d3f}});if(!_0x2cef64)return null;return{'id':_0x2cef64['id'],'amount':_0x2cef64['amount'],'network':_0x2cef64[_0x55ae62(0xf9)],'status':_0x2cef64['status'],'txid':_0x2cef64['txid'],'notes':_0x2cef64[_0x55ae62(0xfd)],'createdAt':_0x2cef64['createdAt'],'paidAt':_0x2cef64['paidAt']};}async[a86_0x278ab8(0x15e)](_0x20f2f0,_0xc8386c){const _0x4c4b3c=a86_0x278ab8,_0xa257d9=new Date();let _0x359c2e,_0x1f9c8e;switch(_0xc8386c){case _0x4c4b3c(0x137):case _0x4c4b3c(0xe4):const _0x15cdd0=new Date(_0xa257d9);_0x15cdd0[_0x4c4b3c(0x131)](_0x15cdd0[_0x4c4b3c(0x194)]()-0x1),_0x359c2e=new Date(_0x15cdd0),_0x359c2e[_0x4c4b3c(0xe6)](0x0,0x0,0x0,0x0),_0x1f9c8e=new Date(_0x15cdd0),_0x1f9c8e[_0x4c4b3c(0xe6)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x359c2e=new Date(_0xa257d9[_0x4c4b3c(0xc9)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4c4b3c(0x15c):_0x359c2e=new Date(_0xa257d9[_0x4c4b3c(0xc9)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4c4b3c(0x140):_0x359c2e=new Date(_0xa257d9[_0x4c4b3c(0xc9)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x359c2e=new Date(_0xa257d9['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x229ba5={'gte':_0x359c2e};_0x1f9c8e&&(_0x229ba5[_0x4c4b3c(0x18c)]=_0x1f9c8e);const [_0x53f282,_0x2e240d,_0x284205,_0x387df3,_0x257c4a,_0x1d0f2b]=await Promise['all']([database_1['default'][_0x4c4b3c(0xf1)]['count']({'where':{'shopId':_0x20f2f0,'createdAt':_0x229ba5}}),database_1[_0x4c4b3c(0x108)][_0x4c4b3c(0xf1)][_0x4c4b3c(0x13a)]({'where':{'shopId':_0x20f2f0,'status':_0x4c4b3c(0xfc),'createdAt':_0x229ba5}}),database_1['default'][_0x4c4b3c(0xf1)][_0x4c4b3c(0x13a)]({'where':{'shopId':_0x20f2f0,'status':'PENDING','createdAt':_0x229ba5}}),database_1['default']['payout'][_0x4c4b3c(0x13a)]({'where':{'shopId':_0x20f2f0,'status':_0x4c4b3c(0x19f),'createdAt':_0x229ba5}}),database_1[_0x4c4b3c(0x108)][_0x4c4b3c(0xf1)][_0x4c4b3c(0x17e)]({'where':{'shopId':_0x20f2f0,'createdAt':_0x229ba5},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x4c4b3c(0x108)][_0x4c4b3c(0xf1)]['findMany']({'where':{'shopId':_0x20f2f0},'take':0xa,'orderBy':{'createdAt':_0x4c4b3c(0x179)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x56e68b=_0x257c4a[_0x4c4b3c(0xde)]((_0x1a5776,_0x2baba1)=>_0x1a5776+_0x2baba1[_0x4c4b3c(0x160)],0x0),_0x896f6f=_0x257c4a[_0x4c4b3c(0x17d)](_0x4579f0=>_0x4579f0[_0x4c4b3c(0x12f)]===_0x4c4b3c(0xfc))['reduce']((_0x2b5453,_0xb707d7)=>_0x2b5453+_0xb707d7[_0x4c4b3c(0x160)],0x0),_0x167653=_0x257c4a[_0x4c4b3c(0x17d)](_0x16d699=>_0x16d699[_0x4c4b3c(0x12f)]===_0x4c4b3c(0xc6))['reduce']((_0x50206c,_0x2a8a1b)=>_0x50206c+_0x2a8a1b[_0x4c4b3c(0x160)],0x0),_0x21176b=_0x257c4a[_0x4c4b3c(0xde)]((_0x31303a,_0x3d1ea5)=>{const _0x113c73=_0x4c4b3c;return _0x31303a[_0x3d1ea5[_0x113c73(0xf9)]]=(_0x31303a[_0x3d1ea5[_0x113c73(0xf9)]]||0x0)+0x1,_0x31303a;},{}),_0x574f15=_0x257c4a[_0x4c4b3c(0xde)]((_0x5b6f0a,_0x11ae98)=>{const _0x15cb41=_0x4c4b3c;return _0x5b6f0a[_0x11ae98['status']]=(_0x5b6f0a[_0x11ae98[_0x15cb41(0x12f)]]||0x0)+0x1,_0x5b6f0a;},{});return{'totalPayouts':_0x53f282,'completedPayouts':_0x2e240d,'pendingPayouts':_0x284205,'rejectedPayouts':_0x387df3,'totalAmount':_0x56e68b,'completedAmount':_0x896f6f,'pendingAmount':_0x167653,'payoutsByMethod':_0x21176b,'payoutsByStatus':_0x574f15,'recentPayouts':_0x1d0f2b[_0x4c4b3c(0x1a7)](_0x451c9b=>({'id':_0x451c9b['id'],'shopId':_0x20f2f0,'amount':_0x451c9b[_0x4c4b3c(0x160)],'method':_0x451c9b[_0x4c4b3c(0xf9)],'status':_0x451c9b[_0x4c4b3c(0x12f)],'txid':_0x451c9b[_0x4c4b3c(0x115)],'createdAt':_0x451c9b[_0x4c4b3c(0xbd)],'paidAt':_0x451c9b[_0x4c4b3c(0x192)]}))};}async[a86_0x278ab8(0xe8)](_0x2f32f4){const _0x41a679=a86_0x278ab8;console[_0x41a679(0xeb)](_0x41a679(0x13e)+_0x2f32f4+_0x41a679(0x178));const _0x115d76=await database_1['default'][_0x41a679(0x16d)]['findUnique']({'where':{'id':_0x2f32f4},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x115d76)throw new Error(_0x41a679(0xd2));const _0x1dce97=new Date(),_0x4b398a=new Date(_0x1dce97[_0x41a679(0xbc)](),_0x1dce97['getMonth'](),0x1),_0x16ea84=new Date(_0x1dce97['getFullYear'](),_0x1dce97[_0x41a679(0x162)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xfb4b12=await database_1[_0x41a679(0x108)][_0x41a679(0xf1)][_0x41a679(0x15a)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2f32f4,'createdAt':{'gte':_0x4b398a,'lte':_0x16ea84},'status':_0x41a679(0xfc)}}),_0x3bb22d=_0xfb4b12[_0x41a679(0x12e)][_0x41a679(0x160)]||0x0,_0xf8b538={'availableBalance':Math[_0x41a679(0x195)](_0x115d76[_0x41a679(0x176)]*0x64)/0x64,'totalPaidOut':Math[_0x41a679(0x195)](_0x115d76[_0x41a679(0xcb)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x115d76[_0x41a679(0x176)]*0x64)/0x64,'thisMonth':Math[_0x41a679(0x195)](_0x3bb22d*0x64)/0x64};return console['log'](_0x41a679(0x13f)+_0x115d76[_0x41a679(0x15d)]+'\x20payout\x20statistics\x20calculated:'),console[_0x41a679(0xeb)](_0x41a679(0x141)+_0xf8b538['availableBalance']+_0x41a679(0x12c)),console['log'](_0x41a679(0xe2)+_0xf8b538[_0x41a679(0xcb)]+_0x41a679(0x147)),console[_0x41a679(0xeb)](_0x41a679(0x11a)+_0xf8b538[_0x41a679(0x114)]+'\x20USDT\x20(current\x20balance)'),console[_0x41a679(0xeb)](_0x41a679(0x196)+_0xf8b538[_0x41a679(0x1a8)]+_0x41a679(0xbe)),_0xf8b538;}['getGatewayDisplayName'](_0x147f21){const _0x166212=a86_0x278ab8,_0x56f51e={'test_gateway':_0x166212(0x146),'plisio':'Plisio','rapyd':_0x166212(0x171),'noda':_0x166212(0x13d),'cointopay':_0x166212(0x166),'klyme_eu':_0x166212(0xdf),'klyme_gb':_0x166212(0x143),'klyme_de':_0x166212(0x144)};return _0x56f51e[_0x147f21]||_0x147f21;}async[a86_0x278ab8(0x191)](_0x16cc13){return this['getShopPayoutStats'](_0x16cc13);}async[a86_0x278ab8(0xe0)](_0x418d05,_0x307d8a){const _0x4176a3=a86_0x278ab8,{page:_0xec92d,limit:_0x4de081,paymentId:_0x20d8f1}=_0x307d8a,_0x4af2b4=(_0xec92d-0x1)*_0x4de081,_0x10b1d8={'shopId':_0x418d05};_0x20d8f1&&(_0x10b1d8['paymentId']=_0x20d8f1);const [_0x34eb38,_0x5d7d04]=await Promise['all']([database_1[_0x4176a3(0x108)]['webhookLog'][_0x4176a3(0x17e)]({'where':_0x10b1d8,'skip':_0x4af2b4,'take':_0x4de081,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x4176a3(0x108)][_0x4176a3(0x12a)][_0x4176a3(0x13a)]({'where':_0x10b1d8})]);return{'logs':_0x34eb38[_0x4176a3(0x1a7)](_0x210f83=>({'id':_0x210f83['id'],'paymentId':_0x210f83['paymentId'],'shopId':_0x210f83[_0x4176a3(0xd7)],'event':_0x210f83[_0x4176a3(0x11c)],'statusCode':_0x210f83[_0x4176a3(0x117)],'retryCount':_0x210f83['retryCount'],'responseBody':_0x210f83[_0x4176a3(0x19a)],'createdAt':_0x210f83[_0x4176a3(0xbd)],'payment':_0x210f83['payment']})),'pagination':{'page':_0xec92d,'limit':_0x4de081,'total':_0x5d7d04,'totalPages':Math['ceil'](_0x5d7d04/_0x4de081)}};}async[a86_0x278ab8(0x104)](_0x54ea6a,_0x14ba66,_0x4159cb,_0x106604,_0x583b15){const _0x3d6adb=a86_0x278ab8;console['log'](_0x3d6adb(0x186)+_0x54ea6a+',\x20period:\x20'+_0x14ba66+_0x3d6adb(0xf3)+_0x4159cb+_0x3d6adb(0x14b)+_0x106604);const _0x4e80b9=_0x583b15?new Date(_0x583b15):new Date();let _0x4a61d6,_0x45b315;if(_0x4159cb&&_0x106604){const _0x1db3f0=new Date(_0x4159cb),_0x4e1d53=new Date(_0x106604);_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0x1db3f0[_0x3d6adb(0x187)](),_0x1db3f0[_0x3d6adb(0xd9)](),_0x1db3f0[_0x3d6adb(0x135)](),0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x4e1d53[_0x3d6adb(0x187)](),_0x4e1d53[_0x3d6adb(0xd9)](),_0x4e1d53[_0x3d6adb(0x135)](),0x17,0x3b,0x3b,0x3e7)),console[_0x3d6adb(0xeb)](_0x3d6adb(0x106)+_0x4a61d6['toISOString']()+'\x20to\x20'+_0x45b315[_0x3d6adb(0x13b)]());}else{if(_0x14ba66&&_0x14ba66[_0x3d6adb(0x150)](_0x3d6adb(0xda))){const _0x3cdd31=_0x14ba66['replace']('custom_','')[_0x3d6adb(0x17c)]('_');if(_0x3cdd31[_0x3d6adb(0x154)]===0x2){const _0x8ef50c=new Date(_0x3cdd31[0x0]),_0x3e4acb=new Date(_0x3cdd31[0x1]);_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0x8ef50c[_0x3d6adb(0x187)](),_0x8ef50c[_0x3d6adb(0xd9)](),_0x8ef50c[_0x3d6adb(0x135)](),0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x3e4acb[_0x3d6adb(0x187)](),_0x3e4acb['getUTCMonth'](),_0x3e4acb['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x3d6adb(0xeb)]('üìÖ\x20Custom\x20period:\x20'+_0x4a61d6['toISOString']()+'\x20to\x20'+_0x45b315[_0x3d6adb(0x13b)]());}else{const _0x4efff9=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)](),_0x4e80b9[_0x3d6adb(0x135)]()-0x1e));_0x4a61d6=new Date(Date['UTC'](_0x4efff9[_0x3d6adb(0x187)](),_0x4efff9[_0x3d6adb(0xd9)](),_0x4efff9['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)](),_0x4e80b9[_0x3d6adb(0x135)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x81764c=_0x14ba66||_0x3d6adb(0x190);switch(_0x81764c[_0x3d6adb(0x105)]()){case _0x3d6adb(0x109):_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)](),_0x4e80b9['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)](),_0x4e80b9[_0x3d6adb(0x135)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3d6adb(0x137):const _0xc6cfe5=new Date(_0x4e80b9);_0xc6cfe5[_0x3d6adb(0xd6)](_0xc6cfe5['getUTCDate']()-0x1),_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0xc6cfe5[_0x3d6adb(0x187)](),_0xc6cfe5[_0x3d6adb(0xd9)](),_0xc6cfe5[_0x3d6adb(0x135)](),0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date['UTC'](_0xc6cfe5[_0x3d6adb(0x187)](),_0xc6cfe5[_0x3d6adb(0xd9)](),_0xc6cfe5[_0x3d6adb(0x135)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3d6adb(0x18a):const _0x39a8fc=_0x4e80b9['getUTCDay'](),_0x27e4ee=_0x39a8fc===0x0?-0x6:0x1-_0x39a8fc,_0x377cad=_0x4e80b9[_0x3d6adb(0x135)]()+_0x27e4ee;_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9['getUTCFullYear'](),_0x4e80b9['getUTCMonth'](),_0x377cad,0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date['UTC'](_0x4e80b9['getUTCFullYear'](),_0x4e80b9[_0x3d6adb(0xd9)](),_0x4e80b9[_0x3d6adb(0x135)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3d6adb(0x16b):const _0xa26ff2=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9['getUTCMonth'](),_0x4e80b9[_0x3d6adb(0x135)]()-0x7)),_0x2ce914=_0xa26ff2[_0x3d6adb(0xec)](),_0x3518b3=_0x2ce914===0x0?-0x6:0x1-_0x2ce914,_0x56abdc=_0xa26ff2[_0x3d6adb(0x135)]()+_0x3518b3;_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0xa26ff2['getUTCFullYear'](),_0xa26ff2[_0x3d6adb(0xd9)](),_0x56abdc,0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0xa26ff2[_0x3d6adb(0x187)](),_0xa26ff2[_0x3d6adb(0xd9)](),_0x56abdc+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x3d6adb(0x190):_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)](),0x1,0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9['getUTCFullYear'](),_0x4e80b9[_0x3d6adb(0xd9)](),_0x4e80b9[_0x3d6adb(0x135)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x4a61d6=new Date(Date['UTC'](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x3d6adb(0xd8):_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9['getUTCFullYear'](),_0x4e80b9['getUTCMonth'](),_0x4e80b9['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x4a61d6=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)](),0x1,0x0,0x0,0x0,0x0)),_0x45b315=new Date(Date[_0x3d6adb(0xd1)](_0x4e80b9[_0x3d6adb(0x187)](),_0x4e80b9[_0x3d6adb(0xd9)](),_0x4e80b9[_0x3d6adb(0x135)](),0x17,0x3b,0x3b,0x3e7));}}}console['log']('üìÖ\x20Final\x20date\x20range:\x20'+_0x4a61d6[_0x3d6adb(0x13b)]()+_0x3d6adb(0x127)+_0x45b315[_0x3d6adb(0x13b)]());const _0x4154f6={'gte':_0x4a61d6,'lte':_0x45b315},[_0x4b3528,_0x1df72b,_0x2bedc6,_0x20654d,_0x66b17d,_0x4d77c1,_0x58bedd,_0x3e5a22,_0x2d2d6f,_0x11e15c,_0x40055a]=await Promise[_0x3d6adb(0xca)]([database_1[_0x3d6adb(0x108)][_0x3d6adb(0x136)][_0x3d6adb(0x13a)]({'where':{'shopId':_0x54ea6a,'gateway':{'not':'test_gateway'},'status':{'notIn':['PENDING',_0x3d6adb(0x1a9)]},'createdAt':_0x4154f6}}),database_1['default'][_0x3d6adb(0x136)][_0x3d6adb(0x13a)]({'where':{'shopId':_0x54ea6a,'gateway':{'not':_0x3d6adb(0xc8)},'status':_0x3d6adb(0x19b),'createdAt':_0x4154f6}}),database_1[_0x3d6adb(0x108)][_0x3d6adb(0x136)][_0x3d6adb(0x13a)]({'where':{'shopId':_0x54ea6a,'gateway':{'not':'test_gateway'},'status':'CHARGEBACK'}}),database_1[_0x3d6adb(0x108)][_0x3d6adb(0x136)][_0x3d6adb(0x13a)]({'where':{'shopId':_0x54ea6a,'gateway':{'not':_0x3d6adb(0xc8)},'status':_0x3d6adb(0x193)}}),database_1['default']['payment'][_0x3d6adb(0x17e)]({'where':{'shopId':_0x54ea6a,'gateway':{'not':'test_gateway'},'status':_0x3d6adb(0x19b),'createdAt':_0x4154f6},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1['default']['payment']['findMany']({'where':{'shopId':_0x54ea6a,'gateway':{'not':'test_gateway'}},'take':0x4,'orderBy':{'createdAt':_0x3d6adb(0x179)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3d6adb(0x108)][_0x3d6adb(0x136)]['findMany']({'where':{'shopId':_0x54ea6a,'gateway':{'not':_0x3d6adb(0xc8)},'createdAt':_0x4154f6},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3d6adb(0xc4)}}),database_1[_0x3d6adb(0x108)][_0x3d6adb(0x136)]['count']({'where':{'shopId':_0x54ea6a,'gateway':{'not':_0x3d6adb(0xc8)},'status':_0x3d6adb(0x19b)}}),database_1[_0x3d6adb(0x108)][_0x3d6adb(0x136)]['findMany']({'where':{'shopId':_0x54ea6a,'gateway':{'not':_0x3d6adb(0xc8)},'status':_0x3d6adb(0x19b)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x3d6adb(0x108)][_0x3d6adb(0x16d)][_0x3d6adb(0x148)]({'where':{'id':_0x54ea6a},'select':{'balance':!![]}}),database_1[_0x3d6adb(0x108)]['payment']['findMany']({'where':{'shopId':_0x54ea6a,'gateway':{'not':'test_gateway'}},'select':{'gateway':!![]}})]),_0x536e13={};for(const _0x5b8135 of _0x40055a){_0x5b8135[_0x3d6adb(0xf0)]&&(_0x536e13[_0x5b8135[_0x3d6adb(0xf0)]]=(_0x536e13[_0x5b8135['gateway']]||0x0)+0x1);}console[_0x3d6adb(0xeb)](_0x3d6adb(0x107),_0x536e13);let _0x57437b=0x0,_0x31b7e1=0x0;for(const _0x51b6c1 of _0x66b17d){if(_0x51b6c1[_0x3d6adb(0x113)])_0x57437b+=_0x51b6c1[_0x3d6adb(0x113)];else{const _0x251c04=await currencyService_1['currencyService']['convertToUSDT'](_0x51b6c1[_0x3d6adb(0x160)],_0x51b6c1[_0x3d6adb(0x16f)]);_0x57437b+=_0x251c04;}_0x51b6c1[_0x3d6adb(0xe7)]&&(_0x31b7e1+=_0x51b6c1[_0x3d6adb(0xe7)]);}let _0x19bf98=0x0;for(const _0x39c10a of _0x2d2d6f){_0x39c10a[_0x3d6adb(0xe7)]&&(_0x19bf98+=_0x39c10a['amountAfterGatewayCommissionUSDT']);}const _0x32a787=this['generateDailyStatistics'](_0x58bedd,_0x4a61d6,_0x45b315||_0x4e80b9),_0x981006=_0x4b3528>0x0?_0x1df72b/_0x4b3528*0x64:0x0,_0x4876f5=_0x3e5a22>0x0?_0x2bedc6/_0x3e5a22*0x64:0x0;return{'totalPayments':_0x4b3528,'successfulPayments':_0x1df72b,'totalRevenue':Math[_0x3d6adb(0x195)](_0x57437b*0x64)/0x64,'merchantEarnings':Math['round'](_0x31b7e1*0x64)/0x64,'merchantTotalRevenue':Math['round'](_0x19bf98*0x64)/0x64,'payoutBalance':Math[_0x3d6adb(0x195)]((_0x11e15c?.[_0x3d6adb(0x176)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x981006*0x64)/0x64,'chargebackRate':Math[_0x3d6adb(0x195)](_0x4876f5*0x64)/0x64,'chargebacks':_0x2bedc6,'refunds':_0x20654d,'paymentsByGateway':_0x536e13,'dailyRevenue':_0x32a787[_0x3d6adb(0x101)],'dailyPayments':_0x32a787[_0x3d6adb(0x1a0)],'recentPayments':_0x4d77c1[_0x3d6adb(0x1a7)](_0x1cfb14=>({'id':_0x1cfb14['id'],'gateway':_0x1cfb14['gateway'],'amount':_0x1cfb14[_0x3d6adb(0x160)],'currency':_0x1cfb14['currency'],'status':_0x1cfb14[_0x3d6adb(0x12f)],'createdAt':_0x1cfb14[_0x3d6adb(0xbd)]}))};}[a86_0x278ab8(0xf2)](_0x5c276a,_0x5670b2,_0x4fbd75){const _0x385ec0=a86_0x278ab8,_0x2a0117=new Map(),_0x72805e=new Date(_0x5670b2);while(_0x72805e<=_0x4fbd75){const _0x2b778=_0x72805e[_0x385ec0(0x13b)]()[_0x385ec0(0x17c)]('T')[0x0];_0x2a0117[_0x385ec0(0x11d)](_0x2b778,{'revenue':0x0,'count':0x0}),_0x72805e[_0x385ec0(0x131)](_0x72805e[_0x385ec0(0x194)]()+0x1);}for(const _0x1816f0 of _0x5c276a){const _0x455886=_0x1816f0[_0x385ec0(0xbd)][_0x385ec0(0x13b)]()['split']('T')[0x0],_0x29ef3a=_0x2a0117[_0x385ec0(0x159)](_0x455886);_0x29ef3a&&(_0x29ef3a[_0x385ec0(0x13a)]+=0x1,_0x1816f0[_0x385ec0(0x12f)]==='PAID'&&_0x1816f0[_0x385ec0(0x113)]&&(_0x29ef3a[_0x385ec0(0x153)]+=_0x1816f0[_0x385ec0(0x113)]));}const _0x4cec92=[],_0x30f3d8=[];for(const [_0x5269fa,_0x182615]of _0x2a0117){_0x4cec92[_0x385ec0(0xdb)]({'date':_0x5269fa,'amount':Math[_0x385ec0(0x195)](_0x182615['revenue']*0x64)/0x64}),_0x30f3d8[_0x385ec0(0xdb)]({'date':_0x5269fa,'count':_0x182615[_0x385ec0(0x13a)]});}return{'dailyRevenue':_0x4cec92,'dailyPayments':_0x30f3d8};}[a86_0x278ab8(0x14e)](_0x4650fd=0x8){const _0x205043=a86_0x278ab8,_0x18ae0f=[];for(let _0x202a5b=0x0;_0x202a5b<_0x4650fd;_0x202a5b++){const _0x4ef071=crypto_1[_0x205043(0x108)][_0x205043(0xcd)](0x4)[_0x205043(0x14d)]('hex')['toUpperCase']();_0x18ae0f[_0x205043(0xdb)](_0x4ef071);}return _0x18ae0f;}async[a86_0x278ab8(0x110)](_0x4dcad8){const _0x56d259=a86_0x278ab8,_0x1ff95b=await database_1['default'][_0x56d259(0x16d)][_0x56d259(0x148)]({'where':{'id':_0x4dcad8},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x1ff95b)throw new Error(_0x56d259(0xd2));const _0x28c444=speakeasy_1[_0x56d259(0x108)]['generateSecret']({'name':_0x56d259(0x122)+_0x1ff95b[_0x56d259(0x15d)]+')','issuer':_0x56d259(0x16c),'length':0x20}),_0xe1cf5a=await qrcode_1['default'][_0x56d259(0x14f)](_0x28c444[_0x56d259(0x10b)]),_0x369144=this[_0x56d259(0x14e)](0x8),_0x24bcdd=await Promise[_0x56d259(0xca)](_0x369144[_0x56d259(0x1a7)](_0x21a554=>bcryptjs_1[_0x56d259(0x108)][_0x56d259(0x116)](_0x21a554,0xa)));return await database_1[_0x56d259(0x108)][_0x56d259(0x16d)][_0x56d259(0x173)]({'where':{'id':_0x4dcad8},'data':{'twoFactorSecret':_0x28c444[_0x56d259(0x167)],'backupCodes':JSON[_0x56d259(0x133)](_0x24bcdd)}}),console[_0x56d259(0xeb)](_0x56d259(0x15f)+_0x1ff95b['username']),console[_0x56d259(0xeb)](_0x56d259(0xc5)+_0x369144['length']+_0x56d259(0xd5)),{'secret':_0x28c444['base32'],'qrCode':_0xe1cf5a,'manualEntryKey':_0x28c444['base32'],'backupCodes':_0x369144};}async[a86_0x278ab8(0xf8)](_0x34bc2d,_0x3c1edd){const _0x235d29=a86_0x278ab8,_0x161cc7=await database_1[_0x235d29(0x108)][_0x235d29(0x16d)][_0x235d29(0x148)]({'where':{'id':_0x34bc2d},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x161cc7)throw new Error(_0x235d29(0xd2));if(!_0x161cc7[_0x235d29(0x10f)])throw new Error(_0x235d29(0x1a3));if(_0x161cc7[_0x235d29(0x19c)])throw new Error(_0x235d29(0x1a5));const _0x4c6fe8=speakeasy_1[_0x235d29(0x108)][_0x235d29(0x1a1)][_0x235d29(0xdd)]({'secret':_0x161cc7['twoFactorSecret'],'encoding':'base32','token':_0x3c1edd,'window':0x2});if(!_0x4c6fe8)throw new Error(_0x235d29(0x157));return await database_1[_0x235d29(0x108)][_0x235d29(0x16d)][_0x235d29(0x173)]({'where':{'id':_0x34bc2d},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x235d29(0xff)+_0x161cc7[_0x235d29(0x15d)]),{'enabled':!![]};}async[a86_0x278ab8(0xf4)](_0x427f97){const _0x30e442=a86_0x278ab8,_0x4e0a39=await database_1[_0x30e442(0x108)][_0x30e442(0x16d)][_0x30e442(0x148)]({'where':{'id':_0x427f97},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4e0a39)throw new Error(_0x30e442(0xd2));await database_1['default'][_0x30e442(0x16d)][_0x30e442(0x173)]({'where':{'id':_0x427f97},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x30e442(0xeb)](_0x30e442(0x138)+_0x4e0a39['username']);}}exports[a86_0x278ab8(0x180)]=ShopService;function a86_0x2903(){const _0xacb1be=['REJECTED','dailyPayments','totp','6312636aYsDZf','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','üìÖ\x20Date\x20start:\x20','2FA\x20is\x20already\x20enabled','getPaymentById','map','thisMonth','EXPIRED','getFullYear','createdAt','\x20USDT','Error\x20parsing\x20webhook\x20events:','Webhook\x20returned\x20error:\x20','redirectUrl','toUpperCase','name','asc','üîë\x20Generated\x20','PENDING','erc20_usdc','test_gateway','getTime','all','totalPaidOut','webhookEvents','randomBytes','8fpgjco','ceil','./currencyService','UTC','Shop\x20not\x20found','USDT\x20Polygon','üìÖ\x20Date\x20end:\x20','\x20backup\x20codes','setUTCDate','shopId','all_time','getUTCMonth','custom_','push','isActive','verify','reduce','KLYME\x20EU','getWebhookLogs','getPaymentByShopAndId','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','paymentGateways','YESTERDAY','replace','setHours','amountAfterGatewayCommissionUSDT','getShopPayoutStats','shopUrl','createHmac','log','getUTCDay','370yNgLpV','USDC\x20Ethereum','backupCodes','gateway','payout','generateDailyStatistics',',\x20dateFrom:\x20','disable2FA','fullName','language','test_payment_123','enable2FA','network','isArray','test_order_123','COMPLETED','notes','üìÖ\x20Period\x20end:\x20','üîê\x202FA\x20enabled\x20for\x20shop:\x20','./paymentService','dailyRevenue','polygon','getPaymentsByShop','getStatistics','toLowerCase','üìÖ\x20Custom\x20date\x20range:\x20','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','default','today','getPayouts','otpauth_url','publicKey','../types/gateway','crypto','twoFactorSecret','setup2FA','application/json','10601307PDFAXZ','amountUSDT','awaitingPayout','txid','hash','statusCode','usdtTrcWallet','No\x20webhook\x20URL\x20configured','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','error','event','set','gte','getShopProfile','deletePayment','USDT\x20ERC20','TrapaPay\x20(','usdtErcWallet','2667280ADebjJ','24wOgWOV','formatNetworkName','\x20to\x20','settings','findFirst','webhookLog','splice','\x20USDT\x20(current\x20balance)','test','_sum','status','qrcode','setDate','USDC\x20Polygon','stringify','parse','getUTCDate','payment','yesterday','üîê\x202FA\x20disabled\x20for\x20shop:\x20','webhookUrl','count','toISOString','Test\x20webhook\x20sent\x20successfully\x20(','Noda','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','üìä\x20Shop\x20','90d','\x20\x20\x20üíµ\x20Available\x20balance:\x20','__esModule','KLYME\x20GB','KLYME\x20DE','AVAILABLE_GATEWAYS','Test\x20Gateway','\x20USDT\x20(total\x20payouts)','findUnique','usdtPolygonWallet','602130UmaOOD',',\x20dateTo:\x20','customerEmail','toString','generateBackupCodes','toDataURL','startsWith','secretKey','statusText','revenue','length','wallets','üìÖ\x20Period\x20start:\x20','Invalid\x202FA\x20token','bcryptjs','get','aggregate','186BMYwJp','30d','username','getPayoutStatistics','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','amount','compare','getMonth','__importDefault','usdcErcWallet','twoFactorToken','CoinToPay','base32','47619620yzWCmh','USD','createPublicPayment','last_week','TrapaPay','shop','usdcPolygonWallet','currency','2FA\x20token\x20is\x20required','Rapyd','hex','update','paid','updateWallets','balance','gatewaySettings','...','desc','periodFrom','üåê\x20Network\x20filter:\x20','split','filter','findMany','11BGHjDi','ShopService','paymentService','periodTo','üìä\x20Final\x20WHERE\x20conditions:','telegram','speakeasy','üìä\x20Getting\x20statistics\x20for\x20shop\x20','getUTCFullYear','merchantUrl','getPayments','this_week','USDT\x20TRC20','lte','trc20','Payment\x20not\x20found','defineProperty','this_month','getPayoutStats','paidAt','REFUND','getDate','round','\x20\x20\x20üìÖ\x20This\x20month:\x20','üìä\x20Status\x20filter:\x20','telegramId','message','responseBody','PAID','twoFactorEnabled','Payment\x20System/1.0\x20(Test)','1512070QYSRqt'];a86_0x2903=function(){return _0xacb1be;};return a86_0x2903();}