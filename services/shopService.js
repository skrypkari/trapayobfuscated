'use strict';const a56_0x3cab3d=a56_0x7961;function a56_0x7961(_0x13562c,_0x2f8c11){const _0x44fe92=a56_0x44fe();return a56_0x7961=function(_0x79618e,_0x12e4dd){_0x79618e=_0x79618e-0x14a;let _0x1d6edb=_0x44fe92[_0x79618e];return _0x1d6edb;},a56_0x7961(_0x13562c,_0x2f8c11);}(function(_0x3c63ed,_0x3274ef){const _0x2bee28=a56_0x7961,_0x424765=_0x3c63ed();while(!![]){try{const _0xbfab76=parseInt(_0x2bee28(0x1da))/0x1*(-parseInt(_0x2bee28(0x16e))/0x2)+-parseInt(_0x2bee28(0x14a))/0x3*(-parseInt(_0x2bee28(0x185))/0x4)+-parseInt(_0x2bee28(0x187))/0x5+-parseInt(_0x2bee28(0x1a2))/0x6+parseInt(_0x2bee28(0x1b1))/0x7*(-parseInt(_0x2bee28(0x1aa))/0x8)+parseInt(_0x2bee28(0x1af))/0x9*(parseInt(_0x2bee28(0x165))/0xa)+parseInt(_0x2bee28(0x186))/0xb*(parseInt(_0x2bee28(0x1c9))/0xc);if(_0xbfab76===_0x3274ef)break;else _0x424765['push'](_0x424765['shift']());}catch(_0x121a5f){_0x424765['push'](_0x424765['shift']());}}}(a56_0x44fe,0x88d5a));var __importDefault=this&&this['__importDefault']||function(_0x50bfbe){const _0x4d1ec3=a56_0x7961;return _0x50bfbe&&_0x50bfbe[_0x4d1ec3(0x1b3)]?_0x50bfbe:{'default':_0x50bfbe};};Object[a56_0x3cab3d(0x1d4)](exports,a56_0x3cab3d(0x1b3),{'value':!![]}),exports['ShopService']=void 0x0;function a56_0x44fe(){const _0x478ef2=['Noda','üìä\x20Shop\x20','error','erc20','currencyService','PAID','telegram','aggregate','setHours','set','availableBalance','PENDING','30d','webhookLog','PaymentService','shop','getMonth','periodFrom','gatewaySettings','message','81192QdjYYT','totalPaidOut','ceil','USD','USDT\x20TRC20','Payment\x20not\x20found','USDT\x20Polygon','üìÖ\x20Date\x20end:\x20','USDT\x20ERC20','ShopService','parse','defineProperty','Webhook\x20returned\x20error:\x20','usdtTrcWallet','desc','test_payment_123','polygon_usdc','4EzaqHY','toISOString','test_gateway','name','stringify','KLYME\x20GB','paymentService','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','./currencyService','getShopPayoutStats','KLYME\x20DE','USDC\x20Polygon','Error\x20parsing\x20webhook\x20events:','thisMonth','findUnique','log','toUpperCase','payout','webhookUrl','trc20','telegramId','network','../config/database','usdtErcWallet','getFullYear','customerName','updateShopProfile','maxPayments','merchantUrl','polygon','payment','createdAt','findMany','getPayouts','getPaymentById','balance','Test\x20webhook\x20sent\x20successfully\x20(','304494dlTYwh','./paymentService','formatNetworkName','updatePayment','gte','\x20\x20\x20üíµ\x20Available\x20balance:\x20','redirectUrl','fullName','getPayoutStats','settings','getTime','filter','usdcPolygonWallet','createPayment','lte','paidAt','getPayoutStatistics','No\x20webhook\x20URL\x20configured','currency','amountUSDT','KLYME\x20EU','reduce','gateways','application/json','\x20\x20\x20üìÖ\x20This\x20month:\x20','getShopProfile','all','60PvFrbz','notes','\x20payout\x20statistics\x20calculated:','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','default','updateWallets','convertToUSDT','statusCode','shopUrl','526798eosNab','test','delete','customerEmail','paid','üìä\x20Final\x20WHERE\x20conditions:','Unknown\x20error','üí∞\x20Getting\x20payouts\x20with\x20filters:','TesSoft\x20Payment\x20System/1.0\x20(Test)','gateway','getGatewayDisplayName','üìä\x20Status\x20filter:\x20','üìÖ\x20Period\x20end:\x20','test_order_123','setDate','publicKey','REJECTED','usage','\x20USDT','üåê\x20Network\x20filter:\x20','shopId','getPaymentsByShop','generateDailyStatistics','36utRBKR','4103Bdrsjk','452260OtPZRb','paymentId','split','paymentGateways','push','map','amount','üåê\x20Method\x20filter:\x20','üìÖ\x20Date\x20start:\x20','get','revenue','findFirst','count','getPaymentByShopAndId','status','USDT\x20BSC','\x20USDT\x20(current\x20balance)','retryCount','...','round','wallets','awaitingPayout','txid','webhookEvents','getWebhookLogs','CoinToPay','90d','5187360YzXYJD','usdtPolygonWallet','Plisio','COMPLETED','username','language','isArray','statusText','3753824rxPkIE','getPayments','event','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','asc','105507JGWcmR','üìÖ\x20Period\x20start:\x20','14iLFuVx','\x20USDT\x20(total\x20payouts)','__esModule','update'];a56_0x44fe=function(){return _0x478ef2;};return a56_0x44fe();}const database_1=__importDefault(require(a56_0x3cab3d(0x1f0))),currencyService_1=require(a56_0x3cab3d(0x1e2)),paymentService_1=require(a56_0x3cab3d(0x14b));class ShopService{constructor(){const _0x1ee353=a56_0x3cab3d;this[_0x1ee353(0x1e0)]=new paymentService_1[(_0x1ee353(0x1c3))]();}async[a56_0x3cab3d(0x163)](_0x2a5ca6){const _0x125c7e=a56_0x3cab3d,_0x4d8d01=await database_1[_0x125c7e(0x169)]['shop'][_0x125c7e(0x1e8)]({'where':{'id':_0x2a5ca6},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x4d8d01)throw new Error('Shop\x20not\x20found');let _0x396825=[];if(_0x4d8d01[_0x125c7e(0x153)]?.[_0x125c7e(0x19e)])try{_0x396825=Array[_0x125c7e(0x1a8)](_0x4d8d01[_0x125c7e(0x153)][_0x125c7e(0x19e)])?_0x4d8d01['settings'][_0x125c7e(0x19e)]:JSON[_0x125c7e(0x1d3)](_0x4d8d01[_0x125c7e(0x153)][_0x125c7e(0x19e)]);}catch(_0x1f2d24){console[_0x125c7e(0x1b7)](_0x125c7e(0x1e6),_0x1f2d24),_0x396825=[];}return{'id':_0x4d8d01['id'],'fullName':_0x4d8d01[_0x125c7e(0x1dd)],'username':_0x4d8d01[_0x125c7e(0x1a6)],'telegramId':_0x4d8d01[_0x125c7e(0x1bb)],'merchantUrl':_0x4d8d01[_0x125c7e(0x16d)],'gateways':_0x4d8d01[_0x125c7e(0x18a)]?JSON['parse'](_0x4d8d01['paymentGateways']):null,'gatewaySettings':_0x4d8d01['gatewaySettings']?JSON['parse'](_0x4d8d01[_0x125c7e(0x1c7)]):null,'publicKey':_0x4d8d01[_0x125c7e(0x17d)],'webhookUrl':_0x4d8d01[_0x125c7e(0x153)]?.[_0x125c7e(0x1ec)]||null,'webhookEvents':_0x396825,'wallets':{'usdtPolygonWallet':_0x4d8d01[_0x125c7e(0x1a3)],'usdtTrcWallet':_0x4d8d01[_0x125c7e(0x1d6)],'usdtErcWallet':_0x4d8d01[_0x125c7e(0x1f1)],'usdcPolygonWallet':_0x4d8d01[_0x125c7e(0x156)]},'status':_0x4d8d01['status'],'createdAt':_0x4d8d01[_0x125c7e(0x1f9)]};}async[a56_0x3cab3d(0x1f4)](_0x50ced8,_0x55e66a){const _0xa855f2=a56_0x3cab3d,_0x25b2cc={};_0x55e66a[_0xa855f2(0x151)]&&(_0x25b2cc[_0xa855f2(0x1dd)]=_0x55e66a[_0xa855f2(0x151)]);_0x55e66a[_0xa855f2(0x1ee)]!==undefined&&(_0x25b2cc[_0xa855f2(0x1bb)]=_0x55e66a['telegramId']||null);_0x55e66a[_0xa855f2(0x1f6)]&&(_0x25b2cc[_0xa855f2(0x16d)]=_0x55e66a[_0xa855f2(0x1f6)]);_0x55e66a[_0xa855f2(0x160)]&&(_0x25b2cc[_0xa855f2(0x18a)]=JSON[_0xa855f2(0x1de)](_0x55e66a[_0xa855f2(0x160)]));_0x55e66a[_0xa855f2(0x1c7)]&&(_0x25b2cc['gatewaySettings']=JSON['stringify'](_0x55e66a[_0xa855f2(0x1c7)]));_0x55e66a['wallets']&&(_0x55e66a[_0xa855f2(0x19b)]['usdtPolygonWallet']!==undefined&&(_0x25b2cc[_0xa855f2(0x1a3)]=_0x55e66a[_0xa855f2(0x19b)][_0xa855f2(0x1a3)]||null),_0x55e66a[_0xa855f2(0x19b)][_0xa855f2(0x1d6)]!==undefined&&(_0x25b2cc[_0xa855f2(0x1d6)]=_0x55e66a[_0xa855f2(0x19b)]['usdtTrcWallet']||null),_0x55e66a[_0xa855f2(0x19b)][_0xa855f2(0x1f1)]!==undefined&&(_0x25b2cc[_0xa855f2(0x1f1)]=_0x55e66a[_0xa855f2(0x19b)][_0xa855f2(0x1f1)]||null),_0x55e66a[_0xa855f2(0x19b)][_0xa855f2(0x156)]!==undefined&&(_0x25b2cc[_0xa855f2(0x156)]=_0x55e66a['wallets']['usdcPolygonWallet']||null));const _0xdf22e7=await database_1[_0xa855f2(0x169)][_0xa855f2(0x1c4)][_0xa855f2(0x1b4)]({'where':{'id':_0x50ced8},'data':_0x25b2cc,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x418c84=[];if(_0xdf22e7['settings']?.[_0xa855f2(0x19e)])try{_0x418c84=Array[_0xa855f2(0x1a8)](_0xdf22e7[_0xa855f2(0x153)][_0xa855f2(0x19e)])?_0xdf22e7['settings'][_0xa855f2(0x19e)]:JSON['parse'](_0xdf22e7[_0xa855f2(0x153)][_0xa855f2(0x19e)]);}catch(_0x1edf7b){console['error'](_0xa855f2(0x1e6),_0x1edf7b),_0x418c84=[];}return{'id':_0xdf22e7['id'],'fullName':_0xdf22e7['name'],'username':_0xdf22e7['username'],'telegramId':_0xdf22e7['telegram'],'merchantUrl':_0xdf22e7[_0xa855f2(0x16d)],'gateways':_0xdf22e7[_0xa855f2(0x18a)]?JSON['parse'](_0xdf22e7[_0xa855f2(0x18a)]):null,'gatewaySettings':_0xdf22e7['gatewaySettings']?JSON[_0xa855f2(0x1d3)](_0xdf22e7[_0xa855f2(0x1c7)]):null,'publicKey':_0xdf22e7[_0xa855f2(0x17d)],'webhookUrl':_0xdf22e7['settings']?.[_0xa855f2(0x1ec)]||null,'webhookEvents':_0x418c84,'wallets':{'usdtPolygonWallet':_0xdf22e7['usdtPolygonWallet'],'usdtTrcWallet':_0xdf22e7[_0xa855f2(0x1d6)],'usdtErcWallet':_0xdf22e7[_0xa855f2(0x1f1)],'usdcPolygonWallet':_0xdf22e7[_0xa855f2(0x156)]},'status':_0xdf22e7[_0xa855f2(0x195)],'createdAt':_0xdf22e7['createdAt']};}async[a56_0x3cab3d(0x16a)](_0x344093,_0x30285d){const _0x453959=a56_0x3cab3d,_0x354304={};_0x30285d['usdtPolygonWallet']!==undefined&&(_0x354304[_0x453959(0x1a3)]=_0x30285d[_0x453959(0x1a3)]||null),_0x30285d[_0x453959(0x1d6)]!==undefined&&(_0x354304[_0x453959(0x1d6)]=_0x30285d[_0x453959(0x1d6)]||null),_0x30285d['usdtErcWallet']!==undefined&&(_0x354304[_0x453959(0x1f1)]=_0x30285d[_0x453959(0x1f1)]||null),_0x30285d['usdcPolygonWallet']!==undefined&&(_0x354304['usdcPolygonWallet']=_0x30285d[_0x453959(0x156)]||null),await database_1[_0x453959(0x169)][_0x453959(0x1c4)]['update']({'where':{'id':_0x344093},'data':_0x354304});}async['testWebhook'](_0x5499b7){const _0x785877=a56_0x3cab3d,_0xe39e5e=await database_1[_0x785877(0x169)][_0x785877(0x1c4)][_0x785877(0x1e8)]({'where':{'id':_0x5499b7},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0xe39e5e?.['settings']?.[_0x785877(0x1ec)])throw new Error(_0x785877(0x15b));const _0x1d8f04={'event':_0x785877(0x16f),'payment':{'id':_0x785877(0x1d8),'order_id':_0x785877(0x17b),'gateway':'test','amount':0x64,'currency':_0x785877(0x1cc),'status':_0x785877(0x172),'created_at':new Date()[_0x785877(0x1db)]()}};try{const _0x1aeacd=await fetch(_0xe39e5e[_0x785877(0x153)][_0x785877(0x1ec)],{'method':'POST','headers':{'Content-Type':_0x785877(0x161),'User-Agent':_0x785877(0x176)},'body':JSON[_0x785877(0x1de)](_0x1d8f04)});return _0x1aeacd['ok']?{'success':!![],'message':_0x785877(0x1fe)+_0x1aeacd[_0x785877(0x195)]+')'}:{'success':![],'message':_0x785877(0x1d5)+_0x1aeacd['status']+'\x20'+_0x1aeacd[_0x785877(0x1a9)]};}catch(_0x5ba2a9){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x5ba2a9 instanceof Error?_0x5ba2a9[_0x785877(0x1c8)]:_0x785877(0x174))};}}async[a56_0x3cab3d(0x157)](_0x26eb98){const _0x22f64f=a56_0x3cab3d;return this[_0x22f64f(0x1e0)]['createPublicPayment']({'public_key':'','gateway':_0x26eb98[_0x22f64f(0x177)],'order_id':undefined,'amount':_0x26eb98[_0x22f64f(0x18d)],'currency':_0x26eb98[_0x22f64f(0x15c)],'source_currency':_0x26eb98['sourceCurrency'],'usage':_0x26eb98[_0x22f64f(0x17f)],'expires_at':_0x26eb98['expiresAt']?.[_0x22f64f(0x1db)](),'success_url':_0x26eb98[_0x22f64f(0x150)],'fail_url':_0x26eb98[_0x22f64f(0x150)],'customer_email':_0x26eb98[_0x22f64f(0x171)],'customer_name':_0x26eb98[_0x22f64f(0x1f3)],'country':_0x26eb98['country'],'language':_0x26eb98[_0x22f64f(0x1a7)],'amount_is_editable':_0x26eb98['amountIsEditable'],'max_payments':_0x26eb98[_0x22f64f(0x1f5)],'customer':_0x26eb98['customer']});}async[a56_0x3cab3d(0x1ab)](_0x1b19b9,_0x50e4ac){const _0x2f9000=a56_0x3cab3d;return this[_0x2f9000(0x1e0)][_0x2f9000(0x183)](_0x1b19b9,_0x50e4ac);}async[a56_0x3cab3d(0x1fc)](_0x1ac504,_0x4c63eb){const _0x2142e3=a56_0x3cab3d;return this['paymentService'][_0x2142e3(0x194)](_0x1ac504,_0x4c63eb);}async[a56_0x3cab3d(0x14d)](_0x53bc9e,_0x2f1980,_0x20fc31){const _0x575c57=a56_0x3cab3d,_0x3aae33=await database_1[_0x575c57(0x169)][_0x575c57(0x1f8)][_0x575c57(0x192)]({'where':{'id':_0x2f1980,'shopId':_0x53bc9e}});if(!_0x3aae33)throw new Error('Payment\x20not\x20found');const _0x1d2f57=await database_1[_0x575c57(0x169)][_0x575c57(0x1f8)]['update']({'where':{'id':_0x2f1980},'data':{..._0x20fc31,'updatedAt':new Date()}});return _0x1d2f57;}async['deletePayment'](_0x2c2f61,_0x580c8c){const _0x91815c=a56_0x3cab3d,_0x42ef6b=await database_1['default'][_0x91815c(0x1f8)]['findFirst']({'where':{'id':_0x580c8c,'shopId':_0x2c2f61}});if(!_0x42ef6b)throw new Error(_0x91815c(0x1ce));await database_1[_0x91815c(0x169)][_0x91815c(0x1f8)][_0x91815c(0x170)]({'where':{'id':_0x580c8c}});}[a56_0x3cab3d(0x14c)](_0x11f113){const _0x3dbfcb=a56_0x3cab3d,_0x37cb9d={'polygon':_0x3dbfcb(0x1cf),'trc20':_0x3dbfcb(0x1cd),'erc20':_0x3dbfcb(0x1d1),'bsc':_0x3dbfcb(0x196),'polygon_usdc':_0x3dbfcb(0x1e5)};return _0x37cb9d[_0x11f113]||_0x11f113;}async[a56_0x3cab3d(0x1fb)](_0x490544,_0x205156){const _0x23ccbc=a56_0x3cab3d,{page:_0x3899a9,limit:_0x505fe3,status:_0x3ed359,method:_0x10d8f2,network:_0x5aca72,dateFrom:_0x3a0731,dateTo:_0x4e9cdf,periodFrom:_0x28029a,periodTo:_0x320dc2}=_0x205156,_0x301381=(_0x3899a9-0x1)*_0x505fe3;console[_0x23ccbc(0x1e9)](_0x23ccbc(0x175),_0x205156);const _0x54a424={'shopId':_0x490544};_0x3ed359&&(_0x54a424[_0x23ccbc(0x195)]=_0x3ed359[_0x23ccbc(0x1ea)](),console[_0x23ccbc(0x1e9)](_0x23ccbc(0x179)+_0x3ed359[_0x23ccbc(0x1ea)]()));if(_0x10d8f2)_0x54a424[_0x23ccbc(0x1ef)]=_0x10d8f2,console[_0x23ccbc(0x1e9)](_0x23ccbc(0x18e)+_0x10d8f2);else _0x5aca72&&(_0x54a424[_0x23ccbc(0x1ef)]=_0x5aca72,console[_0x23ccbc(0x1e9)](_0x23ccbc(0x181)+_0x5aca72));if(_0x3a0731||_0x4e9cdf||_0x28029a||_0x320dc2){_0x54a424['createdAt']={};if(_0x28029a){const _0x4a3a43=new Date(_0x28029a);_0x4a3a43[_0x23ccbc(0x1bd)](0x0,0x0,0x0,0x0),_0x54a424[_0x23ccbc(0x1f9)][_0x23ccbc(0x14e)]=_0x4a3a43,console[_0x23ccbc(0x1e9)](_0x23ccbc(0x1b0)+_0x4a3a43[_0x23ccbc(0x1db)]());}else{if(_0x3a0731){const _0x3076be=new Date(_0x3a0731);_0x3076be[_0x23ccbc(0x1bd)](0x0,0x0,0x0,0x0),_0x54a424[_0x23ccbc(0x1f9)][_0x23ccbc(0x14e)]=_0x3076be,console[_0x23ccbc(0x1e9)](_0x23ccbc(0x18f)+_0x3076be[_0x23ccbc(0x1db)]());}}if(_0x320dc2){const _0x21d429=new Date(_0x320dc2);_0x21d429['setHours'](0x17,0x3b,0x3b,0x3e7),_0x54a424[_0x23ccbc(0x1f9)][_0x23ccbc(0x158)]=_0x21d429,console[_0x23ccbc(0x1e9)](_0x23ccbc(0x17a)+_0x21d429['toISOString']());}else{if(_0x4e9cdf){const _0xc5cc2=new Date(_0x4e9cdf);_0xc5cc2[_0x23ccbc(0x1bd)](0x17,0x3b,0x3b,0x3e7),_0x54a424[_0x23ccbc(0x1f9)][_0x23ccbc(0x158)]=_0xc5cc2,console['log'](_0x23ccbc(0x1d0)+_0xc5cc2[_0x23ccbc(0x1db)]());}}}console[_0x23ccbc(0x1e9)](_0x23ccbc(0x173),JSON[_0x23ccbc(0x1de)](_0x54a424,null,0x2));const [_0x32e3cf,_0x60dd78]=await Promise[_0x23ccbc(0x164)]([database_1[_0x23ccbc(0x169)][_0x23ccbc(0x1eb)]['findMany']({'where':_0x54a424,'skip':_0x301381,'take':_0x505fe3,'orderBy':{'createdAt':_0x23ccbc(0x1d7)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x23ccbc(0x1eb)][_0x23ccbc(0x193)]({'where':_0x54a424})]);return{'payouts':_0x32e3cf['map'](_0x5bcc21=>{const _0x33c7ff=_0x23ccbc;let _0x565e90=null;switch(_0x5bcc21[_0x33c7ff(0x1ef)]){case _0x33c7ff(0x1f7):_0x565e90=_0x5bcc21[_0x33c7ff(0x1c4)][_0x33c7ff(0x1a3)];break;case _0x33c7ff(0x1ed):_0x565e90=_0x5bcc21[_0x33c7ff(0x1c4)][_0x33c7ff(0x1d6)];break;case _0x33c7ff(0x1b8):_0x565e90=_0x5bcc21[_0x33c7ff(0x1c4)][_0x33c7ff(0x1f1)];break;case _0x33c7ff(0x1d9):_0x565e90=_0x5bcc21[_0x33c7ff(0x1c4)][_0x33c7ff(0x156)];break;}return{'id':_0x5bcc21['id'],'amount':_0x5bcc21[_0x33c7ff(0x18d)],'network':this[_0x33c7ff(0x14c)](_0x5bcc21[_0x33c7ff(0x1ef)]),'wallet':_0x565e90,'status':_0x5bcc21[_0x33c7ff(0x195)],'txid':_0x5bcc21[_0x33c7ff(0x19d)],'notes':_0x5bcc21[_0x33c7ff(0x166)],'periodFrom':_0x5bcc21[_0x33c7ff(0x1c6)],'periodTo':_0x5bcc21['periodTo'],'createdAt':_0x5bcc21['createdAt'],'paidAt':_0x5bcc21[_0x33c7ff(0x159)]};}),'pagination':{'page':_0x3899a9,'limit':_0x505fe3,'total':_0x60dd78,'totalPages':Math['ceil'](_0x60dd78/_0x505fe3)}};}async['getPayoutById'](_0x26f759,_0x43316d){const _0x31c281=a56_0x3cab3d,_0x4b96e2=await database_1['default'][_0x31c281(0x1eb)][_0x31c281(0x192)]({'where':{'id':_0x43316d,'shopId':_0x26f759}});if(!_0x4b96e2)return null;return{'id':_0x4b96e2['id'],'amount':_0x4b96e2['amount'],'network':_0x4b96e2[_0x31c281(0x1ef)],'status':_0x4b96e2[_0x31c281(0x195)],'txid':_0x4b96e2[_0x31c281(0x19d)],'notes':_0x4b96e2[_0x31c281(0x166)],'createdAt':_0x4b96e2[_0x31c281(0x1f9)],'paidAt':_0x4b96e2['paidAt']};}async[a56_0x3cab3d(0x15a)](_0x891023,_0x599452){const _0x1926a1=a56_0x3cab3d,_0x3219e7=new Date();let _0x23150a;switch(_0x599452){case'7d':_0x23150a=new Date(_0x3219e7['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1926a1(0x1c1):_0x23150a=new Date(_0x3219e7[_0x1926a1(0x154)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1926a1(0x1a1):_0x23150a=new Date(_0x3219e7['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x23150a=new Date(_0x3219e7['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1bde4b,_0x596410,_0x4b6875,_0x20c621,_0x3aae5e,_0x445f2e]=await Promise[_0x1926a1(0x164)]([database_1[_0x1926a1(0x169)][_0x1926a1(0x1eb)][_0x1926a1(0x193)]({'where':{'shopId':_0x891023,'createdAt':{'gte':_0x23150a}}}),database_1[_0x1926a1(0x169)][_0x1926a1(0x1eb)][_0x1926a1(0x193)]({'where':{'shopId':_0x891023,'status':_0x1926a1(0x1a5),'createdAt':{'gte':_0x23150a}}}),database_1['default']['payout'][_0x1926a1(0x193)]({'where':{'shopId':_0x891023,'status':_0x1926a1(0x1c0),'createdAt':{'gte':_0x23150a}}}),database_1[_0x1926a1(0x169)][_0x1926a1(0x1eb)][_0x1926a1(0x193)]({'where':{'shopId':_0x891023,'status':_0x1926a1(0x17e),'createdAt':{'gte':_0x23150a}}}),database_1[_0x1926a1(0x169)][_0x1926a1(0x1eb)]['findMany']({'where':{'shopId':_0x891023,'createdAt':{'gte':_0x23150a}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x1926a1(0x169)][_0x1926a1(0x1eb)][_0x1926a1(0x1fa)]({'where':{'shopId':_0x891023},'take':0xa,'orderBy':{'createdAt':_0x1926a1(0x1d7)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3060ce=_0x3aae5e[_0x1926a1(0x15f)]((_0x32cda8,_0x25a463)=>_0x32cda8+_0x25a463[_0x1926a1(0x18d)],0x0),_0x25bd8c=_0x3aae5e[_0x1926a1(0x155)](_0x85cb1c=>_0x85cb1c['status']===_0x1926a1(0x1a5))['reduce']((_0x48e8bc,_0x2da169)=>_0x48e8bc+_0x2da169[_0x1926a1(0x18d)],0x0),_0x2da1d5=_0x3aae5e[_0x1926a1(0x155)](_0x4add95=>_0x4add95[_0x1926a1(0x195)]===_0x1926a1(0x1c0))['reduce']((_0x262b99,_0x543fa5)=>_0x262b99+_0x543fa5['amount'],0x0),_0xa3c264=_0x3aae5e['reduce']((_0x47aab1,_0x161bd6)=>{const _0x2d986a=_0x1926a1;return _0x47aab1[_0x161bd6['network']]=(_0x47aab1[_0x161bd6[_0x2d986a(0x1ef)]]||0x0)+0x1,_0x47aab1;},{}),_0x1cad36=_0x3aae5e['reduce']((_0x34b458,_0x8f4358)=>{const _0x4246e6=_0x1926a1;return _0x34b458[_0x8f4358[_0x4246e6(0x195)]]=(_0x34b458[_0x8f4358['status']]||0x0)+0x1,_0x34b458;},{});return{'totalPayouts':_0x1bde4b,'completedPayouts':_0x596410,'pendingPayouts':_0x4b6875,'rejectedPayouts':_0x20c621,'totalAmount':_0x3060ce,'completedAmount':_0x25bd8c,'pendingAmount':_0x2da1d5,'payoutsByMethod':_0xa3c264,'payoutsByStatus':_0x1cad36,'recentPayouts':_0x445f2e[_0x1926a1(0x18c)](_0x5d1982=>({'id':_0x5d1982['id'],'shopId':_0x891023,'amount':_0x5d1982[_0x1926a1(0x18d)],'method':_0x5d1982[_0x1926a1(0x1ef)],'status':_0x5d1982[_0x1926a1(0x195)],'txid':_0x5d1982[_0x1926a1(0x19d)],'createdAt':_0x5d1982[_0x1926a1(0x1f9)],'paidAt':_0x5d1982[_0x1926a1(0x159)]}))};}async[a56_0x3cab3d(0x1e3)](_0x42130b){const _0x44f022=a56_0x3cab3d;console[_0x44f022(0x1e9)](_0x44f022(0x1e1)+_0x42130b+_0x44f022(0x199));const _0x1d4ca=await database_1[_0x44f022(0x169)][_0x44f022(0x1c4)][_0x44f022(0x1e8)]({'where':{'id':_0x42130b},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1d4ca)throw new Error('Shop\x20not\x20found');const _0x2a7ccd=new Date(),_0x166f06=new Date(_0x2a7ccd[_0x44f022(0x1f2)](),_0x2a7ccd['getMonth'](),0x1),_0x759092=new Date(_0x2a7ccd[_0x44f022(0x1f2)](),_0x2a7ccd[_0x44f022(0x1c5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4b42a8=await database_1[_0x44f022(0x169)][_0x44f022(0x1eb)][_0x44f022(0x1bc)]({'_sum':{'amount':!![]},'where':{'shopId':_0x42130b,'createdAt':{'gte':_0x166f06,'lte':_0x759092},'status':_0x44f022(0x1a5)}}),_0x4bf7f7=_0x4b42a8['_sum'][_0x44f022(0x18d)]||0x0,_0x51e5ee={'availableBalance':Math[_0x44f022(0x19a)](_0x1d4ca['balance']*0x64)/0x64,'totalPaidOut':Math[_0x44f022(0x19a)](_0x1d4ca[_0x44f022(0x1ca)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x1d4ca[_0x44f022(0x1fd)]*0x64)/0x64,'thisMonth':Math[_0x44f022(0x19a)](_0x4bf7f7*0x64)/0x64};return console[_0x44f022(0x1e9)](_0x44f022(0x1b6)+_0x1d4ca[_0x44f022(0x1a6)]+_0x44f022(0x167)),console[_0x44f022(0x1e9)](_0x44f022(0x14f)+_0x51e5ee[_0x44f022(0x1bf)]+_0x44f022(0x197)),console[_0x44f022(0x1e9)](_0x44f022(0x168)+_0x51e5ee[_0x44f022(0x1ca)]+_0x44f022(0x1b2)),console[_0x44f022(0x1e9)](_0x44f022(0x1ad)+_0x51e5ee[_0x44f022(0x19c)]+_0x44f022(0x197)),console[_0x44f022(0x1e9)](_0x44f022(0x162)+_0x51e5ee[_0x44f022(0x1e7)]+_0x44f022(0x180)),_0x51e5ee;}[a56_0x3cab3d(0x178)](_0xccb8df){const _0x5db0c0=a56_0x3cab3d,_0x1aba11={'test_gateway':'Test\x20Gateway','plisio':_0x5db0c0(0x1a4),'rapyd':'Rapyd','noda':_0x5db0c0(0x1b5),'cointopay':_0x5db0c0(0x1a0),'klyme_eu':_0x5db0c0(0x15e),'klyme_gb':_0x5db0c0(0x1df),'klyme_de':_0x5db0c0(0x1e4)};return _0x1aba11[_0xccb8df]||_0xccb8df;}async[a56_0x3cab3d(0x152)](_0x51feb1){const _0x26218d=a56_0x3cab3d;return this[_0x26218d(0x1e3)](_0x51feb1);}async[a56_0x3cab3d(0x19f)](_0x26c792,_0x55b0e5){const _0x118283=a56_0x3cab3d,{page:_0x1b101f,limit:_0xec1f39,paymentId:_0x5a5520}=_0x55b0e5,_0x3dd7a8=(_0x1b101f-0x1)*_0xec1f39,_0x2fcb6c={'shopId':_0x26c792};_0x5a5520&&(_0x2fcb6c[_0x118283(0x188)]=_0x5a5520);const [_0x40720a,_0x4d53e9]=await Promise[_0x118283(0x164)]([database_1[_0x118283(0x169)]['webhookLog'][_0x118283(0x1fa)]({'where':_0x2fcb6c,'skip':_0x3dd7a8,'take':_0xec1f39,'orderBy':{'createdAt':_0x118283(0x1d7)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x118283(0x169)][_0x118283(0x1c2)][_0x118283(0x193)]({'where':_0x2fcb6c})]);return{'logs':_0x40720a[_0x118283(0x18c)](_0x3599ba=>({'id':_0x3599ba['id'],'paymentId':_0x3599ba[_0x118283(0x188)],'shopId':_0x3599ba[_0x118283(0x182)],'event':_0x3599ba[_0x118283(0x1ac)],'statusCode':_0x3599ba[_0x118283(0x16c)],'retryCount':_0x3599ba[_0x118283(0x198)],'responseBody':_0x3599ba['responseBody'],'createdAt':_0x3599ba[_0x118283(0x1f9)],'payment':_0x3599ba[_0x118283(0x1f8)]})),'pagination':{'page':_0x1b101f,'limit':_0xec1f39,'total':_0x4d53e9,'totalPages':Math[_0x118283(0x1cb)](_0x4d53e9/_0xec1f39)}};}async['getStatistics'](_0x40f719,_0x485b8f){const _0x3c82ef=a56_0x3cab3d,_0x1d7eef=new Date();let _0xdd3c9e;switch(_0x485b8f){case'7d':_0xdd3c9e=new Date(_0x1d7eef[_0x3c82ef(0x154)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3c82ef(0x1c1):_0xdd3c9e=new Date(_0x1d7eef[_0x3c82ef(0x154)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3c82ef(0x1a1):_0xdd3c9e=new Date(_0x1d7eef[_0x3c82ef(0x154)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xdd3c9e=new Date(_0x1d7eef[_0x3c82ef(0x154)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x88f63b,_0x21ad59,_0x25bc05,_0x5e77af,_0x4c2fb7]=await Promise[_0x3c82ef(0x164)]([database_1[_0x3c82ef(0x169)]['payment'][_0x3c82ef(0x193)]({'where':{'shopId':_0x40f719,'gateway':{'not':_0x3c82ef(0x1dc)},'createdAt':{'gte':_0xdd3c9e}}}),database_1[_0x3c82ef(0x169)][_0x3c82ef(0x1f8)][_0x3c82ef(0x193)]({'where':{'shopId':_0x40f719,'gateway':{'not':_0x3c82ef(0x1dc)},'status':_0x3c82ef(0x1ba),'createdAt':{'gte':_0xdd3c9e}}}),database_1[_0x3c82ef(0x169)]['payment']['findMany']({'where':{'shopId':_0x40f719,'gateway':{'not':_0x3c82ef(0x1dc)},'status':'PAID','createdAt':{'gte':_0xdd3c9e}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3c82ef(0x169)]['payment']['findMany']({'where':{'shopId':_0x40f719,'gateway':{'not':_0x3c82ef(0x1dc)}},'take':0xa,'orderBy':{'createdAt':_0x3c82ef(0x1d7)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3c82ef(0x169)]['payment'][_0x3c82ef(0x1fa)]({'where':{'shopId':_0x40f719,'gateway':{'not':_0x3c82ef(0x1dc)},'createdAt':{'gte':_0xdd3c9e}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3c82ef(0x1ae)}})]);let _0x22f25f=0x0;for(const _0x4646ac of _0x25bc05){if(_0x4646ac[_0x3c82ef(0x15d)])_0x22f25f+=_0x4646ac[_0x3c82ef(0x15d)];else{const _0x3efbc9=await currencyService_1[_0x3c82ef(0x1b9)][_0x3c82ef(0x16b)](_0x4646ac[_0x3c82ef(0x18d)],_0x4646ac[_0x3c82ef(0x15c)]);_0x22f25f+=_0x3efbc9;}}const _0x5a3a32=this[_0x3c82ef(0x184)](_0x4c2fb7,_0xdd3c9e,_0x1d7eef),_0x2b8662=_0x88f63b>0x0?_0x21ad59/_0x88f63b*0x64:0x0;return{'totalPayments':_0x88f63b,'successfulPayments':_0x21ad59,'totalRevenue':Math[_0x3c82ef(0x19a)](_0x22f25f*0x64)/0x64,'conversionRate':Math['round'](_0x2b8662*0x64)/0x64,'dailyRevenue':_0x5a3a32['dailyRevenue'],'dailyPayments':_0x5a3a32['dailyPayments'],'recentPayments':_0x5e77af[_0x3c82ef(0x18c)](_0x39fabd=>({'id':_0x39fabd['id'],'gateway':_0x39fabd[_0x3c82ef(0x177)],'amount':_0x39fabd[_0x3c82ef(0x18d)],'currency':_0x39fabd['currency'],'status':_0x39fabd['status'],'createdAt':_0x39fabd['createdAt']}))};}[a56_0x3cab3d(0x184)](_0x2c8cdb,_0x46eace,_0x403ae5){const _0x41587f=a56_0x3cab3d,_0x320b1c=new Map(),_0x2c9bf4=new Date(_0x46eace);while(_0x2c9bf4<=_0x403ae5){const _0x1ecf15=_0x2c9bf4[_0x41587f(0x1db)]()['split']('T')[0x0];_0x320b1c[_0x41587f(0x1be)](_0x1ecf15,{'revenue':0x0,'count':0x0}),_0x2c9bf4[_0x41587f(0x17c)](_0x2c9bf4['getDate']()+0x1);}for(const _0x1e9177 of _0x2c8cdb){const _0x2b375a=_0x1e9177[_0x41587f(0x1f9)][_0x41587f(0x1db)]()[_0x41587f(0x189)]('T')[0x0],_0x2003cf=_0x320b1c[_0x41587f(0x190)](_0x2b375a);_0x2003cf&&(_0x2003cf[_0x41587f(0x193)]+=0x1,_0x1e9177[_0x41587f(0x195)]===_0x41587f(0x1ba)&&_0x1e9177['amountUSDT']&&(_0x2003cf[_0x41587f(0x191)]+=_0x1e9177[_0x41587f(0x15d)]));}const _0x3e239b=[],_0x313ba2=[];for(const [_0x3072d8,_0x36a5bf]of _0x320b1c){_0x3e239b['push']({'date':_0x3072d8,'amount':Math[_0x41587f(0x19a)](_0x36a5bf[_0x41587f(0x191)]*0x64)/0x64}),_0x313ba2[_0x41587f(0x18b)]({'date':_0x3072d8,'count':_0x36a5bf[_0x41587f(0x193)]});}return{'dailyRevenue':_0x3e239b,'dailyPayments':_0x313ba2};}}exports[a56_0x3cab3d(0x1d2)]=ShopService;