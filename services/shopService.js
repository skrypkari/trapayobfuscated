'use strict';function a54_0x116b(){const _0x19804d=['\x20USDT','paymentService','txid','statusText','map','test','PaymentService','webhookLog','USDT\x20BSC','toISOString','set','78wZYVCw','Webhook\x20returned\x20error:\x20','aggregate','1296136SPrRmR','erc20','currencyService','usdcPolygonWallet','getPayoutStatistics','delete','telegramId','getGatewayDisplayName','2390252rkyRcy','USDT\x20Polygon','test_payment_123','update','generateDailyStatistics','CoinToPay','isArray','retryCount','usdtTrcWallet','üåê\x20Method\x20filter:\x20','error','amount','üìÖ\x20Date\x20end:\x20','Rapyd','getShopPayoutStats','country','üìä\x20Status\x20filter:\x20','customerEmail','fullName','redirectUrl','setHours','language','üìÖ\x20Period\x20start:\x20','webhookUrl','createdAt','\x20USDT\x20(total\x20payouts)','getFullYear','push','../config/database','getPayments','dailyPayments','updatePayment','desc','Error\x20parsing\x20webhook\x20events:','__importDefault','totalPaidOut','No\x20webhook\x20URL\x20configured','message','üåê\x20Network\x20filter:\x20','parse','webhookEvents','üìÖ\x20Period\x20end:\x20','lte','\x20USDT\x20(current\x20balance)','name','test_order_123','customerName','filter','gateway','\x20payout\x20statistics\x20calculated:','getTime','Noda','1415869bTEzQv','currency','createPayment','username','getPayouts','periodFrom','ShopService','paymentId','wallets','shopId','./paymentService','Payment\x20not\x20found','findFirst','Plisio','30d','KLYME\x20EU','Shop\x20not\x20found','1176711aTUyWY','event','log','updateShopProfile','notes','balance','Test\x20webhook\x20sent\x20successfully\x20(','shop','settings','usdtPolygonWallet','updateWallets','get','KLYME\x20DE','formatNetworkName','usdtErcWallet','deletePayment','ceil','payout','sourceCurrency','amountIsEditable','status','COMPLETED','awaitingPayout','toUpperCase','USD','customer','getStatistics','setDate','getPaymentsByShop','paymentGateways','revenue','shopUrl','__esModule','5289464LZMyWu','expiresAt','getPayoutById','reduce','count','createPublicPayment','application/json','publicKey','gatewaySettings','usage','322566ScfFsT','default','stringify','payment','amountUSDT','gte','merchantUrl','paidAt','test_gateway','PAID','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','split','trc20','round','9ZVXJgQ','responseBody','all','304485ZJccai','PENDING','telegram','network','dailyRevenue','findUnique','getWebhookLogs','testWebhook','findMany','REJECTED','getShopProfile','90d','defineProperty'];a54_0x116b=function(){return _0x19804d;};return a54_0x116b();}function a54_0x1f89(_0x441f06,_0x3fc00a){const _0x116b7e=a54_0x116b();return a54_0x1f89=function(_0x1f89a0,_0x2b6e02){_0x1f89a0=_0x1f89a0-0x1b9;let _0x2b2a45=_0x116b7e[_0x1f89a0];return _0x2b2a45;},a54_0x1f89(_0x441f06,_0x3fc00a);}const a54_0x9e598a=a54_0x1f89;(function(_0xf18c6b,_0x2c157b){const _0x4acbdd=a54_0x1f89,_0x22b24a=_0xf18c6b();while(!![]){try{const _0x31f153=-parseInt(_0x4acbdd(0x1ea))/0x1+parseInt(_0x4acbdd(0x216))/0x2+-parseInt(_0x4acbdd(0x1bf))/0x3+parseInt(_0x4acbdd(0x21e))/0x4+parseInt(_0x4acbdd(0x1fb))/0x5*(parseInt(_0x4acbdd(0x213))/0x6)+-parseInt(_0x4acbdd(0x252))/0x7+-parseInt(_0x4acbdd(0x1e0))/0x8*(parseInt(_0x4acbdd(0x1f8))/0x9);if(_0x31f153===_0x2c157b)break;else _0x22b24a['push'](_0x22b24a['shift']());}catch(_0x19b855){_0x22b24a['push'](_0x22b24a['shift']());}}}(a54_0x116b,0x7011f));var __importDefault=this&&this[a54_0x9e598a(0x240)]||function(_0x418016){const _0x16677e=a54_0x9e598a;return _0x418016&&_0x418016[_0x16677e(0x1df)]?_0x418016:{'default':_0x418016};};Object[a54_0x9e598a(0x207)](exports,a54_0x9e598a(0x1df),{'value':!![]}),exports[a54_0x9e598a(0x258)]=void 0x0;const database_1=__importDefault(require(a54_0x9e598a(0x23a))),currencyService_1=require('./currencyService'),paymentService_1=require(a54_0x9e598a(0x25c));class ShopService{constructor(){const _0x42529f=a54_0x9e598a;this[_0x42529f(0x209)]=new paymentService_1[(_0x42529f(0x20e))]();}async[a54_0x9e598a(0x205)](_0x4cf39e){const _0x45b0a0=a54_0x9e598a,_0x2ce7df=await database_1[_0x45b0a0(0x1eb)]['shop'][_0x45b0a0(0x200)]({'where':{'id':_0x4cf39e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2ce7df)throw new Error(_0x45b0a0(0x1be));let _0x17b0dd=[];if(_0x2ce7df[_0x45b0a0(0x1c7)]?.[_0x45b0a0(0x246)])try{_0x17b0dd=Array[_0x45b0a0(0x224)](_0x2ce7df['settings'][_0x45b0a0(0x246)])?_0x2ce7df['settings']['webhookEvents']:JSON[_0x45b0a0(0x245)](_0x2ce7df[_0x45b0a0(0x1c7)][_0x45b0a0(0x246)]);}catch(_0x33070a){console[_0x45b0a0(0x228)](_0x45b0a0(0x23f),_0x33070a),_0x17b0dd=[];}return{'id':_0x2ce7df['id'],'fullName':_0x2ce7df[_0x45b0a0(0x24a)],'username':_0x2ce7df[_0x45b0a0(0x255)],'telegramId':_0x2ce7df[_0x45b0a0(0x1fd)],'merchantUrl':_0x2ce7df[_0x45b0a0(0x1de)],'gateways':_0x2ce7df[_0x45b0a0(0x1dc)]?JSON['parse'](_0x2ce7df[_0x45b0a0(0x1dc)]):null,'gatewaySettings':_0x2ce7df[_0x45b0a0(0x1e8)]?JSON['parse'](_0x2ce7df[_0x45b0a0(0x1e8)]):null,'publicKey':_0x2ce7df[_0x45b0a0(0x1e7)],'webhookUrl':_0x2ce7df['settings']?.[_0x45b0a0(0x235)]||null,'webhookEvents':_0x17b0dd,'wallets':{'usdtPolygonWallet':_0x2ce7df[_0x45b0a0(0x1c8)],'usdtTrcWallet':_0x2ce7df[_0x45b0a0(0x226)],'usdtErcWallet':_0x2ce7df[_0x45b0a0(0x1cd)],'usdcPolygonWallet':_0x2ce7df['usdcPolygonWallet']},'status':_0x2ce7df[_0x45b0a0(0x1d3)],'createdAt':_0x2ce7df[_0x45b0a0(0x236)]};}async[a54_0x9e598a(0x1c2)](_0x320e7d,_0x19eaad){const _0x278586=a54_0x9e598a,_0x47e02a={};_0x19eaad[_0x278586(0x230)]&&(_0x47e02a[_0x278586(0x24a)]=_0x19eaad[_0x278586(0x230)]);_0x19eaad[_0x278586(0x21c)]!==undefined&&(_0x47e02a[_0x278586(0x1fd)]=_0x19eaad[_0x278586(0x21c)]||null);_0x19eaad['merchantUrl']&&(_0x47e02a[_0x278586(0x1de)]=_0x19eaad[_0x278586(0x1f0)]);_0x19eaad['gateways']&&(_0x47e02a[_0x278586(0x1dc)]=JSON[_0x278586(0x1ec)](_0x19eaad['gateways']));_0x19eaad[_0x278586(0x1e8)]&&(_0x47e02a[_0x278586(0x1e8)]=JSON[_0x278586(0x1ec)](_0x19eaad['gatewaySettings']));_0x19eaad[_0x278586(0x25a)]&&(_0x19eaad[_0x278586(0x25a)][_0x278586(0x1c8)]!==undefined&&(_0x47e02a[_0x278586(0x1c8)]=_0x19eaad[_0x278586(0x25a)]['usdtPolygonWallet']||null),_0x19eaad[_0x278586(0x25a)]['usdtTrcWallet']!==undefined&&(_0x47e02a['usdtTrcWallet']=_0x19eaad['wallets'][_0x278586(0x226)]||null),_0x19eaad[_0x278586(0x25a)]['usdtErcWallet']!==undefined&&(_0x47e02a[_0x278586(0x1cd)]=_0x19eaad[_0x278586(0x25a)][_0x278586(0x1cd)]||null),_0x19eaad[_0x278586(0x25a)][_0x278586(0x219)]!==undefined&&(_0x47e02a[_0x278586(0x219)]=_0x19eaad['wallets'][_0x278586(0x219)]||null));const _0x14f147=await database_1[_0x278586(0x1eb)]['shop'][_0x278586(0x221)]({'where':{'id':_0x320e7d},'data':_0x47e02a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x48ed58=[];if(_0x14f147['settings']?.['webhookEvents'])try{_0x48ed58=Array['isArray'](_0x14f147[_0x278586(0x1c7)]['webhookEvents'])?_0x14f147[_0x278586(0x1c7)][_0x278586(0x246)]:JSON[_0x278586(0x245)](_0x14f147[_0x278586(0x1c7)][_0x278586(0x246)]);}catch(_0x11275e){console[_0x278586(0x228)](_0x278586(0x23f),_0x11275e),_0x48ed58=[];}return{'id':_0x14f147['id'],'fullName':_0x14f147[_0x278586(0x24a)],'username':_0x14f147[_0x278586(0x255)],'telegramId':_0x14f147[_0x278586(0x1fd)],'merchantUrl':_0x14f147[_0x278586(0x1de)],'gateways':_0x14f147['paymentGateways']?JSON[_0x278586(0x245)](_0x14f147[_0x278586(0x1dc)]):null,'gatewaySettings':_0x14f147[_0x278586(0x1e8)]?JSON['parse'](_0x14f147[_0x278586(0x1e8)]):null,'publicKey':_0x14f147['publicKey'],'webhookUrl':_0x14f147[_0x278586(0x1c7)]?.[_0x278586(0x235)]||null,'webhookEvents':_0x48ed58,'wallets':{'usdtPolygonWallet':_0x14f147[_0x278586(0x1c8)],'usdtTrcWallet':_0x14f147[_0x278586(0x226)],'usdtErcWallet':_0x14f147[_0x278586(0x1cd)],'usdcPolygonWallet':_0x14f147[_0x278586(0x219)]},'status':_0x14f147[_0x278586(0x1d3)],'createdAt':_0x14f147['createdAt']};}async[a54_0x9e598a(0x1c9)](_0x22de20,_0x2b5201){const _0x5b97a3=a54_0x9e598a,_0x479f75={};_0x2b5201[_0x5b97a3(0x1c8)]!==undefined&&(_0x479f75['usdtPolygonWallet']=_0x2b5201['usdtPolygonWallet']||null),_0x2b5201[_0x5b97a3(0x226)]!==undefined&&(_0x479f75['usdtTrcWallet']=_0x2b5201['usdtTrcWallet']||null),_0x2b5201[_0x5b97a3(0x1cd)]!==undefined&&(_0x479f75[_0x5b97a3(0x1cd)]=_0x2b5201[_0x5b97a3(0x1cd)]||null),_0x2b5201[_0x5b97a3(0x219)]!==undefined&&(_0x479f75['usdcPolygonWallet']=_0x2b5201[_0x5b97a3(0x219)]||null),await database_1[_0x5b97a3(0x1eb)][_0x5b97a3(0x1c6)]['update']({'where':{'id':_0x22de20},'data':_0x479f75});}async[a54_0x9e598a(0x202)](_0x4c15a5){const _0x2fc14e=a54_0x9e598a,_0x3d10df=await database_1['default'][_0x2fc14e(0x1c6)]['findUnique']({'where':{'id':_0x4c15a5},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3d10df?.[_0x2fc14e(0x1c7)]?.[_0x2fc14e(0x235)])throw new Error(_0x2fc14e(0x242));const _0x107f9a={'event':_0x2fc14e(0x20d),'payment':{'id':_0x2fc14e(0x220),'order_id':_0x2fc14e(0x24b),'gateway':_0x2fc14e(0x20d),'amount':0x64,'currency':_0x2fc14e(0x1d7),'status':'paid','created_at':new Date()[_0x2fc14e(0x211)]()}};try{const _0x43382c=await fetch(_0x3d10df['settings'][_0x2fc14e(0x235)],{'method':'POST','headers':{'Content-Type':_0x2fc14e(0x1e6),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON['stringify'](_0x107f9a)});return _0x43382c['ok']?{'success':!![],'message':_0x2fc14e(0x1c5)+_0x43382c[_0x2fc14e(0x1d3)]+')'}:{'success':![],'message':_0x2fc14e(0x214)+_0x43382c[_0x2fc14e(0x1d3)]+'\x20'+_0x43382c[_0x2fc14e(0x20b)]};}catch(_0x198670){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x198670 instanceof Error?_0x198670[_0x2fc14e(0x243)]:'Unknown\x20error')};}}async[a54_0x9e598a(0x254)](_0xc512b2){const _0x5c3365=a54_0x9e598a;return this[_0x5c3365(0x209)][_0x5c3365(0x1e5)]({'public_key':'','gateway':_0xc512b2[_0x5c3365(0x24e)],'order_id':undefined,'amount':_0xc512b2['amount'],'currency':_0xc512b2['currency'],'source_currency':_0xc512b2[_0x5c3365(0x1d1)],'usage':_0xc512b2[_0x5c3365(0x1e9)],'expires_at':_0xc512b2[_0x5c3365(0x1e1)]?.[_0x5c3365(0x211)](),'success_url':_0xc512b2['redirectUrl'],'fail_url':_0xc512b2[_0x5c3365(0x231)],'customer_email':_0xc512b2[_0x5c3365(0x22f)],'customer_name':_0xc512b2[_0x5c3365(0x24c)],'country':_0xc512b2[_0x5c3365(0x22d)],'language':_0xc512b2[_0x5c3365(0x233)],'amount_is_editable':_0xc512b2[_0x5c3365(0x1d2)],'max_payments':_0xc512b2['maxPayments'],'customer':_0xc512b2[_0x5c3365(0x1d8)]});}async[a54_0x9e598a(0x23b)](_0x9b6dcb,_0x2abcb4){const _0x3a18c1=a54_0x9e598a;return this['paymentService'][_0x3a18c1(0x1db)](_0x9b6dcb,_0x2abcb4);}async['getPaymentById'](_0x53a50e,_0x516206){const _0x18ecc0=a54_0x9e598a;return this[_0x18ecc0(0x209)]['getPaymentByShopAndId'](_0x53a50e,_0x516206);}async[a54_0x9e598a(0x23d)](_0x464528,_0x45e551,_0x31d049){const _0x557a0a=a54_0x9e598a,_0x4f84a8=await database_1[_0x557a0a(0x1eb)][_0x557a0a(0x1ed)][_0x557a0a(0x1ba)]({'where':{'id':_0x45e551,'shopId':_0x464528}});if(!_0x4f84a8)throw new Error(_0x557a0a(0x1b9));const _0x191dd2=await database_1['default'][_0x557a0a(0x1ed)][_0x557a0a(0x221)]({'where':{'id':_0x45e551},'data':{..._0x31d049,'updatedAt':new Date()}});return _0x191dd2;}async[a54_0x9e598a(0x1ce)](_0x3636c0,_0x139ea4){const _0x3fc9f2=a54_0x9e598a,_0x88039a=await database_1['default']['payment'][_0x3fc9f2(0x1ba)]({'where':{'id':_0x139ea4,'shopId':_0x3636c0}});if(!_0x88039a)throw new Error('Payment\x20not\x20found');await database_1[_0x3fc9f2(0x1eb)][_0x3fc9f2(0x1ed)][_0x3fc9f2(0x21b)]({'where':{'id':_0x139ea4}});}['formatNetworkName'](_0x16239b){const _0x1bd0fe=a54_0x9e598a,_0x22a3e0={'polygon':_0x1bd0fe(0x21f),'trc20':'USDT\x20TRC20','erc20':'USDT\x20ERC20','bsc':_0x1bd0fe(0x210),'polygon_usdc':'USDC\x20Polygon'};return _0x22a3e0[_0x16239b]||_0x16239b;}async[a54_0x9e598a(0x256)](_0x37e857,_0x4a02e3){const _0x3f962e=a54_0x9e598a,{page:_0x5aa95f,limit:_0x2344bc,status:_0x42bc6b,method:_0x253f93,network:_0x133905,dateFrom:_0x304332,dateTo:_0x329a3e,periodFrom:_0x3d8697,periodTo:_0x43312d}=_0x4a02e3,_0x234149=(_0x5aa95f-0x1)*_0x2344bc;console['log']('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x4a02e3);const _0x327495={'shopId':_0x37e857};_0x42bc6b&&(_0x327495[_0x3f962e(0x1d3)]=_0x42bc6b[_0x3f962e(0x1d6)](),console['log'](_0x3f962e(0x22e)+_0x42bc6b[_0x3f962e(0x1d6)]()));if(_0x253f93)_0x327495[_0x3f962e(0x1fe)]=_0x253f93,console[_0x3f962e(0x1c1)](_0x3f962e(0x227)+_0x253f93);else _0x133905&&(_0x327495['network']=_0x133905,console[_0x3f962e(0x1c1)](_0x3f962e(0x244)+_0x133905));if(_0x304332||_0x329a3e||_0x3d8697||_0x43312d){_0x327495[_0x3f962e(0x236)]={};if(_0x3d8697){const _0x4c24c2=new Date(_0x3d8697);_0x4c24c2[_0x3f962e(0x232)](0x0,0x0,0x0,0x0),_0x327495['createdAt'][_0x3f962e(0x1ef)]=_0x4c24c2,console[_0x3f962e(0x1c1)](_0x3f962e(0x234)+_0x4c24c2[_0x3f962e(0x211)]());}else{if(_0x304332){const _0x3a4f1a=new Date(_0x304332);_0x3a4f1a[_0x3f962e(0x232)](0x0,0x0,0x0,0x0),_0x327495[_0x3f962e(0x236)][_0x3f962e(0x1ef)]=_0x3a4f1a,console[_0x3f962e(0x1c1)]('üìÖ\x20Date\x20start:\x20'+_0x3a4f1a['toISOString']());}}if(_0x43312d){const _0x4cc8b6=new Date(_0x43312d);_0x4cc8b6[_0x3f962e(0x232)](0x17,0x3b,0x3b,0x3e7),_0x327495[_0x3f962e(0x236)]['lte']=_0x4cc8b6,console[_0x3f962e(0x1c1)](_0x3f962e(0x247)+_0x4cc8b6['toISOString']());}else{if(_0x329a3e){const _0x1673ae=new Date(_0x329a3e);_0x1673ae[_0x3f962e(0x232)](0x17,0x3b,0x3b,0x3e7),_0x327495[_0x3f962e(0x236)][_0x3f962e(0x248)]=_0x1673ae,console[_0x3f962e(0x1c1)](_0x3f962e(0x22a)+_0x1673ae[_0x3f962e(0x211)]());}}}console[_0x3f962e(0x1c1)]('üìä\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x327495,null,0x2));const [_0x18d54a,_0x746729]=await Promise['all']([database_1[_0x3f962e(0x1eb)][_0x3f962e(0x1d0)][_0x3f962e(0x203)]({'where':_0x327495,'skip':_0x234149,'take':_0x2344bc,'orderBy':{'createdAt':_0x3f962e(0x23e)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x3f962e(0x1eb)][_0x3f962e(0x1d0)][_0x3f962e(0x1e4)]({'where':_0x327495})]);return{'payouts':_0x18d54a['map'](_0x23e80b=>{const _0x31814c=_0x3f962e;let _0x446937=null;switch(_0x23e80b[_0x31814c(0x1fe)]){case'polygon':_0x446937=_0x23e80b[_0x31814c(0x1c6)]['usdtPolygonWallet'];break;case _0x31814c(0x1f6):_0x446937=_0x23e80b[_0x31814c(0x1c6)][_0x31814c(0x226)];break;case _0x31814c(0x217):_0x446937=_0x23e80b[_0x31814c(0x1c6)][_0x31814c(0x1cd)];break;case'polygon_usdc':_0x446937=_0x23e80b[_0x31814c(0x1c6)]['usdcPolygonWallet'];break;}return{'id':_0x23e80b['id'],'amount':_0x23e80b['amount'],'network':this[_0x31814c(0x1cc)](_0x23e80b['network']),'wallet':_0x446937,'status':_0x23e80b[_0x31814c(0x1d3)],'txid':_0x23e80b['txid'],'notes':_0x23e80b[_0x31814c(0x1c3)],'periodFrom':_0x23e80b[_0x31814c(0x257)],'periodTo':_0x23e80b['periodTo'],'createdAt':_0x23e80b['createdAt'],'paidAt':_0x23e80b['paidAt']};}),'pagination':{'page':_0x5aa95f,'limit':_0x2344bc,'total':_0x746729,'totalPages':Math['ceil'](_0x746729/_0x2344bc)}};}async[a54_0x9e598a(0x1e2)](_0x49c29b,_0x400723){const _0x3a9b72=a54_0x9e598a,_0x28847d=await database_1[_0x3a9b72(0x1eb)][_0x3a9b72(0x1d0)]['findFirst']({'where':{'id':_0x400723,'shopId':_0x49c29b}});if(!_0x28847d)return null;return{'id':_0x28847d['id'],'amount':_0x28847d[_0x3a9b72(0x229)],'network':_0x28847d[_0x3a9b72(0x1fe)],'status':_0x28847d[_0x3a9b72(0x1d3)],'txid':_0x28847d[_0x3a9b72(0x20a)],'notes':_0x28847d[_0x3a9b72(0x1c3)],'createdAt':_0x28847d['createdAt'],'paidAt':_0x28847d[_0x3a9b72(0x1f1)]};}async[a54_0x9e598a(0x21a)](_0x2ea316,_0xf2361f){const _0x386105=a54_0x9e598a,_0x586069=new Date();let _0x2941b9;switch(_0xf2361f){case'7d':_0x2941b9=new Date(_0x586069['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2941b9=new Date(_0x586069[_0x386105(0x250)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x386105(0x206):_0x2941b9=new Date(_0x586069[_0x386105(0x250)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2941b9=new Date(_0x586069['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x507fba,_0x3e9316,_0x5a677e,_0x20b247,_0x4fe87d,_0x129286]=await Promise[_0x386105(0x1fa)]([database_1['default']['payout'][_0x386105(0x1e4)]({'where':{'shopId':_0x2ea316,'createdAt':{'gte':_0x2941b9}}}),database_1[_0x386105(0x1eb)]['payout'][_0x386105(0x1e4)]({'where':{'shopId':_0x2ea316,'status':'COMPLETED','createdAt':{'gte':_0x2941b9}}}),database_1['default'][_0x386105(0x1d0)][_0x386105(0x1e4)]({'where':{'shopId':_0x2ea316,'status':_0x386105(0x1fc),'createdAt':{'gte':_0x2941b9}}}),database_1[_0x386105(0x1eb)][_0x386105(0x1d0)][_0x386105(0x1e4)]({'where':{'shopId':_0x2ea316,'status':_0x386105(0x204),'createdAt':{'gte':_0x2941b9}}}),database_1[_0x386105(0x1eb)][_0x386105(0x1d0)][_0x386105(0x203)]({'where':{'shopId':_0x2ea316,'createdAt':{'gte':_0x2941b9}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x386105(0x1d0)][_0x386105(0x203)]({'where':{'shopId':_0x2ea316},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x203113=_0x4fe87d[_0x386105(0x1e3)]((_0x2094e3,_0x4948eb)=>_0x2094e3+_0x4948eb['amount'],0x0),_0x281299=_0x4fe87d[_0x386105(0x24d)](_0x287022=>_0x287022['status']===_0x386105(0x1d4))[_0x386105(0x1e3)]((_0x66354d,_0x2eb510)=>_0x66354d+_0x2eb510[_0x386105(0x229)],0x0),_0x3cb500=_0x4fe87d['filter'](_0x1996d8=>_0x1996d8[_0x386105(0x1d3)]===_0x386105(0x1fc))[_0x386105(0x1e3)]((_0x4cd2f6,_0x171372)=>_0x4cd2f6+_0x171372['amount'],0x0),_0x55230e=_0x4fe87d[_0x386105(0x1e3)]((_0x24ad5a,_0x493c3c)=>{const _0x2f034e=_0x386105;return _0x24ad5a[_0x493c3c[_0x2f034e(0x1fe)]]=(_0x24ad5a[_0x493c3c[_0x2f034e(0x1fe)]]||0x0)+0x1,_0x24ad5a;},{}),_0x902887=_0x4fe87d['reduce']((_0x452c95,_0x424d39)=>{const _0x5e85a3=_0x386105;return _0x452c95[_0x424d39['status']]=(_0x452c95[_0x424d39[_0x5e85a3(0x1d3)]]||0x0)+0x1,_0x452c95;},{});return{'totalPayouts':_0x507fba,'completedPayouts':_0x3e9316,'pendingPayouts':_0x5a677e,'rejectedPayouts':_0x20b247,'totalAmount':_0x203113,'completedAmount':_0x281299,'pendingAmount':_0x3cb500,'payoutsByMethod':_0x55230e,'payoutsByStatus':_0x902887,'recentPayouts':_0x129286[_0x386105(0x20c)](_0x1fedf8=>({'id':_0x1fedf8['id'],'shopId':_0x2ea316,'amount':_0x1fedf8['amount'],'method':_0x1fedf8[_0x386105(0x1fe)],'status':_0x1fedf8[_0x386105(0x1d3)],'txid':_0x1fedf8[_0x386105(0x20a)],'createdAt':_0x1fedf8[_0x386105(0x236)],'paidAt':_0x1fedf8[_0x386105(0x1f1)]}))};}async[a54_0x9e598a(0x22c)](_0x2e80b9){const _0xa608d7=a54_0x9e598a;console['log']('üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x2e80b9+'...');const _0x285f4b=await database_1[_0xa608d7(0x1eb)]['shop'][_0xa608d7(0x200)]({'where':{'id':_0x2e80b9},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x285f4b)throw new Error('Shop\x20not\x20found');const _0x369b81=new Date(),_0x3f40a1=new Date(_0x369b81[_0xa608d7(0x238)](),_0x369b81['getMonth'](),0x1),_0x18729d=new Date(_0x369b81['getFullYear'](),_0x369b81['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5688b4=await database_1[_0xa608d7(0x1eb)][_0xa608d7(0x1d0)][_0xa608d7(0x215)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2e80b9,'createdAt':{'gte':_0x3f40a1,'lte':_0x18729d},'status':_0xa608d7(0x1d4)}}),_0x510c23=_0x5688b4['_sum'][_0xa608d7(0x229)]||0x0,_0x9295af={'availableBalance':Math[_0xa608d7(0x1f7)](_0x285f4b[_0xa608d7(0x1c4)]*0x64)/0x64,'totalPaidOut':Math[_0xa608d7(0x1f7)](_0x285f4b[_0xa608d7(0x241)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x285f4b[_0xa608d7(0x1c4)]*0x64)/0x64,'thisMonth':Math['round'](_0x510c23*0x64)/0x64};return console[_0xa608d7(0x1c1)]('üìä\x20Shop\x20'+_0x285f4b[_0xa608d7(0x255)]+_0xa608d7(0x24f)),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x9295af['availableBalance']+_0xa608d7(0x249)),console[_0xa608d7(0x1c1)](_0xa608d7(0x1f4)+_0x9295af[_0xa608d7(0x241)]+_0xa608d7(0x237)),console[_0xa608d7(0x1c1)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x9295af[_0xa608d7(0x1d5)]+_0xa608d7(0x249)),console[_0xa608d7(0x1c1)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x9295af['thisMonth']+_0xa608d7(0x208)),_0x9295af;}[a54_0x9e598a(0x21d)](_0x228ce5){const _0x3508b2=a54_0x9e598a,_0x479c9e={'test_gateway':'Test\x20Gateway','plisio':_0x3508b2(0x1bb),'rapyd':_0x3508b2(0x22b),'noda':_0x3508b2(0x251),'cointopay':_0x3508b2(0x223),'klyme_eu':_0x3508b2(0x1bd),'klyme_gb':'KLYME\x20GB','klyme_de':_0x3508b2(0x1cb)};return _0x479c9e[_0x228ce5]||_0x228ce5;}async['getPayoutStats'](_0x4976dd){const _0x5cdb35=a54_0x9e598a;return this[_0x5cdb35(0x22c)](_0x4976dd);}async[a54_0x9e598a(0x201)](_0x24048b,_0x383e4a){const _0x136580=a54_0x9e598a,{page:_0x3e0c98,limit:_0x34efc4,paymentId:_0x4dd87f}=_0x383e4a,_0x1cb4be=(_0x3e0c98-0x1)*_0x34efc4,_0x7df8b9={'shopId':_0x24048b};_0x4dd87f&&(_0x7df8b9[_0x136580(0x259)]=_0x4dd87f);const [_0x528720,_0x50afe2]=await Promise['all']([database_1[_0x136580(0x1eb)][_0x136580(0x20f)][_0x136580(0x203)]({'where':_0x7df8b9,'skip':_0x1cb4be,'take':_0x34efc4,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x136580(0x1eb)][_0x136580(0x20f)][_0x136580(0x1e4)]({'where':_0x7df8b9})]);return{'logs':_0x528720[_0x136580(0x20c)](_0x9ae266=>({'id':_0x9ae266['id'],'paymentId':_0x9ae266[_0x136580(0x259)],'shopId':_0x9ae266[_0x136580(0x25b)],'event':_0x9ae266[_0x136580(0x1c0)],'statusCode':_0x9ae266['statusCode'],'retryCount':_0x9ae266[_0x136580(0x225)],'responseBody':_0x9ae266[_0x136580(0x1f9)],'createdAt':_0x9ae266['createdAt'],'payment':_0x9ae266['payment']})),'pagination':{'page':_0x3e0c98,'limit':_0x34efc4,'total':_0x50afe2,'totalPages':Math[_0x136580(0x1cf)](_0x50afe2/_0x34efc4)}};}async[a54_0x9e598a(0x1d9)](_0x4b682b,_0x42cbae){const _0x4cff06=a54_0x9e598a,_0x44779c=new Date();let _0xd107fe;switch(_0x42cbae){case'7d':_0xd107fe=new Date(_0x44779c[_0x4cff06(0x250)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4cff06(0x1bc):_0xd107fe=new Date(_0x44779c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4cff06(0x206):_0xd107fe=new Date(_0x44779c[_0x4cff06(0x250)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xd107fe=new Date(_0x44779c[_0x4cff06(0x250)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2e5d07,_0x57f9c9,_0x3631c4,_0x9498b8,_0x13c545]=await Promise[_0x4cff06(0x1fa)]([database_1[_0x4cff06(0x1eb)][_0x4cff06(0x1ed)]['count']({'where':{'shopId':_0x4b682b,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0xd107fe}}}),database_1[_0x4cff06(0x1eb)][_0x4cff06(0x1ed)][_0x4cff06(0x1e4)]({'where':{'shopId':_0x4b682b,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0xd107fe}}}),database_1[_0x4cff06(0x1eb)][_0x4cff06(0x1ed)][_0x4cff06(0x203)]({'where':{'shopId':_0x4b682b,'gateway':{'not':_0x4cff06(0x1f2)},'status':_0x4cff06(0x1f3),'createdAt':{'gte':_0xd107fe}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x4cff06(0x1ed)][_0x4cff06(0x203)]({'where':{'shopId':_0x4b682b,'gateway':{'not':_0x4cff06(0x1f2)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4cff06(0x1eb)]['payment'][_0x4cff06(0x203)]({'where':{'shopId':_0x4b682b,'gateway':{'not':_0x4cff06(0x1f2)},'createdAt':{'gte':_0xd107fe}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x562607=0x0;for(const _0x2404a5 of _0x3631c4){if(_0x2404a5[_0x4cff06(0x1ee)])_0x562607+=_0x2404a5[_0x4cff06(0x1ee)];else{const _0x3e13b5=await currencyService_1[_0x4cff06(0x218)]['convertToUSDT'](_0x2404a5[_0x4cff06(0x229)],_0x2404a5[_0x4cff06(0x253)]);_0x562607+=_0x3e13b5;}}const _0xc61f03=this[_0x4cff06(0x222)](_0x13c545,_0xd107fe,_0x44779c),_0x3f3fb0=_0x2e5d07>0x0?_0x57f9c9/_0x2e5d07*0x64:0x0;return{'totalPayments':_0x2e5d07,'successfulPayments':_0x57f9c9,'totalRevenue':Math[_0x4cff06(0x1f7)](_0x562607*0x64)/0x64,'conversionRate':Math[_0x4cff06(0x1f7)](_0x3f3fb0*0x64)/0x64,'dailyRevenue':_0xc61f03[_0x4cff06(0x1ff)],'dailyPayments':_0xc61f03[_0x4cff06(0x23c)],'recentPayments':_0x9498b8[_0x4cff06(0x20c)](_0x15026b=>({'id':_0x15026b['id'],'gateway':_0x15026b[_0x4cff06(0x24e)],'amount':_0x15026b[_0x4cff06(0x229)],'currency':_0x15026b[_0x4cff06(0x253)],'status':_0x15026b[_0x4cff06(0x1d3)],'createdAt':_0x15026b[_0x4cff06(0x236)]}))};}['generateDailyStatistics'](_0x270ec3,_0x466ad6,_0x49f2aa){const _0x18f25f=a54_0x9e598a,_0x1d367f=new Map(),_0x461a68=new Date(_0x466ad6);while(_0x461a68<=_0x49f2aa){const _0x32493f=_0x461a68[_0x18f25f(0x211)]()[_0x18f25f(0x1f5)]('T')[0x0];_0x1d367f[_0x18f25f(0x212)](_0x32493f,{'revenue':0x0,'count':0x0}),_0x461a68[_0x18f25f(0x1da)](_0x461a68['getDate']()+0x1);}for(const _0x23b91 of _0x270ec3){const _0x15d7f8=_0x23b91[_0x18f25f(0x236)][_0x18f25f(0x211)]()[_0x18f25f(0x1f5)]('T')[0x0],_0x3e2c50=_0x1d367f[_0x18f25f(0x1ca)](_0x15d7f8);_0x3e2c50&&(_0x3e2c50[_0x18f25f(0x1e4)]+=0x1,_0x23b91[_0x18f25f(0x1d3)]===_0x18f25f(0x1f3)&&_0x23b91[_0x18f25f(0x1ee)]&&(_0x3e2c50[_0x18f25f(0x1dd)]+=_0x23b91[_0x18f25f(0x1ee)]));}const _0x556b14=[],_0x77d12a=[];for(const [_0x1aa179,_0x115af1]of _0x1d367f){_0x556b14[_0x18f25f(0x239)]({'date':_0x1aa179,'amount':Math[_0x18f25f(0x1f7)](_0x115af1[_0x18f25f(0x1dd)]*0x64)/0x64}),_0x77d12a['push']({'date':_0x1aa179,'count':_0x115af1[_0x18f25f(0x1e4)]});}return{'dailyRevenue':_0x556b14,'dailyPayments':_0x77d12a};}}exports[a54_0x9e598a(0x258)]=ShopService;