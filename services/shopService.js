'use strict';const a52_0x2a0206=a52_0x24f7;function a52_0x24f7(_0x12e6f6,_0x5a1078){const _0x3192b0=a52_0x3192();return a52_0x24f7=function(_0x24f753,_0x59b2b3){_0x24f753=_0x24f753-0x155;let _0x50ca00=_0x3192b0[_0x24f753];return _0x50ca00;},a52_0x24f7(_0x12e6f6,_0x5a1078);}(function(_0x3a3e23,_0x53004b){const _0x1cb7a=a52_0x24f7,_0x57a659=_0x3a3e23();while(!![]){try{const _0x8d8297=-parseInt(_0x1cb7a(0x183))/0x1+parseInt(_0x1cb7a(0x1ad))/0x2+parseInt(_0x1cb7a(0x16b))/0x3*(-parseInt(_0x1cb7a(0x1e1))/0x4)+-parseInt(_0x1cb7a(0x156))/0x5+parseInt(_0x1cb7a(0x198))/0x6*(parseInt(_0x1cb7a(0x1b0))/0x7)+parseInt(_0x1cb7a(0x1a1))/0x8*(-parseInt(_0x1cb7a(0x1da))/0x9)+parseInt(_0x1cb7a(0x169))/0xa;if(_0x8d8297===_0x53004b)break;else _0x57a659['push'](_0x57a659['shift']());}catch(_0x2552fb){_0x57a659['push'](_0x57a659['shift']());}}}(a52_0x3192,0x515b3));var __importDefault=this&&this[a52_0x2a0206(0x1d9)]||function(_0x320097){return _0x320097&&_0x320097['__esModule']?_0x320097:{'default':_0x320097};};Object[a52_0x2a0206(0x182)](exports,'__esModule',{'value':!![]}),exports[a52_0x2a0206(0x17f)]=void 0x0;const database_1=__importDefault(require(a52_0x2a0206(0x1b3))),currencyService_1=require('./currencyService'),paymentService_1=require(a52_0x2a0206(0x19d));function a52_0x3192(){const _0x116257=['paymentId','10113870ByYpDA','REJECTED','3zTQElE','\x20USDT','createPublicPayment','amount','map','test','getShopPayoutStats','event','findUnique','paymentGateways','_sum','telegram','COMPLETED','shopUrl','payout','No\x20webhook\x20URL\x20configured','wallets','set','error','Test\x20Gateway','ShopService','dailyRevenue','totalPaidOut','defineProperty','137409XwhYtY','currencyService','publicKey','txid','desc','sourceCurrency','ceil','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','webhookEvents','findMany','setDate','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','test_payment_123','getPayoutById','findFirst','POST','isArray','\x20USDT\x20(total\x20payouts)','\x20payout\x20statistics\x20calculated:','status','usdtTrcWallet','18rmoxUv','retryCount','getPayoutStatistics','getPayoutStats','gatewaySettings','./paymentService','Payment\x20not\x20found','name','test_gateway','8WxUhdh','round','merchantUrl','default','getShopProfile','network','getPaymentsByShop','count','get','revenue','usdtErcWallet','paid','701780KCADJa','PENDING','expiresAt','42532Mccvns','country','username','../config/database','\x20USDT\x20(current\x20balance)','language','getFullYear','usdtPolygonWallet','webhookUrl','stringify','parse','getStatistics','fullName','customer','KLYME\x20DE','amountIsEditable','update','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','statusCode','generateDailyStatistics','Plisio','Rapyd','createPayment','log','thisMonth','paidAt','updatePayment','Failed\x20to\x20send\x20webhook:\x20','testWebhook','delete','shopId','KLYME\x20GB','Webhook\x20returned\x20error:\x20','createdAt','Unknown\x20error','settings','redirectUrl','shop','getPayouts','PAID','split','__importDefault','1164105MIKMcR','updateShopProfile','deletePayment','...','filter','gte','updateWallets','1676580Duargn','TesSoft\x20Payment\x20System/1.0\x20(Test)','90d','paymentService','amountUSDT','all','currency','asc','toUpperCase','Shop\x20not\x20found','Noda','Error\x20parsing\x20webhook\x20events:','getTime','webhookLog','payment','üìä\x20Shop\x20','message','usdcPolygonWallet','1806855IDVuPq','statusText','application/json','maxPayments','aggregate','gateways','push','CoinToPay','telegramId','gateway','balance','availableBalance','notes','getMonth','toISOString','reduce','\x20\x20\x20üìÖ\x20This\x20month:\x20','usage'];a52_0x3192=function(){return _0x116257;};return a52_0x3192();}class ShopService{constructor(){this['paymentService']=new paymentService_1['PaymentService']();}async[a52_0x2a0206(0x1a5)](_0xaf6f7b){const _0x4a5544=a52_0x2a0206,_0x5eb032=await database_1[_0x4a5544(0x1a4)][_0x4a5544(0x1d5)][_0x4a5544(0x173)]({'where':{'id':_0xaf6f7b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x5eb032)throw new Error(_0x4a5544(0x1ea));let _0x5aa6e2=[];if(_0x5eb032[_0x4a5544(0x1d3)]?.[_0x4a5544(0x18b)])try{_0x5aa6e2=Array[_0x4a5544(0x193)](_0x5eb032[_0x4a5544(0x1d3)][_0x4a5544(0x18b)])?_0x5eb032[_0x4a5544(0x1d3)][_0x4a5544(0x18b)]:JSON[_0x4a5544(0x1ba)](_0x5eb032['settings']['webhookEvents']);}catch(_0x466ee7){console[_0x4a5544(0x17d)](_0x4a5544(0x1ec),_0x466ee7),_0x5aa6e2=[];}return{'id':_0x5eb032['id'],'fullName':_0x5eb032[_0x4a5544(0x19f)],'username':_0x5eb032[_0x4a5544(0x1b2)],'telegramId':_0x5eb032[_0x4a5544(0x176)],'merchantUrl':_0x5eb032[_0x4a5544(0x178)],'gateways':_0x5eb032['paymentGateways']?JSON['parse'](_0x5eb032[_0x4a5544(0x174)]):null,'gatewaySettings':_0x5eb032['gatewaySettings']?JSON[_0x4a5544(0x1ba)](_0x5eb032[_0x4a5544(0x19c)]):null,'publicKey':_0x5eb032['publicKey'],'webhookUrl':_0x5eb032[_0x4a5544(0x1d3)]?.[_0x4a5544(0x1b8)]||null,'webhookEvents':_0x5aa6e2,'wallets':{'usdtPolygonWallet':_0x5eb032[_0x4a5544(0x1b7)],'usdtTrcWallet':_0x5eb032[_0x4a5544(0x197)],'usdtErcWallet':_0x5eb032[_0x4a5544(0x1ab)],'usdcPolygonWallet':_0x5eb032['usdcPolygonWallet']},'status':_0x5eb032[_0x4a5544(0x196)],'createdAt':_0x5eb032[_0x4a5544(0x1d1)]};}async[a52_0x2a0206(0x1db)](_0x31f868,_0x27fc24){const _0x5c091f=a52_0x2a0206,_0x3bd3b7={};_0x27fc24[_0x5c091f(0x1bc)]&&(_0x3bd3b7['name']=_0x27fc24['fullName']);_0x27fc24['telegramId']!==undefined&&(_0x3bd3b7[_0x5c091f(0x176)]=_0x27fc24[_0x5c091f(0x15e)]||null);_0x27fc24['merchantUrl']&&(_0x3bd3b7[_0x5c091f(0x178)]=_0x27fc24[_0x5c091f(0x1a3)]);_0x27fc24[_0x5c091f(0x15b)]&&(_0x3bd3b7[_0x5c091f(0x174)]=JSON[_0x5c091f(0x1b9)](_0x27fc24['gateways']));_0x27fc24[_0x5c091f(0x19c)]&&(_0x3bd3b7['gatewaySettings']=JSON[_0x5c091f(0x1b9)](_0x27fc24[_0x5c091f(0x19c)]));_0x27fc24[_0x5c091f(0x17b)]&&(_0x27fc24[_0x5c091f(0x17b)]['usdtPolygonWallet']!==undefined&&(_0x3bd3b7[_0x5c091f(0x1b7)]=_0x27fc24[_0x5c091f(0x17b)]['usdtPolygonWallet']||null),_0x27fc24[_0x5c091f(0x17b)]['usdtTrcWallet']!==undefined&&(_0x3bd3b7[_0x5c091f(0x197)]=_0x27fc24['wallets'][_0x5c091f(0x197)]||null),_0x27fc24['wallets'][_0x5c091f(0x1ab)]!==undefined&&(_0x3bd3b7[_0x5c091f(0x1ab)]=_0x27fc24[_0x5c091f(0x17b)][_0x5c091f(0x1ab)]||null),_0x27fc24[_0x5c091f(0x17b)]['usdcPolygonWallet']!==undefined&&(_0x3bd3b7[_0x5c091f(0x155)]=_0x27fc24[_0x5c091f(0x17b)][_0x5c091f(0x155)]||null));const _0x39feee=await database_1[_0x5c091f(0x1a4)]['shop'][_0x5c091f(0x1c0)]({'where':{'id':_0x31f868},'data':_0x3bd3b7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x498de1=[];if(_0x39feee[_0x5c091f(0x1d3)]?.[_0x5c091f(0x18b)])try{_0x498de1=Array['isArray'](_0x39feee[_0x5c091f(0x1d3)]['webhookEvents'])?_0x39feee[_0x5c091f(0x1d3)][_0x5c091f(0x18b)]:JSON[_0x5c091f(0x1ba)](_0x39feee[_0x5c091f(0x1d3)][_0x5c091f(0x18b)]);}catch(_0x35c306){console['error'](_0x5c091f(0x1ec),_0x35c306),_0x498de1=[];}return{'id':_0x39feee['id'],'fullName':_0x39feee[_0x5c091f(0x19f)],'username':_0x39feee['username'],'telegramId':_0x39feee[_0x5c091f(0x176)],'merchantUrl':_0x39feee[_0x5c091f(0x178)],'gateways':_0x39feee[_0x5c091f(0x174)]?JSON['parse'](_0x39feee['paymentGateways']):null,'gatewaySettings':_0x39feee[_0x5c091f(0x19c)]?JSON[_0x5c091f(0x1ba)](_0x39feee[_0x5c091f(0x19c)]):null,'publicKey':_0x39feee[_0x5c091f(0x185)],'webhookUrl':_0x39feee[_0x5c091f(0x1d3)]?.[_0x5c091f(0x1b8)]||null,'webhookEvents':_0x498de1,'wallets':{'usdtPolygonWallet':_0x39feee[_0x5c091f(0x1b7)],'usdtTrcWallet':_0x39feee['usdtTrcWallet'],'usdtErcWallet':_0x39feee[_0x5c091f(0x1ab)],'usdcPolygonWallet':_0x39feee[_0x5c091f(0x155)]},'status':_0x39feee[_0x5c091f(0x196)],'createdAt':_0x39feee[_0x5c091f(0x1d1)]};}async[a52_0x2a0206(0x1e0)](_0x5d535e,_0x10e33c){const _0x258c28=a52_0x2a0206,_0x2f8647={};_0x10e33c[_0x258c28(0x1b7)]!==undefined&&(_0x2f8647[_0x258c28(0x1b7)]=_0x10e33c[_0x258c28(0x1b7)]||null),_0x10e33c['usdtTrcWallet']!==undefined&&(_0x2f8647[_0x258c28(0x197)]=_0x10e33c[_0x258c28(0x197)]||null),_0x10e33c[_0x258c28(0x1ab)]!==undefined&&(_0x2f8647[_0x258c28(0x1ab)]=_0x10e33c['usdtErcWallet']||null),_0x10e33c[_0x258c28(0x155)]!==undefined&&(_0x2f8647[_0x258c28(0x155)]=_0x10e33c[_0x258c28(0x155)]||null),await database_1['default']['shop'][_0x258c28(0x1c0)]({'where':{'id':_0x5d535e},'data':_0x2f8647});}async[a52_0x2a0206(0x1cc)](_0x49b239){const _0x3c6483=a52_0x2a0206,_0xc44159=await database_1[_0x3c6483(0x1a4)][_0x3c6483(0x1d5)][_0x3c6483(0x173)]({'where':{'id':_0x49b239},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0xc44159?.['settings']?.[_0x3c6483(0x1b8)])throw new Error(_0x3c6483(0x17a));const _0x120d3a={'event':_0x3c6483(0x170),'payment':{'id':_0x3c6483(0x18f),'order_id':'test_order_123','gateway':_0x3c6483(0x170),'amount':0x64,'currency':'USD','status':_0x3c6483(0x1ac),'created_at':new Date()['toISOString']()}};try{const _0x36b1e2=await fetch(_0xc44159[_0x3c6483(0x1d3)]['webhookUrl'],{'method':_0x3c6483(0x192),'headers':{'Content-Type':_0x3c6483(0x158),'User-Agent':_0x3c6483(0x1e2)},'body':JSON[_0x3c6483(0x1b9)](_0x120d3a)});return _0x36b1e2['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x36b1e2[_0x3c6483(0x196)]+')'}:{'success':![],'message':_0x3c6483(0x1d0)+_0x36b1e2['status']+'\x20'+_0x36b1e2[_0x3c6483(0x157)]};}catch(_0x1c4a07){return{'success':![],'message':_0x3c6483(0x1cb)+(_0x1c4a07 instanceof Error?_0x1c4a07[_0x3c6483(0x1f1)]:_0x3c6483(0x1d2))};}}async[a52_0x2a0206(0x1c6)](_0x2c5b38){const _0x1d2ba1=a52_0x2a0206;return this[_0x1d2ba1(0x1e4)][_0x1d2ba1(0x16d)]({'public_key':'','gateway':_0x2c5b38['gateway'],'order_id':undefined,'amount':_0x2c5b38['amount'],'currency':_0x2c5b38[_0x1d2ba1(0x1e7)],'source_currency':_0x2c5b38[_0x1d2ba1(0x188)],'usage':_0x2c5b38[_0x1d2ba1(0x167)],'expires_at':_0x2c5b38[_0x1d2ba1(0x1af)]?.[_0x1d2ba1(0x164)](),'success_url':_0x2c5b38[_0x1d2ba1(0x1d4)],'fail_url':_0x2c5b38['redirectUrl'],'customer_email':_0x2c5b38['customerEmail'],'customer_name':_0x2c5b38['customerName'],'country':_0x2c5b38[_0x1d2ba1(0x1b1)],'language':_0x2c5b38[_0x1d2ba1(0x1b5)],'amount_is_editable':_0x2c5b38[_0x1d2ba1(0x1bf)],'max_payments':_0x2c5b38[_0x1d2ba1(0x159)],'customer':_0x2c5b38[_0x1d2ba1(0x1bd)]});}async['getPayments'](_0x19254e,_0x5a56b1){const _0x3de560=a52_0x2a0206;return this[_0x3de560(0x1e4)][_0x3de560(0x1a7)](_0x19254e,_0x5a56b1);}async['getPaymentById'](_0x2e6531,_0xfeeae4){return this['paymentService']['getPaymentByShopAndId'](_0x2e6531,_0xfeeae4);}async[a52_0x2a0206(0x1ca)](_0x2d6f27,_0xaa81bb,_0x33a076){const _0x41f0a8=a52_0x2a0206,_0x211891=await database_1[_0x41f0a8(0x1a4)][_0x41f0a8(0x1ef)]['findFirst']({'where':{'id':_0xaa81bb,'shopId':_0x2d6f27}});if(!_0x211891)throw new Error(_0x41f0a8(0x19e));const _0x52fbd2=await database_1[_0x41f0a8(0x1a4)][_0x41f0a8(0x1ef)][_0x41f0a8(0x1c0)]({'where':{'id':_0xaa81bb},'data':{..._0x33a076,'updatedAt':new Date()}});return _0x52fbd2;}async[a52_0x2a0206(0x1dc)](_0x39ca3b,_0x4a84e6){const _0x3f93e9=a52_0x2a0206,_0x3ce802=await database_1[_0x3f93e9(0x1a4)][_0x3f93e9(0x1ef)][_0x3f93e9(0x191)]({'where':{'id':_0x4a84e6,'shopId':_0x39ca3b}});if(!_0x3ce802)throw new Error(_0x3f93e9(0x19e));await database_1[_0x3f93e9(0x1a4)][_0x3f93e9(0x1ef)][_0x3f93e9(0x1cd)]({'where':{'id':_0x4a84e6}});}async[a52_0x2a0206(0x1d6)](_0x162260,_0x4d2fe7){const _0xc59798=a52_0x2a0206,{page:_0x17a7f4,limit:_0x43674f,status:_0x15b257,method:_0x11b6cb,dateFrom:_0x16d0bf,dateTo:_0x206ba9,periodFrom:_0x5931ed,periodTo:_0x208165}=_0x4d2fe7,_0x9c85d5=(_0x17a7f4-0x1)*_0x43674f,_0x598708={'shopId':_0x162260};_0x15b257&&(_0x598708['status']=_0x15b257[_0xc59798(0x1e9)]());_0x11b6cb&&(_0x598708[_0xc59798(0x1a6)]=_0x11b6cb);if(_0x16d0bf||_0x206ba9||_0x5931ed||_0x208165){_0x598708[_0xc59798(0x1d1)]={};if(_0x5931ed)_0x598708[_0xc59798(0x1d1)][_0xc59798(0x1df)]=new Date(_0x5931ed);else _0x16d0bf&&(_0x598708[_0xc59798(0x1d1)][_0xc59798(0x1df)]=new Date(_0x16d0bf));if(_0x208165)_0x598708[_0xc59798(0x1d1)]['lte']=new Date(_0x208165);else _0x206ba9&&(_0x598708[_0xc59798(0x1d1)]['lte']=new Date(_0x206ba9));}const [_0x154271,_0x4e9c69]=await Promise[_0xc59798(0x1e6)]([database_1[_0xc59798(0x1a4)]['payout'][_0xc59798(0x18c)]({'where':_0x598708,'skip':_0x9c85d5,'take':_0x43674f,'orderBy':{'createdAt':_0xc59798(0x187)}}),database_1['default'][_0xc59798(0x179)][_0xc59798(0x1a8)]({'where':_0x598708})]);return{'payouts':_0x154271[_0xc59798(0x16f)](_0x373733=>({'id':_0x373733['id'],'amount':_0x373733[_0xc59798(0x16e)],'network':_0x373733['network'],'status':_0x373733[_0xc59798(0x196)],'txid':_0x373733[_0xc59798(0x186)],'notes':_0x373733[_0xc59798(0x162)],'createdAt':_0x373733[_0xc59798(0x1d1)],'paidAt':_0x373733[_0xc59798(0x1c9)]})),'pagination':{'page':_0x17a7f4,'limit':_0x43674f,'total':_0x4e9c69,'totalPages':Math[_0xc59798(0x189)](_0x4e9c69/_0x43674f)}};}async[a52_0x2a0206(0x190)](_0x4de6c2,_0x4dbda0){const _0x462311=a52_0x2a0206,_0x5beb13=await database_1[_0x462311(0x1a4)][_0x462311(0x179)][_0x462311(0x191)]({'where':{'id':_0x4dbda0,'shopId':_0x4de6c2}});if(!_0x5beb13)return null;return{'id':_0x5beb13['id'],'amount':_0x5beb13[_0x462311(0x16e)],'network':_0x5beb13[_0x462311(0x1a6)],'status':_0x5beb13[_0x462311(0x196)],'txid':_0x5beb13[_0x462311(0x186)],'notes':_0x5beb13[_0x462311(0x162)],'createdAt':_0x5beb13[_0x462311(0x1d1)],'paidAt':_0x5beb13['paidAt']};}async[a52_0x2a0206(0x19a)](_0x5a43a6,_0x36f009){const _0x3c1ab9=a52_0x2a0206,_0x101dd2=new Date();let _0x3ddfd5;switch(_0x36f009){case'7d':_0x3ddfd5=new Date(_0x101dd2[_0x3c1ab9(0x1ed)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x3ddfd5=new Date(_0x101dd2[_0x3c1ab9(0x1ed)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x3ddfd5=new Date(_0x101dd2[_0x3c1ab9(0x1ed)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x3ddfd5=new Date(_0x101dd2[_0x3c1ab9(0x1ed)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x158970,_0x4f62cb,_0x252dfc,_0x5e87b4,_0x376f0b,_0x1fed48]=await Promise['all']([database_1['default']['payout'][_0x3c1ab9(0x1a8)]({'where':{'shopId':_0x5a43a6,'createdAt':{'gte':_0x3ddfd5}}}),database_1[_0x3c1ab9(0x1a4)]['payout'][_0x3c1ab9(0x1a8)]({'where':{'shopId':_0x5a43a6,'status':_0x3c1ab9(0x177),'createdAt':{'gte':_0x3ddfd5}}}),database_1['default'][_0x3c1ab9(0x179)][_0x3c1ab9(0x1a8)]({'where':{'shopId':_0x5a43a6,'status':_0x3c1ab9(0x1ae),'createdAt':{'gte':_0x3ddfd5}}}),database_1[_0x3c1ab9(0x1a4)]['payout']['count']({'where':{'shopId':_0x5a43a6,'status':_0x3c1ab9(0x16a),'createdAt':{'gte':_0x3ddfd5}}}),database_1[_0x3c1ab9(0x1a4)]['payout'][_0x3c1ab9(0x18c)]({'where':{'shopId':_0x5a43a6,'createdAt':{'gte':_0x3ddfd5}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x3c1ab9(0x179)][_0x3c1ab9(0x18c)]({'where':{'shopId':_0x5a43a6},'take':0xa,'orderBy':{'createdAt':_0x3c1ab9(0x187)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x5b4316=_0x376f0b[_0x3c1ab9(0x165)]((_0x5c9f0f,_0x3ffd)=>_0x5c9f0f+_0x3ffd[_0x3c1ab9(0x16e)],0x0),_0x1e235b=_0x376f0b[_0x3c1ab9(0x1de)](_0x4707af=>_0x4707af[_0x3c1ab9(0x196)]===_0x3c1ab9(0x177))[_0x3c1ab9(0x165)]((_0x133ed5,_0x33633e)=>_0x133ed5+_0x33633e[_0x3c1ab9(0x16e)],0x0),_0x4860ad=_0x376f0b['filter'](_0x326f0f=>_0x326f0f[_0x3c1ab9(0x196)]===_0x3c1ab9(0x1ae))[_0x3c1ab9(0x165)]((_0x210980,_0x1d82bf)=>_0x210980+_0x1d82bf[_0x3c1ab9(0x16e)],0x0),_0x5df1c3=_0x376f0b[_0x3c1ab9(0x165)]((_0x417f4f,_0x2bdda7)=>{const _0x522736=_0x3c1ab9;return _0x417f4f[_0x2bdda7[_0x522736(0x1a6)]]=(_0x417f4f[_0x2bdda7[_0x522736(0x1a6)]]||0x0)+0x1,_0x417f4f;},{}),_0xab7c40=_0x376f0b[_0x3c1ab9(0x165)]((_0x45f406,_0x4da4)=>{const _0x22eaa3=_0x3c1ab9;return _0x45f406[_0x4da4['status']]=(_0x45f406[_0x4da4[_0x22eaa3(0x196)]]||0x0)+0x1,_0x45f406;},{});return{'totalPayouts':_0x158970,'completedPayouts':_0x4f62cb,'pendingPayouts':_0x252dfc,'rejectedPayouts':_0x5e87b4,'totalAmount':_0x5b4316,'completedAmount':_0x1e235b,'pendingAmount':_0x4860ad,'payoutsByMethod':_0x5df1c3,'payoutsByStatus':_0xab7c40,'recentPayouts':_0x1fed48['map'](_0x44f324=>({'id':_0x44f324['id'],'shopId':_0x5a43a6,'amount':_0x44f324['amount'],'method':_0x44f324['network'],'status':_0x44f324[_0x3c1ab9(0x196)],'txid':_0x44f324['txid'],'createdAt':_0x44f324[_0x3c1ab9(0x1d1)],'paidAt':_0x44f324[_0x3c1ab9(0x1c9)]}))};}async[a52_0x2a0206(0x171)](_0x8cd320){const _0x1d9875=a52_0x2a0206;console['log'](_0x1d9875(0x18a)+_0x8cd320+_0x1d9875(0x1dd));const _0x355451=await database_1[_0x1d9875(0x1a4)][_0x1d9875(0x1d5)]['findUnique']({'where':{'id':_0x8cd320},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x355451)throw new Error(_0x1d9875(0x1ea));const _0x33eb2c=new Date(),_0x660468=new Date(_0x33eb2c[_0x1d9875(0x1b6)](),_0x33eb2c['getMonth'](),0x1),_0x456e43=new Date(_0x33eb2c['getFullYear'](),_0x33eb2c[_0x1d9875(0x163)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xf25627=await database_1[_0x1d9875(0x1a4)][_0x1d9875(0x179)][_0x1d9875(0x15a)]({'_sum':{'amount':!![]},'where':{'shopId':_0x8cd320,'createdAt':{'gte':_0x660468,'lte':_0x456e43},'status':'COMPLETED'}}),_0x5bde11=_0xf25627[_0x1d9875(0x175)][_0x1d9875(0x16e)]||0x0,_0x27f205={'availableBalance':Math[_0x1d9875(0x1a2)](_0x355451[_0x1d9875(0x160)]*0x64)/0x64,'totalPaidOut':Math[_0x1d9875(0x1a2)](_0x355451['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x1d9875(0x1a2)](_0x355451['balance']*0x64)/0x64,'thisMonth':Math[_0x1d9875(0x1a2)](_0x5bde11*0x64)/0x64};return console[_0x1d9875(0x1c7)](_0x1d9875(0x1f0)+_0x355451['username']+_0x1d9875(0x195)),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x27f205[_0x1d9875(0x161)]+_0x1d9875(0x1b4)),console[_0x1d9875(0x1c7)](_0x1d9875(0x18e)+_0x27f205[_0x1d9875(0x181)]+_0x1d9875(0x194)),console[_0x1d9875(0x1c7)](_0x1d9875(0x1c1)+_0x27f205['awaitingPayout']+_0x1d9875(0x1b4)),console[_0x1d9875(0x1c7)](_0x1d9875(0x166)+_0x27f205[_0x1d9875(0x1c8)]+_0x1d9875(0x16c)),_0x27f205;}['getGatewayDisplayName'](_0x5e2c39){const _0x36e272=a52_0x2a0206,_0xf4b3bf={'test_gateway':_0x36e272(0x17e),'plisio':_0x36e272(0x1c4),'rapyd':_0x36e272(0x1c5),'noda':_0x36e272(0x1eb),'cointopay':_0x36e272(0x15d),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x36e272(0x1cf),'klyme_de':_0x36e272(0x1be)};return _0xf4b3bf[_0x5e2c39]||_0x5e2c39;}async[a52_0x2a0206(0x19b)](_0x341dfc){const _0x5dcaf2=a52_0x2a0206;return this[_0x5dcaf2(0x171)](_0x341dfc);}async['getWebhookLogs'](_0x5eb8c9,_0x1c5e56){const _0x2de247=a52_0x2a0206,{page:_0x52c10c,limit:_0x1a2c34,paymentId:_0x415d85}=_0x1c5e56,_0x3693e4=(_0x52c10c-0x1)*_0x1a2c34,_0x1a4c74={'shopId':_0x5eb8c9};_0x415d85&&(_0x1a4c74[_0x2de247(0x168)]=_0x415d85);const [_0x58d6d6,_0x51594d]=await Promise['all']([database_1[_0x2de247(0x1a4)][_0x2de247(0x1ee)][_0x2de247(0x18c)]({'where':_0x1a4c74,'skip':_0x3693e4,'take':_0x1a2c34,'orderBy':{'createdAt':_0x2de247(0x187)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2de247(0x1a4)]['webhookLog'][_0x2de247(0x1a8)]({'where':_0x1a4c74})]);return{'logs':_0x58d6d6[_0x2de247(0x16f)](_0x331d35=>({'id':_0x331d35['id'],'paymentId':_0x331d35['paymentId'],'shopId':_0x331d35[_0x2de247(0x1ce)],'event':_0x331d35[_0x2de247(0x172)],'statusCode':_0x331d35[_0x2de247(0x1c2)],'retryCount':_0x331d35[_0x2de247(0x199)],'responseBody':_0x331d35['responseBody'],'createdAt':_0x331d35['createdAt'],'payment':_0x331d35[_0x2de247(0x1ef)]})),'pagination':{'page':_0x52c10c,'limit':_0x1a2c34,'total':_0x51594d,'totalPages':Math[_0x2de247(0x189)](_0x51594d/_0x1a2c34)}};}async[a52_0x2a0206(0x1bb)](_0x4d0f22,_0x1198a7){const _0x46bb40=a52_0x2a0206,_0x281461=new Date();let _0x2cc727;switch(_0x1198a7){case'7d':_0x2cc727=new Date(_0x281461[_0x46bb40(0x1ed)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2cc727=new Date(_0x281461[_0x46bb40(0x1ed)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x46bb40(0x1e3):_0x2cc727=new Date(_0x281461[_0x46bb40(0x1ed)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2cc727=new Date(_0x281461[_0x46bb40(0x1ed)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x50e2fb,_0x3b74c5,_0xb0f753,_0xb47eda,_0x7ef59]=await Promise['all']([database_1[_0x46bb40(0x1a4)][_0x46bb40(0x1ef)][_0x46bb40(0x1a8)]({'where':{'shopId':_0x4d0f22,'gateway':{'not':_0x46bb40(0x1a0)},'createdAt':{'gte':_0x2cc727}}}),database_1['default'][_0x46bb40(0x1ef)][_0x46bb40(0x1a8)]({'where':{'shopId':_0x4d0f22,'gateway':{'not':_0x46bb40(0x1a0)},'status':_0x46bb40(0x1d7),'createdAt':{'gte':_0x2cc727}}}),database_1[_0x46bb40(0x1a4)][_0x46bb40(0x1ef)][_0x46bb40(0x18c)]({'where':{'shopId':_0x4d0f22,'gateway':{'not':_0x46bb40(0x1a0)},'status':_0x46bb40(0x1d7),'createdAt':{'gte':_0x2cc727}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x46bb40(0x1a4)][_0x46bb40(0x1ef)][_0x46bb40(0x18c)]({'where':{'shopId':_0x4d0f22,'gateway':{'not':_0x46bb40(0x1a0)}},'take':0xa,'orderBy':{'createdAt':_0x46bb40(0x187)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x46bb40(0x1a4)]['payment'][_0x46bb40(0x18c)]({'where':{'shopId':_0x4d0f22,'gateway':{'not':_0x46bb40(0x1a0)},'createdAt':{'gte':_0x2cc727}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x46bb40(0x1e8)}})]);let _0x192502=0x0;for(const _0x23feaa of _0xb0f753){if(_0x23feaa[_0x46bb40(0x1e5)])_0x192502+=_0x23feaa[_0x46bb40(0x1e5)];else{const _0x2623cf=await currencyService_1[_0x46bb40(0x184)]['convertToUSDT'](_0x23feaa[_0x46bb40(0x16e)],_0x23feaa[_0x46bb40(0x1e7)]);_0x192502+=_0x2623cf;}}const _0x1b4659=this[_0x46bb40(0x1c3)](_0x7ef59,_0x2cc727,_0x281461),_0x2c3091=_0x50e2fb>0x0?_0x3b74c5/_0x50e2fb*0x64:0x0;return{'totalPayments':_0x50e2fb,'successfulPayments':_0x3b74c5,'totalRevenue':Math[_0x46bb40(0x1a2)](_0x192502*0x64)/0x64,'conversionRate':Math[_0x46bb40(0x1a2)](_0x2c3091*0x64)/0x64,'dailyRevenue':_0x1b4659[_0x46bb40(0x180)],'dailyPayments':_0x1b4659['dailyPayments'],'recentPayments':_0xb47eda['map'](_0x1a324e=>({'id':_0x1a324e['id'],'gateway':_0x1a324e[_0x46bb40(0x15f)],'amount':_0x1a324e['amount'],'currency':_0x1a324e['currency'],'status':_0x1a324e['status'],'createdAt':_0x1a324e[_0x46bb40(0x1d1)]}))};}[a52_0x2a0206(0x1c3)](_0x38f446,_0x4fa742,_0x50f434){const _0x73e7d8=a52_0x2a0206,_0x55eeac=new Map(),_0x1680c6=new Date(_0x4fa742);while(_0x1680c6<=_0x50f434){const _0x52b624=_0x1680c6[_0x73e7d8(0x164)]()[_0x73e7d8(0x1d8)]('T')[0x0];_0x55eeac[_0x73e7d8(0x17c)](_0x52b624,{'revenue':0x0,'count':0x0}),_0x1680c6[_0x73e7d8(0x18d)](_0x1680c6['getDate']()+0x1);}for(const _0x1922b4 of _0x38f446){const _0xa47a5c=_0x1922b4[_0x73e7d8(0x1d1)][_0x73e7d8(0x164)]()[_0x73e7d8(0x1d8)]('T')[0x0],_0x5b16c6=_0x55eeac[_0x73e7d8(0x1a9)](_0xa47a5c);_0x5b16c6&&(_0x5b16c6[_0x73e7d8(0x1a8)]+=0x1,_0x1922b4['status']===_0x73e7d8(0x1d7)&&_0x1922b4[_0x73e7d8(0x1e5)]&&(_0x5b16c6[_0x73e7d8(0x1aa)]+=_0x1922b4['amountUSDT']));}const _0x201d18=[],_0x2db972=[];for(const [_0x26654d,_0x1d62c1]of _0x55eeac){_0x201d18[_0x73e7d8(0x15c)]({'date':_0x26654d,'amount':Math['round'](_0x1d62c1[_0x73e7d8(0x1aa)]*0x64)/0x64}),_0x2db972['push']({'date':_0x26654d,'count':_0x1d62c1[_0x73e7d8(0x1a8)]});}return{'dailyRevenue':_0x201d18,'dailyPayments':_0x2db972};}}exports['ShopService']=ShopService;