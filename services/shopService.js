'use strict';const a58_0x4f1bcb=a58_0x5ad1;(function(_0x3a82e2,_0x362304){const _0x872381=a58_0x5ad1,_0x17b26c=_0x3a82e2();while(!![]){try{const _0x49580d=parseInt(_0x872381(0x1f5))/0x1*(parseInt(_0x872381(0x1e7))/0x2)+parseInt(_0x872381(0x213))/0x3+-parseInt(_0x872381(0x240))/0x4+parseInt(_0x872381(0x221))/0x5+-parseInt(_0x872381(0x23b))/0x6*(parseInt(_0x872381(0x215))/0x7)+-parseInt(_0x872381(0x217))/0x8+-parseInt(_0x872381(0x1db))/0x9;if(_0x49580d===_0x362304)break;else _0x17b26c['push'](_0x17b26c['shift']());}catch(_0x1b128c){_0x17b26c['push'](_0x17b26c['shift']());}}}(a58_0x5a87,0x2163d));function a58_0x5a87(){const _0x45c98a=['count','76390XUreuR','amount','setDate','testWebhook','event','paidAt','getPayments','getPayoutStatistics','responseBody','message','PENDING','map','dailyRevenue','Noda','6FLCngV','findFirst','getPaymentByShopAndId','webhookLog','./currencyService','usdtErcWallet','toISOString','parse','getTime','totalPaidOut','getGatewayDisplayName','merchantUrl','üåê\x20Network\x20filter:\x20','fullName','\x20\x20\x20üìÖ\x20This\x20month:\x20','aggregate','gte','CoinToPay','30d','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','COMPLETED','username','üìä\x20Final\x20WHERE\x20conditions:','network','USDT\x20TRC20','statusText','KLYME\x20DE','Shop\x20not\x20found','90d','\x20USDT','369585uyikQi','updateShopProfile','14sSPbcn','usage','1257688PicELC','shopId','üåê\x20Method\x20filter:\x20','Test\x20Gateway','updatePayment','getMonth','üìä\x20Shop\x20','__esModule','isArray','set','1160015yeBHgh','application/json','all','createdAt','round','getDate','üìÖ\x20Period\x20start:\x20','txid','amountUSDT','convertToUSDT','payout','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','shopUrl','getPaymentsByShop','findUnique','usdtPolygonWallet','maxPayments','No\x20webhook\x20URL\x20configured','...','periodTo','status','getPayouts','USDC\x20Polygon','getPayoutStats','REJECTED','customer','246360uIzUyp','redirectUrl','KLYME\x20GB','paymentGateways','publicKey','764724ZhBIMr','webhookEvents','telegramId','_sum','usdtTrcWallet','USD','push','paymentService','update','formatNetworkName','\x20\x20\x20üíµ\x20Available\x20balance:\x20','test','telegram','settings','desc','\x20USDT\x20(total\x20payouts)','toUpperCase','test_order_123','generateDailyStatistics','split','üìÖ\x20Date\x20end:\x20','language','currencyService','PaymentService','TesSoft\x20Payment\x20System/1.0\x20(Test)','getWebhookLogs','paymentId','deletePayment','filter','sourceCurrency','updateWallets','Error\x20parsing\x20webhook\x20events:','erc20','webhookUrl','Payment\x20not\x20found','ShopService','get','trc20','USDT\x20Polygon','üìÖ\x20Date\x20start:\x20','Unknown\x20error','üìÖ\x20Period\x20end:\x20','polygon_usdc','customerName','payment','test_gateway','POST','USDT\x20BSC','revenue','name','paid','error','stringify','currency','statusCode','gatewaySettings','usdcPolygonWallet','\x20USDT\x20(current\x20balance)','default','PAID','getShopProfile','balance','createPublicPayment','USDT\x20ERC20','shop','findMany','wallets','log','setHours','country','153819UtWmpW','notes','ceil','availableBalance','getShopPayoutStats','Rapyd','polygon','defineProperty','gateways','reduce','../config/database'];a58_0x5a87=function(){return _0x45c98a;};return a58_0x5a87();}var __importDefault=this&&this['__importDefault']||function(_0x768745){const _0x46eef2=a58_0x5ad1;return _0x768745&&_0x768745[_0x46eef2(0x21e)]?_0x768745:{'default':_0x768745};};Object[a58_0x4f1bcb(0x1e2)](exports,a58_0x4f1bcb(0x21e),{'value':!![]}),exports[a58_0x4f1bcb(0x263)]=void 0x0;const database_1=__importDefault(require(a58_0x4f1bcb(0x1e5))),currencyService_1=require(a58_0x4f1bcb(0x1f9)),paymentService_1=require('./paymentService');function a58_0x5ad1(_0x39844d,_0x3093fe){const _0x5a879f=a58_0x5a87();return a58_0x5ad1=function(_0x5ad10c,_0x545ab4){_0x5ad10c=_0x5ad10c-0x1d1;let _0x52f363=_0x5a879f[_0x5ad10c];return _0x52f363;},a58_0x5ad1(_0x39844d,_0x3093fe);}class ShopService{constructor(){const _0x56f942=a58_0x4f1bcb;this[_0x56f942(0x247)]=new paymentService_1[(_0x56f942(0x257))]();}async[a58_0x4f1bcb(0x1d1)](_0x27c9fb){const _0x245bb2=a58_0x4f1bcb,_0x2a31d3=await database_1[_0x245bb2(0x27a)][_0x245bb2(0x1d5)]['findUnique']({'where':{'id':_0x27c9fb},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2a31d3)throw new Error(_0x245bb2(0x210));let _0x2c9678=[];if(_0x2a31d3[_0x245bb2(0x24d)]?.[_0x245bb2(0x241)])try{_0x2c9678=Array[_0x245bb2(0x21f)](_0x2a31d3[_0x245bb2(0x24d)][_0x245bb2(0x241)])?_0x2a31d3[_0x245bb2(0x24d)][_0x245bb2(0x241)]:JSON['parse'](_0x2a31d3[_0x245bb2(0x24d)][_0x245bb2(0x241)]);}catch(_0x282195){console[_0x245bb2(0x273)](_0x245bb2(0x25f),_0x282195),_0x2c9678=[];}return{'id':_0x2a31d3['id'],'fullName':_0x2a31d3[_0x245bb2(0x271)],'username':_0x2a31d3[_0x245bb2(0x20a)],'telegramId':_0x2a31d3[_0x245bb2(0x24c)],'merchantUrl':_0x2a31d3[_0x245bb2(0x22d)],'gateways':_0x2a31d3[_0x245bb2(0x23e)]?JSON[_0x245bb2(0x1fc)](_0x2a31d3['paymentGateways']):null,'gatewaySettings':_0x2a31d3[_0x245bb2(0x277)]?JSON['parse'](_0x2a31d3['gatewaySettings']):null,'publicKey':_0x2a31d3['publicKey'],'webhookUrl':_0x2a31d3[_0x245bb2(0x24d)]?.[_0x245bb2(0x261)]||null,'webhookEvents':_0x2c9678,'wallets':{'usdtPolygonWallet':_0x2a31d3[_0x245bb2(0x230)],'usdtTrcWallet':_0x2a31d3[_0x245bb2(0x244)],'usdtErcWallet':_0x2a31d3[_0x245bb2(0x1fa)],'usdcPolygonWallet':_0x2a31d3[_0x245bb2(0x278)]},'status':_0x2a31d3['status'],'createdAt':_0x2a31d3[_0x245bb2(0x224)]};}async[a58_0x4f1bcb(0x214)](_0x46c751,_0x4a1c1b){const _0x3106f4=a58_0x4f1bcb,_0x3f4bbc={};_0x4a1c1b[_0x3106f4(0x202)]&&(_0x3f4bbc[_0x3106f4(0x271)]=_0x4a1c1b['fullName']);_0x4a1c1b[_0x3106f4(0x242)]!==undefined&&(_0x3f4bbc[_0x3106f4(0x24c)]=_0x4a1c1b[_0x3106f4(0x242)]||null);_0x4a1c1b[_0x3106f4(0x200)]&&(_0x3f4bbc[_0x3106f4(0x22d)]=_0x4a1c1b[_0x3106f4(0x200)]);_0x4a1c1b[_0x3106f4(0x1e3)]&&(_0x3f4bbc[_0x3106f4(0x23e)]=JSON[_0x3106f4(0x274)](_0x4a1c1b[_0x3106f4(0x1e3)]));_0x4a1c1b[_0x3106f4(0x277)]&&(_0x3f4bbc[_0x3106f4(0x277)]=JSON['stringify'](_0x4a1c1b[_0x3106f4(0x277)]));_0x4a1c1b['wallets']&&(_0x4a1c1b[_0x3106f4(0x1d7)][_0x3106f4(0x230)]!==undefined&&(_0x3f4bbc['usdtPolygonWallet']=_0x4a1c1b[_0x3106f4(0x1d7)][_0x3106f4(0x230)]||null),_0x4a1c1b['wallets']['usdtTrcWallet']!==undefined&&(_0x3f4bbc['usdtTrcWallet']=_0x4a1c1b[_0x3106f4(0x1d7)][_0x3106f4(0x244)]||null),_0x4a1c1b['wallets']['usdtErcWallet']!==undefined&&(_0x3f4bbc[_0x3106f4(0x1fa)]=_0x4a1c1b[_0x3106f4(0x1d7)][_0x3106f4(0x1fa)]||null),_0x4a1c1b[_0x3106f4(0x1d7)]['usdcPolygonWallet']!==undefined&&(_0x3f4bbc[_0x3106f4(0x278)]=_0x4a1c1b[_0x3106f4(0x1d7)][_0x3106f4(0x278)]||null));const _0x30eb4f=await database_1[_0x3106f4(0x27a)][_0x3106f4(0x1d5)][_0x3106f4(0x248)]({'where':{'id':_0x46c751},'data':_0x3f4bbc,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x32a83d=[];if(_0x30eb4f[_0x3106f4(0x24d)]?.[_0x3106f4(0x241)])try{_0x32a83d=Array[_0x3106f4(0x21f)](_0x30eb4f[_0x3106f4(0x24d)]['webhookEvents'])?_0x30eb4f[_0x3106f4(0x24d)][_0x3106f4(0x241)]:JSON[_0x3106f4(0x1fc)](_0x30eb4f[_0x3106f4(0x24d)][_0x3106f4(0x241)]);}catch(_0x4a6025){console[_0x3106f4(0x273)](_0x3106f4(0x25f),_0x4a6025),_0x32a83d=[];}return{'id':_0x30eb4f['id'],'fullName':_0x30eb4f[_0x3106f4(0x271)],'username':_0x30eb4f['username'],'telegramId':_0x30eb4f[_0x3106f4(0x24c)],'merchantUrl':_0x30eb4f[_0x3106f4(0x22d)],'gateways':_0x30eb4f['paymentGateways']?JSON['parse'](_0x30eb4f['paymentGateways']):null,'gatewaySettings':_0x30eb4f['gatewaySettings']?JSON[_0x3106f4(0x1fc)](_0x30eb4f[_0x3106f4(0x277)]):null,'publicKey':_0x30eb4f[_0x3106f4(0x23f)],'webhookUrl':_0x30eb4f['settings']?.[_0x3106f4(0x261)]||null,'webhookEvents':_0x32a83d,'wallets':{'usdtPolygonWallet':_0x30eb4f[_0x3106f4(0x230)],'usdtTrcWallet':_0x30eb4f[_0x3106f4(0x244)],'usdtErcWallet':_0x30eb4f['usdtErcWallet'],'usdcPolygonWallet':_0x30eb4f['usdcPolygonWallet']},'status':_0x30eb4f[_0x3106f4(0x235)],'createdAt':_0x30eb4f[_0x3106f4(0x224)]};}async[a58_0x4f1bcb(0x25e)](_0x18768c,_0x5a308a){const _0x462d7e=a58_0x4f1bcb,_0x5ab5c6={};_0x5a308a[_0x462d7e(0x230)]!==undefined&&(_0x5ab5c6[_0x462d7e(0x230)]=_0x5a308a['usdtPolygonWallet']||null),_0x5a308a[_0x462d7e(0x244)]!==undefined&&(_0x5ab5c6['usdtTrcWallet']=_0x5a308a[_0x462d7e(0x244)]||null),_0x5a308a[_0x462d7e(0x1fa)]!==undefined&&(_0x5ab5c6[_0x462d7e(0x1fa)]=_0x5a308a[_0x462d7e(0x1fa)]||null),_0x5a308a[_0x462d7e(0x278)]!==undefined&&(_0x5ab5c6['usdcPolygonWallet']=_0x5a308a[_0x462d7e(0x278)]||null),await database_1[_0x462d7e(0x27a)][_0x462d7e(0x1d5)][_0x462d7e(0x248)]({'where':{'id':_0x18768c},'data':_0x5ab5c6});}async[a58_0x4f1bcb(0x1ea)](_0x1b219e){const _0x516dd2=a58_0x4f1bcb,_0x5ab4f5=await database_1['default']['shop'][_0x516dd2(0x22f)]({'where':{'id':_0x1b219e},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x5ab4f5?.['settings']?.[_0x516dd2(0x261)])throw new Error(_0x516dd2(0x232));const _0x3a9baa={'event':_0x516dd2(0x24b),'payment':{'id':'test_payment_123','order_id':_0x516dd2(0x251),'gateway':'test','amount':0x64,'currency':_0x516dd2(0x245),'status':_0x516dd2(0x272),'created_at':new Date()[_0x516dd2(0x1fb)]()}};try{const _0x45776f=await fetch(_0x5ab4f5[_0x516dd2(0x24d)][_0x516dd2(0x261)],{'method':_0x516dd2(0x26e),'headers':{'Content-Type':_0x516dd2(0x222),'User-Agent':_0x516dd2(0x258)},'body':JSON[_0x516dd2(0x274)](_0x3a9baa)});return _0x45776f['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x45776f['status']+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x45776f[_0x516dd2(0x235)]+'\x20'+_0x45776f[_0x516dd2(0x20e)]};}catch(_0x5d2d60){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x5d2d60 instanceof Error?_0x5d2d60[_0x516dd2(0x1f0)]:_0x516dd2(0x268))};}}async['createPayment'](_0x44004c){const _0x1ded7e=a58_0x4f1bcb;return this['paymentService'][_0x1ded7e(0x1d3)]({'public_key':'','gateway':_0x44004c['gateway'],'order_id':undefined,'amount':_0x44004c[_0x1ded7e(0x1e8)],'currency':_0x44004c[_0x1ded7e(0x275)],'source_currency':_0x44004c[_0x1ded7e(0x25d)],'usage':_0x44004c[_0x1ded7e(0x216)],'expires_at':_0x44004c['expiresAt']?.[_0x1ded7e(0x1fb)](),'success_url':_0x44004c[_0x1ded7e(0x23c)],'fail_url':_0x44004c[_0x1ded7e(0x23c)],'customer_email':_0x44004c['customerEmail'],'customer_name':_0x44004c[_0x1ded7e(0x26b)],'country':_0x44004c[_0x1ded7e(0x1da)],'language':_0x44004c[_0x1ded7e(0x255)],'amount_is_editable':_0x44004c['amountIsEditable'],'max_payments':_0x44004c[_0x1ded7e(0x231)],'customer':_0x44004c[_0x1ded7e(0x23a)]});}async[a58_0x4f1bcb(0x1ed)](_0x3f3da9,_0x13c3c0){const _0x1ca3ad=a58_0x4f1bcb;return this['paymentService'][_0x1ca3ad(0x22e)](_0x3f3da9,_0x13c3c0);}async['getPaymentById'](_0x2f2e61,_0x25e168){const _0x55589b=a58_0x4f1bcb;return this['paymentService'][_0x55589b(0x1f7)](_0x2f2e61,_0x25e168);}async[a58_0x4f1bcb(0x21b)](_0x4781ab,_0x2ab825,_0x45e4a0){const _0x185510=a58_0x4f1bcb,_0x57ecf=await database_1['default'][_0x185510(0x26c)][_0x185510(0x1f6)]({'where':{'id':_0x2ab825,'shopId':_0x4781ab}});if(!_0x57ecf)throw new Error(_0x185510(0x262));const _0x41e363=await database_1['default']['payment'][_0x185510(0x248)]({'where':{'id':_0x2ab825},'data':{..._0x45e4a0,'updatedAt':new Date()}});return _0x41e363;}async[a58_0x4f1bcb(0x25b)](_0x4b18ef,_0x3b972c){const _0x5c493e=a58_0x4f1bcb,_0x3b274f=await database_1[_0x5c493e(0x27a)][_0x5c493e(0x26c)]['findFirst']({'where':{'id':_0x3b972c,'shopId':_0x4b18ef}});if(!_0x3b274f)throw new Error(_0x5c493e(0x262));await database_1[_0x5c493e(0x27a)][_0x5c493e(0x26c)]['delete']({'where':{'id':_0x3b972c}});}[a58_0x4f1bcb(0x249)](_0x1316ab){const _0x3a77dd=a58_0x4f1bcb,_0x167a12={'polygon':_0x3a77dd(0x266),'trc20':_0x3a77dd(0x20d),'erc20':_0x3a77dd(0x1d4),'bsc':_0x3a77dd(0x26f),'polygon_usdc':_0x3a77dd(0x237)};return _0x167a12[_0x1316ab]||_0x1316ab;}async[a58_0x4f1bcb(0x236)](_0x357d6d,_0x196156){const _0x20c7fe=a58_0x4f1bcb,{page:_0x4c4332,limit:_0x4cd0c4,status:_0x3a67c2,method:_0x113dfb,network:_0x1af118,dateFrom:_0x11446e,dateTo:_0x1060c4,periodFrom:_0x15279d,periodTo:_0x3f15b8}=_0x196156,_0x5c7796=(_0x4c4332-0x1)*_0x4cd0c4;console[_0x20c7fe(0x1d8)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x196156);const _0x42edf4={'shopId':_0x357d6d};_0x3a67c2&&(_0x42edf4[_0x20c7fe(0x235)]=_0x3a67c2[_0x20c7fe(0x250)](),console[_0x20c7fe(0x1d8)]('üìä\x20Status\x20filter:\x20'+_0x3a67c2[_0x20c7fe(0x250)]()));if(_0x113dfb)_0x42edf4[_0x20c7fe(0x20c)]=_0x113dfb,console[_0x20c7fe(0x1d8)](_0x20c7fe(0x219)+_0x113dfb);else _0x1af118&&(_0x42edf4[_0x20c7fe(0x20c)]=_0x1af118,console[_0x20c7fe(0x1d8)](_0x20c7fe(0x201)+_0x1af118));if(_0x11446e||_0x1060c4||_0x15279d||_0x3f15b8){_0x42edf4[_0x20c7fe(0x224)]={};if(_0x15279d){const _0x5b7a0e=new Date(_0x15279d);_0x5b7a0e['setHours'](0x0,0x0,0x0,0x0),_0x42edf4['createdAt'][_0x20c7fe(0x205)]=_0x5b7a0e,console['log'](_0x20c7fe(0x227)+_0x5b7a0e[_0x20c7fe(0x1fb)]());}else{if(_0x11446e){const _0x312afd=new Date(_0x11446e);_0x312afd[_0x20c7fe(0x1d9)](0x0,0x0,0x0,0x0),_0x42edf4['createdAt']['gte']=_0x312afd,console[_0x20c7fe(0x1d8)](_0x20c7fe(0x267)+_0x312afd[_0x20c7fe(0x1fb)]());}}if(_0x3f15b8){const _0x55bae0=new Date(_0x3f15b8);_0x55bae0['setHours'](0x17,0x3b,0x3b,0x3e7),_0x42edf4['createdAt']['lte']=_0x55bae0,console[_0x20c7fe(0x1d8)](_0x20c7fe(0x269)+_0x55bae0[_0x20c7fe(0x1fb)]());}else{if(_0x1060c4){const _0xe598aa=new Date(_0x1060c4);_0xe598aa['setHours'](0x17,0x3b,0x3b,0x3e7),_0x42edf4[_0x20c7fe(0x224)]['lte']=_0xe598aa,console['log'](_0x20c7fe(0x254)+_0xe598aa[_0x20c7fe(0x1fb)]());}}}console[_0x20c7fe(0x1d8)](_0x20c7fe(0x20b),JSON[_0x20c7fe(0x274)](_0x42edf4,null,0x2));const [_0x597d74,_0x2e0222]=await Promise[_0x20c7fe(0x223)]([database_1[_0x20c7fe(0x27a)]['payout'][_0x20c7fe(0x1d6)]({'where':_0x42edf4,'skip':_0x5c7796,'take':_0x4cd0c4,'orderBy':{'createdAt':_0x20c7fe(0x24e)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x20c7fe(0x22b)][_0x20c7fe(0x1e6)]({'where':_0x42edf4})]);return{'payouts':_0x597d74[_0x20c7fe(0x1f2)](_0x2c98af=>{const _0xac0107=_0x20c7fe;let _0x5d236a=null;switch(_0x2c98af[_0xac0107(0x20c)]){case _0xac0107(0x1e1):_0x5d236a=_0x2c98af[_0xac0107(0x1d5)][_0xac0107(0x230)];break;case _0xac0107(0x265):_0x5d236a=_0x2c98af[_0xac0107(0x1d5)][_0xac0107(0x244)];break;case _0xac0107(0x260):_0x5d236a=_0x2c98af['shop'][_0xac0107(0x1fa)];break;case _0xac0107(0x26a):_0x5d236a=_0x2c98af[_0xac0107(0x1d5)][_0xac0107(0x278)];break;}return{'id':_0x2c98af['id'],'amount':_0x2c98af[_0xac0107(0x1e8)],'network':this[_0xac0107(0x249)](_0x2c98af[_0xac0107(0x20c)]),'wallet':_0x5d236a,'status':_0x2c98af['status'],'txid':_0x2c98af[_0xac0107(0x228)],'notes':_0x2c98af[_0xac0107(0x1dc)],'periodFrom':_0x2c98af['periodFrom'],'periodTo':_0x2c98af[_0xac0107(0x234)],'createdAt':_0x2c98af[_0xac0107(0x224)],'paidAt':_0x2c98af[_0xac0107(0x1ec)]};}),'pagination':{'page':_0x4c4332,'limit':_0x4cd0c4,'total':_0x2e0222,'totalPages':Math[_0x20c7fe(0x1dd)](_0x2e0222/_0x4cd0c4)}};}async['getPayoutById'](_0x52eeb8,_0x1142c4){const _0x1ba4ad=a58_0x4f1bcb,_0x16139c=await database_1[_0x1ba4ad(0x27a)][_0x1ba4ad(0x22b)][_0x1ba4ad(0x1f6)]({'where':{'id':_0x1142c4,'shopId':_0x52eeb8}});if(!_0x16139c)return null;return{'id':_0x16139c['id'],'amount':_0x16139c['amount'],'network':_0x16139c[_0x1ba4ad(0x20c)],'status':_0x16139c[_0x1ba4ad(0x235)],'txid':_0x16139c[_0x1ba4ad(0x228)],'notes':_0x16139c['notes'],'createdAt':_0x16139c['createdAt'],'paidAt':_0x16139c['paidAt']};}async[a58_0x4f1bcb(0x1ee)](_0x412f26,_0x25692a){const _0x2b35e4=a58_0x4f1bcb,_0x4af3ff=new Date();let _0x333df7;switch(_0x25692a){case'7d':_0x333df7=new Date(_0x4af3ff[_0x2b35e4(0x1fd)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2b35e4(0x207):_0x333df7=new Date(_0x4af3ff[_0x2b35e4(0x1fd)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2b35e4(0x211):_0x333df7=new Date(_0x4af3ff[_0x2b35e4(0x1fd)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x333df7=new Date(_0x4af3ff[_0x2b35e4(0x1fd)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3fa808,_0x408363,_0x5db09c,_0x538c72,_0x436413,_0x153f55]=await Promise[_0x2b35e4(0x223)]([database_1[_0x2b35e4(0x27a)][_0x2b35e4(0x22b)]['count']({'where':{'shopId':_0x412f26,'createdAt':{'gte':_0x333df7}}}),database_1[_0x2b35e4(0x27a)][_0x2b35e4(0x22b)][_0x2b35e4(0x1e6)]({'where':{'shopId':_0x412f26,'status':_0x2b35e4(0x209),'createdAt':{'gte':_0x333df7}}}),database_1['default']['payout']['count']({'where':{'shopId':_0x412f26,'status':_0x2b35e4(0x1f1),'createdAt':{'gte':_0x333df7}}}),database_1['default'][_0x2b35e4(0x22b)][_0x2b35e4(0x1e6)]({'where':{'shopId':_0x412f26,'status':_0x2b35e4(0x239),'createdAt':{'gte':_0x333df7}}}),database_1[_0x2b35e4(0x27a)][_0x2b35e4(0x22b)][_0x2b35e4(0x1d6)]({'where':{'shopId':_0x412f26,'createdAt':{'gte':_0x333df7}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x2b35e4(0x27a)][_0x2b35e4(0x22b)][_0x2b35e4(0x1d6)]({'where':{'shopId':_0x412f26},'take':0xa,'orderBy':{'createdAt':_0x2b35e4(0x24e)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x326015=_0x436413[_0x2b35e4(0x1e4)]((_0x188d84,_0x583497)=>_0x188d84+_0x583497[_0x2b35e4(0x1e8)],0x0),_0x16b140=_0x436413[_0x2b35e4(0x25c)](_0x10316f=>_0x10316f[_0x2b35e4(0x235)]===_0x2b35e4(0x209))[_0x2b35e4(0x1e4)]((_0x256cf8,_0x5d6d44)=>_0x256cf8+_0x5d6d44[_0x2b35e4(0x1e8)],0x0),_0x204c4e=_0x436413[_0x2b35e4(0x25c)](_0xf5bdbb=>_0xf5bdbb[_0x2b35e4(0x235)]===_0x2b35e4(0x1f1))['reduce']((_0x3553f4,_0x3bc363)=>_0x3553f4+_0x3bc363[_0x2b35e4(0x1e8)],0x0),_0x18d86c=_0x436413['reduce']((_0x269114,_0x5d22fc)=>{const _0x40b6a2=_0x2b35e4;return _0x269114[_0x5d22fc[_0x40b6a2(0x20c)]]=(_0x269114[_0x5d22fc[_0x40b6a2(0x20c)]]||0x0)+0x1,_0x269114;},{}),_0x2ec35e=_0x436413[_0x2b35e4(0x1e4)]((_0x5dec4b,_0x1f21bf)=>{const _0x82bd48=_0x2b35e4;return _0x5dec4b[_0x1f21bf[_0x82bd48(0x235)]]=(_0x5dec4b[_0x1f21bf[_0x82bd48(0x235)]]||0x0)+0x1,_0x5dec4b;},{});return{'totalPayouts':_0x3fa808,'completedPayouts':_0x408363,'pendingPayouts':_0x5db09c,'rejectedPayouts':_0x538c72,'totalAmount':_0x326015,'completedAmount':_0x16b140,'pendingAmount':_0x204c4e,'payoutsByMethod':_0x18d86c,'payoutsByStatus':_0x2ec35e,'recentPayouts':_0x153f55[_0x2b35e4(0x1f2)](_0x58f9ec=>({'id':_0x58f9ec['id'],'shopId':_0x412f26,'amount':_0x58f9ec[_0x2b35e4(0x1e8)],'method':_0x58f9ec['network'],'status':_0x58f9ec[_0x2b35e4(0x235)],'txid':_0x58f9ec['txid'],'createdAt':_0x58f9ec['createdAt'],'paidAt':_0x58f9ec[_0x2b35e4(0x1ec)]}))};}async[a58_0x4f1bcb(0x1df)](_0x158c84){const _0x67aa05=a58_0x4f1bcb;console[_0x67aa05(0x1d8)](_0x67aa05(0x208)+_0x158c84+_0x67aa05(0x233));const _0x204c68=await database_1[_0x67aa05(0x27a)][_0x67aa05(0x1d5)][_0x67aa05(0x22f)]({'where':{'id':_0x158c84},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x204c68)throw new Error(_0x67aa05(0x210));const _0x4e35d3=new Date(),_0x2fb20c=new Date(_0x4e35d3['getFullYear'](),_0x4e35d3[_0x67aa05(0x21c)](),0x1),_0x334267=new Date(_0x4e35d3['getFullYear'](),_0x4e35d3[_0x67aa05(0x21c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x9b1a1f=await database_1[_0x67aa05(0x27a)][_0x67aa05(0x22b)][_0x67aa05(0x204)]({'_sum':{'amount':!![]},'where':{'shopId':_0x158c84,'createdAt':{'gte':_0x2fb20c,'lte':_0x334267},'status':'COMPLETED'}}),_0x2ea7d5=_0x9b1a1f[_0x67aa05(0x243)][_0x67aa05(0x1e8)]||0x0,_0x1879f3={'availableBalance':Math[_0x67aa05(0x225)](_0x204c68[_0x67aa05(0x1d2)]*0x64)/0x64,'totalPaidOut':Math[_0x67aa05(0x225)](_0x204c68['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math['round'](_0x204c68[_0x67aa05(0x1d2)]*0x64)/0x64,'thisMonth':Math[_0x67aa05(0x225)](_0x2ea7d5*0x64)/0x64};return console[_0x67aa05(0x1d8)](_0x67aa05(0x21d)+_0x204c68[_0x67aa05(0x20a)]+'\x20payout\x20statistics\x20calculated:'),console[_0x67aa05(0x1d8)](_0x67aa05(0x24a)+_0x1879f3[_0x67aa05(0x1de)]+_0x67aa05(0x279)),console[_0x67aa05(0x1d8)](_0x67aa05(0x22c)+_0x1879f3[_0x67aa05(0x1fe)]+_0x67aa05(0x24f)),console[_0x67aa05(0x1d8)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x1879f3['awaitingPayout']+'\x20USDT\x20(current\x20balance)'),console[_0x67aa05(0x1d8)](_0x67aa05(0x203)+_0x1879f3['thisMonth']+_0x67aa05(0x212)),_0x1879f3;}[a58_0x4f1bcb(0x1ff)](_0x46a7c3){const _0x49cf90=a58_0x4f1bcb,_0x1c8fb9={'test_gateway':_0x49cf90(0x21a),'plisio':'Plisio','rapyd':_0x49cf90(0x1e0),'noda':_0x49cf90(0x1f4),'cointopay':_0x49cf90(0x206),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x49cf90(0x23d),'klyme_de':_0x49cf90(0x20f)};return _0x1c8fb9[_0x46a7c3]||_0x46a7c3;}async[a58_0x4f1bcb(0x238)](_0x47edef){const _0x30382b=a58_0x4f1bcb;return this[_0x30382b(0x1df)](_0x47edef);}async[a58_0x4f1bcb(0x259)](_0x4c096e,_0x1d19bc){const _0xa93d87=a58_0x4f1bcb,{page:_0x33438b,limit:_0x159127,paymentId:_0x22e591}=_0x1d19bc,_0x5eae89=(_0x33438b-0x1)*_0x159127,_0xbe3015={'shopId':_0x4c096e};_0x22e591&&(_0xbe3015[_0xa93d87(0x25a)]=_0x22e591);const [_0x3d1762,_0xdbbaeb]=await Promise['all']([database_1[_0xa93d87(0x27a)][_0xa93d87(0x1f8)][_0xa93d87(0x1d6)]({'where':_0xbe3015,'skip':_0x5eae89,'take':_0x159127,'orderBy':{'createdAt':_0xa93d87(0x24e)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0xa93d87(0x27a)][_0xa93d87(0x1f8)]['count']({'where':_0xbe3015})]);return{'logs':_0x3d1762[_0xa93d87(0x1f2)](_0xff3cce=>({'id':_0xff3cce['id'],'paymentId':_0xff3cce[_0xa93d87(0x25a)],'shopId':_0xff3cce[_0xa93d87(0x218)],'event':_0xff3cce[_0xa93d87(0x1eb)],'statusCode':_0xff3cce[_0xa93d87(0x276)],'retryCount':_0xff3cce['retryCount'],'responseBody':_0xff3cce[_0xa93d87(0x1ef)],'createdAt':_0xff3cce['createdAt'],'payment':_0xff3cce['payment']})),'pagination':{'page':_0x33438b,'limit':_0x159127,'total':_0xdbbaeb,'totalPages':Math[_0xa93d87(0x1dd)](_0xdbbaeb/_0x159127)}};}async['getStatistics'](_0x6087d2,_0x236d25){const _0x3cb70f=a58_0x4f1bcb,_0x5bee39=new Date();let _0x2b06bc;switch(_0x236d25){case'7d':_0x2b06bc=new Date(_0x5bee39[_0x3cb70f(0x1fd)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2b06bc=new Date(_0x5bee39['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3cb70f(0x211):_0x2b06bc=new Date(_0x5bee39[_0x3cb70f(0x1fd)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2b06bc=new Date(_0x5bee39[_0x3cb70f(0x1fd)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x21a0ce,_0x42b2fa,_0xd67383,_0x1d33ce,_0x2018b1]=await Promise[_0x3cb70f(0x223)]([database_1[_0x3cb70f(0x27a)][_0x3cb70f(0x26c)][_0x3cb70f(0x1e6)]({'where':{'shopId':_0x6087d2,'gateway':{'not':_0x3cb70f(0x26d)},'createdAt':{'gte':_0x2b06bc}}}),database_1[_0x3cb70f(0x27a)][_0x3cb70f(0x26c)][_0x3cb70f(0x1e6)]({'where':{'shopId':_0x6087d2,'gateway':{'not':_0x3cb70f(0x26d)},'status':'PAID','createdAt':{'gte':_0x2b06bc}}}),database_1[_0x3cb70f(0x27a)][_0x3cb70f(0x26c)]['findMany']({'where':{'shopId':_0x6087d2,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0x2b06bc}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3cb70f(0x27a)][_0x3cb70f(0x26c)]['findMany']({'where':{'shopId':_0x6087d2,'gateway':{'not':_0x3cb70f(0x26d)}},'take':0xa,'orderBy':{'createdAt':_0x3cb70f(0x24e)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x3cb70f(0x26c)][_0x3cb70f(0x1d6)]({'where':{'shopId':_0x6087d2,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x2b06bc}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x24a208=0x0;for(const _0x1635ff of _0xd67383){if(_0x1635ff[_0x3cb70f(0x229)])_0x24a208+=_0x1635ff['amountUSDT'];else{const _0x4186e3=await currencyService_1[_0x3cb70f(0x256)][_0x3cb70f(0x22a)](_0x1635ff[_0x3cb70f(0x1e8)],_0x1635ff[_0x3cb70f(0x275)]);_0x24a208+=_0x4186e3;}}const _0x16dd05=this['generateDailyStatistics'](_0x2018b1,_0x2b06bc,_0x5bee39),_0x38636e=_0x21a0ce>0x0?_0x42b2fa/_0x21a0ce*0x64:0x0;return{'totalPayments':_0x21a0ce,'successfulPayments':_0x42b2fa,'totalRevenue':Math[_0x3cb70f(0x225)](_0x24a208*0x64)/0x64,'conversionRate':Math['round'](_0x38636e*0x64)/0x64,'dailyRevenue':_0x16dd05[_0x3cb70f(0x1f3)],'dailyPayments':_0x16dd05['dailyPayments'],'recentPayments':_0x1d33ce[_0x3cb70f(0x1f2)](_0x41b924=>({'id':_0x41b924['id'],'gateway':_0x41b924['gateway'],'amount':_0x41b924[_0x3cb70f(0x1e8)],'currency':_0x41b924[_0x3cb70f(0x275)],'status':_0x41b924[_0x3cb70f(0x235)],'createdAt':_0x41b924['createdAt']}))};}[a58_0x4f1bcb(0x252)](_0x521c13,_0x3aad23,_0x1a9d95){const _0x282666=a58_0x4f1bcb,_0x3c443e=new Map(),_0x1d4c32=new Date(_0x3aad23);while(_0x1d4c32<=_0x1a9d95){const _0x3c475b=_0x1d4c32[_0x282666(0x1fb)]()['split']('T')[0x0];_0x3c443e[_0x282666(0x220)](_0x3c475b,{'revenue':0x0,'count':0x0}),_0x1d4c32[_0x282666(0x1e9)](_0x1d4c32[_0x282666(0x226)]()+0x1);}for(const _0x4c66fd of _0x521c13){const _0x1f1234=_0x4c66fd[_0x282666(0x224)][_0x282666(0x1fb)]()[_0x282666(0x253)]('T')[0x0],_0x5a9829=_0x3c443e[_0x282666(0x264)](_0x1f1234);_0x5a9829&&(_0x5a9829[_0x282666(0x1e6)]+=0x1,_0x4c66fd[_0x282666(0x235)]===_0x282666(0x27b)&&_0x4c66fd['amountUSDT']&&(_0x5a9829[_0x282666(0x270)]+=_0x4c66fd[_0x282666(0x229)]));}const _0x10e0d4=[],_0x5bfeb6=[];for(const [_0x22a146,_0x217b49]of _0x3c443e){_0x10e0d4[_0x282666(0x246)]({'date':_0x22a146,'amount':Math[_0x282666(0x225)](_0x217b49[_0x282666(0x270)]*0x64)/0x64}),_0x5bfeb6[_0x282666(0x246)]({'date':_0x22a146,'count':_0x217b49[_0x282666(0x1e6)]});}return{'dailyRevenue':_0x10e0d4,'dailyPayments':_0x5bfeb6};}}exports[a58_0x4f1bcb(0x263)]=ShopService;