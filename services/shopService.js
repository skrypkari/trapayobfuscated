'use strict';const a56_0x4255e9=a56_0x58ca;(function(_0x16e514,_0x45b062){const _0x282439=a56_0x58ca,_0x6965b3=_0x16e514();while(!![]){try{const _0xa29cf9=-parseInt(_0x282439(0x169))/0x1*(-parseInt(_0x282439(0x10b))/0x2)+-parseInt(_0x282439(0x10a))/0x3+-parseInt(_0x282439(0x181))/0x4*(-parseInt(_0x282439(0x11e))/0x5)+-parseInt(_0x282439(0x108))/0x6*(-parseInt(_0x282439(0x127))/0x7)+parseInt(_0x282439(0x150))/0x8+parseInt(_0x282439(0x173))/0x9+parseInt(_0x282439(0x142))/0xa*(-parseInt(_0x282439(0x161))/0xb);if(_0xa29cf9===_0x45b062)break;else _0x6965b3['push'](_0x6965b3['shift']());}catch(_0x13bbc4){_0x6965b3['push'](_0x6965b3['shift']());}}}(a56_0x986f,0xba8d7));function a56_0x58ca(_0x45b290,_0x4e4967){const _0x986f77=a56_0x986f();return a56_0x58ca=function(_0x58ca36,_0x46b685){_0x58ca36=_0x58ca36-0xd2;let _0x29bb56=_0x986f77[_0x58ca36];return _0x29bb56;},a56_0x58ca(_0x45b290,_0x4e4967);}var __importDefault=this&&this[a56_0x4255e9(0xfc)]||function(_0x3e2d0f){const _0x134028=a56_0x4255e9;return _0x3e2d0f&&_0x3e2d0f[_0x134028(0x147)]?_0x3e2d0f:{'default':_0x3e2d0f};};function a56_0x986f(){const _0x10bc66=['test_payment_123','all','statusCode','USDT\x20ERC20','5572539YFrsPl','toISOString','default','COMPLETED','gte','sourceCurrency','payment','maxPayments','findFirst','toUpperCase','\x20payout\x20statistics\x20calculated:','asc','REJECTED','KLYME\x20GB','92BUezde','getPayoutById','responseBody','gateway','txid','\x20\x20\x20üíµ\x20Available\x20balance:\x20','getFullYear','revenue','paymentService','üìÖ\x20Period\x20end:\x20','amountUSDT','./currencyService','createdAt','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','shop','üìä\x20Shop\x20','payout','polygon_usdc','Test\x20webhook\x20sent\x20successfully\x20(','log','30d','deletePayment','test_gateway','application/json','currencyService','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','map','network','round','usdtPolygonWallet','findMany','dailyRevenue','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','updateShopProfile','updatePayment','../config/database','amount','getPayoutStatistics','filter','\x20\x20\x20üìÖ\x20This\x20month:\x20','Webhook\x20returned\x20error:\x20','usdtErcWallet','gatewaySettings','__importDefault','currency','desc','üåê\x20Method\x20filter:\x20','convertToUSDT','test','trc20','notes','üìÖ\x20Date\x20end:\x20','\x20USDT','awaitingPayout','dailyPayments','49170PKcIsk','telegramId','105879YBerJy','14KjWNFg','üåê\x20Network\x20filter:\x20','reduce','PaymentService','paymentId','getWebhookLogs','usage','\x20USDT\x20(current\x20balance)','usdcPolygonWallet','getPayments','name','üìä\x20Status\x20filter:\x20','periodTo','Rapyd','Error\x20parsing\x20webhook\x20events:','getPaymentById','KLYME\x20DE','PAID','USDT\x20BSC','135205VchzFp','status','generateDailyStatistics','webhookUrl','balance','getDate','testWebhook','customerName','telegram','371weHvdg','shopUrl','merchantUrl','webhookLog','publicKey','Failed\x20to\x20send\x20webhook:\x20','KLYME\x20EU','USDT\x20TRC20','error','count','getShopPayoutStats','üìÖ\x20Date\x20start:\x20','expiresAt','\x20USDT\x20(total\x20payouts)','getPayoutStats','ShopService','üìÖ\x20Period\x20start:\x20','country','Payment\x20not\x20found','_sum','createPayment','gateways','customerEmail','push','usdtTrcWallet','Unknown\x20error','erc20','797470jpehxK','CoinToPay','Shop\x20not\x20found','PENDING','paidAt','__esModule','split','aggregate','90d','getTime','formatNetworkName','periodFrom','settings','wallets','2170568ITfboy','getShopProfile','üìä\x20Final\x20WHERE\x20conditions:','USDT\x20Polygon','amountIsEditable','username','event','fullName','webhookEvents','getGatewayDisplayName','getMonth','delete','test_order_123','findUnique','setHours','createPublicPayment','update','341yAhmOc','isArray','Noda','defineProperty','parse','redirectUrl','lte','Plisio','189257SLgfuN','stringify','thisMonth','customer','paymentGateways','ceil'];a56_0x986f=function(){return _0x10bc66;};return a56_0x986f();}Object[a56_0x4255e9(0x164)](exports,a56_0x4255e9(0x147),{'value':!![]}),exports[a56_0x4255e9(0x136)]=void 0x0;const database_1=__importDefault(require(a56_0x4255e9(0xf4))),currencyService_1=require(a56_0x4255e9(0xdc)),paymentService_1=require('./paymentService');class ShopService{constructor(){const _0x3212e6=a56_0x4255e9;this[_0x3212e6(0xd9)]=new paymentService_1[(_0x3212e6(0x10e))]();}async[a56_0x4255e9(0x151)](_0x282d25){const _0x38e4c3=a56_0x4255e9,_0xae3a28=await database_1[_0x38e4c3(0x175)][_0x38e4c3(0xdf)][_0x38e4c3(0x15d)]({'where':{'id':_0x282d25},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0xae3a28)throw new Error(_0x38e4c3(0x144));let _0x1af55c=[];if(_0xae3a28[_0x38e4c3(0x14e)]?.['webhookEvents'])try{_0x1af55c=Array[_0x38e4c3(0x162)](_0xae3a28[_0x38e4c3(0x14e)]['webhookEvents'])?_0xae3a28[_0x38e4c3(0x14e)][_0x38e4c3(0x158)]:JSON[_0x38e4c3(0x165)](_0xae3a28[_0x38e4c3(0x14e)][_0x38e4c3(0x158)]);}catch(_0x51e51b){console[_0x38e4c3(0x12f)](_0x38e4c3(0x119),_0x51e51b),_0x1af55c=[];}return{'id':_0xae3a28['id'],'fullName':_0xae3a28['name'],'username':_0xae3a28[_0x38e4c3(0x155)],'telegramId':_0xae3a28['telegram'],'merchantUrl':_0xae3a28['shopUrl'],'gateways':_0xae3a28['paymentGateways']?JSON[_0x38e4c3(0x165)](_0xae3a28[_0x38e4c3(0x16d)]):null,'gatewaySettings':_0xae3a28['gatewaySettings']?JSON[_0x38e4c3(0x165)](_0xae3a28[_0x38e4c3(0xfb)]):null,'publicKey':_0xae3a28[_0x38e4c3(0x12b)],'webhookUrl':_0xae3a28[_0x38e4c3(0x14e)]?.['webhookUrl']||null,'webhookEvents':_0x1af55c,'wallets':{'usdtPolygonWallet':_0xae3a28[_0x38e4c3(0xee)],'usdtTrcWallet':_0xae3a28[_0x38e4c3(0x13f)],'usdtErcWallet':_0xae3a28[_0x38e4c3(0xfa)],'usdcPolygonWallet':_0xae3a28[_0x38e4c3(0x113)]},'status':_0xae3a28[_0x38e4c3(0x11f)],'createdAt':_0xae3a28['createdAt']};}async[a56_0x4255e9(0xf2)](_0x20f183,_0x459414){const _0x384c1c=a56_0x4255e9,_0x28f216={};_0x459414['fullName']&&(_0x28f216[_0x384c1c(0x115)]=_0x459414[_0x384c1c(0x157)]);_0x459414[_0x384c1c(0x109)]!==undefined&&(_0x28f216[_0x384c1c(0x126)]=_0x459414[_0x384c1c(0x109)]||null);_0x459414['merchantUrl']&&(_0x28f216[_0x384c1c(0x128)]=_0x459414[_0x384c1c(0x129)]);_0x459414[_0x384c1c(0x13c)]&&(_0x28f216[_0x384c1c(0x16d)]=JSON[_0x384c1c(0x16a)](_0x459414[_0x384c1c(0x13c)]));_0x459414[_0x384c1c(0xfb)]&&(_0x28f216[_0x384c1c(0xfb)]=JSON[_0x384c1c(0x16a)](_0x459414[_0x384c1c(0xfb)]));_0x459414[_0x384c1c(0x14f)]&&(_0x459414[_0x384c1c(0x14f)][_0x384c1c(0xee)]!==undefined&&(_0x28f216[_0x384c1c(0xee)]=_0x459414[_0x384c1c(0x14f)]['usdtPolygonWallet']||null),_0x459414['wallets'][_0x384c1c(0x13f)]!==undefined&&(_0x28f216[_0x384c1c(0x13f)]=_0x459414[_0x384c1c(0x14f)][_0x384c1c(0x13f)]||null),_0x459414[_0x384c1c(0x14f)]['usdtErcWallet']!==undefined&&(_0x28f216[_0x384c1c(0xfa)]=_0x459414[_0x384c1c(0x14f)][_0x384c1c(0xfa)]||null),_0x459414[_0x384c1c(0x14f)][_0x384c1c(0x113)]!==undefined&&(_0x28f216[_0x384c1c(0x113)]=_0x459414['wallets'][_0x384c1c(0x113)]||null));const _0x45d5a3=await database_1[_0x384c1c(0x175)]['shop'][_0x384c1c(0x160)]({'where':{'id':_0x20f183},'data':_0x28f216,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x13325d=[];if(_0x45d5a3['settings']?.['webhookEvents'])try{_0x13325d=Array['isArray'](_0x45d5a3[_0x384c1c(0x14e)][_0x384c1c(0x158)])?_0x45d5a3[_0x384c1c(0x14e)][_0x384c1c(0x158)]:JSON[_0x384c1c(0x165)](_0x45d5a3[_0x384c1c(0x14e)][_0x384c1c(0x158)]);}catch(_0x3426a8){console[_0x384c1c(0x12f)](_0x384c1c(0x119),_0x3426a8),_0x13325d=[];}return{'id':_0x45d5a3['id'],'fullName':_0x45d5a3['name'],'username':_0x45d5a3[_0x384c1c(0x155)],'telegramId':_0x45d5a3[_0x384c1c(0x126)],'merchantUrl':_0x45d5a3[_0x384c1c(0x128)],'gateways':_0x45d5a3[_0x384c1c(0x16d)]?JSON[_0x384c1c(0x165)](_0x45d5a3[_0x384c1c(0x16d)]):null,'gatewaySettings':_0x45d5a3[_0x384c1c(0xfb)]?JSON[_0x384c1c(0x165)](_0x45d5a3[_0x384c1c(0xfb)]):null,'publicKey':_0x45d5a3['publicKey'],'webhookUrl':_0x45d5a3[_0x384c1c(0x14e)]?.[_0x384c1c(0x121)]||null,'webhookEvents':_0x13325d,'wallets':{'usdtPolygonWallet':_0x45d5a3['usdtPolygonWallet'],'usdtTrcWallet':_0x45d5a3[_0x384c1c(0x13f)],'usdtErcWallet':_0x45d5a3[_0x384c1c(0xfa)],'usdcPolygonWallet':_0x45d5a3[_0x384c1c(0x113)]},'status':_0x45d5a3[_0x384c1c(0x11f)],'createdAt':_0x45d5a3[_0x384c1c(0xdd)]};}async['updateWallets'](_0x55ba8c,_0x5f4da0){const _0x14d1cc=a56_0x4255e9,_0x2dd63c={};_0x5f4da0[_0x14d1cc(0xee)]!==undefined&&(_0x2dd63c[_0x14d1cc(0xee)]=_0x5f4da0[_0x14d1cc(0xee)]||null),_0x5f4da0[_0x14d1cc(0x13f)]!==undefined&&(_0x2dd63c['usdtTrcWallet']=_0x5f4da0['usdtTrcWallet']||null),_0x5f4da0[_0x14d1cc(0xfa)]!==undefined&&(_0x2dd63c['usdtErcWallet']=_0x5f4da0[_0x14d1cc(0xfa)]||null),_0x5f4da0[_0x14d1cc(0x113)]!==undefined&&(_0x2dd63c[_0x14d1cc(0x113)]=_0x5f4da0[_0x14d1cc(0x113)]||null),await database_1[_0x14d1cc(0x175)][_0x14d1cc(0xdf)][_0x14d1cc(0x160)]({'where':{'id':_0x55ba8c},'data':_0x2dd63c});}async[a56_0x4255e9(0x124)](_0xb778f9){const _0x48e235=a56_0x4255e9,_0x50abd2=await database_1[_0x48e235(0x175)]['shop'][_0x48e235(0x15d)]({'where':{'id':_0xb778f9},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x50abd2?.[_0x48e235(0x14e)]?.['webhookUrl'])throw new Error('No\x20webhook\x20URL\x20configured');const _0x5d2b3d={'event':_0x48e235(0x101),'payment':{'id':_0x48e235(0x16f),'order_id':_0x48e235(0x15c),'gateway':'test','amount':0x64,'currency':'USD','status':'paid','created_at':new Date()[_0x48e235(0x174)]()}};try{const _0x3a7f09=await fetch(_0x50abd2['settings'][_0x48e235(0x121)],{'method':'POST','headers':{'Content-Type':_0x48e235(0xe8),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON['stringify'](_0x5d2b3d)});return _0x3a7f09['ok']?{'success':!![],'message':_0x48e235(0xe3)+_0x3a7f09[_0x48e235(0x11f)]+')'}:{'success':![],'message':_0x48e235(0xf9)+_0x3a7f09['status']+'\x20'+_0x3a7f09['statusText']};}catch(_0x492473){return{'success':![],'message':_0x48e235(0x12c)+(_0x492473 instanceof Error?_0x492473['message']:_0x48e235(0x140))};}}async[a56_0x4255e9(0x13b)](_0x30c458){const _0x396f99=a56_0x4255e9;return this['paymentService'][_0x396f99(0x15f)]({'public_key':'','gateway':_0x30c458['gateway'],'order_id':undefined,'amount':_0x30c458[_0x396f99(0xf5)],'currency':_0x30c458['currency'],'source_currency':_0x30c458[_0x396f99(0x178)],'usage':_0x30c458[_0x396f99(0x111)],'expires_at':_0x30c458[_0x396f99(0x133)]?.[_0x396f99(0x174)](),'success_url':_0x30c458['redirectUrl'],'fail_url':_0x30c458[_0x396f99(0x166)],'customer_email':_0x30c458[_0x396f99(0x13d)],'customer_name':_0x30c458[_0x396f99(0x125)],'country':_0x30c458[_0x396f99(0x138)],'language':_0x30c458['language'],'amount_is_editable':_0x30c458[_0x396f99(0x154)],'max_payments':_0x30c458[_0x396f99(0x17a)],'customer':_0x30c458[_0x396f99(0x16c)]});}async[a56_0x4255e9(0x114)](_0x193835,_0x610e65){const _0x592b21=a56_0x4255e9;return this[_0x592b21(0xd9)]['getPaymentsByShop'](_0x193835,_0x610e65);}async[a56_0x4255e9(0x11a)](_0x80a57c,_0x4247db){const _0x524873=a56_0x4255e9;return this[_0x524873(0xd9)]['getPaymentByShopAndId'](_0x80a57c,_0x4247db);}async[a56_0x4255e9(0xf3)](_0x476829,_0x120f69,_0x593e6f){const _0x577a41=a56_0x4255e9,_0x5ccb1c=await database_1[_0x577a41(0x175)][_0x577a41(0x179)][_0x577a41(0x17b)]({'where':{'id':_0x120f69,'shopId':_0x476829}});if(!_0x5ccb1c)throw new Error(_0x577a41(0x139));const _0x37c356=await database_1[_0x577a41(0x175)][_0x577a41(0x179)][_0x577a41(0x160)]({'where':{'id':_0x120f69},'data':{..._0x593e6f,'updatedAt':new Date()}});return _0x37c356;}async[a56_0x4255e9(0xe6)](_0x44a5b7,_0x33cabc){const _0x1137b2=a56_0x4255e9,_0x179576=await database_1[_0x1137b2(0x175)][_0x1137b2(0x179)][_0x1137b2(0x17b)]({'where':{'id':_0x33cabc,'shopId':_0x44a5b7}});if(!_0x179576)throw new Error(_0x1137b2(0x139));await database_1[_0x1137b2(0x175)][_0x1137b2(0x179)][_0x1137b2(0x15b)]({'where':{'id':_0x33cabc}});}[a56_0x4255e9(0x14c)](_0x2fc2a9){const _0x2b7057=a56_0x4255e9,_0x5163f7={'polygon':_0x2b7057(0x153),'trc20':_0x2b7057(0x12e),'erc20':_0x2b7057(0x172),'bsc':_0x2b7057(0x11d),'polygon_usdc':'USDC\x20Polygon'};return _0x5163f7[_0x2fc2a9]||_0x2fc2a9;}async['getPayouts'](_0x1b2c95,_0x24cbf2){const _0x4e39e5=a56_0x4255e9,{page:_0x48d13c,limit:_0xc78b3b,status:_0x4e32c7,method:_0x41c04b,network:_0x3f91ec,dateFrom:_0xbf609b,dateTo:_0xc182fa,periodFrom:_0x2db5b5,periodTo:_0x29d277}=_0x24cbf2,_0x4e3eb6=(_0x48d13c-0x1)*_0xc78b3b;console[_0x4e39e5(0xe4)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x24cbf2);const _0x252082={'shopId':_0x1b2c95};_0x4e32c7&&(_0x252082['status']=_0x4e32c7[_0x4e39e5(0x17c)](),console[_0x4e39e5(0xe4)](_0x4e39e5(0x116)+_0x4e32c7['toUpperCase']()));if(_0x41c04b)_0x252082['network']=_0x41c04b,console['log'](_0x4e39e5(0xff)+_0x41c04b);else _0x3f91ec&&(_0x252082['network']=_0x3f91ec,console[_0x4e39e5(0xe4)](_0x4e39e5(0x10c)+_0x3f91ec));if(_0xbf609b||_0xc182fa||_0x2db5b5||_0x29d277){_0x252082[_0x4e39e5(0xdd)]={};if(_0x2db5b5){const _0x29154c=new Date(_0x2db5b5);_0x29154c[_0x4e39e5(0x15e)](0x0,0x0,0x0,0x0),_0x252082[_0x4e39e5(0xdd)][_0x4e39e5(0x177)]=_0x29154c,console[_0x4e39e5(0xe4)](_0x4e39e5(0x137)+_0x29154c[_0x4e39e5(0x174)]());}else{if(_0xbf609b){const _0x206bab=new Date(_0xbf609b);_0x206bab[_0x4e39e5(0x15e)](0x0,0x0,0x0,0x0),_0x252082[_0x4e39e5(0xdd)][_0x4e39e5(0x177)]=_0x206bab,console[_0x4e39e5(0xe4)](_0x4e39e5(0x132)+_0x206bab[_0x4e39e5(0x174)]());}}if(_0x29d277){const _0x199c37=new Date(_0x29d277);_0x199c37[_0x4e39e5(0x15e)](0x17,0x3b,0x3b,0x3e7),_0x252082[_0x4e39e5(0xdd)][_0x4e39e5(0x167)]=_0x199c37,console[_0x4e39e5(0xe4)](_0x4e39e5(0xda)+_0x199c37[_0x4e39e5(0x174)]());}else{if(_0xc182fa){const _0x3e9395=new Date(_0xc182fa);_0x3e9395[_0x4e39e5(0x15e)](0x17,0x3b,0x3b,0x3e7),_0x252082['createdAt'][_0x4e39e5(0x167)]=_0x3e9395,console['log'](_0x4e39e5(0x104)+_0x3e9395[_0x4e39e5(0x174)]());}}}console[_0x4e39e5(0xe4)](_0x4e39e5(0x152),JSON['stringify'](_0x252082,null,0x2));const [_0x5c105e,_0x5768df]=await Promise[_0x4e39e5(0x170)]([database_1['default'][_0x4e39e5(0xe1)][_0x4e39e5(0xef)]({'where':_0x252082,'skip':_0x4e3eb6,'take':_0xc78b3b,'orderBy':{'createdAt':_0x4e39e5(0xfe)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x4e39e5(0x175)][_0x4e39e5(0xe1)][_0x4e39e5(0x130)]({'where':_0x252082})]);return{'payouts':_0x5c105e['map'](_0x5d2eda=>{const _0x31f09c=_0x4e39e5;let _0x39c74e=null;switch(_0x5d2eda['network']){case'polygon':_0x39c74e=_0x5d2eda[_0x31f09c(0xdf)][_0x31f09c(0xee)];break;case _0x31f09c(0x102):_0x39c74e=_0x5d2eda['shop'][_0x31f09c(0x13f)];break;case _0x31f09c(0x141):_0x39c74e=_0x5d2eda[_0x31f09c(0xdf)][_0x31f09c(0xfa)];break;case _0x31f09c(0xe2):_0x39c74e=_0x5d2eda[_0x31f09c(0xdf)]['usdcPolygonWallet'];break;}return{'id':_0x5d2eda['id'],'amount':_0x5d2eda[_0x31f09c(0xf5)],'network':this[_0x31f09c(0x14c)](_0x5d2eda['network']),'wallet':_0x39c74e,'status':_0x5d2eda['status'],'txid':_0x5d2eda['txid'],'notes':_0x5d2eda[_0x31f09c(0x103)],'periodFrom':_0x5d2eda[_0x31f09c(0x14d)],'periodTo':_0x5d2eda[_0x31f09c(0x117)],'createdAt':_0x5d2eda[_0x31f09c(0xdd)],'paidAt':_0x5d2eda[_0x31f09c(0x146)]};}),'pagination':{'page':_0x48d13c,'limit':_0xc78b3b,'total':_0x5768df,'totalPages':Math['ceil'](_0x5768df/_0xc78b3b)}};}async[a56_0x4255e9(0xd2)](_0x584fd1,_0x2b2382){const _0x40e876=a56_0x4255e9,_0x3a2753=await database_1['default'][_0x40e876(0xe1)][_0x40e876(0x17b)]({'where':{'id':_0x2b2382,'shopId':_0x584fd1}});if(!_0x3a2753)return null;return{'id':_0x3a2753['id'],'amount':_0x3a2753[_0x40e876(0xf5)],'network':_0x3a2753['network'],'status':_0x3a2753[_0x40e876(0x11f)],'txid':_0x3a2753[_0x40e876(0xd5)],'notes':_0x3a2753[_0x40e876(0x103)],'createdAt':_0x3a2753['createdAt'],'paidAt':_0x3a2753[_0x40e876(0x146)]};}async[a56_0x4255e9(0xf6)](_0x43c30f,_0x231109){const _0x461f3a=a56_0x4255e9,_0x292a4f=new Date();let _0x317125;switch(_0x231109){case'7d':_0x317125=new Date(_0x292a4f[_0x461f3a(0x14b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x461f3a(0xe5):_0x317125=new Date(_0x292a4f[_0x461f3a(0x14b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x461f3a(0x14a):_0x317125=new Date(_0x292a4f[_0x461f3a(0x14b)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x317125=new Date(_0x292a4f[_0x461f3a(0x14b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2b3581,_0x174e70,_0x13bf26,_0x249aab,_0x3f1b9b,_0x34bee2]=await Promise['all']([database_1[_0x461f3a(0x175)]['payout'][_0x461f3a(0x130)]({'where':{'shopId':_0x43c30f,'createdAt':{'gte':_0x317125}}}),database_1[_0x461f3a(0x175)]['payout'][_0x461f3a(0x130)]({'where':{'shopId':_0x43c30f,'status':'COMPLETED','createdAt':{'gte':_0x317125}}}),database_1[_0x461f3a(0x175)][_0x461f3a(0xe1)][_0x461f3a(0x130)]({'where':{'shopId':_0x43c30f,'status':_0x461f3a(0x145),'createdAt':{'gte':_0x317125}}}),database_1['default'][_0x461f3a(0xe1)][_0x461f3a(0x130)]({'where':{'shopId':_0x43c30f,'status':_0x461f3a(0x17f),'createdAt':{'gte':_0x317125}}}),database_1[_0x461f3a(0x175)][_0x461f3a(0xe1)][_0x461f3a(0xef)]({'where':{'shopId':_0x43c30f,'createdAt':{'gte':_0x317125}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x461f3a(0x175)]['payout']['findMany']({'where':{'shopId':_0x43c30f},'take':0xa,'orderBy':{'createdAt':_0x461f3a(0xfe)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x56022d=_0x3f1b9b[_0x461f3a(0x10d)]((_0x49e5a9,_0xa9a679)=>_0x49e5a9+_0xa9a679[_0x461f3a(0xf5)],0x0),_0x174862=_0x3f1b9b[_0x461f3a(0xf7)](_0x4ac5c0=>_0x4ac5c0['status']===_0x461f3a(0x176))[_0x461f3a(0x10d)]((_0x3d337c,_0x579231)=>_0x3d337c+_0x579231[_0x461f3a(0xf5)],0x0),_0xeba614=_0x3f1b9b[_0x461f3a(0xf7)](_0x5a4ad8=>_0x5a4ad8['status']==='PENDING')['reduce']((_0x2a528e,_0x37c1a5)=>_0x2a528e+_0x37c1a5[_0x461f3a(0xf5)],0x0),_0x3a21ac=_0x3f1b9b['reduce']((_0x23da16,_0x3715a3)=>{const _0x2f3da8=_0x461f3a;return _0x23da16[_0x3715a3['network']]=(_0x23da16[_0x3715a3[_0x2f3da8(0xec)]]||0x0)+0x1,_0x23da16;},{}),_0x14763e=_0x3f1b9b['reduce']((_0x4e5034,_0x432b16)=>{const _0x4bcdd0=_0x461f3a;return _0x4e5034[_0x432b16[_0x4bcdd0(0x11f)]]=(_0x4e5034[_0x432b16['status']]||0x0)+0x1,_0x4e5034;},{});return{'totalPayouts':_0x2b3581,'completedPayouts':_0x174e70,'pendingPayouts':_0x13bf26,'rejectedPayouts':_0x249aab,'totalAmount':_0x56022d,'completedAmount':_0x174862,'pendingAmount':_0xeba614,'payoutsByMethod':_0x3a21ac,'payoutsByStatus':_0x14763e,'recentPayouts':_0x34bee2['map'](_0x31799c=>({'id':_0x31799c['id'],'shopId':_0x43c30f,'amount':_0x31799c[_0x461f3a(0xf5)],'method':_0x31799c['network'],'status':_0x31799c[_0x461f3a(0x11f)],'txid':_0x31799c[_0x461f3a(0xd5)],'createdAt':_0x31799c[_0x461f3a(0xdd)],'paidAt':_0x31799c[_0x461f3a(0x146)]}))};}async['getShopPayoutStats'](_0x4d30b3){const _0x5853c7=a56_0x4255e9;console[_0x5853c7(0xe4)](_0x5853c7(0xf1)+_0x4d30b3+'...');const _0x2f776e=await database_1['default'][_0x5853c7(0xdf)][_0x5853c7(0x15d)]({'where':{'id':_0x4d30b3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2f776e)throw new Error('Shop\x20not\x20found');const _0xd65c3=new Date(),_0x26cbc6=new Date(_0xd65c3[_0x5853c7(0xd7)](),_0xd65c3[_0x5853c7(0x15a)](),0x1),_0x292cc0=new Date(_0xd65c3[_0x5853c7(0xd7)](),_0xd65c3[_0x5853c7(0x15a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3525bc=await database_1[_0x5853c7(0x175)]['payout'][_0x5853c7(0x149)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4d30b3,'createdAt':{'gte':_0x26cbc6,'lte':_0x292cc0},'status':_0x5853c7(0x176)}}),_0x6aa607=_0x3525bc[_0x5853c7(0x13a)][_0x5853c7(0xf5)]||0x0,_0x28f2ae={'availableBalance':Math['round'](_0x2f776e[_0x5853c7(0x122)]*0x64)/0x64,'totalPaidOut':Math[_0x5853c7(0xed)](_0x2f776e['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math['round'](_0x2f776e[_0x5853c7(0x122)]*0x64)/0x64,'thisMonth':Math[_0x5853c7(0xed)](_0x6aa607*0x64)/0x64};return console['log'](_0x5853c7(0xe0)+_0x2f776e['username']+_0x5853c7(0x17d)),console['log'](_0x5853c7(0xd6)+_0x28f2ae['availableBalance']+'\x20USDT\x20(current\x20balance)'),console[_0x5853c7(0xe4)](_0x5853c7(0xde)+_0x28f2ae['totalPaidOut']+_0x5853c7(0x134)),console[_0x5853c7(0xe4)](_0x5853c7(0xea)+_0x28f2ae[_0x5853c7(0x106)]+_0x5853c7(0x112)),console[_0x5853c7(0xe4)](_0x5853c7(0xf8)+_0x28f2ae[_0x5853c7(0x16b)]+_0x5853c7(0x105)),_0x28f2ae;}[a56_0x4255e9(0x159)](_0x41e8b1){const _0xeb277d=a56_0x4255e9,_0x13c82c={'test_gateway':'Test\x20Gateway','plisio':_0xeb277d(0x168),'rapyd':_0xeb277d(0x118),'noda':_0xeb277d(0x163),'cointopay':_0xeb277d(0x143),'klyme_eu':_0xeb277d(0x12d),'klyme_gb':_0xeb277d(0x180),'klyme_de':_0xeb277d(0x11b)};return _0x13c82c[_0x41e8b1]||_0x41e8b1;}async[a56_0x4255e9(0x135)](_0x319f1b){const _0x2c7638=a56_0x4255e9;return this[_0x2c7638(0x131)](_0x319f1b);}async[a56_0x4255e9(0x110)](_0x35dcf5,_0x1cb9dd){const _0x1cb352=a56_0x4255e9,{page:_0x127da7,limit:_0x1f6507,paymentId:_0x3251fc}=_0x1cb9dd,_0x32ff33=(_0x127da7-0x1)*_0x1f6507,_0x398f70={'shopId':_0x35dcf5};_0x3251fc&&(_0x398f70[_0x1cb352(0x10f)]=_0x3251fc);const [_0x532d16,_0x2d6c22]=await Promise[_0x1cb352(0x170)]([database_1[_0x1cb352(0x175)]['webhookLog'][_0x1cb352(0xef)]({'where':_0x398f70,'skip':_0x32ff33,'take':_0x1f6507,'orderBy':{'createdAt':_0x1cb352(0xfe)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x1cb352(0x12a)]['count']({'where':_0x398f70})]);return{'logs':_0x532d16[_0x1cb352(0xeb)](_0x544d30=>({'id':_0x544d30['id'],'paymentId':_0x544d30['paymentId'],'shopId':_0x544d30['shopId'],'event':_0x544d30[_0x1cb352(0x156)],'statusCode':_0x544d30[_0x1cb352(0x171)],'retryCount':_0x544d30['retryCount'],'responseBody':_0x544d30[_0x1cb352(0xd3)],'createdAt':_0x544d30[_0x1cb352(0xdd)],'payment':_0x544d30['payment']})),'pagination':{'page':_0x127da7,'limit':_0x1f6507,'total':_0x2d6c22,'totalPages':Math[_0x1cb352(0x16e)](_0x2d6c22/_0x1f6507)}};}async['getStatistics'](_0xae4a94,_0x2fb23e){const _0x49cff2=a56_0x4255e9,_0x3a3b7a=new Date();let _0xf4c51a;switch(_0x2fb23e){case'7d':_0xf4c51a=new Date(_0x3a3b7a[_0x49cff2(0x14b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x49cff2(0xe5):_0xf4c51a=new Date(_0x3a3b7a['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x49cff2(0x14a):_0xf4c51a=new Date(_0x3a3b7a[_0x49cff2(0x14b)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xf4c51a=new Date(_0x3a3b7a['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x507c86,_0x6e613c,_0x5dd818,_0x1dad22,_0x44b06a]=await Promise['all']([database_1[_0x49cff2(0x175)][_0x49cff2(0x179)][_0x49cff2(0x130)]({'where':{'shopId':_0xae4a94,'gateway':{'not':_0x49cff2(0xe7)},'createdAt':{'gte':_0xf4c51a}}}),database_1[_0x49cff2(0x175)][_0x49cff2(0x179)][_0x49cff2(0x130)]({'where':{'shopId':_0xae4a94,'gateway':{'not':_0x49cff2(0xe7)},'status':_0x49cff2(0x11c),'createdAt':{'gte':_0xf4c51a}}}),database_1[_0x49cff2(0x175)][_0x49cff2(0x179)][_0x49cff2(0xef)]({'where':{'shopId':_0xae4a94,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0xf4c51a}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x49cff2(0x175)][_0x49cff2(0x179)][_0x49cff2(0xef)]({'where':{'shopId':_0xae4a94,'gateway':{'not':_0x49cff2(0xe7)}},'take':0xa,'orderBy':{'createdAt':_0x49cff2(0xfe)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x49cff2(0x175)][_0x49cff2(0x179)]['findMany']({'where':{'shopId':_0xae4a94,'gateway':{'not':_0x49cff2(0xe7)},'createdAt':{'gte':_0xf4c51a}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x49cff2(0x17e)}})]);let _0x247df5=0x0;for(const _0xd66820 of _0x5dd818){if(_0xd66820['amountUSDT'])_0x247df5+=_0xd66820[_0x49cff2(0xdb)];else{const _0x2c46a4=await currencyService_1[_0x49cff2(0xe9)][_0x49cff2(0x100)](_0xd66820['amount'],_0xd66820[_0x49cff2(0xfd)]);_0x247df5+=_0x2c46a4;}}const _0x26c43c=this[_0x49cff2(0x120)](_0x44b06a,_0xf4c51a,_0x3a3b7a),_0x267fbb=_0x507c86>0x0?_0x6e613c/_0x507c86*0x64:0x0;return{'totalPayments':_0x507c86,'successfulPayments':_0x6e613c,'totalRevenue':Math[_0x49cff2(0xed)](_0x247df5*0x64)/0x64,'conversionRate':Math[_0x49cff2(0xed)](_0x267fbb*0x64)/0x64,'dailyRevenue':_0x26c43c[_0x49cff2(0xf0)],'dailyPayments':_0x26c43c[_0x49cff2(0x107)],'recentPayments':_0x1dad22[_0x49cff2(0xeb)](_0x5cef48=>({'id':_0x5cef48['id'],'gateway':_0x5cef48[_0x49cff2(0xd4)],'amount':_0x5cef48['amount'],'currency':_0x5cef48[_0x49cff2(0xfd)],'status':_0x5cef48['status'],'createdAt':_0x5cef48[_0x49cff2(0xdd)]}))};}[a56_0x4255e9(0x120)](_0x3406ff,_0x27d797,_0x28c7d7){const _0x149b07=a56_0x4255e9,_0x23548d=new Map(),_0x230249=new Date(_0x27d797);while(_0x230249<=_0x28c7d7){const _0x22225a=_0x230249['toISOString']()['split']('T')[0x0];_0x23548d['set'](_0x22225a,{'revenue':0x0,'count':0x0}),_0x230249['setDate'](_0x230249[_0x149b07(0x123)]()+0x1);}for(const _0x2e5151 of _0x3406ff){const _0x46654b=_0x2e5151[_0x149b07(0xdd)][_0x149b07(0x174)]()[_0x149b07(0x148)]('T')[0x0],_0x40c014=_0x23548d['get'](_0x46654b);_0x40c014&&(_0x40c014[_0x149b07(0x130)]+=0x1,_0x2e5151['status']==='PAID'&&_0x2e5151[_0x149b07(0xdb)]&&(_0x40c014[_0x149b07(0xd8)]+=_0x2e5151[_0x149b07(0xdb)]));}const _0x5eed69=[],_0x6c98f6=[];for(const [_0x611780,_0x3f408f]of _0x23548d){_0x5eed69[_0x149b07(0x13e)]({'date':_0x611780,'amount':Math[_0x149b07(0xed)](_0x3f408f[_0x149b07(0xd8)]*0x64)/0x64}),_0x6c98f6[_0x149b07(0x13e)]({'date':_0x611780,'count':_0x3f408f[_0x149b07(0x130)]});}return{'dailyRevenue':_0x5eed69,'dailyPayments':_0x6c98f6};}}exports[a56_0x4255e9(0x136)]=ShopService;