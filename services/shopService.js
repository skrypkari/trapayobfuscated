'use strict';const a53_0x220efb=a53_0x14ca;(function(_0x3f0de2,_0x3dd367){const _0x3849a5=a53_0x14ca,_0xad78af=_0x3f0de2();while(!![]){try{const _0x4b7cda=parseInt(_0x3849a5(0x14c))/0x1+parseInt(_0x3849a5(0x196))/0x2+parseInt(_0x3849a5(0x1c0))/0x3+-parseInt(_0x3849a5(0x18b))/0x4*(parseInt(_0x3849a5(0x1c2))/0x5)+-parseInt(_0x3849a5(0x175))/0x6*(parseInt(_0x3849a5(0x190))/0x7)+-parseInt(_0x3849a5(0x177))/0x8*(-parseInt(_0x3849a5(0x14e))/0x9)+-parseInt(_0x3849a5(0x1a0))/0xa*(-parseInt(_0x3849a5(0x1b1))/0xb);if(_0x4b7cda===_0x3dd367)break;else _0xad78af['push'](_0xad78af['shift']());}catch(_0x284803){_0xad78af['push'](_0xad78af['shift']());}}}(a53_0x578b,0xdd792));var __importDefault=this&&this['__importDefault']||function(_0x3741a1){const _0x228586=a53_0x14ca;return _0x3741a1&&_0x3741a1[_0x228586(0x1a6)]?_0x3741a1:{'default':_0x3741a1};};function a53_0x14ca(_0x1182af,_0x5e621b){const _0x578bba=a53_0x578b();return a53_0x14ca=function(_0x14cae4,_0x62b93b){_0x14cae4=_0x14cae4-0x12f;let _0x310d69=_0x578bba[_0x14cae4];return _0x310d69;},a53_0x14ca(_0x1182af,_0x5e621b);}Object['defineProperty'](exports,a53_0x220efb(0x1a6),{'value':!![]}),exports[a53_0x220efb(0x14b)]=void 0x0;const database_1=__importDefault(require(a53_0x220efb(0x1aa))),currencyService_1=require(a53_0x220efb(0x140)),paymentService_1=require(a53_0x220efb(0x13b));function a53_0x578b(){const _0xf2033e=['paymentId','90d','getPaymentByShopAndId','PAID','telegramId','REJECTED','CoinToPay','toISOString','updatePayment','customerEmail','Failed\x20to\x20send\x20webhook:\x20','map','publicKey','application/json','settings','telegram','payment','\x20USDT','30d','language','webhookUrl','amount','retryCount','auto_','revenue','updateWallets','\x20USDT\x20(total\x20payouts)','6kxSoqL','webhookEvents','128DZUaiU','amountUSDT','PENDING','availableBalance','balance','customerName','log','createdAt','test_gateway','awaitingPayout','default','gatewaySettings','Unknown\x20error','paymentGateways','payout','findUnique','paymentService','ceil','update','Plisio','31556meiDiZ','redirectUrl','paidAt','Payment\x20not\x20found','wallets','12311089kcCszF','Webhook\x20returned\x20error:\x20','createPublicPayment','Test\x20Gateway','getTime','count','1810016iKPsxg','set','delete','random','totalPaidOut','round','usdtErcWallet','KLYME\x20DE','getPayouts','network','30xRXhjS','substr','usdtTrcWallet','shop','shopId','currency','__esModule','reduce','getPayoutById','test_order_123','../config/database','stringify','generateDailyStatistics','gateways','maxPayments','get','gte','26301hGLuPs','getWebhookLogs','paid','getShopProfile','desc','country','Shop\x20not\x20found','getMonth','split','getGatewayDisplayName','toString','all','findFirst','gateway','statusCode','5200896JjVcfJ','setDate','715IUCLpl','COMPLETED','customer','getShopPayoutStats','aggregate','getPayments','createPayment','findMany','statusText','parse','getPaymentsByShop','status','testWebhook','No\x20webhook\x20URL\x20configured','usage','USD','expiresAt','Rapyd','asc','push','now','./paymentService','error','Error\x20parsing\x20webhook\x20events:','notes','thisMonth','./currencyService','username','merchantUrl','\x20\x20\x20💰\x20Total\x20paid\x20out:\x20','fullName','test','PaymentService','usdcPolygonWallet','getFullYear','txid','getPaymentById','ShopService','906819rXSBWN','webhookLog','135774vBdSah','_sum','getDate','...','name','Test\x20webhook\x20sent\x20successfully\x20(','TesSoft\x20Payment\x20System/1.0\x20(Test)','deletePayment','amountIsEditable','shopUrl','isArray','usdtPolygonWallet'];a53_0x578b=function(){return _0xf2033e;};return a53_0x578b();}class ShopService{constructor(){const _0x24ea6a=a53_0x220efb;this[_0x24ea6a(0x187)]=new paymentService_1[(_0x24ea6a(0x146))]();}async[a53_0x220efb(0x1b4)](_0x2d17ce){const _0x5c98fe=a53_0x220efb,_0x46e002=await database_1['default'][_0x5c98fe(0x1a3)][_0x5c98fe(0x186)]({'where':{'id':_0x2d17ce},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x46e002)throw new Error(_0x5c98fe(0x1b7));let _0x397864=[];if(_0x46e002[_0x5c98fe(0x168)]?.['webhookEvents'])try{_0x397864=Array[_0x5c98fe(0x158)](_0x46e002[_0x5c98fe(0x168)][_0x5c98fe(0x176)])?_0x46e002[_0x5c98fe(0x168)][_0x5c98fe(0x176)]:JSON[_0x5c98fe(0x12f)](_0x46e002['settings'][_0x5c98fe(0x176)]);}catch(_0x4e21d8){console[_0x5c98fe(0x13c)](_0x5c98fe(0x13d),_0x4e21d8),_0x397864=[];}return{'id':_0x46e002['id'],'fullName':_0x46e002[_0x5c98fe(0x152)],'username':_0x46e002['username'],'telegramId':_0x46e002[_0x5c98fe(0x169)],'merchantUrl':_0x46e002[_0x5c98fe(0x157)],'gateways':_0x46e002[_0x5c98fe(0x184)]?JSON[_0x5c98fe(0x12f)](_0x46e002[_0x5c98fe(0x184)]):null,'gatewaySettings':_0x46e002[_0x5c98fe(0x182)]?JSON[_0x5c98fe(0x12f)](_0x46e002['gatewaySettings']):null,'publicKey':_0x46e002[_0x5c98fe(0x166)],'webhookUrl':_0x46e002[_0x5c98fe(0x168)]?.['webhookUrl']||null,'webhookEvents':_0x397864,'wallets':{'usdtPolygonWallet':_0x46e002['usdtPolygonWallet'],'usdtTrcWallet':_0x46e002[_0x5c98fe(0x1a2)],'usdtErcWallet':_0x46e002[_0x5c98fe(0x19c)],'usdcPolygonWallet':_0x46e002[_0x5c98fe(0x147)]},'status':_0x46e002['status'],'createdAt':_0x46e002['createdAt']};}async['updateShopProfile'](_0x20613d,_0x21bab9){const _0x2cb95c=a53_0x220efb,_0x16b483={};_0x21bab9[_0x2cb95c(0x144)]&&(_0x16b483[_0x2cb95c(0x152)]=_0x21bab9[_0x2cb95c(0x144)]);_0x21bab9[_0x2cb95c(0x15e)]!==undefined&&(_0x16b483[_0x2cb95c(0x169)]=_0x21bab9[_0x2cb95c(0x15e)]||null);_0x21bab9['merchantUrl']&&(_0x16b483[_0x2cb95c(0x157)]=_0x21bab9[_0x2cb95c(0x142)]);_0x21bab9[_0x2cb95c(0x1ad)]&&(_0x16b483[_0x2cb95c(0x184)]=JSON[_0x2cb95c(0x1ab)](_0x21bab9[_0x2cb95c(0x1ad)]));_0x21bab9[_0x2cb95c(0x182)]&&(_0x16b483[_0x2cb95c(0x182)]=JSON[_0x2cb95c(0x1ab)](_0x21bab9['gatewaySettings']));_0x21bab9[_0x2cb95c(0x18f)]&&(_0x21bab9['wallets'][_0x2cb95c(0x159)]!==undefined&&(_0x16b483['usdtPolygonWallet']=_0x21bab9[_0x2cb95c(0x18f)][_0x2cb95c(0x159)]||null),_0x21bab9[_0x2cb95c(0x18f)]['usdtTrcWallet']!==undefined&&(_0x16b483['usdtTrcWallet']=_0x21bab9[_0x2cb95c(0x18f)][_0x2cb95c(0x1a2)]||null),_0x21bab9[_0x2cb95c(0x18f)][_0x2cb95c(0x19c)]!==undefined&&(_0x16b483['usdtErcWallet']=_0x21bab9[_0x2cb95c(0x18f)]['usdtErcWallet']||null),_0x21bab9[_0x2cb95c(0x18f)][_0x2cb95c(0x147)]!==undefined&&(_0x16b483[_0x2cb95c(0x147)]=_0x21bab9[_0x2cb95c(0x18f)][_0x2cb95c(0x147)]||null));const _0x383064=await database_1[_0x2cb95c(0x181)][_0x2cb95c(0x1a3)]['update']({'where':{'id':_0x20613d},'data':_0x16b483,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x31fe62=[];if(_0x383064[_0x2cb95c(0x168)]?.[_0x2cb95c(0x176)])try{_0x31fe62=Array['isArray'](_0x383064['settings'][_0x2cb95c(0x176)])?_0x383064[_0x2cb95c(0x168)][_0x2cb95c(0x176)]:JSON[_0x2cb95c(0x12f)](_0x383064[_0x2cb95c(0x168)][_0x2cb95c(0x176)]);}catch(_0xd45825){console[_0x2cb95c(0x13c)](_0x2cb95c(0x13d),_0xd45825),_0x31fe62=[];}return{'id':_0x383064['id'],'fullName':_0x383064[_0x2cb95c(0x152)],'username':_0x383064[_0x2cb95c(0x141)],'telegramId':_0x383064[_0x2cb95c(0x169)],'merchantUrl':_0x383064[_0x2cb95c(0x157)],'gateways':_0x383064[_0x2cb95c(0x184)]?JSON['parse'](_0x383064['paymentGateways']):null,'gatewaySettings':_0x383064[_0x2cb95c(0x182)]?JSON['parse'](_0x383064[_0x2cb95c(0x182)]):null,'publicKey':_0x383064[_0x2cb95c(0x166)],'webhookUrl':_0x383064[_0x2cb95c(0x168)]?.[_0x2cb95c(0x16e)]||null,'webhookEvents':_0x31fe62,'wallets':{'usdtPolygonWallet':_0x383064['usdtPolygonWallet'],'usdtTrcWallet':_0x383064['usdtTrcWallet'],'usdtErcWallet':_0x383064[_0x2cb95c(0x19c)],'usdcPolygonWallet':_0x383064[_0x2cb95c(0x147)]},'status':_0x383064[_0x2cb95c(0x131)],'createdAt':_0x383064[_0x2cb95c(0x17e)]};}async[a53_0x220efb(0x173)](_0x94d93b,_0x3a0655){const _0x5644ae=a53_0x220efb,_0x57deeb={};_0x3a0655[_0x5644ae(0x159)]!==undefined&&(_0x57deeb[_0x5644ae(0x159)]=_0x3a0655[_0x5644ae(0x159)]||null),_0x3a0655[_0x5644ae(0x1a2)]!==undefined&&(_0x57deeb[_0x5644ae(0x1a2)]=_0x3a0655['usdtTrcWallet']||null),_0x3a0655['usdtErcWallet']!==undefined&&(_0x57deeb['usdtErcWallet']=_0x3a0655[_0x5644ae(0x19c)]||null),_0x3a0655[_0x5644ae(0x147)]!==undefined&&(_0x57deeb['usdcPolygonWallet']=_0x3a0655[_0x5644ae(0x147)]||null),await database_1[_0x5644ae(0x181)][_0x5644ae(0x1a3)][_0x5644ae(0x189)]({'where':{'id':_0x94d93b},'data':_0x57deeb});}async[a53_0x220efb(0x132)](_0x182f71){const _0xa039bf=a53_0x220efb,_0x305eb3=await database_1[_0xa039bf(0x181)][_0xa039bf(0x1a3)][_0xa039bf(0x186)]({'where':{'id':_0x182f71},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x305eb3?.['settings']?.['webhookUrl'])throw new Error(_0xa039bf(0x133));const _0x49d064={'event':_0xa039bf(0x145),'payment':{'id':'test_payment_123','order_id':_0xa039bf(0x1a9),'gateway':_0xa039bf(0x145),'amount':0x64,'currency':_0xa039bf(0x135),'status':_0xa039bf(0x1b3),'created_at':new Date()[_0xa039bf(0x161)]()}};try{const _0x2ef84e=await fetch(_0x305eb3[_0xa039bf(0x168)][_0xa039bf(0x16e)],{'method':'POST','headers':{'Content-Type':_0xa039bf(0x167),'User-Agent':_0xa039bf(0x154)},'body':JSON['stringify'](_0x49d064)});return _0x2ef84e['ok']?{'success':!![],'message':_0xa039bf(0x153)+_0x2ef84e[_0xa039bf(0x131)]+')'}:{'success':![],'message':_0xa039bf(0x191)+_0x2ef84e[_0xa039bf(0x131)]+'\x20'+_0x2ef84e[_0xa039bf(0x1ca)]};}catch(_0x2c8897){return{'success':![],'message':_0xa039bf(0x164)+(_0x2c8897 instanceof Error?_0x2c8897['message']:_0xa039bf(0x183))};}}async[a53_0x220efb(0x1c8)](_0x4627b2){const _0x545e76=a53_0x220efb;return this[_0x545e76(0x187)][_0x545e76(0x192)]({'public_key':'','gateway':_0x4627b2['gateway'],'order_id':_0x545e76(0x171)+Date[_0x545e76(0x13a)]()+'_'+Math[_0x545e76(0x199)]()[_0x545e76(0x1bb)](0x24)[_0x545e76(0x1a1)](0x2,0x9),'amount':_0x4627b2[_0x545e76(0x16f)],'currency':_0x4627b2[_0x545e76(0x1a5)]||_0x545e76(0x135),'source_currency':_0x4627b2['sourceCurrency'],'usage':_0x4627b2[_0x545e76(0x134)],'expires_at':_0x4627b2[_0x545e76(0x136)]?.[_0x545e76(0x161)](),'success_url':_0x4627b2[_0x545e76(0x18c)],'fail_url':_0x4627b2['redirectUrl'],'customer_email':_0x4627b2[_0x545e76(0x163)],'customer_name':_0x4627b2[_0x545e76(0x17c)],'country':_0x4627b2[_0x545e76(0x1b6)],'language':_0x4627b2[_0x545e76(0x16d)],'amount_is_editable':_0x4627b2[_0x545e76(0x156)],'max_payments':_0x4627b2[_0x545e76(0x1ae)],'customer':_0x4627b2[_0x545e76(0x1c4)]});}async[a53_0x220efb(0x1c7)](_0x1609e4,_0x3bac7f){const _0x323a75=a53_0x220efb;return this['paymentService'][_0x323a75(0x130)](_0x1609e4,_0x3bac7f);}async[a53_0x220efb(0x14a)](_0x550da5,_0x2d310b){const _0x4980ce=a53_0x220efb;return this['paymentService'][_0x4980ce(0x15c)](_0x550da5,_0x2d310b);}async[a53_0x220efb(0x162)](_0x6dc0f1,_0x3eb940,_0x224d50){const _0x136c6d=a53_0x220efb,_0x453de3=await database_1[_0x136c6d(0x181)][_0x136c6d(0x16a)][_0x136c6d(0x1bd)]({'where':{'id':_0x3eb940,'shopId':_0x6dc0f1}});if(!_0x453de3)throw new Error(_0x136c6d(0x18e));const _0x4cd632=await database_1['default'][_0x136c6d(0x16a)][_0x136c6d(0x189)]({'where':{'id':_0x3eb940},'data':{..._0x224d50,'updatedAt':new Date()}});return _0x4cd632;}async[a53_0x220efb(0x155)](_0x25adbd,_0x1e0481){const _0x53db42=a53_0x220efb,_0x955fd3=await database_1[_0x53db42(0x181)][_0x53db42(0x16a)][_0x53db42(0x1bd)]({'where':{'id':_0x1e0481,'shopId':_0x25adbd}});if(!_0x955fd3)throw new Error(_0x53db42(0x18e));await database_1[_0x53db42(0x181)][_0x53db42(0x16a)][_0x53db42(0x198)]({'where':{'id':_0x1e0481}});}async[a53_0x220efb(0x19e)](_0x4a9fd8,_0xe95412){const _0x319531=a53_0x220efb,{page:_0x47ca92,limit:_0x3353e0,status:_0x2e493a,method:_0x2c0b85,dateFrom:_0x4b4e01,dateTo:_0x574af1,periodFrom:_0x5840aa,periodTo:_0x1daf26}=_0xe95412,_0x81eddf=(_0x47ca92-0x1)*_0x3353e0,_0x22c94b={'shopId':_0x4a9fd8};_0x2e493a&&(_0x22c94b['status']=_0x2e493a['toUpperCase']());_0x2c0b85&&(_0x22c94b[_0x319531(0x19f)]=_0x2c0b85);if(_0x4b4e01||_0x574af1||_0x5840aa||_0x1daf26){_0x22c94b[_0x319531(0x17e)]={};if(_0x5840aa)_0x22c94b[_0x319531(0x17e)][_0x319531(0x1b0)]=new Date(_0x5840aa);else _0x4b4e01&&(_0x22c94b['createdAt'][_0x319531(0x1b0)]=new Date(_0x4b4e01));if(_0x1daf26)_0x22c94b[_0x319531(0x17e)]['lte']=new Date(_0x1daf26);else _0x574af1&&(_0x22c94b[_0x319531(0x17e)]['lte']=new Date(_0x574af1));}const [_0x5f0b12,_0x496d06]=await Promise[_0x319531(0x1bc)]([database_1[_0x319531(0x181)][_0x319531(0x185)]['findMany']({'where':_0x22c94b,'skip':_0x81eddf,'take':_0x3353e0,'orderBy':{'createdAt':_0x319531(0x1b5)}}),database_1[_0x319531(0x181)]['payout']['count']({'where':_0x22c94b})]);return{'payouts':_0x5f0b12['map'](_0x1a8f9a=>({'id':_0x1a8f9a['id'],'amount':_0x1a8f9a[_0x319531(0x16f)],'network':_0x1a8f9a[_0x319531(0x19f)],'status':_0x1a8f9a[_0x319531(0x131)],'txid':_0x1a8f9a['txid'],'notes':_0x1a8f9a[_0x319531(0x13e)],'createdAt':_0x1a8f9a[_0x319531(0x17e)],'paidAt':_0x1a8f9a[_0x319531(0x18d)]})),'pagination':{'page':_0x47ca92,'limit':_0x3353e0,'total':_0x496d06,'totalPages':Math['ceil'](_0x496d06/_0x3353e0)}};}async[a53_0x220efb(0x1a8)](_0xf6d3b0,_0x3324e2){const _0x58680f=a53_0x220efb,_0x915dcc=await database_1[_0x58680f(0x181)][_0x58680f(0x185)]['findFirst']({'where':{'id':_0x3324e2,'shopId':_0xf6d3b0}});if(!_0x915dcc)return null;return{'id':_0x915dcc['id'],'amount':_0x915dcc[_0x58680f(0x16f)],'network':_0x915dcc['network'],'status':_0x915dcc[_0x58680f(0x131)],'txid':_0x915dcc[_0x58680f(0x149)],'notes':_0x915dcc[_0x58680f(0x13e)],'createdAt':_0x915dcc['createdAt'],'paidAt':_0x915dcc[_0x58680f(0x18d)]};}async['getPayoutStatistics'](_0xd934ce,_0xaed7c4){const _0x1edad3=a53_0x220efb,_0x5207a5=new Date();let _0x3a7092;switch(_0xaed7c4){case'7d':_0x3a7092=new Date(_0x5207a5['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1edad3(0x16c):_0x3a7092=new Date(_0x5207a5[_0x1edad3(0x194)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1edad3(0x15b):_0x3a7092=new Date(_0x5207a5[_0x1edad3(0x194)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x3a7092=new Date(_0x5207a5[_0x1edad3(0x194)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x23d52e,_0x3fadcf,_0x1926a0,_0x306429,_0x4c03aa,_0x3795f6]=await Promise[_0x1edad3(0x1bc)]([database_1[_0x1edad3(0x181)][_0x1edad3(0x185)][_0x1edad3(0x195)]({'where':{'shopId':_0xd934ce,'createdAt':{'gte':_0x3a7092}}}),database_1['default'][_0x1edad3(0x185)][_0x1edad3(0x195)]({'where':{'shopId':_0xd934ce,'status':'COMPLETED','createdAt':{'gte':_0x3a7092}}}),database_1[_0x1edad3(0x181)][_0x1edad3(0x185)]['count']({'where':{'shopId':_0xd934ce,'status':_0x1edad3(0x179),'createdAt':{'gte':_0x3a7092}}}),database_1[_0x1edad3(0x181)][_0x1edad3(0x185)][_0x1edad3(0x195)]({'where':{'shopId':_0xd934ce,'status':_0x1edad3(0x15f),'createdAt':{'gte':_0x3a7092}}}),database_1[_0x1edad3(0x181)][_0x1edad3(0x185)][_0x1edad3(0x1c9)]({'where':{'shopId':_0xd934ce,'createdAt':{'gte':_0x3a7092}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x1edad3(0x181)][_0x1edad3(0x185)][_0x1edad3(0x1c9)]({'where':{'shopId':_0xd934ce},'take':0xa,'orderBy':{'createdAt':_0x1edad3(0x1b5)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x54de00=_0x4c03aa[_0x1edad3(0x1a7)]((_0x48d0f2,_0x4aed81)=>_0x48d0f2+_0x4aed81[_0x1edad3(0x16f)],0x0),_0x149cfd=_0x4c03aa['filter'](_0x185b4a=>_0x185b4a[_0x1edad3(0x131)]===_0x1edad3(0x1c3))[_0x1edad3(0x1a7)]((_0x46cc69,_0x5986d2)=>_0x46cc69+_0x5986d2['amount'],0x0),_0xbf719a=_0x4c03aa['filter'](_0x37b561=>_0x37b561['status']===_0x1edad3(0x179))[_0x1edad3(0x1a7)]((_0x18cbf8,_0xc64427)=>_0x18cbf8+_0xc64427[_0x1edad3(0x16f)],0x0),_0x5f1546=_0x4c03aa['reduce']((_0x22fb16,_0x183066)=>{const _0xa27380=_0x1edad3;return _0x22fb16[_0x183066[_0xa27380(0x19f)]]=(_0x22fb16[_0x183066[_0xa27380(0x19f)]]||0x0)+0x1,_0x22fb16;},{}),_0x2ec606=_0x4c03aa[_0x1edad3(0x1a7)]((_0x36ded0,_0x572cb4)=>{const _0x2329e7=_0x1edad3;return _0x36ded0[_0x572cb4[_0x2329e7(0x131)]]=(_0x36ded0[_0x572cb4[_0x2329e7(0x131)]]||0x0)+0x1,_0x36ded0;},{});return{'totalPayouts':_0x23d52e,'completedPayouts':_0x3fadcf,'pendingPayouts':_0x1926a0,'rejectedPayouts':_0x306429,'totalAmount':_0x54de00,'completedAmount':_0x149cfd,'pendingAmount':_0xbf719a,'payoutsByMethod':_0x5f1546,'payoutsByStatus':_0x2ec606,'recentPayouts':_0x3795f6['map'](_0x11a380=>({'id':_0x11a380['id'],'shopId':_0xd934ce,'amount':_0x11a380['amount'],'method':_0x11a380[_0x1edad3(0x19f)],'status':_0x11a380[_0x1edad3(0x131)],'txid':_0x11a380[_0x1edad3(0x149)],'createdAt':_0x11a380['createdAt'],'paidAt':_0x11a380[_0x1edad3(0x18d)]}))};}async[a53_0x220efb(0x1c5)](_0x4136f7){const _0x45ac54=a53_0x220efb;console['log']('📊\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x4136f7+_0x45ac54(0x151));const _0x31a483=await database_1[_0x45ac54(0x181)][_0x45ac54(0x1a3)]['findUnique']({'where':{'id':_0x4136f7},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x31a483)throw new Error(_0x45ac54(0x1b7));const _0x2cefd2=new Date(),_0x46ce2b=new Date(_0x2cefd2['getFullYear'](),_0x2cefd2[_0x45ac54(0x1b8)](),0x1),_0x41dc9e=new Date(_0x2cefd2[_0x45ac54(0x148)](),_0x2cefd2[_0x45ac54(0x1b8)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x58d78f=await database_1[_0x45ac54(0x181)][_0x45ac54(0x185)][_0x45ac54(0x1c6)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4136f7,'createdAt':{'gte':_0x46ce2b,'lte':_0x41dc9e},'status':'COMPLETED'}}),_0x190cc5=_0x58d78f[_0x45ac54(0x14f)][_0x45ac54(0x16f)]||0x0,_0x24131c={'availableBalance':Math[_0x45ac54(0x19b)](_0x31a483[_0x45ac54(0x17b)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x31a483[_0x45ac54(0x19a)]*0x64)/0x64,'awaitingPayout':Math[_0x45ac54(0x19b)](_0x31a483[_0x45ac54(0x17b)]*0x64)/0x64,'thisMonth':Math[_0x45ac54(0x19b)](_0x190cc5*0x64)/0x64};return console[_0x45ac54(0x17d)]('📊\x20Shop\x20'+_0x31a483[_0x45ac54(0x141)]+'\x20payout\x20statistics\x20calculated:'),console[_0x45ac54(0x17d)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x24131c[_0x45ac54(0x17a)]+'\x20USDT\x20(current\x20balance)'),console[_0x45ac54(0x17d)](_0x45ac54(0x143)+_0x24131c[_0x45ac54(0x19a)]+_0x45ac54(0x174)),console[_0x45ac54(0x17d)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x24131c[_0x45ac54(0x180)]+'\x20USDT\x20(current\x20balance)'),console[_0x45ac54(0x17d)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x24131c[_0x45ac54(0x13f)]+_0x45ac54(0x16b)),_0x24131c;}[a53_0x220efb(0x1ba)](_0x10dda2){const _0x214813=a53_0x220efb,_0x25d118={'test_gateway':_0x214813(0x193),'plisio':_0x214813(0x18a),'rapyd':_0x214813(0x137),'noda':'Noda','cointopay':_0x214813(0x160),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x214813(0x19d)};return _0x25d118[_0x10dda2]||_0x10dda2;}async['getPayoutStats'](_0x4fa475){const _0x34b64b=a53_0x220efb;return this[_0x34b64b(0x1c5)](_0x4fa475);}async[a53_0x220efb(0x1b2)](_0x1d581b,_0x575034){const _0x41e2ce=a53_0x220efb,{page:_0x3ba6e3,limit:_0x1c37cc,paymentId:_0x2458e3}=_0x575034,_0x32012e=(_0x3ba6e3-0x1)*_0x1c37cc,_0x531146={'shopId':_0x1d581b};_0x2458e3&&(_0x531146[_0x41e2ce(0x15a)]=_0x2458e3);const [_0x404ace,_0x307bb8]=await Promise[_0x41e2ce(0x1bc)]([database_1[_0x41e2ce(0x181)][_0x41e2ce(0x14d)][_0x41e2ce(0x1c9)]({'where':_0x531146,'skip':_0x32012e,'take':_0x1c37cc,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x41e2ce(0x14d)]['count']({'where':_0x531146})]);return{'logs':_0x404ace[_0x41e2ce(0x165)](_0x1f291d=>({'id':_0x1f291d['id'],'paymentId':_0x1f291d[_0x41e2ce(0x15a)],'shopId':_0x1f291d[_0x41e2ce(0x1a4)],'event':_0x1f291d['event'],'statusCode':_0x1f291d[_0x41e2ce(0x1bf)],'retryCount':_0x1f291d[_0x41e2ce(0x170)],'responseBody':_0x1f291d['responseBody'],'createdAt':_0x1f291d[_0x41e2ce(0x17e)],'payment':_0x1f291d[_0x41e2ce(0x16a)]})),'pagination':{'page':_0x3ba6e3,'limit':_0x1c37cc,'total':_0x307bb8,'totalPages':Math[_0x41e2ce(0x188)](_0x307bb8/_0x1c37cc)}};}async['getStatistics'](_0x5d235,_0x16f8cf){const _0xd646ed=a53_0x220efb,_0x2345bc=new Date();let _0x199c3f;switch(_0x16f8cf){case'7d':_0x199c3f=new Date(_0x2345bc[_0xd646ed(0x194)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xd646ed(0x16c):_0x199c3f=new Date(_0x2345bc['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x199c3f=new Date(_0x2345bc[_0xd646ed(0x194)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x199c3f=new Date(_0x2345bc[_0xd646ed(0x194)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1226de,_0x497dfe,_0x377f54,_0x2aa4e0,_0x48b446]=await Promise[_0xd646ed(0x1bc)]([database_1[_0xd646ed(0x181)][_0xd646ed(0x16a)][_0xd646ed(0x195)]({'where':{'shopId':_0x5d235,'gateway':{'not':_0xd646ed(0x17f)},'createdAt':{'gte':_0x199c3f}}}),database_1['default'][_0xd646ed(0x16a)]['count']({'where':{'shopId':_0x5d235,'gateway':{'not':_0xd646ed(0x17f)},'status':'PAID','createdAt':{'gte':_0x199c3f}}}),database_1[_0xd646ed(0x181)][_0xd646ed(0x16a)][_0xd646ed(0x1c9)]({'where':{'shopId':_0x5d235,'gateway':{'not':_0xd646ed(0x17f)},'status':'PAID','createdAt':{'gte':_0x199c3f}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0xd646ed(0x181)][_0xd646ed(0x16a)][_0xd646ed(0x1c9)]({'where':{'shopId':_0x5d235,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0xd646ed(0x1b5)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0xd646ed(0x16a)][_0xd646ed(0x1c9)]({'where':{'shopId':_0x5d235,'gateway':{'not':_0xd646ed(0x17f)},'createdAt':{'gte':_0x199c3f}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0xd646ed(0x138)}})]);let _0x2db87f=0x0;for(const _0x555574 of _0x377f54){if(_0x555574[_0xd646ed(0x178)])_0x2db87f+=_0x555574[_0xd646ed(0x178)];else{const _0x10e793=await currencyService_1['currencyService']['convertToUSDT'](_0x555574['amount'],_0x555574[_0xd646ed(0x1a5)]);_0x2db87f+=_0x10e793;}}const _0x50c68d=this[_0xd646ed(0x1ac)](_0x48b446,_0x199c3f,_0x2345bc),_0x330b3e=_0x1226de>0x0?_0x497dfe/_0x1226de*0x64:0x0;return{'totalPayments':_0x1226de,'successfulPayments':_0x497dfe,'totalRevenue':Math['round'](_0x2db87f*0x64)/0x64,'conversionRate':Math[_0xd646ed(0x19b)](_0x330b3e*0x64)/0x64,'dailyRevenue':_0x50c68d['dailyRevenue'],'dailyPayments':_0x50c68d['dailyPayments'],'recentPayments':_0x2aa4e0['map'](_0x534a35=>({'id':_0x534a35['id'],'gateway':_0x534a35[_0xd646ed(0x1be)],'amount':_0x534a35[_0xd646ed(0x16f)],'currency':_0x534a35[_0xd646ed(0x1a5)],'status':_0x534a35[_0xd646ed(0x131)],'createdAt':_0x534a35[_0xd646ed(0x17e)]}))};}[a53_0x220efb(0x1ac)](_0x5c9705,_0xba5ab9,_0x20d7d7){const _0x2299cc=a53_0x220efb,_0x48e913=new Map(),_0x520c24=new Date(_0xba5ab9);while(_0x520c24<=_0x20d7d7){const _0x530c70=_0x520c24[_0x2299cc(0x161)]()[_0x2299cc(0x1b9)]('T')[0x0];_0x48e913[_0x2299cc(0x197)](_0x530c70,{'revenue':0x0,'count':0x0}),_0x520c24[_0x2299cc(0x1c1)](_0x520c24[_0x2299cc(0x150)]()+0x1);}for(const _0x37fb04 of _0x5c9705){const _0x5d0929=_0x37fb04[_0x2299cc(0x17e)][_0x2299cc(0x161)]()[_0x2299cc(0x1b9)]('T')[0x0],_0x578283=_0x48e913[_0x2299cc(0x1af)](_0x5d0929);_0x578283&&(_0x578283[_0x2299cc(0x195)]+=0x1,_0x37fb04[_0x2299cc(0x131)]===_0x2299cc(0x15d)&&_0x37fb04['amountUSDT']&&(_0x578283[_0x2299cc(0x172)]+=_0x37fb04['amountUSDT']));}const _0xc9ce69=[],_0x59997f=[];for(const [_0x2027ff,_0x1488a4]of _0x48e913){_0xc9ce69[_0x2299cc(0x139)]({'date':_0x2027ff,'amount':Math[_0x2299cc(0x19b)](_0x1488a4[_0x2299cc(0x172)]*0x64)/0x64}),_0x59997f[_0x2299cc(0x139)]({'date':_0x2027ff,'count':_0x1488a4[_0x2299cc(0x195)]});}return{'dailyRevenue':_0xc9ce69,'dailyPayments':_0x59997f};}}exports['ShopService']=ShopService;