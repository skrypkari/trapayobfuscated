'use strict';const a57_0x1c0f26=a57_0x52c9;(function(_0x48ed4e,_0x1c7513){const _0x266737=a57_0x52c9,_0x47aeb6=_0x48ed4e();while(!![]){try{const _0x813640=-parseInt(_0x266737(0x1a5))/0x1*(-parseInt(_0x266737(0x163))/0x2)+parseInt(_0x266737(0x1a2))/0x3+parseInt(_0x266737(0x1dc))/0x4*(parseInt(_0x266737(0x177))/0x5)+parseInt(_0x266737(0x1f6))/0x6*(-parseInt(_0x266737(0x1b2))/0x7)+parseInt(_0x266737(0x1c8))/0x8*(-parseInt(_0x266737(0x185))/0x9)+parseInt(_0x266737(0x162))/0xa+-parseInt(_0x266737(0x1df))/0xb;if(_0x813640===_0x1c7513)break;else _0x47aeb6['push'](_0x47aeb6['shift']());}catch(_0x148b07){_0x47aeb6['push'](_0x47aeb6['shift']());}}}(a57_0x1227,0x316ff));function a57_0x52c9(_0x5c9f37,_0x4ba10b){const _0x122783=a57_0x1227();return a57_0x52c9=function(_0x52c998,_0x49c528){_0x52c998=_0x52c998-0x155;let _0x2d41ae=_0x122783[_0x52c998];return _0x2d41ae;},a57_0x52c9(_0x5c9f37,_0x4ba10b);}var __importDefault=this&&this[a57_0x1c0f26(0x1ce)]||function(_0x307813){return _0x307813&&_0x307813['__esModule']?_0x307813:{'default':_0x307813};};Object[a57_0x1c0f26(0x172)](exports,a57_0x1c0f26(0x16b),{'value':!![]}),exports[a57_0x1c0f26(0x1bd)]=void 0x0;const database_1=__importDefault(require(a57_0x1c0f26(0x170))),currencyService_1=require(a57_0x1c0f26(0x194)),paymentService_1=require(a57_0x1c0f26(0x1a3));class ShopService{constructor(){const _0x4b1635=a57_0x1c0f26;this[_0x4b1635(0x1d3)]=new paymentService_1[(_0x4b1635(0x1e2))]();}async['getShopProfile'](_0x1b93c6){const _0xd411f=a57_0x1c0f26,_0x3b9469=await database_1[_0xd411f(0x1f7)]['shop']['findUnique']({'where':{'id':_0x1b93c6},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x3b9469)throw new Error(_0xd411f(0x1d9));let _0x14b25e=[];if(_0x3b9469[_0xd411f(0x168)]?.[_0xd411f(0x1d7)])try{_0x14b25e=Array[_0xd411f(0x19f)](_0x3b9469['settings']['webhookEvents'])?_0x3b9469[_0xd411f(0x168)][_0xd411f(0x1d7)]:JSON[_0xd411f(0x165)](_0x3b9469[_0xd411f(0x168)][_0xd411f(0x1d7)]);}catch(_0x4f9ffd){console['error'](_0xd411f(0x1c7),_0x4f9ffd),_0x14b25e=[];}return{'id':_0x3b9469['id'],'fullName':_0x3b9469[_0xd411f(0x174)],'username':_0x3b9469['username'],'telegramId':_0x3b9469['telegram'],'merchantUrl':_0x3b9469[_0xd411f(0x193)],'gateways':_0x3b9469[_0xd411f(0x1d2)]?JSON[_0xd411f(0x165)](_0x3b9469[_0xd411f(0x1d2)]):null,'gatewaySettings':_0x3b9469[_0xd411f(0x187)]?JSON['parse'](_0x3b9469['gatewaySettings']):null,'publicKey':_0x3b9469[_0xd411f(0x182)],'webhookUrl':_0x3b9469['settings']?.[_0xd411f(0x169)]||null,'webhookEvents':_0x14b25e,'wallets':{'usdtPolygonWallet':_0x3b9469[_0xd411f(0x1e1)],'usdtTrcWallet':_0x3b9469[_0xd411f(0x179)],'usdtErcWallet':_0x3b9469[_0xd411f(0x1ef)],'usdcPolygonWallet':_0x3b9469[_0xd411f(0x1c2)]},'status':_0x3b9469[_0xd411f(0x1b6)],'createdAt':_0x3b9469[_0xd411f(0x1e5)]};}async[a57_0x1c0f26(0x1db)](_0x293459,_0x1cf40d){const _0x17a121=a57_0x1c0f26,_0xa96ffe={};_0x1cf40d['fullName']&&(_0xa96ffe[_0x17a121(0x174)]=_0x1cf40d[_0x17a121(0x198)]);_0x1cf40d[_0x17a121(0x15e)]!==undefined&&(_0xa96ffe[_0x17a121(0x17c)]=_0x1cf40d[_0x17a121(0x15e)]||null);_0x1cf40d[_0x17a121(0x1a0)]&&(_0xa96ffe[_0x17a121(0x193)]=_0x1cf40d[_0x17a121(0x1a0)]);_0x1cf40d['gateways']&&(_0xa96ffe[_0x17a121(0x1d2)]=JSON[_0x17a121(0x1ad)](_0x1cf40d[_0x17a121(0x1fc)]));_0x1cf40d[_0x17a121(0x187)]&&(_0xa96ffe[_0x17a121(0x187)]=JSON[_0x17a121(0x1ad)](_0x1cf40d[_0x17a121(0x187)]));_0x1cf40d['wallets']&&(_0x1cf40d[_0x17a121(0x1ba)]['usdtPolygonWallet']!==undefined&&(_0xa96ffe['usdtPolygonWallet']=_0x1cf40d[_0x17a121(0x1ba)][_0x17a121(0x1e1)]||null),_0x1cf40d[_0x17a121(0x1ba)][_0x17a121(0x179)]!==undefined&&(_0xa96ffe[_0x17a121(0x179)]=_0x1cf40d['wallets'][_0x17a121(0x179)]||null),_0x1cf40d[_0x17a121(0x1ba)][_0x17a121(0x1ef)]!==undefined&&(_0xa96ffe[_0x17a121(0x1ef)]=_0x1cf40d[_0x17a121(0x1ba)][_0x17a121(0x1ef)]||null),_0x1cf40d['wallets']['usdcPolygonWallet']!==undefined&&(_0xa96ffe[_0x17a121(0x1c2)]=_0x1cf40d[_0x17a121(0x1ba)][_0x17a121(0x1c2)]||null));const _0x8e0f4f=await database_1[_0x17a121(0x1f7)][_0x17a121(0x1e7)][_0x17a121(0x1e8)]({'where':{'id':_0x293459},'data':_0xa96ffe,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x5b5f1f=[];if(_0x8e0f4f[_0x17a121(0x168)]?.[_0x17a121(0x1d7)])try{_0x5b5f1f=Array[_0x17a121(0x19f)](_0x8e0f4f[_0x17a121(0x168)][_0x17a121(0x1d7)])?_0x8e0f4f['settings']['webhookEvents']:JSON[_0x17a121(0x165)](_0x8e0f4f[_0x17a121(0x168)][_0x17a121(0x1d7)]);}catch(_0x2f7bbb){console[_0x17a121(0x1a9)](_0x17a121(0x1c7),_0x2f7bbb),_0x5b5f1f=[];}return{'id':_0x8e0f4f['id'],'fullName':_0x8e0f4f[_0x17a121(0x174)],'username':_0x8e0f4f[_0x17a121(0x171)],'telegramId':_0x8e0f4f['telegram'],'merchantUrl':_0x8e0f4f[_0x17a121(0x193)],'gateways':_0x8e0f4f['paymentGateways']?JSON[_0x17a121(0x165)](_0x8e0f4f['paymentGateways']):null,'gatewaySettings':_0x8e0f4f[_0x17a121(0x187)]?JSON[_0x17a121(0x165)](_0x8e0f4f[_0x17a121(0x187)]):null,'publicKey':_0x8e0f4f[_0x17a121(0x182)],'webhookUrl':_0x8e0f4f[_0x17a121(0x168)]?.['webhookUrl']||null,'webhookEvents':_0x5b5f1f,'wallets':{'usdtPolygonWallet':_0x8e0f4f[_0x17a121(0x1e1)],'usdtTrcWallet':_0x8e0f4f['usdtTrcWallet'],'usdtErcWallet':_0x8e0f4f[_0x17a121(0x1ef)],'usdcPolygonWallet':_0x8e0f4f[_0x17a121(0x1c2)]},'status':_0x8e0f4f[_0x17a121(0x1b6)],'createdAt':_0x8e0f4f['createdAt']};}async['updateWallets'](_0x5eb701,_0x471e18){const _0x365b80=a57_0x1c0f26,_0x4ebb21={};_0x471e18['usdtPolygonWallet']!==undefined&&(_0x4ebb21[_0x365b80(0x1e1)]=_0x471e18[_0x365b80(0x1e1)]||null),_0x471e18[_0x365b80(0x179)]!==undefined&&(_0x4ebb21['usdtTrcWallet']=_0x471e18[_0x365b80(0x179)]||null),_0x471e18[_0x365b80(0x1ef)]!==undefined&&(_0x4ebb21[_0x365b80(0x1ef)]=_0x471e18[_0x365b80(0x1ef)]||null),_0x471e18[_0x365b80(0x1c2)]!==undefined&&(_0x4ebb21[_0x365b80(0x1c2)]=_0x471e18[_0x365b80(0x1c2)]||null),await database_1[_0x365b80(0x1f7)][_0x365b80(0x1e7)][_0x365b80(0x1e8)]({'where':{'id':_0x5eb701},'data':_0x4ebb21});}async[a57_0x1c0f26(0x1c0)](_0x1310bb){const _0x15b7fd=a57_0x1c0f26,_0x52f7a0=await database_1['default'][_0x15b7fd(0x1e7)][_0x15b7fd(0x1ac)]({'where':{'id':_0x1310bb},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x52f7a0?.[_0x15b7fd(0x168)]?.[_0x15b7fd(0x169)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x2bc0a8={'event':_0x15b7fd(0x1cd),'payment':{'id':_0x15b7fd(0x157),'order_id':_0x15b7fd(0x1cf),'gateway':'test','amount':0x64,'currency':_0x15b7fd(0x1d1),'status':_0x15b7fd(0x188),'created_at':new Date()[_0x15b7fd(0x1fe)]()}};try{const _0xaedef4=await fetch(_0x52f7a0['settings'][_0x15b7fd(0x169)],{'method':'POST','headers':{'Content-Type':_0x15b7fd(0x1da),'User-Agent':_0x15b7fd(0x184)},'body':JSON[_0x15b7fd(0x1ad)](_0x2bc0a8)});return _0xaedef4['ok']?{'success':!![],'message':_0x15b7fd(0x1c4)+_0xaedef4['status']+')'}:{'success':![],'message':_0x15b7fd(0x1bb)+_0xaedef4['status']+'\x20'+_0xaedef4['statusText']};}catch(_0x2461fb){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x2461fb instanceof Error?_0x2461fb['message']:'Unknown\x20error')};}}async[a57_0x1c0f26(0x190)](_0x3efda6){const _0x211aa6=a57_0x1c0f26;return this[_0x211aa6(0x1d3)][_0x211aa6(0x1dd)]({'public_key':'','gateway':_0x3efda6[_0x211aa6(0x1bf)],'order_id':undefined,'amount':_0x3efda6[_0x211aa6(0x1b5)],'currency':_0x3efda6[_0x211aa6(0x1fa)],'source_currency':_0x3efda6[_0x211aa6(0x1a1)],'usage':_0x3efda6[_0x211aa6(0x1d8)],'expires_at':_0x3efda6[_0x211aa6(0x175)]?.[_0x211aa6(0x1fe)](),'success_url':_0x3efda6[_0x211aa6(0x1cc)],'fail_url':_0x3efda6[_0x211aa6(0x1cc)],'customer_email':_0x3efda6[_0x211aa6(0x195)],'customer_name':_0x3efda6[_0x211aa6(0x15b)],'country':_0x3efda6['country'],'language':_0x3efda6[_0x211aa6(0x1d5)],'amount_is_editable':_0x3efda6['amountIsEditable'],'max_payments':_0x3efda6['maxPayments'],'customer':_0x3efda6[_0x211aa6(0x1eb)]});}async[a57_0x1c0f26(0x1c6)](_0x110e23,_0x516351){const _0x2fa4fe=a57_0x1c0f26;return this[_0x2fa4fe(0x1d3)][_0x2fa4fe(0x166)](_0x110e23,_0x516351);}async['getPaymentById'](_0x4677f4,_0x1a7667){const _0x53463d=a57_0x1c0f26;return this[_0x53463d(0x1d3)][_0x53463d(0x1ed)](_0x4677f4,_0x1a7667);}async[a57_0x1c0f26(0x1be)](_0x19013f,_0x34c66e,_0x5232b2){const _0x4cf47b=a57_0x1c0f26,_0x242c3e=await database_1[_0x4cf47b(0x1f7)]['payment'][_0x4cf47b(0x1a8)]({'where':{'id':_0x34c66e,'shopId':_0x19013f}});if(!_0x242c3e)throw new Error(_0x4cf47b(0x15d));const _0x2ff0f1=await database_1[_0x4cf47b(0x1f7)][_0x4cf47b(0x181)][_0x4cf47b(0x1e8)]({'where':{'id':_0x34c66e},'data':{..._0x5232b2,'updatedAt':new Date()}});return _0x2ff0f1;}async['deletePayment'](_0x512abc,_0x4dafe9){const _0x1162e1=a57_0x1c0f26,_0x13724f=await database_1[_0x1162e1(0x1f7)][_0x1162e1(0x181)][_0x1162e1(0x1a8)]({'where':{'id':_0x4dafe9,'shopId':_0x512abc}});if(!_0x13724f)throw new Error(_0x1162e1(0x15d));await database_1[_0x1162e1(0x1f7)]['payment'][_0x1162e1(0x1b8)]({'where':{'id':_0x4dafe9}});}['formatNetworkName'](_0x169e91){const _0x5a1411=a57_0x1c0f26,_0x1916d3={'polygon':_0x5a1411(0x180),'trc20':'USDT\x20TRC20','erc20':'USDT\x20ERC20','bsc':_0x5a1411(0x160),'polygon_usdc':'USDC\x20Polygon'};return _0x1916d3[_0x169e91]||_0x169e91;}async[a57_0x1c0f26(0x197)](_0xc20ba9,_0xaf8bfd){const _0x5d07fe=a57_0x1c0f26,{page:_0x18926a,limit:_0x235e56,status:_0xc6e408,method:_0x34b8e0,network:_0x5e6f27,dateFrom:_0x36e0b3,dateTo:_0x41b3e9,periodFrom:_0xe32f11,periodTo:_0x35b54b}=_0xaf8bfd,_0x1fab5b=(_0x18926a-0x1)*_0x235e56;console['log']('💰\x20Getting\x20payouts\x20with\x20filters:',_0xaf8bfd);const _0x44f251={'shopId':_0xc20ba9};_0xc6e408&&(_0x44f251['status']=_0xc6e408['toUpperCase'](),console['log'](_0x5d07fe(0x1c5)+_0xc6e408['toUpperCase']()));if(_0x34b8e0)_0x44f251['network']=_0x34b8e0,console['log']('🌐\x20Method\x20filter:\x20'+_0x34b8e0);else _0x5e6f27&&(_0x44f251[_0x5d07fe(0x19c)]=_0x5e6f27,console[_0x5d07fe(0x1cb)]('🌐\x20Network\x20filter:\x20'+_0x5e6f27));if(_0x36e0b3||_0x41b3e9||_0xe32f11||_0x35b54b){_0x44f251['createdAt']={};if(_0xe32f11){const _0x2af268=new Date(_0xe32f11);_0x2af268[_0x5d07fe(0x1c9)](0x0,0x0,0x0,0x0),_0x44f251[_0x5d07fe(0x1e5)][_0x5d07fe(0x1e3)]=_0x2af268,console[_0x5d07fe(0x1cb)](_0x5d07fe(0x17a)+_0x2af268[_0x5d07fe(0x1fe)]());}else{if(_0x36e0b3){const _0x47e4e8=new Date(_0x36e0b3);_0x47e4e8[_0x5d07fe(0x1c9)](0x0,0x0,0x0,0x0),_0x44f251[_0x5d07fe(0x1e5)][_0x5d07fe(0x1e3)]=_0x47e4e8,console['log'](_0x5d07fe(0x18e)+_0x47e4e8[_0x5d07fe(0x1fe)]());}}if(_0x35b54b){const _0x1c045f=new Date(_0x35b54b);_0x1c045f['setHours'](0x17,0x3b,0x3b,0x3e7),_0x44f251['createdAt']['lte']=_0x1c045f,console['log'](_0x5d07fe(0x196)+_0x1c045f[_0x5d07fe(0x1fe)]());}else{if(_0x41b3e9){const _0x19d905=new Date(_0x41b3e9);_0x19d905[_0x5d07fe(0x1c9)](0x17,0x3b,0x3b,0x3e7),_0x44f251[_0x5d07fe(0x1e5)][_0x5d07fe(0x1ae)]=_0x19d905,console['log']('📅\x20Date\x20end:\x20'+_0x19d905[_0x5d07fe(0x1fe)]());}}}console['log'](_0x5d07fe(0x176),JSON[_0x5d07fe(0x1ad)](_0x44f251,null,0x2));const [_0x2e62f9,_0x4684d6]=await Promise[_0x5d07fe(0x1d6)]([database_1['default'][_0x5d07fe(0x1e9)][_0x5d07fe(0x1ff)]({'where':_0x44f251,'skip':_0x1fab5b,'take':_0x235e56,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x5d07fe(0x1e9)][_0x5d07fe(0x173)]({'where':_0x44f251})]);return{'payouts':_0x2e62f9['map'](_0x2bd968=>{const _0x4767c1=_0x5d07fe;let _0x3fbf64=null;switch(_0x2bd968['network']){case'polygon':_0x3fbf64=_0x2bd968['shop']['usdtPolygonWallet'];break;case _0x4767c1(0x17e):_0x3fbf64=_0x2bd968[_0x4767c1(0x1e7)]['usdtTrcWallet'];break;case _0x4767c1(0x1b0):_0x3fbf64=_0x2bd968[_0x4767c1(0x1e7)][_0x4767c1(0x1ef)];break;case _0x4767c1(0x1fd):_0x3fbf64=_0x2bd968[_0x4767c1(0x1e7)][_0x4767c1(0x1c2)];break;}return{'id':_0x2bd968['id'],'amount':_0x2bd968[_0x4767c1(0x1b5)],'network':this[_0x4767c1(0x16a)](_0x2bd968[_0x4767c1(0x19c)]),'wallet':_0x3fbf64,'status':_0x2bd968[_0x4767c1(0x1b6)],'txid':_0x2bd968[_0x4767c1(0x159)],'notes':_0x2bd968[_0x4767c1(0x186)],'periodFrom':_0x2bd968[_0x4767c1(0x1e4)],'periodTo':_0x2bd968[_0x4767c1(0x16e)],'createdAt':_0x2bd968[_0x4767c1(0x1e5)],'paidAt':_0x2bd968['paidAt']};}),'pagination':{'page':_0x18926a,'limit':_0x235e56,'total':_0x4684d6,'totalPages':Math[_0x5d07fe(0x1a7)](_0x4684d6/_0x235e56)}};}async[a57_0x1c0f26(0x1d4)](_0x21f9f7,_0x284688){const _0x240851=a57_0x1c0f26,_0x5d2a0d=await database_1['default']['payout'][_0x240851(0x1a8)]({'where':{'id':_0x284688,'shopId':_0x21f9f7}});if(!_0x5d2a0d)return null;return{'id':_0x5d2a0d['id'],'amount':_0x5d2a0d[_0x240851(0x1b5)],'network':_0x5d2a0d[_0x240851(0x19c)],'status':_0x5d2a0d[_0x240851(0x1b6)],'txid':_0x5d2a0d[_0x240851(0x159)],'notes':_0x5d2a0d[_0x240851(0x186)],'createdAt':_0x5d2a0d[_0x240851(0x1e5)],'paidAt':_0x5d2a0d['paidAt']};}async[a57_0x1c0f26(0x1b7)](_0x3b0f13,_0x3413fb){const _0x335529=a57_0x1c0f26,_0x32f608=new Date();let _0x415954;switch(_0x3413fb){case'7d':_0x415954=new Date(_0x32f608[_0x335529(0x15f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x335529(0x1ab):_0x415954=new Date(_0x32f608[_0x335529(0x15f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x335529(0x1e6):_0x415954=new Date(_0x32f608[_0x335529(0x15f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x415954=new Date(_0x32f608[_0x335529(0x15f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x45eabd,_0xcb1b00,_0x279116,_0x576f5b,_0x1f6646,_0xf2e0ae]=await Promise[_0x335529(0x1d6)]([database_1['default'][_0x335529(0x1e9)][_0x335529(0x173)]({'where':{'shopId':_0x3b0f13,'createdAt':{'gte':_0x415954}}}),database_1[_0x335529(0x1f7)][_0x335529(0x1e9)][_0x335529(0x173)]({'where':{'shopId':_0x3b0f13,'status':_0x335529(0x1f0),'createdAt':{'gte':_0x415954}}}),database_1[_0x335529(0x1f7)][_0x335529(0x1e9)]['count']({'where':{'shopId':_0x3b0f13,'status':_0x335529(0x156),'createdAt':{'gte':_0x415954}}}),database_1[_0x335529(0x1f7)][_0x335529(0x1e9)][_0x335529(0x173)]({'where':{'shopId':_0x3b0f13,'status':_0x335529(0x1f2),'createdAt':{'gte':_0x415954}}}),database_1['default']['payout'][_0x335529(0x1ff)]({'where':{'shopId':_0x3b0f13,'createdAt':{'gte':_0x415954}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x335529(0x1f7)][_0x335529(0x1e9)][_0x335529(0x1ff)]({'where':{'shopId':_0x3b0f13},'take':0xa,'orderBy':{'createdAt':_0x335529(0x1af)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x48d161=_0x1f6646[_0x335529(0x1de)]((_0x41c134,_0x151b4b)=>_0x41c134+_0x151b4b[_0x335529(0x1b5)],0x0),_0x887fa=_0x1f6646[_0x335529(0x18f)](_0xa7c936=>_0xa7c936['status']===_0x335529(0x1f0))[_0x335529(0x1de)]((_0x3ddbbf,_0x1501a5)=>_0x3ddbbf+_0x1501a5[_0x335529(0x1b5)],0x0),_0x4ea0e3=_0x1f6646[_0x335529(0x18f)](_0x310bc5=>_0x310bc5[_0x335529(0x1b6)]===_0x335529(0x156))[_0x335529(0x1de)]((_0x2de28f,_0x31e6c5)=>_0x2de28f+_0x31e6c5['amount'],0x0),_0xe2f2e8=_0x1f6646[_0x335529(0x1de)]((_0x208358,_0x2fb126)=>{const _0x294771=_0x335529;return _0x208358[_0x2fb126['network']]=(_0x208358[_0x2fb126[_0x294771(0x19c)]]||0x0)+0x1,_0x208358;},{}),_0x25ac7c=_0x1f6646[_0x335529(0x1de)]((_0x3d07cd,_0x39aab6)=>{const _0x34bf23=_0x335529;return _0x3d07cd[_0x39aab6[_0x34bf23(0x1b6)]]=(_0x3d07cd[_0x39aab6['status']]||0x0)+0x1,_0x3d07cd;},{});return{'totalPayouts':_0x45eabd,'completedPayouts':_0xcb1b00,'pendingPayouts':_0x279116,'rejectedPayouts':_0x576f5b,'totalAmount':_0x48d161,'completedAmount':_0x887fa,'pendingAmount':_0x4ea0e3,'payoutsByMethod':_0xe2f2e8,'payoutsByStatus':_0x25ac7c,'recentPayouts':_0xf2e0ae[_0x335529(0x1c1)](_0x4b0745=>({'id':_0x4b0745['id'],'shopId':_0x3b0f13,'amount':_0x4b0745[_0x335529(0x1b5)],'method':_0x4b0745[_0x335529(0x19c)],'status':_0x4b0745[_0x335529(0x1b6)],'txid':_0x4b0745[_0x335529(0x159)],'createdAt':_0x4b0745[_0x335529(0x1e5)],'paidAt':_0x4b0745[_0x335529(0x155)]}))};}async[a57_0x1c0f26(0x17f)](_0xf374d6){const _0x9781e9=a57_0x1c0f26;console[_0x9781e9(0x1cb)](_0x9781e9(0x1f5)+_0xf374d6+_0x9781e9(0x1e0));const _0x55a278=await database_1[_0x9781e9(0x1f7)][_0x9781e9(0x1e7)][_0x9781e9(0x1ac)]({'where':{'id':_0xf374d6},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x55a278)throw new Error(_0x9781e9(0x1d9));const _0x4a7d21=new Date(),_0x19c20f=new Date(_0x4a7d21[_0x9781e9(0x1ee)](),_0x4a7d21[_0x9781e9(0x1f3)](),0x1),_0x51a5be=new Date(_0x4a7d21['getFullYear'](),_0x4a7d21[_0x9781e9(0x1f3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4ac695=await database_1[_0x9781e9(0x1f7)][_0x9781e9(0x1e9)][_0x9781e9(0x1f9)]({'_sum':{'amount':!![]},'where':{'shopId':_0xf374d6,'createdAt':{'gte':_0x19c20f,'lte':_0x51a5be},'status':'COMPLETED'}}),_0x2eab78=_0x4ac695['_sum'][_0x9781e9(0x1b5)]||0x0,_0x30d9de={'availableBalance':Math[_0x9781e9(0x16f)](_0x55a278[_0x9781e9(0x1ec)]*0x64)/0x64,'totalPaidOut':Math[_0x9781e9(0x16f)](_0x55a278[_0x9781e9(0x1f8)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x55a278[_0x9781e9(0x1ec)]*0x64)/0x64,'thisMonth':Math['round'](_0x2eab78*0x64)/0x64};return console[_0x9781e9(0x1cb)](_0x9781e9(0x16d)+_0x55a278[_0x9781e9(0x171)]+_0x9781e9(0x1f4)),console[_0x9781e9(0x1cb)](_0x9781e9(0x1c3)+_0x30d9de['availableBalance']+_0x9781e9(0x18d)),console[_0x9781e9(0x1cb)](_0x9781e9(0x1d0)+_0x30d9de['totalPaidOut']+_0x9781e9(0x1f1)),console[_0x9781e9(0x1cb)](_0x9781e9(0x18a)+_0x30d9de[_0x9781e9(0x1b1)]+_0x9781e9(0x18d)),console[_0x9781e9(0x1cb)](_0x9781e9(0x167)+_0x30d9de[_0x9781e9(0x158)]+'\x20USDT'),_0x30d9de;}[a57_0x1c0f26(0x19a)](_0x2d6908){const _0x41e6df=a57_0x1c0f26,_0x4ac90c={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x41e6df(0x19d),'noda':_0x41e6df(0x18b),'cointopay':_0x41e6df(0x189),'klyme_eu':_0x41e6df(0x1a6),'klyme_gb':_0x41e6df(0x192),'klyme_de':_0x41e6df(0x178)};return _0x4ac90c[_0x2d6908]||_0x2d6908;}async[a57_0x1c0f26(0x1b3)](_0x54563e){return this['getShopPayoutStats'](_0x54563e);}async['getWebhookLogs'](_0x22403d,_0x2d66ba){const _0x4c891d=a57_0x1c0f26,{page:_0x50b750,limit:_0x15b560,paymentId:_0xdf8a0}=_0x2d66ba,_0x5acd0e=(_0x50b750-0x1)*_0x15b560,_0x4095d6={'shopId':_0x22403d};_0xdf8a0&&(_0x4095d6[_0x4c891d(0x16c)]=_0xdf8a0);const [_0x3b8eaa,_0x32193a]=await Promise[_0x4c891d(0x1d6)]([database_1[_0x4c891d(0x1f7)]['webhookLog']['findMany']({'where':_0x4095d6,'skip':_0x5acd0e,'take':_0x15b560,'orderBy':{'createdAt':_0x4c891d(0x1af)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x4c891d(0x1f7)][_0x4c891d(0x17d)]['count']({'where':_0x4095d6})]);return{'logs':_0x3b8eaa[_0x4c891d(0x1c1)](_0x3dcbc8=>({'id':_0x3dcbc8['id'],'paymentId':_0x3dcbc8[_0x4c891d(0x16c)],'shopId':_0x3dcbc8[_0x4c891d(0x199)],'event':_0x3dcbc8[_0x4c891d(0x1aa)],'statusCode':_0x3dcbc8['statusCode'],'retryCount':_0x3dcbc8['retryCount'],'responseBody':_0x3dcbc8['responseBody'],'createdAt':_0x3dcbc8[_0x4c891d(0x1e5)],'payment':_0x3dcbc8[_0x4c891d(0x181)]})),'pagination':{'page':_0x50b750,'limit':_0x15b560,'total':_0x32193a,'totalPages':Math[_0x4c891d(0x1a7)](_0x32193a/_0x15b560)}};}async[a57_0x1c0f26(0x1ca)](_0x2e739f,_0x2981f8){const _0x475faa=a57_0x1c0f26,_0xf63232=new Date();let _0x31d81f;switch(_0x2981f8){case'7d':_0x31d81f=new Date(_0xf63232[_0x475faa(0x15f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x31d81f=new Date(_0xf63232[_0x475faa(0x15f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x31d81f=new Date(_0xf63232[_0x475faa(0x15f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x31d81f=new Date(_0xf63232[_0x475faa(0x15f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x20ab2e,_0x4e906c,_0x43a009,_0x116dcb,_0x4c9e46]=await Promise[_0x475faa(0x1d6)]([database_1[_0x475faa(0x1f7)][_0x475faa(0x181)][_0x475faa(0x173)]({'where':{'shopId':_0x2e739f,'gateway':{'not':_0x475faa(0x1fb)},'createdAt':{'gte':_0x31d81f}}}),database_1[_0x475faa(0x1f7)][_0x475faa(0x181)][_0x475faa(0x173)]({'where':{'shopId':_0x2e739f,'gateway':{'not':_0x475faa(0x1fb)},'status':_0x475faa(0x15a),'createdAt':{'gte':_0x31d81f}}}),database_1[_0x475faa(0x1f7)][_0x475faa(0x181)][_0x475faa(0x1ff)]({'where':{'shopId':_0x2e739f,'gateway':{'not':_0x475faa(0x1fb)},'status':_0x475faa(0x15a),'createdAt':{'gte':_0x31d81f}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x475faa(0x1f7)][_0x475faa(0x181)]['findMany']({'where':{'shopId':_0x2e739f,'gateway':{'not':_0x475faa(0x1fb)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x475faa(0x1f7)]['payment']['findMany']({'where':{'shopId':_0x2e739f,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x31d81f}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x475faa(0x1bc)}})]);let _0x477255=0x0;for(const _0x272d09 of _0x43a009){if(_0x272d09['amountUSDT'])_0x477255+=_0x272d09['amountUSDT'];else{const _0x1c662b=await currencyService_1[_0x475faa(0x1a4)][_0x475faa(0x1ea)](_0x272d09[_0x475faa(0x1b5)],_0x272d09[_0x475faa(0x1fa)]);_0x477255+=_0x1c662b;}}const _0x3c77da=this[_0x475faa(0x15c)](_0x4c9e46,_0x31d81f,_0xf63232),_0x43bb54=_0x20ab2e>0x0?_0x4e906c/_0x20ab2e*0x64:0x0;return{'totalPayments':_0x20ab2e,'successfulPayments':_0x4e906c,'totalRevenue':Math[_0x475faa(0x16f)](_0x477255*0x64)/0x64,'conversionRate':Math[_0x475faa(0x16f)](_0x43bb54*0x64)/0x64,'dailyRevenue':_0x3c77da[_0x475faa(0x164)],'dailyPayments':_0x3c77da[_0x475faa(0x161)],'recentPayments':_0x116dcb[_0x475faa(0x1c1)](_0x1ae233=>({'id':_0x1ae233['id'],'gateway':_0x1ae233[_0x475faa(0x1bf)],'amount':_0x1ae233[_0x475faa(0x1b5)],'currency':_0x1ae233['currency'],'status':_0x1ae233[_0x475faa(0x1b6)],'createdAt':_0x1ae233['createdAt']}))};}['generateDailyStatistics'](_0x3076b5,_0x509da1,_0x431504){const _0x59a764=a57_0x1c0f26,_0xad0fc7=new Map(),_0x1e995a=new Date(_0x509da1);while(_0x1e995a<=_0x431504){const _0x4969a1=_0x1e995a['toISOString']()[_0x59a764(0x18c)]('T')[0x0];_0xad0fc7[_0x59a764(0x1b4)](_0x4969a1,{'revenue':0x0,'count':0x0}),_0x1e995a[_0x59a764(0x183)](_0x1e995a[_0x59a764(0x19e)]()+0x1);}for(const _0x5cacc1 of _0x3076b5){const _0x598ac5=_0x5cacc1[_0x59a764(0x1e5)]['toISOString']()['split']('T')[0x0],_0x333025=_0xad0fc7[_0x59a764(0x191)](_0x598ac5);_0x333025&&(_0x333025[_0x59a764(0x173)]+=0x1,_0x5cacc1[_0x59a764(0x1b6)]===_0x59a764(0x15a)&&_0x5cacc1[_0x59a764(0x1b9)]&&(_0x333025[_0x59a764(0x19b)]+=_0x5cacc1[_0x59a764(0x1b9)]));}const _0x5ae704=[],_0xbb689e=[];for(const [_0x4925b2,_0x4b0a32]of _0xad0fc7){_0x5ae704['push']({'date':_0x4925b2,'amount':Math[_0x59a764(0x16f)](_0x4b0a32[_0x59a764(0x19b)]*0x64)/0x64}),_0xbb689e[_0x59a764(0x17b)]({'date':_0x4925b2,'count':_0x4b0a32[_0x59a764(0x173)]});}return{'dailyRevenue':_0x5ae704,'dailyPayments':_0xbb689e};}}exports[a57_0x1c0f26(0x1bd)]=ShopService;function a57_0x1227(){const _0x28a6ec=['../config/database','username','defineProperty','count','name','expiresAt','📊\x20Final\x20WHERE\x20conditions:','110zJPxHp','KLYME\x20DE','usdtTrcWallet','📅\x20Period\x20start:\x20','push','telegram','webhookLog','trc20','getShopPayoutStats','USDT\x20Polygon','payment','publicKey','setDate','TesSoft\x20Payment\x20System/1.0\x20(Test)','240039KjqufV','notes','gatewaySettings','paid','CoinToPay','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','Noda','split','\x20USDT\x20(current\x20balance)','📅\x20Date\x20start:\x20','filter','createPayment','get','KLYME\x20GB','shopUrl','./currencyService','customerEmail','📅\x20Period\x20end:\x20','getPayouts','fullName','shopId','getGatewayDisplayName','revenue','network','Rapyd','getDate','isArray','merchantUrl','sourceCurrency','724857UahHrv','./paymentService','currencyService','13047LOzKoD','KLYME\x20EU','ceil','findFirst','error','event','30d','findUnique','stringify','lte','desc','erc20','awaitingPayout','863555hfzXPa','getPayoutStats','set','amount','status','getPayoutStatistics','delete','amountUSDT','wallets','Webhook\x20returned\x20error:\x20','asc','ShopService','updatePayment','gateway','testWebhook','map','usdcPolygonWallet','\x20\x20\x20💵\x20Available\x20balance:\x20','Test\x20webhook\x20sent\x20successfully\x20(','📊\x20Status\x20filter:\x20','getPayments','Error\x20parsing\x20webhook\x20events:','112iEqArU','setHours','getStatistics','log','redirectUrl','test','__importDefault','test_order_123','\x20\x20\x20💰\x20Total\x20paid\x20out:\x20','USD','paymentGateways','paymentService','getPayoutById','language','all','webhookEvents','usage','Shop\x20not\x20found','application/json','updateShopProfile','11932xHfOtV','createPublicPayment','reduce','2287923XbgCwK','...','usdtPolygonWallet','PaymentService','gte','periodFrom','createdAt','90d','shop','update','payout','convertToUSDT','customer','balance','getPaymentByShopAndId','getFullYear','usdtErcWallet','COMPLETED','\x20USDT\x20(total\x20payouts)','REJECTED','getMonth','\x20payout\x20statistics\x20calculated:','📊\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','6ioKMSG','default','totalPaidOut','aggregate','currency','test_gateway','gateways','polygon_usdc','toISOString','findMany','paidAt','PENDING','test_payment_123','thisMonth','txid','PAID','customerName','generateDailyStatistics','Payment\x20not\x20found','telegramId','getTime','USDT\x20BSC','dailyPayments','2607800xfFioc','52GYCZHQ','dailyRevenue','parse','getPaymentsByShop','\x20\x20\x20📅\x20This\x20month:\x20','settings','webhookUrl','formatNetworkName','__esModule','paymentId','📊\x20Shop\x20','periodTo','round'];a57_0x1227=function(){return _0x28a6ec;};return a57_0x1227();}