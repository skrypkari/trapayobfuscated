'use strict';function a86_0xb446(_0x59bf7f,_0x4c3e8b){_0x59bf7f=_0x59bf7f-0x16a;const _0xa3dabd=a86_0xa3da();let _0xb4461d=_0xa3dabd[_0x59bf7f];return _0xb4461d;}const a86_0x46e82f=a86_0xb446;(function(_0x5be554,_0xeee8d3){const _0x4d5e2a=a86_0xb446,_0x4548ed=_0x5be554();while(!![]){try{const _0x275f1d=-parseInt(_0x4d5e2a(0x244))/0x1*(parseInt(_0x4d5e2a(0x17e))/0x2)+-parseInt(_0x4d5e2a(0x222))/0x3*(-parseInt(_0x4d5e2a(0x1f8))/0x4)+parseInt(_0x4d5e2a(0x25e))/0x5*(-parseInt(_0x4d5e2a(0x1a0))/0x6)+parseInt(_0x4d5e2a(0x25a))/0x7*(-parseInt(_0x4d5e2a(0x182))/0x8)+-parseInt(_0x4d5e2a(0x1d5))/0x9*(-parseInt(_0x4d5e2a(0x1de))/0xa)+parseInt(_0x4d5e2a(0x23c))/0xb*(parseInt(_0x4d5e2a(0x1be))/0xc)+-parseInt(_0x4d5e2a(0x20d))/0xd;if(_0x275f1d===_0xeee8d3)break;else _0x4548ed['push'](_0x4548ed['shift']());}catch(_0x1eb22a){_0x4548ed['push'](_0x4548ed['shift']());}}}(a86_0xa3da,0x3b051));var __importDefault=this&&this[a86_0x46e82f(0x1ce)]||function(_0x28f96e){const _0x216c2d=a86_0x46e82f;return _0x28f96e&&_0x28f96e[_0x216c2d(0x1cd)]?_0x28f96e:{'default':_0x28f96e};};Object[a86_0x46e82f(0x1ee)](exports,a86_0x46e82f(0x1cd),{'value':!![]}),exports[a86_0x46e82f(0x1e1)]=void 0x0;const database_1=__importDefault(require(a86_0x46e82f(0x1a7))),bcryptjs_1=__importDefault(require(a86_0x46e82f(0x1c9))),crypto_1=__importDefault(require(a86_0x46e82f(0x1e3))),speakeasy_1=__importDefault(require(a86_0x46e82f(0x1c0))),qrcode_1=__importDefault(require(a86_0x46e82f(0x1fe))),currencyService_1=require(a86_0x46e82f(0x224)),paymentService_1=require(a86_0x46e82f(0x1b6)),gateway_1=require('../types/gateway');class ShopService{constructor(){const _0x55c753=a86_0x46e82f;this['paymentService']=new paymentService_1[(_0x55c753(0x260))]();}async[a86_0x46e82f(0x250)](_0x3d80a7){const _0x47fde6=a86_0x46e82f,_0x376397=await database_1['default'][_0x47fde6(0x254)][_0x47fde6(0x185)]({'where':{'id':_0x3d80a7},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x376397)throw new Error(_0x47fde6(0x209));let _0xb949d9=[];if(_0x376397[_0x47fde6(0x213)]?.[_0x47fde6(0x24b)])try{_0xb949d9=Array[_0x47fde6(0x1e7)](_0x376397[_0x47fde6(0x213)][_0x47fde6(0x24b)])?_0x376397['settings'][_0x47fde6(0x24b)]:JSON[_0x47fde6(0x19d)](_0x376397[_0x47fde6(0x213)][_0x47fde6(0x24b)]);}catch(_0x333be0){console[_0x47fde6(0x187)]('Error\x20parsing\x20webhook\x20events:',_0x333be0),_0xb949d9=[];}const _0x2a934d=gateway_1[_0x47fde6(0x259)][_0x47fde6(0x25b)](_0x21e903=>_0x21e903[_0x47fde6(0x173)])['map'](_0x20b051=>_0x20b051[_0x47fde6(0x1aa)]);let _0x552152=_0x376397['paymentGateways']?JSON[_0x47fde6(0x19d)](_0x376397[_0x47fde6(0x1ec)]):[];return Array[_0x47fde6(0x1e7)](_0x552152)&&(_0x552152=_0x552152['map'](_0x33c495=>_0x33c495[_0x47fde6(0x1da)](/\s+/g,'_')[_0x47fde6(0x200)]())['filter'](_0x529aa4=>_0x2a934d[_0x47fde6(0x1ea)](_0x529aa4))),{'id':_0x376397['id'],'fullName':_0x376397[_0x47fde6(0x1aa)],'username':_0x376397[_0x47fde6(0x251)],'telegramId':_0x376397[_0x47fde6(0x215)],'merchantUrl':_0x376397['shopUrl'],'gateways':_0x552152,'gatewaySettings':_0x376397['gatewaySettings']?JSON[_0x47fde6(0x19d)](_0x376397[_0x47fde6(0x1f4)]):null,'publicKey':_0x376397[_0x47fde6(0x1f0)],'secretKey':_0x376397[_0x47fde6(0x1ff)],'webhookUrl':_0x376397[_0x47fde6(0x213)]?.[_0x47fde6(0x236)]||null,'webhookEvents':_0xb949d9,'wallets':{'usdtPolygonWallet':_0x376397[_0x47fde6(0x256)],'usdtTrcWallet':_0x376397[_0x47fde6(0x199)],'usdtErcWallet':_0x376397[_0x47fde6(0x1dc)],'usdcPolygonWallet':_0x376397['usdcPolygonWallet'],'usdcErcWallet':_0x376397['usdcErcWallet']},'status':_0x376397[_0x47fde6(0x1f9)],'createdAt':_0x376397[_0x47fde6(0x1e0)]};}async[a86_0x46e82f(0x1ef)](_0x4c2767,_0x49126d){const _0x1fa3d4=a86_0x46e82f,_0x3d836c={};_0x49126d[_0x1fa3d4(0x16d)]&&(_0x3d836c[_0x1fa3d4(0x1aa)]=_0x49126d[_0x1fa3d4(0x16d)]);_0x49126d['telegramId']!==undefined&&(_0x3d836c[_0x1fa3d4(0x215)]=_0x49126d[_0x1fa3d4(0x1a4)]||null);_0x49126d[_0x1fa3d4(0x253)]&&(_0x3d836c[_0x1fa3d4(0x229)]=_0x49126d[_0x1fa3d4(0x253)]);_0x49126d[_0x1fa3d4(0x192)]&&(_0x3d836c[_0x1fa3d4(0x1ec)]=JSON[_0x1fa3d4(0x190)](_0x49126d[_0x1fa3d4(0x192)]));_0x49126d['gatewaySettings']&&(_0x3d836c[_0x1fa3d4(0x1f4)]=JSON[_0x1fa3d4(0x190)](_0x49126d['gatewaySettings']));_0x49126d[_0x1fa3d4(0x1e5)]&&(_0x49126d[_0x1fa3d4(0x1e5)][_0x1fa3d4(0x256)]!==undefined&&(_0x3d836c[_0x1fa3d4(0x256)]=_0x49126d['wallets']['usdtPolygonWallet']||null),_0x49126d[_0x1fa3d4(0x1e5)][_0x1fa3d4(0x199)]!==undefined&&(_0x3d836c['usdtTrcWallet']=_0x49126d[_0x1fa3d4(0x1e5)][_0x1fa3d4(0x199)]||null),_0x49126d[_0x1fa3d4(0x1e5)]['usdtErcWallet']!==undefined&&(_0x3d836c[_0x1fa3d4(0x1dc)]=_0x49126d[_0x1fa3d4(0x1e5)][_0x1fa3d4(0x1dc)]||null),_0x49126d[_0x1fa3d4(0x1e5)][_0x1fa3d4(0x16e)]!==undefined&&(_0x3d836c[_0x1fa3d4(0x16e)]=_0x49126d[_0x1fa3d4(0x1e5)][_0x1fa3d4(0x16e)]||null));const _0x2fff9d=await database_1[_0x1fa3d4(0x237)][_0x1fa3d4(0x254)][_0x1fa3d4(0x25f)]({'where':{'id':_0x4c2767},'data':_0x3d836c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2e2169=[];if(_0x2fff9d[_0x1fa3d4(0x213)]?.[_0x1fa3d4(0x24b)])try{_0x2e2169=Array['isArray'](_0x2fff9d[_0x1fa3d4(0x213)]['webhookEvents'])?_0x2fff9d[_0x1fa3d4(0x213)]['webhookEvents']:JSON['parse'](_0x2fff9d['settings']['webhookEvents']);}catch(_0xe8f589){console[_0x1fa3d4(0x187)]('Error\x20parsing\x20webhook\x20events:',_0xe8f589),_0x2e2169=[];}return{'id':_0x2fff9d['id'],'fullName':_0x2fff9d[_0x1fa3d4(0x1aa)],'username':_0x2fff9d['username'],'telegramId':_0x2fff9d['telegram'],'merchantUrl':_0x2fff9d['shopUrl'],'gateways':_0x2fff9d[_0x1fa3d4(0x1ec)]?JSON[_0x1fa3d4(0x19d)](_0x2fff9d[_0x1fa3d4(0x1ec)]):null,'gatewaySettings':_0x2fff9d[_0x1fa3d4(0x1f4)]?JSON[_0x1fa3d4(0x19d)](_0x2fff9d[_0x1fa3d4(0x1f4)]):null,'publicKey':_0x2fff9d[_0x1fa3d4(0x1f0)],'secretKey':_0x2fff9d[_0x1fa3d4(0x1ff)],'webhookUrl':_0x2fff9d[_0x1fa3d4(0x213)]?.[_0x1fa3d4(0x236)]||null,'webhookEvents':_0x2e2169,'wallets':{'usdtPolygonWallet':_0x2fff9d[_0x1fa3d4(0x256)],'usdtTrcWallet':_0x2fff9d[_0x1fa3d4(0x199)],'usdtErcWallet':_0x2fff9d[_0x1fa3d4(0x1dc)],'usdcPolygonWallet':_0x2fff9d[_0x1fa3d4(0x16e)],'usdcErcWallet':_0x2fff9d[_0x1fa3d4(0x246)]},'status':_0x2fff9d[_0x1fa3d4(0x1f9)],'createdAt':_0x2fff9d[_0x1fa3d4(0x1e0)]};}async[a86_0x46e82f(0x1f3)](_0xf2d723,_0x3c1365){const _0x4c88cc=a86_0x46e82f,_0xa49d9c=await database_1[_0x4c88cc(0x237)][_0x4c88cc(0x254)][_0x4c88cc(0x185)]({'where':{'id':_0xf2d723},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0xa49d9c)throw new Error(_0x4c88cc(0x209));if(_0xa49d9c[_0x4c88cc(0x1fc)]){if(!_0x3c1365[_0x4c88cc(0x19f)])throw new Error('2FA\x20token\x20is\x20required');const _0x439f95=speakeasy_1[_0x4c88cc(0x237)][_0x4c88cc(0x1a6)]['verify']({'secret':_0xa49d9c[_0x4c88cc(0x184)],'encoding':_0x4c88cc(0x25c),'token':_0x3c1365[_0x4c88cc(0x19f)],'window':0x2});if(!_0x439f95){let _0x4ac607=![];if(_0xa49d9c[_0x4c88cc(0x22e)]){const _0x4a04d6=JSON[_0x4c88cc(0x19d)](_0xa49d9c['backupCodes']);for(let _0xd776ec=0x0;_0xd776ec<_0x4a04d6[_0x4c88cc(0x1cf)];_0xd776ec++){const _0x3a101e=await bcryptjs_1[_0x4c88cc(0x237)][_0x4c88cc(0x238)](_0x3c1365[_0x4c88cc(0x19f)],_0x4a04d6[_0xd776ec]);if(_0x3a101e){_0x4ac607=!![],_0x4a04d6[_0x4c88cc(0x247)](_0xd776ec,0x1),await database_1[_0x4c88cc(0x237)][_0x4c88cc(0x254)]['update']({'where':{'id':_0xf2d723},'data':{'backupCodes':JSON[_0x4c88cc(0x190)](_0x4a04d6)}});break;}}}if(!_0x4ac607)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x4189c2={};_0x3c1365['usdtPolygonWallet']!==undefined&&(_0x4189c2[_0x4c88cc(0x256)]=_0x3c1365[_0x4c88cc(0x256)]||null),_0x3c1365['usdtTrcWallet']!==undefined&&(_0x4189c2[_0x4c88cc(0x199)]=_0x3c1365['usdtTrcWallet']||null),_0x3c1365[_0x4c88cc(0x1dc)]!==undefined&&(_0x4189c2[_0x4c88cc(0x1dc)]=_0x3c1365[_0x4c88cc(0x1dc)]||null),_0x3c1365[_0x4c88cc(0x16e)]!==undefined&&(_0x4189c2[_0x4c88cc(0x16e)]=_0x3c1365[_0x4c88cc(0x16e)]||null),_0x3c1365[_0x4c88cc(0x246)]!==undefined&&(_0x4189c2[_0x4c88cc(0x246)]=_0x3c1365[_0x4c88cc(0x246)]||null),await database_1[_0x4c88cc(0x237)][_0x4c88cc(0x254)][_0x4c88cc(0x25f)]({'where':{'id':_0xf2d723},'data':_0x4189c2});}async[a86_0x46e82f(0x21c)](_0x37ea81){const _0x77726=a86_0x46e82f,_0x3624a1=await database_1[_0x77726(0x237)][_0x77726(0x254)][_0x77726(0x185)]({'where':{'id':_0x37ea81},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3624a1?.[_0x77726(0x213)]?.[_0x77726(0x236)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x134504={'event':_0x77726(0x1af),'payment':{'id':_0x77726(0x17c),'order_id':_0x77726(0x22f),'gateway':_0x77726(0x1af),'amount':0x64,'currency':_0x77726(0x217),'status':_0x77726(0x1f1),'created_at':new Date()['toISOString']()}};try{const _0x4f6fb4=JSON[_0x77726(0x190)](_0x134504),_0x5f5dbb=crypto_1['default'][_0x77726(0x1bc)](_0x77726(0x228),_0x3624a1[_0x77726(0x1ff)])[_0x77726(0x25f)](_0x4f6fb4)[_0x77726(0x19b)](_0x77726(0x18d)),_0x1c9769=await fetch(_0x3624a1[_0x77726(0x213)][_0x77726(0x236)],{'method':_0x77726(0x22a),'headers':{'Content-Type':_0x77726(0x1cb),'User-Agent':_0x77726(0x202),'X-Webhook-Signature':_0x5f5dbb},'body':_0x4f6fb4});return _0x1c9769['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x1c9769['status']+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x1c9769['status']+'\x20'+_0x1c9769[_0x77726(0x223)]};}catch(_0x531104){return{'success':![],'message':_0x77726(0x249)+(_0x531104 instanceof Error?_0x531104['message']:_0x77726(0x1c6))};}}async['createPayment'](_0x2ae5c8){const _0x132206=a86_0x46e82f;return this[_0x132206(0x257)][_0x132206(0x20b)]({'public_key':'','gateway':_0x2ae5c8[_0x132206(0x1d9)],'order_id':undefined,'amount':_0x2ae5c8[_0x132206(0x19e)],'currency':_0x2ae5c8[_0x132206(0x219)],'source_currency':_0x2ae5c8[_0x132206(0x194)],'usage':_0x2ae5c8[_0x132206(0x191)],'expires_at':_0x2ae5c8[_0x132206(0x218)]?.[_0x132206(0x248)](),'success_url':_0x2ae5c8[_0x132206(0x175)],'fail_url':_0x2ae5c8[_0x132206(0x175)],'customer_email':_0x2ae5c8[_0x132206(0x180)],'customer_name':_0x2ae5c8[_0x132206(0x176)],'country':_0x2ae5c8[_0x132206(0x212)],'language':_0x2ae5c8[_0x132206(0x1c8)],'amount_is_editable':_0x2ae5c8[_0x132206(0x18b)],'max_payments':_0x2ae5c8[_0x132206(0x177)],'customer':_0x2ae5c8[_0x132206(0x233)]});}async[a86_0x46e82f(0x232)](_0x3818e5,_0x42d5e7){const _0x1a23f9=a86_0x46e82f;return this['paymentService'][_0x1a23f9(0x21f)](_0x3818e5,_0x42d5e7);}async[a86_0x46e82f(0x1c3)](_0x130baa,_0x488f4f){const _0x3e147a=a86_0x46e82f;return this[_0x3e147a(0x257)]['getPaymentByShopAndId'](_0x130baa,_0x488f4f);}async[a86_0x46e82f(0x23d)](_0x15f4e2,_0x3f0a91,_0x31d734){const _0x17a293=a86_0x46e82f,_0x3ee257=await database_1[_0x17a293(0x237)][_0x17a293(0x189)][_0x17a293(0x1a8)]({'where':{'id':_0x3f0a91,'shopId':_0x15f4e2}});if(!_0x3ee257)throw new Error(_0x17a293(0x174));const _0x30a413=await database_1[_0x17a293(0x237)][_0x17a293(0x189)][_0x17a293(0x25f)]({'where':{'id':_0x3f0a91},'data':{..._0x31d734,'updatedAt':new Date()}});return _0x30a413;}async[a86_0x46e82f(0x16a)](_0x375b57,_0x31f0da){const _0x3f8d20=a86_0x46e82f,_0x1d171e=await database_1[_0x3f8d20(0x237)][_0x3f8d20(0x189)][_0x3f8d20(0x1a8)]({'where':{'id':_0x31f0da,'shopId':_0x375b57}});if(!_0x1d171e)throw new Error(_0x3f8d20(0x174));await database_1[_0x3f8d20(0x237)][_0x3f8d20(0x189)]['delete']({'where':{'id':_0x31f0da}});}[a86_0x46e82f(0x1f5)](_0x94c26d){const _0x12b02f=a86_0x46e82f,_0x507160={'polygon':_0x12b02f(0x1c4),'trc20':_0x12b02f(0x1e2),'erc20':_0x12b02f(0x23e),'bsc':_0x12b02f(0x1ae),'polygon_usdc':_0x12b02f(0x1d8),'erc20_usdc':_0x12b02f(0x1a5)};return _0x507160[_0x94c26d]||_0x94c26d;}async['getPayouts'](_0x1dfbfc,_0xfea6be){const _0x1fa919=a86_0x46e82f,{page:_0x1e9423,limit:_0x440ad1,status:_0x5b6833,method:_0x2f9639,network:_0x28f7df,dateFrom:_0x4368d7,dateTo:_0x2f5c82,periodFrom:_0x493319,periodTo:_0x5a91f9}=_0xfea6be,_0x2bd957=(_0x1e9423-0x1)*_0x440ad1;console['log'](_0x1fa919(0x170),_0xfea6be);const _0x566a63={'shopId':_0x1dfbfc};_0x5b6833&&(_0x566a63[_0x1fa919(0x1f9)]=_0x5b6833['toUpperCase'](),console[_0x1fa919(0x188)](_0x1fa919(0x24e)+_0x5b6833['toUpperCase']()));if(_0x2f9639)_0x566a63[_0x1fa919(0x227)]=_0x2f9639,console[_0x1fa919(0x188)](_0x1fa919(0x1cc)+_0x2f9639);else _0x28f7df&&(_0x566a63['network']=_0x28f7df,console[_0x1fa919(0x188)](_0x1fa919(0x20f)+_0x28f7df));if(_0x4368d7||_0x2f5c82||_0x493319||_0x5a91f9){_0x566a63[_0x1fa919(0x1e0)]={};if(_0x493319){const _0xf232f2=new Date(_0x493319);_0xf232f2[_0x1fa919(0x1ad)](0x0,0x0,0x0,0x1),_0x566a63[_0x1fa919(0x1e0)]['gte']=_0xf232f2,console[_0x1fa919(0x188)]('üìÖ\x20Period\x20start:\x20'+_0xf232f2[_0x1fa919(0x248)]());}else{if(_0x4368d7){const _0x3ed70f=new Date(_0x4368d7);_0x3ed70f[_0x1fa919(0x1ad)](0x0,0x0,0x0,0x1),_0x566a63['createdAt'][_0x1fa919(0x171)]=_0x3ed70f,console[_0x1fa919(0x188)]('üìÖ\x20Date\x20start:\x20'+_0x3ed70f[_0x1fa919(0x248)]());}}if(_0x5a91f9){const _0x2558ea=new Date(_0x5a91f9);_0x2558ea['setHours'](0x17,0x3b,0x3b,0x3e7),_0x566a63[_0x1fa919(0x1e0)][_0x1fa919(0x24d)]=_0x2558ea,console['log'](_0x1fa919(0x1eb)+_0x2558ea['toISOString']());}else{if(_0x2f5c82){const _0x49241e=new Date(_0x2f5c82);_0x49241e[_0x1fa919(0x1ad)](0x17,0x3b,0x3b,0x3e7),_0x566a63[_0x1fa919(0x1e0)][_0x1fa919(0x24d)]=_0x49241e,console[_0x1fa919(0x188)](_0x1fa919(0x252)+_0x49241e[_0x1fa919(0x248)]());}}}console[_0x1fa919(0x188)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x1fa919(0x190)](_0x566a63,null,0x2));const [_0x8d4a4,_0x595dcb]=await Promise[_0x1fa919(0x1e8)]([database_1[_0x1fa919(0x237)][_0x1fa919(0x19a)][_0x1fa919(0x20c)]({'where':_0x566a63,'skip':_0x2bd957,'take':_0x440ad1,'orderBy':{'createdAt':_0x1fa919(0x1d1)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1['default'][_0x1fa919(0x19a)][_0x1fa919(0x241)]({'where':_0x566a63})]);return{'payouts':_0x8d4a4[_0x1fa919(0x198)](_0x569c5b=>{const _0x69da83=_0x1fa919;let _0x5cf68b=null;switch(_0x569c5b['network']){case'polygon':_0x5cf68b=_0x569c5b[_0x69da83(0x254)][_0x69da83(0x256)];break;case _0x69da83(0x1d6):_0x5cf68b=_0x569c5b[_0x69da83(0x254)]['usdtTrcWallet'];break;case _0x69da83(0x205):_0x5cf68b=_0x569c5b[_0x69da83(0x254)]['usdtErcWallet'];break;case _0x69da83(0x1a1):_0x5cf68b=_0x569c5b[_0x69da83(0x254)]['usdcPolygonWallet'];break;case _0x69da83(0x235):_0x5cf68b=_0x569c5b['shop'][_0x69da83(0x246)];break;}return{'id':_0x569c5b['id'],'amount':_0x569c5b[_0x69da83(0x19e)],'network':this[_0x69da83(0x1f5)](_0x569c5b[_0x69da83(0x227)]),'wallet':_0x5cf68b,'status':_0x569c5b[_0x69da83(0x1f9)],'txid':_0x569c5b['txid'],'notes':_0x569c5b[_0x69da83(0x1e6)],'periodFrom':_0x569c5b[_0x69da83(0x1ca)],'periodTo':_0x569c5b[_0x69da83(0x18e)],'createdAt':_0x569c5b[_0x69da83(0x1e0)],'paidAt':_0x569c5b[_0x69da83(0x214)]};}),'pagination':{'page':_0x1e9423,'limit':_0x440ad1,'total':_0x595dcb,'totalPages':Math[_0x1fa919(0x204)](_0x595dcb/_0x440ad1)}};}async[a86_0x46e82f(0x21d)](_0x230b5e,_0x4f0b89){const _0x53dc04=a86_0x46e82f,_0x3a5ce3=await database_1[_0x53dc04(0x237)][_0x53dc04(0x19a)][_0x53dc04(0x1a8)]({'where':{'id':_0x4f0b89,'shopId':_0x230b5e}});if(!_0x3a5ce3)return null;return{'id':_0x3a5ce3['id'],'amount':_0x3a5ce3['amount'],'network':_0x3a5ce3[_0x53dc04(0x227)],'status':_0x3a5ce3[_0x53dc04(0x1f9)],'txid':_0x3a5ce3['txid'],'notes':_0x3a5ce3[_0x53dc04(0x1e6)],'createdAt':_0x3a5ce3[_0x53dc04(0x1e0)],'paidAt':_0x3a5ce3['paidAt']};}async[a86_0x46e82f(0x207)](_0x5ea844,_0x3d7228){const _0x20866b=a86_0x46e82f,_0x3a9588=new Date();let _0x55857d,_0x119a89;switch(_0x3d7228){case'yesterday':case _0x20866b(0x1ba):const _0x9a5ad7=new Date(_0x3a9588);_0x9a5ad7[_0x20866b(0x240)](_0x9a5ad7[_0x20866b(0x197)]()-0x1),_0x55857d=new Date(_0x9a5ad7),_0x55857d[_0x20866b(0x1ad)](0x0,0x0,0x0,0x0),_0x119a89=new Date(_0x9a5ad7),_0x119a89[_0x20866b(0x1ad)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x55857d=new Date(_0x3a9588[_0x20866b(0x258)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x55857d=new Date(_0x3a9588['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x55857d=new Date(_0x3a9588[_0x20866b(0x258)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x55857d=new Date(_0x3a9588['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x952908={'gte':_0x55857d};_0x119a89&&(_0x952908[_0x20866b(0x24d)]=_0x119a89);const [_0x2c2be1,_0x13f5c0,_0x3d750a,_0x2d1635,_0x1fd8cf,_0x3314c7]=await Promise[_0x20866b(0x1e8)]([database_1[_0x20866b(0x237)][_0x20866b(0x19a)][_0x20866b(0x241)]({'where':{'shopId':_0x5ea844,'createdAt':_0x952908}}),database_1[_0x20866b(0x237)][_0x20866b(0x19a)][_0x20866b(0x241)]({'where':{'shopId':_0x5ea844,'status':_0x20866b(0x226),'createdAt':_0x952908}}),database_1[_0x20866b(0x237)]['payout'][_0x20866b(0x241)]({'where':{'shopId':_0x5ea844,'status':_0x20866b(0x19c),'createdAt':_0x952908}}),database_1[_0x20866b(0x237)]['payout'][_0x20866b(0x241)]({'where':{'shopId':_0x5ea844,'status':_0x20866b(0x196),'createdAt':_0x952908}}),database_1[_0x20866b(0x237)][_0x20866b(0x19a)][_0x20866b(0x20c)]({'where':{'shopId':_0x5ea844,'createdAt':_0x952908},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x20866b(0x237)]['payout'][_0x20866b(0x20c)]({'where':{'shopId':_0x5ea844},'take':0xa,'orderBy':{'createdAt':_0x20866b(0x1d1)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x10b416=_0x1fd8cf['reduce']((_0x4ed177,_0x2ba716)=>_0x4ed177+_0x2ba716[_0x20866b(0x19e)],0x0),_0x365254=_0x1fd8cf[_0x20866b(0x25b)](_0x46c130=>_0x46c130['status']==='COMPLETED')['reduce']((_0x282d95,_0x45b2d8)=>_0x282d95+_0x45b2d8['amount'],0x0),_0x250f2f=_0x1fd8cf[_0x20866b(0x25b)](_0x1f558a=>_0x1f558a[_0x20866b(0x1f9)]===_0x20866b(0x19c))[_0x20866b(0x1fa)]((_0x538e74,_0xa6b50)=>_0x538e74+_0xa6b50['amount'],0x0),_0xc097a7=_0x1fd8cf[_0x20866b(0x1fa)]((_0x4342ad,_0x13bbc7)=>{const _0xf1a328=_0x20866b;return _0x4342ad[_0x13bbc7[_0xf1a328(0x227)]]=(_0x4342ad[_0x13bbc7[_0xf1a328(0x227)]]||0x0)+0x1,_0x4342ad;},{}),_0x1ebdeb=_0x1fd8cf[_0x20866b(0x1fa)]((_0x15968d,_0xfcf90f)=>{const _0x52f022=_0x20866b;return _0x15968d[_0xfcf90f['status']]=(_0x15968d[_0xfcf90f[_0x52f022(0x1f9)]]||0x0)+0x1,_0x15968d;},{});return{'totalPayouts':_0x2c2be1,'completedPayouts':_0x13f5c0,'pendingPayouts':_0x3d750a,'rejectedPayouts':_0x2d1635,'totalAmount':_0x10b416,'completedAmount':_0x365254,'pendingAmount':_0x250f2f,'payoutsByMethod':_0xc097a7,'payoutsByStatus':_0x1ebdeb,'recentPayouts':_0x3314c7['map'](_0x530d06=>({'id':_0x530d06['id'],'shopId':_0x5ea844,'amount':_0x530d06[_0x20866b(0x19e)],'method':_0x530d06['network'],'status':_0x530d06['status'],'txid':_0x530d06[_0x20866b(0x245)],'createdAt':_0x530d06[_0x20866b(0x1e0)],'paidAt':_0x530d06[_0x20866b(0x214)]}))};}async['getShopPayoutStats'](_0x9064f3){const _0x1bbbf6=a86_0x46e82f;console[_0x1bbbf6(0x188)](_0x1bbbf6(0x23b)+_0x9064f3+_0x1bbbf6(0x1f6));const _0x4ea5b0=await database_1['default'][_0x1bbbf6(0x254)]['findUnique']({'where':{'id':_0x9064f3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4ea5b0)throw new Error(_0x1bbbf6(0x209));const _0xa6a1b6=new Date(),_0x556819=new Date(_0xa6a1b6[_0x1bbbf6(0x1f2)](),_0xa6a1b6['getMonth'](),0x1),_0x3fb72b=new Date(_0xa6a1b6[_0x1bbbf6(0x1f2)](),_0xa6a1b6[_0x1bbbf6(0x239)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xbd575a=await database_1['default']['payout'][_0x1bbbf6(0x186)]({'_sum':{'amount':!![]},'where':{'shopId':_0x9064f3,'createdAt':{'gte':_0x556819,'lte':_0x3fb72b},'status':'COMPLETED'}}),_0x16177e=_0xbd575a['_sum'][_0x1bbbf6(0x19e)]||0x0,_0x379f8={'availableBalance':Math['round'](_0x4ea5b0[_0x1bbbf6(0x1c7)]*0x64)/0x64,'totalPaidOut':Math[_0x1bbbf6(0x183)](_0x4ea5b0[_0x1bbbf6(0x1fd)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x4ea5b0[_0x1bbbf6(0x1c7)]*0x64)/0x64,'thisMonth':Math[_0x1bbbf6(0x183)](_0x16177e*0x64)/0x64};return console[_0x1bbbf6(0x188)]('üìä\x20Shop\x20'+_0x4ea5b0[_0x1bbbf6(0x251)]+_0x1bbbf6(0x1bd)),console['log'](_0x1bbbf6(0x1d4)+_0x379f8['availableBalance']+_0x1bbbf6(0x20e)),console[_0x1bbbf6(0x188)](_0x1bbbf6(0x24a)+_0x379f8[_0x1bbbf6(0x1fd)]+'\x20USDT\x20(total\x20payouts)'),console[_0x1bbbf6(0x188)](_0x1bbbf6(0x206)+_0x379f8[_0x1bbbf6(0x1c2)]+_0x1bbbf6(0x20e)),console[_0x1bbbf6(0x188)](_0x1bbbf6(0x255)+_0x379f8[_0x1bbbf6(0x231)]+_0x1bbbf6(0x1e4)),_0x379f8;}[a86_0x46e82f(0x216)](_0x57a7bd){const _0x1d1b54=a86_0x46e82f,_0x3b8cc7={'test_gateway':_0x1d1b54(0x221),'plisio':_0x1d1b54(0x210),'rapyd':'Rapyd','noda':_0x1d1b54(0x1df),'cointopay':_0x1d1b54(0x243),'klyme_eu':_0x1d1b54(0x1b7),'klyme_gb':_0x1d1b54(0x23f),'klyme_de':_0x1d1b54(0x16c)};return _0x3b8cc7[_0x57a7bd]||_0x57a7bd;}async[a86_0x46e82f(0x1b2)](_0x178888){const _0x2768fe=a86_0x46e82f;return this[_0x2768fe(0x1c5)](_0x178888);}async[a86_0x46e82f(0x1ab)](_0xb37346,_0x40fe12){const _0x4036b7=a86_0x46e82f,{page:_0x1dab59,limit:_0x764161,paymentId:_0x317861}=_0x40fe12,_0x32204b=(_0x1dab59-0x1)*_0x764161,_0x48746a={'shopId':_0xb37346};_0x317861&&(_0x48746a[_0x4036b7(0x220)]=_0x317861);const [_0x54ff71,_0x23d8f9]=await Promise[_0x4036b7(0x1e8)]([database_1[_0x4036b7(0x237)][_0x4036b7(0x1b1)][_0x4036b7(0x20c)]({'where':_0x48746a,'skip':_0x32204b,'take':_0x764161,'orderBy':{'createdAt':_0x4036b7(0x1d1)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x4036b7(0x1b1)][_0x4036b7(0x241)]({'where':_0x48746a})]);return{'logs':_0x54ff71['map'](_0xec3788=>({'id':_0xec3788['id'],'paymentId':_0xec3788[_0x4036b7(0x220)],'shopId':_0xec3788[_0x4036b7(0x21a)],'event':_0xec3788['event'],'statusCode':_0xec3788[_0x4036b7(0x201)],'retryCount':_0xec3788['retryCount'],'responseBody':_0xec3788['responseBody'],'createdAt':_0xec3788[_0x4036b7(0x1e0)],'payment':_0xec3788[_0x4036b7(0x189)]})),'pagination':{'page':_0x1dab59,'limit':_0x764161,'total':_0x23d8f9,'totalPages':Math[_0x4036b7(0x204)](_0x23d8f9/_0x764161)}};}async[a86_0x46e82f(0x1b4)](_0x43343e,_0x5afea6,_0x26be71,_0x83e2b7,_0x1b14a0){const _0x8d2dc7=a86_0x46e82f;console[_0x8d2dc7(0x188)](_0x8d2dc7(0x1a9)+_0x43343e+_0x8d2dc7(0x1a3)+_0x5afea6+_0x8d2dc7(0x178)+_0x26be71+_0x8d2dc7(0x22c)+_0x83e2b7);const _0xe2832c=_0x1b14a0?new Date(_0x1b14a0):new Date();let _0x47ddfa,_0x311b64;if(_0x26be71&&_0x83e2b7){const _0x1ee651=new Date(_0x26be71),_0x494b2b=new Date(_0x83e2b7);_0x47ddfa=new Date(Date[_0x8d2dc7(0x1db)](_0x1ee651[_0x8d2dc7(0x22d)](),_0x1ee651['getUTCMonth'](),_0x1ee651[_0x8d2dc7(0x21e)](),0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date[_0x8d2dc7(0x1db)](_0x494b2b['getUTCFullYear'](),_0x494b2b[_0x8d2dc7(0x1bf)](),_0x494b2b[_0x8d2dc7(0x21e)](),0x17,0x3b,0x3b,0x3e7)),console['log'](_0x8d2dc7(0x242)+_0x47ddfa['toISOString']()+_0x8d2dc7(0x172)+_0x311b64[_0x8d2dc7(0x248)]());}else{if(_0x5afea6&&_0x5afea6[_0x8d2dc7(0x1a2)](_0x8d2dc7(0x1b8))){const _0x46c4ad=_0x5afea6[_0x8d2dc7(0x1da)](_0x8d2dc7(0x1b8),'')[_0x8d2dc7(0x1d7)]('_');if(_0x46c4ad['length']===0x2){const _0x48deaf=new Date(_0x46c4ad[0x0]),_0xe87ae0=new Date(_0x46c4ad[0x1]);_0x47ddfa=new Date(Date[_0x8d2dc7(0x1db)](_0x48deaf['getUTCFullYear'](),_0x48deaf[_0x8d2dc7(0x1bf)](),_0x48deaf[_0x8d2dc7(0x21e)](),0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date['UTC'](_0xe87ae0['getUTCFullYear'](),_0xe87ae0[_0x8d2dc7(0x1bf)](),_0xe87ae0[_0x8d2dc7(0x21e)](),0x17,0x3b,0x3b,0x3e7)),console[_0x8d2dc7(0x188)](_0x8d2dc7(0x203)+_0x47ddfa['toISOString']()+_0x8d2dc7(0x172)+_0x311b64[_0x8d2dc7(0x248)]());}else{const _0x3e2b79=new Date(Date['UTC'](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0xe2832c[_0x8d2dc7(0x21e)]()-0x1e));_0x47ddfa=new Date(Date['UTC'](_0x3e2b79['getUTCFullYear'](),_0x3e2b79[_0x8d2dc7(0x1bf)](),_0x3e2b79[_0x8d2dc7(0x21e)](),0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date['UTC'](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0xe2832c[_0x8d2dc7(0x21e)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x229fd8=_0x5afea6||'this_month';switch(_0x229fd8[_0x8d2dc7(0x200)]()){case _0x8d2dc7(0x24f):_0x47ddfa=new Date(Date['UTC'](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c['getUTCMonth'](),_0xe2832c[_0x8d2dc7(0x21e)](),0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date['UTC'](_0xe2832c['getUTCFullYear'](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0xe2832c[_0x8d2dc7(0x21e)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x2e164a=new Date(_0xe2832c);_0x2e164a[_0x8d2dc7(0x230)](_0x2e164a['getUTCDate']()-0x1),_0x47ddfa=new Date(Date['UTC'](_0x2e164a[_0x8d2dc7(0x22d)](),_0x2e164a[_0x8d2dc7(0x1bf)](),_0x2e164a['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date[_0x8d2dc7(0x1db)](_0x2e164a['getUTCFullYear'](),_0x2e164a[_0x8d2dc7(0x1bf)](),_0x2e164a[_0x8d2dc7(0x21e)](),0x17,0x3b,0x3b,0x3e7));break;case _0x8d2dc7(0x23a):const _0x4adc76=_0xe2832c[_0x8d2dc7(0x22b)](),_0x23dda3=_0x4adc76===0x0?-0x6:0x1-_0x4adc76,_0x3eb056=_0xe2832c[_0x8d2dc7(0x21e)]()+_0x23dda3;_0x47ddfa=new Date(Date[_0x8d2dc7(0x1db)](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0x3eb056,0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date['UTC'](_0xe2832c['getUTCFullYear'](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0xe2832c['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x8d2dc7(0x18a):const _0x34894e=new Date(Date[_0x8d2dc7(0x1db)](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c['getUTCMonth'](),_0xe2832c[_0x8d2dc7(0x21e)]()-0x7)),_0x19eec8=_0x34894e[_0x8d2dc7(0x22b)](),_0x29f2a7=_0x19eec8===0x0?-0x6:0x1-_0x19eec8,_0x3eda76=_0x34894e['getUTCDate']()+_0x29f2a7;_0x47ddfa=new Date(Date['UTC'](_0x34894e[_0x8d2dc7(0x22d)](),_0x34894e[_0x8d2dc7(0x1bf)](),_0x3eda76,0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date[_0x8d2dc7(0x1db)](_0x34894e['getUTCFullYear'](),_0x34894e[_0x8d2dc7(0x1bf)](),_0x3eda76+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x8d2dc7(0x1b9):_0x47ddfa=new Date(Date['UTC'](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date[_0x8d2dc7(0x1db)](_0xe2832c['getUTCFullYear'](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0xe2832c['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x47ddfa=new Date(Date[_0x8d2dc7(0x1db)](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c[_0x8d2dc7(0x1bf)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date[_0x8d2dc7(0x1db)](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c[_0x8d2dc7(0x1bf)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x47ddfa=new Date(Date[_0x8d2dc7(0x1db)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date[_0x8d2dc7(0x1db)](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0xe2832c[_0x8d2dc7(0x21e)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x47ddfa=new Date(Date['UTC'](_0xe2832c[_0x8d2dc7(0x22d)](),_0xe2832c[_0x8d2dc7(0x1bf)](),0x1,0x0,0x0,0x0,0x0)),_0x311b64=new Date(Date[_0x8d2dc7(0x1db)](_0xe2832c['getUTCFullYear'](),_0xe2832c[_0x8d2dc7(0x1bf)](),_0xe2832c[_0x8d2dc7(0x21e)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x8d2dc7(0x188)]('üìÖ\x20Final\x20date\x20range:\x20'+_0x47ddfa[_0x8d2dc7(0x248)]()+_0x8d2dc7(0x172)+_0x311b64[_0x8d2dc7(0x248)]());const _0x2745ec={'gte':_0x47ddfa,'lte':_0x311b64},[_0x30d1fd,_0x439608,_0x2c7eaa,_0x316537,_0x2fd51a,_0xef5447,_0xfed644,_0x1e3751,_0x38a07e,_0x32caef,_0x57d2d3]=await Promise['all']([database_1['default'][_0x8d2dc7(0x189)]['count']({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)},'status':{'notIn':[_0x8d2dc7(0x19c),_0x8d2dc7(0x193)]},'createdAt':_0x2745ec}}),database_1['default']['payment'][_0x8d2dc7(0x241)]({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)},'status':_0x8d2dc7(0x20a),'createdAt':_0x2745ec}}),database_1['default'][_0x8d2dc7(0x189)][_0x8d2dc7(0x241)]({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)},'status':_0x8d2dc7(0x17f)}}),database_1[_0x8d2dc7(0x237)][_0x8d2dc7(0x189)][_0x8d2dc7(0x241)]({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)},'status':'REFUND'}}),database_1['default'][_0x8d2dc7(0x189)]['findMany']({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)},'status':_0x8d2dc7(0x20a),'createdAt':_0x2745ec},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x8d2dc7(0x189)][_0x8d2dc7(0x20c)]({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)}},'take':0x4,'orderBy':{'createdAt':_0x8d2dc7(0x1d1)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x8d2dc7(0x189)][_0x8d2dc7(0x20c)]({'where':{'shopId':_0x43343e,'gateway':{'not':'test_gateway'},'createdAt':_0x2745ec},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x8d2dc7(0x1c1)}}),database_1[_0x8d2dc7(0x237)]['payment'][_0x8d2dc7(0x241)]({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)},'status':'PAID'}}),database_1[_0x8d2dc7(0x237)]['payment'][_0x8d2dc7(0x20c)]({'where':{'shopId':_0x43343e,'gateway':{'not':'test_gateway'},'status':_0x8d2dc7(0x20a)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x8d2dc7(0x237)]['shop']['findUnique']({'where':{'id':_0x43343e},'select':{'balance':!![]}}),database_1[_0x8d2dc7(0x237)][_0x8d2dc7(0x189)][_0x8d2dc7(0x20c)]({'where':{'shopId':_0x43343e,'gateway':{'not':_0x8d2dc7(0x1b5)}},'select':{'gateway':!![]}})]),_0x4c08ed={};for(const _0x869611 of _0x57d2d3){_0x869611[_0x8d2dc7(0x1d9)]&&(_0x4c08ed[_0x869611[_0x8d2dc7(0x1d9)]]=(_0x4c08ed[_0x869611[_0x8d2dc7(0x1d9)]]||0x0)+0x1);}console[_0x8d2dc7(0x188)](_0x8d2dc7(0x18f),_0x4c08ed);let _0x5abd9e=0x0,_0x2fa35e=0x0;for(const _0x3bd51e of _0x2fd51a){if(_0x3bd51e[_0x8d2dc7(0x1b3)])_0x5abd9e+=_0x3bd51e['amountUSDT'];else{const _0x1dd6a1=await currencyService_1[_0x8d2dc7(0x1f7)][_0x8d2dc7(0x181)](_0x3bd51e[_0x8d2dc7(0x19e)],_0x3bd51e[_0x8d2dc7(0x219)]);_0x5abd9e+=_0x1dd6a1;}_0x3bd51e[_0x8d2dc7(0x1ac)]&&(_0x2fa35e+=_0x3bd51e['amountAfterGatewayCommissionUSDT']);}let _0x309f1a=0x0;for(const _0x2d070d of _0x38a07e){_0x2d070d['amountAfterGatewayCommissionUSDT']&&(_0x309f1a+=_0x2d070d[_0x8d2dc7(0x1ac)]);}const _0x23ec2d=this[_0x8d2dc7(0x1dd)](_0xfed644,_0x47ddfa,_0x311b64||_0xe2832c),_0x2bca91=_0x30d1fd>0x0?_0x439608/_0x30d1fd*0x64:0x0,_0x5d72a5=_0x1e3751>0x0?_0x2c7eaa/_0x1e3751*0x64:0x0;return{'totalPayments':_0x30d1fd,'successfulPayments':_0x439608,'totalRevenue':Math['round'](_0x5abd9e*0x64)/0x64,'merchantEarnings':Math[_0x8d2dc7(0x183)](_0x2fa35e*0x64)/0x64,'merchantTotalRevenue':Math['round'](_0x309f1a*0x64)/0x64,'payoutBalance':Math[_0x8d2dc7(0x183)]((_0x32caef?.[_0x8d2dc7(0x1c7)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x2bca91*0x64)/0x64,'chargebackRate':Math[_0x8d2dc7(0x183)](_0x5d72a5*0x64)/0x64,'chargebacks':_0x2c7eaa,'refunds':_0x316537,'paymentsByGateway':_0x4c08ed,'dailyRevenue':_0x23ec2d['dailyRevenue'],'dailyPayments':_0x23ec2d[_0x8d2dc7(0x1d0)],'recentPayments':_0xef5447[_0x8d2dc7(0x198)](_0x343f70=>({'id':_0x343f70['id'],'gateway':_0x343f70[_0x8d2dc7(0x1d9)],'amount':_0x343f70['amount'],'currency':_0x343f70['currency'],'status':_0x343f70[_0x8d2dc7(0x1f9)],'createdAt':_0x343f70['createdAt']}))};}[a86_0x46e82f(0x1dd)](_0x2f8514,_0x34955b,_0x4f0443){const _0x58c84f=a86_0x46e82f,_0x359d85=new Map(),_0x189b2b=new Date(_0x34955b);while(_0x189b2b<=_0x4f0443){const _0x1ad97a=_0x189b2b[_0x58c84f(0x248)]()['split']('T')[0x0];_0x359d85[_0x58c84f(0x1d2)](_0x1ad97a,{'revenue':0x0,'count':0x0}),_0x189b2b[_0x58c84f(0x240)](_0x189b2b[_0x58c84f(0x197)]()+0x1);}for(const _0x2f9f81 of _0x2f8514){const _0x44e292=_0x2f9f81[_0x58c84f(0x1e0)][_0x58c84f(0x248)]()[_0x58c84f(0x1d7)]('T')[0x0],_0x326574=_0x359d85[_0x58c84f(0x195)](_0x44e292);_0x326574&&(_0x326574[_0x58c84f(0x241)]+=0x1,_0x2f9f81[_0x58c84f(0x1f9)]===_0x58c84f(0x20a)&&_0x2f9f81['amountUSDT']&&(_0x326574['revenue']+=_0x2f9f81[_0x58c84f(0x1b3)]));}const _0x54eb0b=[],_0xa8bb94=[];for(const [_0x530e03,_0x1c0a48]of _0x359d85){_0x54eb0b['push']({'date':_0x530e03,'amount':Math[_0x58c84f(0x183)](_0x1c0a48['revenue']*0x64)/0x64}),_0xa8bb94[_0x58c84f(0x25d)]({'date':_0x530e03,'count':_0x1c0a48[_0x58c84f(0x241)]});}return{'dailyRevenue':_0x54eb0b,'dailyPayments':_0xa8bb94};}[a86_0x46e82f(0x16f)](_0x5ed3fe=0x8){const _0x4bb9fc=a86_0x46e82f,_0x31daf1=[];for(let _0x4320d9=0x0;_0x4320d9<_0x5ed3fe;_0x4320d9++){const _0x269210=crypto_1[_0x4bb9fc(0x237)][_0x4bb9fc(0x179)](0x4)[_0x4bb9fc(0x17a)]('hex')[_0x4bb9fc(0x225)]();_0x31daf1[_0x4bb9fc(0x25d)](_0x269210);}return _0x31daf1;}async[a86_0x46e82f(0x1fb)](_0x105f6f){const _0x27a54a=a86_0x46e82f,_0x3a5a90=await database_1[_0x27a54a(0x237)]['shop'][_0x27a54a(0x185)]({'where':{'id':_0x105f6f},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x3a5a90)throw new Error(_0x27a54a(0x209));const _0x103b74=speakeasy_1[_0x27a54a(0x237)]['generateSecret']({'name':_0x27a54a(0x1d3)+_0x3a5a90['username']+')','issuer':_0x27a54a(0x211),'length':0x20}),_0x36c905=await qrcode_1[_0x27a54a(0x237)]['toDataURL'](_0x103b74[_0x27a54a(0x1ed)]),_0x653f94=this[_0x27a54a(0x16f)](0x8),_0x344b02=await Promise[_0x27a54a(0x1e8)](_0x653f94[_0x27a54a(0x198)](_0x43f094=>bcryptjs_1[_0x27a54a(0x237)][_0x27a54a(0x24c)](_0x43f094,0xa)));return await database_1[_0x27a54a(0x237)]['shop'][_0x27a54a(0x25f)]({'where':{'id':_0x105f6f},'data':{'twoFactorSecret':_0x103b74['base32'],'backupCodes':JSON[_0x27a54a(0x190)](_0x344b02)}}),console['log'](_0x27a54a(0x18c)+_0x3a5a90[_0x27a54a(0x251)]),console[_0x27a54a(0x188)](_0x27a54a(0x208)+_0x653f94[_0x27a54a(0x1cf)]+_0x27a54a(0x17d)),{'secret':_0x103b74[_0x27a54a(0x25c)],'qrCode':_0x36c905,'manualEntryKey':_0x103b74[_0x27a54a(0x25c)],'backupCodes':_0x653f94};}async[a86_0x46e82f(0x1b0)](_0x1cfb06,_0x5a8e5c){const _0x2177f3=a86_0x46e82f,_0x2ea820=await database_1['default'][_0x2177f3(0x254)]['findUnique']({'where':{'id':_0x1cfb06},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x2ea820)throw new Error('Shop\x20not\x20found');if(!_0x2ea820[_0x2177f3(0x184)])throw new Error(_0x2177f3(0x17b));if(_0x2ea820[_0x2177f3(0x1fc)])throw new Error('2FA\x20is\x20already\x20enabled');const _0xbe962f=speakeasy_1[_0x2177f3(0x237)][_0x2177f3(0x1a6)][_0x2177f3(0x1bb)]({'secret':_0x2ea820[_0x2177f3(0x184)],'encoding':'base32','token':_0x5a8e5c,'window':0x2});if(!_0xbe962f)throw new Error(_0x2177f3(0x1e9));return await database_1['default'][_0x2177f3(0x254)][_0x2177f3(0x25f)]({'where':{'id':_0x1cfb06},'data':{'twoFactorEnabled':!![]}}),console[_0x2177f3(0x188)](_0x2177f3(0x21b)+_0x2ea820['username']),{'enabled':!![]};}async[a86_0x46e82f(0x234)](_0x4b1aa1){const _0x4a972d=a86_0x46e82f,_0x22e3c4=await database_1[_0x4a972d(0x237)][_0x4a972d(0x254)][_0x4a972d(0x185)]({'where':{'id':_0x4b1aa1},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x22e3c4)throw new Error(_0x4a972d(0x209));await database_1[_0x4a972d(0x237)][_0x4a972d(0x254)][_0x4a972d(0x25f)]({'where':{'id':_0x4b1aa1},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x4a972d(0x188)](_0x4a972d(0x16b)+_0x22e3c4[_0x4a972d(0x251)]);}}function a86_0xa3da(){const _0x8676ff=['update','PaymentService','deletePayment','üîê\x202FA\x20disabled\x20for\x20shop:\x20','KLYME\x20DE','fullName','usdcPolygonWallet','generateBackupCodes','üí∞\x20Getting\x20payouts\x20with\x20filters:','gte','\x20to\x20','isActive','Payment\x20not\x20found','redirectUrl','customerName','maxPayments',',\x20dateFrom:\x20','randomBytes','toString','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','test_payment_123','\x20backup\x20codes','12yEfcxL','CHARGEBACK','customerEmail','convertToUSDT','1750696cUZZNp','round','twoFactorSecret','findUnique','aggregate','error','log','payment','last_week','amountIsEditable','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','hex','periodTo','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','stringify','usage','gateways','EXPIRED','sourceCurrency','get','REJECTED','getDate','map','usdtTrcWallet','payout','digest','PENDING','parse','amount','twoFactorToken','517170oXfbyy','polygon_usdc','startsWith',',\x20period:\x20','telegramId','USDC\x20Ethereum','totp','../config/database','findFirst','üìä\x20Getting\x20statistics\x20for\x20shop\x20','name','getWebhookLogs','amountAfterGatewayCommissionUSDT','setHours','USDT\x20BSC','test','enable2FA','webhookLog','getPayoutStats','amountUSDT','getStatistics','test_gateway','./paymentService','KLYME\x20EU','custom_','this_month','YESTERDAY','verify','createHmac','\x20payout\x20statistics\x20calculated:','672MAzHdj','getUTCMonth','speakeasy','asc','awaitingPayout','getPaymentById','USDT\x20Polygon','getShopPayoutStats','Unknown\x20error','balance','language','bcryptjs','periodFrom','application/json','üåê\x20Method\x20filter:\x20','__esModule','__importDefault','length','dailyPayments','desc','set','TrapaPay\x20(','\x20\x20\x20üíµ\x20Available\x20balance:\x20','9VCzemS','trc20','split','USDC\x20Polygon','gateway','replace','UTC','usdtErcWallet','generateDailyStatistics','722180JCIoAM','Noda','createdAt','ShopService','USDT\x20TRC20','crypto','\x20USDT','wallets','notes','isArray','all','Invalid\x202FA\x20token','includes','üìÖ\x20Period\x20end:\x20','paymentGateways','otpauth_url','defineProperty','updateShopProfile','publicKey','paid','getFullYear','updateWallets','gatewaySettings','formatNetworkName','...','currencyService','4pzFYFF','status','reduce','setup2FA','twoFactorEnabled','totalPaidOut','qrcode','secretKey','toLowerCase','statusCode','Payment\x20System/1.0\x20(Test)','üìÖ\x20Custom\x20period:\x20','ceil','erc20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','getPayoutStatistics','üîë\x20Generated\x20','Shop\x20not\x20found','PAID','createPublicPayment','findMany','1151709NnaoPw','\x20USDT\x20(current\x20balance)','üåê\x20Network\x20filter:\x20','Plisio','TrapaPay','country','settings','paidAt','telegram','getGatewayDisplayName','USD','expiresAt','currency','shopId','üîê\x202FA\x20enabled\x20for\x20shop:\x20','testWebhook','getPayoutById','getUTCDate','getPaymentsByShop','paymentId','Test\x20Gateway','1372641ddOdXr','statusText','./currencyService','toUpperCase','COMPLETED','network','sha256','shopUrl','POST','getUTCDay',',\x20dateTo:\x20','getUTCFullYear','backupCodes','test_order_123','setUTCDate','thisMonth','getPayments','customer','disable2FA','erc20_usdc','webhookUrl','default','compare','getMonth','this_week','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','92477TvOlDx','updatePayment','USDT\x20ERC20','KLYME\x20GB','setDate','count','üìÖ\x20Custom\x20date\x20range:\x20','CoinToPay','17767GChKFd','txid','usdcErcWallet','splice','toISOString','Failed\x20to\x20send\x20webhook:\x20','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','webhookEvents','hash','lte','üìä\x20Status\x20filter:\x20','today','getShopProfile','username','üìÖ\x20Date\x20end:\x20','merchantUrl','shop','\x20\x20\x20üìÖ\x20This\x20month:\x20','usdtPolygonWallet','paymentService','getTime','AVAILABLE_GATEWAYS','7JgTCcC','filter','base32','push','20fdgnZK'];a86_0xa3da=function(){return _0x8676ff;};return a86_0xa3da();}exports['ShopService']=ShopService;