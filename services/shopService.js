'use strict';const a54_0x285d14=a54_0x29b5;function a54_0x29b5(_0x35a61f,_0x3665a7){const _0x1fe144=a54_0x1fe1();return a54_0x29b5=function(_0x29b524,_0x1eae59){_0x29b524=_0x29b524-0x11d;let _0x38055c=_0x1fe144[_0x29b524];return _0x38055c;},a54_0x29b5(_0x35a61f,_0x3665a7);}(function(_0x4b7eb6,_0x1137c8){const _0x361705=a54_0x29b5,_0x185762=_0x4b7eb6();while(!![]){try{const _0x229c53=parseInt(_0x361705(0x1a2))/0x1+-parseInt(_0x361705(0x16b))/0x2+parseInt(_0x361705(0x143))/0x3*(-parseInt(_0x361705(0x1bd))/0x4)+parseInt(_0x361705(0x124))/0x5+parseInt(_0x361705(0x16c))/0x6+-parseInt(_0x361705(0x1b0))/0x7+parseInt(_0x361705(0x1bc))/0x8*(parseInt(_0x361705(0x18f))/0x9);if(_0x229c53===_0x1137c8)break;else _0x185762['push'](_0x185762['shift']());}catch(_0x554d80){_0x185762['push'](_0x185762['shift']());}}}(a54_0x1fe1,0xb3d62));function a54_0x1fe1(){const _0x248fbb=['dailyRevenue','payout','üåê\x20Network\x20filter:\x20','sourceCurrency','shopUrl','getStatistics','getPayoutById','getWebhookLogs','generateDailyStatistics','currency','language','\x20\x20\x20üíµ\x20Available\x20balance:\x20','Webhook\x20returned\x20error:\x20','PaymentService','üìä\x20Shop\x20','6076030VpScfk','./currencyService','USDT\x20ERC20','getPayouts','ShopService','stringify','CoinToPay','üìÖ\x20Period\x20start:\x20','üí∞\x20Getting\x20payouts\x20with\x20filters:','Noda','delete','default','usdtTrcWallet','getPayoutStats','txid','parse','totalPaidOut','wallets','payment','paymentGateways','network','customer','formatNetworkName','currencyService','ceil','telegram','test_payment_123','defineProperty','amountUSDT','periodFrom','status','30WQkKZQ','usdtErcWallet','KLYME\x20GB','gateway','setDate','thisMonth','push','fullName','convertToUSDT','username','updatePayment','test_order_123','revenue','lte','\x20payout\x20statistics\x20calculated:','Plisio','usdtPolygonWallet','setHours','getPaymentByShopAndId','KLYME\x20EU','all','30d','webhookLog','gateways','map','getMonth','error','desc','findFirst','isArray','COMPLETED','__importDefault','polygon','paidAt','erc20','testWebhook','POST','Error\x20parsing\x20webhook\x20events:','getGatewayDisplayName','test','150600vsdlvJ','3666174UsfcJZ','Test\x20webhook\x20sent\x20successfully\x20(','message','availableBalance','split','USD','reduce','round','polygon_usdc','üìä\x20Status\x20filter:\x20','USDT\x20BSC','test_gateway','publicKey','merchantUrl','gatewaySettings','PENDING','updateWallets','count','getDate','shop','telegramId','paid','PAID','getShopPayoutStats','periodTo','settings','statusCode','findMany','event','expiresAt','Payment\x20not\x20found','statusText','webhookEvents','KLYME\x20DE','paymentId','1329084ONpUPy','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','paymentService','90d','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','get','amountIsEditable','USDT\x20TRC20','toUpperCase','getTime','\x20USDT\x20(current\x20balance)','name','Test\x20Gateway','toISOString','usdcPolygonWallet','Shop\x20not\x20found','getPaymentById','retryCount','gte','497451TCpnxa','../config/database','\x20USDT','dailyPayments','üìÖ\x20Period\x20end:\x20','USDC\x20Polygon','usage','Rapyd','update','üìä\x20Final\x20WHERE\x20conditions:','notes','getFullYear','redirectUrl','log','8433124aHmOUZ','application/json','webhookUrl','customerName','balance','__esModule','findUnique','updateShopProfile','üìÖ\x20Date\x20end:\x20','createPayment','amount','createdAt','8vLzySR','181888iCIPIa'];a54_0x1fe1=function(){return _0x248fbb;};return a54_0x1fe1();}var __importDefault=this&&this[a54_0x285d14(0x162)]||function(_0x19983f){return _0x19983f&&_0x19983f['__esModule']?_0x19983f:{'default':_0x19983f};};Object[a54_0x285d14(0x13f)](exports,a54_0x285d14(0x1b5),{'value':!![]}),exports[a54_0x285d14(0x128)]=void 0x0;const database_1=__importDefault(require(a54_0x285d14(0x1a3))),currencyService_1=require(a54_0x285d14(0x125)),paymentService_1=require('./paymentService');class ShopService{constructor(){const _0x353a42=a54_0x285d14;this[_0x353a42(0x191)]=new paymentService_1[(_0x353a42(0x122))]();}async['getShopProfile'](_0x26357f){const _0x1bc71d=a54_0x285d14,_0x38ec1a=await database_1[_0x1bc71d(0x12f)][_0x1bc71d(0x17f)]['findUnique']({'where':{'id':_0x26357f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x38ec1a)throw new Error('Shop\x20not\x20found');let _0x1ec6c1=[];if(_0x38ec1a[_0x1bc71d(0x185)]?.['webhookEvents'])try{_0x1ec6c1=Array[_0x1bc71d(0x160)](_0x38ec1a[_0x1bc71d(0x185)][_0x1bc71d(0x18c)])?_0x38ec1a[_0x1bc71d(0x185)][_0x1bc71d(0x18c)]:JSON[_0x1bc71d(0x133)](_0x38ec1a['settings']['webhookEvents']);}catch(_0x4e4d1d){console['error'](_0x1bc71d(0x168),_0x4e4d1d),_0x1ec6c1=[];}return{'id':_0x38ec1a['id'],'fullName':_0x38ec1a[_0x1bc71d(0x19a)],'username':_0x38ec1a['username'],'telegramId':_0x38ec1a[_0x1bc71d(0x13d)],'merchantUrl':_0x38ec1a[_0x1bc71d(0x1c2)],'gateways':_0x38ec1a['paymentGateways']?JSON['parse'](_0x38ec1a[_0x1bc71d(0x137)]):null,'gatewaySettings':_0x38ec1a[_0x1bc71d(0x17a)]?JSON[_0x1bc71d(0x133)](_0x38ec1a[_0x1bc71d(0x17a)]):null,'publicKey':_0x38ec1a[_0x1bc71d(0x178)],'webhookUrl':_0x38ec1a['settings']?.['webhookUrl']||null,'webhookEvents':_0x1ec6c1,'wallets':{'usdtPolygonWallet':_0x38ec1a['usdtPolygonWallet'],'usdtTrcWallet':_0x38ec1a[_0x1bc71d(0x130)],'usdtErcWallet':_0x38ec1a[_0x1bc71d(0x144)],'usdcPolygonWallet':_0x38ec1a[_0x1bc71d(0x19d)]},'status':_0x38ec1a[_0x1bc71d(0x142)],'createdAt':_0x38ec1a[_0x1bc71d(0x1bb)]};}async[a54_0x285d14(0x1b7)](_0x20ee01,_0x40bed6){const _0x28c37e=a54_0x285d14,_0xfc397f={};_0x40bed6['fullName']&&(_0xfc397f[_0x28c37e(0x19a)]=_0x40bed6[_0x28c37e(0x14a)]);_0x40bed6[_0x28c37e(0x180)]!==undefined&&(_0xfc397f[_0x28c37e(0x13d)]=_0x40bed6[_0x28c37e(0x180)]||null);_0x40bed6[_0x28c37e(0x179)]&&(_0xfc397f[_0x28c37e(0x1c2)]=_0x40bed6[_0x28c37e(0x179)]);_0x40bed6[_0x28c37e(0x15a)]&&(_0xfc397f[_0x28c37e(0x137)]=JSON['stringify'](_0x40bed6[_0x28c37e(0x15a)]));_0x40bed6['gatewaySettings']&&(_0xfc397f[_0x28c37e(0x17a)]=JSON[_0x28c37e(0x129)](_0x40bed6[_0x28c37e(0x17a)]));_0x40bed6['wallets']&&(_0x40bed6[_0x28c37e(0x135)][_0x28c37e(0x153)]!==undefined&&(_0xfc397f[_0x28c37e(0x153)]=_0x40bed6[_0x28c37e(0x135)][_0x28c37e(0x153)]||null),_0x40bed6['wallets'][_0x28c37e(0x130)]!==undefined&&(_0xfc397f[_0x28c37e(0x130)]=_0x40bed6['wallets'][_0x28c37e(0x130)]||null),_0x40bed6[_0x28c37e(0x135)][_0x28c37e(0x144)]!==undefined&&(_0xfc397f[_0x28c37e(0x144)]=_0x40bed6[_0x28c37e(0x135)][_0x28c37e(0x144)]||null),_0x40bed6[_0x28c37e(0x135)][_0x28c37e(0x19d)]!==undefined&&(_0xfc397f[_0x28c37e(0x19d)]=_0x40bed6[_0x28c37e(0x135)][_0x28c37e(0x19d)]||null));const _0x514973=await database_1['default'][_0x28c37e(0x17f)][_0x28c37e(0x1aa)]({'where':{'id':_0x20ee01},'data':_0xfc397f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0xe8c0fd=[];if(_0x514973[_0x28c37e(0x185)]?.[_0x28c37e(0x18c)])try{_0xe8c0fd=Array[_0x28c37e(0x160)](_0x514973[_0x28c37e(0x185)]['webhookEvents'])?_0x514973[_0x28c37e(0x185)][_0x28c37e(0x18c)]:JSON[_0x28c37e(0x133)](_0x514973['settings'][_0x28c37e(0x18c)]);}catch(_0x210ab8){console[_0x28c37e(0x15d)](_0x28c37e(0x168),_0x210ab8),_0xe8c0fd=[];}return{'id':_0x514973['id'],'fullName':_0x514973[_0x28c37e(0x19a)],'username':_0x514973[_0x28c37e(0x14c)],'telegramId':_0x514973[_0x28c37e(0x13d)],'merchantUrl':_0x514973[_0x28c37e(0x1c2)],'gateways':_0x514973[_0x28c37e(0x137)]?JSON[_0x28c37e(0x133)](_0x514973[_0x28c37e(0x137)]):null,'gatewaySettings':_0x514973[_0x28c37e(0x17a)]?JSON[_0x28c37e(0x133)](_0x514973[_0x28c37e(0x17a)]):null,'publicKey':_0x514973[_0x28c37e(0x178)],'webhookUrl':_0x514973[_0x28c37e(0x185)]?.[_0x28c37e(0x1b2)]||null,'webhookEvents':_0xe8c0fd,'wallets':{'usdtPolygonWallet':_0x514973['usdtPolygonWallet'],'usdtTrcWallet':_0x514973[_0x28c37e(0x130)],'usdtErcWallet':_0x514973['usdtErcWallet'],'usdcPolygonWallet':_0x514973[_0x28c37e(0x19d)]},'status':_0x514973['status'],'createdAt':_0x514973[_0x28c37e(0x1bb)]};}async[a54_0x285d14(0x17c)](_0x3a98a3,_0x449a57){const _0x1737b8=a54_0x285d14,_0x4556fa={};_0x449a57[_0x1737b8(0x153)]!==undefined&&(_0x4556fa[_0x1737b8(0x153)]=_0x449a57[_0x1737b8(0x153)]||null),_0x449a57[_0x1737b8(0x130)]!==undefined&&(_0x4556fa[_0x1737b8(0x130)]=_0x449a57[_0x1737b8(0x130)]||null),_0x449a57[_0x1737b8(0x144)]!==undefined&&(_0x4556fa[_0x1737b8(0x144)]=_0x449a57[_0x1737b8(0x144)]||null),_0x449a57[_0x1737b8(0x19d)]!==undefined&&(_0x4556fa[_0x1737b8(0x19d)]=_0x449a57['usdcPolygonWallet']||null),await database_1[_0x1737b8(0x12f)][_0x1737b8(0x17f)]['update']({'where':{'id':_0x3a98a3},'data':_0x4556fa});}async[a54_0x285d14(0x166)](_0x277342){const _0x24ff06=a54_0x285d14,_0x3a7d55=await database_1[_0x24ff06(0x12f)][_0x24ff06(0x17f)][_0x24ff06(0x1b6)]({'where':{'id':_0x277342},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3a7d55?.[_0x24ff06(0x185)]?.[_0x24ff06(0x1b2)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x28f69f={'event':_0x24ff06(0x16a),'payment':{'id':_0x24ff06(0x13e),'order_id':_0x24ff06(0x14e),'gateway':_0x24ff06(0x16a),'amount':0x64,'currency':_0x24ff06(0x171),'status':_0x24ff06(0x181),'created_at':new Date()['toISOString']()}};try{const _0x2b5452=await fetch(_0x3a7d55[_0x24ff06(0x185)][_0x24ff06(0x1b2)],{'method':_0x24ff06(0x167),'headers':{'Content-Type':_0x24ff06(0x1b1),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x24ff06(0x129)](_0x28f69f)});return _0x2b5452['ok']?{'success':!![],'message':_0x24ff06(0x16d)+_0x2b5452[_0x24ff06(0x142)]+')'}:{'success':![],'message':_0x24ff06(0x121)+_0x2b5452[_0x24ff06(0x142)]+'\x20'+_0x2b5452[_0x24ff06(0x18b)]};}catch(_0x184fd0){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x184fd0 instanceof Error?_0x184fd0[_0x24ff06(0x16e)]:'Unknown\x20error')};}}async[a54_0x285d14(0x1b9)](_0x3476ee){const _0x9f1cc0=a54_0x285d14;return this[_0x9f1cc0(0x191)]['createPublicPayment']({'public_key':'','gateway':_0x3476ee[_0x9f1cc0(0x146)],'order_id':undefined,'amount':_0x3476ee['amount'],'currency':_0x3476ee['currency'],'source_currency':_0x3476ee[_0x9f1cc0(0x1c1)],'usage':_0x3476ee[_0x9f1cc0(0x1a8)],'expires_at':_0x3476ee[_0x9f1cc0(0x189)]?.['toISOString'](),'success_url':_0x3476ee[_0x9f1cc0(0x1ae)],'fail_url':_0x3476ee[_0x9f1cc0(0x1ae)],'customer_email':_0x3476ee['customerEmail'],'customer_name':_0x3476ee[_0x9f1cc0(0x1b3)],'country':_0x3476ee['country'],'language':_0x3476ee[_0x9f1cc0(0x11f)],'amount_is_editable':_0x3476ee[_0x9f1cc0(0x195)],'max_payments':_0x3476ee['maxPayments'],'customer':_0x3476ee[_0x9f1cc0(0x139)]});}async['getPayments'](_0x30387e,_0x20bea3){return this['paymentService']['getPaymentsByShop'](_0x30387e,_0x20bea3);}async[a54_0x285d14(0x19f)](_0x5a767c,_0x35a72c){const _0x4ce42e=a54_0x285d14;return this[_0x4ce42e(0x191)][_0x4ce42e(0x155)](_0x5a767c,_0x35a72c);}async[a54_0x285d14(0x14d)](_0x3a0123,_0x5df3a6,_0x138acc){const _0x40281d=a54_0x285d14,_0x3f1842=await database_1['default']['payment'][_0x40281d(0x15f)]({'where':{'id':_0x5df3a6,'shopId':_0x3a0123}});if(!_0x3f1842)throw new Error(_0x40281d(0x18a));const _0x270b99=await database_1[_0x40281d(0x12f)][_0x40281d(0x136)][_0x40281d(0x1aa)]({'where':{'id':_0x5df3a6},'data':{..._0x138acc,'updatedAt':new Date()}});return _0x270b99;}async['deletePayment'](_0x3012d3,_0x51e0d3){const _0x21f8ef=a54_0x285d14,_0x1491ba=await database_1[_0x21f8ef(0x12f)][_0x21f8ef(0x136)][_0x21f8ef(0x15f)]({'where':{'id':_0x51e0d3,'shopId':_0x3012d3}});if(!_0x1491ba)throw new Error(_0x21f8ef(0x18a));await database_1['default'][_0x21f8ef(0x136)][_0x21f8ef(0x12e)]({'where':{'id':_0x51e0d3}});}[a54_0x285d14(0x13a)](_0x3be1da){const _0xe1a311=a54_0x285d14,_0x559f14={'polygon':'USDT\x20Polygon','trc20':_0xe1a311(0x196),'erc20':_0xe1a311(0x126),'bsc':_0xe1a311(0x176),'polygon_usdc':_0xe1a311(0x1a7)};return _0x559f14[_0x3be1da]||_0x3be1da;}async[a54_0x285d14(0x127)](_0x27ab99,_0x15d670){const _0x2cb594=a54_0x285d14,{page:_0x1d7c13,limit:_0x4e58be,status:_0x1079c2,method:_0x878fa7,network:_0x34c878,dateFrom:_0x488446,dateTo:_0x23e13d,periodFrom:_0x591c4b,periodTo:_0x504f4c}=_0x15d670,_0x57628f=(_0x1d7c13-0x1)*_0x4e58be;console[_0x2cb594(0x1af)](_0x2cb594(0x12c),_0x15d670);const _0xda1f2={'shopId':_0x27ab99};_0x1079c2&&(_0xda1f2['status']=_0x1079c2[_0x2cb594(0x197)](),console[_0x2cb594(0x1af)](_0x2cb594(0x175)+_0x1079c2['toUpperCase']()));if(_0x878fa7)_0xda1f2[_0x2cb594(0x138)]=_0x878fa7,console[_0x2cb594(0x1af)]('üåê\x20Method\x20filter:\x20'+_0x878fa7);else _0x34c878&&(_0xda1f2[_0x2cb594(0x138)]=_0x34c878,console[_0x2cb594(0x1af)](_0x2cb594(0x1c0)+_0x34c878));if(_0x488446||_0x23e13d||_0x591c4b||_0x504f4c){_0xda1f2[_0x2cb594(0x1bb)]={};if(_0x591c4b){const _0x5c00a6=new Date(_0x591c4b);_0x5c00a6[_0x2cb594(0x154)](0x0,0x0,0x0,0x0),_0xda1f2[_0x2cb594(0x1bb)][_0x2cb594(0x1a1)]=_0x5c00a6,console[_0x2cb594(0x1af)](_0x2cb594(0x12b)+_0x5c00a6[_0x2cb594(0x19c)]());}else{if(_0x488446){const _0x1a6ecd=new Date(_0x488446);_0x1a6ecd[_0x2cb594(0x154)](0x0,0x0,0x0,0x0),_0xda1f2[_0x2cb594(0x1bb)][_0x2cb594(0x1a1)]=_0x1a6ecd,console[_0x2cb594(0x1af)]('üìÖ\x20Date\x20start:\x20'+_0x1a6ecd[_0x2cb594(0x19c)]());}}if(_0x504f4c){const _0x506de8=new Date(_0x504f4c);_0x506de8[_0x2cb594(0x154)](0x17,0x3b,0x3b,0x3e7),_0xda1f2[_0x2cb594(0x1bb)][_0x2cb594(0x150)]=_0x506de8,console['log'](_0x2cb594(0x1a6)+_0x506de8[_0x2cb594(0x19c)]());}else{if(_0x23e13d){const _0x2a3669=new Date(_0x23e13d);_0x2a3669[_0x2cb594(0x154)](0x17,0x3b,0x3b,0x3e7),_0xda1f2[_0x2cb594(0x1bb)]['lte']=_0x2a3669,console[_0x2cb594(0x1af)](_0x2cb594(0x1b8)+_0x2a3669['toISOString']());}}}console['log'](_0x2cb594(0x1ab),JSON[_0x2cb594(0x129)](_0xda1f2,null,0x2));const [_0x927932,_0x3b67b2]=await Promise[_0x2cb594(0x157)]([database_1[_0x2cb594(0x12f)]['payout'][_0x2cb594(0x187)]({'where':_0xda1f2,'skip':_0x57628f,'take':_0x4e58be,'orderBy':{'createdAt':_0x2cb594(0x15e)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x2cb594(0x1bf)][_0x2cb594(0x17d)]({'where':_0xda1f2})]);return{'payouts':_0x927932['map'](_0x5b6b9c=>{const _0x4ceb99=_0x2cb594;let _0x5a916a=null;switch(_0x5b6b9c['network']){case _0x4ceb99(0x163):_0x5a916a=_0x5b6b9c[_0x4ceb99(0x17f)]['usdtPolygonWallet'];break;case'trc20':_0x5a916a=_0x5b6b9c[_0x4ceb99(0x17f)][_0x4ceb99(0x130)];break;case _0x4ceb99(0x165):_0x5a916a=_0x5b6b9c[_0x4ceb99(0x17f)][_0x4ceb99(0x144)];break;case _0x4ceb99(0x174):_0x5a916a=_0x5b6b9c[_0x4ceb99(0x17f)][_0x4ceb99(0x19d)];break;}return{'id':_0x5b6b9c['id'],'amount':_0x5b6b9c[_0x4ceb99(0x1ba)],'network':this[_0x4ceb99(0x13a)](_0x5b6b9c[_0x4ceb99(0x138)]),'wallet':_0x5a916a,'status':_0x5b6b9c[_0x4ceb99(0x142)],'txid':_0x5b6b9c[_0x4ceb99(0x132)],'notes':_0x5b6b9c[_0x4ceb99(0x1ac)],'periodFrom':_0x5b6b9c[_0x4ceb99(0x141)],'periodTo':_0x5b6b9c[_0x4ceb99(0x184)],'createdAt':_0x5b6b9c[_0x4ceb99(0x1bb)],'paidAt':_0x5b6b9c[_0x4ceb99(0x164)]};}),'pagination':{'page':_0x1d7c13,'limit':_0x4e58be,'total':_0x3b67b2,'totalPages':Math[_0x2cb594(0x13c)](_0x3b67b2/_0x4e58be)}};}async[a54_0x285d14(0x1c4)](_0x20177d,_0x282713){const _0x78ffcd=a54_0x285d14,_0x18881d=await database_1['default'][_0x78ffcd(0x1bf)][_0x78ffcd(0x15f)]({'where':{'id':_0x282713,'shopId':_0x20177d}});if(!_0x18881d)return null;return{'id':_0x18881d['id'],'amount':_0x18881d[_0x78ffcd(0x1ba)],'network':_0x18881d[_0x78ffcd(0x138)],'status':_0x18881d[_0x78ffcd(0x142)],'txid':_0x18881d[_0x78ffcd(0x132)],'notes':_0x18881d[_0x78ffcd(0x1ac)],'createdAt':_0x18881d[_0x78ffcd(0x1bb)],'paidAt':_0x18881d[_0x78ffcd(0x164)]};}async['getPayoutStatistics'](_0x166df1,_0x333af6){const _0x46127a=a54_0x285d14,_0x4acca5=new Date();let _0x1ee730;switch(_0x333af6){case'7d':_0x1ee730=new Date(_0x4acca5[_0x46127a(0x198)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x46127a(0x158):_0x1ee730=new Date(_0x4acca5[_0x46127a(0x198)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x1ee730=new Date(_0x4acca5[_0x46127a(0x198)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1ee730=new Date(_0x4acca5[_0x46127a(0x198)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x599f58,_0x42ad65,_0x570ac8,_0x5d0c67,_0x16ffdd,_0x46cf89]=await Promise[_0x46127a(0x157)]([database_1[_0x46127a(0x12f)]['payout'][_0x46127a(0x17d)]({'where':{'shopId':_0x166df1,'createdAt':{'gte':_0x1ee730}}}),database_1[_0x46127a(0x12f)][_0x46127a(0x1bf)][_0x46127a(0x17d)]({'where':{'shopId':_0x166df1,'status':_0x46127a(0x161),'createdAt':{'gte':_0x1ee730}}}),database_1['default'][_0x46127a(0x1bf)][_0x46127a(0x17d)]({'where':{'shopId':_0x166df1,'status':'PENDING','createdAt':{'gte':_0x1ee730}}}),database_1[_0x46127a(0x12f)]['payout'][_0x46127a(0x17d)]({'where':{'shopId':_0x166df1,'status':'REJECTED','createdAt':{'gte':_0x1ee730}}}),database_1[_0x46127a(0x12f)]['payout']['findMany']({'where':{'shopId':_0x166df1,'createdAt':{'gte':_0x1ee730}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x46127a(0x12f)][_0x46127a(0x1bf)]['findMany']({'where':{'shopId':_0x166df1},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x2cdb22=_0x16ffdd[_0x46127a(0x172)]((_0x421d58,_0x39b7a6)=>_0x421d58+_0x39b7a6[_0x46127a(0x1ba)],0x0),_0x42853e=_0x16ffdd['filter'](_0x23ab34=>_0x23ab34[_0x46127a(0x142)]===_0x46127a(0x161))[_0x46127a(0x172)]((_0x4ca89b,_0x50e2c3)=>_0x4ca89b+_0x50e2c3['amount'],0x0),_0x5bc344=_0x16ffdd['filter'](_0x2d859c=>_0x2d859c[_0x46127a(0x142)]===_0x46127a(0x17b))['reduce']((_0x4759ed,_0x158385)=>_0x4759ed+_0x158385[_0x46127a(0x1ba)],0x0),_0x292aac=_0x16ffdd[_0x46127a(0x172)]((_0x2d4aac,_0x480ea2)=>{const _0x23440c=_0x46127a;return _0x2d4aac[_0x480ea2[_0x23440c(0x138)]]=(_0x2d4aac[_0x480ea2[_0x23440c(0x138)]]||0x0)+0x1,_0x2d4aac;},{}),_0x497420=_0x16ffdd[_0x46127a(0x172)]((_0x28eb89,_0x1dfa9d)=>{const _0x36ebc0=_0x46127a;return _0x28eb89[_0x1dfa9d[_0x36ebc0(0x142)]]=(_0x28eb89[_0x1dfa9d[_0x36ebc0(0x142)]]||0x0)+0x1,_0x28eb89;},{});return{'totalPayouts':_0x599f58,'completedPayouts':_0x42ad65,'pendingPayouts':_0x570ac8,'rejectedPayouts':_0x5d0c67,'totalAmount':_0x2cdb22,'completedAmount':_0x42853e,'pendingAmount':_0x5bc344,'payoutsByMethod':_0x292aac,'payoutsByStatus':_0x497420,'recentPayouts':_0x46cf89['map'](_0x530aeb=>({'id':_0x530aeb['id'],'shopId':_0x166df1,'amount':_0x530aeb[_0x46127a(0x1ba)],'method':_0x530aeb[_0x46127a(0x138)],'status':_0x530aeb[_0x46127a(0x142)],'txid':_0x530aeb['txid'],'createdAt':_0x530aeb[_0x46127a(0x1bb)],'paidAt':_0x530aeb['paidAt']}))};}async[a54_0x285d14(0x183)](_0x2361a2){const _0x2b09b4=a54_0x285d14;console['log']('üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x2361a2+'...');const _0x498968=await database_1['default'][_0x2b09b4(0x17f)][_0x2b09b4(0x1b6)]({'where':{'id':_0x2361a2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x498968)throw new Error(_0x2b09b4(0x19e));const _0x56746b=new Date(),_0x191d4b=new Date(_0x56746b[_0x2b09b4(0x1ad)](),_0x56746b[_0x2b09b4(0x15c)](),0x1),_0x266924=new Date(_0x56746b[_0x2b09b4(0x1ad)](),_0x56746b[_0x2b09b4(0x15c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x16968b=await database_1[_0x2b09b4(0x12f)][_0x2b09b4(0x1bf)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x2361a2,'createdAt':{'gte':_0x191d4b,'lte':_0x266924},'status':'COMPLETED'}}),_0x44e2dc=_0x16968b['_sum']['amount']||0x0,_0x1a4cf9={'availableBalance':Math[_0x2b09b4(0x173)](_0x498968[_0x2b09b4(0x1b4)]*0x64)/0x64,'totalPaidOut':Math[_0x2b09b4(0x173)](_0x498968[_0x2b09b4(0x134)]*0x64)/0x64,'awaitingPayout':Math[_0x2b09b4(0x173)](_0x498968[_0x2b09b4(0x1b4)]*0x64)/0x64,'thisMonth':Math[_0x2b09b4(0x173)](_0x44e2dc*0x64)/0x64};return console['log'](_0x2b09b4(0x123)+_0x498968['username']+_0x2b09b4(0x151)),console[_0x2b09b4(0x1af)](_0x2b09b4(0x120)+_0x1a4cf9[_0x2b09b4(0x16f)]+'\x20USDT\x20(current\x20balance)'),console[_0x2b09b4(0x1af)](_0x2b09b4(0x190)+_0x1a4cf9[_0x2b09b4(0x134)]+'\x20USDT\x20(total\x20payouts)'),console[_0x2b09b4(0x1af)](_0x2b09b4(0x193)+_0x1a4cf9['awaitingPayout']+_0x2b09b4(0x199)),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x1a4cf9[_0x2b09b4(0x148)]+_0x2b09b4(0x1a4)),_0x1a4cf9;}[a54_0x285d14(0x169)](_0x4d29b2){const _0x9f20c4=a54_0x285d14,_0x16d93b={'test_gateway':_0x9f20c4(0x19b),'plisio':_0x9f20c4(0x152),'rapyd':_0x9f20c4(0x1a9),'noda':_0x9f20c4(0x12d),'cointopay':_0x9f20c4(0x12a),'klyme_eu':_0x9f20c4(0x156),'klyme_gb':_0x9f20c4(0x145),'klyme_de':_0x9f20c4(0x18d)};return _0x16d93b[_0x4d29b2]||_0x4d29b2;}async[a54_0x285d14(0x131)](_0x401f04){const _0x47e36f=a54_0x285d14;return this[_0x47e36f(0x183)](_0x401f04);}async[a54_0x285d14(0x1c5)](_0x56b544,_0x5d3618){const _0x2b9859=a54_0x285d14,{page:_0x4cc7af,limit:_0x5f05f3,paymentId:_0x545dba}=_0x5d3618,_0xa5b73b=(_0x4cc7af-0x1)*_0x5f05f3,_0x15e9d4={'shopId':_0x56b544};_0x545dba&&(_0x15e9d4[_0x2b9859(0x18e)]=_0x545dba);const [_0x1d05d4,_0x5d0c79]=await Promise[_0x2b9859(0x157)]([database_1[_0x2b9859(0x12f)][_0x2b9859(0x159)][_0x2b9859(0x187)]({'where':_0x15e9d4,'skip':_0xa5b73b,'take':_0x5f05f3,'orderBy':{'createdAt':_0x2b9859(0x15e)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2b9859(0x12f)][_0x2b9859(0x159)][_0x2b9859(0x17d)]({'where':_0x15e9d4})]);return{'logs':_0x1d05d4[_0x2b9859(0x15b)](_0x4c8444=>({'id':_0x4c8444['id'],'paymentId':_0x4c8444['paymentId'],'shopId':_0x4c8444['shopId'],'event':_0x4c8444[_0x2b9859(0x188)],'statusCode':_0x4c8444[_0x2b9859(0x186)],'retryCount':_0x4c8444[_0x2b9859(0x1a0)],'responseBody':_0x4c8444['responseBody'],'createdAt':_0x4c8444[_0x2b9859(0x1bb)],'payment':_0x4c8444[_0x2b9859(0x136)]})),'pagination':{'page':_0x4cc7af,'limit':_0x5f05f3,'total':_0x5d0c79,'totalPages':Math['ceil'](_0x5d0c79/_0x5f05f3)}};}async[a54_0x285d14(0x1c3)](_0xa7436b,_0x3a558e){const _0x47310f=a54_0x285d14,_0x35afde=new Date();let _0x5a7310;switch(_0x3a558e){case'7d':_0x5a7310=new Date(_0x35afde[_0x47310f(0x198)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5a7310=new Date(_0x35afde[_0x47310f(0x198)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x47310f(0x192):_0x5a7310=new Date(_0x35afde['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5a7310=new Date(_0x35afde[_0x47310f(0x198)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1eee77,_0x3afd2b,_0x67ffac,_0x44f603,_0x442adc]=await Promise['all']([database_1[_0x47310f(0x12f)][_0x47310f(0x136)]['count']({'where':{'shopId':_0xa7436b,'gateway':{'not':_0x47310f(0x177)},'createdAt':{'gte':_0x5a7310}}}),database_1[_0x47310f(0x12f)][_0x47310f(0x136)][_0x47310f(0x17d)]({'where':{'shopId':_0xa7436b,'gateway':{'not':_0x47310f(0x177)},'status':_0x47310f(0x182),'createdAt':{'gte':_0x5a7310}}}),database_1['default'][_0x47310f(0x136)]['findMany']({'where':{'shopId':_0xa7436b,'gateway':{'not':_0x47310f(0x177)},'status':_0x47310f(0x182),'createdAt':{'gte':_0x5a7310}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x47310f(0x136)][_0x47310f(0x187)]({'where':{'shopId':_0xa7436b,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x47310f(0x12f)][_0x47310f(0x136)][_0x47310f(0x187)]({'where':{'shopId':_0xa7436b,'gateway':{'not':_0x47310f(0x177)},'createdAt':{'gte':_0x5a7310}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x122f91=0x0;for(const _0x34f2f8 of _0x67ffac){if(_0x34f2f8[_0x47310f(0x140)])_0x122f91+=_0x34f2f8[_0x47310f(0x140)];else{const _0x30b248=await currencyService_1[_0x47310f(0x13b)][_0x47310f(0x14b)](_0x34f2f8['amount'],_0x34f2f8[_0x47310f(0x11e)]);_0x122f91+=_0x30b248;}}const _0x383222=this['generateDailyStatistics'](_0x442adc,_0x5a7310,_0x35afde),_0x214c2d=_0x1eee77>0x0?_0x3afd2b/_0x1eee77*0x64:0x0;return{'totalPayments':_0x1eee77,'successfulPayments':_0x3afd2b,'totalRevenue':Math[_0x47310f(0x173)](_0x122f91*0x64)/0x64,'conversionRate':Math[_0x47310f(0x173)](_0x214c2d*0x64)/0x64,'dailyRevenue':_0x383222[_0x47310f(0x1be)],'dailyPayments':_0x383222[_0x47310f(0x1a5)],'recentPayments':_0x44f603[_0x47310f(0x15b)](_0x31573d=>({'id':_0x31573d['id'],'gateway':_0x31573d[_0x47310f(0x146)],'amount':_0x31573d[_0x47310f(0x1ba)],'currency':_0x31573d['currency'],'status':_0x31573d['status'],'createdAt':_0x31573d[_0x47310f(0x1bb)]}))};}[a54_0x285d14(0x11d)](_0x3aebd3,_0x4fbeb8,_0x4ea31a){const _0x25c1b3=a54_0x285d14,_0x352a2e=new Map(),_0x30bdac=new Date(_0x4fbeb8);while(_0x30bdac<=_0x4ea31a){const _0x10deef=_0x30bdac[_0x25c1b3(0x19c)]()[_0x25c1b3(0x170)]('T')[0x0];_0x352a2e['set'](_0x10deef,{'revenue':0x0,'count':0x0}),_0x30bdac[_0x25c1b3(0x147)](_0x30bdac[_0x25c1b3(0x17e)]()+0x1);}for(const _0x507568 of _0x3aebd3){const _0x246f0f=_0x507568[_0x25c1b3(0x1bb)][_0x25c1b3(0x19c)]()[_0x25c1b3(0x170)]('T')[0x0],_0x48a673=_0x352a2e[_0x25c1b3(0x194)](_0x246f0f);_0x48a673&&(_0x48a673['count']+=0x1,_0x507568[_0x25c1b3(0x142)]==='PAID'&&_0x507568['amountUSDT']&&(_0x48a673[_0x25c1b3(0x14f)]+=_0x507568['amountUSDT']));}const _0x3c46ec=[],_0x5d346e=[];for(const [_0x2d20ac,_0x135f43]of _0x352a2e){_0x3c46ec['push']({'date':_0x2d20ac,'amount':Math[_0x25c1b3(0x173)](_0x135f43[_0x25c1b3(0x14f)]*0x64)/0x64}),_0x5d346e[_0x25c1b3(0x149)]({'date':_0x2d20ac,'count':_0x135f43[_0x25c1b3(0x17d)]});}return{'dailyRevenue':_0x3c46ec,'dailyPayments':_0x5d346e};}}exports['ShopService']=ShopService;