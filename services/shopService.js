'use strict';const a86_0x14a701=a86_0x5236;(function(_0x31a76c,_0x19d820){const _0x4e7874=a86_0x5236,_0x187529=_0x31a76c();while(!![]){try{const _0x5246ab=-parseInt(_0x4e7874(0x182))/0x1*(parseInt(_0x4e7874(0x147))/0x2)+-parseInt(_0x4e7874(0x17a))/0x3*(parseInt(_0x4e7874(0xe6))/0x4)+parseInt(_0x4e7874(0x18a))/0x5*(-parseInt(_0x4e7874(0xf7))/0x6)+parseInt(_0x4e7874(0x14b))/0x7+-parseInt(_0x4e7874(0x104))/0x8*(-parseInt(_0x4e7874(0x1b6))/0x9)+parseInt(_0x4e7874(0x141))/0xa*(-parseInt(_0x4e7874(0x199))/0xb)+-parseInt(_0x4e7874(0x161))/0xc;if(_0x5246ab===_0x19d820)break;else _0x187529['push'](_0x187529['shift']());}catch(_0xc592b5){_0x187529['push'](_0x187529['shift']());}}}(a86_0x2b68,0x38905));var __importDefault=this&&this[a86_0x14a701(0x114)]||function(_0x51e768){return _0x51e768&&_0x51e768['__esModule']?_0x51e768:{'default':_0x51e768};};Object[a86_0x14a701(0x16c)](exports,a86_0x14a701(0x1b3),{'value':!![]}),exports[a86_0x14a701(0x1b7)]=void 0x0;function a86_0x5236(_0x5d14e3,_0x410343){_0x5d14e3=_0x5d14e3-0xdc;const _0x2b6842=a86_0x2b68();let _0x523674=_0x2b6842[_0x5d14e3];return _0x523674;}function a86_0x2b68(){const _0x2a0882=['webhookLog','33304nJahuJ','payment','Unknown\x20error','Payment\x20not\x20found','COMPLETED','hex','telegramId','\x20USDT','splice','event','2FA\x20is\x20already\x20enabled','fullName','gateways','webhookUrl','\x20backup\x20codes','compare','__importDefault','getWebhookLogs','isActive','toLowerCase','KLYME\x20GB','generateDailyStatistics','USD','gateway','dailyPayments','POST','paymentGateways','base32','asc','KLYME\x20DE','periodTo','findUnique','toString','language','bcryptjs','crypto','shop','this_week','custom_','shopUrl3','\x20USDT\x20(total\x20payouts)','totalPaidOut','today','randomBytes','getPaymentsByShop','getShopProfile','findFirst','polygon','getUTCDate','\x20to\x20','getTime','length','twoFactorSecret','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','TrapaPay\x20(','log','_sum','lte','dailyRevenue','paymentId','Invalid\x202FA\x20token','261210eZkXpo','setHours','last_week','../types/gateway','üí∞\x20Getting\x20payouts\x20with\x20filters:','paymentService','14ELuZcB','setup2FA','\x20payout\x20statistics\x20calculated:','üìä\x20Shop\x20','2933182gYhNwY','balance','üìÖ\x20Custom\x20period:\x20','getPayoutById','test','merchantUrl3','round','CoinToPay','getUTCDay','CHARGEBACK','usdcErcWallet','findMany','updatePayment','getPayoutStats','payout','retryCount',',\x20dateTo:\x20','hash','createHmac','getShopPayoutStats','formatNetworkName','Failed\x20to\x20send\x20webhook:\x20','691068AFzMiP','default','notes','toUpperCase','Noda','gte','üìä\x20Getting\x20statistics\x20for\x20shop\x20','twoFactorToken','paidAt','getPaymentById','testWebhook','defineProperty','setDate','get','üìÖ\x20Date\x20start:\x20','deletePayment','üîê\x202FA\x20enabled\x20for\x20shop:\x20','txid','qrcode','getGatewayDisplayName','thisMonth','name','map','reduce','UTC','120567eZRcHj','parse','application/json','REFUND','filter','PAID','createdAt','KLYME\x20EU','16129LeWoen','getUTCFullYear','wallets','speakeasy','merchantUrl2','createPublicPayment',',\x20dateFrom:\x20','customerName','5BtDIFf','twoFactorEnabled',',\x20period:\x20','startsWith','merchantUrl','revenue','test_gateway','usdtTrcWallet','...','awaitingPayout','Shop\x20not\x20found','update','YESTERDAY','responseBody','Plisio','66QtNJGw','gatewaySettings','desc','count','USDC\x20Ethereum','PaymentService','shopId','periodFrom','Error\x20parsing\x20webhook\x20events:','\x20\x20\x20üìÖ\x20This\x20month:\x20','üìÖ\x20Period\x20end:\x20','ceil','\x20USDT\x20(current\x20balance)','merchantUrl4','split','otpauth_url','getStatistics','status','./currencyService','webhookEvents','Rapyd','publicKey','No\x20webhook\x20URL\x20configured','stringify','verify','redirectUrl','__esModule','aggregate','usdtErcWallet','801EyKSMp','ShopService','Test\x20webhook\x20sent\x20successfully\x20(','amountUSDT','usdtPolygonWallet','getFullYear','delete','üìÖ\x20Date\x20end:\x20','replace','updateShopProfile','secretKey','username','isArray','Payment\x20System/1.0\x20(Test)','error','getMonth','sha256','statusText','telegram','USDT\x20BSC','getPaymentByShopAndId','paid','Invalid\x202FA\x20token\x20or\x20backup\x20code','usdcPolygonWallet','message','disable2FA','currency','USDT\x20Polygon','4KZhnVi','includes','90d','getUTCMonth','getDate','network','customerEmail','\x20\x20\x20üíµ\x20Available\x20balance:\x20','üìÖ\x20Custom\x20date\x20range:\x20','30d','shopUrl2','getPayoutStatistics','generateBackupCodes','üîê\x202FA\x20disabled\x20for\x20shop:\x20','setUTCDate','all','shopUrl4','1142646EPfgnJ','amountAfterGatewayCommissionUSDT','amount','push','settings','totp','this_month','test_order_123','shopUrl','REJECTED','üåê\x20Network\x20filter:\x20','toISOString'];a86_0x2b68=function(){return _0x2a0882;};return a86_0x2b68();}const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a86_0x14a701(0x126))),crypto_1=__importDefault(require(a86_0x14a701(0x127))),speakeasy_1=__importDefault(require(a86_0x14a701(0x185))),qrcode_1=__importDefault(require(a86_0x14a701(0x173))),currencyService_1=require(a86_0x14a701(0x1ab)),paymentService_1=require('./paymentService'),gateway_1=require(a86_0x14a701(0x144));class ShopService{constructor(){const _0x5c3aeb=a86_0x14a701;this[_0x5c3aeb(0x146)]=new paymentService_1[(_0x5c3aeb(0x19e))]();}async[a86_0x14a701(0x131)](_0x1e8b44){const _0x4c911e=a86_0x14a701,_0x4342b3=await database_1[_0x4c911e(0x162)][_0x4c911e(0x128)]['findUnique']({'where':{'id':_0x1e8b44},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x4342b3)throw new Error('Shop\x20not\x20found');let _0x409d71=[];if(_0x4342b3[_0x4c911e(0xfb)]?.[_0x4c911e(0x1ac)])try{_0x409d71=Array[_0x4c911e(0x1c2)](_0x4342b3[_0x4c911e(0xfb)][_0x4c911e(0x1ac)])?_0x4342b3['settings'][_0x4c911e(0x1ac)]:JSON['parse'](_0x4342b3[_0x4c911e(0xfb)][_0x4c911e(0x1ac)]);}catch(_0x5ea913){console[_0x4c911e(0x1c4)](_0x4c911e(0x1a1),_0x5ea913),_0x409d71=[];}const _0x457f15=gateway_1['AVAILABLE_GATEWAYS'][_0x4c911e(0x17e)](_0x2c108f=>_0x2c108f[_0x4c911e(0x116)])['map'](_0x3016a2=>_0x3016a2[_0x4c911e(0x176)]);let _0x107102=_0x4342b3['paymentGateways']?JSON[_0x4c911e(0x17b)](_0x4342b3['paymentGateways']):[];return Array['isArray'](_0x107102)&&(_0x107102=_0x107102[_0x4c911e(0x177)](_0x1c68b7=>_0x1c68b7[_0x4c911e(0x1be)](/\s+/g,'_')[_0x4c911e(0x117)]())[_0x4c911e(0x17e)](_0x27d501=>_0x457f15[_0x4c911e(0xe7)](_0x27d501))),{'id':_0x4342b3['id'],'fullName':_0x4342b3['name'],'username':_0x4342b3[_0x4c911e(0x1c1)],'telegramId':_0x4342b3[_0x4c911e(0xdc)],'merchantUrl':_0x4342b3[_0x4c911e(0xff)],'merchantUrl2':_0x4342b3[_0x4c911e(0xf0)],'merchantUrl3':_0x4342b3[_0x4c911e(0x12b)],'merchantUrl4':_0x4342b3[_0x4c911e(0xf6)],'gateways':_0x107102,'gatewaySettings':_0x4342b3[_0x4c911e(0x19a)]?JSON[_0x4c911e(0x17b)](_0x4342b3['gatewaySettings']):null,'publicKey':_0x4342b3['publicKey'],'secretKey':_0x4342b3[_0x4c911e(0x1c0)],'webhookUrl':_0x4342b3[_0x4c911e(0xfb)]?.[_0x4c911e(0x111)]||null,'webhookEvents':_0x409d71,'wallets':{'usdtPolygonWallet':_0x4342b3[_0x4c911e(0x1ba)],'usdtTrcWallet':_0x4342b3[_0x4c911e(0x191)],'usdtErcWallet':_0x4342b3[_0x4c911e(0x1b5)],'usdcPolygonWallet':_0x4342b3['usdcPolygonWallet'],'usdcErcWallet':_0x4342b3['usdcErcWallet']},'status':_0x4342b3['status'],'createdAt':_0x4342b3[_0x4c911e(0x180)]};}async[a86_0x14a701(0x1bf)](_0x1c25f9,_0x1bbb27){const _0x21cd04=a86_0x14a701,_0x122baa={};_0x1bbb27[_0x21cd04(0x10f)]&&(_0x122baa[_0x21cd04(0x176)]=_0x1bbb27[_0x21cd04(0x10f)]);_0x1bbb27[_0x21cd04(0x10a)]!==undefined&&(_0x122baa[_0x21cd04(0xdc)]=_0x1bbb27[_0x21cd04(0x10a)]||null);_0x1bbb27[_0x21cd04(0x18e)]&&(_0x122baa['shopUrl']=_0x1bbb27[_0x21cd04(0x18e)]);_0x1bbb27['merchantUrl2']!==undefined&&(_0x122baa['shopUrl2']=_0x1bbb27[_0x21cd04(0x186)]||null);_0x1bbb27[_0x21cd04(0x150)]!==undefined&&(_0x122baa[_0x21cd04(0x12b)]=_0x1bbb27['merchantUrl3']||null);_0x1bbb27[_0x21cd04(0x1a6)]!==undefined&&(_0x122baa[_0x21cd04(0xf6)]=_0x1bbb27[_0x21cd04(0x1a6)]||null);_0x1bbb27[_0x21cd04(0x110)]&&(_0x122baa[_0x21cd04(0x11e)]=JSON[_0x21cd04(0x1b0)](_0x1bbb27[_0x21cd04(0x110)]));_0x1bbb27[_0x21cd04(0x19a)]&&(_0x122baa[_0x21cd04(0x19a)]=JSON[_0x21cd04(0x1b0)](_0x1bbb27[_0x21cd04(0x19a)]));_0x1bbb27[_0x21cd04(0x184)]&&(_0x1bbb27[_0x21cd04(0x184)][_0x21cd04(0x1ba)]!==undefined&&(_0x122baa['usdtPolygonWallet']=_0x1bbb27[_0x21cd04(0x184)][_0x21cd04(0x1ba)]||null),_0x1bbb27[_0x21cd04(0x184)][_0x21cd04(0x191)]!==undefined&&(_0x122baa['usdtTrcWallet']=_0x1bbb27['wallets'][_0x21cd04(0x191)]||null),_0x1bbb27[_0x21cd04(0x184)][_0x21cd04(0x1b5)]!==undefined&&(_0x122baa[_0x21cd04(0x1b5)]=_0x1bbb27['wallets'][_0x21cd04(0x1b5)]||null),_0x1bbb27[_0x21cd04(0x184)][_0x21cd04(0xe1)]!==undefined&&(_0x122baa[_0x21cd04(0xe1)]=_0x1bbb27['wallets']['usdcPolygonWallet']||null));const _0x449b09=await database_1[_0x21cd04(0x162)][_0x21cd04(0x128)][_0x21cd04(0x195)]({'where':{'id':_0x1c25f9},'data':_0x122baa,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x5dd5f0=[];if(_0x449b09[_0x21cd04(0xfb)]?.[_0x21cd04(0x1ac)])try{_0x5dd5f0=Array[_0x21cd04(0x1c2)](_0x449b09['settings'][_0x21cd04(0x1ac)])?_0x449b09[_0x21cd04(0xfb)][_0x21cd04(0x1ac)]:JSON[_0x21cd04(0x17b)](_0x449b09['settings'][_0x21cd04(0x1ac)]);}catch(_0x2d9587){console[_0x21cd04(0x1c4)](_0x21cd04(0x1a1),_0x2d9587),_0x5dd5f0=[];}return{'id':_0x449b09['id'],'fullName':_0x449b09[_0x21cd04(0x176)],'username':_0x449b09[_0x21cd04(0x1c1)],'telegramId':_0x449b09[_0x21cd04(0xdc)],'merchantUrl':_0x449b09[_0x21cd04(0xff)],'merchantUrl2':_0x449b09['shopUrl2'],'merchantUrl3':_0x449b09['shopUrl3'],'merchantUrl4':_0x449b09[_0x21cd04(0xf6)],'gateways':_0x449b09[_0x21cd04(0x11e)]?JSON['parse'](_0x449b09[_0x21cd04(0x11e)]):null,'gatewaySettings':_0x449b09[_0x21cd04(0x19a)]?JSON[_0x21cd04(0x17b)](_0x449b09['gatewaySettings']):null,'publicKey':_0x449b09[_0x21cd04(0x1ae)],'secretKey':_0x449b09[_0x21cd04(0x1c0)],'webhookUrl':_0x449b09[_0x21cd04(0xfb)]?.[_0x21cd04(0x111)]||null,'webhookEvents':_0x5dd5f0,'wallets':{'usdtPolygonWallet':_0x449b09[_0x21cd04(0x1ba)],'usdtTrcWallet':_0x449b09[_0x21cd04(0x191)],'usdtErcWallet':_0x449b09['usdtErcWallet'],'usdcPolygonWallet':_0x449b09[_0x21cd04(0xe1)],'usdcErcWallet':_0x449b09[_0x21cd04(0x155)]},'status':_0x449b09[_0x21cd04(0x1aa)],'createdAt':_0x449b09[_0x21cd04(0x180)]};}async['updateWallets'](_0x1ac9c8,_0x4f3996){const _0x1caf9a=a86_0x14a701,_0x1169c3=await database_1['default']['shop']['findUnique']({'where':{'id':_0x1ac9c8},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x1169c3)throw new Error(_0x1caf9a(0x194));if(_0x1169c3['twoFactorEnabled']){if(!_0x4f3996[_0x1caf9a(0x168)])throw new Error('2FA\x20token\x20is\x20required');const _0x1d63ba=speakeasy_1[_0x1caf9a(0x162)][_0x1caf9a(0xfc)][_0x1caf9a(0x1b1)]({'secret':_0x1169c3['twoFactorSecret'],'encoding':_0x1caf9a(0x11f),'token':_0x4f3996[_0x1caf9a(0x168)],'window':0x2});if(!_0x1d63ba){let _0x101adf=![];if(_0x1169c3['backupCodes']){const _0x2056a7=JSON['parse'](_0x1169c3['backupCodes']);for(let _0x316dc9=0x0;_0x316dc9<_0x2056a7[_0x1caf9a(0x137)];_0x316dc9++){const _0x2ef8fc=await bcryptjs_1[_0x1caf9a(0x162)][_0x1caf9a(0x113)](_0x4f3996[_0x1caf9a(0x168)],_0x2056a7[_0x316dc9]);if(_0x2ef8fc){_0x101adf=!![],_0x2056a7[_0x1caf9a(0x10c)](_0x316dc9,0x1),await database_1[_0x1caf9a(0x162)][_0x1caf9a(0x128)][_0x1caf9a(0x195)]({'where':{'id':_0x1ac9c8},'data':{'backupCodes':JSON['stringify'](_0x2056a7)}});break;}}}if(!_0x101adf)throw new Error(_0x1caf9a(0xe0));}}const _0x52c9df={};_0x4f3996[_0x1caf9a(0x1ba)]!==undefined&&(_0x52c9df['usdtPolygonWallet']=_0x4f3996[_0x1caf9a(0x1ba)]||null),_0x4f3996['usdtTrcWallet']!==undefined&&(_0x52c9df['usdtTrcWallet']=_0x4f3996[_0x1caf9a(0x191)]||null),_0x4f3996[_0x1caf9a(0x1b5)]!==undefined&&(_0x52c9df[_0x1caf9a(0x1b5)]=_0x4f3996[_0x1caf9a(0x1b5)]||null),_0x4f3996[_0x1caf9a(0xe1)]!==undefined&&(_0x52c9df[_0x1caf9a(0xe1)]=_0x4f3996[_0x1caf9a(0xe1)]||null),_0x4f3996['usdcErcWallet']!==undefined&&(_0x52c9df[_0x1caf9a(0x155)]=_0x4f3996[_0x1caf9a(0x155)]||null),await database_1[_0x1caf9a(0x162)]['shop'][_0x1caf9a(0x195)]({'where':{'id':_0x1ac9c8},'data':_0x52c9df});}async[a86_0x14a701(0x16b)](_0x2a793a){const _0x1f879d=a86_0x14a701,_0x5e1cd8=await database_1[_0x1f879d(0x162)][_0x1f879d(0x128)][_0x1f879d(0x123)]({'where':{'id':_0x2a793a},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x5e1cd8?.[_0x1f879d(0xfb)]?.['webhookUrl'])throw new Error(_0x1f879d(0x1af));const _0x25f090={'event':_0x1f879d(0x14f),'payment':{'id':'test_payment_123','order_id':_0x1f879d(0xfe),'gateway':_0x1f879d(0x14f),'amount':0x64,'currency':_0x1f879d(0x11a),'status':_0x1f879d(0xdf),'created_at':new Date()[_0x1f879d(0x102)]()}};try{const _0x453f18=JSON[_0x1f879d(0x1b0)](_0x25f090),_0x4bb267=crypto_1['default'][_0x1f879d(0x15d)](_0x1f879d(0x1c6),_0x5e1cd8[_0x1f879d(0x1c0)])[_0x1f879d(0x195)](_0x453f18)['digest']('hex'),_0x40053d=await fetch(_0x5e1cd8['settings']['webhookUrl'],{'method':_0x1f879d(0x11d),'headers':{'Content-Type':_0x1f879d(0x17c),'User-Agent':_0x1f879d(0x1c3),'X-Webhook-Signature':_0x4bb267},'body':_0x453f18});return _0x40053d['ok']?{'success':!![],'message':_0x1f879d(0x1b8)+_0x40053d[_0x1f879d(0x1aa)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x40053d[_0x1f879d(0x1aa)]+'\x20'+_0x40053d[_0x1f879d(0x1c7)]};}catch(_0x4fc077){return{'success':![],'message':_0x1f879d(0x160)+(_0x4fc077 instanceof Error?_0x4fc077[_0x1f879d(0xe2)]:_0x1f879d(0x106))};}}async['createPayment'](_0x3c0add){const _0x11edb3=a86_0x14a701;return this[_0x11edb3(0x146)][_0x11edb3(0x187)]({'public_key':'','gateway':_0x3c0add[_0x11edb3(0x11b)],'order_id':'','amount':_0x3c0add[_0x11edb3(0xf9)],'currency':_0x3c0add[_0x11edb3(0xe4)],'source_currency':_0x3c0add['sourceCurrency'],'success_url':_0x3c0add[_0x11edb3(0x1b2)],'fail_url':_0x3c0add['redirectUrl'],'customer_email':_0x3c0add[_0x11edb3(0xec)],'customer_name':_0x3c0add[_0x11edb3(0x189)],'language':_0x3c0add[_0x11edb3(0x125)]});}async['getPayments'](_0x2b8625,_0x2ce141){const _0x687bea=a86_0x14a701;return this[_0x687bea(0x146)][_0x687bea(0x130)](_0x2b8625,_0x2ce141);}async[a86_0x14a701(0x16a)](_0x2a247d,_0x204624){const _0x120bb8=a86_0x14a701;return this[_0x120bb8(0x146)][_0x120bb8(0xde)](_0x2a247d,_0x204624);}async[a86_0x14a701(0x157)](_0x43fde4,_0x3218f4,_0x40f62b){const _0x2a0461=a86_0x14a701,_0xd35b57=await database_1[_0x2a0461(0x162)]['payment']['findFirst']({'where':{'id':_0x3218f4,'shopId':_0x43fde4}});if(!_0xd35b57)throw new Error('Payment\x20not\x20found');const _0x15c573=await database_1[_0x2a0461(0x162)][_0x2a0461(0x105)][_0x2a0461(0x195)]({'where':{'id':_0x3218f4},'data':{..._0x40f62b,'updatedAt':new Date()}});return _0x15c573;}async[a86_0x14a701(0x170)](_0x118a07,_0x398c64){const _0x4f6f9a=a86_0x14a701,_0x436ef1=await database_1[_0x4f6f9a(0x162)]['payment'][_0x4f6f9a(0x132)]({'where':{'id':_0x398c64,'shopId':_0x118a07}});if(!_0x436ef1)throw new Error(_0x4f6f9a(0x107));await database_1[_0x4f6f9a(0x162)]['payment'][_0x4f6f9a(0x1bc)]({'where':{'id':_0x398c64}});}[a86_0x14a701(0x15f)](_0x275f39){const _0x9d301b=a86_0x14a701,_0xd1b9f5={'polygon':_0x9d301b(0xe5),'trc20':'USDT\x20TRC20','erc20':'USDT\x20ERC20','bsc':_0x9d301b(0xdd),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x9d301b(0x19d)};return _0xd1b9f5[_0x275f39]||_0x275f39;}async['getPayouts'](_0x6721f7,_0x3d4101){const _0x5ca884=a86_0x14a701,{page:_0x9a23e2,limit:_0x38328a,status:_0x5c6f4e,method:_0x314224,network:_0x3c7035,dateFrom:_0x3ca6bb,dateTo:_0x4d17c0,periodFrom:_0xe34789,periodTo:_0x581be6}=_0x3d4101,_0x39e1c7=(_0x9a23e2-0x1)*_0x38328a;console[_0x5ca884(0x13b)](_0x5ca884(0x145),_0x3d4101);const _0x7d2f1a={'shopId':_0x6721f7};_0x5c6f4e&&(_0x7d2f1a[_0x5ca884(0x1aa)]=_0x5c6f4e[_0x5ca884(0x164)](),console[_0x5ca884(0x13b)]('üìä\x20Status\x20filter:\x20'+_0x5c6f4e[_0x5ca884(0x164)]()));if(_0x314224)_0x7d2f1a[_0x5ca884(0xeb)]=_0x314224,console[_0x5ca884(0x13b)]('üåê\x20Method\x20filter:\x20'+_0x314224);else _0x3c7035&&(_0x7d2f1a['network']=_0x3c7035,console[_0x5ca884(0x13b)](_0x5ca884(0x101)+_0x3c7035));if(_0x3ca6bb||_0x4d17c0||_0xe34789||_0x581be6){_0x7d2f1a['createdAt']={};if(_0xe34789){const _0x3683a4=new Date(_0xe34789);_0x3683a4[_0x5ca884(0x142)](0x0,0x0,0x0,0x1),_0x7d2f1a[_0x5ca884(0x180)][_0x5ca884(0x166)]=_0x3683a4,console[_0x5ca884(0x13b)]('üìÖ\x20Period\x20start:\x20'+_0x3683a4['toISOString']());}else{if(_0x3ca6bb){const _0x5c5471=new Date(_0x3ca6bb);_0x5c5471[_0x5ca884(0x142)](0x0,0x0,0x0,0x1),_0x7d2f1a[_0x5ca884(0x180)][_0x5ca884(0x166)]=_0x5c5471,console[_0x5ca884(0x13b)](_0x5ca884(0x16f)+_0x5c5471[_0x5ca884(0x102)]());}}if(_0x581be6){const _0x3dd582=new Date(_0x581be6);_0x3dd582[_0x5ca884(0x142)](0x17,0x3b,0x3b,0x3e7),_0x7d2f1a[_0x5ca884(0x180)]['lte']=_0x3dd582,console[_0x5ca884(0x13b)](_0x5ca884(0x1a3)+_0x3dd582[_0x5ca884(0x102)]());}else{if(_0x4d17c0){const _0x86104d=new Date(_0x4d17c0);_0x86104d[_0x5ca884(0x142)](0x17,0x3b,0x3b,0x3e7),_0x7d2f1a[_0x5ca884(0x180)]['lte']=_0x86104d,console[_0x5ca884(0x13b)](_0x5ca884(0x1bd)+_0x86104d['toISOString']());}}}console[_0x5ca884(0x13b)]('üìä\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x7d2f1a,null,0x2));const [_0x1d9140,_0x46a47b]=await Promise[_0x5ca884(0xf5)]([database_1[_0x5ca884(0x162)][_0x5ca884(0x159)][_0x5ca884(0x156)]({'where':_0x7d2f1a,'skip':_0x39e1c7,'take':_0x38328a,'orderBy':{'createdAt':_0x5ca884(0x19b)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1['default'][_0x5ca884(0x159)][_0x5ca884(0x19c)]({'where':_0x7d2f1a})]);return{'payouts':_0x1d9140[_0x5ca884(0x177)](_0x597b4c=>{const _0x5d9eae=_0x5ca884;let _0x27b246=null;switch(_0x597b4c[_0x5d9eae(0xeb)]){case _0x5d9eae(0x133):_0x27b246=_0x597b4c[_0x5d9eae(0x128)][_0x5d9eae(0x1ba)];break;case'trc20':_0x27b246=_0x597b4c[_0x5d9eae(0x128)][_0x5d9eae(0x191)];break;case'erc20':_0x27b246=_0x597b4c[_0x5d9eae(0x128)][_0x5d9eae(0x1b5)];break;case'polygon_usdc':_0x27b246=_0x597b4c[_0x5d9eae(0x128)][_0x5d9eae(0xe1)];break;case'erc20_usdc':_0x27b246=_0x597b4c[_0x5d9eae(0x128)][_0x5d9eae(0x155)];break;}return{'id':_0x597b4c['id'],'amount':_0x597b4c[_0x5d9eae(0xf9)],'network':this[_0x5d9eae(0x15f)](_0x597b4c[_0x5d9eae(0xeb)]),'wallet':_0x27b246,'status':_0x597b4c['status'],'txid':_0x597b4c['txid'],'notes':_0x597b4c[_0x5d9eae(0x163)],'periodFrom':_0x597b4c[_0x5d9eae(0x1a0)],'periodTo':_0x597b4c[_0x5d9eae(0x122)],'createdAt':_0x597b4c[_0x5d9eae(0x180)],'paidAt':_0x597b4c['paidAt']};}),'pagination':{'page':_0x9a23e2,'limit':_0x38328a,'total':_0x46a47b,'totalPages':Math[_0x5ca884(0x1a4)](_0x46a47b/_0x38328a)}};}async[a86_0x14a701(0x14e)](_0x2fea71,_0x2f33a6){const _0x614d4d=a86_0x14a701,_0x2f354d=await database_1[_0x614d4d(0x162)][_0x614d4d(0x159)][_0x614d4d(0x132)]({'where':{'id':_0x2f33a6,'shopId':_0x2fea71}});if(!_0x2f354d)return null;return{'id':_0x2f354d['id'],'amount':_0x2f354d[_0x614d4d(0xf9)],'network':_0x2f354d[_0x614d4d(0xeb)],'status':_0x2f354d[_0x614d4d(0x1aa)],'txid':_0x2f354d[_0x614d4d(0x172)],'notes':_0x2f354d[_0x614d4d(0x163)],'createdAt':_0x2f354d['createdAt'],'paidAt':_0x2f354d[_0x614d4d(0x169)]};}async[a86_0x14a701(0xf1)](_0x4efdd9,_0x4eba71){const _0x496b98=a86_0x14a701,_0x173cda=new Date();let _0x822f90,_0x36c433;switch(_0x4eba71){case'yesterday':case _0x496b98(0x196):const _0xba3543=new Date(_0x173cda);_0xba3543[_0x496b98(0x16d)](_0xba3543[_0x496b98(0xea)]()-0x1),_0x822f90=new Date(_0xba3543),_0x822f90[_0x496b98(0x142)](0x0,0x0,0x0,0x0),_0x36c433=new Date(_0xba3543),_0x36c433['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x822f90=new Date(_0x173cda[_0x496b98(0x136)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x496b98(0xef):_0x822f90=new Date(_0x173cda['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x496b98(0xe8):_0x822f90=new Date(_0x173cda[_0x496b98(0x136)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x822f90=new Date(_0x173cda[_0x496b98(0x136)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x1c1706={'gte':_0x822f90};_0x36c433&&(_0x1c1706[_0x496b98(0x13d)]=_0x36c433);const [_0x38306e,_0x22661b,_0x110e2c,_0x3308a9,_0x54009f,_0x3f011b]=await Promise['all']([database_1[_0x496b98(0x162)][_0x496b98(0x159)][_0x496b98(0x19c)]({'where':{'shopId':_0x4efdd9,'createdAt':_0x1c1706}}),database_1['default'][_0x496b98(0x159)][_0x496b98(0x19c)]({'where':{'shopId':_0x4efdd9,'status':_0x496b98(0x108),'createdAt':_0x1c1706}}),database_1[_0x496b98(0x162)][_0x496b98(0x159)][_0x496b98(0x19c)]({'where':{'shopId':_0x4efdd9,'status':'PENDING','createdAt':_0x1c1706}}),database_1['default'][_0x496b98(0x159)][_0x496b98(0x19c)]({'where':{'shopId':_0x4efdd9,'status':_0x496b98(0x100),'createdAt':_0x1c1706}}),database_1[_0x496b98(0x162)][_0x496b98(0x159)]['findMany']({'where':{'shopId':_0x4efdd9,'createdAt':_0x1c1706},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x496b98(0x162)][_0x496b98(0x159)][_0x496b98(0x156)]({'where':{'shopId':_0x4efdd9},'take':0xa,'orderBy':{'createdAt':_0x496b98(0x19b)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3a83ba=_0x54009f[_0x496b98(0x178)]((_0x44cfd2,_0x47708d)=>_0x44cfd2+_0x47708d[_0x496b98(0xf9)],0x0),_0x22090b=_0x54009f[_0x496b98(0x17e)](_0x3a1166=>_0x3a1166[_0x496b98(0x1aa)]===_0x496b98(0x108))[_0x496b98(0x178)]((_0xacef36,_0x1bb07d)=>_0xacef36+_0x1bb07d[_0x496b98(0xf9)],0x0),_0x41909d=_0x54009f[_0x496b98(0x17e)](_0x21b891=>_0x21b891[_0x496b98(0x1aa)]==='PENDING')[_0x496b98(0x178)]((_0xbc66fd,_0x2fd3bb)=>_0xbc66fd+_0x2fd3bb[_0x496b98(0xf9)],0x0),_0x9dd24c=_0x54009f['reduce']((_0x2dadab,_0x416dfe)=>{const _0x3ca92d=_0x496b98;return _0x2dadab[_0x416dfe['network']]=(_0x2dadab[_0x416dfe[_0x3ca92d(0xeb)]]||0x0)+0x1,_0x2dadab;},{}),_0x54d75f=_0x54009f[_0x496b98(0x178)]((_0xf4d7cf,_0x4bc4c0)=>{const _0x3a58b8=_0x496b98;return _0xf4d7cf[_0x4bc4c0[_0x3a58b8(0x1aa)]]=(_0xf4d7cf[_0x4bc4c0[_0x3a58b8(0x1aa)]]||0x0)+0x1,_0xf4d7cf;},{});return{'totalPayouts':_0x38306e,'completedPayouts':_0x22661b,'pendingPayouts':_0x110e2c,'rejectedPayouts':_0x3308a9,'totalAmount':_0x3a83ba,'completedAmount':_0x22090b,'pendingAmount':_0x41909d,'payoutsByMethod':_0x9dd24c,'payoutsByStatus':_0x54d75f,'recentPayouts':_0x3f011b[_0x496b98(0x177)](_0x4f609a=>({'id':_0x4f609a['id'],'shopId':_0x4efdd9,'amount':_0x4f609a[_0x496b98(0xf9)],'method':_0x4f609a[_0x496b98(0xeb)],'status':_0x4f609a[_0x496b98(0x1aa)],'txid':_0x4f609a['txid'],'createdAt':_0x4f609a[_0x496b98(0x180)],'paidAt':_0x4f609a[_0x496b98(0x169)]}))};}async[a86_0x14a701(0x15e)](_0x14c670){const _0x5e3f84=a86_0x14a701;console[_0x5e3f84(0x13b)]('üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x14c670+_0x5e3f84(0x192));const _0x13431f=await database_1[_0x5e3f84(0x162)][_0x5e3f84(0x128)][_0x5e3f84(0x123)]({'where':{'id':_0x14c670},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x13431f)throw new Error(_0x5e3f84(0x194));const _0x5688d8=new Date(),_0xc4c1ba=new Date(_0x5688d8[_0x5e3f84(0x1bb)](),_0x5688d8[_0x5e3f84(0x1c5)](),0x1),_0x1d186c=new Date(_0x5688d8[_0x5e3f84(0x1bb)](),_0x5688d8[_0x5e3f84(0x1c5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x40aa43=await database_1[_0x5e3f84(0x162)][_0x5e3f84(0x159)][_0x5e3f84(0x1b4)]({'_sum':{'amount':!![]},'where':{'shopId':_0x14c670,'createdAt':{'gte':_0xc4c1ba,'lte':_0x1d186c},'status':_0x5e3f84(0x108)}}),_0x205673=_0x40aa43[_0x5e3f84(0x13c)]['amount']||0x0,_0x662916={'availableBalance':Math[_0x5e3f84(0x151)](_0x13431f[_0x5e3f84(0x14c)]*0x64)/0x64,'totalPaidOut':Math[_0x5e3f84(0x151)](_0x13431f['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x5e3f84(0x151)](_0x13431f[_0x5e3f84(0x14c)]*0x64)/0x64,'thisMonth':Math[_0x5e3f84(0x151)](_0x205673*0x64)/0x64};return console[_0x5e3f84(0x13b)](_0x5e3f84(0x14a)+_0x13431f[_0x5e3f84(0x1c1)]+_0x5e3f84(0x149)),console['log'](_0x5e3f84(0xed)+_0x662916['availableBalance']+_0x5e3f84(0x1a5)),console[_0x5e3f84(0x13b)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x662916[_0x5e3f84(0x12d)]+_0x5e3f84(0x12c)),console['log'](_0x5e3f84(0x139)+_0x662916[_0x5e3f84(0x193)]+_0x5e3f84(0x1a5)),console['log'](_0x5e3f84(0x1a2)+_0x662916[_0x5e3f84(0x175)]+_0x5e3f84(0x10b)),_0x662916;}[a86_0x14a701(0x174)](_0x51a684){const _0x5636ab=a86_0x14a701,_0x562053={'test_gateway':'Test\x20Gateway','plisio':_0x5636ab(0x198),'rapyd':_0x5636ab(0x1ad),'noda':_0x5636ab(0x165),'cointopay':_0x5636ab(0x152),'klyme_eu':_0x5636ab(0x181),'klyme_gb':_0x5636ab(0x118),'klyme_de':_0x5636ab(0x121)};return _0x562053[_0x51a684]||_0x51a684;}async[a86_0x14a701(0x158)](_0x47579c){const _0x15fdff=a86_0x14a701;return this[_0x15fdff(0x15e)](_0x47579c);}async[a86_0x14a701(0x115)](_0x63e5fd,_0x165201){const _0xded311=a86_0x14a701,{page:_0x36629a,limit:_0x1985c3,paymentId:_0x4fd870}=_0x165201,_0x4fbc79=(_0x36629a-0x1)*_0x1985c3,_0x3dde0e={'shopId':_0x63e5fd};_0x4fd870&&(_0x3dde0e['paymentId']=_0x4fd870);const [_0x5e085d,_0x12258c]=await Promise[_0xded311(0xf5)]([database_1['default'][_0xded311(0x103)][_0xded311(0x156)]({'where':_0x3dde0e,'skip':_0x4fbc79,'take':_0x1985c3,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0xded311(0x162)][_0xded311(0x103)][_0xded311(0x19c)]({'where':_0x3dde0e})]);return{'logs':_0x5e085d['map'](_0x56f637=>({'id':_0x56f637['id'],'paymentId':_0x56f637[_0xded311(0x13f)],'shopId':_0x56f637[_0xded311(0x19f)],'event':_0x56f637[_0xded311(0x10d)],'statusCode':_0x56f637['statusCode'],'retryCount':_0x56f637[_0xded311(0x15a)],'responseBody':_0x56f637[_0xded311(0x197)],'createdAt':_0x56f637[_0xded311(0x180)],'payment':_0x56f637['payment']})),'pagination':{'page':_0x36629a,'limit':_0x1985c3,'total':_0x12258c,'totalPages':Math[_0xded311(0x1a4)](_0x12258c/_0x1985c3)}};}async[a86_0x14a701(0x1a9)](_0x492c88,_0x456e48,_0x3ee297,_0x892bf1,_0xfcf2c4){const _0x35fe37=a86_0x14a701;console['log'](_0x35fe37(0x167)+_0x492c88+_0x35fe37(0x18c)+_0x456e48+_0x35fe37(0x188)+_0x3ee297+_0x35fe37(0x15b)+_0x892bf1);const _0x49e287=_0xfcf2c4?new Date(_0xfcf2c4):new Date();let _0x419fe3,_0x3b3946;if(_0x3ee297&&_0x892bf1){const _0x246a04=new Date(_0x3ee297),_0x523ba8=new Date(_0x892bf1);_0x419fe3=new Date(Date[_0x35fe37(0x179)](_0x246a04[_0x35fe37(0x183)](),_0x246a04['getUTCMonth'](),_0x246a04[_0x35fe37(0x134)](),0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date['UTC'](_0x523ba8[_0x35fe37(0x183)](),_0x523ba8[_0x35fe37(0xe9)](),_0x523ba8[_0x35fe37(0x134)](),0x17,0x3b,0x3b,0x3e7)),console[_0x35fe37(0x13b)](_0x35fe37(0xee)+_0x419fe3[_0x35fe37(0x102)]()+'\x20to\x20'+_0x3b3946[_0x35fe37(0x102)]());}else{if(_0x456e48&&_0x456e48[_0x35fe37(0x18d)](_0x35fe37(0x12a))){const _0x347b73=_0x456e48[_0x35fe37(0x1be)](_0x35fe37(0x12a),'')['split']('_');if(_0x347b73[_0x35fe37(0x137)]===0x2){const _0x65bfef=new Date(_0x347b73[0x0]),_0x57198e=new Date(_0x347b73[0x1]);_0x419fe3=new Date(Date[_0x35fe37(0x179)](_0x65bfef[_0x35fe37(0x183)](),_0x65bfef['getUTCMonth'](),_0x65bfef['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date['UTC'](_0x57198e[_0x35fe37(0x183)](),_0x57198e[_0x35fe37(0xe9)](),_0x57198e[_0x35fe37(0x134)](),0x17,0x3b,0x3b,0x3e7)),console['log'](_0x35fe37(0x14d)+_0x419fe3[_0x35fe37(0x102)]()+_0x35fe37(0x135)+_0x3b3946[_0x35fe37(0x102)]());}else{const _0x146ea2=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x49e287[_0x35fe37(0x134)]()-0x1e));_0x419fe3=new Date(Date[_0x35fe37(0x179)](_0x146ea2[_0x35fe37(0x183)](),_0x146ea2['getUTCMonth'](),_0x146ea2[_0x35fe37(0x134)](),0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x49e287[_0x35fe37(0x134)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x5fc09b=_0x456e48||'this_month';switch(_0x5fc09b[_0x35fe37(0x117)]()){case _0x35fe37(0x12e):_0x419fe3=new Date(Date['UTC'](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x49e287[_0x35fe37(0x134)](),0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287['getUTCMonth'](),_0x49e287[_0x35fe37(0x134)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x236d72=new Date(_0x49e287);_0x236d72[_0x35fe37(0xf4)](_0x236d72[_0x35fe37(0x134)]()-0x1),_0x419fe3=new Date(Date['UTC'](_0x236d72[_0x35fe37(0x183)](),_0x236d72['getUTCMonth'](),_0x236d72[_0x35fe37(0x134)](),0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x236d72[_0x35fe37(0x183)](),_0x236d72['getUTCMonth'](),_0x236d72['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x35fe37(0x129):const _0x2bd4a6=_0x49e287[_0x35fe37(0x153)](),_0x3c109b=_0x2bd4a6===0x0?-0x6:0x1-_0x2bd4a6,_0x5568d5=_0x49e287[_0x35fe37(0x134)]()+_0x3c109b;_0x419fe3=new Date(Date['UTC'](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x5568d5,0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287['getUTCMonth'](),_0x49e287[_0x35fe37(0x134)](),0x17,0x3b,0x3b,0x3e7));break;case _0x35fe37(0x143):const _0x2c8bfc=new Date(Date['UTC'](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x49e287[_0x35fe37(0x134)]()-0x7)),_0x4b0d23=_0x2c8bfc[_0x35fe37(0x153)](),_0x4ccad2=_0x4b0d23===0x0?-0x6:0x1-_0x4b0d23,_0x4ce069=_0x2c8bfc[_0x35fe37(0x134)]()+_0x4ccad2;_0x419fe3=new Date(Date[_0x35fe37(0x179)](_0x2c8bfc[_0x35fe37(0x183)](),_0x2c8bfc['getUTCMonth'](),_0x4ce069,0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date['UTC'](_0x2c8bfc['getUTCFullYear'](),_0x2c8bfc['getUTCMonth'](),_0x4ce069+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x35fe37(0xfd):_0x419fe3=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),0x1,0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x49e287[_0x35fe37(0x134)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x419fe3=new Date(Date[_0x35fe37(0x179)](_0x49e287['getUTCFullYear'](),_0x49e287['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x419fe3=new Date(Date[_0x35fe37(0x179)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x49e287[_0x35fe37(0x134)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x419fe3=new Date(Date[_0x35fe37(0x179)](_0x49e287['getUTCFullYear'](),_0x49e287[_0x35fe37(0xe9)](),0x1,0x0,0x0,0x0,0x0)),_0x3b3946=new Date(Date[_0x35fe37(0x179)](_0x49e287[_0x35fe37(0x183)](),_0x49e287[_0x35fe37(0xe9)](),_0x49e287['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}}console['log']('üìÖ\x20Final\x20date\x20range:\x20'+_0x419fe3['toISOString']()+_0x35fe37(0x135)+_0x3b3946[_0x35fe37(0x102)]());const _0x4044c7={'gte':_0x419fe3,'lte':_0x3b3946},[_0x287c8f,_0x5ace4a,_0x4f1d2a,_0x53c91b,_0x11e4b0,_0xce51ac,_0x1d92fe,_0xebe253,_0x4ef9e1,_0x1b3935,_0x165069]=await Promise['all']([database_1[_0x35fe37(0x162)][_0x35fe37(0x105)][_0x35fe37(0x19c)]({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)},'status':{'notIn':['PENDING','EXPIRED']},'createdAt':_0x4044c7}}),database_1[_0x35fe37(0x162)][_0x35fe37(0x105)][_0x35fe37(0x19c)]({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)},'status':_0x35fe37(0x17f),'createdAt':_0x4044c7}}),database_1[_0x35fe37(0x162)]['payment'][_0x35fe37(0x19c)]({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)},'status':_0x35fe37(0x154)}}),database_1['default'][_0x35fe37(0x105)][_0x35fe37(0x19c)]({'where':{'shopId':_0x492c88,'gateway':{'not':'test_gateway'},'status':_0x35fe37(0x17d)}}),database_1[_0x35fe37(0x162)][_0x35fe37(0x105)][_0x35fe37(0x156)]({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)},'status':_0x35fe37(0x17f),'createdAt':_0x4044c7},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x35fe37(0x162)][_0x35fe37(0x105)]['findMany']({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)}},'take':0x4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x35fe37(0x105)][_0x35fe37(0x156)]({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)},'createdAt':_0x4044c7},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x35fe37(0x120)}}),database_1['default']['payment'][_0x35fe37(0x19c)]({'where':{'shopId':_0x492c88,'gateway':{'not':'test_gateway'},'status':_0x35fe37(0x17f)}}),database_1[_0x35fe37(0x162)][_0x35fe37(0x105)][_0x35fe37(0x156)]({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)},'status':_0x35fe37(0x17f)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x35fe37(0x128)]['findUnique']({'where':{'id':_0x492c88},'select':{'balance':!![]}}),database_1[_0x35fe37(0x162)][_0x35fe37(0x105)][_0x35fe37(0x156)]({'where':{'shopId':_0x492c88,'gateway':{'not':_0x35fe37(0x190)}},'select':{'gateway':!![]}})]),_0x3a5772={};for(const _0x44b09f of _0x165069){_0x44b09f[_0x35fe37(0x11b)]&&(_0x3a5772[_0x44b09f[_0x35fe37(0x11b)]]=(_0x3a5772[_0x44b09f[_0x35fe37(0x11b)]]||0x0)+0x1);}console[_0x35fe37(0x13b)]('üìä\x20Payments\x20by\x20gateway\x20(all\x20time):',_0x3a5772);let _0x192d42=0x0,_0x3d0872=0x0;for(const _0x2f7bb0 of _0x11e4b0){if(_0x2f7bb0[_0x35fe37(0x1b9)])_0x192d42+=_0x2f7bb0[_0x35fe37(0x1b9)];else{const _0xda894b=await currencyService_1['currencyService']['convertToUSDT'](_0x2f7bb0[_0x35fe37(0xf9)],_0x2f7bb0[_0x35fe37(0xe4)]);_0x192d42+=_0xda894b;}_0x2f7bb0[_0x35fe37(0xf8)]&&(_0x3d0872+=_0x2f7bb0[_0x35fe37(0xf8)]);}let _0x36cf5c=0x0;for(const _0x41064c of _0x4ef9e1){_0x41064c[_0x35fe37(0xf8)]&&(_0x36cf5c+=_0x41064c[_0x35fe37(0xf8)]);}const _0x13ab61=this[_0x35fe37(0x119)](_0x1d92fe,_0x419fe3,_0x3b3946||_0x49e287),_0x4fa018=_0x287c8f>0x0?_0x5ace4a/_0x287c8f*0x64:0x0,_0x3b14a9=_0xebe253>0x0?_0x4f1d2a/_0xebe253*0x64:0x0;return{'totalPayments':_0x287c8f,'successfulPayments':_0x5ace4a,'totalRevenue':Math['round'](_0x192d42*0x64)/0x64,'merchantEarnings':Math[_0x35fe37(0x151)](_0x3d0872*0x64)/0x64,'merchantTotalRevenue':Math[_0x35fe37(0x151)](_0x36cf5c*0x64)/0x64,'payoutBalance':Math['round']((_0x1b3935?.['balance']||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x4fa018*0x64)/0x64,'chargebackRate':Math[_0x35fe37(0x151)](_0x3b14a9*0x64)/0x64,'chargebacks':_0x4f1d2a,'refunds':_0x53c91b,'paymentsByGateway':_0x3a5772,'dailyRevenue':_0x13ab61[_0x35fe37(0x13e)],'dailyPayments':_0x13ab61[_0x35fe37(0x11c)],'recentPayments':_0xce51ac[_0x35fe37(0x177)](_0x147825=>({'id':_0x147825['id'],'gateway':_0x147825[_0x35fe37(0x11b)],'amount':_0x147825[_0x35fe37(0xf9)],'currency':_0x147825[_0x35fe37(0xe4)],'status':_0x147825[_0x35fe37(0x1aa)],'createdAt':_0x147825['createdAt']}))};}['generateDailyStatistics'](_0x2469d5,_0x5253f7,_0x509390){const _0x451ad2=a86_0x14a701,_0x4f4b3e=new Map(),_0x131486=new Date(_0x5253f7);while(_0x131486<=_0x509390){const _0x2b1666=_0x131486[_0x451ad2(0x102)]()['split']('T')[0x0];_0x4f4b3e['set'](_0x2b1666,{'revenue':0x0,'count':0x0}),_0x131486[_0x451ad2(0x16d)](_0x131486['getDate']()+0x1);}for(const _0x5a0199 of _0x2469d5){const _0x8fd884=_0x5a0199['createdAt'][_0x451ad2(0x102)]()[_0x451ad2(0x1a7)]('T')[0x0],_0x35dfb8=_0x4f4b3e[_0x451ad2(0x16e)](_0x8fd884);_0x35dfb8&&(_0x35dfb8['count']+=0x1,_0x5a0199['status']===_0x451ad2(0x17f)&&_0x5a0199['amountUSDT']&&(_0x35dfb8[_0x451ad2(0x18f)]+=_0x5a0199[_0x451ad2(0x1b9)]));}const _0x121863=[],_0x1c8399=[];for(const [_0x57c199,_0x420c80]of _0x4f4b3e){_0x121863[_0x451ad2(0xfa)]({'date':_0x57c199,'amount':Math[_0x451ad2(0x151)](_0x420c80[_0x451ad2(0x18f)]*0x64)/0x64}),_0x1c8399[_0x451ad2(0xfa)]({'date':_0x57c199,'count':_0x420c80[_0x451ad2(0x19c)]});}return{'dailyRevenue':_0x121863,'dailyPayments':_0x1c8399};}[a86_0x14a701(0xf2)](_0x3e7109=0x8){const _0x2ec13c=a86_0x14a701,_0x2f0e1a=[];for(let _0x2a4d5a=0x0;_0x2a4d5a<_0x3e7109;_0x2a4d5a++){const _0x2675a1=crypto_1['default'][_0x2ec13c(0x12f)](0x4)[_0x2ec13c(0x124)](_0x2ec13c(0x109))['toUpperCase']();_0x2f0e1a[_0x2ec13c(0xfa)](_0x2675a1);}return _0x2f0e1a;}async[a86_0x14a701(0x148)](_0x2e95bb){const _0x5d9993=a86_0x14a701,_0x20c622=await database_1['default'][_0x5d9993(0x128)][_0x5d9993(0x123)]({'where':{'id':_0x2e95bb},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x20c622)throw new Error(_0x5d9993(0x194));const _0x4a46ae=speakeasy_1[_0x5d9993(0x162)]['generateSecret']({'name':_0x5d9993(0x13a)+_0x20c622[_0x5d9993(0x1c1)]+')','issuer':'TrapaPay','length':0x20}),_0x139e4f=await qrcode_1[_0x5d9993(0x162)]['toDataURL'](_0x4a46ae[_0x5d9993(0x1a8)]),_0x54a017=this[_0x5d9993(0xf2)](0x8),_0x336246=await Promise['all'](_0x54a017[_0x5d9993(0x177)](_0x48800d=>bcryptjs_1[_0x5d9993(0x162)][_0x5d9993(0x15c)](_0x48800d,0xa)));return await database_1[_0x5d9993(0x162)][_0x5d9993(0x128)][_0x5d9993(0x195)]({'where':{'id':_0x2e95bb},'data':{'twoFactorSecret':_0x4a46ae[_0x5d9993(0x11f)],'backupCodes':JSON[_0x5d9993(0x1b0)](_0x336246)}}),console[_0x5d9993(0x13b)]('üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x20c622['username']),console['log']('üîë\x20Generated\x20'+_0x54a017[_0x5d9993(0x137)]+_0x5d9993(0x112)),{'secret':_0x4a46ae[_0x5d9993(0x11f)],'qrCode':_0x139e4f,'manualEntryKey':_0x4a46ae[_0x5d9993(0x11f)],'backupCodes':_0x54a017};}async['enable2FA'](_0x4f1ffa,_0x463ede){const _0x393967=a86_0x14a701,_0x24f21d=await database_1['default'][_0x393967(0x128)][_0x393967(0x123)]({'where':{'id':_0x4f1ffa},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x24f21d)throw new Error(_0x393967(0x194));if(!_0x24f21d[_0x393967(0x138)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x24f21d[_0x393967(0x18b)])throw new Error(_0x393967(0x10e));const _0x285d57=speakeasy_1[_0x393967(0x162)]['totp'][_0x393967(0x1b1)]({'secret':_0x24f21d[_0x393967(0x138)],'encoding':'base32','token':_0x463ede,'window':0x2});if(!_0x285d57)throw new Error(_0x393967(0x140));return await database_1[_0x393967(0x162)][_0x393967(0x128)][_0x393967(0x195)]({'where':{'id':_0x4f1ffa},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x393967(0x171)+_0x24f21d['username']),{'enabled':!![]};}async[a86_0x14a701(0xe3)](_0x50509b){const _0x2d785c=a86_0x14a701,_0x36cb57=await database_1['default']['shop']['findUnique']({'where':{'id':_0x50509b},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x36cb57)throw new Error('Shop\x20not\x20found');await database_1[_0x2d785c(0x162)][_0x2d785c(0x128)][_0x2d785c(0x195)]({'where':{'id':_0x50509b},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x2d785c(0x13b)](_0x2d785c(0xf3)+_0x36cb57[_0x2d785c(0x1c1)]);}}exports[a86_0x14a701(0x1b7)]=ShopService;