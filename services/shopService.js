'use strict';function a77_0x5372(){const _0x50f2bd=['gatewaySettings','defineProperty','randomBytes','usdtTrcWallet','payment','amountUSDT','getGatewayDisplayName','maxPayments','KLYME\x20GB','error','count','getTime','ceil',',\x20dateTo:\x20','ShopService','USDT\x20BSC','generateBackupCodes','ðŸ“…\x20Final\x20date\x20range:\x20','enable2FA','message','txid','includes','updateShopProfile','No\x20webhook\x20URL\x20configured','paymentId','usdtErcWallet','reduce','setUTCDate','getFullYear','currency','push','totp','2882670IrtnTp','round','filter','redirectUrl','126fhFFYU','30d','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','amount','qrcode','compare','update','startsWith','statusText','settings','application/json','notes','../config/database','hex','webhookUrl','USDT\x20ERC20','Invalid\x202FA\x20token','AVAILABLE_GATEWAYS','hash','\x20USDT\x20(total\x20payouts)','findMany','webhookEvents','getShopProfile','username','test_payment_123','paidAt','formatNetworkName','responseBody','ðŸ“…\x20Period\x20end:\x20','publicKey','usdcPolygonWallet','last_month','getWebhookLogs','1075848rwLQVY','ðŸŒ\x20Method\x20filter:\x20','map','Invalid\x202FA\x20token\x20or\x20backup\x20code','PaymentService','getUTCMonth','\x20to\x20','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','base32','setup2FA','otpauth_url','balance','sourceCurrency','name','payout','getDate','paymentGateways','gateways','Noda','replace','2FA\x20is\x20already\x20enabled','awaitingPayout','shopId','getUTCDate','_sum','polygon','telegram','paymentService','findUnique','language','usage','Error\x20parsing\x20webhook\x20events:','generateDailyStatistics','getPayouts','Test\x20webhook\x20sent\x20successfully\x20(','REJECTED','test_order_123','twoFactorSecret','crypto','today','TrapaPay','90d','expiresAt','setHours','revenue','\x20payout\x20statistics\x20calculated:','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','TrapaPay\x20(','periodTo','KLYME\x20DE','7266GqCESS','ðŸŒ\x20Network\x20filter:\x20','trc20','324049AAIDCe','../types/gateway','default','Rapyd','getPayoutStatistics','setDate','Webhook\x20returned\x20error:\x20','CHARGEBACK','YESTERDAY','USDT\x20TRC20','420OADCIT','customer','telegramId','usdtPolygonWallet','shopUrl','\x20USDT\x20(current\x20balance)','Plisio','statusCode','Unknown\x20error','availableBalance','__esModule','disable2FA','desc','parse','yesterday','createdAt','status','toISOString','polygon_usdc','2187180ImiohG','ðŸ“Š\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','CoinToPay','findFirst','erc20','currencyService','UTC','customerName','wallets','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','merchantUrl','totalPaidOut','isActive','USDC\x20Ethereum','33252KxvmnF','ðŸ“Š\x20Status\x20filter:\x20','twoFactorToken','Payment\x20not\x20found','76tsriLa','webhookLog','isArray',',\x20period:\x20','PENDING','asc','...','getPayoutStats','amountAfterGatewayCommissionUSDT','stringify','amountIsEditable','2644MlWWvV','getPayments','PAID','verify','retryCount','getPaymentById','COMPLETED','2FA\x20token\x20is\x20required','toUpperCase','this_month','getShopPayoutStats','bcryptjs','this_week','test_gateway','lte','toLowerCase','EXPIRED','getUTCFullYear','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','network','./currencyService','log','gte','all','test','ðŸ’°\x20Getting\x20payouts\x20with\x20filters:','gateway','split','ðŸ”‘\x20Generated\x20','\x20USDT','fullName','shop','toString','periodFrom','thisMonth','dailyPayments','getUTCDay','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','35ardici','usdcErcWallet','twoFactorEnabled','Shop\x20not\x20found','getMonth','ðŸ“…\x20Date\x20end:\x20','custom_','createPublicPayment','getStatistics','getPayoutById'];a77_0x5372=function(){return _0x50f2bd;};return a77_0x5372();}const a77_0x584779=a77_0x3574;(function(_0x50d0d9,_0x59eacf){const _0x361489=a77_0x3574,_0x255c90=_0x50d0d9();while(!![]){try{const _0x55baef=parseInt(_0x361489(0x21e))/0x1*(-parseInt(_0x361489(0x213))/0x2)+-parseInt(_0x361489(0x18e))/0x3*(parseInt(_0x361489(0x20f))/0x4)+parseInt(_0x361489(0x245))/0x5*(parseInt(_0x361489(0x1e1))/0x6)+-parseInt(_0x361489(0x18a))/0x7+parseInt(_0x361489(0x1af))/0x8+-parseInt(_0x361489(0x201))/0x9+-parseInt(_0x361489(0x1ee))/0xa*(-parseInt(_0x361489(0x1e4))/0xb);if(_0x55baef===_0x59eacf)break;else _0x255c90['push'](_0x255c90['shift']());}catch(_0x5b3da0){_0x255c90['push'](_0x255c90['shift']());}}}(a77_0x5372,0x4354c));function a77_0x3574(_0x518fb5,_0x38cd5a){_0x518fb5=_0x518fb5-0x16f;const _0x537273=a77_0x5372();let _0x35744a=_0x537273[_0x518fb5];return _0x35744a;}var __importDefault=this&&this['__importDefault']||function(_0x3e828a){const _0x1ec82e=a77_0x3574;return _0x3e828a&&_0x3e828a[_0x1ec82e(0x1f8)]?_0x3e828a:{'default':_0x3e828a};};Object[a77_0x584779(0x250)](exports,a77_0x584779(0x1f8),{'value':!![]}),exports[a77_0x584779(0x178)]=void 0x0;const database_1=__importDefault(require(a77_0x584779(0x19a))),bcryptjs_1=__importDefault(require(a77_0x584779(0x229))),crypto_1=__importDefault(require(a77_0x584779(0x1d5))),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a77_0x584779(0x192))),currencyService_1=require(a77_0x584779(0x232)),paymentService_1=require('./paymentService'),gateway_1=require(a77_0x584779(0x1e5));class ShopService{constructor(){const _0x1ce35a=a77_0x584779;this[_0x1ce35a(0x1ca)]=new paymentService_1[(_0x1ce35a(0x1b3))]();}async[a77_0x584779(0x1a4)](_0x40bdec){const _0x3ce0eb=a77_0x584779,_0x5dd952=await database_1[_0x3ce0eb(0x1e6)]['shop'][_0x3ce0eb(0x1cb)]({'where':{'id':_0x40bdec},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x5dd952)throw new Error(_0x3ce0eb(0x248));let _0x4c747b=[];if(_0x5dd952[_0x3ce0eb(0x197)]?.['webhookEvents'])try{_0x4c747b=Array['isArray'](_0x5dd952[_0x3ce0eb(0x197)]['webhookEvents'])?_0x5dd952['settings'][_0x3ce0eb(0x1a3)]:JSON[_0x3ce0eb(0x1fb)](_0x5dd952[_0x3ce0eb(0x197)][_0x3ce0eb(0x1a3)]);}catch(_0x59ed25){console[_0x3ce0eb(0x173)](_0x3ce0eb(0x1ce),_0x59ed25),_0x4c747b=[];}const _0x257cd0=gateway_1[_0x3ce0eb(0x19f)][_0x3ce0eb(0x18c)](_0x3db5c7=>_0x3db5c7[_0x3ce0eb(0x20d)])[_0x3ce0eb(0x1b1)](_0x33afe1=>_0x33afe1[_0x3ce0eb(0x1bc)]);let _0xba02be=_0x5dd952['paymentGateways']?JSON[_0x3ce0eb(0x1fb)](_0x5dd952['paymentGateways']):[];return Array[_0x3ce0eb(0x215)](_0xba02be)&&(_0xba02be=_0xba02be['filter'](_0x4a3b9b=>_0x257cd0[_0x3ce0eb(0x17f)](_0x4a3b9b))),{'id':_0x5dd952['id'],'fullName':_0x5dd952[_0x3ce0eb(0x1bc)],'username':_0x5dd952[_0x3ce0eb(0x1a5)],'telegramId':_0x5dd952['telegram'],'merchantUrl':_0x5dd952['shopUrl'],'gateways':_0xba02be,'gatewaySettings':_0x5dd952[_0x3ce0eb(0x24f)]?JSON[_0x3ce0eb(0x1fb)](_0x5dd952[_0x3ce0eb(0x24f)]):null,'publicKey':_0x5dd952[_0x3ce0eb(0x1ab)],'webhookUrl':_0x5dd952['settings']?.[_0x3ce0eb(0x19c)]||null,'webhookEvents':_0x4c747b,'wallets':{'usdtPolygonWallet':_0x5dd952[_0x3ce0eb(0x1f1)],'usdtTrcWallet':_0x5dd952[_0x3ce0eb(0x252)],'usdtErcWallet':_0x5dd952[_0x3ce0eb(0x183)],'usdcPolygonWallet':_0x5dd952['usdcPolygonWallet'],'usdcErcWallet':_0x5dd952[_0x3ce0eb(0x246)]},'status':_0x5dd952['status'],'createdAt':_0x5dd952[_0x3ce0eb(0x1fd)]};}async[a77_0x584779(0x180)](_0x16ccef,_0x588dee){const _0x2a7c7a=a77_0x584779,_0x9e9491={};_0x588dee[_0x2a7c7a(0x23c)]&&(_0x9e9491['name']=_0x588dee['fullName']);_0x588dee[_0x2a7c7a(0x1f0)]!==undefined&&(_0x9e9491[_0x2a7c7a(0x1c9)]=_0x588dee[_0x2a7c7a(0x1f0)]||null);_0x588dee['merchantUrl']&&(_0x9e9491[_0x2a7c7a(0x1f2)]=_0x588dee[_0x2a7c7a(0x20b)]);_0x588dee[_0x2a7c7a(0x1c0)]&&(_0x9e9491['paymentGateways']=JSON[_0x2a7c7a(0x21c)](_0x588dee[_0x2a7c7a(0x1c0)]));_0x588dee[_0x2a7c7a(0x24f)]&&(_0x9e9491['gatewaySettings']=JSON[_0x2a7c7a(0x21c)](_0x588dee['gatewaySettings']));_0x588dee[_0x2a7c7a(0x209)]&&(_0x588dee[_0x2a7c7a(0x209)][_0x2a7c7a(0x1f1)]!==undefined&&(_0x9e9491[_0x2a7c7a(0x1f1)]=_0x588dee[_0x2a7c7a(0x209)][_0x2a7c7a(0x1f1)]||null),_0x588dee['wallets']['usdtTrcWallet']!==undefined&&(_0x9e9491[_0x2a7c7a(0x252)]=_0x588dee[_0x2a7c7a(0x209)]['usdtTrcWallet']||null),_0x588dee[_0x2a7c7a(0x209)][_0x2a7c7a(0x183)]!==undefined&&(_0x9e9491['usdtErcWallet']=_0x588dee[_0x2a7c7a(0x209)][_0x2a7c7a(0x183)]||null),_0x588dee[_0x2a7c7a(0x209)][_0x2a7c7a(0x1ac)]!==undefined&&(_0x9e9491[_0x2a7c7a(0x1ac)]=_0x588dee[_0x2a7c7a(0x209)]['usdcPolygonWallet']||null));const _0x2cda67=await database_1[_0x2a7c7a(0x1e6)][_0x2a7c7a(0x23d)]['update']({'where':{'id':_0x16ccef},'data':_0x9e9491,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x207b72=[];if(_0x2cda67['settings']?.[_0x2a7c7a(0x1a3)])try{_0x207b72=Array['isArray'](_0x2cda67['settings']['webhookEvents'])?_0x2cda67[_0x2a7c7a(0x197)][_0x2a7c7a(0x1a3)]:JSON[_0x2a7c7a(0x1fb)](_0x2cda67[_0x2a7c7a(0x197)][_0x2a7c7a(0x1a3)]);}catch(_0x42c576){console[_0x2a7c7a(0x173)](_0x2a7c7a(0x1ce),_0x42c576),_0x207b72=[];}return{'id':_0x2cda67['id'],'fullName':_0x2cda67['name'],'username':_0x2cda67['username'],'telegramId':_0x2cda67[_0x2a7c7a(0x1c9)],'merchantUrl':_0x2cda67[_0x2a7c7a(0x1f2)],'gateways':_0x2cda67[_0x2a7c7a(0x1bf)]?JSON[_0x2a7c7a(0x1fb)](_0x2cda67[_0x2a7c7a(0x1bf)]):null,'gatewaySettings':_0x2cda67[_0x2a7c7a(0x24f)]?JSON[_0x2a7c7a(0x1fb)](_0x2cda67[_0x2a7c7a(0x24f)]):null,'publicKey':_0x2cda67[_0x2a7c7a(0x1ab)],'webhookUrl':_0x2cda67['settings']?.[_0x2a7c7a(0x19c)]||null,'webhookEvents':_0x207b72,'wallets':{'usdtPolygonWallet':_0x2cda67['usdtPolygonWallet'],'usdtTrcWallet':_0x2cda67[_0x2a7c7a(0x252)],'usdtErcWallet':_0x2cda67['usdtErcWallet'],'usdcPolygonWallet':_0x2cda67[_0x2a7c7a(0x1ac)],'usdcErcWallet':_0x2cda67[_0x2a7c7a(0x246)]},'status':_0x2cda67[_0x2a7c7a(0x1fe)],'createdAt':_0x2cda67[_0x2a7c7a(0x1fd)]};}async['updateWallets'](_0x2776ab,_0xca668e){const _0x57bad5=a77_0x584779,_0x284595=await database_1[_0x57bad5(0x1e6)]['shop']['findUnique']({'where':{'id':_0x2776ab},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x284595)throw new Error(_0x57bad5(0x248));if(_0x284595[_0x57bad5(0x247)]){if(!_0xca668e[_0x57bad5(0x211)])throw new Error(_0x57bad5(0x225));const _0xedc379=speakeasy_1['default'][_0x57bad5(0x189)]['verify']({'secret':_0x284595[_0x57bad5(0x1d4)],'encoding':_0x57bad5(0x1b7),'token':_0xca668e['twoFactorToken'],'window':0x2});if(!_0xedc379){let _0x345ada=![];if(_0x284595['backupCodes']){const _0x458943=JSON[_0x57bad5(0x1fb)](_0x284595['backupCodes']);for(let _0x117f4c=0x0;_0x117f4c<_0x458943['length'];_0x117f4c++){const _0x3cdb55=await bcryptjs_1[_0x57bad5(0x1e6)][_0x57bad5(0x193)](_0xca668e[_0x57bad5(0x211)],_0x458943[_0x117f4c]);if(_0x3cdb55){_0x345ada=!![],_0x458943['splice'](_0x117f4c,0x1),await database_1['default'][_0x57bad5(0x23d)][_0x57bad5(0x194)]({'where':{'id':_0x2776ab},'data':{'backupCodes':JSON[_0x57bad5(0x21c)](_0x458943)}});break;}}}if(!_0x345ada)throw new Error(_0x57bad5(0x1b2));}}const _0x3db32e={};_0xca668e[_0x57bad5(0x1f1)]!==undefined&&(_0x3db32e[_0x57bad5(0x1f1)]=_0xca668e[_0x57bad5(0x1f1)]||null),_0xca668e['usdtTrcWallet']!==undefined&&(_0x3db32e['usdtTrcWallet']=_0xca668e['usdtTrcWallet']||null),_0xca668e[_0x57bad5(0x183)]!==undefined&&(_0x3db32e[_0x57bad5(0x183)]=_0xca668e[_0x57bad5(0x183)]||null),_0xca668e[_0x57bad5(0x1ac)]!==undefined&&(_0x3db32e['usdcPolygonWallet']=_0xca668e['usdcPolygonWallet']||null),_0xca668e[_0x57bad5(0x246)]!==undefined&&(_0x3db32e[_0x57bad5(0x246)]=_0xca668e[_0x57bad5(0x246)]||null),await database_1['default'][_0x57bad5(0x23d)][_0x57bad5(0x194)]({'where':{'id':_0x2776ab},'data':_0x3db32e});}async['testWebhook'](_0x44732e){const _0x5b2732=a77_0x584779,_0x20859f=await database_1[_0x5b2732(0x1e6)][_0x5b2732(0x23d)][_0x5b2732(0x1cb)]({'where':{'id':_0x44732e},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x20859f?.['settings']?.[_0x5b2732(0x19c)])throw new Error(_0x5b2732(0x181));const _0x233b1d={'event':_0x5b2732(0x236),'payment':{'id':_0x5b2732(0x1a6),'order_id':_0x5b2732(0x1d3),'gateway':'test','amount':0x64,'currency':'USD','status':'paid','created_at':new Date()['toISOString']()}};try{const _0x524b32=await fetch(_0x20859f[_0x5b2732(0x197)]['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x5b2732(0x198),'User-Agent':'Payment\x20System/1.0\x20(Test)'},'body':JSON['stringify'](_0x233b1d)});return _0x524b32['ok']?{'success':!![],'message':_0x5b2732(0x1d1)+_0x524b32[_0x5b2732(0x1fe)]+')'}:{'success':![],'message':_0x5b2732(0x1ea)+_0x524b32[_0x5b2732(0x1fe)]+'\x20'+_0x524b32[_0x5b2732(0x196)]};}catch(_0xc95d95){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0xc95d95 instanceof Error?_0xc95d95[_0x5b2732(0x17d)]:_0x5b2732(0x1f6))};}}async['createPayment'](_0x225071){const _0x553a69=a77_0x584779;return this[_0x553a69(0x1ca)][_0x553a69(0x24c)]({'public_key':'','gateway':_0x225071[_0x553a69(0x238)],'order_id':undefined,'amount':_0x225071[_0x553a69(0x191)],'currency':_0x225071['currency'],'source_currency':_0x225071[_0x553a69(0x1bb)],'usage':_0x225071[_0x553a69(0x1cd)],'expires_at':_0x225071[_0x553a69(0x1d9)]?.[_0x553a69(0x1ff)](),'success_url':_0x225071['redirectUrl'],'fail_url':_0x225071[_0x553a69(0x18d)],'customer_email':_0x225071['customerEmail'],'customer_name':_0x225071[_0x553a69(0x208)],'country':_0x225071['country'],'language':_0x225071[_0x553a69(0x1cc)],'amount_is_editable':_0x225071[_0x553a69(0x21d)],'max_payments':_0x225071[_0x553a69(0x171)],'customer':_0x225071[_0x553a69(0x1ef)]});}async[a77_0x584779(0x21f)](_0x30c3e6,_0x5bf1db){return this['paymentService']['getPaymentsByShop'](_0x30c3e6,_0x5bf1db);}async[a77_0x584779(0x223)](_0x180a39,_0x1c4eaa){const _0x2077f3=a77_0x584779;return this[_0x2077f3(0x1ca)]['getPaymentByShopAndId'](_0x180a39,_0x1c4eaa);}async['updatePayment'](_0x1e6048,_0x6a7410,_0x184606){const _0x1e8e98=a77_0x584779,_0x271ec2=await database_1[_0x1e8e98(0x1e6)][_0x1e8e98(0x253)]['findFirst']({'where':{'id':_0x6a7410,'shopId':_0x1e6048}});if(!_0x271ec2)throw new Error(_0x1e8e98(0x212));const _0x62190d=await database_1[_0x1e8e98(0x1e6)][_0x1e8e98(0x253)]['update']({'where':{'id':_0x6a7410},'data':{..._0x184606,'updatedAt':new Date()}});return _0x62190d;}async['deletePayment'](_0x1f4ffb,_0x22a169){const _0x552b1b=a77_0x584779,_0xbf3402=await database_1[_0x552b1b(0x1e6)][_0x552b1b(0x253)]['findFirst']({'where':{'id':_0x22a169,'shopId':_0x1f4ffb}});if(!_0xbf3402)throw new Error(_0x552b1b(0x212));await database_1[_0x552b1b(0x1e6)]['payment']['delete']({'where':{'id':_0x22a169}});}['formatNetworkName'](_0x2e5b5c){const _0x540d4a=a77_0x584779,_0x1f1f91={'polygon':'USDT\x20Polygon','trc20':_0x540d4a(0x1ed),'erc20':_0x540d4a(0x19d),'bsc':_0x540d4a(0x179),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x540d4a(0x20e)};return _0x1f1f91[_0x2e5b5c]||_0x2e5b5c;}async[a77_0x584779(0x1d0)](_0x285c8c,_0x3fa229){const _0x2d5d2f=a77_0x584779,{page:_0x3c2b8f,limit:_0x1d8ec8,status:_0x32d0a8,method:_0x69560e,network:_0x4c3f5e,dateFrom:_0x4d0102,dateTo:_0x3d885d,periodFrom:_0x44f9b2,periodTo:_0x47bc54}=_0x3fa229,_0x160581=(_0x3c2b8f-0x1)*_0x1d8ec8;console[_0x2d5d2f(0x233)](_0x2d5d2f(0x237),_0x3fa229);const _0x4f36ba={'shopId':_0x285c8c};_0x32d0a8&&(_0x4f36ba[_0x2d5d2f(0x1fe)]=_0x32d0a8[_0x2d5d2f(0x226)](),console[_0x2d5d2f(0x233)](_0x2d5d2f(0x210)+_0x32d0a8[_0x2d5d2f(0x226)]()));if(_0x69560e)_0x4f36ba[_0x2d5d2f(0x231)]=_0x69560e,console[_0x2d5d2f(0x233)](_0x2d5d2f(0x1b0)+_0x69560e);else _0x4c3f5e&&(_0x4f36ba[_0x2d5d2f(0x231)]=_0x4c3f5e,console[_0x2d5d2f(0x233)](_0x2d5d2f(0x1e2)+_0x4c3f5e));if(_0x4d0102||_0x3d885d||_0x44f9b2||_0x47bc54){_0x4f36ba[_0x2d5d2f(0x1fd)]={};if(_0x44f9b2){const _0xc76c24=new Date(_0x44f9b2);_0xc76c24['setHours'](0x0,0x0,0x0,0x1),_0x4f36ba[_0x2d5d2f(0x1fd)][_0x2d5d2f(0x234)]=_0xc76c24,console[_0x2d5d2f(0x233)]('ðŸ“…\x20Period\x20start:\x20'+_0xc76c24[_0x2d5d2f(0x1ff)]());}else{if(_0x4d0102){const _0x3b934d=new Date(_0x4d0102);_0x3b934d[_0x2d5d2f(0x1da)](0x0,0x0,0x0,0x1),_0x4f36ba[_0x2d5d2f(0x1fd)]['gte']=_0x3b934d,console['log']('ðŸ“…\x20Date\x20start:\x20'+_0x3b934d[_0x2d5d2f(0x1ff)]());}}if(_0x47bc54){const _0xca2383=new Date(_0x47bc54);_0xca2383[_0x2d5d2f(0x1da)](0x17,0x3b,0x3b,0x3e7),_0x4f36ba['createdAt'][_0x2d5d2f(0x22c)]=_0xca2383,console[_0x2d5d2f(0x233)](_0x2d5d2f(0x1aa)+_0xca2383[_0x2d5d2f(0x1ff)]());}else{if(_0x3d885d){const _0x3a047c=new Date(_0x3d885d);_0x3a047c[_0x2d5d2f(0x1da)](0x17,0x3b,0x3b,0x3e7),_0x4f36ba[_0x2d5d2f(0x1fd)][_0x2d5d2f(0x22c)]=_0x3a047c,console['log'](_0x2d5d2f(0x24a)+_0x3a047c[_0x2d5d2f(0x1ff)]());}}}console[_0x2d5d2f(0x233)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x2d5d2f(0x21c)](_0x4f36ba,null,0x2));const [_0x4f4a7a,_0x2564e9]=await Promise[_0x2d5d2f(0x235)]([database_1[_0x2d5d2f(0x1e6)][_0x2d5d2f(0x1bd)][_0x2d5d2f(0x1a2)]({'where':_0x4f36ba,'skip':_0x160581,'take':_0x1d8ec8,'orderBy':{'createdAt':_0x2d5d2f(0x1fa)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x2d5d2f(0x1e6)][_0x2d5d2f(0x1bd)][_0x2d5d2f(0x174)]({'where':_0x4f36ba})]);return{'payouts':_0x4f4a7a['map'](_0x4910ef=>{const _0x26d53b=_0x2d5d2f;let _0x52ffb4=null;switch(_0x4910ef[_0x26d53b(0x231)]){case _0x26d53b(0x1c8):_0x52ffb4=_0x4910ef[_0x26d53b(0x23d)]['usdtPolygonWallet'];break;case _0x26d53b(0x1e3):_0x52ffb4=_0x4910ef[_0x26d53b(0x23d)][_0x26d53b(0x252)];break;case _0x26d53b(0x205):_0x52ffb4=_0x4910ef['shop'][_0x26d53b(0x183)];break;case _0x26d53b(0x200):_0x52ffb4=_0x4910ef[_0x26d53b(0x23d)][_0x26d53b(0x1ac)];break;case'erc20_usdc':_0x52ffb4=_0x4910ef['shop'][_0x26d53b(0x246)];break;}return{'id':_0x4910ef['id'],'amount':_0x4910ef[_0x26d53b(0x191)],'network':this[_0x26d53b(0x1a8)](_0x4910ef['network']),'wallet':_0x52ffb4,'status':_0x4910ef['status'],'txid':_0x4910ef[_0x26d53b(0x17e)],'notes':_0x4910ef[_0x26d53b(0x199)],'periodFrom':_0x4910ef[_0x26d53b(0x23f)],'periodTo':_0x4910ef[_0x26d53b(0x1df)],'createdAt':_0x4910ef[_0x26d53b(0x1fd)],'paidAt':_0x4910ef['paidAt']};}),'pagination':{'page':_0x3c2b8f,'limit':_0x1d8ec8,'total':_0x2564e9,'totalPages':Math['ceil'](_0x2564e9/_0x1d8ec8)}};}async[a77_0x584779(0x24e)](_0x1d5baf,_0x521c0f){const _0x387459=a77_0x584779,_0x55187f=await database_1[_0x387459(0x1e6)][_0x387459(0x1bd)][_0x387459(0x204)]({'where':{'id':_0x521c0f,'shopId':_0x1d5baf}});if(!_0x55187f)return null;return{'id':_0x55187f['id'],'amount':_0x55187f[_0x387459(0x191)],'network':_0x55187f[_0x387459(0x231)],'status':_0x55187f['status'],'txid':_0x55187f['txid'],'notes':_0x55187f[_0x387459(0x199)],'createdAt':_0x55187f[_0x387459(0x1fd)],'paidAt':_0x55187f['paidAt']};}async[a77_0x584779(0x1e8)](_0x959ebd,_0x5015bf){const _0x2794be=a77_0x584779,_0x2677ad=new Date();let _0x253776,_0x41c33d;switch(_0x5015bf){case _0x2794be(0x1fc):case _0x2794be(0x1ec):const _0x10553e=new Date(_0x2677ad);_0x10553e[_0x2794be(0x1e9)](_0x10553e[_0x2794be(0x1be)]()-0x1),_0x253776=new Date(_0x10553e),_0x253776['setHours'](0x0,0x0,0x0,0x0),_0x41c33d=new Date(_0x10553e),_0x41c33d[_0x2794be(0x1da)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x253776=new Date(_0x2677ad[_0x2794be(0x175)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2794be(0x18f):_0x253776=new Date(_0x2677ad[_0x2794be(0x175)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2794be(0x1d8):_0x253776=new Date(_0x2677ad[_0x2794be(0x175)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x253776=new Date(_0x2677ad[_0x2794be(0x175)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x4b5cc1={'gte':_0x253776};_0x41c33d&&(_0x4b5cc1[_0x2794be(0x22c)]=_0x41c33d);const [_0x26f90c,_0x35c0ca,_0x5c495b,_0x475cf6,_0x5c08cd,_0x5b53ae]=await Promise['all']([database_1['default'][_0x2794be(0x1bd)][_0x2794be(0x174)]({'where':{'shopId':_0x959ebd,'createdAt':_0x4b5cc1}}),database_1[_0x2794be(0x1e6)][_0x2794be(0x1bd)][_0x2794be(0x174)]({'where':{'shopId':_0x959ebd,'status':_0x2794be(0x224),'createdAt':_0x4b5cc1}}),database_1[_0x2794be(0x1e6)][_0x2794be(0x1bd)][_0x2794be(0x174)]({'where':{'shopId':_0x959ebd,'status':_0x2794be(0x217),'createdAt':_0x4b5cc1}}),database_1[_0x2794be(0x1e6)]['payout'][_0x2794be(0x174)]({'where':{'shopId':_0x959ebd,'status':_0x2794be(0x1d2),'createdAt':_0x4b5cc1}}),database_1[_0x2794be(0x1e6)][_0x2794be(0x1bd)][_0x2794be(0x1a2)]({'where':{'shopId':_0x959ebd,'createdAt':_0x4b5cc1},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x2794be(0x1bd)][_0x2794be(0x1a2)]({'where':{'shopId':_0x959ebd},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x46c8f2=_0x5c08cd[_0x2794be(0x184)]((_0xcdb4e1,_0x4d7000)=>_0xcdb4e1+_0x4d7000[_0x2794be(0x191)],0x0),_0x1b0539=_0x5c08cd[_0x2794be(0x18c)](_0x270e8b=>_0x270e8b[_0x2794be(0x1fe)]===_0x2794be(0x224))['reduce']((_0x19e9fb,_0x3c2af1)=>_0x19e9fb+_0x3c2af1[_0x2794be(0x191)],0x0),_0x3e5d6f=_0x5c08cd[_0x2794be(0x18c)](_0x405bf7=>_0x405bf7['status']==='PENDING')[_0x2794be(0x184)]((_0x441239,_0x886903)=>_0x441239+_0x886903[_0x2794be(0x191)],0x0),_0x2cbfe1=_0x5c08cd[_0x2794be(0x184)]((_0x1688b1,_0xb1d1e0)=>{const _0x436995=_0x2794be;return _0x1688b1[_0xb1d1e0[_0x436995(0x231)]]=(_0x1688b1[_0xb1d1e0[_0x436995(0x231)]]||0x0)+0x1,_0x1688b1;},{}),_0x267899=_0x5c08cd[_0x2794be(0x184)]((_0x4fc16f,_0x46bbc7)=>{const _0x57ba7a=_0x2794be;return _0x4fc16f[_0x46bbc7[_0x57ba7a(0x1fe)]]=(_0x4fc16f[_0x46bbc7['status']]||0x0)+0x1,_0x4fc16f;},{});return{'totalPayouts':_0x26f90c,'completedPayouts':_0x35c0ca,'pendingPayouts':_0x5c495b,'rejectedPayouts':_0x475cf6,'totalAmount':_0x46c8f2,'completedAmount':_0x1b0539,'pendingAmount':_0x3e5d6f,'payoutsByMethod':_0x2cbfe1,'payoutsByStatus':_0x267899,'recentPayouts':_0x5b53ae[_0x2794be(0x1b1)](_0x34fcc8=>({'id':_0x34fcc8['id'],'shopId':_0x959ebd,'amount':_0x34fcc8[_0x2794be(0x191)],'method':_0x34fcc8[_0x2794be(0x231)],'status':_0x34fcc8[_0x2794be(0x1fe)],'txid':_0x34fcc8['txid'],'createdAt':_0x34fcc8[_0x2794be(0x1fd)],'paidAt':_0x34fcc8[_0x2794be(0x1a7)]}))};}async[a77_0x584779(0x228)](_0x297846){const _0x50ae6d=a77_0x584779;console[_0x50ae6d(0x233)](_0x50ae6d(0x202)+_0x297846+_0x50ae6d(0x219));const _0x385007=await database_1[_0x50ae6d(0x1e6)][_0x50ae6d(0x23d)][_0x50ae6d(0x1cb)]({'where':{'id':_0x297846},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x385007)throw new Error(_0x50ae6d(0x248));const _0x397aef=new Date(),_0x5f4eda=new Date(_0x397aef[_0x50ae6d(0x186)](),_0x397aef[_0x50ae6d(0x249)](),0x1),_0x2b1bcb=new Date(_0x397aef['getFullYear'](),_0x397aef[_0x50ae6d(0x249)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x43dc11=await database_1[_0x50ae6d(0x1e6)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x297846,'createdAt':{'gte':_0x5f4eda,'lte':_0x2b1bcb},'status':'COMPLETED'}}),_0x4d5a49=_0x43dc11[_0x50ae6d(0x1c7)][_0x50ae6d(0x191)]||0x0,_0x2b1f3d={'availableBalance':Math[_0x50ae6d(0x18b)](_0x385007[_0x50ae6d(0x1ba)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x385007[_0x50ae6d(0x20c)]*0x64)/0x64,'awaitingPayout':Math[_0x50ae6d(0x18b)](_0x385007['balance']*0x64)/0x64,'thisMonth':Math[_0x50ae6d(0x18b)](_0x4d5a49*0x64)/0x64};return console[_0x50ae6d(0x233)]('ðŸ“Š\x20Shop\x20'+_0x385007['username']+_0x50ae6d(0x1dc)),console['log'](_0x50ae6d(0x20a)+_0x2b1f3d[_0x50ae6d(0x1f7)]+_0x50ae6d(0x1f3)),console['log']('\x20\x20\x20ðŸ’°\x20Total\x20paid\x20out:\x20'+_0x2b1f3d['totalPaidOut']+_0x50ae6d(0x1a1)),console[_0x50ae6d(0x233)](_0x50ae6d(0x1dd)+_0x2b1f3d[_0x50ae6d(0x1c4)]+_0x50ae6d(0x1f3)),console[_0x50ae6d(0x233)](_0x50ae6d(0x243)+_0x2b1f3d[_0x50ae6d(0x240)]+_0x50ae6d(0x23b)),_0x2b1f3d;}[a77_0x584779(0x170)](_0x386b3a){const _0xfebf91=a77_0x584779,_0xc2151d={'test_gateway':'Test\x20Gateway','plisio':_0xfebf91(0x1f4),'rapyd':_0xfebf91(0x1e7),'noda':_0xfebf91(0x1c1),'cointopay':_0xfebf91(0x203),'klyme_eu':'KLYME\x20EU','klyme_gb':_0xfebf91(0x172),'klyme_de':_0xfebf91(0x1e0)};return _0xc2151d[_0x386b3a]||_0x386b3a;}async[a77_0x584779(0x21a)](_0x333dd2){return this['getShopPayoutStats'](_0x333dd2);}async[a77_0x584779(0x1ae)](_0x32a575,_0x1143eb){const _0x35d2fa=a77_0x584779,{page:_0x49e577,limit:_0xd493fb,paymentId:_0x1a19dc}=_0x1143eb,_0x4aa915=(_0x49e577-0x1)*_0xd493fb,_0x233454={'shopId':_0x32a575};_0x1a19dc&&(_0x233454[_0x35d2fa(0x182)]=_0x1a19dc);const [_0x887bba,_0x3c23db]=await Promise[_0x35d2fa(0x235)]([database_1[_0x35d2fa(0x1e6)][_0x35d2fa(0x214)][_0x35d2fa(0x1a2)]({'where':_0x233454,'skip':_0x4aa915,'take':_0xd493fb,'orderBy':{'createdAt':_0x35d2fa(0x1fa)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x35d2fa(0x1e6)][_0x35d2fa(0x214)][_0x35d2fa(0x174)]({'where':_0x233454})]);return{'logs':_0x887bba['map'](_0x19ec3a=>({'id':_0x19ec3a['id'],'paymentId':_0x19ec3a['paymentId'],'shopId':_0x19ec3a[_0x35d2fa(0x1c5)],'event':_0x19ec3a['event'],'statusCode':_0x19ec3a[_0x35d2fa(0x1f5)],'retryCount':_0x19ec3a[_0x35d2fa(0x222)],'responseBody':_0x19ec3a[_0x35d2fa(0x1a9)],'createdAt':_0x19ec3a[_0x35d2fa(0x1fd)],'payment':_0x19ec3a['payment']})),'pagination':{'page':_0x49e577,'limit':_0xd493fb,'total':_0x3c23db,'totalPages':Math[_0x35d2fa(0x176)](_0x3c23db/_0xd493fb)}};}async[a77_0x584779(0x24d)](_0x225a65,_0x45d0c1,_0x393449,_0x2b5363,_0x4b2e6c){const _0x375291=a77_0x584779;console[_0x375291(0x233)]('ðŸ“Š\x20Getting\x20statistics\x20for\x20shop\x20'+_0x225a65+_0x375291(0x216)+_0x45d0c1+',\x20dateFrom:\x20'+_0x393449+_0x375291(0x177)+_0x2b5363);const _0x1413f2=_0x4b2e6c?new Date(_0x4b2e6c):new Date();let _0x2d4532,_0x4a0687;if(_0x393449&&_0x2b5363){const _0x5a18eb=new Date(_0x393449),_0x1832f7=new Date(_0x2b5363);_0x2d4532=new Date(Date[_0x375291(0x207)](_0x5a18eb[_0x375291(0x22f)](),_0x5a18eb['getUTCMonth'](),_0x5a18eb[_0x375291(0x1c6)](),0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1832f7['getUTCFullYear'](),_0x1832f7[_0x375291(0x1b4)](),_0x1832f7['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x375291(0x233)]('ðŸ“…\x20Custom\x20date\x20range:\x20'+_0x2d4532['toISOString']()+_0x375291(0x1b5)+_0x4a0687['toISOString']());}else{if(_0x45d0c1&&_0x45d0c1[_0x375291(0x195)]('custom_')){const _0x1bcf33=_0x45d0c1[_0x375291(0x1c2)](_0x375291(0x24b),'')[_0x375291(0x239)]('_');if(_0x1bcf33['length']===0x2){const _0x33f4be=new Date(_0x1bcf33[0x0]),_0x139704=new Date(_0x1bcf33[0x1]);_0x2d4532=new Date(Date[_0x375291(0x207)](_0x33f4be[_0x375291(0x22f)](),_0x33f4be[_0x375291(0x1b4)](),_0x33f4be['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x139704[_0x375291(0x22f)](),_0x139704[_0x375291(0x1b4)](),_0x139704[_0x375291(0x1c6)](),0x17,0x3b,0x3b,0x3e7)),console[_0x375291(0x233)]('ðŸ“…\x20Custom\x20period:\x20'+_0x2d4532[_0x375291(0x1ff)]()+_0x375291(0x1b5)+_0x4a0687[_0x375291(0x1ff)]());}else{const _0x1b52ab=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2['getUTCMonth'](),_0x1413f2['getUTCDate']()-0x1e));_0x2d4532=new Date(Date[_0x375291(0x207)](_0x1b52ab[_0x375291(0x22f)](),_0x1b52ab[_0x375291(0x1b4)](),_0x1b52ab[_0x375291(0x1c6)](),0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2['getUTCMonth'](),_0x1413f2[_0x375291(0x1c6)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x45740c=_0x45d0c1||_0x375291(0x227);switch(_0x45740c[_0x375291(0x22d)]()){case _0x375291(0x1d6):_0x2d4532=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2[_0x375291(0x1b4)](),_0x1413f2[_0x375291(0x1c6)](),0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1413f2['getUTCFullYear'](),_0x1413f2['getUTCMonth'](),_0x1413f2['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x375291(0x1fc):const _0x5b8f71=new Date(_0x1413f2);_0x5b8f71[_0x375291(0x185)](_0x5b8f71['getUTCDate']()-0x1),_0x2d4532=new Date(Date[_0x375291(0x207)](_0x5b8f71[_0x375291(0x22f)](),_0x5b8f71[_0x375291(0x1b4)](),_0x5b8f71[_0x375291(0x1c6)](),0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x5b8f71[_0x375291(0x22f)](),_0x5b8f71[_0x375291(0x1b4)](),_0x5b8f71['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x375291(0x22a):const _0x4c79e3=_0x1413f2[_0x375291(0x242)](),_0x2588d0=_0x4c79e3===0x0?-0x6:0x1-_0x4c79e3,_0x5bf0d3=_0x1413f2[_0x375291(0x1c6)]()+_0x2588d0;_0x2d4532=new Date(Date['UTC'](_0x1413f2[_0x375291(0x22f)](),_0x1413f2[_0x375291(0x1b4)](),_0x5bf0d3,0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2['getUTCMonth'](),_0x1413f2[_0x375291(0x1c6)](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0x1d4e5f=new Date(Date[_0x375291(0x207)](_0x1413f2['getUTCFullYear'](),_0x1413f2[_0x375291(0x1b4)](),_0x1413f2[_0x375291(0x1c6)]()-0x7)),_0x59db0f=_0x1d4e5f[_0x375291(0x242)](),_0x3bf359=_0x59db0f===0x0?-0x6:0x1-_0x59db0f,_0x5f20f3=_0x1d4e5f[_0x375291(0x1c6)]()+_0x3bf359;_0x2d4532=new Date(Date[_0x375291(0x207)](_0x1d4e5f['getUTCFullYear'](),_0x1d4e5f[_0x375291(0x1b4)](),_0x5f20f3,0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1d4e5f['getUTCFullYear'](),_0x1d4e5f[_0x375291(0x1b4)](),_0x5f20f3+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x375291(0x227):_0x2d4532=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2[_0x375291(0x1b4)](),0x1,0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2[_0x375291(0x1b4)](),_0x1413f2[_0x375291(0x1c6)](),0x17,0x3b,0x3b,0x3e7));break;case _0x375291(0x1ad):_0x2d4532=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2[_0x375291(0x1b4)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date['UTC'](_0x1413f2['getUTCFullYear'](),_0x1413f2['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x2d4532=new Date(Date[_0x375291(0x207)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2['getUTCMonth'](),_0x1413f2[_0x375291(0x1c6)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x2d4532=new Date(Date[_0x375291(0x207)](_0x1413f2['getUTCFullYear'](),_0x1413f2['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x4a0687=new Date(Date[_0x375291(0x207)](_0x1413f2[_0x375291(0x22f)](),_0x1413f2[_0x375291(0x1b4)](),_0x1413f2['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}}console['log'](_0x375291(0x17b)+_0x2d4532[_0x375291(0x1ff)]()+'\x20to\x20'+_0x4a0687[_0x375291(0x1ff)]());const _0x5cb00c={'gte':_0x2d4532,'lte':_0x4a0687},[_0x7fa909,_0x599258,_0x4f5b78,_0x27b740,_0x25a80a,_0x113769,_0x375637,_0x515708,_0x5658e3,_0x4814e4]=await Promise['all']([database_1[_0x375291(0x1e6)][_0x375291(0x253)][_0x375291(0x174)]({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)},'status':{'notIn':[_0x375291(0x217),_0x375291(0x22e)]},'createdAt':_0x5cb00c}}),database_1['default'][_0x375291(0x253)][_0x375291(0x174)]({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)},'status':'PAID','createdAt':_0x5cb00c}}),database_1[_0x375291(0x1e6)][_0x375291(0x253)][_0x375291(0x174)]({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)},'status':_0x375291(0x1eb)}}),database_1[_0x375291(0x1e6)]['payment']['count']({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)},'status':'REFUND'}}),database_1[_0x375291(0x1e6)][_0x375291(0x253)][_0x375291(0x1a2)]({'where':{'shopId':_0x225a65,'gateway':{'not':'test_gateway'},'status':_0x375291(0x220),'createdAt':_0x5cb00c},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x375291(0x1e6)][_0x375291(0x253)][_0x375291(0x1a2)]({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default']['payment'][_0x375291(0x1a2)]({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)},'createdAt':_0x5cb00c},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x375291(0x218)}}),database_1['default']['payment'][_0x375291(0x174)]({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)},'status':'PAID'}}),database_1[_0x375291(0x1e6)][_0x375291(0x253)][_0x375291(0x1a2)]({'where':{'shopId':_0x225a65,'gateway':{'not':_0x375291(0x22b)},'status':_0x375291(0x220)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x375291(0x1e6)][_0x375291(0x23d)][_0x375291(0x1cb)]({'where':{'id':_0x225a65},'select':{'balance':!![]}})]);let _0x4d2873=0x0,_0x4eedb1=0x0;for(const _0x440c6a of _0x25a80a){if(_0x440c6a[_0x375291(0x16f)])_0x4d2873+=_0x440c6a[_0x375291(0x16f)];else{const _0x34ea65=await currencyService_1[_0x375291(0x206)]['convertToUSDT'](_0x440c6a['amount'],_0x440c6a[_0x375291(0x187)]);_0x4d2873+=_0x34ea65;}_0x440c6a[_0x375291(0x21b)]&&(_0x4eedb1+=_0x440c6a['amountAfterGatewayCommissionUSDT']);}let _0x277fd5=0x0;for(const _0x15058f of _0x5658e3){_0x15058f['amountAfterGatewayCommissionUSDT']&&(_0x277fd5+=_0x15058f[_0x375291(0x21b)]);}const _0x4b0f16=this[_0x375291(0x1cf)](_0x375637,_0x2d4532,_0x4a0687||_0x1413f2),_0x355b0e=_0x7fa909>0x0?_0x599258/_0x7fa909*0x64:0x0,_0x300852=_0x515708>0x0?_0x4f5b78/_0x515708*0x64:0x0;return{'totalPayments':_0x7fa909,'successfulPayments':_0x599258,'totalRevenue':Math[_0x375291(0x18b)](_0x4d2873*0x64)/0x64,'merchantEarnings':Math[_0x375291(0x18b)](_0x4eedb1*0x64)/0x64,'merchantTotalRevenue':Math[_0x375291(0x18b)](_0x277fd5*0x64)/0x64,'payoutBalance':Math['round']((_0x4814e4?.[_0x375291(0x1ba)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x375291(0x18b)](_0x355b0e*0x64)/0x64,'chargebackRate':Math[_0x375291(0x18b)](_0x300852*0x64)/0x64,'chargebacks':_0x4f5b78,'refunds':_0x27b740,'dailyRevenue':_0x4b0f16['dailyRevenue'],'dailyPayments':_0x4b0f16[_0x375291(0x241)],'recentPayments':_0x113769[_0x375291(0x1b1)](_0x331fe7=>({'id':_0x331fe7['id'],'gateway':_0x331fe7[_0x375291(0x238)],'amount':_0x331fe7[_0x375291(0x191)],'currency':_0x331fe7[_0x375291(0x187)],'status':_0x331fe7[_0x375291(0x1fe)],'createdAt':_0x331fe7[_0x375291(0x1fd)]}))};}[a77_0x584779(0x1cf)](_0xd24325,_0x257b29,_0x3d9fd1){const _0x5078ff=a77_0x584779,_0x358b37=new Map(),_0x16a08d=new Date(_0x257b29);while(_0x16a08d<=_0x3d9fd1){const _0x34f795=_0x16a08d[_0x5078ff(0x1ff)]()[_0x5078ff(0x239)]('T')[0x0];_0x358b37['set'](_0x34f795,{'revenue':0x0,'count':0x0}),_0x16a08d[_0x5078ff(0x1e9)](_0x16a08d['getDate']()+0x1);}for(const _0x1b1a83 of _0xd24325){const _0x1e4358=_0x1b1a83[_0x5078ff(0x1fd)][_0x5078ff(0x1ff)]()[_0x5078ff(0x239)]('T')[0x0],_0x2c86a7=_0x358b37['get'](_0x1e4358);_0x2c86a7&&(_0x2c86a7[_0x5078ff(0x174)]+=0x1,_0x1b1a83[_0x5078ff(0x1fe)]===_0x5078ff(0x220)&&_0x1b1a83['amountUSDT']&&(_0x2c86a7['revenue']+=_0x1b1a83['amountUSDT']));}const _0x5347c7=[],_0x206aef=[];for(const [_0x525e46,_0x25da93]of _0x358b37){_0x5347c7[_0x5078ff(0x188)]({'date':_0x525e46,'amount':Math[_0x5078ff(0x18b)](_0x25da93[_0x5078ff(0x1db)]*0x64)/0x64}),_0x206aef[_0x5078ff(0x188)]({'date':_0x525e46,'count':_0x25da93[_0x5078ff(0x174)]});}return{'dailyRevenue':_0x5347c7,'dailyPayments':_0x206aef};}[a77_0x584779(0x17a)](_0x3a1d55=0x8){const _0x4a8b03=a77_0x584779,_0x54cdbe=[];for(let _0x2e3deb=0x0;_0x2e3deb<_0x3a1d55;_0x2e3deb++){const _0x28f904=crypto_1[_0x4a8b03(0x1e6)][_0x4a8b03(0x251)](0x4)[_0x4a8b03(0x23e)](_0x4a8b03(0x19b))[_0x4a8b03(0x226)]();_0x54cdbe[_0x4a8b03(0x188)](_0x28f904);}return _0x54cdbe;}async[a77_0x584779(0x1b8)](_0x277b45){const _0x75f638=a77_0x584779,_0x11b056=await database_1[_0x75f638(0x1e6)][_0x75f638(0x23d)][_0x75f638(0x1cb)]({'where':{'id':_0x277b45},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x11b056)throw new Error('Shop\x20not\x20found');const _0x3202a0=speakeasy_1[_0x75f638(0x1e6)]['generateSecret']({'name':_0x75f638(0x1de)+_0x11b056['username']+')','issuer':_0x75f638(0x1d7),'length':0x20}),_0x11f7ff=await qrcode_1[_0x75f638(0x1e6)]['toDataURL'](_0x3202a0[_0x75f638(0x1b9)]),_0x23028c=this[_0x75f638(0x17a)](0x8),_0x4ab63=await Promise[_0x75f638(0x235)](_0x23028c[_0x75f638(0x1b1)](_0x1e5627=>bcryptjs_1[_0x75f638(0x1e6)][_0x75f638(0x1a0)](_0x1e5627,0xa)));return await database_1[_0x75f638(0x1e6)]['shop'][_0x75f638(0x194)]({'where':{'id':_0x277b45},'data':{'twoFactorSecret':_0x3202a0[_0x75f638(0x1b7)],'backupCodes':JSON['stringify'](_0x4ab63)}}),console[_0x75f638(0x233)](_0x75f638(0x1b6)+_0x11b056[_0x75f638(0x1a5)]),console[_0x75f638(0x233)](_0x75f638(0x23a)+_0x23028c['length']+'\x20backup\x20codes'),{'secret':_0x3202a0[_0x75f638(0x1b7)],'qrCode':_0x11f7ff,'manualEntryKey':_0x3202a0[_0x75f638(0x1b7)],'backupCodes':_0x23028c};}async[a77_0x584779(0x17c)](_0xd9b95,_0x4dbe07){const _0x4ada03=a77_0x584779,_0x4e4f52=await database_1[_0x4ada03(0x1e6)][_0x4ada03(0x23d)][_0x4ada03(0x1cb)]({'where':{'id':_0xd9b95},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x4e4f52)throw new Error('Shop\x20not\x20found');if(!_0x4e4f52[_0x4ada03(0x1d4)])throw new Error(_0x4ada03(0x244));if(_0x4e4f52[_0x4ada03(0x247)])throw new Error(_0x4ada03(0x1c3));const _0x88a5e8=speakeasy_1[_0x4ada03(0x1e6)][_0x4ada03(0x189)][_0x4ada03(0x221)]({'secret':_0x4e4f52[_0x4ada03(0x1d4)],'encoding':_0x4ada03(0x1b7),'token':_0x4dbe07,'window':0x2});if(!_0x88a5e8)throw new Error(_0x4ada03(0x19e));return await database_1[_0x4ada03(0x1e6)][_0x4ada03(0x23d)][_0x4ada03(0x194)]({'where':{'id':_0xd9b95},'data':{'twoFactorEnabled':!![]}}),console[_0x4ada03(0x233)](_0x4ada03(0x190)+_0x4e4f52[_0x4ada03(0x1a5)]),{'enabled':!![]};}async[a77_0x584779(0x1f9)](_0x338c4c){const _0x54a47b=a77_0x584779,_0x3dedbc=await database_1[_0x54a47b(0x1e6)][_0x54a47b(0x23d)][_0x54a47b(0x1cb)]({'where':{'id':_0x338c4c},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x3dedbc)throw new Error(_0x54a47b(0x248));await database_1['default'][_0x54a47b(0x23d)][_0x54a47b(0x194)]({'where':{'id':_0x338c4c},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x54a47b(0x233)](_0x54a47b(0x230)+_0x3dedbc[_0x54a47b(0x1a5)]);}}exports[a77_0x584779(0x178)]=ShopService;