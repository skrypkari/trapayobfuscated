'use strict';const a54_0x3540c4=a54_0x33a2;(function(_0x462240,_0x3dde2c){const _0x46a525=a54_0x33a2,_0x1f3502=_0x462240();while(!![]){try{const _0x3678c1=parseInt(_0x46a525(0x1b7))/0x1*(parseInt(_0x46a525(0x1ce))/0x2)+-parseInt(_0x46a525(0x1dd))/0x3+-parseInt(_0x46a525(0x1ee))/0x4*(-parseInt(_0x46a525(0x1bf))/0x5)+-parseInt(_0x46a525(0x1e1))/0x6*(parseInt(_0x46a525(0x1e8))/0x7)+parseInt(_0x46a525(0x181))/0x8+parseInt(_0x46a525(0x18a))/0x9+-parseInt(_0x46a525(0x1a8))/0xa;if(_0x3678c1===_0x3dde2c)break;else _0x1f3502['push'](_0x1f3502['shift']());}catch(_0x5e086b){_0x1f3502['push'](_0x1f3502['shift']());}}}(a54_0x33a8,0x42087));function a54_0x33a2(_0x4ce188,_0x19c088){const _0x33a89b=a54_0x33a8();return a54_0x33a2=function(_0x33a2d6,_0x3eff1d){_0x33a2d6=_0x33a2d6-0x15a;let _0x18dd2f=_0x33a89b[_0x33a2d6];return _0x18dd2f;},a54_0x33a2(_0x4ce188,_0x19c088);}var __importDefault=this&&this[a54_0x3540c4(0x1d3)]||function(_0xa57e9){const _0x3eb515=a54_0x3540c4;return _0xa57e9&&_0xa57e9[_0x3eb515(0x1bc)]?_0xa57e9:{'default':_0xa57e9};};Object[a54_0x3540c4(0x1d9)](exports,a54_0x3540c4(0x1bc),{'value':!![]}),exports[a54_0x3540c4(0x1e2)]=void 0x0;const database_1=__importDefault(require(a54_0x3540c4(0x191))),currencyService_1=require(a54_0x3540c4(0x19a)),paymentService_1=require('./paymentService');function a54_0x33a8(){const _0x5453f8=['üìä\x20Shop\x20','COMPLETED','findFirst','../config/database','amountUSDT','totalPaidOut','split','error','üìÖ\x20Period\x20end:\x20','maxPayments','paymentGateways','KLYME\x20GB','./currencyService','count','\x20\x20\x20üíµ\x20Available\x20balance:\x20','USDT\x20TRC20','telegram','Failed\x20to\x20send\x20webhook:\x20','test_order_123','90d','stringify','TesSoft\x20Payment\x20System/1.0\x20(Test)','üí∞\x20Getting\x20payouts\x20with\x20filters:','parse','getPayoutStatistics','trc20','3711640xGNHHU','payment','getTime','createPayment','paymentService','thisMonth','getFullYear','fullName','shop','status','toUpperCase','createdAt','üìÖ\x20Date\x20start:\x20','telegramId','Error\x20parsing\x20webhook\x20events:','134SUsohB','name','webhookEvents','map','default','__esModule','isArray','REJECTED','620hFHyFE','getShopProfile','generateDailyStatistics','Plisio','wallets','KLYME\x20DE','üìÖ\x20Date\x20end:\x20','publicKey','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','statusText','merchantUrl','getMonth','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','üìä\x20Status\x20filter:\x20','\x20USDT\x20(total\x20payouts)','4754vwOLEh','webhookUrl','usdcPolygonWallet','expiresAt','test_payment_123','__importDefault','deletePayment','get','set','update','round','defineProperty','test_gateway','...','convertToUSDT','1425168uQbQbF','Shop\x20not\x20found','customer','getShopPayoutStats','276dvfTda','ShopService','testWebhook','reduce','\x20USDT','desc','lte','16198XGBcoQ','formatNetworkName','payout','statusCode','USD','settings','6244YIGoAR','getPayoutStats','getPayments','Webhook\x20returned\x20error:\x20','usdtPolygonWallet','getDate','currencyService','updatePayment','log','balance','shopUrl','USDC\x20Polygon','getPaymentById','usdtTrcWallet','POST','usdtErcWallet','delete','toISOString','USDT\x20BSC','erc20','Rapyd','Test\x20webhook\x20sent\x20successfully\x20(','awaitingPayout','\x20payout\x20statistics\x20calculated:','Payment\x20not\x20found','test','polygon_usdc','network','paymentId','application/json','üåê\x20Method\x20filter:\x20','currency','setHours','USDT\x20Polygon','gte','customerEmail','availableBalance','paidAt','No\x20webhook\x20URL\x20configured','all','findUnique','\x20\x20\x20üìÖ\x20This\x20month:\x20','PENDING','asc','Noda','periodFrom','txid','updateWallets','redirectUrl','getStatistics','gateways','Test\x20Gateway','aggregate','findMany','3804352bBTxHP','amount','gateway','revenue','filter','push','PAID','message','_sum','2119581zYStjw','ceil','gatewaySettings','country'];a54_0x33a8=function(){return _0x5453f8;};return a54_0x33a8();}class ShopService{constructor(){this['paymentService']=new paymentService_1['PaymentService']();}async[a54_0x3540c4(0x1c0)](_0xed2baf){const _0x740fa5=a54_0x3540c4,_0x56a271=await database_1[_0x740fa5(0x1bb)]['shop'][_0x740fa5(0x173)]({'where':{'id':_0xed2baf},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x56a271)throw new Error(_0x740fa5(0x1de));let _0x1098a1=[];if(_0x56a271[_0x740fa5(0x1ed)]?.[_0x740fa5(0x1b9)])try{_0x1098a1=Array[_0x740fa5(0x1bd)](_0x56a271['settings'][_0x740fa5(0x1b9)])?_0x56a271[_0x740fa5(0x1ed)][_0x740fa5(0x1b9)]:JSON[_0x740fa5(0x1a5)](_0x56a271[_0x740fa5(0x1ed)][_0x740fa5(0x1b9)]);}catch(_0x27ae5b){console['error'](_0x740fa5(0x1b6),_0x27ae5b),_0x1098a1=[];}return{'id':_0x56a271['id'],'fullName':_0x56a271[_0x740fa5(0x1b8)],'username':_0x56a271['username'],'telegramId':_0x56a271[_0x740fa5(0x19e)],'merchantUrl':_0x56a271['shopUrl'],'gateways':_0x56a271['paymentGateways']?JSON[_0x740fa5(0x1a5)](_0x56a271['paymentGateways']):null,'gatewaySettings':_0x56a271[_0x740fa5(0x18c)]?JSON[_0x740fa5(0x1a5)](_0x56a271[_0x740fa5(0x18c)]):null,'publicKey':_0x56a271[_0x740fa5(0x1c6)],'webhookUrl':_0x56a271['settings']?.['webhookUrl']||null,'webhookEvents':_0x1098a1,'wallets':{'usdtPolygonWallet':_0x56a271[_0x740fa5(0x1f2)],'usdtTrcWallet':_0x56a271[_0x740fa5(0x1fb)],'usdtErcWallet':_0x56a271['usdtErcWallet'],'usdcPolygonWallet':_0x56a271[_0x740fa5(0x1d0)]},'status':_0x56a271[_0x740fa5(0x1b1)],'createdAt':_0x56a271[_0x740fa5(0x1b3)]};}async['updateShopProfile'](_0x4ccf77,_0x3cff9b){const _0x2f5fff=a54_0x3540c4,_0x225e21={};_0x3cff9b[_0x2f5fff(0x1af)]&&(_0x225e21['name']=_0x3cff9b['fullName']);_0x3cff9b[_0x2f5fff(0x1b5)]!==undefined&&(_0x225e21[_0x2f5fff(0x19e)]=_0x3cff9b['telegramId']||null);_0x3cff9b[_0x2f5fff(0x1c9)]&&(_0x225e21[_0x2f5fff(0x1f8)]=_0x3cff9b[_0x2f5fff(0x1c9)]);_0x3cff9b[_0x2f5fff(0x17d)]&&(_0x225e21['paymentGateways']=JSON[_0x2f5fff(0x1a2)](_0x3cff9b[_0x2f5fff(0x17d)]));_0x3cff9b[_0x2f5fff(0x18c)]&&(_0x225e21[_0x2f5fff(0x18c)]=JSON['stringify'](_0x3cff9b['gatewaySettings']));_0x3cff9b[_0x2f5fff(0x1c3)]&&(_0x3cff9b[_0x2f5fff(0x1c3)][_0x2f5fff(0x1f2)]!==undefined&&(_0x225e21['usdtPolygonWallet']=_0x3cff9b[_0x2f5fff(0x1c3)][_0x2f5fff(0x1f2)]||null),_0x3cff9b[_0x2f5fff(0x1c3)][_0x2f5fff(0x1fb)]!==undefined&&(_0x225e21[_0x2f5fff(0x1fb)]=_0x3cff9b['wallets'][_0x2f5fff(0x1fb)]||null),_0x3cff9b[_0x2f5fff(0x1c3)][_0x2f5fff(0x15a)]!==undefined&&(_0x225e21[_0x2f5fff(0x15a)]=_0x3cff9b[_0x2f5fff(0x1c3)][_0x2f5fff(0x15a)]||null),_0x3cff9b[_0x2f5fff(0x1c3)]['usdcPolygonWallet']!==undefined&&(_0x225e21[_0x2f5fff(0x1d0)]=_0x3cff9b[_0x2f5fff(0x1c3)][_0x2f5fff(0x1d0)]||null));const _0x8d6ae7=await database_1[_0x2f5fff(0x1bb)][_0x2f5fff(0x1b0)][_0x2f5fff(0x1d7)]({'where':{'id':_0x4ccf77},'data':_0x225e21,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x1ad5cf=[];if(_0x8d6ae7[_0x2f5fff(0x1ed)]?.[_0x2f5fff(0x1b9)])try{_0x1ad5cf=Array[_0x2f5fff(0x1bd)](_0x8d6ae7[_0x2f5fff(0x1ed)][_0x2f5fff(0x1b9)])?_0x8d6ae7['settings'][_0x2f5fff(0x1b9)]:JSON[_0x2f5fff(0x1a5)](_0x8d6ae7['settings'][_0x2f5fff(0x1b9)]);}catch(_0x345c14){console[_0x2f5fff(0x195)](_0x2f5fff(0x1b6),_0x345c14),_0x1ad5cf=[];}return{'id':_0x8d6ae7['id'],'fullName':_0x8d6ae7[_0x2f5fff(0x1b8)],'username':_0x8d6ae7['username'],'telegramId':_0x8d6ae7[_0x2f5fff(0x19e)],'merchantUrl':_0x8d6ae7['shopUrl'],'gateways':_0x8d6ae7[_0x2f5fff(0x198)]?JSON[_0x2f5fff(0x1a5)](_0x8d6ae7['paymentGateways']):null,'gatewaySettings':_0x8d6ae7[_0x2f5fff(0x18c)]?JSON[_0x2f5fff(0x1a5)](_0x8d6ae7['gatewaySettings']):null,'publicKey':_0x8d6ae7[_0x2f5fff(0x1c6)],'webhookUrl':_0x8d6ae7[_0x2f5fff(0x1ed)]?.[_0x2f5fff(0x1cf)]||null,'webhookEvents':_0x1ad5cf,'wallets':{'usdtPolygonWallet':_0x8d6ae7['usdtPolygonWallet'],'usdtTrcWallet':_0x8d6ae7['usdtTrcWallet'],'usdtErcWallet':_0x8d6ae7[_0x2f5fff(0x15a)],'usdcPolygonWallet':_0x8d6ae7[_0x2f5fff(0x1d0)]},'status':_0x8d6ae7[_0x2f5fff(0x1b1)],'createdAt':_0x8d6ae7[_0x2f5fff(0x1b3)]};}async[a54_0x3540c4(0x17a)](_0x4627b3,_0x4ee458){const _0x41254c=a54_0x3540c4,_0x72e009={};_0x4ee458[_0x41254c(0x1f2)]!==undefined&&(_0x72e009[_0x41254c(0x1f2)]=_0x4ee458[_0x41254c(0x1f2)]||null),_0x4ee458[_0x41254c(0x1fb)]!==undefined&&(_0x72e009[_0x41254c(0x1fb)]=_0x4ee458[_0x41254c(0x1fb)]||null),_0x4ee458[_0x41254c(0x15a)]!==undefined&&(_0x72e009['usdtErcWallet']=_0x4ee458['usdtErcWallet']||null),_0x4ee458['usdcPolygonWallet']!==undefined&&(_0x72e009['usdcPolygonWallet']=_0x4ee458['usdcPolygonWallet']||null),await database_1[_0x41254c(0x1bb)][_0x41254c(0x1b0)][_0x41254c(0x1d7)]({'where':{'id':_0x4627b3},'data':_0x72e009});}async[a54_0x3540c4(0x1e3)](_0x2de5d0){const _0xee8343=a54_0x3540c4,_0x511310=await database_1['default'][_0xee8343(0x1b0)][_0xee8343(0x173)]({'where':{'id':_0x2de5d0},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x511310?.[_0xee8343(0x1ed)]?.[_0xee8343(0x1cf)])throw new Error(_0xee8343(0x171));const _0xcd0080={'event':_0xee8343(0x164),'payment':{'id':_0xee8343(0x1d2),'order_id':_0xee8343(0x1a0),'gateway':_0xee8343(0x164),'amount':0x64,'currency':_0xee8343(0x1ec),'status':'paid','created_at':new Date()[_0xee8343(0x15c)]()}};try{const _0x1d39d9=await fetch(_0x511310[_0xee8343(0x1ed)][_0xee8343(0x1cf)],{'method':_0xee8343(0x1fc),'headers':{'Content-Type':_0xee8343(0x168),'User-Agent':_0xee8343(0x1a3)},'body':JSON[_0xee8343(0x1a2)](_0xcd0080)});return _0x1d39d9['ok']?{'success':!![],'message':_0xee8343(0x160)+_0x1d39d9[_0xee8343(0x1b1)]+')'}:{'success':![],'message':_0xee8343(0x1f1)+_0x1d39d9[_0xee8343(0x1b1)]+'\x20'+_0x1d39d9[_0xee8343(0x1c8)]};}catch(_0x338f9b){return{'success':![],'message':_0xee8343(0x19f)+(_0x338f9b instanceof Error?_0x338f9b[_0xee8343(0x188)]:'Unknown\x20error')};}}async[a54_0x3540c4(0x1ab)](_0x31bd9e){const _0x2583a4=a54_0x3540c4;return this[_0x2583a4(0x1ac)]['createPublicPayment']({'public_key':'','gateway':_0x31bd9e[_0x2583a4(0x183)],'order_id':undefined,'amount':_0x31bd9e[_0x2583a4(0x182)],'currency':_0x31bd9e[_0x2583a4(0x16a)],'source_currency':_0x31bd9e['sourceCurrency'],'usage':_0x31bd9e['usage'],'expires_at':_0x31bd9e[_0x2583a4(0x1d1)]?.[_0x2583a4(0x15c)](),'success_url':_0x31bd9e[_0x2583a4(0x17b)],'fail_url':_0x31bd9e['redirectUrl'],'customer_email':_0x31bd9e[_0x2583a4(0x16e)],'customer_name':_0x31bd9e['customerName'],'country':_0x31bd9e[_0x2583a4(0x18d)],'language':_0x31bd9e['language'],'amount_is_editable':_0x31bd9e['amountIsEditable'],'max_payments':_0x31bd9e[_0x2583a4(0x197)],'customer':_0x31bd9e[_0x2583a4(0x1df)]});}async[a54_0x3540c4(0x1f0)](_0x3c2517,_0x2e3582){return this['paymentService']['getPaymentsByShop'](_0x3c2517,_0x2e3582);}async[a54_0x3540c4(0x1fa)](_0x35e6a8,_0x28e80e){const _0x1aba86=a54_0x3540c4;return this[_0x1aba86(0x1ac)]['getPaymentByShopAndId'](_0x35e6a8,_0x28e80e);}async[a54_0x3540c4(0x1f5)](_0x204e9e,_0x428601,_0x20236e){const _0x385e99=a54_0x3540c4,_0x3726d6=await database_1[_0x385e99(0x1bb)][_0x385e99(0x1a9)][_0x385e99(0x190)]({'where':{'id':_0x428601,'shopId':_0x204e9e}});if(!_0x3726d6)throw new Error(_0x385e99(0x163));const _0x5d56e6=await database_1[_0x385e99(0x1bb)][_0x385e99(0x1a9)][_0x385e99(0x1d7)]({'where':{'id':_0x428601},'data':{..._0x20236e,'updatedAt':new Date()}});return _0x5d56e6;}async[a54_0x3540c4(0x1d4)](_0x2e95c7,_0x115d53){const _0x30cd3a=a54_0x3540c4,_0x3853ad=await database_1[_0x30cd3a(0x1bb)]['payment']['findFirst']({'where':{'id':_0x115d53,'shopId':_0x2e95c7}});if(!_0x3853ad)throw new Error(_0x30cd3a(0x163));await database_1[_0x30cd3a(0x1bb)][_0x30cd3a(0x1a9)][_0x30cd3a(0x15b)]({'where':{'id':_0x115d53}});}[a54_0x3540c4(0x1e9)](_0x132f0b){const _0x11d14b=a54_0x3540c4,_0x4e6ae6={'polygon':_0x11d14b(0x16c),'trc20':_0x11d14b(0x19d),'erc20':'USDT\x20ERC20','bsc':_0x11d14b(0x15d),'polygon_usdc':_0x11d14b(0x1f9)};return _0x4e6ae6[_0x132f0b]||_0x132f0b;}async['getPayouts'](_0x173123,_0x24248e){const _0x17dd48=a54_0x3540c4,{page:_0x1d8761,limit:_0x5a1807,status:_0x28c740,method:_0x35ae6b,network:_0x34f8d7,dateFrom:_0x30079f,dateTo:_0x2e428c,periodFrom:_0x2d1ca5,periodTo:_0x239172}=_0x24248e,_0xf9e9be=(_0x1d8761-0x1)*_0x5a1807;console[_0x17dd48(0x1f6)](_0x17dd48(0x1a4),_0x24248e);const _0x4b5bad={'shopId':_0x173123};_0x28c740&&(_0x4b5bad[_0x17dd48(0x1b1)]=_0x28c740[_0x17dd48(0x1b2)](),console[_0x17dd48(0x1f6)](_0x17dd48(0x1cc)+_0x28c740[_0x17dd48(0x1b2)]()));if(_0x35ae6b)_0x4b5bad[_0x17dd48(0x166)]=_0x35ae6b,console[_0x17dd48(0x1f6)](_0x17dd48(0x169)+_0x35ae6b);else _0x34f8d7&&(_0x4b5bad[_0x17dd48(0x166)]=_0x34f8d7,console['log']('üåê\x20Network\x20filter:\x20'+_0x34f8d7));if(_0x30079f||_0x2e428c||_0x2d1ca5||_0x239172){_0x4b5bad[_0x17dd48(0x1b3)]={};if(_0x2d1ca5){const _0xa27e8d=new Date(_0x2d1ca5);_0xa27e8d[_0x17dd48(0x16b)](0x0,0x0,0x0,0x0),_0x4b5bad['createdAt']['gte']=_0xa27e8d,console[_0x17dd48(0x1f6)]('üìÖ\x20Period\x20start:\x20'+_0xa27e8d[_0x17dd48(0x15c)]());}else{if(_0x30079f){const _0x22a2b6=new Date(_0x30079f);_0x22a2b6[_0x17dd48(0x16b)](0x0,0x0,0x0,0x0),_0x4b5bad[_0x17dd48(0x1b3)][_0x17dd48(0x16d)]=_0x22a2b6,console[_0x17dd48(0x1f6)](_0x17dd48(0x1b4)+_0x22a2b6[_0x17dd48(0x15c)]());}}if(_0x239172){const _0x3d2709=new Date(_0x239172);_0x3d2709[_0x17dd48(0x16b)](0x17,0x3b,0x3b,0x3e7),_0x4b5bad[_0x17dd48(0x1b3)][_0x17dd48(0x1e7)]=_0x3d2709,console[_0x17dd48(0x1f6)](_0x17dd48(0x196)+_0x3d2709['toISOString']());}else{if(_0x2e428c){const _0x41d5a0=new Date(_0x2e428c);_0x41d5a0[_0x17dd48(0x16b)](0x17,0x3b,0x3b,0x3e7),_0x4b5bad['createdAt'][_0x17dd48(0x1e7)]=_0x41d5a0,console[_0x17dd48(0x1f6)](_0x17dd48(0x1c5)+_0x41d5a0[_0x17dd48(0x15c)]());}}}console[_0x17dd48(0x1f6)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x17dd48(0x1a2)](_0x4b5bad,null,0x2));const [_0x3e47bc,_0x336d5e]=await Promise['all']([database_1[_0x17dd48(0x1bb)][_0x17dd48(0x1ea)][_0x17dd48(0x180)]({'where':_0x4b5bad,'skip':_0xf9e9be,'take':_0x5a1807,'orderBy':{'createdAt':_0x17dd48(0x1e6)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x17dd48(0x1ea)]['count']({'where':_0x4b5bad})]);return{'payouts':_0x3e47bc['map'](_0x236bb0=>{const _0x35e405=_0x17dd48;let _0x1a4e6c=null;switch(_0x236bb0[_0x35e405(0x166)]){case'polygon':_0x1a4e6c=_0x236bb0[_0x35e405(0x1b0)][_0x35e405(0x1f2)];break;case _0x35e405(0x1a7):_0x1a4e6c=_0x236bb0[_0x35e405(0x1b0)][_0x35e405(0x1fb)];break;case _0x35e405(0x15e):_0x1a4e6c=_0x236bb0['shop']['usdtErcWallet'];break;case _0x35e405(0x165):_0x1a4e6c=_0x236bb0['shop'][_0x35e405(0x1d0)];break;}return{'id':_0x236bb0['id'],'amount':_0x236bb0[_0x35e405(0x182)],'network':this[_0x35e405(0x1e9)](_0x236bb0[_0x35e405(0x166)]),'wallet':_0x1a4e6c,'status':_0x236bb0[_0x35e405(0x1b1)],'txid':_0x236bb0[_0x35e405(0x179)],'notes':_0x236bb0['notes'],'periodFrom':_0x236bb0[_0x35e405(0x178)],'periodTo':_0x236bb0['periodTo'],'createdAt':_0x236bb0[_0x35e405(0x1b3)],'paidAt':_0x236bb0[_0x35e405(0x170)]};}),'pagination':{'page':_0x1d8761,'limit':_0x5a1807,'total':_0x336d5e,'totalPages':Math[_0x17dd48(0x18b)](_0x336d5e/_0x5a1807)}};}async['getPayoutById'](_0x465e56,_0xc50f11){const _0x51ca1f=a54_0x3540c4,_0x2a8974=await database_1[_0x51ca1f(0x1bb)][_0x51ca1f(0x1ea)][_0x51ca1f(0x190)]({'where':{'id':_0xc50f11,'shopId':_0x465e56}});if(!_0x2a8974)return null;return{'id':_0x2a8974['id'],'amount':_0x2a8974[_0x51ca1f(0x182)],'network':_0x2a8974['network'],'status':_0x2a8974[_0x51ca1f(0x1b1)],'txid':_0x2a8974['txid'],'notes':_0x2a8974['notes'],'createdAt':_0x2a8974[_0x51ca1f(0x1b3)],'paidAt':_0x2a8974[_0x51ca1f(0x170)]};}async[a54_0x3540c4(0x1a6)](_0x436fd8,_0xc599cc){const _0x4d21eb=a54_0x3540c4,_0x446ce8=new Date();let _0x4eee88;switch(_0xc599cc){case'7d':_0x4eee88=new Date(_0x446ce8['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4eee88=new Date(_0x446ce8[_0x4d21eb(0x1aa)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4d21eb(0x1a1):_0x4eee88=new Date(_0x446ce8[_0x4d21eb(0x1aa)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4eee88=new Date(_0x446ce8[_0x4d21eb(0x1aa)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5bd211,_0x2ddccb,_0x3c5d74,_0x8b609,_0x2cb108,_0x592803]=await Promise[_0x4d21eb(0x172)]([database_1[_0x4d21eb(0x1bb)][_0x4d21eb(0x1ea)][_0x4d21eb(0x19b)]({'where':{'shopId':_0x436fd8,'createdAt':{'gte':_0x4eee88}}}),database_1['default'][_0x4d21eb(0x1ea)]['count']({'where':{'shopId':_0x436fd8,'status':_0x4d21eb(0x18f),'createdAt':{'gte':_0x4eee88}}}),database_1[_0x4d21eb(0x1bb)][_0x4d21eb(0x1ea)][_0x4d21eb(0x19b)]({'where':{'shopId':_0x436fd8,'status':'PENDING','createdAt':{'gte':_0x4eee88}}}),database_1[_0x4d21eb(0x1bb)]['payout']['count']({'where':{'shopId':_0x436fd8,'status':_0x4d21eb(0x1be),'createdAt':{'gte':_0x4eee88}}}),database_1[_0x4d21eb(0x1bb)][_0x4d21eb(0x1ea)]['findMany']({'where':{'shopId':_0x436fd8,'createdAt':{'gte':_0x4eee88}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x4d21eb(0x1bb)]['payout']['findMany']({'where':{'shopId':_0x436fd8},'take':0xa,'orderBy':{'createdAt':_0x4d21eb(0x1e6)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3252e8=_0x2cb108[_0x4d21eb(0x1e4)]((_0x20d76f,_0x56470c)=>_0x20d76f+_0x56470c['amount'],0x0),_0x282083=_0x2cb108[_0x4d21eb(0x185)](_0xfd24a9=>_0xfd24a9['status']===_0x4d21eb(0x18f))['reduce']((_0x2a4d82,_0x3c7a5e)=>_0x2a4d82+_0x3c7a5e['amount'],0x0),_0x1de8cb=_0x2cb108['filter'](_0x41a7cf=>_0x41a7cf['status']===_0x4d21eb(0x175))['reduce']((_0x3c5d7e,_0x355ccb)=>_0x3c5d7e+_0x355ccb[_0x4d21eb(0x182)],0x0),_0x59046d=_0x2cb108[_0x4d21eb(0x1e4)]((_0x14d1fe,_0x3f917e)=>{const _0x6bf75e=_0x4d21eb;return _0x14d1fe[_0x3f917e[_0x6bf75e(0x166)]]=(_0x14d1fe[_0x3f917e[_0x6bf75e(0x166)]]||0x0)+0x1,_0x14d1fe;},{}),_0x4de8b5=_0x2cb108['reduce']((_0x256ecd,_0x29d351)=>{const _0x370e31=_0x4d21eb;return _0x256ecd[_0x29d351['status']]=(_0x256ecd[_0x29d351[_0x370e31(0x1b1)]]||0x0)+0x1,_0x256ecd;},{});return{'totalPayouts':_0x5bd211,'completedPayouts':_0x2ddccb,'pendingPayouts':_0x3c5d74,'rejectedPayouts':_0x8b609,'totalAmount':_0x3252e8,'completedAmount':_0x282083,'pendingAmount':_0x1de8cb,'payoutsByMethod':_0x59046d,'payoutsByStatus':_0x4de8b5,'recentPayouts':_0x592803[_0x4d21eb(0x1ba)](_0x10096b=>({'id':_0x10096b['id'],'shopId':_0x436fd8,'amount':_0x10096b[_0x4d21eb(0x182)],'method':_0x10096b[_0x4d21eb(0x166)],'status':_0x10096b['status'],'txid':_0x10096b[_0x4d21eb(0x179)],'createdAt':_0x10096b[_0x4d21eb(0x1b3)],'paidAt':_0x10096b[_0x4d21eb(0x170)]}))};}async[a54_0x3540c4(0x1e0)](_0x2b78c8){const _0x568a53=a54_0x3540c4;console['log'](_0x568a53(0x1c7)+_0x2b78c8+_0x568a53(0x1db));const _0x1b1170=await database_1[_0x568a53(0x1bb)][_0x568a53(0x1b0)][_0x568a53(0x173)]({'where':{'id':_0x2b78c8},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1b1170)throw new Error('Shop\x20not\x20found');const _0x529806=new Date(),_0x4fe1e=new Date(_0x529806[_0x568a53(0x1ae)](),_0x529806[_0x568a53(0x1ca)](),0x1),_0x5286b9=new Date(_0x529806[_0x568a53(0x1ae)](),_0x529806[_0x568a53(0x1ca)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1742b0=await database_1[_0x568a53(0x1bb)][_0x568a53(0x1ea)][_0x568a53(0x17f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2b78c8,'createdAt':{'gte':_0x4fe1e,'lte':_0x5286b9},'status':'COMPLETED'}}),_0x19142e=_0x1742b0[_0x568a53(0x189)][_0x568a53(0x182)]||0x0,_0x3893b2={'availableBalance':Math[_0x568a53(0x1d8)](_0x1b1170[_0x568a53(0x1f7)]*0x64)/0x64,'totalPaidOut':Math[_0x568a53(0x1d8)](_0x1b1170[_0x568a53(0x193)]*0x64)/0x64,'awaitingPayout':Math[_0x568a53(0x1d8)](_0x1b1170[_0x568a53(0x1f7)]*0x64)/0x64,'thisMonth':Math['round'](_0x19142e*0x64)/0x64};return console[_0x568a53(0x1f6)](_0x568a53(0x18e)+_0x1b1170['username']+_0x568a53(0x162)),console[_0x568a53(0x1f6)](_0x568a53(0x19c)+_0x3893b2[_0x568a53(0x16f)]+'\x20USDT\x20(current\x20balance)'),console['log'](_0x568a53(0x1cb)+_0x3893b2[_0x568a53(0x193)]+_0x568a53(0x1cd)),console[_0x568a53(0x1f6)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x3893b2[_0x568a53(0x161)]+'\x20USDT\x20(current\x20balance)'),console[_0x568a53(0x1f6)](_0x568a53(0x174)+_0x3893b2[_0x568a53(0x1ad)]+_0x568a53(0x1e5)),_0x3893b2;}['getGatewayDisplayName'](_0x3f52a2){const _0x2cb025=a54_0x3540c4,_0x36f246={'test_gateway':_0x2cb025(0x17e),'plisio':_0x2cb025(0x1c2),'rapyd':_0x2cb025(0x15f),'noda':_0x2cb025(0x177),'cointopay':'CoinToPay','klyme_eu':'KLYME\x20EU','klyme_gb':_0x2cb025(0x199),'klyme_de':_0x2cb025(0x1c4)};return _0x36f246[_0x3f52a2]||_0x3f52a2;}async[a54_0x3540c4(0x1ef)](_0x41eac2){return this['getShopPayoutStats'](_0x41eac2);}async['getWebhookLogs'](_0xdf6ad2,_0x177757){const _0x2195dd=a54_0x3540c4,{page:_0x541d58,limit:_0x2dd7d6,paymentId:_0x5bf249}=_0x177757,_0xb69184=(_0x541d58-0x1)*_0x2dd7d6,_0x2957c0={'shopId':_0xdf6ad2};_0x5bf249&&(_0x2957c0['paymentId']=_0x5bf249);const [_0x3afba1,_0x3957e7]=await Promise[_0x2195dd(0x172)]([database_1[_0x2195dd(0x1bb)]['webhookLog'][_0x2195dd(0x180)]({'where':_0x2957c0,'skip':_0xb69184,'take':_0x2dd7d6,'orderBy':{'createdAt':_0x2195dd(0x1e6)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2195dd(0x1bb)]['webhookLog'][_0x2195dd(0x19b)]({'where':_0x2957c0})]);return{'logs':_0x3afba1['map'](_0x296014=>({'id':_0x296014['id'],'paymentId':_0x296014[_0x2195dd(0x167)],'shopId':_0x296014['shopId'],'event':_0x296014['event'],'statusCode':_0x296014[_0x2195dd(0x1eb)],'retryCount':_0x296014['retryCount'],'responseBody':_0x296014['responseBody'],'createdAt':_0x296014[_0x2195dd(0x1b3)],'payment':_0x296014[_0x2195dd(0x1a9)]})),'pagination':{'page':_0x541d58,'limit':_0x2dd7d6,'total':_0x3957e7,'totalPages':Math[_0x2195dd(0x18b)](_0x3957e7/_0x2dd7d6)}};}async[a54_0x3540c4(0x17c)](_0x197ee1,_0x9ffedb){const _0x4e97d4=a54_0x3540c4,_0x1ba6ac=new Date();let _0x3f9d0a;switch(_0x9ffedb){case'7d':_0x3f9d0a=new Date(_0x1ba6ac[_0x4e97d4(0x1aa)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x3f9d0a=new Date(_0x1ba6ac[_0x4e97d4(0x1aa)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x3f9d0a=new Date(_0x1ba6ac[_0x4e97d4(0x1aa)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x3f9d0a=new Date(_0x1ba6ac[_0x4e97d4(0x1aa)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4863dd,_0x5d002a,_0x440e26,_0x487cda,_0x1e0234]=await Promise[_0x4e97d4(0x172)]([database_1[_0x4e97d4(0x1bb)][_0x4e97d4(0x1a9)][_0x4e97d4(0x19b)]({'where':{'shopId':_0x197ee1,'gateway':{'not':_0x4e97d4(0x1da)},'createdAt':{'gte':_0x3f9d0a}}}),database_1[_0x4e97d4(0x1bb)][_0x4e97d4(0x1a9)]['count']({'where':{'shopId':_0x197ee1,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0x3f9d0a}}}),database_1[_0x4e97d4(0x1bb)][_0x4e97d4(0x1a9)][_0x4e97d4(0x180)]({'where':{'shopId':_0x197ee1,'gateway':{'not':_0x4e97d4(0x1da)},'status':_0x4e97d4(0x187),'createdAt':{'gte':_0x3f9d0a}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x4e97d4(0x1bb)][_0x4e97d4(0x1a9)][_0x4e97d4(0x180)]({'where':{'shopId':_0x197ee1,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x4e97d4(0x1e6)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x4e97d4(0x1a9)][_0x4e97d4(0x180)]({'where':{'shopId':_0x197ee1,'gateway':{'not':_0x4e97d4(0x1da)},'createdAt':{'gte':_0x3f9d0a}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4e97d4(0x176)}})]);let _0x271932=0x0;for(const _0x192dd0 of _0x440e26){if(_0x192dd0[_0x4e97d4(0x192)])_0x271932+=_0x192dd0[_0x4e97d4(0x192)];else{const _0x4e83ff=await currencyService_1[_0x4e97d4(0x1f4)][_0x4e97d4(0x1dc)](_0x192dd0[_0x4e97d4(0x182)],_0x192dd0[_0x4e97d4(0x16a)]);_0x271932+=_0x4e83ff;}}const _0x5e4ab0=this[_0x4e97d4(0x1c1)](_0x1e0234,_0x3f9d0a,_0x1ba6ac),_0x461c52=_0x4863dd>0x0?_0x5d002a/_0x4863dd*0x64:0x0;return{'totalPayments':_0x4863dd,'successfulPayments':_0x5d002a,'totalRevenue':Math[_0x4e97d4(0x1d8)](_0x271932*0x64)/0x64,'conversionRate':Math[_0x4e97d4(0x1d8)](_0x461c52*0x64)/0x64,'dailyRevenue':_0x5e4ab0['dailyRevenue'],'dailyPayments':_0x5e4ab0['dailyPayments'],'recentPayments':_0x487cda[_0x4e97d4(0x1ba)](_0x210f5a=>({'id':_0x210f5a['id'],'gateway':_0x210f5a[_0x4e97d4(0x183)],'amount':_0x210f5a['amount'],'currency':_0x210f5a[_0x4e97d4(0x16a)],'status':_0x210f5a['status'],'createdAt':_0x210f5a[_0x4e97d4(0x1b3)]}))};}[a54_0x3540c4(0x1c1)](_0x2c6bcb,_0x1eac75,_0x1b28d9){const _0x4ac7a5=a54_0x3540c4,_0x53d66a=new Map(),_0x12a656=new Date(_0x1eac75);while(_0x12a656<=_0x1b28d9){const _0x7ee525=_0x12a656['toISOString']()[_0x4ac7a5(0x194)]('T')[0x0];_0x53d66a[_0x4ac7a5(0x1d6)](_0x7ee525,{'revenue':0x0,'count':0x0}),_0x12a656['setDate'](_0x12a656[_0x4ac7a5(0x1f3)]()+0x1);}for(const _0x565354 of _0x2c6bcb){const _0x186e97=_0x565354[_0x4ac7a5(0x1b3)]['toISOString']()[_0x4ac7a5(0x194)]('T')[0x0],_0x59023e=_0x53d66a[_0x4ac7a5(0x1d5)](_0x186e97);_0x59023e&&(_0x59023e[_0x4ac7a5(0x19b)]+=0x1,_0x565354[_0x4ac7a5(0x1b1)]===_0x4ac7a5(0x187)&&_0x565354[_0x4ac7a5(0x192)]&&(_0x59023e[_0x4ac7a5(0x184)]+=_0x565354['amountUSDT']));}const _0xef4b12=[],_0x37e136=[];for(const [_0x48e6f8,_0x16f7f8]of _0x53d66a){_0xef4b12[_0x4ac7a5(0x186)]({'date':_0x48e6f8,'amount':Math[_0x4ac7a5(0x1d8)](_0x16f7f8[_0x4ac7a5(0x184)]*0x64)/0x64}),_0x37e136[_0x4ac7a5(0x186)]({'date':_0x48e6f8,'count':_0x16f7f8[_0x4ac7a5(0x19b)]});}return{'dailyRevenue':_0xef4b12,'dailyPayments':_0x37e136};}}exports[a54_0x3540c4(0x1e2)]=ShopService;