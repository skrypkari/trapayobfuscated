'use strict';const a86_0x594cdf=a86_0x4e0e;(function(_0x20b2a6,_0x467999){const _0x20c703=a86_0x4e0e,_0xa2624f=_0x20b2a6();while(!![]){try{const _0x1cf8eb=parseInt(_0x20c703(0x1f8))/0x1*(parseInt(_0x20c703(0x29d))/0x2)+-parseInt(_0x20c703(0x271))/0x3*(-parseInt(_0x20c703(0x256))/0x4)+parseInt(_0x20c703(0x245))/0x5+parseInt(_0x20c703(0x27d))/0x6+-parseInt(_0x20c703(0x2cf))/0x7+-parseInt(_0x20c703(0x2be))/0x8*(-parseInt(_0x20c703(0x24f))/0x9)+-parseInt(_0x20c703(0x201))/0xa;if(_0x1cf8eb===_0x467999)break;else _0xa2624f['push'](_0xa2624f['shift']());}catch(_0xad8a33){_0xa2624f['push'](_0xa2624f['shift']());}}}(a86_0x55a2,0x596f5));function a86_0x4e0e(_0x5e9d36,_0x1f3683){_0x5e9d36=_0x5e9d36-0x1eb;const _0x55a258=a86_0x55a2();let _0x4e0ebd=_0x55a258[_0x5e9d36];return _0x4e0ebd;}var __importDefault=this&&this['__importDefault']||function(_0x1122cf){return _0x1122cf&&_0x1122cf['__esModule']?_0x1122cf:{'default':_0x1122cf};};Object[a86_0x594cdf(0x1f0)](exports,a86_0x594cdf(0x2b5),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require(a86_0x594cdf(0x2c0))),bcryptjs_1=__importDefault(require(a86_0x594cdf(0x234))),crypto_1=__importDefault(require(a86_0x594cdf(0x203))),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require('qrcode')),currencyService_1=require(a86_0x594cdf(0x262)),paymentService_1=require(a86_0x594cdf(0x2cd)),gateway_1=require(a86_0x594cdf(0x2ba));class ShopService{constructor(){const _0x535b5b=a86_0x594cdf;this[_0x535b5b(0x2a6)]=new paymentService_1[(_0x535b5b(0x218))]();}async[a86_0x594cdf(0x1fa)](_0x205aea){const _0x11c6e0=a86_0x594cdf,_0x3422b4=await database_1[_0x11c6e0(0x1ee)]['shop'][_0x11c6e0(0x266)]({'where':{'id':_0x205aea},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x3422b4)throw new Error(_0x11c6e0(0x2c8));let _0x246f44=[];if(_0x3422b4[_0x11c6e0(0x23c)]?.['webhookEvents'])try{_0x246f44=Array[_0x11c6e0(0x1f5)](_0x3422b4[_0x11c6e0(0x23c)][_0x11c6e0(0x28a)])?_0x3422b4[_0x11c6e0(0x23c)][_0x11c6e0(0x28a)]:JSON[_0x11c6e0(0x208)](_0x3422b4['settings'][_0x11c6e0(0x28a)]);}catch(_0x5e03c7){console['error'](_0x11c6e0(0x211),_0x5e03c7),_0x246f44=[];}const _0x46b626=gateway_1[_0x11c6e0(0x2b9)][_0x11c6e0(0x2a0)](_0x265dad=>_0x265dad[_0x11c6e0(0x221)])[_0x11c6e0(0x219)](_0x316194=>_0x316194[_0x11c6e0(0x2bb)]);let _0x1781fc=_0x3422b4[_0x11c6e0(0x260)]?JSON[_0x11c6e0(0x208)](_0x3422b4[_0x11c6e0(0x260)]):[];return Array[_0x11c6e0(0x1f5)](_0x1781fc)&&(_0x1781fc=_0x1781fc[_0x11c6e0(0x219)](_0x122105=>_0x122105[_0x11c6e0(0x23b)](/\s+/g,'_')[_0x11c6e0(0x2a4)]())[_0x11c6e0(0x2a0)](_0x38c314=>_0x46b626[_0x11c6e0(0x2ca)](_0x38c314))),{'id':_0x3422b4['id'],'fullName':_0x3422b4[_0x11c6e0(0x2bb)],'username':_0x3422b4[_0x11c6e0(0x241)],'telegramId':_0x3422b4['telegram'],'merchantUrl':_0x3422b4[_0x11c6e0(0x2b4)],'merchantUrl2':_0x3422b4[_0x11c6e0(0x209)],'merchantUrl3':_0x3422b4['shopUrl3'],'merchantUrl4':_0x3422b4[_0x11c6e0(0x270)],'gateways':_0x1781fc,'gatewaySettings':_0x3422b4['gatewaySettings']?JSON[_0x11c6e0(0x208)](_0x3422b4[_0x11c6e0(0x214)]):null,'publicKey':_0x3422b4[_0x11c6e0(0x1f6)],'secretKey':_0x3422b4[_0x11c6e0(0x26d)],'webhookUrl':_0x3422b4[_0x11c6e0(0x23c)]?.[_0x11c6e0(0x273)]||null,'webhookEvents':_0x246f44,'wallets':{'usdtPolygonWallet':_0x3422b4[_0x11c6e0(0x20f)],'usdtTrcWallet':_0x3422b4['usdtTrcWallet'],'usdtErcWallet':_0x3422b4[_0x11c6e0(0x268)],'usdcPolygonWallet':_0x3422b4[_0x11c6e0(0x21c)],'usdcErcWallet':_0x3422b4[_0x11c6e0(0x20d)]},'status':_0x3422b4[_0x11c6e0(0x2ae)],'createdAt':_0x3422b4[_0x11c6e0(0x2bf)]};}async[a86_0x594cdf(0x28f)](_0x2e09ab,_0x3ebe85){const _0x5cff80=a86_0x594cdf,_0x3fe353={};_0x3ebe85[_0x5cff80(0x21f)]&&(_0x3fe353[_0x5cff80(0x2bb)]=_0x3ebe85[_0x5cff80(0x21f)]);_0x3ebe85[_0x5cff80(0x29f)]!==undefined&&(_0x3fe353[_0x5cff80(0x2c1)]=_0x3ebe85[_0x5cff80(0x29f)]||null);_0x3ebe85['merchantUrl']&&(_0x3fe353[_0x5cff80(0x2b4)]=_0x3ebe85[_0x5cff80(0x25f)]);_0x3ebe85[_0x5cff80(0x23a)]!==undefined&&(_0x3fe353[_0x5cff80(0x209)]=_0x3ebe85[_0x5cff80(0x23a)]||null);_0x3ebe85[_0x5cff80(0x2d3)]!==undefined&&(_0x3fe353[_0x5cff80(0x2a8)]=_0x3ebe85['merchantUrl3']||null);_0x3ebe85[_0x5cff80(0x29c)]!==undefined&&(_0x3fe353[_0x5cff80(0x270)]=_0x3ebe85[_0x5cff80(0x29c)]||null);_0x3ebe85['gateways']&&(_0x3fe353[_0x5cff80(0x260)]=JSON['stringify'](_0x3ebe85[_0x5cff80(0x26f)]));_0x3ebe85['gatewaySettings']&&(_0x3fe353[_0x5cff80(0x214)]=JSON[_0x5cff80(0x242)](_0x3ebe85['gatewaySettings']));_0x3ebe85[_0x5cff80(0x279)]&&(_0x3ebe85[_0x5cff80(0x279)]['usdtPolygonWallet']!==undefined&&(_0x3fe353[_0x5cff80(0x20f)]=_0x3ebe85[_0x5cff80(0x279)]['usdtPolygonWallet']||null),_0x3ebe85[_0x5cff80(0x279)][_0x5cff80(0x27b)]!==undefined&&(_0x3fe353[_0x5cff80(0x27b)]=_0x3ebe85[_0x5cff80(0x279)][_0x5cff80(0x27b)]||null),_0x3ebe85[_0x5cff80(0x279)]['usdtErcWallet']!==undefined&&(_0x3fe353[_0x5cff80(0x268)]=_0x3ebe85[_0x5cff80(0x279)][_0x5cff80(0x268)]||null),_0x3ebe85[_0x5cff80(0x279)][_0x5cff80(0x21c)]!==undefined&&(_0x3fe353[_0x5cff80(0x21c)]=_0x3ebe85[_0x5cff80(0x279)][_0x5cff80(0x21c)]||null));const _0x3c3570=await database_1['default'][_0x5cff80(0x250)]['update']({'where':{'id':_0x2e09ab},'data':_0x3fe353,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2d3754=[];if(_0x3c3570[_0x5cff80(0x23c)]?.[_0x5cff80(0x28a)])try{_0x2d3754=Array[_0x5cff80(0x1f5)](_0x3c3570[_0x5cff80(0x23c)]['webhookEvents'])?_0x3c3570[_0x5cff80(0x23c)][_0x5cff80(0x28a)]:JSON[_0x5cff80(0x208)](_0x3c3570[_0x5cff80(0x23c)][_0x5cff80(0x28a)]);}catch(_0x1ebe7e){console[_0x5cff80(0x1f1)](_0x5cff80(0x211),_0x1ebe7e),_0x2d3754=[];}return{'id':_0x3c3570['id'],'fullName':_0x3c3570[_0x5cff80(0x2bb)],'username':_0x3c3570[_0x5cff80(0x241)],'telegramId':_0x3c3570['telegram'],'merchantUrl':_0x3c3570[_0x5cff80(0x2b4)],'merchantUrl2':_0x3c3570[_0x5cff80(0x209)],'merchantUrl3':_0x3c3570[_0x5cff80(0x2a8)],'merchantUrl4':_0x3c3570['shopUrl4'],'gateways':_0x3c3570[_0x5cff80(0x260)]?JSON[_0x5cff80(0x208)](_0x3c3570[_0x5cff80(0x260)]):null,'gatewaySettings':_0x3c3570['gatewaySettings']?JSON[_0x5cff80(0x208)](_0x3c3570[_0x5cff80(0x214)]):null,'publicKey':_0x3c3570[_0x5cff80(0x1f6)],'secretKey':_0x3c3570[_0x5cff80(0x26d)],'webhookUrl':_0x3c3570[_0x5cff80(0x23c)]?.[_0x5cff80(0x273)]||null,'webhookEvents':_0x2d3754,'wallets':{'usdtPolygonWallet':_0x3c3570[_0x5cff80(0x20f)],'usdtTrcWallet':_0x3c3570[_0x5cff80(0x27b)],'usdtErcWallet':_0x3c3570['usdtErcWallet'],'usdcPolygonWallet':_0x3c3570[_0x5cff80(0x21c)],'usdcErcWallet':_0x3c3570['usdcErcWallet']},'status':_0x3c3570[_0x5cff80(0x2ae)],'createdAt':_0x3c3570['createdAt']};}async[a86_0x594cdf(0x2b6)](_0x1ff7e7,_0x1c0923){const _0x5faf57=a86_0x594cdf,_0x334efc=await database_1[_0x5faf57(0x1ee)]['shop'][_0x5faf57(0x266)]({'where':{'id':_0x1ff7e7},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x334efc)throw new Error(_0x5faf57(0x2c8));if(_0x334efc[_0x5faf57(0x2a1)]){if(!_0x1c0923[_0x5faf57(0x294)])throw new Error('2FA\x20token\x20is\x20required');const _0x495716=speakeasy_1[_0x5faf57(0x1ee)][_0x5faf57(0x200)][_0x5faf57(0x21e)]({'secret':_0x334efc[_0x5faf57(0x2a7)],'encoding':_0x5faf57(0x217),'token':_0x1c0923[_0x5faf57(0x294)],'window':0x2});if(!_0x495716){let _0x7c88f=![];if(_0x334efc[_0x5faf57(0x2d2)]){const _0x1704e1=JSON[_0x5faf57(0x208)](_0x334efc['backupCodes']);for(let _0x409a9f=0x0;_0x409a9f<_0x1704e1[_0x5faf57(0x2b7)];_0x409a9f++){const _0x2f7509=await bcryptjs_1[_0x5faf57(0x1ee)][_0x5faf57(0x226)](_0x1c0923[_0x5faf57(0x294)],_0x1704e1[_0x409a9f]);if(_0x2f7509){_0x7c88f=!![],_0x1704e1['splice'](_0x409a9f,0x1),await database_1[_0x5faf57(0x1ee)][_0x5faf57(0x250)]['update']({'where':{'id':_0x1ff7e7},'data':{'backupCodes':JSON[_0x5faf57(0x242)](_0x1704e1)}});break;}}}if(!_0x7c88f)throw new Error(_0x5faf57(0x289));}}const _0x264042={};_0x1c0923[_0x5faf57(0x20f)]!==undefined&&(_0x264042[_0x5faf57(0x20f)]=_0x1c0923[_0x5faf57(0x20f)]||null),_0x1c0923[_0x5faf57(0x27b)]!==undefined&&(_0x264042[_0x5faf57(0x27b)]=_0x1c0923['usdtTrcWallet']||null),_0x1c0923[_0x5faf57(0x268)]!==undefined&&(_0x264042[_0x5faf57(0x268)]=_0x1c0923['usdtErcWallet']||null),_0x1c0923['usdcPolygonWallet']!==undefined&&(_0x264042['usdcPolygonWallet']=_0x1c0923[_0x5faf57(0x21c)]||null),_0x1c0923['usdcErcWallet']!==undefined&&(_0x264042[_0x5faf57(0x20d)]=_0x1c0923[_0x5faf57(0x20d)]||null),await database_1[_0x5faf57(0x1ee)][_0x5faf57(0x250)][_0x5faf57(0x23e)]({'where':{'id':_0x1ff7e7},'data':_0x264042});}async[a86_0x594cdf(0x2d1)](_0x27eed3){const _0x277d=a86_0x594cdf,_0x5313c7=await database_1[_0x277d(0x1ee)][_0x277d(0x250)][_0x277d(0x266)]({'where':{'id':_0x27eed3},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x5313c7?.[_0x277d(0x23c)]?.['webhookUrl'])throw new Error(_0x277d(0x29b));const _0x2328f9={'event':'test','payment':{'id':_0x277d(0x24e),'order_id':'test_order_123','gateway':_0x277d(0x22e),'amount':0x64,'currency':'USD','status':'paid','created_at':new Date()[_0x277d(0x2b8)]()}};try{const _0x31220e=JSON[_0x277d(0x242)](_0x2328f9),_0x13d445=crypto_1[_0x277d(0x1ee)][_0x277d(0x272)](_0x277d(0x222),_0x5313c7[_0x277d(0x26d)])[_0x277d(0x23e)](_0x31220e)['digest'](_0x277d(0x230)),_0x559ace=await fetch(_0x5313c7['settings'][_0x277d(0x273)],{'method':_0x277d(0x1f4),'headers':{'Content-Type':'application/json','User-Agent':_0x277d(0x231),'X-Webhook-Signature':_0x13d445},'body':_0x31220e});return _0x559ace['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x559ace[_0x277d(0x2ae)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x559ace[_0x277d(0x2ae)]+'\x20'+_0x559ace['statusText']};}catch(_0x38da61){return{'success':![],'message':_0x277d(0x2a3)+(_0x38da61 instanceof Error?_0x38da61['message']:'Unknown\x20error')};}}async['createPayment'](_0x464f6d){const _0x5808ca=a86_0x594cdf;return this[_0x5808ca(0x2a6)]['createPublicPayment']({'public_key':'','gateway':_0x464f6d[_0x5808ca(0x227)],'order_id':'','amount':_0x464f6d['amount'],'currency':_0x464f6d[_0x5808ca(0x254)],'source_currency':_0x464f6d['sourceCurrency'],'success_url':_0x464f6d[_0x5808ca(0x21d)],'fail_url':_0x464f6d['redirectUrl'],'customer_email':_0x464f6d[_0x5808ca(0x22b)],'customer_name':_0x464f6d[_0x5808ca(0x269)],'language':_0x464f6d[_0x5808ca(0x292)]});}async[a86_0x594cdf(0x293)](_0x1b95d8,_0x1a56b3){return this['paymentService']['getPaymentsByShop'](_0x1b95d8,_0x1a56b3);}async['getPaymentById'](_0x2527bf,_0x5f4728){const _0x166219=a86_0x594cdf;return this[_0x166219(0x2a6)][_0x166219(0x24b)](_0x2527bf,_0x5f4728);}async[a86_0x594cdf(0x1fd)](_0x20a04d,_0x43c190,_0x5ae6a9){const _0x282771=a86_0x594cdf,_0xdca23c=await database_1[_0x282771(0x1ee)][_0x282771(0x2a5)][_0x282771(0x216)]({'where':{'id':_0x43c190,'shopId':_0x20a04d}});if(!_0xdca23c)throw new Error('Payment\x20not\x20found');const _0x4435f6=await database_1[_0x282771(0x1ee)][_0x282771(0x2a5)][_0x282771(0x23e)]({'where':{'id':_0x43c190},'data':{..._0x5ae6a9,'updatedAt':new Date()}});return _0x4435f6;}async[a86_0x594cdf(0x2bd)](_0x44f2bb,_0x434c05){const _0x359124=a86_0x594cdf,_0x44962d=await database_1[_0x359124(0x1ee)][_0x359124(0x2a5)][_0x359124(0x216)]({'where':{'id':_0x434c05,'shopId':_0x44f2bb}});if(!_0x44962d)throw new Error(_0x359124(0x228));await database_1[_0x359124(0x1ee)][_0x359124(0x2a5)]['delete']({'where':{'id':_0x434c05}});}[a86_0x594cdf(0x257)](_0x59313f){const _0x542a07=a86_0x594cdf,_0x279f5f={'polygon':_0x542a07(0x285),'trc20':_0x542a07(0x246),'erc20':_0x542a07(0x267),'bsc':_0x542a07(0x213),'polygon_usdc':_0x542a07(0x299),'erc20_usdc':_0x542a07(0x263)};return _0x279f5f[_0x59313f]||_0x59313f;}async[a86_0x594cdf(0x2d0)](_0x492714,_0x2de291){const _0x16fece=a86_0x594cdf,{page:_0x528b6b,limit:_0x4a3f3f,status:_0x4c4473,method:_0x300f45,network:_0x514058,dateFrom:_0x22eb4e,dateTo:_0x21bcca,periodFrom:_0x539b1b,periodTo:_0x4b4b2c}=_0x2de291,_0x598cbc=(_0x528b6b-0x1)*_0x4a3f3f;console[_0x16fece(0x283)](_0x16fece(0x1fc),_0x2de291);const _0x5bd6b7={'shopId':_0x492714};_0x4c4473&&(_0x5bd6b7[_0x16fece(0x2ae)]=_0x4c4473[_0x16fece(0x248)](),console[_0x16fece(0x283)](_0x16fece(0x22f)+_0x4c4473['toUpperCase']()));if(_0x300f45)_0x5bd6b7[_0x16fece(0x259)]=_0x300f45,console[_0x16fece(0x283)](_0x16fece(0x261)+_0x300f45);else _0x514058&&(_0x5bd6b7[_0x16fece(0x259)]=_0x514058,console[_0x16fece(0x283)]('üåê\x20Network\x20filter:\x20'+_0x514058));if(_0x22eb4e||_0x21bcca||_0x539b1b||_0x4b4b2c){_0x5bd6b7['createdAt']={};if(_0x539b1b){const _0x56e6ad=new Date(_0x539b1b);_0x56e6ad['setHours'](0x0,0x0,0x0,0x1),_0x5bd6b7['createdAt']['gte']=_0x56e6ad,console[_0x16fece(0x283)]('üìÖ\x20Period\x20start:\x20'+_0x56e6ad[_0x16fece(0x2b8)]());}else{if(_0x22eb4e){const _0x5e5ac2=new Date(_0x22eb4e);_0x5e5ac2[_0x16fece(0x27f)](0x0,0x0,0x0,0x1),_0x5bd6b7['createdAt']['gte']=_0x5e5ac2,console[_0x16fece(0x283)](_0x16fece(0x27c)+_0x5e5ac2[_0x16fece(0x2b8)]());}}if(_0x4b4b2c){const _0x24692a=new Date(_0x4b4b2c);_0x24692a[_0x16fece(0x27f)](0x17,0x3b,0x3b,0x3e7),_0x5bd6b7[_0x16fece(0x2bf)][_0x16fece(0x204)]=_0x24692a,console['log']('üìÖ\x20Period\x20end:\x20'+_0x24692a['toISOString']());}else{if(_0x21bcca){const _0x3b8743=new Date(_0x21bcca);_0x3b8743['setHours'](0x17,0x3b,0x3b,0x3e7),_0x5bd6b7[_0x16fece(0x2bf)]['lte']=_0x3b8743,console[_0x16fece(0x283)](_0x16fece(0x2c4)+_0x3b8743['toISOString']());}}}console[_0x16fece(0x283)](_0x16fece(0x251),JSON[_0x16fece(0x242)](_0x5bd6b7,null,0x2));const [_0x43ac6a,_0x488538]=await Promise[_0x16fece(0x274)]([database_1[_0x16fece(0x1ee)][_0x16fece(0x253)][_0x16fece(0x2af)]({'where':_0x5bd6b7,'skip':_0x598cbc,'take':_0x4a3f3f,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x16fece(0x1ee)][_0x16fece(0x253)][_0x16fece(0x2ab)]({'where':_0x5bd6b7})]);return{'payouts':_0x43ac6a[_0x16fece(0x219)](_0x51c5d4=>{const _0x264ec1=_0x16fece;let _0x39add0=null;switch(_0x51c5d4[_0x264ec1(0x259)]){case'polygon':_0x39add0=_0x51c5d4['shop'][_0x264ec1(0x20f)];break;case'trc20':_0x39add0=_0x51c5d4[_0x264ec1(0x250)][_0x264ec1(0x27b)];break;case _0x264ec1(0x212):_0x39add0=_0x51c5d4[_0x264ec1(0x250)]['usdtErcWallet'];break;case'polygon_usdc':_0x39add0=_0x51c5d4[_0x264ec1(0x250)]['usdcPolygonWallet'];break;case _0x264ec1(0x28b):_0x39add0=_0x51c5d4['shop']['usdcErcWallet'];break;}return{'id':_0x51c5d4['id'],'amount':_0x51c5d4[_0x264ec1(0x210)],'network':this[_0x264ec1(0x257)](_0x51c5d4[_0x264ec1(0x259)]),'wallet':_0x39add0,'status':_0x51c5d4[_0x264ec1(0x2ae)],'txid':_0x51c5d4[_0x264ec1(0x247)],'notes':_0x51c5d4['notes'],'periodFrom':_0x51c5d4[_0x264ec1(0x26b)],'periodTo':_0x51c5d4[_0x264ec1(0x275)],'createdAt':_0x51c5d4[_0x264ec1(0x2bf)],'paidAt':_0x51c5d4['paidAt']};}),'pagination':{'page':_0x528b6b,'limit':_0x4a3f3f,'total':_0x488538,'totalPages':Math['ceil'](_0x488538/_0x4a3f3f)}};}async[a86_0x594cdf(0x2c6)](_0x592526,_0x113194){const _0x4f67a7=a86_0x594cdf,_0x4922fe=await database_1[_0x4f67a7(0x1ee)][_0x4f67a7(0x253)][_0x4f67a7(0x216)]({'where':{'id':_0x113194,'shopId':_0x592526}});if(!_0x4922fe)return null;return{'id':_0x4922fe['id'],'amount':_0x4922fe[_0x4f67a7(0x210)],'network':_0x4922fe[_0x4f67a7(0x259)],'status':_0x4922fe[_0x4f67a7(0x2ae)],'txid':_0x4922fe[_0x4f67a7(0x247)],'notes':_0x4922fe[_0x4f67a7(0x25d)],'createdAt':_0x4922fe[_0x4f67a7(0x2bf)],'paidAt':_0x4922fe[_0x4f67a7(0x25e)]};}async['getPayoutStatistics'](_0x2266f3,_0x2afe14){const _0x38800c=a86_0x594cdf,_0x48431e=new Date();let _0x524a0c,_0x3ae9e4;switch(_0x2afe14){case _0x38800c(0x21b):case _0x38800c(0x255):const _0x167729=new Date(_0x48431e);_0x167729['setDate'](_0x167729[_0x38800c(0x2cc)]()-0x1),_0x524a0c=new Date(_0x167729),_0x524a0c['setHours'](0x0,0x0,0x0,0x0),_0x3ae9e4=new Date(_0x167729),_0x3ae9e4[_0x38800c(0x27f)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x524a0c=new Date(_0x48431e[_0x38800c(0x296)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x524a0c=new Date(_0x48431e[_0x38800c(0x296)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x38800c(0x233):_0x524a0c=new Date(_0x48431e[_0x38800c(0x296)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x524a0c=new Date(_0x48431e[_0x38800c(0x296)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x4153e0={'gte':_0x524a0c};_0x3ae9e4&&(_0x4153e0['lte']=_0x3ae9e4);const [_0x2a8354,_0x5956b4,_0x546128,_0x341e11,_0x512796,_0x420830]=await Promise['all']([database_1['default'][_0x38800c(0x253)][_0x38800c(0x2ab)]({'where':{'shopId':_0x2266f3,'createdAt':_0x4153e0}}),database_1['default'][_0x38800c(0x253)][_0x38800c(0x2ab)]({'where':{'shopId':_0x2266f3,'status':_0x38800c(0x276),'createdAt':_0x4153e0}}),database_1[_0x38800c(0x1ee)][_0x38800c(0x253)][_0x38800c(0x2ab)]({'where':{'shopId':_0x2266f3,'status':_0x38800c(0x1f3),'createdAt':_0x4153e0}}),database_1['default'][_0x38800c(0x253)][_0x38800c(0x2ab)]({'where':{'shopId':_0x2266f3,'status':_0x38800c(0x22c),'createdAt':_0x4153e0}}),database_1['default'][_0x38800c(0x253)][_0x38800c(0x2af)]({'where':{'shopId':_0x2266f3,'createdAt':_0x4153e0},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x38800c(0x1ee)]['payout'][_0x38800c(0x2af)]({'where':{'shopId':_0x2266f3},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x1a5230=_0x512796['reduce']((_0x1ffdaf,_0x1732a9)=>_0x1ffdaf+_0x1732a9[_0x38800c(0x210)],0x0),_0x25c5b2=_0x512796[_0x38800c(0x2a0)](_0x28fafe=>_0x28fafe[_0x38800c(0x2ae)]==='COMPLETED')[_0x38800c(0x232)]((_0x3c87d7,_0x489271)=>_0x3c87d7+_0x489271['amount'],0x0),_0x471cce=_0x512796[_0x38800c(0x2a0)](_0x2f73d9=>_0x2f73d9[_0x38800c(0x2ae)]==='PENDING')[_0x38800c(0x232)]((_0x33514f,_0x19c826)=>_0x33514f+_0x19c826[_0x38800c(0x210)],0x0),_0x1cda3d=_0x512796['reduce']((_0x2b1209,_0x2f9b5f)=>{const _0x5d8f51=_0x38800c;return _0x2b1209[_0x2f9b5f[_0x5d8f51(0x259)]]=(_0x2b1209[_0x2f9b5f[_0x5d8f51(0x259)]]||0x0)+0x1,_0x2b1209;},{}),_0x5d48fa=_0x512796[_0x38800c(0x232)]((_0x5302fc,_0x409e25)=>{const _0x131dab=_0x38800c;return _0x5302fc[_0x409e25[_0x131dab(0x2ae)]]=(_0x5302fc[_0x409e25[_0x131dab(0x2ae)]]||0x0)+0x1,_0x5302fc;},{});return{'totalPayouts':_0x2a8354,'completedPayouts':_0x5956b4,'pendingPayouts':_0x546128,'rejectedPayouts':_0x341e11,'totalAmount':_0x1a5230,'completedAmount':_0x25c5b2,'pendingAmount':_0x471cce,'payoutsByMethod':_0x1cda3d,'payoutsByStatus':_0x5d48fa,'recentPayouts':_0x420830[_0x38800c(0x219)](_0x7b4fc6=>({'id':_0x7b4fc6['id'],'shopId':_0x2266f3,'amount':_0x7b4fc6[_0x38800c(0x210)],'method':_0x7b4fc6[_0x38800c(0x259)],'status':_0x7b4fc6[_0x38800c(0x2ae)],'txid':_0x7b4fc6[_0x38800c(0x247)],'createdAt':_0x7b4fc6[_0x38800c(0x2bf)],'paidAt':_0x7b4fc6[_0x38800c(0x25e)]}))};}async[a86_0x594cdf(0x237)](_0xfc751c){const _0x5533d1=a86_0x594cdf;console[_0x5533d1(0x283)](_0x5533d1(0x240)+_0xfc751c+_0x5533d1(0x282));const _0x5b38de=await database_1[_0x5533d1(0x1ee)][_0x5533d1(0x250)]['findUnique']({'where':{'id':_0xfc751c},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5b38de)throw new Error(_0x5533d1(0x2c8));const _0x54a9f3=new Date(),_0x39c0a1=new Date(_0x54a9f3[_0x5533d1(0x280)](),_0x54a9f3[_0x5533d1(0x207)](),0x1),_0x3b765d=new Date(_0x54a9f3[_0x5533d1(0x280)](),_0x54a9f3[_0x5533d1(0x207)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x45f5e9=await database_1[_0x5533d1(0x1ee)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0xfc751c,'createdAt':{'gte':_0x39c0a1,'lte':_0x3b765d},'status':'COMPLETED'}}),_0x12498a=_0x45f5e9[_0x5533d1(0x22a)][_0x5533d1(0x210)]||0x0,_0x29fa25={'availableBalance':Math['round'](_0x5b38de['balance']*0x64)/0x64,'totalPaidOut':Math['round'](_0x5b38de[_0x5533d1(0x202)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x5b38de[_0x5533d1(0x220)]*0x64)/0x64,'thisMonth':Math[_0x5533d1(0x2c9)](_0x12498a*0x64)/0x64};return console[_0x5533d1(0x283)](_0x5533d1(0x23f)+_0x5b38de[_0x5533d1(0x241)]+_0x5533d1(0x290)),console['log'](_0x5533d1(0x205)+_0x29fa25[_0x5533d1(0x235)]+_0x5533d1(0x20a)),console[_0x5533d1(0x283)](_0x5533d1(0x278)+_0x29fa25[_0x5533d1(0x202)]+_0x5533d1(0x1fb)),console[_0x5533d1(0x283)](_0x5533d1(0x286)+_0x29fa25['awaitingPayout']+_0x5533d1(0x20a)),console[_0x5533d1(0x283)](_0x5533d1(0x2c2)+_0x29fa25['thisMonth']+_0x5533d1(0x1eb)),_0x29fa25;}[a86_0x594cdf(0x29a)](_0x102b7d){const _0x3b55ed=a86_0x594cdf,_0x449dc1={'test_gateway':_0x3b55ed(0x238),'plisio':_0x3b55ed(0x281),'rapyd':_0x3b55ed(0x277),'noda':_0x3b55ed(0x24a),'cointopay':_0x3b55ed(0x1ed),'klyme_eu':_0x3b55ed(0x2bc),'klyme_gb':'KLYME\x20GB','klyme_de':_0x3b55ed(0x26c)};return _0x449dc1[_0x102b7d]||_0x102b7d;}async[a86_0x594cdf(0x23d)](_0x87356c){return this['getShopPayoutStats'](_0x87356c);}async[a86_0x594cdf(0x1fe)](_0x356686,_0x4d6f2a){const _0x3a7266=a86_0x594cdf,{page:_0x583e5b,limit:_0x103a8b,paymentId:_0x1f8956}=_0x4d6f2a,_0x4a8446=(_0x583e5b-0x1)*_0x103a8b,_0x3fcc01={'shopId':_0x356686};_0x1f8956&&(_0x3fcc01[_0x3a7266(0x288)]=_0x1f8956);const [_0x561dc3,_0x515a61]=await Promise[_0x3a7266(0x274)]([database_1['default'][_0x3a7266(0x264)][_0x3a7266(0x2af)]({'where':_0x3fcc01,'skip':_0x4a8446,'take':_0x103a8b,'orderBy':{'createdAt':_0x3a7266(0x224)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x3a7266(0x1ee)][_0x3a7266(0x264)]['count']({'where':_0x3fcc01})]);return{'logs':_0x561dc3[_0x3a7266(0x219)](_0x3e40fb=>({'id':_0x3e40fb['id'],'paymentId':_0x3e40fb['paymentId'],'shopId':_0x3e40fb[_0x3a7266(0x291)],'event':_0x3e40fb[_0x3a7266(0x25b)],'statusCode':_0x3e40fb['statusCode'],'retryCount':_0x3e40fb['retryCount'],'responseBody':_0x3e40fb['responseBody'],'createdAt':_0x3e40fb[_0x3a7266(0x2bf)],'payment':_0x3e40fb[_0x3a7266(0x2a5)]})),'pagination':{'page':_0x583e5b,'limit':_0x103a8b,'total':_0x515a61,'totalPages':Math[_0x3a7266(0x2c7)](_0x515a61/_0x103a8b)}};}async[a86_0x594cdf(0x1ec)](_0x3656e1,_0x552ba2,_0x1288f6,_0x172fce,_0x3b22fe){const _0x3c0330=a86_0x594cdf;console['log'](_0x3c0330(0x295)+_0x3656e1+_0x3c0330(0x287)+_0x552ba2+',\x20dateFrom:\x20'+_0x1288f6+',\x20dateTo:\x20'+_0x172fce);const _0x1fa678=_0x3b22fe?new Date(_0x3b22fe):new Date();let _0x287338,_0x30c5f2;if(_0x1288f6&&_0x172fce){const _0x33a0de=new Date(_0x1288f6),_0x337a81=new Date(_0x172fce);_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x33a0de[_0x3c0330(0x26a)](),_0x33a0de['getUTCMonth'](),_0x33a0de[_0x3c0330(0x20e)](),0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x337a81[_0x3c0330(0x26a)](),_0x337a81[_0x3c0330(0x1ff)](),_0x337a81[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7)),console['log'](_0x3c0330(0x244)+_0x287338[_0x3c0330(0x2b8)]()+_0x3c0330(0x2aa)+_0x30c5f2[_0x3c0330(0x2b8)]());}else{if(_0x552ba2&&_0x552ba2['startsWith'](_0x3c0330(0x2b3))){const _0x178b0f=_0x552ba2[_0x3c0330(0x23b)](_0x3c0330(0x2b3),'')[_0x3c0330(0x297)]('_');if(_0x178b0f[_0x3c0330(0x2b7)]===0x2){const _0x512841=new Date(_0x178b0f[0x0]),_0x5a79a8=new Date(_0x178b0f[0x1]);_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x512841[_0x3c0330(0x26a)](),_0x512841['getUTCMonth'](),_0x512841[_0x3c0330(0x20e)](),0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x5a79a8['getUTCFullYear'](),_0x5a79a8[_0x3c0330(0x1ff)](),_0x5a79a8[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7)),console[_0x3c0330(0x283)](_0x3c0330(0x284)+_0x287338[_0x3c0330(0x2b8)]()+_0x3c0330(0x2aa)+_0x30c5f2[_0x3c0330(0x2b8)]());}else{const _0x328249=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),_0x1fa678[_0x3c0330(0x20e)]()-0x1e));_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x328249[_0x3c0330(0x26a)](),_0x328249[_0x3c0330(0x1ff)](),_0x328249['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),_0x1fa678['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x124e5d=_0x552ba2||_0x3c0330(0x223);switch(_0x124e5d[_0x3c0330(0x2a4)]()){case'today':_0x287338=new Date(Date['UTC'](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),_0x1fa678[_0x3c0330(0x20e)](),0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),_0x1fa678[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3c0330(0x21b):const _0x3ebb9c=new Date(_0x1fa678);_0x3ebb9c[_0x3c0330(0x225)](_0x3ebb9c[_0x3c0330(0x20e)]()-0x1),_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x3ebb9c['getUTCFullYear'](),_0x3ebb9c[_0x3c0330(0x1ff)](),_0x3ebb9c[_0x3c0330(0x20e)](),0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x3ebb9c[_0x3c0330(0x26a)](),_0x3ebb9c[_0x3c0330(0x1ff)](),_0x3ebb9c[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3c0330(0x20b):const _0x3c7201=_0x1fa678['getUTCDay'](),_0x2d60ca=_0x3c7201===0x0?-0x6:0x1-_0x3c7201,_0x3a83f9=_0x1fa678[_0x3c0330(0x20e)]()+_0x2d60ca;_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),_0x3a83f9,0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678['getUTCMonth'](),_0x1fa678[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3c0330(0x25c):const _0x19f287=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),_0x1fa678[_0x3c0330(0x20e)]()-0x7)),_0x46493e=_0x19f287[_0x3c0330(0x249)](),_0x95653d=_0x46493e===0x0?-0x6:0x1-_0x46493e,_0x5da9b3=_0x19f287['getUTCDate']()+_0x95653d;_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x19f287['getUTCFullYear'](),_0x19f287['getUTCMonth'](),_0x5da9b3,0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date['UTC'](_0x19f287['getUTCFullYear'](),_0x19f287[_0x3c0330(0x1ff)](),_0x5da9b3+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x3c0330(0x223):_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678['getUTCFullYear'](),_0x1fa678['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678['getUTCFullYear'](),_0x1fa678['getUTCMonth'](),_0x1fa678[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678['getUTCFullYear'](),_0x1fa678['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x3c0330(0x28c):_0x287338=new Date(Date[_0x3c0330(0x2b1)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678['getUTCFullYear'](),_0x1fa678[_0x3c0330(0x1ff)](),_0x1fa678[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x287338=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678[_0x3c0330(0x1ff)](),0x1,0x0,0x0,0x0,0x0)),_0x30c5f2=new Date(Date[_0x3c0330(0x2b1)](_0x1fa678[_0x3c0330(0x26a)](),_0x1fa678['getUTCMonth'](),_0x1fa678[_0x3c0330(0x20e)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x3c0330(0x283)](_0x3c0330(0x25a)+_0x287338[_0x3c0330(0x2b8)]()+_0x3c0330(0x2aa)+_0x30c5f2[_0x3c0330(0x2b8)]());const _0x260a0c={'gte':_0x287338,'lte':_0x30c5f2},[_0x8c0c30,_0x1e5bc0,_0x459e37,_0x4e6b44,_0x49209d,_0x29f14f,_0x378da3,_0x365b28,_0x15d170,_0x491512,_0xc0d983]=await Promise[_0x3c0330(0x274)]([database_1[_0x3c0330(0x1ee)][_0x3c0330(0x2a5)][_0x3c0330(0x2ab)]({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)},'status':{'notIn':[_0x3c0330(0x1f3),'EXPIRED']},'createdAt':_0x260a0c}}),database_1[_0x3c0330(0x1ee)][_0x3c0330(0x2a5)][_0x3c0330(0x2ab)]({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)},'status':_0x3c0330(0x26e),'createdAt':_0x260a0c}}),database_1[_0x3c0330(0x1ee)]['payment'][_0x3c0330(0x2ab)]({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)},'status':_0x3c0330(0x1f9)}}),database_1[_0x3c0330(0x1ee)]['payment']['count']({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)},'status':_0x3c0330(0x22d)}}),database_1['default'][_0x3c0330(0x2a5)][_0x3c0330(0x2af)]({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)},'status':_0x3c0330(0x26e),'createdAt':_0x260a0c},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x3c0330(0x1ee)][_0x3c0330(0x2a5)]['findMany']({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)}},'take':0x4,'orderBy':{'createdAt':_0x3c0330(0x224)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3c0330(0x1ee)][_0x3c0330(0x2a5)][_0x3c0330(0x2af)]({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)},'createdAt':_0x260a0c},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3c0330(0x20c)}}),database_1[_0x3c0330(0x1ee)][_0x3c0330(0x2a5)][_0x3c0330(0x2ab)]({'where':{'shopId':_0x3656e1,'gateway':{'not':'test_gateway'},'status':_0x3c0330(0x26e)}}),database_1[_0x3c0330(0x1ee)][_0x3c0330(0x2a5)][_0x3c0330(0x2af)]({'where':{'shopId':_0x3656e1,'gateway':{'not':_0x3c0330(0x1f7)},'status':'PAID'},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x3c0330(0x1ee)]['shop'][_0x3c0330(0x266)]({'where':{'id':_0x3656e1},'select':{'balance':!![]}}),database_1['default'][_0x3c0330(0x2a5)][_0x3c0330(0x2af)]({'where':{'shopId':_0x3656e1,'gateway':{'not':'test_gateway'}},'select':{'gateway':!![]}})]),_0x1ab151={};for(const _0x46ec1a of _0xc0d983){_0x46ec1a[_0x3c0330(0x227)]&&(_0x1ab151[_0x46ec1a['gateway']]=(_0x1ab151[_0x46ec1a[_0x3c0330(0x227)]]||0x0)+0x1);}console[_0x3c0330(0x283)](_0x3c0330(0x2a9),_0x1ab151);let _0x14458a=0x0,_0x5e7976=0x0;for(const _0x219208 of _0x49209d){if(_0x219208[_0x3c0330(0x243)])_0x14458a+=_0x219208['amountUSDT'];else{const _0x29086a=await currencyService_1[_0x3c0330(0x29e)]['convertToUSDT'](_0x219208[_0x3c0330(0x210)],_0x219208[_0x3c0330(0x254)]);_0x14458a+=_0x29086a;}_0x219208[_0x3c0330(0x298)]&&(_0x5e7976+=_0x219208[_0x3c0330(0x298)]);}let _0x2797c3=0x0;for(const _0x15730a of _0x15d170){_0x15730a[_0x3c0330(0x298)]&&(_0x2797c3+=_0x15730a['amountAfterGatewayCommissionUSDT']);}const _0x18e75e=this[_0x3c0330(0x258)](_0x378da3,_0x287338,_0x30c5f2||_0x1fa678),_0x5264b4=_0x8c0c30>0x0?_0x1e5bc0/_0x8c0c30*0x64:0x0,_0x31aedb=_0x365b28>0x0?_0x459e37/_0x365b28*0x64:0x0;return{'totalPayments':_0x8c0c30,'successfulPayments':_0x1e5bc0,'totalRevenue':Math[_0x3c0330(0x2c9)](_0x14458a*0x64)/0x64,'merchantEarnings':Math[_0x3c0330(0x2c9)](_0x5e7976*0x64)/0x64,'merchantTotalRevenue':Math[_0x3c0330(0x2c9)](_0x2797c3*0x64)/0x64,'payoutBalance':Math[_0x3c0330(0x2c9)]((_0x491512?.[_0x3c0330(0x220)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x5264b4*0x64)/0x64,'chargebackRate':Math[_0x3c0330(0x2c9)](_0x31aedb*0x64)/0x64,'chargebacks':_0x459e37,'refunds':_0x4e6b44,'paymentsByGateway':_0x1ab151,'dailyRevenue':_0x18e75e[_0x3c0330(0x28e)],'dailyPayments':_0x18e75e[_0x3c0330(0x2b2)],'recentPayments':_0x29f14f[_0x3c0330(0x219)](_0x759cde=>({'id':_0x759cde['id'],'gateway':_0x759cde[_0x3c0330(0x227)],'amount':_0x759cde['amount'],'currency':_0x759cde[_0x3c0330(0x254)],'status':_0x759cde[_0x3c0330(0x2ae)],'createdAt':_0x759cde[_0x3c0330(0x2bf)]}))};}[a86_0x594cdf(0x258)](_0x320ded,_0x4d9fb1,_0xae833b){const _0x13fc30=a86_0x594cdf,_0x2446b6=new Map(),_0x34910c=new Date(_0x4d9fb1);while(_0x34910c<=_0xae833b){const _0x1bd22d=_0x34910c[_0x13fc30(0x2b8)]()[_0x13fc30(0x297)]('T')[0x0];_0x2446b6[_0x13fc30(0x2ce)](_0x1bd22d,{'revenue':0x0,'count':0x0}),_0x34910c[_0x13fc30(0x265)](_0x34910c[_0x13fc30(0x2cc)]()+0x1);}for(const _0x276748 of _0x320ded){const _0x2eab1f=_0x276748[_0x13fc30(0x2bf)]['toISOString']()['split']('T')[0x0],_0x1953f6=_0x2446b6[_0x13fc30(0x2c5)](_0x2eab1f);_0x1953f6&&(_0x1953f6[_0x13fc30(0x2ab)]+=0x1,_0x276748[_0x13fc30(0x2ae)]===_0x13fc30(0x26e)&&_0x276748['amountUSDT']&&(_0x1953f6[_0x13fc30(0x2ac)]+=_0x276748[_0x13fc30(0x243)]));}const _0x4aa6c5=[],_0xef567b=[];for(const [_0x3b1df5,_0x281173]of _0x2446b6){_0x4aa6c5['push']({'date':_0x3b1df5,'amount':Math[_0x13fc30(0x2c9)](_0x281173[_0x13fc30(0x2ac)]*0x64)/0x64}),_0xef567b[_0x13fc30(0x2b0)]({'date':_0x3b1df5,'count':_0x281173['count']});}return{'dailyRevenue':_0x4aa6c5,'dailyPayments':_0xef567b};}[a86_0x594cdf(0x215)](_0x3c6bd7=0x8){const _0x3d7a85=a86_0x594cdf,_0x444ee7=[];for(let _0x3e5696=0x0;_0x3e5696<_0x3c6bd7;_0x3e5696++){const _0x7464df=crypto_1[_0x3d7a85(0x1ee)]['randomBytes'](0x4)[_0x3d7a85(0x28d)]('hex')['toUpperCase']();_0x444ee7[_0x3d7a85(0x2b0)](_0x7464df);}return _0x444ee7;}async[a86_0x594cdf(0x236)](_0x271837){const _0x34202d=a86_0x594cdf,_0xcdb319=await database_1[_0x34202d(0x1ee)][_0x34202d(0x250)]['findUnique']({'where':{'id':_0x271837},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0xcdb319)throw new Error(_0x34202d(0x2c8));const _0x451601=speakeasy_1[_0x34202d(0x1ee)][_0x34202d(0x21a)]({'name':_0x34202d(0x27a)+_0xcdb319[_0x34202d(0x241)]+')','issuer':_0x34202d(0x24d),'length':0x20}),_0x1921c=await qrcode_1[_0x34202d(0x1ee)][_0x34202d(0x239)](_0x451601[_0x34202d(0x206)]),_0x153d54=this[_0x34202d(0x215)](0x8),_0x58211f=await Promise['all'](_0x153d54[_0x34202d(0x219)](_0x2e1fc9=>bcryptjs_1['default']['hash'](_0x2e1fc9,0xa)));return await database_1[_0x34202d(0x1ee)][_0x34202d(0x250)][_0x34202d(0x23e)]({'where':{'id':_0x271837},'data':{'twoFactorSecret':_0x451601[_0x34202d(0x217)],'backupCodes':JSON[_0x34202d(0x242)](_0x58211f)}}),console[_0x34202d(0x283)](_0x34202d(0x2a2)+_0xcdb319[_0x34202d(0x241)]),console[_0x34202d(0x283)](_0x34202d(0x1f2)+_0x153d54[_0x34202d(0x2b7)]+_0x34202d(0x2c3)),{'secret':_0x451601[_0x34202d(0x217)],'qrCode':_0x1921c,'manualEntryKey':_0x451601[_0x34202d(0x217)],'backupCodes':_0x153d54};}async['enable2FA'](_0x5ac00a,_0x50923e){const _0x2dca66=a86_0x594cdf,_0x50243f=await database_1[_0x2dca66(0x1ee)][_0x2dca66(0x250)][_0x2dca66(0x266)]({'where':{'id':_0x5ac00a},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x50243f)throw new Error(_0x2dca66(0x2c8));if(!_0x50243f['twoFactorSecret'])throw new Error(_0x2dca66(0x1ef));if(_0x50243f['twoFactorEnabled'])throw new Error(_0x2dca66(0x24c));const _0x24f99e=speakeasy_1[_0x2dca66(0x1ee)]['totp'][_0x2dca66(0x21e)]({'secret':_0x50243f[_0x2dca66(0x2a7)],'encoding':_0x2dca66(0x217),'token':_0x50923e,'window':0x2});if(!_0x24f99e)throw new Error(_0x2dca66(0x2ad));return await database_1[_0x2dca66(0x1ee)]['shop'][_0x2dca66(0x23e)]({'where':{'id':_0x5ac00a},'data':{'twoFactorEnabled':!![]}}),console[_0x2dca66(0x283)](_0x2dca66(0x229)+_0x50243f['username']),{'enabled':!![]};}async[a86_0x594cdf(0x27e)](_0x3cb71e){const _0x51afdf=a86_0x594cdf,_0x1be6a8=await database_1[_0x51afdf(0x1ee)][_0x51afdf(0x250)]['findUnique']({'where':{'id':_0x3cb71e},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x1be6a8)throw new Error(_0x51afdf(0x2c8));await database_1[_0x51afdf(0x1ee)]['shop'][_0x51afdf(0x23e)]({'where':{'id':_0x3cb71e},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x51afdf(0x283)](_0x51afdf(0x2cb)+_0x1be6a8[_0x51afdf(0x241)]);}}function a86_0x55a2(){const _0x766b90=['merchantUrl3','\x20USDT','getStatistics','CoinToPay','default','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','defineProperty','error','üîë\x20Generated\x20','PENDING','POST','isArray','publicKey','test_gateway','343282WnGsvi','CHARGEBACK','getShopProfile','\x20USDT\x20(total\x20payouts)','üí∞\x20Getting\x20payouts\x20with\x20filters:','updatePayment','getWebhookLogs','getUTCMonth','totp','14892310zYIHze','totalPaidOut','crypto','lte','\x20\x20\x20üíµ\x20Available\x20balance:\x20','otpauth_url','getMonth','parse','shopUrl2','\x20USDT\x20(current\x20balance)','this_week','asc','usdcErcWallet','getUTCDate','usdtPolygonWallet','amount','Error\x20parsing\x20webhook\x20events:','erc20','USDT\x20BSC','gatewaySettings','generateBackupCodes','findFirst','base32','PaymentService','map','generateSecret','yesterday','usdcPolygonWallet','redirectUrl','verify','fullName','balance','isActive','sha256','this_month','desc','setUTCDate','compare','gateway','Payment\x20not\x20found','üîê\x202FA\x20enabled\x20for\x20shop:\x20','_sum','customerEmail','REJECTED','REFUND','test','üìä\x20Status\x20filter:\x20','hex','Payment\x20System/1.0\x20(Test)','reduce','90d','bcryptjs','availableBalance','setup2FA','getShopPayoutStats','Test\x20Gateway','toDataURL','merchantUrl2','replace','settings','getPayoutStats','update','üìä\x20Shop\x20','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','username','stringify','amountUSDT','üìÖ\x20Custom\x20date\x20range:\x20','2294295OgRmNp','USDT\x20TRC20','txid','toUpperCase','getUTCDay','Noda','getPaymentByShopAndId','2FA\x20is\x20already\x20enabled','TrapaPay','test_payment_123','1809GnZQdT','shop','üìä\x20Final\x20WHERE\x20conditions:','ShopService','payout','currency','YESTERDAY','280abjisI','formatNetworkName','generateDailyStatistics','network','üìÖ\x20Final\x20date\x20range:\x20','event','last_week','notes','paidAt','merchantUrl','paymentGateways','üåê\x20Method\x20filter:\x20','./currencyService','USDC\x20Ethereum','webhookLog','setDate','findUnique','USDT\x20ERC20','usdtErcWallet','customerName','getUTCFullYear','periodFrom','KLYME\x20DE','secretKey','PAID','gateways','shopUrl4','26028qQrKpf','createHmac','webhookUrl','all','periodTo','COMPLETED','Rapyd','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','wallets','TrapaPay\x20(','usdtTrcWallet','üìÖ\x20Date\x20start:\x20','768684cgIltV','disable2FA','setHours','getFullYear','Plisio','...','log','üìÖ\x20Custom\x20period:\x20','USDT\x20Polygon','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20',',\x20period:\x20','paymentId','Invalid\x202FA\x20token\x20or\x20backup\x20code','webhookEvents','erc20_usdc','all_time','toString','dailyRevenue','updateShopProfile','\x20payout\x20statistics\x20calculated:','shopId','language','getPayments','twoFactorToken','üìä\x20Getting\x20statistics\x20for\x20shop\x20','getTime','split','amountAfterGatewayCommissionUSDT','USDC\x20Polygon','getGatewayDisplayName','No\x20webhook\x20URL\x20configured','merchantUrl4','4ORfLxT','currencyService','telegramId','filter','twoFactorEnabled','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','Failed\x20to\x20send\x20webhook:\x20','toLowerCase','payment','paymentService','twoFactorSecret','shopUrl3','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','\x20to\x20','count','revenue','Invalid\x202FA\x20token','status','findMany','push','UTC','dailyPayments','custom_','shopUrl','__esModule','updateWallets','length','toISOString','AVAILABLE_GATEWAYS','../types/gateway','name','KLYME\x20EU','deletePayment','21592bQFVZL','createdAt','../config/database','telegram','\x20\x20\x20üìÖ\x20This\x20month:\x20','\x20backup\x20codes','üìÖ\x20Date\x20end:\x20','get','getPayoutById','ceil','Shop\x20not\x20found','round','includes','üîê\x202FA\x20disabled\x20for\x20shop:\x20','getDate','./paymentService','set','3974600tQsrvB','getPayouts','testWebhook','backupCodes'];a86_0x55a2=function(){return _0x766b90;};return a86_0x55a2();}exports[a86_0x594cdf(0x252)]=ShopService;