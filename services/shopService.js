'use strict';function a56_0x225c(_0x5def42,_0x195273){const _0x1a8068=a56_0x1a80();return a56_0x225c=function(_0x225c89,_0x14ad96){_0x225c89=_0x225c89-0x109;let _0x563d1f=_0x1a8068[_0x225c89];return _0x563d1f;},a56_0x225c(_0x5def42,_0x195273);}const a56_0x2d56f1=a56_0x225c;(function(_0x4a0ee8,_0x52cb15){const _0x3ead1d=a56_0x225c,_0x4982f5=_0x4a0ee8();while(!![]){try{const _0x5b59ba=-parseInt(_0x3ead1d(0x10a))/0x1*(-parseInt(_0x3ead1d(0x162))/0x2)+-parseInt(_0x3ead1d(0x144))/0x3*(parseInt(_0x3ead1d(0x190))/0x4)+parseInt(_0x3ead1d(0x167))/0x5+-parseInt(_0x3ead1d(0x153))/0x6*(parseInt(_0x3ead1d(0x199))/0x7)+parseInt(_0x3ead1d(0x1a5))/0x8+-parseInt(_0x3ead1d(0x1ab))/0x9+parseInt(_0x3ead1d(0x13d))/0xa*(-parseInt(_0x3ead1d(0x12d))/0xb);if(_0x5b59ba===_0x52cb15)break;else _0x4982f5['push'](_0x4982f5['shift']());}catch(_0x963b86){_0x4982f5['push'](_0x4982f5['shift']());}}}(a56_0x1a80,0xb56ea));var __importDefault=this&&this[a56_0x2d56f1(0x10e)]||function(_0x41aeac){return _0x41aeac&&_0x41aeac['__esModule']?_0x41aeac:{'default':_0x41aeac};};function a56_0x1a80(){const _0x526af4=['getMonth','amountIsEditable','merchantUrl','paymentService','getShopPayoutStats','üìä\x20Final\x20WHERE\x20conditions:','createPayment','convertToUSDT','\x20\x20\x20üìÖ\x20This\x20month:\x20','dailyRevenue','üìÖ\x20Date\x20start:\x20','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','desc','telegram','txid','Noda','balance','__esModule','responseBody','getPayoutStatistics','shopUrl','gatewaySettings','./paymentService','network','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','paymentGateways','30d','amountUSDT','parse','5879828JWKZKn','gateway','toUpperCase','\x20\x20\x20üíµ\x20Available\x20balance:\x20','test','error','getPaymentsByShop','../config/database','status','655879CasrYY','usdtErcWallet','üìÖ\x20Period\x20start:\x20','test_order_123','createPublicPayment','periodTo','üåê\x20Network\x20filter:\x20','shop','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','\x20USDT','getFullYear','split','8156608jwdads','POST','fullName','createdAt','...','wallets','3234564XkHSKa','Shop\x20not\x20found','CoinToPay','polygon','generateDailyStatistics','currency','push','updatePayment','sourceCurrency','event','PENDING','COMPLETED','PAID','REJECTED','log','\x20USDT\x20(current\x20balance)','üåê\x20Method\x20filter:\x20','263mxLXsI','paidAt','revenue','update','__importDefault','findUnique','application/json','getShopProfile','_sum','name','filter','Unknown\x20error','Failed\x20to\x20send\x20webhook:\x20','customer','username','usdtTrcWallet','all','map','usdcPolygonWallet','language','payout','getPayments','amount','publicKey','stringify','statusCode','default','findMany','expiresAt','webhookUrl','getTime','Webhook\x20returned\x20error:\x20','getPayoutStats','reduce','aggregate','6624585YWMbew','90d','USDT\x20Polygon','customerName','telegramId','test_gateway','delete','gateways','getDate','count','message','dailyPayments','Payment\x20not\x20found','round','customerEmail','Error\x20parsing\x20webhook\x20events:','10GpzgOu','üìä\x20Status\x20filter:\x20','üìä\x20Shop\x20','KLYME\x20DE','getStatistics','redirectUrl','asc','3wgGCLt','notes','toISOString','Test\x20webhook\x20sent\x20successfully\x20(','periodFrom','setHours','Rapyd','settings','paymentId','retryCount','erc20','üìÖ\x20Date\x20end:\x20','ceil','shopId','polygon_usdc','12VsIyhr','getPaymentById','payment','No\x20webhook\x20URL\x20configured','defineProperty','statusText','PaymentService','getPaymentByShopAndId','usage','test_payment_123','isArray','get','webhookEvents','KLYME\x20EU','./currencyService','8422YSDgQe','findFirst','set','getWebhookLogs','webhookLog','6175295uFRPts','USDT\x20BSC','trc20','getPayouts','Plisio','usdtPolygonWallet','TesSoft\x20Payment\x20System/1.0\x20(Test)','formatNetworkName','updateWallets','gte','paid','setDate'];a56_0x1a80=function(){return _0x526af4;};return a56_0x1a80();}Object[a56_0x2d56f1(0x157)](exports,a56_0x2d56f1(0x184),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require(a56_0x2d56f1(0x197))),currencyService_1=require(a56_0x2d56f1(0x161)),paymentService_1=require(a56_0x2d56f1(0x189));class ShopService{constructor(){const _0x976bbd=a56_0x2d56f1;this[_0x976bbd(0x176)]=new paymentService_1[(_0x976bbd(0x159))]();}async[a56_0x2d56f1(0x111)](_0x48ca8d){const _0xad06d8=a56_0x2d56f1,_0x3a5a39=await database_1[_0xad06d8(0x124)]['shop'][_0xad06d8(0x10f)]({'where':{'id':_0x48ca8d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x3a5a39)throw new Error(_0xad06d8(0x1ac));let _0x5ab36a=[];if(_0x3a5a39[_0xad06d8(0x14b)]?.[_0xad06d8(0x15f)])try{_0x5ab36a=Array[_0xad06d8(0x15d)](_0x3a5a39[_0xad06d8(0x14b)][_0xad06d8(0x15f)])?_0x3a5a39[_0xad06d8(0x14b)]['webhookEvents']:JSON[_0xad06d8(0x18f)](_0x3a5a39[_0xad06d8(0x14b)]['webhookEvents']);}catch(_0x4228cf){console[_0xad06d8(0x195)]('Error\x20parsing\x20webhook\x20events:',_0x4228cf),_0x5ab36a=[];}return{'id':_0x3a5a39['id'],'fullName':_0x3a5a39[_0xad06d8(0x113)],'username':_0x3a5a39[_0xad06d8(0x118)],'telegramId':_0x3a5a39[_0xad06d8(0x180)],'merchantUrl':_0x3a5a39[_0xad06d8(0x187)],'gateways':_0x3a5a39[_0xad06d8(0x18c)]?JSON[_0xad06d8(0x18f)](_0x3a5a39['paymentGateways']):null,'gatewaySettings':_0x3a5a39[_0xad06d8(0x188)]?JSON['parse'](_0x3a5a39['gatewaySettings']):null,'publicKey':_0x3a5a39[_0xad06d8(0x121)],'webhookUrl':_0x3a5a39['settings']?.[_0xad06d8(0x127)]||null,'webhookEvents':_0x5ab36a,'wallets':{'usdtPolygonWallet':_0x3a5a39['usdtPolygonWallet'],'usdtTrcWallet':_0x3a5a39[_0xad06d8(0x119)],'usdtErcWallet':_0x3a5a39[_0xad06d8(0x19a)],'usdcPolygonWallet':_0x3a5a39['usdcPolygonWallet']},'status':_0x3a5a39[_0xad06d8(0x198)],'createdAt':_0x3a5a39[_0xad06d8(0x1a8)]};}async['updateShopProfile'](_0x513ffc,_0x2ac10b){const _0x35096e=a56_0x2d56f1,_0x2dde2e={};_0x2ac10b[_0x35096e(0x1a7)]&&(_0x2dde2e[_0x35096e(0x113)]=_0x2ac10b[_0x35096e(0x1a7)]);_0x2ac10b[_0x35096e(0x131)]!==undefined&&(_0x2dde2e[_0x35096e(0x180)]=_0x2ac10b['telegramId']||null);_0x2ac10b['merchantUrl']&&(_0x2dde2e['shopUrl']=_0x2ac10b[_0x35096e(0x175)]);_0x2ac10b[_0x35096e(0x134)]&&(_0x2dde2e[_0x35096e(0x18c)]=JSON[_0x35096e(0x122)](_0x2ac10b[_0x35096e(0x134)]));_0x2ac10b[_0x35096e(0x188)]&&(_0x2dde2e[_0x35096e(0x188)]=JSON['stringify'](_0x2ac10b[_0x35096e(0x188)]));_0x2ac10b[_0x35096e(0x1aa)]&&(_0x2ac10b[_0x35096e(0x1aa)][_0x35096e(0x16c)]!==undefined&&(_0x2dde2e[_0x35096e(0x16c)]=_0x2ac10b['wallets'][_0x35096e(0x16c)]||null),_0x2ac10b['wallets'][_0x35096e(0x119)]!==undefined&&(_0x2dde2e['usdtTrcWallet']=_0x2ac10b[_0x35096e(0x1aa)][_0x35096e(0x119)]||null),_0x2ac10b[_0x35096e(0x1aa)][_0x35096e(0x19a)]!==undefined&&(_0x2dde2e[_0x35096e(0x19a)]=_0x2ac10b['wallets'][_0x35096e(0x19a)]||null),_0x2ac10b[_0x35096e(0x1aa)][_0x35096e(0x11c)]!==undefined&&(_0x2dde2e[_0x35096e(0x11c)]=_0x2ac10b[_0x35096e(0x1aa)][_0x35096e(0x11c)]||null));const _0x14d64a=await database_1['default'][_0x35096e(0x1a0)][_0x35096e(0x10d)]({'where':{'id':_0x513ffc},'data':_0x2dde2e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x54f9c5=[];if(_0x14d64a[_0x35096e(0x14b)]?.[_0x35096e(0x15f)])try{_0x54f9c5=Array[_0x35096e(0x15d)](_0x14d64a[_0x35096e(0x14b)][_0x35096e(0x15f)])?_0x14d64a[_0x35096e(0x14b)][_0x35096e(0x15f)]:JSON[_0x35096e(0x18f)](_0x14d64a['settings'][_0x35096e(0x15f)]);}catch(_0xe1e877){console[_0x35096e(0x195)](_0x35096e(0x13c),_0xe1e877),_0x54f9c5=[];}return{'id':_0x14d64a['id'],'fullName':_0x14d64a['name'],'username':_0x14d64a[_0x35096e(0x118)],'telegramId':_0x14d64a['telegram'],'merchantUrl':_0x14d64a['shopUrl'],'gateways':_0x14d64a[_0x35096e(0x18c)]?JSON[_0x35096e(0x18f)](_0x14d64a[_0x35096e(0x18c)]):null,'gatewaySettings':_0x14d64a[_0x35096e(0x188)]?JSON[_0x35096e(0x18f)](_0x14d64a[_0x35096e(0x188)]):null,'publicKey':_0x14d64a[_0x35096e(0x121)],'webhookUrl':_0x14d64a[_0x35096e(0x14b)]?.[_0x35096e(0x127)]||null,'webhookEvents':_0x54f9c5,'wallets':{'usdtPolygonWallet':_0x14d64a['usdtPolygonWallet'],'usdtTrcWallet':_0x14d64a[_0x35096e(0x119)],'usdtErcWallet':_0x14d64a[_0x35096e(0x19a)],'usdcPolygonWallet':_0x14d64a[_0x35096e(0x11c)]},'status':_0x14d64a[_0x35096e(0x198)],'createdAt':_0x14d64a[_0x35096e(0x1a8)]};}async[a56_0x2d56f1(0x16f)](_0x2291a5,_0x221da6){const _0x4fb6ae=a56_0x2d56f1,_0x420588={};_0x221da6[_0x4fb6ae(0x16c)]!==undefined&&(_0x420588[_0x4fb6ae(0x16c)]=_0x221da6[_0x4fb6ae(0x16c)]||null),_0x221da6[_0x4fb6ae(0x119)]!==undefined&&(_0x420588[_0x4fb6ae(0x119)]=_0x221da6[_0x4fb6ae(0x119)]||null),_0x221da6['usdtErcWallet']!==undefined&&(_0x420588[_0x4fb6ae(0x19a)]=_0x221da6[_0x4fb6ae(0x19a)]||null),_0x221da6['usdcPolygonWallet']!==undefined&&(_0x420588['usdcPolygonWallet']=_0x221da6[_0x4fb6ae(0x11c)]||null),await database_1['default'][_0x4fb6ae(0x1a0)][_0x4fb6ae(0x10d)]({'where':{'id':_0x2291a5},'data':_0x420588});}async['testWebhook'](_0x1f1257){const _0x285a9b=a56_0x2d56f1,_0x330792=await database_1[_0x285a9b(0x124)][_0x285a9b(0x1a0)][_0x285a9b(0x10f)]({'where':{'id':_0x1f1257},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x330792?.['settings']?.[_0x285a9b(0x127)])throw new Error(_0x285a9b(0x156));const _0x250807={'event':_0x285a9b(0x194),'payment':{'id':_0x285a9b(0x15c),'order_id':_0x285a9b(0x19c),'gateway':_0x285a9b(0x194),'amount':0x64,'currency':'USD','status':_0x285a9b(0x171),'created_at':new Date()[_0x285a9b(0x146)]()}};try{const _0x326575=await fetch(_0x330792['settings']['webhookUrl'],{'method':_0x285a9b(0x1a6),'headers':{'Content-Type':_0x285a9b(0x110),'User-Agent':_0x285a9b(0x16d)},'body':JSON[_0x285a9b(0x122)](_0x250807)});return _0x326575['ok']?{'success':!![],'message':_0x285a9b(0x147)+_0x326575['status']+')'}:{'success':![],'message':_0x285a9b(0x129)+_0x326575[_0x285a9b(0x198)]+'\x20'+_0x326575[_0x285a9b(0x158)]};}catch(_0xeb1729){return{'success':![],'message':_0x285a9b(0x116)+(_0xeb1729 instanceof Error?_0xeb1729[_0x285a9b(0x137)]:_0x285a9b(0x115))};}}async[a56_0x2d56f1(0x179)](_0x2f086d){const _0x33dd13=a56_0x2d56f1;return this['paymentService'][_0x33dd13(0x19d)]({'public_key':'','gateway':_0x2f086d['gateway'],'order_id':undefined,'amount':_0x2f086d['amount'],'currency':_0x2f086d['currency'],'source_currency':_0x2f086d[_0x33dd13(0x1b3)],'usage':_0x2f086d[_0x33dd13(0x15b)],'expires_at':_0x2f086d[_0x33dd13(0x126)]?.[_0x33dd13(0x146)](),'success_url':_0x2f086d[_0x33dd13(0x142)],'fail_url':_0x2f086d['redirectUrl'],'customer_email':_0x2f086d[_0x33dd13(0x13b)],'customer_name':_0x2f086d[_0x33dd13(0x130)],'country':_0x2f086d['country'],'language':_0x2f086d[_0x33dd13(0x11d)],'amount_is_editable':_0x2f086d[_0x33dd13(0x174)],'max_payments':_0x2f086d['maxPayments'],'customer':_0x2f086d[_0x33dd13(0x117)]});}async[a56_0x2d56f1(0x11f)](_0x2594ca,_0x40a702){const _0x1dfbce=a56_0x2d56f1;return this[_0x1dfbce(0x176)][_0x1dfbce(0x196)](_0x2594ca,_0x40a702);}async[a56_0x2d56f1(0x154)](_0x1326af,_0x25b78b){const _0x397f53=a56_0x2d56f1;return this[_0x397f53(0x176)][_0x397f53(0x15a)](_0x1326af,_0x25b78b);}async[a56_0x2d56f1(0x1b2)](_0x50932a,_0x4ea682,_0x417ce0){const _0x4be5ab=a56_0x2d56f1,_0x30ea32=await database_1[_0x4be5ab(0x124)][_0x4be5ab(0x155)]['findFirst']({'where':{'id':_0x4ea682,'shopId':_0x50932a}});if(!_0x30ea32)throw new Error(_0x4be5ab(0x139));const _0x3bc0c0=await database_1[_0x4be5ab(0x124)]['payment'][_0x4be5ab(0x10d)]({'where':{'id':_0x4ea682},'data':{..._0x417ce0,'updatedAt':new Date()}});return _0x3bc0c0;}async['deletePayment'](_0x471a75,_0x5ce707){const _0x585bdd=a56_0x2d56f1,_0x42135f=await database_1[_0x585bdd(0x124)][_0x585bdd(0x155)][_0x585bdd(0x163)]({'where':{'id':_0x5ce707,'shopId':_0x471a75}});if(!_0x42135f)throw new Error(_0x585bdd(0x139));await database_1['default'][_0x585bdd(0x155)][_0x585bdd(0x133)]({'where':{'id':_0x5ce707}});}[a56_0x2d56f1(0x16e)](_0x2568f3){const _0x5b6886=a56_0x2d56f1,_0x10ad90={'polygon':_0x5b6886(0x12f),'trc20':'USDT\x20TRC20','erc20':'USDT\x20ERC20','bsc':_0x5b6886(0x168),'polygon_usdc':'USDC\x20Polygon'};return _0x10ad90[_0x2568f3]||_0x2568f3;}async[a56_0x2d56f1(0x16a)](_0x4eccd3,_0x43a3ce){const _0x31d78a=a56_0x2d56f1,{page:_0x4c3dbf,limit:_0x531c3f,status:_0x3aaadd,method:_0x5ae12b,network:_0x3d0669,dateFrom:_0x31e708,dateTo:_0x4e4859,periodFrom:_0x23da9c,periodTo:_0x37dd71}=_0x43a3ce,_0x5a32eb=(_0x4c3dbf-0x1)*_0x531c3f;console[_0x31d78a(0x1b9)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x43a3ce);const _0x4549f8={'shopId':_0x4eccd3};_0x3aaadd&&(_0x4549f8[_0x31d78a(0x198)]=_0x3aaadd[_0x31d78a(0x192)](),console['log'](_0x31d78a(0x13e)+_0x3aaadd[_0x31d78a(0x192)]()));if(_0x5ae12b)_0x4549f8[_0x31d78a(0x18a)]=_0x5ae12b,console['log'](_0x31d78a(0x109)+_0x5ae12b);else _0x3d0669&&(_0x4549f8[_0x31d78a(0x18a)]=_0x3d0669,console['log'](_0x31d78a(0x19f)+_0x3d0669));if(_0x31e708||_0x4e4859||_0x23da9c||_0x37dd71){_0x4549f8['createdAt']={};if(_0x23da9c){const _0x1f189a=new Date(_0x23da9c);_0x1f189a['setHours'](0x0,0x0,0x0,0x0),_0x4549f8[_0x31d78a(0x1a8)][_0x31d78a(0x170)]=_0x1f189a,console[_0x31d78a(0x1b9)](_0x31d78a(0x19b)+_0x1f189a[_0x31d78a(0x146)]());}else{if(_0x31e708){const _0x46888e=new Date(_0x31e708);_0x46888e[_0x31d78a(0x149)](0x0,0x0,0x0,0x0),_0x4549f8['createdAt'][_0x31d78a(0x170)]=_0x46888e,console['log'](_0x31d78a(0x17d)+_0x46888e[_0x31d78a(0x146)]());}}if(_0x37dd71){const _0x1b0013=new Date(_0x37dd71);_0x1b0013[_0x31d78a(0x149)](0x17,0x3b,0x3b,0x3e7),_0x4549f8[_0x31d78a(0x1a8)]['lte']=_0x1b0013,console['log']('üìÖ\x20Period\x20end:\x20'+_0x1b0013['toISOString']());}else{if(_0x4e4859){const _0x507b3a=new Date(_0x4e4859);_0x507b3a[_0x31d78a(0x149)](0x17,0x3b,0x3b,0x3e7),_0x4549f8[_0x31d78a(0x1a8)]['lte']=_0x507b3a,console[_0x31d78a(0x1b9)](_0x31d78a(0x14f)+_0x507b3a[_0x31d78a(0x146)]());}}}console['log'](_0x31d78a(0x178),JSON[_0x31d78a(0x122)](_0x4549f8,null,0x2));const [_0x708f04,_0x37fbf9]=await Promise[_0x31d78a(0x11a)]([database_1['default'][_0x31d78a(0x11e)]['findMany']({'where':_0x4549f8,'skip':_0x5a32eb,'take':_0x531c3f,'orderBy':{'createdAt':_0x31d78a(0x17f)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x31d78a(0x11e)][_0x31d78a(0x136)]({'where':_0x4549f8})]);return{'payouts':_0x708f04[_0x31d78a(0x11b)](_0x460d84=>{const _0x3833ea=_0x31d78a;let _0x42093d=null;switch(_0x460d84[_0x3833ea(0x18a)]){case _0x3833ea(0x1ae):_0x42093d=_0x460d84[_0x3833ea(0x1a0)]['usdtPolygonWallet'];break;case _0x3833ea(0x169):_0x42093d=_0x460d84[_0x3833ea(0x1a0)][_0x3833ea(0x119)];break;case _0x3833ea(0x14e):_0x42093d=_0x460d84[_0x3833ea(0x1a0)][_0x3833ea(0x19a)];break;case _0x3833ea(0x152):_0x42093d=_0x460d84[_0x3833ea(0x1a0)][_0x3833ea(0x11c)];break;}return{'id':_0x460d84['id'],'amount':_0x460d84['amount'],'network':this['formatNetworkName'](_0x460d84[_0x3833ea(0x18a)]),'wallet':_0x42093d,'status':_0x460d84[_0x3833ea(0x198)],'txid':_0x460d84['txid'],'notes':_0x460d84[_0x3833ea(0x145)],'periodFrom':_0x460d84[_0x3833ea(0x148)],'periodTo':_0x460d84[_0x3833ea(0x19e)],'createdAt':_0x460d84[_0x3833ea(0x1a8)],'paidAt':_0x460d84[_0x3833ea(0x10b)]};}),'pagination':{'page':_0x4c3dbf,'limit':_0x531c3f,'total':_0x37fbf9,'totalPages':Math['ceil'](_0x37fbf9/_0x531c3f)}};}async['getPayoutById'](_0x41f5ee,_0x5e0fed){const _0x4ec47f=a56_0x2d56f1,_0x3ff496=await database_1[_0x4ec47f(0x124)]['payout'][_0x4ec47f(0x163)]({'where':{'id':_0x5e0fed,'shopId':_0x41f5ee}});if(!_0x3ff496)return null;return{'id':_0x3ff496['id'],'amount':_0x3ff496[_0x4ec47f(0x120)],'network':_0x3ff496[_0x4ec47f(0x18a)],'status':_0x3ff496[_0x4ec47f(0x198)],'txid':_0x3ff496[_0x4ec47f(0x181)],'notes':_0x3ff496['notes'],'createdAt':_0x3ff496[_0x4ec47f(0x1a8)],'paidAt':_0x3ff496[_0x4ec47f(0x10b)]};}async[a56_0x2d56f1(0x186)](_0x361e00,_0x20fa38){const _0x4f05ec=a56_0x2d56f1,_0x2a3293=new Date();let _0x189add;switch(_0x20fa38){case'7d':_0x189add=new Date(_0x2a3293[_0x4f05ec(0x128)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4f05ec(0x18d):_0x189add=new Date(_0x2a3293[_0x4f05ec(0x128)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x189add=new Date(_0x2a3293[_0x4f05ec(0x128)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x189add=new Date(_0x2a3293[_0x4f05ec(0x128)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x17a181,_0x2fe66a,_0x36a796,_0x475e18,_0x19fd37,_0x208b01]=await Promise[_0x4f05ec(0x11a)]([database_1[_0x4f05ec(0x124)][_0x4f05ec(0x11e)][_0x4f05ec(0x136)]({'where':{'shopId':_0x361e00,'createdAt':{'gte':_0x189add}}}),database_1['default'][_0x4f05ec(0x11e)][_0x4f05ec(0x136)]({'where':{'shopId':_0x361e00,'status':_0x4f05ec(0x1b6),'createdAt':{'gte':_0x189add}}}),database_1[_0x4f05ec(0x124)][_0x4f05ec(0x11e)][_0x4f05ec(0x136)]({'where':{'shopId':_0x361e00,'status':_0x4f05ec(0x1b5),'createdAt':{'gte':_0x189add}}}),database_1[_0x4f05ec(0x124)][_0x4f05ec(0x11e)][_0x4f05ec(0x136)]({'where':{'shopId':_0x361e00,'status':_0x4f05ec(0x1b8),'createdAt':{'gte':_0x189add}}}),database_1[_0x4f05ec(0x124)]['payout'][_0x4f05ec(0x125)]({'where':{'shopId':_0x361e00,'createdAt':{'gte':_0x189add}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x4f05ec(0x124)][_0x4f05ec(0x11e)][_0x4f05ec(0x125)]({'where':{'shopId':_0x361e00},'take':0xa,'orderBy':{'createdAt':_0x4f05ec(0x17f)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x6913ee=_0x19fd37[_0x4f05ec(0x12b)]((_0x3e2d6b,_0x1ad49e)=>_0x3e2d6b+_0x1ad49e[_0x4f05ec(0x120)],0x0),_0xcc645c=_0x19fd37[_0x4f05ec(0x114)](_0x30c038=>_0x30c038[_0x4f05ec(0x198)]==='COMPLETED')[_0x4f05ec(0x12b)]((_0x3c1d4f,_0x339b5f)=>_0x3c1d4f+_0x339b5f['amount'],0x0),_0x2a1378=_0x19fd37['filter'](_0x25b348=>_0x25b348[_0x4f05ec(0x198)]===_0x4f05ec(0x1b5))['reduce']((_0x28619b,_0x3479f1)=>_0x28619b+_0x3479f1[_0x4f05ec(0x120)],0x0),_0x191883=_0x19fd37[_0x4f05ec(0x12b)]((_0x45c109,_0x4b3804)=>{const _0x3b04b1=_0x4f05ec;return _0x45c109[_0x4b3804[_0x3b04b1(0x18a)]]=(_0x45c109[_0x4b3804[_0x3b04b1(0x18a)]]||0x0)+0x1,_0x45c109;},{}),_0x464083=_0x19fd37[_0x4f05ec(0x12b)]((_0x44015a,_0x1d21a0)=>{const _0x138dc1=_0x4f05ec;return _0x44015a[_0x1d21a0[_0x138dc1(0x198)]]=(_0x44015a[_0x1d21a0[_0x138dc1(0x198)]]||0x0)+0x1,_0x44015a;},{});return{'totalPayouts':_0x17a181,'completedPayouts':_0x2fe66a,'pendingPayouts':_0x36a796,'rejectedPayouts':_0x475e18,'totalAmount':_0x6913ee,'completedAmount':_0xcc645c,'pendingAmount':_0x2a1378,'payoutsByMethod':_0x191883,'payoutsByStatus':_0x464083,'recentPayouts':_0x208b01[_0x4f05ec(0x11b)](_0x587963=>({'id':_0x587963['id'],'shopId':_0x361e00,'amount':_0x587963['amount'],'method':_0x587963[_0x4f05ec(0x18a)],'status':_0x587963[_0x4f05ec(0x198)],'txid':_0x587963[_0x4f05ec(0x181)],'createdAt':_0x587963[_0x4f05ec(0x1a8)],'paidAt':_0x587963['paidAt']}))};}async[a56_0x2d56f1(0x177)](_0x163da2){const _0x2d1136=a56_0x2d56f1;console[_0x2d1136(0x1b9)](_0x2d1136(0x17e)+_0x163da2+_0x2d1136(0x1a9));const _0xd3e8f9=await database_1[_0x2d1136(0x124)][_0x2d1136(0x1a0)][_0x2d1136(0x10f)]({'where':{'id':_0x163da2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xd3e8f9)throw new Error(_0x2d1136(0x1ac));const _0x51120d=new Date(),_0x44d425=new Date(_0x51120d[_0x2d1136(0x1a3)](),_0x51120d[_0x2d1136(0x173)](),0x1),_0x45573b=new Date(_0x51120d[_0x2d1136(0x1a3)](),_0x51120d[_0x2d1136(0x173)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x22aaec=await database_1[_0x2d1136(0x124)]['payout'][_0x2d1136(0x12c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x163da2,'createdAt':{'gte':_0x44d425,'lte':_0x45573b},'status':'COMPLETED'}}),_0x325e5a=_0x22aaec[_0x2d1136(0x112)][_0x2d1136(0x120)]||0x0,_0x2fe764={'availableBalance':Math['round'](_0xd3e8f9[_0x2d1136(0x183)]*0x64)/0x64,'totalPaidOut':Math[_0x2d1136(0x13a)](_0xd3e8f9['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x2d1136(0x13a)](_0xd3e8f9['balance']*0x64)/0x64,'thisMonth':Math['round'](_0x325e5a*0x64)/0x64};return console['log'](_0x2d1136(0x13f)+_0xd3e8f9[_0x2d1136(0x118)]+'\x20payout\x20statistics\x20calculated:'),console['log'](_0x2d1136(0x193)+_0x2fe764['availableBalance']+_0x2d1136(0x1ba)),console[_0x2d1136(0x1b9)](_0x2d1136(0x18b)+_0x2fe764['totalPaidOut']+'\x20USDT\x20(total\x20payouts)'),console[_0x2d1136(0x1b9)](_0x2d1136(0x1a1)+_0x2fe764['awaitingPayout']+_0x2d1136(0x1ba)),console[_0x2d1136(0x1b9)](_0x2d1136(0x17b)+_0x2fe764['thisMonth']+_0x2d1136(0x1a2)),_0x2fe764;}['getGatewayDisplayName'](_0x575067){const _0x2b62d6=a56_0x2d56f1,_0x5de1a2={'test_gateway':'Test\x20Gateway','plisio':_0x2b62d6(0x16b),'rapyd':_0x2b62d6(0x14a),'noda':_0x2b62d6(0x182),'cointopay':_0x2b62d6(0x1ad),'klyme_eu':_0x2b62d6(0x160),'klyme_gb':'KLYME\x20GB','klyme_de':_0x2b62d6(0x140)};return _0x5de1a2[_0x575067]||_0x575067;}async[a56_0x2d56f1(0x12a)](_0x1c3212){return this['getShopPayoutStats'](_0x1c3212);}async[a56_0x2d56f1(0x165)](_0x45dabc,_0x327086){const _0x4f0091=a56_0x2d56f1,{page:_0x478f17,limit:_0x5c6dd0,paymentId:_0x3f7e4c}=_0x327086,_0x1c7e22=(_0x478f17-0x1)*_0x5c6dd0,_0x4bd2ea={'shopId':_0x45dabc};_0x3f7e4c&&(_0x4bd2ea['paymentId']=_0x3f7e4c);const [_0x5aded0,_0x199a86]=await Promise[_0x4f0091(0x11a)]([database_1[_0x4f0091(0x124)]['webhookLog'][_0x4f0091(0x125)]({'where':_0x4bd2ea,'skip':_0x1c7e22,'take':_0x5c6dd0,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x4f0091(0x124)][_0x4f0091(0x166)][_0x4f0091(0x136)]({'where':_0x4bd2ea})]);return{'logs':_0x5aded0['map'](_0x956d5a=>({'id':_0x956d5a['id'],'paymentId':_0x956d5a[_0x4f0091(0x14c)],'shopId':_0x956d5a[_0x4f0091(0x151)],'event':_0x956d5a[_0x4f0091(0x1b4)],'statusCode':_0x956d5a[_0x4f0091(0x123)],'retryCount':_0x956d5a[_0x4f0091(0x14d)],'responseBody':_0x956d5a[_0x4f0091(0x185)],'createdAt':_0x956d5a[_0x4f0091(0x1a8)],'payment':_0x956d5a[_0x4f0091(0x155)]})),'pagination':{'page':_0x478f17,'limit':_0x5c6dd0,'total':_0x199a86,'totalPages':Math[_0x4f0091(0x150)](_0x199a86/_0x5c6dd0)}};}async[a56_0x2d56f1(0x141)](_0x2c4b58,_0x46bf1b){const _0x4b7718=a56_0x2d56f1,_0x4255ef=new Date();let _0x1ca814;switch(_0x46bf1b){case'7d':_0x1ca814=new Date(_0x4255ef['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x1ca814=new Date(_0x4255ef[_0x4b7718(0x128)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4b7718(0x12e):_0x1ca814=new Date(_0x4255ef[_0x4b7718(0x128)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1ca814=new Date(_0x4255ef[_0x4b7718(0x128)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xdb224c,_0x447b2b,_0x14da6d,_0x34e63e,_0xc688d7]=await Promise[_0x4b7718(0x11a)]([database_1[_0x4b7718(0x124)][_0x4b7718(0x155)][_0x4b7718(0x136)]({'where':{'shopId':_0x2c4b58,'gateway':{'not':_0x4b7718(0x132)},'createdAt':{'gte':_0x1ca814}}}),database_1['default'][_0x4b7718(0x155)][_0x4b7718(0x136)]({'where':{'shopId':_0x2c4b58,'gateway':{'not':_0x4b7718(0x132)},'status':_0x4b7718(0x1b7),'createdAt':{'gte':_0x1ca814}}}),database_1[_0x4b7718(0x124)]['payment'][_0x4b7718(0x125)]({'where':{'shopId':_0x2c4b58,'gateway':{'not':_0x4b7718(0x132)},'status':'PAID','createdAt':{'gte':_0x1ca814}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x4b7718(0x124)][_0x4b7718(0x155)][_0x4b7718(0x125)]({'where':{'shopId':_0x2c4b58,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x4b7718(0x17f)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x4b7718(0x155)][_0x4b7718(0x125)]({'where':{'shopId':_0x2c4b58,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x1ca814}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4b7718(0x143)}})]);let _0x299327=0x0;for(const _0x31d734 of _0x14da6d){if(_0x31d734[_0x4b7718(0x18e)])_0x299327+=_0x31d734[_0x4b7718(0x18e)];else{const _0x509a6c=await currencyService_1['currencyService'][_0x4b7718(0x17a)](_0x31d734['amount'],_0x31d734[_0x4b7718(0x1b0)]);_0x299327+=_0x509a6c;}}const _0xe04a51=this[_0x4b7718(0x1af)](_0xc688d7,_0x1ca814,_0x4255ef),_0xbbc13d=_0xdb224c>0x0?_0x447b2b/_0xdb224c*0x64:0x0;return{'totalPayments':_0xdb224c,'successfulPayments':_0x447b2b,'totalRevenue':Math[_0x4b7718(0x13a)](_0x299327*0x64)/0x64,'conversionRate':Math['round'](_0xbbc13d*0x64)/0x64,'dailyRevenue':_0xe04a51[_0x4b7718(0x17c)],'dailyPayments':_0xe04a51[_0x4b7718(0x138)],'recentPayments':_0x34e63e['map'](_0x2bc431=>({'id':_0x2bc431['id'],'gateway':_0x2bc431[_0x4b7718(0x191)],'amount':_0x2bc431[_0x4b7718(0x120)],'currency':_0x2bc431['currency'],'status':_0x2bc431[_0x4b7718(0x198)],'createdAt':_0x2bc431[_0x4b7718(0x1a8)]}))};}[a56_0x2d56f1(0x1af)](_0x3e666b,_0xec556a,_0x253532){const _0x267748=a56_0x2d56f1,_0xe7e27d=new Map(),_0x50d669=new Date(_0xec556a);while(_0x50d669<=_0x253532){const _0x5a4e33=_0x50d669['toISOString']()[_0x267748(0x1a4)]('T')[0x0];_0xe7e27d[_0x267748(0x164)](_0x5a4e33,{'revenue':0x0,'count':0x0}),_0x50d669[_0x267748(0x172)](_0x50d669[_0x267748(0x135)]()+0x1);}for(const _0x38350d of _0x3e666b){const _0x5a9cc6=_0x38350d['createdAt'][_0x267748(0x146)]()[_0x267748(0x1a4)]('T')[0x0],_0x52e338=_0xe7e27d[_0x267748(0x15e)](_0x5a9cc6);_0x52e338&&(_0x52e338[_0x267748(0x136)]+=0x1,_0x38350d[_0x267748(0x198)]===_0x267748(0x1b7)&&_0x38350d[_0x267748(0x18e)]&&(_0x52e338[_0x267748(0x10c)]+=_0x38350d[_0x267748(0x18e)]));}const _0x47e2c3=[],_0x5df42f=[];for(const [_0x49dc09,_0x3013d2]of _0xe7e27d){_0x47e2c3[_0x267748(0x1b1)]({'date':_0x49dc09,'amount':Math[_0x267748(0x13a)](_0x3013d2['revenue']*0x64)/0x64}),_0x5df42f['push']({'date':_0x49dc09,'count':_0x3013d2[_0x267748(0x136)]});}return{'dailyRevenue':_0x47e2c3,'dailyPayments':_0x5df42f};}}exports['ShopService']=ShopService;