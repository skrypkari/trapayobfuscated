'use strict';const a82_0x5eb819=a82_0x2b2e;(function(_0x510564,_0x17f86b){const _0x327f0f=a82_0x2b2e,_0x21670b=_0x510564();while(!![]){try{const _0x26bec6=parseInt(_0x327f0f(0xd9))/0x1*(-parseInt(_0x327f0f(0xe0))/0x2)+parseInt(_0x327f0f(0x116))/0x3*(-parseInt(_0x327f0f(0x155))/0x4)+-parseInt(_0x327f0f(0x162))/0x5+-parseInt(_0x327f0f(0xea))/0x6*(-parseInt(_0x327f0f(0x10e))/0x7)+parseInt(_0x327f0f(0xb9))/0x8+-parseInt(_0x327f0f(0x160))/0x9*(parseInt(_0x327f0f(0xef))/0xa)+parseInt(_0x327f0f(0x161))/0xb;if(_0x26bec6===_0x17f86b)break;else _0x21670b['push'](_0x21670b['shift']());}catch(_0x334063){_0x21670b['push'](_0x21670b['shift']());}}}(a82_0x2073,0xe43b7));var __importDefault=this&&this[a82_0x5eb819(0x169)]||function(_0x2a7dba){const _0x22f426=a82_0x5eb819;return _0x2a7dba&&_0x2a7dba[_0x22f426(0xcd)]?_0x2a7dba:{'default':_0x2a7dba};};Object[a82_0x5eb819(0xf1)](exports,'__esModule',{'value':!![]}),exports[a82_0x5eb819(0xc0)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a82_0x5eb819(0xa4))),crypto_1=__importDefault(require(a82_0x5eb819(0x141))),speakeasy_1=__importDefault(require(a82_0x5eb819(0x15a))),qrcode_1=__importDefault(require(a82_0x5eb819(0x13c))),currencyService_1=require(a82_0x5eb819(0x176)),paymentService_1=require('./paymentService'),gateway_1=require(a82_0x5eb819(0x180));class ShopService{constructor(){const _0x4b7f1a=a82_0x5eb819;this[_0x4b7f1a(0xd2)]=new paymentService_1['PaymentService']();}async[a82_0x5eb819(0x14d)](_0x535787){const _0x5c7266=a82_0x5eb819,_0x20fe0e=await database_1[_0x5c7266(0xd1)][_0x5c7266(0x122)][_0x5c7266(0x112)]({'where':{'id':_0x535787},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x20fe0e)throw new Error(_0x5c7266(0xaf));let _0x2adb34=[];if(_0x20fe0e[_0x5c7266(0x189)]?.['webhookEvents'])try{_0x2adb34=Array[_0x5c7266(0xd6)](_0x20fe0e['settings'][_0x5c7266(0x108)])?_0x20fe0e[_0x5c7266(0x189)][_0x5c7266(0x108)]:JSON[_0x5c7266(0x11f)](_0x20fe0e[_0x5c7266(0x189)][_0x5c7266(0x108)]);}catch(_0x2923a4){console[_0x5c7266(0xb5)](_0x5c7266(0x163),_0x2923a4),_0x2adb34=[];}const _0x495eac=gateway_1[_0x5c7266(0x167)][_0x5c7266(0xca)](_0xbae70a=>_0xbae70a[_0x5c7266(0x147)])[_0x5c7266(0xd5)](_0xe2a371=>_0xe2a371[_0x5c7266(0x173)]);let _0xb7689b=_0x20fe0e[_0x5c7266(0xad)]?JSON[_0x5c7266(0x11f)](_0x20fe0e['paymentGateways']):[];return Array[_0x5c7266(0xd6)](_0xb7689b)&&(_0xb7689b=_0xb7689b['map'](_0x14a401=>_0x14a401['replace'](/\s+/g,'_')[_0x5c7266(0xbd)]())['filter'](_0x1b9014=>_0x495eac[_0x5c7266(0x140)](_0x1b9014))),{'id':_0x20fe0e['id'],'fullName':_0x20fe0e[_0x5c7266(0x173)],'username':_0x20fe0e[_0x5c7266(0x164)],'telegramId':_0x20fe0e[_0x5c7266(0xeb)],'merchantUrl':_0x20fe0e[_0x5c7266(0xd0)],'gateways':_0xb7689b,'gatewaySettings':_0x20fe0e[_0x5c7266(0xfd)]?JSON['parse'](_0x20fe0e['gatewaySettings']):null,'publicKey':_0x20fe0e[_0x5c7266(0x13a)],'secretKey':_0x20fe0e['secretKey'],'webhookUrl':_0x20fe0e[_0x5c7266(0x189)]?.[_0x5c7266(0xed)]||null,'webhookEvents':_0x2adb34,'wallets':{'usdtPolygonWallet':_0x20fe0e[_0x5c7266(0x10f)],'usdtTrcWallet':_0x20fe0e[_0x5c7266(0xe2)],'usdtErcWallet':_0x20fe0e[_0x5c7266(0x188)],'usdcPolygonWallet':_0x20fe0e[_0x5c7266(0x172)],'usdcErcWallet':_0x20fe0e['usdcErcWallet']},'status':_0x20fe0e[_0x5c7266(0x18d)],'createdAt':_0x20fe0e[_0x5c7266(0x187)]};}async['updateShopProfile'](_0x1a3994,_0x1c4f4e){const _0x110778=a82_0x5eb819,_0x39baba={};_0x1c4f4e['fullName']&&(_0x39baba[_0x110778(0x173)]=_0x1c4f4e[_0x110778(0xa2)]);_0x1c4f4e['telegramId']!==undefined&&(_0x39baba[_0x110778(0xeb)]=_0x1c4f4e[_0x110778(0x121)]||null);_0x1c4f4e[_0x110778(0x158)]&&(_0x39baba[_0x110778(0xd0)]=_0x1c4f4e[_0x110778(0x158)]);_0x1c4f4e[_0x110778(0xa0)]&&(_0x39baba[_0x110778(0xad)]=JSON[_0x110778(0x109)](_0x1c4f4e[_0x110778(0xa0)]));_0x1c4f4e[_0x110778(0xfd)]&&(_0x39baba[_0x110778(0xfd)]=JSON['stringify'](_0x1c4f4e[_0x110778(0xfd)]));_0x1c4f4e[_0x110778(0x138)]&&(_0x1c4f4e[_0x110778(0x138)][_0x110778(0x10f)]!==undefined&&(_0x39baba[_0x110778(0x10f)]=_0x1c4f4e['wallets']['usdtPolygonWallet']||null),_0x1c4f4e[_0x110778(0x138)][_0x110778(0xe2)]!==undefined&&(_0x39baba['usdtTrcWallet']=_0x1c4f4e['wallets'][_0x110778(0xe2)]||null),_0x1c4f4e[_0x110778(0x138)]['usdtErcWallet']!==undefined&&(_0x39baba[_0x110778(0x188)]=_0x1c4f4e[_0x110778(0x138)][_0x110778(0x188)]||null),_0x1c4f4e[_0x110778(0x138)]['usdcPolygonWallet']!==undefined&&(_0x39baba['usdcPolygonWallet']=_0x1c4f4e[_0x110778(0x138)]['usdcPolygonWallet']||null));const _0x589646=await database_1[_0x110778(0xd1)][_0x110778(0x122)][_0x110778(0x12b)]({'where':{'id':_0x1a3994},'data':_0x39baba,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x208e93=[];if(_0x589646[_0x110778(0x189)]?.[_0x110778(0x108)])try{_0x208e93=Array[_0x110778(0xd6)](_0x589646['settings'][_0x110778(0x108)])?_0x589646[_0x110778(0x189)][_0x110778(0x108)]:JSON[_0x110778(0x11f)](_0x589646[_0x110778(0x189)][_0x110778(0x108)]);}catch(_0x200285){console[_0x110778(0xb5)]('Error\x20parsing\x20webhook\x20events:',_0x200285),_0x208e93=[];}return{'id':_0x589646['id'],'fullName':_0x589646[_0x110778(0x173)],'username':_0x589646[_0x110778(0x164)],'telegramId':_0x589646[_0x110778(0xeb)],'merchantUrl':_0x589646[_0x110778(0xd0)],'gateways':_0x589646[_0x110778(0xad)]?JSON[_0x110778(0x11f)](_0x589646[_0x110778(0xad)]):null,'gatewaySettings':_0x589646[_0x110778(0xfd)]?JSON[_0x110778(0x11f)](_0x589646[_0x110778(0xfd)]):null,'publicKey':_0x589646[_0x110778(0x13a)],'secretKey':_0x589646['secretKey'],'webhookUrl':_0x589646['settings']?.[_0x110778(0xed)]||null,'webhookEvents':_0x208e93,'wallets':{'usdtPolygonWallet':_0x589646[_0x110778(0x10f)],'usdtTrcWallet':_0x589646[_0x110778(0xe2)],'usdtErcWallet':_0x589646['usdtErcWallet'],'usdcPolygonWallet':_0x589646[_0x110778(0x172)],'usdcErcWallet':_0x589646[_0x110778(0x117)]},'status':_0x589646[_0x110778(0x18d)],'createdAt':_0x589646['createdAt']};}async[a82_0x5eb819(0x12c)](_0x43ea69,_0x57d916){const _0x338fec=a82_0x5eb819,_0x12b077=await database_1[_0x338fec(0xd1)]['shop'][_0x338fec(0x112)]({'where':{'id':_0x43ea69},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x12b077)throw new Error(_0x338fec(0xaf));if(_0x12b077['twoFactorEnabled']){if(!_0x57d916[_0x338fec(0x175)])throw new Error(_0x338fec(0xdf));const _0x20fa47=speakeasy_1[_0x338fec(0xd1)][_0x338fec(0xf2)][_0x338fec(0x13e)]({'secret':_0x12b077[_0x338fec(0xe5)],'encoding':'base32','token':_0x57d916['twoFactorToken'],'window':0x2});if(!_0x20fa47){let _0x4a8476=![];if(_0x12b077[_0x338fec(0xae)]){const _0x5876f7=JSON['parse'](_0x12b077['backupCodes']);for(let _0x13438c=0x0;_0x13438c<_0x5876f7['length'];_0x13438c++){const _0x538f1d=await bcryptjs_1[_0x338fec(0xd1)]['compare'](_0x57d916[_0x338fec(0x175)],_0x5876f7[_0x13438c]);if(_0x538f1d){_0x4a8476=!![],_0x5876f7[_0x338fec(0x125)](_0x13438c,0x1),await database_1[_0x338fec(0xd1)]['shop'][_0x338fec(0x12b)]({'where':{'id':_0x43ea69},'data':{'backupCodes':JSON[_0x338fec(0x109)](_0x5876f7)}});break;}}}if(!_0x4a8476)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x2dcaef={};_0x57d916[_0x338fec(0x10f)]!==undefined&&(_0x2dcaef[_0x338fec(0x10f)]=_0x57d916['usdtPolygonWallet']||null),_0x57d916[_0x338fec(0xe2)]!==undefined&&(_0x2dcaef['usdtTrcWallet']=_0x57d916[_0x338fec(0xe2)]||null),_0x57d916[_0x338fec(0x188)]!==undefined&&(_0x2dcaef[_0x338fec(0x188)]=_0x57d916[_0x338fec(0x188)]||null),_0x57d916[_0x338fec(0x172)]!==undefined&&(_0x2dcaef[_0x338fec(0x172)]=_0x57d916['usdcPolygonWallet']||null),_0x57d916[_0x338fec(0x117)]!==undefined&&(_0x2dcaef[_0x338fec(0x117)]=_0x57d916[_0x338fec(0x117)]||null),await database_1[_0x338fec(0xd1)]['shop'][_0x338fec(0x12b)]({'where':{'id':_0x43ea69},'data':_0x2dcaef});}async[a82_0x5eb819(0xe6)](_0x4ecc8f){const _0x44aa5e=a82_0x5eb819,_0x53f0b6=await database_1[_0x44aa5e(0xd1)][_0x44aa5e(0x122)][_0x44aa5e(0x112)]({'where':{'id':_0x4ecc8f},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x53f0b6?.[_0x44aa5e(0x189)]?.[_0x44aa5e(0xed)])throw new Error(_0x44aa5e(0x114));const _0x87081a={'event':_0x44aa5e(0x156),'payment':{'id':_0x44aa5e(0xdb),'order_id':_0x44aa5e(0x10a),'gateway':'test','amount':0x64,'currency':_0x44aa5e(0x10b),'status':_0x44aa5e(0xb4),'created_at':new Date()[_0x44aa5e(0xbb)]()}};try{const _0x117ba2=JSON['stringify'](_0x87081a),_0xaf014f=crypto_1[_0x44aa5e(0xd1)][_0x44aa5e(0x130)](_0x44aa5e(0x168),_0x53f0b6[_0x44aa5e(0xab)])[_0x44aa5e(0x12b)](_0x117ba2)[_0x44aa5e(0x183)](_0x44aa5e(0xcb)),_0x338c1b=await fetch(_0x53f0b6['settings'][_0x44aa5e(0xed)],{'method':_0x44aa5e(0x179),'headers':{'Content-Type':_0x44aa5e(0x184),'User-Agent':'Payment\x20System/1.0\x20(Test)','X-Webhook-Signature':_0xaf014f},'body':_0x117ba2});return _0x338c1b['ok']?{'success':!![],'message':_0x44aa5e(0xa8)+_0x338c1b[_0x44aa5e(0x18d)]+')'}:{'success':![],'message':_0x44aa5e(0xf7)+_0x338c1b[_0x44aa5e(0x18d)]+'\x20'+_0x338c1b[_0x44aa5e(0x149)]};}catch(_0x2e9237){return{'success':![],'message':_0x44aa5e(0x13f)+(_0x2e9237 instanceof Error?_0x2e9237['message']:_0x44aa5e(0x16b))};}}async[a82_0x5eb819(0x12f)](_0x4202a4){const _0x24e5cb=a82_0x5eb819;return this[_0x24e5cb(0xd2)]['createPublicPayment']({'public_key':'','gateway':_0x4202a4['gateway'],'order_id':undefined,'amount':_0x4202a4[_0x24e5cb(0x17a)],'currency':_0x4202a4[_0x24e5cb(0x16a)],'source_currency':_0x4202a4[_0x24e5cb(0xbe)],'usage':_0x4202a4[_0x24e5cb(0xbf)],'expires_at':_0x4202a4[_0x24e5cb(0xe7)]?.[_0x24e5cb(0xbb)](),'success_url':_0x4202a4['redirectUrl'],'fail_url':_0x4202a4[_0x24e5cb(0xbc)],'customer_email':_0x4202a4[_0x24e5cb(0x14e)],'customer_name':_0x4202a4[_0x24e5cb(0xc3)],'country':_0x4202a4[_0x24e5cb(0xb2)],'language':_0x4202a4[_0x24e5cb(0xba)],'amount_is_editable':_0x4202a4[_0x24e5cb(0x103)],'max_payments':_0x4202a4[_0x24e5cb(0x12a)],'customer':_0x4202a4[_0x24e5cb(0xac)]});}async['getPayments'](_0x2f5991,_0xba2dd9){const _0x1b2820=a82_0x5eb819;return this['paymentService'][_0x1b2820(0x16c)](_0x2f5991,_0xba2dd9);}async[a82_0x5eb819(0xf6)](_0x527d8f,_0x2fa79c){const _0x49e3=a82_0x5eb819;return this[_0x49e3(0xd2)][_0x49e3(0x171)](_0x527d8f,_0x2fa79c);}async[a82_0x5eb819(0x11e)](_0x5d320b,_0x43bbd4,_0x354726){const _0x310df2=a82_0x5eb819,_0x314aac=await database_1['default'][_0x310df2(0x157)][_0x310df2(0x11d)]({'where':{'id':_0x43bbd4,'shopId':_0x5d320b}});if(!_0x314aac)throw new Error(_0x310df2(0x17f));const _0x12122b=await database_1[_0x310df2(0xd1)][_0x310df2(0x157)][_0x310df2(0x12b)]({'where':{'id':_0x43bbd4},'data':{..._0x354726,'updatedAt':new Date()}});return _0x12122b;}async['deletePayment'](_0x348626,_0x19545e){const _0x97051e=a82_0x5eb819,_0x1230f4=await database_1['default'][_0x97051e(0x157)][_0x97051e(0x11d)]({'where':{'id':_0x19545e,'shopId':_0x348626}});if(!_0x1230f4)throw new Error('Payment\x20not\x20found');await database_1[_0x97051e(0xd1)][_0x97051e(0x157)]['delete']({'where':{'id':_0x19545e}});}[a82_0x5eb819(0xfb)](_0x37d693){const _0x599a7e=a82_0x5eb819,_0x1523a3={'polygon':_0x599a7e(0x128),'trc20':_0x599a7e(0x17e),'erc20':_0x599a7e(0xc8),'bsc':_0x599a7e(0xee),'polygon_usdc':_0x599a7e(0x115),'erc20_usdc':_0x599a7e(0x17c)};return _0x1523a3[_0x37d693]||_0x37d693;}async[a82_0x5eb819(0xec)](_0x1b3e93,_0x2dfdf6){const _0x17202b=a82_0x5eb819,{page:_0x53ab43,limit:_0x412a48,status:_0x54a323,method:_0x3b2f83,network:_0x9d4b5e,dateFrom:_0xa326ae,dateTo:_0x49f5e3,periodFrom:_0x1a4842,periodTo:_0x4a3933}=_0x2dfdf6,_0x9301e=(_0x53ab43-0x1)*_0x412a48;console['log'](_0x17202b(0x14b),_0x2dfdf6);const _0x1bee55={'shopId':_0x1b3e93};_0x54a323&&(_0x1bee55[_0x17202b(0x18d)]=_0x54a323[_0x17202b(0x11a)](),console[_0x17202b(0x14c)](_0x17202b(0x18a)+_0x54a323[_0x17202b(0x11a)]()));if(_0x3b2f83)_0x1bee55['network']=_0x3b2f83,console[_0x17202b(0x14c)](_0x17202b(0x15c)+_0x3b2f83);else _0x9d4b5e&&(_0x1bee55['network']=_0x9d4b5e,console[_0x17202b(0x14c)](_0x17202b(0x18c)+_0x9d4b5e));if(_0xa326ae||_0x49f5e3||_0x1a4842||_0x4a3933){_0x1bee55[_0x17202b(0x187)]={};if(_0x1a4842){const _0x478d25=new Date(_0x1a4842);_0x478d25[_0x17202b(0x113)](0x0,0x0,0x0,0x1),_0x1bee55[_0x17202b(0x187)][_0x17202b(0x118)]=_0x478d25,console[_0x17202b(0x14c)]('üìÖ\x20Period\x20start:\x20'+_0x478d25['toISOString']());}else{if(_0xa326ae){const _0x57b97f=new Date(_0xa326ae);_0x57b97f[_0x17202b(0x113)](0x0,0x0,0x0,0x1),_0x1bee55[_0x17202b(0x187)][_0x17202b(0x118)]=_0x57b97f,console['log'](_0x17202b(0x18e)+_0x57b97f[_0x17202b(0xbb)]());}}if(_0x4a3933){const _0x59a39c=new Date(_0x4a3933);_0x59a39c[_0x17202b(0x113)](0x17,0x3b,0x3b,0x3e7),_0x1bee55[_0x17202b(0x187)][_0x17202b(0x137)]=_0x59a39c,console['log'](_0x17202b(0x17b)+_0x59a39c[_0x17202b(0xbb)]());}else{if(_0x49f5e3){const _0xea8d98=new Date(_0x49f5e3);_0xea8d98['setHours'](0x17,0x3b,0x3b,0x3e7),_0x1bee55[_0x17202b(0x187)][_0x17202b(0x137)]=_0xea8d98,console['log'](_0x17202b(0x119)+_0xea8d98['toISOString']());}}}console[_0x17202b(0x14c)](_0x17202b(0xf9),JSON[_0x17202b(0x109)](_0x1bee55,null,0x2));const [_0x10726d,_0x41b389]=await Promise[_0x17202b(0xda)]([database_1[_0x17202b(0xd1)][_0x17202b(0x134)][_0x17202b(0xde)]({'where':_0x1bee55,'skip':_0x9301e,'take':_0x412a48,'orderBy':{'createdAt':_0x17202b(0x123)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x17202b(0xd1)]['payout'][_0x17202b(0x14a)]({'where':_0x1bee55})]);return{'payouts':_0x10726d[_0x17202b(0xd5)](_0x158ba4=>{const _0x4d5a3c=_0x17202b;let _0x25b4bd=null;switch(_0x158ba4[_0x4d5a3c(0x178)]){case _0x4d5a3c(0x177):_0x25b4bd=_0x158ba4[_0x4d5a3c(0x122)][_0x4d5a3c(0x10f)];break;case _0x4d5a3c(0x16f):_0x25b4bd=_0x158ba4[_0x4d5a3c(0x122)][_0x4d5a3c(0xe2)];break;case _0x4d5a3c(0xb6):_0x25b4bd=_0x158ba4['shop'][_0x4d5a3c(0x188)];break;case _0x4d5a3c(0xc7):_0x25b4bd=_0x158ba4['shop'][_0x4d5a3c(0x172)];break;case'erc20_usdc':_0x25b4bd=_0x158ba4['shop'][_0x4d5a3c(0x117)];break;}return{'id':_0x158ba4['id'],'amount':_0x158ba4[_0x4d5a3c(0x17a)],'network':this['formatNetworkName'](_0x158ba4[_0x4d5a3c(0x178)]),'wallet':_0x25b4bd,'status':_0x158ba4['status'],'txid':_0x158ba4['txid'],'notes':_0x158ba4['notes'],'periodFrom':_0x158ba4['periodFrom'],'periodTo':_0x158ba4['periodTo'],'createdAt':_0x158ba4[_0x4d5a3c(0x187)],'paidAt':_0x158ba4[_0x4d5a3c(0x18b)]};}),'pagination':{'page':_0x53ab43,'limit':_0x412a48,'total':_0x41b389,'totalPages':Math[_0x17202b(0x17d)](_0x41b389/_0x412a48)}};}async[a82_0x5eb819(0xdc)](_0xe7dfc5,_0x4a80d5){const _0x167810=a82_0x5eb819,_0x4773ce=await database_1[_0x167810(0xd1)]['payout']['findFirst']({'where':{'id':_0x4a80d5,'shopId':_0xe7dfc5}});if(!_0x4773ce)return null;return{'id':_0x4773ce['id'],'amount':_0x4773ce[_0x167810(0x17a)],'network':_0x4773ce[_0x167810(0x178)],'status':_0x4773ce[_0x167810(0x18d)],'txid':_0x4773ce[_0x167810(0xce)],'notes':_0x4773ce[_0x167810(0x165)],'createdAt':_0x4773ce[_0x167810(0x187)],'paidAt':_0x4773ce[_0x167810(0x18b)]};}async[a82_0x5eb819(0xe8)](_0x2e6ad8,_0x1f5a98){const _0x26c70a=a82_0x5eb819,_0x34e9e8=new Date();let _0x1745c5,_0x5d8617;switch(_0x1f5a98){case _0x26c70a(0x142):case _0x26c70a(0x10c):const _0x9bbcbe=new Date(_0x34e9e8);_0x9bbcbe[_0x26c70a(0x144)](_0x9bbcbe[_0x26c70a(0x11c)]()-0x1),_0x1745c5=new Date(_0x9bbcbe),_0x1745c5['setHours'](0x0,0x0,0x0,0x0),_0x5d8617=new Date(_0x9bbcbe),_0x5d8617[_0x26c70a(0x113)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x1745c5=new Date(_0x34e9e8[_0x26c70a(0x14f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x1745c5=new Date(_0x34e9e8[_0x26c70a(0x14f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x26c70a(0x153):_0x1745c5=new Date(_0x34e9e8[_0x26c70a(0x14f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1745c5=new Date(_0x34e9e8['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x27cc06={'gte':_0x1745c5};_0x5d8617&&(_0x27cc06[_0x26c70a(0x137)]=_0x5d8617);const [_0x3074ea,_0x29a5bb,_0x136e59,_0x3c6c7f,_0x14f917,_0x484bd5]=await Promise[_0x26c70a(0xda)]([database_1[_0x26c70a(0xd1)][_0x26c70a(0x134)][_0x26c70a(0x14a)]({'where':{'shopId':_0x2e6ad8,'createdAt':_0x27cc06}}),database_1[_0x26c70a(0xd1)][_0x26c70a(0x134)]['count']({'where':{'shopId':_0x2e6ad8,'status':_0x26c70a(0x127),'createdAt':_0x27cc06}}),database_1[_0x26c70a(0xd1)]['payout']['count']({'where':{'shopId':_0x2e6ad8,'status':'PENDING','createdAt':_0x27cc06}}),database_1[_0x26c70a(0xd1)][_0x26c70a(0x134)]['count']({'where':{'shopId':_0x2e6ad8,'status':_0x26c70a(0xf0),'createdAt':_0x27cc06}}),database_1['default'][_0x26c70a(0x134)][_0x26c70a(0xde)]({'where':{'shopId':_0x2e6ad8,'createdAt':_0x27cc06},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x26c70a(0xd1)][_0x26c70a(0x134)]['findMany']({'where':{'shopId':_0x2e6ad8},'take':0xa,'orderBy':{'createdAt':_0x26c70a(0x123)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x54b5a9=_0x14f917[_0x26c70a(0xf4)]((_0x4edb63,_0x103641)=>_0x4edb63+_0x103641[_0x26c70a(0x17a)],0x0),_0x5452b7=_0x14f917[_0x26c70a(0xca)](_0x327bf6=>_0x327bf6[_0x26c70a(0x18d)]===_0x26c70a(0x127))[_0x26c70a(0xf4)]((_0x302428,_0x20bb8d)=>_0x302428+_0x20bb8d[_0x26c70a(0x17a)],0x0),_0x52f013=_0x14f917[_0x26c70a(0xca)](_0x23617d=>_0x23617d[_0x26c70a(0x18d)]===_0x26c70a(0x170))[_0x26c70a(0xf4)]((_0x366b4e,_0x1c123d)=>_0x366b4e+_0x1c123d['amount'],0x0),_0x567024=_0x14f917[_0x26c70a(0xf4)]((_0x1912a0,_0x3dfd28)=>{return _0x1912a0[_0x3dfd28['network']]=(_0x1912a0[_0x3dfd28['network']]||0x0)+0x1,_0x1912a0;},{}),_0x1bafbb=_0x14f917[_0x26c70a(0xf4)]((_0x289b75,_0x44e2c3)=>{const _0x20b578=_0x26c70a;return _0x289b75[_0x44e2c3[_0x20b578(0x18d)]]=(_0x289b75[_0x44e2c3['status']]||0x0)+0x1,_0x289b75;},{});return{'totalPayouts':_0x3074ea,'completedPayouts':_0x29a5bb,'pendingPayouts':_0x136e59,'rejectedPayouts':_0x3c6c7f,'totalAmount':_0x54b5a9,'completedAmount':_0x5452b7,'pendingAmount':_0x52f013,'payoutsByMethod':_0x567024,'payoutsByStatus':_0x1bafbb,'recentPayouts':_0x484bd5[_0x26c70a(0xd5)](_0x33a00d=>({'id':_0x33a00d['id'],'shopId':_0x2e6ad8,'amount':_0x33a00d['amount'],'method':_0x33a00d[_0x26c70a(0x178)],'status':_0x33a00d['status'],'txid':_0x33a00d[_0x26c70a(0xce)],'createdAt':_0x33a00d['createdAt'],'paidAt':_0x33a00d[_0x26c70a(0x18b)]}))};}async['getShopPayoutStats'](_0xd68818){const _0x43527e=a82_0x5eb819;console['log']('üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0xd68818+'...');const _0x3cbe2a=await database_1[_0x43527e(0xd1)][_0x43527e(0x122)]['findUnique']({'where':{'id':_0xd68818},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3cbe2a)throw new Error('Shop\x20not\x20found');const _0x59d74c=new Date(),_0x3f7578=new Date(_0x59d74c[_0x43527e(0xfa)](),_0x59d74c[_0x43527e(0xb1)](),0x1),_0x49dcc5=new Date(_0x59d74c[_0x43527e(0xfa)](),_0x59d74c[_0x43527e(0xb1)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x194d33=await database_1[_0x43527e(0xd1)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0xd68818,'createdAt':{'gte':_0x3f7578,'lte':_0x49dcc5},'status':_0x43527e(0x127)}}),_0x447313=_0x194d33[_0x43527e(0xe9)]['amount']||0x0,_0x4199e3={'availableBalance':Math['round'](_0x3cbe2a[_0x43527e(0x110)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x3cbe2a[_0x43527e(0x154)]*0x64)/0x64,'awaitingPayout':Math[_0x43527e(0x120)](_0x3cbe2a[_0x43527e(0x110)]*0x64)/0x64,'thisMonth':Math[_0x43527e(0x120)](_0x447313*0x64)/0x64};return console[_0x43527e(0x14c)]('üìä\x20Shop\x20'+_0x3cbe2a['username']+_0x43527e(0x133)),console[_0x43527e(0x14c)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x4199e3['availableBalance']+_0x43527e(0xc2)),console[_0x43527e(0x14c)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x4199e3[_0x43527e(0x154)]+_0x43527e(0x146)),console[_0x43527e(0x14c)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x4199e3[_0x43527e(0x107)]+_0x43527e(0xc2)),console['log'](_0x43527e(0x143)+_0x4199e3[_0x43527e(0xa5)]+_0x43527e(0x136)),_0x4199e3;}[a82_0x5eb819(0x101)](_0x27cb20){const _0x248d18=a82_0x5eb819,_0x7f6d29={'test_gateway':_0x248d18(0x15d),'plisio':_0x248d18(0xc4),'rapyd':_0x248d18(0x106),'noda':_0x248d18(0xff),'cointopay':_0x248d18(0x166),'klyme_eu':_0x248d18(0xf3),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x7f6d29[_0x27cb20]||_0x27cb20;}async[a82_0x5eb819(0xa6)](_0x382a90){return this['getShopPayoutStats'](_0x382a90);}async[a82_0x5eb819(0xdd)](_0x157238,_0x131fe0){const _0x2e13c1=a82_0x5eb819,{page:_0x39a9bb,limit:_0x591703,paymentId:_0xd6ce94}=_0x131fe0,_0x27bf90=(_0x39a9bb-0x1)*_0x591703,_0x15aa9d={'shopId':_0x157238};_0xd6ce94&&(_0x15aa9d['paymentId']=_0xd6ce94);const [_0x13dc94,_0x3f2ccd]=await Promise[_0x2e13c1(0xda)]([database_1[_0x2e13c1(0xd1)]['webhookLog'][_0x2e13c1(0xde)]({'where':_0x15aa9d,'skip':_0x27bf90,'take':_0x591703,'orderBy':{'createdAt':_0x2e13c1(0x123)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2e13c1(0xd1)][_0x2e13c1(0xe3)][_0x2e13c1(0x14a)]({'where':_0x15aa9d})]);return{'logs':_0x13dc94[_0x2e13c1(0xd5)](_0xe31f55=>({'id':_0xe31f55['id'],'paymentId':_0xe31f55[_0x2e13c1(0xe1)],'shopId':_0xe31f55[_0x2e13c1(0xd8)],'event':_0xe31f55[_0x2e13c1(0x129)],'statusCode':_0xe31f55['statusCode'],'retryCount':_0xe31f55[_0x2e13c1(0x10d)],'responseBody':_0xe31f55[_0x2e13c1(0x124)],'createdAt':_0xe31f55[_0x2e13c1(0x187)],'payment':_0xe31f55[_0x2e13c1(0x157)]})),'pagination':{'page':_0x39a9bb,'limit':_0x591703,'total':_0x3f2ccd,'totalPages':Math[_0x2e13c1(0x17d)](_0x3f2ccd/_0x591703)}};}async[a82_0x5eb819(0xf8)](_0x419df7,_0x2d3d55,_0x5575ed,_0x366950,_0x5c2c84){const _0x54c3ac=a82_0x5eb819;console[_0x54c3ac(0x14c)](_0x54c3ac(0x131)+_0x419df7+_0x54c3ac(0x159)+_0x2d3d55+_0x54c3ac(0x185)+_0x5575ed+_0x54c3ac(0x15b)+_0x366950);const _0x562d31=_0x5c2c84?new Date(_0x5c2c84):new Date();let _0x1470d7,_0x150603;if(_0x5575ed&&_0x366950){const _0x40b88a=new Date(_0x5575ed),_0x230991=new Date(_0x366950);_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x40b88a['getUTCFullYear'](),_0x40b88a[_0x54c3ac(0xd3)](),_0x40b88a['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x230991[_0x54c3ac(0xa3)](),_0x230991['getUTCMonth'](),_0x230991['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x54c3ac(0x14c)](_0x54c3ac(0x174)+_0x1470d7[_0x54c3ac(0xbb)]()+_0x54c3ac(0x104)+_0x150603[_0x54c3ac(0xbb)]());}else{if(_0x2d3d55&&_0x2d3d55['startsWith'](_0x54c3ac(0x13b))){const _0x247687=_0x2d3d55[_0x54c3ac(0x12e)](_0x54c3ac(0x13b),'')[_0x54c3ac(0x145)]('_');if(_0x247687['length']===0x2){const _0x4cf0f7=new Date(_0x247687[0x0]),_0x225480=new Date(_0x247687[0x1]);_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x4cf0f7['getUTCFullYear'](),_0x4cf0f7['getUTCMonth'](),_0x4cf0f7[_0x54c3ac(0xd4)](),0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x225480[_0x54c3ac(0xa3)](),_0x225480['getUTCMonth'](),_0x225480[_0x54c3ac(0xd4)](),0x17,0x3b,0x3b,0x3e7)),console[_0x54c3ac(0x14c)](_0x54c3ac(0x151)+_0x1470d7['toISOString']()+'\x20to\x20'+_0x150603['toISOString']());}else{const _0x3dbfbc=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),_0x562d31[_0x54c3ac(0xd4)]()-0x1e));_0x1470d7=new Date(Date['UTC'](_0x3dbfbc[_0x54c3ac(0xa3)](),_0x3dbfbc[_0x54c3ac(0xd3)](),_0x3dbfbc[_0x54c3ac(0xd4)](),0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),_0x562d31['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x531934=_0x2d3d55||'this_month';switch(_0x531934['toLowerCase']()){case'today':_0x1470d7=new Date(Date['UTC'](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),_0x562d31[_0x54c3ac(0xd4)](),0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31['getUTCMonth'](),_0x562d31['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x54c3ac(0x142):const _0x514704=new Date(_0x562d31);_0x514704[_0x54c3ac(0x13d)](_0x514704[_0x54c3ac(0xd4)]()-0x1),_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x514704['getUTCFullYear'](),_0x514704[_0x54c3ac(0xd3)](),_0x514704['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x514704[_0x54c3ac(0xa3)](),_0x514704[_0x54c3ac(0xd3)](),_0x514704[_0x54c3ac(0xd4)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x868881=_0x562d31[_0x54c3ac(0xf5)](),_0x83c37=_0x868881===0x0?-0x6:0x1-_0x868881,_0x5471b3=_0x562d31[_0x54c3ac(0xd4)]()+_0x83c37;_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31['getUTCMonth'](),_0x5471b3,0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x562d31['getUTCFullYear'](),_0x562d31['getUTCMonth'](),_0x562d31['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0x940a71=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),_0x562d31[_0x54c3ac(0xd4)]()-0x7)),_0xb9aae2=_0x940a71[_0x54c3ac(0xf5)](),_0x2fe76a=_0xb9aae2===0x0?-0x6:0x1-_0xb9aae2,_0x514fe4=_0x940a71[_0x54c3ac(0xd4)]()+_0x2fe76a;_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x940a71['getUTCFullYear'](),_0x940a71['getUTCMonth'](),_0x514fe4,0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x940a71[_0x54c3ac(0xa3)](),_0x940a71[_0x54c3ac(0xd3)](),_0x514fe4+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x54c3ac(0xa9):_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),0x1,0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),_0x562d31['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x150603=new Date(Date['UTC'](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x54c3ac(0xcc):_0x1470d7=new Date(Date[_0x54c3ac(0x132)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x562d31['getUTCFullYear'](),_0x562d31['getUTCMonth'](),_0x562d31[_0x54c3ac(0xd4)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x1470d7=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),0x1,0x0,0x0,0x0,0x0)),_0x150603=new Date(Date[_0x54c3ac(0x132)](_0x562d31[_0x54c3ac(0xa3)](),_0x562d31[_0x54c3ac(0xd3)](),_0x562d31[_0x54c3ac(0xd4)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x54c3ac(0x14c)](_0x54c3ac(0xb0)+_0x1470d7[_0x54c3ac(0xbb)]()+_0x54c3ac(0x104)+_0x150603[_0x54c3ac(0xbb)]());const _0x4a69b1={'gte':_0x1470d7,'lte':_0x150603},[_0x57c015,_0x24f881,_0x5532e5,_0x57d4c7,_0x1fd236,_0x32551e,_0x18e36c,_0x1c43ec,_0x57b69d,_0x27954a,_0x23245f]=await Promise[_0x54c3ac(0xda)]([database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0x14a)]({'where':{'shopId':_0x419df7,'gateway':{'not':_0x54c3ac(0xfc)},'status':{'notIn':[_0x54c3ac(0x170),_0x54c3ac(0xa1)]},'createdAt':_0x4a69b1}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0x14a)]({'where':{'shopId':_0x419df7,'gateway':{'not':'test_gateway'},'status':_0x54c3ac(0xcf),'createdAt':_0x4a69b1}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0x14a)]({'where':{'shopId':_0x419df7,'gateway':{'not':'test_gateway'},'status':_0x54c3ac(0x16d)}}),database_1[_0x54c3ac(0xd1)]['payment'][_0x54c3ac(0x14a)]({'where':{'shopId':_0x419df7,'gateway':{'not':_0x54c3ac(0xfc)},'status':_0x54c3ac(0x150)}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0xde)]({'where':{'shopId':_0x419df7,'gateway':{'not':_0x54c3ac(0xfc)},'status':_0x54c3ac(0xcf),'createdAt':_0x4a69b1},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0xde)]({'where':{'shopId':_0x419df7,'gateway':{'not':'test_gateway'}},'take':0x4,'orderBy':{'createdAt':_0x54c3ac(0x123)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0xde)]({'where':{'shopId':_0x419df7,'gateway':{'not':'test_gateway'},'createdAt':_0x4a69b1},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x54c3ac(0xc1)}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)]['count']({'where':{'shopId':_0x419df7,'gateway':{'not':_0x54c3ac(0xfc)},'status':'PAID'}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0xde)]({'where':{'shopId':_0x419df7,'gateway':{'not':_0x54c3ac(0xfc)},'status':_0x54c3ac(0xcf)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x122)]['findUnique']({'where':{'id':_0x419df7},'select':{'balance':!![]}}),database_1[_0x54c3ac(0xd1)][_0x54c3ac(0x157)][_0x54c3ac(0xde)]({'where':{'shopId':_0x419df7,'gateway':{'not':'test_gateway'}},'select':{'gateway':!![]}})]),_0x55c22f={};for(const _0x2e5604 of _0x23245f){_0x2e5604[_0x54c3ac(0x12d)]&&(_0x55c22f[_0x2e5604[_0x54c3ac(0x12d)]]=(_0x55c22f[_0x2e5604[_0x54c3ac(0x12d)]]||0x0)+0x1);}console['log'](_0x54c3ac(0x100),_0x55c22f);let _0x337e69=0x0,_0x526f41=0x0;for(const _0x78a97c of _0x1fd236){if(_0x78a97c[_0x54c3ac(0x152)])_0x337e69+=_0x78a97c[_0x54c3ac(0x152)];else{const _0x5de900=await currencyService_1[_0x54c3ac(0x135)]['convertToUSDT'](_0x78a97c[_0x54c3ac(0x17a)],_0x78a97c['currency']);_0x337e69+=_0x5de900;}_0x78a97c[_0x54c3ac(0x186)]&&(_0x526f41+=_0x78a97c['amountAfterGatewayCommissionUSDT']);}let _0x41cf4c=0x0;for(const _0x4f6490 of _0x57b69d){_0x4f6490[_0x54c3ac(0x186)]&&(_0x41cf4c+=_0x4f6490[_0x54c3ac(0x186)]);}const _0x5efc27=this[_0x54c3ac(0xc9)](_0x18e36c,_0x1470d7,_0x150603||_0x562d31),_0x5c0008=_0x57c015>0x0?_0x24f881/_0x57c015*0x64:0x0,_0x138b00=_0x1c43ec>0x0?_0x5532e5/_0x1c43ec*0x64:0x0;return{'totalPayments':_0x57c015,'successfulPayments':_0x24f881,'totalRevenue':Math[_0x54c3ac(0x120)](_0x337e69*0x64)/0x64,'merchantEarnings':Math[_0x54c3ac(0x120)](_0x526f41*0x64)/0x64,'merchantTotalRevenue':Math[_0x54c3ac(0x120)](_0x41cf4c*0x64)/0x64,'payoutBalance':Math[_0x54c3ac(0x120)]((_0x27954a?.['balance']||0x0)*0x64)/0x64,'conversionRate':Math[_0x54c3ac(0x120)](_0x5c0008*0x64)/0x64,'chargebackRate':Math['round'](_0x138b00*0x64)/0x64,'chargebacks':_0x5532e5,'refunds':_0x57d4c7,'paymentsByGateway':_0x55c22f,'dailyRevenue':_0x5efc27[_0x54c3ac(0xfe)],'dailyPayments':_0x5efc27[_0x54c3ac(0xc5)],'recentPayments':_0x32551e[_0x54c3ac(0xd5)](_0x56eeb2=>({'id':_0x56eeb2['id'],'gateway':_0x56eeb2['gateway'],'amount':_0x56eeb2[_0x54c3ac(0x17a)],'currency':_0x56eeb2[_0x54c3ac(0x16a)],'status':_0x56eeb2[_0x54c3ac(0x18d)],'createdAt':_0x56eeb2[_0x54c3ac(0x187)]}))};}[a82_0x5eb819(0xc9)](_0x3d3b9d,_0x380039,_0x5c306d){const _0x1173bc=a82_0x5eb819,_0x509bc7=new Map(),_0x12acca=new Date(_0x380039);while(_0x12acca<=_0x5c306d){const _0x53fcfd=_0x12acca[_0x1173bc(0xbb)]()['split']('T')[0x0];_0x509bc7[_0x1173bc(0x148)](_0x53fcfd,{'revenue':0x0,'count':0x0}),_0x12acca[_0x1173bc(0x144)](_0x12acca[_0x1173bc(0x11c)]()+0x1);}for(const _0x5be650 of _0x3d3b9d){const _0x4f732e=_0x5be650[_0x1173bc(0x187)][_0x1173bc(0xbb)]()[_0x1173bc(0x145)]('T')[0x0],_0xc2f127=_0x509bc7[_0x1173bc(0x102)](_0x4f732e);_0xc2f127&&(_0xc2f127[_0x1173bc(0x14a)]+=0x1,_0x5be650[_0x1173bc(0x18d)]==='PAID'&&_0x5be650[_0x1173bc(0x152)]&&(_0xc2f127[_0x1173bc(0x182)]+=_0x5be650['amountUSDT']));}const _0x385291=[],_0x4da046=[];for(const [_0xcf0736,_0x104a67]of _0x509bc7){_0x385291[_0x1173bc(0x105)]({'date':_0xcf0736,'amount':Math['round'](_0x104a67['revenue']*0x64)/0x64}),_0x4da046[_0x1173bc(0x105)]({'date':_0xcf0736,'count':_0x104a67[_0x1173bc(0x14a)]});}return{'dailyRevenue':_0x385291,'dailyPayments':_0x4da046};}[a82_0x5eb819(0x15f)](_0x3d7f21=0x8){const _0x3a8de2=a82_0x5eb819,_0x5c0ebd=[];for(let _0x2f2474=0x0;_0x2f2474<_0x3d7f21;_0x2f2474++){const _0x6d5a19=crypto_1[_0x3a8de2(0xd1)][_0x3a8de2(0xc6)](0x4)[_0x3a8de2(0x139)](_0x3a8de2(0xcb))[_0x3a8de2(0x11a)]();_0x5c0ebd[_0x3a8de2(0x105)](_0x6d5a19);}return _0x5c0ebd;}async['setup2FA'](_0x2c98b2){const _0x357d8a=a82_0x5eb819,_0x47f6d1=await database_1[_0x357d8a(0xd1)][_0x357d8a(0x122)][_0x357d8a(0x112)]({'where':{'id':_0x2c98b2},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x47f6d1)throw new Error(_0x357d8a(0xaf));const _0x4d5eb9=speakeasy_1[_0x357d8a(0xd1)][_0x357d8a(0xb3)]({'name':'TrapaPay\x20('+_0x47f6d1['username']+')','issuer':'TrapaPay','length':0x20}),_0x1b2f31=await qrcode_1[_0x357d8a(0xd1)]['toDataURL'](_0x4d5eb9[_0x357d8a(0x15e)]),_0x535176=this[_0x357d8a(0x15f)](0x8),_0x3c486f=await Promise[_0x357d8a(0xda)](_0x535176['map'](_0x3e57aa=>bcryptjs_1[_0x357d8a(0xd1)][_0x357d8a(0x16e)](_0x3e57aa,0xa)));return await database_1[_0x357d8a(0xd1)][_0x357d8a(0x122)][_0x357d8a(0x12b)]({'where':{'id':_0x2c98b2},'data':{'twoFactorSecret':_0x4d5eb9['base32'],'backupCodes':JSON[_0x357d8a(0x109)](_0x3c486f)}}),console[_0x357d8a(0x14c)](_0x357d8a(0xb8)+_0x47f6d1[_0x357d8a(0x164)]),console[_0x357d8a(0x14c)](_0x357d8a(0x126)+_0x535176['length']+_0x357d8a(0xd7)),{'secret':_0x4d5eb9['base32'],'qrCode':_0x1b2f31,'manualEntryKey':_0x4d5eb9[_0x357d8a(0xe4)],'backupCodes':_0x535176};}async[a82_0x5eb819(0xa7)](_0x1150f3,_0x206d7f){const _0x1e501e=a82_0x5eb819,_0x337d1a=await database_1[_0x1e501e(0xd1)][_0x1e501e(0x122)][_0x1e501e(0x112)]({'where':{'id':_0x1150f3},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x337d1a)throw new Error(_0x1e501e(0xaf));if(!_0x337d1a[_0x1e501e(0xe5)])throw new Error(_0x1e501e(0x111));if(_0x337d1a['twoFactorEnabled'])throw new Error(_0x1e501e(0xb7));const _0x12527f=speakeasy_1['default']['totp'][_0x1e501e(0x13e)]({'secret':_0x337d1a[_0x1e501e(0xe5)],'encoding':'base32','token':_0x206d7f,'window':0x2});if(!_0x12527f)throw new Error(_0x1e501e(0x181));return await database_1[_0x1e501e(0xd1)][_0x1e501e(0x122)]['update']({'where':{'id':_0x1150f3},'data':{'twoFactorEnabled':!![]}}),console[_0x1e501e(0x14c)](_0x1e501e(0x11b)+_0x337d1a[_0x1e501e(0x164)]),{'enabled':!![]};}async['disable2FA'](_0x2ea0c3){const _0x58b8e3=a82_0x5eb819,_0x5822a4=await database_1[_0x58b8e3(0xd1)][_0x58b8e3(0x122)][_0x58b8e3(0x112)]({'where':{'id':_0x2ea0c3},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5822a4)throw new Error(_0x58b8e3(0xaf));await database_1[_0x58b8e3(0xd1)]['shop'][_0x58b8e3(0x12b)]({'where':{'id':_0x2ea0c3},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x58b8e3(0x14c)](_0x58b8e3(0xaa)+_0x5822a4[_0x58b8e3(0x164)]);}}function a82_0x2b2e(_0x1d0199,_0xaa3f81){_0x1d0199=_0x1d0199-0xa0;const _0x2073ab=a82_0x2073();let _0x2b2eee=_0x2073ab[_0x1d0199];return _0x2b2eee;}function a82_0x2073(){const _0x59570f=['Shop\x20not\x20found','üìÖ\x20Final\x20date\x20range:\x20','getMonth','country','generateSecret','paid','error','erc20','2FA\x20is\x20already\x20enabled','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','3531592ejJHVR','language','toISOString','redirectUrl','toLowerCase','sourceCurrency','usage','ShopService','asc','\x20USDT\x20(current\x20balance)','customerName','Plisio','dailyPayments','randomBytes','polygon_usdc','USDT\x20ERC20','generateDailyStatistics','filter','hex','all_time','__esModule','txid','PAID','shopUrl','default','paymentService','getUTCMonth','getUTCDate','map','isArray','\x20backup\x20codes','shopId','14JoxUck','all','test_payment_123','getPayoutById','getWebhookLogs','findMany','2FA\x20token\x20is\x20required','110238fhIWRc','paymentId','usdtTrcWallet','webhookLog','base32','twoFactorSecret','testWebhook','expiresAt','getPayoutStatistics','_sum','8381706lBBsNY','telegram','getPayouts','webhookUrl','USDT\x20BSC','396230GpGSfV','REJECTED','defineProperty','totp','KLYME\x20EU','reduce','getUTCDay','getPaymentById','Webhook\x20returned\x20error:\x20','getStatistics','üìä\x20Final\x20WHERE\x20conditions:','getFullYear','formatNetworkName','test_gateway','gatewaySettings','dailyRevenue','Noda','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','getGatewayDisplayName','get','amountIsEditable','\x20to\x20','push','Rapyd','awaitingPayout','webhookEvents','stringify','test_order_123','USD','YESTERDAY','retryCount','7eUqjsE','usdtPolygonWallet','balance','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','findUnique','setHours','No\x20webhook\x20URL\x20configured','USDC\x20Polygon','49965Zaptwb','usdcErcWallet','gte','üìÖ\x20Date\x20end:\x20','toUpperCase','üîê\x202FA\x20enabled\x20for\x20shop:\x20','getDate','findFirst','updatePayment','parse','round','telegramId','shop','desc','responseBody','splice','üîë\x20Generated\x20','COMPLETED','USDT\x20Polygon','event','maxPayments','update','updateWallets','gateway','replace','createPayment','createHmac','üìä\x20Getting\x20statistics\x20for\x20shop\x20','UTC','\x20payout\x20statistics\x20calculated:','payout','currencyService','\x20USDT','lte','wallets','toString','publicKey','custom_','qrcode','setUTCDate','verify','Failed\x20to\x20send\x20webhook:\x20','includes','crypto','yesterday','\x20\x20\x20üìÖ\x20This\x20month:\x20','setDate','split','\x20USDT\x20(total\x20payouts)','isActive','set','statusText','count','üí∞\x20Getting\x20payouts\x20with\x20filters:','log','getShopProfile','customerEmail','getTime','REFUND','üìÖ\x20Custom\x20period:\x20','amountUSDT','90d','totalPaidOut','160gRWSVU','test','payment','merchantUrl',',\x20period:\x20','speakeasy',',\x20dateTo:\x20','üåê\x20Method\x20filter:\x20','Test\x20Gateway','otpauth_url','generateBackupCodes','90PQqGOV','18808955jXAvbX','3896850xhBDCX','Error\x20parsing\x20webhook\x20events:','username','notes','CoinToPay','AVAILABLE_GATEWAYS','sha256','__importDefault','currency','Unknown\x20error','getPaymentsByShop','CHARGEBACK','hash','trc20','PENDING','getPaymentByShopAndId','usdcPolygonWallet','name','üìÖ\x20Custom\x20date\x20range:\x20','twoFactorToken','./currencyService','polygon','network','POST','amount','üìÖ\x20Period\x20end:\x20','USDC\x20Ethereum','ceil','USDT\x20TRC20','Payment\x20not\x20found','../types/gateway','Invalid\x202FA\x20token','revenue','digest','application/json',',\x20dateFrom:\x20','amountAfterGatewayCommissionUSDT','createdAt','usdtErcWallet','settings','üìä\x20Status\x20filter:\x20','paidAt','üåê\x20Network\x20filter:\x20','status','üìÖ\x20Date\x20start:\x20','gateways','EXPIRED','fullName','getUTCFullYear','bcryptjs','thisMonth','getPayoutStats','enable2FA','Test\x20webhook\x20sent\x20successfully\x20(','this_month','üîê\x202FA\x20disabled\x20for\x20shop:\x20','secretKey','customer','paymentGateways','backupCodes'];a82_0x2073=function(){return _0x59570f;};return a82_0x2073();}exports['ShopService']=ShopService;