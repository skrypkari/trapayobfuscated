'use strict';const a60_0x45a692=a60_0x4bf9;(function(_0x2b87fc,_0x22c90a){const _0x4dd94e=a60_0x4bf9,_0x169378=_0x2b87fc();while(!![]){try{const _0x458ac5=-parseInt(_0x4dd94e(0x100))/0x1*(parseInt(_0x4dd94e(0xcb))/0x2)+-parseInt(_0x4dd94e(0xe3))/0x3*(-parseInt(_0x4dd94e(0x7c))/0x4)+parseInt(_0x4dd94e(0xe6))/0x5*(parseInt(_0x4dd94e(0xfc))/0x6)+-parseInt(_0x4dd94e(0x11b))/0x7*(parseInt(_0x4dd94e(0x12f))/0x8)+-parseInt(_0x4dd94e(0xa1))/0x9*(parseInt(_0x4dd94e(0x8a))/0xa)+-parseInt(_0x4dd94e(0x80))/0xb*(-parseInt(_0x4dd94e(0x119))/0xc)+parseInt(_0x4dd94e(0xfd))/0xd;if(_0x458ac5===_0x22c90a)break;else _0x169378['push'](_0x169378['shift']());}catch(_0xea54c8){_0x169378['push'](_0x169378['shift']());}}}(a60_0x1d63,0x8ad78));var __importDefault=this&&this[a60_0x45a692(0xa0)]||function(_0x292ca6){const _0x44da27=a60_0x45a692;return _0x292ca6&&_0x292ca6[_0x44da27(0x117)]?_0x292ca6:{'default':_0x292ca6};};function a60_0x4bf9(_0x35a3cc,_0x470ae7){const _0x1d6375=a60_0x1d63();return a60_0x4bf9=function(_0x4bf909,_0x741890){_0x4bf909=_0x4bf909-0x75;let _0x2e318c=_0x1d6375[_0x4bf909];return _0x2e318c;},a60_0x4bf9(_0x35a3cc,_0x470ae7);}Object[a60_0x45a692(0xb4)](exports,a60_0x45a692(0x117),{'value':!![]}),exports[a60_0x45a692(0x12e)]=void 0x0;function a60_0x1d63(){const _0xf61b95=['status','1330yZgrog','updateWallets','30d','usage','settings','Payment\x20System/1.0\x20(Test)','getTime','toLowerCase','polygon','createdAt','PaymentService','currency','updatePayment','trc20','getPaymentByShopAndId','\x20\x20\x20üìÖ\x20This\x20month:\x20','erc20','yesterday','name','ShopService','7136yRijhi','country','setDate','ceil','log','No\x20webhook\x20URL\x20configured','count','reduce','getShopProfile','344452XLIoAK','set','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','dailyRevenue','253nMZfxl','üåê\x20Method\x20filter:\x20','_sum','message','getGatewayDisplayName','USDT\x20ERC20','PENDING','gatewaySettings','gateway','telegram','20yGqXtB','...','getPayoutStats','publicKey','customerName','isArray','round','generateDailyStatistics','\x20\x20\x20üíµ\x20Available\x20balance:\x20','getPayoutById','usdtErcWallet','Rapyd','../config/database','paidAt','findMany','getPayoutStatistics','Failed\x20to\x20send\x20webhook:\x20','all','filter','Unknown\x20error','COMPLETED','shopId','__importDefault','4758687qfFdfY','error','Noda','getDate','üìä\x20Final\x20WHERE\x20conditions:','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','CoinToPay','lte','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','setHours','stringify','paymentGateways','REJECTED','üìä\x20Shop\x20','revenue','getWebhookLogs','gateways','amountIsEditable','getMonth','defineProperty','findFirst','split','üìÖ\x20Date\x20end:\x20','./currencyService','getShopPayoutStats','delete','update','webhookLog','currencyService','POST','event','getPaymentById','usdtPolygonWallet','usdcPolygonWallet','usdtTrcWallet','fullName','getPayouts','polygon_usdc','test','Plisio','test_gateway','Test\x20webhook\x20sent\x20successfully\x20(','202696WBAmXQ','üí∞\x20Getting\x20payouts\x20with\x20filters:','telegramId','day','application/json','availableBalance','sourceCurrency','statusCode','shopUrl','paymentId','network','webhookUrl','map','dailyPayments','toUpperCase','payout','getStatistics','webhookEvents','Payment\x20not\x20found','\x20USDT\x20(current\x20balance)','PAID','merchantUrl','Error\x20parsing\x20webhook\x20events:','amount','12AZbfeq','test_order_123','aggregate','5gjdJDJ','KLYME\x20GB','findUnique','desc','\x20USDT\x20(total\x20payouts)','default','totalPaidOut','createPayment','toISOString','gte','language','wallets','üìÖ\x20Period\x20end:\x20','push','Shop\x20not\x20found','createPublicPayment','amountUSDT','getPayments','periodFrom','üìÖ\x20Period\x20start:\x20','./paymentService','thisMonth','6670746zfnyFr','12603188aDTAUD','Test\x20Gateway','retryCount','11vElkLg','shop','üìÖ\x20Date\x20start:\x20','USD','asc','KLYME\x20EU','payment','90d','USDC\x20Polygon','parse','customerEmail','USDT\x20BSC','test_payment_123','paymentService','notes','txid','get','balance','YESTERDAY','statusText','getFullYear','üìä\x20Status\x20filter:\x20','username','__esModule','customer','252924GdFmaH'];a60_0x1d63=function(){return _0xf61b95;};return a60_0x1d63();}const database_1=__importDefault(require(a60_0x45a692(0x96))),currencyService_1=require(a60_0x45a692(0xb8)),paymentService_1=require(a60_0x45a692(0xfa));class ShopService{constructor(){const _0x335ff5=a60_0x45a692;this[_0x335ff5(0x10d)]=new paymentService_1[(_0x335ff5(0x125))]();}async[a60_0x45a692(0x7b)](_0x1e5dae){const _0x1508a1=a60_0x45a692,_0xdd8eb9=await database_1['default'][_0x1508a1(0x101)][_0x1508a1(0xe8)]({'where':{'id':_0x1e5dae},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0xdd8eb9)throw new Error(_0x1508a1(0xf4));let _0x372afc=[];if(_0xdd8eb9[_0x1508a1(0x11f)]?.[_0x1508a1(0xdc)])try{_0x372afc=Array[_0x1508a1(0x8f)](_0xdd8eb9[_0x1508a1(0x11f)][_0x1508a1(0xdc)])?_0xdd8eb9['settings'][_0x1508a1(0xdc)]:JSON['parse'](_0xdd8eb9[_0x1508a1(0x11f)][_0x1508a1(0xdc)]);}catch(_0x2ced37){console[_0x1508a1(0xa2)](_0x1508a1(0xe1),_0x2ced37),_0x372afc=[];}return{'id':_0xdd8eb9['id'],'fullName':_0xdd8eb9[_0x1508a1(0x12d)],'username':_0xdd8eb9[_0x1508a1(0x116)],'telegramId':_0xdd8eb9[_0x1508a1(0x89)],'merchantUrl':_0xdd8eb9[_0x1508a1(0xd3)],'gateways':_0xdd8eb9[_0x1508a1(0xac)]?JSON[_0x1508a1(0x109)](_0xdd8eb9[_0x1508a1(0xac)]):null,'gatewaySettings':_0xdd8eb9[_0x1508a1(0x87)]?JSON['parse'](_0xdd8eb9[_0x1508a1(0x87)]):null,'publicKey':_0xdd8eb9[_0x1508a1(0x8d)],'webhookUrl':_0xdd8eb9[_0x1508a1(0x11f)]?.[_0x1508a1(0xd6)]||null,'webhookEvents':_0x372afc,'wallets':{'usdtPolygonWallet':_0xdd8eb9[_0x1508a1(0xc1)],'usdtTrcWallet':_0xdd8eb9['usdtTrcWallet'],'usdtErcWallet':_0xdd8eb9[_0x1508a1(0x94)],'usdcPolygonWallet':_0xdd8eb9[_0x1508a1(0xc2)]},'status':_0xdd8eb9[_0x1508a1(0x11a)],'createdAt':_0xdd8eb9[_0x1508a1(0x124)]};}async['updateShopProfile'](_0x4847ad,_0x47dd7e){const _0xf98ccd=a60_0x45a692,_0x1f740f={};_0x47dd7e[_0xf98ccd(0xc4)]&&(_0x1f740f['name']=_0x47dd7e[_0xf98ccd(0xc4)]);_0x47dd7e[_0xf98ccd(0xcd)]!==undefined&&(_0x1f740f[_0xf98ccd(0x89)]=_0x47dd7e[_0xf98ccd(0xcd)]||null);_0x47dd7e[_0xf98ccd(0xe0)]&&(_0x1f740f[_0xf98ccd(0xd3)]=_0x47dd7e[_0xf98ccd(0xe0)]);_0x47dd7e[_0xf98ccd(0xb1)]&&(_0x1f740f[_0xf98ccd(0xac)]=JSON['stringify'](_0x47dd7e[_0xf98ccd(0xb1)]));_0x47dd7e[_0xf98ccd(0x87)]&&(_0x1f740f[_0xf98ccd(0x87)]=JSON[_0xf98ccd(0xab)](_0x47dd7e[_0xf98ccd(0x87)]));_0x47dd7e['wallets']&&(_0x47dd7e[_0xf98ccd(0xf1)][_0xf98ccd(0xc1)]!==undefined&&(_0x1f740f[_0xf98ccd(0xc1)]=_0x47dd7e[_0xf98ccd(0xf1)][_0xf98ccd(0xc1)]||null),_0x47dd7e[_0xf98ccd(0xf1)][_0xf98ccd(0xc3)]!==undefined&&(_0x1f740f[_0xf98ccd(0xc3)]=_0x47dd7e[_0xf98ccd(0xf1)][_0xf98ccd(0xc3)]||null),_0x47dd7e[_0xf98ccd(0xf1)][_0xf98ccd(0x94)]!==undefined&&(_0x1f740f[_0xf98ccd(0x94)]=_0x47dd7e[_0xf98ccd(0xf1)][_0xf98ccd(0x94)]||null),_0x47dd7e[_0xf98ccd(0xf1)][_0xf98ccd(0xc2)]!==undefined&&(_0x1f740f['usdcPolygonWallet']=_0x47dd7e[_0xf98ccd(0xf1)]['usdcPolygonWallet']||null));const _0x16cc75=await database_1[_0xf98ccd(0xeb)][_0xf98ccd(0x101)][_0xf98ccd(0xbb)]({'where':{'id':_0x4847ad},'data':_0x1f740f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x4c497c=[];if(_0x16cc75[_0xf98ccd(0x11f)]?.[_0xf98ccd(0xdc)])try{_0x4c497c=Array['isArray'](_0x16cc75[_0xf98ccd(0x11f)][_0xf98ccd(0xdc)])?_0x16cc75[_0xf98ccd(0x11f)][_0xf98ccd(0xdc)]:JSON['parse'](_0x16cc75['settings'][_0xf98ccd(0xdc)]);}catch(_0x5cc5e4){console['error']('Error\x20parsing\x20webhook\x20events:',_0x5cc5e4),_0x4c497c=[];}return{'id':_0x16cc75['id'],'fullName':_0x16cc75[_0xf98ccd(0x12d)],'username':_0x16cc75['username'],'telegramId':_0x16cc75[_0xf98ccd(0x89)],'merchantUrl':_0x16cc75[_0xf98ccd(0xd3)],'gateways':_0x16cc75[_0xf98ccd(0xac)]?JSON[_0xf98ccd(0x109)](_0x16cc75['paymentGateways']):null,'gatewaySettings':_0x16cc75[_0xf98ccd(0x87)]?JSON[_0xf98ccd(0x109)](_0x16cc75[_0xf98ccd(0x87)]):null,'publicKey':_0x16cc75['publicKey'],'webhookUrl':_0x16cc75[_0xf98ccd(0x11f)]?.[_0xf98ccd(0xd6)]||null,'webhookEvents':_0x4c497c,'wallets':{'usdtPolygonWallet':_0x16cc75[_0xf98ccd(0xc1)],'usdtTrcWallet':_0x16cc75[_0xf98ccd(0xc3)],'usdtErcWallet':_0x16cc75[_0xf98ccd(0x94)],'usdcPolygonWallet':_0x16cc75[_0xf98ccd(0xc2)]},'status':_0x16cc75[_0xf98ccd(0x11a)],'createdAt':_0x16cc75[_0xf98ccd(0x124)]};}async[a60_0x45a692(0x11c)](_0x17b4d7,_0x35199c){const _0x55b01a=a60_0x45a692,_0x3a55cf={};_0x35199c[_0x55b01a(0xc1)]!==undefined&&(_0x3a55cf['usdtPolygonWallet']=_0x35199c['usdtPolygonWallet']||null),_0x35199c[_0x55b01a(0xc3)]!==undefined&&(_0x3a55cf[_0x55b01a(0xc3)]=_0x35199c[_0x55b01a(0xc3)]||null),_0x35199c['usdtErcWallet']!==undefined&&(_0x3a55cf['usdtErcWallet']=_0x35199c[_0x55b01a(0x94)]||null),_0x35199c['usdcPolygonWallet']!==undefined&&(_0x3a55cf[_0x55b01a(0xc2)]=_0x35199c[_0x55b01a(0xc2)]||null),await database_1['default'][_0x55b01a(0x101)][_0x55b01a(0xbb)]({'where':{'id':_0x17b4d7},'data':_0x3a55cf});}async['testWebhook'](_0x1ca88b){const _0x92d956=a60_0x45a692,_0x2f5b41=await database_1[_0x92d956(0xeb)][_0x92d956(0x101)][_0x92d956(0xe8)]({'where':{'id':_0x1ca88b},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x2f5b41?.[_0x92d956(0x11f)]?.[_0x92d956(0xd6)])throw new Error(_0x92d956(0x78));const _0x36b504={'event':_0x92d956(0xc7),'payment':{'id':_0x92d956(0x10c),'order_id':_0x92d956(0xe4),'gateway':_0x92d956(0xc7),'amount':0x64,'currency':_0x92d956(0x103),'status':'paid','created_at':new Date()[_0x92d956(0xee)]()}};try{const _0x2a223a=await fetch(_0x2f5b41['settings']['webhookUrl'],{'method':_0x92d956(0xbe),'headers':{'Content-Type':_0x92d956(0xcf),'User-Agent':_0x92d956(0x120)},'body':JSON['stringify'](_0x36b504)});return _0x2a223a['ok']?{'success':!![],'message':_0x92d956(0xca)+_0x2a223a[_0x92d956(0x11a)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x2a223a[_0x92d956(0x11a)]+'\x20'+_0x2a223a[_0x92d956(0x113)]};}catch(_0x2a773c){return{'success':![],'message':_0x92d956(0x9a)+(_0x2a773c instanceof Error?_0x2a773c[_0x92d956(0x83)]:_0x92d956(0x9d))};}}async[a60_0x45a692(0xed)](_0x1a5059){const _0x152d77=a60_0x45a692;return this[_0x152d77(0x10d)][_0x152d77(0xf5)]({'public_key':'','gateway':_0x1a5059[_0x152d77(0x88)],'order_id':undefined,'amount':_0x1a5059[_0x152d77(0xe2)],'currency':_0x1a5059[_0x152d77(0x126)],'source_currency':_0x1a5059[_0x152d77(0xd1)],'usage':_0x1a5059[_0x152d77(0x11e)],'expires_at':_0x1a5059['expiresAt']?.['toISOString'](),'success_url':_0x1a5059['redirectUrl'],'fail_url':_0x1a5059['redirectUrl'],'customer_email':_0x1a5059[_0x152d77(0x10a)],'customer_name':_0x1a5059[_0x152d77(0x8e)],'country':_0x1a5059[_0x152d77(0x130)],'language':_0x1a5059[_0x152d77(0xf0)],'amount_is_editable':_0x1a5059[_0x152d77(0xb2)],'max_payments':_0x1a5059['maxPayments'],'customer':_0x1a5059[_0x152d77(0x118)]});}async[a60_0x45a692(0xf7)](_0x51d376,_0x23f976){return this['paymentService']['getPaymentsByShop'](_0x51d376,_0x23f976);}async[a60_0x45a692(0xc0)](_0x5e6126,_0x20b507){const _0x120d2f=a60_0x45a692;return this[_0x120d2f(0x10d)][_0x120d2f(0x129)](_0x5e6126,_0x20b507);}async[a60_0x45a692(0x127)](_0x4e82a3,_0x5d740d,_0x53c6fb){const _0x436938=a60_0x45a692,_0x6087a6=await database_1[_0x436938(0xeb)][_0x436938(0x106)][_0x436938(0xb5)]({'where':{'id':_0x5d740d,'shopId':_0x4e82a3}});if(!_0x6087a6)throw new Error(_0x436938(0xdd));const _0x20cc11=await database_1[_0x436938(0xeb)][_0x436938(0x106)][_0x436938(0xbb)]({'where':{'id':_0x5d740d},'data':{..._0x53c6fb,'updatedAt':new Date()}});return _0x20cc11;}async['deletePayment'](_0x5f5c1e,_0x59156b){const _0x185275=a60_0x45a692,_0x56c6e9=await database_1[_0x185275(0xeb)][_0x185275(0x106)][_0x185275(0xb5)]({'where':{'id':_0x59156b,'shopId':_0x5f5c1e}});if(!_0x56c6e9)throw new Error(_0x185275(0xdd));await database_1[_0x185275(0xeb)][_0x185275(0x106)][_0x185275(0xba)]({'where':{'id':_0x59156b}});}['formatNetworkName'](_0x7c4df7){const _0x1d6dff=a60_0x45a692,_0x5211b5={'polygon':'USDT\x20Polygon','trc20':'USDT\x20TRC20','erc20':_0x1d6dff(0x85),'bsc':_0x1d6dff(0x10b),'polygon_usdc':_0x1d6dff(0x108)};return _0x5211b5[_0x7c4df7]||_0x7c4df7;}async[a60_0x45a692(0xc5)](_0x207ed4,_0x4860a4){const _0x2b6b85=a60_0x45a692,{page:_0x9db5b4,limit:_0x1b8b59,status:_0x516902,method:_0x4298f7,network:_0x53561e,dateFrom:_0x4a5f44,dateTo:_0x3a4092,periodFrom:_0x3cdeaf,periodTo:_0x48e1d4}=_0x4860a4,_0x396d15=(_0x9db5b4-0x1)*_0x1b8b59;console['log'](_0x2b6b85(0xcc),_0x4860a4);const _0x4a4d3c={'shopId':_0x207ed4};_0x516902&&(_0x4a4d3c[_0x2b6b85(0x11a)]=_0x516902[_0x2b6b85(0xd9)](),console[_0x2b6b85(0x77)](_0x2b6b85(0x115)+_0x516902['toUpperCase']()));if(_0x4298f7)_0x4a4d3c[_0x2b6b85(0xd5)]=_0x4298f7,console[_0x2b6b85(0x77)](_0x2b6b85(0x81)+_0x4298f7);else _0x53561e&&(_0x4a4d3c[_0x2b6b85(0xd5)]=_0x53561e,console[_0x2b6b85(0x77)]('üåê\x20Network\x20filter:\x20'+_0x53561e));if(_0x4a5f44||_0x3a4092||_0x3cdeaf||_0x48e1d4){_0x4a4d3c['createdAt']={};if(_0x3cdeaf){const _0x26e605=new Date(_0x3cdeaf);_0x26e605['setHours'](0x0,0x0,0x0,0x0),_0x4a4d3c[_0x2b6b85(0x124)][_0x2b6b85(0xef)]=_0x26e605,console['log'](_0x2b6b85(0xf9)+_0x26e605[_0x2b6b85(0xee)]());}else{if(_0x4a5f44){const _0x1e8904=new Date(_0x4a5f44);_0x1e8904[_0x2b6b85(0xaa)](0x0,0x0,0x0,0x0),_0x4a4d3c[_0x2b6b85(0x124)][_0x2b6b85(0xef)]=_0x1e8904,console[_0x2b6b85(0x77)](_0x2b6b85(0x102)+_0x1e8904[_0x2b6b85(0xee)]());}}if(_0x48e1d4){const _0x4153f8=new Date(_0x48e1d4);_0x4153f8[_0x2b6b85(0xaa)](0x17,0x3b,0x3b,0x3e7),_0x4a4d3c[_0x2b6b85(0x124)]['lte']=_0x4153f8,console['log'](_0x2b6b85(0xf2)+_0x4153f8[_0x2b6b85(0xee)]());}else{if(_0x3a4092){const _0x137391=new Date(_0x3a4092);_0x137391[_0x2b6b85(0xaa)](0x17,0x3b,0x3b,0x3e7),_0x4a4d3c[_0x2b6b85(0x124)][_0x2b6b85(0xa8)]=_0x137391,console[_0x2b6b85(0x77)](_0x2b6b85(0xb7)+_0x137391[_0x2b6b85(0xee)]());}}}console[_0x2b6b85(0x77)](_0x2b6b85(0xa5),JSON['stringify'](_0x4a4d3c,null,0x2));const [_0x36c5dd,_0x25af5a]=await Promise[_0x2b6b85(0x9b)]([database_1[_0x2b6b85(0xeb)]['payout']['findMany']({'where':_0x4a4d3c,'skip':_0x396d15,'take':_0x1b8b59,'orderBy':{'createdAt':_0x2b6b85(0xe9)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x2b6b85(0xeb)]['payout']['count']({'where':_0x4a4d3c})]);return{'payouts':_0x36c5dd[_0x2b6b85(0xd7)](_0x22142d=>{const _0x5bce6e=_0x2b6b85;let _0x124444=null;switch(_0x22142d['network']){case _0x5bce6e(0x123):_0x124444=_0x22142d[_0x5bce6e(0x101)][_0x5bce6e(0xc1)];break;case _0x5bce6e(0x128):_0x124444=_0x22142d[_0x5bce6e(0x101)][_0x5bce6e(0xc3)];break;case _0x5bce6e(0x12b):_0x124444=_0x22142d[_0x5bce6e(0x101)][_0x5bce6e(0x94)];break;case _0x5bce6e(0xc6):_0x124444=_0x22142d[_0x5bce6e(0x101)][_0x5bce6e(0xc2)];break;}return{'id':_0x22142d['id'],'amount':_0x22142d[_0x5bce6e(0xe2)],'network':this['formatNetworkName'](_0x22142d[_0x5bce6e(0xd5)]),'wallet':_0x124444,'status':_0x22142d[_0x5bce6e(0x11a)],'txid':_0x22142d[_0x5bce6e(0x10f)],'notes':_0x22142d[_0x5bce6e(0x10e)],'periodFrom':_0x22142d[_0x5bce6e(0xf8)],'periodTo':_0x22142d['periodTo'],'createdAt':_0x22142d[_0x5bce6e(0x124)],'paidAt':_0x22142d[_0x5bce6e(0x97)]};}),'pagination':{'page':_0x9db5b4,'limit':_0x1b8b59,'total':_0x25af5a,'totalPages':Math[_0x2b6b85(0x76)](_0x25af5a/_0x1b8b59)}};}async[a60_0x45a692(0x93)](_0x3ea05a,_0xaa47e5){const _0x6db24=a60_0x45a692,_0xc12b5c=await database_1['default']['payout'][_0x6db24(0xb5)]({'where':{'id':_0xaa47e5,'shopId':_0x3ea05a}});if(!_0xc12b5c)return null;return{'id':_0xc12b5c['id'],'amount':_0xc12b5c[_0x6db24(0xe2)],'network':_0xc12b5c[_0x6db24(0xd5)],'status':_0xc12b5c[_0x6db24(0x11a)],'txid':_0xc12b5c[_0x6db24(0x10f)],'notes':_0xc12b5c[_0x6db24(0x10e)],'createdAt':_0xc12b5c[_0x6db24(0x124)],'paidAt':_0xc12b5c[_0x6db24(0x97)]};}async[a60_0x45a692(0x99)](_0x36c446,_0x32a61a){const _0x5c3c57=a60_0x45a692,_0x22ecf4=new Date();let _0x125040,_0x41b2b0;switch(_0x32a61a){case _0x5c3c57(0x12c):case _0x5c3c57(0x112):const _0x1269a9=new Date(_0x22ecf4);_0x1269a9[_0x5c3c57(0x75)](_0x1269a9[_0x5c3c57(0xa4)]()-0x1),_0x125040=new Date(_0x1269a9),_0x125040[_0x5c3c57(0xaa)](0x0,0x0,0x0,0x0),_0x41b2b0=new Date(_0x1269a9),_0x41b2b0[_0x5c3c57(0xaa)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x125040=new Date(_0x22ecf4[_0x5c3c57(0x121)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5c3c57(0x11d):_0x125040=new Date(_0x22ecf4[_0x5c3c57(0x121)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5c3c57(0x107):_0x125040=new Date(_0x22ecf4[_0x5c3c57(0x121)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x125040=new Date(_0x22ecf4['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x2a90c4={'gte':_0x125040};_0x41b2b0&&(_0x2a90c4[_0x5c3c57(0xa8)]=_0x41b2b0);const [_0x5c203a,_0xa90577,_0x11f19b,_0x3bc07f,_0x4bea7b,_0x524867]=await Promise[_0x5c3c57(0x9b)]([database_1[_0x5c3c57(0xeb)][_0x5c3c57(0xda)][_0x5c3c57(0x79)]({'where':{'shopId':_0x36c446,'createdAt':_0x2a90c4}}),database_1[_0x5c3c57(0xeb)][_0x5c3c57(0xda)][_0x5c3c57(0x79)]({'where':{'shopId':_0x36c446,'status':_0x5c3c57(0x9e),'createdAt':_0x2a90c4}}),database_1['default'][_0x5c3c57(0xda)][_0x5c3c57(0x79)]({'where':{'shopId':_0x36c446,'status':'PENDING','createdAt':_0x2a90c4}}),database_1[_0x5c3c57(0xeb)][_0x5c3c57(0xda)][_0x5c3c57(0x79)]({'where':{'shopId':_0x36c446,'status':_0x5c3c57(0xad),'createdAt':_0x2a90c4}}),database_1['default'][_0x5c3c57(0xda)][_0x5c3c57(0x98)]({'where':{'shopId':_0x36c446,'createdAt':_0x2a90c4},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x5c3c57(0xeb)][_0x5c3c57(0xda)][_0x5c3c57(0x98)]({'where':{'shopId':_0x36c446},'take':0xa,'orderBy':{'createdAt':_0x5c3c57(0xe9)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x40b2dc=_0x4bea7b[_0x5c3c57(0x7a)]((_0x5d040a,_0x162da1)=>_0x5d040a+_0x162da1[_0x5c3c57(0xe2)],0x0),_0x2aa04d=_0x4bea7b[_0x5c3c57(0x9c)](_0x2ee185=>_0x2ee185[_0x5c3c57(0x11a)]===_0x5c3c57(0x9e))[_0x5c3c57(0x7a)]((_0xfb95f9,_0x14ed7c)=>_0xfb95f9+_0x14ed7c[_0x5c3c57(0xe2)],0x0),_0x5e7c98=_0x4bea7b['filter'](_0x65e786=>_0x65e786['status']===_0x5c3c57(0x86))['reduce']((_0x579ff6,_0x2c8714)=>_0x579ff6+_0x2c8714['amount'],0x0),_0x3b19b3=_0x4bea7b[_0x5c3c57(0x7a)]((_0x5f2ea3,_0x40eae)=>{const _0x3e88fa=_0x5c3c57;return _0x5f2ea3[_0x40eae[_0x3e88fa(0xd5)]]=(_0x5f2ea3[_0x40eae[_0x3e88fa(0xd5)]]||0x0)+0x1,_0x5f2ea3;},{}),_0x347b84=_0x4bea7b['reduce']((_0x3010e3,_0x3be8c7)=>{const _0x1f3653=_0x5c3c57;return _0x3010e3[_0x3be8c7[_0x1f3653(0x11a)]]=(_0x3010e3[_0x3be8c7['status']]||0x0)+0x1,_0x3010e3;},{});return{'totalPayouts':_0x5c203a,'completedPayouts':_0xa90577,'pendingPayouts':_0x11f19b,'rejectedPayouts':_0x3bc07f,'totalAmount':_0x40b2dc,'completedAmount':_0x2aa04d,'pendingAmount':_0x5e7c98,'payoutsByMethod':_0x3b19b3,'payoutsByStatus':_0x347b84,'recentPayouts':_0x524867['map'](_0x5c68dd=>({'id':_0x5c68dd['id'],'shopId':_0x36c446,'amount':_0x5c68dd[_0x5c3c57(0xe2)],'method':_0x5c68dd[_0x5c3c57(0xd5)],'status':_0x5c68dd[_0x5c3c57(0x11a)],'txid':_0x5c68dd[_0x5c3c57(0x10f)],'createdAt':_0x5c68dd['createdAt'],'paidAt':_0x5c68dd['paidAt']}))};}async[a60_0x45a692(0xb9)](_0x2009c3){const _0xdbe151=a60_0x45a692;console[_0xdbe151(0x77)](_0xdbe151(0xa6)+_0x2009c3+_0xdbe151(0x8b));const _0x38003b=await database_1[_0xdbe151(0xeb)][_0xdbe151(0x101)]['findUnique']({'where':{'id':_0x2009c3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x38003b)throw new Error(_0xdbe151(0xf4));const _0x5a308c=new Date(),_0x3ad926=new Date(_0x5a308c[_0xdbe151(0x114)](),_0x5a308c[_0xdbe151(0xb3)](),0x1),_0x5fa910=new Date(_0x5a308c['getFullYear'](),_0x5a308c['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x22322d=await database_1[_0xdbe151(0xeb)][_0xdbe151(0xda)][_0xdbe151(0xe5)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2009c3,'createdAt':{'gte':_0x3ad926,'lte':_0x5fa910},'status':_0xdbe151(0x9e)}}),_0x2c6ecc=_0x22322d[_0xdbe151(0x82)][_0xdbe151(0xe2)]||0x0,_0x1125d6={'availableBalance':Math[_0xdbe151(0x90)](_0x38003b[_0xdbe151(0x111)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x38003b[_0xdbe151(0xec)]*0x64)/0x64,'awaitingPayout':Math[_0xdbe151(0x90)](_0x38003b['balance']*0x64)/0x64,'thisMonth':Math[_0xdbe151(0x90)](_0x2c6ecc*0x64)/0x64};return console[_0xdbe151(0x77)](_0xdbe151(0xae)+_0x38003b['username']+'\x20payout\x20statistics\x20calculated:'),console['log'](_0xdbe151(0x92)+_0x1125d6[_0xdbe151(0xd0)]+_0xdbe151(0xde)),console[_0xdbe151(0x77)](_0xdbe151(0xa9)+_0x1125d6[_0xdbe151(0xec)]+_0xdbe151(0xea)),console[_0xdbe151(0x77)](_0xdbe151(0x7e)+_0x1125d6['awaitingPayout']+'\x20USDT\x20(current\x20balance)'),console[_0xdbe151(0x77)](_0xdbe151(0x12a)+_0x1125d6[_0xdbe151(0xfb)]+'\x20USDT'),_0x1125d6;}[a60_0x45a692(0x84)](_0x454a56){const _0x5e2346=a60_0x45a692,_0x1276cf={'test_gateway':_0x5e2346(0xfe),'plisio':_0x5e2346(0xc8),'rapyd':_0x5e2346(0x95),'noda':_0x5e2346(0xa3),'cointopay':_0x5e2346(0xa7),'klyme_eu':_0x5e2346(0x105),'klyme_gb':_0x5e2346(0xe7),'klyme_de':'KLYME\x20DE'};return _0x1276cf[_0x454a56]||_0x454a56;}async[a60_0x45a692(0x8c)](_0x2aa962){const _0x2e8b41=a60_0x45a692;return this[_0x2e8b41(0xb9)](_0x2aa962);}async[a60_0x45a692(0xb0)](_0x56fb3f,_0x28b631){const _0x57330d=a60_0x45a692,{page:_0x3db3aa,limit:_0x441f53,paymentId:_0x343708}=_0x28b631,_0x247200=(_0x3db3aa-0x1)*_0x441f53,_0x4bc5a3={'shopId':_0x56fb3f};_0x343708&&(_0x4bc5a3['paymentId']=_0x343708);const [_0x5086cc,_0x2af15a]=await Promise[_0x57330d(0x9b)]([database_1[_0x57330d(0xeb)][_0x57330d(0xbc)]['findMany']({'where':_0x4bc5a3,'skip':_0x247200,'take':_0x441f53,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x57330d(0xeb)][_0x57330d(0xbc)][_0x57330d(0x79)]({'where':_0x4bc5a3})]);return{'logs':_0x5086cc[_0x57330d(0xd7)](_0x38e884=>({'id':_0x38e884['id'],'paymentId':_0x38e884[_0x57330d(0xd4)],'shopId':_0x38e884[_0x57330d(0x9f)],'event':_0x38e884[_0x57330d(0xbf)],'statusCode':_0x38e884[_0x57330d(0xd2)],'retryCount':_0x38e884[_0x57330d(0xff)],'responseBody':_0x38e884['responseBody'],'createdAt':_0x38e884[_0x57330d(0x124)],'payment':_0x38e884['payment']})),'pagination':{'page':_0x3db3aa,'limit':_0x441f53,'total':_0x2af15a,'totalPages':Math[_0x57330d(0x76)](_0x2af15a/_0x441f53)}};}async[a60_0x45a692(0xdb)](_0x1c6b87,_0x131f7c){const _0x1fea6c=a60_0x45a692,_0x2fb1ce=new Date();let _0x475cd9,_0x1497c1;switch(_0x131f7c[_0x1fea6c(0x122)]()){case _0x1fea6c(0xce):_0x475cd9=new Date(_0x2fb1ce[_0x1fea6c(0x114)](),_0x2fb1ce[_0x1fea6c(0xb3)](),_0x2fb1ce[_0x1fea6c(0xa4)](),0x0,0x0,0x0,0x0);break;case _0x1fea6c(0x12c):case _0x1fea6c(0x112):const _0x330ff5=new Date(_0x2fb1ce);_0x330ff5[_0x1fea6c(0x75)](_0x330ff5[_0x1fea6c(0xa4)]()-0x1),_0x475cd9=new Date(_0x330ff5),_0x475cd9[_0x1fea6c(0xaa)](0x0,0x0,0x0,0x0),_0x1497c1=new Date(_0x330ff5),_0x1497c1[_0x1fea6c(0xaa)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x475cd9=new Date(_0x2fb1ce[_0x1fea6c(0x121)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1fea6c(0x11d):_0x475cd9=new Date(_0x2fb1ce[_0x1fea6c(0x121)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1fea6c(0x107):_0x475cd9=new Date(_0x2fb1ce['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x475cd9=new Date(_0x2fb1ce[_0x1fea6c(0x121)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x4ef10f={'gte':_0x475cd9};_0x1497c1&&(_0x4ef10f['lte']=_0x1497c1);const [_0x30df2e,_0x55bf7b,_0x3cccac,_0x24eff9,_0x2a8dbc]=await Promise[_0x1fea6c(0x9b)]([database_1[_0x1fea6c(0xeb)][_0x1fea6c(0x106)][_0x1fea6c(0x79)]({'where':{'shopId':_0x1c6b87,'gateway':{'not':'test_gateway'},'createdAt':_0x4ef10f}}),database_1[_0x1fea6c(0xeb)][_0x1fea6c(0x106)][_0x1fea6c(0x79)]({'where':{'shopId':_0x1c6b87,'gateway':{'not':_0x1fea6c(0xc9)},'status':_0x1fea6c(0xdf),'createdAt':_0x4ef10f}}),database_1[_0x1fea6c(0xeb)][_0x1fea6c(0x106)]['findMany']({'where':{'shopId':_0x1c6b87,'gateway':{'not':_0x1fea6c(0xc9)},'status':_0x1fea6c(0xdf),'createdAt':_0x4ef10f},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x1fea6c(0xeb)][_0x1fea6c(0x106)][_0x1fea6c(0x98)]({'where':{'shopId':_0x1c6b87,'gateway':{'not':_0x1fea6c(0xc9)}},'take':0xa,'orderBy':{'createdAt':_0x1fea6c(0xe9)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x1fea6c(0xeb)][_0x1fea6c(0x106)]['findMany']({'where':{'shopId':_0x1c6b87,'gateway':{'not':_0x1fea6c(0xc9)},'createdAt':_0x4ef10f},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x1fea6c(0x104)}})]);let _0x3a81af=0x0;for(const _0x1b5903 of _0x3cccac){if(_0x1b5903[_0x1fea6c(0xf6)])_0x3a81af+=_0x1b5903[_0x1fea6c(0xf6)];else{const _0x1dfd3d=await currencyService_1[_0x1fea6c(0xbd)]['convertToUSDT'](_0x1b5903[_0x1fea6c(0xe2)],_0x1b5903[_0x1fea6c(0x126)]);_0x3a81af+=_0x1dfd3d;}}const _0x5f42b9=this[_0x1fea6c(0x91)](_0x2a8dbc,_0x475cd9,_0x1497c1||_0x2fb1ce),_0x270653=_0x30df2e>0x0?_0x55bf7b/_0x30df2e*0x64:0x0;return{'totalPayments':_0x30df2e,'successfulPayments':_0x55bf7b,'totalRevenue':Math[_0x1fea6c(0x90)](_0x3a81af*0x64)/0x64,'conversionRate':Math[_0x1fea6c(0x90)](_0x270653*0x64)/0x64,'dailyRevenue':_0x5f42b9[_0x1fea6c(0x7f)],'dailyPayments':_0x5f42b9[_0x1fea6c(0xd8)],'recentPayments':_0x24eff9[_0x1fea6c(0xd7)](_0x22c139=>({'id':_0x22c139['id'],'gateway':_0x22c139[_0x1fea6c(0x88)],'amount':_0x22c139['amount'],'currency':_0x22c139['currency'],'status':_0x22c139[_0x1fea6c(0x11a)],'createdAt':_0x22c139[_0x1fea6c(0x124)]}))};}[a60_0x45a692(0x91)](_0x261429,_0x2891fb,_0xe09453){const _0x23d6f=a60_0x45a692,_0x31e507=new Map(),_0x250715=new Date(_0x2891fb);while(_0x250715<=_0xe09453){const _0x551a5e=_0x250715[_0x23d6f(0xee)]()[_0x23d6f(0xb6)]('T')[0x0];_0x31e507[_0x23d6f(0x7d)](_0x551a5e,{'revenue':0x0,'count':0x0}),_0x250715[_0x23d6f(0x75)](_0x250715[_0x23d6f(0xa4)]()+0x1);}for(const _0x1bc169 of _0x261429){const _0x54f07f=_0x1bc169['createdAt'][_0x23d6f(0xee)]()[_0x23d6f(0xb6)]('T')[0x0],_0x2780a4=_0x31e507[_0x23d6f(0x110)](_0x54f07f);_0x2780a4&&(_0x2780a4[_0x23d6f(0x79)]+=0x1,_0x1bc169['status']==='PAID'&&_0x1bc169[_0x23d6f(0xf6)]&&(_0x2780a4[_0x23d6f(0xaf)]+=_0x1bc169[_0x23d6f(0xf6)]));}const _0x5a0018=[],_0x2b22d6=[];for(const [_0x293801,_0x26e4a6]of _0x31e507){_0x5a0018['push']({'date':_0x293801,'amount':Math[_0x23d6f(0x90)](_0x26e4a6[_0x23d6f(0xaf)]*0x64)/0x64}),_0x2b22d6[_0x23d6f(0xf3)]({'date':_0x293801,'count':_0x26e4a6[_0x23d6f(0x79)]});}return{'dailyRevenue':_0x5a0018,'dailyPayments':_0x2b22d6};}}exports[a60_0x45a692(0x12e)]=ShopService;