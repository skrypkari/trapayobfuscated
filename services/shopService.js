'use strict';const a54_0x3f28c2=a54_0x2bd0;(function(_0x161129,_0x5c407b){const _0x108e4f=a54_0x2bd0,_0x34119a=_0x161129();while(!![]){try{const _0x49aa20=parseInt(_0x108e4f(0x245))/0x1*(parseInt(_0x108e4f(0x272))/0x2)+-parseInt(_0x108e4f(0x1eb))/0x3*(parseInt(_0x108e4f(0x20c))/0x4)+parseInt(_0x108e4f(0x1f4))/0x5*(parseInt(_0x108e4f(0x1e3))/0x6)+-parseInt(_0x108e4f(0x1e5))/0x7*(parseInt(_0x108e4f(0x259))/0x8)+-parseInt(_0x108e4f(0x284))/0x9+parseInt(_0x108e4f(0x276))/0xa+parseInt(_0x108e4f(0x1fe))/0xb*(-parseInt(_0x108e4f(0x27f))/0xc);if(_0x49aa20===_0x5c407b)break;else _0x34119a['push'](_0x34119a['shift']());}catch(_0x377b37){_0x34119a['push'](_0x34119a['shift']());}}}(a54_0x18b0,0x3c552));function a54_0x2bd0(_0x1fa9ba,_0x2404d3){const _0x18b0d4=a54_0x18b0();return a54_0x2bd0=function(_0x2bd07b,_0x38d5dd){_0x2bd07b=_0x2bd07b-0x1e0;let _0xa1a904=_0x18b0d4[_0x2bd07b];return _0xa1a904;},a54_0x2bd0(_0x1fa9ba,_0x2404d3);}var __importDefault=this&&this[a54_0x3f28c2(0x217)]||function(_0x2975af){const _0x37756b=a54_0x3f28c2;return _0x2975af&&_0x2975af[_0x37756b(0x26c)]?_0x2975af:{'default':_0x2975af};};function a54_0x18b0(){const _0x1fa3e2=['settings','dailyRevenue','findUnique','awaitingPayout','30d','defineProperty','üìÖ\x20Period\x20end:\x20','amount','amountIsEditable','toISOString','amountUSDT','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','164338ccBanw','getPaymentById','webhookEvents','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','updateShopProfile','customer','telegram','Shop\x20not\x20found','paymentGateways','\x20\x20\x20üìÖ\x20This\x20month:\x20','findMany','setDate','balance','USD','usage','\x20USDT\x20(current\x20balance)','application/json','Test\x20webhook\x20sent\x20successfully\x20(','createPublicPayment','webhookLog','4392lJZdKq','log','error','update','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','responseBody','getFullYear','network','setHours','convertToUSDT','filter','getDate','periodFrom','üí∞\x20Getting\x20payouts\x20with\x20filters:','totalPaidOut','customerEmail','polygon_usdc','POST','currency','__esModule','ShopService','polygon','No\x20webhook\x20URL\x20configured','getPayouts','formatNetworkName','4FxcvAJ','parse','findFirst','USDT\x20ERC20','2778690FJeDIO','Payment\x20not\x20found','revenue','stringify','lte','Rapyd','shop','erc20','üåê\x20Method\x20filter:\x20','12ozdCIY','usdcPolygonWallet','USDT\x20BSC','test_payment_123','test','3601629YeDLVD','generateDailyStatistics','desc','expiresAt','4164FsNkpl','shopUrl','896dekmoL','getPayoutById','getWebhookLogs','KLYME\x20DE','push','default','51051LHEysJ','reduce','gatewaySettings','availableBalance','USDC\x20Polygon','merchantUrl','üìÖ\x20Date\x20start:\x20','status','getGatewayDisplayName','1860EjEntP','COMPLETED','count','PaymentService','PAID','usdtPolygonWallet','all','createdAt','TesSoft\x20Payment\x20System/1.0\x20(Test)','payout','1431331lDvIqS','PENDING','username','isArray','Failed\x20to\x20send\x20webhook:\x20','dailyPayments','Webhook\x20returned\x20error:\x20','\x20payout\x20statistics\x20calculated:','üìÖ\x20Date\x20end:\x20','KLYME\x20EU','customerName','publicKey','test_gateway','getPaymentsByShop','4ymwFRr','retryCount','payment','map','paymentService','telegramId','wallets','usdtErcWallet','getTime','updatePayment','REJECTED','__importDefault','paymentId','fullName','CoinToPay','paid','shopId','set','ceil','trc20','txid','statusText','getPayoutStatistics','language','delete','./currencyService','event','name','USDT\x20Polygon','getShopPayoutStats','statusCode','asc','thisMonth','notes','paidAt','gateway','getStatistics','Error\x20parsing\x20webhook\x20events:','webhookUrl','toUpperCase','./paymentService','redirectUrl','round','90d','usdtTrcWallet'];a54_0x18b0=function(){return _0x1fa3e2;};return a54_0x18b0();}Object[a54_0x3f28c2(0x23e)](exports,a54_0x3f28c2(0x26c),{'value':!![]}),exports[a54_0x3f28c2(0x26d)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a54_0x3f28c2(0x225)),paymentService_1=require(a54_0x3f28c2(0x234));class ShopService{constructor(){const _0x32ef9a=a54_0x3f28c2;this[_0x32ef9a(0x210)]=new paymentService_1[(_0x32ef9a(0x1f7))]();}async['getShopProfile'](_0x916e14){const _0x3aaf47=a54_0x3f28c2,_0x51d997=await database_1['default'][_0x3aaf47(0x27c)][_0x3aaf47(0x23b)]({'where':{'id':_0x916e14},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x51d997)throw new Error(_0x3aaf47(0x24c));let _0xd37742=[];if(_0x51d997[_0x3aaf47(0x239)]?.[_0x3aaf47(0x247)])try{_0xd37742=Array[_0x3aaf47(0x201)](_0x51d997[_0x3aaf47(0x239)][_0x3aaf47(0x247)])?_0x51d997['settings'][_0x3aaf47(0x247)]:JSON[_0x3aaf47(0x273)](_0x51d997[_0x3aaf47(0x239)][_0x3aaf47(0x247)]);}catch(_0x534059){console[_0x3aaf47(0x25b)]('Error\x20parsing\x20webhook\x20events:',_0x534059),_0xd37742=[];}return{'id':_0x51d997['id'],'fullName':_0x51d997[_0x3aaf47(0x227)],'username':_0x51d997[_0x3aaf47(0x200)],'telegramId':_0x51d997[_0x3aaf47(0x24b)],'merchantUrl':_0x51d997[_0x3aaf47(0x1e4)],'gateways':_0x51d997[_0x3aaf47(0x24d)]?JSON['parse'](_0x51d997[_0x3aaf47(0x24d)]):null,'gatewaySettings':_0x51d997[_0x3aaf47(0x1ed)]?JSON['parse'](_0x51d997[_0x3aaf47(0x1ed)]):null,'publicKey':_0x51d997[_0x3aaf47(0x209)],'webhookUrl':_0x51d997['settings']?.['webhookUrl']||null,'webhookEvents':_0xd37742,'wallets':{'usdtPolygonWallet':_0x51d997['usdtPolygonWallet'],'usdtTrcWallet':_0x51d997['usdtTrcWallet'],'usdtErcWallet':_0x51d997[_0x3aaf47(0x213)],'usdcPolygonWallet':_0x51d997[_0x3aaf47(0x280)]},'status':_0x51d997['status'],'createdAt':_0x51d997[_0x3aaf47(0x1fb)]};}async[a54_0x3f28c2(0x249)](_0x28a43f,_0x269e68){const _0x42d0e7=a54_0x3f28c2,_0x152a70={};_0x269e68[_0x42d0e7(0x219)]&&(_0x152a70[_0x42d0e7(0x227)]=_0x269e68[_0x42d0e7(0x219)]);_0x269e68['telegramId']!==undefined&&(_0x152a70[_0x42d0e7(0x24b)]=_0x269e68[_0x42d0e7(0x211)]||null);_0x269e68[_0x42d0e7(0x1f0)]&&(_0x152a70['shopUrl']=_0x269e68[_0x42d0e7(0x1f0)]);_0x269e68['gateways']&&(_0x152a70[_0x42d0e7(0x24d)]=JSON[_0x42d0e7(0x279)](_0x269e68['gateways']));_0x269e68[_0x42d0e7(0x1ed)]&&(_0x152a70[_0x42d0e7(0x1ed)]=JSON[_0x42d0e7(0x279)](_0x269e68[_0x42d0e7(0x1ed)]));_0x269e68[_0x42d0e7(0x212)]&&(_0x269e68[_0x42d0e7(0x212)][_0x42d0e7(0x1f9)]!==undefined&&(_0x152a70['usdtPolygonWallet']=_0x269e68[_0x42d0e7(0x212)][_0x42d0e7(0x1f9)]||null),_0x269e68[_0x42d0e7(0x212)][_0x42d0e7(0x238)]!==undefined&&(_0x152a70[_0x42d0e7(0x238)]=_0x269e68['wallets']['usdtTrcWallet']||null),_0x269e68[_0x42d0e7(0x212)]['usdtErcWallet']!==undefined&&(_0x152a70[_0x42d0e7(0x213)]=_0x269e68[_0x42d0e7(0x212)][_0x42d0e7(0x213)]||null),_0x269e68[_0x42d0e7(0x212)][_0x42d0e7(0x280)]!==undefined&&(_0x152a70[_0x42d0e7(0x280)]=_0x269e68[_0x42d0e7(0x212)][_0x42d0e7(0x280)]||null));const _0x37d1d1=await database_1[_0x42d0e7(0x1ea)][_0x42d0e7(0x27c)][_0x42d0e7(0x25c)]({'where':{'id':_0x28a43f},'data':_0x152a70,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x129abb=[];if(_0x37d1d1[_0x42d0e7(0x239)]?.[_0x42d0e7(0x247)])try{_0x129abb=Array[_0x42d0e7(0x201)](_0x37d1d1[_0x42d0e7(0x239)]['webhookEvents'])?_0x37d1d1['settings'][_0x42d0e7(0x247)]:JSON[_0x42d0e7(0x273)](_0x37d1d1[_0x42d0e7(0x239)][_0x42d0e7(0x247)]);}catch(_0x3c54bd){console[_0x42d0e7(0x25b)](_0x42d0e7(0x231),_0x3c54bd),_0x129abb=[];}return{'id':_0x37d1d1['id'],'fullName':_0x37d1d1[_0x42d0e7(0x227)],'username':_0x37d1d1['username'],'telegramId':_0x37d1d1[_0x42d0e7(0x24b)],'merchantUrl':_0x37d1d1[_0x42d0e7(0x1e4)],'gateways':_0x37d1d1['paymentGateways']?JSON['parse'](_0x37d1d1[_0x42d0e7(0x24d)]):null,'gatewaySettings':_0x37d1d1['gatewaySettings']?JSON[_0x42d0e7(0x273)](_0x37d1d1[_0x42d0e7(0x1ed)]):null,'publicKey':_0x37d1d1[_0x42d0e7(0x209)],'webhookUrl':_0x37d1d1['settings']?.[_0x42d0e7(0x232)]||null,'webhookEvents':_0x129abb,'wallets':{'usdtPolygonWallet':_0x37d1d1[_0x42d0e7(0x1f9)],'usdtTrcWallet':_0x37d1d1[_0x42d0e7(0x238)],'usdtErcWallet':_0x37d1d1[_0x42d0e7(0x213)],'usdcPolygonWallet':_0x37d1d1[_0x42d0e7(0x280)]},'status':_0x37d1d1[_0x42d0e7(0x1f2)],'createdAt':_0x37d1d1[_0x42d0e7(0x1fb)]};}async['updateWallets'](_0x411ec2,_0x205d1f){const _0xb4a635=a54_0x3f28c2,_0x20f11e={};_0x205d1f['usdtPolygonWallet']!==undefined&&(_0x20f11e['usdtPolygonWallet']=_0x205d1f['usdtPolygonWallet']||null),_0x205d1f[_0xb4a635(0x238)]!==undefined&&(_0x20f11e[_0xb4a635(0x238)]=_0x205d1f[_0xb4a635(0x238)]||null),_0x205d1f[_0xb4a635(0x213)]!==undefined&&(_0x20f11e[_0xb4a635(0x213)]=_0x205d1f[_0xb4a635(0x213)]||null),_0x205d1f[_0xb4a635(0x280)]!==undefined&&(_0x20f11e[_0xb4a635(0x280)]=_0x205d1f[_0xb4a635(0x280)]||null),await database_1[_0xb4a635(0x1ea)][_0xb4a635(0x27c)][_0xb4a635(0x25c)]({'where':{'id':_0x411ec2},'data':_0x20f11e});}async['testWebhook'](_0x4b5fff){const _0x548099=a54_0x3f28c2,_0x3a41d2=await database_1[_0x548099(0x1ea)][_0x548099(0x27c)][_0x548099(0x23b)]({'where':{'id':_0x4b5fff},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3a41d2?.['settings']?.[_0x548099(0x232)])throw new Error(_0x548099(0x26f));const _0x22a2ac={'event':'test','payment':{'id':_0x548099(0x282),'order_id':'test_order_123','gateway':_0x548099(0x283),'amount':0x64,'currency':_0x548099(0x252),'status':_0x548099(0x21b),'created_at':new Date()[_0x548099(0x242)]()}};try{const _0x4c394c=await fetch(_0x3a41d2[_0x548099(0x239)][_0x548099(0x232)],{'method':_0x548099(0x26a),'headers':{'Content-Type':_0x548099(0x255),'User-Agent':_0x548099(0x1fc)},'body':JSON[_0x548099(0x279)](_0x22a2ac)});return _0x4c394c['ok']?{'success':!![],'message':_0x548099(0x256)+_0x4c394c['status']+')'}:{'success':![],'message':_0x548099(0x204)+_0x4c394c[_0x548099(0x1f2)]+'\x20'+_0x4c394c[_0x548099(0x221)]};}catch(_0x3ba030){return{'success':![],'message':_0x548099(0x202)+(_0x3ba030 instanceof Error?_0x3ba030['message']:'Unknown\x20error')};}}async['createPayment'](_0x26211b){const _0x443cbc=a54_0x3f28c2;return this[_0x443cbc(0x210)][_0x443cbc(0x257)]({'public_key':'','gateway':_0x26211b[_0x443cbc(0x22f)],'order_id':undefined,'amount':_0x26211b['amount'],'currency':_0x26211b['currency'],'source_currency':_0x26211b['sourceCurrency'],'usage':_0x26211b[_0x443cbc(0x253)],'expires_at':_0x26211b[_0x443cbc(0x1e2)]?.[_0x443cbc(0x242)](),'success_url':_0x26211b['redirectUrl'],'fail_url':_0x26211b[_0x443cbc(0x235)],'customer_email':_0x26211b[_0x443cbc(0x268)],'customer_name':_0x26211b[_0x443cbc(0x208)],'country':_0x26211b['country'],'language':_0x26211b[_0x443cbc(0x223)],'amount_is_editable':_0x26211b[_0x443cbc(0x241)],'max_payments':_0x26211b['maxPayments'],'customer':_0x26211b[_0x443cbc(0x24a)]});}async['getPayments'](_0x2eed67,_0x54cb33){const _0x395a8c=a54_0x3f28c2;return this[_0x395a8c(0x210)][_0x395a8c(0x20b)](_0x2eed67,_0x54cb33);}async[a54_0x3f28c2(0x246)](_0x14627b,_0x4e3727){const _0x7f2dce=a54_0x3f28c2;return this[_0x7f2dce(0x210)]['getPaymentByShopAndId'](_0x14627b,_0x4e3727);}async[a54_0x3f28c2(0x215)](_0x458fa2,_0x254739,_0x1ca944){const _0x2cfda3=a54_0x3f28c2,_0x17e563=await database_1[_0x2cfda3(0x1ea)]['payment']['findFirst']({'where':{'id':_0x254739,'shopId':_0x458fa2}});if(!_0x17e563)throw new Error(_0x2cfda3(0x277));const _0x51c1c7=await database_1[_0x2cfda3(0x1ea)][_0x2cfda3(0x20e)]['update']({'where':{'id':_0x254739},'data':{..._0x1ca944,'updatedAt':new Date()}});return _0x51c1c7;}async['deletePayment'](_0x527421,_0x49c37a){const _0xbc6cc0=a54_0x3f28c2,_0xa76418=await database_1[_0xbc6cc0(0x1ea)][_0xbc6cc0(0x20e)][_0xbc6cc0(0x274)]({'where':{'id':_0x49c37a,'shopId':_0x527421}});if(!_0xa76418)throw new Error(_0xbc6cc0(0x277));await database_1[_0xbc6cc0(0x1ea)][_0xbc6cc0(0x20e)][_0xbc6cc0(0x224)]({'where':{'id':_0x49c37a}});}[a54_0x3f28c2(0x271)](_0x3de902){const _0x24359e=a54_0x3f28c2,_0xde9972={'polygon':_0x24359e(0x228),'trc20':'USDT\x20TRC20','erc20':_0x24359e(0x275),'bsc':_0x24359e(0x281),'polygon_usdc':_0x24359e(0x1ef)};return _0xde9972[_0x3de902]||_0x3de902;}async[a54_0x3f28c2(0x270)](_0x770d7e,_0x341067){const _0x148bd9=a54_0x3f28c2,{page:_0x1243b9,limit:_0x39e0fb,status:_0x33b43f,method:_0x37b35a,network:_0x4686c9,dateFrom:_0x4e562e,dateTo:_0x45e1be,periodFrom:_0x666d28,periodTo:_0x2b1ef3}=_0x341067,_0x560f45=(_0x1243b9-0x1)*_0x39e0fb;console['log'](_0x148bd9(0x266),_0x341067);const _0x5a1337={'shopId':_0x770d7e};_0x33b43f&&(_0x5a1337[_0x148bd9(0x1f2)]=_0x33b43f['toUpperCase'](),console[_0x148bd9(0x25a)]('üìä\x20Status\x20filter:\x20'+_0x33b43f[_0x148bd9(0x233)]()));if(_0x37b35a)_0x5a1337[_0x148bd9(0x260)]=_0x37b35a,console[_0x148bd9(0x25a)](_0x148bd9(0x27e)+_0x37b35a);else _0x4686c9&&(_0x5a1337[_0x148bd9(0x260)]=_0x4686c9,console[_0x148bd9(0x25a)]('üåê\x20Network\x20filter:\x20'+_0x4686c9));if(_0x4e562e||_0x45e1be||_0x666d28||_0x2b1ef3){_0x5a1337['createdAt']={};if(_0x666d28){const _0x33e71c=new Date(_0x666d28);_0x33e71c[_0x148bd9(0x261)](0x0,0x0,0x0,0x0),_0x5a1337[_0x148bd9(0x1fb)]['gte']=_0x33e71c,console[_0x148bd9(0x25a)]('üìÖ\x20Period\x20start:\x20'+_0x33e71c[_0x148bd9(0x242)]());}else{if(_0x4e562e){const _0xae8b66=new Date(_0x4e562e);_0xae8b66[_0x148bd9(0x261)](0x0,0x0,0x0,0x0),_0x5a1337[_0x148bd9(0x1fb)]['gte']=_0xae8b66,console['log'](_0x148bd9(0x1f1)+_0xae8b66[_0x148bd9(0x242)]());}}if(_0x2b1ef3){const _0x26dfe5=new Date(_0x2b1ef3);_0x26dfe5['setHours'](0x17,0x3b,0x3b,0x3e7),_0x5a1337[_0x148bd9(0x1fb)][_0x148bd9(0x27a)]=_0x26dfe5,console[_0x148bd9(0x25a)](_0x148bd9(0x23f)+_0x26dfe5[_0x148bd9(0x242)]());}else{if(_0x45e1be){const _0x380737=new Date(_0x45e1be);_0x380737[_0x148bd9(0x261)](0x17,0x3b,0x3b,0x3e7),_0x5a1337['createdAt'][_0x148bd9(0x27a)]=_0x380737,console[_0x148bd9(0x25a)](_0x148bd9(0x206)+_0x380737[_0x148bd9(0x242)]());}}}console[_0x148bd9(0x25a)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x148bd9(0x279)](_0x5a1337,null,0x2));const [_0x22315c,_0x9e1652]=await Promise['all']([database_1[_0x148bd9(0x1ea)][_0x148bd9(0x1fd)][_0x148bd9(0x24f)]({'where':_0x5a1337,'skip':_0x560f45,'take':_0x39e0fb,'orderBy':{'createdAt':_0x148bd9(0x1e1)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x148bd9(0x1fd)][_0x148bd9(0x1f6)]({'where':_0x5a1337})]);return{'payouts':_0x22315c['map'](_0x50084a=>{const _0x5e0edf=_0x148bd9;let _0x186805=null;switch(_0x50084a[_0x5e0edf(0x260)]){case _0x5e0edf(0x26e):_0x186805=_0x50084a['shop']['usdtPolygonWallet'];break;case _0x5e0edf(0x21f):_0x186805=_0x50084a[_0x5e0edf(0x27c)]['usdtTrcWallet'];break;case _0x5e0edf(0x27d):_0x186805=_0x50084a['shop'][_0x5e0edf(0x213)];break;case _0x5e0edf(0x269):_0x186805=_0x50084a[_0x5e0edf(0x27c)][_0x5e0edf(0x280)];break;}return{'id':_0x50084a['id'],'amount':_0x50084a[_0x5e0edf(0x240)],'network':this['formatNetworkName'](_0x50084a[_0x5e0edf(0x260)]),'wallet':_0x186805,'status':_0x50084a[_0x5e0edf(0x1f2)],'txid':_0x50084a[_0x5e0edf(0x220)],'notes':_0x50084a['notes'],'periodFrom':_0x50084a[_0x5e0edf(0x265)],'periodTo':_0x50084a['periodTo'],'createdAt':_0x50084a[_0x5e0edf(0x1fb)],'paidAt':_0x50084a['paidAt']};}),'pagination':{'page':_0x1243b9,'limit':_0x39e0fb,'total':_0x9e1652,'totalPages':Math[_0x148bd9(0x21e)](_0x9e1652/_0x39e0fb)}};}async[a54_0x3f28c2(0x1e6)](_0x107971,_0x313ef4){const _0x2dc047=a54_0x3f28c2,_0xf5bc6d=await database_1['default'][_0x2dc047(0x1fd)][_0x2dc047(0x274)]({'where':{'id':_0x313ef4,'shopId':_0x107971}});if(!_0xf5bc6d)return null;return{'id':_0xf5bc6d['id'],'amount':_0xf5bc6d[_0x2dc047(0x240)],'network':_0xf5bc6d[_0x2dc047(0x260)],'status':_0xf5bc6d[_0x2dc047(0x1f2)],'txid':_0xf5bc6d[_0x2dc047(0x220)],'notes':_0xf5bc6d[_0x2dc047(0x22d)],'createdAt':_0xf5bc6d[_0x2dc047(0x1fb)],'paidAt':_0xf5bc6d[_0x2dc047(0x22e)]};}async[a54_0x3f28c2(0x222)](_0xdd071c,_0x253d6a){const _0x6a32d6=a54_0x3f28c2,_0x126047=new Date();let _0x136a46;switch(_0x253d6a){case'7d':_0x136a46=new Date(_0x126047[_0x6a32d6(0x214)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x136a46=new Date(_0x126047[_0x6a32d6(0x214)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x136a46=new Date(_0x126047[_0x6a32d6(0x214)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x136a46=new Date(_0x126047[_0x6a32d6(0x214)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x59e20b,_0xfc1be1,_0x821d73,_0x3ae391,_0x3be04c,_0x2c218a]=await Promise[_0x6a32d6(0x1fa)]([database_1[_0x6a32d6(0x1ea)][_0x6a32d6(0x1fd)][_0x6a32d6(0x1f6)]({'where':{'shopId':_0xdd071c,'createdAt':{'gte':_0x136a46}}}),database_1[_0x6a32d6(0x1ea)]['payout'][_0x6a32d6(0x1f6)]({'where':{'shopId':_0xdd071c,'status':'COMPLETED','createdAt':{'gte':_0x136a46}}}),database_1[_0x6a32d6(0x1ea)]['payout'][_0x6a32d6(0x1f6)]({'where':{'shopId':_0xdd071c,'status':_0x6a32d6(0x1ff),'createdAt':{'gte':_0x136a46}}}),database_1['default'][_0x6a32d6(0x1fd)][_0x6a32d6(0x1f6)]({'where':{'shopId':_0xdd071c,'status':_0x6a32d6(0x216),'createdAt':{'gte':_0x136a46}}}),database_1[_0x6a32d6(0x1ea)][_0x6a32d6(0x1fd)][_0x6a32d6(0x24f)]({'where':{'shopId':_0xdd071c,'createdAt':{'gte':_0x136a46}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x6a32d6(0x1fd)][_0x6a32d6(0x24f)]({'where':{'shopId':_0xdd071c},'take':0xa,'orderBy':{'createdAt':_0x6a32d6(0x1e1)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3ee16d=_0x3be04c[_0x6a32d6(0x1ec)]((_0x52ddb8,_0x2f5447)=>_0x52ddb8+_0x2f5447[_0x6a32d6(0x240)],0x0),_0x22ea00=_0x3be04c[_0x6a32d6(0x263)](_0x413905=>_0x413905[_0x6a32d6(0x1f2)]===_0x6a32d6(0x1f5))[_0x6a32d6(0x1ec)]((_0x18eb27,_0x54dfd2)=>_0x18eb27+_0x54dfd2[_0x6a32d6(0x240)],0x0),_0x3ef747=_0x3be04c[_0x6a32d6(0x263)](_0x513112=>_0x513112[_0x6a32d6(0x1f2)]===_0x6a32d6(0x1ff))['reduce']((_0x4df61e,_0x55bd04)=>_0x4df61e+_0x55bd04['amount'],0x0),_0x242c2e=_0x3be04c[_0x6a32d6(0x1ec)]((_0x377860,_0x393ff7)=>{const _0x5caa91=_0x6a32d6;return _0x377860[_0x393ff7[_0x5caa91(0x260)]]=(_0x377860[_0x393ff7[_0x5caa91(0x260)]]||0x0)+0x1,_0x377860;},{}),_0x139d47=_0x3be04c[_0x6a32d6(0x1ec)]((_0x487e88,_0x43d8d0)=>{const _0x359170=_0x6a32d6;return _0x487e88[_0x43d8d0[_0x359170(0x1f2)]]=(_0x487e88[_0x43d8d0[_0x359170(0x1f2)]]||0x0)+0x1,_0x487e88;},{});return{'totalPayouts':_0x59e20b,'completedPayouts':_0xfc1be1,'pendingPayouts':_0x821d73,'rejectedPayouts':_0x3ae391,'totalAmount':_0x3ee16d,'completedAmount':_0x22ea00,'pendingAmount':_0x3ef747,'payoutsByMethod':_0x242c2e,'payoutsByStatus':_0x139d47,'recentPayouts':_0x2c218a[_0x6a32d6(0x20f)](_0x4f8b01=>({'id':_0x4f8b01['id'],'shopId':_0xdd071c,'amount':_0x4f8b01[_0x6a32d6(0x240)],'method':_0x4f8b01[_0x6a32d6(0x260)],'status':_0x4f8b01['status'],'txid':_0x4f8b01[_0x6a32d6(0x220)],'createdAt':_0x4f8b01[_0x6a32d6(0x1fb)],'paidAt':_0x4f8b01['paidAt']}))};}async['getShopPayoutStats'](_0x549d53){const _0x208339=a54_0x3f28c2;console[_0x208339(0x25a)](_0x208339(0x244)+_0x549d53+'...');const _0x32453d=await database_1[_0x208339(0x1ea)][_0x208339(0x27c)][_0x208339(0x23b)]({'where':{'id':_0x549d53},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x32453d)throw new Error(_0x208339(0x24c));const _0x318336=new Date(),_0x5b364e=new Date(_0x318336[_0x208339(0x25f)](),_0x318336['getMonth'](),0x1),_0x4204cd=new Date(_0x318336[_0x208339(0x25f)](),_0x318336['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5279c9=await database_1['default']['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x549d53,'createdAt':{'gte':_0x5b364e,'lte':_0x4204cd},'status':_0x208339(0x1f5)}}),_0x41360e=_0x5279c9['_sum'][_0x208339(0x240)]||0x0,_0x13d038={'availableBalance':Math[_0x208339(0x236)](_0x32453d[_0x208339(0x251)]*0x64)/0x64,'totalPaidOut':Math[_0x208339(0x236)](_0x32453d[_0x208339(0x267)]*0x64)/0x64,'awaitingPayout':Math[_0x208339(0x236)](_0x32453d[_0x208339(0x251)]*0x64)/0x64,'thisMonth':Math[_0x208339(0x236)](_0x41360e*0x64)/0x64};return console['log']('üìä\x20Shop\x20'+_0x32453d[_0x208339(0x200)]+_0x208339(0x205)),console[_0x208339(0x25a)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x13d038[_0x208339(0x1ee)]+_0x208339(0x254)),console[_0x208339(0x25a)](_0x208339(0x25d)+_0x13d038[_0x208339(0x267)]+'\x20USDT\x20(total\x20payouts)'),console[_0x208339(0x25a)](_0x208339(0x248)+_0x13d038[_0x208339(0x23c)]+_0x208339(0x254)),console[_0x208339(0x25a)](_0x208339(0x24e)+_0x13d038[_0x208339(0x22c)]+'\x20USDT'),_0x13d038;}[a54_0x3f28c2(0x1f3)](_0x51106a){const _0x1d050c=a54_0x3f28c2,_0x5ef581={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x1d050c(0x27b),'noda':'Noda','cointopay':_0x1d050c(0x21a),'klyme_eu':_0x1d050c(0x207),'klyme_gb':'KLYME\x20GB','klyme_de':_0x1d050c(0x1e8)};return _0x5ef581[_0x51106a]||_0x51106a;}async['getPayoutStats'](_0x457722){const _0x365372=a54_0x3f28c2;return this[_0x365372(0x229)](_0x457722);}async[a54_0x3f28c2(0x1e7)](_0x1190d6,_0x478bbc){const _0x2837e4=a54_0x3f28c2,{page:_0x438eb2,limit:_0x1b07f7,paymentId:_0x2aa49d}=_0x478bbc,_0x525c72=(_0x438eb2-0x1)*_0x1b07f7,_0xb8b619={'shopId':_0x1190d6};_0x2aa49d&&(_0xb8b619[_0x2837e4(0x218)]=_0x2aa49d);const [_0x5b71b1,_0x222ef4]=await Promise[_0x2837e4(0x1fa)]([database_1['default']['webhookLog'][_0x2837e4(0x24f)]({'where':_0xb8b619,'skip':_0x525c72,'take':_0x1b07f7,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x2837e4(0x1ea)][_0x2837e4(0x258)][_0x2837e4(0x1f6)]({'where':_0xb8b619})]);return{'logs':_0x5b71b1[_0x2837e4(0x20f)](_0x1c28b8=>({'id':_0x1c28b8['id'],'paymentId':_0x1c28b8['paymentId'],'shopId':_0x1c28b8[_0x2837e4(0x21c)],'event':_0x1c28b8[_0x2837e4(0x226)],'statusCode':_0x1c28b8[_0x2837e4(0x22a)],'retryCount':_0x1c28b8[_0x2837e4(0x20d)],'responseBody':_0x1c28b8[_0x2837e4(0x25e)],'createdAt':_0x1c28b8[_0x2837e4(0x1fb)],'payment':_0x1c28b8[_0x2837e4(0x20e)]})),'pagination':{'page':_0x438eb2,'limit':_0x1b07f7,'total':_0x222ef4,'totalPages':Math['ceil'](_0x222ef4/_0x1b07f7)}};}async[a54_0x3f28c2(0x230)](_0x1fe380,_0x573992){const _0x30b905=a54_0x3f28c2,_0x4c6350=new Date();let _0x49949e;switch(_0x573992){case'7d':_0x49949e=new Date(_0x4c6350[_0x30b905(0x214)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x30b905(0x23d):_0x49949e=new Date(_0x4c6350['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x30b905(0x237):_0x49949e=new Date(_0x4c6350[_0x30b905(0x214)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x49949e=new Date(_0x4c6350[_0x30b905(0x214)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x40fdb1,_0x1e5712,_0x44cc84,_0x11a45e,_0x540bca]=await Promise[_0x30b905(0x1fa)]([database_1[_0x30b905(0x1ea)][_0x30b905(0x20e)]['count']({'where':{'shopId':_0x1fe380,'gateway':{'not':_0x30b905(0x20a)},'createdAt':{'gte':_0x49949e}}}),database_1['default'][_0x30b905(0x20e)][_0x30b905(0x1f6)]({'where':{'shopId':_0x1fe380,'gateway':{'not':_0x30b905(0x20a)},'status':_0x30b905(0x1f8),'createdAt':{'gte':_0x49949e}}}),database_1[_0x30b905(0x1ea)][_0x30b905(0x20e)]['findMany']({'where':{'shopId':_0x1fe380,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':{'gte':_0x49949e}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x30b905(0x1ea)][_0x30b905(0x20e)][_0x30b905(0x24f)]({'where':{'shopId':_0x1fe380,'gateway':{'not':_0x30b905(0x20a)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x30b905(0x1ea)][_0x30b905(0x20e)]['findMany']({'where':{'shopId':_0x1fe380,'gateway':{'not':_0x30b905(0x20a)},'createdAt':{'gte':_0x49949e}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x30b905(0x22b)}})]);let _0x1da14f=0x0;for(const _0x18df1d of _0x44cc84){if(_0x18df1d[_0x30b905(0x243)])_0x1da14f+=_0x18df1d[_0x30b905(0x243)];else{const _0x11bc2f=await currencyService_1['currencyService'][_0x30b905(0x262)](_0x18df1d[_0x30b905(0x240)],_0x18df1d['currency']);_0x1da14f+=_0x11bc2f;}}const _0x1cabbf=this[_0x30b905(0x1e0)](_0x540bca,_0x49949e,_0x4c6350),_0xb71311=_0x40fdb1>0x0?_0x1e5712/_0x40fdb1*0x64:0x0;return{'totalPayments':_0x40fdb1,'successfulPayments':_0x1e5712,'totalRevenue':Math[_0x30b905(0x236)](_0x1da14f*0x64)/0x64,'conversionRate':Math[_0x30b905(0x236)](_0xb71311*0x64)/0x64,'dailyRevenue':_0x1cabbf[_0x30b905(0x23a)],'dailyPayments':_0x1cabbf[_0x30b905(0x203)],'recentPayments':_0x11a45e[_0x30b905(0x20f)](_0xe3abda=>({'id':_0xe3abda['id'],'gateway':_0xe3abda[_0x30b905(0x22f)],'amount':_0xe3abda[_0x30b905(0x240)],'currency':_0xe3abda[_0x30b905(0x26b)],'status':_0xe3abda[_0x30b905(0x1f2)],'createdAt':_0xe3abda[_0x30b905(0x1fb)]}))};}[a54_0x3f28c2(0x1e0)](_0x333313,_0x5017bd,_0x12d248){const _0x55e2ef=a54_0x3f28c2,_0xec5fc6=new Map(),_0x3ad92a=new Date(_0x5017bd);while(_0x3ad92a<=_0x12d248){const _0x108c8e=_0x3ad92a[_0x55e2ef(0x242)]()['split']('T')[0x0];_0xec5fc6[_0x55e2ef(0x21d)](_0x108c8e,{'revenue':0x0,'count':0x0}),_0x3ad92a[_0x55e2ef(0x250)](_0x3ad92a[_0x55e2ef(0x264)]()+0x1);}for(const _0x246057 of _0x333313){const _0x2c150a=_0x246057[_0x55e2ef(0x1fb)][_0x55e2ef(0x242)]()['split']('T')[0x0],_0x43b4b8=_0xec5fc6['get'](_0x2c150a);_0x43b4b8&&(_0x43b4b8['count']+=0x1,_0x246057[_0x55e2ef(0x1f2)]===_0x55e2ef(0x1f8)&&_0x246057['amountUSDT']&&(_0x43b4b8[_0x55e2ef(0x278)]+=_0x246057['amountUSDT']));}const _0x246178=[],_0x2aacd6=[];for(const [_0x255d31,_0x597bc2]of _0xec5fc6){_0x246178['push']({'date':_0x255d31,'amount':Math[_0x55e2ef(0x236)](_0x597bc2[_0x55e2ef(0x278)]*0x64)/0x64}),_0x2aacd6[_0x55e2ef(0x1e9)]({'date':_0x255d31,'count':_0x597bc2[_0x55e2ef(0x1f6)]});}return{'dailyRevenue':_0x246178,'dailyPayments':_0x2aacd6};}}exports['ShopService']=ShopService;