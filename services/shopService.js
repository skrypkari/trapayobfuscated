'use strict';const a79_0x77160f=a79_0x2eff;(function(_0x4f9894,_0x13a165){const _0x251c0c=a79_0x2eff,_0x57e429=_0x4f9894();while(!![]){try{const _0x335e1a=-parseInt(_0x251c0c(0x1f5))/0x1+parseInt(_0x251c0c(0x230))/0x2+parseInt(_0x251c0c(0x284))/0x3*(parseInt(_0x251c0c(0x2ac))/0x4)+parseInt(_0x251c0c(0x264))/0x5*(parseInt(_0x251c0c(0x22f))/0x6)+parseInt(_0x251c0c(0x1f0))/0x7*(parseInt(_0x251c0c(0x1d5))/0x8)+parseInt(_0x251c0c(0x212))/0x9+-parseInt(_0x251c0c(0x27a))/0xa*(parseInt(_0x251c0c(0x1dc))/0xb);if(_0x335e1a===_0x13a165)break;else _0x57e429['push'](_0x57e429['shift']());}catch(_0x4adfe0){_0x57e429['push'](_0x57e429['shift']());}}}(a79_0x8176,0xdf9f4));var __importDefault=this&&this[a79_0x77160f(0x1e4)]||function(_0x4b7d30){const _0xf9f4ed=a79_0x77160f;return _0x4b7d30&&_0x4b7d30[_0xf9f4ed(0x285)]?_0x4b7d30:{'default':_0x4b7d30};};Object['defineProperty'](exports,a79_0x77160f(0x285),{'value':!![]}),exports[a79_0x77160f(0x287)]=void 0x0;const database_1=__importDefault(require(a79_0x77160f(0x255))),bcryptjs_1=__importDefault(require(a79_0x77160f(0x204))),crypto_1=__importDefault(require(a79_0x77160f(0x259))),speakeasy_1=__importDefault(require(a79_0x77160f(0x1fc))),qrcode_1=__importDefault(require(a79_0x77160f(0x227))),currencyService_1=require(a79_0x77160f(0x202)),paymentService_1=require(a79_0x77160f(0x1e5)),gateway_1=require(a79_0x77160f(0x249));class ShopService{constructor(){const _0x191da6=a79_0x77160f;this[_0x191da6(0x229)]=new paymentService_1[(_0x191da6(0x24c))]();}async[a79_0x77160f(0x23b)](_0x24bed1){const _0x4d1c26=a79_0x77160f,_0x46e83e=await database_1[_0x4d1c26(0x262)][_0x4d1c26(0x24e)][_0x4d1c26(0x22b)]({'where':{'id':_0x24bed1},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x46e83e)throw new Error(_0x4d1c26(0x1f1));let _0x4d995c=[];if(_0x46e83e[_0x4d1c26(0x2ae)]?.['webhookEvents'])try{_0x4d995c=Array[_0x4d1c26(0x1ef)](_0x46e83e[_0x4d1c26(0x2ae)][_0x4d1c26(0x206)])?_0x46e83e[_0x4d1c26(0x2ae)]['webhookEvents']:JSON[_0x4d1c26(0x291)](_0x46e83e[_0x4d1c26(0x2ae)]['webhookEvents']);}catch(_0x304498){console['error'](_0x4d1c26(0x238),_0x304498),_0x4d995c=[];}const _0x2949c4=gateway_1[_0x4d1c26(0x235)][_0x4d1c26(0x200)](_0xbd5aab=>_0xbd5aab[_0x4d1c26(0x1ce)])[_0x4d1c26(0x25f)](_0x575b1c=>_0x575b1c[_0x4d1c26(0x1ff)]);let _0x43fed4=_0x46e83e[_0x4d1c26(0x21b)]?JSON[_0x4d1c26(0x291)](_0x46e83e['paymentGateways']):[];return Array[_0x4d1c26(0x1ef)](_0x43fed4)&&(_0x43fed4=_0x43fed4['map'](_0x4659ac=>_0x4659ac[_0x4d1c26(0x23c)](/\s+/g,'_')[_0x4d1c26(0x1f6)]())[_0x4d1c26(0x200)](_0x25e2f4=>_0x2949c4[_0x4d1c26(0x2a9)](_0x25e2f4))),{'id':_0x46e83e['id'],'fullName':_0x46e83e[_0x4d1c26(0x1ff)],'username':_0x46e83e[_0x4d1c26(0x1ee)],'telegramId':_0x46e83e[_0x4d1c26(0x268)],'merchantUrl':_0x46e83e[_0x4d1c26(0x261)],'gateways':_0x43fed4,'gatewaySettings':_0x46e83e[_0x4d1c26(0x292)]?JSON[_0x4d1c26(0x291)](_0x46e83e['gatewaySettings']):null,'publicKey':_0x46e83e[_0x4d1c26(0x1d0)],'webhookUrl':_0x46e83e[_0x4d1c26(0x2ae)]?.[_0x4d1c26(0x205)]||null,'webhookEvents':_0x4d995c,'wallets':{'usdtPolygonWallet':_0x46e83e[_0x4d1c26(0x231)],'usdtTrcWallet':_0x46e83e[_0x4d1c26(0x27b)],'usdtErcWallet':_0x46e83e[_0x4d1c26(0x219)],'usdcPolygonWallet':_0x46e83e[_0x4d1c26(0x226)],'usdcErcWallet':_0x46e83e[_0x4d1c26(0x1d1)]},'status':_0x46e83e[_0x4d1c26(0x20f)],'createdAt':_0x46e83e[_0x4d1c26(0x286)]};}async[a79_0x77160f(0x2a1)](_0x151dbe,_0x1cb2f3){const _0x516345=a79_0x77160f,_0x329967={};_0x1cb2f3[_0x516345(0x1cf)]&&(_0x329967['name']=_0x1cb2f3[_0x516345(0x1cf)]);_0x1cb2f3['telegramId']!==undefined&&(_0x329967['telegram']=_0x1cb2f3[_0x516345(0x1f2)]||null);_0x1cb2f3[_0x516345(0x1de)]&&(_0x329967['shopUrl']=_0x1cb2f3[_0x516345(0x1de)]);_0x1cb2f3[_0x516345(0x218)]&&(_0x329967[_0x516345(0x21b)]=JSON[_0x516345(0x220)](_0x1cb2f3[_0x516345(0x218)]));_0x1cb2f3[_0x516345(0x292)]&&(_0x329967[_0x516345(0x292)]=JSON[_0x516345(0x220)](_0x1cb2f3[_0x516345(0x292)]));_0x1cb2f3[_0x516345(0x27d)]&&(_0x1cb2f3[_0x516345(0x27d)][_0x516345(0x231)]!==undefined&&(_0x329967['usdtPolygonWallet']=_0x1cb2f3[_0x516345(0x27d)][_0x516345(0x231)]||null),_0x1cb2f3['wallets'][_0x516345(0x27b)]!==undefined&&(_0x329967[_0x516345(0x27b)]=_0x1cb2f3['wallets'][_0x516345(0x27b)]||null),_0x1cb2f3[_0x516345(0x27d)][_0x516345(0x219)]!==undefined&&(_0x329967['usdtErcWallet']=_0x1cb2f3[_0x516345(0x27d)][_0x516345(0x219)]||null),_0x1cb2f3[_0x516345(0x27d)][_0x516345(0x226)]!==undefined&&(_0x329967[_0x516345(0x226)]=_0x1cb2f3['wallets'][_0x516345(0x226)]||null));const _0x59eb3f=await database_1['default']['shop']['update']({'where':{'id':_0x151dbe},'data':_0x329967,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2e5e46=[];if(_0x59eb3f['settings']?.[_0x516345(0x206)])try{_0x2e5e46=Array[_0x516345(0x1ef)](_0x59eb3f[_0x516345(0x2ae)][_0x516345(0x206)])?_0x59eb3f[_0x516345(0x2ae)][_0x516345(0x206)]:JSON[_0x516345(0x291)](_0x59eb3f[_0x516345(0x2ae)]['webhookEvents']);}catch(_0xed278b){console[_0x516345(0x258)](_0x516345(0x238),_0xed278b),_0x2e5e46=[];}return{'id':_0x59eb3f['id'],'fullName':_0x59eb3f[_0x516345(0x1ff)],'username':_0x59eb3f[_0x516345(0x1ee)],'telegramId':_0x59eb3f['telegram'],'merchantUrl':_0x59eb3f[_0x516345(0x261)],'gateways':_0x59eb3f[_0x516345(0x21b)]?JSON['parse'](_0x59eb3f['paymentGateways']):null,'gatewaySettings':_0x59eb3f[_0x516345(0x292)]?JSON['parse'](_0x59eb3f[_0x516345(0x292)]):null,'publicKey':_0x59eb3f[_0x516345(0x1d0)],'webhookUrl':_0x59eb3f[_0x516345(0x2ae)]?.[_0x516345(0x205)]||null,'webhookEvents':_0x2e5e46,'wallets':{'usdtPolygonWallet':_0x59eb3f[_0x516345(0x231)],'usdtTrcWallet':_0x59eb3f['usdtTrcWallet'],'usdtErcWallet':_0x59eb3f[_0x516345(0x219)],'usdcPolygonWallet':_0x59eb3f[_0x516345(0x226)],'usdcErcWallet':_0x59eb3f[_0x516345(0x1d1)]},'status':_0x59eb3f[_0x516345(0x20f)],'createdAt':_0x59eb3f[_0x516345(0x286)]};}async[a79_0x77160f(0x2ad)](_0x51b1a8,_0x3e1ec8){const _0x11cd72=a79_0x77160f,_0x50c523=await database_1['default'][_0x11cd72(0x24e)][_0x11cd72(0x22b)]({'where':{'id':_0x51b1a8},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x50c523)throw new Error(_0x11cd72(0x1f1));if(_0x50c523[_0x11cd72(0x22e)]){if(!_0x3e1ec8[_0x11cd72(0x27c)])throw new Error(_0x11cd72(0x2bc));const _0x5c6d0b=speakeasy_1['default'][_0x11cd72(0x2b5)]['verify']({'secret':_0x50c523[_0x11cd72(0x21e)],'encoding':_0x11cd72(0x1e1),'token':_0x3e1ec8[_0x11cd72(0x27c)],'window':0x2});if(!_0x5c6d0b){let _0x1d2187=![];if(_0x50c523[_0x11cd72(0x25d)]){const _0x2fa94e=JSON['parse'](_0x50c523[_0x11cd72(0x25d)]);for(let _0x52aa4c=0x0;_0x52aa4c<_0x2fa94e[_0x11cd72(0x23e)];_0x52aa4c++){const _0xd2232c=await bcryptjs_1[_0x11cd72(0x262)][_0x11cd72(0x27e)](_0x3e1ec8[_0x11cd72(0x27c)],_0x2fa94e[_0x52aa4c]);if(_0xd2232c){_0x1d2187=!![],_0x2fa94e[_0x11cd72(0x29d)](_0x52aa4c,0x1),await database_1[_0x11cd72(0x262)][_0x11cd72(0x24e)]['update']({'where':{'id':_0x51b1a8},'data':{'backupCodes':JSON[_0x11cd72(0x220)](_0x2fa94e)}});break;}}}if(!_0x1d2187)throw new Error(_0x11cd72(0x2af));}}const _0x31e064={};_0x3e1ec8[_0x11cd72(0x231)]!==undefined&&(_0x31e064[_0x11cd72(0x231)]=_0x3e1ec8['usdtPolygonWallet']||null),_0x3e1ec8[_0x11cd72(0x27b)]!==undefined&&(_0x31e064[_0x11cd72(0x27b)]=_0x3e1ec8[_0x11cd72(0x27b)]||null),_0x3e1ec8[_0x11cd72(0x219)]!==undefined&&(_0x31e064[_0x11cd72(0x219)]=_0x3e1ec8['usdtErcWallet']||null),_0x3e1ec8['usdcPolygonWallet']!==undefined&&(_0x31e064[_0x11cd72(0x226)]=_0x3e1ec8[_0x11cd72(0x226)]||null),_0x3e1ec8[_0x11cd72(0x1d1)]!==undefined&&(_0x31e064[_0x11cd72(0x1d1)]=_0x3e1ec8[_0x11cd72(0x1d1)]||null),await database_1[_0x11cd72(0x262)]['shop']['update']({'where':{'id':_0x51b1a8},'data':_0x31e064});}async['testWebhook'](_0x42aa02){const _0xb9f2c1=a79_0x77160f,_0x25425e=await database_1[_0xb9f2c1(0x262)][_0xb9f2c1(0x24e)][_0xb9f2c1(0x22b)]({'where':{'id':_0x42aa02},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x25425e?.[_0xb9f2c1(0x2ae)]?.[_0xb9f2c1(0x205)])throw new Error(_0xb9f2c1(0x266));const _0x4f81f4={'event':_0xb9f2c1(0x26f),'payment':{'id':_0xb9f2c1(0x28c),'order_id':'test_order_123','gateway':_0xb9f2c1(0x26f),'amount':0x64,'currency':'USD','status':_0xb9f2c1(0x1d6),'created_at':new Date()[_0xb9f2c1(0x22d)]()}};try{const _0x3ecdf5=await fetch(_0x25425e[_0xb9f2c1(0x2ae)]['webhookUrl'],{'method':_0xb9f2c1(0x1d8),'headers':{'Content-Type':_0xb9f2c1(0x1e9),'User-Agent':'Payment\x20System/1.0\x20(Test)'},'body':JSON[_0xb9f2c1(0x220)](_0x4f81f4)});return _0x3ecdf5['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x3ecdf5[_0xb9f2c1(0x20f)]+')'}:{'success':![],'message':_0xb9f2c1(0x28d)+_0x3ecdf5['status']+'\x20'+_0x3ecdf5[_0xb9f2c1(0x242)]};}catch(_0x3447c2){return{'success':![],'message':_0xb9f2c1(0x2b0)+(_0x3447c2 instanceof Error?_0x3447c2[_0xb9f2c1(0x25a)]:_0xb9f2c1(0x290))};}}async[a79_0x77160f(0x24a)](_0x3c2b5e){const _0x1d6b8f=a79_0x77160f;return this[_0x1d6b8f(0x229)][_0x1d6b8f(0x2a0)]({'public_key':'','gateway':_0x3c2b5e['gateway'],'order_id':undefined,'amount':_0x3c2b5e[_0x1d6b8f(0x1df)],'currency':_0x3c2b5e[_0x1d6b8f(0x276)],'source_currency':_0x3c2b5e[_0x1d6b8f(0x28f)],'usage':_0x3c2b5e[_0x1d6b8f(0x2b3)],'expires_at':_0x3c2b5e[_0x1d6b8f(0x2b9)]?.[_0x1d6b8f(0x22d)](),'success_url':_0x3c2b5e[_0x1d6b8f(0x267)],'fail_url':_0x3c2b5e[_0x1d6b8f(0x267)],'customer_email':_0x3c2b5e[_0x1d6b8f(0x201)],'customer_name':_0x3c2b5e[_0x1d6b8f(0x288)],'country':_0x3c2b5e[_0x1d6b8f(0x208)],'language':_0x3c2b5e[_0x1d6b8f(0x2aa)],'amount_is_editable':_0x3c2b5e[_0x1d6b8f(0x247)],'max_payments':_0x3c2b5e[_0x1d6b8f(0x1e2)],'customer':_0x3c2b5e['customer']});}async[a79_0x77160f(0x24b)](_0x1c1877,_0x5946b4){const _0x5b43a3=a79_0x77160f;return this['paymentService'][_0x5b43a3(0x1dd)](_0x1c1877,_0x5946b4);}async[a79_0x77160f(0x2a8)](_0x13e8b0,_0x1fbb45){const _0x101a64=a79_0x77160f;return this['paymentService'][_0x101a64(0x26c)](_0x13e8b0,_0x1fbb45);}async[a79_0x77160f(0x241)](_0x1e2896,_0x4cc97f,_0x1d1218){const _0x4b0cb1=a79_0x77160f,_0x3dc50f=await database_1[_0x4b0cb1(0x262)][_0x4b0cb1(0x1fb)][_0x4b0cb1(0x23a)]({'where':{'id':_0x4cc97f,'shopId':_0x1e2896}});if(!_0x3dc50f)throw new Error(_0x4b0cb1(0x2a6));const _0xfae2c6=await database_1[_0x4b0cb1(0x262)]['payment'][_0x4b0cb1(0x29b)]({'where':{'id':_0x4cc97f},'data':{..._0x1d1218,'updatedAt':new Date()}});return _0xfae2c6;}async['deletePayment'](_0xc48816,_0x318fde){const _0x157075=a79_0x77160f,_0x6edbfa=await database_1[_0x157075(0x262)][_0x157075(0x1fb)][_0x157075(0x23a)]({'where':{'id':_0x318fde,'shopId':_0xc48816}});if(!_0x6edbfa)throw new Error(_0x157075(0x2a6));await database_1[_0x157075(0x262)][_0x157075(0x1fb)][_0x157075(0x2b1)]({'where':{'id':_0x318fde}});}[a79_0x77160f(0x244)](_0x28b996){const _0x2a6f7b=a79_0x77160f,_0x20f618={'polygon':_0x2a6f7b(0x250),'trc20':_0x2a6f7b(0x1fd),'erc20':_0x2a6f7b(0x2ab),'bsc':_0x2a6f7b(0x236),'polygon_usdc':_0x2a6f7b(0x20d),'erc20_usdc':_0x2a6f7b(0x1db)};return _0x20f618[_0x28b996]||_0x28b996;}async['getPayouts'](_0x53afa5,_0x54b48a){const _0x30555a=a79_0x77160f,{page:_0x3eb1e7,limit:_0x44900c,status:_0x4aebad,method:_0x15391e,network:_0x3da059,dateFrom:_0x187215,dateTo:_0x38dfe7,periodFrom:_0x5f4e7a,periodTo:_0x5a824b}=_0x54b48a,_0xaba6d4=(_0x3eb1e7-0x1)*_0x44900c;console['log']('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x54b48a);const _0x46ef7a={'shopId':_0x53afa5};_0x4aebad&&(_0x46ef7a[_0x30555a(0x20f)]=_0x4aebad['toUpperCase'](),console[_0x30555a(0x239)]('üìä\x20Status\x20filter:\x20'+_0x4aebad['toUpperCase']()));if(_0x15391e)_0x46ef7a[_0x30555a(0x2b8)]=_0x15391e,console[_0x30555a(0x239)](_0x30555a(0x1fe)+_0x15391e);else _0x3da059&&(_0x46ef7a[_0x30555a(0x2b8)]=_0x3da059,console[_0x30555a(0x239)]('üåê\x20Network\x20filter:\x20'+_0x3da059));if(_0x187215||_0x38dfe7||_0x5f4e7a||_0x5a824b){_0x46ef7a[_0x30555a(0x286)]={};if(_0x5f4e7a){const _0x347267=new Date(_0x5f4e7a);_0x347267[_0x30555a(0x1e6)](0x0,0x0,0x0,0x1),_0x46ef7a[_0x30555a(0x286)]['gte']=_0x347267,console['log'](_0x30555a(0x1eb)+_0x347267[_0x30555a(0x22d)]());}else{if(_0x187215){const _0x429dd5=new Date(_0x187215);_0x429dd5[_0x30555a(0x1e6)](0x0,0x0,0x0,0x1),_0x46ef7a[_0x30555a(0x286)]['gte']=_0x429dd5,console['log'](_0x30555a(0x20b)+_0x429dd5['toISOString']());}}if(_0x5a824b){const _0x42b795=new Date(_0x5a824b);_0x42b795['setHours'](0x17,0x3b,0x3b,0x3e7),_0x46ef7a[_0x30555a(0x286)][_0x30555a(0x21d)]=_0x42b795,console[_0x30555a(0x239)]('üìÖ\x20Period\x20end:\x20'+_0x42b795[_0x30555a(0x22d)]());}else{if(_0x38dfe7){const _0x444ad7=new Date(_0x38dfe7);_0x444ad7[_0x30555a(0x1e6)](0x17,0x3b,0x3b,0x3e7),_0x46ef7a[_0x30555a(0x286)][_0x30555a(0x21d)]=_0x444ad7,console[_0x30555a(0x239)]('üìÖ\x20Date\x20end:\x20'+_0x444ad7[_0x30555a(0x22d)]());}}}console[_0x30555a(0x239)](_0x30555a(0x26b),JSON[_0x30555a(0x220)](_0x46ef7a,null,0x2));const [_0x4392a5,_0x30370e]=await Promise[_0x30555a(0x2be)]([database_1[_0x30555a(0x262)][_0x30555a(0x299)][_0x30555a(0x233)]({'where':_0x46ef7a,'skip':_0xaba6d4,'take':_0x44900c,'orderBy':{'createdAt':_0x30555a(0x293)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x30555a(0x262)][_0x30555a(0x299)]['count']({'where':_0x46ef7a})]);return{'payouts':_0x4392a5['map'](_0x2c6418=>{const _0x3efff2=_0x30555a;let _0x1555ed=null;switch(_0x2c6418[_0x3efff2(0x2b8)]){case'polygon':_0x1555ed=_0x2c6418[_0x3efff2(0x24e)][_0x3efff2(0x231)];break;case _0x3efff2(0x1ed):_0x1555ed=_0x2c6418[_0x3efff2(0x24e)]['usdtTrcWallet'];break;case _0x3efff2(0x2a3):_0x1555ed=_0x2c6418[_0x3efff2(0x24e)][_0x3efff2(0x219)];break;case _0x3efff2(0x298):_0x1555ed=_0x2c6418[_0x3efff2(0x24e)][_0x3efff2(0x226)];break;case _0x3efff2(0x280):_0x1555ed=_0x2c6418[_0x3efff2(0x24e)][_0x3efff2(0x1d1)];break;}return{'id':_0x2c6418['id'],'amount':_0x2c6418[_0x3efff2(0x1df)],'network':this[_0x3efff2(0x244)](_0x2c6418[_0x3efff2(0x2b8)]),'wallet':_0x1555ed,'status':_0x2c6418[_0x3efff2(0x20f)],'txid':_0x2c6418[_0x3efff2(0x225)],'notes':_0x2c6418[_0x3efff2(0x228)],'periodFrom':_0x2c6418['periodFrom'],'periodTo':_0x2c6418[_0x3efff2(0x25e)],'createdAt':_0x2c6418['createdAt'],'paidAt':_0x2c6418['paidAt']};}),'pagination':{'page':_0x3eb1e7,'limit':_0x44900c,'total':_0x30370e,'totalPages':Math[_0x30555a(0x1d2)](_0x30370e/_0x44900c)}};}async['getPayoutById'](_0x32d67c,_0x348424){const _0x44bd88=a79_0x77160f,_0x2f8476=await database_1[_0x44bd88(0x262)][_0x44bd88(0x299)][_0x44bd88(0x23a)]({'where':{'id':_0x348424,'shopId':_0x32d67c}});if(!_0x2f8476)return null;return{'id':_0x2f8476['id'],'amount':_0x2f8476[_0x44bd88(0x1df)],'network':_0x2f8476[_0x44bd88(0x2b8)],'status':_0x2f8476[_0x44bd88(0x20f)],'txid':_0x2f8476[_0x44bd88(0x225)],'notes':_0x2f8476[_0x44bd88(0x228)],'createdAt':_0x2f8476[_0x44bd88(0x286)],'paidAt':_0x2f8476['paidAt']};}async[a79_0x77160f(0x1e8)](_0x385ad3,_0x42330a){const _0x258084=a79_0x77160f,_0x15ccff=new Date();let _0x191942,_0xd84c6f;switch(_0x42330a){case'yesterday':case _0x258084(0x224):const _0x14c264=new Date(_0x15ccff);_0x14c264[_0x258084(0x260)](_0x14c264[_0x258084(0x1ec)]()-0x1),_0x191942=new Date(_0x14c264),_0x191942[_0x258084(0x1e6)](0x0,0x0,0x0,0x0),_0xd84c6f=new Date(_0x14c264),_0xd84c6f['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x191942=new Date(_0x15ccff[_0x258084(0x2b2)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x258084(0x21c):_0x191942=new Date(_0x15ccff[_0x258084(0x2b2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x258084(0x2a2):_0x191942=new Date(_0x15ccff[_0x258084(0x2b2)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x191942=new Date(_0x15ccff['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x5d46f1={'gte':_0x191942};_0xd84c6f&&(_0x5d46f1[_0x258084(0x21d)]=_0xd84c6f);const [_0x57cd56,_0x49198d,_0x136285,_0x299198,_0x49d051,_0x21028d]=await Promise[_0x258084(0x2be)]([database_1[_0x258084(0x262)][_0x258084(0x299)][_0x258084(0x223)]({'where':{'shopId':_0x385ad3,'createdAt':_0x5d46f1}}),database_1[_0x258084(0x262)][_0x258084(0x299)]['count']({'where':{'shopId':_0x385ad3,'status':_0x258084(0x251),'createdAt':_0x5d46f1}}),database_1[_0x258084(0x262)]['payout']['count']({'where':{'shopId':_0x385ad3,'status':'PENDING','createdAt':_0x5d46f1}}),database_1[_0x258084(0x262)]['payout'][_0x258084(0x223)]({'where':{'shopId':_0x385ad3,'status':_0x258084(0x26a),'createdAt':_0x5d46f1}}),database_1['default'][_0x258084(0x299)][_0x258084(0x233)]({'where':{'shopId':_0x385ad3,'createdAt':_0x5d46f1},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x258084(0x262)][_0x258084(0x299)][_0x258084(0x233)]({'where':{'shopId':_0x385ad3},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x414d7a=_0x49d051['reduce']((_0x224aca,_0x5c968e)=>_0x224aca+_0x5c968e['amount'],0x0),_0x28825c=_0x49d051[_0x258084(0x200)](_0x3a012a=>_0x3a012a[_0x258084(0x20f)]===_0x258084(0x251))['reduce']((_0x5d2c87,_0x58a66c)=>_0x5d2c87+_0x58a66c[_0x258084(0x1df)],0x0),_0x314525=_0x49d051[_0x258084(0x200)](_0xe70eba=>_0xe70eba[_0x258084(0x20f)]===_0x258084(0x29a))[_0x258084(0x24d)]((_0x5122df,_0x588613)=>_0x5122df+_0x588613[_0x258084(0x1df)],0x0),_0x1fab0b=_0x49d051[_0x258084(0x24d)]((_0x1553c6,_0x34b099)=>{const _0x410b89=_0x258084;return _0x1553c6[_0x34b099[_0x410b89(0x2b8)]]=(_0x1553c6[_0x34b099['network']]||0x0)+0x1,_0x1553c6;},{}),_0x4289e4=_0x49d051['reduce']((_0x2f4275,_0x6daa3e)=>{const _0x443673=_0x258084;return _0x2f4275[_0x6daa3e[_0x443673(0x20f)]]=(_0x2f4275[_0x6daa3e[_0x443673(0x20f)]]||0x0)+0x1,_0x2f4275;},{});return{'totalPayouts':_0x57cd56,'completedPayouts':_0x49198d,'pendingPayouts':_0x136285,'rejectedPayouts':_0x299198,'totalAmount':_0x414d7a,'completedAmount':_0x28825c,'pendingAmount':_0x314525,'payoutsByMethod':_0x1fab0b,'payoutsByStatus':_0x4289e4,'recentPayouts':_0x21028d[_0x258084(0x25f)](_0x5db21f=>({'id':_0x5db21f['id'],'shopId':_0x385ad3,'amount':_0x5db21f[_0x258084(0x1df)],'method':_0x5db21f['network'],'status':_0x5db21f[_0x258084(0x20f)],'txid':_0x5db21f[_0x258084(0x225)],'createdAt':_0x5db21f['createdAt'],'paidAt':_0x5db21f[_0x258084(0x248)]}))};}async[a79_0x77160f(0x2bd)](_0xc3c58){const _0x421933=a79_0x77160f;console[_0x421933(0x239)](_0x421933(0x1d4)+_0xc3c58+_0x421933(0x20a));const _0x3954b9=await database_1[_0x421933(0x262)][_0x421933(0x24e)][_0x421933(0x22b)]({'where':{'id':_0xc3c58},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3954b9)throw new Error(_0x421933(0x1f1));const _0x7dfaab=new Date(),_0x3ce950=new Date(_0x7dfaab[_0x421933(0x29f)](),_0x7dfaab[_0x421933(0x221)](),0x1),_0x5e3a67=new Date(_0x7dfaab[_0x421933(0x29f)](),_0x7dfaab[_0x421933(0x221)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x24116f=await database_1[_0x421933(0x262)][_0x421933(0x299)][_0x421933(0x2bb)]({'_sum':{'amount':!![]},'where':{'shopId':_0xc3c58,'createdAt':{'gte':_0x3ce950,'lte':_0x5e3a67},'status':'COMPLETED'}}),_0x20242e=_0x24116f[_0x421933(0x28a)][_0x421933(0x1df)]||0x0,_0x349254={'availableBalance':Math['round'](_0x3954b9['balance']*0x64)/0x64,'totalPaidOut':Math[_0x421933(0x26e)](_0x3954b9[_0x421933(0x210)]*0x64)/0x64,'awaitingPayout':Math[_0x421933(0x26e)](_0x3954b9[_0x421933(0x23d)]*0x64)/0x64,'thisMonth':Math[_0x421933(0x26e)](_0x20242e*0x64)/0x64};return console['log'](_0x421933(0x232)+_0x3954b9[_0x421933(0x1ee)]+_0x421933(0x274)),console['log'](_0x421933(0x26d)+_0x349254[_0x421933(0x281)]+_0x421933(0x273)),console[_0x421933(0x239)](_0x421933(0x269)+_0x349254['totalPaidOut']+_0x421933(0x279)),console[_0x421933(0x239)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x349254[_0x421933(0x1d7)]+_0x421933(0x273)),console[_0x421933(0x239)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x349254['thisMonth']+'\x20USDT'),_0x349254;}[a79_0x77160f(0x252)](_0x5cb166){const _0x1db0ed=a79_0x77160f,_0x2daa16={'test_gateway':'Test\x20Gateway','plisio':_0x1db0ed(0x1f3),'rapyd':_0x1db0ed(0x214),'noda':'Noda','cointopay':_0x1db0ed(0x29c),'klyme_eu':_0x1db0ed(0x282),'klyme_gb':_0x1db0ed(0x25c),'klyme_de':_0x1db0ed(0x283)};return _0x2daa16[_0x5cb166]||_0x5cb166;}async['getPayoutStats'](_0x587e38){return this['getShopPayoutStats'](_0x587e38);}async[a79_0x77160f(0x29e)](_0x5aa790,_0x4ff4c1){const _0x17989b=a79_0x77160f,{page:_0x1fe5ce,limit:_0x357186,paymentId:_0x3bb149}=_0x4ff4c1,_0x2599b0=(_0x1fe5ce-0x1)*_0x357186,_0x437264={'shopId':_0x5aa790};_0x3bb149&&(_0x437264[_0x17989b(0x240)]=_0x3bb149);const [_0x2bc637,_0x84e0c8]=await Promise[_0x17989b(0x2be)]([database_1[_0x17989b(0x262)][_0x17989b(0x294)]['findMany']({'where':_0x437264,'skip':_0x2599b0,'take':_0x357186,'orderBy':{'createdAt':_0x17989b(0x293)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x17989b(0x294)][_0x17989b(0x223)]({'where':_0x437264})]);return{'logs':_0x2bc637[_0x17989b(0x25f)](_0x5a27bc=>({'id':_0x5a27bc['id'],'paymentId':_0x5a27bc[_0x17989b(0x240)],'shopId':_0x5a27bc['shopId'],'event':_0x5a27bc[_0x17989b(0x270)],'statusCode':_0x5a27bc[_0x17989b(0x296)],'retryCount':_0x5a27bc[_0x17989b(0x254)],'responseBody':_0x5a27bc[_0x17989b(0x22c)],'createdAt':_0x5a27bc[_0x17989b(0x286)],'payment':_0x5a27bc['payment']})),'pagination':{'page':_0x1fe5ce,'limit':_0x357186,'total':_0x84e0c8,'totalPages':Math['ceil'](_0x84e0c8/_0x357186)}};}async[a79_0x77160f(0x2a4)](_0x4b921b,_0x435625,_0x22042b,_0x4c9079,_0x58e9dc){const _0x592f6c=a79_0x77160f;console[_0x592f6c(0x239)](_0x592f6c(0x245)+_0x4b921b+_0x592f6c(0x2b7)+_0x435625+_0x592f6c(0x209)+_0x22042b+_0x592f6c(0x1e0)+_0x4c9079);const _0x1ab094=_0x58e9dc?new Date(_0x58e9dc):new Date();let _0x577520,_0x59abb6;if(_0x22042b&&_0x4c9079){const _0x5570d3=new Date(_0x22042b),_0x400323=new Date(_0x4c9079);_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x5570d3['getUTCFullYear'](),_0x5570d3[_0x592f6c(0x1fa)](),_0x5570d3[_0x592f6c(0x1d3)](),0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x400323[_0x592f6c(0x217)](),_0x400323[_0x592f6c(0x1fa)](),_0x400323[_0x592f6c(0x1d3)](),0x17,0x3b,0x3b,0x3e7)),console[_0x592f6c(0x239)](_0x592f6c(0x211)+_0x577520[_0x592f6c(0x22d)]()+_0x592f6c(0x27f)+_0x59abb6[_0x592f6c(0x22d)]());}else{if(_0x435625&&_0x435625[_0x592f6c(0x222)](_0x592f6c(0x28e))){const _0x2acdef=_0x435625[_0x592f6c(0x23c)](_0x592f6c(0x28e),'')[_0x592f6c(0x213)]('_');if(_0x2acdef[_0x592f6c(0x23e)]===0x2){const _0x5025c3=new Date(_0x2acdef[0x0]),_0x4f647e=new Date(_0x2acdef[0x1]);_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x5025c3[_0x592f6c(0x217)](),_0x5025c3[_0x592f6c(0x1fa)](),_0x5025c3[_0x592f6c(0x1d3)](),0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x4f647e[_0x592f6c(0x217)](),_0x4f647e[_0x592f6c(0x1fa)](),_0x4f647e[_0x592f6c(0x1d3)](),0x17,0x3b,0x3b,0x3e7)),console[_0x592f6c(0x239)]('üìÖ\x20Custom\x20period:\x20'+_0x577520[_0x592f6c(0x22d)]()+'\x20to\x20'+_0x59abb6[_0x592f6c(0x22d)]());}else{const _0x106855=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094['getUTCMonth'](),_0x1ab094[_0x592f6c(0x1d3)]()-0x1e));_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x106855['getUTCFullYear'](),_0x106855['getUTCMonth'](),_0x106855[_0x592f6c(0x1d3)](),0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094['getUTCFullYear'](),_0x1ab094['getUTCMonth'](),_0x1ab094[_0x592f6c(0x1d3)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x537240=_0x435625||_0x592f6c(0x265);switch(_0x537240[_0x592f6c(0x1f6)]()){case _0x592f6c(0x207):_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094[_0x592f6c(0x1fa)](),_0x1ab094['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094[_0x592f6c(0x1fa)](),_0x1ab094[_0x592f6c(0x1d3)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x50be19=new Date(_0x1ab094);_0x50be19['setUTCDate'](_0x50be19[_0x592f6c(0x1d3)]()-0x1),_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x50be19['getUTCFullYear'](),_0x50be19[_0x592f6c(0x1fa)](),_0x50be19[_0x592f6c(0x1d3)](),0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x50be19['getUTCFullYear'](),_0x50be19['getUTCMonth'](),_0x50be19[_0x592f6c(0x1d3)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x5d62ac=_0x1ab094['getUTCDay'](),_0x16546b=_0x5d62ac===0x0?-0x6:0x1-_0x5d62ac,_0x2aaa76=_0x1ab094[_0x592f6c(0x1d3)]()+_0x16546b;_0x577520=new Date(Date['UTC'](_0x1ab094['getUTCFullYear'](),_0x1ab094['getUTCMonth'](),_0x2aaa76,0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094['getUTCFullYear'](),_0x1ab094[_0x592f6c(0x1fa)](),_0x1ab094['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x592f6c(0x28b):const _0x135823=new Date(Date['UTC'](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094['getUTCMonth'](),_0x1ab094['getUTCDate']()-0x7)),_0x4370bf=_0x135823[_0x592f6c(0x1f4)](),_0x885aec=_0x4370bf===0x0?-0x6:0x1-_0x4370bf,_0x2e1ac2=_0x135823[_0x592f6c(0x1d3)]()+_0x885aec;_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x135823[_0x592f6c(0x217)](),_0x135823[_0x592f6c(0x1fa)](),_0x2e1ac2,0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x135823[_0x592f6c(0x217)](),_0x135823[_0x592f6c(0x1fa)](),_0x2e1ac2+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x592f6c(0x265):_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date['UTC'](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094['getUTCMonth'](),_0x1ab094[_0x592f6c(0x1d3)](),0x17,0x3b,0x3b,0x3e7));break;case _0x592f6c(0x243):_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094[_0x592f6c(0x1fa)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094['getUTCFullYear'](),_0x1ab094[_0x592f6c(0x1fa)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x592f6c(0x272):_0x577520=new Date(Date[_0x592f6c(0x2b6)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date['UTC'](_0x1ab094[_0x592f6c(0x217)](),_0x1ab094[_0x592f6c(0x1fa)](),_0x1ab094['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x577520=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094['getUTCFullYear'](),_0x1ab094['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x59abb6=new Date(Date[_0x592f6c(0x2b6)](_0x1ab094['getUTCFullYear'](),_0x1ab094[_0x592f6c(0x1fa)](),_0x1ab094[_0x592f6c(0x1d3)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x592f6c(0x239)](_0x592f6c(0x23f)+_0x577520[_0x592f6c(0x22d)]()+_0x592f6c(0x27f)+_0x59abb6[_0x592f6c(0x22d)]());const _0x353792={'gte':_0x577520,'lte':_0x59abb6},[_0x3a61d5,_0x5e31d3,_0x82237e,_0x128961,_0x5092d5,_0x1df03b,_0x34cf49,_0x534977,_0x24d1fd,_0x55b4e0,_0x3f47e7]=await Promise[_0x592f6c(0x2be)]([database_1[_0x592f6c(0x262)][_0x592f6c(0x1fb)]['count']({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)},'status':{'notIn':[_0x592f6c(0x29a),_0x592f6c(0x24f)]},'createdAt':_0x353792}}),database_1[_0x592f6c(0x262)]['payment']['count']({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)},'status':'PAID','createdAt':_0x353792}}),database_1[_0x592f6c(0x262)][_0x592f6c(0x1fb)]['count']({'where':{'shopId':_0x4b921b,'gateway':{'not':'test_gateway'},'status':_0x592f6c(0x1ea)}}),database_1[_0x592f6c(0x262)][_0x592f6c(0x1fb)][_0x592f6c(0x223)]({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)},'status':_0x592f6c(0x271)}}),database_1[_0x592f6c(0x262)][_0x592f6c(0x1fb)]['findMany']({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)},'status':_0x592f6c(0x21a),'createdAt':_0x353792},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x592f6c(0x262)][_0x592f6c(0x1fb)][_0x592f6c(0x233)]({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)}},'take':0x4,'orderBy':{'createdAt':_0x592f6c(0x293)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x592f6c(0x1fb)][_0x592f6c(0x233)]({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)},'createdAt':_0x353792},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x592f6c(0x246)}}),database_1['default'][_0x592f6c(0x1fb)][_0x592f6c(0x223)]({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)},'status':_0x592f6c(0x21a)}}),database_1['default'][_0x592f6c(0x1fb)][_0x592f6c(0x233)]({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)},'status':'PAID'},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x592f6c(0x24e)]['findUnique']({'where':{'id':_0x4b921b},'select':{'balance':!![]}}),database_1[_0x592f6c(0x262)]['payment'][_0x592f6c(0x233)]({'where':{'shopId':_0x4b921b,'gateway':{'not':_0x592f6c(0x20e)}},'select':{'gateway':!![]}})]),_0x569d57={};for(const _0x3d6c59 of _0x3f47e7){_0x3d6c59['gateway']&&(_0x569d57[_0x3d6c59[_0x592f6c(0x216)]]=(_0x569d57[_0x3d6c59[_0x592f6c(0x216)]]||0x0)+0x1);}console[_0x592f6c(0x239)](_0x592f6c(0x1e7),_0x569d57);let _0x4d90bc=0x0,_0x27b96d=0x0;for(const _0xd363b8 of _0x5092d5){if(_0xd363b8[_0x592f6c(0x25b)])_0x4d90bc+=_0xd363b8[_0x592f6c(0x25b)];else{const _0x381bad=await currencyService_1['currencyService'][_0x592f6c(0x1da)](_0xd363b8['amount'],_0xd363b8[_0x592f6c(0x276)]);_0x4d90bc+=_0x381bad;}_0xd363b8[_0x592f6c(0x22a)]&&(_0x27b96d+=_0xd363b8[_0x592f6c(0x22a)]);}let _0x140a75=0x0;for(const _0x20fdde of _0x24d1fd){_0x20fdde[_0x592f6c(0x22a)]&&(_0x140a75+=_0x20fdde[_0x592f6c(0x22a)]);}const _0x1fd595=this['generateDailyStatistics'](_0x34cf49,_0x577520,_0x59abb6||_0x1ab094),_0x1a9693=_0x3a61d5>0x0?_0x5e31d3/_0x3a61d5*0x64:0x0,_0x37ebd0=_0x534977>0x0?_0x82237e/_0x534977*0x64:0x0;return{'totalPayments':_0x3a61d5,'successfulPayments':_0x5e31d3,'totalRevenue':Math[_0x592f6c(0x26e)](_0x4d90bc*0x64)/0x64,'merchantEarnings':Math[_0x592f6c(0x26e)](_0x27b96d*0x64)/0x64,'merchantTotalRevenue':Math['round'](_0x140a75*0x64)/0x64,'payoutBalance':Math[_0x592f6c(0x26e)]((_0x55b4e0?.['balance']||0x0)*0x64)/0x64,'conversionRate':Math[_0x592f6c(0x26e)](_0x1a9693*0x64)/0x64,'chargebackRate':Math['round'](_0x37ebd0*0x64)/0x64,'chargebacks':_0x82237e,'refunds':_0x128961,'paymentsByGateway':_0x569d57,'dailyRevenue':_0x1fd595[_0x592f6c(0x1f7)],'dailyPayments':_0x1fd595[_0x592f6c(0x234)],'recentPayments':_0x1df03b[_0x592f6c(0x25f)](_0x57bcb2=>({'id':_0x57bcb2['id'],'gateway':_0x57bcb2['gateway'],'amount':_0x57bcb2[_0x592f6c(0x1df)],'currency':_0x57bcb2[_0x592f6c(0x276)],'status':_0x57bcb2[_0x592f6c(0x20f)],'createdAt':_0x57bcb2['createdAt']}))};}[a79_0x77160f(0x278)](_0x20696c,_0x50a41d,_0x1b27bb){const _0x2ebafa=a79_0x77160f,_0x273921=new Map(),_0x29936d=new Date(_0x50a41d);while(_0x29936d<=_0x1b27bb){const _0x5ac9f1=_0x29936d[_0x2ebafa(0x22d)]()[_0x2ebafa(0x213)]('T')[0x0];_0x273921[_0x2ebafa(0x297)](_0x5ac9f1,{'revenue':0x0,'count':0x0}),_0x29936d['setDate'](_0x29936d['getDate']()+0x1);}for(const _0x2b517b of _0x20696c){const _0x2596a7=_0x2b517b[_0x2ebafa(0x286)]['toISOString']()['split']('T')[0x0],_0xb4c74c=_0x273921[_0x2ebafa(0x1f9)](_0x2596a7);_0xb4c74c&&(_0xb4c74c[_0x2ebafa(0x223)]+=0x1,_0x2b517b['status']===_0x2ebafa(0x21a)&&_0x2b517b[_0x2ebafa(0x25b)]&&(_0xb4c74c[_0x2ebafa(0x21f)]+=_0x2b517b[_0x2ebafa(0x25b)]));}const _0xd1047f=[],_0x35bca4=[];for(const [_0x34d2c6,_0x1eb8b1]of _0x273921){_0xd1047f[_0x2ebafa(0x2ba)]({'date':_0x34d2c6,'amount':Math['round'](_0x1eb8b1['revenue']*0x64)/0x64}),_0x35bca4['push']({'date':_0x34d2c6,'count':_0x1eb8b1[_0x2ebafa(0x223)]});}return{'dailyRevenue':_0xd1047f,'dailyPayments':_0x35bca4};}['generateBackupCodes'](_0x486b2d=0x8){const _0x3f88e7=a79_0x77160f,_0x5c7be9=[];for(let _0x4d6390=0x0;_0x4d6390<_0x486b2d;_0x4d6390++){const _0xbd4926=crypto_1[_0x3f88e7(0x262)][_0x3f88e7(0x215)](0x4)[_0x3f88e7(0x1e3)](_0x3f88e7(0x263))[_0x3f88e7(0x203)]();_0x5c7be9['push'](_0xbd4926);}return _0x5c7be9;}async[a79_0x77160f(0x1d9)](_0x20697a){const _0x31efd7=a79_0x77160f,_0x5b78f0=await database_1[_0x31efd7(0x262)][_0x31efd7(0x24e)][_0x31efd7(0x22b)]({'where':{'id':_0x20697a},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5b78f0)throw new Error(_0x31efd7(0x1f1));const _0x3b9d55=speakeasy_1[_0x31efd7(0x262)]['generateSecret']({'name':'TrapaPay\x20('+_0x5b78f0[_0x31efd7(0x1ee)]+')','issuer':_0x31efd7(0x2a5),'length':0x20}),_0x83a3f0=await qrcode_1['default'][_0x31efd7(0x1f8)](_0x3b9d55[_0x31efd7(0x20c)]),_0x47e352=this[_0x31efd7(0x257)](0x8),_0x258bc7=await Promise[_0x31efd7(0x2be)](_0x47e352[_0x31efd7(0x25f)](_0x421421=>bcryptjs_1[_0x31efd7(0x262)][_0x31efd7(0x256)](_0x421421,0xa)));return await database_1['default']['shop']['update']({'where':{'id':_0x20697a},'data':{'twoFactorSecret':_0x3b9d55['base32'],'backupCodes':JSON[_0x31efd7(0x220)](_0x258bc7)}}),console[_0x31efd7(0x239)]('üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x5b78f0[_0x31efd7(0x1ee)]),console[_0x31efd7(0x239)](_0x31efd7(0x253)+_0x47e352['length']+_0x31efd7(0x277)),{'secret':_0x3b9d55['base32'],'qrCode':_0x83a3f0,'manualEntryKey':_0x3b9d55['base32'],'backupCodes':_0x47e352};}async[a79_0x77160f(0x295)](_0x2869de,_0x419486){const _0x5c46cd=a79_0x77160f,_0x2041bc=await database_1[_0x5c46cd(0x262)]['shop'][_0x5c46cd(0x22b)]({'where':{'id':_0x2869de},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x2041bc)throw new Error('Shop\x20not\x20found');if(!_0x2041bc[_0x5c46cd(0x21e)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x2041bc['twoFactorEnabled'])throw new Error(_0x5c46cd(0x289));const _0x4e25ff=speakeasy_1[_0x5c46cd(0x262)][_0x5c46cd(0x2b5)]['verify']({'secret':_0x2041bc[_0x5c46cd(0x21e)],'encoding':_0x5c46cd(0x1e1),'token':_0x419486,'window':0x2});if(!_0x4e25ff)throw new Error(_0x5c46cd(0x2b4));return await database_1[_0x5c46cd(0x262)][_0x5c46cd(0x24e)][_0x5c46cd(0x29b)]({'where':{'id':_0x2869de},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x5c46cd(0x275)+_0x2041bc[_0x5c46cd(0x1ee)]),{'enabled':!![]};}async[a79_0x77160f(0x2a7)](_0x611b7a){const _0x4c3c55=a79_0x77160f,_0x541268=await database_1[_0x4c3c55(0x262)][_0x4c3c55(0x24e)][_0x4c3c55(0x22b)]({'where':{'id':_0x611b7a},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x541268)throw new Error('Shop\x20not\x20found');await database_1[_0x4c3c55(0x262)][_0x4c3c55(0x24e)][_0x4c3c55(0x29b)]({'where':{'id':_0x611b7a},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x4c3c55(0x239)](_0x4c3c55(0x237)+_0x541268[_0x4c3c55(0x1ee)]);}}exports[a79_0x77160f(0x287)]=ShopService;function a79_0x2eff(_0x1dd36f,_0x27da0e){_0x1dd36f=_0x1dd36f-0x1ce;const _0x817640=a79_0x8176();let _0x2eff79=_0x817640[_0x1dd36f];return _0x2eff79;}function a79_0x8176(){const _0x172424=['PAID','paymentGateways','30d','lte','twoFactorSecret','revenue','stringify','getMonth','startsWith','count','YESTERDAY','txid','usdcPolygonWallet','qrcode','notes','paymentService','amountAfterGatewayCommissionUSDT','findUnique','responseBody','toISOString','twoFactorEnabled','52482sQeVSV','3525200SlzLJY','usdtPolygonWallet','üìä\x20Shop\x20','findMany','dailyPayments','AVAILABLE_GATEWAYS','USDT\x20BSC','üîê\x202FA\x20disabled\x20for\x20shop:\x20','Error\x20parsing\x20webhook\x20events:','log','findFirst','getShopProfile','replace','balance','length','üìÖ\x20Final\x20date\x20range:\x20','paymentId','updatePayment','statusText','last_month','formatNetworkName','üìä\x20Getting\x20statistics\x20for\x20shop\x20','asc','amountIsEditable','paidAt','../types/gateway','createPayment','getPayments','PaymentService','reduce','shop','EXPIRED','USDT\x20Polygon','COMPLETED','getGatewayDisplayName','üîë\x20Generated\x20','retryCount','../config/database','hash','generateBackupCodes','error','crypto','message','amountUSDT','KLYME\x20GB','backupCodes','periodTo','map','setDate','shopUrl','default','hex','475ewfuvE','this_month','No\x20webhook\x20URL\x20configured','redirectUrl','telegram','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','REJECTED','üìä\x20Final\x20WHERE\x20conditions:','getPaymentByShopAndId','\x20\x20\x20üíµ\x20Available\x20balance:\x20','round','test','event','REFUND','all_time','\x20USDT\x20(current\x20balance)','\x20payout\x20statistics\x20calculated:','üîê\x202FA\x20enabled\x20for\x20shop:\x20','currency','\x20backup\x20codes','generateDailyStatistics','\x20USDT\x20(total\x20payouts)','26680RLEWDT','usdtTrcWallet','twoFactorToken','wallets','compare','\x20to\x20','erc20_usdc','availableBalance','KLYME\x20EU','KLYME\x20DE','861pTMNKE','__esModule','createdAt','ShopService','customerName','2FA\x20is\x20already\x20enabled','_sum','last_week','test_payment_123','Webhook\x20returned\x20error:\x20','custom_','sourceCurrency','Unknown\x20error','parse','gatewaySettings','desc','webhookLog','enable2FA','statusCode','set','polygon_usdc','payout','PENDING','update','CoinToPay','splice','getWebhookLogs','getFullYear','createPublicPayment','updateShopProfile','90d','erc20','getStatistics','TrapaPay','Payment\x20not\x20found','disable2FA','getPaymentById','includes','language','USDT\x20ERC20','7832cNEZtW','updateWallets','settings','Invalid\x202FA\x20token\x20or\x20backup\x20code','Failed\x20to\x20send\x20webhook:\x20','delete','getTime','usage','Invalid\x202FA\x20token','totp','UTC',',\x20period:\x20','network','expiresAt','push','aggregate','2FA\x20token\x20is\x20required','getShopPayoutStats','all','isActive','fullName','publicKey','usdcErcWallet','ceil','getUTCDate','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','8uDibJP','paid','awaitingPayout','POST','setup2FA','convertToUSDT','USDC\x20Ethereum','15631ijjPYn','getPaymentsByShop','merchantUrl','amount',',\x20dateTo:\x20','base32','maxPayments','toString','__importDefault','./paymentService','setHours','üìä\x20Payments\x20by\x20gateway\x20(all\x20time):','getPayoutStatistics','application/json','CHARGEBACK','üìÖ\x20Period\x20start:\x20','getDate','trc20','username','isArray','6121213FCepEe','Shop\x20not\x20found','telegramId','Plisio','getUTCDay','1110625AAcMWP','toLowerCase','dailyRevenue','toDataURL','get','getUTCMonth','payment','speakeasy','USDT\x20TRC20','üåê\x20Method\x20filter:\x20','name','filter','customerEmail','./currencyService','toUpperCase','bcryptjs','webhookUrl','webhookEvents','today','country',',\x20dateFrom:\x20','...','üìÖ\x20Date\x20start:\x20','otpauth_url','USDC\x20Polygon','test_gateway','status','totalPaidOut','üìÖ\x20Custom\x20date\x20range:\x20','16090551bNzJPI','split','Rapyd','randomBytes','gateway','getUTCFullYear','gateways','usdtErcWallet'];a79_0x8176=function(){return _0x172424;};return a79_0x8176();}