'use strict';const a86_0x33953a=a86_0x2e00;function a86_0x2e00(_0x5ba6c2,_0x3d3a8c){_0x5ba6c2=_0x5ba6c2-0x8c;const _0x2fa4ea=a86_0x2fa4();let _0x2e00bc=_0x2fa4ea[_0x5ba6c2];return _0x2e00bc;}(function(_0x5ed1df,_0x17da68){const _0x2a9cfc=a86_0x2e00,_0x55f16e=_0x5ed1df();while(!![]){try{const _0x151a1c=parseInt(_0x2a9cfc(0x113))/0x1*(-parseInt(_0x2a9cfc(0xc5))/0x2)+parseInt(_0x2a9cfc(0xaa))/0x3+parseInt(_0x2a9cfc(0x13e))/0x4*(-parseInt(_0x2a9cfc(0x11c))/0x5)+parseInt(_0x2a9cfc(0xfa))/0x6*(parseInt(_0x2a9cfc(0x119))/0x7)+-parseInt(_0x2a9cfc(0x12a))/0x8+-parseInt(_0x2a9cfc(0xcc))/0x9*(-parseInt(_0x2a9cfc(0x170))/0xa)+parseInt(_0x2a9cfc(0x10e))/0xb;if(_0x151a1c===_0x17da68)break;else _0x55f16e['push'](_0x55f16e['shift']());}catch(_0x3582b5){_0x55f16e['push'](_0x55f16e['shift']());}}}(a86_0x2fa4,0x6eeb0));var __importDefault=this&&this['__importDefault']||function(_0x1a3f7c){const _0x2d18dd=a86_0x2e00;return _0x1a3f7c&&_0x1a3f7c[_0x2d18dd(0xdc)]?_0x1a3f7c:{'default':_0x1a3f7c};};function a86_0x2fa4(){const _0x528834=['telegram','split','Invalid\x202FA\x20token','secretKey','merchantUrl4','findMany','generateDailyStatistics','setUTCDate','application/json','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','getPaymentsByShop','twoFactorEnabled','trc20','2595170OGljul','shopId','setDate','getPaymentByShopAndId','USDT\x20Polygon','Noda','crypto','paymentGateways','usdtErcWallet','Webhook\x20returned\x20error:\x20','createHmac','test','getShopPayoutStats','statusCode','getFullYear','updateShopProfile','ðŸ“…\x20Date\x20start:\x20','default','Failed\x20to\x20send\x20webhook:\x20','USDC\x20Ethereum','usdcErcWallet','hex','backupCodes','otpauth_url','Error\x20parsing\x20webhook\x20events:','filter','update','speakeasy','verify','generateBackupCodes','responseBody','KLYME\x20GB','publicKey','Plisio','lte','TrapaPay\x20(','merchantUrl','telegramId','today','541017zFWxch','name','twoFactorSecret','webhookEvents','all_time','ðŸ“…\x20Custom\x20period:\x20','ðŸ“Š\x20Shop\x20','test_payment_123','toUpperCase','ðŸŒ\x20Network\x20filter:\x20','...','enable2FA','disable2FA','toLowerCase','getShopProfile','set','amountAfterGatewayCommissionUSDT','createdAt','\x20to\x20','shopUrl2','stringify','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','gateway','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','webhookLog','ðŸ“Š\x20Getting\x20statistics\x20for\x20shop\x20','event','574NAhWOK','_sum','base32','2FA\x20is\x20already\x20enabled','map','ðŸ’°\x20Getting\x20payouts\x20with\x20filters:','Invalid\x202FA\x20token\x20or\x20backup\x20code','27xuiWem','gatewaySettings','notes','\x20\x20\x20ðŸ’°\x20Total\x20paid\x20out:\x20','POST','currency','USDT\x20TRC20','getUTCDay','amount','paymentService','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','language','ðŸ“…\x20Custom\x20date\x20range:\x20','gte','round','wallets','__esModule','generateSecret','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','bcryptjs','txid','toDataURL','\x20USDT\x20(current\x20balance)','YESTERDAY','Rapyd','getDate','ðŸ“…\x20Date\x20end:\x20','error','\x20payout\x20statistics\x20calculated:','toISOString','qrcode','KLYME\x20EU','ceil','getPayoutStatistics','ðŸ“…\x20Final\x20date\x20range:\x20','replace','push','payment','ðŸ”‘\x20Generated\x20','length','createPublicPayment','totp','updateWallets','usdtPolygonWallet','getPayoutById','ðŸŒ\x20Method\x20filter:\x20','696684TuFPLR','ðŸ“Š\x20Final\x20WHERE\x20conditions:','fullName','settings','Payment\x20System/1.0\x20(Test)','getTime','network','findUnique','splice','ShopService','COMPLETED','getPaymentById','test_order_123','totalPaidOut','webhookUrl','CHARGEBACK','./currencyService','last_month','test_gateway','ðŸ“Š\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','3146407DjnboI','90d','usdtTrcWallet',',\x20dateFrom:\x20','customerName','1971IohbOY','status','sourceCurrency','convertToUSDT','yesterday','aggregate','42GzBfLX','amountUSDT','erc20_usdc','5ptvaLa','EXPIRED','shopUrl3','custom_','asc','availableBalance','2FA\x20token\x20is\x20required','getPayouts','TrapaPay','CoinToPay','PENDING','dailyPayments','Payment\x20not\x20found','usdcPolygonWallet','2712320qoJNLW','redirectUrl','parse','hash','getMonth','balance','dailyRevenue','last_week','setHours','gateways','testWebhook','findFirst','shopUrl4','ðŸ“Š\x20Payments\x20by\x20gateway\x20(all\x20time):','twoFactorToken','paidAt','all','formatNetworkName','shopUrl','this_month','2330296YZvIAs','delete','USDT\x20BSC','desc','shop','payout','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','getUTCMonth','includes','getUTCFullYear','retryCount','Unknown\x20error','revenue','this_week','count','createPayment','log','ðŸ“…\x20Period\x20end:\x20','UTC','reduce','getUTCDate','toString','REFUND','Test\x20Gateway','Shop\x20not\x20found','getWebhookLogs','30d','isArray','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','awaitingPayout','merchantUrl2','getPayoutStats','username','periodTo','thisMonth','merchantUrl3','PAID'];a86_0x2fa4=function(){return _0x528834;};return a86_0x2fa4();}Object['defineProperty'](exports,a86_0x33953a(0xdc),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a86_0x33953a(0xdf))),crypto_1=__importDefault(require(a86_0x33953a(0x176))),speakeasy_1=__importDefault(require(a86_0x33953a(0x9e))),qrcode_1=__importDefault(require(a86_0x33953a(0xea))),currencyService_1=require(a86_0x33953a(0x10a)),paymentService_1=require('./paymentService'),gateway_1=require('../types/gateway');class ShopService{constructor(){const _0x56f25e=a86_0x33953a;this[_0x56f25e(0xd5)]=new paymentService_1['PaymentService']();}async[a86_0x33953a(0xb8)](_0x2e5706){const _0x17b28a=a86_0x33953a,_0x39827d=await database_1['default'][_0x17b28a(0x142)][_0x17b28a(0x101)]({'where':{'id':_0x2e5706},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x39827d)throw new Error(_0x17b28a(0x156));let _0x271d7d=[];if(_0x39827d[_0x17b28a(0xfd)]?.[_0x17b28a(0xad)])try{_0x271d7d=Array['isArray'](_0x39827d[_0x17b28a(0xfd)]['webhookEvents'])?_0x39827d[_0x17b28a(0xfd)][_0x17b28a(0xad)]:JSON['parse'](_0x39827d[_0x17b28a(0xfd)][_0x17b28a(0xad)]);}catch(_0x5736c9){console[_0x17b28a(0xe7)](_0x17b28a(0x9b),_0x5736c9),_0x271d7d=[];}const _0xc25340=gateway_1['AVAILABLE_GATEWAYS']['filter'](_0x1f55ec=>_0x1f55ec['isActive'])['map'](_0x60aa0d=>_0x60aa0d[_0x17b28a(0xab)]);let _0x5cd3c7=_0x39827d[_0x17b28a(0x177)]?JSON['parse'](_0x39827d[_0x17b28a(0x177)]):[];return Array[_0x17b28a(0x159)](_0x5cd3c7)&&(_0x5cd3c7=_0x5cd3c7[_0x17b28a(0xc9)](_0x215be5=>_0x215be5['replace'](/\s+/g,'_')['toLowerCase']())['filter'](_0x278cf3=>_0xc25340[_0x17b28a(0x146)](_0x278cf3))),{'id':_0x39827d['id'],'fullName':_0x39827d['name'],'username':_0x39827d['username'],'telegramId':_0x39827d[_0x17b28a(0x163)],'merchantUrl':_0x39827d['shopUrl'],'merchantUrl2':_0x39827d[_0x17b28a(0xbd)],'merchantUrl3':_0x39827d[_0x17b28a(0x11e)],'merchantUrl4':_0x39827d[_0x17b28a(0x136)],'gateways':_0x5cd3c7,'gatewaySettings':_0x39827d[_0x17b28a(0xcd)]?JSON[_0x17b28a(0x12c)](_0x39827d[_0x17b28a(0xcd)]):null,'publicKey':_0x39827d[_0x17b28a(0xa3)],'secretKey':_0x39827d[_0x17b28a(0x166)],'webhookUrl':_0x39827d[_0x17b28a(0xfd)]?.['webhookUrl']||null,'webhookEvents':_0x271d7d,'wallets':{'usdtPolygonWallet':_0x39827d[_0x17b28a(0xf7)],'usdtTrcWallet':_0x39827d[_0x17b28a(0x110)],'usdtErcWallet':_0x39827d[_0x17b28a(0x178)],'usdcPolygonWallet':_0x39827d[_0x17b28a(0x129)],'usdcErcWallet':_0x39827d[_0x17b28a(0x97)]},'status':_0x39827d[_0x17b28a(0x114)],'createdAt':_0x39827d['createdAt']};}async[a86_0x33953a(0x92)](_0x41e8f7,_0xff8a05){const _0x4696fc=a86_0x33953a,_0x1ddf69={};_0xff8a05['fullName']&&(_0x1ddf69[_0x4696fc(0xab)]=_0xff8a05[_0x4696fc(0xfc)]);_0xff8a05['telegramId']!==undefined&&(_0x1ddf69['telegram']=_0xff8a05[_0x4696fc(0xa8)]||null);_0xff8a05['merchantUrl']&&(_0x1ddf69[_0x4696fc(0x13c)]=_0xff8a05[_0x4696fc(0xa7)]);_0xff8a05[_0x4696fc(0x15c)]!==undefined&&(_0x1ddf69[_0x4696fc(0xbd)]=_0xff8a05['merchantUrl2']||null);_0xff8a05[_0x4696fc(0x161)]!==undefined&&(_0x1ddf69[_0x4696fc(0x11e)]=_0xff8a05['merchantUrl3']||null);_0xff8a05[_0x4696fc(0x167)]!==undefined&&(_0x1ddf69[_0x4696fc(0x136)]=_0xff8a05['merchantUrl4']||null);_0xff8a05[_0x4696fc(0x133)]&&(_0x1ddf69['paymentGateways']=JSON['stringify'](_0xff8a05[_0x4696fc(0x133)]));_0xff8a05[_0x4696fc(0xcd)]&&(_0x1ddf69[_0x4696fc(0xcd)]=JSON[_0x4696fc(0xbe)](_0xff8a05[_0x4696fc(0xcd)]));_0xff8a05['wallets']&&(_0xff8a05[_0x4696fc(0xdb)][_0x4696fc(0xf7)]!==undefined&&(_0x1ddf69[_0x4696fc(0xf7)]=_0xff8a05[_0x4696fc(0xdb)][_0x4696fc(0xf7)]||null),_0xff8a05[_0x4696fc(0xdb)][_0x4696fc(0x110)]!==undefined&&(_0x1ddf69[_0x4696fc(0x110)]=_0xff8a05[_0x4696fc(0xdb)][_0x4696fc(0x110)]||null),_0xff8a05[_0x4696fc(0xdb)]['usdtErcWallet']!==undefined&&(_0x1ddf69[_0x4696fc(0x178)]=_0xff8a05[_0x4696fc(0xdb)]['usdtErcWallet']||null),_0xff8a05['wallets'][_0x4696fc(0x129)]!==undefined&&(_0x1ddf69['usdcPolygonWallet']=_0xff8a05['wallets'][_0x4696fc(0x129)]||null));const _0x385770=await database_1[_0x4696fc(0x94)][_0x4696fc(0x142)][_0x4696fc(0x9d)]({'where':{'id':_0x41e8f7},'data':_0x1ddf69,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x10ca94=[];if(_0x385770[_0x4696fc(0xfd)]?.['webhookEvents'])try{_0x10ca94=Array[_0x4696fc(0x159)](_0x385770[_0x4696fc(0xfd)][_0x4696fc(0xad)])?_0x385770['settings'][_0x4696fc(0xad)]:JSON[_0x4696fc(0x12c)](_0x385770[_0x4696fc(0xfd)][_0x4696fc(0xad)]);}catch(_0x23df8f){console[_0x4696fc(0xe7)](_0x4696fc(0x9b),_0x23df8f),_0x10ca94=[];}return{'id':_0x385770['id'],'fullName':_0x385770[_0x4696fc(0xab)],'username':_0x385770['username'],'telegramId':_0x385770[_0x4696fc(0x163)],'merchantUrl':_0x385770[_0x4696fc(0x13c)],'merchantUrl2':_0x385770[_0x4696fc(0xbd)],'merchantUrl3':_0x385770[_0x4696fc(0x11e)],'merchantUrl4':_0x385770[_0x4696fc(0x136)],'gateways':_0x385770[_0x4696fc(0x177)]?JSON[_0x4696fc(0x12c)](_0x385770[_0x4696fc(0x177)]):null,'gatewaySettings':_0x385770[_0x4696fc(0xcd)]?JSON['parse'](_0x385770[_0x4696fc(0xcd)]):null,'publicKey':_0x385770[_0x4696fc(0xa3)],'secretKey':_0x385770['secretKey'],'webhookUrl':_0x385770[_0x4696fc(0xfd)]?.['webhookUrl']||null,'webhookEvents':_0x10ca94,'wallets':{'usdtPolygonWallet':_0x385770['usdtPolygonWallet'],'usdtTrcWallet':_0x385770[_0x4696fc(0x110)],'usdtErcWallet':_0x385770['usdtErcWallet'],'usdcPolygonWallet':_0x385770[_0x4696fc(0x129)],'usdcErcWallet':_0x385770['usdcErcWallet']},'status':_0x385770['status'],'createdAt':_0x385770['createdAt']};}async[a86_0x33953a(0xf6)](_0x26eb7a,_0x5d231f){const _0xaef9d5=a86_0x33953a,_0x17a22a=await database_1[_0xaef9d5(0x94)][_0xaef9d5(0x142)]['findUnique']({'where':{'id':_0x26eb7a},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x17a22a)throw new Error(_0xaef9d5(0x156));if(_0x17a22a[_0xaef9d5(0x16e)]){if(!_0x5d231f[_0xaef9d5(0x138)])throw new Error(_0xaef9d5(0x122));const _0x3f7e7f=speakeasy_1['default'][_0xaef9d5(0xf5)][_0xaef9d5(0x9f)]({'secret':_0x17a22a[_0xaef9d5(0xac)],'encoding':_0xaef9d5(0xc7),'token':_0x5d231f[_0xaef9d5(0x138)],'window':0x2});if(!_0x3f7e7f){let _0x484cc0=![];if(_0x17a22a[_0xaef9d5(0x99)]){const _0x136047=JSON[_0xaef9d5(0x12c)](_0x17a22a['backupCodes']);for(let _0x535ece=0x0;_0x535ece<_0x136047[_0xaef9d5(0xf3)];_0x535ece++){const _0x26f40b=await bcryptjs_1[_0xaef9d5(0x94)]['compare'](_0x5d231f[_0xaef9d5(0x138)],_0x136047[_0x535ece]);if(_0x26f40b){_0x484cc0=!![],_0x136047[_0xaef9d5(0x102)](_0x535ece,0x1),await database_1[_0xaef9d5(0x94)]['shop'][_0xaef9d5(0x9d)]({'where':{'id':_0x26eb7a},'data':{'backupCodes':JSON[_0xaef9d5(0xbe)](_0x136047)}});break;}}}if(!_0x484cc0)throw new Error(_0xaef9d5(0xcb));}}const _0x4b5e8f={};_0x5d231f['usdtPolygonWallet']!==undefined&&(_0x4b5e8f['usdtPolygonWallet']=_0x5d231f[_0xaef9d5(0xf7)]||null),_0x5d231f[_0xaef9d5(0x110)]!==undefined&&(_0x4b5e8f[_0xaef9d5(0x110)]=_0x5d231f[_0xaef9d5(0x110)]||null),_0x5d231f[_0xaef9d5(0x178)]!==undefined&&(_0x4b5e8f[_0xaef9d5(0x178)]=_0x5d231f[_0xaef9d5(0x178)]||null),_0x5d231f['usdcPolygonWallet']!==undefined&&(_0x4b5e8f[_0xaef9d5(0x129)]=_0x5d231f['usdcPolygonWallet']||null),_0x5d231f[_0xaef9d5(0x97)]!==undefined&&(_0x4b5e8f[_0xaef9d5(0x97)]=_0x5d231f['usdcErcWallet']||null),await database_1[_0xaef9d5(0x94)]['shop'][_0xaef9d5(0x9d)]({'where':{'id':_0x26eb7a},'data':_0x4b5e8f});}async[a86_0x33953a(0x134)](_0x5622b2){const _0x2e57a1=a86_0x33953a,_0x3bc64a=await database_1[_0x2e57a1(0x94)][_0x2e57a1(0x142)][_0x2e57a1(0x101)]({'where':{'id':_0x5622b2},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x3bc64a?.['settings']?.[_0x2e57a1(0x108)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x12159c={'event':_0x2e57a1(0x8e),'payment':{'id':_0x2e57a1(0xb1),'order_id':_0x2e57a1(0x106),'gateway':_0x2e57a1(0x8e),'amount':0x64,'currency':'USD','status':'paid','created_at':new Date()[_0x2e57a1(0xe9)]()}};try{const _0x12822f=JSON[_0x2e57a1(0xbe)](_0x12159c),_0xd833f4=crypto_1[_0x2e57a1(0x94)][_0x2e57a1(0x8d)]('sha256',_0x3bc64a[_0x2e57a1(0x166)])[_0x2e57a1(0x9d)](_0x12822f)['digest'](_0x2e57a1(0x98)),_0x81f11c=await fetch(_0x3bc64a[_0x2e57a1(0xfd)][_0x2e57a1(0x108)],{'method':_0x2e57a1(0xd0),'headers':{'Content-Type':_0x2e57a1(0x16b),'User-Agent':_0x2e57a1(0xfe),'X-Webhook-Signature':_0xd833f4},'body':_0x12822f});return _0x81f11c['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x81f11c[_0x2e57a1(0x114)]+')'}:{'success':![],'message':_0x2e57a1(0x8c)+_0x81f11c[_0x2e57a1(0x114)]+'\x20'+_0x81f11c['statusText']};}catch(_0x4bf658){return{'success':![],'message':_0x2e57a1(0x95)+(_0x4bf658 instanceof Error?_0x4bf658['message']:_0x2e57a1(0x149))};}}async[a86_0x33953a(0x14d)](_0x20193c){const _0x6ca60b=a86_0x33953a;return this[_0x6ca60b(0xd5)][_0x6ca60b(0xf4)]({'public_key':'','gateway':_0x20193c['gateway'],'order_id':'','amount':_0x20193c[_0x6ca60b(0xd4)],'currency':_0x20193c[_0x6ca60b(0xd1)],'source_currency':_0x20193c[_0x6ca60b(0x115)],'success_url':_0x20193c[_0x6ca60b(0x12b)],'fail_url':_0x20193c[_0x6ca60b(0x12b)],'customer_email':_0x20193c['customerEmail'],'customer_name':_0x20193c[_0x6ca60b(0x112)],'language':_0x20193c[_0x6ca60b(0xd7)]});}async['getPayments'](_0x494b41,_0x35119d){const _0x52ac2a=a86_0x33953a;return this[_0x52ac2a(0xd5)][_0x52ac2a(0x16d)](_0x494b41,_0x35119d);}async[a86_0x33953a(0x105)](_0x52f03c,_0x4bd9ee){const _0x5c68bd=a86_0x33953a;return this[_0x5c68bd(0xd5)][_0x5c68bd(0x173)](_0x52f03c,_0x4bd9ee);}async['updatePayment'](_0x4274cf,_0x144b27,_0x314f82){const _0x46f77c=a86_0x33953a,_0x2329f8=await database_1[_0x46f77c(0x94)][_0x46f77c(0xf1)][_0x46f77c(0x135)]({'where':{'id':_0x144b27,'shopId':_0x4274cf}});if(!_0x2329f8)throw new Error(_0x46f77c(0x128));const _0x44cb21=await database_1[_0x46f77c(0x94)][_0x46f77c(0xf1)]['update']({'where':{'id':_0x144b27},'data':{..._0x314f82,'updatedAt':new Date()}});return _0x44cb21;}async['deletePayment'](_0x30690b,_0x55c110){const _0x17f4cf=a86_0x33953a,_0x57315e=await database_1['default'][_0x17f4cf(0xf1)][_0x17f4cf(0x135)]({'where':{'id':_0x55c110,'shopId':_0x30690b}});if(!_0x57315e)throw new Error('Payment\x20not\x20found');await database_1[_0x17f4cf(0x94)][_0x17f4cf(0xf1)][_0x17f4cf(0x13f)]({'where':{'id':_0x55c110}});}[a86_0x33953a(0x13b)](_0x10de5a){const _0x391f76=a86_0x33953a,_0x2e8d4c={'polygon':_0x391f76(0x174),'trc20':_0x391f76(0xd2),'erc20':'USDT\x20ERC20','bsc':_0x391f76(0x140),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x391f76(0x96)};return _0x2e8d4c[_0x10de5a]||_0x10de5a;}async[a86_0x33953a(0x123)](_0x146bc0,_0x499cc2){const _0x3cb7b3=a86_0x33953a,{page:_0xc062bd,limit:_0x1d4f5f,status:_0x51d3d8,method:_0x2efc11,network:_0x159e30,dateFrom:_0x533c02,dateTo:_0x322066,periodFrom:_0x5a4f3c,periodTo:_0x36741a}=_0x499cc2,_0x286b28=(_0xc062bd-0x1)*_0x1d4f5f;console[_0x3cb7b3(0x14e)](_0x3cb7b3(0xca),_0x499cc2);const _0x13ea29={'shopId':_0x146bc0};_0x51d3d8&&(_0x13ea29[_0x3cb7b3(0x114)]=_0x51d3d8[_0x3cb7b3(0xb2)](),console['log']('ðŸ“Š\x20Status\x20filter:\x20'+_0x51d3d8[_0x3cb7b3(0xb2)]()));if(_0x2efc11)_0x13ea29[_0x3cb7b3(0x100)]=_0x2efc11,console[_0x3cb7b3(0x14e)](_0x3cb7b3(0xf9)+_0x2efc11);else _0x159e30&&(_0x13ea29[_0x3cb7b3(0x100)]=_0x159e30,console[_0x3cb7b3(0x14e)](_0x3cb7b3(0xb3)+_0x159e30));if(_0x533c02||_0x322066||_0x5a4f3c||_0x36741a){_0x13ea29[_0x3cb7b3(0xbb)]={};if(_0x5a4f3c){const _0x230816=new Date(_0x5a4f3c);_0x230816['setHours'](0x0,0x0,0x0,0x1),_0x13ea29[_0x3cb7b3(0xbb)][_0x3cb7b3(0xd9)]=_0x230816,console['log']('ðŸ“…\x20Period\x20start:\x20'+_0x230816[_0x3cb7b3(0xe9)]());}else{if(_0x533c02){const _0x15f23d=new Date(_0x533c02);_0x15f23d['setHours'](0x0,0x0,0x0,0x1),_0x13ea29[_0x3cb7b3(0xbb)]['gte']=_0x15f23d,console[_0x3cb7b3(0x14e)](_0x3cb7b3(0x93)+_0x15f23d[_0x3cb7b3(0xe9)]());}}if(_0x36741a){const _0x64291d=new Date(_0x36741a);_0x64291d[_0x3cb7b3(0x132)](0x17,0x3b,0x3b,0x3e7),_0x13ea29['createdAt'][_0x3cb7b3(0xa5)]=_0x64291d,console[_0x3cb7b3(0x14e)](_0x3cb7b3(0x14f)+_0x64291d[_0x3cb7b3(0xe9)]());}else{if(_0x322066){const _0x444478=new Date(_0x322066);_0x444478[_0x3cb7b3(0x132)](0x17,0x3b,0x3b,0x3e7),_0x13ea29[_0x3cb7b3(0xbb)][_0x3cb7b3(0xa5)]=_0x444478,console[_0x3cb7b3(0x14e)](_0x3cb7b3(0xe6)+_0x444478[_0x3cb7b3(0xe9)]());}}}console[_0x3cb7b3(0x14e)](_0x3cb7b3(0xfb),JSON[_0x3cb7b3(0xbe)](_0x13ea29,null,0x2));const [_0x4faab4,_0x29cdc1]=await Promise[_0x3cb7b3(0x13a)]([database_1[_0x3cb7b3(0x94)][_0x3cb7b3(0x143)]['findMany']({'where':_0x13ea29,'skip':_0x286b28,'take':_0x1d4f5f,'orderBy':{'createdAt':_0x3cb7b3(0x141)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x3cb7b3(0x94)][_0x3cb7b3(0x143)][_0x3cb7b3(0x14c)]({'where':_0x13ea29})]);return{'payouts':_0x4faab4[_0x3cb7b3(0xc9)](_0x53ddae=>{const _0xb61810=_0x3cb7b3;let _0x2d5f95=null;switch(_0x53ddae['network']){case'polygon':_0x2d5f95=_0x53ddae['shop']['usdtPolygonWallet'];break;case _0xb61810(0x16f):_0x2d5f95=_0x53ddae[_0xb61810(0x142)][_0xb61810(0x110)];break;case'erc20':_0x2d5f95=_0x53ddae[_0xb61810(0x142)][_0xb61810(0x178)];break;case'polygon_usdc':_0x2d5f95=_0x53ddae[_0xb61810(0x142)][_0xb61810(0x129)];break;case _0xb61810(0x11b):_0x2d5f95=_0x53ddae['shop'][_0xb61810(0x97)];break;}return{'id':_0x53ddae['id'],'amount':_0x53ddae[_0xb61810(0xd4)],'network':this['formatNetworkName'](_0x53ddae['network']),'wallet':_0x2d5f95,'status':_0x53ddae[_0xb61810(0x114)],'txid':_0x53ddae['txid'],'notes':_0x53ddae[_0xb61810(0xce)],'periodFrom':_0x53ddae['periodFrom'],'periodTo':_0x53ddae[_0xb61810(0x15f)],'createdAt':_0x53ddae[_0xb61810(0xbb)],'paidAt':_0x53ddae['paidAt']};}),'pagination':{'page':_0xc062bd,'limit':_0x1d4f5f,'total':_0x29cdc1,'totalPages':Math[_0x3cb7b3(0xec)](_0x29cdc1/_0x1d4f5f)}};}async[a86_0x33953a(0xf8)](_0x23397c,_0x5a9149){const _0xe03778=a86_0x33953a,_0x4436be=await database_1[_0xe03778(0x94)][_0xe03778(0x143)][_0xe03778(0x135)]({'where':{'id':_0x5a9149,'shopId':_0x23397c}});if(!_0x4436be)return null;return{'id':_0x4436be['id'],'amount':_0x4436be[_0xe03778(0xd4)],'network':_0x4436be[_0xe03778(0x100)],'status':_0x4436be[_0xe03778(0x114)],'txid':_0x4436be[_0xe03778(0xe0)],'notes':_0x4436be[_0xe03778(0xce)],'createdAt':_0x4436be['createdAt'],'paidAt':_0x4436be['paidAt']};}async[a86_0x33953a(0xed)](_0x719977,_0x3161bf){const _0x3211d3=a86_0x33953a,_0x18e239=new Date();let _0x40a371,_0x1c011d;switch(_0x3161bf){case _0x3211d3(0x117):case _0x3211d3(0xe3):const _0x2ab54f=new Date(_0x18e239);_0x2ab54f[_0x3211d3(0x172)](_0x2ab54f[_0x3211d3(0xe5)]()-0x1),_0x40a371=new Date(_0x2ab54f),_0x40a371[_0x3211d3(0x132)](0x0,0x0,0x0,0x0),_0x1c011d=new Date(_0x2ab54f),_0x1c011d[_0x3211d3(0x132)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x40a371=new Date(_0x18e239['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3211d3(0x158):_0x40a371=new Date(_0x18e239[_0x3211d3(0xff)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3211d3(0x10f):_0x40a371=new Date(_0x18e239[_0x3211d3(0xff)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x40a371=new Date(_0x18e239['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x137755={'gte':_0x40a371};_0x1c011d&&(_0x137755[_0x3211d3(0xa5)]=_0x1c011d);const [_0x2c5651,_0x35044e,_0x16e080,_0x31627f,_0x141095,_0xde4101]=await Promise[_0x3211d3(0x13a)]([database_1[_0x3211d3(0x94)][_0x3211d3(0x143)][_0x3211d3(0x14c)]({'where':{'shopId':_0x719977,'createdAt':_0x137755}}),database_1[_0x3211d3(0x94)][_0x3211d3(0x143)][_0x3211d3(0x14c)]({'where':{'shopId':_0x719977,'status':_0x3211d3(0x104),'createdAt':_0x137755}}),database_1[_0x3211d3(0x94)][_0x3211d3(0x143)][_0x3211d3(0x14c)]({'where':{'shopId':_0x719977,'status':'PENDING','createdAt':_0x137755}}),database_1[_0x3211d3(0x94)][_0x3211d3(0x143)][_0x3211d3(0x14c)]({'where':{'shopId':_0x719977,'status':'REJECTED','createdAt':_0x137755}}),database_1[_0x3211d3(0x94)]['payout'][_0x3211d3(0x168)]({'where':{'shopId':_0x719977,'createdAt':_0x137755},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x3211d3(0x94)][_0x3211d3(0x143)][_0x3211d3(0x168)]({'where':{'shopId':_0x719977},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x55e57d=_0x141095[_0x3211d3(0x151)]((_0x4b067a,_0x5efd3d)=>_0x4b067a+_0x5efd3d[_0x3211d3(0xd4)],0x0),_0x3d77e3=_0x141095['filter'](_0x53b5ba=>_0x53b5ba['status']===_0x3211d3(0x104))[_0x3211d3(0x151)]((_0x1a5452,_0x4b992b)=>_0x1a5452+_0x4b992b['amount'],0x0),_0x316a83=_0x141095[_0x3211d3(0x9c)](_0x5284d5=>_0x5284d5[_0x3211d3(0x114)]==='PENDING')[_0x3211d3(0x151)]((_0x1624ce,_0x2ed400)=>_0x1624ce+_0x2ed400[_0x3211d3(0xd4)],0x0),_0x2bd95a=_0x141095[_0x3211d3(0x151)]((_0x498738,_0x59a850)=>{const _0x48428c=_0x3211d3;return _0x498738[_0x59a850[_0x48428c(0x100)]]=(_0x498738[_0x59a850[_0x48428c(0x100)]]||0x0)+0x1,_0x498738;},{}),_0x1c5bff=_0x141095['reduce']((_0x38fbe9,_0x59a7f9)=>{return _0x38fbe9[_0x59a7f9['status']]=(_0x38fbe9[_0x59a7f9['status']]||0x0)+0x1,_0x38fbe9;},{});return{'totalPayouts':_0x2c5651,'completedPayouts':_0x35044e,'pendingPayouts':_0x16e080,'rejectedPayouts':_0x31627f,'totalAmount':_0x55e57d,'completedAmount':_0x3d77e3,'pendingAmount':_0x316a83,'payoutsByMethod':_0x2bd95a,'payoutsByStatus':_0x1c5bff,'recentPayouts':_0xde4101['map'](_0x2c3c4e=>({'id':_0x2c3c4e['id'],'shopId':_0x719977,'amount':_0x2c3c4e[_0x3211d3(0xd4)],'method':_0x2c3c4e[_0x3211d3(0x100)],'status':_0x2c3c4e[_0x3211d3(0x114)],'txid':_0x2c3c4e[_0x3211d3(0xe0)],'createdAt':_0x2c3c4e[_0x3211d3(0xbb)],'paidAt':_0x2c3c4e[_0x3211d3(0x139)]}))};}async[a86_0x33953a(0x8f)](_0x4493c7){const _0x536bf1=a86_0x33953a;console[_0x536bf1(0x14e)](_0x536bf1(0x10d)+_0x4493c7+_0x536bf1(0xb4));const _0x2cc1f3=await database_1[_0x536bf1(0x94)][_0x536bf1(0x142)][_0x536bf1(0x101)]({'where':{'id':_0x4493c7},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2cc1f3)throw new Error('Shop\x20not\x20found');const _0x3b6219=new Date(),_0x16aad5=new Date(_0x3b6219[_0x536bf1(0x91)](),_0x3b6219[_0x536bf1(0x12e)](),0x1),_0x10f86a=new Date(_0x3b6219['getFullYear'](),_0x3b6219['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3f15cc=await database_1[_0x536bf1(0x94)]['payout'][_0x536bf1(0x118)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4493c7,'createdAt':{'gte':_0x16aad5,'lte':_0x10f86a},'status':_0x536bf1(0x104)}}),_0x1705cc=_0x3f15cc[_0x536bf1(0xc6)][_0x536bf1(0xd4)]||0x0,_0x493ffc={'availableBalance':Math[_0x536bf1(0xda)](_0x2cc1f3[_0x536bf1(0x12f)]*0x64)/0x64,'totalPaidOut':Math[_0x536bf1(0xda)](_0x2cc1f3[_0x536bf1(0x107)]*0x64)/0x64,'awaitingPayout':Math[_0x536bf1(0xda)](_0x2cc1f3[_0x536bf1(0x12f)]*0x64)/0x64,'thisMonth':Math[_0x536bf1(0xda)](_0x1705cc*0x64)/0x64};return console[_0x536bf1(0x14e)](_0x536bf1(0xb0)+_0x2cc1f3[_0x536bf1(0x15e)]+_0x536bf1(0xe8)),console[_0x536bf1(0x14e)](_0x536bf1(0xd6)+_0x493ffc[_0x536bf1(0x121)]+_0x536bf1(0xe2)),console[_0x536bf1(0x14e)](_0x536bf1(0xcf)+_0x493ffc[_0x536bf1(0x107)]+'\x20USDT\x20(total\x20payouts)'),console[_0x536bf1(0x14e)](_0x536bf1(0xbf)+_0x493ffc[_0x536bf1(0x15b)]+_0x536bf1(0xe2)),console['log'](_0x536bf1(0xde)+_0x493ffc[_0x536bf1(0x160)]+'\x20USDT'),_0x493ffc;}['getGatewayDisplayName'](_0x3a877a){const _0x513f7b=a86_0x33953a,_0x351fed={'test_gateway':_0x513f7b(0x155),'plisio':_0x513f7b(0xa4),'rapyd':_0x513f7b(0xe4),'noda':_0x513f7b(0x175),'cointopay':_0x513f7b(0x125),'klyme_eu':_0x513f7b(0xeb),'klyme_gb':_0x513f7b(0xa2),'klyme_de':'KLYME\x20DE'};return _0x351fed[_0x3a877a]||_0x3a877a;}async[a86_0x33953a(0x15d)](_0x2a1507){const _0x7f362e=a86_0x33953a;return this[_0x7f362e(0x8f)](_0x2a1507);}async[a86_0x33953a(0x157)](_0x46cf7c,_0x476ac4){const _0x1399df=a86_0x33953a,{page:_0x5c24ea,limit:_0x1913bc,paymentId:_0x2ddabb}=_0x476ac4,_0x6e1fbf=(_0x5c24ea-0x1)*_0x1913bc,_0x375e84={'shopId':_0x46cf7c};_0x2ddabb&&(_0x375e84['paymentId']=_0x2ddabb);const [_0x667468,_0x4f2d25]=await Promise[_0x1399df(0x13a)]([database_1[_0x1399df(0x94)][_0x1399df(0xc2)]['findMany']({'where':_0x375e84,'skip':_0x6e1fbf,'take':_0x1913bc,'orderBy':{'createdAt':_0x1399df(0x141)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x1399df(0x94)][_0x1399df(0xc2)][_0x1399df(0x14c)]({'where':_0x375e84})]);return{'logs':_0x667468['map'](_0x5b88cf=>({'id':_0x5b88cf['id'],'paymentId':_0x5b88cf['paymentId'],'shopId':_0x5b88cf[_0x1399df(0x171)],'event':_0x5b88cf[_0x1399df(0xc4)],'statusCode':_0x5b88cf[_0x1399df(0x90)],'retryCount':_0x5b88cf[_0x1399df(0x148)],'responseBody':_0x5b88cf[_0x1399df(0xa1)],'createdAt':_0x5b88cf[_0x1399df(0xbb)],'payment':_0x5b88cf[_0x1399df(0xf1)]})),'pagination':{'page':_0x5c24ea,'limit':_0x1913bc,'total':_0x4f2d25,'totalPages':Math[_0x1399df(0xec)](_0x4f2d25/_0x1913bc)}};}async['getStatistics'](_0x42f4d8,_0x5d55b8,_0x30d2ea,_0x2b3d0e,_0x4740be){const _0x7794e9=a86_0x33953a;console[_0x7794e9(0x14e)](_0x7794e9(0xc3)+_0x42f4d8+',\x20period:\x20'+_0x5d55b8+_0x7794e9(0x111)+_0x30d2ea+',\x20dateTo:\x20'+_0x2b3d0e);const _0x13c470=_0x4740be?new Date(_0x4740be):new Date();let _0x208aec,_0x44ba53;if(_0x30d2ea&&_0x2b3d0e){const _0x1c8cad=new Date(_0x30d2ea),_0x4a2329=new Date(_0x2b3d0e);_0x208aec=new Date(Date['UTC'](_0x1c8cad[_0x7794e9(0x147)](),_0x1c8cad[_0x7794e9(0x145)](),_0x1c8cad[_0x7794e9(0x152)](),0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x4a2329[_0x7794e9(0x147)](),_0x4a2329['getUTCMonth'](),_0x4a2329['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x7794e9(0x14e)](_0x7794e9(0xd8)+_0x208aec[_0x7794e9(0xe9)]()+'\x20to\x20'+_0x44ba53['toISOString']());}else{if(_0x5d55b8&&_0x5d55b8['startsWith'](_0x7794e9(0x11f))){const _0x1c9034=_0x5d55b8[_0x7794e9(0xef)]('custom_','')['split']('_');if(_0x1c9034[_0x7794e9(0xf3)]===0x2){const _0x30f516=new Date(_0x1c9034[0x0]),_0x3dfd07=new Date(_0x1c9034[0x1]);_0x208aec=new Date(Date[_0x7794e9(0x150)](_0x30f516[_0x7794e9(0x147)](),_0x30f516[_0x7794e9(0x145)](),_0x30f516[_0x7794e9(0x152)](),0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x3dfd07[_0x7794e9(0x147)](),_0x3dfd07[_0x7794e9(0x145)](),_0x3dfd07[_0x7794e9(0x152)](),0x17,0x3b,0x3b,0x3e7)),console[_0x7794e9(0x14e)](_0x7794e9(0xaf)+_0x208aec['toISOString']()+_0x7794e9(0xbc)+_0x44ba53['toISOString']());}else{const _0x2efa66=new Date(Date[_0x7794e9(0x150)](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),_0x13c470[_0x7794e9(0x152)]()-0x1e));_0x208aec=new Date(Date[_0x7794e9(0x150)](_0x2efa66[_0x7794e9(0x147)](),_0x2efa66[_0x7794e9(0x145)](),_0x2efa66[_0x7794e9(0x152)](),0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date['UTC'](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),_0x13c470[_0x7794e9(0x152)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0xaf51b7=_0x5d55b8||_0x7794e9(0x13d);switch(_0xaf51b7[_0x7794e9(0xb7)]()){case _0x7794e9(0xa9):_0x208aec=new Date(Date['UTC'](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),_0x13c470[_0x7794e9(0x152)](),0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),_0x13c470[_0x7794e9(0x152)](),0x17,0x3b,0x3b,0x3e7));break;case _0x7794e9(0x117):const _0x1994f3=new Date(_0x13c470);_0x1994f3[_0x7794e9(0x16a)](_0x1994f3[_0x7794e9(0x152)]()-0x1),_0x208aec=new Date(Date[_0x7794e9(0x150)](_0x1994f3['getUTCFullYear'](),_0x1994f3[_0x7794e9(0x145)](),_0x1994f3['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x1994f3[_0x7794e9(0x147)](),_0x1994f3['getUTCMonth'](),_0x1994f3['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x7794e9(0x14b):const _0x4bcbb3=_0x13c470[_0x7794e9(0xd3)](),_0x52babd=_0x4bcbb3===0x0?-0x6:0x1-_0x4bcbb3,_0x295470=_0x13c470[_0x7794e9(0x152)]()+_0x52babd;_0x208aec=new Date(Date[_0x7794e9(0x150)](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),_0x295470,0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date['UTC'](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),_0x13c470[_0x7794e9(0x152)](),0x17,0x3b,0x3b,0x3e7));break;case _0x7794e9(0x131):const _0x45e58a=new Date(Date['UTC'](_0x13c470['getUTCFullYear'](),_0x13c470['getUTCMonth'](),_0x13c470[_0x7794e9(0x152)]()-0x7)),_0x40c263=_0x45e58a['getUTCDay'](),_0x468e23=_0x40c263===0x0?-0x6:0x1-_0x40c263,_0x5b578b=_0x45e58a[_0x7794e9(0x152)]()+_0x468e23;_0x208aec=new Date(Date['UTC'](_0x45e58a[_0x7794e9(0x147)](),_0x45e58a[_0x7794e9(0x145)](),_0x5b578b,0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x45e58a['getUTCFullYear'](),_0x45e58a[_0x7794e9(0x145)](),_0x5b578b+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x7794e9(0x13d):_0x208aec=new Date(Date[_0x7794e9(0x150)](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),0x1,0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x13c470['getUTCFullYear'](),_0x13c470[_0x7794e9(0x145)](),_0x13c470[_0x7794e9(0x152)](),0x17,0x3b,0x3b,0x3e7));break;case _0x7794e9(0x10b):_0x208aec=new Date(Date['UTC'](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x7794e9(0xae):_0x208aec=new Date(Date[_0x7794e9(0x150)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date[_0x7794e9(0x150)](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),_0x13c470[_0x7794e9(0x152)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x208aec=new Date(Date[_0x7794e9(0x150)](_0x13c470[_0x7794e9(0x147)](),_0x13c470[_0x7794e9(0x145)](),0x1,0x0,0x0,0x0,0x0)),_0x44ba53=new Date(Date['UTC'](_0x13c470[_0x7794e9(0x147)](),_0x13c470['getUTCMonth'](),_0x13c470[_0x7794e9(0x152)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x7794e9(0x14e)](_0x7794e9(0xee)+_0x208aec['toISOString']()+_0x7794e9(0xbc)+_0x44ba53[_0x7794e9(0xe9)]());const _0xcce2e0={'gte':_0x208aec,'lte':_0x44ba53},[_0x32ab91,_0x433b60,_0x36016d,_0x12f187,_0x50fc6f,_0x5b2b4b,_0x53fa2e,_0x127af9,_0x443a47,_0x11fda8,_0x3073ba]=await Promise[_0x7794e9(0x13a)]([database_1['default'][_0x7794e9(0xf1)][_0x7794e9(0x14c)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':_0x7794e9(0x10c)},'status':{'notIn':[_0x7794e9(0x126),_0x7794e9(0x11d)]},'createdAt':_0xcce2e0}}),database_1[_0x7794e9(0x94)]['payment'][_0x7794e9(0x14c)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':'test_gateway'},'status':_0x7794e9(0x162),'createdAt':_0xcce2e0}}),database_1[_0x7794e9(0x94)]['payment'][_0x7794e9(0x14c)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':_0x7794e9(0x10c)},'status':_0x7794e9(0x109)}}),database_1[_0x7794e9(0x94)][_0x7794e9(0xf1)][_0x7794e9(0x14c)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':_0x7794e9(0x10c)},'status':_0x7794e9(0x154)}}),database_1[_0x7794e9(0x94)][_0x7794e9(0xf1)]['findMany']({'where':{'shopId':_0x42f4d8,'gateway':{'not':'test_gateway'},'status':_0x7794e9(0x162),'createdAt':_0xcce2e0},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x7794e9(0x94)][_0x7794e9(0xf1)][_0x7794e9(0x168)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':'test_gateway'}},'take':0x4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x7794e9(0xf1)]['findMany']({'where':{'shopId':_0x42f4d8,'gateway':{'not':_0x7794e9(0x10c)},'createdAt':_0xcce2e0},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x7794e9(0x120)}}),database_1[_0x7794e9(0x94)][_0x7794e9(0xf1)][_0x7794e9(0x14c)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':_0x7794e9(0x10c)},'status':'PAID'}}),database_1[_0x7794e9(0x94)]['payment'][_0x7794e9(0x168)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':_0x7794e9(0x10c)},'status':_0x7794e9(0x162)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x7794e9(0x94)]['shop']['findUnique']({'where':{'id':_0x42f4d8},'select':{'balance':!![]}}),database_1[_0x7794e9(0x94)][_0x7794e9(0xf1)][_0x7794e9(0x168)]({'where':{'shopId':_0x42f4d8,'gateway':{'not':'test_gateway'}},'select':{'gateway':!![]}})]),_0xbe1e41={};for(const _0x3a143e of _0x3073ba){_0x3a143e[_0x7794e9(0xc0)]&&(_0xbe1e41[_0x3a143e[_0x7794e9(0xc0)]]=(_0xbe1e41[_0x3a143e[_0x7794e9(0xc0)]]||0x0)+0x1);}console[_0x7794e9(0x14e)](_0x7794e9(0x137),_0xbe1e41);let _0x1ddf58=0x0,_0x17bae2=0x0;for(const _0x3dfe55 of _0x50fc6f){if(_0x3dfe55['amountUSDT'])_0x1ddf58+=_0x3dfe55[_0x7794e9(0x11a)];else{const _0x132aa9=await currencyService_1['currencyService'][_0x7794e9(0x116)](_0x3dfe55[_0x7794e9(0xd4)],_0x3dfe55['currency']);_0x1ddf58+=_0x132aa9;}_0x3dfe55[_0x7794e9(0xba)]&&(_0x17bae2+=_0x3dfe55[_0x7794e9(0xba)]);}let _0x24af45=0x0;for(const _0x5b0b2e of _0x443a47){_0x5b0b2e[_0x7794e9(0xba)]&&(_0x24af45+=_0x5b0b2e[_0x7794e9(0xba)]);}const _0x579018=this[_0x7794e9(0x169)](_0x53fa2e,_0x208aec,_0x44ba53||_0x13c470),_0x287760=_0x32ab91>0x0?_0x433b60/_0x32ab91*0x64:0x0,_0x26e6a9=_0x127af9>0x0?_0x36016d/_0x127af9*0x64:0x0;return{'totalPayments':_0x32ab91,'successfulPayments':_0x433b60,'totalRevenue':Math[_0x7794e9(0xda)](_0x1ddf58*0x64)/0x64,'merchantEarnings':Math['round'](_0x17bae2*0x64)/0x64,'merchantTotalRevenue':Math[_0x7794e9(0xda)](_0x24af45*0x64)/0x64,'payoutBalance':Math[_0x7794e9(0xda)]((_0x11fda8?.[_0x7794e9(0x12f)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x287760*0x64)/0x64,'chargebackRate':Math[_0x7794e9(0xda)](_0x26e6a9*0x64)/0x64,'chargebacks':_0x36016d,'refunds':_0x12f187,'paymentsByGateway':_0xbe1e41,'dailyRevenue':_0x579018[_0x7794e9(0x130)],'dailyPayments':_0x579018[_0x7794e9(0x127)],'recentPayments':_0x5b2b4b['map'](_0x391528=>({'id':_0x391528['id'],'gateway':_0x391528['gateway'],'amount':_0x391528[_0x7794e9(0xd4)],'currency':_0x391528[_0x7794e9(0xd1)],'status':_0x391528['status'],'createdAt':_0x391528[_0x7794e9(0xbb)]}))};}[a86_0x33953a(0x169)](_0x544a20,_0x2a6f5b,_0x4c8738){const _0x10b3fc=a86_0x33953a,_0x21fc00=new Map(),_0x37f6e0=new Date(_0x2a6f5b);while(_0x37f6e0<=_0x4c8738){const _0x51f46=_0x37f6e0['toISOString']()[_0x10b3fc(0x164)]('T')[0x0];_0x21fc00[_0x10b3fc(0xb9)](_0x51f46,{'revenue':0x0,'count':0x0}),_0x37f6e0[_0x10b3fc(0x172)](_0x37f6e0['getDate']()+0x1);}for(const _0x14feb4 of _0x544a20){const _0x1ba1e3=_0x14feb4[_0x10b3fc(0xbb)]['toISOString']()[_0x10b3fc(0x164)]('T')[0x0],_0x5abb42=_0x21fc00['get'](_0x1ba1e3);_0x5abb42&&(_0x5abb42[_0x10b3fc(0x14c)]+=0x1,_0x14feb4[_0x10b3fc(0x114)]===_0x10b3fc(0x162)&&_0x14feb4[_0x10b3fc(0x11a)]&&(_0x5abb42[_0x10b3fc(0x14a)]+=_0x14feb4[_0x10b3fc(0x11a)]));}const _0x6ec6bb=[],_0x3da7b7=[];for(const [_0x29a327,_0x57327a]of _0x21fc00){_0x6ec6bb['push']({'date':_0x29a327,'amount':Math[_0x10b3fc(0xda)](_0x57327a[_0x10b3fc(0x14a)]*0x64)/0x64}),_0x3da7b7['push']({'date':_0x29a327,'count':_0x57327a[_0x10b3fc(0x14c)]});}return{'dailyRevenue':_0x6ec6bb,'dailyPayments':_0x3da7b7};}['generateBackupCodes'](_0xd04460=0x8){const _0x404b7b=a86_0x33953a,_0x4582f3=[];for(let _0x3d339d=0x0;_0x3d339d<_0xd04460;_0x3d339d++){const _0x9863c4=crypto_1['default']['randomBytes'](0x4)[_0x404b7b(0x153)](_0x404b7b(0x98))[_0x404b7b(0xb2)]();_0x4582f3[_0x404b7b(0xf0)](_0x9863c4);}return _0x4582f3;}async['setup2FA'](_0x2327c7){const _0x150339=a86_0x33953a,_0x3670ab=await database_1[_0x150339(0x94)][_0x150339(0x142)][_0x150339(0x101)]({'where':{'id':_0x2327c7},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x3670ab)throw new Error('Shop\x20not\x20found');const _0x381501=speakeasy_1['default'][_0x150339(0xdd)]({'name':_0x150339(0xa6)+_0x3670ab[_0x150339(0x15e)]+')','issuer':_0x150339(0x124),'length':0x20}),_0x3d94dc=await qrcode_1[_0x150339(0x94)][_0x150339(0xe1)](_0x381501[_0x150339(0x9a)]),_0x3e5dd4=this[_0x150339(0xa0)](0x8),_0xa81b3b=await Promise[_0x150339(0x13a)](_0x3e5dd4[_0x150339(0xc9)](_0x11b4ed=>bcryptjs_1[_0x150339(0x94)][_0x150339(0x12d)](_0x11b4ed,0xa)));return await database_1['default'][_0x150339(0x142)]['update']({'where':{'id':_0x2327c7},'data':{'twoFactorSecret':_0x381501[_0x150339(0xc7)],'backupCodes':JSON[_0x150339(0xbe)](_0xa81b3b)}}),console['log'](_0x150339(0x16c)+_0x3670ab[_0x150339(0x15e)]),console[_0x150339(0x14e)](_0x150339(0xf2)+_0x3e5dd4[_0x150339(0xf3)]+'\x20backup\x20codes'),{'secret':_0x381501[_0x150339(0xc7)],'qrCode':_0x3d94dc,'manualEntryKey':_0x381501[_0x150339(0xc7)],'backupCodes':_0x3e5dd4};}async[a86_0x33953a(0xb5)](_0x433d11,_0x5cd842){const _0x370611=a86_0x33953a,_0x23fc36=await database_1[_0x370611(0x94)][_0x370611(0x142)][_0x370611(0x101)]({'where':{'id':_0x433d11},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x23fc36)throw new Error(_0x370611(0x156));if(!_0x23fc36[_0x370611(0xac)])throw new Error(_0x370611(0x15a));if(_0x23fc36[_0x370611(0x16e)])throw new Error(_0x370611(0xc8));const _0x4e4e36=speakeasy_1[_0x370611(0x94)][_0x370611(0xf5)]['verify']({'secret':_0x23fc36['twoFactorSecret'],'encoding':'base32','token':_0x5cd842,'window':0x2});if(!_0x4e4e36)throw new Error(_0x370611(0x165));return await database_1[_0x370611(0x94)][_0x370611(0x142)][_0x370611(0x9d)]({'where':{'id':_0x433d11},'data':{'twoFactorEnabled':!![]}}),console[_0x370611(0x14e)](_0x370611(0x144)+_0x23fc36['username']),{'enabled':!![]};}async[a86_0x33953a(0xb6)](_0x4a837c){const _0x41852b=a86_0x33953a,_0x57953f=await database_1[_0x41852b(0x94)][_0x41852b(0x142)][_0x41852b(0x101)]({'where':{'id':_0x4a837c},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x57953f)throw new Error(_0x41852b(0x156));await database_1[_0x41852b(0x94)][_0x41852b(0x142)][_0x41852b(0x9d)]({'where':{'id':_0x4a837c},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x41852b(0x14e)](_0x41852b(0xc1)+_0x57953f[_0x41852b(0x15e)]);}}exports[a86_0x33953a(0x103)]=ShopService;