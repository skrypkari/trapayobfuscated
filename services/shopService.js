'use strict';const a52_0x53f68d=a52_0x5ca8;(function(_0x5accc3,_0x2fe25d){const _0x3402da=a52_0x5ca8,_0x2bd2d9=_0x5accc3();while(!![]){try{const _0x87ef4b=parseInt(_0x3402da(0x15b))/0x1*(-parseInt(_0x3402da(0x1a2))/0x2)+parseInt(_0x3402da(0x16c))/0x3*(parseInt(_0x3402da(0x194))/0x4)+-parseInt(_0x3402da(0x167))/0x5+parseInt(_0x3402da(0x14a))/0x6*(parseInt(_0x3402da(0x149))/0x7)+-parseInt(_0x3402da(0x175))/0x8*(parseInt(_0x3402da(0x170))/0x9)+parseInt(_0x3402da(0x19b))/0xa+parseInt(_0x3402da(0x1b1))/0xb*(parseInt(_0x3402da(0x1a9))/0xc);if(_0x87ef4b===_0x2fe25d)break;else _0x2bd2d9['push'](_0x2bd2d9['shift']());}catch(_0x1102b4){_0x2bd2d9['push'](_0x2bd2d9['shift']());}}}(a52_0x4a5b,0xbd243));var __importDefault=this&&this['__importDefault']||function(_0x2bf4c6){const _0x260f18=a52_0x5ca8;return _0x2bf4c6&&_0x2bf4c6[_0x260f18(0x1a6)]?_0x2bf4c6:{'default':_0x2bf4c6};};Object[a52_0x53f68d(0x1b2)](exports,a52_0x53f68d(0x1a6),{'value':!![]}),exports[a52_0x53f68d(0x146)]=void 0x0;const database_1=__importDefault(require(a52_0x53f68d(0x1b3))),currencyService_1=require(a52_0x53f68d(0x140)),paymentService_1=require(a52_0x53f68d(0x197));function a52_0x4a5b(){const _0x3cfd75=['convertToUSDT','asc','usdcPolygonWallet','notes','getDate','findUnique','telegramId','\x20USDT','getPaymentsByShop','awaitingPayout','fullName','PAID','usdtErcWallet','currency','createPublicPayment','test_order_123','./currencyService','amount','name','getTime','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','getPayouts','ShopService','reduce','paymentService','1673QjKrwp','12270fvvxfP','getPayoutStats','Rapyd','delete','split','lte','usdtPolygonWallet','application/json','webhookEvents','event','gatewaySettings','round','gateways','getFullYear','customerEmail','paid','amountIsEditable','7qeZJzf','amountUSDT','set','REJECTED','webhookUrl','aggregate','redirectUrl','test','update','üìä\x20Shop\x20','wallets','network','7257485KeChtS','get','createPayment','publicKey','...','1183137qiXKUx','log','telegram','getShopPayoutStats','81YOLKqU','toISOString','KLYME\x20EU','merchantUrl','test_gateway','482328XMRczy','updatePayment','deletePayment','getPaymentByShopAndId','findMany','getMonth','Shop\x20not\x20found','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','paymentGateways','filter','language','Payment\x20not\x20found','error','shopUrl','toUpperCase','retryCount','createdAt','getPaymentById','dailyRevenue','KLYME\x20DE','Failed\x20to\x20send\x20webhook:\x20','Test\x20Gateway','PENDING','shop','settings','PaymentService','\x20USDT\x20(current\x20balance)','totalPaidOut','customer','Noda','paymentId','12RbMznL','Error\x20parsing\x20webhook\x20events:','\x20\x20\x20üíµ\x20Available\x20balance:\x20','./paymentService','30d','getWebhookLogs','USD','8598440iiDIEh','paidAt','txid','statusCode','usdtTrcWallet','getPayments','currencyService','437878ZKDogd','payment','gte','status','__esModule','map','webhookLog','21236112YCsYfu','Test\x20webhook\x20sent\x20successfully\x20(','parse','push','No\x20webhook\x20URL\x20configured','shopId','COMPLETED','all','11Hlwpjd','defineProperty','../config/database','POST','90d','desc','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','stringify','testWebhook','Webhook\x20returned\x20error:\x20','responseBody','maxPayments','country','Plisio','dailyPayments','generateDailyStatistics','setDate','balance','availableBalance','default','gateway','updateWallets','customerName','payout','CoinToPay','username','findFirst','count','Unknown\x20error','updateShopProfile'];a52_0x4a5b=function(){return _0x3cfd75;};return a52_0x4a5b();}function a52_0x5ca8(_0x2abd2d,_0x32d778){const _0x4a5b99=a52_0x4a5b();return a52_0x5ca8=function(_0x5ca822,_0x18f6cc){_0x5ca822=_0x5ca822-0x132;let _0x596a04=_0x4a5b99[_0x5ca822];return _0x596a04;},a52_0x5ca8(_0x2abd2d,_0x32d778);}class ShopService{constructor(){const _0x36fff8=a52_0x53f68d;this[_0x36fff8(0x148)]=new paymentService_1[(_0x36fff8(0x18e))]();}async['getShopProfile'](_0x5f0092){const _0x3a0fc7=a52_0x53f68d,_0x2a38cf=await database_1['default'][_0x3a0fc7(0x18c)][_0x3a0fc7(0x135)]({'where':{'id':_0x5f0092},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2a38cf)throw new Error('Shop\x20not\x20found');let _0x57bdfc=[];if(_0x2a38cf[_0x3a0fc7(0x18d)]?.[_0x3a0fc7(0x152)])try{_0x57bdfc=Array['isArray'](_0x2a38cf[_0x3a0fc7(0x18d)]['webhookEvents'])?_0x2a38cf[_0x3a0fc7(0x18d)][_0x3a0fc7(0x152)]:JSON[_0x3a0fc7(0x1ab)](_0x2a38cf[_0x3a0fc7(0x18d)][_0x3a0fc7(0x152)]);}catch(_0x4a0766){console[_0x3a0fc7(0x181)](_0x3a0fc7(0x195),_0x4a0766),_0x57bdfc=[];}return{'id':_0x2a38cf['id'],'fullName':_0x2a38cf[_0x3a0fc7(0x142)],'username':_0x2a38cf[_0x3a0fc7(0x1ca)],'telegramId':_0x2a38cf[_0x3a0fc7(0x16e)],'merchantUrl':_0x2a38cf[_0x3a0fc7(0x182)],'gateways':_0x2a38cf['paymentGateways']?JSON[_0x3a0fc7(0x1ab)](_0x2a38cf['paymentGateways']):null,'gatewaySettings':_0x2a38cf['gatewaySettings']?JSON['parse'](_0x2a38cf[_0x3a0fc7(0x154)]):null,'publicKey':_0x2a38cf[_0x3a0fc7(0x16a)],'webhookUrl':_0x2a38cf['settings']?.[_0x3a0fc7(0x15f)]||null,'webhookEvents':_0x57bdfc,'wallets':{'usdtPolygonWallet':_0x2a38cf[_0x3a0fc7(0x150)],'usdtTrcWallet':_0x2a38cf[_0x3a0fc7(0x19f)],'usdtErcWallet':_0x2a38cf['usdtErcWallet'],'usdcPolygonWallet':_0x2a38cf['usdcPolygonWallet']},'status':_0x2a38cf[_0x3a0fc7(0x1a5)],'createdAt':_0x2a38cf[_0x3a0fc7(0x185)]};}async[a52_0x53f68d(0x1ce)](_0x2aeb8a,_0x4245f6){const _0x441f75=a52_0x53f68d,_0x1d8ec1={};_0x4245f6[_0x441f75(0x13a)]&&(_0x1d8ec1[_0x441f75(0x142)]=_0x4245f6['fullName']);_0x4245f6[_0x441f75(0x136)]!==undefined&&(_0x1d8ec1[_0x441f75(0x16e)]=_0x4245f6['telegramId']||null);_0x4245f6[_0x441f75(0x173)]&&(_0x1d8ec1[_0x441f75(0x182)]=_0x4245f6[_0x441f75(0x173)]);_0x4245f6[_0x441f75(0x156)]&&(_0x1d8ec1[_0x441f75(0x17d)]=JSON['stringify'](_0x4245f6[_0x441f75(0x156)]));_0x4245f6[_0x441f75(0x154)]&&(_0x1d8ec1[_0x441f75(0x154)]=JSON[_0x441f75(0x1b8)](_0x4245f6['gatewaySettings']));_0x4245f6['wallets']&&(_0x4245f6[_0x441f75(0x165)][_0x441f75(0x150)]!==undefined&&(_0x1d8ec1[_0x441f75(0x150)]=_0x4245f6[_0x441f75(0x165)]['usdtPolygonWallet']||null),_0x4245f6[_0x441f75(0x165)][_0x441f75(0x19f)]!==undefined&&(_0x1d8ec1['usdtTrcWallet']=_0x4245f6[_0x441f75(0x165)][_0x441f75(0x19f)]||null),_0x4245f6[_0x441f75(0x165)][_0x441f75(0x13c)]!==undefined&&(_0x1d8ec1[_0x441f75(0x13c)]=_0x4245f6[_0x441f75(0x165)][_0x441f75(0x13c)]||null),_0x4245f6[_0x441f75(0x165)][_0x441f75(0x132)]!==undefined&&(_0x1d8ec1[_0x441f75(0x132)]=_0x4245f6[_0x441f75(0x165)][_0x441f75(0x132)]||null));const _0x15d19c=await database_1[_0x441f75(0x1c4)]['shop'][_0x441f75(0x163)]({'where':{'id':_0x2aeb8a},'data':_0x1d8ec1,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x33ff3f=[];if(_0x15d19c[_0x441f75(0x18d)]?.['webhookEvents'])try{_0x33ff3f=Array['isArray'](_0x15d19c[_0x441f75(0x18d)][_0x441f75(0x152)])?_0x15d19c['settings'][_0x441f75(0x152)]:JSON['parse'](_0x15d19c['settings'][_0x441f75(0x152)]);}catch(_0x4c66f9){console[_0x441f75(0x181)](_0x441f75(0x195),_0x4c66f9),_0x33ff3f=[];}return{'id':_0x15d19c['id'],'fullName':_0x15d19c[_0x441f75(0x142)],'username':_0x15d19c[_0x441f75(0x1ca)],'telegramId':_0x15d19c[_0x441f75(0x16e)],'merchantUrl':_0x15d19c['shopUrl'],'gateways':_0x15d19c[_0x441f75(0x17d)]?JSON['parse'](_0x15d19c[_0x441f75(0x17d)]):null,'gatewaySettings':_0x15d19c['gatewaySettings']?JSON[_0x441f75(0x1ab)](_0x15d19c['gatewaySettings']):null,'publicKey':_0x15d19c[_0x441f75(0x16a)],'webhookUrl':_0x15d19c['settings']?.[_0x441f75(0x15f)]||null,'webhookEvents':_0x33ff3f,'wallets':{'usdtPolygonWallet':_0x15d19c[_0x441f75(0x150)],'usdtTrcWallet':_0x15d19c[_0x441f75(0x19f)],'usdtErcWallet':_0x15d19c['usdtErcWallet'],'usdcPolygonWallet':_0x15d19c[_0x441f75(0x132)]},'status':_0x15d19c[_0x441f75(0x1a5)],'createdAt':_0x15d19c['createdAt']};}async[a52_0x53f68d(0x1c6)](_0x1aa796,_0x12c87f){const _0x5fa836=a52_0x53f68d,_0x5c7582={};_0x12c87f[_0x5fa836(0x150)]!==undefined&&(_0x5c7582[_0x5fa836(0x150)]=_0x12c87f[_0x5fa836(0x150)]||null),_0x12c87f[_0x5fa836(0x19f)]!==undefined&&(_0x5c7582[_0x5fa836(0x19f)]=_0x12c87f[_0x5fa836(0x19f)]||null),_0x12c87f['usdtErcWallet']!==undefined&&(_0x5c7582[_0x5fa836(0x13c)]=_0x12c87f[_0x5fa836(0x13c)]||null),_0x12c87f[_0x5fa836(0x132)]!==undefined&&(_0x5c7582[_0x5fa836(0x132)]=_0x12c87f[_0x5fa836(0x132)]||null),await database_1['default']['shop'][_0x5fa836(0x163)]({'where':{'id':_0x1aa796},'data':_0x5c7582});}async[a52_0x53f68d(0x1b9)](_0xaa02d6){const _0x59d10c=a52_0x53f68d,_0x2294c1=await database_1[_0x59d10c(0x1c4)][_0x59d10c(0x18c)]['findUnique']({'where':{'id':_0xaa02d6},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x2294c1?.[_0x59d10c(0x18d)]?.[_0x59d10c(0x15f)])throw new Error(_0x59d10c(0x1ad));const _0x25ae6f={'event':'test','payment':{'id':'test_payment_123','order_id':_0x59d10c(0x13f),'gateway':_0x59d10c(0x162),'amount':0x64,'currency':_0x59d10c(0x19a),'status':_0x59d10c(0x159),'created_at':new Date()[_0x59d10c(0x171)]()}};try{const _0x4fed7b=await fetch(_0x2294c1[_0x59d10c(0x18d)][_0x59d10c(0x15f)],{'method':_0x59d10c(0x1b4),'headers':{'Content-Type':_0x59d10c(0x151),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x59d10c(0x1b8)](_0x25ae6f)});return _0x4fed7b['ok']?{'success':!![],'message':_0x59d10c(0x1aa)+_0x4fed7b[_0x59d10c(0x1a5)]+')'}:{'success':![],'message':_0x59d10c(0x1ba)+_0x4fed7b['status']+'\x20'+_0x4fed7b['statusText']};}catch(_0xe70ba5){return{'success':![],'message':_0x59d10c(0x189)+(_0xe70ba5 instanceof Error?_0xe70ba5['message']:_0x59d10c(0x1cd))};}}async[a52_0x53f68d(0x169)](_0x40f8c5){const _0x15e7f7=a52_0x53f68d;return this[_0x15e7f7(0x148)][_0x15e7f7(0x13e)]({'public_key':'','gateway':_0x40f8c5[_0x15e7f7(0x1c5)],'order_id':undefined,'amount':_0x40f8c5[_0x15e7f7(0x141)],'currency':_0x40f8c5[_0x15e7f7(0x13d)],'source_currency':_0x40f8c5['sourceCurrency'],'usage':_0x40f8c5['usage'],'expires_at':_0x40f8c5['expiresAt']?.['toISOString'](),'success_url':_0x40f8c5[_0x15e7f7(0x161)],'fail_url':_0x40f8c5[_0x15e7f7(0x161)],'customer_email':_0x40f8c5[_0x15e7f7(0x158)],'customer_name':_0x40f8c5[_0x15e7f7(0x1c7)],'country':_0x40f8c5[_0x15e7f7(0x1bd)],'language':_0x40f8c5[_0x15e7f7(0x17f)],'amount_is_editable':_0x40f8c5[_0x15e7f7(0x15a)],'max_payments':_0x40f8c5[_0x15e7f7(0x1bc)],'customer':_0x40f8c5[_0x15e7f7(0x191)]});}async[a52_0x53f68d(0x1a0)](_0x411336,_0x313672){const _0x14aad8=a52_0x53f68d;return this[_0x14aad8(0x148)][_0x14aad8(0x138)](_0x411336,_0x313672);}async[a52_0x53f68d(0x186)](_0x2fad84,_0x33c62d){const _0x4bcd59=a52_0x53f68d;return this[_0x4bcd59(0x148)][_0x4bcd59(0x178)](_0x2fad84,_0x33c62d);}async[a52_0x53f68d(0x176)](_0x444303,_0x3c0447,_0x482080){const _0x346bd0=a52_0x53f68d,_0x2d99cc=await database_1[_0x346bd0(0x1c4)]['payment']['findFirst']({'where':{'id':_0x3c0447,'shopId':_0x444303}});if(!_0x2d99cc)throw new Error(_0x346bd0(0x180));const _0x3c79d7=await database_1['default'][_0x346bd0(0x1a3)][_0x346bd0(0x163)]({'where':{'id':_0x3c0447},'data':{..._0x482080,'updatedAt':new Date()}});return _0x3c79d7;}async[a52_0x53f68d(0x177)](_0x5a47dc,_0x33bb2f){const _0x1d5d30=a52_0x53f68d,_0x163100=await database_1[_0x1d5d30(0x1c4)][_0x1d5d30(0x1a3)][_0x1d5d30(0x1cb)]({'where':{'id':_0x33bb2f,'shopId':_0x5a47dc}});if(!_0x163100)throw new Error('Payment\x20not\x20found');await database_1['default']['payment'][_0x1d5d30(0x14d)]({'where':{'id':_0x33bb2f}});}async[a52_0x53f68d(0x145)](_0x5d9b41,_0x3b6291){const _0x4e04dd=a52_0x53f68d,{page:_0x1c6f5c,limit:_0x29f130,status:_0x4a9c18,method:_0x136003,dateFrom:_0x29dd7c,dateTo:_0x4adc57,periodFrom:_0x38ddf1,periodTo:_0x259ce1}=_0x3b6291,_0xda8f5d=(_0x1c6f5c-0x1)*_0x29f130,_0x443ce6={'shopId':_0x5d9b41};_0x4a9c18&&(_0x443ce6[_0x4e04dd(0x1a5)]=_0x4a9c18[_0x4e04dd(0x183)]());_0x136003&&(_0x443ce6[_0x4e04dd(0x166)]=_0x136003);if(_0x29dd7c||_0x4adc57||_0x38ddf1||_0x259ce1){_0x443ce6[_0x4e04dd(0x185)]={};if(_0x38ddf1)_0x443ce6[_0x4e04dd(0x185)][_0x4e04dd(0x1a4)]=new Date(_0x38ddf1);else _0x29dd7c&&(_0x443ce6[_0x4e04dd(0x185)][_0x4e04dd(0x1a4)]=new Date(_0x29dd7c));if(_0x259ce1)_0x443ce6['createdAt'][_0x4e04dd(0x14f)]=new Date(_0x259ce1);else _0x4adc57&&(_0x443ce6['createdAt'][_0x4e04dd(0x14f)]=new Date(_0x4adc57));}const [_0x56d06c,_0x4b62c2]=await Promise['all']([database_1[_0x4e04dd(0x1c4)][_0x4e04dd(0x1c8)][_0x4e04dd(0x179)]({'where':_0x443ce6,'skip':_0xda8f5d,'take':_0x29f130,'orderBy':{'createdAt':'desc'}}),database_1[_0x4e04dd(0x1c4)]['payout']['count']({'where':_0x443ce6})]);return{'payouts':_0x56d06c[_0x4e04dd(0x1a7)](_0x16d0db=>({'id':_0x16d0db['id'],'amount':_0x16d0db[_0x4e04dd(0x141)],'network':_0x16d0db[_0x4e04dd(0x166)],'status':_0x16d0db[_0x4e04dd(0x1a5)],'txid':_0x16d0db[_0x4e04dd(0x19d)],'notes':_0x16d0db[_0x4e04dd(0x133)],'createdAt':_0x16d0db['createdAt'],'paidAt':_0x16d0db[_0x4e04dd(0x19c)]})),'pagination':{'page':_0x1c6f5c,'limit':_0x29f130,'total':_0x4b62c2,'totalPages':Math['ceil'](_0x4b62c2/_0x29f130)}};}async['getPayoutById'](_0x48e3fe,_0x5ec6d8){const _0x4c33ee=a52_0x53f68d,_0x1329f1=await database_1[_0x4c33ee(0x1c4)][_0x4c33ee(0x1c8)][_0x4c33ee(0x1cb)]({'where':{'id':_0x5ec6d8,'shopId':_0x48e3fe}});if(!_0x1329f1)return null;return{'id':_0x1329f1['id'],'amount':_0x1329f1[_0x4c33ee(0x141)],'network':_0x1329f1['network'],'status':_0x1329f1[_0x4c33ee(0x1a5)],'txid':_0x1329f1[_0x4c33ee(0x19d)],'notes':_0x1329f1[_0x4c33ee(0x133)],'createdAt':_0x1329f1[_0x4c33ee(0x185)],'paidAt':_0x1329f1[_0x4c33ee(0x19c)]};}async['getPayoutStatistics'](_0x336d3f,_0xea497e){const _0x34dfe1=a52_0x53f68d,_0x4aedd6=new Date();let _0x1a3b35;switch(_0xea497e){case'7d':_0x1a3b35=new Date(_0x4aedd6[_0x34dfe1(0x143)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x34dfe1(0x198):_0x1a3b35=new Date(_0x4aedd6[_0x34dfe1(0x143)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x34dfe1(0x1b5):_0x1a3b35=new Date(_0x4aedd6[_0x34dfe1(0x143)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1a3b35=new Date(_0x4aedd6[_0x34dfe1(0x143)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xffaf53,_0x4b2c71,_0x43f203,_0x51e95b,_0x4cf6ae,_0xae3d63]=await Promise[_0x34dfe1(0x1b0)]([database_1[_0x34dfe1(0x1c4)]['payout'][_0x34dfe1(0x1cc)]({'where':{'shopId':_0x336d3f,'createdAt':{'gte':_0x1a3b35}}}),database_1[_0x34dfe1(0x1c4)][_0x34dfe1(0x1c8)][_0x34dfe1(0x1cc)]({'where':{'shopId':_0x336d3f,'status':_0x34dfe1(0x1af),'createdAt':{'gte':_0x1a3b35}}}),database_1['default'][_0x34dfe1(0x1c8)][_0x34dfe1(0x1cc)]({'where':{'shopId':_0x336d3f,'status':'PENDING','createdAt':{'gte':_0x1a3b35}}}),database_1[_0x34dfe1(0x1c4)][_0x34dfe1(0x1c8)][_0x34dfe1(0x1cc)]({'where':{'shopId':_0x336d3f,'status':_0x34dfe1(0x15e),'createdAt':{'gte':_0x1a3b35}}}),database_1[_0x34dfe1(0x1c4)][_0x34dfe1(0x1c8)][_0x34dfe1(0x179)]({'where':{'shopId':_0x336d3f,'createdAt':{'gte':_0x1a3b35}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x34dfe1(0x1c4)]['payout'][_0x34dfe1(0x179)]({'where':{'shopId':_0x336d3f},'take':0xa,'orderBy':{'createdAt':_0x34dfe1(0x1b6)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x5ab101=_0x4cf6ae['reduce']((_0x239dcf,_0x6b5145)=>_0x239dcf+_0x6b5145[_0x34dfe1(0x141)],0x0),_0xcbe317=_0x4cf6ae[_0x34dfe1(0x17e)](_0x14316c=>_0x14316c[_0x34dfe1(0x1a5)]===_0x34dfe1(0x1af))[_0x34dfe1(0x147)]((_0x493e7b,_0x343b79)=>_0x493e7b+_0x343b79['amount'],0x0),_0x342df5=_0x4cf6ae[_0x34dfe1(0x17e)](_0x1d9f5e=>_0x1d9f5e[_0x34dfe1(0x1a5)]===_0x34dfe1(0x18b))[_0x34dfe1(0x147)]((_0x1694eb,_0x2785fd)=>_0x1694eb+_0x2785fd['amount'],0x0),_0x51117a=_0x4cf6ae[_0x34dfe1(0x147)]((_0x48536d,_0x5c282b)=>{const _0x5a3f42=_0x34dfe1;return _0x48536d[_0x5c282b[_0x5a3f42(0x166)]]=(_0x48536d[_0x5c282b[_0x5a3f42(0x166)]]||0x0)+0x1,_0x48536d;},{}),_0x4f9b8b=_0x4cf6ae[_0x34dfe1(0x147)]((_0x3f9a6a,_0x207c18)=>{const _0x435d83=_0x34dfe1;return _0x3f9a6a[_0x207c18[_0x435d83(0x1a5)]]=(_0x3f9a6a[_0x207c18['status']]||0x0)+0x1,_0x3f9a6a;},{});return{'totalPayouts':_0xffaf53,'completedPayouts':_0x4b2c71,'pendingPayouts':_0x43f203,'rejectedPayouts':_0x51e95b,'totalAmount':_0x5ab101,'completedAmount':_0xcbe317,'pendingAmount':_0x342df5,'payoutsByMethod':_0x51117a,'payoutsByStatus':_0x4f9b8b,'recentPayouts':_0xae3d63[_0x34dfe1(0x1a7)](_0x5d694a=>({'id':_0x5d694a['id'],'shopId':_0x336d3f,'amount':_0x5d694a[_0x34dfe1(0x141)],'method':_0x5d694a[_0x34dfe1(0x166)],'status':_0x5d694a[_0x34dfe1(0x1a5)],'txid':_0x5d694a[_0x34dfe1(0x19d)],'createdAt':_0x5d694a[_0x34dfe1(0x185)],'paidAt':_0x5d694a[_0x34dfe1(0x19c)]}))};}async[a52_0x53f68d(0x16f)](_0x11bbc5){const _0x239c33=a52_0x53f68d;console[_0x239c33(0x16d)](_0x239c33(0x1b7)+_0x11bbc5+_0x239c33(0x16b));const _0x327a8b=await database_1['default']['shop'][_0x239c33(0x135)]({'where':{'id':_0x11bbc5},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x327a8b)throw new Error(_0x239c33(0x17b));const _0x279272=new Date(),_0x542c4e=new Date(_0x279272['getFullYear'](),_0x279272['getMonth'](),0x1),_0x37b020=new Date(_0x279272[_0x239c33(0x157)](),_0x279272[_0x239c33(0x17a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xb4efa=await database_1[_0x239c33(0x1c4)][_0x239c33(0x1c8)][_0x239c33(0x160)]({'_sum':{'amount':!![]},'where':{'shopId':_0x11bbc5,'createdAt':{'gte':_0x542c4e,'lte':_0x37b020},'status':_0x239c33(0x1af)}}),_0x241fd6=_0xb4efa['_sum'][_0x239c33(0x141)]||0x0,_0x599e3b={'availableBalance':Math[_0x239c33(0x155)](_0x327a8b[_0x239c33(0x1c2)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x327a8b[_0x239c33(0x190)]*0x64)/0x64,'awaitingPayout':Math[_0x239c33(0x155)](_0x327a8b[_0x239c33(0x1c2)]*0x64)/0x64,'thisMonth':Math[_0x239c33(0x155)](_0x241fd6*0x64)/0x64};return console['log'](_0x239c33(0x164)+_0x327a8b[_0x239c33(0x1ca)]+'\x20payout\x20statistics\x20calculated:'),console[_0x239c33(0x16d)](_0x239c33(0x196)+_0x599e3b[_0x239c33(0x1c3)]+_0x239c33(0x18f)),console['log'](_0x239c33(0x17c)+_0x599e3b['totalPaidOut']+'\x20USDT\x20(total\x20payouts)'),console[_0x239c33(0x16d)](_0x239c33(0x144)+_0x599e3b[_0x239c33(0x139)]+'\x20USDT\x20(current\x20balance)'),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x599e3b['thisMonth']+_0x239c33(0x137)),_0x599e3b;}['getGatewayDisplayName'](_0x45d5b0){const _0x50440f=a52_0x53f68d,_0x236df9={'test_gateway':_0x50440f(0x18a),'plisio':_0x50440f(0x1be),'rapyd':_0x50440f(0x14c),'noda':_0x50440f(0x192),'cointopay':_0x50440f(0x1c9),'klyme_eu':_0x50440f(0x172),'klyme_gb':'KLYME\x20GB','klyme_de':_0x50440f(0x188)};return _0x236df9[_0x45d5b0]||_0x45d5b0;}async[a52_0x53f68d(0x14b)](_0x4d94f7){return this['getShopPayoutStats'](_0x4d94f7);}async[a52_0x53f68d(0x199)](_0x3ba59f,_0x33d244){const _0xa161c5=a52_0x53f68d,{page:_0x2f0145,limit:_0x354c61,paymentId:_0x1f1255}=_0x33d244,_0x195ea0=(_0x2f0145-0x1)*_0x354c61,_0x7bfded={'shopId':_0x3ba59f};_0x1f1255&&(_0x7bfded['paymentId']=_0x1f1255);const [_0x5f3e04,_0xca2ca]=await Promise['all']([database_1[_0xa161c5(0x1c4)][_0xa161c5(0x1a8)]['findMany']({'where':_0x7bfded,'skip':_0x195ea0,'take':_0x354c61,'orderBy':{'createdAt':_0xa161c5(0x1b6)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0xa161c5(0x1c4)][_0xa161c5(0x1a8)]['count']({'where':_0x7bfded})]);return{'logs':_0x5f3e04[_0xa161c5(0x1a7)](_0x13d7ee=>({'id':_0x13d7ee['id'],'paymentId':_0x13d7ee[_0xa161c5(0x193)],'shopId':_0x13d7ee[_0xa161c5(0x1ae)],'event':_0x13d7ee[_0xa161c5(0x153)],'statusCode':_0x13d7ee[_0xa161c5(0x19e)],'retryCount':_0x13d7ee[_0xa161c5(0x184)],'responseBody':_0x13d7ee[_0xa161c5(0x1bb)],'createdAt':_0x13d7ee[_0xa161c5(0x185)],'payment':_0x13d7ee['payment']})),'pagination':{'page':_0x2f0145,'limit':_0x354c61,'total':_0xca2ca,'totalPages':Math['ceil'](_0xca2ca/_0x354c61)}};}async['getStatistics'](_0x3330eb,_0x2a9e9d){const _0x54aab5=a52_0x53f68d,_0x497155=new Date();let _0x348046;switch(_0x2a9e9d){case'7d':_0x348046=new Date(_0x497155[_0x54aab5(0x143)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x54aab5(0x198):_0x348046=new Date(_0x497155[_0x54aab5(0x143)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x54aab5(0x1b5):_0x348046=new Date(_0x497155['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x348046=new Date(_0x497155[_0x54aab5(0x143)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2ef017,_0x125270,_0x325ebf,_0x1bc3dc,_0x2849e8]=await Promise[_0x54aab5(0x1b0)]([database_1['default'][_0x54aab5(0x1a3)]['count']({'where':{'shopId':_0x3330eb,'gateway':{'not':_0x54aab5(0x174)},'createdAt':{'gte':_0x348046}}}),database_1[_0x54aab5(0x1c4)]['payment'][_0x54aab5(0x1cc)]({'where':{'shopId':_0x3330eb,'gateway':{'not':_0x54aab5(0x174)},'status':_0x54aab5(0x13b),'createdAt':{'gte':_0x348046}}}),database_1[_0x54aab5(0x1c4)]['payment'][_0x54aab5(0x179)]({'where':{'shopId':_0x3330eb,'gateway':{'not':_0x54aab5(0x174)},'status':_0x54aab5(0x13b),'createdAt':{'gte':_0x348046}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x54aab5(0x1c4)]['payment'][_0x54aab5(0x179)]({'where':{'shopId':_0x3330eb,'gateway':{'not':_0x54aab5(0x174)}},'take':0xa,'orderBy':{'createdAt':_0x54aab5(0x1b6)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x54aab5(0x1c4)][_0x54aab5(0x1a3)][_0x54aab5(0x179)]({'where':{'shopId':_0x3330eb,'gateway':{'not':_0x54aab5(0x174)},'createdAt':{'gte':_0x348046}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x54aab5(0x1d0)}})]);let _0x2c0c44=0x0;for(const _0x1e6bc8 of _0x325ebf){if(_0x1e6bc8['amountUSDT'])_0x2c0c44+=_0x1e6bc8[_0x54aab5(0x15c)];else{const _0x4bbc9b=await currencyService_1[_0x54aab5(0x1a1)][_0x54aab5(0x1cf)](_0x1e6bc8[_0x54aab5(0x141)],_0x1e6bc8[_0x54aab5(0x13d)]);_0x2c0c44+=_0x4bbc9b;}}const _0xac593=this[_0x54aab5(0x1c0)](_0x2849e8,_0x348046,_0x497155),_0xe46f47=_0x2ef017>0x0?_0x125270/_0x2ef017*0x64:0x0;return{'totalPayments':_0x2ef017,'successfulPayments':_0x125270,'totalRevenue':Math['round'](_0x2c0c44*0x64)/0x64,'conversionRate':Math[_0x54aab5(0x155)](_0xe46f47*0x64)/0x64,'dailyRevenue':_0xac593[_0x54aab5(0x187)],'dailyPayments':_0xac593[_0x54aab5(0x1bf)],'recentPayments':_0x1bc3dc[_0x54aab5(0x1a7)](_0x2d5f0a=>({'id':_0x2d5f0a['id'],'gateway':_0x2d5f0a['gateway'],'amount':_0x2d5f0a[_0x54aab5(0x141)],'currency':_0x2d5f0a[_0x54aab5(0x13d)],'status':_0x2d5f0a[_0x54aab5(0x1a5)],'createdAt':_0x2d5f0a[_0x54aab5(0x185)]}))};}[a52_0x53f68d(0x1c0)](_0x4e2cf0,_0x46dafb,_0x4bd923){const _0x392031=a52_0x53f68d,_0x40530d=new Map(),_0x360c43=new Date(_0x46dafb);while(_0x360c43<=_0x4bd923){const _0x98b45a=_0x360c43['toISOString']()[_0x392031(0x14e)]('T')[0x0];_0x40530d[_0x392031(0x15d)](_0x98b45a,{'revenue':0x0,'count':0x0}),_0x360c43[_0x392031(0x1c1)](_0x360c43[_0x392031(0x134)]()+0x1);}for(const _0x2e537a of _0x4e2cf0){const _0x56cbfa=_0x2e537a['createdAt'][_0x392031(0x171)]()['split']('T')[0x0],_0x4754bc=_0x40530d[_0x392031(0x168)](_0x56cbfa);_0x4754bc&&(_0x4754bc[_0x392031(0x1cc)]+=0x1,_0x2e537a[_0x392031(0x1a5)]===_0x392031(0x13b)&&_0x2e537a['amountUSDT']&&(_0x4754bc['revenue']+=_0x2e537a[_0x392031(0x15c)]));}const _0x1770c7=[],_0x58ad46=[];for(const [_0x74af3a,_0x1b8193]of _0x40530d){_0x1770c7[_0x392031(0x1ac)]({'date':_0x74af3a,'amount':Math[_0x392031(0x155)](_0x1b8193['revenue']*0x64)/0x64}),_0x58ad46[_0x392031(0x1ac)]({'date':_0x74af3a,'count':_0x1b8193['count']});}return{'dailyRevenue':_0x1770c7,'dailyPayments':_0x58ad46};}}exports['ShopService']=ShopService;