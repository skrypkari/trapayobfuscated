'use strict';const a86_0x21e1a8=a86_0x5654;(function(_0x50516b,_0xce82ff){const _0x118b25=a86_0x5654,_0x58ea09=_0x50516b();while(!![]){try{const _0x284734=-parseInt(_0x118b25(0xb4))/0x1+parseInt(_0x118b25(0xd7))/0x2*(-parseInt(_0x118b25(0x9f))/0x3)+parseInt(_0x118b25(0x13a))/0x4*(-parseInt(_0x118b25(0x116))/0x5)+parseInt(_0x118b25(0x12d))/0x6*(parseInt(_0x118b25(0x130))/0x7)+parseInt(_0x118b25(0xc9))/0x8+-parseInt(_0x118b25(0x10c))/0x9*(-parseInt(_0x118b25(0x11d))/0xa)+parseInt(_0x118b25(0x13c))/0xb;if(_0x284734===_0xce82ff)break;else _0x58ea09['push'](_0x58ea09['shift']());}catch(_0xc9090d){_0x58ea09['push'](_0x58ea09['shift']());}}}(a86_0x3839,0xb013c));var __importDefault=this&&this[a86_0x21e1a8(0x75)]||function(_0x33ae01){const _0x2d3708=a86_0x21e1a8;return _0x33ae01&&_0x33ae01[_0x2d3708(0x104)]?_0x33ae01:{'default':_0x33ae01};};Object[a86_0x21e1a8(0x66)](exports,a86_0x21e1a8(0x104),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require(a86_0x21e1a8(0xcb))),bcryptjs_1=__importDefault(require(a86_0x21e1a8(0x8e))),crypto_1=__importDefault(require(a86_0x21e1a8(0x85))),speakeasy_1=__importDefault(require(a86_0x21e1a8(0xc3))),qrcode_1=__importDefault(require(a86_0x21e1a8(0x143))),currencyService_1=require('./currencyService'),paymentService_1=require(a86_0x21e1a8(0xe9)),gateway_1=require(a86_0x21e1a8(0xac));function a86_0x3839(){const _0x38c9e1=['notes','\x20\x20\x20ðŸ’°\x20Total\x20paid\x20out:\x20','PaymentService','sha256','gte','USDT\x20Polygon','findFirst','getDate','Unknown\x20error','usdcPolygonWallet','...','paymentService','erc20','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','defineProperty','ceil','periodTo','disable2FA','error','test','convertToUSDT','dailyRevenue','ðŸ“…\x20Date\x20start:\x20','webhookEvents','erc20_usdc','getUTCMonth','thisMonth','toDataURL','KLYME\x20GB','__importDefault','No\x20webhook\x20URL\x20configured','test_order_123','sourceCurrency','ðŸŒ\x20Network\x20filter:\x20','shopUrl','UTC','formatNetworkName','createPublicPayment','currency','2FA\x20token\x20is\x20required','CoinToPay','parse','otpauth_url','payout','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','crypto','setDate',',\x20dateTo:\x20','usdcErcWallet','amount','this_week','all_time','ðŸ“…\x20Custom\x20period:\x20','getShopProfile','bcryptjs','generateDailyStatistics','awaitingPayout','paid','Noda','getPayouts','fullName','payment','POST','telegramId','digest','ðŸ“Š\x20Shop\x20','updatePayment','retryCount','custom_','language','log','1611WpTlQL','Error\x20parsing\x20webhook\x20events:','getUTCDay','PAID','desc','polygon_usdc','application/json','push','twoFactorToken','amountUSDT','ðŸ“Š\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','compare','USDT\x20ERC20','../types/gateway','merchantUrl','ðŸ“…\x20Custom\x20date\x20range:\x20','ðŸ’°\x20Getting\x20payouts\x20with\x20filters:','asc','createHmac','Payment\x20not\x20found','findUnique','560646gtqCuM','secretKey','Plisio','round','KLYME\x20EU','update','usdtPolygonWallet','this_month','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','Webhook\x20returned\x20error:\x20','paidAt','map','dailyPayments','setHours','availableBalance','speakeasy','USD','telegram','totalPaidOut','backupCodes','gateways','91384ffaPaW','hex','../config/database','KLYME\x20DE','isActive','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','ShopService','all','hash','gatewaySettings','filter',',\x20dateFrom:\x20','USDC\x20Polygon','usdtErcWallet','3282XHuxpS','wallets','REJECTED','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','username','polygon','ðŸŒ\x20Method\x20filter:\x20','isArray','TrapaPay','aggregate','_sum','COMPLETED','getPayoutStats','webhookUrl','ðŸ“Š\x20Getting\x20statistics\x20for\x20shop\x20','base32','network','includes','./paymentService','paymentId','balance','Failed\x20to\x20send\x20webhook:\x20','count','settings','YESTERDAY','getGatewayDisplayName','ðŸ“…\x20Period\x20end:\x20','test_payment_123','status','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','\x20backup\x20codes','toLowerCase','Invalid\x202FA\x20token','event','statusCode','last_week','getUTCDate','periodFrom','last_month','twoFactorSecret','getStatistics','customerEmail','verify','Shop\x20not\x20found','2FA\x20is\x20already\x20enabled','__esModule','twoFactorEnabled','\x20USDT\x20(current\x20balance)','usdtTrcWallet','replace','trc20','gateway','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','2502bwBVxW','getPayoutStatistics','ðŸ“Š\x20Payments\x20by\x20gateway\x20(all\x20time):','reduce','getWebhookLogs','revenue','getPayments','ðŸ“…\x20Date\x20end:\x20','getUTCFullYear','paymentGateways','5mjDMoV','findMany','testWebhook','publicKey','shop','Rapyd','AVAILABLE_GATEWAYS','10980QIArCN','PENDING','split','name','deletePayment','REFUND','randomBytes','\x20to\x20','ðŸ“Š\x20Status\x20filter:\x20','TrapaPay\x20(','generateBackupCodes','length','getTime','customerName','set','setUTCDate','276WispeJ','getFullYear','test_gateway','25221edLtyb','redirectUrl','toUpperCase','amountAfterGatewayCommissionUSDT','90d','ðŸ”‘\x20Generated\x20','createdAt','webhookLog','getPaymentsByShop','toISOString','2664916iqjdsn','default','25815889TBJthq','lte','totp','stringify','updateWallets','txid','getShopPayoutStats','qrcode','yesterday','startsWith'];a86_0x3839=function(){return _0x38c9e1;};return a86_0x3839();}function a86_0x5654(_0x25a1eb,_0x1cd06e){_0x25a1eb=_0x25a1eb-0x64;const _0x383923=a86_0x3839();let _0x5654a7=_0x383923[_0x25a1eb];return _0x5654a7;}class ShopService{constructor(){const _0x4b8106=a86_0x21e1a8;this[_0x4b8106(0x151)]=new paymentService_1[(_0x4b8106(0x148))]();}async[a86_0x21e1a8(0x8d)](_0x4f74b4){const _0x413288=a86_0x21e1a8,_0x2a15b9=await database_1[_0x413288(0x13b)][_0x413288(0x11a)][_0x413288(0xb3)]({'where':{'id':_0x4f74b4},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2a15b9)throw new Error(_0x413288(0x102));let _0x5df349=[];if(_0x2a15b9[_0x413288(0xee)]?.[_0x413288(0x6f)])try{_0x5df349=Array[_0x413288(0xde)](_0x2a15b9['settings'][_0x413288(0x6f)])?_0x2a15b9[_0x413288(0xee)]['webhookEvents']:JSON['parse'](_0x2a15b9['settings'][_0x413288(0x6f)]);}catch(_0x1424e7){console[_0x413288(0x6a)](_0x413288(0xa0),_0x1424e7),_0x5df349=[];}const _0x1b53bf=gateway_1[_0x413288(0x11c)][_0x413288(0xd3)](_0x2ca346=>_0x2ca346[_0x413288(0xcd)])[_0x413288(0xbf)](_0x5c3c51=>_0x5c3c51[_0x413288(0x120)]);let _0x5271c7=_0x2a15b9['paymentGateways']?JSON[_0x413288(0x81)](_0x2a15b9[_0x413288(0x115)]):[];return Array['isArray'](_0x5271c7)&&(_0x5271c7=_0x5271c7[_0x413288(0xbf)](_0x4a3fdc=>_0x4a3fdc['replace'](/\s+/g,'_')[_0x413288(0xf6)]())[_0x413288(0xd3)](_0x140f0d=>_0x1b53bf[_0x413288(0xe8)](_0x140f0d))),{'id':_0x2a15b9['id'],'fullName':_0x2a15b9['name'],'username':_0x2a15b9['username'],'telegramId':_0x2a15b9[_0x413288(0xc5)],'merchantUrl':_0x2a15b9[_0x413288(0x7a)],'gateways':_0x5271c7,'gatewaySettings':_0x2a15b9[_0x413288(0xd2)]?JSON[_0x413288(0x81)](_0x2a15b9[_0x413288(0xd2)]):null,'publicKey':_0x2a15b9[_0x413288(0x119)],'secretKey':_0x2a15b9[_0x413288(0xb5)],'webhookUrl':_0x2a15b9[_0x413288(0xee)]?.[_0x413288(0xe4)]||null,'webhookEvents':_0x5df349,'wallets':{'usdtPolygonWallet':_0x2a15b9[_0x413288(0xba)],'usdtTrcWallet':_0x2a15b9[_0x413288(0x107)],'usdtErcWallet':_0x2a15b9[_0x413288(0xd6)],'usdcPolygonWallet':_0x2a15b9[_0x413288(0x14f)],'usdcErcWallet':_0x2a15b9[_0x413288(0x88)]},'status':_0x2a15b9[_0x413288(0xf3)],'createdAt':_0x2a15b9[_0x413288(0x136)]};}async['updateShopProfile'](_0x48c3f0,_0x1e7bef){const _0x45a3c0=a86_0x21e1a8,_0x5ac57c={};_0x1e7bef['fullName']&&(_0x5ac57c[_0x45a3c0(0x120)]=_0x1e7bef[_0x45a3c0(0x94)]);_0x1e7bef[_0x45a3c0(0x97)]!==undefined&&(_0x5ac57c['telegram']=_0x1e7bef[_0x45a3c0(0x97)]||null);_0x1e7bef[_0x45a3c0(0xad)]&&(_0x5ac57c[_0x45a3c0(0x7a)]=_0x1e7bef[_0x45a3c0(0xad)]);_0x1e7bef[_0x45a3c0(0xc8)]&&(_0x5ac57c['paymentGateways']=JSON['stringify'](_0x1e7bef[_0x45a3c0(0xc8)]));_0x1e7bef[_0x45a3c0(0xd2)]&&(_0x5ac57c[_0x45a3c0(0xd2)]=JSON['stringify'](_0x1e7bef[_0x45a3c0(0xd2)]));_0x1e7bef[_0x45a3c0(0xd8)]&&(_0x1e7bef[_0x45a3c0(0xd8)][_0x45a3c0(0xba)]!==undefined&&(_0x5ac57c['usdtPolygonWallet']=_0x1e7bef[_0x45a3c0(0xd8)][_0x45a3c0(0xba)]||null),_0x1e7bef[_0x45a3c0(0xd8)][_0x45a3c0(0x107)]!==undefined&&(_0x5ac57c[_0x45a3c0(0x107)]=_0x1e7bef['wallets'][_0x45a3c0(0x107)]||null),_0x1e7bef['wallets']['usdtErcWallet']!==undefined&&(_0x5ac57c[_0x45a3c0(0xd6)]=_0x1e7bef[_0x45a3c0(0xd8)]['usdtErcWallet']||null),_0x1e7bef['wallets'][_0x45a3c0(0x14f)]!==undefined&&(_0x5ac57c[_0x45a3c0(0x14f)]=_0x1e7bef[_0x45a3c0(0xd8)][_0x45a3c0(0x14f)]||null));const _0x189e83=await database_1[_0x45a3c0(0x13b)][_0x45a3c0(0x11a)][_0x45a3c0(0xb9)]({'where':{'id':_0x48c3f0},'data':_0x5ac57c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'secretKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x13e09d=[];if(_0x189e83[_0x45a3c0(0xee)]?.[_0x45a3c0(0x6f)])try{_0x13e09d=Array[_0x45a3c0(0xde)](_0x189e83[_0x45a3c0(0xee)][_0x45a3c0(0x6f)])?_0x189e83['settings']['webhookEvents']:JSON[_0x45a3c0(0x81)](_0x189e83[_0x45a3c0(0xee)][_0x45a3c0(0x6f)]);}catch(_0x302f3b){console[_0x45a3c0(0x6a)](_0x45a3c0(0xa0),_0x302f3b),_0x13e09d=[];}return{'id':_0x189e83['id'],'fullName':_0x189e83[_0x45a3c0(0x120)],'username':_0x189e83[_0x45a3c0(0xdb)],'telegramId':_0x189e83[_0x45a3c0(0xc5)],'merchantUrl':_0x189e83[_0x45a3c0(0x7a)],'gateways':_0x189e83[_0x45a3c0(0x115)]?JSON[_0x45a3c0(0x81)](_0x189e83[_0x45a3c0(0x115)]):null,'gatewaySettings':_0x189e83[_0x45a3c0(0xd2)]?JSON[_0x45a3c0(0x81)](_0x189e83['gatewaySettings']):null,'publicKey':_0x189e83[_0x45a3c0(0x119)],'secretKey':_0x189e83[_0x45a3c0(0xb5)],'webhookUrl':_0x189e83[_0x45a3c0(0xee)]?.[_0x45a3c0(0xe4)]||null,'webhookEvents':_0x13e09d,'wallets':{'usdtPolygonWallet':_0x189e83[_0x45a3c0(0xba)],'usdtTrcWallet':_0x189e83[_0x45a3c0(0x107)],'usdtErcWallet':_0x189e83[_0x45a3c0(0xd6)],'usdcPolygonWallet':_0x189e83[_0x45a3c0(0x14f)],'usdcErcWallet':_0x189e83['usdcErcWallet']},'status':_0x189e83[_0x45a3c0(0xf3)],'createdAt':_0x189e83['createdAt']};}async[a86_0x21e1a8(0x140)](_0x5995e1,_0x260313){const _0x449535=a86_0x21e1a8,_0x24be87=await database_1[_0x449535(0x13b)][_0x449535(0x11a)][_0x449535(0xb3)]({'where':{'id':_0x5995e1},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x24be87)throw new Error(_0x449535(0x102));if(_0x24be87['twoFactorEnabled']){if(!_0x260313[_0x449535(0xa7)])throw new Error(_0x449535(0x7f));const _0x4a4367=speakeasy_1[_0x449535(0x13b)][_0x449535(0x13e)][_0x449535(0x101)]({'secret':_0x24be87[_0x449535(0xfe)],'encoding':_0x449535(0xe6),'token':_0x260313[_0x449535(0xa7)],'window':0x2});if(!_0x4a4367){let _0x145e0b=![];if(_0x24be87[_0x449535(0xc7)]){const _0xa944aa=JSON[_0x449535(0x81)](_0x24be87['backupCodes']);for(let _0x1a001c=0x0;_0x1a001c<_0xa944aa[_0x449535(0x128)];_0x1a001c++){const _0x3a7516=await bcryptjs_1[_0x449535(0x13b)][_0x449535(0xaa)](_0x260313[_0x449535(0xa7)],_0xa944aa[_0x1a001c]);if(_0x3a7516){_0x145e0b=!![],_0xa944aa['splice'](_0x1a001c,0x1),await database_1[_0x449535(0x13b)][_0x449535(0x11a)][_0x449535(0xb9)]({'where':{'id':_0x5995e1},'data':{'backupCodes':JSON['stringify'](_0xa944aa)}});break;}}}if(!_0x145e0b)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x113a41={};_0x260313['usdtPolygonWallet']!==undefined&&(_0x113a41[_0x449535(0xba)]=_0x260313['usdtPolygonWallet']||null),_0x260313[_0x449535(0x107)]!==undefined&&(_0x113a41['usdtTrcWallet']=_0x260313[_0x449535(0x107)]||null),_0x260313['usdtErcWallet']!==undefined&&(_0x113a41[_0x449535(0xd6)]=_0x260313[_0x449535(0xd6)]||null),_0x260313[_0x449535(0x14f)]!==undefined&&(_0x113a41['usdcPolygonWallet']=_0x260313[_0x449535(0x14f)]||null),_0x260313[_0x449535(0x88)]!==undefined&&(_0x113a41['usdcErcWallet']=_0x260313['usdcErcWallet']||null),await database_1[_0x449535(0x13b)]['shop'][_0x449535(0xb9)]({'where':{'id':_0x5995e1},'data':_0x113a41});}async[a86_0x21e1a8(0x118)](_0x4106ca){const _0x3e640e=a86_0x21e1a8,_0x4ef22f=await database_1['default']['shop'][_0x3e640e(0xb3)]({'where':{'id':_0x4106ca},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x4ef22f?.[_0x3e640e(0xee)]?.['webhookUrl'])throw new Error(_0x3e640e(0x76));const _0x487fb5={'event':_0x3e640e(0x6b),'payment':{'id':_0x3e640e(0xf2),'order_id':_0x3e640e(0x77),'gateway':'test','amount':0x64,'currency':_0x3e640e(0xc4),'status':_0x3e640e(0x91),'created_at':new Date()['toISOString']()}};try{const _0x1feb6e=JSON[_0x3e640e(0x13f)](_0x487fb5),_0x2af0bd=crypto_1[_0x3e640e(0x13b)][_0x3e640e(0xb1)](_0x3e640e(0x149),_0x4ef22f[_0x3e640e(0xb5)])[_0x3e640e(0xb9)](_0x1feb6e)[_0x3e640e(0x98)]('hex'),_0x535028=await fetch(_0x4ef22f[_0x3e640e(0xee)][_0x3e640e(0xe4)],{'method':_0x3e640e(0x96),'headers':{'Content-Type':_0x3e640e(0xa5),'User-Agent':'Payment\x20System/1.0\x20(Test)','X-Webhook-Signature':_0x2af0bd},'body':_0x1feb6e});return _0x535028['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x535028[_0x3e640e(0xf3)]+')'}:{'success':![],'message':_0x3e640e(0xbd)+_0x535028[_0x3e640e(0xf3)]+'\x20'+_0x535028['statusText']};}catch(_0x430627){return{'success':![],'message':_0x3e640e(0xec)+(_0x430627 instanceof Error?_0x430627['message']:_0x3e640e(0x14e))};}}async['createPayment'](_0x4e0357){const _0x21e932=a86_0x21e1a8;return this['paymentService'][_0x21e932(0x7d)]({'public_key':'','gateway':_0x4e0357[_0x21e932(0x10a)],'order_id':'','amount':_0x4e0357['amount'],'currency':_0x4e0357['currency'],'source_currency':_0x4e0357[_0x21e932(0x78)],'success_url':_0x4e0357[_0x21e932(0x131)],'fail_url':_0x4e0357[_0x21e932(0x131)],'customer_email':_0x4e0357[_0x21e932(0x100)],'customer_name':_0x4e0357[_0x21e932(0x12a)],'language':_0x4e0357[_0x21e932(0x9d)]});}async[a86_0x21e1a8(0x112)](_0x3b6203,_0x50d3f3){const _0x11fba2=a86_0x21e1a8;return this[_0x11fba2(0x151)][_0x11fba2(0x138)](_0x3b6203,_0x50d3f3);}async['getPaymentById'](_0x5232ba,_0xa586df){const _0x41bcf5=a86_0x21e1a8;return this[_0x41bcf5(0x151)]['getPaymentByShopAndId'](_0x5232ba,_0xa586df);}async[a86_0x21e1a8(0x9a)](_0x125cdf,_0x5d0929,_0x4cfb36){const _0x3beec2=a86_0x21e1a8,_0x2f09b5=await database_1['default'][_0x3beec2(0x95)][_0x3beec2(0x14c)]({'where':{'id':_0x5d0929,'shopId':_0x125cdf}});if(!_0x2f09b5)throw new Error(_0x3beec2(0xb2));const _0x280e5f=await database_1['default'][_0x3beec2(0x95)][_0x3beec2(0xb9)]({'where':{'id':_0x5d0929},'data':{..._0x4cfb36,'updatedAt':new Date()}});return _0x280e5f;}async[a86_0x21e1a8(0x121)](_0x394c8d,_0x2eddfa){const _0x1ecd11=a86_0x21e1a8,_0x576ba9=await database_1[_0x1ecd11(0x13b)][_0x1ecd11(0x95)][_0x1ecd11(0x14c)]({'where':{'id':_0x2eddfa,'shopId':_0x394c8d}});if(!_0x576ba9)throw new Error(_0x1ecd11(0xb2));await database_1['default'][_0x1ecd11(0x95)]['delete']({'where':{'id':_0x2eddfa}});}[a86_0x21e1a8(0x7c)](_0x1046fe){const _0x441015=a86_0x21e1a8,_0x1ba98e={'polygon':_0x441015(0x14b),'trc20':'USDT\x20TRC20','erc20':_0x441015(0xab),'bsc':'USDT\x20BSC','polygon_usdc':_0x441015(0xd5),'erc20_usdc':'USDC\x20Ethereum'};return _0x1ba98e[_0x1046fe]||_0x1046fe;}async[a86_0x21e1a8(0x93)](_0x12fc07,_0x53923f){const _0x535e77=a86_0x21e1a8,{page:_0x3f5d05,limit:_0x3613d6,status:_0x3b66a6,method:_0x454979,network:_0x25bd95,dateFrom:_0xf8b26b,dateTo:_0x5c50af,periodFrom:_0x24c29f,periodTo:_0xff0edb}=_0x53923f,_0x68552f=(_0x3f5d05-0x1)*_0x3613d6;console['log'](_0x535e77(0xaf),_0x53923f);const _0x4bb939={'shopId':_0x12fc07};_0x3b66a6&&(_0x4bb939[_0x535e77(0xf3)]=_0x3b66a6[_0x535e77(0x132)](),console['log'](_0x535e77(0x125)+_0x3b66a6[_0x535e77(0x132)]()));if(_0x454979)_0x4bb939['network']=_0x454979,console[_0x535e77(0x9e)](_0x535e77(0xdd)+_0x454979);else _0x25bd95&&(_0x4bb939[_0x535e77(0xe7)]=_0x25bd95,console['log'](_0x535e77(0x79)+_0x25bd95));if(_0xf8b26b||_0x5c50af||_0x24c29f||_0xff0edb){_0x4bb939[_0x535e77(0x136)]={};if(_0x24c29f){const _0x3f4684=new Date(_0x24c29f);_0x3f4684[_0x535e77(0xc1)](0x0,0x0,0x0,0x1),_0x4bb939[_0x535e77(0x136)]['gte']=_0x3f4684,console[_0x535e77(0x9e)]('ðŸ“…\x20Period\x20start:\x20'+_0x3f4684[_0x535e77(0x139)]());}else{if(_0xf8b26b){const _0x5142c0=new Date(_0xf8b26b);_0x5142c0[_0x535e77(0xc1)](0x0,0x0,0x0,0x1),_0x4bb939[_0x535e77(0x136)][_0x535e77(0x14a)]=_0x5142c0,console[_0x535e77(0x9e)](_0x535e77(0x6e)+_0x5142c0[_0x535e77(0x139)]());}}if(_0xff0edb){const _0x5e4b9a=new Date(_0xff0edb);_0x5e4b9a[_0x535e77(0xc1)](0x17,0x3b,0x3b,0x3e7),_0x4bb939[_0x535e77(0x136)]['lte']=_0x5e4b9a,console[_0x535e77(0x9e)](_0x535e77(0xf1)+_0x5e4b9a[_0x535e77(0x139)]());}else{if(_0x5c50af){const _0x5b8800=new Date(_0x5c50af);_0x5b8800[_0x535e77(0xc1)](0x17,0x3b,0x3b,0x3e7),_0x4bb939['createdAt']['lte']=_0x5b8800,console[_0x535e77(0x9e)](_0x535e77(0x113)+_0x5b8800['toISOString']());}}}console[_0x535e77(0x9e)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x535e77(0x13f)](_0x4bb939,null,0x2));const [_0x805bc3,_0x55e815]=await Promise[_0x535e77(0xd0)]([database_1[_0x535e77(0x13b)][_0x535e77(0x83)][_0x535e77(0x117)]({'where':_0x4bb939,'skip':_0x68552f,'take':_0x3613d6,'orderBy':{'createdAt':_0x535e77(0xa3)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x535e77(0x13b)][_0x535e77(0x83)][_0x535e77(0xed)]({'where':_0x4bb939})]);return{'payouts':_0x805bc3[_0x535e77(0xbf)](_0x9a325a=>{const _0x5a4c69=_0x535e77;let _0x25417d=null;switch(_0x9a325a[_0x5a4c69(0xe7)]){case _0x5a4c69(0xdc):_0x25417d=_0x9a325a[_0x5a4c69(0x11a)][_0x5a4c69(0xba)];break;case _0x5a4c69(0x109):_0x25417d=_0x9a325a[_0x5a4c69(0x11a)][_0x5a4c69(0x107)];break;case _0x5a4c69(0x64):_0x25417d=_0x9a325a[_0x5a4c69(0x11a)][_0x5a4c69(0xd6)];break;case _0x5a4c69(0xa4):_0x25417d=_0x9a325a[_0x5a4c69(0x11a)][_0x5a4c69(0x14f)];break;case _0x5a4c69(0x70):_0x25417d=_0x9a325a[_0x5a4c69(0x11a)][_0x5a4c69(0x88)];break;}return{'id':_0x9a325a['id'],'amount':_0x9a325a[_0x5a4c69(0x89)],'network':this[_0x5a4c69(0x7c)](_0x9a325a[_0x5a4c69(0xe7)]),'wallet':_0x25417d,'status':_0x9a325a[_0x5a4c69(0xf3)],'txid':_0x9a325a['txid'],'notes':_0x9a325a[_0x5a4c69(0x146)],'periodFrom':_0x9a325a[_0x5a4c69(0xfc)],'periodTo':_0x9a325a[_0x5a4c69(0x68)],'createdAt':_0x9a325a['createdAt'],'paidAt':_0x9a325a[_0x5a4c69(0xbe)]};}),'pagination':{'page':_0x3f5d05,'limit':_0x3613d6,'total':_0x55e815,'totalPages':Math[_0x535e77(0x67)](_0x55e815/_0x3613d6)}};}async['getPayoutById'](_0x15a48b,_0x22211a){const _0x5aeb8c=a86_0x21e1a8,_0x592de7=await database_1['default'][_0x5aeb8c(0x83)][_0x5aeb8c(0x14c)]({'where':{'id':_0x22211a,'shopId':_0x15a48b}});if(!_0x592de7)return null;return{'id':_0x592de7['id'],'amount':_0x592de7['amount'],'network':_0x592de7[_0x5aeb8c(0xe7)],'status':_0x592de7['status'],'txid':_0x592de7[_0x5aeb8c(0x141)],'notes':_0x592de7[_0x5aeb8c(0x146)],'createdAt':_0x592de7['createdAt'],'paidAt':_0x592de7[_0x5aeb8c(0xbe)]};}async[a86_0x21e1a8(0x10d)](_0xb9aa05,_0x25394f){const _0x17335c=a86_0x21e1a8,_0x452ca5=new Date();let _0x4f3cea,_0x423d7d;switch(_0x25394f){case _0x17335c(0x144):case _0x17335c(0xef):const _0x3d0859=new Date(_0x452ca5);_0x3d0859[_0x17335c(0x86)](_0x3d0859[_0x17335c(0x14d)]()-0x1),_0x4f3cea=new Date(_0x3d0859),_0x4f3cea[_0x17335c(0xc1)](0x0,0x0,0x0,0x0),_0x423d7d=new Date(_0x3d0859),_0x423d7d[_0x17335c(0xc1)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x4f3cea=new Date(_0x452ca5['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4f3cea=new Date(_0x452ca5[_0x17335c(0x129)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x17335c(0x134):_0x4f3cea=new Date(_0x452ca5[_0x17335c(0x129)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4f3cea=new Date(_0x452ca5[_0x17335c(0x129)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x205023={'gte':_0x4f3cea};_0x423d7d&&(_0x205023[_0x17335c(0x13d)]=_0x423d7d);const [_0x2a02c4,_0x481cb5,_0x12206b,_0x45af08,_0x1c0a33,_0xe79b17]=await Promise['all']([database_1['default'][_0x17335c(0x83)][_0x17335c(0xed)]({'where':{'shopId':_0xb9aa05,'createdAt':_0x205023}}),database_1[_0x17335c(0x13b)]['payout'][_0x17335c(0xed)]({'where':{'shopId':_0xb9aa05,'status':_0x17335c(0xe2),'createdAt':_0x205023}}),database_1[_0x17335c(0x13b)][_0x17335c(0x83)][_0x17335c(0xed)]({'where':{'shopId':_0xb9aa05,'status':_0x17335c(0x11e),'createdAt':_0x205023}}),database_1['default']['payout'][_0x17335c(0xed)]({'where':{'shopId':_0xb9aa05,'status':_0x17335c(0xd9),'createdAt':_0x205023}}),database_1['default'][_0x17335c(0x83)][_0x17335c(0x117)]({'where':{'shopId':_0xb9aa05,'createdAt':_0x205023},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default'][_0x17335c(0x83)][_0x17335c(0x117)]({'where':{'shopId':_0xb9aa05},'take':0xa,'orderBy':{'createdAt':_0x17335c(0xa3)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x466775=_0x1c0a33['reduce']((_0x4985fc,_0x26da43)=>_0x4985fc+_0x26da43[_0x17335c(0x89)],0x0),_0xd0450d=_0x1c0a33[_0x17335c(0xd3)](_0x535ae7=>_0x535ae7[_0x17335c(0xf3)]===_0x17335c(0xe2))['reduce']((_0xcf5b6d,_0x5f0bd0)=>_0xcf5b6d+_0x5f0bd0[_0x17335c(0x89)],0x0),_0x52727e=_0x1c0a33[_0x17335c(0xd3)](_0x68edc9=>_0x68edc9[_0x17335c(0xf3)]==='PENDING')[_0x17335c(0x10f)]((_0x2e4ba0,_0x3c8ffd)=>_0x2e4ba0+_0x3c8ffd[_0x17335c(0x89)],0x0),_0x41e981=_0x1c0a33[_0x17335c(0x10f)]((_0x20d7fe,_0xd94949)=>{const _0x51c18c=_0x17335c;return _0x20d7fe[_0xd94949[_0x51c18c(0xe7)]]=(_0x20d7fe[_0xd94949[_0x51c18c(0xe7)]]||0x0)+0x1,_0x20d7fe;},{}),_0x455917=_0x1c0a33[_0x17335c(0x10f)]((_0x5d2849,_0x1823ef)=>{const _0x28aa4c=_0x17335c;return _0x5d2849[_0x1823ef[_0x28aa4c(0xf3)]]=(_0x5d2849[_0x1823ef[_0x28aa4c(0xf3)]]||0x0)+0x1,_0x5d2849;},{});return{'totalPayouts':_0x2a02c4,'completedPayouts':_0x481cb5,'pendingPayouts':_0x12206b,'rejectedPayouts':_0x45af08,'totalAmount':_0x466775,'completedAmount':_0xd0450d,'pendingAmount':_0x52727e,'payoutsByMethod':_0x41e981,'payoutsByStatus':_0x455917,'recentPayouts':_0xe79b17[_0x17335c(0xbf)](_0x12273d=>({'id':_0x12273d['id'],'shopId':_0xb9aa05,'amount':_0x12273d['amount'],'method':_0x12273d[_0x17335c(0xe7)],'status':_0x12273d[_0x17335c(0xf3)],'txid':_0x12273d[_0x17335c(0x141)],'createdAt':_0x12273d[_0x17335c(0x136)],'paidAt':_0x12273d['paidAt']}))};}async[a86_0x21e1a8(0x142)](_0x5ebec3){const _0x562a95=a86_0x21e1a8;console[_0x562a95(0x9e)](_0x562a95(0xa9)+_0x5ebec3+_0x562a95(0x150));const _0x50b58b=await database_1[_0x562a95(0x13b)][_0x562a95(0x11a)][_0x562a95(0xb3)]({'where':{'id':_0x5ebec3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x50b58b)throw new Error(_0x562a95(0x102));const _0x5bad38=new Date(),_0x20eb0e=new Date(_0x5bad38['getFullYear'](),_0x5bad38['getMonth'](),0x1),_0x421963=new Date(_0x5bad38[_0x562a95(0x12e)](),_0x5bad38['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3934e5=await database_1[_0x562a95(0x13b)][_0x562a95(0x83)][_0x562a95(0xe0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5ebec3,'createdAt':{'gte':_0x20eb0e,'lte':_0x421963},'status':'COMPLETED'}}),_0x380045=_0x3934e5[_0x562a95(0xe1)][_0x562a95(0x89)]||0x0,_0x5c4c0d={'availableBalance':Math[_0x562a95(0xb7)](_0x50b58b[_0x562a95(0xeb)]*0x64)/0x64,'totalPaidOut':Math[_0x562a95(0xb7)](_0x50b58b[_0x562a95(0xc6)]*0x64)/0x64,'awaitingPayout':Math[_0x562a95(0xb7)](_0x50b58b[_0x562a95(0xeb)]*0x64)/0x64,'thisMonth':Math['round'](_0x380045*0x64)/0x64};return console[_0x562a95(0x9e)](_0x562a95(0x99)+_0x50b58b['username']+'\x20payout\x20statistics\x20calculated:'),console[_0x562a95(0x9e)](_0x562a95(0x10b)+_0x5c4c0d[_0x562a95(0xc2)]+'\x20USDT\x20(current\x20balance)'),console['log'](_0x562a95(0x147)+_0x5c4c0d[_0x562a95(0xc6)]+'\x20USDT\x20(total\x20payouts)'),console['log'](_0x562a95(0xda)+_0x5c4c0d[_0x562a95(0x90)]+_0x562a95(0x106)),console[_0x562a95(0x9e)](_0x562a95(0x65)+_0x5c4c0d[_0x562a95(0x72)]+'\x20USDT'),_0x5c4c0d;}[a86_0x21e1a8(0xf0)](_0x57568b){const _0x22e6fe=a86_0x21e1a8,_0x505f31={'test_gateway':'Test\x20Gateway','plisio':_0x22e6fe(0xb6),'rapyd':_0x22e6fe(0x11b),'noda':_0x22e6fe(0x92),'cointopay':_0x22e6fe(0x80),'klyme_eu':_0x22e6fe(0xb8),'klyme_gb':_0x22e6fe(0x74),'klyme_de':_0x22e6fe(0xcc)};return _0x505f31[_0x57568b]||_0x57568b;}async[a86_0x21e1a8(0xe3)](_0x5d648d){const _0x5d610e=a86_0x21e1a8;return this[_0x5d610e(0x142)](_0x5d648d);}async[a86_0x21e1a8(0x110)](_0x1df8be,_0x103591){const _0x277771=a86_0x21e1a8,{page:_0x36de79,limit:_0x53deab,paymentId:_0x49e5ae}=_0x103591,_0x30ee2b=(_0x36de79-0x1)*_0x53deab,_0x5d3c30={'shopId':_0x1df8be};_0x49e5ae&&(_0x5d3c30[_0x277771(0xea)]=_0x49e5ae);const [_0x2156dd,_0x1a5584]=await Promise[_0x277771(0xd0)]([database_1[_0x277771(0x13b)][_0x277771(0x137)][_0x277771(0x117)]({'where':_0x5d3c30,'skip':_0x30ee2b,'take':_0x53deab,'orderBy':{'createdAt':_0x277771(0xa3)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x277771(0x13b)]['webhookLog'][_0x277771(0xed)]({'where':_0x5d3c30})]);return{'logs':_0x2156dd[_0x277771(0xbf)](_0x39adbd=>({'id':_0x39adbd['id'],'paymentId':_0x39adbd[_0x277771(0xea)],'shopId':_0x39adbd['shopId'],'event':_0x39adbd[_0x277771(0xf8)],'statusCode':_0x39adbd[_0x277771(0xf9)],'retryCount':_0x39adbd[_0x277771(0x9b)],'responseBody':_0x39adbd['responseBody'],'createdAt':_0x39adbd[_0x277771(0x136)],'payment':_0x39adbd['payment']})),'pagination':{'page':_0x36de79,'limit':_0x53deab,'total':_0x1a5584,'totalPages':Math[_0x277771(0x67)](_0x1a5584/_0x53deab)}};}async[a86_0x21e1a8(0xff)](_0x3d175f,_0x4be125,_0xfe3899,_0x50a392,_0x40986e){const _0x40b7e4=a86_0x21e1a8;console['log'](_0x40b7e4(0xe5)+_0x3d175f+',\x20period:\x20'+_0x4be125+_0x40b7e4(0xd4)+_0xfe3899+_0x40b7e4(0x87)+_0x50a392);const _0x4ce6be=_0x40986e?new Date(_0x40986e):new Date();let _0x52d68d,_0x146abf;if(_0xfe3899&&_0x50a392){const _0x25313=new Date(_0xfe3899),_0x4d323a=new Date(_0x50a392);_0x52d68d=new Date(Date['UTC'](_0x25313[_0x40b7e4(0x114)](),_0x25313[_0x40b7e4(0x71)](),_0x25313[_0x40b7e4(0xfb)](),0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x4d323a[_0x40b7e4(0x114)](),_0x4d323a[_0x40b7e4(0x71)](),_0x4d323a[_0x40b7e4(0xfb)](),0x17,0x3b,0x3b,0x3e7)),console[_0x40b7e4(0x9e)](_0x40b7e4(0xae)+_0x52d68d[_0x40b7e4(0x139)]()+_0x40b7e4(0x124)+_0x146abf['toISOString']());}else{if(_0x4be125&&_0x4be125[_0x40b7e4(0x145)]('custom_')){const _0x59d651=_0x4be125[_0x40b7e4(0x108)](_0x40b7e4(0x9c),'')['split']('_');if(_0x59d651[_0x40b7e4(0x128)]===0x2){const _0x1c634a=new Date(_0x59d651[0x0]),_0xeeba9e=new Date(_0x59d651[0x1]);_0x52d68d=new Date(Date['UTC'](_0x1c634a['getUTCFullYear'](),_0x1c634a[_0x40b7e4(0x71)](),_0x1c634a[_0x40b7e4(0xfb)](),0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date['UTC'](_0xeeba9e[_0x40b7e4(0x114)](),_0xeeba9e[_0x40b7e4(0x71)](),_0xeeba9e[_0x40b7e4(0xfb)](),0x17,0x3b,0x3b,0x3e7)),console[_0x40b7e4(0x9e)](_0x40b7e4(0x8c)+_0x52d68d[_0x40b7e4(0x139)]()+_0x40b7e4(0x124)+_0x146abf[_0x40b7e4(0x139)]());}else{const _0x582b19=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be['getUTCFullYear'](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)]()-0x1e));_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](_0x582b19[_0x40b7e4(0x114)](),_0x582b19['getUTCMonth'](),_0x582b19['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date['UTC'](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x4ad166=_0x4be125||_0x40b7e4(0xbb);switch(_0x4ad166['toLowerCase']()){case'today':_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be['getUTCFullYear'](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)](),0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x40b7e4(0x144):const _0x5c15c9=new Date(_0x4ce6be);_0x5c15c9[_0x40b7e4(0x12c)](_0x5c15c9[_0x40b7e4(0xfb)]()-0x1),_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](_0x5c15c9[_0x40b7e4(0x114)](),_0x5c15c9[_0x40b7e4(0x71)](),_0x5c15c9[_0x40b7e4(0xfb)](),0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date['UTC'](_0x5c15c9['getUTCFullYear'](),_0x5c15c9[_0x40b7e4(0x71)](),_0x5c15c9['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x40b7e4(0x8a):const _0x301955=_0x4ce6be[_0x40b7e4(0xa1)](),_0x3b7cdb=_0x301955===0x0?-0x6:0x1-_0x301955,_0x28c6e3=_0x4ce6be[_0x40b7e4(0xfb)]()+_0x3b7cdb;_0x52d68d=new Date(Date['UTC'](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x28c6e3,0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x40b7e4(0xfa):const _0x519dd0=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)]()-0x7)),_0x3a713c=_0x519dd0[_0x40b7e4(0xa1)](),_0xdc2559=_0x3a713c===0x0?-0x6:0x1-_0x3a713c,_0x17a7ed=_0x519dd0['getUTCDate']()+_0xdc2559;_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](_0x519dd0['getUTCFullYear'](),_0x519dd0['getUTCMonth'](),_0x17a7ed,0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x519dd0[_0x40b7e4(0x114)](),_0x519dd0[_0x40b7e4(0x71)](),_0x17a7ed+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x40b7e4(0xfd):_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be['getUTCFullYear'](),_0x4ce6be['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x40b7e4(0x8b):_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x52d68d=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),0x1,0x0,0x0,0x0,0x0)),_0x146abf=new Date(Date[_0x40b7e4(0x7b)](_0x4ce6be[_0x40b7e4(0x114)](),_0x4ce6be[_0x40b7e4(0x71)](),_0x4ce6be[_0x40b7e4(0xfb)](),0x17,0x3b,0x3b,0x3e7));}}}console[_0x40b7e4(0x9e)]('ðŸ“…\x20Final\x20date\x20range:\x20'+_0x52d68d[_0x40b7e4(0x139)]()+'\x20to\x20'+_0x146abf[_0x40b7e4(0x139)]());const _0x3ebf8d={'gte':_0x52d68d,'lte':_0x146abf},[_0x34f1e8,_0x37ce25,_0x5b00c6,_0x256717,_0x44291a,_0x5f4dd3,_0x298cc8,_0x5735ec,_0x277629,_0x2e9918,_0x28e2eb]=await Promise[_0x40b7e4(0xd0)]([database_1['default'][_0x40b7e4(0x95)][_0x40b7e4(0xed)]({'where':{'shopId':_0x3d175f,'gateway':{'not':'test_gateway'},'status':{'notIn':[_0x40b7e4(0x11e),'EXPIRED']},'createdAt':_0x3ebf8d}}),database_1[_0x40b7e4(0x13b)][_0x40b7e4(0x95)]['count']({'where':{'shopId':_0x3d175f,'gateway':{'not':_0x40b7e4(0x12f)},'status':_0x40b7e4(0xa2),'createdAt':_0x3ebf8d}}),database_1['default']['payment'][_0x40b7e4(0xed)]({'where':{'shopId':_0x3d175f,'gateway':{'not':_0x40b7e4(0x12f)},'status':'CHARGEBACK'}}),database_1[_0x40b7e4(0x13b)][_0x40b7e4(0x95)][_0x40b7e4(0xed)]({'where':{'shopId':_0x3d175f,'gateway':{'not':_0x40b7e4(0x12f)},'status':_0x40b7e4(0x122)}}),database_1[_0x40b7e4(0x13b)]['payment'][_0x40b7e4(0x117)]({'where':{'shopId':_0x3d175f,'gateway':{'not':_0x40b7e4(0x12f)},'status':_0x40b7e4(0xa2),'createdAt':_0x3ebf8d},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x40b7e4(0x13b)][_0x40b7e4(0x95)][_0x40b7e4(0x117)]({'where':{'shopId':_0x3d175f,'gateway':{'not':_0x40b7e4(0x12f)}},'take':0x4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x40b7e4(0x13b)][_0x40b7e4(0x95)][_0x40b7e4(0x117)]({'where':{'shopId':_0x3d175f,'gateway':{'not':_0x40b7e4(0x12f)},'createdAt':_0x3ebf8d},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x40b7e4(0xb0)}}),database_1[_0x40b7e4(0x13b)]['payment'][_0x40b7e4(0xed)]({'where':{'shopId':_0x3d175f,'gateway':{'not':'test_gateway'},'status':'PAID'}}),database_1[_0x40b7e4(0x13b)][_0x40b7e4(0x95)][_0x40b7e4(0x117)]({'where':{'shopId':_0x3d175f,'gateway':{'not':'test_gateway'},'status':_0x40b7e4(0xa2)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x40b7e4(0x13b)]['shop'][_0x40b7e4(0xb3)]({'where':{'id':_0x3d175f},'select':{'balance':!![]}}),database_1[_0x40b7e4(0x13b)][_0x40b7e4(0x95)][_0x40b7e4(0x117)]({'where':{'shopId':_0x3d175f,'gateway':{'not':_0x40b7e4(0x12f)}},'select':{'gateway':!![]}})]),_0x36f948={};for(const _0x12a408 of _0x28e2eb){_0x12a408[_0x40b7e4(0x10a)]&&(_0x36f948[_0x12a408[_0x40b7e4(0x10a)]]=(_0x36f948[_0x12a408[_0x40b7e4(0x10a)]]||0x0)+0x1);}console[_0x40b7e4(0x9e)](_0x40b7e4(0x10e),_0x36f948);let _0x268c3a=0x0,_0x154695=0x0;for(const _0x134923 of _0x44291a){if(_0x134923[_0x40b7e4(0xa8)])_0x268c3a+=_0x134923[_0x40b7e4(0xa8)];else{const _0x2dc15e=await currencyService_1['currencyService'][_0x40b7e4(0x6c)](_0x134923[_0x40b7e4(0x89)],_0x134923[_0x40b7e4(0x7e)]);_0x268c3a+=_0x2dc15e;}_0x134923[_0x40b7e4(0x133)]&&(_0x154695+=_0x134923['amountAfterGatewayCommissionUSDT']);}let _0x950e1f=0x0;for(const _0x46a363 of _0x277629){_0x46a363['amountAfterGatewayCommissionUSDT']&&(_0x950e1f+=_0x46a363[_0x40b7e4(0x133)]);}const _0x1ea680=this['generateDailyStatistics'](_0x298cc8,_0x52d68d,_0x146abf||_0x4ce6be),_0x425022=_0x34f1e8>0x0?_0x37ce25/_0x34f1e8*0x64:0x0,_0x461cbd=_0x5735ec>0x0?_0x5b00c6/_0x5735ec*0x64:0x0;return{'totalPayments':_0x34f1e8,'successfulPayments':_0x37ce25,'totalRevenue':Math[_0x40b7e4(0xb7)](_0x268c3a*0x64)/0x64,'merchantEarnings':Math[_0x40b7e4(0xb7)](_0x154695*0x64)/0x64,'merchantTotalRevenue':Math['round'](_0x950e1f*0x64)/0x64,'payoutBalance':Math[_0x40b7e4(0xb7)]((_0x2e9918?.[_0x40b7e4(0xeb)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x40b7e4(0xb7)](_0x425022*0x64)/0x64,'chargebackRate':Math['round'](_0x461cbd*0x64)/0x64,'chargebacks':_0x5b00c6,'refunds':_0x256717,'paymentsByGateway':_0x36f948,'dailyRevenue':_0x1ea680[_0x40b7e4(0x6d)],'dailyPayments':_0x1ea680[_0x40b7e4(0xc0)],'recentPayments':_0x5f4dd3[_0x40b7e4(0xbf)](_0x2585cb=>({'id':_0x2585cb['id'],'gateway':_0x2585cb[_0x40b7e4(0x10a)],'amount':_0x2585cb['amount'],'currency':_0x2585cb[_0x40b7e4(0x7e)],'status':_0x2585cb['status'],'createdAt':_0x2585cb['createdAt']}))};}[a86_0x21e1a8(0x8f)](_0x28e1db,_0x2a3583,_0x4faab9){const _0x3075c2=a86_0x21e1a8,_0x4bab21=new Map(),_0x59f68c=new Date(_0x2a3583);while(_0x59f68c<=_0x4faab9){const _0x4b8119=_0x59f68c[_0x3075c2(0x139)]()['split']('T')[0x0];_0x4bab21[_0x3075c2(0x12b)](_0x4b8119,{'revenue':0x0,'count':0x0}),_0x59f68c[_0x3075c2(0x86)](_0x59f68c['getDate']()+0x1);}for(const _0x3484a0 of _0x28e1db){const _0x308420=_0x3484a0[_0x3075c2(0x136)][_0x3075c2(0x139)]()[_0x3075c2(0x11f)]('T')[0x0],_0x356a03=_0x4bab21['get'](_0x308420);_0x356a03&&(_0x356a03['count']+=0x1,_0x3484a0[_0x3075c2(0xf3)]==='PAID'&&_0x3484a0['amountUSDT']&&(_0x356a03['revenue']+=_0x3484a0[_0x3075c2(0xa8)]));}const _0x488a29=[],_0x20900c=[];for(const [_0x11ce48,_0x264b9d]of _0x4bab21){_0x488a29['push']({'date':_0x11ce48,'amount':Math[_0x3075c2(0xb7)](_0x264b9d[_0x3075c2(0x111)]*0x64)/0x64}),_0x20900c[_0x3075c2(0xa6)]({'date':_0x11ce48,'count':_0x264b9d[_0x3075c2(0xed)]});}return{'dailyRevenue':_0x488a29,'dailyPayments':_0x20900c};}[a86_0x21e1a8(0x127)](_0x3cd5b5=0x8){const _0x47ed56=a86_0x21e1a8,_0x232f98=[];for(let _0xcabb92=0x0;_0xcabb92<_0x3cd5b5;_0xcabb92++){const _0x3eb808=crypto_1[_0x47ed56(0x13b)][_0x47ed56(0x123)](0x4)['toString'](_0x47ed56(0xca))['toUpperCase']();_0x232f98[_0x47ed56(0xa6)](_0x3eb808);}return _0x232f98;}async['setup2FA'](_0x36f018){const _0x20493f=a86_0x21e1a8,_0x4c31e7=await database_1['default'][_0x20493f(0x11a)][_0x20493f(0xb3)]({'where':{'id':_0x36f018},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4c31e7)throw new Error(_0x20493f(0x102));const _0x58bf8b=speakeasy_1[_0x20493f(0x13b)]['generateSecret']({'name':_0x20493f(0x126)+_0x4c31e7[_0x20493f(0xdb)]+')','issuer':_0x20493f(0xdf),'length':0x20}),_0x1c398a=await qrcode_1[_0x20493f(0x13b)][_0x20493f(0x73)](_0x58bf8b[_0x20493f(0x82)]),_0x1ad088=this[_0x20493f(0x127)](0x8),_0x4c7574=await Promise['all'](_0x1ad088['map'](_0x3798da=>bcryptjs_1['default'][_0x20493f(0xd1)](_0x3798da,0xa)));return await database_1['default'][_0x20493f(0x11a)][_0x20493f(0xb9)]({'where':{'id':_0x36f018},'data':{'twoFactorSecret':_0x58bf8b[_0x20493f(0xe6)],'backupCodes':JSON[_0x20493f(0x13f)](_0x4c7574)}}),console[_0x20493f(0x9e)](_0x20493f(0xbc)+_0x4c31e7[_0x20493f(0xdb)]),console[_0x20493f(0x9e)](_0x20493f(0x135)+_0x1ad088[_0x20493f(0x128)]+_0x20493f(0xf5)),{'secret':_0x58bf8b[_0x20493f(0xe6)],'qrCode':_0x1c398a,'manualEntryKey':_0x58bf8b['base32'],'backupCodes':_0x1ad088};}async['enable2FA'](_0x528c03,_0x232da0){const _0x1d7c93=a86_0x21e1a8,_0x1900f3=await database_1[_0x1d7c93(0x13b)]['shop'][_0x1d7c93(0xb3)]({'where':{'id':_0x528c03},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x1900f3)throw new Error(_0x1d7c93(0x102));if(!_0x1900f3[_0x1d7c93(0xfe)])throw new Error(_0x1d7c93(0xf4));if(_0x1900f3[_0x1d7c93(0x105)])throw new Error(_0x1d7c93(0x103));const _0x3ca61d=speakeasy_1[_0x1d7c93(0x13b)][_0x1d7c93(0x13e)][_0x1d7c93(0x101)]({'secret':_0x1900f3[_0x1d7c93(0xfe)],'encoding':_0x1d7c93(0xe6),'token':_0x232da0,'window':0x2});if(!_0x3ca61d)throw new Error(_0x1d7c93(0xf7));return await database_1[_0x1d7c93(0x13b)]['shop'][_0x1d7c93(0xb9)]({'where':{'id':_0x528c03},'data':{'twoFactorEnabled':!![]}}),console[_0x1d7c93(0x9e)](_0x1d7c93(0x84)+_0x1900f3[_0x1d7c93(0xdb)]),{'enabled':!![]};}async[a86_0x21e1a8(0x69)](_0x3ef1f8){const _0x3cb014=a86_0x21e1a8,_0x27d526=await database_1[_0x3cb014(0x13b)][_0x3cb014(0x11a)][_0x3cb014(0xb3)]({'where':{'id':_0x3ef1f8},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x27d526)throw new Error('Shop\x20not\x20found');await database_1[_0x3cb014(0x13b)][_0x3cb014(0x11a)][_0x3cb014(0xb9)]({'where':{'id':_0x3ef1f8},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log'](_0x3cb014(0xce)+_0x27d526[_0x3cb014(0xdb)]);}}exports[a86_0x21e1a8(0xcf)]=ShopService;