'use strict';const a56_0x859e69=a56_0x34b7;(function(_0x1a5c37,_0x319dc6){const _0x32bec8=a56_0x34b7,_0x5807a8=_0x1a5c37();while(!![]){try{const _0x50682e=parseInt(_0x32bec8(0x14a))/0x1*(parseInt(_0x32bec8(0x19f))/0x2)+parseInt(_0x32bec8(0x1ec))/0x3*(-parseInt(_0x32bec8(0x1a0))/0x4)+parseInt(_0x32bec8(0x14c))/0x5+parseInt(_0x32bec8(0x1cb))/0x6*(-parseInt(_0x32bec8(0x194))/0x7)+-parseInt(_0x32bec8(0x16d))/0x8+parseInt(_0x32bec8(0x1c0))/0x9+parseInt(_0x32bec8(0x18f))/0xa*(parseInt(_0x32bec8(0x1b3))/0xb);if(_0x50682e===_0x319dc6)break;else _0x5807a8['push'](_0x5807a8['shift']());}catch(_0x8e4874){_0x5807a8['push'](_0x5807a8['shift']());}}}(a56_0x3150,0x1ca71));function a56_0x3150(){const _0x198187=['stringify','network','all','telegramId','POST','gateways','retryCount','toISOString','1838328vogedJ','getPayoutStats','deletePayment','status','push','username','USDC\x20Polygon','toUpperCase','payment','CoinToPay','createdAt','getPayouts','getFullYear','Unknown\x20error','periodFrom','test','setHours','KLYME\x20GB','30d','üìÖ\x20Date\x20start:\x20','shopId','ceil','getDate','Plisio','\x20USDT\x20(total\x20payouts)','polygon_usdc','amountUSDT','paymentService','üåê\x20Network\x20filter:\x20','customerName','getStatistics','count','updateShopProfile','__importDefault','6070vsMXMa','Error\x20parsing\x20webhook\x20events:','redirectUrl','KLYME\x20EU','dailyRevenue','49npVwNd','usdcPolygonWallet','Rapyd','merchantUrl','./paymentService','name','paymentId','getPayoutStatistics','_sum','generateDailyStatistics','round','6sLHcyb','2428tqZpnL','event','desc','set','Test\x20webhook\x20sent\x20successfully\x20(','createPublicPayment','gte','parse','getPaymentByShopAndId','getShopPayoutStats','test_gateway','wallets','lte','delete','amount','customer','Noda','üí∞\x20Getting\x20payouts\x20with\x20filters:','USD','2761paMkRI','map','currency','COMPLETED','responseBody','availableBalance','txid','country','findFirst','ShopService','expiresAt','publicKey','updateWallets','387450MHSljy','reduce','shop','telegram','statusCode','\x20\x20\x20üíµ\x20Available\x20balance:\x20','üìÖ\x20Date\x20end:\x20','PAID','notes','Payment\x20not\x20found','\x20payout\x20statistics\x20calculated:','71034wnVCKL','message','getPaymentById','USDT\x20BSC','default','usage','shopUrl','language','findMany','üåê\x20Method\x20filter:\x20','awaitingPayout','PENDING','statusText','webhookLog','findUnique','üìä\x20Final\x20WHERE\x20conditions:','üìÖ\x20Period\x20start:\x20','filter','balance','log','test_payment_123','error','settings','REJECTED','üìÖ\x20Period\x20end:\x20','Shop\x20not\x20found','webhookUrl','formatNetworkName','usdtTrcWallet','paidAt','defineProperty','Test\x20Gateway','fullName','417LkCkiM','\x20USDT\x20(current\x20balance)','\x20USDT','Webhook\x20returned\x20error:\x20','getShopProfile','No\x20webhook\x20URL\x20configured','updatePayment','get','revenue','75241BIbGcj','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','466340nyDnVL','split','totalPaidOut','erc20','getTime','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','paymentGateways','TesSoft\x20Payment\x20System/1.0\x20(Test)','paid','USDT\x20TRC20','payout','usdtPolygonWallet','PaymentService','getGatewayDisplayName','usdtErcWallet','\x20\x20\x20üìÖ\x20This\x20month:\x20','90d','update','__esModule','gatewaySettings','KLYME\x20DE','aggregate','webhookEvents','currencyService','gateway'];a56_0x3150=function(){return _0x198187;};return a56_0x3150();}var __importDefault=this&&this[a56_0x859e69(0x18e)]||function(_0x23d059){const _0x16e00b=a56_0x859e69;return _0x23d059&&_0x23d059[_0x16e00b(0x15e)]?_0x23d059:{'default':_0x23d059};};function a56_0x34b7(_0x4fe927,_0x21e3f1){const _0x3150a9=a56_0x3150();return a56_0x34b7=function(_0x34b75f,_0x22442e){_0x34b75f=_0x34b75f-0x146;let _0x3aee19=_0x3150a9[_0x34b75f];return _0x3aee19;},a56_0x34b7(_0x4fe927,_0x21e3f1);}Object[a56_0x859e69(0x1e9)](exports,'__esModule',{'value':!![]}),exports[a56_0x859e69(0x1bc)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require('./currencyService'),paymentService_1=require(a56_0x859e69(0x198));class ShopService{constructor(){const _0x21266d=a56_0x859e69;this[_0x21266d(0x188)]=new paymentService_1[(_0x21266d(0x158))]();}async[a56_0x859e69(0x1f0)](_0x311875){const _0x33c299=a56_0x859e69,_0x2616e7=await database_1[_0x33c299(0x1cf)][_0x33c299(0x1c2)][_0x33c299(0x1d9)]({'where':{'id':_0x311875},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2616e7)throw new Error(_0x33c299(0x1e4));let _0x1cd088=[];if(_0x2616e7[_0x33c299(0x1e1)]?.[_0x33c299(0x162)])try{_0x1cd088=Array['isArray'](_0x2616e7[_0x33c299(0x1e1)][_0x33c299(0x162)])?_0x2616e7[_0x33c299(0x1e1)][_0x33c299(0x162)]:JSON[_0x33c299(0x1a7)](_0x2616e7[_0x33c299(0x1e1)][_0x33c299(0x162)]);}catch(_0x4a04ae){console[_0x33c299(0x1e0)]('Error\x20parsing\x20webhook\x20events:',_0x4a04ae),_0x1cd088=[];}return{'id':_0x2616e7['id'],'fullName':_0x2616e7[_0x33c299(0x199)],'username':_0x2616e7['username'],'telegramId':_0x2616e7[_0x33c299(0x1c3)],'merchantUrl':_0x2616e7['shopUrl'],'gateways':_0x2616e7[_0x33c299(0x152)]?JSON[_0x33c299(0x1a7)](_0x2616e7[_0x33c299(0x152)]):null,'gatewaySettings':_0x2616e7[_0x33c299(0x15f)]?JSON[_0x33c299(0x1a7)](_0x2616e7[_0x33c299(0x15f)]):null,'publicKey':_0x2616e7[_0x33c299(0x1be)],'webhookUrl':_0x2616e7[_0x33c299(0x1e1)]?.['webhookUrl']||null,'webhookEvents':_0x1cd088,'wallets':{'usdtPolygonWallet':_0x2616e7['usdtPolygonWallet'],'usdtTrcWallet':_0x2616e7[_0x33c299(0x1e7)],'usdtErcWallet':_0x2616e7[_0x33c299(0x15a)],'usdcPolygonWallet':_0x2616e7[_0x33c299(0x195)]},'status':_0x2616e7[_0x33c299(0x170)],'createdAt':_0x2616e7[_0x33c299(0x177)]};}async[a56_0x859e69(0x18d)](_0x1b1fbe,_0x23bfea){const _0x3257db=a56_0x859e69,_0x1508fb={};_0x23bfea[_0x3257db(0x1eb)]&&(_0x1508fb[_0x3257db(0x199)]=_0x23bfea['fullName']);_0x23bfea[_0x3257db(0x168)]!==undefined&&(_0x1508fb[_0x3257db(0x1c3)]=_0x23bfea[_0x3257db(0x168)]||null);_0x23bfea[_0x3257db(0x197)]&&(_0x1508fb[_0x3257db(0x1d1)]=_0x23bfea[_0x3257db(0x197)]);_0x23bfea[_0x3257db(0x16a)]&&(_0x1508fb[_0x3257db(0x152)]=JSON[_0x3257db(0x165)](_0x23bfea['gateways']));_0x23bfea[_0x3257db(0x15f)]&&(_0x1508fb[_0x3257db(0x15f)]=JSON['stringify'](_0x23bfea[_0x3257db(0x15f)]));_0x23bfea[_0x3257db(0x1ab)]&&(_0x23bfea[_0x3257db(0x1ab)][_0x3257db(0x157)]!==undefined&&(_0x1508fb[_0x3257db(0x157)]=_0x23bfea[_0x3257db(0x1ab)][_0x3257db(0x157)]||null),_0x23bfea[_0x3257db(0x1ab)][_0x3257db(0x1e7)]!==undefined&&(_0x1508fb[_0x3257db(0x1e7)]=_0x23bfea[_0x3257db(0x1ab)][_0x3257db(0x1e7)]||null),_0x23bfea['wallets'][_0x3257db(0x15a)]!==undefined&&(_0x1508fb['usdtErcWallet']=_0x23bfea[_0x3257db(0x1ab)][_0x3257db(0x15a)]||null),_0x23bfea[_0x3257db(0x1ab)]['usdcPolygonWallet']!==undefined&&(_0x1508fb['usdcPolygonWallet']=_0x23bfea['wallets'][_0x3257db(0x195)]||null));const _0x221b3e=await database_1[_0x3257db(0x1cf)]['shop'][_0x3257db(0x15d)]({'where':{'id':_0x1b1fbe},'data':_0x1508fb,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x582681=[];if(_0x221b3e['settings']?.[_0x3257db(0x162)])try{_0x582681=Array['isArray'](_0x221b3e[_0x3257db(0x1e1)][_0x3257db(0x162)])?_0x221b3e[_0x3257db(0x1e1)][_0x3257db(0x162)]:JSON['parse'](_0x221b3e[_0x3257db(0x1e1)][_0x3257db(0x162)]);}catch(_0x9b467a){console[_0x3257db(0x1e0)](_0x3257db(0x190),_0x9b467a),_0x582681=[];}return{'id':_0x221b3e['id'],'fullName':_0x221b3e['name'],'username':_0x221b3e[_0x3257db(0x172)],'telegramId':_0x221b3e[_0x3257db(0x1c3)],'merchantUrl':_0x221b3e[_0x3257db(0x1d1)],'gateways':_0x221b3e[_0x3257db(0x152)]?JSON[_0x3257db(0x1a7)](_0x221b3e[_0x3257db(0x152)]):null,'gatewaySettings':_0x221b3e[_0x3257db(0x15f)]?JSON[_0x3257db(0x1a7)](_0x221b3e['gatewaySettings']):null,'publicKey':_0x221b3e[_0x3257db(0x1be)],'webhookUrl':_0x221b3e[_0x3257db(0x1e1)]?.[_0x3257db(0x1e5)]||null,'webhookEvents':_0x582681,'wallets':{'usdtPolygonWallet':_0x221b3e[_0x3257db(0x157)],'usdtTrcWallet':_0x221b3e[_0x3257db(0x1e7)],'usdtErcWallet':_0x221b3e['usdtErcWallet'],'usdcPolygonWallet':_0x221b3e[_0x3257db(0x195)]},'status':_0x221b3e[_0x3257db(0x170)],'createdAt':_0x221b3e[_0x3257db(0x177)]};}async[a56_0x859e69(0x1bf)](_0x2255f1,_0x16d0b6){const _0xc5f525=a56_0x859e69,_0x1af3ad={};_0x16d0b6[_0xc5f525(0x157)]!==undefined&&(_0x1af3ad[_0xc5f525(0x157)]=_0x16d0b6[_0xc5f525(0x157)]||null),_0x16d0b6['usdtTrcWallet']!==undefined&&(_0x1af3ad[_0xc5f525(0x1e7)]=_0x16d0b6['usdtTrcWallet']||null),_0x16d0b6[_0xc5f525(0x15a)]!==undefined&&(_0x1af3ad[_0xc5f525(0x15a)]=_0x16d0b6['usdtErcWallet']||null),_0x16d0b6[_0xc5f525(0x195)]!==undefined&&(_0x1af3ad[_0xc5f525(0x195)]=_0x16d0b6['usdcPolygonWallet']||null),await database_1[_0xc5f525(0x1cf)][_0xc5f525(0x1c2)][_0xc5f525(0x15d)]({'where':{'id':_0x2255f1},'data':_0x1af3ad});}async['testWebhook'](_0x259305){const _0x56568a=a56_0x859e69,_0x35784a=await database_1[_0x56568a(0x1cf)]['shop'][_0x56568a(0x1d9)]({'where':{'id':_0x259305},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x35784a?.['settings']?.[_0x56568a(0x1e5)])throw new Error(_0x56568a(0x146));const _0x249f29={'event':_0x56568a(0x17c),'payment':{'id':_0x56568a(0x1df),'order_id':'test_order_123','gateway':_0x56568a(0x17c),'amount':0x64,'currency':_0x56568a(0x1b2),'status':_0x56568a(0x154),'created_at':new Date()[_0x56568a(0x16c)]()}};try{const _0x8bdbf2=await fetch(_0x35784a[_0x56568a(0x1e1)]['webhookUrl'],{'method':_0x56568a(0x169),'headers':{'Content-Type':'application/json','User-Agent':_0x56568a(0x153)},'body':JSON['stringify'](_0x249f29)});return _0x8bdbf2['ok']?{'success':!![],'message':_0x56568a(0x1a4)+_0x8bdbf2[_0x56568a(0x170)]+')'}:{'success':![],'message':_0x56568a(0x1ef)+_0x8bdbf2['status']+'\x20'+_0x8bdbf2[_0x56568a(0x1d7)]};}catch(_0x166222){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x166222 instanceof Error?_0x166222[_0x56568a(0x1cc)]:_0x56568a(0x17a))};}}async['createPayment'](_0x14bde3){const _0x61bfd5=a56_0x859e69;return this[_0x61bfd5(0x188)][_0x61bfd5(0x1a5)]({'public_key':'','gateway':_0x14bde3[_0x61bfd5(0x164)],'order_id':undefined,'amount':_0x14bde3[_0x61bfd5(0x1ae)],'currency':_0x14bde3[_0x61bfd5(0x1b5)],'source_currency':_0x14bde3['sourceCurrency'],'usage':_0x14bde3[_0x61bfd5(0x1d0)],'expires_at':_0x14bde3[_0x61bfd5(0x1bd)]?.['toISOString'](),'success_url':_0x14bde3[_0x61bfd5(0x191)],'fail_url':_0x14bde3[_0x61bfd5(0x191)],'customer_email':_0x14bde3['customerEmail'],'customer_name':_0x14bde3[_0x61bfd5(0x18a)],'country':_0x14bde3[_0x61bfd5(0x1ba)],'language':_0x14bde3[_0x61bfd5(0x1d2)],'amount_is_editable':_0x14bde3['amountIsEditable'],'max_payments':_0x14bde3['maxPayments'],'customer':_0x14bde3[_0x61bfd5(0x1af)]});}async['getPayments'](_0x32e816,_0x388f34){const _0x460eeb=a56_0x859e69;return this[_0x460eeb(0x188)]['getPaymentsByShop'](_0x32e816,_0x388f34);}async[a56_0x859e69(0x1cd)](_0x9b75ab,_0x41a694){const _0x281115=a56_0x859e69;return this['paymentService'][_0x281115(0x1a8)](_0x9b75ab,_0x41a694);}async[a56_0x859e69(0x147)](_0x502a0a,_0xbe675d,_0x33d2b4){const _0x5206b4=a56_0x859e69,_0x32a69c=await database_1['default'][_0x5206b4(0x175)]['findFirst']({'where':{'id':_0xbe675d,'shopId':_0x502a0a}});if(!_0x32a69c)throw new Error(_0x5206b4(0x1c9));const _0x54cb42=await database_1[_0x5206b4(0x1cf)][_0x5206b4(0x175)][_0x5206b4(0x15d)]({'where':{'id':_0xbe675d},'data':{..._0x33d2b4,'updatedAt':new Date()}});return _0x54cb42;}async[a56_0x859e69(0x16f)](_0x2a416f,_0x2a41c5){const _0x2d91fc=a56_0x859e69,_0x2dd8e8=await database_1['default'][_0x2d91fc(0x175)][_0x2d91fc(0x1bb)]({'where':{'id':_0x2a41c5,'shopId':_0x2a416f}});if(!_0x2dd8e8)throw new Error(_0x2d91fc(0x1c9));await database_1[_0x2d91fc(0x1cf)][_0x2d91fc(0x175)][_0x2d91fc(0x1ad)]({'where':{'id':_0x2a41c5}});}[a56_0x859e69(0x1e6)](_0xca1a53){const _0x20c9f1=a56_0x859e69,_0x2a14d3={'polygon':'USDT\x20Polygon','trc20':_0x20c9f1(0x155),'erc20':'USDT\x20ERC20','bsc':_0x20c9f1(0x1ce),'polygon_usdc':_0x20c9f1(0x173)};return _0x2a14d3[_0xca1a53]||_0xca1a53;}async[a56_0x859e69(0x178)](_0xc5bbf,_0x49459f){const _0x1abc38=a56_0x859e69,{page:_0x5b8f87,limit:_0x3b3ce7,status:_0x51b413,method:_0x20f2fb,network:_0x30675,dateFrom:_0x3d5a3f,dateTo:_0x1b2e62,periodFrom:_0x45b3f8,periodTo:_0x4f91ec}=_0x49459f,_0x112fb2=(_0x5b8f87-0x1)*_0x3b3ce7;console[_0x1abc38(0x1de)](_0x1abc38(0x1b1),_0x49459f);const _0x518443={'shopId':_0xc5bbf};_0x51b413&&(_0x518443[_0x1abc38(0x170)]=_0x51b413['toUpperCase'](),console[_0x1abc38(0x1de)]('üìä\x20Status\x20filter:\x20'+_0x51b413[_0x1abc38(0x174)]()));if(_0x20f2fb)_0x518443[_0x1abc38(0x166)]=_0x20f2fb,console[_0x1abc38(0x1de)](_0x1abc38(0x1d4)+_0x20f2fb);else _0x30675&&(_0x518443[_0x1abc38(0x166)]=_0x30675,console[_0x1abc38(0x1de)](_0x1abc38(0x189)+_0x30675));if(_0x3d5a3f||_0x1b2e62||_0x45b3f8||_0x4f91ec){_0x518443[_0x1abc38(0x177)]={};if(_0x45b3f8){const _0x487a96=new Date(_0x45b3f8);_0x487a96['setHours'](0x0,0x0,0x0,0x0),_0x518443[_0x1abc38(0x177)][_0x1abc38(0x1a6)]=_0x487a96,console[_0x1abc38(0x1de)](_0x1abc38(0x1db)+_0x487a96[_0x1abc38(0x16c)]());}else{if(_0x3d5a3f){const _0x334829=new Date(_0x3d5a3f);_0x334829['setHours'](0x0,0x0,0x0,0x0),_0x518443[_0x1abc38(0x177)][_0x1abc38(0x1a6)]=_0x334829,console[_0x1abc38(0x1de)](_0x1abc38(0x180)+_0x334829[_0x1abc38(0x16c)]());}}if(_0x4f91ec){const _0x5c9e00=new Date(_0x4f91ec);_0x5c9e00[_0x1abc38(0x17d)](0x17,0x3b,0x3b,0x3e7),_0x518443[_0x1abc38(0x177)][_0x1abc38(0x1ac)]=_0x5c9e00,console[_0x1abc38(0x1de)](_0x1abc38(0x1e3)+_0x5c9e00[_0x1abc38(0x16c)]());}else{if(_0x1b2e62){const _0x117fd6=new Date(_0x1b2e62);_0x117fd6[_0x1abc38(0x17d)](0x17,0x3b,0x3b,0x3e7),_0x518443[_0x1abc38(0x177)]['lte']=_0x117fd6,console[_0x1abc38(0x1de)](_0x1abc38(0x1c6)+_0x117fd6[_0x1abc38(0x16c)]());}}}console['log'](_0x1abc38(0x1da),JSON[_0x1abc38(0x165)](_0x518443,null,0x2));const [_0x10ab51,_0x192179]=await Promise[_0x1abc38(0x167)]([database_1['default'][_0x1abc38(0x156)][_0x1abc38(0x1d3)]({'where':_0x518443,'skip':_0x112fb2,'take':_0x3b3ce7,'orderBy':{'createdAt':_0x1abc38(0x1a2)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x1abc38(0x1cf)][_0x1abc38(0x156)][_0x1abc38(0x18c)]({'where':_0x518443})]);return{'payouts':_0x10ab51['map'](_0x105cda=>{const _0x412e6e=_0x1abc38;let _0x34f67b=null;switch(_0x105cda[_0x412e6e(0x166)]){case'polygon':_0x34f67b=_0x105cda[_0x412e6e(0x1c2)][_0x412e6e(0x157)];break;case'trc20':_0x34f67b=_0x105cda[_0x412e6e(0x1c2)][_0x412e6e(0x1e7)];break;case _0x412e6e(0x14f):_0x34f67b=_0x105cda[_0x412e6e(0x1c2)]['usdtErcWallet'];break;case _0x412e6e(0x186):_0x34f67b=_0x105cda[_0x412e6e(0x1c2)][_0x412e6e(0x195)];break;}return{'id':_0x105cda['id'],'amount':_0x105cda['amount'],'network':this[_0x412e6e(0x1e6)](_0x105cda[_0x412e6e(0x166)]),'wallet':_0x34f67b,'status':_0x105cda[_0x412e6e(0x170)],'txid':_0x105cda[_0x412e6e(0x1b9)],'notes':_0x105cda['notes'],'periodFrom':_0x105cda[_0x412e6e(0x17b)],'periodTo':_0x105cda['periodTo'],'createdAt':_0x105cda[_0x412e6e(0x177)],'paidAt':_0x105cda['paidAt']};}),'pagination':{'page':_0x5b8f87,'limit':_0x3b3ce7,'total':_0x192179,'totalPages':Math[_0x1abc38(0x182)](_0x192179/_0x3b3ce7)}};}async['getPayoutById'](_0x9d7abc,_0x19e0e2){const _0x3ba972=a56_0x859e69,_0x45983f=await database_1[_0x3ba972(0x1cf)][_0x3ba972(0x156)][_0x3ba972(0x1bb)]({'where':{'id':_0x19e0e2,'shopId':_0x9d7abc}});if(!_0x45983f)return null;return{'id':_0x45983f['id'],'amount':_0x45983f[_0x3ba972(0x1ae)],'network':_0x45983f[_0x3ba972(0x166)],'status':_0x45983f['status'],'txid':_0x45983f[_0x3ba972(0x1b9)],'notes':_0x45983f[_0x3ba972(0x1c8)],'createdAt':_0x45983f[_0x3ba972(0x177)],'paidAt':_0x45983f[_0x3ba972(0x1e8)]};}async[a56_0x859e69(0x19b)](_0x1be05a,_0x4afc03){const _0x3e59b4=a56_0x859e69,_0x4569d3=new Date();let _0x4d36ef;switch(_0x4afc03){case'7d':_0x4d36ef=new Date(_0x4569d3[_0x3e59b4(0x150)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3e59b4(0x17f):_0x4d36ef=new Date(_0x4569d3[_0x3e59b4(0x150)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3e59b4(0x15c):_0x4d36ef=new Date(_0x4569d3[_0x3e59b4(0x150)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4d36ef=new Date(_0x4569d3[_0x3e59b4(0x150)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x580db0,_0x2cb46e,_0x3b53d3,_0x3a4843,_0x5337e9,_0x13fb36]=await Promise[_0x3e59b4(0x167)]([database_1[_0x3e59b4(0x1cf)][_0x3e59b4(0x156)][_0x3e59b4(0x18c)]({'where':{'shopId':_0x1be05a,'createdAt':{'gte':_0x4d36ef}}}),database_1[_0x3e59b4(0x1cf)][_0x3e59b4(0x156)][_0x3e59b4(0x18c)]({'where':{'shopId':_0x1be05a,'status':_0x3e59b4(0x1b6),'createdAt':{'gte':_0x4d36ef}}}),database_1[_0x3e59b4(0x1cf)][_0x3e59b4(0x156)][_0x3e59b4(0x18c)]({'where':{'shopId':_0x1be05a,'status':'PENDING','createdAt':{'gte':_0x4d36ef}}}),database_1['default']['payout'][_0x3e59b4(0x18c)]({'where':{'shopId':_0x1be05a,'status':_0x3e59b4(0x1e2),'createdAt':{'gte':_0x4d36ef}}}),database_1['default'][_0x3e59b4(0x156)][_0x3e59b4(0x1d3)]({'where':{'shopId':_0x1be05a,'createdAt':{'gte':_0x4d36ef}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x3e59b4(0x1cf)]['payout'][_0x3e59b4(0x1d3)]({'where':{'shopId':_0x1be05a},'take':0xa,'orderBy':{'createdAt':_0x3e59b4(0x1a2)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x1d402f=_0x5337e9[_0x3e59b4(0x1c1)]((_0x1e987f,_0x12b67d)=>_0x1e987f+_0x12b67d[_0x3e59b4(0x1ae)],0x0),_0x639b05=_0x5337e9[_0x3e59b4(0x1dc)](_0x4b7e8a=>_0x4b7e8a[_0x3e59b4(0x170)]===_0x3e59b4(0x1b6))['reduce']((_0x2be7df,_0x5ec406)=>_0x2be7df+_0x5ec406[_0x3e59b4(0x1ae)],0x0),_0x7dd7b0=_0x5337e9['filter'](_0x2a2875=>_0x2a2875[_0x3e59b4(0x170)]===_0x3e59b4(0x1d6))[_0x3e59b4(0x1c1)]((_0x1ef43d,_0x4efd2d)=>_0x1ef43d+_0x4efd2d[_0x3e59b4(0x1ae)],0x0),_0x20e294=_0x5337e9[_0x3e59b4(0x1c1)]((_0x128a8c,_0x42a2ae)=>{const _0x2b8fea=_0x3e59b4;return _0x128a8c[_0x42a2ae[_0x2b8fea(0x166)]]=(_0x128a8c[_0x42a2ae[_0x2b8fea(0x166)]]||0x0)+0x1,_0x128a8c;},{}),_0x197608=_0x5337e9[_0x3e59b4(0x1c1)]((_0x295c31,_0x4d6276)=>{return _0x295c31[_0x4d6276['status']]=(_0x295c31[_0x4d6276['status']]||0x0)+0x1,_0x295c31;},{});return{'totalPayouts':_0x580db0,'completedPayouts':_0x2cb46e,'pendingPayouts':_0x3b53d3,'rejectedPayouts':_0x3a4843,'totalAmount':_0x1d402f,'completedAmount':_0x639b05,'pendingAmount':_0x7dd7b0,'payoutsByMethod':_0x20e294,'payoutsByStatus':_0x197608,'recentPayouts':_0x13fb36[_0x3e59b4(0x1b4)](_0x5c8633=>({'id':_0x5c8633['id'],'shopId':_0x1be05a,'amount':_0x5c8633[_0x3e59b4(0x1ae)],'method':_0x5c8633[_0x3e59b4(0x166)],'status':_0x5c8633['status'],'txid':_0x5c8633[_0x3e59b4(0x1b9)],'createdAt':_0x5c8633['createdAt'],'paidAt':_0x5c8633[_0x3e59b4(0x1e8)]}))};}async[a56_0x859e69(0x1a9)](_0x10dd02){const _0x2ec1f9=a56_0x859e69;console['log'](_0x2ec1f9(0x14b)+_0x10dd02+'...');const _0xbaa2=await database_1[_0x2ec1f9(0x1cf)][_0x2ec1f9(0x1c2)][_0x2ec1f9(0x1d9)]({'where':{'id':_0x10dd02},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xbaa2)throw new Error(_0x2ec1f9(0x1e4));const _0xfa948f=new Date(),_0x286fa2=new Date(_0xfa948f[_0x2ec1f9(0x179)](),_0xfa948f['getMonth'](),0x1),_0x3f51db=new Date(_0xfa948f['getFullYear'](),_0xfa948f['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x44f78d=await database_1['default'][_0x2ec1f9(0x156)][_0x2ec1f9(0x161)]({'_sum':{'amount':!![]},'where':{'shopId':_0x10dd02,'createdAt':{'gte':_0x286fa2,'lte':_0x3f51db},'status':'COMPLETED'}}),_0x465850=_0x44f78d[_0x2ec1f9(0x19c)][_0x2ec1f9(0x1ae)]||0x0,_0x57ae95={'availableBalance':Math['round'](_0xbaa2[_0x2ec1f9(0x1dd)]*0x64)/0x64,'totalPaidOut':Math[_0x2ec1f9(0x19e)](_0xbaa2['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x2ec1f9(0x19e)](_0xbaa2[_0x2ec1f9(0x1dd)]*0x64)/0x64,'thisMonth':Math[_0x2ec1f9(0x19e)](_0x465850*0x64)/0x64};return console[_0x2ec1f9(0x1de)]('üìä\x20Shop\x20'+_0xbaa2[_0x2ec1f9(0x172)]+_0x2ec1f9(0x1ca)),console[_0x2ec1f9(0x1de)](_0x2ec1f9(0x1c5)+_0x57ae95[_0x2ec1f9(0x1b8)]+_0x2ec1f9(0x1ed)),console[_0x2ec1f9(0x1de)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x57ae95[_0x2ec1f9(0x14e)]+_0x2ec1f9(0x185)),console['log'](_0x2ec1f9(0x151)+_0x57ae95[_0x2ec1f9(0x1d5)]+'\x20USDT\x20(current\x20balance)'),console[_0x2ec1f9(0x1de)](_0x2ec1f9(0x15b)+_0x57ae95['thisMonth']+_0x2ec1f9(0x1ee)),_0x57ae95;}[a56_0x859e69(0x159)](_0x285363){const _0x31f427=a56_0x859e69,_0xf2b46d={'test_gateway':_0x31f427(0x1ea),'plisio':_0x31f427(0x184),'rapyd':_0x31f427(0x196),'noda':_0x31f427(0x1b0),'cointopay':_0x31f427(0x176),'klyme_eu':_0x31f427(0x192),'klyme_gb':_0x31f427(0x17e),'klyme_de':_0x31f427(0x160)};return _0xf2b46d[_0x285363]||_0x285363;}async[a56_0x859e69(0x16e)](_0x552a9f){return this['getShopPayoutStats'](_0x552a9f);}async['getWebhookLogs'](_0x1c8185,_0xc3064d){const _0x3bc62a=a56_0x859e69,{page:_0xba8602,limit:_0x115c74,paymentId:_0x43a026}=_0xc3064d,_0x3bbe62=(_0xba8602-0x1)*_0x115c74,_0x52a67f={'shopId':_0x1c8185};_0x43a026&&(_0x52a67f[_0x3bc62a(0x19a)]=_0x43a026);const [_0x295d21,_0x5f9695]=await Promise['all']([database_1[_0x3bc62a(0x1cf)][_0x3bc62a(0x1d8)][_0x3bc62a(0x1d3)]({'where':_0x52a67f,'skip':_0x3bbe62,'take':_0x115c74,'orderBy':{'createdAt':_0x3bc62a(0x1a2)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x3bc62a(0x1d8)][_0x3bc62a(0x18c)]({'where':_0x52a67f})]);return{'logs':_0x295d21[_0x3bc62a(0x1b4)](_0x1afdd=>({'id':_0x1afdd['id'],'paymentId':_0x1afdd['paymentId'],'shopId':_0x1afdd[_0x3bc62a(0x181)],'event':_0x1afdd[_0x3bc62a(0x1a1)],'statusCode':_0x1afdd[_0x3bc62a(0x1c4)],'retryCount':_0x1afdd[_0x3bc62a(0x16b)],'responseBody':_0x1afdd[_0x3bc62a(0x1b7)],'createdAt':_0x1afdd[_0x3bc62a(0x177)],'payment':_0x1afdd[_0x3bc62a(0x175)]})),'pagination':{'page':_0xba8602,'limit':_0x115c74,'total':_0x5f9695,'totalPages':Math[_0x3bc62a(0x182)](_0x5f9695/_0x115c74)}};}async[a56_0x859e69(0x18b)](_0x19ec72,_0x3b4edb){const _0x4d1a6a=a56_0x859e69,_0x3503a4=new Date();let _0x43b0b2;switch(_0x3b4edb){case'7d':_0x43b0b2=new Date(_0x3503a4[_0x4d1a6a(0x150)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4d1a6a(0x17f):_0x43b0b2=new Date(_0x3503a4[_0x4d1a6a(0x150)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4d1a6a(0x15c):_0x43b0b2=new Date(_0x3503a4[_0x4d1a6a(0x150)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x43b0b2=new Date(_0x3503a4[_0x4d1a6a(0x150)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x352db5,_0x38ea0d,_0x2b16ab,_0x467129,_0x4dbbe6]=await Promise[_0x4d1a6a(0x167)]([database_1[_0x4d1a6a(0x1cf)][_0x4d1a6a(0x175)][_0x4d1a6a(0x18c)]({'where':{'shopId':_0x19ec72,'gateway':{'not':_0x4d1a6a(0x1aa)},'createdAt':{'gte':_0x43b0b2}}}),database_1['default'][_0x4d1a6a(0x175)][_0x4d1a6a(0x18c)]({'where':{'shopId':_0x19ec72,'gateway':{'not':_0x4d1a6a(0x1aa)},'status':_0x4d1a6a(0x1c7),'createdAt':{'gte':_0x43b0b2}}}),database_1[_0x4d1a6a(0x1cf)][_0x4d1a6a(0x175)]['findMany']({'where':{'shopId':_0x19ec72,'gateway':{'not':_0x4d1a6a(0x1aa)},'status':_0x4d1a6a(0x1c7),'createdAt':{'gte':_0x43b0b2}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x4d1a6a(0x175)][_0x4d1a6a(0x1d3)]({'where':{'shopId':_0x19ec72,'gateway':{'not':_0x4d1a6a(0x1aa)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x4d1a6a(0x175)]['findMany']({'where':{'shopId':_0x19ec72,'gateway':{'not':_0x4d1a6a(0x1aa)},'createdAt':{'gte':_0x43b0b2}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x11b638=0x0;for(const _0x42ce0f of _0x2b16ab){if(_0x42ce0f['amountUSDT'])_0x11b638+=_0x42ce0f[_0x4d1a6a(0x187)];else{const _0x44223a=await currencyService_1[_0x4d1a6a(0x163)]['convertToUSDT'](_0x42ce0f[_0x4d1a6a(0x1ae)],_0x42ce0f[_0x4d1a6a(0x1b5)]);_0x11b638+=_0x44223a;}}const _0x1c5034=this[_0x4d1a6a(0x19d)](_0x4dbbe6,_0x43b0b2,_0x3503a4),_0x213d97=_0x352db5>0x0?_0x38ea0d/_0x352db5*0x64:0x0;return{'totalPayments':_0x352db5,'successfulPayments':_0x38ea0d,'totalRevenue':Math[_0x4d1a6a(0x19e)](_0x11b638*0x64)/0x64,'conversionRate':Math[_0x4d1a6a(0x19e)](_0x213d97*0x64)/0x64,'dailyRevenue':_0x1c5034[_0x4d1a6a(0x193)],'dailyPayments':_0x1c5034['dailyPayments'],'recentPayments':_0x467129[_0x4d1a6a(0x1b4)](_0x43a96a=>({'id':_0x43a96a['id'],'gateway':_0x43a96a[_0x4d1a6a(0x164)],'amount':_0x43a96a[_0x4d1a6a(0x1ae)],'currency':_0x43a96a[_0x4d1a6a(0x1b5)],'status':_0x43a96a[_0x4d1a6a(0x170)],'createdAt':_0x43a96a[_0x4d1a6a(0x177)]}))};}[a56_0x859e69(0x19d)](_0x47e92a,_0x4c600e,_0x46e9d3){const _0x4c0923=a56_0x859e69,_0x3acccb=new Map(),_0x80945f=new Date(_0x4c600e);while(_0x80945f<=_0x46e9d3){const _0x19781f=_0x80945f[_0x4c0923(0x16c)]()[_0x4c0923(0x14d)]('T')[0x0];_0x3acccb[_0x4c0923(0x1a3)](_0x19781f,{'revenue':0x0,'count':0x0}),_0x80945f['setDate'](_0x80945f[_0x4c0923(0x183)]()+0x1);}for(const _0x56af29 of _0x47e92a){const _0x489335=_0x56af29[_0x4c0923(0x177)]['toISOString']()[_0x4c0923(0x14d)]('T')[0x0],_0x648ce=_0x3acccb[_0x4c0923(0x148)](_0x489335);_0x648ce&&(_0x648ce[_0x4c0923(0x18c)]+=0x1,_0x56af29[_0x4c0923(0x170)]==='PAID'&&_0x56af29[_0x4c0923(0x187)]&&(_0x648ce['revenue']+=_0x56af29[_0x4c0923(0x187)]));}const _0x523291=[],_0x5cb1db=[];for(const [_0x25d6e6,_0x12e849]of _0x3acccb){_0x523291[_0x4c0923(0x171)]({'date':_0x25d6e6,'amount':Math[_0x4c0923(0x19e)](_0x12e849[_0x4c0923(0x149)]*0x64)/0x64}),_0x5cb1db['push']({'date':_0x25d6e6,'count':_0x12e849[_0x4c0923(0x18c)]});}return{'dailyRevenue':_0x523291,'dailyPayments':_0x5cb1db};}}exports['ShopService']=ShopService;