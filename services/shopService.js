'use strict';function a57_0x36d4(_0x26f974,_0x1eeb4b){const _0x48227a=a57_0x4822();return a57_0x36d4=function(_0x36d494,_0x357055){_0x36d494=_0x36d494-0x184;let _0x23f7bf=_0x48227a[_0x36d494];return _0x23f7bf;},a57_0x36d4(_0x26f974,_0x1eeb4b);}const a57_0x17d3c6=a57_0x36d4;(function(_0x5c4816,_0x4a6b23){const _0x367388=a57_0x36d4,_0x25f0d5=_0x5c4816();while(!![]){try{const _0x578228=parseInt(_0x367388(0x1a2))/0x1+-parseInt(_0x367388(0x226))/0x2+-parseInt(_0x367388(0x1ed))/0x3+-parseInt(_0x367388(0x1c8))/0x4+parseInt(_0x367388(0x1d9))/0x5+parseInt(_0x367388(0x1b2))/0x6+parseInt(_0x367388(0x192))/0x7;if(_0x578228===_0x4a6b23)break;else _0x25f0d5['push'](_0x25f0d5['shift']());}catch(_0x5f4348){_0x25f0d5['push'](_0x25f0d5['shift']());}}}(a57_0x4822,0x9845e));var __importDefault=this&&this[a57_0x17d3c6(0x19a)]||function(_0x30af83){return _0x30af83&&_0x30af83['__esModule']?_0x30af83:{'default':_0x30af83};};Object['defineProperty'](exports,a57_0x17d3c6(0x1d4),{'value':!![]}),exports[a57_0x17d3c6(0x21b)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a57_0x17d3c6(0x18a)),paymentService_1=require(a57_0x17d3c6(0x1c2));function a57_0x4822(){const _0xac4662=['polygon_usdc','findFirst','getTime','No\x20webhook\x20URL\x20configured','üìÖ\x20Period\x20end:\x20','\x20\x20\x20üìÖ\x20This\x20month:\x20','paymentId','paid','shop','asc','getPaymentByShopAndId','event','availableBalance','error','USD','Test\x20Gateway','usdcPolygonWallet','lte','\x20payout\x20statistics\x20calculated:','USDT\x20BSC','üìä\x20Status\x20filter:\x20','language','PaymentService','ShopService','gateways','map','USDT\x20Polygon','getFullYear','count','toUpperCase','Webhook\x20returned\x20error:\x20','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','usdtPolygonWallet','default','695466IVJsgG','Failed\x20to\x20send\x20webhook:\x20','maxPayments','periodFrom','shopId','all','currency','usdtErcWallet','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','gte','generateDailyStatistics','customerName','findMany','REJECTED','./currencyService','createPublicPayment','isArray','USDT\x20TRC20','getPayoutStatistics','split','aggregate','currencyService','4881205ItjXVu','test_gateway','PAID','üåê\x20Method\x20filter:\x20','log','getDate','POST','KLYME\x20DE','__importDefault','\x20USDT','PENDING','amountUSDT','üí∞\x20Getting\x20payouts\x20with\x20filters:','customer','test','webhookUrl','604128imqdKe','testWebhook','revenue','\x20USDT\x20(total\x20payouts)','getStatistics','ceil','Payment\x20not\x20found','TesSoft\x20Payment\x20System/1.0\x20(Test)','formatNetworkName','telegramId','üìÖ\x20Date\x20end:\x20','polygon','getPayouts','90d','getShopPayoutStats','getPayoutById','5143488RPmsgI','Error\x20parsing\x20webhook\x20events:','getPayments','fullName','reduce','üìä\x20Final\x20WHERE\x20conditions:','shopUrl','paidAt','KLYME\x20GB','webhookLog','getPayoutStats','payment','settings','desc','delete','getPaymentsByShop','./paymentService','findUnique','Plisio','filter','stringify','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','1710364ILlltD','webhookEvents','application/json','network','setHours','message','\x20USDT\x20(current\x20balance)','retryCount','USDC\x20Polygon','status','balance','COMPLETED','__esModule','txid','push','updateWallets','responseBody','1365100BdNJlH','statusCode','statusText','redirectUrl','sourceCurrency','notes','Shop\x20not\x20found','createdAt','convertToUSDT','Unknown\x20error','customerEmail','deletePayment','totalPaidOut','payout','trc20','toISOString','getGatewayDisplayName','usage','paymentGateways','test_payment_123','3098031pmJfcn','publicKey','round','wallets','USDT\x20ERC20','setDate','name','amount','getMonth','getShopProfile','telegram','30d','\x20\x20\x20üíµ\x20Available\x20balance:\x20','amountIsEditable','updatePayment','test_order_123','username','thisMonth','paymentService','erc20','gatewaySettings','usdtTrcWallet','parse'];a57_0x4822=function(){return _0xac4662;};return a57_0x4822();}class ShopService{constructor(){const _0x222779=a57_0x17d3c6;this[_0x222779(0x1ff)]=new paymentService_1[(_0x222779(0x21a))]();}async[a57_0x17d3c6(0x1f6)](_0xd50ab2){const _0x38d6ad=a57_0x17d3c6,_0x495bbf=await database_1[_0x38d6ad(0x225)][_0x38d6ad(0x20c)][_0x38d6ad(0x1c3)]({'where':{'id':_0xd50ab2},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x495bbf)throw new Error(_0x38d6ad(0x1df));let _0x5ad95e=[];if(_0x495bbf['settings']?.[_0x38d6ad(0x1c9)])try{_0x5ad95e=Array[_0x38d6ad(0x18c)](_0x495bbf['settings'][_0x38d6ad(0x1c9)])?_0x495bbf[_0x38d6ad(0x1be)]['webhookEvents']:JSON[_0x38d6ad(0x203)](_0x495bbf[_0x38d6ad(0x1be)][_0x38d6ad(0x1c9)]);}catch(_0x5ecc31){console[_0x38d6ad(0x211)]('Error\x20parsing\x20webhook\x20events:',_0x5ecc31),_0x5ad95e=[];}return{'id':_0x495bbf['id'],'fullName':_0x495bbf[_0x38d6ad(0x1f3)],'username':_0x495bbf[_0x38d6ad(0x1fd)],'telegramId':_0x495bbf['telegram'],'merchantUrl':_0x495bbf[_0x38d6ad(0x1b8)],'gateways':_0x495bbf['paymentGateways']?JSON[_0x38d6ad(0x203)](_0x495bbf[_0x38d6ad(0x1eb)]):null,'gatewaySettings':_0x495bbf[_0x38d6ad(0x201)]?JSON[_0x38d6ad(0x203)](_0x495bbf['gatewaySettings']):null,'publicKey':_0x495bbf[_0x38d6ad(0x1ee)],'webhookUrl':_0x495bbf[_0x38d6ad(0x1be)]?.[_0x38d6ad(0x1a1)]||null,'webhookEvents':_0x5ad95e,'wallets':{'usdtPolygonWallet':_0x495bbf['usdtPolygonWallet'],'usdtTrcWallet':_0x495bbf['usdtTrcWallet'],'usdtErcWallet':_0x495bbf[_0x38d6ad(0x22d)],'usdcPolygonWallet':_0x495bbf[_0x38d6ad(0x214)]},'status':_0x495bbf[_0x38d6ad(0x1d1)],'createdAt':_0x495bbf['createdAt']};}async['updateShopProfile'](_0x2e327e,_0x44a682){const _0x1845e4=a57_0x17d3c6,_0x4a75c7={};_0x44a682[_0x1845e4(0x1b5)]&&(_0x4a75c7[_0x1845e4(0x1f3)]=_0x44a682['fullName']);_0x44a682[_0x1845e4(0x1ab)]!==undefined&&(_0x4a75c7['telegram']=_0x44a682[_0x1845e4(0x1ab)]||null);_0x44a682['merchantUrl']&&(_0x4a75c7[_0x1845e4(0x1b8)]=_0x44a682['merchantUrl']);_0x44a682[_0x1845e4(0x21c)]&&(_0x4a75c7[_0x1845e4(0x1eb)]=JSON[_0x1845e4(0x1c6)](_0x44a682[_0x1845e4(0x21c)]));_0x44a682['gatewaySettings']&&(_0x4a75c7[_0x1845e4(0x201)]=JSON[_0x1845e4(0x1c6)](_0x44a682[_0x1845e4(0x201)]));_0x44a682[_0x1845e4(0x1f0)]&&(_0x44a682['wallets'][_0x1845e4(0x224)]!==undefined&&(_0x4a75c7[_0x1845e4(0x224)]=_0x44a682[_0x1845e4(0x1f0)][_0x1845e4(0x224)]||null),_0x44a682[_0x1845e4(0x1f0)]['usdtTrcWallet']!==undefined&&(_0x4a75c7[_0x1845e4(0x202)]=_0x44a682[_0x1845e4(0x1f0)]['usdtTrcWallet']||null),_0x44a682[_0x1845e4(0x1f0)][_0x1845e4(0x22d)]!==undefined&&(_0x4a75c7[_0x1845e4(0x22d)]=_0x44a682[_0x1845e4(0x1f0)][_0x1845e4(0x22d)]||null),_0x44a682[_0x1845e4(0x1f0)][_0x1845e4(0x214)]!==undefined&&(_0x4a75c7[_0x1845e4(0x214)]=_0x44a682[_0x1845e4(0x1f0)][_0x1845e4(0x214)]||null));const _0xfcc7c7=await database_1[_0x1845e4(0x225)][_0x1845e4(0x20c)]['update']({'where':{'id':_0x2e327e},'data':_0x4a75c7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x11e722=[];if(_0xfcc7c7[_0x1845e4(0x1be)]?.[_0x1845e4(0x1c9)])try{_0x11e722=Array[_0x1845e4(0x18c)](_0xfcc7c7[_0x1845e4(0x1be)]['webhookEvents'])?_0xfcc7c7[_0x1845e4(0x1be)]['webhookEvents']:JSON['parse'](_0xfcc7c7['settings'][_0x1845e4(0x1c9)]);}catch(_0x2e6cc9){console['error'](_0x1845e4(0x1b3),_0x2e6cc9),_0x11e722=[];}return{'id':_0xfcc7c7['id'],'fullName':_0xfcc7c7['name'],'username':_0xfcc7c7[_0x1845e4(0x1fd)],'telegramId':_0xfcc7c7[_0x1845e4(0x1f7)],'merchantUrl':_0xfcc7c7['shopUrl'],'gateways':_0xfcc7c7[_0x1845e4(0x1eb)]?JSON['parse'](_0xfcc7c7[_0x1845e4(0x1eb)]):null,'gatewaySettings':_0xfcc7c7[_0x1845e4(0x201)]?JSON[_0x1845e4(0x203)](_0xfcc7c7[_0x1845e4(0x201)]):null,'publicKey':_0xfcc7c7[_0x1845e4(0x1ee)],'webhookUrl':_0xfcc7c7[_0x1845e4(0x1be)]?.[_0x1845e4(0x1a1)]||null,'webhookEvents':_0x11e722,'wallets':{'usdtPolygonWallet':_0xfcc7c7[_0x1845e4(0x224)],'usdtTrcWallet':_0xfcc7c7[_0x1845e4(0x202)],'usdtErcWallet':_0xfcc7c7['usdtErcWallet'],'usdcPolygonWallet':_0xfcc7c7[_0x1845e4(0x214)]},'status':_0xfcc7c7[_0x1845e4(0x1d1)],'createdAt':_0xfcc7c7[_0x1845e4(0x1e0)]};}async[a57_0x17d3c6(0x1d7)](_0x1c95f8,_0x33b495){const _0x437f34=a57_0x17d3c6,_0x38398f={};_0x33b495['usdtPolygonWallet']!==undefined&&(_0x38398f[_0x437f34(0x224)]=_0x33b495[_0x437f34(0x224)]||null),_0x33b495[_0x437f34(0x202)]!==undefined&&(_0x38398f[_0x437f34(0x202)]=_0x33b495[_0x437f34(0x202)]||null),_0x33b495[_0x437f34(0x22d)]!==undefined&&(_0x38398f['usdtErcWallet']=_0x33b495[_0x437f34(0x22d)]||null),_0x33b495[_0x437f34(0x214)]!==undefined&&(_0x38398f[_0x437f34(0x214)]=_0x33b495[_0x437f34(0x214)]||null),await database_1[_0x437f34(0x225)][_0x437f34(0x20c)]['update']({'where':{'id':_0x1c95f8},'data':_0x38398f});}async[a57_0x17d3c6(0x1a3)](_0x2ae83e){const _0x5b9b93=a57_0x17d3c6,_0x170a9c=await database_1[_0x5b9b93(0x225)][_0x5b9b93(0x20c)][_0x5b9b93(0x1c3)]({'where':{'id':_0x2ae83e},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x170a9c?.[_0x5b9b93(0x1be)]?.[_0x5b9b93(0x1a1)])throw new Error(_0x5b9b93(0x207));const _0x3e9a49={'event':'test','payment':{'id':_0x5b9b93(0x1ec),'order_id':_0x5b9b93(0x1fc),'gateway':_0x5b9b93(0x1a0),'amount':0x64,'currency':_0x5b9b93(0x212),'status':_0x5b9b93(0x20b),'created_at':new Date()[_0x5b9b93(0x1e8)]()}};try{const _0x2e7f6d=await fetch(_0x170a9c[_0x5b9b93(0x1be)]['webhookUrl'],{'method':_0x5b9b93(0x198),'headers':{'Content-Type':_0x5b9b93(0x1ca),'User-Agent':_0x5b9b93(0x1a9)},'body':JSON[_0x5b9b93(0x1c6)](_0x3e9a49)});return _0x2e7f6d['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x2e7f6d['status']+')'}:{'success':![],'message':_0x5b9b93(0x222)+_0x2e7f6d['status']+'\x20'+_0x2e7f6d[_0x5b9b93(0x1db)]};}catch(_0x270815){return{'success':![],'message':_0x5b9b93(0x227)+(_0x270815 instanceof Error?_0x270815[_0x5b9b93(0x1cd)]:_0x5b9b93(0x1e2))};}}async['createPayment'](_0x46ad9b){const _0x2adeed=a57_0x17d3c6;return this[_0x2adeed(0x1ff)][_0x2adeed(0x18b)]({'public_key':'','gateway':_0x46ad9b['gateway'],'order_id':undefined,'amount':_0x46ad9b[_0x2adeed(0x1f4)],'currency':_0x46ad9b[_0x2adeed(0x22c)],'source_currency':_0x46ad9b[_0x2adeed(0x1dd)],'usage':_0x46ad9b[_0x2adeed(0x1ea)],'expires_at':_0x46ad9b['expiresAt']?.[_0x2adeed(0x1e8)](),'success_url':_0x46ad9b[_0x2adeed(0x1dc)],'fail_url':_0x46ad9b['redirectUrl'],'customer_email':_0x46ad9b[_0x2adeed(0x1e3)],'customer_name':_0x46ad9b[_0x2adeed(0x187)],'country':_0x46ad9b['country'],'language':_0x46ad9b[_0x2adeed(0x219)],'amount_is_editable':_0x46ad9b[_0x2adeed(0x1fa)],'max_payments':_0x46ad9b[_0x2adeed(0x228)],'customer':_0x46ad9b[_0x2adeed(0x19f)]});}async[a57_0x17d3c6(0x1b4)](_0x9355cf,_0x3dbe0a){const _0x44c09d=a57_0x17d3c6;return this[_0x44c09d(0x1ff)][_0x44c09d(0x1c1)](_0x9355cf,_0x3dbe0a);}async['getPaymentById'](_0x40c781,_0x216ee2){const _0x1532bf=a57_0x17d3c6;return this['paymentService'][_0x1532bf(0x20e)](_0x40c781,_0x216ee2);}async[a57_0x17d3c6(0x1fb)](_0x18b0bc,_0x35f324,_0x237341){const _0x495e70=a57_0x17d3c6,_0x194dc3=await database_1[_0x495e70(0x225)][_0x495e70(0x1bd)]['findFirst']({'where':{'id':_0x35f324,'shopId':_0x18b0bc}});if(!_0x194dc3)throw new Error(_0x495e70(0x1a8));const _0x44749d=await database_1[_0x495e70(0x225)][_0x495e70(0x1bd)]['update']({'where':{'id':_0x35f324},'data':{..._0x237341,'updatedAt':new Date()}});return _0x44749d;}async[a57_0x17d3c6(0x1e4)](_0x119979,_0x522ea0){const _0x5c32cd=a57_0x17d3c6,_0x11f879=await database_1[_0x5c32cd(0x225)]['payment'][_0x5c32cd(0x205)]({'where':{'id':_0x522ea0,'shopId':_0x119979}});if(!_0x11f879)throw new Error('Payment\x20not\x20found');await database_1[_0x5c32cd(0x225)][_0x5c32cd(0x1bd)][_0x5c32cd(0x1c0)]({'where':{'id':_0x522ea0}});}['formatNetworkName'](_0x160f94){const _0x27dd30=a57_0x17d3c6,_0x1cd0ba={'polygon':_0x27dd30(0x21e),'trc20':_0x27dd30(0x18d),'erc20':_0x27dd30(0x1f1),'bsc':_0x27dd30(0x217),'polygon_usdc':_0x27dd30(0x1d0)};return _0x1cd0ba[_0x160f94]||_0x160f94;}async[a57_0x17d3c6(0x1ae)](_0x3bb77c,_0x1e0b09){const _0x1ab6c1=a57_0x17d3c6,{page:_0x55c18c,limit:_0x3d54a5,status:_0xc243a1,method:_0x4c12ae,network:_0x295438,dateFrom:_0x7c9063,dateTo:_0x20e486,periodFrom:_0x49bc9f,periodTo:_0x5de558}=_0x1e0b09,_0x5e702b=(_0x55c18c-0x1)*_0x3d54a5;console[_0x1ab6c1(0x196)](_0x1ab6c1(0x19e),_0x1e0b09);const _0x2fede6={'shopId':_0x3bb77c};_0xc243a1&&(_0x2fede6['status']=_0xc243a1[_0x1ab6c1(0x221)](),console['log'](_0x1ab6c1(0x218)+_0xc243a1[_0x1ab6c1(0x221)]()));if(_0x4c12ae)_0x2fede6[_0x1ab6c1(0x1cb)]=_0x4c12ae,console[_0x1ab6c1(0x196)](_0x1ab6c1(0x195)+_0x4c12ae);else _0x295438&&(_0x2fede6['network']=_0x295438,console['log']('üåê\x20Network\x20filter:\x20'+_0x295438));if(_0x7c9063||_0x20e486||_0x49bc9f||_0x5de558){_0x2fede6[_0x1ab6c1(0x1e0)]={};if(_0x49bc9f){const _0x391389=new Date(_0x49bc9f);_0x391389['setHours'](0x0,0x0,0x0,0x0),_0x2fede6[_0x1ab6c1(0x1e0)][_0x1ab6c1(0x185)]=_0x391389,console[_0x1ab6c1(0x196)]('üìÖ\x20Period\x20start:\x20'+_0x391389[_0x1ab6c1(0x1e8)]());}else{if(_0x7c9063){const _0xee035f=new Date(_0x7c9063);_0xee035f[_0x1ab6c1(0x1cc)](0x0,0x0,0x0,0x0),_0x2fede6[_0x1ab6c1(0x1e0)][_0x1ab6c1(0x185)]=_0xee035f,console[_0x1ab6c1(0x196)]('üìÖ\x20Date\x20start:\x20'+_0xee035f['toISOString']());}}if(_0x5de558){const _0x7dfda6=new Date(_0x5de558);_0x7dfda6[_0x1ab6c1(0x1cc)](0x17,0x3b,0x3b,0x3e7),_0x2fede6[_0x1ab6c1(0x1e0)][_0x1ab6c1(0x215)]=_0x7dfda6,console[_0x1ab6c1(0x196)](_0x1ab6c1(0x208)+_0x7dfda6['toISOString']());}else{if(_0x20e486){const _0x5520df=new Date(_0x20e486);_0x5520df[_0x1ab6c1(0x1cc)](0x17,0x3b,0x3b,0x3e7),_0x2fede6[_0x1ab6c1(0x1e0)][_0x1ab6c1(0x215)]=_0x5520df,console[_0x1ab6c1(0x196)](_0x1ab6c1(0x1ac)+_0x5520df[_0x1ab6c1(0x1e8)]());}}}console['log'](_0x1ab6c1(0x1b7),JSON[_0x1ab6c1(0x1c6)](_0x2fede6,null,0x2));const [_0x58ba48,_0x2c0514]=await Promise[_0x1ab6c1(0x22b)]([database_1[_0x1ab6c1(0x225)][_0x1ab6c1(0x1e6)][_0x1ab6c1(0x188)]({'where':_0x2fede6,'skip':_0x5e702b,'take':_0x3d54a5,'orderBy':{'createdAt':_0x1ab6c1(0x1bf)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x1ab6c1(0x225)]['payout']['count']({'where':_0x2fede6})]);return{'payouts':_0x58ba48[_0x1ab6c1(0x21d)](_0x4c5cd7=>{const _0x4cb63e=_0x1ab6c1;let _0x15f725=null;switch(_0x4c5cd7['network']){case _0x4cb63e(0x1ad):_0x15f725=_0x4c5cd7[_0x4cb63e(0x20c)][_0x4cb63e(0x224)];break;case _0x4cb63e(0x1e7):_0x15f725=_0x4c5cd7[_0x4cb63e(0x20c)]['usdtTrcWallet'];break;case _0x4cb63e(0x200):_0x15f725=_0x4c5cd7[_0x4cb63e(0x20c)]['usdtErcWallet'];break;case _0x4cb63e(0x204):_0x15f725=_0x4c5cd7[_0x4cb63e(0x20c)][_0x4cb63e(0x214)];break;}return{'id':_0x4c5cd7['id'],'amount':_0x4c5cd7[_0x4cb63e(0x1f4)],'network':this[_0x4cb63e(0x1aa)](_0x4c5cd7[_0x4cb63e(0x1cb)]),'wallet':_0x15f725,'status':_0x4c5cd7[_0x4cb63e(0x1d1)],'txid':_0x4c5cd7[_0x4cb63e(0x1d5)],'notes':_0x4c5cd7[_0x4cb63e(0x1de)],'periodFrom':_0x4c5cd7[_0x4cb63e(0x229)],'periodTo':_0x4c5cd7['periodTo'],'createdAt':_0x4c5cd7['createdAt'],'paidAt':_0x4c5cd7[_0x4cb63e(0x1b9)]};}),'pagination':{'page':_0x55c18c,'limit':_0x3d54a5,'total':_0x2c0514,'totalPages':Math[_0x1ab6c1(0x1a7)](_0x2c0514/_0x3d54a5)}};}async[a57_0x17d3c6(0x1b1)](_0x2dc8c3,_0x476ad4){const _0x336790=a57_0x17d3c6,_0x1b7b31=await database_1['default'][_0x336790(0x1e6)][_0x336790(0x205)]({'where':{'id':_0x476ad4,'shopId':_0x2dc8c3}});if(!_0x1b7b31)return null;return{'id':_0x1b7b31['id'],'amount':_0x1b7b31['amount'],'network':_0x1b7b31[_0x336790(0x1cb)],'status':_0x1b7b31['status'],'txid':_0x1b7b31[_0x336790(0x1d5)],'notes':_0x1b7b31['notes'],'createdAt':_0x1b7b31[_0x336790(0x1e0)],'paidAt':_0x1b7b31[_0x336790(0x1b9)]};}async[a57_0x17d3c6(0x18e)](_0x135430,_0x198696){const _0x2100be=a57_0x17d3c6,_0x5de8b2=new Date();let _0x2916cb;switch(_0x198696){case'7d':_0x2916cb=new Date(_0x5de8b2[_0x2100be(0x206)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2916cb=new Date(_0x5de8b2[_0x2100be(0x206)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2100be(0x1af):_0x2916cb=new Date(_0x5de8b2[_0x2100be(0x206)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2916cb=new Date(_0x5de8b2[_0x2100be(0x206)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5b5b67,_0xd30a4b,_0x5ad512,_0x4c9b78,_0x3adb2d,_0x2f842d]=await Promise[_0x2100be(0x22b)]([database_1[_0x2100be(0x225)][_0x2100be(0x1e6)][_0x2100be(0x220)]({'where':{'shopId':_0x135430,'createdAt':{'gte':_0x2916cb}}}),database_1['default'][_0x2100be(0x1e6)]['count']({'where':{'shopId':_0x135430,'status':_0x2100be(0x1d3),'createdAt':{'gte':_0x2916cb}}}),database_1[_0x2100be(0x225)][_0x2100be(0x1e6)][_0x2100be(0x220)]({'where':{'shopId':_0x135430,'status':_0x2100be(0x19c),'createdAt':{'gte':_0x2916cb}}}),database_1[_0x2100be(0x225)][_0x2100be(0x1e6)][_0x2100be(0x220)]({'where':{'shopId':_0x135430,'status':_0x2100be(0x189),'createdAt':{'gte':_0x2916cb}}}),database_1[_0x2100be(0x225)][_0x2100be(0x1e6)]['findMany']({'where':{'shopId':_0x135430,'createdAt':{'gte':_0x2916cb}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x2100be(0x225)][_0x2100be(0x1e6)][_0x2100be(0x188)]({'where':{'shopId':_0x135430},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x5226c6=_0x3adb2d[_0x2100be(0x1b6)]((_0x5bbb38,_0x31475a)=>_0x5bbb38+_0x31475a['amount'],0x0),_0x5cd3e5=_0x3adb2d[_0x2100be(0x1c5)](_0x1b8051=>_0x1b8051[_0x2100be(0x1d1)]===_0x2100be(0x1d3))[_0x2100be(0x1b6)]((_0x3cc81c,_0x5bdf22)=>_0x3cc81c+_0x5bdf22['amount'],0x0),_0x451e23=_0x3adb2d[_0x2100be(0x1c5)](_0x2e961d=>_0x2e961d[_0x2100be(0x1d1)]===_0x2100be(0x19c))[_0x2100be(0x1b6)]((_0x2d6b0c,_0x465286)=>_0x2d6b0c+_0x465286[_0x2100be(0x1f4)],0x0),_0xc248b2=_0x3adb2d[_0x2100be(0x1b6)]((_0x2b3c83,_0x21ae40)=>{const _0x33220d=_0x2100be;return _0x2b3c83[_0x21ae40[_0x33220d(0x1cb)]]=(_0x2b3c83[_0x21ae40[_0x33220d(0x1cb)]]||0x0)+0x1,_0x2b3c83;},{}),_0x2c8ad8=_0x3adb2d[_0x2100be(0x1b6)]((_0x1844a6,_0x123646)=>{const _0x441107=_0x2100be;return _0x1844a6[_0x123646[_0x441107(0x1d1)]]=(_0x1844a6[_0x123646['status']]||0x0)+0x1,_0x1844a6;},{});return{'totalPayouts':_0x5b5b67,'completedPayouts':_0xd30a4b,'pendingPayouts':_0x5ad512,'rejectedPayouts':_0x4c9b78,'totalAmount':_0x5226c6,'completedAmount':_0x5cd3e5,'pendingAmount':_0x451e23,'payoutsByMethod':_0xc248b2,'payoutsByStatus':_0x2c8ad8,'recentPayouts':_0x2f842d[_0x2100be(0x21d)](_0x9eee2d=>({'id':_0x9eee2d['id'],'shopId':_0x135430,'amount':_0x9eee2d[_0x2100be(0x1f4)],'method':_0x9eee2d[_0x2100be(0x1cb)],'status':_0x9eee2d[_0x2100be(0x1d1)],'txid':_0x9eee2d[_0x2100be(0x1d5)],'createdAt':_0x9eee2d[_0x2100be(0x1e0)],'paidAt':_0x9eee2d[_0x2100be(0x1b9)]}))};}async[a57_0x17d3c6(0x1b0)](_0x30d8f8){const _0x1df933=a57_0x17d3c6;console[_0x1df933(0x196)](_0x1df933(0x223)+_0x30d8f8+'...');const _0x205670=await database_1['default']['shop'][_0x1df933(0x1c3)]({'where':{'id':_0x30d8f8},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x205670)throw new Error(_0x1df933(0x1df));const _0x8cd00d=new Date(),_0x3403f5=new Date(_0x8cd00d[_0x1df933(0x21f)](),_0x8cd00d[_0x1df933(0x1f5)](),0x1),_0x2fbd98=new Date(_0x8cd00d[_0x1df933(0x21f)](),_0x8cd00d['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x47f9a1=await database_1['default']['payout'][_0x1df933(0x190)]({'_sum':{'amount':!![]},'where':{'shopId':_0x30d8f8,'createdAt':{'gte':_0x3403f5,'lte':_0x2fbd98},'status':_0x1df933(0x1d3)}}),_0x5bfb7c=_0x47f9a1['_sum'][_0x1df933(0x1f4)]||0x0,_0x9e76b8={'availableBalance':Math[_0x1df933(0x1ef)](_0x205670[_0x1df933(0x1d2)]*0x64)/0x64,'totalPaidOut':Math[_0x1df933(0x1ef)](_0x205670[_0x1df933(0x1e5)]*0x64)/0x64,'awaitingPayout':Math[_0x1df933(0x1ef)](_0x205670[_0x1df933(0x1d2)]*0x64)/0x64,'thisMonth':Math['round'](_0x5bfb7c*0x64)/0x64};return console[_0x1df933(0x196)]('üìä\x20Shop\x20'+_0x205670[_0x1df933(0x1fd)]+_0x1df933(0x216)),console['log'](_0x1df933(0x1f9)+_0x9e76b8[_0x1df933(0x210)]+'\x20USDT\x20(current\x20balance)'),console[_0x1df933(0x196)](_0x1df933(0x184)+_0x9e76b8[_0x1df933(0x1e5)]+_0x1df933(0x1a5)),console['log'](_0x1df933(0x1c7)+_0x9e76b8['awaitingPayout']+_0x1df933(0x1ce)),console['log'](_0x1df933(0x209)+_0x9e76b8[_0x1df933(0x1fe)]+_0x1df933(0x19b)),_0x9e76b8;}[a57_0x17d3c6(0x1e9)](_0xbf5b34){const _0x427eec=a57_0x17d3c6,_0x145fd8={'test_gateway':_0x427eec(0x213),'plisio':_0x427eec(0x1c4),'rapyd':'Rapyd','noda':'Noda','cointopay':'CoinToPay','klyme_eu':'KLYME\x20EU','klyme_gb':_0x427eec(0x1ba),'klyme_de':_0x427eec(0x199)};return _0x145fd8[_0xbf5b34]||_0xbf5b34;}async[a57_0x17d3c6(0x1bc)](_0x5cffce){const _0x1b4eee=a57_0x17d3c6;return this[_0x1b4eee(0x1b0)](_0x5cffce);}async['getWebhookLogs'](_0x42b5bc,_0x2871ed){const _0x4614f4=a57_0x17d3c6,{page:_0x3e8b6c,limit:_0x528557,paymentId:_0x42806a}=_0x2871ed,_0x14082f=(_0x3e8b6c-0x1)*_0x528557,_0x286ef9={'shopId':_0x42b5bc};_0x42806a&&(_0x286ef9[_0x4614f4(0x20a)]=_0x42806a);const [_0x5e5f99,_0x55a617]=await Promise['all']([database_1[_0x4614f4(0x225)]['webhookLog'][_0x4614f4(0x188)]({'where':_0x286ef9,'skip':_0x14082f,'take':_0x528557,'orderBy':{'createdAt':_0x4614f4(0x1bf)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x4614f4(0x225)][_0x4614f4(0x1bb)][_0x4614f4(0x220)]({'where':_0x286ef9})]);return{'logs':_0x5e5f99['map'](_0xb7fcb3=>({'id':_0xb7fcb3['id'],'paymentId':_0xb7fcb3[_0x4614f4(0x20a)],'shopId':_0xb7fcb3[_0x4614f4(0x22a)],'event':_0xb7fcb3[_0x4614f4(0x20f)],'statusCode':_0xb7fcb3[_0x4614f4(0x1da)],'retryCount':_0xb7fcb3[_0x4614f4(0x1cf)],'responseBody':_0xb7fcb3[_0x4614f4(0x1d8)],'createdAt':_0xb7fcb3[_0x4614f4(0x1e0)],'payment':_0xb7fcb3[_0x4614f4(0x1bd)]})),'pagination':{'page':_0x3e8b6c,'limit':_0x528557,'total':_0x55a617,'totalPages':Math[_0x4614f4(0x1a7)](_0x55a617/_0x528557)}};}async[a57_0x17d3c6(0x1a6)](_0x3f19f8,_0xb8c605){const _0x149b6d=a57_0x17d3c6,_0x42a1b2=new Date();let _0xc48ea1;switch(_0xb8c605){case'7d':_0xc48ea1=new Date(_0x42a1b2[_0x149b6d(0x206)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x149b6d(0x1f8):_0xc48ea1=new Date(_0x42a1b2[_0x149b6d(0x206)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x149b6d(0x1af):_0xc48ea1=new Date(_0x42a1b2['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xc48ea1=new Date(_0x42a1b2['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x57f621,_0x5cf155,_0x4bb404,_0x56dbdc,_0x98592c]=await Promise[_0x149b6d(0x22b)]([database_1[_0x149b6d(0x225)]['payment']['count']({'where':{'shopId':_0x3f19f8,'gateway':{'not':_0x149b6d(0x193)},'createdAt':{'gte':_0xc48ea1}}}),database_1['default']['payment'][_0x149b6d(0x220)]({'where':{'shopId':_0x3f19f8,'gateway':{'not':_0x149b6d(0x193)},'status':'PAID','createdAt':{'gte':_0xc48ea1}}}),database_1[_0x149b6d(0x225)]['payment'][_0x149b6d(0x188)]({'where':{'shopId':_0x3f19f8,'gateway':{'not':_0x149b6d(0x193)},'status':'PAID','createdAt':{'gte':_0xc48ea1}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x149b6d(0x225)][_0x149b6d(0x1bd)][_0x149b6d(0x188)]({'where':{'shopId':_0x3f19f8,'gateway':{'not':_0x149b6d(0x193)}},'take':0xa,'orderBy':{'createdAt':_0x149b6d(0x1bf)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x149b6d(0x225)][_0x149b6d(0x1bd)][_0x149b6d(0x188)]({'where':{'shopId':_0x3f19f8,'gateway':{'not':_0x149b6d(0x193)},'createdAt':{'gte':_0xc48ea1}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x149b6d(0x20d)}})]);let _0x4a9aa6=0x0;for(const _0x5aabac of _0x4bb404){if(_0x5aabac[_0x149b6d(0x19d)])_0x4a9aa6+=_0x5aabac['amountUSDT'];else{const _0x3f6f7d=await currencyService_1[_0x149b6d(0x191)][_0x149b6d(0x1e1)](_0x5aabac[_0x149b6d(0x1f4)],_0x5aabac[_0x149b6d(0x22c)]);_0x4a9aa6+=_0x3f6f7d;}}const _0x5db24d=this[_0x149b6d(0x186)](_0x98592c,_0xc48ea1,_0x42a1b2),_0x568152=_0x57f621>0x0?_0x5cf155/_0x57f621*0x64:0x0;return{'totalPayments':_0x57f621,'successfulPayments':_0x5cf155,'totalRevenue':Math[_0x149b6d(0x1ef)](_0x4a9aa6*0x64)/0x64,'conversionRate':Math[_0x149b6d(0x1ef)](_0x568152*0x64)/0x64,'dailyRevenue':_0x5db24d['dailyRevenue'],'dailyPayments':_0x5db24d['dailyPayments'],'recentPayments':_0x56dbdc['map'](_0x50a6e5=>({'id':_0x50a6e5['id'],'gateway':_0x50a6e5['gateway'],'amount':_0x50a6e5[_0x149b6d(0x1f4)],'currency':_0x50a6e5[_0x149b6d(0x22c)],'status':_0x50a6e5['status'],'createdAt':_0x50a6e5[_0x149b6d(0x1e0)]}))};}['generateDailyStatistics'](_0x59071f,_0x48776a,_0x239a22){const _0x5847bd=a57_0x17d3c6,_0x307f75=new Map(),_0x605b6a=new Date(_0x48776a);while(_0x605b6a<=_0x239a22){const _0x3ec500=_0x605b6a[_0x5847bd(0x1e8)]()[_0x5847bd(0x18f)]('T')[0x0];_0x307f75['set'](_0x3ec500,{'revenue':0x0,'count':0x0}),_0x605b6a[_0x5847bd(0x1f2)](_0x605b6a[_0x5847bd(0x197)]()+0x1);}for(const _0x3650bf of _0x59071f){const _0x22494a=_0x3650bf[_0x5847bd(0x1e0)]['toISOString']()[_0x5847bd(0x18f)]('T')[0x0],_0x6433de=_0x307f75['get'](_0x22494a);_0x6433de&&(_0x6433de['count']+=0x1,_0x3650bf[_0x5847bd(0x1d1)]===_0x5847bd(0x194)&&_0x3650bf['amountUSDT']&&(_0x6433de[_0x5847bd(0x1a4)]+=_0x3650bf[_0x5847bd(0x19d)]));}const _0x2634d7=[],_0x388813=[];for(const [_0x436f9b,_0x33d5a8]of _0x307f75){_0x2634d7[_0x5847bd(0x1d6)]({'date':_0x436f9b,'amount':Math['round'](_0x33d5a8[_0x5847bd(0x1a4)]*0x64)/0x64}),_0x388813[_0x5847bd(0x1d6)]({'date':_0x436f9b,'count':_0x33d5a8[_0x5847bd(0x220)]});}return{'dailyRevenue':_0x2634d7,'dailyPayments':_0x388813};}}exports[a57_0x17d3c6(0x21b)]=ShopService;