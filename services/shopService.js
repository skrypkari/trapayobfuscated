'use strict';const a53_0x5b8afd=a53_0x5c66;(function(_0x310d3a,_0x3984e3){const _0x4162f0=a53_0x5c66,_0xae6d0=_0x310d3a();while(!![]){try{const _0x2e62fb=parseInt(_0x4162f0(0x1e3))/0x1+parseInt(_0x4162f0(0x225))/0x2+parseInt(_0x4162f0(0x215))/0x3*(-parseInt(_0x4162f0(0x1ea))/0x4)+parseInt(_0x4162f0(0x1b8))/0x5*(parseInt(_0x4162f0(0x240))/0x6)+-parseInt(_0x4162f0(0x20a))/0x7+-parseInt(_0x4162f0(0x1bd))/0x8+-parseInt(_0x4162f0(0x206))/0x9*(-parseInt(_0x4162f0(0x1f6))/0xa);if(_0x2e62fb===_0x3984e3)break;else _0xae6d0['push'](_0xae6d0['shift']());}catch(_0x217035){_0xae6d0['push'](_0xae6d0['shift']());}}}(a53_0x4138,0xe2ef1));var __importDefault=this&&this[a53_0x5b8afd(0x239)]||function(_0x1a310b){return _0x1a310b&&_0x1a310b['__esModule']?_0x1a310b:{'default':_0x1a310b};};Object['defineProperty'](exports,a53_0x5b8afd(0x210),{'value':!![]}),exports[a53_0x5b8afd(0x1c2)]=void 0x0;function a53_0x5c66(_0x5d86ce,_0x40173c){const _0x4138cd=a53_0x4138();return a53_0x5c66=function(_0x5c66d3,_0x2da349){_0x5c66d3=_0x5c66d3-0x1a9;let _0x134beb=_0x4138cd[_0x5c66d3];return _0x134beb;},a53_0x5c66(_0x5d86ce,_0x40173c);}const database_1=__importDefault(require(a53_0x5b8afd(0x1ce))),currencyService_1=require('./currencyService'),paymentService_1=require(a53_0x5b8afd(0x1aa));function a53_0x4138(){const _0x3e3de3=['718484HUGZyT','KLYME\x20GB','Noda','\x20USDT\x20(total\x20payouts)','findMany','totalPaidOut','USD','6925796dHWUeT','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','thisMonth','getMonth','telegramId','stringify','Rapyd','parse','getPayments','shopUrl','country','push','10UIFUWA','all','redirectUrl','createdAt','gte','dailyRevenue','count','round','filter','currencyService','üìä\x20Shop\x20','getPayoutById','paid','getPayoutStats','fullName','getPayouts','10962423pyazTj','delete','gateway','CoinToPay','1192436KUHxzk','amount','\x20USDT','asc','usdtPolygonWallet','amountUSDT','__esModule','PAID','webhookUrl','name','Payment\x20not\x20found','3MvIXvI','Plisio','createPayment','testWebhook','findUnique','COMPLETED','balance','test','Webhook\x20returned\x20error:\x20','awaitingPayout','usdtTrcWallet','map','createPublicPayment','getStatistics','currency','setDate','485312LcgIuq','paidAt','convertToUSDT','gatewaySettings','\x20payout\x20statistics\x20calculated:','getGatewayDisplayName','username','statusCode','webhookEvents','...','application/json','responseBody','status','usdtErcWallet','error','sourceCurrency','Unknown\x20error','PaymentService','\x20\x20\x20üìÖ\x20This\x20month:\x20','maxPayments','__importDefault','expiresAt','KLYME\x20EU','usdcPolygonWallet','updatePayment','get','getPaymentByShopAndId','1020JsjwMI','paymentGateways','default','paymentService','Error\x20parsing\x20webhook\x20events:','customerName','KLYME\x20DE','./paymentService','aggregate','30d','notes','txid','90d','getTime','PENDING','log','toUpperCase','split','customerEmail','merchantUrl','amountIsEditable','41745uAeewU','payment','shop','settings','payout','6137592aIOAYS','getPaymentById','isArray','availableBalance','wallets','ShopService','findFirst','update','lte','shopId','publicKey','telegram','usage','TesSoft\x20Payment\x20System/1.0\x20(Test)','test_order_123','getPayoutStatistics','statusText','../config/database','getShopProfile','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','getPaymentsByShop','test_gateway','reduce','getFullYear','network','revenue','gateways','toISOString','webhookLog','POST','\x20USDT\x20(current\x20balance)','\x20\x20\x20üíµ\x20Available\x20balance:\x20','updateShopProfile','Failed\x20to\x20send\x20webhook:\x20','customer','message','Shop\x20not\x20found','desc'];a53_0x4138=function(){return _0x3e3de3;};return a53_0x4138();}class ShopService{constructor(){const _0x14792a=a53_0x5b8afd;this[_0x14792a(0x243)]=new paymentService_1[(_0x14792a(0x236))]();}async[a53_0x5b8afd(0x1cf)](_0x5a8d57){const _0x40b068=a53_0x5b8afd,_0x2d6982=await database_1['default'][_0x40b068(0x1ba)][_0x40b068(0x219)]({'where':{'id':_0x5a8d57},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2d6982)throw new Error(_0x40b068(0x1e1));let _0x3193a1=[];if(_0x2d6982['settings']?.[_0x40b068(0x22d)])try{_0x3193a1=Array[_0x40b068(0x1bf)](_0x2d6982[_0x40b068(0x1bb)][_0x40b068(0x22d)])?_0x2d6982[_0x40b068(0x1bb)][_0x40b068(0x22d)]:JSON[_0x40b068(0x1f1)](_0x2d6982[_0x40b068(0x1bb)][_0x40b068(0x22d)]);}catch(_0x14cd3b){console[_0x40b068(0x233)](_0x40b068(0x244),_0x14cd3b),_0x3193a1=[];}return{'id':_0x2d6982['id'],'fullName':_0x2d6982['name'],'username':_0x2d6982[_0x40b068(0x22b)],'telegramId':_0x2d6982[_0x40b068(0x1c8)],'merchantUrl':_0x2d6982[_0x40b068(0x1f3)],'gateways':_0x2d6982[_0x40b068(0x241)]?JSON[_0x40b068(0x1f1)](_0x2d6982['paymentGateways']):null,'gatewaySettings':_0x2d6982['gatewaySettings']?JSON['parse'](_0x2d6982[_0x40b068(0x228)]):null,'publicKey':_0x2d6982['publicKey'],'webhookUrl':_0x2d6982[_0x40b068(0x1bb)]?.[_0x40b068(0x212)]||null,'webhookEvents':_0x3193a1,'wallets':{'usdtPolygonWallet':_0x2d6982['usdtPolygonWallet'],'usdtTrcWallet':_0x2d6982[_0x40b068(0x21f)],'usdtErcWallet':_0x2d6982[_0x40b068(0x232)],'usdcPolygonWallet':_0x2d6982[_0x40b068(0x23c)]},'status':_0x2d6982['status'],'createdAt':_0x2d6982[_0x40b068(0x1f9)]};}async[a53_0x5b8afd(0x1dd)](_0x54426c,_0x392c20){const _0x1a9dd3=a53_0x5b8afd,_0x38f6c3={};_0x392c20[_0x1a9dd3(0x204)]&&(_0x38f6c3[_0x1a9dd3(0x213)]=_0x392c20[_0x1a9dd3(0x204)]);_0x392c20['telegramId']!==undefined&&(_0x38f6c3[_0x1a9dd3(0x1c8)]=_0x392c20[_0x1a9dd3(0x1ee)]||null);_0x392c20[_0x1a9dd3(0x1b6)]&&(_0x38f6c3[_0x1a9dd3(0x1f3)]=_0x392c20[_0x1a9dd3(0x1b6)]);_0x392c20[_0x1a9dd3(0x1d7)]&&(_0x38f6c3[_0x1a9dd3(0x241)]=JSON[_0x1a9dd3(0x1ef)](_0x392c20['gateways']));_0x392c20[_0x1a9dd3(0x228)]&&(_0x38f6c3[_0x1a9dd3(0x228)]=JSON[_0x1a9dd3(0x1ef)](_0x392c20[_0x1a9dd3(0x228)]));_0x392c20['wallets']&&(_0x392c20[_0x1a9dd3(0x1c1)]['usdtPolygonWallet']!==undefined&&(_0x38f6c3[_0x1a9dd3(0x20e)]=_0x392c20[_0x1a9dd3(0x1c1)]['usdtPolygonWallet']||null),_0x392c20[_0x1a9dd3(0x1c1)]['usdtTrcWallet']!==undefined&&(_0x38f6c3[_0x1a9dd3(0x21f)]=_0x392c20[_0x1a9dd3(0x1c1)][_0x1a9dd3(0x21f)]||null),_0x392c20['wallets']['usdtErcWallet']!==undefined&&(_0x38f6c3[_0x1a9dd3(0x232)]=_0x392c20[_0x1a9dd3(0x1c1)]['usdtErcWallet']||null),_0x392c20[_0x1a9dd3(0x1c1)]['usdcPolygonWallet']!==undefined&&(_0x38f6c3[_0x1a9dd3(0x23c)]=_0x392c20[_0x1a9dd3(0x1c1)][_0x1a9dd3(0x23c)]||null));const _0x553876=await database_1[_0x1a9dd3(0x242)][_0x1a9dd3(0x1ba)][_0x1a9dd3(0x1c4)]({'where':{'id':_0x54426c},'data':_0x38f6c3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x4a1c4d=[];if(_0x553876[_0x1a9dd3(0x1bb)]?.[_0x1a9dd3(0x22d)])try{_0x4a1c4d=Array['isArray'](_0x553876['settings']['webhookEvents'])?_0x553876[_0x1a9dd3(0x1bb)]['webhookEvents']:JSON[_0x1a9dd3(0x1f1)](_0x553876['settings'][_0x1a9dd3(0x22d)]);}catch(_0x2561e6){console[_0x1a9dd3(0x233)]('Error\x20parsing\x20webhook\x20events:',_0x2561e6),_0x4a1c4d=[];}return{'id':_0x553876['id'],'fullName':_0x553876[_0x1a9dd3(0x213)],'username':_0x553876[_0x1a9dd3(0x22b)],'telegramId':_0x553876['telegram'],'merchantUrl':_0x553876['shopUrl'],'gateways':_0x553876[_0x1a9dd3(0x241)]?JSON['parse'](_0x553876[_0x1a9dd3(0x241)]):null,'gatewaySettings':_0x553876[_0x1a9dd3(0x228)]?JSON[_0x1a9dd3(0x1f1)](_0x553876[_0x1a9dd3(0x228)]):null,'publicKey':_0x553876[_0x1a9dd3(0x1c7)],'webhookUrl':_0x553876[_0x1a9dd3(0x1bb)]?.[_0x1a9dd3(0x212)]||null,'webhookEvents':_0x4a1c4d,'wallets':{'usdtPolygonWallet':_0x553876[_0x1a9dd3(0x20e)],'usdtTrcWallet':_0x553876[_0x1a9dd3(0x21f)],'usdtErcWallet':_0x553876[_0x1a9dd3(0x232)],'usdcPolygonWallet':_0x553876[_0x1a9dd3(0x23c)]},'status':_0x553876[_0x1a9dd3(0x231)],'createdAt':_0x553876['createdAt']};}async['updateWallets'](_0x52241f,_0x4b0d05){const _0x3f56c3=a53_0x5b8afd,_0x38f160={};_0x4b0d05[_0x3f56c3(0x20e)]!==undefined&&(_0x38f160[_0x3f56c3(0x20e)]=_0x4b0d05['usdtPolygonWallet']||null),_0x4b0d05[_0x3f56c3(0x21f)]!==undefined&&(_0x38f160[_0x3f56c3(0x21f)]=_0x4b0d05[_0x3f56c3(0x21f)]||null),_0x4b0d05[_0x3f56c3(0x232)]!==undefined&&(_0x38f160[_0x3f56c3(0x232)]=_0x4b0d05[_0x3f56c3(0x232)]||null),_0x4b0d05[_0x3f56c3(0x23c)]!==undefined&&(_0x38f160[_0x3f56c3(0x23c)]=_0x4b0d05[_0x3f56c3(0x23c)]||null),await database_1['default']['shop'][_0x3f56c3(0x1c4)]({'where':{'id':_0x52241f},'data':_0x38f160});}async[a53_0x5b8afd(0x218)](_0x9c7f36){const _0x16cc37=a53_0x5b8afd,_0x2f3eec=await database_1[_0x16cc37(0x242)]['shop']['findUnique']({'where':{'id':_0x9c7f36},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x2f3eec?.[_0x16cc37(0x1bb)]?.['webhookUrl'])throw new Error('No\x20webhook\x20URL\x20configured');const _0x466d03={'event':_0x16cc37(0x21c),'payment':{'id':'test_payment_123','order_id':_0x16cc37(0x1cb),'gateway':'test','amount':0x64,'currency':_0x16cc37(0x1e9),'status':_0x16cc37(0x202),'created_at':new Date()['toISOString']()}};try{const _0x5d2ddb=await fetch(_0x2f3eec[_0x16cc37(0x1bb)][_0x16cc37(0x212)],{'method':_0x16cc37(0x1da),'headers':{'Content-Type':_0x16cc37(0x22f),'User-Agent':_0x16cc37(0x1ca)},'body':JSON[_0x16cc37(0x1ef)](_0x466d03)});return _0x5d2ddb['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x5d2ddb[_0x16cc37(0x231)]+')'}:{'success':![],'message':_0x16cc37(0x21d)+_0x5d2ddb[_0x16cc37(0x231)]+'\x20'+_0x5d2ddb[_0x16cc37(0x1cd)]};}catch(_0x53c54f){return{'success':![],'message':_0x16cc37(0x1de)+(_0x53c54f instanceof Error?_0x53c54f[_0x16cc37(0x1e0)]:_0x16cc37(0x235))};}}async[a53_0x5b8afd(0x217)](_0x27454a){const _0x5bc6c4=a53_0x5b8afd;return this['paymentService'][_0x5bc6c4(0x221)]({'public_key':'','gateway':_0x27454a[_0x5bc6c4(0x208)],'order_id':undefined,'amount':_0x27454a['amount'],'currency':_0x27454a[_0x5bc6c4(0x223)],'source_currency':_0x27454a[_0x5bc6c4(0x234)],'usage':_0x27454a[_0x5bc6c4(0x1c9)],'expires_at':_0x27454a[_0x5bc6c4(0x23a)]?.[_0x5bc6c4(0x1d8)](),'success_url':_0x27454a[_0x5bc6c4(0x1f8)],'fail_url':_0x27454a[_0x5bc6c4(0x1f8)],'customer_email':_0x27454a[_0x5bc6c4(0x1b5)],'customer_name':_0x27454a[_0x5bc6c4(0x245)],'country':_0x27454a[_0x5bc6c4(0x1f4)],'language':_0x27454a['language'],'amount_is_editable':_0x27454a[_0x5bc6c4(0x1b7)],'max_payments':_0x27454a[_0x5bc6c4(0x238)],'customer':_0x27454a[_0x5bc6c4(0x1df)]});}async[a53_0x5b8afd(0x1f2)](_0x4ec47b,_0x3e1661){const _0x1c1390=a53_0x5b8afd;return this[_0x1c1390(0x243)][_0x1c1390(0x1d1)](_0x4ec47b,_0x3e1661);}async[a53_0x5b8afd(0x1be)](_0x38d38f,_0x7a0477){const _0x2c1228=a53_0x5b8afd;return this[_0x2c1228(0x243)][_0x2c1228(0x23f)](_0x38d38f,_0x7a0477);}async[a53_0x5b8afd(0x23d)](_0x1c72d0,_0x340fc4,_0xee4c07){const _0x163f41=a53_0x5b8afd,_0x3dc17d=await database_1[_0x163f41(0x242)][_0x163f41(0x1b9)][_0x163f41(0x1c3)]({'where':{'id':_0x340fc4,'shopId':_0x1c72d0}});if(!_0x3dc17d)throw new Error(_0x163f41(0x214));const _0x4095b4=await database_1[_0x163f41(0x242)][_0x163f41(0x1b9)]['update']({'where':{'id':_0x340fc4},'data':{..._0xee4c07,'updatedAt':new Date()}});return _0x4095b4;}async['deletePayment'](_0x1efabc,_0x2f5a47){const _0x3108a2=a53_0x5b8afd,_0x167265=await database_1[_0x3108a2(0x242)][_0x3108a2(0x1b9)][_0x3108a2(0x1c3)]({'where':{'id':_0x2f5a47,'shopId':_0x1efabc}});if(!_0x167265)throw new Error('Payment\x20not\x20found');await database_1[_0x3108a2(0x242)]['payment'][_0x3108a2(0x207)]({'where':{'id':_0x2f5a47}});}async[a53_0x5b8afd(0x205)](_0x92f6cc,_0xcca6e2){const _0x24a473=a53_0x5b8afd,{page:_0x4dbd70,limit:_0x255a20,status:_0x2b2fcf,method:_0x2867e0,dateFrom:_0x17f762,dateTo:_0x3c4652,periodFrom:_0x17cb57,periodTo:_0xe5f0bd}=_0xcca6e2,_0x185ce6=(_0x4dbd70-0x1)*_0x255a20,_0x329e03={'shopId':_0x92f6cc};_0x2b2fcf&&(_0x329e03[_0x24a473(0x231)]=_0x2b2fcf[_0x24a473(0x1b3)]());_0x2867e0&&(_0x329e03[_0x24a473(0x1d5)]=_0x2867e0);if(_0x17f762||_0x3c4652||_0x17cb57||_0xe5f0bd){_0x329e03['createdAt']={};if(_0x17cb57)_0x329e03[_0x24a473(0x1f9)][_0x24a473(0x1fa)]=new Date(_0x17cb57);else _0x17f762&&(_0x329e03[_0x24a473(0x1f9)]['gte']=new Date(_0x17f762));if(_0xe5f0bd)_0x329e03[_0x24a473(0x1f9)]['lte']=new Date(_0xe5f0bd);else _0x3c4652&&(_0x329e03[_0x24a473(0x1f9)][_0x24a473(0x1c5)]=new Date(_0x3c4652));}const [_0xfc13d7,_0x35a7d7]=await Promise[_0x24a473(0x1f7)]([database_1[_0x24a473(0x242)][_0x24a473(0x1bc)][_0x24a473(0x1e7)]({'where':_0x329e03,'skip':_0x185ce6,'take':_0x255a20,'orderBy':{'createdAt':_0x24a473(0x1e2)}}),database_1[_0x24a473(0x242)][_0x24a473(0x1bc)][_0x24a473(0x1fc)]({'where':_0x329e03})]);return{'payouts':_0xfc13d7[_0x24a473(0x220)](_0x3617c0=>({'id':_0x3617c0['id'],'amount':_0x3617c0[_0x24a473(0x20b)],'network':_0x3617c0['network'],'status':_0x3617c0[_0x24a473(0x231)],'txid':_0x3617c0[_0x24a473(0x1ae)],'notes':_0x3617c0['notes'],'createdAt':_0x3617c0['createdAt'],'paidAt':_0x3617c0[_0x24a473(0x226)]})),'pagination':{'page':_0x4dbd70,'limit':_0x255a20,'total':_0x35a7d7,'totalPages':Math['ceil'](_0x35a7d7/_0x255a20)}};}async[a53_0x5b8afd(0x201)](_0x3a2c98,_0x5c58b6){const _0x2e05f4=a53_0x5b8afd,_0x1b89d2=await database_1['default']['payout']['findFirst']({'where':{'id':_0x5c58b6,'shopId':_0x3a2c98}});if(!_0x1b89d2)return null;return{'id':_0x1b89d2['id'],'amount':_0x1b89d2[_0x2e05f4(0x20b)],'network':_0x1b89d2[_0x2e05f4(0x1d5)],'status':_0x1b89d2[_0x2e05f4(0x231)],'txid':_0x1b89d2[_0x2e05f4(0x1ae)],'notes':_0x1b89d2[_0x2e05f4(0x1ad)],'createdAt':_0x1b89d2[_0x2e05f4(0x1f9)],'paidAt':_0x1b89d2[_0x2e05f4(0x226)]};}async[a53_0x5b8afd(0x1cc)](_0x5bbc8e,_0xc19a8e){const _0x5245c9=a53_0x5b8afd,_0x5041a4=new Date();let _0x276f17;switch(_0xc19a8e){case'7d':_0x276f17=new Date(_0x5041a4[_0x5245c9(0x1b0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5245c9(0x1ac):_0x276f17=new Date(_0x5041a4[_0x5245c9(0x1b0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5245c9(0x1af):_0x276f17=new Date(_0x5041a4[_0x5245c9(0x1b0)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x276f17=new Date(_0x5041a4[_0x5245c9(0x1b0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x47b0e1,_0x28fad4,_0x5198b3,_0x1dec5c,_0x37466b,_0x3713a6]=await Promise['all']([database_1[_0x5245c9(0x242)][_0x5245c9(0x1bc)][_0x5245c9(0x1fc)]({'where':{'shopId':_0x5bbc8e,'createdAt':{'gte':_0x276f17}}}),database_1[_0x5245c9(0x242)]['payout'][_0x5245c9(0x1fc)]({'where':{'shopId':_0x5bbc8e,'status':_0x5245c9(0x21a),'createdAt':{'gte':_0x276f17}}}),database_1['default'][_0x5245c9(0x1bc)][_0x5245c9(0x1fc)]({'where':{'shopId':_0x5bbc8e,'status':_0x5245c9(0x1b1),'createdAt':{'gte':_0x276f17}}}),database_1[_0x5245c9(0x242)][_0x5245c9(0x1bc)]['count']({'where':{'shopId':_0x5bbc8e,'status':'REJECTED','createdAt':{'gte':_0x276f17}}}),database_1[_0x5245c9(0x242)]['payout'][_0x5245c9(0x1e7)]({'where':{'shopId':_0x5bbc8e,'createdAt':{'gte':_0x276f17}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x5245c9(0x242)][_0x5245c9(0x1bc)][_0x5245c9(0x1e7)]({'where':{'shopId':_0x5bbc8e},'take':0xa,'orderBy':{'createdAt':_0x5245c9(0x1e2)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x4e3c78=_0x37466b['reduce']((_0x50ade0,_0x4e391c)=>_0x50ade0+_0x4e391c[_0x5245c9(0x20b)],0x0),_0x3d00fd=_0x37466b['filter'](_0x3241a4=>_0x3241a4[_0x5245c9(0x231)]===_0x5245c9(0x21a))[_0x5245c9(0x1d3)]((_0x17a4d6,_0x524b70)=>_0x17a4d6+_0x524b70[_0x5245c9(0x20b)],0x0),_0x17d996=_0x37466b[_0x5245c9(0x1fe)](_0x4a4f86=>_0x4a4f86['status']==='PENDING')[_0x5245c9(0x1d3)]((_0x2ddf1c,_0x428794)=>_0x2ddf1c+_0x428794[_0x5245c9(0x20b)],0x0),_0x51f5e5=_0x37466b[_0x5245c9(0x1d3)]((_0x5b1937,_0x1d95c8)=>{const _0xfb917e=_0x5245c9;return _0x5b1937[_0x1d95c8['network']]=(_0x5b1937[_0x1d95c8[_0xfb917e(0x1d5)]]||0x0)+0x1,_0x5b1937;},{}),_0x2986b4=_0x37466b[_0x5245c9(0x1d3)]((_0x4daea5,_0x17d815)=>{const _0x37bc7f=_0x5245c9;return _0x4daea5[_0x17d815[_0x37bc7f(0x231)]]=(_0x4daea5[_0x17d815[_0x37bc7f(0x231)]]||0x0)+0x1,_0x4daea5;},{});return{'totalPayouts':_0x47b0e1,'completedPayouts':_0x28fad4,'pendingPayouts':_0x5198b3,'rejectedPayouts':_0x1dec5c,'totalAmount':_0x4e3c78,'completedAmount':_0x3d00fd,'pendingAmount':_0x17d996,'payoutsByMethod':_0x51f5e5,'payoutsByStatus':_0x2986b4,'recentPayouts':_0x3713a6[_0x5245c9(0x220)](_0x487525=>({'id':_0x487525['id'],'shopId':_0x5bbc8e,'amount':_0x487525[_0x5245c9(0x20b)],'method':_0x487525[_0x5245c9(0x1d5)],'status':_0x487525[_0x5245c9(0x231)],'txid':_0x487525[_0x5245c9(0x1ae)],'createdAt':_0x487525[_0x5245c9(0x1f9)],'paidAt':_0x487525['paidAt']}))};}async['getShopPayoutStats'](_0x480726){const _0x5ee100=a53_0x5b8afd;console[_0x5ee100(0x1b2)]('üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x480726+_0x5ee100(0x22e));const _0xdc4c61=await database_1['default'][_0x5ee100(0x1ba)][_0x5ee100(0x219)]({'where':{'id':_0x480726},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xdc4c61)throw new Error(_0x5ee100(0x1e1));const _0x2dffb6=new Date(),_0x1ea1f8=new Date(_0x2dffb6[_0x5ee100(0x1d4)](),_0x2dffb6[_0x5ee100(0x1ed)](),0x1),_0x10b45d=new Date(_0x2dffb6[_0x5ee100(0x1d4)](),_0x2dffb6['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5f195a=await database_1['default'][_0x5ee100(0x1bc)][_0x5ee100(0x1ab)]({'_sum':{'amount':!![]},'where':{'shopId':_0x480726,'createdAt':{'gte':_0x1ea1f8,'lte':_0x10b45d},'status':_0x5ee100(0x21a)}}),_0x4637a6=_0x5f195a['_sum'][_0x5ee100(0x20b)]||0x0,_0x22d3e1={'availableBalance':Math['round'](_0xdc4c61[_0x5ee100(0x21b)]*0x64)/0x64,'totalPaidOut':Math['round'](_0xdc4c61['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x5ee100(0x1fd)](_0xdc4c61[_0x5ee100(0x21b)]*0x64)/0x64,'thisMonth':Math['round'](_0x4637a6*0x64)/0x64};return console[_0x5ee100(0x1b2)](_0x5ee100(0x200)+_0xdc4c61['username']+_0x5ee100(0x229)),console[_0x5ee100(0x1b2)](_0x5ee100(0x1dc)+_0x22d3e1[_0x5ee100(0x1c0)]+_0x5ee100(0x1db)),console[_0x5ee100(0x1b2)](_0x5ee100(0x1d0)+_0x22d3e1[_0x5ee100(0x1e8)]+_0x5ee100(0x1e6)),console['log'](_0x5ee100(0x1eb)+_0x22d3e1[_0x5ee100(0x21e)]+_0x5ee100(0x1db)),console['log'](_0x5ee100(0x237)+_0x22d3e1[_0x5ee100(0x1ec)]+_0x5ee100(0x20c)),_0x22d3e1;}[a53_0x5b8afd(0x22a)](_0x414bc9){const _0x49b7d0=a53_0x5b8afd,_0x170d7a={'test_gateway':'Test\x20Gateway','plisio':_0x49b7d0(0x216),'rapyd':_0x49b7d0(0x1f0),'noda':_0x49b7d0(0x1e5),'cointopay':_0x49b7d0(0x209),'klyme_eu':_0x49b7d0(0x23b),'klyme_gb':_0x49b7d0(0x1e4),'klyme_de':_0x49b7d0(0x1a9)};return _0x170d7a[_0x414bc9]||_0x414bc9;}async[a53_0x5b8afd(0x203)](_0x27918a){return this['getShopPayoutStats'](_0x27918a);}async['getWebhookLogs'](_0x50b1d7,_0x1dd446){const _0x1f8822=a53_0x5b8afd,{page:_0x56d431,limit:_0x4ff6ce,paymentId:_0x33b058}=_0x1dd446,_0x1e6493=(_0x56d431-0x1)*_0x4ff6ce,_0x3d5414={'shopId':_0x50b1d7};_0x33b058&&(_0x3d5414['paymentId']=_0x33b058);const [_0x44db02,_0x256d61]=await Promise[_0x1f8822(0x1f7)]([database_1[_0x1f8822(0x242)][_0x1f8822(0x1d9)][_0x1f8822(0x1e7)]({'where':_0x3d5414,'skip':_0x1e6493,'take':_0x4ff6ce,'orderBy':{'createdAt':_0x1f8822(0x1e2)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x1f8822(0x242)]['webhookLog'][_0x1f8822(0x1fc)]({'where':_0x3d5414})]);return{'logs':_0x44db02[_0x1f8822(0x220)](_0xc9f9e4=>({'id':_0xc9f9e4['id'],'paymentId':_0xc9f9e4['paymentId'],'shopId':_0xc9f9e4[_0x1f8822(0x1c6)],'event':_0xc9f9e4['event'],'statusCode':_0xc9f9e4[_0x1f8822(0x22c)],'retryCount':_0xc9f9e4['retryCount'],'responseBody':_0xc9f9e4[_0x1f8822(0x230)],'createdAt':_0xc9f9e4['createdAt'],'payment':_0xc9f9e4[_0x1f8822(0x1b9)]})),'pagination':{'page':_0x56d431,'limit':_0x4ff6ce,'total':_0x256d61,'totalPages':Math['ceil'](_0x256d61/_0x4ff6ce)}};}async[a53_0x5b8afd(0x222)](_0x461877,_0x5a556e){const _0x320018=a53_0x5b8afd,_0x541af5=new Date();let _0x34d239;switch(_0x5a556e){case'7d':_0x34d239=new Date(_0x541af5[_0x320018(0x1b0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x320018(0x1ac):_0x34d239=new Date(_0x541af5['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x320018(0x1af):_0x34d239=new Date(_0x541af5[_0x320018(0x1b0)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x34d239=new Date(_0x541af5[_0x320018(0x1b0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xd88cf1,_0x514c59,_0x2561a6,_0x580d5a,_0x2a8d2d]=await Promise[_0x320018(0x1f7)]([database_1['default']['payment']['count']({'where':{'shopId':_0x461877,'gateway':{'not':_0x320018(0x1d2)},'createdAt':{'gte':_0x34d239}}}),database_1['default']['payment'][_0x320018(0x1fc)]({'where':{'shopId':_0x461877,'gateway':{'not':_0x320018(0x1d2)},'status':_0x320018(0x211),'createdAt':{'gte':_0x34d239}}}),database_1[_0x320018(0x242)][_0x320018(0x1b9)][_0x320018(0x1e7)]({'where':{'shopId':_0x461877,'gateway':{'not':_0x320018(0x1d2)},'status':_0x320018(0x211),'createdAt':{'gte':_0x34d239}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x320018(0x242)][_0x320018(0x1b9)][_0x320018(0x1e7)]({'where':{'shopId':_0x461877,'gateway':{'not':_0x320018(0x1d2)}},'take':0xa,'orderBy':{'createdAt':_0x320018(0x1e2)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x320018(0x242)]['payment'][_0x320018(0x1e7)]({'where':{'shopId':_0x461877,'gateway':{'not':_0x320018(0x1d2)},'createdAt':{'gte':_0x34d239}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x320018(0x20d)}})]);let _0x5eb6e3=0x0;for(const _0xf3dd88 of _0x2561a6){if(_0xf3dd88[_0x320018(0x20f)])_0x5eb6e3+=_0xf3dd88[_0x320018(0x20f)];else{const _0x4e91ba=await currencyService_1[_0x320018(0x1ff)][_0x320018(0x227)](_0xf3dd88[_0x320018(0x20b)],_0xf3dd88[_0x320018(0x223)]);_0x5eb6e3+=_0x4e91ba;}}const _0x3977df=this['generateDailyStatistics'](_0x2a8d2d,_0x34d239,_0x541af5),_0x3ef88b=_0xd88cf1>0x0?_0x514c59/_0xd88cf1*0x64:0x0;return{'totalPayments':_0xd88cf1,'successfulPayments':_0x514c59,'totalRevenue':Math[_0x320018(0x1fd)](_0x5eb6e3*0x64)/0x64,'conversionRate':Math['round'](_0x3ef88b*0x64)/0x64,'dailyRevenue':_0x3977df[_0x320018(0x1fb)],'dailyPayments':_0x3977df['dailyPayments'],'recentPayments':_0x580d5a['map'](_0x3364d5=>({'id':_0x3364d5['id'],'gateway':_0x3364d5['gateway'],'amount':_0x3364d5[_0x320018(0x20b)],'currency':_0x3364d5[_0x320018(0x223)],'status':_0x3364d5[_0x320018(0x231)],'createdAt':_0x3364d5[_0x320018(0x1f9)]}))};}['generateDailyStatistics'](_0x36b831,_0x554f49,_0x3f78d8){const _0x25b0df=a53_0x5b8afd,_0x4f828a=new Map(),_0x4ec307=new Date(_0x554f49);while(_0x4ec307<=_0x3f78d8){const _0x1379a7=_0x4ec307['toISOString']()['split']('T')[0x0];_0x4f828a['set'](_0x1379a7,{'revenue':0x0,'count':0x0}),_0x4ec307[_0x25b0df(0x224)](_0x4ec307['getDate']()+0x1);}for(const _0x228e2a of _0x36b831){const _0x49d638=_0x228e2a[_0x25b0df(0x1f9)][_0x25b0df(0x1d8)]()[_0x25b0df(0x1b4)]('T')[0x0],_0x3d2be3=_0x4f828a[_0x25b0df(0x23e)](_0x49d638);_0x3d2be3&&(_0x3d2be3['count']+=0x1,_0x228e2a[_0x25b0df(0x231)]==='PAID'&&_0x228e2a[_0x25b0df(0x20f)]&&(_0x3d2be3[_0x25b0df(0x1d6)]+=_0x228e2a['amountUSDT']));}const _0x4aece1=[],_0x20f470=[];for(const [_0x224765,_0x12a4ba]of _0x4f828a){_0x4aece1[_0x25b0df(0x1f5)]({'date':_0x224765,'amount':Math[_0x25b0df(0x1fd)](_0x12a4ba[_0x25b0df(0x1d6)]*0x64)/0x64}),_0x20f470['push']({'date':_0x224765,'count':_0x12a4ba[_0x25b0df(0x1fc)]});}return{'dailyRevenue':_0x4aece1,'dailyPayments':_0x20f470};}}exports[a53_0x5b8afd(0x1c2)]=ShopService;