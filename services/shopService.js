'use strict';const a56_0x57a587=a56_0x2b56;function a56_0x2b56(_0x2ce738,_0x1b304a){const _0x11d183=a56_0x11d1();return a56_0x2b56=function(_0x2b56be,_0x40f6b6){_0x2b56be=_0x2b56be-0xaa;let _0x448642=_0x11d183[_0x2b56be];return _0x448642;},a56_0x2b56(_0x2ce738,_0x1b304a);}(function(_0x374da8,_0x2d8bdc){const _0xe86614=a56_0x2b56,_0x247469=_0x374da8();while(!![]){try{const _0x4f1ad8=parseInt(_0xe86614(0x112))/0x1+parseInt(_0xe86614(0xc5))/0x2*(-parseInt(_0xe86614(0xf6))/0x3)+parseInt(_0xe86614(0x14f))/0x4*(parseInt(_0xe86614(0x155))/0x5)+-parseInt(_0xe86614(0xaa))/0x6*(parseInt(_0xe86614(0x10f))/0x7)+parseInt(_0xe86614(0x116))/0x8*(-parseInt(_0xe86614(0x131))/0x9)+parseInt(_0xe86614(0xbd))/0xa*(-parseInt(_0xe86614(0xf7))/0xb)+parseInt(_0xe86614(0xb1))/0xc*(parseInt(_0xe86614(0xbb))/0xd);if(_0x4f1ad8===_0x2d8bdc)break;else _0x247469['push'](_0x247469['shift']());}catch(_0x875ba7){_0x247469['push'](_0x247469['shift']());}}}(a56_0x11d1,0x93ca2));function a56_0x11d1(){const _0x2d769f=['üìä\x20Status\x20filter:\x20','CoinToPay','No\x20webhook\x20URL\x20configured','KLYME\x20EU','getPayments','round','getShopPayoutStats','publicKey','747iPYqan','2231812RsFPZp','lte','USDT\x20Polygon','COMPLETED','periodFrom','count','getShopProfile','fullName','\x20USDT\x20(current\x20balance)','polygon_usdc','event','country','üìÖ\x20Period\x20end:\x20','usage','shopUrl','customer','getPayoutById','Plisio','usdtTrcWallet','Test\x20webhook\x20sent\x20successfully\x20(','deletePayment','reduce','__esModule','name','14etIFpe','gateways','formatNetworkName','458143kAubwb','createdAt','status','filter','592zmipPt','\x20USDT','notes','maxPayments','erc20','findFirst','expiresAt','toUpperCase','merchantUrl','Unknown\x20error','paid','getPayoutStatistics','redirectUrl','all','findMany','periodTo','üåê\x20Method\x20filter:\x20','test_order_123','\x20\x20\x20üíµ\x20Available\x20balance:\x20','generateDailyStatistics','statusCode','balance','üìÖ\x20Date\x20end:\x20','map','üìÖ\x20Period\x20start:\x20','currencyService','currency','121032zeaOeM','message','USDT\x20TRC20','stringify','update','USDT\x20BSC','dailyPayments','thisMonth','test_gateway','getTime','error','üí∞\x20Getting\x20payouts\x20with\x20filters:','PENDING','ceil','Webhook\x20returned\x20error:\x20','push','isArray','Noda','telegramId','getStatistics','convertToUSDT','getPaymentsByShop','gte','USDT\x20ERC20','Test\x20Gateway','defineProperty','KLYME\x20DE','telegram','payment','toISOString','4690092moNpGw','delete','Rapyd','statusText','amountIsEditable','getFullYear','5uTpORD','getPayoutStats','_sum','\x20USDT\x20(total\x20payouts)','getPaymentById','settings','USDC\x20Polygon','split','dailyRevenue','680130pszkqy','getWebhookLogs','ShopService','revenue','polygon','availableBalance','payout','228yvZKyY','webhookUrl','../config/database','90d','getPayouts','set','Shop\x20not\x20found','getMonth','webhookEvents','test','941993SRNLfV','Payment\x20not\x20found','10JbEIPe','sourceCurrency','getPaymentByShopAndId','findUnique','log','default','retryCount','...','7850MNhEuW','./currencyService','shop','getDate','paymentId','parse','wallets','PAID','Error\x20parsing\x20webhook\x20events:','REJECTED','network','gateway','webhookLog','desc','__importDefault','updateShopProfile','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','./paymentService','paidAt','asc','paymentGateways','POST','usdtErcWallet','TesSoft\x20Payment\x20System/1.0\x20(Test)','gatewaySettings','txid','amount','shopId','setDate','language','usdcPolygonWallet','üìä\x20Shop\x20','amountUSDT','username','setHours','paymentService','createPayment','updateWallets','awaitingPayout','trc20','usdtPolygonWallet'];a56_0x11d1=function(){return _0x2d769f;};return a56_0x11d1();}var __importDefault=this&&this[a56_0x57a587(0xd3)]||function(_0xa6f35d){return _0xa6f35d&&_0xa6f35d['__esModule']?_0xa6f35d:{'default':_0xa6f35d};};Object[a56_0x57a587(0x14a)](exports,a56_0x57a587(0x10d),{'value':!![]}),exports[a56_0x57a587(0xac)]=void 0x0;const database_1=__importDefault(require(a56_0x57a587(0xb3))),currencyService_1=require(a56_0x57a587(0xc6)),paymentService_1=require(a56_0x57a587(0xd6));class ShopService{constructor(){const _0xab1ae1=a56_0x57a587;this[_0xab1ae1(0xe8)]=new paymentService_1['PaymentService']();}async[a56_0x57a587(0xfd)](_0x38a76b){const _0x5ef569=a56_0x57a587,_0x926ed8=await database_1[_0x5ef569(0xc2)][_0x5ef569(0xc7)][_0x5ef569(0xc0)]({'where':{'id':_0x38a76b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x926ed8)throw new Error(_0x5ef569(0xb7));let _0x418522=[];if(_0x926ed8[_0x5ef569(0x15a)]?.['webhookEvents'])try{_0x418522=Array[_0x5ef569(0x141)](_0x926ed8['settings'][_0x5ef569(0xb9)])?_0x926ed8[_0x5ef569(0x15a)][_0x5ef569(0xb9)]:JSON['parse'](_0x926ed8[_0x5ef569(0x15a)]['webhookEvents']);}catch(_0x50e3c6){console[_0x5ef569(0x13b)](_0x5ef569(0xcd),_0x50e3c6),_0x418522=[];}return{'id':_0x926ed8['id'],'fullName':_0x926ed8[_0x5ef569(0x10e)],'username':_0x926ed8[_0x5ef569(0xe6)],'telegramId':_0x926ed8['telegram'],'merchantUrl':_0x926ed8[_0x5ef569(0x105)],'gateways':_0x926ed8[_0x5ef569(0xd9)]?JSON['parse'](_0x926ed8['paymentGateways']):null,'gatewaySettings':_0x926ed8['gatewaySettings']?JSON[_0x5ef569(0xca)](_0x926ed8[_0x5ef569(0xdd)]):null,'publicKey':_0x926ed8[_0x5ef569(0xf5)],'webhookUrl':_0x926ed8[_0x5ef569(0x15a)]?.[_0x5ef569(0xb2)]||null,'webhookEvents':_0x418522,'wallets':{'usdtPolygonWallet':_0x926ed8[_0x5ef569(0xed)],'usdtTrcWallet':_0x926ed8[_0x5ef569(0x109)],'usdtErcWallet':_0x926ed8['usdtErcWallet'],'usdcPolygonWallet':_0x926ed8[_0x5ef569(0xe3)]},'status':_0x926ed8['status'],'createdAt':_0x926ed8[_0x5ef569(0x113)]};}async[a56_0x57a587(0xd4)](_0x5c360b,_0x189aca){const _0x4510eb=a56_0x57a587,_0x5cf510={};_0x189aca[_0x4510eb(0xfe)]&&(_0x5cf510[_0x4510eb(0x10e)]=_0x189aca[_0x4510eb(0xfe)]);_0x189aca[_0x4510eb(0x143)]!==undefined&&(_0x5cf510[_0x4510eb(0x14c)]=_0x189aca[_0x4510eb(0x143)]||null);_0x189aca[_0x4510eb(0x11e)]&&(_0x5cf510[_0x4510eb(0x105)]=_0x189aca[_0x4510eb(0x11e)]);_0x189aca['gateways']&&(_0x5cf510[_0x4510eb(0xd9)]=JSON['stringify'](_0x189aca[_0x4510eb(0x110)]));_0x189aca[_0x4510eb(0xdd)]&&(_0x5cf510[_0x4510eb(0xdd)]=JSON[_0x4510eb(0x134)](_0x189aca['gatewaySettings']));_0x189aca[_0x4510eb(0xcb)]&&(_0x189aca[_0x4510eb(0xcb)]['usdtPolygonWallet']!==undefined&&(_0x5cf510[_0x4510eb(0xed)]=_0x189aca[_0x4510eb(0xcb)]['usdtPolygonWallet']||null),_0x189aca[_0x4510eb(0xcb)]['usdtTrcWallet']!==undefined&&(_0x5cf510[_0x4510eb(0x109)]=_0x189aca[_0x4510eb(0xcb)]['usdtTrcWallet']||null),_0x189aca['wallets'][_0x4510eb(0xdb)]!==undefined&&(_0x5cf510[_0x4510eb(0xdb)]=_0x189aca['wallets'][_0x4510eb(0xdb)]||null),_0x189aca[_0x4510eb(0xcb)][_0x4510eb(0xe3)]!==undefined&&(_0x5cf510[_0x4510eb(0xe3)]=_0x189aca[_0x4510eb(0xcb)][_0x4510eb(0xe3)]||null));const _0x274964=await database_1[_0x4510eb(0xc2)][_0x4510eb(0xc7)][_0x4510eb(0x135)]({'where':{'id':_0x5c360b},'data':_0x5cf510,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x3a85b4=[];if(_0x274964[_0x4510eb(0x15a)]?.['webhookEvents'])try{_0x3a85b4=Array[_0x4510eb(0x141)](_0x274964['settings']['webhookEvents'])?_0x274964[_0x4510eb(0x15a)][_0x4510eb(0xb9)]:JSON[_0x4510eb(0xca)](_0x274964[_0x4510eb(0x15a)]['webhookEvents']);}catch(_0x247023){console['error'](_0x4510eb(0xcd),_0x247023),_0x3a85b4=[];}return{'id':_0x274964['id'],'fullName':_0x274964[_0x4510eb(0x10e)],'username':_0x274964[_0x4510eb(0xe6)],'telegramId':_0x274964[_0x4510eb(0x14c)],'merchantUrl':_0x274964[_0x4510eb(0x105)],'gateways':_0x274964[_0x4510eb(0xd9)]?JSON['parse'](_0x274964[_0x4510eb(0xd9)]):null,'gatewaySettings':_0x274964[_0x4510eb(0xdd)]?JSON[_0x4510eb(0xca)](_0x274964['gatewaySettings']):null,'publicKey':_0x274964[_0x4510eb(0xf5)],'webhookUrl':_0x274964[_0x4510eb(0x15a)]?.['webhookUrl']||null,'webhookEvents':_0x3a85b4,'wallets':{'usdtPolygonWallet':_0x274964[_0x4510eb(0xed)],'usdtTrcWallet':_0x274964[_0x4510eb(0x109)],'usdtErcWallet':_0x274964[_0x4510eb(0xdb)],'usdcPolygonWallet':_0x274964[_0x4510eb(0xe3)]},'status':_0x274964[_0x4510eb(0x114)],'createdAt':_0x274964['createdAt']};}async[a56_0x57a587(0xea)](_0x5f25f2,_0x3f2cbe){const _0x2b51be=a56_0x57a587,_0x19d1db={};_0x3f2cbe[_0x2b51be(0xed)]!==undefined&&(_0x19d1db[_0x2b51be(0xed)]=_0x3f2cbe[_0x2b51be(0xed)]||null),_0x3f2cbe['usdtTrcWallet']!==undefined&&(_0x19d1db[_0x2b51be(0x109)]=_0x3f2cbe[_0x2b51be(0x109)]||null),_0x3f2cbe[_0x2b51be(0xdb)]!==undefined&&(_0x19d1db[_0x2b51be(0xdb)]=_0x3f2cbe['usdtErcWallet']||null),_0x3f2cbe['usdcPolygonWallet']!==undefined&&(_0x19d1db[_0x2b51be(0xe3)]=_0x3f2cbe[_0x2b51be(0xe3)]||null),await database_1[_0x2b51be(0xc2)][_0x2b51be(0xc7)][_0x2b51be(0x135)]({'where':{'id':_0x5f25f2},'data':_0x19d1db});}async['testWebhook'](_0x3fb939){const _0x28d797=a56_0x57a587,_0x5eadca=await database_1[_0x28d797(0xc2)]['shop'][_0x28d797(0xc0)]({'where':{'id':_0x3fb939},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x5eadca?.[_0x28d797(0x15a)]?.[_0x28d797(0xb2)])throw new Error(_0x28d797(0xf0));const _0x3f0a08={'event':_0x28d797(0xba),'payment':{'id':'test_payment_123','order_id':_0x28d797(0x127),'gateway':_0x28d797(0xba),'amount':0x64,'currency':'USD','status':_0x28d797(0x120),'created_at':new Date()[_0x28d797(0x14e)]()}};try{const _0x1b6dbb=await fetch(_0x5eadca[_0x28d797(0x15a)]['webhookUrl'],{'method':_0x28d797(0xda),'headers':{'Content-Type':'application/json','User-Agent':_0x28d797(0xdc)},'body':JSON['stringify'](_0x3f0a08)});return _0x1b6dbb['ok']?{'success':!![],'message':_0x28d797(0x10a)+_0x1b6dbb['status']+')'}:{'success':![],'message':_0x28d797(0x13f)+_0x1b6dbb[_0x28d797(0x114)]+'\x20'+_0x1b6dbb[_0x28d797(0x152)]};}catch(_0x3cef93){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x3cef93 instanceof Error?_0x3cef93[_0x28d797(0x132)]:_0x28d797(0x11f))};}}async[a56_0x57a587(0xe9)](_0x142b40){const _0x893385=a56_0x57a587;return this[_0x893385(0xe8)]['createPublicPayment']({'public_key':'','gateway':_0x142b40[_0x893385(0xd0)],'order_id':undefined,'amount':_0x142b40[_0x893385(0xdf)],'currency':_0x142b40[_0x893385(0x130)],'source_currency':_0x142b40[_0x893385(0xbe)],'usage':_0x142b40[_0x893385(0x104)],'expires_at':_0x142b40[_0x893385(0x11c)]?.[_0x893385(0x14e)](),'success_url':_0x142b40[_0x893385(0x122)],'fail_url':_0x142b40['redirectUrl'],'customer_email':_0x142b40['customerEmail'],'customer_name':_0x142b40['customerName'],'country':_0x142b40[_0x893385(0x102)],'language':_0x142b40[_0x893385(0xe2)],'amount_is_editable':_0x142b40[_0x893385(0x153)],'max_payments':_0x142b40[_0x893385(0x119)],'customer':_0x142b40[_0x893385(0x106)]});}async[a56_0x57a587(0xf2)](_0x22e309,_0x4496f6){const _0x4e3dec=a56_0x57a587;return this['paymentService'][_0x4e3dec(0x146)](_0x22e309,_0x4496f6);}async[a56_0x57a587(0x159)](_0x10339a,_0x34509e){const _0xbb4428=a56_0x57a587;return this[_0xbb4428(0xe8)][_0xbb4428(0xbf)](_0x10339a,_0x34509e);}async['updatePayment'](_0x270c7c,_0x37ae3b,_0xc489f0){const _0x45ef3e=a56_0x57a587,_0x45c20d=await database_1['default'][_0x45ef3e(0x14d)]['findFirst']({'where':{'id':_0x37ae3b,'shopId':_0x270c7c}});if(!_0x45c20d)throw new Error(_0x45ef3e(0xbc));const _0x7e1c1c=await database_1[_0x45ef3e(0xc2)][_0x45ef3e(0x14d)]['update']({'where':{'id':_0x37ae3b},'data':{..._0xc489f0,'updatedAt':new Date()}});return _0x7e1c1c;}async[a56_0x57a587(0x10b)](_0x21ee4f,_0x18deb0){const _0x2b6775=a56_0x57a587,_0x159823=await database_1['default'][_0x2b6775(0x14d)][_0x2b6775(0x11b)]({'where':{'id':_0x18deb0,'shopId':_0x21ee4f}});if(!_0x159823)throw new Error(_0x2b6775(0xbc));await database_1['default'][_0x2b6775(0x14d)][_0x2b6775(0x150)]({'where':{'id':_0x18deb0}});}[a56_0x57a587(0x111)](_0x41f055){const _0x337508=a56_0x57a587,_0xbfd378={'polygon':_0x337508(0xf9),'trc20':_0x337508(0x133),'erc20':_0x337508(0x148),'bsc':_0x337508(0x136),'polygon_usdc':_0x337508(0x15b)};return _0xbfd378[_0x41f055]||_0x41f055;}async[a56_0x57a587(0xb5)](_0x288163,_0x498560){const _0x1fa8a4=a56_0x57a587,{page:_0x5e4d50,limit:_0x595832,status:_0x237d9c,method:_0x1ca4e7,network:_0x3d6cac,dateFrom:_0x4a7c6f,dateTo:_0x5ee5c0,periodFrom:_0x7864d,periodTo:_0x5b716a}=_0x498560,_0x2a6f33=(_0x5e4d50-0x1)*_0x595832;console[_0x1fa8a4(0xc1)](_0x1fa8a4(0x13c),_0x498560);const _0x148c8a={'shopId':_0x288163};_0x237d9c&&(_0x148c8a[_0x1fa8a4(0x114)]=_0x237d9c['toUpperCase'](),console[_0x1fa8a4(0xc1)](_0x1fa8a4(0xee)+_0x237d9c[_0x1fa8a4(0x11d)]()));if(_0x1ca4e7)_0x148c8a[_0x1fa8a4(0xcf)]=_0x1ca4e7,console[_0x1fa8a4(0xc1)](_0x1fa8a4(0x126)+_0x1ca4e7);else _0x3d6cac&&(_0x148c8a[_0x1fa8a4(0xcf)]=_0x3d6cac,console[_0x1fa8a4(0xc1)]('üåê\x20Network\x20filter:\x20'+_0x3d6cac));if(_0x4a7c6f||_0x5ee5c0||_0x7864d||_0x5b716a){_0x148c8a[_0x1fa8a4(0x113)]={};if(_0x7864d){const _0x285d95=new Date(_0x7864d);_0x285d95[_0x1fa8a4(0xe7)](0x0,0x0,0x0,0x0),_0x148c8a[_0x1fa8a4(0x113)][_0x1fa8a4(0x147)]=_0x285d95,console['log'](_0x1fa8a4(0x12e)+_0x285d95[_0x1fa8a4(0x14e)]());}else{if(_0x4a7c6f){const _0x38fbc3=new Date(_0x4a7c6f);_0x38fbc3[_0x1fa8a4(0xe7)](0x0,0x0,0x0,0x0),_0x148c8a['createdAt'][_0x1fa8a4(0x147)]=_0x38fbc3,console[_0x1fa8a4(0xc1)]('üìÖ\x20Date\x20start:\x20'+_0x38fbc3['toISOString']());}}if(_0x5b716a){const _0x5036fc=new Date(_0x5b716a);_0x5036fc[_0x1fa8a4(0xe7)](0x17,0x3b,0x3b,0x3e7),_0x148c8a['createdAt']['lte']=_0x5036fc,console[_0x1fa8a4(0xc1)](_0x1fa8a4(0x103)+_0x5036fc[_0x1fa8a4(0x14e)]());}else{if(_0x5ee5c0){const _0x4004df=new Date(_0x5ee5c0);_0x4004df[_0x1fa8a4(0xe7)](0x17,0x3b,0x3b,0x3e7),_0x148c8a[_0x1fa8a4(0x113)][_0x1fa8a4(0xf8)]=_0x4004df,console[_0x1fa8a4(0xc1)](_0x1fa8a4(0x12c)+_0x4004df[_0x1fa8a4(0x14e)]());}}}console[_0x1fa8a4(0xc1)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x1fa8a4(0x134)](_0x148c8a,null,0x2));const [_0x4a9f00,_0x5065e6]=await Promise[_0x1fa8a4(0x123)]([database_1[_0x1fa8a4(0xc2)][_0x1fa8a4(0xb0)][_0x1fa8a4(0x124)]({'where':_0x148c8a,'skip':_0x2a6f33,'take':_0x595832,'orderBy':{'createdAt':_0x1fa8a4(0xd2)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x1fa8a4(0xc2)][_0x1fa8a4(0xb0)]['count']({'where':_0x148c8a})]);return{'payouts':_0x4a9f00[_0x1fa8a4(0x12d)](_0x30ac42=>{const _0x3483e4=_0x1fa8a4;let _0x108c11=null;switch(_0x30ac42[_0x3483e4(0xcf)]){case _0x3483e4(0xae):_0x108c11=_0x30ac42[_0x3483e4(0xc7)][_0x3483e4(0xed)];break;case _0x3483e4(0xec):_0x108c11=_0x30ac42['shop'][_0x3483e4(0x109)];break;case _0x3483e4(0x11a):_0x108c11=_0x30ac42[_0x3483e4(0xc7)][_0x3483e4(0xdb)];break;case _0x3483e4(0x100):_0x108c11=_0x30ac42[_0x3483e4(0xc7)][_0x3483e4(0xe3)];break;}return{'id':_0x30ac42['id'],'amount':_0x30ac42[_0x3483e4(0xdf)],'network':this['formatNetworkName'](_0x30ac42[_0x3483e4(0xcf)]),'wallet':_0x108c11,'status':_0x30ac42[_0x3483e4(0x114)],'txid':_0x30ac42[_0x3483e4(0xde)],'notes':_0x30ac42[_0x3483e4(0x118)],'periodFrom':_0x30ac42[_0x3483e4(0xfb)],'periodTo':_0x30ac42[_0x3483e4(0x125)],'createdAt':_0x30ac42[_0x3483e4(0x113)],'paidAt':_0x30ac42[_0x3483e4(0xd7)]};}),'pagination':{'page':_0x5e4d50,'limit':_0x595832,'total':_0x5065e6,'totalPages':Math[_0x1fa8a4(0x13e)](_0x5065e6/_0x595832)}};}async[a56_0x57a587(0x107)](_0x457706,_0x322430){const _0xe84ebf=a56_0x57a587,_0x590e30=await database_1[_0xe84ebf(0xc2)]['payout'][_0xe84ebf(0x11b)]({'where':{'id':_0x322430,'shopId':_0x457706}});if(!_0x590e30)return null;return{'id':_0x590e30['id'],'amount':_0x590e30[_0xe84ebf(0xdf)],'network':_0x590e30[_0xe84ebf(0xcf)],'status':_0x590e30[_0xe84ebf(0x114)],'txid':_0x590e30['txid'],'notes':_0x590e30[_0xe84ebf(0x118)],'createdAt':_0x590e30[_0xe84ebf(0x113)],'paidAt':_0x590e30[_0xe84ebf(0xd7)]};}async[a56_0x57a587(0x121)](_0x1a44a7,_0x2ffcbe){const _0x3cf6bf=a56_0x57a587,_0x3b980d=new Date();let _0x4e99ea;switch(_0x2ffcbe){case'7d':_0x4e99ea=new Date(_0x3b980d[_0x3cf6bf(0x13a)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4e99ea=new Date(_0x3b980d[_0x3cf6bf(0x13a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x4e99ea=new Date(_0x3b980d[_0x3cf6bf(0x13a)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4e99ea=new Date(_0x3b980d[_0x3cf6bf(0x13a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x87bc3f,_0x3cfefc,_0x5a8df3,_0x2605c8,_0x51cc95,_0x2c1cb4]=await Promise[_0x3cf6bf(0x123)]([database_1[_0x3cf6bf(0xc2)][_0x3cf6bf(0xb0)][_0x3cf6bf(0xfc)]({'where':{'shopId':_0x1a44a7,'createdAt':{'gte':_0x4e99ea}}}),database_1[_0x3cf6bf(0xc2)][_0x3cf6bf(0xb0)][_0x3cf6bf(0xfc)]({'where':{'shopId':_0x1a44a7,'status':'COMPLETED','createdAt':{'gte':_0x4e99ea}}}),database_1[_0x3cf6bf(0xc2)][_0x3cf6bf(0xb0)][_0x3cf6bf(0xfc)]({'where':{'shopId':_0x1a44a7,'status':'PENDING','createdAt':{'gte':_0x4e99ea}}}),database_1[_0x3cf6bf(0xc2)]['payout'][_0x3cf6bf(0xfc)]({'where':{'shopId':_0x1a44a7,'status':_0x3cf6bf(0xce),'createdAt':{'gte':_0x4e99ea}}}),database_1['default'][_0x3cf6bf(0xb0)][_0x3cf6bf(0x124)]({'where':{'shopId':_0x1a44a7,'createdAt':{'gte':_0x4e99ea}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x3cf6bf(0xc2)][_0x3cf6bf(0xb0)][_0x3cf6bf(0x124)]({'where':{'shopId':_0x1a44a7},'take':0xa,'orderBy':{'createdAt':_0x3cf6bf(0xd2)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x29021f=_0x51cc95['reduce']((_0x4a298f,_0x444833)=>_0x4a298f+_0x444833[_0x3cf6bf(0xdf)],0x0),_0x2ba231=_0x51cc95[_0x3cf6bf(0x115)](_0x22270c=>_0x22270c['status']===_0x3cf6bf(0xfa))['reduce']((_0x40bd4a,_0x2d5983)=>_0x40bd4a+_0x2d5983[_0x3cf6bf(0xdf)],0x0),_0x26c482=_0x51cc95['filter'](_0x292d53=>_0x292d53['status']===_0x3cf6bf(0x13d))[_0x3cf6bf(0x10c)]((_0x198eea,_0x80aac6)=>_0x198eea+_0x80aac6[_0x3cf6bf(0xdf)],0x0),_0x922846=_0x51cc95[_0x3cf6bf(0x10c)]((_0x32a594,_0x7b60d3)=>{const _0x2e46d1=_0x3cf6bf;return _0x32a594[_0x7b60d3[_0x2e46d1(0xcf)]]=(_0x32a594[_0x7b60d3[_0x2e46d1(0xcf)]]||0x0)+0x1,_0x32a594;},{}),_0x471c5a=_0x51cc95[_0x3cf6bf(0x10c)]((_0x1bc38a,_0xf7650b)=>{const _0x3e3d9e=_0x3cf6bf;return _0x1bc38a[_0xf7650b[_0x3e3d9e(0x114)]]=(_0x1bc38a[_0xf7650b['status']]||0x0)+0x1,_0x1bc38a;},{});return{'totalPayouts':_0x87bc3f,'completedPayouts':_0x3cfefc,'pendingPayouts':_0x5a8df3,'rejectedPayouts':_0x2605c8,'totalAmount':_0x29021f,'completedAmount':_0x2ba231,'pendingAmount':_0x26c482,'payoutsByMethod':_0x922846,'payoutsByStatus':_0x471c5a,'recentPayouts':_0x2c1cb4[_0x3cf6bf(0x12d)](_0x4d8e32=>({'id':_0x4d8e32['id'],'shopId':_0x1a44a7,'amount':_0x4d8e32[_0x3cf6bf(0xdf)],'method':_0x4d8e32[_0x3cf6bf(0xcf)],'status':_0x4d8e32[_0x3cf6bf(0x114)],'txid':_0x4d8e32['txid'],'createdAt':_0x4d8e32[_0x3cf6bf(0x113)],'paidAt':_0x4d8e32[_0x3cf6bf(0xd7)]}))};}async[a56_0x57a587(0xf4)](_0x10c8b2){const _0x3954dd=a56_0x57a587;console[_0x3954dd(0xc1)](_0x3954dd(0xd5)+_0x10c8b2+_0x3954dd(0xc4));const _0x49cc98=await database_1[_0x3954dd(0xc2)][_0x3954dd(0xc7)][_0x3954dd(0xc0)]({'where':{'id':_0x10c8b2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x49cc98)throw new Error(_0x3954dd(0xb7));const _0x589776=new Date(),_0x389de7=new Date(_0x589776[_0x3954dd(0x154)](),_0x589776[_0x3954dd(0xb8)](),0x1),_0x18c09a=new Date(_0x589776[_0x3954dd(0x154)](),_0x589776[_0x3954dd(0xb8)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3a269f=await database_1[_0x3954dd(0xc2)][_0x3954dd(0xb0)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x10c8b2,'createdAt':{'gte':_0x389de7,'lte':_0x18c09a},'status':_0x3954dd(0xfa)}}),_0x3b6f7e=_0x3a269f[_0x3954dd(0x157)][_0x3954dd(0xdf)]||0x0,_0x180076={'availableBalance':Math[_0x3954dd(0xf3)](_0x49cc98[_0x3954dd(0x12b)]*0x64)/0x64,'totalPaidOut':Math[_0x3954dd(0xf3)](_0x49cc98['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x3954dd(0xf3)](_0x49cc98[_0x3954dd(0x12b)]*0x64)/0x64,'thisMonth':Math[_0x3954dd(0xf3)](_0x3b6f7e*0x64)/0x64};return console[_0x3954dd(0xc1)](_0x3954dd(0xe4)+_0x49cc98[_0x3954dd(0xe6)]+'\x20payout\x20statistics\x20calculated:'),console[_0x3954dd(0xc1)](_0x3954dd(0x128)+_0x180076[_0x3954dd(0xaf)]+_0x3954dd(0xff)),console[_0x3954dd(0xc1)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x180076['totalPaidOut']+_0x3954dd(0x158)),console[_0x3954dd(0xc1)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x180076[_0x3954dd(0xeb)]+_0x3954dd(0xff)),console[_0x3954dd(0xc1)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x180076[_0x3954dd(0x138)]+_0x3954dd(0x117)),_0x180076;}['getGatewayDisplayName'](_0x3725e2){const _0x17d1a8=a56_0x57a587,_0x61f8c={'test_gateway':_0x17d1a8(0x149),'plisio':_0x17d1a8(0x108),'rapyd':_0x17d1a8(0x151),'noda':_0x17d1a8(0x142),'cointopay':_0x17d1a8(0xef),'klyme_eu':_0x17d1a8(0xf1),'klyme_gb':'KLYME\x20GB','klyme_de':_0x17d1a8(0x14b)};return _0x61f8c[_0x3725e2]||_0x3725e2;}async[a56_0x57a587(0x156)](_0xca3f74){const _0x5b91ac=a56_0x57a587;return this[_0x5b91ac(0xf4)](_0xca3f74);}async[a56_0x57a587(0xab)](_0xa6fdbb,_0x15b6f4){const _0x36c355=a56_0x57a587,{page:_0x392c4e,limit:_0x4f1382,paymentId:_0x1365a1}=_0x15b6f4,_0x5700cd=(_0x392c4e-0x1)*_0x4f1382,_0xc3b912={'shopId':_0xa6fdbb};_0x1365a1&&(_0xc3b912[_0x36c355(0xc9)]=_0x1365a1);const [_0x13a85c,_0x345d88]=await Promise[_0x36c355(0x123)]([database_1['default'][_0x36c355(0xd1)]['findMany']({'where':_0xc3b912,'skip':_0x5700cd,'take':_0x4f1382,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x36c355(0xc2)][_0x36c355(0xd1)][_0x36c355(0xfc)]({'where':_0xc3b912})]);return{'logs':_0x13a85c[_0x36c355(0x12d)](_0x30e490=>({'id':_0x30e490['id'],'paymentId':_0x30e490[_0x36c355(0xc9)],'shopId':_0x30e490[_0x36c355(0xe0)],'event':_0x30e490[_0x36c355(0x101)],'statusCode':_0x30e490[_0x36c355(0x12a)],'retryCount':_0x30e490[_0x36c355(0xc3)],'responseBody':_0x30e490['responseBody'],'createdAt':_0x30e490['createdAt'],'payment':_0x30e490['payment']})),'pagination':{'page':_0x392c4e,'limit':_0x4f1382,'total':_0x345d88,'totalPages':Math[_0x36c355(0x13e)](_0x345d88/_0x4f1382)}};}async[a56_0x57a587(0x144)](_0x18b888,_0x42af7b){const _0x18d8a3=a56_0x57a587,_0x5d3bc4=new Date();let _0x4f6154;switch(_0x42af7b){case'7d':_0x4f6154=new Date(_0x5d3bc4[_0x18d8a3(0x13a)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4f6154=new Date(_0x5d3bc4[_0x18d8a3(0x13a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x18d8a3(0xb4):_0x4f6154=new Date(_0x5d3bc4[_0x18d8a3(0x13a)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4f6154=new Date(_0x5d3bc4[_0x18d8a3(0x13a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x518d4d,_0xd33211,_0x59b01a,_0x52cb11,_0x3563f0]=await Promise['all']([database_1['default'][_0x18d8a3(0x14d)][_0x18d8a3(0xfc)]({'where':{'shopId':_0x18b888,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x4f6154}}}),database_1[_0x18d8a3(0xc2)]['payment']['count']({'where':{'shopId':_0x18b888,'gateway':{'not':_0x18d8a3(0x139)},'status':_0x18d8a3(0xcc),'createdAt':{'gte':_0x4f6154}}}),database_1['default'][_0x18d8a3(0x14d)]['findMany']({'where':{'shopId':_0x18b888,'gateway':{'not':_0x18d8a3(0x139)},'status':_0x18d8a3(0xcc),'createdAt':{'gte':_0x4f6154}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x18d8a3(0xc2)][_0x18d8a3(0x14d)][_0x18d8a3(0x124)]({'where':{'shopId':_0x18b888,'gateway':{'not':_0x18d8a3(0x139)}},'take':0xa,'orderBy':{'createdAt':_0x18d8a3(0xd2)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x18d8a3(0xc2)][_0x18d8a3(0x14d)]['findMany']({'where':{'shopId':_0x18b888,'gateway':{'not':_0x18d8a3(0x139)},'createdAt':{'gte':_0x4f6154}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x18d8a3(0xd8)}})]);let _0x3d2933=0x0;for(const _0x2dcc9c of _0x59b01a){if(_0x2dcc9c[_0x18d8a3(0xe5)])_0x3d2933+=_0x2dcc9c[_0x18d8a3(0xe5)];else{const _0x9df559=await currencyService_1[_0x18d8a3(0x12f)][_0x18d8a3(0x145)](_0x2dcc9c[_0x18d8a3(0xdf)],_0x2dcc9c[_0x18d8a3(0x130)]);_0x3d2933+=_0x9df559;}}const _0x1bbd2b=this[_0x18d8a3(0x129)](_0x3563f0,_0x4f6154,_0x5d3bc4),_0x31ca04=_0x518d4d>0x0?_0xd33211/_0x518d4d*0x64:0x0;return{'totalPayments':_0x518d4d,'successfulPayments':_0xd33211,'totalRevenue':Math[_0x18d8a3(0xf3)](_0x3d2933*0x64)/0x64,'conversionRate':Math[_0x18d8a3(0xf3)](_0x31ca04*0x64)/0x64,'dailyRevenue':_0x1bbd2b[_0x18d8a3(0x15d)],'dailyPayments':_0x1bbd2b[_0x18d8a3(0x137)],'recentPayments':_0x52cb11['map'](_0x928702=>({'id':_0x928702['id'],'gateway':_0x928702[_0x18d8a3(0xd0)],'amount':_0x928702[_0x18d8a3(0xdf)],'currency':_0x928702[_0x18d8a3(0x130)],'status':_0x928702[_0x18d8a3(0x114)],'createdAt':_0x928702[_0x18d8a3(0x113)]}))};}[a56_0x57a587(0x129)](_0x26d967,_0x4579e3,_0x42a7b1){const _0x2690e2=a56_0x57a587,_0x383f61=new Map(),_0xd25ba3=new Date(_0x4579e3);while(_0xd25ba3<=_0x42a7b1){const _0x58589a=_0xd25ba3['toISOString']()[_0x2690e2(0x15c)]('T')[0x0];_0x383f61[_0x2690e2(0xb6)](_0x58589a,{'revenue':0x0,'count':0x0}),_0xd25ba3[_0x2690e2(0xe1)](_0xd25ba3[_0x2690e2(0xc8)]()+0x1);}for(const _0x48b99d of _0x26d967){const _0x2a5091=_0x48b99d[_0x2690e2(0x113)][_0x2690e2(0x14e)]()[_0x2690e2(0x15c)]('T')[0x0],_0x23d87d=_0x383f61['get'](_0x2a5091);_0x23d87d&&(_0x23d87d['count']+=0x1,_0x48b99d[_0x2690e2(0x114)]===_0x2690e2(0xcc)&&_0x48b99d[_0x2690e2(0xe5)]&&(_0x23d87d[_0x2690e2(0xad)]+=_0x48b99d[_0x2690e2(0xe5)]));}const _0x34cc5e=[],_0x59cf17=[];for(const [_0x9257e8,_0x28eee1]of _0x383f61){_0x34cc5e[_0x2690e2(0x140)]({'date':_0x9257e8,'amount':Math[_0x2690e2(0xf3)](_0x28eee1[_0x2690e2(0xad)]*0x64)/0x64}),_0x59cf17[_0x2690e2(0x140)]({'date':_0x9257e8,'count':_0x28eee1['count']});}return{'dailyRevenue':_0x34cc5e,'dailyPayments':_0x59cf17};}}exports[a56_0x57a587(0xac)]=ShopService;