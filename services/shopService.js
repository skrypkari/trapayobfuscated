'use strict';function a77_0x4a1a(_0x523a6d,_0x11fe9c){_0x523a6d=_0x523a6d-0x139;const _0x3c9a89=a77_0x3c9a();let _0x4a1a42=_0x3c9a89[_0x523a6d];return _0x4a1a42;}const a77_0x246c6d=a77_0x4a1a;(function(_0x255f4c,_0x3b566e){const _0x2ddeae=a77_0x4a1a,_0x454daf=_0x255f4c();while(!![]){try{const _0x1bc150=parseInt(_0x2ddeae(0x1cd))/0x1*(-parseInt(_0x2ddeae(0x16c))/0x2)+-parseInt(_0x2ddeae(0x203))/0x3+parseInt(_0x2ddeae(0x216))/0x4*(parseInt(_0x2ddeae(0x21d))/0x5)+parseInt(_0x2ddeae(0x16a))/0x6*(-parseInt(_0x2ddeae(0x210))/0x7)+-parseInt(_0x2ddeae(0x1f0))/0x8*(parseInt(_0x2ddeae(0x213))/0x9)+parseInt(_0x2ddeae(0x1ae))/0xa*(-parseInt(_0x2ddeae(0x16e))/0xb)+parseInt(_0x2ddeae(0x1ee))/0xc;if(_0x1bc150===_0x3b566e)break;else _0x454daf['push'](_0x454daf['shift']());}catch(_0x4c26e8){_0x454daf['push'](_0x454daf['shift']());}}}(a77_0x3c9a,0xc4fdb));var __importDefault=this&&this[a77_0x246c6d(0x158)]||function(_0x5887bf){const _0x3571a7=a77_0x246c6d;return _0x5887bf&&_0x5887bf[_0x3571a7(0x162)]?_0x5887bf:{'default':_0x5887bf};};Object['defineProperty'](exports,a77_0x246c6d(0x162),{'value':!![]}),exports[a77_0x246c6d(0x1a1)]=void 0x0;const database_1=__importDefault(require(a77_0x246c6d(0x1dc))),bcryptjs_1=__importDefault(require(a77_0x246c6d(0x14d))),crypto_1=__importDefault(require('crypto')),speakeasy_1=__importDefault(require(a77_0x246c6d(0x13e))),qrcode_1=__importDefault(require(a77_0x246c6d(0x1f7))),currencyService_1=require('./currencyService'),paymentService_1=require('./paymentService'),gateway_1=require('../types/gateway');class ShopService{constructor(){const _0xc415fb=a77_0x246c6d;this[_0xc415fb(0x207)]=new paymentService_1[(_0xc415fb(0x1c3))]();}async['getShopProfile'](_0x360406){const _0x5c8e1c=a77_0x246c6d,_0x2167a3=await database_1[_0x5c8e1c(0x176)][_0x5c8e1c(0x178)][_0x5c8e1c(0x1b3)]({'where':{'id':_0x360406},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2167a3)throw new Error(_0x5c8e1c(0x16d));let _0x2852bd=[];if(_0x2167a3[_0x5c8e1c(0x173)]?.['webhookEvents'])try{_0x2852bd=Array['isArray'](_0x2167a3[_0x5c8e1c(0x173)][_0x5c8e1c(0x1f5)])?_0x2167a3[_0x5c8e1c(0x173)][_0x5c8e1c(0x1f5)]:JSON[_0x5c8e1c(0x1b9)](_0x2167a3[_0x5c8e1c(0x173)]['webhookEvents']);}catch(_0x5c40c2){console[_0x5c8e1c(0x180)](_0x5c8e1c(0x1f6),_0x5c40c2),_0x2852bd=[];}const _0x5e8d83=gateway_1[_0x5c8e1c(0x20c)][_0x5c8e1c(0x1fc)](_0x333564=>_0x333564['isActive'])[_0x5c8e1c(0x201)](_0x506e42=>_0x506e42[_0x5c8e1c(0x142)]);let _0x1abf43=_0x2167a3[_0x5c8e1c(0x1c7)]?JSON['parse'](_0x2167a3[_0x5c8e1c(0x1c7)]):[];return Array['isArray'](_0x1abf43)&&(_0x1abf43=_0x1abf43[_0x5c8e1c(0x201)](_0x4b5a20=>_0x4b5a20['replace'](/\s+/g,'_')[_0x5c8e1c(0x18e)]())['filter'](_0x26d8ef=>_0x5e8d83[_0x5c8e1c(0x175)](_0x26d8ef))),{'id':_0x2167a3['id'],'fullName':_0x2167a3['name'],'username':_0x2167a3[_0x5c8e1c(0x1e5)],'telegramId':_0x2167a3[_0x5c8e1c(0x1a9)],'merchantUrl':_0x2167a3['shopUrl'],'gateways':_0x1abf43,'gatewaySettings':_0x2167a3[_0x5c8e1c(0x1bf)]?JSON[_0x5c8e1c(0x1b9)](_0x2167a3[_0x5c8e1c(0x1bf)]):null,'publicKey':_0x2167a3[_0x5c8e1c(0x1da)],'webhookUrl':_0x2167a3[_0x5c8e1c(0x173)]?.[_0x5c8e1c(0x187)]||null,'webhookEvents':_0x2852bd,'wallets':{'usdtPolygonWallet':_0x2167a3[_0x5c8e1c(0x18a)],'usdtTrcWallet':_0x2167a3[_0x5c8e1c(0x188)],'usdtErcWallet':_0x2167a3['usdtErcWallet'],'usdcPolygonWallet':_0x2167a3['usdcPolygonWallet'],'usdcErcWallet':_0x2167a3[_0x5c8e1c(0x1f8)]},'status':_0x2167a3['status'],'createdAt':_0x2167a3[_0x5c8e1c(0x1ce)]};}async[a77_0x246c6d(0x184)](_0x24bd42,_0x3e4be1){const _0x39aa60=a77_0x246c6d,_0x2d2081={};_0x3e4be1[_0x39aa60(0x160)]&&(_0x2d2081[_0x39aa60(0x142)]=_0x3e4be1[_0x39aa60(0x160)]);_0x3e4be1['telegramId']!==undefined&&(_0x2d2081[_0x39aa60(0x1a9)]=_0x3e4be1['telegramId']||null);_0x3e4be1[_0x39aa60(0x1c6)]&&(_0x2d2081['shopUrl']=_0x3e4be1[_0x39aa60(0x1c6)]);_0x3e4be1['gateways']&&(_0x2d2081[_0x39aa60(0x1c7)]=JSON[_0x39aa60(0x179)](_0x3e4be1[_0x39aa60(0x139)]));_0x3e4be1[_0x39aa60(0x1bf)]&&(_0x2d2081[_0x39aa60(0x1bf)]=JSON['stringify'](_0x3e4be1[_0x39aa60(0x1bf)]));_0x3e4be1[_0x39aa60(0x21c)]&&(_0x3e4be1[_0x39aa60(0x21c)][_0x39aa60(0x18a)]!==undefined&&(_0x2d2081[_0x39aa60(0x18a)]=_0x3e4be1[_0x39aa60(0x21c)][_0x39aa60(0x18a)]||null),_0x3e4be1[_0x39aa60(0x21c)][_0x39aa60(0x188)]!==undefined&&(_0x2d2081[_0x39aa60(0x188)]=_0x3e4be1[_0x39aa60(0x21c)][_0x39aa60(0x188)]||null),_0x3e4be1['wallets']['usdtErcWallet']!==undefined&&(_0x2d2081[_0x39aa60(0x1e8)]=_0x3e4be1['wallets'][_0x39aa60(0x1e8)]||null),_0x3e4be1['wallets'][_0x39aa60(0x19d)]!==undefined&&(_0x2d2081[_0x39aa60(0x19d)]=_0x3e4be1['wallets'][_0x39aa60(0x19d)]||null));const _0x340d04=await database_1[_0x39aa60(0x176)]['shop'][_0x39aa60(0x15f)]({'where':{'id':_0x24bd42},'data':_0x2d2081,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x5708c4=[];if(_0x340d04[_0x39aa60(0x173)]?.[_0x39aa60(0x1f5)])try{_0x5708c4=Array[_0x39aa60(0x192)](_0x340d04[_0x39aa60(0x173)][_0x39aa60(0x1f5)])?_0x340d04[_0x39aa60(0x173)][_0x39aa60(0x1f5)]:JSON[_0x39aa60(0x1b9)](_0x340d04[_0x39aa60(0x173)][_0x39aa60(0x1f5)]);}catch(_0x116403){console[_0x39aa60(0x180)](_0x39aa60(0x1f6),_0x116403),_0x5708c4=[];}return{'id':_0x340d04['id'],'fullName':_0x340d04[_0x39aa60(0x142)],'username':_0x340d04[_0x39aa60(0x1e5)],'telegramId':_0x340d04[_0x39aa60(0x1a9)],'merchantUrl':_0x340d04[_0x39aa60(0x15b)],'gateways':_0x340d04[_0x39aa60(0x1c7)]?JSON['parse'](_0x340d04[_0x39aa60(0x1c7)]):null,'gatewaySettings':_0x340d04[_0x39aa60(0x1bf)]?JSON[_0x39aa60(0x1b9)](_0x340d04[_0x39aa60(0x1bf)]):null,'publicKey':_0x340d04[_0x39aa60(0x1da)],'webhookUrl':_0x340d04['settings']?.['webhookUrl']||null,'webhookEvents':_0x5708c4,'wallets':{'usdtPolygonWallet':_0x340d04['usdtPolygonWallet'],'usdtTrcWallet':_0x340d04[_0x39aa60(0x188)],'usdtErcWallet':_0x340d04[_0x39aa60(0x1e8)],'usdcPolygonWallet':_0x340d04[_0x39aa60(0x19d)],'usdcErcWallet':_0x340d04[_0x39aa60(0x1f8)]},'status':_0x340d04[_0x39aa60(0x1d6)],'createdAt':_0x340d04[_0x39aa60(0x1ce)]};}async[a77_0x246c6d(0x144)](_0x52a9df,_0x3f63ba){const _0x86f9f7=a77_0x246c6d,_0x56f9a5=await database_1[_0x86f9f7(0x176)]['shop'][_0x86f9f7(0x1b3)]({'where':{'id':_0x52a9df},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x56f9a5)throw new Error(_0x86f9f7(0x16d));if(_0x56f9a5[_0x86f9f7(0x205)]){if(!_0x3f63ba[_0x86f9f7(0x1f3)])throw new Error(_0x86f9f7(0x1c5));const _0x12448f=speakeasy_1['default'][_0x86f9f7(0x168)]['verify']({'secret':_0x56f9a5[_0x86f9f7(0x19a)],'encoding':_0x86f9f7(0x151),'token':_0x3f63ba[_0x86f9f7(0x1f3)],'window':0x2});if(!_0x12448f){let _0x430ddd=![];if(_0x56f9a5[_0x86f9f7(0x214)]){const _0x12f28c=JSON[_0x86f9f7(0x1b9)](_0x56f9a5[_0x86f9f7(0x214)]);for(let _0x55a711=0x0;_0x55a711<_0x12f28c['length'];_0x55a711++){const _0x211817=await bcryptjs_1['default'][_0x86f9f7(0x1c4)](_0x3f63ba[_0x86f9f7(0x1f3)],_0x12f28c[_0x55a711]);if(_0x211817){_0x430ddd=!![],_0x12f28c[_0x86f9f7(0x19c)](_0x55a711,0x1),await database_1['default'][_0x86f9f7(0x178)][_0x86f9f7(0x15f)]({'where':{'id':_0x52a9df},'data':{'backupCodes':JSON[_0x86f9f7(0x179)](_0x12f28c)}});break;}}}if(!_0x430ddd)throw new Error(_0x86f9f7(0x17a));}}const _0x2e9610={};_0x3f63ba['usdtPolygonWallet']!==undefined&&(_0x2e9610[_0x86f9f7(0x18a)]=_0x3f63ba[_0x86f9f7(0x18a)]||null),_0x3f63ba[_0x86f9f7(0x188)]!==undefined&&(_0x2e9610['usdtTrcWallet']=_0x3f63ba[_0x86f9f7(0x188)]||null),_0x3f63ba[_0x86f9f7(0x1e8)]!==undefined&&(_0x2e9610[_0x86f9f7(0x1e8)]=_0x3f63ba[_0x86f9f7(0x1e8)]||null),_0x3f63ba[_0x86f9f7(0x19d)]!==undefined&&(_0x2e9610['usdcPolygonWallet']=_0x3f63ba[_0x86f9f7(0x19d)]||null),_0x3f63ba[_0x86f9f7(0x1f8)]!==undefined&&(_0x2e9610[_0x86f9f7(0x1f8)]=_0x3f63ba['usdcErcWallet']||null),await database_1[_0x86f9f7(0x176)][_0x86f9f7(0x178)][_0x86f9f7(0x15f)]({'where':{'id':_0x52a9df},'data':_0x2e9610});}async['testWebhook'](_0x18a215){const _0x122ace=a77_0x246c6d,_0xdd36da=await database_1[_0x122ace(0x176)][_0x122ace(0x178)][_0x122ace(0x1b3)]({'where':{'id':_0x18a215},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0xdd36da?.[_0x122ace(0x173)]?.['webhookUrl'])throw new Error(_0x122ace(0x20f));const _0x183ee0={'event':_0x122ace(0x15a),'payment':{'id':_0x122ace(0x1e3),'order_id':_0x122ace(0x198),'gateway':_0x122ace(0x15a),'amount':0x64,'currency':_0x122ace(0x1bc),'status':'paid','created_at':new Date()[_0x122ace(0x1b2)]()}};try{const _0x3f15c8=await fetch(_0xdd36da[_0x122ace(0x173)]['webhookUrl'],{'method':_0x122ace(0x17b),'headers':{'Content-Type':_0x122ace(0x1ac),'User-Agent':_0x122ace(0x1cc)},'body':JSON[_0x122ace(0x179)](_0x183ee0)});return _0x3f15c8['ok']?{'success':!![],'message':_0x122ace(0x1d9)+_0x3f15c8['status']+')'}:{'success':![],'message':_0x122ace(0x191)+_0x3f15c8[_0x122ace(0x1d6)]+'\x20'+_0x3f15c8[_0x122ace(0x199)]};}catch(_0x59c37e){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x59c37e instanceof Error?_0x59c37e[_0x122ace(0x1b8)]:_0x122ace(0x1a2))};}}async[a77_0x246c6d(0x20e)](_0x4de8ac){const _0xeb6d45=a77_0x246c6d;return this['paymentService'][_0xeb6d45(0x13b)]({'public_key':'','gateway':_0x4de8ac['gateway'],'order_id':undefined,'amount':_0x4de8ac[_0xeb6d45(0x1d0)],'currency':_0x4de8ac['currency'],'source_currency':_0x4de8ac[_0xeb6d45(0x1f9)],'usage':_0x4de8ac['usage'],'expires_at':_0x4de8ac['expiresAt']?.[_0xeb6d45(0x1b2)](),'success_url':_0x4de8ac[_0xeb6d45(0x20b)],'fail_url':_0x4de8ac[_0xeb6d45(0x20b)],'customer_email':_0x4de8ac['customerEmail'],'customer_name':_0x4de8ac['customerName'],'country':_0x4de8ac['country'],'language':_0x4de8ac['language'],'amount_is_editable':_0x4de8ac[_0xeb6d45(0x211)],'max_payments':_0x4de8ac[_0xeb6d45(0x14e)],'customer':_0x4de8ac[_0xeb6d45(0x1cb)]});}async[a77_0x246c6d(0x164)](_0x5610dd,_0x32fddc){const _0x1259a1=a77_0x246c6d;return this[_0x1259a1(0x207)][_0x1259a1(0x1c8)](_0x5610dd,_0x32fddc);}async[a77_0x246c6d(0x1c9)](_0x5c7b90,_0x2e7744){const _0x1cc9d9=a77_0x246c6d;return this[_0x1cc9d9(0x207)]['getPaymentByShopAndId'](_0x5c7b90,_0x2e7744);}async[a77_0x246c6d(0x1cf)](_0x35d6f9,_0x1ae92a,_0x4bada9){const _0x32dc96=a77_0x246c6d,_0x2249b3=await database_1[_0x32dc96(0x176)][_0x32dc96(0x1ab)]['findFirst']({'where':{'id':_0x1ae92a,'shopId':_0x35d6f9}});if(!_0x2249b3)throw new Error(_0x32dc96(0x156));const _0x283ffc=await database_1[_0x32dc96(0x176)][_0x32dc96(0x1ab)]['update']({'where':{'id':_0x1ae92a},'data':{..._0x4bada9,'updatedAt':new Date()}});return _0x283ffc;}async[a77_0x246c6d(0x215)](_0x1a292a,_0x41972d){const _0x4b3d7c=a77_0x246c6d,_0x32c65f=await database_1[_0x4b3d7c(0x176)][_0x4b3d7c(0x1ab)][_0x4b3d7c(0x183)]({'where':{'id':_0x41972d,'shopId':_0x1a292a}});if(!_0x32c65f)throw new Error(_0x4b3d7c(0x156));await database_1[_0x4b3d7c(0x176)]['payment'][_0x4b3d7c(0x155)]({'where':{'id':_0x41972d}});}['formatNetworkName'](_0x2a72a0){const _0xbd6de5=a77_0x246c6d,_0x4f58a2={'polygon':_0xbd6de5(0x165),'trc20':'USDT\x20TRC20','erc20':_0xbd6de5(0x1ad),'bsc':_0xbd6de5(0x1fa),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0xbd6de5(0x1fb)};return _0x4f58a2[_0x2a72a0]||_0x2a72a0;}async[a77_0x246c6d(0x1c1)](_0x23f872,_0x213974){const _0x346011=a77_0x246c6d,{page:_0x7db715,limit:_0x56683a,status:_0x3c3aa5,method:_0x58b2b9,network:_0x462b70,dateFrom:_0x340598,dateTo:_0x13fbea,periodFrom:_0x17fbe9,periodTo:_0x4c2d41}=_0x213974,_0xd2045a=(_0x7db715-0x1)*_0x56683a;console['log'](_0x346011(0x13a),_0x213974);const _0x5f19d8={'shopId':_0x23f872};_0x3c3aa5&&(_0x5f19d8['status']=_0x3c3aa5[_0x346011(0x1c2)](),console[_0x346011(0x1ba)]('üìä\x20Status\x20filter:\x20'+_0x3c3aa5[_0x346011(0x1c2)]()));if(_0x58b2b9)_0x5f19d8[_0x346011(0x1ea)]=_0x58b2b9,console['log'](_0x346011(0x1e4)+_0x58b2b9);else _0x462b70&&(_0x5f19d8[_0x346011(0x1ea)]=_0x462b70,console['log'](_0x346011(0x161)+_0x462b70));if(_0x340598||_0x13fbea||_0x17fbe9||_0x4c2d41){_0x5f19d8[_0x346011(0x1ce)]={};if(_0x17fbe9){const _0x36eaf4=new Date(_0x17fbe9);_0x36eaf4[_0x346011(0x1a3)](0x0,0x0,0x0,0x1),_0x5f19d8[_0x346011(0x1ce)]['gte']=_0x36eaf4,console[_0x346011(0x1ba)](_0x346011(0x1df)+_0x36eaf4[_0x346011(0x1b2)]());}else{if(_0x340598){const _0x235f7c=new Date(_0x340598);_0x235f7c[_0x346011(0x1a3)](0x0,0x0,0x0,0x1),_0x5f19d8[_0x346011(0x1ce)][_0x346011(0x1e9)]=_0x235f7c,console[_0x346011(0x1ba)](_0x346011(0x167)+_0x235f7c[_0x346011(0x1b2)]());}}if(_0x4c2d41){const _0x2c3700=new Date(_0x4c2d41);_0x2c3700[_0x346011(0x1a3)](0x17,0x3b,0x3b,0x3e7),_0x5f19d8['createdAt'][_0x346011(0x20d)]=_0x2c3700,console[_0x346011(0x1ba)](_0x346011(0x219)+_0x2c3700[_0x346011(0x1b2)]());}else{if(_0x13fbea){const _0x1348a3=new Date(_0x13fbea);_0x1348a3['setHours'](0x17,0x3b,0x3b,0x3e7),_0x5f19d8[_0x346011(0x1ce)][_0x346011(0x20d)]=_0x1348a3,console[_0x346011(0x1ba)](_0x346011(0x1db)+_0x1348a3['toISOString']());}}}console[_0x346011(0x1ba)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x346011(0x179)](_0x5f19d8,null,0x2));const [_0x256962,_0x17c0ba]=await Promise[_0x346011(0x1a6)]([database_1['default']['payout'][_0x346011(0x1e1)]({'where':_0x5f19d8,'skip':_0xd2045a,'take':_0x56683a,'orderBy':{'createdAt':_0x346011(0x182)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x346011(0x176)]['payout'][_0x346011(0x190)]({'where':_0x5f19d8})]);return{'payouts':_0x256962[_0x346011(0x201)](_0x59deae=>{const _0x451dd9=_0x346011;let _0x4d4f23=null;switch(_0x59deae[_0x451dd9(0x1ea)]){case'polygon':_0x4d4f23=_0x59deae[_0x451dd9(0x178)][_0x451dd9(0x18a)];break;case _0x451dd9(0x172):_0x4d4f23=_0x59deae['shop'][_0x451dd9(0x188)];break;case _0x451dd9(0x14a):_0x4d4f23=_0x59deae[_0x451dd9(0x178)]['usdtErcWallet'];break;case _0x451dd9(0x218):_0x4d4f23=_0x59deae[_0x451dd9(0x178)][_0x451dd9(0x19d)];break;case _0x451dd9(0x15d):_0x4d4f23=_0x59deae[_0x451dd9(0x178)]['usdcErcWallet'];break;}return{'id':_0x59deae['id'],'amount':_0x59deae[_0x451dd9(0x1d0)],'network':this[_0x451dd9(0x1a0)](_0x59deae[_0x451dd9(0x1ea)]),'wallet':_0x4d4f23,'status':_0x59deae[_0x451dd9(0x1d6)],'txid':_0x59deae['txid'],'notes':_0x59deae[_0x451dd9(0x189)],'periodFrom':_0x59deae[_0x451dd9(0x17f)],'periodTo':_0x59deae[_0x451dd9(0x141)],'createdAt':_0x59deae['createdAt'],'paidAt':_0x59deae[_0x451dd9(0x1b1)]};}),'pagination':{'page':_0x7db715,'limit':_0x56683a,'total':_0x17c0ba,'totalPages':Math[_0x346011(0x166)](_0x17c0ba/_0x56683a)}};}async[a77_0x246c6d(0x1be)](_0x2a91df,_0x135c07){const _0x150b66=a77_0x246c6d,_0x2f621e=await database_1['default'][_0x150b66(0x1f2)][_0x150b66(0x183)]({'where':{'id':_0x135c07,'shopId':_0x2a91df}});if(!_0x2f621e)return null;return{'id':_0x2f621e['id'],'amount':_0x2f621e[_0x150b66(0x1d0)],'network':_0x2f621e['network'],'status':_0x2f621e['status'],'txid':_0x2f621e[_0x150b66(0x1e6)],'notes':_0x2f621e['notes'],'createdAt':_0x2f621e[_0x150b66(0x1ce)],'paidAt':_0x2f621e[_0x150b66(0x1b1)]};}async[a77_0x246c6d(0x16f)](_0x223b01,_0x92a5e0){const _0x3e2927=a77_0x246c6d,_0x47617b=new Date();let _0x2172d3,_0x3413c8;switch(_0x92a5e0){case'yesterday':case _0x3e2927(0x1e2):const _0x8847a6=new Date(_0x47617b);_0x8847a6['setDate'](_0x8847a6['getDate']()-0x1),_0x2172d3=new Date(_0x8847a6),_0x2172d3[_0x3e2927(0x1a3)](0x0,0x0,0x0,0x0),_0x3413c8=new Date(_0x8847a6),_0x3413c8[_0x3e2927(0x1a3)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x2172d3=new Date(_0x47617b['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x2172d3=new Date(_0x47617b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3e2927(0x1d3):_0x2172d3=new Date(_0x47617b[_0x3e2927(0x1e0)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2172d3=new Date(_0x47617b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x14c1ec={'gte':_0x2172d3};_0x3413c8&&(_0x14c1ec['lte']=_0x3413c8);const [_0xb9a7e9,_0x4bb9ff,_0x4d98b2,_0x2aaaa5,_0x5d6d92,_0x4c0e0d]=await Promise[_0x3e2927(0x1a6)]([database_1['default'][_0x3e2927(0x1f2)][_0x3e2927(0x190)]({'where':{'shopId':_0x223b01,'createdAt':_0x14c1ec}}),database_1[_0x3e2927(0x176)][_0x3e2927(0x1f2)][_0x3e2927(0x190)]({'where':{'shopId':_0x223b01,'status':_0x3e2927(0x1ff),'createdAt':_0x14c1ec}}),database_1[_0x3e2927(0x176)][_0x3e2927(0x1f2)][_0x3e2927(0x190)]({'where':{'shopId':_0x223b01,'status':'PENDING','createdAt':_0x14c1ec}}),database_1[_0x3e2927(0x176)][_0x3e2927(0x1f2)][_0x3e2927(0x190)]({'where':{'shopId':_0x223b01,'status':'REJECTED','createdAt':_0x14c1ec}}),database_1[_0x3e2927(0x176)][_0x3e2927(0x1f2)][_0x3e2927(0x1e1)]({'where':{'shopId':_0x223b01,'createdAt':_0x14c1ec},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x3e2927(0x176)][_0x3e2927(0x1f2)][_0x3e2927(0x1e1)]({'where':{'shopId':_0x223b01},'take':0xa,'orderBy':{'createdAt':_0x3e2927(0x182)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x10185c=_0x5d6d92[_0x3e2927(0x147)]((_0x4df75b,_0xceaea2)=>_0x4df75b+_0xceaea2[_0x3e2927(0x1d0)],0x0),_0x281681=_0x5d6d92[_0x3e2927(0x1fc)](_0x591da0=>_0x591da0[_0x3e2927(0x1d6)]===_0x3e2927(0x1ff))['reduce']((_0x4095fc,_0x295d41)=>_0x4095fc+_0x295d41[_0x3e2927(0x1d0)],0x0),_0x533a4f=_0x5d6d92[_0x3e2927(0x1fc)](_0x3d91a1=>_0x3d91a1[_0x3e2927(0x1d6)]==='PENDING')[_0x3e2927(0x147)]((_0x494524,_0x52e247)=>_0x494524+_0x52e247[_0x3e2927(0x1d0)],0x0),_0x4e1454=_0x5d6d92['reduce']((_0x32d5cc,_0xfa9b0d)=>{const _0x16cb68=_0x3e2927;return _0x32d5cc[_0xfa9b0d[_0x16cb68(0x1ea)]]=(_0x32d5cc[_0xfa9b0d[_0x16cb68(0x1ea)]]||0x0)+0x1,_0x32d5cc;},{}),_0x45061b=_0x5d6d92[_0x3e2927(0x147)]((_0x54884d,_0x168f07)=>{const _0x20c874=_0x3e2927;return _0x54884d[_0x168f07[_0x20c874(0x1d6)]]=(_0x54884d[_0x168f07[_0x20c874(0x1d6)]]||0x0)+0x1,_0x54884d;},{});return{'totalPayouts':_0xb9a7e9,'completedPayouts':_0x4bb9ff,'pendingPayouts':_0x4d98b2,'rejectedPayouts':_0x2aaaa5,'totalAmount':_0x10185c,'completedAmount':_0x281681,'pendingAmount':_0x533a4f,'payoutsByMethod':_0x4e1454,'payoutsByStatus':_0x45061b,'recentPayouts':_0x4c0e0d['map'](_0xd535a8=>({'id':_0xd535a8['id'],'shopId':_0x223b01,'amount':_0xd535a8[_0x3e2927(0x1d0)],'method':_0xd535a8[_0x3e2927(0x1ea)],'status':_0xd535a8[_0x3e2927(0x1d6)],'txid':_0xd535a8[_0x3e2927(0x1e6)],'createdAt':_0xd535a8[_0x3e2927(0x1ce)],'paidAt':_0xd535a8['paidAt']}))};}async[a77_0x246c6d(0x143)](_0x317e94){const _0x104d7b=a77_0x246c6d;console[_0x104d7b(0x1ba)](_0x104d7b(0x1ef)+_0x317e94+_0x104d7b(0x18f));const _0x37c5a9=await database_1[_0x104d7b(0x176)][_0x104d7b(0x178)][_0x104d7b(0x1b3)]({'where':{'id':_0x317e94},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x37c5a9)throw new Error('Shop\x20not\x20found');const _0x264903=new Date(),_0x2b2289=new Date(_0x264903['getFullYear'](),_0x264903[_0x104d7b(0x13f)](),0x1),_0x30f507=new Date(_0x264903['getFullYear'](),_0x264903[_0x104d7b(0x13f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5e4f28=await database_1[_0x104d7b(0x176)][_0x104d7b(0x1f2)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x317e94,'createdAt':{'gte':_0x2b2289,'lte':_0x30f507},'status':_0x104d7b(0x1ff)}}),_0x1c80cb=_0x5e4f28[_0x104d7b(0x157)]['amount']||0x0,_0x5c33f6={'availableBalance':Math[_0x104d7b(0x1d8)](_0x37c5a9[_0x104d7b(0x1af)]*0x64)/0x64,'totalPaidOut':Math[_0x104d7b(0x1d8)](_0x37c5a9[_0x104d7b(0x1ca)]*0x64)/0x64,'awaitingPayout':Math[_0x104d7b(0x1d8)](_0x37c5a9[_0x104d7b(0x1af)]*0x64)/0x64,'thisMonth':Math['round'](_0x1c80cb*0x64)/0x64};return console[_0x104d7b(0x1ba)](_0x104d7b(0x154)+_0x37c5a9['username']+_0x104d7b(0x1a8)),console[_0x104d7b(0x1ba)](_0x104d7b(0x209)+_0x5c33f6['availableBalance']+_0x104d7b(0x1f1)),console['log'](_0x104d7b(0x1d1)+_0x5c33f6[_0x104d7b(0x1ca)]+_0x104d7b(0x1a5)),console[_0x104d7b(0x1ba)](_0x104d7b(0x14b)+_0x5c33f6[_0x104d7b(0x200)]+'\x20USDT\x20(current\x20balance)'),console[_0x104d7b(0x1ba)](_0x104d7b(0x208)+_0x5c33f6['thisMonth']+_0x104d7b(0x20a)),_0x5c33f6;}[a77_0x246c6d(0x174)](_0x5da0f9){const _0x5b0812=a77_0x246c6d,_0x5a507b={'test_gateway':_0x5b0812(0x21e),'plisio':'Plisio','rapyd':'Rapyd','noda':_0x5b0812(0x18d),'cointopay':_0x5b0812(0x1b6),'klyme_eu':_0x5b0812(0x194),'klyme_gb':_0x5b0812(0x140),'klyme_de':_0x5b0812(0x153)};return _0x5a507b[_0x5da0f9]||_0x5da0f9;}async[a77_0x246c6d(0x150)](_0x236fbd){const _0x241ed6=a77_0x246c6d;return this[_0x241ed6(0x143)](_0x236fbd);}async[a77_0x246c6d(0x186)](_0x4f6db6,_0xfd12de){const _0x3d7825=a77_0x246c6d,{page:_0x34ce64,limit:_0x4d95f,paymentId:_0x3b86fb}=_0xfd12de,_0x50c410=(_0x34ce64-0x1)*_0x4d95f,_0x19a5ad={'shopId':_0x4f6db6};_0x3b86fb&&(_0x19a5ad[_0x3d7825(0x212)]=_0x3b86fb);const [_0x503057,_0x879a96]=await Promise[_0x3d7825(0x1a6)]([database_1[_0x3d7825(0x176)]['webhookLog'][_0x3d7825(0x1e1)]({'where':_0x19a5ad,'skip':_0x50c410,'take':_0x4d95f,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x3d7825(0x176)][_0x3d7825(0x1d7)][_0x3d7825(0x190)]({'where':_0x19a5ad})]);return{'logs':_0x503057[_0x3d7825(0x201)](_0x268d6e=>({'id':_0x268d6e['id'],'paymentId':_0x268d6e[_0x3d7825(0x212)],'shopId':_0x268d6e[_0x3d7825(0x195)],'event':_0x268d6e[_0x3d7825(0x1aa)],'statusCode':_0x268d6e[_0x3d7825(0x1a7)],'retryCount':_0x268d6e['retryCount'],'responseBody':_0x268d6e['responseBody'],'createdAt':_0x268d6e[_0x3d7825(0x1ce)],'payment':_0x268d6e[_0x3d7825(0x1ab)]})),'pagination':{'page':_0x34ce64,'limit':_0x4d95f,'total':_0x879a96,'totalPages':Math[_0x3d7825(0x166)](_0x879a96/_0x4d95f)}};}async[a77_0x246c6d(0x18b)](_0x44972d,_0x503450,_0x419770,_0x22be86,_0xf8987c){const _0x5e1e6a=a77_0x246c6d;console[_0x5e1e6a(0x1ba)](_0x5e1e6a(0x169)+_0x44972d+_0x5e1e6a(0x145)+_0x503450+_0x5e1e6a(0x21a)+_0x419770+_0x5e1e6a(0x1ed)+_0x22be86);const _0x499ea4=_0xf8987c?new Date(_0xf8987c):new Date();let _0x38b3e4,_0x39f8a3;if(_0x419770&&_0x22be86){const _0x168808=new Date(_0x419770),_0x5121a5=new Date(_0x22be86);_0x38b3e4=new Date(Date[_0x5e1e6a(0x152)](_0x168808[_0x5e1e6a(0x1c0)](),_0x168808[_0x5e1e6a(0x13c)](),_0x168808[_0x5e1e6a(0x17d)](),0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x5121a5['getUTCFullYear'](),_0x5121a5['getUTCMonth'](),_0x5121a5['getUTCDate'](),0x17,0x3b,0x3b,0x3e7)),console[_0x5e1e6a(0x1ba)]('üìÖ\x20Custom\x20date\x20range:\x20'+_0x38b3e4['toISOString']()+_0x5e1e6a(0x163)+_0x39f8a3['toISOString']());}else{if(_0x503450&&_0x503450[_0x5e1e6a(0x1d4)](_0x5e1e6a(0x206))){const _0x1ef3a8=_0x503450['replace'](_0x5e1e6a(0x206),'')[_0x5e1e6a(0x1d5)]('_');if(_0x1ef3a8[_0x5e1e6a(0x14f)]===0x2){const _0x3a3b20=new Date(_0x1ef3a8[0x0]),_0x52cfba=new Date(_0x1ef3a8[0x1]);_0x38b3e4=new Date(Date['UTC'](_0x3a3b20[_0x5e1e6a(0x1c0)](),_0x3a3b20[_0x5e1e6a(0x13c)](),_0x3a3b20[_0x5e1e6a(0x17d)](),0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x52cfba[_0x5e1e6a(0x1c0)](),_0x52cfba[_0x5e1e6a(0x13c)](),_0x52cfba[_0x5e1e6a(0x17d)](),0x17,0x3b,0x3b,0x3e7)),console[_0x5e1e6a(0x1ba)]('üìÖ\x20Custom\x20period:\x20'+_0x38b3e4['toISOString']()+_0x5e1e6a(0x163)+_0x39f8a3[_0x5e1e6a(0x1b2)]());}else{const _0x143e52=new Date(Date['UTC'](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),_0x499ea4[_0x5e1e6a(0x17d)]()-0x1e));_0x38b3e4=new Date(Date['UTC'](_0x143e52[_0x5e1e6a(0x1c0)](),_0x143e52[_0x5e1e6a(0x13c)](),_0x143e52[_0x5e1e6a(0x17d)](),0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),_0x499ea4[_0x5e1e6a(0x17d)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x11f46e=_0x503450||_0x5e1e6a(0x1bd);switch(_0x11f46e[_0x5e1e6a(0x18e)]()){case'today':_0x38b3e4=new Date(Date['UTC'](_0x499ea4['getUTCFullYear'](),_0x499ea4['getUTCMonth'](),_0x499ea4[_0x5e1e6a(0x17d)](),0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4['getUTCFullYear'](),_0x499ea4[_0x5e1e6a(0x13c)](),_0x499ea4['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x142a0e=new Date(_0x499ea4);_0x142a0e[_0x5e1e6a(0x204)](_0x142a0e[_0x5e1e6a(0x17d)]()-0x1),_0x38b3e4=new Date(Date[_0x5e1e6a(0x152)](_0x142a0e['getUTCFullYear'](),_0x142a0e[_0x5e1e6a(0x13c)](),_0x142a0e[_0x5e1e6a(0x17d)](),0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x142a0e[_0x5e1e6a(0x1c0)](),_0x142a0e[_0x5e1e6a(0x13c)](),_0x142a0e[_0x5e1e6a(0x17d)](),0x17,0x3b,0x3b,0x3e7));break;case _0x5e1e6a(0x14c):const _0x58d511=_0x499ea4[_0x5e1e6a(0x15e)](),_0x69eed6=_0x58d511===0x0?-0x6:0x1-_0x58d511,_0x3a0d52=_0x499ea4[_0x5e1e6a(0x17d)]()+_0x69eed6;_0x38b3e4=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4['getUTCFullYear'](),_0x499ea4[_0x5e1e6a(0x13c)](),_0x3a0d52,0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4['getUTCMonth'](),_0x499ea4[_0x5e1e6a(0x17d)](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0xb76d72=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),_0x499ea4[_0x5e1e6a(0x17d)]()-0x7)),_0x312761=_0xb76d72[_0x5e1e6a(0x15e)](),_0x21f998=_0x312761===0x0?-0x6:0x1-_0x312761,_0x4f6391=_0xb76d72[_0x5e1e6a(0x17d)]()+_0x21f998;_0x38b3e4=new Date(Date[_0x5e1e6a(0x152)](_0xb76d72[_0x5e1e6a(0x1c0)](),_0xb76d72[_0x5e1e6a(0x13c)](),_0x4f6391,0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0xb76d72['getUTCFullYear'](),_0xb76d72['getUTCMonth'](),_0x4f6391+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x5e1e6a(0x1bd):_0x38b3e4=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),0x1,0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date['UTC'](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),_0x499ea4[_0x5e1e6a(0x17d)](),0x17,0x3b,0x3b,0x3e7));break;case _0x5e1e6a(0x15c):_0x38b3e4=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date['UTC'](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x5e1e6a(0x146):_0x38b3e4=new Date(Date[_0x5e1e6a(0x152)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),_0x499ea4[_0x5e1e6a(0x17d)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x38b3e4=new Date(Date['UTC'](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4[_0x5e1e6a(0x13c)](),0x1,0x0,0x0,0x0,0x0)),_0x39f8a3=new Date(Date[_0x5e1e6a(0x152)](_0x499ea4[_0x5e1e6a(0x1c0)](),_0x499ea4['getUTCMonth'](),_0x499ea4[_0x5e1e6a(0x17d)](),0x17,0x3b,0x3b,0x3e7));}}}console['log']('üìÖ\x20Final\x20date\x20range:\x20'+_0x38b3e4['toISOString']()+_0x5e1e6a(0x163)+_0x39f8a3[_0x5e1e6a(0x1b2)]());const _0xbcbdd3={'gte':_0x38b3e4,'lte':_0x39f8a3},[_0x10ac59,_0x2e6924,_0xc8fb24,_0x4ed8f5,_0x182d88,_0x44a328,_0x15ebf6,_0x3c1c4e,_0x1a0604,_0x4bc4fa]=await Promise[_0x5e1e6a(0x1a6)]([database_1[_0x5e1e6a(0x176)][_0x5e1e6a(0x1ab)][_0x5e1e6a(0x190)]({'where':{'shopId':_0x44972d,'gateway':{'not':_0x5e1e6a(0x1bb)},'status':{'notIn':['PENDING',_0x5e1e6a(0x1e7)]},'createdAt':_0xbcbdd3}}),database_1['default'][_0x5e1e6a(0x1ab)][_0x5e1e6a(0x190)]({'where':{'shopId':_0x44972d,'gateway':{'not':_0x5e1e6a(0x1bb)},'status':'PAID','createdAt':_0xbcbdd3}}),database_1['default'][_0x5e1e6a(0x1ab)][_0x5e1e6a(0x190)]({'where':{'shopId':_0x44972d,'gateway':{'not':_0x5e1e6a(0x1bb)},'status':'CHARGEBACK'}}),database_1[_0x5e1e6a(0x176)][_0x5e1e6a(0x1ab)][_0x5e1e6a(0x190)]({'where':{'shopId':_0x44972d,'gateway':{'not':_0x5e1e6a(0x1bb)},'status':_0x5e1e6a(0x1b5)}}),database_1[_0x5e1e6a(0x176)][_0x5e1e6a(0x1ab)][_0x5e1e6a(0x1e1)]({'where':{'shopId':_0x44972d,'gateway':{'not':'test_gateway'},'status':_0x5e1e6a(0x1dd),'createdAt':_0xbcbdd3},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1[_0x5e1e6a(0x176)][_0x5e1e6a(0x1ab)]['findMany']({'where':{'shopId':_0x44972d,'gateway':{'not':_0x5e1e6a(0x1bb)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5e1e6a(0x176)][_0x5e1e6a(0x1ab)][_0x5e1e6a(0x1e1)]({'where':{'shopId':_0x44972d,'gateway':{'not':'test_gateway'},'createdAt':_0xbcbdd3},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x5e1e6a(0x193)}}),database_1[_0x5e1e6a(0x176)][_0x5e1e6a(0x1ab)]['count']({'where':{'shopId':_0x44972d,'gateway':{'not':_0x5e1e6a(0x1bb)},'status':_0x5e1e6a(0x1dd)}}),database_1['default']['payment'][_0x5e1e6a(0x1e1)]({'where':{'shopId':_0x44972d,'gateway':{'not':_0x5e1e6a(0x1bb)},'status':_0x5e1e6a(0x1dd)},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x5e1e6a(0x176)][_0x5e1e6a(0x178)][_0x5e1e6a(0x1b3)]({'where':{'id':_0x44972d},'select':{'balance':!![]}})]);let _0x345e73=0x0,_0x36f46b=0x0;for(const _0x174e5a of _0x182d88){if(_0x174e5a['amountUSDT'])_0x345e73+=_0x174e5a['amountUSDT'];else{const _0x3498aa=await currencyService_1[_0x5e1e6a(0x1de)][_0x5e1e6a(0x1b7)](_0x174e5a[_0x5e1e6a(0x1d0)],_0x174e5a[_0x5e1e6a(0x17c)]);_0x345e73+=_0x3498aa;}_0x174e5a[_0x5e1e6a(0x13d)]&&(_0x36f46b+=_0x174e5a[_0x5e1e6a(0x13d)]);}let _0x1c6322=0x0;for(const _0x53a6e2 of _0x1a0604){_0x53a6e2[_0x5e1e6a(0x13d)]&&(_0x1c6322+=_0x53a6e2[_0x5e1e6a(0x13d)]);}const _0x3e1c77=this[_0x5e1e6a(0x1b4)](_0x15ebf6,_0x38b3e4,_0x39f8a3||_0x499ea4),_0x27e641=_0x10ac59>0x0?_0x2e6924/_0x10ac59*0x64:0x0,_0x3813bd=_0x3c1c4e>0x0?_0xc8fb24/_0x3c1c4e*0x64:0x0;return{'totalPayments':_0x10ac59,'successfulPayments':_0x2e6924,'totalRevenue':Math[_0x5e1e6a(0x1d8)](_0x345e73*0x64)/0x64,'merchantEarnings':Math[_0x5e1e6a(0x1d8)](_0x36f46b*0x64)/0x64,'merchantTotalRevenue':Math['round'](_0x1c6322*0x64)/0x64,'payoutBalance':Math[_0x5e1e6a(0x1d8)]((_0x4bc4fa?.[_0x5e1e6a(0x1af)]||0x0)*0x64)/0x64,'conversionRate':Math[_0x5e1e6a(0x1d8)](_0x27e641*0x64)/0x64,'chargebackRate':Math[_0x5e1e6a(0x1d8)](_0x3813bd*0x64)/0x64,'chargebacks':_0xc8fb24,'refunds':_0x4ed8f5,'dailyRevenue':_0x3e1c77[_0x5e1e6a(0x177)],'dailyPayments':_0x3e1c77['dailyPayments'],'recentPayments':_0x44a328[_0x5e1e6a(0x201)](_0x2e6a66=>({'id':_0x2e6a66['id'],'gateway':_0x2e6a66[_0x5e1e6a(0x148)],'amount':_0x2e6a66[_0x5e1e6a(0x1d0)],'currency':_0x2e6a66['currency'],'status':_0x2e6a66[_0x5e1e6a(0x1d6)],'createdAt':_0x2e6a66[_0x5e1e6a(0x1ce)]}))};}[a77_0x246c6d(0x1b4)](_0x115ae8,_0x4b675b,_0x48e2a1){const _0x2f7d0c=a77_0x246c6d,_0x45c5ac=new Map(),_0x781f76=new Date(_0x4b675b);while(_0x781f76<=_0x48e2a1){const _0x37da76=_0x781f76['toISOString']()['split']('T')[0x0];_0x45c5ac[_0x2f7d0c(0x1fe)](_0x37da76,{'revenue':0x0,'count':0x0}),_0x781f76[_0x2f7d0c(0x19e)](_0x781f76[_0x2f7d0c(0x202)]()+0x1);}for(const _0x4b1ce9 of _0x115ae8){const _0x2c4c1e=_0x4b1ce9[_0x2f7d0c(0x1ce)][_0x2f7d0c(0x1b2)]()['split']('T')[0x0],_0x3634e1=_0x45c5ac[_0x2f7d0c(0x19f)](_0x2c4c1e);_0x3634e1&&(_0x3634e1[_0x2f7d0c(0x190)]+=0x1,_0x4b1ce9['status']==='PAID'&&_0x4b1ce9[_0x2f7d0c(0x171)]&&(_0x3634e1[_0x2f7d0c(0x1fd)]+=_0x4b1ce9[_0x2f7d0c(0x171)]));}const _0x4cf091=[],_0x392ece=[];for(const [_0x23a201,_0x4e065d]of _0x45c5ac){_0x4cf091[_0x2f7d0c(0x1b0)]({'date':_0x23a201,'amount':Math['round'](_0x4e065d[_0x2f7d0c(0x1fd)]*0x64)/0x64}),_0x392ece[_0x2f7d0c(0x1b0)]({'date':_0x23a201,'count':_0x4e065d[_0x2f7d0c(0x190)]});}return{'dailyRevenue':_0x4cf091,'dailyPayments':_0x392ece};}['generateBackupCodes'](_0x584050=0x8){const _0x5a61b4=a77_0x246c6d,_0x22dd81=[];for(let _0x3e316a=0x0;_0x3e316a<_0x584050;_0x3e316a++){const _0x362e15=crypto_1[_0x5a61b4(0x176)][_0x5a61b4(0x1a4)](0x4)[_0x5a61b4(0x21b)](_0x5a61b4(0x1ec))[_0x5a61b4(0x1c2)]();_0x22dd81[_0x5a61b4(0x1b0)](_0x362e15);}return _0x22dd81;}async['setup2FA'](_0x1875cb){const _0x595a4b=a77_0x246c6d,_0x2e9445=await database_1[_0x595a4b(0x176)][_0x595a4b(0x178)][_0x595a4b(0x1b3)]({'where':{'id':_0x1875cb},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2e9445)throw new Error('Shop\x20not\x20found');const _0x1571d8=speakeasy_1[_0x595a4b(0x176)][_0x595a4b(0x1eb)]({'name':_0x595a4b(0x1f4)+_0x2e9445['username']+')','issuer':_0x595a4b(0x19b),'length':0x20}),_0x407c74=await qrcode_1[_0x595a4b(0x176)]['toDataURL'](_0x1571d8[_0x595a4b(0x170)]),_0x4baeb4=this['generateBackupCodes'](0x8),_0x5d270a=await Promise[_0x595a4b(0x1a6)](_0x4baeb4['map'](_0x4b67e1=>bcryptjs_1[_0x595a4b(0x176)][_0x595a4b(0x18c)](_0x4b67e1,0xa)));return await database_1[_0x595a4b(0x176)][_0x595a4b(0x178)]['update']({'where':{'id':_0x1875cb},'data':{'twoFactorSecret':_0x1571d8[_0x595a4b(0x151)],'backupCodes':JSON[_0x595a4b(0x179)](_0x5d270a)}}),console[_0x595a4b(0x1ba)](_0x595a4b(0x1d2)+_0x2e9445[_0x595a4b(0x1e5)]),console[_0x595a4b(0x1ba)](_0x595a4b(0x159)+_0x4baeb4['length']+'\x20backup\x20codes'),{'secret':_0x1571d8[_0x595a4b(0x151)],'qrCode':_0x407c74,'manualEntryKey':_0x1571d8[_0x595a4b(0x151)],'backupCodes':_0x4baeb4};}async[a77_0x246c6d(0x181)](_0x35f369,_0x5ce49b){const _0x38aaea=a77_0x246c6d,_0x234578=await database_1['default']['shop']['findUnique']({'where':{'id':_0x35f369},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x234578)throw new Error(_0x38aaea(0x16d));if(!_0x234578[_0x38aaea(0x19a)])throw new Error(_0x38aaea(0x16b));if(_0x234578[_0x38aaea(0x205)])throw new Error(_0x38aaea(0x17e));const _0xf610d7=speakeasy_1[_0x38aaea(0x176)]['totp'][_0x38aaea(0x149)]({'secret':_0x234578[_0x38aaea(0x19a)],'encoding':'base32','token':_0x5ce49b,'window':0x2});if(!_0xf610d7)throw new Error(_0x38aaea(0x196));return await database_1[_0x38aaea(0x176)][_0x38aaea(0x178)]['update']({'where':{'id':_0x35f369},'data':{'twoFactorEnabled':!![]}}),console[_0x38aaea(0x1ba)](_0x38aaea(0x185)+_0x234578['username']),{'enabled':!![]};}async[a77_0x246c6d(0x197)](_0x29cda9){const _0x2df849=a77_0x246c6d,_0x5a854e=await database_1[_0x2df849(0x176)][_0x2df849(0x178)][_0x2df849(0x1b3)]({'where':{'id':_0x29cda9},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5a854e)throw new Error(_0x2df849(0x16d));await database_1['default'][_0x2df849(0x178)][_0x2df849(0x15f)]({'where':{'id':_0x29cda9},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x2df849(0x1ba)](_0x2df849(0x217)+_0x5a854e[_0x2df849(0x1e5)]);}}exports[a77_0x246c6d(0x1a1)]=ShopService;function a77_0x3c9a(){const _0x337ae1=['14408pIWnPw','Shop\x20not\x20found','25223UmesvH','getPayoutStatistics','otpauth_url','amountUSDT','trc20','settings','getGatewayDisplayName','includes','default','dailyRevenue','shop','stringify','Invalid\x202FA\x20token\x20or\x20backup\x20code','POST','currency','getUTCDate','2FA\x20is\x20already\x20enabled','periodFrom','error','enable2FA','desc','findFirst','updateShopProfile','üîê\x202FA\x20enabled\x20for\x20shop:\x20','getWebhookLogs','webhookUrl','usdtTrcWallet','notes','usdtPolygonWallet','getStatistics','hash','Noda','toLowerCase','...','count','Webhook\x20returned\x20error:\x20','isArray','asc','KLYME\x20EU','shopId','Invalid\x202FA\x20token','disable2FA','test_order_123','statusText','twoFactorSecret','TrapaPay','splice','usdcPolygonWallet','setDate','get','formatNetworkName','ShopService','Unknown\x20error','setHours','randomBytes','\x20USDT\x20(total\x20payouts)','all','statusCode','\x20payout\x20statistics\x20calculated:','telegram','event','payment','application/json','USDT\x20ERC20','4050kPixDe','balance','push','paidAt','toISOString','findUnique','generateDailyStatistics','REFUND','CoinToPay','convertToUSDT','message','parse','log','test_gateway','USD','this_month','getPayoutById','gatewaySettings','getUTCFullYear','getPayouts','toUpperCase','PaymentService','compare','2FA\x20token\x20is\x20required','merchantUrl','paymentGateways','getPaymentsByShop','getPaymentById','totalPaidOut','customer','Payment\x20System/1.0\x20(Test)','8hkTmwQ','createdAt','updatePayment','amount','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','90d','startsWith','split','status','webhookLog','round','Test\x20webhook\x20sent\x20successfully\x20(','publicKey','üìÖ\x20Date\x20end:\x20','../config/database','PAID','currencyService','üìÖ\x20Period\x20start:\x20','getTime','findMany','YESTERDAY','test_payment_123','üåê\x20Method\x20filter:\x20','username','txid','EXPIRED','usdtErcWallet','gte','network','generateSecret','hex',',\x20dateTo:\x20','34979724flGIMp','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','8808RdZqqD','\x20USDT\x20(current\x20balance)','payout','twoFactorToken','TrapaPay\x20(','webhookEvents','Error\x20parsing\x20webhook\x20events:','qrcode','usdcErcWallet','sourceCurrency','USDT\x20BSC','USDC\x20Ethereum','filter','revenue','set','COMPLETED','awaitingPayout','map','getDate','2553078oAKwNl','setUTCDate','twoFactorEnabled','custom_','paymentService','\x20\x20\x20üìÖ\x20This\x20month:\x20','\x20\x20\x20üíµ\x20Available\x20balance:\x20','\x20USDT','redirectUrl','AVAILABLE_GATEWAYS','lte','createPayment','No\x20webhook\x20URL\x20configured','77MvCYIB','amountIsEditable','paymentId','7479kUHxnn','backupCodes','deletePayment','340XmOWdb','üîê\x202FA\x20disabled\x20for\x20shop:\x20','polygon_usdc','üìÖ\x20Period\x20end:\x20',',\x20dateFrom:\x20','toString','wallets','86015cyfKCA','Test\x20Gateway','gateways','üí∞\x20Getting\x20payouts\x20with\x20filters:','createPublicPayment','getUTCMonth','amountAfterGatewayCommissionUSDT','speakeasy','getMonth','KLYME\x20GB','periodTo','name','getShopPayoutStats','updateWallets',',\x20period:\x20','all_time','reduce','gateway','verify','erc20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','this_week','bcryptjs','maxPayments','length','getPayoutStats','base32','UTC','KLYME\x20DE','üìä\x20Shop\x20','delete','Payment\x20not\x20found','_sum','__importDefault','üîë\x20Generated\x20','test','shopUrl','last_month','erc20_usdc','getUTCDay','update','fullName','üåê\x20Network\x20filter:\x20','__esModule','\x20to\x20','getPayments','USDT\x20Polygon','ceil','üìÖ\x20Date\x20start:\x20','totp','üìä\x20Getting\x20statistics\x20for\x20shop\x20','446238kJuUUv','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first'];a77_0x3c9a=function(){return _0x337ae1;};return a77_0x3c9a();}