'use strict';function a60_0x4f48(){const _0x41f175=['getFullYear','all','isArray','split','getTime','test','Rapyd','totalPaidOut','map','usage','application/json','toLowerCase','thisMonth','dailyRevenue','customerName','username','getWebhookLogs','revenue','...','getPayoutById','paid','statusText','90d','paymentGateways','üìä\x20Final\x20WHERE\x20conditions:','üåê\x20Method\x20filter:\x20','event','telegramId','getPaymentByShopAndId','lte','default','getPayoutStats','üìä\x20Status\x20filter:\x20','getShopProfile','5514975SaKoxx','createPublicPayment','publicKey','redirectUrl','parse','paymentService','./currencyService','findMany','CoinToPay','\x20USDT','payout','Webhook\x20returned\x20error:\x20','toISOString','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','erc20','count','Error\x20parsing\x20webhook\x20events:','TesSoft\x20Payment\x20System/1.0\x20(Test)','findUnique','gatewaySettings','toUpperCase','üìÖ\x20Period\x20start:\x20','\x20USDT\x20(current\x20balance)','generateDailyStatistics','YESTERDAY','PaymentService','availableBalance','updateShopProfile','getPaymentsByShop','\x20payout\x20statistics\x20calculated:','test_gateway','notes','getShopPayoutStats','network','328472PAKdLO','periodTo','66dfkhBs','getMonth','defineProperty','convertToUSDT','getGatewayDisplayName','usdtErcWallet','status','webhookLog','USDT\x20ERC20','getPayments','telegram','üìÖ\x20Date\x20start:\x20','createdAt','trc20','maxPayments','stringify','customer','Unknown\x20error','Shop\x20not\x20found','webhookEvents','PAID','ShopService','üìä\x20Shop\x20','responseBody','error','delete','864815xOMxGs','USDT\x20BSC','30d','1872810XuYWfg','setHours','test_order_123','USD','push','Test\x20webhook\x20sent\x20successfully\x20(','paidAt','./paymentService','usdtTrcWallet','fullName','country','setDate','8enuebn','üìÖ\x20Date\x20end:\x20','merchantUrl','getDate','Noda','\x20\x20\x20üíµ\x20Available\x20balance:\x20','439943VWfxbW','shopUrl','expiresAt','yesterday','usdtPolygonWallet','polygon','reduce','üåê\x20Network\x20filter:\x20','REJECTED','statusCode','balance','createPayment','2595920uJWhbu','round','__esModule','amountIsEditable','gateways','language','update','COMPLETED','3rRPzPt','usdcPolygonWallet','PENDING','üìÖ\x20Period\x20end:\x20','aggregate','1360334ECOxFC','currencyService','Payment\x20not\x20found','USDC\x20Polygon','shopId','name','desc','customerEmail','shop','payment','test_payment_123','gte','paymentId','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','currency','ceil','settings','wallets','txid','amount','Test\x20Gateway','day','amountUSDT','retryCount','findFirst','log','No\x20webhook\x20URL\x20configured','6gFgbVy','../config/database','updatePayment','POST','webhookUrl','KLYME\x20DE'];a60_0x4f48=function(){return _0x41f175;};return a60_0x4f48();}const a60_0x2944ce=a60_0x217d;(function(_0x516ea4,_0x465033){const _0x21f9a5=a60_0x217d,_0x24794=_0x516ea4();while(!![]){try{const _0x3596ac=parseInt(_0x21f9a5(0x106))/0x1+parseInt(_0x21f9a5(0x150))/0x2*(-parseInt(_0x21f9a5(0x14b))/0x3)+parseInt(_0x21f9a5(0x143))/0x4+parseInt(_0x21f9a5(0x122))/0x5*(-parseInt(_0x21f9a5(0x16b))/0x6)+parseInt(_0x21f9a5(0x137))/0x7+parseInt(_0x21f9a5(0x131))/0x8*(-parseInt(_0x21f9a5(0x193))/0x9)+parseInt(_0x21f9a5(0x125))/0xa*(parseInt(_0x21f9a5(0x108))/0xb);if(_0x3596ac===_0x465033)break;else _0x24794['push'](_0x24794['shift']());}catch(_0x34ec1d){_0x24794['push'](_0x24794['shift']());}}}(a60_0x4f48,0xaa6e2));var __importDefault=this&&this['__importDefault']||function(_0x9f1ece){return _0x9f1ece&&_0x9f1ece['__esModule']?_0x9f1ece:{'default':_0x9f1ece};};Object[a60_0x2944ce(0x10a)](exports,a60_0x2944ce(0x145),{'value':!![]}),exports[a60_0x2944ce(0x11d)]=void 0x0;const database_1=__importDefault(require(a60_0x2944ce(0x16c))),currencyService_1=require(a60_0x2944ce(0xea)),paymentService_1=require(a60_0x2944ce(0x12c));function a60_0x217d(_0x3cac82,_0x4e9e2d){const _0x4f48f4=a60_0x4f48();return a60_0x217d=function(_0x217d37,_0x188e84){_0x217d37=_0x217d37-0xe5;let _0x1b856b=_0x4f48f4[_0x217d37];return _0x1b856b;},a60_0x217d(_0x3cac82,_0x4e9e2d);}class ShopService{constructor(){const _0x364f03=a60_0x2944ce;this[_0x364f03(0xe9)]=new paymentService_1[(_0x364f03(0xfd))]();}async[a60_0x2944ce(0x192)](_0x17df95){const _0x1383a5=a60_0x2944ce,_0x311eb2=await database_1[_0x1383a5(0x18f)]['shop'][_0x1383a5(0xf6)]({'where':{'id':_0x17df95},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x311eb2)throw new Error(_0x1383a5(0x11a));let _0x23bb7c=[];if(_0x311eb2[_0x1383a5(0x160)]?.[_0x1383a5(0x11b)])try{_0x23bb7c=Array[_0x1383a5(0x173)](_0x311eb2[_0x1383a5(0x160)]['webhookEvents'])?_0x311eb2[_0x1383a5(0x160)][_0x1383a5(0x11b)]:JSON['parse'](_0x311eb2['settings'][_0x1383a5(0x11b)]);}catch(_0x5c323f){console[_0x1383a5(0x120)](_0x1383a5(0xf4),_0x5c323f),_0x23bb7c=[];}return{'id':_0x311eb2['id'],'fullName':_0x311eb2[_0x1383a5(0x155)],'username':_0x311eb2['username'],'telegramId':_0x311eb2[_0x1383a5(0x112)],'merchantUrl':_0x311eb2[_0x1383a5(0x138)],'gateways':_0x311eb2[_0x1383a5(0x188)]?JSON[_0x1383a5(0xe8)](_0x311eb2['paymentGateways']):null,'gatewaySettings':_0x311eb2[_0x1383a5(0xf7)]?JSON[_0x1383a5(0xe8)](_0x311eb2[_0x1383a5(0xf7)]):null,'publicKey':_0x311eb2['publicKey'],'webhookUrl':_0x311eb2[_0x1383a5(0x160)]?.[_0x1383a5(0x16f)]||null,'webhookEvents':_0x23bb7c,'wallets':{'usdtPolygonWallet':_0x311eb2[_0x1383a5(0x13b)],'usdtTrcWallet':_0x311eb2[_0x1383a5(0x12d)],'usdtErcWallet':_0x311eb2[_0x1383a5(0x10d)],'usdcPolygonWallet':_0x311eb2['usdcPolygonWallet']},'status':_0x311eb2['status'],'createdAt':_0x311eb2[_0x1383a5(0x114)]};}async[a60_0x2944ce(0xff)](_0x30f75f,_0x292273){const _0x4293e4=a60_0x2944ce,_0xc15e7f={};_0x292273[_0x4293e4(0x12e)]&&(_0xc15e7f[_0x4293e4(0x155)]=_0x292273['fullName']);_0x292273[_0x4293e4(0x18c)]!==undefined&&(_0xc15e7f[_0x4293e4(0x112)]=_0x292273[_0x4293e4(0x18c)]||null);_0x292273[_0x4293e4(0x133)]&&(_0xc15e7f[_0x4293e4(0x138)]=_0x292273[_0x4293e4(0x133)]);_0x292273[_0x4293e4(0x147)]&&(_0xc15e7f[_0x4293e4(0x188)]=JSON[_0x4293e4(0x117)](_0x292273[_0x4293e4(0x147)]));_0x292273[_0x4293e4(0xf7)]&&(_0xc15e7f['gatewaySettings']=JSON[_0x4293e4(0x117)](_0x292273[_0x4293e4(0xf7)]));_0x292273[_0x4293e4(0x161)]&&(_0x292273[_0x4293e4(0x161)]['usdtPolygonWallet']!==undefined&&(_0xc15e7f['usdtPolygonWallet']=_0x292273['wallets'][_0x4293e4(0x13b)]||null),_0x292273[_0x4293e4(0x161)][_0x4293e4(0x12d)]!==undefined&&(_0xc15e7f[_0x4293e4(0x12d)]=_0x292273['wallets'][_0x4293e4(0x12d)]||null),_0x292273[_0x4293e4(0x161)][_0x4293e4(0x10d)]!==undefined&&(_0xc15e7f[_0x4293e4(0x10d)]=_0x292273['wallets'][_0x4293e4(0x10d)]||null),_0x292273[_0x4293e4(0x161)]['usdcPolygonWallet']!==undefined&&(_0xc15e7f[_0x4293e4(0x14c)]=_0x292273[_0x4293e4(0x161)][_0x4293e4(0x14c)]||null));const _0xbe3cb8=await database_1[_0x4293e4(0x18f)][_0x4293e4(0x158)][_0x4293e4(0x149)]({'where':{'id':_0x30f75f},'data':_0xc15e7f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x295716=[];if(_0xbe3cb8[_0x4293e4(0x160)]?.['webhookEvents'])try{_0x295716=Array[_0x4293e4(0x173)](_0xbe3cb8[_0x4293e4(0x160)][_0x4293e4(0x11b)])?_0xbe3cb8[_0x4293e4(0x160)][_0x4293e4(0x11b)]:JSON[_0x4293e4(0xe8)](_0xbe3cb8[_0x4293e4(0x160)]['webhookEvents']);}catch(_0x95c29){console[_0x4293e4(0x120)]('Error\x20parsing\x20webhook\x20events:',_0x95c29),_0x295716=[];}return{'id':_0xbe3cb8['id'],'fullName':_0xbe3cb8[_0x4293e4(0x155)],'username':_0xbe3cb8['username'],'telegramId':_0xbe3cb8['telegram'],'merchantUrl':_0xbe3cb8['shopUrl'],'gateways':_0xbe3cb8[_0x4293e4(0x188)]?JSON[_0x4293e4(0xe8)](_0xbe3cb8[_0x4293e4(0x188)]):null,'gatewaySettings':_0xbe3cb8['gatewaySettings']?JSON[_0x4293e4(0xe8)](_0xbe3cb8[_0x4293e4(0xf7)]):null,'publicKey':_0xbe3cb8[_0x4293e4(0xe6)],'webhookUrl':_0xbe3cb8['settings']?.[_0x4293e4(0x16f)]||null,'webhookEvents':_0x295716,'wallets':{'usdtPolygonWallet':_0xbe3cb8[_0x4293e4(0x13b)],'usdtTrcWallet':_0xbe3cb8[_0x4293e4(0x12d)],'usdtErcWallet':_0xbe3cb8['usdtErcWallet'],'usdcPolygonWallet':_0xbe3cb8['usdcPolygonWallet']},'status':_0xbe3cb8['status'],'createdAt':_0xbe3cb8['createdAt']};}async['updateWallets'](_0x4a46ae,_0x43d89a){const _0x47e53e=a60_0x2944ce,_0x39a42d={};_0x43d89a[_0x47e53e(0x13b)]!==undefined&&(_0x39a42d[_0x47e53e(0x13b)]=_0x43d89a[_0x47e53e(0x13b)]||null),_0x43d89a[_0x47e53e(0x12d)]!==undefined&&(_0x39a42d[_0x47e53e(0x12d)]=_0x43d89a[_0x47e53e(0x12d)]||null),_0x43d89a[_0x47e53e(0x10d)]!==undefined&&(_0x39a42d['usdtErcWallet']=_0x43d89a[_0x47e53e(0x10d)]||null),_0x43d89a['usdcPolygonWallet']!==undefined&&(_0x39a42d['usdcPolygonWallet']=_0x43d89a[_0x47e53e(0x14c)]||null),await database_1[_0x47e53e(0x18f)][_0x47e53e(0x158)]['update']({'where':{'id':_0x4a46ae},'data':_0x39a42d});}async['testWebhook'](_0x4e4b74){const _0x599c50=a60_0x2944ce,_0x10bc93=await database_1[_0x599c50(0x18f)][_0x599c50(0x158)][_0x599c50(0xf6)]({'where':{'id':_0x4e4b74},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x10bc93?.['settings']?.[_0x599c50(0x16f)])throw new Error(_0x599c50(0x16a));const _0x52290a={'event':_0x599c50(0x176),'payment':{'id':_0x599c50(0x15a),'order_id':_0x599c50(0x127),'gateway':_0x599c50(0x176),'amount':0x64,'currency':_0x599c50(0x128),'status':_0x599c50(0x185),'created_at':new Date()[_0x599c50(0xf0)]()}};try{const _0x54bb1a=await fetch(_0x10bc93[_0x599c50(0x160)]['webhookUrl'],{'method':_0x599c50(0x16e),'headers':{'Content-Type':_0x599c50(0x17b),'User-Agent':_0x599c50(0xf5)},'body':JSON[_0x599c50(0x117)](_0x52290a)});return _0x54bb1a['ok']?{'success':!![],'message':_0x599c50(0x12a)+_0x54bb1a[_0x599c50(0x10e)]+')'}:{'success':![],'message':_0x599c50(0xef)+_0x54bb1a['status']+'\x20'+_0x54bb1a[_0x599c50(0x186)]};}catch(_0x7d849c){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x7d849c instanceof Error?_0x7d849c['message']:_0x599c50(0x119))};}}async[a60_0x2944ce(0x142)](_0x44b3d7){const _0x39d887=a60_0x2944ce;return this[_0x39d887(0xe9)][_0x39d887(0xe5)]({'public_key':'','gateway':_0x44b3d7['gateway'],'order_id':undefined,'amount':_0x44b3d7[_0x39d887(0x163)],'currency':_0x44b3d7['currency'],'source_currency':_0x44b3d7['sourceCurrency'],'usage':_0x44b3d7[_0x39d887(0x17a)],'expires_at':_0x44b3d7[_0x39d887(0x139)]?.[_0x39d887(0xf0)](),'success_url':_0x44b3d7[_0x39d887(0xe7)],'fail_url':_0x44b3d7[_0x39d887(0xe7)],'customer_email':_0x44b3d7[_0x39d887(0x157)],'customer_name':_0x44b3d7[_0x39d887(0x17f)],'country':_0x44b3d7[_0x39d887(0x12f)],'language':_0x44b3d7[_0x39d887(0x148)],'amount_is_editable':_0x44b3d7[_0x39d887(0x146)],'max_payments':_0x44b3d7[_0x39d887(0x116)],'customer':_0x44b3d7[_0x39d887(0x118)]});}async[a60_0x2944ce(0x111)](_0x15388c,_0xd9364f){const _0x39c23a=a60_0x2944ce;return this[_0x39c23a(0xe9)][_0x39c23a(0x100)](_0x15388c,_0xd9364f);}async['getPaymentById'](_0x2e1480,_0x1b3e95){const _0x21bbf4=a60_0x2944ce;return this['paymentService'][_0x21bbf4(0x18d)](_0x2e1480,_0x1b3e95);}async[a60_0x2944ce(0x16d)](_0x3abe8d,_0x28774e,_0x244411){const _0x5401d1=a60_0x2944ce,_0x208d9c=await database_1[_0x5401d1(0x18f)]['payment']['findFirst']({'where':{'id':_0x28774e,'shopId':_0x3abe8d}});if(!_0x208d9c)throw new Error(_0x5401d1(0x152));const _0x49eca4=await database_1[_0x5401d1(0x18f)]['payment']['update']({'where':{'id':_0x28774e},'data':{..._0x244411,'updatedAt':new Date()}});return _0x49eca4;}async['deletePayment'](_0x12a4d5,_0x2a61dc){const _0x14f827=a60_0x2944ce,_0x5b28f0=await database_1['default']['payment'][_0x14f827(0x168)]({'where':{'id':_0x2a61dc,'shopId':_0x12a4d5}});if(!_0x5b28f0)throw new Error(_0x14f827(0x152));await database_1[_0x14f827(0x18f)][_0x14f827(0x159)][_0x14f827(0x121)]({'where':{'id':_0x2a61dc}});}['formatNetworkName'](_0x263fd2){const _0x14e3ce=a60_0x2944ce,_0x2438cd={'polygon':'USDT\x20Polygon','trc20':'USDT\x20TRC20','erc20':_0x14e3ce(0x110),'bsc':_0x14e3ce(0x123),'polygon_usdc':_0x14e3ce(0x153)};return _0x2438cd[_0x263fd2]||_0x263fd2;}async['getPayouts'](_0x35c287,_0x2608b1){const _0x3f3721=a60_0x2944ce,{page:_0x2f9393,limit:_0x515e22,status:_0x44c279,method:_0x586522,network:_0x6ae0a0,dateFrom:_0x45ae86,dateTo:_0x2ee8a1,periodFrom:_0x5c52f8,periodTo:_0xc28d3b}=_0x2608b1,_0x714798=(_0x2f9393-0x1)*_0x515e22;console[_0x3f3721(0x169)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x2608b1);const _0x4994e3={'shopId':_0x35c287};_0x44c279&&(_0x4994e3[_0x3f3721(0x10e)]=_0x44c279[_0x3f3721(0xf8)](),console[_0x3f3721(0x169)](_0x3f3721(0x191)+_0x44c279[_0x3f3721(0xf8)]()));if(_0x586522)_0x4994e3[_0x3f3721(0x105)]=_0x586522,console['log'](_0x3f3721(0x18a)+_0x586522);else _0x6ae0a0&&(_0x4994e3[_0x3f3721(0x105)]=_0x6ae0a0,console[_0x3f3721(0x169)](_0x3f3721(0x13e)+_0x6ae0a0));if(_0x45ae86||_0x2ee8a1||_0x5c52f8||_0xc28d3b){_0x4994e3[_0x3f3721(0x114)]={};if(_0x5c52f8){const _0x3cb746=new Date(_0x5c52f8);_0x3cb746[_0x3f3721(0x126)](0x0,0x0,0x0,0x0),_0x4994e3[_0x3f3721(0x114)]['gte']=_0x3cb746,console[_0x3f3721(0x169)](_0x3f3721(0xf9)+_0x3cb746[_0x3f3721(0xf0)]());}else{if(_0x45ae86){const _0x2602e6=new Date(_0x45ae86);_0x2602e6[_0x3f3721(0x126)](0x0,0x0,0x0,0x0),_0x4994e3[_0x3f3721(0x114)][_0x3f3721(0x15b)]=_0x2602e6,console[_0x3f3721(0x169)](_0x3f3721(0x113)+_0x2602e6[_0x3f3721(0xf0)]());}}if(_0xc28d3b){const _0x4f63d3=new Date(_0xc28d3b);_0x4f63d3[_0x3f3721(0x126)](0x17,0x3b,0x3b,0x3e7),_0x4994e3[_0x3f3721(0x114)]['lte']=_0x4f63d3,console[_0x3f3721(0x169)](_0x3f3721(0x14e)+_0x4f63d3[_0x3f3721(0xf0)]());}else{if(_0x2ee8a1){const _0x3c4809=new Date(_0x2ee8a1);_0x3c4809[_0x3f3721(0x126)](0x17,0x3b,0x3b,0x3e7),_0x4994e3[_0x3f3721(0x114)][_0x3f3721(0x18e)]=_0x3c4809,console[_0x3f3721(0x169)](_0x3f3721(0x132)+_0x3c4809[_0x3f3721(0xf0)]());}}}console[_0x3f3721(0x169)](_0x3f3721(0x189),JSON[_0x3f3721(0x117)](_0x4994e3,null,0x2));const [_0x1a77cb,_0x58395e]=await Promise[_0x3f3721(0x172)]([database_1[_0x3f3721(0x18f)][_0x3f3721(0xee)]['findMany']({'where':_0x4994e3,'skip':_0x714798,'take':_0x515e22,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x3f3721(0x18f)][_0x3f3721(0xee)]['count']({'where':_0x4994e3})]);return{'payouts':_0x1a77cb[_0x3f3721(0x179)](_0x4d9112=>{const _0x1b25fb=_0x3f3721;let _0x24a7a9=null;switch(_0x4d9112[_0x1b25fb(0x105)]){case _0x1b25fb(0x13c):_0x24a7a9=_0x4d9112['shop']['usdtPolygonWallet'];break;case _0x1b25fb(0x115):_0x24a7a9=_0x4d9112[_0x1b25fb(0x158)][_0x1b25fb(0x12d)];break;case _0x1b25fb(0xf2):_0x24a7a9=_0x4d9112['shop'][_0x1b25fb(0x10d)];break;case'polygon_usdc':_0x24a7a9=_0x4d9112[_0x1b25fb(0x158)][_0x1b25fb(0x14c)];break;}return{'id':_0x4d9112['id'],'amount':_0x4d9112[_0x1b25fb(0x163)],'network':this['formatNetworkName'](_0x4d9112[_0x1b25fb(0x105)]),'wallet':_0x24a7a9,'status':_0x4d9112[_0x1b25fb(0x10e)],'txid':_0x4d9112['txid'],'notes':_0x4d9112[_0x1b25fb(0x103)],'periodFrom':_0x4d9112['periodFrom'],'periodTo':_0x4d9112[_0x1b25fb(0x107)],'createdAt':_0x4d9112['createdAt'],'paidAt':_0x4d9112[_0x1b25fb(0x12b)]};}),'pagination':{'page':_0x2f9393,'limit':_0x515e22,'total':_0x58395e,'totalPages':Math[_0x3f3721(0x15f)](_0x58395e/_0x515e22)}};}async[a60_0x2944ce(0x184)](_0x33e28e,_0x16a77d){const _0x16db34=a60_0x2944ce,_0x1e613a=await database_1[_0x16db34(0x18f)][_0x16db34(0xee)][_0x16db34(0x168)]({'where':{'id':_0x16a77d,'shopId':_0x33e28e}});if(!_0x1e613a)return null;return{'id':_0x1e613a['id'],'amount':_0x1e613a['amount'],'network':_0x1e613a[_0x16db34(0x105)],'status':_0x1e613a[_0x16db34(0x10e)],'txid':_0x1e613a['txid'],'notes':_0x1e613a[_0x16db34(0x103)],'createdAt':_0x1e613a[_0x16db34(0x114)],'paidAt':_0x1e613a[_0x16db34(0x12b)]};}async['getPayoutStatistics'](_0x4b0209,_0x522aa6){const _0x55ba5e=a60_0x2944ce,_0x5c4df4=new Date();let _0x4c3ace,_0x37d09f;switch(_0x522aa6){case _0x55ba5e(0x13a):case _0x55ba5e(0xfc):const _0xb7d773=new Date(_0x5c4df4);_0xb7d773[_0x55ba5e(0x130)](_0xb7d773['getDate']()-0x1),_0x4c3ace=new Date(_0xb7d773),_0x4c3ace[_0x55ba5e(0x126)](0x0,0x0,0x0,0x0),_0x37d09f=new Date(_0xb7d773),_0x37d09f[_0x55ba5e(0x126)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x4c3ace=new Date(_0x5c4df4[_0x55ba5e(0x175)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4c3ace=new Date(_0x5c4df4['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x4c3ace=new Date(_0x5c4df4[_0x55ba5e(0x175)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4c3ace=new Date(_0x5c4df4['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x354f53={'gte':_0x4c3ace};_0x37d09f&&(_0x354f53[_0x55ba5e(0x18e)]=_0x37d09f);const [_0x191464,_0x231103,_0x575a2a,_0x3e812e,_0x5832ed,_0x4b3596]=await Promise[_0x55ba5e(0x172)]([database_1[_0x55ba5e(0x18f)][_0x55ba5e(0xee)]['count']({'where':{'shopId':_0x4b0209,'createdAt':_0x354f53}}),database_1[_0x55ba5e(0x18f)][_0x55ba5e(0xee)][_0x55ba5e(0xf3)]({'where':{'shopId':_0x4b0209,'status':_0x55ba5e(0x14a),'createdAt':_0x354f53}}),database_1[_0x55ba5e(0x18f)][_0x55ba5e(0xee)][_0x55ba5e(0xf3)]({'where':{'shopId':_0x4b0209,'status':_0x55ba5e(0x14d),'createdAt':_0x354f53}}),database_1['default'][_0x55ba5e(0xee)][_0x55ba5e(0xf3)]({'where':{'shopId':_0x4b0209,'status':_0x55ba5e(0x13f),'createdAt':_0x354f53}}),database_1[_0x55ba5e(0x18f)][_0x55ba5e(0xee)]['findMany']({'where':{'shopId':_0x4b0209,'createdAt':_0x354f53},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x55ba5e(0x18f)][_0x55ba5e(0xee)][_0x55ba5e(0xeb)]({'where':{'shopId':_0x4b0209},'take':0xa,'orderBy':{'createdAt':_0x55ba5e(0x156)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x4a4b61=_0x5832ed[_0x55ba5e(0x13d)]((_0x113022,_0x53ab52)=>_0x113022+_0x53ab52['amount'],0x0),_0x18574e=_0x5832ed['filter'](_0x44fc9a=>_0x44fc9a[_0x55ba5e(0x10e)]===_0x55ba5e(0x14a))[_0x55ba5e(0x13d)]((_0x4af242,_0x4aebee)=>_0x4af242+_0x4aebee[_0x55ba5e(0x163)],0x0),_0x21f0de=_0x5832ed['filter'](_0x46704b=>_0x46704b[_0x55ba5e(0x10e)]===_0x55ba5e(0x14d))[_0x55ba5e(0x13d)]((_0x1d5882,_0x2e2558)=>_0x1d5882+_0x2e2558['amount'],0x0),_0x5e0945=_0x5832ed['reduce']((_0x37d0d1,_0x326577)=>{const _0x4c5aba=_0x55ba5e;return _0x37d0d1[_0x326577[_0x4c5aba(0x105)]]=(_0x37d0d1[_0x326577['network']]||0x0)+0x1,_0x37d0d1;},{}),_0x22ba1f=_0x5832ed[_0x55ba5e(0x13d)]((_0x3e8c41,_0x57b28b)=>{const _0x4e15d8=_0x55ba5e;return _0x3e8c41[_0x57b28b[_0x4e15d8(0x10e)]]=(_0x3e8c41[_0x57b28b['status']]||0x0)+0x1,_0x3e8c41;},{});return{'totalPayouts':_0x191464,'completedPayouts':_0x231103,'pendingPayouts':_0x575a2a,'rejectedPayouts':_0x3e812e,'totalAmount':_0x4a4b61,'completedAmount':_0x18574e,'pendingAmount':_0x21f0de,'payoutsByMethod':_0x5e0945,'payoutsByStatus':_0x22ba1f,'recentPayouts':_0x4b3596[_0x55ba5e(0x179)](_0xdc76d4=>({'id':_0xdc76d4['id'],'shopId':_0x4b0209,'amount':_0xdc76d4[_0x55ba5e(0x163)],'method':_0xdc76d4['network'],'status':_0xdc76d4['status'],'txid':_0xdc76d4[_0x55ba5e(0x162)],'createdAt':_0xdc76d4['createdAt'],'paidAt':_0xdc76d4[_0x55ba5e(0x12b)]}))};}async['getShopPayoutStats'](_0x44fb4c){const _0x1c4f67=a60_0x2944ce;console[_0x1c4f67(0x169)](_0x1c4f67(0x15d)+_0x44fb4c+_0x1c4f67(0x183));const _0x78fcc=await database_1[_0x1c4f67(0x18f)][_0x1c4f67(0x158)][_0x1c4f67(0xf6)]({'where':{'id':_0x44fb4c},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x78fcc)throw new Error(_0x1c4f67(0x11a));const _0x59eedb=new Date(),_0x5e5121=new Date(_0x59eedb[_0x1c4f67(0x171)](),_0x59eedb[_0x1c4f67(0x109)](),0x1),_0x105c9f=new Date(_0x59eedb[_0x1c4f67(0x171)](),_0x59eedb[_0x1c4f67(0x109)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x10d857=await database_1[_0x1c4f67(0x18f)][_0x1c4f67(0xee)][_0x1c4f67(0x14f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x44fb4c,'createdAt':{'gte':_0x5e5121,'lte':_0x105c9f},'status':_0x1c4f67(0x14a)}}),_0x5823b3=_0x10d857['_sum'][_0x1c4f67(0x163)]||0x0,_0x5eedd5={'availableBalance':Math[_0x1c4f67(0x144)](_0x78fcc[_0x1c4f67(0x141)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x78fcc[_0x1c4f67(0x178)]*0x64)/0x64,'awaitingPayout':Math[_0x1c4f67(0x144)](_0x78fcc[_0x1c4f67(0x141)]*0x64)/0x64,'thisMonth':Math[_0x1c4f67(0x144)](_0x5823b3*0x64)/0x64};return console[_0x1c4f67(0x169)](_0x1c4f67(0x11e)+_0x78fcc[_0x1c4f67(0x180)]+_0x1c4f67(0x101)),console['log'](_0x1c4f67(0x136)+_0x5eedd5[_0x1c4f67(0xfe)]+_0x1c4f67(0xfa)),console[_0x1c4f67(0x169)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x5eedd5[_0x1c4f67(0x178)]+'\x20USDT\x20(total\x20payouts)'),console[_0x1c4f67(0x169)](_0x1c4f67(0xf1)+_0x5eedd5['awaitingPayout']+_0x1c4f67(0xfa)),console[_0x1c4f67(0x169)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x5eedd5[_0x1c4f67(0x17d)]+_0x1c4f67(0xed)),_0x5eedd5;}[a60_0x2944ce(0x10c)](_0x3e295a){const _0x1238a2=a60_0x2944ce,_0x3166b5={'test_gateway':_0x1238a2(0x164),'plisio':'Plisio','rapyd':_0x1238a2(0x177),'noda':_0x1238a2(0x135),'cointopay':_0x1238a2(0xec),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x1238a2(0x170)};return _0x3166b5[_0x3e295a]||_0x3e295a;}async[a60_0x2944ce(0x190)](_0x45ad58){const _0x1ac188=a60_0x2944ce;return this[_0x1ac188(0x104)](_0x45ad58);}async[a60_0x2944ce(0x181)](_0x55e61f,_0x4cf613){const _0x324af8=a60_0x2944ce,{page:_0x352a7e,limit:_0x4db278,paymentId:_0x3ac536}=_0x4cf613,_0x517b33=(_0x352a7e-0x1)*_0x4db278,_0x237b95={'shopId':_0x55e61f};_0x3ac536&&(_0x237b95[_0x324af8(0x15c)]=_0x3ac536);const [_0xfeb2d2,_0x3638db]=await Promise['all']([database_1['default'][_0x324af8(0x10f)][_0x324af8(0xeb)]({'where':_0x237b95,'skip':_0x517b33,'take':_0x4db278,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x324af8(0x18f)][_0x324af8(0x10f)][_0x324af8(0xf3)]({'where':_0x237b95})]);return{'logs':_0xfeb2d2['map'](_0x2d34e9=>({'id':_0x2d34e9['id'],'paymentId':_0x2d34e9[_0x324af8(0x15c)],'shopId':_0x2d34e9[_0x324af8(0x154)],'event':_0x2d34e9[_0x324af8(0x18b)],'statusCode':_0x2d34e9[_0x324af8(0x140)],'retryCount':_0x2d34e9[_0x324af8(0x167)],'responseBody':_0x2d34e9[_0x324af8(0x11f)],'createdAt':_0x2d34e9[_0x324af8(0x114)],'payment':_0x2d34e9[_0x324af8(0x159)]})),'pagination':{'page':_0x352a7e,'limit':_0x4db278,'total':_0x3638db,'totalPages':Math[_0x324af8(0x15f)](_0x3638db/_0x4db278)}};}async['getStatistics'](_0x4c9dae,_0xe5b3ba){const _0x3164d1=a60_0x2944ce,_0x4fd8d0=new Date();let _0x35fac1,_0x535c2a;switch(_0xe5b3ba[_0x3164d1(0x17c)]()){case _0x3164d1(0x165):_0x35fac1=new Date(_0x4fd8d0[_0x3164d1(0x171)](),_0x4fd8d0['getMonth'](),_0x4fd8d0['getDate'](),0x0,0x0,0x0,0x0);break;case _0x3164d1(0x13a):case _0x3164d1(0xfc):const _0xfc9728=new Date(_0x4fd8d0);_0xfc9728['setDate'](_0xfc9728[_0x3164d1(0x134)]()-0x1),_0x35fac1=new Date(_0xfc9728),_0x35fac1['setHours'](0x0,0x0,0x0,0x0),_0x535c2a=new Date(_0xfc9728),_0x535c2a[_0x3164d1(0x126)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x35fac1=new Date(_0x4fd8d0['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3164d1(0x124):_0x35fac1=new Date(_0x4fd8d0[_0x3164d1(0x175)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3164d1(0x187):_0x35fac1=new Date(_0x4fd8d0['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x35fac1=new Date(_0x4fd8d0[_0x3164d1(0x175)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x531a10={'gte':_0x35fac1};_0x535c2a&&(_0x531a10[_0x3164d1(0x18e)]=_0x535c2a);const [_0x568d12,_0x5e1530,_0x3eba4d,_0x2ad1b8,_0x346bd1]=await Promise[_0x3164d1(0x172)]([database_1[_0x3164d1(0x18f)][_0x3164d1(0x159)][_0x3164d1(0xf3)]({'where':{'shopId':_0x4c9dae,'gateway':{'not':_0x3164d1(0x102)},'createdAt':_0x531a10}}),database_1[_0x3164d1(0x18f)][_0x3164d1(0x159)][_0x3164d1(0xf3)]({'where':{'shopId':_0x4c9dae,'gateway':{'not':_0x3164d1(0x102)},'status':_0x3164d1(0x11c),'createdAt':_0x531a10}}),database_1['default'][_0x3164d1(0x159)][_0x3164d1(0xeb)]({'where':{'shopId':_0x4c9dae,'gateway':{'not':_0x3164d1(0x102)},'status':_0x3164d1(0x11c),'createdAt':_0x531a10},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3164d1(0x18f)][_0x3164d1(0x159)][_0x3164d1(0xeb)]({'where':{'shopId':_0x4c9dae,'gateway':{'not':_0x3164d1(0x102)}},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3164d1(0x18f)][_0x3164d1(0x159)][_0x3164d1(0xeb)]({'where':{'shopId':_0x4c9dae,'gateway':{'not':_0x3164d1(0x102)},'createdAt':_0x531a10},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x335118=0x0;for(const _0x376348 of _0x3eba4d){if(_0x376348[_0x3164d1(0x166)])_0x335118+=_0x376348[_0x3164d1(0x166)];else{const _0x185c0a=await currencyService_1[_0x3164d1(0x151)][_0x3164d1(0x10b)](_0x376348['amount'],_0x376348[_0x3164d1(0x15e)]);_0x335118+=_0x185c0a;}}const _0xb46241=this[_0x3164d1(0xfb)](_0x346bd1,_0x35fac1,_0x535c2a||_0x4fd8d0),_0x303d8e=_0x568d12>0x0?_0x5e1530/_0x568d12*0x64:0x0;return{'totalPayments':_0x568d12,'successfulPayments':_0x5e1530,'totalRevenue':Math['round'](_0x335118*0x64)/0x64,'conversionRate':Math[_0x3164d1(0x144)](_0x303d8e*0x64)/0x64,'dailyRevenue':_0xb46241[_0x3164d1(0x17e)],'dailyPayments':_0xb46241['dailyPayments'],'recentPayments':_0x2ad1b8[_0x3164d1(0x179)](_0x5309de=>({'id':_0x5309de['id'],'gateway':_0x5309de['gateway'],'amount':_0x5309de[_0x3164d1(0x163)],'currency':_0x5309de[_0x3164d1(0x15e)],'status':_0x5309de[_0x3164d1(0x10e)],'createdAt':_0x5309de[_0x3164d1(0x114)]}))};}[a60_0x2944ce(0xfb)](_0x6069cf,_0x7dd0d1,_0x2ab1b7){const _0x3cab1f=a60_0x2944ce,_0x4cf857=new Map(),_0xbbfc58=new Date(_0x7dd0d1);while(_0xbbfc58<=_0x2ab1b7){const _0x2a828f=_0xbbfc58[_0x3cab1f(0xf0)]()['split']('T')[0x0];_0x4cf857['set'](_0x2a828f,{'revenue':0x0,'count':0x0}),_0xbbfc58[_0x3cab1f(0x130)](_0xbbfc58[_0x3cab1f(0x134)]()+0x1);}for(const _0x427a03 of _0x6069cf){const _0x349f50=_0x427a03[_0x3cab1f(0x114)]['toISOString']()[_0x3cab1f(0x174)]('T')[0x0],_0x27ee6d=_0x4cf857['get'](_0x349f50);_0x27ee6d&&(_0x27ee6d[_0x3cab1f(0xf3)]+=0x1,_0x427a03[_0x3cab1f(0x10e)]==='PAID'&&_0x427a03['amountUSDT']&&(_0x27ee6d['revenue']+=_0x427a03['amountUSDT']));}const _0x48fe94=[],_0x4e149a=[];for(const [_0x23ebe5,_0x334dce]of _0x4cf857){_0x48fe94[_0x3cab1f(0x129)]({'date':_0x23ebe5,'amount':Math['round'](_0x334dce[_0x3cab1f(0x182)]*0x64)/0x64}),_0x4e149a[_0x3cab1f(0x129)]({'date':_0x23ebe5,'count':_0x334dce[_0x3cab1f(0xf3)]});}return{'dailyRevenue':_0x48fe94,'dailyPayments':_0x4e149a};}}exports[a60_0x2944ce(0x11d)]=ShopService;