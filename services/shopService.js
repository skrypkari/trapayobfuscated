'use strict';const a54_0x1e6c28=a54_0x5710;(function(_0x21781a,_0x380c6e){const _0xf13fef=a54_0x5710,_0x3f890a=_0x21781a();while(!![]){try{const _0x5d97c4=parseInt(_0xf13fef(0x1e4))/0x1*(parseInt(_0xf13fef(0x20d))/0x2)+parseInt(_0xf13fef(0x246))/0x3*(-parseInt(_0xf13fef(0x234))/0x4)+-parseInt(_0xf13fef(0x20e))/0x5+-parseInt(_0xf13fef(0x239))/0x6*(-parseInt(_0xf13fef(0x24b))/0x7)+parseInt(_0xf13fef(0x218))/0x8*(-parseInt(_0xf13fef(0x1f5))/0x9)+parseInt(_0xf13fef(0x1cd))/0xa+-parseInt(_0xf13fef(0x215))/0xb;if(_0x5d97c4===_0x380c6e)break;else _0x3f890a['push'](_0x3f890a['shift']());}catch(_0x5b24c9){_0x3f890a['push'](_0x3f890a['shift']());}}}(a54_0x16dd,0xe47f4));var __importDefault=this&&this['__importDefault']||function(_0xf7113f){const _0x8efeac=a54_0x5710;return _0xf7113f&&_0xf7113f[_0x8efeac(0x233)]?_0xf7113f:{'default':_0xf7113f};};Object['defineProperty'](exports,a54_0x1e6c28(0x233),{'value':!![]}),exports[a54_0x1e6c28(0x243)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a54_0x1e6c28(0x231)),paymentService_1=require('./paymentService');function a54_0x16dd(){const _0x5984d7=['trc20','getShopProfile','USDC\x20Polygon','lte','7dLFUfq','gatewaySettings','telegramId','test_payment_123','get','updateWallets','usdtErcWallet','getShopPayoutStats','message','getPayoutById','payout','COMPLETED','deletePayment','getMonth','retryCount','reduce','language','18koUExJ','findMany','username','üìÖ\x20Date\x20start:\x20','webhookUrl','polygon_usdc','merchantUrl','totalPaidOut','getFullYear','payment','dailyRevenue','convertToUSDT','split','customer','PaymentService','getTime','getPayments','thisMonth','usdtTrcWallet','Test\x20webhook\x20sent\x20successfully\x20(','parse','Rapyd','count','Plisio','287366RjIRLn','380165GRAIsN','balance','error','name','availableBalance','findFirst','amountIsEditable','1258499HHXdLy','setHours','getPaymentsByShop','2163152okEpxM','responseBody','test','test_gateway','shopUrl','PENDING','Shop\x20not\x20found','üìä\x20Shop\x20','sourceCurrency','gte','webhookEvents','getPayoutStats','updatePayment','aggregate','paidAt','\x20\x20\x20üìÖ\x20This\x20month:\x20','paymentService','USD','map','Webhook\x20returned\x20error:\x20','all','statusText','desc','network','createdAt','./currencyService','usdtPolygonWallet','__esModule','16RksxWJ','Unknown\x20error','push','webhookLog','default','6pmIWdx','30d','\x20USDT\x20(current\x20balance)','telegram','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','findUnique','isArray','POST','stringify','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','ShopService','txid','fullName','861447HIbsda','awaitingPayout','formatNetworkName','\x20USDT\x20(total\x20payouts)','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','4525031UlLsFP','gateway','test_order_123','PAID','amount','publicKey','setDate','getPayoutStatistics','getPayouts','set','update','application/json','getWebhookLogs','90d','log','shop','üåê\x20Method\x20filter:\x20','Failed\x20to\x20send\x20webhook:\x20','Payment\x20not\x20found','round','Test\x20Gateway','üåê\x20Network\x20filter:\x20','KLYME\x20GB','filter','...','testWebhook','redirectUrl','createPublicPayment','KLYME\x20DE','wallets','usdcPolygonWallet','üìÖ\x20Period\x20end:\x20','ceil','USDT\x20Polygon','delete','settings','USDT\x20BSC','11635360wyliCx','currency','KLYME\x20EU','periodTo','amountUSDT','maxPayments','periodFrom','gateways','toISOString','Error\x20parsing\x20webhook\x20events:','toUpperCase','generateDailyStatistics','shopId','status','revenue','üìÖ\x20Period\x20start:\x20','asc','paymentGateways','CoinToPay'];a54_0x16dd=function(){return _0x5984d7;};return a54_0x16dd();}class ShopService{constructor(){const _0x4d86f5=a54_0x1e6c28;this[_0x4d86f5(0x228)]=new paymentService_1[(_0x4d86f5(0x203))]();}async[a54_0x1e6c28(0x1e1)](_0x1ebc58){const _0xa86287=a54_0x1e6c28,_0x2605d9=await database_1[_0xa86287(0x238)][_0xa86287(0x25a)][_0xa86287(0x23e)]({'where':{'id':_0x1ebc58},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x2605d9)throw new Error(_0xa86287(0x21e));let _0x8ddab3=[];if(_0x2605d9[_0xa86287(0x1cb)]?.['webhookEvents'])try{_0x8ddab3=Array[_0xa86287(0x23f)](_0x2605d9[_0xa86287(0x1cb)][_0xa86287(0x222)])?_0x2605d9[_0xa86287(0x1cb)][_0xa86287(0x222)]:JSON[_0xa86287(0x209)](_0x2605d9['settings'][_0xa86287(0x222)]);}catch(_0x2aa71a){console[_0xa86287(0x210)]('Error\x20parsing\x20webhook\x20events:',_0x2aa71a),_0x8ddab3=[];}return{'id':_0x2605d9['id'],'fullName':_0x2605d9[_0xa86287(0x211)],'username':_0x2605d9[_0xa86287(0x1f7)],'telegramId':_0x2605d9['telegram'],'merchantUrl':_0x2605d9['shopUrl'],'gateways':_0x2605d9['paymentGateways']?JSON[_0xa86287(0x209)](_0x2605d9[_0xa86287(0x1de)]):null,'gatewaySettings':_0x2605d9[_0xa86287(0x1e5)]?JSON[_0xa86287(0x209)](_0x2605d9[_0xa86287(0x1e5)]):null,'publicKey':_0x2605d9['publicKey'],'webhookUrl':_0x2605d9[_0xa86287(0x1cb)]?.[_0xa86287(0x1f9)]||null,'webhookEvents':_0x8ddab3,'wallets':{'usdtPolygonWallet':_0x2605d9[_0xa86287(0x232)],'usdtTrcWallet':_0x2605d9[_0xa86287(0x207)],'usdtErcWallet':_0x2605d9[_0xa86287(0x1ea)],'usdcPolygonWallet':_0x2605d9[_0xa86287(0x1c6)]},'status':_0x2605d9[_0xa86287(0x1da)],'createdAt':_0x2605d9[_0xa86287(0x230)]};}async['updateShopProfile'](_0x4a0816,_0x334dc5){const _0x224af9=a54_0x1e6c28,_0x2ea09={};_0x334dc5[_0x224af9(0x245)]&&(_0x2ea09[_0x224af9(0x211)]=_0x334dc5['fullName']);_0x334dc5[_0x224af9(0x1e6)]!==undefined&&(_0x2ea09[_0x224af9(0x23c)]=_0x334dc5[_0x224af9(0x1e6)]||null);_0x334dc5[_0x224af9(0x1fb)]&&(_0x2ea09['shopUrl']=_0x334dc5['merchantUrl']);_0x334dc5[_0x224af9(0x1d4)]&&(_0x2ea09[_0x224af9(0x1de)]=JSON[_0x224af9(0x241)](_0x334dc5[_0x224af9(0x1d4)]));_0x334dc5[_0x224af9(0x1e5)]&&(_0x2ea09[_0x224af9(0x1e5)]=JSON['stringify'](_0x334dc5[_0x224af9(0x1e5)]));_0x334dc5[_0x224af9(0x1c5)]&&(_0x334dc5[_0x224af9(0x1c5)][_0x224af9(0x232)]!==undefined&&(_0x2ea09[_0x224af9(0x232)]=_0x334dc5['wallets'][_0x224af9(0x232)]||null),_0x334dc5[_0x224af9(0x1c5)][_0x224af9(0x207)]!==undefined&&(_0x2ea09['usdtTrcWallet']=_0x334dc5[_0x224af9(0x1c5)][_0x224af9(0x207)]||null),_0x334dc5[_0x224af9(0x1c5)][_0x224af9(0x1ea)]!==undefined&&(_0x2ea09[_0x224af9(0x1ea)]=_0x334dc5[_0x224af9(0x1c5)][_0x224af9(0x1ea)]||null),_0x334dc5[_0x224af9(0x1c5)][_0x224af9(0x1c6)]!==undefined&&(_0x2ea09[_0x224af9(0x1c6)]=_0x334dc5[_0x224af9(0x1c5)][_0x224af9(0x1c6)]||null));const _0x5d9c9b=await database_1[_0x224af9(0x238)]['shop'][_0x224af9(0x255)]({'where':{'id':_0x4a0816},'data':_0x2ea09,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x54a298=[];if(_0x5d9c9b[_0x224af9(0x1cb)]?.['webhookEvents'])try{_0x54a298=Array['isArray'](_0x5d9c9b[_0x224af9(0x1cb)]['webhookEvents'])?_0x5d9c9b[_0x224af9(0x1cb)][_0x224af9(0x222)]:JSON['parse'](_0x5d9c9b[_0x224af9(0x1cb)][_0x224af9(0x222)]);}catch(_0x11220d){console[_0x224af9(0x210)](_0x224af9(0x1d6),_0x11220d),_0x54a298=[];}return{'id':_0x5d9c9b['id'],'fullName':_0x5d9c9b['name'],'username':_0x5d9c9b[_0x224af9(0x1f7)],'telegramId':_0x5d9c9b[_0x224af9(0x23c)],'merchantUrl':_0x5d9c9b[_0x224af9(0x21c)],'gateways':_0x5d9c9b[_0x224af9(0x1de)]?JSON[_0x224af9(0x209)](_0x5d9c9b[_0x224af9(0x1de)]):null,'gatewaySettings':_0x5d9c9b['gatewaySettings']?JSON[_0x224af9(0x209)](_0x5d9c9b[_0x224af9(0x1e5)]):null,'publicKey':_0x5d9c9b[_0x224af9(0x250)],'webhookUrl':_0x5d9c9b[_0x224af9(0x1cb)]?.['webhookUrl']||null,'webhookEvents':_0x54a298,'wallets':{'usdtPolygonWallet':_0x5d9c9b[_0x224af9(0x232)],'usdtTrcWallet':_0x5d9c9b[_0x224af9(0x207)],'usdtErcWallet':_0x5d9c9b[_0x224af9(0x1ea)],'usdcPolygonWallet':_0x5d9c9b[_0x224af9(0x1c6)]},'status':_0x5d9c9b[_0x224af9(0x1da)],'createdAt':_0x5d9c9b[_0x224af9(0x230)]};}async[a54_0x1e6c28(0x1e9)](_0xbd662,_0x5884f7){const _0x3b6f81=a54_0x1e6c28,_0xdc5a59={};_0x5884f7[_0x3b6f81(0x232)]!==undefined&&(_0xdc5a59[_0x3b6f81(0x232)]=_0x5884f7[_0x3b6f81(0x232)]||null),_0x5884f7[_0x3b6f81(0x207)]!==undefined&&(_0xdc5a59[_0x3b6f81(0x207)]=_0x5884f7['usdtTrcWallet']||null),_0x5884f7[_0x3b6f81(0x1ea)]!==undefined&&(_0xdc5a59[_0x3b6f81(0x1ea)]=_0x5884f7[_0x3b6f81(0x1ea)]||null),_0x5884f7[_0x3b6f81(0x1c6)]!==undefined&&(_0xdc5a59[_0x3b6f81(0x1c6)]=_0x5884f7[_0x3b6f81(0x1c6)]||null),await database_1['default']['shop'][_0x3b6f81(0x255)]({'where':{'id':_0xbd662},'data':_0xdc5a59});}async[a54_0x1e6c28(0x1c1)](_0x4bf913){const _0xdee85f=a54_0x1e6c28,_0x530576=await database_1['default'][_0xdee85f(0x25a)]['findUnique']({'where':{'id':_0x4bf913},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x530576?.[_0xdee85f(0x1cb)]?.['webhookUrl'])throw new Error('No\x20webhook\x20URL\x20configured');const _0x1349ba={'event':_0xdee85f(0x21a),'payment':{'id':_0xdee85f(0x1e7),'order_id':_0xdee85f(0x24d),'gateway':'test','amount':0x64,'currency':_0xdee85f(0x229),'status':'paid','created_at':new Date()['toISOString']()}};try{const _0x1ba6dd=await fetch(_0x530576[_0xdee85f(0x1cb)]['webhookUrl'],{'method':_0xdee85f(0x240),'headers':{'Content-Type':_0xdee85f(0x256),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0xdee85f(0x241)](_0x1349ba)});return _0x1ba6dd['ok']?{'success':!![],'message':_0xdee85f(0x208)+_0x1ba6dd[_0xdee85f(0x1da)]+')'}:{'success':![],'message':_0xdee85f(0x22b)+_0x1ba6dd['status']+'\x20'+_0x1ba6dd[_0xdee85f(0x22d)]};}catch(_0x5546c3){return{'success':![],'message':_0xdee85f(0x25c)+(_0x5546c3 instanceof Error?_0x5546c3[_0xdee85f(0x1ec)]:_0xdee85f(0x235))};}}async['createPayment'](_0x4b4149){const _0x111a78=a54_0x1e6c28;return this[_0x111a78(0x228)][_0x111a78(0x1c3)]({'public_key':'','gateway':_0x4b4149[_0x111a78(0x24c)],'order_id':undefined,'amount':_0x4b4149[_0x111a78(0x24f)],'currency':_0x4b4149['currency'],'source_currency':_0x4b4149[_0x111a78(0x220)],'usage':_0x4b4149['usage'],'expires_at':_0x4b4149['expiresAt']?.[_0x111a78(0x1d5)](),'success_url':_0x4b4149[_0x111a78(0x1c2)],'fail_url':_0x4b4149[_0x111a78(0x1c2)],'customer_email':_0x4b4149['customerEmail'],'customer_name':_0x4b4149['customerName'],'country':_0x4b4149['country'],'language':_0x4b4149[_0x111a78(0x1f4)],'amount_is_editable':_0x4b4149[_0x111a78(0x214)],'max_payments':_0x4b4149[_0x111a78(0x1d2)],'customer':_0x4b4149[_0x111a78(0x202)]});}async[a54_0x1e6c28(0x205)](_0xc6d932,_0x559e37){const _0x2aa26d=a54_0x1e6c28;return this['paymentService'][_0x2aa26d(0x217)](_0xc6d932,_0x559e37);}async['getPaymentById'](_0x198e87,_0x313cca){const _0x3ee1b6=a54_0x1e6c28;return this[_0x3ee1b6(0x228)]['getPaymentByShopAndId'](_0x198e87,_0x313cca);}async[a54_0x1e6c28(0x224)](_0x478955,_0x4fe8fd,_0x543fda){const _0x10526f=a54_0x1e6c28,_0x32fd81=await database_1['default'][_0x10526f(0x1fe)][_0x10526f(0x213)]({'where':{'id':_0x4fe8fd,'shopId':_0x478955}});if(!_0x32fd81)throw new Error(_0x10526f(0x25d));const _0x4bb04e=await database_1[_0x10526f(0x238)]['payment'][_0x10526f(0x255)]({'where':{'id':_0x4fe8fd},'data':{..._0x543fda,'updatedAt':new Date()}});return _0x4bb04e;}async[a54_0x1e6c28(0x1f0)](_0x9bed34,_0x31121d){const _0x22fa1a=a54_0x1e6c28,_0x31eca6=await database_1[_0x22fa1a(0x238)]['payment']['findFirst']({'where':{'id':_0x31121d,'shopId':_0x9bed34}});if(!_0x31eca6)throw new Error('Payment\x20not\x20found');await database_1['default'][_0x22fa1a(0x1fe)][_0x22fa1a(0x1ca)]({'where':{'id':_0x31121d}});}[a54_0x1e6c28(0x248)](_0x4c4af1){const _0x2d4f69=a54_0x1e6c28,_0x4df030={'polygon':_0x2d4f69(0x1c9),'trc20':'USDT\x20TRC20','erc20':'USDT\x20ERC20','bsc':_0x2d4f69(0x1cc),'polygon_usdc':_0x2d4f69(0x1e2)};return _0x4df030[_0x4c4af1]||_0x4c4af1;}async[a54_0x1e6c28(0x253)](_0x2f0530,_0x24b196){const _0x1bceef=a54_0x1e6c28,{page:_0x1df757,limit:_0x380419,status:_0x2ec4fd,method:_0x5a8739,network:_0x2791bf,dateFrom:_0xfc09,dateTo:_0x466f7e,periodFrom:_0x5a6f5c,periodTo:_0x230e07}=_0x24b196,_0x56484d=(_0x1df757-0x1)*_0x380419;console[_0x1bceef(0x259)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x24b196);const _0x3cbbf6={'shopId':_0x2f0530};_0x2ec4fd&&(_0x3cbbf6[_0x1bceef(0x1da)]=_0x2ec4fd['toUpperCase'](),console[_0x1bceef(0x259)]('üìä\x20Status\x20filter:\x20'+_0x2ec4fd[_0x1bceef(0x1d7)]()));if(_0x5a8739)_0x3cbbf6[_0x1bceef(0x22f)]=_0x5a8739,console[_0x1bceef(0x259)](_0x1bceef(0x25b)+_0x5a8739);else _0x2791bf&&(_0x3cbbf6[_0x1bceef(0x22f)]=_0x2791bf,console['log'](_0x1bceef(0x260)+_0x2791bf));if(_0xfc09||_0x466f7e||_0x5a6f5c||_0x230e07){_0x3cbbf6['createdAt']={};if(_0x5a6f5c){const _0x1c17c9=new Date(_0x5a6f5c);_0x1c17c9[_0x1bceef(0x216)](0x0,0x0,0x0,0x0),_0x3cbbf6['createdAt'][_0x1bceef(0x221)]=_0x1c17c9,console[_0x1bceef(0x259)](_0x1bceef(0x1dc)+_0x1c17c9[_0x1bceef(0x1d5)]());}else{if(_0xfc09){const _0x58e9ab=new Date(_0xfc09);_0x58e9ab[_0x1bceef(0x216)](0x0,0x0,0x0,0x0),_0x3cbbf6['createdAt'][_0x1bceef(0x221)]=_0x58e9ab,console[_0x1bceef(0x259)](_0x1bceef(0x1f8)+_0x58e9ab[_0x1bceef(0x1d5)]());}}if(_0x230e07){const _0x48a8bc=new Date(_0x230e07);_0x48a8bc[_0x1bceef(0x216)](0x17,0x3b,0x3b,0x3e7),_0x3cbbf6['createdAt'][_0x1bceef(0x1e3)]=_0x48a8bc,console[_0x1bceef(0x259)](_0x1bceef(0x1c7)+_0x48a8bc[_0x1bceef(0x1d5)]());}else{if(_0x466f7e){const _0x422e40=new Date(_0x466f7e);_0x422e40['setHours'](0x17,0x3b,0x3b,0x3e7),_0x3cbbf6['createdAt'][_0x1bceef(0x1e3)]=_0x422e40,console[_0x1bceef(0x259)]('üìÖ\x20Date\x20end:\x20'+_0x422e40[_0x1bceef(0x1d5)]());}}}console[_0x1bceef(0x259)]('üìä\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x3cbbf6,null,0x2));const [_0x293266,_0x4750b0]=await Promise[_0x1bceef(0x22c)]([database_1[_0x1bceef(0x238)][_0x1bceef(0x1ee)][_0x1bceef(0x1f6)]({'where':_0x3cbbf6,'skip':_0x56484d,'take':_0x380419,'orderBy':{'createdAt':_0x1bceef(0x22e)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x1bceef(0x238)]['payout'][_0x1bceef(0x20b)]({'where':_0x3cbbf6})]);return{'payouts':_0x293266['map'](_0x4b553c=>{const _0xfc8229=_0x1bceef;let _0x12586d=null;switch(_0x4b553c[_0xfc8229(0x22f)]){case'polygon':_0x12586d=_0x4b553c[_0xfc8229(0x25a)][_0xfc8229(0x232)];break;case _0xfc8229(0x1e0):_0x12586d=_0x4b553c[_0xfc8229(0x25a)][_0xfc8229(0x207)];break;case'erc20':_0x12586d=_0x4b553c[_0xfc8229(0x25a)][_0xfc8229(0x1ea)];break;case _0xfc8229(0x1fa):_0x12586d=_0x4b553c[_0xfc8229(0x25a)]['usdcPolygonWallet'];break;}return{'id':_0x4b553c['id'],'amount':_0x4b553c[_0xfc8229(0x24f)],'network':this['formatNetworkName'](_0x4b553c['network']),'wallet':_0x12586d,'status':_0x4b553c['status'],'txid':_0x4b553c[_0xfc8229(0x244)],'notes':_0x4b553c['notes'],'periodFrom':_0x4b553c[_0xfc8229(0x1d3)],'periodTo':_0x4b553c[_0xfc8229(0x1d0)],'createdAt':_0x4b553c[_0xfc8229(0x230)],'paidAt':_0x4b553c[_0xfc8229(0x226)]};}),'pagination':{'page':_0x1df757,'limit':_0x380419,'total':_0x4750b0,'totalPages':Math[_0x1bceef(0x1c8)](_0x4750b0/_0x380419)}};}async[a54_0x1e6c28(0x1ed)](_0x166fd5,_0x271f8e){const _0x859438=a54_0x1e6c28,_0x3401af=await database_1[_0x859438(0x238)][_0x859438(0x1ee)][_0x859438(0x213)]({'where':{'id':_0x271f8e,'shopId':_0x166fd5}});if(!_0x3401af)return null;return{'id':_0x3401af['id'],'amount':_0x3401af[_0x859438(0x24f)],'network':_0x3401af['network'],'status':_0x3401af[_0x859438(0x1da)],'txid':_0x3401af[_0x859438(0x244)],'notes':_0x3401af['notes'],'createdAt':_0x3401af['createdAt'],'paidAt':_0x3401af[_0x859438(0x226)]};}async[a54_0x1e6c28(0x252)](_0x55d18b,_0x4d6968){const _0x17047f=a54_0x1e6c28,_0x183876=new Date();let _0x1ab5e7;switch(_0x4d6968){case'7d':_0x1ab5e7=new Date(_0x183876[_0x17047f(0x204)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x1ab5e7=new Date(_0x183876[_0x17047f(0x204)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x17047f(0x258):_0x1ab5e7=new Date(_0x183876[_0x17047f(0x204)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1ab5e7=new Date(_0x183876['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5badd,_0x34bc89,_0x4d080f,_0x53a583,_0x30ec41,_0x3019ad]=await Promise['all']([database_1[_0x17047f(0x238)]['payout'][_0x17047f(0x20b)]({'where':{'shopId':_0x55d18b,'createdAt':{'gte':_0x1ab5e7}}}),database_1[_0x17047f(0x238)][_0x17047f(0x1ee)][_0x17047f(0x20b)]({'where':{'shopId':_0x55d18b,'status':_0x17047f(0x1ef),'createdAt':{'gte':_0x1ab5e7}}}),database_1[_0x17047f(0x238)][_0x17047f(0x1ee)]['count']({'where':{'shopId':_0x55d18b,'status':_0x17047f(0x21d),'createdAt':{'gte':_0x1ab5e7}}}),database_1[_0x17047f(0x238)][_0x17047f(0x1ee)][_0x17047f(0x20b)]({'where':{'shopId':_0x55d18b,'status':'REJECTED','createdAt':{'gte':_0x1ab5e7}}}),database_1['default'][_0x17047f(0x1ee)][_0x17047f(0x1f6)]({'where':{'shopId':_0x55d18b,'createdAt':{'gte':_0x1ab5e7}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1['default']['payout'][_0x17047f(0x1f6)]({'where':{'shopId':_0x55d18b},'take':0xa,'orderBy':{'createdAt':_0x17047f(0x22e)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x2bc95e=_0x30ec41['reduce']((_0x220ede,_0x4f3a66)=>_0x220ede+_0x4f3a66['amount'],0x0),_0x28e11c=_0x30ec41[_0x17047f(0x262)](_0x5c9aff=>_0x5c9aff[_0x17047f(0x1da)]===_0x17047f(0x1ef))[_0x17047f(0x1f3)]((_0x13a52a,_0x4110e1)=>_0x13a52a+_0x4110e1[_0x17047f(0x24f)],0x0),_0x1f2e3c=_0x30ec41[_0x17047f(0x262)](_0xe90238=>_0xe90238[_0x17047f(0x1da)]===_0x17047f(0x21d))[_0x17047f(0x1f3)]((_0xd58d0e,_0x1f55ea)=>_0xd58d0e+_0x1f55ea[_0x17047f(0x24f)],0x0),_0xaf7065=_0x30ec41['reduce']((_0x51563f,_0x439e62)=>{const _0x4cc0f5=_0x17047f;return _0x51563f[_0x439e62[_0x4cc0f5(0x22f)]]=(_0x51563f[_0x439e62['network']]||0x0)+0x1,_0x51563f;},{}),_0x1a4921=_0x30ec41[_0x17047f(0x1f3)]((_0x57324b,_0x149fe3)=>{const _0x2710bb=_0x17047f;return _0x57324b[_0x149fe3[_0x2710bb(0x1da)]]=(_0x57324b[_0x149fe3[_0x2710bb(0x1da)]]||0x0)+0x1,_0x57324b;},{});return{'totalPayouts':_0x5badd,'completedPayouts':_0x34bc89,'pendingPayouts':_0x4d080f,'rejectedPayouts':_0x53a583,'totalAmount':_0x2bc95e,'completedAmount':_0x28e11c,'pendingAmount':_0x1f2e3c,'payoutsByMethod':_0xaf7065,'payoutsByStatus':_0x1a4921,'recentPayouts':_0x3019ad[_0x17047f(0x22a)](_0x2e20f9=>({'id':_0x2e20f9['id'],'shopId':_0x55d18b,'amount':_0x2e20f9[_0x17047f(0x24f)],'method':_0x2e20f9[_0x17047f(0x22f)],'status':_0x2e20f9[_0x17047f(0x1da)],'txid':_0x2e20f9[_0x17047f(0x244)],'createdAt':_0x2e20f9[_0x17047f(0x230)],'paidAt':_0x2e20f9[_0x17047f(0x226)]}))};}async[a54_0x1e6c28(0x1eb)](_0x3734d3){const _0x4df33b=a54_0x1e6c28;console[_0x4df33b(0x259)](_0x4df33b(0x23d)+_0x3734d3+_0x4df33b(0x1c0));const _0x4bdc83=await database_1[_0x4df33b(0x238)]['shop'][_0x4df33b(0x23e)]({'where':{'id':_0x3734d3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4bdc83)throw new Error('Shop\x20not\x20found');const _0x4180e4=new Date(),_0xa6693=new Date(_0x4180e4['getFullYear'](),_0x4180e4[_0x4df33b(0x1f1)](),0x1),_0x214bc1=new Date(_0x4180e4[_0x4df33b(0x1fd)](),_0x4180e4[_0x4df33b(0x1f1)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x529bd6=await database_1[_0x4df33b(0x238)][_0x4df33b(0x1ee)][_0x4df33b(0x225)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3734d3,'createdAt':{'gte':_0xa6693,'lte':_0x214bc1},'status':'COMPLETED'}}),_0x452b32=_0x529bd6['_sum']['amount']||0x0,_0x278f31={'availableBalance':Math[_0x4df33b(0x25e)](_0x4bdc83[_0x4df33b(0x20f)]*0x64)/0x64,'totalPaidOut':Math[_0x4df33b(0x25e)](_0x4bdc83['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math['round'](_0x4bdc83['balance']*0x64)/0x64,'thisMonth':Math[_0x4df33b(0x25e)](_0x452b32*0x64)/0x64};return console[_0x4df33b(0x259)](_0x4df33b(0x21f)+_0x4bdc83[_0x4df33b(0x1f7)]+'\x20payout\x20statistics\x20calculated:'),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x278f31[_0x4df33b(0x212)]+_0x4df33b(0x23b)),console['log'](_0x4df33b(0x24a)+_0x278f31[_0x4df33b(0x1fc)]+_0x4df33b(0x249)),console[_0x4df33b(0x259)](_0x4df33b(0x242)+_0x278f31[_0x4df33b(0x247)]+_0x4df33b(0x23b)),console[_0x4df33b(0x259)](_0x4df33b(0x227)+_0x278f31[_0x4df33b(0x206)]+'\x20USDT'),_0x278f31;}['getGatewayDisplayName'](_0x4ddeb0){const _0x87540c=a54_0x1e6c28,_0x14ab9a={'test_gateway':_0x87540c(0x25f),'plisio':_0x87540c(0x20c),'rapyd':_0x87540c(0x20a),'noda':'Noda','cointopay':_0x87540c(0x1df),'klyme_eu':_0x87540c(0x1cf),'klyme_gb':_0x87540c(0x261),'klyme_de':_0x87540c(0x1c4)};return _0x14ab9a[_0x4ddeb0]||_0x4ddeb0;}async[a54_0x1e6c28(0x223)](_0xa31865){return this['getShopPayoutStats'](_0xa31865);}async[a54_0x1e6c28(0x257)](_0xf72db7,_0x3da607){const _0x3a9fdf=a54_0x1e6c28,{page:_0x4518ce,limit:_0x4f4f4b,paymentId:_0x3df10b}=_0x3da607,_0x39ffff=(_0x4518ce-0x1)*_0x4f4f4b,_0x44b3d6={'shopId':_0xf72db7};_0x3df10b&&(_0x44b3d6['paymentId']=_0x3df10b);const [_0x2cada7,_0x312558]=await Promise[_0x3a9fdf(0x22c)]([database_1[_0x3a9fdf(0x238)][_0x3a9fdf(0x237)][_0x3a9fdf(0x1f6)]({'where':_0x44b3d6,'skip':_0x39ffff,'take':_0x4f4f4b,'orderBy':{'createdAt':_0x3a9fdf(0x22e)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1['default'][_0x3a9fdf(0x237)][_0x3a9fdf(0x20b)]({'where':_0x44b3d6})]);return{'logs':_0x2cada7[_0x3a9fdf(0x22a)](_0x37cbb9=>({'id':_0x37cbb9['id'],'paymentId':_0x37cbb9['paymentId'],'shopId':_0x37cbb9[_0x3a9fdf(0x1d9)],'event':_0x37cbb9['event'],'statusCode':_0x37cbb9['statusCode'],'retryCount':_0x37cbb9[_0x3a9fdf(0x1f2)],'responseBody':_0x37cbb9[_0x3a9fdf(0x219)],'createdAt':_0x37cbb9[_0x3a9fdf(0x230)],'payment':_0x37cbb9['payment']})),'pagination':{'page':_0x4518ce,'limit':_0x4f4f4b,'total':_0x312558,'totalPages':Math[_0x3a9fdf(0x1c8)](_0x312558/_0x4f4f4b)}};}async['getStatistics'](_0x49cb63,_0x29326d){const _0x1420bd=a54_0x1e6c28,_0x119434=new Date();let _0x4c5acb;switch(_0x29326d){case'7d':_0x4c5acb=new Date(_0x119434[_0x1420bd(0x204)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1420bd(0x23a):_0x4c5acb=new Date(_0x119434[_0x1420bd(0x204)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1420bd(0x258):_0x4c5acb=new Date(_0x119434[_0x1420bd(0x204)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4c5acb=new Date(_0x119434['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4afd3c,_0x10a73f,_0x339fe3,_0x254107,_0x397c2d]=await Promise[_0x1420bd(0x22c)]([database_1[_0x1420bd(0x238)][_0x1420bd(0x1fe)][_0x1420bd(0x20b)]({'where':{'shopId':_0x49cb63,'gateway':{'not':_0x1420bd(0x21b)},'createdAt':{'gte':_0x4c5acb}}}),database_1[_0x1420bd(0x238)][_0x1420bd(0x1fe)][_0x1420bd(0x20b)]({'where':{'shopId':_0x49cb63,'gateway':{'not':'test_gateway'},'status':_0x1420bd(0x24e),'createdAt':{'gte':_0x4c5acb}}}),database_1[_0x1420bd(0x238)][_0x1420bd(0x1fe)][_0x1420bd(0x1f6)]({'where':{'shopId':_0x49cb63,'gateway':{'not':_0x1420bd(0x21b)},'status':_0x1420bd(0x24e),'createdAt':{'gte':_0x4c5acb}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x1420bd(0x238)][_0x1420bd(0x1fe)][_0x1420bd(0x1f6)]({'where':{'shopId':_0x49cb63,'gateway':{'not':_0x1420bd(0x21b)}},'take':0xa,'orderBy':{'createdAt':_0x1420bd(0x22e)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x1420bd(0x1fe)][_0x1420bd(0x1f6)]({'where':{'shopId':_0x49cb63,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x4c5acb}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x1420bd(0x1dd)}})]);let _0x6aedc1=0x0;for(const _0x481cf8 of _0x339fe3){if(_0x481cf8[_0x1420bd(0x1d1)])_0x6aedc1+=_0x481cf8[_0x1420bd(0x1d1)];else{const _0x43329f=await currencyService_1['currencyService'][_0x1420bd(0x200)](_0x481cf8['amount'],_0x481cf8[_0x1420bd(0x1ce)]);_0x6aedc1+=_0x43329f;}}const _0x577c5c=this[_0x1420bd(0x1d8)](_0x397c2d,_0x4c5acb,_0x119434),_0x2abfff=_0x4afd3c>0x0?_0x10a73f/_0x4afd3c*0x64:0x0;return{'totalPayments':_0x4afd3c,'successfulPayments':_0x10a73f,'totalRevenue':Math[_0x1420bd(0x25e)](_0x6aedc1*0x64)/0x64,'conversionRate':Math[_0x1420bd(0x25e)](_0x2abfff*0x64)/0x64,'dailyRevenue':_0x577c5c[_0x1420bd(0x1ff)],'dailyPayments':_0x577c5c['dailyPayments'],'recentPayments':_0x254107[_0x1420bd(0x22a)](_0x4dcf2a=>({'id':_0x4dcf2a['id'],'gateway':_0x4dcf2a[_0x1420bd(0x24c)],'amount':_0x4dcf2a[_0x1420bd(0x24f)],'currency':_0x4dcf2a['currency'],'status':_0x4dcf2a[_0x1420bd(0x1da)],'createdAt':_0x4dcf2a[_0x1420bd(0x230)]}))};}[a54_0x1e6c28(0x1d8)](_0x29c773,_0x3cdddc,_0x3aa6ad){const _0x43f7b5=a54_0x1e6c28,_0x26559f=new Map(),_0x40397a=new Date(_0x3cdddc);while(_0x40397a<=_0x3aa6ad){const _0x82dd13=_0x40397a['toISOString']()['split']('T')[0x0];_0x26559f[_0x43f7b5(0x254)](_0x82dd13,{'revenue':0x0,'count':0x0}),_0x40397a[_0x43f7b5(0x251)](_0x40397a['getDate']()+0x1);}for(const _0x412e93 of _0x29c773){const _0x4b1139=_0x412e93[_0x43f7b5(0x230)][_0x43f7b5(0x1d5)]()[_0x43f7b5(0x201)]('T')[0x0],_0x550de8=_0x26559f[_0x43f7b5(0x1e8)](_0x4b1139);_0x550de8&&(_0x550de8['count']+=0x1,_0x412e93['status']===_0x43f7b5(0x24e)&&_0x412e93[_0x43f7b5(0x1d1)]&&(_0x550de8['revenue']+=_0x412e93[_0x43f7b5(0x1d1)]));}const _0x3e5c48=[],_0x1d3b51=[];for(const [_0x3f0062,_0x117756]of _0x26559f){_0x3e5c48['push']({'date':_0x3f0062,'amount':Math[_0x43f7b5(0x25e)](_0x117756[_0x43f7b5(0x1db)]*0x64)/0x64}),_0x1d3b51[_0x43f7b5(0x236)]({'date':_0x3f0062,'count':_0x117756[_0x43f7b5(0x20b)]});}return{'dailyRevenue':_0x3e5c48,'dailyPayments':_0x1d3b51};}}function a54_0x5710(_0x2dc325,_0x37e446){const _0x16dd2b=a54_0x16dd();return a54_0x5710=function(_0x571054,_0x414148){_0x571054=_0x571054-0x1c0;let _0x4a83b5=_0x16dd2b[_0x571054];return _0x4a83b5;},a54_0x5710(_0x2dc325,_0x37e446);}exports[a54_0x1e6c28(0x243)]=ShopService;