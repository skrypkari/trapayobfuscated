'use strict';const a52_0xc60ca4=a52_0x5e60;function a52_0x5b24(){const _0x38e95e=['27oAJcrW','log','PENDING','aggregate','23450MpgflN','payout','findMany','getPaymentByShopAndId','count','getMonth','2394320GBgswS','merchantUrl','CoinToPay','test_order_123','5873120tkAatR','testWebhook','all','paid','Unknown\x20error','parse','application/json','thisMonth','KLYME\x20GB','amountIsEditable','getPayoutStatistics','update','paymentService','393FTAmhq','USD','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','getFullYear','createdAt','round','Plisio','dailyPayments','statusText','gateways','error','\x20\x20\x20üíµ\x20Available\x20balance:\x20','paidAt','Test\x20webhook\x20sent\x20successfully\x20(','PaymentService','shop','setDate','shopId','shopUrl','notes','gte','awaitingPayout','__esModule','\x20payout\x20statistics\x20calculated:','filter','Shop\x20not\x20found','deletePayment','getStatistics','country','statusCode','name','findUnique','toISOString','delete','customerName','822qlQEeS','üìä\x20Shop\x20','currency','ceil','getPaymentsByShop','retryCount','customerEmail','payment','get','30d','map','paymentGateways','6746tBKtMO','push','split','isArray','usdtErcWallet','sourceCurrency','getPayoutById','test_payment_123','__importDefault','defineProperty','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','9899780oVZjfU','../config/database','gateway','1770jrnCcl','Payment\x20not\x20found','COMPLETED','getShopPayoutStats','message','reduce','webhookEvents','availableBalance','customer','No\x20webhook\x20URL\x20configured','findFirst','username','KLYME\x20EU','network','\x20USDT','publicKey','gatewaySettings','settings','./paymentService','test','txid','Noda','\x20\x20\x20üìÖ\x20This\x20month:\x20','set','webhookLog','revenue','POST','90d','expiresAt','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','default','redirectUrl','toUpperCase','PAID','amount','telegramId','usdcPolygonWallet','paymentId','usdtPolygonWallet','11320NwIAZl','webhookUrl','updateShopProfile','\x20USDT\x20(current\x20balance)','getTime','Webhook\x20returned\x20error:\x20','generateDailyStatistics','updatePayment','amountUSDT','usage','desc','getGatewayDisplayName','KLYME\x20DE','status','_sum','Rapyd','maxPayments','currencyService','getPayoutStats','stringify','29849281jgrcSm','lte','totalPaidOut','telegram','Error\x20parsing\x20webhook\x20events:','ShopService','usdtTrcWallet','balance','test_gateway','getDate','wallets','convertToUSDT'];a52_0x5b24=function(){return _0x38e95e;};return a52_0x5b24();}(function(_0x4720a8,_0x11b8e5){const _0x128679=a52_0x5e60,_0x51bdd9=_0x4720a8();while(!![]){try{const _0x31258f=-parseInt(_0x128679(0x260))/0x1*(parseInt(_0x128679(0x1f0))/0x2)+parseInt(_0x128679(0x283))/0x3*(-parseInt(_0x128679(0x225))/0x4)+parseInt(_0x128679(0x253))/0x5+-parseInt(_0x128679(0x1fe))/0x6*(parseInt(_0x128679(0x249))/0x7)+-parseInt(_0x128679(0x24f))/0x8*(-parseInt(_0x128679(0x245))/0x9)+-parseInt(_0x128679(0x1fb))/0xa+parseInt(_0x128679(0x239))/0xb;if(_0x31258f===_0x11b8e5)break;else _0x51bdd9['push'](_0x51bdd9['shift']());}catch(_0x19be01){_0x51bdd9['push'](_0x51bdd9['shift']());}}}(a52_0x5b24,0xac90c));var __importDefault=this&&this[a52_0xc60ca4(0x1f8)]||function(_0x106047){const _0x2e203d=a52_0xc60ca4;return _0x106047&&_0x106047[_0x2e203d(0x276)]?_0x106047:{'default':_0x106047};};Object[a52_0xc60ca4(0x1f9)](exports,a52_0xc60ca4(0x276),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require(a52_0xc60ca4(0x1fc))),currencyService_1=require('./currencyService'),paymentService_1=require(a52_0xc60ca4(0x210));class ShopService{constructor(){const _0x4c5764=a52_0xc60ca4;this[_0x4c5764(0x25f)]=new paymentService_1[(_0x4c5764(0x26e))]();}async['getShopProfile'](_0x2e9829){const _0x2cfb4d=a52_0xc60ca4,_0x41b5da=await database_1['default'][_0x2cfb4d(0x26f)][_0x2cfb4d(0x27f)]({'where':{'id':_0x2e9829},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x41b5da)throw new Error(_0x2cfb4d(0x279));let _0x523b67=[];if(_0x41b5da['settings']?.['webhookEvents'])try{_0x523b67=Array['isArray'](_0x41b5da[_0x2cfb4d(0x20f)]['webhookEvents'])?_0x41b5da[_0x2cfb4d(0x20f)][_0x2cfb4d(0x204)]:JSON[_0x2cfb4d(0x258)](_0x41b5da[_0x2cfb4d(0x20f)][_0x2cfb4d(0x204)]);}catch(_0x16488d){console[_0x2cfb4d(0x26a)](_0x2cfb4d(0x23d),_0x16488d),_0x523b67=[];}return{'id':_0x41b5da['id'],'fullName':_0x41b5da[_0x2cfb4d(0x27e)],'username':_0x41b5da['username'],'telegramId':_0x41b5da['telegram'],'merchantUrl':_0x41b5da[_0x2cfb4d(0x272)],'gateways':_0x41b5da[_0x2cfb4d(0x1ef)]?JSON[_0x2cfb4d(0x258)](_0x41b5da[_0x2cfb4d(0x1ef)]):null,'gatewaySettings':_0x41b5da['gatewaySettings']?JSON[_0x2cfb4d(0x258)](_0x41b5da[_0x2cfb4d(0x20e)]):null,'publicKey':_0x41b5da[_0x2cfb4d(0x20d)],'webhookUrl':_0x41b5da[_0x2cfb4d(0x20f)]?.[_0x2cfb4d(0x226)]||null,'webhookEvents':_0x523b67,'wallets':{'usdtPolygonWallet':_0x41b5da['usdtPolygonWallet'],'usdtTrcWallet':_0x41b5da[_0x2cfb4d(0x23f)],'usdtErcWallet':_0x41b5da[_0x2cfb4d(0x1f4)],'usdcPolygonWallet':_0x41b5da[_0x2cfb4d(0x222)]},'status':_0x41b5da[_0x2cfb4d(0x232)],'createdAt':_0x41b5da[_0x2cfb4d(0x264)]};}async[a52_0xc60ca4(0x227)](_0x4ea484,_0x5a71f9){const _0x3f3897=a52_0xc60ca4,_0x2f3c7f={};_0x5a71f9['fullName']&&(_0x2f3c7f[_0x3f3897(0x27e)]=_0x5a71f9['fullName']);_0x5a71f9[_0x3f3897(0x221)]!==undefined&&(_0x2f3c7f[_0x3f3897(0x23c)]=_0x5a71f9[_0x3f3897(0x221)]||null);_0x5a71f9[_0x3f3897(0x250)]&&(_0x2f3c7f[_0x3f3897(0x272)]=_0x5a71f9[_0x3f3897(0x250)]);_0x5a71f9[_0x3f3897(0x269)]&&(_0x2f3c7f[_0x3f3897(0x1ef)]=JSON[_0x3f3897(0x238)](_0x5a71f9[_0x3f3897(0x269)]));_0x5a71f9[_0x3f3897(0x20e)]&&(_0x2f3c7f[_0x3f3897(0x20e)]=JSON[_0x3f3897(0x238)](_0x5a71f9[_0x3f3897(0x20e)]));_0x5a71f9[_0x3f3897(0x243)]&&(_0x5a71f9['wallets']['usdtPolygonWallet']!==undefined&&(_0x2f3c7f[_0x3f3897(0x224)]=_0x5a71f9[_0x3f3897(0x243)]['usdtPolygonWallet']||null),_0x5a71f9[_0x3f3897(0x243)][_0x3f3897(0x23f)]!==undefined&&(_0x2f3c7f[_0x3f3897(0x23f)]=_0x5a71f9[_0x3f3897(0x243)][_0x3f3897(0x23f)]||null),_0x5a71f9[_0x3f3897(0x243)][_0x3f3897(0x1f4)]!==undefined&&(_0x2f3c7f[_0x3f3897(0x1f4)]=_0x5a71f9[_0x3f3897(0x243)][_0x3f3897(0x1f4)]||null),_0x5a71f9[_0x3f3897(0x243)][_0x3f3897(0x222)]!==undefined&&(_0x2f3c7f[_0x3f3897(0x222)]=_0x5a71f9[_0x3f3897(0x243)]['usdcPolygonWallet']||null));const _0x4deb17=await database_1['default'][_0x3f3897(0x26f)]['update']({'where':{'id':_0x4ea484},'data':_0x2f3c7f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x4dfa0c=[];if(_0x4deb17['settings']?.[_0x3f3897(0x204)])try{_0x4dfa0c=Array[_0x3f3897(0x1f3)](_0x4deb17[_0x3f3897(0x20f)][_0x3f3897(0x204)])?_0x4deb17[_0x3f3897(0x20f)]['webhookEvents']:JSON[_0x3f3897(0x258)](_0x4deb17['settings'][_0x3f3897(0x204)]);}catch(_0x112863){console[_0x3f3897(0x26a)](_0x3f3897(0x23d),_0x112863),_0x4dfa0c=[];}return{'id':_0x4deb17['id'],'fullName':_0x4deb17[_0x3f3897(0x27e)],'username':_0x4deb17[_0x3f3897(0x209)],'telegramId':_0x4deb17[_0x3f3897(0x23c)],'merchantUrl':_0x4deb17[_0x3f3897(0x272)],'gateways':_0x4deb17[_0x3f3897(0x1ef)]?JSON[_0x3f3897(0x258)](_0x4deb17[_0x3f3897(0x1ef)]):null,'gatewaySettings':_0x4deb17['gatewaySettings']?JSON[_0x3f3897(0x258)](_0x4deb17[_0x3f3897(0x20e)]):null,'publicKey':_0x4deb17[_0x3f3897(0x20d)],'webhookUrl':_0x4deb17[_0x3f3897(0x20f)]?.['webhookUrl']||null,'webhookEvents':_0x4dfa0c,'wallets':{'usdtPolygonWallet':_0x4deb17['usdtPolygonWallet'],'usdtTrcWallet':_0x4deb17[_0x3f3897(0x23f)],'usdtErcWallet':_0x4deb17[_0x3f3897(0x1f4)],'usdcPolygonWallet':_0x4deb17[_0x3f3897(0x222)]},'status':_0x4deb17[_0x3f3897(0x232)],'createdAt':_0x4deb17[_0x3f3897(0x264)]};}async['updateWallets'](_0x5a24db,_0x1cb8d6){const _0x5211c2=a52_0xc60ca4,_0x3990b1={};_0x1cb8d6[_0x5211c2(0x224)]!==undefined&&(_0x3990b1['usdtPolygonWallet']=_0x1cb8d6[_0x5211c2(0x224)]||null),_0x1cb8d6[_0x5211c2(0x23f)]!==undefined&&(_0x3990b1[_0x5211c2(0x23f)]=_0x1cb8d6[_0x5211c2(0x23f)]||null),_0x1cb8d6[_0x5211c2(0x1f4)]!==undefined&&(_0x3990b1['usdtErcWallet']=_0x1cb8d6['usdtErcWallet']||null),_0x1cb8d6[_0x5211c2(0x222)]!==undefined&&(_0x3990b1[_0x5211c2(0x222)]=_0x1cb8d6[_0x5211c2(0x222)]||null),await database_1[_0x5211c2(0x21c)][_0x5211c2(0x26f)][_0x5211c2(0x25e)]({'where':{'id':_0x5a24db},'data':_0x3990b1});}async[a52_0xc60ca4(0x254)](_0x2f8160){const _0x3d0b1d=a52_0xc60ca4,_0x8e19d0=await database_1[_0x3d0b1d(0x21c)][_0x3d0b1d(0x26f)][_0x3d0b1d(0x27f)]({'where':{'id':_0x2f8160},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x8e19d0?.[_0x3d0b1d(0x20f)]?.[_0x3d0b1d(0x226)])throw new Error(_0x3d0b1d(0x207));const _0x67bc0e={'event':_0x3d0b1d(0x211),'payment':{'id':_0x3d0b1d(0x1f7),'order_id':_0x3d0b1d(0x252),'gateway':_0x3d0b1d(0x211),'amount':0x64,'currency':_0x3d0b1d(0x261),'status':_0x3d0b1d(0x256),'created_at':new Date()[_0x3d0b1d(0x280)]()}};try{const _0x55f725=await fetch(_0x8e19d0['settings'][_0x3d0b1d(0x226)],{'method':_0x3d0b1d(0x218),'headers':{'Content-Type':_0x3d0b1d(0x259),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x3d0b1d(0x238)](_0x67bc0e)});return _0x55f725['ok']?{'success':!![],'message':_0x3d0b1d(0x26d)+_0x55f725[_0x3d0b1d(0x232)]+')'}:{'success':![],'message':_0x3d0b1d(0x22a)+_0x55f725['status']+'\x20'+_0x55f725[_0x3d0b1d(0x268)]};}catch(_0x40e963){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x40e963 instanceof Error?_0x40e963[_0x3d0b1d(0x202)]:_0x3d0b1d(0x257))};}}async['createPayment'](_0x2d6425){const _0xcd9981=a52_0xc60ca4;return this['paymentService']['createPublicPayment']({'public_key':'','gateway':_0x2d6425[_0xcd9981(0x1fd)],'order_id':undefined,'amount':_0x2d6425[_0xcd9981(0x220)],'currency':_0x2d6425[_0xcd9981(0x285)],'source_currency':_0x2d6425[_0xcd9981(0x1f5)],'usage':_0x2d6425[_0xcd9981(0x22e)],'expires_at':_0x2d6425[_0xcd9981(0x21a)]?.[_0xcd9981(0x280)](),'success_url':_0x2d6425[_0xcd9981(0x21d)],'fail_url':_0x2d6425[_0xcd9981(0x21d)],'customer_email':_0x2d6425[_0xcd9981(0x289)],'customer_name':_0x2d6425[_0xcd9981(0x282)],'country':_0x2d6425[_0xcd9981(0x27c)],'language':_0x2d6425['language'],'amount_is_editable':_0x2d6425[_0xcd9981(0x25c)],'max_payments':_0x2d6425[_0xcd9981(0x235)],'customer':_0x2d6425[_0xcd9981(0x206)]});}async['getPayments'](_0x57ea46,_0x23bd7d){const _0xa9f873=a52_0xc60ca4;return this[_0xa9f873(0x25f)][_0xa9f873(0x287)](_0x57ea46,_0x23bd7d);}async['getPaymentById'](_0x1eef12,_0x23b324){const _0x30992e=a52_0xc60ca4;return this['paymentService'][_0x30992e(0x24c)](_0x1eef12,_0x23b324);}async[a52_0xc60ca4(0x22c)](_0x4cdee3,_0x1ae086,_0x21030c){const _0x520c64=a52_0xc60ca4,_0x454785=await database_1[_0x520c64(0x21c)][_0x520c64(0x28a)][_0x520c64(0x208)]({'where':{'id':_0x1ae086,'shopId':_0x4cdee3}});if(!_0x454785)throw new Error(_0x520c64(0x1ff));const _0x187f87=await database_1['default'][_0x520c64(0x28a)][_0x520c64(0x25e)]({'where':{'id':_0x1ae086},'data':{..._0x21030c,'updatedAt':new Date()}});return _0x187f87;}async[a52_0xc60ca4(0x27a)](_0x28f072,_0x58aa23){const _0x9b0c65=a52_0xc60ca4,_0x323d78=await database_1[_0x9b0c65(0x21c)][_0x9b0c65(0x28a)][_0x9b0c65(0x208)]({'where':{'id':_0x58aa23,'shopId':_0x28f072}});if(!_0x323d78)throw new Error('Payment\x20not\x20found');await database_1[_0x9b0c65(0x21c)][_0x9b0c65(0x28a)][_0x9b0c65(0x281)]({'where':{'id':_0x58aa23}});}async['getPayouts'](_0x28412e,_0xa9bf9d){const _0x8a132b=a52_0xc60ca4,{page:_0x518785,limit:_0x1f6d0f,status:_0x1625a3,method:_0x37c8a7,dateFrom:_0x41591a,dateTo:_0x37985b,periodFrom:_0x11ad5a,periodTo:_0x24f7b9}=_0xa9bf9d,_0x1f378b=(_0x518785-0x1)*_0x1f6d0f,_0x3bf8f3={'shopId':_0x28412e};_0x1625a3&&(_0x3bf8f3['status']=_0x1625a3[_0x8a132b(0x21e)]());_0x37c8a7&&(_0x3bf8f3[_0x8a132b(0x20b)]=_0x37c8a7);if(_0x41591a||_0x37985b||_0x11ad5a||_0x24f7b9){_0x3bf8f3[_0x8a132b(0x264)]={};if(_0x11ad5a)_0x3bf8f3[_0x8a132b(0x264)][_0x8a132b(0x274)]=new Date(_0x11ad5a);else _0x41591a&&(_0x3bf8f3[_0x8a132b(0x264)]['gte']=new Date(_0x41591a));if(_0x24f7b9)_0x3bf8f3[_0x8a132b(0x264)]['lte']=new Date(_0x24f7b9);else _0x37985b&&(_0x3bf8f3[_0x8a132b(0x264)][_0x8a132b(0x23a)]=new Date(_0x37985b));}const [_0x3191e6,_0x378d12]=await Promise[_0x8a132b(0x255)]([database_1[_0x8a132b(0x21c)]['payout'][_0x8a132b(0x24b)]({'where':_0x3bf8f3,'skip':_0x1f378b,'take':_0x1f6d0f,'orderBy':{'createdAt':_0x8a132b(0x22f)}}),database_1[_0x8a132b(0x21c)][_0x8a132b(0x24a)][_0x8a132b(0x24d)]({'where':_0x3bf8f3})]);return{'payouts':_0x3191e6['map'](_0x42422f=>({'id':_0x42422f['id'],'amount':_0x42422f[_0x8a132b(0x220)],'network':_0x42422f[_0x8a132b(0x20b)],'status':_0x42422f[_0x8a132b(0x232)],'txid':_0x42422f[_0x8a132b(0x212)],'notes':_0x42422f[_0x8a132b(0x273)],'createdAt':_0x42422f['createdAt'],'paidAt':_0x42422f[_0x8a132b(0x26c)]})),'pagination':{'page':_0x518785,'limit':_0x1f6d0f,'total':_0x378d12,'totalPages':Math[_0x8a132b(0x286)](_0x378d12/_0x1f6d0f)}};}async[a52_0xc60ca4(0x1f6)](_0x2f1e68,_0x2d39b6){const _0x16b522=a52_0xc60ca4,_0x4ecd0d=await database_1[_0x16b522(0x21c)][_0x16b522(0x24a)]['findFirst']({'where':{'id':_0x2d39b6,'shopId':_0x2f1e68}});if(!_0x4ecd0d)return null;return{'id':_0x4ecd0d['id'],'amount':_0x4ecd0d[_0x16b522(0x220)],'network':_0x4ecd0d[_0x16b522(0x20b)],'status':_0x4ecd0d['status'],'txid':_0x4ecd0d[_0x16b522(0x212)],'notes':_0x4ecd0d[_0x16b522(0x273)],'createdAt':_0x4ecd0d[_0x16b522(0x264)],'paidAt':_0x4ecd0d[_0x16b522(0x26c)]};}async[a52_0xc60ca4(0x25d)](_0x30853b,_0x3580fa){const _0x26309f=a52_0xc60ca4,_0x4faac5=new Date();let _0x5733d1;switch(_0x3580fa){case'7d':_0x5733d1=new Date(_0x4faac5[_0x26309f(0x229)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x26309f(0x28c):_0x5733d1=new Date(_0x4faac5[_0x26309f(0x229)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x26309f(0x219):_0x5733d1=new Date(_0x4faac5['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5733d1=new Date(_0x4faac5['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x38e7ff,_0x16acbb,_0x3ac57e,_0x50b76c,_0x1b8a24,_0x46f301]=await Promise[_0x26309f(0x255)]([database_1[_0x26309f(0x21c)][_0x26309f(0x24a)][_0x26309f(0x24d)]({'where':{'shopId':_0x30853b,'createdAt':{'gte':_0x5733d1}}}),database_1[_0x26309f(0x21c)]['payout'][_0x26309f(0x24d)]({'where':{'shopId':_0x30853b,'status':_0x26309f(0x200),'createdAt':{'gte':_0x5733d1}}}),database_1[_0x26309f(0x21c)][_0x26309f(0x24a)][_0x26309f(0x24d)]({'where':{'shopId':_0x30853b,'status':_0x26309f(0x247),'createdAt':{'gte':_0x5733d1}}}),database_1[_0x26309f(0x21c)][_0x26309f(0x24a)][_0x26309f(0x24d)]({'where':{'shopId':_0x30853b,'status':'REJECTED','createdAt':{'gte':_0x5733d1}}}),database_1[_0x26309f(0x21c)]['payout'][_0x26309f(0x24b)]({'where':{'shopId':_0x30853b,'createdAt':{'gte':_0x5733d1}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x26309f(0x21c)][_0x26309f(0x24a)][_0x26309f(0x24b)]({'where':{'shopId':_0x30853b},'take':0xa,'orderBy':{'createdAt':_0x26309f(0x22f)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x24fb72=_0x1b8a24[_0x26309f(0x203)]((_0x5d3632,_0x3c0ed6)=>_0x5d3632+_0x3c0ed6[_0x26309f(0x220)],0x0),_0x366f17=_0x1b8a24['filter'](_0x49af5=>_0x49af5[_0x26309f(0x232)]==='COMPLETED')['reduce']((_0x5d4bec,_0x139c86)=>_0x5d4bec+_0x139c86[_0x26309f(0x220)],0x0),_0x20ca13=_0x1b8a24[_0x26309f(0x278)](_0x4f5403=>_0x4f5403[_0x26309f(0x232)]===_0x26309f(0x247))[_0x26309f(0x203)]((_0x1a09b3,_0x10064e)=>_0x1a09b3+_0x10064e[_0x26309f(0x220)],0x0),_0x326390=_0x1b8a24[_0x26309f(0x203)]((_0x41ba4e,_0x23f890)=>{const _0x23486f=_0x26309f;return _0x41ba4e[_0x23f890[_0x23486f(0x20b)]]=(_0x41ba4e[_0x23f890['network']]||0x0)+0x1,_0x41ba4e;},{}),_0x1b8caf=_0x1b8a24[_0x26309f(0x203)]((_0x413dca,_0x51418c)=>{const _0x316797=_0x26309f;return _0x413dca[_0x51418c[_0x316797(0x232)]]=(_0x413dca[_0x51418c[_0x316797(0x232)]]||0x0)+0x1,_0x413dca;},{});return{'totalPayouts':_0x38e7ff,'completedPayouts':_0x16acbb,'pendingPayouts':_0x3ac57e,'rejectedPayouts':_0x50b76c,'totalAmount':_0x24fb72,'completedAmount':_0x366f17,'pendingAmount':_0x20ca13,'payoutsByMethod':_0x326390,'payoutsByStatus':_0x1b8caf,'recentPayouts':_0x46f301[_0x26309f(0x1ee)](_0x29dd80=>({'id':_0x29dd80['id'],'shopId':_0x30853b,'amount':_0x29dd80[_0x26309f(0x220)],'method':_0x29dd80[_0x26309f(0x20b)],'status':_0x29dd80[_0x26309f(0x232)],'txid':_0x29dd80[_0x26309f(0x212)],'createdAt':_0x29dd80['createdAt'],'paidAt':_0x29dd80[_0x26309f(0x26c)]}))};}async[a52_0xc60ca4(0x201)](_0x51be65){const _0x1f37b7=a52_0xc60ca4;console[_0x1f37b7(0x246)](_0x1f37b7(0x21b)+_0x51be65+'...');const _0x5beada=await database_1['default'][_0x1f37b7(0x26f)][_0x1f37b7(0x27f)]({'where':{'id':_0x51be65},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5beada)throw new Error(_0x1f37b7(0x279));const _0xf08e5c=new Date(),_0x14d7b3=new Date(_0xf08e5c[_0x1f37b7(0x263)](),_0xf08e5c[_0x1f37b7(0x24e)](),0x1),_0xf7f324=new Date(_0xf08e5c[_0x1f37b7(0x263)](),_0xf08e5c['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x20ccf1=await database_1[_0x1f37b7(0x21c)][_0x1f37b7(0x24a)][_0x1f37b7(0x248)]({'_sum':{'amount':!![]},'where':{'shopId':_0x51be65,'createdAt':{'gte':_0x14d7b3,'lte':_0xf7f324},'status':_0x1f37b7(0x200)}}),_0x234d93=_0x20ccf1[_0x1f37b7(0x233)][_0x1f37b7(0x220)]||0x0,_0x3e21a4={'availableBalance':Math[_0x1f37b7(0x265)](_0x5beada[_0x1f37b7(0x240)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x5beada[_0x1f37b7(0x23b)]*0x64)/0x64,'awaitingPayout':Math[_0x1f37b7(0x265)](_0x5beada[_0x1f37b7(0x240)]*0x64)/0x64,'thisMonth':Math[_0x1f37b7(0x265)](_0x234d93*0x64)/0x64};return console['log'](_0x1f37b7(0x284)+_0x5beada[_0x1f37b7(0x209)]+_0x1f37b7(0x277)),console['log'](_0x1f37b7(0x26b)+_0x3e21a4[_0x1f37b7(0x205)]+_0x1f37b7(0x228)),console['log'](_0x1f37b7(0x262)+_0x3e21a4[_0x1f37b7(0x23b)]+'\x20USDT\x20(total\x20payouts)'),console[_0x1f37b7(0x246)](_0x1f37b7(0x1fa)+_0x3e21a4[_0x1f37b7(0x275)]+'\x20USDT\x20(current\x20balance)'),console[_0x1f37b7(0x246)](_0x1f37b7(0x214)+_0x3e21a4[_0x1f37b7(0x25a)]+_0x1f37b7(0x20c)),_0x3e21a4;}[a52_0xc60ca4(0x230)](_0x1df3a7){const _0x320dc0=a52_0xc60ca4,_0x57bcf5={'test_gateway':'Test\x20Gateway','plisio':_0x320dc0(0x266),'rapyd':_0x320dc0(0x234),'noda':_0x320dc0(0x213),'cointopay':_0x320dc0(0x251),'klyme_eu':_0x320dc0(0x20a),'klyme_gb':_0x320dc0(0x25b),'klyme_de':_0x320dc0(0x231)};return _0x57bcf5[_0x1df3a7]||_0x1df3a7;}async[a52_0xc60ca4(0x237)](_0x38b8ce){const _0x22702d=a52_0xc60ca4;return this[_0x22702d(0x201)](_0x38b8ce);}async['getWebhookLogs'](_0x2542bc,_0x395923){const _0x1c1303=a52_0xc60ca4,{page:_0x2a18ee,limit:_0x39ad2a,paymentId:_0x303c0f}=_0x395923,_0x3ec39c=(_0x2a18ee-0x1)*_0x39ad2a,_0x4efbc1={'shopId':_0x2542bc};_0x303c0f&&(_0x4efbc1[_0x1c1303(0x223)]=_0x303c0f);const [_0x36c87e,_0x5f49e1]=await Promise[_0x1c1303(0x255)]([database_1[_0x1c1303(0x21c)]['webhookLog'][_0x1c1303(0x24b)]({'where':_0x4efbc1,'skip':_0x3ec39c,'take':_0x39ad2a,'orderBy':{'createdAt':'desc'},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x1c1303(0x21c)][_0x1c1303(0x216)][_0x1c1303(0x24d)]({'where':_0x4efbc1})]);return{'logs':_0x36c87e[_0x1c1303(0x1ee)](_0x5130c7=>({'id':_0x5130c7['id'],'paymentId':_0x5130c7[_0x1c1303(0x223)],'shopId':_0x5130c7[_0x1c1303(0x271)],'event':_0x5130c7['event'],'statusCode':_0x5130c7[_0x1c1303(0x27d)],'retryCount':_0x5130c7[_0x1c1303(0x288)],'responseBody':_0x5130c7['responseBody'],'createdAt':_0x5130c7['createdAt'],'payment':_0x5130c7[_0x1c1303(0x28a)]})),'pagination':{'page':_0x2a18ee,'limit':_0x39ad2a,'total':_0x5f49e1,'totalPages':Math[_0x1c1303(0x286)](_0x5f49e1/_0x39ad2a)}};}async[a52_0xc60ca4(0x27b)](_0x132d34,_0x203a3c){const _0x3b11da=a52_0xc60ca4,_0x56b71b=new Date();let _0x4aa1ac;switch(_0x203a3c){case'7d':_0x4aa1ac=new Date(_0x56b71b['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3b11da(0x28c):_0x4aa1ac=new Date(_0x56b71b[_0x3b11da(0x229)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3b11da(0x219):_0x4aa1ac=new Date(_0x56b71b[_0x3b11da(0x229)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4aa1ac=new Date(_0x56b71b[_0x3b11da(0x229)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x20d045,_0x9c8654,_0x20f2dc,_0xe78ba6,_0x59a506]=await Promise[_0x3b11da(0x255)]([database_1[_0x3b11da(0x21c)]['payment']['count']({'where':{'shopId':_0x132d34,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x4aa1ac}}}),database_1['default'][_0x3b11da(0x28a)][_0x3b11da(0x24d)]({'where':{'shopId':_0x132d34,'gateway':{'not':_0x3b11da(0x241)},'status':_0x3b11da(0x21f),'createdAt':{'gte':_0x4aa1ac}}}),database_1[_0x3b11da(0x21c)]['payment'][_0x3b11da(0x24b)]({'where':{'shopId':_0x132d34,'gateway':{'not':_0x3b11da(0x241)},'status':_0x3b11da(0x21f),'createdAt':{'gte':_0x4aa1ac}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3b11da(0x21c)][_0x3b11da(0x28a)][_0x3b11da(0x24b)]({'where':{'shopId':_0x132d34,'gateway':{'not':_0x3b11da(0x241)}},'take':0xa,'orderBy':{'createdAt':_0x3b11da(0x22f)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3b11da(0x21c)][_0x3b11da(0x28a)][_0x3b11da(0x24b)]({'where':{'shopId':_0x132d34,'gateway':{'not':_0x3b11da(0x241)},'createdAt':{'gte':_0x4aa1ac}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x4fd57e=0x0;for(const _0x1970ca of _0x20f2dc){if(_0x1970ca[_0x3b11da(0x22d)])_0x4fd57e+=_0x1970ca[_0x3b11da(0x22d)];else{const _0x1dc559=await currencyService_1[_0x3b11da(0x236)][_0x3b11da(0x244)](_0x1970ca['amount'],_0x1970ca[_0x3b11da(0x285)]);_0x4fd57e+=_0x1dc559;}}const _0x2fee96=this[_0x3b11da(0x22b)](_0x59a506,_0x4aa1ac,_0x56b71b),_0x1d32df=_0x20d045>0x0?_0x9c8654/_0x20d045*0x64:0x0;return{'totalPayments':_0x20d045,'successfulPayments':_0x9c8654,'totalRevenue':Math['round'](_0x4fd57e*0x64)/0x64,'conversionRate':Math[_0x3b11da(0x265)](_0x1d32df*0x64)/0x64,'dailyRevenue':_0x2fee96['dailyRevenue'],'dailyPayments':_0x2fee96[_0x3b11da(0x267)],'recentPayments':_0xe78ba6[_0x3b11da(0x1ee)](_0x287cff=>({'id':_0x287cff['id'],'gateway':_0x287cff[_0x3b11da(0x1fd)],'amount':_0x287cff[_0x3b11da(0x220)],'currency':_0x287cff[_0x3b11da(0x285)],'status':_0x287cff[_0x3b11da(0x232)],'createdAt':_0x287cff[_0x3b11da(0x264)]}))};}['generateDailyStatistics'](_0x185a85,_0x5cd803,_0x3dcbea){const _0x49a5d=a52_0xc60ca4,_0x2a6d67=new Map(),_0x5d94e1=new Date(_0x5cd803);while(_0x5d94e1<=_0x3dcbea){const _0xaf9bce=_0x5d94e1[_0x49a5d(0x280)]()['split']('T')[0x0];_0x2a6d67[_0x49a5d(0x215)](_0xaf9bce,{'revenue':0x0,'count':0x0}),_0x5d94e1[_0x49a5d(0x270)](_0x5d94e1[_0x49a5d(0x242)]()+0x1);}for(const _0x5eb0d4 of _0x185a85){const _0x58a2b9=_0x5eb0d4[_0x49a5d(0x264)]['toISOString']()[_0x49a5d(0x1f2)]('T')[0x0],_0x2f9ff6=_0x2a6d67[_0x49a5d(0x28b)](_0x58a2b9);_0x2f9ff6&&(_0x2f9ff6[_0x49a5d(0x24d)]+=0x1,_0x5eb0d4[_0x49a5d(0x232)]===_0x49a5d(0x21f)&&_0x5eb0d4[_0x49a5d(0x22d)]&&(_0x2f9ff6[_0x49a5d(0x217)]+=_0x5eb0d4[_0x49a5d(0x22d)]));}const _0x5cb1c6=[],_0x45c367=[];for(const [_0x1bf9f2,_0x58b399]of _0x2a6d67){_0x5cb1c6[_0x49a5d(0x1f1)]({'date':_0x1bf9f2,'amount':Math[_0x49a5d(0x265)](_0x58b399[_0x49a5d(0x217)]*0x64)/0x64}),_0x45c367[_0x49a5d(0x1f1)]({'date':_0x1bf9f2,'count':_0x58b399[_0x49a5d(0x24d)]});}return{'dailyRevenue':_0x5cb1c6,'dailyPayments':_0x45c367};}}function a52_0x5e60(_0x3fc115,_0x107e98){const _0x5b2411=a52_0x5b24();return a52_0x5e60=function(_0x5e60aa,_0x57f274){_0x5e60aa=_0x5e60aa-0x1ee;let _0x921058=_0x5b2411[_0x5e60aa];return _0x921058;},a52_0x5e60(_0x3fc115,_0x107e98);}exports[a52_0xc60ca4(0x23e)]=ShopService;