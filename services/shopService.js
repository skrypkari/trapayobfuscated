'use strict';const a58_0x2a0001=a58_0x67c4;(function(_0x297db6,_0x4ccb55){const _0x1f8f6c=a58_0x67c4,_0x211760=_0x297db6();while(!![]){try{const _0x52afc8=-parseInt(_0x1f8f6c(0x120))/0x1*(parseInt(_0x1f8f6c(0x147))/0x2)+parseInt(_0x1f8f6c(0x17e))/0x3*(parseInt(_0x1f8f6c(0x158))/0x4)+-parseInt(_0x1f8f6c(0xfd))/0x5+-parseInt(_0x1f8f6c(0x19e))/0x6+parseInt(_0x1f8f6c(0x16a))/0x7*(parseInt(_0x1f8f6c(0x106))/0x8)+parseInt(_0x1f8f6c(0x17a))/0x9+-parseInt(_0x1f8f6c(0x16d))/0xa*(-parseInt(_0x1f8f6c(0x15a))/0xb);if(_0x52afc8===_0x4ccb55)break;else _0x211760['push'](_0x211760['shift']());}catch(_0x5fe76b){_0x211760['push'](_0x211760['shift']());}}}(a58_0x54ef,0x48fda));function a58_0x54ef(){const _0x3688cf=['üìÖ\x20Period\x20end:\x20','__esModule','üìÖ\x20Date\x20end:\x20','CoinToPay','txid','getPayoutStatistics','settings','2fcgEgE','isArray','default','balance','getShopProfile','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','usdtErcWallet','usdtTrcWallet','gatewaySettings','ShopService','üìÖ\x20Period\x20start:\x20','delete','Plisio','Shop\x20not\x20found','expiresAt','periodTo','Rapyd','36hxSrhs','getPayouts','624910FqApFo','fullName','webhookLog','PENDING','./currencyService','getWebhookLogs','error','test','setHours','message','KLYME\x20EU','Test\x20webhook\x20sent\x20successfully\x20(','updatePayment','awaitingPayout','filter','toUpperCase','1965467zzxiwe','usdtPolygonWallet','day','160aMJdDm','maxPayments','merchantUrl','createPayment','polygon','test_order_123','USDC\x20Polygon','gateways','currency','map','all','setDate','paymentId','2558412JUHWSE','üí∞\x20Getting\x20payouts\x20with\x20filters:','name','ceil','110013dqkRmJ','wallets','dailyRevenue','statusCode','Payment\x20not\x20found','gte','üåê\x20Method\x20filter:\x20','trc20','getMonth','getPayoutById','getTime','testWebhook','../config/database','parse','paymentService','getFullYear','Test\x20Gateway','YESTERDAY','webhookEvents','generateDailyStatistics','get','shop','getPaymentById','30d','üåê\x20Network\x20filter:\x20','\x20USDT\x20(current\x20balance)','test_payment_123','\x20payout\x20statistics\x20calculated:','90d','log','test_gateway','Unknown\x20error','2834694ZwfmJt','paymentGateways','payment','round','toISOString','findFirst','totalPaidOut','PAID','findMany','PaymentService','POST','2942330uvbQaa','getPaymentsByShop','findUnique','usdcPolygonWallet','notes','createdAt','COMPLETED','customer','aggregate','8bQpZrQ','availableBalance','network','customerEmail','Error\x20parsing\x20webhook\x20events:','_sum','shopId','getStatistics','webhookUrl','USDT\x20BSC','USDT\x20ERC20','publicKey','KLYME\x20GB','KLYME\x20DE','count','redirectUrl','revenue','REJECTED','telegram','amountIsEditable','split','paid','retryCount','createPublicPayment','desc','paidAt','444163XwVYFR','getDate','push','reduce','stringify','update','amount','shopUrl','\x20\x20\x20üíµ\x20Available\x20balance:\x20','updateWallets','lte','üìÖ\x20Date\x20start:\x20','application/json','set','status','TesSoft\x20Payment\x20System/1.0\x20(Test)','dailyPayments','Webhook\x20returned\x20error:\x20','responseBody','customerName','thisMonth','amountUSDT','USD','gateway','formatNetworkName','...','Failed\x20to\x20send\x20webhook:\x20','getShopPayoutStats','username','payout','./paymentService','yesterday'];a58_0x54ef=function(){return _0x3688cf;};return a58_0x54ef();}var __importDefault=this&&this['__importDefault']||function(_0x5652a9){const _0xf2b8ce=a58_0x67c4;return _0x5652a9&&_0x5652a9[_0xf2b8ce(0x141)]?_0x5652a9:{'default':_0x5652a9};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a58_0x2a0001(0x150)]=void 0x0;const database_1=__importDefault(require(a58_0x2a0001(0x18a))),currencyService_1=require(a58_0x2a0001(0x15e)),paymentService_1=require(a58_0x2a0001(0x13e));function a58_0x67c4(_0x5f11a8,_0x700b6b){const _0x54ef67=a58_0x54ef();return a58_0x67c4=function(_0x67c419,_0x4a37a9){_0x67c419=_0x67c419-0xf4;let _0x19aca6=_0x54ef67[_0x67c419];return _0x19aca6;},a58_0x67c4(_0x5f11a8,_0x700b6b);}class ShopService{constructor(){const _0xb80ffa=a58_0x2a0001;this[_0xb80ffa(0x18c)]=new paymentService_1[(_0xb80ffa(0xfb))]();}async[a58_0x2a0001(0x14b)](_0x58881b){const _0x57e564=a58_0x2a0001,_0xdbcf6=await database_1[_0x57e564(0x149)][_0x57e564(0x193)][_0x57e564(0xff)]({'where':{'id':_0x58881b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0xdbcf6)throw new Error('Shop\x20not\x20found');let _0x201ea4=[];if(_0xdbcf6['settings']?.[_0x57e564(0x190)])try{_0x201ea4=Array[_0x57e564(0x148)](_0xdbcf6[_0x57e564(0x146)][_0x57e564(0x190)])?_0xdbcf6[_0x57e564(0x146)][_0x57e564(0x190)]:JSON[_0x57e564(0x18b)](_0xdbcf6[_0x57e564(0x146)]['webhookEvents']);}catch(_0x5cc3e7){console[_0x57e564(0x160)](_0x57e564(0x10a),_0x5cc3e7),_0x201ea4=[];}return{'id':_0xdbcf6['id'],'fullName':_0xdbcf6[_0x57e564(0x17c)],'username':_0xdbcf6[_0x57e564(0x13c)],'telegramId':_0xdbcf6[_0x57e564(0x118)],'merchantUrl':_0xdbcf6[_0x57e564(0x127)],'gateways':_0xdbcf6[_0x57e564(0x19f)]?JSON[_0x57e564(0x18b)](_0xdbcf6['paymentGateways']):null,'gatewaySettings':_0xdbcf6[_0x57e564(0x14f)]?JSON['parse'](_0xdbcf6['gatewaySettings']):null,'publicKey':_0xdbcf6[_0x57e564(0x111)],'webhookUrl':_0xdbcf6[_0x57e564(0x146)]?.['webhookUrl']||null,'webhookEvents':_0x201ea4,'wallets':{'usdtPolygonWallet':_0xdbcf6[_0x57e564(0x16b)],'usdtTrcWallet':_0xdbcf6[_0x57e564(0x14e)],'usdtErcWallet':_0xdbcf6[_0x57e564(0x14d)],'usdcPolygonWallet':_0xdbcf6[_0x57e564(0x100)]},'status':_0xdbcf6[_0x57e564(0x12e)],'createdAt':_0xdbcf6[_0x57e564(0x102)]};}async['updateShopProfile'](_0x212059,_0x5b733c){const _0x572983=a58_0x2a0001,_0x20fa49={};_0x5b733c[_0x572983(0x15b)]&&(_0x20fa49['name']=_0x5b733c[_0x572983(0x15b)]);_0x5b733c['telegramId']!==undefined&&(_0x20fa49['telegram']=_0x5b733c['telegramId']||null);_0x5b733c[_0x572983(0x16f)]&&(_0x20fa49[_0x572983(0x127)]=_0x5b733c[_0x572983(0x16f)]);_0x5b733c[_0x572983(0x174)]&&(_0x20fa49['paymentGateways']=JSON[_0x572983(0x124)](_0x5b733c[_0x572983(0x174)]));_0x5b733c[_0x572983(0x14f)]&&(_0x20fa49[_0x572983(0x14f)]=JSON[_0x572983(0x124)](_0x5b733c[_0x572983(0x14f)]));_0x5b733c[_0x572983(0x17f)]&&(_0x5b733c[_0x572983(0x17f)][_0x572983(0x16b)]!==undefined&&(_0x20fa49[_0x572983(0x16b)]=_0x5b733c['wallets'][_0x572983(0x16b)]||null),_0x5b733c[_0x572983(0x17f)][_0x572983(0x14e)]!==undefined&&(_0x20fa49['usdtTrcWallet']=_0x5b733c[_0x572983(0x17f)][_0x572983(0x14e)]||null),_0x5b733c[_0x572983(0x17f)][_0x572983(0x14d)]!==undefined&&(_0x20fa49[_0x572983(0x14d)]=_0x5b733c['wallets'][_0x572983(0x14d)]||null),_0x5b733c[_0x572983(0x17f)][_0x572983(0x100)]!==undefined&&(_0x20fa49[_0x572983(0x100)]=_0x5b733c['wallets'][_0x572983(0x100)]||null));const _0x34176a=await database_1['default'][_0x572983(0x193)]['update']({'where':{'id':_0x212059},'data':_0x20fa49,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x1bdf6d=[];if(_0x34176a[_0x572983(0x146)]?.[_0x572983(0x190)])try{_0x1bdf6d=Array[_0x572983(0x148)](_0x34176a['settings'][_0x572983(0x190)])?_0x34176a[_0x572983(0x146)][_0x572983(0x190)]:JSON[_0x572983(0x18b)](_0x34176a[_0x572983(0x146)][_0x572983(0x190)]);}catch(_0x35870){console[_0x572983(0x160)]('Error\x20parsing\x20webhook\x20events:',_0x35870),_0x1bdf6d=[];}return{'id':_0x34176a['id'],'fullName':_0x34176a[_0x572983(0x17c)],'username':_0x34176a[_0x572983(0x13c)],'telegramId':_0x34176a[_0x572983(0x118)],'merchantUrl':_0x34176a[_0x572983(0x127)],'gateways':_0x34176a[_0x572983(0x19f)]?JSON['parse'](_0x34176a[_0x572983(0x19f)]):null,'gatewaySettings':_0x34176a[_0x572983(0x14f)]?JSON[_0x572983(0x18b)](_0x34176a[_0x572983(0x14f)]):null,'publicKey':_0x34176a[_0x572983(0x111)],'webhookUrl':_0x34176a['settings']?.[_0x572983(0x10e)]||null,'webhookEvents':_0x1bdf6d,'wallets':{'usdtPolygonWallet':_0x34176a[_0x572983(0x16b)],'usdtTrcWallet':_0x34176a[_0x572983(0x14e)],'usdtErcWallet':_0x34176a['usdtErcWallet'],'usdcPolygonWallet':_0x34176a[_0x572983(0x100)]},'status':_0x34176a[_0x572983(0x12e)],'createdAt':_0x34176a[_0x572983(0x102)]};}async[a58_0x2a0001(0x129)](_0x241771,_0x2b47b6){const _0x2ea5a8=a58_0x2a0001,_0x29efb7={};_0x2b47b6[_0x2ea5a8(0x16b)]!==undefined&&(_0x29efb7[_0x2ea5a8(0x16b)]=_0x2b47b6[_0x2ea5a8(0x16b)]||null),_0x2b47b6['usdtTrcWallet']!==undefined&&(_0x29efb7[_0x2ea5a8(0x14e)]=_0x2b47b6[_0x2ea5a8(0x14e)]||null),_0x2b47b6['usdtErcWallet']!==undefined&&(_0x29efb7[_0x2ea5a8(0x14d)]=_0x2b47b6[_0x2ea5a8(0x14d)]||null),_0x2b47b6['usdcPolygonWallet']!==undefined&&(_0x29efb7[_0x2ea5a8(0x100)]=_0x2b47b6[_0x2ea5a8(0x100)]||null),await database_1[_0x2ea5a8(0x149)]['shop'][_0x2ea5a8(0x125)]({'where':{'id':_0x241771},'data':_0x29efb7});}async[a58_0x2a0001(0x189)](_0x2f383d){const _0x47ef13=a58_0x2a0001,_0x24162c=await database_1['default'][_0x47ef13(0x193)][_0x47ef13(0xff)]({'where':{'id':_0x2f383d},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x24162c?.[_0x47ef13(0x146)]?.[_0x47ef13(0x10e)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x334004={'event':_0x47ef13(0x161),'payment':{'id':_0x47ef13(0x198),'order_id':_0x47ef13(0x172),'gateway':_0x47ef13(0x161),'amount':0x64,'currency':_0x47ef13(0x136),'status':_0x47ef13(0x11b),'created_at':new Date()[_0x47ef13(0xf6)]()}};try{const _0x4c3492=await fetch(_0x24162c[_0x47ef13(0x146)][_0x47ef13(0x10e)],{'method':_0x47ef13(0xfc),'headers':{'Content-Type':_0x47ef13(0x12c),'User-Agent':_0x47ef13(0x12f)},'body':JSON[_0x47ef13(0x124)](_0x334004)});return _0x4c3492['ok']?{'success':!![],'message':_0x47ef13(0x165)+_0x4c3492[_0x47ef13(0x12e)]+')'}:{'success':![],'message':_0x47ef13(0x131)+_0x4c3492['status']+'\x20'+_0x4c3492['statusText']};}catch(_0x3773a9){return{'success':![],'message':_0x47ef13(0x13a)+(_0x3773a9 instanceof Error?_0x3773a9[_0x47ef13(0x163)]:_0x47ef13(0x19d))};}}async[a58_0x2a0001(0x170)](_0x14b721){const _0x1749a6=a58_0x2a0001;return this[_0x1749a6(0x18c)][_0x1749a6(0x11d)]({'public_key':'','gateway':_0x14b721[_0x1749a6(0x137)],'order_id':undefined,'amount':_0x14b721[_0x1749a6(0x126)],'currency':_0x14b721[_0x1749a6(0x175)],'source_currency':_0x14b721['sourceCurrency'],'usage':_0x14b721['usage'],'expires_at':_0x14b721[_0x1749a6(0x155)]?.[_0x1749a6(0xf6)](),'success_url':_0x14b721['redirectUrl'],'fail_url':_0x14b721[_0x1749a6(0x115)],'customer_email':_0x14b721[_0x1749a6(0x109)],'customer_name':_0x14b721[_0x1749a6(0x133)],'country':_0x14b721['country'],'language':_0x14b721['language'],'amount_is_editable':_0x14b721[_0x1749a6(0x119)],'max_payments':_0x14b721[_0x1749a6(0x16e)],'customer':_0x14b721[_0x1749a6(0x104)]});}async['getPayments'](_0xeb1dc4,_0x422bcd){const _0x4339d5=a58_0x2a0001;return this[_0x4339d5(0x18c)][_0x4339d5(0xfe)](_0xeb1dc4,_0x422bcd);}async[a58_0x2a0001(0x194)](_0x524213,_0x1cfe6e){const _0x16c875=a58_0x2a0001;return this[_0x16c875(0x18c)]['getPaymentByShopAndId'](_0x524213,_0x1cfe6e);}async[a58_0x2a0001(0x166)](_0x3eb363,_0x2a0ff2,_0x2111a1){const _0x11c6a2=a58_0x2a0001,_0x21226a=await database_1[_0x11c6a2(0x149)][_0x11c6a2(0xf4)][_0x11c6a2(0xf7)]({'where':{'id':_0x2a0ff2,'shopId':_0x3eb363}});if(!_0x21226a)throw new Error(_0x11c6a2(0x182));const _0x296392=await database_1[_0x11c6a2(0x149)]['payment'][_0x11c6a2(0x125)]({'where':{'id':_0x2a0ff2},'data':{..._0x2111a1,'updatedAt':new Date()}});return _0x296392;}async['deletePayment'](_0x5aca56,_0x422b1f){const _0x5acc65=a58_0x2a0001,_0x16f866=await database_1[_0x5acc65(0x149)][_0x5acc65(0xf4)][_0x5acc65(0xf7)]({'where':{'id':_0x422b1f,'shopId':_0x5aca56}});if(!_0x16f866)throw new Error(_0x5acc65(0x182));await database_1[_0x5acc65(0x149)][_0x5acc65(0xf4)][_0x5acc65(0x152)]({'where':{'id':_0x422b1f}});}['formatNetworkName'](_0x37d6ea){const _0x44dc6d=a58_0x2a0001,_0x5f3216={'polygon':'USDT\x20Polygon','trc20':'USDT\x20TRC20','erc20':_0x44dc6d(0x110),'bsc':_0x44dc6d(0x10f),'polygon_usdc':_0x44dc6d(0x173)};return _0x5f3216[_0x37d6ea]||_0x37d6ea;}async[a58_0x2a0001(0x159)](_0x404fc2,_0x568b68){const _0x48d5bc=a58_0x2a0001,{page:_0x42c70e,limit:_0x2968f2,status:_0x3144d8,method:_0x25d331,network:_0x1201e1,dateFrom:_0x1e2915,dateTo:_0x597757,periodFrom:_0x332c45,periodTo:_0x6785fc}=_0x568b68,_0x1eb873=(_0x42c70e-0x1)*_0x2968f2;console[_0x48d5bc(0x19b)](_0x48d5bc(0x17b),_0x568b68);const _0x33181e={'shopId':_0x404fc2};_0x3144d8&&(_0x33181e[_0x48d5bc(0x12e)]=_0x3144d8[_0x48d5bc(0x169)](),console[_0x48d5bc(0x19b)]('üìä\x20Status\x20filter:\x20'+_0x3144d8[_0x48d5bc(0x169)]()));if(_0x25d331)_0x33181e[_0x48d5bc(0x108)]=_0x25d331,console[_0x48d5bc(0x19b)](_0x48d5bc(0x184)+_0x25d331);else _0x1201e1&&(_0x33181e[_0x48d5bc(0x108)]=_0x1201e1,console[_0x48d5bc(0x19b)](_0x48d5bc(0x196)+_0x1201e1));if(_0x1e2915||_0x597757||_0x332c45||_0x6785fc){_0x33181e[_0x48d5bc(0x102)]={};if(_0x332c45){const _0xf241cd=new Date(_0x332c45);_0xf241cd['setHours'](0x0,0x0,0x0,0x0),_0x33181e[_0x48d5bc(0x102)]['gte']=_0xf241cd,console[_0x48d5bc(0x19b)](_0x48d5bc(0x151)+_0xf241cd[_0x48d5bc(0xf6)]());}else{if(_0x1e2915){const _0x7a60d3=new Date(_0x1e2915);_0x7a60d3['setHours'](0x0,0x0,0x0,0x0),_0x33181e[_0x48d5bc(0x102)][_0x48d5bc(0x183)]=_0x7a60d3,console['log'](_0x48d5bc(0x12b)+_0x7a60d3[_0x48d5bc(0xf6)]());}}if(_0x6785fc){const _0x6f72dd=new Date(_0x6785fc);_0x6f72dd[_0x48d5bc(0x162)](0x17,0x3b,0x3b,0x3e7),_0x33181e[_0x48d5bc(0x102)][_0x48d5bc(0x12a)]=_0x6f72dd,console[_0x48d5bc(0x19b)](_0x48d5bc(0x140)+_0x6f72dd['toISOString']());}else{if(_0x597757){const _0x381b0b=new Date(_0x597757);_0x381b0b[_0x48d5bc(0x162)](0x17,0x3b,0x3b,0x3e7),_0x33181e[_0x48d5bc(0x102)][_0x48d5bc(0x12a)]=_0x381b0b,console[_0x48d5bc(0x19b)](_0x48d5bc(0x142)+_0x381b0b['toISOString']());}}}console[_0x48d5bc(0x19b)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x48d5bc(0x124)](_0x33181e,null,0x2));const [_0x2cc9e4,_0x537258]=await Promise['all']([database_1['default'][_0x48d5bc(0x13d)][_0x48d5bc(0xfa)]({'where':_0x33181e,'skip':_0x1eb873,'take':_0x2968f2,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x48d5bc(0x149)][_0x48d5bc(0x13d)][_0x48d5bc(0x114)]({'where':_0x33181e})]);return{'payouts':_0x2cc9e4[_0x48d5bc(0x176)](_0x4f1fb5=>{const _0x1b5c67=_0x48d5bc;let _0x2457f0=null;switch(_0x4f1fb5['network']){case _0x1b5c67(0x171):_0x2457f0=_0x4f1fb5['shop'][_0x1b5c67(0x16b)];break;case _0x1b5c67(0x185):_0x2457f0=_0x4f1fb5[_0x1b5c67(0x193)]['usdtTrcWallet'];break;case'erc20':_0x2457f0=_0x4f1fb5[_0x1b5c67(0x193)]['usdtErcWallet'];break;case'polygon_usdc':_0x2457f0=_0x4f1fb5['shop'][_0x1b5c67(0x100)];break;}return{'id':_0x4f1fb5['id'],'amount':_0x4f1fb5['amount'],'network':this[_0x1b5c67(0x138)](_0x4f1fb5[_0x1b5c67(0x108)]),'wallet':_0x2457f0,'status':_0x4f1fb5['status'],'txid':_0x4f1fb5[_0x1b5c67(0x144)],'notes':_0x4f1fb5[_0x1b5c67(0x101)],'periodFrom':_0x4f1fb5['periodFrom'],'periodTo':_0x4f1fb5[_0x1b5c67(0x156)],'createdAt':_0x4f1fb5[_0x1b5c67(0x102)],'paidAt':_0x4f1fb5[_0x1b5c67(0x11f)]};}),'pagination':{'page':_0x42c70e,'limit':_0x2968f2,'total':_0x537258,'totalPages':Math[_0x48d5bc(0x17d)](_0x537258/_0x2968f2)}};}async[a58_0x2a0001(0x187)](_0x1c2e75,_0x2f85af){const _0x116726=a58_0x2a0001,_0x4f0c7a=await database_1[_0x116726(0x149)][_0x116726(0x13d)][_0x116726(0xf7)]({'where':{'id':_0x2f85af,'shopId':_0x1c2e75}});if(!_0x4f0c7a)return null;return{'id':_0x4f0c7a['id'],'amount':_0x4f0c7a['amount'],'network':_0x4f0c7a[_0x116726(0x108)],'status':_0x4f0c7a[_0x116726(0x12e)],'txid':_0x4f0c7a[_0x116726(0x144)],'notes':_0x4f0c7a[_0x116726(0x101)],'createdAt':_0x4f0c7a[_0x116726(0x102)],'paidAt':_0x4f0c7a[_0x116726(0x11f)]};}async[a58_0x2a0001(0x145)](_0x4041b9,_0x2c78fb){const _0xb66c13=a58_0x2a0001,_0x493ce9=new Date();let _0x2042b2,_0x4f4af3;switch(_0x2c78fb){case _0xb66c13(0x13f):case _0xb66c13(0x18f):const _0x5982cc=new Date(_0x493ce9);_0x5982cc[_0xb66c13(0x178)](_0x5982cc['getDate']()-0x1),_0x2042b2=new Date(_0x5982cc),_0x2042b2[_0xb66c13(0x162)](0x0,0x0,0x0,0x0),_0x4f4af3=new Date(_0x5982cc),_0x4f4af3[_0xb66c13(0x162)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x2042b2=new Date(_0x493ce9[_0xb66c13(0x188)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xb66c13(0x195):_0x2042b2=new Date(_0x493ce9['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xb66c13(0x19a):_0x2042b2=new Date(_0x493ce9[_0xb66c13(0x188)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2042b2=new Date(_0x493ce9[_0xb66c13(0x188)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x2f2830={'gte':_0x2042b2};_0x4f4af3&&(_0x2f2830['lte']=_0x4f4af3);const [_0x45f00e,_0x494649,_0x21f3c3,_0x361a81,_0x30026b,_0x21b0bb]=await Promise[_0xb66c13(0x177)]([database_1[_0xb66c13(0x149)]['payout'][_0xb66c13(0x114)]({'where':{'shopId':_0x4041b9,'createdAt':_0x2f2830}}),database_1[_0xb66c13(0x149)]['payout'][_0xb66c13(0x114)]({'where':{'shopId':_0x4041b9,'status':'COMPLETED','createdAt':_0x2f2830}}),database_1[_0xb66c13(0x149)]['payout'][_0xb66c13(0x114)]({'where':{'shopId':_0x4041b9,'status':_0xb66c13(0x15d),'createdAt':_0x2f2830}}),database_1[_0xb66c13(0x149)][_0xb66c13(0x13d)][_0xb66c13(0x114)]({'where':{'shopId':_0x4041b9,'status':_0xb66c13(0x117),'createdAt':_0x2f2830}}),database_1['default'][_0xb66c13(0x13d)][_0xb66c13(0xfa)]({'where':{'shopId':_0x4041b9,'createdAt':_0x2f2830},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0xb66c13(0x149)][_0xb66c13(0x13d)][_0xb66c13(0xfa)]({'where':{'shopId':_0x4041b9},'take':0xa,'orderBy':{'createdAt':_0xb66c13(0x11e)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x1f526d=_0x30026b[_0xb66c13(0x123)]((_0x440159,_0x5b0b94)=>_0x440159+_0x5b0b94[_0xb66c13(0x126)],0x0),_0x2cb05e=_0x30026b['filter'](_0x9d083a=>_0x9d083a[_0xb66c13(0x12e)]===_0xb66c13(0x103))[_0xb66c13(0x123)]((_0x45bc5c,_0x30c8a9)=>_0x45bc5c+_0x30c8a9['amount'],0x0),_0x2d28fe=_0x30026b[_0xb66c13(0x168)](_0x78012=>_0x78012['status']===_0xb66c13(0x15d))['reduce']((_0x3f44b1,_0x8a6471)=>_0x3f44b1+_0x8a6471[_0xb66c13(0x126)],0x0),_0x3ad8b6=_0x30026b[_0xb66c13(0x123)]((_0x571593,_0x21847d)=>{const _0x7a027e=_0xb66c13;return _0x571593[_0x21847d[_0x7a027e(0x108)]]=(_0x571593[_0x21847d[_0x7a027e(0x108)]]||0x0)+0x1,_0x571593;},{}),_0x1657e9=_0x30026b[_0xb66c13(0x123)]((_0x5766f1,_0x57f137)=>{const _0xd4aba=_0xb66c13;return _0x5766f1[_0x57f137[_0xd4aba(0x12e)]]=(_0x5766f1[_0x57f137[_0xd4aba(0x12e)]]||0x0)+0x1,_0x5766f1;},{});return{'totalPayouts':_0x45f00e,'completedPayouts':_0x494649,'pendingPayouts':_0x21f3c3,'rejectedPayouts':_0x361a81,'totalAmount':_0x1f526d,'completedAmount':_0x2cb05e,'pendingAmount':_0x2d28fe,'payoutsByMethod':_0x3ad8b6,'payoutsByStatus':_0x1657e9,'recentPayouts':_0x21b0bb['map'](_0x117fc6=>({'id':_0x117fc6['id'],'shopId':_0x4041b9,'amount':_0x117fc6[_0xb66c13(0x126)],'method':_0x117fc6[_0xb66c13(0x108)],'status':_0x117fc6[_0xb66c13(0x12e)],'txid':_0x117fc6['txid'],'createdAt':_0x117fc6[_0xb66c13(0x102)],'paidAt':_0x117fc6[_0xb66c13(0x11f)]}))};}async[a58_0x2a0001(0x13b)](_0x16504a){const _0x241184=a58_0x2a0001;console['log'](_0x241184(0x14c)+_0x16504a+_0x241184(0x139));const _0x431d84=await database_1['default'][_0x241184(0x193)][_0x241184(0xff)]({'where':{'id':_0x16504a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x431d84)throw new Error(_0x241184(0x154));const _0x35d4b9=new Date(),_0x314e99=new Date(_0x35d4b9[_0x241184(0x18d)](),_0x35d4b9[_0x241184(0x186)](),0x1),_0x5d4f0=new Date(_0x35d4b9[_0x241184(0x18d)](),_0x35d4b9['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4d9062=await database_1[_0x241184(0x149)][_0x241184(0x13d)][_0x241184(0x105)]({'_sum':{'amount':!![]},'where':{'shopId':_0x16504a,'createdAt':{'gte':_0x314e99,'lte':_0x5d4f0},'status':_0x241184(0x103)}}),_0x5991f2=_0x4d9062[_0x241184(0x10b)][_0x241184(0x126)]||0x0,_0x34b1b8={'availableBalance':Math['round'](_0x431d84[_0x241184(0x14a)]*0x64)/0x64,'totalPaidOut':Math[_0x241184(0xf5)](_0x431d84[_0x241184(0xf8)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x431d84[_0x241184(0x14a)]*0x64)/0x64,'thisMonth':Math[_0x241184(0xf5)](_0x5991f2*0x64)/0x64};return console['log']('üìä\x20Shop\x20'+_0x431d84[_0x241184(0x13c)]+_0x241184(0x199)),console[_0x241184(0x19b)](_0x241184(0x128)+_0x34b1b8[_0x241184(0x107)]+'\x20USDT\x20(current\x20balance)'),console[_0x241184(0x19b)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x34b1b8[_0x241184(0xf8)]+'\x20USDT\x20(total\x20payouts)'),console[_0x241184(0x19b)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x34b1b8[_0x241184(0x167)]+_0x241184(0x197)),console[_0x241184(0x19b)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x34b1b8[_0x241184(0x134)]+'\x20USDT'),_0x34b1b8;}['getGatewayDisplayName'](_0x267014){const _0x5b9ddd=a58_0x2a0001,_0x31239c={'test_gateway':_0x5b9ddd(0x18e),'plisio':_0x5b9ddd(0x153),'rapyd':_0x5b9ddd(0x157),'noda':'Noda','cointopay':_0x5b9ddd(0x143),'klyme_eu':_0x5b9ddd(0x164),'klyme_gb':_0x5b9ddd(0x112),'klyme_de':_0x5b9ddd(0x113)};return _0x31239c[_0x267014]||_0x267014;}async['getPayoutStats'](_0x4c9f24){return this['getShopPayoutStats'](_0x4c9f24);}async[a58_0x2a0001(0x15f)](_0x497148,_0x1209ac){const _0x31c65f=a58_0x2a0001,{page:_0x3f42b7,limit:_0x1e3b79,paymentId:_0x25e829}=_0x1209ac,_0x371d06=(_0x3f42b7-0x1)*_0x1e3b79,_0x5199c3={'shopId':_0x497148};_0x25e829&&(_0x5199c3[_0x31c65f(0x179)]=_0x25e829);const [_0x352d9c,_0x22484a]=await Promise['all']([database_1['default'][_0x31c65f(0x15c)][_0x31c65f(0xfa)]({'where':_0x5199c3,'skip':_0x371d06,'take':_0x1e3b79,'orderBy':{'createdAt':_0x31c65f(0x11e)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x31c65f(0x149)][_0x31c65f(0x15c)]['count']({'where':_0x5199c3})]);return{'logs':_0x352d9c[_0x31c65f(0x176)](_0x3b84d6=>({'id':_0x3b84d6['id'],'paymentId':_0x3b84d6[_0x31c65f(0x179)],'shopId':_0x3b84d6[_0x31c65f(0x10c)],'event':_0x3b84d6['event'],'statusCode':_0x3b84d6[_0x31c65f(0x181)],'retryCount':_0x3b84d6[_0x31c65f(0x11c)],'responseBody':_0x3b84d6[_0x31c65f(0x132)],'createdAt':_0x3b84d6['createdAt'],'payment':_0x3b84d6[_0x31c65f(0xf4)]})),'pagination':{'page':_0x3f42b7,'limit':_0x1e3b79,'total':_0x22484a,'totalPages':Math[_0x31c65f(0x17d)](_0x22484a/_0x1e3b79)}};}async[a58_0x2a0001(0x10d)](_0x5af166,_0x43e2ab){const _0x157e65=a58_0x2a0001,_0x31fe15=new Date();let _0xa27b1c,_0x44329a;switch(_0x43e2ab['toLowerCase']()){case _0x157e65(0x16c):_0xa27b1c=new Date(_0x31fe15[_0x157e65(0x18d)](),_0x31fe15[_0x157e65(0x186)](),_0x31fe15[_0x157e65(0x121)](),0x0,0x0,0x0,0x0);break;case _0x157e65(0x13f):case _0x157e65(0x18f):const _0x5ef516=new Date(_0x31fe15);_0x5ef516[_0x157e65(0x178)](_0x5ef516[_0x157e65(0x121)]()-0x1),_0xa27b1c=new Date(_0x5ef516),_0xa27b1c[_0x157e65(0x162)](0x0,0x0,0x0,0x0),_0x44329a=new Date(_0x5ef516),_0x44329a[_0x157e65(0x162)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0xa27b1c=new Date(_0x31fe15['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x157e65(0x195):_0xa27b1c=new Date(_0x31fe15[_0x157e65(0x188)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0xa27b1c=new Date(_0x31fe15[_0x157e65(0x188)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xa27b1c=new Date(_0x31fe15[_0x157e65(0x188)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x48e41f={'gte':_0xa27b1c};_0x44329a&&(_0x48e41f[_0x157e65(0x12a)]=_0x44329a);const [_0x32fef2,_0x2e50e3,_0x138c9e,_0x28f96e,_0x4aa2a1]=await Promise['all']([database_1[_0x157e65(0x149)][_0x157e65(0xf4)][_0x157e65(0x114)]({'where':{'shopId':_0x5af166,'gateway':{'not':'test_gateway'},'createdAt':_0x48e41f}}),database_1[_0x157e65(0x149)][_0x157e65(0xf4)][_0x157e65(0x114)]({'where':{'shopId':_0x5af166,'gateway':{'not':_0x157e65(0x19c)},'status':'PAID','createdAt':_0x48e41f}}),database_1[_0x157e65(0x149)][_0x157e65(0xf4)][_0x157e65(0xfa)]({'where':{'shopId':_0x5af166,'gateway':{'not':'test_gateway'},'status':'PAID','createdAt':_0x48e41f},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x157e65(0x149)][_0x157e65(0xf4)][_0x157e65(0xfa)]({'where':{'shopId':_0x5af166,'gateway':{'not':_0x157e65(0x19c)}},'take':0xa,'orderBy':{'createdAt':_0x157e65(0x11e)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x157e65(0x149)][_0x157e65(0xf4)][_0x157e65(0xfa)]({'where':{'shopId':_0x5af166,'gateway':{'not':'test_gateway'},'createdAt':_0x48e41f},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x47e8bf=0x0;for(const _0x1a9dde of _0x138c9e){if(_0x1a9dde[_0x157e65(0x135)])_0x47e8bf+=_0x1a9dde[_0x157e65(0x135)];else{const _0x5d29c9=await currencyService_1['currencyService']['convertToUSDT'](_0x1a9dde[_0x157e65(0x126)],_0x1a9dde[_0x157e65(0x175)]);_0x47e8bf+=_0x5d29c9;}}const _0x4ab5b1=this[_0x157e65(0x191)](_0x4aa2a1,_0xa27b1c,_0x44329a||_0x31fe15),_0x4619ea=_0x32fef2>0x0?_0x2e50e3/_0x32fef2*0x64:0x0;return{'totalPayments':_0x32fef2,'successfulPayments':_0x2e50e3,'totalRevenue':Math[_0x157e65(0xf5)](_0x47e8bf*0x64)/0x64,'conversionRate':Math[_0x157e65(0xf5)](_0x4619ea*0x64)/0x64,'dailyRevenue':_0x4ab5b1[_0x157e65(0x180)],'dailyPayments':_0x4ab5b1[_0x157e65(0x130)],'recentPayments':_0x28f96e[_0x157e65(0x176)](_0xe5f1a7=>({'id':_0xe5f1a7['id'],'gateway':_0xe5f1a7[_0x157e65(0x137)],'amount':_0xe5f1a7[_0x157e65(0x126)],'currency':_0xe5f1a7[_0x157e65(0x175)],'status':_0xe5f1a7[_0x157e65(0x12e)],'createdAt':_0xe5f1a7[_0x157e65(0x102)]}))};}[a58_0x2a0001(0x191)](_0x4dc5f4,_0x1e05d1,_0x2b43b0){const _0x8a18cb=a58_0x2a0001,_0x3ae1f3=new Map(),_0x13092c=new Date(_0x1e05d1);while(_0x13092c<=_0x2b43b0){const _0xd46c92=_0x13092c[_0x8a18cb(0xf6)]()[_0x8a18cb(0x11a)]('T')[0x0];_0x3ae1f3[_0x8a18cb(0x12d)](_0xd46c92,{'revenue':0x0,'count':0x0}),_0x13092c['setDate'](_0x13092c[_0x8a18cb(0x121)]()+0x1);}for(const _0x4f0530 of _0x4dc5f4){const _0x2ca8e8=_0x4f0530[_0x8a18cb(0x102)][_0x8a18cb(0xf6)]()['split']('T')[0x0],_0x29bfae=_0x3ae1f3[_0x8a18cb(0x192)](_0x2ca8e8);_0x29bfae&&(_0x29bfae[_0x8a18cb(0x114)]+=0x1,_0x4f0530['status']===_0x8a18cb(0xf9)&&_0x4f0530[_0x8a18cb(0x135)]&&(_0x29bfae[_0x8a18cb(0x116)]+=_0x4f0530['amountUSDT']));}const _0x12639d=[],_0x468ce4=[];for(const [_0x559655,_0x12467a]of _0x3ae1f3){_0x12639d[_0x8a18cb(0x122)]({'date':_0x559655,'amount':Math[_0x8a18cb(0xf5)](_0x12467a[_0x8a18cb(0x116)]*0x64)/0x64}),_0x468ce4['push']({'date':_0x559655,'count':_0x12467a['count']});}return{'dailyRevenue':_0x12639d,'dailyPayments':_0x468ce4};}}exports['ShopService']=ShopService;