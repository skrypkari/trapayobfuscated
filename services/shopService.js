'use strict';const a54_0x1f73fe=a54_0x36e9;(function(_0x506f11,_0x2d6da6){const _0x544950=a54_0x36e9,_0x2374d0=_0x506f11();while(!![]){try{const _0x3d9d9c=-parseInt(_0x544950(0x210))/0x1+-parseInt(_0x544950(0x1ef))/0x2*(-parseInt(_0x544950(0x22d))/0x3)+parseInt(_0x544950(0x1ed))/0x4+parseInt(_0x544950(0x1cf))/0x5+-parseInt(_0x544950(0x1c4))/0x6*(-parseInt(_0x544950(0x1ee))/0x7)+parseInt(_0x544950(0x231))/0x8+-parseInt(_0x544950(0x202))/0x9*(parseInt(_0x544950(0x221))/0xa);if(_0x3d9d9c===_0x2d6da6)break;else _0x2374d0['push'](_0x2374d0['shift']());}catch(_0x178f4e){_0x2374d0['push'](_0x2374d0['shift']());}}}(a54_0x4f88,0x71ecc));function a54_0x4f88(){const _0xd54f63=['üìä\x20Status\x20filter:\x20','customerName','createPayment','getPaymentByShopAndId','settings','USDT\x20TRC20','webhookLog','üìÖ\x20Period\x20start:\x20','generateDailyStatistics','üìÖ\x20Date\x20start:\x20','./currencyService','publicKey','merchantUrl','statusText','test_order_123','createdAt','application/json','getPaymentById','_sum','shop','Rapyd','asc','parse','toUpperCase','__esModule','USDC\x20Polygon','getTime','txid','delete','setHours','sourceCurrency','name','isArray','polygon','status','payout','test','gateway','update','paidAt','Payment\x20not\x20found','gte','Shop\x20not\x20found','message','paymentId','usdtErcWallet','getStatistics','telegram','count','availableBalance','usdtTrcWallet','createPublicPayment','default','push','getPaymentsByShop','country','findFirst','currency','redirectUrl','getShopProfile','90d','Plisio','210NQkGxG','COMPLETED','map','getPayments','getDate','usdcPolygonWallet','round','updateShopProfile','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','log','amountIsEditable','2859540FJXFNd','amount','getFullYear','PaymentService','\x20\x20\x20üìÖ\x20This\x20month:\x20','PENDING','toISOString','USDT\x20BSC','findMany','payment','PAID','split','error','totalPaidOut','paymentService','aggregate','get','notes','retryCount','ShopService','30d','currencyService','shopId','getGatewayDisplayName','webhookEvents','USD','getPayoutById','dailyPayments','all','expiresAt','2089264yDOHkG','14483wLVaPH','14642zNxoCe','stringify','thisMonth','gatewaySettings','filter','REJECTED','...','usage','testWebhook','USDT\x20ERC20','getPayoutStats','wallets','USDT\x20Polygon','username','paid','formatNetworkName','üìä\x20Shop\x20','Unknown\x20error','üåê\x20Network\x20filter:\x20','99VLqlQo','revenue','language','POST','erc20','telegramId','getShopPayoutStats','polygon_usdc','üìä\x20Final\x20WHERE\x20conditions:','test_gateway','periodFrom','setDate','desc','Noda','293112citgzj','webhookUrl','CoinToPay','convertToUSDT','Test\x20Gateway','üåê\x20Method\x20filter:\x20','reduce','shopUrl','getWebhookLogs','dailyRevenue','amountUSDT','set','üìÖ\x20Period\x20end:\x20','findUnique','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','network','fullName','1070200eGAVmg','\x20payout\x20statistics\x20calculated:','./paymentService','paymentGateways','lte','ceil','event','Error\x20parsing\x20webhook\x20events:','__importDefault','\x20\x20\x20üíµ\x20Available\x20balance:\x20','trc20','üìÖ\x20Date\x20end:\x20','291zscXbR','Test\x20webhook\x20sent\x20successfully\x20(','usdtPolygonWallet','\x20USDT\x20(current\x20balance)','481536CfZwwr','customer','getMonth'];a54_0x4f88=function(){return _0xd54f63;};return a54_0x4f88();}var __importDefault=this&&this[a54_0x1f73fe(0x229)]||function(_0xa47c2){return _0xa47c2&&_0xa47c2['__esModule']?_0xa47c2:{'default':_0xa47c2};};Object['defineProperty'](exports,a54_0x1f73fe(0x19e),{'value':!![]}),exports[a54_0x1f73fe(0x1e2)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a54_0x1f73fe(0x190)),paymentService_1=require(a54_0x1f73fe(0x223));function a54_0x36e9(_0xfe0b68,_0x415532){const _0x4f88b4=a54_0x4f88();return a54_0x36e9=function(_0x36e907,_0x4e18fb){_0x36e907=_0x36e907-0x186;let _0x1adbee=_0x4f88b4[_0x36e907];return _0x1adbee;},a54_0x36e9(_0xfe0b68,_0x415532);}class ShopService{constructor(){const _0x5473d2=a54_0x1f73fe;this[_0x5473d2(0x1dd)]=new paymentService_1[(_0x5473d2(0x1d2))]();}async[a54_0x1f73fe(0x1c1)](_0x303b36){const _0x5ed3da=a54_0x1f73fe,_0x1c340b=await database_1[_0x5ed3da(0x1ba)][_0x5ed3da(0x199)]['findUnique']({'where':{'id':_0x303b36},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x1c340b)throw new Error('Shop\x20not\x20found');let _0x46b90d=[];if(_0x1c340b[_0x5ed3da(0x18a)]?.[_0x5ed3da(0x1e7)])try{_0x46b90d=Array[_0x5ed3da(0x1a6)](_0x1c340b[_0x5ed3da(0x18a)][_0x5ed3da(0x1e7)])?_0x1c340b[_0x5ed3da(0x18a)][_0x5ed3da(0x1e7)]:JSON['parse'](_0x1c340b[_0x5ed3da(0x18a)][_0x5ed3da(0x1e7)]);}catch(_0x38ade5){console[_0x5ed3da(0x1db)](_0x5ed3da(0x228),_0x38ade5),_0x46b90d=[];}return{'id':_0x1c340b['id'],'fullName':_0x1c340b[_0x5ed3da(0x1a5)],'username':_0x1c340b[_0x5ed3da(0x1fc)],'telegramId':_0x1c340b[_0x5ed3da(0x1b5)],'merchantUrl':_0x1c340b['shopUrl'],'gateways':_0x1c340b[_0x5ed3da(0x224)]?JSON[_0x5ed3da(0x19c)](_0x1c340b[_0x5ed3da(0x224)]):null,'gatewaySettings':_0x1c340b[_0x5ed3da(0x1f2)]?JSON[_0x5ed3da(0x19c)](_0x1c340b[_0x5ed3da(0x1f2)]):null,'publicKey':_0x1c340b['publicKey'],'webhookUrl':_0x1c340b['settings']?.[_0x5ed3da(0x211)]||null,'webhookEvents':_0x46b90d,'wallets':{'usdtPolygonWallet':_0x1c340b[_0x5ed3da(0x22f)],'usdtTrcWallet':_0x1c340b[_0x5ed3da(0x1b8)],'usdtErcWallet':_0x1c340b['usdtErcWallet'],'usdcPolygonWallet':_0x1c340b[_0x5ed3da(0x1c9)]},'status':_0x1c340b[_0x5ed3da(0x1a8)],'createdAt':_0x1c340b['createdAt']};}async[a54_0x1f73fe(0x1cb)](_0x145e0c,_0x5e94b7){const _0x6b5db0=a54_0x1f73fe,_0x4877fe={};_0x5e94b7[_0x6b5db0(0x220)]&&(_0x4877fe['name']=_0x5e94b7[_0x6b5db0(0x220)]);_0x5e94b7['telegramId']!==undefined&&(_0x4877fe[_0x6b5db0(0x1b5)]=_0x5e94b7[_0x6b5db0(0x207)]||null);_0x5e94b7[_0x6b5db0(0x192)]&&(_0x4877fe[_0x6b5db0(0x217)]=_0x5e94b7[_0x6b5db0(0x192)]);_0x5e94b7['gateways']&&(_0x4877fe['paymentGateways']=JSON['stringify'](_0x5e94b7['gateways']));_0x5e94b7[_0x6b5db0(0x1f2)]&&(_0x4877fe[_0x6b5db0(0x1f2)]=JSON[_0x6b5db0(0x1f0)](_0x5e94b7[_0x6b5db0(0x1f2)]));_0x5e94b7[_0x6b5db0(0x1fa)]&&(_0x5e94b7[_0x6b5db0(0x1fa)][_0x6b5db0(0x22f)]!==undefined&&(_0x4877fe[_0x6b5db0(0x22f)]=_0x5e94b7['wallets']['usdtPolygonWallet']||null),_0x5e94b7['wallets'][_0x6b5db0(0x1b8)]!==undefined&&(_0x4877fe[_0x6b5db0(0x1b8)]=_0x5e94b7[_0x6b5db0(0x1fa)][_0x6b5db0(0x1b8)]||null),_0x5e94b7[_0x6b5db0(0x1fa)][_0x6b5db0(0x1b3)]!==undefined&&(_0x4877fe[_0x6b5db0(0x1b3)]=_0x5e94b7[_0x6b5db0(0x1fa)][_0x6b5db0(0x1b3)]||null),_0x5e94b7[_0x6b5db0(0x1fa)][_0x6b5db0(0x1c9)]!==undefined&&(_0x4877fe[_0x6b5db0(0x1c9)]=_0x5e94b7[_0x6b5db0(0x1fa)][_0x6b5db0(0x1c9)]||null));const _0xfce63b=await database_1[_0x6b5db0(0x1ba)][_0x6b5db0(0x199)]['update']({'where':{'id':_0x145e0c},'data':_0x4877fe,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x589b17=[];if(_0xfce63b['settings']?.['webhookEvents'])try{_0x589b17=Array[_0x6b5db0(0x1a6)](_0xfce63b[_0x6b5db0(0x18a)]['webhookEvents'])?_0xfce63b[_0x6b5db0(0x18a)][_0x6b5db0(0x1e7)]:JSON['parse'](_0xfce63b[_0x6b5db0(0x18a)][_0x6b5db0(0x1e7)]);}catch(_0x4d362e){console[_0x6b5db0(0x1db)]('Error\x20parsing\x20webhook\x20events:',_0x4d362e),_0x589b17=[];}return{'id':_0xfce63b['id'],'fullName':_0xfce63b['name'],'username':_0xfce63b['username'],'telegramId':_0xfce63b[_0x6b5db0(0x1b5)],'merchantUrl':_0xfce63b[_0x6b5db0(0x217)],'gateways':_0xfce63b[_0x6b5db0(0x224)]?JSON[_0x6b5db0(0x19c)](_0xfce63b[_0x6b5db0(0x224)]):null,'gatewaySettings':_0xfce63b[_0x6b5db0(0x1f2)]?JSON[_0x6b5db0(0x19c)](_0xfce63b[_0x6b5db0(0x1f2)]):null,'publicKey':_0xfce63b[_0x6b5db0(0x191)],'webhookUrl':_0xfce63b[_0x6b5db0(0x18a)]?.[_0x6b5db0(0x211)]||null,'webhookEvents':_0x589b17,'wallets':{'usdtPolygonWallet':_0xfce63b[_0x6b5db0(0x22f)],'usdtTrcWallet':_0xfce63b[_0x6b5db0(0x1b8)],'usdtErcWallet':_0xfce63b[_0x6b5db0(0x1b3)],'usdcPolygonWallet':_0xfce63b[_0x6b5db0(0x1c9)]},'status':_0xfce63b['status'],'createdAt':_0xfce63b['createdAt']};}async['updateWallets'](_0x4b917d,_0x43bb69){const _0x6c355=a54_0x1f73fe,_0x2077f9={};_0x43bb69['usdtPolygonWallet']!==undefined&&(_0x2077f9[_0x6c355(0x22f)]=_0x43bb69[_0x6c355(0x22f)]||null),_0x43bb69[_0x6c355(0x1b8)]!==undefined&&(_0x2077f9[_0x6c355(0x1b8)]=_0x43bb69[_0x6c355(0x1b8)]||null),_0x43bb69[_0x6c355(0x1b3)]!==undefined&&(_0x2077f9[_0x6c355(0x1b3)]=_0x43bb69[_0x6c355(0x1b3)]||null),_0x43bb69[_0x6c355(0x1c9)]!==undefined&&(_0x2077f9[_0x6c355(0x1c9)]=_0x43bb69['usdcPolygonWallet']||null),await database_1[_0x6c355(0x1ba)][_0x6c355(0x199)][_0x6c355(0x1ac)]({'where':{'id':_0x4b917d},'data':_0x2077f9});}async[a54_0x1f73fe(0x1f7)](_0x5265f4){const _0x20fd76=a54_0x1f73fe,_0x349e42=await database_1['default'][_0x20fd76(0x199)]['findUnique']({'where':{'id':_0x5265f4},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x349e42?.[_0x20fd76(0x18a)]?.[_0x20fd76(0x211)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x2ca93d={'event':_0x20fd76(0x1aa),'payment':{'id':'test_payment_123','order_id':_0x20fd76(0x194),'gateway':'test','amount':0x64,'currency':_0x20fd76(0x1e8),'status':_0x20fd76(0x1fd),'created_at':new Date()[_0x20fd76(0x1d5)]()}};try{const _0x5e9c47=await fetch(_0x349e42[_0x20fd76(0x18a)][_0x20fd76(0x211)],{'method':_0x20fd76(0x205),'headers':{'Content-Type':_0x20fd76(0x196),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON['stringify'](_0x2ca93d)});return _0x5e9c47['ok']?{'success':!![],'message':_0x20fd76(0x22e)+_0x5e9c47[_0x20fd76(0x1a8)]+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x5e9c47[_0x20fd76(0x1a8)]+'\x20'+_0x5e9c47[_0x20fd76(0x193)]};}catch(_0x54fe9b){return{'success':![],'message':'Failed\x20to\x20send\x20webhook:\x20'+(_0x54fe9b instanceof Error?_0x54fe9b[_0x20fd76(0x1b1)]:_0x20fd76(0x200))};}}async[a54_0x1f73fe(0x188)](_0x1cb040){const _0x22cfc8=a54_0x1f73fe;return this[_0x22cfc8(0x1dd)][_0x22cfc8(0x1b9)]({'public_key':'','gateway':_0x1cb040['gateway'],'order_id':undefined,'amount':_0x1cb040[_0x22cfc8(0x1d0)],'currency':_0x1cb040['currency'],'source_currency':_0x1cb040[_0x22cfc8(0x1a4)],'usage':_0x1cb040[_0x22cfc8(0x1f6)],'expires_at':_0x1cb040[_0x22cfc8(0x1ec)]?.[_0x22cfc8(0x1d5)](),'success_url':_0x1cb040[_0x22cfc8(0x1c0)],'fail_url':_0x1cb040[_0x22cfc8(0x1c0)],'customer_email':_0x1cb040['customerEmail'],'customer_name':_0x1cb040[_0x22cfc8(0x187)],'country':_0x1cb040[_0x22cfc8(0x1bd)],'language':_0x1cb040[_0x22cfc8(0x204)],'amount_is_editable':_0x1cb040[_0x22cfc8(0x1ce)],'max_payments':_0x1cb040['maxPayments'],'customer':_0x1cb040[_0x22cfc8(0x232)]});}async[a54_0x1f73fe(0x1c7)](_0x1155c1,_0x33a6dd){const _0x13bc16=a54_0x1f73fe;return this[_0x13bc16(0x1dd)][_0x13bc16(0x1bc)](_0x1155c1,_0x33a6dd);}async[a54_0x1f73fe(0x197)](_0x549378,_0x296a37){const _0x1810bf=a54_0x1f73fe;return this[_0x1810bf(0x1dd)][_0x1810bf(0x189)](_0x549378,_0x296a37);}async['updatePayment'](_0x45755b,_0x52f3cb,_0x4853fe){const _0x3c78a8=a54_0x1f73fe,_0x16e74c=await database_1[_0x3c78a8(0x1ba)][_0x3c78a8(0x1d8)]['findFirst']({'where':{'id':_0x52f3cb,'shopId':_0x45755b}});if(!_0x16e74c)throw new Error(_0x3c78a8(0x1ae));const _0x4b9b33=await database_1[_0x3c78a8(0x1ba)][_0x3c78a8(0x1d8)][_0x3c78a8(0x1ac)]({'where':{'id':_0x52f3cb},'data':{..._0x4853fe,'updatedAt':new Date()}});return _0x4b9b33;}async['deletePayment'](_0x2957d7,_0x1f9504){const _0x3447dd=a54_0x1f73fe,_0x135483=await database_1[_0x3447dd(0x1ba)][_0x3447dd(0x1d8)]['findFirst']({'where':{'id':_0x1f9504,'shopId':_0x2957d7}});if(!_0x135483)throw new Error(_0x3447dd(0x1ae));await database_1[_0x3447dd(0x1ba)]['payment'][_0x3447dd(0x1a2)]({'where':{'id':_0x1f9504}});}[a54_0x1f73fe(0x1fe)](_0x389c70){const _0x4a0816=a54_0x1f73fe,_0x5e7c8a={'polygon':_0x4a0816(0x1fb),'trc20':_0x4a0816(0x18b),'erc20':_0x4a0816(0x1f8),'bsc':_0x4a0816(0x1d6),'polygon_usdc':_0x4a0816(0x19f)};return _0x5e7c8a[_0x389c70]||_0x389c70;}async['getPayouts'](_0x174cc6,_0x4a92c7){const _0x90d247=a54_0x1f73fe,{page:_0x43d75f,limit:_0x3fa568,status:_0x14f24e,method:_0x2f071d,network:_0x4a3b8b,dateFrom:_0x431ffd,dateTo:_0x208aeb,periodFrom:_0x2c566e,periodTo:_0x3f5342}=_0x4a92c7,_0x4ee574=(_0x43d75f-0x1)*_0x3fa568;console[_0x90d247(0x1cd)]('üí∞\x20Getting\x20payouts\x20with\x20filters:',_0x4a92c7);const _0x493e5a={'shopId':_0x174cc6};_0x14f24e&&(_0x493e5a[_0x90d247(0x1a8)]=_0x14f24e[_0x90d247(0x19d)](),console[_0x90d247(0x1cd)](_0x90d247(0x186)+_0x14f24e[_0x90d247(0x19d)]()));if(_0x2f071d)_0x493e5a[_0x90d247(0x21f)]=_0x2f071d,console[_0x90d247(0x1cd)](_0x90d247(0x215)+_0x2f071d);else _0x4a3b8b&&(_0x493e5a[_0x90d247(0x21f)]=_0x4a3b8b,console[_0x90d247(0x1cd)](_0x90d247(0x201)+_0x4a3b8b));if(_0x431ffd||_0x208aeb||_0x2c566e||_0x3f5342){_0x493e5a[_0x90d247(0x195)]={};if(_0x2c566e){const _0x1f2e3d=new Date(_0x2c566e);_0x1f2e3d[_0x90d247(0x1a3)](0x0,0x0,0x0,0x0),_0x493e5a[_0x90d247(0x195)][_0x90d247(0x1af)]=_0x1f2e3d,console[_0x90d247(0x1cd)](_0x90d247(0x18d)+_0x1f2e3d[_0x90d247(0x1d5)]());}else{if(_0x431ffd){const _0x3cc821=new Date(_0x431ffd);_0x3cc821[_0x90d247(0x1a3)](0x0,0x0,0x0,0x0),_0x493e5a['createdAt']['gte']=_0x3cc821,console['log'](_0x90d247(0x18f)+_0x3cc821[_0x90d247(0x1d5)]());}}if(_0x3f5342){const _0x5216d5=new Date(_0x3f5342);_0x5216d5['setHours'](0x17,0x3b,0x3b,0x3e7),_0x493e5a[_0x90d247(0x195)][_0x90d247(0x225)]=_0x5216d5,console[_0x90d247(0x1cd)](_0x90d247(0x21c)+_0x5216d5[_0x90d247(0x1d5)]());}else{if(_0x208aeb){const _0x33196d=new Date(_0x208aeb);_0x33196d[_0x90d247(0x1a3)](0x17,0x3b,0x3b,0x3e7),_0x493e5a[_0x90d247(0x195)][_0x90d247(0x225)]=_0x33196d,console[_0x90d247(0x1cd)](_0x90d247(0x22c)+_0x33196d[_0x90d247(0x1d5)]());}}}console[_0x90d247(0x1cd)](_0x90d247(0x20a),JSON[_0x90d247(0x1f0)](_0x493e5a,null,0x2));const [_0x380f4f,_0x5a2fd5]=await Promise[_0x90d247(0x1eb)]([database_1[_0x90d247(0x1ba)][_0x90d247(0x1a9)][_0x90d247(0x1d7)]({'where':_0x493e5a,'skip':_0x4ee574,'take':_0x3fa568,'orderBy':{'createdAt':_0x90d247(0x20e)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x90d247(0x1a9)]['count']({'where':_0x493e5a})]);return{'payouts':_0x380f4f['map'](_0xc7d4c9=>{const _0x5030f=_0x90d247;let _0x11cb6c=null;switch(_0xc7d4c9[_0x5030f(0x21f)]){case _0x5030f(0x1a7):_0x11cb6c=_0xc7d4c9[_0x5030f(0x199)][_0x5030f(0x22f)];break;case _0x5030f(0x22b):_0x11cb6c=_0xc7d4c9[_0x5030f(0x199)][_0x5030f(0x1b8)];break;case _0x5030f(0x206):_0x11cb6c=_0xc7d4c9[_0x5030f(0x199)][_0x5030f(0x1b3)];break;case _0x5030f(0x209):_0x11cb6c=_0xc7d4c9[_0x5030f(0x199)][_0x5030f(0x1c9)];break;}return{'id':_0xc7d4c9['id'],'amount':_0xc7d4c9[_0x5030f(0x1d0)],'network':this[_0x5030f(0x1fe)](_0xc7d4c9['network']),'wallet':_0x11cb6c,'status':_0xc7d4c9[_0x5030f(0x1a8)],'txid':_0xc7d4c9[_0x5030f(0x1a1)],'notes':_0xc7d4c9[_0x5030f(0x1e0)],'periodFrom':_0xc7d4c9[_0x5030f(0x20c)],'periodTo':_0xc7d4c9['periodTo'],'createdAt':_0xc7d4c9[_0x5030f(0x195)],'paidAt':_0xc7d4c9['paidAt']};}),'pagination':{'page':_0x43d75f,'limit':_0x3fa568,'total':_0x5a2fd5,'totalPages':Math['ceil'](_0x5a2fd5/_0x3fa568)}};}async[a54_0x1f73fe(0x1e9)](_0x1b00ea,_0x2d1796){const _0x5d46a5=a54_0x1f73fe,_0x39defb=await database_1[_0x5d46a5(0x1ba)][_0x5d46a5(0x1a9)][_0x5d46a5(0x1be)]({'where':{'id':_0x2d1796,'shopId':_0x1b00ea}});if(!_0x39defb)return null;return{'id':_0x39defb['id'],'amount':_0x39defb['amount'],'network':_0x39defb['network'],'status':_0x39defb[_0x5d46a5(0x1a8)],'txid':_0x39defb[_0x5d46a5(0x1a1)],'notes':_0x39defb[_0x5d46a5(0x1e0)],'createdAt':_0x39defb[_0x5d46a5(0x195)],'paidAt':_0x39defb[_0x5d46a5(0x1ad)]};}async['getPayoutStatistics'](_0x47f43d,_0x10754f){const _0x20475a=a54_0x1f73fe,_0x1ce5eb=new Date();let _0x35ab4c;switch(_0x10754f){case'7d':_0x35ab4c=new Date(_0x1ce5eb[_0x20475a(0x1a0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x20475a(0x1e3):_0x35ab4c=new Date(_0x1ce5eb[_0x20475a(0x1a0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x35ab4c=new Date(_0x1ce5eb[_0x20475a(0x1a0)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x35ab4c=new Date(_0x1ce5eb[_0x20475a(0x1a0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x552b20,_0x5e67a0,_0x100a2b,_0x2db002,_0x22458f,_0x49da70]=await Promise[_0x20475a(0x1eb)]([database_1[_0x20475a(0x1ba)][_0x20475a(0x1a9)][_0x20475a(0x1b6)]({'where':{'shopId':_0x47f43d,'createdAt':{'gte':_0x35ab4c}}}),database_1['default']['payout'][_0x20475a(0x1b6)]({'where':{'shopId':_0x47f43d,'status':_0x20475a(0x1c5),'createdAt':{'gte':_0x35ab4c}}}),database_1[_0x20475a(0x1ba)][_0x20475a(0x1a9)][_0x20475a(0x1b6)]({'where':{'shopId':_0x47f43d,'status':_0x20475a(0x1d4),'createdAt':{'gte':_0x35ab4c}}}),database_1[_0x20475a(0x1ba)][_0x20475a(0x1a9)][_0x20475a(0x1b6)]({'where':{'shopId':_0x47f43d,'status':_0x20475a(0x1f4),'createdAt':{'gte':_0x35ab4c}}}),database_1['default'][_0x20475a(0x1a9)]['findMany']({'where':{'shopId':_0x47f43d,'createdAt':{'gte':_0x35ab4c}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x20475a(0x1ba)]['payout'][_0x20475a(0x1d7)]({'where':{'shopId':_0x47f43d},'take':0xa,'orderBy':{'createdAt':_0x20475a(0x20e)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x17898b=_0x22458f[_0x20475a(0x216)]((_0x196f43,_0x12ebf1)=>_0x196f43+_0x12ebf1['amount'],0x0),_0x416f16=_0x22458f['filter'](_0x184da0=>_0x184da0[_0x20475a(0x1a8)]==='COMPLETED')[_0x20475a(0x216)]((_0x1b7261,_0x2fde00)=>_0x1b7261+_0x2fde00[_0x20475a(0x1d0)],0x0),_0x26dcd0=_0x22458f[_0x20475a(0x1f3)](_0x570aec=>_0x570aec[_0x20475a(0x1a8)]==='PENDING')[_0x20475a(0x216)]((_0x1cafba,_0x312c03)=>_0x1cafba+_0x312c03[_0x20475a(0x1d0)],0x0),_0xb92d9f=_0x22458f[_0x20475a(0x216)]((_0x2abbd8,_0x34a627)=>{const _0x1a6caf=_0x20475a;return _0x2abbd8[_0x34a627[_0x1a6caf(0x21f)]]=(_0x2abbd8[_0x34a627[_0x1a6caf(0x21f)]]||0x0)+0x1,_0x2abbd8;},{}),_0x427fc1=_0x22458f[_0x20475a(0x216)]((_0x428982,_0x29ed5f)=>{const _0x1b8399=_0x20475a;return _0x428982[_0x29ed5f[_0x1b8399(0x1a8)]]=(_0x428982[_0x29ed5f['status']]||0x0)+0x1,_0x428982;},{});return{'totalPayouts':_0x552b20,'completedPayouts':_0x5e67a0,'pendingPayouts':_0x100a2b,'rejectedPayouts':_0x2db002,'totalAmount':_0x17898b,'completedAmount':_0x416f16,'pendingAmount':_0x26dcd0,'payoutsByMethod':_0xb92d9f,'payoutsByStatus':_0x427fc1,'recentPayouts':_0x49da70[_0x20475a(0x1c6)](_0x282391=>({'id':_0x282391['id'],'shopId':_0x47f43d,'amount':_0x282391[_0x20475a(0x1d0)],'method':_0x282391['network'],'status':_0x282391[_0x20475a(0x1a8)],'txid':_0x282391[_0x20475a(0x1a1)],'createdAt':_0x282391[_0x20475a(0x195)],'paidAt':_0x282391[_0x20475a(0x1ad)]}))};}async[a54_0x1f73fe(0x208)](_0x3acf50){const _0x275161=a54_0x1f73fe;console[_0x275161(0x1cd)](_0x275161(0x21e)+_0x3acf50+_0x275161(0x1f5));const _0x148858=await database_1['default'][_0x275161(0x199)][_0x275161(0x21d)]({'where':{'id':_0x3acf50},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x148858)throw new Error(_0x275161(0x1b0));const _0x4d3ce9=new Date(),_0x4c9280=new Date(_0x4d3ce9['getFullYear'](),_0x4d3ce9[_0x275161(0x233)](),0x1),_0x47479b=new Date(_0x4d3ce9[_0x275161(0x1d1)](),_0x4d3ce9[_0x275161(0x233)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x212510=await database_1[_0x275161(0x1ba)][_0x275161(0x1a9)][_0x275161(0x1de)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3acf50,'createdAt':{'gte':_0x4c9280,'lte':_0x47479b},'status':'COMPLETED'}}),_0x230944=_0x212510[_0x275161(0x198)][_0x275161(0x1d0)]||0x0,_0x3a8076={'availableBalance':Math[_0x275161(0x1ca)](_0x148858['balance']*0x64)/0x64,'totalPaidOut':Math[_0x275161(0x1ca)](_0x148858[_0x275161(0x1dc)]*0x64)/0x64,'awaitingPayout':Math[_0x275161(0x1ca)](_0x148858['balance']*0x64)/0x64,'thisMonth':Math[_0x275161(0x1ca)](_0x230944*0x64)/0x64};return console[_0x275161(0x1cd)](_0x275161(0x1ff)+_0x148858[_0x275161(0x1fc)]+_0x275161(0x222)),console[_0x275161(0x1cd)](_0x275161(0x22a)+_0x3a8076[_0x275161(0x1b7)]+_0x275161(0x230)),console['log']('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x3a8076[_0x275161(0x1dc)]+'\x20USDT\x20(total\x20payouts)'),console[_0x275161(0x1cd)](_0x275161(0x1cc)+_0x3a8076['awaitingPayout']+_0x275161(0x230)),console[_0x275161(0x1cd)](_0x275161(0x1d3)+_0x3a8076[_0x275161(0x1f1)]+'\x20USDT'),_0x3a8076;}[a54_0x1f73fe(0x1e6)](_0x771a9f){const _0x18958c=a54_0x1f73fe,_0x422366={'test_gateway':_0x18958c(0x214),'plisio':_0x18958c(0x1c3),'rapyd':_0x18958c(0x19a),'noda':_0x18958c(0x20f),'cointopay':_0x18958c(0x212),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x422366[_0x771a9f]||_0x771a9f;}async[a54_0x1f73fe(0x1f9)](_0x5ca8eb){const _0x2e7877=a54_0x1f73fe;return this[_0x2e7877(0x208)](_0x5ca8eb);}async[a54_0x1f73fe(0x218)](_0x25d81b,_0x581401){const _0x46448d=a54_0x1f73fe,{page:_0x29e8da,limit:_0xd8512c,paymentId:_0x3cb9b0}=_0x581401,_0x4171ed=(_0x29e8da-0x1)*_0xd8512c,_0x5bf5a6={'shopId':_0x25d81b};_0x3cb9b0&&(_0x5bf5a6[_0x46448d(0x1b2)]=_0x3cb9b0);const [_0x57f464,_0x121503]=await Promise[_0x46448d(0x1eb)]([database_1[_0x46448d(0x1ba)][_0x46448d(0x18c)][_0x46448d(0x1d7)]({'where':_0x5bf5a6,'skip':_0x4171ed,'take':_0xd8512c,'orderBy':{'createdAt':_0x46448d(0x20e)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x46448d(0x1ba)][_0x46448d(0x18c)][_0x46448d(0x1b6)]({'where':_0x5bf5a6})]);return{'logs':_0x57f464[_0x46448d(0x1c6)](_0xe9903d=>({'id':_0xe9903d['id'],'paymentId':_0xe9903d[_0x46448d(0x1b2)],'shopId':_0xe9903d[_0x46448d(0x1e5)],'event':_0xe9903d[_0x46448d(0x227)],'statusCode':_0xe9903d['statusCode'],'retryCount':_0xe9903d[_0x46448d(0x1e1)],'responseBody':_0xe9903d['responseBody'],'createdAt':_0xe9903d[_0x46448d(0x195)],'payment':_0xe9903d[_0x46448d(0x1d8)]})),'pagination':{'page':_0x29e8da,'limit':_0xd8512c,'total':_0x121503,'totalPages':Math[_0x46448d(0x226)](_0x121503/_0xd8512c)}};}async[a54_0x1f73fe(0x1b4)](_0x30736f,_0x1f733a){const _0xf89455=a54_0x1f73fe,_0x1e5e60=new Date();let _0x285b28;switch(_0x1f733a){case'7d':_0x285b28=new Date(_0x1e5e60[_0xf89455(0x1a0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xf89455(0x1e3):_0x285b28=new Date(_0x1e5e60[_0xf89455(0x1a0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xf89455(0x1c2):_0x285b28=new Date(_0x1e5e60['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x285b28=new Date(_0x1e5e60[_0xf89455(0x1a0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1b6324,_0x2d2026,_0x219c59,_0xeacdae,_0x3787b1]=await Promise[_0xf89455(0x1eb)]([database_1['default'][_0xf89455(0x1d8)][_0xf89455(0x1b6)]({'where':{'shopId':_0x30736f,'gateway':{'not':_0xf89455(0x20b)},'createdAt':{'gte':_0x285b28}}}),database_1[_0xf89455(0x1ba)][_0xf89455(0x1d8)]['count']({'where':{'shopId':_0x30736f,'gateway':{'not':_0xf89455(0x20b)},'status':_0xf89455(0x1d9),'createdAt':{'gte':_0x285b28}}}),database_1[_0xf89455(0x1ba)][_0xf89455(0x1d8)]['findMany']({'where':{'shopId':_0x30736f,'gateway':{'not':_0xf89455(0x20b)},'status':_0xf89455(0x1d9),'createdAt':{'gte':_0x285b28}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0xf89455(0x1d8)]['findMany']({'where':{'shopId':_0x30736f,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0xf89455(0x20e)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0xf89455(0x1ba)][_0xf89455(0x1d8)]['findMany']({'where':{'shopId':_0x30736f,'gateway':{'not':_0xf89455(0x20b)},'createdAt':{'gte':_0x285b28}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0xf89455(0x19b)}})]);let _0xb4e608=0x0;for(const _0x45d074 of _0x219c59){if(_0x45d074[_0xf89455(0x21a)])_0xb4e608+=_0x45d074[_0xf89455(0x21a)];else{const _0x52697b=await currencyService_1[_0xf89455(0x1e4)][_0xf89455(0x213)](_0x45d074[_0xf89455(0x1d0)],_0x45d074[_0xf89455(0x1bf)]);_0xb4e608+=_0x52697b;}}const _0x5767d6=this['generateDailyStatistics'](_0x3787b1,_0x285b28,_0x1e5e60),_0xa7d14f=_0x1b6324>0x0?_0x2d2026/_0x1b6324*0x64:0x0;return{'totalPayments':_0x1b6324,'successfulPayments':_0x2d2026,'totalRevenue':Math['round'](_0xb4e608*0x64)/0x64,'conversionRate':Math[_0xf89455(0x1ca)](_0xa7d14f*0x64)/0x64,'dailyRevenue':_0x5767d6[_0xf89455(0x219)],'dailyPayments':_0x5767d6[_0xf89455(0x1ea)],'recentPayments':_0xeacdae[_0xf89455(0x1c6)](_0x432b54=>({'id':_0x432b54['id'],'gateway':_0x432b54[_0xf89455(0x1ab)],'amount':_0x432b54[_0xf89455(0x1d0)],'currency':_0x432b54[_0xf89455(0x1bf)],'status':_0x432b54[_0xf89455(0x1a8)],'createdAt':_0x432b54[_0xf89455(0x195)]}))};}[a54_0x1f73fe(0x18e)](_0x5d231d,_0x3789eb,_0x375eb2){const _0x35ddd9=a54_0x1f73fe,_0x13ff8a=new Map(),_0x3cba70=new Date(_0x3789eb);while(_0x3cba70<=_0x375eb2){const _0x2550da=_0x3cba70[_0x35ddd9(0x1d5)]()[_0x35ddd9(0x1da)]('T')[0x0];_0x13ff8a[_0x35ddd9(0x21b)](_0x2550da,{'revenue':0x0,'count':0x0}),_0x3cba70[_0x35ddd9(0x20d)](_0x3cba70[_0x35ddd9(0x1c8)]()+0x1);}for(const _0x1ff399 of _0x5d231d){const _0x303b26=_0x1ff399['createdAt'][_0x35ddd9(0x1d5)]()[_0x35ddd9(0x1da)]('T')[0x0],_0x437016=_0x13ff8a[_0x35ddd9(0x1df)](_0x303b26);_0x437016&&(_0x437016[_0x35ddd9(0x1b6)]+=0x1,_0x1ff399[_0x35ddd9(0x1a8)]==='PAID'&&_0x1ff399[_0x35ddd9(0x21a)]&&(_0x437016[_0x35ddd9(0x203)]+=_0x1ff399[_0x35ddd9(0x21a)]));}const _0x388b36=[],_0x59a42f=[];for(const [_0x462644,_0x2db738]of _0x13ff8a){_0x388b36[_0x35ddd9(0x1bb)]({'date':_0x462644,'amount':Math[_0x35ddd9(0x1ca)](_0x2db738[_0x35ddd9(0x203)]*0x64)/0x64}),_0x59a42f[_0x35ddd9(0x1bb)]({'date':_0x462644,'count':_0x2db738[_0x35ddd9(0x1b6)]});}return{'dailyRevenue':_0x388b36,'dailyPayments':_0x59a42f};}}exports[a54_0x1f73fe(0x1e2)]=ShopService;