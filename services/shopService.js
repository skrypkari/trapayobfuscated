'use strict';const a56_0x3be85e=a56_0xe61d;(function(_0x1af44b,_0x3c5793){const _0x13afd8=a56_0xe61d,_0x32b8e3=_0x1af44b();while(!![]){try{const _0x3986e4=parseInt(_0x13afd8(0x13e))/0x1*(parseInt(_0x13afd8(0x144))/0x2)+parseInt(_0x13afd8(0xb6))/0x3+parseInt(_0x13afd8(0x127))/0x4*(-parseInt(_0x13afd8(0x10b))/0x5)+-parseInt(_0x13afd8(0x154))/0x6+-parseInt(_0x13afd8(0xce))/0x7+parseInt(_0x13afd8(0xf5))/0x8*(parseInt(_0x13afd8(0x11f))/0x9)+parseInt(_0x13afd8(0xbb))/0xa*(-parseInt(_0x13afd8(0xc2))/0xb);if(_0x3986e4===_0x3c5793)break;else _0x32b8e3['push'](_0x32b8e3['shift']());}catch(_0x537c75){_0x32b8e3['push'](_0x32b8e3['shift']());}}}(a56_0x3d0f,0x7cb31));function a56_0xe61d(_0x6a51f0,_0x400658){const _0x3d0fa1=a56_0x3d0f();return a56_0xe61d=function(_0xe61db2,_0x4113b7){_0xe61db2=_0xe61db2-0xb3;let _0xbc9b9e=_0x3d0fa1[_0xe61db2];return _0xbc9b9e;},a56_0xe61d(_0x6a51f0,_0x400658);}function a56_0x3d0f(){const _0x2e3d4d=['payment','stringify','network','getMonth','543195WmfSGe','test_payment_123','amountIsEditable','Error\x20parsing\x20webhook\x20events:','periodFrom','68220iOzmHR','telegram','totalPaidOut','notes','\x20payout\x20statistics\x20calculated:','setDate','name','814xLpHJq','usage','customer','KLYME\x20EU','delete','maxPayments','getPaymentByShopAndId','\x20USDT\x20(total\x20payouts)','trc20','ceil','getPayments','üåê\x20Method\x20filter:\x20','543102ZYfLal','default','wallets','txid','findUnique','telegramId','shopUrl','findFirst','setHours','periodTo','PAID','Plisio','webhookUrl','redirectUrl','update','findMany','generateDailyStatistics','gatewaySettings','getPayoutStats','USDT\x20Polygon','dailyRevenue','aggregate','test_gateway','paymentService','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','USDT\x20BSC','map','30d','get','usdtPolygonWallet','ShopService','formatNetworkName','paid','log','paymentId','\x20USDT\x20(current\x20balance)','Test\x20Gateway','retryCount','REJECTED','5351224GYkNul','parse','getWebhookLogs','__importDefault','thisMonth','Rapyd','...','event','gte','PENDING','90d','shopId','username','\x20USDT','message','../config/database','createPublicPayment','paidAt','lte','status','getStatistics','settings','190zBMSdx','gateway','customerEmail','Failed\x20to\x20send\x20webhook:\x20','defineProperty','paymentGateways','polygon','Payment\x20not\x20found','getTime','reduce','count','KLYME\x20GB','expiresAt','dailyPayments','sourceCurrency','payout','toUpperCase','erc20','usdtTrcWallet','language','9vzUGGo','fullName','error','gateways','createdAt','testWebhook','./paymentService','getPayouts','33816nKRxuQ','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','USDT\x20TRC20','all','No\x20webhook\x20URL\x20configured','amount','split','toISOString','Noda','_sum','merchantUrl','COMPLETED','üìä\x20Status\x20filter:\x20','getShopPayoutStats','USDT\x20ERC20','getPayoutStatistics','currency','createPayment','getShopProfile','\x20\x20\x20üìÖ\x20This\x20month:\x20','push','CoinToPay','webhookEvents','1ILNCrO','Shop\x20not\x20found','__esModule','statusCode','isArray','responseBody','1216024WvbmIf','Test\x20webhook\x20sent\x20successfully\x20(','üìä\x20Final\x20WHERE\x20conditions:','üìÖ\x20Date\x20start:\x20','currencyService','desc','shop','revenue','publicKey','üìÖ\x20Period\x20start:\x20','round','Webhook\x20returned\x20error:\x20','amountUSDT','getFullYear','üí∞\x20Getting\x20payouts\x20with\x20filters:','usdcPolygonWallet','261270FLFwYv','availableBalance','usdtErcWallet'];a56_0x3d0f=function(){return _0x2e3d4d;};return a56_0x3d0f();}var __importDefault=this&&this[a56_0x3be85e(0xf8)]||function(_0x217d1e){const _0x7c16b8=a56_0x3be85e;return _0x217d1e&&_0x217d1e[_0x7c16b8(0x140)]?_0x217d1e:{'default':_0x217d1e};};Object[a56_0x3be85e(0x10f)](exports,a56_0x3be85e(0x140),{'value':!![]}),exports[a56_0x3be85e(0xec)]=void 0x0;const database_1=__importDefault(require(a56_0x3be85e(0x104))),currencyService_1=require('./currencyService'),paymentService_1=require(a56_0x3be85e(0x125));class ShopService{constructor(){const _0x133e8a=a56_0x3be85e;this[_0x133e8a(0xe5)]=new paymentService_1['PaymentService']();}async[a56_0x3be85e(0x139)](_0x588cb7){const _0xf4fe35=a56_0x3be85e,_0x162a41=await database_1[_0xf4fe35(0xcf)][_0xf4fe35(0x14a)]['findUnique']({'where':{'id':_0x588cb7},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x162a41)throw new Error('Shop\x20not\x20found');let _0x2695eb=[];if(_0x162a41[_0xf4fe35(0x10a)]?.[_0xf4fe35(0x13d)])try{_0x2695eb=Array[_0xf4fe35(0x142)](_0x162a41[_0xf4fe35(0x10a)][_0xf4fe35(0x13d)])?_0x162a41['settings'][_0xf4fe35(0x13d)]:JSON[_0xf4fe35(0xf6)](_0x162a41[_0xf4fe35(0x10a)][_0xf4fe35(0x13d)]);}catch(_0x4a9a18){console[_0xf4fe35(0x121)]('Error\x20parsing\x20webhook\x20events:',_0x4a9a18),_0x2695eb=[];}return{'id':_0x162a41['id'],'fullName':_0x162a41[_0xf4fe35(0xc1)],'username':_0x162a41['username'],'telegramId':_0x162a41[_0xf4fe35(0xbc)],'merchantUrl':_0x162a41['shopUrl'],'gateways':_0x162a41['paymentGateways']?JSON[_0xf4fe35(0xf6)](_0x162a41[_0xf4fe35(0x110)]):null,'gatewaySettings':_0x162a41[_0xf4fe35(0xdf)]?JSON['parse'](_0x162a41[_0xf4fe35(0xdf)]):null,'publicKey':_0x162a41[_0xf4fe35(0x14c)],'webhookUrl':_0x162a41[_0xf4fe35(0x10a)]?.[_0xf4fe35(0xda)]||null,'webhookEvents':_0x2695eb,'wallets':{'usdtPolygonWallet':_0x162a41[_0xf4fe35(0xeb)],'usdtTrcWallet':_0x162a41['usdtTrcWallet'],'usdtErcWallet':_0x162a41[_0xf4fe35(0x156)],'usdcPolygonWallet':_0x162a41[_0xf4fe35(0x153)]},'status':_0x162a41['status'],'createdAt':_0x162a41[_0xf4fe35(0x123)]};}async['updateShopProfile'](_0x377c3a,_0x1c3c4c){const _0x465340=a56_0x3be85e,_0x1c10d8={};_0x1c3c4c[_0x465340(0x120)]&&(_0x1c10d8['name']=_0x1c3c4c[_0x465340(0x120)]);_0x1c3c4c[_0x465340(0xd3)]!==undefined&&(_0x1c10d8[_0x465340(0xbc)]=_0x1c3c4c[_0x465340(0xd3)]||null);_0x1c3c4c[_0x465340(0x131)]&&(_0x1c10d8[_0x465340(0xd4)]=_0x1c3c4c[_0x465340(0x131)]);_0x1c3c4c[_0x465340(0x122)]&&(_0x1c10d8[_0x465340(0x110)]=JSON[_0x465340(0xb3)](_0x1c3c4c[_0x465340(0x122)]));_0x1c3c4c[_0x465340(0xdf)]&&(_0x1c10d8[_0x465340(0xdf)]=JSON[_0x465340(0xb3)](_0x1c3c4c[_0x465340(0xdf)]));_0x1c3c4c[_0x465340(0xd0)]&&(_0x1c3c4c['wallets'][_0x465340(0xeb)]!==undefined&&(_0x1c10d8[_0x465340(0xeb)]=_0x1c3c4c[_0x465340(0xd0)][_0x465340(0xeb)]||null),_0x1c3c4c[_0x465340(0xd0)][_0x465340(0x11d)]!==undefined&&(_0x1c10d8[_0x465340(0x11d)]=_0x1c3c4c[_0x465340(0xd0)][_0x465340(0x11d)]||null),_0x1c3c4c['wallets']['usdtErcWallet']!==undefined&&(_0x1c10d8['usdtErcWallet']=_0x1c3c4c[_0x465340(0xd0)][_0x465340(0x156)]||null),_0x1c3c4c[_0x465340(0xd0)][_0x465340(0x153)]!==undefined&&(_0x1c10d8[_0x465340(0x153)]=_0x1c3c4c[_0x465340(0xd0)][_0x465340(0x153)]||null));const _0x1e85e0=await database_1[_0x465340(0xcf)]['shop'][_0x465340(0xdc)]({'where':{'id':_0x377c3a},'data':_0x1c10d8,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x4fff8e=[];if(_0x1e85e0[_0x465340(0x10a)]?.['webhookEvents'])try{_0x4fff8e=Array[_0x465340(0x142)](_0x1e85e0[_0x465340(0x10a)][_0x465340(0x13d)])?_0x1e85e0['settings'][_0x465340(0x13d)]:JSON['parse'](_0x1e85e0['settings'][_0x465340(0x13d)]);}catch(_0x3b766b){console[_0x465340(0x121)](_0x465340(0xb9),_0x3b766b),_0x4fff8e=[];}return{'id':_0x1e85e0['id'],'fullName':_0x1e85e0[_0x465340(0xc1)],'username':_0x1e85e0[_0x465340(0x101)],'telegramId':_0x1e85e0[_0x465340(0xbc)],'merchantUrl':_0x1e85e0['shopUrl'],'gateways':_0x1e85e0[_0x465340(0x110)]?JSON['parse'](_0x1e85e0[_0x465340(0x110)]):null,'gatewaySettings':_0x1e85e0['gatewaySettings']?JSON[_0x465340(0xf6)](_0x1e85e0[_0x465340(0xdf)]):null,'publicKey':_0x1e85e0[_0x465340(0x14c)],'webhookUrl':_0x1e85e0[_0x465340(0x10a)]?.[_0x465340(0xda)]||null,'webhookEvents':_0x4fff8e,'wallets':{'usdtPolygonWallet':_0x1e85e0['usdtPolygonWallet'],'usdtTrcWallet':_0x1e85e0[_0x465340(0x11d)],'usdtErcWallet':_0x1e85e0[_0x465340(0x156)],'usdcPolygonWallet':_0x1e85e0[_0x465340(0x153)]},'status':_0x1e85e0[_0x465340(0x108)],'createdAt':_0x1e85e0['createdAt']};}async['updateWallets'](_0x555e39,_0x3c6d40){const _0x5d4a8a=a56_0x3be85e,_0x4a3589={};_0x3c6d40[_0x5d4a8a(0xeb)]!==undefined&&(_0x4a3589['usdtPolygonWallet']=_0x3c6d40[_0x5d4a8a(0xeb)]||null),_0x3c6d40[_0x5d4a8a(0x11d)]!==undefined&&(_0x4a3589[_0x5d4a8a(0x11d)]=_0x3c6d40[_0x5d4a8a(0x11d)]||null),_0x3c6d40[_0x5d4a8a(0x156)]!==undefined&&(_0x4a3589[_0x5d4a8a(0x156)]=_0x3c6d40[_0x5d4a8a(0x156)]||null),_0x3c6d40['usdcPolygonWallet']!==undefined&&(_0x4a3589[_0x5d4a8a(0x153)]=_0x3c6d40[_0x5d4a8a(0x153)]||null),await database_1['default'][_0x5d4a8a(0x14a)][_0x5d4a8a(0xdc)]({'where':{'id':_0x555e39},'data':_0x4a3589});}async[a56_0x3be85e(0x124)](_0x30af7b){const _0x5817f5=a56_0x3be85e,_0xc115cb=await database_1['default'][_0x5817f5(0x14a)][_0x5817f5(0xd2)]({'where':{'id':_0x30af7b},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0xc115cb?.[_0x5817f5(0x10a)]?.[_0x5817f5(0xda)])throw new Error(_0x5817f5(0x12b));const _0x2c5309={'event':'test','payment':{'id':_0x5817f5(0xb7),'order_id':'test_order_123','gateway':'test','amount':0x64,'currency':'USD','status':_0x5817f5(0xee),'created_at':new Date()['toISOString']()}};try{const _0x250544=await fetch(_0xc115cb[_0x5817f5(0x10a)][_0x5817f5(0xda)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x5817f5(0xb3)](_0x2c5309)});return _0x250544['ok']?{'success':!![],'message':_0x5817f5(0x145)+_0x250544['status']+')'}:{'success':![],'message':_0x5817f5(0x14f)+_0x250544[_0x5817f5(0x108)]+'\x20'+_0x250544['statusText']};}catch(_0x1bebbc){return{'success':![],'message':_0x5817f5(0x10e)+(_0x1bebbc instanceof Error?_0x1bebbc[_0x5817f5(0x103)]:'Unknown\x20error')};}}async[a56_0x3be85e(0x138)](_0x313e79){const _0x2bcf47=a56_0x3be85e;return this[_0x2bcf47(0xe5)][_0x2bcf47(0x105)]({'public_key':'','gateway':_0x313e79[_0x2bcf47(0x10c)],'order_id':undefined,'amount':_0x313e79[_0x2bcf47(0x12c)],'currency':_0x313e79['currency'],'source_currency':_0x313e79[_0x2bcf47(0x119)],'usage':_0x313e79[_0x2bcf47(0xc3)],'expires_at':_0x313e79[_0x2bcf47(0x117)]?.[_0x2bcf47(0x12e)](),'success_url':_0x313e79['redirectUrl'],'fail_url':_0x313e79[_0x2bcf47(0xdb)],'customer_email':_0x313e79[_0x2bcf47(0x10d)],'customer_name':_0x313e79['customerName'],'country':_0x313e79['country'],'language':_0x313e79[_0x2bcf47(0x11e)],'amount_is_editable':_0x313e79[_0x2bcf47(0xb8)],'max_payments':_0x313e79[_0x2bcf47(0xc7)],'customer':_0x313e79[_0x2bcf47(0xc4)]});}async[a56_0x3be85e(0xcc)](_0x1f2b79,_0x303335){const _0x1aa217=a56_0x3be85e;return this[_0x1aa217(0xe5)]['getPaymentsByShop'](_0x1f2b79,_0x303335);}async['getPaymentById'](_0x861d31,_0x23e444){const _0x531c22=a56_0x3be85e;return this[_0x531c22(0xe5)][_0x531c22(0xc8)](_0x861d31,_0x23e444);}async['updatePayment'](_0x249989,_0x336c04,_0x5a48ce){const _0x56d34d=a56_0x3be85e,_0x52a5a8=await database_1[_0x56d34d(0xcf)]['payment'][_0x56d34d(0xd5)]({'where':{'id':_0x336c04,'shopId':_0x249989}});if(!_0x52a5a8)throw new Error(_0x56d34d(0x112));const _0x5b450c=await database_1[_0x56d34d(0xcf)][_0x56d34d(0x157)][_0x56d34d(0xdc)]({'where':{'id':_0x336c04},'data':{..._0x5a48ce,'updatedAt':new Date()}});return _0x5b450c;}async['deletePayment'](_0x11e90e,_0x4514df){const _0x2b187f=a56_0x3be85e,_0x6e2f53=await database_1[_0x2b187f(0xcf)]['payment'][_0x2b187f(0xd5)]({'where':{'id':_0x4514df,'shopId':_0x11e90e}});if(!_0x6e2f53)throw new Error(_0x2b187f(0x112));await database_1[_0x2b187f(0xcf)]['payment'][_0x2b187f(0xc6)]({'where':{'id':_0x4514df}});}[a56_0x3be85e(0xed)](_0x903a96){const _0x2a6284=a56_0x3be85e,_0x2939a1={'polygon':_0x2a6284(0xe1),'trc20':_0x2a6284(0x129),'erc20':_0x2a6284(0x135),'bsc':_0x2a6284(0xe7),'polygon_usdc':'USDC\x20Polygon'};return _0x2939a1[_0x903a96]||_0x903a96;}async[a56_0x3be85e(0x126)](_0x24f309,_0x28acbb){const _0x4b3e47=a56_0x3be85e,{page:_0x5c9864,limit:_0x5e0e86,status:_0x531378,method:_0x17c247,network:_0x4b9388,dateFrom:_0x37b8f6,dateTo:_0x24ad33,periodFrom:_0x34af44,periodTo:_0x1e7f62}=_0x28acbb,_0x3346e9=(_0x5c9864-0x1)*_0x5e0e86;console[_0x4b3e47(0xef)](_0x4b3e47(0x152),_0x28acbb);const _0x1883ab={'shopId':_0x24f309};_0x531378&&(_0x1883ab[_0x4b3e47(0x108)]=_0x531378[_0x4b3e47(0x11b)](),console[_0x4b3e47(0xef)](_0x4b3e47(0x133)+_0x531378['toUpperCase']()));if(_0x17c247)_0x1883ab[_0x4b3e47(0xb4)]=_0x17c247,console['log'](_0x4b3e47(0xcd)+_0x17c247);else _0x4b9388&&(_0x1883ab[_0x4b3e47(0xb4)]=_0x4b9388,console['log']('üåê\x20Network\x20filter:\x20'+_0x4b9388));if(_0x37b8f6||_0x24ad33||_0x34af44||_0x1e7f62){_0x1883ab[_0x4b3e47(0x123)]={};if(_0x34af44){const _0x4605c1=new Date(_0x34af44);_0x4605c1[_0x4b3e47(0xd6)](0x0,0x0,0x0,0x0),_0x1883ab[_0x4b3e47(0x123)]['gte']=_0x4605c1,console[_0x4b3e47(0xef)](_0x4b3e47(0x14d)+_0x4605c1[_0x4b3e47(0x12e)]());}else{if(_0x37b8f6){const _0x22b86f=new Date(_0x37b8f6);_0x22b86f['setHours'](0x0,0x0,0x0,0x0),_0x1883ab[_0x4b3e47(0x123)][_0x4b3e47(0xfd)]=_0x22b86f,console[_0x4b3e47(0xef)](_0x4b3e47(0x147)+_0x22b86f[_0x4b3e47(0x12e)]());}}if(_0x1e7f62){const _0x444878=new Date(_0x1e7f62);_0x444878[_0x4b3e47(0xd6)](0x17,0x3b,0x3b,0x3e7),_0x1883ab[_0x4b3e47(0x123)][_0x4b3e47(0x107)]=_0x444878,console[_0x4b3e47(0xef)]('üìÖ\x20Period\x20end:\x20'+_0x444878[_0x4b3e47(0x12e)]());}else{if(_0x24ad33){const _0x406973=new Date(_0x24ad33);_0x406973[_0x4b3e47(0xd6)](0x17,0x3b,0x3b,0x3e7),_0x1883ab[_0x4b3e47(0x123)][_0x4b3e47(0x107)]=_0x406973,console[_0x4b3e47(0xef)]('üìÖ\x20Date\x20end:\x20'+_0x406973[_0x4b3e47(0x12e)]());}}}console[_0x4b3e47(0xef)](_0x4b3e47(0x146),JSON[_0x4b3e47(0xb3)](_0x1883ab,null,0x2));const [_0x43fd7e,_0x7fa941]=await Promise[_0x4b3e47(0x12a)]([database_1['default']['payout'][_0x4b3e47(0xdd)]({'where':_0x1883ab,'skip':_0x3346e9,'take':_0x5e0e86,'orderBy':{'createdAt':_0x4b3e47(0x149)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x4b3e47(0xcf)][_0x4b3e47(0x11a)][_0x4b3e47(0x115)]({'where':_0x1883ab})]);return{'payouts':_0x43fd7e[_0x4b3e47(0xe8)](_0x129f9c=>{const _0x2d4b4f=_0x4b3e47;let _0x126685=null;switch(_0x129f9c['network']){case _0x2d4b4f(0x111):_0x126685=_0x129f9c['shop'][_0x2d4b4f(0xeb)];break;case _0x2d4b4f(0xca):_0x126685=_0x129f9c[_0x2d4b4f(0x14a)][_0x2d4b4f(0x11d)];break;case _0x2d4b4f(0x11c):_0x126685=_0x129f9c[_0x2d4b4f(0x14a)]['usdtErcWallet'];break;case'polygon_usdc':_0x126685=_0x129f9c[_0x2d4b4f(0x14a)][_0x2d4b4f(0x153)];break;}return{'id':_0x129f9c['id'],'amount':_0x129f9c[_0x2d4b4f(0x12c)],'network':this[_0x2d4b4f(0xed)](_0x129f9c[_0x2d4b4f(0xb4)]),'wallet':_0x126685,'status':_0x129f9c['status'],'txid':_0x129f9c[_0x2d4b4f(0xd1)],'notes':_0x129f9c[_0x2d4b4f(0xbe)],'periodFrom':_0x129f9c[_0x2d4b4f(0xba)],'periodTo':_0x129f9c[_0x2d4b4f(0xd7)],'createdAt':_0x129f9c[_0x2d4b4f(0x123)],'paidAt':_0x129f9c[_0x2d4b4f(0x106)]};}),'pagination':{'page':_0x5c9864,'limit':_0x5e0e86,'total':_0x7fa941,'totalPages':Math['ceil'](_0x7fa941/_0x5e0e86)}};}async['getPayoutById'](_0x3f517a,_0x1d597a){const _0x471658=a56_0x3be85e,_0x47ec26=await database_1[_0x471658(0xcf)][_0x471658(0x11a)][_0x471658(0xd5)]({'where':{'id':_0x1d597a,'shopId':_0x3f517a}});if(!_0x47ec26)return null;return{'id':_0x47ec26['id'],'amount':_0x47ec26[_0x471658(0x12c)],'network':_0x47ec26[_0x471658(0xb4)],'status':_0x47ec26['status'],'txid':_0x47ec26['txid'],'notes':_0x47ec26[_0x471658(0xbe)],'createdAt':_0x47ec26['createdAt'],'paidAt':_0x47ec26[_0x471658(0x106)]};}async[a56_0x3be85e(0x136)](_0x5667b5,_0x1917a2){const _0x449e07=a56_0x3be85e,_0x5a604b=new Date();let _0x547689;switch(_0x1917a2){case'7d':_0x547689=new Date(_0x5a604b[_0x449e07(0x113)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x547689=new Date(_0x5a604b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x449e07(0xff):_0x547689=new Date(_0x5a604b['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x547689=new Date(_0x5a604b[_0x449e07(0x113)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4f9ac6,_0x35425d,_0x1f9a93,_0x4c89c7,_0x15c0e6,_0x11f4f9]=await Promise[_0x449e07(0x12a)]([database_1[_0x449e07(0xcf)][_0x449e07(0x11a)][_0x449e07(0x115)]({'where':{'shopId':_0x5667b5,'createdAt':{'gte':_0x547689}}}),database_1['default'][_0x449e07(0x11a)][_0x449e07(0x115)]({'where':{'shopId':_0x5667b5,'status':'COMPLETED','createdAt':{'gte':_0x547689}}}),database_1[_0x449e07(0xcf)][_0x449e07(0x11a)][_0x449e07(0x115)]({'where':{'shopId':_0x5667b5,'status':_0x449e07(0xfe),'createdAt':{'gte':_0x547689}}}),database_1[_0x449e07(0xcf)]['payout'][_0x449e07(0x115)]({'where':{'shopId':_0x5667b5,'status':_0x449e07(0xf4),'createdAt':{'gte':_0x547689}}}),database_1[_0x449e07(0xcf)][_0x449e07(0x11a)][_0x449e07(0xdd)]({'where':{'shopId':_0x5667b5,'createdAt':{'gte':_0x547689}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x449e07(0xcf)][_0x449e07(0x11a)][_0x449e07(0xdd)]({'where':{'shopId':_0x5667b5},'take':0xa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x53421b=_0x15c0e6['reduce']((_0x178aab,_0x5a37dd)=>_0x178aab+_0x5a37dd[_0x449e07(0x12c)],0x0),_0x18ad10=_0x15c0e6['filter'](_0x2820ac=>_0x2820ac[_0x449e07(0x108)]===_0x449e07(0x132))[_0x449e07(0x114)]((_0x25a7c3,_0x1a4c37)=>_0x25a7c3+_0x1a4c37[_0x449e07(0x12c)],0x0),_0x1fc05d=_0x15c0e6['filter'](_0x4705d0=>_0x4705d0['status']===_0x449e07(0xfe))['reduce']((_0x2e0958,_0x25757c)=>_0x2e0958+_0x25757c[_0x449e07(0x12c)],0x0),_0x5d5692=_0x15c0e6[_0x449e07(0x114)]((_0xc326da,_0x23d5c0)=>{const _0x25626a=_0x449e07;return _0xc326da[_0x23d5c0[_0x25626a(0xb4)]]=(_0xc326da[_0x23d5c0[_0x25626a(0xb4)]]||0x0)+0x1,_0xc326da;},{}),_0x37207a=_0x15c0e6[_0x449e07(0x114)]((_0x24601c,_0x5b9c9a)=>{const _0x23f92f=_0x449e07;return _0x24601c[_0x5b9c9a[_0x23f92f(0x108)]]=(_0x24601c[_0x5b9c9a[_0x23f92f(0x108)]]||0x0)+0x1,_0x24601c;},{});return{'totalPayouts':_0x4f9ac6,'completedPayouts':_0x35425d,'pendingPayouts':_0x1f9a93,'rejectedPayouts':_0x4c89c7,'totalAmount':_0x53421b,'completedAmount':_0x18ad10,'pendingAmount':_0x1fc05d,'payoutsByMethod':_0x5d5692,'payoutsByStatus':_0x37207a,'recentPayouts':_0x11f4f9[_0x449e07(0xe8)](_0x135d85=>({'id':_0x135d85['id'],'shopId':_0x5667b5,'amount':_0x135d85['amount'],'method':_0x135d85[_0x449e07(0xb4)],'status':_0x135d85[_0x449e07(0x108)],'txid':_0x135d85[_0x449e07(0xd1)],'createdAt':_0x135d85[_0x449e07(0x123)],'paidAt':_0x135d85['paidAt']}))};}async[a56_0x3be85e(0x134)](_0x3b43d2){const _0x5a3a04=a56_0x3be85e;console[_0x5a3a04(0xef)](_0x5a3a04(0xe6)+_0x3b43d2+_0x5a3a04(0xfb));const _0x1d496e=await database_1[_0x5a3a04(0xcf)]['shop'][_0x5a3a04(0xd2)]({'where':{'id':_0x3b43d2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1d496e)throw new Error(_0x5a3a04(0x13f));const _0x4286cb=new Date(),_0x3ca87a=new Date(_0x4286cb[_0x5a3a04(0x151)](),_0x4286cb[_0x5a3a04(0xb5)](),0x1),_0x380641=new Date(_0x4286cb[_0x5a3a04(0x151)](),_0x4286cb[_0x5a3a04(0xb5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x49cb49=await database_1[_0x5a3a04(0xcf)][_0x5a3a04(0x11a)][_0x5a3a04(0xe3)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3b43d2,'createdAt':{'gte':_0x3ca87a,'lte':_0x380641},'status':_0x5a3a04(0x132)}}),_0x491944=_0x49cb49[_0x5a3a04(0x130)][_0x5a3a04(0x12c)]||0x0,_0x3c40d1={'availableBalance':Math[_0x5a3a04(0x14e)](_0x1d496e['balance']*0x64)/0x64,'totalPaidOut':Math[_0x5a3a04(0x14e)](_0x1d496e[_0x5a3a04(0xbd)]*0x64)/0x64,'awaitingPayout':Math[_0x5a3a04(0x14e)](_0x1d496e['balance']*0x64)/0x64,'thisMonth':Math[_0x5a3a04(0x14e)](_0x491944*0x64)/0x64};return console[_0x5a3a04(0xef)]('üìä\x20Shop\x20'+_0x1d496e[_0x5a3a04(0x101)]+_0x5a3a04(0xbf)),console[_0x5a3a04(0xef)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x3c40d1[_0x5a3a04(0x155)]+'\x20USDT\x20(current\x20balance)'),console['log'](_0x5a3a04(0x128)+_0x3c40d1[_0x5a3a04(0xbd)]+_0x5a3a04(0xc9)),console['log']('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x3c40d1['awaitingPayout']+_0x5a3a04(0xf1)),console['log'](_0x5a3a04(0x13a)+_0x3c40d1[_0x5a3a04(0xf9)]+_0x5a3a04(0x102)),_0x3c40d1;}['getGatewayDisplayName'](_0x18f3b3){const _0x33f992=a56_0x3be85e,_0xa4d464={'test_gateway':_0x33f992(0xf2),'plisio':_0x33f992(0xd9),'rapyd':_0x33f992(0xfa),'noda':_0x33f992(0x12f),'cointopay':_0x33f992(0x13c),'klyme_eu':_0x33f992(0xc5),'klyme_gb':_0x33f992(0x116),'klyme_de':'KLYME\x20DE'};return _0xa4d464[_0x18f3b3]||_0x18f3b3;}async[a56_0x3be85e(0xe0)](_0x1c3229){const _0xb5aca8=a56_0x3be85e;return this[_0xb5aca8(0x134)](_0x1c3229);}async[a56_0x3be85e(0xf7)](_0x353dfa,_0x318f27){const _0x111ed1=a56_0x3be85e,{page:_0x330018,limit:_0x1fd6f1,paymentId:_0x34fdba}=_0x318f27,_0x413e01=(_0x330018-0x1)*_0x1fd6f1,_0x2765e2={'shopId':_0x353dfa};_0x34fdba&&(_0x2765e2['paymentId']=_0x34fdba);const [_0x108a67,_0x460a44]=await Promise['all']([database_1['default']['webhookLog'][_0x111ed1(0xdd)]({'where':_0x2765e2,'skip':_0x413e01,'take':_0x1fd6f1,'orderBy':{'createdAt':_0x111ed1(0x149)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x111ed1(0xcf)]['webhookLog'][_0x111ed1(0x115)]({'where':_0x2765e2})]);return{'logs':_0x108a67['map'](_0xf09c08=>({'id':_0xf09c08['id'],'paymentId':_0xf09c08[_0x111ed1(0xf0)],'shopId':_0xf09c08[_0x111ed1(0x100)],'event':_0xf09c08[_0x111ed1(0xfc)],'statusCode':_0xf09c08[_0x111ed1(0x141)],'retryCount':_0xf09c08[_0x111ed1(0xf3)],'responseBody':_0xf09c08[_0x111ed1(0x143)],'createdAt':_0xf09c08[_0x111ed1(0x123)],'payment':_0xf09c08[_0x111ed1(0x157)]})),'pagination':{'page':_0x330018,'limit':_0x1fd6f1,'total':_0x460a44,'totalPages':Math[_0x111ed1(0xcb)](_0x460a44/_0x1fd6f1)}};}async[a56_0x3be85e(0x109)](_0x1f880c,_0x21f9d2){const _0x14a581=a56_0x3be85e,_0x164c82=new Date();let _0x2e5169;switch(_0x21f9d2){case'7d':_0x2e5169=new Date(_0x164c82[_0x14a581(0x113)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x14a581(0xe9):_0x2e5169=new Date(_0x164c82[_0x14a581(0x113)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x14a581(0xff):_0x2e5169=new Date(_0x164c82[_0x14a581(0x113)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2e5169=new Date(_0x164c82[_0x14a581(0x113)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0xf72d00,_0x55b709,_0x29849f,_0xdaad6d,_0x432a5a]=await Promise['all']([database_1[_0x14a581(0xcf)][_0x14a581(0x157)][_0x14a581(0x115)]({'where':{'shopId':_0x1f880c,'gateway':{'not':_0x14a581(0xe4)},'createdAt':{'gte':_0x2e5169}}}),database_1['default'][_0x14a581(0x157)][_0x14a581(0x115)]({'where':{'shopId':_0x1f880c,'gateway':{'not':_0x14a581(0xe4)},'status':_0x14a581(0xd8),'createdAt':{'gte':_0x2e5169}}}),database_1[_0x14a581(0xcf)][_0x14a581(0x157)][_0x14a581(0xdd)]({'where':{'shopId':_0x1f880c,'gateway':{'not':'test_gateway'},'status':_0x14a581(0xd8),'createdAt':{'gte':_0x2e5169}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x14a581(0xcf)][_0x14a581(0x157)][_0x14a581(0xdd)]({'where':{'shopId':_0x1f880c,'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x14a581(0x149)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x14a581(0xcf)][_0x14a581(0x157)][_0x14a581(0xdd)]({'where':{'shopId':_0x1f880c,'gateway':{'not':_0x14a581(0xe4)},'createdAt':{'gte':_0x2e5169}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x56ef99=0x0;for(const _0x599541 of _0x29849f){if(_0x599541[_0x14a581(0x150)])_0x56ef99+=_0x599541[_0x14a581(0x150)];else{const _0x3a1dc5=await currencyService_1[_0x14a581(0x148)]['convertToUSDT'](_0x599541[_0x14a581(0x12c)],_0x599541[_0x14a581(0x137)]);_0x56ef99+=_0x3a1dc5;}}const _0x548e3b=this[_0x14a581(0xde)](_0x432a5a,_0x2e5169,_0x164c82),_0x4d94b8=_0xf72d00>0x0?_0x55b709/_0xf72d00*0x64:0x0;return{'totalPayments':_0xf72d00,'successfulPayments':_0x55b709,'totalRevenue':Math[_0x14a581(0x14e)](_0x56ef99*0x64)/0x64,'conversionRate':Math['round'](_0x4d94b8*0x64)/0x64,'dailyRevenue':_0x548e3b[_0x14a581(0xe2)],'dailyPayments':_0x548e3b[_0x14a581(0x118)],'recentPayments':_0xdaad6d[_0x14a581(0xe8)](_0x22f63a=>({'id':_0x22f63a['id'],'gateway':_0x22f63a[_0x14a581(0x10c)],'amount':_0x22f63a[_0x14a581(0x12c)],'currency':_0x22f63a[_0x14a581(0x137)],'status':_0x22f63a[_0x14a581(0x108)],'createdAt':_0x22f63a[_0x14a581(0x123)]}))};}[a56_0x3be85e(0xde)](_0x2dcd3b,_0x4bb06d,_0x22d5f4){const _0x4c4794=a56_0x3be85e,_0x245144=new Map(),_0x3cf7df=new Date(_0x4bb06d);while(_0x3cf7df<=_0x22d5f4){const _0x927097=_0x3cf7df[_0x4c4794(0x12e)]()[_0x4c4794(0x12d)]('T')[0x0];_0x245144['set'](_0x927097,{'revenue':0x0,'count':0x0}),_0x3cf7df[_0x4c4794(0xc0)](_0x3cf7df['getDate']()+0x1);}for(const _0x851eff of _0x2dcd3b){const _0x203c75=_0x851eff[_0x4c4794(0x123)][_0x4c4794(0x12e)]()[_0x4c4794(0x12d)]('T')[0x0],_0x57c1c3=_0x245144[_0x4c4794(0xea)](_0x203c75);_0x57c1c3&&(_0x57c1c3['count']+=0x1,_0x851eff[_0x4c4794(0x108)]===_0x4c4794(0xd8)&&_0x851eff[_0x4c4794(0x150)]&&(_0x57c1c3[_0x4c4794(0x14b)]+=_0x851eff[_0x4c4794(0x150)]));}const _0x398437=[],_0x6fcd52=[];for(const [_0x3f1ec1,_0x5f7624]of _0x245144){_0x398437[_0x4c4794(0x13b)]({'date':_0x3f1ec1,'amount':Math[_0x4c4794(0x14e)](_0x5f7624['revenue']*0x64)/0x64}),_0x6fcd52[_0x4c4794(0x13b)]({'date':_0x3f1ec1,'count':_0x5f7624[_0x4c4794(0x115)]});}return{'dailyRevenue':_0x398437,'dailyPayments':_0x6fcd52};}}exports[a56_0x3be85e(0xec)]=ShopService;