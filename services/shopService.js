'use strict';const a56_0x52ce96=a56_0x2d71;(function(_0x2ef0b2,_0x5d17ce){const _0x46594a=a56_0x2d71,_0x18f1a7=_0x2ef0b2();while(!![]){try{const _0x3efbf1=parseInt(_0x46594a(0x1c6))/0x1+-parseInt(_0x46594a(0x194))/0x2+parseInt(_0x46594a(0x193))/0x3*(parseInt(_0x46594a(0x1d6))/0x4)+parseInt(_0x46594a(0x184))/0x5*(parseInt(_0x46594a(0x1ad))/0x6)+parseInt(_0x46594a(0x1c4))/0x7+-parseInt(_0x46594a(0x1fe))/0x8+-parseInt(_0x46594a(0x1f4))/0x9*(parseInt(_0x46594a(0x19d))/0xa);if(_0x3efbf1===_0x5d17ce)break;else _0x18f1a7['push'](_0x18f1a7['shift']());}catch(_0x1ab253){_0x18f1a7['push'](_0x18f1a7['shift']());}}}(a56_0x2216,0x6fcc3));function a56_0x2d71(_0x2f9caf,_0x397fc4){const _0x2216cd=a56_0x2216();return a56_0x2d71=function(_0x2d71a0,_0x20b06a){_0x2d71a0=_0x2d71a0-0x173;let _0x41fc41=_0x2216cd[_0x2d71a0];return _0x41fc41;},a56_0x2d71(_0x2f9caf,_0x397fc4);}var __importDefault=this&&this[a56_0x52ce96(0x20f)]||function(_0x1a5fb6){const _0x1afc85=a56_0x52ce96;return _0x1a5fb6&&_0x1a5fb6[_0x1afc85(0x1ba)]?_0x1a5fb6:{'default':_0x1a5fb6};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a56_0x52ce96(0x211)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require('./currencyService'),paymentService_1=require(a56_0x52ce96(0x1b5));class ShopService{constructor(){const _0xc9b7bd=a56_0x52ce96;this['paymentService']=new paymentService_1[(_0xc9b7bd(0x214))]();}async[a56_0x52ce96(0x1aa)](_0x189541){const _0x458086=a56_0x52ce96,_0x1408d6=await database_1['default']['shop']['findUnique']({'where':{'id':_0x189541},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x1408d6)throw new Error('Shop\x20not\x20found');let _0x2eb3ab=[];if(_0x1408d6[_0x458086(0x19c)]?.[_0x458086(0x1a4)])try{_0x2eb3ab=Array[_0x458086(0x175)](_0x1408d6[_0x458086(0x19c)][_0x458086(0x1a4)])?_0x1408d6[_0x458086(0x19c)]['webhookEvents']:JSON[_0x458086(0x1a5)](_0x1408d6[_0x458086(0x19c)][_0x458086(0x1a4)]);}catch(_0x1cb324){console['error']('Error\x20parsing\x20webhook\x20events:',_0x1cb324),_0x2eb3ab=[];}return{'id':_0x1408d6['id'],'fullName':_0x1408d6[_0x458086(0x1da)],'username':_0x1408d6[_0x458086(0x1a7)],'telegramId':_0x1408d6[_0x458086(0x1af)],'merchantUrl':_0x1408d6['shopUrl'],'gateways':_0x1408d6[_0x458086(0x187)]?JSON[_0x458086(0x1a5)](_0x1408d6[_0x458086(0x187)]):null,'gatewaySettings':_0x1408d6[_0x458086(0x203)]?JSON[_0x458086(0x1a5)](_0x1408d6[_0x458086(0x203)]):null,'publicKey':_0x1408d6[_0x458086(0x1c0)],'webhookUrl':_0x1408d6[_0x458086(0x19c)]?.[_0x458086(0x1bf)]||null,'webhookEvents':_0x2eb3ab,'wallets':{'usdtPolygonWallet':_0x1408d6[_0x458086(0x1ee)],'usdtTrcWallet':_0x1408d6['usdtTrcWallet'],'usdtErcWallet':_0x1408d6[_0x458086(0x1a2)],'usdcPolygonWallet':_0x1408d6[_0x458086(0x17f)]},'status':_0x1408d6[_0x458086(0x1c1)],'createdAt':_0x1408d6[_0x458086(0x1ec)]};}async[a56_0x52ce96(0x174)](_0x16cb8a,_0x2f2a0c){const _0x44b175=a56_0x52ce96,_0x53f1ee={};_0x2f2a0c[_0x44b175(0x1f9)]&&(_0x53f1ee[_0x44b175(0x1da)]=_0x2f2a0c[_0x44b175(0x1f9)]);_0x2f2a0c[_0x44b175(0x1e8)]!==undefined&&(_0x53f1ee[_0x44b175(0x1af)]=_0x2f2a0c['telegramId']||null);_0x2f2a0c[_0x44b175(0x1cd)]&&(_0x53f1ee[_0x44b175(0x1f7)]=_0x2f2a0c[_0x44b175(0x1cd)]);_0x2f2a0c[_0x44b175(0x21a)]&&(_0x53f1ee[_0x44b175(0x187)]=JSON[_0x44b175(0x191)](_0x2f2a0c[_0x44b175(0x21a)]));_0x2f2a0c[_0x44b175(0x203)]&&(_0x53f1ee[_0x44b175(0x203)]=JSON[_0x44b175(0x191)](_0x2f2a0c['gatewaySettings']));_0x2f2a0c[_0x44b175(0x189)]&&(_0x2f2a0c[_0x44b175(0x189)][_0x44b175(0x1ee)]!==undefined&&(_0x53f1ee['usdtPolygonWallet']=_0x2f2a0c[_0x44b175(0x189)]['usdtPolygonWallet']||null),_0x2f2a0c[_0x44b175(0x189)][_0x44b175(0x1fa)]!==undefined&&(_0x53f1ee['usdtTrcWallet']=_0x2f2a0c[_0x44b175(0x189)]['usdtTrcWallet']||null),_0x2f2a0c[_0x44b175(0x189)]['usdtErcWallet']!==undefined&&(_0x53f1ee[_0x44b175(0x1a2)]=_0x2f2a0c[_0x44b175(0x189)]['usdtErcWallet']||null),_0x2f2a0c['wallets'][_0x44b175(0x17f)]!==undefined&&(_0x53f1ee['usdcPolygonWallet']=_0x2f2a0c['wallets']['usdcPolygonWallet']||null));const _0x1168cb=await database_1['default']['shop']['update']({'where':{'id':_0x16cb8a},'data':_0x53f1ee,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2a3920=[];if(_0x1168cb[_0x44b175(0x19c)]?.[_0x44b175(0x1a4)])try{_0x2a3920=Array[_0x44b175(0x175)](_0x1168cb['settings']['webhookEvents'])?_0x1168cb['settings']['webhookEvents']:JSON['parse'](_0x1168cb[_0x44b175(0x19c)][_0x44b175(0x1a4)]);}catch(_0x3794f3){console[_0x44b175(0x20c)](_0x44b175(0x18c),_0x3794f3),_0x2a3920=[];}return{'id':_0x1168cb['id'],'fullName':_0x1168cb['name'],'username':_0x1168cb[_0x44b175(0x1a7)],'telegramId':_0x1168cb['telegram'],'merchantUrl':_0x1168cb['shopUrl'],'gateways':_0x1168cb[_0x44b175(0x187)]?JSON[_0x44b175(0x1a5)](_0x1168cb[_0x44b175(0x187)]):null,'gatewaySettings':_0x1168cb['gatewaySettings']?JSON[_0x44b175(0x1a5)](_0x1168cb[_0x44b175(0x203)]):null,'publicKey':_0x1168cb[_0x44b175(0x1c0)],'webhookUrl':_0x1168cb['settings']?.[_0x44b175(0x1bf)]||null,'webhookEvents':_0x2a3920,'wallets':{'usdtPolygonWallet':_0x1168cb[_0x44b175(0x1ee)],'usdtTrcWallet':_0x1168cb['usdtTrcWallet'],'usdtErcWallet':_0x1168cb[_0x44b175(0x1a2)],'usdcPolygonWallet':_0x1168cb['usdcPolygonWallet']},'status':_0x1168cb[_0x44b175(0x1c1)],'createdAt':_0x1168cb[_0x44b175(0x1ec)]};}async[a56_0x52ce96(0x202)](_0x2e44bf,_0x2932d6){const _0x2fc207=a56_0x52ce96,_0x353c37={};_0x2932d6[_0x2fc207(0x1ee)]!==undefined&&(_0x353c37[_0x2fc207(0x1ee)]=_0x2932d6[_0x2fc207(0x1ee)]||null),_0x2932d6[_0x2fc207(0x1fa)]!==undefined&&(_0x353c37[_0x2fc207(0x1fa)]=_0x2932d6['usdtTrcWallet']||null),_0x2932d6['usdtErcWallet']!==undefined&&(_0x353c37['usdtErcWallet']=_0x2932d6[_0x2fc207(0x1a2)]||null),_0x2932d6[_0x2fc207(0x17f)]!==undefined&&(_0x353c37[_0x2fc207(0x17f)]=_0x2932d6[_0x2fc207(0x17f)]||null),await database_1['default'][_0x2fc207(0x1f3)][_0x2fc207(0x1ff)]({'where':{'id':_0x2e44bf},'data':_0x353c37});}async[a56_0x52ce96(0x205)](_0x15082b){const _0x2be7be=a56_0x52ce96,_0x5d5659=await database_1[_0x2be7be(0x206)][_0x2be7be(0x1f3)][_0x2be7be(0x1b6)]({'where':{'id':_0x15082b},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x5d5659?.[_0x2be7be(0x19c)]?.[_0x2be7be(0x1bf)])throw new Error(_0x2be7be(0x1ed));const _0x9e6dbe={'event':_0x2be7be(0x178),'payment':{'id':_0x2be7be(0x1b2),'order_id':'test_order_123','gateway':_0x2be7be(0x178),'amount':0x64,'currency':_0x2be7be(0x1b0),'status':'paid','created_at':new Date()['toISOString']()}};try{const _0x4420d7=await fetch(_0x5d5659[_0x2be7be(0x19c)][_0x2be7be(0x1bf)],{'method':_0x2be7be(0x186),'headers':{'Content-Type':_0x2be7be(0x21b),'User-Agent':_0x2be7be(0x19a)},'body':JSON['stringify'](_0x9e6dbe)});return _0x4420d7['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x4420d7['status']+')'}:{'success':![],'message':_0x2be7be(0x1d8)+_0x4420d7[_0x2be7be(0x1c1)]+'\x20'+_0x4420d7['statusText']};}catch(_0x474b49){return{'success':![],'message':_0x2be7be(0x1e6)+(_0x474b49 instanceof Error?_0x474b49[_0x2be7be(0x209)]:_0x2be7be(0x1d9))};}}async[a56_0x52ce96(0x200)](_0xefd68d){const _0x2fee5e=a56_0x52ce96;return this[_0x2fee5e(0x1e4)][_0x2fee5e(0x179)]({'public_key':'','gateway':_0xefd68d['gateway'],'order_id':undefined,'amount':_0xefd68d[_0x2fee5e(0x1b8)],'currency':_0xefd68d[_0x2fee5e(0x20b)],'source_currency':_0xefd68d[_0x2fee5e(0x1dc)],'usage':_0xefd68d[_0x2fee5e(0x1fd)],'expires_at':_0xefd68d['expiresAt']?.[_0x2fee5e(0x208)](),'success_url':_0xefd68d['redirectUrl'],'fail_url':_0xefd68d[_0x2fee5e(0x1e7)],'customer_email':_0xefd68d[_0x2fee5e(0x1e2)],'customer_name':_0xefd68d[_0x2fee5e(0x180)],'country':_0xefd68d[_0x2fee5e(0x18d)],'language':_0xefd68d['language'],'amount_is_editable':_0xefd68d[_0x2fee5e(0x20e)],'max_payments':_0xefd68d[_0x2fee5e(0x219)],'customer':_0xefd68d[_0x2fee5e(0x215)]});}async[a56_0x52ce96(0x1f8)](_0x1d72b3,_0x46a5e4){const _0x74edaa=a56_0x52ce96;return this[_0x74edaa(0x1e4)][_0x74edaa(0x1fc)](_0x1d72b3,_0x46a5e4);}async[a56_0x52ce96(0x19e)](_0x4896f8,_0x28a667){const _0x1b8c28=a56_0x52ce96;return this[_0x1b8c28(0x1e4)]['getPaymentByShopAndId'](_0x4896f8,_0x28a667);}async[a56_0x52ce96(0x1f2)](_0x5253f4,_0x3cc8c5,_0x363564){const _0x4772ed=a56_0x52ce96,_0x56f527=await database_1[_0x4772ed(0x206)][_0x4772ed(0x1a0)][_0x4772ed(0x17c)]({'where':{'id':_0x3cc8c5,'shopId':_0x5253f4}});if(!_0x56f527)throw new Error(_0x4772ed(0x192));const _0x43fafb=await database_1['default'][_0x4772ed(0x1a0)][_0x4772ed(0x1ff)]({'where':{'id':_0x3cc8c5},'data':{..._0x363564,'updatedAt':new Date()}});return _0x43fafb;}async[a56_0x52ce96(0x17d)](_0x270533,_0x59b405){const _0x1fa1b9=a56_0x52ce96,_0x245e89=await database_1[_0x1fa1b9(0x206)][_0x1fa1b9(0x1a0)][_0x1fa1b9(0x17c)]({'where':{'id':_0x59b405,'shopId':_0x270533}});if(!_0x245e89)throw new Error('Payment\x20not\x20found');await database_1[_0x1fa1b9(0x206)]['payment']['delete']({'where':{'id':_0x59b405}});}[a56_0x52ce96(0x185)](_0xfb2279){const _0x397fa0=a56_0x52ce96,_0x265895={'polygon':_0x397fa0(0x20d),'trc20':_0x397fa0(0x1a8),'erc20':_0x397fa0(0x1db),'bsc':'USDT\x20BSC','polygon_usdc':_0x397fa0(0x1ea)};return _0x265895[_0xfb2279]||_0xfb2279;}async[a56_0x52ce96(0x218)](_0x3dce3b,_0x1806f8){const _0x37cc7c=a56_0x52ce96,{page:_0x1c3967,limit:_0xf4e90a,status:_0x877f78,method:_0x291ab8,network:_0x315d73,dateFrom:_0xc84c8b,dateTo:_0x3890d0,periodFrom:_0x5cc4e5,periodTo:_0x1afd0c}=_0x1806f8,_0x23ac29=(_0x1c3967-0x1)*_0xf4e90a;console[_0x37cc7c(0x1d0)](_0x37cc7c(0x196),_0x1806f8);const _0x54dc84={'shopId':_0x3dce3b};_0x877f78&&(_0x54dc84['status']=_0x877f78[_0x37cc7c(0x198)](),console[_0x37cc7c(0x1d0)](_0x37cc7c(0x19f)+_0x877f78['toUpperCase']()));if(_0x291ab8)_0x54dc84[_0x37cc7c(0x182)]=_0x291ab8,console[_0x37cc7c(0x1d0)](_0x37cc7c(0x19b)+_0x291ab8);else _0x315d73&&(_0x54dc84[_0x37cc7c(0x182)]=_0x315d73,console[_0x37cc7c(0x1d0)](_0x37cc7c(0x207)+_0x315d73));if(_0xc84c8b||_0x3890d0||_0x5cc4e5||_0x1afd0c){_0x54dc84['createdAt']={};if(_0x5cc4e5){const _0x50f8e6=new Date(_0x5cc4e5);_0x50f8e6[_0x37cc7c(0x183)](0x0,0x0,0x0,0x0),_0x54dc84[_0x37cc7c(0x1ec)][_0x37cc7c(0x1c9)]=_0x50f8e6,console['log'](_0x37cc7c(0x1df)+_0x50f8e6[_0x37cc7c(0x208)]());}else{if(_0xc84c8b){const _0xe7ebb3=new Date(_0xc84c8b);_0xe7ebb3[_0x37cc7c(0x183)](0x0,0x0,0x0,0x0),_0x54dc84[_0x37cc7c(0x1ec)]['gte']=_0xe7ebb3,console['log'](_0x37cc7c(0x1ab)+_0xe7ebb3[_0x37cc7c(0x208)]());}}if(_0x1afd0c){const _0x2c2dc2=new Date(_0x1afd0c);_0x2c2dc2[_0x37cc7c(0x183)](0x17,0x3b,0x3b,0x3e7),_0x54dc84[_0x37cc7c(0x1ec)]['lte']=_0x2c2dc2,console[_0x37cc7c(0x1d0)]('📅\x20Period\x20end:\x20'+_0x2c2dc2['toISOString']());}else{if(_0x3890d0){const _0x2cf36c=new Date(_0x3890d0);_0x2cf36c[_0x37cc7c(0x183)](0x17,0x3b,0x3b,0x3e7),_0x54dc84[_0x37cc7c(0x1ec)]['lte']=_0x2cf36c,console[_0x37cc7c(0x1d0)](_0x37cc7c(0x1bc)+_0x2cf36c['toISOString']());}}}console[_0x37cc7c(0x1d0)](_0x37cc7c(0x210),JSON[_0x37cc7c(0x191)](_0x54dc84,null,0x2));const [_0x3579c0,_0xb0e981]=await Promise[_0x37cc7c(0x1b4)]([database_1[_0x37cc7c(0x206)]['payout'][_0x37cc7c(0x1e9)]({'where':_0x54dc84,'skip':_0x23ac29,'take':_0xf4e90a,'orderBy':{'createdAt':_0x37cc7c(0x1ca)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x37cc7c(0x206)]['payout'][_0x37cc7c(0x1e3)]({'where':_0x54dc84})]);return{'payouts':_0x3579c0['map'](_0xb0cfa0=>{const _0x471ee1=_0x37cc7c;let _0x615f5c=null;switch(_0xb0cfa0[_0x471ee1(0x182)]){case _0x471ee1(0x1cc):_0x615f5c=_0xb0cfa0[_0x471ee1(0x1f3)][_0x471ee1(0x1ee)];break;case _0x471ee1(0x1c2):_0x615f5c=_0xb0cfa0[_0x471ee1(0x1f3)][_0x471ee1(0x1fa)];break;case _0x471ee1(0x173):_0x615f5c=_0xb0cfa0[_0x471ee1(0x1f3)][_0x471ee1(0x1a2)];break;case _0x471ee1(0x1f6):_0x615f5c=_0xb0cfa0['shop'][_0x471ee1(0x17f)];break;}return{'id':_0xb0cfa0['id'],'amount':_0xb0cfa0[_0x471ee1(0x1b8)],'network':this[_0x471ee1(0x185)](_0xb0cfa0[_0x471ee1(0x182)]),'wallet':_0x615f5c,'status':_0xb0cfa0[_0x471ee1(0x1c1)],'txid':_0xb0cfa0[_0x471ee1(0x199)],'notes':_0xb0cfa0[_0x471ee1(0x1c7)],'periodFrom':_0xb0cfa0[_0x471ee1(0x1bd)],'periodTo':_0xb0cfa0[_0x471ee1(0x1cf)],'createdAt':_0xb0cfa0['createdAt'],'paidAt':_0xb0cfa0[_0x471ee1(0x201)]};}),'pagination':{'page':_0x1c3967,'limit':_0xf4e90a,'total':_0xb0e981,'totalPages':Math[_0x37cc7c(0x17a)](_0xb0e981/_0xf4e90a)}};}async[a56_0x52ce96(0x1d3)](_0x5e11fc,_0x235563){const _0x3fea73=a56_0x52ce96,_0x5672cc=await database_1[_0x3fea73(0x206)][_0x3fea73(0x1f0)]['findFirst']({'where':{'id':_0x235563,'shopId':_0x5e11fc}});if(!_0x5672cc)return null;return{'id':_0x5672cc['id'],'amount':_0x5672cc[_0x3fea73(0x1b8)],'network':_0x5672cc[_0x3fea73(0x182)],'status':_0x5672cc[_0x3fea73(0x1c1)],'txid':_0x5672cc[_0x3fea73(0x199)],'notes':_0x5672cc[_0x3fea73(0x1c7)],'createdAt':_0x5672cc[_0x3fea73(0x1ec)],'paidAt':_0x5672cc[_0x3fea73(0x201)]};}async[a56_0x52ce96(0x197)](_0x243ecd,_0x59e280){const _0x18eabc=a56_0x52ce96,_0x44fd45=new Date();let _0x2eaf33;switch(_0x59e280){case'7d':_0x2eaf33=new Date(_0x44fd45['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x18eabc(0x1b9):_0x2eaf33=new Date(_0x44fd45['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x18eabc(0x1ef):_0x2eaf33=new Date(_0x44fd45[_0x18eabc(0x1d5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2eaf33=new Date(_0x44fd45['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x34c358,_0xbc7cc,_0x2b4e7f,_0x2736c6,_0xeb0d68,_0x17a412]=await Promise[_0x18eabc(0x1b4)]([database_1['default'][_0x18eabc(0x1f0)]['count']({'where':{'shopId':_0x243ecd,'createdAt':{'gte':_0x2eaf33}}}),database_1[_0x18eabc(0x206)][_0x18eabc(0x1f0)]['count']({'where':{'shopId':_0x243ecd,'status':'COMPLETED','createdAt':{'gte':_0x2eaf33}}}),database_1[_0x18eabc(0x206)]['payout'][_0x18eabc(0x1e3)]({'where':{'shopId':_0x243ecd,'status':'PENDING','createdAt':{'gte':_0x2eaf33}}}),database_1[_0x18eabc(0x206)][_0x18eabc(0x1f0)][_0x18eabc(0x1e3)]({'where':{'shopId':_0x243ecd,'status':'REJECTED','createdAt':{'gte':_0x2eaf33}}}),database_1[_0x18eabc(0x206)][_0x18eabc(0x1f0)][_0x18eabc(0x1e9)]({'where':{'shopId':_0x243ecd,'createdAt':{'gte':_0x2eaf33}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x18eabc(0x206)][_0x18eabc(0x1f0)][_0x18eabc(0x1e9)]({'where':{'shopId':_0x243ecd},'take':0xa,'orderBy':{'createdAt':_0x18eabc(0x1ca)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x384f0b=_0xeb0d68[_0x18eabc(0x204)]((_0x5cbcd5,_0x53a520)=>_0x5cbcd5+_0x53a520[_0x18eabc(0x1b8)],0x0),_0x5ca54f=_0xeb0d68[_0x18eabc(0x1c8)](_0x2ba158=>_0x2ba158[_0x18eabc(0x1c1)]===_0x18eabc(0x216))[_0x18eabc(0x204)]((_0x26d0f1,_0x597cae)=>_0x26d0f1+_0x597cae['amount'],0x0),_0x37d83d=_0xeb0d68[_0x18eabc(0x1c8)](_0x15a343=>_0x15a343[_0x18eabc(0x1c1)]===_0x18eabc(0x1b1))[_0x18eabc(0x204)]((_0x42e66d,_0x45965c)=>_0x42e66d+_0x45965c[_0x18eabc(0x1b8)],0x0),_0x2e2225=_0xeb0d68[_0x18eabc(0x204)]((_0x548c30,_0x5361ce)=>{const _0x370656=_0x18eabc;return _0x548c30[_0x5361ce['network']]=(_0x548c30[_0x5361ce[_0x370656(0x182)]]||0x0)+0x1,_0x548c30;},{}),_0x403e88=_0xeb0d68[_0x18eabc(0x204)]((_0x2850ce,_0x35d224)=>{const _0x206dc1=_0x18eabc;return _0x2850ce[_0x35d224[_0x206dc1(0x1c1)]]=(_0x2850ce[_0x35d224['status']]||0x0)+0x1,_0x2850ce;},{});return{'totalPayouts':_0x34c358,'completedPayouts':_0xbc7cc,'pendingPayouts':_0x2b4e7f,'rejectedPayouts':_0x2736c6,'totalAmount':_0x384f0b,'completedAmount':_0x5ca54f,'pendingAmount':_0x37d83d,'payoutsByMethod':_0x2e2225,'payoutsByStatus':_0x403e88,'recentPayouts':_0x17a412[_0x18eabc(0x181)](_0x6f1282=>({'id':_0x6f1282['id'],'shopId':_0x243ecd,'amount':_0x6f1282[_0x18eabc(0x1b8)],'method':_0x6f1282['network'],'status':_0x6f1282[_0x18eabc(0x1c1)],'txid':_0x6f1282[_0x18eabc(0x199)],'createdAt':_0x6f1282[_0x18eabc(0x1ec)],'paidAt':_0x6f1282[_0x18eabc(0x201)]}))};}async[a56_0x52ce96(0x1c5)](_0x1185fa){const _0x586f14=a56_0x52ce96;console['log']('📊\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20'+_0x1185fa+_0x586f14(0x1d7));const _0x40d555=await database_1['default'][_0x586f14(0x1f3)][_0x586f14(0x1b6)]({'where':{'id':_0x1185fa},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x40d555)throw new Error(_0x586f14(0x1e1));const _0x3d7f9f=new Date(),_0x3b55aa=new Date(_0x3d7f9f[_0x586f14(0x1fb)](),_0x3d7f9f['getMonth'](),0x1),_0x201ede=new Date(_0x3d7f9f['getFullYear'](),_0x3d7f9f[_0x586f14(0x18b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x331cc6=await database_1['default'][_0x586f14(0x1f0)][_0x586f14(0x1e5)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1185fa,'createdAt':{'gte':_0x3b55aa,'lte':_0x201ede},'status':_0x586f14(0x216)}}),_0x3f90bc=_0x331cc6[_0x586f14(0x190)][_0x586f14(0x1b8)]||0x0,_0x25395d={'availableBalance':Math[_0x586f14(0x1c3)](_0x40d555['balance']*0x64)/0x64,'totalPaidOut':Math[_0x586f14(0x1c3)](_0x40d555[_0x586f14(0x1d2)]*0x64)/0x64,'awaitingPayout':Math[_0x586f14(0x1c3)](_0x40d555[_0x586f14(0x1a9)]*0x64)/0x64,'thisMonth':Math['round'](_0x3f90bc*0x64)/0x64};return console[_0x586f14(0x1d0)]('📊\x20Shop\x20'+_0x40d555[_0x586f14(0x1a7)]+_0x586f14(0x1bb)),console['log'](_0x586f14(0x188)+_0x25395d[_0x586f14(0x1ae)]+_0x586f14(0x1be)),console[_0x586f14(0x1d0)]('\x20\x20\x20💰\x20Total\x20paid\x20out:\x20'+_0x25395d[_0x586f14(0x1d2)]+_0x586f14(0x1f1)),console['log']('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x25395d['awaitingPayout']+_0x586f14(0x1be)),console['log'](_0x586f14(0x176)+_0x25395d['thisMonth']+'\x20USDT'),_0x25395d;}[a56_0x52ce96(0x1de)](_0x43270b){const _0x279ca6=a56_0x52ce96,_0x1eff39={'test_gateway':_0x279ca6(0x17e),'plisio':_0x279ca6(0x177),'rapyd':_0x279ca6(0x1e0),'noda':'Noda','cointopay':'CoinToPay','klyme_eu':_0x279ca6(0x1eb),'klyme_gb':_0x279ca6(0x1b7),'klyme_de':'KLYME\x20DE'};return _0x1eff39[_0x43270b]||_0x43270b;}async['getPayoutStats'](_0x4d7456){const _0x2ecca2=a56_0x52ce96;return this[_0x2ecca2(0x1c5)](_0x4d7456);}async['getWebhookLogs'](_0x3cb214,_0x3f63ba){const _0x15b213=a56_0x52ce96,{page:_0xfcc1c1,limit:_0x480e67,paymentId:_0xd0a20a}=_0x3f63ba,_0x2f0d93=(_0xfcc1c1-0x1)*_0x480e67,_0x1baae8={'shopId':_0x3cb214};_0xd0a20a&&(_0x1baae8[_0x15b213(0x18f)]=_0xd0a20a);const [_0x724651,_0x252bdf]=await Promise[_0x15b213(0x1b4)]([database_1['default'][_0x15b213(0x20a)][_0x15b213(0x1e9)]({'where':_0x1baae8,'skip':_0x2f0d93,'take':_0x480e67,'orderBy':{'createdAt':_0x15b213(0x1ca)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x15b213(0x206)]['webhookLog'][_0x15b213(0x1e3)]({'where':_0x1baae8})]);return{'logs':_0x724651[_0x15b213(0x181)](_0x46ef24=>({'id':_0x46ef24['id'],'paymentId':_0x46ef24[_0x15b213(0x18f)],'shopId':_0x46ef24[_0x15b213(0x18a)],'event':_0x46ef24[_0x15b213(0x212)],'statusCode':_0x46ef24['statusCode'],'retryCount':_0x46ef24[_0x15b213(0x1b3)],'responseBody':_0x46ef24[_0x15b213(0x1a1)],'createdAt':_0x46ef24[_0x15b213(0x1ec)],'payment':_0x46ef24[_0x15b213(0x1a0)]})),'pagination':{'page':_0xfcc1c1,'limit':_0x480e67,'total':_0x252bdf,'totalPages':Math[_0x15b213(0x17a)](_0x252bdf/_0x480e67)}};}async[a56_0x52ce96(0x18e)](_0x4079f8,_0x49cb71){const _0x46d89e=a56_0x52ce96,_0x423b8f=new Date();let _0x4d378c;switch(_0x49cb71){case'7d':_0x4d378c=new Date(_0x423b8f[_0x46d89e(0x1d5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x46d89e(0x1b9):_0x4d378c=new Date(_0x423b8f['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x46d89e(0x1ef):_0x4d378c=new Date(_0x423b8f[_0x46d89e(0x1d5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4d378c=new Date(_0x423b8f[_0x46d89e(0x1d5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x134cb7,_0xf06309,_0x275c82,_0x510cfc,_0x2c4244]=await Promise[_0x46d89e(0x1b4)]([database_1[_0x46d89e(0x206)][_0x46d89e(0x1a0)][_0x46d89e(0x1e3)]({'where':{'shopId':_0x4079f8,'gateway':{'not':_0x46d89e(0x1ce)},'createdAt':{'gte':_0x4d378c}}}),database_1[_0x46d89e(0x206)]['payment'][_0x46d89e(0x1e3)]({'where':{'shopId':_0x4079f8,'gateway':{'not':_0x46d89e(0x1ce)},'status':_0x46d89e(0x1cb),'createdAt':{'gte':_0x4d378c}}}),database_1[_0x46d89e(0x206)][_0x46d89e(0x1a0)][_0x46d89e(0x1e9)]({'where':{'shopId':_0x4079f8,'gateway':{'not':'test_gateway'},'status':_0x46d89e(0x1cb),'createdAt':{'gte':_0x4d378c}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x46d89e(0x206)]['payment'][_0x46d89e(0x1e9)]({'where':{'shopId':_0x4079f8,'gateway':{'not':_0x46d89e(0x1ce)}},'take':0xa,'orderBy':{'createdAt':_0x46d89e(0x1ca)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x46d89e(0x206)][_0x46d89e(0x1a0)][_0x46d89e(0x1e9)]({'where':{'shopId':_0x4079f8,'gateway':{'not':_0x46d89e(0x1ce)},'createdAt':{'gte':_0x4d378c}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0xa99ea4=0x0;for(const _0x40ddc0 of _0x275c82){if(_0x40ddc0[_0x46d89e(0x1f5)])_0xa99ea4+=_0x40ddc0['amountUSDT'];else{const _0x1c32fb=await currencyService_1[_0x46d89e(0x17b)]['convertToUSDT'](_0x40ddc0[_0x46d89e(0x1b8)],_0x40ddc0[_0x46d89e(0x20b)]);_0xa99ea4+=_0x1c32fb;}}const _0x5e01b9=this[_0x46d89e(0x213)](_0x2c4244,_0x4d378c,_0x423b8f),_0x4f5e08=_0x134cb7>0x0?_0xf06309/_0x134cb7*0x64:0x0;return{'totalPayments':_0x134cb7,'successfulPayments':_0xf06309,'totalRevenue':Math['round'](_0xa99ea4*0x64)/0x64,'conversionRate':Math[_0x46d89e(0x1c3)](_0x4f5e08*0x64)/0x64,'dailyRevenue':_0x5e01b9[_0x46d89e(0x217)],'dailyPayments':_0x5e01b9[_0x46d89e(0x1ac)],'recentPayments':_0x510cfc[_0x46d89e(0x181)](_0x2ca318=>({'id':_0x2ca318['id'],'gateway':_0x2ca318[_0x46d89e(0x1a3)],'amount':_0x2ca318['amount'],'currency':_0x2ca318[_0x46d89e(0x20b)],'status':_0x2ca318[_0x46d89e(0x1c1)],'createdAt':_0x2ca318[_0x46d89e(0x1ec)]}))};}[a56_0x52ce96(0x213)](_0x5014f4,_0x1c8e44,_0x45dd6a){const _0x45cb21=a56_0x52ce96,_0x270d8d=new Map(),_0x3fc502=new Date(_0x1c8e44);while(_0x3fc502<=_0x45dd6a){const _0x53c4bc=_0x3fc502[_0x45cb21(0x208)]()[_0x45cb21(0x1dd)]('T')[0x0];_0x270d8d['set'](_0x53c4bc,{'revenue':0x0,'count':0x0}),_0x3fc502[_0x45cb21(0x1a6)](_0x3fc502['getDate']()+0x1);}for(const _0x3c0ddd of _0x5014f4){const _0xcdaeec=_0x3c0ddd[_0x45cb21(0x1ec)][_0x45cb21(0x208)]()['split']('T')[0x0],_0x526a06=_0x270d8d[_0x45cb21(0x1d4)](_0xcdaeec);_0x526a06&&(_0x526a06['count']+=0x1,_0x3c0ddd[_0x45cb21(0x1c1)]===_0x45cb21(0x1cb)&&_0x3c0ddd['amountUSDT']&&(_0x526a06[_0x45cb21(0x195)]+=_0x3c0ddd[_0x45cb21(0x1f5)]));}const _0x37f694=[],_0x5649d2=[];for(const [_0x5eb2dc,_0x1da352]of _0x270d8d){_0x37f694[_0x45cb21(0x1d1)]({'date':_0x5eb2dc,'amount':Math[_0x45cb21(0x1c3)](_0x1da352[_0x45cb21(0x195)]*0x64)/0x64}),_0x5649d2[_0x45cb21(0x1d1)]({'date':_0x5eb2dc,'count':_0x1da352['count']});}return{'dailyRevenue':_0x37f694,'dailyPayments':_0x5649d2};}}function a56_0x2216(){const _0x1cd6c2=['webhookEvents','parse','setDate','username','USDT\x20TRC20','balance','getShopProfile','📅\x20Date\x20start:\x20','dailyPayments','1178700wTpOFj','availableBalance','telegram','USD','PENDING','test_payment_123','retryCount','all','./paymentService','findUnique','KLYME\x20GB','amount','30d','__esModule','\x20payout\x20statistics\x20calculated:','📅\x20Date\x20end:\x20','periodFrom','\x20USDT\x20(current\x20balance)','webhookUrl','publicKey','status','trc20','round','6302331bMVrfZ','getShopPayoutStats','875386yWtqPe','notes','filter','gte','desc','PAID','polygon','merchantUrl','test_gateway','periodTo','log','push','totalPaidOut','getPayoutById','get','getTime','8FXMCTh','...','Webhook\x20returned\x20error:\x20','Unknown\x20error','name','USDT\x20ERC20','sourceCurrency','split','getGatewayDisplayName','📅\x20Period\x20start:\x20','Rapyd','Shop\x20not\x20found','customerEmail','count','paymentService','aggregate','Failed\x20to\x20send\x20webhook:\x20','redirectUrl','telegramId','findMany','USDC\x20Polygon','KLYME\x20EU','createdAt','No\x20webhook\x20URL\x20configured','usdtPolygonWallet','90d','payout','\x20USDT\x20(total\x20payouts)','updatePayment','shop','18fYZsGc','amountUSDT','polygon_usdc','shopUrl','getPayments','fullName','usdtTrcWallet','getFullYear','getPaymentsByShop','usage','2411008HRbrTp','update','createPayment','paidAt','updateWallets','gatewaySettings','reduce','testWebhook','default','🌐\x20Network\x20filter:\x20','toISOString','message','webhookLog','currency','error','USDT\x20Polygon','amountIsEditable','__importDefault','📊\x20Final\x20WHERE\x20conditions:','ShopService','event','generateDailyStatistics','PaymentService','customer','COMPLETED','dailyRevenue','getPayouts','maxPayments','gateways','application/json','erc20','updateShopProfile','isArray','\x20\x20\x20📅\x20This\x20month:\x20','Plisio','test','createPublicPayment','ceil','currencyService','findFirst','deletePayment','Test\x20Gateway','usdcPolygonWallet','customerName','map','network','setHours','5cplgFU','formatNetworkName','POST','paymentGateways','\x20\x20\x20💵\x20Available\x20balance:\x20','wallets','shopId','getMonth','Error\x20parsing\x20webhook\x20events:','country','getStatistics','paymentId','_sum','stringify','Payment\x20not\x20found','924894ePvbuG','1773724GdeCRu','revenue','💰\x20Getting\x20payouts\x20with\x20filters:','getPayoutStatistics','toUpperCase','txid','TesSoft\x20Payment\x20System/1.0\x20(Test)','🌐\x20Method\x20filter:\x20','settings','4713020FKSJvF','getPaymentById','📊\x20Status\x20filter:\x20','payment','responseBody','usdtErcWallet','gateway'];a56_0x2216=function(){return _0x1cd6c2;};return a56_0x2216();}exports[a56_0x52ce96(0x211)]=ShopService;