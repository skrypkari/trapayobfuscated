'use strict';const a73_0x271dfa=a73_0x4163;(function(_0x5e93de,_0x8e2f32){const _0x654e54=a73_0x4163,_0x28d34e=_0x5e93de();while(!![]){try{const _0x28e47c=-parseInt(_0x654e54(0x281))/0x1+parseInt(_0x654e54(0x243))/0x2*(parseInt(_0x654e54(0x1f5))/0x3)+-parseInt(_0x654e54(0x27c))/0x4+parseInt(_0x654e54(0x1e4))/0x5+-parseInt(_0x654e54(0x208))/0x6+parseInt(_0x654e54(0x267))/0x7*(-parseInt(_0x654e54(0x240))/0x8)+-parseInt(_0x654e54(0x1de))/0x9*(-parseInt(_0x654e54(0x1ff))/0xa);if(_0x28e47c===_0x8e2f32)break;else _0x28d34e['push'](_0x28d34e['shift']());}catch(_0x1bd4b9){_0x28d34e['push'](_0x28d34e['shift']());}}}(a73_0x7247,0xed8d8));function a73_0x4163(_0x564d20,_0x2c2f7a){_0x564d20=_0x564d20-0x1c9;const _0x724737=a73_0x7247();let _0x41634f=_0x724737[_0x564d20];return _0x41634f;}var __importDefault=this&&this[a73_0x271dfa(0x1f2)]||function(_0x1dab2f){const _0x175834=a73_0x271dfa;return _0x1dab2f&&_0x1dab2f[_0x175834(0x252)]?_0x1dab2f:{'default':_0x1dab2f};};function a73_0x7247(){const _0x4da88d=['yesterday','USDT\x20BSC','getGatewayDisplayName','ðŸ“…\x20Custom\x20end\x20date:\x20',',\x20dateFrom:\x20','test','findFirst','ðŸ“Š\x20Getting\x20statistics\x20for\x20shop\x20','stringify','isArray','Test\x20webhook\x20sent\x20successfully\x20(','90d','PENDING','PAID','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','ðŸ“…\x20Custom\x20start\x20date:\x20','updateWallets','toLowerCase','YESTERDAY','all','error','USDT\x20Polygon','KLYME\x20EU','telegramId','amountIsEditable','usdcPolygonWallet','paid','usdtTrcWallet','sourceCurrency','ðŸŒ\x20Method\x20filter:\x20','440dVPfnm','fullName','customerEmail','14USTEyt','set','ðŸ“Š\x20Final\x20WHERE\x20conditions:','paymentService','usage','retryCount','language','statusCode','webhookUrl','paidAt','ðŸŒ\x20Network\x20filter:\x20','amountUSDT','Noda','convertToUSDT','network','__esModule','getPaymentById','usdtPolygonWallet','\x20USDT\x20(total\x20payouts)','status','shop','name','gateways','No\x20webhook\x20URL\x20configured','Webhook\x20returned\x20error:\x20','paymentGateways','CHARGEBACK','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','wallets','thisMonth','defineProperty','default','usdcErcWallet','webhookEvents','expiresAt','ðŸ“Š\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','31801sFQaTz','usdtErcWallet','periodFrom','Error\x20parsing\x20webhook\x20events:','username','asc','\x20to\x20','publicKey','../config/database','...','test_gateway','toUpperCase','polygon_usdc','totalPaidOut','\x20payout\x20statistics\x20calculated:',',\x20period:\x20','desc','telegram','currencyService','findUnique','payout','6139568ztKCvu','get','filter','ðŸ“…\x20Period\x20start:\x20','getPayoutStats','475728KVKypI','dailyPayments','erc20','USD','webhookLog','merchantUrl','CoinToPay','awaitingPayout','getDate','ðŸ’°\x20Getting\x20payouts\x20with\x20filters:','findMany','USDC\x20Ethereum','\x20USDT\x20(current\x20balance)','redirectUrl','./paymentService','createdAt','currency','getMonth','erc20_usdc','shopId','aggregate','getPayoutStatistics','customer','394299XyKEoX','delete','count','ShopService','getFullYear','statusText','6306295CrqhmK','log','gateway','ðŸ“…\x20Date\x20end:\x20','balance','responseBody','split','txid','testWebhook','now','getPayouts','payment','test_order_123','setDate','__importDefault','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','setHours','443493KoLmbN','\x20\x20\x20ðŸ’°\x20Total\x20paid\x20out:\x20','Failed\x20to\x20send\x20webhook:\x20','getShopPayoutStats','generateDailyStatistics','deletePayment','gatewaySettings','update','getShopProfile','REJECTED','220LaoxhF','amount','parse','paymentId','settings','Shop\x20not\x20found','getPaymentsByShop','gte','COMPLETED','158502Vtezlc','revenue','getTime','Payment\x20not\x20found','./currencyService','toISOString','day','USDT\x20TRC20','30d','lte','map','dailyRevenue','2020-01-01','createPublicPayment','event','Plisio','reduce','POST','getPayoutById','round','PaymentService','trc20','test_payment_123','notes','shopUrl','\x20USDT'];a73_0x7247=function(){return _0x4da88d;};return a73_0x7247();}Object[a73_0x271dfa(0x261)](exports,a73_0x271dfa(0x252),{'value':!![]}),exports[a73_0x271dfa(0x1e1)]=void 0x0;const database_1=__importDefault(require(a73_0x271dfa(0x26f))),currencyService_1=require(a73_0x271dfa(0x20c)),paymentService_1=require(a73_0x271dfa(0x1d5));class ShopService{constructor(){const _0x2cb033=a73_0x271dfa;this[_0x2cb033(0x246)]=new paymentService_1[(_0x2cb033(0x21c))]();}async[a73_0x271dfa(0x1fd)](_0x5de2e6){const _0x55a04b=a73_0x271dfa,_0x54beba=await database_1['default'][_0x55a04b(0x257)]['findUnique']({'where':{'id':_0x5de2e6},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x54beba)throw new Error(_0x55a04b(0x204));let _0x4570a2=[];if(_0x54beba['settings']?.[_0x55a04b(0x264)])try{_0x4570a2=Array['isArray'](_0x54beba['settings'][_0x55a04b(0x264)])?_0x54beba[_0x55a04b(0x203)][_0x55a04b(0x264)]:JSON[_0x55a04b(0x201)](_0x54beba['settings'][_0x55a04b(0x264)]);}catch(_0x1f317f){console[_0x55a04b(0x236)](_0x55a04b(0x26a),_0x1f317f),_0x4570a2=[];}return{'id':_0x54beba['id'],'fullName':_0x54beba['name'],'username':_0x54beba[_0x55a04b(0x26b)],'telegramId':_0x54beba[_0x55a04b(0x278)],'merchantUrl':_0x54beba[_0x55a04b(0x220)],'gateways':_0x54beba[_0x55a04b(0x25c)]?JSON['parse'](_0x54beba[_0x55a04b(0x25c)]):null,'gatewaySettings':_0x54beba[_0x55a04b(0x1fb)]?JSON[_0x55a04b(0x201)](_0x54beba[_0x55a04b(0x1fb)]):null,'publicKey':_0x54beba[_0x55a04b(0x26e)],'webhookUrl':_0x54beba[_0x55a04b(0x203)]?.[_0x55a04b(0x24b)]||null,'webhookEvents':_0x4570a2,'wallets':{'usdtPolygonWallet':_0x54beba[_0x55a04b(0x254)],'usdtTrcWallet':_0x54beba[_0x55a04b(0x23d)],'usdtErcWallet':_0x54beba[_0x55a04b(0x268)],'usdcPolygonWallet':_0x54beba[_0x55a04b(0x23b)],'usdcErcWallet':_0x54beba['usdcErcWallet']},'status':_0x54beba['status'],'createdAt':_0x54beba[_0x55a04b(0x1d6)]};}async['updateShopProfile'](_0x37e1ca,_0x822cd){const _0x485061=a73_0x271dfa,_0x319667={};_0x822cd[_0x485061(0x241)]&&(_0x319667[_0x485061(0x258)]=_0x822cd[_0x485061(0x241)]);_0x822cd[_0x485061(0x239)]!==undefined&&(_0x319667[_0x485061(0x278)]=_0x822cd[_0x485061(0x239)]||null);_0x822cd[_0x485061(0x1cc)]&&(_0x319667[_0x485061(0x220)]=_0x822cd[_0x485061(0x1cc)]);_0x822cd[_0x485061(0x259)]&&(_0x319667[_0x485061(0x25c)]=JSON[_0x485061(0x22a)](_0x822cd[_0x485061(0x259)]));_0x822cd[_0x485061(0x1fb)]&&(_0x319667['gatewaySettings']=JSON[_0x485061(0x22a)](_0x822cd[_0x485061(0x1fb)]));_0x822cd['wallets']&&(_0x822cd[_0x485061(0x25f)][_0x485061(0x254)]!==undefined&&(_0x319667[_0x485061(0x254)]=_0x822cd[_0x485061(0x25f)][_0x485061(0x254)]||null),_0x822cd['wallets']['usdtTrcWallet']!==undefined&&(_0x319667[_0x485061(0x23d)]=_0x822cd['wallets'][_0x485061(0x23d)]||null),_0x822cd['wallets'][_0x485061(0x268)]!==undefined&&(_0x319667[_0x485061(0x268)]=_0x822cd[_0x485061(0x25f)][_0x485061(0x268)]||null),_0x822cd['wallets'][_0x485061(0x23b)]!==undefined&&(_0x319667['usdcPolygonWallet']=_0x822cd[_0x485061(0x25f)][_0x485061(0x23b)]||null));const _0x239176=await database_1[_0x485061(0x262)][_0x485061(0x257)][_0x485061(0x1fc)]({'where':{'id':_0x37e1ca},'data':_0x319667,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x2f334e=[];if(_0x239176[_0x485061(0x203)]?.[_0x485061(0x264)])try{_0x2f334e=Array[_0x485061(0x22b)](_0x239176[_0x485061(0x203)][_0x485061(0x264)])?_0x239176[_0x485061(0x203)]['webhookEvents']:JSON[_0x485061(0x201)](_0x239176['settings'][_0x485061(0x264)]);}catch(_0x490476){console['error'](_0x485061(0x26a),_0x490476),_0x2f334e=[];}return{'id':_0x239176['id'],'fullName':_0x239176['name'],'username':_0x239176[_0x485061(0x26b)],'telegramId':_0x239176[_0x485061(0x278)],'merchantUrl':_0x239176[_0x485061(0x220)],'gateways':_0x239176[_0x485061(0x25c)]?JSON['parse'](_0x239176[_0x485061(0x25c)]):null,'gatewaySettings':_0x239176[_0x485061(0x1fb)]?JSON[_0x485061(0x201)](_0x239176[_0x485061(0x1fb)]):null,'publicKey':_0x239176['publicKey'],'webhookUrl':_0x239176[_0x485061(0x203)]?.[_0x485061(0x24b)]||null,'webhookEvents':_0x2f334e,'wallets':{'usdtPolygonWallet':_0x239176[_0x485061(0x254)],'usdtTrcWallet':_0x239176[_0x485061(0x23d)],'usdtErcWallet':_0x239176['usdtErcWallet'],'usdcPolygonWallet':_0x239176[_0x485061(0x23b)],'usdcErcWallet':_0x239176[_0x485061(0x263)]},'status':_0x239176[_0x485061(0x256)],'createdAt':_0x239176[_0x485061(0x1d6)]};}async[a73_0x271dfa(0x232)](_0x303366,_0x2b9728){const _0x106a3f=a73_0x271dfa,_0x4e8d4e={};_0x2b9728[_0x106a3f(0x254)]!==undefined&&(_0x4e8d4e['usdtPolygonWallet']=_0x2b9728[_0x106a3f(0x254)]||null),_0x2b9728[_0x106a3f(0x23d)]!==undefined&&(_0x4e8d4e[_0x106a3f(0x23d)]=_0x2b9728[_0x106a3f(0x23d)]||null),_0x2b9728[_0x106a3f(0x268)]!==undefined&&(_0x4e8d4e['usdtErcWallet']=_0x2b9728['usdtErcWallet']||null),_0x2b9728[_0x106a3f(0x23b)]!==undefined&&(_0x4e8d4e[_0x106a3f(0x23b)]=_0x2b9728[_0x106a3f(0x23b)]||null),_0x2b9728['usdcErcWallet']!==undefined&&(_0x4e8d4e[_0x106a3f(0x263)]=_0x2b9728[_0x106a3f(0x263)]||null),await database_1[_0x106a3f(0x262)][_0x106a3f(0x257)][_0x106a3f(0x1fc)]({'where':{'id':_0x303366},'data':_0x4e8d4e});}async[a73_0x271dfa(0x1ec)](_0x472329){const _0x401a18=a73_0x271dfa,_0x144248=await database_1[_0x401a18(0x262)]['shop']['findUnique']({'where':{'id':_0x472329},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x144248?.[_0x401a18(0x203)]?.[_0x401a18(0x24b)])throw new Error(_0x401a18(0x25a));const _0x405179={'event':'test','payment':{'id':_0x401a18(0x21e),'order_id':_0x401a18(0x1f0),'gateway':_0x401a18(0x227),'amount':0x64,'currency':_0x401a18(0x1ca),'status':_0x401a18(0x23c),'created_at':new Date()[_0x401a18(0x20d)]()}};try{const _0x17d3ca=await fetch(_0x144248[_0x401a18(0x203)]['webhookUrl'],{'method':_0x401a18(0x219),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0\x20(Test)'},'body':JSON[_0x401a18(0x22a)](_0x405179)});return _0x17d3ca['ok']?{'success':!![],'message':_0x401a18(0x22c)+_0x17d3ca['status']+')'}:{'success':![],'message':_0x401a18(0x25b)+_0x17d3ca[_0x401a18(0x256)]+'\x20'+_0x17d3ca[_0x401a18(0x1e3)]};}catch(_0x3dcca3){return{'success':![],'message':_0x401a18(0x1f7)+(_0x3dcca3 instanceof Error?_0x3dcca3['message']:'Unknown\x20error')};}}async['createPayment'](_0x373eee){const _0x344c2f=a73_0x271dfa;return this[_0x344c2f(0x246)][_0x344c2f(0x215)]({'public_key':'','gateway':_0x373eee[_0x344c2f(0x1e6)],'order_id':undefined,'amount':_0x373eee[_0x344c2f(0x200)],'currency':_0x373eee[_0x344c2f(0x1d7)],'source_currency':_0x373eee[_0x344c2f(0x23e)],'usage':_0x373eee[_0x344c2f(0x247)],'expires_at':_0x373eee[_0x344c2f(0x265)]?.[_0x344c2f(0x20d)](),'success_url':_0x373eee['redirectUrl'],'fail_url':_0x373eee[_0x344c2f(0x1d4)],'customer_email':_0x373eee[_0x344c2f(0x242)],'customer_name':_0x373eee['customerName'],'country':_0x373eee['country'],'language':_0x373eee[_0x344c2f(0x249)],'amount_is_editable':_0x373eee[_0x344c2f(0x23a)],'max_payments':_0x373eee['maxPayments'],'customer':_0x373eee[_0x344c2f(0x1dd)]});}async['getPayments'](_0x235c77,_0x539970){const _0x4d346b=a73_0x271dfa;return this[_0x4d346b(0x246)][_0x4d346b(0x205)](_0x235c77,_0x539970);}async[a73_0x271dfa(0x253)](_0x3a5dfb,_0x28467b){const _0xbec2b5=a73_0x271dfa;return this[_0xbec2b5(0x246)]['getPaymentByShopAndId'](_0x3a5dfb,_0x28467b);}async['updatePayment'](_0x3bca8b,_0x2581f2,_0x4051ed){const _0x449c29=a73_0x271dfa,_0x52c986=await database_1[_0x449c29(0x262)][_0x449c29(0x1ef)][_0x449c29(0x228)]({'where':{'id':_0x2581f2,'shopId':_0x3bca8b}});if(!_0x52c986)throw new Error(_0x449c29(0x20b));const _0x40f8f6=await database_1[_0x449c29(0x262)]['payment'][_0x449c29(0x1fc)]({'where':{'id':_0x2581f2},'data':{..._0x4051ed,'updatedAt':new Date()}});return _0x40f8f6;}async[a73_0x271dfa(0x1fa)](_0x409f40,_0x25d7c2){const _0x13f1d5=a73_0x271dfa,_0x44dfc5=await database_1[_0x13f1d5(0x262)][_0x13f1d5(0x1ef)][_0x13f1d5(0x228)]({'where':{'id':_0x25d7c2,'shopId':_0x409f40}});if(!_0x44dfc5)throw new Error(_0x13f1d5(0x20b));await database_1[_0x13f1d5(0x262)][_0x13f1d5(0x1ef)][_0x13f1d5(0x1df)]({'where':{'id':_0x25d7c2}});}['formatNetworkName'](_0x1582d1){const _0x343d68=a73_0x271dfa,_0x447383={'polygon':_0x343d68(0x237),'trc20':_0x343d68(0x20f),'erc20':'USDT\x20ERC20','bsc':_0x343d68(0x223),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x343d68(0x1d2)};return _0x447383[_0x1582d1]||_0x1582d1;}async[a73_0x271dfa(0x1ee)](_0x256d2b,_0x261845){const _0x1de874=a73_0x271dfa,{page:_0x4e2a35,limit:_0x131bf4,status:_0x308a7e,method:_0xd92f6e,network:_0x123695,dateFrom:_0x356df6,dateTo:_0x49741a,periodFrom:_0x37e7ed,periodTo:_0xdfd618}=_0x261845,_0x328069=(_0x4e2a35-0x1)*_0x131bf4;console[_0x1de874(0x1e5)](_0x1de874(0x1d0),_0x261845);const _0x34fedf={'shopId':_0x256d2b};_0x308a7e&&(_0x34fedf['status']=_0x308a7e[_0x1de874(0x272)](),console[_0x1de874(0x1e5)]('ðŸ“Š\x20Status\x20filter:\x20'+_0x308a7e['toUpperCase']()));if(_0xd92f6e)_0x34fedf['network']=_0xd92f6e,console[_0x1de874(0x1e5)](_0x1de874(0x23f)+_0xd92f6e);else _0x123695&&(_0x34fedf[_0x1de874(0x251)]=_0x123695,console['log'](_0x1de874(0x24d)+_0x123695));if(_0x356df6||_0x49741a||_0x37e7ed||_0xdfd618){_0x34fedf[_0x1de874(0x1d6)]={};if(_0x37e7ed){const _0x387cc6=new Date(_0x37e7ed);_0x387cc6[_0x1de874(0x1f4)](0x0,0x0,0x0,0x1),_0x34fedf[_0x1de874(0x1d6)][_0x1de874(0x206)]=_0x387cc6,console[_0x1de874(0x1e5)](_0x1de874(0x27f)+_0x387cc6[_0x1de874(0x20d)]());}else{if(_0x356df6){const _0x5e883b=new Date(_0x356df6);_0x5e883b[_0x1de874(0x1f4)](0x0,0x0,0x0,0x1),_0x34fedf[_0x1de874(0x1d6)][_0x1de874(0x206)]=_0x5e883b,console[_0x1de874(0x1e5)]('ðŸ“…\x20Date\x20start:\x20'+_0x5e883b['toISOString']());}}if(_0xdfd618){const _0xc55f0e=new Date(_0xdfd618);_0xc55f0e[_0x1de874(0x1f4)](0x17,0x3b,0x3b,0x3e7),_0x34fedf[_0x1de874(0x1d6)][_0x1de874(0x211)]=_0xc55f0e,console[_0x1de874(0x1e5)]('ðŸ“…\x20Period\x20end:\x20'+_0xc55f0e[_0x1de874(0x20d)]());}else{if(_0x49741a){const _0xcd7267=new Date(_0x49741a);_0xcd7267[_0x1de874(0x1f4)](0x17,0x3b,0x3b,0x3e7),_0x34fedf[_0x1de874(0x1d6)][_0x1de874(0x211)]=_0xcd7267,console[_0x1de874(0x1e5)](_0x1de874(0x1e7)+_0xcd7267['toISOString']());}}}console['log'](_0x1de874(0x245),JSON[_0x1de874(0x22a)](_0x34fedf,null,0x2));const [_0x6fae24,_0x31f0c9]=await Promise['all']([database_1[_0x1de874(0x262)][_0x1de874(0x27b)]['findMany']({'where':_0x34fedf,'skip':_0x328069,'take':_0x131bf4,'orderBy':{'createdAt':_0x1de874(0x277)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1['default'][_0x1de874(0x27b)][_0x1de874(0x1e0)]({'where':_0x34fedf})]);return{'payouts':_0x6fae24['map'](_0x5d15c7=>{const _0x58f01b=_0x1de874;let _0x47ba05=null;switch(_0x5d15c7[_0x58f01b(0x251)]){case'polygon':_0x47ba05=_0x5d15c7[_0x58f01b(0x257)][_0x58f01b(0x254)];break;case _0x58f01b(0x21d):_0x47ba05=_0x5d15c7['shop']['usdtTrcWallet'];break;case _0x58f01b(0x1c9):_0x47ba05=_0x5d15c7['shop'][_0x58f01b(0x268)];break;case _0x58f01b(0x273):_0x47ba05=_0x5d15c7['shop']['usdcPolygonWallet'];break;case _0x58f01b(0x1d9):_0x47ba05=_0x5d15c7[_0x58f01b(0x257)][_0x58f01b(0x263)];break;}return{'id':_0x5d15c7['id'],'amount':_0x5d15c7[_0x58f01b(0x200)],'network':this['formatNetworkName'](_0x5d15c7[_0x58f01b(0x251)]),'wallet':_0x47ba05,'status':_0x5d15c7[_0x58f01b(0x256)],'txid':_0x5d15c7[_0x58f01b(0x1eb)],'notes':_0x5d15c7['notes'],'periodFrom':_0x5d15c7[_0x58f01b(0x269)],'periodTo':_0x5d15c7['periodTo'],'createdAt':_0x5d15c7[_0x58f01b(0x1d6)],'paidAt':_0x5d15c7[_0x58f01b(0x24c)]};}),'pagination':{'page':_0x4e2a35,'limit':_0x131bf4,'total':_0x31f0c9,'totalPages':Math['ceil'](_0x31f0c9/_0x131bf4)}};}async[a73_0x271dfa(0x21a)](_0xa8f269,_0x50e7c9){const _0x49f0f3=a73_0x271dfa,_0x117d59=await database_1[_0x49f0f3(0x262)]['payout'][_0x49f0f3(0x228)]({'where':{'id':_0x50e7c9,'shopId':_0xa8f269}});if(!_0x117d59)return null;return{'id':_0x117d59['id'],'amount':_0x117d59[_0x49f0f3(0x200)],'network':_0x117d59[_0x49f0f3(0x251)],'status':_0x117d59[_0x49f0f3(0x256)],'txid':_0x117d59['txid'],'notes':_0x117d59[_0x49f0f3(0x21f)],'createdAt':_0x117d59['createdAt'],'paidAt':_0x117d59[_0x49f0f3(0x24c)]};}async[a73_0x271dfa(0x1dc)](_0x268240,_0x19e161){const _0x49abcf=a73_0x271dfa,_0x37c145=new Date();let _0x1ba213,_0x2ae1c8;switch(_0x19e161){case _0x49abcf(0x222):case _0x49abcf(0x234):const _0x121ed3=new Date(_0x37c145);_0x121ed3[_0x49abcf(0x1f1)](_0x121ed3[_0x49abcf(0x1cf)]()-0x1),_0x1ba213=new Date(_0x121ed3),_0x1ba213[_0x49abcf(0x1f4)](0x0,0x0,0x0,0x0),_0x2ae1c8=new Date(_0x121ed3),_0x2ae1c8['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x1ba213=new Date(_0x37c145[_0x49abcf(0x20a)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x1ba213=new Date(_0x37c145[_0x49abcf(0x20a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x1ba213=new Date(_0x37c145[_0x49abcf(0x20a)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1ba213=new Date(_0x37c145[_0x49abcf(0x20a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x3a3f21={'gte':_0x1ba213};_0x2ae1c8&&(_0x3a3f21[_0x49abcf(0x211)]=_0x2ae1c8);const [_0x2a9e56,_0x3020d3,_0x59fe70,_0x32d9d6,_0x23d02a,_0x4f7d14]=await Promise[_0x49abcf(0x235)]([database_1[_0x49abcf(0x262)]['payout'][_0x49abcf(0x1e0)]({'where':{'shopId':_0x268240,'createdAt':_0x3a3f21}}),database_1[_0x49abcf(0x262)]['payout'][_0x49abcf(0x1e0)]({'where':{'shopId':_0x268240,'status':'COMPLETED','createdAt':_0x3a3f21}}),database_1[_0x49abcf(0x262)]['payout'][_0x49abcf(0x1e0)]({'where':{'shopId':_0x268240,'status':_0x49abcf(0x22e),'createdAt':_0x3a3f21}}),database_1[_0x49abcf(0x262)][_0x49abcf(0x27b)][_0x49abcf(0x1e0)]({'where':{'shopId':_0x268240,'status':_0x49abcf(0x1fe),'createdAt':_0x3a3f21}}),database_1[_0x49abcf(0x262)][_0x49abcf(0x27b)][_0x49abcf(0x1d1)]({'where':{'shopId':_0x268240,'createdAt':_0x3a3f21},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x49abcf(0x262)]['payout'][_0x49abcf(0x1d1)]({'where':{'shopId':_0x268240},'take':0xa,'orderBy':{'createdAt':_0x49abcf(0x277)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x3265a0=_0x23d02a['reduce']((_0x377098,_0x304898)=>_0x377098+_0x304898[_0x49abcf(0x200)],0x0),_0x490c73=_0x23d02a[_0x49abcf(0x27e)](_0x10a655=>_0x10a655['status']===_0x49abcf(0x207))['reduce']((_0x53f3e6,_0x12d4b3)=>_0x53f3e6+_0x12d4b3[_0x49abcf(0x200)],0x0),_0x1e1701=_0x23d02a['filter'](_0x380890=>_0x380890[_0x49abcf(0x256)]==='PENDING')['reduce']((_0x121acf,_0x462cfb)=>_0x121acf+_0x462cfb[_0x49abcf(0x200)],0x0),_0x1e6cb1=_0x23d02a[_0x49abcf(0x218)]((_0x547501,_0xf06f53)=>{const _0x227ea5=_0x49abcf;return _0x547501[_0xf06f53[_0x227ea5(0x251)]]=(_0x547501[_0xf06f53[_0x227ea5(0x251)]]||0x0)+0x1,_0x547501;},{}),_0x4141c0=_0x23d02a['reduce']((_0x554d6f,_0xcb901f)=>{const _0x3e1a6e=_0x49abcf;return _0x554d6f[_0xcb901f[_0x3e1a6e(0x256)]]=(_0x554d6f[_0xcb901f[_0x3e1a6e(0x256)]]||0x0)+0x1,_0x554d6f;},{});return{'totalPayouts':_0x2a9e56,'completedPayouts':_0x3020d3,'pendingPayouts':_0x59fe70,'rejectedPayouts':_0x32d9d6,'totalAmount':_0x3265a0,'completedAmount':_0x490c73,'pendingAmount':_0x1e1701,'payoutsByMethod':_0x1e6cb1,'payoutsByStatus':_0x4141c0,'recentPayouts':_0x4f7d14[_0x49abcf(0x212)](_0x305770=>({'id':_0x305770['id'],'shopId':_0x268240,'amount':_0x305770[_0x49abcf(0x200)],'method':_0x305770['network'],'status':_0x305770[_0x49abcf(0x256)],'txid':_0x305770[_0x49abcf(0x1eb)],'createdAt':_0x305770[_0x49abcf(0x1d6)],'paidAt':_0x305770[_0x49abcf(0x24c)]}))};}async[a73_0x271dfa(0x1f8)](_0xf1770d){const _0xc86329=a73_0x271dfa;console['log'](_0xc86329(0x266)+_0xf1770d+_0xc86329(0x270));const _0x33371c=await database_1[_0xc86329(0x262)]['shop'][_0xc86329(0x27a)]({'where':{'id':_0xf1770d},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x33371c)throw new Error(_0xc86329(0x204));const _0x2ea884=new Date(),_0x243ced=new Date(_0x2ea884['getFullYear'](),_0x2ea884[_0xc86329(0x1d8)](),0x1),_0x5a9248=new Date(_0x2ea884['getFullYear'](),_0x2ea884[_0xc86329(0x1d8)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1e4673=await database_1[_0xc86329(0x262)]['payout'][_0xc86329(0x1db)]({'_sum':{'amount':!![]},'where':{'shopId':_0xf1770d,'createdAt':{'gte':_0x243ced,'lte':_0x5a9248},'status':'COMPLETED'}}),_0x4ec636=_0x1e4673['_sum'][_0xc86329(0x200)]||0x0,_0xb092e7={'availableBalance':Math[_0xc86329(0x21b)](_0x33371c[_0xc86329(0x1e8)]*0x64)/0x64,'totalPaidOut':Math[_0xc86329(0x21b)](_0x33371c[_0xc86329(0x274)]*0x64)/0x64,'awaitingPayout':Math['round'](_0x33371c[_0xc86329(0x1e8)]*0x64)/0x64,'thisMonth':Math[_0xc86329(0x21b)](_0x4ec636*0x64)/0x64};return console[_0xc86329(0x1e5)]('ðŸ“Š\x20Shop\x20'+_0x33371c[_0xc86329(0x26b)]+_0xc86329(0x275)),console['log'](_0xc86329(0x1f3)+_0xb092e7['availableBalance']+'\x20USDT\x20(current\x20balance)'),console['log'](_0xc86329(0x1f6)+_0xb092e7[_0xc86329(0x274)]+_0xc86329(0x255)),console[_0xc86329(0x1e5)](_0xc86329(0x230)+_0xb092e7[_0xc86329(0x1ce)]+_0xc86329(0x1d3)),console['log'](_0xc86329(0x25e)+_0xb092e7[_0xc86329(0x260)]+_0xc86329(0x221)),_0xb092e7;}[a73_0x271dfa(0x224)](_0x5578fd){const _0x4c7a81=a73_0x271dfa,_0x5afe56={'test_gateway':'Test\x20Gateway','plisio':_0x4c7a81(0x217),'rapyd':'Rapyd','noda':_0x4c7a81(0x24f),'cointopay':_0x4c7a81(0x1cd),'klyme_eu':_0x4c7a81(0x238),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x5afe56[_0x5578fd]||_0x5578fd;}async[a73_0x271dfa(0x280)](_0x28deb5){const _0x59db4e=a73_0x271dfa;return this[_0x59db4e(0x1f8)](_0x28deb5);}async['getWebhookLogs'](_0x2bc910,_0x44ff0d){const _0x5bf7c1=a73_0x271dfa,{page:_0x561ba7,limit:_0x3f9e49,paymentId:_0x17a577}=_0x44ff0d,_0x4ba1c2=(_0x561ba7-0x1)*_0x3f9e49,_0x42490b={'shopId':_0x2bc910};_0x17a577&&(_0x42490b[_0x5bf7c1(0x202)]=_0x17a577);const [_0x2dde47,_0x9c6d75]=await Promise['all']([database_1[_0x5bf7c1(0x262)][_0x5bf7c1(0x1cb)]['findMany']({'where':_0x42490b,'skip':_0x4ba1c2,'take':_0x3f9e49,'orderBy':{'createdAt':_0x5bf7c1(0x277)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x5bf7c1(0x262)][_0x5bf7c1(0x1cb)][_0x5bf7c1(0x1e0)]({'where':_0x42490b})]);return{'logs':_0x2dde47['map'](_0x32c0a2=>({'id':_0x32c0a2['id'],'paymentId':_0x32c0a2[_0x5bf7c1(0x202)],'shopId':_0x32c0a2[_0x5bf7c1(0x1da)],'event':_0x32c0a2[_0x5bf7c1(0x216)],'statusCode':_0x32c0a2[_0x5bf7c1(0x24a)],'retryCount':_0x32c0a2[_0x5bf7c1(0x248)],'responseBody':_0x32c0a2[_0x5bf7c1(0x1e9)],'createdAt':_0x32c0a2[_0x5bf7c1(0x1d6)],'payment':_0x32c0a2['payment']})),'pagination':{'page':_0x561ba7,'limit':_0x3f9e49,'total':_0x9c6d75,'totalPages':Math['ceil'](_0x9c6d75/_0x3f9e49)}};}async['getStatistics'](_0x19f8c5,_0x40dba4,_0x12ae3e,_0xac52d9){const _0x423302=a73_0x271dfa;console[_0x423302(0x1e5)](_0x423302(0x229)+_0x19f8c5+_0x423302(0x276)+_0x40dba4+_0x423302(0x226)+_0x12ae3e+',\x20dateTo:\x20'+_0xac52d9);const _0x457468=new Date();let _0x558cd3,_0x28bf08;if(_0x12ae3e||_0xac52d9)_0x12ae3e?(_0x558cd3=new Date(_0x12ae3e),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1),console['log'](_0x423302(0x231)+_0x558cd3[_0x423302(0x20d)]())):(_0x558cd3=new Date(_0x423302(0x214)),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1)),_0xac52d9&&(_0x28bf08=new Date(_0xac52d9),_0x28bf08['setHours'](0x17,0x3b,0x3b,0x3e7),console[_0x423302(0x1e5)](_0x423302(0x225)+_0x28bf08[_0x423302(0x20d)]()));else{const _0x52802e=_0x40dba4||'30d';switch(_0x52802e[_0x423302(0x233)]()){case _0x423302(0x20e):_0x558cd3=new Date(_0x457468[_0x423302(0x1e2)](),_0x457468[_0x423302(0x1d8)](),_0x457468[_0x423302(0x1cf)](),0x0,0x0,0x0,0x1);break;case _0x423302(0x222):case _0x423302(0x234):const _0x223e75=new Date(_0x457468);_0x223e75[_0x423302(0x1f1)](_0x223e75[_0x423302(0x1cf)]()-0x1),_0x558cd3=new Date(_0x223e75),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1),_0x28bf08=new Date(_0x223e75),_0x28bf08[_0x423302(0x1f4)](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x558cd3=new Date(_0x457468['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1);break;case _0x423302(0x210):_0x558cd3=new Date(_0x457468['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1);break;case _0x423302(0x22d):_0x558cd3=new Date(_0x457468[_0x423302(0x20a)]()-0x5a*0x18*0x3c*0x3c*0x3e8),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1);break;case'1y':case'year':_0x558cd3=new Date(_0x457468[_0x423302(0x20a)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1);break;default:_0x558cd3=new Date(_0x457468[_0x423302(0x20a)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x558cd3[_0x423302(0x1f4)](0x0,0x0,0x0,0x1);}}console[_0x423302(0x1e5)]('ðŸ“…\x20Final\x20date\x20range:\x20'+_0x558cd3[_0x423302(0x20d)]()+_0x423302(0x26d)+(_0x28bf08?_0x28bf08[_0x423302(0x20d)]():_0x423302(0x1ed)));const _0x3dd2c2={'gte':_0x558cd3};_0x28bf08&&(_0x3dd2c2['lte']=_0x28bf08);const [_0x44582f,_0x7bb011,_0x320afa,_0x2ff270,_0x2e629b,_0x577020,_0x2c5986]=await Promise['all']([database_1[_0x423302(0x262)][_0x423302(0x1ef)][_0x423302(0x1e0)]({'where':{'shopId':_0x19f8c5,'gateway':{'not':_0x423302(0x271)},'createdAt':_0x3dd2c2}}),database_1[_0x423302(0x262)][_0x423302(0x1ef)][_0x423302(0x1e0)]({'where':{'shopId':_0x19f8c5,'gateway':{'not':'test_gateway'},'status':_0x423302(0x22f),'createdAt':_0x3dd2c2}}),database_1[_0x423302(0x262)][_0x423302(0x1ef)]['count']({'where':{'shopId':_0x19f8c5,'gateway':{'not':_0x423302(0x271)},'status':_0x423302(0x25d),'createdAt':_0x3dd2c2}}),database_1[_0x423302(0x262)][_0x423302(0x1ef)]['count']({'where':{'shopId':_0x19f8c5,'gateway':{'not':_0x423302(0x271)},'status':'REFUND','createdAt':_0x3dd2c2}}),database_1['default'][_0x423302(0x1ef)][_0x423302(0x1d1)]({'where':{'shopId':_0x19f8c5,'gateway':{'not':'test_gateway'},'status':_0x423302(0x22f),'createdAt':_0x3dd2c2},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x423302(0x1ef)][_0x423302(0x1d1)]({'where':{'shopId':_0x19f8c5,'gateway':{'not':_0x423302(0x271)}},'take':0xa,'orderBy':{'createdAt':_0x423302(0x277)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x423302(0x262)][_0x423302(0x1ef)][_0x423302(0x1d1)]({'where':{'shopId':_0x19f8c5,'gateway':{'not':_0x423302(0x271)},'createdAt':_0x3dd2c2},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x423302(0x26c)}})]);let _0x442932=0x0;for(const _0x19620e of _0x2e629b){if(_0x19620e[_0x423302(0x24e)])_0x442932+=_0x19620e[_0x423302(0x24e)];else{const _0x1b95bc=await currencyService_1[_0x423302(0x279)][_0x423302(0x250)](_0x19620e[_0x423302(0x200)],_0x19620e[_0x423302(0x1d7)]);_0x442932+=_0x1b95bc;}}const _0x56f23f=this[_0x423302(0x1f9)](_0x2c5986,_0x558cd3,_0x28bf08||_0x457468),_0x1ded44=_0x44582f>0x0?_0x7bb011/_0x44582f*0x64:0x0;return{'totalPayments':_0x44582f,'successfulPayments':_0x7bb011,'totalRevenue':Math['round'](_0x442932*0x64)/0x64,'conversionRate':Math[_0x423302(0x21b)](_0x1ded44*0x64)/0x64,'chargebacks':_0x320afa,'refunds':_0x2ff270,'dailyRevenue':_0x56f23f[_0x423302(0x213)],'dailyPayments':_0x56f23f[_0x423302(0x282)],'recentPayments':_0x577020[_0x423302(0x212)](_0x1ee9eb=>({'id':_0x1ee9eb['id'],'gateway':_0x1ee9eb[_0x423302(0x1e6)],'amount':_0x1ee9eb['amount'],'currency':_0x1ee9eb[_0x423302(0x1d7)],'status':_0x1ee9eb['status'],'createdAt':_0x1ee9eb[_0x423302(0x1d6)]}))};}['generateDailyStatistics'](_0x409a00,_0x1b96f1,_0x4b4744){const _0x30a4c4=a73_0x271dfa,_0x8c7410=new Map(),_0x38e132=new Date(_0x1b96f1);while(_0x38e132<=_0x4b4744){const _0x35fa96=_0x38e132[_0x30a4c4(0x20d)]()[_0x30a4c4(0x1ea)]('T')[0x0];_0x8c7410[_0x30a4c4(0x244)](_0x35fa96,{'revenue':0x0,'count':0x0}),_0x38e132[_0x30a4c4(0x1f1)](_0x38e132[_0x30a4c4(0x1cf)]()+0x1);}for(const _0x277c3c of _0x409a00){const _0x6d4b2b=_0x277c3c[_0x30a4c4(0x1d6)][_0x30a4c4(0x20d)]()[_0x30a4c4(0x1ea)]('T')[0x0],_0x59c798=_0x8c7410[_0x30a4c4(0x27d)](_0x6d4b2b);_0x59c798&&(_0x59c798['count']+=0x1,_0x277c3c[_0x30a4c4(0x256)]==='PAID'&&_0x277c3c[_0x30a4c4(0x24e)]&&(_0x59c798[_0x30a4c4(0x209)]+=_0x277c3c['amountUSDT']));}const _0x3f5051=[],_0xdcea3b=[];for(const [_0x7ada0f,_0x5c0685]of _0x8c7410){_0x3f5051['push']({'date':_0x7ada0f,'amount':Math['round'](_0x5c0685[_0x30a4c4(0x209)]*0x64)/0x64}),_0xdcea3b['push']({'date':_0x7ada0f,'count':_0x5c0685[_0x30a4c4(0x1e0)]});}return{'dailyRevenue':_0x3f5051,'dailyPayments':_0xdcea3b};}}exports[a73_0x271dfa(0x1e1)]=ShopService;