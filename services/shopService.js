'use strict';const a54_0x3b3695=a54_0x5998;(function(_0x56e23b,_0x2efcbf){const _0x2306ca=a54_0x5998,_0xef42b6=_0x56e23b();while(!![]){try{const _0x3e6073=parseInt(_0x2306ca(0x101))/0x1+parseInt(_0x2306ca(0x13d))/0x2*(parseInt(_0x2306ca(0xb4))/0x3)+-parseInt(_0x2306ca(0x103))/0x4+parseInt(_0x2306ca(0x11f))/0x5+parseInt(_0x2306ca(0xb5))/0x6+parseInt(_0x2306ca(0x12c))/0x7+-parseInt(_0x2306ca(0xe9))/0x8*(-parseInt(_0x2306ca(0x112))/0x9);if(_0x3e6073===_0x2efcbf)break;else _0xef42b6['push'](_0xef42b6['shift']());}catch(_0x9eb3c){_0xef42b6['push'](_0xef42b6['shift']());}}}(a54_0x59dc,0x3f9db));var __importDefault=this&&this[a54_0x3b3695(0xe4)]||function(_0x609719){return _0x609719&&_0x609719['__esModule']?_0x609719:{'default':_0x609719};};Object[a54_0x3b3695(0x133)](exports,a54_0x3b3695(0x144),{'value':!![]}),exports[a54_0x3b3695(0x10a)]=void 0x0;function a54_0x5998(_0x191f10,_0x24eccd){const _0x59dcb3=a54_0x59dc();return a54_0x5998=function(_0x59984e,_0x668737){_0x59984e=_0x59984e-0xb0;let _0x23a91f=_0x59dcb3[_0x59984e];return _0x23a91f;},a54_0x5998(_0x191f10,_0x24eccd);}const database_1=__importDefault(require('../config/database')),currencyService_1=require('./currencyService'),paymentService_1=require('./paymentService');function a54_0x59dc(){const _0x498801=['90d','paid','customerEmail','Noda','KLYME\x20DE','getFullYear','currency','getPayoutStatistics','all','findUnique','setDate','POST','network','currencyService','gateway','getShopPayoutStats','amount','error','wallets','dailyPayments','__importDefault','erc20','usdtPolygonWallet','trc20','TesSoft\x20Payment\x20System/1.0\x20(Test)','16mPrEwn','publicKey','COMPLETED','üåê\x20Network\x20filter:\x20','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','setHours','sourceCurrency','gte','getPaymentByShopAndId','awaitingPayout','paymentId','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','message','usage','retryCount','PAID','30d','settings','maxPayments','delete','\x20\x20\x20üíµ\x20Available\x20balance:\x20','test_payment_123','USDT\x20Polygon','push','18027DLYgZq','application/json','1890172lZYsih','amountUSDT','formatNetworkName','üìÖ\x20Date\x20start:\x20','thisMonth','getPayouts','shopId','ShopService','usdcPolygonWallet','periodTo','Payment\x20not\x20found','Test\x20webhook\x20sent\x20successfully\x20(','Webhook\x20returned\x20error:\x20','stringify','PaymentService','143496ViuKxI','usdtErcWallet','merchantUrl','availableBalance','getWebhookLogs','dailyRevenue','update','parse','default','getDate','revenue','toISOString','test_gateway','2570010VtrBaX','webhookEvents','getPaymentById','amountIsEditable','findFirst','isArray','set','USD','getPayoutById','...','polygon_usdc','ceil','filter','479787paUGhG','shopUrl','\x20USDT\x20(total\x20payouts)','payout','webhookUrl','\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20','usdtTrcWallet','defineProperty','üìÖ\x20Period\x20end:\x20','createdAt','Failed\x20to\x20send\x20webhook:\x20','\x20USDT','\x20payout\x20statistics\x20calculated:','üí∞\x20Getting\x20payouts\x20with\x20filters:','test','notes','Test\x20Gateway','2uOtsCl','paymentService','getShopProfile','getGatewayDisplayName','telegramId','totalPaidOut','PENDING','__esModule','redirectUrl','expiresAt','paidAt','convertToUSDT','deletePayment','REJECTED','customerName','polygon','KLYME\x20GB','getTime','getPaymentsByShop','payment','toUpperCase','createPublicPayment','test_order_123','Error\x20parsing\x20webhook\x20events:','balance','updatePayment','getStatistics','USDT\x20BSC','üåê\x20Method\x20filter:\x20','lte','fullName','paymentGateways','USDT\x20TRC20','CoinToPay','txid','findMany','name','testWebhook','map','140340qsoJbe','323256lGGAVR','language','üìä\x20Shop\x20','üìÖ\x20Date\x20end:\x20','shop','üìÖ\x20Period\x20start:\x20','updateWallets','log','asc','No\x20webhook\x20URL\x20configured','username','count','split','createPayment','gatewaySettings','getMonth','webhookLog','Shop\x20not\x20found','generateDailyStatistics','periodFrom','gateways','desc','status','reduce','\x20USDT\x20(current\x20balance)','customer','round'];a54_0x59dc=function(){return _0x498801;};return a54_0x59dc();}class ShopService{constructor(){const _0x1172fd=a54_0x3b3695;this['paymentService']=new paymentService_1[(_0x1172fd(0x111))]();}async[a54_0x3b3695(0x13f)](_0x362170){const _0x27cc32=a54_0x3b3695,_0x5b5758=await database_1[_0x27cc32(0x11a)]['shop'][_0x27cc32(0xd9)]({'where':{'id':_0x362170},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x5b5758)throw new Error('Shop\x20not\x20found');let _0x339d74=[];if(_0x5b5758[_0x27cc32(0xfa)]?.['webhookEvents'])try{_0x339d74=Array[_0x27cc32(0x124)](_0x5b5758['settings'][_0x27cc32(0x120)])?_0x5b5758[_0x27cc32(0xfa)][_0x27cc32(0x120)]:JSON[_0x27cc32(0x119)](_0x5b5758[_0x27cc32(0xfa)][_0x27cc32(0x120)]);}catch(_0x3ca2b3){console['error'](_0x27cc32(0x154),_0x3ca2b3),_0x339d74=[];}return{'id':_0x5b5758['id'],'fullName':_0x5b5758['name'],'username':_0x5b5758[_0x27cc32(0xbf)],'telegramId':_0x5b5758['telegram'],'merchantUrl':_0x5b5758[_0x27cc32(0x12d)],'gateways':_0x5b5758[_0x27cc32(0x15c)]?JSON[_0x27cc32(0x119)](_0x5b5758['paymentGateways']):null,'gatewaySettings':_0x5b5758[_0x27cc32(0xc3)]?JSON[_0x27cc32(0x119)](_0x5b5758['gatewaySettings']):null,'publicKey':_0x5b5758[_0x27cc32(0xea)],'webhookUrl':_0x5b5758[_0x27cc32(0xfa)]?.[_0x27cc32(0x130)]||null,'webhookEvents':_0x339d74,'wallets':{'usdtPolygonWallet':_0x5b5758['usdtPolygonWallet'],'usdtTrcWallet':_0x5b5758['usdtTrcWallet'],'usdtErcWallet':_0x5b5758[_0x27cc32(0x113)],'usdcPolygonWallet':_0x5b5758[_0x27cc32(0x10b)]},'status':_0x5b5758[_0x27cc32(0xcb)],'createdAt':_0x5b5758[_0x27cc32(0x135)]};}async['updateShopProfile'](_0x1a8d3c,_0x5245dd){const _0x132039=a54_0x3b3695,_0x11d81c={};_0x5245dd[_0x132039(0x15b)]&&(_0x11d81c[_0x132039(0xb1)]=_0x5245dd[_0x132039(0x15b)]);_0x5245dd[_0x132039(0x141)]!==undefined&&(_0x11d81c['telegram']=_0x5245dd[_0x132039(0x141)]||null);_0x5245dd[_0x132039(0x114)]&&(_0x11d81c['shopUrl']=_0x5245dd[_0x132039(0x114)]);_0x5245dd[_0x132039(0xc9)]&&(_0x11d81c[_0x132039(0x15c)]=JSON['stringify'](_0x5245dd[_0x132039(0xc9)]));_0x5245dd[_0x132039(0xc3)]&&(_0x11d81c[_0x132039(0xc3)]=JSON[_0x132039(0x110)](_0x5245dd[_0x132039(0xc3)]));_0x5245dd['wallets']&&(_0x5245dd['wallets']['usdtPolygonWallet']!==undefined&&(_0x11d81c[_0x132039(0xe6)]=_0x5245dd[_0x132039(0xe2)][_0x132039(0xe6)]||null),_0x5245dd[_0x132039(0xe2)][_0x132039(0x132)]!==undefined&&(_0x11d81c[_0x132039(0x132)]=_0x5245dd[_0x132039(0xe2)][_0x132039(0x132)]||null),_0x5245dd[_0x132039(0xe2)][_0x132039(0x113)]!==undefined&&(_0x11d81c[_0x132039(0x113)]=_0x5245dd[_0x132039(0xe2)][_0x132039(0x113)]||null),_0x5245dd[_0x132039(0xe2)][_0x132039(0x10b)]!==undefined&&(_0x11d81c[_0x132039(0x10b)]=_0x5245dd[_0x132039(0xe2)][_0x132039(0x10b)]||null));const _0x417960=await database_1['default']['shop']['update']({'where':{'id':_0x1a8d3c},'data':_0x11d81c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0x53bdc6=[];if(_0x417960['settings']?.[_0x132039(0x120)])try{_0x53bdc6=Array[_0x132039(0x124)](_0x417960[_0x132039(0xfa)][_0x132039(0x120)])?_0x417960[_0x132039(0xfa)][_0x132039(0x120)]:JSON['parse'](_0x417960[_0x132039(0xfa)][_0x132039(0x120)]);}catch(_0xbce6a2){console[_0x132039(0xe1)](_0x132039(0x154),_0xbce6a2),_0x53bdc6=[];}return{'id':_0x417960['id'],'fullName':_0x417960[_0x132039(0xb1)],'username':_0x417960['username'],'telegramId':_0x417960['telegram'],'merchantUrl':_0x417960['shopUrl'],'gateways':_0x417960[_0x132039(0x15c)]?JSON[_0x132039(0x119)](_0x417960[_0x132039(0x15c)]):null,'gatewaySettings':_0x417960['gatewaySettings']?JSON[_0x132039(0x119)](_0x417960[_0x132039(0xc3)]):null,'publicKey':_0x417960[_0x132039(0xea)],'webhookUrl':_0x417960[_0x132039(0xfa)]?.[_0x132039(0x130)]||null,'webhookEvents':_0x53bdc6,'wallets':{'usdtPolygonWallet':_0x417960['usdtPolygonWallet'],'usdtTrcWallet':_0x417960[_0x132039(0x132)],'usdtErcWallet':_0x417960[_0x132039(0x113)],'usdcPolygonWallet':_0x417960[_0x132039(0x10b)]},'status':_0x417960[_0x132039(0xcb)],'createdAt':_0x417960[_0x132039(0x135)]};}async[a54_0x3b3695(0xbb)](_0x4002a5,_0xabc95){const _0x23df01=a54_0x3b3695,_0x2609cc={};_0xabc95[_0x23df01(0xe6)]!==undefined&&(_0x2609cc['usdtPolygonWallet']=_0xabc95[_0x23df01(0xe6)]||null),_0xabc95['usdtTrcWallet']!==undefined&&(_0x2609cc[_0x23df01(0x132)]=_0xabc95['usdtTrcWallet']||null),_0xabc95['usdtErcWallet']!==undefined&&(_0x2609cc[_0x23df01(0x113)]=_0xabc95['usdtErcWallet']||null),_0xabc95[_0x23df01(0x10b)]!==undefined&&(_0x2609cc[_0x23df01(0x10b)]=_0xabc95[_0x23df01(0x10b)]||null),await database_1[_0x23df01(0x11a)][_0x23df01(0xb9)]['update']({'where':{'id':_0x4002a5},'data':_0x2609cc});}async[a54_0x3b3695(0xb2)](_0x41356d){const _0x328ee9=a54_0x3b3695,_0x1d14a2=await database_1[_0x328ee9(0x11a)][_0x328ee9(0xb9)][_0x328ee9(0xd9)]({'where':{'id':_0x41356d},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x1d14a2?.[_0x328ee9(0xfa)]?.[_0x328ee9(0x130)])throw new Error(_0x328ee9(0xbe));const _0x250833={'event':'test','payment':{'id':_0x328ee9(0xfe),'order_id':_0x328ee9(0x153),'gateway':_0x328ee9(0x13a),'amount':0x64,'currency':_0x328ee9(0x126),'status':_0x328ee9(0xd1),'created_at':new Date()[_0x328ee9(0x11d)]()}};try{const _0x481513=await fetch(_0x1d14a2[_0x328ee9(0xfa)]['webhookUrl'],{'method':_0x328ee9(0xdb),'headers':{'Content-Type':_0x328ee9(0x102),'User-Agent':_0x328ee9(0xe8)},'body':JSON[_0x328ee9(0x110)](_0x250833)});return _0x481513['ok']?{'success':!![],'message':_0x328ee9(0x10e)+_0x481513[_0x328ee9(0xcb)]+')'}:{'success':![],'message':_0x328ee9(0x10f)+_0x481513[_0x328ee9(0xcb)]+'\x20'+_0x481513['statusText']};}catch(_0x11da1e){return{'success':![],'message':_0x328ee9(0x136)+(_0x11da1e instanceof Error?_0x11da1e[_0x328ee9(0xf5)]:'Unknown\x20error')};}}async[a54_0x3b3695(0xc2)](_0x4dfdc9){const _0x3ce1a4=a54_0x3b3695;return this['paymentService'][_0x3ce1a4(0x152)]({'public_key':'','gateway':_0x4dfdc9[_0x3ce1a4(0xde)],'order_id':undefined,'amount':_0x4dfdc9[_0x3ce1a4(0xe0)],'currency':_0x4dfdc9[_0x3ce1a4(0xd6)],'source_currency':_0x4dfdc9[_0x3ce1a4(0xef)],'usage':_0x4dfdc9[_0x3ce1a4(0xf6)],'expires_at':_0x4dfdc9[_0x3ce1a4(0x146)]?.[_0x3ce1a4(0x11d)](),'success_url':_0x4dfdc9[_0x3ce1a4(0x145)],'fail_url':_0x4dfdc9[_0x3ce1a4(0x145)],'customer_email':_0x4dfdc9[_0x3ce1a4(0xd2)],'customer_name':_0x4dfdc9[_0x3ce1a4(0x14b)],'country':_0x4dfdc9['country'],'language':_0x4dfdc9[_0x3ce1a4(0xb6)],'amount_is_editable':_0x4dfdc9[_0x3ce1a4(0x122)],'max_payments':_0x4dfdc9[_0x3ce1a4(0xfb)],'customer':_0x4dfdc9[_0x3ce1a4(0xce)]});}async['getPayments'](_0x32efd0,_0x29c089){const _0x1d9663=a54_0x3b3695;return this[_0x1d9663(0x13e)][_0x1d9663(0x14f)](_0x32efd0,_0x29c089);}async[a54_0x3b3695(0x121)](_0x3cad36,_0x4a3514){const _0x311d96=a54_0x3b3695;return this[_0x311d96(0x13e)][_0x311d96(0xf1)](_0x3cad36,_0x4a3514);}async[a54_0x3b3695(0x156)](_0x31d2a6,_0x45446a,_0x5a5980){const _0x1d7f2=a54_0x3b3695,_0x5c451d=await database_1[_0x1d7f2(0x11a)][_0x1d7f2(0x150)]['findFirst']({'where':{'id':_0x45446a,'shopId':_0x31d2a6}});if(!_0x5c451d)throw new Error(_0x1d7f2(0x10d));const _0x5e1a58=await database_1[_0x1d7f2(0x11a)][_0x1d7f2(0x150)][_0x1d7f2(0x118)]({'where':{'id':_0x45446a},'data':{..._0x5a5980,'updatedAt':new Date()}});return _0x5e1a58;}async[a54_0x3b3695(0x149)](_0x80fe44,_0x3f8c08){const _0x32cdb5=a54_0x3b3695,_0x2fdc21=await database_1[_0x32cdb5(0x11a)][_0x32cdb5(0x150)]['findFirst']({'where':{'id':_0x3f8c08,'shopId':_0x80fe44}});if(!_0x2fdc21)throw new Error('Payment\x20not\x20found');await database_1[_0x32cdb5(0x11a)][_0x32cdb5(0x150)][_0x32cdb5(0xfc)]({'where':{'id':_0x3f8c08}});}[a54_0x3b3695(0x105)](_0xfa5cc2){const _0x4de0a3=a54_0x3b3695,_0x4b00cb={'polygon':_0x4de0a3(0xff),'trc20':_0x4de0a3(0x15d),'erc20':'USDT\x20ERC20','bsc':_0x4de0a3(0x158),'polygon_usdc':'USDC\x20Polygon'};return _0x4b00cb[_0xfa5cc2]||_0xfa5cc2;}async[a54_0x3b3695(0x108)](_0x39d34a,_0xe0afb8){const _0x54f07f=a54_0x3b3695,{page:_0x3e271e,limit:_0x3c41de,status:_0x2bfd04,method:_0x787ed8,network:_0x5c1b56,dateFrom:_0x35a864,dateTo:_0x144afd,periodFrom:_0x28fb06,periodTo:_0x53145d}=_0xe0afb8,_0x115390=(_0x3e271e-0x1)*_0x3c41de;console[_0x54f07f(0xbc)](_0x54f07f(0x139),_0xe0afb8);const _0x47c41={'shopId':_0x39d34a};_0x2bfd04&&(_0x47c41[_0x54f07f(0xcb)]=_0x2bfd04[_0x54f07f(0x151)](),console[_0x54f07f(0xbc)]('üìä\x20Status\x20filter:\x20'+_0x2bfd04[_0x54f07f(0x151)]()));if(_0x787ed8)_0x47c41['network']=_0x787ed8,console['log'](_0x54f07f(0x159)+_0x787ed8);else _0x5c1b56&&(_0x47c41[_0x54f07f(0xdc)]=_0x5c1b56,console['log'](_0x54f07f(0xec)+_0x5c1b56));if(_0x35a864||_0x144afd||_0x28fb06||_0x53145d){_0x47c41[_0x54f07f(0x135)]={};if(_0x28fb06){const _0x496f87=new Date(_0x28fb06);_0x496f87[_0x54f07f(0xee)](0x0,0x0,0x0,0x0),_0x47c41['createdAt'][_0x54f07f(0xf0)]=_0x496f87,console[_0x54f07f(0xbc)](_0x54f07f(0xba)+_0x496f87[_0x54f07f(0x11d)]());}else{if(_0x35a864){const _0x5e72a8=new Date(_0x35a864);_0x5e72a8['setHours'](0x0,0x0,0x0,0x0),_0x47c41['createdAt'][_0x54f07f(0xf0)]=_0x5e72a8,console[_0x54f07f(0xbc)](_0x54f07f(0x106)+_0x5e72a8['toISOString']());}}if(_0x53145d){const _0x4c2cb9=new Date(_0x53145d);_0x4c2cb9[_0x54f07f(0xee)](0x17,0x3b,0x3b,0x3e7),_0x47c41['createdAt'][_0x54f07f(0x15a)]=_0x4c2cb9,console['log'](_0x54f07f(0x134)+_0x4c2cb9[_0x54f07f(0x11d)]());}else{if(_0x144afd){const _0x4e31b8=new Date(_0x144afd);_0x4e31b8[_0x54f07f(0xee)](0x17,0x3b,0x3b,0x3e7),_0x47c41[_0x54f07f(0x135)]['lte']=_0x4e31b8,console[_0x54f07f(0xbc)](_0x54f07f(0xb8)+_0x4e31b8[_0x54f07f(0x11d)]());}}}console['log']('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x54f07f(0x110)](_0x47c41,null,0x2));const [_0x222b0a,_0x32a118]=await Promise[_0x54f07f(0xd8)]([database_1[_0x54f07f(0x11a)][_0x54f07f(0x12f)][_0x54f07f(0xb0)]({'where':_0x47c41,'skip':_0x115390,'take':_0x3c41de,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0x54f07f(0x11a)][_0x54f07f(0x12f)][_0x54f07f(0xc0)]({'where':_0x47c41})]);return{'payouts':_0x222b0a[_0x54f07f(0xb3)](_0x1f5c44=>{const _0x3e30eb=_0x54f07f;let _0x5f4bab=null;switch(_0x1f5c44[_0x3e30eb(0xdc)]){case _0x3e30eb(0x14c):_0x5f4bab=_0x1f5c44[_0x3e30eb(0xb9)]['usdtPolygonWallet'];break;case _0x3e30eb(0xe7):_0x5f4bab=_0x1f5c44[_0x3e30eb(0xb9)]['usdtTrcWallet'];break;case _0x3e30eb(0xe5):_0x5f4bab=_0x1f5c44[_0x3e30eb(0xb9)][_0x3e30eb(0x113)];break;case _0x3e30eb(0x129):_0x5f4bab=_0x1f5c44['shop'][_0x3e30eb(0x10b)];break;}return{'id':_0x1f5c44['id'],'amount':_0x1f5c44[_0x3e30eb(0xe0)],'network':this['formatNetworkName'](_0x1f5c44[_0x3e30eb(0xdc)]),'wallet':_0x5f4bab,'status':_0x1f5c44[_0x3e30eb(0xcb)],'txid':_0x1f5c44[_0x3e30eb(0x15f)],'notes':_0x1f5c44['notes'],'periodFrom':_0x1f5c44[_0x3e30eb(0xc8)],'periodTo':_0x1f5c44[_0x3e30eb(0x10c)],'createdAt':_0x1f5c44['createdAt'],'paidAt':_0x1f5c44['paidAt']};}),'pagination':{'page':_0x3e271e,'limit':_0x3c41de,'total':_0x32a118,'totalPages':Math[_0x54f07f(0x12a)](_0x32a118/_0x3c41de)}};}async[a54_0x3b3695(0x127)](_0x29b638,_0x1316c0){const _0x348d77=a54_0x3b3695,_0x1bb8b7=await database_1[_0x348d77(0x11a)]['payout'][_0x348d77(0x123)]({'where':{'id':_0x1316c0,'shopId':_0x29b638}});if(!_0x1bb8b7)return null;return{'id':_0x1bb8b7['id'],'amount':_0x1bb8b7[_0x348d77(0xe0)],'network':_0x1bb8b7[_0x348d77(0xdc)],'status':_0x1bb8b7[_0x348d77(0xcb)],'txid':_0x1bb8b7[_0x348d77(0x15f)],'notes':_0x1bb8b7[_0x348d77(0x13b)],'createdAt':_0x1bb8b7[_0x348d77(0x135)],'paidAt':_0x1bb8b7[_0x348d77(0x147)]};}async[a54_0x3b3695(0xd7)](_0x5b4caa,_0x291a30){const _0x3e1074=a54_0x3b3695,_0x24ce20=new Date();let _0x40c04d;switch(_0x291a30){case'7d':_0x40c04d=new Date(_0x24ce20[_0x3e1074(0x14e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x40c04d=new Date(_0x24ce20[_0x3e1074(0x14e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3e1074(0xd0):_0x40c04d=new Date(_0x24ce20[_0x3e1074(0x14e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x40c04d=new Date(_0x24ce20['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5ba832,_0x29e192,_0x13b0a3,_0x4d8a44,_0x4482dc,_0x354d3a]=await Promise[_0x3e1074(0xd8)]([database_1['default'][_0x3e1074(0x12f)][_0x3e1074(0xc0)]({'where':{'shopId':_0x5b4caa,'createdAt':{'gte':_0x40c04d}}}),database_1['default']['payout'][_0x3e1074(0xc0)]({'where':{'shopId':_0x5b4caa,'status':_0x3e1074(0xeb),'createdAt':{'gte':_0x40c04d}}}),database_1[_0x3e1074(0x11a)][_0x3e1074(0x12f)][_0x3e1074(0xc0)]({'where':{'shopId':_0x5b4caa,'status':_0x3e1074(0x143),'createdAt':{'gte':_0x40c04d}}}),database_1['default'][_0x3e1074(0x12f)][_0x3e1074(0xc0)]({'where':{'shopId':_0x5b4caa,'status':_0x3e1074(0x14a),'createdAt':{'gte':_0x40c04d}}}),database_1[_0x3e1074(0x11a)][_0x3e1074(0x12f)][_0x3e1074(0xb0)]({'where':{'shopId':_0x5b4caa,'createdAt':{'gte':_0x40c04d}},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x3e1074(0x11a)][_0x3e1074(0x12f)][_0x3e1074(0xb0)]({'where':{'shopId':_0x5b4caa},'take':0xa,'orderBy':{'createdAt':_0x3e1074(0xca)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x48749b=_0x4482dc[_0x3e1074(0xcc)]((_0x2e4563,_0x1071e6)=>_0x2e4563+_0x1071e6['amount'],0x0),_0x506164=_0x4482dc[_0x3e1074(0x12b)](_0xc5659e=>_0xc5659e[_0x3e1074(0xcb)]==='COMPLETED')[_0x3e1074(0xcc)]((_0x422fe2,_0x2ddcd7)=>_0x422fe2+_0x2ddcd7['amount'],0x0),_0x19ea39=_0x4482dc['filter'](_0x2ef435=>_0x2ef435['status']===_0x3e1074(0x143))[_0x3e1074(0xcc)]((_0x2e44ee,_0x5a323b)=>_0x2e44ee+_0x5a323b[_0x3e1074(0xe0)],0x0),_0x54b8c0=_0x4482dc[_0x3e1074(0xcc)]((_0xb87a49,_0x44ab7c)=>{const _0x3f0340=_0x3e1074;return _0xb87a49[_0x44ab7c[_0x3f0340(0xdc)]]=(_0xb87a49[_0x44ab7c[_0x3f0340(0xdc)]]||0x0)+0x1,_0xb87a49;},{}),_0x2a08e0=_0x4482dc[_0x3e1074(0xcc)]((_0x7977a2,_0xdc6ec9)=>{const _0x37d7b0=_0x3e1074;return _0x7977a2[_0xdc6ec9[_0x37d7b0(0xcb)]]=(_0x7977a2[_0xdc6ec9[_0x37d7b0(0xcb)]]||0x0)+0x1,_0x7977a2;},{});return{'totalPayouts':_0x5ba832,'completedPayouts':_0x29e192,'pendingPayouts':_0x13b0a3,'rejectedPayouts':_0x4d8a44,'totalAmount':_0x48749b,'completedAmount':_0x506164,'pendingAmount':_0x19ea39,'payoutsByMethod':_0x54b8c0,'payoutsByStatus':_0x2a08e0,'recentPayouts':_0x354d3a[_0x3e1074(0xb3)](_0x294750=>({'id':_0x294750['id'],'shopId':_0x5b4caa,'amount':_0x294750[_0x3e1074(0xe0)],'method':_0x294750['network'],'status':_0x294750['status'],'txid':_0x294750['txid'],'createdAt':_0x294750[_0x3e1074(0x135)],'paidAt':_0x294750[_0x3e1074(0x147)]}))};}async[a54_0x3b3695(0xdf)](_0x455eee){const _0x2d04c8=a54_0x3b3695;console['log'](_0x2d04c8(0xed)+_0x455eee+_0x2d04c8(0x128));const _0x5d69db=await database_1[_0x2d04c8(0x11a)][_0x2d04c8(0xb9)][_0x2d04c8(0xd9)]({'where':{'id':_0x455eee},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5d69db)throw new Error(_0x2d04c8(0xc6));const _0x44dd42=new Date(),_0x6e7451=new Date(_0x44dd42['getFullYear'](),_0x44dd42[_0x2d04c8(0xc4)](),0x1),_0x49ae68=new Date(_0x44dd42[_0x2d04c8(0xd5)](),_0x44dd42[_0x2d04c8(0xc4)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x32bca7=await database_1[_0x2d04c8(0x11a)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x455eee,'createdAt':{'gte':_0x6e7451,'lte':_0x49ae68},'status':_0x2d04c8(0xeb)}}),_0x1987f2=_0x32bca7['_sum'][_0x2d04c8(0xe0)]||0x0,_0xb2e5ed={'availableBalance':Math[_0x2d04c8(0xcf)](_0x5d69db[_0x2d04c8(0x155)]*0x64)/0x64,'totalPaidOut':Math['round'](_0x5d69db['totalPaidOut']*0x64)/0x64,'awaitingPayout':Math[_0x2d04c8(0xcf)](_0x5d69db[_0x2d04c8(0x155)]*0x64)/0x64,'thisMonth':Math[_0x2d04c8(0xcf)](_0x1987f2*0x64)/0x64};return console[_0x2d04c8(0xbc)](_0x2d04c8(0xb7)+_0x5d69db[_0x2d04c8(0xbf)]+_0x2d04c8(0x138)),console['log'](_0x2d04c8(0xfd)+_0xb2e5ed[_0x2d04c8(0x115)]+_0x2d04c8(0xcd)),console[_0x2d04c8(0xbc)](_0x2d04c8(0x131)+_0xb2e5ed[_0x2d04c8(0x142)]+_0x2d04c8(0x12e)),console[_0x2d04c8(0xbc)](_0x2d04c8(0xf4)+_0xb2e5ed[_0x2d04c8(0xf2)]+'\x20USDT\x20(current\x20balance)'),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0xb2e5ed[_0x2d04c8(0x107)]+_0x2d04c8(0x137)),_0xb2e5ed;}[a54_0x3b3695(0x140)](_0x3c22f7){const _0xff9db6=a54_0x3b3695,_0x5a235f={'test_gateway':_0xff9db6(0x13c),'plisio':'Plisio','rapyd':'Rapyd','noda':_0xff9db6(0xd3),'cointopay':_0xff9db6(0x15e),'klyme_eu':'KLYME\x20EU','klyme_gb':_0xff9db6(0x14d),'klyme_de':_0xff9db6(0xd4)};return _0x5a235f[_0x3c22f7]||_0x3c22f7;}async['getPayoutStats'](_0x401497){const _0x4453a1=a54_0x3b3695;return this[_0x4453a1(0xdf)](_0x401497);}async[a54_0x3b3695(0x116)](_0x34e2e8,_0x38e1da){const _0x3931ae=a54_0x3b3695,{page:_0x584d61,limit:_0x3eb1af,paymentId:_0x16e64f}=_0x38e1da,_0x4d689c=(_0x584d61-0x1)*_0x3eb1af,_0x3c8409={'shopId':_0x34e2e8};_0x16e64f&&(_0x3c8409[_0x3931ae(0xf3)]=_0x16e64f);const [_0x446c7b,_0x12c389]=await Promise[_0x3931ae(0xd8)]([database_1[_0x3931ae(0x11a)][_0x3931ae(0xc5)][_0x3931ae(0xb0)]({'where':_0x3c8409,'skip':_0x4d689c,'take':_0x3eb1af,'orderBy':{'createdAt':_0x3931ae(0xca)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x3931ae(0x11a)][_0x3931ae(0xc5)]['count']({'where':_0x3c8409})]);return{'logs':_0x446c7b['map'](_0x45abe1=>({'id':_0x45abe1['id'],'paymentId':_0x45abe1[_0x3931ae(0xf3)],'shopId':_0x45abe1[_0x3931ae(0x109)],'event':_0x45abe1['event'],'statusCode':_0x45abe1['statusCode'],'retryCount':_0x45abe1[_0x3931ae(0xf7)],'responseBody':_0x45abe1['responseBody'],'createdAt':_0x45abe1[_0x3931ae(0x135)],'payment':_0x45abe1['payment']})),'pagination':{'page':_0x584d61,'limit':_0x3eb1af,'total':_0x12c389,'totalPages':Math[_0x3931ae(0x12a)](_0x12c389/_0x3eb1af)}};}async[a54_0x3b3695(0x157)](_0x1650f0,_0x3e1c9d){const _0x5695d1=a54_0x3b3695,_0x4a4c70=new Date();let _0x2ef038;switch(_0x3e1c9d){case'7d':_0x2ef038=new Date(_0x4a4c70[_0x5695d1(0x14e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5695d1(0xf9):_0x2ef038=new Date(_0x4a4c70[_0x5695d1(0x14e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x2ef038=new Date(_0x4a4c70[_0x5695d1(0x14e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2ef038=new Date(_0x4a4c70[_0x5695d1(0x14e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3fa161,_0x3fa521,_0x316cb3,_0x5d713f,_0x2547ff]=await Promise[_0x5695d1(0xd8)]([database_1[_0x5695d1(0x11a)][_0x5695d1(0x150)][_0x5695d1(0xc0)]({'where':{'shopId':_0x1650f0,'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x2ef038}}}),database_1[_0x5695d1(0x11a)]['payment'][_0x5695d1(0xc0)]({'where':{'shopId':_0x1650f0,'gateway':{'not':_0x5695d1(0x11e)},'status':_0x5695d1(0xf8),'createdAt':{'gte':_0x2ef038}}}),database_1[_0x5695d1(0x11a)][_0x5695d1(0x150)][_0x5695d1(0xb0)]({'where':{'shopId':_0x1650f0,'gateway':{'not':_0x5695d1(0x11e)},'status':_0x5695d1(0xf8),'createdAt':{'gte':_0x2ef038}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x5695d1(0x11a)][_0x5695d1(0x150)][_0x5695d1(0xb0)]({'where':{'shopId':_0x1650f0,'gateway':{'not':_0x5695d1(0x11e)}},'take':0xa,'orderBy':{'createdAt':_0x5695d1(0xca)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5695d1(0x11a)][_0x5695d1(0x150)][_0x5695d1(0xb0)]({'where':{'shopId':_0x1650f0,'gateway':{'not':_0x5695d1(0x11e)},'createdAt':{'gte':_0x2ef038}},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x5695d1(0xbd)}})]);let _0x17382a=0x0;for(const _0x678cab of _0x316cb3){if(_0x678cab[_0x5695d1(0x104)])_0x17382a+=_0x678cab[_0x5695d1(0x104)];else{const _0x2cdecd=await currencyService_1[_0x5695d1(0xdd)][_0x5695d1(0x148)](_0x678cab[_0x5695d1(0xe0)],_0x678cab[_0x5695d1(0xd6)]);_0x17382a+=_0x2cdecd;}}const _0x4c4a81=this['generateDailyStatistics'](_0x2547ff,_0x2ef038,_0x4a4c70),_0x54f96e=_0x3fa161>0x0?_0x3fa521/_0x3fa161*0x64:0x0;return{'totalPayments':_0x3fa161,'successfulPayments':_0x3fa521,'totalRevenue':Math[_0x5695d1(0xcf)](_0x17382a*0x64)/0x64,'conversionRate':Math['round'](_0x54f96e*0x64)/0x64,'dailyRevenue':_0x4c4a81[_0x5695d1(0x117)],'dailyPayments':_0x4c4a81[_0x5695d1(0xe3)],'recentPayments':_0x5d713f['map'](_0x46c4ee=>({'id':_0x46c4ee['id'],'gateway':_0x46c4ee['gateway'],'amount':_0x46c4ee['amount'],'currency':_0x46c4ee[_0x5695d1(0xd6)],'status':_0x46c4ee['status'],'createdAt':_0x46c4ee[_0x5695d1(0x135)]}))};}[a54_0x3b3695(0xc7)](_0x49456d,_0x2a7b2f,_0x86be67){const _0x3ad85b=a54_0x3b3695,_0x5c9194=new Map(),_0x1ed164=new Date(_0x2a7b2f);while(_0x1ed164<=_0x86be67){const _0x541d1e=_0x1ed164['toISOString']()[_0x3ad85b(0xc1)]('T')[0x0];_0x5c9194[_0x3ad85b(0x125)](_0x541d1e,{'revenue':0x0,'count':0x0}),_0x1ed164[_0x3ad85b(0xda)](_0x1ed164[_0x3ad85b(0x11b)]()+0x1);}for(const _0x27fc3e of _0x49456d){const _0x448d51=_0x27fc3e[_0x3ad85b(0x135)][_0x3ad85b(0x11d)]()['split']('T')[0x0],_0x1903f5=_0x5c9194['get'](_0x448d51);_0x1903f5&&(_0x1903f5[_0x3ad85b(0xc0)]+=0x1,_0x27fc3e[_0x3ad85b(0xcb)]==='PAID'&&_0x27fc3e[_0x3ad85b(0x104)]&&(_0x1903f5[_0x3ad85b(0x11c)]+=_0x27fc3e[_0x3ad85b(0x104)]));}const _0x3b519b=[],_0x38122a=[];for(const [_0x195c7b,_0x5e8b63]of _0x5c9194){_0x3b519b[_0x3ad85b(0x100)]({'date':_0x195c7b,'amount':Math[_0x3ad85b(0xcf)](_0x5e8b63[_0x3ad85b(0x11c)]*0x64)/0x64}),_0x38122a['push']({'date':_0x195c7b,'count':_0x5e8b63[_0x3ad85b(0xc0)]});}return{'dailyRevenue':_0x3b519b,'dailyPayments':_0x38122a};}}exports[a54_0x3b3695(0x10a)]=ShopService;