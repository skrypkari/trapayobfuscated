'use strict';const a79_0x2380a2=a79_0x524e;(function(_0x2cecbd,_0x55d8b7){const _0x515f5c=a79_0x524e,_0x342c3a=_0x2cecbd();while(!![]){try{const _0x52d312=parseInt(_0x515f5c(0xae))/0x1*(parseInt(_0x515f5c(0x141))/0x2)+-parseInt(_0x515f5c(0xe7))/0x3+-parseInt(_0x515f5c(0x16e))/0x4*(parseInt(_0x515f5c(0xc6))/0x5)+-parseInt(_0x515f5c(0x160))/0x6+parseInt(_0x515f5c(0xf9))/0x7*(parseInt(_0x515f5c(0x180))/0x8)+-parseInt(_0x515f5c(0x148))/0x9*(-parseInt(_0x515f5c(0x140))/0xa)+parseInt(_0x515f5c(0x143))/0xb;if(_0x52d312===_0x55d8b7)break;else _0x342c3a['push'](_0x342c3a['shift']());}catch(_0x39a90a){_0x342c3a['push'](_0x342c3a['shift']());}}}(a79_0x5515,0xd59c3));function a79_0x524e(_0x3ad307,_0xd6a01c){_0x3ad307=_0x3ad307-0xad;const _0x55156f=a79_0x5515();let _0x524e3a=_0x55156f[_0x3ad307];return _0x524e3a;}var __importDefault=this&&this[a79_0x2380a2(0x129)]||function(_0x4fffb4){const _0xe216ef=a79_0x2380a2;return _0x4fffb4&&_0x4fffb4[_0xe216ef(0xfb)]?_0x4fffb4:{'default':_0x4fffb4};};Object[a79_0x2380a2(0x173)](exports,a79_0x2380a2(0xfb),{'value':!![]}),exports['ShopService']=void 0x0;const database_1=__importDefault(require(a79_0x2380a2(0xfd))),bcryptjs_1=__importDefault(require(a79_0x2380a2(0xdb))),crypto_1=__importDefault(require(a79_0x2380a2(0x16f))),speakeasy_1=__importDefault(require(a79_0x2380a2(0xe4))),qrcode_1=__importDefault(require(a79_0x2380a2(0xc0))),currencyService_1=require(a79_0x2380a2(0x134)),paymentService_1=require(a79_0x2380a2(0x18e)),gateway_1=require(a79_0x2380a2(0x10c));class ShopService{constructor(){const _0x14bb87=a79_0x2380a2;this[_0x14bb87(0x17a)]=new paymentService_1[(_0x14bb87(0x137))]();}async[a79_0x2380a2(0xd4)](_0x212722){const _0x499802=a79_0x2380a2,_0x4b1b66=await database_1[_0x499802(0xb9)][_0x499802(0xfc)][_0x499802(0xff)]({'where':{'id':_0x212722},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});if(!_0x4b1b66)throw new Error(_0x499802(0x107));let _0x858d6f=[];if(_0x4b1b66['settings']?.[_0x499802(0xc5)])try{_0x858d6f=Array['isArray'](_0x4b1b66['settings'][_0x499802(0xc5)])?_0x4b1b66[_0x499802(0x14a)][_0x499802(0xc5)]:JSON[_0x499802(0x128)](_0x4b1b66[_0x499802(0x14a)][_0x499802(0xc5)]);}catch(_0x414d8e){console[_0x499802(0x117)](_0x499802(0x11a),_0x414d8e),_0x858d6f=[];}const _0x53d931=gateway_1['AVAILABLE_GATEWAYS'][_0x499802(0x15e)](_0x4a46c1=>_0x4a46c1[_0x499802(0x179)])[_0x499802(0x18a)](_0x56abd5=>_0x56abd5[_0x499802(0x12f)]);let _0x567b34=_0x4b1b66[_0x499802(0xc9)]?JSON['parse'](_0x4b1b66[_0x499802(0xc9)]):[];return Array['isArray'](_0x567b34)&&(_0x567b34=_0x567b34[_0x499802(0x18a)](_0x4c29a2=>_0x4c29a2[_0x499802(0x11f)](/\s+/g,'_')[_0x499802(0xb1)]())[_0x499802(0x15e)](_0x32bb4f=>_0x53d931['includes'](_0x32bb4f))),{'id':_0x4b1b66['id'],'fullName':_0x4b1b66[_0x499802(0x12f)],'username':_0x4b1b66[_0x499802(0x16a)],'telegramId':_0x4b1b66[_0x499802(0xe2)],'merchantUrl':_0x4b1b66[_0x499802(0x155)],'gateways':_0x567b34,'gatewaySettings':_0x4b1b66[_0x499802(0x18d)]?JSON[_0x499802(0x128)](_0x4b1b66[_0x499802(0x18d)]):null,'publicKey':_0x4b1b66[_0x499802(0xbe)],'webhookUrl':_0x4b1b66[_0x499802(0x14a)]?.[_0x499802(0x188)]||null,'webhookEvents':_0x858d6f,'wallets':{'usdtPolygonWallet':_0x4b1b66[_0x499802(0x130)],'usdtTrcWallet':_0x4b1b66[_0x499802(0xbd)],'usdtErcWallet':_0x4b1b66['usdtErcWallet'],'usdcPolygonWallet':_0x4b1b66[_0x499802(0xd8)],'usdcErcWallet':_0x4b1b66[_0x499802(0x10a)]},'status':_0x4b1b66[_0x499802(0x104)],'createdAt':_0x4b1b66[_0x499802(0xe3)]};}async[a79_0x2380a2(0x175)](_0x16089a,_0x1a9b63){const _0x12353b=a79_0x2380a2,_0x40f4a3={};_0x1a9b63[_0x12353b(0x174)]&&(_0x40f4a3['name']=_0x1a9b63[_0x12353b(0x174)]);_0x1a9b63[_0x12353b(0x14c)]!==undefined&&(_0x40f4a3[_0x12353b(0xe2)]=_0x1a9b63[_0x12353b(0x14c)]||null);_0x1a9b63[_0x12353b(0xd3)]&&(_0x40f4a3[_0x12353b(0x155)]=_0x1a9b63[_0x12353b(0xd3)]);_0x1a9b63[_0x12353b(0x151)]&&(_0x40f4a3[_0x12353b(0xc9)]=JSON[_0x12353b(0x153)](_0x1a9b63[_0x12353b(0x151)]));_0x1a9b63[_0x12353b(0x18d)]&&(_0x40f4a3[_0x12353b(0x18d)]=JSON[_0x12353b(0x153)](_0x1a9b63[_0x12353b(0x18d)]));_0x1a9b63[_0x12353b(0x15a)]&&(_0x1a9b63[_0x12353b(0x15a)][_0x12353b(0x130)]!==undefined&&(_0x40f4a3[_0x12353b(0x130)]=_0x1a9b63[_0x12353b(0x15a)][_0x12353b(0x130)]||null),_0x1a9b63[_0x12353b(0x15a)][_0x12353b(0xbd)]!==undefined&&(_0x40f4a3[_0x12353b(0xbd)]=_0x1a9b63[_0x12353b(0x15a)][_0x12353b(0xbd)]||null),_0x1a9b63['wallets']['usdtErcWallet']!==undefined&&(_0x40f4a3[_0x12353b(0xd5)]=_0x1a9b63[_0x12353b(0x15a)][_0x12353b(0xd5)]||null),_0x1a9b63[_0x12353b(0x15a)]['usdcPolygonWallet']!==undefined&&(_0x40f4a3[_0x12353b(0xd8)]=_0x1a9b63[_0x12353b(0x15a)][_0x12353b(0xd8)]||null));const _0x40275f=await database_1[_0x12353b(0xb9)][_0x12353b(0xfc)][_0x12353b(0x10f)]({'where':{'id':_0x16089a},'data':_0x40f4a3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}});let _0xc32a56=[];if(_0x40275f[_0x12353b(0x14a)]?.[_0x12353b(0xc5)])try{_0xc32a56=Array[_0x12353b(0x116)](_0x40275f['settings'][_0x12353b(0xc5)])?_0x40275f['settings']['webhookEvents']:JSON[_0x12353b(0x128)](_0x40275f['settings'][_0x12353b(0xc5)]);}catch(_0x357fb9){console['error'](_0x12353b(0x11a),_0x357fb9),_0xc32a56=[];}return{'id':_0x40275f['id'],'fullName':_0x40275f[_0x12353b(0x12f)],'username':_0x40275f[_0x12353b(0x16a)],'telegramId':_0x40275f[_0x12353b(0xe2)],'merchantUrl':_0x40275f[_0x12353b(0x155)],'gateways':_0x40275f['paymentGateways']?JSON[_0x12353b(0x128)](_0x40275f[_0x12353b(0xc9)]):null,'gatewaySettings':_0x40275f[_0x12353b(0x18d)]?JSON[_0x12353b(0x128)](_0x40275f['gatewaySettings']):null,'publicKey':_0x40275f[_0x12353b(0xbe)],'webhookUrl':_0x40275f[_0x12353b(0x14a)]?.[_0x12353b(0x188)]||null,'webhookEvents':_0xc32a56,'wallets':{'usdtPolygonWallet':_0x40275f[_0x12353b(0x130)],'usdtTrcWallet':_0x40275f['usdtTrcWallet'],'usdtErcWallet':_0x40275f[_0x12353b(0xd5)],'usdcPolygonWallet':_0x40275f[_0x12353b(0xd8)],'usdcErcWallet':_0x40275f['usdcErcWallet']},'status':_0x40275f[_0x12353b(0x104)],'createdAt':_0x40275f['createdAt']};}async[a79_0x2380a2(0xb2)](_0x542ebd,_0x3690e3){const _0x5302d0=a79_0x2380a2,_0x43abe6=await database_1['default'][_0x5302d0(0xfc)][_0x5302d0(0xff)]({'where':{'id':_0x542ebd},'select':{'twoFactorEnabled':!![],'twoFactorSecret':!![],'backupCodes':!![]}});if(!_0x43abe6)throw new Error(_0x5302d0(0x107));if(_0x43abe6[_0x5302d0(0x10e)]){if(!_0x3690e3[_0x5302d0(0xf5)])throw new Error(_0x5302d0(0x17e));const _0x3c8f2b=speakeasy_1['default'][_0x5302d0(0x125)][_0x5302d0(0x168)]({'secret':_0x43abe6['twoFactorSecret'],'encoding':'base32','token':_0x3690e3['twoFactorToken'],'window':0x2});if(!_0x3c8f2b){let _0x185896=![];if(_0x43abe6['backupCodes']){const _0x5bb1c7=JSON[_0x5302d0(0x128)](_0x43abe6[_0x5302d0(0x172)]);for(let _0x43f648=0x0;_0x43f648<_0x5bb1c7['length'];_0x43f648++){const _0x5d71a7=await bcryptjs_1[_0x5302d0(0xb9)][_0x5302d0(0x16b)](_0x3690e3[_0x5302d0(0xf5)],_0x5bb1c7[_0x43f648]);if(_0x5d71a7){_0x185896=!![],_0x5bb1c7[_0x5302d0(0x181)](_0x43f648,0x1),await database_1[_0x5302d0(0xb9)][_0x5302d0(0xfc)][_0x5302d0(0x10f)]({'where':{'id':_0x542ebd},'data':{'backupCodes':JSON[_0x5302d0(0x153)](_0x5bb1c7)}});break;}}}if(!_0x185896)throw new Error(_0x5302d0(0x171));}}const _0x39ccb6={};_0x3690e3[_0x5302d0(0x130)]!==undefined&&(_0x39ccb6[_0x5302d0(0x130)]=_0x3690e3[_0x5302d0(0x130)]||null),_0x3690e3[_0x5302d0(0xbd)]!==undefined&&(_0x39ccb6[_0x5302d0(0xbd)]=_0x3690e3[_0x5302d0(0xbd)]||null),_0x3690e3[_0x5302d0(0xd5)]!==undefined&&(_0x39ccb6[_0x5302d0(0xd5)]=_0x3690e3['usdtErcWallet']||null),_0x3690e3[_0x5302d0(0xd8)]!==undefined&&(_0x39ccb6[_0x5302d0(0xd8)]=_0x3690e3[_0x5302d0(0xd8)]||null),_0x3690e3[_0x5302d0(0x10a)]!==undefined&&(_0x39ccb6[_0x5302d0(0x10a)]=_0x3690e3[_0x5302d0(0x10a)]||null),await database_1[_0x5302d0(0xb9)][_0x5302d0(0xfc)][_0x5302d0(0x10f)]({'where':{'id':_0x542ebd},'data':_0x39ccb6});}async['testWebhook'](_0x11e9ba){const _0x23609=a79_0x2380a2,_0x42e5a7=await database_1[_0x23609(0xb9)][_0x23609(0xfc)][_0x23609(0xff)]({'where':{'id':_0x11e9ba},'include':{'settings':{'select':{'webhookUrl':!![]}}}});if(!_0x42e5a7?.[_0x23609(0x14a)]?.[_0x23609(0x188)])throw new Error('No\x20webhook\x20URL\x20configured');const _0x4cac61={'event':'test','payment':{'id':_0x23609(0x111),'order_id':_0x23609(0x185),'gateway':'test','amount':0x64,'currency':'USD','status':'paid','created_at':new Date()[_0x23609(0x17b)]()}};try{const _0x3c7343=await fetch(_0x42e5a7[_0x23609(0x14a)][_0x23609(0x188)],{'method':_0x23609(0xe9),'headers':{'Content-Type':_0x23609(0x16c),'User-Agent':_0x23609(0x108)},'body':JSON[_0x23609(0x153)](_0x4cac61)});return _0x3c7343['ok']?{'success':!![],'message':'Test\x20webhook\x20sent\x20successfully\x20('+_0x3c7343['status']+')'}:{'success':![],'message':'Webhook\x20returned\x20error:\x20'+_0x3c7343[_0x23609(0x104)]+'\x20'+_0x3c7343['statusText']};}catch(_0x3b3c60){return{'success':![],'message':_0x23609(0x158)+(_0x3b3c60 instanceof Error?_0x3b3c60[_0x23609(0x126)]:_0x23609(0xd1))};}}async[a79_0x2380a2(0x11e)](_0x62247c){const _0x322bce=a79_0x2380a2;return this[_0x322bce(0x17a)]['createPublicPayment']({'public_key':'','gateway':_0x62247c[_0x322bce(0x15c)],'order_id':undefined,'amount':_0x62247c[_0x322bce(0xdf)],'currency':_0x62247c[_0x322bce(0x186)],'source_currency':_0x62247c[_0x322bce(0xef)],'usage':_0x62247c[_0x322bce(0xbb)],'expires_at':_0x62247c['expiresAt']?.[_0x322bce(0x17b)](),'success_url':_0x62247c[_0x322bce(0x150)],'fail_url':_0x62247c[_0x322bce(0x150)],'customer_email':_0x62247c[_0x322bce(0x182)],'customer_name':_0x62247c['customerName'],'country':_0x62247c[_0x322bce(0xdc)],'language':_0x62247c[_0x322bce(0xeb)],'amount_is_editable':_0x62247c[_0x322bce(0x17d)],'max_payments':_0x62247c[_0x322bce(0x152)],'customer':_0x62247c[_0x322bce(0x14f)]});}async[a79_0x2380a2(0xb6)](_0x1d0577,_0x241868){const _0x52f61a=a79_0x2380a2;return this[_0x52f61a(0x17a)]['getPaymentsByShop'](_0x1d0577,_0x241868);}async[a79_0x2380a2(0xb8)](_0x170cb9,_0x56c163){const _0x85f0a7=a79_0x2380a2;return this[_0x85f0a7(0x17a)][_0x85f0a7(0xb7)](_0x170cb9,_0x56c163);}async['updatePayment'](_0x35fe7b,_0x1e561a,_0xb3d5b7){const _0x208484=a79_0x2380a2,_0x1b005d=await database_1[_0x208484(0xb9)]['payment']['findFirst']({'where':{'id':_0x1e561a,'shopId':_0x35fe7b}});if(!_0x1b005d)throw new Error('Payment\x20not\x20found');const _0x38a698=await database_1[_0x208484(0xb9)]['payment'][_0x208484(0x10f)]({'where':{'id':_0x1e561a},'data':{..._0xb3d5b7,'updatedAt':new Date()}});return _0x38a698;}async[a79_0x2380a2(0x161)](_0x42fb30,_0x314091){const _0x1040c7=a79_0x2380a2,_0x364209=await database_1[_0x1040c7(0xb9)][_0x1040c7(0x149)][_0x1040c7(0x127)]({'where':{'id':_0x314091,'shopId':_0x42fb30}});if(!_0x364209)throw new Error(_0x1040c7(0xe8));await database_1[_0x1040c7(0xb9)][_0x1040c7(0x149)][_0x1040c7(0x133)]({'where':{'id':_0x314091}});}['formatNetworkName'](_0x95ee0a){const _0x3feeb7=a79_0x2380a2,_0x3a18e5={'polygon':_0x3feeb7(0xcc),'trc20':_0x3feeb7(0x146),'erc20':_0x3feeb7(0x170),'bsc':_0x3feeb7(0xf4),'polygon_usdc':'USDC\x20Polygon','erc20_usdc':_0x3feeb7(0xde)};return _0x3a18e5[_0x95ee0a]||_0x95ee0a;}async[a79_0x2380a2(0x102)](_0x262f23,_0x41f21b){const _0x52edc8=a79_0x2380a2,{page:_0x4c6c44,limit:_0x5c7d23,status:_0xa2013a,method:_0x5b9545,network:_0x58786c,dateFrom:_0x109b72,dateTo:_0x82b208,periodFrom:_0x4c2bca,periodTo:_0x988448}=_0x41f21b,_0x412a37=(_0x4c6c44-0x1)*_0x5c7d23;console[_0x52edc8(0xbc)](_0x52edc8(0xe1),_0x41f21b);const _0x2bd296={'shopId':_0x262f23};_0xa2013a&&(_0x2bd296[_0x52edc8(0x104)]=_0xa2013a[_0x52edc8(0x163)](),console[_0x52edc8(0xbc)](_0x52edc8(0x110)+_0xa2013a[_0x52edc8(0x163)]()));if(_0x5b9545)_0x2bd296[_0x52edc8(0x13f)]=_0x5b9545,console[_0x52edc8(0xbc)]('üåê\x20Method\x20filter:\x20'+_0x5b9545);else _0x58786c&&(_0x2bd296[_0x52edc8(0x13f)]=_0x58786c,console['log'](_0x52edc8(0x123)+_0x58786c));if(_0x109b72||_0x82b208||_0x4c2bca||_0x988448){_0x2bd296[_0x52edc8(0xe3)]={};if(_0x4c2bca){const _0x2c4641=new Date(_0x4c2bca);_0x2c4641['setHours'](0x0,0x0,0x0,0x1),_0x2bd296['createdAt'][_0x52edc8(0x119)]=_0x2c4641,console[_0x52edc8(0xbc)](_0x52edc8(0x169)+_0x2c4641[_0x52edc8(0x17b)]());}else{if(_0x109b72){const _0xbddb6e=new Date(_0x109b72);_0xbddb6e['setHours'](0x0,0x0,0x0,0x1),_0x2bd296[_0x52edc8(0xe3)][_0x52edc8(0x119)]=_0xbddb6e,console['log']('üìÖ\x20Date\x20start:\x20'+_0xbddb6e[_0x52edc8(0x17b)]());}}if(_0x988448){const _0x4de677=new Date(_0x988448);_0x4de677[_0x52edc8(0xc4)](0x17,0x3b,0x3b,0x3e7),_0x2bd296[_0x52edc8(0xe3)]['lte']=_0x4de677,console[_0x52edc8(0xbc)](_0x52edc8(0x145)+_0x4de677[_0x52edc8(0x17b)]());}else{if(_0x82b208){const _0x16ad0a=new Date(_0x82b208);_0x16ad0a['setHours'](0x17,0x3b,0x3b,0x3e7),_0x2bd296[_0x52edc8(0xe3)][_0x52edc8(0x13b)]=_0x16ad0a,console[_0x52edc8(0xbc)](_0x52edc8(0x159)+_0x16ad0a[_0x52edc8(0x17b)]());}}}console[_0x52edc8(0xbc)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x52edc8(0x153)](_0x2bd296,null,0x2));const [_0x575c3a,_0x3eaf1a]=await Promise[_0x52edc8(0x118)]([database_1[_0x52edc8(0xb9)][_0x52edc8(0x132)]['findMany']({'where':_0x2bd296,'skip':_0x412a37,'take':_0x5c7d23,'orderBy':{'createdAt':_0x52edc8(0x112)},'include':{'shop':{'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}}}}),database_1[_0x52edc8(0xb9)][_0x52edc8(0x132)][_0x52edc8(0xce)]({'where':_0x2bd296})]);return{'payouts':_0x575c3a[_0x52edc8(0x18a)](_0x371140=>{const _0x368488=_0x52edc8;let _0x385501=null;switch(_0x371140[_0x368488(0x13f)]){case _0x368488(0x13d):_0x385501=_0x371140[_0x368488(0xfc)][_0x368488(0x130)];break;case _0x368488(0x18b):_0x385501=_0x371140[_0x368488(0xfc)][_0x368488(0xbd)];break;case _0x368488(0xc7):_0x385501=_0x371140[_0x368488(0xfc)][_0x368488(0xd5)];break;case _0x368488(0x142):_0x385501=_0x371140['shop'][_0x368488(0xd8)];break;case _0x368488(0x12c):_0x385501=_0x371140[_0x368488(0xfc)][_0x368488(0x10a)];break;}return{'id':_0x371140['id'],'amount':_0x371140['amount'],'network':this['formatNetworkName'](_0x371140[_0x368488(0x13f)]),'wallet':_0x385501,'status':_0x371140[_0x368488(0x104)],'txid':_0x371140[_0x368488(0x124)],'notes':_0x371140[_0x368488(0xec)],'periodFrom':_0x371140[_0x368488(0x177)],'periodTo':_0x371140[_0x368488(0x10b)],'createdAt':_0x371140['createdAt'],'paidAt':_0x371140[_0x368488(0xf8)]};}),'pagination':{'page':_0x4c6c44,'limit':_0x5c7d23,'total':_0x3eaf1a,'totalPages':Math[_0x52edc8(0x189)](_0x3eaf1a/_0x5c7d23)}};}async[a79_0x2380a2(0x121)](_0x42e73d,_0x5e9aa7){const _0xfab1da=a79_0x2380a2,_0x1e71a4=await database_1[_0xfab1da(0xb9)][_0xfab1da(0x132)][_0xfab1da(0x127)]({'where':{'id':_0x5e9aa7,'shopId':_0x42e73d}});if(!_0x1e71a4)return null;return{'id':_0x1e71a4['id'],'amount':_0x1e71a4[_0xfab1da(0xdf)],'network':_0x1e71a4['network'],'status':_0x1e71a4[_0xfab1da(0x104)],'txid':_0x1e71a4[_0xfab1da(0x124)],'notes':_0x1e71a4[_0xfab1da(0xec)],'createdAt':_0x1e71a4[_0xfab1da(0xe3)],'paidAt':_0x1e71a4[_0xfab1da(0xf8)]};}async[a79_0x2380a2(0x12d)](_0x143094,_0x13d41b){const _0x5e7d9b=a79_0x2380a2,_0x2f73e8=new Date();let _0x2dba39,_0x4ae970;switch(_0x13d41b){case _0x5e7d9b(0x165):case'YESTERDAY':const _0x564f84=new Date(_0x2f73e8);_0x564f84['setDate'](_0x564f84[_0x5e7d9b(0xf2)]()-0x1),_0x2dba39=new Date(_0x564f84),_0x2dba39[_0x5e7d9b(0xc4)](0x0,0x0,0x0,0x0),_0x4ae970=new Date(_0x564f84),_0x4ae970['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'7d':_0x2dba39=new Date(_0x2f73e8[_0x5e7d9b(0x17c)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5e7d9b(0x11c):_0x2dba39=new Date(_0x2f73e8[_0x5e7d9b(0x17c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5e7d9b(0xad):_0x2dba39=new Date(_0x2f73e8[_0x5e7d9b(0x17c)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2dba39=new Date(_0x2f73e8['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const _0x8c1d98={'gte':_0x2dba39};_0x4ae970&&(_0x8c1d98[_0x5e7d9b(0x13b)]=_0x4ae970);const [_0x490cb6,_0x31e1d4,_0x1ed156,_0x4b847e,_0x4bc0d3,_0x397ead]=await Promise['all']([database_1['default'][_0x5e7d9b(0x132)][_0x5e7d9b(0xce)]({'where':{'shopId':_0x143094,'createdAt':_0x8c1d98}}),database_1['default']['payout']['count']({'where':{'shopId':_0x143094,'status':_0x5e7d9b(0xe6),'createdAt':_0x8c1d98}}),database_1['default'][_0x5e7d9b(0x132)][_0x5e7d9b(0xce)]({'where':{'shopId':_0x143094,'status':'PENDING','createdAt':_0x8c1d98}}),database_1[_0x5e7d9b(0xb9)]['payout'][_0x5e7d9b(0xce)]({'where':{'shopId':_0x143094,'status':'REJECTED','createdAt':_0x8c1d98}}),database_1['default'][_0x5e7d9b(0x132)][_0x5e7d9b(0x113)]({'where':{'shopId':_0x143094,'createdAt':_0x8c1d98},'select':{'amount':!![],'status':!![],'network':!![]}}),database_1[_0x5e7d9b(0xb9)][_0x5e7d9b(0x132)][_0x5e7d9b(0x113)]({'where':{'shopId':_0x143094},'take':0xa,'orderBy':{'createdAt':_0x5e7d9b(0x112)},'select':{'id':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'createdAt':!![],'paidAt':!![]}})]),_0x284a2c=_0x4bc0d3[_0x5e7d9b(0xb0)]((_0x4cd505,_0x2306e8)=>_0x4cd505+_0x2306e8[_0x5e7d9b(0xdf)],0x0),_0x189197=_0x4bc0d3[_0x5e7d9b(0x15e)](_0x3dce85=>_0x3dce85[_0x5e7d9b(0x104)]==='COMPLETED')[_0x5e7d9b(0xb0)]((_0x4d4bc9,_0x521a2a)=>_0x4d4bc9+_0x521a2a[_0x5e7d9b(0xdf)],0x0),_0x487cca=_0x4bc0d3[_0x5e7d9b(0x15e)](_0x3dd90e=>_0x3dd90e[_0x5e7d9b(0x104)]===_0x5e7d9b(0x183))[_0x5e7d9b(0xb0)]((_0x574751,_0x538cf0)=>_0x574751+_0x538cf0[_0x5e7d9b(0xdf)],0x0),_0x5730e0=_0x4bc0d3[_0x5e7d9b(0xb0)]((_0x3bd38f,_0x1ec3f5)=>{const _0x5459e6=_0x5e7d9b;return _0x3bd38f[_0x1ec3f5[_0x5459e6(0x13f)]]=(_0x3bd38f[_0x1ec3f5[_0x5459e6(0x13f)]]||0x0)+0x1,_0x3bd38f;},{}),_0x18cc84=_0x4bc0d3[_0x5e7d9b(0xb0)]((_0x5f063d,_0x3ae338)=>{const _0x8bc047=_0x5e7d9b;return _0x5f063d[_0x3ae338[_0x8bc047(0x104)]]=(_0x5f063d[_0x3ae338[_0x8bc047(0x104)]]||0x0)+0x1,_0x5f063d;},{});return{'totalPayouts':_0x490cb6,'completedPayouts':_0x31e1d4,'pendingPayouts':_0x1ed156,'rejectedPayouts':_0x4b847e,'totalAmount':_0x284a2c,'completedAmount':_0x189197,'pendingAmount':_0x487cca,'payoutsByMethod':_0x5730e0,'payoutsByStatus':_0x18cc84,'recentPayouts':_0x397ead[_0x5e7d9b(0x18a)](_0x168523=>({'id':_0x168523['id'],'shopId':_0x143094,'amount':_0x168523[_0x5e7d9b(0xdf)],'method':_0x168523['network'],'status':_0x168523[_0x5e7d9b(0x104)],'txid':_0x168523[_0x5e7d9b(0x124)],'createdAt':_0x168523[_0x5e7d9b(0xe3)],'paidAt':_0x168523[_0x5e7d9b(0xf8)]}))};}async[a79_0x2380a2(0xd2)](_0x54a536){const _0x4ec044=a79_0x2380a2;console['log'](_0x4ec044(0xfa)+_0x54a536+'...');const _0x5bff3e=await database_1['default']['shop'][_0x4ec044(0xff)]({'where':{'id':_0x54a536},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5bff3e)throw new Error(_0x4ec044(0x107));const _0x31cae2=new Date(),_0x467673=new Date(_0x31cae2['getFullYear'](),_0x31cae2[_0x4ec044(0x120)](),0x1),_0xdfcc9b=new Date(_0x31cae2[_0x4ec044(0x106)](),_0x31cae2[_0x4ec044(0x120)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xa6b263=await database_1[_0x4ec044(0xb9)][_0x4ec044(0x132)][_0x4ec044(0x14b)]({'_sum':{'amount':!![]},'where':{'shopId':_0x54a536,'createdAt':{'gte':_0x467673,'lte':_0xdfcc9b},'status':'COMPLETED'}}),_0x525b66=_0xa6b263['_sum'][_0x4ec044(0xdf)]||0x0,_0x5a62dc={'availableBalance':Math[_0x4ec044(0x17f)](_0x5bff3e[_0x4ec044(0xcd)]*0x64)/0x64,'totalPaidOut':Math[_0x4ec044(0x17f)](_0x5bff3e[_0x4ec044(0xb5)]*0x64)/0x64,'awaitingPayout':Math[_0x4ec044(0x17f)](_0x5bff3e[_0x4ec044(0xcd)]*0x64)/0x64,'thisMonth':Math[_0x4ec044(0x17f)](_0x525b66*0x64)/0x64};return console[_0x4ec044(0xbc)]('üìä\x20Shop\x20'+_0x5bff3e['username']+_0x4ec044(0x176)),console[_0x4ec044(0xbc)](_0x4ec044(0x162)+_0x5a62dc[_0x4ec044(0x184)]+'\x20USDT\x20(current\x20balance)'),console[_0x4ec044(0xbc)]('\x20\x20\x20üí∞\x20Total\x20paid\x20out:\x20'+_0x5a62dc[_0x4ec044(0xb5)]+_0x4ec044(0xd9)),console[_0x4ec044(0xbc)](_0x4ec044(0x11b)+_0x5a62dc['awaitingPayout']+'\x20USDT\x20(current\x20balance)'),console[_0x4ec044(0xbc)](_0x4ec044(0xc1)+_0x5a62dc[_0x4ec044(0x190)]+_0x4ec044(0x15f)),_0x5a62dc;}[a79_0x2380a2(0xf6)](_0x7338a){const _0x981c01=a79_0x2380a2,_0x275bf7={'test_gateway':'Test\x20Gateway','plisio':_0x981c01(0x178),'rapyd':'Rapyd','noda':'Noda','cointopay':'CoinToPay','klyme_eu':_0x981c01(0xf1),'klyme_gb':_0x981c01(0x139),'klyme_de':'KLYME\x20DE'};return _0x275bf7[_0x7338a]||_0x7338a;}async['getPayoutStats'](_0x135626){const _0x403c49=a79_0x2380a2;return this[_0x403c49(0xd2)](_0x135626);}async[a79_0x2380a2(0x144)](_0x5c76cc,_0x5862ce){const _0x4c2003=a79_0x2380a2,{page:_0x1a6a8e,limit:_0x52e125,paymentId:_0x152425}=_0x5862ce,_0x23ee2b=(_0x1a6a8e-0x1)*_0x52e125,_0x54f631={'shopId':_0x5c76cc};_0x152425&&(_0x54f631[_0x4c2003(0x13a)]=_0x152425);const [_0x68f141,_0x34cac8]=await Promise[_0x4c2003(0x118)]([database_1[_0x4c2003(0xb9)][_0x4c2003(0xc3)][_0x4c2003(0x113)]({'where':_0x54f631,'skip':_0x23ee2b,'take':_0x52e125,'orderBy':{'createdAt':_0x4c2003(0x112)},'include':{'payment':{'select':{'id':!![],'amount':!![],'currency':!![]}}}}),database_1[_0x4c2003(0xb9)][_0x4c2003(0xc3)]['count']({'where':_0x54f631})]);return{'logs':_0x68f141[_0x4c2003(0x18a)](_0x311bad=>({'id':_0x311bad['id'],'paymentId':_0x311bad[_0x4c2003(0x13a)],'shopId':_0x311bad['shopId'],'event':_0x311bad[_0x4c2003(0xed)],'statusCode':_0x311bad[_0x4c2003(0xe5)],'retryCount':_0x311bad[_0x4c2003(0x100)],'responseBody':_0x311bad[_0x4c2003(0x167)],'createdAt':_0x311bad['createdAt'],'payment':_0x311bad[_0x4c2003(0x149)]})),'pagination':{'page':_0x1a6a8e,'limit':_0x52e125,'total':_0x34cac8,'totalPages':Math[_0x4c2003(0x189)](_0x34cac8/_0x52e125)}};}async[a79_0x2380a2(0x138)](_0x1c4090,_0x1eeb70,_0x38dde7,_0x14556f,_0x1957aa){const _0x4e54e7=a79_0x2380a2;console['log'](_0x4e54e7(0x115)+_0x1c4090+',\x20period:\x20'+_0x1eeb70+_0x4e54e7(0x12e)+_0x38dde7+_0x4e54e7(0xfe)+_0x14556f);const _0x1ab79b=_0x1957aa?new Date(_0x1957aa):new Date();let _0x4eae5a,_0x4b61fa;if(_0x38dde7&&_0x14556f){const _0x1add4f=new Date(_0x38dde7),_0xe7d3fe=new Date(_0x14556f);_0x4eae5a=new Date(Date['UTC'](_0x1add4f[_0x4e54e7(0x154)](),_0x1add4f[_0x4e54e7(0x105)](),_0x1add4f[_0x4e54e7(0x12a)](),0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0xe7d3fe[_0x4e54e7(0x154)](),_0xe7d3fe[_0x4e54e7(0x105)](),_0xe7d3fe[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7)),console[_0x4e54e7(0xbc)](_0x4e54e7(0xb3)+_0x4eae5a[_0x4e54e7(0x17b)]()+_0x4e54e7(0xda)+_0x4b61fa[_0x4e54e7(0x17b)]());}else{if(_0x1eeb70&&_0x1eeb70[_0x4e54e7(0xea)](_0x4e54e7(0x13c))){const _0x82d06a=_0x1eeb70[_0x4e54e7(0x11f)]('custom_','')[_0x4e54e7(0xf0)]('_');if(_0x82d06a[_0x4e54e7(0x10d)]===0x2){const _0x19dd73=new Date(_0x82d06a[0x0]),_0x118369=new Date(_0x82d06a[0x1]);_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x19dd73[_0x4e54e7(0x154)](),_0x19dd73[_0x4e54e7(0x105)](),_0x19dd73[_0x4e54e7(0x12a)](),0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date['UTC'](_0x118369[_0x4e54e7(0x154)](),_0x118369[_0x4e54e7(0x105)](),_0x118369[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7)),console[_0x4e54e7(0xbc)](_0x4e54e7(0x109)+_0x4eae5a['toISOString']()+_0x4e54e7(0xda)+_0x4b61fa[_0x4e54e7(0x17b)]());}else{const _0x4fa832=new Date(Date['UTC'](_0x1ab79b['getUTCFullYear'](),_0x1ab79b[_0x4e54e7(0x105)](),_0x1ab79b[_0x4e54e7(0x12a)]()-0x1e));_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x4fa832[_0x4e54e7(0x154)](),_0x4fa832[_0x4e54e7(0x105)](),_0x4fa832['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b['getUTCMonth'](),_0x1ab79b[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7));}}else{const _0x4f884b=_0x1eeb70||'this_month';switch(_0x4f884b['toLowerCase']()){case _0x4e54e7(0x166):_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b['getUTCFullYear'](),_0x1ab79b[_0x4e54e7(0x105)](),_0x1ab79b['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b[_0x4e54e7(0x105)](),_0x1ab79b[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4e54e7(0x165):const _0x926a65=new Date(_0x1ab79b);_0x926a65['setUTCDate'](_0x926a65[_0x4e54e7(0x12a)]()-0x1),_0x4eae5a=new Date(Date['UTC'](_0x926a65[_0x4e54e7(0x154)](),_0x926a65['getUTCMonth'](),_0x926a65[_0x4e54e7(0x12a)](),0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0x926a65[_0x4e54e7(0x154)](),_0x926a65['getUTCMonth'](),_0x926a65[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4e54e7(0x122):const _0x2fb401=_0x1ab79b[_0x4e54e7(0x135)](),_0x489e28=_0x2fb401===0x0?-0x6:0x1-_0x2fb401,_0x20b84d=_0x1ab79b['getUTCDate']()+_0x489e28;_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b[_0x4e54e7(0x105)](),_0x20b84d,0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b[_0x4e54e7(0x105)](),_0x1ab79b['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x4e54e7(0xaf):const _0x3ed32e=new Date(Date['UTC'](_0x1ab79b['getUTCFullYear'](),_0x1ab79b['getUTCMonth'](),_0x1ab79b[_0x4e54e7(0x12a)]()-0x7)),_0x8116b6=_0x3ed32e[_0x4e54e7(0x135)](),_0x89c6a=_0x8116b6===0x0?-0x6:0x1-_0x8116b6,_0x58f9e8=_0x3ed32e['getUTCDate']()+_0x89c6a;_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x3ed32e['getUTCFullYear'](),_0x3ed32e[_0x4e54e7(0x105)](),_0x58f9e8,0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0x3ed32e[_0x4e54e7(0x154)](),_0x3ed32e[_0x4e54e7(0x105)](),_0x58f9e8+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x4e54e7(0x147):_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b[_0x4e54e7(0x105)](),0x1,0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date['UTC'](_0x1ab79b['getUTCFullYear'](),_0x1ab79b[_0x4e54e7(0x105)](),_0x1ab79b[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4e54e7(0xba):_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b[_0x4e54e7(0x105)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date['UTC'](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b[_0x4e54e7(0x105)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b['getUTCMonth'](),_0x1ab79b[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x4eae5a=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b['getUTCFullYear'](),_0x1ab79b[_0x4e54e7(0x105)](),0x1,0x0,0x0,0x0,0x0)),_0x4b61fa=new Date(Date[_0x4e54e7(0xd7)](_0x1ab79b[_0x4e54e7(0x154)](),_0x1ab79b[_0x4e54e7(0x105)](),_0x1ab79b[_0x4e54e7(0x12a)](),0x17,0x3b,0x3b,0x3e7));}}}console['log'](_0x4e54e7(0xf7)+_0x4eae5a[_0x4e54e7(0x17b)]()+'\x20to\x20'+_0x4b61fa[_0x4e54e7(0x17b)]());const _0x1c413e={'gte':_0x4eae5a,'lte':_0x4b61fa},[_0x27c44c,_0x5aca36,_0x2a9d6e,_0x29a1d4,_0x4f3c20,_0x4e58a0,_0x14903c,_0x33d8c1,_0x48d074,_0x40b4fa]=await Promise['all']([database_1[_0x4e54e7(0xb9)][_0x4e54e7(0x149)]['count']({'where':{'shopId':_0x1c4090,'gateway':{'not':'test_gateway'},'status':{'notIn':[_0x4e54e7(0x183),'EXPIRED']},'createdAt':_0x1c413e}}),database_1[_0x4e54e7(0xb9)]['payment'][_0x4e54e7(0xce)]({'where':{'shopId':_0x1c4090,'gateway':{'not':'test_gateway'},'status':_0x4e54e7(0xb4),'createdAt':_0x1c413e}}),database_1[_0x4e54e7(0xb9)]['payment']['count']({'where':{'shopId':_0x1c4090,'gateway':{'not':_0x4e54e7(0x18c)},'status':_0x4e54e7(0x15b)}}),database_1[_0x4e54e7(0xb9)]['payment'][_0x4e54e7(0xce)]({'where':{'shopId':_0x1c4090,'gateway':{'not':_0x4e54e7(0x18c)},'status':_0x4e54e7(0x157)}}),database_1[_0x4e54e7(0xb9)]['payment'][_0x4e54e7(0x113)]({'where':{'shopId':_0x1c4090,'gateway':{'not':'test_gateway'},'status':_0x4e54e7(0xb4),'createdAt':_0x1c413e},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x4e54e7(0x149)][_0x4e54e7(0x113)]({'where':{'shopId':_0x1c4090,'gateway':{'not':_0x4e54e7(0x18c)}},'take':0x4,'orderBy':{'createdAt':_0x4e54e7(0x112)},'select':{'id':!![],'gateway':!![],'amount':!![],'currency':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4e54e7(0xb9)]['payment'][_0x4e54e7(0x113)]({'where':{'shopId':_0x1c4090,'gateway':{'not':_0x4e54e7(0x18c)},'createdAt':_0x1c413e},'select':{'status':!![],'amountUSDT':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4e54e7(0xdd)}}),database_1[_0x4e54e7(0xb9)][_0x4e54e7(0x149)][_0x4e54e7(0xce)]({'where':{'shopId':_0x1c4090,'gateway':{'not':_0x4e54e7(0x18c)},'status':_0x4e54e7(0xb4)}}),database_1[_0x4e54e7(0xb9)][_0x4e54e7(0x149)]['findMany']({'where':{'shopId':_0x1c4090,'gateway':{'not':'test_gateway'},'status':'PAID'},'select':{'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4e54e7(0xb9)][_0x4e54e7(0xfc)][_0x4e54e7(0xff)]({'where':{'id':_0x1c4090},'select':{'balance':!![]}})]);let _0x2af624=0x0,_0x3424fd=0x0;for(const _0x34b7c5 of _0x4f3c20){if(_0x34b7c5[_0x4e54e7(0x14d)])_0x2af624+=_0x34b7c5[_0x4e54e7(0x14d)];else{const _0x485366=await currencyService_1['currencyService'][_0x4e54e7(0xd6)](_0x34b7c5[_0x4e54e7(0xdf)],_0x34b7c5['currency']);_0x2af624+=_0x485366;}_0x34b7c5[_0x4e54e7(0x14e)]&&(_0x3424fd+=_0x34b7c5[_0x4e54e7(0x14e)]);}let _0x29c919=0x0;for(const _0x4828a4 of _0x48d074){_0x4828a4[_0x4e54e7(0x14e)]&&(_0x29c919+=_0x4828a4['amountAfterGatewayCommissionUSDT']);}const _0x1abc04=this[_0x4e54e7(0x114)](_0x14903c,_0x4eae5a,_0x4b61fa||_0x1ab79b),_0x55f2cf=_0x27c44c>0x0?_0x5aca36/_0x27c44c*0x64:0x0,_0x4b1d3a=_0x33d8c1>0x0?_0x2a9d6e/_0x33d8c1*0x64:0x0;return{'totalPayments':_0x27c44c,'successfulPayments':_0x5aca36,'totalRevenue':Math[_0x4e54e7(0x17f)](_0x2af624*0x64)/0x64,'merchantEarnings':Math[_0x4e54e7(0x17f)](_0x3424fd*0x64)/0x64,'merchantTotalRevenue':Math['round'](_0x29c919*0x64)/0x64,'payoutBalance':Math[_0x4e54e7(0x17f)]((_0x40b4fa?.[_0x4e54e7(0xcd)]||0x0)*0x64)/0x64,'conversionRate':Math['round'](_0x55f2cf*0x64)/0x64,'chargebackRate':Math['round'](_0x4b1d3a*0x64)/0x64,'chargebacks':_0x2a9d6e,'refunds':_0x29a1d4,'dailyRevenue':_0x1abc04[_0x4e54e7(0xe0)],'dailyPayments':_0x1abc04['dailyPayments'],'recentPayments':_0x4e58a0['map'](_0x14eaf3=>({'id':_0x14eaf3['id'],'gateway':_0x14eaf3[_0x4e54e7(0x15c)],'amount':_0x14eaf3[_0x4e54e7(0xdf)],'currency':_0x14eaf3['currency'],'status':_0x14eaf3['status'],'createdAt':_0x14eaf3[_0x4e54e7(0xe3)]}))};}[a79_0x2380a2(0x114)](_0x333643,_0x2fc6c4,_0x1e68f7){const _0x4ba02d=a79_0x2380a2,_0x5196aa=new Map(),_0x1ce466=new Date(_0x2fc6c4);while(_0x1ce466<=_0x1e68f7){const _0x36ed52=_0x1ce466[_0x4ba02d(0x17b)]()['split']('T')[0x0];_0x5196aa[_0x4ba02d(0x15d)](_0x36ed52,{'revenue':0x0,'count':0x0}),_0x1ce466[_0x4ba02d(0xca)](_0x1ce466['getDate']()+0x1);}for(const _0x198de1 of _0x333643){const _0x4e50ba=_0x198de1[_0x4ba02d(0xe3)]['toISOString']()[_0x4ba02d(0xf0)]('T')[0x0],_0x2cafdb=_0x5196aa['get'](_0x4e50ba);_0x2cafdb&&(_0x2cafdb[_0x4ba02d(0xce)]+=0x1,_0x198de1[_0x4ba02d(0x104)]===_0x4ba02d(0xb4)&&_0x198de1['amountUSDT']&&(_0x2cafdb['revenue']+=_0x198de1['amountUSDT']));}const _0x14ff29=[],_0x93d88d=[];for(const [_0x39da1e,_0x3f78f1]of _0x5196aa){_0x14ff29[_0x4ba02d(0x16d)]({'date':_0x39da1e,'amount':Math[_0x4ba02d(0x17f)](_0x3f78f1[_0x4ba02d(0x103)]*0x64)/0x64}),_0x93d88d[_0x4ba02d(0x16d)]({'date':_0x39da1e,'count':_0x3f78f1[_0x4ba02d(0xce)]});}return{'dailyRevenue':_0x14ff29,'dailyPayments':_0x93d88d};}[a79_0x2380a2(0xc8)](_0x5415cd=0x8){const _0x2724ed=a79_0x2380a2,_0x2a6091=[];for(let _0x2d8b15=0x0;_0x2d8b15<_0x5415cd;_0x2d8b15++){const _0x39ec21=crypto_1[_0x2724ed(0xb9)][_0x2724ed(0xf3)](0x4)['toString'](_0x2724ed(0xcb))[_0x2724ed(0x163)]();_0x2a6091[_0x2724ed(0x16d)](_0x39ec21);}return _0x2a6091;}async[a79_0x2380a2(0x18f)](_0x27952f){const _0x18408b=a79_0x2380a2,_0x591a58=await database_1['default'][_0x18408b(0xfc)][_0x18408b(0xff)]({'where':{'id':_0x27952f},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x591a58)throw new Error(_0x18408b(0x107));const _0x3a0d2f=speakeasy_1['default'][_0x18408b(0x13e)]({'name':'TrapaPay\x20('+_0x591a58[_0x18408b(0x16a)]+')','issuer':'TrapaPay','length':0x20}),_0x2dc3ab=await qrcode_1['default'][_0x18408b(0x136)](_0x3a0d2f[_0x18408b(0xbf)]),_0xaf00b6=this['generateBackupCodes'](0x8),_0x21ddc4=await Promise[_0x18408b(0x118)](_0xaf00b6[_0x18408b(0x18a)](_0xde8b3b=>bcryptjs_1[_0x18408b(0xb9)][_0x18408b(0x101)](_0xde8b3b,0xa)));return await database_1[_0x18408b(0xb9)][_0x18408b(0xfc)][_0x18408b(0x10f)]({'where':{'id':_0x27952f},'data':{'twoFactorSecret':_0x3a0d2f[_0x18408b(0x187)],'backupCodes':JSON[_0x18408b(0x153)](_0x21ddc4)}}),console[_0x18408b(0xbc)](_0x18408b(0x156)+_0x591a58[_0x18408b(0x16a)]),console[_0x18408b(0xbc)](_0x18408b(0xc2)+_0xaf00b6[_0x18408b(0x10d)]+_0x18408b(0x131)),{'secret':_0x3a0d2f[_0x18408b(0x187)],'qrCode':_0x2dc3ab,'manualEntryKey':_0x3a0d2f[_0x18408b(0x187)],'backupCodes':_0xaf00b6};}async['enable2FA'](_0x3b155e,_0xefbc3b){const _0x331809=a79_0x2380a2,_0x10b2ab=await database_1[_0x331809(0xb9)]['shop'][_0x331809(0xff)]({'where':{'id':_0x3b155e},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x10b2ab)throw new Error(_0x331809(0x107));if(!_0x10b2ab[_0x331809(0x11d)])throw new Error(_0x331809(0x164));if(_0x10b2ab['twoFactorEnabled'])throw new Error(_0x331809(0x12b));const _0x2f193c=speakeasy_1['default'][_0x331809(0x125)][_0x331809(0x168)]({'secret':_0x10b2ab[_0x331809(0x11d)],'encoding':'base32','token':_0xefbc3b,'window':0x2});if(!_0x2f193c)throw new Error('Invalid\x202FA\x20token');return await database_1['default'][_0x331809(0xfc)][_0x331809(0x10f)]({'where':{'id':_0x3b155e},'data':{'twoFactorEnabled':!![]}}),console[_0x331809(0xbc)](_0x331809(0xee)+_0x10b2ab['username']),{'enabled':!![]};}async[a79_0x2380a2(0xcf)](_0x41254b){const _0x2607d6=a79_0x2380a2,_0x41eb03=await database_1[_0x2607d6(0xb9)][_0x2607d6(0xfc)]['findUnique']({'where':{'id':_0x41254b},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x41eb03)throw new Error(_0x2607d6(0x107));await database_1[_0x2607d6(0xb9)][_0x2607d6(0xfc)]['update']({'where':{'id':_0x41254b},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log']('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x41eb03[_0x2607d6(0x16a)]);}}function a79_0x5515(){const _0x4ba746=['dailyRevenue','üí∞\x20Getting\x20payouts\x20with\x20filters:','telegram','createdAt','speakeasy','statusCode','COMPLETED','2421207dnAzra','Payment\x20not\x20found','POST','startsWith','language','notes','event','üîê\x202FA\x20enabled\x20for\x20shop:\x20','sourceCurrency','split','KLYME\x20EU','getDate','randomBytes','USDT\x20BSC','twoFactorToken','getGatewayDisplayName','üìÖ\x20Final\x20date\x20range:\x20','paidAt','973SbYqOi','üìä\x20Calculating\x20shop\x20payout\x20stats\x20for\x20shop\x20','__esModule','shop','../config/database',',\x20dateTo:\x20','findUnique','retryCount','hash','getPayouts','revenue','status','getUTCMonth','getFullYear','Shop\x20not\x20found','Payment\x20System/1.0\x20(Test)','üìÖ\x20Custom\x20period:\x20','usdcErcWallet','periodTo','../types/gateway','length','twoFactorEnabled','update','üìä\x20Status\x20filter:\x20','test_payment_123','desc','findMany','generateDailyStatistics','üìä\x20Getting\x20statistics\x20for\x20shop\x20','isArray','error','all','gte','Error\x20parsing\x20webhook\x20events:','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','30d','twoFactorSecret','createPayment','replace','getMonth','getPayoutById','this_week','üåê\x20Network\x20filter:\x20','txid','totp','message','findFirst','parse','__importDefault','getUTCDate','2FA\x20is\x20already\x20enabled','erc20_usdc','getPayoutStatistics',',\x20dateFrom:\x20','name','usdtPolygonWallet','\x20backup\x20codes','payout','delete','./currencyService','getUTCDay','toDataURL','PaymentService','getStatistics','KLYME\x20GB','paymentId','lte','custom_','polygon','generateSecret','network','30DPFpJe','676846AeEyyZ','polygon_usdc','3933963ZDLtWI','getWebhookLogs','üìÖ\x20Period\x20end:\x20','USDT\x20TRC20','this_month','4703004uzuvwr','payment','settings','aggregate','telegramId','amountUSDT','amountAfterGatewayCommissionUSDT','customer','redirectUrl','gateways','maxPayments','stringify','getUTCFullYear','shopUrl','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','REFUND','Failed\x20to\x20send\x20webhook:\x20','üìÖ\x20Date\x20end:\x20','wallets','CHARGEBACK','gateway','set','filter','\x20USDT','4201428DhZIou','deletePayment','\x20\x20\x20üíµ\x20Available\x20balance:\x20','toUpperCase','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','yesterday','today','responseBody','verify','üìÖ\x20Period\x20start:\x20','username','compare','application/json','push','60392czOGFe','crypto','USDT\x20ERC20','Invalid\x202FA\x20token\x20or\x20backup\x20code','backupCodes','defineProperty','fullName','updateShopProfile','\x20payout\x20statistics\x20calculated:','periodFrom','Plisio','isActive','paymentService','toISOString','getTime','amountIsEditable','2FA\x20token\x20is\x20required','round','2264FhCIZj','splice','customerEmail','PENDING','availableBalance','test_order_123','currency','base32','webhookUrl','ceil','map','trc20','test_gateway','gatewaySettings','./paymentService','setup2FA','thisMonth','90d','4aJKrLB','last_week','reduce','toLowerCase','updateWallets','üìÖ\x20Custom\x20date\x20range:\x20','PAID','totalPaidOut','getPayments','getPaymentByShopAndId','getPaymentById','default','last_month','usage','log','usdtTrcWallet','publicKey','otpauth_url','qrcode','\x20\x20\x20üìÖ\x20This\x20month:\x20','üîë\x20Generated\x20','webhookLog','setHours','webhookEvents','310SAfmDz','erc20','generateBackupCodes','paymentGateways','setDate','hex','USDT\x20Polygon','balance','count','disable2FA','ShopService','Unknown\x20error','getShopPayoutStats','merchantUrl','getShopProfile','usdtErcWallet','convertToUSDT','UTC','usdcPolygonWallet','\x20USDT\x20(total\x20payouts)','\x20to\x20','bcryptjs','country','asc','USDC\x20Ethereum','amount'];a79_0x5515=function(){return _0x4ba746;};return a79_0x5515();}exports[a79_0x2380a2(0xd0)]=ShopService;