'use strict';const a48_0x419bc4=a48_0x2657;(function(_0x40a4e6,_0x25e4f7){const _0x37ce13=a48_0x2657,_0x440aba=_0x40a4e6();while(!![]){try{const _0x26b9fc=parseInt(_0x37ce13(0x1c7))/0x1*(parseInt(_0x37ce13(0x1fe))/0x2)+parseInt(_0x37ce13(0x1bd))/0x3+-parseInt(_0x37ce13(0x1d4))/0x4+parseInt(_0x37ce13(0x1d7))/0x5+parseInt(_0x37ce13(0x1db))/0x6+-parseInt(_0x37ce13(0x1b7))/0x7+-parseInt(_0x37ce13(0x1b8))/0x8*(-parseInt(_0x37ce13(0x1b3))/0x9);if(_0x26b9fc===_0x25e4f7)break;else _0x440aba['push'](_0x440aba['shift']());}catch(_0x256e31){_0x440aba['push'](_0x440aba['shift']());}}}(a48_0x1f3f,0xcca3d));function a48_0x2657(_0x1d4a1a,_0x2e5d5b){const _0x1f3fc9=a48_0x1f3f();return a48_0x2657=function(_0x2657e9,_0x12ad7f){_0x2657e9=_0x2657e9-0x1b1;let _0x5059b2=_0x1f3fc9[_0x2657e9];return _0x5059b2;},a48_0x2657(_0x1d4a1a,_0x2e5d5b);}function a48_0x1f3f(){const _0x25843a=['🧹\x20Cleaned\x20','logWhiteDomainError','SHOP_WEBHOOK_ERROR','.log','\x20old\x20log\x20files\x20(older\x20than\x20','ERROR','webhooks_received','8134623kUmEgT','WEBHOOK_ERROR','writeLog','loggerService','11603228DJetUH','8jVJzOL','cointopay_status_changes','logCoinToPayStatus','PAYMENT_CREATED','logShopWebhookError','3657234GLnhmC','api_calls','logs','webhooks_processed','getLogFileName','Failed\x20to\x20clean\x20old\x20logs:','white_domain_requests','join','error','API_CALL','1436dpVjDP','logShopWebhookSent','statSync','Failed\x20to\x20write\x20','endsWith','log','WEBHOOK_PROCESSED','WEBHOOK_RECEIVED','SHOP_WEBHOOK_SENT','shop_webhooks_errors','__importDefault','default','mkdirSync','5618280HHwqpo','map','shop_webhooks_sent','2626090NVNNYj','message','stringify','RESPONSE','181200YzDbjg','logWebhookProcessed','logWebhookError','unlinkSync','sort','setDate','logsDir','cwd','localeCompare','toISOString','readdirSync','appendFileSync','mtime','forEach','__esModule','🗑️\x20Deleted\x20old\x20log\x20file:\x20','size','date','split','cointopay_errors','getDate','logCoinToPayError','logApiCall','replace','filter','getLogStats','existsSync','COINTOPAY_ERROR','utf8','LoggerService','REQUEST','length','stack','Failed\x20to\x20get\x20log\x20stats:','defineProperty','1702cAoRXB','slice'];a48_0x1f3f=function(){return _0x25843a;};return a48_0x1f3f();}var __importDefault=this&&this[a48_0x419bc4(0x1d1)]||function(_0x38eb4a){const _0x58cc08=a48_0x419bc4;return _0x38eb4a&&_0x38eb4a[_0x58cc08(0x1e9)]?_0x38eb4a:{'default':_0x38eb4a};};Object[a48_0x419bc4(0x1fd)](exports,a48_0x419bc4(0x1e9),{'value':!![]}),exports[a48_0x419bc4(0x1b6)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x5aa2ab=a48_0x419bc4;this[_0x5aa2ab(0x1e1)]=path_1[_0x5aa2ab(0x1d2)][_0x5aa2ab(0x1c4)](process[_0x5aa2ab(0x1e2)](),_0x5aa2ab(0x1bf)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x4d89b9=a48_0x419bc4;!fs_1[_0x4d89b9(0x1d2)][_0x4d89b9(0x1f5)](this[_0x4d89b9(0x1e1)])&&(fs_1['default'][_0x4d89b9(0x1d3)](this['logsDir'],{'recursive':!![]}),console[_0x4d89b9(0x1cc)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x4d89b9(0x1e1)]));}[a48_0x419bc4(0x1c1)](_0x48501c){const _0x228eea=a48_0x419bc4,_0x375cc5=new Date()[_0x228eea(0x1e4)]()[_0x228eea(0x1ed)]('T')[0x0];return path_1[_0x228eea(0x1d2)][_0x228eea(0x1c4)](this[_0x228eea(0x1e1)],_0x48501c+'_'+_0x375cc5+_0x228eea(0x203));}[a48_0x419bc4(0x1b5)](_0x2cd5a6,_0x254135){const _0x125561=a48_0x419bc4;try{const _0x237bc8=new Date()[_0x125561(0x1e4)](),_0x47d5b1={'timestamp':_0x237bc8,..._0x254135},_0x2f7a9e=JSON[_0x125561(0x1d9)](_0x47d5b1)+'\x0a',_0x34d200=this[_0x125561(0x1c1)](_0x2cd5a6);fs_1[_0x125561(0x1d2)][_0x125561(0x1e6)](_0x34d200,_0x2f7a9e,_0x125561(0x1f7));}catch(_0x4d74d4){console[_0x125561(0x1c5)](_0x125561(0x1ca)+_0x2cd5a6+'\x20log:',_0x4d74d4);}}['logWhiteDomainRequest'](_0x263783,_0x34f9a3,_0x4798fc,_0x19e6f4){const _0x3da968=a48_0x419bc4;this['writeLog'](_0x3da968(0x1c3),{'type':_0x3da968(0x1f9),'gateway':_0x263783,'endpoint':_0x34f9a3,'method':_0x4798fc,'data':_0x19e6f4});}['logWhiteDomainResponse'](_0x50bb6d,_0x5abf1f,_0x1a1d8b,_0x2c13d8,_0x2f8e6b){const _0x5ac765=a48_0x419bc4;this[_0x5ac765(0x1b5)]('white_domain_responses',{'type':_0x5ac765(0x1da),'gateway':_0x50bb6d,'endpoint':_0x5abf1f,'status':_0x1a1d8b,'responseTime':_0x2f8e6b,'data':_0x2c13d8});}[a48_0x419bc4(0x201)](_0x52482f,_0x40fc15,_0x19f672){const _0x35545a=a48_0x419bc4;this[_0x35545a(0x1b5)]('white_domain_errors',{'type':_0x35545a(0x1b1),'gateway':_0x52482f,'endpoint':_0x40fc15,'error':_0x19f672 instanceof Error?{'message':_0x19f672[_0x35545a(0x1d8)],'stack':_0x19f672[_0x35545a(0x1fb)]}:_0x19f672});}['logWebhookReceived'](_0x57f000,_0x57449b,_0x3a1a96){const _0x55a63a=a48_0x419bc4;this[_0x55a63a(0x1b5)](_0x55a63a(0x1b2),{'type':_0x55a63a(0x1ce),'gateway':_0x57f000,'headers':_0x3a1a96,'data':_0x57449b});}[a48_0x419bc4(0x1dc)](_0x349f3e,_0x31142b,_0x19c279,_0x9cb528,_0x3ac923){const _0x4f89b3=a48_0x419bc4;this[_0x4f89b3(0x1b5)](_0x4f89b3(0x1c0),{'type':_0x4f89b3(0x1cd),'gateway':_0x349f3e,'paymentId':_0x31142b,'oldStatus':_0x19c279,'newStatus':_0x9cb528,'originalData':_0x3ac923});}[a48_0x419bc4(0x1dd)](_0x531b8b,_0x1bab3d,_0x63b111){const _0x426ac9=a48_0x419bc4;this['writeLog']('webhooks_errors',{'type':_0x426ac9(0x1b4),'gateway':_0x531b8b,'error':_0x1bab3d instanceof Error?{'message':_0x1bab3d[_0x426ac9(0x1d8)],'stack':_0x1bab3d[_0x426ac9(0x1fb)]}:_0x1bab3d,'originalData':_0x63b111});}[a48_0x419bc4(0x1ba)](_0x43767f){const _0x2a83fe=a48_0x419bc4;this['writeLog'](_0x2a83fe(0x1b9),{'type':'COINTOPAY_STATUS_CHANGE',..._0x43767f});}[a48_0x419bc4(0x1f0)](_0x2bf7df){const _0x3ab1c7=a48_0x419bc4;this['writeLog'](_0x3ab1c7(0x1ee),{'type':_0x3ab1c7(0x1f6),..._0x2bf7df});}[a48_0x419bc4(0x1c8)](_0x33d7f4,_0x5a3b87,_0x135ef7,_0x6ccf1b,_0x4caa1b,_0x3e9205){const _0x46cb03=a48_0x419bc4;this[_0x46cb03(0x1b5)](_0x46cb03(0x1d6),{'type':_0x46cb03(0x1cf),'shopId':_0x33d7f4,'webhookUrl':_0x5a3b87,'event':_0x135ef7,'status':_0x6ccf1b,'responseTime':_0x4caa1b,'payload':_0x3e9205});}[a48_0x419bc4(0x1bc)](_0x18d7aa,_0x2118fa,_0x24e15e,_0x20dfba,_0x5296d7){const _0x4e9134=a48_0x419bc4;this[_0x4e9134(0x1b5)](_0x4e9134(0x1d0),{'type':_0x4e9134(0x202),'shopId':_0x18d7aa,'webhookUrl':_0x2118fa,'event':_0x24e15e,'error':_0x20dfba instanceof Error?{'message':_0x20dfba['message'],'stack':_0x20dfba['stack']}:_0x20dfba,'payload':_0x5296d7});}['logPaymentCreated'](_0x42c3c4,_0x30b514,_0x500b01,_0x206de3,_0x579cd6){const _0xfbb100=a48_0x419bc4;this[_0xfbb100(0x1b5)]('payments_created',{'type':_0xfbb100(0x1bb),'gateway':_0x42c3c4,'paymentId':_0x30b514,'shopId':_0x500b01,'amount':_0x206de3,'currency':_0x579cd6});}[a48_0x419bc4(0x1f1)](_0x389e68,_0x1db47e,_0x4dc55e,_0x19932c,_0x12b0e1){const _0x28bb11=a48_0x419bc4;this[_0x28bb11(0x1b5)](_0x28bb11(0x1be),{'type':_0x28bb11(0x1c6),'endpoint':_0x389e68,'method':_0x1db47e,'userId':_0x4dc55e,'userRole':_0x19932c,'requestData':_0x12b0e1});}[a48_0x419bc4(0x1f4)](){const _0x55617f=a48_0x419bc4;try{const _0x5158e6=fs_1[_0x55617f(0x1d2)][_0x55617f(0x1e5)](this[_0x55617f(0x1e1)]),_0x32f85a=_0x5158e6[_0x55617f(0x1f3)](_0x4b7e96=>_0x4b7e96[_0x55617f(0x1cb)](_0x55617f(0x203))),_0xfdbd12=[...new Set(_0x32f85a[_0x55617f(0x1d5)](_0x398e1b=>_0x398e1b['split']('_')[0x0]))],_0x412fdb=_0x32f85a[_0x55617f(0x1d5)](_0x4b67e8=>{const _0x1bb989=_0x55617f,_0x34c3c8=path_1['default']['join'](this[_0x1bb989(0x1e1)],_0x4b67e8),_0x1adbd0=fs_1['default'][_0x1bb989(0x1c9)](_0x34c3c8),[_0x23a892,_0x4f9d00]=_0x4b67e8[_0x1bb989(0x1f2)](_0x1bb989(0x203),'')[_0x1bb989(0x1ed)]('_');return{'type':_0x23a892,'date':_0x4f9d00,'size':_0x1adbd0[_0x1bb989(0x1eb)]};})[_0x55617f(0x1df)]((_0x844063,_0x154c9c)=>_0x154c9c[_0x55617f(0x1ec)][_0x55617f(0x1e3)](_0x844063[_0x55617f(0x1ec)]));return{'totalFiles':_0x32f85a[_0x55617f(0x1fa)],'logTypes':_0xfdbd12,'latestLogs':_0x412fdb[_0x55617f(0x1ff)](0x0,0xa)};}catch(_0xdec866){return console[_0x55617f(0x1c5)](_0x55617f(0x1fc),_0xdec866),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x9d78fa=0x1e){const _0x3c3f7b=a48_0x419bc4;try{const _0x516089=fs_1[_0x3c3f7b(0x1d2)]['readdirSync'](this[_0x3c3f7b(0x1e1)]),_0x1b6987=new Date();_0x1b6987[_0x3c3f7b(0x1e0)](_0x1b6987[_0x3c3f7b(0x1ef)]()-_0x9d78fa);let _0x48512f=0x0;_0x516089[_0x3c3f7b(0x1e8)](_0x36e086=>{const _0x4cd7f0=_0x3c3f7b;if(!_0x36e086[_0x4cd7f0(0x1cb)](_0x4cd7f0(0x203)))return;const _0x271bef=path_1[_0x4cd7f0(0x1d2)][_0x4cd7f0(0x1c4)](this[_0x4cd7f0(0x1e1)],_0x36e086),_0x6e28b7=fs_1[_0x4cd7f0(0x1d2)][_0x4cd7f0(0x1c9)](_0x271bef);_0x6e28b7[_0x4cd7f0(0x1e7)]<_0x1b6987&&(fs_1[_0x4cd7f0(0x1d2)][_0x4cd7f0(0x1de)](_0x271bef),_0x48512f++,console[_0x4cd7f0(0x1cc)](_0x4cd7f0(0x1ea)+_0x36e086));}),console[_0x3c3f7b(0x1cc)](_0x3c3f7b(0x200)+_0x48512f+_0x3c3f7b(0x204)+_0x9d78fa+'\x20days)');}catch(_0x20a063){console[_0x3c3f7b(0x1c5)](_0x3c3f7b(0x1c2),_0x20a063);}}}exports[a48_0x419bc4(0x1f8)]=LoggerService,exports['loggerService']=new LoggerService();