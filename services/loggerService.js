'use strict';function a48_0x232c(_0x4f170b,_0x1994d4){const _0x4d1dcc=a48_0x4d1d();return a48_0x232c=function(_0x232cc5,_0x97eff){_0x232cc5=_0x232cc5-0x15c;let _0x4e6900=_0x4d1dcc[_0x232cc5];return _0x4e6900;},a48_0x232c(_0x4f170b,_0x1994d4);}function a48_0x4d1d(){const _0x4a3d31=['getLogStats','logWhiteDomainResponse','webhooks_errors','message','LoggerService','API_CALL','mtime','.log','logCoinToPayError','266721hqlAmx','stringify','mkdirSync','1196065LNSUMt','🗑️\x20Deleted\x20old\x20log\x20file:\x20','stack','white_domain_responses','date','api_calls','837748AeVspA','map','Failed\x20to\x20write\x20','localeCompare','COINTOPAY_STATUS_CHANGE','49674wwcsED','replace','webhooks_received','logApiCall','error','shop_webhooks_errors','1614264mBwFlh','getLogFileName','REQUEST','ensureLogsDirectory','path','loggerService','cleanOldLogs','ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','WEBHOOK_RECEIVED','cointopay_errors','unlinkSync','existsSync','getDate','1020858EoPwzt','toISOString','SHOP_WEBHOOK_ERROR','logPaymentCreated','logShopWebhookSent','split','readdirSync','log','default','endsWith','cwd','390UvdiCB','logCoinToPayStatus','logWebhookReceived','\x20days)','size','white_domain_requests','appendFileSync','statSync','sort','payments_created','\x20log:','slice','logWebhookError','logShopWebhookError','COINTOPAY_ERROR','logs','logWhiteDomainError','join','1418PrCNAp','writeLog','defineProperty','logsDir','SHOP_WEBHOOK_SENT','📁\x20Created\x20logs\x20directory:\x20','logWhiteDomainRequest'];a48_0x4d1d=function(){return _0x4a3d31;};return a48_0x4d1d();}const a48_0x50d2f5=a48_0x232c;(function(_0x2e0652,_0x79fcee){const _0x13c36e=a48_0x232c,_0x271a4c=_0x2e0652();while(!![]){try{const _0x7a20a9=-parseInt(_0x13c36e(0x190))/0x1*(parseInt(_0x13c36e(0x17e))/0x2)+-parseInt(_0x13c36e(0x15f))/0x3+-parseInt(_0x13c36e(0x1a9))/0x4+parseInt(_0x13c36e(0x1a3))/0x5+parseInt(_0x13c36e(0x173))/0x6+parseInt(_0x13c36e(0x1a0))/0x7+parseInt(_0x13c36e(0x165))/0x8;if(_0x7a20a9===_0x79fcee)break;else _0x271a4c['push'](_0x271a4c['shift']());}catch(_0x318cae){_0x271a4c['push'](_0x271a4c['shift']());}}}(a48_0x4d1d,0x23d31));var __importDefault=this&&this['__importDefault']||function(_0x31a4b5){return _0x31a4b5&&_0x31a4b5['__esModule']?_0x31a4b5:{'default':_0x31a4b5};};Object[a48_0x50d2f5(0x192)](exports,'__esModule',{'value':!![]}),exports[a48_0x50d2f5(0x16a)]=exports[a48_0x50d2f5(0x19b)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x50d2f5(0x169)));class LoggerService{constructor(){const _0x1aa266=a48_0x50d2f5;this[_0x1aa266(0x193)]=path_1['default'][_0x1aa266(0x18f)](process[_0x1aa266(0x17d)](),_0x1aa266(0x18d)),this[_0x1aa266(0x168)]();}[a48_0x50d2f5(0x168)](){const _0xccdb69=a48_0x50d2f5;!fs_1['default'][_0xccdb69(0x171)](this[_0xccdb69(0x193)])&&(fs_1['default'][_0xccdb69(0x1a2)](this[_0xccdb69(0x193)],{'recursive':!![]}),console[_0xccdb69(0x17a)](_0xccdb69(0x195)+this[_0xccdb69(0x193)]));}['getLogFileName'](_0x521a6c){const _0x5768fe=a48_0x50d2f5,_0x99b1db=new Date()[_0x5768fe(0x174)]()['split']('T')[0x0];return path_1[_0x5768fe(0x17b)]['join'](this[_0x5768fe(0x193)],_0x521a6c+'_'+_0x99b1db+_0x5768fe(0x19e));}[a48_0x50d2f5(0x191)](_0x315fc5,_0x5b9d37){const _0x3581e5=a48_0x50d2f5;try{const _0x3db6c1=new Date()[_0x3581e5(0x174)](),_0x78875a={'timestamp':_0x3db6c1,..._0x5b9d37},_0x11064e=JSON[_0x3581e5(0x1a1)](_0x78875a)+'\x0a',_0x2d5bdc=this[_0x3581e5(0x166)](_0x315fc5);fs_1[_0x3581e5(0x17b)][_0x3581e5(0x184)](_0x2d5bdc,_0x11064e,'utf8');}catch(_0x8f4653){console[_0x3581e5(0x163)](_0x3581e5(0x15c)+_0x315fc5+_0x3581e5(0x188),_0x8f4653);}}[a48_0x50d2f5(0x196)](_0x539420,_0x120a04,_0x23aa91,_0x1886bf){const _0xa6d16a=a48_0x50d2f5;this[_0xa6d16a(0x191)](_0xa6d16a(0x183),{'type':_0xa6d16a(0x167),'gateway':_0x539420,'endpoint':_0x120a04,'method':_0x23aa91,'data':_0x1886bf});}[a48_0x50d2f5(0x198)](_0x51af0b,_0x48a69e,_0x5c9d57,_0x31c0cf,_0x9d750c){const _0x3c6246=a48_0x50d2f5;this['writeLog'](_0x3c6246(0x1a6),{'type':'RESPONSE','gateway':_0x51af0b,'endpoint':_0x48a69e,'status':_0x5c9d57,'responseTime':_0x9d750c,'data':_0x31c0cf});}[a48_0x50d2f5(0x18e)](_0x195616,_0x3e6294,_0x4db862){const _0x172668=a48_0x50d2f5;this[_0x172668(0x191)]('white_domain_errors',{'type':_0x172668(0x16c),'gateway':_0x195616,'endpoint':_0x3e6294,'error':_0x4db862 instanceof Error?{'message':_0x4db862[_0x172668(0x19a)],'stack':_0x4db862[_0x172668(0x1a5)]}:_0x4db862});}[a48_0x50d2f5(0x180)](_0x3d8c78,_0x58e4be,_0x450bdd){const _0x594170=a48_0x50d2f5;this[_0x594170(0x191)](_0x594170(0x161),{'type':_0x594170(0x16e),'gateway':_0x3d8c78,'headers':_0x450bdd,'data':_0x58e4be});}['logWebhookProcessed'](_0x1e37be,_0x3758a5,_0x2b8d3c,_0x1c0498,_0x446f92){this['writeLog']('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x1e37be,'paymentId':_0x3758a5,'oldStatus':_0x2b8d3c,'newStatus':_0x1c0498,'originalData':_0x446f92});}[a48_0x50d2f5(0x18a)](_0x1fa260,_0xbd28e7,_0x71925b){const _0x401eda=a48_0x50d2f5;this[_0x401eda(0x191)](_0x401eda(0x199),{'type':'WEBHOOK_ERROR','gateway':_0x1fa260,'error':_0xbd28e7 instanceof Error?{'message':_0xbd28e7[_0x401eda(0x19a)],'stack':_0xbd28e7[_0x401eda(0x1a5)]}:_0xbd28e7,'originalData':_0x71925b});}[a48_0x50d2f5(0x17f)](_0x1cba8d){const _0x7a3876=a48_0x50d2f5;this[_0x7a3876(0x191)]('cointopay_status_changes',{'type':_0x7a3876(0x15e),..._0x1cba8d});}[a48_0x50d2f5(0x19f)](_0x2fe100){const _0x287837=a48_0x50d2f5;this['writeLog'](_0x287837(0x16f),{'type':_0x287837(0x18c),..._0x2fe100});}[a48_0x50d2f5(0x177)](_0x11533e,_0x2de5cf,_0x5dea64,_0x44af1b,_0x40fd84,_0x598992){const _0x5e25d5=a48_0x50d2f5;this[_0x5e25d5(0x191)]('shop_webhooks_sent',{'type':_0x5e25d5(0x194),'shopId':_0x11533e,'webhookUrl':_0x2de5cf,'event':_0x5dea64,'status':_0x44af1b,'responseTime':_0x40fd84,'payload':_0x598992});}[a48_0x50d2f5(0x18b)](_0x2456e6,_0x110664,_0x5aec26,_0x345b77,_0x37ae8a){const _0x4afe06=a48_0x50d2f5;this[_0x4afe06(0x191)](_0x4afe06(0x164),{'type':_0x4afe06(0x175),'shopId':_0x2456e6,'webhookUrl':_0x110664,'event':_0x5aec26,'error':_0x345b77 instanceof Error?{'message':_0x345b77['message'],'stack':_0x345b77[_0x4afe06(0x1a5)]}:_0x345b77,'payload':_0x37ae8a});}[a48_0x50d2f5(0x176)](_0x497cdd,_0x1c6c41,_0x2ccba3,_0x1cee0e,_0x4048c6){const _0x1fecdf=a48_0x50d2f5;this[_0x1fecdf(0x191)](_0x1fecdf(0x187),{'type':'PAYMENT_CREATED','gateway':_0x497cdd,'paymentId':_0x1c6c41,'shopId':_0x2ccba3,'amount':_0x1cee0e,'currency':_0x4048c6});}[a48_0x50d2f5(0x162)](_0x28ca71,_0x547d4f,_0x4c6734,_0x7aa7d4,_0x3162b3){const _0x1d59ad=a48_0x50d2f5;this[_0x1d59ad(0x191)](_0x1d59ad(0x1a8),{'type':_0x1d59ad(0x19c),'endpoint':_0x28ca71,'method':_0x547d4f,'userId':_0x4c6734,'userRole':_0x7aa7d4,'requestData':_0x3162b3});}[a48_0x50d2f5(0x197)](){const _0x198deb=a48_0x50d2f5;try{const _0x5968b3=fs_1[_0x198deb(0x17b)][_0x198deb(0x179)](this[_0x198deb(0x193)]),_0x60f109=_0x5968b3['filter'](_0x2124f3=>_0x2124f3[_0x198deb(0x17c)]('.log')),_0x4f5660=[...new Set(_0x60f109[_0x198deb(0x1aa)](_0x2e627a=>_0x2e627a['split']('_')[0x0]))],_0x3f6a21=_0x60f109[_0x198deb(0x1aa)](_0x41105c=>{const _0x1f6da3=_0x198deb,_0x4d4c27=path_1[_0x1f6da3(0x17b)][_0x1f6da3(0x18f)](this[_0x1f6da3(0x193)],_0x41105c),_0x18a739=fs_1[_0x1f6da3(0x17b)][_0x1f6da3(0x185)](_0x4d4c27),[_0x416e28,_0x28f98d]=_0x41105c[_0x1f6da3(0x160)](_0x1f6da3(0x19e),'')[_0x1f6da3(0x178)]('_');return{'type':_0x416e28,'date':_0x28f98d,'size':_0x18a739[_0x1f6da3(0x182)]};})[_0x198deb(0x186)]((_0x50a83f,_0x2c37e2)=>_0x2c37e2[_0x198deb(0x1a7)][_0x198deb(0x15d)](_0x50a83f[_0x198deb(0x1a7)]));return{'totalFiles':_0x60f109['length'],'logTypes':_0x4f5660,'latestLogs':_0x3f6a21[_0x198deb(0x189)](0x0,0xa)};}catch(_0x49d723){return console[_0x198deb(0x163)]('Failed\x20to\x20get\x20log\x20stats:',_0x49d723),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x50d2f5(0x16b)](_0x2aaccc=0x1e){const _0x359b55=a48_0x50d2f5;try{const _0x3c0693=fs_1[_0x359b55(0x17b)][_0x359b55(0x179)](this[_0x359b55(0x193)]),_0x311f60=new Date();_0x311f60['setDate'](_0x311f60[_0x359b55(0x172)]()-_0x2aaccc);let _0x226ece=0x0;_0x3c0693['forEach'](_0x29c9c2=>{const _0x2f1bba=_0x359b55;if(!_0x29c9c2['endsWith'](_0x2f1bba(0x19e)))return;const _0x413908=path_1['default'][_0x2f1bba(0x18f)](this[_0x2f1bba(0x193)],_0x29c9c2),_0x465e11=fs_1[_0x2f1bba(0x17b)][_0x2f1bba(0x185)](_0x413908);_0x465e11[_0x2f1bba(0x19d)]<_0x311f60&&(fs_1[_0x2f1bba(0x17b)][_0x2f1bba(0x170)](_0x413908),_0x226ece++,console['log'](_0x2f1bba(0x1a4)+_0x29c9c2));}),console[_0x359b55(0x17a)]('🧹\x20Cleaned\x20'+_0x226ece+_0x359b55(0x16d)+_0x2aaccc+_0x359b55(0x181));}catch(_0x4ce943){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x4ce943);}}}exports[a48_0x50d2f5(0x19b)]=LoggerService,exports['loggerService']=new LoggerService();