'use strict';const a48_0x28ca43=a48_0x36ce;function a48_0x38f1(){const _0xd368bf=['cointopay_errors','logShopWebhookSent','cwd','localeCompare','error','1722198pERhcy','\x20days)','API_CALL','7662VwcrfC','🗑️\x20Deleted\x20old\x20log\x20file:\x20','endsWith','logWhiteDomainError','unlinkSync','logApiCall','PAYMENT_CREATED','.log','default','shop_webhooks_sent','logs','3721448lZQIdt','readdirSync','stack','logWhiteDomainRequest','message','writeLog','getLogStats','api_calls','logsDir','payments_created','\x20old\x20log\x20files\x20(older\x20than\x20','Failed\x20to\x20write\x20','webhooks_processed','LoggerService','slice','4919390zHXgSJ','mkdirSync','forEach','SHOP_WEBHOOK_ERROR','existsSync','mtime','logWebhookError','size','date','toISOString','2rJAgzd','__esModule','ERROR','logShopWebhookError','258923wAusQL','white_domain_requests','2485SYEUMH','5832WZkGbF','shop_webhooks_errors','COINTOPAY_STATUS_CHANGE','map','filter','logWhiteDomainResponse','__importDefault','utf8','statSync','webhooks_received','logWebhookProcessed','cointopay_status_changes','webhooks_errors','split','Failed\x20to\x20clean\x20old\x20logs:','stringify','cleanOldLogs','join','white_domain_responses','RESPONSE','white_domain_errors','logWebhookReceived','📁\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20get\x20log\x20stats:','3963141OHEglQ','WEBHOOK_RECEIVED','🧹\x20Cleaned\x20','ensureLogsDirectory','6488dhXaEA','log','sort','COINTOPAY_ERROR','getLogFileName'];a48_0x38f1=function(){return _0xd368bf;};return a48_0x38f1();}(function(_0xf13819,_0xbb5da6){const _0x4e9872=a48_0x36ce,_0x2c00e3=_0xf13819();while(!![]){try{const _0x5732f3=-parseInt(_0x4e9872(0x1ae))/0x1*(-parseInt(_0x4e9872(0x1aa))/0x2)+-parseInt(_0x4e9872(0x183))/0x3+parseInt(_0x4e9872(0x191))/0x4+-parseInt(_0x4e9872(0x1b0))/0x5*(parseInt(_0x4e9872(0x186))/0x6)+parseInt(_0x4e9872(0x175))/0x7+-parseInt(_0x4e9872(0x179))/0x8*(parseInt(_0x4e9872(0x1b1))/0x9)+parseInt(_0x4e9872(0x1a0))/0xa;if(_0x5732f3===_0xbb5da6)break;else _0x2c00e3['push'](_0x2c00e3['shift']());}catch(_0x3ab28b){_0x2c00e3['push'](_0x2c00e3['shift']());}}}(a48_0x38f1,0x7d464));var __importDefault=this&&this[a48_0x28ca43(0x1b7)]||function(_0x38f97e){const _0x4bd7e8=a48_0x28ca43;return _0x38f97e&&_0x38f97e[_0x4bd7e8(0x1ab)]?_0x38f97e:{'default':_0x38f97e};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a48_0x28ca43(0x19e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));function a48_0x36ce(_0x460424,_0x5e5413){const _0x38f1f7=a48_0x38f1();return a48_0x36ce=function(_0x36ce83,_0x1f9424){_0x36ce83=_0x36ce83-0x172;let _0x1c29ad=_0x38f1f7[_0x36ce83];return _0x1c29ad;},a48_0x36ce(_0x460424,_0x5e5413);}class LoggerService{constructor(){const _0x2b828b=a48_0x28ca43;this[_0x2b828b(0x199)]=path_1[_0x2b828b(0x18e)][_0x2b828b(0x1c2)](process[_0x2b828b(0x180)](),_0x2b828b(0x190)),this[_0x2b828b(0x178)]();}[a48_0x28ca43(0x178)](){const _0x1a7eb7=a48_0x28ca43;!fs_1[_0x1a7eb7(0x18e)][_0x1a7eb7(0x1a4)](this[_0x1a7eb7(0x199)])&&(fs_1[_0x1a7eb7(0x18e)][_0x1a7eb7(0x1a1)](this[_0x1a7eb7(0x199)],{'recursive':!![]}),console[_0x1a7eb7(0x17a)](_0x1a7eb7(0x173)+this[_0x1a7eb7(0x199)]));}[a48_0x28ca43(0x17d)](_0x3b7851){const _0x1590b0=a48_0x28ca43,_0x4634f7=new Date()[_0x1590b0(0x1a9)]()[_0x1590b0(0x1be)]('T')[0x0];return path_1[_0x1590b0(0x18e)]['join'](this['logsDir'],_0x3b7851+'_'+_0x4634f7+'.log');}[a48_0x28ca43(0x196)](_0x1011b1,_0x4494f9){const _0x28a263=a48_0x28ca43;try{const _0x402bd6=new Date()['toISOString'](),_0x435d9a={'timestamp':_0x402bd6,..._0x4494f9},_0x138a83=JSON[_0x28a263(0x1c0)](_0x435d9a)+'\x0a',_0xdd02b8=this[_0x28a263(0x17d)](_0x1011b1);fs_1[_0x28a263(0x18e)]['appendFileSync'](_0xdd02b8,_0x138a83,_0x28a263(0x1b8));}catch(_0x5bb45a){console[_0x28a263(0x182)](_0x28a263(0x19c)+_0x1011b1+'\x20log:',_0x5bb45a);}}[a48_0x28ca43(0x194)](_0x223ee2,_0x415026,_0x166a18,_0x59857b){const _0xfa50bd=a48_0x28ca43;this['writeLog'](_0xfa50bd(0x1af),{'type':'REQUEST','gateway':_0x223ee2,'endpoint':_0x415026,'method':_0x166a18,'data':_0x59857b});}[a48_0x28ca43(0x1b6)](_0x4f6599,_0xdddfa0,_0x24ce74,_0x20f866,_0x2a86e9){const _0x1afe9e=a48_0x28ca43;this['writeLog'](_0x1afe9e(0x1c3),{'type':_0x1afe9e(0x1c4),'gateway':_0x4f6599,'endpoint':_0xdddfa0,'status':_0x24ce74,'responseTime':_0x2a86e9,'data':_0x20f866});}[a48_0x28ca43(0x189)](_0x13d5cf,_0x243f5c,_0xf3e031){const _0x253d15=a48_0x28ca43;this[_0x253d15(0x196)](_0x253d15(0x1c5),{'type':_0x253d15(0x1ac),'gateway':_0x13d5cf,'endpoint':_0x243f5c,'error':_0xf3e031 instanceof Error?{'message':_0xf3e031[_0x253d15(0x195)],'stack':_0xf3e031[_0x253d15(0x193)]}:_0xf3e031});}[a48_0x28ca43(0x172)](_0x5e2543,_0x168073,_0x1bc16b){const _0x1501e7=a48_0x28ca43;this[_0x1501e7(0x196)](_0x1501e7(0x1ba),{'type':_0x1501e7(0x176),'gateway':_0x5e2543,'headers':_0x1bc16b,'data':_0x168073});}[a48_0x28ca43(0x1bb)](_0x56efae,_0x382e3e,_0x53e9f9,_0x4aa74a,_0x5bd31c){const _0x2dea44=a48_0x28ca43;this['writeLog'](_0x2dea44(0x19d),{'type':'WEBHOOK_PROCESSED','gateway':_0x56efae,'paymentId':_0x382e3e,'oldStatus':_0x53e9f9,'newStatus':_0x4aa74a,'originalData':_0x5bd31c});}[a48_0x28ca43(0x1a6)](_0x2a8d85,_0x38324d,_0x51cb66){const _0xe1382b=a48_0x28ca43;this[_0xe1382b(0x196)](_0xe1382b(0x1bd),{'type':'WEBHOOK_ERROR','gateway':_0x2a8d85,'error':_0x38324d instanceof Error?{'message':_0x38324d[_0xe1382b(0x195)],'stack':_0x38324d[_0xe1382b(0x193)]}:_0x38324d,'originalData':_0x51cb66});}['logCoinToPayStatus'](_0x16a343){const _0x1a61d2=a48_0x28ca43;this[_0x1a61d2(0x196)](_0x1a61d2(0x1bc),{'type':_0x1a61d2(0x1b3),..._0x16a343});}['logCoinToPayError'](_0x397ee6){const _0x467cc0=a48_0x28ca43;this['writeLog'](_0x467cc0(0x17e),{'type':_0x467cc0(0x17c),..._0x397ee6});}[a48_0x28ca43(0x17f)](_0x4c45e7,_0x5804e7,_0x7e9fcf,_0x2b76ba,_0x2cb20d,_0x4dfc79){const _0x3a1748=a48_0x28ca43;this['writeLog'](_0x3a1748(0x18f),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x4c45e7,'webhookUrl':_0x5804e7,'event':_0x7e9fcf,'status':_0x2b76ba,'responseTime':_0x2cb20d,'payload':_0x4dfc79});}[a48_0x28ca43(0x1ad)](_0x59ab5a,_0x3ecb55,_0x432a60,_0x19438c,_0x5dbd83){const _0x511119=a48_0x28ca43;this[_0x511119(0x196)](_0x511119(0x1b2),{'type':_0x511119(0x1a3),'shopId':_0x59ab5a,'webhookUrl':_0x3ecb55,'event':_0x432a60,'error':_0x19438c instanceof Error?{'message':_0x19438c[_0x511119(0x195)],'stack':_0x19438c[_0x511119(0x193)]}:_0x19438c,'payload':_0x5dbd83});}['logPaymentCreated'](_0x56285d,_0x4ed071,_0x55108b,_0x3772d2,_0x379643){const _0x42bd98=a48_0x28ca43;this['writeLog'](_0x42bd98(0x19a),{'type':_0x42bd98(0x18c),'gateway':_0x56285d,'paymentId':_0x4ed071,'shopId':_0x55108b,'amount':_0x3772d2,'currency':_0x379643});}[a48_0x28ca43(0x18b)](_0x1ef038,_0x4070f1,_0x48b22a,_0x2c3199,_0x238a94){const _0x1678a2=a48_0x28ca43;this[_0x1678a2(0x196)](_0x1678a2(0x198),{'type':_0x1678a2(0x185),'endpoint':_0x1ef038,'method':_0x4070f1,'userId':_0x48b22a,'userRole':_0x2c3199,'requestData':_0x238a94});}[a48_0x28ca43(0x197)](){const _0x2fae04=a48_0x28ca43;try{const _0x2a7def=fs_1[_0x2fae04(0x18e)][_0x2fae04(0x192)](this['logsDir']),_0x274aaf=_0x2a7def[_0x2fae04(0x1b5)](_0x3a81f4=>_0x3a81f4['endsWith'](_0x2fae04(0x18d))),_0x3f6fa0=[...new Set(_0x274aaf[_0x2fae04(0x1b4)](_0x4e1f5c=>_0x4e1f5c['split']('_')[0x0]))],_0x4d3287=_0x274aaf[_0x2fae04(0x1b4)](_0x41eeb0=>{const _0x29ad50=_0x2fae04,_0x9eead0=path_1[_0x29ad50(0x18e)][_0x29ad50(0x1c2)](this[_0x29ad50(0x199)],_0x41eeb0),_0x439179=fs_1[_0x29ad50(0x18e)][_0x29ad50(0x1b9)](_0x9eead0),[_0x243a4f,_0x36c842]=_0x41eeb0['replace'](_0x29ad50(0x18d),'')[_0x29ad50(0x1be)]('_');return{'type':_0x243a4f,'date':_0x36c842,'size':_0x439179[_0x29ad50(0x1a7)]};})[_0x2fae04(0x17b)]((_0x5001ad,_0x52cde0)=>_0x52cde0['date'][_0x2fae04(0x181)](_0x5001ad[_0x2fae04(0x1a8)]));return{'totalFiles':_0x274aaf['length'],'logTypes':_0x3f6fa0,'latestLogs':_0x4d3287[_0x2fae04(0x19f)](0x0,0xa)};}catch(_0x46fd91){return console[_0x2fae04(0x182)](_0x2fae04(0x174),_0x46fd91),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x28ca43(0x1c1)](_0x317010=0x1e){const _0x4333df=a48_0x28ca43;try{const _0x45fb72=fs_1[_0x4333df(0x18e)]['readdirSync'](this['logsDir']),_0x235118=new Date();_0x235118['setDate'](_0x235118['getDate']()-_0x317010);let _0x9f827b=0x0;_0x45fb72[_0x4333df(0x1a2)](_0x3878cf=>{const _0x433260=_0x4333df;if(!_0x3878cf[_0x433260(0x188)](_0x433260(0x18d)))return;const _0x596c02=path_1[_0x433260(0x18e)][_0x433260(0x1c2)](this[_0x433260(0x199)],_0x3878cf),_0x1265c3=fs_1[_0x433260(0x18e)][_0x433260(0x1b9)](_0x596c02);_0x1265c3[_0x433260(0x1a5)]<_0x235118&&(fs_1[_0x433260(0x18e)][_0x433260(0x18a)](_0x596c02),_0x9f827b++,console[_0x433260(0x17a)](_0x433260(0x187)+_0x3878cf));}),console[_0x4333df(0x17a)](_0x4333df(0x177)+_0x9f827b+_0x4333df(0x19b)+_0x317010+_0x4333df(0x184));}catch(_0x507627){console[_0x4333df(0x182)](_0x4333df(0x1bf),_0x507627);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();