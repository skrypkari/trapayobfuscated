'use strict';const a51_0x540f30=a51_0x3fe1;(function(_0x56ee5d,_0x812e9){const _0x45a2b5=a51_0x3fe1,_0x2db53d=_0x56ee5d();while(!![]){try{const _0x51c3a1=-parseInt(_0x45a2b5(0x17d))/0x1+parseInt(_0x45a2b5(0x1b8))/0x2*(parseInt(_0x45a2b5(0x19f))/0x3)+-parseInt(_0x45a2b5(0x19e))/0x4*(parseInt(_0x45a2b5(0x1c6))/0x5)+parseInt(_0x45a2b5(0x1b5))/0x6+-parseInt(_0x45a2b5(0x1b4))/0x7+-parseInt(_0x45a2b5(0x19c))/0x8+parseInt(_0x45a2b5(0x1a1))/0x9;if(_0x51c3a1===_0x812e9)break;else _0x2db53d['push'](_0x2db53d['shift']());}catch(_0x2423ff){_0x2db53d['push'](_0x2db53d['shift']());}}}(a51_0x39b4,0xbd572));var __importDefault=this&&this[a51_0x540f30(0x1a0)]||function(_0x42c962){return _0x42c962&&_0x42c962['__esModule']?_0x42c962:{'default':_0x42c962};};function a51_0x3fe1(_0x2f2743,_0x921159){const _0x39b41e=a51_0x39b4();return a51_0x3fe1=function(_0x3fe148,_0x1afe1c){_0x3fe148=_0x3fe148-0x178;let _0x37ba1e=_0x39b41e[_0x3fe148];return _0x37ba1e;},a51_0x3fe1(_0x2f2743,_0x921159);}Object[a51_0x540f30(0x194)](exports,'__esModule',{'value':!![]}),exports[a51_0x540f30(0x1a7)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x540f30(0x184)));class LoggerService{constructor(){const _0x1a12e7=a51_0x540f30;this[_0x1a12e7(0x18a)]=path_1[_0x1a12e7(0x1ad)][_0x1a12e7(0x185)](process[_0x1a12e7(0x1bd)](),_0x1a12e7(0x1c3)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x3d6585=a51_0x540f30;!fs_1[_0x3d6585(0x1ad)][_0x3d6585(0x178)](this['logsDir'])&&(fs_1[_0x3d6585(0x1ad)][_0x3d6585(0x1ac)](this[_0x3d6585(0x18a)],{'recursive':!![]}),console[_0x3d6585(0x1c4)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x3d6585(0x18a)]));}[a51_0x540f30(0x19a)](_0x58e63d){const _0x26f63f=a51_0x540f30,_0x4229b4=new Date()[_0x26f63f(0x1bc)]()[_0x26f63f(0x181)]('T')[0x0];return path_1[_0x26f63f(0x1ad)][_0x26f63f(0x185)](this[_0x26f63f(0x18a)],_0x58e63d+'_'+_0x4229b4+'.log');}[a51_0x540f30(0x1a8)](_0x175885,_0xcb33b5){const _0xeca539=a51_0x540f30;try{const _0x5ea79b=new Date()[_0xeca539(0x1bc)](),_0x4b64f8={'timestamp':_0x5ea79b,..._0xcb33b5},_0x523b91=JSON[_0xeca539(0x182)](_0x4b64f8)+'\x0a',_0x51907c=this[_0xeca539(0x19a)](_0x175885);fs_1[_0xeca539(0x1ad)][_0xeca539(0x1aa)](_0x51907c,_0x523b91,_0xeca539(0x197));}catch(_0x5f29d6){console[_0xeca539(0x18b)](_0xeca539(0x183)+_0x175885+_0xeca539(0x179),_0x5f29d6);}}['logWhiteDomainRequest'](_0x2fe5fe,_0xb30ff3,_0x20de2d,_0xd0ae0){const _0x31351b=a51_0x540f30;this[_0x31351b(0x1a8)](_0x31351b(0x19b),{'type':_0x31351b(0x17b),'gateway':_0x2fe5fe,'endpoint':_0xb30ff3,'method':_0x20de2d,'data':_0xd0ae0});}[a51_0x540f30(0x1c0)](_0xbf4629,_0x27e3ce,_0x13cda7,_0xaf2ee7,_0x5f2a39){const _0x5866cc=a51_0x540f30;this[_0x5866cc(0x1a8)](_0x5866cc(0x1be),{'type':_0x5866cc(0x199),'gateway':_0xbf4629,'endpoint':_0x27e3ce,'status':_0x13cda7,'responseTime':_0x5f2a39,'data':_0xaf2ee7});}[a51_0x540f30(0x1b2)](_0x16013b,_0x1a88d7,_0x3d62c4){const _0x268d94=a51_0x540f30;this[_0x268d94(0x1a8)](_0x268d94(0x18c),{'type':_0x268d94(0x1a5),'gateway':_0x16013b,'endpoint':_0x1a88d7,'error':_0x3d62c4 instanceof Error?{'message':_0x3d62c4[_0x268d94(0x1a6)],'stack':_0x3d62c4[_0x268d94(0x1b7)]}:_0x3d62c4});}[a51_0x540f30(0x1a9)](_0x14b1a1,_0x45b7b,_0x2d8547){const _0x54be9a=a51_0x540f30;this[_0x54be9a(0x1a8)]('webhooks_received',{'type':_0x54be9a(0x1ba),'gateway':_0x14b1a1,'headers':_0x2d8547,'data':_0x45b7b});}['logWebhookProcessed'](_0x439e54,_0x1bb604,_0x317f17,_0x194fdc,_0x2a959c){const _0xc7f4b1=a51_0x540f30;this[_0xc7f4b1(0x1a8)](_0xc7f4b1(0x191),{'type':_0xc7f4b1(0x193),'gateway':_0x439e54,'paymentId':_0x1bb604,'oldStatus':_0x317f17,'newStatus':_0x194fdc,'originalData':_0x2a959c});}['logWebhookError'](_0x237dce,_0x2e58a5,_0x2f0121){const _0x560e7a=a51_0x540f30;this['writeLog']('webhooks_errors',{'type':_0x560e7a(0x189),'gateway':_0x237dce,'error':_0x2e58a5 instanceof Error?{'message':_0x2e58a5[_0x560e7a(0x1a6)],'stack':_0x2e58a5[_0x560e7a(0x1b7)]}:_0x2e58a5,'originalData':_0x2f0121});}[a51_0x540f30(0x1a4)](_0x33df4d){const _0x567d73=a51_0x540f30;this[_0x567d73(0x1a8)](_0x567d73(0x187),{'type':_0x567d73(0x1ab),..._0x33df4d});}[a51_0x540f30(0x17e)](_0x4a70a1){const _0x16e658=a51_0x540f30;this['writeLog'](_0x16e658(0x1c7),{'type':'COINTOPAY_ERROR',..._0x4a70a1});}[a51_0x540f30(0x188)](_0x157a60,_0x310a6a,_0xc8fc86,_0x13e982,_0x50fd91,_0x20ab2a){const _0x2dfa52=a51_0x540f30;this[_0x2dfa52(0x1a8)]('shop_webhooks_sent',{'type':_0x2dfa52(0x1c5),'shopId':_0x157a60,'webhookUrl':_0x310a6a,'event':_0xc8fc86,'status':_0x13e982,'responseTime':_0x50fd91,'payload':_0x20ab2a});}[a51_0x540f30(0x1b0)](_0x4f24de,_0x4d47b2,_0x31c072,_0xcd2215,_0x4d0699){const _0x1f9f77=a51_0x540f30;this['writeLog'](_0x1f9f77(0x1c2),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x4f24de,'webhookUrl':_0x4d47b2,'event':_0x31c072,'error':_0xcd2215 instanceof Error?{'message':_0xcd2215[_0x1f9f77(0x1a6)],'stack':_0xcd2215[_0x1f9f77(0x1b7)]}:_0xcd2215,'payload':_0x4d0699});}['logPaymentCreated'](_0x5afc58,_0x3ca2a2,_0x50c5a1,_0x2ba25a,_0x4b6caf){const _0xd3975d=a51_0x540f30;this[_0xd3975d(0x1a8)](_0xd3975d(0x1c9),{'type':_0xd3975d(0x18f),'gateway':_0x5afc58,'paymentId':_0x3ca2a2,'shopId':_0x50c5a1,'amount':_0x2ba25a,'currency':_0x4b6caf});}[a51_0x540f30(0x1b9)](_0xef1d03,_0x2082d5,_0xc8a6c3,_0x5c3bd8,_0x56bdf1){const _0x42ee04=a51_0x540f30;this[_0x42ee04(0x1a8)](_0x42ee04(0x1af),{'type':_0x42ee04(0x198),'endpoint':_0xef1d03,'method':_0x2082d5,'userId':_0xc8a6c3,'userRole':_0x5c3bd8,'requestData':_0x56bdf1});}[a51_0x540f30(0x1bf)](){const _0x5be02a=a51_0x540f30;try{const _0x567bf2=fs_1[_0x5be02a(0x1ad)][_0x5be02a(0x1bb)](this[_0x5be02a(0x18a)]),_0x55df8d=_0x567bf2[_0x5be02a(0x195)](_0x4d4fba=>_0x4d4fba['endsWith']('.log')),_0x274244=[...new Set(_0x55df8d[_0x5be02a(0x19d)](_0x580040=>_0x580040[_0x5be02a(0x181)]('_')[0x0]))],_0x26a7fc=_0x55df8d[_0x5be02a(0x19d)](_0x399a9a=>{const _0x4e98d1=_0x5be02a,_0x354e2f=path_1[_0x4e98d1(0x1ad)][_0x4e98d1(0x185)](this[_0x4e98d1(0x18a)],_0x399a9a),_0x2a0d2e=fs_1['default']['statSync'](_0x354e2f),[_0x470375,_0x2434ca]=_0x399a9a[_0x4e98d1(0x1b6)](_0x4e98d1(0x186),'')['split']('_');return{'type':_0x470375,'date':_0x2434ca,'size':_0x2a0d2e['size']};})[_0x5be02a(0x18d)]((_0x3d20c3,_0x2229dc)=>_0x2229dc[_0x5be02a(0x1b1)]['localeCompare'](_0x3d20c3[_0x5be02a(0x1b1)]));return{'totalFiles':_0x55df8d[_0x5be02a(0x196)],'logTypes':_0x274244,'latestLogs':_0x26a7fc[_0x5be02a(0x17a)](0x0,0xa)};}catch(_0x5a63e9){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x5a63e9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x540f30(0x1b3)](_0x28b005=0x1e){const _0x123d94=a51_0x540f30;try{const _0x3805ae=fs_1[_0x123d94(0x1ad)][_0x123d94(0x1bb)](this[_0x123d94(0x18a)]),_0x55b145=new Date();_0x55b145[_0x123d94(0x17f)](_0x55b145[_0x123d94(0x190)]()-_0x28b005);let _0x535eea=0x0;_0x3805ae[_0x123d94(0x17c)](_0x158f98=>{const _0x5d5698=_0x123d94;if(!_0x158f98[_0x5d5698(0x1a3)](_0x5d5698(0x186)))return;const _0x3689cd=path_1[_0x5d5698(0x1ad)][_0x5d5698(0x185)](this[_0x5d5698(0x18a)],_0x158f98),_0x4adc45=fs_1[_0x5d5698(0x1ad)][_0x5d5698(0x1ae)](_0x3689cd);_0x4adc45[_0x5d5698(0x1a2)]<_0x55b145&&(fs_1[_0x5d5698(0x1ad)][_0x5d5698(0x18e)](_0x3689cd),_0x535eea++,console[_0x5d5698(0x1c4)](_0x5d5698(0x180)+_0x158f98));}),console[_0x123d94(0x1c4)]('🧹\x20Cleaned\x20'+_0x535eea+_0x123d94(0x192)+_0x28b005+_0x123d94(0x1c1));}catch(_0x382ecb){console[_0x123d94(0x18b)]('Failed\x20to\x20clean\x20old\x20logs:',_0x382ecb);}}}exports[a51_0x540f30(0x1c8)]=LoggerService,exports['loggerService']=new LoggerService();function a51_0x39b4(){const _0x4cef43=['writeLog','logWebhookReceived','appendFileSync','COINTOPAY_STATUS_CHANGE','mkdirSync','default','statSync','api_calls','logShopWebhookError','date','logWhiteDomainError','cleanOldLogs','249025FWGnSf','686706XOsUCJ','replace','stack','4FxOXLa','logApiCall','WEBHOOK_RECEIVED','readdirSync','toISOString','cwd','white_domain_responses','getLogStats','logWhiteDomainResponse','\x20days)','shop_webhooks_errors','logs','log','SHOP_WEBHOOK_SENT','1493635LrCvwV','cointopay_errors','LoggerService','payments_created','existsSync','\x20log:','slice','REQUEST','forEach','685139ketVXh','logCoinToPayError','setDate','🗑️\x20Deleted\x20old\x20log\x20file:\x20','split','stringify','Failed\x20to\x20write\x20','path','join','.log','cointopay_status_changes','logShopWebhookSent','WEBHOOK_ERROR','logsDir','error','white_domain_errors','sort','unlinkSync','PAYMENT_CREATED','getDate','webhooks_processed','\x20old\x20log\x20files\x20(older\x20than\x20','WEBHOOK_PROCESSED','defineProperty','filter','length','utf8','API_CALL','RESPONSE','getLogFileName','white_domain_requests','11090496mCJKLA','map','16SbAJMn','238218JOdEDv','__importDefault','34237881cCIumw','mtime','endsWith','logCoinToPayStatus','ERROR','message','loggerService'];a51_0x39b4=function(){return _0x4cef43;};return a51_0x39b4();}