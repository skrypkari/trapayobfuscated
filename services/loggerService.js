'use strict';const a48_0x3e5a11=a48_0x2664;(function(_0x425142,_0x5d826e){const _0x5d507e=a48_0x2664,_0x1768e7=_0x425142();while(!![]){try{const _0x93171c=parseInt(_0x5d507e(0x140))/0x1+-parseInt(_0x5d507e(0x141))/0x2+parseInt(_0x5d507e(0x11f))/0x3*(parseInt(_0x5d507e(0x151))/0x4)+-parseInt(_0x5d507e(0x113))/0x5*(parseInt(_0x5d507e(0x10c))/0x6)+parseInt(_0x5d507e(0x11e))/0x7*(-parseInt(_0x5d507e(0x14b))/0x8)+parseInt(_0x5d507e(0x119))/0x9*(parseInt(_0x5d507e(0x150))/0xa)+-parseInt(_0x5d507e(0x11a))/0xb*(-parseInt(_0x5d507e(0x114))/0xc);if(_0x93171c===_0x5d826e)break;else _0x1768e7['push'](_0x1768e7['shift']());}catch(_0x4ef64b){_0x1768e7['push'](_0x1768e7['shift']());}}}(a48_0x2af0,0xd5109));function a48_0x2664(_0x11b70a,_0x3e1e93){const _0x2af067=a48_0x2af0();return a48_0x2664=function(_0x266469,_0x2f45d7){_0x266469=_0x266469-0x103;let _0x443e77=_0x2af067[_0x266469];return _0x443e77;},a48_0x2664(_0x11b70a,_0x3e1e93);}var __importDefault=this&&this['__importDefault']||function(_0x5c8691){const _0x51aaa5=a48_0x2664;return _0x5c8691&&_0x5c8691[_0x51aaa5(0x14a)]?_0x5c8691:{'default':_0x5c8691};};Object[a48_0x3e5a11(0x10f)](exports,'__esModule',{'value':!![]}),exports[a48_0x3e5a11(0x12c)]=exports[a48_0x3e5a11(0x10d)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x3e5a11(0x12e)));class LoggerService{constructor(){const _0x1c0bce=a48_0x3e5a11;this[_0x1c0bce(0x108)]=path_1[_0x1c0bce(0x13e)]['join'](process[_0x1c0bce(0x106)](),_0x1c0bce(0x143)),this[_0x1c0bce(0x14d)]();}[a48_0x3e5a11(0x14d)](){const _0x1e5ed8=a48_0x3e5a11;!fs_1[_0x1e5ed8(0x13e)][_0x1e5ed8(0x144)](this[_0x1e5ed8(0x108)])&&(fs_1['default'][_0x1e5ed8(0x122)](this[_0x1e5ed8(0x108)],{'recursive':!![]}),console[_0x1e5ed8(0x13f)](_0x1e5ed8(0x139)+this[_0x1e5ed8(0x108)]));}[a48_0x3e5a11(0x138)](_0x3da0d3){const _0x531bb1=a48_0x3e5a11,_0x11beea=new Date()[_0x531bb1(0x110)]()['split']('T')[0x0];return path_1['default']['join'](this[_0x531bb1(0x108)],_0x3da0d3+'_'+_0x11beea+'.log');}['writeLog'](_0x102c66,_0x40491b){const _0x108386=a48_0x3e5a11;try{const _0x49a895=new Date()[_0x108386(0x110)](),_0x3e4443={'timestamp':_0x49a895,..._0x40491b},_0x29ba50=JSON[_0x108386(0x131)](_0x3e4443)+'\x0a',_0x5f1ce4=this[_0x108386(0x138)](_0x102c66);fs_1[_0x108386(0x13e)]['appendFileSync'](_0x5f1ce4,_0x29ba50,'utf8');}catch(_0x24b9e3){console[_0x108386(0x118)](_0x108386(0x13d)+_0x102c66+_0x108386(0x104),_0x24b9e3);}}[a48_0x3e5a11(0x11b)](_0x18fc84,_0x1d8eb0,_0x4768a8,_0x15ce37){const _0x3755db=a48_0x3e5a11;this[_0x3755db(0x12b)](_0x3755db(0x128),{'type':'REQUEST','gateway':_0x18fc84,'endpoint':_0x1d8eb0,'method':_0x4768a8,'data':_0x15ce37});}[a48_0x3e5a11(0x112)](_0x51e6e0,_0x51fdec,_0x13ef68,_0x5dc0dc,_0x4fdcf9){const _0x53d6a4=a48_0x3e5a11;this[_0x53d6a4(0x12b)]('white_domain_responses',{'type':_0x53d6a4(0x116),'gateway':_0x51e6e0,'endpoint':_0x51fdec,'status':_0x13ef68,'responseTime':_0x4fdcf9,'data':_0x5dc0dc});}['logWhiteDomainError'](_0x16f271,_0x146930,_0x84ab7a){const _0x3ac809=a48_0x3e5a11;this[_0x3ac809(0x12b)](_0x3ac809(0x103),{'type':_0x3ac809(0x147),'gateway':_0x16f271,'endpoint':_0x146930,'error':_0x84ab7a instanceof Error?{'message':_0x84ab7a[_0x3ac809(0x10e)],'stack':_0x84ab7a['stack']}:_0x84ab7a});}[a48_0x3e5a11(0x109)](_0x211c2d,_0x39f0da,_0x560887){const _0x32a9f0=a48_0x3e5a11;this[_0x32a9f0(0x12b)](_0x32a9f0(0x149),{'type':'WEBHOOK_RECEIVED','gateway':_0x211c2d,'headers':_0x560887,'data':_0x39f0da});}[a48_0x3e5a11(0x125)](_0x3238f1,_0x3b2497,_0xbb3d34,_0x4679f9,_0x8c4ffb){const _0x49c190=a48_0x3e5a11;this[_0x49c190(0x12b)]('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x3238f1,'paymentId':_0x3b2497,'oldStatus':_0xbb3d34,'newStatus':_0x4679f9,'originalData':_0x8c4ffb});}[a48_0x3e5a11(0x120)](_0xdec804,_0x3aec03,_0x9c4282){const _0x13499c=a48_0x3e5a11;this['writeLog']('webhooks_errors',{'type':_0x13499c(0x115),'gateway':_0xdec804,'error':_0x3aec03 instanceof Error?{'message':_0x3aec03[_0x13499c(0x10e)],'stack':_0x3aec03[_0x13499c(0x14c)]}:_0x3aec03,'originalData':_0x9c4282});}[a48_0x3e5a11(0x133)](_0x248a13){const _0x35693c=a48_0x3e5a11;this[_0x35693c(0x12b)]('cointopay_status_changes',{'type':_0x35693c(0x127),..._0x248a13});}[a48_0x3e5a11(0x132)](_0x1f4d83){const _0x54ca38=a48_0x3e5a11;this['writeLog'](_0x54ca38(0x107),{'type':_0x54ca38(0x137),..._0x1f4d83});}['logShopWebhookSent'](_0x334c8f,_0xecb50d,_0x34b158,_0x3227f8,_0x3d63bc,_0x1f3aec){const _0x117344=a48_0x3e5a11;this[_0x117344(0x12b)](_0x117344(0x14f),{'type':_0x117344(0x130),'shopId':_0x334c8f,'webhookUrl':_0xecb50d,'event':_0x34b158,'status':_0x3227f8,'responseTime':_0x3d63bc,'payload':_0x1f3aec});}['logShopWebhookError'](_0x3f37d7,_0x270a90,_0x5a2eb0,_0x4ce6c5,_0x1b96c4){const _0x1323f7=a48_0x3e5a11;this[_0x1323f7(0x12b)]('shop_webhooks_errors',{'type':_0x1323f7(0x13b),'shopId':_0x3f37d7,'webhookUrl':_0x270a90,'event':_0x5a2eb0,'error':_0x4ce6c5 instanceof Error?{'message':_0x4ce6c5[_0x1323f7(0x10e)],'stack':_0x4ce6c5['stack']}:_0x4ce6c5,'payload':_0x1b96c4});}[a48_0x3e5a11(0x152)](_0x36a9e5,_0x41a94e,_0x1c88db,_0x525028,_0x450345){const _0x1f13ba=a48_0x3e5a11;this[_0x1f13ba(0x12b)](_0x1f13ba(0x129),{'type':_0x1f13ba(0x148),'gateway':_0x36a9e5,'paymentId':_0x41a94e,'shopId':_0x1c88db,'amount':_0x525028,'currency':_0x450345});}[a48_0x3e5a11(0x134)](_0x29f6b,_0x3f6d2b,_0x5bb2f8,_0x549e5d,_0x14c70e){const _0x2263be=a48_0x3e5a11;this[_0x2263be(0x12b)](_0x2263be(0x135),{'type':_0x2263be(0x12f),'endpoint':_0x29f6b,'method':_0x3f6d2b,'userId':_0x5bb2f8,'userRole':_0x549e5d,'requestData':_0x14c70e});}['getLogStats'](){const _0x2c4df4=a48_0x3e5a11;try{const _0x514317=fs_1['default'][_0x2c4df4(0x11d)](this['logsDir']),_0x606a31=_0x514317['filter'](_0x5819b9=>_0x5819b9[_0x2c4df4(0x13a)]('.log')),_0x4045d0=[...new Set(_0x606a31[_0x2c4df4(0x13c)](_0x5a2212=>_0x5a2212[_0x2c4df4(0x142)]('_')[0x0]))],_0x32155e=_0x606a31['map'](_0x372e08=>{const _0x3a6fe6=_0x2c4df4,_0x26b6e3=path_1['default'][_0x3a6fe6(0x10a)](this[_0x3a6fe6(0x108)],_0x372e08),_0x4c84bb=fs_1[_0x3a6fe6(0x13e)][_0x3a6fe6(0x145)](_0x26b6e3),[_0x5070f5,_0x35c65]=_0x372e08[_0x3a6fe6(0x136)]('.log','')['split']('_');return{'type':_0x5070f5,'date':_0x35c65,'size':_0x4c84bb['size']};})[_0x2c4df4(0x10b)]((_0x29d4f0,_0x2a6932)=>_0x2a6932[_0x2c4df4(0x124)]['localeCompare'](_0x29d4f0[_0x2c4df4(0x124)]));return{'totalFiles':_0x606a31['length'],'logTypes':_0x4045d0,'latestLogs':_0x32155e[_0x2c4df4(0x146)](0x0,0xa)};}catch(_0x2a9479){return console['error'](_0x2c4df4(0x123),_0x2a9479),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x3e5a11(0x126)](_0x586da9=0x1e){const _0x2cf90e=a48_0x3e5a11;try{const _0x2aab48=fs_1[_0x2cf90e(0x13e)][_0x2cf90e(0x11d)](this[_0x2cf90e(0x108)]),_0x468fe5=new Date();_0x468fe5[_0x2cf90e(0x11c)](_0x468fe5[_0x2cf90e(0x121)]()-_0x586da9);let _0x3cb8c2=0x0;_0x2aab48[_0x2cf90e(0x12a)](_0x1a9b8f=>{const _0x1e24e9=_0x2cf90e;if(!_0x1a9b8f[_0x1e24e9(0x13a)](_0x1e24e9(0x111)))return;const _0x8e8117=path_1[_0x1e24e9(0x13e)][_0x1e24e9(0x10a)](this[_0x1e24e9(0x108)],_0x1a9b8f),_0x48c206=fs_1[_0x1e24e9(0x13e)]['statSync'](_0x8e8117);_0x48c206[_0x1e24e9(0x12d)]<_0x468fe5&&(fs_1[_0x1e24e9(0x13e)][_0x1e24e9(0x117)](_0x8e8117),_0x3cb8c2++,console[_0x1e24e9(0x13f)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x1a9b8f));}),console[_0x2cf90e(0x13f)](_0x2cf90e(0x14e)+_0x3cb8c2+_0x2cf90e(0x105)+_0x586da9+'\x20days)');}catch(_0xe9ee22){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0xe9ee22);}}}function a48_0x2af0(){const _0x49f1b6=['44lJVtnl','logPaymentCreated','white_domain_errors','\x20log:','\x20old\x20log\x20files\x20(older\x20than\x20','cwd','cointopay_errors','logsDir','logWebhookReceived','join','sort','7366518NqUiEA','LoggerService','message','defineProperty','toISOString','.log','logWhiteDomainResponse','5AFhYmY','3192ZBcIxk','WEBHOOK_ERROR','RESPONSE','unlinkSync','error','306819AzOwVW','13871tAxMbz','logWhiteDomainRequest','setDate','readdirSync','595iHJfks','293595jpQiXR','logWebhookError','getDate','mkdirSync','Failed\x20to\x20get\x20log\x20stats:','date','logWebhookProcessed','cleanOldLogs','COINTOPAY_STATUS_CHANGE','white_domain_requests','payments_created','forEach','writeLog','loggerService','mtime','path','API_CALL','SHOP_WEBHOOK_SENT','stringify','logCoinToPayError','logCoinToPayStatus','logApiCall','api_calls','replace','COINTOPAY_ERROR','getLogFileName','📁\x20Created\x20logs\x20directory:\x20','endsWith','SHOP_WEBHOOK_ERROR','map','Failed\x20to\x20write\x20','default','log','1397726HGmcdu','2429972oNQPtv','split','logs','existsSync','statSync','slice','ERROR','PAYMENT_CREATED','webhooks_received','__esModule','16568UokSRm','stack','ensureLogsDirectory','🧹\x20Cleaned\x20','shop_webhooks_sent','200jxAwmk'];a48_0x2af0=function(){return _0x49f1b6;};return a48_0x2af0();}exports[a48_0x3e5a11(0x10d)]=LoggerService,exports[a48_0x3e5a11(0x12c)]=new LoggerService();