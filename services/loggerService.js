'use strict';const a53_0x4426fb=a53_0x5409;function a53_0x5409(_0x58c684,_0x3087f9){const _0x24cedb=a53_0x24ce();return a53_0x5409=function(_0x54096a,_0x2dcec1){_0x54096a=_0x54096a-0x104;let _0x9be74c=_0x24cedb[_0x54096a];return _0x9be74c;},a53_0x5409(_0x58c684,_0x3087f9);}(function(_0x15d3c5,_0xad880a){const _0x31e970=a53_0x5409,_0x2689fb=_0x15d3c5();while(!![]){try{const _0x3d4a86=parseInt(_0x31e970(0x140))/0x1*(-parseInt(_0x31e970(0x114))/0x2)+parseInt(_0x31e970(0x131))/0x3*(-parseInt(_0x31e970(0x11b))/0x4)+parseInt(_0x31e970(0x125))/0x5+-parseInt(_0x31e970(0x105))/0x6*(-parseInt(_0x31e970(0x108))/0x7)+-parseInt(_0x31e970(0x11a))/0x8*(-parseInt(_0x31e970(0x148))/0x9)+parseInt(_0x31e970(0x12d))/0xa+-parseInt(_0x31e970(0x121))/0xb;if(_0x3d4a86===_0xad880a)break;else _0x2689fb['push'](_0x2689fb['shift']());}catch(_0x4fa902){_0x2689fb['push'](_0x2689fb['shift']());}}}(a53_0x24ce,0xa42f3));var __importDefault=this&&this[a53_0x4426fb(0x106)]||function(_0xa46661){return _0xa46661&&_0xa46661['__esModule']?_0xa46661:{'default':_0xa46661};};Object['defineProperty'](exports,a53_0x4426fb(0x130),{'value':!![]}),exports['loggerService']=exports[a53_0x4426fb(0x10c)]=void 0x0;function a53_0x24ce(){const _0x396942=['WEBHOOK_RECEIVED','.log','logCoinToPayError','PAYMENT_CREATED','3457949YnHmrQ','webhooks_errors','error','cwd','1205265oUbiCg','logApiCall','logShopWebhookSent','size','🗑️\x20Deleted\x20old\x20log\x20file:\x20','WEBHOOK_ERROR','slice','getLogFileName','3845800yGbukk','forEach','filter','__esModule','2269905sAgPFz','logCoinToPayStatus','appendFileSync','default','Failed\x20to\x20get\x20log\x20stats:','writeLog','logWhiteDomainRequest','api_calls','toISOString','API_CALL','logsDir','cointopay_errors','\x20old\x20log\x20files\x20(older\x20than\x20','split','map','1uyHoze','logWebhookReceived','setDate','Failed\x20to\x20write\x20','logWebhookProcessed','join','loggerService','mkdirSync','317691bTbfBS','logShopWebhookError','localeCompare','readdirSync','\x20days)','stringify','shop_webhooks_errors','1686ROJmGG','__importDefault','replace','3696FJvSNj','stack','endsWith','utf8','LoggerService','white_domain_responses','path','\x20log:','cleanOldLogs','getLogStats','statSync','ensureLogsDirectory','531946filKAb','ERROR','webhooks_processed','logWhiteDomainError','🧹\x20Cleaned\x20','log','280qOoJLw','4spaYVz','message'];a53_0x24ce=function(){return _0x396942;};return a53_0x24ce();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x4426fb(0x10e)));class LoggerService{constructor(){const _0x279533=a53_0x4426fb;this[_0x279533(0x13b)]=path_1[_0x279533(0x134)][_0x279533(0x145)](process[_0x279533(0x124)](),'logs'),this[_0x279533(0x113)]();}['ensureLogsDirectory'](){const _0x285536=a53_0x4426fb;!fs_1[_0x285536(0x134)]['existsSync'](this['logsDir'])&&(fs_1[_0x285536(0x134)][_0x285536(0x147)](this[_0x285536(0x13b)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x285536(0x13b)]));}['getLogFileName'](_0x22f774){const _0x4eb8cb=a53_0x4426fb,_0x3bceea=new Date()[_0x4eb8cb(0x139)]()[_0x4eb8cb(0x13e)]('T')[0x0];return path_1['default'][_0x4eb8cb(0x145)](this[_0x4eb8cb(0x13b)],_0x22f774+'_'+_0x3bceea+_0x4eb8cb(0x11e));}['writeLog'](_0x2821d5,_0x3850dd){const _0x4ec65d=a53_0x4426fb;try{const _0x322522=new Date()[_0x4ec65d(0x139)](),_0x296444={'timestamp':_0x322522,..._0x3850dd},_0x5f1761=JSON[_0x4ec65d(0x14d)](_0x296444)+'\x0a',_0x2aef60=this[_0x4ec65d(0x12c)](_0x2821d5);fs_1[_0x4ec65d(0x134)][_0x4ec65d(0x133)](_0x2aef60,_0x5f1761,_0x4ec65d(0x10b));}catch(_0x10a698){console[_0x4ec65d(0x123)](_0x4ec65d(0x143)+_0x2821d5+_0x4ec65d(0x10f),_0x10a698);}}[a53_0x4426fb(0x137)](_0x4be7a9,_0x5d1de2,_0xaeaada,_0x367acd){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0x4be7a9,'endpoint':_0x5d1de2,'method':_0xaeaada,'data':_0x367acd});}['logWhiteDomainResponse'](_0x392387,_0x59c061,_0x3f23ca,_0x2697b9,_0x2d3a50){const _0x588a14=a53_0x4426fb;this['writeLog'](_0x588a14(0x10d),{'type':'RESPONSE','gateway':_0x392387,'endpoint':_0x59c061,'status':_0x3f23ca,'responseTime':_0x2d3a50,'data':_0x2697b9});}[a53_0x4426fb(0x117)](_0x564a80,_0x2c96db,_0x119a35){const _0x1ad086=a53_0x4426fb;this['writeLog']('white_domain_errors',{'type':_0x1ad086(0x115),'gateway':_0x564a80,'endpoint':_0x2c96db,'error':_0x119a35 instanceof Error?{'message':_0x119a35[_0x1ad086(0x11c)],'stack':_0x119a35[_0x1ad086(0x109)]}:_0x119a35});}[a53_0x4426fb(0x141)](_0x4f88ee,_0x2a6d43,_0x9df27c){const _0x5809c5=a53_0x4426fb;this[_0x5809c5(0x136)]('webhooks_received',{'type':_0x5809c5(0x11d),'gateway':_0x4f88ee,'headers':_0x9df27c,'data':_0x2a6d43});}[a53_0x4426fb(0x144)](_0x2348a3,_0x1f106c,_0x5a666a,_0x129716,_0xffe4fc){const _0x5547aa=a53_0x4426fb;this[_0x5547aa(0x136)](_0x5547aa(0x116),{'type':'WEBHOOK_PROCESSED','gateway':_0x2348a3,'paymentId':_0x1f106c,'oldStatus':_0x5a666a,'newStatus':_0x129716,'originalData':_0xffe4fc});}['logWebhookError'](_0x404fe3,_0x5ae00d,_0x3b8955){const _0x4ac22e=a53_0x4426fb;this[_0x4ac22e(0x136)](_0x4ac22e(0x122),{'type':_0x4ac22e(0x12a),'gateway':_0x404fe3,'error':_0x5ae00d instanceof Error?{'message':_0x5ae00d[_0x4ac22e(0x11c)],'stack':_0x5ae00d[_0x4ac22e(0x109)]}:_0x5ae00d,'originalData':_0x3b8955});}[a53_0x4426fb(0x132)](_0x61179f){const _0x42cee0=a53_0x4426fb;this[_0x42cee0(0x136)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x61179f});}[a53_0x4426fb(0x11f)](_0x120cbd){const _0x59db37=a53_0x4426fb;this['writeLog'](_0x59db37(0x13c),{'type':'COINTOPAY_ERROR',..._0x120cbd});}[a53_0x4426fb(0x127)](_0x13e514,_0x46d1e5,_0x4f8f68,_0x1ade6a,_0x4ef6c2,_0x36af2e){const _0x56b9a6=a53_0x4426fb;this[_0x56b9a6(0x136)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x13e514,'webhookUrl':_0x46d1e5,'event':_0x4f8f68,'status':_0x1ade6a,'responseTime':_0x4ef6c2,'payload':_0x36af2e});}[a53_0x4426fb(0x149)](_0x5a34f2,_0x2f50f4,_0x25a7fc,_0x5b6efd,_0x264e2d){const _0x5098ad=a53_0x4426fb;this[_0x5098ad(0x136)](_0x5098ad(0x104),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x5a34f2,'webhookUrl':_0x2f50f4,'event':_0x25a7fc,'error':_0x5b6efd instanceof Error?{'message':_0x5b6efd[_0x5098ad(0x11c)],'stack':_0x5b6efd[_0x5098ad(0x109)]}:_0x5b6efd,'payload':_0x264e2d});}['logPaymentCreated'](_0xbc2831,_0x55e9f8,_0x53399d,_0x519fb3,_0x34813c){const _0x401965=a53_0x4426fb;this[_0x401965(0x136)]('payments_created',{'type':_0x401965(0x120),'gateway':_0xbc2831,'paymentId':_0x55e9f8,'shopId':_0x53399d,'amount':_0x519fb3,'currency':_0x34813c});}[a53_0x4426fb(0x126)](_0x3ba83c,_0x42425c,_0x4c2c3e,_0x26de74,_0x1a7a54){const _0x7443cf=a53_0x4426fb;this[_0x7443cf(0x136)](_0x7443cf(0x138),{'type':_0x7443cf(0x13a),'endpoint':_0x3ba83c,'method':_0x42425c,'userId':_0x4c2c3e,'userRole':_0x26de74,'requestData':_0x1a7a54});}[a53_0x4426fb(0x111)](){const _0x363548=a53_0x4426fb;try{const _0x50128a=fs_1[_0x363548(0x134)][_0x363548(0x14b)](this[_0x363548(0x13b)]),_0x3d3e39=_0x50128a[_0x363548(0x12f)](_0x5b08e0=>_0x5b08e0['endsWith'](_0x363548(0x11e))),_0x5cb25a=[...new Set(_0x3d3e39['map'](_0x30ea7d=>_0x30ea7d[_0x363548(0x13e)]('_')[0x0]))],_0x4700a8=_0x3d3e39[_0x363548(0x13f)](_0x35c053=>{const _0x4f242e=_0x363548,_0x2dcedb=path_1[_0x4f242e(0x134)]['join'](this[_0x4f242e(0x13b)],_0x35c053),_0x478698=fs_1[_0x4f242e(0x134)]['statSync'](_0x2dcedb),[_0x556ace,_0xbbeefc]=_0x35c053[_0x4f242e(0x107)]('.log','')['split']('_');return{'type':_0x556ace,'date':_0xbbeefc,'size':_0x478698[_0x4f242e(0x128)]};})['sort']((_0x137689,_0x59f132)=>_0x59f132['date'][_0x363548(0x14a)](_0x137689['date']));return{'totalFiles':_0x3d3e39['length'],'logTypes':_0x5cb25a,'latestLogs':_0x4700a8[_0x363548(0x12b)](0x0,0xa)};}catch(_0x205f19){return console[_0x363548(0x123)](_0x363548(0x135),_0x205f19),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x4426fb(0x110)](_0x3c6905=0x1e){const _0x306a6d=a53_0x4426fb;try{const _0x23a8cc=fs_1['default'][_0x306a6d(0x14b)](this[_0x306a6d(0x13b)]),_0x36b825=new Date();_0x36b825[_0x306a6d(0x142)](_0x36b825['getDate']()-_0x3c6905);let _0x2bd921=0x0;_0x23a8cc[_0x306a6d(0x12e)](_0x2492db=>{const _0x4bdd74=_0x306a6d;if(!_0x2492db[_0x4bdd74(0x10a)](_0x4bdd74(0x11e)))return;const _0x4281e1=path_1['default'][_0x4bdd74(0x145)](this[_0x4bdd74(0x13b)],_0x2492db),_0x47f780=fs_1[_0x4bdd74(0x134)][_0x4bdd74(0x112)](_0x4281e1);_0x47f780['mtime']<_0x36b825&&(fs_1[_0x4bdd74(0x134)]['unlinkSync'](_0x4281e1),_0x2bd921++,console[_0x4bdd74(0x119)](_0x4bdd74(0x129)+_0x2492db));}),console['log'](_0x306a6d(0x118)+_0x2bd921+_0x306a6d(0x13d)+_0x3c6905+_0x306a6d(0x14c));}catch(_0x58e616){console[_0x306a6d(0x123)]('Failed\x20to\x20clean\x20old\x20logs:',_0x58e616);}}}exports['LoggerService']=LoggerService,exports[a53_0x4426fb(0x146)]=new LoggerService();