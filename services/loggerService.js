'use strict';const a51_0x3ee584=a51_0x5861;(function(_0x33bd4e,_0x29e100){const _0x4331d1=a51_0x5861,_0x4f8994=_0x33bd4e();while(!![]){try{const _0x2afd50=-parseInt(_0x4331d1(0x186))/0x1+-parseInt(_0x4331d1(0x18b))/0x2*(-parseInt(_0x4331d1(0x198))/0x3)+-parseInt(_0x4331d1(0x1cc))/0x4+parseInt(_0x4331d1(0x178))/0x5*(-parseInt(_0x4331d1(0x197))/0x6)+parseInt(_0x4331d1(0x1c6))/0x7+-parseInt(_0x4331d1(0x1a1))/0x8+parseInt(_0x4331d1(0x1c7))/0x9*(parseInt(_0x4331d1(0x1c4))/0xa);if(_0x2afd50===_0x29e100)break;else _0x4f8994['push'](_0x4f8994['shift']());}catch(_0x1ac7f0){_0x4f8994['push'](_0x4f8994['shift']());}}}(a51_0x5083,0x3641e));var __importDefault=this&&this['__importDefault']||function(_0x381921){return _0x381921&&_0x381921['__esModule']?_0x381921:{'default':_0x381921};};Object[a51_0x3ee584(0x179)](exports,a51_0x3ee584(0x1a7),{'value':!![]}),exports[a51_0x3ee584(0x190)]=exports[a51_0x3ee584(0x1b9)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x3ee584(0x1bb)));function a51_0x5861(_0x369cc3,_0x4071fc){const _0x508302=a51_0x5083();return a51_0x5861=function(_0x5861d1,_0x3f5d11){_0x5861d1=_0x5861d1-0x177;let _0x411eef=_0x508302[_0x5861d1];return _0x411eef;},a51_0x5861(_0x369cc3,_0x4071fc);}class LoggerService{constructor(){const _0x20739e=a51_0x3ee584;this[_0x20739e(0x19b)]=path_1[_0x20739e(0x18e)][_0x20739e(0x1c9)](process[_0x20739e(0x1c2)](),_0x20739e(0x195)),this[_0x20739e(0x19e)]();}[a51_0x3ee584(0x19e)](){const _0x44c2f2=a51_0x3ee584;!fs_1['default'][_0x44c2f2(0x185)](this[_0x44c2f2(0x19b)])&&(fs_1[_0x44c2f2(0x18e)][_0x44c2f2(0x194)](this[_0x44c2f2(0x19b)],{'recursive':!![]}),console[_0x44c2f2(0x17b)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x44c2f2(0x19b)]));}['getLogFileName'](_0x5a99d7){const _0x1bcba2=a51_0x3ee584,_0x39feb0=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x1bcba2(0x18e)]['join'](this[_0x1bcba2(0x19b)],_0x5a99d7+'_'+_0x39feb0+_0x1bcba2(0x1be));}[a51_0x3ee584(0x1b2)](_0x5a91b6,_0x4929f0){const _0x5ea546=a51_0x3ee584;try{const _0x13cf22=new Date()[_0x5ea546(0x18d)](),_0x238097={'timestamp':_0x13cf22,..._0x4929f0},_0x446f7b=JSON[_0x5ea546(0x182)](_0x238097)+'\x0a',_0x2a4fc3=this[_0x5ea546(0x1b3)](_0x5a91b6);fs_1[_0x5ea546(0x18e)][_0x5ea546(0x18f)](_0x2a4fc3,_0x446f7b,_0x5ea546(0x17f));}catch(_0x421d37){console[_0x5ea546(0x1b7)]('Failed\x20to\x20write\x20'+_0x5a91b6+_0x5ea546(0x1b6),_0x421d37);}}[a51_0x3ee584(0x1ca)](_0x28482c,_0x5742f3,_0x18319f,_0x50de87){const _0x599b7d=a51_0x3ee584;this[_0x599b7d(0x1b2)](_0x599b7d(0x18a),{'type':_0x599b7d(0x1ac),'gateway':_0x28482c,'endpoint':_0x5742f3,'method':_0x18319f,'data':_0x50de87});}['logWhiteDomainResponse'](_0x19aad1,_0xa8c46e,_0x11f406,_0x3a3818,_0x365516){const _0xbc8252=a51_0x3ee584;this[_0xbc8252(0x1b2)](_0xbc8252(0x1af),{'type':_0xbc8252(0x193),'gateway':_0x19aad1,'endpoint':_0xa8c46e,'status':_0x11f406,'responseTime':_0x365516,'data':_0x3a3818});}['logWhiteDomainError'](_0x50963f,_0x10b97a,_0x3ea12a){const _0x4edbdb=a51_0x3ee584;this[_0x4edbdb(0x1b2)](_0x4edbdb(0x1cb),{'type':_0x4edbdb(0x1bc),'gateway':_0x50963f,'endpoint':_0x10b97a,'error':_0x3ea12a instanceof Error?{'message':_0x3ea12a[_0x4edbdb(0x17d)],'stack':_0x3ea12a[_0x4edbdb(0x19a)]}:_0x3ea12a});}[a51_0x3ee584(0x1ab)](_0x8dfde5,_0x35267a,_0x370984){const _0x3a7e4c=a51_0x3ee584;this[_0x3a7e4c(0x1b2)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x8dfde5,'headers':_0x370984,'data':_0x35267a});}[a51_0x3ee584(0x192)](_0x2188d3,_0xd4b820,_0x388c8b,_0x101770,_0x29566e){const _0x4b19aa=a51_0x3ee584;this['writeLog']('webhooks_processed',{'type':_0x4b19aa(0x188),'gateway':_0x2188d3,'paymentId':_0xd4b820,'oldStatus':_0x388c8b,'newStatus':_0x101770,'originalData':_0x29566e});}[a51_0x3ee584(0x1a3)](_0x17dbfd,_0x31c2c3,_0x1b77bb){const _0x1bbe9f=a51_0x3ee584;this[_0x1bbe9f(0x1b2)](_0x1bbe9f(0x1c0),{'type':_0x1bbe9f(0x19f),'gateway':_0x17dbfd,'error':_0x31c2c3 instanceof Error?{'message':_0x31c2c3[_0x1bbe9f(0x17d)],'stack':_0x31c2c3[_0x1bbe9f(0x19a)]}:_0x31c2c3,'originalData':_0x1b77bb});}[a51_0x3ee584(0x191)](_0x396412){const _0x555152=a51_0x3ee584;this[_0x555152(0x1b2)](_0x555152(0x17c),{'type':_0x555152(0x1c3),..._0x396412});}[a51_0x3ee584(0x1c5)](_0xbd6345){const _0xb12beb=a51_0x3ee584;this[_0xb12beb(0x1b2)](_0xb12beb(0x196),{'type':_0xb12beb(0x19d),..._0xbd6345});}[a51_0x3ee584(0x1a6)](_0x42c3bb,_0x160aa5,_0x437935,_0x34cd55,_0x46c61b,_0x51eabe){const _0x911350=a51_0x3ee584;this[_0x911350(0x1b2)](_0x911350(0x1bf),{'type':_0x911350(0x187),'shopId':_0x42c3bb,'webhookUrl':_0x160aa5,'event':_0x437935,'status':_0x34cd55,'responseTime':_0x46c61b,'payload':_0x51eabe});}[a51_0x3ee584(0x1a4)](_0x12b2ca,_0x866fb3,_0x51a68a,_0x189efc,_0x1f1484){const _0x280551=a51_0x3ee584;this['writeLog'](_0x280551(0x1b4),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x12b2ca,'webhookUrl':_0x866fb3,'event':_0x51a68a,'error':_0x189efc instanceof Error?{'message':_0x189efc['message'],'stack':_0x189efc['stack']}:_0x189efc,'payload':_0x1f1484});}[a51_0x3ee584(0x1b5)](_0x346530,_0x4794ea,_0x233ef9,_0x5913a3,_0x3aae6b){const _0xad567c=a51_0x3ee584;this[_0xad567c(0x1b2)](_0xad567c(0x1a2),{'type':_0xad567c(0x1a5),'gateway':_0x346530,'paymentId':_0x4794ea,'shopId':_0x233ef9,'amount':_0x5913a3,'currency':_0x3aae6b});}[a51_0x3ee584(0x180)](_0x531124,_0x41e595,_0x1d915b,_0x1c4ed5,_0x3ffea0){const _0x1b4340=a51_0x3ee584;this[_0x1b4340(0x1b2)](_0x1b4340(0x189),{'type':'API_CALL','endpoint':_0x531124,'method':_0x41e595,'userId':_0x1d915b,'userRole':_0x1c4ed5,'requestData':_0x3ffea0});}[a51_0x3ee584(0x1aa)](){const _0x6fb88d=a51_0x3ee584;try{const _0x190916=fs_1[_0x6fb88d(0x18e)][_0x6fb88d(0x1b0)](this[_0x6fb88d(0x19b)]),_0x49cd40=_0x190916[_0x6fb88d(0x1c1)](_0x5dde74=>_0x5dde74[_0x6fb88d(0x1c8)]('.log')),_0x5adc39=[...new Set(_0x49cd40[_0x6fb88d(0x177)](_0x24e76a=>_0x24e76a[_0x6fb88d(0x1ba)]('_')[0x0]))],_0x3de514=_0x49cd40['map'](_0x1f1a38=>{const _0x4f9bd6=_0x6fb88d,_0x4d114b=path_1[_0x4f9bd6(0x18e)]['join'](this[_0x4f9bd6(0x19b)],_0x1f1a38),_0x57483f=fs_1[_0x4f9bd6(0x18e)]['statSync'](_0x4d114b),[_0x378310,_0x5a7c7]=_0x1f1a38[_0x4f9bd6(0x183)](_0x4f9bd6(0x1be),'')[_0x4f9bd6(0x1ba)]('_');return{'type':_0x378310,'date':_0x5a7c7,'size':_0x57483f[_0x4f9bd6(0x1a0)]};})[_0x6fb88d(0x1ad)]((_0x50ea64,_0x3ff5ea)=>_0x3ff5ea[_0x6fb88d(0x181)][_0x6fb88d(0x199)](_0x50ea64['date']));return{'totalFiles':_0x49cd40[_0x6fb88d(0x184)],'logTypes':_0x5adc39,'latestLogs':_0x3de514[_0x6fb88d(0x1a8)](0x0,0xa)};}catch(_0x4c5f2b){return console[_0x6fb88d(0x1b7)](_0x6fb88d(0x1ae),_0x4c5f2b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x3ee584(0x1a9)](_0x24c3cc=0x1e){const _0x4393b3=a51_0x3ee584;try{const _0x1085eb=fs_1[_0x4393b3(0x18e)]['readdirSync'](this[_0x4393b3(0x19b)]),_0x5bd8c2=new Date();_0x5bd8c2[_0x4393b3(0x17a)](_0x5bd8c2[_0x4393b3(0x17e)]()-_0x24c3cc);let _0x57385f=0x0;_0x1085eb['forEach'](_0x4b576a=>{const _0x38be2b=_0x4393b3;if(!_0x4b576a[_0x38be2b(0x1c8)](_0x38be2b(0x1be)))return;const _0x42c646=path_1[_0x38be2b(0x18e)][_0x38be2b(0x1c9)](this['logsDir'],_0x4b576a),_0x25b6f2=fs_1[_0x38be2b(0x18e)]['statSync'](_0x42c646);_0x25b6f2[_0x38be2b(0x1b8)]<_0x5bd8c2&&(fs_1['default'][_0x38be2b(0x18c)](_0x42c646),_0x57385f++,console[_0x38be2b(0x17b)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x4b576a));}),console[_0x4393b3(0x17b)](_0x4393b3(0x1b1)+_0x57385f+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x24c3cc+_0x4393b3(0x19c));}catch(_0x1cb968){console[_0x4393b3(0x1b7)](_0x4393b3(0x1bd),_0x1cb968);}}}function a51_0x5083(){const _0x8c8b81=['join','logWhiteDomainRequest','white_domain_errors','1234160JSIDWb','map','12415ugygdT','defineProperty','setDate','log','cointopay_status_changes','message','getDate','utf8','logApiCall','date','stringify','replace','length','existsSync','432062OyknCs','SHOP_WEBHOOK_SENT','WEBHOOK_PROCESSED','api_calls','white_domain_requests','685682gPjrEn','unlinkSync','toISOString','default','appendFileSync','loggerService','logCoinToPayStatus','logWebhookProcessed','RESPONSE','mkdirSync','logs','cointopay_errors','540gnPNhy','3KqzNaB','localeCompare','stack','logsDir','\x20days)','COINTOPAY_ERROR','ensureLogsDirectory','WEBHOOK_ERROR','size','1271816MaTnol','payments_created','logWebhookError','logShopWebhookError','PAYMENT_CREATED','logShopWebhookSent','__esModule','slice','cleanOldLogs','getLogStats','logWebhookReceived','REQUEST','sort','Failed\x20to\x20get\x20log\x20stats:','white_domain_responses','readdirSync','🧹\x20Cleaned\x20','writeLog','getLogFileName','shop_webhooks_errors','logPaymentCreated','\x20log:','error','mtime','LoggerService','split','path','ERROR','Failed\x20to\x20clean\x20old\x20logs:','.log','shop_webhooks_sent','webhooks_errors','filter','cwd','COINTOPAY_STATUS_CHANGE','10sJSUcl','logCoinToPayError','466249BxAFWk','8422551lSMqfM','endsWith'];a51_0x5083=function(){return _0x8c8b81;};return a51_0x5083();}exports[a51_0x3ee584(0x1b9)]=LoggerService,exports[a51_0x3ee584(0x190)]=new LoggerService();