'use strict';const a52_0x31bd8e=a52_0x473b;(function(_0x25cfbe,_0x3d6624){const _0x3ae5b9=a52_0x473b,_0x545f48=_0x25cfbe();while(!![]){try{const _0x1d1d8d=-parseInt(_0x3ae5b9(0x1db))/0x1+-parseInt(_0x3ae5b9(0x1fb))/0x2*(-parseInt(_0x3ae5b9(0x1e7))/0x3)+parseInt(_0x3ae5b9(0x20e))/0x4*(parseInt(_0x3ae5b9(0x1e8))/0x5)+parseInt(_0x3ae5b9(0x21a))/0x6*(-parseInt(_0x3ae5b9(0x1e4))/0x7)+-parseInt(_0x3ae5b9(0x21b))/0x8+parseInt(_0x3ae5b9(0x1ee))/0x9+-parseInt(_0x3ae5b9(0x209))/0xa;if(_0x1d1d8d===_0x3d6624)break;else _0x545f48['push'](_0x545f48['shift']());}catch(_0x5061a6){_0x545f48['push'](_0x545f48['shift']());}}}(a52_0x5577,0x5ee07));function a52_0x473b(_0x526917,_0x53398a){const _0x55776f=a52_0x5577();return a52_0x473b=function(_0x473bca,_0x1045a){_0x473bca=_0x473bca-0x1d7;let _0x418d0f=_0x55776f[_0x473bca];return _0x418d0f;},a52_0x473b(_0x526917,_0x53398a);}var __importDefault=this&&this[a52_0x31bd8e(0x1ef)]||function(_0x4ba073){return _0x4ba073&&_0x4ba073['__esModule']?_0x4ba073:{'default':_0x4ba073};};Object[a52_0x31bd8e(0x1ea)](exports,'__esModule',{'value':!![]}),exports[a52_0x31bd8e(0x213)]=exports[a52_0x31bd8e(0x220)]=void 0x0;function a52_0x5577(){const _0x817221=['LoggerService','logsDir','logs','stringify','mtime','slice','payments_created','endsWith','stack','readdirSync','ERROR','552463wTlynF','date','map','webhooks_processed','path','white_domain_responses','WEBHOOK_ERROR','join','error','7952RpINTE','default','🗑️\x20Deleted\x20old\x20log\x20file:\x20','3894MpSVCl','3779245djscSl','logShopWebhookSent','defineProperty','ensureLogsDirectory','.log','Failed\x20to\x20get\x20log\x20stats:','3643272wYsxLn','__importDefault','log','🧹\x20Cleaned\x20','length','statSync','toISOString','setDate','api_calls','REQUEST','getDate','webhooks_received','existsSync','974IzIyqf','API_CALL','COINTOPAY_ERROR','Failed\x20to\x20write\x20','replace','white_domain_errors','cleanOldLogs','SHOP_WEBHOOK_ERROR','cointopay_status_changes','sort','message','logCoinToPayError','cwd','split','5873340yJXPuC','logWhiteDomainResponse','PAYMENT_CREATED','getLogFileName','WEBHOOK_RECEIVED','4xCYYxH','white_domain_requests','writeLog','mkdirSync','getLogStats','loggerService','logWebhookProcessed','logWhiteDomainRequest','appendFileSync','filter','logCoinToPayStatus','SHOP_WEBHOOK_SENT','384TlbvSl','1533336lKCeHP','WEBHOOK_PROCESSED','forEach','logWebhookReceived','📁\x20Created\x20logs\x20directory:\x20'];a52_0x5577=function(){return _0x817221;};return a52_0x5577();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a52_0x31bd8e(0x1df)));class LoggerService{constructor(){const _0x2c2e23=a52_0x31bd8e;this[_0x2c2e23(0x221)]=path_1[_0x2c2e23(0x1e5)][_0x2c2e23(0x1e2)](process[_0x2c2e23(0x207)](),_0x2c2e23(0x222)),this['ensureLogsDirectory']();}[a52_0x31bd8e(0x1eb)](){const _0x2cca54=a52_0x31bd8e;!fs_1[_0x2cca54(0x1e5)][_0x2cca54(0x1fa)](this[_0x2cca54(0x221)])&&(fs_1['default'][_0x2cca54(0x211)](this[_0x2cca54(0x221)],{'recursive':!![]}),console[_0x2cca54(0x1f0)](_0x2cca54(0x21f)+this[_0x2cca54(0x221)]));}[a52_0x31bd8e(0x20c)](_0x5bbb88){const _0x27db03=a52_0x31bd8e,_0x17ddb5=new Date()[_0x27db03(0x1f4)]()['split']('T')[0x0];return path_1['default'][_0x27db03(0x1e2)](this['logsDir'],_0x5bbb88+'_'+_0x17ddb5+_0x27db03(0x1ec));}[a52_0x31bd8e(0x210)](_0x62c65e,_0x250d75){const _0x2d23f6=a52_0x31bd8e;try{const _0x217ace=new Date()['toISOString'](),_0x1815af={'timestamp':_0x217ace,..._0x250d75},_0x547e97=JSON[_0x2d23f6(0x223)](_0x1815af)+'\x0a',_0x5a62bc=this[_0x2d23f6(0x20c)](_0x62c65e);fs_1[_0x2d23f6(0x1e5)][_0x2d23f6(0x216)](_0x5a62bc,_0x547e97,'utf8');}catch(_0xe4d46c){console['error'](_0x2d23f6(0x1fe)+_0x62c65e+'\x20log:',_0xe4d46c);}}[a52_0x31bd8e(0x215)](_0x16f9df,_0x2589de,_0x2c0db,_0x25d440){const _0x1863f6=a52_0x31bd8e;this['writeLog'](_0x1863f6(0x20f),{'type':_0x1863f6(0x1f7),'gateway':_0x16f9df,'endpoint':_0x2589de,'method':_0x2c0db,'data':_0x25d440});}[a52_0x31bd8e(0x20a)](_0x3a957b,_0x185c1e,_0x4b6c7c,_0x21937a,_0x3b01d9){const _0x4919d2=a52_0x31bd8e;this[_0x4919d2(0x210)](_0x4919d2(0x1e0),{'type':'RESPONSE','gateway':_0x3a957b,'endpoint':_0x185c1e,'status':_0x4b6c7c,'responseTime':_0x3b01d9,'data':_0x21937a});}['logWhiteDomainError'](_0x42efa7,_0x1abcb6,_0x2bead7){const _0x8b8078=a52_0x31bd8e;this[_0x8b8078(0x210)](_0x8b8078(0x200),{'type':_0x8b8078(0x1da),'gateway':_0x42efa7,'endpoint':_0x1abcb6,'error':_0x2bead7 instanceof Error?{'message':_0x2bead7[_0x8b8078(0x205)],'stack':_0x2bead7[_0x8b8078(0x1d8)]}:_0x2bead7});}[a52_0x31bd8e(0x21e)](_0x5590e0,_0x507851,_0x5370b2){const _0x216f91=a52_0x31bd8e;this[_0x216f91(0x210)](_0x216f91(0x1f9),{'type':_0x216f91(0x20d),'gateway':_0x5590e0,'headers':_0x5370b2,'data':_0x507851});}[a52_0x31bd8e(0x214)](_0x395097,_0x551bbc,_0xbf47eb,_0x27a351,_0x12db3c){const _0x571135=a52_0x31bd8e;this[_0x571135(0x210)](_0x571135(0x1de),{'type':_0x571135(0x21c),'gateway':_0x395097,'paymentId':_0x551bbc,'oldStatus':_0xbf47eb,'newStatus':_0x27a351,'originalData':_0x12db3c});}['logWebhookError'](_0x28195f,_0x5cd068,_0xc661d1){const _0x301a50=a52_0x31bd8e;this[_0x301a50(0x210)]('webhooks_errors',{'type':_0x301a50(0x1e1),'gateway':_0x28195f,'error':_0x5cd068 instanceof Error?{'message':_0x5cd068['message'],'stack':_0x5cd068[_0x301a50(0x1d8)]}:_0x5cd068,'originalData':_0xc661d1});}[a52_0x31bd8e(0x218)](_0x3f8a94){const _0x63d8e5=a52_0x31bd8e;this[_0x63d8e5(0x210)](_0x63d8e5(0x203),{'type':'COINTOPAY_STATUS_CHANGE',..._0x3f8a94});}[a52_0x31bd8e(0x206)](_0x284773){const _0x45a958=a52_0x31bd8e;this[_0x45a958(0x210)]('cointopay_errors',{'type':_0x45a958(0x1fd),..._0x284773});}[a52_0x31bd8e(0x1e9)](_0x338fe3,_0x81bb6,_0x3338da,_0xf38a7e,_0x452391,_0x18d00e){const _0x4376b8=a52_0x31bd8e;this[_0x4376b8(0x210)]('shop_webhooks_sent',{'type':_0x4376b8(0x219),'shopId':_0x338fe3,'webhookUrl':_0x81bb6,'event':_0x3338da,'status':_0xf38a7e,'responseTime':_0x452391,'payload':_0x18d00e});}['logShopWebhookError'](_0x37969f,_0x445679,_0x5657ef,_0x28128b,_0x6906c8){const _0x429377=a52_0x31bd8e;this['writeLog']('shop_webhooks_errors',{'type':_0x429377(0x202),'shopId':_0x37969f,'webhookUrl':_0x445679,'event':_0x5657ef,'error':_0x28128b instanceof Error?{'message':_0x28128b['message'],'stack':_0x28128b['stack']}:_0x28128b,'payload':_0x6906c8});}['logPaymentCreated'](_0xd9a6a4,_0x2de881,_0x2fd005,_0x441af1,_0x459cdd){const _0x5cbf16=a52_0x31bd8e;this[_0x5cbf16(0x210)](_0x5cbf16(0x226),{'type':_0x5cbf16(0x20b),'gateway':_0xd9a6a4,'paymentId':_0x2de881,'shopId':_0x2fd005,'amount':_0x441af1,'currency':_0x459cdd});}['logApiCall'](_0x2faeb7,_0x190cae,_0x223287,_0x1cecf5,_0x5fbdc5){const _0x57b763=a52_0x31bd8e;this[_0x57b763(0x210)](_0x57b763(0x1f6),{'type':_0x57b763(0x1fc),'endpoint':_0x2faeb7,'method':_0x190cae,'userId':_0x223287,'userRole':_0x1cecf5,'requestData':_0x5fbdc5});}[a52_0x31bd8e(0x212)](){const _0x5cd36c=a52_0x31bd8e;try{const _0x12ccd6=fs_1[_0x5cd36c(0x1e5)][_0x5cd36c(0x1d9)](this[_0x5cd36c(0x221)]),_0x4d73b3=_0x12ccd6[_0x5cd36c(0x217)](_0x253638=>_0x253638[_0x5cd36c(0x1d7)](_0x5cd36c(0x1ec))),_0x17ad03=[...new Set(_0x4d73b3[_0x5cd36c(0x1dd)](_0x6512cf=>_0x6512cf[_0x5cd36c(0x208)]('_')[0x0]))],_0xc71af2=_0x4d73b3['map'](_0x51b1dc=>{const _0x46c8b7=_0x5cd36c,_0x4fddc8=path_1[_0x46c8b7(0x1e5)][_0x46c8b7(0x1e2)](this[_0x46c8b7(0x221)],_0x51b1dc),_0x20c58e=fs_1[_0x46c8b7(0x1e5)][_0x46c8b7(0x1f3)](_0x4fddc8),[_0x34d5a1,_0x252a4a]=_0x51b1dc[_0x46c8b7(0x1ff)](_0x46c8b7(0x1ec),'')[_0x46c8b7(0x208)]('_');return{'type':_0x34d5a1,'date':_0x252a4a,'size':_0x20c58e['size']};})[_0x5cd36c(0x204)]((_0x3a0591,_0x42f400)=>_0x42f400['date']['localeCompare'](_0x3a0591[_0x5cd36c(0x1dc)]));return{'totalFiles':_0x4d73b3[_0x5cd36c(0x1f2)],'logTypes':_0x17ad03,'latestLogs':_0xc71af2[_0x5cd36c(0x225)](0x0,0xa)};}catch(_0x3d638e){return console['error'](_0x5cd36c(0x1ed),_0x3d638e),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a52_0x31bd8e(0x201)](_0x283d83=0x1e){const _0x23e16b=a52_0x31bd8e;try{const _0x34a0c1=fs_1[_0x23e16b(0x1e5)][_0x23e16b(0x1d9)](this[_0x23e16b(0x221)]),_0x123716=new Date();_0x123716[_0x23e16b(0x1f5)](_0x123716[_0x23e16b(0x1f8)]()-_0x283d83);let _0x39dec8=0x0;_0x34a0c1[_0x23e16b(0x21d)](_0xfcb587=>{const _0x38bed2=_0x23e16b;if(!_0xfcb587['endsWith'](_0x38bed2(0x1ec)))return;const _0x424f7d=path_1['default'][_0x38bed2(0x1e2)](this['logsDir'],_0xfcb587),_0x1266ab=fs_1['default'][_0x38bed2(0x1f3)](_0x424f7d);_0x1266ab[_0x38bed2(0x224)]<_0x123716&&(fs_1['default']['unlinkSync'](_0x424f7d),_0x39dec8++,console[_0x38bed2(0x1f0)](_0x38bed2(0x1e6)+_0xfcb587));}),console['log'](_0x23e16b(0x1f1)+_0x39dec8+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x283d83+'\x20days)');}catch(_0x5f0022){console[_0x23e16b(0x1e3)]('Failed\x20to\x20clean\x20old\x20logs:',_0x5f0022);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();