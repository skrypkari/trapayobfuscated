'use strict';const a44_0x1dd497=a44_0x1ea0;(function(_0x1cdad8,_0x513d42){const _0x143261=a44_0x1ea0,_0x3e4e94=_0x1cdad8();while(!![]){try{const _0x2fbbbe=parseInt(_0x143261(0x164))/0x1+-parseInt(_0x143261(0x17c))/0x2*(-parseInt(_0x143261(0x156))/0x3)+-parseInt(_0x143261(0x16d))/0x4+-parseInt(_0x143261(0x15c))/0x5*(-parseInt(_0x143261(0x167))/0x6)+-parseInt(_0x143261(0x169))/0x7*(parseInt(_0x143261(0x171))/0x8)+-parseInt(_0x143261(0x19b))/0x9*(parseInt(_0x143261(0x191))/0xa)+-parseInt(_0x143261(0x19d))/0xb*(-parseInt(_0x143261(0x166))/0xc);if(_0x2fbbbe===_0x513d42)break;else _0x3e4e94['push'](_0x3e4e94['shift']());}catch(_0x15caf9){_0x3e4e94['push'](_0x3e4e94['shift']());}}}(a44_0x34c5,0x4d573));function a44_0x34c5(){const _0x12ef0b=['shop_webhooks_errors','existsSync','WEBHOOK_PROCESSED','stack','3LuOOMa','message','\x20old\x20log\x20files\x20(older\x20than\x20','webhooks_errors','SHOP_WEBHOOK_ERROR','logShopWebhookError','30LtnQVW','getLogStats','LoggerService','map','white_domain_responses','sort','SHOP_WEBHOOK_SENT','join','573086PqnwFe','slice','60YgdLQY','518040bMIwRE','Failed\x20to\x20get\x20log\x20stats:','189RLySOz','COINTOPAY_ERROR','localeCompare','RESPONSE','203956ssUgja','\x20days)','Failed\x20to\x20write\x20','WEBHOOK_ERROR','178128pFANNu','ensureLogsDirectory','\x20log:','logApiCall','WEBHOOK_RECEIVED','cleanOldLogs','logWebhookError','logWhiteDomainError','date','white_domain_requests','logPaymentCreated','37010SqoEVW','log','logWebhookProcessed','COINTOPAY_STATUS_CHANGE','split','.log','getDate','length','appendFileSync','path','logWhiteDomainRequest','mkdirSync','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','ðŸ§¹\x20Cleaned\x20','ðŸ“\x20Created\x20logs\x20directory:\x20','writeLog','readdirSync','replace','logShopWebhookSent','default','logs','437770UYSnFn','mtime','defineProperty','filter','PAYMENT_CREATED','logsDir','api_calls','forEach','shop_webhooks_sent','getLogFileName','36MsgrmD','logCoinToPayStatus','75757eUbunJ','loggerService','logCoinToPayError','__importDefault','endsWith','toISOString','setDate'];a44_0x34c5=function(){return _0x12ef0b;};return a44_0x34c5();}function a44_0x1ea0(_0x3d08b7,_0x920aa7){const _0x34c533=a44_0x34c5();return a44_0x1ea0=function(_0x1ea0c7,_0x2b4f9d){_0x1ea0c7=_0x1ea0c7-0x152;let _0xa9f0f8=_0x34c533[_0x1ea0c7];return _0xa9f0f8;},a44_0x1ea0(_0x3d08b7,_0x920aa7);}var __importDefault=this&&this[a44_0x1dd497(0x1a0)]||function(_0x27346a){return _0x27346a&&_0x27346a['__esModule']?_0x27346a:{'default':_0x27346a};};Object[a44_0x1dd497(0x193)](exports,'__esModule',{'value':!![]}),exports[a44_0x1dd497(0x19e)]=exports[a44_0x1dd497(0x15e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a44_0x1dd497(0x185)));class LoggerService{constructor(){const _0x5b9902=a44_0x1dd497;this[_0x5b9902(0x196)]=path_1[_0x5b9902(0x18f)][_0x5b9902(0x163)](process['cwd'](),_0x5b9902(0x190)),this[_0x5b9902(0x172)]();}[a44_0x1dd497(0x172)](){const _0xcbb3b6=a44_0x1dd497;!fs_1[_0xcbb3b6(0x18f)][_0xcbb3b6(0x153)](this[_0xcbb3b6(0x196)])&&(fs_1[_0xcbb3b6(0x18f)][_0xcbb3b6(0x187)](this[_0xcbb3b6(0x196)],{'recursive':!![]}),console['log'](_0xcbb3b6(0x18a)+this[_0xcbb3b6(0x196)]));}[a44_0x1dd497(0x19a)](_0x525820){const _0x214faf=a44_0x1dd497,_0x26bc2d=new Date()[_0x214faf(0x1a2)]()[_0x214faf(0x180)]('T')[0x0];return path_1[_0x214faf(0x18f)]['join'](this['logsDir'],_0x525820+'_'+_0x26bc2d+_0x214faf(0x181));}[a44_0x1dd497(0x18b)](_0x2c6e30,_0xeab108){const _0xf3fd83=a44_0x1dd497;try{const _0x2dae5e=new Date()[_0xf3fd83(0x1a2)](),_0x1047b7={'timestamp':_0x2dae5e,..._0xeab108},_0x32e23c=JSON['stringify'](_0x1047b7)+'\x0a',_0x1f5557=this[_0xf3fd83(0x19a)](_0x2c6e30);fs_1[_0xf3fd83(0x18f)][_0xf3fd83(0x184)](_0x1f5557,_0x32e23c,'utf8');}catch(_0x23a01e){console['error'](_0xf3fd83(0x16f)+_0x2c6e30+_0xf3fd83(0x173),_0x23a01e);}}[a44_0x1dd497(0x186)](_0x279063,_0x20ad6b,_0x49dd5e,_0x41fad7){const _0x254898=a44_0x1dd497;this[_0x254898(0x18b)](_0x254898(0x17a),{'type':'REQUEST','gateway':_0x279063,'endpoint':_0x20ad6b,'method':_0x49dd5e,'data':_0x41fad7});}['logWhiteDomainResponse'](_0x44c7e6,_0x3c46e1,_0x28305b,_0xd20828,_0x141331){const _0x1e892f=a44_0x1dd497;this[_0x1e892f(0x18b)](_0x1e892f(0x160),{'type':_0x1e892f(0x16c),'gateway':_0x44c7e6,'endpoint':_0x3c46e1,'status':_0x28305b,'responseTime':_0x141331,'data':_0xd20828});}[a44_0x1dd497(0x178)](_0x32e88b,_0x15520a,_0x168633){const _0xfbd293=a44_0x1dd497;this[_0xfbd293(0x18b)]('white_domain_errors',{'type':'ERROR','gateway':_0x32e88b,'endpoint':_0x15520a,'error':_0x168633 instanceof Error?{'message':_0x168633[_0xfbd293(0x157)],'stack':_0x168633[_0xfbd293(0x155)]}:_0x168633});}['logWebhookReceived'](_0x57d5ce,_0xc1f66a,_0x58a6de){const _0x41ebbb=a44_0x1dd497;this[_0x41ebbb(0x18b)]('webhooks_received',{'type':_0x41ebbb(0x175),'gateway':_0x57d5ce,'headers':_0x58a6de,'data':_0xc1f66a});}[a44_0x1dd497(0x17e)](_0x80fc9b,_0x45f430,_0x29386d,_0xacfa01,_0x2e2202){const _0x27eb86=a44_0x1dd497;this[_0x27eb86(0x18b)]('webhooks_processed',{'type':_0x27eb86(0x154),'gateway':_0x80fc9b,'paymentId':_0x45f430,'oldStatus':_0x29386d,'newStatus':_0xacfa01,'originalData':_0x2e2202});}[a44_0x1dd497(0x177)](_0x4f231c,_0x289be2,_0xec4832){const _0x5e7e13=a44_0x1dd497;this['writeLog'](_0x5e7e13(0x159),{'type':_0x5e7e13(0x170),'gateway':_0x4f231c,'error':_0x289be2 instanceof Error?{'message':_0x289be2['message'],'stack':_0x289be2[_0x5e7e13(0x155)]}:_0x289be2,'originalData':_0xec4832});}[a44_0x1dd497(0x19c)](_0x27bf64){const _0x1acb71=a44_0x1dd497;this['writeLog']('cointopay_status_changes',{'type':_0x1acb71(0x17f),..._0x27bf64});}[a44_0x1dd497(0x19f)](_0x858950){const _0x980bb5=a44_0x1dd497;this[_0x980bb5(0x18b)]('cointopay_errors',{'type':_0x980bb5(0x16a),..._0x858950});}[a44_0x1dd497(0x18e)](_0x4518e8,_0x5aabab,_0x4cffdf,_0x28303e,_0x563f1e,_0x28998a){const _0x31c0ce=a44_0x1dd497;this[_0x31c0ce(0x18b)](_0x31c0ce(0x199),{'type':_0x31c0ce(0x162),'shopId':_0x4518e8,'webhookUrl':_0x5aabab,'event':_0x4cffdf,'status':_0x28303e,'responseTime':_0x563f1e,'payload':_0x28998a});}[a44_0x1dd497(0x15b)](_0x52f9a8,_0x524255,_0x5113e5,_0x108da6,_0x3ba8ef){const _0x465aaa=a44_0x1dd497;this['writeLog'](_0x465aaa(0x152),{'type':_0x465aaa(0x15a),'shopId':_0x52f9a8,'webhookUrl':_0x524255,'event':_0x5113e5,'error':_0x108da6 instanceof Error?{'message':_0x108da6[_0x465aaa(0x157)],'stack':_0x108da6['stack']}:_0x108da6,'payload':_0x3ba8ef});}[a44_0x1dd497(0x17b)](_0xfd7fbc,_0x1df161,_0x149cb6,_0x34f40d,_0x5ea3e1){const _0x1a263c=a44_0x1dd497;this[_0x1a263c(0x18b)]('payments_created',{'type':_0x1a263c(0x195),'gateway':_0xfd7fbc,'paymentId':_0x1df161,'shopId':_0x149cb6,'amount':_0x34f40d,'currency':_0x5ea3e1});}[a44_0x1dd497(0x174)](_0x1ff2db,_0x553a69,_0x2c0981,_0x6f51fa,_0x2fd91b){const _0xe57b04=a44_0x1dd497;this[_0xe57b04(0x18b)](_0xe57b04(0x197),{'type':'API_CALL','endpoint':_0x1ff2db,'method':_0x553a69,'userId':_0x2c0981,'userRole':_0x6f51fa,'requestData':_0x2fd91b});}[a44_0x1dd497(0x15d)](){const _0x92224c=a44_0x1dd497;try{const _0x1ebde8=fs_1[_0x92224c(0x18f)][_0x92224c(0x18c)](this['logsDir']),_0x43c286=_0x1ebde8[_0x92224c(0x194)](_0x5dff64=>_0x5dff64[_0x92224c(0x1a1)]('.log')),_0x4c4de8=[...new Set(_0x43c286['map'](_0x1b83c6=>_0x1b83c6[_0x92224c(0x180)]('_')[0x0]))],_0x4fe476=_0x43c286[_0x92224c(0x15f)](_0x2f7a63=>{const _0x4bc526=_0x92224c,_0x3151d1=path_1[_0x4bc526(0x18f)][_0x4bc526(0x163)](this[_0x4bc526(0x196)],_0x2f7a63),_0x3b8fa3=fs_1['default']['statSync'](_0x3151d1),[_0x530bd8,_0x5d06cd]=_0x2f7a63[_0x4bc526(0x18d)](_0x4bc526(0x181),'')[_0x4bc526(0x180)]('_');return{'type':_0x530bd8,'date':_0x5d06cd,'size':_0x3b8fa3['size']};})[_0x92224c(0x161)]((_0x3e6b6e,_0x5c928a)=>_0x5c928a[_0x92224c(0x179)][_0x92224c(0x16b)](_0x3e6b6e[_0x92224c(0x179)]));return{'totalFiles':_0x43c286[_0x92224c(0x183)],'logTypes':_0x4c4de8,'latestLogs':_0x4fe476[_0x92224c(0x165)](0x0,0xa)};}catch(_0x408a8d){return console['error'](_0x92224c(0x168),_0x408a8d),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a44_0x1dd497(0x176)](_0x5054b2=0x1e){const _0x3eab39=a44_0x1dd497;try{const _0x2ed2c6=fs_1['default'][_0x3eab39(0x18c)](this[_0x3eab39(0x196)]),_0x507597=new Date();_0x507597[_0x3eab39(0x1a3)](_0x507597[_0x3eab39(0x182)]()-_0x5054b2);let _0x20c5ac=0x0;_0x2ed2c6[_0x3eab39(0x198)](_0x45c414=>{const _0x497203=_0x3eab39;if(!_0x45c414[_0x497203(0x1a1)]('.log'))return;const _0x34be67=path_1[_0x497203(0x18f)][_0x497203(0x163)](this[_0x497203(0x196)],_0x45c414),_0x4cb6a8=fs_1['default']['statSync'](_0x34be67);_0x4cb6a8[_0x497203(0x192)]<_0x507597&&(fs_1[_0x497203(0x18f)]['unlinkSync'](_0x34be67),_0x20c5ac++,console['log'](_0x497203(0x188)+_0x45c414));}),console[_0x3eab39(0x17d)](_0x3eab39(0x189)+_0x20c5ac+_0x3eab39(0x158)+_0x5054b2+_0x3eab39(0x16e));}catch(_0x515cde){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x515cde);}}}exports['LoggerService']=LoggerService,exports[a44_0x1dd497(0x19e)]=new LoggerService();