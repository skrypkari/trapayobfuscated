'use strict';const a51_0x10721e=a51_0x5837;(function(_0x4047c0,_0x16bdc9){const _0x4594a6=a51_0x5837,_0x4189bb=_0x4047c0();while(!![]){try{const _0x22dcf5=parseInt(_0x4594a6(0x12a))/0x1+-parseInt(_0x4594a6(0x141))/0x2+parseInt(_0x4594a6(0x127))/0x3+-parseInt(_0x4594a6(0x11c))/0x4*(parseInt(_0x4594a6(0x12c))/0x5)+parseInt(_0x4594a6(0x148))/0x6+parseInt(_0x4594a6(0x138))/0x7+-parseInt(_0x4594a6(0x130))/0x8;if(_0x22dcf5===_0x16bdc9)break;else _0x4189bb['push'](_0x4189bb['shift']());}catch(_0x501135){_0x4189bb['push'](_0x4189bb['shift']());}}}(a51_0x210e,0xb275b));function a51_0x5837(_0x52d19e,_0x229ea7){const _0x210efb=a51_0x210e();return a51_0x5837=function(_0x5837bc,_0x128c0d){_0x5837bc=_0x5837bc-0x114;let _0x4c7980=_0x210efb[_0x5837bc];return _0x4c7980;},a51_0x5837(_0x52d19e,_0x229ea7);}var __importDefault=this&&this[a51_0x10721e(0x134)]||function(_0x1c9c84){const _0x23208b=a51_0x10721e;return _0x1c9c84&&_0x1c9c84[_0x23208b(0x15e)]?_0x1c9c84:{'default':_0x1c9c84};};Object[a51_0x10721e(0x137)](exports,a51_0x10721e(0x15e),{'value':!![]}),exports[a51_0x10721e(0x13c)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x10721e(0x149)));function a51_0x210e(){const _0xf8ace6=['map','.log','webhooks_received','__esModule','logWhiteDomainError','mtime','REQUEST','appendFileSync','WEBHOOK_PROCESSED','split','join','getLogFileName','logWebhookReceived','logWhiteDomainResponse','ensureLogsDirectory','size','cwd','error','filter','statSync','date','12712oNQDlJ','Failed\x20to\x20get\x20log\x20stats:','Failed\x20to\x20write\x20','toISOString','stringify','stack','logsDir','endsWith','logApiCall','COINTOPAY_STATUS_CHANGE','getDate','4198659jQvYli','readdirSync','replace','912572kgGuPn','WEBHOOK_ERROR','500wDhxgX','shop_webhooks_sent','unlinkSync','default','19552848GkcOfF','SHOP_WEBHOOK_SENT','webhooks_errors','logWhiteDomainRequest','__importDefault','LoggerService','utf8','defineProperty','9030217rFyEIN','api_calls','message','existsSync','loggerService','\x20log:','log','🧹\x20Cleaned\x20','slice','443076TPfydS','cointopay_status_changes','cointopay_errors','mkdirSync','webhooks_processed','logShopWebhookError','RESPONSE','673554ZWJARa','path','\x20old\x20log\x20files\x20(older\x20than\x20','logs','shop_webhooks_errors','logPaymentCreated','WEBHOOK_RECEIVED','ERROR','logWebhookError','white_domain_errors','PAYMENT_CREATED','length','📁\x20Created\x20logs\x20directory:\x20','logShopWebhookSent','forEach','SHOP_WEBHOOK_ERROR','cleanOldLogs','sort','writeLog'];a51_0x210e=function(){return _0xf8ace6;};return a51_0x210e();}class LoggerService{constructor(){const _0x2a8001=a51_0x10721e;this[_0x2a8001(0x122)]=path_1[_0x2a8001(0x12f)][_0x2a8001(0x165)](process[_0x2a8001(0x117)](),_0x2a8001(0x14b)),this['ensureLogsDirectory']();}[a51_0x10721e(0x115)](){const _0x54cdde=a51_0x10721e;!fs_1[_0x54cdde(0x12f)][_0x54cdde(0x13b)](this['logsDir'])&&(fs_1[_0x54cdde(0x12f)][_0x54cdde(0x144)](this[_0x54cdde(0x122)],{'recursive':!![]}),console[_0x54cdde(0x13e)](_0x54cdde(0x154)+this['logsDir']));}[a51_0x10721e(0x166)](_0x5b3dd5){const _0x2beb01=a51_0x10721e,_0x24decb=new Date()[_0x2beb01(0x11f)]()['split']('T')[0x0];return path_1[_0x2beb01(0x12f)][_0x2beb01(0x165)](this[_0x2beb01(0x122)],_0x5b3dd5+'_'+_0x24decb+_0x2beb01(0x15c));}[a51_0x10721e(0x15a)](_0x4f9f32,_0x43f6e1){const _0x38a606=a51_0x10721e;try{const _0x46c919=new Date()['toISOString'](),_0x5de482={'timestamp':_0x46c919,..._0x43f6e1},_0x3648d5=JSON[_0x38a606(0x120)](_0x5de482)+'\x0a',_0x125b80=this[_0x38a606(0x166)](_0x4f9f32);fs_1[_0x38a606(0x12f)][_0x38a606(0x162)](_0x125b80,_0x3648d5,_0x38a606(0x136));}catch(_0x35d336){console[_0x38a606(0x118)](_0x38a606(0x11e)+_0x4f9f32+_0x38a606(0x13d),_0x35d336);}}[a51_0x10721e(0x133)](_0x267d86,_0x5d3130,_0x1c6409,_0x2b7d3a){const _0x288fb1=a51_0x10721e;this[_0x288fb1(0x15a)]('white_domain_requests',{'type':_0x288fb1(0x161),'gateway':_0x267d86,'endpoint':_0x5d3130,'method':_0x1c6409,'data':_0x2b7d3a});}[a51_0x10721e(0x114)](_0x169f85,_0x391b1d,_0x6e1257,_0x20c99f,_0x3bfdaa){const _0x1b615d=a51_0x10721e;this[_0x1b615d(0x15a)]('white_domain_responses',{'type':_0x1b615d(0x147),'gateway':_0x169f85,'endpoint':_0x391b1d,'status':_0x6e1257,'responseTime':_0x3bfdaa,'data':_0x20c99f});}[a51_0x10721e(0x15f)](_0x1bed9c,_0x5d2b77,_0x3641f4){const _0x10c95b=a51_0x10721e;this['writeLog'](_0x10c95b(0x151),{'type':_0x10c95b(0x14f),'gateway':_0x1bed9c,'endpoint':_0x5d2b77,'error':_0x3641f4 instanceof Error?{'message':_0x3641f4['message'],'stack':_0x3641f4['stack']}:_0x3641f4});}[a51_0x10721e(0x167)](_0x5e9cb6,_0xa82812,_0xd1d2a5){const _0x482fa2=a51_0x10721e;this[_0x482fa2(0x15a)](_0x482fa2(0x15d),{'type':_0x482fa2(0x14e),'gateway':_0x5e9cb6,'headers':_0xd1d2a5,'data':_0xa82812});}['logWebhookProcessed'](_0x334005,_0x5f0802,_0x5f0e8,_0xa008bb,_0x3b7d78){const _0x231707=a51_0x10721e;this['writeLog'](_0x231707(0x145),{'type':_0x231707(0x163),'gateway':_0x334005,'paymentId':_0x5f0802,'oldStatus':_0x5f0e8,'newStatus':_0xa008bb,'originalData':_0x3b7d78});}[a51_0x10721e(0x150)](_0x4be789,_0x260cd2,_0xb8cb6e){const _0x2f7c80=a51_0x10721e;this[_0x2f7c80(0x15a)](_0x2f7c80(0x132),{'type':_0x2f7c80(0x12b),'gateway':_0x4be789,'error':_0x260cd2 instanceof Error?{'message':_0x260cd2[_0x2f7c80(0x13a)],'stack':_0x260cd2['stack']}:_0x260cd2,'originalData':_0xb8cb6e});}['logCoinToPayStatus'](_0x230465){const _0x43711b=a51_0x10721e;this[_0x43711b(0x15a)](_0x43711b(0x142),{'type':_0x43711b(0x125),..._0x230465});}['logCoinToPayError'](_0x425ca1){const _0x9a6bb5=a51_0x10721e;this[_0x9a6bb5(0x15a)](_0x9a6bb5(0x143),{'type':'COINTOPAY_ERROR',..._0x425ca1});}[a51_0x10721e(0x155)](_0x3d33a0,_0x10a701,_0x2c9f08,_0x470cf7,_0x3dfa08,_0x5524f3){const _0x37ca96=a51_0x10721e;this[_0x37ca96(0x15a)](_0x37ca96(0x12d),{'type':_0x37ca96(0x131),'shopId':_0x3d33a0,'webhookUrl':_0x10a701,'event':_0x2c9f08,'status':_0x470cf7,'responseTime':_0x3dfa08,'payload':_0x5524f3});}[a51_0x10721e(0x146)](_0x49773d,_0x4ec6c3,_0x1bc9fb,_0x346f82,_0x20e12a){const _0x555df5=a51_0x10721e;this['writeLog'](_0x555df5(0x14c),{'type':_0x555df5(0x157),'shopId':_0x49773d,'webhookUrl':_0x4ec6c3,'event':_0x1bc9fb,'error':_0x346f82 instanceof Error?{'message':_0x346f82[_0x555df5(0x13a)],'stack':_0x346f82[_0x555df5(0x121)]}:_0x346f82,'payload':_0x20e12a});}[a51_0x10721e(0x14d)](_0x34dde0,_0x4ef161,_0x33b9a0,_0x146031,_0x293e7d){const _0x17726d=a51_0x10721e;this[_0x17726d(0x15a)]('payments_created',{'type':_0x17726d(0x152),'gateway':_0x34dde0,'paymentId':_0x4ef161,'shopId':_0x33b9a0,'amount':_0x146031,'currency':_0x293e7d});}[a51_0x10721e(0x124)](_0x823d5f,_0x3d14c4,_0x56270b,_0x53ec18,_0x227b72){const _0x59ddf9=a51_0x10721e;this[_0x59ddf9(0x15a)](_0x59ddf9(0x139),{'type':'API_CALL','endpoint':_0x823d5f,'method':_0x3d14c4,'userId':_0x56270b,'userRole':_0x53ec18,'requestData':_0x227b72});}['getLogStats'](){const _0x23ea26=a51_0x10721e;try{const _0x48449f=fs_1[_0x23ea26(0x12f)][_0x23ea26(0x128)](this['logsDir']),_0x360248=_0x48449f[_0x23ea26(0x119)](_0xfca2b5=>_0xfca2b5[_0x23ea26(0x123)](_0x23ea26(0x15c))),_0x25d277=[...new Set(_0x360248[_0x23ea26(0x15b)](_0x2c026f=>_0x2c026f[_0x23ea26(0x164)]('_')[0x0]))],_0x57e241=_0x360248[_0x23ea26(0x15b)](_0x3e75ee=>{const _0x50861e=_0x23ea26,_0x29236d=path_1['default'][_0x50861e(0x165)](this['logsDir'],_0x3e75ee),_0x90914=fs_1[_0x50861e(0x12f)]['statSync'](_0x29236d),[_0x2f6dee,_0x4b01da]=_0x3e75ee[_0x50861e(0x129)](_0x50861e(0x15c),'')[_0x50861e(0x164)]('_');return{'type':_0x2f6dee,'date':_0x4b01da,'size':_0x90914[_0x50861e(0x116)]};})[_0x23ea26(0x159)]((_0xcb38c4,_0x3bd674)=>_0x3bd674['date']['localeCompare'](_0xcb38c4[_0x23ea26(0x11b)]));return{'totalFiles':_0x360248[_0x23ea26(0x153)],'logTypes':_0x25d277,'latestLogs':_0x57e241[_0x23ea26(0x140)](0x0,0xa)};}catch(_0x528ecb){return console[_0x23ea26(0x118)](_0x23ea26(0x11d),_0x528ecb),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x10721e(0x158)](_0x501327=0x1e){const _0x744f55=a51_0x10721e;try{const _0x43ead8=fs_1['default'][_0x744f55(0x128)](this['logsDir']),_0x5f2d16=new Date();_0x5f2d16['setDate'](_0x5f2d16[_0x744f55(0x126)]()-_0x501327);let _0xa2cea0=0x0;_0x43ead8[_0x744f55(0x156)](_0xb3c8e3=>{const _0x23af1e=_0x744f55;if(!_0xb3c8e3['endsWith'](_0x23af1e(0x15c)))return;const _0x2fb038=path_1[_0x23af1e(0x12f)]['join'](this[_0x23af1e(0x122)],_0xb3c8e3),_0x37a54d=fs_1[_0x23af1e(0x12f)][_0x23af1e(0x11a)](_0x2fb038);_0x37a54d[_0x23af1e(0x160)]<_0x5f2d16&&(fs_1[_0x23af1e(0x12f)][_0x23af1e(0x12e)](_0x2fb038),_0xa2cea0++,console[_0x23af1e(0x13e)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0xb3c8e3));}),console[_0x744f55(0x13e)](_0x744f55(0x13f)+_0xa2cea0+_0x744f55(0x14a)+_0x501327+'\x20days)');}catch(_0x30d39b){console[_0x744f55(0x118)]('Failed\x20to\x20clean\x20old\x20logs:',_0x30d39b);}}}exports[a51_0x10721e(0x135)]=LoggerService,exports[a51_0x10721e(0x13c)]=new LoggerService();