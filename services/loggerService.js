'use strict';const a44_0x3718ed=a44_0x114d;(function(_0x261a3c,_0xa9f337){const _0x164e4a=a44_0x114d,_0x24f09a=_0x261a3c();while(!![]){try{const _0x48d66b=parseInt(_0x164e4a(0x1ca))/0x1+parseInt(_0x164e4a(0x184))/0x2+-parseInt(_0x164e4a(0x19a))/0x3+-parseInt(_0x164e4a(0x1a7))/0x4+-parseInt(_0x164e4a(0x17d))/0x5*(parseInt(_0x164e4a(0x1b0))/0x6)+parseInt(_0x164e4a(0x1a1))/0x7*(-parseInt(_0x164e4a(0x186))/0x8)+parseInt(_0x164e4a(0x190))/0x9*(parseInt(_0x164e4a(0x1b2))/0xa);if(_0x48d66b===_0xa9f337)break;else _0x24f09a['push'](_0x24f09a['shift']());}catch(_0x62b3b1){_0x24f09a['push'](_0x24f09a['shift']());}}}(a44_0x424a,0x71354));function a44_0x424a(){const _0x41826b=['.log','WEBHOOK_PROCESSED','cointopay_status_changes','log','logs','sort','75397owLMoU','logShopWebhookSent','logWebhookError','logCoinToPayStatus','unlinkSync','WEBHOOK_ERROR','1168528fLtNIY','logWebhookReceived','split','toISOString','path','statSync','white_domain_responses','webhooks_received','cwd','15462eMcusl','SHOP_WEBHOOK_SENT','20UFLvCa','getDate','logPaymentCreated','logWhiteDomainResponse','localeCompare','cleanOldLogs','__esModule','endsWith','map','logShopWebhookError','forEach','WEBHOOK_RECEIVED','RESPONSE','message','logsDir','white_domain_requests','logWhiteDomainError','\x20log:','default','getLogFileName','📁\x20Created\x20logs\x20directory:\x20','\x20days)','ensureLogsDirectory','utf8','822731eUfHRy','readdirSync','logWhiteDomainRequest','mkdirSync','805ENuWZi','mtime','defineProperty','length','filter','api_calls','COINTOPAY_ERROR','968876lcmjSR','slice','640XyTBUi','Failed\x20to\x20write\x20','appendFileSync','writeLog','error','date','loggerService','Failed\x20to\x20get\x20log\x20stats:','\x20old\x20log\x20files\x20(older\x20than\x20','size','5033430BcfVru','webhooks_processed','shop_webhooks_sent','stringify','stack','logWebhookProcessed','join','replace','logCoinToPayError','SHOP_WEBHOOK_ERROR','1179900tlCBqq'];a44_0x424a=function(){return _0x41826b;};return a44_0x424a();}var __importDefault=this&&this['__importDefault']||function(_0x472ae2){const _0x160e0f=a44_0x114d;return _0x472ae2&&_0x472ae2[_0x160e0f(0x1b8)]?_0x472ae2:{'default':_0x472ae2};};Object[a44_0x3718ed(0x17f)](exports,a44_0x3718ed(0x1b8),{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a44_0x3718ed(0x1ab)));function a44_0x114d(_0x2fa468,_0x301b5c){const _0x424ac0=a44_0x424a();return a44_0x114d=function(_0x114d3c,_0x1f1232){_0x114d3c=_0x114d3c-0x17a;let _0x4957db=_0x424ac0[_0x114d3c];return _0x4957db;},a44_0x114d(_0x2fa468,_0x301b5c);}class LoggerService{constructor(){const _0x51f1f3=a44_0x3718ed;this['logsDir']=path_1[_0x51f1f3(0x1c4)][_0x51f1f3(0x196)](process[_0x51f1f3(0x1af)](),_0x51f1f3(0x19f)),this[_0x51f1f3(0x1c8)]();}[a44_0x3718ed(0x1c8)](){const _0xb7a221=a44_0x3718ed;!fs_1[_0xb7a221(0x1c4)]['existsSync'](this[_0xb7a221(0x1c0)])&&(fs_1[_0xb7a221(0x1c4)][_0xb7a221(0x17c)](this[_0xb7a221(0x1c0)],{'recursive':!![]}),console[_0xb7a221(0x19e)](_0xb7a221(0x1c6)+this[_0xb7a221(0x1c0)]));}[a44_0x3718ed(0x1c5)](_0x4e71fa){const _0x280675=a44_0x3718ed,_0x31dad7=new Date()[_0x280675(0x1aa)]()[_0x280675(0x1a9)]('T')[0x0];return path_1[_0x280675(0x1c4)][_0x280675(0x196)](this[_0x280675(0x1c0)],_0x4e71fa+'_'+_0x31dad7+_0x280675(0x19b));}[a44_0x3718ed(0x189)](_0x181ae5,_0x1a6869){const _0x201340=a44_0x3718ed;try{const _0x5599de=new Date()[_0x201340(0x1aa)](),_0x4ec999={'timestamp':_0x5599de,..._0x1a6869},_0x4bd478=JSON[_0x201340(0x193)](_0x4ec999)+'\x0a',_0x14503c=this[_0x201340(0x1c5)](_0x181ae5);fs_1[_0x201340(0x1c4)][_0x201340(0x188)](_0x14503c,_0x4bd478,_0x201340(0x1c9));}catch(_0x5cfee7){console[_0x201340(0x18a)](_0x201340(0x187)+_0x181ae5+_0x201340(0x1c3),_0x5cfee7);}}[a44_0x3718ed(0x17b)](_0x2ead55,_0x330943,_0x1916c6,_0x50977f){const _0x28d654=a44_0x3718ed;this[_0x28d654(0x189)](_0x28d654(0x1c1),{'type':'REQUEST','gateway':_0x2ead55,'endpoint':_0x330943,'method':_0x1916c6,'data':_0x50977f});}[a44_0x3718ed(0x1b5)](_0x1363b8,_0x53a74e,_0x485dc1,_0x1526f1,_0x4c2d0c){const _0x3fba9c=a44_0x3718ed;this['writeLog'](_0x3fba9c(0x1ad),{'type':_0x3fba9c(0x1be),'gateway':_0x1363b8,'endpoint':_0x53a74e,'status':_0x485dc1,'responseTime':_0x4c2d0c,'data':_0x1526f1});}[a44_0x3718ed(0x1c2)](_0x1a5ae2,_0x1113a3,_0x32a129){const _0x396c9b=a44_0x3718ed;this[_0x396c9b(0x189)]('white_domain_errors',{'type':'ERROR','gateway':_0x1a5ae2,'endpoint':_0x1113a3,'error':_0x32a129 instanceof Error?{'message':_0x32a129['message'],'stack':_0x32a129['stack']}:_0x32a129});}[a44_0x3718ed(0x1a8)](_0x51bece,_0x589809,_0x2569ba){const _0xdb8399=a44_0x3718ed;this['writeLog'](_0xdb8399(0x1ae),{'type':_0xdb8399(0x1bd),'gateway':_0x51bece,'headers':_0x2569ba,'data':_0x589809});}[a44_0x3718ed(0x195)](_0x2abebf,_0xccad90,_0x2e6d8e,_0x506c5b,_0x48611f){const _0x2bd67b=a44_0x3718ed;this[_0x2bd67b(0x189)](_0x2bd67b(0x191),{'type':_0x2bd67b(0x19c),'gateway':_0x2abebf,'paymentId':_0xccad90,'oldStatus':_0x2e6d8e,'newStatus':_0x506c5b,'originalData':_0x48611f});}[a44_0x3718ed(0x1a3)](_0x4d9952,_0x3a7b2e,_0x4a8219){const _0x536a1=a44_0x3718ed;this['writeLog']('webhooks_errors',{'type':_0x536a1(0x1a6),'gateway':_0x4d9952,'error':_0x3a7b2e instanceof Error?{'message':_0x3a7b2e['message'],'stack':_0x3a7b2e['stack']}:_0x3a7b2e,'originalData':_0x4a8219});}[a44_0x3718ed(0x1a4)](_0x240d52){const _0x1758af=a44_0x3718ed;this[_0x1758af(0x189)](_0x1758af(0x19d),{'type':'COINTOPAY_STATUS_CHANGE',..._0x240d52});}[a44_0x3718ed(0x198)](_0x32a2d3){const _0x67560c=a44_0x3718ed;this[_0x67560c(0x189)]('cointopay_errors',{'type':_0x67560c(0x183),..._0x32a2d3});}[a44_0x3718ed(0x1a2)](_0x153609,_0x330ef2,_0x2b09d1,_0x128ed5,_0x46e8fd,_0x1012a7){const _0x46cd65=a44_0x3718ed;this[_0x46cd65(0x189)](_0x46cd65(0x192),{'type':_0x46cd65(0x1b1),'shopId':_0x153609,'webhookUrl':_0x330ef2,'event':_0x2b09d1,'status':_0x128ed5,'responseTime':_0x46e8fd,'payload':_0x1012a7});}[a44_0x3718ed(0x1bb)](_0x302c72,_0x3f396f,_0x4ded5a,_0x387902,_0x8496a1){const _0x214488=a44_0x3718ed;this[_0x214488(0x189)]('shop_webhooks_errors',{'type':_0x214488(0x199),'shopId':_0x302c72,'webhookUrl':_0x3f396f,'event':_0x4ded5a,'error':_0x387902 instanceof Error?{'message':_0x387902[_0x214488(0x1bf)],'stack':_0x387902[_0x214488(0x194)]}:_0x387902,'payload':_0x8496a1});}[a44_0x3718ed(0x1b4)](_0x4163c4,_0x17f2ee,_0x32cff9,_0x501502,_0x49685e){this['writeLog']('payments_created',{'type':'PAYMENT_CREATED','gateway':_0x4163c4,'paymentId':_0x17f2ee,'shopId':_0x32cff9,'amount':_0x501502,'currency':_0x49685e});}['logApiCall'](_0xddfa9c,_0x81c86b,_0x32f028,_0x55cc90,_0x5bd8b6){const _0x19c283=a44_0x3718ed;this[_0x19c283(0x189)](_0x19c283(0x182),{'type':'API_CALL','endpoint':_0xddfa9c,'method':_0x81c86b,'userId':_0x32f028,'userRole':_0x55cc90,'requestData':_0x5bd8b6});}['getLogStats'](){const _0x3e9e0c=a44_0x3718ed;try{const _0xc298a2=fs_1[_0x3e9e0c(0x1c4)][_0x3e9e0c(0x17a)](this[_0x3e9e0c(0x1c0)]),_0x21bc14=_0xc298a2[_0x3e9e0c(0x181)](_0x3c66a5=>_0x3c66a5['endsWith'](_0x3e9e0c(0x19b))),_0x3acd3e=[...new Set(_0x21bc14[_0x3e9e0c(0x1ba)](_0x7fdee5=>_0x7fdee5[_0x3e9e0c(0x1a9)]('_')[0x0]))],_0x5cc9d3=_0x21bc14[_0x3e9e0c(0x1ba)](_0x18c1e9=>{const _0x1245ab=_0x3e9e0c,_0x460fe1=path_1['default']['join'](this[_0x1245ab(0x1c0)],_0x18c1e9),_0x4b6ae4=fs_1['default']['statSync'](_0x460fe1),[_0x31a784,_0x507530]=_0x18c1e9[_0x1245ab(0x197)]('.log','')['split']('_');return{'type':_0x31a784,'date':_0x507530,'size':_0x4b6ae4[_0x1245ab(0x18f)]};})[_0x3e9e0c(0x1a0)]((_0xd3bbd8,_0x4b8c88)=>_0x4b8c88[_0x3e9e0c(0x18b)][_0x3e9e0c(0x1b6)](_0xd3bbd8[_0x3e9e0c(0x18b)]));return{'totalFiles':_0x21bc14[_0x3e9e0c(0x180)],'logTypes':_0x3acd3e,'latestLogs':_0x5cc9d3[_0x3e9e0c(0x185)](0x0,0xa)};}catch(_0x17bfcf){return console[_0x3e9e0c(0x18a)](_0x3e9e0c(0x18d),_0x17bfcf),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a44_0x3718ed(0x1b7)](_0x49152c=0x1e){const _0x2fa51f=a44_0x3718ed;try{const _0x101eb6=fs_1[_0x2fa51f(0x1c4)]['readdirSync'](this['logsDir']),_0x53884f=new Date();_0x53884f['setDate'](_0x53884f[_0x2fa51f(0x1b3)]()-_0x49152c);let _0xae6ea5=0x0;_0x101eb6[_0x2fa51f(0x1bc)](_0x3576d9=>{const _0x55809b=_0x2fa51f;if(!_0x3576d9[_0x55809b(0x1b9)](_0x55809b(0x19b)))return;const _0x17d1b3=path_1[_0x55809b(0x1c4)][_0x55809b(0x196)](this[_0x55809b(0x1c0)],_0x3576d9),_0x332faf=fs_1[_0x55809b(0x1c4)][_0x55809b(0x1ac)](_0x17d1b3);_0x332faf[_0x55809b(0x17e)]<_0x53884f&&(fs_1['default'][_0x55809b(0x1a5)](_0x17d1b3),_0xae6ea5++,console[_0x55809b(0x19e)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x3576d9));}),console[_0x2fa51f(0x19e)]('🧹\x20Cleaned\x20'+_0xae6ea5+_0x2fa51f(0x18e)+_0x49152c+_0x2fa51f(0x1c7));}catch(_0x5716c5){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x5716c5);}}}exports['LoggerService']=LoggerService,exports[a44_0x3718ed(0x18c)]=new LoggerService();