'use strict';function a49_0x8df5(_0x363642,_0x5c5e64){const _0x56781f=a49_0x5678();return a49_0x8df5=function(_0x8df51d,_0x527732){_0x8df51d=_0x8df51d-0x135;let _0x5c758d=_0x56781f[_0x8df51d];return _0x5c758d;},a49_0x8df5(_0x363642,_0x5c5e64);}const a49_0x2cb61b=a49_0x8df5;(function(_0x4468ca,_0x26f4d0){const _0x226cdb=a49_0x8df5,_0x30b315=_0x4468ca();while(!![]){try{const _0x302e4d=-parseInt(_0x226cdb(0x176))/0x1*(parseInt(_0x226cdb(0x147))/0x2)+-parseInt(_0x226cdb(0x13e))/0x3+parseInt(_0x226cdb(0x182))/0x4+parseInt(_0x226cdb(0x148))/0x5+-parseInt(_0x226cdb(0x15f))/0x6*(-parseInt(_0x226cdb(0x14f))/0x7)+parseInt(_0x226cdb(0x171))/0x8+-parseInt(_0x226cdb(0x152))/0x9;if(_0x302e4d===_0x26f4d0)break;else _0x30b315['push'](_0x30b315['shift']());}catch(_0x50e7bd){_0x30b315['push'](_0x30b315['shift']());}}}(a49_0x5678,0x53dc4));function a49_0x5678(){const _0x5ca99e=['🗑️\x20Deleted\x20old\x20log\x20file:\x20','WEBHOOK_PROCESSED','cointopay_errors','Failed\x20to\x20clean\x20old\x20logs:','logsDir','shop_webhooks_sent','logCoinToPayError','4271888srCBSw','COINTOPAY_STATUS_CHANGE','PAYMENT_CREATED','mkdirSync','logWebhookProcessed','1091WHVhxj','__esModule','map','join','unlinkSync','logShopWebhookSent','webhooks_received','log','LoggerService','defineProperty','RESPONSE','Failed\x20to\x20get\x20log\x20stats:','2247788qjFvch','setDate','getLogFileName','writeLog','cleanOldLogs','endsWith','.log','default','\x20old\x20log\x20files\x20(older\x20than\x20','statSync','api_calls','2030049rdrOvV','readdirSync','WEBHOOK_ERROR','filter','webhooks_errors','Failed\x20to\x20write\x20','length','slice','getDate','942uAClTg','2204130bAkmts','path','SHOP_WEBHOOK_SENT','📁\x20Created\x20logs\x20directory:\x20','error','cointopay_status_changes','stack','182hXRAlI','🧹\x20Cleaned\x20','split','5976531cxDcmp','REQUEST','replace','forEach','getLogStats','shop_webhooks_errors','white_domain_requests','logShopWebhookError','logWhiteDomainResponse','\x20days)','date','cwd','loggerService','152616OWJhFn','logWhiteDomainError','ERROR','toISOString','message','logCoinToPayStatus','logWebhookReceived','payments_created','ensureLogsDirectory','__importDefault','white_domain_errors'];a49_0x5678=function(){return _0x5ca99e;};return a49_0x5678();}var __importDefault=this&&this[a49_0x2cb61b(0x168)]||function(_0x18afdd){return _0x18afdd&&_0x18afdd['__esModule']?_0x18afdd:{'default':_0x18afdd};};Object[a49_0x2cb61b(0x17f)](exports,a49_0x2cb61b(0x177),{'value':!![]}),exports[a49_0x2cb61b(0x15e)]=exports[a49_0x2cb61b(0x17e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x2cb61b(0x149)));class LoggerService{constructor(){const _0x25f647=a49_0x2cb61b;this[_0x25f647(0x16e)]=path_1['default']['join'](process[_0x25f647(0x15d)](),'logs'),this[_0x25f647(0x167)]();}[a49_0x2cb61b(0x167)](){const _0x4eba49=a49_0x2cb61b;!fs_1[_0x4eba49(0x13a)]['existsSync'](this[_0x4eba49(0x16e)])&&(fs_1[_0x4eba49(0x13a)][_0x4eba49(0x174)](this[_0x4eba49(0x16e)],{'recursive':!![]}),console[_0x4eba49(0x17d)](_0x4eba49(0x14b)+this[_0x4eba49(0x16e)]));}[a49_0x2cb61b(0x135)](_0x278b96){const _0x119b2f=a49_0x2cb61b,_0x16eb59=new Date()[_0x119b2f(0x162)]()[_0x119b2f(0x151)]('T')[0x0];return path_1[_0x119b2f(0x13a)][_0x119b2f(0x179)](this[_0x119b2f(0x16e)],_0x278b96+'_'+_0x16eb59+_0x119b2f(0x139));}[a49_0x2cb61b(0x136)](_0x1f8fc6,_0x1002ad){const _0x1c8011=a49_0x2cb61b;try{const _0x3d01d0=new Date()['toISOString'](),_0x5af78a={'timestamp':_0x3d01d0,..._0x1002ad},_0x455908=JSON['stringify'](_0x5af78a)+'\x0a',_0x50bbb5=this[_0x1c8011(0x135)](_0x1f8fc6);fs_1[_0x1c8011(0x13a)]['appendFileSync'](_0x50bbb5,_0x455908,'utf8');}catch(_0x49cc22){console[_0x1c8011(0x14c)](_0x1c8011(0x143)+_0x1f8fc6+'\x20log:',_0x49cc22);}}['logWhiteDomainRequest'](_0x3ecbcd,_0x3ff6d0,_0x38c423,_0x233c26){const _0x4e8576=a49_0x2cb61b;this[_0x4e8576(0x136)](_0x4e8576(0x158),{'type':_0x4e8576(0x153),'gateway':_0x3ecbcd,'endpoint':_0x3ff6d0,'method':_0x38c423,'data':_0x233c26});}[a49_0x2cb61b(0x15a)](_0x2f6d5f,_0x413be6,_0x2d419a,_0x2c590b,_0x26aa6d){const _0x172322=a49_0x2cb61b;this[_0x172322(0x136)]('white_domain_responses',{'type':_0x172322(0x180),'gateway':_0x2f6d5f,'endpoint':_0x413be6,'status':_0x2d419a,'responseTime':_0x26aa6d,'data':_0x2c590b});}[a49_0x2cb61b(0x160)](_0xc9b92c,_0x1ad8d5,_0x597016){const _0xf26bf=a49_0x2cb61b;this['writeLog'](_0xf26bf(0x169),{'type':_0xf26bf(0x161),'gateway':_0xc9b92c,'endpoint':_0x1ad8d5,'error':_0x597016 instanceof Error?{'message':_0x597016[_0xf26bf(0x163)],'stack':_0x597016[_0xf26bf(0x14e)]}:_0x597016});}[a49_0x2cb61b(0x165)](_0x483906,_0x203ad6,_0x49cbe6){const _0x275190=a49_0x2cb61b;this[_0x275190(0x136)](_0x275190(0x17c),{'type':'WEBHOOK_RECEIVED','gateway':_0x483906,'headers':_0x49cbe6,'data':_0x203ad6});}[a49_0x2cb61b(0x175)](_0x919f78,_0x43abe1,_0x544796,_0x24c828,_0x2d1cf7){const _0x28b96c=a49_0x2cb61b;this[_0x28b96c(0x136)]('webhooks_processed',{'type':_0x28b96c(0x16b),'gateway':_0x919f78,'paymentId':_0x43abe1,'oldStatus':_0x544796,'newStatus':_0x24c828,'originalData':_0x2d1cf7});}['logWebhookError'](_0x2df7f0,_0x333cd6,_0x3d7a16){const _0x1c9486=a49_0x2cb61b;this[_0x1c9486(0x136)](_0x1c9486(0x142),{'type':_0x1c9486(0x140),'gateway':_0x2df7f0,'error':_0x333cd6 instanceof Error?{'message':_0x333cd6[_0x1c9486(0x163)],'stack':_0x333cd6[_0x1c9486(0x14e)]}:_0x333cd6,'originalData':_0x3d7a16});}[a49_0x2cb61b(0x164)](_0x3710f0){const _0x21c713=a49_0x2cb61b;this['writeLog'](_0x21c713(0x14d),{'type':_0x21c713(0x172),..._0x3710f0});}[a49_0x2cb61b(0x170)](_0x165c3a){const _0x43a2df=a49_0x2cb61b;this[_0x43a2df(0x136)](_0x43a2df(0x16c),{'type':'COINTOPAY_ERROR',..._0x165c3a});}[a49_0x2cb61b(0x17b)](_0x54b716,_0x1dacef,_0x46373,_0x4ccdf0,_0x40e629,_0x12bb35){const _0x5ed5d2=a49_0x2cb61b;this[_0x5ed5d2(0x136)](_0x5ed5d2(0x16f),{'type':_0x5ed5d2(0x14a),'shopId':_0x54b716,'webhookUrl':_0x1dacef,'event':_0x46373,'status':_0x4ccdf0,'responseTime':_0x40e629,'payload':_0x12bb35});}[a49_0x2cb61b(0x159)](_0x36d8fb,_0x5e6a7b,_0x425fc7,_0x2ef4ee,_0x4029bd){const _0x3fe29f=a49_0x2cb61b;this['writeLog'](_0x3fe29f(0x157),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x36d8fb,'webhookUrl':_0x5e6a7b,'event':_0x425fc7,'error':_0x2ef4ee instanceof Error?{'message':_0x2ef4ee[_0x3fe29f(0x163)],'stack':_0x2ef4ee[_0x3fe29f(0x14e)]}:_0x2ef4ee,'payload':_0x4029bd});}['logPaymentCreated'](_0x28f130,_0x49811d,_0x713c90,_0x2e44b1,_0x570f9d){const _0x4ee929=a49_0x2cb61b;this[_0x4ee929(0x136)](_0x4ee929(0x166),{'type':_0x4ee929(0x173),'gateway':_0x28f130,'paymentId':_0x49811d,'shopId':_0x713c90,'amount':_0x2e44b1,'currency':_0x570f9d});}['logApiCall'](_0x5665f9,_0x109315,_0x2a121e,_0xdf904a,_0x26586b){const _0x290da3=a49_0x2cb61b;this[_0x290da3(0x136)](_0x290da3(0x13d),{'type':'API_CALL','endpoint':_0x5665f9,'method':_0x109315,'userId':_0x2a121e,'userRole':_0xdf904a,'requestData':_0x26586b});}[a49_0x2cb61b(0x156)](){const _0x48cb46=a49_0x2cb61b;try{const _0x2aae53=fs_1[_0x48cb46(0x13a)][_0x48cb46(0x13f)](this[_0x48cb46(0x16e)]),_0x108648=_0x2aae53[_0x48cb46(0x141)](_0x2cc8fe=>_0x2cc8fe[_0x48cb46(0x138)](_0x48cb46(0x139))),_0xe75745=[...new Set(_0x108648[_0x48cb46(0x178)](_0x52478c=>_0x52478c['split']('_')[0x0]))],_0x3514f6=_0x108648[_0x48cb46(0x178)](_0x19f26b=>{const _0x1d694b=_0x48cb46,_0x2ee3db=path_1[_0x1d694b(0x13a)][_0x1d694b(0x179)](this[_0x1d694b(0x16e)],_0x19f26b),_0x1e7223=fs_1[_0x1d694b(0x13a)]['statSync'](_0x2ee3db),[_0x4d84df,_0x52d182]=_0x19f26b[_0x1d694b(0x154)](_0x1d694b(0x139),'')[_0x1d694b(0x151)]('_');return{'type':_0x4d84df,'date':_0x52d182,'size':_0x1e7223['size']};})['sort']((_0x216292,_0x38af24)=>_0x38af24[_0x48cb46(0x15c)]['localeCompare'](_0x216292[_0x48cb46(0x15c)]));return{'totalFiles':_0x108648[_0x48cb46(0x144)],'logTypes':_0xe75745,'latestLogs':_0x3514f6[_0x48cb46(0x145)](0x0,0xa)};}catch(_0x3f2000){return console[_0x48cb46(0x14c)](_0x48cb46(0x181),_0x3f2000),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x2cb61b(0x137)](_0x3518db=0x1e){const _0x30f47f=a49_0x2cb61b;try{const _0x3dd8bf=fs_1[_0x30f47f(0x13a)][_0x30f47f(0x13f)](this[_0x30f47f(0x16e)]),_0x3102ce=new Date();_0x3102ce[_0x30f47f(0x183)](_0x3102ce[_0x30f47f(0x146)]()-_0x3518db);let _0x20b373=0x0;_0x3dd8bf[_0x30f47f(0x155)](_0x3df621=>{const _0x2e612f=_0x30f47f;if(!_0x3df621[_0x2e612f(0x138)](_0x2e612f(0x139)))return;const _0x16ba58=path_1[_0x2e612f(0x13a)]['join'](this[_0x2e612f(0x16e)],_0x3df621),_0x2e73de=fs_1['default'][_0x2e612f(0x13c)](_0x16ba58);_0x2e73de['mtime']<_0x3102ce&&(fs_1[_0x2e612f(0x13a)][_0x2e612f(0x17a)](_0x16ba58),_0x20b373++,console[_0x2e612f(0x17d)](_0x2e612f(0x16a)+_0x3df621));}),console[_0x30f47f(0x17d)](_0x30f47f(0x150)+_0x20b373+_0x30f47f(0x13b)+_0x3518db+_0x30f47f(0x15b));}catch(_0x426588){console[_0x30f47f(0x14c)](_0x30f47f(0x16d),_0x426588);}}}exports[a49_0x2cb61b(0x17e)]=LoggerService,exports['loggerService']=new LoggerService();