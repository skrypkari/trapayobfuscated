'use strict';function a48_0x2fe4(_0x1a1a42,_0x2cf368){const _0x4fbdde=a48_0x4fbd();return a48_0x2fe4=function(_0x2fe417,_0x5e2dc5){_0x2fe417=_0x2fe417-0x1e5;let _0x22beb5=_0x4fbdde[_0x2fe417];return _0x22beb5;},a48_0x2fe4(_0x1a1a42,_0x2cf368);}const a48_0x46159f=a48_0x2fe4;(function(_0xfbee1,_0x22ee31){const _0x42c317=a48_0x2fe4,_0x716871=_0xfbee1();while(!![]){try{const _0x1699a4=-parseInt(_0x42c317(0x1f5))/0x1*(parseInt(_0x42c317(0x210))/0x2)+-parseInt(_0x42c317(0x21c))/0x3+-parseInt(_0x42c317(0x20c))/0x4*(-parseInt(_0x42c317(0x1f2))/0x5)+-parseInt(_0x42c317(0x218))/0x6+-parseInt(_0x42c317(0x234))/0x7+parseInt(_0x42c317(0x1fe))/0x8*(parseInt(_0x42c317(0x1ef))/0x9)+parseInt(_0x42c317(0x1ff))/0xa*(parseInt(_0x42c317(0x20b))/0xb);if(_0x1699a4===_0x22ee31)break;else _0x716871['push'](_0x716871['shift']());}catch(_0x1f9108){_0x716871['push'](_0x716871['shift']());}}}(a48_0x4fbd,0x8a033));var __importDefault=this&&this[a48_0x46159f(0x1ee)]||function(_0x5370f0){const _0x541db3=a48_0x46159f;return _0x5370f0&&_0x5370f0[_0x541db3(0x231)]?_0x5370f0:{'default':_0x5370f0};};function a48_0x4fbd(){const _0x3a77a2=['localeCompare','__esModule','RESPONSE','white_domain_responses','57218ZPkkAk','WEBHOOK_RECEIVED','\x20old\x20log\x20files\x20(older\x20than\x20','logApiCall','SHOP_WEBHOOK_ERROR','default','WEBHOOK_ERROR','SHOP_WEBHOOK_SENT','getDate','mkdirSync','__importDefault','306VJbwao','getLogStats','endsWith','505rbmJaH','logWebhookError','statSync','9443KpmVsm','ensureLogsDirectory','white_domain_errors','\x20log:','stack','Failed\x20to\x20clean\x20old\x20logs:','length','cointopay_status_changes','logWhiteDomainResponse','199432bwzzfx','570gCCWwo','setDate','PAYMENT_CREATED','logWebhookReceived','logsDir','logWhiteDomainRequest','stringify','join','appendFileSync','path','sort','payments_created','198451AQSSUt','17984yedGjH','logWebhookProcessed','logPaymentCreated','LoggerService','130dnZGjq','split','shop_webhooks_sent','date','REQUEST','logWhiteDomainError','webhooks_processed','cleanOldLogs','939966mYMuAd','WEBHOOK_PROCESSED','logCoinToPayStatus','shop_webhooks_errors','2958270JVzALV','error','utf8','Failed\x20to\x20write\x20','.log','cointopay_errors','message','map','log','readdirSync','getLogFileName','logShopWebhookSent','COINTOPAY_STATUS_CHANGE','mtime','toISOString','api_calls','🗑️\x20Deleted\x20old\x20log\x20file:\x20','webhooks_errors','\x20days)','writeLog'];a48_0x4fbd=function(){return _0x3a77a2;};return a48_0x4fbd();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a48_0x46159f(0x20f)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x46159f(0x208)));class LoggerService{constructor(){const _0x41f27c=a48_0x46159f;this[_0x41f27c(0x203)]=path_1[_0x41f27c(0x1e9)]['join'](process['cwd'](),'logs'),this[_0x41f27c(0x1f6)]();}['ensureLogsDirectory'](){const _0x2503c5=a48_0x46159f;!fs_1[_0x2503c5(0x1e9)]['existsSync'](this[_0x2503c5(0x203)])&&(fs_1[_0x2503c5(0x1e9)][_0x2503c5(0x1ed)](this['logsDir'],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x2503c5(0x203)]));}[a48_0x46159f(0x226)](_0x546e74){const _0x87a3d=a48_0x46159f,_0x9b3e29=new Date()[_0x87a3d(0x22a)]()[_0x87a3d(0x211)]('T')[0x0];return path_1['default'][_0x87a3d(0x206)](this[_0x87a3d(0x203)],_0x546e74+'_'+_0x9b3e29+_0x87a3d(0x220));}[a48_0x46159f(0x22f)](_0x23c6e7,_0x269920){const _0xf814ce=a48_0x46159f;try{const _0x1c52f7=new Date()[_0xf814ce(0x22a)](),_0x2299e2={'timestamp':_0x1c52f7,..._0x269920},_0x4e206b=JSON[_0xf814ce(0x205)](_0x2299e2)+'\x0a',_0x109ed6=this[_0xf814ce(0x226)](_0x23c6e7);fs_1[_0xf814ce(0x1e9)][_0xf814ce(0x207)](_0x109ed6,_0x4e206b,_0xf814ce(0x21e));}catch(_0x29fbc0){console[_0xf814ce(0x21d)](_0xf814ce(0x21f)+_0x23c6e7+_0xf814ce(0x1f8),_0x29fbc0);}}[a48_0x46159f(0x204)](_0x381489,_0x1a73b6,_0x39ccc3,_0x37f17b){const _0x56b8dd=a48_0x46159f;this[_0x56b8dd(0x22f)]('white_domain_requests',{'type':_0x56b8dd(0x214),'gateway':_0x381489,'endpoint':_0x1a73b6,'method':_0x39ccc3,'data':_0x37f17b});}[a48_0x46159f(0x1fd)](_0x435a0c,_0x11d58d,_0x1100b0,_0x33f79c,_0x476c11){const _0x3b96a1=a48_0x46159f;this[_0x3b96a1(0x22f)](_0x3b96a1(0x233),{'type':_0x3b96a1(0x232),'gateway':_0x435a0c,'endpoint':_0x11d58d,'status':_0x1100b0,'responseTime':_0x476c11,'data':_0x33f79c});}[a48_0x46159f(0x215)](_0x454332,_0x32567e,_0x2f394c){const _0xebda5d=a48_0x46159f;this[_0xebda5d(0x22f)](_0xebda5d(0x1f7),{'type':'ERROR','gateway':_0x454332,'endpoint':_0x32567e,'error':_0x2f394c instanceof Error?{'message':_0x2f394c[_0xebda5d(0x222)],'stack':_0x2f394c[_0xebda5d(0x1f9)]}:_0x2f394c});}[a48_0x46159f(0x202)](_0x31a652,_0x40c498,_0x541924){const _0x5eb67d=a48_0x46159f;this['writeLog']('webhooks_received',{'type':_0x5eb67d(0x1e5),'gateway':_0x31a652,'headers':_0x541924,'data':_0x40c498});}[a48_0x46159f(0x20d)](_0x1b6e7d,_0x1c7fbd,_0x2656ce,_0x500577,_0x203633){const _0x5784f5=a48_0x46159f;this[_0x5784f5(0x22f)](_0x5784f5(0x216),{'type':_0x5784f5(0x219),'gateway':_0x1b6e7d,'paymentId':_0x1c7fbd,'oldStatus':_0x2656ce,'newStatus':_0x500577,'originalData':_0x203633});}[a48_0x46159f(0x1f3)](_0x1d17c8,_0x233351,_0x5dbd15){const _0x59c268=a48_0x46159f;this[_0x59c268(0x22f)](_0x59c268(0x22d),{'type':_0x59c268(0x1ea),'gateway':_0x1d17c8,'error':_0x233351 instanceof Error?{'message':_0x233351[_0x59c268(0x222)],'stack':_0x233351[_0x59c268(0x1f9)]}:_0x233351,'originalData':_0x5dbd15});}[a48_0x46159f(0x21a)](_0x85dbf6){const _0x16c1f0=a48_0x46159f;this['writeLog'](_0x16c1f0(0x1fc),{'type':_0x16c1f0(0x228),..._0x85dbf6});}['logCoinToPayError'](_0x14148a){const _0x1206f1=a48_0x46159f;this[_0x1206f1(0x22f)](_0x1206f1(0x221),{'type':'COINTOPAY_ERROR',..._0x14148a});}[a48_0x46159f(0x227)](_0x22725e,_0x3af093,_0x424b3c,_0xe2aa25,_0x53126d,_0x43f183){const _0x2708c4=a48_0x46159f;this[_0x2708c4(0x22f)](_0x2708c4(0x212),{'type':_0x2708c4(0x1eb),'shopId':_0x22725e,'webhookUrl':_0x3af093,'event':_0x424b3c,'status':_0xe2aa25,'responseTime':_0x53126d,'payload':_0x43f183});}['logShopWebhookError'](_0x137202,_0x195553,_0x1be601,_0x1171a5,_0x2f094a){const _0x3a8b78=a48_0x46159f;this['writeLog'](_0x3a8b78(0x21b),{'type':_0x3a8b78(0x1e8),'shopId':_0x137202,'webhookUrl':_0x195553,'event':_0x1be601,'error':_0x1171a5 instanceof Error?{'message':_0x1171a5[_0x3a8b78(0x222)],'stack':_0x1171a5[_0x3a8b78(0x1f9)]}:_0x1171a5,'payload':_0x2f094a});}[a48_0x46159f(0x20e)](_0x24e5b1,_0x3c4b4b,_0x50452b,_0x5e327f,_0xc86bd0){const _0x3c1bcf=a48_0x46159f;this[_0x3c1bcf(0x22f)](_0x3c1bcf(0x20a),{'type':_0x3c1bcf(0x201),'gateway':_0x24e5b1,'paymentId':_0x3c4b4b,'shopId':_0x50452b,'amount':_0x5e327f,'currency':_0xc86bd0});}[a48_0x46159f(0x1e7)](_0x2df8d7,_0x118c3e,_0x100293,_0x5f3a24,_0x318eec){const _0x304e9b=a48_0x46159f;this[_0x304e9b(0x22f)](_0x304e9b(0x22b),{'type':'API_CALL','endpoint':_0x2df8d7,'method':_0x118c3e,'userId':_0x100293,'userRole':_0x5f3a24,'requestData':_0x318eec});}[a48_0x46159f(0x1f0)](){const _0x36043c=a48_0x46159f;try{const _0x5ebe6c=fs_1[_0x36043c(0x1e9)][_0x36043c(0x225)](this['logsDir']),_0x59110d=_0x5ebe6c['filter'](_0x55442d=>_0x55442d[_0x36043c(0x1f1)](_0x36043c(0x220))),_0x4dc978=[...new Set(_0x59110d[_0x36043c(0x223)](_0x20afb3=>_0x20afb3['split']('_')[0x0]))],_0x199549=_0x59110d[_0x36043c(0x223)](_0x51d680=>{const _0x22df52=_0x36043c,_0x4e8a33=path_1[_0x22df52(0x1e9)][_0x22df52(0x206)](this[_0x22df52(0x203)],_0x51d680),_0x2a357b=fs_1[_0x22df52(0x1e9)][_0x22df52(0x1f4)](_0x4e8a33),[_0x335e83,_0x2236c7]=_0x51d680['replace'](_0x22df52(0x220),'')['split']('_');return{'type':_0x335e83,'date':_0x2236c7,'size':_0x2a357b['size']};})[_0x36043c(0x209)]((_0xc70d94,_0x576273)=>_0x576273['date'][_0x36043c(0x230)](_0xc70d94[_0x36043c(0x213)]));return{'totalFiles':_0x59110d[_0x36043c(0x1fb)],'logTypes':_0x4dc978,'latestLogs':_0x199549['slice'](0x0,0xa)};}catch(_0x5c2b1e){return console[_0x36043c(0x21d)]('Failed\x20to\x20get\x20log\x20stats:',_0x5c2b1e),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x46159f(0x217)](_0xdb3cf4=0x1e){const _0x4d5a4a=a48_0x46159f;try{const _0x1e408b=fs_1[_0x4d5a4a(0x1e9)]['readdirSync'](this[_0x4d5a4a(0x203)]),_0x2935d9=new Date();_0x2935d9[_0x4d5a4a(0x200)](_0x2935d9[_0x4d5a4a(0x1ec)]()-_0xdb3cf4);let _0x47a66c=0x0;_0x1e408b['forEach'](_0xe8658f=>{const _0x260cd3=_0x4d5a4a;if(!_0xe8658f[_0x260cd3(0x1f1)](_0x260cd3(0x220)))return;const _0x1672bb=path_1[_0x260cd3(0x1e9)][_0x260cd3(0x206)](this[_0x260cd3(0x203)],_0xe8658f),_0x4ccb5a=fs_1[_0x260cd3(0x1e9)][_0x260cd3(0x1f4)](_0x1672bb);_0x4ccb5a[_0x260cd3(0x229)]<_0x2935d9&&(fs_1[_0x260cd3(0x1e9)]['unlinkSync'](_0x1672bb),_0x47a66c++,console[_0x260cd3(0x224)](_0x260cd3(0x22c)+_0xe8658f));}),console['log']('🧹\x20Cleaned\x20'+_0x47a66c+_0x4d5a4a(0x1e6)+_0xdb3cf4+_0x4d5a4a(0x22e));}catch(_0x2191e8){console[_0x4d5a4a(0x21d)](_0x4d5a4a(0x1fa),_0x2191e8);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();