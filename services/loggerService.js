'use strict';const a48_0x2287da=a48_0x560b;(function(_0x14ad78,_0x457e03){const _0x837410=a48_0x560b,_0x494864=_0x14ad78();while(!![]){try{const _0x1fe323=parseInt(_0x837410(0x143))/0x1*(parseInt(_0x837410(0x157))/0x2)+-parseInt(_0x837410(0x11c))/0x3+parseInt(_0x837410(0x12f))/0x4*(-parseInt(_0x837410(0x12e))/0x5)+-parseInt(_0x837410(0x15a))/0x6+-parseInt(_0x837410(0x129))/0x7*(-parseInt(_0x837410(0x142))/0x8)+parseInt(_0x837410(0x153))/0x9+parseInt(_0x837410(0x13a))/0xa;if(_0x1fe323===_0x457e03)break;else _0x494864['push'](_0x494864['shift']());}catch(_0x55cde6){_0x494864['push'](_0x494864['shift']());}}}(a48_0x44f1,0x5a359));function a48_0x44f1(){const _0xe7fe7f=['17764000TSPxbv','date','.log','SHOP_WEBHOOK_SENT','statSync','logApiCall','stack','replace','84704mHdftF','210363BrWHVK','readdirSync','🧹\x20Cleaned\x20','white_domain_responses','getDate','cwd','shop_webhooks_errors','PAYMENT_CREATED','path','writeLog','join','\x20log:','logPaymentCreated','__importDefault','logsDir','COINTOPAY_ERROR','1775988MNeyRh','slice','Failed\x20to\x20write\x20','\x20days)','2abSnUU','map','split','4390086ANDpjv','RESPONSE','getLogStats','logWhiteDomainResponse','api_calls','logCoinToPayError','webhooks_errors','unlinkSync','WEBHOOK_RECEIVED','getLogFileName','SHOP_WEBHOOK_ERROR','logCoinToPayStatus','ERROR','utf8','size','API_CALL','cointopay_errors','1957434VEUhJN','ensureLogsDirectory','appendFileSync','shop_webhooks_sent','error','🗑️\x20Deleted\x20old\x20log\x20file:\x20','filter','default','message','white_domain_errors','webhooks_received','logWebhookReceived','REQUEST','168mSqdCm','logWhiteDomainRequest','cleanOldLogs','logs','logWhiteDomainError','95ZizISf','144116OvpDci','WEBHOOK_PROCESSED','log','logWebhookError','loggerService','__esModule','cointopay_status_changes','toISOString','Failed\x20to\x20get\x20log\x20stats:','LoggerService','COINTOPAY_STATUS_CHANGE'];a48_0x44f1=function(){return _0xe7fe7f;};return a48_0x44f1();}function a48_0x560b(_0x5a59f8,_0x277647){const _0x44f1d5=a48_0x44f1();return a48_0x560b=function(_0x560b1b,_0x4672b7){_0x560b1b=_0x560b1b-0x10d;let _0x437969=_0x44f1d5[_0x560b1b];return _0x437969;},a48_0x560b(_0x5a59f8,_0x277647);}var __importDefault=this&&this[a48_0x2287da(0x150)]||function(_0x54fb2e){const _0x56e877=a48_0x2287da;return _0x54fb2e&&_0x54fb2e[_0x56e877(0x134)]?_0x54fb2e:{'default':_0x54fb2e};};Object['defineProperty'](exports,a48_0x2287da(0x134),{'value':!![]}),exports[a48_0x2287da(0x133)]=exports[a48_0x2287da(0x138)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x2287da(0x14b)));class LoggerService{constructor(){const _0x132dfe=a48_0x2287da;this[_0x132dfe(0x151)]=path_1[_0x132dfe(0x123)][_0x132dfe(0x14d)](process[_0x132dfe(0x148)](),_0x132dfe(0x12c)),this[_0x132dfe(0x11d)]();}[a48_0x2287da(0x11d)](){const _0x2b7af5=a48_0x2287da;!fs_1[_0x2b7af5(0x123)]['existsSync'](this[_0x2b7af5(0x151)])&&(fs_1[_0x2b7af5(0x123)]['mkdirSync'](this[_0x2b7af5(0x151)],{'recursive':!![]}),console[_0x2b7af5(0x131)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x2b7af5(0x151)]));}[a48_0x2287da(0x114)](_0x5d09c0){const _0x571652=a48_0x2287da,_0x3e0fe1=new Date()[_0x571652(0x136)]()[_0x571652(0x159)]('T')[0x0];return path_1[_0x571652(0x123)][_0x571652(0x14d)](this[_0x571652(0x151)],_0x5d09c0+'_'+_0x3e0fe1+_0x571652(0x13c));}['writeLog'](_0x245338,_0x579276){const _0x507308=a48_0x2287da;try{const _0x220160=new Date()['toISOString'](),_0x4767bc={'timestamp':_0x220160,..._0x579276},_0x35d56c=JSON['stringify'](_0x4767bc)+'\x0a',_0x533b15=this[_0x507308(0x114)](_0x245338);fs_1[_0x507308(0x123)][_0x507308(0x11e)](_0x533b15,_0x35d56c,_0x507308(0x118));}catch(_0x4d25b4){console['error'](_0x507308(0x155)+_0x245338+_0x507308(0x14e),_0x4d25b4);}}[a48_0x2287da(0x12a)](_0x11b717,_0x581c0d,_0x3f765d,_0x13fb75){const _0x5d1067=a48_0x2287da;this[_0x5d1067(0x14c)]('white_domain_requests',{'type':_0x5d1067(0x128),'gateway':_0x11b717,'endpoint':_0x581c0d,'method':_0x3f765d,'data':_0x13fb75});}[a48_0x2287da(0x10e)](_0x585093,_0x47f9b0,_0x11d24d,_0x30a2a4,_0xe129e3){const _0x32293f=a48_0x2287da;this['writeLog'](_0x32293f(0x146),{'type':_0x32293f(0x15b),'gateway':_0x585093,'endpoint':_0x47f9b0,'status':_0x11d24d,'responseTime':_0xe129e3,'data':_0x30a2a4});}[a48_0x2287da(0x12d)](_0x1f0a30,_0x5b7608,_0x4f3859){const _0x42db98=a48_0x2287da;this[_0x42db98(0x14c)](_0x42db98(0x125),{'type':_0x42db98(0x117),'gateway':_0x1f0a30,'endpoint':_0x5b7608,'error':_0x4f3859 instanceof Error?{'message':_0x4f3859['message'],'stack':_0x4f3859[_0x42db98(0x140)]}:_0x4f3859});}[a48_0x2287da(0x127)](_0x2bfe87,_0x1cf9e9,_0xaa28d9){const _0x158a64=a48_0x2287da;this[_0x158a64(0x14c)](_0x158a64(0x126),{'type':_0x158a64(0x113),'gateway':_0x2bfe87,'headers':_0xaa28d9,'data':_0x1cf9e9});}['logWebhookProcessed'](_0xa9c433,_0x52fba4,_0x2eb1ff,_0x4a051f,_0x1b0f36){const _0x297c88=a48_0x2287da;this[_0x297c88(0x14c)]('webhooks_processed',{'type':_0x297c88(0x130),'gateway':_0xa9c433,'paymentId':_0x52fba4,'oldStatus':_0x2eb1ff,'newStatus':_0x4a051f,'originalData':_0x1b0f36});}[a48_0x2287da(0x132)](_0x30766b,_0x4ec7bd,_0x3433b1){const _0x1725ff=a48_0x2287da;this['writeLog'](_0x1725ff(0x111),{'type':'WEBHOOK_ERROR','gateway':_0x30766b,'error':_0x4ec7bd instanceof Error?{'message':_0x4ec7bd[_0x1725ff(0x124)],'stack':_0x4ec7bd[_0x1725ff(0x140)]}:_0x4ec7bd,'originalData':_0x3433b1});}[a48_0x2287da(0x116)](_0x430009){const _0x586785=a48_0x2287da;this[_0x586785(0x14c)](_0x586785(0x135),{'type':_0x586785(0x139),..._0x430009});}[a48_0x2287da(0x110)](_0x2b8e57){const _0x5ed750=a48_0x2287da;this[_0x5ed750(0x14c)](_0x5ed750(0x11b),{'type':_0x5ed750(0x152),..._0x2b8e57});}['logShopWebhookSent'](_0xd99eb2,_0xde05ec,_0x35f114,_0x251325,_0x5b4f25,_0x7afdc2){const _0x256802=a48_0x2287da;this[_0x256802(0x14c)](_0x256802(0x11f),{'type':_0x256802(0x13d),'shopId':_0xd99eb2,'webhookUrl':_0xde05ec,'event':_0x35f114,'status':_0x251325,'responseTime':_0x5b4f25,'payload':_0x7afdc2});}['logShopWebhookError'](_0x5d92dd,_0x4a6ca9,_0x46a172,_0x52bcfe,_0x37306c){const _0x3b6d90=a48_0x2287da;this['writeLog'](_0x3b6d90(0x149),{'type':_0x3b6d90(0x115),'shopId':_0x5d92dd,'webhookUrl':_0x4a6ca9,'event':_0x46a172,'error':_0x52bcfe instanceof Error?{'message':_0x52bcfe[_0x3b6d90(0x124)],'stack':_0x52bcfe[_0x3b6d90(0x140)]}:_0x52bcfe,'payload':_0x37306c});}[a48_0x2287da(0x14f)](_0x5e3814,_0x362831,_0x5523a4,_0x4ecf79,_0x4f4a1b){const _0x46d2db=a48_0x2287da;this[_0x46d2db(0x14c)]('payments_created',{'type':_0x46d2db(0x14a),'gateway':_0x5e3814,'paymentId':_0x362831,'shopId':_0x5523a4,'amount':_0x4ecf79,'currency':_0x4f4a1b});}[a48_0x2287da(0x13f)](_0x16afdc,_0x31566a,_0x21f285,_0x1ec988,_0x3adc7d){const _0x317964=a48_0x2287da;this['writeLog'](_0x317964(0x10f),{'type':_0x317964(0x11a),'endpoint':_0x16afdc,'method':_0x31566a,'userId':_0x21f285,'userRole':_0x1ec988,'requestData':_0x3adc7d});}[a48_0x2287da(0x10d)](){const _0x3d63eb=a48_0x2287da;try{const _0x25c03c=fs_1['default'][_0x3d63eb(0x144)](this['logsDir']),_0x2a1915=_0x25c03c[_0x3d63eb(0x122)](_0x5979cc=>_0x5979cc['endsWith']('.log')),_0x1a2889=[...new Set(_0x2a1915['map'](_0x56386e=>_0x56386e[_0x3d63eb(0x159)]('_')[0x0]))],_0x1b6b5d=_0x2a1915[_0x3d63eb(0x158)](_0x5e9b0c=>{const _0x3bf928=_0x3d63eb,_0x2c6339=path_1[_0x3bf928(0x123)][_0x3bf928(0x14d)](this['logsDir'],_0x5e9b0c),_0x5d1672=fs_1['default'][_0x3bf928(0x13e)](_0x2c6339),[_0x32a147,_0x4b04d6]=_0x5e9b0c[_0x3bf928(0x141)](_0x3bf928(0x13c),'')['split']('_');return{'type':_0x32a147,'date':_0x4b04d6,'size':_0x5d1672[_0x3bf928(0x119)]};})['sort']((_0x2e383b,_0x34f6fc)=>_0x34f6fc['date']['localeCompare'](_0x2e383b[_0x3d63eb(0x13b)]));return{'totalFiles':_0x2a1915['length'],'logTypes':_0x1a2889,'latestLogs':_0x1b6b5d[_0x3d63eb(0x154)](0x0,0xa)};}catch(_0x5846ab){return console[_0x3d63eb(0x120)](_0x3d63eb(0x137),_0x5846ab),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x2287da(0x12b)](_0x1809a1=0x1e){const _0x98cd97=a48_0x2287da;try{const _0x2aff8e=fs_1['default'][_0x98cd97(0x144)](this['logsDir']),_0x4feabb=new Date();_0x4feabb['setDate'](_0x4feabb[_0x98cd97(0x147)]()-_0x1809a1);let _0x241c6c=0x0;_0x2aff8e['forEach'](_0x4c9a1a=>{const _0xa0467b=_0x98cd97;if(!_0x4c9a1a['endsWith']('.log'))return;const _0x3b1cd9=path_1[_0xa0467b(0x123)]['join'](this[_0xa0467b(0x151)],_0x4c9a1a),_0x3efe99=fs_1[_0xa0467b(0x123)][_0xa0467b(0x13e)](_0x3b1cd9);_0x3efe99['mtime']<_0x4feabb&&(fs_1[_0xa0467b(0x123)][_0xa0467b(0x112)](_0x3b1cd9),_0x241c6c++,console[_0xa0467b(0x131)](_0xa0467b(0x121)+_0x4c9a1a));}),console['log'](_0x98cd97(0x145)+_0x241c6c+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x1809a1+_0x98cd97(0x156));}catch(_0x2f59b3){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x2f59b3);}}}exports[a48_0x2287da(0x138)]=LoggerService,exports[a48_0x2287da(0x133)]=new LoggerService();