'use strict';function a75_0x3f43(_0x299c1f,_0x1469dc){_0x299c1f=_0x299c1f-0xa2;const _0x1183c8=a75_0x1183();let _0x3f4361=_0x1183c8[_0x299c1f];return _0x3f4361;}const a75_0x4d4bd2=a75_0x3f43;(function(_0x56c73c,_0xc7bee6){const _0x6a8050=a75_0x3f43,_0x39434c=_0x56c73c();while(!![]){try{const _0x5ede90=parseInt(_0x6a8050(0xca))/0x1*(parseInt(_0x6a8050(0xce))/0x2)+parseInt(_0x6a8050(0xed))/0x3+parseInt(_0x6a8050(0xac))/0x4+parseInt(_0x6a8050(0xb5))/0x5+-parseInt(_0x6a8050(0xa3))/0x6*(-parseInt(_0x6a8050(0xa4))/0x7)+-parseInt(_0x6a8050(0xf5))/0x8+-parseInt(_0x6a8050(0xc0))/0x9;if(_0x5ede90===_0xc7bee6)break;else _0x39434c['push'](_0x39434c['shift']());}catch(_0x284458){_0x39434c['push'](_0x39434c['shift']());}}}(a75_0x1183,0x1df91));var __importDefault=this&&this[a75_0x4d4bd2(0xd1)]||function(_0xff2ce1){const _0x2bc4a8=a75_0x4d4bd2;return _0xff2ce1&&_0xff2ce1[_0x2bc4a8(0xb3)]?_0xff2ce1:{'default':_0xff2ce1};};Object[a75_0x4d4bd2(0xdb)](exports,a75_0x4d4bd2(0xb3),{'value':!![]}),exports[a75_0x4d4bd2(0xad)]=exports[a75_0x4d4bd2(0xae)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a75_0x4d4bd2(0xea)));function a75_0x1183(){const _0x445218=['cointopay_status_changes','utf8','logWhiteDomainResponse','path','getDate','writeLog','135387ySbOcn','api_calls','forEach','filter','unlinkSync','endsWith','ensureLogsDirectory','split','1311296nlUOEb','white_domain_requests','COINTOPAY_ERROR','cleanOldLogs','6oYIviI','1673518ACsGzs','logs','statSync','default','payments_created','REQUEST','.log','Failed\x20to\x20clean\x20old\x20logs:','257576VtVYXq','loggerService','LoggerService','localeCompare','readdirSync','error','sort','__esModule','ERROR','253435YONlzH','SHOP_WEBHOOK_SENT','SHOP_WEBHOOK_ERROR','stringify','size','logWebhookReceived','existsSync','toISOString','logApiCall','white_domain_responses','WEBHOOK_RECEIVED','1078209OQMEay','date','\x20days)','logShopWebhookSent','API_CALL','webhooks_received','WEBHOOK_PROCESSED','PAYMENT_CREATED','length','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','1VHDnWX','logCoinToPayStatus','logWhiteDomainRequest','logCoinToPayError','14396UWPDcx','WEBHOOK_ERROR','stack','__importDefault','white_domain_errors','ðŸ“\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20write\x20','logWhiteDomainError','logWebhookError','\x20log:','getLogFileName','mtime','log','defineProperty','logsDir','mkdirSync','join','appendFileSync','RESPONSE','message','map','logWebhookProcessed','ðŸ§¹\x20Cleaned\x20','webhooks_processed','cointopay_errors'];a75_0x1183=function(){return _0x445218;};return a75_0x1183();}class LoggerService{constructor(){const _0x4031bc=a75_0x4d4bd2;this[_0x4031bc(0xdc)]=path_1['default'][_0x4031bc(0xde)](process['cwd'](),_0x4031bc(0xa5)),this[_0x4031bc(0xf3)]();}['ensureLogsDirectory'](){const _0x3a1467=a75_0x4d4bd2;!fs_1[_0x3a1467(0xa7)][_0x3a1467(0xbb)](this[_0x3a1467(0xdc)])&&(fs_1[_0x3a1467(0xa7)][_0x3a1467(0xdd)](this['logsDir'],{'recursive':!![]}),console[_0x3a1467(0xda)](_0x3a1467(0xd3)+this[_0x3a1467(0xdc)]));}[a75_0x4d4bd2(0xd8)](_0x183e5b){const _0x5b854d=a75_0x4d4bd2,_0x3a6596=new Date()[_0x5b854d(0xbc)]()[_0x5b854d(0xf4)]('T')[0x0];return path_1[_0x5b854d(0xa7)][_0x5b854d(0xde)](this[_0x5b854d(0xdc)],_0x183e5b+'_'+_0x3a6596+_0x5b854d(0xaa));}[a75_0x4d4bd2(0xec)](_0x2016e1,_0xeb2aa6){const _0x42678a=a75_0x4d4bd2;try{const _0x2348be=new Date()['toISOString'](),_0x3858fc={'timestamp':_0x2348be,..._0xeb2aa6},_0x20b21a=JSON[_0x42678a(0xb8)](_0x3858fc)+'\x0a',_0x57b43e=this[_0x42678a(0xd8)](_0x2016e1);fs_1[_0x42678a(0xa7)][_0x42678a(0xdf)](_0x57b43e,_0x20b21a,_0x42678a(0xe8));}catch(_0x568cb8){console[_0x42678a(0xb1)](_0x42678a(0xd4)+_0x2016e1+_0x42678a(0xd7),_0x568cb8);}}[a75_0x4d4bd2(0xcc)](_0x256a61,_0x5ba2de,_0x1d0303,_0x564112){const _0x11248e=a75_0x4d4bd2;this[_0x11248e(0xec)](_0x11248e(0xf6),{'type':_0x11248e(0xa9),'gateway':_0x256a61,'endpoint':_0x5ba2de,'method':_0x1d0303,'data':_0x564112});}[a75_0x4d4bd2(0xe9)](_0xd87c75,_0x16b278,_0x44bd60,_0x35c177,_0x3c4f77){const _0x3ac7e9=a75_0x4d4bd2;this['writeLog'](_0x3ac7e9(0xbe),{'type':_0x3ac7e9(0xe0),'gateway':_0xd87c75,'endpoint':_0x16b278,'status':_0x44bd60,'responseTime':_0x3c4f77,'data':_0x35c177});}[a75_0x4d4bd2(0xd5)](_0x4f1390,_0x119b0d,_0x39fb43){const _0x2ea06d=a75_0x4d4bd2;this['writeLog'](_0x2ea06d(0xd2),{'type':_0x2ea06d(0xb4),'gateway':_0x4f1390,'endpoint':_0x119b0d,'error':_0x39fb43 instanceof Error?{'message':_0x39fb43['message'],'stack':_0x39fb43[_0x2ea06d(0xd0)]}:_0x39fb43});}[a75_0x4d4bd2(0xba)](_0x4278c2,_0x547875,_0x2ef122){const _0x31cda8=a75_0x4d4bd2;this['writeLog'](_0x31cda8(0xc5),{'type':_0x31cda8(0xbf),'gateway':_0x4278c2,'headers':_0x2ef122,'data':_0x547875});}[a75_0x4d4bd2(0xe3)](_0x372f94,_0x494e35,_0x53b251,_0x375cf8,_0x1570ec){const _0x241b73=a75_0x4d4bd2;this[_0x241b73(0xec)](_0x241b73(0xe5),{'type':_0x241b73(0xc6),'gateway':_0x372f94,'paymentId':_0x494e35,'oldStatus':_0x53b251,'newStatus':_0x375cf8,'originalData':_0x1570ec});}[a75_0x4d4bd2(0xd6)](_0x5369a5,_0x3d1ad5,_0x2080f3){const _0x4a74e7=a75_0x4d4bd2;this[_0x4a74e7(0xec)]('webhooks_errors',{'type':_0x4a74e7(0xcf),'gateway':_0x5369a5,'error':_0x3d1ad5 instanceof Error?{'message':_0x3d1ad5[_0x4a74e7(0xe1)],'stack':_0x3d1ad5[_0x4a74e7(0xd0)]}:_0x3d1ad5,'originalData':_0x2080f3});}[a75_0x4d4bd2(0xcb)](_0x398281){const _0x6172d6=a75_0x4d4bd2;this['writeLog'](_0x6172d6(0xe7),{'type':'COINTOPAY_STATUS_CHANGE',..._0x398281});}[a75_0x4d4bd2(0xcd)](_0xb89744){const _0x219678=a75_0x4d4bd2;this['writeLog'](_0x219678(0xe6),{'type':_0x219678(0xf7),..._0xb89744});}[a75_0x4d4bd2(0xc3)](_0x2fa204,_0x42691f,_0x3bf085,_0x552942,_0x1dc001,_0x4cebd2){const _0x201efc=a75_0x4d4bd2;this[_0x201efc(0xec)]('shop_webhooks_sent',{'type':_0x201efc(0xb6),'shopId':_0x2fa204,'webhookUrl':_0x42691f,'event':_0x3bf085,'status':_0x552942,'responseTime':_0x1dc001,'payload':_0x4cebd2});}['logShopWebhookError'](_0x847f9,_0x336497,_0x39d2c2,_0x38aebd,_0x4fff46){const _0xf351b7=a75_0x4d4bd2;this[_0xf351b7(0xec)]('shop_webhooks_errors',{'type':_0xf351b7(0xb7),'shopId':_0x847f9,'webhookUrl':_0x336497,'event':_0x39d2c2,'error':_0x38aebd instanceof Error?{'message':_0x38aebd[_0xf351b7(0xe1)],'stack':_0x38aebd[_0xf351b7(0xd0)]}:_0x38aebd,'payload':_0x4fff46});}['logPaymentCreated'](_0x4e0d07,_0x2ed8bd,_0x268cd0,_0x1baa6a,_0x493111){const _0x38f584=a75_0x4d4bd2;this[_0x38f584(0xec)](_0x38f584(0xa8),{'type':_0x38f584(0xc7),'gateway':_0x4e0d07,'paymentId':_0x2ed8bd,'shopId':_0x268cd0,'amount':_0x1baa6a,'currency':_0x493111});}[a75_0x4d4bd2(0xbd)](_0x2ac777,_0x2b2686,_0x12cb5f,_0x403e71,_0xa2f35f){const _0x554016=a75_0x4d4bd2;this[_0x554016(0xec)](_0x554016(0xee),{'type':_0x554016(0xc4),'endpoint':_0x2ac777,'method':_0x2b2686,'userId':_0x12cb5f,'userRole':_0x403e71,'requestData':_0xa2f35f});}['getLogStats'](){const _0x5141e6=a75_0x4d4bd2;try{const _0x418121=fs_1[_0x5141e6(0xa7)][_0x5141e6(0xb0)](this['logsDir']),_0x5d4523=_0x418121[_0x5141e6(0xf0)](_0x2d1740=>_0x2d1740[_0x5141e6(0xf2)]('.log')),_0x33ac3e=[...new Set(_0x5d4523[_0x5141e6(0xe2)](_0x24f9bc=>_0x24f9bc[_0x5141e6(0xf4)]('_')[0x0]))],_0x5c0e21=_0x5d4523[_0x5141e6(0xe2)](_0x130859=>{const _0xf90a35=_0x5141e6,_0x5c5188=path_1[_0xf90a35(0xa7)][_0xf90a35(0xde)](this['logsDir'],_0x130859),_0x9fc1aa=fs_1[_0xf90a35(0xa7)]['statSync'](_0x5c5188),[_0x210bd0,_0x3c1832]=_0x130859['replace'](_0xf90a35(0xaa),'')[_0xf90a35(0xf4)]('_');return{'type':_0x210bd0,'date':_0x3c1832,'size':_0x9fc1aa[_0xf90a35(0xb9)]};})[_0x5141e6(0xb2)]((_0x27405f,_0x5cfefe)=>_0x5cfefe[_0x5141e6(0xc1)][_0x5141e6(0xaf)](_0x27405f[_0x5141e6(0xc1)]));return{'totalFiles':_0x5d4523[_0x5141e6(0xc8)],'logTypes':_0x33ac3e,'latestLogs':_0x5c0e21['slice'](0x0,0xa)};}catch(_0x5f3490){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x5f3490),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a75_0x4d4bd2(0xa2)](_0x543999=0x1e){const _0x19fc3a=a75_0x4d4bd2;try{const _0x209a1c=fs_1[_0x19fc3a(0xa7)][_0x19fc3a(0xb0)](this[_0x19fc3a(0xdc)]),_0x3a8e0c=new Date();_0x3a8e0c['setDate'](_0x3a8e0c[_0x19fc3a(0xeb)]()-_0x543999);let _0x171ac4=0x0;_0x209a1c[_0x19fc3a(0xef)](_0x3802a4=>{const _0x12e84b=_0x19fc3a;if(!_0x3802a4[_0x12e84b(0xf2)](_0x12e84b(0xaa)))return;const _0x1ee019=path_1[_0x12e84b(0xa7)][_0x12e84b(0xde)](this[_0x12e84b(0xdc)],_0x3802a4),_0x114269=fs_1[_0x12e84b(0xa7)][_0x12e84b(0xa6)](_0x1ee019);_0x114269[_0x12e84b(0xd9)]<_0x3a8e0c&&(fs_1[_0x12e84b(0xa7)][_0x12e84b(0xf1)](_0x1ee019),_0x171ac4++,console[_0x12e84b(0xda)](_0x12e84b(0xc9)+_0x3802a4));}),console[_0x19fc3a(0xda)](_0x19fc3a(0xe4)+_0x171ac4+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x543999+_0x19fc3a(0xc2));}catch(_0x138ce3){console[_0x19fc3a(0xb1)](_0x19fc3a(0xab),_0x138ce3);}}}exports[a75_0x4d4bd2(0xae)]=LoggerService,exports['loggerService']=new LoggerService();