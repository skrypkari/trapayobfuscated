'use strict';const a59_0x3609a7=a59_0x1ed8;(function(_0x51b4b8,_0x164ecd){const _0x5e5eae=a59_0x1ed8,_0x1bf785=_0x51b4b8();while(!![]){try{const _0x52d2ec=-parseInt(_0x5e5eae(0x19f))/0x1*(parseInt(_0x5e5eae(0x15f))/0x2)+parseInt(_0x5e5eae(0x18f))/0x3+parseInt(_0x5e5eae(0x165))/0x4*(parseInt(_0x5e5eae(0x198))/0x5)+-parseInt(_0x5e5eae(0x175))/0x6+parseInt(_0x5e5eae(0x192))/0x7*(-parseInt(_0x5e5eae(0x1a3))/0x8)+-parseInt(_0x5e5eae(0x162))/0x9+-parseInt(_0x5e5eae(0x169))/0xa*(-parseInt(_0x5e5eae(0x167))/0xb);if(_0x52d2ec===_0x164ecd)break;else _0x1bf785['push'](_0x1bf785['shift']());}catch(_0x527317){_0x1bf785['push'](_0x1bf785['shift']());}}}(a59_0x3de9,0x36721));function a59_0x1ed8(_0x4cb04e,_0x3e2754){const _0x3de9e4=a59_0x3de9();return a59_0x1ed8=function(_0x1ed8a7,_0x185769){_0x1ed8a7=_0x1ed8a7-0x15d;let _0x3596ac=_0x3de9e4[_0x1ed8a7];return _0x3596ac;},a59_0x1ed8(_0x4cb04e,_0x3e2754);}function a59_0x3de9(){const _0x57f229=['stack','SHOP_WEBHOOK_SENT','default','PAYMENT_CREATED','unlinkSync','path','logWebhookProcessed','2192580lfYaeP','WEBHOOK_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','payments_created','map','defineProperty','getLogFileName','logs','ensureLogsDirectory','log','COINTOPAY_STATUS_CHANGE','statSync','toISOString','\x20log:','mkdirSync','__importDefault','loggerService','localeCompare','cointopay_errors','date','__esModule','logWhiteDomainRequest','writeLog','.log','cleanOldLogs','mtime','1159149yAOoDz','webhooks_processed','COINTOPAY_ERROR','1189811jNSFkF','🧹\x20Cleaned\x20','error','stringify','readdirSync','message','228895eOdMVa','ERROR','join','RESPONSE','LoggerService','webhooks_received','logWebhookReceived','13glHYYz','cointopay_status_changes','size','white_domain_requests','16aMdkUQ','logCoinToPayError','API_CALL','logsDir','getLogStats','getDate','📁\x20Created\x20logs\x20directory:\x20','split','shop_webhooks_sent','40308wtiFDe','Failed\x20to\x20get\x20log\x20stats:','setDate','862074DMWOZe','api_calls','forEach','4GIRmnA','filter','11vsPlpk','logWebhookError','8540110jbSplD','replace','utf8','webhooks_errors','endsWith'];a59_0x3de9=function(){return _0x57f229;};return a59_0x3de9();}var __importDefault=this&&this[a59_0x3609a7(0x184)]||function(_0x9d190){const _0x38dfa3=a59_0x3609a7;return _0x9d190&&_0x9d190[_0x38dfa3(0x189)]?_0x9d190:{'default':_0x9d190};};Object[a59_0x3609a7(0x17a)](exports,a59_0x3609a7(0x189),{'value':!![]}),exports[a59_0x3609a7(0x185)]=exports[a59_0x3609a7(0x19c)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x3609a7(0x173)));class LoggerService{constructor(){const _0x222e67=a59_0x3609a7;this['logsDir']=path_1[_0x222e67(0x170)][_0x222e67(0x19a)](process['cwd'](),_0x222e67(0x17c)),this['ensureLogsDirectory']();}[a59_0x3609a7(0x17d)](){const _0x547568=a59_0x3609a7;!fs_1[_0x547568(0x170)]['existsSync'](this[_0x547568(0x1a6)])&&(fs_1['default'][_0x547568(0x183)](this[_0x547568(0x1a6)],{'recursive':!![]}),console[_0x547568(0x17e)](_0x547568(0x1a9)+this[_0x547568(0x1a6)]));}[a59_0x3609a7(0x17b)](_0x14a2e0){const _0x4b6912=a59_0x3609a7,_0x135f84=new Date()[_0x4b6912(0x181)]()[_0x4b6912(0x15d)]('T')[0x0];return path_1[_0x4b6912(0x170)][_0x4b6912(0x19a)](this[_0x4b6912(0x1a6)],_0x14a2e0+'_'+_0x135f84+_0x4b6912(0x18c));}[a59_0x3609a7(0x18b)](_0x5127f5,_0x3a59fe){const _0x2d8892=a59_0x3609a7;try{const _0x4f9b1e=new Date()[_0x2d8892(0x181)](),_0xce8eca={'timestamp':_0x4f9b1e,..._0x3a59fe},_0x1ef867=JSON[_0x2d8892(0x195)](_0xce8eca)+'\x0a',_0x361f3c=this['getLogFileName'](_0x5127f5);fs_1[_0x2d8892(0x170)]['appendFileSync'](_0x361f3c,_0x1ef867,_0x2d8892(0x16b));}catch(_0x362156){console[_0x2d8892(0x194)]('Failed\x20to\x20write\x20'+_0x5127f5+_0x2d8892(0x182),_0x362156);}}[a59_0x3609a7(0x18a)](_0x3bfc05,_0x55f779,_0x5cdfd8,_0x5cc32d){const _0x1853d5=a59_0x3609a7;this[_0x1853d5(0x18b)](_0x1853d5(0x1a2),{'type':'REQUEST','gateway':_0x3bfc05,'endpoint':_0x55f779,'method':_0x5cdfd8,'data':_0x5cc32d});}['logWhiteDomainResponse'](_0x5d503c,_0x148b11,_0x38f087,_0x720b17,_0xbe1c7c){const _0x21aa35=a59_0x3609a7;this[_0x21aa35(0x18b)]('white_domain_responses',{'type':_0x21aa35(0x19b),'gateway':_0x5d503c,'endpoint':_0x148b11,'status':_0x38f087,'responseTime':_0xbe1c7c,'data':_0x720b17});}['logWhiteDomainError'](_0x146d98,_0x4b6661,_0x1c869b){const _0x37d5f0=a59_0x3609a7;this[_0x37d5f0(0x18b)]('white_domain_errors',{'type':_0x37d5f0(0x199),'gateway':_0x146d98,'endpoint':_0x4b6661,'error':_0x1c869b instanceof Error?{'message':_0x1c869b['message'],'stack':_0x1c869b['stack']}:_0x1c869b});}[a59_0x3609a7(0x19e)](_0x51540c,_0xdcfc0,_0x2cfd95){const _0x37027b=a59_0x3609a7;this['writeLog'](_0x37027b(0x19d),{'type':'WEBHOOK_RECEIVED','gateway':_0x51540c,'headers':_0x2cfd95,'data':_0xdcfc0});}[a59_0x3609a7(0x174)](_0x370216,_0x19c786,_0x2cb213,_0x43d258,_0x12e306){const _0x2f1e4b=a59_0x3609a7;this[_0x2f1e4b(0x18b)](_0x2f1e4b(0x190),{'type':'WEBHOOK_PROCESSED','gateway':_0x370216,'paymentId':_0x19c786,'oldStatus':_0x2cb213,'newStatus':_0x43d258,'originalData':_0x12e306});}[a59_0x3609a7(0x168)](_0x5ddb08,_0x2b2bb4,_0x8cd057){const _0x1033e8=a59_0x3609a7;this[_0x1033e8(0x18b)](_0x1033e8(0x16c),{'type':_0x1033e8(0x176),'gateway':_0x5ddb08,'error':_0x2b2bb4 instanceof Error?{'message':_0x2b2bb4[_0x1033e8(0x197)],'stack':_0x2b2bb4[_0x1033e8(0x16e)]}:_0x2b2bb4,'originalData':_0x8cd057});}['logCoinToPayStatus'](_0x4e2108){const _0x47ca27=a59_0x3609a7;this['writeLog'](_0x47ca27(0x1a0),{'type':_0x47ca27(0x17f),..._0x4e2108});}[a59_0x3609a7(0x1a4)](_0x54344b){const _0x443b13=a59_0x3609a7;this[_0x443b13(0x18b)](_0x443b13(0x187),{'type':_0x443b13(0x191),..._0x54344b});}['logShopWebhookSent'](_0x59e8e6,_0x1830e7,_0x36c370,_0x27ff5,_0x3ca45e,_0x32a073){const _0x320ef9=a59_0x3609a7;this[_0x320ef9(0x18b)](_0x320ef9(0x15e),{'type':_0x320ef9(0x16f),'shopId':_0x59e8e6,'webhookUrl':_0x1830e7,'event':_0x36c370,'status':_0x27ff5,'responseTime':_0x3ca45e,'payload':_0x32a073});}['logShopWebhookError'](_0x5a22e8,_0x2006d7,_0x21bb6f,_0x3c996f,_0x5997f7){const _0x1b97cb=a59_0x3609a7;this['writeLog']('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x5a22e8,'webhookUrl':_0x2006d7,'event':_0x21bb6f,'error':_0x3c996f instanceof Error?{'message':_0x3c996f[_0x1b97cb(0x197)],'stack':_0x3c996f['stack']}:_0x3c996f,'payload':_0x5997f7});}['logPaymentCreated'](_0x5837b7,_0x2b7273,_0x21cde6,_0x4e027d,_0x2d5c1d){const _0x616c3d=a59_0x3609a7;this[_0x616c3d(0x18b)](_0x616c3d(0x178),{'type':_0x616c3d(0x171),'gateway':_0x5837b7,'paymentId':_0x2b7273,'shopId':_0x21cde6,'amount':_0x4e027d,'currency':_0x2d5c1d});}['logApiCall'](_0x38a222,_0x3c399e,_0x193931,_0x4cc447,_0x234c7d){const _0x3099e2=a59_0x3609a7;this[_0x3099e2(0x18b)](_0x3099e2(0x163),{'type':_0x3099e2(0x1a5),'endpoint':_0x38a222,'method':_0x3c399e,'userId':_0x193931,'userRole':_0x4cc447,'requestData':_0x234c7d});}[a59_0x3609a7(0x1a7)](){const _0x1f60b1=a59_0x3609a7;try{const _0xd63471=fs_1[_0x1f60b1(0x170)]['readdirSync'](this[_0x1f60b1(0x1a6)]),_0x44d57a=_0xd63471[_0x1f60b1(0x166)](_0x3c0dea=>_0x3c0dea[_0x1f60b1(0x16d)](_0x1f60b1(0x18c))),_0x2e6183=[...new Set(_0x44d57a[_0x1f60b1(0x179)](_0x342c30=>_0x342c30[_0x1f60b1(0x15d)]('_')[0x0]))],_0x4513ab=_0x44d57a[_0x1f60b1(0x179)](_0x156755=>{const _0x156db7=_0x1f60b1,_0x41906a=path_1[_0x156db7(0x170)][_0x156db7(0x19a)](this[_0x156db7(0x1a6)],_0x156755),_0x5b717b=fs_1[_0x156db7(0x170)]['statSync'](_0x41906a),[_0x52ed63,_0x452ef9]=_0x156755[_0x156db7(0x16a)](_0x156db7(0x18c),'')[_0x156db7(0x15d)]('_');return{'type':_0x52ed63,'date':_0x452ef9,'size':_0x5b717b[_0x156db7(0x1a1)]};})['sort']((_0x4f3f38,_0x1f6cef)=>_0x1f6cef[_0x1f60b1(0x188)][_0x1f60b1(0x186)](_0x4f3f38[_0x1f60b1(0x188)]));return{'totalFiles':_0x44d57a['length'],'logTypes':_0x2e6183,'latestLogs':_0x4513ab['slice'](0x0,0xa)};}catch(_0x451670){return console['error'](_0x1f60b1(0x160),_0x451670),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x3609a7(0x18d)](_0x31333c=0x1e){const _0x2711d1=a59_0x3609a7;try{const _0x313917=fs_1[_0x2711d1(0x170)][_0x2711d1(0x196)](this[_0x2711d1(0x1a6)]),_0x2b9224=new Date();_0x2b9224[_0x2711d1(0x161)](_0x2b9224[_0x2711d1(0x1a8)]()-_0x31333c);let _0x3f1b08=0x0;_0x313917[_0x2711d1(0x164)](_0x2e672e=>{const _0x102389=_0x2711d1;if(!_0x2e672e['endsWith'](_0x102389(0x18c)))return;const _0x3db4b9=path_1[_0x102389(0x170)][_0x102389(0x19a)](this[_0x102389(0x1a6)],_0x2e672e),_0xcc986=fs_1[_0x102389(0x170)][_0x102389(0x180)](_0x3db4b9);_0xcc986[_0x102389(0x18e)]<_0x2b9224&&(fs_1[_0x102389(0x170)][_0x102389(0x172)](_0x3db4b9),_0x3f1b08++,console[_0x102389(0x17e)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x2e672e));}),console[_0x2711d1(0x17e)](_0x2711d1(0x193)+_0x3f1b08+_0x2711d1(0x177)+_0x31333c+'\x20days)');}catch(_0x5b2413){console[_0x2711d1(0x194)]('Failed\x20to\x20clean\x20old\x20logs:',_0x5b2413);}}}exports['LoggerService']=LoggerService,exports[a59_0x3609a7(0x185)]=new LoggerService();