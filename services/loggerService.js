'use strict';function a71_0xdafb(){const _0x1746f6=['logCoinToPayStatus','payments_created','API_CALL','132CWdShQ','cointopay_errors','REQUEST','statSync','defineProperty','toISOString','loggerService','default','1776141fVxuNz','4sxLNyI','replace','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','localeCompare','Failed\x20to\x20get\x20log\x20stats:','join','\x20old\x20log\x20files\x20(older\x20than\x20','logCoinToPayError','log','RESPONSE','getLogFileName','logs','cwd','api_calls','mtime','logWhiteDomainResponse','sort','logsDir','ensureLogsDirectory','cleanOldLogs','10208640xPUjcb','ðŸ§¹\x20Cleaned\x20','logShopWebhookSent','WEBHOOK_PROCESSED','getLogStats','webhooks_received','error','forEach','split','logShopWebhookError','webhooks_processed','webhooks_errors','108155yQJIvb','__importDefault','SHOP_WEBHOOK_SENT','6247339ptxpJP','shop_webhooks_sent','ERROR','length','filter','writeLog','logWhiteDomainRequest','.log','WEBHOOK_RECEIVED','186169zSuGMC','LoggerService','8ccLqqb','ðŸ“\x20Created\x20logs\x20directory:\x20','1482603DWZtLT','white_domain_errors','endsWith','__esModule','COINTOPAY_ERROR','map','existsSync','WEBHOOK_ERROR','date','unlinkSync','Failed\x20to\x20write\x20','Failed\x20to\x20clean\x20old\x20logs:','SHOP_WEBHOOK_ERROR','752496fHWWeu','readdirSync','cointopay_status_changes','setDate','logWhiteDomainError','COINTOPAY_STATUS_CHANGE','stack','message','getDate','logWebhookError','logPaymentCreated'];a71_0xdafb=function(){return _0x1746f6;};return a71_0xdafb();}const a71_0x8236dc=a71_0xa72a;function a71_0xa72a(_0x2f671d,_0x1a42b4){_0x2f671d=_0x2f671d-0xd8;const _0xdafbfc=a71_0xdafb();let _0xa72a8f=_0xdafbfc[_0x2f671d];return _0xa72a8f;}(function(_0x2cce09,_0x4a5a6e){const _0x5c3ca4=a71_0xa72a,_0x2b1d4d=_0x2cce09();while(!![]){try{const _0x1e5f45=-parseInt(_0x5c3ca4(0x11f))/0x1+-parseInt(_0x5c3ca4(0xdc))/0x2+parseInt(_0x5c3ca4(0x123))/0x3*(-parseInt(_0x5c3ca4(0xf3))/0x4)+parseInt(_0x5c3ca4(0x113))/0x5*(-parseInt(_0x5c3ca4(0xea))/0x6)+parseInt(_0x5c3ca4(0x116))/0x7*(parseInt(_0x5c3ca4(0x121))/0x8)+parseInt(_0x5c3ca4(0xf2))/0x9+parseInt(_0x5c3ca4(0x107))/0xa;if(_0x1e5f45===_0x4a5a6e)break;else _0x2b1d4d['push'](_0x2b1d4d['shift']());}catch(_0x1068cc){_0x2b1d4d['push'](_0x2b1d4d['shift']());}}}(a71_0xdafb,0x8d28e));var __importDefault=this&&this[a71_0x8236dc(0x114)]||function(_0x10397b){const _0x39a5f1=a71_0x8236dc;return _0x10397b&&_0x10397b[_0x39a5f1(0x126)]?_0x10397b:{'default':_0x10397b};};Object[a71_0x8236dc(0xee)](exports,a71_0x8236dc(0x126),{'value':!![]}),exports[a71_0x8236dc(0xf0)]=exports[a71_0x8236dc(0x120)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x2cc601=a71_0x8236dc;this[_0x2cc601(0x104)]=path_1[_0x2cc601(0xf1)][_0x2cc601(0xf8)](process[_0x2cc601(0xff)](),_0x2cc601(0xfe)),this[_0x2cc601(0x105)]();}[a71_0x8236dc(0x105)](){const _0x295f8b=a71_0x8236dc;!fs_1['default'][_0x295f8b(0x129)](this[_0x295f8b(0x104)])&&(fs_1[_0x295f8b(0xf1)]['mkdirSync'](this[_0x295f8b(0x104)],{'recursive':!![]}),console['log'](_0x295f8b(0x122)+this[_0x295f8b(0x104)]));}[a71_0x8236dc(0xfd)](_0x16dea1){const _0xdcebc9=a71_0x8236dc,_0x1931e6=new Date()[_0xdcebc9(0xef)]()[_0xdcebc9(0x10f)]('T')[0x0];return path_1[_0xdcebc9(0xf1)][_0xdcebc9(0xf8)](this['logsDir'],_0x16dea1+'_'+_0x1931e6+_0xdcebc9(0x11d));}['writeLog'](_0x603678,_0x74bd92){const _0x3bc458=a71_0x8236dc;try{const _0x87664f=new Date()['toISOString'](),_0x53d748={'timestamp':_0x87664f,..._0x74bd92},_0x5bc8d4=JSON['stringify'](_0x53d748)+'\x0a',_0x3467ee=this['getLogFileName'](_0x603678);fs_1['default']['appendFileSync'](_0x3467ee,_0x5bc8d4,'utf8');}catch(_0x50ce1f){console[_0x3bc458(0x10d)](_0x3bc458(0xd9)+_0x603678+'\x20log:',_0x50ce1f);}}[a71_0x8236dc(0x11c)](_0x2e2c5f,_0x1b3d66,_0x53d064,_0x499a47){const _0x36b318=a71_0x8236dc;this[_0x36b318(0x11b)]('white_domain_requests',{'type':_0x36b318(0xec),'gateway':_0x2e2c5f,'endpoint':_0x1b3d66,'method':_0x53d064,'data':_0x499a47});}[a71_0x8236dc(0x102)](_0x244b88,_0x3ea095,_0x5be99d,_0x5e43b8,_0x3ab3fe){const _0x2da720=a71_0x8236dc;this[_0x2da720(0x11b)]('white_domain_responses',{'type':_0x2da720(0xfc),'gateway':_0x244b88,'endpoint':_0x3ea095,'status':_0x5be99d,'responseTime':_0x3ab3fe,'data':_0x5e43b8});}[a71_0x8236dc(0xe0)](_0x4f9c58,_0xfd0d6c,_0x48448b){const _0xe76c0=a71_0x8236dc;this['writeLog'](_0xe76c0(0x124),{'type':_0xe76c0(0x118),'gateway':_0x4f9c58,'endpoint':_0xfd0d6c,'error':_0x48448b instanceof Error?{'message':_0x48448b[_0xe76c0(0xe3)],'stack':_0x48448b[_0xe76c0(0xe2)]}:_0x48448b});}['logWebhookReceived'](_0x237875,_0x57adeb,_0x23a07b){const _0x239803=a71_0x8236dc;this[_0x239803(0x11b)](_0x239803(0x10c),{'type':_0x239803(0x11e),'gateway':_0x237875,'headers':_0x23a07b,'data':_0x57adeb});}['logWebhookProcessed'](_0x68d7df,_0x3cb905,_0x551968,_0x4586d9,_0xca8a1c){const _0x3a1cbb=a71_0x8236dc;this[_0x3a1cbb(0x11b)](_0x3a1cbb(0x111),{'type':_0x3a1cbb(0x10a),'gateway':_0x68d7df,'paymentId':_0x3cb905,'oldStatus':_0x551968,'newStatus':_0x4586d9,'originalData':_0xca8a1c});}[a71_0x8236dc(0xe5)](_0x5ebeaf,_0x99fca2,_0x377d48){const _0x3e21af=a71_0x8236dc;this['writeLog'](_0x3e21af(0x112),{'type':_0x3e21af(0x12a),'gateway':_0x5ebeaf,'error':_0x99fca2 instanceof Error?{'message':_0x99fca2['message'],'stack':_0x99fca2['stack']}:_0x99fca2,'originalData':_0x377d48});}[a71_0x8236dc(0xe7)](_0xebda0){const _0x13ae90=a71_0x8236dc;this[_0x13ae90(0x11b)](_0x13ae90(0xde),{'type':_0x13ae90(0xe1),..._0xebda0});}[a71_0x8236dc(0xfa)](_0x593036){const _0x203331=a71_0x8236dc;this[_0x203331(0x11b)](_0x203331(0xeb),{'type':_0x203331(0x127),..._0x593036});}[a71_0x8236dc(0x109)](_0x592624,_0x3810ec,_0x125ec9,_0x590d9d,_0x3b3e0f,_0x1e5c56){const _0x2f8928=a71_0x8236dc;this[_0x2f8928(0x11b)](_0x2f8928(0x117),{'type':_0x2f8928(0x115),'shopId':_0x592624,'webhookUrl':_0x3810ec,'event':_0x125ec9,'status':_0x590d9d,'responseTime':_0x3b3e0f,'payload':_0x1e5c56});}[a71_0x8236dc(0x110)](_0x2fcb20,_0x1e2c51,_0x2151b4,_0x23fc46,_0x45627e){const _0x3f06bb=a71_0x8236dc;this['writeLog']('shop_webhooks_errors',{'type':_0x3f06bb(0xdb),'shopId':_0x2fcb20,'webhookUrl':_0x1e2c51,'event':_0x2151b4,'error':_0x23fc46 instanceof Error?{'message':_0x23fc46[_0x3f06bb(0xe3)],'stack':_0x23fc46[_0x3f06bb(0xe2)]}:_0x23fc46,'payload':_0x45627e});}[a71_0x8236dc(0xe6)](_0x1e10dd,_0x255379,_0x3dfb2e,_0x690338,_0x5689cf){const _0x580832=a71_0x8236dc;this[_0x580832(0x11b)](_0x580832(0xe8),{'type':'PAYMENT_CREATED','gateway':_0x1e10dd,'paymentId':_0x255379,'shopId':_0x3dfb2e,'amount':_0x690338,'currency':_0x5689cf});}['logApiCall'](_0x5d542c,_0x52f5a0,_0x210e95,_0xf756a0,_0x129686){const _0x52098e=a71_0x8236dc;this[_0x52098e(0x11b)](_0x52098e(0x100),{'type':_0x52098e(0xe9),'endpoint':_0x5d542c,'method':_0x52f5a0,'userId':_0x210e95,'userRole':_0xf756a0,'requestData':_0x129686});}[a71_0x8236dc(0x10b)](){const _0x33ee82=a71_0x8236dc;try{const _0x24cd4c=fs_1['default']['readdirSync'](this['logsDir']),_0x59eef0=_0x24cd4c[_0x33ee82(0x11a)](_0x417828=>_0x417828['endsWith'](_0x33ee82(0x11d))),_0x88a8d0=[...new Set(_0x59eef0[_0x33ee82(0x128)](_0x453787=>_0x453787[_0x33ee82(0x10f)]('_')[0x0]))],_0x5d1b44=_0x59eef0['map'](_0x4cc938=>{const _0x1e2d7f=_0x33ee82,_0x5b3ee1=path_1[_0x1e2d7f(0xf1)][_0x1e2d7f(0xf8)](this[_0x1e2d7f(0x104)],_0x4cc938),_0x539958=fs_1[_0x1e2d7f(0xf1)][_0x1e2d7f(0xed)](_0x5b3ee1),[_0x510edc,_0x421e42]=_0x4cc938[_0x1e2d7f(0xf4)]('.log','')[_0x1e2d7f(0x10f)]('_');return{'type':_0x510edc,'date':_0x421e42,'size':_0x539958['size']};})[_0x33ee82(0x103)]((_0x36a0f7,_0x37f7ad)=>_0x37f7ad['date'][_0x33ee82(0xf6)](_0x36a0f7[_0x33ee82(0x12b)]));return{'totalFiles':_0x59eef0[_0x33ee82(0x119)],'logTypes':_0x88a8d0,'latestLogs':_0x5d1b44['slice'](0x0,0xa)};}catch(_0xd7bc03){return console[_0x33ee82(0x10d)](_0x33ee82(0xf7),_0xd7bc03),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a71_0x8236dc(0x106)](_0x259c85=0x1e){const _0x12b2eb=a71_0x8236dc;try{const _0x26752c=fs_1[_0x12b2eb(0xf1)][_0x12b2eb(0xdd)](this[_0x12b2eb(0x104)]),_0x940cae=new Date();_0x940cae[_0x12b2eb(0xdf)](_0x940cae[_0x12b2eb(0xe4)]()-_0x259c85);let _0x178376=0x0;_0x26752c[_0x12b2eb(0x10e)](_0x39fecc=>{const _0x32bd9e=_0x12b2eb;if(!_0x39fecc[_0x32bd9e(0x125)](_0x32bd9e(0x11d)))return;const _0x4bcbf7=path_1[_0x32bd9e(0xf1)]['join'](this[_0x32bd9e(0x104)],_0x39fecc),_0x4abc16=fs_1[_0x32bd9e(0xf1)][_0x32bd9e(0xed)](_0x4bcbf7);_0x4abc16[_0x32bd9e(0x101)]<_0x940cae&&(fs_1['default'][_0x32bd9e(0xd8)](_0x4bcbf7),_0x178376++,console[_0x32bd9e(0xfb)](_0x32bd9e(0xf5)+_0x39fecc));}),console['log'](_0x12b2eb(0x108)+_0x178376+_0x12b2eb(0xf9)+_0x259c85+'\x20days)');}catch(_0x4f0443){console[_0x12b2eb(0x10d)](_0x12b2eb(0xda),_0x4f0443);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();