'use strict';const a48_0x1d4618=a48_0x5a85;(function(_0x498f94,_0x3d8718){const _0x1e1a29=a48_0x5a85,_0x33a9d6=_0x498f94();while(!![]){try{const _0x223041=-parseInt(_0x1e1a29(0xaa))/0x1+parseInt(_0x1e1a29(0x9e))/0x2*(parseInt(_0x1e1a29(0xb1))/0x3)+parseInt(_0x1e1a29(0x8e))/0x4*(parseInt(_0x1e1a29(0x96))/0x5)+parseInt(_0x1e1a29(0xc4))/0x6*(-parseInt(_0x1e1a29(0xa0))/0x7)+-parseInt(_0x1e1a29(0xbb))/0x8*(-parseInt(_0x1e1a29(0xd8))/0x9)+-parseInt(_0x1e1a29(0x92))/0xa+parseInt(_0x1e1a29(0xd0))/0xb*(parseInt(_0x1e1a29(0x9b))/0xc);if(_0x223041===_0x3d8718)break;else _0x33a9d6['push'](_0x33a9d6['shift']());}catch(_0x42d93b){_0x33a9d6['push'](_0x33a9d6['shift']());}}}(a48_0x25ab,0x2666e));var __importDefault=this&&this[a48_0x1d4618(0x93)]||function(_0x14a243){const _0x55f9c9=a48_0x1d4618;return _0x14a243&&_0x14a243[_0x55f9c9(0xce)]?_0x14a243:{'default':_0x14a243};};Object['defineProperty'](exports,a48_0x1d4618(0xce),{'value':!![]}),exports[a48_0x1d4618(0xbe)]=exports[a48_0x1d4618(0xc6)]=void 0x0;function a48_0x5a85(_0x34cb98,_0x1f72e4){const _0x25ab86=a48_0x25ab();return a48_0x5a85=function(_0x5a8570,_0x1588b7){_0x5a8570=_0x5a8570-0x8c;let _0x361b08=_0x25ab86[_0x5a8570];return _0x361b08;},a48_0x5a85(_0x34cb98,_0x1f72e4);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x1d4618(0xc1)));class LoggerService{constructor(){const _0x9a85b4=a48_0x1d4618;this['logsDir']=path_1[_0x9a85b4(0x94)][_0x9a85b4(0x95)](process[_0x9a85b4(0xb7)](),_0x9a85b4(0xcc)),this['ensureLogsDirectory']();}[a48_0x1d4618(0xae)](){const _0x56d5b7=a48_0x1d4618;!fs_1[_0x56d5b7(0x94)]['existsSync'](this[_0x56d5b7(0x98)])&&(fs_1[_0x56d5b7(0x94)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x56d5b7(0xb2)](_0x56d5b7(0x8c)+this[_0x56d5b7(0x98)]));}['getLogFileName'](_0x5bfecf){const _0x285ede=a48_0x1d4618,_0x38e44e=new Date()['toISOString']()[_0x285ede(0xd3)]('T')[0x0];return path_1[_0x285ede(0x94)][_0x285ede(0x95)](this['logsDir'],_0x5bfecf+'_'+_0x38e44e+_0x285ede(0x99));}[a48_0x1d4618(0xa1)](_0x44946d,_0x1b2309){const _0x1c8245=a48_0x1d4618;try{const _0x715c05=new Date()[_0x1c8245(0x9d)](),_0x1aff88={'timestamp':_0x715c05,..._0x1b2309},_0x314db6=JSON[_0x1c8245(0xa8)](_0x1aff88)+'\x0a',_0x121329=this['getLogFileName'](_0x44946d);fs_1['default'][_0x1c8245(0xa4)](_0x121329,_0x314db6,_0x1c8245(0xa9));}catch(_0x2ac6c7){console['error']('Failed\x20to\x20write\x20'+_0x44946d+_0x1c8245(0xb9),_0x2ac6c7);}}[a48_0x1d4618(0xb8)](_0x564b21,_0x46684e,_0x1fbe81,_0x32b4ea){const _0x499578=a48_0x1d4618;this['writeLog'](_0x499578(0xb6),{'type':'REQUEST','gateway':_0x564b21,'endpoint':_0x46684e,'method':_0x1fbe81,'data':_0x32b4ea});}['logWhiteDomainResponse'](_0x3ea970,_0x2fae31,_0x16b3e4,_0x3c7f03,_0x2a86c6){const _0x52b511=a48_0x1d4618;this['writeLog'](_0x52b511(0xa3),{'type':_0x52b511(0xcd),'gateway':_0x3ea970,'endpoint':_0x2fae31,'status':_0x16b3e4,'responseTime':_0x2a86c6,'data':_0x3c7f03});}[a48_0x1d4618(0xd5)](_0x52f9da,_0x4a03c7,_0x553437){const _0x474874=a48_0x1d4618;this['writeLog'](_0x474874(0xdb),{'type':_0x474874(0x9c),'gateway':_0x52f9da,'endpoint':_0x4a03c7,'error':_0x553437 instanceof Error?{'message':_0x553437['message'],'stack':_0x553437[_0x474874(0xa7)]}:_0x553437});}[a48_0x1d4618(0xaf)](_0x2e7b91,_0x256492,_0xfa4362){const _0x2ca6a3=a48_0x1d4618;this[_0x2ca6a3(0xa1)]('webhooks_received',{'type':_0x2ca6a3(0xbd),'gateway':_0x2e7b91,'headers':_0xfa4362,'data':_0x256492});}['logWebhookProcessed'](_0x4d1764,_0x299d75,_0x467f42,_0x2e5098,_0x2d0661){const _0x254a17=a48_0x1d4618;this[_0x254a17(0xa1)]('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x4d1764,'paymentId':_0x299d75,'oldStatus':_0x467f42,'newStatus':_0x2e5098,'originalData':_0x2d0661});}[a48_0x1d4618(0xcf)](_0x36b24d,_0x36f14f,_0x510388){const _0x3484fe=a48_0x1d4618;this[_0x3484fe(0xa1)]('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x36b24d,'error':_0x36f14f instanceof Error?{'message':_0x36f14f[_0x3484fe(0xc2)],'stack':_0x36f14f[_0x3484fe(0xa7)]}:_0x36f14f,'originalData':_0x510388});}[a48_0x1d4618(0xab)](_0x1a1de3){const _0x3285b3=a48_0x1d4618;this[_0x3285b3(0xa1)](_0x3285b3(0xb4),{'type':_0x3285b3(0xd6),..._0x1a1de3});}[a48_0x1d4618(0xc9)](_0x4cd80b){const _0x1cdccd=a48_0x1d4618;this[_0x1cdccd(0xa1)]('cointopay_errors',{'type':_0x1cdccd(0x9f),..._0x4cd80b});}[a48_0x1d4618(0xc0)](_0x861cd7,_0x516dca,_0x5605b9,_0x4907fa,_0x2f78b1,_0x11e0e6){const _0x480ac1=a48_0x1d4618;this['writeLog'](_0x480ac1(0xd1),{'type':_0x480ac1(0xd2),'shopId':_0x861cd7,'webhookUrl':_0x516dca,'event':_0x5605b9,'status':_0x4907fa,'responseTime':_0x2f78b1,'payload':_0x11e0e6});}['logShopWebhookError'](_0x623118,_0x3a081c,_0x58dd0b,_0x265ad6,_0x4da0c1){const _0x23e3c2=a48_0x1d4618;this[_0x23e3c2(0xa1)]('shop_webhooks_errors',{'type':_0x23e3c2(0xb3),'shopId':_0x623118,'webhookUrl':_0x3a081c,'event':_0x58dd0b,'error':_0x265ad6 instanceof Error?{'message':_0x265ad6[_0x23e3c2(0xc2)],'stack':_0x265ad6['stack']}:_0x265ad6,'payload':_0x4da0c1});}[a48_0x1d4618(0xa6)](_0x3eacad,_0x309ef4,_0x18330b,_0x10f8e5,_0x3e3a74){const _0x308182=a48_0x1d4618;this[_0x308182(0xa1)](_0x308182(0xa2),{'type':_0x308182(0xd4),'gateway':_0x3eacad,'paymentId':_0x309ef4,'shopId':_0x18330b,'amount':_0x10f8e5,'currency':_0x3e3a74});}[a48_0x1d4618(0xa5)](_0x7d8817,_0x927af8,_0x7b9536,_0x349311,_0x2a20be){const _0x2e9516=a48_0x1d4618;this[_0x2e9516(0xa1)]('api_calls',{'type':_0x2e9516(0xbf),'endpoint':_0x7d8817,'method':_0x927af8,'userId':_0x7b9536,'userRole':_0x349311,'requestData':_0x2a20be});}[a48_0x1d4618(0xcb)](){const _0x106d8e=a48_0x1d4618;try{const _0x2fe605=fs_1[_0x106d8e(0x94)]['readdirSync'](this['logsDir']),_0x4ed433=_0x2fe605[_0x106d8e(0xd7)](_0xeaba54=>_0xeaba54['endsWith'](_0x106d8e(0x99))),_0x1d1e23=[...new Set(_0x4ed433[_0x106d8e(0x8d)](_0x13e9c4=>_0x13e9c4[_0x106d8e(0xd3)]('_')[0x0]))],_0x193fa9=_0x4ed433['map'](_0x1bffae=>{const _0x52725a=_0x106d8e,_0x5c8363=path_1['default'][_0x52725a(0x95)](this[_0x52725a(0x98)],_0x1bffae),_0x5c98e9=fs_1[_0x52725a(0x94)][_0x52725a(0xad)](_0x5c8363),[_0x3408fa,_0x364fb1]=_0x1bffae[_0x52725a(0xac)](_0x52725a(0x99),'')[_0x52725a(0xd3)]('_');return{'type':_0x3408fa,'date':_0x364fb1,'size':_0x5c98e9[_0x52725a(0xbc)]};})[_0x106d8e(0x8f)]((_0x30870d,_0x52b506)=>_0x52b506[_0x106d8e(0x97)][_0x106d8e(0xb5)](_0x30870d['date']));return{'totalFiles':_0x4ed433[_0x106d8e(0xc3)],'logTypes':_0x1d1e23,'latestLogs':_0x193fa9[_0x106d8e(0x91)](0x0,0xa)};}catch(_0xb44cf2){return console[_0x106d8e(0xb0)]('Failed\x20to\x20get\x20log\x20stats:',_0xb44cf2),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x5e6021=0x1e){const _0x52d245=a48_0x1d4618;try{const _0xdb952c=fs_1[_0x52d245(0x94)][_0x52d245(0x9a)](this[_0x52d245(0x98)]),_0x14da45=new Date();_0x14da45[_0x52d245(0x90)](_0x14da45[_0x52d245(0xc8)]()-_0x5e6021);let _0x4736a5=0x0;_0xdb952c[_0x52d245(0xca)](_0x3ac606=>{const _0x445e4a=_0x52d245;if(!_0x3ac606['endsWith'](_0x445e4a(0x99)))return;const _0xd13915=path_1[_0x445e4a(0x94)][_0x445e4a(0x95)](this[_0x445e4a(0x98)],_0x3ac606),_0x3a6f1f=fs_1['default'][_0x445e4a(0xad)](_0xd13915);_0x3a6f1f[_0x445e4a(0xda)]<_0x14da45&&(fs_1[_0x445e4a(0x94)]['unlinkSync'](_0xd13915),_0x4736a5++,console[_0x445e4a(0xb2)](_0x445e4a(0xc7)+_0x3ac606));}),console[_0x52d245(0xb2)](_0x52d245(0xc5)+_0x4736a5+_0x52d245(0xba)+_0x5e6021+_0x52d245(0xd9));}catch(_0x2c7fbb){console[_0x52d245(0xb0)]('Failed\x20to\x20clean\x20old\x20logs:',_0x2c7fbb);}}}exports[a48_0x1d4618(0xc6)]=LoggerService,exports[a48_0x1d4618(0xbe)]=new LoggerService();function a48_0x25ab(){const _0x529b03=['length','12aFCZIt','🧹\x20Cleaned\x20','LoggerService','🗑️\x20Deleted\x20old\x20log\x20file:\x20','getDate','logCoinToPayError','forEach','getLogStats','logs','RESPONSE','__esModule','logWebhookError','3047eZykBL','shop_webhooks_sent','SHOP_WEBHOOK_SENT','split','PAYMENT_CREATED','logWhiteDomainError','COINTOPAY_STATUS_CHANGE','filter','240390fFAqeE','\x20days)','mtime','white_domain_errors','📁\x20Created\x20logs\x20directory:\x20','map','90224nqeTDi','sort','setDate','slice','487120WMBFZK','__importDefault','default','join','35OvDBWh','date','logsDir','.log','readdirSync','18588mybKsM','ERROR','toISOString','410pzXUzm','COINTOPAY_ERROR','847287TUJcKN','writeLog','payments_created','white_domain_responses','appendFileSync','logApiCall','logPaymentCreated','stack','stringify','utf8','198592gjlSTz','logCoinToPayStatus','replace','statSync','ensureLogsDirectory','logWebhookReceived','error','483hPudtd','log','SHOP_WEBHOOK_ERROR','cointopay_status_changes','localeCompare','white_domain_requests','cwd','logWhiteDomainRequest','\x20log:','\x20old\x20log\x20files\x20(older\x20than\x20','8JqKpHs','size','WEBHOOK_RECEIVED','loggerService','API_CALL','logShopWebhookSent','path','message'];a48_0x25ab=function(){return _0x529b03;};return a48_0x25ab();}