'use strict';const a47_0x1606e4=a47_0x439c;(function(_0x3c1c1b,_0x1ab2bb){const _0x31a4e7=a47_0x439c,_0x2e7a4f=_0x3c1c1b();while(!![]){try{const _0x23436a=parseInt(_0x31a4e7(0x10a))/0x1*(-parseInt(_0x31a4e7(0x107))/0x2)+parseInt(_0x31a4e7(0xeb))/0x3*(-parseInt(_0x31a4e7(0xf1))/0x4)+parseInt(_0x31a4e7(0xc1))/0x5*(parseInt(_0x31a4e7(0xcf))/0x6)+-parseInt(_0x31a4e7(0xfb))/0x7*(parseInt(_0x31a4e7(0x110))/0x8)+parseInt(_0x31a4e7(0xe6))/0x9*(-parseInt(_0x31a4e7(0x101))/0xa)+parseInt(_0x31a4e7(0xd8))/0xb*(-parseInt(_0x31a4e7(0xe0))/0xc)+-parseInt(_0x31a4e7(0xfe))/0xd*(-parseInt(_0x31a4e7(0xd2))/0xe);if(_0x23436a===_0x1ab2bb)break;else _0x2e7a4f['push'](_0x2e7a4f['shift']());}catch(_0xd941e2){_0x2e7a4f['push'](_0x2e7a4f['shift']());}}}(a47_0x7add,0xa7c49));var __importDefault=this&&this[a47_0x1606e4(0xc3)]||function(_0xfe021e){const _0x131914=a47_0x1606e4;return _0xfe021e&&_0xfe021e[_0x131914(0xc4)]?_0xfe021e:{'default':_0xfe021e};};Object['defineProperty'](exports,a47_0x1606e4(0xc4),{'value':!![]}),exports[a47_0x1606e4(0xf5)]=exports[a47_0x1606e4(0xd4)]=void 0x0;function a47_0x439c(_0x1c185e,_0x5dbbcd){const _0x7added=a47_0x7add();return a47_0x439c=function(_0x439cbb,_0x1a2317){_0x439cbb=_0x439cbb-0xbd;let _0x251f80=_0x7added[_0x439cbb];return _0x251f80;},a47_0x439c(_0x1c185e,_0x5dbbcd);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a47_0x1606e4(0xc6)));function a47_0x7add(){const _0x41c933=['WEBHOOK_PROCESSED','filter','.log','SHOP_WEBHOOK_SENT','642upDxCo','size','log','2995AZkBEe','🗑️\x20Deleted\x20old\x20log\x20file:\x20','toISOString','logPaymentCreated','logWebhookReceived','default','79760MhUApx','message','\x20log:','white_domain_requests','sort','slice','cointopay_status_changes','date','mtime','5LCkxLC','map','__importDefault','__esModule','existsSync','path','REQUEST','webhooks_received','ensureLogsDirectory','shop_webhooks_sent','logs','statSync','logCoinToPayError','ERROR','3008598WmByob','📁\x20Created\x20logs\x20directory:\x20','logWhiteDomainRequest','192094kXkujL','Failed\x20to\x20write\x20','LoggerService','logWebhookError','\x20old\x20log\x20files\x20(older\x20than\x20','length','514129tUjXLU','logWebhookProcessed','🧹\x20Cleaned\x20','WEBHOOK_RECEIVED','logWhiteDomainResponse','readdirSync','logApiCall','SHOP_WEBHOOK_ERROR','108wwIgyE','cointopay_errors','Failed\x20to\x20get\x20log\x20stats:','getLogStats','API_CALL','unlinkSync','109899jXKfiZ','split','join','WEBHOOK_ERROR','logsDir','3156uNGcZe','forEach','PAYMENT_CREATED','getLogFileName','white_domain_responses','webhooks_processed','2672xViVpL','webhooks_errors','writeLog','api_calls','loggerService','endsWith','COINTOPAY_STATUS_CHANGE','COINTOPAY_ERROR','RESPONSE','white_domain_errors','203UjbBii','logCoinToPayStatus','utf8','2483TvzuTE','payments_created','stack','50YnjMbR','appendFileSync'];a47_0x7add=function(){return _0x41c933;};return a47_0x7add();}class LoggerService{constructor(){const _0x259b98=a47_0x1606e4;this['logsDir']=path_1[_0x259b98(0x10f)]['join'](process['cwd'](),_0x259b98(0xcb)),this[_0x259b98(0xc9)]();}['ensureLogsDirectory'](){const _0x11f0af=a47_0x1606e4;!fs_1['default'][_0x11f0af(0xc5)](this[_0x11f0af(0xea)])&&(fs_1[_0x11f0af(0x10f)]['mkdirSync'](this[_0x11f0af(0xea)],{'recursive':!![]}),console[_0x11f0af(0x109)](_0x11f0af(0xd0)+this[_0x11f0af(0xea)]));}['getLogFileName'](_0x41c418){const _0x3f809f=a47_0x1606e4,_0x1282cd=new Date()[_0x3f809f(0x10c)]()[_0x3f809f(0xe7)]('T')[0x0];return path_1['default'][_0x3f809f(0xe8)](this[_0x3f809f(0xea)],_0x41c418+'_'+_0x1282cd+_0x3f809f(0x105));}[a47_0x1606e4(0xf3)](_0x176ed2,_0x2a8bb1){const _0x1154fb=a47_0x1606e4;try{const _0x5ad7df=new Date()[_0x1154fb(0x10c)](),_0x4713f7={'timestamp':_0x5ad7df,..._0x2a8bb1},_0x58feff=JSON['stringify'](_0x4713f7)+'\x0a',_0x828506=this[_0x1154fb(0xee)](_0x176ed2);fs_1[_0x1154fb(0x10f)][_0x1154fb(0x102)](_0x828506,_0x58feff,_0x1154fb(0xfd));}catch(_0x4130d7){console['error'](_0x1154fb(0xd3)+_0x176ed2+_0x1154fb(0x112),_0x4130d7);}}[a47_0x1606e4(0xd1)](_0x366d4f,_0x381bd7,_0x5e3dbf,_0x20c866){const _0x454460=a47_0x1606e4;this['writeLog'](_0x454460(0x113),{'type':_0x454460(0xc7),'gateway':_0x366d4f,'endpoint':_0x381bd7,'method':_0x5e3dbf,'data':_0x20c866});}[a47_0x1606e4(0xdc)](_0x15b372,_0x32eaf8,_0x6d75dc,_0x33f85f,_0x859721){const _0x9cbf3c=a47_0x1606e4;this['writeLog'](_0x9cbf3c(0xef),{'type':_0x9cbf3c(0xf9),'gateway':_0x15b372,'endpoint':_0x32eaf8,'status':_0x6d75dc,'responseTime':_0x859721,'data':_0x33f85f});}['logWhiteDomainError'](_0x15a7a1,_0x358b3e,_0x52f773){const _0x399488=a47_0x1606e4;this[_0x399488(0xf3)](_0x399488(0xfa),{'type':_0x399488(0xce),'gateway':_0x15a7a1,'endpoint':_0x358b3e,'error':_0x52f773 instanceof Error?{'message':_0x52f773[_0x399488(0x111)],'stack':_0x52f773[_0x399488(0x100)]}:_0x52f773});}[a47_0x1606e4(0x10e)](_0x516ef2,_0x312878,_0x20e9cf){const _0x2d18fc=a47_0x1606e4;this[_0x2d18fc(0xf3)](_0x2d18fc(0xc8),{'type':_0x2d18fc(0xdb),'gateway':_0x516ef2,'headers':_0x20e9cf,'data':_0x312878});}[a47_0x1606e4(0xd9)](_0x479357,_0x399feb,_0x1db38e,_0x38b9c5,_0x980701){const _0x366320=a47_0x1606e4;this[_0x366320(0xf3)](_0x366320(0xf0),{'type':_0x366320(0x103),'gateway':_0x479357,'paymentId':_0x399feb,'oldStatus':_0x1db38e,'newStatus':_0x38b9c5,'originalData':_0x980701});}[a47_0x1606e4(0xd5)](_0x5281c4,_0x5e7fdc,_0x430afd){const _0x20f304=a47_0x1606e4;this[_0x20f304(0xf3)](_0x20f304(0xf2),{'type':_0x20f304(0xe9),'gateway':_0x5281c4,'error':_0x5e7fdc instanceof Error?{'message':_0x5e7fdc['message'],'stack':_0x5e7fdc[_0x20f304(0x100)]}:_0x5e7fdc,'originalData':_0x430afd});}[a47_0x1606e4(0xfc)](_0xff4282){const _0x3d1876=a47_0x1606e4;this[_0x3d1876(0xf3)](_0x3d1876(0xbe),{'type':_0x3d1876(0xf7),..._0xff4282});}[a47_0x1606e4(0xcd)](_0x6723dd){const _0x58a410=a47_0x1606e4;this[_0x58a410(0xf3)](_0x58a410(0xe1),{'type':_0x58a410(0xf8),..._0x6723dd});}['logShopWebhookSent'](_0xd17cdf,_0x204056,_0x51de63,_0x59dbc9,_0x3f8a7e,_0x5aa944){const _0x48ebe4=a47_0x1606e4;this[_0x48ebe4(0xf3)](_0x48ebe4(0xca),{'type':_0x48ebe4(0x106),'shopId':_0xd17cdf,'webhookUrl':_0x204056,'event':_0x51de63,'status':_0x59dbc9,'responseTime':_0x3f8a7e,'payload':_0x5aa944});}['logShopWebhookError'](_0x4223de,_0x46da6a,_0x377322,_0x3969e1,_0x22c6be){const _0x1f95b0=a47_0x1606e4;this[_0x1f95b0(0xf3)]('shop_webhooks_errors',{'type':_0x1f95b0(0xdf),'shopId':_0x4223de,'webhookUrl':_0x46da6a,'event':_0x377322,'error':_0x3969e1 instanceof Error?{'message':_0x3969e1[_0x1f95b0(0x111)],'stack':_0x3969e1[_0x1f95b0(0x100)]}:_0x3969e1,'payload':_0x22c6be});}[a47_0x1606e4(0x10d)](_0xd560ce,_0x297238,_0x5c5ab0,_0x387775,_0x590d1c){const _0x39b639=a47_0x1606e4;this[_0x39b639(0xf3)](_0x39b639(0xff),{'type':_0x39b639(0xed),'gateway':_0xd560ce,'paymentId':_0x297238,'shopId':_0x5c5ab0,'amount':_0x387775,'currency':_0x590d1c});}[a47_0x1606e4(0xde)](_0xd18e04,_0x8521f6,_0x4e5220,_0x37c662,_0xe86470){const _0x30ae50=a47_0x1606e4;this[_0x30ae50(0xf3)](_0x30ae50(0xf4),{'type':_0x30ae50(0xe4),'endpoint':_0xd18e04,'method':_0x8521f6,'userId':_0x4e5220,'userRole':_0x37c662,'requestData':_0xe86470});}[a47_0x1606e4(0xe3)](){const _0x1fd433=a47_0x1606e4;try{const _0x2bd827=fs_1[_0x1fd433(0x10f)][_0x1fd433(0xdd)](this[_0x1fd433(0xea)]),_0x2810ec=_0x2bd827[_0x1fd433(0x104)](_0x44e55a=>_0x44e55a[_0x1fd433(0xf6)](_0x1fd433(0x105))),_0x43e477=[...new Set(_0x2810ec[_0x1fd433(0xc2)](_0x3cbaf9=>_0x3cbaf9['split']('_')[0x0]))],_0x2f6b42=_0x2810ec[_0x1fd433(0xc2)](_0x562490=>{const _0x2fc6bd=_0x1fd433,_0x139f9a=path_1[_0x2fc6bd(0x10f)][_0x2fc6bd(0xe8)](this[_0x2fc6bd(0xea)],_0x562490),_0x296381=fs_1[_0x2fc6bd(0x10f)][_0x2fc6bd(0xcc)](_0x139f9a),[_0x98d810,_0x54f2d8]=_0x562490['replace'](_0x2fc6bd(0x105),'')[_0x2fc6bd(0xe7)]('_');return{'type':_0x98d810,'date':_0x54f2d8,'size':_0x296381[_0x2fc6bd(0x108)]};})[_0x1fd433(0x114)]((_0x439807,_0x2e0de3)=>_0x2e0de3['date']['localeCompare'](_0x439807[_0x1fd433(0xbf)]));return{'totalFiles':_0x2810ec[_0x1fd433(0xd7)],'logTypes':_0x43e477,'latestLogs':_0x2f6b42[_0x1fd433(0xbd)](0x0,0xa)};}catch(_0x5d01ab){return console['error'](_0x1fd433(0xe2),_0x5d01ab),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0xa7fe5a=0x1e){const _0x407941=a47_0x1606e4;try{const _0x24ee89=fs_1[_0x407941(0x10f)][_0x407941(0xdd)](this[_0x407941(0xea)]),_0x4be007=new Date();_0x4be007['setDate'](_0x4be007['getDate']()-_0xa7fe5a);let _0x25d9e3=0x0;_0x24ee89[_0x407941(0xec)](_0x427c68=>{const _0x265fe4=_0x407941;if(!_0x427c68['endsWith'](_0x265fe4(0x105)))return;const _0x51529d=path_1[_0x265fe4(0x10f)]['join'](this[_0x265fe4(0xea)],_0x427c68),_0x31666f=fs_1[_0x265fe4(0x10f)][_0x265fe4(0xcc)](_0x51529d);_0x31666f[_0x265fe4(0xc0)]<_0x4be007&&(fs_1[_0x265fe4(0x10f)][_0x265fe4(0xe5)](_0x51529d),_0x25d9e3++,console[_0x265fe4(0x109)](_0x265fe4(0x10b)+_0x427c68));}),console[_0x407941(0x109)](_0x407941(0xda)+_0x25d9e3+_0x407941(0xd6)+_0xa7fe5a+'\x20days)');}catch(_0x583e82){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x583e82);}}}exports['LoggerService']=LoggerService,exports[a47_0x1606e4(0xf5)]=new LoggerService();