'use strict';const a56_0x25b967=a56_0x181b;function a56_0x388d(){const _0x522dbb=['__esModule','size','581583GdKZUM','RESPONSE','logs','cointopay_status_changes','__importDefault','endsWith','white_domain_requests','6uPXjoB','logCoinToPayError','logApiCall','webhooks_received','mtime','logShopWebhookSent','.log','Failed\x20to\x20get\x20log\x20stats:','stringify','logWebhookReceived','21IVgrDn','cleanOldLogs','13731903NPdTdE','logShopWebhookError','logCoinToPayStatus','white_domain_errors','🧹\x20Cleaned\x20','statSync','API_CALL','ensureLogsDirectory','\x20log:','webhooks_processed','utf8','webhooks_errors','loggerService','white_domain_responses','740859mRcisY','error','1921952AUpPlT','log','existsSync','getLogFileName','default','join','WEBHOOK_RECEIVED','appendFileSync','shop_webhooks_sent','logsDir','1714000EeGgPh','shop_webhooks_errors','cointopay_errors','18440yOXaCQ','getDate','replace','logWhiteDomainError','📁\x20Created\x20logs\x20directory:\x20','logPaymentCreated','WEBHOOK_ERROR','COINTOPAY_ERROR','stack','3462850rGlruE','forEach','getLogStats','path','sort','SHOP_WEBHOOK_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','LoggerService','payments_created','date','readdirSync','writeLog','toISOString','PAYMENT_CREATED','\x20days)','Failed\x20to\x20clean\x20old\x20logs:','REQUEST','split','map','length','message'];a56_0x388d=function(){return _0x522dbb;};return a56_0x388d();}(function(_0x14fbd9,_0x4bc248){const _0xae98a3=a56_0x181b,_0x191498=_0x14fbd9();while(!![]){try{const _0x54dc4b=parseInt(_0xae98a3(0x156))/0x1+-parseInt(_0xae98a3(0x179))/0x2+-parseInt(_0xae98a3(0x167))/0x3*(parseInt(_0xae98a3(0x136))/0x4)+-parseInt(_0xae98a3(0x13f))/0x5+parseInt(_0xae98a3(0x15d))/0x6*(-parseInt(_0xae98a3(0x177))/0x7)+parseInt(_0xae98a3(0x133))/0x8+parseInt(_0xae98a3(0x169))/0x9;if(_0x54dc4b===_0x4bc248)break;else _0x191498['push'](_0x191498['shift']());}catch(_0x455841){_0x191498['push'](_0x191498['shift']());}}}(a56_0x388d,0x8161b));function a56_0x181b(_0x4b2caa,_0x311f42){const _0x388dcf=a56_0x388d();return a56_0x181b=function(_0x181bf8,_0x3a9796){_0x181bf8=_0x181bf8-0x12f;let _0x3edc3b=_0x388dcf[_0x181bf8];return _0x3edc3b;},a56_0x181b(_0x4b2caa,_0x311f42);}var __importDefault=this&&this[a56_0x25b967(0x15a)]||function(_0x3970cb){const _0xf0ddb9=a56_0x25b967;return _0x3970cb&&_0x3970cb[_0xf0ddb9(0x154)]?_0x3970cb:{'default':_0x3970cb};};Object['defineProperty'](exports,a56_0x25b967(0x154),{'value':!![]}),exports[a56_0x25b967(0x175)]=exports[a56_0x25b967(0x146)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a56_0x25b967(0x142)));class LoggerService{constructor(){const _0x2af2e0=a56_0x25b967;this['logsDir']=path_1[_0x2af2e0(0x17d)][_0x2af2e0(0x17e)](process['cwd'](),_0x2af2e0(0x158)),this[_0x2af2e0(0x170)]();}[a56_0x25b967(0x170)](){const _0x408ecf=a56_0x25b967;!fs_1[_0x408ecf(0x17d)][_0x408ecf(0x17b)](this[_0x408ecf(0x132)])&&(fs_1['default']['mkdirSync'](this[_0x408ecf(0x132)],{'recursive':!![]}),console['log'](_0x408ecf(0x13a)+this[_0x408ecf(0x132)]));}['getLogFileName'](_0x119cbc){const _0x5f5dd2=a56_0x25b967,_0x1900fb=new Date()[_0x5f5dd2(0x14b)]()[_0x5f5dd2(0x150)]('T')[0x0];return path_1[_0x5f5dd2(0x17d)][_0x5f5dd2(0x17e)](this[_0x5f5dd2(0x132)],_0x119cbc+'_'+_0x1900fb+'.log');}[a56_0x25b967(0x14a)](_0x14f95e,_0x109bc3){const _0x23568a=a56_0x25b967;try{const _0x348405=new Date()[_0x23568a(0x14b)](),_0x46b4bd={'timestamp':_0x348405,..._0x109bc3},_0x21a889=JSON[_0x23568a(0x165)](_0x46b4bd)+'\x0a',_0x3053f3=this[_0x23568a(0x17c)](_0x14f95e);fs_1['default'][_0x23568a(0x130)](_0x3053f3,_0x21a889,_0x23568a(0x173));}catch(_0x467c35){console[_0x23568a(0x178)]('Failed\x20to\x20write\x20'+_0x14f95e+_0x23568a(0x171),_0x467c35);}}['logWhiteDomainRequest'](_0x4bc091,_0x4d218d,_0x30cbb8,_0xbb39d8){const _0x2794b7=a56_0x25b967;this[_0x2794b7(0x14a)](_0x2794b7(0x15c),{'type':_0x2794b7(0x14f),'gateway':_0x4bc091,'endpoint':_0x4d218d,'method':_0x30cbb8,'data':_0xbb39d8});}['logWhiteDomainResponse'](_0x196988,_0x4ad60c,_0x4352ff,_0x37d1b7,_0x3e574b){const _0x40ed02=a56_0x25b967;this[_0x40ed02(0x14a)](_0x40ed02(0x176),{'type':_0x40ed02(0x157),'gateway':_0x196988,'endpoint':_0x4ad60c,'status':_0x4352ff,'responseTime':_0x3e574b,'data':_0x37d1b7});}[a56_0x25b967(0x139)](_0x16f063,_0x312602,_0x732527){const _0x3bb4ac=a56_0x25b967;this[_0x3bb4ac(0x14a)](_0x3bb4ac(0x16c),{'type':'ERROR','gateway':_0x16f063,'endpoint':_0x312602,'error':_0x732527 instanceof Error?{'message':_0x732527[_0x3bb4ac(0x153)],'stack':_0x732527[_0x3bb4ac(0x13e)]}:_0x732527});}[a56_0x25b967(0x166)](_0x723997,_0xf438e5,_0x180e4f){const _0x1aa663=a56_0x25b967;this['writeLog'](_0x1aa663(0x160),{'type':_0x1aa663(0x12f),'gateway':_0x723997,'headers':_0x180e4f,'data':_0xf438e5});}['logWebhookProcessed'](_0x4737cc,_0x385a1f,_0x11b5b0,_0x2d050c,_0x469573){const _0x4f7e03=a56_0x25b967;this[_0x4f7e03(0x14a)](_0x4f7e03(0x172),{'type':'WEBHOOK_PROCESSED','gateway':_0x4737cc,'paymentId':_0x385a1f,'oldStatus':_0x11b5b0,'newStatus':_0x2d050c,'originalData':_0x469573});}['logWebhookError'](_0x5ba6b0,_0xfc298d,_0x93485f){const _0x1e34c7=a56_0x25b967;this[_0x1e34c7(0x14a)](_0x1e34c7(0x174),{'type':_0x1e34c7(0x13c),'gateway':_0x5ba6b0,'error':_0xfc298d instanceof Error?{'message':_0xfc298d[_0x1e34c7(0x153)],'stack':_0xfc298d[_0x1e34c7(0x13e)]}:_0xfc298d,'originalData':_0x93485f});}[a56_0x25b967(0x16b)](_0x5b91fa){const _0x5ecd18=a56_0x25b967;this[_0x5ecd18(0x14a)](_0x5ecd18(0x159),{'type':'COINTOPAY_STATUS_CHANGE',..._0x5b91fa});}[a56_0x25b967(0x15e)](_0x3a5ff2){const _0x525f1c=a56_0x25b967;this['writeLog'](_0x525f1c(0x135),{'type':_0x525f1c(0x13d),..._0x3a5ff2});}[a56_0x25b967(0x162)](_0x464e2a,_0x38cdec,_0xf9bb13,_0x47c08f,_0x3976e2,_0x4d5dfb){const _0x10371b=a56_0x25b967;this[_0x10371b(0x14a)](_0x10371b(0x131),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x464e2a,'webhookUrl':_0x38cdec,'event':_0xf9bb13,'status':_0x47c08f,'responseTime':_0x3976e2,'payload':_0x4d5dfb});}[a56_0x25b967(0x16a)](_0xd17e26,_0x397294,_0x2e23e3,_0x47c2e1,_0x1c5c45){const _0x347035=a56_0x25b967;this[_0x347035(0x14a)](_0x347035(0x134),{'type':_0x347035(0x144),'shopId':_0xd17e26,'webhookUrl':_0x397294,'event':_0x2e23e3,'error':_0x47c2e1 instanceof Error?{'message':_0x47c2e1[_0x347035(0x153)],'stack':_0x47c2e1[_0x347035(0x13e)]}:_0x47c2e1,'payload':_0x1c5c45});}[a56_0x25b967(0x13b)](_0x4a5273,_0x2aca41,_0x925086,_0x4b560b,_0x53c3ab){const _0xd9e293=a56_0x25b967;this[_0xd9e293(0x14a)](_0xd9e293(0x147),{'type':_0xd9e293(0x14c),'gateway':_0x4a5273,'paymentId':_0x2aca41,'shopId':_0x925086,'amount':_0x4b560b,'currency':_0x53c3ab});}[a56_0x25b967(0x15f)](_0xb6a21,_0x2c64fd,_0x5a313b,_0x476252,_0x1de035){const _0x31bfb1=a56_0x25b967;this[_0x31bfb1(0x14a)]('api_calls',{'type':_0x31bfb1(0x16f),'endpoint':_0xb6a21,'method':_0x2c64fd,'userId':_0x5a313b,'userRole':_0x476252,'requestData':_0x1de035});}[a56_0x25b967(0x141)](){const _0x4a81a3=a56_0x25b967;try{const _0x2d299a=fs_1[_0x4a81a3(0x17d)]['readdirSync'](this['logsDir']),_0xeb6913=_0x2d299a['filter'](_0x4d080b=>_0x4d080b[_0x4a81a3(0x15b)]('.log')),_0x806753=[...new Set(_0xeb6913[_0x4a81a3(0x151)](_0xa477ee=>_0xa477ee['split']('_')[0x0]))],_0x40e4d1=_0xeb6913[_0x4a81a3(0x151)](_0x2353aa=>{const _0x56d270=_0x4a81a3,_0x332319=path_1[_0x56d270(0x17d)]['join'](this[_0x56d270(0x132)],_0x2353aa),_0x50abc3=fs_1[_0x56d270(0x17d)][_0x56d270(0x16e)](_0x332319),[_0x2d59d7,_0x1bf360]=_0x2353aa[_0x56d270(0x138)](_0x56d270(0x163),'')[_0x56d270(0x150)]('_');return{'type':_0x2d59d7,'date':_0x1bf360,'size':_0x50abc3[_0x56d270(0x155)]};})[_0x4a81a3(0x143)]((_0x4269aa,_0x9c7531)=>_0x9c7531[_0x4a81a3(0x148)]['localeCompare'](_0x4269aa['date']));return{'totalFiles':_0xeb6913[_0x4a81a3(0x152)],'logTypes':_0x806753,'latestLogs':_0x40e4d1['slice'](0x0,0xa)};}catch(_0x2bd483){return console[_0x4a81a3(0x178)](_0x4a81a3(0x164),_0x2bd483),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a56_0x25b967(0x168)](_0x4680f5=0x1e){const _0x39d621=a56_0x25b967;try{const _0x43eef8=fs_1['default'][_0x39d621(0x149)](this[_0x39d621(0x132)]),_0xf414a7=new Date();_0xf414a7['setDate'](_0xf414a7[_0x39d621(0x137)]()-_0x4680f5);let _0x2b6d1f=0x0;_0x43eef8[_0x39d621(0x140)](_0x275538=>{const _0x5b1ec0=_0x39d621;if(!_0x275538['endsWith'](_0x5b1ec0(0x163)))return;const _0x5dd962=path_1['default'][_0x5b1ec0(0x17e)](this[_0x5b1ec0(0x132)],_0x275538),_0x361942=fs_1[_0x5b1ec0(0x17d)]['statSync'](_0x5dd962);_0x361942[_0x5b1ec0(0x161)]<_0xf414a7&&(fs_1['default']['unlinkSync'](_0x5dd962),_0x2b6d1f++,console['log']('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x275538));}),console[_0x39d621(0x17a)](_0x39d621(0x16d)+_0x2b6d1f+_0x39d621(0x145)+_0x4680f5+_0x39d621(0x14d));}catch(_0x47149e){console[_0x39d621(0x178)](_0x39d621(0x14e),_0x47149e);}}}exports[a56_0x25b967(0x146)]=LoggerService,exports[a56_0x25b967(0x175)]=new LoggerService();