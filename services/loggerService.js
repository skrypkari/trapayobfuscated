'use strict';const a67_0x2b68af=a67_0x4880;(function(_0x3f5bd3,_0x5e22a1){const _0xb44a5e=a67_0x4880,_0x440078=_0x3f5bd3();while(!![]){try{const _0x240f13=parseInt(_0xb44a5e(0xbf))/0x1+-parseInt(_0xb44a5e(0xbe))/0x2+-parseInt(_0xb44a5e(0xb9))/0x3+parseInt(_0xb44a5e(0xb3))/0x4*(-parseInt(_0xb44a5e(0xd8))/0x5)+parseInt(_0xb44a5e(0xd5))/0x6*(parseInt(_0xb44a5e(0xe8))/0x7)+parseInt(_0xb44a5e(0xb5))/0x8*(-parseInt(_0xb44a5e(0xdc))/0x9)+-parseInt(_0xb44a5e(0xd4))/0xa*(-parseInt(_0xb44a5e(0xfd))/0xb);if(_0x240f13===_0x5e22a1)break;else _0x440078['push'](_0x440078['shift']());}catch(_0x4db8fb){_0x440078['push'](_0x440078['shift']());}}}(a67_0x803f,0x8c485));function a67_0x803f(){const _0x13a560=['Failed\x20to\x20get\x20log\x20stats:','\x20log:','utf8','message','logApiCall','logCoinToPayStatus','slice','ensureLogsDirectory','COINTOPAY_ERROR','cwd','ðŸ“\x20Created\x20logs\x20directory:\x20','logWhiteDomainResponse','error','Failed\x20to\x20clean\x20old\x20logs:','SHOP_WEBHOOK_SENT','__esModule','logCoinToPayError','75097HqmzUm','logWhiteDomainError','RESPONSE','loggerService','statSync','WEBHOOK_PROCESSED','logPaymentCreated','sort','906452WSoKxG','mkdirSync','280oGrbLK','API_CALL','.log','date','1113606fMPXAQ','webhooks_errors','forEach','shop_webhooks_sent','appendFileSync','1592750rykZuZ','160587qWFZfs','replace','stringify','\x20old\x20log\x20files\x20(older\x20than\x20','webhooks_processed','ERROR','split','logs','size','unlinkSync','LoggerService','map','white_domain_errors','stack','readdirSync','getDate','getLogFileName','logWebhookProcessed','WEBHOOK_ERROR','webhooks_received','toISOString','2830QQswHc','2022hZAnvf','logWebhookError','cointopay_status_changes','5DnOAVq','writeLog','cointopay_errors','Failed\x20to\x20write\x20','294156DGOhVl','length','PAYMENT_CREATED','__importDefault','endsWith','default','logWhiteDomainRequest','logsDir','ðŸ§¹\x20Cleaned\x20','payments_created','join','logShopWebhookError','21189MRUGkm','log','existsSync','white_domain_responses'];a67_0x803f=function(){return _0x13a560;};return a67_0x803f();}var __importDefault=this&&this[a67_0x2b68af(0xdf)]||function(_0x253e6e){const _0x3c41b9=a67_0x2b68af;return _0x253e6e&&_0x253e6e[_0x3c41b9(0xfb)]?_0x253e6e:{'default':_0x253e6e};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a67_0x2b68af(0xae)]=exports[a67_0x2b68af(0xc9)]=void 0x0;function a67_0x4880(_0x13e455,_0x571ad4){_0x13e455=_0x13e455-0xad;const _0x803f46=a67_0x803f();let _0x4880b9=_0x803f46[_0x13e455];return _0x4880b9;}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x37ce9f=a67_0x2b68af;this[_0x37ce9f(0xe3)]=path_1[_0x37ce9f(0xe1)][_0x37ce9f(0xe6)](process[_0x37ce9f(0xf5)](),_0x37ce9f(0xc6)),this[_0x37ce9f(0xf3)]();}[a67_0x2b68af(0xf3)](){const _0xb9013e=a67_0x2b68af;!fs_1[_0xb9013e(0xe1)][_0xb9013e(0xea)](this[_0xb9013e(0xe3)])&&(fs_1['default'][_0xb9013e(0xb4)](this['logsDir'],{'recursive':!![]}),console[_0xb9013e(0xe9)](_0xb9013e(0xf6)+this[_0xb9013e(0xe3)]));}[a67_0x2b68af(0xcf)](_0x3ea3a4){const _0x49bc55=a67_0x2b68af,_0x38c317=new Date()[_0x49bc55(0xd3)]()[_0x49bc55(0xc5)]('T')[0x0];return path_1[_0x49bc55(0xe1)][_0x49bc55(0xe6)](this['logsDir'],_0x3ea3a4+'_'+_0x38c317+_0x49bc55(0xb7));}[a67_0x2b68af(0xd9)](_0x15ab6c,_0x48400d){const _0x5557fd=a67_0x2b68af;try{const _0x144dc8=new Date()[_0x5557fd(0xd3)](),_0x29b9d9={'timestamp':_0x144dc8,..._0x48400d},_0x49afe8=JSON[_0x5557fd(0xc1)](_0x29b9d9)+'\x0a',_0x1966f5=this[_0x5557fd(0xcf)](_0x15ab6c);fs_1['default'][_0x5557fd(0xbd)](_0x1966f5,_0x49afe8,_0x5557fd(0xee));}catch(_0x24779c){console[_0x5557fd(0xf8)](_0x5557fd(0xdb)+_0x15ab6c+_0x5557fd(0xed),_0x24779c);}}[a67_0x2b68af(0xe2)](_0x211568,_0x49c900,_0x1b7b2f,_0x4e3168){const _0x25c694=a67_0x2b68af;this[_0x25c694(0xd9)]('white_domain_requests',{'type':'REQUEST','gateway':_0x211568,'endpoint':_0x49c900,'method':_0x1b7b2f,'data':_0x4e3168});}[a67_0x2b68af(0xf7)](_0x2ef43a,_0x5920a2,_0x53be40,_0x51996c,_0x398919){const _0x7fc9c7=a67_0x2b68af;this[_0x7fc9c7(0xd9)](_0x7fc9c7(0xeb),{'type':_0x7fc9c7(0xad),'gateway':_0x2ef43a,'endpoint':_0x5920a2,'status':_0x53be40,'responseTime':_0x398919,'data':_0x51996c});}[a67_0x2b68af(0xfe)](_0x446b33,_0xc6aa8e,_0xe11b79){const _0x30bb9b=a67_0x2b68af;this[_0x30bb9b(0xd9)](_0x30bb9b(0xcb),{'type':_0x30bb9b(0xc4),'gateway':_0x446b33,'endpoint':_0xc6aa8e,'error':_0xe11b79 instanceof Error?{'message':_0xe11b79[_0x30bb9b(0xef)],'stack':_0xe11b79[_0x30bb9b(0xcc)]}:_0xe11b79});}['logWebhookReceived'](_0x28c4d2,_0x172bee,_0x1779b4){const _0x553b93=a67_0x2b68af;this[_0x553b93(0xd9)](_0x553b93(0xd2),{'type':'WEBHOOK_RECEIVED','gateway':_0x28c4d2,'headers':_0x1779b4,'data':_0x172bee});}[a67_0x2b68af(0xd0)](_0x167660,_0x7ecffa,_0x5279f2,_0x3356b8,_0x1e7591){const _0x1f5f36=a67_0x2b68af;this[_0x1f5f36(0xd9)](_0x1f5f36(0xc3),{'type':_0x1f5f36(0xb0),'gateway':_0x167660,'paymentId':_0x7ecffa,'oldStatus':_0x5279f2,'newStatus':_0x3356b8,'originalData':_0x1e7591});}[a67_0x2b68af(0xd6)](_0x21735f,_0x3b206f,_0x14664c){const _0x527639=a67_0x2b68af;this[_0x527639(0xd9)](_0x527639(0xba),{'type':_0x527639(0xd1),'gateway':_0x21735f,'error':_0x3b206f instanceof Error?{'message':_0x3b206f[_0x527639(0xef)],'stack':_0x3b206f['stack']}:_0x3b206f,'originalData':_0x14664c});}[a67_0x2b68af(0xf1)](_0x4cde49){const _0x4e049c=a67_0x2b68af;this[_0x4e049c(0xd9)](_0x4e049c(0xd7),{'type':'COINTOPAY_STATUS_CHANGE',..._0x4cde49});}[a67_0x2b68af(0xfc)](_0x55ea29){const _0x4eef7b=a67_0x2b68af;this[_0x4eef7b(0xd9)](_0x4eef7b(0xda),{'type':_0x4eef7b(0xf4),..._0x55ea29});}['logShopWebhookSent'](_0x1b9988,_0x5de56e,_0xce39d6,_0x595c9b,_0x52a40e,_0xfc4320){const _0x2e116e=a67_0x2b68af;this[_0x2e116e(0xd9)](_0x2e116e(0xbc),{'type':_0x2e116e(0xfa),'shopId':_0x1b9988,'webhookUrl':_0x5de56e,'event':_0xce39d6,'status':_0x595c9b,'responseTime':_0x52a40e,'payload':_0xfc4320});}[a67_0x2b68af(0xe7)](_0x599da6,_0x1f10f4,_0x96a988,_0x36915e,_0x34758b){const _0xc33c60=a67_0x2b68af;this['writeLog']('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x599da6,'webhookUrl':_0x1f10f4,'event':_0x96a988,'error':_0x36915e instanceof Error?{'message':_0x36915e['message'],'stack':_0x36915e[_0xc33c60(0xcc)]}:_0x36915e,'payload':_0x34758b});}[a67_0x2b68af(0xb1)](_0x2e8bc3,_0x505a63,_0x248398,_0x14db65,_0x2db27a){const _0x472965=a67_0x2b68af;this['writeLog'](_0x472965(0xe5),{'type':_0x472965(0xde),'gateway':_0x2e8bc3,'paymentId':_0x505a63,'shopId':_0x248398,'amount':_0x14db65,'currency':_0x2db27a});}[a67_0x2b68af(0xf0)](_0x56bfd8,_0x40c355,_0x98db5b,_0x399e2e,_0x154b26){const _0x339f4b=a67_0x2b68af;this[_0x339f4b(0xd9)]('api_calls',{'type':_0x339f4b(0xb6),'endpoint':_0x56bfd8,'method':_0x40c355,'userId':_0x98db5b,'userRole':_0x399e2e,'requestData':_0x154b26});}['getLogStats'](){const _0x310125=a67_0x2b68af;try{const _0x5e57a3=fs_1['default'][_0x310125(0xcd)](this[_0x310125(0xe3)]),_0x455098=_0x5e57a3['filter'](_0x23492b=>_0x23492b[_0x310125(0xe0)](_0x310125(0xb7))),_0xe3f260=[...new Set(_0x455098[_0x310125(0xca)](_0x101a49=>_0x101a49[_0x310125(0xc5)]('_')[0x0]))],_0x1af0b4=_0x455098[_0x310125(0xca)](_0xac2c3c=>{const _0x1412ee=_0x310125,_0x375235=path_1[_0x1412ee(0xe1)]['join'](this[_0x1412ee(0xe3)],_0xac2c3c),_0x4f39a2=fs_1[_0x1412ee(0xe1)][_0x1412ee(0xaf)](_0x375235),[_0x371cd9,_0x29f5ef]=_0xac2c3c[_0x1412ee(0xc0)](_0x1412ee(0xb7),'')['split']('_');return{'type':_0x371cd9,'date':_0x29f5ef,'size':_0x4f39a2[_0x1412ee(0xc7)]};})[_0x310125(0xb2)]((_0x2dcadb,_0x20a545)=>_0x20a545[_0x310125(0xb8)]['localeCompare'](_0x2dcadb['date']));return{'totalFiles':_0x455098[_0x310125(0xdd)],'logTypes':_0xe3f260,'latestLogs':_0x1af0b4[_0x310125(0xf2)](0x0,0xa)};}catch(_0x4451c1){return console['error'](_0x310125(0xec),_0x4451c1),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x54954f=0x1e){const _0x405097=a67_0x2b68af;try{const _0x1935d1=fs_1[_0x405097(0xe1)]['readdirSync'](this['logsDir']),_0x75483=new Date();_0x75483['setDate'](_0x75483[_0x405097(0xce)]()-_0x54954f);let _0x530314=0x0;_0x1935d1[_0x405097(0xbb)](_0x38d9e2=>{const _0x644683=_0x405097;if(!_0x38d9e2[_0x644683(0xe0)]('.log'))return;const _0x38034e=path_1[_0x644683(0xe1)][_0x644683(0xe6)](this[_0x644683(0xe3)],_0x38d9e2),_0x2fe76b=fs_1[_0x644683(0xe1)][_0x644683(0xaf)](_0x38034e);_0x2fe76b['mtime']<_0x75483&&(fs_1['default'][_0x644683(0xc8)](_0x38034e),_0x530314++,console['log']('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x38d9e2));}),console[_0x405097(0xe9)](_0x405097(0xe4)+_0x530314+_0x405097(0xc2)+_0x54954f+'\x20days)');}catch(_0x49fd96){console[_0x405097(0xf8)](_0x405097(0xf9),_0x49fd96);}}}exports[a67_0x2b68af(0xc9)]=LoggerService,exports[a67_0x2b68af(0xae)]=new LoggerService();