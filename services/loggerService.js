'use strict';const a48_0x38a8b8=a48_0xc265;(function(_0x2d8c40,_0x7ca9e9){const _0x4ff521=a48_0xc265,_0x40584d=_0x2d8c40();while(!![]){try{const _0x154753=parseInt(_0x4ff521(0x1f5))/0x1*(parseInt(_0x4ff521(0x1c5))/0x2)+parseInt(_0x4ff521(0x1d2))/0x3+parseInt(_0x4ff521(0x1d1))/0x4*(parseInt(_0x4ff521(0x1c9))/0x5)+parseInt(_0x4ff521(0x1e6))/0x6+parseInt(_0x4ff521(0x1eb))/0x7*(parseInt(_0x4ff521(0x1ce))/0x8)+-parseInt(_0x4ff521(0x1d3))/0x9*(-parseInt(_0x4ff521(0x1b6))/0xa)+parseInt(_0x4ff521(0x1ae))/0xb*(-parseInt(_0x4ff521(0x1e8))/0xc);if(_0x154753===_0x7ca9e9)break;else _0x40584d['push'](_0x40584d['shift']());}catch(_0x35acab){_0x40584d['push'](_0x40584d['shift']());}}}(a48_0x1233,0x62131));function a48_0x1233(){const _0x5681c3=['stringify','path','logs','cleanOldLogs','split','RESPONSE','webhooks_received','logWhiteDomainResponse','API_CALL','logWebhookReceived','map','shop_webhooks_sent','webhooks_errors','setDate','mkdirSync','readdirSync','\x20old\x20log\x20files\x20(older\x20than\x20','\x20days)','1858752LdEbSG','utf8','34836ZnosWN','LoggerService','logsDir','2431107mGJKWR','logWebhookError','__importDefault','📁\x20Created\x20logs\x20directory:\x20','ensureLogsDirectory','getDate','loggerService','error','length','SHOP_WEBHOOK_ERROR','11iFNYoV','SHOP_WEBHOOK_SENT','toISOString','🧹\x20Cleaned\x20','slice','REQUEST','date','getLogStats','endsWith','\x20log:','forEach','4631EANnEb','.log','Failed\x20to\x20clean\x20old\x20logs:','WEBHOOK_RECEIVED','join','default','getLogFileName','message','274610QnOiGb','writeLog','Failed\x20to\x20write\x20','stack','cointopay_errors','white_domain_errors','size','log','__esModule','localeCompare','logShopWebhookError','logCoinToPayStatus','mtime','webhooks_processed','ERROR','6616JNWOeE','logPaymentCreated','payments_created','logWebhookProcessed','355315ORXvzO','defineProperty','api_calls','logShopWebhookSent','white_domain_requests','8kWmqLF','cwd','replace','12xTqaty','503958ZgYGwr','180VPwznr'];a48_0x1233=function(){return _0x5681c3;};return a48_0x1233();}function a48_0xc265(_0x196e8d,_0x4b03dd){const _0x123397=a48_0x1233();return a48_0xc265=function(_0xc265a0,_0x45fe19){_0xc265a0=_0xc265a0-0x1a7;let _0xc5e74a=_0x123397[_0xc265a0];return _0xc5e74a;},a48_0xc265(_0x196e8d,_0x4b03dd);}var __importDefault=this&&this[a48_0x38a8b8(0x1ed)]||function(_0xc2f0fc){return _0xc2f0fc&&_0xc2f0fc['__esModule']?_0xc2f0fc:{'default':_0xc2f0fc};};Object[a48_0x38a8b8(0x1ca)](exports,a48_0x38a8b8(0x1be),{'value':!![]}),exports[a48_0x38a8b8(0x1f1)]=exports[a48_0x38a8b8(0x1e9)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x38a8b8(0x1d5)));class LoggerService{constructor(){const _0x4b6457=a48_0x38a8b8;this[_0x4b6457(0x1ea)]=path_1[_0x4b6457(0x1b3)][_0x4b6457(0x1b2)](process[_0x4b6457(0x1cf)](),_0x4b6457(0x1d6)),this[_0x4b6457(0x1ef)]();}[a48_0x38a8b8(0x1ef)](){const _0x32cdb8=a48_0x38a8b8;!fs_1[_0x32cdb8(0x1b3)]['existsSync'](this[_0x32cdb8(0x1ea)])&&(fs_1[_0x32cdb8(0x1b3)][_0x32cdb8(0x1e2)](this[_0x32cdb8(0x1ea)],{'recursive':!![]}),console[_0x32cdb8(0x1bd)](_0x32cdb8(0x1ee)+this[_0x32cdb8(0x1ea)]));}['getLogFileName'](_0x201382){const _0x27117d=a48_0x38a8b8,_0x4a806b=new Date()[_0x27117d(0x1f7)]()['split']('T')[0x0];return path_1['default'][_0x27117d(0x1b2)](this[_0x27117d(0x1ea)],_0x201382+'_'+_0x4a806b+_0x27117d(0x1af));}[a48_0x38a8b8(0x1b7)](_0x16cde2,_0x5f35fc){const _0x25249a=a48_0x38a8b8;try{const _0x1051ac=new Date()[_0x25249a(0x1f7)](),_0x197be1={'timestamp':_0x1051ac,..._0x5f35fc},_0x251632=JSON[_0x25249a(0x1d4)](_0x197be1)+'\x0a',_0x117c00=this[_0x25249a(0x1b4)](_0x16cde2);fs_1['default']['appendFileSync'](_0x117c00,_0x251632,_0x25249a(0x1e7));}catch(_0x26b1f4){console[_0x25249a(0x1f2)](_0x25249a(0x1b8)+_0x16cde2+_0x25249a(0x1ac),_0x26b1f4);}}['logWhiteDomainRequest'](_0x385f0f,_0x1ceaed,_0x4c2cb5,_0x2ce641){const _0x359798=a48_0x38a8b8;this[_0x359798(0x1b7)](_0x359798(0x1cd),{'type':_0x359798(0x1a8),'gateway':_0x385f0f,'endpoint':_0x1ceaed,'method':_0x4c2cb5,'data':_0x2ce641});}[a48_0x38a8b8(0x1db)](_0x281d1a,_0xb30e61,_0x2ce5f7,_0x40c9b7,_0xe66261){const _0x45a30e=a48_0x38a8b8;this[_0x45a30e(0x1b7)]('white_domain_responses',{'type':_0x45a30e(0x1d9),'gateway':_0x281d1a,'endpoint':_0xb30e61,'status':_0x2ce5f7,'responseTime':_0xe66261,'data':_0x40c9b7});}['logWhiteDomainError'](_0xc40c92,_0x145bc2,_0x155f55){const _0x35a18a=a48_0x38a8b8;this[_0x35a18a(0x1b7)](_0x35a18a(0x1bb),{'type':_0x35a18a(0x1c4),'gateway':_0xc40c92,'endpoint':_0x145bc2,'error':_0x155f55 instanceof Error?{'message':_0x155f55[_0x35a18a(0x1b5)],'stack':_0x155f55[_0x35a18a(0x1b9)]}:_0x155f55});}[a48_0x38a8b8(0x1dd)](_0x3033f8,_0x46bfe5,_0x383998){const _0x288763=a48_0x38a8b8;this[_0x288763(0x1b7)](_0x288763(0x1da),{'type':_0x288763(0x1b1),'gateway':_0x3033f8,'headers':_0x383998,'data':_0x46bfe5});}[a48_0x38a8b8(0x1c8)](_0x1ada84,_0x20ff0f,_0x18ac52,_0xd5f14b,_0x309fb5){const _0x2ad4eb=a48_0x38a8b8;this['writeLog'](_0x2ad4eb(0x1c3),{'type':'WEBHOOK_PROCESSED','gateway':_0x1ada84,'paymentId':_0x20ff0f,'oldStatus':_0x18ac52,'newStatus':_0xd5f14b,'originalData':_0x309fb5});}[a48_0x38a8b8(0x1ec)](_0x58068a,_0x421cc9,_0x8bdfd2){const _0x132491=a48_0x38a8b8;this[_0x132491(0x1b7)](_0x132491(0x1e0),{'type':'WEBHOOK_ERROR','gateway':_0x58068a,'error':_0x421cc9 instanceof Error?{'message':_0x421cc9[_0x132491(0x1b5)],'stack':_0x421cc9[_0x132491(0x1b9)]}:_0x421cc9,'originalData':_0x8bdfd2});}[a48_0x38a8b8(0x1c1)](_0x1fdbf1){const _0x5ef75b=a48_0x38a8b8;this[_0x5ef75b(0x1b7)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x1fdbf1});}['logCoinToPayError'](_0x392898){const _0x7ed33e=a48_0x38a8b8;this[_0x7ed33e(0x1b7)](_0x7ed33e(0x1ba),{'type':'COINTOPAY_ERROR',..._0x392898});}[a48_0x38a8b8(0x1cc)](_0x19d055,_0x1f8e7c,_0x4479bb,_0x151869,_0x349467,_0x119b7f){const _0x27de5a=a48_0x38a8b8;this['writeLog'](_0x27de5a(0x1df),{'type':_0x27de5a(0x1f6),'shopId':_0x19d055,'webhookUrl':_0x1f8e7c,'event':_0x4479bb,'status':_0x151869,'responseTime':_0x349467,'payload':_0x119b7f});}[a48_0x38a8b8(0x1c0)](_0x3f26e2,_0xdde910,_0x4b4eac,_0x2bff73,_0x3d2b13){const _0x2cf38b=a48_0x38a8b8;this['writeLog']('shop_webhooks_errors',{'type':_0x2cf38b(0x1f4),'shopId':_0x3f26e2,'webhookUrl':_0xdde910,'event':_0x4b4eac,'error':_0x2bff73 instanceof Error?{'message':_0x2bff73[_0x2cf38b(0x1b5)],'stack':_0x2bff73['stack']}:_0x2bff73,'payload':_0x3d2b13});}[a48_0x38a8b8(0x1c6)](_0x38a4f4,_0x1d6532,_0x3c87e9,_0x458cf2,_0x2f6b84){const _0x17259d=a48_0x38a8b8;this[_0x17259d(0x1b7)](_0x17259d(0x1c7),{'type':'PAYMENT_CREATED','gateway':_0x38a4f4,'paymentId':_0x1d6532,'shopId':_0x3c87e9,'amount':_0x458cf2,'currency':_0x2f6b84});}['logApiCall'](_0x2e82a4,_0x352c89,_0x2d5882,_0x25787c,_0x58b836){const _0x4b1fd4=a48_0x38a8b8;this[_0x4b1fd4(0x1b7)](_0x4b1fd4(0x1cb),{'type':_0x4b1fd4(0x1dc),'endpoint':_0x2e82a4,'method':_0x352c89,'userId':_0x2d5882,'userRole':_0x25787c,'requestData':_0x58b836});}[a48_0x38a8b8(0x1aa)](){const _0x1ba76c=a48_0x38a8b8;try{const _0x2a3d6d=fs_1['default'][_0x1ba76c(0x1e3)](this[_0x1ba76c(0x1ea)]),_0x1e2902=_0x2a3d6d['filter'](_0x2f16bc=>_0x2f16bc[_0x1ba76c(0x1ab)](_0x1ba76c(0x1af))),_0x13dd1e=[...new Set(_0x1e2902[_0x1ba76c(0x1de)](_0x3a547d=>_0x3a547d[_0x1ba76c(0x1d8)]('_')[0x0]))],_0xf0541b=_0x1e2902['map'](_0x4bc6af=>{const _0xb93237=_0x1ba76c,_0x357e2c=path_1['default'][_0xb93237(0x1b2)](this[_0xb93237(0x1ea)],_0x4bc6af),_0x17a3e8=fs_1['default']['statSync'](_0x357e2c),[_0x318668,_0x2cd8f7]=_0x4bc6af[_0xb93237(0x1d0)](_0xb93237(0x1af),'')[_0xb93237(0x1d8)]('_');return{'type':_0x318668,'date':_0x2cd8f7,'size':_0x17a3e8[_0xb93237(0x1bc)]};})['sort']((_0x30b8d1,_0x2d29c2)=>_0x2d29c2['date'][_0x1ba76c(0x1bf)](_0x30b8d1[_0x1ba76c(0x1a9)]));return{'totalFiles':_0x1e2902[_0x1ba76c(0x1f3)],'logTypes':_0x13dd1e,'latestLogs':_0xf0541b[_0x1ba76c(0x1a7)](0x0,0xa)};}catch(_0xec61b4){return console[_0x1ba76c(0x1f2)]('Failed\x20to\x20get\x20log\x20stats:',_0xec61b4),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x38a8b8(0x1d7)](_0x3d0efd=0x1e){const _0x2606bb=a48_0x38a8b8;try{const _0x69e98=fs_1[_0x2606bb(0x1b3)][_0x2606bb(0x1e3)](this[_0x2606bb(0x1ea)]),_0xf8fe6a=new Date();_0xf8fe6a[_0x2606bb(0x1e1)](_0xf8fe6a[_0x2606bb(0x1f0)]()-_0x3d0efd);let _0x692b40=0x0;_0x69e98[_0x2606bb(0x1ad)](_0xfd8ed6=>{const _0x15a9b5=_0x2606bb;if(!_0xfd8ed6['endsWith'](_0x15a9b5(0x1af)))return;const _0x4b2d97=path_1[_0x15a9b5(0x1b3)]['join'](this[_0x15a9b5(0x1ea)],_0xfd8ed6),_0x19eb0d=fs_1['default']['statSync'](_0x4b2d97);_0x19eb0d[_0x15a9b5(0x1c2)]<_0xf8fe6a&&(fs_1['default']['unlinkSync'](_0x4b2d97),_0x692b40++,console[_0x15a9b5(0x1bd)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0xfd8ed6));}),console['log'](_0x2606bb(0x1f8)+_0x692b40+_0x2606bb(0x1e4)+_0x3d0efd+_0x2606bb(0x1e5));}catch(_0x3aa892){console[_0x2606bb(0x1f2)](_0x2606bb(0x1b0),_0x3aa892);}}}exports[a48_0x38a8b8(0x1e9)]=LoggerService,exports[a48_0x38a8b8(0x1f1)]=new LoggerService();