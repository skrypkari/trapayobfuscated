'use strict';const a55_0x382eb2=a55_0x3b41;function a55_0x4d3c(){const _0x42d2aa=['existsSync','logPaymentCreated','error','__esModule','log','logWebhookProcessed','sort','path','shop_webhooks_sent','map','logApiCall','endsWith','ERROR','40642fpjadu','API_CALL','appendFileSync','cointopay_errors','logShopWebhookSent','\x20old\x20log\x20files\x20(older\x20than\x20','__importDefault','1581700WyXYiD','mtime','white_domain_responses','2060928ClBlKa','webhooks_processed','setDate','.log','cointopay_status_changes','replace','WEBHOOK_ERROR','filter','ensureLogsDirectory','getLogStats','stack','message','Failed\x20to\x20write\x20','join','date','logsDir','logWhiteDomainResponse','logWhiteDomainRequest','size','statSync','WEBHOOK_PROCESSED','loggerService','length','utf8','slice','logs','\x20log:','localeCompare','white_domain_errors','9235578dZFcqd','6mlSBqA','COINTOPAY_STATUS_CHANGE','10103CBIJtF','toISOString','defineProperty','🧹\x20Cleaned\x20','white_domain_requests','default','LoggerService','logWebhookReceived','WEBHOOK_RECEIVED','240hMhhKb','SHOP_WEBHOOK_SENT','payments_created','74IHNNFK','REQUEST','736LrpbwH','getLogFileName','readdirSync','34564LpvBwS','writeLog','shop_webhooks_errors','split','🗑️\x20Deleted\x20old\x20log\x20file:\x20','forEach','PAYMENT_CREATED','📁\x20Created\x20logs\x20directory:\x20','cleanOldLogs','3883785BotgLq','Failed\x20to\x20clean\x20old\x20logs:'];a55_0x4d3c=function(){return _0x42d2aa;};return a55_0x4d3c();}(function(_0x11ad85,_0x35aad6){const _0xbbfe00=a55_0x3b41,_0x2fbf40=_0x11ad85();while(!![]){try{const _0x5cf9b5=-parseInt(_0xbbfe00(0x19a))/0x1*(parseInt(_0xbbfe00(0x1a6))/0x2)+-parseInt(_0xbbfe00(0x1a3))/0x3*(parseInt(_0xbbfe00(0x1ab))/0x4)+-parseInt(_0xbbfe00(0x1b4))/0x5*(-parseInt(_0xbbfe00(0x198))/0x6)+-parseInt(_0xbbfe00(0x1c3))/0x7*(parseInt(_0xbbfe00(0x1a8))/0x8)+parseInt(_0xbbfe00(0x1cd))/0x9+parseInt(_0xbbfe00(0x1ca))/0xa+parseInt(_0xbbfe00(0x197))/0xb;if(_0x5cf9b5===_0x35aad6)break;else _0x2fbf40['push'](_0x2fbf40['shift']());}catch(_0x44c9b9){_0x2fbf40['push'](_0x2fbf40['shift']());}}}(a55_0x4d3c,0x62b32));var __importDefault=this&&this[a55_0x382eb2(0x1c9)]||function(_0x299181){const _0x10ba52=a55_0x382eb2;return _0x299181&&_0x299181[_0x10ba52(0x1b9)]?_0x299181:{'default':_0x299181};};Object[a55_0x382eb2(0x19c)](exports,a55_0x382eb2(0x1b9),{'value':!![]}),exports[a55_0x382eb2(0x1e2)]=exports[a55_0x382eb2(0x1a0)]=void 0x0;function a55_0x3b41(_0x171b78,_0x2a110e){const _0x4d3c2a=a55_0x4d3c();return a55_0x3b41=function(_0x3b413a,_0x47d4b8){_0x3b413a=_0x3b413a-0x195;let _0x4e4323=_0x4d3c2a[_0x3b413a];return _0x4e4323;},a55_0x3b41(_0x171b78,_0x2a110e);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a55_0x382eb2(0x1bd)));class LoggerService{constructor(){const _0x1d2235=a55_0x382eb2;this['logsDir']=path_1['default'][_0x1d2235(0x1da)](process['cwd'](),_0x1d2235(0x1e6)),this[_0x1d2235(0x1d5)]();}[a55_0x382eb2(0x1d5)](){const _0x511b21=a55_0x382eb2;!fs_1[_0x511b21(0x19f)][_0x511b21(0x1b6)](this[_0x511b21(0x1dc)])&&(fs_1[_0x511b21(0x19f)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x511b21(0x1ba)](_0x511b21(0x1b2)+this[_0x511b21(0x1dc)]));}[a55_0x382eb2(0x1a9)](_0x14e665){const _0x2c2bc1=a55_0x382eb2,_0x32bdbd=new Date()[_0x2c2bc1(0x19b)]()[_0x2c2bc1(0x1ae)]('T')[0x0];return path_1['default'][_0x2c2bc1(0x1da)](this[_0x2c2bc1(0x1dc)],_0x14e665+'_'+_0x32bdbd+_0x2c2bc1(0x1d0));}[a55_0x382eb2(0x1ac)](_0x3eafec,_0x38c828){const _0x4294aa=a55_0x382eb2;try{const _0x255538=new Date()[_0x4294aa(0x19b)](),_0x50c912={'timestamp':_0x255538,..._0x38c828},_0x5964f8=JSON['stringify'](_0x50c912)+'\x0a',_0x2d3eb9=this[_0x4294aa(0x1a9)](_0x3eafec);fs_1[_0x4294aa(0x19f)][_0x4294aa(0x1c5)](_0x2d3eb9,_0x5964f8,_0x4294aa(0x1e4));}catch(_0x243b17){console['error'](_0x4294aa(0x1d9)+_0x3eafec+_0x4294aa(0x1e7),_0x243b17);}}[a55_0x382eb2(0x1de)](_0x175846,_0x515bcc,_0x2c355e,_0x118c20){const _0x129191=a55_0x382eb2;this[_0x129191(0x1ac)](_0x129191(0x19e),{'type':_0x129191(0x1a7),'gateway':_0x175846,'endpoint':_0x515bcc,'method':_0x2c355e,'data':_0x118c20});}[a55_0x382eb2(0x1dd)](_0x4c2d57,_0x399ca3,_0xe31c27,_0xca35f0,_0x3ac2c2){const _0x39e274=a55_0x382eb2;this[_0x39e274(0x1ac)](_0x39e274(0x1cc),{'type':'RESPONSE','gateway':_0x4c2d57,'endpoint':_0x399ca3,'status':_0xe31c27,'responseTime':_0x3ac2c2,'data':_0xca35f0});}['logWhiteDomainError'](_0x2fe4be,_0x53d513,_0x481bb4){const _0x5b86b4=a55_0x382eb2;this[_0x5b86b4(0x1ac)](_0x5b86b4(0x196),{'type':_0x5b86b4(0x1c2),'gateway':_0x2fe4be,'endpoint':_0x53d513,'error':_0x481bb4 instanceof Error?{'message':_0x481bb4[_0x5b86b4(0x1d8)],'stack':_0x481bb4[_0x5b86b4(0x1d7)]}:_0x481bb4});}[a55_0x382eb2(0x1a1)](_0x50c2cb,_0x28c757,_0x3461da){const _0x332cec=a55_0x382eb2;this[_0x332cec(0x1ac)]('webhooks_received',{'type':_0x332cec(0x1a2),'gateway':_0x50c2cb,'headers':_0x3461da,'data':_0x28c757});}[a55_0x382eb2(0x1bb)](_0x509569,_0x48a2f3,_0x5c0b30,_0x2abc80,_0x33373d){const _0x38bd14=a55_0x382eb2;this['writeLog'](_0x38bd14(0x1ce),{'type':_0x38bd14(0x1e1),'gateway':_0x509569,'paymentId':_0x48a2f3,'oldStatus':_0x5c0b30,'newStatus':_0x2abc80,'originalData':_0x33373d});}['logWebhookError'](_0x51920e,_0x449f5b,_0x28dfb3){const _0x4e84da=a55_0x382eb2;this[_0x4e84da(0x1ac)]('webhooks_errors',{'type':_0x4e84da(0x1d3),'gateway':_0x51920e,'error':_0x449f5b instanceof Error?{'message':_0x449f5b[_0x4e84da(0x1d8)],'stack':_0x449f5b[_0x4e84da(0x1d7)]}:_0x449f5b,'originalData':_0x28dfb3});}['logCoinToPayStatus'](_0x5d627c){const _0x26fbce=a55_0x382eb2;this['writeLog'](_0x26fbce(0x1d1),{'type':_0x26fbce(0x199),..._0x5d627c});}['logCoinToPayError'](_0x2de120){const _0x373ff9=a55_0x382eb2;this[_0x373ff9(0x1ac)](_0x373ff9(0x1c6),{'type':'COINTOPAY_ERROR',..._0x2de120});}[a55_0x382eb2(0x1c7)](_0x5c70fe,_0x413bc5,_0x462b2c,_0xca4a6d,_0x26900d,_0x2b20eb){const _0x1886aa=a55_0x382eb2;this[_0x1886aa(0x1ac)](_0x1886aa(0x1be),{'type':_0x1886aa(0x1a4),'shopId':_0x5c70fe,'webhookUrl':_0x413bc5,'event':_0x462b2c,'status':_0xca4a6d,'responseTime':_0x26900d,'payload':_0x2b20eb});}['logShopWebhookError'](_0x19abff,_0x2a557f,_0x44bb32,_0x364f73,_0x1117e7){const _0x184c96=a55_0x382eb2;this['writeLog'](_0x184c96(0x1ad),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x19abff,'webhookUrl':_0x2a557f,'event':_0x44bb32,'error':_0x364f73 instanceof Error?{'message':_0x364f73[_0x184c96(0x1d8)],'stack':_0x364f73['stack']}:_0x364f73,'payload':_0x1117e7});}[a55_0x382eb2(0x1b7)](_0x439fbd,_0x4fab60,_0xf765b2,_0x161c93,_0x5945a4){const _0x5bf2ea=a55_0x382eb2;this[_0x5bf2ea(0x1ac)](_0x5bf2ea(0x1a5),{'type':_0x5bf2ea(0x1b1),'gateway':_0x439fbd,'paymentId':_0x4fab60,'shopId':_0xf765b2,'amount':_0x161c93,'currency':_0x5945a4});}[a55_0x382eb2(0x1c0)](_0x237c42,_0x48744c,_0x599474,_0x28411b,_0x32c31f){const _0x1ed8db=a55_0x382eb2;this[_0x1ed8db(0x1ac)]('api_calls',{'type':_0x1ed8db(0x1c4),'endpoint':_0x237c42,'method':_0x48744c,'userId':_0x599474,'userRole':_0x28411b,'requestData':_0x32c31f});}[a55_0x382eb2(0x1d6)](){const _0x1f748f=a55_0x382eb2;try{const _0x350169=fs_1['default'][_0x1f748f(0x1aa)](this['logsDir']),_0x44ba3b=_0x350169[_0x1f748f(0x1d4)](_0x125264=>_0x125264[_0x1f748f(0x1c1)](_0x1f748f(0x1d0))),_0x45589e=[...new Set(_0x44ba3b[_0x1f748f(0x1bf)](_0x8a8fc0=>_0x8a8fc0['split']('_')[0x0]))],_0x21e2c0=_0x44ba3b[_0x1f748f(0x1bf)](_0x4ea1ef=>{const _0x281149=_0x1f748f,_0x59d91b=path_1[_0x281149(0x19f)]['join'](this[_0x281149(0x1dc)],_0x4ea1ef),_0x373d35=fs_1[_0x281149(0x19f)]['statSync'](_0x59d91b),[_0x2435c3,_0x29a900]=_0x4ea1ef[_0x281149(0x1d2)](_0x281149(0x1d0),'')[_0x281149(0x1ae)]('_');return{'type':_0x2435c3,'date':_0x29a900,'size':_0x373d35[_0x281149(0x1df)]};})[_0x1f748f(0x1bc)]((_0xc736e1,_0x62fa02)=>_0x62fa02[_0x1f748f(0x1db)][_0x1f748f(0x195)](_0xc736e1[_0x1f748f(0x1db)]));return{'totalFiles':_0x44ba3b[_0x1f748f(0x1e3)],'logTypes':_0x45589e,'latestLogs':_0x21e2c0[_0x1f748f(0x1e5)](0x0,0xa)};}catch(_0x13155b){return console[_0x1f748f(0x1b8)]('Failed\x20to\x20get\x20log\x20stats:',_0x13155b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a55_0x382eb2(0x1b3)](_0x3dda20=0x1e){const _0x3184be=a55_0x382eb2;try{const _0x635309=fs_1['default']['readdirSync'](this[_0x3184be(0x1dc)]),_0x3d43fe=new Date();_0x3d43fe[_0x3184be(0x1cf)](_0x3d43fe['getDate']()-_0x3dda20);let _0x125a07=0x0;_0x635309[_0x3184be(0x1b0)](_0x1d133e=>{const _0x179280=_0x3184be;if(!_0x1d133e[_0x179280(0x1c1)](_0x179280(0x1d0)))return;const _0x3c3cff=path_1['default'][_0x179280(0x1da)](this[_0x179280(0x1dc)],_0x1d133e),_0x30d123=fs_1[_0x179280(0x19f)][_0x179280(0x1e0)](_0x3c3cff);_0x30d123[_0x179280(0x1cb)]<_0x3d43fe&&(fs_1[_0x179280(0x19f)]['unlinkSync'](_0x3c3cff),_0x125a07++,console['log'](_0x179280(0x1af)+_0x1d133e));}),console[_0x3184be(0x1ba)](_0x3184be(0x19d)+_0x125a07+_0x3184be(0x1c8)+_0x3dda20+'\x20days)');}catch(_0xc16c76){console[_0x3184be(0x1b8)](_0x3184be(0x1b5),_0xc16c76);}}}exports['LoggerService']=LoggerService,exports[a55_0x382eb2(0x1e2)]=new LoggerService();