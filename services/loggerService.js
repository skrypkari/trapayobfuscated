'use strict';function a51_0x3800(){const _0xb67e3e=['log','readdirSync','white_domain_errors','shop_webhooks_errors','470160hYZyRz','COINTOPAY_STATUS_CHANGE','join','replace','utf8','error','size','webhooks_processed','\x20old\x20log\x20files\x20(older\x20than\x20','logShopWebhookSent','\x20log:','stringify','getLogFileName','webhooks_errors','cwd','Failed\x20to\x20clean\x20old\x20logs:','webhooks_received','cleanOldLogs','🧹\x20Cleaned\x20','logWebhookError','REQUEST','setDate','SHOP_WEBHOOK_ERROR','logPaymentCreated','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logApiCall','13246875tMKwbh','logWhiteDomainRequest','white_domain_responses','RESPONSE','ERROR','5783680HEupxQ','SHOP_WEBHOOK_SENT','__esModule','COINTOPAY_ERROR','WEBHOOK_PROCESSED','WEBHOOK_RECEIVED','WEBHOOK_ERROR','logsDir','956686LJDuED','length','1QhWQfc','\x20days)','map','forEach','split','statSync','Failed\x20to\x20get\x20log\x20stats:','toISOString','API_CALL','endsWith','cointopay_status_changes','default','PAYMENT_CREATED','logWebhookReceived','3902118DDGZoJ','filter','mkdirSync','8fHEVtX','ensureLogsDirectory','logCoinToPayStatus','message','path','stack','LoggerService','getLogStats','.log','1324827tIROMe','date','localeCompare','getDate','api_calls','sort','88449hjyjkz','writeLog'];a51_0x3800=function(){return _0xb67e3e;};return a51_0x3800();}const a51_0x3ccab6=a51_0x172f;(function(_0x246257,_0xbfbb52){const _0x4023eb=a51_0x172f,_0x5859e0=_0x246257();while(!![]){try{const _0x3fd965=-parseInt(_0x4023eb(0x16a))/0x1*(-parseInt(_0x4023eb(0x168))/0x2)+-parseInt(_0x4023eb(0x18a))/0x3*(parseInt(_0x4023eb(0x17b))/0x4)+-parseInt(_0x4023eb(0x141))/0x5+parseInt(_0x4023eb(0x178))/0x6+parseInt(_0x4023eb(0x184))/0x7+parseInt(_0x4023eb(0x160))/0x8+-parseInt(_0x4023eb(0x15b))/0x9;if(_0x3fd965===_0xbfbb52)break;else _0x5859e0['push'](_0x5859e0['shift']());}catch(_0x4d22c4){_0x5859e0['push'](_0x5859e0['shift']());}}}(a51_0x3800,0x6592c));var __importDefault=this&&this['__importDefault']||function(_0x5f5645){return _0x5f5645&&_0x5f5645['__esModule']?_0x5f5645:{'default':_0x5f5645};};function a51_0x172f(_0x3a1254,_0x56e50b){const _0x3800b5=a51_0x3800();return a51_0x172f=function(_0x172f8c,_0x558924){_0x172f8c=_0x172f8c-0x13f;let _0x53a606=_0x3800b5[_0x172f8c];return _0x53a606;},a51_0x172f(_0x3a1254,_0x56e50b);}Object['defineProperty'](exports,a51_0x3ccab6(0x162),{'value':!![]}),exports['loggerService']=exports[a51_0x3ccab6(0x181)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x3ccab6(0x17f)));class LoggerService{constructor(){const _0x5f42c3=a51_0x3ccab6;this[_0x5f42c3(0x167)]=path_1['default'][_0x5f42c3(0x143)](process[_0x5f42c3(0x14f)](),'logs'),this['ensureLogsDirectory']();}[a51_0x3ccab6(0x17c)](){const _0x599da1=a51_0x3ccab6;!fs_1[_0x599da1(0x175)]['existsSync'](this[_0x599da1(0x167)])&&(fs_1['default'][_0x599da1(0x17a)](this[_0x599da1(0x167)],{'recursive':!![]}),console[_0x599da1(0x18c)]('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a51_0x3ccab6(0x14d)](_0x1db2a5){const _0x3feb97=a51_0x3ccab6,_0x5d502e=new Date()[_0x3feb97(0x171)]()[_0x3feb97(0x16e)]('T')[0x0];return path_1[_0x3feb97(0x175)][_0x3feb97(0x143)](this[_0x3feb97(0x167)],_0x1db2a5+'_'+_0x5d502e+_0x3feb97(0x183));}[a51_0x3ccab6(0x18b)](_0x438401,_0x2f8fa0){const _0x5dac23=a51_0x3ccab6;try{const _0x289d95=new Date()[_0x5dac23(0x171)](),_0x43f2bc={'timestamp':_0x289d95,..._0x2f8fa0},_0x5712b2=JSON[_0x5dac23(0x14c)](_0x43f2bc)+'\x0a',_0x27a7be=this[_0x5dac23(0x14d)](_0x438401);fs_1[_0x5dac23(0x175)]['appendFileSync'](_0x27a7be,_0x5712b2,_0x5dac23(0x145));}catch(_0x250069){console['error']('Failed\x20to\x20write\x20'+_0x438401+_0x5dac23(0x14b),_0x250069);}}[a51_0x3ccab6(0x15c)](_0x5b7adf,_0x37cfcf,_0x30e4d4,_0x4ce041){const _0x3e2626=a51_0x3ccab6;this[_0x3e2626(0x18b)]('white_domain_requests',{'type':_0x3e2626(0x155),'gateway':_0x5b7adf,'endpoint':_0x37cfcf,'method':_0x30e4d4,'data':_0x4ce041});}['logWhiteDomainResponse'](_0x333630,_0x2da341,_0x156fb9,_0x1b0bed,_0x1dcdeb){const _0x4e2924=a51_0x3ccab6;this[_0x4e2924(0x18b)](_0x4e2924(0x15d),{'type':_0x4e2924(0x15e),'gateway':_0x333630,'endpoint':_0x2da341,'status':_0x156fb9,'responseTime':_0x1dcdeb,'data':_0x1b0bed});}['logWhiteDomainError'](_0x329712,_0x130101,_0x1ce81d){const _0x30852d=a51_0x3ccab6;this['writeLog'](_0x30852d(0x13f),{'type':_0x30852d(0x15f),'gateway':_0x329712,'endpoint':_0x130101,'error':_0x1ce81d instanceof Error?{'message':_0x1ce81d['message'],'stack':_0x1ce81d['stack']}:_0x1ce81d});}[a51_0x3ccab6(0x177)](_0x15d11,_0x3e61c9,_0x573a32){const _0x174d8b=a51_0x3ccab6;this[_0x174d8b(0x18b)](_0x174d8b(0x151),{'type':_0x174d8b(0x165),'gateway':_0x15d11,'headers':_0x573a32,'data':_0x3e61c9});}['logWebhookProcessed'](_0x48a4de,_0x4cb81e,_0x2a7182,_0x345eef,_0x20a59a){const _0x4f2704=a51_0x3ccab6;this['writeLog'](_0x4f2704(0x148),{'type':_0x4f2704(0x164),'gateway':_0x48a4de,'paymentId':_0x4cb81e,'oldStatus':_0x2a7182,'newStatus':_0x345eef,'originalData':_0x20a59a});}[a51_0x3ccab6(0x154)](_0x854bef,_0x258b6b,_0x271afa){const _0x5d1db2=a51_0x3ccab6;this[_0x5d1db2(0x18b)](_0x5d1db2(0x14e),{'type':_0x5d1db2(0x166),'gateway':_0x854bef,'error':_0x258b6b instanceof Error?{'message':_0x258b6b['message'],'stack':_0x258b6b[_0x5d1db2(0x180)]}:_0x258b6b,'originalData':_0x271afa});}[a51_0x3ccab6(0x17d)](_0x1877e5){const _0xc5c70d=a51_0x3ccab6;this[_0xc5c70d(0x18b)](_0xc5c70d(0x174),{'type':_0xc5c70d(0x142),..._0x1877e5});}['logCoinToPayError'](_0x44f1b9){const _0x1a21a4=a51_0x3ccab6;this[_0x1a21a4(0x18b)]('cointopay_errors',{'type':_0x1a21a4(0x163),..._0x44f1b9});}[a51_0x3ccab6(0x14a)](_0xf1840f,_0x1c16c0,_0x5da561,_0x564d1d,_0x571494,_0x361130){const _0x5b3d4d=a51_0x3ccab6;this[_0x5b3d4d(0x18b)]('shop_webhooks_sent',{'type':_0x5b3d4d(0x161),'shopId':_0xf1840f,'webhookUrl':_0x1c16c0,'event':_0x5da561,'status':_0x564d1d,'responseTime':_0x571494,'payload':_0x361130});}['logShopWebhookError'](_0x194e06,_0x5be23f,_0x476008,_0x1f3ac5,_0x40c1bf){const _0x276994=a51_0x3ccab6;this[_0x276994(0x18b)](_0x276994(0x140),{'type':_0x276994(0x157),'shopId':_0x194e06,'webhookUrl':_0x5be23f,'event':_0x476008,'error':_0x1f3ac5 instanceof Error?{'message':_0x1f3ac5[_0x276994(0x17e)],'stack':_0x1f3ac5[_0x276994(0x180)]}:_0x1f3ac5,'payload':_0x40c1bf});}[a51_0x3ccab6(0x158)](_0x180f88,_0x3f7699,_0x341ba1,_0xe0fc7c,_0x218a8a){const _0x27d1d7=a51_0x3ccab6;this[_0x27d1d7(0x18b)]('payments_created',{'type':_0x27d1d7(0x176),'gateway':_0x180f88,'paymentId':_0x3f7699,'shopId':_0x341ba1,'amount':_0xe0fc7c,'currency':_0x218a8a});}[a51_0x3ccab6(0x15a)](_0xaa2b7b,_0x2d000b,_0x110d71,_0x1ac9cd,_0x498937){const _0x324efe=a51_0x3ccab6;this[_0x324efe(0x18b)](_0x324efe(0x188),{'type':_0x324efe(0x172),'endpoint':_0xaa2b7b,'method':_0x2d000b,'userId':_0x110d71,'userRole':_0x1ac9cd,'requestData':_0x498937});}[a51_0x3ccab6(0x182)](){const _0x2ede49=a51_0x3ccab6;try{const _0x4856e8=fs_1[_0x2ede49(0x175)][_0x2ede49(0x18d)](this[_0x2ede49(0x167)]),_0x517de8=_0x4856e8[_0x2ede49(0x179)](_0x5a915f=>_0x5a915f['endsWith'](_0x2ede49(0x183))),_0x24f403=[...new Set(_0x517de8[_0x2ede49(0x16c)](_0x2f4ca3=>_0x2f4ca3[_0x2ede49(0x16e)]('_')[0x0]))],_0x3e3a25=_0x517de8['map'](_0x1e18ea=>{const _0x5f2589=_0x2ede49,_0x25e49b=path_1[_0x5f2589(0x175)][_0x5f2589(0x143)](this['logsDir'],_0x1e18ea),_0x55a31a=fs_1['default'][_0x5f2589(0x16f)](_0x25e49b),[_0x6f53f,_0x35b2fa]=_0x1e18ea[_0x5f2589(0x144)](_0x5f2589(0x183),'')[_0x5f2589(0x16e)]('_');return{'type':_0x6f53f,'date':_0x35b2fa,'size':_0x55a31a[_0x5f2589(0x147)]};})[_0x2ede49(0x189)]((_0x1acaf7,_0xb6b4b2)=>_0xb6b4b2[_0x2ede49(0x185)][_0x2ede49(0x186)](_0x1acaf7[_0x2ede49(0x185)]));return{'totalFiles':_0x517de8[_0x2ede49(0x169)],'logTypes':_0x24f403,'latestLogs':_0x3e3a25['slice'](0x0,0xa)};}catch(_0x3c8098){return console[_0x2ede49(0x146)](_0x2ede49(0x170),_0x3c8098),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x3ccab6(0x152)](_0x1117bd=0x1e){const _0x4cc4ad=a51_0x3ccab6;try{const _0x142041=fs_1[_0x4cc4ad(0x175)][_0x4cc4ad(0x18d)](this['logsDir']),_0x1ef32f=new Date();_0x1ef32f[_0x4cc4ad(0x156)](_0x1ef32f[_0x4cc4ad(0x187)]()-_0x1117bd);let _0x481f48=0x0;_0x142041[_0x4cc4ad(0x16d)](_0x4bc32d=>{const _0x4da9ab=_0x4cc4ad;if(!_0x4bc32d[_0x4da9ab(0x173)](_0x4da9ab(0x183)))return;const _0x4af12b=path_1[_0x4da9ab(0x175)][_0x4da9ab(0x143)](this[_0x4da9ab(0x167)],_0x4bc32d),_0x8e5c7f=fs_1[_0x4da9ab(0x175)]['statSync'](_0x4af12b);_0x8e5c7f['mtime']<_0x1ef32f&&(fs_1[_0x4da9ab(0x175)]['unlinkSync'](_0x4af12b),_0x481f48++,console['log'](_0x4da9ab(0x159)+_0x4bc32d));}),console[_0x4cc4ad(0x18c)](_0x4cc4ad(0x153)+_0x481f48+_0x4cc4ad(0x149)+_0x1117bd+_0x4cc4ad(0x16b));}catch(_0x1f5f76){console['error'](_0x4cc4ad(0x150),_0x1f5f76);}}}exports[a51_0x3ccab6(0x181)]=LoggerService,exports['loggerService']=new LoggerService();