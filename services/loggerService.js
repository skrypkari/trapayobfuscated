'use strict';const a44_0x213ad4=a44_0x2227;(function(_0x25116e,_0x408733){const _0x102b97=a44_0x2227,_0x4b2ed2=_0x25116e();while(!![]){try{const _0x34740a=parseInt(_0x102b97(0x198))/0x1*(-parseInt(_0x102b97(0x162))/0x2)+parseInt(_0x102b97(0x167))/0x3+-parseInt(_0x102b97(0x14d))/0x4*(parseInt(_0x102b97(0x17e))/0x5)+-parseInt(_0x102b97(0x14c))/0x6*(parseInt(_0x102b97(0x175))/0x7)+-parseInt(_0x102b97(0x15f))/0x8*(-parseInt(_0x102b97(0x179))/0x9)+-parseInt(_0x102b97(0x172))/0xa*(-parseInt(_0x102b97(0x180))/0xb)+parseInt(_0x102b97(0x176))/0xc*(parseInt(_0x102b97(0x165))/0xd);if(_0x34740a===_0x408733)break;else _0x4b2ed2['push'](_0x4b2ed2['shift']());}catch(_0x3fae54){_0x4b2ed2['push'](_0x4b2ed2['shift']());}}}(a44_0x437c,0xc8d0f));function a44_0x2227(_0x31c6ad,_0x2d6ded){const _0x437cdb=a44_0x437c();return a44_0x2227=function(_0x222705,_0x32aaf7){_0x222705=_0x222705-0x14c;let _0x3d36b0=_0x437cdb[_0x222705];return _0x3d36b0;},a44_0x2227(_0x31c6ad,_0x2d6ded);}var __importDefault=this&&this['__importDefault']||function(_0x30810c){const _0x259ea9=a44_0x2227;return _0x30810c&&_0x30810c[_0x259ea9(0x19c)]?_0x30810c:{'default':_0x30810c};};Object[a44_0x213ad4(0x192)](exports,a44_0x213ad4(0x19c),{'value':!![]}),exports[a44_0x213ad4(0x186)]=exports[a44_0x213ad4(0x191)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a44_0x213ad4(0x190)));class LoggerService{constructor(){const _0x44880a=a44_0x213ad4;this[_0x44880a(0x16d)]=path_1[_0x44880a(0x161)][_0x44880a(0x17b)](process['cwd'](),_0x44880a(0x151)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x57f1f3=a44_0x213ad4;!fs_1['default'][_0x57f1f3(0x196)](this[_0x57f1f3(0x16d)])&&(fs_1[_0x57f1f3(0x161)][_0x57f1f3(0x17c)](this[_0x57f1f3(0x16d)],{'recursive':!![]}),console[_0x57f1f3(0x193)](_0x57f1f3(0x189)+this[_0x57f1f3(0x16d)]));}[a44_0x213ad4(0x181)](_0x4a77ca){const _0x2e163f=a44_0x213ad4,_0x27da0b=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x2e163f(0x161)][_0x2e163f(0x17b)](this[_0x2e163f(0x16d)],_0x4a77ca+'_'+_0x27da0b+_0x2e163f(0x15b));}[a44_0x213ad4(0x15e)](_0x5173d2,_0x544ee3){const _0xb515f4=a44_0x213ad4;try{const _0x483412=new Date()[_0xb515f4(0x170)](),_0xe46cdf={'timestamp':_0x483412,..._0x544ee3},_0x3f1803=JSON[_0xb515f4(0x19e)](_0xe46cdf)+'\x0a',_0x5d83b7=this['getLogFileName'](_0x5173d2);fs_1[_0xb515f4(0x161)][_0xb515f4(0x199)](_0x5d83b7,_0x3f1803,_0xb515f4(0x156));}catch(_0x1b06d9){console['error'](_0xb515f4(0x197)+_0x5173d2+_0xb515f4(0x182),_0x1b06d9);}}[a44_0x213ad4(0x160)](_0x12f94d,_0x106b7d,_0x236b91,_0x1b96f1){const _0x458d74=a44_0x213ad4;this[_0x458d74(0x15e)](_0x458d74(0x173),{'type':'REQUEST','gateway':_0x12f94d,'endpoint':_0x106b7d,'method':_0x236b91,'data':_0x1b96f1});}[a44_0x213ad4(0x17d)](_0x42873b,_0x511a2b,_0x4d2a52,_0x8e62f3,_0x3fd6d0){const _0x5039bb=a44_0x213ad4;this['writeLog'](_0x5039bb(0x16f),{'type':_0x5039bb(0x169),'gateway':_0x42873b,'endpoint':_0x511a2b,'status':_0x4d2a52,'responseTime':_0x3fd6d0,'data':_0x8e62f3});}[a44_0x213ad4(0x18a)](_0x52d5fe,_0x4664ce,_0x13f989){const _0x2da614=a44_0x213ad4;this['writeLog'](_0x2da614(0x183),{'type':_0x2da614(0x153),'gateway':_0x52d5fe,'endpoint':_0x4664ce,'error':_0x13f989 instanceof Error?{'message':_0x13f989[_0x2da614(0x188)],'stack':_0x13f989[_0x2da614(0x154)]}:_0x13f989});}[a44_0x213ad4(0x16e)](_0x8f3863,_0x4b0814,_0x352bea){const _0x3eb03d=a44_0x213ad4;this['writeLog'](_0x3eb03d(0x177),{'type':'WEBHOOK_RECEIVED','gateway':_0x8f3863,'headers':_0x352bea,'data':_0x4b0814});}[a44_0x213ad4(0x19f)](_0x1d9c6d,_0x3f0c36,_0x47070c,_0x1de55e,_0xb630cc){const _0x5d5452=a44_0x213ad4;this[_0x5d5452(0x15e)]('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x1d9c6d,'paymentId':_0x3f0c36,'oldStatus':_0x47070c,'newStatus':_0x1de55e,'originalData':_0xb630cc});}['logWebhookError'](_0x3b47b3,_0x24a272,_0x2a27ea){const _0x1cb3e8=a44_0x213ad4;this['writeLog'](_0x1cb3e8(0x158),{'type':_0x1cb3e8(0x178),'gateway':_0x3b47b3,'error':_0x24a272 instanceof Error?{'message':_0x24a272[_0x1cb3e8(0x188)],'stack':_0x24a272['stack']}:_0x24a272,'originalData':_0x2a27ea});}[a44_0x213ad4(0x16c)](_0x34bc2a){const _0x5a5db4=a44_0x213ad4;this[_0x5a5db4(0x15e)]('cointopay_status_changes',{'type':_0x5a5db4(0x15c),..._0x34bc2a});}[a44_0x213ad4(0x17f)](_0x4063a1){const _0x21fc43=a44_0x213ad4;this[_0x21fc43(0x15e)]('cointopay_errors',{'type':_0x21fc43(0x14f),..._0x4063a1});}[a44_0x213ad4(0x150)](_0x588c17,_0x45ed65,_0x47e607,_0x19c1df,_0x176692,_0x2fe1b0){const _0x470bc1=a44_0x213ad4;this[_0x470bc1(0x15e)](_0x470bc1(0x19d),{'type':_0x470bc1(0x19a),'shopId':_0x588c17,'webhookUrl':_0x45ed65,'event':_0x47e607,'status':_0x19c1df,'responseTime':_0x176692,'payload':_0x2fe1b0});}[a44_0x213ad4(0x171)](_0x3ce2e6,_0x52008d,_0x34c108,_0x574a11,_0x705f51){const _0x5f471a=a44_0x213ad4;this[_0x5f471a(0x15e)]('shop_webhooks_errors',{'type':_0x5f471a(0x15d),'shopId':_0x3ce2e6,'webhookUrl':_0x52008d,'event':_0x34c108,'error':_0x574a11 instanceof Error?{'message':_0x574a11[_0x5f471a(0x188)],'stack':_0x574a11[_0x5f471a(0x154)]}:_0x574a11,'payload':_0x705f51});}[a44_0x213ad4(0x168)](_0x3d548c,_0x1377c5,_0x117fbd,_0x31ee81,_0x1fa6d1){const _0x311061=a44_0x213ad4;this[_0x311061(0x15e)](_0x311061(0x157),{'type':_0x311061(0x18f),'gateway':_0x3d548c,'paymentId':_0x1377c5,'shopId':_0x117fbd,'amount':_0x31ee81,'currency':_0x1fa6d1});}[a44_0x213ad4(0x15a)](_0x53af16,_0x58dc62,_0x13d358,_0x264c34,_0x24ac43){const _0x21d4ed=a44_0x213ad4;this[_0x21d4ed(0x15e)](_0x21d4ed(0x184),{'type':_0x21d4ed(0x163),'endpoint':_0x53af16,'method':_0x58dc62,'userId':_0x13d358,'userRole':_0x264c34,'requestData':_0x24ac43});}[a44_0x213ad4(0x16b)](){const _0x366eb9=a44_0x213ad4;try{const _0x4d5427=fs_1[_0x366eb9(0x161)][_0x366eb9(0x194)](this['logsDir']),_0x5dd140=_0x4d5427[_0x366eb9(0x16a)](_0x5cdeb4=>_0x5cdeb4[_0x366eb9(0x14e)](_0x366eb9(0x15b))),_0x1d1454=[...new Set(_0x5dd140[_0x366eb9(0x164)](_0x3299e9=>_0x3299e9['split']('_')[0x0]))],_0x27aba4=_0x5dd140[_0x366eb9(0x164)](_0x3fbf79=>{const _0x511730=_0x366eb9,_0x24c74b=path_1[_0x511730(0x161)][_0x511730(0x17b)](this['logsDir'],_0x3fbf79),_0x522654=fs_1['default']['statSync'](_0x24c74b),[_0x4b0283,_0x25730b]=_0x3fbf79['replace'](_0x511730(0x15b),'')[_0x511730(0x166)]('_');return{'type':_0x4b0283,'date':_0x25730b,'size':_0x522654[_0x511730(0x155)]};})[_0x366eb9(0x18b)]((_0xfc1668,_0x5d7151)=>_0x5d7151[_0x366eb9(0x18d)][_0x366eb9(0x185)](_0xfc1668['date']));return{'totalFiles':_0x5dd140['length'],'logTypes':_0x1d1454,'latestLogs':_0x27aba4[_0x366eb9(0x187)](0x0,0xa)};}catch(_0x573bf8){return console[_0x366eb9(0x159)]('Failed\x20to\x20get\x20log\x20stats:',_0x573bf8),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x442172=0x1e){const _0x2d8c4b=a44_0x213ad4;try{const _0x5d7df5=fs_1['default'][_0x2d8c4b(0x194)](this[_0x2d8c4b(0x16d)]),_0x46aa21=new Date();_0x46aa21[_0x2d8c4b(0x174)](_0x46aa21['getDate']()-_0x442172);let _0x4f54e6=0x0;_0x5d7df5[_0x2d8c4b(0x18e)](_0x445579=>{const _0x28b4b3=_0x2d8c4b;if(!_0x445579['endsWith'](_0x28b4b3(0x15b)))return;const _0x2ea29b=path_1[_0x28b4b3(0x161)][_0x28b4b3(0x17b)](this[_0x28b4b3(0x16d)],_0x445579),_0x555051=fs_1[_0x28b4b3(0x161)]['statSync'](_0x2ea29b);_0x555051['mtime']<_0x46aa21&&(fs_1[_0x28b4b3(0x161)][_0x28b4b3(0x17a)](_0x2ea29b),_0x4f54e6++,console['log'](_0x28b4b3(0x152)+_0x445579));}),console['log'](_0x2d8c4b(0x195)+_0x4f54e6+_0x2d8c4b(0x18c)+_0x442172+_0x2d8c4b(0x19b));}catch(_0x230f9c){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x230f9c);}}}exports['LoggerService']=LoggerService,exports[a44_0x213ad4(0x186)]=new LoggerService();function a44_0x437c(){const _0x21c196=['loggerService','slice','message','ðŸ“\x20Created\x20logs\x20directory:\x20','logWhiteDomainError','sort','\x20old\x20log\x20files\x20(older\x20than\x20','date','forEach','PAYMENT_CREATED','path','LoggerService','defineProperty','log','readdirSync','ðŸ§¹\x20Cleaned\x20','existsSync','Failed\x20to\x20write\x20','1GEqbYN','appendFileSync','SHOP_WEBHOOK_SENT','\x20days)','__esModule','shop_webhooks_sent','stringify','logWebhookProcessed','30WpXRtq','20yjlzOz','endsWith','COINTOPAY_ERROR','logShopWebhookSent','logs','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','ERROR','stack','size','utf8','payments_created','webhooks_errors','error','logApiCall','.log','COINTOPAY_STATUS_CHANGE','SHOP_WEBHOOK_ERROR','writeLog','7493344IcJejR','logWhiteDomainRequest','default','3111226zikrJa','API_CALL','map','104KkXTWY','split','177321YjqhGD','logPaymentCreated','RESPONSE','filter','getLogStats','logCoinToPayStatus','logsDir','logWebhookReceived','white_domain_responses','toISOString','logShopWebhookError','1024150GvzbsO','white_domain_requests','setDate','221942MbQUQr','2681544yuHdwt','webhooks_received','WEBHOOK_ERROR','9udbYPP','unlinkSync','join','mkdirSync','logWhiteDomainResponse','656445QIGgaO','logCoinToPayError','44JZXiNM','getLogFileName','\x20log:','white_domain_errors','api_calls','localeCompare'];a44_0x437c=function(){return _0x21c196;};return a44_0x437c();}