'use strict';const a47_0x1aad99=a47_0x47e7;(function(_0x572d6e,_0x253f31){const _0x11ab00=a47_0x47e7,_0x116243=_0x572d6e();while(!![]){try{const _0x31058b=-parseInt(_0x11ab00(0x20f))/0x1*(parseInt(_0x11ab00(0x212))/0x2)+-parseInt(_0x11ab00(0x213))/0x3*(parseInt(_0x11ab00(0x1dd))/0x4)+parseInt(_0x11ab00(0x222))/0x5+-parseInt(_0x11ab00(0x202))/0x6+-parseInt(_0x11ab00(0x1f6))/0x7+-parseInt(_0x11ab00(0x1fa))/0x8*(-parseInt(_0x11ab00(0x204))/0x9)+parseInt(_0x11ab00(0x1de))/0xa;if(_0x31058b===_0x253f31)break;else _0x116243['push'](_0x116243['shift']());}catch(_0xc9768d){_0x116243['push'](_0x116243['shift']());}}}(a47_0x19d8,0x50da3));function a47_0x19d8(){const _0x58c661=['400422sLctqU','white_domain_responses','1087497dFUfnV','webhooks_received','setDate','Failed\x20to\x20clean\x20old\x20logs:','__esModule','stringify','logsDir','utf8','payments_created','RESPONSE','split','25wZEgZg','shop_webhooks_errors','WEBHOOK_ERROR','50778wRMJkT','3jDQtuw','ensureLogsDirectory','webhooks_processed','COINTOPAY_STATUS_CHANGE','statSync','join','date','forEach','size','logWhiteDomainResponse','log','logWebhookError','SHOP_WEBHOOK_SENT','getLogFileName','ERROR','726305AJojLl','message','replace','map','\x20days)','cointopay_errors','webhooks_errors','shop_webhooks_sent','length','logPaymentCreated','1276592EcEeQP','15628850eZUeXt','COINTOPAY_ERROR','stack','WEBHOOK_RECEIVED','logShopWebhookError','path','mkdirSync','default','logCoinToPayError','localeCompare','Failed\x20to\x20write\x20','appendFileSync','cwd','slice','PAYMENT_CREATED','loggerService','.log','\x20old\x20log\x20files\x20(older\x20than\x20','🗑️\x20Deleted\x20old\x20log\x20file:\x20','cleanOldLogs','Failed\x20to\x20get\x20log\x20stats:','logWebhookProcessed','SHOP_WEBHOOK_ERROR','WEBHOOK_PROCESSED','3340386bEqvRn','error','white_domain_requests','__importDefault','8RftHgR','LoggerService','logWebhookReceived','readdirSync','writeLog','logs','toISOString','existsSync'];a47_0x19d8=function(){return _0x58c661;};return a47_0x19d8();}var __importDefault=this&&this[a47_0x1aad99(0x1f9)]||function(_0x514505){const _0x42c785=a47_0x1aad99;return _0x514505&&_0x514505[_0x42c785(0x208)]?_0x514505:{'default':_0x514505};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a47_0x1aad99(0x1ed)]=exports[a47_0x1aad99(0x1fb)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a47_0x1aad99(0x1e3)));function a47_0x47e7(_0x1a7138,_0x1e12b4){const _0x19d8bc=a47_0x19d8();return a47_0x47e7=function(_0x47e74d,_0x2a5353){_0x47e74d=_0x47e74d-0x1d4;let _0x342962=_0x19d8bc[_0x47e74d];return _0x342962;},a47_0x47e7(_0x1a7138,_0x1e12b4);}class LoggerService{constructor(){const _0x3ff5c0=a47_0x1aad99;this[_0x3ff5c0(0x20a)]=path_1[_0x3ff5c0(0x1e5)][_0x3ff5c0(0x218)](process[_0x3ff5c0(0x1ea)](),_0x3ff5c0(0x1ff)),this[_0x3ff5c0(0x214)]();}[a47_0x1aad99(0x214)](){const _0x433369=a47_0x1aad99;!fs_1['default'][_0x433369(0x201)](this[_0x433369(0x20a)])&&(fs_1[_0x433369(0x1e5)][_0x433369(0x1e4)](this[_0x433369(0x20a)],{'recursive':!![]}),console[_0x433369(0x21d)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x433369(0x20a)]));}[a47_0x1aad99(0x220)](_0xf90524){const _0x3f6ea9=a47_0x1aad99,_0x4c5397=new Date()[_0x3f6ea9(0x200)]()[_0x3f6ea9(0x20e)]('T')[0x0];return path_1[_0x3f6ea9(0x1e5)][_0x3f6ea9(0x218)](this[_0x3f6ea9(0x20a)],_0xf90524+'_'+_0x4c5397+_0x3f6ea9(0x1ee));}[a47_0x1aad99(0x1fe)](_0x5237a3,_0x28e401){const _0x33107e=a47_0x1aad99;try{const _0xe9add2=new Date()[_0x33107e(0x200)](),_0xbeb0e6={'timestamp':_0xe9add2,..._0x28e401},_0x3248d3=JSON[_0x33107e(0x209)](_0xbeb0e6)+'\x0a',_0x4c29d6=this[_0x33107e(0x220)](_0x5237a3);fs_1[_0x33107e(0x1e5)][_0x33107e(0x1e9)](_0x4c29d6,_0x3248d3,_0x33107e(0x20b));}catch(_0x443925){console[_0x33107e(0x1f7)](_0x33107e(0x1e8)+_0x5237a3+'\x20log:',_0x443925);}}['logWhiteDomainRequest'](_0x5d0a22,_0x254255,_0x407bc6,_0x262635){const _0x154936=a47_0x1aad99;this[_0x154936(0x1fe)](_0x154936(0x1f8),{'type':'REQUEST','gateway':_0x5d0a22,'endpoint':_0x254255,'method':_0x407bc6,'data':_0x262635});}[a47_0x1aad99(0x21c)](_0x418916,_0x13467b,_0x52b783,_0x29b2e3,_0x3c385c){const _0xe1fbfa=a47_0x1aad99;this[_0xe1fbfa(0x1fe)](_0xe1fbfa(0x203),{'type':_0xe1fbfa(0x20d),'gateway':_0x418916,'endpoint':_0x13467b,'status':_0x52b783,'responseTime':_0x3c385c,'data':_0x29b2e3});}['logWhiteDomainError'](_0x2bf08e,_0x106e41,_0x4dc9e9){const _0x9a4448=a47_0x1aad99;this[_0x9a4448(0x1fe)]('white_domain_errors',{'type':_0x9a4448(0x221),'gateway':_0x2bf08e,'endpoint':_0x106e41,'error':_0x4dc9e9 instanceof Error?{'message':_0x4dc9e9['message'],'stack':_0x4dc9e9['stack']}:_0x4dc9e9});}[a47_0x1aad99(0x1fc)](_0x41e8b0,_0x5c73f5,_0xf3abf2){const _0x101f1e=a47_0x1aad99;this[_0x101f1e(0x1fe)](_0x101f1e(0x205),{'type':_0x101f1e(0x1e1),'gateway':_0x41e8b0,'headers':_0xf3abf2,'data':_0x5c73f5});}[a47_0x1aad99(0x1f3)](_0x21b738,_0x51e079,_0x1df538,_0x466712,_0x76e35e){const _0x4f8afe=a47_0x1aad99;this['writeLog'](_0x4f8afe(0x215),{'type':_0x4f8afe(0x1f5),'gateway':_0x21b738,'paymentId':_0x51e079,'oldStatus':_0x1df538,'newStatus':_0x466712,'originalData':_0x76e35e});}[a47_0x1aad99(0x21e)](_0xc5af59,_0x2b230d,_0x5c7532){const _0x3cd10b=a47_0x1aad99;this[_0x3cd10b(0x1fe)](_0x3cd10b(0x1d9),{'type':_0x3cd10b(0x211),'gateway':_0xc5af59,'error':_0x2b230d instanceof Error?{'message':_0x2b230d[_0x3cd10b(0x1d4)],'stack':_0x2b230d[_0x3cd10b(0x1e0)]}:_0x2b230d,'originalData':_0x5c7532});}['logCoinToPayStatus'](_0x21dae2){const _0x1a00fd=a47_0x1aad99;this['writeLog']('cointopay_status_changes',{'type':_0x1a00fd(0x216),..._0x21dae2});}[a47_0x1aad99(0x1e6)](_0x50604b){const _0x5d3482=a47_0x1aad99;this[_0x5d3482(0x1fe)](_0x5d3482(0x1d8),{'type':_0x5d3482(0x1df),..._0x50604b});}['logShopWebhookSent'](_0x20d46c,_0x350d16,_0x438688,_0x3c9eb2,_0x4c6d82,_0x4592b4){const _0x28cbec=a47_0x1aad99;this[_0x28cbec(0x1fe)](_0x28cbec(0x1da),{'type':_0x28cbec(0x21f),'shopId':_0x20d46c,'webhookUrl':_0x350d16,'event':_0x438688,'status':_0x3c9eb2,'responseTime':_0x4c6d82,'payload':_0x4592b4});}[a47_0x1aad99(0x1e2)](_0x2c1a0e,_0xb0809f,_0x5567ea,_0x2fb939,_0x50593e){const _0xaad53f=a47_0x1aad99;this[_0xaad53f(0x1fe)](_0xaad53f(0x210),{'type':_0xaad53f(0x1f4),'shopId':_0x2c1a0e,'webhookUrl':_0xb0809f,'event':_0x5567ea,'error':_0x2fb939 instanceof Error?{'message':_0x2fb939[_0xaad53f(0x1d4)],'stack':_0x2fb939['stack']}:_0x2fb939,'payload':_0x50593e});}[a47_0x1aad99(0x1dc)](_0x4b7422,_0x6466d5,_0x5c5425,_0x3ab894,_0x205229){const _0x3f5547=a47_0x1aad99;this[_0x3f5547(0x1fe)](_0x3f5547(0x20c),{'type':_0x3f5547(0x1ec),'gateway':_0x4b7422,'paymentId':_0x6466d5,'shopId':_0x5c5425,'amount':_0x3ab894,'currency':_0x205229});}['logApiCall'](_0x29998f,_0x5ca38c,_0x4bf04e,_0x5c9760,_0x844929){const _0x271d0d=a47_0x1aad99;this[_0x271d0d(0x1fe)]('api_calls',{'type':'API_CALL','endpoint':_0x29998f,'method':_0x5ca38c,'userId':_0x4bf04e,'userRole':_0x5c9760,'requestData':_0x844929});}['getLogStats'](){const _0x3071a4=a47_0x1aad99;try{const _0x5cb8ee=fs_1[_0x3071a4(0x1e5)]['readdirSync'](this['logsDir']),_0x57a63d=_0x5cb8ee['filter'](_0x13c330=>_0x13c330['endsWith'](_0x3071a4(0x1ee))),_0x43de4d=[...new Set(_0x57a63d[_0x3071a4(0x1d6)](_0x34800e=>_0x34800e['split']('_')[0x0]))],_0x4668bb=_0x57a63d[_0x3071a4(0x1d6)](_0x12d40a=>{const _0x567f69=_0x3071a4,_0x43e550=path_1[_0x567f69(0x1e5)][_0x567f69(0x218)](this['logsDir'],_0x12d40a),_0x472c14=fs_1['default'][_0x567f69(0x217)](_0x43e550),[_0x1b4f95,_0x5a8f0c]=_0x12d40a[_0x567f69(0x1d5)](_0x567f69(0x1ee),'')[_0x567f69(0x20e)]('_');return{'type':_0x1b4f95,'date':_0x5a8f0c,'size':_0x472c14[_0x567f69(0x21b)]};})['sort']((_0x4785db,_0x34a561)=>_0x34a561[_0x3071a4(0x219)][_0x3071a4(0x1e7)](_0x4785db[_0x3071a4(0x219)]));return{'totalFiles':_0x57a63d[_0x3071a4(0x1db)],'logTypes':_0x43de4d,'latestLogs':_0x4668bb[_0x3071a4(0x1eb)](0x0,0xa)};}catch(_0x296b11){return console[_0x3071a4(0x1f7)](_0x3071a4(0x1f2),_0x296b11),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a47_0x1aad99(0x1f1)](_0x48f536=0x1e){const _0x49ddd2=a47_0x1aad99;try{const _0x3fb5f3=fs_1[_0x49ddd2(0x1e5)][_0x49ddd2(0x1fd)](this[_0x49ddd2(0x20a)]),_0x43b930=new Date();_0x43b930[_0x49ddd2(0x206)](_0x43b930['getDate']()-_0x48f536);let _0x22249a=0x0;_0x3fb5f3[_0x49ddd2(0x21a)](_0x5399f0=>{const _0x3f0bf2=_0x49ddd2;if(!_0x5399f0['endsWith'](_0x3f0bf2(0x1ee)))return;const _0x566b3b=path_1[_0x3f0bf2(0x1e5)][_0x3f0bf2(0x218)](this[_0x3f0bf2(0x20a)],_0x5399f0),_0x1e4955=fs_1['default'][_0x3f0bf2(0x217)](_0x566b3b);_0x1e4955['mtime']<_0x43b930&&(fs_1[_0x3f0bf2(0x1e5)]['unlinkSync'](_0x566b3b),_0x22249a++,console[_0x3f0bf2(0x21d)](_0x3f0bf2(0x1f0)+_0x5399f0));}),console[_0x49ddd2(0x21d)]('🧹\x20Cleaned\x20'+_0x22249a+_0x49ddd2(0x1ef)+_0x48f536+_0x49ddd2(0x1d7));}catch(_0x4ba217){console['error'](_0x49ddd2(0x207),_0x4ba217);}}}exports[a47_0x1aad99(0x1fb)]=LoggerService,exports['loggerService']=new LoggerService();