'use strict';const a51_0x32e468=a51_0x2277;(function(_0x342855,_0x88b083){const _0x15eef6=a51_0x2277,_0x5bad39=_0x342855();while(!![]){try{const _0x15ccd4=parseInt(_0x15eef6(0x19a))/0x1+-parseInt(_0x15eef6(0x1ac))/0x2*(-parseInt(_0x15eef6(0x1b0))/0x3)+parseInt(_0x15eef6(0x187))/0x4*(-parseInt(_0x15eef6(0x1ad))/0x5)+-parseInt(_0x15eef6(0x19f))/0x6+-parseInt(_0x15eef6(0x168))/0x7*(-parseInt(_0x15eef6(0x16c))/0x8)+-parseInt(_0x15eef6(0x171))/0x9+parseInt(_0x15eef6(0x1a3))/0xa;if(_0x15ccd4===_0x88b083)break;else _0x5bad39['push'](_0x5bad39['shift']());}catch(_0x32783f){_0x5bad39['push'](_0x5bad39['shift']());}}}(a51_0x1831,0xe56f1));var __importDefault=this&&this[a51_0x32e468(0x194)]||function(_0x50f4f9){return _0x50f4f9&&_0x50f4f9['__esModule']?_0x50f4f9:{'default':_0x50f4f9};};function a51_0x2277(_0x48143b,_0x1b606e){const _0x1831e6=a51_0x1831();return a51_0x2277=function(_0x22776c,_0x1be507){_0x22776c=_0x22776c-0x161;let _0x2d19e8=_0x1831e6[_0x22776c];return _0x2d19e8;},a51_0x2277(_0x48143b,_0x1b606e);}Object['defineProperty'](exports,a51_0x32e468(0x189),{'value':!![]}),exports[a51_0x32e468(0x181)]=exports[a51_0x32e468(0x164)]=void 0x0;function a51_0x1831(){const _0x35d93e=['toISOString','cointopay_status_changes','path','1012218XUXmZS','slice','📁\x20Created\x20logs\x20directory:\x20','logCoinToPayStatus','3269300oazdCA','.log','stack','logCoinToPayError','logWhiteDomainError','shop_webhooks_errors','webhooks_received','Failed\x20to\x20get\x20log\x20stats:','🗑️\x20Deleted\x20old\x20log\x20file:\x20','6aFYNvt','46985VjIoTV','date','default','842901rcwqOo','Failed\x20to\x20clean\x20old\x20logs:','cointopay_errors','localeCompare','🧹\x20Cleaned\x20','existsSync','white_domain_requests','LoggerService','mtime','mkdirSync','utf8','98nqzpXp','map','logs','error','703320hklLwG','COINTOPAY_ERROR','unlinkSync','readdirSync','logWhiteDomainRequest','12392892eeQrRT','split','writeLog','statSync','getLogFileName','replace','SHOP_WEBHOOK_SENT','RESPONSE','WEBHOOK_PROCESSED','getDate','logWhiteDomainResponse','API_CALL','ensureLogsDirectory','logWebhookError','SHOP_WEBHOOK_ERROR','setDate','loggerService','PAYMENT_CREATED','logPaymentCreated','log','api_calls','\x20days)','44NDLFdZ','\x20old\x20log\x20files\x20(older\x20than\x20','__esModule','logWebhookReceived','cleanOldLogs','Failed\x20to\x20write\x20','WEBHOOK_ERROR','COINTOPAY_STATUS_CHANGE','join','sort','payments_created','logWebhookProcessed','logShopWebhookError','__importDefault','shop_webhooks_sent','logsDir','\x20log:','endsWith','webhooks_processed','188178kRVajt','white_domain_responses'];a51_0x1831=function(){return _0x35d93e;};return a51_0x1831();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x32e468(0x19e)));class LoggerService{constructor(){const _0x216d5c=a51_0x32e468;this[_0x216d5c(0x196)]=path_1['default'][_0x216d5c(0x18f)](process['cwd'](),_0x216d5c(0x16a)),this['ensureLogsDirectory']();}[a51_0x32e468(0x17d)](){const _0x46b43f=a51_0x32e468;!fs_1[_0x46b43f(0x1af)][_0x46b43f(0x162)](this['logsDir'])&&(fs_1[_0x46b43f(0x1af)][_0x46b43f(0x166)](this[_0x46b43f(0x196)],{'recursive':!![]}),console[_0x46b43f(0x184)](_0x46b43f(0x1a1)+this[_0x46b43f(0x196)]));}[a51_0x32e468(0x175)](_0x114846){const _0x5a5bb4=a51_0x32e468,_0x5aab39=new Date()[_0x5a5bb4(0x19c)]()[_0x5a5bb4(0x172)]('T')[0x0];return path_1['default'][_0x5a5bb4(0x18f)](this['logsDir'],_0x114846+'_'+_0x5aab39+_0x5a5bb4(0x1a4));}[a51_0x32e468(0x173)](_0x561d2b,_0x5736ab){const _0xecd750=a51_0x32e468;try{const _0xeb3517=new Date()[_0xecd750(0x19c)](),_0x5e4299={'timestamp':_0xeb3517,..._0x5736ab},_0x480507=JSON['stringify'](_0x5e4299)+'\x0a',_0x3ea7fb=this[_0xecd750(0x175)](_0x561d2b);fs_1['default']['appendFileSync'](_0x3ea7fb,_0x480507,_0xecd750(0x167));}catch(_0x37aa52){console['error'](_0xecd750(0x18c)+_0x561d2b+_0xecd750(0x197),_0x37aa52);}}[a51_0x32e468(0x170)](_0x47a271,_0x5a8505,_0x127992,_0x2c79b1){const _0x59afcd=a51_0x32e468;this[_0x59afcd(0x173)](_0x59afcd(0x163),{'type':'REQUEST','gateway':_0x47a271,'endpoint':_0x5a8505,'method':_0x127992,'data':_0x2c79b1});}[a51_0x32e468(0x17b)](_0xfb1525,_0x2d79cc,_0x3a8703,_0x1cd215,_0x381db9){const _0x1f3b55=a51_0x32e468;this[_0x1f3b55(0x173)](_0x1f3b55(0x19b),{'type':_0x1f3b55(0x178),'gateway':_0xfb1525,'endpoint':_0x2d79cc,'status':_0x3a8703,'responseTime':_0x381db9,'data':_0x1cd215});}[a51_0x32e468(0x1a7)](_0x303c95,_0x5af80c,_0xd87d2d){const _0x4e8db8=a51_0x32e468;this['writeLog']('white_domain_errors',{'type':'ERROR','gateway':_0x303c95,'endpoint':_0x5af80c,'error':_0xd87d2d instanceof Error?{'message':_0xd87d2d['message'],'stack':_0xd87d2d[_0x4e8db8(0x1a5)]}:_0xd87d2d});}[a51_0x32e468(0x18a)](_0x19394e,_0x240fb0,_0xff0d63){const _0x284251=a51_0x32e468;this[_0x284251(0x173)](_0x284251(0x1a9),{'type':'WEBHOOK_RECEIVED','gateway':_0x19394e,'headers':_0xff0d63,'data':_0x240fb0});}[a51_0x32e468(0x192)](_0x3c9864,_0x1ea36e,_0x2e6b93,_0x74c274,_0x2525f4){const _0x43a9e8=a51_0x32e468;this['writeLog'](_0x43a9e8(0x199),{'type':_0x43a9e8(0x179),'gateway':_0x3c9864,'paymentId':_0x1ea36e,'oldStatus':_0x2e6b93,'newStatus':_0x74c274,'originalData':_0x2525f4});}[a51_0x32e468(0x17e)](_0x4046e7,_0x4bb26f,_0x4f0c63){const _0x47e97a=a51_0x32e468;this[_0x47e97a(0x173)]('webhooks_errors',{'type':_0x47e97a(0x18d),'gateway':_0x4046e7,'error':_0x4bb26f instanceof Error?{'message':_0x4bb26f['message'],'stack':_0x4bb26f[_0x47e97a(0x1a5)]}:_0x4bb26f,'originalData':_0x4f0c63});}[a51_0x32e468(0x1a2)](_0x1a72f6){const _0xb80e66=a51_0x32e468;this[_0xb80e66(0x173)](_0xb80e66(0x19d),{'type':_0xb80e66(0x18e),..._0x1a72f6});}[a51_0x32e468(0x1a6)](_0x25eb45){const _0x424e67=a51_0x32e468;this['writeLog'](_0x424e67(0x1b2),{'type':_0x424e67(0x16d),..._0x25eb45});}['logShopWebhookSent'](_0x127d1e,_0x5244c1,_0x5b687e,_0x7f764c,_0x2ffd64,_0xad2640){const _0x3b3da3=a51_0x32e468;this[_0x3b3da3(0x173)](_0x3b3da3(0x195),{'type':_0x3b3da3(0x177),'shopId':_0x127d1e,'webhookUrl':_0x5244c1,'event':_0x5b687e,'status':_0x7f764c,'responseTime':_0x2ffd64,'payload':_0xad2640});}[a51_0x32e468(0x193)](_0x260037,_0xb3f8d9,_0x432909,_0x4d3124,_0x5a6b6a){const _0xec7b5b=a51_0x32e468;this[_0xec7b5b(0x173)](_0xec7b5b(0x1a8),{'type':_0xec7b5b(0x17f),'shopId':_0x260037,'webhookUrl':_0xb3f8d9,'event':_0x432909,'error':_0x4d3124 instanceof Error?{'message':_0x4d3124['message'],'stack':_0x4d3124[_0xec7b5b(0x1a5)]}:_0x4d3124,'payload':_0x5a6b6a});}[a51_0x32e468(0x183)](_0x410c4e,_0x3a2f49,_0x38a96,_0x4043b9,_0x2f0be5){const _0x43f0c9=a51_0x32e468;this[_0x43f0c9(0x173)](_0x43f0c9(0x191),{'type':_0x43f0c9(0x182),'gateway':_0x410c4e,'paymentId':_0x3a2f49,'shopId':_0x38a96,'amount':_0x4043b9,'currency':_0x2f0be5});}['logApiCall'](_0xe06def,_0x178856,_0x33737b,_0x1636b2,_0x357324){const _0x2a35ee=a51_0x32e468;this[_0x2a35ee(0x173)](_0x2a35ee(0x185),{'type':_0x2a35ee(0x17c),'endpoint':_0xe06def,'method':_0x178856,'userId':_0x33737b,'userRole':_0x1636b2,'requestData':_0x357324});}['getLogStats'](){const _0x566f6a=a51_0x32e468;try{const _0x34dd0b=fs_1[_0x566f6a(0x1af)][_0x566f6a(0x16f)](this[_0x566f6a(0x196)]),_0x52428d=_0x34dd0b['filter'](_0x4846bf=>_0x4846bf[_0x566f6a(0x198)](_0x566f6a(0x1a4))),_0xc1ccb2=[...new Set(_0x52428d[_0x566f6a(0x169)](_0x9a47d6=>_0x9a47d6['split']('_')[0x0]))],_0x3707cc=_0x52428d[_0x566f6a(0x169)](_0x317259=>{const _0x553675=_0x566f6a,_0x1bc1ef=path_1['default']['join'](this[_0x553675(0x196)],_0x317259),_0x24f214=fs_1[_0x553675(0x1af)][_0x553675(0x174)](_0x1bc1ef),[_0x18113f,_0x37dbd4]=_0x317259[_0x553675(0x176)](_0x553675(0x1a4),'')['split']('_');return{'type':_0x18113f,'date':_0x37dbd4,'size':_0x24f214['size']};})[_0x566f6a(0x190)]((_0x57ee9c,_0x2ef9b1)=>_0x2ef9b1['date'][_0x566f6a(0x1b3)](_0x57ee9c[_0x566f6a(0x1ae)]));return{'totalFiles':_0x52428d['length'],'logTypes':_0xc1ccb2,'latestLogs':_0x3707cc[_0x566f6a(0x1a0)](0x0,0xa)};}catch(_0x5b5b15){return console['error'](_0x566f6a(0x1aa),_0x5b5b15),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x32e468(0x18b)](_0x2f0764=0x1e){const _0x340f86=a51_0x32e468;try{const _0x1fe6af=fs_1[_0x340f86(0x1af)]['readdirSync'](this[_0x340f86(0x196)]),_0x53cd05=new Date();_0x53cd05[_0x340f86(0x180)](_0x53cd05[_0x340f86(0x17a)]()-_0x2f0764);let _0x4caea3=0x0;_0x1fe6af['forEach'](_0x5257a6=>{const _0xc30525=_0x340f86;if(!_0x5257a6['endsWith'](_0xc30525(0x1a4)))return;const _0x242c93=path_1[_0xc30525(0x1af)]['join'](this[_0xc30525(0x196)],_0x5257a6),_0x426a3c=fs_1[_0xc30525(0x1af)][_0xc30525(0x174)](_0x242c93);_0x426a3c[_0xc30525(0x165)]<_0x53cd05&&(fs_1[_0xc30525(0x1af)][_0xc30525(0x16e)](_0x242c93),_0x4caea3++,console[_0xc30525(0x184)](_0xc30525(0x1ab)+_0x5257a6));}),console[_0x340f86(0x184)](_0x340f86(0x161)+_0x4caea3+_0x340f86(0x188)+_0x2f0764+_0x340f86(0x186));}catch(_0x99a36c){console[_0x340f86(0x16b)](_0x340f86(0x1b1),_0x99a36c);}}}exports[a51_0x32e468(0x164)]=LoggerService,exports['loggerService']=new LoggerService();