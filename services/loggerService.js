'use strict';const a48_0x342527=a48_0x4811;function a48_0xc734(){const _0x21a060=['toISOString','logsDir','logApiCall','WEBHOOK_ERROR','666550hfhVOo','logPaymentCreated','logCoinToPayStatus','setDate','cointopay_errors','size','REQUEST','logWhiteDomainResponse','filter','LoggerService','mkdirSync','WEBHOOK_RECEIVED','default','2113104PWZBSJ','cointopay_status_changes','getLogStats','white_domain_requests','getDate','1107915wRUazZ','length','Failed\x20to\x20get\x20log\x20stats:','PAYMENT_CREATED','stringify','split','🧹\x20Cleaned\x20','stack','Failed\x20to\x20clean\x20old\x20logs:','white_domain_responses','220xhFAsw','log','endsWith','api_calls','webhooks_errors','replace','cwd','1385868CitasM','ensureLogsDirectory','307895EsfRAp','\x20days)','date','message','existsSync','unlinkSync','loggerService','shop_webhooks_sent','writeLog','statSync','map','payments_created','logShopWebhookSent','RESPONSE','join','\x20old\x20log\x20files\x20(older\x20than\x20','__esModule','slice','getLogFileName','logs','logWhiteDomainError','logWebhookProcessed','WEBHOOK_PROCESSED','forEach','API_CALL','white_domain_errors','webhooks_received','.log','9nncASX','localeCompare','webhooks_processed','readdirSync','72fawKDZ','sort','5859665QiIocY','4BBOSdm','\x20log:','📁\x20Created\x20logs\x20directory:\x20','COINTOPAY_STATUS_CHANGE','error','Failed\x20to\x20write\x20','logWhiteDomainRequest','shop_webhooks_errors','utf8','__importDefault','cleanOldLogs','SHOP_WEBHOOK_SENT','SHOP_WEBHOOK_ERROR','6002vHFwJl'];a48_0xc734=function(){return _0x21a060;};return a48_0xc734();}(function(_0x123b3c,_0x2aeb48){const _0x3de06a=a48_0x4811,_0x2aee26=_0x123b3c();while(!![]){try{const _0x5367fd=-parseInt(_0x3de06a(0x18f))/0x1*(parseInt(_0x3de06a(0x182))/0x2)+parseInt(_0x3de06a(0x14c))/0x3+parseInt(_0x3de06a(0x15d))/0x4+parseInt(_0x3de06a(0x15f))/0x5*(-parseInt(_0x3de06a(0x17f))/0x6)+-parseInt(_0x3de06a(0x181))/0x7+parseInt(_0x3de06a(0x1a1))/0x8*(parseInt(_0x3de06a(0x17b))/0x9)+-parseInt(_0x3de06a(0x194))/0xa*(-parseInt(_0x3de06a(0x156))/0xb);if(_0x5367fd===_0x2aeb48)break;else _0x2aee26['push'](_0x2aee26['shift']());}catch(_0x50636d){_0x2aee26['push'](_0x2aee26['shift']());}}}(a48_0xc734,0xb0fe3));var __importDefault=this&&this[a48_0x342527(0x18b)]||function(_0x2d4077){const _0xb8f945=a48_0x342527;return _0x2d4077&&_0x2d4077[_0xb8f945(0x16f)]?_0x2d4077:{'default':_0x2d4077};};Object['defineProperty'](exports,a48_0x342527(0x16f),{'value':!![]}),exports[a48_0x342527(0x165)]=exports[a48_0x342527(0x19d)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x5f007c=a48_0x342527;this[_0x5f007c(0x191)]=path_1[_0x5f007c(0x1a0)][_0x5f007c(0x16d)](process[_0x5f007c(0x15c)](),_0x5f007c(0x172)),this[_0x5f007c(0x15e)]();}['ensureLogsDirectory'](){const _0x5e152a=a48_0x342527;!fs_1['default'][_0x5e152a(0x163)](this['logsDir'])&&(fs_1['default'][_0x5e152a(0x19e)](this[_0x5e152a(0x191)],{'recursive':!![]}),console[_0x5e152a(0x157)](_0x5e152a(0x184)+this[_0x5e152a(0x191)]));}['getLogFileName'](_0x2ce945){const _0x3938de=a48_0x342527,_0xf98953=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x3938de(0x1a0)][_0x3938de(0x16d)](this[_0x3938de(0x191)],_0x2ce945+'_'+_0xf98953+_0x3938de(0x17a));}['writeLog'](_0x14bb49,_0x50acd7){const _0x837051=a48_0x342527;try{const _0x50af69=new Date()[_0x837051(0x190)](),_0x557e86={'timestamp':_0x50af69,..._0x50acd7},_0x2e09e4=JSON[_0x837051(0x150)](_0x557e86)+'\x0a',_0x18a9e7=this[_0x837051(0x171)](_0x14bb49);fs_1[_0x837051(0x1a0)]['appendFileSync'](_0x18a9e7,_0x2e09e4,_0x837051(0x18a));}catch(_0x555bb3){console[_0x837051(0x186)](_0x837051(0x187)+_0x14bb49+_0x837051(0x183),_0x555bb3);}}[a48_0x342527(0x188)](_0x25bb09,_0x58a724,_0x469acb,_0xac4af0){const _0x30fe06=a48_0x342527;this['writeLog'](_0x30fe06(0x14a),{'type':_0x30fe06(0x19a),'gateway':_0x25bb09,'endpoint':_0x58a724,'method':_0x469acb,'data':_0xac4af0});}[a48_0x342527(0x19b)](_0x1b2dcf,_0x201ca3,_0x336dcd,_0x2b46a3,_0x535d04){const _0xbe8543=a48_0x342527;this[_0xbe8543(0x167)](_0xbe8543(0x155),{'type':_0xbe8543(0x16c),'gateway':_0x1b2dcf,'endpoint':_0x201ca3,'status':_0x336dcd,'responseTime':_0x535d04,'data':_0x2b46a3});}[a48_0x342527(0x173)](_0x32ab84,_0x337ede,_0x3bb19c){const _0x357391=a48_0x342527;this['writeLog'](_0x357391(0x178),{'type':'ERROR','gateway':_0x32ab84,'endpoint':_0x337ede,'error':_0x3bb19c instanceof Error?{'message':_0x3bb19c[_0x357391(0x162)],'stack':_0x3bb19c[_0x357391(0x153)]}:_0x3bb19c});}['logWebhookReceived'](_0x43aaf9,_0x4fe08f,_0x216a9e){const _0x4fe93a=a48_0x342527;this[_0x4fe93a(0x167)](_0x4fe93a(0x179),{'type':_0x4fe93a(0x19f),'gateway':_0x43aaf9,'headers':_0x216a9e,'data':_0x4fe08f});}[a48_0x342527(0x174)](_0x5e874d,_0x304dfc,_0x5eec19,_0x431871,_0x1f8a30){const _0x148a2f=a48_0x342527;this['writeLog'](_0x148a2f(0x17d),{'type':_0x148a2f(0x175),'gateway':_0x5e874d,'paymentId':_0x304dfc,'oldStatus':_0x5eec19,'newStatus':_0x431871,'originalData':_0x1f8a30});}['logWebhookError'](_0x29143e,_0x12c46d,_0x260681){const _0x59e9b8=a48_0x342527;this[_0x59e9b8(0x167)](_0x59e9b8(0x15a),{'type':_0x59e9b8(0x193),'gateway':_0x29143e,'error':_0x12c46d instanceof Error?{'message':_0x12c46d[_0x59e9b8(0x162)],'stack':_0x12c46d['stack']}:_0x12c46d,'originalData':_0x260681});}[a48_0x342527(0x196)](_0x2020aa){const _0x39796b=a48_0x342527;this['writeLog'](_0x39796b(0x148),{'type':_0x39796b(0x185),..._0x2020aa});}['logCoinToPayError'](_0x4a3825){const _0x18a76f=a48_0x342527;this[_0x18a76f(0x167)](_0x18a76f(0x198),{'type':'COINTOPAY_ERROR',..._0x4a3825});}[a48_0x342527(0x16b)](_0x2dc821,_0x1c09fa,_0x4face0,_0x56415f,_0x30564e,_0xf6ba62){const _0x3140d3=a48_0x342527;this[_0x3140d3(0x167)](_0x3140d3(0x166),{'type':_0x3140d3(0x18d),'shopId':_0x2dc821,'webhookUrl':_0x1c09fa,'event':_0x4face0,'status':_0x56415f,'responseTime':_0x30564e,'payload':_0xf6ba62});}['logShopWebhookError'](_0x18b971,_0x3cef43,_0x50cf37,_0x34db8e,_0x2d5a8d){const _0x3a22d9=a48_0x342527;this[_0x3a22d9(0x167)](_0x3a22d9(0x189),{'type':_0x3a22d9(0x18e),'shopId':_0x18b971,'webhookUrl':_0x3cef43,'event':_0x50cf37,'error':_0x34db8e instanceof Error?{'message':_0x34db8e[_0x3a22d9(0x162)],'stack':_0x34db8e['stack']}:_0x34db8e,'payload':_0x2d5a8d});}[a48_0x342527(0x195)](_0x23078d,_0x44defd,_0x1ae2ba,_0xb3f8dc,_0x2045bb){const _0x23a7fb=a48_0x342527;this[_0x23a7fb(0x167)](_0x23a7fb(0x16a),{'type':_0x23a7fb(0x14f),'gateway':_0x23078d,'paymentId':_0x44defd,'shopId':_0x1ae2ba,'amount':_0xb3f8dc,'currency':_0x2045bb});}[a48_0x342527(0x192)](_0x1ee5d0,_0x4c2790,_0x38d5e5,_0x3bdd0c,_0x952c06){const _0x55c210=a48_0x342527;this[_0x55c210(0x167)](_0x55c210(0x159),{'type':_0x55c210(0x177),'endpoint':_0x1ee5d0,'method':_0x4c2790,'userId':_0x38d5e5,'userRole':_0x3bdd0c,'requestData':_0x952c06});}[a48_0x342527(0x149)](){const _0x2fd395=a48_0x342527;try{const _0x437940=fs_1['default'][_0x2fd395(0x17e)](this['logsDir']),_0x1e2b4a=_0x437940[_0x2fd395(0x19c)](_0x4ed543=>_0x4ed543[_0x2fd395(0x158)](_0x2fd395(0x17a))),_0x458621=[...new Set(_0x1e2b4a[_0x2fd395(0x169)](_0x1c4fac=>_0x1c4fac[_0x2fd395(0x151)]('_')[0x0]))],_0x758434=_0x1e2b4a[_0x2fd395(0x169)](_0x1b417b=>{const _0x27f1f0=_0x2fd395,_0x444ef5=path_1[_0x27f1f0(0x1a0)][_0x27f1f0(0x16d)](this[_0x27f1f0(0x191)],_0x1b417b),_0x134628=fs_1[_0x27f1f0(0x1a0)][_0x27f1f0(0x168)](_0x444ef5),[_0x585b37,_0x4a5473]=_0x1b417b[_0x27f1f0(0x15b)]('.log','')[_0x27f1f0(0x151)]('_');return{'type':_0x585b37,'date':_0x4a5473,'size':_0x134628[_0x27f1f0(0x199)]};})[_0x2fd395(0x180)]((_0x56cb90,_0x59bd39)=>_0x59bd39[_0x2fd395(0x161)][_0x2fd395(0x17c)](_0x56cb90[_0x2fd395(0x161)]));return{'totalFiles':_0x1e2b4a[_0x2fd395(0x14d)],'logTypes':_0x458621,'latestLogs':_0x758434[_0x2fd395(0x170)](0x0,0xa)};}catch(_0x22edc9){return console[_0x2fd395(0x186)](_0x2fd395(0x14e),_0x22edc9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x342527(0x18c)](_0x10675f=0x1e){const _0x1825da=a48_0x342527;try{const _0x531e79=fs_1['default'][_0x1825da(0x17e)](this['logsDir']),_0x52e583=new Date();_0x52e583[_0x1825da(0x197)](_0x52e583[_0x1825da(0x14b)]()-_0x10675f);let _0x29d1b2=0x0;_0x531e79[_0x1825da(0x176)](_0x1d2701=>{const _0x3b3dfb=_0x1825da;if(!_0x1d2701['endsWith'](_0x3b3dfb(0x17a)))return;const _0x46852c=path_1[_0x3b3dfb(0x1a0)]['join'](this[_0x3b3dfb(0x191)],_0x1d2701),_0x545e91=fs_1[_0x3b3dfb(0x1a0)]['statSync'](_0x46852c);_0x545e91['mtime']<_0x52e583&&(fs_1[_0x3b3dfb(0x1a0)][_0x3b3dfb(0x164)](_0x46852c),_0x29d1b2++,console[_0x3b3dfb(0x157)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x1d2701));}),console['log'](_0x1825da(0x152)+_0x29d1b2+_0x1825da(0x16e)+_0x10675f+_0x1825da(0x160));}catch(_0x12b5a4){console[_0x1825da(0x186)](_0x1825da(0x154),_0x12b5a4);}}}function a48_0x4811(_0x41f601,_0x450697){const _0xc7349a=a48_0xc734();return a48_0x4811=function(_0x4811f7,_0x54bc01){_0x4811f7=_0x4811f7-0x148;let _0x31fa1e=_0xc7349a[_0x4811f7];return _0x31fa1e;},a48_0x4811(_0x41f601,_0x450697);}exports[a48_0x342527(0x19d)]=LoggerService,exports[a48_0x342527(0x165)]=new LoggerService();