'use strict';function a59_0x4ce9(_0x5b7e86,_0x174999){const _0x658151=a59_0x6581();return a59_0x4ce9=function(_0x4ce90e,_0x36465d){_0x4ce90e=_0x4ce90e-0x14b;let _0x341ce7=_0x658151[_0x4ce90e];return _0x341ce7;},a59_0x4ce9(_0x5b7e86,_0x174999);}const a59_0x8070d1=a59_0x4ce9;(function(_0x2d1f55,_0x20c2b0){const _0x275f86=a59_0x4ce9,_0x52a93f=_0x2d1f55();while(!![]){try{const _0x9c47e5=parseInt(_0x275f86(0x14b))/0x1+parseInt(_0x275f86(0x193))/0x2+-parseInt(_0x275f86(0x166))/0x3*(parseInt(_0x275f86(0x17b))/0x4)+parseInt(_0x275f86(0x14e))/0x5+parseInt(_0x275f86(0x173))/0x6+parseInt(_0x275f86(0x196))/0x7*(parseInt(_0x275f86(0x18a))/0x8)+-parseInt(_0x275f86(0x167))/0x9;if(_0x9c47e5===_0x20c2b0)break;else _0x52a93f['push'](_0x52a93f['shift']());}catch(_0x2cebc1){_0x52a93f['push'](_0x52a93f['shift']());}}}(a59_0x6581,0x8299c));var __importDefault=this&&this[a59_0x8070d1(0x169)]||function(_0x4ae45e){const _0x331d5e=a59_0x8070d1;return _0x4ae45e&&_0x4ae45e[_0x331d5e(0x188)]?_0x4ae45e:{'default':_0x4ae45e};};Object[a59_0x8070d1(0x153)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x8070d1(0x16a)));function a59_0x6581(){const _0x27e939=['readdirSync','cointopay_errors','__esModule','toISOString','3600htwBUH','shop_webhooks_errors','cleanOldLogs','COINTOPAY_STATUS_CHANGE','error','log','Failed\x20to\x20clean\x20old\x20logs:','ensureLogsDirectory','stack','851748oPifpu','\x20days)','webhooks_errors','1554yZUzhD','default','WEBHOOK_ERROR','split','replace','join','WEBHOOK_RECEIVED','api_calls','933028eyWanC','slice','SHOP_WEBHOOK_SENT','3885005kCLupB','\x20old\x20log\x20files\x20(older\x20than\x20','.log','🗑️\x20Deleted\x20old\x20log\x20file:\x20','cwd','defineProperty','logShopWebhookError','white_domain_responses','statSync','shop_webhooks_sent','unlinkSync','WEBHOOK_PROCESSED','map','COINTOPAY_ERROR','getDate','writeLog','🧹\x20Cleaned\x20','getLogFileName','logWebhookReceived','Failed\x20to\x20get\x20log\x20stats:','utf8','white_domain_errors','logPaymentCreated','logShopWebhookSent','45RUhqSF','23486850CaDTmU','logs','__importDefault','path','length','stringify','endsWith','mkdirSync','logWhiteDomainError','sort','message','existsSync','5552532VkKrvx','RESPONSE','logApiCall','webhooks_received','logWebhookError','loggerService','logCoinToPayStatus','PAYMENT_CREATED','4436iNyDUO','logsDir','REQUEST','payments_created','📁\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20write\x20','size','API_CALL','logWhiteDomainResponse','forEach','date'];a59_0x6581=function(){return _0x27e939;};return a59_0x6581();}class LoggerService{constructor(){const _0x398ff2=a59_0x8070d1;this[_0x398ff2(0x17c)]=path_1[_0x398ff2(0x197)]['join'](process[_0x398ff2(0x152)](),_0x398ff2(0x168)),this[_0x398ff2(0x191)]();}['ensureLogsDirectory'](){const _0x772b6c=a59_0x8070d1;!fs_1['default'][_0x772b6c(0x172)](this[_0x772b6c(0x17c)])&&(fs_1[_0x772b6c(0x197)][_0x772b6c(0x16e)](this[_0x772b6c(0x17c)],{'recursive':!![]}),console[_0x772b6c(0x18f)](_0x772b6c(0x17f)+this[_0x772b6c(0x17c)]));}['getLogFileName'](_0x3d934b){const _0x256d8f=a59_0x8070d1,_0x165d07=new Date()[_0x256d8f(0x189)]()[_0x256d8f(0x199)]('T')[0x0];return path_1[_0x256d8f(0x197)][_0x256d8f(0x19b)](this['logsDir'],_0x3d934b+'_'+_0x165d07+_0x256d8f(0x150));}['writeLog'](_0x3868dd,_0x2c2be6){const _0x4665db=a59_0x8070d1;try{const _0x1c976b=new Date()[_0x4665db(0x189)](),_0x15112c={'timestamp':_0x1c976b,..._0x2c2be6},_0x30655a=JSON[_0x4665db(0x16c)](_0x15112c)+'\x0a',_0x58141a=this[_0x4665db(0x15f)](_0x3868dd);fs_1[_0x4665db(0x197)]['appendFileSync'](_0x58141a,_0x30655a,_0x4665db(0x162));}catch(_0x484e2e){console[_0x4665db(0x18e)](_0x4665db(0x180)+_0x3868dd+'\x20log:',_0x484e2e);}}['logWhiteDomainRequest'](_0x49edcb,_0x55734a,_0x50a98a,_0xe7d80){const _0x50f452=a59_0x8070d1;this[_0x50f452(0x15d)]('white_domain_requests',{'type':_0x50f452(0x17d),'gateway':_0x49edcb,'endpoint':_0x55734a,'method':_0x50a98a,'data':_0xe7d80});}[a59_0x8070d1(0x183)](_0x316a7c,_0x2e6740,_0x1045cf,_0x1993ba,_0x205c4e){const _0x3c4fd9=a59_0x8070d1;this[_0x3c4fd9(0x15d)](_0x3c4fd9(0x155),{'type':_0x3c4fd9(0x174),'gateway':_0x316a7c,'endpoint':_0x2e6740,'status':_0x1045cf,'responseTime':_0x205c4e,'data':_0x1993ba});}[a59_0x8070d1(0x16f)](_0x55c39b,_0x4a4a48,_0x4ba69d){const _0x242f6f=a59_0x8070d1;this[_0x242f6f(0x15d)](_0x242f6f(0x163),{'type':'ERROR','gateway':_0x55c39b,'endpoint':_0x4a4a48,'error':_0x4ba69d instanceof Error?{'message':_0x4ba69d['message'],'stack':_0x4ba69d['stack']}:_0x4ba69d});}[a59_0x8070d1(0x160)](_0xf837b2,_0x4e278e,_0x5bf9fd){const _0xd8d7e3=a59_0x8070d1;this[_0xd8d7e3(0x15d)](_0xd8d7e3(0x176),{'type':_0xd8d7e3(0x19c),'gateway':_0xf837b2,'headers':_0x5bf9fd,'data':_0x4e278e});}['logWebhookProcessed'](_0x166cde,_0x1586f9,_0x493046,_0x3e39f2,_0x5b336d){const _0x2dc15f=a59_0x8070d1;this['writeLog']('webhooks_processed',{'type':_0x2dc15f(0x159),'gateway':_0x166cde,'paymentId':_0x1586f9,'oldStatus':_0x493046,'newStatus':_0x3e39f2,'originalData':_0x5b336d});}[a59_0x8070d1(0x177)](_0x2b5dd0,_0x1eaeb9,_0x1f6da4){const _0x564932=a59_0x8070d1;this[_0x564932(0x15d)](_0x564932(0x195),{'type':_0x564932(0x198),'gateway':_0x2b5dd0,'error':_0x1eaeb9 instanceof Error?{'message':_0x1eaeb9[_0x564932(0x171)],'stack':_0x1eaeb9[_0x564932(0x192)]}:_0x1eaeb9,'originalData':_0x1f6da4});}[a59_0x8070d1(0x179)](_0x56feeb){const _0x5b6f93=a59_0x8070d1;this[_0x5b6f93(0x15d)]('cointopay_status_changes',{'type':_0x5b6f93(0x18d),..._0x56feeb});}['logCoinToPayError'](_0x57bacc){const _0x5f2cda=a59_0x8070d1;this['writeLog'](_0x5f2cda(0x187),{'type':_0x5f2cda(0x15b),..._0x57bacc});}[a59_0x8070d1(0x165)](_0x2c0473,_0x2aed83,_0x46ef57,_0x26ad6d,_0x38c83d,_0x5f0fd1){const _0x1e4788=a59_0x8070d1;this[_0x1e4788(0x15d)](_0x1e4788(0x157),{'type':_0x1e4788(0x14d),'shopId':_0x2c0473,'webhookUrl':_0x2aed83,'event':_0x46ef57,'status':_0x26ad6d,'responseTime':_0x38c83d,'payload':_0x5f0fd1});}[a59_0x8070d1(0x154)](_0x31da2a,_0x2b4e1e,_0x1e56f7,_0x16e0f1,_0x3498e8){const _0x42b3ce=a59_0x8070d1;this[_0x42b3ce(0x15d)](_0x42b3ce(0x18b),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x31da2a,'webhookUrl':_0x2b4e1e,'event':_0x1e56f7,'error':_0x16e0f1 instanceof Error?{'message':_0x16e0f1['message'],'stack':_0x16e0f1[_0x42b3ce(0x192)]}:_0x16e0f1,'payload':_0x3498e8});}[a59_0x8070d1(0x164)](_0x3b23a4,_0x2f2738,_0x45491d,_0x494708,_0x21ccdd){const _0x4d9a31=a59_0x8070d1;this[_0x4d9a31(0x15d)](_0x4d9a31(0x17e),{'type':_0x4d9a31(0x17a),'gateway':_0x3b23a4,'paymentId':_0x2f2738,'shopId':_0x45491d,'amount':_0x494708,'currency':_0x21ccdd});}[a59_0x8070d1(0x175)](_0x9bcb32,_0x10ce0b,_0x31024b,_0x236fe7,_0x44cb8c){const _0x625b98=a59_0x8070d1;this['writeLog'](_0x625b98(0x19d),{'type':_0x625b98(0x182),'endpoint':_0x9bcb32,'method':_0x10ce0b,'userId':_0x31024b,'userRole':_0x236fe7,'requestData':_0x44cb8c});}['getLogStats'](){const _0xd1853b=a59_0x8070d1;try{const _0x118c54=fs_1[_0xd1853b(0x197)]['readdirSync'](this['logsDir']),_0x329c47=_0x118c54['filter'](_0x50a448=>_0x50a448[_0xd1853b(0x16d)](_0xd1853b(0x150))),_0x554660=[...new Set(_0x329c47[_0xd1853b(0x15a)](_0x4ff9f6=>_0x4ff9f6[_0xd1853b(0x199)]('_')[0x0]))],_0xea20f5=_0x329c47[_0xd1853b(0x15a)](_0xb63c25=>{const _0x55dea4=_0xd1853b,_0x36016d=path_1[_0x55dea4(0x197)][_0x55dea4(0x19b)](this[_0x55dea4(0x17c)],_0xb63c25),_0x30e918=fs_1[_0x55dea4(0x197)][_0x55dea4(0x156)](_0x36016d),[_0x3e80a1,_0x27f9d8]=_0xb63c25[_0x55dea4(0x19a)](_0x55dea4(0x150),'')[_0x55dea4(0x199)]('_');return{'type':_0x3e80a1,'date':_0x27f9d8,'size':_0x30e918[_0x55dea4(0x181)]};})[_0xd1853b(0x170)]((_0x53fed0,_0x2c7f5b)=>_0x2c7f5b[_0xd1853b(0x185)]['localeCompare'](_0x53fed0[_0xd1853b(0x185)]));return{'totalFiles':_0x329c47[_0xd1853b(0x16b)],'logTypes':_0x554660,'latestLogs':_0xea20f5[_0xd1853b(0x14c)](0x0,0xa)};}catch(_0x4a94d9){return console['error'](_0xd1853b(0x161),_0x4a94d9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x8070d1(0x18c)](_0x43e4b1=0x1e){const _0x13e071=a59_0x8070d1;try{const _0x3e5702=fs_1[_0x13e071(0x197)][_0x13e071(0x186)](this[_0x13e071(0x17c)]),_0x5e3683=new Date();_0x5e3683['setDate'](_0x5e3683[_0x13e071(0x15c)]()-_0x43e4b1);let _0x360ec8=0x0;_0x3e5702[_0x13e071(0x184)](_0x4a74de=>{const _0x1815bc=_0x13e071;if(!_0x4a74de[_0x1815bc(0x16d)]('.log'))return;const _0x1da3ce=path_1[_0x1815bc(0x197)][_0x1815bc(0x19b)](this[_0x1815bc(0x17c)],_0x4a74de),_0x5b2b2e=fs_1[_0x1815bc(0x197)]['statSync'](_0x1da3ce);_0x5b2b2e['mtime']<_0x5e3683&&(fs_1[_0x1815bc(0x197)][_0x1815bc(0x158)](_0x1da3ce),_0x360ec8++,console[_0x1815bc(0x18f)](_0x1815bc(0x151)+_0x4a74de));}),console[_0x13e071(0x18f)](_0x13e071(0x15e)+_0x360ec8+_0x13e071(0x14f)+_0x43e4b1+_0x13e071(0x194));}catch(_0x264ced){console[_0x13e071(0x18e)](_0x13e071(0x190),_0x264ced);}}}exports['LoggerService']=LoggerService,exports[a59_0x8070d1(0x178)]=new LoggerService();