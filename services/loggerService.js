'use strict';const a49_0x4a3830=a49_0x1340;(function(_0x44478e,_0xa4e03f){const _0x3e44cb=a49_0x1340,_0x42e7a2=_0x44478e();while(!![]){try{const _0x5399bb=parseInt(_0x3e44cb(0x1ea))/0x1+-parseInt(_0x3e44cb(0x200))/0x2*(parseInt(_0x3e44cb(0x1ff))/0x3)+parseInt(_0x3e44cb(0x1f2))/0x4+-parseInt(_0x3e44cb(0x227))/0x5*(-parseInt(_0x3e44cb(0x229))/0x6)+-parseInt(_0x3e44cb(0x1fc))/0x7+parseInt(_0x3e44cb(0x1f9))/0x8*(parseInt(_0x3e44cb(0x1e5))/0x9)+-parseInt(_0x3e44cb(0x236))/0xa;if(_0x5399bb===_0xa4e03f)break;else _0x42e7a2['push'](_0x42e7a2['shift']());}catch(_0x4faf06){_0x42e7a2['push'](_0x42e7a2['shift']());}}}(a49_0x22b6,0x2d932));function a49_0x1340(_0x3b00bf,_0x1db8a0){const _0x22b682=a49_0x22b6();return a49_0x1340=function(_0x1340b2,_0x206156){_0x1340b2=_0x1340b2-0x1e2;let _0x3ac36e=_0x22b682[_0x1340b2];return _0x3ac36e;},a49_0x1340(_0x3b00bf,_0x1db8a0);}function a49_0x22b6(){const _0x5a89a6=['white_domain_responses','368404HhahIx','webhooks_errors','error','COINTOPAY_ERROR','unlinkSync','payments_created','PAYMENT_CREATED','logWhiteDomainRequest','555816BGJLLE','Failed\x20to\x20write\x20','🧹\x20Cleaned\x20','Failed\x20to\x20clean\x20old\x20logs:','COINTOPAY_STATUS_CHANGE','map','RESPONSE','12632vthtIS','webhooks_received','logWhiteDomainError','780703FwKGGI','getLogFileName','logs','3ueNtan','103754aAfBHP','__importDefault','stringify','mtime','API_CALL','\x20old\x20log\x20files\x20(older\x20than\x20','logCoinToPayError','utf8','setDate','__esModule','loggerService','writeLog','date','getDate','length','.log','cointopay_errors','logsDir','logApiCall','SHOP_WEBHOOK_SENT','WEBHOOK_PROCESSED','\x20days)','logShopWebhookError','mkdirSync','localeCompare','LoggerService','message','shop_webhooks_sent','defineProperty','WEBHOOK_ERROR','cleanOldLogs','white_domain_errors','stack','join','sort','api_calls','logShopWebhookSent','ensureLogsDirectory','log','250910vKZOzt','logWebhookProcessed','42FinEIJ','toISOString','SHOP_WEBHOOK_ERROR','shop_webhooks_errors','ERROR','size','white_domain_requests','endsWith','statSync','default','slice','replace','filter','6364510XHpZGY','split','cointopay_status_changes','\x20log:','forEach','729nOYnUa','REQUEST','logWebhookReceived','WEBHOOK_RECEIVED'];a49_0x22b6=function(){return _0x5a89a6;};return a49_0x22b6();}var __importDefault=this&&this[a49_0x4a3830(0x201)]||function(_0x356e71){return _0x356e71&&_0x356e71['__esModule']?_0x356e71:{'default':_0x356e71};};Object[a49_0x4a3830(0x21c)](exports,a49_0x4a3830(0x209),{'value':!![]}),exports[a49_0x4a3830(0x20a)]=exports[a49_0x4a3830(0x219)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x4df347=a49_0x4a3830;this[_0x4df347(0x211)]=path_1[_0x4df347(0x232)][_0x4df347(0x221)](process['cwd'](),_0x4df347(0x1fe)),this['ensureLogsDirectory']();}[a49_0x4a3830(0x225)](){const _0x511895=a49_0x4a3830;!fs_1['default']['existsSync'](this[_0x511895(0x211)])&&(fs_1[_0x511895(0x232)][_0x511895(0x217)](this['logsDir'],{'recursive':!![]}),console[_0x511895(0x226)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x511895(0x211)]));}[a49_0x4a3830(0x1fd)](_0x44ae94){const _0x149fd0=a49_0x4a3830,_0x218fef=new Date()[_0x149fd0(0x22a)]()[_0x149fd0(0x237)]('T')[0x0];return path_1[_0x149fd0(0x232)][_0x149fd0(0x221)](this[_0x149fd0(0x211)],_0x44ae94+'_'+_0x218fef+_0x149fd0(0x20f));}['writeLog'](_0x30115a,_0x39ff3f){const _0x5c6977=a49_0x4a3830;try{const _0x39c7b4=new Date()[_0x5c6977(0x22a)](),_0x345b53={'timestamp':_0x39c7b4,..._0x39ff3f},_0x554703=JSON[_0x5c6977(0x202)](_0x345b53)+'\x0a',_0x33b39e=this[_0x5c6977(0x1fd)](_0x30115a);fs_1[_0x5c6977(0x232)]['appendFileSync'](_0x33b39e,_0x554703,_0x5c6977(0x207));}catch(_0x8a92d5){console['error'](_0x5c6977(0x1f3)+_0x30115a+_0x5c6977(0x1e3),_0x8a92d5);}}[a49_0x4a3830(0x1f1)](_0x39ecd3,_0x22a977,_0x58a403,_0x1c0f0b){const _0x555463=a49_0x4a3830;this[_0x555463(0x20b)](_0x555463(0x22f),{'type':_0x555463(0x1e6),'gateway':_0x39ecd3,'endpoint':_0x22a977,'method':_0x58a403,'data':_0x1c0f0b});}['logWhiteDomainResponse'](_0x163b68,_0x4b2974,_0x156f3e,_0x237c48,_0x236a62){const _0x5a3fc6=a49_0x4a3830;this['writeLog'](_0x5a3fc6(0x1e9),{'type':_0x5a3fc6(0x1f8),'gateway':_0x163b68,'endpoint':_0x4b2974,'status':_0x156f3e,'responseTime':_0x236a62,'data':_0x237c48});}[a49_0x4a3830(0x1fb)](_0x1ce34a,_0x418a26,_0x5d42d9){const _0x3fe796=a49_0x4a3830;this[_0x3fe796(0x20b)](_0x3fe796(0x21f),{'type':_0x3fe796(0x22d),'gateway':_0x1ce34a,'endpoint':_0x418a26,'error':_0x5d42d9 instanceof Error?{'message':_0x5d42d9['message'],'stack':_0x5d42d9[_0x3fe796(0x220)]}:_0x5d42d9});}[a49_0x4a3830(0x1e7)](_0x2081c7,_0x3334b8,_0x2fea05){const _0x200d4e=a49_0x4a3830;this[_0x200d4e(0x20b)](_0x200d4e(0x1fa),{'type':_0x200d4e(0x1e8),'gateway':_0x2081c7,'headers':_0x2fea05,'data':_0x3334b8});}[a49_0x4a3830(0x228)](_0x13dac4,_0x37b352,_0x442818,_0x322ccd,_0x3baab2){const _0x3bc276=a49_0x4a3830;this['writeLog']('webhooks_processed',{'type':_0x3bc276(0x214),'gateway':_0x13dac4,'paymentId':_0x37b352,'oldStatus':_0x442818,'newStatus':_0x322ccd,'originalData':_0x3baab2});}['logWebhookError'](_0x56f0eb,_0x41cb09,_0x54813c){const _0x27ee01=a49_0x4a3830;this['writeLog'](_0x27ee01(0x1eb),{'type':_0x27ee01(0x21d),'gateway':_0x56f0eb,'error':_0x41cb09 instanceof Error?{'message':_0x41cb09[_0x27ee01(0x21a)],'stack':_0x41cb09[_0x27ee01(0x220)]}:_0x41cb09,'originalData':_0x54813c});}['logCoinToPayStatus'](_0x206806){const _0x28f8d8=a49_0x4a3830;this[_0x28f8d8(0x20b)](_0x28f8d8(0x1e2),{'type':_0x28f8d8(0x1f6),..._0x206806});}[a49_0x4a3830(0x206)](_0x5727f9){const _0x6b0164=a49_0x4a3830;this['writeLog'](_0x6b0164(0x210),{'type':_0x6b0164(0x1ed),..._0x5727f9});}[a49_0x4a3830(0x224)](_0x43e9ea,_0x29cf47,_0x266b50,_0x41e071,_0x41b1ea,_0x241b4f){const _0x30f6be=a49_0x4a3830;this[_0x30f6be(0x20b)](_0x30f6be(0x21b),{'type':_0x30f6be(0x213),'shopId':_0x43e9ea,'webhookUrl':_0x29cf47,'event':_0x266b50,'status':_0x41e071,'responseTime':_0x41b1ea,'payload':_0x241b4f});}[a49_0x4a3830(0x216)](_0xe13ab6,_0x523687,_0x211cdd,_0x99bfdd,_0x3a9d3f){const _0x497e0a=a49_0x4a3830;this[_0x497e0a(0x20b)](_0x497e0a(0x22c),{'type':_0x497e0a(0x22b),'shopId':_0xe13ab6,'webhookUrl':_0x523687,'event':_0x211cdd,'error':_0x99bfdd instanceof Error?{'message':_0x99bfdd[_0x497e0a(0x21a)],'stack':_0x99bfdd[_0x497e0a(0x220)]}:_0x99bfdd,'payload':_0x3a9d3f});}['logPaymentCreated'](_0x1566c0,_0x17b2ed,_0x1daa20,_0x5741c5,_0x3e4d04){const _0x20204c=a49_0x4a3830;this['writeLog'](_0x20204c(0x1ef),{'type':_0x20204c(0x1f0),'gateway':_0x1566c0,'paymentId':_0x17b2ed,'shopId':_0x1daa20,'amount':_0x5741c5,'currency':_0x3e4d04});}[a49_0x4a3830(0x212)](_0x5881fd,_0x11ee67,_0xfe92cd,_0x40fe9f,_0x5f0068){const _0x19759c=a49_0x4a3830;this[_0x19759c(0x20b)](_0x19759c(0x223),{'type':_0x19759c(0x204),'endpoint':_0x5881fd,'method':_0x11ee67,'userId':_0xfe92cd,'userRole':_0x40fe9f,'requestData':_0x5f0068});}['getLogStats'](){const _0x23ee81=a49_0x4a3830;try{const _0x149a65=fs_1[_0x23ee81(0x232)]['readdirSync'](this['logsDir']),_0x411b7d=_0x149a65[_0x23ee81(0x235)](_0x43d040=>_0x43d040[_0x23ee81(0x230)]('.log')),_0x1f432d=[...new Set(_0x411b7d[_0x23ee81(0x1f7)](_0x4c24de=>_0x4c24de[_0x23ee81(0x237)]('_')[0x0]))],_0x80ad7b=_0x411b7d['map'](_0x37baba=>{const _0x3d5d9f=_0x23ee81,_0x52cfb1=path_1[_0x3d5d9f(0x232)][_0x3d5d9f(0x221)](this[_0x3d5d9f(0x211)],_0x37baba),_0x4a1692=fs_1[_0x3d5d9f(0x232)]['statSync'](_0x52cfb1),[_0x48abee,_0x56fd18]=_0x37baba[_0x3d5d9f(0x234)](_0x3d5d9f(0x20f),'')['split']('_');return{'type':_0x48abee,'date':_0x56fd18,'size':_0x4a1692[_0x3d5d9f(0x22e)]};})[_0x23ee81(0x222)]((_0x48d690,_0x12902f)=>_0x12902f[_0x23ee81(0x20c)][_0x23ee81(0x218)](_0x48d690[_0x23ee81(0x20c)]));return{'totalFiles':_0x411b7d[_0x23ee81(0x20e)],'logTypes':_0x1f432d,'latestLogs':_0x80ad7b[_0x23ee81(0x233)](0x0,0xa)};}catch(_0x31dcbc){return console[_0x23ee81(0x1ec)]('Failed\x20to\x20get\x20log\x20stats:',_0x31dcbc),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x4a3830(0x21e)](_0x32c09c=0x1e){const _0x182777=a49_0x4a3830;try{const _0x5c4784=fs_1['default']['readdirSync'](this[_0x182777(0x211)]),_0x27fbf2=new Date();_0x27fbf2[_0x182777(0x208)](_0x27fbf2[_0x182777(0x20d)]()-_0x32c09c);let _0x3d17bc=0x0;_0x5c4784[_0x182777(0x1e4)](_0x53b597=>{const _0x4841b3=_0x182777;if(!_0x53b597['endsWith']('.log'))return;const _0x164170=path_1[_0x4841b3(0x232)][_0x4841b3(0x221)](this[_0x4841b3(0x211)],_0x53b597),_0x4f0c1d=fs_1[_0x4841b3(0x232)][_0x4841b3(0x231)](_0x164170);_0x4f0c1d[_0x4841b3(0x203)]<_0x27fbf2&&(fs_1[_0x4841b3(0x232)][_0x4841b3(0x1ee)](_0x164170),_0x3d17bc++,console[_0x4841b3(0x226)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x53b597));}),console[_0x182777(0x226)](_0x182777(0x1f4)+_0x3d17bc+_0x182777(0x205)+_0x32c09c+_0x182777(0x215));}catch(_0x2c0cc1){console[_0x182777(0x1ec)](_0x182777(0x1f5),_0x2c0cc1);}}}exports[a49_0x4a3830(0x219)]=LoggerService,exports['loggerService']=new LoggerService();