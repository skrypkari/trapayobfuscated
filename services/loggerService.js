'use strict';function a56_0x3d51(_0x136c3c,_0x1e44cb){const _0x207dab=a56_0x207d();return a56_0x3d51=function(_0x3d513c,_0x578ee4){_0x3d513c=_0x3d513c-0x162;let _0x1afed7=_0x207dab[_0x3d513c];return _0x1afed7;},a56_0x3d51(_0x136c3c,_0x1e44cb);}function a56_0x207d(){const _0x443adc=['cleanOldLogs','forEach','WEBHOOK_PROCESSED','ERROR','cointopay_status_changes','152071BqbpyM','message','readdirSync','sort','logWebhookProcessed','logWhiteDomainRequest','API_CALL','WEBHOOK_ERROR','540090LqrkWd','cointopay_errors','webhooks_errors','getLogStats','logApiCall','ensureLogsDirectory','logWebhookReceived','170218DIExlV','appendFileSync','white_domain_responses','LoggerService','writeLog','339350PHLJwB','cwd','payments_created','filter','size','log','5VgjToU','RESPONSE','logShopWebhookSent','SHOP_WEBHOOK_SENT','api_calls','logs','7przekw','logsDir','logCoinToPayError','Failed\x20to\x20get\x20log\x20stats:','shop_webhooks_sent','REQUEST','date','__importDefault','loggerService','getDate','getLogFileName','1056438MLTDxK','split','mkdirSync','Failed\x20to\x20clean\x20old\x20logs:','replace','logWhiteDomainResponse','.log','logWebhookError','📁\x20Created\x20logs\x20directory:\x20','unlinkSync','stringify','22pSIUUq','1094680vIbJAN','PAYMENT_CREATED','join','endsWith','default','statSync','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logPaymentCreated','stack','COINTOPAY_ERROR','white_domain_errors','error','345724RWizdk','mtime','logWhiteDomainError','3xlzKTN','__esModule','path'];a56_0x207d=function(){return _0x443adc;};return a56_0x207d();}const a56_0x27f7a2=a56_0x3d51;(function(_0x5cc2bf,_0x2fc0f8){const _0x1428cf=a56_0x3d51,_0x5f3cc3=_0x5cc2bf();while(!![]){try{const _0x4afa5b=parseInt(_0x1428cf(0x174))/0x1+parseInt(_0x1428cf(0x183))/0x2*(parseInt(_0x1428cf(0x16c))/0x3)+-parseInt(_0x1428cf(0x169))/0x4*(parseInt(_0x1428cf(0x18e))/0x5)+-parseInt(_0x1428cf(0x19f))/0x6+-parseInt(_0x1428cf(0x194))/0x7*(-parseInt(_0x1428cf(0x1ab))/0x8)+parseInt(_0x1428cf(0x17c))/0x9+-parseInt(_0x1428cf(0x188))/0xa*(parseInt(_0x1428cf(0x1aa))/0xb);if(_0x4afa5b===_0x2fc0f8)break;else _0x5f3cc3['push'](_0x5f3cc3['shift']());}catch(_0x51fca7){_0x5f3cc3['push'](_0x5f3cc3['shift']());}}}(a56_0x207d,0x194e3));var __importDefault=this&&this[a56_0x27f7a2(0x19b)]||function(_0x2411f6){const _0x5db943=a56_0x27f7a2;return _0x2411f6&&_0x2411f6[_0x5db943(0x16d)]?_0x2411f6:{'default':_0x2411f6};};Object['defineProperty'](exports,a56_0x27f7a2(0x16d),{'value':!![]}),exports[a56_0x27f7a2(0x19c)]=exports[a56_0x27f7a2(0x186)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a56_0x27f7a2(0x16e)));class LoggerService{constructor(){const _0x452d6a=a56_0x27f7a2;this['logsDir']=path_1['default'][_0x452d6a(0x1ad)](process[_0x452d6a(0x189)](),_0x452d6a(0x193)),this[_0x452d6a(0x181)]();}['ensureLogsDirectory'](){const _0xdc9567=a56_0x27f7a2;!fs_1[_0xdc9567(0x1af)]['existsSync'](this[_0xdc9567(0x195)])&&(fs_1[_0xdc9567(0x1af)][_0xdc9567(0x1a1)](this[_0xdc9567(0x195)],{'recursive':!![]}),console['log'](_0xdc9567(0x1a7)+this[_0xdc9567(0x195)]));}['getLogFileName'](_0x579d3e){const _0x21f517=a56_0x27f7a2,_0x44092c=new Date()['toISOString']()[_0x21f517(0x1a0)]('T')[0x0];return path_1['default']['join'](this[_0x21f517(0x195)],_0x579d3e+'_'+_0x44092c+_0x21f517(0x1a5));}['writeLog'](_0x794b2d,_0x3b6e5){const _0x2a63e3=a56_0x27f7a2;try{const _0x175c93=new Date()['toISOString'](),_0x4b7389={'timestamp':_0x175c93,..._0x3b6e5},_0x2087db=JSON[_0x2a63e3(0x1a9)](_0x4b7389)+'\x0a',_0x218a4b=this[_0x2a63e3(0x19e)](_0x794b2d);fs_1['default'][_0x2a63e3(0x184)](_0x218a4b,_0x2087db,'utf8');}catch(_0x4650b6){console[_0x2a63e3(0x168)]('Failed\x20to\x20write\x20'+_0x794b2d+'\x20log:',_0x4650b6);}}[a56_0x27f7a2(0x179)](_0x2dc660,_0x3d06c4,_0x550d96,_0x14e707){const _0x9c0b31=a56_0x27f7a2;this['writeLog']('white_domain_requests',{'type':_0x9c0b31(0x199),'gateway':_0x2dc660,'endpoint':_0x3d06c4,'method':_0x550d96,'data':_0x14e707});}[a56_0x27f7a2(0x1a4)](_0x35edc5,_0xa369c8,_0x2f038c,_0x1eee29,_0x25ee99){const _0x2b3f94=a56_0x27f7a2;this[_0x2b3f94(0x187)](_0x2b3f94(0x185),{'type':_0x2b3f94(0x18f),'gateway':_0x35edc5,'endpoint':_0xa369c8,'status':_0x2f038c,'responseTime':_0x25ee99,'data':_0x1eee29});}[a56_0x27f7a2(0x16b)](_0x51be6f,_0x150c1d,_0x4562a7){const _0x4d30d3=a56_0x27f7a2;this[_0x4d30d3(0x187)](_0x4d30d3(0x167),{'type':_0x4d30d3(0x172),'gateway':_0x51be6f,'endpoint':_0x150c1d,'error':_0x4562a7 instanceof Error?{'message':_0x4562a7[_0x4d30d3(0x175)],'stack':_0x4562a7[_0x4d30d3(0x165)]}:_0x4562a7});}[a56_0x27f7a2(0x182)](_0x49b42c,_0x562c47,_0x560b59){this['writeLog']('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x49b42c,'headers':_0x560b59,'data':_0x562c47});}[a56_0x27f7a2(0x178)](_0x3a184f,_0x129d15,_0xf92b71,_0x13b34d,_0x26dab1){const _0x34d2fb=a56_0x27f7a2;this[_0x34d2fb(0x187)]('webhooks_processed',{'type':_0x34d2fb(0x171),'gateway':_0x3a184f,'paymentId':_0x129d15,'oldStatus':_0xf92b71,'newStatus':_0x13b34d,'originalData':_0x26dab1});}[a56_0x27f7a2(0x1a6)](_0xf0b431,_0x3eb502,_0x18b46b){const _0x48fe7a=a56_0x27f7a2;this['writeLog'](_0x48fe7a(0x17e),{'type':_0x48fe7a(0x17b),'gateway':_0xf0b431,'error':_0x3eb502 instanceof Error?{'message':_0x3eb502['message'],'stack':_0x3eb502[_0x48fe7a(0x165)]}:_0x3eb502,'originalData':_0x18b46b});}['logCoinToPayStatus'](_0x40e955){const _0x3e820e=a56_0x27f7a2;this[_0x3e820e(0x187)](_0x3e820e(0x173),{'type':'COINTOPAY_STATUS_CHANGE',..._0x40e955});}[a56_0x27f7a2(0x196)](_0x3b55a0){const _0x4b1f2f=a56_0x27f7a2;this['writeLog'](_0x4b1f2f(0x17d),{'type':_0x4b1f2f(0x166),..._0x3b55a0});}[a56_0x27f7a2(0x190)](_0x2b3e1,_0x6cd7df,_0x19934b,_0x352624,_0x46935b,_0x4e1787){const _0x4e54af=a56_0x27f7a2;this[_0x4e54af(0x187)](_0x4e54af(0x198),{'type':_0x4e54af(0x191),'shopId':_0x2b3e1,'webhookUrl':_0x6cd7df,'event':_0x19934b,'status':_0x352624,'responseTime':_0x46935b,'payload':_0x4e1787});}['logShopWebhookError'](_0x128c4c,_0x4bc7a4,_0x46d009,_0x3a3451,_0x58db6e){const _0x22c4ff=a56_0x27f7a2;this[_0x22c4ff(0x187)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x128c4c,'webhookUrl':_0x4bc7a4,'event':_0x46d009,'error':_0x3a3451 instanceof Error?{'message':_0x3a3451['message'],'stack':_0x3a3451[_0x22c4ff(0x165)]}:_0x3a3451,'payload':_0x58db6e});}[a56_0x27f7a2(0x164)](_0x4f8fcb,_0x5e9b1c,_0x45133b,_0x4a7fb6,_0x403505){const _0x9daeb0=a56_0x27f7a2;this[_0x9daeb0(0x187)](_0x9daeb0(0x18a),{'type':_0x9daeb0(0x1ac),'gateway':_0x4f8fcb,'paymentId':_0x5e9b1c,'shopId':_0x45133b,'amount':_0x4a7fb6,'currency':_0x403505});}[a56_0x27f7a2(0x180)](_0xf9dfb7,_0x4e537a,_0x59261e,_0x53a488,_0x1e5812){const _0x1d0896=a56_0x27f7a2;this[_0x1d0896(0x187)](_0x1d0896(0x192),{'type':_0x1d0896(0x17a),'endpoint':_0xf9dfb7,'method':_0x4e537a,'userId':_0x59261e,'userRole':_0x53a488,'requestData':_0x1e5812});}[a56_0x27f7a2(0x17f)](){const _0x1f0c87=a56_0x27f7a2;try{const _0x21b073=fs_1[_0x1f0c87(0x1af)]['readdirSync'](this[_0x1f0c87(0x195)]),_0x3d6807=_0x21b073[_0x1f0c87(0x18b)](_0x3d8cbe=>_0x3d8cbe[_0x1f0c87(0x1ae)](_0x1f0c87(0x1a5))),_0x553256=[...new Set(_0x3d6807['map'](_0x584291=>_0x584291[_0x1f0c87(0x1a0)]('_')[0x0]))],_0x4ae41d=_0x3d6807['map'](_0x1d9307=>{const _0x2e4cec=_0x1f0c87,_0x4a9c43=path_1['default'][_0x2e4cec(0x1ad)](this['logsDir'],_0x1d9307),_0x13200b=fs_1[_0x2e4cec(0x1af)][_0x2e4cec(0x162)](_0x4a9c43),[_0x5c812e,_0x21b53c]=_0x1d9307[_0x2e4cec(0x1a3)]('.log','')[_0x2e4cec(0x1a0)]('_');return{'type':_0x5c812e,'date':_0x21b53c,'size':_0x13200b[_0x2e4cec(0x18c)]};})[_0x1f0c87(0x177)]((_0x301abf,_0x18185c)=>_0x18185c[_0x1f0c87(0x19a)]['localeCompare'](_0x301abf[_0x1f0c87(0x19a)]));return{'totalFiles':_0x3d6807['length'],'logTypes':_0x553256,'latestLogs':_0x4ae41d['slice'](0x0,0xa)};}catch(_0x4fa40f){return console['error'](_0x1f0c87(0x197),_0x4fa40f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a56_0x27f7a2(0x16f)](_0x23ce31=0x1e){const _0x7a0455=a56_0x27f7a2;try{const _0x2d8d03=fs_1[_0x7a0455(0x1af)][_0x7a0455(0x176)](this[_0x7a0455(0x195)]),_0x44d0d7=new Date();_0x44d0d7['setDate'](_0x44d0d7[_0x7a0455(0x19d)]()-_0x23ce31);let _0x5c7ba5=0x0;_0x2d8d03[_0x7a0455(0x170)](_0x1a16f5=>{const _0x51b238=_0x7a0455;if(!_0x1a16f5[_0x51b238(0x1ae)](_0x51b238(0x1a5)))return;const _0x31d06e=path_1['default'][_0x51b238(0x1ad)](this[_0x51b238(0x195)],_0x1a16f5),_0x2292e3=fs_1[_0x51b238(0x1af)][_0x51b238(0x162)](_0x31d06e);_0x2292e3[_0x51b238(0x16a)]<_0x44d0d7&&(fs_1[_0x51b238(0x1af)][_0x51b238(0x1a8)](_0x31d06e),_0x5c7ba5++,console[_0x51b238(0x18d)](_0x51b238(0x163)+_0x1a16f5));}),console[_0x7a0455(0x18d)]('🧹\x20Cleaned\x20'+_0x5c7ba5+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x23ce31+'\x20days)');}catch(_0x1bd1a2){console['error'](_0x7a0455(0x1a2),_0x1bd1a2);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();