'use strict';const a59_0x5342aa=a59_0x4e09;(function(_0x6d3bc1,_0x46540d){const _0x29533f=a59_0x4e09,_0x3f50e9=_0x6d3bc1();while(!![]){try{const _0x15730b=parseInt(_0x29533f(0x211))/0x1*(-parseInt(_0x29533f(0x204))/0x2)+-parseInt(_0x29533f(0x1f1))/0x3+-parseInt(_0x29533f(0x1e5))/0x4*(parseInt(_0x29533f(0x228))/0x5)+parseInt(_0x29533f(0x1ea))/0x6*(-parseInt(_0x29533f(0x22c))/0x7)+-parseInt(_0x29533f(0x205))/0x8*(-parseInt(_0x29533f(0x20d))/0x9)+-parseInt(_0x29533f(0x1fd))/0xa*(parseInt(_0x29533f(0x1e0))/0xb)+-parseInt(_0x29533f(0x1fa))/0xc*(-parseInt(_0x29533f(0x209))/0xd);if(_0x15730b===_0x46540d)break;else _0x3f50e9['push'](_0x3f50e9['shift']());}catch(_0x282bcc){_0x3f50e9['push'](_0x3f50e9['shift']());}}}(a59_0x42ad,0xadbee));var __importDefault=this&&this[a59_0x5342aa(0x21b)]||function(_0x14a821){const _0x1f9454=a59_0x5342aa;return _0x14a821&&_0x14a821[_0x1f9454(0x21f)]?_0x14a821:{'default':_0x14a821};};function a59_0x42ad(){const _0x137f37=['COINTOPAY_ERROR','getLogFileName','loggerService','logWhiteDomainRequest','map','setDate','logShopWebhookSent','api_calls','7836lvkUim','WEBHOOK_ERROR','white_domain_responses','10wDHfvP','getDate','🧹\x20Cleaned\x20','localeCompare','logsDir','ensureLogsDirectory','SHOP_WEBHOOK_ERROR','2zPDTNm','808pZbPss','logCoinToPayStatus','logWhiteDomainError','default','49439XvjNLB','logWebhookReceived','slice','shop_webhooks_errors','110988rEZPNs','appendFileSync','cwd','mtime','387349kksYdO','message','log','shop_webhooks_sent','SHOP_WEBHOOK_SENT','logShopWebhookError','size','path','logWebhookError','LoggerService','__importDefault','split','WEBHOOK_PROCESSED','cointopay_errors','__esModule','logApiCall','API_CALL','\x20days)','getLogStats','📁\x20Created\x20logs\x20directory:\x20','\x20old\x20log\x20files\x20(older\x20than\x20','date','forEach','382345JeynzP','.log','readdirSync','utf8','238406JsdPIG','toISOString','REQUEST','🗑️\x20Deleted\x20old\x20log\x20file:\x20','stack','endsWith','length','cleanOldLogs','logPaymentCreated','10882399dovCyX','logs','join','white_domain_requests','webhooks_errors','8pecxPI','\x20log:','white_domain_errors','Failed\x20to\x20clean\x20old\x20logs:','payments_created','126sLywfZ','logWebhookProcessed','writeLog','statSync','COINTOPAY_STATUS_CHANGE','defineProperty','stringify','2317245QamHfz'];a59_0x42ad=function(){return _0x137f37;};return a59_0x42ad();}Object[a59_0x5342aa(0x1ef)](exports,a59_0x5342aa(0x21f),{'value':!![]}),exports[a59_0x5342aa(0x1f4)]=exports[a59_0x5342aa(0x21a)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x5342aa(0x218)));class LoggerService{constructor(){const _0xcaff89=a59_0x5342aa;this[_0xcaff89(0x201)]=path_1[_0xcaff89(0x208)][_0xcaff89(0x1e2)](process[_0xcaff89(0x20f)](),_0xcaff89(0x1e1)),this[_0xcaff89(0x202)]();}[a59_0x5342aa(0x202)](){const _0x5cfada=a59_0x5342aa;!fs_1[_0x5cfada(0x208)]['existsSync'](this['logsDir'])&&(fs_1[_0x5cfada(0x208)]['mkdirSync'](this[_0x5cfada(0x201)],{'recursive':!![]}),console[_0x5cfada(0x213)](_0x5cfada(0x224)+this['logsDir']));}[a59_0x5342aa(0x1f3)](_0x535b18){const _0x562f90=a59_0x5342aa,_0x341a01=new Date()[_0x562f90(0x22d)]()[_0x562f90(0x21c)]('T')[0x0];return path_1['default']['join'](this[_0x562f90(0x201)],_0x535b18+'_'+_0x341a01+'.log');}[a59_0x5342aa(0x1ec)](_0x49193e,_0x13a564){const _0xa245bb=a59_0x5342aa;try{const _0x460e12=new Date()[_0xa245bb(0x22d)](),_0x588f4c={'timestamp':_0x460e12,..._0x13a564},_0x2285ab=JSON[_0xa245bb(0x1f0)](_0x588f4c)+'\x0a',_0x2b1322=this[_0xa245bb(0x1f3)](_0x49193e);fs_1[_0xa245bb(0x208)][_0xa245bb(0x20e)](_0x2b1322,_0x2285ab,_0xa245bb(0x22b));}catch(_0x2fbe41){console['error']('Failed\x20to\x20write\x20'+_0x49193e+_0xa245bb(0x1e6),_0x2fbe41);}}[a59_0x5342aa(0x1f5)](_0x27ea85,_0x24a277,_0x27eaec,_0x2635fd){const _0x2a4354=a59_0x5342aa;this['writeLog'](_0x2a4354(0x1e3),{'type':_0x2a4354(0x22e),'gateway':_0x27ea85,'endpoint':_0x24a277,'method':_0x27eaec,'data':_0x2635fd});}['logWhiteDomainResponse'](_0x46aca3,_0x4f9153,_0x599646,_0x2ae8fb,_0x68f05d){const _0x371ffa=a59_0x5342aa;this[_0x371ffa(0x1ec)](_0x371ffa(0x1fc),{'type':'RESPONSE','gateway':_0x46aca3,'endpoint':_0x4f9153,'status':_0x599646,'responseTime':_0x68f05d,'data':_0x2ae8fb});}[a59_0x5342aa(0x207)](_0x853fe7,_0x340b1b,_0x837aa5){const _0x4d6684=a59_0x5342aa;this[_0x4d6684(0x1ec)](_0x4d6684(0x1e7),{'type':'ERROR','gateway':_0x853fe7,'endpoint':_0x340b1b,'error':_0x837aa5 instanceof Error?{'message':_0x837aa5['message'],'stack':_0x837aa5[_0x4d6684(0x230)]}:_0x837aa5});}[a59_0x5342aa(0x20a)](_0xe48856,_0x1e123d,_0x4e5a7b){const _0x30c840=a59_0x5342aa;this[_0x30c840(0x1ec)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0xe48856,'headers':_0x4e5a7b,'data':_0x1e123d});}[a59_0x5342aa(0x1eb)](_0x45879a,_0x240ca4,_0x2c7bf2,_0x2740ef,_0x52b50a){const _0x52d5f4=a59_0x5342aa;this[_0x52d5f4(0x1ec)]('webhooks_processed',{'type':_0x52d5f4(0x21d),'gateway':_0x45879a,'paymentId':_0x240ca4,'oldStatus':_0x2c7bf2,'newStatus':_0x2740ef,'originalData':_0x52b50a});}[a59_0x5342aa(0x219)](_0x533498,_0x34effe,_0x486d1e){const _0x325899=a59_0x5342aa;this[_0x325899(0x1ec)](_0x325899(0x1e4),{'type':_0x325899(0x1fb),'gateway':_0x533498,'error':_0x34effe instanceof Error?{'message':_0x34effe[_0x325899(0x212)],'stack':_0x34effe[_0x325899(0x230)]}:_0x34effe,'originalData':_0x486d1e});}[a59_0x5342aa(0x206)](_0x3bcc71){const _0x58965b=a59_0x5342aa;this[_0x58965b(0x1ec)]('cointopay_status_changes',{'type':_0x58965b(0x1ee),..._0x3bcc71});}['logCoinToPayError'](_0x5ee1eb){const _0x2a3238=a59_0x5342aa;this['writeLog'](_0x2a3238(0x21e),{'type':_0x2a3238(0x1f2),..._0x5ee1eb});}[a59_0x5342aa(0x1f8)](_0x37088f,_0x18ae9e,_0x2a09ae,_0x228fa2,_0x194270,_0x134809){const _0x341515=a59_0x5342aa;this['writeLog'](_0x341515(0x214),{'type':_0x341515(0x215),'shopId':_0x37088f,'webhookUrl':_0x18ae9e,'event':_0x2a09ae,'status':_0x228fa2,'responseTime':_0x194270,'payload':_0x134809});}[a59_0x5342aa(0x216)](_0x852750,_0x1a9e3b,_0x2a4f8d,_0x9d093c,_0x223624){const _0x2a5328=a59_0x5342aa;this['writeLog'](_0x2a5328(0x20c),{'type':_0x2a5328(0x203),'shopId':_0x852750,'webhookUrl':_0x1a9e3b,'event':_0x2a4f8d,'error':_0x9d093c instanceof Error?{'message':_0x9d093c[_0x2a5328(0x212)],'stack':_0x9d093c[_0x2a5328(0x230)]}:_0x9d093c,'payload':_0x223624});}[a59_0x5342aa(0x1df)](_0x37bf59,_0x620a67,_0x5b9041,_0x4c01e7,_0x20a1a6){const _0x4578fc=a59_0x5342aa;this[_0x4578fc(0x1ec)](_0x4578fc(0x1e9),{'type':'PAYMENT_CREATED','gateway':_0x37bf59,'paymentId':_0x620a67,'shopId':_0x5b9041,'amount':_0x4c01e7,'currency':_0x20a1a6});}[a59_0x5342aa(0x220)](_0x574667,_0x4761c8,_0x43b2ff,_0x23cc1b,_0x125f84){const _0xea5ef9=a59_0x5342aa;this[_0xea5ef9(0x1ec)](_0xea5ef9(0x1f9),{'type':_0xea5ef9(0x221),'endpoint':_0x574667,'method':_0x4761c8,'userId':_0x43b2ff,'userRole':_0x23cc1b,'requestData':_0x125f84});}[a59_0x5342aa(0x223)](){const _0x29ca8a=a59_0x5342aa;try{const _0x515510=fs_1[_0x29ca8a(0x208)][_0x29ca8a(0x22a)](this[_0x29ca8a(0x201)]),_0x4ae866=_0x515510['filter'](_0x125e85=>_0x125e85[_0x29ca8a(0x231)](_0x29ca8a(0x229))),_0x266edb=[...new Set(_0x4ae866['map'](_0x4f98a6=>_0x4f98a6[_0x29ca8a(0x21c)]('_')[0x0]))],_0x2c00bf=_0x4ae866[_0x29ca8a(0x1f6)](_0x58d3eb=>{const _0x59d077=_0x29ca8a,_0x2996c6=path_1[_0x59d077(0x208)][_0x59d077(0x1e2)](this[_0x59d077(0x201)],_0x58d3eb),_0x1031cb=fs_1[_0x59d077(0x208)]['statSync'](_0x2996c6),[_0x537f02,_0x5019cc]=_0x58d3eb['replace'](_0x59d077(0x229),'')[_0x59d077(0x21c)]('_');return{'type':_0x537f02,'date':_0x5019cc,'size':_0x1031cb[_0x59d077(0x217)]};})['sort']((_0x32e3a2,_0x676b44)=>_0x676b44['date'][_0x29ca8a(0x200)](_0x32e3a2[_0x29ca8a(0x226)]));return{'totalFiles':_0x4ae866[_0x29ca8a(0x232)],'logTypes':_0x266edb,'latestLogs':_0x2c00bf[_0x29ca8a(0x20b)](0x0,0xa)};}catch(_0x209b4){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x209b4),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x5342aa(0x233)](_0x10b5d6=0x1e){const _0xf51be5=a59_0x5342aa;try{const _0x39be37=fs_1[_0xf51be5(0x208)][_0xf51be5(0x22a)](this[_0xf51be5(0x201)]),_0x593c60=new Date();_0x593c60[_0xf51be5(0x1f7)](_0x593c60[_0xf51be5(0x1fe)]()-_0x10b5d6);let _0xd5ef94=0x0;_0x39be37[_0xf51be5(0x227)](_0x42c844=>{const _0x308cdc=_0xf51be5;if(!_0x42c844[_0x308cdc(0x231)]('.log'))return;const _0x11bf65=path_1[_0x308cdc(0x208)][_0x308cdc(0x1e2)](this['logsDir'],_0x42c844),_0xcd2b09=fs_1['default'][_0x308cdc(0x1ed)](_0x11bf65);_0xcd2b09[_0x308cdc(0x210)]<_0x593c60&&(fs_1['default']['unlinkSync'](_0x11bf65),_0xd5ef94++,console['log'](_0x308cdc(0x22f)+_0x42c844));}),console['log'](_0xf51be5(0x1ff)+_0xd5ef94+_0xf51be5(0x225)+_0x10b5d6+_0xf51be5(0x222));}catch(_0x7fe4b7){console['error'](_0xf51be5(0x1e8),_0x7fe4b7);}}}function a59_0x4e09(_0x502c3d,_0x123412){const _0x42ada3=a59_0x42ad();return a59_0x4e09=function(_0x4e0914,_0x348d10){_0x4e0914=_0x4e0914-0x1df;let _0xec23d=_0x42ada3[_0x4e0914];return _0xec23d;},a59_0x4e09(_0x502c3d,_0x123412);}exports[a59_0x5342aa(0x21a)]=LoggerService,exports[a59_0x5342aa(0x1f4)]=new LoggerService();