'use strict';const a48_0x57fcb5=a48_0x52c6;(function(_0xab1aea,_0x3dfc26){const _0x14e12e=a48_0x52c6,_0x224748=_0xab1aea();while(!![]){try{const _0x474135=parseInt(_0x14e12e(0x192))/0x1*(parseInt(_0x14e12e(0x199))/0x2)+-parseInt(_0x14e12e(0x18e))/0x3+parseInt(_0x14e12e(0x16e))/0x4*(parseInt(_0x14e12e(0x1a0))/0x5)+-parseInt(_0x14e12e(0x190))/0x6*(-parseInt(_0x14e12e(0x16b))/0x7)+parseInt(_0x14e12e(0x15d))/0x8+parseInt(_0x14e12e(0x166))/0x9+-parseInt(_0x14e12e(0x180))/0xa;if(_0x474135===_0x3dfc26)break;else _0x224748['push'](_0x224748['shift']());}catch(_0x4f208b){_0x224748['push'](_0x224748['shift']());}}}(a48_0x4f40,0xf3dc5));function a48_0x52c6(_0x480d39,_0x2df685){const _0x4f40e1=a48_0x4f40();return a48_0x52c6=function(_0x52c694,_0x2ab39d){_0x52c694=_0x52c694-0x15a;let _0x3603b8=_0x4f40e1[_0x52c694];return _0x3603b8;},a48_0x52c6(_0x480d39,_0x2df685);}var __importDefault=this&&this[a48_0x57fcb5(0x18c)]||function(_0x462990){const _0x2cad56=a48_0x57fcb5;return _0x462990&&_0x462990[_0x2cad56(0x16a)]?_0x462990:{'default':_0x462990};};Object['defineProperty'](exports,a48_0x57fcb5(0x16a),{'value':!![]}),exports['loggerService']=exports[a48_0x57fcb5(0x191)]=void 0x0;function a48_0x4f40(){const _0x471e00=['payments_created','logsDir','toISOString','webhooks_errors','cointopay_status_changes','Failed\x20to\x20get\x20log\x20stats:','RESPONSE','__importDefault','logShopWebhookSent','498450GTwKfR','join','5104650vUREyt','LoggerService','826ftVmRp','WEBHOOK_PROCESSED','length','\x20log:','filter','WEBHOOK_ERROR','stringify','2782XStoIy','white_domain_requests','split','COINTOPAY_STATUS_CHANGE','\x20days)','logPaymentCreated','log','83690YWGnSY','ERROR','Failed\x20to\x20write\x20','.log','logShopWebhookError','stack','1553184tTVcIL','writeLog','SHOP_WEBHOOK_ERROR','api_calls','utf8','logCoinToPayStatus','appendFileSync','error','logWebhookProcessed','5992695fndoXo','white_domain_errors','getLogFileName','statSync','__esModule','7wBeqWq','logWhiteDomainResponse','Failed\x20to\x20clean\x20old\x20logs:','432clOOEE','📁\x20Created\x20logs\x20directory:\x20','message','default','🗑️\x20Deleted\x20old\x20log\x20file:\x20','shop_webhooks_errors','API_CALL','loggerService','ensureLogsDirectory','getLogStats','logWhiteDomainError','map','date','existsSync','mtime','logApiCall','mkdirSync','readdirSync','35024450YerTCn','localeCompare','logWebhookError','webhooks_received','endsWith'];a48_0x4f40=function(){return _0x471e00;};return a48_0x4f40();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x5e976a=a48_0x57fcb5;this['logsDir']=path_1[_0x5e976a(0x171)][_0x5e976a(0x18f)](process['cwd'](),'logs'),this[_0x5e976a(0x176)]();}['ensureLogsDirectory'](){const _0x28f4c3=a48_0x57fcb5;!fs_1['default'][_0x28f4c3(0x17b)](this[_0x28f4c3(0x186)])&&(fs_1[_0x28f4c3(0x171)][_0x28f4c3(0x17e)](this[_0x28f4c3(0x186)],{'recursive':!![]}),console[_0x28f4c3(0x19f)](_0x28f4c3(0x16f)+this['logsDir']));}[a48_0x57fcb5(0x168)](_0x55d345){const _0x5b1a26=a48_0x57fcb5,_0x3eb02d=new Date()[_0x5b1a26(0x187)]()['split']('T')[0x0];return path_1[_0x5b1a26(0x171)][_0x5b1a26(0x18f)](this['logsDir'],_0x55d345+'_'+_0x3eb02d+_0x5b1a26(0x15a));}[a48_0x57fcb5(0x15e)](_0x10c962,_0xe97de2){const _0x26fedf=a48_0x57fcb5;try{const _0x5d6823=new Date()[_0x26fedf(0x187)](),_0x3b0888={'timestamp':_0x5d6823,..._0xe97de2},_0x8aa0d5=JSON[_0x26fedf(0x198)](_0x3b0888)+'\x0a',_0x7ee6a1=this[_0x26fedf(0x168)](_0x10c962);fs_1[_0x26fedf(0x171)][_0x26fedf(0x163)](_0x7ee6a1,_0x8aa0d5,_0x26fedf(0x161));}catch(_0x3d12a6){console[_0x26fedf(0x164)](_0x26fedf(0x1a2)+_0x10c962+_0x26fedf(0x195),_0x3d12a6);}}['logWhiteDomainRequest'](_0x377afe,_0x5b899d,_0x44091f,_0x44d8c2){const _0x542ef5=a48_0x57fcb5;this[_0x542ef5(0x15e)](_0x542ef5(0x19a),{'type':'REQUEST','gateway':_0x377afe,'endpoint':_0x5b899d,'method':_0x44091f,'data':_0x44d8c2});}[a48_0x57fcb5(0x16c)](_0x3aa89f,_0x274966,_0xc8e7c4,_0x36e42f,_0x4ec1c4){const _0x30262b=a48_0x57fcb5;this[_0x30262b(0x15e)]('white_domain_responses',{'type':_0x30262b(0x18b),'gateway':_0x3aa89f,'endpoint':_0x274966,'status':_0xc8e7c4,'responseTime':_0x4ec1c4,'data':_0x36e42f});}[a48_0x57fcb5(0x178)](_0x25ab21,_0x222815,_0x414dee){const _0x24603c=a48_0x57fcb5;this[_0x24603c(0x15e)](_0x24603c(0x167),{'type':_0x24603c(0x1a1),'gateway':_0x25ab21,'endpoint':_0x222815,'error':_0x414dee instanceof Error?{'message':_0x414dee[_0x24603c(0x170)],'stack':_0x414dee[_0x24603c(0x15c)]}:_0x414dee});}['logWebhookReceived'](_0x3bab48,_0x271feb,_0x3c31b6){const _0x4d959c=a48_0x57fcb5;this['writeLog'](_0x4d959c(0x183),{'type':'WEBHOOK_RECEIVED','gateway':_0x3bab48,'headers':_0x3c31b6,'data':_0x271feb});}[a48_0x57fcb5(0x165)](_0x7bb5a6,_0x35d45a,_0x3cebc3,_0xe5bf8f,_0x5bf638){const _0x44b3fa=a48_0x57fcb5;this[_0x44b3fa(0x15e)]('webhooks_processed',{'type':_0x44b3fa(0x193),'gateway':_0x7bb5a6,'paymentId':_0x35d45a,'oldStatus':_0x3cebc3,'newStatus':_0xe5bf8f,'originalData':_0x5bf638});}[a48_0x57fcb5(0x182)](_0x200c00,_0x3928f5,_0x364001){const _0x5b886e=a48_0x57fcb5;this[_0x5b886e(0x15e)](_0x5b886e(0x188),{'type':_0x5b886e(0x197),'gateway':_0x200c00,'error':_0x3928f5 instanceof Error?{'message':_0x3928f5[_0x5b886e(0x170)],'stack':_0x3928f5[_0x5b886e(0x15c)]}:_0x3928f5,'originalData':_0x364001});}[a48_0x57fcb5(0x162)](_0x47d495){const _0x1d2eb2=a48_0x57fcb5;this['writeLog'](_0x1d2eb2(0x189),{'type':_0x1d2eb2(0x19c),..._0x47d495});}['logCoinToPayError'](_0x3368b0){const _0x370378=a48_0x57fcb5;this[_0x370378(0x15e)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x3368b0});}[a48_0x57fcb5(0x18d)](_0x2b35e9,_0x238afc,_0x149155,_0xcaf009,_0x376438,_0x59cffc){const _0x4f7b32=a48_0x57fcb5;this[_0x4f7b32(0x15e)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x2b35e9,'webhookUrl':_0x238afc,'event':_0x149155,'status':_0xcaf009,'responseTime':_0x376438,'payload':_0x59cffc});}[a48_0x57fcb5(0x15b)](_0x9c909e,_0x26e676,_0x31f042,_0x4bbdeb,_0x37280f){const _0x2e1db9=a48_0x57fcb5;this['writeLog'](_0x2e1db9(0x173),{'type':_0x2e1db9(0x15f),'shopId':_0x9c909e,'webhookUrl':_0x26e676,'event':_0x31f042,'error':_0x4bbdeb instanceof Error?{'message':_0x4bbdeb[_0x2e1db9(0x170)],'stack':_0x4bbdeb[_0x2e1db9(0x15c)]}:_0x4bbdeb,'payload':_0x37280f});}[a48_0x57fcb5(0x19e)](_0xe86973,_0x2f180f,_0x1ec997,_0x32dee8,_0x54185e){const _0x3cd998=a48_0x57fcb5;this[_0x3cd998(0x15e)](_0x3cd998(0x185),{'type':'PAYMENT_CREATED','gateway':_0xe86973,'paymentId':_0x2f180f,'shopId':_0x1ec997,'amount':_0x32dee8,'currency':_0x54185e});}[a48_0x57fcb5(0x17d)](_0x456368,_0xa067ea,_0x284838,_0x5460d2,_0x17cc19){const _0x48c0bb=a48_0x57fcb5;this[_0x48c0bb(0x15e)](_0x48c0bb(0x160),{'type':_0x48c0bb(0x174),'endpoint':_0x456368,'method':_0xa067ea,'userId':_0x284838,'userRole':_0x5460d2,'requestData':_0x17cc19});}[a48_0x57fcb5(0x177)](){const _0x285138=a48_0x57fcb5;try{const _0x15efc8=fs_1['default'][_0x285138(0x17f)](this[_0x285138(0x186)]),_0x4d090d=_0x15efc8[_0x285138(0x196)](_0x4e4b19=>_0x4e4b19[_0x285138(0x184)](_0x285138(0x15a))),_0x3a6e5c=[...new Set(_0x4d090d['map'](_0x33fa25=>_0x33fa25[_0x285138(0x19b)]('_')[0x0]))],_0x1f9d9d=_0x4d090d[_0x285138(0x179)](_0x4944c3=>{const _0x248c9a=_0x285138,_0x30f445=path_1[_0x248c9a(0x171)][_0x248c9a(0x18f)](this[_0x248c9a(0x186)],_0x4944c3),_0x19043d=fs_1[_0x248c9a(0x171)][_0x248c9a(0x169)](_0x30f445),[_0x4bd193,_0x3730e0]=_0x4944c3['replace']('.log','')['split']('_');return{'type':_0x4bd193,'date':_0x3730e0,'size':_0x19043d['size']};})['sort']((_0x1a846a,_0x1005f1)=>_0x1005f1[_0x285138(0x17a)][_0x285138(0x181)](_0x1a846a[_0x285138(0x17a)]));return{'totalFiles':_0x4d090d[_0x285138(0x194)],'logTypes':_0x3a6e5c,'latestLogs':_0x1f9d9d['slice'](0x0,0xa)};}catch(_0x1df832){return console['error'](_0x285138(0x18a),_0x1df832),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0xd1f5f6=0x1e){const _0x1f1be7=a48_0x57fcb5;try{const _0x1ac884=fs_1['default'][_0x1f1be7(0x17f)](this[_0x1f1be7(0x186)]),_0xebb3ad=new Date();_0xebb3ad['setDate'](_0xebb3ad['getDate']()-_0xd1f5f6);let _0x25ea3a=0x0;_0x1ac884['forEach'](_0x26b7c8=>{const _0xd0608=_0x1f1be7;if(!_0x26b7c8[_0xd0608(0x184)](_0xd0608(0x15a)))return;const _0x1f588d=path_1[_0xd0608(0x171)][_0xd0608(0x18f)](this[_0xd0608(0x186)],_0x26b7c8),_0x506c40=fs_1[_0xd0608(0x171)][_0xd0608(0x169)](_0x1f588d);_0x506c40[_0xd0608(0x17c)]<_0xebb3ad&&(fs_1[_0xd0608(0x171)]['unlinkSync'](_0x1f588d),_0x25ea3a++,console[_0xd0608(0x19f)](_0xd0608(0x172)+_0x26b7c8));}),console['log']('🧹\x20Cleaned\x20'+_0x25ea3a+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0xd1f5f6+_0x1f1be7(0x19d));}catch(_0x49eb5b){console[_0x1f1be7(0x164)](_0x1f1be7(0x16d),_0x49eb5b);}}}exports[a48_0x57fcb5(0x191)]=LoggerService,exports[a48_0x57fcb5(0x175)]=new LoggerService();