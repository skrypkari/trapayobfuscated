'use strict';const a47_0x1c15da=a47_0x8fe1;(function(_0x885d17,_0x3cbffa){const _0x1d1543=a47_0x8fe1,_0x39189d=_0x885d17();while(!![]){try{const _0x23adc7=-parseInt(_0x1d1543(0x12d))/0x1+parseInt(_0x1d1543(0x108))/0x2*(-parseInt(_0x1d1543(0xe7))/0x3)+parseInt(_0x1d1543(0xef))/0x4*(-parseInt(_0x1d1543(0xea))/0x5)+-parseInt(_0x1d1543(0xe1))/0x6+parseInt(_0x1d1543(0x113))/0x7*(parseInt(_0x1d1543(0xf6))/0x8)+parseInt(_0x1d1543(0x123))/0x9*(-parseInt(_0x1d1543(0x11c))/0xa)+parseInt(_0x1d1543(0xf0))/0xb;if(_0x23adc7===_0x3cbffa)break;else _0x39189d['push'](_0x39189d['shift']());}catch(_0x8bf587){_0x39189d['push'](_0x39189d['shift']());}}}(a47_0x3136,0x1f50c));var __importDefault=this&&this[a47_0x1c15da(0xe8)]||function(_0xc18d7c){return _0xc18d7c&&_0xc18d7c['__esModule']?_0xc18d7c:{'default':_0xc18d7c};};function a47_0x3136(){const _0x2c83a7=['logsDir','webhooks_processed','272lCoWlm','cointopay_status_changes','default','logApiCall','LoggerService','statSync','white_domain_requests','logCoinToPayError','writeLog','existsSync','length','1333283eqNnmp','map','getDate','split','WEBHOOK_PROCESSED','toISOString','webhooks_errors','size','log','680dVWvMp','ensureLogsDirectory','logs','webhooks_received','setDate','logPaymentCreated','\x20old\x20log\x20files\x20(older\x20than\x20','16515qcCVZP','path','logCoinToPayStatus','🧹\x20Cleaned\x20','filter','ERROR','\x20days)','COINTOPAY_ERROR','error','logWebhookError','80543XqQomV','message','764562ydBGFh','logWebhookProcessed','loggerService','Failed\x20to\x20write\x20','localeCompare','PAYMENT_CREATED','303HhqPmz','__importDefault','date','301085dtbSoJ','getLogStats','join','WEBHOOK_ERROR','stringify','12kDITUb','5114296qUWhsJ','endsWith','getLogFileName','API_CALL','replace','cointopay_errors','8XaeToR','shop_webhooks_sent','REQUEST','slice','white_domain_responses','unlinkSync','logShopWebhookError','sort','defineProperty','.log','shop_webhooks_errors','🗑️\x20Deleted\x20old\x20log\x20file:\x20','stack','SHOP_WEBHOOK_ERROR','readdirSync','Failed\x20to\x20get\x20log\x20stats:'];a47_0x3136=function(){return _0x2c83a7;};return a47_0x3136();}Object[a47_0x1c15da(0xfe)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a47_0x1c15da(0x10c)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a47_0x1c15da(0x124)));function a47_0x8fe1(_0x479b82,_0x4d3129){const _0x3136d2=a47_0x3136();return a47_0x8fe1=function(_0x8fe125,_0x42546b){_0x8fe125=_0x8fe125-0xe0;let _0x571bc7=_0x3136d2[_0x8fe125];return _0x571bc7;},a47_0x8fe1(_0x479b82,_0x4d3129);}class LoggerService{constructor(){const _0x20b7d7=a47_0x1c15da;this[_0x20b7d7(0x106)]=path_1[_0x20b7d7(0x10a)][_0x20b7d7(0xec)](process['cwd'](),_0x20b7d7(0x11e)),this[_0x20b7d7(0x11d)]();}['ensureLogsDirectory'](){const _0x5ab84a=a47_0x1c15da;!fs_1[_0x5ab84a(0x10a)][_0x5ab84a(0x111)](this['logsDir'])&&(fs_1[_0x5ab84a(0x10a)]['mkdirSync'](this[_0x5ab84a(0x106)],{'recursive':!![]}),console[_0x5ab84a(0x11b)]('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a47_0x1c15da(0xf2)](_0x42fea8){const _0x169f26=a47_0x1c15da,_0x573d7d=new Date()[_0x169f26(0x118)]()['split']('T')[0x0];return path_1[_0x169f26(0x10a)][_0x169f26(0xec)](this[_0x169f26(0x106)],_0x42fea8+'_'+_0x573d7d+_0x169f26(0xff));}[a47_0x1c15da(0x110)](_0x46d484,_0x4919c5){const _0x102fec=a47_0x1c15da;try{const _0x66b36=new Date()['toISOString'](),_0x58a5db={'timestamp':_0x66b36,..._0x4919c5},_0x2ff856=JSON[_0x102fec(0xee)](_0x58a5db)+'\x0a',_0x2b342a=this[_0x102fec(0xf2)](_0x46d484);fs_1[_0x102fec(0x10a)]['appendFileSync'](_0x2b342a,_0x2ff856,'utf8');}catch(_0x193e2c){console[_0x102fec(0x12b)](_0x102fec(0xe4)+_0x46d484+'\x20log:',_0x193e2c);}}['logWhiteDomainRequest'](_0x2af43c,_0x3d046d,_0x5eea14,_0x307290){const _0x16e862=a47_0x1c15da;this['writeLog'](_0x16e862(0x10e),{'type':_0x16e862(0xf8),'gateway':_0x2af43c,'endpoint':_0x3d046d,'method':_0x5eea14,'data':_0x307290});}['logWhiteDomainResponse'](_0x1293aa,_0x1fb841,_0x3ca604,_0x4c444a,_0x34d1b7){const _0x5df091=a47_0x1c15da;this[_0x5df091(0x110)](_0x5df091(0xfa),{'type':'RESPONSE','gateway':_0x1293aa,'endpoint':_0x1fb841,'status':_0x3ca604,'responseTime':_0x34d1b7,'data':_0x4c444a});}['logWhiteDomainError'](_0x8d53f1,_0x26263a,_0x1d9ba7){const _0x2d9693=a47_0x1c15da;this['writeLog']('white_domain_errors',{'type':_0x2d9693(0x128),'gateway':_0x8d53f1,'endpoint':_0x26263a,'error':_0x1d9ba7 instanceof Error?{'message':_0x1d9ba7[_0x2d9693(0xe0)],'stack':_0x1d9ba7[_0x2d9693(0x102)]}:_0x1d9ba7});}['logWebhookReceived'](_0x3776a2,_0x5dda58,_0x33c753){const _0x3bd03d=a47_0x1c15da;this[_0x3bd03d(0x110)](_0x3bd03d(0x11f),{'type':'WEBHOOK_RECEIVED','gateway':_0x3776a2,'headers':_0x33c753,'data':_0x5dda58});}[a47_0x1c15da(0xe2)](_0x9c8ee3,_0xc1c77d,_0x76e27c,_0x26aa53,_0x2cdefa){const _0x433f16=a47_0x1c15da;this[_0x433f16(0x110)](_0x433f16(0x107),{'type':_0x433f16(0x117),'gateway':_0x9c8ee3,'paymentId':_0xc1c77d,'oldStatus':_0x76e27c,'newStatus':_0x26aa53,'originalData':_0x2cdefa});}[a47_0x1c15da(0x12c)](_0x4cdd07,_0x25da9d,_0x2ff6d0){const _0x52c1d4=a47_0x1c15da;this[_0x52c1d4(0x110)](_0x52c1d4(0x119),{'type':_0x52c1d4(0xed),'gateway':_0x4cdd07,'error':_0x25da9d instanceof Error?{'message':_0x25da9d[_0x52c1d4(0xe0)],'stack':_0x25da9d[_0x52c1d4(0x102)]}:_0x25da9d,'originalData':_0x2ff6d0});}[a47_0x1c15da(0x125)](_0x379310){const _0x328b9e=a47_0x1c15da;this[_0x328b9e(0x110)](_0x328b9e(0x109),{'type':'COINTOPAY_STATUS_CHANGE',..._0x379310});}[a47_0x1c15da(0x10f)](_0x171a65){const _0x59e8b8=a47_0x1c15da;this['writeLog'](_0x59e8b8(0xf5),{'type':_0x59e8b8(0x12a),..._0x171a65});}['logShopWebhookSent'](_0x599116,_0x297670,_0x2891d5,_0x242982,_0x6d1b33,_0x43f7a4){const _0x521279=a47_0x1c15da;this['writeLog'](_0x521279(0xf7),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x599116,'webhookUrl':_0x297670,'event':_0x2891d5,'status':_0x242982,'responseTime':_0x6d1b33,'payload':_0x43f7a4});}[a47_0x1c15da(0xfc)](_0x286a22,_0x3ee4a1,_0xa0337c,_0x1e9be8,_0x5913c2){const _0x359f65=a47_0x1c15da;this['writeLog'](_0x359f65(0x100),{'type':_0x359f65(0x103),'shopId':_0x286a22,'webhookUrl':_0x3ee4a1,'event':_0xa0337c,'error':_0x1e9be8 instanceof Error?{'message':_0x1e9be8[_0x359f65(0xe0)],'stack':_0x1e9be8[_0x359f65(0x102)]}:_0x1e9be8,'payload':_0x5913c2});}[a47_0x1c15da(0x121)](_0x34ad88,_0x50efb2,_0x4a54d0,_0xf85fff,_0x24de22){const _0x30769b=a47_0x1c15da;this[_0x30769b(0x110)]('payments_created',{'type':_0x30769b(0xe6),'gateway':_0x34ad88,'paymentId':_0x50efb2,'shopId':_0x4a54d0,'amount':_0xf85fff,'currency':_0x24de22});}[a47_0x1c15da(0x10b)](_0x3106ee,_0x52d7e9,_0x25bd90,_0x1ed503,_0x1b3b8c){const _0x261c58=a47_0x1c15da;this['writeLog']('api_calls',{'type':_0x261c58(0xf3),'endpoint':_0x3106ee,'method':_0x52d7e9,'userId':_0x25bd90,'userRole':_0x1ed503,'requestData':_0x1b3b8c});}[a47_0x1c15da(0xeb)](){const _0x232fbb=a47_0x1c15da;try{const _0x43184c=fs_1[_0x232fbb(0x10a)]['readdirSync'](this[_0x232fbb(0x106)]),_0x1bffff=_0x43184c[_0x232fbb(0x127)](_0x51ad98=>_0x51ad98[_0x232fbb(0xf1)](_0x232fbb(0xff))),_0x54a2b1=[...new Set(_0x1bffff[_0x232fbb(0x114)](_0x2d68a6=>_0x2d68a6['split']('_')[0x0]))],_0x5ef559=_0x1bffff[_0x232fbb(0x114)](_0xb0fed4=>{const _0x2f480c=_0x232fbb,_0x5f5282=path_1['default'][_0x2f480c(0xec)](this[_0x2f480c(0x106)],_0xb0fed4),_0x7691e3=fs_1['default']['statSync'](_0x5f5282),[_0x57869a,_0x5dbb47]=_0xb0fed4[_0x2f480c(0xf4)](_0x2f480c(0xff),'')[_0x2f480c(0x116)]('_');return{'type':_0x57869a,'date':_0x5dbb47,'size':_0x7691e3[_0x2f480c(0x11a)]};})[_0x232fbb(0xfd)]((_0x55e2ff,_0x42501c)=>_0x42501c['date'][_0x232fbb(0xe5)](_0x55e2ff[_0x232fbb(0xe9)]));return{'totalFiles':_0x1bffff[_0x232fbb(0x112)],'logTypes':_0x54a2b1,'latestLogs':_0x5ef559[_0x232fbb(0xf9)](0x0,0xa)};}catch(_0x16be06){return console[_0x232fbb(0x12b)](_0x232fbb(0x105),_0x16be06),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x4bddad=0x1e){const _0x5c6a53=a47_0x1c15da;try{const _0x5ac125=fs_1[_0x5c6a53(0x10a)][_0x5c6a53(0x104)](this[_0x5c6a53(0x106)]),_0x2c616c=new Date();_0x2c616c[_0x5c6a53(0x120)](_0x2c616c[_0x5c6a53(0x115)]()-_0x4bddad);let _0x3e55ec=0x0;_0x5ac125['forEach'](_0xfa6d86=>{const _0x83705f=_0x5c6a53;if(!_0xfa6d86[_0x83705f(0xf1)]('.log'))return;const _0x3b8793=path_1['default'][_0x83705f(0xec)](this[_0x83705f(0x106)],_0xfa6d86),_0x543df9=fs_1[_0x83705f(0x10a)][_0x83705f(0x10d)](_0x3b8793);_0x543df9['mtime']<_0x2c616c&&(fs_1['default'][_0x83705f(0xfb)](_0x3b8793),_0x3e55ec++,console[_0x83705f(0x11b)](_0x83705f(0x101)+_0xfa6d86));}),console[_0x5c6a53(0x11b)](_0x5c6a53(0x126)+_0x3e55ec+_0x5c6a53(0x122)+_0x4bddad+_0x5c6a53(0x129));}catch(_0x57d2a6){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x57d2a6);}}}exports[a47_0x1c15da(0x10c)]=LoggerService,exports[a47_0x1c15da(0xe3)]=new LoggerService();