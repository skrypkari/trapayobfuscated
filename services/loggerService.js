'use strict';const a49_0x48e543=a49_0x1605;(function(_0x4296f6,_0x3c1690){const _0x2bd4fb=a49_0x1605,_0x4db47e=_0x4296f6();while(!![]){try{const _0x232996=parseInt(_0x2bd4fb(0xb2))/0x1+parseInt(_0x2bd4fb(0xec))/0x2+-parseInt(_0x2bd4fb(0xa4))/0x3+-parseInt(_0x2bd4fb(0xb6))/0x4*(-parseInt(_0x2bd4fb(0xa9))/0x5)+-parseInt(_0x2bd4fb(0xbb))/0x6+parseInt(_0x2bd4fb(0xdc))/0x7*(-parseInt(_0x2bd4fb(0xe3))/0x8)+parseInt(_0x2bd4fb(0xde))/0x9;if(_0x232996===_0x3c1690)break;else _0x4db47e['push'](_0x4db47e['shift']());}catch(_0x27d4dd){_0x4db47e['push'](_0x4db47e['shift']());}}}(a49_0xb5d4,0x19083));var __importDefault=this&&this['__importDefault']||function(_0x4c18fc){const _0x21493a=a49_0x1605;return _0x4c18fc&&_0x4c18fc[_0x21493a(0xa3)]?_0x4c18fc:{'default':_0x4c18fc};};function a49_0xb5d4(){const _0x11d9d5=['307195sGIink','mtime','3351231dkMjFv','logWebhookError','🧹\x20Cleaned\x20','logCoinToPayError','logApiCall','24rAylbp','stack','path','size','cointopay_errors','api_calls','logWhiteDomainResponse','\x20log:','cointopay_status_changes','33882ohgBxJ','payments_created','.log','stringify','ensureLogsDirectory','WEBHOOK_PROCESSED','COINTOPAY_STATUS_CHANGE','join','cleanOldLogs','map','\x20days)','__esModule','446019EIQXWr','logShopWebhookSent','writeLog','default','split','5YqgmmY','API_CALL','logWhiteDomainError','logShopWebhookError','forEach','logCoinToPayStatus','statSync','logsDir','webhooks_received','41688vCwnoQ','setDate','COINTOPAY_ERROR','loggerService','208096TzebMI','Failed\x20to\x20write\x20','localeCompare','defineProperty','webhooks_processed','600918OryWjB','error','getLogStats','logWebhookReceived','appendFileSync','LoggerService','🗑️\x20Deleted\x20old\x20log\x20file:\x20','white_domain_responses','logs','log','getDate','WEBHOOK_RECEIVED','shop_webhooks_errors','SHOP_WEBHOOK_ERROR','PAYMENT_CREATED','date','existsSync','logPaymentCreated','readdirSync','unlinkSync','getLogFileName','RESPONSE','shop_webhooks_sent','utf8','cwd','Failed\x20to\x20clean\x20old\x20logs:','filter','logWebhookProcessed','message','toISOString','ERROR','length','endsWith'];a49_0xb5d4=function(){return _0x11d9d5;};return a49_0xb5d4();}Object[a49_0x48e543(0xb9)](exports,a49_0x48e543(0xa3),{'value':!![]}),exports[a49_0x48e543(0xb5)]=exports[a49_0x48e543(0xc0)]=void 0x0;function a49_0x1605(_0x273008,_0x1e00b1){const _0xb5d4fe=a49_0xb5d4();return a49_0x1605=function(_0x1605b3,_0x21195c){_0x1605b3=_0x1605b3-0xa2;let _0x575a55=_0xb5d4fe[_0x1605b3];return _0x575a55;},a49_0x1605(_0x273008,_0x1e00b1);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x48e543(0xe5)));class LoggerService{constructor(){const _0x1d5aa6=a49_0x48e543;this['logsDir']=path_1[_0x1d5aa6(0xa7)][_0x1d5aa6(0xf3)](process[_0x1d5aa6(0xd3)](),_0x1d5aa6(0xc3)),this['ensureLogsDirectory']();}[a49_0x48e543(0xf0)](){const _0x57586f=a49_0x48e543;!fs_1['default'][_0x57586f(0xcb)](this[_0x57586f(0xb0)])&&(fs_1[_0x57586f(0xa7)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x57586f(0xc4)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x57586f(0xb0)]));}[a49_0x48e543(0xcf)](_0x8a9baa){const _0x590421=a49_0x48e543,_0x2413b3=new Date()[_0x590421(0xd8)]()['split']('T')[0x0];return path_1[_0x590421(0xa7)][_0x590421(0xf3)](this['logsDir'],_0x8a9baa+'_'+_0x2413b3+_0x590421(0xee));}[a49_0x48e543(0xa6)](_0x2d0b0f,_0x12077e){const _0x3f18a7=a49_0x48e543;try{const _0x28db16=new Date()['toISOString'](),_0x304f87={'timestamp':_0x28db16,..._0x12077e},_0xb9a6a6=JSON[_0x3f18a7(0xef)](_0x304f87)+'\x0a',_0x127c9d=this['getLogFileName'](_0x2d0b0f);fs_1[_0x3f18a7(0xa7)][_0x3f18a7(0xbf)](_0x127c9d,_0xb9a6a6,_0x3f18a7(0xd2));}catch(_0x411f61){console[_0x3f18a7(0xbc)](_0x3f18a7(0xb7)+_0x2d0b0f+_0x3f18a7(0xea),_0x411f61);}}['logWhiteDomainRequest'](_0x258111,_0x2aa229,_0x372d6a,_0x34cedc){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0x258111,'endpoint':_0x2aa229,'method':_0x372d6a,'data':_0x34cedc});}[a49_0x48e543(0xe9)](_0xe1724d,_0x3751c3,_0x45bc1f,_0x59c6b0,_0x1d89e6){const _0x29ee61=a49_0x48e543;this[_0x29ee61(0xa6)](_0x29ee61(0xc2),{'type':_0x29ee61(0xd0),'gateway':_0xe1724d,'endpoint':_0x3751c3,'status':_0x45bc1f,'responseTime':_0x1d89e6,'data':_0x59c6b0});}[a49_0x48e543(0xab)](_0xa2763f,_0x188006,_0x31f89e){const _0x243d7e=a49_0x48e543;this['writeLog']('white_domain_errors',{'type':_0x243d7e(0xd9),'gateway':_0xa2763f,'endpoint':_0x188006,'error':_0x31f89e instanceof Error?{'message':_0x31f89e[_0x243d7e(0xd7)],'stack':_0x31f89e[_0x243d7e(0xe4)]}:_0x31f89e});}[a49_0x48e543(0xbe)](_0x342161,_0x3bf39e,_0x12935e){const _0x2f1af9=a49_0x48e543;this[_0x2f1af9(0xa6)](_0x2f1af9(0xb1),{'type':_0x2f1af9(0xc6),'gateway':_0x342161,'headers':_0x12935e,'data':_0x3bf39e});}[a49_0x48e543(0xd6)](_0x1687bf,_0x1b32f5,_0x39f85b,_0x192947,_0x3d3986){const _0x292a11=a49_0x48e543;this['writeLog'](_0x292a11(0xba),{'type':_0x292a11(0xf1),'gateway':_0x1687bf,'paymentId':_0x1b32f5,'oldStatus':_0x39f85b,'newStatus':_0x192947,'originalData':_0x3d3986});}[a49_0x48e543(0xdf)](_0x572a11,_0x1a39d7,_0x61bc1f){const _0x32bb14=a49_0x48e543;this['writeLog']('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x572a11,'error':_0x1a39d7 instanceof Error?{'message':_0x1a39d7[_0x32bb14(0xd7)],'stack':_0x1a39d7[_0x32bb14(0xe4)]}:_0x1a39d7,'originalData':_0x61bc1f});}[a49_0x48e543(0xae)](_0x1bba0f){const _0x15b674=a49_0x48e543;this[_0x15b674(0xa6)](_0x15b674(0xeb),{'type':_0x15b674(0xf2),..._0x1bba0f});}[a49_0x48e543(0xe1)](_0x291103){const _0x89fa6d=a49_0x48e543;this['writeLog'](_0x89fa6d(0xe7),{'type':_0x89fa6d(0xb4),..._0x291103});}[a49_0x48e543(0xa5)](_0x40029a,_0x27c7da,_0x5cef3e,_0x51c452,_0x5ce98c,_0x215403){const _0x4f347b=a49_0x48e543;this['writeLog'](_0x4f347b(0xd1),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x40029a,'webhookUrl':_0x27c7da,'event':_0x5cef3e,'status':_0x51c452,'responseTime':_0x5ce98c,'payload':_0x215403});}[a49_0x48e543(0xac)](_0x35ce7a,_0x45c665,_0x32160b,_0x577a05,_0x2816c4){const _0xa8acb4=a49_0x48e543;this[_0xa8acb4(0xa6)](_0xa8acb4(0xc7),{'type':_0xa8acb4(0xc8),'shopId':_0x35ce7a,'webhookUrl':_0x45c665,'event':_0x32160b,'error':_0x577a05 instanceof Error?{'message':_0x577a05[_0xa8acb4(0xd7)],'stack':_0x577a05['stack']}:_0x577a05,'payload':_0x2816c4});}[a49_0x48e543(0xcc)](_0x1d4aa7,_0x2184c0,_0x2450ff,_0x483c17,_0x369401){const _0xc381c4=a49_0x48e543;this[_0xc381c4(0xa6)](_0xc381c4(0xed),{'type':_0xc381c4(0xc9),'gateway':_0x1d4aa7,'paymentId':_0x2184c0,'shopId':_0x2450ff,'amount':_0x483c17,'currency':_0x369401});}[a49_0x48e543(0xe2)](_0x5d1aaf,_0x225bdc,_0x4d7eae,_0x40177b,_0x1f5122){const _0x3e6407=a49_0x48e543;this[_0x3e6407(0xa6)](_0x3e6407(0xe8),{'type':_0x3e6407(0xaa),'endpoint':_0x5d1aaf,'method':_0x225bdc,'userId':_0x4d7eae,'userRole':_0x40177b,'requestData':_0x1f5122});}[a49_0x48e543(0xbd)](){const _0x522087=a49_0x48e543;try{const _0x47a4cf=fs_1[_0x522087(0xa7)][_0x522087(0xcd)](this['logsDir']),_0x4d7750=_0x47a4cf[_0x522087(0xd5)](_0x466a22=>_0x466a22[_0x522087(0xdb)](_0x522087(0xee))),_0xdeaa0b=[...new Set(_0x4d7750[_0x522087(0xf5)](_0x371cce=>_0x371cce[_0x522087(0xa8)]('_')[0x0]))],_0x1863dd=_0x4d7750[_0x522087(0xf5)](_0x2df940=>{const _0x5e79dc=_0x522087,_0x51a129=path_1['default'][_0x5e79dc(0xf3)](this[_0x5e79dc(0xb0)],_0x2df940),_0x261799=fs_1[_0x5e79dc(0xa7)]['statSync'](_0x51a129),[_0x374d08,_0x52eac8]=_0x2df940['replace'](_0x5e79dc(0xee),'')[_0x5e79dc(0xa8)]('_');return{'type':_0x374d08,'date':_0x52eac8,'size':_0x261799[_0x5e79dc(0xe6)]};})['sort']((_0x4cf8a1,_0x4ea3cc)=>_0x4ea3cc['date'][_0x522087(0xb8)](_0x4cf8a1[_0x522087(0xca)]));return{'totalFiles':_0x4d7750[_0x522087(0xda)],'logTypes':_0xdeaa0b,'latestLogs':_0x1863dd['slice'](0x0,0xa)};}catch(_0x5841e8){return console[_0x522087(0xbc)]('Failed\x20to\x20get\x20log\x20stats:',_0x5841e8),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x48e543(0xf4)](_0x185328=0x1e){const _0x4f08a6=a49_0x48e543;try{const _0x33b9de=fs_1['default'][_0x4f08a6(0xcd)](this[_0x4f08a6(0xb0)]),_0x4f912e=new Date();_0x4f912e[_0x4f08a6(0xb3)](_0x4f912e[_0x4f08a6(0xc5)]()-_0x185328);let _0x519856=0x0;_0x33b9de[_0x4f08a6(0xad)](_0x4a3c8a=>{const _0x3e95be=_0x4f08a6;if(!_0x4a3c8a[_0x3e95be(0xdb)](_0x3e95be(0xee)))return;const _0x42f478=path_1['default'][_0x3e95be(0xf3)](this['logsDir'],_0x4a3c8a),_0x554fc0=fs_1['default'][_0x3e95be(0xaf)](_0x42f478);_0x554fc0[_0x3e95be(0xdd)]<_0x4f912e&&(fs_1[_0x3e95be(0xa7)][_0x3e95be(0xce)](_0x42f478),_0x519856++,console[_0x3e95be(0xc4)](_0x3e95be(0xc1)+_0x4a3c8a));}),console[_0x4f08a6(0xc4)](_0x4f08a6(0xe0)+_0x519856+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x185328+_0x4f08a6(0xa2));}catch(_0x4ed56d){console[_0x4f08a6(0xbc)](_0x4f08a6(0xd4),_0x4ed56d);}}}exports['LoggerService']=LoggerService,exports[a49_0x48e543(0xb5)]=new LoggerService();