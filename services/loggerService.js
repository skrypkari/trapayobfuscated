'use strict';const a67_0x4f10a3=a67_0x1a95;(function(_0xe77545,_0x25a8be){const _0x17b77e=a67_0x1a95,_0x41a64c=_0xe77545();while(!![]){try{const _0x31cc81=-parseInt(_0x17b77e(0x11a))/0x1*(-parseInt(_0x17b77e(0x122))/0x2)+parseInt(_0x17b77e(0x113))/0x3+-parseInt(_0x17b77e(0x118))/0x4+parseInt(_0x17b77e(0x134))/0x5+parseInt(_0x17b77e(0x13c))/0x6+-parseInt(_0x17b77e(0x13f))/0x7+parseInt(_0x17b77e(0x12c))/0x8;if(_0x31cc81===_0x25a8be)break;else _0x41a64c['push'](_0x41a64c['shift']());}catch(_0x9a0cb5){_0x41a64c['push'](_0x41a64c['shift']());}}}(a67_0x4d0a,0xa8cc9));function a67_0x4d0a(){const _0x54af2a=['map','\x20log:','RESPONSE','error','endsWith','SHOP_WEBHOOK_SENT','162drHcmq','ERROR','__importDefault','API_CALL','forEach','toISOString','logShopWebhookSent','getLogStats','COINTOPAY_ERROR','webhooks_errors','4110112STdebs','LoggerService','payments_created','Failed\x20to\x20clean\x20old\x20logs:','ðŸ§¹\x20Cleaned\x20','stack','SHOP_WEBHOOK_ERROR','cwd','2296705YbFKax','logs','getLogFileName','logCoinToPayError','ðŸ“\x20Created\x20logs\x20directory:\x20','join','logsDir','cointopay_status_changes','4516254MxdsHQ','length','date','7320026rGNCLZ','getDate','\x20old\x20log\x20files\x20(older\x20than\x20','cointopay_errors','logWhiteDomainResponse','default','mkdirSync','writeLog','message','localeCompare','Failed\x20to\x20get\x20log\x20stats:','path','__esModule','logPaymentCreated','WEBHOOK_ERROR','split','shop_webhooks_errors','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','readdirSync','loggerService','logCoinToPayStatus','logWebhookProcessed','slice','unlinkSync','REQUEST','statSync','logWhiteDomainRequest','ensureLogsDirectory','utf8','filter','WEBHOOK_PROCESSED','mtime','2409324DXEGXt','logWhiteDomainError','logWebhookError','stringify','.log','5510704bkDOUP','Failed\x20to\x20write\x20','7233GgGrFO','log'];a67_0x4d0a=function(){return _0x54af2a;};return a67_0x4d0a();}var __importDefault=this&&this[a67_0x4f10a3(0x124)]||function(_0x58fc81){return _0x58fc81&&_0x58fc81['__esModule']?_0x58fc81:{'default':_0x58fc81};};Object['defineProperty'](exports,a67_0x4f10a3(0x14b),{'value':!![]}),exports[a67_0x4f10a3(0x106)]=exports['LoggerService']=void 0x0;function a67_0x1a95(_0x54e483,_0x4d6d06){_0x54e483=_0x54e483-0x101;const _0x4d0a03=a67_0x4d0a();let _0x1a9563=_0x4d0a03[_0x54e483];return _0x1a9563;}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a67_0x4f10a3(0x14a)));class LoggerService{constructor(){const _0x26176f=a67_0x4f10a3;this['logsDir']=path_1[_0x26176f(0x144)]['join'](process[_0x26176f(0x133)](),_0x26176f(0x135)),this[_0x26176f(0x10e)]();}[a67_0x4f10a3(0x10e)](){const _0x346dd3=a67_0x4f10a3;!fs_1[_0x346dd3(0x144)]['existsSync'](this[_0x346dd3(0x13a)])&&(fs_1[_0x346dd3(0x144)][_0x346dd3(0x145)](this['logsDir'],{'recursive':!![]}),console[_0x346dd3(0x11b)](_0x346dd3(0x138)+this[_0x346dd3(0x13a)]));}[a67_0x4f10a3(0x136)](_0x29d09c){const _0x19b580=a67_0x4f10a3,_0x27e8bb=new Date()[_0x19b580(0x127)]()['split']('T')[0x0];return path_1[_0x19b580(0x144)]['join'](this[_0x19b580(0x13a)],_0x29d09c+'_'+_0x27e8bb+_0x19b580(0x117));}['writeLog'](_0xa7001f,_0x40536a){const _0x47840b=a67_0x4f10a3;try{const _0x2835ff=new Date()[_0x47840b(0x127)](),_0x35360f={'timestamp':_0x2835ff,..._0x40536a},_0x52cb3b=JSON[_0x47840b(0x116)](_0x35360f)+'\x0a',_0x5ca196=this[_0x47840b(0x136)](_0xa7001f);fs_1[_0x47840b(0x144)]['appendFileSync'](_0x5ca196,_0x52cb3b,_0x47840b(0x10f));}catch(_0x41e513){console['error'](_0x47840b(0x119)+_0xa7001f+_0x47840b(0x11d),_0x41e513);}}[a67_0x4f10a3(0x10d)](_0x32c519,_0x881287,_0x4d8bef,_0x5cb640){const _0xde2395=a67_0x4f10a3;this[_0xde2395(0x146)]('white_domain_requests',{'type':_0xde2395(0x10b),'gateway':_0x32c519,'endpoint':_0x881287,'method':_0x4d8bef,'data':_0x5cb640});}[a67_0x4f10a3(0x143)](_0x3fb813,_0x44a87a,_0x271641,_0xe4323a,_0x36e42e){const _0x16ee19=a67_0x4f10a3;this[_0x16ee19(0x146)]('white_domain_responses',{'type':_0x16ee19(0x11e),'gateway':_0x3fb813,'endpoint':_0x44a87a,'status':_0x271641,'responseTime':_0x36e42e,'data':_0xe4323a});}[a67_0x4f10a3(0x114)](_0x1f0da4,_0x5bf5f2,_0x3e6d82){const _0x4bd554=a67_0x4f10a3;this[_0x4bd554(0x146)]('white_domain_errors',{'type':_0x4bd554(0x123),'gateway':_0x1f0da4,'endpoint':_0x5bf5f2,'error':_0x3e6d82 instanceof Error?{'message':_0x3e6d82[_0x4bd554(0x147)],'stack':_0x3e6d82[_0x4bd554(0x131)]}:_0x3e6d82});}['logWebhookReceived'](_0x30e061,_0x3e6c39,_0x28eecf){this['writeLog']('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x30e061,'headers':_0x28eecf,'data':_0x3e6c39});}[a67_0x4f10a3(0x108)](_0x4f7836,_0x3bbe2c,_0x2110e3,_0x6746bb,_0x27f770){const _0x3c4e04=a67_0x4f10a3;this['writeLog']('webhooks_processed',{'type':_0x3c4e04(0x111),'gateway':_0x4f7836,'paymentId':_0x3bbe2c,'oldStatus':_0x2110e3,'newStatus':_0x6746bb,'originalData':_0x27f770});}[a67_0x4f10a3(0x115)](_0x4e356c,_0xf2d7d0,_0x245ea0){const _0x3536e2=a67_0x4f10a3;this['writeLog'](_0x3536e2(0x12b),{'type':_0x3536e2(0x101),'gateway':_0x4e356c,'error':_0xf2d7d0 instanceof Error?{'message':_0xf2d7d0[_0x3536e2(0x147)],'stack':_0xf2d7d0['stack']}:_0xf2d7d0,'originalData':_0x245ea0});}[a67_0x4f10a3(0x107)](_0x512bb2){const _0x2a1295=a67_0x4f10a3;this['writeLog'](_0x2a1295(0x13b),{'type':'COINTOPAY_STATUS_CHANGE',..._0x512bb2});}[a67_0x4f10a3(0x137)](_0x21fdea){const _0x3e6871=a67_0x4f10a3;this[_0x3e6871(0x146)](_0x3e6871(0x142),{'type':_0x3e6871(0x12a),..._0x21fdea});}[a67_0x4f10a3(0x128)](_0x55ae29,_0x342c65,_0x192af5,_0x5660dc,_0x29917a,_0x90d80b){const _0x5c868b=a67_0x4f10a3;this[_0x5c868b(0x146)]('shop_webhooks_sent',{'type':_0x5c868b(0x121),'shopId':_0x55ae29,'webhookUrl':_0x342c65,'event':_0x192af5,'status':_0x5660dc,'responseTime':_0x29917a,'payload':_0x90d80b});}['logShopWebhookError'](_0x4192e6,_0xc31fe8,_0x182715,_0x43d3ed,_0x360072){const _0x447ada=a67_0x4f10a3;this[_0x447ada(0x146)](_0x447ada(0x103),{'type':_0x447ada(0x132),'shopId':_0x4192e6,'webhookUrl':_0xc31fe8,'event':_0x182715,'error':_0x43d3ed instanceof Error?{'message':_0x43d3ed['message'],'stack':_0x43d3ed[_0x447ada(0x131)]}:_0x43d3ed,'payload':_0x360072});}[a67_0x4f10a3(0x14c)](_0x4e377b,_0x2b4202,_0x3976ea,_0x43b956,_0x108a2c){const _0x22456f=a67_0x4f10a3;this['writeLog'](_0x22456f(0x12e),{'type':'PAYMENT_CREATED','gateway':_0x4e377b,'paymentId':_0x2b4202,'shopId':_0x3976ea,'amount':_0x43b956,'currency':_0x108a2c});}['logApiCall'](_0x5548bf,_0x13ca90,_0x210eec,_0x485a1e,_0x225887){const _0x2d328a=a67_0x4f10a3;this['writeLog']('api_calls',{'type':_0x2d328a(0x125),'endpoint':_0x5548bf,'method':_0x13ca90,'userId':_0x210eec,'userRole':_0x485a1e,'requestData':_0x225887});}[a67_0x4f10a3(0x129)](){const _0x4e892c=a67_0x4f10a3;try{const _0x489634=fs_1[_0x4e892c(0x144)][_0x4e892c(0x105)](this[_0x4e892c(0x13a)]),_0x3457c8=_0x489634[_0x4e892c(0x110)](_0x4ef7cd=>_0x4ef7cd[_0x4e892c(0x120)](_0x4e892c(0x117))),_0x3395e9=[...new Set(_0x3457c8[_0x4e892c(0x11c)](_0x2bd2e6=>_0x2bd2e6[_0x4e892c(0x102)]('_')[0x0]))],_0x3d7fb2=_0x3457c8['map'](_0x5b2f45=>{const _0x457794=_0x4e892c,_0x4b299f=path_1[_0x457794(0x144)]['join'](this[_0x457794(0x13a)],_0x5b2f45),_0x102d27=fs_1['default'][_0x457794(0x10c)](_0x4b299f),[_0x1b263a,_0x4304d7]=_0x5b2f45['replace'](_0x457794(0x117),'')[_0x457794(0x102)]('_');return{'type':_0x1b263a,'date':_0x4304d7,'size':_0x102d27['size']};})['sort']((_0x4a6b50,_0x5ce78f)=>_0x5ce78f[_0x4e892c(0x13e)][_0x4e892c(0x148)](_0x4a6b50[_0x4e892c(0x13e)]));return{'totalFiles':_0x3457c8[_0x4e892c(0x13d)],'logTypes':_0x3395e9,'latestLogs':_0x3d7fb2[_0x4e892c(0x109)](0x0,0xa)};}catch(_0x22090b){return console[_0x4e892c(0x11f)](_0x4e892c(0x149),_0x22090b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x2fce96=0x1e){const _0x63c269=a67_0x4f10a3;try{const _0x3514b0=fs_1[_0x63c269(0x144)][_0x63c269(0x105)](this[_0x63c269(0x13a)]),_0x5188f4=new Date();_0x5188f4['setDate'](_0x5188f4[_0x63c269(0x140)]()-_0x2fce96);let _0x3ecbfd=0x0;_0x3514b0[_0x63c269(0x126)](_0xb6e4be=>{const _0x280a15=_0x63c269;if(!_0xb6e4be['endsWith'](_0x280a15(0x117)))return;const _0x5df98d=path_1['default'][_0x280a15(0x139)](this[_0x280a15(0x13a)],_0xb6e4be),_0xcae1de=fs_1[_0x280a15(0x144)]['statSync'](_0x5df98d);_0xcae1de[_0x280a15(0x112)]<_0x5188f4&&(fs_1[_0x280a15(0x144)][_0x280a15(0x10a)](_0x5df98d),_0x3ecbfd++,console[_0x280a15(0x11b)](_0x280a15(0x104)+_0xb6e4be));}),console['log'](_0x63c269(0x130)+_0x3ecbfd+_0x63c269(0x141)+_0x2fce96+'\x20days)');}catch(_0x31687a){console[_0x63c269(0x11f)](_0x63c269(0x12f),_0x31687a);}}}exports[a67_0x4f10a3(0x12d)]=LoggerService,exports[a67_0x4f10a3(0x106)]=new LoggerService();