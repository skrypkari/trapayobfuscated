'use strict';const a67_0x172f70=a67_0x1b27;(function(_0x369ee4,_0x456db8){const _0x41097c=a67_0x1b27,_0x330244=_0x369ee4();while(!![]){try{const _0x104128=-parseInt(_0x41097c(0x1cc))/0x1*(-parseInt(_0x41097c(0x1eb))/0x2)+parseInt(_0x41097c(0x201))/0x3+-parseInt(_0x41097c(0x1e7))/0x4+parseInt(_0x41097c(0x1dc))/0x5+parseInt(_0x41097c(0x1f1))/0x6+-parseInt(_0x41097c(0x1e5))/0x7+-parseInt(_0x41097c(0x1bf))/0x8*(parseInt(_0x41097c(0x1d2))/0x9);if(_0x104128===_0x456db8)break;else _0x330244['push'](_0x330244['shift']());}catch(_0x576b1f){_0x330244['push'](_0x330244['shift']());}}}(a67_0x5bbd,0xd0880));function a67_0x5bbd(){const _0x34198a=['.log','getLogFileName','logShopWebhookError','log','__importDefault','SHOP_WEBHOOK_SENT','PAYMENT_CREATED','SHOP_WEBHOOK_ERROR','105711hDwPEm','error','loggerService','\x20old\x20log\x20files\x20(older\x20than\x20','stack','getLogStats','WEBHOOK_RECEIVED','cwd','utf8','replace','cointopay_status_changes','logPaymentCreated','stringify','RESPONSE','4656NXGdjs','api_calls','ensureLogsDirectory','writeLog','cointopay_errors','unlinkSync','white_domain_requests','logCoinToPayStatus','logsDir','setDate','readdirSync','toISOString','logApiCall','21457naIoGK','logWhiteDomainError','forEach','default','date','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','3033TRUJeN','white_domain_responses','join','ERROR','LoggerService','split','logShopWebhookSent','Failed\x20to\x20clean\x20old\x20logs:','logWebhookReceived','statSync','8391765FBuiNV','API_CALL','message','ðŸ§¹\x20Cleaned\x20','map','shop_webhooks_errors','COINTOPAY_ERROR','appendFileSync','payments_created','11575620HmcQMs','length','5506668uNRcKt','endsWith','existsSync','mtime','62zTWxUo','Failed\x20to\x20get\x20log\x20stats:','getDate','size','cleanOldLogs','ðŸ“\x20Created\x20logs\x20directory:\x20','10211088UqKbWs','WEBHOOK_ERROR','white_domain_errors','Failed\x20to\x20write\x20','__esModule','slice','webhooks_received','shop_webhooks_sent'];a67_0x5bbd=function(){return _0x34198a;};return a67_0x5bbd();}var __importDefault=this&&this[a67_0x172f70(0x1fd)]||function(_0x639e80){const _0xc536d4=a67_0x172f70;return _0x639e80&&_0x639e80[_0xc536d4(0x1f5)]?_0x639e80:{'default':_0x639e80};};function a67_0x1b27(_0x2bf81f,_0x31e250){_0x2bf81f=_0x2bf81f-0x1be;const _0x5bbd26=a67_0x5bbd();let _0x1b27bd=_0x5bbd26[_0x2bf81f];return _0x1b27bd;}Object['defineProperty'](exports,a67_0x172f70(0x1f5),{'value':!![]}),exports[a67_0x172f70(0x203)]=exports[a67_0x172f70(0x1d6)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x2aef2e=a67_0x172f70;this[_0x2aef2e(0x1c7)]=path_1[_0x2aef2e(0x1cf)][_0x2aef2e(0x1d4)](process[_0x2aef2e(0x208)](),'logs'),this[_0x2aef2e(0x1c1)]();}[a67_0x172f70(0x1c1)](){const _0x51536e=a67_0x172f70;!fs_1[_0x51536e(0x1cf)][_0x51536e(0x1e9)](this[_0x51536e(0x1c7)])&&(fs_1['default']['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x51536e(0x1fc)](_0x51536e(0x1f0)+this['logsDir']));}[a67_0x172f70(0x1fa)](_0x17f7ed){const _0x392a85=a67_0x172f70,_0x382c8a=new Date()['toISOString']()[_0x392a85(0x1d7)]('T')[0x0];return path_1['default']['join'](this[_0x392a85(0x1c7)],_0x17f7ed+'_'+_0x382c8a+'.log');}['writeLog'](_0x19a18b,_0x374566){const _0x9f040b=a67_0x172f70;try{const _0x53a358=new Date()[_0x9f040b(0x1ca)](),_0x1aa1cc={'timestamp':_0x53a358,..._0x374566},_0x77aeec=JSON[_0x9f040b(0x20d)](_0x1aa1cc)+'\x0a',_0x4ba6f6=this[_0x9f040b(0x1fa)](_0x19a18b);fs_1['default'][_0x9f040b(0x1e3)](_0x4ba6f6,_0x77aeec,_0x9f040b(0x209));}catch(_0x97db95){console[_0x9f040b(0x202)](_0x9f040b(0x1f4)+_0x19a18b+'\x20log:',_0x97db95);}}['logWhiteDomainRequest'](_0x20b887,_0x1055ab,_0x358cc0,_0x58d1a7){const _0x537640=a67_0x172f70;this[_0x537640(0x1c2)](_0x537640(0x1c5),{'type':'REQUEST','gateway':_0x20b887,'endpoint':_0x1055ab,'method':_0x358cc0,'data':_0x58d1a7});}['logWhiteDomainResponse'](_0x187534,_0x16c178,_0x15767f,_0x28065d,_0x457b96){const _0x5b2d1a=a67_0x172f70;this[_0x5b2d1a(0x1c2)](_0x5b2d1a(0x1d3),{'type':_0x5b2d1a(0x1be),'gateway':_0x187534,'endpoint':_0x16c178,'status':_0x15767f,'responseTime':_0x457b96,'data':_0x28065d});}[a67_0x172f70(0x1cd)](_0xd75ffd,_0x5d23da,_0x1272bf){const _0x524a78=a67_0x172f70;this['writeLog'](_0x524a78(0x1f3),{'type':_0x524a78(0x1d5),'gateway':_0xd75ffd,'endpoint':_0x5d23da,'error':_0x1272bf instanceof Error?{'message':_0x1272bf[_0x524a78(0x1de)],'stack':_0x1272bf['stack']}:_0x1272bf});}[a67_0x172f70(0x1da)](_0xb811ac,_0x47f2e9,_0x1d16d2){const _0x172b75=a67_0x172f70;this[_0x172b75(0x1c2)](_0x172b75(0x1f7),{'type':_0x172b75(0x207),'gateway':_0xb811ac,'headers':_0x1d16d2,'data':_0x47f2e9});}['logWebhookProcessed'](_0x12d27b,_0x2bcb81,_0x1ce5ed,_0xb94135,_0x1fb57d){const _0x54210c=a67_0x172f70;this[_0x54210c(0x1c2)]('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x12d27b,'paymentId':_0x2bcb81,'oldStatus':_0x1ce5ed,'newStatus':_0xb94135,'originalData':_0x1fb57d});}['logWebhookError'](_0x242070,_0x3ebe3f,_0x13abb7){const _0x1f81be=a67_0x172f70;this['writeLog']('webhooks_errors',{'type':_0x1f81be(0x1f2),'gateway':_0x242070,'error':_0x3ebe3f instanceof Error?{'message':_0x3ebe3f[_0x1f81be(0x1de)],'stack':_0x3ebe3f[_0x1f81be(0x205)]}:_0x3ebe3f,'originalData':_0x13abb7});}[a67_0x172f70(0x1c6)](_0x11d16e){const _0x1f87e4=a67_0x172f70;this[_0x1f87e4(0x1c2)](_0x1f87e4(0x20b),{'type':'COINTOPAY_STATUS_CHANGE',..._0x11d16e});}['logCoinToPayError'](_0x14860a){const _0x3c7d81=a67_0x172f70;this[_0x3c7d81(0x1c2)](_0x3c7d81(0x1c3),{'type':_0x3c7d81(0x1e2),..._0x14860a});}[a67_0x172f70(0x1d8)](_0x2be9a7,_0x5f3006,_0x2b4ab4,_0x21f0d1,_0x240342,_0x4c585c){const _0x4ba211=a67_0x172f70;this['writeLog'](_0x4ba211(0x1f8),{'type':_0x4ba211(0x1fe),'shopId':_0x2be9a7,'webhookUrl':_0x5f3006,'event':_0x2b4ab4,'status':_0x21f0d1,'responseTime':_0x240342,'payload':_0x4c585c});}[a67_0x172f70(0x1fb)](_0x5b90b8,_0x1cf75b,_0x2c9d4a,_0x133c21,_0x83376f){const _0x3e7a5c=a67_0x172f70;this[_0x3e7a5c(0x1c2)](_0x3e7a5c(0x1e1),{'type':_0x3e7a5c(0x200),'shopId':_0x5b90b8,'webhookUrl':_0x1cf75b,'event':_0x2c9d4a,'error':_0x133c21 instanceof Error?{'message':_0x133c21[_0x3e7a5c(0x1de)],'stack':_0x133c21[_0x3e7a5c(0x205)]}:_0x133c21,'payload':_0x83376f});}[a67_0x172f70(0x20c)](_0xf4d3f,_0x23d29e,_0x372bb1,_0x4087cf,_0x149503){const _0x57890f=a67_0x172f70;this[_0x57890f(0x1c2)](_0x57890f(0x1e4),{'type':_0x57890f(0x1ff),'gateway':_0xf4d3f,'paymentId':_0x23d29e,'shopId':_0x372bb1,'amount':_0x4087cf,'currency':_0x149503});}[a67_0x172f70(0x1cb)](_0x3750f3,_0x17d92e,_0x1af83a,_0x32d994,_0x187933){const _0x293365=a67_0x172f70;this[_0x293365(0x1c2)](_0x293365(0x1c0),{'type':_0x293365(0x1dd),'endpoint':_0x3750f3,'method':_0x17d92e,'userId':_0x1af83a,'userRole':_0x32d994,'requestData':_0x187933});}[a67_0x172f70(0x206)](){const _0x55855b=a67_0x172f70;try{const _0x37f901=fs_1[_0x55855b(0x1cf)][_0x55855b(0x1c9)](this[_0x55855b(0x1c7)]),_0x10084c=_0x37f901['filter'](_0x3bcbb7=>_0x3bcbb7[_0x55855b(0x1e8)]('.log')),_0x591f29=[...new Set(_0x10084c['map'](_0x2693ff=>_0x2693ff[_0x55855b(0x1d7)]('_')[0x0]))],_0x2a5d67=_0x10084c[_0x55855b(0x1e0)](_0x13a42e=>{const _0x29ce86=_0x55855b,_0x33ce92=path_1[_0x29ce86(0x1cf)][_0x29ce86(0x1d4)](this[_0x29ce86(0x1c7)],_0x13a42e),_0x11e417=fs_1[_0x29ce86(0x1cf)][_0x29ce86(0x1db)](_0x33ce92),[_0x42f1d5,_0x20180f]=_0x13a42e[_0x29ce86(0x20a)](_0x29ce86(0x1f9),'')[_0x29ce86(0x1d7)]('_');return{'type':_0x42f1d5,'date':_0x20180f,'size':_0x11e417[_0x29ce86(0x1ee)]};})['sort']((_0x44215f,_0x2c0088)=>_0x2c0088[_0x55855b(0x1d0)]['localeCompare'](_0x44215f['date']));return{'totalFiles':_0x10084c[_0x55855b(0x1e6)],'logTypes':_0x591f29,'latestLogs':_0x2a5d67[_0x55855b(0x1f6)](0x0,0xa)};}catch(_0x2ba441){return console[_0x55855b(0x202)](_0x55855b(0x1ec),_0x2ba441),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a67_0x172f70(0x1ef)](_0x54a0d0=0x1e){const _0x52c5ce=a67_0x172f70;try{const _0x3d332b=fs_1[_0x52c5ce(0x1cf)][_0x52c5ce(0x1c9)](this['logsDir']),_0x3ff0a2=new Date();_0x3ff0a2[_0x52c5ce(0x1c8)](_0x3ff0a2[_0x52c5ce(0x1ed)]()-_0x54a0d0);let _0x129844=0x0;_0x3d332b[_0x52c5ce(0x1ce)](_0x5c98c2=>{const _0x16121e=_0x52c5ce;if(!_0x5c98c2[_0x16121e(0x1e8)](_0x16121e(0x1f9)))return;const _0x24db23=path_1[_0x16121e(0x1cf)][_0x16121e(0x1d4)](this[_0x16121e(0x1c7)],_0x5c98c2),_0x291474=fs_1['default'][_0x16121e(0x1db)](_0x24db23);_0x291474[_0x16121e(0x1ea)]<_0x3ff0a2&&(fs_1[_0x16121e(0x1cf)][_0x16121e(0x1c4)](_0x24db23),_0x129844++,console['log'](_0x16121e(0x1d1)+_0x5c98c2));}),console['log'](_0x52c5ce(0x1df)+_0x129844+_0x52c5ce(0x204)+_0x54a0d0+'\x20days)');}catch(_0xcee78e){console[_0x52c5ce(0x202)](_0x52c5ce(0x1d9),_0xcee78e);}}}exports['LoggerService']=LoggerService,exports[a67_0x172f70(0x203)]=new LoggerService();