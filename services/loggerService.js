'use strict';const a67_0x1aa4f3=a67_0x57ce;(function(_0x4c3062,_0x22b272){const _0x4fe369=a67_0x57ce,_0x5f60e2=_0x4c3062();while(!![]){try{const _0x1af94d=-parseInt(_0x4fe369(0x21c))/0x1+-parseInt(_0x4fe369(0x213))/0x2*(parseInt(_0x4fe369(0x203))/0x3)+-parseInt(_0x4fe369(0x214))/0x4+-parseInt(_0x4fe369(0x215))/0x5*(-parseInt(_0x4fe369(0x1f7))/0x6)+parseInt(_0x4fe369(0x1fc))/0x7+-parseInt(_0x4fe369(0x1e6))/0x8+parseInt(_0x4fe369(0x20e))/0x9*(parseInt(_0x4fe369(0x200))/0xa);if(_0x1af94d===_0x22b272)break;else _0x5f60e2['push'](_0x5f60e2['shift']());}catch(_0x2b5461){_0x5f60e2['push'](_0x5f60e2['shift']());}}}(a67_0x4b28,0x9b7c6));function a67_0x57ce(_0xc005ae,_0x108391){_0xc005ae=_0xc005ae-0x1df;const _0x4b28ff=a67_0x4b28();let _0x57ced4=_0x4b28ff[_0xc005ae];return _0x57ced4;}var __importDefault=this&&this[a67_0x1aa4f3(0x1ed)]||function(_0x980dfa){const _0x26ecef=a67_0x1aa4f3;return _0x980dfa&&_0x980dfa[_0x26ecef(0x1e2)]?_0x980dfa:{'default':_0x980dfa};};Object[a67_0x1aa4f3(0x21b)](exports,a67_0x1aa4f3(0x1e2),{'value':!![]}),exports[a67_0x1aa4f3(0x1fa)]=exports[a67_0x1aa4f3(0x218)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a67_0x1aa4f3(0x1f2)));class LoggerService{constructor(){const _0x4a1544=a67_0x1aa4f3;this[_0x4a1544(0x22e)]=path_1[_0x4a1544(0x1e0)][_0x4a1544(0x217)](process[_0x4a1544(0x222)](),_0x4a1544(0x1f1)),this['ensureLogsDirectory']();}[a67_0x1aa4f3(0x211)](){const _0x27dbaa=a67_0x1aa4f3;!fs_1['default'][_0x27dbaa(0x1f5)](this[_0x27dbaa(0x22e)])&&(fs_1[_0x27dbaa(0x1e0)][_0x27dbaa(0x227)](this['logsDir'],{'recursive':!![]}),console[_0x27dbaa(0x1f4)]('ğŸ“\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a67_0x1aa4f3(0x1e7)](_0x40bbd4){const _0x37fca5=a67_0x1aa4f3,_0x5cc4e4=new Date()['toISOString']()[_0x37fca5(0x219)]('T')[0x0];return path_1[_0x37fca5(0x1e0)][_0x37fca5(0x217)](this[_0x37fca5(0x22e)],_0x40bbd4+'_'+_0x5cc4e4+'.log');}[a67_0x1aa4f3(0x202)](_0x296a0b,_0x1fe8bf){const _0x2ae5db=a67_0x1aa4f3;try{const _0x233587=new Date()[_0x2ae5db(0x20c)](),_0x5792e6={'timestamp':_0x233587,..._0x1fe8bf},_0x4c2d57=JSON[_0x2ae5db(0x224)](_0x5792e6)+'\x0a',_0x409058=this[_0x2ae5db(0x1e7)](_0x296a0b);fs_1[_0x2ae5db(0x1e0)]['appendFileSync'](_0x409058,_0x4c2d57,_0x2ae5db(0x220));}catch(_0x41e074){console[_0x2ae5db(0x21a)](_0x2ae5db(0x1f0)+_0x296a0b+_0x2ae5db(0x22f),_0x41e074);}}[a67_0x1aa4f3(0x1e3)](_0x3f96b0,_0x38c616,_0x36b194,_0x4062f7){const _0x1cfbd5=a67_0x1aa4f3;this['writeLog']('white_domain_requests',{'type':_0x1cfbd5(0x1e1),'gateway':_0x3f96b0,'endpoint':_0x38c616,'method':_0x36b194,'data':_0x4062f7});}[a67_0x1aa4f3(0x1e8)](_0x236299,_0x1a6eaf,_0x2c2534,_0x19fcd7,_0x16093c){const _0x317124=a67_0x1aa4f3;this[_0x317124(0x202)](_0x317124(0x231),{'type':_0x317124(0x22d),'gateway':_0x236299,'endpoint':_0x1a6eaf,'status':_0x2c2534,'responseTime':_0x16093c,'data':_0x19fcd7});}['logWhiteDomainError'](_0xdb0e61,_0x4c080a,_0x5286dd){const _0x3c7e81=a67_0x1aa4f3;this['writeLog'](_0x3c7e81(0x1ec),{'type':_0x3c7e81(0x1e9),'gateway':_0xdb0e61,'endpoint':_0x4c080a,'error':_0x5286dd instanceof Error?{'message':_0x5286dd[_0x3c7e81(0x21f)],'stack':_0x5286dd['stack']}:_0x5286dd});}[a67_0x1aa4f3(0x1f3)](_0x340466,_0x398a82,_0x3e3657){const _0x3e7f9b=a67_0x1aa4f3;this[_0x3e7f9b(0x202)](_0x3e7f9b(0x1f8),{'type':_0x3e7f9b(0x22c),'gateway':_0x340466,'headers':_0x3e3657,'data':_0x398a82});}['logWebhookProcessed'](_0x33f961,_0x4d0485,_0x48f5bb,_0x31c47d,_0x875fb3){const _0x292796=a67_0x1aa4f3;this[_0x292796(0x202)](_0x292796(0x20a),{'type':_0x292796(0x1eb),'gateway':_0x33f961,'paymentId':_0x4d0485,'oldStatus':_0x48f5bb,'newStatus':_0x31c47d,'originalData':_0x875fb3});}[a67_0x1aa4f3(0x21e)](_0x130922,_0xd6d801,_0xf7779f){const _0x1dc61e=a67_0x1aa4f3;this['writeLog'](_0x1dc61e(0x207),{'type':_0x1dc61e(0x1df),'gateway':_0x130922,'error':_0xd6d801 instanceof Error?{'message':_0xd6d801[_0x1dc61e(0x21f)],'stack':_0xd6d801[_0x1dc61e(0x21d)]}:_0xd6d801,'originalData':_0xf7779f});}['logCoinToPayStatus'](_0x444589){const _0x18c790=a67_0x1aa4f3;this[_0x18c790(0x202)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x444589});}[a67_0x1aa4f3(0x1ea)](_0x3b476b){const _0x146426=a67_0x1aa4f3;this['writeLog'](_0x146426(0x20b),{'type':_0x146426(0x221),..._0x3b476b});}[a67_0x1aa4f3(0x20f)](_0x345a0c,_0x1d5cf9,_0x533e58,_0x27096e,_0x26ba5c,_0x47445b){const _0x5d93b4=a67_0x1aa4f3;this['writeLog'](_0x5d93b4(0x229),{'type':_0x5d93b4(0x1fb),'shopId':_0x345a0c,'webhookUrl':_0x1d5cf9,'event':_0x533e58,'status':_0x27096e,'responseTime':_0x26ba5c,'payload':_0x47445b});}[a67_0x1aa4f3(0x1ef)](_0x2d6017,_0x1c2fe0,_0xf618be,_0xb11f44,_0x4bf13e){const _0x1448eb=a67_0x1aa4f3;this[_0x1448eb(0x202)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x2d6017,'webhookUrl':_0x1c2fe0,'event':_0xf618be,'error':_0xb11f44 instanceof Error?{'message':_0xb11f44[_0x1448eb(0x21f)],'stack':_0xb11f44['stack']}:_0xb11f44,'payload':_0x4bf13e});}[a67_0x1aa4f3(0x216)](_0x4bf669,_0x276fc9,_0x2fec0d,_0x5632a6,_0x4e0e75){const _0x2d50cc=a67_0x1aa4f3;this['writeLog'](_0x2d50cc(0x201),{'type':_0x2d50cc(0x1e5),'gateway':_0x4bf669,'paymentId':_0x276fc9,'shopId':_0x2fec0d,'amount':_0x5632a6,'currency':_0x4e0e75});}[a67_0x1aa4f3(0x22b)](_0x4ad76e,_0x1da7d5,_0x1d8c94,_0x74e95e,_0x3fbc69){const _0x259354=a67_0x1aa4f3;this[_0x259354(0x202)](_0x259354(0x226),{'type':_0x259354(0x205),'endpoint':_0x4ad76e,'method':_0x1da7d5,'userId':_0x1d8c94,'userRole':_0x74e95e,'requestData':_0x3fbc69});}[a67_0x1aa4f3(0x1fe)](){const _0x410395=a67_0x1aa4f3;try{const _0xfa939d=fs_1[_0x410395(0x1e0)]['readdirSync'](this['logsDir']),_0x2d753f=_0xfa939d['filter'](_0x510a95=>_0x510a95['endsWith'](_0x410395(0x204))),_0x11a38a=[...new Set(_0x2d753f[_0x410395(0x225)](_0x920bf2=>_0x920bf2[_0x410395(0x219)]('_')[0x0]))],_0x31bc1f=_0x2d753f[_0x410395(0x225)](_0x5b7ff2=>{const _0x16ecec=_0x410395,_0x2f4c4a=path_1['default'][_0x16ecec(0x217)](this[_0x16ecec(0x22e)],_0x5b7ff2),_0x2942b3=fs_1[_0x16ecec(0x1e0)]['statSync'](_0x2f4c4a),[_0x2236bc,_0x2070af]=_0x5b7ff2[_0x16ecec(0x208)](_0x16ecec(0x204),'')[_0x16ecec(0x219)]('_');return{'type':_0x2236bc,'date':_0x2070af,'size':_0x2942b3[_0x16ecec(0x1ff)]};})['sort']((_0x36ec1e,_0x5b303b)=>_0x5b303b['date']['localeCompare'](_0x36ec1e[_0x410395(0x210)]));return{'totalFiles':_0x2d753f[_0x410395(0x22a)],'logTypes':_0x11a38a,'latestLogs':_0x31bc1f[_0x410395(0x206)](0x0,0xa)};}catch(_0x584bf3){return console[_0x410395(0x21a)](_0x410395(0x212),_0x584bf3),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a67_0x1aa4f3(0x1ee)](_0x1480dc=0x1e){const _0x32bb87=a67_0x1aa4f3;try{const _0x561f94=fs_1[_0x32bb87(0x1e0)]['readdirSync'](this[_0x32bb87(0x22e)]),_0x12f36c=new Date();_0x12f36c['setDate'](_0x12f36c['getDate']()-_0x1480dc);let _0x8c98ac=0x0;_0x561f94[_0x32bb87(0x223)](_0x5b2c92=>{const _0x1f1c62=_0x32bb87;if(!_0x5b2c92[_0x1f1c62(0x1e4)](_0x1f1c62(0x204)))return;const _0x38c02f=path_1['default'][_0x1f1c62(0x217)](this[_0x1f1c62(0x22e)],_0x5b2c92),_0x523d9f=fs_1[_0x1f1c62(0x1e0)][_0x1f1c62(0x1fd)](_0x38c02f);_0x523d9f[_0x1f1c62(0x1f9)]<_0x12f36c&&(fs_1['default'][_0x1f1c62(0x20d)](_0x38c02f),_0x8c98ac++,console['log'](_0x1f1c62(0x230)+_0x5b2c92));}),console[_0x32bb87(0x1f4)](_0x32bb87(0x228)+_0x8c98ac+_0x32bb87(0x209)+_0x1480dc+_0x32bb87(0x1f6));}catch(_0x35ae7f){console[_0x32bb87(0x21a)]('Failed\x20to\x20clean\x20old\x20logs:',_0x35ae7f);}}}function a67_0x4b28(){const _0x1aa7a4=['ğŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','white_domain_responses','WEBHOOK_ERROR','default','REQUEST','__esModule','logWhiteDomainRequest','endsWith','PAYMENT_CREATED','7547152OvXYTd','getLogFileName','logWhiteDomainResponse','ERROR','logCoinToPayError','WEBHOOK_PROCESSED','white_domain_errors','__importDefault','cleanOldLogs','logShopWebhookError','Failed\x20to\x20write\x20','logs','path','logWebhookReceived','log','existsSync','\x20days)','1956NNstGZ','webhooks_received','mtime','loggerService','SHOP_WEBHOOK_SENT','7960169kkMbyF','statSync','getLogStats','size','6079530IMImcw','payments_created','writeLog','202008ankWaA','.log','API_CALL','slice','webhooks_errors','replace','\x20old\x20log\x20files\x20(older\x20than\x20','webhooks_processed','cointopay_errors','toISOString','unlinkSync','36ZGnHYQ','logShopWebhookSent','date','ensureLogsDirectory','Failed\x20to\x20get\x20log\x20stats:','28qfhmVg','1375316OBFiIO','7960cSyfbe','logPaymentCreated','join','LoggerService','split','error','defineProperty','1221174IRJfqQ','stack','logWebhookError','message','utf8','COINTOPAY_ERROR','cwd','forEach','stringify','map','api_calls','mkdirSync','ğŸ§¹\x20Cleaned\x20','shop_webhooks_sent','length','logApiCall','WEBHOOK_RECEIVED','RESPONSE','logsDir','\x20log:'];a67_0x4b28=function(){return _0x1aa7a4;};return a67_0x4b28();}exports[a67_0x1aa4f3(0x218)]=LoggerService,exports[a67_0x1aa4f3(0x1fa)]=new LoggerService();