'use strict';const a48_0x173140=a48_0x4410;(function(_0x4dff70,_0x420db2){const _0x4c28f5=a48_0x4410,_0x1a4f72=_0x4dff70();while(!![]){try{const _0x3b5efb=-parseInt(_0x4c28f5(0x152))/0x1*(parseInt(_0x4c28f5(0x188))/0x2)+parseInt(_0x4c28f5(0x16b))/0x3*(-parseInt(_0x4c28f5(0x178))/0x4)+parseInt(_0x4c28f5(0x18e))/0x5+parseInt(_0x4c28f5(0x147))/0x6+parseInt(_0x4c28f5(0x17b))/0x7+-parseInt(_0x4c28f5(0x17e))/0x8+-parseInt(_0x4c28f5(0x155))/0x9*(-parseInt(_0x4c28f5(0x158))/0xa);if(_0x3b5efb===_0x420db2)break;else _0x1a4f72['push'](_0x1a4f72['shift']());}catch(_0xb29f93){_0x1a4f72['push'](_0x1a4f72['shift']());}}}(a48_0x463f,0x7fc4b));function a48_0x463f(){const _0x4da889=['Failed\x20to\x20get\x20log\x20stats:','existsSync','size','sort','logs','writeLog','5877TTSTOR','.log','PAYMENT_CREATED','path','stack','logWebhookReceived','WEBHOOK_ERROR','ERROR','logApiCall','logShopWebhookSent','ensureLogsDirectory','logWhiteDomainError','cointopay_status_changes','1224DbIICt','default','log','6990865eePtzn','localeCompare','mkdirSync','5733000gcfsZy','SHOP_WEBHOOK_SENT','RESPONSE','white_domain_errors','getDate','🗑️\x20Deleted\x20old\x20log\x20file:\x20','length','endsWith','stringify','replace','2078746CtABRL','🧹\x20Cleaned\x20','statSync','join','logCoinToPayStatus','logWhiteDomainRequest','4030845KiwSBH','message','loggerService','map','logsDir','mtime','logCoinToPayError','__esModule','1387470aLprAT','filter','logWebhookProcessed','date','error','cleanOldLogs','white_domain_responses','forEach','white_domain_requests','logWhiteDomainResponse','\x20old\x20log\x20files\x20(older\x20than\x20','1nRZtZz','getLogFileName','readdirSync','9Luhkpd','toISOString','logWebhookError','8426820BXqIEv','\x20log:','unlinkSync','logPaymentCreated','api_calls','COINTOPAY_ERROR','cwd','shop_webhooks_errors','LoggerService','Failed\x20to\x20write\x20','\x20days)','split','WEBHOOK_PROCESSED'];a48_0x463f=function(){return _0x4da889;};return a48_0x463f();}var __importDefault=this&&this['__importDefault']||function(_0x5de4ef){const _0x3413ae=a48_0x4410;return _0x5de4ef&&_0x5de4ef[_0x3413ae(0x146)]?_0x5de4ef:{'default':_0x5de4ef};};function a48_0x4410(_0x5cff58,_0x524173){const _0x463f07=a48_0x463f();return a48_0x4410=function(_0x44102d,_0x15b6c3){_0x44102d=_0x44102d-0x146;let _0x41007e=_0x463f07[_0x44102d];return _0x41007e;},a48_0x4410(_0x5cff58,_0x524173);}Object['defineProperty'](exports,a48_0x173140(0x146),{'value':!![]}),exports[a48_0x173140(0x190)]=exports[a48_0x173140(0x160)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x173140(0x16e)));class LoggerService{constructor(){const _0x35881b=a48_0x173140;this[_0x35881b(0x192)]=path_1['default'][_0x35881b(0x18b)](process[_0x35881b(0x15e)](),_0x35881b(0x169)),this[_0x35881b(0x175)]();}[a48_0x173140(0x175)](){const _0x487d58=a48_0x173140;!fs_1[_0x487d58(0x179)][_0x487d58(0x166)](this['logsDir'])&&(fs_1[_0x487d58(0x179)][_0x487d58(0x17d)](this['logsDir'],{'recursive':!![]}),console[_0x487d58(0x17a)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x487d58(0x192)]));}[a48_0x173140(0x153)](_0x2cb31e){const _0x170e27=a48_0x173140,_0x23911f=new Date()[_0x170e27(0x156)]()[_0x170e27(0x163)]('T')[0x0];return path_1['default']['join'](this['logsDir'],_0x2cb31e+'_'+_0x23911f+_0x170e27(0x16c));}[a48_0x173140(0x16a)](_0x38e1ef,_0x27eae1){const _0x1a8c67=a48_0x173140;try{const _0x430193=new Date()[_0x1a8c67(0x156)](),_0x29cab6={'timestamp':_0x430193,..._0x27eae1},_0x193099=JSON[_0x1a8c67(0x186)](_0x29cab6)+'\x0a',_0x483701=this[_0x1a8c67(0x153)](_0x38e1ef);fs_1['default']['appendFileSync'](_0x483701,_0x193099,'utf8');}catch(_0x539c95){console[_0x1a8c67(0x14b)](_0x1a8c67(0x161)+_0x38e1ef+_0x1a8c67(0x159),_0x539c95);}}[a48_0x173140(0x18d)](_0x40cd41,_0x126871,_0x4ce510,_0x4fb1b1){const _0x161dda=a48_0x173140;this['writeLog'](_0x161dda(0x14f),{'type':'REQUEST','gateway':_0x40cd41,'endpoint':_0x126871,'method':_0x4ce510,'data':_0x4fb1b1});}[a48_0x173140(0x150)](_0x5eac75,_0x4f0d7e,_0x2a21c5,_0x39459a,_0x4bf71b){const _0x187fae=a48_0x173140;this[_0x187fae(0x16a)](_0x187fae(0x14d),{'type':_0x187fae(0x180),'gateway':_0x5eac75,'endpoint':_0x4f0d7e,'status':_0x2a21c5,'responseTime':_0x4bf71b,'data':_0x39459a});}[a48_0x173140(0x176)](_0x35fd68,_0x50d5a4,_0x8ca36c){const _0x450c9f=a48_0x173140;this[_0x450c9f(0x16a)](_0x450c9f(0x181),{'type':_0x450c9f(0x172),'gateway':_0x35fd68,'endpoint':_0x50d5a4,'error':_0x8ca36c instanceof Error?{'message':_0x8ca36c[_0x450c9f(0x18f)],'stack':_0x8ca36c[_0x450c9f(0x16f)]}:_0x8ca36c});}[a48_0x173140(0x170)](_0x39a1e2,_0x59f9d2,_0x285a8b){const _0x132deb=a48_0x173140;this[_0x132deb(0x16a)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x39a1e2,'headers':_0x285a8b,'data':_0x59f9d2});}[a48_0x173140(0x149)](_0x5ae5a2,_0x4e8fa0,_0x4f80e7,_0x5600b5,_0x224180){const _0x10b0c4=a48_0x173140;this[_0x10b0c4(0x16a)]('webhooks_processed',{'type':_0x10b0c4(0x164),'gateway':_0x5ae5a2,'paymentId':_0x4e8fa0,'oldStatus':_0x4f80e7,'newStatus':_0x5600b5,'originalData':_0x224180});}[a48_0x173140(0x157)](_0x4fa893,_0x7a9da5,_0x4592ca){const _0x128adc=a48_0x173140;this[_0x128adc(0x16a)]('webhooks_errors',{'type':_0x128adc(0x171),'gateway':_0x4fa893,'error':_0x7a9da5 instanceof Error?{'message':_0x7a9da5[_0x128adc(0x18f)],'stack':_0x7a9da5[_0x128adc(0x16f)]}:_0x7a9da5,'originalData':_0x4592ca});}[a48_0x173140(0x18c)](_0x5d1c19){const _0x1b5075=a48_0x173140;this[_0x1b5075(0x16a)](_0x1b5075(0x177),{'type':'COINTOPAY_STATUS_CHANGE',..._0x5d1c19});}[a48_0x173140(0x194)](_0x5813f8){const _0x1a25cc=a48_0x173140;this[_0x1a25cc(0x16a)]('cointopay_errors',{'type':_0x1a25cc(0x15d),..._0x5813f8});}[a48_0x173140(0x174)](_0x1c4871,_0x150151,_0x284c71,_0x222507,_0x37fbf3,_0x502a99){const _0x3a31d1=a48_0x173140;this[_0x3a31d1(0x16a)]('shop_webhooks_sent',{'type':_0x3a31d1(0x17f),'shopId':_0x1c4871,'webhookUrl':_0x150151,'event':_0x284c71,'status':_0x222507,'responseTime':_0x37fbf3,'payload':_0x502a99});}['logShopWebhookError'](_0xfbcd98,_0x32c7f9,_0x194c6e,_0xe62124,_0x21d0c3){const _0xe56abf=a48_0x173140;this['writeLog'](_0xe56abf(0x15f),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0xfbcd98,'webhookUrl':_0x32c7f9,'event':_0x194c6e,'error':_0xe62124 instanceof Error?{'message':_0xe62124[_0xe56abf(0x18f)],'stack':_0xe62124[_0xe56abf(0x16f)]}:_0xe62124,'payload':_0x21d0c3});}[a48_0x173140(0x15b)](_0x106b5e,_0xddbe57,_0xe90cd9,_0x4a2fb7,_0x2192c4){const _0x55d27b=a48_0x173140;this[_0x55d27b(0x16a)]('payments_created',{'type':_0x55d27b(0x16d),'gateway':_0x106b5e,'paymentId':_0xddbe57,'shopId':_0xe90cd9,'amount':_0x4a2fb7,'currency':_0x2192c4});}[a48_0x173140(0x173)](_0x5658fe,_0x4c5980,_0x4b568e,_0x474bb5,_0x301c46){const _0x22861=a48_0x173140;this['writeLog'](_0x22861(0x15c),{'type':'API_CALL','endpoint':_0x5658fe,'method':_0x4c5980,'userId':_0x4b568e,'userRole':_0x474bb5,'requestData':_0x301c46});}['getLogStats'](){const _0x3a4e5c=a48_0x173140;try{const _0x3c63de=fs_1[_0x3a4e5c(0x179)][_0x3a4e5c(0x154)](this[_0x3a4e5c(0x192)]),_0xe33228=_0x3c63de[_0x3a4e5c(0x148)](_0x5aa78e=>_0x5aa78e[_0x3a4e5c(0x185)]('.log')),_0x5a0294=[...new Set(_0xe33228[_0x3a4e5c(0x191)](_0x258a49=>_0x258a49[_0x3a4e5c(0x163)]('_')[0x0]))],_0x2f7012=_0xe33228[_0x3a4e5c(0x191)](_0x1c7fdd=>{const _0x4eeae8=_0x3a4e5c,_0x43833f=path_1[_0x4eeae8(0x179)][_0x4eeae8(0x18b)](this['logsDir'],_0x1c7fdd),_0x4eb6a4=fs_1[_0x4eeae8(0x179)][_0x4eeae8(0x18a)](_0x43833f),[_0x3daf1b,_0x2d6ab9]=_0x1c7fdd[_0x4eeae8(0x187)](_0x4eeae8(0x16c),'')['split']('_');return{'type':_0x3daf1b,'date':_0x2d6ab9,'size':_0x4eb6a4[_0x4eeae8(0x167)]};})[_0x3a4e5c(0x168)]((_0x4fc3da,_0x5cfafb)=>_0x5cfafb[_0x3a4e5c(0x14a)][_0x3a4e5c(0x17c)](_0x4fc3da['date']));return{'totalFiles':_0xe33228[_0x3a4e5c(0x184)],'logTypes':_0x5a0294,'latestLogs':_0x2f7012['slice'](0x0,0xa)};}catch(_0x53d6cb){return console[_0x3a4e5c(0x14b)](_0x3a4e5c(0x165),_0x53d6cb),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x173140(0x14c)](_0x59396e=0x1e){const _0x4f07b8=a48_0x173140;try{const _0x107475=fs_1[_0x4f07b8(0x179)][_0x4f07b8(0x154)](this['logsDir']),_0x593765=new Date();_0x593765['setDate'](_0x593765[_0x4f07b8(0x182)]()-_0x59396e);let _0x3a4c87=0x0;_0x107475[_0x4f07b8(0x14e)](_0x2f4ca9=>{const _0x47322f=_0x4f07b8;if(!_0x2f4ca9['endsWith'](_0x47322f(0x16c)))return;const _0x2ae830=path_1['default'][_0x47322f(0x18b)](this[_0x47322f(0x192)],_0x2f4ca9),_0x2ba131=fs_1[_0x47322f(0x179)][_0x47322f(0x18a)](_0x2ae830);_0x2ba131[_0x47322f(0x193)]<_0x593765&&(fs_1['default'][_0x47322f(0x15a)](_0x2ae830),_0x3a4c87++,console[_0x47322f(0x17a)](_0x47322f(0x183)+_0x2f4ca9));}),console['log'](_0x4f07b8(0x189)+_0x3a4c87+_0x4f07b8(0x151)+_0x59396e+_0x4f07b8(0x162));}catch(_0x1b3006){console[_0x4f07b8(0x14b)]('Failed\x20to\x20clean\x20old\x20logs:',_0x1b3006);}}}exports[a48_0x173140(0x160)]=LoggerService,exports['loggerService']=new LoggerService();