'use strict';function a53_0x1811(){const _0x30c59f=['252354yPDskf','WEBHOOK_PROCESSED','\x20log:','error','utf8','replace','logWhiteDomainRequest','white_domain_responses','__esModule','4RNyPQR','Failed\x20to\x20clean\x20old\x20logs:','log','COINTOPAY_ERROR','shop_webhooks_sent','ERROR','mtime','forEach','LoggerService','12teomzp','ensureLogsDirectory','writeLog','join','endsWith','size','2497098HaRIOe','logCoinToPayError','1131851yLwAtV','loggerService','shop_webhooks_errors','localeCompare','statSync','.log','logWebhookReceived','payments_created','setDate','COINTOPAY_STATUS_CHANGE','toISOString','split','white_domain_requests','772715sjCWla','16uAFKwN','appendFileSync','SHOP_WEBHOOK_ERROR','RESPONSE','📁\x20Created\x20logs\x20directory:\x20','webhooks_errors','logApiCall','logWhiteDomainError','19368173PBxiPe','932840gHKlRk','getLogFileName','getDate','logWhiteDomainResponse','path','existsSync','292364HUlfSR','🗑️\x20Deleted\x20old\x20log\x20file:\x20','WEBHOOK_ERROR','map','mkdirSync','36kItPJb','API_CALL','logWebhookError','stack','message','PAYMENT_CREATED','\x20old\x20log\x20files\x20(older\x20than\x20','sort','8ApOxpb','cleanOldLogs','Failed\x20to\x20write\x20','logShopWebhookError','logsDir','REQUEST','🧹\x20Cleaned\x20','default','readdirSync','stringify','__importDefault','filter','getLogStats','white_domain_errors','logs','length','date','unlinkSync'];a53_0x1811=function(){return _0x30c59f;};return a53_0x1811();}const a53_0x13bce2=a53_0x559a;function a53_0x559a(_0x28d9db,_0x4192c9){const _0x18112d=a53_0x1811();return a53_0x559a=function(_0x559a4d,_0xa59b07){_0x559a4d=_0x559a4d-0x1a9;let _0x7c15e=_0x18112d[_0x559a4d];return _0x7c15e;},a53_0x559a(_0x28d9db,_0x4192c9);}(function(_0x135cad,_0x519892){const _0x2a8902=a53_0x559a,_0x5aa808=_0x135cad();while(!![]){try{const _0xbd0a6=-parseInt(_0x2a8902(0x1f6))/0x1+-parseInt(_0x2a8902(0x1e7))/0x2*(parseInt(_0x2a8902(0x1bf))/0x3)+-parseInt(_0x2a8902(0x1c8))/0x4*(parseInt(_0x2a8902(0x1e6))/0x5)+-parseInt(_0x2a8902(0x1d7))/0x6+-parseInt(_0x2a8902(0x1d9))/0x7*(parseInt(_0x2a8902(0x1ad))/0x8)+parseInt(_0x2a8902(0x1fb))/0x9*(parseInt(_0x2a8902(0x1f0))/0xa)+parseInt(_0x2a8902(0x1ef))/0xb*(parseInt(_0x2a8902(0x1d1))/0xc);if(_0xbd0a6===_0x519892)break;else _0x5aa808['push'](_0x5aa808['shift']());}catch(_0x55a0d2){_0x5aa808['push'](_0x5aa808['shift']());}}}(a53_0x1811,0x6a7b8));var __importDefault=this&&this[a53_0x13bce2(0x1b7)]||function(_0x338705){const _0x5f5dca=a53_0x13bce2;return _0x338705&&_0x338705[_0x5f5dca(0x1c7)]?_0x338705:{'default':_0x338705};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a53_0x13bce2(0x1da)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x13bce2(0x1f4)));class LoggerService{constructor(){const _0x41752a=a53_0x13bce2;this[_0x41752a(0x1b1)]=path_1[_0x41752a(0x1b4)]['join'](process['cwd'](),_0x41752a(0x1bb)),this['ensureLogsDirectory']();}[a53_0x13bce2(0x1d2)](){const _0x205649=a53_0x13bce2;!fs_1[_0x205649(0x1b4)][_0x205649(0x1f5)](this[_0x205649(0x1b1)])&&(fs_1[_0x205649(0x1b4)][_0x205649(0x1fa)](this['logsDir'],{'recursive':!![]}),console['log'](_0x205649(0x1eb)+this[_0x205649(0x1b1)]));}[a53_0x13bce2(0x1f1)](_0x4dda33){const _0xdaed3a=a53_0x13bce2,_0x5d4dfa=new Date()[_0xdaed3a(0x1e3)]()[_0xdaed3a(0x1e4)]('T')[0x0];return path_1['default'][_0xdaed3a(0x1d4)](this['logsDir'],_0x4dda33+'_'+_0x5d4dfa+'.log');}[a53_0x13bce2(0x1d3)](_0x4c2bed,_0x37b55c){const _0x453d85=a53_0x13bce2;try{const _0x38eb04=new Date()[_0x453d85(0x1e3)](),_0x197370={'timestamp':_0x38eb04,..._0x37b55c},_0x57ee40=JSON[_0x453d85(0x1b6)](_0x197370)+'\x0a',_0x3047da=this['getLogFileName'](_0x4c2bed);fs_1[_0x453d85(0x1b4)][_0x453d85(0x1e8)](_0x3047da,_0x57ee40,_0x453d85(0x1c3));}catch(_0x3dfeba){console[_0x453d85(0x1c2)](_0x453d85(0x1af)+_0x4c2bed+_0x453d85(0x1c1),_0x3dfeba);}}[a53_0x13bce2(0x1c5)](_0x554789,_0x4393e7,_0x32a146,_0x29242e){const _0x473f3f=a53_0x13bce2;this[_0x473f3f(0x1d3)](_0x473f3f(0x1e5),{'type':_0x473f3f(0x1b2),'gateway':_0x554789,'endpoint':_0x4393e7,'method':_0x32a146,'data':_0x29242e});}[a53_0x13bce2(0x1f3)](_0xc713ed,_0x3db786,_0xf2966d,_0x2c11b6,_0x10118a){const _0x3ea73a=a53_0x13bce2;this[_0x3ea73a(0x1d3)](_0x3ea73a(0x1c6),{'type':_0x3ea73a(0x1ea),'gateway':_0xc713ed,'endpoint':_0x3db786,'status':_0xf2966d,'responseTime':_0x10118a,'data':_0x2c11b6});}[a53_0x13bce2(0x1ee)](_0x320e6c,_0x59e1c7,_0xfc69b8){const _0x1e22ec=a53_0x13bce2;this[_0x1e22ec(0x1d3)](_0x1e22ec(0x1ba),{'type':_0x1e22ec(0x1cd),'gateway':_0x320e6c,'endpoint':_0x59e1c7,'error':_0xfc69b8 instanceof Error?{'message':_0xfc69b8[_0x1e22ec(0x1a9)],'stack':_0xfc69b8[_0x1e22ec(0x1fe)]}:_0xfc69b8});}[a53_0x13bce2(0x1df)](_0x4d41c5,_0x5cb74c,_0x45d0f7){const _0xab0a44=a53_0x13bce2;this[_0xab0a44(0x1d3)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x4d41c5,'headers':_0x45d0f7,'data':_0x5cb74c});}['logWebhookProcessed'](_0x11f32e,_0x263213,_0x42d5ef,_0x9f14ab,_0x1cf41b){const _0x763290=a53_0x13bce2;this[_0x763290(0x1d3)]('webhooks_processed',{'type':_0x763290(0x1c0),'gateway':_0x11f32e,'paymentId':_0x263213,'oldStatus':_0x42d5ef,'newStatus':_0x9f14ab,'originalData':_0x1cf41b});}[a53_0x13bce2(0x1fd)](_0xdb1870,_0x1912de,_0x63f913){const _0x8fab4=a53_0x13bce2;this[_0x8fab4(0x1d3)](_0x8fab4(0x1ec),{'type':_0x8fab4(0x1f8),'gateway':_0xdb1870,'error':_0x1912de instanceof Error?{'message':_0x1912de[_0x8fab4(0x1a9)],'stack':_0x1912de[_0x8fab4(0x1fe)]}:_0x1912de,'originalData':_0x63f913});}['logCoinToPayStatus'](_0x59d8de){const _0x2955c3=a53_0x13bce2;this[_0x2955c3(0x1d3)]('cointopay_status_changes',{'type':_0x2955c3(0x1e2),..._0x59d8de});}[a53_0x13bce2(0x1d8)](_0x428145){const _0x1e3394=a53_0x13bce2;this[_0x1e3394(0x1d3)]('cointopay_errors',{'type':_0x1e3394(0x1cb),..._0x428145});}['logShopWebhookSent'](_0x23f308,_0x4245ea,_0x1e789c,_0x1ad75d,_0x45d9ca,_0x34a0cd){const _0x40844b=a53_0x13bce2;this[_0x40844b(0x1d3)](_0x40844b(0x1cc),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x23f308,'webhookUrl':_0x4245ea,'event':_0x1e789c,'status':_0x1ad75d,'responseTime':_0x45d9ca,'payload':_0x34a0cd});}[a53_0x13bce2(0x1b0)](_0x396604,_0x1b5916,_0x3b94a6,_0x3236b6,_0x45018b){const _0x221019=a53_0x13bce2;this[_0x221019(0x1d3)](_0x221019(0x1db),{'type':_0x221019(0x1e9),'shopId':_0x396604,'webhookUrl':_0x1b5916,'event':_0x3b94a6,'error':_0x3236b6 instanceof Error?{'message':_0x3236b6[_0x221019(0x1a9)],'stack':_0x3236b6[_0x221019(0x1fe)]}:_0x3236b6,'payload':_0x45018b});}['logPaymentCreated'](_0x4a286f,_0x21bd82,_0x5add0f,_0x4ad8a7,_0x208499){const _0x221173=a53_0x13bce2;this[_0x221173(0x1d3)](_0x221173(0x1e0),{'type':_0x221173(0x1aa),'gateway':_0x4a286f,'paymentId':_0x21bd82,'shopId':_0x5add0f,'amount':_0x4ad8a7,'currency':_0x208499});}[a53_0x13bce2(0x1ed)](_0x5d2ce4,_0x1d8d33,_0x4058d7,_0x6752a1,_0xbd9859){const _0x46a6e9=a53_0x13bce2;this[_0x46a6e9(0x1d3)]('api_calls',{'type':_0x46a6e9(0x1fc),'endpoint':_0x5d2ce4,'method':_0x1d8d33,'userId':_0x4058d7,'userRole':_0x6752a1,'requestData':_0xbd9859});}[a53_0x13bce2(0x1b9)](){const _0x5a007e=a53_0x13bce2;try{const _0x1cacde=fs_1[_0x5a007e(0x1b4)][_0x5a007e(0x1b5)](this[_0x5a007e(0x1b1)]),_0x50e1c1=_0x1cacde[_0x5a007e(0x1b8)](_0x44f2fe=>_0x44f2fe[_0x5a007e(0x1d5)](_0x5a007e(0x1de))),_0x19632d=[...new Set(_0x50e1c1[_0x5a007e(0x1f9)](_0x3cb89f=>_0x3cb89f[_0x5a007e(0x1e4)]('_')[0x0]))],_0x40766a=_0x50e1c1['map'](_0x3e375b=>{const _0xf46ece=_0x5a007e,_0x3b9d55=path_1[_0xf46ece(0x1b4)][_0xf46ece(0x1d4)](this[_0xf46ece(0x1b1)],_0x3e375b),_0x3600ff=fs_1[_0xf46ece(0x1b4)][_0xf46ece(0x1dd)](_0x3b9d55),[_0x2ed89b,_0x4fd3ae]=_0x3e375b[_0xf46ece(0x1c4)]('.log','')['split']('_');return{'type':_0x2ed89b,'date':_0x4fd3ae,'size':_0x3600ff[_0xf46ece(0x1d6)]};})[_0x5a007e(0x1ac)]((_0x475828,_0x4c9868)=>_0x4c9868[_0x5a007e(0x1bd)][_0x5a007e(0x1dc)](_0x475828[_0x5a007e(0x1bd)]));return{'totalFiles':_0x50e1c1[_0x5a007e(0x1bc)],'logTypes':_0x19632d,'latestLogs':_0x40766a['slice'](0x0,0xa)};}catch(_0x52ad87){return console[_0x5a007e(0x1c2)]('Failed\x20to\x20get\x20log\x20stats:',_0x52ad87),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x13bce2(0x1ae)](_0x25b41c=0x1e){const _0xba230=a53_0x13bce2;try{const _0x19c281=fs_1['default'][_0xba230(0x1b5)](this[_0xba230(0x1b1)]),_0x595c68=new Date();_0x595c68[_0xba230(0x1e1)](_0x595c68[_0xba230(0x1f2)]()-_0x25b41c);let _0x3d0152=0x0;_0x19c281[_0xba230(0x1cf)](_0x3148f3=>{const _0x16d58c=_0xba230;if(!_0x3148f3[_0x16d58c(0x1d5)]('.log'))return;const _0x728cca=path_1['default'][_0x16d58c(0x1d4)](this[_0x16d58c(0x1b1)],_0x3148f3),_0x28d479=fs_1[_0x16d58c(0x1b4)][_0x16d58c(0x1dd)](_0x728cca);_0x28d479[_0x16d58c(0x1ce)]<_0x595c68&&(fs_1[_0x16d58c(0x1b4)][_0x16d58c(0x1be)](_0x728cca),_0x3d0152++,console[_0x16d58c(0x1ca)](_0x16d58c(0x1f7)+_0x3148f3));}),console[_0xba230(0x1ca)](_0xba230(0x1b3)+_0x3d0152+_0xba230(0x1ab)+_0x25b41c+'\x20days)');}catch(_0x3b28cc){console[_0xba230(0x1c2)](_0xba230(0x1c9),_0x3b28cc);}}}exports[a53_0x13bce2(0x1d0)]=LoggerService,exports['loggerService']=new LoggerService();