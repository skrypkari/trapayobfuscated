'use strict';const a48_0x31ae0e=a48_0x36a7;(function(_0x115977,_0x5a83a4){const _0xdf2cba=a48_0x36a7,_0x1fabc0=_0x115977();while(!![]){try{const _0x1705fb=-parseInt(_0xdf2cba(0x7b))/0x1*(-parseInt(_0xdf2cba(0x88))/0x2)+parseInt(_0xdf2cba(0xa9))/0x3*(-parseInt(_0xdf2cba(0x7d))/0x4)+-parseInt(_0xdf2cba(0x73))/0x5+parseInt(_0xdf2cba(0x90))/0x6+parseInt(_0xdf2cba(0x80))/0x7*(-parseInt(_0xdf2cba(0x70))/0x8)+parseInt(_0xdf2cba(0x79))/0x9*(parseInt(_0xdf2cba(0xa8))/0xa)+-parseInt(_0xdf2cba(0x8c))/0xb*(-parseInt(_0xdf2cba(0xa4))/0xc);if(_0x1705fb===_0x5a83a4)break;else _0x1fabc0['push'](_0x1fabc0['shift']());}catch(_0x5e6280){_0x1fabc0['push'](_0x1fabc0['shift']());}}}(a48_0xc253,0xb8fc1));function a48_0x36a7(_0x23c5d3,_0x50f764){const _0xc2537d=a48_0xc253();return a48_0x36a7=function(_0x36a769,_0x4cf344){_0x36a769=_0x36a769-0x67;let _0xd6f01d=_0xc2537d[_0x36a769];return _0xd6f01d;},a48_0x36a7(_0x23c5d3,_0x50f764);}var __importDefault=this&&this[a48_0x31ae0e(0xb4)]||function(_0x2a0477){const _0x228f77=a48_0x31ae0e;return _0x2a0477&&_0x2a0477[_0x228f77(0x81)]?_0x2a0477:{'default':_0x2a0477};};Object[a48_0x31ae0e(0x95)](exports,a48_0x31ae0e(0x81),{'value':!![]}),exports[a48_0x31ae0e(0x72)]=exports[a48_0x31ae0e(0x9e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));function a48_0xc253(){const _0x49da3d=['PAYMENT_CREATED','16IFwPRM','setDate','loggerService','1345085MqDvxb','payments_created','logs','cwd','WEBHOOK_PROCESSED','stringify','4338zAkzAL','🗑️\x20Deleted\x20old\x20log\x20file:\x20','110164sJptlC','mtime','5362684BcSkQy','REQUEST','writeLog','729841MrwqjC','__esModule','join','WEBHOOK_ERROR','toISOString','RESPONSE','Failed\x20to\x20get\x20log\x20stats:','logShopWebhookSent','8JnEgzT','endsWith','replace','split','441584mxcNmI','📁\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20write\x20','logWhiteDomainError','4418070hPLVNa','length','\x20old\x20log\x20files\x20(older\x20than\x20','logWebhookError','map','defineProperty','statSync','cointopay_errors','.log','logPaymentCreated','logWhiteDomainResponse','message','logCoinToPayError','logsDir','LoggerService','getLogFileName','logWebhookProcessed','filter','log','\x20log:','348tEEUDF','SHOP_WEBHOOK_SENT','api_calls','unlinkSync','4870TzHkyp','3htHBDf','size','stack','mkdirSync','readdirSync','logCoinToPayStatus','sort','white_domain_responses','getDate','cointopay_status_changes','cleanOldLogs','__importDefault','logApiCall','WEBHOOK_RECEIVED','existsSync','white_domain_errors','default','shop_webhooks_errors','API_CALL','error','COINTOPAY_ERROR','forEach','ensureLogsDirectory','date','webhooks_received'];a48_0xc253=function(){return _0x49da3d;};return a48_0xc253();}class LoggerService{constructor(){const _0x418b31=a48_0x31ae0e;this[_0x418b31(0x9d)]=path_1[_0x418b31(0xb9)]['join'](process[_0x418b31(0x76)](),_0x418b31(0x75)),this['ensureLogsDirectory']();}[a48_0x31ae0e(0x6c)](){const _0x117729=a48_0x31ae0e;!fs_1[_0x117729(0xb9)][_0x117729(0xb7)](this['logsDir'])&&(fs_1['default'][_0x117729(0xac)](this[_0x117729(0x9d)],{'recursive':!![]}),console[_0x117729(0xa2)](_0x117729(0x8d)+this[_0x117729(0x9d)]));}[a48_0x31ae0e(0x9f)](_0x46dc39){const _0x2f7ecf=a48_0x31ae0e,_0x42ec5a=new Date()[_0x2f7ecf(0x84)]()[_0x2f7ecf(0x8b)]('T')[0x0];return path_1[_0x2f7ecf(0xb9)][_0x2f7ecf(0x82)](this['logsDir'],_0x46dc39+'_'+_0x42ec5a+_0x2f7ecf(0x98));}[a48_0x31ae0e(0x7f)](_0x16ed7a,_0x2a3217){const _0x17e4e7=a48_0x31ae0e;try{const _0x1bd0a4=new Date()[_0x17e4e7(0x84)](),_0x197afd={'timestamp':_0x1bd0a4,..._0x2a3217},_0x23ff2b=JSON[_0x17e4e7(0x78)](_0x197afd)+'\x0a',_0x566379=this['getLogFileName'](_0x16ed7a);fs_1['default']['appendFileSync'](_0x566379,_0x23ff2b,'utf8');}catch(_0x528bfd){console[_0x17e4e7(0x69)](_0x17e4e7(0x8e)+_0x16ed7a+_0x17e4e7(0xa3),_0x528bfd);}}['logWhiteDomainRequest'](_0x2f6a72,_0x1ee6c9,_0x2cdbaa,_0x44a595){const _0x4a7cde=a48_0x31ae0e;this[_0x4a7cde(0x7f)]('white_domain_requests',{'type':_0x4a7cde(0x7e),'gateway':_0x2f6a72,'endpoint':_0x1ee6c9,'method':_0x2cdbaa,'data':_0x44a595});}[a48_0x31ae0e(0x9a)](_0x53170f,_0x57e676,_0x19f4fa,_0x524408,_0x3b83a2){const _0x5ba894=a48_0x31ae0e;this[_0x5ba894(0x7f)](_0x5ba894(0xb0),{'type':_0x5ba894(0x85),'gateway':_0x53170f,'endpoint':_0x57e676,'status':_0x19f4fa,'responseTime':_0x3b83a2,'data':_0x524408});}[a48_0x31ae0e(0x8f)](_0xce84f0,_0x393fb9,_0x383626){const _0x3388d2=a48_0x31ae0e;this[_0x3388d2(0x7f)](_0x3388d2(0xb8),{'type':'ERROR','gateway':_0xce84f0,'endpoint':_0x393fb9,'error':_0x383626 instanceof Error?{'message':_0x383626['message'],'stack':_0x383626[_0x3388d2(0xab)]}:_0x383626});}['logWebhookReceived'](_0x1cc305,_0x138d3b,_0xdd5f3d){const _0x4ad063=a48_0x31ae0e;this[_0x4ad063(0x7f)](_0x4ad063(0x6e),{'type':_0x4ad063(0xb6),'gateway':_0x1cc305,'headers':_0xdd5f3d,'data':_0x138d3b});}[a48_0x31ae0e(0xa0)](_0x2abcfe,_0x170425,_0x26dea6,_0x138e49,_0x3a75ac){const _0x1e99ff=a48_0x31ae0e;this['writeLog']('webhooks_processed',{'type':_0x1e99ff(0x77),'gateway':_0x2abcfe,'paymentId':_0x170425,'oldStatus':_0x26dea6,'newStatus':_0x138e49,'originalData':_0x3a75ac});}[a48_0x31ae0e(0x93)](_0x23c083,_0x2019f8,_0x400bc5){const _0x360e80=a48_0x31ae0e;this[_0x360e80(0x7f)]('webhooks_errors',{'type':_0x360e80(0x83),'gateway':_0x23c083,'error':_0x2019f8 instanceof Error?{'message':_0x2019f8[_0x360e80(0x9b)],'stack':_0x2019f8['stack']}:_0x2019f8,'originalData':_0x400bc5});}[a48_0x31ae0e(0xae)](_0x4a7fd5){const _0x4652d0=a48_0x31ae0e;this['writeLog'](_0x4652d0(0xb2),{'type':'COINTOPAY_STATUS_CHANGE',..._0x4a7fd5});}[a48_0x31ae0e(0x9c)](_0x37788a){const _0x3b6af9=a48_0x31ae0e;this[_0x3b6af9(0x7f)](_0x3b6af9(0x97),{'type':_0x3b6af9(0x6a),..._0x37788a});}[a48_0x31ae0e(0x87)](_0x30d859,_0x265d7d,_0x532430,_0x37a2f0,_0x4410ee,_0x19b8d8){const _0x301ea1=a48_0x31ae0e;this[_0x301ea1(0x7f)]('shop_webhooks_sent',{'type':_0x301ea1(0xa5),'shopId':_0x30d859,'webhookUrl':_0x265d7d,'event':_0x532430,'status':_0x37a2f0,'responseTime':_0x4410ee,'payload':_0x19b8d8});}['logShopWebhookError'](_0x374d48,_0x1cb80b,_0x44d994,_0x10b669,_0x5be7f7){const _0x522d9e=a48_0x31ae0e;this['writeLog'](_0x522d9e(0x67),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x374d48,'webhookUrl':_0x1cb80b,'event':_0x44d994,'error':_0x10b669 instanceof Error?{'message':_0x10b669[_0x522d9e(0x9b)],'stack':_0x10b669['stack']}:_0x10b669,'payload':_0x5be7f7});}[a48_0x31ae0e(0x99)](_0x4a7741,_0x53c6ba,_0x5489a6,_0x47852c,_0x5c5f86){const _0x559955=a48_0x31ae0e;this[_0x559955(0x7f)](_0x559955(0x74),{'type':_0x559955(0x6f),'gateway':_0x4a7741,'paymentId':_0x53c6ba,'shopId':_0x5489a6,'amount':_0x47852c,'currency':_0x5c5f86});}[a48_0x31ae0e(0xb5)](_0x24175a,_0x2709b9,_0x20f5c2,_0x67b878,_0x6dece0){const _0x1fa665=a48_0x31ae0e;this['writeLog'](_0x1fa665(0xa6),{'type':_0x1fa665(0x68),'endpoint':_0x24175a,'method':_0x2709b9,'userId':_0x20f5c2,'userRole':_0x67b878,'requestData':_0x6dece0});}['getLogStats'](){const _0x24e20f=a48_0x31ae0e;try{const _0x46037e=fs_1[_0x24e20f(0xb9)][_0x24e20f(0xad)](this['logsDir']),_0x3b05e9=_0x46037e[_0x24e20f(0xa1)](_0x8ecbe2=>_0x8ecbe2['endsWith'](_0x24e20f(0x98))),_0x34d7c6=[...new Set(_0x3b05e9[_0x24e20f(0x94)](_0x1ac09e=>_0x1ac09e[_0x24e20f(0x8b)]('_')[0x0]))],_0x183ac2=_0x3b05e9[_0x24e20f(0x94)](_0x595319=>{const _0x231131=_0x24e20f,_0x53d30a=path_1[_0x231131(0xb9)]['join'](this['logsDir'],_0x595319),_0x1af171=fs_1[_0x231131(0xb9)][_0x231131(0x96)](_0x53d30a),[_0x390640,_0x34d91f]=_0x595319[_0x231131(0x8a)](_0x231131(0x98),'')[_0x231131(0x8b)]('_');return{'type':_0x390640,'date':_0x34d91f,'size':_0x1af171[_0x231131(0xaa)]};})[_0x24e20f(0xaf)]((_0x3e8774,_0x19ebed)=>_0x19ebed['date']['localeCompare'](_0x3e8774[_0x24e20f(0x6d)]));return{'totalFiles':_0x3b05e9[_0x24e20f(0x91)],'logTypes':_0x34d7c6,'latestLogs':_0x183ac2['slice'](0x0,0xa)};}catch(_0x268d6a){return console[_0x24e20f(0x69)](_0x24e20f(0x86),_0x268d6a),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x31ae0e(0xb3)](_0x34bcc2=0x1e){const _0x3dadfd=a48_0x31ae0e;try{const _0x3da8c1=fs_1[_0x3dadfd(0xb9)][_0x3dadfd(0xad)](this[_0x3dadfd(0x9d)]),_0x4360d5=new Date();_0x4360d5[_0x3dadfd(0x71)](_0x4360d5[_0x3dadfd(0xb1)]()-_0x34bcc2);let _0x1908c6=0x0;_0x3da8c1[_0x3dadfd(0x6b)](_0x2ee77b=>{const _0x4ac1d2=_0x3dadfd;if(!_0x2ee77b[_0x4ac1d2(0x89)](_0x4ac1d2(0x98)))return;const _0x27ed51=path_1[_0x4ac1d2(0xb9)][_0x4ac1d2(0x82)](this[_0x4ac1d2(0x9d)],_0x2ee77b),_0x57bc3d=fs_1[_0x4ac1d2(0xb9)][_0x4ac1d2(0x96)](_0x27ed51);_0x57bc3d[_0x4ac1d2(0x7c)]<_0x4360d5&&(fs_1[_0x4ac1d2(0xb9)][_0x4ac1d2(0xa7)](_0x27ed51),_0x1908c6++,console[_0x4ac1d2(0xa2)](_0x4ac1d2(0x7a)+_0x2ee77b));}),console[_0x3dadfd(0xa2)]('🧹\x20Cleaned\x20'+_0x1908c6+_0x3dadfd(0x92)+_0x34bcc2+'\x20days)');}catch(_0x37ee87){console[_0x3dadfd(0x69)]('Failed\x20to\x20clean\x20old\x20logs:',_0x37ee87);}}}exports[a48_0x31ae0e(0x9e)]=LoggerService,exports[a48_0x31ae0e(0x72)]=new LoggerService();