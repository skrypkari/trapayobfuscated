'use strict';const a73_0x4781ed=a73_0x1a59;(function(_0x579c29,_0x50aed2){const _0x31bb80=a73_0x1a59,_0x5d5cb7=_0x579c29();while(!![]){try{const _0x4216d1=parseInt(_0x31bb80(0x177))/0x1*(parseInt(_0x31bb80(0x184))/0x2)+-parseInt(_0x31bb80(0x182))/0x3+-parseInt(_0x31bb80(0x13a))/0x4+-parseInt(_0x31bb80(0x138))/0x5*(-parseInt(_0x31bb80(0x17f))/0x6)+parseInt(_0x31bb80(0x166))/0x7*(parseInt(_0x31bb80(0x160))/0x8)+parseInt(_0x31bb80(0x16f))/0x9+-parseInt(_0x31bb80(0x16b))/0xa;if(_0x4216d1===_0x50aed2)break;else _0x5d5cb7['push'](_0x5d5cb7['shift']());}catch(_0x5804fa){_0x5d5cb7['push'](_0x5d5cb7['shift']());}}}(a73_0x57a6,0x99c4b));var __importDefault=this&&this[a73_0x4781ed(0x185)]||function(_0x1a289a){const _0x10bb2b=a73_0x4781ed;return _0x1a289a&&_0x1a289a[_0x10bb2b(0x169)]?_0x1a289a:{'default':_0x1a289a};};Object[a73_0x4781ed(0x181)](exports,a73_0x4781ed(0x169),{'value':!![]}),exports['loggerService']=exports[a73_0x4781ed(0x13e)]=void 0x0;function a73_0x1a59(_0x217a30,_0xf2fb3e){_0x217a30=_0x217a30-0x138;const _0x57a6e3=a73_0x57a6();let _0x1a5900=_0x57a6e3[_0x217a30];return _0x1a5900;}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a73_0x4781ed(0x171)));class LoggerService{constructor(){const _0x480043=a73_0x4781ed;this['logsDir']=path_1[_0x480043(0x167)]['join'](process[_0x480043(0x172)](),_0x480043(0x146)),this[_0x480043(0x15c)]();}['ensureLogsDirectory'](){const _0x4bf650=a73_0x4781ed;!fs_1['default'][_0x4bf650(0x13c)](this[_0x4bf650(0x15f)])&&(fs_1[_0x4bf650(0x167)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x4bf650(0x149)](_0x4bf650(0x14c)+this[_0x4bf650(0x15f)]));}[a73_0x4781ed(0x16a)](_0x56c07e){const _0x2b0039=a73_0x4781ed,_0x1204cd=new Date()['toISOString']()[_0x2b0039(0x140)]('T')[0x0];return path_1['default'][_0x2b0039(0x14a)](this['logsDir'],_0x56c07e+'_'+_0x1204cd+'.log');}[a73_0x4781ed(0x14f)](_0x1f4965,_0x42e8f3){const _0x162385=a73_0x4781ed;try{const _0x83b06c=new Date()[_0x162385(0x154)](),_0x3f601d={'timestamp':_0x83b06c,..._0x42e8f3},_0x3cbaa6=JSON['stringify'](_0x3f601d)+'\x0a',_0xf52f7e=this[_0x162385(0x16a)](_0x1f4965);fs_1['default']['appendFileSync'](_0xf52f7e,_0x3cbaa6,_0x162385(0x16c));}catch(_0x31dd97){console[_0x162385(0x151)](_0x162385(0x170)+_0x1f4965+_0x162385(0x14b),_0x31dd97);}}[a73_0x4781ed(0x156)](_0x1a3145,_0x2cc23a,_0x5e4dc7,_0x536e75){const _0x3b111d=a73_0x4781ed;this[_0x3b111d(0x14f)](_0x3b111d(0x163),{'type':_0x3b111d(0x187),'gateway':_0x1a3145,'endpoint':_0x2cc23a,'method':_0x5e4dc7,'data':_0x536e75});}['logWhiteDomainResponse'](_0xa3b61a,_0x50e9d7,_0x5a305a,_0x36ec49,_0x42ee6b){const _0x278f17=a73_0x4781ed;this[_0x278f17(0x14f)]('white_domain_responses',{'type':_0x278f17(0x176),'gateway':_0xa3b61a,'endpoint':_0x50e9d7,'status':_0x5a305a,'responseTime':_0x42ee6b,'data':_0x36ec49});}[a73_0x4781ed(0x148)](_0x259de1,_0x2f4aeb,_0x179f4b){const _0x5abedf=a73_0x4781ed;this['writeLog'](_0x5abedf(0x152),{'type':_0x5abedf(0x15e),'gateway':_0x259de1,'endpoint':_0x2f4aeb,'error':_0x179f4b instanceof Error?{'message':_0x179f4b['message'],'stack':_0x179f4b[_0x5abedf(0x186)]}:_0x179f4b});}['logWebhookReceived'](_0x27e2f9,_0x307d83,_0x4de61c){const _0xb201a3=a73_0x4781ed;this['writeLog'](_0xb201a3(0x17d),{'type':'WEBHOOK_RECEIVED','gateway':_0x27e2f9,'headers':_0x4de61c,'data':_0x307d83});}[a73_0x4781ed(0x155)](_0x5c613b,_0x3a9ae1,_0x12cba3,_0x1783f8,_0x563152){const _0x1cc86a=a73_0x4781ed;this[_0x1cc86a(0x14f)](_0x1cc86a(0x17e),{'type':'WEBHOOK_PROCESSED','gateway':_0x5c613b,'paymentId':_0x3a9ae1,'oldStatus':_0x12cba3,'newStatus':_0x1783f8,'originalData':_0x563152});}['logWebhookError'](_0x18c2a6,_0x542d26,_0xb550f8){const _0x5c6e96=a73_0x4781ed;this[_0x5c6e96(0x14f)](_0x5c6e96(0x173),{'type':_0x5c6e96(0x144),'gateway':_0x18c2a6,'error':_0x542d26 instanceof Error?{'message':_0x542d26['message'],'stack':_0x542d26[_0x5c6e96(0x186)]}:_0x542d26,'originalData':_0xb550f8});}[a73_0x4781ed(0x16e)](_0x48a8c8){const _0x4b3ea2=a73_0x4781ed;this[_0x4b3ea2(0x14f)]('cointopay_status_changes',{'type':_0x4b3ea2(0x180),..._0x48a8c8});}['logCoinToPayError'](_0x448edf){const _0x2c471f=a73_0x4781ed;this[_0x2c471f(0x14f)](_0x2c471f(0x162),{'type':_0x2c471f(0x165),..._0x448edf});}[a73_0x4781ed(0x145)](_0x332252,_0x4065e3,_0x4a0c55,_0xb891c9,_0x97cdf4,_0x37f6dc){const _0x569f52=a73_0x4781ed;this['writeLog'](_0x569f52(0x17a),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x332252,'webhookUrl':_0x4065e3,'event':_0x4a0c55,'status':_0xb891c9,'responseTime':_0x97cdf4,'payload':_0x37f6dc});}['logShopWebhookError'](_0x4971b7,_0x15c975,_0x53a8f3,_0x18d76e,_0x1d2a0e){const _0x33c3c7=a73_0x4781ed;this[_0x33c3c7(0x14f)](_0x33c3c7(0x157),{'type':_0x33c3c7(0x15b),'shopId':_0x4971b7,'webhookUrl':_0x15c975,'event':_0x53a8f3,'error':_0x18d76e instanceof Error?{'message':_0x18d76e[_0x33c3c7(0x179)],'stack':_0x18d76e[_0x33c3c7(0x186)]}:_0x18d76e,'payload':_0x1d2a0e});}[a73_0x4781ed(0x159)](_0x416b4a,_0x1408f5,_0x3498a5,_0x4ad81d,_0x1b22d3){this['writeLog']('payments_created',{'type':'PAYMENT_CREATED','gateway':_0x416b4a,'paymentId':_0x1408f5,'shopId':_0x3498a5,'amount':_0x4ad81d,'currency':_0x1b22d3});}[a73_0x4781ed(0x13b)](_0x25b003,_0x3abf6f,_0x393e7d,_0x42237a,_0x3b19e7){const _0x1390f3=a73_0x4781ed;this[_0x1390f3(0x14f)]('api_calls',{'type':_0x1390f3(0x164),'endpoint':_0x25b003,'method':_0x3abf6f,'userId':_0x393e7d,'userRole':_0x42237a,'requestData':_0x3b19e7});}[a73_0x4781ed(0x14d)](){const _0xefaf0d=a73_0x4781ed;try{const _0x52c249=fs_1[_0xefaf0d(0x167)][_0xefaf0d(0x16d)](this[_0xefaf0d(0x15f)]),_0x3b5e34=_0x52c249[_0xefaf0d(0x153)](_0x4ce850=>_0x4ce850[_0xefaf0d(0x158)]('.log')),_0x3edcea=[...new Set(_0x3b5e34['map'](_0x2fde4a=>_0x2fde4a[_0xefaf0d(0x140)]('_')[0x0]))],_0x20625b=_0x3b5e34[_0xefaf0d(0x141)](_0x2579dc=>{const _0x29e706=_0xefaf0d,_0x3299c3=path_1[_0x29e706(0x167)]['join'](this['logsDir'],_0x2579dc),_0x32d92c=fs_1[_0x29e706(0x167)][_0x29e706(0x15a)](_0x3299c3),[_0x30523f,_0x4ef641]=_0x2579dc[_0x29e706(0x188)](_0x29e706(0x150),'')[_0x29e706(0x140)]('_');return{'type':_0x30523f,'date':_0x4ef641,'size':_0x32d92c[_0x29e706(0x143)]};})[_0xefaf0d(0x13d)]((_0x3931af,_0x3becbe)=>_0x3becbe['date']['localeCompare'](_0x3931af[_0xefaf0d(0x168)]));return{'totalFiles':_0x3b5e34[_0xefaf0d(0x15d)],'logTypes':_0x3edcea,'latestLogs':_0x20625b['slice'](0x0,0xa)};}catch(_0x58ff04){return console[_0xefaf0d(0x151)](_0xefaf0d(0x175),_0x58ff04),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a73_0x4781ed(0x174)](_0x3f503d=0x1e){const _0x32e166=a73_0x4781ed;try{const _0x233ca7=fs_1[_0x32e166(0x167)][_0x32e166(0x16d)](this[_0x32e166(0x15f)]),_0x19c03d=new Date();_0x19c03d[_0x32e166(0x14e)](_0x19c03d[_0x32e166(0x17c)]()-_0x3f503d);let _0x2f7ceb=0x0;_0x233ca7[_0x32e166(0x183)](_0x7a03ce=>{const _0x5e8056=_0x32e166;if(!_0x7a03ce[_0x5e8056(0x158)](_0x5e8056(0x150)))return;const _0x5129ec=path_1[_0x5e8056(0x167)][_0x5e8056(0x14a)](this['logsDir'],_0x7a03ce),_0x127cf4=fs_1[_0x5e8056(0x167)][_0x5e8056(0x15a)](_0x5129ec);_0x127cf4[_0x5e8056(0x147)]<_0x19c03d&&(fs_1[_0x5e8056(0x167)][_0x5e8056(0x142)](_0x5129ec),_0x2f7ceb++,console['log'](_0x5e8056(0x13f)+_0x7a03ce));}),console[_0x32e166(0x149)](_0x32e166(0x178)+_0x2f7ceb+_0x32e166(0x17b)+_0x3f503d+'\x20days)');}catch(_0x2bb527){console[_0x32e166(0x151)](_0x32e166(0x139),_0x2bb527);}}}exports['LoggerService']=LoggerService,exports[a73_0x4781ed(0x161)]=new LoggerService();function a73_0x57a6(){const _0x179d08=['length','ERROR','logsDir','8tuGSfk','loggerService','cointopay_errors','white_domain_requests','API_CALL','COINTOPAY_ERROR','2455460tmNQth','default','date','__esModule','getLogFileName','5616250rpwblh','utf8','readdirSync','logCoinToPayStatus','5619177xDoSJE','Failed\x20to\x20write\x20','path','cwd','webhooks_errors','cleanOldLogs','Failed\x20to\x20get\x20log\x20stats:','RESPONSE','3029UCJzMd','ðŸ§¹\x20Cleaned\x20','message','shop_webhooks_sent','\x20old\x20log\x20files\x20(older\x20than\x20','getDate','webhooks_received','webhooks_processed','723036gPWnPA','COINTOPAY_STATUS_CHANGE','defineProperty','540399ZYCRIP','forEach','686wQGTBD','__importDefault','stack','REQUEST','replace','25wjYedm','Failed\x20to\x20clean\x20old\x20logs:','4980068DjXpfk','logApiCall','existsSync','sort','LoggerService','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','split','map','unlinkSync','size','WEBHOOK_ERROR','logShopWebhookSent','logs','mtime','logWhiteDomainError','log','join','\x20log:','ðŸ“\x20Created\x20logs\x20directory:\x20','getLogStats','setDate','writeLog','.log','error','white_domain_errors','filter','toISOString','logWebhookProcessed','logWhiteDomainRequest','shop_webhooks_errors','endsWith','logPaymentCreated','statSync','SHOP_WEBHOOK_ERROR','ensureLogsDirectory'];a73_0x57a6=function(){return _0x179d08;};return a73_0x57a6();}