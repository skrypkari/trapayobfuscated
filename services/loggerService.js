'use strict';const a49_0x2c70ac=a49_0x5059;function a49_0x3329(){const _0x54f819=['\x20log:','shop_webhooks_errors','date','statSync','getLogFileName','mkdirSync','__esModule','7529322mJhDHO','WEBHOOK_ERROR','LoggerService','451eDAMNe','message','SHOP_WEBHOOK_ERROR','465580gAFwDB','7543240OmurzD','defineProperty','logApiCall','cwd','split','logs','logCoinToPayStatus','default','cointopay_status_changes','15sRJMNi','.log','logCoinToPayError','🗑️\x20Deleted\x20old\x20log\x20file:\x20','webhooks_processed','endsWith','Failed\x20to\x20get\x20log\x20stats:','readdirSync','2lbhLas','logWebhookProcessed','logWebhookError','RESPONSE','logShopWebhookError','loggerService','appendFileSync','SHOP_WEBHOOK_SENT','mtime','cointopay_errors','map','payments_created','27728qCmjFX','log','logWebhookReceived','API_CALL','cleanOldLogs','unlinkSync','error','WEBHOOK_RECEIVED','stack','join','existsSync','sort','logPaymentCreated','api_calls','length','\x20old\x20log\x20files\x20(older\x20than\x20','COINTOPAY_STATUS_CHANGE','ensureLogsDirectory','logsDir','975290BiExqO','size','utf8','154aJJRSX','🧹\x20Cleaned\x20','white_domain_responses','forEach','11916918ZAhvJY','white_domain_errors','logWhiteDomainResponse','filter','Failed\x20to\x20write\x20','replace','1360466Qpwmfh','writeLog','toISOString'];a49_0x3329=function(){return _0x54f819;};return a49_0x3329();}(function(_0x38e3be,_0x17aa73){const _0x1bb587=a49_0x5059,_0x54790b=_0x38e3be();while(!![]){try{const _0x27e45c=-parseInt(_0x1bb587(0x98))/0x1*(-parseInt(_0x1bb587(0xc4))/0x2)+parseInt(_0x1bb587(0x90))/0x3*(-parseInt(_0x1bb587(0xd4))/0x4)+-parseInt(_0x1bb587(0xd5))/0x5+-parseInt(_0x1bb587(0xce))/0x6+-parseInt(_0x1bb587(0xba))/0x7*(-parseInt(_0x1bb587(0xa4))/0x8)+-parseInt(_0x1bb587(0xbe))/0x9+-parseInt(_0x1bb587(0xb7))/0xa*(-parseInt(_0x1bb587(0xd1))/0xb);if(_0x27e45c===_0x17aa73)break;else _0x54790b['push'](_0x54790b['shift']());}catch(_0xf0d3c3){_0x54790b['push'](_0x54790b['shift']());}}}(a49_0x3329,0xbaf63));var __importDefault=this&&this['__importDefault']||function(_0x1a8a85){const _0x16e0eb=a49_0x5059;return _0x1a8a85&&_0x1a8a85[_0x16e0eb(0xcd)]?_0x1a8a85:{'default':_0x1a8a85};};Object[a49_0x2c70ac(0xd6)](exports,a49_0x2c70ac(0xcd),{'value':!![]}),exports[a49_0x2c70ac(0x9d)]=exports[a49_0x2c70ac(0xd0)]=void 0x0;function a49_0x5059(_0x28f698,_0x2bfede){const _0x3329fb=a49_0x3329();return a49_0x5059=function(_0x50594c,_0xfae982){_0x50594c=_0x50594c-0x90;let _0x505be7=_0x3329fb[_0x50594c];return _0x505be7;},a49_0x5059(_0x28f698,_0x2bfede);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x5bf89c=a49_0x2c70ac;this[_0x5bf89c(0xb6)]=path_1[_0x5bf89c(0xdc)][_0x5bf89c(0xad)](process[_0x5bf89c(0xd8)](),_0x5bf89c(0xda)),this['ensureLogsDirectory']();}[a49_0x2c70ac(0xb5)](){const _0x431585=a49_0x2c70ac;!fs_1[_0x431585(0xdc)][_0x431585(0xae)](this[_0x431585(0xb6)])&&(fs_1['default'][_0x431585(0xcc)](this['logsDir'],{'recursive':!![]}),console[_0x431585(0xa5)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x431585(0xb6)]));}[a49_0x2c70ac(0xcb)](_0x2dd7c2){const _0x405705=a49_0x2c70ac,_0xf0485a=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x405705(0xdc)][_0x405705(0xad)](this[_0x405705(0xb6)],_0x2dd7c2+'_'+_0xf0485a+_0x405705(0x91));}['writeLog'](_0x46773d,_0x10a715){const _0xa92300=a49_0x2c70ac;try{const _0x2e2442=new Date()[_0xa92300(0xc6)](),_0x2509f7={'timestamp':_0x2e2442,..._0x10a715},_0x2c3307=JSON['stringify'](_0x2509f7)+'\x0a',_0x4d2502=this[_0xa92300(0xcb)](_0x46773d);fs_1[_0xa92300(0xdc)][_0xa92300(0x9e)](_0x4d2502,_0x2c3307,_0xa92300(0xb9));}catch(_0x563204){console[_0xa92300(0xaa)](_0xa92300(0xc2)+_0x46773d+_0xa92300(0xc7),_0x563204);}}['logWhiteDomainRequest'](_0x7bb0bf,_0x35c0a3,_0x637f81,_0x2660cd){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0x7bb0bf,'endpoint':_0x35c0a3,'method':_0x637f81,'data':_0x2660cd});}[a49_0x2c70ac(0xc0)](_0x281293,_0x10f453,_0x59b7de,_0x54a98c,_0x4110e5){const _0x5ab57f=a49_0x2c70ac;this[_0x5ab57f(0xc5)](_0x5ab57f(0xbc),{'type':_0x5ab57f(0x9b),'gateway':_0x281293,'endpoint':_0x10f453,'status':_0x59b7de,'responseTime':_0x4110e5,'data':_0x54a98c});}['logWhiteDomainError'](_0x3952cd,_0x42d3f6,_0x1c28a2){const _0x441cdd=a49_0x2c70ac;this[_0x441cdd(0xc5)](_0x441cdd(0xbf),{'type':'ERROR','gateway':_0x3952cd,'endpoint':_0x42d3f6,'error':_0x1c28a2 instanceof Error?{'message':_0x1c28a2['message'],'stack':_0x1c28a2['stack']}:_0x1c28a2});}[a49_0x2c70ac(0xa6)](_0x1f616f,_0x58e0c1,_0x2d5639){const _0x59219a=a49_0x2c70ac;this[_0x59219a(0xc5)]('webhooks_received',{'type':_0x59219a(0xab),'gateway':_0x1f616f,'headers':_0x2d5639,'data':_0x58e0c1});}[a49_0x2c70ac(0x99)](_0x5b7282,_0x44845f,_0xda312c,_0x245ec1,_0x402b63){const _0x2b360e=a49_0x2c70ac;this[_0x2b360e(0xc5)](_0x2b360e(0x94),{'type':'WEBHOOK_PROCESSED','gateway':_0x5b7282,'paymentId':_0x44845f,'oldStatus':_0xda312c,'newStatus':_0x245ec1,'originalData':_0x402b63});}[a49_0x2c70ac(0x9a)](_0x113168,_0x103d8e,_0x463347){const _0x2e2a48=a49_0x2c70ac;this[_0x2e2a48(0xc5)]('webhooks_errors',{'type':_0x2e2a48(0xcf),'gateway':_0x113168,'error':_0x103d8e instanceof Error?{'message':_0x103d8e[_0x2e2a48(0xd2)],'stack':_0x103d8e[_0x2e2a48(0xac)]}:_0x103d8e,'originalData':_0x463347});}[a49_0x2c70ac(0xdb)](_0x5f5544){const _0x7ce5f6=a49_0x2c70ac;this['writeLog'](_0x7ce5f6(0xdd),{'type':_0x7ce5f6(0xb4),..._0x5f5544});}[a49_0x2c70ac(0x92)](_0x42cd29){const _0x481c2c=a49_0x2c70ac;this[_0x481c2c(0xc5)](_0x481c2c(0xa1),{'type':'COINTOPAY_ERROR',..._0x42cd29});}['logShopWebhookSent'](_0x19348b,_0x3f6866,_0x355db5,_0x150f86,_0x22c600,_0x30f7f6){const _0x30bf57=a49_0x2c70ac;this[_0x30bf57(0xc5)]('shop_webhooks_sent',{'type':_0x30bf57(0x9f),'shopId':_0x19348b,'webhookUrl':_0x3f6866,'event':_0x355db5,'status':_0x150f86,'responseTime':_0x22c600,'payload':_0x30f7f6});}[a49_0x2c70ac(0x9c)](_0x37a3c0,_0x14d117,_0x28c0f8,_0x53cd13,_0x4e1529){const _0x4f1ab4=a49_0x2c70ac;this[_0x4f1ab4(0xc5)](_0x4f1ab4(0xc8),{'type':_0x4f1ab4(0xd3),'shopId':_0x37a3c0,'webhookUrl':_0x14d117,'event':_0x28c0f8,'error':_0x53cd13 instanceof Error?{'message':_0x53cd13[_0x4f1ab4(0xd2)],'stack':_0x53cd13['stack']}:_0x53cd13,'payload':_0x4e1529});}[a49_0x2c70ac(0xb0)](_0x46b8e8,_0xc2a9c4,_0x869ef0,_0x34859a,_0x126890){const _0x232608=a49_0x2c70ac;this[_0x232608(0xc5)](_0x232608(0xa3),{'type':'PAYMENT_CREATED','gateway':_0x46b8e8,'paymentId':_0xc2a9c4,'shopId':_0x869ef0,'amount':_0x34859a,'currency':_0x126890});}[a49_0x2c70ac(0xd7)](_0x5e7833,_0x275435,_0x2f65c5,_0x1150dc,_0x161c2e){const _0x36836d=a49_0x2c70ac;this[_0x36836d(0xc5)](_0x36836d(0xb1),{'type':_0x36836d(0xa7),'endpoint':_0x5e7833,'method':_0x275435,'userId':_0x2f65c5,'userRole':_0x1150dc,'requestData':_0x161c2e});}['getLogStats'](){const _0x1b65b6=a49_0x2c70ac;try{const _0x3d7679=fs_1['default'][_0x1b65b6(0x97)](this[_0x1b65b6(0xb6)]),_0x589c29=_0x3d7679[_0x1b65b6(0xc1)](_0x58ed41=>_0x58ed41[_0x1b65b6(0x95)](_0x1b65b6(0x91))),_0x5aeb09=[...new Set(_0x589c29['map'](_0x186927=>_0x186927[_0x1b65b6(0xd9)]('_')[0x0]))],_0x3e12a8=_0x589c29[_0x1b65b6(0xa2)](_0x363af0=>{const _0x688467=_0x1b65b6,_0x295580=path_1[_0x688467(0xdc)][_0x688467(0xad)](this[_0x688467(0xb6)],_0x363af0),_0x4220ed=fs_1[_0x688467(0xdc)][_0x688467(0xca)](_0x295580),[_0x454153,_0x1d8036]=_0x363af0[_0x688467(0xc3)](_0x688467(0x91),'')[_0x688467(0xd9)]('_');return{'type':_0x454153,'date':_0x1d8036,'size':_0x4220ed[_0x688467(0xb8)]};})[_0x1b65b6(0xaf)]((_0x160483,_0x2d825c)=>_0x2d825c['date']['localeCompare'](_0x160483[_0x1b65b6(0xc9)]));return{'totalFiles':_0x589c29[_0x1b65b6(0xb2)],'logTypes':_0x5aeb09,'latestLogs':_0x3e12a8['slice'](0x0,0xa)};}catch(_0x153a9f){return console[_0x1b65b6(0xaa)](_0x1b65b6(0x96),_0x153a9f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x2c70ac(0xa8)](_0x1c933c=0x1e){const _0x4077b8=a49_0x2c70ac;try{const _0x55f356=fs_1[_0x4077b8(0xdc)][_0x4077b8(0x97)](this[_0x4077b8(0xb6)]),_0x3a4a3a=new Date();_0x3a4a3a['setDate'](_0x3a4a3a['getDate']()-_0x1c933c);let _0x16525b=0x0;_0x55f356[_0x4077b8(0xbd)](_0x5a3d1e=>{const _0x2d456f=_0x4077b8;if(!_0x5a3d1e['endsWith'](_0x2d456f(0x91)))return;const _0x320bc1=path_1[_0x2d456f(0xdc)][_0x2d456f(0xad)](this[_0x2d456f(0xb6)],_0x5a3d1e),_0x4b87ec=fs_1[_0x2d456f(0xdc)][_0x2d456f(0xca)](_0x320bc1);_0x4b87ec[_0x2d456f(0xa0)]<_0x3a4a3a&&(fs_1['default'][_0x2d456f(0xa9)](_0x320bc1),_0x16525b++,console[_0x2d456f(0xa5)](_0x2d456f(0x93)+_0x5a3d1e));}),console[_0x4077b8(0xa5)](_0x4077b8(0xbb)+_0x16525b+_0x4077b8(0xb3)+_0x1c933c+'\x20days)');}catch(_0x317ba1){console[_0x4077b8(0xaa)]('Failed\x20to\x20clean\x20old\x20logs:',_0x317ba1);}}}exports[a49_0x2c70ac(0xd0)]=LoggerService,exports['loggerService']=new LoggerService();