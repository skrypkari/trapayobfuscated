'use strict';const a59_0xde8db2=a59_0x2dd8;(function(_0x37a387,_0xbcb878){const _0x3ddf09=a59_0x2dd8,_0x45336e=_0x37a387();while(!![]){try{const _0x125e45=-parseInt(_0x3ddf09(0x17e))/0x1*(parseInt(_0x3ddf09(0x159))/0x2)+parseInt(_0x3ddf09(0x153))/0x3*(parseInt(_0x3ddf09(0x142))/0x4)+-parseInt(_0x3ddf09(0x158))/0x5+-parseInt(_0x3ddf09(0x13d))/0x6*(parseInt(_0x3ddf09(0x16c))/0x7)+-parseInt(_0x3ddf09(0x173))/0x8+parseInt(_0x3ddf09(0x171))/0x9+parseInt(_0x3ddf09(0x141))/0xa;if(_0x125e45===_0xbcb878)break;else _0x45336e['push'](_0x45336e['shift']());}catch(_0x31f00f){_0x45336e['push'](_0x45336e['shift']());}}}(a59_0x5bbf,0x834fb));var __importDefault=this&&this[a59_0xde8db2(0x16a)]||function(_0x2c3317){const _0x4359e9=a59_0xde8db2;return _0x2c3317&&_0x2c3317[_0x4359e9(0x186)]?_0x2c3317:{'default':_0x2c3317};};function a59_0x5bbf(){const _0x4f3d5a=['logWebhookReceived','8pYgOoM','logCoinToPayError','LoggerService','mkdirSync','path','logWhiteDomainRequest','logPaymentCreated','split','__esModule','endsWith','error','size','cointopay_errors','shop_webhooks_sent','existsSync','shop_webhooks_errors','ERROR','message','138yzXUsY','PAYMENT_CREATED','cleanOldLogs','payments_created','8196520hpqgHb','469564qXxRnp','logShopWebhookError','replace','COINTOPAY_ERROR','toISOString','getDate','loggerService','SHOP_WEBHOOK_ERROR','API_CALL','filter','white_domain_responses','logWhiteDomainResponse','Failed\x20to\x20clean\x20old\x20logs:','localeCompare','WEBHOOK_RECEIVED','ensureLogsDirectory','defineProperty','21inpbVy','map','📁\x20Created\x20logs\x20directory:\x20','join','cwd','3742165HUnAzS','129692noSSST','Failed\x20to\x20write\x20','logsDir','date','.log','log','statSync','setDate','length','white_domain_errors','default','logApiCall','sort','cointopay_status_changes','writeLog','stack','webhooks_received','__importDefault','api_calls','59227CGqleV','appendFileSync','getLogFileName','\x20old\x20log\x20files\x20(older\x20than\x20','RESPONSE','6822225xbLKEW','REQUEST','3198072EisWuJ','stringify','white_domain_requests','\x20log:','mtime','🗑️\x20Deleted\x20old\x20log\x20file:\x20','getLogStats','webhooks_processed','readdirSync','COINTOPAY_STATUS_CHANGE'];a59_0x5bbf=function(){return _0x4f3d5a;};return a59_0x5bbf();}Object[a59_0xde8db2(0x152)](exports,a59_0xde8db2(0x186),{'value':!![]}),exports[a59_0xde8db2(0x148)]=exports[a59_0xde8db2(0x180)]=void 0x0;function a59_0x2dd8(_0x23ad3b,_0x5972dc){const _0x5bbf4e=a59_0x5bbf();return a59_0x2dd8=function(_0x2dd80c,_0x2a3c11){_0x2dd80c=_0x2dd80c-0x13c;let _0x257436=_0x5bbf4e[_0x2dd80c];return _0x257436;},a59_0x2dd8(_0x23ad3b,_0x5972dc);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0xde8db2(0x182)));class LoggerService{constructor(){const _0x18b7a7=a59_0xde8db2;this[_0x18b7a7(0x15b)]=path_1[_0x18b7a7(0x163)][_0x18b7a7(0x156)](process[_0x18b7a7(0x157)](),'logs'),this[_0x18b7a7(0x151)]();}[a59_0xde8db2(0x151)](){const _0x4f44af=a59_0xde8db2;!fs_1[_0x4f44af(0x163)][_0x4f44af(0x18c)](this[_0x4f44af(0x15b)])&&(fs_1[_0x4f44af(0x163)][_0x4f44af(0x181)](this['logsDir'],{'recursive':!![]}),console[_0x4f44af(0x15e)](_0x4f44af(0x155)+this[_0x4f44af(0x15b)]));}[a59_0xde8db2(0x16e)](_0x234a83){const _0x4669b9=a59_0xde8db2,_0x42e8aa=new Date()[_0x4669b9(0x146)]()[_0x4669b9(0x185)]('T')[0x0];return path_1[_0x4669b9(0x163)]['join'](this['logsDir'],_0x234a83+'_'+_0x42e8aa+'.log');}[a59_0xde8db2(0x167)](_0x39fb6b,_0x396d7c){const _0x39ed0a=a59_0xde8db2;try{const _0x21d2ad=new Date()[_0x39ed0a(0x146)](),_0xabe1ce={'timestamp':_0x21d2ad,..._0x396d7c},_0x1c9645=JSON[_0x39ed0a(0x174)](_0xabe1ce)+'\x0a',_0x396db8=this[_0x39ed0a(0x16e)](_0x39fb6b);fs_1['default'][_0x39ed0a(0x16d)](_0x396db8,_0x1c9645,'utf8');}catch(_0x30c5b1){console[_0x39ed0a(0x188)](_0x39ed0a(0x15a)+_0x39fb6b+_0x39ed0a(0x176),_0x30c5b1);}}[a59_0xde8db2(0x183)](_0x26da02,_0x53bce0,_0x103ad6,_0x4fa919){const _0x4e0164=a59_0xde8db2;this[_0x4e0164(0x167)](_0x4e0164(0x175),{'type':_0x4e0164(0x172),'gateway':_0x26da02,'endpoint':_0x53bce0,'method':_0x103ad6,'data':_0x4fa919});}[a59_0xde8db2(0x14d)](_0x44d07e,_0x305394,_0x1badb3,_0x30d12f,_0x510261){const _0x19b1dd=a59_0xde8db2;this[_0x19b1dd(0x167)](_0x19b1dd(0x14c),{'type':_0x19b1dd(0x170),'gateway':_0x44d07e,'endpoint':_0x305394,'status':_0x1badb3,'responseTime':_0x510261,'data':_0x30d12f});}['logWhiteDomainError'](_0x7ae981,_0x3b4d12,_0xa1a4aa){const _0x1923b2=a59_0xde8db2;this[_0x1923b2(0x167)](_0x1923b2(0x162),{'type':_0x1923b2(0x18e),'gateway':_0x7ae981,'endpoint':_0x3b4d12,'error':_0xa1a4aa instanceof Error?{'message':_0xa1a4aa[_0x1923b2(0x13c)],'stack':_0xa1a4aa[_0x1923b2(0x168)]}:_0xa1a4aa});}[a59_0xde8db2(0x17d)](_0x34a1ca,_0xbeae69,_0x6aabe2){const _0x5edfd8=a59_0xde8db2;this[_0x5edfd8(0x167)](_0x5edfd8(0x169),{'type':_0x5edfd8(0x150),'gateway':_0x34a1ca,'headers':_0x6aabe2,'data':_0xbeae69});}['logWebhookProcessed'](_0x285f75,_0x3ac819,_0x253e80,_0x24bfd0,_0x34e568){const _0x473bc9=a59_0xde8db2;this[_0x473bc9(0x167)](_0x473bc9(0x17a),{'type':'WEBHOOK_PROCESSED','gateway':_0x285f75,'paymentId':_0x3ac819,'oldStatus':_0x253e80,'newStatus':_0x24bfd0,'originalData':_0x34e568});}['logWebhookError'](_0xd0e76f,_0x194cb0,_0x2ef741){const _0xa084ea=a59_0xde8db2;this[_0xa084ea(0x167)]('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0xd0e76f,'error':_0x194cb0 instanceof Error?{'message':_0x194cb0[_0xa084ea(0x13c)],'stack':_0x194cb0[_0xa084ea(0x168)]}:_0x194cb0,'originalData':_0x2ef741});}['logCoinToPayStatus'](_0x5dc0ce){const _0x46b128=a59_0xde8db2;this[_0x46b128(0x167)](_0x46b128(0x166),{'type':_0x46b128(0x17c),..._0x5dc0ce});}[a59_0xde8db2(0x17f)](_0x35e77f){const _0x41e71c=a59_0xde8db2;this[_0x41e71c(0x167)](_0x41e71c(0x18a),{'type':_0x41e71c(0x145),..._0x35e77f});}['logShopWebhookSent'](_0x114ded,_0x3464c3,_0x3beecf,_0x827806,_0x470d5e,_0x45d211){const _0xf52cb5=a59_0xde8db2;this[_0xf52cb5(0x167)](_0xf52cb5(0x18b),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x114ded,'webhookUrl':_0x3464c3,'event':_0x3beecf,'status':_0x827806,'responseTime':_0x470d5e,'payload':_0x45d211});}[a59_0xde8db2(0x143)](_0x488bde,_0x2bbe4b,_0x10466d,_0x393911,_0xe45911){const _0x3abd44=a59_0xde8db2;this[_0x3abd44(0x167)](_0x3abd44(0x18d),{'type':_0x3abd44(0x149),'shopId':_0x488bde,'webhookUrl':_0x2bbe4b,'event':_0x10466d,'error':_0x393911 instanceof Error?{'message':_0x393911[_0x3abd44(0x13c)],'stack':_0x393911[_0x3abd44(0x168)]}:_0x393911,'payload':_0xe45911});}[a59_0xde8db2(0x184)](_0x1bdc5f,_0x59b8dd,_0x1a67bc,_0x10a4d2,_0x2ed031){const _0x294b89=a59_0xde8db2;this[_0x294b89(0x167)](_0x294b89(0x140),{'type':_0x294b89(0x13e),'gateway':_0x1bdc5f,'paymentId':_0x59b8dd,'shopId':_0x1a67bc,'amount':_0x10a4d2,'currency':_0x2ed031});}[a59_0xde8db2(0x164)](_0x356783,_0x121d10,_0x1119ca,_0x63dcbb,_0x4f173a){const _0x1d61dc=a59_0xde8db2;this[_0x1d61dc(0x167)](_0x1d61dc(0x16b),{'type':_0x1d61dc(0x14a),'endpoint':_0x356783,'method':_0x121d10,'userId':_0x1119ca,'userRole':_0x63dcbb,'requestData':_0x4f173a});}[a59_0xde8db2(0x179)](){const _0x33ae04=a59_0xde8db2;try{const _0xdc0182=fs_1[_0x33ae04(0x163)][_0x33ae04(0x17b)](this['logsDir']),_0x4e5ca6=_0xdc0182[_0x33ae04(0x14b)](_0x157477=>_0x157477[_0x33ae04(0x187)](_0x33ae04(0x15d))),_0x5aabc0=[...new Set(_0x4e5ca6[_0x33ae04(0x154)](_0x37b6cb=>_0x37b6cb['split']('_')[0x0]))],_0x3af18a=_0x4e5ca6[_0x33ae04(0x154)](_0x31ddb9=>{const _0x4523ea=_0x33ae04,_0x3513b9=path_1['default'][_0x4523ea(0x156)](this[_0x4523ea(0x15b)],_0x31ddb9),_0x23cd3e=fs_1['default'][_0x4523ea(0x15f)](_0x3513b9),[_0x1a8d96,_0x18bd11]=_0x31ddb9[_0x4523ea(0x144)](_0x4523ea(0x15d),'')[_0x4523ea(0x185)]('_');return{'type':_0x1a8d96,'date':_0x18bd11,'size':_0x23cd3e[_0x4523ea(0x189)]};})[_0x33ae04(0x165)]((_0x15fa20,_0x241ac3)=>_0x241ac3['date'][_0x33ae04(0x14f)](_0x15fa20[_0x33ae04(0x15c)]));return{'totalFiles':_0x4e5ca6[_0x33ae04(0x161)],'logTypes':_0x5aabc0,'latestLogs':_0x3af18a['slice'](0x0,0xa)};}catch(_0x319bb6){return console[_0x33ae04(0x188)]('Failed\x20to\x20get\x20log\x20stats:',_0x319bb6),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0xde8db2(0x13f)](_0x56c82a=0x1e){const _0x39b728=a59_0xde8db2;try{const _0x49071d=fs_1[_0x39b728(0x163)][_0x39b728(0x17b)](this[_0x39b728(0x15b)]),_0x2e83e7=new Date();_0x2e83e7[_0x39b728(0x160)](_0x2e83e7[_0x39b728(0x147)]()-_0x56c82a);let _0x206fa1=0x0;_0x49071d['forEach'](_0x4b278f=>{const _0x4c6850=_0x39b728;if(!_0x4b278f['endsWith']('.log'))return;const _0x38c8c1=path_1['default'][_0x4c6850(0x156)](this[_0x4c6850(0x15b)],_0x4b278f),_0x3a0c12=fs_1['default'][_0x4c6850(0x15f)](_0x38c8c1);_0x3a0c12[_0x4c6850(0x177)]<_0x2e83e7&&(fs_1['default']['unlinkSync'](_0x38c8c1),_0x206fa1++,console[_0x4c6850(0x15e)](_0x4c6850(0x178)+_0x4b278f));}),console[_0x39b728(0x15e)]('🧹\x20Cleaned\x20'+_0x206fa1+_0x39b728(0x16f)+_0x56c82a+'\x20days)');}catch(_0xda3e91){console[_0x39b728(0x188)](_0x39b728(0x14e),_0xda3e91);}}}exports[a59_0xde8db2(0x180)]=LoggerService,exports[a59_0xde8db2(0x148)]=new LoggerService();