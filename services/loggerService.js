'use strict';const a47_0x494254=a47_0x9a9a;(function(_0x56eb1e,_0x95dc52){const _0x26bbe3=a47_0x9a9a,_0x3564d5=_0x56eb1e();while(!![]){try{const _0x297851=-parseInt(_0x26bbe3(0xad))/0x1*(parseInt(_0x26bbe3(0x9c))/0x2)+parseInt(_0x26bbe3(0xc6))/0x3*(-parseInt(_0x26bbe3(0xcb))/0x4)+-parseInt(_0x26bbe3(0x92))/0x5*(parseInt(_0x26bbe3(0xbc))/0x6)+-parseInt(_0x26bbe3(0xd1))/0x7+-parseInt(_0x26bbe3(0xa1))/0x8*(-parseInt(_0x26bbe3(0x9d))/0x9)+parseInt(_0x26bbe3(0xc4))/0xa*(-parseInt(_0x26bbe3(0xdd))/0xb)+-parseInt(_0x26bbe3(0x88))/0xc*(-parseInt(_0x26bbe3(0xa9))/0xd);if(_0x297851===_0x95dc52)break;else _0x3564d5['push'](_0x3564d5['shift']());}catch(_0x32f225){_0x3564d5['push'](_0x3564d5['shift']());}}}(a47_0x5208,0x219b9));var __importDefault=this&&this[a47_0x494254(0xcc)]||function(_0x5b868a){const _0x3ed9ee=a47_0x494254;return _0x5b868a&&_0x5b868a[_0x3ed9ee(0xdc)]?_0x5b868a:{'default':_0x5b868a};};Object[a47_0x494254(0x94)](exports,a47_0x494254(0xdc),{'value':!![]}),exports[a47_0x494254(0x98)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a47_0x494254(0xa7)));function a47_0x9a9a(_0x5f43de,_0x261c6b){const _0x5208d2=a47_0x5208();return a47_0x9a9a=function(_0x9a9a7c,_0x244889){_0x9a9a7c=_0x9a9a7c-0x88;let _0x163971=_0x5208d2[_0x9a9a7c];return _0x163971;},a47_0x9a9a(_0x5f43de,_0x261c6b);}class LoggerService{constructor(){const _0x527527=a47_0x494254;this[_0x527527(0xcd)]=path_1[_0x527527(0xd5)][_0x527527(0xa5)](process[_0x527527(0x8b)](),_0x527527(0xd3)),this[_0x527527(0xb5)]();}['ensureLogsDirectory'](){const _0xcdc522=a47_0x494254;!fs_1[_0xcdc522(0xd5)][_0xcdc522(0xb0)](this[_0xcdc522(0xcd)])&&(fs_1['default']['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0xcdc522(0xc9)](_0xcdc522(0xaf)+this[_0xcdc522(0xcd)]));}[a47_0x494254(0x8c)](_0x33bc60){const _0x1bd965=a47_0x494254,_0x5e9a85=new Date()[_0x1bd965(0xb6)]()['split']('T')[0x0];return path_1['default']['join'](this[_0x1bd965(0xcd)],_0x33bc60+'_'+_0x5e9a85+'.log');}['writeLog'](_0x1ea28e,_0x35e5b3){const _0x14a9c5=a47_0x494254;try{const _0x2b6288=new Date()[_0x14a9c5(0xb6)](),_0x170c04={'timestamp':_0x2b6288,..._0x35e5b3},_0x92ffa4=JSON[_0x14a9c5(0x95)](_0x170c04)+'\x0a',_0x405aac=this[_0x14a9c5(0x8c)](_0x1ea28e);fs_1[_0x14a9c5(0xd5)][_0x14a9c5(0xc7)](_0x405aac,_0x92ffa4,_0x14a9c5(0xae));}catch(_0x265397){console[_0x14a9c5(0x8a)](_0x14a9c5(0x8d)+_0x1ea28e+_0x14a9c5(0xde),_0x265397);}}['logWhiteDomainRequest'](_0x14745e,_0x48cfc6,_0x39f593,_0x534fa9){const _0x1ed0b9=a47_0x494254;this[_0x1ed0b9(0x9a)](_0x1ed0b9(0xb1),{'type':_0x1ed0b9(0x91),'gateway':_0x14745e,'endpoint':_0x48cfc6,'method':_0x39f593,'data':_0x534fa9});}[a47_0x494254(0xac)](_0x175ec7,_0x258056,_0x3b76a6,_0x3392a3,_0x5217b3){const _0x23c528=a47_0x494254;this[_0x23c528(0x9a)](_0x23c528(0x93),{'type':'RESPONSE','gateway':_0x175ec7,'endpoint':_0x258056,'status':_0x3b76a6,'responseTime':_0x5217b3,'data':_0x3392a3});}[a47_0x494254(0xd7)](_0x522852,_0x33bc0a,_0x2bc10e){const _0x247a2e=a47_0x494254;this[_0x247a2e(0x9a)](_0x247a2e(0xc1),{'type':_0x247a2e(0xb8),'gateway':_0x522852,'endpoint':_0x33bc0a,'error':_0x2bc10e instanceof Error?{'message':_0x2bc10e[_0x247a2e(0xa8)],'stack':_0x2bc10e['stack']}:_0x2bc10e});}[a47_0x494254(0xdb)](_0x4a6a3e,_0x398e6f,_0x3f1b1d){const _0x1de885=a47_0x494254;this[_0x1de885(0x9a)](_0x1de885(0x90),{'type':_0x1de885(0xba),'gateway':_0x4a6a3e,'headers':_0x3f1b1d,'data':_0x398e6f});}['logWebhookProcessed'](_0x59968d,_0x58b2f7,_0x1ab027,_0x31c570,_0x5f32b0){const _0x24bf3b=a47_0x494254;this[_0x24bf3b(0x9a)](_0x24bf3b(0xa3),{'type':'WEBHOOK_PROCESSED','gateway':_0x59968d,'paymentId':_0x58b2f7,'oldStatus':_0x1ab027,'newStatus':_0x31c570,'originalData':_0x5f32b0});}[a47_0x494254(0xc3)](_0x45a4bd,_0x2ca9b0,_0x2fc187){const _0x4daecb=a47_0x494254;this[_0x4daecb(0x9a)]('webhooks_errors',{'type':_0x4daecb(0xc2),'gateway':_0x45a4bd,'error':_0x2ca9b0 instanceof Error?{'message':_0x2ca9b0[_0x4daecb(0xa8)],'stack':_0x2ca9b0[_0x4daecb(0xd8)]}:_0x2ca9b0,'originalData':_0x2fc187});}[a47_0x494254(0x8e)](_0x5ce7c2){const _0x93161f=a47_0x494254;this['writeLog'](_0x93161f(0xbf),{'type':_0x93161f(0x89),..._0x5ce7c2});}['logCoinToPayError'](_0x457800){const _0x49073a=a47_0x494254;this[_0x49073a(0x9a)](_0x49073a(0xd6),{'type':_0x49073a(0xc5),..._0x457800});}['logShopWebhookSent'](_0xa32160,_0x368b9c,_0x437eff,_0x1e7c83,_0xc7ccb5,_0x344cbf){const _0x28b37b=a47_0x494254;this[_0x28b37b(0x9a)]('shop_webhooks_sent',{'type':_0x28b37b(0xd9),'shopId':_0xa32160,'webhookUrl':_0x368b9c,'event':_0x437eff,'status':_0x1e7c83,'responseTime':_0xc7ccb5,'payload':_0x344cbf});}['logShopWebhookError'](_0x498b6c,_0x497f4b,_0x1f1116,_0x3dc3e4,_0x20ad7d){const _0x5955f6=a47_0x494254;this[_0x5955f6(0x9a)](_0x5955f6(0xbb),{'type':_0x5955f6(0x8f),'shopId':_0x498b6c,'webhookUrl':_0x497f4b,'event':_0x1f1116,'error':_0x3dc3e4 instanceof Error?{'message':_0x3dc3e4[_0x5955f6(0xa8)],'stack':_0x3dc3e4['stack']}:_0x3dc3e4,'payload':_0x20ad7d});}[a47_0x494254(0xce)](_0x3920b3,_0x581466,_0x14683a,_0x192b75,_0x4e233b){const _0x3dc8a3=a47_0x494254;this[_0x3dc8a3(0x9a)]('payments_created',{'type':_0x3dc8a3(0xb9),'gateway':_0x3920b3,'paymentId':_0x581466,'shopId':_0x14683a,'amount':_0x192b75,'currency':_0x4e233b});}[a47_0x494254(0xa0)](_0x9448e7,_0x43b684,_0x3b2dad,_0x5eb58b,_0x32828e){const _0x3bd924=a47_0x494254;this['writeLog'](_0x3bd924(0xc8),{'type':_0x3bd924(0xc0),'endpoint':_0x9448e7,'method':_0x43b684,'userId':_0x3b2dad,'userRole':_0x5eb58b,'requestData':_0x32828e});}[a47_0x494254(0xb4)](){const _0x1a535f=a47_0x494254;try{const _0x3d558c=fs_1[_0x1a535f(0xd5)][_0x1a535f(0xd0)](this[_0x1a535f(0xcd)]),_0x17a430=_0x3d558c['filter'](_0x52d979=>_0x52d979[_0x1a535f(0xa6)]('.log')),_0x25dff4=[...new Set(_0x17a430[_0x1a535f(0x99)](_0x245318=>_0x245318[_0x1a535f(0xab)]('_')[0x0]))],_0x5cb053=_0x17a430[_0x1a535f(0x99)](_0x53076f=>{const _0x35058e=_0x1a535f,_0x1e2e34=path_1[_0x35058e(0xd5)][_0x35058e(0xa5)](this['logsDir'],_0x53076f),_0x1b5909=fs_1[_0x35058e(0xd5)][_0x35058e(0xbd)](_0x1e2e34),[_0x4233be,_0xa959a0]=_0x53076f[_0x35058e(0xaa)]('.log','')[_0x35058e(0xab)]('_');return{'type':_0x4233be,'date':_0xa959a0,'size':_0x1b5909[_0x35058e(0xb3)]};})[_0x1a535f(0xcf)]((_0x4f8e5a,_0x18988e)=>_0x18988e['date'][_0x1a535f(0xd2)](_0x4f8e5a[_0x1a535f(0xbe)]));return{'totalFiles':_0x17a430[_0x1a535f(0xb7)],'logTypes':_0x25dff4,'latestLogs':_0x5cb053[_0x1a535f(0x9f)](0x0,0xa)};}catch(_0x59e9a0){return console[_0x1a535f(0x8a)](_0x1a535f(0xd4),_0x59e9a0),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x47c822=0x1e){const _0x42eb4f=a47_0x494254;try{const _0x477b3b=fs_1[_0x42eb4f(0xd5)][_0x42eb4f(0xd0)](this[_0x42eb4f(0xcd)]),_0xdecae5=new Date();_0xdecae5[_0x42eb4f(0xca)](_0xdecae5['getDate']()-_0x47c822);let _0x3b7d6d=0x0;_0x477b3b[_0x42eb4f(0xda)](_0xc9c550=>{const _0x36ebd8=_0x42eb4f;if(!_0xc9c550[_0x36ebd8(0xa6)](_0x36ebd8(0xa2)))return;const _0x13fd4f=path_1[_0x36ebd8(0xd5)][_0x36ebd8(0xa5)](this['logsDir'],_0xc9c550),_0x4fc28a=fs_1['default'][_0x36ebd8(0xbd)](_0x13fd4f);_0x4fc28a[_0x36ebd8(0xb2)]<_0xdecae5&&(fs_1[_0x36ebd8(0xd5)]['unlinkSync'](_0x13fd4f),_0x3b7d6d++,console[_0x36ebd8(0xc9)](_0x36ebd8(0x9b)+_0xc9c550));}),console['log'](_0x42eb4f(0xa4)+_0x3b7d6d+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x47c822+_0x42eb4f(0x9e));}catch(_0x40cf16){console[_0x42eb4f(0x8a)](_0x42eb4f(0x97),_0x40cf16);}}}function a47_0x5208(){const _0x4408c2=['\x20log:','804jyOWUc','COINTOPAY_STATUS_CHANGE','error','cwd','getLogFileName','Failed\x20to\x20write\x20','logCoinToPayStatus','SHOP_WEBHOOK_ERROR','webhooks_received','REQUEST','545Zcwbot','white_domain_responses','defineProperty','stringify','LoggerService','Failed\x20to\x20clean\x20old\x20logs:','loggerService','map','writeLog','🗑️\x20Deleted\x20old\x20log\x20file:\x20','507298NTkNlf','9lCAIyr','\x20days)','slice','logApiCall','1373832axDYtJ','.log','webhooks_processed','🧹\x20Cleaned\x20','join','endsWith','path','message','183443xYabAj','replace','split','logWhiteDomainResponse','1SttwFB','utf8','📁\x20Created\x20logs\x20directory:\x20','existsSync','white_domain_requests','mtime','size','getLogStats','ensureLogsDirectory','toISOString','length','ERROR','PAYMENT_CREATED','WEBHOOK_RECEIVED','shop_webhooks_errors','14934HhRgpm','statSync','date','cointopay_status_changes','API_CALL','white_domain_errors','WEBHOOK_ERROR','logWebhookError','40nmNgMJ','COINTOPAY_ERROR','18117UFOfOz','appendFileSync','api_calls','log','setDate','12ZhsSPB','__importDefault','logsDir','logPaymentCreated','sort','readdirSync','1781066NACSOW','localeCompare','logs','Failed\x20to\x20get\x20log\x20stats:','default','cointopay_errors','logWhiteDomainError','stack','SHOP_WEBHOOK_SENT','forEach','logWebhookReceived','__esModule','500511RqSbiK'];a47_0x5208=function(){return _0x4408c2;};return a47_0x5208();}exports[a47_0x494254(0x96)]=LoggerService,exports['loggerService']=new LoggerService();