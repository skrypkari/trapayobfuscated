'use strict';const a56_0x2d77d9=a56_0x57d8;(function(_0x24d118,_0x1045b9){const _0x169478=a56_0x57d8,_0x2cabc1=_0x24d118();while(!![]){try{const _0x206fed=parseInt(_0x169478(0xf0))/0x1*(-parseInt(_0x169478(0x117))/0x2)+-parseInt(_0x169478(0x13c))/0x3+parseInt(_0x169478(0x105))/0x4+-parseInt(_0x169478(0x12c))/0x5+parseInt(_0x169478(0x140))/0x6*(parseInt(_0x169478(0x10a))/0x7)+-parseInt(_0x169478(0x12f))/0x8*(-parseInt(_0x169478(0x13b))/0x9)+parseInt(_0x169478(0x104))/0xa;if(_0x206fed===_0x1045b9)break;else _0x2cabc1['push'](_0x2cabc1['shift']());}catch(_0x51038d){_0x2cabc1['push'](_0x2cabc1['shift']());}}}(a56_0x171b,0xb019a));var __importDefault=this&&this[a56_0x2d77d9(0xf6)]||function(_0x403173){const _0x245595=a56_0x2d77d9;return _0x403173&&_0x403173[_0x245595(0x12b)]?_0x403173:{'default':_0x403173};};Object[a56_0x2d77d9(0x11a)](exports,a56_0x2d77d9(0x12b),{'value':!![]}),exports[a56_0x2d77d9(0x102)]=exports[a56_0x2d77d9(0x114)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a56_0x2d77d9(0xf2)));function a56_0x171b(){const _0x247bf5=['defineProperty','COINTOPAY_STATUS_CHANGE','toISOString','writeLog','readdirSync','filter','getLogFileName','default','slice','date','getLogStats','appendFileSync','stack','logWhiteDomainRequest','🧹\x20Cleaned\x20','cointopay_errors','Failed\x20to\x20write\x20','__esModule','3080140BiElXF','api_calls','logWhiteDomainResponse','8gVvYqv','unlinkSync','map','WEBHOOK_PROCESSED','webhooks_received','message','white_domain_requests','utf8','webhooks_errors','error','SHOP_WEBHOOK_ERROR','stringify','8051688KncsPV','3362202yXiGBv','setDate','getDate','\x20log:','6vGZHKD','.log','forEach','sort','log','9461IPRYax','Failed\x20to\x20clean\x20old\x20logs:','path','webhooks_processed','logWebhookReceived','logPaymentCreated','__importDefault','join','REQUEST','logShopWebhookError','logCoinToPayError','WEBHOOK_ERROR','cleanOldLogs','localeCompare','logCoinToPayStatus','RESPONSE','SHOP_WEBHOOK_SENT','mtime','loggerService','WEBHOOK_RECEIVED','5012490LURRjZ','2354280rWWcLY','existsSync','endsWith','split','logsDir','4772313jTZmUJ','Failed\x20to\x20get\x20log\x20stats:','API_CALL','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logWebhookProcessed','statSync','cointopay_status_changes','ensureLogsDirectory','shop_webhooks_sent','\x20days)','LoggerService','logShopWebhookSent','logWhiteDomainError','44GWhCbe','COINTOPAY_ERROR','replace'];a56_0x171b=function(){return _0x247bf5;};return a56_0x171b();}function a56_0x57d8(_0x4e9c1b,_0x5a9c07){const _0x171bac=a56_0x171b();return a56_0x57d8=function(_0x57d80d,_0xf4574){_0x57d80d=_0x57d80d-0xed;let _0x56f028=_0x171bac[_0x57d80d];return _0x56f028;},a56_0x57d8(_0x4e9c1b,_0x5a9c07);}class LoggerService{constructor(){const _0x55f882=a56_0x2d77d9;this[_0x55f882(0x109)]=path_1[_0x55f882(0x121)]['join'](process['cwd'](),'logs'),this[_0x55f882(0x111)]();}[a56_0x2d77d9(0x111)](){const _0x5a722b=a56_0x2d77d9;!fs_1[_0x5a722b(0x121)][_0x5a722b(0x106)](this['logsDir'])&&(fs_1['default']['mkdirSync'](this[_0x5a722b(0x109)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a56_0x2d77d9(0x120)](_0x516ffb){const _0x28bafd=a56_0x2d77d9,_0x2b14ca=new Date()['toISOString']()[_0x28bafd(0x108)]('T')[0x0];return path_1[_0x28bafd(0x121)][_0x28bafd(0xf7)](this[_0x28bafd(0x109)],_0x516ffb+'_'+_0x2b14ca+'.log');}[a56_0x2d77d9(0x11d)](_0x5f3f03,_0x5c3088){const _0x4bca7a=a56_0x2d77d9;try{const _0x469e20=new Date()[_0x4bca7a(0x11c)](),_0xbd4eec={'timestamp':_0x469e20,..._0x5c3088},_0x1dff17=JSON[_0x4bca7a(0x13a)](_0xbd4eec)+'\x0a',_0xeab909=this[_0x4bca7a(0x120)](_0x5f3f03);fs_1[_0x4bca7a(0x121)][_0x4bca7a(0x125)](_0xeab909,_0x1dff17,_0x4bca7a(0x136));}catch(_0x1dc9d7){console[_0x4bca7a(0x138)](_0x4bca7a(0x12a)+_0x5f3f03+_0x4bca7a(0x13f),_0x1dc9d7);}}[a56_0x2d77d9(0x127)](_0x441ce6,_0x10fdf1,_0x1a9c0e,_0x2c5dd7){const _0x9007a2=a56_0x2d77d9;this[_0x9007a2(0x11d)](_0x9007a2(0x135),{'type':_0x9007a2(0xf8),'gateway':_0x441ce6,'endpoint':_0x10fdf1,'method':_0x1a9c0e,'data':_0x2c5dd7});}[a56_0x2d77d9(0x12e)](_0x41538b,_0x203c05,_0x2a6b55,_0x257d8e,_0x346d0b){const _0x509d26=a56_0x2d77d9;this[_0x509d26(0x11d)]('white_domain_responses',{'type':_0x509d26(0xff),'gateway':_0x41538b,'endpoint':_0x203c05,'status':_0x2a6b55,'responseTime':_0x346d0b,'data':_0x257d8e});}[a56_0x2d77d9(0x116)](_0x81482a,_0x20a96e,_0x20147b){const _0x5d4536=a56_0x2d77d9;this[_0x5d4536(0x11d)]('white_domain_errors',{'type':'ERROR','gateway':_0x81482a,'endpoint':_0x20a96e,'error':_0x20147b instanceof Error?{'message':_0x20147b[_0x5d4536(0x134)],'stack':_0x20147b['stack']}:_0x20147b});}[a56_0x2d77d9(0xf4)](_0x3bfb2f,_0x5920b6,_0x3dfecd){const _0x25dd8e=a56_0x2d77d9;this[_0x25dd8e(0x11d)](_0x25dd8e(0x133),{'type':_0x25dd8e(0x103),'gateway':_0x3bfb2f,'headers':_0x3dfecd,'data':_0x5920b6});}[a56_0x2d77d9(0x10e)](_0x1c628e,_0x49922d,_0x192c7c,_0x291928,_0x57b642){const _0x393f6e=a56_0x2d77d9;this['writeLog'](_0x393f6e(0xf3),{'type':_0x393f6e(0x132),'gateway':_0x1c628e,'paymentId':_0x49922d,'oldStatus':_0x192c7c,'newStatus':_0x291928,'originalData':_0x57b642});}['logWebhookError'](_0x3fb36c,_0x51a9cd,_0x45dc22){const _0x477b49=a56_0x2d77d9;this['writeLog'](_0x477b49(0x137),{'type':_0x477b49(0xfb),'gateway':_0x3fb36c,'error':_0x51a9cd instanceof Error?{'message':_0x51a9cd['message'],'stack':_0x51a9cd[_0x477b49(0x126)]}:_0x51a9cd,'originalData':_0x45dc22});}[a56_0x2d77d9(0xfe)](_0x72a18c){const _0xd986be=a56_0x2d77d9;this[_0xd986be(0x11d)](_0xd986be(0x110),{'type':_0xd986be(0x11b),..._0x72a18c});}[a56_0x2d77d9(0xfa)](_0x5a2a53){const _0x3ecd62=a56_0x2d77d9;this[_0x3ecd62(0x11d)](_0x3ecd62(0x129),{'type':_0x3ecd62(0x118),..._0x5a2a53});}[a56_0x2d77d9(0x115)](_0x54503a,_0x4bd6f3,_0x3ccf48,_0x552c77,_0x11f947,_0x25d711){const _0x19ea90=a56_0x2d77d9;this[_0x19ea90(0x11d)](_0x19ea90(0x112),{'type':_0x19ea90(0x100),'shopId':_0x54503a,'webhookUrl':_0x4bd6f3,'event':_0x3ccf48,'status':_0x552c77,'responseTime':_0x11f947,'payload':_0x25d711});}[a56_0x2d77d9(0xf9)](_0x1d2f05,_0x23f8b0,_0x22e912,_0x4d99df,_0x3fc702){const _0x42f04d=a56_0x2d77d9;this[_0x42f04d(0x11d)]('shop_webhooks_errors',{'type':_0x42f04d(0x139),'shopId':_0x1d2f05,'webhookUrl':_0x23f8b0,'event':_0x22e912,'error':_0x4d99df instanceof Error?{'message':_0x4d99df[_0x42f04d(0x134)],'stack':_0x4d99df['stack']}:_0x4d99df,'payload':_0x3fc702});}[a56_0x2d77d9(0xf5)](_0x2e9595,_0x45b06e,_0x284ef5,_0x339f82,_0x58da59){const _0x184b27=a56_0x2d77d9;this[_0x184b27(0x11d)]('payments_created',{'type':'PAYMENT_CREATED','gateway':_0x2e9595,'paymentId':_0x45b06e,'shopId':_0x284ef5,'amount':_0x339f82,'currency':_0x58da59});}['logApiCall'](_0x1fcff7,_0x3215e6,_0x571618,_0x1ccf40,_0x5d4b83){const _0x295b0e=a56_0x2d77d9;this[_0x295b0e(0x11d)](_0x295b0e(0x12d),{'type':_0x295b0e(0x10c),'endpoint':_0x1fcff7,'method':_0x3215e6,'userId':_0x571618,'userRole':_0x1ccf40,'requestData':_0x5d4b83});}[a56_0x2d77d9(0x124)](){const _0x2e0b83=a56_0x2d77d9;try{const _0x478807=fs_1[_0x2e0b83(0x121)]['readdirSync'](this[_0x2e0b83(0x109)]),_0x5dbca0=_0x478807[_0x2e0b83(0x11f)](_0x390502=>_0x390502['endsWith'](_0x2e0b83(0x141))),_0x194e46=[...new Set(_0x5dbca0[_0x2e0b83(0x131)](_0x52c81a=>_0x52c81a['split']('_')[0x0]))],_0x3c6703=_0x5dbca0[_0x2e0b83(0x131)](_0x309cdb=>{const _0x71862b=_0x2e0b83,_0x56db63=path_1['default'][_0x71862b(0xf7)](this[_0x71862b(0x109)],_0x309cdb),_0x31e0bb=fs_1['default'][_0x71862b(0x10f)](_0x56db63),[_0x570220,_0xca865]=_0x309cdb[_0x71862b(0x119)]('.log','')[_0x71862b(0x108)]('_');return{'type':_0x570220,'date':_0xca865,'size':_0x31e0bb['size']};})[_0x2e0b83(0xee)]((_0x964b85,_0x136fdc)=>_0x136fdc['date'][_0x2e0b83(0xfd)](_0x964b85[_0x2e0b83(0x123)]));return{'totalFiles':_0x5dbca0['length'],'logTypes':_0x194e46,'latestLogs':_0x3c6703[_0x2e0b83(0x122)](0x0,0xa)};}catch(_0x446383){return console[_0x2e0b83(0x138)](_0x2e0b83(0x10b),_0x446383),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a56_0x2d77d9(0xfc)](_0x4126f7=0x1e){const _0x37329e=a56_0x2d77d9;try{const _0x5459cb=fs_1[_0x37329e(0x121)][_0x37329e(0x11e)](this[_0x37329e(0x109)]),_0x1fac6a=new Date();_0x1fac6a[_0x37329e(0x13d)](_0x1fac6a[_0x37329e(0x13e)]()-_0x4126f7);let _0x46c08b=0x0;_0x5459cb[_0x37329e(0xed)](_0x123335=>{const _0x5f5370=_0x37329e;if(!_0x123335[_0x5f5370(0x107)](_0x5f5370(0x141)))return;const _0x3a3f44=path_1[_0x5f5370(0x121)][_0x5f5370(0xf7)](this['logsDir'],_0x123335),_0x209db0=fs_1[_0x5f5370(0x121)]['statSync'](_0x3a3f44);_0x209db0[_0x5f5370(0x101)]<_0x1fac6a&&(fs_1[_0x5f5370(0x121)][_0x5f5370(0x130)](_0x3a3f44),_0x46c08b++,console[_0x5f5370(0xef)](_0x5f5370(0x10d)+_0x123335));}),console[_0x37329e(0xef)](_0x37329e(0x128)+_0x46c08b+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x4126f7+_0x37329e(0x113));}catch(_0x3cd54c){console[_0x37329e(0x138)](_0x37329e(0xf1),_0x3cd54c);}}}exports[a56_0x2d77d9(0x114)]=LoggerService,exports[a56_0x2d77d9(0x102)]=new LoggerService();