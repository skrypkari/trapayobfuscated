'use strict';function a51_0x3e78(_0x4bece4,_0x1505d9){const _0x4f4528=a51_0x4f45();return a51_0x3e78=function(_0x3e788b,_0x408233){_0x3e788b=_0x3e788b-0x171;let _0x3bc464=_0x4f4528[_0x3e788b];return _0x3bc464;},a51_0x3e78(_0x4bece4,_0x1505d9);}const a51_0x192859=a51_0x3e78;function a51_0x4f45(){const _0x1295e3=['🧹\x20Cleaned\x20','join','replace','logShopWebhookSent','writeLog','split','webhooks_errors','stringify','default','logWhiteDomainError','message','path','utf8','LoggerService','toISOString','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logWebhookError','COINTOPAY_STATUS_CHANGE','logs','white_domain_errors','__esModule','mtime','Failed\x20to\x20write\x20','statSync','error','endsWith','shop_webhooks_sent','4CQyhZq','stack','SHOP_WEBHOOK_SENT','webhooks_received','📁\x20Created\x20logs\x20directory:\x20','cointopay_errors','30GNddne','setDate','WEBHOOK_ERROR','10xkAthn','log','261543NQBujV','cleanOldLogs','payments_created','logWhiteDomainRequest','RESPONSE','404803RaFRiZ','localeCompare','452062PdtMnx','REQUEST','unlinkSync','filter','37870iJKjxZ','loggerService','cointopay_status_changes','date','logShopWebhookError','24SgXmHd','24brmdqV','getLogStats','.log','\x20old\x20log\x20files\x20(older\x20than\x20','89577JxxpLx','454289gMzWei','logCoinToPayError','logsDir','getLogFileName','logPaymentCreated','sort','232962acCPff','defineProperty','forEach','white_domain_responses','logWhiteDomainResponse','5PryScZ','ensureLogsDirectory','existsSync','Failed\x20to\x20clean\x20old\x20logs:','webhooks_processed','182zhotti','\x20days)','slice','ERROR','API_CALL','length','__importDefault'];a51_0x4f45=function(){return _0x1295e3;};return a51_0x4f45();}(function(_0x3c9f0b,_0x3b8d46){const _0x309c7f=a51_0x3e78,_0x551fdc=_0x3c9f0b();while(!![]){try{const _0x669f3b=-parseInt(_0x309c7f(0x1be))/0x1*(-parseInt(_0x309c7f(0x178))/0x2)+parseInt(_0x309c7f(0x1c0))/0x3*(parseInt(_0x309c7f(0x1b5))/0x4)+-parseInt(_0x309c7f(0x18e))/0x5*(-parseInt(_0x309c7f(0x189))/0x6)+-parseInt(_0x309c7f(0x172))/0x7*(-parseInt(_0x309c7f(0x17e))/0x8)+-parseInt(_0x309c7f(0x182))/0x9*(-parseInt(_0x309c7f(0x1bb))/0xa)+-parseInt(_0x309c7f(0x183))/0xb*(-parseInt(_0x309c7f(0x17d))/0xc)+parseInt(_0x309c7f(0x174))/0xd*(-parseInt(_0x309c7f(0x193))/0xe);if(_0x669f3b===_0x3b8d46)break;else _0x551fdc['push'](_0x551fdc['shift']());}catch(_0x29faf8){_0x551fdc['push'](_0x551fdc['shift']());}}}(a51_0x4f45,0x246f8));var __importDefault=this&&this[a51_0x192859(0x199)]||function(_0x5a0db4){const _0x313884=a51_0x192859;return _0x5a0db4&&_0x5a0db4[_0x313884(0x1ae)]?_0x5a0db4:{'default':_0x5a0db4};};Object[a51_0x192859(0x18a)](exports,a51_0x192859(0x1ae),{'value':!![]}),exports[a51_0x192859(0x179)]=exports[a51_0x192859(0x1a7)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x192859(0x1a5)));class LoggerService{constructor(){const _0x463543=a51_0x192859;this[_0x463543(0x185)]=path_1[_0x463543(0x1a2)][_0x463543(0x19b)](process['cwd'](),_0x463543(0x1ac)),this['ensureLogsDirectory']();}[a51_0x192859(0x18f)](){const _0x53637c=a51_0x192859;!fs_1[_0x53637c(0x1a2)][_0x53637c(0x190)](this['logsDir'])&&(fs_1[_0x53637c(0x1a2)]['mkdirSync'](this[_0x53637c(0x185)],{'recursive':!![]}),console[_0x53637c(0x1bf)](_0x53637c(0x1b9)+this[_0x53637c(0x185)]));}[a51_0x192859(0x186)](_0xb17a22){const _0x346aa5=a51_0x192859,_0xb9d0d1=new Date()[_0x346aa5(0x1a8)]()['split']('T')[0x0];return path_1[_0x346aa5(0x1a2)]['join'](this[_0x346aa5(0x185)],_0xb17a22+'_'+_0xb9d0d1+'.log');}[a51_0x192859(0x19e)](_0x3379dd,_0x10e3ab){const _0x1754f1=a51_0x192859;try{const _0x2e9594=new Date()['toISOString'](),_0x21c96a={'timestamp':_0x2e9594,..._0x10e3ab},_0x2d6b41=JSON[_0x1754f1(0x1a1)](_0x21c96a)+'\x0a',_0x3d8b18=this['getLogFileName'](_0x3379dd);fs_1[_0x1754f1(0x1a2)]['appendFileSync'](_0x3d8b18,_0x2d6b41,_0x1754f1(0x1a6));}catch(_0x1434fa){console['error'](_0x1754f1(0x1b0)+_0x3379dd+'\x20log:',_0x1434fa);}}[a51_0x192859(0x1c3)](_0x54fde0,_0x559634,_0x569f8d,_0x3adf06){const _0x55beb1=a51_0x192859;this[_0x55beb1(0x19e)]('white_domain_requests',{'type':_0x55beb1(0x175),'gateway':_0x54fde0,'endpoint':_0x559634,'method':_0x569f8d,'data':_0x3adf06});}[a51_0x192859(0x18d)](_0x412b9f,_0x5b820f,_0x40186b,_0x3227c1,_0x1216f2){const _0x576af4=a51_0x192859;this[_0x576af4(0x19e)](_0x576af4(0x18c),{'type':_0x576af4(0x171),'gateway':_0x412b9f,'endpoint':_0x5b820f,'status':_0x40186b,'responseTime':_0x1216f2,'data':_0x3227c1});}[a51_0x192859(0x1a3)](_0x471615,_0x17477a,_0x5b9b03){const _0x3c6ce7=a51_0x192859;this[_0x3c6ce7(0x19e)](_0x3c6ce7(0x1ad),{'type':_0x3c6ce7(0x196),'gateway':_0x471615,'endpoint':_0x17477a,'error':_0x5b9b03 instanceof Error?{'message':_0x5b9b03[_0x3c6ce7(0x1a4)],'stack':_0x5b9b03['stack']}:_0x5b9b03});}['logWebhookReceived'](_0x31d613,_0x27ac6c,_0x530417){const _0x3b186a=a51_0x192859;this[_0x3b186a(0x19e)](_0x3b186a(0x1b8),{'type':'WEBHOOK_RECEIVED','gateway':_0x31d613,'headers':_0x530417,'data':_0x27ac6c});}['logWebhookProcessed'](_0x20babb,_0x6836f0,_0x94488b,_0x2fe5e2,_0x4e75b7){const _0x520b55=a51_0x192859;this[_0x520b55(0x19e)](_0x520b55(0x192),{'type':'WEBHOOK_PROCESSED','gateway':_0x20babb,'paymentId':_0x6836f0,'oldStatus':_0x94488b,'newStatus':_0x2fe5e2,'originalData':_0x4e75b7});}[a51_0x192859(0x1aa)](_0x5b7394,_0xa1b2fd,_0x3fb1a6){const _0x2af302=a51_0x192859;this[_0x2af302(0x19e)](_0x2af302(0x1a0),{'type':_0x2af302(0x1bd),'gateway':_0x5b7394,'error':_0xa1b2fd instanceof Error?{'message':_0xa1b2fd['message'],'stack':_0xa1b2fd[_0x2af302(0x1b6)]}:_0xa1b2fd,'originalData':_0x3fb1a6});}['logCoinToPayStatus'](_0x1b4d45){const _0x57b405=a51_0x192859;this[_0x57b405(0x19e)](_0x57b405(0x17a),{'type':_0x57b405(0x1ab),..._0x1b4d45});}[a51_0x192859(0x184)](_0x445027){const _0x2c070e=a51_0x192859;this['writeLog'](_0x2c070e(0x1ba),{'type':'COINTOPAY_ERROR',..._0x445027});}[a51_0x192859(0x19d)](_0x53a3b5,_0x18d6c4,_0x2a88e5,_0x1591e3,_0x24bc78,_0x7fc402){const _0x1d844b=a51_0x192859;this[_0x1d844b(0x19e)](_0x1d844b(0x1b4),{'type':_0x1d844b(0x1b7),'shopId':_0x53a3b5,'webhookUrl':_0x18d6c4,'event':_0x2a88e5,'status':_0x1591e3,'responseTime':_0x24bc78,'payload':_0x7fc402});}[a51_0x192859(0x17c)](_0xd1ec11,_0x2ddb1d,_0x5751c5,_0x5693f8,_0x335091){const _0x6b78f2=a51_0x192859;this['writeLog']('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0xd1ec11,'webhookUrl':_0x2ddb1d,'event':_0x5751c5,'error':_0x5693f8 instanceof Error?{'message':_0x5693f8['message'],'stack':_0x5693f8[_0x6b78f2(0x1b6)]}:_0x5693f8,'payload':_0x335091});}[a51_0x192859(0x187)](_0x57ac5e,_0x56685e,_0x3a7f7d,_0x43c8ed,_0xd04a21){const _0x241d7a=a51_0x192859;this['writeLog'](_0x241d7a(0x1c2),{'type':'PAYMENT_CREATED','gateway':_0x57ac5e,'paymentId':_0x56685e,'shopId':_0x3a7f7d,'amount':_0x43c8ed,'currency':_0xd04a21});}['logApiCall'](_0x1034b2,_0x57195d,_0x574db7,_0x1d75e5,_0x35e56f){const _0x4958d9=a51_0x192859;this[_0x4958d9(0x19e)]('api_calls',{'type':_0x4958d9(0x197),'endpoint':_0x1034b2,'method':_0x57195d,'userId':_0x574db7,'userRole':_0x1d75e5,'requestData':_0x35e56f});}[a51_0x192859(0x17f)](){const _0x5e901e=a51_0x192859;try{const _0x4478f8=fs_1[_0x5e901e(0x1a2)]['readdirSync'](this[_0x5e901e(0x185)]),_0x308591=_0x4478f8[_0x5e901e(0x177)](_0xbcedf8=>_0xbcedf8['endsWith'](_0x5e901e(0x180))),_0x8e385b=[...new Set(_0x308591['map'](_0x8f972b=>_0x8f972b[_0x5e901e(0x19f)]('_')[0x0]))],_0x5b21cb=_0x308591['map'](_0x4261c5=>{const _0x197884=_0x5e901e,_0x347f92=path_1[_0x197884(0x1a2)]['join'](this[_0x197884(0x185)],_0x4261c5),_0x52c6a4=fs_1['default'][_0x197884(0x1b1)](_0x347f92),[_0x505571,_0x2d99f4]=_0x4261c5[_0x197884(0x19c)](_0x197884(0x180),'')[_0x197884(0x19f)]('_');return{'type':_0x505571,'date':_0x2d99f4,'size':_0x52c6a4['size']};})[_0x5e901e(0x188)]((_0x59859a,_0x5814dc)=>_0x5814dc[_0x5e901e(0x17b)][_0x5e901e(0x173)](_0x59859a[_0x5e901e(0x17b)]));return{'totalFiles':_0x308591[_0x5e901e(0x198)],'logTypes':_0x8e385b,'latestLogs':_0x5b21cb[_0x5e901e(0x195)](0x0,0xa)};}catch(_0x5c1037){return console[_0x5e901e(0x1b2)]('Failed\x20to\x20get\x20log\x20stats:',_0x5c1037),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x192859(0x1c1)](_0xb9be8c=0x1e){const _0x3f4a7c=a51_0x192859;try{const _0x4b007f=fs_1[_0x3f4a7c(0x1a2)]['readdirSync'](this[_0x3f4a7c(0x185)]),_0x55860e=new Date();_0x55860e[_0x3f4a7c(0x1bc)](_0x55860e['getDate']()-_0xb9be8c);let _0x5d635f=0x0;_0x4b007f[_0x3f4a7c(0x18b)](_0x30be4b=>{const _0x2d8ca3=_0x3f4a7c;if(!_0x30be4b[_0x2d8ca3(0x1b3)](_0x2d8ca3(0x180)))return;const _0x34c59c=path_1['default'][_0x2d8ca3(0x19b)](this[_0x2d8ca3(0x185)],_0x30be4b),_0xbe186c=fs_1[_0x2d8ca3(0x1a2)]['statSync'](_0x34c59c);_0xbe186c[_0x2d8ca3(0x1af)]<_0x55860e&&(fs_1[_0x2d8ca3(0x1a2)][_0x2d8ca3(0x176)](_0x34c59c),_0x5d635f++,console[_0x2d8ca3(0x1bf)](_0x2d8ca3(0x1a9)+_0x30be4b));}),console[_0x3f4a7c(0x1bf)](_0x3f4a7c(0x19a)+_0x5d635f+_0x3f4a7c(0x181)+_0xb9be8c+_0x3f4a7c(0x194));}catch(_0x5704d7){console[_0x3f4a7c(0x1b2)](_0x3f4a7c(0x191),_0x5704d7);}}}exports['LoggerService']=LoggerService,exports[a51_0x192859(0x179)]=new LoggerService();