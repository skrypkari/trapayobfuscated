'use strict';const a48_0x2b98f1=a48_0x1d0f;(function(_0x424940,_0xacbaa8){const _0x28fb69=a48_0x1d0f,_0x1aef92=_0x424940();while(!![]){try{const _0x2559c4=parseInt(_0x28fb69(0x16f))/0x1*(-parseInt(_0x28fb69(0x184))/0x2)+parseInt(_0x28fb69(0x199))/0x3+-parseInt(_0x28fb69(0x159))/0x4+parseInt(_0x28fb69(0x18d))/0x5*(parseInt(_0x28fb69(0x186))/0x6)+parseInt(_0x28fb69(0x158))/0x7*(-parseInt(_0x28fb69(0x18a))/0x8)+-parseInt(_0x28fb69(0x154))/0x9+-parseInt(_0x28fb69(0x176))/0xa*(-parseInt(_0x28fb69(0x190))/0xb);if(_0x2559c4===_0xacbaa8)break;else _0x1aef92['push'](_0x1aef92['shift']());}catch(_0x139924){_0x1aef92['push'](_0x1aef92['shift']());}}}(a48_0x313e,0x3da0f));function a48_0x1d0f(_0x1731d8,_0x2113aa){const _0x313eb1=a48_0x313e();return a48_0x1d0f=function(_0x1d0f98,_0x31a55c){_0x1d0f98=_0x1d0f98-0x14b;let _0x23f48c=_0x313eb1[_0x1d0f98];return _0x23f48c;},a48_0x1d0f(_0x1731d8,_0x2113aa);}var __importDefault=this&&this['__importDefault']||function(_0x1f70ee){const _0x554aef=a48_0x1d0f;return _0x1f70ee&&_0x1f70ee[_0x554aef(0x16c)]?_0x1f70ee:{'default':_0x1f70ee};};function a48_0x313e(){const _0xb22a57=['toISOString','logCoinToPayStatus','24FoadlZ','default','readdirSync','251580eMZQWZ','COINTOPAY_STATUS_CHANGE','COINTOPAY_ERROR','8919471VsamcR','logs','shop_webhooks_errors','slice','localeCompare','logApiCall','logWhiteDomainRequest','logWebhookReceived','logPaymentCreated','622827tTKWml','webhooks_received','join','ensureLogsDirectory','utf8','ERROR','size','statSync','cwd','white_domain_requests','cointopay_status_changes','loggerService','appendFileSync','writeLog','sort','.log','2528586KxXoPn','logCoinToPayError','logShopWebhookSent','PAYMENT_CREATED','966357eHlAqK','1923944Tyfzfh','📁\x20Created\x20logs\x20directory:\x20','cleanOldLogs','api_calls','stack','date','shop_webhooks_sent','webhooks_processed','RESPONSE','REQUEST','mtime','WEBHOOK_RECEIVED','map','replace','logWebhookProcessed','white_domain_responses','logWebhookError','getLogStats','\x20old\x20log\x20files\x20(older\x20than\x20','__esModule','split','🗑️\x20Deleted\x20old\x20log\x20file:\x20','41CmQbez','\x20days)','length','webhooks_errors','log','message','SHOP_WEBHOOK_SENT','20ZSaoBA','getLogFileName','forEach','payments_created','unlinkSync','error','WEBHOOK_ERROR','white_domain_errors','getDate','defineProperty','mkdirSync','logsDir','path','endsWith','22006UYLTGX','🧹\x20Cleaned\x20','6xpPYsR','cointopay_errors'];a48_0x313e=function(){return _0xb22a57;};return a48_0x313e();}Object[a48_0x2b98f1(0x17f)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x2b98f1(0x182)));class LoggerService{constructor(){const _0x281e38=a48_0x2b98f1;this[_0x281e38(0x181)]=path_1['default'][_0x281e38(0x19b)](process[_0x281e38(0x14c)](),_0x281e38(0x191)),this[_0x281e38(0x19c)]();}[a48_0x2b98f1(0x19c)](){const _0x548c47=a48_0x2b98f1;!fs_1[_0x548c47(0x18b)]['existsSync'](this[_0x548c47(0x181)])&&(fs_1[_0x548c47(0x18b)][_0x548c47(0x180)](this[_0x548c47(0x181)],{'recursive':!![]}),console['log'](_0x548c47(0x15a)+this['logsDir']));}[a48_0x2b98f1(0x177)](_0x2d49a4){const _0x7950e0=a48_0x2b98f1,_0x595224=new Date()[_0x7950e0(0x188)]()[_0x7950e0(0x16d)]('T')[0x0];return path_1[_0x7950e0(0x18b)][_0x7950e0(0x19b)](this[_0x7950e0(0x181)],_0x2d49a4+'_'+_0x595224+_0x7950e0(0x153));}[a48_0x2b98f1(0x151)](_0x51d7f1,_0x2a1421){const _0x170311=a48_0x2b98f1;try{const _0xaacbe=new Date()[_0x170311(0x188)](),_0x5cad75={'timestamp':_0xaacbe,..._0x2a1421},_0x48948a=JSON['stringify'](_0x5cad75)+'\x0a',_0x117b8c=this[_0x170311(0x177)](_0x51d7f1);fs_1['default'][_0x170311(0x150)](_0x117b8c,_0x48948a,_0x170311(0x19d));}catch(_0x122b13){console[_0x170311(0x17b)]('Failed\x20to\x20write\x20'+_0x51d7f1+'\x20log:',_0x122b13);}}[a48_0x2b98f1(0x196)](_0xa6d28b,_0x2c6f87,_0x1f5523,_0x80c7b3){const _0x9ac828=a48_0x2b98f1;this[_0x9ac828(0x151)](_0x9ac828(0x14d),{'type':_0x9ac828(0x162),'gateway':_0xa6d28b,'endpoint':_0x2c6f87,'method':_0x1f5523,'data':_0x80c7b3});}['logWhiteDomainResponse'](_0x16b85a,_0x5ab991,_0x2cd41d,_0x210bf1,_0x1aa017){const _0x4216cb=a48_0x2b98f1;this[_0x4216cb(0x151)](_0x4216cb(0x168),{'type':_0x4216cb(0x161),'gateway':_0x16b85a,'endpoint':_0x5ab991,'status':_0x2cd41d,'responseTime':_0x1aa017,'data':_0x210bf1});}['logWhiteDomainError'](_0x225c14,_0x17aa8d,_0x5299c9){const _0x22fb82=a48_0x2b98f1;this[_0x22fb82(0x151)](_0x22fb82(0x17d),{'type':_0x22fb82(0x19e),'gateway':_0x225c14,'endpoint':_0x17aa8d,'error':_0x5299c9 instanceof Error?{'message':_0x5299c9[_0x22fb82(0x174)],'stack':_0x5299c9[_0x22fb82(0x15d)]}:_0x5299c9});}[a48_0x2b98f1(0x197)](_0x223d5a,_0x4e0dae,_0x3fb053){const _0x4df810=a48_0x2b98f1;this['writeLog'](_0x4df810(0x19a),{'type':_0x4df810(0x164),'gateway':_0x223d5a,'headers':_0x3fb053,'data':_0x4e0dae});}[a48_0x2b98f1(0x167)](_0x1a7d8,_0x7df894,_0x4ac4a3,_0x286dbb,_0x3b4083){const _0x5db501=a48_0x2b98f1;this[_0x5db501(0x151)](_0x5db501(0x160),{'type':'WEBHOOK_PROCESSED','gateway':_0x1a7d8,'paymentId':_0x7df894,'oldStatus':_0x4ac4a3,'newStatus':_0x286dbb,'originalData':_0x3b4083});}[a48_0x2b98f1(0x169)](_0x20094f,_0x50fd77,_0x4d1127){const _0x688f8e=a48_0x2b98f1;this['writeLog'](_0x688f8e(0x172),{'type':_0x688f8e(0x17c),'gateway':_0x20094f,'error':_0x50fd77 instanceof Error?{'message':_0x50fd77['message'],'stack':_0x50fd77['stack']}:_0x50fd77,'originalData':_0x4d1127});}[a48_0x2b98f1(0x189)](_0x2c6099){const _0x983e86=a48_0x2b98f1;this[_0x983e86(0x151)](_0x983e86(0x14e),{'type':_0x983e86(0x18e),..._0x2c6099});}[a48_0x2b98f1(0x155)](_0xd3a931){const _0xe4b0d0=a48_0x2b98f1;this[_0xe4b0d0(0x151)](_0xe4b0d0(0x187),{'type':_0xe4b0d0(0x18f),..._0xd3a931});}[a48_0x2b98f1(0x156)](_0x181a61,_0x3a6e58,_0x4b9618,_0x4545cf,_0x4f70bc,_0x15f898){const _0x2ad4c5=a48_0x2b98f1;this[_0x2ad4c5(0x151)](_0x2ad4c5(0x15f),{'type':_0x2ad4c5(0x175),'shopId':_0x181a61,'webhookUrl':_0x3a6e58,'event':_0x4b9618,'status':_0x4545cf,'responseTime':_0x4f70bc,'payload':_0x15f898});}['logShopWebhookError'](_0x45178b,_0x5cd426,_0x276318,_0x2181a6,_0x5b6c69){const _0x26315e=a48_0x2b98f1;this[_0x26315e(0x151)](_0x26315e(0x192),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x45178b,'webhookUrl':_0x5cd426,'event':_0x276318,'error':_0x2181a6 instanceof Error?{'message':_0x2181a6[_0x26315e(0x174)],'stack':_0x2181a6[_0x26315e(0x15d)]}:_0x2181a6,'payload':_0x5b6c69});}[a48_0x2b98f1(0x198)](_0x2afd1b,_0x1f235a,_0x792076,_0x31c052,_0x247348){const _0x378a7a=a48_0x2b98f1;this[_0x378a7a(0x151)](_0x378a7a(0x179),{'type':_0x378a7a(0x157),'gateway':_0x2afd1b,'paymentId':_0x1f235a,'shopId':_0x792076,'amount':_0x31c052,'currency':_0x247348});}[a48_0x2b98f1(0x195)](_0x49d729,_0x31f0ea,_0x2b9b74,_0x520199,_0x2421b2){const _0x41b6b7=a48_0x2b98f1;this[_0x41b6b7(0x151)](_0x41b6b7(0x15c),{'type':'API_CALL','endpoint':_0x49d729,'method':_0x31f0ea,'userId':_0x2b9b74,'userRole':_0x520199,'requestData':_0x2421b2});}[a48_0x2b98f1(0x16a)](){const _0x42ed1a=a48_0x2b98f1;try{const _0x22a572=fs_1['default'][_0x42ed1a(0x18c)](this[_0x42ed1a(0x181)]),_0x55c115=_0x22a572['filter'](_0x2d7073=>_0x2d7073[_0x42ed1a(0x183)]('.log')),_0x4c70e5=[...new Set(_0x55c115['map'](_0x2d7cc4=>_0x2d7cc4[_0x42ed1a(0x16d)]('_')[0x0]))],_0x2a3f3a=_0x55c115[_0x42ed1a(0x165)](_0x14ee1e=>{const _0x242287=_0x42ed1a,_0x28443b=path_1[_0x242287(0x18b)][_0x242287(0x19b)](this['logsDir'],_0x14ee1e),_0x3f5fde=fs_1[_0x242287(0x18b)][_0x242287(0x14b)](_0x28443b),[_0x4e9f98,_0x2dd0dc]=_0x14ee1e[_0x242287(0x166)](_0x242287(0x153),'')['split']('_');return{'type':_0x4e9f98,'date':_0x2dd0dc,'size':_0x3f5fde[_0x242287(0x19f)]};})[_0x42ed1a(0x152)]((_0x16f064,_0xedcfe1)=>_0xedcfe1[_0x42ed1a(0x15e)][_0x42ed1a(0x194)](_0x16f064[_0x42ed1a(0x15e)]));return{'totalFiles':_0x55c115[_0x42ed1a(0x171)],'logTypes':_0x4c70e5,'latestLogs':_0x2a3f3a[_0x42ed1a(0x193)](0x0,0xa)};}catch(_0x30ff63){return console[_0x42ed1a(0x17b)]('Failed\x20to\x20get\x20log\x20stats:',_0x30ff63),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x2b98f1(0x15b)](_0x3128d0=0x1e){const _0x2710c9=a48_0x2b98f1;try{const _0x552330=fs_1[_0x2710c9(0x18b)][_0x2710c9(0x18c)](this['logsDir']),_0x1bca94=new Date();_0x1bca94['setDate'](_0x1bca94[_0x2710c9(0x17e)]()-_0x3128d0);let _0x5f4eec=0x0;_0x552330[_0x2710c9(0x178)](_0x1b59be=>{const _0x4747b8=_0x2710c9;if(!_0x1b59be[_0x4747b8(0x183)]('.log'))return;const _0x5231ca=path_1['default'][_0x4747b8(0x19b)](this[_0x4747b8(0x181)],_0x1b59be),_0x22615c=fs_1[_0x4747b8(0x18b)][_0x4747b8(0x14b)](_0x5231ca);_0x22615c[_0x4747b8(0x163)]<_0x1bca94&&(fs_1[_0x4747b8(0x18b)][_0x4747b8(0x17a)](_0x5231ca),_0x5f4eec++,console[_0x4747b8(0x173)](_0x4747b8(0x16e)+_0x1b59be));}),console[_0x2710c9(0x173)](_0x2710c9(0x185)+_0x5f4eec+_0x2710c9(0x16b)+_0x3128d0+_0x2710c9(0x170));}catch(_0x51a1bc){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x51a1bc);}}}exports['LoggerService']=LoggerService,exports[a48_0x2b98f1(0x14f)]=new LoggerService();