'use strict';const a49_0x5e9483=a49_0xa199;(function(_0x312012,_0x711dc9){const _0x2f96fd=a49_0xa199,_0x8d8e01=_0x312012();while(!![]){try{const _0xf95ac1=-parseInt(_0x2f96fd(0x12b))/0x1+parseInt(_0x2f96fd(0x15c))/0x2*(parseInt(_0x2f96fd(0x13f))/0x3)+parseInt(_0x2f96fd(0x129))/0x4+parseInt(_0x2f96fd(0x146))/0x5+-parseInt(_0x2f96fd(0x157))/0x6*(-parseInt(_0x2f96fd(0x14f))/0x7)+parseInt(_0x2f96fd(0x161))/0x8*(parseInt(_0x2f96fd(0x152))/0x9)+-parseInt(_0x2f96fd(0x135))/0xa;if(_0xf95ac1===_0x711dc9)break;else _0x8d8e01['push'](_0x8d8e01['shift']());}catch(_0x13cf9a){_0x8d8e01['push'](_0x8d8e01['shift']());}}}(a49_0x3a2b,0xdf640));function a49_0x3a2b(){const _0x2f5f3c=['statSync','6618MvKKEm','white_domain_errors','split','api_calls','stack','4394wVsdQj','logWhiteDomainResponse','SHOP_WEBHOOK_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','cleanOldLogs','24tTIjgB','log','.log','getLogFileName','white_domain_requests','setDate','date','appendFileSync','stringify','logsDir','\x20log:','🧹\x20Cleaned\x20','cointopay_status_changes','COINTOPAY_STATUS_CHANGE','getLogStats','map','Failed\x20to\x20clean\x20old\x20logs:','ensureLogsDirectory','cwd','shop_webhooks_sent','join','LoggerService','size','logWhiteDomainRequest','API_CALL','Failed\x20to\x20get\x20log\x20stats:','2552848NZLdhO','message','920013ofyhVr','defineProperty','getDate','slice','logWebhookError','📁\x20Created\x20logs\x20directory:\x20','WEBHOOK_ERROR','WEBHOOK_PROCESSED','logShopWebhookSent','writeLog','33703370hDvJpy','cointopay_errors','logCoinToPayStatus','🗑️\x20Deleted\x20old\x20log\x20file:\x20','default','logApiCall','replace','RESPONSE','logs','error','2379OQicio','mtime','webhooks_errors','logCoinToPayError','logShopWebhookError','__importDefault','ERROR','7324985TOASnY','existsSync','webhooks_received','webhooks_processed','Failed\x20to\x20write\x20','logWhiteDomainError','white_domain_responses','loggerService','__esModule','455nDpeeV','COINTOPAY_ERROR','forEach','3864699KeOOty','\x20days)','WEBHOOK_RECEIVED','mkdirSync'];a49_0x3a2b=function(){return _0x2f5f3c;};return a49_0x3a2b();}var __importDefault=this&&this[a49_0x5e9483(0x144)]||function(_0x581db0){return _0x581db0&&_0x581db0['__esModule']?_0x581db0:{'default':_0x581db0};};function a49_0xa199(_0x122c0b,_0x7668c5){const _0x3a2b3e=a49_0x3a2b();return a49_0xa199=function(_0xa19948,_0x656cd){_0xa19948=_0xa19948-0x111;let _0x48af55=_0x3a2b3e[_0xa19948];return _0x48af55;},a49_0xa199(_0x122c0b,_0x7668c5);}Object[a49_0x5e9483(0x12c)](exports,a49_0x5e9483(0x14e),{'value':!![]}),exports[a49_0x5e9483(0x14d)]=exports[a49_0x5e9483(0x124)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x122dd4=a49_0x5e9483;this[_0x122dd4(0x118)]=path_1[_0x122dd4(0x139)][_0x122dd4(0x123)](process[_0x122dd4(0x121)](),_0x122dd4(0x13d)),this[_0x122dd4(0x120)]();}[a49_0x5e9483(0x120)](){const _0x22ee67=a49_0x5e9483;!fs_1['default'][_0x22ee67(0x147)](this[_0x22ee67(0x118)])&&(fs_1[_0x22ee67(0x139)][_0x22ee67(0x155)](this['logsDir'],{'recursive':!![]}),console[_0x22ee67(0x162)](_0x22ee67(0x130)+this['logsDir']));}['getLogFileName'](_0x23c735){const _0x4cdba1=a49_0x5e9483,_0x349cc9=new Date()['toISOString']()[_0x4cdba1(0x159)]('T')[0x0];return path_1[_0x4cdba1(0x139)][_0x4cdba1(0x123)](this['logsDir'],_0x23c735+'_'+_0x349cc9+'.log');}['writeLog'](_0x1e93aa,_0x4f308d){const _0x5c3684=a49_0x5e9483;try{const _0x4efe8f=new Date()['toISOString'](),_0x20f6da={'timestamp':_0x4efe8f,..._0x4f308d},_0x41386e=JSON[_0x5c3684(0x117)](_0x20f6da)+'\x0a',_0x773809=this[_0x5c3684(0x112)](_0x1e93aa);fs_1[_0x5c3684(0x139)][_0x5c3684(0x116)](_0x773809,_0x41386e,'utf8');}catch(_0x36d205){console['error'](_0x5c3684(0x14a)+_0x1e93aa+_0x5c3684(0x119),_0x36d205);}}[a49_0x5e9483(0x126)](_0x5d256a,_0x1d077e,_0x32f20b,_0x2cf90c){const _0x2620fc=a49_0x5e9483;this[_0x2620fc(0x134)](_0x2620fc(0x113),{'type':'REQUEST','gateway':_0x5d256a,'endpoint':_0x1d077e,'method':_0x32f20b,'data':_0x2cf90c});}[a49_0x5e9483(0x15d)](_0x5412cb,_0x1602c0,_0x5c7a6d,_0xce4be1,_0x3253f1){const _0x1510d0=a49_0x5e9483;this[_0x1510d0(0x134)](_0x1510d0(0x14c),{'type':_0x1510d0(0x13c),'gateway':_0x5412cb,'endpoint':_0x1602c0,'status':_0x5c7a6d,'responseTime':_0x3253f1,'data':_0xce4be1});}[a49_0x5e9483(0x14b)](_0x377eb8,_0xf94fd8,_0x1ae69d){const _0x1b575b=a49_0x5e9483;this['writeLog'](_0x1b575b(0x158),{'type':_0x1b575b(0x145),'gateway':_0x377eb8,'endpoint':_0xf94fd8,'error':_0x1ae69d instanceof Error?{'message':_0x1ae69d[_0x1b575b(0x12a)],'stack':_0x1ae69d[_0x1b575b(0x15b)]}:_0x1ae69d});}['logWebhookReceived'](_0x5d899c,_0x2a5bb4,_0x545097){const _0x4d1a20=a49_0x5e9483;this[_0x4d1a20(0x134)](_0x4d1a20(0x148),{'type':_0x4d1a20(0x154),'gateway':_0x5d899c,'headers':_0x545097,'data':_0x2a5bb4});}['logWebhookProcessed'](_0x41052d,_0x1eb636,_0x549eb2,_0x404ce9,_0x482202){const _0x1cee26=a49_0x5e9483;this[_0x1cee26(0x134)](_0x1cee26(0x149),{'type':_0x1cee26(0x132),'gateway':_0x41052d,'paymentId':_0x1eb636,'oldStatus':_0x549eb2,'newStatus':_0x404ce9,'originalData':_0x482202});}[a49_0x5e9483(0x12f)](_0x2a526b,_0x16d44e,_0x3ae64e){const _0x29c214=a49_0x5e9483;this[_0x29c214(0x134)](_0x29c214(0x141),{'type':_0x29c214(0x131),'gateway':_0x2a526b,'error':_0x16d44e instanceof Error?{'message':_0x16d44e[_0x29c214(0x12a)],'stack':_0x16d44e[_0x29c214(0x15b)]}:_0x16d44e,'originalData':_0x3ae64e});}[a49_0x5e9483(0x137)](_0x1f5a69){const _0x49311d=a49_0x5e9483;this[_0x49311d(0x134)](_0x49311d(0x11b),{'type':_0x49311d(0x11c),..._0x1f5a69});}[a49_0x5e9483(0x142)](_0x4592a2){const _0x2d6c6c=a49_0x5e9483;this['writeLog'](_0x2d6c6c(0x136),{'type':_0x2d6c6c(0x150),..._0x4592a2});}[a49_0x5e9483(0x133)](_0x1053ee,_0x2a5b92,_0x1bc33e,_0x123127,_0x1ce8dd,_0x403ee6){const _0x357bca=a49_0x5e9483;this['writeLog'](_0x357bca(0x122),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x1053ee,'webhookUrl':_0x2a5b92,'event':_0x1bc33e,'status':_0x123127,'responseTime':_0x1ce8dd,'payload':_0x403ee6});}[a49_0x5e9483(0x143)](_0x2e423e,_0x2cc064,_0x3edcb2,_0x4b8389,_0x46c6e8){const _0x4946ce=a49_0x5e9483;this['writeLog']('shop_webhooks_errors',{'type':_0x4946ce(0x15e),'shopId':_0x2e423e,'webhookUrl':_0x2cc064,'event':_0x3edcb2,'error':_0x4b8389 instanceof Error?{'message':_0x4b8389[_0x4946ce(0x12a)],'stack':_0x4b8389[_0x4946ce(0x15b)]}:_0x4b8389,'payload':_0x46c6e8});}['logPaymentCreated'](_0xda5ab0,_0x345a0e,_0xa462eb,_0x21fa17,_0x10bc4e){const _0x50eb48=a49_0x5e9483;this[_0x50eb48(0x134)]('payments_created',{'type':'PAYMENT_CREATED','gateway':_0xda5ab0,'paymentId':_0x345a0e,'shopId':_0xa462eb,'amount':_0x21fa17,'currency':_0x10bc4e});}[a49_0x5e9483(0x13a)](_0x193b4b,_0x1f2301,_0x4159f6,_0x6a65fa,_0x143b3c){const _0x4bff7b=a49_0x5e9483;this[_0x4bff7b(0x134)](_0x4bff7b(0x15a),{'type':_0x4bff7b(0x127),'endpoint':_0x193b4b,'method':_0x1f2301,'userId':_0x4159f6,'userRole':_0x6a65fa,'requestData':_0x143b3c});}[a49_0x5e9483(0x11d)](){const _0x31939b=a49_0x5e9483;try{const _0x1964de=fs_1[_0x31939b(0x139)]['readdirSync'](this['logsDir']),_0x115f37=_0x1964de['filter'](_0x3b8da7=>_0x3b8da7['endsWith'](_0x31939b(0x111))),_0x401c9b=[...new Set(_0x115f37[_0x31939b(0x11e)](_0x3e25b4=>_0x3e25b4[_0x31939b(0x159)]('_')[0x0]))],_0x284852=_0x115f37[_0x31939b(0x11e)](_0x5d7947=>{const _0x5487fa=_0x31939b,_0x583254=path_1[_0x5487fa(0x139)]['join'](this[_0x5487fa(0x118)],_0x5d7947),_0x50e747=fs_1[_0x5487fa(0x139)][_0x5487fa(0x156)](_0x583254),[_0x51599d,_0x3bea60]=_0x5d7947[_0x5487fa(0x13b)](_0x5487fa(0x111),'')[_0x5487fa(0x159)]('_');return{'type':_0x51599d,'date':_0x3bea60,'size':_0x50e747[_0x5487fa(0x125)]};})['sort']((_0x49db3b,_0x39d7d0)=>_0x39d7d0['date']['localeCompare'](_0x49db3b[_0x31939b(0x115)]));return{'totalFiles':_0x115f37['length'],'logTypes':_0x401c9b,'latestLogs':_0x284852[_0x31939b(0x12e)](0x0,0xa)};}catch(_0x4612c0){return console[_0x31939b(0x13e)](_0x31939b(0x128),_0x4612c0),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x5e9483(0x160)](_0x29a69d=0x1e){const _0x2ef3d5=a49_0x5e9483;try{const _0x5cb735=fs_1['default']['readdirSync'](this[_0x2ef3d5(0x118)]),_0xc3bf4=new Date();_0xc3bf4[_0x2ef3d5(0x114)](_0xc3bf4[_0x2ef3d5(0x12d)]()-_0x29a69d);let _0x44fc8a=0x0;_0x5cb735[_0x2ef3d5(0x151)](_0x394693=>{const _0x4501ce=_0x2ef3d5;if(!_0x394693['endsWith'](_0x4501ce(0x111)))return;const _0x43c238=path_1[_0x4501ce(0x139)][_0x4501ce(0x123)](this[_0x4501ce(0x118)],_0x394693),_0x3f020e=fs_1['default'][_0x4501ce(0x156)](_0x43c238);_0x3f020e[_0x4501ce(0x140)]<_0xc3bf4&&(fs_1[_0x4501ce(0x139)]['unlinkSync'](_0x43c238),_0x44fc8a++,console[_0x4501ce(0x162)](_0x4501ce(0x138)+_0x394693));}),console[_0x2ef3d5(0x162)](_0x2ef3d5(0x11a)+_0x44fc8a+_0x2ef3d5(0x15f)+_0x29a69d+_0x2ef3d5(0x153));}catch(_0x5034e8){console['error'](_0x2ef3d5(0x11f),_0x5034e8);}}}exports[a49_0x5e9483(0x124)]=LoggerService,exports['loggerService']=new LoggerService();