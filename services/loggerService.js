'use strict';const a48_0x1e8115=a48_0x2acf;(function(_0x2978a3,_0xa005f7){const _0x1edab0=a48_0x2acf,_0x4c9987=_0x2978a3();while(!![]){try{const _0x37b6b1=parseInt(_0x1edab0(0xbf))/0x1+parseInt(_0x1edab0(0xd4))/0x2+parseInt(_0x1edab0(0xbb))/0x3*(parseInt(_0x1edab0(0xb9))/0x4)+-parseInt(_0x1edab0(0xdb))/0x5+-parseInt(_0x1edab0(0x102))/0x6+parseInt(_0x1edab0(0x104))/0x7*(parseInt(_0x1edab0(0x108))/0x8)+parseInt(_0x1edab0(0xe3))/0x9*(-parseInt(_0x1edab0(0xdc))/0xa);if(_0x37b6b1===_0xa005f7)break;else _0x4c9987['push'](_0x4c9987['shift']());}catch(_0x209a99){_0x4c9987['push'](_0x4c9987['shift']());}}}(a48_0x221c,0x23dc5));function a48_0x2acf(_0x39e927,_0x23f002){const _0x221c8b=a48_0x221c();return a48_0x2acf=function(_0x2acf3f,_0x4a3a39){_0x2acf3f=_0x2acf3f-0xb7;let _0x231d5c=_0x221c8b[_0x2acf3f];return _0x231d5c;},a48_0x2acf(_0x39e927,_0x23f002);}var __importDefault=this&&this[a48_0x1e8115(0xfa)]||function(_0x16e5ec){const _0xc4a39a=a48_0x1e8115;return _0x16e5ec&&_0x16e5ec[_0xc4a39a(0xe0)]?_0x16e5ec:{'default':_0x16e5ec};};Object['defineProperty'](exports,a48_0x1e8115(0xe0),{'value':!![]}),exports[a48_0x1e8115(0x106)]=exports[a48_0x1e8115(0xf9)]=void 0x0;function a48_0x221c(){const _0x3ded84=['cointopay_errors','🧹\x20Cleaned\x20','shop_webhooks_errors','172070aAAETt','780AWArAI','white_domain_requests','getLogFileName','\x20days)','__esModule','logCoinToPayError','mkdirSync','37728vNpluV','path','stringify','log','logWebhookProcessed','split','logWebhookError','logPaymentCreated','forEach','white_domain_errors','message','Failed\x20to\x20clean\x20old\x20logs:','COINTOPAY_STATUS_CHANGE','logs','RESPONSE','default','cwd','📁\x20Created\x20logs\x20directory:\x20','shop_webhooks_sent','error','length','.log','LoggerService','__importDefault','map','logWhiteDomainRequest','ERROR','date','🗑️\x20Deleted\x20old\x20log\x20file:\x20','WEBHOOK_RECEIVED','payments_created','40272OqfSYM','mtime','244013WDWIYf','ensureLogsDirectory','loggerService','WEBHOOK_ERROR','16SYnICc','slice','webhooks_processed','API_CALL','logsDir','89524LbuDBO','statSync','9sBTSED','logWhiteDomainResponse','size','white_domain_responses','287174pXKXgN','writeLog','Failed\x20to\x20write\x20','logCoinToPayStatus','logWebhookReceived','logShopWebhookSent','logShopWebhookError','\x20log:','cleanOldLogs','toISOString','sort','unlinkSync','api_calls','stack','cointopay_status_changes','webhooks_received','setDate','SHOP_WEBHOOK_ERROR','COINTOPAY_ERROR','getDate','SHOP_WEBHOOK_SENT','181904SWQRqY','existsSync','REQUEST','join'];a48_0x221c=function(){return _0x3ded84;};return a48_0x221c();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x1e8115(0xe4)));class LoggerService{constructor(){const _0x2d2cfd=a48_0x1e8115;this[_0x2d2cfd(0xb8)]=path_1[_0x2d2cfd(0xf2)][_0x2d2cfd(0xd7)](process[_0x2d2cfd(0xf3)](),_0x2d2cfd(0xf0)),this[_0x2d2cfd(0x105)]();}[a48_0x1e8115(0x105)](){const _0x3fe855=a48_0x1e8115;!fs_1['default'][_0x3fe855(0xd5)](this[_0x3fe855(0xb8)])&&(fs_1[_0x3fe855(0xf2)][_0x3fe855(0xe2)](this[_0x3fe855(0xb8)],{'recursive':!![]}),console[_0x3fe855(0xe6)](_0x3fe855(0xf4)+this[_0x3fe855(0xb8)]));}['getLogFileName'](_0x5555d2){const _0x525933=a48_0x1e8115,_0x4ee01d=new Date()[_0x525933(0xc8)]()[_0x525933(0xe8)]('T')[0x0];return path_1[_0x525933(0xf2)][_0x525933(0xd7)](this['logsDir'],_0x5555d2+'_'+_0x4ee01d+_0x525933(0xf8));}[a48_0x1e8115(0xc0)](_0x37517d,_0x373ae1){const _0x2e7d6c=a48_0x1e8115;try{const _0x5723b9=new Date()['toISOString'](),_0x41a3bd={'timestamp':_0x5723b9,..._0x373ae1},_0x12fe35=JSON[_0x2e7d6c(0xe5)](_0x41a3bd)+'\x0a',_0x5be51d=this[_0x2e7d6c(0xde)](_0x37517d);fs_1[_0x2e7d6c(0xf2)]['appendFileSync'](_0x5be51d,_0x12fe35,'utf8');}catch(_0x486bc0){console[_0x2e7d6c(0xf6)](_0x2e7d6c(0xc1)+_0x37517d+_0x2e7d6c(0xc6),_0x486bc0);}}[a48_0x1e8115(0xfc)](_0x7a7892,_0x222691,_0x1c477f,_0x5da40a){const _0x35cfc9=a48_0x1e8115;this[_0x35cfc9(0xc0)](_0x35cfc9(0xdd),{'type':_0x35cfc9(0xd6),'gateway':_0x7a7892,'endpoint':_0x222691,'method':_0x1c477f,'data':_0x5da40a});}[a48_0x1e8115(0xbc)](_0x158ce6,_0x34b500,_0x15bb3b,_0x2e8321,_0xd5f96e){const _0x3b3b80=a48_0x1e8115;this[_0x3b3b80(0xc0)](_0x3b3b80(0xbe),{'type':_0x3b3b80(0xf1),'gateway':_0x158ce6,'endpoint':_0x34b500,'status':_0x15bb3b,'responseTime':_0xd5f96e,'data':_0x2e8321});}['logWhiteDomainError'](_0xcb8ec1,_0x5f14b8,_0x4ea6ba){const _0x3793c4=a48_0x1e8115;this['writeLog'](_0x3793c4(0xec),{'type':_0x3793c4(0xfd),'gateway':_0xcb8ec1,'endpoint':_0x5f14b8,'error':_0x4ea6ba instanceof Error?{'message':_0x4ea6ba[_0x3793c4(0xed)],'stack':_0x4ea6ba[_0x3793c4(0xcc)]}:_0x4ea6ba});}[a48_0x1e8115(0xc3)](_0x2bc8db,_0x31f6b0,_0x565cc4){const _0x464842=a48_0x1e8115;this[_0x464842(0xc0)](_0x464842(0xce),{'type':_0x464842(0x100),'gateway':_0x2bc8db,'headers':_0x565cc4,'data':_0x31f6b0});}[a48_0x1e8115(0xe7)](_0x2fa631,_0xa7dae3,_0x110ef0,_0x263b3c,_0x24900d){const _0x3f2213=a48_0x1e8115;this[_0x3f2213(0xc0)](_0x3f2213(0x10a),{'type':'WEBHOOK_PROCESSED','gateway':_0x2fa631,'paymentId':_0xa7dae3,'oldStatus':_0x110ef0,'newStatus':_0x263b3c,'originalData':_0x24900d});}[a48_0x1e8115(0xe9)](_0x6e8be1,_0x2d5559,_0x49e1a0){const _0x50e263=a48_0x1e8115;this[_0x50e263(0xc0)]('webhooks_errors',{'type':_0x50e263(0x107),'gateway':_0x6e8be1,'error':_0x2d5559 instanceof Error?{'message':_0x2d5559['message'],'stack':_0x2d5559[_0x50e263(0xcc)]}:_0x2d5559,'originalData':_0x49e1a0});}[a48_0x1e8115(0xc2)](_0x26ee29){const _0x4fd07f=a48_0x1e8115;this[_0x4fd07f(0xc0)](_0x4fd07f(0xcd),{'type':_0x4fd07f(0xef),..._0x26ee29});}[a48_0x1e8115(0xe1)](_0x347e9e){const _0x357851=a48_0x1e8115;this[_0x357851(0xc0)](_0x357851(0xd8),{'type':_0x357851(0xd1),..._0x347e9e});}[a48_0x1e8115(0xc4)](_0x1cbbd1,_0x1614b1,_0x2423c2,_0x397f2d,_0x4f888c,_0x3fe851){const _0x3ea973=a48_0x1e8115;this[_0x3ea973(0xc0)](_0x3ea973(0xf5),{'type':_0x3ea973(0xd3),'shopId':_0x1cbbd1,'webhookUrl':_0x1614b1,'event':_0x2423c2,'status':_0x397f2d,'responseTime':_0x4f888c,'payload':_0x3fe851});}[a48_0x1e8115(0xc5)](_0x4c64b0,_0x42589e,_0x57b0a6,_0x27eb1c,_0x20af1d){const _0x4da32a=a48_0x1e8115;this[_0x4da32a(0xc0)](_0x4da32a(0xda),{'type':_0x4da32a(0xd0),'shopId':_0x4c64b0,'webhookUrl':_0x42589e,'event':_0x57b0a6,'error':_0x27eb1c instanceof Error?{'message':_0x27eb1c[_0x4da32a(0xed)],'stack':_0x27eb1c[_0x4da32a(0xcc)]}:_0x27eb1c,'payload':_0x20af1d});}[a48_0x1e8115(0xea)](_0x446d0d,_0x433c57,_0x1e136c,_0x2323ee,_0x1222d1){const _0x1350f5=a48_0x1e8115;this['writeLog'](_0x1350f5(0x101),{'type':'PAYMENT_CREATED','gateway':_0x446d0d,'paymentId':_0x433c57,'shopId':_0x1e136c,'amount':_0x2323ee,'currency':_0x1222d1});}['logApiCall'](_0x30a649,_0x5b10b1,_0x3cdadc,_0x4f4b9f,_0x5284b2){const _0x5a5557=a48_0x1e8115;this['writeLog'](_0x5a5557(0xcb),{'type':_0x5a5557(0xb7),'endpoint':_0x30a649,'method':_0x5b10b1,'userId':_0x3cdadc,'userRole':_0x4f4b9f,'requestData':_0x5284b2});}['getLogStats'](){const _0x21dd8d=a48_0x1e8115;try{const _0x1b9699=fs_1[_0x21dd8d(0xf2)]['readdirSync'](this[_0x21dd8d(0xb8)]),_0x3ec33b=_0x1b9699['filter'](_0x7cfc00=>_0x7cfc00['endsWith'](_0x21dd8d(0xf8))),_0x5afe87=[...new Set(_0x3ec33b[_0x21dd8d(0xfb)](_0x29a010=>_0x29a010['split']('_')[0x0]))],_0x229604=_0x3ec33b[_0x21dd8d(0xfb)](_0x46375b=>{const _0xddcdc4=_0x21dd8d,_0x29224a=path_1[_0xddcdc4(0xf2)][_0xddcdc4(0xd7)](this[_0xddcdc4(0xb8)],_0x46375b),_0x44f311=fs_1['default'][_0xddcdc4(0xba)](_0x29224a),[_0x489f7f,_0x1728f1]=_0x46375b['replace'](_0xddcdc4(0xf8),'')[_0xddcdc4(0xe8)]('_');return{'type':_0x489f7f,'date':_0x1728f1,'size':_0x44f311[_0xddcdc4(0xbd)]};})[_0x21dd8d(0xc9)]((_0x46e2af,_0x5c49d5)=>_0x5c49d5[_0x21dd8d(0xfe)]['localeCompare'](_0x46e2af['date']));return{'totalFiles':_0x3ec33b[_0x21dd8d(0xf7)],'logTypes':_0x5afe87,'latestLogs':_0x229604[_0x21dd8d(0x109)](0x0,0xa)};}catch(_0x398591){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x398591),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x1e8115(0xc7)](_0x50de18=0x1e){const _0x2d1365=a48_0x1e8115;try{const _0x111d01=fs_1[_0x2d1365(0xf2)]['readdirSync'](this[_0x2d1365(0xb8)]),_0x3d0c7a=new Date();_0x3d0c7a[_0x2d1365(0xcf)](_0x3d0c7a[_0x2d1365(0xd2)]()-_0x50de18);let _0x266f20=0x0;_0x111d01[_0x2d1365(0xeb)](_0x5c55f1=>{const _0x120929=_0x2d1365;if(!_0x5c55f1['endsWith'](_0x120929(0xf8)))return;const _0x292dc7=path_1[_0x120929(0xf2)][_0x120929(0xd7)](this[_0x120929(0xb8)],_0x5c55f1),_0x5dcb92=fs_1[_0x120929(0xf2)][_0x120929(0xba)](_0x292dc7);_0x5dcb92[_0x120929(0x103)]<_0x3d0c7a&&(fs_1[_0x120929(0xf2)][_0x120929(0xca)](_0x292dc7),_0x266f20++,console[_0x120929(0xe6)](_0x120929(0xff)+_0x5c55f1));}),console[_0x2d1365(0xe6)](_0x2d1365(0xd9)+_0x266f20+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x50de18+_0x2d1365(0xdf));}catch(_0x506ea2){console[_0x2d1365(0xf6)](_0x2d1365(0xee),_0x506ea2);}}}exports[a48_0x1e8115(0xf9)]=LoggerService,exports[a48_0x1e8115(0x106)]=new LoggerService();