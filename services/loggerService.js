'use strict';const a49_0x395645=a49_0x29fb;(function(_0x438fe3,_0x149a54){const _0x2e86fc=a49_0x29fb,_0x4d2224=_0x438fe3();while(!![]){try{const _0x2b9235=-parseInt(_0x2e86fc(0xca))/0x1*(-parseInt(_0x2e86fc(0xe0))/0x2)+-parseInt(_0x2e86fc(0xc7))/0x3*(parseInt(_0x2e86fc(0xc1))/0x4)+parseInt(_0x2e86fc(0xa8))/0x5*(parseInt(_0x2e86fc(0xe4))/0x6)+parseInt(_0x2e86fc(0xc6))/0x7*(parseInt(_0x2e86fc(0xf2))/0x8)+-parseInt(_0x2e86fc(0xbf))/0x9+-parseInt(_0x2e86fc(0xb2))/0xa*(-parseInt(_0x2e86fc(0x9e))/0xb)+-parseInt(_0x2e86fc(0xc0))/0xc*(parseInt(_0x2e86fc(0xd0))/0xd);if(_0x2b9235===_0x149a54)break;else _0x4d2224['push'](_0x4d2224['shift']());}catch(_0x54cfaa){_0x4d2224['push'](_0x4d2224['shift']());}}}(a49_0xe791,0x7206f));function a49_0x29fb(_0x19bd27,_0x4dee30){const _0xe79108=a49_0xe791();return a49_0x29fb=function(_0x29fb03,_0x18da0c){_0x29fb03=_0x29fb03-0x95;let _0x11870c=_0xe79108[_0x29fb03];return _0x11870c;},a49_0x29fb(_0x19bd27,_0x4dee30);}var __importDefault=this&&this[a49_0x395645(0xac)]||function(_0x181e36){const _0x5b420e=a49_0x395645;return _0x181e36&&_0x181e36[_0x5b420e(0xaf)]?_0x181e36:{'default':_0x181e36};};Object[a49_0x395645(0xeb)](exports,a49_0x395645(0xaf),{'value':!![]}),exports['loggerService']=exports[a49_0x395645(0xb0)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x40cd94=a49_0x395645;this[_0x40cd94(0xd8)]=path_1[_0x40cd94(0xed)][_0x40cd94(0xd5)](process[_0x40cd94(0xd2)](),_0x40cd94(0x9c)),this['ensureLogsDirectory']();}[a49_0x395645(0xaa)](){const _0x58b0e2=a49_0x395645;!fs_1[_0x58b0e2(0xed)][_0x58b0e2(0xb1)](this['logsDir'])&&(fs_1[_0x58b0e2(0xed)][_0x58b0e2(0xc4)](this[_0x58b0e2(0xd8)],{'recursive':!![]}),console[_0x58b0e2(0xe5)](_0x58b0e2(0xef)+this[_0x58b0e2(0xd8)]));}[a49_0x395645(0xd3)](_0x2e5574){const _0x12c5ae=a49_0x395645,_0x4984dd=new Date()[_0x12c5ae(0xad)]()[_0x12c5ae(0xbb)]('T')[0x0];return path_1[_0x12c5ae(0xed)][_0x12c5ae(0xd5)](this['logsDir'],_0x2e5574+'_'+_0x4984dd+_0x12c5ae(0x95));}[a49_0x395645(0xc8)](_0x4b8992,_0x3a5e3c){const _0x24e4fa=a49_0x395645;try{const _0x575163=new Date()[_0x24e4fa(0xad)](),_0x10eae1={'timestamp':_0x575163,..._0x3a5e3c},_0x547bb0=JSON[_0x24e4fa(0xcc)](_0x10eae1)+'\x0a',_0x10591b=this[_0x24e4fa(0xd3)](_0x4b8992);fs_1[_0x24e4fa(0xed)][_0x24e4fa(0xf0)](_0x10591b,_0x547bb0,_0x24e4fa(0x9b));}catch(_0x42ea3d){console[_0x24e4fa(0xe7)](_0x24e4fa(0xcf)+_0x4b8992+_0x24e4fa(0xa5),_0x42ea3d);}}[a49_0x395645(0x99)](_0x13fff5,_0x2e0ad7,_0x49db6a,_0x18a993){const _0x481ada=a49_0x395645;this['writeLog'](_0x481ada(0xbe),{'type':_0x481ada(0xee),'gateway':_0x13fff5,'endpoint':_0x2e0ad7,'method':_0x49db6a,'data':_0x18a993});}[a49_0x395645(0xa1)](_0xe91036,_0x4a4a5f,_0x230bdb,_0x57d630,_0x7b1634){const _0x3e13ef=a49_0x395645;this[_0x3e13ef(0xc8)](_0x3e13ef(0xa3),{'type':_0x3e13ef(0xba),'gateway':_0xe91036,'endpoint':_0x4a4a5f,'status':_0x230bdb,'responseTime':_0x7b1634,'data':_0x57d630});}[a49_0x395645(0xd1)](_0xf84485,_0x271042,_0x2a5389){const _0x51a30a=a49_0x395645;this[_0x51a30a(0xc8)](_0x51a30a(0xcd),{'type':_0x51a30a(0x9f),'gateway':_0xf84485,'endpoint':_0x271042,'error':_0x2a5389 instanceof Error?{'message':_0x2a5389[_0x51a30a(0xe9)],'stack':_0x2a5389[_0x51a30a(0xbc)]}:_0x2a5389});}[a49_0x395645(0xa0)](_0x380a1a,_0x4ca030,_0x58cda7){const _0x35aacf=a49_0x395645;this['writeLog']('webhooks_received',{'type':_0x35aacf(0x9d),'gateway':_0x380a1a,'headers':_0x58cda7,'data':_0x4ca030});}[a49_0x395645(0xda)](_0x51ca42,_0x51a2e8,_0x395a20,_0x3b884d,_0x5bef4f){const _0x113c6f=a49_0x395645;this['writeLog'](_0x113c6f(0xbd),{'type':_0x113c6f(0x9a),'gateway':_0x51ca42,'paymentId':_0x51a2e8,'oldStatus':_0x395a20,'newStatus':_0x3b884d,'originalData':_0x5bef4f});}[a49_0x395645(0xb6)](_0x40ef80,_0x263f83,_0x4ae084){const _0x5e9a31=a49_0x395645;this[_0x5e9a31(0xc8)](_0x5e9a31(0xa2),{'type':_0x5e9a31(0xc5),'gateway':_0x40ef80,'error':_0x263f83 instanceof Error?{'message':_0x263f83['message'],'stack':_0x263f83[_0x5e9a31(0xbc)]}:_0x263f83,'originalData':_0x4ae084});}[a49_0x395645(0xe8)](_0x97fee2){const _0x439a14=a49_0x395645;this[_0x439a14(0xc8)](_0x439a14(0xc3),{'type':_0x439a14(0xdf),..._0x97fee2});}[a49_0x395645(0xb3)](_0x4921e7){const _0x58fd16=a49_0x395645;this[_0x58fd16(0xc8)](_0x58fd16(0xa9),{'type':'COINTOPAY_ERROR',..._0x4921e7});}[a49_0x395645(0xd6)](_0x1b7477,_0x4b25c6,_0x230ac2,_0x186a14,_0x51855e,_0x3c0967){const _0x525ded=a49_0x395645;this['writeLog'](_0x525ded(0xe2),{'type':_0x525ded(0xb4),'shopId':_0x1b7477,'webhookUrl':_0x4b25c6,'event':_0x230ac2,'status':_0x186a14,'responseTime':_0x51855e,'payload':_0x3c0967});}[a49_0x395645(0x96)](_0x30a49a,_0x1cc332,_0x33895a,_0x201c33,_0x19cad2){const _0x4c0bf9=a49_0x395645;this[_0x4c0bf9(0xc8)](_0x4c0bf9(0xdb),{'type':_0x4c0bf9(0xdc),'shopId':_0x30a49a,'webhookUrl':_0x1cc332,'event':_0x33895a,'error':_0x201c33 instanceof Error?{'message':_0x201c33[_0x4c0bf9(0xe9)],'stack':_0x201c33[_0x4c0bf9(0xbc)]}:_0x201c33,'payload':_0x19cad2});}[a49_0x395645(0xea)](_0x3eb668,_0x1d3dac,_0x208a8b,_0x2836f2,_0x1914d2){const _0x14ce3d=a49_0x395645;this['writeLog'](_0x14ce3d(0xe1),{'type':_0x14ce3d(0xc9),'gateway':_0x3eb668,'paymentId':_0x1d3dac,'shopId':_0x208a8b,'amount':_0x2836f2,'currency':_0x1914d2});}[a49_0x395645(0xab)](_0x172f8a,_0x3bb8b5,_0x4908fb,_0x7315e9,_0x117860){const _0x37bace=a49_0x395645;this[_0x37bace(0xc8)](_0x37bace(0xc2),{'type':'API_CALL','endpoint':_0x172f8a,'method':_0x3bb8b5,'userId':_0x4908fb,'userRole':_0x7315e9,'requestData':_0x117860});}['getLogStats'](){const _0x3c192e=a49_0x395645;try{const _0x24a922=fs_1[_0x3c192e(0xed)][_0x3c192e(0xb8)](this['logsDir']),_0x2320dc=_0x24a922[_0x3c192e(0xf1)](_0x4448aa=>_0x4448aa[_0x3c192e(0x97)](_0x3c192e(0x95))),_0x57dbf9=[...new Set(_0x2320dc[_0x3c192e(0xb7)](_0x2b2bc5=>_0x2b2bc5[_0x3c192e(0xbb)]('_')[0x0]))],_0x2d6f21=_0x2320dc[_0x3c192e(0xb7)](_0x49f829=>{const _0x412162=_0x3c192e,_0x43ff53=path_1[_0x412162(0xed)]['join'](this[_0x412162(0xd8)],_0x49f829),_0x298f7c=fs_1['default'][_0x412162(0xcb)](_0x43ff53),[_0x50f069,_0x1226b8]=_0x49f829[_0x412162(0xec)](_0x412162(0x95),'')[_0x412162(0xbb)]('_');return{'type':_0x50f069,'date':_0x1226b8,'size':_0x298f7c[_0x412162(0xa7)]};})[_0x3c192e(0xae)]((_0x3181a6,_0x509f84)=>_0x509f84[_0x3c192e(0xe6)][_0x3c192e(0xd9)](_0x3181a6['date']));return{'totalFiles':_0x2320dc['length'],'logTypes':_0x57dbf9,'latestLogs':_0x2d6f21[_0x3c192e(0xdd)](0x0,0xa)};}catch(_0xe027ad){return console[_0x3c192e(0xe7)](_0x3c192e(0xa6),_0xe027ad),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x20ed2c=0x1e){const _0x55aaa6=a49_0x395645;try{const _0x50f671=fs_1[_0x55aaa6(0xed)][_0x55aaa6(0xb8)](this['logsDir']),_0x4dea29=new Date();_0x4dea29[_0x55aaa6(0xe3)](_0x4dea29['getDate']()-_0x20ed2c);let _0xf01a6=0x0;_0x50f671[_0x55aaa6(0x98)](_0x42a4e9=>{const _0xee27d9=_0x55aaa6;if(!_0x42a4e9[_0xee27d9(0x97)](_0xee27d9(0x95)))return;const _0x1be0f9=path_1[_0xee27d9(0xed)][_0xee27d9(0xd5)](this[_0xee27d9(0xd8)],_0x42a4e9),_0x11e437=fs_1[_0xee27d9(0xed)][_0xee27d9(0xcb)](_0x1be0f9);_0x11e437[_0xee27d9(0xd7)]<_0x4dea29&&(fs_1[_0xee27d9(0xed)][_0xee27d9(0xde)](_0x1be0f9),_0xf01a6++,console[_0xee27d9(0xe5)](_0xee27d9(0xb9)+_0x42a4e9));}),console['log'](_0x55aaa6(0xd4)+_0xf01a6+_0x55aaa6(0xce)+_0x20ed2c+_0x55aaa6(0xa4));}catch(_0x521a5e){console[_0x55aaa6(0xe7)]('Failed\x20to\x20clean\x20old\x20logs:',_0x521a5e);}}}function a49_0xe791(){const _0x22b996=['defineProperty','replace','default','REQUEST','📁\x20Created\x20logs\x20directory:\x20','appendFileSync','filter','4728tmNoIh','.log','logShopWebhookError','endsWith','forEach','logWhiteDomainRequest','WEBHOOK_PROCESSED','utf8','logs','WEBHOOK_RECEIVED','1055857IcNcnY','ERROR','logWebhookReceived','logWhiteDomainResponse','webhooks_errors','white_domain_responses','\x20days)','\x20log:','Failed\x20to\x20get\x20log\x20stats:','size','152860RxVZPL','cointopay_errors','ensureLogsDirectory','logApiCall','__importDefault','toISOString','sort','__esModule','LoggerService','existsSync','10JSketK','logCoinToPayError','SHOP_WEBHOOK_SENT','loggerService','logWebhookError','map','readdirSync','🗑️\x20Deleted\x20old\x20log\x20file:\x20','RESPONSE','split','stack','webhooks_processed','white_domain_requests','7005465gwDetD','677556CuBsps','1417292ewyOWK','api_calls','cointopay_status_changes','mkdirSync','WEBHOOK_ERROR','7805ztQnBs','6kZjezx','writeLog','PAYMENT_CREATED','108PENfRl','statSync','stringify','white_domain_errors','\x20old\x20log\x20files\x20(older\x20than\x20','Failed\x20to\x20write\x20','26quRFMQ','logWhiteDomainError','cwd','getLogFileName','🧹\x20Cleaned\x20','join','logShopWebhookSent','mtime','logsDir','localeCompare','logWebhookProcessed','shop_webhooks_errors','SHOP_WEBHOOK_ERROR','slice','unlinkSync','COINTOPAY_STATUS_CHANGE','11276CgrWiP','payments_created','shop_webhooks_sent','setDate','138FVzwno','log','date','error','logCoinToPayStatus','message','logPaymentCreated'];a49_0xe791=function(){return _0x22b996;};return a49_0xe791();}exports['LoggerService']=LoggerService,exports[a49_0x395645(0xb5)]=new LoggerService();