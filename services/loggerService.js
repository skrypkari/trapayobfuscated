'use strict';const a51_0x38de6e=a51_0x28e0;(function(_0xb7145d,_0x361cdd){const _0x58d1e5=a51_0x28e0,_0x451a1c=_0xb7145d();while(!![]){try{const _0x2d6bf1=-parseInt(_0x58d1e5(0x129))/0x1+-parseInt(_0x58d1e5(0x16b))/0x2+parseInt(_0x58d1e5(0x148))/0x3*(-parseInt(_0x58d1e5(0x138))/0x4)+-parseInt(_0x58d1e5(0x121))/0x5+-parseInt(_0x58d1e5(0x165))/0x6+parseInt(_0x58d1e5(0x12b))/0x7*(-parseInt(_0x58d1e5(0x128))/0x8)+parseInt(_0x58d1e5(0x13e))/0x9;if(_0x2d6bf1===_0x361cdd)break;else _0x451a1c['push'](_0x451a1c['shift']());}catch(_0x3549a9){_0x451a1c['push'](_0x451a1c['shift']());}}}(a51_0x3d77,0xef9ca));function a51_0x28e0(_0x199a5d,_0x95be9e){const _0x3d77ca=a51_0x3d77();return a51_0x28e0=function(_0x28e0a1,_0x35ac22){_0x28e0a1=_0x28e0a1-0x121;let _0x127a8e=_0x3d77ca[_0x28e0a1];return _0x127a8e;},a51_0x28e0(_0x199a5d,_0x95be9e);}function a51_0x3d77(){const _0x2f3d27=['shop_webhooks_sent','webhooks_errors','white_domain_errors','🗑️\x20Deleted\x20old\x20log\x20file:\x20','cointopay_status_changes','readdirSync','6265804xMSscK','default','mkdirSync','cleanOldLogs','webhooks_received','length','70182423KZkXQx','cwd','getDate','.log','sort','white_domain_responses','message','COINTOPAY_ERROR','RESPONSE','logCoinToPayStatus','3wvsxXL','logsDir','📁\x20Created\x20logs\x20directory:\x20','mtime','writeLog','split','utf8','logs','\x20days)','Failed\x20to\x20write\x20','filter','logWebhookProcessed','slice','api_calls','error','logWhiteDomainError','join','🧹\x20Cleaned\x20','shop_webhooks_errors','defineProperty','logWebhookReceived','endsWith','stack','loggerService','LoggerService','logCoinToPayError','log','date','logWebhookError','3701184yvUpAL','ERROR','size','logPaymentCreated','__esModule','SHOP_WEBHOOK_ERROR','3805276rIWHyG','unlinkSync','logShopWebhookSent','API_CALL','statSync','5150385zqutjQ','replace','logWhiteDomainResponse','existsSync','__importDefault','webhooks_processed','PAYMENT_CREATED','96JPNBeD','18671tcFvgt','getLogFileName','981106DtbtFT','localeCompare','ensureLogsDirectory','payments_created','path','map','setDate'];a51_0x3d77=function(){return _0x2f3d27;};return a51_0x3d77();}var __importDefault=this&&this[a51_0x38de6e(0x125)]||function(_0x33ce33){const _0x516815=a51_0x38de6e;return _0x33ce33&&_0x33ce33[_0x516815(0x169)]?_0x33ce33:{'default':_0x33ce33};};Object[a51_0x38de6e(0x15b)](exports,a51_0x38de6e(0x169),{'value':!![]}),exports[a51_0x38de6e(0x15f)]=exports[a51_0x38de6e(0x160)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x38de6e(0x12f)));class LoggerService{constructor(){const _0xb5ce87=a51_0x38de6e;this[_0xb5ce87(0x149)]=path_1[_0xb5ce87(0x139)][_0xb5ce87(0x158)](process[_0xb5ce87(0x13f)](),_0xb5ce87(0x14f)),this[_0xb5ce87(0x12d)]();}[a51_0x38de6e(0x12d)](){const _0xe0dca7=a51_0x38de6e;!fs_1['default'][_0xe0dca7(0x124)](this['logsDir'])&&(fs_1[_0xe0dca7(0x139)][_0xe0dca7(0x13a)](this[_0xe0dca7(0x149)],{'recursive':!![]}),console[_0xe0dca7(0x162)](_0xe0dca7(0x14a)+this[_0xe0dca7(0x149)]));}[a51_0x38de6e(0x12a)](_0x77c497){const _0x47dc71=a51_0x38de6e,_0x2c303d=new Date()['toISOString']()[_0x47dc71(0x14d)]('T')[0x0];return path_1[_0x47dc71(0x139)][_0x47dc71(0x158)](this['logsDir'],_0x77c497+'_'+_0x2c303d+'.log');}['writeLog'](_0x29e318,_0x10324f){const _0x348eb3=a51_0x38de6e;try{const _0x201dfa=new Date()['toISOString'](),_0x2ea64f={'timestamp':_0x201dfa,..._0x10324f},_0x6f5e9c=JSON['stringify'](_0x2ea64f)+'\x0a',_0x17c777=this['getLogFileName'](_0x29e318);fs_1[_0x348eb3(0x139)]['appendFileSync'](_0x17c777,_0x6f5e9c,_0x348eb3(0x14e));}catch(_0x2f6562){console['error'](_0x348eb3(0x151)+_0x29e318+'\x20log:',_0x2f6562);}}['logWhiteDomainRequest'](_0x1a2c28,_0x468ed9,_0x4944e3,_0xa918d0){const _0x2e081d=a51_0x38de6e;this[_0x2e081d(0x14c)]('white_domain_requests',{'type':'REQUEST','gateway':_0x1a2c28,'endpoint':_0x468ed9,'method':_0x4944e3,'data':_0xa918d0});}[a51_0x38de6e(0x123)](_0x209752,_0x5b9e97,_0x56a501,_0x4b9599,_0x49d7ec){const _0x5e009c=a51_0x38de6e;this[_0x5e009c(0x14c)](_0x5e009c(0x143),{'type':_0x5e009c(0x146),'gateway':_0x209752,'endpoint':_0x5b9e97,'status':_0x56a501,'responseTime':_0x49d7ec,'data':_0x4b9599});}[a51_0x38de6e(0x157)](_0x5b01b4,_0x43f2ac,_0x395f13){const _0x45dba0=a51_0x38de6e;this[_0x45dba0(0x14c)](_0x45dba0(0x134),{'type':_0x45dba0(0x166),'gateway':_0x5b01b4,'endpoint':_0x43f2ac,'error':_0x395f13 instanceof Error?{'message':_0x395f13[_0x45dba0(0x144)],'stack':_0x395f13[_0x45dba0(0x15e)]}:_0x395f13});}[a51_0x38de6e(0x15c)](_0x20f76b,_0x419794,_0x347f62){const _0x344b0b=a51_0x38de6e;this['writeLog'](_0x344b0b(0x13c),{'type':'WEBHOOK_RECEIVED','gateway':_0x20f76b,'headers':_0x347f62,'data':_0x419794});}[a51_0x38de6e(0x153)](_0x12d1d5,_0x4c0814,_0x336ef0,_0x348f2e,_0x4916e6){const _0x50a827=a51_0x38de6e;this['writeLog'](_0x50a827(0x126),{'type':'WEBHOOK_PROCESSED','gateway':_0x12d1d5,'paymentId':_0x4c0814,'oldStatus':_0x336ef0,'newStatus':_0x348f2e,'originalData':_0x4916e6});}[a51_0x38de6e(0x164)](_0x32933b,_0x4d95fe,_0x1d9f2a){const _0x2de809=a51_0x38de6e;this[_0x2de809(0x14c)](_0x2de809(0x133),{'type':'WEBHOOK_ERROR','gateway':_0x32933b,'error':_0x4d95fe instanceof Error?{'message':_0x4d95fe[_0x2de809(0x144)],'stack':_0x4d95fe[_0x2de809(0x15e)]}:_0x4d95fe,'originalData':_0x1d9f2a});}[a51_0x38de6e(0x147)](_0x2caa36){const _0x35f6af=a51_0x38de6e;this[_0x35f6af(0x14c)](_0x35f6af(0x136),{'type':'COINTOPAY_STATUS_CHANGE',..._0x2caa36});}[a51_0x38de6e(0x161)](_0x2bec5a){const _0x4a5255=a51_0x38de6e;this[_0x4a5255(0x14c)]('cointopay_errors',{'type':_0x4a5255(0x145),..._0x2bec5a});}[a51_0x38de6e(0x16d)](_0x4b3142,_0x3d040f,_0x3e6861,_0x4c0422,_0x1ef462,_0x250c64){const _0x2ccbdf=a51_0x38de6e;this[_0x2ccbdf(0x14c)](_0x2ccbdf(0x132),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x4b3142,'webhookUrl':_0x3d040f,'event':_0x3e6861,'status':_0x4c0422,'responseTime':_0x1ef462,'payload':_0x250c64});}['logShopWebhookError'](_0x345bae,_0xaf44aa,_0x499a5f,_0x3a5bd5,_0x3e8beb){const _0x6ffb7c=a51_0x38de6e;this[_0x6ffb7c(0x14c)](_0x6ffb7c(0x15a),{'type':_0x6ffb7c(0x16a),'shopId':_0x345bae,'webhookUrl':_0xaf44aa,'event':_0x499a5f,'error':_0x3a5bd5 instanceof Error?{'message':_0x3a5bd5[_0x6ffb7c(0x144)],'stack':_0x3a5bd5[_0x6ffb7c(0x15e)]}:_0x3a5bd5,'payload':_0x3e8beb});}[a51_0x38de6e(0x168)](_0x8efcf9,_0x4ae4ac,_0x2dbcd1,_0x245b9e,_0x4982a2){const _0x3d8fd2=a51_0x38de6e;this[_0x3d8fd2(0x14c)](_0x3d8fd2(0x12e),{'type':_0x3d8fd2(0x127),'gateway':_0x8efcf9,'paymentId':_0x4ae4ac,'shopId':_0x2dbcd1,'amount':_0x245b9e,'currency':_0x4982a2});}['logApiCall'](_0x4bb355,_0x2b23d6,_0x2aa1d9,_0x1e83c2,_0x173e8e){const _0x4ac60e=a51_0x38de6e;this[_0x4ac60e(0x14c)](_0x4ac60e(0x155),{'type':_0x4ac60e(0x16e),'endpoint':_0x4bb355,'method':_0x2b23d6,'userId':_0x2aa1d9,'userRole':_0x1e83c2,'requestData':_0x173e8e});}['getLogStats'](){const _0x45fe22=a51_0x38de6e;try{const _0x552a30=fs_1[_0x45fe22(0x139)][_0x45fe22(0x137)](this[_0x45fe22(0x149)]),_0x253da0=_0x552a30[_0x45fe22(0x152)](_0x2fef88=>_0x2fef88[_0x45fe22(0x15d)]('.log')),_0x47719a=[...new Set(_0x253da0[_0x45fe22(0x130)](_0x2dd190=>_0x2dd190['split']('_')[0x0]))],_0x4a2126=_0x253da0[_0x45fe22(0x130)](_0x2aeb1f=>{const _0x498bfe=_0x45fe22,_0x4aeacb=path_1[_0x498bfe(0x139)]['join'](this['logsDir'],_0x2aeb1f),_0x1f016b=fs_1['default'][_0x498bfe(0x16f)](_0x4aeacb),[_0x449c30,_0x5deb79]=_0x2aeb1f[_0x498bfe(0x122)](_0x498bfe(0x141),'')[_0x498bfe(0x14d)]('_');return{'type':_0x449c30,'date':_0x5deb79,'size':_0x1f016b[_0x498bfe(0x167)]};})[_0x45fe22(0x142)]((_0x20fffa,_0x4b05aa)=>_0x4b05aa[_0x45fe22(0x163)][_0x45fe22(0x12c)](_0x20fffa['date']));return{'totalFiles':_0x253da0[_0x45fe22(0x13d)],'logTypes':_0x47719a,'latestLogs':_0x4a2126[_0x45fe22(0x154)](0x0,0xa)};}catch(_0x2bb6db){return console[_0x45fe22(0x156)]('Failed\x20to\x20get\x20log\x20stats:',_0x2bb6db),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x38de6e(0x13b)](_0x4c6e45=0x1e){const _0x43db31=a51_0x38de6e;try{const _0x13e4b3=fs_1[_0x43db31(0x139)][_0x43db31(0x137)](this[_0x43db31(0x149)]),_0x3661fe=new Date();_0x3661fe[_0x43db31(0x131)](_0x3661fe[_0x43db31(0x140)]()-_0x4c6e45);let _0x3771b7=0x0;_0x13e4b3['forEach'](_0x51e135=>{const _0x37121d=_0x43db31;if(!_0x51e135[_0x37121d(0x15d)](_0x37121d(0x141)))return;const _0x74ca90=path_1['default'][_0x37121d(0x158)](this[_0x37121d(0x149)],_0x51e135),_0x2de820=fs_1[_0x37121d(0x139)][_0x37121d(0x16f)](_0x74ca90);_0x2de820[_0x37121d(0x14b)]<_0x3661fe&&(fs_1[_0x37121d(0x139)][_0x37121d(0x16c)](_0x74ca90),_0x3771b7++,console[_0x37121d(0x162)](_0x37121d(0x135)+_0x51e135));}),console[_0x43db31(0x162)](_0x43db31(0x159)+_0x3771b7+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x4c6e45+_0x43db31(0x150));}catch(_0x22f2c2){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x22f2c2);}}}exports[a51_0x38de6e(0x160)]=LoggerService,exports['loggerService']=new LoggerService();