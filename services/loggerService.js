'use strict';const a51_0x443e4d=a51_0x500b;(function(_0x2bbf43,_0x2a9723){const _0x424144=a51_0x500b,_0x2b968c=_0x2bbf43();while(!![]){try{const _0x38c9e2=parseInt(_0x424144(0x18d))/0x1+-parseInt(_0x424144(0x1b9))/0x2+parseInt(_0x424144(0x199))/0x3+parseInt(_0x424144(0x1ca))/0x4+-parseInt(_0x424144(0x1a8))/0x5*(-parseInt(_0x424144(0x1bc))/0x6)+-parseInt(_0x424144(0x191))/0x7+parseInt(_0x424144(0x1b8))/0x8*(-parseInt(_0x424144(0x1b6))/0x9);if(_0x38c9e2===_0x2a9723)break;else _0x2b968c['push'](_0x2b968c['shift']());}catch(_0x542fa2){_0x2b968c['push'](_0x2b968c['shift']());}}}(a51_0x59eb,0x4fc4a));var __importDefault=this&&this[a51_0x443e4d(0x1c5)]||function(_0x31977a){return _0x31977a&&_0x31977a['__esModule']?_0x31977a:{'default':_0x31977a};};function a51_0x59eb(){const _0x51b66f=['PAYMENT_CREATED','white_domain_requests','statSync','cleanOldLogs','existsSync','125192UwgCuc','getLogFileName','.log','filter','155876tBUFpp','shop_webhooks_sent','API_CALL','\x20days)','writeLog','ERROR','api_calls','toISOString','758040Zkpwhp','path','WEBHOOK_ERROR','WEBHOOK_PROCESSED','🗑️\x20Deleted\x20old\x20log\x20file:\x20','length','white_domain_errors','📁\x20Created\x20logs\x20directory:\x20','stringify','size','default','slice','readdirSync','stack','logsDir','25tSSWSi','forEach','unlinkSync','__esModule','mtime','shop_webhooks_errors','WEBHOOK_RECEIVED','🧹\x20Cleaned\x20','date','payments_created','logWhiteDomainResponse','logShopWebhookError','logWebhookError','LoggerService','7644168MQbGnm','white_domain_responses','8sYTGir','538038amDTjl','logWhiteDomainError','logWebhookProcessed','652674ighlHA','cointopay_errors','utf8','SHOP_WEBHOOK_ERROR','appendFileSync','loggerService','cwd','endsWith','join','__importDefault','cointopay_status_changes','logCoinToPayError','webhooks_errors','mkdirSync','2182408VuZJHc','getDate','message','ensureLogsDirectory','logWebhookReceived','log','logCoinToPayStatus','webhooks_processed','COINTOPAY_ERROR','map','getLogStats'];a51_0x59eb=function(){return _0x51b66f;};return a51_0x59eb();}Object['defineProperty'](exports,a51_0x443e4d(0x1ab),{'value':!![]}),exports[a51_0x443e4d(0x1c1)]=exports[a51_0x443e4d(0x1b5)]=void 0x0;function a51_0x500b(_0xd99d91,_0x1a962e){const _0x59eba3=a51_0x59eb();return a51_0x500b=function(_0x500be2,_0x2502cc){_0x500be2=_0x500be2-0x185;let _0x56ab4f=_0x59eba3[_0x500be2];return _0x56ab4f;},a51_0x500b(_0xd99d91,_0x1a962e);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x443e4d(0x19a)));class LoggerService{constructor(){const _0x45356f=a51_0x443e4d;this[_0x45356f(0x1a7)]=path_1['default']['join'](process[_0x45356f(0x1c2)](),'logs'),this[_0x45356f(0x1cd)]();}[a51_0x443e4d(0x1cd)](){const _0x5c0675=a51_0x443e4d;!fs_1[_0x5c0675(0x1a3)][_0x5c0675(0x18c)](this[_0x5c0675(0x1a7)])&&(fs_1[_0x5c0675(0x1a3)][_0x5c0675(0x1c9)](this[_0x5c0675(0x1a7)],{'recursive':!![]}),console[_0x5c0675(0x1cf)](_0x5c0675(0x1a0)+this[_0x5c0675(0x1a7)]));}[a51_0x443e4d(0x18e)](_0x558ed8){const _0x2025ea=a51_0x443e4d,_0x89c6c5=new Date()[_0x2025ea(0x198)]()['split']('T')[0x0];return path_1[_0x2025ea(0x1a3)][_0x2025ea(0x1c4)](this[_0x2025ea(0x1a7)],_0x558ed8+'_'+_0x89c6c5+'.log');}[a51_0x443e4d(0x195)](_0x5a0a7a,_0x4be1bc){const _0x2e9ccd=a51_0x443e4d;try{const _0x276f5c=new Date()['toISOString'](),_0x2dfa21={'timestamp':_0x276f5c,..._0x4be1bc},_0xd95cac=JSON[_0x2e9ccd(0x1a1)](_0x2dfa21)+'\x0a',_0x2eef80=this['getLogFileName'](_0x5a0a7a);fs_1[_0x2e9ccd(0x1a3)][_0x2e9ccd(0x1c0)](_0x2eef80,_0xd95cac,_0x2e9ccd(0x1be));}catch(_0x27aa67){console['error']('Failed\x20to\x20write\x20'+_0x5a0a7a+'\x20log:',_0x27aa67);}}['logWhiteDomainRequest'](_0x19a73a,_0x276e6b,_0xabbe50,_0x3a0307){const _0x29b571=a51_0x443e4d;this['writeLog'](_0x29b571(0x189),{'type':'REQUEST','gateway':_0x19a73a,'endpoint':_0x276e6b,'method':_0xabbe50,'data':_0x3a0307});}[a51_0x443e4d(0x1b2)](_0xebcb36,_0x4ac090,_0x239fbb,_0x37967f,_0x55e2f9){const _0x1f756e=a51_0x443e4d;this[_0x1f756e(0x195)](_0x1f756e(0x1b7),{'type':'RESPONSE','gateway':_0xebcb36,'endpoint':_0x4ac090,'status':_0x239fbb,'responseTime':_0x55e2f9,'data':_0x37967f});}[a51_0x443e4d(0x1ba)](_0x510391,_0x500cad,_0x1f0ad3){const _0x1a7a51=a51_0x443e4d;this[_0x1a7a51(0x195)](_0x1a7a51(0x19f),{'type':_0x1a7a51(0x196),'gateway':_0x510391,'endpoint':_0x500cad,'error':_0x1f0ad3 instanceof Error?{'message':_0x1f0ad3[_0x1a7a51(0x1cc)],'stack':_0x1f0ad3[_0x1a7a51(0x1a6)]}:_0x1f0ad3});}[a51_0x443e4d(0x1ce)](_0x44efad,_0x481537,_0x23ceac){const _0x21f350=a51_0x443e4d;this[_0x21f350(0x195)]('webhooks_received',{'type':_0x21f350(0x1ae),'gateway':_0x44efad,'headers':_0x23ceac,'data':_0x481537});}[a51_0x443e4d(0x1bb)](_0x4aa7e2,_0x12b637,_0x19ae71,_0x4d0822,_0x529c1c){const _0x444c7f=a51_0x443e4d;this['writeLog'](_0x444c7f(0x1d1),{'type':_0x444c7f(0x19c),'gateway':_0x4aa7e2,'paymentId':_0x12b637,'oldStatus':_0x19ae71,'newStatus':_0x4d0822,'originalData':_0x529c1c});}[a51_0x443e4d(0x1b4)](_0x2a9b3b,_0x136fd9,_0x20bc16){const _0xe4fe4=a51_0x443e4d;this[_0xe4fe4(0x195)](_0xe4fe4(0x1c8),{'type':_0xe4fe4(0x19b),'gateway':_0x2a9b3b,'error':_0x136fd9 instanceof Error?{'message':_0x136fd9[_0xe4fe4(0x1cc)],'stack':_0x136fd9['stack']}:_0x136fd9,'originalData':_0x20bc16});}[a51_0x443e4d(0x1d0)](_0x2c7e9f){const _0x2d7051=a51_0x443e4d;this[_0x2d7051(0x195)](_0x2d7051(0x1c6),{'type':'COINTOPAY_STATUS_CHANGE',..._0x2c7e9f});}[a51_0x443e4d(0x1c7)](_0x140bd6){const _0x4a688a=a51_0x443e4d;this['writeLog'](_0x4a688a(0x1bd),{'type':_0x4a688a(0x185),..._0x140bd6});}['logShopWebhookSent'](_0x3acd58,_0x11d1d9,_0x4e0bfc,_0x114537,_0x13cf65,_0x4611ed){const _0x59a6c7=a51_0x443e4d;this['writeLog'](_0x59a6c7(0x192),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x3acd58,'webhookUrl':_0x11d1d9,'event':_0x4e0bfc,'status':_0x114537,'responseTime':_0x13cf65,'payload':_0x4611ed});}[a51_0x443e4d(0x1b3)](_0x4a5e5d,_0x4030ad,_0x3797b7,_0x4e3501,_0x1ade82){const _0x4d245c=a51_0x443e4d;this['writeLog'](_0x4d245c(0x1ad),{'type':_0x4d245c(0x1bf),'shopId':_0x4a5e5d,'webhookUrl':_0x4030ad,'event':_0x3797b7,'error':_0x4e3501 instanceof Error?{'message':_0x4e3501[_0x4d245c(0x1cc)],'stack':_0x4e3501[_0x4d245c(0x1a6)]}:_0x4e3501,'payload':_0x1ade82});}['logPaymentCreated'](_0x4b4aed,_0xfab759,_0x378a40,_0x1e3156,_0x582e1d){const _0x17414c=a51_0x443e4d;this['writeLog'](_0x17414c(0x1b1),{'type':_0x17414c(0x188),'gateway':_0x4b4aed,'paymentId':_0xfab759,'shopId':_0x378a40,'amount':_0x1e3156,'currency':_0x582e1d});}['logApiCall'](_0x24b6d0,_0x3f8da4,_0x5ba177,_0x58c184,_0xee7e86){const _0x5791aa=a51_0x443e4d;this[_0x5791aa(0x195)](_0x5791aa(0x197),{'type':_0x5791aa(0x193),'endpoint':_0x24b6d0,'method':_0x3f8da4,'userId':_0x5ba177,'userRole':_0x58c184,'requestData':_0xee7e86});}[a51_0x443e4d(0x187)](){const _0x50270f=a51_0x443e4d;try{const _0x2e820b=fs_1['default'][_0x50270f(0x1a5)](this['logsDir']),_0x15ffd7=_0x2e820b[_0x50270f(0x190)](_0x34fa1d=>_0x34fa1d[_0x50270f(0x1c3)](_0x50270f(0x18f))),_0xe9de3e=[...new Set(_0x15ffd7[_0x50270f(0x186)](_0x59aaec=>_0x59aaec['split']('_')[0x0]))],_0x584285=_0x15ffd7[_0x50270f(0x186)](_0x1cffb0=>{const _0x19c50a=_0x50270f,_0x53be93=path_1[_0x19c50a(0x1a3)][_0x19c50a(0x1c4)](this['logsDir'],_0x1cffb0),_0x509bbf=fs_1[_0x19c50a(0x1a3)][_0x19c50a(0x18a)](_0x53be93),[_0x33adc9,_0x1d1cc1]=_0x1cffb0['replace'](_0x19c50a(0x18f),'')['split']('_');return{'type':_0x33adc9,'date':_0x1d1cc1,'size':_0x509bbf[_0x19c50a(0x1a2)]};})['sort']((_0x5d0909,_0x147beb)=>_0x147beb[_0x50270f(0x1b0)]['localeCompare'](_0x5d0909['date']));return{'totalFiles':_0x15ffd7[_0x50270f(0x19e)],'logTypes':_0xe9de3e,'latestLogs':_0x584285[_0x50270f(0x1a4)](0x0,0xa)};}catch(_0x1113b6){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x1113b6),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x443e4d(0x18b)](_0x121d68=0x1e){const _0x8308e4=a51_0x443e4d;try{const _0x33f089=fs_1['default'][_0x8308e4(0x1a5)](this[_0x8308e4(0x1a7)]),_0x7f2b4a=new Date();_0x7f2b4a['setDate'](_0x7f2b4a[_0x8308e4(0x1cb)]()-_0x121d68);let _0xc90ff3=0x0;_0x33f089[_0x8308e4(0x1a9)](_0x3a0ea5=>{const _0x1662ce=_0x8308e4;if(!_0x3a0ea5[_0x1662ce(0x1c3)](_0x1662ce(0x18f)))return;const _0x2ddb45=path_1['default'][_0x1662ce(0x1c4)](this[_0x1662ce(0x1a7)],_0x3a0ea5),_0x5a056d=fs_1[_0x1662ce(0x1a3)][_0x1662ce(0x18a)](_0x2ddb45);_0x5a056d[_0x1662ce(0x1ac)]<_0x7f2b4a&&(fs_1['default'][_0x1662ce(0x1aa)](_0x2ddb45),_0xc90ff3++,console[_0x1662ce(0x1cf)](_0x1662ce(0x19d)+_0x3a0ea5));}),console[_0x8308e4(0x1cf)](_0x8308e4(0x1af)+_0xc90ff3+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x121d68+_0x8308e4(0x194));}catch(_0x26d86c){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x26d86c);}}}exports[a51_0x443e4d(0x1b5)]=LoggerService,exports[a51_0x443e4d(0x1c1)]=new LoggerService();