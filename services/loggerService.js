'use strict';const a48_0x1f5cba=a48_0x4cfb;function a48_0x4cfb(_0x58ce45,_0x212c17){const _0xba484c=a48_0xba48();return a48_0x4cfb=function(_0x4cfb38,_0x38d356){_0x4cfb38=_0x4cfb38-0xdd;let _0x1e8cd8=_0xba484c[_0x4cfb38];return _0x1e8cd8;},a48_0x4cfb(_0x58ce45,_0x212c17);}(function(_0x4ce59a,_0x3ead0){const _0x1b4769=a48_0x4cfb,_0x4cfca9=_0x4ce59a();while(!![]){try{const _0x9e1d3=parseInt(_0x1b4769(0x105))/0x1*(-parseInt(_0x1b4769(0x11b))/0x2)+parseInt(_0x1b4769(0x100))/0x3+parseInt(_0x1b4769(0xf3))/0x4*(parseInt(_0x1b4769(0x111))/0x5)+-parseInt(_0x1b4769(0xf9))/0x6+-parseInt(_0x1b4769(0x10c))/0x7+parseInt(_0x1b4769(0x126))/0x8+parseInt(_0x1b4769(0xf2))/0x9;if(_0x9e1d3===_0x3ead0)break;else _0x4cfca9['push'](_0x4cfca9['shift']());}catch(_0x6ea100){_0x4cfca9['push'](_0x4cfca9['shift']());}}}(a48_0xba48,0x99f00));var __importDefault=this&&this[a48_0x1f5cba(0x107)]||function(_0x15def2){const _0xafe8c4=a48_0x1f5cba;return _0x15def2&&_0x15def2[_0xafe8c4(0x12c)]?_0x15def2:{'default':_0x15def2};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a48_0x1f5cba(0x10b)]=exports[a48_0x1f5cba(0x10d)]=void 0x0;function a48_0xba48(){const _0x3f08e7=['logCoinToPayStatus','SHOP_WEBHOOK_SENT','\x20log:','shop_webhooks_sent','utf8','logsDir','COINTOPAY_STATUS_CHANGE','logWhiteDomainRequest','map','1546704cfTeBW','path','\x20old\x20log\x20files\x20(older\x20than\x20','Failed\x20to\x20write\x20','Failed\x20to\x20get\x20log\x20stats:','existsSync','__esModule','cleanOldLogs','unlinkSync','setDate','PAYMENT_CREATED','getDate','stack','SHOP_WEBHOOK_ERROR','forEach','logShopWebhookError','webhooks_processed','logWebhookError','logWhiteDomainResponse','white_domain_errors','size','📁\x20Created\x20logs\x20directory:\x20','ensureLogsDirectory','readdirSync','mkdirSync','cointopay_status_changes','slice','COINTOPAY_ERROR','cwd','white_domain_responses','6493473ilFbOT','441076ZZjOQQ','stringify','getLogFileName','filter','logCoinToPayError','date','7002516HGYQuI','\x20days)','mtime','shop_webhooks_errors','cointopay_errors','log','toISOString','3765738BFxNKS','.log','RESPONSE','api_calls','localeCompare','1qXXVvl','appendFileSync','__importDefault','Failed\x20to\x20clean\x20old\x20logs:','logPaymentCreated','error','loggerService','1172045VmUqZk','LoggerService','message','split','logApiCall','10jyBrMH','join','logShopWebhookSent','logWebhookReceived','writeLog','WEBHOOK_PROCESSED','default','sort','endsWith','replace','851140CFsdIq','getLogStats'];a48_0xba48=function(){return _0x3f08e7;};return a48_0xba48();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x1f5cba(0x127)));class LoggerService{constructor(){const _0x4dae40=a48_0x1f5cba;this[_0x4dae40(0x122)]=path_1[_0x4dae40(0x117)][_0x4dae40(0x112)](process[_0x4dae40(0xf0)](),'logs'),this[_0x4dae40(0xea)]();}[a48_0x1f5cba(0xea)](){const _0x3cf05f=a48_0x1f5cba;!fs_1[_0x3cf05f(0x117)][_0x3cf05f(0x12b)](this[_0x3cf05f(0x122)])&&(fs_1[_0x3cf05f(0x117)][_0x3cf05f(0xec)](this[_0x3cf05f(0x122)],{'recursive':!![]}),console[_0x3cf05f(0xfe)](_0x3cf05f(0xe9)+this[_0x3cf05f(0x122)]));}[a48_0x1f5cba(0xf5)](_0x3287ae){const _0x5504ec=a48_0x1f5cba,_0x26eeb4=new Date()['toISOString']()[_0x5504ec(0x10f)]('T')[0x0];return path_1[_0x5504ec(0x117)][_0x5504ec(0x112)](this[_0x5504ec(0x122)],_0x3287ae+'_'+_0x26eeb4+_0x5504ec(0x101));}['writeLog'](_0x4a103b,_0x858281){const _0x51258b=a48_0x1f5cba;try{const _0x3df06b=new Date()[_0x51258b(0xff)](),_0x493361={'timestamp':_0x3df06b,..._0x858281},_0x2ebdb4=JSON[_0x51258b(0xf4)](_0x493361)+'\x0a',_0x58f378=this['getLogFileName'](_0x4a103b);fs_1[_0x51258b(0x117)][_0x51258b(0x106)](_0x58f378,_0x2ebdb4,_0x51258b(0x121));}catch(_0x4d97f0){console[_0x51258b(0x10a)](_0x51258b(0x129)+_0x4a103b+_0x51258b(0x11f),_0x4d97f0);}}[a48_0x1f5cba(0x124)](_0x434197,_0x50e1c6,_0x15202b,_0x488020){const _0x2bc57b=a48_0x1f5cba;this[_0x2bc57b(0x115)]('white_domain_requests',{'type':'REQUEST','gateway':_0x434197,'endpoint':_0x50e1c6,'method':_0x15202b,'data':_0x488020});}[a48_0x1f5cba(0xe6)](_0x2a0e69,_0x4e1af9,_0xf0c9bb,_0x146c5f,_0x4a1315){const _0x712073=a48_0x1f5cba;this[_0x712073(0x115)](_0x712073(0xf1),{'type':_0x712073(0x102),'gateway':_0x2a0e69,'endpoint':_0x4e1af9,'status':_0xf0c9bb,'responseTime':_0x4a1315,'data':_0x146c5f});}['logWhiteDomainError'](_0x3190a9,_0xe8fcd9,_0x507d90){const _0x17a119=a48_0x1f5cba;this['writeLog'](_0x17a119(0xe7),{'type':'ERROR','gateway':_0x3190a9,'endpoint':_0xe8fcd9,'error':_0x507d90 instanceof Error?{'message':_0x507d90[_0x17a119(0x10e)],'stack':_0x507d90['stack']}:_0x507d90});}[a48_0x1f5cba(0x114)](_0xea372d,_0x192c2b,_0x4b03f1){const _0x2ca55c=a48_0x1f5cba;this[_0x2ca55c(0x115)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0xea372d,'headers':_0x4b03f1,'data':_0x192c2b});}['logWebhookProcessed'](_0x541bca,_0x26bcc,_0x54aa65,_0x40215d,_0x416e9d){const _0x334999=a48_0x1f5cba;this[_0x334999(0x115)](_0x334999(0xe4),{'type':_0x334999(0x116),'gateway':_0x541bca,'paymentId':_0x26bcc,'oldStatus':_0x54aa65,'newStatus':_0x40215d,'originalData':_0x416e9d});}[a48_0x1f5cba(0xe5)](_0x337b37,_0x1583fc,_0x404758){const _0x3e0d99=a48_0x1f5cba;this[_0x3e0d99(0x115)]('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x337b37,'error':_0x1583fc instanceof Error?{'message':_0x1583fc['message'],'stack':_0x1583fc[_0x3e0d99(0xe0)]}:_0x1583fc,'originalData':_0x404758});}[a48_0x1f5cba(0x11d)](_0x194232){const _0x28f174=a48_0x1f5cba;this[_0x28f174(0x115)](_0x28f174(0xed),{'type':_0x28f174(0x123),..._0x194232});}[a48_0x1f5cba(0xf7)](_0x453dfc){const _0x2ef931=a48_0x1f5cba;this[_0x2ef931(0x115)](_0x2ef931(0xfd),{'type':_0x2ef931(0xef),..._0x453dfc});}[a48_0x1f5cba(0x113)](_0x16c12a,_0x556cb9,_0x5ec876,_0x4058a0,_0x226359,_0x3f3e2e){const _0x31a06b=a48_0x1f5cba;this[_0x31a06b(0x115)](_0x31a06b(0x120),{'type':_0x31a06b(0x11e),'shopId':_0x16c12a,'webhookUrl':_0x556cb9,'event':_0x5ec876,'status':_0x4058a0,'responseTime':_0x226359,'payload':_0x3f3e2e});}[a48_0x1f5cba(0xe3)](_0x4987be,_0x3c1fe2,_0x3db5e6,_0x2c55a4,_0x52f824){const _0x580d1f=a48_0x1f5cba;this['writeLog'](_0x580d1f(0xfc),{'type':_0x580d1f(0xe1),'shopId':_0x4987be,'webhookUrl':_0x3c1fe2,'event':_0x3db5e6,'error':_0x2c55a4 instanceof Error?{'message':_0x2c55a4[_0x580d1f(0x10e)],'stack':_0x2c55a4[_0x580d1f(0xe0)]}:_0x2c55a4,'payload':_0x52f824});}[a48_0x1f5cba(0x109)](_0xc83bae,_0xd01b18,_0x35a3a4,_0x31c2d0,_0x126fe8){const _0x591ed7=a48_0x1f5cba;this[_0x591ed7(0x115)]('payments_created',{'type':_0x591ed7(0xde),'gateway':_0xc83bae,'paymentId':_0xd01b18,'shopId':_0x35a3a4,'amount':_0x31c2d0,'currency':_0x126fe8});}[a48_0x1f5cba(0x110)](_0x918104,_0x3943a8,_0x20cda1,_0x343b7c,_0xbc4162){const _0x432155=a48_0x1f5cba;this['writeLog'](_0x432155(0x103),{'type':'API_CALL','endpoint':_0x918104,'method':_0x3943a8,'userId':_0x20cda1,'userRole':_0x343b7c,'requestData':_0xbc4162});}[a48_0x1f5cba(0x11c)](){const _0x4b7f6f=a48_0x1f5cba;try{const _0x296499=fs_1[_0x4b7f6f(0x117)][_0x4b7f6f(0xeb)](this['logsDir']),_0x291cde=_0x296499[_0x4b7f6f(0xf6)](_0x8a948f=>_0x8a948f['endsWith'](_0x4b7f6f(0x101))),_0x56edc5=[...new Set(_0x291cde[_0x4b7f6f(0x125)](_0xe8800d=>_0xe8800d[_0x4b7f6f(0x10f)]('_')[0x0]))],_0x134b50=_0x291cde[_0x4b7f6f(0x125)](_0x6741e=>{const _0x4ad671=_0x4b7f6f,_0x4a4b7f=path_1['default'][_0x4ad671(0x112)](this[_0x4ad671(0x122)],_0x6741e),_0x3d06ed=fs_1[_0x4ad671(0x117)]['statSync'](_0x4a4b7f),[_0x492573,_0x160bea]=_0x6741e[_0x4ad671(0x11a)]('.log','')[_0x4ad671(0x10f)]('_');return{'type':_0x492573,'date':_0x160bea,'size':_0x3d06ed[_0x4ad671(0xe8)]};})[_0x4b7f6f(0x118)]((_0x514c96,_0x53032e)=>_0x53032e[_0x4b7f6f(0xf8)][_0x4b7f6f(0x104)](_0x514c96[_0x4b7f6f(0xf8)]));return{'totalFiles':_0x291cde['length'],'logTypes':_0x56edc5,'latestLogs':_0x134b50[_0x4b7f6f(0xee)](0x0,0xa)};}catch(_0x3de74f){return console['error'](_0x4b7f6f(0x12a),_0x3de74f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x1f5cba(0x12d)](_0x438cc3=0x1e){const _0x5e70ae=a48_0x1f5cba;try{const _0x1285cb=fs_1[_0x5e70ae(0x117)][_0x5e70ae(0xeb)](this[_0x5e70ae(0x122)]),_0x1b498b=new Date();_0x1b498b[_0x5e70ae(0xdd)](_0x1b498b[_0x5e70ae(0xdf)]()-_0x438cc3);let _0x243d5=0x0;_0x1285cb[_0x5e70ae(0xe2)](_0x34faaa=>{const _0x59ccd1=_0x5e70ae;if(!_0x34faaa[_0x59ccd1(0x119)](_0x59ccd1(0x101)))return;const _0x226037=path_1[_0x59ccd1(0x117)]['join'](this[_0x59ccd1(0x122)],_0x34faaa),_0x26129d=fs_1[_0x59ccd1(0x117)]['statSync'](_0x226037);_0x26129d[_0x59ccd1(0xfb)]<_0x1b498b&&(fs_1[_0x59ccd1(0x117)][_0x59ccd1(0x12e)](_0x226037),_0x243d5++,console[_0x59ccd1(0xfe)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x34faaa));}),console[_0x5e70ae(0xfe)]('🧹\x20Cleaned\x20'+_0x243d5+_0x5e70ae(0x128)+_0x438cc3+_0x5e70ae(0xfa));}catch(_0x1ecf63){console[_0x5e70ae(0x10a)](_0x5e70ae(0x108),_0x1ecf63);}}}exports[a48_0x1f5cba(0x10d)]=LoggerService,exports['loggerService']=new LoggerService();