'use strict';const a48_0x4dffb5=a48_0x5ae8;function a48_0x4678(){const _0x152064=['9251186ZPabYh','__esModule','defineProperty','logWebhookReceived','existsSync','\x20old\x20log\x20files\x20(older\x20than\x20','Failed\x20to\x20write\x20','5105FRvHHH','2924PBnTWX','ERROR','toISOString','logs','mkdirSync','webhooks_errors','stack','__importDefault','logShopWebhookError','setDate','getLogFileName','sort','message','webhooks_processed','1139472gopirQ','default','📁\x20Created\x20logs\x20directory:\x20','split','writeLog','log','slice','shop_webhooks_sent','loggerService','\x20log:','.log','logCoinToPayStatus','RESPONSE','WEBHOOK_ERROR','logWhiteDomainRequest','logPaymentCreated','PAYMENT_CREATED','WEBHOOK_RECEIVED','API_CALL','unlinkSync','logWebhookError','Failed\x20to\x20clean\x20old\x20logs:','join','error','forEach','cointopay_errors','shop_webhooks_errors','logWhiteDomainError','SHOP_WEBHOOK_SENT','map','localeCompare','Failed\x20to\x20get\x20log\x20stats:','readdirSync','logWebhookProcessed','white_domain_requests','cleanOldLogs','622518NnxSnm','WEBHOOK_PROCESSED','webhooks_received','10673968isxFpi','9nwTeHy','ensureLogsDirectory','white_domain_errors','1nRkHLv','getDate','logsDir','LoggerService','endsWith','api_calls','mtime','🧹\x20Cleaned\x20','1705422KviJmR','12365950fBiNUr','date','cointopay_status_changes','filter','logCoinToPayError'];a48_0x4678=function(){return _0x152064;};return a48_0x4678();}function a48_0x5ae8(_0x2bc640,_0x221567){const _0x467842=a48_0x4678();return a48_0x5ae8=function(_0x5ae87a,_0x5426fc){_0x5ae87a=_0x5ae87a-0x90;let _0x483887=_0x467842[_0x5ae87a];return _0x483887;},a48_0x5ae8(_0x2bc640,_0x221567);}(function(_0x121af6,_0x434a3b){const _0x3662a3=a48_0x5ae8,_0x16af32=_0x121af6();while(!![]){try{const _0x5a4457=-parseInt(_0x3662a3(0xd7))/0x1*(parseInt(_0x3662a3(0x90))/0x2)+-parseInt(_0x3662a3(0xd0))/0x3+-parseInt(_0x3662a3(0x9e))/0x4*(-parseInt(_0x3662a3(0x9d))/0x5)+-parseInt(_0x3662a3(0xac))/0x6+-parseInt(_0x3662a3(0x96))/0x7+-parseInt(_0x3662a3(0xd3))/0x8*(-parseInt(_0x3662a3(0xd4))/0x9)+parseInt(_0x3662a3(0x91))/0xa;if(_0x5a4457===_0x434a3b)break;else _0x16af32['push'](_0x16af32['shift']());}catch(_0x87259c){_0x16af32['push'](_0x16af32['shift']());}}}(a48_0x4678,0xb5ff9));var __importDefault=this&&this[a48_0x4dffb5(0xa5)]||function(_0x58c1b6){return _0x58c1b6&&_0x58c1b6['__esModule']?_0x58c1b6:{'default':_0x58c1b6};};Object[a48_0x4dffb5(0x98)](exports,a48_0x4dffb5(0x97),{'value':!![]}),exports[a48_0x4dffb5(0xb4)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x22397d=a48_0x4dffb5;this[_0x22397d(0xd9)]=path_1[_0x22397d(0xad)][_0x22397d(0xc2)](process['cwd'](),_0x22397d(0xa1)),this['ensureLogsDirectory']();}[a48_0x4dffb5(0xd5)](){const _0x52ec3f=a48_0x4dffb5;!fs_1[_0x52ec3f(0xad)][_0x52ec3f(0x9a)](this[_0x52ec3f(0xd9)])&&(fs_1[_0x52ec3f(0xad)][_0x52ec3f(0xa2)](this[_0x52ec3f(0xd9)],{'recursive':!![]}),console[_0x52ec3f(0xb1)](_0x52ec3f(0xae)+this[_0x52ec3f(0xd9)]));}[a48_0x4dffb5(0xa8)](_0x44a223){const _0x11993c=a48_0x4dffb5,_0x4272cf=new Date()[_0x11993c(0xa0)]()[_0x11993c(0xaf)]('T')[0x0];return path_1['default'][_0x11993c(0xc2)](this[_0x11993c(0xd9)],_0x44a223+'_'+_0x4272cf+_0x11993c(0xb6));}[a48_0x4dffb5(0xb0)](_0x240e7,_0x530076){const _0x548194=a48_0x4dffb5;try{const _0xe71ee1=new Date()['toISOString'](),_0x42be7f={'timestamp':_0xe71ee1,..._0x530076},_0x5e92fd=JSON['stringify'](_0x42be7f)+'\x0a',_0x16620e=this[_0x548194(0xa8)](_0x240e7);fs_1[_0x548194(0xad)]['appendFileSync'](_0x16620e,_0x5e92fd,'utf8');}catch(_0x422722){console[_0x548194(0xc3)](_0x548194(0x9c)+_0x240e7+_0x548194(0xb5),_0x422722);}}[a48_0x4dffb5(0xba)](_0x4ef446,_0x30e883,_0x1b4ec7,_0xcad6d8){const _0x6f7069=a48_0x4dffb5;this['writeLog'](_0x6f7069(0xce),{'type':'REQUEST','gateway':_0x4ef446,'endpoint':_0x30e883,'method':_0x1b4ec7,'data':_0xcad6d8});}['logWhiteDomainResponse'](_0x8691e5,_0x5daa90,_0x5cb78a,_0x4b8cbd,_0x4f32bd){const _0x2da7da=a48_0x4dffb5;this[_0x2da7da(0xb0)]('white_domain_responses',{'type':_0x2da7da(0xb8),'gateway':_0x8691e5,'endpoint':_0x5daa90,'status':_0x5cb78a,'responseTime':_0x4f32bd,'data':_0x4b8cbd});}[a48_0x4dffb5(0xc7)](_0x467888,_0x3a1cab,_0x36c377){const _0x14c1eb=a48_0x4dffb5;this['writeLog'](_0x14c1eb(0xd6),{'type':_0x14c1eb(0x9f),'gateway':_0x467888,'endpoint':_0x3a1cab,'error':_0x36c377 instanceof Error?{'message':_0x36c377[_0x14c1eb(0xaa)],'stack':_0x36c377[_0x14c1eb(0xa4)]}:_0x36c377});}[a48_0x4dffb5(0x99)](_0x193af1,_0x5eda84,_0x5d76ad){const _0x3e784b=a48_0x4dffb5;this[_0x3e784b(0xb0)](_0x3e784b(0xd2),{'type':_0x3e784b(0xbd),'gateway':_0x193af1,'headers':_0x5d76ad,'data':_0x5eda84});}[a48_0x4dffb5(0xcd)](_0x3ac3f6,_0x1c7a48,_0x2ce279,_0x34d6d5,_0x3fbd37){const _0x21ad31=a48_0x4dffb5;this[_0x21ad31(0xb0)](_0x21ad31(0xab),{'type':_0x21ad31(0xd1),'gateway':_0x3ac3f6,'paymentId':_0x1c7a48,'oldStatus':_0x2ce279,'newStatus':_0x34d6d5,'originalData':_0x3fbd37});}[a48_0x4dffb5(0xc0)](_0x4d4923,_0x12c0df,_0x2ecc71){const _0x5a323a=a48_0x4dffb5;this['writeLog'](_0x5a323a(0xa3),{'type':_0x5a323a(0xb9),'gateway':_0x4d4923,'error':_0x12c0df instanceof Error?{'message':_0x12c0df[_0x5a323a(0xaa)],'stack':_0x12c0df[_0x5a323a(0xa4)]}:_0x12c0df,'originalData':_0x2ecc71});}[a48_0x4dffb5(0xb7)](_0x112641){const _0x5b792f=a48_0x4dffb5;this[_0x5b792f(0xb0)](_0x5b792f(0x93),{'type':'COINTOPAY_STATUS_CHANGE',..._0x112641});}[a48_0x4dffb5(0x95)](_0x5acb37){const _0x4fd436=a48_0x4dffb5;this[_0x4fd436(0xb0)](_0x4fd436(0xc5),{'type':'COINTOPAY_ERROR',..._0x5acb37});}['logShopWebhookSent'](_0x56308f,_0x5972c0,_0x1ac57b,_0x3db99c,_0x2abfc1,_0x2f85db){const _0x1bcc94=a48_0x4dffb5;this['writeLog'](_0x1bcc94(0xb3),{'type':_0x1bcc94(0xc8),'shopId':_0x56308f,'webhookUrl':_0x5972c0,'event':_0x1ac57b,'status':_0x3db99c,'responseTime':_0x2abfc1,'payload':_0x2f85db});}[a48_0x4dffb5(0xa6)](_0x32685a,_0x5cec96,_0x3a5f48,_0x428dfa,_0x3b0d4f){const _0x337ad8=a48_0x4dffb5;this[_0x337ad8(0xb0)](_0x337ad8(0xc6),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x32685a,'webhookUrl':_0x5cec96,'event':_0x3a5f48,'error':_0x428dfa instanceof Error?{'message':_0x428dfa[_0x337ad8(0xaa)],'stack':_0x428dfa[_0x337ad8(0xa4)]}:_0x428dfa,'payload':_0x3b0d4f});}[a48_0x4dffb5(0xbb)](_0x222fc3,_0x16d4fd,_0x343d42,_0x1608b2,_0x59d134){const _0x5dbdd7=a48_0x4dffb5;this[_0x5dbdd7(0xb0)]('payments_created',{'type':_0x5dbdd7(0xbc),'gateway':_0x222fc3,'paymentId':_0x16d4fd,'shopId':_0x343d42,'amount':_0x1608b2,'currency':_0x59d134});}['logApiCall'](_0x42066f,_0x1a85d1,_0x1abbf4,_0x438864,_0x3daaa0){const _0x3242b0=a48_0x4dffb5;this[_0x3242b0(0xb0)](_0x3242b0(0xdc),{'type':_0x3242b0(0xbe),'endpoint':_0x42066f,'method':_0x1a85d1,'userId':_0x1abbf4,'userRole':_0x438864,'requestData':_0x3daaa0});}['getLogStats'](){const _0x41073e=a48_0x4dffb5;try{const _0x2b86f3=fs_1[_0x41073e(0xad)]['readdirSync'](this[_0x41073e(0xd9)]),_0x361216=_0x2b86f3[_0x41073e(0x94)](_0x3d6395=>_0x3d6395[_0x41073e(0xdb)](_0x41073e(0xb6))),_0x2d4543=[...new Set(_0x361216[_0x41073e(0xc9)](_0x4ab890=>_0x4ab890[_0x41073e(0xaf)]('_')[0x0]))],_0x4b3cec=_0x361216[_0x41073e(0xc9)](_0x2c168e=>{const _0x1d58d0=_0x41073e,_0x37430c=path_1[_0x1d58d0(0xad)][_0x1d58d0(0xc2)](this[_0x1d58d0(0xd9)],_0x2c168e),_0x2bea9f=fs_1[_0x1d58d0(0xad)]['statSync'](_0x37430c),[_0xb910dc,_0x167bf2]=_0x2c168e['replace']('.log','')['split']('_');return{'type':_0xb910dc,'date':_0x167bf2,'size':_0x2bea9f['size']};})[_0x41073e(0xa9)]((_0x4b6eb8,_0x5accc9)=>_0x5accc9[_0x41073e(0x92)][_0x41073e(0xca)](_0x4b6eb8[_0x41073e(0x92)]));return{'totalFiles':_0x361216['length'],'logTypes':_0x2d4543,'latestLogs':_0x4b3cec[_0x41073e(0xb2)](0x0,0xa)};}catch(_0x2d8b89){return console[_0x41073e(0xc3)](_0x41073e(0xcb),_0x2d8b89),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x4dffb5(0xcf)](_0x58215d=0x1e){const _0x52e37d=a48_0x4dffb5;try{const _0xeeff0f=fs_1[_0x52e37d(0xad)][_0x52e37d(0xcc)](this[_0x52e37d(0xd9)]),_0x368172=new Date();_0x368172[_0x52e37d(0xa7)](_0x368172[_0x52e37d(0xd8)]()-_0x58215d);let _0x475a88=0x0;_0xeeff0f[_0x52e37d(0xc4)](_0x4cef61=>{const _0x402780=_0x52e37d;if(!_0x4cef61[_0x402780(0xdb)]('.log'))return;const _0xfe76df=path_1[_0x402780(0xad)][_0x402780(0xc2)](this[_0x402780(0xd9)],_0x4cef61),_0x59d1ab=fs_1[_0x402780(0xad)]['statSync'](_0xfe76df);_0x59d1ab[_0x402780(0xdd)]<_0x368172&&(fs_1[_0x402780(0xad)][_0x402780(0xbf)](_0xfe76df),_0x475a88++,console[_0x402780(0xb1)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x4cef61));}),console[_0x52e37d(0xb1)](_0x52e37d(0xde)+_0x475a88+_0x52e37d(0x9b)+_0x58215d+'\x20days)');}catch(_0x590ba7){console[_0x52e37d(0xc3)](_0x52e37d(0xc1),_0x590ba7);}}}exports[a48_0x4dffb5(0xda)]=LoggerService,exports[a48_0x4dffb5(0xb4)]=new LoggerService();