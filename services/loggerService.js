'use strict';const a53_0x97ec3f=a53_0xf137;(function(_0x37d34f,_0x30fa3d){const _0x3759f6=a53_0xf137,_0x5ea83b=_0x37d34f();while(!![]){try{const _0xd1a160=parseInt(_0x3759f6(0x180))/0x1+-parseInt(_0x3759f6(0x15f))/0x2*(-parseInt(_0x3759f6(0x188))/0x3)+-parseInt(_0x3759f6(0x17b))/0x4*(-parseInt(_0x3759f6(0x18c))/0x5)+-parseInt(_0x3759f6(0x19a))/0x6*(-parseInt(_0x3759f6(0x1a0))/0x7)+-parseInt(_0x3759f6(0x160))/0x8+parseInt(_0x3759f6(0x192))/0x9+parseInt(_0x3759f6(0x18a))/0xa*(-parseInt(_0x3759f6(0x176))/0xb);if(_0xd1a160===_0x30fa3d)break;else _0x5ea83b['push'](_0x5ea83b['shift']());}catch(_0x54f4da){_0x5ea83b['push'](_0x5ea83b['shift']());}}}(a53_0x4bdc,0x708bd));var __importDefault=this&&this[a53_0x97ec3f(0x18b)]||function(_0x29337e){const _0x2c3a4f=a53_0x97ec3f;return _0x29337e&&_0x29337e[_0x2c3a4f(0x186)]?_0x29337e:{'default':_0x29337e};};function a53_0xf137(_0x4f8083,_0x54aac0){const _0x4bdcf4=a53_0x4bdc();return a53_0xf137=function(_0xf137a5,_0x45bd54){_0xf137a5=_0xf137a5-0x15c;let _0x1db137=_0x4bdcf4[_0xf137a5];return _0x1db137;},a53_0xf137(_0x4f8083,_0x54aac0);}Object[a53_0x97ec3f(0x17c)](exports,a53_0x97ec3f(0x186),{'value':!![]}),exports[a53_0x97ec3f(0x195)]=exports[a53_0x97ec3f(0x173)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x4f76da=a53_0x97ec3f;this[_0x4f76da(0x1aa)]=path_1[_0x4f76da(0x17e)][_0x4f76da(0x165)](process[_0x4f76da(0x18e)](),'logs'),this['ensureLogsDirectory']();}[a53_0x97ec3f(0x168)](){const _0x4b4c00=a53_0x97ec3f;!fs_1[_0x4b4c00(0x17e)]['existsSync'](this[_0x4b4c00(0x1aa)])&&(fs_1[_0x4b4c00(0x17e)][_0x4b4c00(0x16c)](this[_0x4b4c00(0x1aa)],{'recursive':!![]}),console[_0x4b4c00(0x16d)](_0x4b4c00(0x199)+this[_0x4b4c00(0x1aa)]));}[a53_0x97ec3f(0x171)](_0x254439){const _0xa72559=a53_0x97ec3f,_0xf6b22e=new Date()[_0xa72559(0x1a8)]()[_0xa72559(0x167)]('T')[0x0];return path_1[_0xa72559(0x17e)][_0xa72559(0x165)](this[_0xa72559(0x1aa)],_0x254439+'_'+_0xf6b22e+_0xa72559(0x163));}[a53_0x97ec3f(0x17f)](_0x155b36,_0x193b72){const _0xbe01f1=a53_0x97ec3f;try{const _0x2e138f=new Date()[_0xbe01f1(0x1a8)](),_0x5ecc6d={'timestamp':_0x2e138f,..._0x193b72},_0x5d5998=JSON['stringify'](_0x5ecc6d)+'\x0a',_0x169b50=this[_0xbe01f1(0x171)](_0x155b36);fs_1[_0xbe01f1(0x17e)][_0xbe01f1(0x193)](_0x169b50,_0x5d5998,'utf8');}catch(_0x505234){console[_0xbe01f1(0x16f)](_0xbe01f1(0x183)+_0x155b36+_0xbe01f1(0x175),_0x505234);}}[a53_0x97ec3f(0x19b)](_0x32585c,_0x26ed55,_0x4fe06b,_0x3f9757){const _0x41a62a=a53_0x97ec3f;this[_0x41a62a(0x17f)](_0x41a62a(0x197),{'type':_0x41a62a(0x196),'gateway':_0x32585c,'endpoint':_0x26ed55,'method':_0x4fe06b,'data':_0x3f9757});}[a53_0x97ec3f(0x15e)](_0xd511bf,_0x191dfd,_0x382b3b,_0x1a70a9,_0x40bd8f){const _0x8eaef5=a53_0x97ec3f;this[_0x8eaef5(0x17f)]('white_domain_responses',{'type':'RESPONSE','gateway':_0xd511bf,'endpoint':_0x191dfd,'status':_0x382b3b,'responseTime':_0x40bd8f,'data':_0x1a70a9});}[a53_0x97ec3f(0x1a2)](_0xd55e8a,_0x5359a8,_0x338a46){const _0x4e01cc=a53_0x97ec3f;this[_0x4e01cc(0x17f)](_0x4e01cc(0x1a6),{'type':_0x4e01cc(0x19c),'gateway':_0xd55e8a,'endpoint':_0x5359a8,'error':_0x338a46 instanceof Error?{'message':_0x338a46['message'],'stack':_0x338a46[_0x4e01cc(0x17a)]}:_0x338a46});}[a53_0x97ec3f(0x1ab)](_0x4e5df7,_0x3b6217,_0x3ea35d){const _0x3571a3=a53_0x97ec3f;this[_0x3571a3(0x17f)](_0x3571a3(0x164),{'type':'WEBHOOK_RECEIVED','gateway':_0x4e5df7,'headers':_0x3ea35d,'data':_0x3b6217});}['logWebhookProcessed'](_0x4f5eb8,_0x59607a,_0x544dd7,_0x223d90,_0x3d086c){const _0xe00b56=a53_0x97ec3f;this[_0xe00b56(0x17f)](_0xe00b56(0x191),{'type':_0xe00b56(0x198),'gateway':_0x4f5eb8,'paymentId':_0x59607a,'oldStatus':_0x544dd7,'newStatus':_0x223d90,'originalData':_0x3d086c});}[a53_0x97ec3f(0x166)](_0x1f84c7,_0x2ae2a5,_0x4d61f7){const _0x2497c4=a53_0x97ec3f;this[_0x2497c4(0x17f)](_0x2497c4(0x1a5),{'type':_0x2497c4(0x1a9),'gateway':_0x1f84c7,'error':_0x2ae2a5 instanceof Error?{'message':_0x2ae2a5['message'],'stack':_0x2ae2a5[_0x2497c4(0x17a)]}:_0x2ae2a5,'originalData':_0x4d61f7});}[a53_0x97ec3f(0x181)](_0x26a22b){const _0x5f22aa=a53_0x97ec3f;this[_0x5f22aa(0x17f)](_0x5f22aa(0x19d),{'type':_0x5f22aa(0x190),..._0x26a22b});}[a53_0x97ec3f(0x1a4)](_0xba8d34){const _0x228638=a53_0x97ec3f;this[_0x228638(0x17f)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0xba8d34});}[a53_0x97ec3f(0x16a)](_0x438e5c,_0x5143d6,_0xf05f12,_0x5c664b,_0x130d47,_0x411896){const _0x30d81f=a53_0x97ec3f;this[_0x30d81f(0x17f)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x438e5c,'webhookUrl':_0x5143d6,'event':_0xf05f12,'status':_0x5c664b,'responseTime':_0x130d47,'payload':_0x411896});}['logShopWebhookError'](_0x5d5053,_0x371a0f,_0x5dcfb5,_0x56a658,_0x3fb2b9){const _0x5d2809=a53_0x97ec3f;this[_0x5d2809(0x17f)]('shop_webhooks_errors',{'type':_0x5d2809(0x18d),'shopId':_0x5d5053,'webhookUrl':_0x371a0f,'event':_0x5dcfb5,'error':_0x56a658 instanceof Error?{'message':_0x56a658[_0x5d2809(0x16b)],'stack':_0x56a658[_0x5d2809(0x17a)]}:_0x56a658,'payload':_0x3fb2b9});}['logPaymentCreated'](_0x2237c0,_0x28272e,_0x29c55b,_0x2eb11d,_0x559cd6){const _0x96fdf=a53_0x97ec3f;this[_0x96fdf(0x17f)](_0x96fdf(0x16e),{'type':_0x96fdf(0x169),'gateway':_0x2237c0,'paymentId':_0x28272e,'shopId':_0x29c55b,'amount':_0x2eb11d,'currency':_0x559cd6});}[a53_0x97ec3f(0x194)](_0x37ac4d,_0x47d2f2,_0x58ef6d,_0x5749f1,_0x5e16fb){const _0x20638a=a53_0x97ec3f;this['writeLog'](_0x20638a(0x178),{'type':_0x20638a(0x184),'endpoint':_0x37ac4d,'method':_0x47d2f2,'userId':_0x58ef6d,'userRole':_0x5749f1,'requestData':_0x5e16fb});}[a53_0x97ec3f(0x18f)](){const _0x2d2b92=a53_0x97ec3f;try{const _0x357930=fs_1[_0x2d2b92(0x17e)][_0x2d2b92(0x177)](this[_0x2d2b92(0x1aa)]),_0x493563=_0x357930['filter'](_0x3a4cde=>_0x3a4cde[_0x2d2b92(0x170)](_0x2d2b92(0x163))),_0x139fdd=[...new Set(_0x493563[_0x2d2b92(0x15d)](_0x622e0f=>_0x622e0f[_0x2d2b92(0x167)]('_')[0x0]))],_0x2a0f25=_0x493563['map'](_0x5be074=>{const _0xc8e304=_0x2d2b92,_0x44bd17=path_1[_0xc8e304(0x17e)][_0xc8e304(0x165)](this[_0xc8e304(0x1aa)],_0x5be074),_0x17a742=fs_1[_0xc8e304(0x17e)][_0xc8e304(0x179)](_0x44bd17),[_0x308803,_0x4c39ba]=_0x5be074['replace'](_0xc8e304(0x163),'')[_0xc8e304(0x167)]('_');return{'type':_0x308803,'date':_0x4c39ba,'size':_0x17a742[_0xc8e304(0x19e)]};})['sort']((_0x7bf91c,_0x33c59d)=>_0x33c59d[_0x2d2b92(0x172)][_0x2d2b92(0x187)](_0x7bf91c[_0x2d2b92(0x172)]));return{'totalFiles':_0x493563[_0x2d2b92(0x1a3)],'logTypes':_0x139fdd,'latestLogs':_0x2a0f25[_0x2d2b92(0x161)](0x0,0xa)};}catch(_0xfad7b9){return console[_0x2d2b92(0x16f)](_0x2d2b92(0x182),_0xfad7b9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x97ec3f(0x17d)](_0x188ac9=0x1e){const _0x25acae=a53_0x97ec3f;try{const _0x26330e=fs_1[_0x25acae(0x17e)][_0x25acae(0x177)](this['logsDir']),_0x10b053=new Date();_0x10b053['setDate'](_0x10b053[_0x25acae(0x185)]()-_0x188ac9);let _0x262b7a=0x0;_0x26330e[_0x25acae(0x1a7)](_0x3a2999=>{const _0x2cd2be=_0x25acae;if(!_0x3a2999[_0x2cd2be(0x170)](_0x2cd2be(0x163)))return;const _0x525e4f=path_1[_0x2cd2be(0x17e)][_0x2cd2be(0x165)](this[_0x2cd2be(0x1aa)],_0x3a2999),_0x262db4=fs_1[_0x2cd2be(0x17e)][_0x2cd2be(0x179)](_0x525e4f);_0x262db4[_0x2cd2be(0x15c)]<_0x10b053&&(fs_1[_0x2cd2be(0x17e)][_0x2cd2be(0x162)](_0x525e4f),_0x262b7a++,console[_0x2cd2be(0x16d)](_0x2cd2be(0x189)+_0x3a2999));}),console[_0x25acae(0x16d)]('🧹\x20Cleaned\x20'+_0x262b7a+_0x25acae(0x174)+_0x188ac9+_0x25acae(0x1a1));}catch(_0x40e41f){console['error'](_0x25acae(0x19f),_0x40e41f);}}}function a53_0x4bdc(){const _0x503ee9=['logShopWebhookSent','message','mkdirSync','log','payments_created','error','endsWith','getLogFileName','date','LoggerService','\x20old\x20log\x20files\x20(older\x20than\x20','\x20log:','110evcUyr','readdirSync','api_calls','statSync','stack','1322308ZhYvCv','defineProperty','cleanOldLogs','default','writeLog','424099XegXgz','logCoinToPayStatus','Failed\x20to\x20get\x20log\x20stats:','Failed\x20to\x20write\x20','API_CALL','getDate','__esModule','localeCompare','45sPKcSe','🗑️\x20Deleted\x20old\x20log\x20file:\x20','679130cLkQNr','__importDefault','10cVslEg','SHOP_WEBHOOK_ERROR','cwd','getLogStats','COINTOPAY_STATUS_CHANGE','webhooks_processed','4489947uPUjeA','appendFileSync','logApiCall','loggerService','REQUEST','white_domain_requests','WEBHOOK_PROCESSED','📁\x20Created\x20logs\x20directory:\x20','9942RWZvpX','logWhiteDomainRequest','ERROR','cointopay_status_changes','size','Failed\x20to\x20clean\x20old\x20logs:','707OQXXJM','\x20days)','logWhiteDomainError','length','logCoinToPayError','webhooks_errors','white_domain_errors','forEach','toISOString','WEBHOOK_ERROR','logsDir','logWebhookReceived','mtime','map','logWhiteDomainResponse','5602RkBYIN','5227112zNKtpq','slice','unlinkSync','.log','webhooks_received','join','logWebhookError','split','ensureLogsDirectory','PAYMENT_CREATED'];a53_0x4bdc=function(){return _0x503ee9;};return a53_0x4bdc();}exports[a53_0x97ec3f(0x173)]=LoggerService,exports[a53_0x97ec3f(0x195)]=new LoggerService();