'use strict';const a71_0x571fa5=a71_0xf067;(function(_0x95f24c,_0xc7353){const _0x212228=a71_0xf067,_0x3bbebe=_0x95f24c();while(!![]){try{const _0x557419=parseInt(_0x212228(0xc4))/0x1+-parseInt(_0x212228(0x86))/0x2*(parseInt(_0x212228(0x9d))/0x3)+-parseInt(_0x212228(0xbb))/0x4*(-parseInt(_0x212228(0x7a))/0x5)+parseInt(_0x212228(0x83))/0x6*(parseInt(_0x212228(0xb3))/0x7)+-parseInt(_0x212228(0x84))/0x8+-parseInt(_0x212228(0x98))/0x9+parseInt(_0x212228(0xba))/0xa*(-parseInt(_0x212228(0x89))/0xb);if(_0x557419===_0xc7353)break;else _0x3bbebe['push'](_0x3bbebe['shift']());}catch(_0x9470db){_0x3bbebe['push'](_0x3bbebe['shift']());}}}(a71_0x3854,0xcc972));function a71_0x3854(){const _0x178c6f=['existsSync','.log','logShopWebhookError','logWhiteDomainError','api_calls','__importDefault','WEBHOOK_ERROR','cointopay_errors','COINTOPAY_ERROR','RESPONSE','SHOP_WEBHOOK_SENT','loggerService','message','8401225sbVuZf','default','getLogFileName','ðŸ“\x20Created\x20logs\x20directory:\x20','logWebhookError','white_domain_responses','setDate','20ibDkLq','232872Tebscl','toISOString','getDate','cointopay_status_changes','cleanOldLogs','LoggerService','map','Failed\x20to\x20clean\x20old\x20logs:','shop_webhooks_errors','1219467SWCDfI','replace','stack','date','15rudknY','path','\x20log:','logCoinToPayError','payments_created','COINTOPAY_STATUS_CHANGE','filter','cwd','white_domain_requests','6UYiZEo','733960uNjEvS','join','102bTkGAG','shop_webhooks_sent','writeLog','4696868JikMHK','logPaymentCreated','endsWith','PAYMENT_CREATED','ERROR','webhooks_processed','ensureLogsDirectory','white_domain_errors','API_CALL','statSync','utf8','localeCompare','logWebhookReceived','log','appendFileSync','2852496XdhIGY','logs','logShopWebhookSent','readdirSync','error','29037YsLDbQ','ðŸ§¹\x20Cleaned\x20','getLogStats','split','logWhiteDomainRequest','Failed\x20to\x20write\x20','logsDir','stringify','logCoinToPayStatus'];a71_0x3854=function(){return _0x178c6f;};return a71_0x3854();}var __importDefault=this&&this[a71_0x571fa5(0xab)]||function(_0x581e75){return _0x581e75&&_0x581e75['__esModule']?_0x581e75:{'default':_0x581e75};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a71_0x571fa5(0xb1)]=exports[a71_0x571fa5(0xc0)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a71_0x571fa5(0x7b)));function a71_0xf067(_0x466588,_0x1fb9a8){_0x466588=_0x466588-0x7a;const _0x38548a=a71_0x3854();let _0xf06748=_0x38548a[_0x466588];return _0xf06748;}class LoggerService{constructor(){const _0x17ce69=a71_0x571fa5;this[_0x17ce69(0xa3)]=path_1[_0x17ce69(0xb4)][_0x17ce69(0x85)](process[_0x17ce69(0x81)](),_0x17ce69(0x99)),this[_0x17ce69(0x8f)]();}[a71_0x571fa5(0x8f)](){const _0x5f570e=a71_0x571fa5;!fs_1[_0x5f570e(0xb4)][_0x5f570e(0xa6)](this['logsDir'])&&(fs_1[_0x5f570e(0xb4)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console['log'](_0x5f570e(0xb6)+this[_0x5f570e(0xa3)]));}['getLogFileName'](_0x349408){const _0x181330=a71_0x571fa5,_0x2ceaa7=new Date()[_0x181330(0xbc)]()[_0x181330(0xa0)]('T')[0x0];return path_1[_0x181330(0xb4)][_0x181330(0x85)](this[_0x181330(0xa3)],_0x349408+'_'+_0x2ceaa7+'.log');}[a71_0x571fa5(0x88)](_0x2d6ea9,_0x144872){const _0x2619b6=a71_0x571fa5;try{const _0x39d342=new Date()[_0x2619b6(0xbc)](),_0x3bce1f={'timestamp':_0x39d342,..._0x144872},_0x1a8831=JSON[_0x2619b6(0xa4)](_0x3bce1f)+'\x0a',_0x1d16a2=this[_0x2619b6(0xb5)](_0x2d6ea9);fs_1[_0x2619b6(0xb4)][_0x2619b6(0x97)](_0x1d16a2,_0x1a8831,_0x2619b6(0x93));}catch(_0x30bc7c){console['error'](_0x2619b6(0xa2)+_0x2d6ea9+_0x2619b6(0x7c),_0x30bc7c);}}[a71_0x571fa5(0xa1)](_0x542708,_0x30c65e,_0x3dbd42,_0x46b229){const _0x42d40e=a71_0x571fa5;this[_0x42d40e(0x88)](_0x42d40e(0x82),{'type':'REQUEST','gateway':_0x542708,'endpoint':_0x30c65e,'method':_0x3dbd42,'data':_0x46b229});}['logWhiteDomainResponse'](_0xba53bc,_0x14489f,_0x5d7d61,_0x145eec,_0x137207){const _0x3132b0=a71_0x571fa5;this[_0x3132b0(0x88)](_0x3132b0(0xb8),{'type':_0x3132b0(0xaf),'gateway':_0xba53bc,'endpoint':_0x14489f,'status':_0x5d7d61,'responseTime':_0x137207,'data':_0x145eec});}[a71_0x571fa5(0xa9)](_0x467963,_0x3ca696,_0x487553){const _0x149a16=a71_0x571fa5;this['writeLog'](_0x149a16(0x90),{'type':_0x149a16(0x8d),'gateway':_0x467963,'endpoint':_0x3ca696,'error':_0x487553 instanceof Error?{'message':_0x487553[_0x149a16(0xb2)],'stack':_0x487553[_0x149a16(0xc6)]}:_0x487553});}[a71_0x571fa5(0x95)](_0xd2231c,_0x392532,_0x3e3bad){const _0x2c03b8=a71_0x571fa5;this[_0x2c03b8(0x88)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0xd2231c,'headers':_0x3e3bad,'data':_0x392532});}['logWebhookProcessed'](_0x406238,_0x321845,_0x256c3d,_0x5cbb10,_0x14d219){const _0x565087=a71_0x571fa5;this[_0x565087(0x88)](_0x565087(0x8e),{'type':'WEBHOOK_PROCESSED','gateway':_0x406238,'paymentId':_0x321845,'oldStatus':_0x256c3d,'newStatus':_0x5cbb10,'originalData':_0x14d219});}[a71_0x571fa5(0xb7)](_0x46631d,_0x21f10f,_0x54a823){const _0xbd5fba=a71_0x571fa5;this[_0xbd5fba(0x88)]('webhooks_errors',{'type':_0xbd5fba(0xac),'gateway':_0x46631d,'error':_0x21f10f instanceof Error?{'message':_0x21f10f['message'],'stack':_0x21f10f[_0xbd5fba(0xc6)]}:_0x21f10f,'originalData':_0x54a823});}[a71_0x571fa5(0xa5)](_0x422445){const _0x3375a5=a71_0x571fa5;this[_0x3375a5(0x88)](_0x3375a5(0xbe),{'type':_0x3375a5(0x7f),..._0x422445});}[a71_0x571fa5(0x7d)](_0x2eb7fd){const _0x31e0f6=a71_0x571fa5;this[_0x31e0f6(0x88)](_0x31e0f6(0xad),{'type':_0x31e0f6(0xae),..._0x2eb7fd});}[a71_0x571fa5(0x9a)](_0xd53c4b,_0x182bfc,_0x576be9,_0x46bba7,_0x50c171,_0x423c07){const _0x4c1160=a71_0x571fa5;this[_0x4c1160(0x88)](_0x4c1160(0x87),{'type':_0x4c1160(0xb0),'shopId':_0xd53c4b,'webhookUrl':_0x182bfc,'event':_0x576be9,'status':_0x46bba7,'responseTime':_0x50c171,'payload':_0x423c07});}[a71_0x571fa5(0xa8)](_0x130dab,_0x4ca526,_0x3e2360,_0x1521b0,_0x463f42){const _0x143856=a71_0x571fa5;this[_0x143856(0x88)](_0x143856(0xc3),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x130dab,'webhookUrl':_0x4ca526,'event':_0x3e2360,'error':_0x1521b0 instanceof Error?{'message':_0x1521b0[_0x143856(0xb2)],'stack':_0x1521b0['stack']}:_0x1521b0,'payload':_0x463f42});}[a71_0x571fa5(0x8a)](_0x4e24a2,_0x34bc11,_0x46011d,_0x1d3abe,_0x57b996){const _0x14a134=a71_0x571fa5;this['writeLog'](_0x14a134(0x7e),{'type':_0x14a134(0x8c),'gateway':_0x4e24a2,'paymentId':_0x34bc11,'shopId':_0x46011d,'amount':_0x1d3abe,'currency':_0x57b996});}['logApiCall'](_0x10856b,_0x11906c,_0x619753,_0x586c5c,_0x3ca270){const _0x5f2591=a71_0x571fa5;this[_0x5f2591(0x88)](_0x5f2591(0xaa),{'type':_0x5f2591(0x91),'endpoint':_0x10856b,'method':_0x11906c,'userId':_0x619753,'userRole':_0x586c5c,'requestData':_0x3ca270});}[a71_0x571fa5(0x9f)](){const _0x22ae2d=a71_0x571fa5;try{const _0x5402d9=fs_1['default']['readdirSync'](this['logsDir']),_0xef7739=_0x5402d9[_0x22ae2d(0x80)](_0x3ba82a=>_0x3ba82a[_0x22ae2d(0x8b)](_0x22ae2d(0xa7))),_0x179917=[...new Set(_0xef7739[_0x22ae2d(0xc1)](_0xf11ddd=>_0xf11ddd[_0x22ae2d(0xa0)]('_')[0x0]))],_0x86e65d=_0xef7739['map'](_0x289946=>{const _0x5224db=_0x22ae2d,_0xc0d241=path_1[_0x5224db(0xb4)][_0x5224db(0x85)](this['logsDir'],_0x289946),_0x3aed10=fs_1['default'][_0x5224db(0x92)](_0xc0d241),[_0x1672b0,_0x5107b6]=_0x289946[_0x5224db(0xc5)](_0x5224db(0xa7),'')[_0x5224db(0xa0)]('_');return{'type':_0x1672b0,'date':_0x5107b6,'size':_0x3aed10['size']};})['sort']((_0x456b58,_0x42abc3)=>_0x42abc3['date'][_0x22ae2d(0x94)](_0x456b58[_0x22ae2d(0xc7)]));return{'totalFiles':_0xef7739['length'],'logTypes':_0x179917,'latestLogs':_0x86e65d['slice'](0x0,0xa)};}catch(_0x2ed0fd){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x2ed0fd),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a71_0x571fa5(0xbf)](_0x5c7292=0x1e){const _0xbe03a7=a71_0x571fa5;try{const _0x55dd43=fs_1[_0xbe03a7(0xb4)][_0xbe03a7(0x9b)](this[_0xbe03a7(0xa3)]),_0x9fb313=new Date();_0x9fb313[_0xbe03a7(0xb9)](_0x9fb313[_0xbe03a7(0xbd)]()-_0x5c7292);let _0x2a428a=0x0;_0x55dd43['forEach'](_0x2fde3b=>{const _0x36443e=_0xbe03a7;if(!_0x2fde3b[_0x36443e(0x8b)](_0x36443e(0xa7)))return;const _0x24a2fe=path_1[_0x36443e(0xb4)][_0x36443e(0x85)](this[_0x36443e(0xa3)],_0x2fde3b),_0x1d443a=fs_1[_0x36443e(0xb4)][_0x36443e(0x92)](_0x24a2fe);_0x1d443a['mtime']<_0x9fb313&&(fs_1[_0x36443e(0xb4)]['unlinkSync'](_0x24a2fe),_0x2a428a++,console[_0x36443e(0x96)]('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x2fde3b));}),console[_0xbe03a7(0x96)](_0xbe03a7(0x9e)+_0x2a428a+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x5c7292+'\x20days)');}catch(_0x45e0e0){console[_0xbe03a7(0x9c)](_0xbe03a7(0xc2),_0x45e0e0);}}}exports[a71_0x571fa5(0xc0)]=LoggerService,exports[a71_0x571fa5(0xb1)]=new LoggerService();