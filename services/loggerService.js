'use strict';const a44_0x4cdb41=a44_0x2e4c;function a44_0x2e4c(_0x12cd99,_0x39e07f){const _0x35607d=a44_0x3560();return a44_0x2e4c=function(_0x2e4c77,_0x208816){_0x2e4c77=_0x2e4c77-0x176;let _0x3db91e=_0x35607d[_0x2e4c77];return _0x3db91e;},a44_0x2e4c(_0x12cd99,_0x39e07f);}(function(_0x2e2159,_0x2ebd2f){const _0x13bd03=a44_0x2e4c,_0x372abc=_0x2e2159();while(!![]){try{const _0x4ed5a3=-parseInt(_0x13bd03(0x179))/0x1+parseInt(_0x13bd03(0x17f))/0x2*(parseInt(_0x13bd03(0x18d))/0x3)+parseInt(_0x13bd03(0x194))/0x4+parseInt(_0x13bd03(0x1a4))/0x5+parseInt(_0x13bd03(0x1b3))/0x6*(-parseInt(_0x13bd03(0x1b0))/0x7)+-parseInt(_0x13bd03(0x17a))/0x8*(parseInt(_0x13bd03(0x1bb))/0x9)+parseInt(_0x13bd03(0x1c0))/0xa;if(_0x4ed5a3===_0x2ebd2f)break;else _0x372abc['push'](_0x372abc['shift']());}catch(_0x45afc6){_0x372abc['push'](_0x372abc['shift']());}}}(a44_0x3560,0xd1394));var __importDefault=this&&this['__importDefault']||function(_0x255331){const _0x187d5c=a44_0x2e4c;return _0x255331&&_0x255331[_0x187d5c(0x176)]?_0x255331:{'default':_0x255331};};Object[a44_0x4cdb41(0x18e)](exports,'__esModule',{'value':!![]}),exports[a44_0x4cdb41(0x185)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x199762=a44_0x4cdb41;this[_0x199762(0x184)]=path_1[_0x199762(0x196)][_0x199762(0x1bf)](process[_0x199762(0x180)](),_0x199762(0x17c)),this[_0x199762(0x1b7)]();}[a44_0x4cdb41(0x1b7)](){const _0x397321=a44_0x4cdb41;!fs_1[_0x397321(0x196)][_0x397321(0x19a)](this[_0x397321(0x184)])&&(fs_1['default'][_0x397321(0x1aa)](this['logsDir'],{'recursive':!![]}),console[_0x397321(0x1ac)](_0x397321(0x1bd)+this[_0x397321(0x184)]));}[a44_0x4cdb41(0x1c2)](_0x2df1bb){const _0x52cb2d=a44_0x4cdb41,_0x185701=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x52cb2d(0x196)][_0x52cb2d(0x1bf)](this[_0x52cb2d(0x184)],_0x2df1bb+'_'+_0x185701+_0x52cb2d(0x183));}['writeLog'](_0x31fd6e,_0x3fd64b){const _0x210892=a44_0x4cdb41;try{const _0x7112a2=new Date()[_0x210892(0x1b2)](),_0x53ed05={'timestamp':_0x7112a2,..._0x3fd64b},_0x4aec0e=JSON[_0x210892(0x188)](_0x53ed05)+'\x0a',_0x53e6bb=this[_0x210892(0x1c2)](_0x31fd6e);fs_1['default'][_0x210892(0x17b)](_0x53e6bb,_0x4aec0e,_0x210892(0x1a5));}catch(_0xe8caa2){console[_0x210892(0x1a3)](_0x210892(0x190)+_0x31fd6e+_0x210892(0x1a9),_0xe8caa2);}}[a44_0x4cdb41(0x1ab)](_0x40fd25,_0x2966a0,_0x3c195b,_0x306187){const _0x459e10=a44_0x4cdb41;this[_0x459e10(0x19c)](_0x459e10(0x1b1),{'type':_0x459e10(0x1b6),'gateway':_0x40fd25,'endpoint':_0x2966a0,'method':_0x3c195b,'data':_0x306187});}[a44_0x4cdb41(0x1a6)](_0x152817,_0x159675,_0x2ff186,_0x530a8c,_0x5d102c){const _0x118ce2=a44_0x4cdb41;this['writeLog'](_0x118ce2(0x1c4),{'type':_0x118ce2(0x187),'gateway':_0x152817,'endpoint':_0x159675,'status':_0x2ff186,'responseTime':_0x5d102c,'data':_0x530a8c});}[a44_0x4cdb41(0x1c1)](_0x47e9ce,_0xf2cb97,_0x5ff6d6){const _0x3967a3=a44_0x4cdb41;this[_0x3967a3(0x19c)]('white_domain_errors',{'type':_0x3967a3(0x182),'gateway':_0x47e9ce,'endpoint':_0xf2cb97,'error':_0x5ff6d6 instanceof Error?{'message':_0x5ff6d6['message'],'stack':_0x5ff6d6[_0x3967a3(0x17e)]}:_0x5ff6d6});}['logWebhookReceived'](_0x36cf4d,_0x449522,_0x441d10){const _0x50eba4=a44_0x4cdb41;this[_0x50eba4(0x19c)](_0x50eba4(0x178),{'type':_0x50eba4(0x1a2),'gateway':_0x36cf4d,'headers':_0x441d10,'data':_0x449522});}['logWebhookProcessed'](_0x557bb6,_0x36e4df,_0x47bc28,_0x13a0b9,_0x14d488){const _0x220a2c=a44_0x4cdb41;this[_0x220a2c(0x19c)](_0x220a2c(0x193),{'type':_0x220a2c(0x19f),'gateway':_0x557bb6,'paymentId':_0x36e4df,'oldStatus':_0x47bc28,'newStatus':_0x13a0b9,'originalData':_0x14d488});}[a44_0x4cdb41(0x1b8)](_0x3b6904,_0x1248fd,_0x5715d5){const _0x4f36a1=a44_0x4cdb41;this['writeLog'](_0x4f36a1(0x17d),{'type':_0x4f36a1(0x1c8),'gateway':_0x3b6904,'error':_0x1248fd instanceof Error?{'message':_0x1248fd['message'],'stack':_0x1248fd[_0x4f36a1(0x17e)]}:_0x1248fd,'originalData':_0x5715d5});}[a44_0x4cdb41(0x19d)](_0x3cd2ce){const _0x1d2ade=a44_0x4cdb41;this[_0x1d2ade(0x19c)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x3cd2ce});}['logCoinToPayError'](_0x28cb17){const _0x4ee2d2=a44_0x4cdb41;this[_0x4ee2d2(0x19c)](_0x4ee2d2(0x1a7),{'type':_0x4ee2d2(0x192),..._0x28cb17});}[a44_0x4cdb41(0x18b)](_0x56e665,_0x333933,_0x5971d7,_0x6bd891,_0x3f6044,_0x54c275){const _0x37976d=a44_0x4cdb41;this[_0x37976d(0x19c)](_0x37976d(0x186),{'type':_0x37976d(0x18c),'shopId':_0x56e665,'webhookUrl':_0x333933,'event':_0x5971d7,'status':_0x6bd891,'responseTime':_0x3f6044,'payload':_0x54c275});}[a44_0x4cdb41(0x1b4)](_0x2c7c50,_0x503dd9,_0x35e6e4,_0x237069,_0x4d9b6f){const _0x484abf=a44_0x4cdb41;this[_0x484abf(0x19c)](_0x484abf(0x191),{'type':_0x484abf(0x1c6),'shopId':_0x2c7c50,'webhookUrl':_0x503dd9,'event':_0x35e6e4,'error':_0x237069 instanceof Error?{'message':_0x237069[_0x484abf(0x1a8)],'stack':_0x237069['stack']}:_0x237069,'payload':_0x4d9b6f});}['logPaymentCreated'](_0xd18477,_0x3b3558,_0x7acd90,_0x1e7f19,_0x3b22e7){const _0x315e61=a44_0x4cdb41;this['writeLog'](_0x315e61(0x199),{'type':_0x315e61(0x1af),'gateway':_0xd18477,'paymentId':_0x3b3558,'shopId':_0x7acd90,'amount':_0x1e7f19,'currency':_0x3b22e7});}[a44_0x4cdb41(0x18a)](_0x5b7c36,_0x39837a,_0x19afa7,_0x33f92c,_0x4267db){const _0x3aa97b=a44_0x4cdb41;this[_0x3aa97b(0x19c)](_0x3aa97b(0x1ca),{'type':_0x3aa97b(0x1a0),'endpoint':_0x5b7c36,'method':_0x39837a,'userId':_0x19afa7,'userRole':_0x33f92c,'requestData':_0x4267db});}[a44_0x4cdb41(0x195)](){const _0x2b74f0=a44_0x4cdb41;try{const _0x208dde=fs_1['default'][_0x2b74f0(0x181)](this[_0x2b74f0(0x184)]),_0x5e5f9b=_0x208dde[_0x2b74f0(0x1ae)](_0xbe73e6=>_0xbe73e6[_0x2b74f0(0x1c7)](_0x2b74f0(0x183))),_0x51cba4=[...new Set(_0x5e5f9b[_0x2b74f0(0x1c5)](_0x56c5cb=>_0x56c5cb['split']('_')[0x0]))],_0x4275d3=_0x5e5f9b['map'](_0x56b4bf=>{const _0x51d934=_0x2b74f0,_0x592cca=path_1[_0x51d934(0x196)][_0x51d934(0x1bf)](this['logsDir'],_0x56b4bf),_0x154ea4=fs_1[_0x51d934(0x196)][_0x51d934(0x1ba)](_0x592cca),[_0x1ab014,_0x346e4d]=_0x56b4bf[_0x51d934(0x197)](_0x51d934(0x183),'')['split']('_');return{'type':_0x1ab014,'date':_0x346e4d,'size':_0x154ea4['size']};})[_0x2b74f0(0x189)]((_0x32ec70,_0x12c918)=>_0x12c918[_0x2b74f0(0x1bc)][_0x2b74f0(0x198)](_0x32ec70['date']));return{'totalFiles':_0x5e5f9b[_0x2b74f0(0x1b9)],'logTypes':_0x51cba4,'latestLogs':_0x4275d3[_0x2b74f0(0x1b5)](0x0,0xa)};}catch(_0x3e6a90){return console['error'](_0x2b74f0(0x1be),_0x3e6a90),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x17c4e6=0x1e){const _0x324326=a44_0x4cdb41;try{const _0x226ed3=fs_1[_0x324326(0x196)][_0x324326(0x181)](this[_0x324326(0x184)]),_0x157af8=new Date();_0x157af8[_0x324326(0x19e)](_0x157af8[_0x324326(0x1a1)]()-_0x17c4e6);let _0x1817a6=0x0;_0x226ed3[_0x324326(0x18f)](_0x29f4d7=>{const _0x46f78c=_0x324326;if(!_0x29f4d7['endsWith']('.log'))return;const _0x2cb024=path_1[_0x46f78c(0x196)][_0x46f78c(0x1bf)](this[_0x46f78c(0x184)],_0x29f4d7),_0x3f2035=fs_1[_0x46f78c(0x196)][_0x46f78c(0x1ba)](_0x2cb024);_0x3f2035[_0x46f78c(0x19b)]<_0x157af8&&(fs_1['default']['unlinkSync'](_0x2cb024),_0x1817a6++,console['log'](_0x46f78c(0x1c9)+_0x29f4d7));}),console[_0x324326(0x1ac)](_0x324326(0x1c3)+_0x1817a6+_0x324326(0x1ad)+_0x17c4e6+_0x324326(0x177));}catch(_0x23622d){console[_0x324326(0x1a3)]('Failed\x20to\x20clean\x20old\x20logs:',_0x23622d);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();function a44_0x3560(){const _0x4ba05f=['webhooks_received','1579453xobeYm','32fJptub','appendFileSync','logs','webhooks_errors','stack','199902MZpKKA','cwd','readdirSync','ERROR','.log','logsDir','loggerService','shop_webhooks_sent','RESPONSE','stringify','sort','logApiCall','logShopWebhookSent','SHOP_WEBHOOK_SENT','21UnZdpl','defineProperty','forEach','Failed\x20to\x20write\x20','shop_webhooks_errors','COINTOPAY_ERROR','webhooks_processed','3013532gnlCvl','getLogStats','default','replace','localeCompare','payments_created','existsSync','mtime','writeLog','logCoinToPayStatus','setDate','WEBHOOK_PROCESSED','API_CALL','getDate','WEBHOOK_RECEIVED','error','701405snnGqX','utf8','logWhiteDomainResponse','cointopay_errors','message','\x20log:','mkdirSync','logWhiteDomainRequest','log','\x20old\x20log\x20files\x20(older\x20than\x20','filter','PAYMENT_CREATED','7ytrCuD','white_domain_requests','toISOString','3282978jtqhHd','logShopWebhookError','slice','REQUEST','ensureLogsDirectory','logWebhookError','length','statSync','3796839pFhUWk','date','ðŸ“\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20get\x20log\x20stats:','join','30777590uvYxTt','logWhiteDomainError','getLogFileName','ðŸ§¹\x20Cleaned\x20','white_domain_responses','map','SHOP_WEBHOOK_ERROR','endsWith','WEBHOOK_ERROR','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','api_calls','__esModule','\x20days)'];a44_0x3560=function(){return _0x4ba05f;};return a44_0x3560();}