'use strict';const a79_0x2e0956=a79_0x1be4;(function(_0x197ad1,_0xe1b1bf){const _0x5c4576=a79_0x1be4,_0x46c675=_0x197ad1();while(!![]){try{const _0x465bdd=-parseInt(_0x5c4576(0x1b5))/0x1*(-parseInt(_0x5c4576(0x174))/0x2)+-parseInt(_0x5c4576(0x191))/0x3+-parseInt(_0x5c4576(0x1ba))/0x4+-parseInt(_0x5c4576(0x1bc))/0x5+parseInt(_0x5c4576(0x18b))/0x6+-parseInt(_0x5c4576(0x18c))/0x7+-parseInt(_0x5c4576(0x189))/0x8*(-parseInt(_0x5c4576(0x1a2))/0x9);if(_0x465bdd===_0xe1b1bf)break;else _0x46c675['push'](_0x46c675['shift']());}catch(_0x1f104d){_0x46c675['push'](_0x46c675['shift']());}}}(a79_0x23eb,0x6d74a));var __importDefault=this&&this['__importDefault']||function(_0x46b9ac){return _0x46b9ac&&_0x46b9ac['__esModule']?_0x46b9ac:{'default':_0x46b9ac};};Object[a79_0x2e0956(0x198)](exports,a79_0x2e0956(0x1a6),{'value':!![]}),exports[a79_0x2e0956(0x19a)]=exports[a79_0x2e0956(0x18f)]=void 0x0;function a79_0x1be4(_0x2965db,_0x14fe04){_0x2965db=_0x2965db-0x16f;const _0x23eb83=a79_0x23eb();let _0x1be443=_0x23eb83[_0x2965db];return _0x1be443;}function a79_0x23eb(){const _0x56f746=['logWebhookError','PAYMENT_CREATED','logsDir','cleanOldLogs','COINTOPAY_STATUS_CHANGE','endsWith','error','ERROR','4524040Dkngkm','path','3867996vGdpmi','6119883uUBvao','log','cwd','LoggerService','logCoinToPayStatus','1036512iEbAhm','split','map','filter','join','toISOString','logs','defineProperty','cointopay_errors','loggerService','size','ensureLogsDirectory','existsSync','shop_webhooks_errors','ðŸ“\x20Created\x20logs\x20directory:\x20','white_domain_requests','logPaymentCreated','27TIghgA','unlinkSync','logWebhookReceived','stringify','__esModule','default','WEBHOOK_ERROR','webhooks_processed','white_domain_responses','\x20log:','getLogStats','statSync','message','cointopay_status_changes','payments_created','readdirSync','logShopWebhookSent','length','WEBHOOK_RECEIVED','2467uscQtq','webhooks_errors','setDate','ðŸ§¹\x20Cleaned\x20','api_calls','927544bzgsnB','logWhiteDomainError','3821845DMAzzV','localeCompare','REQUEST','SHOP_WEBHOOK_SENT','Failed\x20to\x20get\x20log\x20stats:','date','logApiCall','logCoinToPayError','mtime','stack','262AyjlJr','webhooks_received','getLogFileName','logWhiteDomainResponse','logShopWebhookError','logWebhookProcessed','WEBHOOK_PROCESSED','forEach','.log','\x20days)','utf8','writeLog','RESPONSE'];a79_0x23eb=function(){return _0x56f746;};return a79_0x23eb();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x2e0956(0x18a)));class LoggerService{constructor(){const _0x6a4381=a79_0x2e0956;this['logsDir']=path_1[_0x6a4381(0x1a7)][_0x6a4381(0x195)](process[_0x6a4381(0x18e)](),_0x6a4381(0x197)),this[_0x6a4381(0x19c)]();}[a79_0x2e0956(0x19c)](){const _0x5d947e=a79_0x2e0956;!fs_1[_0x5d947e(0x1a7)][_0x5d947e(0x19d)](this['logsDir'])&&(fs_1[_0x5d947e(0x1a7)]['mkdirSync'](this[_0x5d947e(0x183)],{'recursive':!![]}),console[_0x5d947e(0x18d)](_0x5d947e(0x19f)+this[_0x5d947e(0x183)]));}[a79_0x2e0956(0x176)](_0x42194b){const _0x136184=a79_0x2e0956,_0x5cd029=new Date()[_0x136184(0x196)]()['split']('T')[0x0];return path_1[_0x136184(0x1a7)][_0x136184(0x195)](this['logsDir'],_0x42194b+'_'+_0x5cd029+'.log');}['writeLog'](_0x260c40,_0x26c2aa){const _0x333a99=a79_0x2e0956;try{const _0x3a615a=new Date()[_0x333a99(0x196)](),_0x53525d={'timestamp':_0x3a615a,..._0x26c2aa},_0x23fc62=JSON[_0x333a99(0x1a5)](_0x53525d)+'\x0a',_0x545888=this[_0x333a99(0x176)](_0x260c40);fs_1[_0x333a99(0x1a7)]['appendFileSync'](_0x545888,_0x23fc62,_0x333a99(0x17e));}catch(_0x493824){console[_0x333a99(0x187)]('Failed\x20to\x20write\x20'+_0x260c40+_0x333a99(0x1ab),_0x493824);}}['logWhiteDomainRequest'](_0xddf47e,_0x37a510,_0xf77e21,_0x195301){const _0x33a2f1=a79_0x2e0956;this[_0x33a2f1(0x17f)](_0x33a2f1(0x1a0),{'type':_0x33a2f1(0x1be),'gateway':_0xddf47e,'endpoint':_0x37a510,'method':_0xf77e21,'data':_0x195301});}[a79_0x2e0956(0x177)](_0x11aed2,_0x307545,_0x4c82af,_0x5c8cdd,_0x17108a){const _0x51df2b=a79_0x2e0956;this[_0x51df2b(0x17f)](_0x51df2b(0x1aa),{'type':_0x51df2b(0x180),'gateway':_0x11aed2,'endpoint':_0x307545,'status':_0x4c82af,'responseTime':_0x17108a,'data':_0x5c8cdd});}[a79_0x2e0956(0x1bb)](_0xc48426,_0x419768,_0x1ce9d2){const _0x44e47f=a79_0x2e0956;this[_0x44e47f(0x17f)]('white_domain_errors',{'type':_0x44e47f(0x188),'gateway':_0xc48426,'endpoint':_0x419768,'error':_0x1ce9d2 instanceof Error?{'message':_0x1ce9d2['message'],'stack':_0x1ce9d2[_0x44e47f(0x173)]}:_0x1ce9d2});}[a79_0x2e0956(0x1a4)](_0x3ac263,_0x590806,_0x2e2c8e){const _0x3a26ab=a79_0x2e0956;this[_0x3a26ab(0x17f)](_0x3a26ab(0x175),{'type':_0x3a26ab(0x1b4),'gateway':_0x3ac263,'headers':_0x2e2c8e,'data':_0x590806});}[a79_0x2e0956(0x179)](_0x1fe506,_0x12e3d0,_0x39c15e,_0x1cf27f,_0x4a1c6d){const _0x5b8949=a79_0x2e0956;this[_0x5b8949(0x17f)](_0x5b8949(0x1a9),{'type':_0x5b8949(0x17a),'gateway':_0x1fe506,'paymentId':_0x12e3d0,'oldStatus':_0x39c15e,'newStatus':_0x1cf27f,'originalData':_0x4a1c6d});}[a79_0x2e0956(0x181)](_0x18f48f,_0x48c78f,_0xb794d4){const _0x30758a=a79_0x2e0956;this[_0x30758a(0x17f)](_0x30758a(0x1b6),{'type':_0x30758a(0x1a8),'gateway':_0x18f48f,'error':_0x48c78f instanceof Error?{'message':_0x48c78f[_0x30758a(0x1ae)],'stack':_0x48c78f[_0x30758a(0x173)]}:_0x48c78f,'originalData':_0xb794d4});}[a79_0x2e0956(0x190)](_0x1ed086){const _0x2bc5c6=a79_0x2e0956;this[_0x2bc5c6(0x17f)](_0x2bc5c6(0x1af),{'type':_0x2bc5c6(0x185),..._0x1ed086});}[a79_0x2e0956(0x171)](_0x3a226b){const _0x1bc862=a79_0x2e0956;this[_0x1bc862(0x17f)](_0x1bc862(0x199),{'type':'COINTOPAY_ERROR',..._0x3a226b});}[a79_0x2e0956(0x1b2)](_0x59a301,_0x521f22,_0x365a8b,_0x55670e,_0xcd2263,_0x3d89ad){const _0x49201a=a79_0x2e0956;this[_0x49201a(0x17f)]('shop_webhooks_sent',{'type':_0x49201a(0x1bf),'shopId':_0x59a301,'webhookUrl':_0x521f22,'event':_0x365a8b,'status':_0x55670e,'responseTime':_0xcd2263,'payload':_0x3d89ad});}[a79_0x2e0956(0x178)](_0x42f0b7,_0x5a9fb5,_0x459e4c,_0x4d90c8,_0x1f8ce2){const _0x5b2ae2=a79_0x2e0956;this[_0x5b2ae2(0x17f)](_0x5b2ae2(0x19e),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x42f0b7,'webhookUrl':_0x5a9fb5,'event':_0x459e4c,'error':_0x4d90c8 instanceof Error?{'message':_0x4d90c8[_0x5b2ae2(0x1ae)],'stack':_0x4d90c8['stack']}:_0x4d90c8,'payload':_0x1f8ce2});}[a79_0x2e0956(0x1a1)](_0x2878a9,_0x3baeca,_0x4f37e5,_0x3535a0,_0x444673){const _0x2b1523=a79_0x2e0956;this['writeLog'](_0x2b1523(0x1b0),{'type':_0x2b1523(0x182),'gateway':_0x2878a9,'paymentId':_0x3baeca,'shopId':_0x4f37e5,'amount':_0x3535a0,'currency':_0x444673});}[a79_0x2e0956(0x170)](_0x26d6d8,_0x1ee437,_0x257041,_0x4f76e3,_0xea07b3){const _0x2fe5a3=a79_0x2e0956;this[_0x2fe5a3(0x17f)](_0x2fe5a3(0x1b9),{'type':'API_CALL','endpoint':_0x26d6d8,'method':_0x1ee437,'userId':_0x257041,'userRole':_0x4f76e3,'requestData':_0xea07b3});}[a79_0x2e0956(0x1ac)](){const _0x5c9385=a79_0x2e0956;try{const _0x130588=fs_1['default'][_0x5c9385(0x1b1)](this[_0x5c9385(0x183)]),_0x191a3d=_0x130588[_0x5c9385(0x194)](_0x307d00=>_0x307d00[_0x5c9385(0x186)](_0x5c9385(0x17c))),_0x3810fc=[...new Set(_0x191a3d[_0x5c9385(0x193)](_0x276b22=>_0x276b22[_0x5c9385(0x192)]('_')[0x0]))],_0x1470ee=_0x191a3d[_0x5c9385(0x193)](_0x3379d9=>{const _0x63bbc1=_0x5c9385,_0x1832d8=path_1[_0x63bbc1(0x1a7)][_0x63bbc1(0x195)](this[_0x63bbc1(0x183)],_0x3379d9),_0x336a69=fs_1[_0x63bbc1(0x1a7)][_0x63bbc1(0x1ad)](_0x1832d8),[_0x1fe3e3,_0x5e3904]=_0x3379d9['replace'](_0x63bbc1(0x17c),'')[_0x63bbc1(0x192)]('_');return{'type':_0x1fe3e3,'date':_0x5e3904,'size':_0x336a69[_0x63bbc1(0x19b)]};})['sort']((_0x35726a,_0x53e0f7)=>_0x53e0f7['date'][_0x5c9385(0x1bd)](_0x35726a[_0x5c9385(0x16f)]));return{'totalFiles':_0x191a3d[_0x5c9385(0x1b3)],'logTypes':_0x3810fc,'latestLogs':_0x1470ee['slice'](0x0,0xa)};}catch(_0x222e7d){return console['error'](_0x5c9385(0x1c0),_0x222e7d),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a79_0x2e0956(0x184)](_0x26eb93=0x1e){const _0x1dcc24=a79_0x2e0956;try{const _0x4a66d6=fs_1[_0x1dcc24(0x1a7)][_0x1dcc24(0x1b1)](this[_0x1dcc24(0x183)]),_0x3c9feb=new Date();_0x3c9feb[_0x1dcc24(0x1b7)](_0x3c9feb['getDate']()-_0x26eb93);let _0x31594b=0x0;_0x4a66d6[_0x1dcc24(0x17b)](_0xbad177=>{const _0x206443=_0x1dcc24;if(!_0xbad177[_0x206443(0x186)]('.log'))return;const _0x329707=path_1[_0x206443(0x1a7)]['join'](this[_0x206443(0x183)],_0xbad177),_0x266f5b=fs_1[_0x206443(0x1a7)]['statSync'](_0x329707);_0x266f5b[_0x206443(0x172)]<_0x3c9feb&&(fs_1[_0x206443(0x1a7)][_0x206443(0x1a3)](_0x329707),_0x31594b++,console['log']('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0xbad177));}),console['log'](_0x1dcc24(0x1b8)+_0x31594b+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x26eb93+_0x1dcc24(0x17d));}catch(_0x2cdc4e){console[_0x1dcc24(0x187)]('Failed\x20to\x20clean\x20old\x20logs:',_0x2cdc4e);}}}exports[a79_0x2e0956(0x18f)]=LoggerService,exports[a79_0x2e0956(0x19a)]=new LoggerService();