'use strict';const a47_0x417d17=a47_0x5892;(function(_0x54ab37,_0x35c955){const _0x5dc03d=a47_0x5892,_0x34bbe8=_0x54ab37();while(!![]){try{const _0x26978e=parseInt(_0x5dc03d(0x1c0))/0x1+-parseInt(_0x5dc03d(0x19e))/0x2+-parseInt(_0x5dc03d(0x1a1))/0x3+-parseInt(_0x5dc03d(0x199))/0x4*(parseInt(_0x5dc03d(0x1e0))/0x5)+-parseInt(_0x5dc03d(0x1cf))/0x6*(-parseInt(_0x5dc03d(0x1d9))/0x7)+parseInt(_0x5dc03d(0x1cc))/0x8+parseInt(_0x5dc03d(0x1e6))/0x9;if(_0x26978e===_0x35c955)break;else _0x34bbe8['push'](_0x34bbe8['shift']());}catch(_0x5d4cce){_0x34bbe8['push'](_0x34bbe8['shift']());}}}(a47_0x5d26,0xcb6a3));function a47_0x5892(_0x1203b5,_0x213a1){const _0x5d265f=a47_0x5d26();return a47_0x5892=function(_0x5892d6,_0x5608ef){_0x5892d6=_0x5892d6-0x197;let _0x139c51=_0x5d265f[_0x5892d6];return _0x139c51;},a47_0x5892(_0x1203b5,_0x213a1);}var __importDefault=this&&this[a47_0x417d17(0x1b0)]||function(_0x4f640f){return _0x4f640f&&_0x4f640f['__esModule']?_0x4f640f:{'default':_0x4f640f};};Object[a47_0x417d17(0x1a0)](exports,a47_0x417d17(0x1d2),{'value':!![]}),exports['loggerService']=exports[a47_0x417d17(0x1b8)]=void 0x0;function a47_0x5d26(){const _0x7ba6f7=['map','date','2931928UCflhW','endsWith','stack','582NPnQDs','api_calls','logShopWebhookError','__esModule','\x20log:','SHOP_WEBHOOK_ERROR','API_CALL','message','unlinkSync','join','118069BnRzQQ','Failed\x20to\x20clean\x20old\x20logs:','.log','toISOString','webhooks_errors','webhooks_processed','RESPONSE','455SHIKSj','COINTOPAY_ERROR','payments_created','log','localeCompare','logsDir','4031046jGRYCD','size','\x20old\x20log\x20files\x20(older\x20than\x20','writeLog','logWebhookProcessed','replace','🗑️\x20Deleted\x20old\x20log\x20file:\x20','69656tnqupF','getLogStats','sort','logPaymentCreated','readdirSync','1417700XIOWEh','getLogFileName','defineProperty','855528erqQho','ensureLogsDirectory','slice','logWebhookError','white_domain_errors','\x20days)','🧹\x20Cleaned\x20','REQUEST','Failed\x20to\x20write\x20','white_domain_requests','stringify','path','logShopWebhookSent','logWhiteDomainResponse','WEBHOOK_RECEIVED','__importDefault','white_domain_responses','cwd','mkdirSync','cointopay_status_changes','default','WEBHOOK_PROCESSED','shop_webhooks_errors','LoggerService','PAYMENT_CREATED','WEBHOOK_ERROR','getDate','split','existsSync','forEach','logWhiteDomainError','961403KTmWzU','logApiCall','error','Failed\x20to\x20get\x20log\x20stats:','COINTOPAY_STATUS_CHANGE','webhooks_received','filter','mtime','cleanOldLogs','logCoinToPayError'];a47_0x5d26=function(){return _0x7ba6f7;};return a47_0x5d26();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a47_0x417d17(0x1ac)));class LoggerService{constructor(){const _0x41d97a=a47_0x417d17;this[_0x41d97a(0x1e5)]=path_1[_0x41d97a(0x1b5)][_0x41d97a(0x1d8)](process[_0x41d97a(0x1b2)](),'logs'),this[_0x41d97a(0x1a2)]();}[a47_0x417d17(0x1a2)](){const _0x252e30=a47_0x417d17;!fs_1[_0x252e30(0x1b5)][_0x252e30(0x1bd)](this[_0x252e30(0x1e5)])&&(fs_1[_0x252e30(0x1b5)][_0x252e30(0x1b3)](this[_0x252e30(0x1e5)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x252e30(0x1e5)]));}[a47_0x417d17(0x19f)](_0x499306){const _0x31665b=a47_0x417d17,_0x4697e4=new Date()[_0x31665b(0x1dc)]()[_0x31665b(0x1bc)]('T')[0x0];return path_1['default'][_0x31665b(0x1d8)](this['logsDir'],_0x499306+'_'+_0x4697e4+_0x31665b(0x1db));}[a47_0x417d17(0x1e9)](_0x273079,_0xd3ed29){const _0x5efebc=a47_0x417d17;try{const _0x4380b3=new Date()[_0x5efebc(0x1dc)](),_0x18a2c2={'timestamp':_0x4380b3,..._0xd3ed29},_0x37b197=JSON[_0x5efebc(0x1ab)](_0x18a2c2)+'\x0a',_0x48067e=this[_0x5efebc(0x19f)](_0x273079);fs_1[_0x5efebc(0x1b5)]['appendFileSync'](_0x48067e,_0x37b197,'utf8');}catch(_0x115ac1){console['error'](_0x5efebc(0x1a9)+_0x273079+_0x5efebc(0x1d3),_0x115ac1);}}['logWhiteDomainRequest'](_0x53f54d,_0x2026c3,_0x1e4cb6,_0x50a5ae){const _0x56af88=a47_0x417d17;this[_0x56af88(0x1e9)](_0x56af88(0x1aa),{'type':_0x56af88(0x1a8),'gateway':_0x53f54d,'endpoint':_0x2026c3,'method':_0x1e4cb6,'data':_0x50a5ae});}[a47_0x417d17(0x1ae)](_0x28d910,_0x3bba82,_0x306787,_0x52b3b6,_0x127503){const _0x451937=a47_0x417d17;this['writeLog'](_0x451937(0x1b1),{'type':_0x451937(0x1df),'gateway':_0x28d910,'endpoint':_0x3bba82,'status':_0x306787,'responseTime':_0x127503,'data':_0x52b3b6});}[a47_0x417d17(0x1bf)](_0x47a18a,_0x2c6931,_0x511b1f){const _0x359c3c=a47_0x417d17;this[_0x359c3c(0x1e9)](_0x359c3c(0x1a5),{'type':'ERROR','gateway':_0x47a18a,'endpoint':_0x2c6931,'error':_0x511b1f instanceof Error?{'message':_0x511b1f[_0x359c3c(0x1d6)],'stack':_0x511b1f['stack']}:_0x511b1f});}['logWebhookReceived'](_0x260acd,_0x589658,_0x577e8f){const _0x5e48ba=a47_0x417d17;this[_0x5e48ba(0x1e9)](_0x5e48ba(0x1c5),{'type':_0x5e48ba(0x1af),'gateway':_0x260acd,'headers':_0x577e8f,'data':_0x589658});}[a47_0x417d17(0x1ea)](_0x1877b9,_0x48e2a2,_0x5ef4df,_0x2935e8,_0x4bd223){const _0x338ee7=a47_0x417d17;this[_0x338ee7(0x1e9)](_0x338ee7(0x1de),{'type':_0x338ee7(0x1b6),'gateway':_0x1877b9,'paymentId':_0x48e2a2,'oldStatus':_0x5ef4df,'newStatus':_0x2935e8,'originalData':_0x4bd223});}[a47_0x417d17(0x1a4)](_0x568981,_0x2117b8,_0x3407d3){const _0x27c01f=a47_0x417d17;this[_0x27c01f(0x1e9)](_0x27c01f(0x1dd),{'type':_0x27c01f(0x1ba),'gateway':_0x568981,'error':_0x2117b8 instanceof Error?{'message':_0x2117b8[_0x27c01f(0x1d6)],'stack':_0x2117b8[_0x27c01f(0x1ce)]}:_0x2117b8,'originalData':_0x3407d3});}['logCoinToPayStatus'](_0x6dcdb2){const _0x40887a=a47_0x417d17;this['writeLog'](_0x40887a(0x1b4),{'type':_0x40887a(0x1c4),..._0x6dcdb2});}[a47_0x417d17(0x1c9)](_0x3c94bc){const _0x1f1a92=a47_0x417d17;this[_0x1f1a92(0x1e9)]('cointopay_errors',{'type':_0x1f1a92(0x1e1),..._0x3c94bc});}[a47_0x417d17(0x1ad)](_0x2ce4c5,_0x44f630,_0x3ea5ac,_0x54b017,_0x149b29,_0xcf8d29){const _0x5dddc3=a47_0x417d17;this[_0x5dddc3(0x1e9)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x2ce4c5,'webhookUrl':_0x44f630,'event':_0x3ea5ac,'status':_0x54b017,'responseTime':_0x149b29,'payload':_0xcf8d29});}[a47_0x417d17(0x1d1)](_0x3c3c77,_0x26874b,_0x12b797,_0x19c622,_0x19127e){const _0x31692f=a47_0x417d17;this[_0x31692f(0x1e9)](_0x31692f(0x1b7),{'type':_0x31692f(0x1d4),'shopId':_0x3c3c77,'webhookUrl':_0x26874b,'event':_0x12b797,'error':_0x19c622 instanceof Error?{'message':_0x19c622['message'],'stack':_0x19c622[_0x31692f(0x1ce)]}:_0x19c622,'payload':_0x19127e});}[a47_0x417d17(0x19c)](_0x4577fe,_0x2e7be5,_0x217000,_0x3c2f02,_0x283a01){const _0x21a318=a47_0x417d17;this[_0x21a318(0x1e9)](_0x21a318(0x1e2),{'type':_0x21a318(0x1b9),'gateway':_0x4577fe,'paymentId':_0x2e7be5,'shopId':_0x217000,'amount':_0x3c2f02,'currency':_0x283a01});}[a47_0x417d17(0x1c1)](_0x151133,_0x2252f4,_0x8483a0,_0x471268,_0x3e60ac){const _0x475688=a47_0x417d17;this[_0x475688(0x1e9)](_0x475688(0x1d0),{'type':_0x475688(0x1d5),'endpoint':_0x151133,'method':_0x2252f4,'userId':_0x8483a0,'userRole':_0x471268,'requestData':_0x3e60ac});}[a47_0x417d17(0x19a)](){const _0xa2aeb3=a47_0x417d17;try{const _0x23968d=fs_1[_0xa2aeb3(0x1b5)]['readdirSync'](this['logsDir']),_0x1175ab=_0x23968d[_0xa2aeb3(0x1c6)](_0x12c1dd=>_0x12c1dd[_0xa2aeb3(0x1cd)](_0xa2aeb3(0x1db))),_0x4ddf28=[...new Set(_0x1175ab['map'](_0x5007e3=>_0x5007e3[_0xa2aeb3(0x1bc)]('_')[0x0]))],_0x30acfc=_0x1175ab[_0xa2aeb3(0x1ca)](_0x155e23=>{const _0xb6ae6e=_0xa2aeb3,_0x2ccdc1=path_1[_0xb6ae6e(0x1b5)][_0xb6ae6e(0x1d8)](this['logsDir'],_0x155e23),_0x470629=fs_1[_0xb6ae6e(0x1b5)]['statSync'](_0x2ccdc1),[_0x46519e,_0x38262a]=_0x155e23[_0xb6ae6e(0x197)](_0xb6ae6e(0x1db),'')['split']('_');return{'type':_0x46519e,'date':_0x38262a,'size':_0x470629[_0xb6ae6e(0x1e7)]};})[_0xa2aeb3(0x19b)]((_0x4c7246,_0xf80224)=>_0xf80224['date'][_0xa2aeb3(0x1e4)](_0x4c7246[_0xa2aeb3(0x1cb)]));return{'totalFiles':_0x1175ab['length'],'logTypes':_0x4ddf28,'latestLogs':_0x30acfc[_0xa2aeb3(0x1a3)](0x0,0xa)};}catch(_0x541071){return console[_0xa2aeb3(0x1c2)](_0xa2aeb3(0x1c3),_0x541071),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a47_0x417d17(0x1c8)](_0x49ffdb=0x1e){const _0x4d0f05=a47_0x417d17;try{const _0x2cb7ee=fs_1[_0x4d0f05(0x1b5)][_0x4d0f05(0x19d)](this[_0x4d0f05(0x1e5)]),_0x45250b=new Date();_0x45250b['setDate'](_0x45250b[_0x4d0f05(0x1bb)]()-_0x49ffdb);let _0x2061ea=0x0;_0x2cb7ee[_0x4d0f05(0x1be)](_0x19f5ce=>{const _0x380304=_0x4d0f05;if(!_0x19f5ce[_0x380304(0x1cd)](_0x380304(0x1db)))return;const _0x49a08a=path_1[_0x380304(0x1b5)][_0x380304(0x1d8)](this[_0x380304(0x1e5)],_0x19f5ce),_0x59ad46=fs_1[_0x380304(0x1b5)]['statSync'](_0x49a08a);_0x59ad46[_0x380304(0x1c7)]<_0x45250b&&(fs_1['default'][_0x380304(0x1d7)](_0x49a08a),_0x2061ea++,console['log'](_0x380304(0x198)+_0x19f5ce));}),console[_0x4d0f05(0x1e3)](_0x4d0f05(0x1a7)+_0x2061ea+_0x4d0f05(0x1e8)+_0x49ffdb+_0x4d0f05(0x1a6));}catch(_0x20edbf){console[_0x4d0f05(0x1c2)](_0x4d0f05(0x1da),_0x20edbf);}}}exports[a47_0x417d17(0x1b8)]=LoggerService,exports['loggerService']=new LoggerService();