'use strict';function a49_0x52af(_0x291bf7,_0x153e3e){const _0x545e6e=a49_0x545e();return a49_0x52af=function(_0x52af7b,_0x29fdda){_0x52af7b=_0x52af7b-0x1c2;let _0x5da9b1=_0x545e6e[_0x52af7b];return _0x5da9b1;},a49_0x52af(_0x291bf7,_0x153e3e);}function a49_0x545e(){const _0x399441=['WEBHOOK_RECEIVED','324qEjQOw','LoggerService','forEach','🗑️\x20Deleted\x20old\x20log\x20file:\x20','webhooks_processed','Failed\x20to\x20clean\x20old\x20logs:','Failed\x20to\x20get\x20log\x20stats:','logWhiteDomainError','logWebhookReceived','date','default','appendFileSync','cointopay_status_changes','webhooks_errors','map','🧹\x20Cleaned\x20','logShopWebhookSent','logsDir','PAYMENT_CREATED','📁\x20Created\x20logs\x20directory:\x20','sort','split','mtime','117bAexpj','white_domain_errors','logCoinToPayStatus','payments_created','REQUEST','loggerService','logWebhookError','\x20old\x20log\x20files\x20(older\x20than\x20','716520pQmwUC','169447UblIlX','194677qZzZvV','RESPONSE','WEBHOOK_PROCESSED','21849146fIePPB','webhooks_received','filter','SHOP_WEBHOOK_SENT','logApiCall','cwd','toISOString','getLogFileName','\x20days)','63935GBtpIY','size','ERROR','error','logWhiteDomainResponse','shop_webhooks_errors','Failed\x20to\x20write\x20','logCoinToPayError','getLogStats','log','writeLog','stack','message','localeCompare','WEBHOOK_ERROR','statSync','utf8','API_CALL','3344616AqWgUG','__esModule','36NUAvrz','unlinkSync','\x20log:','SHOP_WEBHOOK_ERROR','__importDefault','white_domain_requests','join','getDate','shop_webhooks_sent','endsWith','path','15KXyByI','defineProperty','logPaymentCreated','COINTOPAY_STATUS_CHANGE','api_calls','logWhiteDomainRequest','.log','353356NenMZH'];a49_0x545e=function(){return _0x399441;};return a49_0x545e();}const a49_0x191073=a49_0x52af;(function(_0x3d010d,_0x461172){const _0x3b7c28=a49_0x52af,_0x19a9d7=_0x3d010d();while(!![]){try{const _0x4e7dac=parseInt(_0x3b7c28(0x1e5))/0x1+-parseInt(_0x3b7c28(0x1c3))/0x2*(parseInt(_0x3b7c28(0x211))/0x3)+-parseInt(_0x3b7c28(0x1c5))/0x4*(parseInt(_0x3b7c28(0x1f2))/0x5)+parseInt(_0x3b7c28(0x206))/0x6*(-parseInt(_0x3b7c28(0x1e6))/0x7)+-parseInt(_0x3b7c28(0x204))/0x8+-parseInt(_0x3b7c28(0x1dc))/0x9*(-parseInt(_0x3b7c28(0x1e4))/0xa)+parseInt(_0x3b7c28(0x1e9))/0xb;if(_0x4e7dac===_0x461172)break;else _0x19a9d7['push'](_0x19a9d7['shift']());}catch(_0x383817){_0x19a9d7['push'](_0x19a9d7['shift']());}}}(a49_0x545e,0x8e5d9));var __importDefault=this&&this[a49_0x191073(0x20a)]||function(_0xac4299){const _0x281630=a49_0x191073;return _0xac4299&&_0xac4299[_0x281630(0x205)]?_0xac4299:{'default':_0xac4299};};Object[a49_0x191073(0x212)](exports,a49_0x191073(0x205),{'value':!![]}),exports[a49_0x191073(0x1e1)]=exports[a49_0x191073(0x1c6)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x191073(0x210)));class LoggerService{constructor(){const _0xa18b6c=a49_0x191073;this['logsDir']=path_1[_0xa18b6c(0x1cf)][_0xa18b6c(0x20c)](process[_0xa18b6c(0x1ee)](),'logs'),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x3a56e1=a49_0x191073;!fs_1[_0x3a56e1(0x1cf)]['existsSync'](this[_0x3a56e1(0x1d6)])&&(fs_1['default']['mkdirSync'](this[_0x3a56e1(0x1d6)],{'recursive':!![]}),console['log'](_0x3a56e1(0x1d8)+this[_0x3a56e1(0x1d6)]));}['getLogFileName'](_0x57c80d){const _0x3e1760=a49_0x191073,_0x5540fa=new Date()[_0x3e1760(0x1ef)]()['split']('T')[0x0];return path_1[_0x3e1760(0x1cf)]['join'](this[_0x3e1760(0x1d6)],_0x57c80d+'_'+_0x5540fa+_0x3e1760(0x1c2));}['writeLog'](_0x28629e,_0x3c5679){const _0x386740=a49_0x191073;try{const _0x5b454b=new Date()[_0x386740(0x1ef)](),_0x443a45={'timestamp':_0x5b454b,..._0x3c5679},_0x2cf24e=JSON['stringify'](_0x443a45)+'\x0a',_0x4d1d4e=this[_0x386740(0x1f0)](_0x28629e);fs_1[_0x386740(0x1cf)][_0x386740(0x1d0)](_0x4d1d4e,_0x2cf24e,_0x386740(0x202));}catch(_0x91b0da){console[_0x386740(0x1f5)](_0x386740(0x1f8)+_0x28629e+_0x386740(0x208),_0x91b0da);}}[a49_0x191073(0x216)](_0x4c269d,_0x2f84c6,_0x4a6f86,_0x29ffa6){const _0x59ffa5=a49_0x191073;this['writeLog'](_0x59ffa5(0x20b),{'type':_0x59ffa5(0x1e0),'gateway':_0x4c269d,'endpoint':_0x2f84c6,'method':_0x4a6f86,'data':_0x29ffa6});}[a49_0x191073(0x1f6)](_0x2ec450,_0xedd128,_0x29e895,_0x566930,_0x25234b){const _0x3ab62c=a49_0x191073;this[_0x3ab62c(0x1fc)]('white_domain_responses',{'type':_0x3ab62c(0x1e7),'gateway':_0x2ec450,'endpoint':_0xedd128,'status':_0x29e895,'responseTime':_0x25234b,'data':_0x566930});}[a49_0x191073(0x1cc)](_0x1f646a,_0x592f67,_0x1717cf){const _0x2ebcc7=a49_0x191073;this['writeLog'](_0x2ebcc7(0x1dd),{'type':_0x2ebcc7(0x1f4),'gateway':_0x1f646a,'endpoint':_0x592f67,'error':_0x1717cf instanceof Error?{'message':_0x1717cf[_0x2ebcc7(0x1fe)],'stack':_0x1717cf[_0x2ebcc7(0x1fd)]}:_0x1717cf});}[a49_0x191073(0x1cd)](_0x4ef7ef,_0x4bc84f,_0x55abc2){const _0x319209=a49_0x191073;this[_0x319209(0x1fc)](_0x319209(0x1ea),{'type':_0x319209(0x1c4),'gateway':_0x4ef7ef,'headers':_0x55abc2,'data':_0x4bc84f});}['logWebhookProcessed'](_0x44bfdc,_0x55b43f,_0x10a3b8,_0x576810,_0x2765f8){const _0x4cb189=a49_0x191073;this[_0x4cb189(0x1fc)](_0x4cb189(0x1c9),{'type':_0x4cb189(0x1e8),'gateway':_0x44bfdc,'paymentId':_0x55b43f,'oldStatus':_0x10a3b8,'newStatus':_0x576810,'originalData':_0x2765f8});}[a49_0x191073(0x1e2)](_0x2e1b18,_0x1910d2,_0x240b31){const _0x263dac=a49_0x191073;this['writeLog'](_0x263dac(0x1d2),{'type':_0x263dac(0x200),'gateway':_0x2e1b18,'error':_0x1910d2 instanceof Error?{'message':_0x1910d2[_0x263dac(0x1fe)],'stack':_0x1910d2['stack']}:_0x1910d2,'originalData':_0x240b31});}[a49_0x191073(0x1de)](_0x4dfbb7){const _0x3332e9=a49_0x191073;this['writeLog'](_0x3332e9(0x1d1),{'type':_0x3332e9(0x214),..._0x4dfbb7});}[a49_0x191073(0x1f9)](_0xe00808){this['writeLog']('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0xe00808});}[a49_0x191073(0x1d5)](_0x3eabd9,_0x5e5134,_0x471900,_0x183272,_0x1e4799,_0x1bc79c){const _0x2d4bbf=a49_0x191073;this[_0x2d4bbf(0x1fc)](_0x2d4bbf(0x20e),{'type':_0x2d4bbf(0x1ec),'shopId':_0x3eabd9,'webhookUrl':_0x5e5134,'event':_0x471900,'status':_0x183272,'responseTime':_0x1e4799,'payload':_0x1bc79c});}['logShopWebhookError'](_0x553407,_0x1640c8,_0x29497f,_0x4d0549,_0x41d70a){const _0x39f4cb=a49_0x191073;this[_0x39f4cb(0x1fc)](_0x39f4cb(0x1f7),{'type':_0x39f4cb(0x209),'shopId':_0x553407,'webhookUrl':_0x1640c8,'event':_0x29497f,'error':_0x4d0549 instanceof Error?{'message':_0x4d0549[_0x39f4cb(0x1fe)],'stack':_0x4d0549['stack']}:_0x4d0549,'payload':_0x41d70a});}[a49_0x191073(0x213)](_0x43931e,_0x12dfbd,_0x5782e6,_0x47e829,_0x4bb8d4){const _0x2d21f3=a49_0x191073;this['writeLog'](_0x2d21f3(0x1df),{'type':_0x2d21f3(0x1d7),'gateway':_0x43931e,'paymentId':_0x12dfbd,'shopId':_0x5782e6,'amount':_0x47e829,'currency':_0x4bb8d4});}[a49_0x191073(0x1ed)](_0x59730f,_0x5317b8,_0x5c7404,_0xdf602c,_0x13e55f){const _0x55ab8a=a49_0x191073;this[_0x55ab8a(0x1fc)](_0x55ab8a(0x215),{'type':_0x55ab8a(0x203),'endpoint':_0x59730f,'method':_0x5317b8,'userId':_0x5c7404,'userRole':_0xdf602c,'requestData':_0x13e55f});}[a49_0x191073(0x1fa)](){const _0x29b6ce=a49_0x191073;try{const _0x5e9242=fs_1[_0x29b6ce(0x1cf)]['readdirSync'](this[_0x29b6ce(0x1d6)]),_0x96a1a1=_0x5e9242[_0x29b6ce(0x1eb)](_0x4a01ca=>_0x4a01ca[_0x29b6ce(0x20f)](_0x29b6ce(0x1c2))),_0x2ea6a0=[...new Set(_0x96a1a1[_0x29b6ce(0x1d3)](_0x355ec6=>_0x355ec6[_0x29b6ce(0x1da)]('_')[0x0]))],_0x38d979=_0x96a1a1[_0x29b6ce(0x1d3)](_0x2e55c6=>{const _0x1f0f0c=_0x29b6ce,_0x2cd793=path_1[_0x1f0f0c(0x1cf)]['join'](this[_0x1f0f0c(0x1d6)],_0x2e55c6),_0x4933a4=fs_1['default'][_0x1f0f0c(0x201)](_0x2cd793),[_0x580df5,_0x4c6031]=_0x2e55c6['replace'](_0x1f0f0c(0x1c2),'')[_0x1f0f0c(0x1da)]('_');return{'type':_0x580df5,'date':_0x4c6031,'size':_0x4933a4[_0x1f0f0c(0x1f3)]};})[_0x29b6ce(0x1d9)]((_0x2811f4,_0x1570b7)=>_0x1570b7[_0x29b6ce(0x1ce)][_0x29b6ce(0x1ff)](_0x2811f4['date']));return{'totalFiles':_0x96a1a1['length'],'logTypes':_0x2ea6a0,'latestLogs':_0x38d979['slice'](0x0,0xa)};}catch(_0x498966){return console['error'](_0x29b6ce(0x1cb),_0x498966),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x434ed9=0x1e){const _0x566044=a49_0x191073;try{const _0x2ce680=fs_1[_0x566044(0x1cf)]['readdirSync'](this[_0x566044(0x1d6)]),_0x41601b=new Date();_0x41601b['setDate'](_0x41601b[_0x566044(0x20d)]()-_0x434ed9);let _0x4111ed=0x0;_0x2ce680[_0x566044(0x1c7)](_0x23a77a=>{const _0x57b98b=_0x566044;if(!_0x23a77a[_0x57b98b(0x20f)](_0x57b98b(0x1c2)))return;const _0x48d033=path_1[_0x57b98b(0x1cf)][_0x57b98b(0x20c)](this[_0x57b98b(0x1d6)],_0x23a77a),_0x475072=fs_1['default']['statSync'](_0x48d033);_0x475072[_0x57b98b(0x1db)]<_0x41601b&&(fs_1[_0x57b98b(0x1cf)][_0x57b98b(0x207)](_0x48d033),_0x4111ed++,console[_0x57b98b(0x1fb)](_0x57b98b(0x1c8)+_0x23a77a));}),console['log'](_0x566044(0x1d4)+_0x4111ed+_0x566044(0x1e3)+_0x434ed9+_0x566044(0x1f1));}catch(_0x34fab1){console[_0x566044(0x1f5)](_0x566044(0x1ca),_0x34fab1);}}}exports[a49_0x191073(0x1c6)]=LoggerService,exports[a49_0x191073(0x1e1)]=new LoggerService();