'use strict';const a48_0x7ac0f9=a48_0x47c6;(function(_0x11d6b3,_0x289a5f){const _0x2eaa6e=a48_0x47c6,_0x33ab1c=_0x11d6b3();while(!![]){try{const _0x291fbc=parseInt(_0x2eaa6e(0xf3))/0x1*(parseInt(_0x2eaa6e(0xca))/0x2)+parseInt(_0x2eaa6e(0xc8))/0x3+-parseInt(_0x2eaa6e(0x10b))/0x4*(-parseInt(_0x2eaa6e(0xe1))/0x5)+-parseInt(_0x2eaa6e(0xc7))/0x6+parseInt(_0x2eaa6e(0xe4))/0x7*(-parseInt(_0x2eaa6e(0xce))/0x8)+-parseInt(_0x2eaa6e(0xf8))/0x9+parseInt(_0x2eaa6e(0xfe))/0xa*(parseInt(_0x2eaa6e(0xee))/0xb);if(_0x291fbc===_0x289a5f)break;else _0x33ab1c['push'](_0x33ab1c['shift']());}catch(_0x29be2f){_0x33ab1c['push'](_0x33ab1c['shift']());}}}(a48_0x4d21,0xcd22b));function a48_0x47c6(_0x870e1c,_0x10bdd4){const _0x4d219a=a48_0x4d21();return a48_0x47c6=function(_0x47c6a3,_0x5d164d){_0x47c6a3=_0x47c6a3-0xc6;let _0x55d79a=_0x4d219a[_0x47c6a3];return _0x55d79a;},a48_0x47c6(_0x870e1c,_0x10bdd4);}var __importDefault=this&&this[a48_0x7ac0f9(0xe3)]||function(_0x41c600){return _0x41c600&&_0x41c600['__esModule']?_0x41c600:{'default':_0x41c600};};Object['defineProperty'](exports,a48_0x7ac0f9(0xe5),{'value':!![]}),exports['loggerService']=exports[a48_0x7ac0f9(0xcd)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));function a48_0x4d21(){const _0x5a6296=['date','white_domain_errors','setDate','length','cleanOldLogs','message','3418212uBzUCs','614013oURzuC','log','2882oEDNeY','logWhiteDomainError','WEBHOOK_ERROR','LoggerService','5396176uiqKxe','white_domain_requests','slice','logWebhookError','\x20days)','join','appendFileSync','payments_created','map','logShopWebhookSent','logsDir','error','default','logs','unlinkSync','logShopWebhookError','shop_webhooks_sent','webhooks_received','getLogStats','230BVYsHB','API_CALL','__importDefault','7AuYFdq','__esModule','\x20old\x20log\x20files\x20(older\x20than\x20','forEach','\x20log:','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logCoinToPayStatus','logApiCall','statSync','WEBHOOK_RECEIVED','74822BJgikY','webhooks_errors','filter','logWhiteDomainRequest','ensureLogsDirectory','677BZbcrj','split','getLogFileName','logWebhookReceived','🧹\x20Cleaned\x20','2158047ZwBlte','existsSync','RESPONSE','logPaymentCreated','SHOP_WEBHOOK_ERROR','cointopay_status_changes','700BxojLC','PAYMENT_CREATED','.log','size','ERROR','endsWith','stack','COINTOPAY_STATUS_CHANGE','webhooks_processed','COINTOPAY_ERROR','writeLog','SHOP_WEBHOOK_SENT','Failed\x20to\x20write\x20','58076BWCXUg','logWhiteDomainResponse','readdirSync','stringify'];a48_0x4d21=function(){return _0x5a6296;};return a48_0x4d21();}class LoggerService{constructor(){const _0x28614c=a48_0x7ac0f9;this[_0x28614c(0xd8)]=path_1[_0x28614c(0xda)][_0x28614c(0xd3)](process['cwd'](),_0x28614c(0xdb)),this[_0x28614c(0xf2)]();}[a48_0x7ac0f9(0xf2)](){const _0x275e4e=a48_0x7ac0f9;!fs_1['default'][_0x275e4e(0xf9)](this[_0x275e4e(0xd8)])&&(fs_1[_0x275e4e(0xda)]['mkdirSync'](this[_0x275e4e(0xd8)],{'recursive':!![]}),console[_0x275e4e(0xc9)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x275e4e(0xd8)]));}[a48_0x7ac0f9(0xf5)](_0x3b0419){const _0xf54a1d=a48_0x7ac0f9,_0xcb6f81=new Date()['toISOString']()[_0xf54a1d(0xf4)]('T')[0x0];return path_1['default']['join'](this[_0xf54a1d(0xd8)],_0x3b0419+'_'+_0xcb6f81+_0xf54a1d(0x100));}[a48_0x7ac0f9(0x108)](_0x3023b9,_0x121945){const _0x1fadc6=a48_0x7ac0f9;try{const _0x39bc62=new Date()['toISOString'](),_0x3257cf={'timestamp':_0x39bc62,..._0x121945},_0x926481=JSON[_0x1fadc6(0x10e)](_0x3257cf)+'\x0a',_0x242a7c=this['getLogFileName'](_0x3023b9);fs_1['default'][_0x1fadc6(0xd4)](_0x242a7c,_0x926481,'utf8');}catch(_0x36bc3b){console[_0x1fadc6(0xd9)](_0x1fadc6(0x10a)+_0x3023b9+_0x1fadc6(0xe8),_0x36bc3b);}}[a48_0x7ac0f9(0xf1)](_0x377d33,_0x115f34,_0x586609,_0x1e6e7c){const _0x504150=a48_0x7ac0f9;this[_0x504150(0x108)](_0x504150(0xcf),{'type':'REQUEST','gateway':_0x377d33,'endpoint':_0x115f34,'method':_0x586609,'data':_0x1e6e7c});}[a48_0x7ac0f9(0x10c)](_0x367f85,_0x4af2d2,_0x4bc6f0,_0x5970c9,_0x410148){const _0xc9df26=a48_0x7ac0f9;this[_0xc9df26(0x108)]('white_domain_responses',{'type':_0xc9df26(0xfa),'gateway':_0x367f85,'endpoint':_0x4af2d2,'status':_0x4bc6f0,'responseTime':_0x410148,'data':_0x5970c9});}[a48_0x7ac0f9(0xcb)](_0x249611,_0x224c56,_0x3484b8){const _0x188821=a48_0x7ac0f9;this[_0x188821(0x108)](_0x188821(0x110),{'type':_0x188821(0x102),'gateway':_0x249611,'endpoint':_0x224c56,'error':_0x3484b8 instanceof Error?{'message':_0x3484b8[_0x188821(0xc6)],'stack':_0x3484b8['stack']}:_0x3484b8});}[a48_0x7ac0f9(0xf6)](_0x29dac3,_0x4e1272,_0x29ce59){const _0x27c04b=a48_0x7ac0f9;this[_0x27c04b(0x108)](_0x27c04b(0xdf),{'type':_0x27c04b(0xed),'gateway':_0x29dac3,'headers':_0x29ce59,'data':_0x4e1272});}['logWebhookProcessed'](_0x5a4bd2,_0x48f2c3,_0x168d19,_0x4b5a64,_0x19e3a3){const _0x1e2d33=a48_0x7ac0f9;this[_0x1e2d33(0x108)](_0x1e2d33(0x106),{'type':'WEBHOOK_PROCESSED','gateway':_0x5a4bd2,'paymentId':_0x48f2c3,'oldStatus':_0x168d19,'newStatus':_0x4b5a64,'originalData':_0x19e3a3});}[a48_0x7ac0f9(0xd1)](_0x5b083e,_0x5a83c0,_0x3e5c86){const _0x43b0e0=a48_0x7ac0f9;this['writeLog'](_0x43b0e0(0xef),{'type':_0x43b0e0(0xcc),'gateway':_0x5b083e,'error':_0x5a83c0 instanceof Error?{'message':_0x5a83c0[_0x43b0e0(0xc6)],'stack':_0x5a83c0['stack']}:_0x5a83c0,'originalData':_0x3e5c86});}[a48_0x7ac0f9(0xea)](_0x85b285){const _0x37fba6=a48_0x7ac0f9;this[_0x37fba6(0x108)](_0x37fba6(0xfd),{'type':_0x37fba6(0x105),..._0x85b285});}['logCoinToPayError'](_0x432b6c){const _0x1a68eb=a48_0x7ac0f9;this[_0x1a68eb(0x108)]('cointopay_errors',{'type':_0x1a68eb(0x107),..._0x432b6c});}[a48_0x7ac0f9(0xd7)](_0x32f679,_0x28eb60,_0x568ba7,_0x49f678,_0x481262,_0x39a135){const _0x5d904b=a48_0x7ac0f9;this[_0x5d904b(0x108)](_0x5d904b(0xde),{'type':_0x5d904b(0x109),'shopId':_0x32f679,'webhookUrl':_0x28eb60,'event':_0x568ba7,'status':_0x49f678,'responseTime':_0x481262,'payload':_0x39a135});}[a48_0x7ac0f9(0xdd)](_0x38e0a4,_0x39de82,_0x10ec98,_0x59b1d3,_0xc7b048){const _0x2ca779=a48_0x7ac0f9;this[_0x2ca779(0x108)]('shop_webhooks_errors',{'type':_0x2ca779(0xfc),'shopId':_0x38e0a4,'webhookUrl':_0x39de82,'event':_0x10ec98,'error':_0x59b1d3 instanceof Error?{'message':_0x59b1d3['message'],'stack':_0x59b1d3[_0x2ca779(0x104)]}:_0x59b1d3,'payload':_0xc7b048});}[a48_0x7ac0f9(0xfb)](_0x4e47f2,_0x5f363e,_0x441047,_0x5f2d88,_0x5cdc10){const _0x16da07=a48_0x7ac0f9;this[_0x16da07(0x108)](_0x16da07(0xd5),{'type':_0x16da07(0xff),'gateway':_0x4e47f2,'paymentId':_0x5f363e,'shopId':_0x441047,'amount':_0x5f2d88,'currency':_0x5cdc10});}[a48_0x7ac0f9(0xeb)](_0x4d823e,_0x1b1edc,_0x33c109,_0xeb33c9,_0x63acaf){const _0x1e6ee5=a48_0x7ac0f9;this[_0x1e6ee5(0x108)]('api_calls',{'type':_0x1e6ee5(0xe2),'endpoint':_0x4d823e,'method':_0x1b1edc,'userId':_0x33c109,'userRole':_0xeb33c9,'requestData':_0x63acaf});}[a48_0x7ac0f9(0xe0)](){const _0x237830=a48_0x7ac0f9;try{const _0x2af0b2=fs_1['default'][_0x237830(0x10d)](this['logsDir']),_0x5e27c2=_0x2af0b2[_0x237830(0xf0)](_0x27f7b8=>_0x27f7b8[_0x237830(0x103)](_0x237830(0x100))),_0xe04181=[...new Set(_0x5e27c2[_0x237830(0xd6)](_0x2ca812=>_0x2ca812[_0x237830(0xf4)]('_')[0x0]))],_0x4dd26b=_0x5e27c2['map'](_0x1ed56b=>{const _0x39ed03=_0x237830,_0x7c7636=path_1['default'][_0x39ed03(0xd3)](this[_0x39ed03(0xd8)],_0x1ed56b),_0x2ba103=fs_1[_0x39ed03(0xda)][_0x39ed03(0xec)](_0x7c7636),[_0x4e3aac,_0x556d07]=_0x1ed56b['replace'](_0x39ed03(0x100),'')['split']('_');return{'type':_0x4e3aac,'date':_0x556d07,'size':_0x2ba103[_0x39ed03(0x101)]};})['sort']((_0x1f65ee,_0x2203ee)=>_0x2203ee['date']['localeCompare'](_0x1f65ee[_0x237830(0x10f)]));return{'totalFiles':_0x5e27c2[_0x237830(0x112)],'logTypes':_0xe04181,'latestLogs':_0x4dd26b[_0x237830(0xd0)](0x0,0xa)};}catch(_0xc9e446){return console[_0x237830(0xd9)]('Failed\x20to\x20get\x20log\x20stats:',_0xc9e446),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x7ac0f9(0x113)](_0x1fee00=0x1e){const _0x24c5fb=a48_0x7ac0f9;try{const _0x7c62b7=fs_1[_0x24c5fb(0xda)][_0x24c5fb(0x10d)](this[_0x24c5fb(0xd8)]),_0x29628a=new Date();_0x29628a[_0x24c5fb(0x111)](_0x29628a['getDate']()-_0x1fee00);let _0x2e2729=0x0;_0x7c62b7[_0x24c5fb(0xe7)](_0x432088=>{const _0x4bd4da=_0x24c5fb;if(!_0x432088[_0x4bd4da(0x103)]('.log'))return;const _0x424024=path_1[_0x4bd4da(0xda)][_0x4bd4da(0xd3)](this[_0x4bd4da(0xd8)],_0x432088),_0x1169e4=fs_1['default']['statSync'](_0x424024);_0x1169e4['mtime']<_0x29628a&&(fs_1[_0x4bd4da(0xda)][_0x4bd4da(0xdc)](_0x424024),_0x2e2729++,console['log'](_0x4bd4da(0xe9)+_0x432088));}),console[_0x24c5fb(0xc9)](_0x24c5fb(0xf7)+_0x2e2729+_0x24c5fb(0xe6)+_0x1fee00+_0x24c5fb(0xd2));}catch(_0x1a2c04){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x1a2c04);}}}exports[a48_0x7ac0f9(0xcd)]=LoggerService,exports['loggerService']=new LoggerService();