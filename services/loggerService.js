'use strict';const a67_0x54da7e=a67_0x3b4b;function a67_0x171b(){const _0x436201=['replace','mtime','logShopWebhookSent','ðŸ§¹\x20Cleaned\x20','api_calls','WEBHOOK_PROCESSED','logWhiteDomainResponse','logCoinToPayError','writeLog','defineProperty','existsSync','155889WlaQhr','9hgFeQP','filter','Failed\x20to\x20clean\x20old\x20logs:','1yveexa','loggerService','getLogStats','error','logWebhookError','RESPONSE','cleanOldLogs','path','getLogFileName','payments_created','\x20old\x20log\x20files\x20(older\x20than\x20','cwd','LoggerService','white_domain_requests','date','length','map','join','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','ðŸ“\x20Created\x20logs\x20directory:\x20','PAYMENT_CREATED','log','split','webhooks_received','stack','101755QlUAkN','default','setDate','cointopay_status_changes','size','getDate','sort','message','SHOP_WEBHOOK_SENT','webhooks_errors','unlinkSync','\x20log:','logsDir','WEBHOOK_ERROR','Failed\x20to\x20get\x20log\x20stats:','Failed\x20to\x20write\x20','localeCompare','slice','822fjXYdQ','webhooks_processed','11pYfztP','152iXzQiy','WEBHOOK_RECEIVED','4021788mjrwYw','logWebhookProcessed','white_domain_responses','__esModule','statSync','__importDefault','logWhiteDomainRequest','5467NTTLVZ','REQUEST','appendFileSync','ensureLogsDirectory','shop_webhooks_sent','toISOString','.log','logWhiteDomainError','4875400emvDwZ','SHOP_WEBHOOK_ERROR','ERROR','API_CALL','stringify','logApiCall','967682dYcbRz','1337608SpeKkq','logWebhookReceived','readdirSync','logs'];a67_0x171b=function(){return _0x436201;};return a67_0x171b();}(function(_0x1285eb,_0x531d31){const _0x3601d5=a67_0x3b4b,_0x5b5276=_0x1285eb();while(!![]){try{const _0x19fff6=-parseInt(_0x3601d5(0xe6))/0x1*(parseInt(_0x3601d5(0xd2))/0x2)+parseInt(_0x3601d5(0xe2))/0x3+-parseInt(_0x3601d5(0xbb))/0x4*(-parseInt(_0x3601d5(0xff))/0x5)+parseInt(_0x3601d5(0xb8))/0x6*(parseInt(_0x3601d5(0xc4))/0x7)+parseInt(_0x3601d5(0xd3))/0x8*(-parseInt(_0x3601d5(0xe3))/0x9)+parseInt(_0x3601d5(0xcc))/0xa+parseInt(_0x3601d5(0xba))/0xb*(-parseInt(_0x3601d5(0xbd))/0xc);if(_0x19fff6===_0x531d31)break;else _0x5b5276['push'](_0x5b5276['shift']());}catch(_0x71249b){_0x5b5276['push'](_0x5b5276['shift']());}}}(a67_0x171b,0x69def));var __importDefault=this&&this[a67_0x54da7e(0xc2)]||function(_0x3156a1){const _0x1bd7cb=a67_0x54da7e;return _0x3156a1&&_0x3156a1[_0x1bd7cb(0xc0)]?_0x3156a1:{'default':_0x3156a1};};function a67_0x3b4b(_0x278763,_0x69420b){_0x278763=_0x278763-0xb3;const _0x171bf5=a67_0x171b();let _0x3b4b39=_0x171bf5[_0x278763];return _0x3b4b39;}Object[a67_0x54da7e(0xe0)](exports,a67_0x54da7e(0xc0),{'value':!![]}),exports['loggerService']=exports[a67_0x54da7e(0xf2)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a67_0x54da7e(0xed)));class LoggerService{constructor(){const _0x599e86=a67_0x54da7e;this[_0x599e86(0x10b)]=path_1['default']['join'](process[_0x599e86(0xf1)](),_0x599e86(0xd6)),this['ensureLogsDirectory']();}[a67_0x54da7e(0xc7)](){const _0x31b334=a67_0x54da7e;!fs_1[_0x31b334(0x100)][_0x31b334(0xe1)](this[_0x31b334(0x10b)])&&(fs_1[_0x31b334(0x100)]['mkdirSync'](this[_0x31b334(0x10b)],{'recursive':!![]}),console[_0x31b334(0xfb)](_0x31b334(0xf9)+this[_0x31b334(0x10b)]));}[a67_0x54da7e(0xee)](_0x4ff42b){const _0x4e00ee=a67_0x54da7e,_0x3927c2=new Date()[_0x4e00ee(0xc9)]()[_0x4e00ee(0xfc)]('T')[0x0];return path_1[_0x4e00ee(0x100)][_0x4e00ee(0xf7)](this['logsDir'],_0x4ff42b+'_'+_0x3927c2+'.log');}['writeLog'](_0x2b84a1,_0x22620f){const _0x1f9a5a=a67_0x54da7e;try{const _0x449848=new Date()['toISOString'](),_0x26450d={'timestamp':_0x449848,..._0x22620f},_0x16427c=JSON[_0x1f9a5a(0xd0)](_0x26450d)+'\x0a',_0x8c3806=this[_0x1f9a5a(0xee)](_0x2b84a1);fs_1['default'][_0x1f9a5a(0xc6)](_0x8c3806,_0x16427c,'utf8');}catch(_0x552bbf){console[_0x1f9a5a(0xe9)](_0x1f9a5a(0xb5)+_0x2b84a1+_0x1f9a5a(0x10a),_0x552bbf);}}[a67_0x54da7e(0xc3)](_0xd8d69c,_0x1db596,_0x449ad1,_0x56ff21){const _0xf91894=a67_0x54da7e;this['writeLog'](_0xf91894(0xf3),{'type':_0xf91894(0xc5),'gateway':_0xd8d69c,'endpoint':_0x1db596,'method':_0x449ad1,'data':_0x56ff21});}[a67_0x54da7e(0xdd)](_0x1ff231,_0x250c1a,_0x2f704d,_0x160f93,_0x255ee0){const _0x22e319=a67_0x54da7e;this['writeLog'](_0x22e319(0xbf),{'type':_0x22e319(0xeb),'gateway':_0x1ff231,'endpoint':_0x250c1a,'status':_0x2f704d,'responseTime':_0x255ee0,'data':_0x160f93});}[a67_0x54da7e(0xcb)](_0x13cd9e,_0x343b55,_0xa994c4){const _0x3bd040=a67_0x54da7e;this[_0x3bd040(0xdf)]('white_domain_errors',{'type':_0x3bd040(0xce),'gateway':_0x13cd9e,'endpoint':_0x343b55,'error':_0xa994c4 instanceof Error?{'message':_0xa994c4['message'],'stack':_0xa994c4[_0x3bd040(0xfe)]}:_0xa994c4});}[a67_0x54da7e(0xd4)](_0x2b43c3,_0x5993c3,_0x17c141){const _0x22c79b=a67_0x54da7e;this[_0x22c79b(0xdf)](_0x22c79b(0xfd),{'type':_0x22c79b(0xbc),'gateway':_0x2b43c3,'headers':_0x17c141,'data':_0x5993c3});}[a67_0x54da7e(0xbe)](_0x4b8620,_0x1381de,_0x5e521f,_0x2a81e1,_0xcde31e){const _0x4d6394=a67_0x54da7e;this['writeLog'](_0x4d6394(0xb9),{'type':_0x4d6394(0xdc),'gateway':_0x4b8620,'paymentId':_0x1381de,'oldStatus':_0x5e521f,'newStatus':_0x2a81e1,'originalData':_0xcde31e});}[a67_0x54da7e(0xea)](_0xe44f9b,_0x3b28c1,_0x507ab3){const _0x5cb5bc=a67_0x54da7e;this['writeLog'](_0x5cb5bc(0x108),{'type':_0x5cb5bc(0xb3),'gateway':_0xe44f9b,'error':_0x3b28c1 instanceof Error?{'message':_0x3b28c1['message'],'stack':_0x3b28c1[_0x5cb5bc(0xfe)]}:_0x3b28c1,'originalData':_0x507ab3});}['logCoinToPayStatus'](_0x410fb3){const _0x495a93=a67_0x54da7e;this['writeLog'](_0x495a93(0x102),{'type':'COINTOPAY_STATUS_CHANGE',..._0x410fb3});}[a67_0x54da7e(0xde)](_0x4d897b){this['writeLog']('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x4d897b});}[a67_0x54da7e(0xd9)](_0x477c0f,_0x4a1bba,_0x116040,_0x14d4c2,_0x123544,_0x5448f1){const _0x2ccab8=a67_0x54da7e;this[_0x2ccab8(0xdf)](_0x2ccab8(0xc8),{'type':_0x2ccab8(0x107),'shopId':_0x477c0f,'webhookUrl':_0x4a1bba,'event':_0x116040,'status':_0x14d4c2,'responseTime':_0x123544,'payload':_0x5448f1});}['logShopWebhookError'](_0x47653c,_0x286f50,_0x3ca2cb,_0x119cab,_0xbb038f){const _0x5ca886=a67_0x54da7e;this[_0x5ca886(0xdf)]('shop_webhooks_errors',{'type':_0x5ca886(0xcd),'shopId':_0x47653c,'webhookUrl':_0x286f50,'event':_0x3ca2cb,'error':_0x119cab instanceof Error?{'message':_0x119cab[_0x5ca886(0x106)],'stack':_0x119cab[_0x5ca886(0xfe)]}:_0x119cab,'payload':_0xbb038f});}['logPaymentCreated'](_0x228a42,_0x374da7,_0x3a8a1c,_0x3ad3f0,_0x2f6150){const _0x3bf266=a67_0x54da7e;this[_0x3bf266(0xdf)](_0x3bf266(0xef),{'type':_0x3bf266(0xfa),'gateway':_0x228a42,'paymentId':_0x374da7,'shopId':_0x3a8a1c,'amount':_0x3ad3f0,'currency':_0x2f6150});}[a67_0x54da7e(0xd1)](_0x4cbee9,_0x5af0c3,_0x25bdc3,_0x12d47d,_0x533a01){const _0xf6147a=a67_0x54da7e;this[_0xf6147a(0xdf)](_0xf6147a(0xdb),{'type':_0xf6147a(0xcf),'endpoint':_0x4cbee9,'method':_0x5af0c3,'userId':_0x25bdc3,'userRole':_0x12d47d,'requestData':_0x533a01});}[a67_0x54da7e(0xe8)](){const _0x4041d9=a67_0x54da7e;try{const _0xe81dd1=fs_1['default'][_0x4041d9(0xd5)](this[_0x4041d9(0x10b)]),_0xa77e4d=_0xe81dd1[_0x4041d9(0xe4)](_0xfa0b5a=>_0xfa0b5a['endsWith'](_0x4041d9(0xca))),_0x47fc18=[...new Set(_0xa77e4d[_0x4041d9(0xf6)](_0x4e176d=>_0x4e176d[_0x4041d9(0xfc)]('_')[0x0]))],_0x598e95=_0xa77e4d[_0x4041d9(0xf6)](_0x215f23=>{const _0x1068d9=_0x4041d9,_0x597a5e=path_1[_0x1068d9(0x100)][_0x1068d9(0xf7)](this['logsDir'],_0x215f23),_0x21b31e=fs_1['default']['statSync'](_0x597a5e),[_0x1f1b56,_0x5eb60f]=_0x215f23[_0x1068d9(0xd7)]('.log','')[_0x1068d9(0xfc)]('_');return{'type':_0x1f1b56,'date':_0x5eb60f,'size':_0x21b31e[_0x1068d9(0x103)]};})[_0x4041d9(0x105)]((_0x15e11f,_0xf1072)=>_0xf1072['date'][_0x4041d9(0xb6)](_0x15e11f[_0x4041d9(0xf4)]));return{'totalFiles':_0xa77e4d[_0x4041d9(0xf5)],'logTypes':_0x47fc18,'latestLogs':_0x598e95[_0x4041d9(0xb7)](0x0,0xa)};}catch(_0x568ec5){return console['error'](_0x4041d9(0xb4),_0x568ec5),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a67_0x54da7e(0xec)](_0x1fba4c=0x1e){const _0x5cd570=a67_0x54da7e;try{const _0xdff21e=fs_1[_0x5cd570(0x100)][_0x5cd570(0xd5)](this['logsDir']),_0x4c30c6=new Date();_0x4c30c6[_0x5cd570(0x101)](_0x4c30c6[_0x5cd570(0x104)]()-_0x1fba4c);let _0x48ccef=0x0;_0xdff21e['forEach'](_0x7e2e4c=>{const _0x4838cc=_0x5cd570;if(!_0x7e2e4c['endsWith'](_0x4838cc(0xca)))return;const _0x44dea9=path_1[_0x4838cc(0x100)][_0x4838cc(0xf7)](this[_0x4838cc(0x10b)],_0x7e2e4c),_0x43ee26=fs_1[_0x4838cc(0x100)][_0x4838cc(0xc1)](_0x44dea9);_0x43ee26[_0x4838cc(0xd8)]<_0x4c30c6&&(fs_1['default'][_0x4838cc(0x109)](_0x44dea9),_0x48ccef++,console[_0x4838cc(0xfb)](_0x4838cc(0xf8)+_0x7e2e4c));}),console[_0x5cd570(0xfb)](_0x5cd570(0xda)+_0x48ccef+_0x5cd570(0xf0)+_0x1fba4c+'\x20days)');}catch(_0xec0785){console[_0x5cd570(0xe9)](_0x5cd570(0xe5),_0xec0785);}}}exports[a67_0x54da7e(0xf2)]=LoggerService,exports[a67_0x54da7e(0xe7)]=new LoggerService();