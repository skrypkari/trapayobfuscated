'use strict';const a47_0x2e79ac=a47_0x1745;(function(_0x500e5b,_0x20c490){const _0x3763ac=a47_0x1745,_0x4e2412=_0x500e5b();while(!![]){try{const _0x5d4a22=-parseInt(_0x3763ac(0x1d5))/0x1+parseInt(_0x3763ac(0x1ac))/0x2*(parseInt(_0x3763ac(0x1a6))/0x3)+-parseInt(_0x3763ac(0x1a4))/0x4*(-parseInt(_0x3763ac(0x1ed))/0x5)+parseInt(_0x3763ac(0x1d7))/0x6*(-parseInt(_0x3763ac(0x1bd))/0x7)+parseInt(_0x3763ac(0x1e8))/0x8*(parseInt(_0x3763ac(0x1ee))/0x9)+-parseInt(_0x3763ac(0x1e0))/0xa+parseInt(_0x3763ac(0x199))/0xb*(parseInt(_0x3763ac(0x19a))/0xc);if(_0x5d4a22===_0x20c490)break;else _0x4e2412['push'](_0x4e2412['shift']());}catch(_0x1cef09){_0x4e2412['push'](_0x4e2412['shift']());}}}(a47_0xf3c1,0x3e497));function a47_0xf3c1(){const _0x10eff1=['length','RESPONSE','21GigWQK','unlinkSync','api_calls','localeCompare','cwd','ERROR','webhooks_errors','endsWith','path','stringify','\x20log:','logShopWebhookError','white_domain_responses','webhooks_received','WEBHOOK_ERROR','error','log','\x20old\x20log\x20files\x20(older\x20than\x20','slice','__importDefault','date','\x20days)','getDate','shop_webhooks_sent','224274vYcsCM','sort','392226HLTbhS','existsSync','statSync','join','defineProperty','loggerService','COINTOPAY_STATUS_CHANGE','readdirSync','utf8','1399750lIZnpA','shop_webhooks_errors','writeLog','logWhiteDomainRequest','default','logCoinToPayError','__esModule','WEBHOOK_PROCESSED','9208lfOkgi','filter','stack','logCoinToPayStatus','SHOP_WEBHOOK_ERROR','5FvgnEM','279hVDHJk','logApiCall','497409MUanud','108YaHBKz','logWebhookProcessed','replace','split','LoggerService','SHOP_WEBHOOK_SENT','logsDir','toISOString','map','mtime','874972XRvHna','getLogStats','231141yTkeet','API_CALL','mkdirSync','cleanOldLogs','getLogFileName','Failed\x20to\x20clean\x20old\x20logs:','4rNHIbq','.log','white_domain_errors','logWebhookReceived','COINTOPAY_ERROR','logWebhookError','logWhiteDomainResponse','logWhiteDomainError','🧹\x20Cleaned\x20','📁\x20Created\x20logs\x20directory:\x20','webhooks_processed','🗑️\x20Deleted\x20old\x20log\x20file:\x20','forEach','message','cointopay_status_changes'];a47_0xf3c1=function(){return _0x10eff1;};return a47_0xf3c1();}var __importDefault=this&&this[a47_0x2e79ac(0x1d0)]||function(_0x9b32ae){return _0x9b32ae&&_0x9b32ae['__esModule']?_0x9b32ae:{'default':_0x9b32ae};};Object[a47_0x2e79ac(0x1db)](exports,a47_0x2e79ac(0x1e6),{'value':!![]}),exports[a47_0x2e79ac(0x1dc)]=exports[a47_0x2e79ac(0x19e)]=void 0x0;function a47_0x1745(_0x14bccd,_0x5aab5c){const _0xf3c1fb=a47_0xf3c1();return a47_0x1745=function(_0x174506,_0xc20dc3){_0x174506=_0x174506-0x198;let _0x169267=_0xf3c1fb[_0x174506];return _0x169267;},a47_0x1745(_0x14bccd,_0x5aab5c);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a47_0x2e79ac(0x1c5)));class LoggerService{constructor(){const _0x276be2=a47_0x2e79ac;this['logsDir']=path_1[_0x276be2(0x1e4)][_0x276be2(0x1da)](process[_0x276be2(0x1c1)](),'logs'),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x187702=a47_0x2e79ac;!fs_1[_0x187702(0x1e4)][_0x187702(0x1d8)](this[_0x187702(0x1a0)])&&(fs_1['default'][_0x187702(0x1a8)](this[_0x187702(0x1a0)],{'recursive':!![]}),console[_0x187702(0x1cd)](_0x187702(0x1b5)+this['logsDir']));}[a47_0x2e79ac(0x1aa)](_0x44fb92){const _0x450953=a47_0x2e79ac,_0x322c83=new Date()[_0x450953(0x1a1)]()[_0x450953(0x19d)]('T')[0x0];return path_1[_0x450953(0x1e4)][_0x450953(0x1da)](this[_0x450953(0x1a0)],_0x44fb92+'_'+_0x322c83+_0x450953(0x1ad));}[a47_0x2e79ac(0x1e2)](_0x128f3e,_0x5b68e1){const _0x406a2a=a47_0x2e79ac;try{const _0x58da25=new Date()[_0x406a2a(0x1a1)](),_0x26dbd8={'timestamp':_0x58da25,..._0x5b68e1},_0x200563=JSON[_0x406a2a(0x1c6)](_0x26dbd8)+'\x0a',_0x40697c=this[_0x406a2a(0x1aa)](_0x128f3e);fs_1['default']['appendFileSync'](_0x40697c,_0x200563,_0x406a2a(0x1df));}catch(_0x651a31){console[_0x406a2a(0x1cc)]('Failed\x20to\x20write\x20'+_0x128f3e+_0x406a2a(0x1c7),_0x651a31);}}[a47_0x2e79ac(0x1e3)](_0x362b2b,_0x2ebcbe,_0x36746c,_0x5755a8){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0x362b2b,'endpoint':_0x2ebcbe,'method':_0x36746c,'data':_0x5755a8});}[a47_0x2e79ac(0x1b2)](_0x420b13,_0x154779,_0x2f70b0,_0x3c687b,_0x4188af){const _0x53f819=a47_0x2e79ac;this[_0x53f819(0x1e2)](_0x53f819(0x1c9),{'type':_0x53f819(0x1bc),'gateway':_0x420b13,'endpoint':_0x154779,'status':_0x2f70b0,'responseTime':_0x4188af,'data':_0x3c687b});}[a47_0x2e79ac(0x1b3)](_0x32bcca,_0x4029df,_0x3d72a4){const _0x40905c=a47_0x2e79ac;this[_0x40905c(0x1e2)](_0x40905c(0x1ae),{'type':_0x40905c(0x1c2),'gateway':_0x32bcca,'endpoint':_0x4029df,'error':_0x3d72a4 instanceof Error?{'message':_0x3d72a4[_0x40905c(0x1b9)],'stack':_0x3d72a4[_0x40905c(0x1ea)]}:_0x3d72a4});}[a47_0x2e79ac(0x1af)](_0x11db79,_0x577027,_0x3cbb7b){const _0x8e513f=a47_0x2e79ac;this[_0x8e513f(0x1e2)](_0x8e513f(0x1ca),{'type':'WEBHOOK_RECEIVED','gateway':_0x11db79,'headers':_0x3cbb7b,'data':_0x577027});}[a47_0x2e79ac(0x19b)](_0x131669,_0x7a105,_0x14320b,_0xf75f5b,_0x12e6d4){const _0x5c56de=a47_0x2e79ac;this[_0x5c56de(0x1e2)](_0x5c56de(0x1b6),{'type':_0x5c56de(0x1e7),'gateway':_0x131669,'paymentId':_0x7a105,'oldStatus':_0x14320b,'newStatus':_0xf75f5b,'originalData':_0x12e6d4});}[a47_0x2e79ac(0x1b1)](_0x1fe264,_0x59b19c,_0x3d3070){const _0x1de209=a47_0x2e79ac;this[_0x1de209(0x1e2)](_0x1de209(0x1c3),{'type':_0x1de209(0x1cb),'gateway':_0x1fe264,'error':_0x59b19c instanceof Error?{'message':_0x59b19c[_0x1de209(0x1b9)],'stack':_0x59b19c[_0x1de209(0x1ea)]}:_0x59b19c,'originalData':_0x3d3070});}[a47_0x2e79ac(0x1eb)](_0x148bbd){const _0x5f1880=a47_0x2e79ac;this['writeLog'](_0x5f1880(0x1ba),{'type':_0x5f1880(0x1dd),..._0x148bbd});}[a47_0x2e79ac(0x1e5)](_0x13dee1){const _0x441ec1=a47_0x2e79ac;this[_0x441ec1(0x1e2)]('cointopay_errors',{'type':_0x441ec1(0x1b0),..._0x13dee1});}['logShopWebhookSent'](_0x47f24c,_0x2d9815,_0x5111e6,_0x5cb363,_0x4a9a25,_0x3b5f4e){const _0x56d113=a47_0x2e79ac;this[_0x56d113(0x1e2)](_0x56d113(0x1d4),{'type':_0x56d113(0x19f),'shopId':_0x47f24c,'webhookUrl':_0x2d9815,'event':_0x5111e6,'status':_0x5cb363,'responseTime':_0x4a9a25,'payload':_0x3b5f4e});}[a47_0x2e79ac(0x1c8)](_0x456c00,_0x5e82a9,_0x143da7,_0x7daab9,_0x3d7ea4){const _0x47faa2=a47_0x2e79ac;this['writeLog'](_0x47faa2(0x1e1),{'type':_0x47faa2(0x1ec),'shopId':_0x456c00,'webhookUrl':_0x5e82a9,'event':_0x143da7,'error':_0x7daab9 instanceof Error?{'message':_0x7daab9[_0x47faa2(0x1b9)],'stack':_0x7daab9[_0x47faa2(0x1ea)]}:_0x7daab9,'payload':_0x3d7ea4});}['logPaymentCreated'](_0x19e07d,_0x525c70,_0x511522,_0x50b1a9,_0x3bd6dc){const _0x427387=a47_0x2e79ac;this[_0x427387(0x1e2)]('payments_created',{'type':'PAYMENT_CREATED','gateway':_0x19e07d,'paymentId':_0x525c70,'shopId':_0x511522,'amount':_0x50b1a9,'currency':_0x3bd6dc});}[a47_0x2e79ac(0x198)](_0x2f04e7,_0x4f2244,_0x2bbd84,_0x13bbf3,_0x4ebc37){const _0x536dbe=a47_0x2e79ac;this['writeLog'](_0x536dbe(0x1bf),{'type':_0x536dbe(0x1a7),'endpoint':_0x2f04e7,'method':_0x4f2244,'userId':_0x2bbd84,'userRole':_0x13bbf3,'requestData':_0x4ebc37});}[a47_0x2e79ac(0x1a5)](){const _0x5ae9e3=a47_0x2e79ac;try{const _0xf105c4=fs_1[_0x5ae9e3(0x1e4)]['readdirSync'](this[_0x5ae9e3(0x1a0)]),_0x348fe2=_0xf105c4[_0x5ae9e3(0x1e9)](_0x17ae95=>_0x17ae95[_0x5ae9e3(0x1c4)](_0x5ae9e3(0x1ad))),_0x375bf0=[...new Set(_0x348fe2[_0x5ae9e3(0x1a2)](_0x44c807=>_0x44c807[_0x5ae9e3(0x19d)]('_')[0x0]))],_0x1a8240=_0x348fe2['map'](_0x10d38e=>{const _0x33569c=_0x5ae9e3,_0x5e9638=path_1[_0x33569c(0x1e4)][_0x33569c(0x1da)](this['logsDir'],_0x10d38e),_0x3f486c=fs_1[_0x33569c(0x1e4)][_0x33569c(0x1d9)](_0x5e9638),[_0xf97530,_0x10d4b3]=_0x10d38e[_0x33569c(0x19c)](_0x33569c(0x1ad),'')[_0x33569c(0x19d)]('_');return{'type':_0xf97530,'date':_0x10d4b3,'size':_0x3f486c['size']};})[_0x5ae9e3(0x1d6)]((_0x135e2d,_0x5a8ebd)=>_0x5a8ebd[_0x5ae9e3(0x1d1)][_0x5ae9e3(0x1c0)](_0x135e2d[_0x5ae9e3(0x1d1)]));return{'totalFiles':_0x348fe2[_0x5ae9e3(0x1bb)],'logTypes':_0x375bf0,'latestLogs':_0x1a8240[_0x5ae9e3(0x1cf)](0x0,0xa)};}catch(_0x4d63e3){return console[_0x5ae9e3(0x1cc)]('Failed\x20to\x20get\x20log\x20stats:',_0x4d63e3),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a47_0x2e79ac(0x1a9)](_0x4f47da=0x1e){const _0x47b419=a47_0x2e79ac;try{const _0x3f3226=fs_1[_0x47b419(0x1e4)][_0x47b419(0x1de)](this[_0x47b419(0x1a0)]),_0x18ce7b=new Date();_0x18ce7b['setDate'](_0x18ce7b[_0x47b419(0x1d3)]()-_0x4f47da);let _0x220247=0x0;_0x3f3226[_0x47b419(0x1b8)](_0x7e530d=>{const _0x339009=_0x47b419;if(!_0x7e530d[_0x339009(0x1c4)](_0x339009(0x1ad)))return;const _0x5c36c7=path_1[_0x339009(0x1e4)]['join'](this['logsDir'],_0x7e530d),_0x17eb04=fs_1[_0x339009(0x1e4)][_0x339009(0x1d9)](_0x5c36c7);_0x17eb04[_0x339009(0x1a3)]<_0x18ce7b&&(fs_1['default'][_0x339009(0x1be)](_0x5c36c7),_0x220247++,console[_0x339009(0x1cd)](_0x339009(0x1b7)+_0x7e530d));}),console[_0x47b419(0x1cd)](_0x47b419(0x1b4)+_0x220247+_0x47b419(0x1ce)+_0x4f47da+_0x47b419(0x1d2));}catch(_0x3c1cda){console[_0x47b419(0x1cc)](_0x47b419(0x1ab),_0x3c1cda);}}}exports['LoggerService']=LoggerService,exports[a47_0x2e79ac(0x1dc)]=new LoggerService();