'use strict';const a53_0x2e36b1=a53_0x1f6e;(function(_0x40f4d1,_0x5da0ef){const _0x2c3061=a53_0x1f6e,_0x407562=_0x40f4d1();while(!![]){try{const _0x133cc0=-parseInt(_0x2c3061(0xa2))/0x1*(parseInt(_0x2c3061(0xcd))/0x2)+parseInt(_0x2c3061(0xee))/0x3+parseInt(_0x2c3061(0xdf))/0x4+-parseInt(_0x2c3061(0xe2))/0x5+parseInt(_0x2c3061(0xda))/0x6*(parseInt(_0x2c3061(0xe6))/0x7)+-parseInt(_0x2c3061(0xab))/0x8+-parseInt(_0x2c3061(0xed))/0x9;if(_0x133cc0===_0x5da0ef)break;else _0x407562['push'](_0x407562['shift']());}catch(_0x81dbe5){_0x407562['push'](_0x407562['shift']());}}}(a53_0x2d29,0x6248f));var __importDefault=this&&this[a53_0x2e36b1(0xbe)]||function(_0x4e2561){const _0x27c8c9=a53_0x2e36b1;return _0x4e2561&&_0x4e2561[_0x27c8c9(0xa4)]?_0x4e2561:{'default':_0x4e2561};};Object[a53_0x2e36b1(0xbb)](exports,a53_0x2e36b1(0xa4),{'value':!![]}),exports['loggerService']=exports[a53_0x2e36b1(0xd3)]=void 0x0;function a53_0x1f6e(_0x5b85a7,_0x4034a9){const _0x2d292f=a53_0x2d29();return a53_0x1f6e=function(_0x1f6e74,_0x4f07a7){_0x1f6e74=_0x1f6e74-0xa2;let _0xebcd53=_0x2d292f[_0x1f6e74];return _0xebcd53;},a53_0x1f6e(_0x5b85a7,_0x4034a9);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x2e36b1(0xb8)));class LoggerService{constructor(){const _0x588374=a53_0x2e36b1;this[_0x588374(0xeb)]=path_1[_0x588374(0xe5)][_0x588374(0xa3)](process[_0x588374(0xe1)](),_0x588374(0xd5)),this[_0x588374(0xe0)]();}[a53_0x2e36b1(0xe0)](){const _0x5bac1e=a53_0x2e36b1;!fs_1[_0x5bac1e(0xe5)]['existsSync'](this[_0x5bac1e(0xeb)])&&(fs_1['default'][_0x5bac1e(0xf2)](this[_0x5bac1e(0xeb)],{'recursive':!![]}),console[_0x5bac1e(0xc4)](_0x5bac1e(0xc6)+this[_0x5bac1e(0xeb)]));}[a53_0x2e36b1(0xb7)](_0x3d88d5){const _0x45588f=a53_0x2e36b1,_0xe13089=new Date()[_0x45588f(0xc5)]()[_0x45588f(0xc3)]('T')[0x0];return path_1[_0x45588f(0xe5)][_0x45588f(0xa3)](this['logsDir'],_0x3d88d5+'_'+_0xe13089+'.log');}[a53_0x2e36b1(0xbc)](_0x1f8aa3,_0x44c33f){const _0x320d20=a53_0x2e36b1;try{const _0x1a3df5=new Date()[_0x320d20(0xc5)](),_0xcdf3f0={'timestamp':_0x1a3df5,..._0x44c33f},_0x154db3=JSON[_0x320d20(0xdc)](_0xcdf3f0)+'\x0a',_0x18ae2a=this['getLogFileName'](_0x1f8aa3);fs_1['default'][_0x320d20(0xcb)](_0x18ae2a,_0x154db3,_0x320d20(0xb3));}catch(_0x2da15e){console[_0x320d20(0xec)](_0x320d20(0xd6)+_0x1f8aa3+_0x320d20(0xe3),_0x2da15e);}}['logWhiteDomainRequest'](_0x4a54a2,_0x58fa26,_0x4c1b97,_0x2fab8e){const _0x4abfdb=a53_0x2e36b1;this[_0x4abfdb(0xbc)](_0x4abfdb(0xca),{'type':_0x4abfdb(0xd7),'gateway':_0x4a54a2,'endpoint':_0x58fa26,'method':_0x4c1b97,'data':_0x2fab8e});}[a53_0x2e36b1(0xb9)](_0x4a4028,_0x532a96,_0x2c4a4b,_0x552737,_0x223517){const _0x32e207=a53_0x2e36b1;this[_0x32e207(0xbc)](_0x32e207(0xa6),{'type':_0x32e207(0xdb),'gateway':_0x4a4028,'endpoint':_0x532a96,'status':_0x2c4a4b,'responseTime':_0x223517,'data':_0x552737});}[a53_0x2e36b1(0xa7)](_0x14a448,_0xd004a3,_0x36c0ef){const _0x2fb46c=a53_0x2e36b1;this['writeLog'](_0x2fb46c(0xc7),{'type':'ERROR','gateway':_0x14a448,'endpoint':_0xd004a3,'error':_0x36c0ef instanceof Error?{'message':_0x36c0ef[_0x2fb46c(0xa8)],'stack':_0x36c0ef['stack']}:_0x36c0ef});}[a53_0x2e36b1(0xd8)](_0x19b511,_0x3f497f,_0x2752e3){const _0x484ae6=a53_0x2e36b1;this['writeLog'](_0x484ae6(0xb4),{'type':'WEBHOOK_RECEIVED','gateway':_0x19b511,'headers':_0x2752e3,'data':_0x3f497f});}[a53_0x2e36b1(0xbf)](_0x3f3a2b,_0x14d483,_0x5a878e,_0x22d13c,_0x5db467){const _0x4d7195=a53_0x2e36b1;this['writeLog'](_0x4d7195(0xef),{'type':'WEBHOOK_PROCESSED','gateway':_0x3f3a2b,'paymentId':_0x14d483,'oldStatus':_0x5a878e,'newStatus':_0x22d13c,'originalData':_0x5db467});}[a53_0x2e36b1(0xa5)](_0x268c5c,_0x3e4420,_0x51a211){const _0x410741=a53_0x2e36b1;this[_0x410741(0xbc)](_0x410741(0xac),{'type':'WEBHOOK_ERROR','gateway':_0x268c5c,'error':_0x3e4420 instanceof Error?{'message':_0x3e4420[_0x410741(0xa8)],'stack':_0x3e4420[_0x410741(0xc8)]}:_0x3e4420,'originalData':_0x51a211});}[a53_0x2e36b1(0xe7)](_0xa9b852){const _0x3ddecd=a53_0x2e36b1;this[_0x3ddecd(0xbc)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0xa9b852});}[a53_0x2e36b1(0xad)](_0x22c1ce){const _0x264205=a53_0x2e36b1;this[_0x264205(0xbc)]('cointopay_errors',{'type':_0x264205(0xae),..._0x22c1ce});}[a53_0x2e36b1(0xdd)](_0xff84dd,_0x5a4ff9,_0x1b091e,_0x5c7948,_0x2bf990,_0xab2fa8){const _0x16fef6=a53_0x2e36b1;this['writeLog'](_0x16fef6(0xce),{'type':_0x16fef6(0xb0),'shopId':_0xff84dd,'webhookUrl':_0x5a4ff9,'event':_0x1b091e,'status':_0x5c7948,'responseTime':_0x2bf990,'payload':_0xab2fa8});}[a53_0x2e36b1(0xea)](_0xe42174,_0x61d554,_0x34905c,_0xc3b4cc,_0x36d090){const _0x3e8b31=a53_0x2e36b1;this[_0x3e8b31(0xbc)](_0x3e8b31(0xe4),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0xe42174,'webhookUrl':_0x61d554,'event':_0x34905c,'error':_0xc3b4cc instanceof Error?{'message':_0xc3b4cc['message'],'stack':_0xc3b4cc[_0x3e8b31(0xc8)]}:_0xc3b4cc,'payload':_0x36d090});}[a53_0x2e36b1(0xb6)](_0x3dba9b,_0x228fa0,_0x40db1e,_0x39f5d2,_0x52ebae){const _0x5e91c8=a53_0x2e36b1;this['writeLog'](_0x5e91c8(0xb5),{'type':_0x5e91c8(0xc1),'gateway':_0x3dba9b,'paymentId':_0x228fa0,'shopId':_0x40db1e,'amount':_0x39f5d2,'currency':_0x52ebae});}[a53_0x2e36b1(0xde)](_0x7205e5,_0x2480a4,_0x3ab7d1,_0x3612cc,_0xe7d60a){const _0x26bffb=a53_0x2e36b1;this[_0x26bffb(0xbc)]('api_calls',{'type':_0x26bffb(0xf1),'endpoint':_0x7205e5,'method':_0x2480a4,'userId':_0x3ab7d1,'userRole':_0x3612cc,'requestData':_0xe7d60a});}[a53_0x2e36b1(0xcf)](){const _0x9465d7=a53_0x2e36b1;try{const _0x37a916=fs_1[_0x9465d7(0xe5)][_0x9465d7(0xd9)](this['logsDir']),_0x484da0=_0x37a916[_0x9465d7(0xcc)](_0x3900a8=>_0x3900a8[_0x9465d7(0xd1)]('.log')),_0x465772=[...new Set(_0x484da0[_0x9465d7(0xe8)](_0x16a2ac=>_0x16a2ac[_0x9465d7(0xc3)]('_')[0x0]))],_0x4aefd9=_0x484da0[_0x9465d7(0xe8)](_0x420fb2=>{const _0x56ab77=_0x9465d7,_0x5e3070=path_1[_0x56ab77(0xe5)]['join'](this[_0x56ab77(0xeb)],_0x420fb2),_0x90659b=fs_1[_0x56ab77(0xe5)]['statSync'](_0x5e3070),[_0xf52a79,_0xfabe47]=_0x420fb2[_0x56ab77(0xb1)](_0x56ab77(0xb2),'')[_0x56ab77(0xc3)]('_');return{'type':_0xf52a79,'date':_0xfabe47,'size':_0x90659b['size']};})[_0x9465d7(0xd0)]((_0x294087,_0x58bc41)=>_0x58bc41[_0x9465d7(0xd4)]['localeCompare'](_0x294087['date']));return{'totalFiles':_0x484da0[_0x9465d7(0xf0)],'logTypes':_0x465772,'latestLogs':_0x4aefd9['slice'](0x0,0xa)};}catch(_0x1b5615){return console[_0x9465d7(0xec)](_0x9465d7(0xc0),_0x1b5615),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x2e36b1(0xba)](_0x2a1e14=0x1e){const _0x1d06ba=a53_0x2e36b1;try{const _0x1db86d=fs_1[_0x1d06ba(0xe5)][_0x1d06ba(0xd9)](this[_0x1d06ba(0xeb)]),_0x45dcc7=new Date();_0x45dcc7['setDate'](_0x45dcc7[_0x1d06ba(0xd2)]()-_0x2a1e14);let _0xf9c769=0x0;_0x1db86d[_0x1d06ba(0xc9)](_0x813535=>{const _0x46f50b=_0x1d06ba;if(!_0x813535[_0x46f50b(0xd1)](_0x46f50b(0xb2)))return;const _0x44790a=path_1[_0x46f50b(0xe5)][_0x46f50b(0xa3)](this[_0x46f50b(0xeb)],_0x813535),_0x587510=fs_1['default'][_0x46f50b(0xaa)](_0x44790a);_0x587510[_0x46f50b(0xe9)]<_0x45dcc7&&(fs_1[_0x46f50b(0xe5)][_0x46f50b(0xa9)](_0x44790a),_0xf9c769++,console['log'](_0x46f50b(0xc2)+_0x813535));}),console['log'](_0x1d06ba(0xaf)+_0xf9c769+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x2a1e14+'\x20days)');}catch(_0x5f0ccb){console[_0x1d06ba(0xec)](_0x1d06ba(0xbd),_0x5f0ccb);}}}exports[a53_0x2e36b1(0xd3)]=LoggerService,exports['loggerService']=new LoggerService();function a53_0x2d29(){const _0x2bbaf5=['logWebhookReceived','readdirSync','2971086pXxVWi','RESPONSE','stringify','logShopWebhookSent','logApiCall','1954076wiiQvg','ensureLogsDirectory','cwd','2994520bybrxD','\x20log:','shop_webhooks_errors','default','7boCOQJ','logCoinToPayStatus','map','mtime','logShopWebhookError','logsDir','error','1525761KvtzkB','1983339DXjsRZ','webhooks_processed','length','API_CALL','mkdirSync','41487WBqJsb','join','__esModule','logWebhookError','white_domain_responses','logWhiteDomainError','message','unlinkSync','statSync','2794752kCdeiw','webhooks_errors','logCoinToPayError','COINTOPAY_ERROR','🧹\x20Cleaned\x20','SHOP_WEBHOOK_SENT','replace','.log','utf8','webhooks_received','payments_created','logPaymentCreated','getLogFileName','path','logWhiteDomainResponse','cleanOldLogs','defineProperty','writeLog','Failed\x20to\x20clean\x20old\x20logs:','__importDefault','logWebhookProcessed','Failed\x20to\x20get\x20log\x20stats:','PAYMENT_CREATED','🗑️\x20Deleted\x20old\x20log\x20file:\x20','split','log','toISOString','📁\x20Created\x20logs\x20directory:\x20','white_domain_errors','stack','forEach','white_domain_requests','appendFileSync','filter','6pWADTu','shop_webhooks_sent','getLogStats','sort','endsWith','getDate','LoggerService','date','logs','Failed\x20to\x20write\x20','REQUEST'];a53_0x2d29=function(){return _0x2bbaf5;};return a53_0x2d29();}