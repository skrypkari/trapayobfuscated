'use strict';const a67_0x155df7=a67_0x4e6d;(function(_0x1f424d,_0x2d4ca9){const _0x3c1d22=a67_0x4e6d,_0x5ca939=_0x1f424d();while(!![]){try{const _0x493604=parseInt(_0x3c1d22(0x1cb))/0x1*(-parseInt(_0x3c1d22(0x1bb))/0x2)+parseInt(_0x3c1d22(0x1d0))/0x3*(-parseInt(_0x3c1d22(0x1a9))/0x4)+-parseInt(_0x3c1d22(0x19e))/0x5+parseInt(_0x3c1d22(0x19c))/0x6*(-parseInt(_0x3c1d22(0x1b1))/0x7)+parseInt(_0x3c1d22(0x19f))/0x8+-parseInt(_0x3c1d22(0x1dc))/0x9+-parseInt(_0x3c1d22(0x1b8))/0xa*(-parseInt(_0x3c1d22(0x1ba))/0xb);if(_0x493604===_0x2d4ca9)break;else _0x5ca939['push'](_0x5ca939['shift']());}catch(_0x951cdc){_0x5ca939['push'](_0x5ca939['shift']());}}}(a67_0x4361,0x7eb83));function a67_0x4361(){const _0x2c126b=['length','ðŸ“\x20Created\x20logs\x20directory:\x20','webhooks_errors','47NDcsZr','cointopay_status_changes','setDate','mkdirSync','log','21Dchesg','white_domain_requests','writeLog','map','cwd','webhooks_received','.log','webhooks_processed','cointopay_errors','white_domain_responses','\x20days)','payments_created','882945tFBlRX','toISOString','filter','WEBHOOK_ERROR','ensureLogsDirectory','REQUEST','white_domain_errors','join','API_CALL','PAYMENT_CREATED','logShopWebhookError','logs','15924dqkIqT','stringify','475390IJImOd','6489960MBKjtv','LoggerService','__esModule','split','cleanOldLogs','endsWith','logCoinToPayStatus','readdirSync','Failed\x20to\x20get\x20log\x20stats:','default','323256hQRsKP','api_calls','stack','logWhiteDomainResponse','replace','\x20log:','getLogFileName','mtime','1155Etruvw','shop_webhooks_errors','error','existsSync','date','message','Failed\x20to\x20clean\x20old\x20logs:','56660OtiBiW','slice','3531XKpRXb','38902lvROAl','WEBHOOK_PROCESSED','RESPONSE','shop_webhooks_sent','\x20old\x20log\x20files\x20(older\x20than\x20','logShopWebhookSent','ðŸ§¹\x20Cleaned\x20','loggerService','logCoinToPayError','logsDir','statSync','size','forEach'];a67_0x4361=function(){return _0x2c126b;};return a67_0x4361();}var __importDefault=this&&this['__importDefault']||function(_0x59f201){const _0x3a8c0a=a67_0x4e6d;return _0x59f201&&_0x59f201[_0x3a8c0a(0x1a1)]?_0x59f201:{'default':_0x59f201};};function a67_0x4e6d(_0x480da4,_0xaac61e){_0x480da4=_0x480da4-0x193;const _0x43618e=a67_0x4361();let _0x4e6d99=_0x43618e[_0x480da4];return _0x4e6d99;}Object['defineProperty'](exports,a67_0x155df7(0x1a1),{'value':!![]}),exports[a67_0x155df7(0x1c2)]=exports[a67_0x155df7(0x1a0)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x2bbf89=a67_0x155df7;this[_0x2bbf89(0x1c4)]=path_1[_0x2bbf89(0x1a8)][_0x2bbf89(0x197)](process[_0x2bbf89(0x1d4)](),_0x2bbf89(0x19b)),this[_0x2bbf89(0x194)]();}[a67_0x155df7(0x194)](){const _0x140484=a67_0x155df7;!fs_1[_0x140484(0x1a8)][_0x140484(0x1b4)](this[_0x140484(0x1c4)])&&(fs_1[_0x140484(0x1a8)][_0x140484(0x1ce)](this[_0x140484(0x1c4)],{'recursive':!![]}),console[_0x140484(0x1cf)](_0x140484(0x1c9)+this[_0x140484(0x1c4)]));}['getLogFileName'](_0x12cb36){const _0x3a7b7b=a67_0x155df7,_0x5d6da7=new Date()[_0x3a7b7b(0x1dd)]()[_0x3a7b7b(0x1a2)]('T')[0x0];return path_1[_0x3a7b7b(0x1a8)][_0x3a7b7b(0x197)](this[_0x3a7b7b(0x1c4)],_0x12cb36+'_'+_0x5d6da7+'.log');}[a67_0x155df7(0x1d2)](_0x78e1ea,_0x31ec51){const _0x31fb75=a67_0x155df7;try{const _0x21a937=new Date()['toISOString'](),_0x234b12={'timestamp':_0x21a937,..._0x31ec51},_0x1210cc=JSON[_0x31fb75(0x19d)](_0x234b12)+'\x0a',_0x5873ac=this[_0x31fb75(0x1af)](_0x78e1ea);fs_1[_0x31fb75(0x1a8)]['appendFileSync'](_0x5873ac,_0x1210cc,'utf8');}catch(_0x254040){console[_0x31fb75(0x1b3)]('Failed\x20to\x20write\x20'+_0x78e1ea+_0x31fb75(0x1ae),_0x254040);}}['logWhiteDomainRequest'](_0x393785,_0x413237,_0x41cf59,_0x26d681){const _0x1dc579=a67_0x155df7;this[_0x1dc579(0x1d2)](_0x1dc579(0x1d1),{'type':_0x1dc579(0x195),'gateway':_0x393785,'endpoint':_0x413237,'method':_0x41cf59,'data':_0x26d681});}[a67_0x155df7(0x1ac)](_0x4da4a0,_0x8d3fd6,_0x2b753b,_0x528836,_0x44e6aa){const _0xa96c0f=a67_0x155df7;this[_0xa96c0f(0x1d2)](_0xa96c0f(0x1d9),{'type':_0xa96c0f(0x1bd),'gateway':_0x4da4a0,'endpoint':_0x8d3fd6,'status':_0x2b753b,'responseTime':_0x44e6aa,'data':_0x528836});}['logWhiteDomainError'](_0x4d9365,_0x1c241d,_0x123005){const _0xf5badf=a67_0x155df7;this[_0xf5badf(0x1d2)](_0xf5badf(0x196),{'type':'ERROR','gateway':_0x4d9365,'endpoint':_0x1c241d,'error':_0x123005 instanceof Error?{'message':_0x123005[_0xf5badf(0x1b6)],'stack':_0x123005[_0xf5badf(0x1ab)]}:_0x123005});}['logWebhookReceived'](_0x5b1db0,_0x1b792c,_0x13ab27){const _0x518108=a67_0x155df7;this['writeLog'](_0x518108(0x1d5),{'type':'WEBHOOK_RECEIVED','gateway':_0x5b1db0,'headers':_0x13ab27,'data':_0x1b792c});}['logWebhookProcessed'](_0x1eae8d,_0x1dc583,_0x755d35,_0x3c329f,_0x49e4b7){const _0xbd3756=a67_0x155df7;this[_0xbd3756(0x1d2)](_0xbd3756(0x1d7),{'type':_0xbd3756(0x1bc),'gateway':_0x1eae8d,'paymentId':_0x1dc583,'oldStatus':_0x755d35,'newStatus':_0x3c329f,'originalData':_0x49e4b7});}['logWebhookError'](_0xf11600,_0x156fea,_0xb9514b){const _0x2bc959=a67_0x155df7;this[_0x2bc959(0x1d2)](_0x2bc959(0x1ca),{'type':_0x2bc959(0x193),'gateway':_0xf11600,'error':_0x156fea instanceof Error?{'message':_0x156fea['message'],'stack':_0x156fea[_0x2bc959(0x1ab)]}:_0x156fea,'originalData':_0xb9514b});}[a67_0x155df7(0x1a5)](_0x134d41){const _0x562eb5=a67_0x155df7;this['writeLog'](_0x562eb5(0x1cc),{'type':'COINTOPAY_STATUS_CHANGE',..._0x134d41});}[a67_0x155df7(0x1c3)](_0x54b4f3){const _0xb6f4ac=a67_0x155df7;this[_0xb6f4ac(0x1d2)](_0xb6f4ac(0x1d8),{'type':'COINTOPAY_ERROR',..._0x54b4f3});}[a67_0x155df7(0x1c0)](_0x540977,_0x1dcd36,_0x231a0c,_0x269344,_0x200b50,_0x401bcd){const _0x2bfe7b=a67_0x155df7;this[_0x2bfe7b(0x1d2)](_0x2bfe7b(0x1be),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x540977,'webhookUrl':_0x1dcd36,'event':_0x231a0c,'status':_0x269344,'responseTime':_0x200b50,'payload':_0x401bcd});}[a67_0x155df7(0x19a)](_0x4ff055,_0x43b9b0,_0x15ade7,_0x3d8050,_0x46c2c2){const _0x3207c5=a67_0x155df7;this['writeLog'](_0x3207c5(0x1b2),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x4ff055,'webhookUrl':_0x43b9b0,'event':_0x15ade7,'error':_0x3d8050 instanceof Error?{'message':_0x3d8050['message'],'stack':_0x3d8050[_0x3207c5(0x1ab)]}:_0x3d8050,'payload':_0x46c2c2});}['logPaymentCreated'](_0x1ea7f0,_0x436766,_0x1d9e56,_0xa74055,_0x2bc191){const _0x3005d6=a67_0x155df7;this[_0x3005d6(0x1d2)](_0x3005d6(0x1db),{'type':_0x3005d6(0x199),'gateway':_0x1ea7f0,'paymentId':_0x436766,'shopId':_0x1d9e56,'amount':_0xa74055,'currency':_0x2bc191});}['logApiCall'](_0x38b078,_0x578c09,_0xf549a2,_0x2d2da7,_0x5af75d){const _0x3628e6=a67_0x155df7;this[_0x3628e6(0x1d2)](_0x3628e6(0x1aa),{'type':_0x3628e6(0x198),'endpoint':_0x38b078,'method':_0x578c09,'userId':_0xf549a2,'userRole':_0x2d2da7,'requestData':_0x5af75d});}['getLogStats'](){const _0x325c97=a67_0x155df7;try{const _0x4dd1d2=fs_1[_0x325c97(0x1a8)][_0x325c97(0x1a6)](this[_0x325c97(0x1c4)]),_0x2b254e=_0x4dd1d2[_0x325c97(0x1de)](_0x121a10=>_0x121a10[_0x325c97(0x1a4)]('.log')),_0x18a184=[...new Set(_0x2b254e[_0x325c97(0x1d3)](_0x22a3f8=>_0x22a3f8['split']('_')[0x0]))],_0x201fcb=_0x2b254e[_0x325c97(0x1d3)](_0x363d89=>{const _0x439788=_0x325c97,_0x4d6903=path_1[_0x439788(0x1a8)][_0x439788(0x197)](this[_0x439788(0x1c4)],_0x363d89),_0x3143df=fs_1[_0x439788(0x1a8)][_0x439788(0x1c5)](_0x4d6903),[_0x57d97a,_0x3ca39f]=_0x363d89[_0x439788(0x1ad)]('.log','')[_0x439788(0x1a2)]('_');return{'type':_0x57d97a,'date':_0x3ca39f,'size':_0x3143df[_0x439788(0x1c6)]};})['sort']((_0x3a3400,_0x541d67)=>_0x541d67[_0x325c97(0x1b5)]['localeCompare'](_0x3a3400['date']));return{'totalFiles':_0x2b254e[_0x325c97(0x1c8)],'logTypes':_0x18a184,'latestLogs':_0x201fcb[_0x325c97(0x1b9)](0x0,0xa)};}catch(_0x5231cb){return console[_0x325c97(0x1b3)](_0x325c97(0x1a7),_0x5231cb),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a67_0x155df7(0x1a3)](_0x1b73c4=0x1e){const _0x4554e8=a67_0x155df7;try{const _0x2b9e29=fs_1[_0x4554e8(0x1a8)][_0x4554e8(0x1a6)](this['logsDir']),_0x423e71=new Date();_0x423e71[_0x4554e8(0x1cd)](_0x423e71['getDate']()-_0x1b73c4);let _0x39f820=0x0;_0x2b9e29[_0x4554e8(0x1c7)](_0x36cfcc=>{const _0xf7ecf7=_0x4554e8;if(!_0x36cfcc[_0xf7ecf7(0x1a4)](_0xf7ecf7(0x1d6)))return;const _0xf439fb=path_1['default'][_0xf7ecf7(0x197)](this[_0xf7ecf7(0x1c4)],_0x36cfcc),_0x4e0cdb=fs_1[_0xf7ecf7(0x1a8)][_0xf7ecf7(0x1c5)](_0xf439fb);_0x4e0cdb[_0xf7ecf7(0x1b0)]<_0x423e71&&(fs_1[_0xf7ecf7(0x1a8)]['unlinkSync'](_0xf439fb),_0x39f820++,console[_0xf7ecf7(0x1cf)]('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x36cfcc));}),console[_0x4554e8(0x1cf)](_0x4554e8(0x1c1)+_0x39f820+_0x4554e8(0x1bf)+_0x1b73c4+_0x4554e8(0x1da));}catch(_0xd756b1){console[_0x4554e8(0x1b3)](_0x4554e8(0x1b7),_0xd756b1);}}}exports['LoggerService']=LoggerService,exports[a67_0x155df7(0x1c2)]=new LoggerService();