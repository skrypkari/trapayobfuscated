'use strict';const a48_0x4161b4=a48_0x1137;(function(_0x5e4932,_0x158eff){const _0x456865=a48_0x1137,_0x1c4278=_0x5e4932();while(!![]){try{const _0x33a5cc=-parseInt(_0x456865(0x134))/0x1*(parseInt(_0x456865(0x106))/0x2)+parseInt(_0x456865(0x14f))/0x3*(-parseInt(_0x456865(0x124))/0x4)+parseInt(_0x456865(0x110))/0x5*(parseInt(_0x456865(0x143))/0x6)+parseInt(_0x456865(0x141))/0x7*(-parseInt(_0x456865(0x112))/0x8)+-parseInt(_0x456865(0x13f))/0x9*(parseInt(_0x456865(0x147))/0xa)+parseInt(_0x456865(0x14e))/0xb*(-parseInt(_0x456865(0x13b))/0xc)+-parseInt(_0x456865(0x145))/0xd*(-parseInt(_0x456865(0x123))/0xe);if(_0x33a5cc===_0x158eff)break;else _0x1c4278['push'](_0x1c4278['shift']());}catch(_0x5b75a7){_0x1c4278['push'](_0x1c4278['shift']());}}}(a48_0x4f63,0x54c6f));function a48_0x4f63(){const _0x11e01c=['readdirSync','forEach','Failed\x20to\x20clean\x20old\x20logs:','26384PkYZJV','mtime','stringify','\x20old\x20log\x20files\x20(older\x20than\x20','writeLog','log','WEBHOOK_PROCESSED','12BDJHSx','webhooks_errors','date','logsDir','583587LUVlQI','loggerService','51653YsAfZz','filter','6EGVztG','Failed\x20to\x20write\x20','223457dTyTTu','logWhiteDomainResponse','60PgjJeT','logWebhookProcessed','📁\x20Created\x20logs\x20directory:\x20','logWhiteDomainError','LoggerService','default','\x20log:','5095519VDfFRL','2988trVRQi','getLogStats','logCoinToPayError','length','34vQWDta','logCoinToPayStatus','error','join','sort','SHOP_WEBHOOK_ERROR','toISOString','logWebhookReceived','stack','SHOP_WEBHOOK_SENT','1488685HGGTfr','API_CALL','272qemXcr','slice','map','__esModule','shop_webhooks_errors','endsWith','existsSync','split','logs','🧹\x20Cleaned\x20','white_domain_errors','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logWebhookError','ensureLogsDirectory','getLogFileName','logShopWebhookSent','Failed\x20to\x20get\x20log\x20stats:','1554rIZoLZ','1232OyBkQN','size','mkdirSync','getDate','webhooks_processed','appendFileSync','COINTOPAY_ERROR','.log','RESPONSE','REQUEST','setDate','PAYMENT_CREATED','message'];a48_0x4f63=function(){return _0x11e01c;};return a48_0x4f63();}var __importDefault=this&&this['__importDefault']||function(_0x20bd45){const _0x54d564=a48_0x1137;return _0x20bd45&&_0x20bd45[_0x54d564(0x115)]?_0x20bd45:{'default':_0x20bd45};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a48_0x4161b4(0x140)]=exports[a48_0x4161b4(0x14b)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x28e1cf=a48_0x4161b4;this['logsDir']=path_1[_0x28e1cf(0x14c)]['join'](process['cwd'](),_0x28e1cf(0x11a)),this[_0x28e1cf(0x11f)]();}[a48_0x4161b4(0x11f)](){const _0x3d0712=a48_0x4161b4;!fs_1[_0x3d0712(0x14c)][_0x3d0712(0x118)](this[_0x3d0712(0x13e)])&&(fs_1[_0x3d0712(0x14c)][_0x3d0712(0x126)](this[_0x3d0712(0x13e)],{'recursive':!![]}),console['log'](_0x3d0712(0x149)+this[_0x3d0712(0x13e)]));}['getLogFileName'](_0x11cce2){const _0x4159fb=a48_0x4161b4,_0x4fe79a=new Date()[_0x4159fb(0x10c)]()['split']('T')[0x0];return path_1['default']['join'](this[_0x4159fb(0x13e)],_0x11cce2+'_'+_0x4fe79a+_0x4159fb(0x12b));}[a48_0x4161b4(0x138)](_0x4edfc8,_0x343a04){const _0x1a0229=a48_0x4161b4;try{const _0x4958a5=new Date()['toISOString'](),_0x5ce3b7={'timestamp':_0x4958a5,..._0x343a04},_0x2f9866=JSON[_0x1a0229(0x136)](_0x5ce3b7)+'\x0a',_0x2a781d=this[_0x1a0229(0x120)](_0x4edfc8);fs_1['default'][_0x1a0229(0x129)](_0x2a781d,_0x2f9866,'utf8');}catch(_0x251433){console[_0x1a0229(0x108)](_0x1a0229(0x144)+_0x4edfc8+_0x1a0229(0x14d),_0x251433);}}['logWhiteDomainRequest'](_0x2395a4,_0x13a487,_0x4886e6,_0x33e9c8){const _0x1abf15=a48_0x4161b4;this[_0x1abf15(0x138)]('white_domain_requests',{'type':_0x1abf15(0x12d),'gateway':_0x2395a4,'endpoint':_0x13a487,'method':_0x4886e6,'data':_0x33e9c8});}[a48_0x4161b4(0x146)](_0xb5a7d4,_0x929c12,_0x65c833,_0x3bd2ad,_0x4f85f0){const _0x4d00c2=a48_0x4161b4;this[_0x4d00c2(0x138)]('white_domain_responses',{'type':_0x4d00c2(0x12c),'gateway':_0xb5a7d4,'endpoint':_0x929c12,'status':_0x65c833,'responseTime':_0x4f85f0,'data':_0x3bd2ad});}[a48_0x4161b4(0x14a)](_0x5df8ce,_0x3f4e76,_0x9da1df){const _0x56ab75=a48_0x4161b4;this['writeLog'](_0x56ab75(0x11c),{'type':'ERROR','gateway':_0x5df8ce,'endpoint':_0x3f4e76,'error':_0x9da1df instanceof Error?{'message':_0x9da1df[_0x56ab75(0x130)],'stack':_0x9da1df[_0x56ab75(0x10e)]}:_0x9da1df});}[a48_0x4161b4(0x10d)](_0x283619,_0x44e84f,_0x4cb81f){const _0x356d9=a48_0x4161b4;this[_0x356d9(0x138)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x283619,'headers':_0x4cb81f,'data':_0x44e84f});}[a48_0x4161b4(0x148)](_0x52a7c7,_0x9d78c6,_0x1a3d5f,_0x1484a2,_0x27f0b0){const _0x58b6c4=a48_0x4161b4;this[_0x58b6c4(0x138)](_0x58b6c4(0x128),{'type':_0x58b6c4(0x13a),'gateway':_0x52a7c7,'paymentId':_0x9d78c6,'oldStatus':_0x1a3d5f,'newStatus':_0x1484a2,'originalData':_0x27f0b0});}[a48_0x4161b4(0x11e)](_0x1be255,_0x270e10,_0x1678af){const _0x17ad6d=a48_0x4161b4;this[_0x17ad6d(0x138)](_0x17ad6d(0x13c),{'type':'WEBHOOK_ERROR','gateway':_0x1be255,'error':_0x270e10 instanceof Error?{'message':_0x270e10['message'],'stack':_0x270e10['stack']}:_0x270e10,'originalData':_0x1678af});}[a48_0x4161b4(0x107)](_0x3d9dd1){this['writeLog']('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x3d9dd1});}[a48_0x4161b4(0x151)](_0x357d23){const _0x3138e5=a48_0x4161b4;this['writeLog']('cointopay_errors',{'type':_0x3138e5(0x12a),..._0x357d23});}[a48_0x4161b4(0x121)](_0x3f632d,_0x47974c,_0x12182b,_0x348d99,_0x449717,_0x560971){const _0x4b2c91=a48_0x4161b4;this[_0x4b2c91(0x138)]('shop_webhooks_sent',{'type':_0x4b2c91(0x10f),'shopId':_0x3f632d,'webhookUrl':_0x47974c,'event':_0x12182b,'status':_0x348d99,'responseTime':_0x449717,'payload':_0x560971});}['logShopWebhookError'](_0x20cc9d,_0xa13888,_0xa2398,_0x1e9e8e,_0x422e48){const _0x2429ce=a48_0x4161b4;this[_0x2429ce(0x138)](_0x2429ce(0x116),{'type':_0x2429ce(0x10b),'shopId':_0x20cc9d,'webhookUrl':_0xa13888,'event':_0xa2398,'error':_0x1e9e8e instanceof Error?{'message':_0x1e9e8e['message'],'stack':_0x1e9e8e[_0x2429ce(0x10e)]}:_0x1e9e8e,'payload':_0x422e48});}['logPaymentCreated'](_0x2f28a3,_0x176ce4,_0x2a616c,_0x54ffe2,_0x55697a){const _0x4a305d=a48_0x4161b4;this[_0x4a305d(0x138)]('payments_created',{'type':_0x4a305d(0x12f),'gateway':_0x2f28a3,'paymentId':_0x176ce4,'shopId':_0x2a616c,'amount':_0x54ffe2,'currency':_0x55697a});}['logApiCall'](_0x56fda4,_0x3e6284,_0x184c03,_0x2b524d,_0x52e7b0){const _0x584a3a=a48_0x4161b4;this[_0x584a3a(0x138)]('api_calls',{'type':_0x584a3a(0x111),'endpoint':_0x56fda4,'method':_0x3e6284,'userId':_0x184c03,'userRole':_0x2b524d,'requestData':_0x52e7b0});}[a48_0x4161b4(0x150)](){const _0x285fe1=a48_0x4161b4;try{const _0x120e85=fs_1[_0x285fe1(0x14c)][_0x285fe1(0x131)](this['logsDir']),_0x4ebfc0=_0x120e85[_0x285fe1(0x142)](_0x110208=>_0x110208[_0x285fe1(0x117)]('.log')),_0x173b2c=[...new Set(_0x4ebfc0[_0x285fe1(0x114)](_0x3e8e09=>_0x3e8e09['split']('_')[0x0]))],_0x218f71=_0x4ebfc0[_0x285fe1(0x114)](_0x1d076e=>{const _0xc3c0ed=_0x285fe1,_0x1cac0a=path_1['default'][_0xc3c0ed(0x109)](this[_0xc3c0ed(0x13e)],_0x1d076e),_0x4f2390=fs_1[_0xc3c0ed(0x14c)]['statSync'](_0x1cac0a),[_0x125592,_0x345b08]=_0x1d076e['replace'](_0xc3c0ed(0x12b),'')[_0xc3c0ed(0x119)]('_');return{'type':_0x125592,'date':_0x345b08,'size':_0x4f2390[_0xc3c0ed(0x125)]};})[_0x285fe1(0x10a)]((_0x52920b,_0x416930)=>_0x416930[_0x285fe1(0x13d)]['localeCompare'](_0x52920b[_0x285fe1(0x13d)]));return{'totalFiles':_0x4ebfc0[_0x285fe1(0x152)],'logTypes':_0x173b2c,'latestLogs':_0x218f71[_0x285fe1(0x113)](0x0,0xa)};}catch(_0x49aff0){return console[_0x285fe1(0x108)](_0x285fe1(0x122),_0x49aff0),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x1fde87=0x1e){const _0x58086d=a48_0x4161b4;try{const _0x512c5d=fs_1[_0x58086d(0x14c)][_0x58086d(0x131)](this[_0x58086d(0x13e)]),_0x3de7fb=new Date();_0x3de7fb[_0x58086d(0x12e)](_0x3de7fb[_0x58086d(0x127)]()-_0x1fde87);let _0x251a5d=0x0;_0x512c5d[_0x58086d(0x132)](_0x39e7c4=>{const _0x3ecf7d=_0x58086d;if(!_0x39e7c4['endsWith'](_0x3ecf7d(0x12b)))return;const _0x1d2c2c=path_1['default']['join'](this[_0x3ecf7d(0x13e)],_0x39e7c4),_0x1c7cbc=fs_1['default']['statSync'](_0x1d2c2c);_0x1c7cbc[_0x3ecf7d(0x135)]<_0x3de7fb&&(fs_1[_0x3ecf7d(0x14c)]['unlinkSync'](_0x1d2c2c),_0x251a5d++,console[_0x3ecf7d(0x139)](_0x3ecf7d(0x11d)+_0x39e7c4));}),console['log'](_0x58086d(0x11b)+_0x251a5d+_0x58086d(0x137)+_0x1fde87+'\x20days)');}catch(_0x5416d5){console[_0x58086d(0x108)](_0x58086d(0x133),_0x5416d5);}}}function a48_0x1137(_0x29a1db,_0xae379f){const _0x4f6356=a48_0x4f63();return a48_0x1137=function(_0x113760,_0x4fbe0b){_0x113760=_0x113760-0x106;let _0x26a4fe=_0x4f6356[_0x113760];return _0x26a4fe;},a48_0x1137(_0x29a1db,_0xae379f);}exports[a48_0x4161b4(0x14b)]=LoggerService,exports[a48_0x4161b4(0x140)]=new LoggerService();