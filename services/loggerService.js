'use strict';const a53_0x1502c5=a53_0x84e5;function a53_0x84e5(_0x4e864e,_0x5347a8){const _0x36834f=a53_0x3683();return a53_0x84e5=function(_0x84e5da,_0x32256b){_0x84e5da=_0x84e5da-0x179;let _0x433fcf=_0x36834f[_0x84e5da];return _0x433fcf;},a53_0x84e5(_0x4e864e,_0x5347a8);}(function(_0x2a4d3b,_0x4b14fa){const _0x25805c=a53_0x84e5,_0x2b59b4=_0x2a4d3b();while(!![]){try{const _0x330e60=parseInt(_0x25805c(0x1b6))/0x1+parseInt(_0x25805c(0x18b))/0x2+-parseInt(_0x25805c(0x1c5))/0x3*(-parseInt(_0x25805c(0x180))/0x4)+parseInt(_0x25805c(0x17d))/0x5+-parseInt(_0x25805c(0x1aa))/0x6+parseInt(_0x25805c(0x17b))/0x7*(parseInt(_0x25805c(0x1a9))/0x8)+parseInt(_0x25805c(0x1a8))/0x9*(-parseInt(_0x25805c(0x1af))/0xa);if(_0x330e60===_0x4b14fa)break;else _0x2b59b4['push'](_0x2b59b4['shift']());}catch(_0x2910d8){_0x2b59b4['push'](_0x2b59b4['shift']());}}}(a53_0x3683,0x75543));var __importDefault=this&&this[a53_0x1502c5(0x198)]||function(_0x44eafb){const _0x100273=a53_0x1502c5;return _0x44eafb&&_0x44eafb[_0x100273(0x19e)]?_0x44eafb:{'default':_0x44eafb};};function a53_0x3683(){const _0x10414e=['SHOP_WEBHOOK_ERROR','size','logWhiteDomainResponse','ensureLogsDirectory','shop_webhooks_sent','path','REQUEST','webhooks_received','104760cgZFWl','16ZXNDty','1741338SYcmhA','white_domain_requests','logsDir','endsWith','logCoinToPayError','1390ENMChY','WEBHOOK_PROCESSED','appendFileSync','ERROR','readdirSync','statSync','localeCompare','519794vclvfK','webhooks_processed','split','logApiCall','log','logPaymentCreated','logWebhookReceived','toISOString','cleanOldLogs','existsSync','logCoinToPayStatus','mtime','cointopay_errors','stringify','COINTOPAY_ERROR','3ratGqa','message','🧹\x20Cleaned\x20','logWhiteDomainRequest','join','.log','\x20old\x20log\x20files\x20(older\x20than\x20','logShopWebhookError','getLogFileName','3237451MnqLhn','writeLog','41750JhXZGq','COINTOPAY_STATUS_CHANGE','logWebhookProcessed','2224116hkGPaO','api_calls','error','getLogStats','WEBHOOK_RECEIVED','shop_webhooks_errors','default','sort','filter','date','PAYMENT_CREATED','759206OYznFK','loggerService','Failed\x20to\x20clean\x20old\x20logs:','🗑️\x20Deleted\x20old\x20log\x20file:\x20','map','payments_created','length','slice','logs','white_domain_errors','Failed\x20to\x20write\x20','webhooks_errors','\x20days)','__importDefault','unlinkSync','stack','utf8','WEBHOOK_ERROR','cointopay_status_changes','__esModule','forEach'];a53_0x3683=function(){return _0x10414e;};return a53_0x3683();}Object['defineProperty'](exports,a53_0x1502c5(0x19e),{'value':!![]}),exports[a53_0x1502c5(0x18c)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x1502c5(0x1a5)));class LoggerService{constructor(){const _0x127473=a53_0x1502c5;this[_0x127473(0x1ac)]=path_1[_0x127473(0x186)][_0x127473(0x1c9)](process['cwd'](),_0x127473(0x193)),this[_0x127473(0x1a3)]();}[a53_0x1502c5(0x1a3)](){const _0x5a723e=a53_0x1502c5;!fs_1[_0x5a723e(0x186)][_0x5a723e(0x1bf)](this[_0x5a723e(0x1ac)])&&(fs_1[_0x5a723e(0x186)]['mkdirSync'](this[_0x5a723e(0x1ac)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x5a723e(0x1ac)]));}[a53_0x1502c5(0x17a)](_0x49c7c3){const _0x3d7a7a=a53_0x1502c5,_0x3eaba5=new Date()[_0x3d7a7a(0x1bd)]()[_0x3d7a7a(0x1b8)]('T')[0x0];return path_1[_0x3d7a7a(0x186)][_0x3d7a7a(0x1c9)](this[_0x3d7a7a(0x1ac)],_0x49c7c3+'_'+_0x3eaba5+_0x3d7a7a(0x1ca));}[a53_0x1502c5(0x17c)](_0x4e5485,_0x163ebf){const _0x2d2c67=a53_0x1502c5;try{const _0x1b5f1b=new Date()[_0x2d2c67(0x1bd)](),_0x46016a={'timestamp':_0x1b5f1b,..._0x163ebf},_0x16db73=JSON[_0x2d2c67(0x1c3)](_0x46016a)+'\x0a',_0x23a213=this[_0x2d2c67(0x17a)](_0x4e5485);fs_1[_0x2d2c67(0x186)][_0x2d2c67(0x1b1)](_0x23a213,_0x16db73,_0x2d2c67(0x19b));}catch(_0x2bf62a){console[_0x2d2c67(0x182)](_0x2d2c67(0x195)+_0x4e5485+'\x20log:',_0x2bf62a);}}[a53_0x1502c5(0x1c8)](_0x284981,_0x4b6fb4,_0x1071e7,_0x4ca7e2){const _0x2840ea=a53_0x1502c5;this['writeLog'](_0x2840ea(0x1ab),{'type':_0x2840ea(0x1a6),'gateway':_0x284981,'endpoint':_0x4b6fb4,'method':_0x1071e7,'data':_0x4ca7e2});}[a53_0x1502c5(0x1a2)](_0x1b4443,_0x4c34b1,_0x2a235a,_0x5964df,_0xc1860){const _0x4c44bc=a53_0x1502c5;this[_0x4c44bc(0x17c)]('white_domain_responses',{'type':'RESPONSE','gateway':_0x1b4443,'endpoint':_0x4c34b1,'status':_0x2a235a,'responseTime':_0xc1860,'data':_0x5964df});}['logWhiteDomainError'](_0x178533,_0xb14c4f,_0x531fb0){const _0x437b1e=a53_0x1502c5;this['writeLog'](_0x437b1e(0x194),{'type':_0x437b1e(0x1b2),'gateway':_0x178533,'endpoint':_0xb14c4f,'error':_0x531fb0 instanceof Error?{'message':_0x531fb0[_0x437b1e(0x1c6)],'stack':_0x531fb0[_0x437b1e(0x19a)]}:_0x531fb0});}[a53_0x1502c5(0x1bc)](_0x3ebe2b,_0x3219a5,_0x31e22f){const _0x30310c=a53_0x1502c5;this[_0x30310c(0x17c)](_0x30310c(0x1a7),{'type':_0x30310c(0x184),'gateway':_0x3ebe2b,'headers':_0x31e22f,'data':_0x3219a5});}[a53_0x1502c5(0x17f)](_0xcc3fec,_0x2ef153,_0x3fc5a0,_0x418e83,_0x27b5fa){const _0x4c3156=a53_0x1502c5;this[_0x4c3156(0x17c)](_0x4c3156(0x1b7),{'type':_0x4c3156(0x1b0),'gateway':_0xcc3fec,'paymentId':_0x2ef153,'oldStatus':_0x3fc5a0,'newStatus':_0x418e83,'originalData':_0x27b5fa});}['logWebhookError'](_0x494bb5,_0x10e44b,_0x4d232b){const _0x516300=a53_0x1502c5;this[_0x516300(0x17c)](_0x516300(0x196),{'type':_0x516300(0x19c),'gateway':_0x494bb5,'error':_0x10e44b instanceof Error?{'message':_0x10e44b[_0x516300(0x1c6)],'stack':_0x10e44b['stack']}:_0x10e44b,'originalData':_0x4d232b});}[a53_0x1502c5(0x1c0)](_0x37cf89){const _0x4d03b6=a53_0x1502c5;this[_0x4d03b6(0x17c)](_0x4d03b6(0x19d),{'type':_0x4d03b6(0x17e),..._0x37cf89});}[a53_0x1502c5(0x1ae)](_0x25aa10){const _0x539f3b=a53_0x1502c5;this[_0x539f3b(0x17c)](_0x539f3b(0x1c2),{'type':_0x539f3b(0x1c4),..._0x25aa10});}['logShopWebhookSent'](_0x4fd246,_0x638092,_0x376eaf,_0x3f68ac,_0x34327d,_0x5f6722){const _0x5a385c=a53_0x1502c5;this[_0x5a385c(0x17c)](_0x5a385c(0x1a4),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x4fd246,'webhookUrl':_0x638092,'event':_0x376eaf,'status':_0x3f68ac,'responseTime':_0x34327d,'payload':_0x5f6722});}[a53_0x1502c5(0x179)](_0x2fdcd5,_0xaca44c,_0x49c77b,_0x5d707d,_0xae00eb){const _0x1b8886=a53_0x1502c5;this[_0x1b8886(0x17c)](_0x1b8886(0x185),{'type':_0x1b8886(0x1a0),'shopId':_0x2fdcd5,'webhookUrl':_0xaca44c,'event':_0x49c77b,'error':_0x5d707d instanceof Error?{'message':_0x5d707d[_0x1b8886(0x1c6)],'stack':_0x5d707d[_0x1b8886(0x19a)]}:_0x5d707d,'payload':_0xae00eb});}[a53_0x1502c5(0x1bb)](_0x59e9f2,_0x49bc0e,_0x4a52df,_0x3abad5,_0x45ae70){const _0x53ca70=a53_0x1502c5;this[_0x53ca70(0x17c)](_0x53ca70(0x190),{'type':_0x53ca70(0x18a),'gateway':_0x59e9f2,'paymentId':_0x49bc0e,'shopId':_0x4a52df,'amount':_0x3abad5,'currency':_0x45ae70});}[a53_0x1502c5(0x1b9)](_0x3ce68d,_0x376384,_0x1ebc0a,_0x2f5269,_0x12e808){const _0xa673c2=a53_0x1502c5;this['writeLog'](_0xa673c2(0x181),{'type':'API_CALL','endpoint':_0x3ce68d,'method':_0x376384,'userId':_0x1ebc0a,'userRole':_0x2f5269,'requestData':_0x12e808});}[a53_0x1502c5(0x183)](){const _0x383b4b=a53_0x1502c5;try{const _0x3cf395=fs_1[_0x383b4b(0x186)][_0x383b4b(0x1b3)](this['logsDir']),_0x188e29=_0x3cf395[_0x383b4b(0x188)](_0x54cc52=>_0x54cc52[_0x383b4b(0x1ad)](_0x383b4b(0x1ca))),_0x1ca97d=[...new Set(_0x188e29[_0x383b4b(0x18f)](_0x2fd208=>_0x2fd208['split']('_')[0x0]))],_0x44d6a9=_0x188e29[_0x383b4b(0x18f)](_0x4a0bda=>{const _0x1b9a41=_0x383b4b,_0x2a4f69=path_1[_0x1b9a41(0x186)][_0x1b9a41(0x1c9)](this['logsDir'],_0x4a0bda),_0x858807=fs_1[_0x1b9a41(0x186)][_0x1b9a41(0x1b4)](_0x2a4f69),[_0xf7f1de,_0xa866f1]=_0x4a0bda['replace'](_0x1b9a41(0x1ca),'')['split']('_');return{'type':_0xf7f1de,'date':_0xa866f1,'size':_0x858807[_0x1b9a41(0x1a1)]};})[_0x383b4b(0x187)]((_0x4b2f26,_0x2d9ae7)=>_0x2d9ae7[_0x383b4b(0x189)][_0x383b4b(0x1b5)](_0x4b2f26[_0x383b4b(0x189)]));return{'totalFiles':_0x188e29[_0x383b4b(0x191)],'logTypes':_0x1ca97d,'latestLogs':_0x44d6a9[_0x383b4b(0x192)](0x0,0xa)};}catch(_0x2aa75b){return console[_0x383b4b(0x182)]('Failed\x20to\x20get\x20log\x20stats:',_0x2aa75b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x1502c5(0x1be)](_0x30b33e=0x1e){const _0x46d0fd=a53_0x1502c5;try{const _0x580973=fs_1[_0x46d0fd(0x186)][_0x46d0fd(0x1b3)](this[_0x46d0fd(0x1ac)]),_0x3658f=new Date();_0x3658f['setDate'](_0x3658f['getDate']()-_0x30b33e);let _0x17dffa=0x0;_0x580973[_0x46d0fd(0x19f)](_0x52641b=>{const _0x37bb30=_0x46d0fd;if(!_0x52641b['endsWith']('.log'))return;const _0x8cdad1=path_1[_0x37bb30(0x186)][_0x37bb30(0x1c9)](this['logsDir'],_0x52641b),_0x39beac=fs_1[_0x37bb30(0x186)][_0x37bb30(0x1b4)](_0x8cdad1);_0x39beac[_0x37bb30(0x1c1)]<_0x3658f&&(fs_1[_0x37bb30(0x186)][_0x37bb30(0x199)](_0x8cdad1),_0x17dffa++,console[_0x37bb30(0x1ba)](_0x37bb30(0x18e)+_0x52641b));}),console[_0x46d0fd(0x1ba)](_0x46d0fd(0x1c7)+_0x17dffa+_0x46d0fd(0x1cb)+_0x30b33e+_0x46d0fd(0x197));}catch(_0x204373){console['error'](_0x46d0fd(0x18d),_0x204373);}}}exports['LoggerService']=LoggerService,exports[a53_0x1502c5(0x18c)]=new LoggerService();