'use strict';const a59_0xc0816b=a59_0x3bf0;(function(_0x5b0050,_0x120291){const _0x3c3359=a59_0x3bf0,_0x10bee8=_0x5b0050();while(!![]){try{const _0x31f5d9=-parseInt(_0x3c3359(0x190))/0x1*(parseInt(_0x3c3359(0x193))/0x2)+parseInt(_0x3c3359(0x1a7))/0x3+-parseInt(_0x3c3359(0x178))/0x4+-parseInt(_0x3c3359(0x17c))/0x5*(-parseInt(_0x3c3359(0x174))/0x6)+-parseInt(_0x3c3359(0x177))/0x7*(parseInt(_0x3c3359(0x19d))/0x8)+-parseInt(_0x3c3359(0x1bd))/0x9*(-parseInt(_0x3c3359(0x1b2))/0xa)+parseInt(_0x3c3359(0x1b9))/0xb;if(_0x31f5d9===_0x120291)break;else _0x10bee8['push'](_0x10bee8['shift']());}catch(_0x4dddf1){_0x10bee8['push'](_0x10bee8['shift']());}}}(a59_0x386e,0xa8401));var __importDefault=this&&this['__importDefault']||function(_0x5c2972){const _0x176502=a59_0x3bf0;return _0x5c2972&&_0x5c2972[_0x176502(0x196)]?_0x5c2972:{'default':_0x5c2972};};function a59_0x3bf0(_0x4662ef,_0x9812bf){const _0x386e9b=a59_0x386e();return a59_0x3bf0=function(_0x3bf06f,_0xd31f15){_0x3bf06f=_0x3bf06f-0x16f;let _0x2c37bc=_0x386e9b[_0x3bf06f];return _0x2c37bc;},a59_0x3bf0(_0x4662ef,_0x9812bf);}Object[a59_0xc0816b(0x191)](exports,'__esModule',{'value':!![]}),exports[a59_0xc0816b(0x184)]=exports[a59_0xc0816b(0x1b0)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0xc0816b(0x195)));function a59_0x386e(){const _0x201059=['cointopay_status_changes','.log','default','15wTUpGX','logWhiteDomainResponse','shop_webhooks_errors','webhooks_received','log','getLogStats','stack','slice','loggerService','forEach','webhooks_processed','Failed\x20to\x20clean\x20old\x20logs:','cwd','api_calls','appendFileSync','SHOP_WEBHOOK_SENT','logsDir','\x20days)','filter','toISOString','8bAWUtS','defineProperty','map','40738ugVFfe','localeCompare','path','__esModule','unlinkSync','white_domain_responses','WEBHOOK_PROCESSED','🧹\x20Cleaned\x20','logApiCall','error','8dEVhgl','Failed\x20to\x20write\x20','logCoinToPayStatus','statSync','WEBHOOK_ERROR','ensureLogsDirectory','setDate','replace','white_domain_requests','message','709578tSLCGh','RESPONSE','join','logWebhookReceived','size','PAYMENT_CREATED','white_domain_errors','date','logs','LoggerService','stringify','750tvoyUN','COINTOPAY_ERROR','logCoinToPayError','logShopWebhookSent','logShopWebhookError','logWebhookError','writeLog','5087665kvafmu','mkdirSync','existsSync','length','142857UyMveW','logWhiteDomainError','\x20old\x20log\x20files\x20(older\x20than\x20','endsWith','cleanOldLogs','webhooks_errors','readdirSync','COINTOPAY_STATUS_CHANGE','1841154OuIKYS','split','cointopay_errors','7113057FaizyQ','3767348UtycWj'];a59_0x386e=function(){return _0x201059;};return a59_0x386e();}class LoggerService{constructor(){const _0x14f788=a59_0xc0816b;this['logsDir']=path_1[_0x14f788(0x17b)]['join'](process[_0x14f788(0x188)](),_0x14f788(0x1af)),this[_0x14f788(0x1a2)]();}[a59_0xc0816b(0x1a2)](){const _0x549c53=a59_0xc0816b;!fs_1[_0x549c53(0x17b)][_0x549c53(0x1bb)](this[_0x549c53(0x18c)])&&(fs_1['default'][_0x549c53(0x1ba)](this[_0x549c53(0x18c)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x549c53(0x18c)]));}['getLogFileName'](_0x54669a){const _0x18a1b6=a59_0xc0816b,_0xb40239=new Date()[_0x18a1b6(0x18f)]()[_0x18a1b6(0x175)]('T')[0x0];return path_1['default'][_0x18a1b6(0x1a9)](this[_0x18a1b6(0x18c)],_0x54669a+'_'+_0xb40239+_0x18a1b6(0x17a));}[a59_0xc0816b(0x1b8)](_0x42be7e,_0x4b2e9c){const _0x2d11bd=a59_0xc0816b;try{const _0x5a1406=new Date()[_0x2d11bd(0x18f)](),_0x12eb4d={'timestamp':_0x5a1406,..._0x4b2e9c},_0x131ea2=JSON[_0x2d11bd(0x1b1)](_0x12eb4d)+'\x0a',_0x19dc1b=this['getLogFileName'](_0x42be7e);fs_1['default'][_0x2d11bd(0x18a)](_0x19dc1b,_0x131ea2,'utf8');}catch(_0x173403){console[_0x2d11bd(0x19c)](_0x2d11bd(0x19e)+_0x42be7e+'\x20log:',_0x173403);}}['logWhiteDomainRequest'](_0x56ca9a,_0x53f070,_0x3da212,_0xff59d6){const _0x22ebc8=a59_0xc0816b;this[_0x22ebc8(0x1b8)](_0x22ebc8(0x1a5),{'type':'REQUEST','gateway':_0x56ca9a,'endpoint':_0x53f070,'method':_0x3da212,'data':_0xff59d6});}[a59_0xc0816b(0x17d)](_0x49b211,_0x169afa,_0x3524ba,_0xb91f4f,_0x4a6eee){const _0x5da675=a59_0xc0816b;this[_0x5da675(0x1b8)](_0x5da675(0x198),{'type':_0x5da675(0x1a8),'gateway':_0x49b211,'endpoint':_0x169afa,'status':_0x3524ba,'responseTime':_0x4a6eee,'data':_0xb91f4f});}[a59_0xc0816b(0x1be)](_0x35313c,_0xbef284,_0x4163e7){const _0x3151ba=a59_0xc0816b;this[_0x3151ba(0x1b8)](_0x3151ba(0x1ad),{'type':'ERROR','gateway':_0x35313c,'endpoint':_0xbef284,'error':_0x4163e7 instanceof Error?{'message':_0x4163e7[_0x3151ba(0x1a6)],'stack':_0x4163e7[_0x3151ba(0x182)]}:_0x4163e7});}[a59_0xc0816b(0x1aa)](_0xe20062,_0x4195b8,_0x1f2fcb){const _0x32cb20=a59_0xc0816b;this[_0x32cb20(0x1b8)](_0x32cb20(0x17f),{'type':'WEBHOOK_RECEIVED','gateway':_0xe20062,'headers':_0x1f2fcb,'data':_0x4195b8});}['logWebhookProcessed'](_0x261a8a,_0x23071b,_0x6b7e1,_0x13097f,_0x2da1cd){const _0x5528ba=a59_0xc0816b;this[_0x5528ba(0x1b8)](_0x5528ba(0x186),{'type':_0x5528ba(0x199),'gateway':_0x261a8a,'paymentId':_0x23071b,'oldStatus':_0x6b7e1,'newStatus':_0x13097f,'originalData':_0x2da1cd});}[a59_0xc0816b(0x1b7)](_0x7f2435,_0x3d8580,_0x39c24a){const _0x472983=a59_0xc0816b;this[_0x472983(0x1b8)](_0x472983(0x171),{'type':_0x472983(0x1a1),'gateway':_0x7f2435,'error':_0x3d8580 instanceof Error?{'message':_0x3d8580[_0x472983(0x1a6)],'stack':_0x3d8580[_0x472983(0x182)]}:_0x3d8580,'originalData':_0x39c24a});}[a59_0xc0816b(0x19f)](_0x459071){const _0x4aabf1=a59_0xc0816b;this[_0x4aabf1(0x1b8)](_0x4aabf1(0x179),{'type':_0x4aabf1(0x173),..._0x459071});}[a59_0xc0816b(0x1b4)](_0x15f4d0){const _0xfef0de=a59_0xc0816b;this[_0xfef0de(0x1b8)](_0xfef0de(0x176),{'type':_0xfef0de(0x1b3),..._0x15f4d0});}[a59_0xc0816b(0x1b5)](_0x3c83bf,_0x44da5b,_0x53168f,_0x30386f,_0x338bde,_0x21a3e4){const _0x43724c=a59_0xc0816b;this[_0x43724c(0x1b8)]('shop_webhooks_sent',{'type':_0x43724c(0x18b),'shopId':_0x3c83bf,'webhookUrl':_0x44da5b,'event':_0x53168f,'status':_0x30386f,'responseTime':_0x338bde,'payload':_0x21a3e4});}[a59_0xc0816b(0x1b6)](_0x28cf84,_0x37cff7,_0x2f3fc0,_0x5428f5,_0x411294){const _0x8ce5f9=a59_0xc0816b;this[_0x8ce5f9(0x1b8)](_0x8ce5f9(0x17e),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x28cf84,'webhookUrl':_0x37cff7,'event':_0x2f3fc0,'error':_0x5428f5 instanceof Error?{'message':_0x5428f5[_0x8ce5f9(0x1a6)],'stack':_0x5428f5[_0x8ce5f9(0x182)]}:_0x5428f5,'payload':_0x411294});}['logPaymentCreated'](_0xf3486d,_0x27bef6,_0x2ccf92,_0x2d0ce7,_0x2c7df5){const _0xea5e8e=a59_0xc0816b;this['writeLog']('payments_created',{'type':_0xea5e8e(0x1ac),'gateway':_0xf3486d,'paymentId':_0x27bef6,'shopId':_0x2ccf92,'amount':_0x2d0ce7,'currency':_0x2c7df5});}[a59_0xc0816b(0x19b)](_0x1d2664,_0x1e5361,_0x341e1a,_0x21c760,_0x10fd6c){const _0x1f2a8a=a59_0xc0816b;this[_0x1f2a8a(0x1b8)](_0x1f2a8a(0x189),{'type':'API_CALL','endpoint':_0x1d2664,'method':_0x1e5361,'userId':_0x341e1a,'userRole':_0x21c760,'requestData':_0x10fd6c});}[a59_0xc0816b(0x181)](){const _0x456893=a59_0xc0816b;try{const _0x2e7d19=fs_1[_0x456893(0x17b)][_0x456893(0x172)](this[_0x456893(0x18c)]),_0x4e97a2=_0x2e7d19[_0x456893(0x18e)](_0x2f0c34=>_0x2f0c34[_0x456893(0x16f)]('.log')),_0x406d58=[...new Set(_0x4e97a2['map'](_0x4a4a87=>_0x4a4a87[_0x456893(0x175)]('_')[0x0]))],_0x1bce3a=_0x4e97a2[_0x456893(0x192)](_0xaae646=>{const _0x3dcd2f=_0x456893,_0x47ce12=path_1['default']['join'](this['logsDir'],_0xaae646),_0x5e6e1e=fs_1[_0x3dcd2f(0x17b)][_0x3dcd2f(0x1a0)](_0x47ce12),[_0x101cba,_0x47aed1]=_0xaae646[_0x3dcd2f(0x1a4)]('.log','')[_0x3dcd2f(0x175)]('_');return{'type':_0x101cba,'date':_0x47aed1,'size':_0x5e6e1e[_0x3dcd2f(0x1ab)]};})['sort']((_0x425c99,_0x4037e2)=>_0x4037e2[_0x456893(0x1ae)][_0x456893(0x194)](_0x425c99['date']));return{'totalFiles':_0x4e97a2[_0x456893(0x1bc)],'logTypes':_0x406d58,'latestLogs':_0x1bce3a[_0x456893(0x183)](0x0,0xa)};}catch(_0xea0928){return console[_0x456893(0x19c)]('Failed\x20to\x20get\x20log\x20stats:',_0xea0928),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0xc0816b(0x170)](_0x2857a7=0x1e){const _0x578e9e=a59_0xc0816b;try{const _0x328a80=fs_1[_0x578e9e(0x17b)][_0x578e9e(0x172)](this['logsDir']),_0x4cac99=new Date();_0x4cac99[_0x578e9e(0x1a3)](_0x4cac99['getDate']()-_0x2857a7);let _0x2c009b=0x0;_0x328a80[_0x578e9e(0x185)](_0x1e6131=>{const _0x5e03a9=_0x578e9e;if(!_0x1e6131['endsWith'](_0x5e03a9(0x17a)))return;const _0x117398=path_1[_0x5e03a9(0x17b)][_0x5e03a9(0x1a9)](this[_0x5e03a9(0x18c)],_0x1e6131),_0x516a94=fs_1[_0x5e03a9(0x17b)]['statSync'](_0x117398);_0x516a94['mtime']<_0x4cac99&&(fs_1[_0x5e03a9(0x17b)][_0x5e03a9(0x197)](_0x117398),_0x2c009b++,console[_0x5e03a9(0x180)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x1e6131));}),console['log'](_0x578e9e(0x19a)+_0x2c009b+_0x578e9e(0x1bf)+_0x2857a7+_0x578e9e(0x18d));}catch(_0x70e5f5){console[_0x578e9e(0x19c)](_0x578e9e(0x187),_0x70e5f5);}}}exports[a59_0xc0816b(0x1b0)]=LoggerService,exports[a59_0xc0816b(0x184)]=new LoggerService();