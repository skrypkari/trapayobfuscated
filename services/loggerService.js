'use strict';const a51_0x5a3ec9=a51_0x21bb;(function(_0x4e513e,_0xe93e50){const _0x3498be=a51_0x21bb,_0x3dc222=_0x4e513e();while(!![]){try{const _0x4c9285=-parseInt(_0x3498be(0x133))/0x1+-parseInt(_0x3498be(0x10e))/0x2*(-parseInt(_0x3498be(0x12d))/0x3)+parseInt(_0x3498be(0x128))/0x4+parseInt(_0x3498be(0x103))/0x5*(parseInt(_0x3498be(0x114))/0x6)+-parseInt(_0x3498be(0x116))/0x7+parseInt(_0x3498be(0xed))/0x8*(parseInt(_0x3498be(0x117))/0x9)+-parseInt(_0x3498be(0x134))/0xa*(parseInt(_0x3498be(0xfe))/0xb);if(_0x4c9285===_0xe93e50)break;else _0x3dc222['push'](_0x3dc222['shift']());}catch(_0x56b955){_0x3dc222['push'](_0x3dc222['shift']());}}}(a51_0x508c,0x34d5f));var __importDefault=this&&this[a51_0x5a3ec9(0x122)]||function(_0x282972){return _0x282972&&_0x282972['__esModule']?_0x282972:{'default':_0x282972};};function a51_0x21bb(_0x24ffe4,_0x1e5ce7){const _0x508c08=a51_0x508c();return a51_0x21bb=function(_0x21bb9b,_0x4dfab6){_0x21bb9b=_0x21bb9b-0xe5;let _0x46adbe=_0x508c08[_0x21bb9b];return _0x46adbe;},a51_0x21bb(_0x24ffe4,_0x1e5ce7);}Object[a51_0x5a3ec9(0x11d)](exports,a51_0x5a3ec9(0x136),{'value':!![]}),exports[a51_0x5a3ec9(0x135)]=exports[a51_0x5a3ec9(0xec)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x5a3ec9(0x120)));class LoggerService{constructor(){const _0x5f4d77=a51_0x5a3ec9;this['logsDir']=path_1['default'][_0x5f4d77(0x129)](process[_0x5f4d77(0x12b)](),_0x5f4d77(0x11b)),this[_0x5f4d77(0x10a)]();}[a51_0x5a3ec9(0x10a)](){const _0x13324c=a51_0x5a3ec9;!fs_1[_0x13324c(0x131)][_0x13324c(0xf5)](this[_0x13324c(0xfa)])&&(fs_1[_0x13324c(0x131)][_0x13324c(0x100)](this[_0x13324c(0xfa)],{'recursive':!![]}),console[_0x13324c(0x10b)](_0x13324c(0x112)+this[_0x13324c(0xfa)]));}[a51_0x5a3ec9(0xf2)](_0x44cd3d){const _0xb32933=a51_0x5a3ec9,_0x20bdae=new Date()[_0xb32933(0x119)]()[_0xb32933(0xe5)]('T')[0x0];return path_1[_0xb32933(0x131)][_0xb32933(0x129)](this[_0xb32933(0xfa)],_0x44cd3d+'_'+_0x20bdae+_0xb32933(0x10f));}['writeLog'](_0x529f16,_0x2aeff0){const _0x560dda=a51_0x5a3ec9;try{const _0x2d78b0=new Date()['toISOString'](),_0x1e3a58={'timestamp':_0x2d78b0,..._0x2aeff0},_0x10479b=JSON[_0x560dda(0xee)](_0x1e3a58)+'\x0a',_0x5360b6=this[_0x560dda(0xf2)](_0x529f16);fs_1[_0x560dda(0x131)][_0x560dda(0xe7)](_0x5360b6,_0x10479b,_0x560dda(0x12e));}catch(_0x2e5e4a){console['error'](_0x560dda(0x107)+_0x529f16+_0x560dda(0xf7),_0x2e5e4a);}}['logWhiteDomainRequest'](_0x5da085,_0x3a2ae7,_0x593e6c,_0x165328){const _0x1e17dc=a51_0x5a3ec9;this[_0x1e17dc(0x124)](_0x1e17dc(0x121),{'type':_0x1e17dc(0x118),'gateway':_0x5da085,'endpoint':_0x3a2ae7,'method':_0x593e6c,'data':_0x165328});}[a51_0x5a3ec9(0x108)](_0x5cd7af,_0x3dd142,_0x24b84b,_0x5768f3,_0x16b8d3){const _0x50f0fd=a51_0x5a3ec9;this[_0x50f0fd(0x124)]('white_domain_responses',{'type':_0x50f0fd(0x109),'gateway':_0x5cd7af,'endpoint':_0x3dd142,'status':_0x24b84b,'responseTime':_0x16b8d3,'data':_0x5768f3});}[a51_0x5a3ec9(0x123)](_0xb89dc,_0x582556,_0x1c011a){const _0x4709ae=a51_0x5a3ec9;this[_0x4709ae(0x124)]('white_domain_errors',{'type':_0x4709ae(0xeb),'gateway':_0xb89dc,'endpoint':_0x582556,'error':_0x1c011a instanceof Error?{'message':_0x1c011a[_0x4709ae(0x13a)],'stack':_0x1c011a['stack']}:_0x1c011a});}[a51_0x5a3ec9(0x11e)](_0x3252de,_0x2e98c8,_0x3ce2bb){const _0x40ed8d=a51_0x5a3ec9;this[_0x40ed8d(0x124)](_0x40ed8d(0x10d),{'type':_0x40ed8d(0x11f),'gateway':_0x3252de,'headers':_0x3ce2bb,'data':_0x2e98c8});}[a51_0x5a3ec9(0xe9)](_0xd28331,_0x3bdac8,_0x4531d6,_0xd07212,_0x1c3287){const _0x628bf6=a51_0x5a3ec9;this[_0x628bf6(0x124)](_0x628bf6(0x12c),{'type':_0x628bf6(0x126),'gateway':_0xd28331,'paymentId':_0x3bdac8,'oldStatus':_0x4531d6,'newStatus':_0xd07212,'originalData':_0x1c3287});}['logWebhookError'](_0x1390f2,_0xf05633,_0x244915){const _0x126af6=a51_0x5a3ec9;this[_0x126af6(0x124)](_0x126af6(0x11c),{'type':_0x126af6(0xfc),'gateway':_0x1390f2,'error':_0xf05633 instanceof Error?{'message':_0xf05633[_0x126af6(0x13a)],'stack':_0xf05633['stack']}:_0xf05633,'originalData':_0x244915});}[a51_0x5a3ec9(0x113)](_0x4944e8){const _0x5e91b3=a51_0x5a3ec9;this[_0x5e91b3(0x124)]('cointopay_status_changes',{'type':_0x5e91b3(0x102),..._0x4944e8});}[a51_0x5a3ec9(0x104)](_0x554d95){const _0x19346c=a51_0x5a3ec9;this[_0x19346c(0x124)](_0x19346c(0x13b),{'type':_0x19346c(0xfd),..._0x554d95});}[a51_0x5a3ec9(0xf1)](_0x5c29c4,_0x28c9da,_0x2f3ae1,_0x4244aa,_0xf9a647,_0xc7ba5f){const _0x4cd016=a51_0x5a3ec9;this['writeLog'](_0x4cd016(0xe8),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x5c29c4,'webhookUrl':_0x28c9da,'event':_0x2f3ae1,'status':_0x4244aa,'responseTime':_0xf9a647,'payload':_0xc7ba5f});}['logShopWebhookError'](_0x45ab93,_0x2d0466,_0x3f7e1c,_0x38d894,_0x171549){const _0x1f5147=a51_0x5a3ec9;this['writeLog'](_0x1f5147(0xf0),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x45ab93,'webhookUrl':_0x2d0466,'event':_0x3f7e1c,'error':_0x38d894 instanceof Error?{'message':_0x38d894['message'],'stack':_0x38d894[_0x1f5147(0x101)]}:_0x38d894,'payload':_0x171549});}[a51_0x5a3ec9(0xf4)](_0x2d4203,_0x1b3b1b,_0x445b98,_0x4086af,_0x437f87){const _0x460af4=a51_0x5a3ec9;this[_0x460af4(0x124)](_0x460af4(0x130),{'type':_0x460af4(0xe6),'gateway':_0x2d4203,'paymentId':_0x1b3b1b,'shopId':_0x445b98,'amount':_0x4086af,'currency':_0x437f87});}[a51_0x5a3ec9(0x110)](_0x3e7943,_0x218bc5,_0x28ed51,_0x4fb841,_0x378ddd){const _0x2ed9f8=a51_0x5a3ec9;this['writeLog'](_0x2ed9f8(0x10c),{'type':_0x2ed9f8(0x137),'endpoint':_0x3e7943,'method':_0x218bc5,'userId':_0x28ed51,'userRole':_0x4fb841,'requestData':_0x378ddd});}[a51_0x5a3ec9(0x111)](){const _0x3ad477=a51_0x5a3ec9;try{const _0x595884=fs_1['default'][_0x3ad477(0x105)](this[_0x3ad477(0xfa)]),_0x37c11b=_0x595884[_0x3ad477(0x132)](_0x56b540=>_0x56b540[_0x3ad477(0x127)](_0x3ad477(0x10f))),_0x282b6b=[...new Set(_0x37c11b[_0x3ad477(0x12a)](_0x186f32=>_0x186f32[_0x3ad477(0xe5)]('_')[0x0]))],_0xd00922=_0x37c11b[_0x3ad477(0x12a)](_0x6731d4=>{const _0x4819f2=_0x3ad477,_0x55f029=path_1[_0x4819f2(0x131)][_0x4819f2(0x129)](this[_0x4819f2(0xfa)],_0x6731d4),_0x4953f0=fs_1[_0x4819f2(0x131)][_0x4819f2(0x139)](_0x55f029),[_0x2a004f,_0xddce50]=_0x6731d4['replace'](_0x4819f2(0x10f),'')[_0x4819f2(0xe5)]('_');return{'type':_0x2a004f,'date':_0xddce50,'size':_0x4953f0[_0x4819f2(0x125)]};})[_0x3ad477(0xef)]((_0x38d489,_0x3d06c1)=>_0x3d06c1[_0x3ad477(0xfb)][_0x3ad477(0x12f)](_0x38d489['date']));return{'totalFiles':_0x37c11b[_0x3ad477(0xf8)],'logTypes':_0x282b6b,'latestLogs':_0xd00922['slice'](0x0,0xa)};}catch(_0x2e8d21){return console[_0x3ad477(0xf3)](_0x3ad477(0x11a),_0x2e8d21),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x350ebf=0x1e){const _0x137e26=a51_0x5a3ec9;try{const _0x3b5716=fs_1[_0x137e26(0x131)][_0x137e26(0x105)](this[_0x137e26(0xfa)]),_0x1175df=new Date();_0x1175df[_0x137e26(0xf6)](_0x1175df[_0x137e26(0x115)]()-_0x350ebf);let _0x2dcb40=0x0;_0x3b5716[_0x137e26(0x138)](_0x470202=>{const _0x2794f8=_0x137e26;if(!_0x470202[_0x2794f8(0x127)](_0x2794f8(0x10f)))return;const _0x4ea617=path_1[_0x2794f8(0x131)][_0x2794f8(0x129)](this['logsDir'],_0x470202),_0x317bed=fs_1[_0x2794f8(0x131)][_0x2794f8(0x139)](_0x4ea617);_0x317bed[_0x2794f8(0xf9)]<_0x1175df&&(fs_1[_0x2794f8(0x131)][_0x2794f8(0x106)](_0x4ea617),_0x2dcb40++,console['log']('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x470202));}),console[_0x137e26(0x10b)]('🧹\x20Cleaned\x20'+_0x2dcb40+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x350ebf+_0x137e26(0xff));}catch(_0x4a1254){console[_0x137e26(0xf3)](_0x137e26(0xea),_0x4a1254);}}}exports[a51_0x5a3ec9(0xec)]=LoggerService,exports['loggerService']=new LoggerService();function a51_0x508c(){const _0x35b890=['\x20log:','length','mtime','logsDir','date','WEBHOOK_ERROR','COINTOPAY_ERROR','451VDApah','\x20days)','mkdirSync','stack','COINTOPAY_STATUS_CHANGE','90065JhgnHQ','logCoinToPayError','readdirSync','unlinkSync','Failed\x20to\x20write\x20','logWhiteDomainResponse','RESPONSE','ensureLogsDirectory','log','api_calls','webhooks_received','32cCfhHn','.log','logApiCall','getLogStats','📁\x20Created\x20logs\x20directory:\x20','logCoinToPayStatus','42GOaXWi','getDate','385063miVvzy','902034OagFEJ','REQUEST','toISOString','Failed\x20to\x20get\x20log\x20stats:','logs','webhooks_errors','defineProperty','logWebhookReceived','WEBHOOK_RECEIVED','path','white_domain_requests','__importDefault','logWhiteDomainError','writeLog','size','WEBHOOK_PROCESSED','endsWith','901956TDKbMv','join','map','cwd','webhooks_processed','28059zqyaXr','utf8','localeCompare','payments_created','default','filter','104593CJuriZ','79430eslROZ','loggerService','__esModule','API_CALL','forEach','statSync','message','cointopay_errors','split','PAYMENT_CREATED','appendFileSync','shop_webhooks_sent','logWebhookProcessed','Failed\x20to\x20clean\x20old\x20logs:','ERROR','LoggerService','16LslOwA','stringify','sort','shop_webhooks_errors','logShopWebhookSent','getLogFileName','error','logPaymentCreated','existsSync','setDate'];a51_0x508c=function(){return _0x35b890;};return a51_0x508c();}