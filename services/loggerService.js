'use strict';const a48_0x45eb90=a48_0x3e3c;(function(_0x1d33a3,_0x4e24ab){const _0x13864d=a48_0x3e3c,_0x5856b6=_0x1d33a3();while(!![]){try{const _0xe9a10a=parseInt(_0x13864d(0x128))/0x1*(-parseInt(_0x13864d(0x12d))/0x2)+-parseInt(_0x13864d(0x143))/0x3*(-parseInt(_0x13864d(0x119))/0x4)+parseInt(_0x13864d(0x113))/0x5+parseInt(_0x13864d(0x125))/0x6*(-parseInt(_0x13864d(0x124))/0x7)+parseInt(_0x13864d(0x117))/0x8*(parseInt(_0x13864d(0x121))/0x9)+parseInt(_0x13864d(0x10e))/0xa+-parseInt(_0x13864d(0x12c))/0xb;if(_0xe9a10a===_0x4e24ab)break;else _0x5856b6['push'](_0x5856b6['shift']());}catch(_0x167df0){_0x5856b6['push'](_0x5856b6['shift']());}}}(a48_0x4b0c,0x87d92));var __importDefault=this&&this[a48_0x45eb90(0x12f)]||function(_0x376470){const _0x4ac33e=a48_0x45eb90;return _0x376470&&_0x376470[_0x4ac33e(0x127)]?_0x376470:{'default':_0x376470};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a48_0x45eb90(0xff)]=exports[a48_0x45eb90(0x13d)]=void 0x0;function a48_0x4b0c(){const _0x58b5f2=['split','8FbGnKj','🗑️\x20Deleted\x20old\x20log\x20file:\x20','604bpetTp','sort','cleanOldLogs','RESPONSE','mkdirSync','🧹\x20Cleaned\x20','slice','logCoinToPayStatus','2460519ylMelJ','size','webhooks_received','119441ZBAOnx','222uIVxoE','message','__esModule','1029751NoUDvu','default','readdirSync','white_domain_errors','1722831cHeiTM','2catMfz','writeLog','__importDefault','getDate','Failed\x20to\x20clean\x20old\x20logs:','WEBHOOK_PROCESSED','mtime','statSync','WEBHOOK_ERROR','path','error','API_CALL','webhooks_errors','\x20days)','toISOString','replace','LoggerService','Failed\x20to\x20get\x20log\x20stats:','payments_created','appendFileSync','date','WEBHOOK_RECEIVED','5193MJCqfX','logsDir','join','\x20log:','logWhiteDomainResponse','existsSync','ERROR','map','unlinkSync','logWhiteDomainError','forEach','logWhiteDomainRequest','loggerService','stringify','📁\x20Created\x20logs\x20directory:\x20','shop_webhooks_errors','logApiCall','stack','endsWith','COINTOPAY_ERROR','logWebhookProcessed','logPaymentCreated','cointopay_errors','logCoinToPayError','.log','getLogStats','getLogFileName','9021720llKUyY','log','webhooks_processed','logs','logShopWebhookSent','4685965mAATCZ','ensureLogsDirectory','SHOP_WEBHOOK_SENT'];a48_0x4b0c=function(){return _0x58b5f2;};return a48_0x4b0c();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x45eb90(0x136)));function a48_0x3e3c(_0x45e9d8,_0x53015c){const _0x4b0cc8=a48_0x4b0c();return a48_0x3e3c=function(_0x3e3c9b,_0x2b68fa){_0x3e3c9b=_0x3e3c9b-0xf4;let _0x54882a=_0x4b0cc8[_0x3e3c9b];return _0x54882a;},a48_0x3e3c(_0x45e9d8,_0x53015c);}class LoggerService{constructor(){const _0x27c0fa=a48_0x45eb90;this[_0x27c0fa(0xf4)]=path_1[_0x27c0fa(0x129)]['join'](process['cwd'](),_0x27c0fa(0x111)),this[_0x27c0fa(0x114)]();}[a48_0x45eb90(0x114)](){const _0x1fa3a5=a48_0x45eb90;!fs_1[_0x1fa3a5(0x129)][_0x1fa3a5(0xf8)](this['logsDir'])&&(fs_1[_0x1fa3a5(0x129)][_0x1fa3a5(0x11d)](this[_0x1fa3a5(0xf4)],{'recursive':!![]}),console[_0x1fa3a5(0x10f)](_0x1fa3a5(0x101)+this[_0x1fa3a5(0xf4)]));}[a48_0x45eb90(0x10d)](_0x31ec95){const _0xc9bacb=a48_0x45eb90,_0x3048cf=new Date()[_0xc9bacb(0x13b)]()[_0xc9bacb(0x116)]('T')[0x0];return path_1[_0xc9bacb(0x129)]['join'](this[_0xc9bacb(0xf4)],_0x31ec95+'_'+_0x3048cf+'.log');}[a48_0x45eb90(0x12e)](_0x394dfa,_0x37d731){const _0x31c04d=a48_0x45eb90;try{const _0x41c12b=new Date()[_0x31c04d(0x13b)](),_0x3c6a41={'timestamp':_0x41c12b,..._0x37d731},_0x3d39d0=JSON[_0x31c04d(0x100)](_0x3c6a41)+'\x0a',_0x3b850a=this[_0x31c04d(0x10d)](_0x394dfa);fs_1[_0x31c04d(0x129)][_0x31c04d(0x140)](_0x3b850a,_0x3d39d0,'utf8');}catch(_0x7656dc){console[_0x31c04d(0x137)]('Failed\x20to\x20write\x20'+_0x394dfa+_0x31c04d(0xf6),_0x7656dc);}}[a48_0x45eb90(0xfe)](_0x4899a5,_0x26e074,_0x46dd55,_0x4bbeba){const _0x2eab53=a48_0x45eb90;this[_0x2eab53(0x12e)]('white_domain_requests',{'type':'REQUEST','gateway':_0x4899a5,'endpoint':_0x26e074,'method':_0x46dd55,'data':_0x4bbeba});}[a48_0x45eb90(0xf7)](_0x498c27,_0x257f32,_0x4ecf9b,_0xb87883,_0xace80){const _0x4cd07a=a48_0x45eb90;this[_0x4cd07a(0x12e)]('white_domain_responses',{'type':_0x4cd07a(0x11c),'gateway':_0x498c27,'endpoint':_0x257f32,'status':_0x4ecf9b,'responseTime':_0xace80,'data':_0xb87883});}[a48_0x45eb90(0xfc)](_0x3e1e83,_0x7c6cf6,_0x22081d){const _0x10df48=a48_0x45eb90;this['writeLog'](_0x10df48(0x12b),{'type':_0x10df48(0xf9),'gateway':_0x3e1e83,'endpoint':_0x7c6cf6,'error':_0x22081d instanceof Error?{'message':_0x22081d['message'],'stack':_0x22081d[_0x10df48(0x104)]}:_0x22081d});}['logWebhookReceived'](_0x5bca36,_0x1a2d32,_0x47e545){const _0xe1f643=a48_0x45eb90;this[_0xe1f643(0x12e)](_0xe1f643(0x123),{'type':_0xe1f643(0x142),'gateway':_0x5bca36,'headers':_0x47e545,'data':_0x1a2d32});}[a48_0x45eb90(0x107)](_0x44070b,_0x26e92b,_0x50cd5d,_0x16be1d,_0x40aabb){const _0x40dd2d=a48_0x45eb90;this[_0x40dd2d(0x12e)](_0x40dd2d(0x110),{'type':_0x40dd2d(0x132),'gateway':_0x44070b,'paymentId':_0x26e92b,'oldStatus':_0x50cd5d,'newStatus':_0x16be1d,'originalData':_0x40aabb});}['logWebhookError'](_0x20bcb3,_0x551f02,_0x20cf9f){const _0x13c145=a48_0x45eb90;this[_0x13c145(0x12e)](_0x13c145(0x139),{'type':_0x13c145(0x135),'gateway':_0x20bcb3,'error':_0x551f02 instanceof Error?{'message':_0x551f02[_0x13c145(0x126)],'stack':_0x551f02[_0x13c145(0x104)]}:_0x551f02,'originalData':_0x20cf9f});}[a48_0x45eb90(0x120)](_0x1caf2d){const _0x489e0e=a48_0x45eb90;this[_0x489e0e(0x12e)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x1caf2d});}[a48_0x45eb90(0x10a)](_0x3d77f7){const _0x17eef=a48_0x45eb90;this[_0x17eef(0x12e)](_0x17eef(0x109),{'type':_0x17eef(0x106),..._0x3d77f7});}[a48_0x45eb90(0x112)](_0x24f3f8,_0x3b964c,_0x4ff434,_0x50153f,_0x534db5,_0x1ee8da){const _0x1329a9=a48_0x45eb90;this[_0x1329a9(0x12e)]('shop_webhooks_sent',{'type':_0x1329a9(0x115),'shopId':_0x24f3f8,'webhookUrl':_0x3b964c,'event':_0x4ff434,'status':_0x50153f,'responseTime':_0x534db5,'payload':_0x1ee8da});}['logShopWebhookError'](_0x3e72b6,_0x496226,_0x49a0b9,_0x14cd99,_0x647c14){const _0x37347d=a48_0x45eb90;this[_0x37347d(0x12e)](_0x37347d(0x102),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x3e72b6,'webhookUrl':_0x496226,'event':_0x49a0b9,'error':_0x14cd99 instanceof Error?{'message':_0x14cd99['message'],'stack':_0x14cd99[_0x37347d(0x104)]}:_0x14cd99,'payload':_0x647c14});}[a48_0x45eb90(0x108)](_0x4a9b53,_0x2518cf,_0x3d16cc,_0xb8054e,_0x4f4acb){const _0x29c6a2=a48_0x45eb90;this[_0x29c6a2(0x12e)](_0x29c6a2(0x13f),{'type':'PAYMENT_CREATED','gateway':_0x4a9b53,'paymentId':_0x2518cf,'shopId':_0x3d16cc,'amount':_0xb8054e,'currency':_0x4f4acb});}[a48_0x45eb90(0x103)](_0xb01473,_0x105efa,_0x59b6f0,_0x177697,_0x23ae1f){const _0xc0d961=a48_0x45eb90;this[_0xc0d961(0x12e)]('api_calls',{'type':_0xc0d961(0x138),'endpoint':_0xb01473,'method':_0x105efa,'userId':_0x59b6f0,'userRole':_0x177697,'requestData':_0x23ae1f});}[a48_0x45eb90(0x10c)](){const _0x53caa2=a48_0x45eb90;try{const _0x128ee4=fs_1[_0x53caa2(0x129)][_0x53caa2(0x12a)](this[_0x53caa2(0xf4)]),_0x116804=_0x128ee4['filter'](_0x17034a=>_0x17034a['endsWith'](_0x53caa2(0x10b))),_0x15ae99=[...new Set(_0x116804[_0x53caa2(0xfa)](_0x53d6ba=>_0x53d6ba[_0x53caa2(0x116)]('_')[0x0]))],_0x298b3c=_0x116804[_0x53caa2(0xfa)](_0x1ba378=>{const _0x56936f=_0x53caa2,_0x47ba65=path_1[_0x56936f(0x129)][_0x56936f(0xf5)](this[_0x56936f(0xf4)],_0x1ba378),_0x5e66e1=fs_1[_0x56936f(0x129)][_0x56936f(0x134)](_0x47ba65),[_0x3e6dba,_0x56bdef]=_0x1ba378[_0x56936f(0x13c)]('.log','')[_0x56936f(0x116)]('_');return{'type':_0x3e6dba,'date':_0x56bdef,'size':_0x5e66e1[_0x56936f(0x122)]};})[_0x53caa2(0x11a)]((_0x5024eb,_0x88d141)=>_0x88d141[_0x53caa2(0x141)]['localeCompare'](_0x5024eb[_0x53caa2(0x141)]));return{'totalFiles':_0x116804['length'],'logTypes':_0x15ae99,'latestLogs':_0x298b3c[_0x53caa2(0x11f)](0x0,0xa)};}catch(_0x2bca0b){return console[_0x53caa2(0x137)](_0x53caa2(0x13e),_0x2bca0b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x45eb90(0x11b)](_0x6e19c=0x1e){const _0x1b8c10=a48_0x45eb90;try{const _0x59e662=fs_1[_0x1b8c10(0x129)][_0x1b8c10(0x12a)](this['logsDir']),_0x44e354=new Date();_0x44e354['setDate'](_0x44e354[_0x1b8c10(0x130)]()-_0x6e19c);let _0x415867=0x0;_0x59e662[_0x1b8c10(0xfd)](_0x2819fb=>{const _0xd08304=_0x1b8c10;if(!_0x2819fb[_0xd08304(0x105)](_0xd08304(0x10b)))return;const _0x470618=path_1[_0xd08304(0x129)]['join'](this[_0xd08304(0xf4)],_0x2819fb),_0x5847db=fs_1[_0xd08304(0x129)]['statSync'](_0x470618);_0x5847db[_0xd08304(0x133)]<_0x44e354&&(fs_1[_0xd08304(0x129)][_0xd08304(0xfb)](_0x470618),_0x415867++,console[_0xd08304(0x10f)](_0xd08304(0x118)+_0x2819fb));}),console[_0x1b8c10(0x10f)](_0x1b8c10(0x11e)+_0x415867+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x6e19c+_0x1b8c10(0x13a));}catch(_0x5a0bfd){console[_0x1b8c10(0x137)](_0x1b8c10(0x131),_0x5a0bfd);}}}exports[a48_0x45eb90(0x13d)]=LoggerService,exports[a48_0x45eb90(0xff)]=new LoggerService();