'use strict';const a70_0x16cce2=a70_0x24b8;(function(_0x22d764,_0x21eeec){const _0x4ac29c=a70_0x24b8,_0x24f651=_0x22d764();while(!![]){try{const _0x22243a=-parseInt(_0x4ac29c(0xb3))/0x1*(-parseInt(_0x4ac29c(0xab))/0x2)+-parseInt(_0x4ac29c(0xde))/0x3+-parseInt(_0x4ac29c(0xd3))/0x4+parseInt(_0x4ac29c(0xbe))/0x5*(parseInt(_0x4ac29c(0xc3))/0x6)+-parseInt(_0x4ac29c(0xdd))/0x7*(-parseInt(_0x4ac29c(0xaf))/0x8)+-parseInt(_0x4ac29c(0xe7))/0x9+-parseInt(_0x4ac29c(0xd6))/0xa;if(_0x22243a===_0x21eeec)break;else _0x24f651['push'](_0x24f651['shift']());}catch(_0xd004f7){_0x24f651['push'](_0x24f651['shift']());}}}(a70_0x3074,0x445ef));function a70_0x3074(){const _0xf1ec63=['payments_created','white_domain_responses','92146ezAdto','Failed\x20to\x20clean\x20old\x20logs:','join','Failed\x20to\x20write\x20','stack','slice','\x20old\x20log\x20files\x20(older\x20than\x20','API_CALL','logWhiteDomainRequest','split','unlinkSync','50325YXXOJl','forEach','mtime','filter','WEBHOOK_ERROR','6tFfblk','__esModule','shop_webhooks_errors','log','mkdirSync','message','__importDefault','Failed\x20to\x20get\x20log\x20stats:','logApiCall','.log','WEBHOOK_RECEIVED','logs','utf8','getLogFileName','length','PAYMENT_CREATED','1123432pmiBad','logWebhookReceived','readdirSync','312850AmhIdh','ensureLogsDirectory','logWebhookError','size','cleanOldLogs','statSync','ERROR','4739HWQplo','33918GTOrzi','COINTOPAY_STATUS_CHANGE','date','sort','logPaymentCreated','ðŸ§¹\x20Cleaned\x20','defineProperty','logsDir','toISOString','304569KOVaRb','REQUEST','appendFileSync','path','cointopay_errors','shop_webhooks_sent','white_domain_errors','WEBHOOK_PROCESSED','loggerService','logCoinToPayStatus','writeLog','default','logWebhookProcessed','\x20log:','ðŸ“\x20Created\x20logs\x20directory:\x20','setDate','10HjgRtZ','webhooks_errors','LoggerService','RESPONSE','1968mGHrSV','logShopWebhookError'];a70_0x3074=function(){return _0xf1ec63;};return a70_0x3074();}var __importDefault=this&&this[a70_0x16cce2(0xc9)]||function(_0x136398){const _0x422ed4=a70_0x16cce2;return _0x136398&&_0x136398[_0x422ed4(0xc4)]?_0x136398:{'default':_0x136398};};Object[a70_0x16cce2(0xe4)](exports,'__esModule',{'value':!![]}),exports[a70_0x16cce2(0xef)]=exports[a70_0x16cce2(0xad)]=void 0x0;function a70_0x24b8(_0x47f074,_0x22deb5){_0x47f074=_0x47f074-0xa9;const _0x3074ef=a70_0x3074();let _0x24b814=_0x3074ef[_0x47f074];return _0x24b814;}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a70_0x16cce2(0xea)));class LoggerService{constructor(){const _0x40209c=a70_0x16cce2;this[_0x40209c(0xe5)]=path_1[_0x40209c(0xf2)][_0x40209c(0xb5)](process['cwd'](),_0x40209c(0xce)),this[_0x40209c(0xd7)]();}[a70_0x16cce2(0xd7)](){const _0x30c693=a70_0x16cce2;!fs_1[_0x30c693(0xf2)]['existsSync'](this[_0x30c693(0xe5)])&&(fs_1['default'][_0x30c693(0xc7)](this[_0x30c693(0xe5)],{'recursive':!![]}),console[_0x30c693(0xc6)](_0x30c693(0xa9)+this['logsDir']));}[a70_0x16cce2(0xd0)](_0x2e0621){const _0x24f0e2=a70_0x16cce2,_0x912592=new Date()[_0x24f0e2(0xe6)]()[_0x24f0e2(0xbc)]('T')[0x0];return path_1[_0x24f0e2(0xf2)]['join'](this[_0x24f0e2(0xe5)],_0x2e0621+'_'+_0x912592+_0x24f0e2(0xcc));}[a70_0x16cce2(0xf1)](_0xe5f1fa,_0x237756){const _0x1c1d28=a70_0x16cce2;try{const _0x15ed97=new Date()['toISOString'](),_0x1382ac={'timestamp':_0x15ed97,..._0x237756},_0x372a17=JSON['stringify'](_0x1382ac)+'\x0a',_0x26046c=this[_0x1c1d28(0xd0)](_0xe5f1fa);fs_1[_0x1c1d28(0xf2)][_0x1c1d28(0xe9)](_0x26046c,_0x372a17,_0x1c1d28(0xcf));}catch(_0x1f5b72){console['error'](_0x1c1d28(0xb6)+_0xe5f1fa+_0x1c1d28(0xf4),_0x1f5b72);}}[a70_0x16cce2(0xbb)](_0x8a88dc,_0x30e087,_0x3e139c,_0x4ce998){const _0x2ceeb6=a70_0x16cce2;this[_0x2ceeb6(0xf1)]('white_domain_requests',{'type':_0x2ceeb6(0xe8),'gateway':_0x8a88dc,'endpoint':_0x30e087,'method':_0x3e139c,'data':_0x4ce998});}['logWhiteDomainResponse'](_0x91680d,_0x3ffc1e,_0x191250,_0x163489,_0x2e5344){const _0x2f1185=a70_0x16cce2;this[_0x2f1185(0xf1)](_0x2f1185(0xb2),{'type':_0x2f1185(0xae),'gateway':_0x91680d,'endpoint':_0x3ffc1e,'status':_0x191250,'responseTime':_0x2e5344,'data':_0x163489});}['logWhiteDomainError'](_0x1c55d3,_0x34a6f1,_0x4c6bbc){const _0x35c545=a70_0x16cce2;this[_0x35c545(0xf1)](_0x35c545(0xed),{'type':_0x35c545(0xdc),'gateway':_0x1c55d3,'endpoint':_0x34a6f1,'error':_0x4c6bbc instanceof Error?{'message':_0x4c6bbc['message'],'stack':_0x4c6bbc[_0x35c545(0xb7)]}:_0x4c6bbc});}[a70_0x16cce2(0xd4)](_0x5f181d,_0x187943,_0x57cfcd){const _0x5f2c4b=a70_0x16cce2;this['writeLog']('webhooks_received',{'type':_0x5f2c4b(0xcd),'gateway':_0x5f181d,'headers':_0x57cfcd,'data':_0x187943});}[a70_0x16cce2(0xf3)](_0x79539,_0x134af4,_0x45242a,_0x1c1536,_0x1e2fe0){const _0x28fd58=a70_0x16cce2;this[_0x28fd58(0xf1)]('webhooks_processed',{'type':_0x28fd58(0xee),'gateway':_0x79539,'paymentId':_0x134af4,'oldStatus':_0x45242a,'newStatus':_0x1c1536,'originalData':_0x1e2fe0});}[a70_0x16cce2(0xd8)](_0x11a468,_0x79d1d7,_0x9d018b){const _0x43457f=a70_0x16cce2;this[_0x43457f(0xf1)](_0x43457f(0xac),{'type':_0x43457f(0xc2),'gateway':_0x11a468,'error':_0x79d1d7 instanceof Error?{'message':_0x79d1d7[_0x43457f(0xc8)],'stack':_0x79d1d7[_0x43457f(0xb7)]}:_0x79d1d7,'originalData':_0x9d018b});}[a70_0x16cce2(0xf0)](_0x48eaa4){const _0x2fa08d=a70_0x16cce2;this[_0x2fa08d(0xf1)]('cointopay_status_changes',{'type':_0x2fa08d(0xdf),..._0x48eaa4});}['logCoinToPayError'](_0x180a5a){const _0x35dfaf=a70_0x16cce2;this[_0x35dfaf(0xf1)](_0x35dfaf(0xeb),{'type':'COINTOPAY_ERROR',..._0x180a5a});}['logShopWebhookSent'](_0x2f1e46,_0x1d0bf8,_0x32a9e2,_0x2a93ad,_0x7978c8,_0x264966){const _0x5b45ce=a70_0x16cce2;this[_0x5b45ce(0xf1)](_0x5b45ce(0xec),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x2f1e46,'webhookUrl':_0x1d0bf8,'event':_0x32a9e2,'status':_0x2a93ad,'responseTime':_0x7978c8,'payload':_0x264966});}[a70_0x16cce2(0xb0)](_0x14e7dd,_0x27332f,_0x616023,_0x178d06,_0xdbd2ab){const _0x5e9d11=a70_0x16cce2;this['writeLog'](_0x5e9d11(0xc5),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x14e7dd,'webhookUrl':_0x27332f,'event':_0x616023,'error':_0x178d06 instanceof Error?{'message':_0x178d06[_0x5e9d11(0xc8)],'stack':_0x178d06[_0x5e9d11(0xb7)]}:_0x178d06,'payload':_0xdbd2ab});}[a70_0x16cce2(0xe2)](_0x1c6232,_0x3bf251,_0x901841,_0x16b228,_0x3de65c){const _0x445cc2=a70_0x16cce2;this[_0x445cc2(0xf1)](_0x445cc2(0xb1),{'type':_0x445cc2(0xd2),'gateway':_0x1c6232,'paymentId':_0x3bf251,'shopId':_0x901841,'amount':_0x16b228,'currency':_0x3de65c});}[a70_0x16cce2(0xcb)](_0x4ba879,_0x4d5c16,_0x7efbaf,_0x40a50a,_0x37bd7c){const _0x1c9c91=a70_0x16cce2;this[_0x1c9c91(0xf1)]('api_calls',{'type':_0x1c9c91(0xba),'endpoint':_0x4ba879,'method':_0x4d5c16,'userId':_0x7efbaf,'userRole':_0x40a50a,'requestData':_0x37bd7c});}['getLogStats'](){const _0x2934c9=a70_0x16cce2;try{const _0x40402e=fs_1['default'][_0x2934c9(0xd5)](this[_0x2934c9(0xe5)]),_0x5e9bee=_0x40402e[_0x2934c9(0xc1)](_0x107e1c=>_0x107e1c['endsWith']('.log')),_0x498f92=[...new Set(_0x5e9bee['map'](_0x5324ae=>_0x5324ae[_0x2934c9(0xbc)]('_')[0x0]))],_0x313cc4=_0x5e9bee['map'](_0x5a1c0c=>{const _0x5bca3c=_0x2934c9,_0x1761f2=path_1[_0x5bca3c(0xf2)][_0x5bca3c(0xb5)](this[_0x5bca3c(0xe5)],_0x5a1c0c),_0x40c7c6=fs_1['default'][_0x5bca3c(0xdb)](_0x1761f2),[_0x2192d7,_0x189ef1]=_0x5a1c0c['replace'](_0x5bca3c(0xcc),'')[_0x5bca3c(0xbc)]('_');return{'type':_0x2192d7,'date':_0x189ef1,'size':_0x40c7c6[_0x5bca3c(0xd9)]};})[_0x2934c9(0xe1)]((_0x52acd3,_0x19f60b)=>_0x19f60b[_0x2934c9(0xe0)]['localeCompare'](_0x52acd3[_0x2934c9(0xe0)]));return{'totalFiles':_0x5e9bee[_0x2934c9(0xd1)],'logTypes':_0x498f92,'latestLogs':_0x313cc4[_0x2934c9(0xb8)](0x0,0xa)};}catch(_0x290613){return console['error'](_0x2934c9(0xca),_0x290613),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a70_0x16cce2(0xda)](_0x5bda48=0x1e){const _0x197faa=a70_0x16cce2;try{const _0x3d8bf6=fs_1[_0x197faa(0xf2)][_0x197faa(0xd5)](this[_0x197faa(0xe5)]),_0x110ceb=new Date();_0x110ceb[_0x197faa(0xaa)](_0x110ceb['getDate']()-_0x5bda48);let _0x422dc3=0x0;_0x3d8bf6[_0x197faa(0xbf)](_0x4fd745=>{const _0xb60006=_0x197faa;if(!_0x4fd745['endsWith'](_0xb60006(0xcc)))return;const _0x2875d0=path_1[_0xb60006(0xf2)][_0xb60006(0xb5)](this[_0xb60006(0xe5)],_0x4fd745),_0x408154=fs_1['default'][_0xb60006(0xdb)](_0x2875d0);_0x408154[_0xb60006(0xc0)]<_0x110ceb&&(fs_1[_0xb60006(0xf2)][_0xb60006(0xbd)](_0x2875d0),_0x422dc3++,console[_0xb60006(0xc6)]('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x4fd745));}),console[_0x197faa(0xc6)](_0x197faa(0xe3)+_0x422dc3+_0x197faa(0xb9)+_0x5bda48+'\x20days)');}catch(_0xb03d89){console['error'](_0x197faa(0xb4),_0xb03d89);}}}exports[a70_0x16cce2(0xad)]=LoggerService,exports[a70_0x16cce2(0xef)]=new LoggerService();