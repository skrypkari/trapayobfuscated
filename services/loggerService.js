'use strict';const a59_0x41ac0c=a59_0x50c8;function a59_0x130f(){const _0x263ff3=['ensureLogsDirectory','statSync','white_domain_responses','error','webhooks_processed','webhooks_errors','appendFileSync','cointopay_errors','loggerService','defineProperty','existsSync','shop_webhooks_errors','WEBHOOK_RECEIVED','🗑️\x20Deleted\x20old\x20log\x20file:\x20','cwd','setDate','mkdirSync','SHOP_WEBHOOK_SENT','logShopWebhookSent','forEach','1662560WaHwFl','6aFVeWu','message','158233rcdCWX','endsWith','COINTOPAY_STATUS_CHANGE','unlinkSync','replace','logCoinToPayStatus','1209316ewPuYm','REQUEST','toISOString','split','readdirSync','filter','\x20log:','107159qqyqwX','utf8','log','Failed\x20to\x20get\x20log\x20stats:','writeLog','cleanOldLogs','api_calls','Failed\x20to\x20write\x20','145WvzWvm','3828WPEbcb','white_domain_errors','logWhiteDomainResponse','\x20old\x20log\x20files\x20(older\x20than\x20','21AtLxtv','SHOP_WEBHOOK_ERROR','logCoinToPayError','Failed\x20to\x20clean\x20old\x20logs:','default','mtime','join','map','239574XzYIll','__esModule','logWebhookError','logWhiteDomainRequest','white_domain_requests','3719518PgfuUX','stringify','.log','webhooks_received','slice','size','localeCompare','🧹\x20Cleaned\x20','LoggerService','PAYMENT_CREATED','2ACffWE','logsDir','3357477IhKTnM','10gLMtki','WEBHOOK_PROCESSED','date','getLogStats','logWebhookProcessed','logApiCall','stack','__importDefault'];a59_0x130f=function(){return _0x263ff3;};return a59_0x130f();}(function(_0x384b5e,_0x23d6ab){const _0x163905=a59_0x50c8,_0x6dc8ea=_0x384b5e();while(!![]){try{const _0x45f4b3=parseInt(_0x163905(0x206))/0x1*(-parseInt(_0x163905(0x237))/0x2)+parseInt(_0x163905(0x204))/0x3*(-parseInt(_0x163905(0x20c))/0x4)+parseInt(_0x163905(0x21b))/0x5*(-parseInt(_0x163905(0x228))/0x6)+-parseInt(_0x163905(0x220))/0x7*(-parseInt(_0x163905(0x203))/0x8)+parseInt(_0x163905(0x239))/0x9*(-parseInt(_0x163905(0x23a))/0xa)+-parseInt(_0x163905(0x22d))/0xb+parseInt(_0x163905(0x21c))/0xc*(parseInt(_0x163905(0x213))/0xd);if(_0x45f4b3===_0x23d6ab)break;else _0x6dc8ea['push'](_0x6dc8ea['shift']());}catch(_0x352e48){_0x6dc8ea['push'](_0x6dc8ea['shift']());}}}(a59_0x130f,0x9799a));var __importDefault=this&&this[a59_0x41ac0c(0x1ee)]||function(_0x49b02b){return _0x49b02b&&_0x49b02b['__esModule']?_0x49b02b:{'default':_0x49b02b};};Object[a59_0x41ac0c(0x1f8)](exports,a59_0x41ac0c(0x229),{'value':!![]}),exports[a59_0x41ac0c(0x1f7)]=exports[a59_0x41ac0c(0x235)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x4d4a50=a59_0x41ac0c;this[_0x4d4a50(0x238)]=path_1[_0x4d4a50(0x224)]['join'](process[_0x4d4a50(0x1fd)](),'logs'),this[_0x4d4a50(0x1ef)]();}[a59_0x41ac0c(0x1ef)](){const _0x5cfbcc=a59_0x41ac0c;!fs_1[_0x5cfbcc(0x224)][_0x5cfbcc(0x1f9)](this[_0x5cfbcc(0x238)])&&(fs_1[_0x5cfbcc(0x224)][_0x5cfbcc(0x1ff)](this[_0x5cfbcc(0x238)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x5cfbcc(0x238)]));}['getLogFileName'](_0x16979a){const _0x1fb511=a59_0x41ac0c,_0x32c5e2=new Date()[_0x1fb511(0x20e)]()[_0x1fb511(0x20f)]('T')[0x0];return path_1[_0x1fb511(0x224)][_0x1fb511(0x226)](this['logsDir'],_0x16979a+'_'+_0x32c5e2+_0x1fb511(0x22f));}[a59_0x41ac0c(0x217)](_0x5e885d,_0x545ea3){const _0x3a511f=a59_0x41ac0c;try{const _0x3a8ca1=new Date()[_0x3a511f(0x20e)](),_0x25294d={'timestamp':_0x3a8ca1,..._0x545ea3},_0x23871c=JSON[_0x3a511f(0x22e)](_0x25294d)+'\x0a',_0x14b836=this['getLogFileName'](_0x5e885d);fs_1['default'][_0x3a511f(0x1f5)](_0x14b836,_0x23871c,_0x3a511f(0x214));}catch(_0x5729f2){console['error'](_0x3a511f(0x21a)+_0x5e885d+_0x3a511f(0x212),_0x5729f2);}}[a59_0x41ac0c(0x22b)](_0x17d927,_0x4e0632,_0x9edf1c,_0x25b8ca){const _0x5457ed=a59_0x41ac0c;this[_0x5457ed(0x217)](_0x5457ed(0x22c),{'type':_0x5457ed(0x20d),'gateway':_0x17d927,'endpoint':_0x4e0632,'method':_0x9edf1c,'data':_0x25b8ca});}[a59_0x41ac0c(0x21e)](_0x4f38b8,_0x356b0b,_0x2d31e6,_0x54a602,_0x1802cc){const _0x57dd53=a59_0x41ac0c;this[_0x57dd53(0x217)](_0x57dd53(0x1f1),{'type':'RESPONSE','gateway':_0x4f38b8,'endpoint':_0x356b0b,'status':_0x2d31e6,'responseTime':_0x1802cc,'data':_0x54a602});}['logWhiteDomainError'](_0x4acde7,_0x2f76f6,_0x22bf96){const _0x1d5ed4=a59_0x41ac0c;this['writeLog'](_0x1d5ed4(0x21d),{'type':'ERROR','gateway':_0x4acde7,'endpoint':_0x2f76f6,'error':_0x22bf96 instanceof Error?{'message':_0x22bf96['message'],'stack':_0x22bf96[_0x1d5ed4(0x1ed)]}:_0x22bf96});}['logWebhookReceived'](_0x443b3c,_0x25f9fd,_0x111eb4){const _0x493742=a59_0x41ac0c;this['writeLog'](_0x493742(0x230),{'type':_0x493742(0x1fb),'gateway':_0x443b3c,'headers':_0x111eb4,'data':_0x25f9fd});}[a59_0x41ac0c(0x1eb)](_0x2b23d6,_0x3752c6,_0x2c429b,_0x28e62b,_0x23bacb){const _0x3b868c=a59_0x41ac0c;this['writeLog'](_0x3b868c(0x1f3),{'type':_0x3b868c(0x1e8),'gateway':_0x2b23d6,'paymentId':_0x3752c6,'oldStatus':_0x2c429b,'newStatus':_0x28e62b,'originalData':_0x23bacb});}[a59_0x41ac0c(0x22a)](_0x5ce212,_0xfa771f,_0x337a02){const _0x32158c=a59_0x41ac0c;this[_0x32158c(0x217)](_0x32158c(0x1f4),{'type':'WEBHOOK_ERROR','gateway':_0x5ce212,'error':_0xfa771f instanceof Error?{'message':_0xfa771f[_0x32158c(0x205)],'stack':_0xfa771f[_0x32158c(0x1ed)]}:_0xfa771f,'originalData':_0x337a02});}[a59_0x41ac0c(0x20b)](_0x59b88f){const _0x42b200=a59_0x41ac0c;this[_0x42b200(0x217)]('cointopay_status_changes',{'type':_0x42b200(0x208),..._0x59b88f});}[a59_0x41ac0c(0x222)](_0x1abf04){const _0xc8863a=a59_0x41ac0c;this[_0xc8863a(0x217)](_0xc8863a(0x1f6),{'type':'COINTOPAY_ERROR',..._0x1abf04});}[a59_0x41ac0c(0x201)](_0x38e8d0,_0x9e6166,_0x26225c,_0x125f6f,_0x236008,_0xde1ca4){const _0xccefc7=a59_0x41ac0c;this[_0xccefc7(0x217)]('shop_webhooks_sent',{'type':_0xccefc7(0x200),'shopId':_0x38e8d0,'webhookUrl':_0x9e6166,'event':_0x26225c,'status':_0x125f6f,'responseTime':_0x236008,'payload':_0xde1ca4});}['logShopWebhookError'](_0x5498ee,_0x78f5c1,_0x55b327,_0x2fc620,_0x2c8bbd){const _0x17ebc4=a59_0x41ac0c;this['writeLog'](_0x17ebc4(0x1fa),{'type':_0x17ebc4(0x221),'shopId':_0x5498ee,'webhookUrl':_0x78f5c1,'event':_0x55b327,'error':_0x2fc620 instanceof Error?{'message':_0x2fc620['message'],'stack':_0x2fc620[_0x17ebc4(0x1ed)]}:_0x2fc620,'payload':_0x2c8bbd});}['logPaymentCreated'](_0x41821e,_0x2cb027,_0x2de5c0,_0x21f6b9,_0x4dc6d0){const _0x4129e0=a59_0x41ac0c;this['writeLog']('payments_created',{'type':_0x4129e0(0x236),'gateway':_0x41821e,'paymentId':_0x2cb027,'shopId':_0x2de5c0,'amount':_0x21f6b9,'currency':_0x4dc6d0});}[a59_0x41ac0c(0x1ec)](_0x4bbfd3,_0x2c7a43,_0x427243,_0x579ad0,_0x2da5c6){const _0x2c20f5=a59_0x41ac0c;this[_0x2c20f5(0x217)](_0x2c20f5(0x219),{'type':'API_CALL','endpoint':_0x4bbfd3,'method':_0x2c7a43,'userId':_0x427243,'userRole':_0x579ad0,'requestData':_0x2da5c6});}[a59_0x41ac0c(0x1ea)](){const _0x25a821=a59_0x41ac0c;try{const _0x4faf64=fs_1[_0x25a821(0x224)][_0x25a821(0x210)](this[_0x25a821(0x238)]),_0x394b20=_0x4faf64[_0x25a821(0x211)](_0xeeff42=>_0xeeff42['endsWith']('.log')),_0x16569d=[...new Set(_0x394b20['map'](_0x405b08=>_0x405b08[_0x25a821(0x20f)]('_')[0x0]))],_0x3a0749=_0x394b20[_0x25a821(0x227)](_0x5e70e3=>{const _0x3a1cca=_0x25a821,_0x59ddbb=path_1[_0x3a1cca(0x224)]['join'](this['logsDir'],_0x5e70e3),_0x48132c=fs_1[_0x3a1cca(0x224)][_0x3a1cca(0x1f0)](_0x59ddbb),[_0x499a44,_0x1b48a1]=_0x5e70e3[_0x3a1cca(0x20a)](_0x3a1cca(0x22f),'')[_0x3a1cca(0x20f)]('_');return{'type':_0x499a44,'date':_0x1b48a1,'size':_0x48132c[_0x3a1cca(0x232)]};})['sort']((_0x2310b9,_0x340974)=>_0x340974[_0x25a821(0x1e9)][_0x25a821(0x233)](_0x2310b9[_0x25a821(0x1e9)]));return{'totalFiles':_0x394b20['length'],'logTypes':_0x16569d,'latestLogs':_0x3a0749[_0x25a821(0x231)](0x0,0xa)};}catch(_0x158ab0){return console['error'](_0x25a821(0x216),_0x158ab0),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x41ac0c(0x218)](_0x2b2075=0x1e){const _0x1cb038=a59_0x41ac0c;try{const _0x330441=fs_1[_0x1cb038(0x224)]['readdirSync'](this['logsDir']),_0x48d567=new Date();_0x48d567[_0x1cb038(0x1fe)](_0x48d567['getDate']()-_0x2b2075);let _0x2d3b06=0x0;_0x330441[_0x1cb038(0x202)](_0x1ff4e9=>{const _0x31b20c=_0x1cb038;if(!_0x1ff4e9[_0x31b20c(0x207)]('.log'))return;const _0x686620=path_1[_0x31b20c(0x224)][_0x31b20c(0x226)](this[_0x31b20c(0x238)],_0x1ff4e9),_0x2b7326=fs_1[_0x31b20c(0x224)][_0x31b20c(0x1f0)](_0x686620);_0x2b7326[_0x31b20c(0x225)]<_0x48d567&&(fs_1[_0x31b20c(0x224)][_0x31b20c(0x209)](_0x686620),_0x2d3b06++,console['log'](_0x31b20c(0x1fc)+_0x1ff4e9));}),console[_0x1cb038(0x215)](_0x1cb038(0x234)+_0x2d3b06+_0x1cb038(0x21f)+_0x2b2075+'\x20days)');}catch(_0x2e2f84){console[_0x1cb038(0x1f2)](_0x1cb038(0x223),_0x2e2f84);}}}function a59_0x50c8(_0x4e70d3,_0x231439){const _0x130f25=a59_0x130f();return a59_0x50c8=function(_0x50c81f,_0x3548f1){_0x50c81f=_0x50c81f-0x1e8;let _0x3d2cd5=_0x130f25[_0x50c81f];return _0x3d2cd5;},a59_0x50c8(_0x4e70d3,_0x231439);}exports[a59_0x41ac0c(0x235)]=LoggerService,exports[a59_0x41ac0c(0x1f7)]=new LoggerService();