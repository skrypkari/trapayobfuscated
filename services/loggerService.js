'use strict';const a48_0x338bff=a48_0x5070;(function(_0x2a325f,_0xa1cb45){const _0x1f57f2=a48_0x5070,_0x79a33c=_0x2a325f();while(!![]){try{const _0x59ddde=-parseInt(_0x1f57f2(0x171))/0x1+-parseInt(_0x1f57f2(0x161))/0x2*(-parseInt(_0x1f57f2(0x186))/0x3)+-parseInt(_0x1f57f2(0x166))/0x4*(parseInt(_0x1f57f2(0x15e))/0x5)+-parseInt(_0x1f57f2(0x16d))/0x6+parseInt(_0x1f57f2(0x190))/0x7*(-parseInt(_0x1f57f2(0x14f))/0x8)+parseInt(_0x1f57f2(0x15c))/0x9*(parseInt(_0x1f57f2(0x14a))/0xa)+parseInt(_0x1f57f2(0x182))/0xb;if(_0x59ddde===_0xa1cb45)break;else _0x79a33c['push'](_0x79a33c['shift']());}catch(_0x5a5557){_0x79a33c['push'](_0x79a33c['shift']());}}}(a48_0x40d1,0x96503));function a48_0x5070(_0x298691,_0x566a44){const _0x40d1a4=a48_0x40d1();return a48_0x5070=function(_0x507068,_0x27fa1e){_0x507068=_0x507068-0x14a;let _0xa55872=_0x40d1a4[_0x507068];return _0xa55872;},a48_0x5070(_0x298691,_0x566a44);}var __importDefault=this&&this[a48_0x338bff(0x183)]||function(_0x14efd8){const _0x24231a=a48_0x338bff;return _0x14efd8&&_0x14efd8[_0x24231a(0x17d)]?_0x14efd8:{'default':_0x14efd8};};Object[a48_0x338bff(0x173)](exports,a48_0x338bff(0x17d),{'value':!![]}),exports[a48_0x338bff(0x180)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x338bff(0x187)));class LoggerService{constructor(){const _0x36d5a5=a48_0x338bff;this['logsDir']=path_1[_0x36d5a5(0x14b)]['join'](process[_0x36d5a5(0x162)](),_0x36d5a5(0x19d)),this['ensureLogsDirectory']();}[a48_0x338bff(0x17b)](){const _0x10225e=a48_0x338bff;!fs_1[_0x10225e(0x14b)][_0x10225e(0x16f)](this['logsDir'])&&(fs_1[_0x10225e(0x14b)][_0x10225e(0x174)](this[_0x10225e(0x168)],{'recursive':!![]}),console[_0x10225e(0x18f)](_0x10225e(0x14d)+this[_0x10225e(0x168)]));}['getLogFileName'](_0x5a85c7){const _0x2d0e1c=a48_0x338bff,_0x5af909=new Date()[_0x2d0e1c(0x19c)]()[_0x2d0e1c(0x163)]('T')[0x0];return path_1[_0x2d0e1c(0x14b)]['join'](this['logsDir'],_0x5a85c7+'_'+_0x5af909+_0x2d0e1c(0x199));}['writeLog'](_0x59440a,_0x1e126b){const _0x2239e6=a48_0x338bff;try{const _0xac4a33=new Date()['toISOString'](),_0x39a97c={'timestamp':_0xac4a33,..._0x1e126b},_0x28c16c=JSON['stringify'](_0x39a97c)+'\x0a',_0x2c78bb=this[_0x2239e6(0x192)](_0x59440a);fs_1[_0x2239e6(0x14b)][_0x2239e6(0x19b)](_0x2c78bb,_0x28c16c,'utf8');}catch(_0x12cb3e){console[_0x2239e6(0x193)](_0x2239e6(0x177)+_0x59440a+_0x2239e6(0x15b),_0x12cb3e);}}[a48_0x338bff(0x160)](_0x51089d,_0x4b41ff,_0x43370b,_0x2af50b){const _0x27812b=a48_0x338bff;this[_0x27812b(0x150)](_0x27812b(0x16b),{'type':_0x27812b(0x179),'gateway':_0x51089d,'endpoint':_0x4b41ff,'method':_0x43370b,'data':_0x2af50b});}[a48_0x338bff(0x172)](_0x10e0d5,_0x2fdea8,_0x50b07b,_0x52167c,_0x3d74bb){const _0x3fae52=a48_0x338bff;this[_0x3fae52(0x150)](_0x3fae52(0x170),{'type':'RESPONSE','gateway':_0x10e0d5,'endpoint':_0x2fdea8,'status':_0x50b07b,'responseTime':_0x3d74bb,'data':_0x52167c});}[a48_0x338bff(0x159)](_0x18c7f2,_0x19bef7,_0x2b2aa9){const _0x3daf97=a48_0x338bff;this[_0x3daf97(0x150)](_0x3daf97(0x195),{'type':'ERROR','gateway':_0x18c7f2,'endpoint':_0x19bef7,'error':_0x2b2aa9 instanceof Error?{'message':_0x2b2aa9[_0x3daf97(0x185)],'stack':_0x2b2aa9[_0x3daf97(0x158)]}:_0x2b2aa9});}[a48_0x338bff(0x18d)](_0x341733,_0xdda496,_0x15a52a){const _0x5eac5c=a48_0x338bff;this[_0x5eac5c(0x150)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x341733,'headers':_0x15a52a,'data':_0xdda496});}[a48_0x338bff(0x153)](_0x111c62,_0x52ec11,_0x55cce2,_0x289bb8,_0x3a6af2){const _0x4d983b=a48_0x338bff;this[_0x4d983b(0x150)](_0x4d983b(0x188),{'type':'WEBHOOK_PROCESSED','gateway':_0x111c62,'paymentId':_0x52ec11,'oldStatus':_0x55cce2,'newStatus':_0x289bb8,'originalData':_0x3a6af2});}[a48_0x338bff(0x154)](_0x55f356,_0x40240e,_0x1050a6){const _0x21ef39=a48_0x338bff;this[_0x21ef39(0x150)](_0x21ef39(0x18b),{'type':_0x21ef39(0x189),'gateway':_0x55f356,'error':_0x40240e instanceof Error?{'message':_0x40240e[_0x21ef39(0x185)],'stack':_0x40240e[_0x21ef39(0x158)]}:_0x40240e,'originalData':_0x1050a6});}[a48_0x338bff(0x17e)](_0x3a6364){const _0x37c927=a48_0x338bff;this['writeLog'](_0x37c927(0x176),{'type':'COINTOPAY_STATUS_CHANGE',..._0x3a6364});}['logCoinToPayError'](_0x17bf63){const _0x316b20=a48_0x338bff;this['writeLog'](_0x316b20(0x19a),{'type':_0x316b20(0x198),..._0x17bf63});}[a48_0x338bff(0x18e)](_0x17c37c,_0x459f1f,_0x1e6cf3,_0xcf8a7e,_0x5502f7,_0x3e1594){const _0x18953d=a48_0x338bff;this['writeLog'](_0x18953d(0x15a),{'type':_0x18953d(0x165),'shopId':_0x17c37c,'webhookUrl':_0x459f1f,'event':_0x1e6cf3,'status':_0xcf8a7e,'responseTime':_0x5502f7,'payload':_0x3e1594});}[a48_0x338bff(0x178)](_0x41e76b,_0x38fc93,_0x1b8372,_0x334c4f,_0x483586){const _0x2bbc8e=a48_0x338bff;this[_0x2bbc8e(0x150)](_0x2bbc8e(0x17f),{'type':_0x2bbc8e(0x16a),'shopId':_0x41e76b,'webhookUrl':_0x38fc93,'event':_0x1b8372,'error':_0x334c4f instanceof Error?{'message':_0x334c4f[_0x2bbc8e(0x185)],'stack':_0x334c4f[_0x2bbc8e(0x158)]}:_0x334c4f,'payload':_0x483586});}[a48_0x338bff(0x169)](_0x371faf,_0x13ad95,_0x150172,_0x2b5211,_0x5933ef){const _0x9cd227=a48_0x338bff;this[_0x9cd227(0x150)]('payments_created',{'type':_0x9cd227(0x157),'gateway':_0x371faf,'paymentId':_0x13ad95,'shopId':_0x150172,'amount':_0x2b5211,'currency':_0x5933ef});}[a48_0x338bff(0x156)](_0x4b8fde,_0x4bd4db,_0x38e4c1,_0x330d9f,_0x63b83){const _0xbb479a=a48_0x338bff;this[_0xbb479a(0x150)](_0xbb479a(0x197),{'type':_0xbb479a(0x181),'endpoint':_0x4b8fde,'method':_0x4bd4db,'userId':_0x38e4c1,'userRole':_0x330d9f,'requestData':_0x63b83});}[a48_0x338bff(0x16c)](){const _0x436e89=a48_0x338bff;try{const _0x26593b=fs_1['default'][_0x436e89(0x151)](this[_0x436e89(0x168)]),_0x466fe3=_0x26593b[_0x436e89(0x191)](_0x329ca3=>_0x329ca3[_0x436e89(0x164)](_0x436e89(0x199))),_0x767071=[...new Set(_0x466fe3['map'](_0x39a11c=>_0x39a11c[_0x436e89(0x163)]('_')[0x0]))],_0x4d42ce=_0x466fe3['map'](_0x423c0b=>{const _0x5377d9=_0x436e89,_0x458f7e=path_1[_0x5377d9(0x14b)][_0x5377d9(0x18c)](this['logsDir'],_0x423c0b),_0x195d5f=fs_1[_0x5377d9(0x14b)][_0x5377d9(0x194)](_0x458f7e),[_0x5a80b2,_0x5dc58c]=_0x423c0b['replace'](_0x5377d9(0x199),'')[_0x5377d9(0x163)]('_');return{'type':_0x5a80b2,'date':_0x5dc58c,'size':_0x195d5f[_0x5377d9(0x167)]};})[_0x436e89(0x14e)]((_0x3a0d66,_0x533b0e)=>_0x533b0e['date'][_0x436e89(0x15f)](_0x3a0d66[_0x436e89(0x15d)]));return{'totalFiles':_0x466fe3[_0x436e89(0x175)],'logTypes':_0x767071,'latestLogs':_0x4d42ce[_0x436e89(0x184)](0x0,0xa)};}catch(_0x2333cf){return console[_0x436e89(0x193)](_0x436e89(0x155),_0x2333cf),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x338bff(0x196)](_0x222fc8=0x1e){const _0x2e4c1e=a48_0x338bff;try{const _0x4d1fb2=fs_1[_0x2e4c1e(0x14b)][_0x2e4c1e(0x151)](this[_0x2e4c1e(0x168)]),_0xe3cb8f=new Date();_0xe3cb8f['setDate'](_0xe3cb8f['getDate']()-_0x222fc8);let _0x17e29d=0x0;_0x4d1fb2['forEach'](_0x5557f8=>{const _0x2e9e90=_0x2e4c1e;if(!_0x5557f8[_0x2e9e90(0x164)](_0x2e9e90(0x199)))return;const _0x42f35c=path_1[_0x2e9e90(0x14b)][_0x2e9e90(0x18c)](this[_0x2e9e90(0x168)],_0x5557f8),_0x14f8b3=fs_1['default'][_0x2e9e90(0x194)](_0x42f35c);_0x14f8b3[_0x2e9e90(0x152)]<_0xe3cb8f&&(fs_1[_0x2e9e90(0x14b)][_0x2e9e90(0x18a)](_0x42f35c),_0x17e29d++,console['log'](_0x2e9e90(0x16e)+_0x5557f8));}),console['log'](_0x2e4c1e(0x17c)+_0x17e29d+_0x2e4c1e(0x14c)+_0x222fc8+'\x20days)');}catch(_0x5b3538){console[_0x2e4c1e(0x193)]('Failed\x20to\x20clean\x20old\x20logs:',_0x5b3538);}}}function a48_0x40d1(){const _0x17f3d4=['cointopay_status_changes','Failed\x20to\x20write\x20','logShopWebhookError','REQUEST','LoggerService','ensureLogsDirectory','🧹\x20Cleaned\x20','__esModule','logCoinToPayStatus','shop_webhooks_errors','loggerService','API_CALL','23109185hScKMf','__importDefault','slice','message','2711172rseshl','path','webhooks_processed','WEBHOOK_ERROR','unlinkSync','webhooks_errors','join','logWebhookReceived','logShopWebhookSent','log','14NpqvMo','filter','getLogFileName','error','statSync','white_domain_errors','cleanOldLogs','api_calls','COINTOPAY_ERROR','.log','cointopay_errors','appendFileSync','toISOString','logs','4381330VXUuOU','default','\x20old\x20log\x20files\x20(older\x20than\x20','📁\x20Created\x20logs\x20directory:\x20','sort','1853816ZQndsE','writeLog','readdirSync','mtime','logWebhookProcessed','logWebhookError','Failed\x20to\x20get\x20log\x20stats:','logApiCall','PAYMENT_CREATED','stack','logWhiteDomainError','shop_webhooks_sent','\x20log:','18PjHHsg','date','10EaqNQL','localeCompare','logWhiteDomainRequest','2rlFosm','cwd','split','endsWith','SHOP_WEBHOOK_SENT','1847980XDneCX','size','logsDir','logPaymentCreated','SHOP_WEBHOOK_ERROR','white_domain_requests','getLogStats','4142448guTlYY','🗑️\x20Deleted\x20old\x20log\x20file:\x20','existsSync','white_domain_responses','1187290VxphvU','logWhiteDomainResponse','defineProperty','mkdirSync','length'];a48_0x40d1=function(){return _0x17f3d4;};return a48_0x40d1();}exports[a48_0x338bff(0x17a)]=LoggerService,exports[a48_0x338bff(0x180)]=new LoggerService();