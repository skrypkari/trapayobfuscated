'use strict';const a48_0x5ce2f0=a48_0x2113;(function(_0x963ca5,_0x5f5899){const _0x461b47=a48_0x2113,_0x5b939e=_0x963ca5();while(!![]){try{const _0x30ff77=parseInt(_0x461b47(0xf3))/0x1*(-parseInt(_0x461b47(0xbd))/0x2)+parseInt(_0x461b47(0xce))/0x3*(parseInt(_0x461b47(0xb9))/0x4)+-parseInt(_0x461b47(0xd5))/0x5+parseInt(_0x461b47(0xdd))/0x6*(parseInt(_0x461b47(0xdf))/0x7)+parseInt(_0x461b47(0xcc))/0x8*(parseInt(_0x461b47(0xc8))/0x9)+-parseInt(_0x461b47(0x103))/0xa+parseInt(_0x461b47(0xcf))/0xb;if(_0x30ff77===_0x5f5899)break;else _0x5b939e['push'](_0x5b939e['shift']());}catch(_0x454b5c){_0x5b939e['push'](_0x5b939e['shift']());}}}(a48_0x2de3,0x94c60));var __importDefault=this&&this['__importDefault']||function(_0x2cc8c5){const _0x143585=a48_0x2113;return _0x2cc8c5&&_0x2cc8c5[_0x143585(0xe6)]?_0x2cc8c5:{'default':_0x2cc8c5};};Object[a48_0x5ce2f0(0xd2)](exports,a48_0x5ce2f0(0xe6),{'value':!![]}),exports[a48_0x5ce2f0(0xc4)]=exports[a48_0x5ce2f0(0xc3)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x5ce2f0(0xdc)));class LoggerService{constructor(){const _0x38f5e6=a48_0x5ce2f0;this['logsDir']=path_1['default'][_0x38f5e6(0xf9)](process[_0x38f5e6(0x105)](),'logs'),this['ensureLogsDirectory']();}[a48_0x5ce2f0(0xf8)](){const _0x40230f=a48_0x5ce2f0;!fs_1[_0x40230f(0xe3)]['existsSync'](this['logsDir'])&&(fs_1['default']['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x40230f(0xff)](_0x40230f(0xe2)+this[_0x40230f(0xc1)]));}[a48_0x5ce2f0(0xba)](_0x2c2dbf){const _0x4540f0=a48_0x5ce2f0,_0x1be22d=new Date()[_0x4540f0(0xed)]()[_0x4540f0(0xd4)]('T')[0x0];return path_1[_0x4540f0(0xe3)][_0x4540f0(0xf9)](this[_0x4540f0(0xc1)],_0x2c2dbf+'_'+_0x1be22d+_0x4540f0(0xc6));}[a48_0x5ce2f0(0xd6)](_0xbca3f8,_0x3ab840){const _0x3378fe=a48_0x5ce2f0;try{const _0x22f09f=new Date()[_0x3378fe(0xed)](),_0x223d0b={'timestamp':_0x22f09f,..._0x3ab840},_0x24ff93=JSON[_0x3378fe(0x104)](_0x223d0b)+'\x0a',_0x26279a=this[_0x3378fe(0xba)](_0xbca3f8);fs_1[_0x3378fe(0xe3)][_0x3378fe(0xbc)](_0x26279a,_0x24ff93,_0x3378fe(0xe0));}catch(_0x383beb){console[_0x3378fe(0xbe)](_0x3378fe(0xe1)+_0xbca3f8+'\x20log:',_0x383beb);}}[a48_0x5ce2f0(0xc7)](_0x1e9755,_0x21fbe6,_0x334f81,_0x5df96e){const _0x46cb72=a48_0x5ce2f0;this[_0x46cb72(0xd6)](_0x46cb72(0xf1),{'type':_0x46cb72(0xc5),'gateway':_0x1e9755,'endpoint':_0x21fbe6,'method':_0x334f81,'data':_0x5df96e});}[a48_0x5ce2f0(0x100)](_0x45ec6a,_0x55f17b,_0x319c57,_0x19684d,_0x4529ee){const _0x314879=a48_0x5ce2f0;this[_0x314879(0xd6)](_0x314879(0xc0),{'type':'RESPONSE','gateway':_0x45ec6a,'endpoint':_0x55f17b,'status':_0x319c57,'responseTime':_0x4529ee,'data':_0x19684d});}[a48_0x5ce2f0(0xf6)](_0x2937de,_0x479a12,_0x596f6b){const _0x4ec754=a48_0x5ce2f0;this[_0x4ec754(0xd6)]('white_domain_errors',{'type':_0x4ec754(0xf2),'gateway':_0x2937de,'endpoint':_0x479a12,'error':_0x596f6b instanceof Error?{'message':_0x596f6b['message'],'stack':_0x596f6b[_0x4ec754(0xd1)]}:_0x596f6b});}[a48_0x5ce2f0(0xe7)](_0x56920c,_0x2e7f24,_0x28e4de){const _0x1ea178=a48_0x5ce2f0;this[_0x1ea178(0xd6)](_0x1ea178(0xe9),{'type':'WEBHOOK_RECEIVED','gateway':_0x56920c,'headers':_0x28e4de,'data':_0x2e7f24});}[a48_0x5ce2f0(0xfe)](_0x5e08b5,_0x403fcc,_0x1e4f88,_0x233037,_0x411bee){this['writeLog']('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x5e08b5,'paymentId':_0x403fcc,'oldStatus':_0x1e4f88,'newStatus':_0x233037,'originalData':_0x411bee});}['logWebhookError'](_0x95afbd,_0x571ba3,_0x26e024){const _0x205c58=a48_0x5ce2f0;this['writeLog']('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x95afbd,'error':_0x571ba3 instanceof Error?{'message':_0x571ba3[_0x205c58(0xbb)],'stack':_0x571ba3[_0x205c58(0xd1)]}:_0x571ba3,'originalData':_0x26e024});}[a48_0x5ce2f0(0xf5)](_0x11b997){const _0x181d68=a48_0x5ce2f0;this['writeLog'](_0x181d68(0xd7),{'type':'COINTOPAY_STATUS_CHANGE',..._0x11b997});}[a48_0x5ce2f0(0xf0)](_0x54e36f){const _0x498e59=a48_0x5ce2f0;this[_0x498e59(0xd6)]('cointopay_errors',{'type':_0x498e59(0xee),..._0x54e36f});}[a48_0x5ce2f0(0xd0)](_0x57084c,_0x122f5a,_0x3ba69a,_0x8eadc7,_0x5b0899,_0x1de8fd){const _0x571c63=a48_0x5ce2f0;this[_0x571c63(0xd6)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x57084c,'webhookUrl':_0x122f5a,'event':_0x3ba69a,'status':_0x8eadc7,'responseTime':_0x5b0899,'payload':_0x1de8fd});}[a48_0x5ce2f0(0xb8)](_0x112e70,_0x33ba5e,_0x3f12a6,_0x1e4d8b,_0x531a7b){const _0x1eed91=a48_0x5ce2f0;this[_0x1eed91(0xd6)](_0x1eed91(0xbf),{'type':_0x1eed91(0xef),'shopId':_0x112e70,'webhookUrl':_0x33ba5e,'event':_0x3f12a6,'error':_0x1e4d8b instanceof Error?{'message':_0x1e4d8b[_0x1eed91(0xbb)],'stack':_0x1e4d8b[_0x1eed91(0xd1)]}:_0x1e4d8b,'payload':_0x531a7b});}[a48_0x5ce2f0(0xd8)](_0x480886,_0x81257a,_0xaccca4,_0x18c0e1,_0x9f7595){const _0x3ee1e9=a48_0x5ce2f0;this[_0x3ee1e9(0xd6)](_0x3ee1e9(0xde),{'type':_0x3ee1e9(0xcb),'gateway':_0x480886,'paymentId':_0x81257a,'shopId':_0xaccca4,'amount':_0x18c0e1,'currency':_0x9f7595});}[a48_0x5ce2f0(0xf7)](_0x318000,_0x5922d4,_0x23a0b8,_0xc6473b,_0x28a188){const _0xf7c6de=a48_0x5ce2f0;this[_0xf7c6de(0xd6)](_0xf7c6de(0xc2),{'type':_0xf7c6de(0xec),'endpoint':_0x318000,'method':_0x5922d4,'userId':_0x23a0b8,'userRole':_0xc6473b,'requestData':_0x28a188});}[a48_0x5ce2f0(0xca)](){const _0x1df234=a48_0x5ce2f0;try{const _0x3734a7=fs_1[_0x1df234(0xe3)][_0x1df234(0xd9)](this[_0x1df234(0xc1)]),_0x372c84=_0x3734a7[_0x1df234(0xfb)](_0x1488f0=>_0x1488f0['endsWith']('.log')),_0x4fd70e=[...new Set(_0x372c84[_0x1df234(0xcd)](_0x387a3e=>_0x387a3e[_0x1df234(0xd4)]('_')[0x0]))],_0x46b5c4=_0x372c84[_0x1df234(0xcd)](_0x470481=>{const _0x5c738d=_0x1df234,_0xcfbeac=path_1[_0x5c738d(0xe3)][_0x5c738d(0xf9)](this['logsDir'],_0x470481),_0x51f079=fs_1[_0x5c738d(0xe3)][_0x5c738d(0xeb)](_0xcfbeac),[_0x31d454,_0x2f3619]=_0x470481[_0x5c738d(0xea)]('.log','')[_0x5c738d(0xd4)]('_');return{'type':_0x31d454,'date':_0x2f3619,'size':_0x51f079[_0x5c738d(0xfa)]};})['sort']((_0x28c4b9,_0x28aae4)=>_0x28aae4[_0x1df234(0xc9)][_0x1df234(0xfc)](_0x28c4b9['date']));return{'totalFiles':_0x372c84[_0x1df234(0xe8)],'logTypes':_0x4fd70e,'latestLogs':_0x46b5c4[_0x1df234(0xd3)](0x0,0xa)};}catch(_0x3021d5){return console['error'](_0x1df234(0xf4),_0x3021d5),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x48160f=0x1e){const _0x4a3d1d=a48_0x5ce2f0;try{const _0x4054a2=fs_1[_0x4a3d1d(0xe3)][_0x4a3d1d(0xd9)](this[_0x4a3d1d(0xc1)]),_0x320c61=new Date();_0x320c61[_0x4a3d1d(0xfd)](_0x320c61[_0x4a3d1d(0x102)]()-_0x48160f);let _0x49e86e=0x0;_0x4054a2['forEach'](_0x473275=>{const _0x4e4e4d=_0x4a3d1d;if(!_0x473275[_0x4e4e4d(0xda)](_0x4e4e4d(0xc6)))return;const _0x310163=path_1[_0x4e4e4d(0xe3)][_0x4e4e4d(0xf9)](this['logsDir'],_0x473275),_0xc33c37=fs_1[_0x4e4e4d(0xe3)][_0x4e4e4d(0xeb)](_0x310163);_0xc33c37[_0x4e4e4d(0x101)]<_0x320c61&&(fs_1[_0x4e4e4d(0xe3)]['unlinkSync'](_0x310163),_0x49e86e++,console[_0x4e4e4d(0xff)](_0x4e4e4d(0xdb)+_0x473275));}),console['log']('🧹\x20Cleaned\x20'+_0x49e86e+_0x4a3d1d(0xe5)+_0x48160f+'\x20days)');}catch(_0x2260da){console[_0x4a3d1d(0xbe)](_0x4a3d1d(0xe4),_0x2260da);}}}function a48_0x2113(_0x15b551,_0x2d4669){const _0x2de34c=a48_0x2de3();return a48_0x2113=function(_0x21132e,_0x5b1c07){_0x21132e=_0x21132e-0xb8;let _0x414f44=_0x2de34c[_0x21132e];return _0x414f44;},a48_0x2113(_0x15b551,_0x2d4669);}function a48_0x2de3(){const _0x51852b=['API_CALL','toISOString','COINTOPAY_ERROR','SHOP_WEBHOOK_ERROR','logCoinToPayError','white_domain_requests','ERROR','12pbDJFM','Failed\x20to\x20get\x20log\x20stats:','logCoinToPayStatus','logWhiteDomainError','logApiCall','ensureLogsDirectory','join','size','filter','localeCompare','setDate','logWebhookProcessed','log','logWhiteDomainResponse','mtime','getDate','12134120bXmeLL','stringify','cwd','logShopWebhookError','16DNLknm','getLogFileName','message','appendFileSync','46612gBmFRG','error','shop_webhooks_errors','white_domain_responses','logsDir','api_calls','LoggerService','loggerService','REQUEST','.log','logWhiteDomainRequest','45vGjaCd','date','getLogStats','PAYMENT_CREATED','222344vWhOBt','map','673383cadrnn','11479479FTRFqp','logShopWebhookSent','stack','defineProperty','slice','split','5571850cLhNJr','writeLog','cointopay_status_changes','logPaymentCreated','readdirSync','endsWith','🗑️\x20Deleted\x20old\x20log\x20file:\x20','path','1704648gABzxE','payments_created','28LjIflS','utf8','Failed\x20to\x20write\x20','📁\x20Created\x20logs\x20directory:\x20','default','Failed\x20to\x20clean\x20old\x20logs:','\x20old\x20log\x20files\x20(older\x20than\x20','__esModule','logWebhookReceived','length','webhooks_received','replace','statSync'];a48_0x2de3=function(){return _0x51852b;};return a48_0x2de3();}exports[a48_0x5ce2f0(0xc3)]=LoggerService,exports[a48_0x5ce2f0(0xc4)]=new LoggerService();