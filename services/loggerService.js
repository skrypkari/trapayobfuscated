'use strict';const a48_0x121bb6=a48_0x2380;(function(_0x3ffcab,_0x1995a9){const _0x8fafa=a48_0x2380,_0x318c4f=_0x3ffcab();while(!![]){try{const _0x44e69e=parseInt(_0x8fafa(0x157))/0x1+-parseInt(_0x8fafa(0x169))/0x2+-parseInt(_0x8fafa(0x16a))/0x3+parseInt(_0x8fafa(0x13d))/0x4*(parseInt(_0x8fafa(0x162))/0x5)+-parseInt(_0x8fafa(0x16f))/0x6+parseInt(_0x8fafa(0x152))/0x7*(parseInt(_0x8fafa(0x168))/0x8)+parseInt(_0x8fafa(0x160))/0x9;if(_0x44e69e===_0x1995a9)break;else _0x318c4f['push'](_0x318c4f['shift']());}catch(_0x1f47e5){_0x318c4f['push'](_0x318c4f['shift']());}}}(a48_0x3657,0x844b8));var __importDefault=this&&this[a48_0x121bb6(0x13c)]||function(_0x2aedf0){const _0x599699=a48_0x121bb6;return _0x2aedf0&&_0x2aedf0[_0x599699(0x14a)]?_0x2aedf0:{'default':_0x2aedf0};};Object[a48_0x121bb6(0x16e)](exports,a48_0x121bb6(0x14a),{'value':!![]}),exports[a48_0x121bb6(0x137)]=exports[a48_0x121bb6(0x167)]=void 0x0;function a48_0x2380(_0x32e75f,_0x4c86f7){const _0x365703=a48_0x3657();return a48_0x2380=function(_0x238007,_0x158349){_0x238007=_0x238007-0x129;let _0x2d893e=_0x365703[_0x238007];return _0x2d893e;},a48_0x2380(_0x32e75f,_0x4c86f7);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x2f8f51=a48_0x121bb6;this['logsDir']=path_1[_0x2f8f51(0x148)][_0x2f8f51(0x149)](process[_0x2f8f51(0x14b)](),_0x2f8f51(0x151)),this[_0x2f8f51(0x15c)]();}['ensureLogsDirectory'](){const _0x1ca0a3=a48_0x121bb6;!fs_1[_0x1ca0a3(0x148)][_0x1ca0a3(0x161)](this['logsDir'])&&(fs_1[_0x1ca0a3(0x148)][_0x1ca0a3(0x143)](this['logsDir'],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x1ca0a3(0x155)]));}[a48_0x121bb6(0x12b)](_0x147d3f){const _0x134274=a48_0x121bb6,_0x3248cc=new Date()[_0x134274(0x12c)]()[_0x134274(0x12f)]('T')[0x0];return path_1[_0x134274(0x148)][_0x134274(0x149)](this[_0x134274(0x155)],_0x147d3f+'_'+_0x3248cc+_0x134274(0x174));}[a48_0x121bb6(0x139)](_0x540b5a,_0xaef209){const _0x121ba8=a48_0x121bb6;try{const _0x70ba6b=new Date()[_0x121ba8(0x12c)](),_0x5535b3={'timestamp':_0x70ba6b,..._0xaef209},_0x3f5a3b=JSON[_0x121ba8(0x129)](_0x5535b3)+'\x0a',_0x375cc7=this['getLogFileName'](_0x540b5a);fs_1[_0x121ba8(0x148)]['appendFileSync'](_0x375cc7,_0x3f5a3b,'utf8');}catch(_0xad5803){console[_0x121ba8(0x171)]('Failed\x20to\x20write\x20'+_0x540b5a+_0x121ba8(0x166),_0xad5803);}}[a48_0x121bb6(0x14e)](_0xec81e6,_0x51ac78,_0x121192,_0x668006){const _0x58097a=a48_0x121bb6;this[_0x58097a(0x139)](_0x58097a(0x150),{'type':_0x58097a(0x142),'gateway':_0xec81e6,'endpoint':_0x51ac78,'method':_0x121192,'data':_0x668006});}['logWhiteDomainResponse'](_0x3ca1ed,_0x228b39,_0xdff60,_0x40025d,_0x3393ec){const _0xaeccb0=a48_0x121bb6;this[_0xaeccb0(0x139)](_0xaeccb0(0x145),{'type':_0xaeccb0(0x15a),'gateway':_0x3ca1ed,'endpoint':_0x228b39,'status':_0xdff60,'responseTime':_0x3393ec,'data':_0x40025d});}['logWhiteDomainError'](_0x46325a,_0x2f0c03,_0x299738){const _0x385d9f=a48_0x121bb6;this[_0x385d9f(0x139)]('white_domain_errors',{'type':_0x385d9f(0x153),'gateway':_0x46325a,'endpoint':_0x2f0c03,'error':_0x299738 instanceof Error?{'message':_0x299738['message'],'stack':_0x299738[_0x385d9f(0x170)]}:_0x299738});}['logWebhookReceived'](_0x24a265,_0x5782f7,_0x597ee0){const _0x5e3825=a48_0x121bb6;this['writeLog'](_0x5e3825(0x16b),{'type':_0x5e3825(0x147),'gateway':_0x24a265,'headers':_0x597ee0,'data':_0x5782f7});}[a48_0x121bb6(0x12a)](_0x373285,_0x39773b,_0x58ddf4,_0xf56f65,_0x551a32){const _0x1f8f94=a48_0x121bb6;this[_0x1f8f94(0x139)](_0x1f8f94(0x13a),{'type':'WEBHOOK_PROCESSED','gateway':_0x373285,'paymentId':_0x39773b,'oldStatus':_0x58ddf4,'newStatus':_0xf56f65,'originalData':_0x551a32});}[a48_0x121bb6(0x14f)](_0x2f4fb6,_0x56e002,_0x3e1531){const _0x1882a5=a48_0x121bb6;this['writeLog']('webhooks_errors',{'type':_0x1882a5(0x134),'gateway':_0x2f4fb6,'error':_0x56e002 instanceof Error?{'message':_0x56e002[_0x1882a5(0x16c)],'stack':_0x56e002['stack']}:_0x56e002,'originalData':_0x3e1531});}['logCoinToPayStatus'](_0xa15fe3){const _0x4b02d0=a48_0x121bb6;this[_0x4b02d0(0x139)]('cointopay_status_changes',{'type':_0x4b02d0(0x15d),..._0xa15fe3});}[a48_0x121bb6(0x164)](_0x4d9bc4){const _0x4d8c45=a48_0x121bb6;this[_0x4d8c45(0x139)](_0x4d8c45(0x12d),{'type':_0x4d8c45(0x156),..._0x4d9bc4});}[a48_0x121bb6(0x13b)](_0x3a3c4e,_0x2bed78,_0xd6348b,_0x4c417b,_0x3389d2,_0x94b93){const _0x26e8c4=a48_0x121bb6;this['writeLog'](_0x26e8c4(0x141),{'type':_0x26e8c4(0x158),'shopId':_0x3a3c4e,'webhookUrl':_0x2bed78,'event':_0xd6348b,'status':_0x4c417b,'responseTime':_0x3389d2,'payload':_0x94b93});}[a48_0x121bb6(0x130)](_0x52e859,_0xdc1993,_0x17126b,_0x134e45,_0x3c843b){const _0x50a7d8=a48_0x121bb6;this['writeLog'](_0x50a7d8(0x14d),{'type':_0x50a7d8(0x13f),'shopId':_0x52e859,'webhookUrl':_0xdc1993,'event':_0x17126b,'error':_0x134e45 instanceof Error?{'message':_0x134e45[_0x50a7d8(0x16c)],'stack':_0x134e45[_0x50a7d8(0x170)]}:_0x134e45,'payload':_0x3c843b});}['logPaymentCreated'](_0x551d9a,_0x42fe49,_0x4bf6f3,_0x5914e2,_0x4ef64a){const _0x58cc4c=a48_0x121bb6;this[_0x58cc4c(0x139)](_0x58cc4c(0x16d),{'type':_0x58cc4c(0x15b),'gateway':_0x551d9a,'paymentId':_0x42fe49,'shopId':_0x4bf6f3,'amount':_0x5914e2,'currency':_0x4ef64a});}['logApiCall'](_0x380fbe,_0x14aa4f,_0x208828,_0x386339,_0x5277cf){const _0x6bbb46=a48_0x121bb6;this[_0x6bbb46(0x139)]('api_calls',{'type':_0x6bbb46(0x146),'endpoint':_0x380fbe,'method':_0x14aa4f,'userId':_0x208828,'userRole':_0x386339,'requestData':_0x5277cf});}[a48_0x121bb6(0x163)](){const _0x3ddd42=a48_0x121bb6;try{const _0x28e12d=fs_1[_0x3ddd42(0x148)][_0x3ddd42(0x15f)](this[_0x3ddd42(0x155)]),_0x2a8488=_0x28e12d[_0x3ddd42(0x12e)](_0x216543=>_0x216543[_0x3ddd42(0x133)]('.log')),_0x33cafc=[...new Set(_0x2a8488['map'](_0x5c3dea=>_0x5c3dea[_0x3ddd42(0x12f)]('_')[0x0]))],_0x54b9c8=_0x2a8488[_0x3ddd42(0x136)](_0x8012f2=>{const _0x57678c=_0x3ddd42,_0x33e49d=path_1[_0x57678c(0x148)][_0x57678c(0x149)](this['logsDir'],_0x8012f2),_0x488ce2=fs_1[_0x57678c(0x148)][_0x57678c(0x13e)](_0x33e49d),[_0x14ddb5,_0x5a650f]=_0x8012f2['replace']('.log','')[_0x57678c(0x12f)]('_');return{'type':_0x14ddb5,'date':_0x5a650f,'size':_0x488ce2[_0x57678c(0x172)]};})[_0x3ddd42(0x154)]((_0x18539e,_0x5d7687)=>_0x5d7687[_0x3ddd42(0x165)][_0x3ddd42(0x15e)](_0x18539e[_0x3ddd42(0x165)]));return{'totalFiles':_0x2a8488[_0x3ddd42(0x140)],'logTypes':_0x33cafc,'latestLogs':_0x54b9c8[_0x3ddd42(0x138)](0x0,0xa)};}catch(_0x31ced8){return console[_0x3ddd42(0x171)](_0x3ddd42(0x131),_0x31ced8),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x67f935=0x1e){const _0x323564=a48_0x121bb6;try{const _0x35428b=fs_1[_0x323564(0x148)][_0x323564(0x15f)](this[_0x323564(0x155)]),_0x1dec0f=new Date();_0x1dec0f['setDate'](_0x1dec0f[_0x323564(0x144)]()-_0x67f935);let _0x327ce9=0x0;_0x35428b['forEach'](_0x4c68dd=>{const _0x195bdd=_0x323564;if(!_0x4c68dd[_0x195bdd(0x133)]('.log'))return;const _0x44a7f7=path_1[_0x195bdd(0x148)]['join'](this[_0x195bdd(0x155)],_0x4c68dd),_0x5e5381=fs_1[_0x195bdd(0x148)][_0x195bdd(0x13e)](_0x44a7f7);_0x5e5381[_0x195bdd(0x159)]<_0x1dec0f&&(fs_1[_0x195bdd(0x148)][_0x195bdd(0x173)](_0x44a7f7),_0x327ce9++,console['log'](_0x195bdd(0x14c)+_0x4c68dd));}),console['log']('🧹\x20Cleaned\x20'+_0x327ce9+_0x323564(0x132)+_0x67f935+_0x323564(0x135));}catch(_0x2620d8){console[_0x323564(0x171)]('Failed\x20to\x20clean\x20old\x20logs:',_0x2620d8);}}}function a48_0x3657(){const _0x1a3a96=['SHOP_WEBHOOK_SENT','mtime','RESPONSE','PAYMENT_CREATED','ensureLogsDirectory','COINTOPAY_STATUS_CHANGE','localeCompare','readdirSync','16716321uezckV','existsSync','45005MsDWTW','getLogStats','logCoinToPayError','date','\x20log:','LoggerService','3671368GJHhbX','2010072bxFEmX','1773600DRvIOY','webhooks_received','message','payments_created','defineProperty','5699436guqyrq','stack','error','size','unlinkSync','.log','stringify','logWebhookProcessed','getLogFileName','toISOString','cointopay_errors','filter','split','logShopWebhookError','Failed\x20to\x20get\x20log\x20stats:','\x20old\x20log\x20files\x20(older\x20than\x20','endsWith','WEBHOOK_ERROR','\x20days)','map','loggerService','slice','writeLog','webhooks_processed','logShopWebhookSent','__importDefault','276TMvitf','statSync','SHOP_WEBHOOK_ERROR','length','shop_webhooks_sent','REQUEST','mkdirSync','getDate','white_domain_responses','API_CALL','WEBHOOK_RECEIVED','default','join','__esModule','cwd','🗑️\x20Deleted\x20old\x20log\x20file:\x20','shop_webhooks_errors','logWhiteDomainRequest','logWebhookError','white_domain_requests','logs','7WZTucd','ERROR','sort','logsDir','COINTOPAY_ERROR','150663foQtiu'];a48_0x3657=function(){return _0x1a3a96;};return a48_0x3657();}exports[a48_0x121bb6(0x167)]=LoggerService,exports[a48_0x121bb6(0x137)]=new LoggerService();