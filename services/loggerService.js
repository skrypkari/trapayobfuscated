'use strict';const a49_0x411f1a=a49_0x2d93;(function(_0x5325db,_0xaabef4){const _0x4fb556=a49_0x2d93,_0x4cbe4a=_0x5325db();while(!![]){try{const _0x1033f7=-parseInt(_0x4fb556(0x10b))/0x1+-parseInt(_0x4fb556(0x11d))/0x2+parseInt(_0x4fb556(0x138))/0x3*(parseInt(_0x4fb556(0x12b))/0x4)+-parseInt(_0x4fb556(0x147))/0x5*(parseInt(_0x4fb556(0x14f))/0x6)+parseInt(_0x4fb556(0x125))/0x7+parseInt(_0x4fb556(0x14a))/0x8*(parseInt(_0x4fb556(0x11e))/0x9)+-parseInt(_0x4fb556(0x14e))/0xa*(-parseInt(_0x4fb556(0x157))/0xb);if(_0x1033f7===_0xaabef4)break;else _0x4cbe4a['push'](_0x4cbe4a['shift']());}catch(_0x28af6f){_0x4cbe4a['push'](_0x4cbe4a['shift']());}}}(a49_0x4289,0x1cab5));function a49_0x2d93(_0x31d515,_0x19cffe){const _0x42891c=a49_0x4289();return a49_0x2d93=function(_0x2d9355,_0xb5adde){_0x2d9355=_0x2d9355-0x10a;let _0x5e07d7=_0x42891c[_0x2d9355];return _0x5e07d7;},a49_0x2d93(_0x31d515,_0x19cffe);}var __importDefault=this&&this[a49_0x411f1a(0x151)]||function(_0x2faa25){return _0x2faa25&&_0x2faa25['__esModule']?_0x2faa25:{'default':_0x2faa25};};Object[a49_0x411f1a(0x121)](exports,'__esModule',{'value':!![]}),exports[a49_0x411f1a(0x13e)]=exports[a49_0x411f1a(0x149)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));function a49_0x4289(){const _0x4621ff=['payments_created','shop_webhooks_sent','existsSync','setDate','unlinkSync','error','📁\x20Created\x20logs\x20directory:\x20','readdirSync','log','message','sort','logWhiteDomainRequest','white_domain_errors','logWhiteDomainError','logWhiteDomainResponse','361712nmFQsj','42129mYgIkz','appendFileSync','logs','defineProperty','webhooks_errors','WEBHOOK_PROCESSED','forEach','969059ZcJNwG','utf8','localeCompare','Failed\x20to\x20get\x20log\x20stats:','.log','stack','19340JlUvGA','PAYMENT_CREATED','writeLog','shop_webhooks_errors','\x20old\x20log\x20files\x20(older\x20than\x20','REQUEST','getDate','size','default','Failed\x20to\x20write\x20','statSync','join','ensureLogsDirectory','96DuHNcG','logWebhookError','SHOP_WEBHOOK_SENT','\x20days)','endsWith','mtime','loggerService','api_calls','webhooks_processed','🧹\x20Cleaned\x20','filter','WEBHOOK_ERROR','white_domain_requests','split','logPaymentCreated','5fURkzk','🗑️\x20Deleted\x20old\x20log\x20file:\x20','LoggerService','40sFjxhm','ERROR','COINTOPAY_STATUS_CHANGE','cleanOldLogs','1630530dAGtbs','306222IuGCBU','webhooks_received','__importDefault','logCoinToPayStatus','API_CALL','logsDir','stringify','cointopay_status_changes','11unIlqJ','cwd','130293OlCara','RESPONSE','date'];a49_0x4289=function(){return _0x4621ff;};return a49_0x4289();}class LoggerService{constructor(){const _0x5e7a57=a49_0x411f1a;this['logsDir']=path_1[_0x5e7a57(0x133)][_0x5e7a57(0x136)](process[_0x5e7a57(0x10a)](),_0x5e7a57(0x120)),this[_0x5e7a57(0x137)]();}[a49_0x411f1a(0x137)](){const _0x333ff8=a49_0x411f1a;!fs_1[_0x333ff8(0x133)][_0x333ff8(0x110)](this[_0x333ff8(0x154)])&&(fs_1[_0x333ff8(0x133)]['mkdirSync'](this[_0x333ff8(0x154)],{'recursive':!![]}),console['log'](_0x333ff8(0x114)+this['logsDir']));}['getLogFileName'](_0x3721f4){const _0x473e50=a49_0x411f1a,_0x77b42a=new Date()['toISOString']()[_0x473e50(0x145)]('T')[0x0];return path_1[_0x473e50(0x133)][_0x473e50(0x136)](this[_0x473e50(0x154)],_0x3721f4+'_'+_0x77b42a+'.log');}['writeLog'](_0x1e929a,_0x2d5ff6){const _0x396d68=a49_0x411f1a;try{const _0x87f593=new Date()['toISOString'](),_0x1bffa6={'timestamp':_0x87f593,..._0x2d5ff6},_0x27e429=JSON[_0x396d68(0x155)](_0x1bffa6)+'\x0a',_0x188ca9=this['getLogFileName'](_0x1e929a);fs_1[_0x396d68(0x133)][_0x396d68(0x11f)](_0x188ca9,_0x27e429,_0x396d68(0x126));}catch(_0x104d52){console['error'](_0x396d68(0x134)+_0x1e929a+'\x20log:',_0x104d52);}}[a49_0x411f1a(0x119)](_0x4b5f4b,_0x312076,_0x341fbc,_0x5a12e9){const _0x527e53=a49_0x411f1a;this[_0x527e53(0x12d)](_0x527e53(0x144),{'type':_0x527e53(0x130),'gateway':_0x4b5f4b,'endpoint':_0x312076,'method':_0x341fbc,'data':_0x5a12e9});}[a49_0x411f1a(0x11c)](_0x535a22,_0x5de1b2,_0x20607b,_0x4bcdd2,_0x20308e){const _0x476cdd=a49_0x411f1a;this[_0x476cdd(0x12d)]('white_domain_responses',{'type':_0x476cdd(0x10c),'gateway':_0x535a22,'endpoint':_0x5de1b2,'status':_0x20607b,'responseTime':_0x20308e,'data':_0x4bcdd2});}[a49_0x411f1a(0x11b)](_0x27ac86,_0x28c101,_0x564592){const _0x4c69a6=a49_0x411f1a;this[_0x4c69a6(0x12d)](_0x4c69a6(0x11a),{'type':_0x4c69a6(0x14b),'gateway':_0x27ac86,'endpoint':_0x28c101,'error':_0x564592 instanceof Error?{'message':_0x564592[_0x4c69a6(0x117)],'stack':_0x564592[_0x4c69a6(0x12a)]}:_0x564592});}['logWebhookReceived'](_0x49bd36,_0x1af674,_0x44edfe){const _0x4300c8=a49_0x411f1a;this[_0x4300c8(0x12d)](_0x4300c8(0x150),{'type':'WEBHOOK_RECEIVED','gateway':_0x49bd36,'headers':_0x44edfe,'data':_0x1af674});}['logWebhookProcessed'](_0xd58235,_0x12761b,_0x6cd6c4,_0x5eca75,_0x192735){const _0x2f655a=a49_0x411f1a;this[_0x2f655a(0x12d)](_0x2f655a(0x140),{'type':_0x2f655a(0x123),'gateway':_0xd58235,'paymentId':_0x12761b,'oldStatus':_0x6cd6c4,'newStatus':_0x5eca75,'originalData':_0x192735});}[a49_0x411f1a(0x139)](_0x304498,_0x54e883,_0x2135db){const _0x150627=a49_0x411f1a;this[_0x150627(0x12d)](_0x150627(0x122),{'type':_0x150627(0x143),'gateway':_0x304498,'error':_0x54e883 instanceof Error?{'message':_0x54e883[_0x150627(0x117)],'stack':_0x54e883[_0x150627(0x12a)]}:_0x54e883,'originalData':_0x2135db});}[a49_0x411f1a(0x152)](_0x189527){const _0x57e09d=a49_0x411f1a;this[_0x57e09d(0x12d)](_0x57e09d(0x156),{'type':_0x57e09d(0x14c),..._0x189527});}['logCoinToPayError'](_0x1af40a){const _0x28802f=a49_0x411f1a;this[_0x28802f(0x12d)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x1af40a});}['logShopWebhookSent'](_0x445a5d,_0x26ce9c,_0x4292df,_0x4d8558,_0x11e3e1,_0x20201e){const _0x5639e6=a49_0x411f1a;this[_0x5639e6(0x12d)](_0x5639e6(0x10f),{'type':_0x5639e6(0x13a),'shopId':_0x445a5d,'webhookUrl':_0x26ce9c,'event':_0x4292df,'status':_0x4d8558,'responseTime':_0x11e3e1,'payload':_0x20201e});}['logShopWebhookError'](_0x2b6106,_0x372476,_0x35a87d,_0xe68c78,_0x2612d7){const _0x376ddc=a49_0x411f1a;this['writeLog'](_0x376ddc(0x12e),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x2b6106,'webhookUrl':_0x372476,'event':_0x35a87d,'error':_0xe68c78 instanceof Error?{'message':_0xe68c78[_0x376ddc(0x117)],'stack':_0xe68c78[_0x376ddc(0x12a)]}:_0xe68c78,'payload':_0x2612d7});}[a49_0x411f1a(0x146)](_0x3a845c,_0x1a023a,_0x254960,_0xa52110,_0xf086f0){const _0x2b42a6=a49_0x411f1a;this['writeLog'](_0x2b42a6(0x10e),{'type':_0x2b42a6(0x12c),'gateway':_0x3a845c,'paymentId':_0x1a023a,'shopId':_0x254960,'amount':_0xa52110,'currency':_0xf086f0});}['logApiCall'](_0x21df3d,_0x263707,_0x12e3ab,_0x5b8011,_0x51ca62){const _0x1e3122=a49_0x411f1a;this[_0x1e3122(0x12d)](_0x1e3122(0x13f),{'type':_0x1e3122(0x153),'endpoint':_0x21df3d,'method':_0x263707,'userId':_0x12e3ab,'userRole':_0x5b8011,'requestData':_0x51ca62});}['getLogStats'](){const _0x897f2f=a49_0x411f1a;try{const _0x599f83=fs_1[_0x897f2f(0x133)][_0x897f2f(0x115)](this['logsDir']),_0x33a48a=_0x599f83[_0x897f2f(0x142)](_0x298697=>_0x298697[_0x897f2f(0x13c)]('.log')),_0x3f393d=[...new Set(_0x33a48a['map'](_0x1ca5ed=>_0x1ca5ed[_0x897f2f(0x145)]('_')[0x0]))],_0x20f852=_0x33a48a['map'](_0x38a8a0=>{const _0x1f43d8=_0x897f2f,_0x18a3ab=path_1['default']['join'](this['logsDir'],_0x38a8a0),_0x2e6d40=fs_1[_0x1f43d8(0x133)][_0x1f43d8(0x135)](_0x18a3ab),[_0x358263,_0x40bc16]=_0x38a8a0['replace'](_0x1f43d8(0x129),'')[_0x1f43d8(0x145)]('_');return{'type':_0x358263,'date':_0x40bc16,'size':_0x2e6d40[_0x1f43d8(0x132)]};})[_0x897f2f(0x118)]((_0xc70492,_0x2fce58)=>_0x2fce58[_0x897f2f(0x10d)][_0x897f2f(0x127)](_0xc70492[_0x897f2f(0x10d)]));return{'totalFiles':_0x33a48a['length'],'logTypes':_0x3f393d,'latestLogs':_0x20f852['slice'](0x0,0xa)};}catch(_0x10282b){return console['error'](_0x897f2f(0x128),_0x10282b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x411f1a(0x14d)](_0x4036cb=0x1e){const _0x459a1c=a49_0x411f1a;try{const _0x137b94=fs_1['default'][_0x459a1c(0x115)](this['logsDir']),_0x4c2489=new Date();_0x4c2489[_0x459a1c(0x111)](_0x4c2489[_0x459a1c(0x131)]()-_0x4036cb);let _0x48b5a3=0x0;_0x137b94[_0x459a1c(0x124)](_0x2177aa=>{const _0x1b7b56=_0x459a1c;if(!_0x2177aa[_0x1b7b56(0x13c)](_0x1b7b56(0x129)))return;const _0x21cc1b=path_1[_0x1b7b56(0x133)][_0x1b7b56(0x136)](this['logsDir'],_0x2177aa),_0x1f4c5e=fs_1[_0x1b7b56(0x133)][_0x1b7b56(0x135)](_0x21cc1b);_0x1f4c5e[_0x1b7b56(0x13d)]<_0x4c2489&&(fs_1[_0x1b7b56(0x133)][_0x1b7b56(0x112)](_0x21cc1b),_0x48b5a3++,console[_0x1b7b56(0x116)](_0x1b7b56(0x148)+_0x2177aa));}),console[_0x459a1c(0x116)](_0x459a1c(0x141)+_0x48b5a3+_0x459a1c(0x12f)+_0x4036cb+_0x459a1c(0x13b));}catch(_0x2eb28e){console[_0x459a1c(0x113)]('Failed\x20to\x20clean\x20old\x20logs:',_0x2eb28e);}}}exports[a49_0x411f1a(0x149)]=LoggerService,exports[a49_0x411f1a(0x13e)]=new LoggerService();