'use strict';const a48_0x6b9e6b=a48_0x5c92;(function(_0x168908,_0x1abc18){const _0x2b8d19=a48_0x5c92,_0x1b1db2=_0x168908();while(!![]){try{const _0x579407=parseInt(_0x2b8d19(0xa1))/0x1*(parseInt(_0x2b8d19(0xaa))/0x2)+parseInt(_0x2b8d19(0xac))/0x3+-parseInt(_0x2b8d19(0x8a))/0x4*(parseInt(_0x2b8d19(0xcc))/0x5)+-parseInt(_0x2b8d19(0xc9))/0x6*(parseInt(_0x2b8d19(0xc0))/0x7)+parseInt(_0x2b8d19(0xa3))/0x8*(-parseInt(_0x2b8d19(0xca))/0x9)+-parseInt(_0x2b8d19(0xc1))/0xa+-parseInt(_0x2b8d19(0xbf))/0xb*(-parseInt(_0x2b8d19(0x8c))/0xc);if(_0x579407===_0x1abc18)break;else _0x1b1db2['push'](_0x1b1db2['shift']());}catch(_0x2c31a3){_0x1b1db2['push'](_0x1b1db2['shift']());}}}(a48_0x468e,0x1b064));var __importDefault=this&&this[a48_0x6b9e6b(0xc5)]||function(_0x4a318e){const _0x343550=a48_0x6b9e6b;return _0x4a318e&&_0x4a318e[_0x343550(0xa5)]?_0x4a318e:{'default':_0x4a318e};};function a48_0x468e(){const _0x559b19=['logsDir','COINTOPAY_ERROR','stringify','logPaymentCreated','existsSync','split','logWhiteDomainResponse','608056RVktrZ','Failed\x20to\x20write\x20','7908FurTkt','getDate','📁\x20Created\x20logs\x20directory:\x20','SHOP_WEBHOOK_SENT','shop_webhooks_errors','endsWith','ERROR','api_calls','logWhiteDomainError','cointopay_status_changes','loggerService','mkdirSync','message','mtime','🧹\x20Cleaned\x20','setDate','statSync','shop_webhooks_sent','\x20days)','LoggerService','PAYMENT_CREATED','10DTgIgA','WEBHOOK_RECEIVED','109496IWcVqK','size','__esModule','payments_created','SHOP_WEBHOOK_ERROR','Failed\x20to\x20get\x20log\x20stats:','.log','10234aQakcx','logWebhookError','108195fNjtnt','localeCompare','ensureLogsDirectory','Failed\x20to\x20clean\x20old\x20logs:','path','logWebhookProcessed','\x20old\x20log\x20files\x20(older\x20than\x20','utf8','webhooks_errors','error','cointopay_errors','webhooks_received','writeLog','logCoinToPayError','join','getLogFileName','logApiCall','stack','REQUEST','5159akZOzf','262969yNyKCU','549720OvtevU','logs','map','logCoinToPayStatus','__importDefault','API_CALL','readdirSync','RESPONSE','6wXOCUX','27zatvBL','slice','5cObOBo','unlinkSync','date','white_domain_responses','log','logWhiteDomainRequest','toISOString','default','defineProperty','appendFileSync','logShopWebhookError','replace'];a48_0x468e=function(){return _0x559b19;};return a48_0x468e();}Object[a48_0x6b9e6b(0x7f)](exports,a48_0x6b9e6b(0xa5),{'value':!![]}),exports[a48_0x6b9e6b(0x96)]=exports[a48_0x6b9e6b(0x9f)]=void 0x0;function a48_0x5c92(_0x1f2855,_0x1429ad){const _0x468e41=a48_0x468e();return a48_0x5c92=function(_0x5c9254,_0x5b3038){_0x5c9254=_0x5c9254-0x7f;let _0x5b044c=_0x468e41[_0x5c9254];return _0x5b044c;},a48_0x5c92(_0x1f2855,_0x1429ad);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x6b9e6b(0xb0)));class LoggerService{constructor(){const _0x4456ca=a48_0x6b9e6b;this[_0x4456ca(0x83)]=path_1[_0x4456ca(0xd3)]['join'](process['cwd'](),_0x4456ca(0xc2)),this['ensureLogsDirectory']();}[a48_0x6b9e6b(0xae)](){const _0x5a085f=a48_0x6b9e6b;!fs_1['default'][_0x5a085f(0x87)](this[_0x5a085f(0x83)])&&(fs_1[_0x5a085f(0xd3)][_0x5a085f(0x97)](this[_0x5a085f(0x83)],{'recursive':!![]}),console[_0x5a085f(0xd0)](_0x5a085f(0x8e)+this[_0x5a085f(0x83)]));}[a48_0x6b9e6b(0xbb)](_0x220f0f){const _0x5551ae=a48_0x6b9e6b,_0x50b6a4=new Date()[_0x5551ae(0xd2)]()['split']('T')[0x0];return path_1[_0x5551ae(0xd3)][_0x5551ae(0xba)](this[_0x5551ae(0x83)],_0x220f0f+'_'+_0x50b6a4+_0x5551ae(0xa9));}[a48_0x6b9e6b(0xb8)](_0x28459d,_0x5420ae){const _0x58f194=a48_0x6b9e6b;try{const _0x2e9e89=new Date()['toISOString'](),_0x1f1043={'timestamp':_0x2e9e89,..._0x5420ae},_0x5f1ae1=JSON[_0x58f194(0x85)](_0x1f1043)+'\x0a',_0xeb81e9=this[_0x58f194(0xbb)](_0x28459d);fs_1[_0x58f194(0xd3)][_0x58f194(0x80)](_0xeb81e9,_0x5f1ae1,_0x58f194(0xb3));}catch(_0x52ce49){console[_0x58f194(0xb5)](_0x58f194(0x8b)+_0x28459d+'\x20log:',_0x52ce49);}}[a48_0x6b9e6b(0xd1)](_0x146379,_0x509411,_0x2f5b28,_0x50ef60){const _0x1737ee=a48_0x6b9e6b;this[_0x1737ee(0xb8)]('white_domain_requests',{'type':_0x1737ee(0xbe),'gateway':_0x146379,'endpoint':_0x509411,'method':_0x2f5b28,'data':_0x50ef60});}[a48_0x6b9e6b(0x89)](_0x27a69b,_0x554747,_0x5884c4,_0x522227,_0xa22a0){const _0x1b7233=a48_0x6b9e6b;this['writeLog'](_0x1b7233(0xcf),{'type':_0x1b7233(0xc8),'gateway':_0x27a69b,'endpoint':_0x554747,'status':_0x5884c4,'responseTime':_0xa22a0,'data':_0x522227});}[a48_0x6b9e6b(0x94)](_0x56ab0d,_0xfd283,_0x7710e7){const _0x1b6d2d=a48_0x6b9e6b;this[_0x1b6d2d(0xb8)]('white_domain_errors',{'type':_0x1b6d2d(0x92),'gateway':_0x56ab0d,'endpoint':_0xfd283,'error':_0x7710e7 instanceof Error?{'message':_0x7710e7[_0x1b6d2d(0x98)],'stack':_0x7710e7[_0x1b6d2d(0xbd)]}:_0x7710e7});}['logWebhookReceived'](_0x4f522e,_0xeaabb0,_0x33aec2){const _0xea20e5=a48_0x6b9e6b;this['writeLog'](_0xea20e5(0xb7),{'type':_0xea20e5(0xa2),'gateway':_0x4f522e,'headers':_0x33aec2,'data':_0xeaabb0});}[a48_0x6b9e6b(0xb1)](_0x58df33,_0x2a0425,_0x2bd290,_0x3bb80b,_0x491f46){const _0x1c8f7a=a48_0x6b9e6b;this[_0x1c8f7a(0xb8)]('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x58df33,'paymentId':_0x2a0425,'oldStatus':_0x2bd290,'newStatus':_0x3bb80b,'originalData':_0x491f46});}[a48_0x6b9e6b(0xab)](_0x38a6c8,_0x1080f3,_0xa0d65b){const _0xafbf9d=a48_0x6b9e6b;this[_0xafbf9d(0xb8)](_0xafbf9d(0xb4),{'type':'WEBHOOK_ERROR','gateway':_0x38a6c8,'error':_0x1080f3 instanceof Error?{'message':_0x1080f3[_0xafbf9d(0x98)],'stack':_0x1080f3['stack']}:_0x1080f3,'originalData':_0xa0d65b});}[a48_0x6b9e6b(0xc4)](_0x523f77){const _0x3148c8=a48_0x6b9e6b;this[_0x3148c8(0xb8)](_0x3148c8(0x95),{'type':'COINTOPAY_STATUS_CHANGE',..._0x523f77});}[a48_0x6b9e6b(0xb9)](_0x4e15ff){const _0x5d4e3c=a48_0x6b9e6b;this[_0x5d4e3c(0xb8)](_0x5d4e3c(0xb6),{'type':_0x5d4e3c(0x84),..._0x4e15ff});}['logShopWebhookSent'](_0x2b3b32,_0x207728,_0x13f1bb,_0x4a3e79,_0x2253c2,_0x1032ff){const _0x4ab5f1=a48_0x6b9e6b;this['writeLog'](_0x4ab5f1(0x9d),{'type':_0x4ab5f1(0x8f),'shopId':_0x2b3b32,'webhookUrl':_0x207728,'event':_0x13f1bb,'status':_0x4a3e79,'responseTime':_0x2253c2,'payload':_0x1032ff});}[a48_0x6b9e6b(0x81)](_0x1f4617,_0x2d2132,_0xf31d36,_0x2b783b,_0x48d0da){const _0x48d085=a48_0x6b9e6b;this[_0x48d085(0xb8)](_0x48d085(0x90),{'type':_0x48d085(0xa7),'shopId':_0x1f4617,'webhookUrl':_0x2d2132,'event':_0xf31d36,'error':_0x2b783b instanceof Error?{'message':_0x2b783b[_0x48d085(0x98)],'stack':_0x2b783b[_0x48d085(0xbd)]}:_0x2b783b,'payload':_0x48d0da});}[a48_0x6b9e6b(0x86)](_0x4de4ae,_0x1da223,_0x1615a4,_0x449d6f,_0x5987af){const _0x3a7360=a48_0x6b9e6b;this[_0x3a7360(0xb8)](_0x3a7360(0xa6),{'type':_0x3a7360(0xa0),'gateway':_0x4de4ae,'paymentId':_0x1da223,'shopId':_0x1615a4,'amount':_0x449d6f,'currency':_0x5987af});}[a48_0x6b9e6b(0xbc)](_0x5c39a8,_0x527844,_0x12e8c7,_0x355ce9,_0x1611f5){const _0x5bae12=a48_0x6b9e6b;this['writeLog'](_0x5bae12(0x93),{'type':_0x5bae12(0xc6),'endpoint':_0x5c39a8,'method':_0x527844,'userId':_0x12e8c7,'userRole':_0x355ce9,'requestData':_0x1611f5});}['getLogStats'](){const _0x496432=a48_0x6b9e6b;try{const _0x5a449a=fs_1['default']['readdirSync'](this[_0x496432(0x83)]),_0x402188=_0x5a449a['filter'](_0x5d92b8=>_0x5d92b8[_0x496432(0x91)]('.log')),_0x1e1aa4=[...new Set(_0x402188[_0x496432(0xc3)](_0x1d7ac=>_0x1d7ac['split']('_')[0x0]))],_0x40e7dc=_0x402188['map'](_0x3ca648=>{const _0x20f0ca=_0x496432,_0x17c01b=path_1[_0x20f0ca(0xd3)][_0x20f0ca(0xba)](this[_0x20f0ca(0x83)],_0x3ca648),_0x35cf5b=fs_1[_0x20f0ca(0xd3)][_0x20f0ca(0x9c)](_0x17c01b),[_0x248c29,_0x1a68f8]=_0x3ca648[_0x20f0ca(0x82)]('.log','')[_0x20f0ca(0x88)]('_');return{'type':_0x248c29,'date':_0x1a68f8,'size':_0x35cf5b[_0x20f0ca(0xa4)]};})['sort']((_0x4c4b3a,_0x20ea7f)=>_0x20ea7f[_0x496432(0xce)][_0x496432(0xad)](_0x4c4b3a[_0x496432(0xce)]));return{'totalFiles':_0x402188['length'],'logTypes':_0x1e1aa4,'latestLogs':_0x40e7dc[_0x496432(0xcb)](0x0,0xa)};}catch(_0x4392bf){return console[_0x496432(0xb5)](_0x496432(0xa8),_0x4392bf),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x49b3bf=0x1e){const _0x1f5589=a48_0x6b9e6b;try{const _0x4079a7=fs_1[_0x1f5589(0xd3)][_0x1f5589(0xc7)](this[_0x1f5589(0x83)]),_0xaa08ff=new Date();_0xaa08ff[_0x1f5589(0x9b)](_0xaa08ff[_0x1f5589(0x8d)]()-_0x49b3bf);let _0x1900cc=0x0;_0x4079a7['forEach'](_0x321b6d=>{const _0x2b95e7=_0x1f5589;if(!_0x321b6d[_0x2b95e7(0x91)](_0x2b95e7(0xa9)))return;const _0xf09dfc=path_1[_0x2b95e7(0xd3)][_0x2b95e7(0xba)](this['logsDir'],_0x321b6d),_0x244e93=fs_1[_0x2b95e7(0xd3)][_0x2b95e7(0x9c)](_0xf09dfc);_0x244e93[_0x2b95e7(0x99)]<_0xaa08ff&&(fs_1[_0x2b95e7(0xd3)][_0x2b95e7(0xcd)](_0xf09dfc),_0x1900cc++,console[_0x2b95e7(0xd0)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x321b6d));}),console[_0x1f5589(0xd0)](_0x1f5589(0x9a)+_0x1900cc+_0x1f5589(0xb2)+_0x49b3bf+_0x1f5589(0x9e));}catch(_0xf0b5cd){console[_0x1f5589(0xb5)](_0x1f5589(0xaf),_0xf0b5cd);}}}exports[a48_0x6b9e6b(0x9f)]=LoggerService,exports[a48_0x6b9e6b(0x96)]=new LoggerService();