'use strict';const a56_0x5ede1c=a56_0x314d;(function(_0x15f3e8,_0x1ea166){const _0x537c75=a56_0x314d,_0x39b4ac=_0x15f3e8();while(!![]){try{const _0x1f6c4f=parseInt(_0x537c75(0x146))/0x1+parseInt(_0x537c75(0x16f))/0x2*(-parseInt(_0x537c75(0x142))/0x3)+-parseInt(_0x537c75(0x184))/0x4*(parseInt(_0x537c75(0x132))/0x5)+-parseInt(_0x537c75(0x141))/0x6+parseInt(_0x537c75(0x152))/0x7*(-parseInt(_0x537c75(0x150))/0x8)+-parseInt(_0x537c75(0x13f))/0x9+parseInt(_0x537c75(0x14a))/0xa;if(_0x1f6c4f===_0x1ea166)break;else _0x39b4ac['push'](_0x39b4ac['shift']());}catch(_0x3c93a2){_0x39b4ac['push'](_0x39b4ac['shift']());}}}(a56_0x4bb8,0x4f695));function a56_0x4bb8(){const _0x19591b=['ensureLogsDirectory','📁\x20Created\x20logs\x20directory:\x20','REQUEST','logWhiteDomainRequest','setDate','getLogFileName','logApiCall','unlinkSync','mkdirSync','🗑️\x20Deleted\x20old\x20log\x20file:\x20','loggerService','getLogStats','replace','PAYMENT_CREATED','\x20old\x20log\x20files\x20(older\x20than\x20','webhooks_processed','split','__importDefault','join','error','mtime','logShopWebhookError','statSync','22tklfSd','webhooks_received','map','message','forEach','__esModule','.log','stack','size','WEBHOOK_ERROR','logs','white_domain_responses','payments_created','endsWith','logShopWebhookSent','RESPONSE','logCoinToPayError','cleanOldLogs','SHOP_WEBHOOK_ERROR','cwd','Failed\x20to\x20get\x20log\x20stats:','45884gbbLGB','date','path','existsSync','webhooks_errors','getDate','COINTOPAY_ERROR','LoggerService','default','235WVBePr','WEBHOOK_RECEIVED','logCoinToPayStatus','COINTOPAY_STATUS_CHANGE','🧹\x20Cleaned\x20','\x20log:','writeLog','appendFileSync','slice','utf8','logWhiteDomainResponse','ERROR','logWebhookReceived','4668993aGQCqV','shop_webhooks_sent','1743594CdBOxj','82101XnpKsn','readdirSync','logWebhookProcessed','localeCompare','640955Rqumfg','API_CALL','sort','white_domain_errors','14284500viGvjM','Failed\x20to\x20clean\x20old\x20logs:','WEBHOOK_PROCESSED','logsDir','SHOP_WEBHOOK_SENT','log','8dcSiLy','\x20days)','662102ndEQgU','logWhiteDomainError','toISOString','logWebhookError','white_domain_requests','filter'];a56_0x4bb8=function(){return _0x19591b;};return a56_0x4bb8();}var __importDefault=this&&this[a56_0x5ede1c(0x169)]||function(_0x4ab967){return _0x4ab967&&_0x4ab967['__esModule']?_0x4ab967:{'default':_0x4ab967};};Object['defineProperty'](exports,a56_0x5ede1c(0x174),{'value':!![]}),exports['loggerService']=exports[a56_0x5ede1c(0x130)]=void 0x0;function a56_0x314d(_0x23e9ad,_0x4aa3f4){const _0x4bb8db=a56_0x4bb8();return a56_0x314d=function(_0x314da0,_0x23623a){_0x314da0=_0x314da0-0x12b;let _0x53b00f=_0x4bb8db[_0x314da0];return _0x53b00f;},a56_0x314d(_0x23e9ad,_0x4aa3f4);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a56_0x5ede1c(0x12b)));class LoggerService{constructor(){const _0x2b5cc4=a56_0x5ede1c;this[_0x2b5cc4(0x14d)]=path_1[_0x2b5cc4(0x131)][_0x2b5cc4(0x16a)](process[_0x2b5cc4(0x182)](),_0x2b5cc4(0x179)),this[_0x2b5cc4(0x158)]();}[a56_0x5ede1c(0x158)](){const _0x15baa0=a56_0x5ede1c;!fs_1[_0x15baa0(0x131)][_0x15baa0(0x12c)](this[_0x15baa0(0x14d)])&&(fs_1[_0x15baa0(0x131)][_0x15baa0(0x160)](this[_0x15baa0(0x14d)],{'recursive':!![]}),console['log'](_0x15baa0(0x159)+this[_0x15baa0(0x14d)]));}[a56_0x5ede1c(0x15d)](_0x5f4101){const _0x558c8c=a56_0x5ede1c,_0x592829=new Date()[_0x558c8c(0x154)]()[_0x558c8c(0x168)]('T')[0x0];return path_1[_0x558c8c(0x131)][_0x558c8c(0x16a)](this[_0x558c8c(0x14d)],_0x5f4101+'_'+_0x592829+'.log');}[a56_0x5ede1c(0x138)](_0x14269d,_0x26d481){const _0x303f22=a56_0x5ede1c;try{const _0x204f87=new Date()[_0x303f22(0x154)](),_0x206662={'timestamp':_0x204f87,..._0x26d481},_0x2155aa=JSON['stringify'](_0x206662)+'\x0a',_0x5da3d1=this[_0x303f22(0x15d)](_0x14269d);fs_1[_0x303f22(0x131)][_0x303f22(0x139)](_0x5da3d1,_0x2155aa,_0x303f22(0x13b));}catch(_0x32c4cb){console['error']('Failed\x20to\x20write\x20'+_0x14269d+_0x303f22(0x137),_0x32c4cb);}}[a56_0x5ede1c(0x15b)](_0x3ec67c,_0x17d3f6,_0x44546b,_0x2a89f3){const _0xfc55fd=a56_0x5ede1c;this['writeLog'](_0xfc55fd(0x156),{'type':_0xfc55fd(0x15a),'gateway':_0x3ec67c,'endpoint':_0x17d3f6,'method':_0x44546b,'data':_0x2a89f3});}[a56_0x5ede1c(0x13c)](_0x5cf902,_0x1dfd5e,_0x15d39f,_0x18afb7,_0x25960b){const _0x5567b0=a56_0x5ede1c;this['writeLog'](_0x5567b0(0x17a),{'type':_0x5567b0(0x17e),'gateway':_0x5cf902,'endpoint':_0x1dfd5e,'status':_0x15d39f,'responseTime':_0x25960b,'data':_0x18afb7});}[a56_0x5ede1c(0x153)](_0xc4121a,_0x14b1d2,_0x243ab8){const _0x3abc67=a56_0x5ede1c;this[_0x3abc67(0x138)](_0x3abc67(0x149),{'type':_0x3abc67(0x13d),'gateway':_0xc4121a,'endpoint':_0x14b1d2,'error':_0x243ab8 instanceof Error?{'message':_0x243ab8[_0x3abc67(0x172)],'stack':_0x243ab8[_0x3abc67(0x176)]}:_0x243ab8});}[a56_0x5ede1c(0x13e)](_0x1758f6,_0x430412,_0x3c79b4){const _0x450eff=a56_0x5ede1c;this['writeLog'](_0x450eff(0x170),{'type':_0x450eff(0x133),'gateway':_0x1758f6,'headers':_0x3c79b4,'data':_0x430412});}[a56_0x5ede1c(0x144)](_0x111820,_0x222860,_0x4224ec,_0x4c2221,_0x415122){const _0x593e3c=a56_0x5ede1c;this[_0x593e3c(0x138)](_0x593e3c(0x167),{'type':_0x593e3c(0x14c),'gateway':_0x111820,'paymentId':_0x222860,'oldStatus':_0x4224ec,'newStatus':_0x4c2221,'originalData':_0x415122});}[a56_0x5ede1c(0x155)](_0x96fb71,_0x376555,_0x883e6b){const _0xff2ace=a56_0x5ede1c;this[_0xff2ace(0x138)](_0xff2ace(0x12d),{'type':_0xff2ace(0x178),'gateway':_0x96fb71,'error':_0x376555 instanceof Error?{'message':_0x376555['message'],'stack':_0x376555[_0xff2ace(0x176)]}:_0x376555,'originalData':_0x883e6b});}[a56_0x5ede1c(0x134)](_0x27ca93){const _0x8881cd=a56_0x5ede1c;this['writeLog']('cointopay_status_changes',{'type':_0x8881cd(0x135),..._0x27ca93});}[a56_0x5ede1c(0x17f)](_0x2eb855){const _0x5a378f=a56_0x5ede1c;this[_0x5a378f(0x138)]('cointopay_errors',{'type':_0x5a378f(0x12f),..._0x2eb855});}[a56_0x5ede1c(0x17d)](_0x4803c2,_0x241bf4,_0x3f09df,_0x4dfbd1,_0x458b81,_0xfa122e){const _0x27ebc6=a56_0x5ede1c;this['writeLog'](_0x27ebc6(0x140),{'type':_0x27ebc6(0x14e),'shopId':_0x4803c2,'webhookUrl':_0x241bf4,'event':_0x3f09df,'status':_0x4dfbd1,'responseTime':_0x458b81,'payload':_0xfa122e});}[a56_0x5ede1c(0x16d)](_0x680d51,_0x3bd843,_0x511f9a,_0x1b7444,_0x3550d3){const _0x55dfa1=a56_0x5ede1c;this['writeLog']('shop_webhooks_errors',{'type':_0x55dfa1(0x181),'shopId':_0x680d51,'webhookUrl':_0x3bd843,'event':_0x511f9a,'error':_0x1b7444 instanceof Error?{'message':_0x1b7444[_0x55dfa1(0x172)],'stack':_0x1b7444[_0x55dfa1(0x176)]}:_0x1b7444,'payload':_0x3550d3});}['logPaymentCreated'](_0x72a071,_0x390d72,_0x4838f8,_0x1ddae1,_0x144071){const _0x244af8=a56_0x5ede1c;this[_0x244af8(0x138)](_0x244af8(0x17b),{'type':_0x244af8(0x165),'gateway':_0x72a071,'paymentId':_0x390d72,'shopId':_0x4838f8,'amount':_0x1ddae1,'currency':_0x144071});}[a56_0x5ede1c(0x15e)](_0x443ecb,_0x3f6f06,_0x29dfb8,_0x40db89,_0x3c3ea7){const _0x2ae24e=a56_0x5ede1c;this['writeLog']('api_calls',{'type':_0x2ae24e(0x147),'endpoint':_0x443ecb,'method':_0x3f6f06,'userId':_0x29dfb8,'userRole':_0x40db89,'requestData':_0x3c3ea7});}[a56_0x5ede1c(0x163)](){const _0x93a173=a56_0x5ede1c;try{const _0x351b30=fs_1[_0x93a173(0x131)][_0x93a173(0x143)](this['logsDir']),_0x4bebff=_0x351b30[_0x93a173(0x157)](_0x44d887=>_0x44d887[_0x93a173(0x17c)](_0x93a173(0x175))),_0x4194c4=[...new Set(_0x4bebff[_0x93a173(0x171)](_0x3cc776=>_0x3cc776[_0x93a173(0x168)]('_')[0x0]))],_0x34ebd7=_0x4bebff[_0x93a173(0x171)](_0x50283f=>{const _0x34a0cc=_0x93a173,_0x290065=path_1[_0x34a0cc(0x131)][_0x34a0cc(0x16a)](this[_0x34a0cc(0x14d)],_0x50283f),_0x191b37=fs_1[_0x34a0cc(0x131)][_0x34a0cc(0x16e)](_0x290065),[_0x51c033,_0x3b5c92]=_0x50283f[_0x34a0cc(0x164)](_0x34a0cc(0x175),'')[_0x34a0cc(0x168)]('_');return{'type':_0x51c033,'date':_0x3b5c92,'size':_0x191b37[_0x34a0cc(0x177)]};})[_0x93a173(0x148)]((_0x1d719f,_0x2dd79f)=>_0x2dd79f[_0x93a173(0x185)][_0x93a173(0x145)](_0x1d719f['date']));return{'totalFiles':_0x4bebff['length'],'logTypes':_0x4194c4,'latestLogs':_0x34ebd7[_0x93a173(0x13a)](0x0,0xa)};}catch(_0x447e08){return console['error'](_0x93a173(0x183),_0x447e08),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a56_0x5ede1c(0x180)](_0x71906c=0x1e){const _0x2b74c0=a56_0x5ede1c;try{const _0x4ff3fa=fs_1[_0x2b74c0(0x131)][_0x2b74c0(0x143)](this[_0x2b74c0(0x14d)]),_0x39f243=new Date();_0x39f243[_0x2b74c0(0x15c)](_0x39f243[_0x2b74c0(0x12e)]()-_0x71906c);let _0x57910a=0x0;_0x4ff3fa[_0x2b74c0(0x173)](_0x3026fa=>{const _0x4131a9=_0x2b74c0;if(!_0x3026fa[_0x4131a9(0x17c)]('.log'))return;const _0x4296bc=path_1[_0x4131a9(0x131)][_0x4131a9(0x16a)](this[_0x4131a9(0x14d)],_0x3026fa),_0x26e675=fs_1[_0x4131a9(0x131)][_0x4131a9(0x16e)](_0x4296bc);_0x26e675[_0x4131a9(0x16c)]<_0x39f243&&(fs_1[_0x4131a9(0x131)][_0x4131a9(0x15f)](_0x4296bc),_0x57910a++,console[_0x4131a9(0x14f)](_0x4131a9(0x161)+_0x3026fa));}),console[_0x2b74c0(0x14f)](_0x2b74c0(0x136)+_0x57910a+_0x2b74c0(0x166)+_0x71906c+_0x2b74c0(0x151));}catch(_0x491b5b){console[_0x2b74c0(0x16b)](_0x2b74c0(0x14b),_0x491b5b);}}}exports[a56_0x5ede1c(0x130)]=LoggerService,exports[a56_0x5ede1c(0x162)]=new LoggerService();