'use strict';const a51_0x271173=a51_0x1683;(function(_0x15c9c6,_0x5ca5fc){const _0x361822=a51_0x1683,_0x474632=_0x15c9c6();while(!![]){try{const _0x234f95=parseInt(_0x361822(0x106))/0x1*(-parseInt(_0x361822(0x127))/0x2)+parseInt(_0x361822(0xeb))/0x3+-parseInt(_0x361822(0xe8))/0x4*(parseInt(_0x361822(0xfe))/0x5)+parseInt(_0x361822(0x11c))/0x6+parseInt(_0x361822(0xf9))/0x7+parseInt(_0x361822(0x123))/0x8*(-parseInt(_0x361822(0x10b))/0x9)+parseInt(_0x361822(0xf8))/0xa;if(_0x234f95===_0x5ca5fc)break;else _0x474632['push'](_0x474632['shift']());}catch(_0x2c5323){_0x474632['push'](_0x474632['shift']());}}}(a51_0x2628,0x73e82));function a51_0x1683(_0x2c56a8,_0xc4b394){const _0x262822=a51_0x2628();return a51_0x1683=function(_0x1683b6,_0x4e6d7c){_0x1683b6=_0x1683b6-0xe1;let _0xc01fa3=_0x262822[_0x1683b6];return _0xc01fa3;},a51_0x1683(_0x2c56a8,_0xc4b394);}var __importDefault=this&&this[a51_0x271173(0x11f)]||function(_0x2cbc7a){const _0x4ecd27=a51_0x271173;return _0x2cbc7a&&_0x2cbc7a[_0x4ecd27(0xe4)]?_0x2cbc7a:{'default':_0x2cbc7a};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a51_0x271173(0x111)]=exports[a51_0x271173(0x108)]=void 0x0;function a51_0x2628(){const _0x52c039=['filter','Failed\x20to\x20get\x20log\x20stats:','mkdirSync','cointopay_status_changes','readdirSync','WEBHOOK_PROCESSED','webhooks_processed','getLogStats','white_domain_requests','9199560TvPlpF','356181tgDgrJ','SHOP_WEBHOOK_SENT','size','writeLog','default','5GiBJQk','statSync','utf8','split','localeCompare','path','\x20days)','date','4HofWRG','forEach','LoggerService','existsSync','Failed\x20to\x20write\x20','47178PYfYol','log','map','toISOString','webhooks_errors','message','loggerService','error','join','logApiCall','API_CALL','\x20old\x20log\x20files\x20(older\x20than\x20','logWhiteDomainError','endsWith','stack','logWhiteDomainResponse','COINTOPAY_ERROR','3679050kiESoG','Failed\x20to\x20clean\x20old\x20logs:','logWhiteDomainRequest','__importDefault','🗑️\x20Deleted\x20old\x20log\x20file:\x20','ensureLogsDirectory','REQUEST','1360YLDnrV','replace','webhooks_received','logCoinToPayStatus','410862qsZaRl','logWebhookReceived','stringify','appendFileSync','getLogFileName','logCoinToPayError','logPaymentCreated','unlinkSync','WEBHOOK_RECEIVED','length','getDate','RESPONSE','__esModule','cleanOldLogs','white_domain_errors','ERROR','414724ljTxdZ','payments_created','logsDir','2121855CATQCs','white_domain_responses','.log','\x20log:'];a51_0x2628=function(){return _0x52c039;};return a51_0x2628();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x271173(0x103)));class LoggerService{constructor(){const _0x1f437b=a51_0x271173;this[_0x1f437b(0xea)]=path_1[_0x1f437b(0xfd)][_0x1f437b(0x113)](process['cwd'](),'logs'),this['ensureLogsDirectory']();}[a51_0x271173(0x121)](){const _0x56b008=a51_0x271173;!fs_1['default'][_0x56b008(0x109)](this[_0x56b008(0xea)])&&(fs_1[_0x56b008(0xfd)][_0x56b008(0xf1)](this[_0x56b008(0xea)],{'recursive':!![]}),console[_0x56b008(0x10c)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x56b008(0xea)]));}[a51_0x271173(0x12b)](_0x1997c5){const _0x3e3b51=a51_0x271173,_0x3d755b=new Date()[_0x3e3b51(0x10e)]()['split']('T')[0x0];return path_1[_0x3e3b51(0xfd)][_0x3e3b51(0x113)](this[_0x3e3b51(0xea)],_0x1997c5+'_'+_0x3d755b+_0x3e3b51(0xed));}[a51_0x271173(0xfc)](_0x51cd78,_0x442162){const _0x36fbc1=a51_0x271173;try{const _0x258958=new Date()[_0x36fbc1(0x10e)](),_0x4d5090={'timestamp':_0x258958,..._0x442162},_0x45802a=JSON[_0x36fbc1(0x129)](_0x4d5090)+'\x0a',_0x42a0ba=this[_0x36fbc1(0x12b)](_0x51cd78);fs_1[_0x36fbc1(0xfd)][_0x36fbc1(0x12a)](_0x42a0ba,_0x45802a,_0x36fbc1(0x100));}catch(_0x40fa4c){console[_0x36fbc1(0x112)](_0x36fbc1(0x10a)+_0x51cd78+_0x36fbc1(0xee),_0x40fa4c);}}[a51_0x271173(0x11e)](_0x19e73d,_0x1a4033,_0x1e25dd,_0xd7f180){const _0x56bc0c=a51_0x271173;this[_0x56bc0c(0xfc)](_0x56bc0c(0xf7),{'type':_0x56bc0c(0x122),'gateway':_0x19e73d,'endpoint':_0x1a4033,'method':_0x1e25dd,'data':_0xd7f180});}[a51_0x271173(0x11a)](_0x1869fb,_0x1b0452,_0x46b0c4,_0x730da4,_0x5a25c5){const _0x584c10=a51_0x271173;this[_0x584c10(0xfc)](_0x584c10(0xec),{'type':_0x584c10(0xe3),'gateway':_0x1869fb,'endpoint':_0x1b0452,'status':_0x46b0c4,'responseTime':_0x5a25c5,'data':_0x730da4});}[a51_0x271173(0x117)](_0x5bcab1,_0x2fdc5f,_0x15c083){const _0x1addfe=a51_0x271173;this[_0x1addfe(0xfc)](_0x1addfe(0xe6),{'type':_0x1addfe(0xe7),'gateway':_0x5bcab1,'endpoint':_0x2fdc5f,'error':_0x15c083 instanceof Error?{'message':_0x15c083[_0x1addfe(0x110)],'stack':_0x15c083['stack']}:_0x15c083});}[a51_0x271173(0x128)](_0x52057c,_0x47295a,_0x4fd6cd){const _0x2139e2=a51_0x271173;this[_0x2139e2(0xfc)](_0x2139e2(0x125),{'type':_0x2139e2(0x12f),'gateway':_0x52057c,'headers':_0x4fd6cd,'data':_0x47295a});}['logWebhookProcessed'](_0x839f99,_0x502fc7,_0x2255b2,_0x27f9ec,_0x3a9098){const _0x4a4348=a51_0x271173;this[_0x4a4348(0xfc)](_0x4a4348(0xf5),{'type':_0x4a4348(0xf4),'gateway':_0x839f99,'paymentId':_0x502fc7,'oldStatus':_0x2255b2,'newStatus':_0x27f9ec,'originalData':_0x3a9098});}['logWebhookError'](_0x5b3b85,_0x4e2b05,_0x406d4e){const _0x59e07a=a51_0x271173;this[_0x59e07a(0xfc)](_0x59e07a(0x10f),{'type':'WEBHOOK_ERROR','gateway':_0x5b3b85,'error':_0x4e2b05 instanceof Error?{'message':_0x4e2b05[_0x59e07a(0x110)],'stack':_0x4e2b05[_0x59e07a(0x119)]}:_0x4e2b05,'originalData':_0x406d4e});}[a51_0x271173(0x126)](_0x4bcc31){const _0x2ce4d7=a51_0x271173;this[_0x2ce4d7(0xfc)](_0x2ce4d7(0xf2),{'type':'COINTOPAY_STATUS_CHANGE',..._0x4bcc31});}[a51_0x271173(0x12c)](_0x3a42e5){const _0x58f511=a51_0x271173;this[_0x58f511(0xfc)]('cointopay_errors',{'type':_0x58f511(0x11b),..._0x3a42e5});}['logShopWebhookSent'](_0xdeb65e,_0x35ef3f,_0x15cccb,_0x5c0d9c,_0x278c74,_0x3e4b9e){const _0x3416e0=a51_0x271173;this[_0x3416e0(0xfc)]('shop_webhooks_sent',{'type':_0x3416e0(0xfa),'shopId':_0xdeb65e,'webhookUrl':_0x35ef3f,'event':_0x15cccb,'status':_0x5c0d9c,'responseTime':_0x278c74,'payload':_0x3e4b9e});}['logShopWebhookError'](_0x4ded1b,_0x4abf4b,_0x1556fc,_0x14722a,_0x1dbf72){const _0x491fe4=a51_0x271173;this[_0x491fe4(0xfc)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x4ded1b,'webhookUrl':_0x4abf4b,'event':_0x1556fc,'error':_0x14722a instanceof Error?{'message':_0x14722a['message'],'stack':_0x14722a[_0x491fe4(0x119)]}:_0x14722a,'payload':_0x1dbf72});}[a51_0x271173(0x12d)](_0x53733d,_0x4b3ffa,_0x19a98c,_0x39447b,_0x5cba85){const _0x19ea8a=a51_0x271173;this[_0x19ea8a(0xfc)](_0x19ea8a(0xe9),{'type':'PAYMENT_CREATED','gateway':_0x53733d,'paymentId':_0x4b3ffa,'shopId':_0x19a98c,'amount':_0x39447b,'currency':_0x5cba85});}[a51_0x271173(0x114)](_0xce5d56,_0x1eb464,_0x1f1166,_0x83a14c,_0xa1d7a9){const _0x23dd08=a51_0x271173;this[_0x23dd08(0xfc)]('api_calls',{'type':_0x23dd08(0x115),'endpoint':_0xce5d56,'method':_0x1eb464,'userId':_0x1f1166,'userRole':_0x83a14c,'requestData':_0xa1d7a9});}[a51_0x271173(0xf6)](){const _0x50d210=a51_0x271173;try{const _0x1c7ce8=fs_1[_0x50d210(0xfd)][_0x50d210(0xf3)](this[_0x50d210(0xea)]),_0x3b5b56=_0x1c7ce8[_0x50d210(0xef)](_0x9c2cc3=>_0x9c2cc3[_0x50d210(0x118)](_0x50d210(0xed))),_0x1e95cf=[...new Set(_0x3b5b56[_0x50d210(0x10d)](_0x31caef=>_0x31caef[_0x50d210(0x101)]('_')[0x0]))],_0x48e72e=_0x3b5b56[_0x50d210(0x10d)](_0x57b0f8=>{const _0x2d86e9=_0x50d210,_0x3ff011=path_1[_0x2d86e9(0xfd)][_0x2d86e9(0x113)](this['logsDir'],_0x57b0f8),_0x5eb32d=fs_1[_0x2d86e9(0xfd)][_0x2d86e9(0xff)](_0x3ff011),[_0x4fe92d,_0x16545c]=_0x57b0f8[_0x2d86e9(0x124)](_0x2d86e9(0xed),'')[_0x2d86e9(0x101)]('_');return{'type':_0x4fe92d,'date':_0x16545c,'size':_0x5eb32d[_0x2d86e9(0xfb)]};})['sort']((_0x2350ee,_0x1872df)=>_0x1872df[_0x50d210(0x105)][_0x50d210(0x102)](_0x2350ee[_0x50d210(0x105)]));return{'totalFiles':_0x3b5b56[_0x50d210(0xe1)],'logTypes':_0x1e95cf,'latestLogs':_0x48e72e['slice'](0x0,0xa)};}catch(_0x1e03ce){return console[_0x50d210(0x112)](_0x50d210(0xf0),_0x1e03ce),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x271173(0xe5)](_0x94e579=0x1e){const _0x33f289=a51_0x271173;try{const _0x3d7098=fs_1[_0x33f289(0xfd)]['readdirSync'](this[_0x33f289(0xea)]),_0x2eef26=new Date();_0x2eef26['setDate'](_0x2eef26[_0x33f289(0xe2)]()-_0x94e579);let _0x11f88f=0x0;_0x3d7098[_0x33f289(0x107)](_0x448c6f=>{const _0x23da50=_0x33f289;if(!_0x448c6f[_0x23da50(0x118)](_0x23da50(0xed)))return;const _0x267b59=path_1[_0x23da50(0xfd)][_0x23da50(0x113)](this[_0x23da50(0xea)],_0x448c6f),_0x2b8125=fs_1[_0x23da50(0xfd)]['statSync'](_0x267b59);_0x2b8125['mtime']<_0x2eef26&&(fs_1[_0x23da50(0xfd)][_0x23da50(0x12e)](_0x267b59),_0x11f88f++,console[_0x23da50(0x10c)](_0x23da50(0x120)+_0x448c6f));}),console['log']('🧹\x20Cleaned\x20'+_0x11f88f+_0x33f289(0x116)+_0x94e579+_0x33f289(0x104));}catch(_0x4e1ed1){console[_0x33f289(0x112)](_0x33f289(0x11d),_0x4e1ed1);}}}exports['LoggerService']=LoggerService,exports[a51_0x271173(0x111)]=new LoggerService();