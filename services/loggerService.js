'use strict';const a59_0x55ca2a=a59_0x36ec;function a59_0x4057(){const _0x46b4c=['setDate','logsDir','payments_created','logApiCall','api_calls','cointopay_errors','shop_webhooks_errors','filter','logShopWebhookSent','error','webhooks_errors','\x20days)','COINTOPAY_STATUS_CHANGE','Failed\x20to\x20get\x20log\x20stats:','12OetIvK','getLogFileName','ensureLogsDirectory','split','LoggerService','sort','message','622YdPdEW','stack','logCoinToPayError','stringify','500THjuWP','SHOP_WEBHOOK_ERROR','COINTOPAY_ERROR','REQUEST','cleanOldLogs','white_domain_responses','log','logShopWebhookError','appendFileSync','1124853zmzEcN','📁\x20Created\x20logs\x20directory:\x20','ERROR','9078876nwAzpJ','1169185mgNkva','mtime','WEBHOOK_RECEIVED','RESPONSE','utf8','default','263412CrGmBB','SHOP_WEBHOOK_SENT','forEach','__esModule','join','134561vKmOFv','path','logWebhookReceived','\x20old\x20log\x20files\x20(older\x20than\x20','logWhiteDomainResponse','23814830qagzro','endsWith','map','logWhiteDomainError','webhooks_received','logPaymentCreated','PAYMENT_CREATED','64PDSESV','writeLog','Failed\x20to\x20write\x20','white_domain_requests','logWhiteDomainRequest','webhooks_processed','logWebhookProcessed','localeCompare','white_domain_errors','.log','logWebhookError','loggerService','🧹\x20Cleaned\x20','date','WEBHOOK_ERROR','toISOString','readdirSync','defineProperty','cwd','logs'];a59_0x4057=function(){return _0x46b4c;};return a59_0x4057();}function a59_0x36ec(_0x3b5855,_0x3c8267){const _0x405733=a59_0x4057();return a59_0x36ec=function(_0x36ecef,_0x4a0c48){_0x36ecef=_0x36ecef-0xdc;let _0x4b8b4c=_0x405733[_0x36ecef];return _0x4b8b4c;},a59_0x36ec(_0x3b5855,_0x3c8267);}(function(_0x14e711,_0x53cd29){const _0x481848=a59_0x36ec,_0x492fc5=_0x14e711();while(!![]){try{const _0x3ce21c=parseInt(_0x481848(0x11f))/0x1*(parseInt(_0x481848(0x123))/0x2)+-parseInt(_0x481848(0x12c))/0x3+parseInt(_0x481848(0x118))/0x4*(-parseInt(_0x481848(0xdf))/0x5)+-parseInt(_0x481848(0xe5))/0x6+parseInt(_0x481848(0xea))/0x7*(parseInt(_0x481848(0xf6))/0x8)+-parseInt(_0x481848(0xde))/0x9+parseInt(_0x481848(0xef))/0xa;if(_0x3ce21c===_0x53cd29)break;else _0x492fc5['push'](_0x492fc5['shift']());}catch(_0x3de408){_0x492fc5['push'](_0x492fc5['shift']());}}}(a59_0x4057,0x891e7));var __importDefault=this&&this['__importDefault']||function(_0x3fdd09){const _0x335916=a59_0x36ec;return _0x3fdd09&&_0x3fdd09[_0x335916(0xe8)]?_0x3fdd09:{'default':_0x3fdd09};};Object[a59_0x55ca2a(0x107)](exports,a59_0x55ca2a(0xe8),{'value':!![]}),exports['loggerService']=exports[a59_0x55ca2a(0x11c)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x55ca2a(0xeb)));class LoggerService{constructor(){const _0x178732=a59_0x55ca2a;this[_0x178732(0x10b)]=path_1[_0x178732(0xe4)][_0x178732(0xe9)](process[_0x178732(0x108)](),_0x178732(0x109)),this['ensureLogsDirectory']();}[a59_0x55ca2a(0x11a)](){const _0x3bb213=a59_0x55ca2a;!fs_1[_0x3bb213(0xe4)]['existsSync'](this[_0x3bb213(0x10b)])&&(fs_1['default']['mkdirSync'](this[_0x3bb213(0x10b)],{'recursive':!![]}),console[_0x3bb213(0x129)](_0x3bb213(0xdc)+this['logsDir']));}[a59_0x55ca2a(0x119)](_0x1f657e){const _0x495449=a59_0x55ca2a,_0x1c097d=new Date()['toISOString']()[_0x495449(0x11b)]('T')[0x0];return path_1['default'][_0x495449(0xe9)](this[_0x495449(0x10b)],_0x1f657e+'_'+_0x1c097d+_0x495449(0xff));}['writeLog'](_0x93de09,_0x57f640){const _0x8568ad=a59_0x55ca2a;try{const _0x1cc383=new Date()[_0x8568ad(0x105)](),_0x17fe33={'timestamp':_0x1cc383,..._0x57f640},_0x1654c5=JSON[_0x8568ad(0x122)](_0x17fe33)+'\x0a',_0x2905c6=this[_0x8568ad(0x119)](_0x93de09);fs_1[_0x8568ad(0xe4)][_0x8568ad(0x12b)](_0x2905c6,_0x1654c5,_0x8568ad(0xe3));}catch(_0xd415b5){console['error'](_0x8568ad(0xf8)+_0x93de09+'\x20log:',_0xd415b5);}}[a59_0x55ca2a(0xfa)](_0x12dff3,_0x6b3648,_0x50c4e1,_0x108a36){const _0x187711=a59_0x55ca2a;this[_0x187711(0xf7)](_0x187711(0xf9),{'type':_0x187711(0x126),'gateway':_0x12dff3,'endpoint':_0x6b3648,'method':_0x50c4e1,'data':_0x108a36});}[a59_0x55ca2a(0xee)](_0x95b266,_0x1e53f1,_0x3605fc,_0x385c6a,_0x311880){const _0x1abd93=a59_0x55ca2a;this[_0x1abd93(0xf7)](_0x1abd93(0x128),{'type':_0x1abd93(0xe2),'gateway':_0x95b266,'endpoint':_0x1e53f1,'status':_0x3605fc,'responseTime':_0x311880,'data':_0x385c6a});}[a59_0x55ca2a(0xf2)](_0x577a12,_0x29e592,_0x9f3c46){const _0x2ae628=a59_0x55ca2a;this[_0x2ae628(0xf7)](_0x2ae628(0xfe),{'type':_0x2ae628(0xdd),'gateway':_0x577a12,'endpoint':_0x29e592,'error':_0x9f3c46 instanceof Error?{'message':_0x9f3c46[_0x2ae628(0x11e)],'stack':_0x9f3c46[_0x2ae628(0x120)]}:_0x9f3c46});}[a59_0x55ca2a(0xec)](_0x2f44c8,_0x14be01,_0x21e34d){const _0x11c4f8=a59_0x55ca2a;this['writeLog'](_0x11c4f8(0xf3),{'type':_0x11c4f8(0xe1),'gateway':_0x2f44c8,'headers':_0x21e34d,'data':_0x14be01});}[a59_0x55ca2a(0xfc)](_0x5383b1,_0x396895,_0x5dbbf4,_0x24b2bf,_0x3584ff){const _0x38db8c=a59_0x55ca2a;this[_0x38db8c(0xf7)](_0x38db8c(0xfb),{'type':'WEBHOOK_PROCESSED','gateway':_0x5383b1,'paymentId':_0x396895,'oldStatus':_0x5dbbf4,'newStatus':_0x24b2bf,'originalData':_0x3584ff});}[a59_0x55ca2a(0x100)](_0x1894ce,_0x3bbfbc,_0x1cbda9){const _0x42b0f8=a59_0x55ca2a;this['writeLog'](_0x42b0f8(0x114),{'type':_0x42b0f8(0x104),'gateway':_0x1894ce,'error':_0x3bbfbc instanceof Error?{'message':_0x3bbfbc[_0x42b0f8(0x11e)],'stack':_0x3bbfbc[_0x42b0f8(0x120)]}:_0x3bbfbc,'originalData':_0x1cbda9});}['logCoinToPayStatus'](_0x2b47c4){const _0x547772=a59_0x55ca2a;this[_0x547772(0xf7)]('cointopay_status_changes',{'type':_0x547772(0x116),..._0x2b47c4});}[a59_0x55ca2a(0x121)](_0x175ddc){const _0x3916e9=a59_0x55ca2a;this['writeLog'](_0x3916e9(0x10f),{'type':_0x3916e9(0x125),..._0x175ddc});}[a59_0x55ca2a(0x112)](_0x1273dd,_0x4dd050,_0x40b676,_0x42dc1c,_0x370b1b,_0x24f215){const _0x63465f=a59_0x55ca2a;this['writeLog']('shop_webhooks_sent',{'type':_0x63465f(0xe6),'shopId':_0x1273dd,'webhookUrl':_0x4dd050,'event':_0x40b676,'status':_0x42dc1c,'responseTime':_0x370b1b,'payload':_0x24f215});}[a59_0x55ca2a(0x12a)](_0x5c88ad,_0x6c152b,_0x30c010,_0x1bef7c,_0x29a109){const _0x52d9cb=a59_0x55ca2a;this[_0x52d9cb(0xf7)](_0x52d9cb(0x110),{'type':_0x52d9cb(0x124),'shopId':_0x5c88ad,'webhookUrl':_0x6c152b,'event':_0x30c010,'error':_0x1bef7c instanceof Error?{'message':_0x1bef7c[_0x52d9cb(0x11e)],'stack':_0x1bef7c[_0x52d9cb(0x120)]}:_0x1bef7c,'payload':_0x29a109});}[a59_0x55ca2a(0xf4)](_0x55e716,_0x2d8680,_0x52a677,_0x478b44,_0x301338){const _0x3cf366=a59_0x55ca2a;this['writeLog'](_0x3cf366(0x10c),{'type':_0x3cf366(0xf5),'gateway':_0x55e716,'paymentId':_0x2d8680,'shopId':_0x52a677,'amount':_0x478b44,'currency':_0x301338});}[a59_0x55ca2a(0x10d)](_0x114e9a,_0x93d6c3,_0x290f5c,_0x18df40,_0x21686b){const _0x4b0213=a59_0x55ca2a;this[_0x4b0213(0xf7)](_0x4b0213(0x10e),{'type':'API_CALL','endpoint':_0x114e9a,'method':_0x93d6c3,'userId':_0x290f5c,'userRole':_0x18df40,'requestData':_0x21686b});}['getLogStats'](){const _0x59122e=a59_0x55ca2a;try{const _0x18f0ef=fs_1[_0x59122e(0xe4)]['readdirSync'](this[_0x59122e(0x10b)]),_0x37ecd5=_0x18f0ef[_0x59122e(0x111)](_0x386244=>_0x386244[_0x59122e(0xf0)](_0x59122e(0xff))),_0x19fb92=[...new Set(_0x37ecd5[_0x59122e(0xf1)](_0x368f3b=>_0x368f3b[_0x59122e(0x11b)]('_')[0x0]))],_0x80c5c1=_0x37ecd5[_0x59122e(0xf1)](_0x467863=>{const _0x4086ab=_0x59122e,_0x192ddb=path_1['default'][_0x4086ab(0xe9)](this[_0x4086ab(0x10b)],_0x467863),_0x23bdb0=fs_1[_0x4086ab(0xe4)]['statSync'](_0x192ddb),[_0x592a2e,_0x3c326b]=_0x467863['replace']('.log','')[_0x4086ab(0x11b)]('_');return{'type':_0x592a2e,'date':_0x3c326b,'size':_0x23bdb0['size']};})[_0x59122e(0x11d)]((_0x171358,_0x46d97f)=>_0x46d97f[_0x59122e(0x103)][_0x59122e(0xfd)](_0x171358['date']));return{'totalFiles':_0x37ecd5['length'],'logTypes':_0x19fb92,'latestLogs':_0x80c5c1['slice'](0x0,0xa)};}catch(_0x1bd4c8){return console['error'](_0x59122e(0x117),_0x1bd4c8),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x55ca2a(0x127)](_0x1f710a=0x1e){const _0x1502aa=a59_0x55ca2a;try{const _0x297657=fs_1[_0x1502aa(0xe4)][_0x1502aa(0x106)](this['logsDir']),_0x5b6abc=new Date();_0x5b6abc[_0x1502aa(0x10a)](_0x5b6abc['getDate']()-_0x1f710a);let _0x2e5a6c=0x0;_0x297657[_0x1502aa(0xe7)](_0x229d60=>{const _0xcbc202=_0x1502aa;if(!_0x229d60['endsWith']('.log'))return;const _0x6ae4f9=path_1[_0xcbc202(0xe4)]['join'](this[_0xcbc202(0x10b)],_0x229d60),_0x429c20=fs_1[_0xcbc202(0xe4)]['statSync'](_0x6ae4f9);_0x429c20[_0xcbc202(0xe0)]<_0x5b6abc&&(fs_1[_0xcbc202(0xe4)]['unlinkSync'](_0x6ae4f9),_0x2e5a6c++,console[_0xcbc202(0x129)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x229d60));}),console[_0x1502aa(0x129)](_0x1502aa(0x102)+_0x2e5a6c+_0x1502aa(0xed)+_0x1f710a+_0x1502aa(0x115));}catch(_0x32c626){console[_0x1502aa(0x113)]('Failed\x20to\x20clean\x20old\x20logs:',_0x32c626);}}}exports[a59_0x55ca2a(0x11c)]=LoggerService,exports[a59_0x55ca2a(0x101)]=new LoggerService();