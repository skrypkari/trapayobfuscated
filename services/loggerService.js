'use strict';const a48_0x10243c=a48_0x2ffc;(function(_0x103f8b,_0x26e9b1){const _0x5cb4fc=a48_0x2ffc,_0x1230f1=_0x103f8b();while(!![]){try{const _0x581ba9=parseInt(_0x5cb4fc(0x94))/0x1+parseInt(_0x5cb4fc(0xbd))/0x2+parseInt(_0x5cb4fc(0xca))/0x3*(parseInt(_0x5cb4fc(0x97))/0x4)+-parseInt(_0x5cb4fc(0xc7))/0x5+-parseInt(_0x5cb4fc(0xba))/0x6*(parseInt(_0x5cb4fc(0xbf))/0x7)+-parseInt(_0x5cb4fc(0xc3))/0x8*(-parseInt(_0x5cb4fc(0x98))/0x9)+-parseInt(_0x5cb4fc(0x9c))/0xa;if(_0x581ba9===_0x26e9b1)break;else _0x1230f1['push'](_0x1230f1['shift']());}catch(_0x3b3789){_0x1230f1['push'](_0x1230f1['shift']());}}}(a48_0xb3e6,0x9f79b));var __importDefault=this&&this[a48_0x10243c(0xc0)]||function(_0x41b39d){const _0x41a514=a48_0x10243c;return _0x41b39d&&_0x41b39d[_0x41a514(0xb1)]?_0x41b39d:{'default':_0x41b39d};};function a48_0x2ffc(_0x514bbd,_0x15c1b3){const _0xb3e6ef=a48_0xb3e6();return a48_0x2ffc=function(_0x2ffc54,_0x3aeceb){_0x2ffc54=_0x2ffc54-0x7a;let _0x46d730=_0xb3e6ef[_0x2ffc54];return _0x46d730;},a48_0x2ffc(_0x514bbd,_0x15c1b3);}Object[a48_0x10243c(0xa6)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a48_0x10243c(0xce)]=void 0x0;function a48_0xb3e6(){const _0x41450b=['Failed\x20to\x20get\x20log\x20stats:','white_domain_requests','existsSync','mkdirSync','mtime','RESPONSE','2358NxifDY','map','cleanOldLogs','2363626WqJNBK','SHOP_WEBHOOK_ERROR','20069fRTkYB','__importDefault','unlinkSync','\x20log:','8jxVRut','date','🧹\x20Cleaned\x20','WEBHOOK_RECEIVED','1368980KYjwpk','white_domain_responses','message','3pqgMjt','forEach','shop_webhooks_sent','COINTOPAY_STATUS_CHANGE','LoggerService','logs','webhooks_errors','sort','getDate','logWebhookReceived','readdirSync','ensureLogsDirectory','cointopay_errors','payments_created','SHOP_WEBHOOK_SENT','webhooks_received','Failed\x20to\x20clean\x20old\x20logs:','API_CALL','api_calls','.log','size','WEBHOOK_ERROR','logWebhookError','filter','utf8','cointopay_status_changes','getLogStats','logWebhookProcessed','length','shop_webhooks_errors','log','1250601eYwefO','logWhiteDomainResponse','replace','2370404mWGFzb','1376262fDjIow','logApiCall','endsWith','logWhiteDomainRequest','11241950ZWuXbm','split','stack','toISOString','error','join','path','COINTOPAY_ERROR','logCoinToPayStatus','logWhiteDomainError','defineProperty','cwd','statSync','\x20days)','default','logShopWebhookError','setDate','Failed\x20to\x20write\x20','logsDir','📁\x20Created\x20logs\x20directory:\x20','getLogFileName','__esModule','appendFileSync','writeLog'];a48_0xb3e6=function(){return _0x41450b;};return a48_0xb3e6();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x10243c(0xa2)));class LoggerService{constructor(){const _0x253484=a48_0x10243c;this['logsDir']=path_1[_0x253484(0xaa)][_0x253484(0xa1)](process[_0x253484(0xa7)](),_0x253484(0x7a)),this[_0x253484(0x80)]();}[a48_0x10243c(0x80)](){const _0x13c811=a48_0x10243c;!fs_1[_0x13c811(0xaa)][_0x13c811(0xb6)](this['logsDir'])&&(fs_1['default'][_0x13c811(0xb7)](this[_0x13c811(0xae)],{'recursive':!![]}),console[_0x13c811(0x93)](_0x13c811(0xaf)+this[_0x13c811(0xae)]));}[a48_0x10243c(0xb0)](_0x28696b){const _0x516bfb=a48_0x10243c,_0x27b923=new Date()[_0x516bfb(0x9f)]()['split']('T')[0x0];return path_1['default']['join'](this[_0x516bfb(0xae)],_0x28696b+'_'+_0x27b923+_0x516bfb(0x88));}[a48_0x10243c(0xb3)](_0x38caf9,_0x269432){const _0x52be77=a48_0x10243c;try{const _0x5059ad=new Date()[_0x52be77(0x9f)](),_0x123712={'timestamp':_0x5059ad,..._0x269432},_0xeaae39=JSON['stringify'](_0x123712)+'\x0a',_0x7c6ae4=this[_0x52be77(0xb0)](_0x38caf9);fs_1[_0x52be77(0xaa)][_0x52be77(0xb2)](_0x7c6ae4,_0xeaae39,_0x52be77(0x8d));}catch(_0x2390be){console[_0x52be77(0xa0)](_0x52be77(0xad)+_0x38caf9+_0x52be77(0xc2),_0x2390be);}}[a48_0x10243c(0x9b)](_0x5989c6,_0x150c73,_0x11d8ab,_0xbb928d){const _0x2e84b2=a48_0x10243c;this[_0x2e84b2(0xb3)](_0x2e84b2(0xb5),{'type':'REQUEST','gateway':_0x5989c6,'endpoint':_0x150c73,'method':_0x11d8ab,'data':_0xbb928d});}[a48_0x10243c(0x95)](_0x16c63f,_0x4f7c8b,_0x3b3dd6,_0x223afa,_0x568b72){const _0x1eb1ef=a48_0x10243c;this[_0x1eb1ef(0xb3)](_0x1eb1ef(0xc8),{'type':_0x1eb1ef(0xb9),'gateway':_0x16c63f,'endpoint':_0x4f7c8b,'status':_0x3b3dd6,'responseTime':_0x568b72,'data':_0x223afa});}[a48_0x10243c(0xa5)](_0x39d55d,_0x400e03,_0x27df9f){const _0x1aa434=a48_0x10243c;this[_0x1aa434(0xb3)]('white_domain_errors',{'type':'ERROR','gateway':_0x39d55d,'endpoint':_0x400e03,'error':_0x27df9f instanceof Error?{'message':_0x27df9f[_0x1aa434(0xc9)],'stack':_0x27df9f[_0x1aa434(0x9e)]}:_0x27df9f});}[a48_0x10243c(0x7e)](_0x194e9f,_0xe45b37,_0x309600){const _0x3eac53=a48_0x10243c;this['writeLog'](_0x3eac53(0x84),{'type':_0x3eac53(0xc6),'gateway':_0x194e9f,'headers':_0x309600,'data':_0xe45b37});}[a48_0x10243c(0x90)](_0x535e20,_0x176c6a,_0x354f0b,_0x58175c,_0x1b1147){this['writeLog']('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x535e20,'paymentId':_0x176c6a,'oldStatus':_0x354f0b,'newStatus':_0x58175c,'originalData':_0x1b1147});}[a48_0x10243c(0x8b)](_0x256c3c,_0x46c5e8,_0x34f8ff){const _0xbad93c=a48_0x10243c;this[_0xbad93c(0xb3)](_0xbad93c(0x7b),{'type':_0xbad93c(0x8a),'gateway':_0x256c3c,'error':_0x46c5e8 instanceof Error?{'message':_0x46c5e8[_0xbad93c(0xc9)],'stack':_0x46c5e8['stack']}:_0x46c5e8,'originalData':_0x34f8ff});}[a48_0x10243c(0xa4)](_0x5adf16){const _0x516b5f=a48_0x10243c;this[_0x516b5f(0xb3)](_0x516b5f(0x8e),{'type':_0x516b5f(0xcd),..._0x5adf16});}['logCoinToPayError'](_0x34b9f8){const _0x3ebca5=a48_0x10243c;this[_0x3ebca5(0xb3)](_0x3ebca5(0x81),{'type':_0x3ebca5(0xa3),..._0x34b9f8});}['logShopWebhookSent'](_0x4add50,_0x3267c1,_0x1324c1,_0x36bb4f,_0x3fb44e,_0x3a4807){const _0x53d793=a48_0x10243c;this[_0x53d793(0xb3)](_0x53d793(0xcc),{'type':_0x53d793(0x83),'shopId':_0x4add50,'webhookUrl':_0x3267c1,'event':_0x1324c1,'status':_0x36bb4f,'responseTime':_0x3fb44e,'payload':_0x3a4807});}[a48_0x10243c(0xab)](_0x2d2dc4,_0xec1bd6,_0xe9dcaf,_0x562299,_0x381354){const _0x2eda39=a48_0x10243c;this[_0x2eda39(0xb3)](_0x2eda39(0x92),{'type':_0x2eda39(0xbe),'shopId':_0x2d2dc4,'webhookUrl':_0xec1bd6,'event':_0xe9dcaf,'error':_0x562299 instanceof Error?{'message':_0x562299[_0x2eda39(0xc9)],'stack':_0x562299[_0x2eda39(0x9e)]}:_0x562299,'payload':_0x381354});}['logPaymentCreated'](_0x165dce,_0x22477f,_0x459c44,_0x4a371c,_0x208e6f){const _0x500624=a48_0x10243c;this[_0x500624(0xb3)](_0x500624(0x82),{'type':'PAYMENT_CREATED','gateway':_0x165dce,'paymentId':_0x22477f,'shopId':_0x459c44,'amount':_0x4a371c,'currency':_0x208e6f});}[a48_0x10243c(0x99)](_0x53ea59,_0x565c28,_0x8c6fd5,_0x2cb9f7,_0x2f5b9e){const _0x301412=a48_0x10243c;this[_0x301412(0xb3)](_0x301412(0x87),{'type':_0x301412(0x86),'endpoint':_0x53ea59,'method':_0x565c28,'userId':_0x8c6fd5,'userRole':_0x2cb9f7,'requestData':_0x2f5b9e});}[a48_0x10243c(0x8f)](){const _0x1f8562=a48_0x10243c;try{const _0x23b6e9=fs_1[_0x1f8562(0xaa)]['readdirSync'](this['logsDir']),_0x2f9acf=_0x23b6e9[_0x1f8562(0x8c)](_0x552746=>_0x552746['endsWith']('.log')),_0x3bd7ea=[...new Set(_0x2f9acf[_0x1f8562(0xbb)](_0x2a8ae5=>_0x2a8ae5[_0x1f8562(0x9d)]('_')[0x0]))],_0xa0d966=_0x2f9acf[_0x1f8562(0xbb)](_0x1b563a=>{const _0x59b0ba=_0x1f8562,_0x15bb8f=path_1[_0x59b0ba(0xaa)]['join'](this[_0x59b0ba(0xae)],_0x1b563a),_0x229d3b=fs_1[_0x59b0ba(0xaa)][_0x59b0ba(0xa8)](_0x15bb8f),[_0x476de0,_0x4bd617]=_0x1b563a[_0x59b0ba(0x96)]('.log','')[_0x59b0ba(0x9d)]('_');return{'type':_0x476de0,'date':_0x4bd617,'size':_0x229d3b[_0x59b0ba(0x89)]};})[_0x1f8562(0x7c)]((_0x4e5315,_0x25601a)=>_0x25601a[_0x1f8562(0xc4)]['localeCompare'](_0x4e5315['date']));return{'totalFiles':_0x2f9acf[_0x1f8562(0x91)],'logTypes':_0x3bd7ea,'latestLogs':_0xa0d966['slice'](0x0,0xa)};}catch(_0x5d5731){return console[_0x1f8562(0xa0)](_0x1f8562(0xb4),_0x5d5731),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x10243c(0xbc)](_0x15b6c8=0x1e){const _0x43a6be=a48_0x10243c;try{const _0x384b0d=fs_1[_0x43a6be(0xaa)][_0x43a6be(0x7f)](this[_0x43a6be(0xae)]),_0x75df35=new Date();_0x75df35[_0x43a6be(0xac)](_0x75df35[_0x43a6be(0x7d)]()-_0x15b6c8);let _0x1d8a38=0x0;_0x384b0d[_0x43a6be(0xcb)](_0x50cc81=>{const _0x140204=_0x43a6be;if(!_0x50cc81[_0x140204(0x9a)](_0x140204(0x88)))return;const _0x412561=path_1[_0x140204(0xaa)][_0x140204(0xa1)](this[_0x140204(0xae)],_0x50cc81),_0x3d8a58=fs_1['default'][_0x140204(0xa8)](_0x412561);_0x3d8a58[_0x140204(0xb8)]<_0x75df35&&(fs_1['default'][_0x140204(0xc1)](_0x412561),_0x1d8a38++,console[_0x140204(0x93)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x50cc81));}),console['log'](_0x43a6be(0xc5)+_0x1d8a38+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x15b6c8+_0x43a6be(0xa9));}catch(_0x22af5f){console[_0x43a6be(0xa0)](_0x43a6be(0x85),_0x22af5f);}}}exports[a48_0x10243c(0xce)]=LoggerService,exports['loggerService']=new LoggerService();