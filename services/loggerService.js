'use strict';const a56_0x5b835e=a56_0x5ed3;(function(_0x4e7665,_0x55866f){const _0x12b92c=a56_0x5ed3,_0x538ece=_0x4e7665();while(!![]){try{const _0x4dd695=parseInt(_0x12b92c(0x1f3))/0x1+parseInt(_0x12b92c(0x1d8))/0x2*(-parseInt(_0x12b92c(0x1f9))/0x3)+parseInt(_0x12b92c(0x1d3))/0x4*(parseInt(_0x12b92c(0x1d1))/0x5)+parseInt(_0x12b92c(0x1e6))/0x6*(parseInt(_0x12b92c(0x202))/0x7)+-parseInt(_0x12b92c(0x1c4))/0x8*(-parseInt(_0x12b92c(0x1d5))/0x9)+parseInt(_0x12b92c(0x1ec))/0xa*(parseInt(_0x12b92c(0x1c9))/0xb)+-parseInt(_0x12b92c(0x1de))/0xc;if(_0x4dd695===_0x55866f)break;else _0x538ece['push'](_0x538ece['shift']());}catch(_0x5c2df5){_0x538ece['push'](_0x538ece['shift']());}}}(a56_0x1fe1,0x62f7a));var __importDefault=this&&this[a56_0x5b835e(0x1ee)]||function(_0xb4fff3){const _0x4b8b3a=a56_0x5b835e;return _0xb4fff3&&_0xb4fff3[_0x4b8b3a(0x216)]?_0xb4fff3:{'default':_0xb4fff3};};function a56_0x5ed3(_0x5ae911,_0x21b9cf){const _0x1fe18f=a56_0x1fe1();return a56_0x5ed3=function(_0x5ed37e,_0x48df0b){_0x5ed37e=_0x5ed37e-0x1c1;let _0x30a414=_0x1fe18f[_0x5ed37e];return _0x30a414;},a56_0x5ed3(_0x5ae911,_0x21b9cf);}Object[a56_0x5b835e(0x1c5)](exports,a56_0x5b835e(0x216),{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;function a56_0x1fe1(){const _0x5b8887=['6pyGxje','SHOP_WEBHOOK_ERROR','localeCompare','shop_webhooks_errors','.log','ensureLogsDirectory','1250TkjAfY','webhooks_processed','__importDefault','logsDir','cointopay_errors','\x20days)','stringify','88550gmTFIU','logWhiteDomainRequest','white_domain_requests','\x20old\x20log\x20files\x20(older\x20than\x20','SHOP_WEBHOOK_SENT','path','66warNcM','REQUEST','logPaymentCreated','length','webhooks_errors','log','map','\x20log:','logs','2732058NnSueS','logWebhookReceived','message','stack','statSync','ERROR','api_calls','PAYMENT_CREATED','cleanOldLogs','error','logWhiteDomainError','🗑️\x20Deleted\x20old\x20log\x20file:\x20','getDate','readdirSync','writeLog','existsSync','WEBHOOK_ERROR','date','filter','logShopWebhookSent','__esModule','white_domain_responses','sort','logWebhookProcessed','mtime','8fMWCNC','defineProperty','logCoinToPayStatus','toISOString','loggerService','29381atZpcT','shop_webhooks_sent','Failed\x20to\x20write\x20','forEach','logWhiteDomainResponse','unlinkSync','logWebhookError','COINTOPAY_STATUS_CHANGE','2885IDYtiC','white_domain_errors','3524XJrtiU','RESPONSE','6709779XkHAGY','join','📁\x20Created\x20logs\x20directory:\x20','54838cfkoxi','getLogFileName','slice','Failed\x20to\x20get\x20log\x20stats:','🧹\x20Cleaned\x20','cwd','12695988rWGhdY','split','payments_created','setDate','logCoinToPayError','default','endsWith','LoggerService'];a56_0x1fe1=function(){return _0x5b8887;};return a56_0x1fe1();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a56_0x5b835e(0x1f8)));class LoggerService{constructor(){const _0x2c8843=a56_0x5b835e;this['logsDir']=path_1[_0x2c8843(0x1e3)][_0x2c8843(0x1d6)](process[_0x2c8843(0x1dd)](),_0x2c8843(0x201)),this[_0x2c8843(0x1eb)]();}['ensureLogsDirectory'](){const _0x3a6b74=a56_0x5b835e;!fs_1[_0x3a6b74(0x1e3)][_0x3a6b74(0x211)](this[_0x3a6b74(0x1ef)])&&(fs_1[_0x3a6b74(0x1e3)]['mkdirSync'](this[_0x3a6b74(0x1ef)],{'recursive':!![]}),console[_0x3a6b74(0x1fe)](_0x3a6b74(0x1d7)+this[_0x3a6b74(0x1ef)]));}[a56_0x5b835e(0x1d9)](_0x17baf4){const _0x4b8975=a56_0x5b835e,_0x4bc2d1=new Date()[_0x4b8975(0x1c7)]()[_0x4b8975(0x1df)]('T')[0x0];return path_1[_0x4b8975(0x1e3)][_0x4b8975(0x1d6)](this['logsDir'],_0x17baf4+'_'+_0x4bc2d1+_0x4b8975(0x1ea));}[a56_0x5b835e(0x210)](_0x348ae9,_0x566a79){const _0x35b4ea=a56_0x5b835e;try{const _0x4187fc=new Date()['toISOString'](),_0x4d3c2e={'timestamp':_0x4187fc,..._0x566a79},_0x52aa39=JSON[_0x35b4ea(0x1f2)](_0x4d3c2e)+'\x0a',_0x17e4d9=this[_0x35b4ea(0x1d9)](_0x348ae9);fs_1[_0x35b4ea(0x1e3)]['appendFileSync'](_0x17e4d9,_0x52aa39,'utf8');}catch(_0x2fa559){console[_0x35b4ea(0x20b)](_0x35b4ea(0x1cb)+_0x348ae9+_0x35b4ea(0x200),_0x2fa559);}}[a56_0x5b835e(0x1f4)](_0x20bd3b,_0x30e010,_0x188903,_0x2c7331){const _0x345ee5=a56_0x5b835e;this['writeLog'](_0x345ee5(0x1f5),{'type':_0x345ee5(0x1fa),'gateway':_0x20bd3b,'endpoint':_0x30e010,'method':_0x188903,'data':_0x2c7331});}[a56_0x5b835e(0x1cd)](_0x37e392,_0x5bb7ed,_0x46dcd8,_0x1f295d,_0xb0f763){const _0x701c3c=a56_0x5b835e;this[_0x701c3c(0x210)](_0x701c3c(0x217),{'type':_0x701c3c(0x1d4),'gateway':_0x37e392,'endpoint':_0x5bb7ed,'status':_0x46dcd8,'responseTime':_0xb0f763,'data':_0x1f295d});}[a56_0x5b835e(0x20c)](_0x182443,_0x518fe9,_0x2a0d4f){const _0x219911=a56_0x5b835e;this[_0x219911(0x210)](_0x219911(0x1d2),{'type':_0x219911(0x207),'gateway':_0x182443,'endpoint':_0x518fe9,'error':_0x2a0d4f instanceof Error?{'message':_0x2a0d4f[_0x219911(0x204)],'stack':_0x2a0d4f[_0x219911(0x205)]}:_0x2a0d4f});}[a56_0x5b835e(0x203)](_0x3bf1fe,_0x1a88c,_0x1bc5ce){const _0x3b105e=a56_0x5b835e;this[_0x3b105e(0x210)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x3bf1fe,'headers':_0x1bc5ce,'data':_0x1a88c});}[a56_0x5b835e(0x1c2)](_0x4f62ec,_0x1fdd55,_0x303aa5,_0x1454db,_0x24f599){const _0xf44d61=a56_0x5b835e;this[_0xf44d61(0x210)](_0xf44d61(0x1ed),{'type':'WEBHOOK_PROCESSED','gateway':_0x4f62ec,'paymentId':_0x1fdd55,'oldStatus':_0x303aa5,'newStatus':_0x1454db,'originalData':_0x24f599});}[a56_0x5b835e(0x1cf)](_0x471d58,_0x2ff13d,_0x188e8e){const _0x309ff4=a56_0x5b835e;this['writeLog'](_0x309ff4(0x1fd),{'type':_0x309ff4(0x212),'gateway':_0x471d58,'error':_0x2ff13d instanceof Error?{'message':_0x2ff13d[_0x309ff4(0x204)],'stack':_0x2ff13d[_0x309ff4(0x205)]}:_0x2ff13d,'originalData':_0x188e8e});}[a56_0x5b835e(0x1c6)](_0x5beeeb){const _0x4982b3=a56_0x5b835e;this[_0x4982b3(0x210)]('cointopay_status_changes',{'type':_0x4982b3(0x1d0),..._0x5beeeb});}[a56_0x5b835e(0x1e2)](_0x32c68c){const _0x3bf749=a56_0x5b835e;this[_0x3bf749(0x210)](_0x3bf749(0x1f0),{'type':'COINTOPAY_ERROR',..._0x32c68c});}[a56_0x5b835e(0x215)](_0x123296,_0x5215c1,_0x2879db,_0x2a4393,_0x1d2fea,_0x5e8553){const _0x10a92f=a56_0x5b835e;this[_0x10a92f(0x210)](_0x10a92f(0x1ca),{'type':_0x10a92f(0x1f7),'shopId':_0x123296,'webhookUrl':_0x5215c1,'event':_0x2879db,'status':_0x2a4393,'responseTime':_0x1d2fea,'payload':_0x5e8553});}['logShopWebhookError'](_0x525a1f,_0x45022a,_0x51d6c4,_0x38a05e,_0x35a108){const _0x243748=a56_0x5b835e;this['writeLog'](_0x243748(0x1e9),{'type':_0x243748(0x1e7),'shopId':_0x525a1f,'webhookUrl':_0x45022a,'event':_0x51d6c4,'error':_0x38a05e instanceof Error?{'message':_0x38a05e[_0x243748(0x204)],'stack':_0x38a05e[_0x243748(0x205)]}:_0x38a05e,'payload':_0x35a108});}[a56_0x5b835e(0x1fb)](_0xa5092e,_0x19a144,_0x3fcca5,_0x4c2ac5,_0x40312e){const _0x2dbe42=a56_0x5b835e;this['writeLog'](_0x2dbe42(0x1e0),{'type':_0x2dbe42(0x209),'gateway':_0xa5092e,'paymentId':_0x19a144,'shopId':_0x3fcca5,'amount':_0x4c2ac5,'currency':_0x40312e});}['logApiCall'](_0x191e72,_0x1f09f9,_0x2fdb47,_0x4052f7,_0x4cc515){const _0x528656=a56_0x5b835e;this['writeLog'](_0x528656(0x208),{'type':'API_CALL','endpoint':_0x191e72,'method':_0x1f09f9,'userId':_0x2fdb47,'userRole':_0x4052f7,'requestData':_0x4cc515});}['getLogStats'](){const _0x1fb0ea=a56_0x5b835e;try{const _0x1682a6=fs_1['default'][_0x1fb0ea(0x20f)](this[_0x1fb0ea(0x1ef)]),_0x578b58=_0x1682a6[_0x1fb0ea(0x214)](_0xdb68b1=>_0xdb68b1['endsWith'](_0x1fb0ea(0x1ea))),_0x1ac588=[...new Set(_0x578b58[_0x1fb0ea(0x1ff)](_0x4306c6=>_0x4306c6[_0x1fb0ea(0x1df)]('_')[0x0]))],_0x214566=_0x578b58[_0x1fb0ea(0x1ff)](_0x459aa9=>{const _0x4ee9f3=_0x1fb0ea,_0x54f8dd=path_1[_0x4ee9f3(0x1e3)][_0x4ee9f3(0x1d6)](this['logsDir'],_0x459aa9),_0x167a55=fs_1[_0x4ee9f3(0x1e3)]['statSync'](_0x54f8dd),[_0x4eccb5,_0x5895db]=_0x459aa9['replace'](_0x4ee9f3(0x1ea),'')[_0x4ee9f3(0x1df)]('_');return{'type':_0x4eccb5,'date':_0x5895db,'size':_0x167a55['size']};})[_0x1fb0ea(0x1c1)]((_0x31b4ab,_0x1fe22c)=>_0x1fe22c[_0x1fb0ea(0x213)][_0x1fb0ea(0x1e8)](_0x31b4ab[_0x1fb0ea(0x213)]));return{'totalFiles':_0x578b58[_0x1fb0ea(0x1fc)],'logTypes':_0x1ac588,'latestLogs':_0x214566[_0x1fb0ea(0x1da)](0x0,0xa)};}catch(_0x30c528){return console[_0x1fb0ea(0x20b)](_0x1fb0ea(0x1db),_0x30c528),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a56_0x5b835e(0x20a)](_0x52beee=0x1e){const _0x4bf857=a56_0x5b835e;try{const _0x199680=fs_1['default'][_0x4bf857(0x20f)](this['logsDir']),_0x5545a3=new Date();_0x5545a3[_0x4bf857(0x1e1)](_0x5545a3[_0x4bf857(0x20e)]()-_0x52beee);let _0x1a8b0c=0x0;_0x199680[_0x4bf857(0x1cc)](_0x3926cc=>{const _0x964dbf=_0x4bf857;if(!_0x3926cc[_0x964dbf(0x1e4)](_0x964dbf(0x1ea)))return;const _0x927e0d=path_1[_0x964dbf(0x1e3)]['join'](this[_0x964dbf(0x1ef)],_0x3926cc),_0x160608=fs_1[_0x964dbf(0x1e3)][_0x964dbf(0x206)](_0x927e0d);_0x160608[_0x964dbf(0x1c3)]<_0x5545a3&&(fs_1[_0x964dbf(0x1e3)][_0x964dbf(0x1ce)](_0x927e0d),_0x1a8b0c++,console[_0x964dbf(0x1fe)](_0x964dbf(0x20d)+_0x3926cc));}),console[_0x4bf857(0x1fe)](_0x4bf857(0x1dc)+_0x1a8b0c+_0x4bf857(0x1f6)+_0x52beee+_0x4bf857(0x1f1));}catch(_0x2a7999){console[_0x4bf857(0x20b)]('Failed\x20to\x20clean\x20old\x20logs:',_0x2a7999);}}}exports[a56_0x5b835e(0x1e5)]=LoggerService,exports[a56_0x5b835e(0x1c8)]=new LoggerService();