'use strict';const a48_0x2372f7=a48_0x4f02;(function(_0x22a44b,_0x2339a0){const _0x44dae9=a48_0x4f02,_0x5545c4=_0x22a44b();while(!![]){try{const _0x483455=-parseInt(_0x44dae9(0x1e5))/0x1*(-parseInt(_0x44dae9(0x1e8))/0x2)+-parseInt(_0x44dae9(0x1ff))/0x3+-parseInt(_0x44dae9(0x20a))/0x4*(-parseInt(_0x44dae9(0x1ed))/0x5)+-parseInt(_0x44dae9(0x222))/0x6*(-parseInt(_0x44dae9(0x1ea))/0x7)+-parseInt(_0x44dae9(0x221))/0x8*(-parseInt(_0x44dae9(0x1f1))/0x9)+-parseInt(_0x44dae9(0x1e6))/0xa*(parseInt(_0x44dae9(0x20c))/0xb)+-parseInt(_0x44dae9(0x21b))/0xc*(parseInt(_0x44dae9(0x228))/0xd);if(_0x483455===_0x2339a0)break;else _0x5545c4['push'](_0x5545c4['shift']());}catch(_0x3a2042){_0x5545c4['push'](_0x5545c4['shift']());}}}(a48_0x5e0a,0xe4221));function a48_0x4f02(_0x57a4d0,_0x5a056a){const _0x5e0ac5=a48_0x5e0a();return a48_0x4f02=function(_0x4f02a8,_0x5ae6d1){_0x4f02a8=_0x4f02a8-0x1d9;let _0x3dcba7=_0x5e0ac5[_0x4f02a8];return _0x3dcba7;},a48_0x4f02(_0x57a4d0,_0x5a056a);}function a48_0x5e0a(){const _0x4a2f0a=['white_domain_errors','cointopay_errors','writeLog','1837119XIfuFS','log','size','slice','logWebhookProcessed','path','length','logShopWebhookSent','ERROR','Failed\x20to\x20get\x20log\x20stats:','.log','1392988DRHCmE','date','10505UOrozI','stack','RESPONSE','Failed\x20to\x20clean\x20old\x20logs:','statSync','logCoinToPayStatus','ensureLogsDirectory','logsDir','webhooks_received','API_CALL','__esModule','split','readdirSync','logWebhookReceived','message','12ZRASLk','SHOP_WEBHOOK_ERROR','white_domain_responses','📁\x20Created\x20logs\x20directory:\x20','getDate','logWhiteDomainResponse','8nEgfwQ','42LhKSni','loggerService','logWebhookError','utf8','join','map','26240162viuYHW','🗑️\x20Deleted\x20old\x20log\x20file:\x20','shop_webhooks_sent','toISOString','webhooks_errors','__importDefault','logs','LoggerService','logWhiteDomainRequest','stringify','default','COINTOPAY_STATUS_CHANGE','logApiCall','error','unlinkSync','logPaymentCreated','shop_webhooks_errors','20977RyARBO','5170aPvGYo','cointopay_status_changes','66HaCbpp','cleanOldLogs','1354612LpWgUZ','forEach','mtime','15xisejs','existsSync','PAYMENT_CREATED','replace','8706789qdToAQ','Failed\x20to\x20write\x20','WEBHOOK_ERROR','\x20log:','webhooks_processed','getLogStats','endsWith','REQUEST','🧹\x20Cleaned\x20','getLogFileName','\x20old\x20log\x20files\x20(older\x20than\x20'];a48_0x5e0a=function(){return _0x4a2f0a;};return a48_0x5e0a();}var __importDefault=this&&this[a48_0x2372f7(0x1d9)]||function(_0x582e85){const _0x267dd1=a48_0x2372f7;return _0x582e85&&_0x582e85[_0x267dd1(0x216)]?_0x582e85:{'default':_0x582e85};};Object['defineProperty'](exports,a48_0x2372f7(0x216),{'value':!![]}),exports[a48_0x2372f7(0x223)]=exports[a48_0x2372f7(0x1db)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x2372f7(0x204)));class LoggerService{constructor(){const _0x2b13d5=a48_0x2372f7;this[_0x2b13d5(0x213)]=path_1[_0x2b13d5(0x1de)][_0x2b13d5(0x226)](process['cwd'](),_0x2b13d5(0x1da)),this[_0x2b13d5(0x212)]();}[a48_0x2372f7(0x212)](){const _0x2c78f0=a48_0x2372f7;!fs_1['default'][_0x2c78f0(0x1ee)](this['logsDir'])&&(fs_1['default']['mkdirSync'](this[_0x2c78f0(0x213)],{'recursive':!![]}),console['log'](_0x2c78f0(0x21e)+this['logsDir']));}[a48_0x2372f7(0x1fa)](_0x11eb27){const _0x57d5ea=a48_0x2372f7,_0x5a792c=new Date()[_0x57d5ea(0x22b)]()[_0x57d5ea(0x217)]('T')[0x0];return path_1[_0x57d5ea(0x1de)][_0x57d5ea(0x226)](this[_0x57d5ea(0x213)],_0x11eb27+'_'+_0x5a792c+_0x57d5ea(0x209));}[a48_0x2372f7(0x1fe)](_0x587145,_0x325221){const _0x26c0ff=a48_0x2372f7;try{const _0xef2202=new Date()[_0x26c0ff(0x22b)](),_0x5603c1={'timestamp':_0xef2202,..._0x325221},_0x12aa69=JSON[_0x26c0ff(0x1dd)](_0x5603c1)+'\x0a',_0x37c8db=this[_0x26c0ff(0x1fa)](_0x587145);fs_1[_0x26c0ff(0x1de)]['appendFileSync'](_0x37c8db,_0x12aa69,_0x26c0ff(0x225));}catch(_0x492550){console['error'](_0x26c0ff(0x1f2)+_0x587145+_0x26c0ff(0x1f4),_0x492550);}}[a48_0x2372f7(0x1dc)](_0x3ac48c,_0x496378,_0x408e23,_0x2bd6fa){const _0x9408ba=a48_0x2372f7;this['writeLog']('white_domain_requests',{'type':_0x9408ba(0x1f8),'gateway':_0x3ac48c,'endpoint':_0x496378,'method':_0x408e23,'data':_0x2bd6fa});}[a48_0x2372f7(0x220)](_0x3a750e,_0x42f623,_0x374250,_0x2071c3,_0x4f2217){const _0x251ab9=a48_0x2372f7;this[_0x251ab9(0x1fe)](_0x251ab9(0x21d),{'type':_0x251ab9(0x20e),'gateway':_0x3a750e,'endpoint':_0x42f623,'status':_0x374250,'responseTime':_0x4f2217,'data':_0x2071c3});}['logWhiteDomainError'](_0x4b1a36,_0x329ffe,_0x3e7bd4){const _0x4d3cff=a48_0x2372f7;this['writeLog'](_0x4d3cff(0x1fc),{'type':_0x4d3cff(0x207),'gateway':_0x4b1a36,'endpoint':_0x329ffe,'error':_0x3e7bd4 instanceof Error?{'message':_0x3e7bd4[_0x4d3cff(0x21a)],'stack':_0x3e7bd4['stack']}:_0x3e7bd4});}[a48_0x2372f7(0x219)](_0x288fa8,_0xf96466,_0x2ae8fe){const _0x3dad06=a48_0x2372f7;this[_0x3dad06(0x1fe)](_0x3dad06(0x214),{'type':'WEBHOOK_RECEIVED','gateway':_0x288fa8,'headers':_0x2ae8fe,'data':_0xf96466});}[a48_0x2372f7(0x203)](_0xbeac22,_0x59ea65,_0x5cd391,_0x170f22,_0x2d319b){const _0x886d8b=a48_0x2372f7;this[_0x886d8b(0x1fe)](_0x886d8b(0x1f5),{'type':'WEBHOOK_PROCESSED','gateway':_0xbeac22,'paymentId':_0x59ea65,'oldStatus':_0x5cd391,'newStatus':_0x170f22,'originalData':_0x2d319b});}[a48_0x2372f7(0x224)](_0x26cfd7,_0x7e6f6e,_0x5d07f0){const _0x4ae10b=a48_0x2372f7;this[_0x4ae10b(0x1fe)](_0x4ae10b(0x22c),{'type':_0x4ae10b(0x1f3),'gateway':_0x26cfd7,'error':_0x7e6f6e instanceof Error?{'message':_0x7e6f6e[_0x4ae10b(0x21a)],'stack':_0x7e6f6e[_0x4ae10b(0x20d)]}:_0x7e6f6e,'originalData':_0x5d07f0});}[a48_0x2372f7(0x211)](_0x50841f){const _0x32642e=a48_0x2372f7;this[_0x32642e(0x1fe)](_0x32642e(0x1e7),{'type':_0x32642e(0x1df),..._0x50841f});}['logCoinToPayError'](_0x34c335){const _0x4402af=a48_0x2372f7;this[_0x4402af(0x1fe)](_0x4402af(0x1fd),{'type':'COINTOPAY_ERROR',..._0x34c335});}[a48_0x2372f7(0x206)](_0x298244,_0x1d310d,_0x133259,_0x33fe7a,_0xab2f7d,_0x12c07d){const _0x5eea39=a48_0x2372f7;this[_0x5eea39(0x1fe)](_0x5eea39(0x22a),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x298244,'webhookUrl':_0x1d310d,'event':_0x133259,'status':_0x33fe7a,'responseTime':_0xab2f7d,'payload':_0x12c07d});}['logShopWebhookError'](_0x4f94b3,_0x47a5bb,_0x6939bf,_0x545b11,_0x3ad4c8){const _0x1e33aa=a48_0x2372f7;this[_0x1e33aa(0x1fe)](_0x1e33aa(0x1e4),{'type':_0x1e33aa(0x21c),'shopId':_0x4f94b3,'webhookUrl':_0x47a5bb,'event':_0x6939bf,'error':_0x545b11 instanceof Error?{'message':_0x545b11[_0x1e33aa(0x21a)],'stack':_0x545b11[_0x1e33aa(0x20d)]}:_0x545b11,'payload':_0x3ad4c8});}[a48_0x2372f7(0x1e3)](_0x18bcdb,_0x37ffad,_0x13c9a9,_0x1b3529,_0x2b9c35){const _0xa43886=a48_0x2372f7;this['writeLog']('payments_created',{'type':_0xa43886(0x1ef),'gateway':_0x18bcdb,'paymentId':_0x37ffad,'shopId':_0x13c9a9,'amount':_0x1b3529,'currency':_0x2b9c35});}[a48_0x2372f7(0x1e0)](_0x172ee2,_0x593717,_0x2fc9f8,_0x35bdeb,_0x44064e){const _0x1154ec=a48_0x2372f7;this[_0x1154ec(0x1fe)]('api_calls',{'type':_0x1154ec(0x215),'endpoint':_0x172ee2,'method':_0x593717,'userId':_0x2fc9f8,'userRole':_0x35bdeb,'requestData':_0x44064e});}[a48_0x2372f7(0x1f6)](){const _0x50476b=a48_0x2372f7;try{const _0x17fa38=fs_1[_0x50476b(0x1de)][_0x50476b(0x218)](this[_0x50476b(0x213)]),_0x5e70ec=_0x17fa38['filter'](_0x20579c=>_0x20579c[_0x50476b(0x1f7)](_0x50476b(0x209))),_0x53f911=[...new Set(_0x5e70ec[_0x50476b(0x227)](_0x12dae8=>_0x12dae8[_0x50476b(0x217)]('_')[0x0]))],_0x31ac84=_0x5e70ec[_0x50476b(0x227)](_0x23a81f=>{const _0x4aa48b=_0x50476b,_0x228167=path_1[_0x4aa48b(0x1de)]['join'](this[_0x4aa48b(0x213)],_0x23a81f),_0x2bf493=fs_1['default'][_0x4aa48b(0x210)](_0x228167),[_0x5b0539,_0xfdda27]=_0x23a81f[_0x4aa48b(0x1f0)]('.log','')['split']('_');return{'type':_0x5b0539,'date':_0xfdda27,'size':_0x2bf493[_0x4aa48b(0x201)]};})['sort']((_0x213b0b,_0x4b301b)=>_0x4b301b['date']['localeCompare'](_0x213b0b[_0x50476b(0x20b)]));return{'totalFiles':_0x5e70ec[_0x50476b(0x205)],'logTypes':_0x53f911,'latestLogs':_0x31ac84[_0x50476b(0x202)](0x0,0xa)};}catch(_0x24da40){return console[_0x50476b(0x1e1)](_0x50476b(0x208),_0x24da40),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x2372f7(0x1e9)](_0x5e0d36=0x1e){const _0x8dcabc=a48_0x2372f7;try{const _0x4f4b8b=fs_1[_0x8dcabc(0x1de)][_0x8dcabc(0x218)](this['logsDir']),_0x196514=new Date();_0x196514['setDate'](_0x196514[_0x8dcabc(0x21f)]()-_0x5e0d36);let _0x272e34=0x0;_0x4f4b8b[_0x8dcabc(0x1eb)](_0x26eabe=>{const _0x46a092=_0x8dcabc;if(!_0x26eabe['endsWith'](_0x46a092(0x209)))return;const _0x4a29cd=path_1['default'][_0x46a092(0x226)](this[_0x46a092(0x213)],_0x26eabe),_0x2432a2=fs_1['default'][_0x46a092(0x210)](_0x4a29cd);_0x2432a2[_0x46a092(0x1ec)]<_0x196514&&(fs_1[_0x46a092(0x1de)][_0x46a092(0x1e2)](_0x4a29cd),_0x272e34++,console[_0x46a092(0x200)](_0x46a092(0x229)+_0x26eabe));}),console[_0x8dcabc(0x200)](_0x8dcabc(0x1f9)+_0x272e34+_0x8dcabc(0x1fb)+_0x5e0d36+'\x20days)');}catch(_0x57517a){console['error'](_0x8dcabc(0x20f),_0x57517a);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();