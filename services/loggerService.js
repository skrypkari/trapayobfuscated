'use strict';const a49_0x18d3c4=a49_0x2599;(function(_0x14ad74,_0x3e35b5){const _0x1ac2ca=a49_0x2599,_0x10abea=_0x14ad74();while(!![]){try{const _0x548c4d=-parseInt(_0x1ac2ca(0x10e))/0x1+parseInt(_0x1ac2ca(0xed))/0x2+-parseInt(_0x1ac2ca(0x107))/0x3+parseInt(_0x1ac2ca(0x11a))/0x4*(parseInt(_0x1ac2ca(0xff))/0x5)+parseInt(_0x1ac2ca(0x128))/0x6*(-parseInt(_0x1ac2ca(0x136))/0x7)+parseInt(_0x1ac2ca(0xf1))/0x8+parseInt(_0x1ac2ca(0x112))/0x9;if(_0x548c4d===_0x3e35b5)break;else _0x10abea['push'](_0x10abea['shift']());}catch(_0x2619ae){_0x10abea['push'](_0x10abea['shift']());}}}(a49_0x214a,0xd375b));var __importDefault=this&&this[a49_0x18d3c4(0x12a)]||function(_0x403d68){const _0x323efe=a49_0x18d3c4;return _0x403d68&&_0x403d68[_0x323efe(0x11e)]?_0x403d68:{'default':_0x403d68};};function a49_0x214a(){const _0x555b83=['logWebhookError','12LWpNoq','logWhiteDomainError','__importDefault','logApiCall','Failed\x20to\x20write\x20','REQUEST','ensureLogsDirectory','logWhiteDomainRequest','webhooks_received','slice','length','white_domain_responses','toISOString','SHOP_WEBHOOK_ERROR','491281MXbvgx','SHOP_WEBHOOK_SENT','size','logWhiteDomainResponse','writeLog','WEBHOOK_RECEIVED','stringify','shop_webhooks_sent','📁\x20Created\x20logs\x20directory:\x20','api_calls','filter','\x20days)','678828hlbtUM','statSync','replace','shop_webhooks_errors','7335392wvVavx','.log','webhooks_errors','logs','date','setDate','payments_created','PAYMENT_CREATED','WEBHOOK_ERROR','logsDir','path','mkdirSync','split','🗑️\x20Deleted\x20old\x20log\x20file:\x20','115cDZlxH','log','message','map','COINTOPAY_STATUS_CHANGE','logPaymentCreated','forEach','error','4413921xTRqCr','getLogFileName','getLogStats','localeCompare','logShopWebhookSent','stack','webhooks_processed','171138wGxygM','join','logWebhookReceived','endsWith','3923757NkfdFo','existsSync','white_domain_errors','logWebhookProcessed','loggerService','Failed\x20to\x20clean\x20old\x20logs:','utf8','API_CALL','166372uNYQeR','\x20log:','logCoinToPayStatus','WEBHOOK_PROCESSED','__esModule','getDate','RESPONSE','unlinkSync','default','cwd','cointopay_errors','readdirSync','LoggerService'];a49_0x214a=function(){return _0x555b83;};return a49_0x214a();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a49_0x18d3c4(0x126)]=void 0x0;function a49_0x2599(_0x5233b6,_0x26e746){const _0x214a39=a49_0x214a();return a49_0x2599=function(_0x2599e5,_0x4b241c){_0x2599e5=_0x2599e5-0xe5;let _0x424547=_0x214a39[_0x2599e5];return _0x424547;},a49_0x2599(_0x5233b6,_0x26e746);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x18d3c4(0xfb)));class LoggerService{constructor(){const _0x15a674=a49_0x18d3c4;this[_0x15a674(0xfa)]=path_1[_0x15a674(0x122)][_0x15a674(0x10f)](process[_0x15a674(0x123)](),_0x15a674(0xf4)),this[_0x15a674(0x12e)]();}[a49_0x18d3c4(0x12e)](){const _0x35995d=a49_0x18d3c4;!fs_1[_0x35995d(0x122)][_0x35995d(0x113)](this[_0x35995d(0xfa)])&&(fs_1[_0x35995d(0x122)][_0x35995d(0xfc)](this['logsDir'],{'recursive':!![]}),console[_0x35995d(0x100)](_0x35995d(0xe9)+this[_0x35995d(0xfa)]));}['getLogFileName'](_0x4c366f){const _0x4035dc=a49_0x18d3c4,_0x275c6b=new Date()[_0x4035dc(0x134)]()[_0x4035dc(0xfd)]('T')[0x0];return path_1[_0x4035dc(0x122)][_0x4035dc(0x10f)](this[_0x4035dc(0xfa)],_0x4c366f+'_'+_0x275c6b+'.log');}['writeLog'](_0x1aebb5,_0x26cc8e){const _0x1f826c=a49_0x18d3c4;try{const _0x1accf6=new Date()['toISOString'](),_0x3b8bbf={'timestamp':_0x1accf6,..._0x26cc8e},_0x3ba8fb=JSON[_0x1f826c(0xe7)](_0x3b8bbf)+'\x0a',_0x45066e=this[_0x1f826c(0x108)](_0x1aebb5);fs_1['default']['appendFileSync'](_0x45066e,_0x3ba8fb,_0x1f826c(0x118));}catch(_0xfe5487){console[_0x1f826c(0x106)](_0x1f826c(0x12c)+_0x1aebb5+_0x1f826c(0x11b),_0xfe5487);}}[a49_0x18d3c4(0x12f)](_0xb710e8,_0x9964c8,_0x3038a8,_0x10a9d3){const _0x161822=a49_0x18d3c4;this[_0x161822(0xe5)]('white_domain_requests',{'type':_0x161822(0x12d),'gateway':_0xb710e8,'endpoint':_0x9964c8,'method':_0x3038a8,'data':_0x10a9d3});}[a49_0x18d3c4(0x139)](_0x200d3c,_0x37a00b,_0x6ebd5f,_0x8a359e,_0x35a771){const _0x1139f0=a49_0x18d3c4;this[_0x1139f0(0xe5)](_0x1139f0(0x133),{'type':_0x1139f0(0x120),'gateway':_0x200d3c,'endpoint':_0x37a00b,'status':_0x6ebd5f,'responseTime':_0x35a771,'data':_0x8a359e});}[a49_0x18d3c4(0x129)](_0x1e8e1e,_0x36ac9d,_0x2dd018){const _0x4d126f=a49_0x18d3c4;this[_0x4d126f(0xe5)](_0x4d126f(0x114),{'type':'ERROR','gateway':_0x1e8e1e,'endpoint':_0x36ac9d,'error':_0x2dd018 instanceof Error?{'message':_0x2dd018[_0x4d126f(0x101)],'stack':_0x2dd018[_0x4d126f(0x10c)]}:_0x2dd018});}[a49_0x18d3c4(0x110)](_0x5df549,_0x5a2bea,_0x3c6f69){const _0x48ff60=a49_0x18d3c4;this[_0x48ff60(0xe5)](_0x48ff60(0x130),{'type':_0x48ff60(0xe6),'gateway':_0x5df549,'headers':_0x3c6f69,'data':_0x5a2bea});}[a49_0x18d3c4(0x115)](_0x3311ac,_0x5caa55,_0x67a5a1,_0x43867a,_0x2bbfab){const _0x1412ae=a49_0x18d3c4;this[_0x1412ae(0xe5)](_0x1412ae(0x10d),{'type':_0x1412ae(0x11d),'gateway':_0x3311ac,'paymentId':_0x5caa55,'oldStatus':_0x67a5a1,'newStatus':_0x43867a,'originalData':_0x2bbfab});}[a49_0x18d3c4(0x127)](_0x35a783,_0x48324f,_0x5a5370){const _0x2824a0=a49_0x18d3c4;this['writeLog'](_0x2824a0(0xf3),{'type':_0x2824a0(0xf9),'gateway':_0x35a783,'error':_0x48324f instanceof Error?{'message':_0x48324f['message'],'stack':_0x48324f['stack']}:_0x48324f,'originalData':_0x5a5370});}[a49_0x18d3c4(0x11c)](_0x4e01f1){const _0x4bc6ee=a49_0x18d3c4;this['writeLog']('cointopay_status_changes',{'type':_0x4bc6ee(0x103),..._0x4e01f1});}['logCoinToPayError'](_0x4ca5b3){const _0x4bb2a1=a49_0x18d3c4;this[_0x4bb2a1(0xe5)](_0x4bb2a1(0x124),{'type':'COINTOPAY_ERROR',..._0x4ca5b3});}[a49_0x18d3c4(0x10b)](_0x485c57,_0x179f27,_0x3b4769,_0xd92b16,_0x538a38,_0x56e3c0){const _0x590116=a49_0x18d3c4;this[_0x590116(0xe5)](_0x590116(0xe8),{'type':_0x590116(0x137),'shopId':_0x485c57,'webhookUrl':_0x179f27,'event':_0x3b4769,'status':_0xd92b16,'responseTime':_0x538a38,'payload':_0x56e3c0});}['logShopWebhookError'](_0x42817a,_0x543f28,_0x7f2c6d,_0x19798e,_0x15d576){const _0x2309c2=a49_0x18d3c4;this[_0x2309c2(0xe5)](_0x2309c2(0xf0),{'type':_0x2309c2(0x135),'shopId':_0x42817a,'webhookUrl':_0x543f28,'event':_0x7f2c6d,'error':_0x19798e instanceof Error?{'message':_0x19798e[_0x2309c2(0x101)],'stack':_0x19798e['stack']}:_0x19798e,'payload':_0x15d576});}[a49_0x18d3c4(0x104)](_0x15df34,_0x3bd468,_0x3f29de,_0xd06e35,_0x3d6af7){const _0x515432=a49_0x18d3c4;this['writeLog'](_0x515432(0xf7),{'type':_0x515432(0xf8),'gateway':_0x15df34,'paymentId':_0x3bd468,'shopId':_0x3f29de,'amount':_0xd06e35,'currency':_0x3d6af7});}[a49_0x18d3c4(0x12b)](_0x3771de,_0x4dc7ce,_0x5124a7,_0xa659a9,_0xfa89c9){const _0x112917=a49_0x18d3c4;this[_0x112917(0xe5)](_0x112917(0xea),{'type':_0x112917(0x119),'endpoint':_0x3771de,'method':_0x4dc7ce,'userId':_0x5124a7,'userRole':_0xa659a9,'requestData':_0xfa89c9});}[a49_0x18d3c4(0x109)](){const _0x5a114b=a49_0x18d3c4;try{const _0x377f2d=fs_1[_0x5a114b(0x122)][_0x5a114b(0x125)](this[_0x5a114b(0xfa)]),_0x46d571=_0x377f2d[_0x5a114b(0xeb)](_0x375a81=>_0x375a81[_0x5a114b(0x111)](_0x5a114b(0xf2))),_0xbbc548=[...new Set(_0x46d571[_0x5a114b(0x102)](_0x3c377e=>_0x3c377e[_0x5a114b(0xfd)]('_')[0x0]))],_0x4bbcb7=_0x46d571[_0x5a114b(0x102)](_0xc9d178=>{const _0x4f0246=_0x5a114b,_0x3895d5=path_1[_0x4f0246(0x122)]['join'](this['logsDir'],_0xc9d178),_0x29ac34=fs_1[_0x4f0246(0x122)][_0x4f0246(0xee)](_0x3895d5),[_0xd4b2a9,_0x512437]=_0xc9d178[_0x4f0246(0xef)](_0x4f0246(0xf2),'')['split']('_');return{'type':_0xd4b2a9,'date':_0x512437,'size':_0x29ac34[_0x4f0246(0x138)]};})['sort']((_0x502395,_0xc63f11)=>_0xc63f11[_0x5a114b(0xf5)][_0x5a114b(0x10a)](_0x502395[_0x5a114b(0xf5)]));return{'totalFiles':_0x46d571[_0x5a114b(0x132)],'logTypes':_0xbbc548,'latestLogs':_0x4bbcb7[_0x5a114b(0x131)](0x0,0xa)};}catch(_0x2a802e){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x2a802e),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x27a633=0x1e){const _0x2f7c7d=a49_0x18d3c4;try{const _0x47d73d=fs_1[_0x2f7c7d(0x122)][_0x2f7c7d(0x125)](this[_0x2f7c7d(0xfa)]),_0x49ab0b=new Date();_0x49ab0b[_0x2f7c7d(0xf6)](_0x49ab0b[_0x2f7c7d(0x11f)]()-_0x27a633);let _0x378ba6=0x0;_0x47d73d[_0x2f7c7d(0x105)](_0x5e8edf=>{const _0x43f717=_0x2f7c7d;if(!_0x5e8edf['endsWith'](_0x43f717(0xf2)))return;const _0x421e57=path_1[_0x43f717(0x122)]['join'](this['logsDir'],_0x5e8edf),_0x4f9c7a=fs_1['default'][_0x43f717(0xee)](_0x421e57);_0x4f9c7a['mtime']<_0x49ab0b&&(fs_1[_0x43f717(0x122)][_0x43f717(0x121)](_0x421e57),_0x378ba6++,console[_0x43f717(0x100)](_0x43f717(0xfe)+_0x5e8edf));}),console[_0x2f7c7d(0x100)]('🧹\x20Cleaned\x20'+_0x378ba6+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x27a633+_0x2f7c7d(0xec));}catch(_0x814df3){console['error'](_0x2f7c7d(0x117),_0x814df3);}}}exports[a49_0x18d3c4(0x126)]=LoggerService,exports[a49_0x18d3c4(0x116)]=new LoggerService();