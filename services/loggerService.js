'use strict';function a51_0x3fb3(_0x24b919,_0x2b8657){const _0x52b0b8=a51_0x52b0();return a51_0x3fb3=function(_0x3fb31e,_0x325e65){_0x3fb31e=_0x3fb31e-0x65;let _0x3b4706=_0x52b0b8[_0x3fb31e];return _0x3b4706;},a51_0x3fb3(_0x24b919,_0x2b8657);}const a51_0x17308c=a51_0x3fb3;(function(_0x1ec525,_0x4feed4){const _0x41429c=a51_0x3fb3,_0x3f8e11=_0x1ec525();while(!![]){try{const _0x5e9088=-parseInt(_0x41429c(0x70))/0x1*(-parseInt(_0x41429c(0xa3))/0x2)+-parseInt(_0x41429c(0x89))/0x3*(parseInt(_0x41429c(0x8c))/0x4)+-parseInt(_0x41429c(0x8f))/0x5+parseInt(_0x41429c(0x7b))/0x6+-parseInt(_0x41429c(0x7a))/0x7*(parseInt(_0x41429c(0x83))/0x8)+-parseInt(_0x41429c(0x65))/0x9*(parseInt(_0x41429c(0x6c))/0xa)+parseInt(_0x41429c(0x79))/0xb;if(_0x5e9088===_0x4feed4)break;else _0x3f8e11['push'](_0x3f8e11['shift']());}catch(_0x177cb2){_0x3f8e11['push'](_0x3f8e11['shift']());}}}(a51_0x52b0,0x1b5f5));var __importDefault=this&&this[a51_0x17308c(0x6a)]||function(_0x538558){return _0x538558&&_0x538558['__esModule']?_0x538558:{'default':_0x538558};};Object[a51_0x17308c(0x84)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a51_0x17308c(0x91)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x17308c(0x6e)));function a51_0x52b0(){const _0x2f729c=['.log','cleanOldLogs','logWebhookProcessed','getDate','stack','endsWith','cointopay_errors','API_CALL','message','PAYMENT_CREATED','Failed\x20to\x20write\x20','log','statSync','621sbodTm','📁\x20Created\x20logs\x20directory:\x20','🗑️\x20Deleted\x20old\x20log\x20file:\x20','getLogStats','localeCompare','__importDefault','logWhiteDomainResponse','3790ODFLtI','readdirSync','path','logPaymentCreated','10fNTnlL','utf8','sort','logsDir','logs','webhooks_processed','SHOP_WEBHOOK_SENT','join','forEach','2345651uQRZtd','1196111SPkHpX','1005360ixWWLt','getLogFileName','ensureLogsDirectory','toISOString','logWhiteDomainError','loggerService','error','logWhiteDomainRequest','8tePaIz','defineProperty','setDate','logWebhookError','SHOP_WEBHOOK_ERROR','writeLog','3606TQuAXE','appendFileSync','WEBHOOK_ERROR','300zPqVym','map','slice','676350LOOjhK','webhooks_errors','LoggerService','length','logCoinToPayStatus','api_calls','stringify','cwd','split','unlinkSync','date','default','logShopWebhookError','white_domain_responses','logApiCall','REQUEST','cointopay_status_changes','white_domain_errors','RESPONSE','\x20log:','30752bwckUA'];a51_0x52b0=function(){return _0x2f729c;};return a51_0x52b0();}class LoggerService{constructor(){const _0x576750=a51_0x17308c;this[_0x576750(0x73)]=path_1['default'][_0x576750(0x77)](process[_0x576750(0x96)](),_0x576750(0x74)),this['ensureLogsDirectory']();}[a51_0x17308c(0x7d)](){const _0x405e39=a51_0x17308c;!fs_1['default']['existsSync'](this['logsDir'])&&(fs_1[_0x405e39(0x9a)]['mkdirSync'](this[_0x405e39(0x73)],{'recursive':!![]}),console[_0x405e39(0xaf)](_0x405e39(0x66)+this[_0x405e39(0x73)]));}[a51_0x17308c(0x7c)](_0x2315e7){const _0x319cd8=a51_0x17308c,_0x2f1e42=new Date()['toISOString']()[_0x319cd8(0x97)]('T')[0x0];return path_1[_0x319cd8(0x9a)]['join'](this[_0x319cd8(0x73)],_0x2315e7+'_'+_0x2f1e42+'.log');}[a51_0x17308c(0x88)](_0x54f64a,_0x1ad83c){const _0x13c2a4=a51_0x17308c;try{const _0x22eec2=new Date()[_0x13c2a4(0x7e)](),_0x231314={'timestamp':_0x22eec2,..._0x1ad83c},_0x56ed42=JSON[_0x13c2a4(0x95)](_0x231314)+'\x0a',_0x5ccc51=this['getLogFileName'](_0x54f64a);fs_1['default'][_0x13c2a4(0x8a)](_0x5ccc51,_0x56ed42,_0x13c2a4(0x71));}catch(_0x1076ae){console[_0x13c2a4(0x81)](_0x13c2a4(0xae)+_0x54f64a+_0x13c2a4(0xa2),_0x1076ae);}}[a51_0x17308c(0x82)](_0x5dfdb5,_0xc8e657,_0x5cb6f9,_0x3aa07d){const _0x4c6cfe=a51_0x17308c;this[_0x4c6cfe(0x88)]('white_domain_requests',{'type':_0x4c6cfe(0x9e),'gateway':_0x5dfdb5,'endpoint':_0xc8e657,'method':_0x5cb6f9,'data':_0x3aa07d});}[a51_0x17308c(0x6b)](_0x166979,_0x331eb9,_0x4925ff,_0x51f071,_0x4b15c7){const _0x30a045=a51_0x17308c;this[_0x30a045(0x88)](_0x30a045(0x9c),{'type':_0x30a045(0xa1),'gateway':_0x166979,'endpoint':_0x331eb9,'status':_0x4925ff,'responseTime':_0x4b15c7,'data':_0x51f071});}[a51_0x17308c(0x7f)](_0x586b25,_0x32d442,_0x71da43){const _0x26f554=a51_0x17308c;this['writeLog'](_0x26f554(0xa0),{'type':'ERROR','gateway':_0x586b25,'endpoint':_0x32d442,'error':_0x71da43 instanceof Error?{'message':_0x71da43[_0x26f554(0xac)],'stack':_0x71da43[_0x26f554(0xa8)]}:_0x71da43});}['logWebhookReceived'](_0x24d97e,_0x5edc9d,_0x392ce8){const _0x467705=a51_0x17308c;this[_0x467705(0x88)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x24d97e,'headers':_0x392ce8,'data':_0x5edc9d});}[a51_0x17308c(0xa6)](_0x27ea0a,_0x4371e3,_0xae2740,_0x1518eb,_0x4bffef){const _0xd53eb8=a51_0x17308c;this[_0xd53eb8(0x88)](_0xd53eb8(0x75),{'type':'WEBHOOK_PROCESSED','gateway':_0x27ea0a,'paymentId':_0x4371e3,'oldStatus':_0xae2740,'newStatus':_0x1518eb,'originalData':_0x4bffef});}[a51_0x17308c(0x86)](_0x901f9,_0x136da0,_0x3d91eb){const _0x55f124=a51_0x17308c;this[_0x55f124(0x88)](_0x55f124(0x90),{'type':_0x55f124(0x8b),'gateway':_0x901f9,'error':_0x136da0 instanceof Error?{'message':_0x136da0[_0x55f124(0xac)],'stack':_0x136da0[_0x55f124(0xa8)]}:_0x136da0,'originalData':_0x3d91eb});}[a51_0x17308c(0x93)](_0x1ef626){const _0x23f0af=a51_0x17308c;this[_0x23f0af(0x88)](_0x23f0af(0x9f),{'type':'COINTOPAY_STATUS_CHANGE',..._0x1ef626});}['logCoinToPayError'](_0x4247e6){const _0x5890fa=a51_0x17308c;this[_0x5890fa(0x88)](_0x5890fa(0xaa),{'type':'COINTOPAY_ERROR',..._0x4247e6});}['logShopWebhookSent'](_0x46b648,_0x1d4c94,_0x98a6c7,_0x10a8de,_0x5f57e5,_0x17e1f7){const _0x57713b=a51_0x17308c;this[_0x57713b(0x88)]('shop_webhooks_sent',{'type':_0x57713b(0x76),'shopId':_0x46b648,'webhookUrl':_0x1d4c94,'event':_0x98a6c7,'status':_0x10a8de,'responseTime':_0x5f57e5,'payload':_0x17e1f7});}[a51_0x17308c(0x9b)](_0x4b03b6,_0xee7199,_0x25c501,_0x30fc01,_0x5c9385){const _0x560986=a51_0x17308c;this[_0x560986(0x88)]('shop_webhooks_errors',{'type':_0x560986(0x87),'shopId':_0x4b03b6,'webhookUrl':_0xee7199,'event':_0x25c501,'error':_0x30fc01 instanceof Error?{'message':_0x30fc01[_0x560986(0xac)],'stack':_0x30fc01['stack']}:_0x30fc01,'payload':_0x5c9385});}[a51_0x17308c(0x6f)](_0x88ae2b,_0x35419d,_0x2e1f12,_0x2926c8,_0x13cc22){const _0x42ddbc=a51_0x17308c;this[_0x42ddbc(0x88)]('payments_created',{'type':_0x42ddbc(0xad),'gateway':_0x88ae2b,'paymentId':_0x35419d,'shopId':_0x2e1f12,'amount':_0x2926c8,'currency':_0x13cc22});}[a51_0x17308c(0x9d)](_0x1c486f,_0x22ebb9,_0x57ff4d,_0x219ab1,_0x3c5373){const _0x3a90f8=a51_0x17308c;this[_0x3a90f8(0x88)](_0x3a90f8(0x94),{'type':_0x3a90f8(0xab),'endpoint':_0x1c486f,'method':_0x22ebb9,'userId':_0x57ff4d,'userRole':_0x219ab1,'requestData':_0x3c5373});}[a51_0x17308c(0x68)](){const _0x436908=a51_0x17308c;try{const _0x18c779=fs_1['default'][_0x436908(0x6d)](this[_0x436908(0x73)]),_0x5595b2=_0x18c779['filter'](_0x3e76a1=>_0x3e76a1[_0x436908(0xa9)](_0x436908(0xa4))),_0x31894d=[...new Set(_0x5595b2[_0x436908(0x8d)](_0x4f7a70=>_0x4f7a70[_0x436908(0x97)]('_')[0x0]))],_0x3c9dd6=_0x5595b2[_0x436908(0x8d)](_0x58d693=>{const _0x1b8a62=_0x436908,_0x5221ed=path_1[_0x1b8a62(0x9a)][_0x1b8a62(0x77)](this[_0x1b8a62(0x73)],_0x58d693),_0x347347=fs_1[_0x1b8a62(0x9a)]['statSync'](_0x5221ed),[_0x5c8583,_0x2615fb]=_0x58d693['replace']('.log','')[_0x1b8a62(0x97)]('_');return{'type':_0x5c8583,'date':_0x2615fb,'size':_0x347347['size']};})[_0x436908(0x72)]((_0x536ac6,_0x17c0ac)=>_0x17c0ac[_0x436908(0x99)][_0x436908(0x69)](_0x536ac6[_0x436908(0x99)]));return{'totalFiles':_0x5595b2[_0x436908(0x92)],'logTypes':_0x31894d,'latestLogs':_0x3c9dd6[_0x436908(0x8e)](0x0,0xa)};}catch(_0xa59b14){return console[_0x436908(0x81)]('Failed\x20to\x20get\x20log\x20stats:',_0xa59b14),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x17308c(0xa5)](_0xa6b9d9=0x1e){const _0x3e0e20=a51_0x17308c;try{const _0x3ff48d=fs_1['default'][_0x3e0e20(0x6d)](this[_0x3e0e20(0x73)]),_0x4aef1e=new Date();_0x4aef1e[_0x3e0e20(0x85)](_0x4aef1e[_0x3e0e20(0xa7)]()-_0xa6b9d9);let _0x26da6d=0x0;_0x3ff48d[_0x3e0e20(0x78)](_0x32d8be=>{const _0x507801=_0x3e0e20;if(!_0x32d8be['endsWith'](_0x507801(0xa4)))return;const _0x5baa4e=path_1['default'][_0x507801(0x77)](this[_0x507801(0x73)],_0x32d8be),_0x18d578=fs_1[_0x507801(0x9a)][_0x507801(0xb0)](_0x5baa4e);_0x18d578['mtime']<_0x4aef1e&&(fs_1['default'][_0x507801(0x98)](_0x5baa4e),_0x26da6d++,console[_0x507801(0xaf)](_0x507801(0x67)+_0x32d8be));}),console[_0x3e0e20(0xaf)]('🧹\x20Cleaned\x20'+_0x26da6d+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0xa6b9d9+'\x20days)');}catch(_0x1d2fe9){console[_0x3e0e20(0x81)]('Failed\x20to\x20clean\x20old\x20logs:',_0x1d2fe9);}}}exports[a51_0x17308c(0x91)]=LoggerService,exports[a51_0x17308c(0x80)]=new LoggerService();