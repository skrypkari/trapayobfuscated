'use strict';const a48_0x3459ab=a48_0x6fd9;function a48_0x6fd9(_0x3ad83e,_0x47fd3a){const _0x4731d7=a48_0x4731();return a48_0x6fd9=function(_0x6fd92d,_0x1bc47a){_0x6fd92d=_0x6fd92d-0x169;let _0x4edfa9=_0x4731d7[_0x6fd92d];return _0x4edfa9;},a48_0x6fd9(_0x3ad83e,_0x47fd3a);}(function(_0x37e4b3,_0x59e7f4){const _0x589872=a48_0x6fd9,_0xff120e=_0x37e4b3();while(!![]){try{const _0x52000c=-parseInt(_0x589872(0x171))/0x1+parseInt(_0x589872(0x1a4))/0x2+parseInt(_0x589872(0x1a0))/0x3+parseInt(_0x589872(0x1b0))/0x4*(parseInt(_0x589872(0x188))/0x5)+-parseInt(_0x589872(0x176))/0x6+parseInt(_0x589872(0x175))/0x7+-parseInt(_0x589872(0x1b1))/0x8*(-parseInt(_0x589872(0x1b4))/0x9);if(_0x52000c===_0x59e7f4)break;else _0xff120e['push'](_0xff120e['shift']());}catch(_0x3ab691){_0xff120e['push'](_0xff120e['shift']());}}}(a48_0x4731,0x8a8f1));var __importDefault=this&&this[a48_0x3459ab(0x1ac)]||function(_0x6496b1){const _0x3e4e26=a48_0x3459ab;return _0x6496b1&&_0x6496b1[_0x3e4e26(0x16d)]?_0x6496b1:{'default':_0x6496b1};};Object['defineProperty'](exports,a48_0x3459ab(0x16d),{'value':!![]}),exports[a48_0x3459ab(0x1a7)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x3459ab(0x1b3)));class LoggerService{constructor(){const _0x1c7a54=a48_0x3459ab;this['logsDir']=path_1[_0x1c7a54(0x1a6)]['join'](process[_0x1c7a54(0x191)](),'logs'),this[_0x1c7a54(0x1b7)]();}[a48_0x3459ab(0x1b7)](){const _0x50b77d=a48_0x3459ab;!fs_1[_0x50b77d(0x1a6)][_0x50b77d(0x19e)](this[_0x50b77d(0x1a5)])&&(fs_1[_0x50b77d(0x1a6)][_0x50b77d(0x1a9)](this[_0x50b77d(0x1a5)],{'recursive':!![]}),console[_0x50b77d(0x19f)](_0x50b77d(0x194)+this['logsDir']));}[a48_0x3459ab(0x19c)](_0x41254a){const _0x5bf0b6=a48_0x3459ab,_0x533508=new Date()[_0x5bf0b6(0x193)]()[_0x5bf0b6(0x16a)]('T')[0x0];return path_1[_0x5bf0b6(0x1a6)][_0x5bf0b6(0x17b)](this['logsDir'],_0x41254a+'_'+_0x533508+_0x5bf0b6(0x1a2));}['writeLog'](_0x36bc2c,_0x5d11ca){const _0x7f2095=a48_0x3459ab;try{const _0x3bd44=new Date()[_0x7f2095(0x193)](),_0x5f4c8e={'timestamp':_0x3bd44,..._0x5d11ca},_0x8eb4ca=JSON[_0x7f2095(0x17e)](_0x5f4c8e)+'\x0a',_0x401c8f=this['getLogFileName'](_0x36bc2c);fs_1[_0x7f2095(0x1a6)][_0x7f2095(0x18c)](_0x401c8f,_0x8eb4ca,_0x7f2095(0x172));}catch(_0x3f61b6){console[_0x7f2095(0x18a)]('Failed\x20to\x20write\x20'+_0x36bc2c+_0x7f2095(0x186),_0x3f61b6);}}['logWhiteDomainRequest'](_0x319cba,_0x272be8,_0x46f0ae,_0x2bab0a){const _0x50829a=a48_0x3459ab;this[_0x50829a(0x18f)]('white_domain_requests',{'type':_0x50829a(0x192),'gateway':_0x319cba,'endpoint':_0x272be8,'method':_0x46f0ae,'data':_0x2bab0a});}[a48_0x3459ab(0x183)](_0x3dd1fd,_0x375e82,_0x5307ac,_0x542671,_0x1011b0){const _0xec165c=a48_0x3459ab;this['writeLog'](_0xec165c(0x199),{'type':_0xec165c(0x185),'gateway':_0x3dd1fd,'endpoint':_0x375e82,'status':_0x5307ac,'responseTime':_0x1011b0,'data':_0x542671});}[a48_0x3459ab(0x16b)](_0x5cac4d,_0xf75786,_0x2efe06){const _0xc3cc10=a48_0x3459ab;this[_0xc3cc10(0x18f)](_0xc3cc10(0x1b5),{'type':_0xc3cc10(0x16c),'gateway':_0x5cac4d,'endpoint':_0xf75786,'error':_0x2efe06 instanceof Error?{'message':_0x2efe06[_0xc3cc10(0x1ab)],'stack':_0x2efe06['stack']}:_0x2efe06});}[a48_0x3459ab(0x1aa)](_0x18676e,_0x51c5e5,_0x545329){const _0x13920a=a48_0x3459ab;this[_0x13920a(0x18f)](_0x13920a(0x173),{'type':_0x13920a(0x187),'gateway':_0x18676e,'headers':_0x545329,'data':_0x51c5e5});}['logWebhookProcessed'](_0x557755,_0x54d77a,_0x3e3cfe,_0x5d8bb3,_0x49cb5e){const _0x2d8dc1=a48_0x3459ab;this[_0x2d8dc1(0x18f)]('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x557755,'paymentId':_0x54d77a,'oldStatus':_0x3e3cfe,'newStatus':_0x5d8bb3,'originalData':_0x49cb5e});}[a48_0x3459ab(0x18b)](_0x472c83,_0xb5b9fb,_0x217fd5){const _0x1b1950=a48_0x3459ab;this[_0x1b1950(0x18f)](_0x1b1950(0x19b),{'type':_0x1b1950(0x1a1),'gateway':_0x472c83,'error':_0xb5b9fb instanceof Error?{'message':_0xb5b9fb['message'],'stack':_0xb5b9fb['stack']}:_0xb5b9fb,'originalData':_0x217fd5});}[a48_0x3459ab(0x177)](_0x43cff0){const _0x48c10a=a48_0x3459ab;this['writeLog'](_0x48c10a(0x195),{'type':_0x48c10a(0x180),..._0x43cff0});}[a48_0x3459ab(0x1ad)](_0xe52357){const _0x3d43fd=a48_0x3459ab;this[_0x3d43fd(0x18f)]('cointopay_errors',{'type':_0x3d43fd(0x196),..._0xe52357});}['logShopWebhookSent'](_0x301608,_0x24e7ec,_0x543c06,_0x3841e7,_0x26f30d,_0x363131){const _0x24d457=a48_0x3459ab;this['writeLog'](_0x24d457(0x181),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x301608,'webhookUrl':_0x24e7ec,'event':_0x543c06,'status':_0x3841e7,'responseTime':_0x26f30d,'payload':_0x363131});}[a48_0x3459ab(0x182)](_0x6136b1,_0x16ef9f,_0x52679e,_0x4b933f,_0x238961){const _0x19b982=a48_0x3459ab;this[_0x19b982(0x18f)](_0x19b982(0x19a),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x6136b1,'webhookUrl':_0x16ef9f,'event':_0x52679e,'error':_0x4b933f instanceof Error?{'message':_0x4b933f[_0x19b982(0x1ab)],'stack':_0x4b933f[_0x19b982(0x1b2)]}:_0x4b933f,'payload':_0x238961});}[a48_0x3459ab(0x19d)](_0x2a4f9a,_0x53d34a,_0x20893d,_0x50a743,_0x2544b3){const _0x19251e=a48_0x3459ab;this['writeLog']('payments_created',{'type':_0x19251e(0x169),'gateway':_0x2a4f9a,'paymentId':_0x53d34a,'shopId':_0x20893d,'amount':_0x50a743,'currency':_0x2544b3});}['logApiCall'](_0x3bc2fd,_0xf1ca44,_0x32d8fc,_0x1a191a,_0x3a1389){const _0x18109d=a48_0x3459ab;this[_0x18109d(0x18f)](_0x18109d(0x18e),{'type':_0x18109d(0x1af),'endpoint':_0x3bc2fd,'method':_0xf1ca44,'userId':_0x32d8fc,'userRole':_0x1a191a,'requestData':_0x3a1389});}[a48_0x3459ab(0x1b6)](){const _0x57ba4b=a48_0x3459ab;try{const _0x3634ef=fs_1[_0x57ba4b(0x1a6)]['readdirSync'](this[_0x57ba4b(0x1a5)]),_0x41fae3=_0x3634ef[_0x57ba4b(0x17f)](_0x1fb2a3=>_0x1fb2a3[_0x57ba4b(0x17d)](_0x57ba4b(0x1a2))),_0x5b9fec=[...new Set(_0x41fae3['map'](_0x543ef8=>_0x543ef8['split']('_')[0x0]))],_0x4c3ee9=_0x41fae3['map'](_0x1aae50=>{const _0x21ad79=_0x57ba4b,_0x30e8cc=path_1[_0x21ad79(0x1a6)][_0x21ad79(0x17b)](this['logsDir'],_0x1aae50),_0x38a5=fs_1[_0x21ad79(0x1a6)]['statSync'](_0x30e8cc),[_0x41827e,_0x4c1ab0]=_0x1aae50[_0x21ad79(0x174)](_0x21ad79(0x1a2),'')[_0x21ad79(0x16a)]('_');return{'type':_0x41827e,'date':_0x4c1ab0,'size':_0x38a5[_0x21ad79(0x197)]};})[_0x57ba4b(0x16e)]((_0x550e9f,_0x1af46b)=>_0x1af46b[_0x57ba4b(0x1ae)][_0x57ba4b(0x198)](_0x550e9f[_0x57ba4b(0x1ae)]));return{'totalFiles':_0x41fae3[_0x57ba4b(0x17a)],'logTypes':_0x5b9fec,'latestLogs':_0x4c3ee9[_0x57ba4b(0x1a8)](0x0,0xa)};}catch(_0x26d674){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x26d674),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x3459ab(0x1a3)](_0x36370a=0x1e){const _0x183bcd=a48_0x3459ab;try{const _0x3d6551=fs_1['default'][_0x183bcd(0x178)](this[_0x183bcd(0x1a5)]),_0x1b2e54=new Date();_0x1b2e54[_0x183bcd(0x179)](_0x1b2e54[_0x183bcd(0x16f)]()-_0x36370a);let _0x1ef234=0x0;_0x3d6551[_0x183bcd(0x170)](_0x3a3bc7=>{const _0x5a7310=_0x183bcd;if(!_0x3a3bc7['endsWith'](_0x5a7310(0x1a2)))return;const _0x2aef09=path_1[_0x5a7310(0x1a6)]['join'](this[_0x5a7310(0x1a5)],_0x3a3bc7),_0x2eb83f=fs_1[_0x5a7310(0x1a6)][_0x5a7310(0x184)](_0x2aef09);_0x2eb83f['mtime']<_0x1b2e54&&(fs_1[_0x5a7310(0x1a6)][_0x5a7310(0x189)](_0x2aef09),_0x1ef234++,console[_0x5a7310(0x19f)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x3a3bc7));}),console[_0x183bcd(0x19f)](_0x183bcd(0x17c)+_0x1ef234+_0x183bcd(0x190)+_0x36370a+'\x20days)');}catch(_0x545682){console[_0x183bcd(0x18a)](_0x183bcd(0x18d),_0x545682);}}}function a48_0x4731(){const _0x3e300e=['unlinkSync','error','logWebhookError','appendFileSync','Failed\x20to\x20clean\x20old\x20logs:','api_calls','writeLog','\x20old\x20log\x20files\x20(older\x20than\x20','cwd','REQUEST','toISOString','📁\x20Created\x20logs\x20directory:\x20','cointopay_status_changes','COINTOPAY_ERROR','size','localeCompare','white_domain_responses','shop_webhooks_errors','webhooks_errors','getLogFileName','logPaymentCreated','existsSync','log','260700FYVrzt','WEBHOOK_ERROR','.log','cleanOldLogs','407266AkUOvO','logsDir','default','loggerService','slice','mkdirSync','logWebhookReceived','message','__importDefault','logCoinToPayError','date','API_CALL','782836SKCFpX','24AAPZsm','stack','path','1734021ZAwWlE','white_domain_errors','getLogStats','ensureLogsDirectory','PAYMENT_CREATED','split','logWhiteDomainError','ERROR','__esModule','sort','getDate','forEach','320529uEEPaa','utf8','webhooks_received','replace','3324188zjEXVA','3906402nogOTx','logCoinToPayStatus','readdirSync','setDate','length','join','🧹\x20Cleaned\x20','endsWith','stringify','filter','COINTOPAY_STATUS_CHANGE','shop_webhooks_sent','logShopWebhookError','logWhiteDomainResponse','statSync','RESPONSE','\x20log:','WEBHOOK_RECEIVED','5xyYVKX'];a48_0x4731=function(){return _0x3e300e;};return a48_0x4731();}exports['LoggerService']=LoggerService,exports[a48_0x3459ab(0x1a7)]=new LoggerService();