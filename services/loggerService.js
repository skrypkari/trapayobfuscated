'use strict';const a67_0x266c11=a67_0x105a;(function(_0x1e75ac,_0x56f472){const _0x46a5e4=a67_0x105a,_0x1c6724=_0x1e75ac();while(!![]){try{const _0x4bcdac=-parseInt(_0x46a5e4(0x9e))/0x1*(-parseInt(_0x46a5e4(0x7a))/0x2)+-parseInt(_0x46a5e4(0x8f))/0x3+-parseInt(_0x46a5e4(0x79))/0x4*(parseInt(_0x46a5e4(0xa8))/0x5)+parseInt(_0x46a5e4(0xae))/0x6*(parseInt(_0x46a5e4(0xa6))/0x7)+parseInt(_0x46a5e4(0x84))/0x8*(-parseInt(_0x46a5e4(0x82))/0x9)+parseInt(_0x46a5e4(0x72))/0xa+-parseInt(_0x46a5e4(0x87))/0xb*(-parseInt(_0x46a5e4(0xb1))/0xc);if(_0x4bcdac===_0x56f472)break;else _0x1c6724['push'](_0x1c6724['shift']());}catch(_0x15a26d){_0x1c6724['push'](_0x1c6724['shift']());}}}(a67_0x40bb,0xac4f3));function a67_0x40bb(){const _0x86d47e=['810663MafQFC','logWebhookReceived','LoggerService','mtime','logShopWebhookError','white_domain_requests','mkdirSync','ERROR','endsWith','API_CALL','Failed\x20to\x20get\x20log\x20stats:','SHOP_WEBHOOK_ERROR','.log','ensureLogsDirectory','length','748203Daqoob','PAYMENT_CREATED','\x20log:','logsDir','Failed\x20to\x20write\x20','logApiCall','shop_webhooks_errors','COINTOPAY_STATUS_CHANGE','304479eeTBOv','sort','42515QyBfJd','utf8','Failed\x20to\x20clean\x20old\x20logs:','join','logShopWebhookSent','appendFileSync','6LnNSdL','logCoinToPayStatus','writeLog','11349672DrCcpI','message','stack','WEBHOOK_RECEIVED','shop_webhooks_sent','date','default','\x20days)','REQUEST','loggerService','__esModule','cwd','logs','log','__importDefault','6562280qECQyn','cointopay_status_changes','SHOP_WEBHOOK_SENT','logWebhookProcessed','split','getLogFileName','WEBHOOK_ERROR','452fFuaCy','2JWVQFK','statSync','toISOString','webhooks_errors','ðŸ§¹\x20Cleaned\x20','logWebhookError','map','logWhiteDomainResponse','435321SlkWWE','WEBHOOK_PROCESSED','232gxjqkW','COINTOPAY_ERROR','logCoinToPayError','22RIuipo','logWhiteDomainError','error','unlinkSync','white_domain_responses','setDate','cleanOldLogs','api_calls'];a67_0x40bb=function(){return _0x86d47e;};return a67_0x40bb();}var __importDefault=this&&this[a67_0x266c11(0x71)]||function(_0x59ca97){const _0x39a260=a67_0x266c11;return _0x59ca97&&_0x59ca97[_0x39a260(0x6d)]?_0x59ca97:{'default':_0x59ca97};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a67_0x266c11(0x91)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0xe82133=a67_0x266c11;this[_0xe82133(0xa1)]=path_1[_0xe82133(0xb7)][_0xe82133(0xab)](process[_0xe82133(0x6e)](),_0xe82133(0x6f)),this[_0xe82133(0x9c)]();}['ensureLogsDirectory'](){const _0x3d1121=a67_0x266c11;!fs_1[_0x3d1121(0xb7)]['existsSync'](this[_0x3d1121(0xa1)])&&(fs_1[_0x3d1121(0xb7)][_0x3d1121(0x95)](this['logsDir'],{'recursive':!![]}),console[_0x3d1121(0x70)]('ðŸ“\x20Created\x20logs\x20directory:\x20'+this[_0x3d1121(0xa1)]));}[a67_0x266c11(0x77)](_0x45a6c1){const _0x802708=a67_0x266c11,_0x4513ee=new Date()[_0x802708(0x7c)]()[_0x802708(0x76)]('T')[0x0];return path_1[_0x802708(0xb7)][_0x802708(0xab)](this[_0x802708(0xa1)],_0x45a6c1+'_'+_0x4513ee+_0x802708(0x9b));}[a67_0x266c11(0xb0)](_0x112c63,_0x4d002e){const _0x2466c9=a67_0x266c11;try{const _0xc4bf7b=new Date()['toISOString'](),_0x224d5b={'timestamp':_0xc4bf7b,..._0x4d002e},_0x14ad73=JSON['stringify'](_0x224d5b)+'\x0a',_0x1b5b17=this[_0x2466c9(0x77)](_0x112c63);fs_1[_0x2466c9(0xb7)][_0x2466c9(0xad)](_0x1b5b17,_0x14ad73,_0x2466c9(0xa9));}catch(_0x2d6907){console[_0x2466c9(0x89)](_0x2466c9(0xa2)+_0x112c63+_0x2466c9(0xa0),_0x2d6907);}}['logWhiteDomainRequest'](_0x310df7,_0x389b89,_0x3a6e79,_0x367314){const _0x18b70e=a67_0x266c11;this[_0x18b70e(0xb0)](_0x18b70e(0x94),{'type':_0x18b70e(0xb9),'gateway':_0x310df7,'endpoint':_0x389b89,'method':_0x3a6e79,'data':_0x367314});}[a67_0x266c11(0x81)](_0x456ece,_0x1dca03,_0x51cdce,_0x35b777,_0x4d5d95){const _0x5664ee=a67_0x266c11;this['writeLog'](_0x5664ee(0x8b),{'type':'RESPONSE','gateway':_0x456ece,'endpoint':_0x1dca03,'status':_0x51cdce,'responseTime':_0x4d5d95,'data':_0x35b777});}[a67_0x266c11(0x88)](_0x20397d,_0x22863c,_0x274f14){const _0xb14b57=a67_0x266c11;this[_0xb14b57(0xb0)]('white_domain_errors',{'type':_0xb14b57(0x96),'gateway':_0x20397d,'endpoint':_0x22863c,'error':_0x274f14 instanceof Error?{'message':_0x274f14[_0xb14b57(0xb2)],'stack':_0x274f14['stack']}:_0x274f14});}[a67_0x266c11(0x90)](_0x75af12,_0x45d4b4,_0x440779){const _0x351215=a67_0x266c11;this[_0x351215(0xb0)]('webhooks_received',{'type':_0x351215(0xb4),'gateway':_0x75af12,'headers':_0x440779,'data':_0x45d4b4});}[a67_0x266c11(0x75)](_0x258296,_0x58ea15,_0x3f0daa,_0x331d97,_0x5d913c){const _0x45d823=a67_0x266c11;this['writeLog']('webhooks_processed',{'type':_0x45d823(0x83),'gateway':_0x258296,'paymentId':_0x58ea15,'oldStatus':_0x3f0daa,'newStatus':_0x331d97,'originalData':_0x5d913c});}[a67_0x266c11(0x7f)](_0x36877b,_0xad994e,_0x569a17){const _0x1c531f=a67_0x266c11;this[_0x1c531f(0xb0)](_0x1c531f(0x7d),{'type':_0x1c531f(0x78),'gateway':_0x36877b,'error':_0xad994e instanceof Error?{'message':_0xad994e[_0x1c531f(0xb2)],'stack':_0xad994e[_0x1c531f(0xb3)]}:_0xad994e,'originalData':_0x569a17});}[a67_0x266c11(0xaf)](_0x5e074d){const _0x1f72ec=a67_0x266c11;this['writeLog'](_0x1f72ec(0x73),{'type':_0x1f72ec(0xa5),..._0x5e074d});}[a67_0x266c11(0x86)](_0x2ebb28){const _0x2c0e72=a67_0x266c11;this['writeLog']('cointopay_errors',{'type':_0x2c0e72(0x85),..._0x2ebb28});}[a67_0x266c11(0xac)](_0x5e71c1,_0x54cb4a,_0x128914,_0x5b8990,_0x26582a,_0x1b926a){const _0x4347c3=a67_0x266c11;this[_0x4347c3(0xb0)](_0x4347c3(0xb5),{'type':_0x4347c3(0x74),'shopId':_0x5e71c1,'webhookUrl':_0x54cb4a,'event':_0x128914,'status':_0x5b8990,'responseTime':_0x26582a,'payload':_0x1b926a});}[a67_0x266c11(0x93)](_0x1779fe,_0xa4346,_0x4c32a9,_0x1fd8c1,_0xbe3411){const _0x210217=a67_0x266c11;this[_0x210217(0xb0)](_0x210217(0xa4),{'type':_0x210217(0x9a),'shopId':_0x1779fe,'webhookUrl':_0xa4346,'event':_0x4c32a9,'error':_0x1fd8c1 instanceof Error?{'message':_0x1fd8c1['message'],'stack':_0x1fd8c1[_0x210217(0xb3)]}:_0x1fd8c1,'payload':_0xbe3411});}['logPaymentCreated'](_0x316860,_0x65597d,_0x34213e,_0x53987b,_0x5b235a){const _0x475324=a67_0x266c11;this[_0x475324(0xb0)]('payments_created',{'type':_0x475324(0x9f),'gateway':_0x316860,'paymentId':_0x65597d,'shopId':_0x34213e,'amount':_0x53987b,'currency':_0x5b235a});}[a67_0x266c11(0xa3)](_0x1580fb,_0x159efb,_0x1d71ae,_0x4e5ac6,_0x54ac5a){const _0x4ac55b=a67_0x266c11;this[_0x4ac55b(0xb0)](_0x4ac55b(0x8e),{'type':_0x4ac55b(0x98),'endpoint':_0x1580fb,'method':_0x159efb,'userId':_0x1d71ae,'userRole':_0x4e5ac6,'requestData':_0x54ac5a});}['getLogStats'](){const _0x35fe59=a67_0x266c11;try{const _0x2a58e1=fs_1[_0x35fe59(0xb7)]['readdirSync'](this[_0x35fe59(0xa1)]),_0x1ff1f9=_0x2a58e1['filter'](_0x2ec30d=>_0x2ec30d[_0x35fe59(0x97)](_0x35fe59(0x9b))),_0x38b18f=[...new Set(_0x1ff1f9[_0x35fe59(0x80)](_0xa1846b=>_0xa1846b[_0x35fe59(0x76)]('_')[0x0]))],_0x3b3562=_0x1ff1f9['map'](_0x26b571=>{const _0x3d4a80=_0x35fe59,_0x12b116=path_1['default'][_0x3d4a80(0xab)](this[_0x3d4a80(0xa1)],_0x26b571),_0x918a87=fs_1['default'][_0x3d4a80(0x7b)](_0x12b116),[_0x1e34a9,_0x58ec36]=_0x26b571['replace'](_0x3d4a80(0x9b),'')[_0x3d4a80(0x76)]('_');return{'type':_0x1e34a9,'date':_0x58ec36,'size':_0x918a87['size']};})[_0x35fe59(0xa7)]((_0x4bf522,_0x5658ce)=>_0x5658ce[_0x35fe59(0xb6)]['localeCompare'](_0x4bf522[_0x35fe59(0xb6)]));return{'totalFiles':_0x1ff1f9[_0x35fe59(0x9d)],'logTypes':_0x38b18f,'latestLogs':_0x3b3562['slice'](0x0,0xa)};}catch(_0x2132be){return console['error'](_0x35fe59(0x99),_0x2132be),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a67_0x266c11(0x8d)](_0x389fce=0x1e){const _0x59f9b4=a67_0x266c11;try{const _0xaef088=fs_1['default']['readdirSync'](this[_0x59f9b4(0xa1)]),_0x7830a6=new Date();_0x7830a6[_0x59f9b4(0x8c)](_0x7830a6['getDate']()-_0x389fce);let _0x3330a2=0x0;_0xaef088['forEach'](_0x26b0d2=>{const _0x179559=_0x59f9b4;if(!_0x26b0d2[_0x179559(0x97)]('.log'))return;const _0x3acc1b=path_1['default'][_0x179559(0xab)](this[_0x179559(0xa1)],_0x26b0d2),_0x16cf4a=fs_1[_0x179559(0xb7)]['statSync'](_0x3acc1b);_0x16cf4a[_0x179559(0x92)]<_0x7830a6&&(fs_1[_0x179559(0xb7)][_0x179559(0x8a)](_0x3acc1b),_0x3330a2++,console['log']('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x26b0d2));}),console[_0x59f9b4(0x70)](_0x59f9b4(0x7e)+_0x3330a2+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x389fce+_0x59f9b4(0xb8));}catch(_0x5b78de){console[_0x59f9b4(0x89)](_0x59f9b4(0xaa),_0x5b78de);}}}function a67_0x105a(_0x3063b0,_0x384aee){_0x3063b0=_0x3063b0-0x6d;const _0x40bb9f=a67_0x40bb();let _0x105a7d=_0x40bb9f[_0x3063b0];return _0x105a7d;}exports[a67_0x266c11(0x91)]=LoggerService,exports[a67_0x266c11(0xba)]=new LoggerService();