'use strict';function a49_0x3b70(_0x3b159a,_0x46f6af){const _0x105788=a49_0x1057();return a49_0x3b70=function(_0x3b7079,_0x1bdbac){_0x3b7079=_0x3b7079-0x1c3;let _0x3e7f24=_0x105788[_0x3b7079];return _0x3e7f24;},a49_0x3b70(_0x3b159a,_0x46f6af);}const a49_0x204b8c=a49_0x3b70;(function(_0x5d684d,_0x13c967){const _0x15a771=a49_0x3b70,_0x4fd4d2=_0x5d684d();while(!![]){try{const _0x958ac4=-parseInt(_0x15a771(0x1dc))/0x1*(parseInt(_0x15a771(0x1ea))/0x2)+-parseInt(_0x15a771(0x1c9))/0x3*(parseInt(_0x15a771(0x1d7))/0x4)+parseInt(_0x15a771(0x1d1))/0x5+-parseInt(_0x15a771(0x1ff))/0x6+parseInt(_0x15a771(0x1f3))/0x7+parseInt(_0x15a771(0x1fe))/0x8*(parseInt(_0x15a771(0x1ce))/0x9)+parseInt(_0x15a771(0x1ed))/0xa;if(_0x958ac4===_0x13c967)break;else _0x4fd4d2['push'](_0x4fd4d2['shift']());}catch(_0x2861a6){_0x4fd4d2['push'](_0x4fd4d2['shift']());}}}(a49_0x1057,0x7c9c2));var __importDefault=this&&this[a49_0x204b8c(0x20c)]||function(_0x6999b0){const _0x2590fa=a49_0x204b8c;return _0x6999b0&&_0x6999b0[_0x2590fa(0x1d2)]?_0x6999b0:{'default':_0x6999b0};};function a49_0x1057(){const _0x2edfde=['replace','📁\x20Created\x20logs\x20directory:\x20','3nVwpnN','split','mkdirSync','logPaymentCreated','webhooks_errors','5769OhLmTG','shop_webhooks_sent','statSync','583845gbRadi','__esModule','size','Failed\x20to\x20clean\x20old\x20logs:','utf8','ERROR','2219908SQjyWT','COINTOPAY_ERROR','mtime','WEBHOOK_PROCESSED','logsDir','97ewtRLf','\x20days)','\x20old\x20log\x20files\x20(older\x20than\x20','webhooks_received','writeLog','white_domain_errors','🧹\x20Cleaned\x20','path','log','logApiCall','join','.log','logWhiteDomainResponse','sort','19374GJcvVt','WEBHOOK_ERROR','appendFileSync','11638590leGhHG','slice','logWebhookProcessed','cointopay_status_changes','getLogStats','error','3186211TacNNX','forEach','white_domain_responses','api_calls','logCoinToPayError','stack','getLogFileName','cleanOldLogs','default','WEBHOOK_RECEIVED','stringify','4848GXySBT','715374dfTUWa','date','\x20log:','Failed\x20to\x20get\x20log\x20stats:','RESPONSE','toISOString','logShopWebhookSent','API_CALL','getDate','🗑️\x20Deleted\x20old\x20log\x20file:\x20','Failed\x20to\x20write\x20','readdirSync','SHOP_WEBHOOK_ERROR','__importDefault','logWebhookError','map','PAYMENT_CREATED','message','localeCompare','shop_webhooks_errors','unlinkSync','ensureLogsDirectory','logWebhookReceived','cointopay_errors'];a49_0x1057=function(){return _0x2edfde;};return a49_0x1057();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x204b8c(0x1e3)));class LoggerService{constructor(){const _0x2ffc3b=a49_0x204b8c;this[_0x2ffc3b(0x1db)]=path_1[_0x2ffc3b(0x1fb)][_0x2ffc3b(0x1e6)](process['cwd'](),'logs'),this[_0x2ffc3b(0x1c4)]();}[a49_0x204b8c(0x1c4)](){const _0x3e6c79=a49_0x204b8c;!fs_1[_0x3e6c79(0x1fb)]['existsSync'](this['logsDir'])&&(fs_1[_0x3e6c79(0x1fb)][_0x3e6c79(0x1cb)](this['logsDir'],{'recursive':!![]}),console[_0x3e6c79(0x1e4)](_0x3e6c79(0x1c8)+this[_0x3e6c79(0x1db)]));}[a49_0x204b8c(0x1f9)](_0x391d9a){const _0x476336=a49_0x204b8c,_0x3a7445=new Date()[_0x476336(0x204)]()['split']('T')[0x0];return path_1[_0x476336(0x1fb)][_0x476336(0x1e6)](this[_0x476336(0x1db)],_0x391d9a+'_'+_0x3a7445+'.log');}[a49_0x204b8c(0x1e0)](_0x47fb9d,_0x9ca888){const _0x18a7cc=a49_0x204b8c;try{const _0x56fc84=new Date()[_0x18a7cc(0x204)](),_0x41941e={'timestamp':_0x56fc84,..._0x9ca888},_0x45760c=JSON[_0x18a7cc(0x1fd)](_0x41941e)+'\x0a',_0x237f67=this[_0x18a7cc(0x1f9)](_0x47fb9d);fs_1['default'][_0x18a7cc(0x1ec)](_0x237f67,_0x45760c,_0x18a7cc(0x1d5));}catch(_0x2edef4){console[_0x18a7cc(0x1f2)](_0x18a7cc(0x209)+_0x47fb9d+_0x18a7cc(0x201),_0x2edef4);}}['logWhiteDomainRequest'](_0x2d3681,_0x414008,_0x3832fe,_0x109d70){const _0x55846f=a49_0x204b8c;this[_0x55846f(0x1e0)]('white_domain_requests',{'type':'REQUEST','gateway':_0x2d3681,'endpoint':_0x414008,'method':_0x3832fe,'data':_0x109d70});}[a49_0x204b8c(0x1e8)](_0x12a77b,_0x121a65,_0x2cc708,_0x465bb2,_0x50e3e7){const _0x13113e=a49_0x204b8c;this[_0x13113e(0x1e0)](_0x13113e(0x1f5),{'type':_0x13113e(0x203),'gateway':_0x12a77b,'endpoint':_0x121a65,'status':_0x2cc708,'responseTime':_0x50e3e7,'data':_0x465bb2});}['logWhiteDomainError'](_0x2fc4f6,_0x948037,_0x42d32f){const _0x191348=a49_0x204b8c;this['writeLog'](_0x191348(0x1e1),{'type':_0x191348(0x1d6),'gateway':_0x2fc4f6,'endpoint':_0x948037,'error':_0x42d32f instanceof Error?{'message':_0x42d32f[_0x191348(0x210)],'stack':_0x42d32f['stack']}:_0x42d32f});}[a49_0x204b8c(0x1c5)](_0x19f3cf,_0x5e63d7,_0x3b1ca2){const _0x5df47e=a49_0x204b8c;this[_0x5df47e(0x1e0)](_0x5df47e(0x1df),{'type':_0x5df47e(0x1fc),'gateway':_0x19f3cf,'headers':_0x3b1ca2,'data':_0x5e63d7});}[a49_0x204b8c(0x1ef)](_0xf0f82e,_0x2f9f8e,_0xa9d077,_0x51f35d,_0xb24a7){const _0x11c70c=a49_0x204b8c;this['writeLog']('webhooks_processed',{'type':_0x11c70c(0x1da),'gateway':_0xf0f82e,'paymentId':_0x2f9f8e,'oldStatus':_0xa9d077,'newStatus':_0x51f35d,'originalData':_0xb24a7});}[a49_0x204b8c(0x20d)](_0x5c94b7,_0x1cd35f,_0x30d646){const _0x49876e=a49_0x204b8c;this[_0x49876e(0x1e0)](_0x49876e(0x1cd),{'type':_0x49876e(0x1eb),'gateway':_0x5c94b7,'error':_0x1cd35f instanceof Error?{'message':_0x1cd35f[_0x49876e(0x210)],'stack':_0x1cd35f[_0x49876e(0x1f8)]}:_0x1cd35f,'originalData':_0x30d646});}['logCoinToPayStatus'](_0x38992a){const _0x18939f=a49_0x204b8c;this[_0x18939f(0x1e0)](_0x18939f(0x1f0),{'type':'COINTOPAY_STATUS_CHANGE',..._0x38992a});}[a49_0x204b8c(0x1f7)](_0xc78870){const _0x467816=a49_0x204b8c;this['writeLog'](_0x467816(0x1c6),{'type':_0x467816(0x1d8),..._0xc78870});}[a49_0x204b8c(0x205)](_0x4729fa,_0x6664a0,_0x525131,_0x3b6a23,_0x30d1a7,_0x59041a){const _0x31d955=a49_0x204b8c;this[_0x31d955(0x1e0)](_0x31d955(0x1cf),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x4729fa,'webhookUrl':_0x6664a0,'event':_0x525131,'status':_0x3b6a23,'responseTime':_0x30d1a7,'payload':_0x59041a});}['logShopWebhookError'](_0x675175,_0x5bef22,_0x578df3,_0x436fa9,_0x4f630a){const _0x295994=a49_0x204b8c;this[_0x295994(0x1e0)](_0x295994(0x212),{'type':_0x295994(0x20b),'shopId':_0x675175,'webhookUrl':_0x5bef22,'event':_0x578df3,'error':_0x436fa9 instanceof Error?{'message':_0x436fa9['message'],'stack':_0x436fa9[_0x295994(0x1f8)]}:_0x436fa9,'payload':_0x4f630a});}[a49_0x204b8c(0x1cc)](_0x41e184,_0x50695b,_0x108b6b,_0x5b7225,_0x58c674){const _0x3c6893=a49_0x204b8c;this[_0x3c6893(0x1e0)]('payments_created',{'type':_0x3c6893(0x20f),'gateway':_0x41e184,'paymentId':_0x50695b,'shopId':_0x108b6b,'amount':_0x5b7225,'currency':_0x58c674});}[a49_0x204b8c(0x1e5)](_0x1feba1,_0x23af39,_0x2676eb,_0x18abe7,_0x4d458d){const _0x121044=a49_0x204b8c;this[_0x121044(0x1e0)](_0x121044(0x1f6),{'type':_0x121044(0x206),'endpoint':_0x1feba1,'method':_0x23af39,'userId':_0x2676eb,'userRole':_0x18abe7,'requestData':_0x4d458d});}[a49_0x204b8c(0x1f1)](){const _0x345d1e=a49_0x204b8c;try{const _0x169db2=fs_1[_0x345d1e(0x1fb)][_0x345d1e(0x20a)](this[_0x345d1e(0x1db)]),_0x3d2fea=_0x169db2['filter'](_0x1388ee=>_0x1388ee['endsWith'](_0x345d1e(0x1e7))),_0x3afdcf=[...new Set(_0x3d2fea[_0x345d1e(0x20e)](_0x294da3=>_0x294da3[_0x345d1e(0x1ca)]('_')[0x0]))],_0x5403d4=_0x3d2fea['map'](_0x54bf50=>{const _0x13b3d3=_0x345d1e,_0x5c0d29=path_1[_0x13b3d3(0x1fb)]['join'](this['logsDir'],_0x54bf50),_0x572f87=fs_1[_0x13b3d3(0x1fb)]['statSync'](_0x5c0d29),[_0x4291c7,_0x1e6477]=_0x54bf50[_0x13b3d3(0x1c7)]('.log','')[_0x13b3d3(0x1ca)]('_');return{'type':_0x4291c7,'date':_0x1e6477,'size':_0x572f87[_0x13b3d3(0x1d3)]};})[_0x345d1e(0x1e9)]((_0x33284a,_0x2e706e)=>_0x2e706e['date'][_0x345d1e(0x211)](_0x33284a[_0x345d1e(0x200)]));return{'totalFiles':_0x3d2fea['length'],'logTypes':_0x3afdcf,'latestLogs':_0x5403d4[_0x345d1e(0x1ee)](0x0,0xa)};}catch(_0x54ccdd){return console[_0x345d1e(0x1f2)](_0x345d1e(0x202),_0x54ccdd),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x204b8c(0x1fa)](_0x3a24e5=0x1e){const _0x492cb2=a49_0x204b8c;try{const _0x2fb7ce=fs_1[_0x492cb2(0x1fb)][_0x492cb2(0x20a)](this['logsDir']),_0x223636=new Date();_0x223636['setDate'](_0x223636[_0x492cb2(0x207)]()-_0x3a24e5);let _0x2442ab=0x0;_0x2fb7ce[_0x492cb2(0x1f4)](_0x4d92c9=>{const _0x34b41d=_0x492cb2;if(!_0x4d92c9['endsWith'](_0x34b41d(0x1e7)))return;const _0x4791e8=path_1['default'][_0x34b41d(0x1e6)](this[_0x34b41d(0x1db)],_0x4d92c9),_0x31cc21=fs_1[_0x34b41d(0x1fb)][_0x34b41d(0x1d0)](_0x4791e8);_0x31cc21[_0x34b41d(0x1d9)]<_0x223636&&(fs_1[_0x34b41d(0x1fb)][_0x34b41d(0x1c3)](_0x4791e8),_0x2442ab++,console[_0x34b41d(0x1e4)](_0x34b41d(0x208)+_0x4d92c9));}),console[_0x492cb2(0x1e4)](_0x492cb2(0x1e2)+_0x2442ab+_0x492cb2(0x1de)+_0x3a24e5+_0x492cb2(0x1dd));}catch(_0x15c3a1){console['error'](_0x492cb2(0x1d4),_0x15c3a1);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();