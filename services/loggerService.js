'use strict';function a71_0xb080(){const _0x39d849=['COINTOPAY_STATUS_CHANGE','payments_created','writeLog','\x20log:','Failed\x20to\x20write\x20','ðŸ§¹\x20Cleaned\x20','webhooks_received','WEBHOOK_PROCESSED','utf8','COINTOPAY_ERROR','logApiCall','REQUEST','logsDir','localeCompare','white_domain_requests','size','3360085ZYgiHt','log','logWebhookError','logWhiteDomainResponse','getLogFileName','date','1022400TCkoDz','unlinkSync','error','33350VhsCVu','.log','ERROR','default','cointopay_errors','logCoinToPayStatus','LoggerService','slice','ensureLogsDirectory','stack','\x20old\x20log\x20files\x20(older\x20than\x20','logs','7ezhGKg','map','1042202zeDNme','replace','endsWith','readdirSync','path','logShopWebhookSent','SHOP_WEBHOOK_ERROR','logWebhookProcessed','shop_webhooks_sent','API_CALL','join','stringify','cwd','mtime','logWebhookReceived','RESPONSE','878344KUrdsx','webhooks_processed','webhooks_errors','ðŸ“\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20clean\x20old\x20logs:','getLogStats','4XcZaGc','2363576JFfcDa','length','split','toISOString','shop_webhooks_errors','Failed\x20to\x20get\x20log\x20stats:','defineProperty','statSync','logWhiteDomainRequest','__esModule','message','SHOP_WEBHOOK_SENT','801ikiHer','logShopWebhookError','white_domain_responses','mkdirSync','logWhiteDomainError','2926374qNrYPy','getDate','logPaymentCreated','forEach','sort','WEBHOOK_ERROR','logCoinToPayError'];a71_0xb080=function(){return _0x39d849;};return a71_0xb080();}const a71_0x1ff901=a71_0x2e3b;(function(_0x5215cb,_0x38ee4f){const _0x17032c=a71_0x2e3b,_0x431125=_0x5215cb();while(!![]){try{const _0x1b1f3e=parseInt(_0x17032c(0x8f))/0x1+-parseInt(_0x17032c(0x7f))/0x2+parseInt(_0x17032c(0xa7))/0x3+-parseInt(_0x17032c(0x95))/0x4*(parseInt(_0x17032c(0xbe))/0x5)+-parseInt(_0x17032c(0xc4))/0x6+parseInt(_0x17032c(0x7d))/0x7*(parseInt(_0x17032c(0x96))/0x8)+parseInt(_0x17032c(0xa2))/0x9*(-parseInt(_0x17032c(0xc7))/0xa);if(_0x1b1f3e===_0x38ee4f)break;else _0x431125['push'](_0x431125['shift']());}catch(_0x5bf491){_0x431125['push'](_0x431125['shift']());}}}(a71_0xb080,0x775d4));var __importDefault=this&&this['__importDefault']||function(_0x1fe4e1){const _0x293dc6=a71_0x2e3b;return _0x1fe4e1&&_0x1fe4e1[_0x293dc6(0x9f)]?_0x1fe4e1:{'default':_0x1fe4e1};};Object[a71_0x1ff901(0x9c)](exports,a71_0x1ff901(0x9f),{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a71_0x1ff901(0x83)));function a71_0x2e3b(_0x31e4cf,_0xc17125){_0x31e4cf=_0x31e4cf-0x7a;const _0xb080a9=a71_0xb080();let _0x2e3be3=_0xb080a9[_0x31e4cf];return _0x2e3be3;}class LoggerService{constructor(){const _0x1c6d5d=a71_0x1ff901;this[_0x1c6d5d(0xba)]=path_1[_0x1c6d5d(0xca)][_0x1c6d5d(0x89)](process[_0x1c6d5d(0x8b)](),_0x1c6d5d(0x7c)),this[_0x1c6d5d(0xcf)]();}[a71_0x1ff901(0xcf)](){const _0x3e80b4=a71_0x1ff901;!fs_1[_0x3e80b4(0xca)]['existsSync'](this[_0x3e80b4(0xba)])&&(fs_1[_0x3e80b4(0xca)][_0x3e80b4(0xa5)](this[_0x3e80b4(0xba)],{'recursive':!![]}),console[_0x3e80b4(0xbf)](_0x3e80b4(0x92)+this['logsDir']));}[a71_0x1ff901(0xc2)](_0x772a29){const _0x3070ba=a71_0x1ff901,_0xbe0da5=new Date()[_0x3070ba(0x99)]()[_0x3070ba(0x98)]('T')[0x0];return path_1[_0x3070ba(0xca)]['join'](this[_0x3070ba(0xba)],_0x772a29+'_'+_0xbe0da5+_0x3070ba(0xc8));}['writeLog'](_0x44f5dd,_0x1c4d90){const _0x43a808=a71_0x1ff901;try{const _0x34b551=new Date()[_0x43a808(0x99)](),_0x38716e={'timestamp':_0x34b551,..._0x1c4d90},_0xda36db=JSON[_0x43a808(0x8a)](_0x38716e)+'\x0a',_0x203cfe=this[_0x43a808(0xc2)](_0x44f5dd);fs_1[_0x43a808(0xca)]['appendFileSync'](_0x203cfe,_0xda36db,_0x43a808(0xb6));}catch(_0x409a43){console[_0x43a808(0xc6)](_0x43a808(0xb2)+_0x44f5dd+_0x43a808(0xb1),_0x409a43);}}[a71_0x1ff901(0x9e)](_0x4ad4f4,_0x5df16b,_0xa82fe7,_0x3ed589){const _0x52d8b8=a71_0x1ff901;this[_0x52d8b8(0xb0)](_0x52d8b8(0xbc),{'type':_0x52d8b8(0xb9),'gateway':_0x4ad4f4,'endpoint':_0x5df16b,'method':_0xa82fe7,'data':_0x3ed589});}[a71_0x1ff901(0xc1)](_0x599146,_0x9b7c91,_0x1a45cc,_0x4c349d,_0x5b0d57){const _0x35fc26=a71_0x1ff901;this['writeLog'](_0x35fc26(0xa4),{'type':_0x35fc26(0x8e),'gateway':_0x599146,'endpoint':_0x9b7c91,'status':_0x1a45cc,'responseTime':_0x5b0d57,'data':_0x4c349d});}[a71_0x1ff901(0xa6)](_0x314e88,_0x4e955a,_0x1bf99){const _0x17170c=a71_0x1ff901;this[_0x17170c(0xb0)]('white_domain_errors',{'type':_0x17170c(0xc9),'gateway':_0x314e88,'endpoint':_0x4e955a,'error':_0x1bf99 instanceof Error?{'message':_0x1bf99['message'],'stack':_0x1bf99[_0x17170c(0x7a)]}:_0x1bf99});}[a71_0x1ff901(0x8d)](_0x252bd3,_0x4f1313,_0x5d0c9d){const _0x395932=a71_0x1ff901;this[_0x395932(0xb0)](_0x395932(0xb4),{'type':'WEBHOOK_RECEIVED','gateway':_0x252bd3,'headers':_0x5d0c9d,'data':_0x4f1313});}[a71_0x1ff901(0x86)](_0x2c0364,_0x30f91b,_0x45d64a,_0x5848d2,_0x5da693){const _0x554c9c=a71_0x1ff901;this[_0x554c9c(0xb0)](_0x554c9c(0x90),{'type':_0x554c9c(0xb5),'gateway':_0x2c0364,'paymentId':_0x30f91b,'oldStatus':_0x45d64a,'newStatus':_0x5848d2,'originalData':_0x5da693});}[a71_0x1ff901(0xc0)](_0x5188d3,_0x1c931f,_0x567191){const _0x5654d9=a71_0x1ff901;this[_0x5654d9(0xb0)](_0x5654d9(0x91),{'type':_0x5654d9(0xac),'gateway':_0x5188d3,'error':_0x1c931f instanceof Error?{'message':_0x1c931f[_0x5654d9(0xa0)],'stack':_0x1c931f[_0x5654d9(0x7a)]}:_0x1c931f,'originalData':_0x567191});}[a71_0x1ff901(0xcc)](_0x483872){const _0x2df57e=a71_0x1ff901;this[_0x2df57e(0xb0)]('cointopay_status_changes',{'type':_0x2df57e(0xae),..._0x483872});}[a71_0x1ff901(0xad)](_0x1263bc){const _0x3a04f3=a71_0x1ff901;this[_0x3a04f3(0xb0)](_0x3a04f3(0xcb),{'type':_0x3a04f3(0xb7),..._0x1263bc});}[a71_0x1ff901(0x84)](_0x487948,_0x135040,_0x5d6079,_0x5a9fca,_0xf6feb2,_0x594ad2){const _0x3480de=a71_0x1ff901;this['writeLog'](_0x3480de(0x87),{'type':_0x3480de(0xa1),'shopId':_0x487948,'webhookUrl':_0x135040,'event':_0x5d6079,'status':_0x5a9fca,'responseTime':_0xf6feb2,'payload':_0x594ad2});}[a71_0x1ff901(0xa3)](_0x246d56,_0x22cdfb,_0x587466,_0x395ade,_0x52b458){const _0x4750ac=a71_0x1ff901;this['writeLog'](_0x4750ac(0x9a),{'type':_0x4750ac(0x85),'shopId':_0x246d56,'webhookUrl':_0x22cdfb,'event':_0x587466,'error':_0x395ade instanceof Error?{'message':_0x395ade[_0x4750ac(0xa0)],'stack':_0x395ade[_0x4750ac(0x7a)]}:_0x395ade,'payload':_0x52b458});}[a71_0x1ff901(0xa9)](_0x18015f,_0x280d54,_0x54143f,_0x69b1cb,_0x5d0893){const _0x514ac2=a71_0x1ff901;this[_0x514ac2(0xb0)](_0x514ac2(0xaf),{'type':'PAYMENT_CREATED','gateway':_0x18015f,'paymentId':_0x280d54,'shopId':_0x54143f,'amount':_0x69b1cb,'currency':_0x5d0893});}[a71_0x1ff901(0xb8)](_0x103858,_0x5c1866,_0x1e09c2,_0x46f2ab,_0x595c1c){const _0x1726f0=a71_0x1ff901;this[_0x1726f0(0xb0)]('api_calls',{'type':_0x1726f0(0x88),'endpoint':_0x103858,'method':_0x5c1866,'userId':_0x1e09c2,'userRole':_0x46f2ab,'requestData':_0x595c1c});}[a71_0x1ff901(0x94)](){const _0x3826b0=a71_0x1ff901;try{const _0x2c68fa=fs_1[_0x3826b0(0xca)]['readdirSync'](this[_0x3826b0(0xba)]),_0x15b35b=_0x2c68fa['filter'](_0x725931=>_0x725931[_0x3826b0(0x81)](_0x3826b0(0xc8))),_0x4435c7=[...new Set(_0x15b35b[_0x3826b0(0x7e)](_0x599b4f=>_0x599b4f[_0x3826b0(0x98)]('_')[0x0]))],_0x40902e=_0x15b35b['map'](_0x4d00a0=>{const _0x633a3c=_0x3826b0,_0x54cabd=path_1['default'][_0x633a3c(0x89)](this[_0x633a3c(0xba)],_0x4d00a0),_0x500602=fs_1[_0x633a3c(0xca)]['statSync'](_0x54cabd),[_0xc4275a,_0x2dd017]=_0x4d00a0[_0x633a3c(0x80)](_0x633a3c(0xc8),'')['split']('_');return{'type':_0xc4275a,'date':_0x2dd017,'size':_0x500602[_0x633a3c(0xbd)]};})[_0x3826b0(0xab)]((_0x3631a3,_0x42434c)=>_0x42434c['date'][_0x3826b0(0xbb)](_0x3631a3[_0x3826b0(0xc3)]));return{'totalFiles':_0x15b35b[_0x3826b0(0x97)],'logTypes':_0x4435c7,'latestLogs':_0x40902e[_0x3826b0(0xce)](0x0,0xa)};}catch(_0x4d0c4c){return console[_0x3826b0(0xc6)](_0x3826b0(0x9b),_0x4d0c4c),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x148de9=0x1e){const _0x205141=a71_0x1ff901;try{const _0x83a9e6=fs_1['default'][_0x205141(0x82)](this[_0x205141(0xba)]),_0x1ba902=new Date();_0x1ba902['setDate'](_0x1ba902[_0x205141(0xa8)]()-_0x148de9);let _0x53a4bb=0x0;_0x83a9e6[_0x205141(0xaa)](_0x53668f=>{const _0x390036=_0x205141;if(!_0x53668f[_0x390036(0x81)]('.log'))return;const _0x29c859=path_1[_0x390036(0xca)][_0x390036(0x89)](this['logsDir'],_0x53668f),_0x2a8736=fs_1[_0x390036(0xca)][_0x390036(0x9d)](_0x29c859);_0x2a8736[_0x390036(0x8c)]<_0x1ba902&&(fs_1[_0x390036(0xca)][_0x390036(0xc5)](_0x29c859),_0x53a4bb++,console[_0x390036(0xbf)]('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x53668f));}),console[_0x205141(0xbf)](_0x205141(0xb3)+_0x53a4bb+_0x205141(0x7b)+_0x148de9+'\x20days)');}catch(_0x4d395b){console['error'](_0x205141(0x93),_0x4d395b);}}}exports[a71_0x1ff901(0xcd)]=LoggerService,exports['loggerService']=new LoggerService();