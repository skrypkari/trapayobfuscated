'use strict';const a55_0xe7e5ce=a55_0x39cf;(function(_0x21954f,_0x790c33){const _0x27627d=a55_0x39cf,_0x526c6a=_0x21954f();while(!![]){try{const _0x4b21ec=-parseInt(_0x27627d(0x175))/0x1*(-parseInt(_0x27627d(0x1a1))/0x2)+-parseInt(_0x27627d(0x189))/0x3+-parseInt(_0x27627d(0x1b1))/0x4+parseInt(_0x27627d(0x1a2))/0x5+parseInt(_0x27627d(0x170))/0x6+parseInt(_0x27627d(0x17c))/0x7*(-parseInt(_0x27627d(0x19d))/0x8)+-parseInt(_0x27627d(0x177))/0x9*(-parseInt(_0x27627d(0x19e))/0xa);if(_0x4b21ec===_0x790c33)break;else _0x526c6a['push'](_0x526c6a['shift']());}catch(_0x1389ea){_0x526c6a['push'](_0x526c6a['shift']());}}}(a55_0x2b46,0x930ec));var __importDefault=this&&this['__importDefault']||function(_0x32485e){const _0x1d4fb6=a55_0x39cf;return _0x32485e&&_0x32485e[_0x1d4fb6(0x16c)]?_0x32485e:{'default':_0x32485e};};Object[a55_0xe7e5ce(0x1a5)](exports,a55_0xe7e5ce(0x16c),{'value':!![]}),exports[a55_0xe7e5ce(0x1ae)]=exports[a55_0xe7e5ce(0x16e)]=void 0x0;function a55_0x39cf(_0x4e0e93,_0x438492){const _0x2b46e7=a55_0x2b46();return a55_0x39cf=function(_0x39cf9d,_0x43a845){_0x39cf9d=_0x39cf9d-0x16a;let _0x4e661f=_0x2b46e7[_0x39cf9d];return _0x4e661f;},a55_0x39cf(_0x4e0e93,_0x438492);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a55_0xe7e5ce(0x179)));function a55_0x2b46(){const _0x42a747=['🗑️\x20Deleted\x20old\x20log\x20file:\x20','size','logWhiteDomainRequest','localeCompare','logs','8PaBvTO','11740qZOeQG','getDate','message','598UuqeuR','2736875parEhd','join','logCoinToPayStatus','defineProperty','SHOP_WEBHOOK_ERROR','ERROR','log','split','webhooks_processed','stringify','getLogStats','Failed\x20to\x20clean\x20old\x20logs:','loggerService','logWhiteDomainResponse','replace','310248RTBgDW','ensureLogsDirectory','unlinkSync','mtime','error','date','white_domain_responses','readdirSync','sort','logsDir','__esModule','map','LoggerService','white_domain_requests','3290010poKvbl','shop_webhooks_errors','PAYMENT_CREATED','default','logWebhookReceived','2203ahXQYy','logApiCall','3141LafsMf','WEBHOOK_ERROR','path','\x20log:','statSync','5413289SdtRjv','cwd','logWebhookError','cointopay_status_changes','logWebhookProcessed','forEach','\x20days)','utf8','payments_created','WEBHOOK_PROCESSED','slice','\x20old\x20log\x20files\x20(older\x20than\x20','length','2132688WPcJrT','endsWith','webhooks_errors','filter','RESPONSE','COINTOPAY_ERROR','logPaymentCreated','.log','API_CALL','toISOString','writeLog','stack','logShopWebhookSent','Failed\x20to\x20write\x20','Failed\x20to\x20get\x20log\x20stats:'];a55_0x2b46=function(){return _0x42a747;};return a55_0x2b46();}class LoggerService{constructor(){const _0x46118e=a55_0xe7e5ce;this[_0x46118e(0x16b)]=path_1[_0x46118e(0x173)][_0x46118e(0x1a3)](process[_0x46118e(0x17d)](),_0x46118e(0x19c)),this[_0x46118e(0x1b2)]();}[a55_0xe7e5ce(0x1b2)](){const _0x2ee019=a55_0xe7e5ce;!fs_1[_0x2ee019(0x173)]['existsSync'](this[_0x2ee019(0x16b)])&&(fs_1[_0x2ee019(0x173)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x2ee019(0x16b)]));}['getLogFileName'](_0x5a33f7){const _0x5bb96b=a55_0xe7e5ce,_0x18d561=new Date()[_0x5bb96b(0x192)]()[_0x5bb96b(0x1a9)]('T')[0x0];return path_1[_0x5bb96b(0x173)][_0x5bb96b(0x1a3)](this[_0x5bb96b(0x16b)],_0x5a33f7+'_'+_0x18d561+_0x5bb96b(0x190));}[a55_0xe7e5ce(0x193)](_0x29a937,_0x4afc05){const _0x853515=a55_0xe7e5ce;try{const _0x30a4b8=new Date()[_0x853515(0x192)](),_0x5bd5b2={'timestamp':_0x30a4b8,..._0x4afc05},_0x25fc08=JSON[_0x853515(0x1ab)](_0x5bd5b2)+'\x0a',_0x29b423=this['getLogFileName'](_0x29a937);fs_1[_0x853515(0x173)]['appendFileSync'](_0x29b423,_0x25fc08,_0x853515(0x183));}catch(_0x3d69cf){console[_0x853515(0x1b5)](_0x853515(0x196)+_0x29a937+_0x853515(0x17a),_0x3d69cf);}}[a55_0xe7e5ce(0x19a)](_0x4e9b8c,_0x2f3f28,_0x564c1a,_0x582e9b){const _0x500e12=a55_0xe7e5ce;this[_0x500e12(0x193)](_0x500e12(0x16f),{'type':'REQUEST','gateway':_0x4e9b8c,'endpoint':_0x2f3f28,'method':_0x564c1a,'data':_0x582e9b});}[a55_0xe7e5ce(0x1af)](_0x243e7e,_0x45b7df,_0x4aad3e,_0x3f6e9a,_0x47ae6b){const _0x443d61=a55_0xe7e5ce;this['writeLog'](_0x443d61(0x1b7),{'type':_0x443d61(0x18d),'gateway':_0x243e7e,'endpoint':_0x45b7df,'status':_0x4aad3e,'responseTime':_0x47ae6b,'data':_0x3f6e9a});}['logWhiteDomainError'](_0x2a0f03,_0x2f6eea,_0x42c4f3){const _0x4b9b7c=a55_0xe7e5ce;this['writeLog']('white_domain_errors',{'type':_0x4b9b7c(0x1a7),'gateway':_0x2a0f03,'endpoint':_0x2f6eea,'error':_0x42c4f3 instanceof Error?{'message':_0x42c4f3['message'],'stack':_0x42c4f3['stack']}:_0x42c4f3});}[a55_0xe7e5ce(0x174)](_0x1b29f3,_0x484dd4,_0x464957){this['writeLog']('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x1b29f3,'headers':_0x464957,'data':_0x484dd4});}[a55_0xe7e5ce(0x180)](_0x106272,_0x1d01fc,_0x499e68,_0x4268bc,_0x302f3){const _0x2ecea7=a55_0xe7e5ce;this[_0x2ecea7(0x193)](_0x2ecea7(0x1aa),{'type':_0x2ecea7(0x185),'gateway':_0x106272,'paymentId':_0x1d01fc,'oldStatus':_0x499e68,'newStatus':_0x4268bc,'originalData':_0x302f3});}[a55_0xe7e5ce(0x17e)](_0x1f3249,_0x136a5e,_0xc54a68){const _0x5af016=a55_0xe7e5ce;this[_0x5af016(0x193)](_0x5af016(0x18b),{'type':_0x5af016(0x178),'gateway':_0x1f3249,'error':_0x136a5e instanceof Error?{'message':_0x136a5e[_0x5af016(0x1a0)],'stack':_0x136a5e[_0x5af016(0x194)]}:_0x136a5e,'originalData':_0xc54a68});}[a55_0xe7e5ce(0x1a4)](_0x5aad9c){const _0x4ad47c=a55_0xe7e5ce;this['writeLog'](_0x4ad47c(0x17f),{'type':'COINTOPAY_STATUS_CHANGE',..._0x5aad9c});}['logCoinToPayError'](_0x5f3a2f){const _0x35b203=a55_0xe7e5ce;this['writeLog']('cointopay_errors',{'type':_0x35b203(0x18e),..._0x5f3a2f});}[a55_0xe7e5ce(0x195)](_0x2334f2,_0x18888b,_0x4fcd72,_0x4f0733,_0x54d980,_0x31afd9){this['writeLog']('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x2334f2,'webhookUrl':_0x18888b,'event':_0x4fcd72,'status':_0x4f0733,'responseTime':_0x54d980,'payload':_0x31afd9});}['logShopWebhookError'](_0x47960f,_0x323f73,_0x372400,_0xfb076,_0x370d76){const _0x3347c0=a55_0xe7e5ce;this[_0x3347c0(0x193)](_0x3347c0(0x171),{'type':_0x3347c0(0x1a6),'shopId':_0x47960f,'webhookUrl':_0x323f73,'event':_0x372400,'error':_0xfb076 instanceof Error?{'message':_0xfb076['message'],'stack':_0xfb076['stack']}:_0xfb076,'payload':_0x370d76});}[a55_0xe7e5ce(0x18f)](_0x449cf4,_0x3c46cc,_0x528d9b,_0x3d103f,_0x1c1105){const _0x8df040=a55_0xe7e5ce;this[_0x8df040(0x193)](_0x8df040(0x184),{'type':_0x8df040(0x172),'gateway':_0x449cf4,'paymentId':_0x3c46cc,'shopId':_0x528d9b,'amount':_0x3d103f,'currency':_0x1c1105});}[a55_0xe7e5ce(0x176)](_0x362434,_0x753d93,_0x11fb4c,_0x48e0d3,_0x38ecc5){const _0x253214=a55_0xe7e5ce;this[_0x253214(0x193)]('api_calls',{'type':_0x253214(0x191),'endpoint':_0x362434,'method':_0x753d93,'userId':_0x11fb4c,'userRole':_0x48e0d3,'requestData':_0x38ecc5});}[a55_0xe7e5ce(0x1ac)](){const _0x9f6bfc=a55_0xe7e5ce;try{const _0x116956=fs_1['default'][_0x9f6bfc(0x1b8)](this[_0x9f6bfc(0x16b)]),_0x14f8fe=_0x116956[_0x9f6bfc(0x18c)](_0x20b5f2=>_0x20b5f2[_0x9f6bfc(0x18a)](_0x9f6bfc(0x190))),_0x5bfa77=[...new Set(_0x14f8fe[_0x9f6bfc(0x16d)](_0x455b87=>_0x455b87[_0x9f6bfc(0x1a9)]('_')[0x0]))],_0xd186b8=_0x14f8fe[_0x9f6bfc(0x16d)](_0x55bd4d=>{const _0x3e6c55=_0x9f6bfc,_0x2abbc9=path_1['default'][_0x3e6c55(0x1a3)](this[_0x3e6c55(0x16b)],_0x55bd4d),_0x2e5eb2=fs_1[_0x3e6c55(0x173)][_0x3e6c55(0x17b)](_0x2abbc9),[_0x4e352d,_0x3d3cf6]=_0x55bd4d[_0x3e6c55(0x1b0)](_0x3e6c55(0x190),'')['split']('_');return{'type':_0x4e352d,'date':_0x3d3cf6,'size':_0x2e5eb2[_0x3e6c55(0x199)]};})[_0x9f6bfc(0x16a)]((_0x43c313,_0x9234f9)=>_0x9234f9['date'][_0x9f6bfc(0x19b)](_0x43c313[_0x9f6bfc(0x1b6)]));return{'totalFiles':_0x14f8fe[_0x9f6bfc(0x188)],'logTypes':_0x5bfa77,'latestLogs':_0xd186b8[_0x9f6bfc(0x186)](0x0,0xa)};}catch(_0x3f7a91){return console[_0x9f6bfc(0x1b5)](_0x9f6bfc(0x197),_0x3f7a91),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x14c050=0x1e){const _0x39245e=a55_0xe7e5ce;try{const _0xe7ed32=fs_1[_0x39245e(0x173)][_0x39245e(0x1b8)](this[_0x39245e(0x16b)]),_0x45360a=new Date();_0x45360a['setDate'](_0x45360a[_0x39245e(0x19f)]()-_0x14c050);let _0x1de072=0x0;_0xe7ed32[_0x39245e(0x181)](_0x5a290e=>{const _0x5e4ded=_0x39245e;if(!_0x5a290e[_0x5e4ded(0x18a)](_0x5e4ded(0x190)))return;const _0x472b5b=path_1['default'][_0x5e4ded(0x1a3)](this['logsDir'],_0x5a290e),_0xef7e5a=fs_1['default'][_0x5e4ded(0x17b)](_0x472b5b);_0xef7e5a[_0x5e4ded(0x1b4)]<_0x45360a&&(fs_1[_0x5e4ded(0x173)][_0x5e4ded(0x1b3)](_0x472b5b),_0x1de072++,console[_0x5e4ded(0x1a8)](_0x5e4ded(0x198)+_0x5a290e));}),console[_0x39245e(0x1a8)]('🧹\x20Cleaned\x20'+_0x1de072+_0x39245e(0x187)+_0x14c050+_0x39245e(0x182));}catch(_0x28d55c){console['error'](_0x39245e(0x1ad),_0x28d55c);}}}exports['LoggerService']=LoggerService,exports[a55_0xe7e5ce(0x1ae)]=new LoggerService();