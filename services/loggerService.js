'use strict';const a49_0x5485e7=a49_0x3418;(function(_0x50545d,_0x5e9bec){const _0x42a745=a49_0x3418,_0x875800=_0x50545d();while(!![]){try{const _0x750208=parseInt(_0x42a745(0x109))/0x1*(parseInt(_0x42a745(0x125))/0x2)+parseInt(_0x42a745(0x10d))/0x3*(parseInt(_0x42a745(0xff))/0x4)+parseInt(_0x42a745(0x119))/0x5*(-parseInt(_0x42a745(0x10e))/0x6)+parseInt(_0x42a745(0x139))/0x7+-parseInt(_0x42a745(0x141))/0x8*(parseInt(_0x42a745(0x11d))/0x9)+parseInt(_0x42a745(0xf2))/0xa+-parseInt(_0x42a745(0x12b))/0xb;if(_0x750208===_0x5e9bec)break;else _0x875800['push'](_0x875800['shift']());}catch(_0x46b013){_0x875800['push'](_0x875800['shift']());}}}(a49_0x34c7,0xafb65));var __importDefault=this&&this['__importDefault']||function(_0x141ff4){const _0x1b953a=a49_0x3418;return _0x141ff4&&_0x141ff4[_0x1b953a(0x10c)]?_0x141ff4:{'default':_0x141ff4};};function a49_0x34c7(){const _0x51fea2=['ensureLogsDirectory','logWebhookError','path','cleanOldLogs','COINTOPAY_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','5571812uwcErH','logCoinToPayStatus','existsSync','mtime','payments_created','shop_webhooks_errors','PAYMENT_CREATED','logWhiteDomainError','\x20log:','forEach','90739tbTeAv','api_calls','logWhiteDomainRequest','__esModule','3SrZNLk','1008zgHxlo','toISOString','setDate','replace','SHOP_WEBHOOK_ERROR','stack','WEBHOOK_PROCESSED','filter','🧹\x20Cleaned\x20','white_domain_errors','error','33285PyUgyB','Failed\x20to\x20clean\x20old\x20logs:','log','logShopWebhookError','207uHLCZT','date','COINTOPAY_STATUS_CHANGE','cwd','WEBHOOK_RECEIVED','split','join','LoggerService','4REEUCz','sort','cointopay_errors','logApiCall','getLogStats','writeLog','5784295bNAqIR','.log','\x20days)','REQUEST','map','RESPONSE','slice','white_domain_requests','defineProperty','localeCompare','logShopWebhookSent','🗑️\x20Deleted\x20old\x20log\x20file:\x20','SHOP_WEBHOOK_SENT','webhooks_errors','4039497wNxWAP','getLogFileName','size','statSync','logWhiteDomainResponse','Failed\x20to\x20write\x20','default','white_domain_responses','275568ZzotJV','logWebhookReceived','message','logPaymentCreated','getDate','stringify','logCoinToPayError','webhooks_received','📁\x20Created\x20logs\x20directory:\x20','readdirSync','10046940DFRyYl','unlinkSync','length','logsDir','loggerService','API_CALL','Failed\x20to\x20get\x20log\x20stats:'];a49_0x34c7=function(){return _0x51fea2;};return a49_0x34c7();}function a49_0x3418(_0x8990bd,_0x38534a){const _0x34c7ca=a49_0x34c7();return a49_0x3418=function(_0x3418fe,_0x518817){_0x3418fe=_0x3418fe-0xec;let _0x5ab53a=_0x34c7ca[_0x3418fe];return _0x5ab53a;},a49_0x3418(_0x8990bd,_0x38534a);}Object[a49_0x5485e7(0x133)](exports,a49_0x5485e7(0x10c),{'value':!![]}),exports[a49_0x5485e7(0xf6)]=exports[a49_0x5485e7(0x124)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x5485e7(0xfb)));class LoggerService{constructor(){const _0x5c7e5c=a49_0x5485e7;this['logsDir']=path_1[_0x5c7e5c(0x13f)][_0x5c7e5c(0x123)](process[_0x5c7e5c(0x120)](),'logs'),this[_0x5c7e5c(0xf9)]();}[a49_0x5485e7(0xf9)](){const _0x7d1a08=a49_0x5485e7;!fs_1['default'][_0x7d1a08(0x101)](this[_0x7d1a08(0xf5)])&&(fs_1[_0x7d1a08(0x13f)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x7d1a08(0x11b)](_0x7d1a08(0xf0)+this[_0x7d1a08(0xf5)]));}['getLogFileName'](_0x2eebfd){const _0x245858=a49_0x5485e7,_0x3dbd9f=new Date()[_0x245858(0x10f)]()[_0x245858(0x122)]('T')[0x0];return path_1[_0x245858(0x13f)]['join'](this[_0x245858(0xf5)],_0x2eebfd+'_'+_0x3dbd9f+'.log');}[a49_0x5485e7(0x12a)](_0x145cc6,_0x3b8802){const _0x1c24ee=a49_0x5485e7;try{const _0x4a7c99=new Date()[_0x1c24ee(0x10f)](),_0x1cdc94={'timestamp':_0x4a7c99,..._0x3b8802},_0x53be76=JSON[_0x1c24ee(0xed)](_0x1cdc94)+'\x0a',_0x535f62=this[_0x1c24ee(0x13a)](_0x145cc6);fs_1[_0x1c24ee(0x13f)]['appendFileSync'](_0x535f62,_0x53be76,'utf8');}catch(_0x582f1f){console[_0x1c24ee(0x118)](_0x1c24ee(0x13e)+_0x145cc6+_0x1c24ee(0x107),_0x582f1f);}}[a49_0x5485e7(0x10b)](_0x57e23c,_0x1dc29c,_0x4eed92,_0x5d68e2){const _0xcf8ddd=a49_0x5485e7;this[_0xcf8ddd(0x12a)](_0xcf8ddd(0x132),{'type':_0xcf8ddd(0x12e),'gateway':_0x57e23c,'endpoint':_0x1dc29c,'method':_0x4eed92,'data':_0x5d68e2});}[a49_0x5485e7(0x13d)](_0x2218df,_0x261994,_0x4b0698,_0x49ebd8,_0x839b27){const _0xaf049e=a49_0x5485e7;this['writeLog'](_0xaf049e(0x140),{'type':_0xaf049e(0x130),'gateway':_0x2218df,'endpoint':_0x261994,'status':_0x4b0698,'responseTime':_0x839b27,'data':_0x49ebd8});}[a49_0x5485e7(0x106)](_0x14df63,_0x26bfbe,_0x45a354){const _0x132105=a49_0x5485e7;this[_0x132105(0x12a)](_0x132105(0x117),{'type':'ERROR','gateway':_0x14df63,'endpoint':_0x26bfbe,'error':_0x45a354 instanceof Error?{'message':_0x45a354[_0x132105(0x143)],'stack':_0x45a354[_0x132105(0x113)]}:_0x45a354});}[a49_0x5485e7(0x142)](_0x3d5bba,_0x2c0c84,_0x272439){const _0x5dafad=a49_0x5485e7;this[_0x5dafad(0x12a)](_0x5dafad(0xef),{'type':_0x5dafad(0x121),'gateway':_0x3d5bba,'headers':_0x272439,'data':_0x2c0c84});}['logWebhookProcessed'](_0xee2846,_0x5abb84,_0x5477c7,_0x54e7ba,_0x5ce39d){const _0x2bb000=a49_0x5485e7;this[_0x2bb000(0x12a)]('webhooks_processed',{'type':_0x2bb000(0x114),'gateway':_0xee2846,'paymentId':_0x5abb84,'oldStatus':_0x5477c7,'newStatus':_0x54e7ba,'originalData':_0x5ce39d});}[a49_0x5485e7(0xfa)](_0x28b91c,_0x3d8a45,_0x22e562){const _0x2e7077=a49_0x5485e7;this['writeLog'](_0x2e7077(0x138),{'type':'WEBHOOK_ERROR','gateway':_0x28b91c,'error':_0x3d8a45 instanceof Error?{'message':_0x3d8a45[_0x2e7077(0x143)],'stack':_0x3d8a45[_0x2e7077(0x113)]}:_0x3d8a45,'originalData':_0x22e562});}[a49_0x5485e7(0x100)](_0x388b57){const _0x4ccc29=a49_0x5485e7;this[_0x4ccc29(0x12a)]('cointopay_status_changes',{'type':_0x4ccc29(0x11f),..._0x388b57});}[a49_0x5485e7(0xee)](_0x4c8f9e){const _0x28b6e6=a49_0x5485e7;this[_0x28b6e6(0x12a)](_0x28b6e6(0x127),{'type':_0x28b6e6(0xfd),..._0x4c8f9e});}[a49_0x5485e7(0x135)](_0x117b67,_0x500e10,_0x4e2465,_0xf71736,_0x175f11,_0x48b212){const _0x4c31c3=a49_0x5485e7;this[_0x4c31c3(0x12a)]('shop_webhooks_sent',{'type':_0x4c31c3(0x137),'shopId':_0x117b67,'webhookUrl':_0x500e10,'event':_0x4e2465,'status':_0xf71736,'responseTime':_0x175f11,'payload':_0x48b212});}[a49_0x5485e7(0x11c)](_0x47f597,_0x28748e,_0x22d3d1,_0x347022,_0x4862f3){const _0x3a1cb4=a49_0x5485e7;this['writeLog'](_0x3a1cb4(0x104),{'type':_0x3a1cb4(0x112),'shopId':_0x47f597,'webhookUrl':_0x28748e,'event':_0x22d3d1,'error':_0x347022 instanceof Error?{'message':_0x347022[_0x3a1cb4(0x143)],'stack':_0x347022[_0x3a1cb4(0x113)]}:_0x347022,'payload':_0x4862f3});}[a49_0x5485e7(0x144)](_0xe916ec,_0x12db00,_0x55c15e,_0x401b41,_0x16525e){const _0x36f436=a49_0x5485e7;this[_0x36f436(0x12a)](_0x36f436(0x103),{'type':_0x36f436(0x105),'gateway':_0xe916ec,'paymentId':_0x12db00,'shopId':_0x55c15e,'amount':_0x401b41,'currency':_0x16525e});}[a49_0x5485e7(0x128)](_0x30de37,_0xac6bc0,_0x3ea96d,_0x699227,_0x4b358d){const _0x147653=a49_0x5485e7;this[_0x147653(0x12a)](_0x147653(0x10a),{'type':_0x147653(0xf7),'endpoint':_0x30de37,'method':_0xac6bc0,'userId':_0x3ea96d,'userRole':_0x699227,'requestData':_0x4b358d});}[a49_0x5485e7(0x129)](){const _0x1aff9f=a49_0x5485e7;try{const _0x6af5c9=fs_1['default'][_0x1aff9f(0xf1)](this[_0x1aff9f(0xf5)]),_0x236797=_0x6af5c9[_0x1aff9f(0x115)](_0x5e2b39=>_0x5e2b39['endsWith'](_0x1aff9f(0x12c))),_0x2afbbd=[...new Set(_0x236797[_0x1aff9f(0x12f)](_0x515b58=>_0x515b58['split']('_')[0x0]))],_0x593e8e=_0x236797[_0x1aff9f(0x12f)](_0x4ce67e=>{const _0x71a241=_0x1aff9f,_0x189a92=path_1[_0x71a241(0x13f)][_0x71a241(0x123)](this[_0x71a241(0xf5)],_0x4ce67e),_0x2764ef=fs_1[_0x71a241(0x13f)][_0x71a241(0x13c)](_0x189a92),[_0xd805f5,_0x283118]=_0x4ce67e[_0x71a241(0x111)]('.log','')[_0x71a241(0x122)]('_');return{'type':_0xd805f5,'date':_0x283118,'size':_0x2764ef[_0x71a241(0x13b)]};})[_0x1aff9f(0x126)]((_0x6de2a8,_0x18ddc5)=>_0x18ddc5['date'][_0x1aff9f(0x134)](_0x6de2a8[_0x1aff9f(0x11e)]));return{'totalFiles':_0x236797[_0x1aff9f(0xf4)],'logTypes':_0x2afbbd,'latestLogs':_0x593e8e[_0x1aff9f(0x131)](0x0,0xa)};}catch(_0xa02256){return console[_0x1aff9f(0x118)](_0x1aff9f(0xf8),_0xa02256),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x5485e7(0xfc)](_0x4f28b6=0x1e){const _0x4a3a7b=a49_0x5485e7;try{const _0x8f83b4=fs_1['default'][_0x4a3a7b(0xf1)](this['logsDir']),_0x198ae5=new Date();_0x198ae5[_0x4a3a7b(0x110)](_0x198ae5[_0x4a3a7b(0xec)]()-_0x4f28b6);let _0x21304c=0x0;_0x8f83b4[_0x4a3a7b(0x108)](_0x5b12bc=>{const _0x464676=_0x4a3a7b;if(!_0x5b12bc['endsWith'](_0x464676(0x12c)))return;const _0xdc4fdd=path_1['default'][_0x464676(0x123)](this[_0x464676(0xf5)],_0x5b12bc),_0x1131d8=fs_1[_0x464676(0x13f)][_0x464676(0x13c)](_0xdc4fdd);_0x1131d8[_0x464676(0x102)]<_0x198ae5&&(fs_1[_0x464676(0x13f)][_0x464676(0xf3)](_0xdc4fdd),_0x21304c++,console['log'](_0x464676(0x136)+_0x5b12bc));}),console[_0x4a3a7b(0x11b)](_0x4a3a7b(0x116)+_0x21304c+_0x4a3a7b(0xfe)+_0x4f28b6+_0x4a3a7b(0x12d));}catch(_0x4cdf0f){console[_0x4a3a7b(0x118)](_0x4a3a7b(0x11a),_0x4cdf0f);}}}exports['LoggerService']=LoggerService,exports[a49_0x5485e7(0xf6)]=new LoggerService();