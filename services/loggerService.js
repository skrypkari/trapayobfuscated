'use strict';const a59_0x4bb145=a59_0xd5fc;(function(_0x3d8458,_0x1fb7ce){const _0x2e4048=a59_0xd5fc,_0x453c5d=_0x3d8458();while(!![]){try{const _0x250fb4=-parseInt(_0x2e4048(0x17c))/0x1+parseInt(_0x2e4048(0x198))/0x2*(parseInt(_0x2e4048(0x15d))/0x3)+parseInt(_0x2e4048(0x162))/0x4+parseInt(_0x2e4048(0x195))/0x5*(-parseInt(_0x2e4048(0x169))/0x6)+parseInt(_0x2e4048(0x156))/0x7+parseInt(_0x2e4048(0x157))/0x8*(parseInt(_0x2e4048(0x164))/0x9)+parseInt(_0x2e4048(0x172))/0xa;if(_0x250fb4===_0x1fb7ce)break;else _0x453c5d['push'](_0x453c5d['shift']());}catch(_0x497795){_0x453c5d['push'](_0x453c5d['shift']());}}}(a59_0x322d,0xef137));var __importDefault=this&&this[a59_0x4bb145(0x160)]||function(_0x565897){const _0x4376e2=a59_0x4bb145;return _0x565897&&_0x565897[_0x4376e2(0x1a5)]?_0x565897:{'default':_0x565897};};function a59_0xd5fc(_0x50cf47,_0x5a3911){const _0x322dc0=a59_0x322d();return a59_0xd5fc=function(_0xd5fcfc,_0xa95d47){_0xd5fcfc=_0xd5fcfc-0x154;let _0x8f08c7=_0x322dc0[_0xd5fcfc];return _0x8f08c7;},a59_0xd5fc(_0x50cf47,_0x5a3911);}Object[a59_0x4bb145(0x193)](exports,a59_0x4bb145(0x1a5),{'value':!![]}),exports[a59_0x4bb145(0x15f)]=exports[a59_0x4bb145(0x159)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));function a59_0x322d(){const _0x3cf588=['getDate','webhooks_errors','split','cointopay_errors','shop_webhooks_sent','Failed\x20to\x20get\x20log\x20stats:','date','WEBHOOK_ERROR','error','default','cwd','size','forEach','logWhiteDomainResponse','white_domain_responses','writeLog','logWhiteDomainRequest','webhooks_received','COINTOPAY_ERROR','replace','defineProperty','📁\x20Created\x20logs\x20directory:\x20','26185iFEijm','payments_created','SHOP_WEBHOOK_ERROR','14hZQvse','logShopWebhookError','COINTOPAY_STATUS_CHANGE','mtime','\x20days)','filter','mkdirSync','cointopay_status_changes','length','existsSync','shop_webhooks_errors','readdirSync','logApiCall','__esModule','ERROR','stringify','1444842EqyGNp','3543016XRpadu','logPaymentCreated','LoggerService','statSync','🧹\x20Cleaned\x20','stack','9171taWtCc','endsWith','loggerService','__importDefault','slice','7199904whrnto','white_domain_errors','9UFWUrR','logWebhookError','WEBHOOK_PROCESSED','api_calls','logShopWebhookSent','900xGiaQJ','logWebhookProcessed','appendFileSync','logs','join','webhooks_processed','ensureLogsDirectory','getLogFileName','message','662200PCRUoL','Failed\x20to\x20clean\x20old\x20logs:','WEBHOOK_RECEIVED','\x20old\x20log\x20files\x20(older\x20than\x20','sort','toISOString','logsDir','.log','unlinkSync','logCoinToPayError','772073tiiwTO','log','map'];a59_0x322d=function(){return _0x3cf588;};return a59_0x322d();}class LoggerService{constructor(){const _0x551fcf=a59_0x4bb145;this[_0x551fcf(0x178)]=path_1['default'][_0x551fcf(0x16d)](process[_0x551fcf(0x189)](),_0x551fcf(0x16c)),this[_0x551fcf(0x16f)]();}['ensureLogsDirectory'](){const _0x9da3c6=a59_0x4bb145;!fs_1[_0x9da3c6(0x188)][_0x9da3c6(0x1a1)](this[_0x9da3c6(0x178)])&&(fs_1[_0x9da3c6(0x188)][_0x9da3c6(0x19e)](this[_0x9da3c6(0x178)],{'recursive':!![]}),console[_0x9da3c6(0x17d)](_0x9da3c6(0x194)+this[_0x9da3c6(0x178)]));}[a59_0x4bb145(0x170)](_0x48b5f1){const _0x2d1f41=a59_0x4bb145,_0x13f882=new Date()['toISOString']()[_0x2d1f41(0x181)]('T')[0x0];return path_1[_0x2d1f41(0x188)]['join'](this[_0x2d1f41(0x178)],_0x48b5f1+'_'+_0x13f882+_0x2d1f41(0x179));}[a59_0x4bb145(0x18e)](_0x518c85,_0x5213d8){const _0x350e83=a59_0x4bb145;try{const _0x5ea627=new Date()[_0x350e83(0x177)](),_0x28b4c9={'timestamp':_0x5ea627,..._0x5213d8},_0xe0db8b=JSON[_0x350e83(0x155)](_0x28b4c9)+'\x0a',_0x23195a=this[_0x350e83(0x170)](_0x518c85);fs_1['default'][_0x350e83(0x16b)](_0x23195a,_0xe0db8b,'utf8');}catch(_0x3376bf){console[_0x350e83(0x187)]('Failed\x20to\x20write\x20'+_0x518c85+'\x20log:',_0x3376bf);}}[a59_0x4bb145(0x18f)](_0x571772,_0x577141,_0x2a7b89,_0x4eb3e4){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0x571772,'endpoint':_0x577141,'method':_0x2a7b89,'data':_0x4eb3e4});}[a59_0x4bb145(0x18c)](_0x4d9561,_0x56e23a,_0x2d5468,_0x44380e,_0x3f520b){const _0x5a0572=a59_0x4bb145;this['writeLog'](_0x5a0572(0x18d),{'type':'RESPONSE','gateway':_0x4d9561,'endpoint':_0x56e23a,'status':_0x2d5468,'responseTime':_0x3f520b,'data':_0x44380e});}['logWhiteDomainError'](_0x124d75,_0x40db06,_0xccd7c3){const _0x49aef7=a59_0x4bb145;this[_0x49aef7(0x18e)](_0x49aef7(0x163),{'type':_0x49aef7(0x154),'gateway':_0x124d75,'endpoint':_0x40db06,'error':_0xccd7c3 instanceof Error?{'message':_0xccd7c3['message'],'stack':_0xccd7c3[_0x49aef7(0x15c)]}:_0xccd7c3});}['logWebhookReceived'](_0x1c5e0a,_0x4c90b2,_0x3b93d1){const _0x22a3b2=a59_0x4bb145;this[_0x22a3b2(0x18e)](_0x22a3b2(0x190),{'type':_0x22a3b2(0x174),'gateway':_0x1c5e0a,'headers':_0x3b93d1,'data':_0x4c90b2});}[a59_0x4bb145(0x16a)](_0x309660,_0x30af52,_0x4e3152,_0x483823,_0x8f7429){const _0x59f430=a59_0x4bb145;this[_0x59f430(0x18e)](_0x59f430(0x16e),{'type':_0x59f430(0x166),'gateway':_0x309660,'paymentId':_0x30af52,'oldStatus':_0x4e3152,'newStatus':_0x483823,'originalData':_0x8f7429});}[a59_0x4bb145(0x165)](_0x2da365,_0xb9d532,_0x35cf0a){const _0x21d27c=a59_0x4bb145;this['writeLog'](_0x21d27c(0x180),{'type':_0x21d27c(0x186),'gateway':_0x2da365,'error':_0xb9d532 instanceof Error?{'message':_0xb9d532[_0x21d27c(0x171)],'stack':_0xb9d532[_0x21d27c(0x15c)]}:_0xb9d532,'originalData':_0x35cf0a});}['logCoinToPayStatus'](_0x5752e0){const _0x49dcb1=a59_0x4bb145;this[_0x49dcb1(0x18e)](_0x49dcb1(0x19f),{'type':_0x49dcb1(0x19a),..._0x5752e0});}[a59_0x4bb145(0x17b)](_0x2abb80){const _0x5db052=a59_0x4bb145;this['writeLog'](_0x5db052(0x182),{'type':_0x5db052(0x191),..._0x2abb80});}[a59_0x4bb145(0x168)](_0xea051,_0x257c36,_0x2e173f,_0x3084d8,_0x4bb84d,_0x36619f){const _0x31ff98=a59_0x4bb145;this['writeLog'](_0x31ff98(0x183),{'type':'SHOP_WEBHOOK_SENT','shopId':_0xea051,'webhookUrl':_0x257c36,'event':_0x2e173f,'status':_0x3084d8,'responseTime':_0x4bb84d,'payload':_0x36619f});}[a59_0x4bb145(0x199)](_0x38a34e,_0x26aaa1,_0x876302,_0xba07b4,_0x538b8a){const _0x492aa1=a59_0x4bb145;this[_0x492aa1(0x18e)](_0x492aa1(0x1a2),{'type':_0x492aa1(0x197),'shopId':_0x38a34e,'webhookUrl':_0x26aaa1,'event':_0x876302,'error':_0xba07b4 instanceof Error?{'message':_0xba07b4[_0x492aa1(0x171)],'stack':_0xba07b4[_0x492aa1(0x15c)]}:_0xba07b4,'payload':_0x538b8a});}[a59_0x4bb145(0x158)](_0x628054,_0x510769,_0x256b77,_0x1effbb,_0x5ac04d){const _0x3c31ed=a59_0x4bb145;this[_0x3c31ed(0x18e)](_0x3c31ed(0x196),{'type':'PAYMENT_CREATED','gateway':_0x628054,'paymentId':_0x510769,'shopId':_0x256b77,'amount':_0x1effbb,'currency':_0x5ac04d});}[a59_0x4bb145(0x1a4)](_0x461e9a,_0x5e7207,_0x200a0a,_0xed9595,_0x166452){const _0x50a141=a59_0x4bb145;this[_0x50a141(0x18e)](_0x50a141(0x167),{'type':'API_CALL','endpoint':_0x461e9a,'method':_0x5e7207,'userId':_0x200a0a,'userRole':_0xed9595,'requestData':_0x166452});}['getLogStats'](){const _0x28f9be=a59_0x4bb145;try{const _0x15dc57=fs_1[_0x28f9be(0x188)]['readdirSync'](this['logsDir']),_0x40e716=_0x15dc57[_0x28f9be(0x19d)](_0x320b51=>_0x320b51[_0x28f9be(0x15e)]('.log')),_0x59f181=[...new Set(_0x40e716[_0x28f9be(0x17e)](_0x541be5=>_0x541be5[_0x28f9be(0x181)]('_')[0x0]))],_0x42cc87=_0x40e716[_0x28f9be(0x17e)](_0x3c2f92=>{const _0x4f3b5f=_0x28f9be,_0x161592=path_1[_0x4f3b5f(0x188)][_0x4f3b5f(0x16d)](this[_0x4f3b5f(0x178)],_0x3c2f92),_0x4c29c9=fs_1['default'][_0x4f3b5f(0x15a)](_0x161592),[_0x16725a,_0x9ceba1]=_0x3c2f92[_0x4f3b5f(0x192)]('.log','')[_0x4f3b5f(0x181)]('_');return{'type':_0x16725a,'date':_0x9ceba1,'size':_0x4c29c9[_0x4f3b5f(0x18a)]};})[_0x28f9be(0x176)]((_0x17409a,_0x4658cf)=>_0x4658cf[_0x28f9be(0x185)]['localeCompare'](_0x17409a[_0x28f9be(0x185)]));return{'totalFiles':_0x40e716[_0x28f9be(0x1a0)],'logTypes':_0x59f181,'latestLogs':_0x42cc87[_0x28f9be(0x161)](0x0,0xa)};}catch(_0x2ab83e){return console[_0x28f9be(0x187)](_0x28f9be(0x184),_0x2ab83e),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x3b3280=0x1e){const _0xc4ed59=a59_0x4bb145;try{const _0x188031=fs_1[_0xc4ed59(0x188)][_0xc4ed59(0x1a3)](this[_0xc4ed59(0x178)]),_0x3bc0d0=new Date();_0x3bc0d0['setDate'](_0x3bc0d0[_0xc4ed59(0x17f)]()-_0x3b3280);let _0x2b3e96=0x0;_0x188031[_0xc4ed59(0x18b)](_0x3e2415=>{const _0x357387=_0xc4ed59;if(!_0x3e2415[_0x357387(0x15e)](_0x357387(0x179)))return;const _0x3cfb4b=path_1[_0x357387(0x188)]['join'](this['logsDir'],_0x3e2415),_0x1ea0af=fs_1['default'][_0x357387(0x15a)](_0x3cfb4b);_0x1ea0af[_0x357387(0x19b)]<_0x3bc0d0&&(fs_1['default'][_0x357387(0x17a)](_0x3cfb4b),_0x2b3e96++,console[_0x357387(0x17d)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x3e2415));}),console[_0xc4ed59(0x17d)](_0xc4ed59(0x15b)+_0x2b3e96+_0xc4ed59(0x175)+_0x3b3280+_0xc4ed59(0x19c));}catch(_0x5b88ff){console[_0xc4ed59(0x187)](_0xc4ed59(0x173),_0x5b88ff);}}}exports[a59_0x4bb145(0x159)]=LoggerService,exports['loggerService']=new LoggerService();