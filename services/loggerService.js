'use strict';const a48_0x47a634=a48_0x1d7f;(function(_0xdbe3ab,_0x34784d){const _0x27e746=a48_0x1d7f,_0x667bd5=_0xdbe3ab();while(!![]){try{const _0x41b259=-parseInt(_0x27e746(0x1f2))/0x1+parseInt(_0x27e746(0x212))/0x2*(-parseInt(_0x27e746(0x208))/0x3)+parseInt(_0x27e746(0x201))/0x4*(-parseInt(_0x27e746(0x207))/0x5)+-parseInt(_0x27e746(0x22a))/0x6*(parseInt(_0x27e746(0x1e4))/0x7)+-parseInt(_0x27e746(0x22c))/0x8+parseInt(_0x27e746(0x1fe))/0x9*(parseInt(_0x27e746(0x1f9))/0xa)+-parseInt(_0x27e746(0x1e3))/0xb*(-parseInt(_0x27e746(0x21a))/0xc);if(_0x41b259===_0x34784d)break;else _0x667bd5['push'](_0x667bd5['shift']());}catch(_0x16d8e4){_0x667bd5['push'](_0x667bd5['shift']());}}}(a48_0xc552,0x8e508));var __importDefault=this&&this[a48_0x47a634(0x214)]||function(_0x11c231){const _0xc2654c=a48_0x47a634;return _0x11c231&&_0x11c231[_0xc2654c(0x1e1)]?_0x11c231:{'default':_0x11c231};};function a48_0x1d7f(_0x219098,_0xb82040){const _0xc55256=a48_0xc552();return a48_0x1d7f=function(_0x1d7f19,_0x4f2223){_0x1d7f19=_0x1d7f19-0x1e0;let _0x7fa71e=_0xc55256[_0x1d7f19];return _0x7fa71e;},a48_0x1d7f(_0x219098,_0xb82040);}Object[a48_0x47a634(0x1e5)](exports,a48_0x47a634(0x1e1),{'value':!![]}),exports['loggerService']=exports[a48_0x47a634(0x224)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x47a634(0x1e7)));class LoggerService{constructor(){const _0x16d798=a48_0x47a634;this[_0x16d798(0x1e0)]=path_1['default'][_0x16d798(0x1fd)](process[_0x16d798(0x225)](),_0x16d798(0x1ff)),this[_0x16d798(0x218)]();}['ensureLogsDirectory'](){const _0xe62c97=a48_0x47a634;!fs_1[_0xe62c97(0x233)][_0xe62c97(0x200)](this[_0xe62c97(0x1e0)])&&(fs_1[_0xe62c97(0x233)][_0xe62c97(0x1fb)](this[_0xe62c97(0x1e0)],{'recursive':!![]}),console[_0xe62c97(0x206)](_0xe62c97(0x21f)+this['logsDir']));}[a48_0x47a634(0x20b)](_0x308291){const _0x40c374=a48_0x47a634,_0x3104b1=new Date()['toISOString']()[_0x40c374(0x21e)]('T')[0x0];return path_1[_0x40c374(0x233)]['join'](this[_0x40c374(0x1e0)],_0x308291+'_'+_0x3104b1+_0x40c374(0x215));}['writeLog'](_0x2a743a,_0x1f2a0e){const _0x70f3e1=a48_0x47a634;try{const _0x5bf43e=new Date()[_0x70f3e1(0x219)](),_0x866239={'timestamp':_0x5bf43e,..._0x1f2a0e},_0x222aa1=JSON[_0x70f3e1(0x1f5)](_0x866239)+'\x0a',_0x16dc03=this['getLogFileName'](_0x2a743a);fs_1['default']['appendFileSync'](_0x16dc03,_0x222aa1,'utf8');}catch(_0x1a79bd){console[_0x70f3e1(0x21c)](_0x70f3e1(0x1f6)+_0x2a743a+_0x70f3e1(0x213),_0x1a79bd);}}[a48_0x47a634(0x1ec)](_0x10fe42,_0x359ba6,_0x1dcf86,_0x4d4e24){const _0x1eb098=a48_0x47a634;this['writeLog'](_0x1eb098(0x228),{'type':_0x1eb098(0x21d),'gateway':_0x10fe42,'endpoint':_0x359ba6,'method':_0x1dcf86,'data':_0x4d4e24});}['logWhiteDomainResponse'](_0x2b197d,_0x39a2e1,_0x32702d,_0x2e3604,_0x59f061){const _0x5efaea=a48_0x47a634;this[_0x5efaea(0x205)](_0x5efaea(0x211),{'type':_0x5efaea(0x221),'gateway':_0x2b197d,'endpoint':_0x39a2e1,'status':_0x32702d,'responseTime':_0x59f061,'data':_0x2e3604});}[a48_0x47a634(0x222)](_0x3db77b,_0x354ab2,_0x5aea86){const _0x2ad95d=a48_0x47a634;this[_0x2ad95d(0x205)](_0x2ad95d(0x1f7),{'type':_0x2ad95d(0x1ee),'gateway':_0x3db77b,'endpoint':_0x354ab2,'error':_0x5aea86 instanceof Error?{'message':_0x5aea86[_0x2ad95d(0x1fc)],'stack':_0x5aea86['stack']}:_0x5aea86});}[a48_0x47a634(0x20f)](_0x564550,_0x4eb71a,_0xf2d175){const _0x273a0a=a48_0x47a634;this[_0x273a0a(0x205)](_0x273a0a(0x1ea),{'type':_0x273a0a(0x1f8),'gateway':_0x564550,'headers':_0xf2d175,'data':_0x4eb71a});}['logWebhookProcessed'](_0x146a6a,_0x157500,_0x344eca,_0xe060a1,_0x4884b5){const _0x2092da=a48_0x47a634;this['writeLog'](_0x2092da(0x220),{'type':'WEBHOOK_PROCESSED','gateway':_0x146a6a,'paymentId':_0x157500,'oldStatus':_0x344eca,'newStatus':_0xe060a1,'originalData':_0x4884b5});}[a48_0x47a634(0x202)](_0x16752b,_0x1ab8dc,_0x42b41d){const _0x4a0427=a48_0x47a634;this['writeLog'](_0x4a0427(0x1e9),{'type':_0x4a0427(0x216),'gateway':_0x16752b,'error':_0x1ab8dc instanceof Error?{'message':_0x1ab8dc[_0x4a0427(0x1fc)],'stack':_0x1ab8dc[_0x4a0427(0x22e)]}:_0x1ab8dc,'originalData':_0x42b41d});}[a48_0x47a634(0x209)](_0x997d3){const _0x4f6c77=a48_0x47a634;this[_0x4f6c77(0x205)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x997d3});}['logCoinToPayError'](_0x13712c){const _0x221094=a48_0x47a634;this[_0x221094(0x205)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x13712c});}['logShopWebhookSent'](_0xa7c10b,_0xe186cc,_0x5e3328,_0x2fb150,_0x6f73c9,_0x4aa8e9){const _0x4b7519=a48_0x47a634;this['writeLog'](_0x4b7519(0x1f4),{'type':_0x4b7519(0x226),'shopId':_0xa7c10b,'webhookUrl':_0xe186cc,'event':_0x5e3328,'status':_0x2fb150,'responseTime':_0x6f73c9,'payload':_0x4aa8e9});}[a48_0x47a634(0x1e6)](_0x287e65,_0x3056aa,_0x5929a9,_0x55c364,_0x43b313){const _0xadc360=a48_0x47a634;this[_0xadc360(0x205)](_0xadc360(0x1eb),{'type':_0xadc360(0x230),'shopId':_0x287e65,'webhookUrl':_0x3056aa,'event':_0x5929a9,'error':_0x55c364 instanceof Error?{'message':_0x55c364[_0xadc360(0x1fc)],'stack':_0x55c364[_0xadc360(0x22e)]}:_0x55c364,'payload':_0x43b313});}['logPaymentCreated'](_0x4648ea,_0x6e09de,_0x249831,_0x134fb3,_0x1f17b6){const _0xa74117=a48_0x47a634;this[_0xa74117(0x205)](_0xa74117(0x20d),{'type':'PAYMENT_CREATED','gateway':_0x4648ea,'paymentId':_0x6e09de,'shopId':_0x249831,'amount':_0x134fb3,'currency':_0x1f17b6});}[a48_0x47a634(0x217)](_0x37e715,_0x27fe20,_0x2f0b52,_0x27f1c5,_0x5971a1){const _0x14910f=a48_0x47a634;this['writeLog'](_0x14910f(0x22b),{'type':'API_CALL','endpoint':_0x37e715,'method':_0x27fe20,'userId':_0x2f0b52,'userRole':_0x27f1c5,'requestData':_0x5971a1});}[a48_0x47a634(0x22f)](){const _0x1a5eef=a48_0x47a634;try{const _0x465e20=fs_1[_0x1a5eef(0x233)][_0x1a5eef(0x20e)](this['logsDir']),_0x1083a9=_0x465e20['filter'](_0x1ba140=>_0x1ba140[_0x1a5eef(0x1f1)](_0x1a5eef(0x215))),_0x14d9aa=[...new Set(_0x1083a9[_0x1a5eef(0x232)](_0x40c905=>_0x40c905[_0x1a5eef(0x21e)]('_')[0x0]))],_0x544ae7=_0x1083a9[_0x1a5eef(0x232)](_0x44f4a3=>{const _0x5af3d9=_0x1a5eef,_0x142a1c=path_1[_0x5af3d9(0x233)][_0x5af3d9(0x1fd)](this[_0x5af3d9(0x1e0)],_0x44f4a3),_0x1d4991=fs_1[_0x5af3d9(0x233)]['statSync'](_0x142a1c),[_0x1add9d,_0x41b889]=_0x44f4a3[_0x5af3d9(0x1ef)](_0x5af3d9(0x215),'')['split']('_');return{'type':_0x1add9d,'date':_0x41b889,'size':_0x1d4991[_0x5af3d9(0x1f3)]};})[_0x1a5eef(0x21b)]((_0x48920c,_0x115b06)=>_0x115b06['date'][_0x1a5eef(0x1e2)](_0x48920c[_0x1a5eef(0x227)]));return{'totalFiles':_0x1083a9[_0x1a5eef(0x20a)],'logTypes':_0x14d9aa,'latestLogs':_0x544ae7['slice'](0x0,0xa)};}catch(_0x4af9f8){return console[_0x1a5eef(0x21c)](_0x1a5eef(0x22d),_0x4af9f8),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x47a634(0x229)](_0x464222=0x1e){const _0x9e096c=a48_0x47a634;try{const _0x30d04a=fs_1[_0x9e096c(0x233)][_0x9e096c(0x20e)](this[_0x9e096c(0x1e0)]),_0x2ef081=new Date();_0x2ef081[_0x9e096c(0x203)](_0x2ef081[_0x9e096c(0x1f0)]()-_0x464222);let _0x33c02f=0x0;_0x30d04a[_0x9e096c(0x1e8)](_0x13c9c4=>{const _0x1228c9=_0x9e096c;if(!_0x13c9c4[_0x1228c9(0x1f1)](_0x1228c9(0x215)))return;const _0x53ffc0=path_1[_0x1228c9(0x233)][_0x1228c9(0x1fd)](this['logsDir'],_0x13c9c4),_0x3b7864=fs_1[_0x1228c9(0x233)][_0x1228c9(0x20c)](_0x53ffc0);_0x3b7864[_0x1228c9(0x1ed)]<_0x2ef081&&(fs_1[_0x1228c9(0x233)][_0x1228c9(0x210)](_0x53ffc0),_0x33c02f++,console[_0x1228c9(0x206)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x13c9c4));}),console['log'](_0x9e096c(0x1fa)+_0x33c02f+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x464222+_0x9e096c(0x223));}catch(_0x529f19){console[_0x9e096c(0x21c)](_0x9e096c(0x231),_0x529f19);}}}function a48_0xc552(){const _0x118501=['ensureLogsDirectory','toISOString','19308bfXDYF','sort','error','REQUEST','split','📁\x20Created\x20logs\x20directory:\x20','webhooks_processed','RESPONSE','logWhiteDomainError','\x20days)','LoggerService','cwd','SHOP_WEBHOOK_SENT','date','white_domain_requests','cleanOldLogs','834rrhEEg','api_calls','5799056GyqTNz','Failed\x20to\x20get\x20log\x20stats:','stack','getLogStats','SHOP_WEBHOOK_ERROR','Failed\x20to\x20clean\x20old\x20logs:','map','default','logsDir','__esModule','localeCompare','21230hKDXAZ','50421jEfhKt','defineProperty','logShopWebhookError','path','forEach','webhooks_errors','webhooks_received','shop_webhooks_errors','logWhiteDomainRequest','mtime','ERROR','replace','getDate','endsWith','630710ohJAcs','size','shop_webhooks_sent','stringify','Failed\x20to\x20write\x20','white_domain_errors','WEBHOOK_RECEIVED','10410WthQmU','🧹\x20Cleaned\x20','mkdirSync','message','join','1557ZyWLVw','logs','existsSync','2624aXcfTS','logWebhookError','setDate','loggerService','writeLog','log','1255RLcoVx','222ljLqgG','logCoinToPayStatus','length','getLogFileName','statSync','payments_created','readdirSync','logWebhookReceived','unlinkSync','white_domain_responses','4894YduYFe','\x20log:','__importDefault','.log','WEBHOOK_ERROR','logApiCall'];a48_0xc552=function(){return _0x118501;};return a48_0xc552();}exports[a48_0x47a634(0x224)]=LoggerService,exports[a48_0x47a634(0x204)]=new LoggerService();