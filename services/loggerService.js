'use strict';function a48_0xae79(){const _0x37278c=['RESPONSE','logWhiteDomainResponse','split','logApiCall','default','appendFileSync','Failed\x20to\x20get\x20log\x20stats:','🗑️\x20Deleted\x20old\x20log\x20file:\x20','setDate','REQUEST','logWhiteDomainRequest','462603xMeofj','__importDefault','logsDir','date','mtime','unlinkSync','cointopay_status_changes','6909432tPYSDy','logWebhookProcessed','SHOP_WEBHOOK_ERROR','webhooks_received','4NkRRqn','Failed\x20to\x20write\x20','6291171UbkZbK','COINTOPAY_STATUS_CHANGE','statSync','error','size','path','toISOString','\x20days)','logs','logWhiteDomainError','utf8','endsWith','white_domain_responses','getLogFileName','36547QgQYim','COINTOPAY_ERROR','__esModule','stringify','api_calls','logWebhookReceived','API_CALL','.log','3175992lUxYIv','cleanOldLogs','2186410qfphWC','white_domain_errors','WEBHOOK_PROCESSED','forEach','LoggerService','Failed\x20to\x20clean\x20old\x20logs:','ensureLogsDirectory','SHOP_WEBHOOK_SENT','📁\x20Created\x20logs\x20directory:\x20','sort','cointopay_errors','\x20log:','readdirSync','message','stack','defineProperty','🧹\x20Cleaned\x20','\x20old\x20log\x20files\x20(older\x20than\x20','map','filter','writeLog','slice','length','webhooks_processed','getLogStats','shop_webhooks_errors','shop_webhooks_sent','38BtXHUi','6743072UqdYyu','payments_created','mkdirSync','logShopWebhookError','join','log','ERROR','30Arbdcw','logWebhookError'];a48_0xae79=function(){return _0x37278c;};return a48_0xae79();}const a48_0xf45137=a48_0x5013;(function(_0x349b70,_0x421ca0){const _0x8dcbc5=a48_0x5013,_0x99e560=_0x349b70();while(!![]){try{const _0x374703=parseInt(_0x8dcbc5(0x1c7))/0x1*(-parseInt(_0x8dcbc5(0x1ec))/0x2)+parseInt(_0x8dcbc5(0x1ac))/0x3*(-parseInt(_0x8dcbc5(0x1b7))/0x4)+-parseInt(_0x8dcbc5(0x1d1))/0x5+parseInt(_0x8dcbc5(0x1b3))/0x6+-parseInt(_0x8dcbc5(0x1ed))/0x7+-parseInt(_0x8dcbc5(0x1cf))/0x8+parseInt(_0x8dcbc5(0x1b9))/0x9*(parseInt(_0x8dcbc5(0x19f))/0xa);if(_0x374703===_0x421ca0)break;else _0x99e560['push'](_0x99e560['shift']());}catch(_0x5c98ae){_0x99e560['push'](_0x99e560['shift']());}}}(a48_0xae79,0x9315a));var __importDefault=this&&this[a48_0xf45137(0x1ad)]||function(_0x401885){const _0x1f8782=a48_0xf45137;return _0x401885&&_0x401885[_0x1f8782(0x1c9)]?_0x401885:{'default':_0x401885};};Object[a48_0xf45137(0x1e0)](exports,a48_0xf45137(0x1c9),{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0xf45137(0x1be)));function a48_0x5013(_0x4152c2,_0x533c91){const _0xae7934=a48_0xae79();return a48_0x5013=function(_0x501304,_0x2d1d6a){_0x501304=_0x501304-0x19b;let _0x5bcf5b=_0xae7934[_0x501304];return _0x5bcf5b;},a48_0x5013(_0x4152c2,_0x533c91);}class LoggerService{constructor(){const _0x392600=a48_0xf45137;this[_0x392600(0x1ae)]=path_1['default'][_0x392600(0x19c)](process['cwd'](),_0x392600(0x1c1)),this[_0x392600(0x1d7)]();}[a48_0xf45137(0x1d7)](){const _0x257174=a48_0xf45137;!fs_1[_0x257174(0x1a5)]['existsSync'](this[_0x257174(0x1ae)])&&(fs_1[_0x257174(0x1a5)][_0x257174(0x1ef)](this[_0x257174(0x1ae)],{'recursive':!![]}),console[_0x257174(0x19d)](_0x257174(0x1d9)+this['logsDir']));}[a48_0xf45137(0x1c6)](_0x58f110){const _0x2fdd4f=a48_0xf45137,_0x523373=new Date()[_0x2fdd4f(0x1bf)]()[_0x2fdd4f(0x1a3)]('T')[0x0];return path_1[_0x2fdd4f(0x1a5)]['join'](this[_0x2fdd4f(0x1ae)],_0x58f110+'_'+_0x523373+'.log');}[a48_0xf45137(0x1e5)](_0x503385,_0x246c72){const _0x58b69d=a48_0xf45137;try{const _0x24eb17=new Date()['toISOString'](),_0x4799c4={'timestamp':_0x24eb17,..._0x246c72},_0x24ca29=JSON[_0x58b69d(0x1ca)](_0x4799c4)+'\x0a',_0x610e56=this[_0x58b69d(0x1c6)](_0x503385);fs_1[_0x58b69d(0x1a5)][_0x58b69d(0x1a6)](_0x610e56,_0x24ca29,_0x58b69d(0x1c3));}catch(_0x53b098){console[_0x58b69d(0x1bc)](_0x58b69d(0x1b8)+_0x503385+_0x58b69d(0x1dc),_0x53b098);}}[a48_0xf45137(0x1ab)](_0x14a76a,_0x1a91be,_0x1d48b8,_0x1f1e4a){const _0x4e504b=a48_0xf45137;this[_0x4e504b(0x1e5)]('white_domain_requests',{'type':_0x4e504b(0x1aa),'gateway':_0x14a76a,'endpoint':_0x1a91be,'method':_0x1d48b8,'data':_0x1f1e4a});}[a48_0xf45137(0x1a2)](_0x5ed3d5,_0x3c52f5,_0x2026e9,_0x16086b,_0x284084){const _0x1b25df=a48_0xf45137;this['writeLog'](_0x1b25df(0x1c5),{'type':_0x1b25df(0x1a1),'gateway':_0x5ed3d5,'endpoint':_0x3c52f5,'status':_0x2026e9,'responseTime':_0x284084,'data':_0x16086b});}[a48_0xf45137(0x1c2)](_0x58302e,_0x217848,_0xa0a35a){const _0x472b65=a48_0xf45137;this[_0x472b65(0x1e5)](_0x472b65(0x1d2),{'type':_0x472b65(0x19e),'gateway':_0x58302e,'endpoint':_0x217848,'error':_0xa0a35a instanceof Error?{'message':_0xa0a35a[_0x472b65(0x1de)],'stack':_0xa0a35a['stack']}:_0xa0a35a});}[a48_0xf45137(0x1cc)](_0x32ae15,_0x3c61e5,_0x1e3494){const _0x3b24b6=a48_0xf45137;this[_0x3b24b6(0x1e5)](_0x3b24b6(0x1b6),{'type':'WEBHOOK_RECEIVED','gateway':_0x32ae15,'headers':_0x1e3494,'data':_0x3c61e5});}[a48_0xf45137(0x1b4)](_0x53e0c2,_0x27be23,_0x4538a2,_0x97aa8c,_0x258b22){const _0x18a71f=a48_0xf45137;this[_0x18a71f(0x1e5)](_0x18a71f(0x1e8),{'type':_0x18a71f(0x1d3),'gateway':_0x53e0c2,'paymentId':_0x27be23,'oldStatus':_0x4538a2,'newStatus':_0x97aa8c,'originalData':_0x258b22});}[a48_0xf45137(0x1a0)](_0x33f2ad,_0x372076,_0x4062af){const _0x57ee8d=a48_0xf45137;this['writeLog']('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x33f2ad,'error':_0x372076 instanceof Error?{'message':_0x372076[_0x57ee8d(0x1de)],'stack':_0x372076[_0x57ee8d(0x1df)]}:_0x372076,'originalData':_0x4062af});}['logCoinToPayStatus'](_0x11bc10){const _0x40860a=a48_0xf45137;this[_0x40860a(0x1e5)](_0x40860a(0x1b2),{'type':_0x40860a(0x1ba),..._0x11bc10});}['logCoinToPayError'](_0x1d7ebf){const _0x2cb382=a48_0xf45137;this[_0x2cb382(0x1e5)](_0x2cb382(0x1db),{'type':_0x2cb382(0x1c8),..._0x1d7ebf});}['logShopWebhookSent'](_0x1908e8,_0x589b04,_0x3d9ddd,_0x3913da,_0x5c1ac9,_0x19c65d){const _0x43835e=a48_0xf45137;this['writeLog'](_0x43835e(0x1eb),{'type':_0x43835e(0x1d8),'shopId':_0x1908e8,'webhookUrl':_0x589b04,'event':_0x3d9ddd,'status':_0x3913da,'responseTime':_0x5c1ac9,'payload':_0x19c65d});}[a48_0xf45137(0x19b)](_0x5beb0e,_0x489450,_0x5ed9e0,_0x28c328,_0x193b76){const _0x5e7e26=a48_0xf45137;this['writeLog'](_0x5e7e26(0x1ea),{'type':_0x5e7e26(0x1b5),'shopId':_0x5beb0e,'webhookUrl':_0x489450,'event':_0x5ed9e0,'error':_0x28c328 instanceof Error?{'message':_0x28c328[_0x5e7e26(0x1de)],'stack':_0x28c328[_0x5e7e26(0x1df)]}:_0x28c328,'payload':_0x193b76});}['logPaymentCreated'](_0x2ce1a7,_0x10dc68,_0x5e697b,_0x5252d3,_0x5b9e2c){const _0x34277c=a48_0xf45137;this[_0x34277c(0x1e5)](_0x34277c(0x1ee),{'type':'PAYMENT_CREATED','gateway':_0x2ce1a7,'paymentId':_0x10dc68,'shopId':_0x5e697b,'amount':_0x5252d3,'currency':_0x5b9e2c});}[a48_0xf45137(0x1a4)](_0x16d3c8,_0x563d29,_0x24b1ce,_0x3ae3b7,_0x204d5c){const _0x1ea669=a48_0xf45137;this['writeLog'](_0x1ea669(0x1cb),{'type':_0x1ea669(0x1cd),'endpoint':_0x16d3c8,'method':_0x563d29,'userId':_0x24b1ce,'userRole':_0x3ae3b7,'requestData':_0x204d5c});}[a48_0xf45137(0x1e9)](){const _0x3f7aa5=a48_0xf45137;try{const _0x4db52b=fs_1[_0x3f7aa5(0x1a5)][_0x3f7aa5(0x1dd)](this[_0x3f7aa5(0x1ae)]),_0x3bd803=_0x4db52b[_0x3f7aa5(0x1e4)](_0x2fdc11=>_0x2fdc11[_0x3f7aa5(0x1c4)](_0x3f7aa5(0x1ce))),_0x48d0a2=[...new Set(_0x3bd803[_0x3f7aa5(0x1e3)](_0x3c4b00=>_0x3c4b00[_0x3f7aa5(0x1a3)]('_')[0x0]))],_0x1b8965=_0x3bd803[_0x3f7aa5(0x1e3)](_0x1d12f1=>{const _0x43651a=_0x3f7aa5,_0x201735=path_1[_0x43651a(0x1a5)][_0x43651a(0x19c)](this[_0x43651a(0x1ae)],_0x1d12f1),_0x31f45f=fs_1[_0x43651a(0x1a5)][_0x43651a(0x1bb)](_0x201735),[_0x4527c3,_0x34bfb2]=_0x1d12f1['replace'](_0x43651a(0x1ce),'')['split']('_');return{'type':_0x4527c3,'date':_0x34bfb2,'size':_0x31f45f[_0x43651a(0x1bd)]};})[_0x3f7aa5(0x1da)]((_0x4a4590,_0x28e1bf)=>_0x28e1bf['date']['localeCompare'](_0x4a4590[_0x3f7aa5(0x1af)]));return{'totalFiles':_0x3bd803[_0x3f7aa5(0x1e7)],'logTypes':_0x48d0a2,'latestLogs':_0x1b8965[_0x3f7aa5(0x1e6)](0x0,0xa)};}catch(_0x30dba5){return console[_0x3f7aa5(0x1bc)](_0x3f7aa5(0x1a7),_0x30dba5),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0xf45137(0x1d0)](_0xc9fee0=0x1e){const _0x2b889f=a48_0xf45137;try{const _0x490635=fs_1[_0x2b889f(0x1a5)][_0x2b889f(0x1dd)](this[_0x2b889f(0x1ae)]),_0xcbb9f5=new Date();_0xcbb9f5[_0x2b889f(0x1a9)](_0xcbb9f5['getDate']()-_0xc9fee0);let _0x26c888=0x0;_0x490635[_0x2b889f(0x1d4)](_0x50ef02=>{const _0x39dfc1=_0x2b889f;if(!_0x50ef02[_0x39dfc1(0x1c4)](_0x39dfc1(0x1ce)))return;const _0x367538=path_1['default'][_0x39dfc1(0x19c)](this['logsDir'],_0x50ef02),_0x5e3382=fs_1['default']['statSync'](_0x367538);_0x5e3382[_0x39dfc1(0x1b0)]<_0xcbb9f5&&(fs_1[_0x39dfc1(0x1a5)][_0x39dfc1(0x1b1)](_0x367538),_0x26c888++,console[_0x39dfc1(0x19d)](_0x39dfc1(0x1a8)+_0x50ef02));}),console['log'](_0x2b889f(0x1e1)+_0x26c888+_0x2b889f(0x1e2)+_0xc9fee0+_0x2b889f(0x1c0));}catch(_0x3d59df){console[_0x2b889f(0x1bc)](_0x2b889f(0x1d6),_0x3d59df);}}}exports[a48_0xf45137(0x1d5)]=LoggerService,exports['loggerService']=new LoggerService();