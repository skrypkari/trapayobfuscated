'use strict';const a55_0x4d7c58=a55_0x2557;(function(_0x541449,_0x162f97){const _0x187d19=a55_0x2557,_0x53ecd3=_0x541449();while(!![]){try{const _0x492b65=-parseInt(_0x187d19(0x107))/0x1*(parseInt(_0x187d19(0xe6))/0x2)+-parseInt(_0x187d19(0x100))/0x3+parseInt(_0x187d19(0xf4))/0x4+parseInt(_0x187d19(0xd2))/0x5*(-parseInt(_0x187d19(0xfc))/0x6)+parseInt(_0x187d19(0xd7))/0x7*(-parseInt(_0x187d19(0xf3))/0x8)+-parseInt(_0x187d19(0x102))/0x9+parseInt(_0x187d19(0xe1))/0xa;if(_0x492b65===_0x162f97)break;else _0x53ecd3['push'](_0x53ecd3['shift']());}catch(_0x4665d7){_0x53ecd3['push'](_0x53ecd3['shift']());}}}(a55_0xd883,0xb0f10));var __importDefault=this&&this[a55_0x4d7c58(0xf0)]||function(_0x3206f8){return _0x3206f8&&_0x3206f8['__esModule']?_0x3206f8:{'default':_0x3206f8};};Object[a55_0x4d7c58(0xde)](exports,a55_0x4d7c58(0xf6),{'value':!![]}),exports['loggerService']=exports[a55_0x4d7c58(0x11a)]=void 0x0;function a55_0x2557(_0x4bb896,_0x124827){const _0xd88339=a55_0xd883();return a55_0x2557=function(_0x255736,_0x3da592){_0x255736=_0x255736-0xce;let _0xf77351=_0xd88339[_0x255736];return _0xf77351;},a55_0x2557(_0x4bb896,_0x124827);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a55_0x4d7c58(0xe4)));class LoggerService{constructor(){const _0x299ff1=a55_0x4d7c58;this[_0x299ff1(0x111)]=path_1['default']['join'](process[_0x299ff1(0xfa)](),_0x299ff1(0x103)),this[_0x299ff1(0x101)]();}[a55_0x4d7c58(0x101)](){const _0x5c8905=a55_0x4d7c58;!fs_1[_0x5c8905(0xfb)][_0x5c8905(0xf2)](this[_0x5c8905(0x111)])&&(fs_1[_0x5c8905(0xfb)][_0x5c8905(0x118)](this[_0x5c8905(0x111)],{'recursive':!![]}),console[_0x5c8905(0xf9)](_0x5c8905(0x10e)+this['logsDir']));}['getLogFileName'](_0x21411c){const _0x3d4815=a55_0x4d7c58,_0x4e87a1=new Date()[_0x3d4815(0xff)]()[_0x3d4815(0xea)]('T')[0x0];return path_1['default'][_0x3d4815(0xeb)](this['logsDir'],_0x21411c+'_'+_0x4e87a1+_0x3d4815(0x120));}['writeLog'](_0x30a081,_0x5e612d){const _0x4d953c=a55_0x4d7c58;try{const _0x5c82e4=new Date()[_0x4d953c(0xff)](),_0x3315d5={'timestamp':_0x5c82e4,..._0x5e612d},_0x50c9cb=JSON[_0x4d953c(0xe0)](_0x3315d5)+'\x0a',_0x18f191=this[_0x4d953c(0xd9)](_0x30a081);fs_1[_0x4d953c(0xfb)]['appendFileSync'](_0x18f191,_0x50c9cb,_0x4d953c(0xd5));}catch(_0x17d54){console[_0x4d953c(0xd8)](_0x4d953c(0xef)+_0x30a081+_0x4d953c(0x115),_0x17d54);}}[a55_0x4d7c58(0xec)](_0x351286,_0x43932b,_0x41799c,_0x1d861b){const _0x2d3be1=a55_0x4d7c58;this[_0x2d3be1(0xce)](_0x2d3be1(0xf7),{'type':_0x2d3be1(0x104),'gateway':_0x351286,'endpoint':_0x43932b,'method':_0x41799c,'data':_0x1d861b});}['logWhiteDomainResponse'](_0x456fec,_0x3a62e4,_0x5c3da8,_0x4dbb65,_0x47fcef){const _0x45a69a=a55_0x4d7c58;this[_0x45a69a(0xce)](_0x45a69a(0xe7),{'type':_0x45a69a(0xd3),'gateway':_0x456fec,'endpoint':_0x3a62e4,'status':_0x5c3da8,'responseTime':_0x47fcef,'data':_0x4dbb65});}[a55_0x4d7c58(0xee)](_0x1f64e1,_0x179286,_0x2ecc62){const _0x3eff96=a55_0x4d7c58;this[_0x3eff96(0xce)]('white_domain_errors',{'type':_0x3eff96(0x113),'gateway':_0x1f64e1,'endpoint':_0x179286,'error':_0x2ecc62 instanceof Error?{'message':_0x2ecc62[_0x3eff96(0xdf)],'stack':_0x2ecc62[_0x3eff96(0x105)]}:_0x2ecc62});}['logWebhookReceived'](_0xcf51d4,_0x477526,_0x495b1a){const _0x1780bb=a55_0x4d7c58;this[_0x1780bb(0xce)](_0x1780bb(0x108),{'type':_0x1780bb(0x10d),'gateway':_0xcf51d4,'headers':_0x495b1a,'data':_0x477526});}[a55_0x4d7c58(0xe8)](_0x4e27f4,_0x568a87,_0x42d1f6,_0x216585,_0x1d7005){const _0x32f63f=a55_0x4d7c58;this['writeLog'](_0x32f63f(0xdc),{'type':'WEBHOOK_PROCESSED','gateway':_0x4e27f4,'paymentId':_0x568a87,'oldStatus':_0x42d1f6,'newStatus':_0x216585,'originalData':_0x1d7005});}[a55_0x4d7c58(0x11c)](_0x14119e,_0x22bf6a,_0x310136){const _0x1060b9=a55_0x4d7c58;this[_0x1060b9(0xce)](_0x1060b9(0x109),{'type':_0x1060b9(0xe5),'gateway':_0x14119e,'error':_0x22bf6a instanceof Error?{'message':_0x22bf6a[_0x1060b9(0xdf)],'stack':_0x22bf6a[_0x1060b9(0x105)]}:_0x22bf6a,'originalData':_0x310136});}['logCoinToPayStatus'](_0x6e39bf){const _0x2f90b0=a55_0x4d7c58;this[_0x2f90b0(0xce)](_0x2f90b0(0xfd),{'type':_0x2f90b0(0xd4),..._0x6e39bf});}[a55_0x4d7c58(0x10f)](_0x5cf7cc){const _0x29acf4=a55_0x4d7c58;this['writeLog'](_0x29acf4(0x110),{'type':_0x29acf4(0xf1),..._0x5cf7cc});}[a55_0x4d7c58(0x117)](_0xe0e3ec,_0x514e96,_0x244d83,_0x45e06b,_0x130914,_0x12d154){const _0x4dd523=a55_0x4d7c58;this[_0x4dd523(0xce)](_0x4dd523(0x10c),{'type':'SHOP_WEBHOOK_SENT','shopId':_0xe0e3ec,'webhookUrl':_0x514e96,'event':_0x244d83,'status':_0x45e06b,'responseTime':_0x130914,'payload':_0x12d154});}[a55_0x4d7c58(0xed)](_0x328ae4,_0xf9a2b5,_0x57e813,_0x15843f,_0xd40b4c){const _0x16b1f8=a55_0x4d7c58;this[_0x16b1f8(0xce)](_0x16b1f8(0xdd),{'type':_0x16b1f8(0xd1),'shopId':_0x328ae4,'webhookUrl':_0xf9a2b5,'event':_0x57e813,'error':_0x15843f instanceof Error?{'message':_0x15843f[_0x16b1f8(0xdf)],'stack':_0x15843f[_0x16b1f8(0x105)]}:_0x15843f,'payload':_0xd40b4c});}[a55_0x4d7c58(0x112)](_0x1006d0,_0x45b593,_0x5ee772,_0x2520c6,_0x3e3925){const _0x5386d4=a55_0x4d7c58;this[_0x5386d4(0xce)](_0x5386d4(0xf5),{'type':_0x5386d4(0x119),'gateway':_0x1006d0,'paymentId':_0x45b593,'shopId':_0x5ee772,'amount':_0x2520c6,'currency':_0x3e3925});}['logApiCall'](_0x5f2a06,_0x531d64,_0x3aa403,_0x49a3b8,_0x437e43){const _0xf2251c=a55_0x4d7c58;this[_0xf2251c(0xce)](_0xf2251c(0xe9),{'type':'API_CALL','endpoint':_0x5f2a06,'method':_0x531d64,'userId':_0x3aa403,'userRole':_0x49a3b8,'requestData':_0x437e43});}[a55_0x4d7c58(0x114)](){const _0x2b16b6=a55_0x4d7c58;try{const _0x54108d=fs_1[_0x2b16b6(0xfb)][_0x2b16b6(0x11e)](this[_0x2b16b6(0x111)]),_0x51fb1d=_0x54108d[_0x2b16b6(0x116)](_0x38f582=>_0x38f582[_0x2b16b6(0x10a)](_0x2b16b6(0x120))),_0x2abf10=[...new Set(_0x51fb1d['map'](_0x21bd51=>_0x21bd51[_0x2b16b6(0xea)]('_')[0x0]))],_0x10ec15=_0x51fb1d[_0x2b16b6(0xd0)](_0x5a16e0=>{const _0x64ce17=_0x2b16b6,_0x78b935=path_1[_0x64ce17(0xfb)]['join'](this['logsDir'],_0x5a16e0),_0x2619cb=fs_1[_0x64ce17(0xfb)][_0x64ce17(0xd6)](_0x78b935),[_0x34f735,_0x119685]=_0x5a16e0[_0x64ce17(0xe2)]('.log','')[_0x64ce17(0xea)]('_');return{'type':_0x34f735,'date':_0x119685,'size':_0x2619cb[_0x64ce17(0xe3)]};})[_0x2b16b6(0x11f)]((_0x1fa631,_0x2a1121)=>_0x2a1121[_0x2b16b6(0x121)]['localeCompare'](_0x1fa631['date']));return{'totalFiles':_0x51fb1d[_0x2b16b6(0xcf)],'logTypes':_0x2abf10,'latestLogs':_0x10ec15[_0x2b16b6(0xda)](0x0,0xa)};}catch(_0x24dbf5){return console[_0x2b16b6(0xd8)]('Failed\x20to\x20get\x20log\x20stats:',_0x24dbf5),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x2d79bd=0x1e){const _0x35f12f=a55_0x4d7c58;try{const _0x150312=fs_1[_0x35f12f(0xfb)][_0x35f12f(0x11e)](this[_0x35f12f(0x111)]),_0x43cc62=new Date();_0x43cc62['setDate'](_0x43cc62[_0x35f12f(0x11b)]()-_0x2d79bd);let _0x37e924=0x0;_0x150312['forEach'](_0x113d4f=>{const _0x2857ad=_0x35f12f;if(!_0x113d4f[_0x2857ad(0x10a)](_0x2857ad(0x120)))return;const _0x4f064d=path_1[_0x2857ad(0xfb)]['join'](this[_0x2857ad(0x111)],_0x113d4f),_0x20dc01=fs_1[_0x2857ad(0xfb)]['statSync'](_0x4f064d);_0x20dc01[_0x2857ad(0xf8)]<_0x43cc62&&(fs_1[_0x2857ad(0xfb)][_0x2857ad(0x106)](_0x4f064d),_0x37e924++,console[_0x2857ad(0xf9)](_0x2857ad(0xfe)+_0x113d4f));}),console['log'](_0x35f12f(0x11d)+_0x37e924+_0x35f12f(0xdb)+_0x2d79bd+_0x35f12f(0x10b));}catch(_0x34988f){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x34988f);}}}exports['LoggerService']=LoggerService,exports[a55_0x4d7c58(0x122)]=new LoggerService();function a55_0xd883(){const _0x3b75e1=['🗑️\x20Deleted\x20old\x20log\x20file:\x20','toISOString','1028139itduTC','ensureLogsDirectory','746082fHmXJA','logs','REQUEST','stack','unlinkSync','21327BvzBUH','webhooks_received','webhooks_errors','endsWith','\x20days)','shop_webhooks_sent','WEBHOOK_RECEIVED','📁\x20Created\x20logs\x20directory:\x20','logCoinToPayError','cointopay_errors','logsDir','logPaymentCreated','ERROR','getLogStats','\x20log:','filter','logShopWebhookSent','mkdirSync','PAYMENT_CREATED','LoggerService','getDate','logWebhookError','🧹\x20Cleaned\x20','readdirSync','sort','.log','date','loggerService','writeLog','length','map','SHOP_WEBHOOK_ERROR','23855lyNeQF','RESPONSE','COINTOPAY_STATUS_CHANGE','utf8','statSync','161cPyCvG','error','getLogFileName','slice','\x20old\x20log\x20files\x20(older\x20than\x20','webhooks_processed','shop_webhooks_errors','defineProperty','message','stringify','28520570YIzvfB','replace','size','path','WEBHOOK_ERROR','86ZfJrpS','white_domain_responses','logWebhookProcessed','api_calls','split','join','logWhiteDomainRequest','logShopWebhookError','logWhiteDomainError','Failed\x20to\x20write\x20','__importDefault','COINTOPAY_ERROR','existsSync','54344QWUfbY','2162004pKqOit','payments_created','__esModule','white_domain_requests','mtime','log','cwd','default','1470jkInfp','cointopay_status_changes'];a55_0xd883=function(){return _0x3b75e1;};return a55_0xd883();}