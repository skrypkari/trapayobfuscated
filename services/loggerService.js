'use strict';const a59_0x533a3e=a59_0x2dcc;(function(_0x4bbbb5,_0x3808ca){const _0x59697=a59_0x2dcc,_0x1bffcb=_0x4bbbb5();while(!![]){try{const _0x1f85e6=-parseInt(_0x59697(0x1da))/0x1*(-parseInt(_0x59697(0x1d1))/0x2)+parseInt(_0x59697(0x1e3))/0x3*(parseInt(_0x59697(0x1f1))/0x4)+parseInt(_0x59697(0x1f6))/0x5*(parseInt(_0x59697(0x1d2))/0x6)+-parseInt(_0x59697(0x219))/0x7*(-parseInt(_0x59697(0x217))/0x8)+parseInt(_0x59697(0x206))/0x9*(-parseInt(_0x59697(0x1fc))/0xa)+-parseInt(_0x59697(0x20c))/0xb+-parseInt(_0x59697(0x1dd))/0xc*(parseInt(_0x59697(0x1e9))/0xd);if(_0x1f85e6===_0x3808ca)break;else _0x1bffcb['push'](_0x1bffcb['shift']());}catch(_0x55aacc){_0x1bffcb['push'](_0x1bffcb['shift']());}}}(a59_0x3e44,0x6b3ba));var __importDefault=this&&this[a59_0x533a3e(0x212)]||function(_0x5cfa02){const _0xcf563a=a59_0x533a3e;return _0x5cfa02&&_0x5cfa02[_0xcf563a(0x1f5)]?_0x5cfa02:{'default':_0x5cfa02};};Object[a59_0x533a3e(0x221)](exports,a59_0x533a3e(0x1f5),{'value':!![]}),exports[a59_0x533a3e(0x21c)]=exports[a59_0x533a3e(0x1fb)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x533a3e(0x1eb)));class LoggerService{constructor(){const _0xbf98ed=a59_0x533a3e;this[_0xbf98ed(0x1e8)]=path_1[_0xbf98ed(0x20d)][_0xbf98ed(0x218)](process['cwd'](),_0xbf98ed(0x202)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x1027d=a59_0x533a3e;!fs_1['default'][_0x1027d(0x216)](this['logsDir'])&&(fs_1[_0x1027d(0x20d)][_0x1027d(0x1e4)](this[_0x1027d(0x1e8)],{'recursive':!![]}),console[_0x1027d(0x1ec)]('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}['getLogFileName'](_0xf97c03){const _0x1a0429=a59_0x533a3e,_0x1804b4=new Date()['toISOString']()['split']('T')[0x0];return path_1['default'][_0x1a0429(0x218)](this[_0x1a0429(0x1e8)],_0xf97c03+'_'+_0x1804b4+_0x1a0429(0x1fe));}['writeLog'](_0x5cec1f,_0x32d16d){const _0xcc9682=a59_0x533a3e;try{const _0x564a98=new Date()[_0xcc9682(0x1f7)](),_0x3edf14={'timestamp':_0x564a98,..._0x32d16d},_0x45f78c=JSON[_0xcc9682(0x1e1)](_0x3edf14)+'\x0a',_0x34f701=this['getLogFileName'](_0x5cec1f);fs_1['default'][_0xcc9682(0x1d3)](_0x34f701,_0x45f78c,'utf8');}catch(_0x9044ea){console[_0xcc9682(0x1dc)](_0xcc9682(0x1f8)+_0x5cec1f+_0xcc9682(0x210),_0x9044ea);}}[a59_0x533a3e(0x215)](_0x42437d,_0x43da42,_0x473dba,_0x331ee6){const _0x3c1284=a59_0x533a3e;this[_0x3c1284(0x1f2)](_0x3c1284(0x208),{'type':_0x3c1284(0x205),'gateway':_0x42437d,'endpoint':_0x43da42,'method':_0x473dba,'data':_0x331ee6});}[a59_0x533a3e(0x1e0)](_0x5aeffb,_0x44ce01,_0x36a0d3,_0x7ed766,_0x39fec9){const _0x5b32d9=a59_0x533a3e;this[_0x5b32d9(0x1f2)](_0x5b32d9(0x21a),{'type':_0x5b32d9(0x1f9),'gateway':_0x5aeffb,'endpoint':_0x44ce01,'status':_0x36a0d3,'responseTime':_0x39fec9,'data':_0x7ed766});}[a59_0x533a3e(0x1ed)](_0x4212bf,_0x1edb43,_0x5a778f){const _0x45d393=a59_0x533a3e;this[_0x45d393(0x1f2)](_0x45d393(0x207),{'type':'ERROR','gateway':_0x4212bf,'endpoint':_0x1edb43,'error':_0x5a778f instanceof Error?{'message':_0x5a778f[_0x45d393(0x214)],'stack':_0x5a778f[_0x45d393(0x21f)]}:_0x5a778f});}['logWebhookReceived'](_0x58fd47,_0xc181c3,_0x195d3b){const _0x346891=a59_0x533a3e;this[_0x346891(0x1f2)](_0x346891(0x1d7),{'type':_0x346891(0x1e6),'gateway':_0x58fd47,'headers':_0x195d3b,'data':_0xc181c3});}['logWebhookProcessed'](_0x340357,_0x22f359,_0x36f66d,_0x1c252c,_0x53e4a1){const _0x204880=a59_0x533a3e;this[_0x204880(0x1f2)](_0x204880(0x220),{'type':_0x204880(0x1d5),'gateway':_0x340357,'paymentId':_0x22f359,'oldStatus':_0x36f66d,'newStatus':_0x1c252c,'originalData':_0x53e4a1});}[a59_0x533a3e(0x21d)](_0x2ca2b8,_0x3afac0,_0x363833){const _0x483502=a59_0x533a3e;this[_0x483502(0x1f2)]('webhooks_errors',{'type':_0x483502(0x1e5),'gateway':_0x2ca2b8,'error':_0x3afac0 instanceof Error?{'message':_0x3afac0[_0x483502(0x214)],'stack':_0x3afac0[_0x483502(0x21f)]}:_0x3afac0,'originalData':_0x363833});}[a59_0x533a3e(0x1f3)](_0x42d3c8){const _0x4fe843=a59_0x533a3e;this[_0x4fe843(0x1f2)](_0x4fe843(0x21b),{'type':'COINTOPAY_STATUS_CHANGE',..._0x42d3c8});}[a59_0x533a3e(0x1d6)](_0x262e70){const _0x558695=a59_0x533a3e;this['writeLog'](_0x558695(0x201),{'type':_0x558695(0x1d8),..._0x262e70});}[a59_0x533a3e(0x1ef)](_0xc7d182,_0x1d5fe3,_0x102362,_0x3b4b14,_0x44557e,_0xf20531){const _0x2ed097=a59_0x533a3e;this[_0x2ed097(0x1f2)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0xc7d182,'webhookUrl':_0x1d5fe3,'event':_0x102362,'status':_0x3b4b14,'responseTime':_0x44557e,'payload':_0xf20531});}[a59_0x533a3e(0x1fd)](_0x2af25c,_0x4ee3b0,_0x4a908a,_0x4e0179,_0x573111){const _0x12fcbc=a59_0x533a3e;this[_0x12fcbc(0x1f2)](_0x12fcbc(0x1d0),{'type':_0x12fcbc(0x1cf),'shopId':_0x2af25c,'webhookUrl':_0x4ee3b0,'event':_0x4a908a,'error':_0x4e0179 instanceof Error?{'message':_0x4e0179[_0x12fcbc(0x214)],'stack':_0x4e0179[_0x12fcbc(0x21f)]}:_0x4e0179,'payload':_0x573111});}[a59_0x533a3e(0x1ee)](_0x58102d,_0x3ef414,_0x4aba25,_0x5c1e03,_0x242acc){const _0x269066=a59_0x533a3e;this['writeLog'](_0x269066(0x1f0),{'type':_0x269066(0x21e),'gateway':_0x58102d,'paymentId':_0x3ef414,'shopId':_0x4aba25,'amount':_0x5c1e03,'currency':_0x242acc});}['logApiCall'](_0xc17137,_0x1e171f,_0x41e8f3,_0x440859,_0x42a292){const _0x5762fa=a59_0x533a3e;this[_0x5762fa(0x1f2)]('api_calls',{'type':_0x5762fa(0x1f4),'endpoint':_0xc17137,'method':_0x1e171f,'userId':_0x41e8f3,'userRole':_0x440859,'requestData':_0x42a292});}[a59_0x533a3e(0x1ff)](){const _0x68c33=a59_0x533a3e;try{const _0x12055c=fs_1['default'][_0x68c33(0x1e7)](this[_0x68c33(0x1e8)]),_0x3e74b1=_0x12055c['filter'](_0x56a0d5=>_0x56a0d5[_0x68c33(0x20e)](_0x68c33(0x1fe))),_0x431018=[...new Set(_0x3e74b1[_0x68c33(0x213)](_0x362251=>_0x362251[_0x68c33(0x1df)]('_')[0x0]))],_0x8a31e5=_0x3e74b1[_0x68c33(0x213)](_0x110286=>{const _0x2ee1d6=_0x68c33,_0x254528=path_1[_0x2ee1d6(0x20d)][_0x2ee1d6(0x218)](this[_0x2ee1d6(0x1e8)],_0x110286),_0x41e435=fs_1[_0x2ee1d6(0x20d)][_0x2ee1d6(0x1de)](_0x254528),[_0x23f9f3,_0x342144]=_0x110286[_0x2ee1d6(0x1d9)](_0x2ee1d6(0x1fe),'')[_0x2ee1d6(0x1df)]('_');return{'type':_0x23f9f3,'date':_0x342144,'size':_0x41e435[_0x2ee1d6(0x209)]};})[_0x68c33(0x20f)]((_0x2f6c3e,_0x46838b)=>_0x46838b[_0x68c33(0x204)][_0x68c33(0x222)](_0x2f6c3e['date']));return{'totalFiles':_0x3e74b1[_0x68c33(0x20a)],'logTypes':_0x431018,'latestLogs':_0x8a31e5[_0x68c33(0x1ea)](0x0,0xa)};}catch(_0x3ba9be){return console['error'](_0x68c33(0x1db),_0x3ba9be),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x549215=0x1e){const _0x1963a2=a59_0x533a3e;try{const _0x10f0fc=fs_1[_0x1963a2(0x20d)][_0x1963a2(0x1e7)](this[_0x1963a2(0x1e8)]),_0x38630d=new Date();_0x38630d['setDate'](_0x38630d[_0x1963a2(0x1e2)]()-_0x549215);let _0x2ff607=0x0;_0x10f0fc['forEach'](_0x316c3d=>{const _0x2f20e7=_0x1963a2;if(!_0x316c3d[_0x2f20e7(0x20e)]('.log'))return;const _0x5356bb=path_1[_0x2f20e7(0x20d)][_0x2f20e7(0x218)](this[_0x2f20e7(0x1e8)],_0x316c3d),_0x9f7648=fs_1['default']['statSync'](_0x5356bb);_0x9f7648['mtime']<_0x38630d&&(fs_1[_0x2f20e7(0x20d)][_0x2f20e7(0x1fa)](_0x5356bb),_0x2ff607++,console[_0x2f20e7(0x1ec)](_0x2f20e7(0x211)+_0x316c3d));}),console[_0x1963a2(0x1ec)](_0x1963a2(0x20b)+_0x2ff607+_0x1963a2(0x203)+_0x549215+_0x1963a2(0x1d4));}catch(_0x10d2a9){console[_0x1963a2(0x1dc)](_0x1963a2(0x200),_0x10d2a9);}}}function a59_0x3e44(){const _0x7ae339=['9rWGFTP','white_domain_errors','white_domain_requests','size','length','🧹\x20Cleaned\x20','6564041MjTuGR','default','endsWith','sort','\x20log:','🗑️\x20Deleted\x20old\x20log\x20file:\x20','__importDefault','map','message','logWhiteDomainRequest','existsSync','246872USQjxU','join','28aNhOTy','white_domain_responses','cointopay_status_changes','loggerService','logWebhookError','PAYMENT_CREATED','stack','webhooks_processed','defineProperty','localeCompare','SHOP_WEBHOOK_ERROR','shop_webhooks_errors','230WuYyVM','30DAzQxE','appendFileSync','\x20days)','WEBHOOK_PROCESSED','logCoinToPayError','webhooks_received','COINTOPAY_ERROR','replace','497QyMkXM','Failed\x20to\x20get\x20log\x20stats:','error','108SgUylh','statSync','split','logWhiteDomainResponse','stringify','getDate','68727bjvcnN','mkdirSync','WEBHOOK_ERROR','WEBHOOK_RECEIVED','readdirSync','logsDir','966758FVwEsg','slice','path','log','logWhiteDomainError','logPaymentCreated','logShopWebhookSent','payments_created','124ERTfCq','writeLog','logCoinToPayStatus','API_CALL','__esModule','849985oSSCLo','toISOString','Failed\x20to\x20write\x20','RESPONSE','unlinkSync','LoggerService','355040buXjVt','logShopWebhookError','.log','getLogStats','Failed\x20to\x20clean\x20old\x20logs:','cointopay_errors','logs','\x20old\x20log\x20files\x20(older\x20than\x20','date','REQUEST'];a59_0x3e44=function(){return _0x7ae339;};return a59_0x3e44();}function a59_0x2dcc(_0x169ec6,_0x13324c){const _0x3e44e5=a59_0x3e44();return a59_0x2dcc=function(_0x2dccd4,_0x27be6a){_0x2dccd4=_0x2dccd4-0x1cf;let _0x401dd9=_0x3e44e5[_0x2dccd4];return _0x401dd9;},a59_0x2dcc(_0x169ec6,_0x13324c);}exports[a59_0x533a3e(0x1fb)]=LoggerService,exports['loggerService']=new LoggerService();