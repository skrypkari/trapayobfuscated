'use strict';const a48_0x56eeb3=a48_0x3402;(function(_0xe853d1,_0x5a0f7e){const _0x359b87=a48_0x3402,_0xd0006b=_0xe853d1();while(!![]){try{const _0x137e88=parseInt(_0x359b87(0xe4))/0x1*(parseInt(_0x359b87(0xf3))/0x2)+-parseInt(_0x359b87(0x116))/0x3*(parseInt(_0x359b87(0x11f))/0x4)+parseInt(_0x359b87(0xf0))/0x5+parseInt(_0x359b87(0x12f))/0x6*(-parseInt(_0x359b87(0x131))/0x7)+-parseInt(_0x359b87(0x105))/0x8+-parseInt(_0x359b87(0x109))/0x9+parseInt(_0x359b87(0x101))/0xa;if(_0x137e88===_0x5a0f7e)break;else _0xd0006b['push'](_0xd0006b['shift']());}catch(_0x4e3763){_0xd0006b['push'](_0xd0006b['shift']());}}}(a48_0x45bf,0xc5552));function a48_0x45bf(){const _0x4afa55=['webhooks_processed','\x20old\x20log\x20files\x20(older\x20than\x20','logApiCall','11490300pXUXbN','webhooks_errors','logCoinToPayError','\x20log:','readdirSync','REQUEST','message','RESPONSE','shop_webhooks_sent','mtime','defineProperty','__importDefault','stringify','1006089xoKCgK','payments_created','WEBHOOK_PROCESSED','forEach','size','logShopWebhookError','SHOP_WEBHOOK_SENT','join','path','12pDOqKx','map','white_domain_responses','logsDir','getLogStats','default','COINTOPAY_ERROR','.log','length','endsWith','appendFileSync','date','PAYMENT_CREATED','writeLog','\x20days)','logWhiteDomainError','304302SHOfCx','log','175ChQpxn','filter','LoggerService','unlinkSync','setDate','white_domain_errors','localeCompare','ensureLogsDirectory','replace','getDate','logs','loggerService','28361rhyfMl','toISOString','API_CALL','COINTOPAY_STATUS_CHANGE','existsSync','SHOP_WEBHOOK_ERROR','WEBHOOK_RECEIVED','error','logCoinToPayStatus','cointopay_errors','logWhiteDomainRequest','logPaymentCreated','3547365xUkbEf','webhooks_received','Failed\x20to\x20clean\x20old\x20logs:','22JdUDcQ','Failed\x20to\x20write\x20','logWebhookError','stack','🧹\x20Cleaned\x20','logWebhookProcessed','statSync','split','logWhiteDomainResponse','api_calls','__esModule','mkdirSync','WEBHOOK_ERROR','shop_webhooks_errors','48284500qjUdsN','white_domain_requests','cwd','logWebhookReceived','11927248RRtldR'];a48_0x45bf=function(){return _0x4afa55;};return a48_0x45bf();}var __importDefault=this&&this[a48_0x56eeb3(0x114)]||function(_0x1a9785){const _0x25530e=a48_0x56eeb3;return _0x1a9785&&_0x1a9785[_0x25530e(0xfd)]?_0x1a9785:{'default':_0x1a9785};};Object[a48_0x56eeb3(0x113)](exports,'__esModule',{'value':!![]}),exports[a48_0x56eeb3(0xe3)]=exports[a48_0x56eeb3(0x133)]=void 0x0;function a48_0x3402(_0x16633f,_0x8335f){const _0x45bfd1=a48_0x45bf();return a48_0x3402=function(_0x3402ad,_0x5c95ce){_0x3402ad=_0x3402ad-0xdb;let _0x41e0f2=_0x45bfd1[_0x3402ad];return _0x41e0f2;},a48_0x3402(_0x16633f,_0x8335f);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x56eeb3(0x11e)));class LoggerService{constructor(){const _0x431c52=a48_0x56eeb3;this[_0x431c52(0x122)]=path_1[_0x431c52(0x124)][_0x431c52(0x11d)](process[_0x431c52(0x103)](),_0x431c52(0xe2)),this[_0x431c52(0xdf)]();}[a48_0x56eeb3(0xdf)](){const _0x21694e=a48_0x56eeb3;!fs_1[_0x21694e(0x124)][_0x21694e(0xe8)](this['logsDir'])&&(fs_1[_0x21694e(0x124)][_0x21694e(0xfe)](this[_0x21694e(0x122)],{'recursive':!![]}),console[_0x21694e(0x130)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x21694e(0x122)]));}['getLogFileName'](_0x35b45d){const _0x4e538b=a48_0x56eeb3,_0x5dd9ad=new Date()['toISOString']()[_0x4e538b(0xfa)]('T')[0x0];return path_1['default'][_0x4e538b(0x11d)](this[_0x4e538b(0x122)],_0x35b45d+'_'+_0x5dd9ad+_0x4e538b(0x126));}[a48_0x56eeb3(0x12c)](_0x100b36,_0x4a8e09){const _0x3eb22f=a48_0x56eeb3;try{const _0x53c542=new Date()[_0x3eb22f(0xe5)](),_0x3335ff={'timestamp':_0x53c542,..._0x4a8e09},_0x4d1788=JSON[_0x3eb22f(0x115)](_0x3335ff)+'\x0a',_0x8f0a4c=this['getLogFileName'](_0x100b36);fs_1['default'][_0x3eb22f(0x129)](_0x8f0a4c,_0x4d1788,'utf8');}catch(_0x38dfc9){console[_0x3eb22f(0xeb)](_0x3eb22f(0xf4)+_0x100b36+_0x3eb22f(0x10c),_0x38dfc9);}}[a48_0x56eeb3(0xee)](_0x284c8a,_0x302407,_0x5de088,_0xcd961){const _0x5904a2=a48_0x56eeb3;this[_0x5904a2(0x12c)](_0x5904a2(0x102),{'type':_0x5904a2(0x10e),'gateway':_0x284c8a,'endpoint':_0x302407,'method':_0x5de088,'data':_0xcd961});}[a48_0x56eeb3(0xfb)](_0x5afcdd,_0x27b4ee,_0x3e153d,_0x336af3,_0x3711ae){const _0x4c49e0=a48_0x56eeb3;this['writeLog'](_0x4c49e0(0x121),{'type':_0x4c49e0(0x110),'gateway':_0x5afcdd,'endpoint':_0x27b4ee,'status':_0x3e153d,'responseTime':_0x3711ae,'data':_0x336af3});}[a48_0x56eeb3(0x12e)](_0x3cf89f,_0x4eb486,_0x2841f8){const _0x475d26=a48_0x56eeb3;this[_0x475d26(0x12c)](_0x475d26(0xdd),{'type':'ERROR','gateway':_0x3cf89f,'endpoint':_0x4eb486,'error':_0x2841f8 instanceof Error?{'message':_0x2841f8[_0x475d26(0x10f)],'stack':_0x2841f8['stack']}:_0x2841f8});}[a48_0x56eeb3(0x104)](_0x586c0d,_0xf7aac1,_0x2e1eaf){const _0xa5839b=a48_0x56eeb3;this[_0xa5839b(0x12c)](_0xa5839b(0xf1),{'type':_0xa5839b(0xea),'gateway':_0x586c0d,'headers':_0x2e1eaf,'data':_0xf7aac1});}[a48_0x56eeb3(0xf8)](_0x7a970b,_0x1c0252,_0x3723a9,_0x1ac1eb,_0x3efeb5){const _0x279558=a48_0x56eeb3;this[_0x279558(0x12c)](_0x279558(0x106),{'type':_0x279558(0x118),'gateway':_0x7a970b,'paymentId':_0x1c0252,'oldStatus':_0x3723a9,'newStatus':_0x1ac1eb,'originalData':_0x3efeb5});}[a48_0x56eeb3(0xf5)](_0x3d4b45,_0x56c592,_0x3815bd){const _0x222fb7=a48_0x56eeb3;this[_0x222fb7(0x12c)](_0x222fb7(0x10a),{'type':_0x222fb7(0xff),'gateway':_0x3d4b45,'error':_0x56c592 instanceof Error?{'message':_0x56c592[_0x222fb7(0x10f)],'stack':_0x56c592[_0x222fb7(0xf6)]}:_0x56c592,'originalData':_0x3815bd});}[a48_0x56eeb3(0xec)](_0x4ad366){const _0xb3c4ed=a48_0x56eeb3;this['writeLog']('cointopay_status_changes',{'type':_0xb3c4ed(0xe7),..._0x4ad366});}[a48_0x56eeb3(0x10b)](_0x38f91e){const _0x3d8832=a48_0x56eeb3;this[_0x3d8832(0x12c)](_0x3d8832(0xed),{'type':_0x3d8832(0x125),..._0x38f91e});}['logShopWebhookSent'](_0x496c69,_0x4e1791,_0x3d516f,_0x3036ea,_0x3f9a67,_0x28fd6e){const _0x3a2107=a48_0x56eeb3;this[_0x3a2107(0x12c)](_0x3a2107(0x111),{'type':_0x3a2107(0x11c),'shopId':_0x496c69,'webhookUrl':_0x4e1791,'event':_0x3d516f,'status':_0x3036ea,'responseTime':_0x3f9a67,'payload':_0x28fd6e});}[a48_0x56eeb3(0x11b)](_0x1c9a66,_0x3a364d,_0x492724,_0x34562a,_0x28c73c){const _0x505a85=a48_0x56eeb3;this[_0x505a85(0x12c)](_0x505a85(0x100),{'type':_0x505a85(0xe9),'shopId':_0x1c9a66,'webhookUrl':_0x3a364d,'event':_0x492724,'error':_0x34562a instanceof Error?{'message':_0x34562a[_0x505a85(0x10f)],'stack':_0x34562a[_0x505a85(0xf6)]}:_0x34562a,'payload':_0x28c73c});}[a48_0x56eeb3(0xef)](_0x5e184b,_0x432314,_0x3ee043,_0x259513,_0x56ceb8){const _0x5b00e4=a48_0x56eeb3;this[_0x5b00e4(0x12c)](_0x5b00e4(0x117),{'type':_0x5b00e4(0x12b),'gateway':_0x5e184b,'paymentId':_0x432314,'shopId':_0x3ee043,'amount':_0x259513,'currency':_0x56ceb8});}[a48_0x56eeb3(0x108)](_0x57256f,_0x23b985,_0x36e076,_0x33253d,_0x224324){const _0x5ead88=a48_0x56eeb3;this['writeLog'](_0x5ead88(0xfc),{'type':_0x5ead88(0xe6),'endpoint':_0x57256f,'method':_0x23b985,'userId':_0x36e076,'userRole':_0x33253d,'requestData':_0x224324});}[a48_0x56eeb3(0x123)](){const _0x202710=a48_0x56eeb3;try{const _0x22e7b7=fs_1[_0x202710(0x124)][_0x202710(0x10d)](this[_0x202710(0x122)]),_0x2fee29=_0x22e7b7[_0x202710(0x132)](_0x18111e=>_0x18111e[_0x202710(0x128)](_0x202710(0x126))),_0xc28e56=[...new Set(_0x2fee29[_0x202710(0x120)](_0x294c05=>_0x294c05['split']('_')[0x0]))],_0xc91de5=_0x2fee29[_0x202710(0x120)](_0x2b9bff=>{const _0x1ad2dc=_0x202710,_0x58dc8e=path_1[_0x1ad2dc(0x124)][_0x1ad2dc(0x11d)](this[_0x1ad2dc(0x122)],_0x2b9bff),_0x35aa34=fs_1[_0x1ad2dc(0x124)][_0x1ad2dc(0xf9)](_0x58dc8e),[_0x2bc0bf,_0x246bb5]=_0x2b9bff[_0x1ad2dc(0xe0)](_0x1ad2dc(0x126),'')[_0x1ad2dc(0xfa)]('_');return{'type':_0x2bc0bf,'date':_0x246bb5,'size':_0x35aa34[_0x1ad2dc(0x11a)]};})['sort']((_0x168aa6,_0x1d5154)=>_0x1d5154[_0x202710(0x12a)][_0x202710(0xde)](_0x168aa6[_0x202710(0x12a)]));return{'totalFiles':_0x2fee29[_0x202710(0x127)],'logTypes':_0xc28e56,'latestLogs':_0xc91de5['slice'](0x0,0xa)};}catch(_0x5a18e1){return console[_0x202710(0xeb)]('Failed\x20to\x20get\x20log\x20stats:',_0x5a18e1),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x4ed591=0x1e){const _0x5eec2f=a48_0x56eeb3;try{const _0x483ae3=fs_1['default'][_0x5eec2f(0x10d)](this[_0x5eec2f(0x122)]),_0x1afeeb=new Date();_0x1afeeb[_0x5eec2f(0xdc)](_0x1afeeb[_0x5eec2f(0xe1)]()-_0x4ed591);let _0x1d3d3f=0x0;_0x483ae3[_0x5eec2f(0x119)](_0x350801=>{const _0x2d8ba6=_0x5eec2f;if(!_0x350801['endsWith']('.log'))return;const _0x8a6002=path_1[_0x2d8ba6(0x124)][_0x2d8ba6(0x11d)](this[_0x2d8ba6(0x122)],_0x350801),_0x581c48=fs_1[_0x2d8ba6(0x124)][_0x2d8ba6(0xf9)](_0x8a6002);_0x581c48[_0x2d8ba6(0x112)]<_0x1afeeb&&(fs_1[_0x2d8ba6(0x124)][_0x2d8ba6(0xdb)](_0x8a6002),_0x1d3d3f++,console['log']('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x350801));}),console[_0x5eec2f(0x130)](_0x5eec2f(0xf7)+_0x1d3d3f+_0x5eec2f(0x107)+_0x4ed591+_0x5eec2f(0x12d));}catch(_0x269c6e){console[_0x5eec2f(0xeb)](_0x5eec2f(0xf2),_0x269c6e);}}}exports[a48_0x56eeb3(0x133)]=LoggerService,exports['loggerService']=new LoggerService();