'use strict';const a48_0x3c1e53=a48_0x1f47;(function(_0x219504,_0xe365b){const _0x3d44b7=a48_0x1f47,_0xe349a9=_0x219504();while(!![]){try{const _0x7909a9=parseInt(_0x3d44b7(0x103))/0x1*(-parseInt(_0x3d44b7(0xde))/0x2)+parseInt(_0x3d44b7(0x10e))/0x3*(-parseInt(_0x3d44b7(0xf1))/0x4)+-parseInt(_0x3d44b7(0xe1))/0x5*(parseInt(_0x3d44b7(0x10a))/0x6)+parseInt(_0x3d44b7(0xe9))/0x7+-parseInt(_0x3d44b7(0xd1))/0x8+parseInt(_0x3d44b7(0xdf))/0x9*(parseInt(_0x3d44b7(0xea))/0xa)+parseInt(_0x3d44b7(0xf3))/0xb;if(_0x7909a9===_0xe365b)break;else _0xe349a9['push'](_0xe349a9['shift']());}catch(_0x3785a9){_0xe349a9['push'](_0xe349a9['shift']());}}}(a48_0x2a34,0xc805d));function a48_0x2a34(){const _0x599113=['replace','date','logWhiteDomainError','Failed\x20to\x20write\x20','ensureLogsDirectory','cwd','sort','2aPkjBL','error','__esModule','unlinkSync','white_domain_errors','white_domain_responses','logWhiteDomainRequest','83892pWzmtO','existsSync','WEBHOOK_PROCESSED','shop_webhooks_sent','339564ulkbPe','forEach','webhooks_processed','mkdirSync','length','setDate','SHOP_WEBHOOK_SENT','toISOString','logsDir','size','Failed\x20to\x20clean\x20old\x20logs:','__importDefault','stack','🗑️\x20Deleted\x20old\x20log\x20file:\x20','🧹\x20Cleaned\x20','\x20old\x20log\x20files\x20(older\x20than\x20','endsWith','getLogFileName','PAYMENT_CREATED','split','📁\x20Created\x20logs\x20directory:\x20','WEBHOOK_ERROR','join','map','5797576ALtVHY','shop_webhooks_errors','logShopWebhookError','defineProperty','writeLog','cleanOldLogs','COINTOPAY_ERROR','white_domain_requests','\x20log:','cointopay_errors','localeCompare','getDate','API_CALL','310274eMUeyX','1917HoNUbC','WEBHOOK_RECEIVED','215xcbaij','utf8','statSync','REQUEST','RESPONSE','slice','loggerService','getLogStats','10687817tyNgxQ','45700qjADUU','LoggerService','log','SHOP_WEBHOOK_ERROR','logCoinToPayError','cointopay_status_changes','logPaymentCreated','20qNhbZw','\x20days)','5733079SWCAVt','default','message','logWhiteDomainResponse','mtime','logWebhookError','.log','Failed\x20to\x20get\x20log\x20stats:','payments_created'];a48_0x2a34=function(){return _0x599113;};return a48_0x2a34();}var __importDefault=this&&this[a48_0x3c1e53(0xc4)]||function(_0x8fe9f5){const _0x3e5623=a48_0x3c1e53;return _0x8fe9f5&&_0x8fe9f5[_0x3e5623(0x105)]?_0x8fe9f5:{'default':_0x8fe9f5};};Object[a48_0x3c1e53(0xd4)](exports,'__esModule',{'value':!![]}),exports[a48_0x3c1e53(0xe7)]=exports[a48_0x3c1e53(0xeb)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x4352c3=a48_0x3c1e53;this[_0x4352c3(0xc1)]=path_1['default'][_0x4352c3(0xcf)](process[_0x4352c3(0x101)](),'logs'),this['ensureLogsDirectory']();}[a48_0x3c1e53(0x100)](){const _0x41f902=a48_0x3c1e53;!fs_1[_0x41f902(0xf4)][_0x41f902(0x10b)](this[_0x41f902(0xc1)])&&(fs_1[_0x41f902(0xf4)][_0x41f902(0xbc)](this['logsDir'],{'recursive':!![]}),console[_0x41f902(0xec)](_0x41f902(0xcd)+this[_0x41f902(0xc1)]));}[a48_0x3c1e53(0xca)](_0x34606c){const _0x4098f9=a48_0x3c1e53,_0xb93b3d=new Date()['toISOString']()[_0x4098f9(0xcc)]('T')[0x0];return path_1[_0x4098f9(0xf4)][_0x4098f9(0xcf)](this[_0x4098f9(0xc1)],_0x34606c+'_'+_0xb93b3d+'.log');}[a48_0x3c1e53(0xd5)](_0x596b87,_0x533f39){const _0x2212a7=a48_0x3c1e53;try{const _0x385e07=new Date()[_0x2212a7(0xc0)](),_0x3e81f3={'timestamp':_0x385e07,..._0x533f39},_0xa9ba5e=JSON['stringify'](_0x3e81f3)+'\x0a',_0x241cbf=this['getLogFileName'](_0x596b87);fs_1[_0x2212a7(0xf4)]['appendFileSync'](_0x241cbf,_0xa9ba5e,_0x2212a7(0xe2));}catch(_0xaf599c){console[_0x2212a7(0x104)](_0x2212a7(0xff)+_0x596b87+_0x2212a7(0xd9),_0xaf599c);}}[a48_0x3c1e53(0x109)](_0x32635f,_0x35260b,_0x2a9a9a,_0x7d6685){const _0x5a4386=a48_0x3c1e53;this[_0x5a4386(0xd5)](_0x5a4386(0xd8),{'type':_0x5a4386(0xe4),'gateway':_0x32635f,'endpoint':_0x35260b,'method':_0x2a9a9a,'data':_0x7d6685});}[a48_0x3c1e53(0xf6)](_0x1417da,_0x3b8b5a,_0x17258d,_0x318240,_0x22d047){const _0x5ba8b7=a48_0x3c1e53;this[_0x5ba8b7(0xd5)](_0x5ba8b7(0x108),{'type':_0x5ba8b7(0xe5),'gateway':_0x1417da,'endpoint':_0x3b8b5a,'status':_0x17258d,'responseTime':_0x22d047,'data':_0x318240});}[a48_0x3c1e53(0xfe)](_0x3ba4ad,_0x1268dd,_0x5d0c61){const _0x3ac8b3=a48_0x3c1e53;this[_0x3ac8b3(0xd5)](_0x3ac8b3(0x107),{'type':'ERROR','gateway':_0x3ba4ad,'endpoint':_0x1268dd,'error':_0x5d0c61 instanceof Error?{'message':_0x5d0c61[_0x3ac8b3(0xf5)],'stack':_0x5d0c61['stack']}:_0x5d0c61});}['logWebhookReceived'](_0x3006bb,_0x45644f,_0x43c66f){const _0x2fb046=a48_0x3c1e53;this[_0x2fb046(0xd5)]('webhooks_received',{'type':_0x2fb046(0xe0),'gateway':_0x3006bb,'headers':_0x43c66f,'data':_0x45644f});}['logWebhookProcessed'](_0x982837,_0x3ce557,_0x4396b3,_0x275565,_0x36713e){const _0x1d134f=a48_0x3c1e53;this[_0x1d134f(0xd5)](_0x1d134f(0x110),{'type':_0x1d134f(0x10c),'gateway':_0x982837,'paymentId':_0x3ce557,'oldStatus':_0x4396b3,'newStatus':_0x275565,'originalData':_0x36713e});}[a48_0x3c1e53(0xf8)](_0xbd67ed,_0x832699,_0x20ef3c){const _0x26d073=a48_0x3c1e53;this[_0x26d073(0xd5)]('webhooks_errors',{'type':_0x26d073(0xce),'gateway':_0xbd67ed,'error':_0x832699 instanceof Error?{'message':_0x832699['message'],'stack':_0x832699[_0x26d073(0xc5)]}:_0x832699,'originalData':_0x20ef3c});}['logCoinToPayStatus'](_0x5654ff){const _0x3cd1f0=a48_0x3c1e53;this['writeLog'](_0x3cd1f0(0xef),{'type':'COINTOPAY_STATUS_CHANGE',..._0x5654ff});}[a48_0x3c1e53(0xee)](_0x4fd679){const _0x5aae9f=a48_0x3c1e53;this[_0x5aae9f(0xd5)](_0x5aae9f(0xda),{'type':_0x5aae9f(0xd7),..._0x4fd679});}['logShopWebhookSent'](_0x11ae8b,_0x26e9b0,_0xc35c0,_0x46b690,_0x156409,_0x2ce280){const _0x1df8d5=a48_0x3c1e53;this[_0x1df8d5(0xd5)](_0x1df8d5(0x10d),{'type':_0x1df8d5(0xbf),'shopId':_0x11ae8b,'webhookUrl':_0x26e9b0,'event':_0xc35c0,'status':_0x46b690,'responseTime':_0x156409,'payload':_0x2ce280});}[a48_0x3c1e53(0xd3)](_0x35fb29,_0x168b61,_0x4c7b6,_0x2807a1,_0x52030f){const _0x1aa9a7=a48_0x3c1e53;this[_0x1aa9a7(0xd5)](_0x1aa9a7(0xd2),{'type':_0x1aa9a7(0xed),'shopId':_0x35fb29,'webhookUrl':_0x168b61,'event':_0x4c7b6,'error':_0x2807a1 instanceof Error?{'message':_0x2807a1['message'],'stack':_0x2807a1['stack']}:_0x2807a1,'payload':_0x52030f});}[a48_0x3c1e53(0xf0)](_0x74d201,_0x7fbae0,_0x433e99,_0x491dd1,_0x5f0d80){const _0x5c6ce7=a48_0x3c1e53;this[_0x5c6ce7(0xd5)](_0x5c6ce7(0xfb),{'type':_0x5c6ce7(0xcb),'gateway':_0x74d201,'paymentId':_0x7fbae0,'shopId':_0x433e99,'amount':_0x491dd1,'currency':_0x5f0d80});}['logApiCall'](_0x5c9c35,_0x2e521b,_0x4a87c8,_0x300571,_0x5279a1){const _0x5c70b4=a48_0x3c1e53;this[_0x5c70b4(0xd5)]('api_calls',{'type':_0x5c70b4(0xdd),'endpoint':_0x5c9c35,'method':_0x2e521b,'userId':_0x4a87c8,'userRole':_0x300571,'requestData':_0x5279a1});}[a48_0x3c1e53(0xe8)](){const _0x3b0d00=a48_0x3c1e53;try{const _0x3cc23d=fs_1[_0x3b0d00(0xf4)]['readdirSync'](this[_0x3b0d00(0xc1)]),_0x33ae07=_0x3cc23d['filter'](_0x59fc27=>_0x59fc27[_0x3b0d00(0xc9)]('.log')),_0x2f88f1=[...new Set(_0x33ae07[_0x3b0d00(0xd0)](_0x1e1897=>_0x1e1897[_0x3b0d00(0xcc)]('_')[0x0]))],_0x9f20b6=_0x33ae07[_0x3b0d00(0xd0)](_0xde5a5f=>{const _0x5b3b6c=_0x3b0d00,_0x11500d=path_1[_0x5b3b6c(0xf4)][_0x5b3b6c(0xcf)](this['logsDir'],_0xde5a5f),_0x6c667a=fs_1['default'][_0x5b3b6c(0xe3)](_0x11500d),[_0x2123f7,_0x5915fb]=_0xde5a5f[_0x5b3b6c(0xfc)](_0x5b3b6c(0xf9),'')['split']('_');return{'type':_0x2123f7,'date':_0x5915fb,'size':_0x6c667a[_0x5b3b6c(0xc2)]};})[_0x3b0d00(0x102)]((_0x572786,_0x213c03)=>_0x213c03[_0x3b0d00(0xfd)][_0x3b0d00(0xdb)](_0x572786[_0x3b0d00(0xfd)]));return{'totalFiles':_0x33ae07[_0x3b0d00(0xbd)],'logTypes':_0x2f88f1,'latestLogs':_0x9f20b6[_0x3b0d00(0xe6)](0x0,0xa)};}catch(_0x39cd65){return console[_0x3b0d00(0x104)](_0x3b0d00(0xfa),_0x39cd65),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x3c1e53(0xd6)](_0x3e20e8=0x1e){const _0x19529c=a48_0x3c1e53;try{const _0x2dea5f=fs_1[_0x19529c(0xf4)]['readdirSync'](this['logsDir']),_0x3ba020=new Date();_0x3ba020[_0x19529c(0xbe)](_0x3ba020[_0x19529c(0xdc)]()-_0x3e20e8);let _0x443fba=0x0;_0x2dea5f[_0x19529c(0x10f)](_0x1dc03b=>{const _0x15a7b8=_0x19529c;if(!_0x1dc03b['endsWith'](_0x15a7b8(0xf9)))return;const _0x3b23d5=path_1[_0x15a7b8(0xf4)][_0x15a7b8(0xcf)](this[_0x15a7b8(0xc1)],_0x1dc03b),_0x30edbb=fs_1['default'][_0x15a7b8(0xe3)](_0x3b23d5);_0x30edbb[_0x15a7b8(0xf7)]<_0x3ba020&&(fs_1[_0x15a7b8(0xf4)][_0x15a7b8(0x106)](_0x3b23d5),_0x443fba++,console[_0x15a7b8(0xec)](_0x15a7b8(0xc6)+_0x1dc03b));}),console[_0x19529c(0xec)](_0x19529c(0xc7)+_0x443fba+_0x19529c(0xc8)+_0x3e20e8+_0x19529c(0xf2));}catch(_0x35b470){console[_0x19529c(0x104)](_0x19529c(0xc3),_0x35b470);}}}function a48_0x1f47(_0x48a1e0,_0x49a8d3){const _0x2a3419=a48_0x2a34();return a48_0x1f47=function(_0x1f47d1,_0x5f1ae4){_0x1f47d1=_0x1f47d1-0xbc;let _0x203e75=_0x2a3419[_0x1f47d1];return _0x203e75;},a48_0x1f47(_0x48a1e0,_0x49a8d3);}exports[a48_0x3c1e53(0xeb)]=LoggerService,exports['loggerService']=new LoggerService();