'use strict';const a44_0xdaefa2=a44_0x12df;(function(_0x18c171,_0x31ee2c){const _0x2a1bc8=a44_0x12df,_0x57ab70=_0x18c171();while(!![]){try{const _0x2e534e=-parseInt(_0x2a1bc8(0x131))/0x1+-parseInt(_0x2a1bc8(0x16b))/0x2*(parseInt(_0x2a1bc8(0x169))/0x3)+parseInt(_0x2a1bc8(0x162))/0x4*(-parseInt(_0x2a1bc8(0x14d))/0x5)+-parseInt(_0x2a1bc8(0x140))/0x6+-parseInt(_0x2a1bc8(0x151))/0x7+-parseInt(_0x2a1bc8(0x153))/0x8*(parseInt(_0x2a1bc8(0x13f))/0x9)+parseInt(_0x2a1bc8(0x138))/0xa;if(_0x2e534e===_0x31ee2c)break;else _0x57ab70['push'](_0x57ab70['shift']());}catch(_0x41b008){_0x57ab70['push'](_0x57ab70['shift']());}}}(a44_0x4eef,0x5e0c1));function a44_0x12df(_0x53fece,_0x21d963){const _0x4eefcc=a44_0x4eef();return a44_0x12df=function(_0x12df55,_0x4d2c3f){_0x12df55=_0x12df55-0x131;let _0x34491c=_0x4eefcc[_0x12df55];return _0x34491c;},a44_0x12df(_0x53fece,_0x21d963);}function a44_0x4eef(){const _0x595d52=['ERROR','Failed\x20to\x20write\x20','stack','writeLog','defineProperty','localeCompare','split','message','mtime','1612fZQPfQ','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','default','API_CALL','white_domain_responses','getLogStats','\x20log:','3bCGxhp','WEBHOOK_RECEIVED','572710AuYASI','logCoinToPayError','__importDefault','cwd','logsDir','log','.log','logWhiteDomainResponse','logWebhookError','filter','logShopWebhookSent','SHOP_WEBHOOK_ERROR','COINTOPAY_ERROR','webhooks_received','Failed\x20to\x20clean\x20old\x20logs:','readdirSync','ensureLogsDirectory','WEBHOOK_PROCESSED','logs','api_calls','logApiCall','logPaymentCreated','stringify','setDate','loggerService','620575KaTLaM','unlinkSync','getLogFileName','date','white_domain_requests','endsWith','REQUEST','26957940jsUKUF','WEBHOOK_ERROR','replace','logWhiteDomainRequest','existsSync','logWhiteDomainError','LoggerService','24399hWRHJH','2719500EXpdop','cleanOldLogs','webhooks_errors','mkdirSync','toISOString','join','utf8','forEach','RESPONSE','\x20days)','length','ðŸ“\x20Created\x20logs\x20directory:\x20','error','1585pohLem','shop_webhooks_sent','payments_created','ðŸ§¹\x20Cleaned\x20','1393812HMuvXc','shop_webhooks_errors','1840RjcXhH','logWebhookProcessed','Failed\x20to\x20get\x20log\x20stats:','webhooks_processed','\x20old\x20log\x20files\x20(older\x20than\x20','size'];a44_0x4eef=function(){return _0x595d52;};return a44_0x4eef();}var __importDefault=this&&this[a44_0xdaefa2(0x16d)]||function(_0x3b2574){return _0x3b2574&&_0x3b2574['__esModule']?_0x3b2574:{'default':_0x3b2574};};Object[a44_0xdaefa2(0x15d)](exports,'__esModule',{'value':!![]}),exports[a44_0xdaefa2(0x183)]=exports[a44_0xdaefa2(0x13e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x3338db=a44_0xdaefa2;this[_0x3338db(0x16f)]=path_1[_0x3338db(0x164)]['join'](process[_0x3338db(0x16e)](),_0x3338db(0x17d)),this[_0x3338db(0x17b)]();}[a44_0xdaefa2(0x17b)](){const _0x156d0d=a44_0xdaefa2;!fs_1[_0x156d0d(0x164)][_0x156d0d(0x13c)](this[_0x156d0d(0x16f)])&&(fs_1['default'][_0x156d0d(0x143)](this['logsDir'],{'recursive':!![]}),console[_0x156d0d(0x170)](_0x156d0d(0x14b)+this['logsDir']));}[a44_0xdaefa2(0x133)](_0x4b1c82){const _0x120a7e=a44_0xdaefa2,_0x54bb03=new Date()[_0x120a7e(0x144)]()[_0x120a7e(0x15f)]('T')[0x0];return path_1[_0x120a7e(0x164)][_0x120a7e(0x145)](this[_0x120a7e(0x16f)],_0x4b1c82+'_'+_0x54bb03+_0x120a7e(0x171));}[a44_0xdaefa2(0x15c)](_0x3fde23,_0x12da21){const _0xf004bb=a44_0xdaefa2;try{const _0x3ed4d8=new Date()[_0xf004bb(0x144)](),_0x361f8={'timestamp':_0x3ed4d8,..._0x12da21},_0x58ae30=JSON[_0xf004bb(0x181)](_0x361f8)+'\x0a',_0x29f0b1=this[_0xf004bb(0x133)](_0x3fde23);fs_1[_0xf004bb(0x164)]['appendFileSync'](_0x29f0b1,_0x58ae30,_0xf004bb(0x146));}catch(_0x3eecce){console[_0xf004bb(0x14c)](_0xf004bb(0x15a)+_0x3fde23+_0xf004bb(0x168),_0x3eecce);}}[a44_0xdaefa2(0x13b)](_0x53ab72,_0x24d651,_0x25bf65,_0x333fc0){const _0x884df7=a44_0xdaefa2;this[_0x884df7(0x15c)](_0x884df7(0x135),{'type':_0x884df7(0x137),'gateway':_0x53ab72,'endpoint':_0x24d651,'method':_0x25bf65,'data':_0x333fc0});}[a44_0xdaefa2(0x172)](_0x5305be,_0x212827,_0x3d4553,_0x53e946,_0x1c56f4){const _0x2eb3e0=a44_0xdaefa2;this[_0x2eb3e0(0x15c)](_0x2eb3e0(0x166),{'type':_0x2eb3e0(0x148),'gateway':_0x5305be,'endpoint':_0x212827,'status':_0x3d4553,'responseTime':_0x1c56f4,'data':_0x53e946});}[a44_0xdaefa2(0x13d)](_0x3d977f,_0x5d1ee1,_0x195ee4){const _0x3cd923=a44_0xdaefa2;this[_0x3cd923(0x15c)]('white_domain_errors',{'type':_0x3cd923(0x159),'gateway':_0x3d977f,'endpoint':_0x5d1ee1,'error':_0x195ee4 instanceof Error?{'message':_0x195ee4['message'],'stack':_0x195ee4[_0x3cd923(0x15b)]}:_0x195ee4});}['logWebhookReceived'](_0x53693b,_0x31740a,_0x2cc181){const _0x26fdc2=a44_0xdaefa2;this[_0x26fdc2(0x15c)](_0x26fdc2(0x178),{'type':_0x26fdc2(0x16a),'gateway':_0x53693b,'headers':_0x2cc181,'data':_0x31740a});}[a44_0xdaefa2(0x154)](_0x38d13e,_0xd2af3c,_0x3d1d18,_0x5b112d,_0x5a9bba){const _0x206662=a44_0xdaefa2;this[_0x206662(0x15c)](_0x206662(0x156),{'type':_0x206662(0x17c),'gateway':_0x38d13e,'paymentId':_0xd2af3c,'oldStatus':_0x3d1d18,'newStatus':_0x5b112d,'originalData':_0x5a9bba});}[a44_0xdaefa2(0x173)](_0x33f816,_0x21221e,_0x31d324){const _0x6a4081=a44_0xdaefa2;this[_0x6a4081(0x15c)](_0x6a4081(0x142),{'type':_0x6a4081(0x139),'gateway':_0x33f816,'error':_0x21221e instanceof Error?{'message':_0x21221e['message'],'stack':_0x21221e[_0x6a4081(0x15b)]}:_0x21221e,'originalData':_0x31d324});}['logCoinToPayStatus'](_0x7bd4de){const _0x82391d=a44_0xdaefa2;this[_0x82391d(0x15c)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x7bd4de});}[a44_0xdaefa2(0x16c)](_0x472457){const _0x2b4e3d=a44_0xdaefa2;this[_0x2b4e3d(0x15c)]('cointopay_errors',{'type':_0x2b4e3d(0x177),..._0x472457});}[a44_0xdaefa2(0x175)](_0x3f4c09,_0x578f9a,_0x46b50e,_0x4eb39e,_0x3bacb0,_0x411fb4){const _0x14c4e2=a44_0xdaefa2;this[_0x14c4e2(0x15c)](_0x14c4e2(0x14e),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x3f4c09,'webhookUrl':_0x578f9a,'event':_0x46b50e,'status':_0x4eb39e,'responseTime':_0x3bacb0,'payload':_0x411fb4});}['logShopWebhookError'](_0x16504d,_0x109aa4,_0x41a35c,_0x186a20,_0x116601){const _0x530969=a44_0xdaefa2;this['writeLog'](_0x530969(0x152),{'type':_0x530969(0x176),'shopId':_0x16504d,'webhookUrl':_0x109aa4,'event':_0x41a35c,'error':_0x186a20 instanceof Error?{'message':_0x186a20[_0x530969(0x160)],'stack':_0x186a20[_0x530969(0x15b)]}:_0x186a20,'payload':_0x116601});}[a44_0xdaefa2(0x180)](_0xfe7a32,_0x101545,_0x59891e,_0x16ac64,_0x2fc758){const _0x2f3d0f=a44_0xdaefa2;this[_0x2f3d0f(0x15c)](_0x2f3d0f(0x14f),{'type':'PAYMENT_CREATED','gateway':_0xfe7a32,'paymentId':_0x101545,'shopId':_0x59891e,'amount':_0x16ac64,'currency':_0x2fc758});}[a44_0xdaefa2(0x17f)](_0x122423,_0x4c09de,_0x53ae98,_0x29f663,_0x11237b){const _0x414055=a44_0xdaefa2;this['writeLog'](_0x414055(0x17e),{'type':_0x414055(0x165),'endpoint':_0x122423,'method':_0x4c09de,'userId':_0x53ae98,'userRole':_0x29f663,'requestData':_0x11237b});}[a44_0xdaefa2(0x167)](){const _0x5768d1=a44_0xdaefa2;try{const _0x451d1b=fs_1[_0x5768d1(0x164)][_0x5768d1(0x17a)](this[_0x5768d1(0x16f)]),_0x4dc043=_0x451d1b[_0x5768d1(0x174)](_0x1b5470=>_0x1b5470[_0x5768d1(0x136)](_0x5768d1(0x171))),_0x483a1e=[...new Set(_0x4dc043['map'](_0x3b99d8=>_0x3b99d8[_0x5768d1(0x15f)]('_')[0x0]))],_0x3cf386=_0x4dc043['map'](_0x202b10=>{const _0x3e32d5=_0x5768d1,_0x1f6afb=path_1[_0x3e32d5(0x164)][_0x3e32d5(0x145)](this[_0x3e32d5(0x16f)],_0x202b10),_0x2f06c3=fs_1['default']['statSync'](_0x1f6afb),[_0x46342c,_0x36bbe7]=_0x202b10[_0x3e32d5(0x13a)]('.log','')[_0x3e32d5(0x15f)]('_');return{'type':_0x46342c,'date':_0x36bbe7,'size':_0x2f06c3[_0x3e32d5(0x158)]};})['sort']((_0x5066b3,_0x43c37d)=>_0x43c37d[_0x5768d1(0x134)][_0x5768d1(0x15e)](_0x5066b3[_0x5768d1(0x134)]));return{'totalFiles':_0x4dc043[_0x5768d1(0x14a)],'logTypes':_0x483a1e,'latestLogs':_0x3cf386['slice'](0x0,0xa)};}catch(_0x1743c8){return console['error'](_0x5768d1(0x155),_0x1743c8),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a44_0xdaefa2(0x141)](_0x37be95=0x1e){const _0x14bb30=a44_0xdaefa2;try{const _0x10b497=fs_1['default'][_0x14bb30(0x17a)](this[_0x14bb30(0x16f)]),_0x496af3=new Date();_0x496af3[_0x14bb30(0x182)](_0x496af3['getDate']()-_0x37be95);let _0x23ba94=0x0;_0x10b497[_0x14bb30(0x147)](_0x55b9db=>{const _0x4a671d=_0x14bb30;if(!_0x55b9db[_0x4a671d(0x136)](_0x4a671d(0x171)))return;const _0x5e95d5=path_1[_0x4a671d(0x164)][_0x4a671d(0x145)](this[_0x4a671d(0x16f)],_0x55b9db),_0x31fb24=fs_1[_0x4a671d(0x164)]['statSync'](_0x5e95d5);_0x31fb24[_0x4a671d(0x161)]<_0x496af3&&(fs_1[_0x4a671d(0x164)][_0x4a671d(0x132)](_0x5e95d5),_0x23ba94++,console['log'](_0x4a671d(0x163)+_0x55b9db));}),console[_0x14bb30(0x170)](_0x14bb30(0x150)+_0x23ba94+_0x14bb30(0x157)+_0x37be95+_0x14bb30(0x149));}catch(_0x220893){console[_0x14bb30(0x14c)](_0x14bb30(0x179),_0x220893);}}}exports[a44_0xdaefa2(0x13e)]=LoggerService,exports[a44_0xdaefa2(0x183)]=new LoggerService();