'use strict';const a48_0x4c5c1c=a48_0x5d86;function a48_0x4335(){const _0x3eee48=['getLogStats','📁\x20Created\x20logs\x20directory:\x20','log','8KOMJmZ','white_domain_errors','logApiCall','loggerService','filter','readdirSync','api_calls','join','.log','stack','logPaymentCreated','logWebhookProcessed','logWebhookError','length','default','1456451WrkxWk','9710ZedVHw','localeCompare','logWhiteDomainRequest','forEach','__esModule','writeLog','utf8','logShopWebhookSent','white_domain_responses','6988ibitIr','SHOP_WEBHOOK_ERROR','getLogFileName','RESPONSE','stringify','setDate','1276uHNeHT','message','slice','\x20days)','split','REQUEST','Failed\x20to\x20clean\x20old\x20logs:','logs','shop_webhooks_sent','webhooks_processed','399uOluyS','1467927DHxcsw','__importDefault','4710DlHDtD','error','defineProperty','8050294nGEieT','map','28560hIWtQy','cwd','logWebhookReceived','SHOP_WEBHOOK_SENT','logCoinToPayError','sort','3429540sBifca','COINTOPAY_ERROR','replace','ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','cleanOldLogs','\x20log:','date','getDate','statSync','cointopay_status_changes','payments_created','endsWith','webhooks_errors','LoggerService','Failed\x20to\x20write\x20','PAYMENT_CREATED','logWhiteDomainError','WEBHOOK_PROCESSED','🧹\x20Cleaned\x20','webhooks_received','unlinkSync','size','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logWhiteDomainResponse','logsDir','ensureLogsDirectory','logCoinToPayStatus','toISOString'];a48_0x4335=function(){return _0x3eee48;};return a48_0x4335();}(function(_0x557e5c,_0x1c0f48){const _0x1f6a3f=a48_0x5d86,_0x1c6b5d=_0x557e5c();while(!![]){try{const _0x11c730=parseInt(_0x1f6a3f(0x1e1))/0x1+parseInt(_0x1f6a3f(0x209))/0x2+-parseInt(_0x1f6a3f(0x1fb))/0x3*(-parseInt(_0x1f6a3f(0x1eb))/0x4)+parseInt(_0x1f6a3f(0x1e2))/0x5*(-parseInt(_0x1f6a3f(0x1fe))/0x6)+-parseInt(_0x1f6a3f(0x201))/0x7+parseInt(_0x1f6a3f(0x1d2))/0x8*(-parseInt(_0x1f6a3f(0x1fc))/0x9)+-parseInt(_0x1f6a3f(0x203))/0xa*(-parseInt(_0x1f6a3f(0x1f1))/0xb);if(_0x11c730===_0x1c0f48)break;else _0x1c6b5d['push'](_0x1c6b5d['shift']());}catch(_0x179e96){_0x1c6b5d['push'](_0x1c6b5d['shift']());}}}(a48_0x4335,0xdb0e5));var __importDefault=this&&this[a48_0x4c5c1c(0x1fd)]||function(_0x5bfb12){const _0x4d6cbb=a48_0x4c5c1c;return _0x5bfb12&&_0x5bfb12[_0x4d6cbb(0x1e6)]?_0x5bfb12:{'default':_0x5bfb12};};Object[a48_0x4c5c1c(0x200)](exports,'__esModule',{'value':!![]}),exports[a48_0x4c5c1c(0x1d5)]=exports[a48_0x4c5c1c(0x1c0)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));function a48_0x5d86(_0x1aac59,_0x3d7af9){const _0x43355d=a48_0x4335();return a48_0x5d86=function(_0x5d86eb,_0x754641){_0x5d86eb=_0x5d86eb-0x1bf;let _0x3918cc=_0x43355d[_0x5d86eb];return _0x3918cc;},a48_0x5d86(_0x1aac59,_0x3d7af9);}class LoggerService{constructor(){const _0x3b30f7=a48_0x4c5c1c;this[_0x3b30f7(0x1cb)]=path_1[_0x3b30f7(0x1e0)]['join'](process[_0x3b30f7(0x204)](),_0x3b30f7(0x1f8)),this[_0x3b30f7(0x1cc)]();}[a48_0x4c5c1c(0x1cc)](){const _0x24050f=a48_0x4c5c1c;!fs_1[_0x24050f(0x1e0)]['existsSync'](this[_0x24050f(0x1cb)])&&(fs_1['default']['mkdirSync'](this[_0x24050f(0x1cb)],{'recursive':!![]}),console['log'](_0x24050f(0x1d0)+this[_0x24050f(0x1cb)]));}[a48_0x4c5c1c(0x1ed)](_0x225df6){const _0x2ad72a=a48_0x4c5c1c,_0x2f2f8b=new Date()[_0x2ad72a(0x1ce)]()[_0x2ad72a(0x1f5)]('T')[0x0];return path_1[_0x2ad72a(0x1e0)][_0x2ad72a(0x1d9)](this['logsDir'],_0x225df6+'_'+_0x2f2f8b+_0x2ad72a(0x1da));}[a48_0x4c5c1c(0x1e7)](_0x4132b8,_0x10949b){const _0x21eb5a=a48_0x4c5c1c;try{const _0x5d49a9=new Date()['toISOString'](),_0xa0e5e3={'timestamp':_0x5d49a9,..._0x10949b},_0x37dda3=JSON[_0x21eb5a(0x1ef)](_0xa0e5e3)+'\x0a',_0xcd8eae=this['getLogFileName'](_0x4132b8);fs_1[_0x21eb5a(0x1e0)]['appendFileSync'](_0xcd8eae,_0x37dda3,_0x21eb5a(0x1e8));}catch(_0x1b1855){console['error'](_0x21eb5a(0x1c1)+_0x4132b8+_0x21eb5a(0x20f),_0x1b1855);}}[a48_0x4c5c1c(0x1e4)](_0x3cc25b,_0x2d6b5d,_0x380c64,_0x2da8e9){const _0x398ca8=a48_0x4c5c1c;this[_0x398ca8(0x1e7)]('white_domain_requests',{'type':_0x398ca8(0x1f6),'gateway':_0x3cc25b,'endpoint':_0x2d6b5d,'method':_0x380c64,'data':_0x2da8e9});}[a48_0x4c5c1c(0x1ca)](_0x2e8890,_0x1ff289,_0x11b7fb,_0x2f2e63,_0x1bb3e9){const _0x26d44c=a48_0x4c5c1c;this[_0x26d44c(0x1e7)](_0x26d44c(0x1ea),{'type':_0x26d44c(0x1ee),'gateway':_0x2e8890,'endpoint':_0x1ff289,'status':_0x11b7fb,'responseTime':_0x1bb3e9,'data':_0x2f2e63});}[a48_0x4c5c1c(0x1c3)](_0x365424,_0x40b720,_0x5984a6){const _0x34afb4=a48_0x4c5c1c;this[_0x34afb4(0x1e7)](_0x34afb4(0x1d3),{'type':_0x34afb4(0x20c),'gateway':_0x365424,'endpoint':_0x40b720,'error':_0x5984a6 instanceof Error?{'message':_0x5984a6[_0x34afb4(0x1f2)],'stack':_0x5984a6[_0x34afb4(0x1db)]}:_0x5984a6});}[a48_0x4c5c1c(0x205)](_0x1b4d11,_0x12663a,_0x410a1f){const _0x57d825=a48_0x4c5c1c;this[_0x57d825(0x1e7)](_0x57d825(0x1c6),{'type':'WEBHOOK_RECEIVED','gateway':_0x1b4d11,'headers':_0x410a1f,'data':_0x12663a});}[a48_0x4c5c1c(0x1dd)](_0xc43a41,_0x3824cd,_0x37e280,_0x1a81a8,_0x1698af){const _0xfcc91c=a48_0x4c5c1c;this[_0xfcc91c(0x1e7)](_0xfcc91c(0x1fa),{'type':_0xfcc91c(0x1c4),'gateway':_0xc43a41,'paymentId':_0x3824cd,'oldStatus':_0x37e280,'newStatus':_0x1a81a8,'originalData':_0x1698af});}[a48_0x4c5c1c(0x1de)](_0x4ffb2b,_0x577887,_0xecce34){const _0x4378a9=a48_0x4c5c1c;this['writeLog'](_0x4378a9(0x1bf),{'type':'WEBHOOK_ERROR','gateway':_0x4ffb2b,'error':_0x577887 instanceof Error?{'message':_0x577887['message'],'stack':_0x577887[_0x4378a9(0x1db)]}:_0x577887,'originalData':_0xecce34});}[a48_0x4c5c1c(0x1cd)](_0x490b9c){const _0xe33654=a48_0x4c5c1c;this[_0xe33654(0x1e7)](_0xe33654(0x213),{'type':'COINTOPAY_STATUS_CHANGE',..._0x490b9c});}[a48_0x4c5c1c(0x207)](_0xc4dfcc){const _0x480a3b=a48_0x4c5c1c;this[_0x480a3b(0x1e7)]('cointopay_errors',{'type':_0x480a3b(0x20a),..._0xc4dfcc});}[a48_0x4c5c1c(0x1e9)](_0x12c2be,_0x9d4e23,_0x7d49d7,_0x2195f8,_0x18854c,_0x533333){const _0x5943b4=a48_0x4c5c1c;this[_0x5943b4(0x1e7)](_0x5943b4(0x1f9),{'type':_0x5943b4(0x206),'shopId':_0x12c2be,'webhookUrl':_0x9d4e23,'event':_0x7d49d7,'status':_0x2195f8,'responseTime':_0x18854c,'payload':_0x533333});}['logShopWebhookError'](_0x13dad5,_0x59cb59,_0x2738fd,_0x38d0a5,_0x4a347a){const _0x48144=a48_0x4c5c1c;this[_0x48144(0x1e7)]('shop_webhooks_errors',{'type':_0x48144(0x1ec),'shopId':_0x13dad5,'webhookUrl':_0x59cb59,'event':_0x2738fd,'error':_0x38d0a5 instanceof Error?{'message':_0x38d0a5['message'],'stack':_0x38d0a5[_0x48144(0x1db)]}:_0x38d0a5,'payload':_0x4a347a});}[a48_0x4c5c1c(0x1dc)](_0x4c5bd3,_0x10331b,_0x18f6fc,_0x268927,_0x3d4726){const _0x5ab1eb=a48_0x4c5c1c;this['writeLog'](_0x5ab1eb(0x214),{'type':_0x5ab1eb(0x1c2),'gateway':_0x4c5bd3,'paymentId':_0x10331b,'shopId':_0x18f6fc,'amount':_0x268927,'currency':_0x3d4726});}[a48_0x4c5c1c(0x1d4)](_0x2bc1dc,_0x5ef41b,_0x33c5d2,_0x3db6df,_0x2c8ef9){const _0x149c22=a48_0x4c5c1c;this[_0x149c22(0x1e7)](_0x149c22(0x1d8),{'type':'API_CALL','endpoint':_0x2bc1dc,'method':_0x5ef41b,'userId':_0x33c5d2,'userRole':_0x3db6df,'requestData':_0x2c8ef9});}[a48_0x4c5c1c(0x1cf)](){const _0x377af8=a48_0x4c5c1c;try{const _0x37179e=fs_1['default'][_0x377af8(0x1d7)](this[_0x377af8(0x1cb)]),_0x1c22f0=_0x37179e[_0x377af8(0x1d6)](_0x52a7d6=>_0x52a7d6[_0x377af8(0x215)](_0x377af8(0x1da))),_0x2e0277=[...new Set(_0x1c22f0[_0x377af8(0x202)](_0x6e0e94=>_0x6e0e94['split']('_')[0x0]))],_0x2ff33c=_0x1c22f0[_0x377af8(0x202)](_0x3f8928=>{const _0xa6d023=_0x377af8,_0xc3cf3f=path_1[_0xa6d023(0x1e0)][_0xa6d023(0x1d9)](this['logsDir'],_0x3f8928),_0x19e566=fs_1[_0xa6d023(0x1e0)][_0xa6d023(0x212)](_0xc3cf3f),[_0x583e49,_0x42d378]=_0x3f8928[_0xa6d023(0x20b)]('.log','')[_0xa6d023(0x1f5)]('_');return{'type':_0x583e49,'date':_0x42d378,'size':_0x19e566[_0xa6d023(0x1c8)]};})[_0x377af8(0x208)]((_0x29e83e,_0x202e2f)=>_0x202e2f[_0x377af8(0x210)][_0x377af8(0x1e3)](_0x29e83e['date']));return{'totalFiles':_0x1c22f0[_0x377af8(0x1df)],'logTypes':_0x2e0277,'latestLogs':_0x2ff33c[_0x377af8(0x1f3)](0x0,0xa)};}catch(_0x4d5402){return console[_0x377af8(0x1ff)]('Failed\x20to\x20get\x20log\x20stats:',_0x4d5402),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x4c5c1c(0x20e)](_0x214415=0x1e){const _0x172583=a48_0x4c5c1c;try{const _0x5449bd=fs_1[_0x172583(0x1e0)][_0x172583(0x1d7)](this['logsDir']),_0xa61588=new Date();_0xa61588[_0x172583(0x1f0)](_0xa61588[_0x172583(0x211)]()-_0x214415);let _0x298e2b=0x0;_0x5449bd[_0x172583(0x1e5)](_0x4d49da=>{const _0x4796ec=_0x172583;if(!_0x4d49da[_0x4796ec(0x215)](_0x4796ec(0x1da)))return;const _0x11051e=path_1[_0x4796ec(0x1e0)]['join'](this[_0x4796ec(0x1cb)],_0x4d49da),_0x47e557=fs_1[_0x4796ec(0x1e0)]['statSync'](_0x11051e);_0x47e557['mtime']<_0xa61588&&(fs_1['default'][_0x4796ec(0x1c7)](_0x11051e),_0x298e2b++,console[_0x4796ec(0x1d1)](_0x4796ec(0x1c9)+_0x4d49da));}),console[_0x172583(0x1d1)](_0x172583(0x1c5)+_0x298e2b+_0x172583(0x20d)+_0x214415+_0x172583(0x1f4));}catch(_0x1ec4d0){console[_0x172583(0x1ff)](_0x172583(0x1f7),_0x1ec4d0);}}}exports['LoggerService']=LoggerService,exports[a48_0x4c5c1c(0x1d5)]=new LoggerService();