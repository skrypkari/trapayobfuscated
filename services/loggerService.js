'use strict';const a59_0x30622d=a59_0xf169;(function(_0xa8d79,_0x574863){const _0x2a7fad=a59_0xf169,_0x21866b=_0xa8d79();while(!![]){try{const _0x46cfb7=-parseInt(_0x2a7fad(0xc8))/0x1+-parseInt(_0x2a7fad(0x86))/0x2+parseInt(_0x2a7fad(0xbf))/0x3+parseInt(_0x2a7fad(0x80))/0x4*(parseInt(_0x2a7fad(0xaa))/0x5)+parseInt(_0x2a7fad(0x95))/0x6*(parseInt(_0x2a7fad(0xc1))/0x7)+parseInt(_0x2a7fad(0x7d))/0x8+-parseInt(_0x2a7fad(0x7c))/0x9;if(_0x46cfb7===_0x574863)break;else _0x21866b['push'](_0x21866b['shift']());}catch(_0x1da06c){_0x21866b['push'](_0x21866b['shift']());}}}(a59_0x509d,0xecf7e));function a59_0x509d(){const _0x1e755b=['🗑️\x20Deleted\x20old\x20log\x20file:\x20','2069856kQKCZF','9972920TjCJMy','SHOP_WEBHOOK_SENT','length','717436RjBTQr','path','ensureLogsDirectory','log','stack','api_calls','779402JCkwPV','appendFileSync','logWebhookReceived','logWebhookProcessed','WEBHOOK_PROCESSED','cointopay_status_changes','payments_created','COINTOPAY_ERROR','__importDefault','ERROR','PAYMENT_CREATED','cleanOldLogs','\x20log:','unlinkSync','getDate','65916cqhXGd','split','readdirSync','mkdirSync','logCoinToPayStatus','Failed\x20to\x20write\x20','utf8','📁\x20Created\x20logs\x20directory:\x20','message','forEach','logWhiteDomainResponse','default','date','logShopWebhookSent','logWhiteDomainRequest','Failed\x20to\x20clean\x20old\x20logs:','REQUEST','logCoinToPayError','logApiCall','\x20old\x20log\x20files\x20(older\x20than\x20','WEBHOOK_RECEIVED','5EOCpPW','toISOString','shop_webhooks_sent','setDate','mtime','loggerService','SHOP_WEBHOOK_ERROR','🧹\x20Cleaned\x20','LoggerService','filter','stringify','logShopWebhookError','existsSync','RESPONSE','COINTOPAY_STATUS_CHANGE','getLogStats','white_domain_responses','webhooks_processed','size','logWhiteDomainError','.log','5628879DQrwua','getLogFileName','49ocEqJd','WEBHOOK_ERROR','shop_webhooks_errors','webhooks_received','endsWith','writeLog','error','1788862olEPyq','logsDir','logWebhookError','join','logs','map'];a59_0x509d=function(){return _0x1e755b;};return a59_0x509d();}var __importDefault=this&&this[a59_0x30622d(0x8e)]||function(_0x129fce){return _0x129fce&&_0x129fce['__esModule']?_0x129fce:{'default':_0x129fce};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a59_0x30622d(0xaf)]=exports[a59_0x30622d(0xb2)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x30622d(0x81)));class LoggerService{constructor(){const _0x57b724=a59_0x30622d;this[_0x57b724(0xc9)]=path_1['default'][_0x57b724(0xcb)](process['cwd'](),_0x57b724(0xcc)),this[_0x57b724(0x82)]();}[a59_0x30622d(0x82)](){const _0x25d0ca=a59_0x30622d;!fs_1['default'][_0x25d0ca(0xb6)](this['logsDir'])&&(fs_1['default'][_0x25d0ca(0x98)](this[_0x25d0ca(0xc9)],{'recursive':!![]}),console[_0x25d0ca(0x83)](_0x25d0ca(0x9c)+this[_0x25d0ca(0xc9)]));}[a59_0x30622d(0xc0)](_0x1bd948){const _0x51d12e=a59_0x30622d,_0x1a627b=new Date()[_0x51d12e(0xab)]()[_0x51d12e(0x96)]('T')[0x0];return path_1[_0x51d12e(0xa0)]['join'](this[_0x51d12e(0xc9)],_0x1bd948+'_'+_0x1a627b+_0x51d12e(0xbe));}[a59_0x30622d(0xc6)](_0x35c1c9,_0x4b2962){const _0x545049=a59_0x30622d;try{const _0x1f9f04=new Date()[_0x545049(0xab)](),_0x459db4={'timestamp':_0x1f9f04,..._0x4b2962},_0xb3a106=JSON[_0x545049(0xb4)](_0x459db4)+'\x0a',_0x2f8484=this['getLogFileName'](_0x35c1c9);fs_1[_0x545049(0xa0)][_0x545049(0x87)](_0x2f8484,_0xb3a106,_0x545049(0x9b));}catch(_0x7f78eb){console[_0x545049(0xc7)](_0x545049(0x9a)+_0x35c1c9+_0x545049(0x92),_0x7f78eb);}}[a59_0x30622d(0xa3)](_0x177838,_0x4621a5,_0x21b5a9,_0x4f444f){const _0x4cf2c2=a59_0x30622d;this[_0x4cf2c2(0xc6)]('white_domain_requests',{'type':_0x4cf2c2(0xa5),'gateway':_0x177838,'endpoint':_0x4621a5,'method':_0x21b5a9,'data':_0x4f444f});}[a59_0x30622d(0x9f)](_0x378a5d,_0x16c950,_0x43c300,_0x36b913,_0x407413){const _0x3d0e37=a59_0x30622d;this['writeLog'](_0x3d0e37(0xba),{'type':_0x3d0e37(0xb7),'gateway':_0x378a5d,'endpoint':_0x16c950,'status':_0x43c300,'responseTime':_0x407413,'data':_0x36b913});}[a59_0x30622d(0xbd)](_0x41022f,_0x455563,_0x14515a){const _0x10156b=a59_0x30622d;this[_0x10156b(0xc6)]('white_domain_errors',{'type':_0x10156b(0x8f),'gateway':_0x41022f,'endpoint':_0x455563,'error':_0x14515a instanceof Error?{'message':_0x14515a['message'],'stack':_0x14515a[_0x10156b(0x84)]}:_0x14515a});}[a59_0x30622d(0x88)](_0x4f1aad,_0x5705cf,_0xfeb910){const _0x193c22=a59_0x30622d;this[_0x193c22(0xc6)](_0x193c22(0xc4),{'type':_0x193c22(0xa9),'gateway':_0x4f1aad,'headers':_0xfeb910,'data':_0x5705cf});}[a59_0x30622d(0x89)](_0x46a4fe,_0x51da78,_0x4d39d8,_0x4fed5c,_0x177686){const _0x595a2b=a59_0x30622d;this[_0x595a2b(0xc6)](_0x595a2b(0xbb),{'type':_0x595a2b(0x8a),'gateway':_0x46a4fe,'paymentId':_0x51da78,'oldStatus':_0x4d39d8,'newStatus':_0x4fed5c,'originalData':_0x177686});}[a59_0x30622d(0xca)](_0x21b78c,_0x24d7ae,_0x48b658){const _0x816405=a59_0x30622d;this['writeLog']('webhooks_errors',{'type':_0x816405(0xc2),'gateway':_0x21b78c,'error':_0x24d7ae instanceof Error?{'message':_0x24d7ae[_0x816405(0x9d)],'stack':_0x24d7ae[_0x816405(0x84)]}:_0x24d7ae,'originalData':_0x48b658});}[a59_0x30622d(0x99)](_0x37377b){const _0x16879e=a59_0x30622d;this[_0x16879e(0xc6)](_0x16879e(0x8b),{'type':_0x16879e(0xb8),..._0x37377b});}[a59_0x30622d(0xa6)](_0x3faae3){const _0x34ca95=a59_0x30622d;this[_0x34ca95(0xc6)]('cointopay_errors',{'type':_0x34ca95(0x8d),..._0x3faae3});}[a59_0x30622d(0xa2)](_0x1f3ddd,_0x1678ae,_0x5f27c5,_0x1acb81,_0x220580,_0x4ec1f7){const _0x352aaf=a59_0x30622d;this[_0x352aaf(0xc6)](_0x352aaf(0xac),{'type':_0x352aaf(0x7e),'shopId':_0x1f3ddd,'webhookUrl':_0x1678ae,'event':_0x5f27c5,'status':_0x1acb81,'responseTime':_0x220580,'payload':_0x4ec1f7});}[a59_0x30622d(0xb5)](_0x7578a0,_0xbfeab6,_0x4ff1c6,_0x12ed3e,_0x39bbb4){const _0x2db25f=a59_0x30622d;this[_0x2db25f(0xc6)](_0x2db25f(0xc3),{'type':_0x2db25f(0xb0),'shopId':_0x7578a0,'webhookUrl':_0xbfeab6,'event':_0x4ff1c6,'error':_0x12ed3e instanceof Error?{'message':_0x12ed3e[_0x2db25f(0x9d)],'stack':_0x12ed3e[_0x2db25f(0x84)]}:_0x12ed3e,'payload':_0x39bbb4});}['logPaymentCreated'](_0x1222d9,_0x5dedb0,_0x3339a8,_0x277c97,_0x5b0c4d){const _0x3c6248=a59_0x30622d;this[_0x3c6248(0xc6)](_0x3c6248(0x8c),{'type':_0x3c6248(0x90),'gateway':_0x1222d9,'paymentId':_0x5dedb0,'shopId':_0x3339a8,'amount':_0x277c97,'currency':_0x5b0c4d});}[a59_0x30622d(0xa7)](_0x4fd083,_0x3af781,_0x32fe01,_0x4f893a,_0x570703){const _0x177e99=a59_0x30622d;this['writeLog'](_0x177e99(0x85),{'type':'API_CALL','endpoint':_0x4fd083,'method':_0x3af781,'userId':_0x32fe01,'userRole':_0x4f893a,'requestData':_0x570703});}[a59_0x30622d(0xb9)](){const _0x3cd0e9=a59_0x30622d;try{const _0x3dd4ca=fs_1[_0x3cd0e9(0xa0)][_0x3cd0e9(0x97)](this[_0x3cd0e9(0xc9)]),_0x3dfe15=_0x3dd4ca[_0x3cd0e9(0xb3)](_0x31bb47=>_0x31bb47['endsWith'](_0x3cd0e9(0xbe))),_0x3fb25a=[...new Set(_0x3dfe15[_0x3cd0e9(0xcd)](_0x5e2ae3=>_0x5e2ae3[_0x3cd0e9(0x96)]('_')[0x0]))],_0xedb90e=_0x3dfe15['map'](_0x3d0568=>{const _0x2d287d=_0x3cd0e9,_0xe0100e=path_1['default'][_0x2d287d(0xcb)](this[_0x2d287d(0xc9)],_0x3d0568),_0x5161d9=fs_1[_0x2d287d(0xa0)]['statSync'](_0xe0100e),[_0x2793df,_0x24e5e2]=_0x3d0568['replace'](_0x2d287d(0xbe),'')[_0x2d287d(0x96)]('_');return{'type':_0x2793df,'date':_0x24e5e2,'size':_0x5161d9[_0x2d287d(0xbc)]};})['sort']((_0x161826,_0x29b926)=>_0x29b926[_0x3cd0e9(0xa1)]['localeCompare'](_0x161826['date']));return{'totalFiles':_0x3dfe15[_0x3cd0e9(0x7f)],'logTypes':_0x3fb25a,'latestLogs':_0xedb90e['slice'](0x0,0xa)};}catch(_0x31eb0e){return console[_0x3cd0e9(0xc7)]('Failed\x20to\x20get\x20log\x20stats:',_0x31eb0e),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x30622d(0x91)](_0x4c4063=0x1e){const _0x2c6fa8=a59_0x30622d;try{const _0xd86d6=fs_1[_0x2c6fa8(0xa0)]['readdirSync'](this['logsDir']),_0x11f786=new Date();_0x11f786[_0x2c6fa8(0xad)](_0x11f786[_0x2c6fa8(0x94)]()-_0x4c4063);let _0x3bcfa6=0x0;_0xd86d6[_0x2c6fa8(0x9e)](_0x4ec119=>{const _0x19d6d6=_0x2c6fa8;if(!_0x4ec119[_0x19d6d6(0xc5)]('.log'))return;const _0x3acb86=path_1[_0x19d6d6(0xa0)][_0x19d6d6(0xcb)](this[_0x19d6d6(0xc9)],_0x4ec119),_0x3d985d=fs_1['default']['statSync'](_0x3acb86);_0x3d985d[_0x19d6d6(0xae)]<_0x11f786&&(fs_1[_0x19d6d6(0xa0)][_0x19d6d6(0x93)](_0x3acb86),_0x3bcfa6++,console[_0x19d6d6(0x83)](_0x19d6d6(0xce)+_0x4ec119));}),console[_0x2c6fa8(0x83)](_0x2c6fa8(0xb1)+_0x3bcfa6+_0x2c6fa8(0xa8)+_0x4c4063+'\x20days)');}catch(_0x1f3a83){console[_0x2c6fa8(0xc7)](_0x2c6fa8(0xa4),_0x1f3a83);}}}function a59_0xf169(_0x87c319,_0x47731e){const _0x509d21=a59_0x509d();return a59_0xf169=function(_0xf169a8,_0x573c3b){_0xf169a8=_0xf169a8-0x7c;let _0x128f0b=_0x509d21[_0xf169a8];return _0x128f0b;},a59_0xf169(_0x87c319,_0x47731e);}exports['LoggerService']=LoggerService,exports[a59_0x30622d(0xaf)]=new LoggerService();