'use strict';const a48_0x13ddda=a48_0x53e8;function a48_0x2fb5(){const _0x29cd3d=['sort','logCoinToPayStatus','logShopWebhookError','ERROR','loggerService','error','cointopay_errors','date','1124464WYpssF','forEach','payments_created','Failed\x20to\x20write\x20','shop_webhooks_sent','readdirSync','filter','map','logWhiteDomainRequest','WEBHOOK_PROCESSED','cwd','endsWith','webhooks_errors','121012dUyIwt','statSync','path','SHOP_WEBHOOK_ERROR','Failed\x20to\x20get\x20log\x20stats:','\x20days)','localeCompare','__esModule','WEBHOOK_ERROR','logWhiteDomainError','logs','LoggerService','join','logPaymentCreated','shop_webhooks_errors','logCoinToPayError','190TSRJYH','getLogStats','7805763NxriMf','logApiCall','cointopay_status_changes','COINTOPAY_ERROR','defineProperty','white_domain_errors','slice','getDate','unlinkSync','COINTOPAY_STATUS_CHANGE','6937080KHZBwd','ensureLogsDirectory','869410iMnYSL','3LzsCcq','white_domain_responses','mkdirSync','40714848OPpUfa','RESPONSE','appendFileSync','writeLog','getLogFileName','🧹\x20Cleaned\x20','logsDir','Failed\x20to\x20clean\x20old\x20logs:','size','split','logShopWebhookSent','logWhiteDomainResponse','📁\x20Created\x20logs\x20directory:\x20','cleanOldLogs','toISOString','9044120EiqjTT','default','🗑️\x20Deleted\x20old\x20log\x20file:\x20','white_domain_requests','SHOP_WEBHOOK_SENT','.log','log','message','\x20old\x20log\x20files\x20(older\x20than\x20','stack'];a48_0x2fb5=function(){return _0x29cd3d;};return a48_0x2fb5();}(function(_0x71562d,_0x4a58aa){const _0x909999=a48_0x53e8,_0x12e508=_0x71562d();while(!![]){try{const _0x278dcc=-parseInt(_0x909999(0x1e0))/0x1+-parseInt(_0x909999(0x205))/0x2*(parseInt(_0x909999(0x1e1))/0x3)+-parseInt(_0x909999(0x212))/0x4*(parseInt(_0x909999(0x222))/0x5)+parseInt(_0x909999(0x1de))/0x6+-parseInt(_0x909999(0x224))/0x7+-parseInt(_0x909999(0x1f3))/0x8+parseInt(_0x909999(0x1e4))/0x9;if(_0x278dcc===_0x4a58aa)break;else _0x12e508['push'](_0x12e508['shift']());}catch(_0x48d776){_0x12e508['push'](_0x12e508['shift']());}}}(a48_0x2fb5,0xd04b4));var __importDefault=this&&this['__importDefault']||function(_0x2f4072){const _0x314f1d=a48_0x53e8;return _0x2f4072&&_0x2f4072[_0x314f1d(0x219)]?_0x2f4072:{'default':_0x2f4072};};Object[a48_0x13ddda(0x228)](exports,a48_0x13ddda(0x219),{'value':!![]}),exports[a48_0x13ddda(0x201)]=exports[a48_0x13ddda(0x21d)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x13ddda(0x214)));class LoggerService{constructor(){const _0x133c06=a48_0x13ddda;this[_0x133c06(0x1ea)]=path_1[_0x133c06(0x1f4)][_0x133c06(0x21e)](process[_0x133c06(0x20f)](),_0x133c06(0x21c)),this[_0x133c06(0x1df)]();}['ensureLogsDirectory'](){const _0x39424e=a48_0x13ddda;!fs_1['default']['existsSync'](this[_0x39424e(0x1ea)])&&(fs_1[_0x39424e(0x1f4)][_0x39424e(0x1e3)](this[_0x39424e(0x1ea)],{'recursive':!![]}),console[_0x39424e(0x1f9)](_0x39424e(0x1f0)+this[_0x39424e(0x1ea)]));}[a48_0x13ddda(0x1e8)](_0x5bc00c){const _0x34728a=a48_0x13ddda,_0x55842f=new Date()[_0x34728a(0x1f2)]()[_0x34728a(0x1ed)]('T')[0x0];return path_1[_0x34728a(0x1f4)][_0x34728a(0x21e)](this[_0x34728a(0x1ea)],_0x5bc00c+'_'+_0x55842f+_0x34728a(0x1f8));}['writeLog'](_0x4f599e,_0x50539b){const _0x5eef58=a48_0x13ddda;try{const _0x232811=new Date()[_0x5eef58(0x1f2)](),_0x5d36ea={'timestamp':_0x232811,..._0x50539b},_0xe6da32=JSON['stringify'](_0x5d36ea)+'\x0a',_0x3b7ca7=this['getLogFileName'](_0x4f599e);fs_1[_0x5eef58(0x1f4)][_0x5eef58(0x1e6)](_0x3b7ca7,_0xe6da32,'utf8');}catch(_0xd1dc58){console[_0x5eef58(0x202)](_0x5eef58(0x208)+_0x4f599e+'\x20log:',_0xd1dc58);}}[a48_0x13ddda(0x20d)](_0x572ea4,_0xedb538,_0x57c0cb,_0x102244){const _0x1e8b6c=a48_0x13ddda;this['writeLog'](_0x1e8b6c(0x1f6),{'type':'REQUEST','gateway':_0x572ea4,'endpoint':_0xedb538,'method':_0x57c0cb,'data':_0x102244});}[a48_0x13ddda(0x1ef)](_0x34eb96,_0x2dafd0,_0x4ae754,_0x350a9b,_0x1cba8b){const _0x377c18=a48_0x13ddda;this['writeLog'](_0x377c18(0x1e2),{'type':_0x377c18(0x1e5),'gateway':_0x34eb96,'endpoint':_0x2dafd0,'status':_0x4ae754,'responseTime':_0x1cba8b,'data':_0x350a9b});}[a48_0x13ddda(0x21b)](_0x472114,_0x320beb,_0xc4c31c){const _0x3e5d6c=a48_0x13ddda;this[_0x3e5d6c(0x1e7)](_0x3e5d6c(0x229),{'type':_0x3e5d6c(0x200),'gateway':_0x472114,'endpoint':_0x320beb,'error':_0xc4c31c instanceof Error?{'message':_0xc4c31c[_0x3e5d6c(0x1fa)],'stack':_0xc4c31c['stack']}:_0xc4c31c});}['logWebhookReceived'](_0x51395c,_0x512827,_0x8a05c3){const _0x5b8b5b=a48_0x13ddda;this[_0x5b8b5b(0x1e7)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x51395c,'headers':_0x8a05c3,'data':_0x512827});}['logWebhookProcessed'](_0x27225a,_0x27a3ca,_0x827ee1,_0x7e2161,_0x41bdca){const _0x2c643b=a48_0x13ddda;this[_0x2c643b(0x1e7)]('webhooks_processed',{'type':_0x2c643b(0x20e),'gateway':_0x27225a,'paymentId':_0x27a3ca,'oldStatus':_0x827ee1,'newStatus':_0x7e2161,'originalData':_0x41bdca});}['logWebhookError'](_0x2e54dd,_0x33745c,_0x4fae28){const _0xbd228b=a48_0x13ddda;this['writeLog'](_0xbd228b(0x211),{'type':_0xbd228b(0x21a),'gateway':_0x2e54dd,'error':_0x33745c instanceof Error?{'message':_0x33745c[_0xbd228b(0x1fa)],'stack':_0x33745c[_0xbd228b(0x1fc)]}:_0x33745c,'originalData':_0x4fae28});}[a48_0x13ddda(0x1fe)](_0x5a0e41){const _0x504a4e=a48_0x13ddda;this[_0x504a4e(0x1e7)](_0x504a4e(0x226),{'type':_0x504a4e(0x1dd),..._0x5a0e41});}[a48_0x13ddda(0x221)](_0x2a7f8c){const _0xbe79c5=a48_0x13ddda;this[_0xbe79c5(0x1e7)](_0xbe79c5(0x203),{'type':_0xbe79c5(0x227),..._0x2a7f8c});}[a48_0x13ddda(0x1ee)](_0x4ad580,_0x53b8fe,_0x577761,_0x33e4d1,_0x463d48,_0x296ede){const _0x4afbdb=a48_0x13ddda;this[_0x4afbdb(0x1e7)](_0x4afbdb(0x209),{'type':_0x4afbdb(0x1f7),'shopId':_0x4ad580,'webhookUrl':_0x53b8fe,'event':_0x577761,'status':_0x33e4d1,'responseTime':_0x463d48,'payload':_0x296ede});}[a48_0x13ddda(0x1ff)](_0x16ff41,_0x238a8a,_0x8452d4,_0x23f478,_0x275ba8){const _0x3e468c=a48_0x13ddda;this[_0x3e468c(0x1e7)](_0x3e468c(0x220),{'type':_0x3e468c(0x215),'shopId':_0x16ff41,'webhookUrl':_0x238a8a,'event':_0x8452d4,'error':_0x23f478 instanceof Error?{'message':_0x23f478[_0x3e468c(0x1fa)],'stack':_0x23f478[_0x3e468c(0x1fc)]}:_0x23f478,'payload':_0x275ba8});}[a48_0x13ddda(0x21f)](_0x41c359,_0x105451,_0x4f2740,_0x3636ac,_0x4433fa){const _0x3b94e1=a48_0x13ddda;this[_0x3b94e1(0x1e7)](_0x3b94e1(0x207),{'type':'PAYMENT_CREATED','gateway':_0x41c359,'paymentId':_0x105451,'shopId':_0x4f2740,'amount':_0x3636ac,'currency':_0x4433fa});}[a48_0x13ddda(0x225)](_0xf48904,_0xfb5a,_0x59300a,_0xc84a93,_0x57aa37){const _0x1d1aa6=a48_0x13ddda;this[_0x1d1aa6(0x1e7)]('api_calls',{'type':'API_CALL','endpoint':_0xf48904,'method':_0xfb5a,'userId':_0x59300a,'userRole':_0xc84a93,'requestData':_0x57aa37});}[a48_0x13ddda(0x223)](){const _0x18e772=a48_0x13ddda;try{const _0x230310=fs_1[_0x18e772(0x1f4)][_0x18e772(0x20a)](this[_0x18e772(0x1ea)]),_0x35a487=_0x230310[_0x18e772(0x20b)](_0x748d13=>_0x748d13[_0x18e772(0x210)](_0x18e772(0x1f8))),_0x50ba48=[...new Set(_0x35a487[_0x18e772(0x20c)](_0x36f994=>_0x36f994['split']('_')[0x0]))],_0x1a48ce=_0x35a487[_0x18e772(0x20c)](_0x45020e=>{const _0xa3efc6=_0x18e772,_0x395cbb=path_1['default'][_0xa3efc6(0x21e)](this[_0xa3efc6(0x1ea)],_0x45020e),_0xd49563=fs_1[_0xa3efc6(0x1f4)][_0xa3efc6(0x213)](_0x395cbb),[_0x5abd40,_0x3487fa]=_0x45020e['replace'](_0xa3efc6(0x1f8),'')['split']('_');return{'type':_0x5abd40,'date':_0x3487fa,'size':_0xd49563[_0xa3efc6(0x1ec)]};})[_0x18e772(0x1fd)]((_0x41610d,_0x242739)=>_0x242739[_0x18e772(0x204)][_0x18e772(0x218)](_0x41610d[_0x18e772(0x204)]));return{'totalFiles':_0x35a487['length'],'logTypes':_0x50ba48,'latestLogs':_0x1a48ce[_0x18e772(0x1da)](0x0,0xa)};}catch(_0x37ae9d){return console[_0x18e772(0x202)](_0x18e772(0x216),_0x37ae9d),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x13ddda(0x1f1)](_0x3a487a=0x1e){const _0x4f1bff=a48_0x13ddda;try{const _0x22b17c=fs_1[_0x4f1bff(0x1f4)][_0x4f1bff(0x20a)](this[_0x4f1bff(0x1ea)]),_0x163d30=new Date();_0x163d30['setDate'](_0x163d30[_0x4f1bff(0x1db)]()-_0x3a487a);let _0x3f8e52=0x0;_0x22b17c[_0x4f1bff(0x206)](_0x185d36=>{const _0x3a56ff=_0x4f1bff;if(!_0x185d36[_0x3a56ff(0x210)]('.log'))return;const _0x462634=path_1['default'][_0x3a56ff(0x21e)](this[_0x3a56ff(0x1ea)],_0x185d36),_0x5aeae=fs_1[_0x3a56ff(0x1f4)][_0x3a56ff(0x213)](_0x462634);_0x5aeae['mtime']<_0x163d30&&(fs_1['default'][_0x3a56ff(0x1dc)](_0x462634),_0x3f8e52++,console[_0x3a56ff(0x1f9)](_0x3a56ff(0x1f5)+_0x185d36));}),console[_0x4f1bff(0x1f9)](_0x4f1bff(0x1e9)+_0x3f8e52+_0x4f1bff(0x1fb)+_0x3a487a+_0x4f1bff(0x217));}catch(_0x2a0655){console['error'](_0x4f1bff(0x1eb),_0x2a0655);}}}function a48_0x53e8(_0x401b82,_0x1c9cb7){const _0x2fb5c9=a48_0x2fb5();return a48_0x53e8=function(_0x53e804,_0x24d592){_0x53e804=_0x53e804-0x1da;let _0x389182=_0x2fb5c9[_0x53e804];return _0x389182;},a48_0x53e8(_0x401b82,_0x1c9cb7);}exports[a48_0x13ddda(0x21d)]=LoggerService,exports[a48_0x13ddda(0x201)]=new LoggerService();