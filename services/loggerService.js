'use strict';const a79_0x1312ea=a79_0x35bd;(function(_0x1aa3b0,_0x451337){const _0x4e3579=a79_0x35bd,_0x2c2cf6=_0x1aa3b0();while(!![]){try{const _0x4a06b2=-parseInt(_0x4e3579(0xf6))/0x1+-parseInt(_0x4e3579(0x115))/0x2+parseInt(_0x4e3579(0x137))/0x3*(-parseInt(_0x4e3579(0x114))/0x4)+parseInt(_0x4e3579(0x104))/0x5*(-parseInt(_0x4e3579(0x10b))/0x6)+parseInt(_0x4e3579(0x111))/0x7*(-parseInt(_0x4e3579(0xfe))/0x8)+-parseInt(_0x4e3579(0xff))/0x9*(-parseInt(_0x4e3579(0x144))/0xa)+parseInt(_0x4e3579(0x132))/0xb;if(_0x4a06b2===_0x451337)break;else _0x2c2cf6['push'](_0x2c2cf6['shift']());}catch(_0x3d5951){_0x2c2cf6['push'](_0x2c2cf6['shift']());}}}(a79_0x5e37,0xe5deb));function a79_0x5e37(){const _0x1924b5=['.log','getDate','stringify','logPaymentCreated','defineProperty','shop_webhooks_sent','cointopay_errors','4714990cIblcK','readdirSync','unlinkSync','1089261kXKTOV','Failed\x20to\x20get\x20log\x20stats:','cwd','webhooks_processed','WEBHOOK_ERROR','length','__esModule','existsSync','8kwzLNv','9jDzMto','ðŸ“\x20Created\x20logs\x20directory:\x20','replace','\x20days)','logWebhookError','270apWJEn','loggerService','size','map','\x20log:','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','logWhiteDomainRequest','176262cEMAYv','payments_created','appendFileSync','cointopay_status_changes','endsWith','white_domain_requests','2890454IusjHq','__importDefault','utf8','4TkYWjR','2171192ZFcYdq','COINTOPAY_STATUS_CHANGE','SHOP_WEBHOOK_SENT','getLogStats','REQUEST','statSync','stack','writeLog','COINTOPAY_ERROR','webhooks_received','default','message','WEBHOOK_PROCESSED','logCoinToPayStatus','split','log','LoggerService','localeCompare','mtime','logWhiteDomainResponse','logShopWebhookError','ensureLogsDirectory','\x20old\x20log\x20files\x20(older\x20than\x20','logWebhookProcessed','logsDir','forEach','filter','toISOString','path','55470822PSNXik','logApiCall','shop_webhooks_errors','logWebhookReceived','Failed\x20to\x20write\x20','1195851KJdkDt','error','webhooks_errors','Failed\x20to\x20clean\x20old\x20logs:','getLogFileName','join'];a79_0x5e37=function(){return _0x1924b5;};return a79_0x5e37();}function a79_0x35bd(_0x27e361,_0x5df014){_0x27e361=_0x27e361-0xf5;const _0x5e3748=a79_0x5e37();let _0x35bd18=_0x5e3748[_0x27e361];return _0x35bd18;}var __importDefault=this&&this[a79_0x1312ea(0x112)]||function(_0x47925d){const _0x4175a9=a79_0x1312ea;return _0x47925d&&_0x47925d[_0x4175a9(0xfc)]?_0x47925d:{'default':_0x47925d};};Object[a79_0x1312ea(0x141)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a79_0x1312ea(0x125)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x1312ea(0x131)));class LoggerService{constructor(){const _0x21d827=a79_0x1312ea;this[_0x21d827(0x12d)]=path_1[_0x21d827(0x11f)]['join'](process[_0x21d827(0xf8)](),'logs'),this[_0x21d827(0x12a)]();}[a79_0x1312ea(0x12a)](){const _0x36bdc4=a79_0x1312ea;!fs_1[_0x36bdc4(0x11f)][_0x36bdc4(0xfd)](this[_0x36bdc4(0x12d)])&&(fs_1[_0x36bdc4(0x11f)]['mkdirSync'](this[_0x36bdc4(0x12d)],{'recursive':!![]}),console['log'](_0x36bdc4(0x100)+this[_0x36bdc4(0x12d)]));}['getLogFileName'](_0x4d9d52){const _0x2e8f5b=a79_0x1312ea,_0x3a8690=new Date()[_0x2e8f5b(0x130)]()[_0x2e8f5b(0x123)]('T')[0x0];return path_1[_0x2e8f5b(0x11f)][_0x2e8f5b(0x13c)](this['logsDir'],_0x4d9d52+'_'+_0x3a8690+_0x2e8f5b(0x13d));}['writeLog'](_0x330ff5,_0x57e315){const _0x27396e=a79_0x1312ea;try{const _0x13b7a0=new Date()['toISOString'](),_0x37af54={'timestamp':_0x13b7a0,..._0x57e315},_0x321532=JSON[_0x27396e(0x13f)](_0x37af54)+'\x0a',_0x45c435=this[_0x27396e(0x13b)](_0x330ff5);fs_1[_0x27396e(0x11f)][_0x27396e(0x10d)](_0x45c435,_0x321532,_0x27396e(0x113));}catch(_0x57abe6){console['error'](_0x27396e(0x136)+_0x330ff5+_0x27396e(0x108),_0x57abe6);}}[a79_0x1312ea(0x10a)](_0x34a37b,_0x4a37e9,_0x4e2db6,_0x43e0b1){const _0x20d1f7=a79_0x1312ea;this[_0x20d1f7(0x11c)](_0x20d1f7(0x110),{'type':_0x20d1f7(0x119),'gateway':_0x34a37b,'endpoint':_0x4a37e9,'method':_0x4e2db6,'data':_0x43e0b1});}[a79_0x1312ea(0x128)](_0x35b03b,_0x3f1285,_0x7782d,_0x20b528,_0x463270){this['writeLog']('white_domain_responses',{'type':'RESPONSE','gateway':_0x35b03b,'endpoint':_0x3f1285,'status':_0x7782d,'responseTime':_0x463270,'data':_0x20b528});}['logWhiteDomainError'](_0x23aee4,_0xcc5ab1,_0x44be0f){const _0x311cfc=a79_0x1312ea;this[_0x311cfc(0x11c)]('white_domain_errors',{'type':'ERROR','gateway':_0x23aee4,'endpoint':_0xcc5ab1,'error':_0x44be0f instanceof Error?{'message':_0x44be0f[_0x311cfc(0x120)],'stack':_0x44be0f['stack']}:_0x44be0f});}[a79_0x1312ea(0x135)](_0x32cc68,_0x357d72,_0x101225){const _0x422eaa=a79_0x1312ea;this['writeLog'](_0x422eaa(0x11e),{'type':'WEBHOOK_RECEIVED','gateway':_0x32cc68,'headers':_0x101225,'data':_0x357d72});}[a79_0x1312ea(0x12c)](_0x2e013d,_0x1cdf56,_0x2f8f85,_0x19ea54,_0x406e40){const _0x4f9ab5=a79_0x1312ea;this['writeLog'](_0x4f9ab5(0xf9),{'type':_0x4f9ab5(0x121),'gateway':_0x2e013d,'paymentId':_0x1cdf56,'oldStatus':_0x2f8f85,'newStatus':_0x19ea54,'originalData':_0x406e40});}[a79_0x1312ea(0x103)](_0x5b073d,_0x31e80a,_0x5263d8){const _0xded192=a79_0x1312ea;this[_0xded192(0x11c)](_0xded192(0x139),{'type':_0xded192(0xfa),'gateway':_0x5b073d,'error':_0x31e80a instanceof Error?{'message':_0x31e80a[_0xded192(0x120)],'stack':_0x31e80a[_0xded192(0x11b)]}:_0x31e80a,'originalData':_0x5263d8});}[a79_0x1312ea(0x122)](_0x545f00){const _0x58cfa6=a79_0x1312ea;this[_0x58cfa6(0x11c)](_0x58cfa6(0x10e),{'type':_0x58cfa6(0x116),..._0x545f00});}['logCoinToPayError'](_0x58200f){const _0xcce7bf=a79_0x1312ea;this[_0xcce7bf(0x11c)](_0xcce7bf(0x143),{'type':_0xcce7bf(0x11d),..._0x58200f});}['logShopWebhookSent'](_0x5907b7,_0x289a31,_0x1aefd5,_0x191b9e,_0x2d1b43,_0x129711){const _0x3151bb=a79_0x1312ea;this[_0x3151bb(0x11c)](_0x3151bb(0x142),{'type':_0x3151bb(0x117),'shopId':_0x5907b7,'webhookUrl':_0x289a31,'event':_0x1aefd5,'status':_0x191b9e,'responseTime':_0x2d1b43,'payload':_0x129711});}[a79_0x1312ea(0x129)](_0x40fcdb,_0x4a2118,_0x396642,_0x33478f,_0x7f3d){const _0x63dee7=a79_0x1312ea;this[_0x63dee7(0x11c)](_0x63dee7(0x134),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x40fcdb,'webhookUrl':_0x4a2118,'event':_0x396642,'error':_0x33478f instanceof Error?{'message':_0x33478f[_0x63dee7(0x120)],'stack':_0x33478f[_0x63dee7(0x11b)]}:_0x33478f,'payload':_0x7f3d});}[a79_0x1312ea(0x140)](_0x18fa30,_0x171003,_0xf60b66,_0x24440e,_0x543c72){const _0x56ab91=a79_0x1312ea;this[_0x56ab91(0x11c)](_0x56ab91(0x10c),{'type':'PAYMENT_CREATED','gateway':_0x18fa30,'paymentId':_0x171003,'shopId':_0xf60b66,'amount':_0x24440e,'currency':_0x543c72});}[a79_0x1312ea(0x133)](_0x4af8a3,_0x4c8f23,_0x1acce9,_0x1a82ab,_0x2d04ac){const _0x463c0e=a79_0x1312ea;this[_0x463c0e(0x11c)]('api_calls',{'type':'API_CALL','endpoint':_0x4af8a3,'method':_0x4c8f23,'userId':_0x1acce9,'userRole':_0x1a82ab,'requestData':_0x2d04ac});}[a79_0x1312ea(0x118)](){const _0x20b23e=a79_0x1312ea;try{const _0x11b718=fs_1[_0x20b23e(0x11f)][_0x20b23e(0x145)](this[_0x20b23e(0x12d)]),_0x1d7e4e=_0x11b718[_0x20b23e(0x12f)](_0x2e2f20=>_0x2e2f20[_0x20b23e(0x10f)]('.log')),_0x544c93=[...new Set(_0x1d7e4e[_0x20b23e(0x107)](_0x39503f=>_0x39503f[_0x20b23e(0x123)]('_')[0x0]))],_0x3b1add=_0x1d7e4e[_0x20b23e(0x107)](_0xda6a5a=>{const _0x4d7a51=_0x20b23e,_0x410ee9=path_1[_0x4d7a51(0x11f)][_0x4d7a51(0x13c)](this[_0x4d7a51(0x12d)],_0xda6a5a),_0x47465b=fs_1[_0x4d7a51(0x11f)][_0x4d7a51(0x11a)](_0x410ee9),[_0x57bee0,_0x131202]=_0xda6a5a[_0x4d7a51(0x101)](_0x4d7a51(0x13d),'')['split']('_');return{'type':_0x57bee0,'date':_0x131202,'size':_0x47465b[_0x4d7a51(0x106)]};})['sort']((_0x444cbf,_0x24e345)=>_0x24e345['date'][_0x20b23e(0x126)](_0x444cbf['date']));return{'totalFiles':_0x1d7e4e[_0x20b23e(0xfb)],'logTypes':_0x544c93,'latestLogs':_0x3b1add['slice'](0x0,0xa)};}catch(_0x4f264c){return console[_0x20b23e(0x138)](_0x20b23e(0xf7),_0x4f264c),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x3374f7=0x1e){const _0x373b4a=a79_0x1312ea;try{const _0x2949eb=fs_1[_0x373b4a(0x11f)]['readdirSync'](this['logsDir']),_0x4bebb2=new Date();_0x4bebb2['setDate'](_0x4bebb2[_0x373b4a(0x13e)]()-_0x3374f7);let _0x832d00=0x0;_0x2949eb[_0x373b4a(0x12e)](_0x4f22cc=>{const _0x3c1ea0=_0x373b4a;if(!_0x4f22cc[_0x3c1ea0(0x10f)](_0x3c1ea0(0x13d)))return;const _0x674db=path_1[_0x3c1ea0(0x11f)]['join'](this['logsDir'],_0x4f22cc),_0x21e420=fs_1['default']['statSync'](_0x674db);_0x21e420[_0x3c1ea0(0x127)]<_0x4bebb2&&(fs_1[_0x3c1ea0(0x11f)][_0x3c1ea0(0xf5)](_0x674db),_0x832d00++,console[_0x3c1ea0(0x124)](_0x3c1ea0(0x109)+_0x4f22cc));}),console[_0x373b4a(0x124)]('ðŸ§¹\x20Cleaned\x20'+_0x832d00+_0x373b4a(0x12b)+_0x3374f7+_0x373b4a(0x102));}catch(_0xcdb35c){console[_0x373b4a(0x138)](_0x373b4a(0x13a),_0xcdb35c);}}}exports[a79_0x1312ea(0x125)]=LoggerService,exports[a79_0x1312ea(0x105)]=new LoggerService();