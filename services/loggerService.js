'use strict';const a48_0x1eff9c=a48_0x5220;(function(_0x532134,_0x36f327){const _0x5ef9a7=a48_0x5220,_0x2446b8=_0x532134();while(!![]){try{const _0xb9e655=-parseInt(_0x5ef9a7(0x207))/0x1+parseInt(_0x5ef9a7(0x208))/0x2+parseInt(_0x5ef9a7(0x232))/0x3+-parseInt(_0x5ef9a7(0x22e))/0x4+parseInt(_0x5ef9a7(0x203))/0x5+-parseInt(_0x5ef9a7(0x21d))/0x6+-parseInt(_0x5ef9a7(0x217))/0x7*(parseInt(_0x5ef9a7(0x204))/0x8);if(_0xb9e655===_0x36f327)break;else _0x2446b8['push'](_0x2446b8['shift']());}catch(_0x4ab7da){_0x2446b8['push'](_0x2446b8['shift']());}}}(a48_0x598d,0x1c668));function a48_0x5220(_0xb411dc,_0x26c896){const _0x598dc0=a48_0x598d();return a48_0x5220=function(_0x522004,_0x37f53e){_0x522004=_0x522004-0x1e5;let _0x58f6ad=_0x598dc0[_0x522004];return _0x58f6ad;},a48_0x5220(_0xb411dc,_0x26c896);}var __importDefault=this&&this[a48_0x1eff9c(0x1ee)]||function(_0x3b1879){const _0x675c6c=a48_0x1eff9c;return _0x3b1879&&_0x3b1879[_0x675c6c(0x215)]?_0x3b1879:{'default':_0x3b1879};};Object[a48_0x1eff9c(0x220)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;function a48_0x598d(){const _0x186019=['123192exqMBS','REQUEST','PAYMENT_CREATED','replace','385962CznTOh','getDate','white_domain_errors','stringify','writeLog','logShopWebhookError','webhooks_errors','logWhiteDomainRequest','toISOString','white_domain_requests','path','\x20old\x20log\x20files\x20(older\x20than\x20','🧹\x20Cleaned\x20','__importDefault','logsDir','default','join','unlinkSync','appendFileSync','size','RESPONSE','api_calls','cwd','slice','payments_created','webhooks_processed','readdirSync','length','cleanOldLogs','map','ERROR','log','SHOP_WEBHOOK_SENT','COINTOPAY_ERROR','1098330xsVzMH','8ctvvMj','API_CALL','WEBHOOK_RECEIVED','37083HSFctX','407644uRbyWu','WEBHOOK_ERROR','shop_webhooks_sent','getLogStats','cointopay_status_changes','filter','🗑️\x20Deleted\x20old\x20log\x20file:\x20','localeCompare','WEBHOOK_PROCESSED','stack','📁\x20Created\x20logs\x20directory:\x20','getLogFileName','message','__esModule','utf8','2565829RCwxmT','logs','white_domain_responses','.log','logWebhookReceived','LoggerService','8316ILhqGm','sort','loggerService','defineProperty','forEach','date','mkdirSync','logWebhookProcessed','existsSync','ensureLogsDirectory','webhooks_received','endsWith','error','shop_webhooks_errors','SHOP_WEBHOOK_ERROR','split','logCoinToPayStatus'];a48_0x598d=function(){return _0x186019;};return a48_0x598d();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x1eff9c(0x1eb)));class LoggerService{constructor(){const _0x2d2909=a48_0x1eff9c;this[_0x2d2909(0x1ef)]=path_1[_0x2d2909(0x1f0)][_0x2d2909(0x1f1)](process[_0x2d2909(0x1f7)](),_0x2d2909(0x218)),this[_0x2d2909(0x226)]();}[a48_0x1eff9c(0x226)](){const _0x5b6643=a48_0x1eff9c;!fs_1[_0x5b6643(0x1f0)][_0x5b6643(0x225)](this[_0x5b6643(0x1ef)])&&(fs_1[_0x5b6643(0x1f0)][_0x5b6643(0x223)](this[_0x5b6643(0x1ef)],{'recursive':!![]}),console[_0x5b6643(0x200)](_0x5b6643(0x212)+this[_0x5b6643(0x1ef)]));}[a48_0x1eff9c(0x213)](_0x40282a){const _0xafd8e6=a48_0x1eff9c,_0x3617f4=new Date()['toISOString']()[_0xafd8e6(0x22c)]('T')[0x0];return path_1['default']['join'](this['logsDir'],_0x40282a+'_'+_0x3617f4+'.log');}[a48_0x1eff9c(0x1e5)](_0x8a2353,_0x45c33d){const _0x2e5718=a48_0x1eff9c;try{const _0x1a4678=new Date()[_0x2e5718(0x1e9)](),_0x272c18={'timestamp':_0x1a4678,..._0x45c33d},_0x185edc=JSON[_0x2e5718(0x235)](_0x272c18)+'\x0a',_0x407adf=this['getLogFileName'](_0x8a2353);fs_1['default'][_0x2e5718(0x1f3)](_0x407adf,_0x185edc,_0x2e5718(0x216));}catch(_0x51faa1){console[_0x2e5718(0x229)]('Failed\x20to\x20write\x20'+_0x8a2353+'\x20log:',_0x51faa1);}}[a48_0x1eff9c(0x1e8)](_0x3e6974,_0x5da4d7,_0x1b7105,_0x202fbb){const _0x5c1e16=a48_0x1eff9c;this[_0x5c1e16(0x1e5)](_0x5c1e16(0x1ea),{'type':_0x5c1e16(0x22f),'gateway':_0x3e6974,'endpoint':_0x5da4d7,'method':_0x1b7105,'data':_0x202fbb});}['logWhiteDomainResponse'](_0x46347f,_0x98b65e,_0x2fd85c,_0x5ee4aa,_0x547c38){const _0x199d70=a48_0x1eff9c;this[_0x199d70(0x1e5)](_0x199d70(0x219),{'type':_0x199d70(0x1f5),'gateway':_0x46347f,'endpoint':_0x98b65e,'status':_0x2fd85c,'responseTime':_0x547c38,'data':_0x5ee4aa});}['logWhiteDomainError'](_0x5c0dca,_0x16ab62,_0x51dee0){const _0x5c57fd=a48_0x1eff9c;this[_0x5c57fd(0x1e5)](_0x5c57fd(0x234),{'type':_0x5c57fd(0x1ff),'gateway':_0x5c0dca,'endpoint':_0x16ab62,'error':_0x51dee0 instanceof Error?{'message':_0x51dee0[_0x5c57fd(0x214)],'stack':_0x51dee0['stack']}:_0x51dee0});}[a48_0x1eff9c(0x21b)](_0x46c8b1,_0x1996ea,_0x50e27a){const _0x428822=a48_0x1eff9c;this[_0x428822(0x1e5)](_0x428822(0x227),{'type':_0x428822(0x206),'gateway':_0x46c8b1,'headers':_0x50e27a,'data':_0x1996ea});}[a48_0x1eff9c(0x224)](_0x2fa3e0,_0x410920,_0x3742c9,_0x3af3a9,_0x132d66){const _0x5aca96=a48_0x1eff9c;this[_0x5aca96(0x1e5)](_0x5aca96(0x1fa),{'type':_0x5aca96(0x210),'gateway':_0x2fa3e0,'paymentId':_0x410920,'oldStatus':_0x3742c9,'newStatus':_0x3af3a9,'originalData':_0x132d66});}['logWebhookError'](_0x5eaf27,_0xafa5d6,_0x384086){const _0x1b98d9=a48_0x1eff9c;this['writeLog'](_0x1b98d9(0x1e7),{'type':_0x1b98d9(0x209),'gateway':_0x5eaf27,'error':_0xafa5d6 instanceof Error?{'message':_0xafa5d6[_0x1b98d9(0x214)],'stack':_0xafa5d6[_0x1b98d9(0x211)]}:_0xafa5d6,'originalData':_0x384086});}[a48_0x1eff9c(0x22d)](_0x2f3405){const _0x2ffaf7=a48_0x1eff9c;this['writeLog'](_0x2ffaf7(0x20c),{'type':'COINTOPAY_STATUS_CHANGE',..._0x2f3405});}['logCoinToPayError'](_0x7238b6){const _0x3252b4=a48_0x1eff9c;this['writeLog']('cointopay_errors',{'type':_0x3252b4(0x202),..._0x7238b6});}['logShopWebhookSent'](_0x4e8ba2,_0x2078b6,_0x8a1622,_0x5e2df3,_0x4665ad,_0xf42260){const _0x5ce960=a48_0x1eff9c;this[_0x5ce960(0x1e5)](_0x5ce960(0x20a),{'type':_0x5ce960(0x201),'shopId':_0x4e8ba2,'webhookUrl':_0x2078b6,'event':_0x8a1622,'status':_0x5e2df3,'responseTime':_0x4665ad,'payload':_0xf42260});}[a48_0x1eff9c(0x1e6)](_0x7abec,_0x2fd96d,_0x47dcde,_0x4a2289,_0xe3feb){const _0x3c0b26=a48_0x1eff9c;this[_0x3c0b26(0x1e5)](_0x3c0b26(0x22a),{'type':_0x3c0b26(0x22b),'shopId':_0x7abec,'webhookUrl':_0x2fd96d,'event':_0x47dcde,'error':_0x4a2289 instanceof Error?{'message':_0x4a2289[_0x3c0b26(0x214)],'stack':_0x4a2289[_0x3c0b26(0x211)]}:_0x4a2289,'payload':_0xe3feb});}['logPaymentCreated'](_0x1c947a,_0x208912,_0x1341b1,_0x2e9d1a,_0x48a31f){const _0x4120e8=a48_0x1eff9c;this[_0x4120e8(0x1e5)](_0x4120e8(0x1f9),{'type':_0x4120e8(0x230),'gateway':_0x1c947a,'paymentId':_0x208912,'shopId':_0x1341b1,'amount':_0x2e9d1a,'currency':_0x48a31f});}['logApiCall'](_0x1d9f58,_0x59dde6,_0x40a258,_0x4586b0,_0x254869){const _0x336d1b=a48_0x1eff9c;this[_0x336d1b(0x1e5)](_0x336d1b(0x1f6),{'type':_0x336d1b(0x205),'endpoint':_0x1d9f58,'method':_0x59dde6,'userId':_0x40a258,'userRole':_0x4586b0,'requestData':_0x254869});}[a48_0x1eff9c(0x20b)](){const _0x4ab3f9=a48_0x1eff9c;try{const _0xfc1e25=fs_1[_0x4ab3f9(0x1f0)][_0x4ab3f9(0x1fb)](this[_0x4ab3f9(0x1ef)]),_0x4aef4d=_0xfc1e25[_0x4ab3f9(0x20d)](_0xd9b827=>_0xd9b827[_0x4ab3f9(0x228)]('.log')),_0x3cf0dc=[...new Set(_0x4aef4d[_0x4ab3f9(0x1fe)](_0x326c92=>_0x326c92[_0x4ab3f9(0x22c)]('_')[0x0]))],_0x3b828d=_0x4aef4d['map'](_0x414d0b=>{const _0x201ba5=_0x4ab3f9,_0x2175fd=path_1[_0x201ba5(0x1f0)][_0x201ba5(0x1f1)](this[_0x201ba5(0x1ef)],_0x414d0b),_0x315f5d=fs_1[_0x201ba5(0x1f0)]['statSync'](_0x2175fd),[_0x2af50d,_0x23cf41]=_0x414d0b[_0x201ba5(0x231)](_0x201ba5(0x21a),'')[_0x201ba5(0x22c)]('_');return{'type':_0x2af50d,'date':_0x23cf41,'size':_0x315f5d[_0x201ba5(0x1f4)]};})[_0x4ab3f9(0x21e)]((_0x257d10,_0x1b3069)=>_0x1b3069[_0x4ab3f9(0x222)][_0x4ab3f9(0x20f)](_0x257d10['date']));return{'totalFiles':_0x4aef4d[_0x4ab3f9(0x1fc)],'logTypes':_0x3cf0dc,'latestLogs':_0x3b828d[_0x4ab3f9(0x1f8)](0x0,0xa)};}catch(_0x59c33b){return console[_0x4ab3f9(0x229)]('Failed\x20to\x20get\x20log\x20stats:',_0x59c33b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x1eff9c(0x1fd)](_0x2d21c7=0x1e){const _0x5bd420=a48_0x1eff9c;try{const _0x2d445a=fs_1[_0x5bd420(0x1f0)][_0x5bd420(0x1fb)](this[_0x5bd420(0x1ef)]),_0x198f00=new Date();_0x198f00['setDate'](_0x198f00[_0x5bd420(0x233)]()-_0x2d21c7);let _0x372238=0x0;_0x2d445a[_0x5bd420(0x221)](_0x1d9414=>{const _0x7e06db=_0x5bd420;if(!_0x1d9414['endsWith'](_0x7e06db(0x21a)))return;const _0x2bc7f3=path_1[_0x7e06db(0x1f0)][_0x7e06db(0x1f1)](this[_0x7e06db(0x1ef)],_0x1d9414),_0x32daac=fs_1['default']['statSync'](_0x2bc7f3);_0x32daac['mtime']<_0x198f00&&(fs_1[_0x7e06db(0x1f0)][_0x7e06db(0x1f2)](_0x2bc7f3),_0x372238++,console['log'](_0x7e06db(0x20e)+_0x1d9414));}),console[_0x5bd420(0x200)](_0x5bd420(0x1ed)+_0x372238+_0x5bd420(0x1ec)+_0x2d21c7+'\x20days)');}catch(_0x2f597b){console[_0x5bd420(0x229)]('Failed\x20to\x20clean\x20old\x20logs:',_0x2f597b);}}}exports[a48_0x1eff9c(0x21c)]=LoggerService,exports[a48_0x1eff9c(0x21f)]=new LoggerService();