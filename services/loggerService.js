'use strict';const a73_0x4c1e06=a73_0x227e;(function(_0x58c793,_0x2ee554){const _0xfd8896=a73_0x227e,_0x140814=_0x58c793();while(!![]){try{const _0x4932a9=-parseInt(_0xfd8896(0xde))/0x1+-parseInt(_0xfd8896(0xbe))/0x2+parseInt(_0xfd8896(0x9f))/0x3+-parseInt(_0xfd8896(0xb8))/0x4+-parseInt(_0xfd8896(0xc0))/0x5+parseInt(_0xfd8896(0xd3))/0x6*(parseInt(_0xfd8896(0xbd))/0x7)+parseInt(_0xfd8896(0xdb))/0x8;if(_0x4932a9===_0x2ee554)break;else _0x140814['push'](_0x140814['shift']());}catch(_0x3d2e2c){_0x140814['push'](_0x140814['shift']());}}}(a73_0x10e7,0x1a612));var __importDefault=this&&this[a73_0x4c1e06(0xa8)]||function(_0x3d5d97){const _0x41265d=a73_0x4c1e06;return _0x3d5d97&&_0x3d5d97[_0x41265d(0xb6)]?_0x3d5d97:{'default':_0x3d5d97};};Object[a73_0x4c1e06(0x9e)](exports,a73_0x4c1e06(0xb6),{'value':!![]}),exports['loggerService']=exports[a73_0x4c1e06(0xc3)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a73_0x4c1e06(0xb2)));class LoggerService{constructor(){const _0x34c5b7=a73_0x4c1e06;this[_0x34c5b7(0xe9)]=path_1[_0x34c5b7(0xd5)][_0x34c5b7(0xed)](process[_0x34c5b7(0xa9)](),_0x34c5b7(0xa5)),this['ensureLogsDirectory']();}[a73_0x4c1e06(0xaf)](){const _0xab0b65=a73_0x4c1e06;!fs_1['default']['existsSync'](this[_0xab0b65(0xe9)])&&(fs_1[_0xab0b65(0xd5)][_0xab0b65(0xb0)](this[_0xab0b65(0xe9)],{'recursive':!![]}),console[_0xab0b65(0xaa)]('ðŸ“\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a73_0x4c1e06(0x9c)](_0x1cf6e3){const _0x5ae2b7=a73_0x4c1e06,_0xe80d46=new Date()[_0x5ae2b7(0xd2)]()[_0x5ae2b7(0xb3)]('T')[0x0];return path_1[_0x5ae2b7(0xd5)][_0x5ae2b7(0xed)](this[_0x5ae2b7(0xe9)],_0x1cf6e3+'_'+_0xe80d46+_0x5ae2b7(0xdc));}[a73_0x4c1e06(0xe5)](_0x117c54,_0x2f5f53){const _0x1c0e27=a73_0x4c1e06;try{const _0x293900=new Date()[_0x1c0e27(0xd2)](),_0x11da2d={'timestamp':_0x293900,..._0x2f5f53},_0x452535=JSON[_0x1c0e27(0xb1)](_0x11da2d)+'\x0a',_0x16e82b=this[_0x1c0e27(0x9c)](_0x117c54);fs_1[_0x1c0e27(0xd5)][_0x1c0e27(0xbb)](_0x16e82b,_0x452535,'utf8');}catch(_0x1f4443){console[_0x1c0e27(0xe8)](_0x1c0e27(0xa3)+_0x117c54+_0x1c0e27(0xae),_0x1f4443);}}[a73_0x4c1e06(0xcc)](_0xf305af,_0x14eac0,_0x347fcf,_0x432496){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0xf305af,'endpoint':_0x14eac0,'method':_0x347fcf,'data':_0x432496});}[a73_0x4c1e06(0xdf)](_0x5317f9,_0x406c31,_0x4e4d1a,_0xd83a5c,_0x180d54){const _0x3dcc43=a73_0x4c1e06;this[_0x3dcc43(0xe5)](_0x3dcc43(0xe4),{'type':_0x3dcc43(0xc6),'gateway':_0x5317f9,'endpoint':_0x406c31,'status':_0x4e4d1a,'responseTime':_0x180d54,'data':_0xd83a5c});}[a73_0x4c1e06(0xca)](_0x3ff911,_0x2bd237,_0x5b6b7c){const _0x4c2a57=a73_0x4c1e06;this['writeLog'](_0x4c2a57(0xeb),{'type':'ERROR','gateway':_0x3ff911,'endpoint':_0x2bd237,'error':_0x5b6b7c instanceof Error?{'message':_0x5b6b7c['message'],'stack':_0x5b6b7c[_0x4c2a57(0xa7)]}:_0x5b6b7c});}[a73_0x4c1e06(0xd4)](_0xbb8572,_0x2e47fc,_0x3d5144){const _0x4e921c=a73_0x4c1e06;this[_0x4e921c(0xe5)](_0x4e921c(0xd9),{'type':'WEBHOOK_RECEIVED','gateway':_0xbb8572,'headers':_0x3d5144,'data':_0x2e47fc});}[a73_0x4c1e06(0xb7)](_0x581095,_0xce56d5,_0x3851fc,_0x2f3782,_0x8bfb06){const _0x4378ec=a73_0x4c1e06;this[_0x4378ec(0xe5)](_0x4378ec(0xc5),{'type':_0x4378ec(0xa6),'gateway':_0x581095,'paymentId':_0xce56d5,'oldStatus':_0x3851fc,'newStatus':_0x2f3782,'originalData':_0x8bfb06});}['logWebhookError'](_0xb3a2b6,_0x39e83d,_0xf2ff56){const _0x18bc1a=a73_0x4c1e06;this[_0x18bc1a(0xe5)](_0x18bc1a(0xa4),{'type':'WEBHOOK_ERROR','gateway':_0xb3a2b6,'error':_0x39e83d instanceof Error?{'message':_0x39e83d[_0x18bc1a(0xe1)],'stack':_0x39e83d['stack']}:_0x39e83d,'originalData':_0xf2ff56});}[a73_0x4c1e06(0xe6)](_0x4afc28){const _0x4f3739=a73_0x4c1e06;this[_0x4f3739(0xe5)]('cointopay_status_changes',{'type':_0x4f3739(0xd1),..._0x4afc28});}[a73_0x4c1e06(0xac)](_0xe2a145){const _0x2c2228=a73_0x4c1e06;this[_0x2c2228(0xe5)](_0x2c2228(0xcd),{'type':_0x2c2228(0xb9),..._0xe2a145});}[a73_0x4c1e06(0xa0)](_0x4b04fa,_0x11bb4a,_0x4879e8,_0x44412d,_0x4fb874,_0x275ff6){const _0x4dbd9f=a73_0x4c1e06;this[_0x4dbd9f(0xe5)](_0x4dbd9f(0xd0),{'type':_0x4dbd9f(0xbc),'shopId':_0x4b04fa,'webhookUrl':_0x11bb4a,'event':_0x4879e8,'status':_0x44412d,'responseTime':_0x4fb874,'payload':_0x275ff6});}['logShopWebhookError'](_0x490211,_0x1f8c9d,_0x34f7cd,_0x27417d,_0x592883){const _0x436296=a73_0x4c1e06;this['writeLog'](_0x436296(0xd7),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x490211,'webhookUrl':_0x1f8c9d,'event':_0x34f7cd,'error':_0x27417d instanceof Error?{'message':_0x27417d[_0x436296(0xe1)],'stack':_0x27417d[_0x436296(0xa7)]}:_0x27417d,'payload':_0x592883});}[a73_0x4c1e06(0xc7)](_0x2ebe9e,_0x3a73b1,_0x64d5f,_0x55b5b7,_0x186fbb){const _0x9d436b=a73_0x4c1e06;this[_0x9d436b(0xe5)](_0x9d436b(0xdd),{'type':_0x9d436b(0x9d),'gateway':_0x2ebe9e,'paymentId':_0x3a73b1,'shopId':_0x64d5f,'amount':_0x55b5b7,'currency':_0x186fbb});}[a73_0x4c1e06(0xe7)](_0x3e2348,_0x4dec04,_0x5b0e31,_0xf773ca,_0x236f0b){const _0x2bbd97=a73_0x4c1e06;this[_0x2bbd97(0xe5)]('api_calls',{'type':_0x2bbd97(0xb5),'endpoint':_0x3e2348,'method':_0x4dec04,'userId':_0x5b0e31,'userRole':_0xf773ca,'requestData':_0x236f0b});}[a73_0x4c1e06(0xba)](){const _0x2a8da0=a73_0x4c1e06;try{const _0x42d7c6=fs_1[_0x2a8da0(0xd5)][_0x2a8da0(0xc4)](this[_0x2a8da0(0xe9)]),_0x23ddce=_0x42d7c6[_0x2a8da0(0xc1)](_0x19c082=>_0x19c082[_0x2a8da0(0xce)]('.log')),_0xa3260c=[...new Set(_0x23ddce[_0x2a8da0(0xc8)](_0x2e8fc4=>_0x2e8fc4['split']('_')[0x0]))],_0x2ad158=_0x23ddce['map'](_0x490716=>{const _0xe0e942=_0x2a8da0,_0x2b68cf=path_1['default'][_0xe0e942(0xed)](this[_0xe0e942(0xe9)],_0x490716),_0x3e46a4=fs_1[_0xe0e942(0xd5)][_0xe0e942(0xa2)](_0x2b68cf),[_0x5beefc,_0x4b6290]=_0x490716['replace']('.log','')[_0xe0e942(0xb3)]('_');return{'type':_0x5beefc,'date':_0x4b6290,'size':_0x3e46a4[_0xe0e942(0xcf)]};})[_0x2a8da0(0xab)]((_0x1bbf29,_0xbf6692)=>_0xbf6692[_0x2a8da0(0xcb)][_0x2a8da0(0xb4)](_0x1bbf29[_0x2a8da0(0xcb)]));return{'totalFiles':_0x23ddce[_0x2a8da0(0xea)],'logTypes':_0xa3260c,'latestLogs':_0x2ad158[_0x2a8da0(0xd6)](0x0,0xa)};}catch(_0x224cd9){return console['error'](_0x2a8da0(0xc2),_0x224cd9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a73_0x4c1e06(0xd8)](_0x28e00f=0x1e){const _0xdbc381=a73_0x4c1e06;try{const _0x3f7bf5=fs_1[_0xdbc381(0xd5)][_0xdbc381(0xc4)](this[_0xdbc381(0xe9)]),_0x6ff3f2=new Date();_0x6ff3f2['setDate'](_0x6ff3f2[_0xdbc381(0xda)]()-_0x28e00f);let _0x329e2e=0x0;_0x3f7bf5['forEach'](_0x30ad3c=>{const _0x4a08c6=_0xdbc381;if(!_0x30ad3c[_0x4a08c6(0xce)](_0x4a08c6(0xdc)))return;const _0xe7818=path_1[_0x4a08c6(0xd5)][_0x4a08c6(0xed)](this[_0x4a08c6(0xe9)],_0x30ad3c),_0x202e0b=fs_1[_0x4a08c6(0xd5)][_0x4a08c6(0xa2)](_0xe7818);_0x202e0b[_0x4a08c6(0xe3)]<_0x6ff3f2&&(fs_1[_0x4a08c6(0xd5)][_0x4a08c6(0xbf)](_0xe7818),_0x329e2e++,console[_0x4a08c6(0xaa)](_0x4a08c6(0xec)+_0x30ad3c));}),console[_0xdbc381(0xaa)](_0xdbc381(0xa1)+_0x329e2e+_0xdbc381(0xe0)+_0x28e00f+_0xdbc381(0xe2));}catch(_0x4f3515){console[_0xdbc381(0xe8)](_0xdbc381(0xad),_0x4f3515);}}}function a73_0x227e(_0x2b199e,_0x5a7487){_0x2b199e=_0x2b199e-0x9c;const _0x10e79f=a73_0x10e7();let _0x227e7e=_0x10e79f[_0x2b199e];return _0x227e7e;}function a73_0x10e7(){const _0x379cf=['logsDir','length','white_domain_errors','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','join','getLogFileName','PAYMENT_CREATED','defineProperty','413763Gbymmk','logShopWebhookSent','ðŸ§¹\x20Cleaned\x20','statSync','Failed\x20to\x20write\x20','webhooks_errors','logs','WEBHOOK_PROCESSED','stack','__importDefault','cwd','log','sort','logCoinToPayError','Failed\x20to\x20clean\x20old\x20logs:','\x20log:','ensureLogsDirectory','mkdirSync','stringify','path','split','localeCompare','API_CALL','__esModule','logWebhookProcessed','853056CeVKZz','COINTOPAY_ERROR','getLogStats','appendFileSync','SHOP_WEBHOOK_SENT','7LzsWec','24718CelDiR','unlinkSync','377695nLbFpI','filter','Failed\x20to\x20get\x20log\x20stats:','LoggerService','readdirSync','webhooks_processed','RESPONSE','logPaymentCreated','map','loggerService','logWhiteDomainError','date','logWhiteDomainRequest','cointopay_errors','endsWith','size','shop_webhooks_sent','COINTOPAY_STATUS_CHANGE','toISOString','830778YVHOWo','logWebhookReceived','default','slice','shop_webhooks_errors','cleanOldLogs','webhooks_received','getDate','1983280JVqzua','.log','payments_created','115082iiyGXN','logWhiteDomainResponse','\x20old\x20log\x20files\x20(older\x20than\x20','message','\x20days)','mtime','white_domain_responses','writeLog','logCoinToPayStatus','logApiCall','error'];a73_0x10e7=function(){return _0x379cf;};return a73_0x10e7();}exports[a73_0x4c1e06(0xc3)]=LoggerService,exports[a73_0x4c1e06(0xc9)]=new LoggerService();