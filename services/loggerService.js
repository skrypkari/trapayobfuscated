'use strict';const a49_0x3d6d89=a49_0x333e;function a49_0x333e(_0x57f968,_0x29f7d9){const _0x28ceae=a49_0x28ce();return a49_0x333e=function(_0x333eeb,_0x33a404){_0x333eeb=_0x333eeb-0x190;let _0x352b92=_0x28ceae[_0x333eeb];return _0x352b92;},a49_0x333e(_0x57f968,_0x29f7d9);}(function(_0x54feba,_0x590377){const _0x19064d=a49_0x333e,_0x3addfc=_0x54feba();while(!![]){try{const _0x1ce3f5=-parseInt(_0x19064d(0x1cf))/0x1*(-parseInt(_0x19064d(0x1b7))/0x2)+-parseInt(_0x19064d(0x1c0))/0x3*(parseInt(_0x19064d(0x1d4))/0x4)+-parseInt(_0x19064d(0x1a4))/0x5+-parseInt(_0x19064d(0x199))/0x6*(-parseInt(_0x19064d(0x1e4))/0x7)+parseInt(_0x19064d(0x19f))/0x8+-parseInt(_0x19064d(0x1ba))/0x9*(parseInt(_0x19064d(0x1dd))/0xa)+parseInt(_0x19064d(0x198))/0xb*(parseInt(_0x19064d(0x1bb))/0xc);if(_0x1ce3f5===_0x590377)break;else _0x3addfc['push'](_0x3addfc['shift']());}catch(_0x1e1500){_0x3addfc['push'](_0x3addfc['shift']());}}}(a49_0x28ce,0x85dd5));var __importDefault=this&&this[a49_0x3d6d89(0x1a9)]||function(_0x44c0dc){const _0x165e85=a49_0x3d6d89;return _0x44c0dc&&_0x44c0dc[_0x165e85(0x1c6)]?_0x44c0dc:{'default':_0x44c0dc};};Object[a49_0x3d6d89(0x1aa)](exports,a49_0x3d6d89(0x1c6),{'value':!![]}),exports[a49_0x3d6d89(0x1c8)]=exports[a49_0x3d6d89(0x1d2)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x3d6d89(0x1a5)));function a49_0x28ce(){const _0x28a68b=['cleanOldLogs','SHOP_WEBHOOK_SENT','logsDir','COINTOPAY_STATUS_CHANGE','cwd','8712000nyaoQP','Failed\x20to\x20clean\x20old\x20logs:','default','logPaymentCreated','webhooks_received','5207025wysrft','path','logCoinToPayError','white_domain_errors','split','__importDefault','defineProperty','\x20old\x20log\x20files\x20(older\x20than\x20','COINTOPAY_ERROR','logWhiteDomainRequest','logs','RESPONSE','endsWith','map','api_calls','📁\x20Created\x20logs\x20directory:\x20','utf8','statSync','replace','51018ordASy','\x20log:','getLogStats','3231XjWGkE','228saFCNY','slice','payments_created','logWebhookProcessed','getLogFileName','3kfmroZ','🧹\x20Cleaned\x20','Failed\x20to\x20get\x20log\x20stats:','ensureLogsDirectory','REQUEST','unlinkSync','__esModule','shop_webhooks_errors','loggerService','webhooks_errors','readdirSync','error','cointopay_errors','mtime','date','24LqBYly','\x20days)','join','LoggerService','toISOString','3919140VxOxHh','writeLog','WEBHOOK_RECEIVED','white_domain_requests','stack','message','webhooks_processed','SHOP_WEBHOOK_ERROR','stringify','3430MZpxNm','WEBHOOK_PROCESSED','existsSync','filter','logCoinToPayStatus','logWhiteDomainResponse','sort','7aCDeek','shop_webhooks_sent','logWhiteDomainError','logApiCall','🗑️\x20Deleted\x20old\x20log\x20file:\x20','localeCompare','logShopWebhookError','.log','API_CALL','log','WEBHOOK_ERROR','forEach','white_domain_responses','102223qLjXFT','4889118ZeWhlz'];a49_0x28ce=function(){return _0x28a68b;};return a49_0x28ce();}class LoggerService{constructor(){const _0x5598be=a49_0x3d6d89;this['logsDir']=path_1[_0x5598be(0x1a1)][_0x5598be(0x1d1)](process[_0x5598be(0x19e)](),_0x5598be(0x1ae)),this[_0x5598be(0x1c3)]();}[a49_0x3d6d89(0x1c3)](){const _0x49b1c2=a49_0x3d6d89;!fs_1[_0x49b1c2(0x1a1)][_0x49b1c2(0x1df)](this['logsDir'])&&(fs_1[_0x49b1c2(0x1a1)]['mkdirSync'](this[_0x49b1c2(0x19c)],{'recursive':!![]}),console[_0x49b1c2(0x194)](_0x49b1c2(0x1b3)+this['logsDir']));}['getLogFileName'](_0x50d228){const _0x5c2628=a49_0x3d6d89,_0x74f7de=new Date()[_0x5c2628(0x1d3)]()[_0x5c2628(0x1a8)]('T')[0x0];return path_1[_0x5c2628(0x1a1)]['join'](this['logsDir'],_0x50d228+'_'+_0x74f7de+_0x5c2628(0x192));}[a49_0x3d6d89(0x1d5)](_0x54eff9,_0x31dc5e){const _0x181204=a49_0x3d6d89;try{const _0x139e96=new Date()[_0x181204(0x1d3)](),_0xd3eff2={'timestamp':_0x139e96,..._0x31dc5e},_0x21be6b=JSON[_0x181204(0x1dc)](_0xd3eff2)+'\x0a',_0x4de909=this[_0x181204(0x1bf)](_0x54eff9);fs_1[_0x181204(0x1a1)]['appendFileSync'](_0x4de909,_0x21be6b,_0x181204(0x1b4));}catch(_0x29e571){console[_0x181204(0x1cb)]('Failed\x20to\x20write\x20'+_0x54eff9+_0x181204(0x1b8),_0x29e571);}}[a49_0x3d6d89(0x1ad)](_0xd354b8,_0x42b191,_0x1e38bb,_0x5f4450){const _0x5ab661=a49_0x3d6d89;this[_0x5ab661(0x1d5)](_0x5ab661(0x1d7),{'type':_0x5ab661(0x1c4),'gateway':_0xd354b8,'endpoint':_0x42b191,'method':_0x1e38bb,'data':_0x5f4450});}[a49_0x3d6d89(0x1e2)](_0xe17fb0,_0x628879,_0x341a01,_0x5d646c,_0x2c5c07){const _0x41d509=a49_0x3d6d89;this['writeLog'](_0x41d509(0x197),{'type':_0x41d509(0x1af),'gateway':_0xe17fb0,'endpoint':_0x628879,'status':_0x341a01,'responseTime':_0x2c5c07,'data':_0x5d646c});}[a49_0x3d6d89(0x1e6)](_0x24ec02,_0x18a32a,_0x35c023){const _0x35af19=a49_0x3d6d89;this[_0x35af19(0x1d5)](_0x35af19(0x1a7),{'type':'ERROR','gateway':_0x24ec02,'endpoint':_0x18a32a,'error':_0x35c023 instanceof Error?{'message':_0x35c023[_0x35af19(0x1d9)],'stack':_0x35c023['stack']}:_0x35c023});}['logWebhookReceived'](_0x29f1f5,_0x3d142a,_0x366546){const _0x323f0b=a49_0x3d6d89;this[_0x323f0b(0x1d5)](_0x323f0b(0x1a3),{'type':_0x323f0b(0x1d6),'gateway':_0x29f1f5,'headers':_0x366546,'data':_0x3d142a});}[a49_0x3d6d89(0x1be)](_0x15037e,_0x2b8704,_0x4e6c80,_0x323441,_0x5ab3ac){const _0x128fd6=a49_0x3d6d89;this[_0x128fd6(0x1d5)](_0x128fd6(0x1da),{'type':_0x128fd6(0x1de),'gateway':_0x15037e,'paymentId':_0x2b8704,'oldStatus':_0x4e6c80,'newStatus':_0x323441,'originalData':_0x5ab3ac});}['logWebhookError'](_0x5157e9,_0x346e6a,_0x53b912){const _0x123589=a49_0x3d6d89;this[_0x123589(0x1d5)](_0x123589(0x1c9),{'type':_0x123589(0x195),'gateway':_0x5157e9,'error':_0x346e6a instanceof Error?{'message':_0x346e6a[_0x123589(0x1d9)],'stack':_0x346e6a[_0x123589(0x1d8)]}:_0x346e6a,'originalData':_0x53b912});}[a49_0x3d6d89(0x1e1)](_0x450862){const _0x3a13da=a49_0x3d6d89;this[_0x3a13da(0x1d5)]('cointopay_status_changes',{'type':_0x3a13da(0x19d),..._0x450862});}[a49_0x3d6d89(0x1a6)](_0x2b5768){const _0x2659c5=a49_0x3d6d89;this[_0x2659c5(0x1d5)](_0x2659c5(0x1cc),{'type':_0x2659c5(0x1ac),..._0x2b5768});}['logShopWebhookSent'](_0x37ae53,_0x4a9668,_0x419ffb,_0x4d4dc7,_0x5b7898,_0x2ee278){const _0x3b2440=a49_0x3d6d89;this[_0x3b2440(0x1d5)](_0x3b2440(0x1e5),{'type':_0x3b2440(0x19b),'shopId':_0x37ae53,'webhookUrl':_0x4a9668,'event':_0x419ffb,'status':_0x4d4dc7,'responseTime':_0x5b7898,'payload':_0x2ee278});}[a49_0x3d6d89(0x191)](_0x4e1925,_0x356855,_0x478a34,_0x1af622,_0x444def){const _0x36d44e=a49_0x3d6d89;this[_0x36d44e(0x1d5)](_0x36d44e(0x1c7),{'type':_0x36d44e(0x1db),'shopId':_0x4e1925,'webhookUrl':_0x356855,'event':_0x478a34,'error':_0x1af622 instanceof Error?{'message':_0x1af622[_0x36d44e(0x1d9)],'stack':_0x1af622['stack']}:_0x1af622,'payload':_0x444def});}[a49_0x3d6d89(0x1a2)](_0x227080,_0x5226e4,_0x75602,_0x5e9bde,_0x7ed939){const _0x95c6e8=a49_0x3d6d89;this[_0x95c6e8(0x1d5)](_0x95c6e8(0x1bd),{'type':'PAYMENT_CREATED','gateway':_0x227080,'paymentId':_0x5226e4,'shopId':_0x75602,'amount':_0x5e9bde,'currency':_0x7ed939});}[a49_0x3d6d89(0x1e7)](_0x5c4249,_0x1584b7,_0x1ce5c2,_0x321864,_0x30a807){const _0x3ec739=a49_0x3d6d89;this[_0x3ec739(0x1d5)](_0x3ec739(0x1b2),{'type':_0x3ec739(0x193),'endpoint':_0x5c4249,'method':_0x1584b7,'userId':_0x1ce5c2,'userRole':_0x321864,'requestData':_0x30a807});}[a49_0x3d6d89(0x1b9)](){const _0x5d9aad=a49_0x3d6d89;try{const _0x20d038=fs_1['default'][_0x5d9aad(0x1ca)](this['logsDir']),_0x28ebc4=_0x20d038[_0x5d9aad(0x1e0)](_0x705a82=>_0x705a82[_0x5d9aad(0x1b0)](_0x5d9aad(0x192))),_0x50575b=[...new Set(_0x28ebc4[_0x5d9aad(0x1b1)](_0x35aedd=>_0x35aedd['split']('_')[0x0]))],_0x306a18=_0x28ebc4[_0x5d9aad(0x1b1)](_0x1b7308=>{const _0x178286=_0x5d9aad,_0x4e6e39=path_1[_0x178286(0x1a1)][_0x178286(0x1d1)](this[_0x178286(0x19c)],_0x1b7308),_0xe076df=fs_1[_0x178286(0x1a1)]['statSync'](_0x4e6e39),[_0x5849cb,_0x498eeb]=_0x1b7308[_0x178286(0x1b6)](_0x178286(0x192),'')[_0x178286(0x1a8)]('_');return{'type':_0x5849cb,'date':_0x498eeb,'size':_0xe076df['size']};})[_0x5d9aad(0x1e3)]((_0x3e29c7,_0x4ef2dd)=>_0x4ef2dd['date'][_0x5d9aad(0x190)](_0x3e29c7[_0x5d9aad(0x1ce)]));return{'totalFiles':_0x28ebc4['length'],'logTypes':_0x50575b,'latestLogs':_0x306a18[_0x5d9aad(0x1bc)](0x0,0xa)};}catch(_0x3120ec){return console['error'](_0x5d9aad(0x1c2),_0x3120ec),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x3d6d89(0x19a)](_0x473d4e=0x1e){const _0x3ea93d=a49_0x3d6d89;try{const _0x22cd3c=fs_1[_0x3ea93d(0x1a1)]['readdirSync'](this[_0x3ea93d(0x19c)]),_0x5f3755=new Date();_0x5f3755['setDate'](_0x5f3755['getDate']()-_0x473d4e);let _0x10ce37=0x0;_0x22cd3c[_0x3ea93d(0x196)](_0x459028=>{const _0x4a7c40=_0x3ea93d;if(!_0x459028[_0x4a7c40(0x1b0)]('.log'))return;const _0x45ecab=path_1[_0x4a7c40(0x1a1)][_0x4a7c40(0x1d1)](this['logsDir'],_0x459028),_0x94aec0=fs_1['default'][_0x4a7c40(0x1b5)](_0x45ecab);_0x94aec0[_0x4a7c40(0x1cd)]<_0x5f3755&&(fs_1[_0x4a7c40(0x1a1)][_0x4a7c40(0x1c5)](_0x45ecab),_0x10ce37++,console[_0x4a7c40(0x194)](_0x4a7c40(0x1e8)+_0x459028));}),console[_0x3ea93d(0x194)](_0x3ea93d(0x1c1)+_0x10ce37+_0x3ea93d(0x1ab)+_0x473d4e+_0x3ea93d(0x1d0));}catch(_0x361c68){console[_0x3ea93d(0x1cb)](_0x3ea93d(0x1a0),_0x361c68);}}}exports[a49_0x3d6d89(0x1d2)]=LoggerService,exports[a49_0x3d6d89(0x1c8)]=new LoggerService();