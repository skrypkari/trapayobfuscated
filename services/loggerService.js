'use strict';const a79_0x34020b=a79_0x14d3;(function(_0x5574a8,_0x141981){const _0x4f8cfe=a79_0x14d3,_0x20a0e3=_0x5574a8();while(!![]){try{const _0x117bd0=parseInt(_0x4f8cfe(0x238))/0x1*(-parseInt(_0x4f8cfe(0x1f5))/0x2)+-parseInt(_0x4f8cfe(0x234))/0x3*(-parseInt(_0x4f8cfe(0x21b))/0x4)+-parseInt(_0x4f8cfe(0x214))/0x5*(parseInt(_0x4f8cfe(0x218))/0x6)+-parseInt(_0x4f8cfe(0x1fe))/0x7*(parseInt(_0x4f8cfe(0x20a))/0x8)+parseInt(_0x4f8cfe(0x1ff))/0x9*(parseInt(_0x4f8cfe(0x220))/0xa)+-parseInt(_0x4f8cfe(0x1f4))/0xb*(parseInt(_0x4f8cfe(0x229))/0xc)+parseInt(_0x4f8cfe(0x1ef))/0xd*(parseInt(_0x4f8cfe(0x21f))/0xe);if(_0x117bd0===_0x141981)break;else _0x20a0e3['push'](_0x20a0e3['shift']());}catch(_0x8622d5){_0x20a0e3['push'](_0x20a0e3['shift']());}}}(a79_0x488e,0x7f1d8));var __importDefault=this&&this['__importDefault']||function(_0x2f9bc2){const _0x241e13=a79_0x14d3;return _0x2f9bc2&&_0x2f9bc2[_0x241e13(0x217)]?_0x2f9bc2:{'default':_0x2f9bc2};};function a79_0x488e(){const _0x30d01b=['sort','setDate','ensureLogsDirectory','payments_created','\x20old\x20log\x20files\x20(older\x20than\x20','Failed\x20to\x20clean\x20old\x20logs:','defineProperty','white_domain_errors','1976zymFlf','webhooks_processed','.log','logWebhookProcessed','getDate','WEBHOOK_RECEIVED','webhooks_received','default','WEBHOOK_PROCESSED','getLogStats','5IuqeTH','REQUEST','endsWith','__esModule','1422474trEmYW','toISOString','logCoinToPayStatus','4CysFfk','logWebhookReceived','map','RESPONSE','4228LosQUt','18670GWqHUk','filter','Failed\x20to\x20write\x20','message','path','getLogFileName','shop_webhooks_errors','statSync','logs','96NFuaaW','length','api_calls','logWebhookError','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','slice','writeLog','API_CALL','stringify','logShopWebhookError','webhooks_errors','48786coBicq','ðŸ“\x20Created\x20logs\x20directory:\x20','logsDir','logApiCall','298119TqsUUq','replace','utf8','cleanOldLogs','error','SHOP_WEBHOOK_SENT','size','log','logCoinToPayError','logShopWebhookSent','99424PhTKfT','LoggerService','forEach','stack','logWhiteDomainRequest','928114oiYQro','2HJRePg','loggerService','white_domain_responses','mtime','split','PAYMENT_CREATED','logWhiteDomainError','join','ðŸ§¹\x20Cleaned\x20','18823wjmDGk','333jmTCmy','date','white_domain_requests'];a79_0x488e=function(){return _0x30d01b;};return a79_0x488e();}Object[a79_0x34020b(0x208)](exports,a79_0x34020b(0x217),{'value':!![]}),exports[a79_0x34020b(0x1f6)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x34020b(0x224)));class LoggerService{constructor(){const _0x19056a=a79_0x34020b;this[_0x19056a(0x236)]=path_1[_0x19056a(0x211)][_0x19056a(0x1fc)](process['cwd'](),_0x19056a(0x228)),this['ensureLogsDirectory']();}[a79_0x34020b(0x204)](){const _0x3e8998=a79_0x34020b;!fs_1[_0x3e8998(0x211)]['existsSync'](this['logsDir'])&&(fs_1[_0x3e8998(0x211)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x3e8998(0x1ec)](_0x3e8998(0x235)+this['logsDir']));}['getLogFileName'](_0x3e5aa8){const _0x2a2340=a79_0x34020b,_0x41e61b=new Date()[_0x2a2340(0x219)]()[_0x2a2340(0x1f9)]('T')[0x0];return path_1[_0x2a2340(0x211)][_0x2a2340(0x1fc)](this['logsDir'],_0x3e5aa8+'_'+_0x41e61b+_0x2a2340(0x20c));}[a79_0x34020b(0x22f)](_0xa734d5,_0x403b2d){const _0x149f1d=a79_0x34020b;try{const _0x7081de=new Date()[_0x149f1d(0x219)](),_0x21aefa={'timestamp':_0x7081de,..._0x403b2d},_0x15b6bd=JSON[_0x149f1d(0x231)](_0x21aefa)+'\x0a',_0x5306c8=this[_0x149f1d(0x225)](_0xa734d5);fs_1[_0x149f1d(0x211)]['appendFileSync'](_0x5306c8,_0x15b6bd,_0x149f1d(0x23a));}catch(_0x1cefb4){console[_0x149f1d(0x23c)](_0x149f1d(0x222)+_0xa734d5+'\x20log:',_0x1cefb4);}}[a79_0x34020b(0x1f3)](_0x55ff1a,_0x16c113,_0x5297fa,_0x210fb3){const _0x1332a2=a79_0x34020b;this[_0x1332a2(0x22f)](_0x1332a2(0x201),{'type':_0x1332a2(0x215),'gateway':_0x55ff1a,'endpoint':_0x16c113,'method':_0x5297fa,'data':_0x210fb3});}['logWhiteDomainResponse'](_0x48a045,_0x3199bc,_0x28c61d,_0x328e77,_0x12fa8f){const _0x47b987=a79_0x34020b;this[_0x47b987(0x22f)](_0x47b987(0x1f7),{'type':_0x47b987(0x21e),'gateway':_0x48a045,'endpoint':_0x3199bc,'status':_0x28c61d,'responseTime':_0x12fa8f,'data':_0x328e77});}[a79_0x34020b(0x1fb)](_0x234ad0,_0x3caaa5,_0x1a0c51){const _0x1aa91d=a79_0x34020b;this[_0x1aa91d(0x22f)](_0x1aa91d(0x209),{'type':'ERROR','gateway':_0x234ad0,'endpoint':_0x3caaa5,'error':_0x1a0c51 instanceof Error?{'message':_0x1a0c51[_0x1aa91d(0x223)],'stack':_0x1a0c51[_0x1aa91d(0x1f2)]}:_0x1a0c51});}[a79_0x34020b(0x21c)](_0x9335ce,_0x269a58,_0x1a7e9c){const _0x2192c5=a79_0x34020b;this['writeLog'](_0x2192c5(0x210),{'type':_0x2192c5(0x20f),'gateway':_0x9335ce,'headers':_0x1a7e9c,'data':_0x269a58});}[a79_0x34020b(0x20d)](_0x283f5f,_0x408ce4,_0x4622eb,_0x156539,_0x31a48a){const _0x3ab49f=a79_0x34020b;this[_0x3ab49f(0x22f)](_0x3ab49f(0x20b),{'type':_0x3ab49f(0x212),'gateway':_0x283f5f,'paymentId':_0x408ce4,'oldStatus':_0x4622eb,'newStatus':_0x156539,'originalData':_0x31a48a});}[a79_0x34020b(0x22c)](_0xcdb017,_0x2839ad,_0x299d44){const _0x5d66aa=a79_0x34020b;this[_0x5d66aa(0x22f)](_0x5d66aa(0x233),{'type':'WEBHOOK_ERROR','gateway':_0xcdb017,'error':_0x2839ad instanceof Error?{'message':_0x2839ad[_0x5d66aa(0x223)],'stack':_0x2839ad[_0x5d66aa(0x1f2)]}:_0x2839ad,'originalData':_0x299d44});}[a79_0x34020b(0x21a)](_0x4f0ff8){this['writeLog']('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x4f0ff8});}[a79_0x34020b(0x1ed)](_0x4b905a){const _0x4685e0=a79_0x34020b;this[_0x4685e0(0x22f)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x4b905a});}[a79_0x34020b(0x1ee)](_0x203230,_0x19d051,_0x302bca,_0x1501bb,_0x5520fb,_0x1d3eda){const _0x909c04=a79_0x34020b;this[_0x909c04(0x22f)]('shop_webhooks_sent',{'type':_0x909c04(0x1ea),'shopId':_0x203230,'webhookUrl':_0x19d051,'event':_0x302bca,'status':_0x1501bb,'responseTime':_0x5520fb,'payload':_0x1d3eda});}[a79_0x34020b(0x232)](_0x182417,_0x342474,_0x1b942f,_0x34af27,_0x5f40b5){const _0x53a59f=a79_0x34020b;this[_0x53a59f(0x22f)](_0x53a59f(0x226),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x182417,'webhookUrl':_0x342474,'event':_0x1b942f,'error':_0x34af27 instanceof Error?{'message':_0x34af27[_0x53a59f(0x223)],'stack':_0x34af27['stack']}:_0x34af27,'payload':_0x5f40b5});}['logPaymentCreated'](_0x10fbd2,_0x1f76fa,_0x30bee8,_0x1025b7,_0x304efe){const _0x1cd01b=a79_0x34020b;this[_0x1cd01b(0x22f)](_0x1cd01b(0x205),{'type':_0x1cd01b(0x1fa),'gateway':_0x10fbd2,'paymentId':_0x1f76fa,'shopId':_0x30bee8,'amount':_0x1025b7,'currency':_0x304efe});}[a79_0x34020b(0x237)](_0x2241b3,_0x56fa24,_0xf91178,_0x3e835c,_0x3b4a19){const _0x1a380e=a79_0x34020b;this[_0x1a380e(0x22f)](_0x1a380e(0x22b),{'type':_0x1a380e(0x230),'endpoint':_0x2241b3,'method':_0x56fa24,'userId':_0xf91178,'userRole':_0x3e835c,'requestData':_0x3b4a19});}[a79_0x34020b(0x213)](){const _0x169a88=a79_0x34020b;try{const _0xa7074f=fs_1[_0x169a88(0x211)]['readdirSync'](this[_0x169a88(0x236)]),_0x198546=_0xa7074f[_0x169a88(0x221)](_0xa2fef1=>_0xa2fef1['endsWith'](_0x169a88(0x20c))),_0x47bd21=[...new Set(_0x198546[_0x169a88(0x21d)](_0x3df200=>_0x3df200[_0x169a88(0x1f9)]('_')[0x0]))],_0x5e904d=_0x198546[_0x169a88(0x21d)](_0x57127c=>{const _0x403b3c=_0x169a88,_0x406729=path_1[_0x403b3c(0x211)][_0x403b3c(0x1fc)](this['logsDir'],_0x57127c),_0x19b109=fs_1[_0x403b3c(0x211)]['statSync'](_0x406729),[_0x52a287,_0x35017b]=_0x57127c[_0x403b3c(0x239)]('.log','')['split']('_');return{'type':_0x52a287,'date':_0x35017b,'size':_0x19b109[_0x403b3c(0x1eb)]};})[_0x169a88(0x202)]((_0x20bb07,_0x4f0db3)=>_0x4f0db3[_0x169a88(0x200)]['localeCompare'](_0x20bb07['date']));return{'totalFiles':_0x198546[_0x169a88(0x22a)],'logTypes':_0x47bd21,'latestLogs':_0x5e904d[_0x169a88(0x22e)](0x0,0xa)};}catch(_0x99ea31){return console[_0x169a88(0x23c)]('Failed\x20to\x20get\x20log\x20stats:',_0x99ea31),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a79_0x34020b(0x23b)](_0x34eb1a=0x1e){const _0x5daf0f=a79_0x34020b;try{const _0x1ac97f=fs_1[_0x5daf0f(0x211)]['readdirSync'](this[_0x5daf0f(0x236)]),_0x5afa6b=new Date();_0x5afa6b[_0x5daf0f(0x203)](_0x5afa6b[_0x5daf0f(0x20e)]()-_0x34eb1a);let _0x2ff45b=0x0;_0x1ac97f[_0x5daf0f(0x1f1)](_0x77c3f5=>{const _0x403181=_0x5daf0f;if(!_0x77c3f5[_0x403181(0x216)](_0x403181(0x20c)))return;const _0x2cd825=path_1[_0x403181(0x211)][_0x403181(0x1fc)](this[_0x403181(0x236)],_0x77c3f5),_0x480bac=fs_1[_0x403181(0x211)][_0x403181(0x227)](_0x2cd825);_0x480bac[_0x403181(0x1f8)]<_0x5afa6b&&(fs_1['default']['unlinkSync'](_0x2cd825),_0x2ff45b++,console[_0x403181(0x1ec)](_0x403181(0x22d)+_0x77c3f5));}),console[_0x5daf0f(0x1ec)](_0x5daf0f(0x1fd)+_0x2ff45b+_0x5daf0f(0x206)+_0x34eb1a+'\x20days)');}catch(_0x2c847){console[_0x5daf0f(0x23c)](_0x5daf0f(0x207),_0x2c847);}}}function a79_0x14d3(_0x1744b3,_0x5485af){_0x1744b3=_0x1744b3-0x1ea;const _0x488ed8=a79_0x488e();let _0x14d317=_0x488ed8[_0x1744b3];return _0x14d317;}exports[a79_0x34020b(0x1f0)]=LoggerService,exports[a79_0x34020b(0x1f6)]=new LoggerService();