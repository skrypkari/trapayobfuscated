'use strict';const a48_0x2d18e4=a48_0x39bb;(function(_0x45751f,_0x1f538f){const _0xef862b=a48_0x39bb,_0x22a919=_0x45751f();while(!![]){try{const _0xf68964=-parseInt(_0xef862b(0x1a8))/0x1+-parseInt(_0xef862b(0x1b4))/0x2*(parseInt(_0xef862b(0x1a5))/0x3)+parseInt(_0xef862b(0x176))/0x4*(-parseInt(_0xef862b(0x196))/0x5)+parseInt(_0xef862b(0x18c))/0x6*(parseInt(_0xef862b(0x175))/0x7)+parseInt(_0xef862b(0x181))/0x8*(parseInt(_0xef862b(0x190))/0x9)+parseInt(_0xef862b(0x19c))/0xa+parseInt(_0xef862b(0x1b5))/0xb;if(_0xf68964===_0x1f538f)break;else _0x22a919['push'](_0x22a919['shift']());}catch(_0x60a1b2){_0x22a919['push'](_0x22a919['shift']());}}}(a48_0x2e24,0x8a98f));function a48_0x39bb(_0x1cad63,_0x5e12a9){const _0x2e247e=a48_0x2e24();return a48_0x39bb=function(_0x39bb52,_0x5b47c1){_0x39bb52=_0x39bb52-0x16a;let _0x35aeec=_0x2e247e[_0x39bb52];return _0x35aeec;},a48_0x39bb(_0x1cad63,_0x5e12a9);}var __importDefault=this&&this[a48_0x2d18e4(0x17e)]||function(_0x3735fe){const _0x2a4130=a48_0x2d18e4;return _0x3735fe&&_0x3735fe[_0x2a4130(0x171)]?_0x3735fe:{'default':_0x3735fe};};Object[a48_0x2d18e4(0x184)](exports,a48_0x2d18e4(0x171),{'value':!![]}),exports['loggerService']=exports[a48_0x2d18e4(0x1ac)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x2d18e4(0x1b1)));class LoggerService{constructor(){const _0x9beb=a48_0x2d18e4;this[_0x9beb(0x1ba)]=path_1[_0x9beb(0x16e)][_0x9beb(0x1b7)](process[_0x9beb(0x1bb)](),_0x9beb(0x193)),this['ensureLogsDirectory']();}[a48_0x2d18e4(0x1ad)](){const _0x11f8bd=a48_0x2d18e4;!fs_1[_0x11f8bd(0x16e)]['existsSync'](this[_0x11f8bd(0x1ba)])&&(fs_1[_0x11f8bd(0x16e)][_0x11f8bd(0x178)](this[_0x11f8bd(0x1ba)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x11f8bd(0x1ba)]));}[a48_0x2d18e4(0x180)](_0x49aae5){const _0xaa5c8b=a48_0x2d18e4,_0x576bc3=new Date()[_0xaa5c8b(0x1a3)]()[_0xaa5c8b(0x19d)]('T')[0x0];return path_1[_0xaa5c8b(0x16e)][_0xaa5c8b(0x1b7)](this[_0xaa5c8b(0x1ba)],_0x49aae5+'_'+_0x576bc3+'.log');}[a48_0x2d18e4(0x1bf)](_0x5c61a2,_0x583597){const _0xc9417a=a48_0x2d18e4;try{const _0x393429=new Date()[_0xc9417a(0x1a3)](),_0x4a5099={'timestamp':_0x393429,..._0x583597},_0x43bcfc=JSON[_0xc9417a(0x18b)](_0x4a5099)+'\x0a',_0x5cbb78=this[_0xc9417a(0x180)](_0x5c61a2);fs_1[_0xc9417a(0x16e)]['appendFileSync'](_0x5cbb78,_0x43bcfc,_0xc9417a(0x1b3));}catch(_0x1f312b){console[_0xc9417a(0x17d)](_0xc9417a(0x194)+_0x5c61a2+_0xc9417a(0x188),_0x1f312b);}}[a48_0x2d18e4(0x172)](_0x1ae7bf,_0x6f69cd,_0x284f68,_0x523429){const _0x18d2fd=a48_0x2d18e4;this[_0x18d2fd(0x1bf)](_0x18d2fd(0x186),{'type':_0x18d2fd(0x1b9),'gateway':_0x1ae7bf,'endpoint':_0x6f69cd,'method':_0x284f68,'data':_0x523429});}[a48_0x2d18e4(0x17a)](_0x2233b5,_0x4d91b8,_0x38c15a,_0x22d43a,_0x528ab5){const _0x48088e=a48_0x2d18e4;this[_0x48088e(0x1bf)]('white_domain_responses',{'type':_0x48088e(0x19a),'gateway':_0x2233b5,'endpoint':_0x4d91b8,'status':_0x38c15a,'responseTime':_0x528ab5,'data':_0x22d43a});}[a48_0x2d18e4(0x1ae)](_0x32afc3,_0x23a525,_0x2b8396){const _0xf92bb4=a48_0x2d18e4;this[_0xf92bb4(0x1bf)](_0xf92bb4(0x19f),{'type':_0xf92bb4(0x16f),'gateway':_0x32afc3,'endpoint':_0x23a525,'error':_0x2b8396 instanceof Error?{'message':_0x2b8396[_0xf92bb4(0x199)],'stack':_0x2b8396[_0xf92bb4(0x1b8)]}:_0x2b8396});}[a48_0x2d18e4(0x1a1)](_0x290b67,_0x302a58,_0x4d1f4c){const _0x450b04=a48_0x2d18e4;this[_0x450b04(0x1bf)](_0x450b04(0x191),{'type':_0x450b04(0x1af),'gateway':_0x290b67,'headers':_0x4d1f4c,'data':_0x302a58});}[a48_0x2d18e4(0x19e)](_0x34a15d,_0x14b5b9,_0x3cccb4,_0x3b6fce,_0x414b13){const _0x3ae5f9=a48_0x2d18e4;this[_0x3ae5f9(0x1bf)](_0x3ae5f9(0x1a2),{'type':'WEBHOOK_PROCESSED','gateway':_0x34a15d,'paymentId':_0x14b5b9,'oldStatus':_0x3cccb4,'newStatus':_0x3b6fce,'originalData':_0x414b13});}['logWebhookError'](_0x2b9539,_0x3840ea,_0x41d6a2){const _0xe560bd=a48_0x2d18e4;this[_0xe560bd(0x1bf)](_0xe560bd(0x177),{'type':_0xe560bd(0x197),'gateway':_0x2b9539,'error':_0x3840ea instanceof Error?{'message':_0x3840ea[_0xe560bd(0x199)],'stack':_0x3840ea['stack']}:_0x3840ea,'originalData':_0x41d6a2});}[a48_0x2d18e4(0x1a9)](_0x1c7e0b){const _0x5851d8=a48_0x2d18e4;this['writeLog'](_0x5851d8(0x18a),{'type':_0x5851d8(0x1b6),..._0x1c7e0b});}['logCoinToPayError'](_0x1fb0df){const _0x60cd4b=a48_0x2d18e4;this[_0x60cd4b(0x1bf)](_0x60cd4b(0x1b2),{'type':_0x60cd4b(0x17f),..._0x1fb0df});}['logShopWebhookSent'](_0x8026a6,_0x1ad793,_0x19031a,_0x3fb2b3,_0x5a420b,_0x359e29){const _0x54300d=a48_0x2d18e4;this['writeLog'](_0x54300d(0x1bd),{'type':_0x54300d(0x1be),'shopId':_0x8026a6,'webhookUrl':_0x1ad793,'event':_0x19031a,'status':_0x3fb2b3,'responseTime':_0x5a420b,'payload':_0x359e29});}[a48_0x2d18e4(0x1ab)](_0x2f3c0d,_0x391113,_0x25e508,_0x55379b,_0x53ca5b){const _0x801ada=a48_0x2d18e4;this['writeLog'](_0x801ada(0x174),{'type':_0x801ada(0x18e),'shopId':_0x2f3c0d,'webhookUrl':_0x391113,'event':_0x25e508,'error':_0x55379b instanceof Error?{'message':_0x55379b[_0x801ada(0x199)],'stack':_0x55379b[_0x801ada(0x1b8)]}:_0x55379b,'payload':_0x53ca5b});}['logPaymentCreated'](_0x204f83,_0x2d0cdf,_0x14c03b,_0x3392a1,_0x496bfe){const _0x4bbb82=a48_0x2d18e4;this[_0x4bbb82(0x1bf)](_0x4bbb82(0x18f),{'type':_0x4bbb82(0x183),'gateway':_0x204f83,'paymentId':_0x2d0cdf,'shopId':_0x14c03b,'amount':_0x3392a1,'currency':_0x496bfe});}[a48_0x2d18e4(0x1a7)](_0x20be1c,_0x162f15,_0x297e55,_0x3564bd,_0x21b991){const _0xc1f997=a48_0x2d18e4;this[_0xc1f997(0x1bf)](_0xc1f997(0x1a0),{'type':_0xc1f997(0x173),'endpoint':_0x20be1c,'method':_0x162f15,'userId':_0x297e55,'userRole':_0x3564bd,'requestData':_0x21b991});}[a48_0x2d18e4(0x1a6)](){const _0x8cc88c=a48_0x2d18e4;try{const _0x4806da=fs_1[_0x8cc88c(0x16e)]['readdirSync'](this[_0x8cc88c(0x1ba)]),_0x509fba=_0x4806da[_0x8cc88c(0x17b)](_0xf98331=>_0xf98331[_0x8cc88c(0x1aa)](_0x8cc88c(0x170))),_0x122029=[...new Set(_0x509fba[_0x8cc88c(0x18d)](_0x1341a8=>_0x1341a8[_0x8cc88c(0x19d)]('_')[0x0]))],_0x28eeaa=_0x509fba['map'](_0x1d4949=>{const _0x1398ff=_0x8cc88c,_0x164aa5=path_1[_0x1398ff(0x16e)]['join'](this[_0x1398ff(0x1ba)],_0x1d4949),_0x428cf5=fs_1[_0x1398ff(0x16e)]['statSync'](_0x164aa5),[_0x298797,_0x35f134]=_0x1d4949[_0x1398ff(0x19b)](_0x1398ff(0x170),'')[_0x1398ff(0x19d)]('_');return{'type':_0x298797,'date':_0x35f134,'size':_0x428cf5['size']};})[_0x8cc88c(0x1bc)]((_0x21d343,_0xd8a7a8)=>_0xd8a7a8[_0x8cc88c(0x195)]['localeCompare'](_0x21d343[_0x8cc88c(0x195)]));return{'totalFiles':_0x509fba[_0x8cc88c(0x179)],'logTypes':_0x122029,'latestLogs':_0x28eeaa['slice'](0x0,0xa)};}catch(_0x18fa76){return console['error'](_0x8cc88c(0x1a4),_0x18fa76),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x572d8f=0x1e){const _0x2e52f4=a48_0x2d18e4;try{const _0x2ebc5a=fs_1['default'][_0x2e52f4(0x17c)](this['logsDir']),_0x5753ad=new Date();_0x5753ad[_0x2e52f4(0x16c)](_0x5753ad[_0x2e52f4(0x16a)]()-_0x572d8f);let _0x5eab5a=0x0;_0x2ebc5a[_0x2e52f4(0x185)](_0x1e0bf8=>{const _0x2a83db=_0x2e52f4;if(!_0x1e0bf8['endsWith']('.log'))return;const _0xbdec93=path_1[_0x2a83db(0x16e)]['join'](this[_0x2a83db(0x1ba)],_0x1e0bf8),_0x5d6cc5=fs_1[_0x2a83db(0x16e)][_0x2a83db(0x192)](_0xbdec93);_0x5d6cc5[_0x2a83db(0x16b)]<_0x5753ad&&(fs_1[_0x2a83db(0x16e)][_0x2a83db(0x16d)](_0xbdec93),_0x5eab5a++,console[_0x2a83db(0x1b0)](_0x2a83db(0x182)+_0x1e0bf8));}),console[_0x2e52f4(0x1b0)]('🧹\x20Cleaned\x20'+_0x5eab5a+_0x2e52f4(0x187)+_0x572d8f+_0x2e52f4(0x189));}catch(_0x364ab2){console[_0x2e52f4(0x17d)]('Failed\x20to\x20clean\x20old\x20logs:',_0x364ab2);}}}function a48_0x2e24(){const _0x341aa3=['shop_webhooks_sent','SHOP_WEBHOOK_SENT','writeLog','getDate','mtime','setDate','unlinkSync','default','ERROR','.log','__esModule','logWhiteDomainRequest','API_CALL','shop_webhooks_errors','84oRgswh','16804oEdkXx','webhooks_errors','mkdirSync','length','logWhiteDomainResponse','filter','readdirSync','error','__importDefault','COINTOPAY_ERROR','getLogFileName','556808UtCnmF','🗑️\x20Deleted\x20old\x20log\x20file:\x20','PAYMENT_CREATED','defineProperty','forEach','white_domain_requests','\x20old\x20log\x20files\x20(older\x20than\x20','\x20log:','\x20days)','cointopay_status_changes','stringify','212754ZyjaQd','map','SHOP_WEBHOOK_ERROR','payments_created','126yxukBA','webhooks_received','statSync','logs','Failed\x20to\x20write\x20','date','715eGsfjd','WEBHOOK_ERROR','loggerService','message','RESPONSE','replace','8626850ILuwUB','split','logWebhookProcessed','white_domain_errors','api_calls','logWebhookReceived','webhooks_processed','toISOString','Failed\x20to\x20get\x20log\x20stats:','51Lmyqdi','getLogStats','logApiCall','578106MkopbE','logCoinToPayStatus','endsWith','logShopWebhookError','LoggerService','ensureLogsDirectory','logWhiteDomainError','WEBHOOK_RECEIVED','log','path','cointopay_errors','utf8','61284kPugtS','53361eJsBxP','COINTOPAY_STATUS_CHANGE','join','stack','REQUEST','logsDir','cwd','sort'];a48_0x2e24=function(){return _0x341aa3;};return a48_0x2e24();}exports['LoggerService']=LoggerService,exports[a48_0x2d18e4(0x198)]=new LoggerService();