'use strict';const a51_0xf83e68=a51_0x4012;(function(_0x216999,_0x3fbceb){const _0x386188=a51_0x4012,_0x4d10e4=_0x216999();while(!![]){try{const _0x104ab5=-parseInt(_0x386188(0xe2))/0x1+-parseInt(_0x386188(0xe5))/0x2*(parseInt(_0x386188(0x115))/0x3)+parseInt(_0x386188(0xf4))/0x4+-parseInt(_0x386188(0x10e))/0x5+-parseInt(_0x386188(0xe9))/0x6+-parseInt(_0x386188(0x102))/0x7+parseInt(_0x386188(0x10b))/0x8*(parseInt(_0x386188(0x11b))/0x9);if(_0x104ab5===_0x3fbceb)break;else _0x4d10e4['push'](_0x4d10e4['shift']());}catch(_0x22fc4b){_0x4d10e4['push'](_0x4d10e4['shift']());}}}(a51_0x2104,0x8fd3d));function a51_0x2104(){const _0x1677b1=['statSync','\x20days)','cwd','logShopWebhookSent','stack','🧹\x20Cleaned\x20','endsWith','6681066VlNqYF','loggerService','slice','__esModule','webhooks_received','logsDir','size','logWebhookError','stringify','29672lZUnoJ','Failed\x20to\x20write\x20','join','3020870VzlZlX','logWhiteDomainError','ensureLogsDirectory','readdirSync','logPaymentCreated','LoggerService','ERROR','54ELoeXE','white_domain_responses','logs','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logWhiteDomainResponse','WEBHOOK_PROCESSED','11619yeQORL','cointopay_status_changes','log','payments_created','logShopWebhookError','map','COINTOPAY_STATUS_CHANGE','WEBHOOK_RECEIVED','forEach','writeLog','utf8','mtime','SHOP_WEBHOOK_SENT','Failed\x20to\x20clean\x20old\x20logs:','default','logWebhookReceived','path','logCoinToPayStatus','logCoinToPayError','length','📁\x20Created\x20logs\x20directory:\x20','PAYMENT_CREATED','setDate','error','1119781dBPhwt','logWebhookProcessed','date','91058uqIKXQ','.log','message','filter','6466404NBOQbl','mkdirSync','white_domain_errors','getLogStats','split','getLogFileName','unlinkSync','defineProperty','API_CALL','toISOString','cleanOldLogs','1505788qPlAtK','COINTOPAY_ERROR','appendFileSync','SHOP_WEBHOOK_ERROR','localeCompare','white_domain_requests','webhooks_errors'];a51_0x2104=function(){return _0x1677b1;};return a51_0x2104();}var __importDefault=this&&this['__importDefault']||function(_0x39575c){const _0x609285=a51_0x4012;return _0x39575c&&_0x39575c[_0x609285(0x105)]?_0x39575c:{'default':_0x39575c};};Object[a51_0xf83e68(0xf0)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a51_0xf83e68(0x113)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0xf83e68(0x12b)));function a51_0x4012(_0x5ed444,_0x4dac15){const _0x210474=a51_0x2104();return a51_0x4012=function(_0x401264,_0x168006){_0x401264=_0x401264-0xdc;let _0xbb3b27=_0x210474[_0x401264];return _0xbb3b27;},a51_0x4012(_0x5ed444,_0x4dac15);}class LoggerService{constructor(){const _0x487e78=a51_0xf83e68;this[_0x487e78(0x107)]=path_1[_0x487e78(0x129)][_0x487e78(0x10d)](process[_0x487e78(0xfd)](),_0x487e78(0x117)),this[_0x487e78(0x110)]();}[a51_0xf83e68(0x110)](){const _0x575224=a51_0xf83e68;!fs_1[_0x575224(0x129)]['existsSync'](this[_0x575224(0x107)])&&(fs_1['default'][_0x575224(0xea)](this[_0x575224(0x107)],{'recursive':!![]}),console[_0x575224(0x11d)](_0x575224(0xde)+this['logsDir']));}[a51_0xf83e68(0xee)](_0x288638){const _0x323700=a51_0xf83e68,_0x5c91f2=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x323700(0x129)][_0x323700(0x10d)](this[_0x323700(0x107)],_0x288638+'_'+_0x5c91f2+_0x323700(0xe6));}[a51_0xf83e68(0x124)](_0x1e7cfe,_0x13cfa8){const _0x4037c0=a51_0xf83e68;try{const _0x170856=new Date()[_0x4037c0(0xf2)](),_0x323297={'timestamp':_0x170856,..._0x13cfa8},_0x46f0cc=JSON[_0x4037c0(0x10a)](_0x323297)+'\x0a',_0x30ed2d=this[_0x4037c0(0xee)](_0x1e7cfe);fs_1[_0x4037c0(0x129)][_0x4037c0(0xf6)](_0x30ed2d,_0x46f0cc,_0x4037c0(0x125));}catch(_0x3f8262){console[_0x4037c0(0xe1)](_0x4037c0(0x10c)+_0x1e7cfe+'\x20log:',_0x3f8262);}}['logWhiteDomainRequest'](_0x5ec873,_0x40acd6,_0xe02892,_0x4fdd57){const _0x18f452=a51_0xf83e68;this[_0x18f452(0x124)](_0x18f452(0xf9),{'type':'REQUEST','gateway':_0x5ec873,'endpoint':_0x40acd6,'method':_0xe02892,'data':_0x4fdd57});}[a51_0xf83e68(0x119)](_0x499c4a,_0x49728c,_0x3d849a,_0x314804,_0x29e467){const _0x332639=a51_0xf83e68;this[_0x332639(0x124)](_0x332639(0x116),{'type':'RESPONSE','gateway':_0x499c4a,'endpoint':_0x49728c,'status':_0x3d849a,'responseTime':_0x29e467,'data':_0x314804});}[a51_0xf83e68(0x10f)](_0x151176,_0x19c254,_0x1c9aa1){const _0x36ba77=a51_0xf83e68;this[_0x36ba77(0x124)](_0x36ba77(0xeb),{'type':_0x36ba77(0x114),'gateway':_0x151176,'endpoint':_0x19c254,'error':_0x1c9aa1 instanceof Error?{'message':_0x1c9aa1[_0x36ba77(0xe7)],'stack':_0x1c9aa1[_0x36ba77(0xff)]}:_0x1c9aa1});}[a51_0xf83e68(0x12a)](_0x5a067c,_0x4f3c96,_0x43d156){const _0x55202b=a51_0xf83e68;this['writeLog'](_0x55202b(0x106),{'type':_0x55202b(0x122),'gateway':_0x5a067c,'headers':_0x43d156,'data':_0x4f3c96});}[a51_0xf83e68(0xe3)](_0x290c30,_0x5c696d,_0xe08763,_0x579cb2,_0x17fb4b){const _0x344b50=a51_0xf83e68;this[_0x344b50(0x124)]('webhooks_processed',{'type':_0x344b50(0x11a),'gateway':_0x290c30,'paymentId':_0x5c696d,'oldStatus':_0xe08763,'newStatus':_0x579cb2,'originalData':_0x17fb4b});}[a51_0xf83e68(0x109)](_0x27da73,_0x2b79e3,_0x13ee04){const _0x290ef4=a51_0xf83e68;this[_0x290ef4(0x124)](_0x290ef4(0xfa),{'type':'WEBHOOK_ERROR','gateway':_0x27da73,'error':_0x2b79e3 instanceof Error?{'message':_0x2b79e3[_0x290ef4(0xe7)],'stack':_0x2b79e3['stack']}:_0x2b79e3,'originalData':_0x13ee04});}[a51_0xf83e68(0x12c)](_0x163f5e){const _0x3a847a=a51_0xf83e68;this[_0x3a847a(0x124)](_0x3a847a(0x11c),{'type':_0x3a847a(0x121),..._0x163f5e});}[a51_0xf83e68(0xdc)](_0x5bbca1){const _0x145eb5=a51_0xf83e68;this[_0x145eb5(0x124)]('cointopay_errors',{'type':_0x145eb5(0xf5),..._0x5bbca1});}[a51_0xf83e68(0xfe)](_0x1af1cc,_0x107929,_0x321d6d,_0x59270a,_0x3c2a53,_0x225f67){const _0x248968=a51_0xf83e68;this[_0x248968(0x124)]('shop_webhooks_sent',{'type':_0x248968(0x127),'shopId':_0x1af1cc,'webhookUrl':_0x107929,'event':_0x321d6d,'status':_0x59270a,'responseTime':_0x3c2a53,'payload':_0x225f67});}[a51_0xf83e68(0x11f)](_0x455ffa,_0xc7e617,_0x19cd49,_0x459932,_0x5af831){const _0x4df92f=a51_0xf83e68;this['writeLog']('shop_webhooks_errors',{'type':_0x4df92f(0xf7),'shopId':_0x455ffa,'webhookUrl':_0xc7e617,'event':_0x19cd49,'error':_0x459932 instanceof Error?{'message':_0x459932[_0x4df92f(0xe7)],'stack':_0x459932['stack']}:_0x459932,'payload':_0x5af831});}[a51_0xf83e68(0x112)](_0x5d3129,_0x441144,_0x4e22c8,_0x348464,_0x3474e9){const _0x4c367b=a51_0xf83e68;this['writeLog'](_0x4c367b(0x11e),{'type':_0x4c367b(0xdf),'gateway':_0x5d3129,'paymentId':_0x441144,'shopId':_0x4e22c8,'amount':_0x348464,'currency':_0x3474e9});}['logApiCall'](_0x50aafd,_0x58862b,_0x24088e,_0x41758c,_0x88416c){const _0x50c664=a51_0xf83e68;this['writeLog']('api_calls',{'type':_0x50c664(0xf1),'endpoint':_0x50aafd,'method':_0x58862b,'userId':_0x24088e,'userRole':_0x41758c,'requestData':_0x88416c});}[a51_0xf83e68(0xec)](){const _0x38759c=a51_0xf83e68;try{const _0xdbb24=fs_1[_0x38759c(0x129)][_0x38759c(0x111)](this['logsDir']),_0x9cf076=_0xdbb24[_0x38759c(0xe8)](_0x4d3df9=>_0x4d3df9[_0x38759c(0x101)]('.log')),_0x1ec4d2=[...new Set(_0x9cf076[_0x38759c(0x120)](_0xe21095=>_0xe21095[_0x38759c(0xed)]('_')[0x0]))],_0x23d883=_0x9cf076[_0x38759c(0x120)](_0xf588bd=>{const _0x58b957=_0x38759c,_0x7b24cb=path_1[_0x58b957(0x129)]['join'](this[_0x58b957(0x107)],_0xf588bd),_0x35f2de=fs_1[_0x58b957(0x129)]['statSync'](_0x7b24cb),[_0x4b50ff,_0x426af5]=_0xf588bd['replace']('.log','')['split']('_');return{'type':_0x4b50ff,'date':_0x426af5,'size':_0x35f2de[_0x58b957(0x108)]};})['sort']((_0x272ded,_0x36d5cb)=>_0x36d5cb[_0x38759c(0xe4)][_0x38759c(0xf8)](_0x272ded[_0x38759c(0xe4)]));return{'totalFiles':_0x9cf076[_0x38759c(0xdd)],'logTypes':_0x1ec4d2,'latestLogs':_0x23d883[_0x38759c(0x104)](0x0,0xa)};}catch(_0x2e1618){return console[_0x38759c(0xe1)]('Failed\x20to\x20get\x20log\x20stats:',_0x2e1618),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0xf83e68(0xf3)](_0x5d8caa=0x1e){const _0x2ff35e=a51_0xf83e68;try{const _0x4eb160=fs_1['default'][_0x2ff35e(0x111)](this[_0x2ff35e(0x107)]),_0x269d18=new Date();_0x269d18[_0x2ff35e(0xe0)](_0x269d18['getDate']()-_0x5d8caa);let _0x486b1f=0x0;_0x4eb160[_0x2ff35e(0x123)](_0x507d08=>{const _0x265a31=_0x2ff35e;if(!_0x507d08[_0x265a31(0x101)]('.log'))return;const _0x2b959b=path_1[_0x265a31(0x129)]['join'](this[_0x265a31(0x107)],_0x507d08),_0x165aa5=fs_1['default'][_0x265a31(0xfb)](_0x2b959b);_0x165aa5[_0x265a31(0x126)]<_0x269d18&&(fs_1[_0x265a31(0x129)][_0x265a31(0xef)](_0x2b959b),_0x486b1f++,console[_0x265a31(0x11d)](_0x265a31(0x118)+_0x507d08));}),console[_0x2ff35e(0x11d)](_0x2ff35e(0x100)+_0x486b1f+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x5d8caa+_0x2ff35e(0xfc));}catch(_0x331680){console['error'](_0x2ff35e(0x128),_0x331680);}}}exports['LoggerService']=LoggerService,exports[a51_0xf83e68(0x103)]=new LoggerService();