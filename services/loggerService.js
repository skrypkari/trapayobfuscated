'use strict';function a73_0x4f4b(_0x273113,_0x18218d){_0x273113=_0x273113-0xb5;const _0x3d2952=a73_0x3d29();let _0x4f4bf9=_0x3d2952[_0x273113];return _0x4f4bf9;}const a73_0xcc9348=a73_0x4f4b;(function(_0x11feaf,_0x49a177){const _0x5b8d84=a73_0x4f4b,_0x5ae610=_0x11feaf();while(!![]){try{const _0xa399bf=parseInt(_0x5b8d84(0x107))/0x1*(parseInt(_0x5b8d84(0xfd))/0x2)+-parseInt(_0x5b8d84(0xea))/0x3+-parseInt(_0x5b8d84(0xc9))/0x4*(parseInt(_0x5b8d84(0xdc))/0x5)+parseInt(_0x5b8d84(0xb8))/0x6*(-parseInt(_0x5b8d84(0x106))/0x7)+-parseInt(_0x5b8d84(0xf0))/0x8+-parseInt(_0x5b8d84(0xe9))/0x9*(-parseInt(_0x5b8d84(0xf2))/0xa)+-parseInt(_0x5b8d84(0xdd))/0xb*(-parseInt(_0x5b8d84(0xd9))/0xc);if(_0xa399bf===_0x49a177)break;else _0x5ae610['push'](_0x5ae610['shift']());}catch(_0x5d6a31){_0x5ae610['push'](_0x5ae610['shift']());}}}(a73_0x3d29,0x4a8ad));var __importDefault=this&&this['__importDefault']||function(_0x48cc1f){const _0xaab20b=a73_0x4f4b;return _0x48cc1f&&_0x48cc1f[_0xaab20b(0xca)]?_0x48cc1f:{'default':_0x48cc1f};};Object[a73_0xcc9348(0xbc)](exports,a73_0xcc9348(0xca),{'value':!![]}),exports[a73_0xcc9348(0xe6)]=exports[a73_0xcc9348(0xc7)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a73_0xcc9348(0xf1)));function a73_0x3d29(){const _0x52a0d3=['logShopWebhookError','logs','SHOP_WEBHOOK_ERROR','logWebhookReceived','cointopay_errors','130934cVuUOO','logWebhookProcessed','mtime','error','writeLog','logApiCall','COINTOPAY_ERROR','logPaymentCreated','cwd','49kUhNGA','2lEmZgN','ðŸ§¹\x20Cleaned\x20','cointopay_status_changes','API_CALL','webhooks_errors','243558editZF','logWebhookError','\x20log:','REQUEST','defineProperty','logShopWebhookSent','log','getDate','logWhiteDomainRequest','.log','logsDir','toISOString','white_domain_errors','stringify','ðŸ“\x20Created\x20logs\x20directory:\x20','LoggerService','replace','317344OoptsP','__esModule','WEBHOOK_ERROR','shop_webhooks_sent','getLogFileName','\x20old\x20log\x20files\x20(older\x20than\x20','join','api_calls','endsWith','default','stack','logCoinToPayStatus','RESPONSE','Failed\x20to\x20get\x20log\x20stats:','WEBHOOK_PROCESSED','filter','4596996mMTYLT','setDate','getLogStats','5VIWxig','33fvbxID','map','white_domain_requests','date','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','PAYMENT_CREATED','readdirSync','message','shop_webhooks_errors','loggerService','existsSync','cleanOldLogs','6309CjMbIO','712671tkFHtK','webhooks_received','Failed\x20to\x20clean\x20old\x20logs:','white_domain_responses','webhooks_processed','mkdirSync','4291568DDfnfG','path','2320GeiVXu','Failed\x20to\x20write\x20','unlinkSync','WEBHOOK_RECEIVED','utf8','split'];a73_0x3d29=function(){return _0x52a0d3;};return a73_0x3d29();}class LoggerService{constructor(){const _0x3c9d74=a73_0xcc9348;this[_0x3c9d74(0xc2)]=path_1['default'][_0x3c9d74(0xcf)](process[_0x3c9d74(0x105)](),_0x3c9d74(0xf9)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x1e4589=a73_0xcc9348;!fs_1['default'][_0x1e4589(0xe7)](this['logsDir'])&&(fs_1[_0x1e4589(0xd2)][_0x1e4589(0xef)](this[_0x1e4589(0xc2)],{'recursive':!![]}),console[_0x1e4589(0xbe)](_0x1e4589(0xc6)+this['logsDir']));}['getLogFileName'](_0xd4b1b0){const _0x8e6955=a73_0xcc9348,_0x1e9c0f=new Date()[_0x8e6955(0xc3)]()['split']('T')[0x0];return path_1[_0x8e6955(0xd2)][_0x8e6955(0xcf)](this[_0x8e6955(0xc2)],_0xd4b1b0+'_'+_0x1e9c0f+_0x8e6955(0xc1));}[a73_0xcc9348(0x101)](_0x522246,_0x1bd81a){const _0x495a18=a73_0xcc9348;try{const _0x34e40a=new Date()[_0x495a18(0xc3)](),_0x5e4537={'timestamp':_0x34e40a,..._0x1bd81a},_0x5a4370=JSON[_0x495a18(0xc5)](_0x5e4537)+'\x0a',_0x564e13=this[_0x495a18(0xcd)](_0x522246);fs_1[_0x495a18(0xd2)]['appendFileSync'](_0x564e13,_0x5a4370,_0x495a18(0xf6));}catch(_0x1b278d){console[_0x495a18(0x100)](_0x495a18(0xf3)+_0x522246+_0x495a18(0xba),_0x1b278d);}}[a73_0xcc9348(0xc0)](_0x4120ba,_0x159b6f,_0x503aee,_0x5c771c){const _0x11ced6=a73_0xcc9348;this[_0x11ced6(0x101)](_0x11ced6(0xdf),{'type':_0x11ced6(0xbb),'gateway':_0x4120ba,'endpoint':_0x159b6f,'method':_0x503aee,'data':_0x5c771c});}['logWhiteDomainResponse'](_0x2f82ad,_0x3287be,_0x2b3de0,_0x5028a1,_0x192066){const _0x32b09c=a73_0xcc9348;this[_0x32b09c(0x101)](_0x32b09c(0xed),{'type':_0x32b09c(0xd5),'gateway':_0x2f82ad,'endpoint':_0x3287be,'status':_0x2b3de0,'responseTime':_0x192066,'data':_0x5028a1});}['logWhiteDomainError'](_0x2cefb3,_0x109fc8,_0x301c7e){const _0x688b55=a73_0xcc9348;this['writeLog'](_0x688b55(0xc4),{'type':'ERROR','gateway':_0x2cefb3,'endpoint':_0x109fc8,'error':_0x301c7e instanceof Error?{'message':_0x301c7e['message'],'stack':_0x301c7e[_0x688b55(0xd3)]}:_0x301c7e});}[a73_0xcc9348(0xfb)](_0x1993b3,_0x3582e5,_0x86e708){const _0x3725cd=a73_0xcc9348;this[_0x3725cd(0x101)](_0x3725cd(0xeb),{'type':_0x3725cd(0xf5),'gateway':_0x1993b3,'headers':_0x86e708,'data':_0x3582e5});}[a73_0xcc9348(0xfe)](_0x386261,_0x5053e8,_0x42a202,_0x7df577,_0x544268){const _0x5bad85=a73_0xcc9348;this[_0x5bad85(0x101)](_0x5bad85(0xee),{'type':_0x5bad85(0xd7),'gateway':_0x386261,'paymentId':_0x5053e8,'oldStatus':_0x42a202,'newStatus':_0x7df577,'originalData':_0x544268});}[a73_0xcc9348(0xb9)](_0x186847,_0x2a84f1,_0x736098){const _0x5c8142=a73_0xcc9348;this['writeLog'](_0x5c8142(0xb7),{'type':_0x5c8142(0xcb),'gateway':_0x186847,'error':_0x2a84f1 instanceof Error?{'message':_0x2a84f1['message'],'stack':_0x2a84f1[_0x5c8142(0xd3)]}:_0x2a84f1,'originalData':_0x736098});}[a73_0xcc9348(0xd4)](_0x30e34e){const _0x25e34a=a73_0xcc9348;this[_0x25e34a(0x101)](_0x25e34a(0xb5),{'type':'COINTOPAY_STATUS_CHANGE',..._0x30e34e});}['logCoinToPayError'](_0x3b2820){const _0x34b08f=a73_0xcc9348;this[_0x34b08f(0x101)](_0x34b08f(0xfc),{'type':_0x34b08f(0x103),..._0x3b2820});}[a73_0xcc9348(0xbd)](_0x28b5c9,_0x47b4c8,_0x399941,_0x374ae4,_0x123175,_0x5985ad){const _0x5b3623=a73_0xcc9348;this['writeLog'](_0x5b3623(0xcc),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x28b5c9,'webhookUrl':_0x47b4c8,'event':_0x399941,'status':_0x374ae4,'responseTime':_0x123175,'payload':_0x5985ad});}[a73_0xcc9348(0xf8)](_0x3c6219,_0x10d4a4,_0x1bc991,_0x1fb149,_0x50de81){const _0x4aa104=a73_0xcc9348;this[_0x4aa104(0x101)](_0x4aa104(0xe5),{'type':_0x4aa104(0xfa),'shopId':_0x3c6219,'webhookUrl':_0x10d4a4,'event':_0x1bc991,'error':_0x1fb149 instanceof Error?{'message':_0x1fb149[_0x4aa104(0xe4)],'stack':_0x1fb149['stack']}:_0x1fb149,'payload':_0x50de81});}[a73_0xcc9348(0x104)](_0x94012c,_0xec6ab7,_0x1ae76c,_0x5058db,_0x4b797d){const _0x34c177=a73_0xcc9348;this[_0x34c177(0x101)]('payments_created',{'type':_0x34c177(0xe2),'gateway':_0x94012c,'paymentId':_0xec6ab7,'shopId':_0x1ae76c,'amount':_0x5058db,'currency':_0x4b797d});}[a73_0xcc9348(0x102)](_0x873510,_0x279f47,_0x2d6708,_0xc8c688,_0x36eace){const _0x566404=a73_0xcc9348;this[_0x566404(0x101)](_0x566404(0xd0),{'type':_0x566404(0xb6),'endpoint':_0x873510,'method':_0x279f47,'userId':_0x2d6708,'userRole':_0xc8c688,'requestData':_0x36eace});}[a73_0xcc9348(0xdb)](){const _0x2144a9=a73_0xcc9348;try{const _0x1ac1ed=fs_1[_0x2144a9(0xd2)][_0x2144a9(0xe3)](this['logsDir']),_0x47ec7a=_0x1ac1ed[_0x2144a9(0xd8)](_0x73f272=>_0x73f272[_0x2144a9(0xd1)](_0x2144a9(0xc1))),_0x4ecebb=[...new Set(_0x47ec7a['map'](_0x173826=>_0x173826[_0x2144a9(0xf7)]('_')[0x0]))],_0xc14f63=_0x47ec7a[_0x2144a9(0xde)](_0x442ec5=>{const _0x1022e0=_0x2144a9,_0x40845f=path_1[_0x1022e0(0xd2)][_0x1022e0(0xcf)](this[_0x1022e0(0xc2)],_0x442ec5),_0x3cd6be=fs_1['default']['statSync'](_0x40845f),[_0x26ce59,_0x3ccc53]=_0x442ec5[_0x1022e0(0xc8)](_0x1022e0(0xc1),'')[_0x1022e0(0xf7)]('_');return{'type':_0x26ce59,'date':_0x3ccc53,'size':_0x3cd6be['size']};})['sort']((_0x370ca9,_0x3c4073)=>_0x3c4073[_0x2144a9(0xe0)]['localeCompare'](_0x370ca9[_0x2144a9(0xe0)]));return{'totalFiles':_0x47ec7a['length'],'logTypes':_0x4ecebb,'latestLogs':_0xc14f63['slice'](0x0,0xa)};}catch(_0x5c475a){return console['error'](_0x2144a9(0xd6),_0x5c475a),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a73_0xcc9348(0xe8)](_0x3d5a4f=0x1e){const _0x41da0c=a73_0xcc9348;try{const _0x18ff53=fs_1[_0x41da0c(0xd2)]['readdirSync'](this[_0x41da0c(0xc2)]),_0x40d036=new Date();_0x40d036[_0x41da0c(0xda)](_0x40d036[_0x41da0c(0xbf)]()-_0x3d5a4f);let _0x27ed35=0x0;_0x18ff53['forEach'](_0x5019b3=>{const _0x122465=_0x41da0c;if(!_0x5019b3[_0x122465(0xd1)](_0x122465(0xc1)))return;const _0x586513=path_1[_0x122465(0xd2)][_0x122465(0xcf)](this['logsDir'],_0x5019b3),_0x3250e1=fs_1[_0x122465(0xd2)]['statSync'](_0x586513);_0x3250e1[_0x122465(0xff)]<_0x40d036&&(fs_1[_0x122465(0xd2)][_0x122465(0xf4)](_0x586513),_0x27ed35++,console[_0x122465(0xbe)](_0x122465(0xe1)+_0x5019b3));}),console[_0x41da0c(0xbe)](_0x41da0c(0x108)+_0x27ed35+_0x41da0c(0xce)+_0x3d5a4f+'\x20days)');}catch(_0x459bd9){console['error'](_0x41da0c(0xec),_0x459bd9);}}}exports[a73_0xcc9348(0xc7)]=LoggerService,exports[a73_0xcc9348(0xe6)]=new LoggerService();