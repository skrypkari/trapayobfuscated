'use strict';const a52_0x45f40a=a52_0x5010;function a52_0xe197(){const _0x51c668=['writeLog','4411089gTjSRg','webhooks_processed','WEBHOOK_ERROR','PAYMENT_CREATED','setDate','slice','20hiBKHP','log','default','logWebhookError','sort','white_domain_errors','split','payments_created','replace','join','logShopWebhookError','247623pILdGy','endsWith','171186MKvdFp','🧹\x20Cleaned\x20','loggerService','Failed\x20to\x20clean\x20old\x20logs:','40616roYwGJ','\x20log:','getLogStats','logWhiteDomainResponse','.log','defineProperty','__esModule','cwd','WEBHOOK_RECEIVED','logsDir','logWebhookProcessed','getDate','existsSync','📁\x20Created\x20logs\x20directory:\x20','COINTOPAY_STATUS_CHANGE','message','logs','stack','logPaymentCreated','1529010fZAVoH','stringify','5LBhpGe','size','getLogFileName','unlinkSync','webhooks_received','logWhiteDomainError','toISOString','error','logApiCall','WEBHOOK_PROCESSED','api_calls','LoggerService','9FuTYIw','RESPONSE','Failed\x20to\x20write\x20','cointopay_status_changes','map','logCoinToPayError','shop_webhooks_sent','path','REQUEST','Failed\x20to\x20get\x20log\x20stats:','shop_webhooks_errors','date','ERROR','filter','mtime','logWebhookReceived','statSync','399316zXkMhI','cleanOldLogs','2617788uMpGso','__importDefault','white_domain_requests','logWhiteDomainRequest','logCoinToPayStatus'];a52_0xe197=function(){return _0x51c668;};return a52_0xe197();}function a52_0x5010(_0x2f4866,_0x6ce39){const _0xe1977=a52_0xe197();return a52_0x5010=function(_0x50103b,_0x2516a9){_0x50103b=_0x50103b-0x150;let _0x158d97=_0xe1977[_0x50103b];return _0x158d97;},a52_0x5010(_0x2f4866,_0x6ce39);}(function(_0x1029e5,_0x26f5bc){const _0x2f2d2f=a52_0x5010,_0x1e78fd=_0x1029e5();while(!![]){try{const _0x51e966=-parseInt(_0x2f2d2f(0x155))/0x1+-parseInt(_0x2f2d2f(0x157))/0x2+parseInt(_0x2f2d2f(0x17c))/0x3*(parseInt(_0x2f2d2f(0x18d))/0x4)+-parseInt(_0x2f2d2f(0x170))/0x5*(parseInt(_0x2f2d2f(0x18f))/0x6)+-parseInt(_0x2f2d2f(0x16e))/0x7+-parseInt(_0x2f2d2f(0x15b))/0x8+parseInt(_0x2f2d2f(0x195))/0x9*(parseInt(_0x2f2d2f(0x19b))/0xa);if(_0x51e966===_0x26f5bc)break;else _0x1e78fd['push'](_0x1e78fd['shift']());}catch(_0x451454){_0x1e78fd['push'](_0x1e78fd['shift']());}}}(a52_0xe197,0x45ff4));var __importDefault=this&&this[a52_0x45f40a(0x190)]||function(_0x4a40b8){const _0x407497=a52_0x45f40a;return _0x4a40b8&&_0x4a40b8[_0x407497(0x161)]?_0x4a40b8:{'default':_0x4a40b8};};Object[a52_0x45f40a(0x160)](exports,'__esModule',{'value':!![]}),exports[a52_0x45f40a(0x159)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a52_0x45f40a(0x183)));class LoggerService{constructor(){const _0x56b19b=a52_0x45f40a;this['logsDir']=path_1['default'][_0x56b19b(0x153)](process[_0x56b19b(0x162)](),_0x56b19b(0x16b)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x164531=a52_0x45f40a;!fs_1[_0x164531(0x19d)][_0x164531(0x167)](this[_0x164531(0x164)])&&(fs_1['default']['mkdirSync'](this[_0x164531(0x164)],{'recursive':!![]}),console['log'](_0x164531(0x168)+this[_0x164531(0x164)]));}[a52_0x45f40a(0x172)](_0x5cc704){const _0x2c9e2e=a52_0x45f40a,_0x20eac4=new Date()[_0x2c9e2e(0x176)]()[_0x2c9e2e(0x150)]('T')[0x0];return path_1[_0x2c9e2e(0x19d)][_0x2c9e2e(0x153)](this['logsDir'],_0x5cc704+'_'+_0x20eac4+_0x2c9e2e(0x15f));}['writeLog'](_0x2c2d47,_0x3810ad){const _0x25bf5d=a52_0x45f40a;try{const _0xe7ce64=new Date()[_0x25bf5d(0x176)](),_0x1241f8={'timestamp':_0xe7ce64,..._0x3810ad},_0x1e4fc6=JSON[_0x25bf5d(0x16f)](_0x1241f8)+'\x0a',_0x4f7c62=this['getLogFileName'](_0x2c2d47);fs_1[_0x25bf5d(0x19d)]['appendFileSync'](_0x4f7c62,_0x1e4fc6,'utf8');}catch(_0x4b5348){console[_0x25bf5d(0x177)](_0x25bf5d(0x17e)+_0x2c2d47+_0x25bf5d(0x15c),_0x4b5348);}}[a52_0x45f40a(0x192)](_0x23d680,_0x3f1544,_0x349836,_0x2a98be){const _0x1b7bb6=a52_0x45f40a;this[_0x1b7bb6(0x194)](_0x1b7bb6(0x191),{'type':_0x1b7bb6(0x184),'gateway':_0x23d680,'endpoint':_0x3f1544,'method':_0x349836,'data':_0x2a98be});}[a52_0x45f40a(0x15e)](_0x313c54,_0x490e0a,_0x48fa55,_0x569b1c,_0xb9f6c0){const _0x1b32c4=a52_0x45f40a;this[_0x1b32c4(0x194)]('white_domain_responses',{'type':_0x1b32c4(0x17d),'gateway':_0x313c54,'endpoint':_0x490e0a,'status':_0x48fa55,'responseTime':_0xb9f6c0,'data':_0x569b1c});}[a52_0x45f40a(0x175)](_0x17172c,_0x1bee79,_0x4128ca){const _0x458093=a52_0x45f40a;this['writeLog'](_0x458093(0x1a0),{'type':_0x458093(0x188),'gateway':_0x17172c,'endpoint':_0x1bee79,'error':_0x4128ca instanceof Error?{'message':_0x4128ca[_0x458093(0x16a)],'stack':_0x4128ca[_0x458093(0x16c)]}:_0x4128ca});}[a52_0x45f40a(0x18b)](_0x5368a5,_0x28f9ad,_0x490a08){const _0x7404f=a52_0x45f40a;this[_0x7404f(0x194)](_0x7404f(0x174),{'type':_0x7404f(0x163),'gateway':_0x5368a5,'headers':_0x490a08,'data':_0x28f9ad});}[a52_0x45f40a(0x165)](_0x4c0d67,_0x35e238,_0x4f9dfa,_0x2e5249,_0x18c1a9){const _0x2a9890=a52_0x45f40a;this['writeLog'](_0x2a9890(0x196),{'type':_0x2a9890(0x179),'gateway':_0x4c0d67,'paymentId':_0x35e238,'oldStatus':_0x4f9dfa,'newStatus':_0x2e5249,'originalData':_0x18c1a9});}[a52_0x45f40a(0x19e)](_0x560571,_0x5cf5ee,_0x140348){const _0x3b951b=a52_0x45f40a;this['writeLog']('webhooks_errors',{'type':_0x3b951b(0x197),'gateway':_0x560571,'error':_0x5cf5ee instanceof Error?{'message':_0x5cf5ee[_0x3b951b(0x16a)],'stack':_0x5cf5ee[_0x3b951b(0x16c)]}:_0x5cf5ee,'originalData':_0x140348});}[a52_0x45f40a(0x193)](_0x558de5){const _0x4e69b8=a52_0x45f40a;this[_0x4e69b8(0x194)](_0x4e69b8(0x17f),{'type':_0x4e69b8(0x169),..._0x558de5});}[a52_0x45f40a(0x181)](_0x304614){const _0x4af542=a52_0x45f40a;this[_0x4af542(0x194)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x304614});}['logShopWebhookSent'](_0x472c67,_0x278cf2,_0x133bdb,_0xa9acc6,_0x363b59,_0x53fcf1){const _0x2d527b=a52_0x45f40a;this['writeLog'](_0x2d527b(0x182),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x472c67,'webhookUrl':_0x278cf2,'event':_0x133bdb,'status':_0xa9acc6,'responseTime':_0x363b59,'payload':_0x53fcf1});}[a52_0x45f40a(0x154)](_0x248275,_0x4df494,_0x499acc,_0x4e3c34,_0x194a7e){const _0x442587=a52_0x45f40a;this[_0x442587(0x194)](_0x442587(0x186),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x248275,'webhookUrl':_0x4df494,'event':_0x499acc,'error':_0x4e3c34 instanceof Error?{'message':_0x4e3c34['message'],'stack':_0x4e3c34[_0x442587(0x16c)]}:_0x4e3c34,'payload':_0x194a7e});}[a52_0x45f40a(0x16d)](_0x4f830a,_0x3073a4,_0x386b4b,_0x27d183,_0x4f1bbe){const _0x9c19a9=a52_0x45f40a;this[_0x9c19a9(0x194)](_0x9c19a9(0x151),{'type':_0x9c19a9(0x198),'gateway':_0x4f830a,'paymentId':_0x3073a4,'shopId':_0x386b4b,'amount':_0x27d183,'currency':_0x4f1bbe});}[a52_0x45f40a(0x178)](_0x531e79,_0x1fd768,_0x361f7f,_0x201b43,_0x1a5317){const _0x5a2c6d=a52_0x45f40a;this[_0x5a2c6d(0x194)](_0x5a2c6d(0x17a),{'type':'API_CALL','endpoint':_0x531e79,'method':_0x1fd768,'userId':_0x361f7f,'userRole':_0x201b43,'requestData':_0x1a5317});}[a52_0x45f40a(0x15d)](){const _0x4507fe=a52_0x45f40a;try{const _0x436105=fs_1[_0x4507fe(0x19d)]['readdirSync'](this[_0x4507fe(0x164)]),_0x5eca89=_0x436105[_0x4507fe(0x189)](_0x135b12=>_0x135b12[_0x4507fe(0x156)](_0x4507fe(0x15f))),_0x29e7bf=[...new Set(_0x5eca89['map'](_0x337611=>_0x337611['split']('_')[0x0]))],_0x3bb37d=_0x5eca89[_0x4507fe(0x180)](_0x32e016=>{const _0xa0c1c0=_0x4507fe,_0x2541f2=path_1[_0xa0c1c0(0x19d)][_0xa0c1c0(0x153)](this[_0xa0c1c0(0x164)],_0x32e016),_0x47ab51=fs_1[_0xa0c1c0(0x19d)]['statSync'](_0x2541f2),[_0x76f981,_0x4a1640]=_0x32e016[_0xa0c1c0(0x152)]('.log','')[_0xa0c1c0(0x150)]('_');return{'type':_0x76f981,'date':_0x4a1640,'size':_0x47ab51[_0xa0c1c0(0x171)]};})[_0x4507fe(0x19f)]((_0x57a153,_0x419d2e)=>_0x419d2e[_0x4507fe(0x187)]['localeCompare'](_0x57a153['date']));return{'totalFiles':_0x5eca89['length'],'logTypes':_0x29e7bf,'latestLogs':_0x3bb37d[_0x4507fe(0x19a)](0x0,0xa)};}catch(_0x1915f7){return console[_0x4507fe(0x177)](_0x4507fe(0x185),_0x1915f7),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a52_0x45f40a(0x18e)](_0x39bec0=0x1e){const _0x4a9b42=a52_0x45f40a;try{const _0x553f99=fs_1[_0x4a9b42(0x19d)]['readdirSync'](this['logsDir']),_0x2c1193=new Date();_0x2c1193[_0x4a9b42(0x199)](_0x2c1193[_0x4a9b42(0x166)]()-_0x39bec0);let _0x48c066=0x0;_0x553f99['forEach'](_0x5d78b0=>{const _0x1f0652=_0x4a9b42;if(!_0x5d78b0['endsWith'](_0x1f0652(0x15f)))return;const _0x38be74=path_1[_0x1f0652(0x19d)][_0x1f0652(0x153)](this['logsDir'],_0x5d78b0),_0x136ca1=fs_1['default'][_0x1f0652(0x18c)](_0x38be74);_0x136ca1[_0x1f0652(0x18a)]<_0x2c1193&&(fs_1[_0x1f0652(0x19d)][_0x1f0652(0x173)](_0x38be74),_0x48c066++,console[_0x1f0652(0x19c)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x5d78b0));}),console[_0x4a9b42(0x19c)](_0x4a9b42(0x158)+_0x48c066+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x39bec0+'\x20days)');}catch(_0x5c620f){console[_0x4a9b42(0x177)](_0x4a9b42(0x15a),_0x5c620f);}}}exports[a52_0x45f40a(0x17b)]=LoggerService,exports[a52_0x45f40a(0x159)]=new LoggerService();