'use strict';const a48_0x4d56c8=a48_0xaa80;(function(_0x3abb24,_0x21d57c){const _0x5db32e=a48_0xaa80,_0x405bbc=_0x3abb24();while(!![]){try{const _0x10390f=parseInt(_0x5db32e(0x1a6))/0x1*(-parseInt(_0x5db32e(0x155))/0x2)+-parseInt(_0x5db32e(0x18a))/0x3*(-parseInt(_0x5db32e(0x1a9))/0x4)+parseInt(_0x5db32e(0x16f))/0x5+parseInt(_0x5db32e(0x169))/0x6*(parseInt(_0x5db32e(0x161))/0x7)+-parseInt(_0x5db32e(0x1a3))/0x8*(-parseInt(_0x5db32e(0x182))/0x9)+parseInt(_0x5db32e(0x17d))/0xa+parseInt(_0x5db32e(0x180))/0xb*(-parseInt(_0x5db32e(0x19c))/0xc);if(_0x10390f===_0x21d57c)break;else _0x405bbc['push'](_0x405bbc['shift']());}catch(_0x299727){_0x405bbc['push'](_0x405bbc['shift']());}}}(a48_0x44bb,0xdde9b));var __importDefault=this&&this[a48_0x4d56c8(0x163)]||function(_0xb9dae1){return _0xb9dae1&&_0xb9dae1['__esModule']?_0xb9dae1:{'default':_0xb9dae1};};Object['defineProperty'](exports,a48_0x4d56c8(0x173),{'value':!![]}),exports[a48_0x4d56c8(0x1a7)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x4d56c8(0x15b)));function a48_0x44bb(){const _0x14c922=['WEBHOOK_PROCESSED','white_domain_errors','sort','logWebhookError','error','770552rTfsLD','logShopWebhookSent','logApiCall','1081687FasocD','loggerService','forEach','6824264HJnSoO','LoggerService','setDate','localeCompare','mkdirSync','cwd','default','COINTOPAY_ERROR','statSync','2upmkwj','WEBHOOK_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','utf8','📁\x20Created\x20logs\x20directory:\x20','mtime','path','filter','\x20days)','split','🗑️\x20Deleted\x20old\x20log\x20file:\x20','Failed\x20to\x20clean\x20old\x20logs:','6517ufdWeO','Failed\x20to\x20write\x20','__importDefault','logCoinToPayError','🧹\x20Cleaned\x20','unlinkSync','cleanOldLogs','REQUEST','6966kjQeQs','WEBHOOK_RECEIVED','Failed\x20to\x20get\x20log\x20stats:','shop_webhooks_sent','cointopay_errors','api_calls','7706170vifrqG','logsDir','size','slice','__esModule','date','logCoinToPayStatus','API_CALL','getLogFileName','replace','logWebhookReceived','logs','join','shop_webhooks_errors','2302560eAXgHD','appendFileSync','stringify','1892gyrLNA','RESPONSE','153uvhLvP','cointopay_status_changes','toISOString','getLogStats','PAYMENT_CREATED','logShopWebhookError','white_domain_requests','message','3ztTDNq','getDate','COINTOPAY_STATUS_CHANGE','ensureLogsDirectory','existsSync','endsWith','webhooks_errors','writeLog','length','map','logWebhookProcessed','log','.log','stack','SHOP_WEBHOOK_SENT','readdirSync','webhooks_received','SHOP_WEBHOOK_ERROR','293388hdtnIU','white_domain_responses'];a48_0x44bb=function(){return _0x14c922;};return a48_0x44bb();}function a48_0xaa80(_0x15f137,_0x4aba4f){const _0x44bbfd=a48_0x44bb();return a48_0xaa80=function(_0xaa80e2,_0x1ceeba){_0xaa80e2=_0xaa80e2-0x151;let _0x5539a6=_0x44bbfd[_0xaa80e2];return _0x5539a6;},a48_0xaa80(_0x15f137,_0x4aba4f);}class LoggerService{constructor(){const _0x626b4=a48_0x4d56c8;this[_0x626b4(0x170)]=path_1[_0x626b4(0x152)][_0x626b4(0x17b)](process[_0x626b4(0x151)](),_0x626b4(0x17a)),this[_0x626b4(0x18d)]();}[a48_0x4d56c8(0x18d)](){const _0x3a8e4b=a48_0x4d56c8;!fs_1['default'][_0x3a8e4b(0x18e)](this[_0x3a8e4b(0x170)])&&(fs_1['default'][_0x3a8e4b(0x1ad)](this[_0x3a8e4b(0x170)],{'recursive':!![]}),console['log'](_0x3a8e4b(0x159)+this['logsDir']));}[a48_0x4d56c8(0x177)](_0xa344ff){const _0x34ee75=a48_0x4d56c8,_0x5628fd=new Date()['toISOString']()[_0x34ee75(0x15e)]('T')[0x0];return path_1[_0x34ee75(0x152)][_0x34ee75(0x17b)](this['logsDir'],_0xa344ff+'_'+_0x5628fd+_0x34ee75(0x196));}[a48_0x4d56c8(0x191)](_0x1e47df,_0x274516){const _0x3e34c9=a48_0x4d56c8;try{const _0x31fbdd=new Date()[_0x3e34c9(0x184)](),_0x44eb90={'timestamp':_0x31fbdd,..._0x274516},_0x3d5162=JSON[_0x3e34c9(0x17f)](_0x44eb90)+'\x0a',_0xffe745=this[_0x3e34c9(0x177)](_0x1e47df);fs_1[_0x3e34c9(0x152)][_0x3e34c9(0x17e)](_0xffe745,_0x3d5162,_0x3e34c9(0x158));}catch(_0x2e8ef7){console[_0x3e34c9(0x1a2)](_0x3e34c9(0x162)+_0x1e47df+'\x20log:',_0x2e8ef7);}}['logWhiteDomainRequest'](_0x5df425,_0x5ae672,_0x34d530,_0x14698a){const _0x592a83=a48_0x4d56c8;this[_0x592a83(0x191)](_0x592a83(0x188),{'type':_0x592a83(0x168),'gateway':_0x5df425,'endpoint':_0x5ae672,'method':_0x34d530,'data':_0x14698a});}['logWhiteDomainResponse'](_0x3cd6d5,_0x5152ca,_0x25fb0d,_0x8393bd,_0x4dcab3){const _0x4e9f68=a48_0x4d56c8;this['writeLog'](_0x4e9f68(0x19d),{'type':_0x4e9f68(0x181),'gateway':_0x3cd6d5,'endpoint':_0x5152ca,'status':_0x25fb0d,'responseTime':_0x4dcab3,'data':_0x8393bd});}['logWhiteDomainError'](_0x31a510,_0xa3a611,_0x1efbe6){const _0xc5dde3=a48_0x4d56c8;this[_0xc5dde3(0x191)](_0xc5dde3(0x19f),{'type':'ERROR','gateway':_0x31a510,'endpoint':_0xa3a611,'error':_0x1efbe6 instanceof Error?{'message':_0x1efbe6['message'],'stack':_0x1efbe6[_0xc5dde3(0x197)]}:_0x1efbe6});}[a48_0x4d56c8(0x179)](_0x5c1623,_0x1ed20c,_0x633bac){const _0x2cc514=a48_0x4d56c8;this['writeLog'](_0x2cc514(0x19a),{'type':_0x2cc514(0x16a),'gateway':_0x5c1623,'headers':_0x633bac,'data':_0x1ed20c});}[a48_0x4d56c8(0x194)](_0x233ed3,_0x2810dd,_0x188d22,_0x831a15,_0x47e12d){const _0x5be767=a48_0x4d56c8;this['writeLog']('webhooks_processed',{'type':_0x5be767(0x19e),'gateway':_0x233ed3,'paymentId':_0x2810dd,'oldStatus':_0x188d22,'newStatus':_0x831a15,'originalData':_0x47e12d});}[a48_0x4d56c8(0x1a1)](_0x94ab12,_0x419c4b,_0x3f7014){const _0x4a5bcc=a48_0x4d56c8;this[_0x4a5bcc(0x191)](_0x4a5bcc(0x190),{'type':_0x4a5bcc(0x156),'gateway':_0x94ab12,'error':_0x419c4b instanceof Error?{'message':_0x419c4b[_0x4a5bcc(0x189)],'stack':_0x419c4b[_0x4a5bcc(0x197)]}:_0x419c4b,'originalData':_0x3f7014});}[a48_0x4d56c8(0x175)](_0x19feb2){const _0x125566=a48_0x4d56c8;this[_0x125566(0x191)](_0x125566(0x183),{'type':_0x125566(0x18c),..._0x19feb2});}[a48_0x4d56c8(0x164)](_0x7de0ca){const _0x25468c=a48_0x4d56c8;this['writeLog'](_0x25468c(0x16d),{'type':_0x25468c(0x153),..._0x7de0ca});}[a48_0x4d56c8(0x1a4)](_0x20cc58,_0x5d8ec0,_0x4ac2f6,_0x5b8847,_0x71bef6,_0xeeb507){const _0x514d13=a48_0x4d56c8;this[_0x514d13(0x191)](_0x514d13(0x16c),{'type':_0x514d13(0x198),'shopId':_0x20cc58,'webhookUrl':_0x5d8ec0,'event':_0x4ac2f6,'status':_0x5b8847,'responseTime':_0x71bef6,'payload':_0xeeb507});}[a48_0x4d56c8(0x187)](_0x358c23,_0x44be26,_0x4c3055,_0xb79e22,_0x479e7e){const _0x43a20a=a48_0x4d56c8;this[_0x43a20a(0x191)](_0x43a20a(0x17c),{'type':_0x43a20a(0x19b),'shopId':_0x358c23,'webhookUrl':_0x44be26,'event':_0x4c3055,'error':_0xb79e22 instanceof Error?{'message':_0xb79e22['message'],'stack':_0xb79e22[_0x43a20a(0x197)]}:_0xb79e22,'payload':_0x479e7e});}['logPaymentCreated'](_0x8ae614,_0x204052,_0x55d4e0,_0x384ff5,_0x88070a){const _0x58729c=a48_0x4d56c8;this['writeLog']('payments_created',{'type':_0x58729c(0x186),'gateway':_0x8ae614,'paymentId':_0x204052,'shopId':_0x55d4e0,'amount':_0x384ff5,'currency':_0x88070a});}[a48_0x4d56c8(0x1a5)](_0x5226ea,_0x302945,_0x55acf9,_0x28f602,_0x25f1ad){const _0x42430f=a48_0x4d56c8;this[_0x42430f(0x191)](_0x42430f(0x16e),{'type':_0x42430f(0x176),'endpoint':_0x5226ea,'method':_0x302945,'userId':_0x55acf9,'userRole':_0x28f602,'requestData':_0x25f1ad});}[a48_0x4d56c8(0x185)](){const _0x42f13c=a48_0x4d56c8;try{const _0x3ef80d=fs_1[_0x42f13c(0x152)]['readdirSync'](this[_0x42f13c(0x170)]),_0x35f276=_0x3ef80d[_0x42f13c(0x15c)](_0x270a4f=>_0x270a4f[_0x42f13c(0x18f)](_0x42f13c(0x196))),_0x2cd8ef=[...new Set(_0x35f276['map'](_0x13fbd0=>_0x13fbd0[_0x42f13c(0x15e)]('_')[0x0]))],_0x1363bd=_0x35f276[_0x42f13c(0x193)](_0x5b5d3a=>{const _0x5c4bc4=_0x42f13c,_0x16ba5a=path_1[_0x5c4bc4(0x152)][_0x5c4bc4(0x17b)](this[_0x5c4bc4(0x170)],_0x5b5d3a),_0xb3be25=fs_1[_0x5c4bc4(0x152)]['statSync'](_0x16ba5a),[_0x18b6d7,_0x2c6bce]=_0x5b5d3a[_0x5c4bc4(0x178)](_0x5c4bc4(0x196),'')[_0x5c4bc4(0x15e)]('_');return{'type':_0x18b6d7,'date':_0x2c6bce,'size':_0xb3be25[_0x5c4bc4(0x171)]};})[_0x42f13c(0x1a0)]((_0x2e72ff,_0x151a97)=>_0x151a97[_0x42f13c(0x174)][_0x42f13c(0x1ac)](_0x2e72ff[_0x42f13c(0x174)]));return{'totalFiles':_0x35f276[_0x42f13c(0x192)],'logTypes':_0x2cd8ef,'latestLogs':_0x1363bd[_0x42f13c(0x172)](0x0,0xa)};}catch(_0x3ba794){return console['error'](_0x42f13c(0x16b),_0x3ba794),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x4d56c8(0x167)](_0x1d10cc=0x1e){const _0x506f7d=a48_0x4d56c8;try{const _0x1bec62=fs_1[_0x506f7d(0x152)][_0x506f7d(0x199)](this[_0x506f7d(0x170)]),_0xfb0426=new Date();_0xfb0426[_0x506f7d(0x1ab)](_0xfb0426[_0x506f7d(0x18b)]()-_0x1d10cc);let _0x9dc4b=0x0;_0x1bec62[_0x506f7d(0x1a8)](_0x26e9c5=>{const _0x23817e=_0x506f7d;if(!_0x26e9c5[_0x23817e(0x18f)](_0x23817e(0x196)))return;const _0x241c80=path_1['default'][_0x23817e(0x17b)](this['logsDir'],_0x26e9c5),_0x22da23=fs_1[_0x23817e(0x152)][_0x23817e(0x154)](_0x241c80);_0x22da23[_0x23817e(0x15a)]<_0xfb0426&&(fs_1[_0x23817e(0x152)][_0x23817e(0x166)](_0x241c80),_0x9dc4b++,console[_0x23817e(0x195)](_0x23817e(0x15f)+_0x26e9c5));}),console[_0x506f7d(0x195)](_0x506f7d(0x165)+_0x9dc4b+_0x506f7d(0x157)+_0x1d10cc+_0x506f7d(0x15d));}catch(_0x5080c6){console[_0x506f7d(0x1a2)](_0x506f7d(0x160),_0x5080c6);}}}exports[a48_0x4d56c8(0x1aa)]=LoggerService,exports[a48_0x4d56c8(0x1a7)]=new LoggerService();