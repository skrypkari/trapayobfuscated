'use strict';const a56_0x2200c7=a56_0x1303;(function(_0x566cc4,_0x411f4a){const _0x5f3525=a56_0x1303,_0x218cef=_0x566cc4();while(!![]){try{const _0x595fc9=parseInt(_0x5f3525(0xc3))/0x1*(parseInt(_0x5f3525(0xca))/0x2)+parseInt(_0x5f3525(0xcd))/0x3*(-parseInt(_0x5f3525(0xd6))/0x4)+-parseInt(_0x5f3525(0xae))/0x5+-parseInt(_0x5f3525(0x8e))/0x6+parseInt(_0x5f3525(0xa2))/0x7+parseInt(_0x5f3525(0xa5))/0x8*(parseInt(_0x5f3525(0xc7))/0x9)+parseInt(_0x5f3525(0x9d))/0xa;if(_0x595fc9===_0x411f4a)break;else _0x218cef['push'](_0x218cef['shift']());}catch(_0x271f8e){_0x218cef['push'](_0x218cef['shift']());}}}(a56_0x2766,0xb03fe));var __importDefault=this&&this[a56_0x2200c7(0x96)]||function(_0x3c636d){const _0x5ed275=a56_0x2200c7;return _0x3c636d&&_0x3c636d[_0x5ed275(0x8c)]?_0x3c636d:{'default':_0x3c636d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a56_0x2200c7(0xc9)]=void 0x0;function a56_0x1303(_0x497396,_0xe643d9){const _0x27667e=a56_0x2766();return a56_0x1303=function(_0x13030,_0x361be3){_0x13030=_0x13030-0x8c;let _0x528e64=_0x27667e[_0x13030];return _0x528e64;},a56_0x1303(_0x497396,_0xe643d9);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a56_0x2200c7(0x9b)));function a56_0x2766(){const _0x1fdfc5=['endsWith','logWebhookProcessed','getLogFileName','date','filter','map','RESPONSE','.log','log','1051549EPUPmk','logShopWebhookError','ensureLogsDirectory','SHOP_WEBHOOK_ERROR','404559ydhonk','split','LoggerService','2skHPvy','cwd','logsDir','29154rgGQcr','unlinkSync','sort','logCoinToPayStatus','statSync','ERROR','loggerService','readdirSync','COINTOPAY_ERROR','296gyOjkL','__esModule','logApiCall','8099370tSccjN','toISOString','Failed\x20to\x20get\x20log\x20stats:','logPaymentCreated','error','slice','stack','Failed\x20to\x20write\x20','__importDefault','Failed\x20to\x20clean\x20old\x20logs:','default','white_domain_responses','WEBHOOK_PROCESSED','path','COINTOPAY_STATUS_CHANGE','10393130jiHruz','logShopWebhookSent','writeLog','white_domain_requests','size','9588194dhAprm','\x20days)','shop_webhooks_errors','80jksDQt','🗑️\x20Deleted\x20old\x20log\x20file:\x20','mkdirSync','getDate','stringify','\x20old\x20log\x20files\x20(older\x20than\x20','logWhiteDomainRequest','join','SHOP_WEBHOOK_SENT','5595845eDgcWN','message','webhooks_errors','getLogStats','utf8','REQUEST','WEBHOOK_RECEIVED','API_CALL','logWhiteDomainError','length','webhooks_received','\x20log:'];a56_0x2766=function(){return _0x1fdfc5;};return a56_0x2766();}class LoggerService{constructor(){const _0x22c5da=a56_0x2200c7;this['logsDir']=path_1['default'][_0x22c5da(0xac)](process[_0x22c5da(0xcb)](),'logs'),this[_0x22c5da(0xc5)]();}[a56_0x2200c7(0xc5)](){const _0x393def=a56_0x2200c7;!fs_1[_0x393def(0x98)]['existsSync'](this[_0x393def(0xcc)])&&(fs_1[_0x393def(0x98)][_0x393def(0xa7)](this['logsDir'],{'recursive':!![]}),console[_0x393def(0xc2)]('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a56_0x2200c7(0xbc)](_0x5ec6ab){const _0xed0fb1=a56_0x2200c7,_0x765982=new Date()[_0xed0fb1(0x8f)]()[_0xed0fb1(0xc8)]('T')[0x0];return path_1[_0xed0fb1(0x98)][_0xed0fb1(0xac)](this[_0xed0fb1(0xcc)],_0x5ec6ab+'_'+_0x765982+'.log');}[a56_0x2200c7(0x9f)](_0x5c66d2,_0x49018d){const _0x3eb6b0=a56_0x2200c7;try{const _0x43c7e9=new Date()['toISOString'](),_0x3d98b4={'timestamp':_0x43c7e9,..._0x49018d},_0x219b02=JSON[_0x3eb6b0(0xa9)](_0x3d98b4)+'\x0a',_0x5595e5=this[_0x3eb6b0(0xbc)](_0x5c66d2);fs_1['default']['appendFileSync'](_0x5595e5,_0x219b02,_0x3eb6b0(0xb2));}catch(_0x4a9eb3){console['error'](_0x3eb6b0(0x95)+_0x5c66d2+_0x3eb6b0(0xb9),_0x4a9eb3);}}[a56_0x2200c7(0xab)](_0x171f75,_0x537fe4,_0x24d496,_0x2fdd35){const _0x25bd9c=a56_0x2200c7;this['writeLog'](_0x25bd9c(0xa0),{'type':_0x25bd9c(0xb3),'gateway':_0x171f75,'endpoint':_0x537fe4,'method':_0x24d496,'data':_0x2fdd35});}['logWhiteDomainResponse'](_0x1bec1d,_0x3256b1,_0x518951,_0x5bf227,_0x98a0aa){const _0x416a7d=a56_0x2200c7;this[_0x416a7d(0x9f)](_0x416a7d(0x99),{'type':_0x416a7d(0xc0),'gateway':_0x1bec1d,'endpoint':_0x3256b1,'status':_0x518951,'responseTime':_0x98a0aa,'data':_0x5bf227});}[a56_0x2200c7(0xb6)](_0x2ae85a,_0x55ca10,_0x462602){const _0x37255d=a56_0x2200c7;this['writeLog']('white_domain_errors',{'type':_0x37255d(0xd2),'gateway':_0x2ae85a,'endpoint':_0x55ca10,'error':_0x462602 instanceof Error?{'message':_0x462602[_0x37255d(0xaf)],'stack':_0x462602['stack']}:_0x462602});}['logWebhookReceived'](_0x2f161d,_0x586cc6,_0x111765){const _0x389358=a56_0x2200c7;this['writeLog'](_0x389358(0xb8),{'type':_0x389358(0xb4),'gateway':_0x2f161d,'headers':_0x111765,'data':_0x586cc6});}[a56_0x2200c7(0xbb)](_0xac277a,_0x551163,_0x10ce51,_0x130ca2,_0x1c579c){const _0x2f8b77=a56_0x2200c7;this[_0x2f8b77(0x9f)]('webhooks_processed',{'type':_0x2f8b77(0x9a),'gateway':_0xac277a,'paymentId':_0x551163,'oldStatus':_0x10ce51,'newStatus':_0x130ca2,'originalData':_0x1c579c});}['logWebhookError'](_0x10196b,_0x1f4f86,_0x14fa4d){const _0x206991=a56_0x2200c7;this[_0x206991(0x9f)](_0x206991(0xb0),{'type':'WEBHOOK_ERROR','gateway':_0x10196b,'error':_0x1f4f86 instanceof Error?{'message':_0x1f4f86[_0x206991(0xaf)],'stack':_0x1f4f86['stack']}:_0x1f4f86,'originalData':_0x14fa4d});}[a56_0x2200c7(0xd0)](_0x586f3b){const _0x1e5079=a56_0x2200c7;this[_0x1e5079(0x9f)]('cointopay_status_changes',{'type':_0x1e5079(0x9c),..._0x586f3b});}['logCoinToPayError'](_0x17b17d){const _0x2c1da6=a56_0x2200c7;this[_0x2c1da6(0x9f)]('cointopay_errors',{'type':_0x2c1da6(0xd5),..._0x17b17d});}[a56_0x2200c7(0x9e)](_0x647bca,_0x6ee9a0,_0x5950d5,_0x2d78fe,_0x1865b9,_0x3a5f6a){const _0x85f4c8=a56_0x2200c7;this[_0x85f4c8(0x9f)]('shop_webhooks_sent',{'type':_0x85f4c8(0xad),'shopId':_0x647bca,'webhookUrl':_0x6ee9a0,'event':_0x5950d5,'status':_0x2d78fe,'responseTime':_0x1865b9,'payload':_0x3a5f6a});}[a56_0x2200c7(0xc4)](_0x15014e,_0x4ca20f,_0x256b6d,_0x40f4e9,_0x2fa2c0){const _0xb0ce2=a56_0x2200c7;this['writeLog'](_0xb0ce2(0xa4),{'type':_0xb0ce2(0xc6),'shopId':_0x15014e,'webhookUrl':_0x4ca20f,'event':_0x256b6d,'error':_0x40f4e9 instanceof Error?{'message':_0x40f4e9[_0xb0ce2(0xaf)],'stack':_0x40f4e9[_0xb0ce2(0x94)]}:_0x40f4e9,'payload':_0x2fa2c0});}[a56_0x2200c7(0x91)](_0x2d7029,_0x50e7ae,_0x59b891,_0x4ddffe,_0x4818c9){const _0x1828e6=a56_0x2200c7;this[_0x1828e6(0x9f)]('payments_created',{'type':'PAYMENT_CREATED','gateway':_0x2d7029,'paymentId':_0x50e7ae,'shopId':_0x59b891,'amount':_0x4ddffe,'currency':_0x4818c9});}[a56_0x2200c7(0x8d)](_0x113275,_0x363245,_0x472533,_0x53d3a9,_0x3f63ee){const _0x584032=a56_0x2200c7;this[_0x584032(0x9f)]('api_calls',{'type':_0x584032(0xb5),'endpoint':_0x113275,'method':_0x363245,'userId':_0x472533,'userRole':_0x53d3a9,'requestData':_0x3f63ee});}[a56_0x2200c7(0xb1)](){const _0x32fe69=a56_0x2200c7;try{const _0x4cd31c=fs_1[_0x32fe69(0x98)][_0x32fe69(0xd4)](this[_0x32fe69(0xcc)]),_0x479d05=_0x4cd31c[_0x32fe69(0xbe)](_0x3a8b80=>_0x3a8b80[_0x32fe69(0xba)]('.log')),_0x35164b=[...new Set(_0x479d05[_0x32fe69(0xbf)](_0x1f1fe8=>_0x1f1fe8[_0x32fe69(0xc8)]('_')[0x0]))],_0x23cc3f=_0x479d05['map'](_0x13301f=>{const _0x5a9adb=_0x32fe69,_0x217dc8=path_1['default']['join'](this[_0x5a9adb(0xcc)],_0x13301f),_0x5604ab=fs_1[_0x5a9adb(0x98)][_0x5a9adb(0xd1)](_0x217dc8),[_0x29e315,_0x37a039]=_0x13301f['replace'](_0x5a9adb(0xc1),'')['split']('_');return{'type':_0x29e315,'date':_0x37a039,'size':_0x5604ab[_0x5a9adb(0xa1)]};})[_0x32fe69(0xcf)]((_0x46cd83,_0x3d8a4c)=>_0x3d8a4c['date']['localeCompare'](_0x46cd83[_0x32fe69(0xbd)]));return{'totalFiles':_0x479d05[_0x32fe69(0xb7)],'logTypes':_0x35164b,'latestLogs':_0x23cc3f[_0x32fe69(0x93)](0x0,0xa)};}catch(_0x56cce1){return console[_0x32fe69(0x92)](_0x32fe69(0x90),_0x56cce1),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x4e354e=0x1e){const _0x366afa=a56_0x2200c7;try{const _0x2cb497=fs_1[_0x366afa(0x98)][_0x366afa(0xd4)](this[_0x366afa(0xcc)]),_0x566366=new Date();_0x566366['setDate'](_0x566366[_0x366afa(0xa8)]()-_0x4e354e);let _0xe3e554=0x0;_0x2cb497['forEach'](_0x4d8c85=>{const _0x3bed2c=_0x366afa;if(!_0x4d8c85['endsWith']('.log'))return;const _0x6f4274=path_1[_0x3bed2c(0x98)]['join'](this[_0x3bed2c(0xcc)],_0x4d8c85),_0x576c8a=fs_1['default'][_0x3bed2c(0xd1)](_0x6f4274);_0x576c8a['mtime']<_0x566366&&(fs_1[_0x3bed2c(0x98)][_0x3bed2c(0xce)](_0x6f4274),_0xe3e554++,console[_0x3bed2c(0xc2)](_0x3bed2c(0xa6)+_0x4d8c85));}),console[_0x366afa(0xc2)]('🧹\x20Cleaned\x20'+_0xe3e554+_0x366afa(0xaa)+_0x4e354e+_0x366afa(0xa3));}catch(_0x2018f6){console[_0x366afa(0x92)](_0x366afa(0x97),_0x2018f6);}}}exports['LoggerService']=LoggerService,exports[a56_0x2200c7(0xd3)]=new LoggerService();