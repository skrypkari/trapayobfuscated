'use strict';function a48_0x1114(){const _0xf1b45a=['logWebhookProcessed','logs','🗑️\x20Deleted\x20old\x20log\x20file:\x20','writeLog','logWebhookError','49UwmWgk','logShopWebhookError','stringify','\x20days)','replace','sort','ensureLogsDirectory','3187028tisuHE','statSync','logWhiteDomainRequest','RESPONSE','647970ECyFTC','cwd','SHOP_WEBHOOK_ERROR','default','logWhiteDomainResponse','map','toISOString','logShopWebhookSent','white_domain_responses','245748rBtfxj','api_calls','getLogStats','loggerService','error','ERROR','3535288JsYRjW','existsSync','message','cleanOldLogs','__esModule','shop_webhooks_errors','REQUEST','split','logApiCall','logsDir','join','Failed\x20to\x20get\x20log\x20stats:','PAYMENT_CREATED','forEach','appendFileSync','localeCompare','488065gFIVjt','length','log','logWebhookReceived','path','__importDefault','124zBsgdW','date','setDate','white_domain_errors','9ahLhqG','COINTOPAY_STATUS_CHANGE','464835kmyNuP','size','getLogFileName','WEBHOOK_ERROR','WEBHOOK_PROCESSED','stack','webhooks_received','logCoinToPayStatus','white_domain_requests','87414PhyMuD','shop_webhooks_sent','mkdirSync','endsWith','COINTOPAY_ERROR','slice','WEBHOOK_RECEIVED','readdirSync','LoggerService','.log','getDate','🧹\x20Cleaned\x20','253GnTrxo','payments_created','webhooks_processed'];a48_0x1114=function(){return _0xf1b45a;};return a48_0x1114();}const a48_0x155c9b=a48_0x4080;(function(_0x4f4fbc,_0x41a284){const _0x4d9ebe=a48_0x4080,_0x23cfff=_0x4f4fbc();while(!![]){try{const _0x592d13=parseInt(_0x4d9ebe(0x145))/0x1+parseInt(_0x4d9ebe(0x122))/0x2+parseInt(_0x4d9ebe(0x15a))/0x3*(parseInt(_0x4d9ebe(0x14b))/0x4)+parseInt(_0x4d9ebe(0x151))/0x5+parseInt(_0x4d9ebe(0x12f))/0x6*(-parseInt(_0x4d9ebe(0x11b))/0x7)+parseInt(_0x4d9ebe(0x135))/0x8*(-parseInt(_0x4d9ebe(0x14f))/0x9)+parseInt(_0x4d9ebe(0x126))/0xa*(-parseInt(_0x4d9ebe(0x166))/0xb);if(_0x592d13===_0x41a284)break;else _0x23cfff['push'](_0x23cfff['shift']());}catch(_0x14a31e){_0x23cfff['push'](_0x23cfff['shift']());}}}(a48_0x1114,0xd1afc));var __importDefault=this&&this[a48_0x155c9b(0x14a)]||function(_0x4b565e){return _0x4b565e&&_0x4b565e['__esModule']?_0x4b565e:{'default':_0x4b565e};};Object['defineProperty'](exports,a48_0x155c9b(0x139),{'value':!![]}),exports[a48_0x155c9b(0x132)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x155c9b(0x149)));function a48_0x4080(_0x35ea57,_0x494beb){const _0x111467=a48_0x1114();return a48_0x4080=function(_0x4080ed,_0x124494){_0x4080ed=_0x4080ed-0x117;let _0x47a7b9=_0x111467[_0x4080ed];return _0x47a7b9;},a48_0x4080(_0x35ea57,_0x494beb);}class LoggerService{constructor(){const _0x14d983=a48_0x155c9b;this[_0x14d983(0x13e)]=path_1[_0x14d983(0x129)][_0x14d983(0x13f)](process[_0x14d983(0x127)](),_0x14d983(0x117)),this['ensureLogsDirectory']();}[a48_0x155c9b(0x121)](){const _0x4542d9=a48_0x155c9b;!fs_1[_0x4542d9(0x129)][_0x4542d9(0x136)](this[_0x4542d9(0x13e)])&&(fs_1[_0x4542d9(0x129)][_0x4542d9(0x15c)](this['logsDir'],{'recursive':!![]}),console[_0x4542d9(0x147)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x4542d9(0x13e)]));}[a48_0x155c9b(0x153)](_0x88da0){const _0x3f0561=a48_0x155c9b,_0x3bc27f=new Date()[_0x3f0561(0x12c)]()[_0x3f0561(0x13c)]('T')[0x0];return path_1[_0x3f0561(0x129)]['join'](this[_0x3f0561(0x13e)],_0x88da0+'_'+_0x3bc27f+'.log');}[a48_0x155c9b(0x119)](_0x449834,_0x56507d){const _0x189db3=a48_0x155c9b;try{const _0x2e1b2b=new Date()['toISOString'](),_0x25a0c7={'timestamp':_0x2e1b2b,..._0x56507d},_0x2f9a87=JSON[_0x189db3(0x11d)](_0x25a0c7)+'\x0a',_0x54c0d7=this[_0x189db3(0x153)](_0x449834);fs_1[_0x189db3(0x129)][_0x189db3(0x143)](_0x54c0d7,_0x2f9a87,'utf8');}catch(_0x3becf4){console[_0x189db3(0x133)]('Failed\x20to\x20write\x20'+_0x449834+'\x20log:',_0x3becf4);}}[a48_0x155c9b(0x124)](_0x1ffa4d,_0x8da617,_0x23c724,_0xe2d89a){const _0x32ee46=a48_0x155c9b;this[_0x32ee46(0x119)](_0x32ee46(0x159),{'type':_0x32ee46(0x13b),'gateway':_0x1ffa4d,'endpoint':_0x8da617,'method':_0x23c724,'data':_0xe2d89a});}[a48_0x155c9b(0x12a)](_0x464ead,_0x5cf062,_0x5930ef,_0x39661d,_0xbce803){const _0x252752=a48_0x155c9b;this[_0x252752(0x119)](_0x252752(0x12e),{'type':_0x252752(0x125),'gateway':_0x464ead,'endpoint':_0x5cf062,'status':_0x5930ef,'responseTime':_0xbce803,'data':_0x39661d});}['logWhiteDomainError'](_0x3911e8,_0x53dd67,_0x34124c){const _0x460096=a48_0x155c9b;this[_0x460096(0x119)](_0x460096(0x14e),{'type':_0x460096(0x134),'gateway':_0x3911e8,'endpoint':_0x53dd67,'error':_0x34124c instanceof Error?{'message':_0x34124c[_0x460096(0x137)],'stack':_0x34124c[_0x460096(0x156)]}:_0x34124c});}[a48_0x155c9b(0x148)](_0x39db75,_0x18abdc,_0x4cfd25){const _0x346018=a48_0x155c9b;this[_0x346018(0x119)](_0x346018(0x157),{'type':_0x346018(0x160),'gateway':_0x39db75,'headers':_0x4cfd25,'data':_0x18abdc});}[a48_0x155c9b(0x169)](_0x2bf9b0,_0x289317,_0x2cf64c,_0x2e6f94,_0x3d357d){const _0x5ad217=a48_0x155c9b;this['writeLog'](_0x5ad217(0x168),{'type':_0x5ad217(0x155),'gateway':_0x2bf9b0,'paymentId':_0x289317,'oldStatus':_0x2cf64c,'newStatus':_0x2e6f94,'originalData':_0x3d357d});}[a48_0x155c9b(0x11a)](_0x60c265,_0x491693,_0xe1aab9){const _0x38473b=a48_0x155c9b;this[_0x38473b(0x119)]('webhooks_errors',{'type':_0x38473b(0x154),'gateway':_0x60c265,'error':_0x491693 instanceof Error?{'message':_0x491693[_0x38473b(0x137)],'stack':_0x491693[_0x38473b(0x156)]}:_0x491693,'originalData':_0xe1aab9});}[a48_0x155c9b(0x158)](_0x48beec){const _0x1197b5=a48_0x155c9b;this['writeLog']('cointopay_status_changes',{'type':_0x1197b5(0x150),..._0x48beec});}['logCoinToPayError'](_0x2cc676){const _0x500992=a48_0x155c9b;this[_0x500992(0x119)]('cointopay_errors',{'type':_0x500992(0x15e),..._0x2cc676});}[a48_0x155c9b(0x12d)](_0x14e100,_0x4e0e8b,_0x5d9641,_0x5e2357,_0x34761b,_0x5e1f50){const _0x2892f9=a48_0x155c9b;this['writeLog'](_0x2892f9(0x15b),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x14e100,'webhookUrl':_0x4e0e8b,'event':_0x5d9641,'status':_0x5e2357,'responseTime':_0x34761b,'payload':_0x5e1f50});}[a48_0x155c9b(0x11c)](_0x440455,_0x4f0d80,_0x42d80f,_0x4c07e8,_0x1e8bff){const _0x5293f0=a48_0x155c9b;this[_0x5293f0(0x119)](_0x5293f0(0x13a),{'type':_0x5293f0(0x128),'shopId':_0x440455,'webhookUrl':_0x4f0d80,'event':_0x42d80f,'error':_0x4c07e8 instanceof Error?{'message':_0x4c07e8[_0x5293f0(0x137)],'stack':_0x4c07e8[_0x5293f0(0x156)]}:_0x4c07e8,'payload':_0x1e8bff});}['logPaymentCreated'](_0x13e098,_0x258bc1,_0x2a9f59,_0x21b523,_0x8a0be0){const _0x3713c5=a48_0x155c9b;this[_0x3713c5(0x119)](_0x3713c5(0x167),{'type':_0x3713c5(0x141),'gateway':_0x13e098,'paymentId':_0x258bc1,'shopId':_0x2a9f59,'amount':_0x21b523,'currency':_0x8a0be0});}[a48_0x155c9b(0x13d)](_0xe3ebbd,_0x3af71a,_0x5f3f62,_0xaa8eb6,_0x855789){const _0x3cde1b=a48_0x155c9b;this[_0x3cde1b(0x119)](_0x3cde1b(0x130),{'type':'API_CALL','endpoint':_0xe3ebbd,'method':_0x3af71a,'userId':_0x5f3f62,'userRole':_0xaa8eb6,'requestData':_0x855789});}[a48_0x155c9b(0x131)](){const _0x592a36=a48_0x155c9b;try{const _0x3a5339=fs_1[_0x592a36(0x129)][_0x592a36(0x161)](this[_0x592a36(0x13e)]),_0x252f7f=_0x3a5339['filter'](_0x26f52e=>_0x26f52e['endsWith'](_0x592a36(0x163))),_0x2ee06d=[...new Set(_0x252f7f[_0x592a36(0x12b)](_0x4012c7=>_0x4012c7[_0x592a36(0x13c)]('_')[0x0]))],_0x4505d0=_0x252f7f['map'](_0x5381af=>{const _0x4d0f24=_0x592a36,_0x84a66=path_1[_0x4d0f24(0x129)][_0x4d0f24(0x13f)](this[_0x4d0f24(0x13e)],_0x5381af),_0x2f2b9c=fs_1['default'][_0x4d0f24(0x123)](_0x84a66),[_0xe01f9f,_0x5c41ab]=_0x5381af[_0x4d0f24(0x11f)](_0x4d0f24(0x163),'')['split']('_');return{'type':_0xe01f9f,'date':_0x5c41ab,'size':_0x2f2b9c[_0x4d0f24(0x152)]};})[_0x592a36(0x120)]((_0xfaf279,_0x565fb7)=>_0x565fb7[_0x592a36(0x14c)][_0x592a36(0x144)](_0xfaf279[_0x592a36(0x14c)]));return{'totalFiles':_0x252f7f[_0x592a36(0x146)],'logTypes':_0x2ee06d,'latestLogs':_0x4505d0[_0x592a36(0x15f)](0x0,0xa)};}catch(_0x44df34){return console['error'](_0x592a36(0x140),_0x44df34),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x155c9b(0x138)](_0x1d52ad=0x1e){const _0x55504f=a48_0x155c9b;try{const _0x51f105=fs_1[_0x55504f(0x129)]['readdirSync'](this[_0x55504f(0x13e)]),_0x3a8460=new Date();_0x3a8460[_0x55504f(0x14d)](_0x3a8460[_0x55504f(0x164)]()-_0x1d52ad);let _0x56893a=0x0;_0x51f105[_0x55504f(0x142)](_0x4f9bc0=>{const _0x5ede04=_0x55504f;if(!_0x4f9bc0[_0x5ede04(0x15d)](_0x5ede04(0x163)))return;const _0x47975f=path_1['default'][_0x5ede04(0x13f)](this[_0x5ede04(0x13e)],_0x4f9bc0),_0x52cbc1=fs_1[_0x5ede04(0x129)][_0x5ede04(0x123)](_0x47975f);_0x52cbc1['mtime']<_0x3a8460&&(fs_1[_0x5ede04(0x129)]['unlinkSync'](_0x47975f),_0x56893a++,console['log'](_0x5ede04(0x118)+_0x4f9bc0));}),console['log'](_0x55504f(0x165)+_0x56893a+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x1d52ad+_0x55504f(0x11e));}catch(_0x390bf9){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x390bf9);}}}exports[a48_0x155c9b(0x162)]=LoggerService,exports['loggerService']=new LoggerService();