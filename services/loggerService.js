'use strict';const a48_0x241a6a=a48_0x5ece;(function(_0xd1ccf0,_0x1fd908){const _0x1a846b=a48_0x5ece,_0xd5405e=_0xd1ccf0();while(!![]){try{const _0x54f02d=-parseInt(_0x1a846b(0x180))/0x1*(parseInt(_0x1a846b(0x17b))/0x2)+parseInt(_0x1a846b(0x166))/0x3+parseInt(_0x1a846b(0x15c))/0x4+parseInt(_0x1a846b(0x16a))/0x5*(parseInt(_0x1a846b(0x14b))/0x6)+-parseInt(_0x1a846b(0x16e))/0x7+-parseInt(_0x1a846b(0x181))/0x8*(-parseInt(_0x1a846b(0x161))/0x9)+-parseInt(_0x1a846b(0x182))/0xa*(parseInt(_0x1a846b(0x15b))/0xb);if(_0x54f02d===_0x1fd908)break;else _0xd5405e['push'](_0xd5405e['shift']());}catch(_0x572398){_0xd5405e['push'](_0xd5405e['shift']());}}}(a48_0x4068,0x94a43));var __importDefault=this&&this['__importDefault']||function(_0x594e08){return _0x594e08&&_0x594e08['__esModule']?_0x594e08:{'default':_0x594e08};};Object['defineProperty'](exports,a48_0x241a6a(0x15d),{'value':!![]}),exports[a48_0x241a6a(0x152)]=exports[a48_0x241a6a(0x173)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x241a6a(0x176)));function a48_0x5ece(_0x54051d,_0x306a5b){const _0x4068ac=a48_0x4068();return a48_0x5ece=function(_0x5ece32,_0x1262be){_0x5ece32=_0x5ece32-0x13d;let _0x3087c9=_0x4068ac[_0x5ece32];return _0x3087c9;},a48_0x5ece(_0x54051d,_0x306a5b);}function a48_0x4068(){const _0x5f4f07=['getLogFileName','stack','cleanOldLogs','🗑️\x20Deleted\x20old\x20log\x20file:\x20','218LmkoYJ','join','api_calls','WEBHOOK_PROCESSED','logWhiteDomainError','3573nbkOCR','47864ggkejE','40RwkLcx','statSync','cointopay_status_changes','logShopWebhookSent','📁\x20Created\x20logs\x20directory:\x20','\x20old\x20log\x20files\x20(older\x20than\x20','ERROR','RESPONSE','date','shop_webhooks_sent','slice','Failed\x20to\x20clean\x20old\x20logs:','cointopay_errors','Failed\x20to\x20write\x20','logs','logsDir','mtime','SHOP_WEBHOOK_ERROR','default','endsWith','.log','mkdirSync','payments_created','logCoinToPayError','log','stringify','webhooks_processed','6SRifWl','white_domain_errors','split','COINTOPAY_ERROR','logPaymentCreated','writeLog','logWebhookError','loggerService','readdirSync','logCoinToPayStatus','logWebhookReceived','unlinkSync','PAYMENT_CREATED','white_domain_responses','ensureLogsDirectory','logShopWebhookError','607266TTwzpB','977932VLBXXk','__esModule','shop_webhooks_errors','error','map','54impjWx','logWebhookProcessed','getDate','replace','logWhiteDomainResponse','2813544yYTeXN','WEBHOOK_RECEIVED','🧹\x20Cleaned\x20','white_domain_requests','4746335XmBxqa','filter','message','API_CALL','6638660MeAnxg','utf8','toISOString','localeCompare','Failed\x20to\x20get\x20log\x20stats:','LoggerService','REQUEST','forEach','path'];a48_0x4068=function(){return _0x5f4f07;};return a48_0x4068();}class LoggerService{constructor(){const _0x17ed8b=a48_0x241a6a;this[_0x17ed8b(0x13f)]=path_1[_0x17ed8b(0x142)]['join'](process['cwd'](),_0x17ed8b(0x13e)),this[_0x17ed8b(0x159)]();}[a48_0x241a6a(0x159)](){const _0x3ead78=a48_0x241a6a;!fs_1[_0x3ead78(0x142)]['existsSync'](this['logsDir'])&&(fs_1[_0x3ead78(0x142)][_0x3ead78(0x145)](this['logsDir'],{'recursive':!![]}),console[_0x3ead78(0x148)](_0x3ead78(0x186)+this['logsDir']));}[a48_0x241a6a(0x177)](_0x41f37a){const _0x375d0e=a48_0x241a6a,_0x5c0e5a=new Date()[_0x375d0e(0x170)]()[_0x375d0e(0x14d)]('T')[0x0];return path_1[_0x375d0e(0x142)]['join'](this[_0x375d0e(0x13f)],_0x41f37a+'_'+_0x5c0e5a+'.log');}[a48_0x241a6a(0x150)](_0x4348e1,_0x7f04a4){const _0x1e6687=a48_0x241a6a;try{const _0x23ab98=new Date()[_0x1e6687(0x170)](),_0x4638be={'timestamp':_0x23ab98,..._0x7f04a4},_0x466549=JSON[_0x1e6687(0x149)](_0x4638be)+'\x0a',_0x363a0=this[_0x1e6687(0x177)](_0x4348e1);fs_1[_0x1e6687(0x142)]['appendFileSync'](_0x363a0,_0x466549,_0x1e6687(0x16f));}catch(_0x342a7e){console[_0x1e6687(0x15f)](_0x1e6687(0x13d)+_0x4348e1+'\x20log:',_0x342a7e);}}['logWhiteDomainRequest'](_0x4edeb8,_0x31a696,_0x1083e9,_0x3aa96d){const _0x221199=a48_0x241a6a;this[_0x221199(0x150)](_0x221199(0x169),{'type':_0x221199(0x174),'gateway':_0x4edeb8,'endpoint':_0x31a696,'method':_0x1083e9,'data':_0x3aa96d});}[a48_0x241a6a(0x165)](_0x511cc7,_0x251018,_0x306860,_0x7e3e32,_0x1c06ad){const _0x4c28d0=a48_0x241a6a;this['writeLog'](_0x4c28d0(0x158),{'type':_0x4c28d0(0x189),'gateway':_0x511cc7,'endpoint':_0x251018,'status':_0x306860,'responseTime':_0x1c06ad,'data':_0x7e3e32});}[a48_0x241a6a(0x17f)](_0x197747,_0x477bda,_0x2d4619){const _0x5a6e5f=a48_0x241a6a;this[_0x5a6e5f(0x150)](_0x5a6e5f(0x14c),{'type':_0x5a6e5f(0x188),'gateway':_0x197747,'endpoint':_0x477bda,'error':_0x2d4619 instanceof Error?{'message':_0x2d4619['message'],'stack':_0x2d4619[_0x5a6e5f(0x178)]}:_0x2d4619});}[a48_0x241a6a(0x155)](_0x22d4dc,_0x1a7f78,_0x356051){const _0x39364b=a48_0x241a6a;this[_0x39364b(0x150)]('webhooks_received',{'type':_0x39364b(0x167),'gateway':_0x22d4dc,'headers':_0x356051,'data':_0x1a7f78});}[a48_0x241a6a(0x162)](_0x1b2026,_0x5390ea,_0x481492,_0x38850d,_0x56a873){const _0x851a99=a48_0x241a6a;this[_0x851a99(0x150)](_0x851a99(0x14a),{'type':_0x851a99(0x17e),'gateway':_0x1b2026,'paymentId':_0x5390ea,'oldStatus':_0x481492,'newStatus':_0x38850d,'originalData':_0x56a873});}[a48_0x241a6a(0x151)](_0x4ea719,_0x4f59cc,_0x344ad0){const _0xca8d0d=a48_0x241a6a;this[_0xca8d0d(0x150)]('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x4ea719,'error':_0x4f59cc instanceof Error?{'message':_0x4f59cc['message'],'stack':_0x4f59cc['stack']}:_0x4f59cc,'originalData':_0x344ad0});}[a48_0x241a6a(0x154)](_0x5227f6){const _0x2a3840=a48_0x241a6a;this[_0x2a3840(0x150)](_0x2a3840(0x184),{'type':'COINTOPAY_STATUS_CHANGE',..._0x5227f6});}[a48_0x241a6a(0x147)](_0x193aa0){const _0x2e70f0=a48_0x241a6a;this[_0x2e70f0(0x150)](_0x2e70f0(0x18e),{'type':_0x2e70f0(0x14e),..._0x193aa0});}[a48_0x241a6a(0x185)](_0x56fb58,_0x219fa7,_0x496d2e,_0x3eaa11,_0x171434,_0x516ab1){const _0x497120=a48_0x241a6a;this[_0x497120(0x150)](_0x497120(0x18b),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x56fb58,'webhookUrl':_0x219fa7,'event':_0x496d2e,'status':_0x3eaa11,'responseTime':_0x171434,'payload':_0x516ab1});}[a48_0x241a6a(0x15a)](_0x429777,_0x3d225d,_0x3cb287,_0x8da493,_0x1e37c6){const _0xf1772=a48_0x241a6a;this['writeLog'](_0xf1772(0x15e),{'type':_0xf1772(0x141),'shopId':_0x429777,'webhookUrl':_0x3d225d,'event':_0x3cb287,'error':_0x8da493 instanceof Error?{'message':_0x8da493[_0xf1772(0x16c)],'stack':_0x8da493['stack']}:_0x8da493,'payload':_0x1e37c6});}[a48_0x241a6a(0x14f)](_0x4e63de,_0x63e6b0,_0x480528,_0x16efbc,_0x81f91c){const _0x22e227=a48_0x241a6a;this[_0x22e227(0x150)](_0x22e227(0x146),{'type':_0x22e227(0x157),'gateway':_0x4e63de,'paymentId':_0x63e6b0,'shopId':_0x480528,'amount':_0x16efbc,'currency':_0x81f91c});}['logApiCall'](_0x363309,_0x1c8346,_0x3390b7,_0x327aec,_0xc10a0a){const _0x284d71=a48_0x241a6a;this[_0x284d71(0x150)](_0x284d71(0x17d),{'type':_0x284d71(0x16d),'endpoint':_0x363309,'method':_0x1c8346,'userId':_0x3390b7,'userRole':_0x327aec,'requestData':_0xc10a0a});}['getLogStats'](){const _0x557159=a48_0x241a6a;try{const _0x5a7aee=fs_1[_0x557159(0x142)][_0x557159(0x153)](this[_0x557159(0x13f)]),_0x5493f5=_0x5a7aee[_0x557159(0x16b)](_0x40fc10=>_0x40fc10[_0x557159(0x143)](_0x557159(0x144))),_0x351a14=[...new Set(_0x5493f5[_0x557159(0x160)](_0x17d97c=>_0x17d97c['split']('_')[0x0]))],_0x2c8915=_0x5493f5['map'](_0x1e4b5a=>{const _0xd99bec=_0x557159,_0x37f860=path_1[_0xd99bec(0x142)]['join'](this[_0xd99bec(0x13f)],_0x1e4b5a),_0x43f3a4=fs_1['default'][_0xd99bec(0x183)](_0x37f860),[_0x20b6bc,_0xe832e9]=_0x1e4b5a[_0xd99bec(0x164)](_0xd99bec(0x144),'')[_0xd99bec(0x14d)]('_');return{'type':_0x20b6bc,'date':_0xe832e9,'size':_0x43f3a4['size']};})['sort']((_0x2898ec,_0x5d72b9)=>_0x5d72b9[_0x557159(0x18a)][_0x557159(0x171)](_0x2898ec[_0x557159(0x18a)]));return{'totalFiles':_0x5493f5['length'],'logTypes':_0x351a14,'latestLogs':_0x2c8915[_0x557159(0x18c)](0x0,0xa)};}catch(_0x480761){return console[_0x557159(0x15f)](_0x557159(0x172),_0x480761),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x241a6a(0x179)](_0xdc43e9=0x1e){const _0x351818=a48_0x241a6a;try{const _0x2e6114=fs_1[_0x351818(0x142)]['readdirSync'](this['logsDir']),_0x1fdef3=new Date();_0x1fdef3['setDate'](_0x1fdef3[_0x351818(0x163)]()-_0xdc43e9);let _0x362332=0x0;_0x2e6114[_0x351818(0x175)](_0x123a77=>{const _0xdb87ca=_0x351818;if(!_0x123a77[_0xdb87ca(0x143)](_0xdb87ca(0x144)))return;const _0x515fa9=path_1['default'][_0xdb87ca(0x17c)](this[_0xdb87ca(0x13f)],_0x123a77),_0x5663dc=fs_1[_0xdb87ca(0x142)][_0xdb87ca(0x183)](_0x515fa9);_0x5663dc[_0xdb87ca(0x140)]<_0x1fdef3&&(fs_1[_0xdb87ca(0x142)][_0xdb87ca(0x156)](_0x515fa9),_0x362332++,console[_0xdb87ca(0x148)](_0xdb87ca(0x17a)+_0x123a77));}),console[_0x351818(0x148)](_0x351818(0x168)+_0x362332+_0x351818(0x187)+_0xdc43e9+'\x20days)');}catch(_0x3c2a3d){console['error'](_0x351818(0x18d),_0x3c2a3d);}}}exports[a48_0x241a6a(0x173)]=LoggerService,exports[a48_0x241a6a(0x152)]=new LoggerService();