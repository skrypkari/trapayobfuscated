'use strict';const a71_0x1fca52=a71_0x3319;(function(_0x1e053c,_0x3b4934){const _0x2c312c=a71_0x3319,_0x460537=_0x1e053c();while(!![]){try{const _0x4ba12d=-parseInt(_0x2c312c(0xf6))/0x1*(-parseInt(_0x2c312c(0x10f))/0x2)+-parseInt(_0x2c312c(0xfe))/0x3+parseInt(_0x2c312c(0xc6))/0x4*(-parseInt(_0x2c312c(0xda))/0x5)+-parseInt(_0x2c312c(0x119))/0x6*(-parseInt(_0x2c312c(0xcd))/0x7)+parseInt(_0x2c312c(0x100))/0x8*(-parseInt(_0x2c312c(0x10b))/0x9)+parseInt(_0x2c312c(0x10c))/0xa*(parseInt(_0x2c312c(0xc4))/0xb)+parseInt(_0x2c312c(0xe9))/0xc*(parseInt(_0x2c312c(0xff))/0xd);if(_0x4ba12d===_0x3b4934)break;else _0x460537['push'](_0x460537['shift']());}catch(_0x3ac287){_0x460537['push'](_0x460537['shift']());}}}(a71_0x2692,0x4e2b1));var __importDefault=this&&this[a71_0x1fca52(0xd4)]||function(_0x2288be){return _0x2288be&&_0x2288be['__esModule']?_0x2288be:{'default':_0x2288be};};function a71_0x2692(){const _0x39a280=['5706fJSJlA','987390hpHaaw','mtime','map','72VTDLvf','logsDir','statSync','logWhiteDomainRequest','split','date','COINTOPAY_ERROR','logShopWebhookSent','white_domain_errors','LoggerService','38634oguAhh','sort','log','cointopay_errors','cleanOldLogs','error','66XeMUok','ðŸ“\x20Created\x20logs\x20directory:\x20','196AUekZx','writeLog','webhooks_received','forEach','filter','api_calls','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','497UupJQT','\x20old\x20log\x20files\x20(older\x20than\x20','ensureLogsDirectory','Failed\x20to\x20get\x20log\x20stats:','loggerService','ERROR','cwd','__importDefault','REQUEST','join','size','getLogFileName','Failed\x20to\x20write\x20','43715VHIgiO','unlinkSync','length','message','stringify','logWhiteDomainResponse','WEBHOOK_RECEIVED','RESPONSE','SHOP_WEBHOOK_SENT','mkdirSync','SHOP_WEBHOOK_ERROR','cointopay_status_changes','\x20log:','shop_webhooks_errors','white_domain_requests','36ebNcCF','logWebhookReceived','toISOString','getLogStats','logWhiteDomainError','white_domain_responses','COINTOPAY_STATUS_CHANGE','logWebhookError','stack','logWebhookProcessed','ðŸ§¹\x20Cleaned\x20','readdirSync','setDate','14343bvvnGH','appendFileSync','logCoinToPayError','replace','\x20days)','endsWith','utf8','logPaymentCreated','713955RWqgYP','154258OJYEaW','7760nhSeAu','logShopWebhookError','webhooks_processed','default','__esModule','.log','getDate','webhooks_errors','shop_webhooks_sent','existsSync','WEBHOOK_ERROR'];a71_0x2692=function(){return _0x39a280;};return a71_0x2692();}function a71_0x3319(_0x405fc4,_0x4568a7){_0x405fc4=_0x405fc4-0xc1;const _0x269217=a71_0x2692();let _0x3319cb=_0x269217[_0x405fc4];return _0x3319cb;}Object['defineProperty'](exports,a71_0x1fca52(0x104),{'value':!![]}),exports[a71_0x1fca52(0xd1)]=exports[a71_0x1fca52(0x118)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x33c0d8=a71_0x1fca52;this[_0x33c0d8(0x110)]=path_1['default']['join'](process[_0x33c0d8(0xd3)](),'logs'),this[_0x33c0d8(0xcf)]();}[a71_0x1fca52(0xcf)](){const _0x574e2f=a71_0x1fca52;!fs_1[_0x574e2f(0x103)][_0x574e2f(0x109)](this[_0x574e2f(0x110)])&&(fs_1[_0x574e2f(0x103)][_0x574e2f(0xe3)](this[_0x574e2f(0x110)],{'recursive':!![]}),console[_0x574e2f(0x11b)](_0x574e2f(0xc5)+this['logsDir']));}['getLogFileName'](_0x4643f1){const _0x27d9ae=a71_0x1fca52,_0x450ee7=new Date()[_0x27d9ae(0xeb)]()[_0x27d9ae(0x113)]('T')[0x0];return path_1[_0x27d9ae(0x103)][_0x27d9ae(0xd6)](this['logsDir'],_0x4643f1+'_'+_0x450ee7+_0x27d9ae(0x105));}[a71_0x1fca52(0xc7)](_0x45f835,_0x2a4afa){const _0x2e1380=a71_0x1fca52;try{const _0x33885a=new Date()['toISOString'](),_0x40e0ec={'timestamp':_0x33885a,..._0x2a4afa},_0xedfdc4=JSON[_0x2e1380(0xde)](_0x40e0ec)+'\x0a',_0x1e0a64=this[_0x2e1380(0xd8)](_0x45f835);fs_1[_0x2e1380(0x103)][_0x2e1380(0xf7)](_0x1e0a64,_0xedfdc4,_0x2e1380(0xfc));}catch(_0x39f514){console[_0x2e1380(0xc3)](_0x2e1380(0xd9)+_0x45f835+_0x2e1380(0xe6),_0x39f514);}}[a71_0x1fca52(0x112)](_0x1a9385,_0x75cd36,_0x5d501b,_0x42b50a){const _0x341d28=a71_0x1fca52;this[_0x341d28(0xc7)](_0x341d28(0xe8),{'type':_0x341d28(0xd5),'gateway':_0x1a9385,'endpoint':_0x75cd36,'method':_0x5d501b,'data':_0x42b50a});}[a71_0x1fca52(0xdf)](_0x3f457e,_0x17b36d,_0x5efdd3,_0x34c509,_0x3b4460){const _0x477b48=a71_0x1fca52;this[_0x477b48(0xc7)](_0x477b48(0xee),{'type':_0x477b48(0xe1),'gateway':_0x3f457e,'endpoint':_0x17b36d,'status':_0x5efdd3,'responseTime':_0x3b4460,'data':_0x34c509});}[a71_0x1fca52(0xed)](_0x45f746,_0x3ae1b1,_0x2810d3){const _0x460879=a71_0x1fca52;this[_0x460879(0xc7)](_0x460879(0x117),{'type':_0x460879(0xd2),'gateway':_0x45f746,'endpoint':_0x3ae1b1,'error':_0x2810d3 instanceof Error?{'message':_0x2810d3[_0x460879(0xdd)],'stack':_0x2810d3['stack']}:_0x2810d3});}[a71_0x1fca52(0xea)](_0x2bed43,_0x51900e,_0x3711d3){const _0xc0778e=a71_0x1fca52;this['writeLog'](_0xc0778e(0xc8),{'type':_0xc0778e(0xe0),'gateway':_0x2bed43,'headers':_0x3711d3,'data':_0x51900e});}[a71_0x1fca52(0xf2)](_0x301b8d,_0x5ec196,_0x4837e8,_0x15e94f,_0x5d1119){const _0x10aaf2=a71_0x1fca52;this['writeLog'](_0x10aaf2(0x102),{'type':'WEBHOOK_PROCESSED','gateway':_0x301b8d,'paymentId':_0x5ec196,'oldStatus':_0x4837e8,'newStatus':_0x15e94f,'originalData':_0x5d1119});}[a71_0x1fca52(0xf0)](_0x544595,_0x274128,_0x170322){const _0x2ba43f=a71_0x1fca52;this[_0x2ba43f(0xc7)](_0x2ba43f(0x107),{'type':_0x2ba43f(0x10a),'gateway':_0x544595,'error':_0x274128 instanceof Error?{'message':_0x274128[_0x2ba43f(0xdd)],'stack':_0x274128[_0x2ba43f(0xf1)]}:_0x274128,'originalData':_0x170322});}['logCoinToPayStatus'](_0x1aa3cf){const _0x50869f=a71_0x1fca52;this[_0x50869f(0xc7)](_0x50869f(0xe5),{'type':_0x50869f(0xef),..._0x1aa3cf});}[a71_0x1fca52(0xf8)](_0x4fd715){const _0x5802fe=a71_0x1fca52;this[_0x5802fe(0xc7)](_0x5802fe(0xc1),{'type':_0x5802fe(0x115),..._0x4fd715});}[a71_0x1fca52(0x116)](_0x28c3ed,_0x3005c1,_0x18edb0,_0x68cd15,_0x33007c,_0x196838){const _0x45f6d4=a71_0x1fca52;this[_0x45f6d4(0xc7)](_0x45f6d4(0x108),{'type':_0x45f6d4(0xe2),'shopId':_0x28c3ed,'webhookUrl':_0x3005c1,'event':_0x18edb0,'status':_0x68cd15,'responseTime':_0x33007c,'payload':_0x196838});}[a71_0x1fca52(0x101)](_0x1c9767,_0x1e5b3e,_0x1b2ab3,_0xf0405f,_0x1aba96){const _0x2c2325=a71_0x1fca52;this['writeLog'](_0x2c2325(0xe7),{'type':_0x2c2325(0xe4),'shopId':_0x1c9767,'webhookUrl':_0x1e5b3e,'event':_0x1b2ab3,'error':_0xf0405f instanceof Error?{'message':_0xf0405f[_0x2c2325(0xdd)],'stack':_0xf0405f[_0x2c2325(0xf1)]}:_0xf0405f,'payload':_0x1aba96});}[a71_0x1fca52(0xfd)](_0x277259,_0x239ccf,_0x2357b8,_0x5a41ad,_0x153082){const _0x1805fa=a71_0x1fca52;this[_0x1805fa(0xc7)]('payments_created',{'type':'PAYMENT_CREATED','gateway':_0x277259,'paymentId':_0x239ccf,'shopId':_0x2357b8,'amount':_0x5a41ad,'currency':_0x153082});}['logApiCall'](_0x3bc5fc,_0x1f4225,_0x44b95a,_0x151824,_0x580858){const _0xa06a17=a71_0x1fca52;this[_0xa06a17(0xc7)](_0xa06a17(0xcb),{'type':'API_CALL','endpoint':_0x3bc5fc,'method':_0x1f4225,'userId':_0x44b95a,'userRole':_0x151824,'requestData':_0x580858});}[a71_0x1fca52(0xec)](){const _0x42c6ff=a71_0x1fca52;try{const _0x3fda09=fs_1[_0x42c6ff(0x103)][_0x42c6ff(0xf4)](this['logsDir']),_0x32fa5b=_0x3fda09[_0x42c6ff(0xca)](_0x468b3b=>_0x468b3b[_0x42c6ff(0xfb)](_0x42c6ff(0x105))),_0x17a4a2=[...new Set(_0x32fa5b[_0x42c6ff(0x10e)](_0x147f0f=>_0x147f0f[_0x42c6ff(0x113)]('_')[0x0]))],_0x213660=_0x32fa5b['map'](_0x12a3ee=>{const _0x35a714=_0x42c6ff,_0x36ab39=path_1['default'][_0x35a714(0xd6)](this[_0x35a714(0x110)],_0x12a3ee),_0x548984=fs_1[_0x35a714(0x103)][_0x35a714(0x111)](_0x36ab39),[_0x4ca41b,_0x185bd2]=_0x12a3ee[_0x35a714(0xf9)](_0x35a714(0x105),'')[_0x35a714(0x113)]('_');return{'type':_0x4ca41b,'date':_0x185bd2,'size':_0x548984[_0x35a714(0xd7)]};})[_0x42c6ff(0x11a)]((_0x409f84,_0x193e4d)=>_0x193e4d[_0x42c6ff(0x114)]['localeCompare'](_0x409f84[_0x42c6ff(0x114)]));return{'totalFiles':_0x32fa5b[_0x42c6ff(0xdc)],'logTypes':_0x17a4a2,'latestLogs':_0x213660['slice'](0x0,0xa)};}catch(_0x422ae9){return console['error'](_0x42c6ff(0xd0),_0x422ae9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a71_0x1fca52(0xc2)](_0x8f67d4=0x1e){const _0x52c82a=a71_0x1fca52;try{const _0x269a85=fs_1['default'][_0x52c82a(0xf4)](this['logsDir']),_0x50f2e5=new Date();_0x50f2e5[_0x52c82a(0xf5)](_0x50f2e5[_0x52c82a(0x106)]()-_0x8f67d4);let _0x3cc7dc=0x0;_0x269a85[_0x52c82a(0xc9)](_0x3aaf8a=>{const _0x40fd0f=_0x52c82a;if(!_0x3aaf8a['endsWith'](_0x40fd0f(0x105)))return;const _0x577952=path_1[_0x40fd0f(0x103)]['join'](this[_0x40fd0f(0x110)],_0x3aaf8a),_0x1d6c6d=fs_1['default']['statSync'](_0x577952);_0x1d6c6d[_0x40fd0f(0x10d)]<_0x50f2e5&&(fs_1['default'][_0x40fd0f(0xdb)](_0x577952),_0x3cc7dc++,console[_0x40fd0f(0x11b)](_0x40fd0f(0xcc)+_0x3aaf8a));}),console['log'](_0x52c82a(0xf3)+_0x3cc7dc+_0x52c82a(0xce)+_0x8f67d4+_0x52c82a(0xfa));}catch(_0x37a5f2){console[_0x52c82a(0xc3)]('Failed\x20to\x20clean\x20old\x20logs:',_0x37a5f2);}}}exports[a71_0x1fca52(0x118)]=LoggerService,exports[a71_0x1fca52(0xd1)]=new LoggerService();