'use strict';function a44_0x15ba(){const _0x2f8bf0=['log','logWebhookProcessed','join','2032FPnDkO','logs','appendFileSync','Failed\x20to\x20get\x20log\x20stats:','logCoinToPayError','2551129ykMRis','endsWith','logsDir','3997355nBJFOk','stringify','slice','message','24606qRQgNh','cointopay_status_changes','split','logWhiteDomainRequest','56243RPaWni','1048533qHXNpx','loggerService','defineProperty','webhooks_processed','writeLog','default','logCoinToPayStatus','18AwESOd','WEBHOOK_ERROR','ERROR','setDate','LoggerService','SHOP_WEBHOOK_SENT','statSync','readdirSync','localeCompare','4ZZlutA','utf8','logWhiteDomainResponse','unlinkSync','ensureLogsDirectory','__importDefault','1FyOOin','white_domain_requests','webhooks_received','PAYMENT_CREATED','logShopWebhookSent','stack','replace','logWebhookError','getLogStats','1946026ebUIdS','sort','cwd','WEBHOOK_PROCESSED','logShopWebhookError','webhooks_errors','toISOString','shop_webhooks_errors','logPaymentCreated','path','forEach','__esModule','1308MFbJId','WEBHOOK_RECEIVED','COINTOPAY_STATUS_CHANGE','getLogFileName','mtime','error','map','COINTOPAY_ERROR','6217070hJyzaG','logWhiteDomainError','.log','RESPONSE','logApiCall','date'];a44_0x15ba=function(){return _0x2f8bf0;};return a44_0x15ba();}const a44_0x2ad995=a44_0x19cc;(function(_0x2f24ba,_0x70a02){const _0x323f9c=a44_0x19cc,_0xdc4db6=_0x2f24ba();while(!![]){try{const _0x113b03=-parseInt(_0x323f9c(0x1cd))/0x1*(-parseInt(_0x323f9c(0x1d6))/0x2)+-parseInt(_0x323f9c(0x204))/0x3*(-parseInt(_0x323f9c(0x214))/0x4)+-parseInt(_0x323f9c(0x1fb))/0x5+-parseInt(_0x323f9c(0x20b))/0x6*(-parseInt(_0x323f9c(0x1f8))/0x7)+parseInt(_0x323f9c(0x1f3))/0x8*(-parseInt(_0x323f9c(0x1ff))/0x9)+-parseInt(_0x323f9c(0x1ea))/0xa+-parseInt(_0x323f9c(0x203))/0xb*(-parseInt(_0x323f9c(0x1e2))/0xc);if(_0x113b03===_0x70a02)break;else _0xdc4db6['push'](_0xdc4db6['shift']());}catch(_0x50c023){_0xdc4db6['push'](_0xdc4db6['shift']());}}}(a44_0x15ba,0xd15e0));var __importDefault=this&&this[a44_0x2ad995(0x1cc)]||function(_0x253b14){const _0x4f2697=a44_0x2ad995;return _0x253b14&&_0x253b14[_0x4f2697(0x1e1)]?_0x253b14:{'default':_0x253b14};};function a44_0x19cc(_0x4cef56,_0x5279d5){const _0x15ba98=a44_0x15ba();return a44_0x19cc=function(_0x19cc5f,_0x1d0ef4){_0x19cc5f=_0x19cc5f-0x1c8;let _0x3333c1=_0x15ba98[_0x19cc5f];return _0x3333c1;},a44_0x19cc(_0x4cef56,_0x5279d5);}Object[a44_0x2ad995(0x206)](exports,a44_0x2ad995(0x1e1),{'value':!![]}),exports[a44_0x2ad995(0x205)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a44_0x2ad995(0x1df)));class LoggerService{constructor(){const _0x3481dc=a44_0x2ad995;this[_0x3481dc(0x1fa)]=path_1[_0x3481dc(0x209)][_0x3481dc(0x1f2)](process[_0x3481dc(0x1d8)](),_0x3481dc(0x1f4)),this[_0x3481dc(0x1cb)]();}[a44_0x2ad995(0x1cb)](){const _0xd77de=a44_0x2ad995;!fs_1[_0xd77de(0x209)]['existsSync'](this[_0xd77de(0x1fa)])&&(fs_1[_0xd77de(0x209)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0xd77de(0x1f0)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0xd77de(0x1fa)]));}[a44_0x2ad995(0x1e5)](_0x239324){const _0x5619c6=a44_0x2ad995,_0x4789a4=new Date()[_0x5619c6(0x1dc)]()[_0x5619c6(0x201)]('T')[0x0];return path_1['default'][_0x5619c6(0x1f2)](this['logsDir'],_0x239324+'_'+_0x4789a4+'.log');}[a44_0x2ad995(0x208)](_0x305697,_0x549325){const _0x8ac475=a44_0x2ad995;try{const _0x338c40=new Date()[_0x8ac475(0x1dc)](),_0x47989c={'timestamp':_0x338c40,..._0x549325},_0x5968c6=JSON[_0x8ac475(0x1fc)](_0x47989c)+'\x0a',_0x405610=this[_0x8ac475(0x1e5)](_0x305697);fs_1[_0x8ac475(0x209)][_0x8ac475(0x1f5)](_0x405610,_0x5968c6,_0x8ac475(0x1c8));}catch(_0x5cf530){console[_0x8ac475(0x1e7)]('Failed\x20to\x20write\x20'+_0x305697+'\x20log:',_0x5cf530);}}[a44_0x2ad995(0x202)](_0x5bd5a1,_0x416702,_0x5856ce,_0x59e650){const _0x1007c7=a44_0x2ad995;this[_0x1007c7(0x208)](_0x1007c7(0x1ce),{'type':'REQUEST','gateway':_0x5bd5a1,'endpoint':_0x416702,'method':_0x5856ce,'data':_0x59e650});}[a44_0x2ad995(0x1c9)](_0x5603dd,_0x37c5dc,_0x47bf13,_0xe3da30,_0x4001fb){const _0x38985b=a44_0x2ad995;this[_0x38985b(0x208)]('white_domain_responses',{'type':_0x38985b(0x1ed),'gateway':_0x5603dd,'endpoint':_0x37c5dc,'status':_0x47bf13,'responseTime':_0x4001fb,'data':_0xe3da30});}[a44_0x2ad995(0x1eb)](_0x2bb46d,_0x14cfba,_0x1f85ba){const _0x65fc44=a44_0x2ad995;this[_0x65fc44(0x208)]('white_domain_errors',{'type':_0x65fc44(0x20d),'gateway':_0x2bb46d,'endpoint':_0x14cfba,'error':_0x1f85ba instanceof Error?{'message':_0x1f85ba[_0x65fc44(0x1fe)],'stack':_0x1f85ba[_0x65fc44(0x1d2)]}:_0x1f85ba});}['logWebhookReceived'](_0x4661c0,_0x3c0a1e,_0xba433e){const _0x534e33=a44_0x2ad995;this[_0x534e33(0x208)](_0x534e33(0x1cf),{'type':_0x534e33(0x1e3),'gateway':_0x4661c0,'headers':_0xba433e,'data':_0x3c0a1e});}[a44_0x2ad995(0x1f1)](_0x4d182a,_0x79721f,_0x4ade0c,_0x3d2607,_0x2fa090){const _0x2f932b=a44_0x2ad995;this['writeLog'](_0x2f932b(0x207),{'type':_0x2f932b(0x1d9),'gateway':_0x4d182a,'paymentId':_0x79721f,'oldStatus':_0x4ade0c,'newStatus':_0x3d2607,'originalData':_0x2fa090});}[a44_0x2ad995(0x1d4)](_0x10b962,_0x163766,_0x1ceb32){const _0x469819=a44_0x2ad995;this[_0x469819(0x208)](_0x469819(0x1db),{'type':_0x469819(0x20c),'gateway':_0x10b962,'error':_0x163766 instanceof Error?{'message':_0x163766[_0x469819(0x1fe)],'stack':_0x163766[_0x469819(0x1d2)]}:_0x163766,'originalData':_0x1ceb32});}[a44_0x2ad995(0x20a)](_0x13e7e0){const _0xec64d3=a44_0x2ad995;this['writeLog'](_0xec64d3(0x200),{'type':_0xec64d3(0x1e4),..._0x13e7e0});}[a44_0x2ad995(0x1f7)](_0x44805a){const _0x814652=a44_0x2ad995;this[_0x814652(0x208)]('cointopay_errors',{'type':_0x814652(0x1e9),..._0x44805a});}[a44_0x2ad995(0x1d1)](_0x881bcc,_0x1ab28e,_0x4711bf,_0x4d9350,_0x1e3202,_0x23f3e8){const _0x5bda71=a44_0x2ad995;this['writeLog']('shop_webhooks_sent',{'type':_0x5bda71(0x210),'shopId':_0x881bcc,'webhookUrl':_0x1ab28e,'event':_0x4711bf,'status':_0x4d9350,'responseTime':_0x1e3202,'payload':_0x23f3e8});}[a44_0x2ad995(0x1da)](_0x27b2f9,_0x49cbf3,_0x445945,_0x57b075,_0x41a644){const _0x107857=a44_0x2ad995;this['writeLog'](_0x107857(0x1dd),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x27b2f9,'webhookUrl':_0x49cbf3,'event':_0x445945,'error':_0x57b075 instanceof Error?{'message':_0x57b075['message'],'stack':_0x57b075[_0x107857(0x1d2)]}:_0x57b075,'payload':_0x41a644});}[a44_0x2ad995(0x1de)](_0x7d2f91,_0x6da8b7,_0x171282,_0x386ba7,_0x1c1c8d){const _0x3af870=a44_0x2ad995;this[_0x3af870(0x208)]('payments_created',{'type':_0x3af870(0x1d0),'gateway':_0x7d2f91,'paymentId':_0x6da8b7,'shopId':_0x171282,'amount':_0x386ba7,'currency':_0x1c1c8d});}[a44_0x2ad995(0x1ee)](_0x3f32b5,_0x567914,_0x3c224a,_0x1dba25,_0x5b14f7){const _0x106c8d=a44_0x2ad995;this[_0x106c8d(0x208)]('api_calls',{'type':'API_CALL','endpoint':_0x3f32b5,'method':_0x567914,'userId':_0x3c224a,'userRole':_0x1dba25,'requestData':_0x5b14f7});}[a44_0x2ad995(0x1d5)](){const _0x3feda8=a44_0x2ad995;try{const _0x5d1f39=fs_1[_0x3feda8(0x209)][_0x3feda8(0x212)](this[_0x3feda8(0x1fa)]),_0x10ad5a=_0x5d1f39['filter'](_0x36a63b=>_0x36a63b[_0x3feda8(0x1f9)](_0x3feda8(0x1ec))),_0x589c36=[...new Set(_0x10ad5a['map'](_0x5d589c=>_0x5d589c[_0x3feda8(0x201)]('_')[0x0]))],_0x383985=_0x10ad5a[_0x3feda8(0x1e8)](_0x3a31b3=>{const _0x16cef7=_0x3feda8,_0x10cdbe=path_1[_0x16cef7(0x209)][_0x16cef7(0x1f2)](this[_0x16cef7(0x1fa)],_0x3a31b3),_0x5443f0=fs_1[_0x16cef7(0x209)][_0x16cef7(0x211)](_0x10cdbe),[_0x4ed7fc,_0x4cb725]=_0x3a31b3[_0x16cef7(0x1d3)](_0x16cef7(0x1ec),'')[_0x16cef7(0x201)]('_');return{'type':_0x4ed7fc,'date':_0x4cb725,'size':_0x5443f0['size']};})[_0x3feda8(0x1d7)]((_0x37ba38,_0x421cc1)=>_0x421cc1['date'][_0x3feda8(0x213)](_0x37ba38[_0x3feda8(0x1ef)]));return{'totalFiles':_0x10ad5a['length'],'logTypes':_0x589c36,'latestLogs':_0x383985[_0x3feda8(0x1fd)](0x0,0xa)};}catch(_0x42e972){return console[_0x3feda8(0x1e7)](_0x3feda8(0x1f6),_0x42e972),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x56d9e0=0x1e){const _0x1a3ecf=a44_0x2ad995;try{const _0x2dd18e=fs_1[_0x1a3ecf(0x209)][_0x1a3ecf(0x212)](this[_0x1a3ecf(0x1fa)]),_0x487824=new Date();_0x487824[_0x1a3ecf(0x20e)](_0x487824['getDate']()-_0x56d9e0);let _0x4a9c53=0x0;_0x2dd18e[_0x1a3ecf(0x1e0)](_0x464ce8=>{const _0xd0f70e=_0x1a3ecf;if(!_0x464ce8[_0xd0f70e(0x1f9)](_0xd0f70e(0x1ec)))return;const _0x368e25=path_1['default'][_0xd0f70e(0x1f2)](this[_0xd0f70e(0x1fa)],_0x464ce8),_0x409048=fs_1['default']['statSync'](_0x368e25);_0x409048[_0xd0f70e(0x1e6)]<_0x487824&&(fs_1['default'][_0xd0f70e(0x1ca)](_0x368e25),_0x4a9c53++,console[_0xd0f70e(0x1f0)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x464ce8));}),console[_0x1a3ecf(0x1f0)]('🧹\x20Cleaned\x20'+_0x4a9c53+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x56d9e0+'\x20days)');}catch(_0x403ef6){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x403ef6);}}}exports[a44_0x2ad995(0x20f)]=LoggerService,exports[a44_0x2ad995(0x205)]=new LoggerService();