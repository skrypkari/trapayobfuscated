'use strict';function a49_0x5cfd(){const _0x10c52f=['342708nnDpKP','writeLog','readdirSync','getDate','\x20days)','RESPONSE','Failed\x20to\x20get\x20log\x20stats:','toISOString','map','payments_created','.log','cointopay_errors','shop_webhooks_sent','white_domain_requests','sort','WEBHOOK_PROCESSED','logApiCall','getLogFileName','5TxfQmD','1361925rfosqt','length','endsWith','LoggerService','log','ensureLogsDirectory','48glEoqH','loggerService','webhooks_received','WEBHOOK_ERROR','mkdirSync','273814ZKQANl','WEBHOOK_RECEIVED','default','split','logs','SHOP_WEBHOOK_SENT','api_calls','SHOP_WEBHOOK_ERROR','REQUEST','logCoinToPayError','PAYMENT_CREATED','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logsDir','API_CALL','utf8','131278vsDhEu','__importDefault','\x20old\x20log\x20files\x20(older\x20than\x20','4462480TcKBfm','date','setDate','unlinkSync','logWebhookError','Failed\x20to\x20clean\x20old\x20logs:','COINTOPAY_STATUS_CHANGE','appendFileSync','104OJpfWn','path','logPaymentCreated','logWebhookReceived','white_domain_responses','🧹\x20Cleaned\x20','statSync','__esModule','error','cointopay_status_changes','existsSync','message','shop_webhooks_errors','logShopWebhookError','mtime','logWhiteDomainError','cleanOldLogs','forEach','webhooks_processed','📁\x20Created\x20logs\x20directory:\x20','13155rkrXnz','join','306413XzrOht','logWhiteDomainRequest','stack','COINTOPAY_ERROR'];a49_0x5cfd=function(){return _0x10c52f;};return a49_0x5cfd();}const a49_0x3b5d7e=a49_0x1494;(function(_0x471837,_0x2a1cf1){const _0x2f2d5d=a49_0x1494,_0xaaff8c=_0x471837();while(!![]){try{const _0x5fe9f4=parseInt(_0x2f2d5d(0x15f))/0x1+-parseInt(_0x2f2d5d(0x12f))/0x2+-parseInt(_0x2f2d5d(0x15d))/0x3*(-parseInt(_0x2f2d5d(0x149))/0x4)+parseInt(_0x2f2d5d(0x123))/0x5*(parseInt(_0x2f2d5d(0x163))/0x6)+-parseInt(_0x2f2d5d(0x13e))/0x7*(-parseInt(_0x2f2d5d(0x12a))/0x8)+parseInt(_0x2f2d5d(0x124))/0x9+-parseInt(_0x2f2d5d(0x141))/0xa;if(_0x5fe9f4===_0x2a1cf1)break;else _0xaaff8c['push'](_0xaaff8c['shift']());}catch(_0x18cb3a){_0xaaff8c['push'](_0xaaff8c['shift']());}}}(a49_0x5cfd,0x26a1b));var __importDefault=this&&this[a49_0x3b5d7e(0x13f)]||function(_0x482c62){const _0x2848fa=a49_0x3b5d7e;return _0x482c62&&_0x482c62[_0x2848fa(0x150)]?_0x482c62:{'default':_0x482c62};};function a49_0x1494(_0x49f8b3,_0x2a1a9f){const _0x5cfd2c=a49_0x5cfd();return a49_0x1494=function(_0x149421,_0x3e16df){_0x149421=_0x149421-0x117;let _0x34bfb5=_0x5cfd2c[_0x149421];return _0x34bfb5;},a49_0x1494(_0x49f8b3,_0x2a1a9f);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a49_0x3b5d7e(0x12b)]=exports[a49_0x3b5d7e(0x127)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x3b5d7e(0x14a)));class LoggerService{constructor(){const _0x37b5a7=a49_0x3b5d7e;this[_0x37b5a7(0x13b)]=path_1[_0x37b5a7(0x131)][_0x37b5a7(0x15e)](process['cwd'](),_0x37b5a7(0x133)),this[_0x37b5a7(0x129)]();}[a49_0x3b5d7e(0x129)](){const _0x547212=a49_0x3b5d7e;!fs_1[_0x547212(0x131)][_0x547212(0x153)](this['logsDir'])&&(fs_1[_0x547212(0x131)][_0x547212(0x12e)](this[_0x547212(0x13b)],{'recursive':!![]}),console[_0x547212(0x128)](_0x547212(0x15c)+this[_0x547212(0x13b)]));}[a49_0x3b5d7e(0x122)](_0x41b394){const _0x36d116=a49_0x3b5d7e,_0x2a04a1=new Date()[_0x36d116(0x118)]()[_0x36d116(0x132)]('T')[0x0];return path_1['default'][_0x36d116(0x15e)](this[_0x36d116(0x13b)],_0x41b394+'_'+_0x2a04a1+_0x36d116(0x11b));}['writeLog'](_0x513844,_0x39036b){const _0x3d5878=a49_0x3b5d7e;try{const _0x45a528=new Date()['toISOString'](),_0x2cb513={'timestamp':_0x45a528,..._0x39036b},_0x237ca5=JSON['stringify'](_0x2cb513)+'\x0a',_0x19ce0a=this[_0x3d5878(0x122)](_0x513844);fs_1[_0x3d5878(0x131)][_0x3d5878(0x148)](_0x19ce0a,_0x237ca5,_0x3d5878(0x13d));}catch(_0x8f8619){console[_0x3d5878(0x151)]('Failed\x20to\x20write\x20'+_0x513844+'\x20log:',_0x8f8619);}}[a49_0x3b5d7e(0x160)](_0x2370b0,_0x3ace32,_0x3c0432,_0x1a9c03){const _0x115513=a49_0x3b5d7e;this[_0x115513(0x164)](_0x115513(0x11e),{'type':_0x115513(0x137),'gateway':_0x2370b0,'endpoint':_0x3ace32,'method':_0x3c0432,'data':_0x1a9c03});}['logWhiteDomainResponse'](_0x4b633c,_0x31c244,_0x2798f7,_0x322761,_0x12afbd){const _0x1d4075=a49_0x3b5d7e;this[_0x1d4075(0x164)](_0x1d4075(0x14d),{'type':_0x1d4075(0x168),'gateway':_0x4b633c,'endpoint':_0x31c244,'status':_0x2798f7,'responseTime':_0x12afbd,'data':_0x322761});}[a49_0x3b5d7e(0x158)](_0x434714,_0x9d4a62,_0x570527){const _0x2879ea=a49_0x3b5d7e;this[_0x2879ea(0x164)]('white_domain_errors',{'type':'ERROR','gateway':_0x434714,'endpoint':_0x9d4a62,'error':_0x570527 instanceof Error?{'message':_0x570527[_0x2879ea(0x154)],'stack':_0x570527['stack']}:_0x570527});}[a49_0x3b5d7e(0x14c)](_0x355427,_0x46456c,_0x335c40){const _0x4d4374=a49_0x3b5d7e;this[_0x4d4374(0x164)](_0x4d4374(0x12c),{'type':_0x4d4374(0x130),'gateway':_0x355427,'headers':_0x335c40,'data':_0x46456c});}['logWebhookProcessed'](_0x8ba7a,_0x576c00,_0x559322,_0x5972f1,_0x1bf373){const _0x52ad6c=a49_0x3b5d7e;this['writeLog'](_0x52ad6c(0x15b),{'type':_0x52ad6c(0x120),'gateway':_0x8ba7a,'paymentId':_0x576c00,'oldStatus':_0x559322,'newStatus':_0x5972f1,'originalData':_0x1bf373});}[a49_0x3b5d7e(0x145)](_0x4d99c3,_0x597843,_0x1b3578){const _0x3daf1c=a49_0x3b5d7e;this[_0x3daf1c(0x164)]('webhooks_errors',{'type':_0x3daf1c(0x12d),'gateway':_0x4d99c3,'error':_0x597843 instanceof Error?{'message':_0x597843[_0x3daf1c(0x154)],'stack':_0x597843['stack']}:_0x597843,'originalData':_0x1b3578});}['logCoinToPayStatus'](_0x51ce55){const _0x105b96=a49_0x3b5d7e;this[_0x105b96(0x164)](_0x105b96(0x152),{'type':_0x105b96(0x147),..._0x51ce55});}[a49_0x3b5d7e(0x138)](_0x462f1c){const _0x2bc6a0=a49_0x3b5d7e;this[_0x2bc6a0(0x164)](_0x2bc6a0(0x11c),{'type':_0x2bc6a0(0x162),..._0x462f1c});}['logShopWebhookSent'](_0x840b9c,_0x40d3d0,_0x1c667b,_0x4c3f2c,_0x2c4bf4,_0x5f5273){const _0x269e12=a49_0x3b5d7e;this[_0x269e12(0x164)](_0x269e12(0x11d),{'type':_0x269e12(0x134),'shopId':_0x840b9c,'webhookUrl':_0x40d3d0,'event':_0x1c667b,'status':_0x4c3f2c,'responseTime':_0x2c4bf4,'payload':_0x5f5273});}[a49_0x3b5d7e(0x156)](_0x24a4b5,_0x1559d5,_0x278095,_0x2757a1,_0x153ce8){const _0x33504d=a49_0x3b5d7e;this[_0x33504d(0x164)](_0x33504d(0x155),{'type':_0x33504d(0x136),'shopId':_0x24a4b5,'webhookUrl':_0x1559d5,'event':_0x278095,'error':_0x2757a1 instanceof Error?{'message':_0x2757a1[_0x33504d(0x154)],'stack':_0x2757a1[_0x33504d(0x161)]}:_0x2757a1,'payload':_0x153ce8});}[a49_0x3b5d7e(0x14b)](_0x4a62fa,_0x544080,_0x49c4fb,_0x1369b2,_0x288ef8){const _0xce73e8=a49_0x3b5d7e;this['writeLog'](_0xce73e8(0x11a),{'type':_0xce73e8(0x139),'gateway':_0x4a62fa,'paymentId':_0x544080,'shopId':_0x49c4fb,'amount':_0x1369b2,'currency':_0x288ef8});}[a49_0x3b5d7e(0x121)](_0x4b8fbf,_0x5749d8,_0x514e35,_0x4ff84c,_0x53fff2){const _0x45465e=a49_0x3b5d7e;this[_0x45465e(0x164)](_0x45465e(0x135),{'type':_0x45465e(0x13c),'endpoint':_0x4b8fbf,'method':_0x5749d8,'userId':_0x514e35,'userRole':_0x4ff84c,'requestData':_0x53fff2});}['getLogStats'](){const _0x4868ce=a49_0x3b5d7e;try{const _0xfecc89=fs_1[_0x4868ce(0x131)][_0x4868ce(0x165)](this[_0x4868ce(0x13b)]),_0x3eb648=_0xfecc89['filter'](_0x50997d=>_0x50997d[_0x4868ce(0x126)](_0x4868ce(0x11b))),_0x50b0c4=[...new Set(_0x3eb648[_0x4868ce(0x119)](_0x137645=>_0x137645[_0x4868ce(0x132)]('_')[0x0]))],_0x41f09d=_0x3eb648[_0x4868ce(0x119)](_0x4424f8=>{const _0xa540bd=_0x4868ce,_0x2b4d7f=path_1[_0xa540bd(0x131)][_0xa540bd(0x15e)](this[_0xa540bd(0x13b)],_0x4424f8),_0x457f7f=fs_1['default']['statSync'](_0x2b4d7f),[_0x1ffdd7,_0x43f6ba]=_0x4424f8['replace'](_0xa540bd(0x11b),'')[_0xa540bd(0x132)]('_');return{'type':_0x1ffdd7,'date':_0x43f6ba,'size':_0x457f7f['size']};})[_0x4868ce(0x11f)]((_0x3f05c0,_0x1a5068)=>_0x1a5068[_0x4868ce(0x142)]['localeCompare'](_0x3f05c0['date']));return{'totalFiles':_0x3eb648[_0x4868ce(0x125)],'logTypes':_0x50b0c4,'latestLogs':_0x41f09d['slice'](0x0,0xa)};}catch(_0x180b29){return console[_0x4868ce(0x151)](_0x4868ce(0x117),_0x180b29),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x3b5d7e(0x159)](_0xbdf54c=0x1e){const _0x12e554=a49_0x3b5d7e;try{const _0x440cee=fs_1[_0x12e554(0x131)][_0x12e554(0x165)](this[_0x12e554(0x13b)]),_0x20194d=new Date();_0x20194d[_0x12e554(0x143)](_0x20194d[_0x12e554(0x166)]()-_0xbdf54c);let _0x41d122=0x0;_0x440cee[_0x12e554(0x15a)](_0x5092f8=>{const _0xa023e9=_0x12e554;if(!_0x5092f8[_0xa023e9(0x126)]('.log'))return;const _0x3098f6=path_1[_0xa023e9(0x131)]['join'](this['logsDir'],_0x5092f8),_0x31b96a=fs_1['default'][_0xa023e9(0x14f)](_0x3098f6);_0x31b96a[_0xa023e9(0x157)]<_0x20194d&&(fs_1['default'][_0xa023e9(0x144)](_0x3098f6),_0x41d122++,console[_0xa023e9(0x128)](_0xa023e9(0x13a)+_0x5092f8));}),console[_0x12e554(0x128)](_0x12e554(0x14e)+_0x41d122+_0x12e554(0x140)+_0xbdf54c+_0x12e554(0x167));}catch(_0x42265c){console[_0x12e554(0x151)](_0x12e554(0x146),_0x42265c);}}}exports[a49_0x3b5d7e(0x127)]=LoggerService,exports[a49_0x3b5d7e(0x12b)]=new LoggerService();