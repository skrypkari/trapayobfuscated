'use strict';const a49_0x58fced=a49_0x816f;function a49_0x816f(_0x351da9,_0x37e842){const _0x57b0e5=a49_0x57b0();return a49_0x816f=function(_0x816f79,_0x35dbdd){_0x816f79=_0x816f79-0xd1;let _0x42bfc9=_0x57b0e5[_0x816f79];return _0x42bfc9;},a49_0x816f(_0x351da9,_0x37e842);}function a49_0x57b0(){const _0x1ede1f=['localeCompare','webhooks_errors','cointopay_status_changes','Failed\x20to\x20get\x20log\x20stats:','utf8','LoggerService','readdirSync','join','logCoinToPayError','WEBHOOK_PROCESSED','WEBHOOK_RECEIVED','7PaKLZc','logWhiteDomainError','\x20days)','map','COINTOPAY_STATUS_CHANGE','endsWith','default','logCoinToPayStatus','split','stringify','SHOP_WEBHOOK_ERROR','RESPONSE','date','logWhiteDomainResponse','Failed\x20to\x20clean\x20old\x20logs:','existsSync','REQUEST','logWhiteDomainRequest','6191538kHiyYX','white_domain_requests','size','white_domain_responses','3262628anvLUq','logShopWebhookError','5319GGVAuE','logWebhookProcessed','defineProperty','getDate','message','logs','replace','ensureLogsDirectory','WEBHOOK_ERROR','26655vdzCoT','forEach','log','3070884pLSDSI','getLogFileName','stack','logWebhookError','writeLog','Failed\x20to\x20write\x20','COINTOPAY_ERROR','statSync','22560VqzbPj','SHOP_WEBHOOK_SENT','api_calls','logShopWebhookSent','white_domain_errors','webhooks_received','PAYMENT_CREATED','__importDefault','unlinkSync','5kYWINP','logPaymentCreated','filter','🗑️\x20Deleted\x20old\x20log\x20file:\x20','shop_webhooks_errors','shop_webhooks_sent','254004IicnTB','ERROR','.log','setDate','📁\x20Created\x20logs\x20directory:\x20','__esModule','error','logsDir','appendFileSync','7171880AZCSXI'];a49_0x57b0=function(){return _0x1ede1f;};return a49_0x57b0();}(function(_0x25562a,_0x14879c){const _0x4269d9=a49_0x816f,_0x48f05a=_0x25562a();while(!![]){try{const _0x46affe=-parseInt(_0x4269d9(0x11c))/0x1+parseInt(_0x4269d9(0xf7))/0x2+parseInt(_0x4269d9(0x102))/0x3+parseInt(_0x4269d9(0x105))/0x4*(parseInt(_0x4269d9(0x116))/0x5)+-parseInt(_0x4269d9(0xf3))/0x6*(-parseInt(_0x4269d9(0xe1))/0x7)+-parseInt(_0x4269d9(0xd5))/0x8+-parseInt(_0x4269d9(0xf9))/0x9*(parseInt(_0x4269d9(0x10d))/0xa);if(_0x46affe===_0x14879c)break;else _0x48f05a['push'](_0x48f05a['shift']());}catch(_0x3187fd){_0x48f05a['push'](_0x48f05a['shift']());}}}(a49_0x57b0,0xe969a));var __importDefault=this&&this[a49_0x58fced(0x114)]||function(_0x3de949){const _0x40421b=a49_0x58fced;return _0x3de949&&_0x3de949[_0x40421b(0xd1)]?_0x3de949:{'default':_0x3de949};};Object[a49_0x58fced(0xfb)](exports,a49_0x58fced(0xd1),{'value':!![]}),exports['loggerService']=exports[a49_0x58fced(0xdb)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x4ec08d=a49_0x58fced;this[_0x4ec08d(0xd3)]=path_1[_0x4ec08d(0xe7)][_0x4ec08d(0xdd)](process['cwd'](),_0x4ec08d(0xfe)),this['ensureLogsDirectory']();}[a49_0x58fced(0x100)](){const _0x16adf2=a49_0x58fced;!fs_1['default'][_0x16adf2(0xf0)](this['logsDir'])&&(fs_1[_0x16adf2(0xe7)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x16adf2(0x104)](_0x16adf2(0x120)+this[_0x16adf2(0xd3)]));}[a49_0x58fced(0x106)](_0x26b75f){const _0x8852ba=a49_0x58fced,_0x201d5e=new Date()['toISOString']()[_0x8852ba(0xe9)]('T')[0x0];return path_1[_0x8852ba(0xe7)][_0x8852ba(0xdd)](this[_0x8852ba(0xd3)],_0x26b75f+'_'+_0x201d5e+_0x8852ba(0x11e));}[a49_0x58fced(0x109)](_0x245509,_0xa2837e){const _0x4317b6=a49_0x58fced;try{const _0xa1a638=new Date()['toISOString'](),_0x4a5b83={'timestamp':_0xa1a638,..._0xa2837e},_0xf194c9=JSON[_0x4317b6(0xea)](_0x4a5b83)+'\x0a',_0x215e9a=this[_0x4317b6(0x106)](_0x245509);fs_1[_0x4317b6(0xe7)][_0x4317b6(0xd4)](_0x215e9a,_0xf194c9,_0x4317b6(0xda));}catch(_0x22af41){console[_0x4317b6(0xd2)](_0x4317b6(0x10a)+_0x245509+'\x20log:',_0x22af41);}}[a49_0x58fced(0xf2)](_0x582ef7,_0xed15fb,_0x3728af,_0xc3aaee){const _0x2e9031=a49_0x58fced;this[_0x2e9031(0x109)](_0x2e9031(0xf4),{'type':_0x2e9031(0xf1),'gateway':_0x582ef7,'endpoint':_0xed15fb,'method':_0x3728af,'data':_0xc3aaee});}[a49_0x58fced(0xee)](_0x1283b7,_0x48ba2c,_0x953d66,_0x2efdf0,_0x17bffe){const _0x39e16d=a49_0x58fced;this[_0x39e16d(0x109)](_0x39e16d(0xf6),{'type':_0x39e16d(0xec),'gateway':_0x1283b7,'endpoint':_0x48ba2c,'status':_0x953d66,'responseTime':_0x17bffe,'data':_0x2efdf0});}[a49_0x58fced(0xe2)](_0x3ed533,_0x3407b6,_0x982e0b){const _0x1e86a3=a49_0x58fced;this['writeLog'](_0x1e86a3(0x111),{'type':_0x1e86a3(0x11d),'gateway':_0x3ed533,'endpoint':_0x3407b6,'error':_0x982e0b instanceof Error?{'message':_0x982e0b[_0x1e86a3(0xfd)],'stack':_0x982e0b[_0x1e86a3(0x107)]}:_0x982e0b});}['logWebhookReceived'](_0x17d747,_0x371d61,_0x2d8ba2){const _0x2934f2=a49_0x58fced;this['writeLog'](_0x2934f2(0x112),{'type':_0x2934f2(0xe0),'gateway':_0x17d747,'headers':_0x2d8ba2,'data':_0x371d61});}[a49_0x58fced(0xfa)](_0x2d46e5,_0x4e151a,_0x52dbe0,_0x529832,_0x4d6ab9){const _0x3d1827=a49_0x58fced;this[_0x3d1827(0x109)]('webhooks_processed',{'type':_0x3d1827(0xdf),'gateway':_0x2d46e5,'paymentId':_0x4e151a,'oldStatus':_0x52dbe0,'newStatus':_0x529832,'originalData':_0x4d6ab9});}[a49_0x58fced(0x108)](_0xdc41ca,_0x31ec14,_0x461789){const _0x463e21=a49_0x58fced;this[_0x463e21(0x109)](_0x463e21(0xd7),{'type':_0x463e21(0x101),'gateway':_0xdc41ca,'error':_0x31ec14 instanceof Error?{'message':_0x31ec14[_0x463e21(0xfd)],'stack':_0x31ec14['stack']}:_0x31ec14,'originalData':_0x461789});}[a49_0x58fced(0xe8)](_0x47c75b){const _0x5ca536=a49_0x58fced;this['writeLog'](_0x5ca536(0xd8),{'type':_0x5ca536(0xe5),..._0x47c75b});}[a49_0x58fced(0xde)](_0x4fdd96){const _0x23c308=a49_0x58fced;this[_0x23c308(0x109)]('cointopay_errors',{'type':_0x23c308(0x10b),..._0x4fdd96});}[a49_0x58fced(0x110)](_0x1b71fd,_0x121f6c,_0x200b08,_0x1b0186,_0x55774c,_0x522c1c){const _0x41ce18=a49_0x58fced;this[_0x41ce18(0x109)](_0x41ce18(0x11b),{'type':_0x41ce18(0x10e),'shopId':_0x1b71fd,'webhookUrl':_0x121f6c,'event':_0x200b08,'status':_0x1b0186,'responseTime':_0x55774c,'payload':_0x522c1c});}[a49_0x58fced(0xf8)](_0x53405b,_0x2762db,_0x411fee,_0x22df6a,_0x426c72){const _0x1bd75c=a49_0x58fced;this[_0x1bd75c(0x109)](_0x1bd75c(0x11a),{'type':_0x1bd75c(0xeb),'shopId':_0x53405b,'webhookUrl':_0x2762db,'event':_0x411fee,'error':_0x22df6a instanceof Error?{'message':_0x22df6a['message'],'stack':_0x22df6a[_0x1bd75c(0x107)]}:_0x22df6a,'payload':_0x426c72});}[a49_0x58fced(0x117)](_0x3128f0,_0x474391,_0x5a62c1,_0x4cadad,_0x36b9a1){const _0x2d9e27=a49_0x58fced;this[_0x2d9e27(0x109)]('payments_created',{'type':_0x2d9e27(0x113),'gateway':_0x3128f0,'paymentId':_0x474391,'shopId':_0x5a62c1,'amount':_0x4cadad,'currency':_0x36b9a1});}['logApiCall'](_0x352463,_0x343226,_0x2c2928,_0x204fcf,_0x49bd58){const _0x3d48b6=a49_0x58fced;this[_0x3d48b6(0x109)](_0x3d48b6(0x10f),{'type':'API_CALL','endpoint':_0x352463,'method':_0x343226,'userId':_0x2c2928,'userRole':_0x204fcf,'requestData':_0x49bd58});}['getLogStats'](){const _0x5e34ee=a49_0x58fced;try{const _0x72b9a=fs_1['default'][_0x5e34ee(0xdc)](this[_0x5e34ee(0xd3)]),_0x38c970=_0x72b9a[_0x5e34ee(0x118)](_0x328b5d=>_0x328b5d['endsWith'](_0x5e34ee(0x11e))),_0xd7de31=[...new Set(_0x38c970[_0x5e34ee(0xe4)](_0x4987b6=>_0x4987b6[_0x5e34ee(0xe9)]('_')[0x0]))],_0x423e60=_0x38c970[_0x5e34ee(0xe4)](_0x31d3e9=>{const _0x5312f4=_0x5e34ee,_0x5e9f30=path_1[_0x5312f4(0xe7)][_0x5312f4(0xdd)](this[_0x5312f4(0xd3)],_0x31d3e9),_0x2e46a7=fs_1[_0x5312f4(0xe7)][_0x5312f4(0x10c)](_0x5e9f30),[_0x324db1,_0x1908f5]=_0x31d3e9[_0x5312f4(0xff)](_0x5312f4(0x11e),'')['split']('_');return{'type':_0x324db1,'date':_0x1908f5,'size':_0x2e46a7[_0x5312f4(0xf5)]};})['sort']((_0xbb7d7d,_0x48a255)=>_0x48a255[_0x5e34ee(0xed)][_0x5e34ee(0xd6)](_0xbb7d7d[_0x5e34ee(0xed)]));return{'totalFiles':_0x38c970['length'],'logTypes':_0xd7de31,'latestLogs':_0x423e60['slice'](0x0,0xa)};}catch(_0x2c511b){return console[_0x5e34ee(0xd2)](_0x5e34ee(0xd9),_0x2c511b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x38d504=0x1e){const _0x4154f5=a49_0x58fced;try{const _0x319efb=fs_1[_0x4154f5(0xe7)]['readdirSync'](this['logsDir']),_0x358c83=new Date();_0x358c83[_0x4154f5(0x11f)](_0x358c83[_0x4154f5(0xfc)]()-_0x38d504);let _0x538f93=0x0;_0x319efb[_0x4154f5(0x103)](_0x318d65=>{const _0x5e7402=_0x4154f5;if(!_0x318d65[_0x5e7402(0xe6)]('.log'))return;const _0x10b3e1=path_1[_0x5e7402(0xe7)][_0x5e7402(0xdd)](this[_0x5e7402(0xd3)],_0x318d65),_0x44959c=fs_1[_0x5e7402(0xe7)]['statSync'](_0x10b3e1);_0x44959c['mtime']<_0x358c83&&(fs_1[_0x5e7402(0xe7)][_0x5e7402(0x115)](_0x10b3e1),_0x538f93++,console[_0x5e7402(0x104)](_0x5e7402(0x119)+_0x318d65));}),console[_0x4154f5(0x104)]('🧹\x20Cleaned\x20'+_0x538f93+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x38d504+_0x4154f5(0xe3));}catch(_0x17b7b8){console['error'](_0x4154f5(0xef),_0x17b7b8);}}}exports[a49_0x58fced(0xdb)]=LoggerService,exports['loggerService']=new LoggerService();