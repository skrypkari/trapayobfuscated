'use strict';const a49_0x5d4244=a49_0x55db;(function(_0x3c45bb,_0x2bfa4f){const _0x1f6190=a49_0x55db,_0x287cd1=_0x3c45bb();while(!![]){try{const _0x22ae2e=parseInt(_0x1f6190(0x1bc))/0x1*(-parseInt(_0x1f6190(0x1ea))/0x2)+-parseInt(_0x1f6190(0x1cf))/0x3+parseInt(_0x1f6190(0x1b2))/0x4+parseInt(_0x1f6190(0x1ba))/0x5+parseInt(_0x1f6190(0x1d1))/0x6*(-parseInt(_0x1f6190(0x1e5))/0x7)+parseInt(_0x1f6190(0x1d8))/0x8*(parseInt(_0x1f6190(0x1ef))/0x9)+parseInt(_0x1f6190(0x1d5))/0xa*(parseInt(_0x1f6190(0x1b4))/0xb);if(_0x22ae2e===_0x2bfa4f)break;else _0x287cd1['push'](_0x287cd1['shift']());}catch(_0x5d89fe){_0x287cd1['push'](_0x287cd1['shift']());}}}(a49_0x507c,0xb1e04));var __importDefault=this&&this[a49_0x5d4244(0x1b7)]||function(_0x5ee79b){const _0x318194=a49_0x5d4244;return _0x5ee79b&&_0x5ee79b[_0x318194(0x1d4)]?_0x5ee79b:{'default':_0x5ee79b};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a49_0x5d4244(0x200)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x5d4244(0x1b5)));function a49_0x55db(_0x1271ee,_0x37678b){const _0x507c9f=a49_0x507c();return a49_0x55db=function(_0x55dbae,_0x3069eb){_0x55dbae=_0x55dbae-0x1ad;let _0x2a5c6e=_0x507c9f[_0x55dbae];return _0x2a5c6e;},a49_0x55db(_0x1271ee,_0x37678b);}function a49_0x507c(){const _0xf3ef3d=['ERROR','sort','toISOString','LoggerService','webhooks_errors','logPaymentCreated','date','default','white_domain_responses','API_CALL','5658752TLYcUv','localeCompare','847627Ivqarh','path','WEBHOOK_PROCESSED','__importDefault','mtime','log','4879045UQPMIi','error','1191313CJjlue','Failed\x20to\x20write\x20','writeLog','message','logWhiteDomainRequest','cointopay_errors','cwd','statSync','forEach','stack','logCoinToPayError','logWebhookProcessed','unlinkSync','logShopWebhookSent','size','SHOP_WEBHOOK_SENT','map','payments_created','loggerService','3688173HVEXvB','WEBHOOK_RECEIVED','168126MUwHqQ','logShopWebhookError','length','__esModule','160gOqJaK','logWhiteDomainError','getLogStats','127480ZfaUob','cointopay_status_changes','Failed\x20to\x20clean\x20old\x20logs:','existsSync','split','utf8','join','replace','Failed\x20to\x20get\x20log\x20stats:','endsWith','shop_webhooks_errors','getLogFileName','setDate','210tyEAqu','REQUEST','\x20days)','readdirSync','getDate','2kmGcye','webhooks_received','white_domain_errors','PAYMENT_CREATED','logs','207bfyele','mkdirSync','logsDir','logCoinToPayStatus','COINTOPAY_ERROR','logWhiteDomainResponse','api_calls','.log','white_domain_requests','COINTOPAY_STATUS_CHANGE','logApiCall','ensureLogsDirectory','RESPONSE','🗑️\x20Deleted\x20old\x20log\x20file:\x20'];a49_0x507c=function(){return _0xf3ef3d;};return a49_0x507c();}class LoggerService{constructor(){const _0x3e33b9=a49_0x5d4244;this[_0x3e33b9(0x1f1)]=path_1[_0x3e33b9(0x1af)][_0x3e33b9(0x1de)](process[_0x3e33b9(0x1c2)](),_0x3e33b9(0x1ee)),this[_0x3e33b9(0x1fa)]();}[a49_0x5d4244(0x1fa)](){const _0x461df0=a49_0x5d4244;!fs_1[_0x461df0(0x1af)][_0x461df0(0x1db)](this['logsDir'])&&(fs_1[_0x461df0(0x1af)][_0x461df0(0x1f0)](this['logsDir'],{'recursive':!![]}),console[_0x461df0(0x1b9)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x461df0(0x1f1)]));}[a49_0x5d4244(0x1e3)](_0x31cdf2){const _0x161466=a49_0x5d4244,_0x2f39dd=new Date()[_0x161466(0x1ff)]()['split']('T')[0x0];return path_1[_0x161466(0x1af)][_0x161466(0x1de)](this[_0x161466(0x1f1)],_0x31cdf2+'_'+_0x2f39dd+_0x161466(0x1f6));}['writeLog'](_0x53b9cf,_0x46e919){const _0x3b4349=a49_0x5d4244;try{const _0x586b64=new Date()[_0x3b4349(0x1ff)](),_0x951f65={'timestamp':_0x586b64,..._0x46e919},_0x4f4fb9=JSON['stringify'](_0x951f65)+'\x0a',_0x131ced=this[_0x3b4349(0x1e3)](_0x53b9cf);fs_1['default']['appendFileSync'](_0x131ced,_0x4f4fb9,_0x3b4349(0x1dd));}catch(_0x1d93bf){console[_0x3b4349(0x1bb)](_0x3b4349(0x1bd)+_0x53b9cf+'\x20log:',_0x1d93bf);}}[a49_0x5d4244(0x1c0)](_0x54ecfe,_0x185984,_0x45cbaa,_0x67637){const _0x3edd34=a49_0x5d4244;this[_0x3edd34(0x1be)](_0x3edd34(0x1f7),{'type':_0x3edd34(0x1e6),'gateway':_0x54ecfe,'endpoint':_0x185984,'method':_0x45cbaa,'data':_0x67637});}[a49_0x5d4244(0x1f4)](_0x2f62e6,_0x3aa687,_0x3668df,_0x1b6629,_0x246824){const _0x5efd54=a49_0x5d4244;this[_0x5efd54(0x1be)](_0x5efd54(0x1b0),{'type':_0x5efd54(0x1fb),'gateway':_0x2f62e6,'endpoint':_0x3aa687,'status':_0x3668df,'responseTime':_0x246824,'data':_0x1b6629});}[a49_0x5d4244(0x1d6)](_0x5c2a62,_0x156566,_0x2ec1cb){const _0x21ea0b=a49_0x5d4244;this[_0x21ea0b(0x1be)](_0x21ea0b(0x1ec),{'type':_0x21ea0b(0x1fd),'gateway':_0x5c2a62,'endpoint':_0x156566,'error':_0x2ec1cb instanceof Error?{'message':_0x2ec1cb['message'],'stack':_0x2ec1cb[_0x21ea0b(0x1c5)]}:_0x2ec1cb});}['logWebhookReceived'](_0xd187aa,_0x4e2fd9,_0x21a754){const _0x54dc84=a49_0x5d4244;this[_0x54dc84(0x1be)](_0x54dc84(0x1eb),{'type':_0x54dc84(0x1d0),'gateway':_0xd187aa,'headers':_0x21a754,'data':_0x4e2fd9});}[a49_0x5d4244(0x1c7)](_0x5d7259,_0x1a4d1e,_0x592ed2,_0x476054,_0x27e71d){const _0x9cd52b=a49_0x5d4244;this[_0x9cd52b(0x1be)]('webhooks_processed',{'type':_0x9cd52b(0x1b6),'gateway':_0x5d7259,'paymentId':_0x1a4d1e,'oldStatus':_0x592ed2,'newStatus':_0x476054,'originalData':_0x27e71d});}['logWebhookError'](_0x189af7,_0x374111,_0x4d98c2){const _0x5a6506=a49_0x5d4244;this[_0x5a6506(0x1be)](_0x5a6506(0x201),{'type':'WEBHOOK_ERROR','gateway':_0x189af7,'error':_0x374111 instanceof Error?{'message':_0x374111[_0x5a6506(0x1bf)],'stack':_0x374111[_0x5a6506(0x1c5)]}:_0x374111,'originalData':_0x4d98c2});}[a49_0x5d4244(0x1f2)](_0x6ecf50){const _0x3d0e49=a49_0x5d4244;this[_0x3d0e49(0x1be)](_0x3d0e49(0x1d9),{'type':_0x3d0e49(0x1f8),..._0x6ecf50});}[a49_0x5d4244(0x1c6)](_0x34d9ce){const _0x1ea907=a49_0x5d4244;this[_0x1ea907(0x1be)](_0x1ea907(0x1c1),{'type':_0x1ea907(0x1f3),..._0x34d9ce});}[a49_0x5d4244(0x1c9)](_0x36e657,_0x4228ac,_0x5114d5,_0x2defb1,_0x47031d,_0x15deb1){const _0x5c6827=a49_0x5d4244;this['writeLog']('shop_webhooks_sent',{'type':_0x5c6827(0x1cb),'shopId':_0x36e657,'webhookUrl':_0x4228ac,'event':_0x5114d5,'status':_0x2defb1,'responseTime':_0x47031d,'payload':_0x15deb1});}[a49_0x5d4244(0x1d2)](_0x372ad4,_0x513536,_0x354891,_0x2b0d37,_0x2abc0f){const _0x2608e9=a49_0x5d4244;this[_0x2608e9(0x1be)](_0x2608e9(0x1e2),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x372ad4,'webhookUrl':_0x513536,'event':_0x354891,'error':_0x2b0d37 instanceof Error?{'message':_0x2b0d37['message'],'stack':_0x2b0d37[_0x2608e9(0x1c5)]}:_0x2b0d37,'payload':_0x2abc0f});}[a49_0x5d4244(0x1ad)](_0x49b7dc,_0x4f89cb,_0x3e43b1,_0x440721,_0x196ebf){const _0x3e03a1=a49_0x5d4244;this[_0x3e03a1(0x1be)](_0x3e03a1(0x1cd),{'type':_0x3e03a1(0x1ed),'gateway':_0x49b7dc,'paymentId':_0x4f89cb,'shopId':_0x3e43b1,'amount':_0x440721,'currency':_0x196ebf});}[a49_0x5d4244(0x1f9)](_0x4ec862,_0x2e02fe,_0x54ac93,_0x307791,_0x418f88){const _0x997559=a49_0x5d4244;this[_0x997559(0x1be)](_0x997559(0x1f5),{'type':_0x997559(0x1b1),'endpoint':_0x4ec862,'method':_0x2e02fe,'userId':_0x54ac93,'userRole':_0x307791,'requestData':_0x418f88});}[a49_0x5d4244(0x1d7)](){const _0x1e360c=a49_0x5d4244;try{const _0x556b6b=fs_1[_0x1e360c(0x1af)][_0x1e360c(0x1e8)](this[_0x1e360c(0x1f1)]),_0x40d2db=_0x556b6b['filter'](_0x39309f=>_0x39309f[_0x1e360c(0x1e1)](_0x1e360c(0x1f6))),_0x3a2f7d=[...new Set(_0x40d2db[_0x1e360c(0x1cc)](_0xf420e2=>_0xf420e2[_0x1e360c(0x1dc)]('_')[0x0]))],_0x3cd68a=_0x40d2db['map'](_0x41958a=>{const _0x3f4d53=_0x1e360c,_0x521c38=path_1['default'][_0x3f4d53(0x1de)](this['logsDir'],_0x41958a),_0x468d10=fs_1[_0x3f4d53(0x1af)][_0x3f4d53(0x1c3)](_0x521c38),[_0x540bda,_0x3b40ee]=_0x41958a[_0x3f4d53(0x1df)](_0x3f4d53(0x1f6),'')['split']('_');return{'type':_0x540bda,'date':_0x3b40ee,'size':_0x468d10[_0x3f4d53(0x1ca)]};})[_0x1e360c(0x1fe)]((_0x4370c6,_0x4a16a1)=>_0x4a16a1[_0x1e360c(0x1ae)][_0x1e360c(0x1b3)](_0x4370c6['date']));return{'totalFiles':_0x40d2db[_0x1e360c(0x1d3)],'logTypes':_0x3a2f7d,'latestLogs':_0x3cd68a['slice'](0x0,0xa)};}catch(_0x5b1bac){return console['error'](_0x1e360c(0x1e0),_0x5b1bac),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x104b02=0x1e){const _0x1dfd0e=a49_0x5d4244;try{const _0x176f98=fs_1[_0x1dfd0e(0x1af)][_0x1dfd0e(0x1e8)](this[_0x1dfd0e(0x1f1)]),_0x4d1138=new Date();_0x4d1138[_0x1dfd0e(0x1e4)](_0x4d1138[_0x1dfd0e(0x1e9)]()-_0x104b02);let _0x2f3fe4=0x0;_0x176f98[_0x1dfd0e(0x1c4)](_0x529ebc=>{const _0x56e008=_0x1dfd0e;if(!_0x529ebc[_0x56e008(0x1e1)](_0x56e008(0x1f6)))return;const _0x5a7dca=path_1[_0x56e008(0x1af)][_0x56e008(0x1de)](this[_0x56e008(0x1f1)],_0x529ebc),_0x5ea099=fs_1[_0x56e008(0x1af)]['statSync'](_0x5a7dca);_0x5ea099[_0x56e008(0x1b8)]<_0x4d1138&&(fs_1[_0x56e008(0x1af)][_0x56e008(0x1c8)](_0x5a7dca),_0x2f3fe4++,console[_0x56e008(0x1b9)](_0x56e008(0x1fc)+_0x529ebc));}),console[_0x1dfd0e(0x1b9)]('🧹\x20Cleaned\x20'+_0x2f3fe4+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x104b02+_0x1dfd0e(0x1e7));}catch(_0x44bf84){console[_0x1dfd0e(0x1bb)](_0x1dfd0e(0x1da),_0x44bf84);}}}exports[a49_0x5d4244(0x200)]=LoggerService,exports[a49_0x5d4244(0x1ce)]=new LoggerService();