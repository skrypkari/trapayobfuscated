'use strict';const a56_0xfefd9c=a56_0x6723;function a56_0x18db(){const _0x34a88c=['setDate','6161220EbewNm','SHOP_WEBHOOK_SENT','map','white_domain_errors','webhooks_processed','logWhiteDomainResponse','__importDefault','cwd','writeLog','logCoinToPayStatus','payments_created','statSync','logWhiteDomainError','__esModule','7jABIei','COINTOPAY_ERROR','Failed\x20to\x20clean\x20old\x20logs:','stack','LoggerService','logCoinToPayError','split','getLogFileName','length','loggerService','path','502526pfUSiI','.log','logWebhookProcessed','webhooks_received','5015368UQxFsk','RESPONSE','12733731WHiIZb','utf8','logShopWebhookSent','1712104TWdKxV','api_calls','ERROR','appendFileSync','\x20log:','localeCompare','getLogStats','forEach','WEBHOOK_ERROR','default','cointopay_errors','join','log','shop_webhooks_sent','slice','replace','WEBHOOK_RECEIVED','3780132jLxzDP','cointopay_status_changes','logApiCall','readdirSync','209114mnHbbZ','error','defineProperty','Failed\x20to\x20get\x20log\x20stats:','logPaymentCreated','endsWith','logsDir','Failed\x20to\x20write\x20','🗑️\x20Deleted\x20old\x20log\x20file:\x20','📁\x20Created\x20logs\x20directory:\x20','mkdirSync','API_CALL','white_domain_requests','cleanOldLogs','shop_webhooks_errors','3viizPs','\x20old\x20log\x20files\x20(older\x20than\x20','message','10eYUGXC','date','\x20days)','toISOString','existsSync'];a56_0x18db=function(){return _0x34a88c;};return a56_0x18db();}(function(_0x50301c,_0x4f2e08){const _0x2495c4=a56_0x6723,_0x5a05db=_0x50301c();while(!![]){try{const _0x2f1137=parseInt(_0x2495c4(0xc7))/0x1+parseInt(_0x2495c4(0xa9))/0x2*(parseInt(_0x2495c4(0xd6))/0x3)+parseInt(_0x2495c4(0xad))/0x4+parseInt(_0x2495c4(0xdf))/0x5+-parseInt(_0x2495c4(0xc3))/0x6+parseInt(_0x2495c4(0xed))/0x7*(-parseInt(_0x2495c4(0xb2))/0x8)+parseInt(_0x2495c4(0xaf))/0x9*(-parseInt(_0x2495c4(0xd9))/0xa);if(_0x2f1137===_0x4f2e08)break;else _0x5a05db['push'](_0x5a05db['shift']());}catch(_0x4a985d){_0x5a05db['push'](_0x5a05db['shift']());}}}(a56_0x18db,0xa7dd1));var __importDefault=this&&this[a56_0xfefd9c(0xe5)]||function(_0x4e6d8d){return _0x4e6d8d&&_0x4e6d8d['__esModule']?_0x4e6d8d:{'default':_0x4e6d8d};};Object[a56_0xfefd9c(0xc9)](exports,a56_0xfefd9c(0xec),{'value':!![]}),exports[a56_0xfefd9c(0xa7)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a56_0xfefd9c(0xa8)));function a56_0x6723(_0x455080,_0x20d4a8){const _0x18dbce=a56_0x18db();return a56_0x6723=function(_0x6723b4,_0x40290d){_0x6723b4=_0x6723b4-0xa7;let _0x23f6e6=_0x18dbce[_0x6723b4];return _0x23f6e6;},a56_0x6723(_0x455080,_0x20d4a8);}class LoggerService{constructor(){const _0x2d2688=a56_0xfefd9c;this['logsDir']=path_1[_0x2d2688(0xbb)][_0x2d2688(0xbd)](process[_0x2d2688(0xe6)](),'logs'),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x51c16f=a56_0xfefd9c;!fs_1[_0x51c16f(0xbb)][_0x51c16f(0xdd)](this[_0x51c16f(0xcd)])&&(fs_1[_0x51c16f(0xbb)][_0x51c16f(0xd1)](this['logsDir'],{'recursive':!![]}),console[_0x51c16f(0xbe)](_0x51c16f(0xd0)+this[_0x51c16f(0xcd)]));}[a56_0xfefd9c(0xf4)](_0x1903ab){const _0x2bc7df=a56_0xfefd9c,_0x3aaa31=new Date()[_0x2bc7df(0xdc)]()['split']('T')[0x0];return path_1[_0x2bc7df(0xbb)][_0x2bc7df(0xbd)](this[_0x2bc7df(0xcd)],_0x1903ab+'_'+_0x3aaa31+_0x2bc7df(0xaa));}['writeLog'](_0x28cd3f,_0x2d139a){const _0x427f33=a56_0xfefd9c;try{const _0x5ed953=new Date()[_0x427f33(0xdc)](),_0x44d394={'timestamp':_0x5ed953,..._0x2d139a},_0x126004=JSON['stringify'](_0x44d394)+'\x0a',_0xce2930=this[_0x427f33(0xf4)](_0x28cd3f);fs_1[_0x427f33(0xbb)][_0x427f33(0xb5)](_0xce2930,_0x126004,_0x427f33(0xb0));}catch(_0x21173f){console[_0x427f33(0xc8)](_0x427f33(0xce)+_0x28cd3f+_0x427f33(0xb6),_0x21173f);}}['logWhiteDomainRequest'](_0x192be8,_0x1e6057,_0x23e77c,_0x43313a){const _0x293918=a56_0xfefd9c;this[_0x293918(0xe7)](_0x293918(0xd3),{'type':'REQUEST','gateway':_0x192be8,'endpoint':_0x1e6057,'method':_0x23e77c,'data':_0x43313a});}[a56_0xfefd9c(0xe4)](_0xd5a994,_0x433754,_0x21a18c,_0x55e7b5,_0x1aa0a7){const _0x1d794c=a56_0xfefd9c;this[_0x1d794c(0xe7)]('white_domain_responses',{'type':_0x1d794c(0xae),'gateway':_0xd5a994,'endpoint':_0x433754,'status':_0x21a18c,'responseTime':_0x1aa0a7,'data':_0x55e7b5});}[a56_0xfefd9c(0xeb)](_0x3d7781,_0x2f93e5,_0x39c63e){const _0x4fb969=a56_0xfefd9c;this['writeLog'](_0x4fb969(0xe2),{'type':_0x4fb969(0xb4),'gateway':_0x3d7781,'endpoint':_0x2f93e5,'error':_0x39c63e instanceof Error?{'message':_0x39c63e['message'],'stack':_0x39c63e[_0x4fb969(0xf0)]}:_0x39c63e});}['logWebhookReceived'](_0x110bab,_0xf24082,_0x462524){const _0x508114=a56_0xfefd9c;this['writeLog'](_0x508114(0xac),{'type':_0x508114(0xc2),'gateway':_0x110bab,'headers':_0x462524,'data':_0xf24082});}[a56_0xfefd9c(0xab)](_0xdb8d4,_0x261fbb,_0x14eb0f,_0x5972e3,_0x1cff27){const _0x5eedfe=a56_0xfefd9c;this[_0x5eedfe(0xe7)](_0x5eedfe(0xe3),{'type':'WEBHOOK_PROCESSED','gateway':_0xdb8d4,'paymentId':_0x261fbb,'oldStatus':_0x14eb0f,'newStatus':_0x5972e3,'originalData':_0x1cff27});}['logWebhookError'](_0x5f2563,_0x30b42d,_0x313568){const _0x1d11f5=a56_0xfefd9c;this[_0x1d11f5(0xe7)]('webhooks_errors',{'type':_0x1d11f5(0xba),'gateway':_0x5f2563,'error':_0x30b42d instanceof Error?{'message':_0x30b42d[_0x1d11f5(0xd8)],'stack':_0x30b42d[_0x1d11f5(0xf0)]}:_0x30b42d,'originalData':_0x313568});}[a56_0xfefd9c(0xe8)](_0x2a5eb9){const _0x1f89e6=a56_0xfefd9c;this[_0x1f89e6(0xe7)](_0x1f89e6(0xc4),{'type':'COINTOPAY_STATUS_CHANGE',..._0x2a5eb9});}[a56_0xfefd9c(0xf2)](_0x9d30c0){const _0x1f6f0b=a56_0xfefd9c;this[_0x1f6f0b(0xe7)](_0x1f6f0b(0xbc),{'type':_0x1f6f0b(0xee),..._0x9d30c0});}[a56_0xfefd9c(0xb1)](_0x1f2413,_0x2a13a5,_0x57f457,_0x2a002e,_0x5a4f12,_0x54f331){const _0x2ea1f7=a56_0xfefd9c;this['writeLog'](_0x2ea1f7(0xbf),{'type':_0x2ea1f7(0xe0),'shopId':_0x1f2413,'webhookUrl':_0x2a13a5,'event':_0x57f457,'status':_0x2a002e,'responseTime':_0x5a4f12,'payload':_0x54f331});}['logShopWebhookError'](_0x26b3ac,_0x169e88,_0x434463,_0x106ff1,_0xe361d5){const _0x313332=a56_0xfefd9c;this['writeLog'](_0x313332(0xd5),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x26b3ac,'webhookUrl':_0x169e88,'event':_0x434463,'error':_0x106ff1 instanceof Error?{'message':_0x106ff1['message'],'stack':_0x106ff1[_0x313332(0xf0)]}:_0x106ff1,'payload':_0xe361d5});}[a56_0xfefd9c(0xcb)](_0x1be9c8,_0x416d27,_0x575cc6,_0x202a04,_0x323f72){const _0x2fd700=a56_0xfefd9c;this[_0x2fd700(0xe7)](_0x2fd700(0xe9),{'type':'PAYMENT_CREATED','gateway':_0x1be9c8,'paymentId':_0x416d27,'shopId':_0x575cc6,'amount':_0x202a04,'currency':_0x323f72});}[a56_0xfefd9c(0xc5)](_0x2e4998,_0x182e26,_0x12f55e,_0x330e27,_0x2499b1){const _0x354811=a56_0xfefd9c;this[_0x354811(0xe7)](_0x354811(0xb3),{'type':_0x354811(0xd2),'endpoint':_0x2e4998,'method':_0x182e26,'userId':_0x12f55e,'userRole':_0x330e27,'requestData':_0x2499b1});}[a56_0xfefd9c(0xb8)](){const _0x10551a=a56_0xfefd9c;try{const _0x5aebce=fs_1[_0x10551a(0xbb)][_0x10551a(0xc6)](this[_0x10551a(0xcd)]),_0x23c5d2=_0x5aebce['filter'](_0x590bc0=>_0x590bc0['endsWith']('.log')),_0x2d97c9=[...new Set(_0x23c5d2[_0x10551a(0xe1)](_0x367757=>_0x367757[_0x10551a(0xf3)]('_')[0x0]))],_0x192031=_0x23c5d2[_0x10551a(0xe1)](_0x187dad=>{const _0x47025c=_0x10551a,_0x4484e6=path_1[_0x47025c(0xbb)][_0x47025c(0xbd)](this['logsDir'],_0x187dad),_0x58354b=fs_1[_0x47025c(0xbb)][_0x47025c(0xea)](_0x4484e6),[_0x463e57,_0x56be4b]=_0x187dad[_0x47025c(0xc1)](_0x47025c(0xaa),'')['split']('_');return{'type':_0x463e57,'date':_0x56be4b,'size':_0x58354b['size']};})['sort']((_0x388aba,_0x36041e)=>_0x36041e['date'][_0x10551a(0xb7)](_0x388aba[_0x10551a(0xda)]));return{'totalFiles':_0x23c5d2[_0x10551a(0xf5)],'logTypes':_0x2d97c9,'latestLogs':_0x192031[_0x10551a(0xc0)](0x0,0xa)};}catch(_0x2fc697){return console[_0x10551a(0xc8)](_0x10551a(0xca),_0x2fc697),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a56_0xfefd9c(0xd4)](_0x3a537d=0x1e){const _0x25c23f=a56_0xfefd9c;try{const _0x25e249=fs_1[_0x25c23f(0xbb)][_0x25c23f(0xc6)](this[_0x25c23f(0xcd)]),_0x26a4ab=new Date();_0x26a4ab[_0x25c23f(0xde)](_0x26a4ab['getDate']()-_0x3a537d);let _0x472982=0x0;_0x25e249[_0x25c23f(0xb9)](_0x5df0f5=>{const _0x5413ec=_0x25c23f;if(!_0x5df0f5[_0x5413ec(0xcc)](_0x5413ec(0xaa)))return;const _0x1d45fe=path_1[_0x5413ec(0xbb)]['join'](this[_0x5413ec(0xcd)],_0x5df0f5),_0x476f86=fs_1[_0x5413ec(0xbb)][_0x5413ec(0xea)](_0x1d45fe);_0x476f86['mtime']<_0x26a4ab&&(fs_1[_0x5413ec(0xbb)]['unlinkSync'](_0x1d45fe),_0x472982++,console[_0x5413ec(0xbe)](_0x5413ec(0xcf)+_0x5df0f5));}),console['log']('🧹\x20Cleaned\x20'+_0x472982+_0x25c23f(0xd7)+_0x3a537d+_0x25c23f(0xdb));}catch(_0x368442){console[_0x25c23f(0xc8)](_0x25c23f(0xef),_0x368442);}}}exports[a56_0xfefd9c(0xf1)]=LoggerService,exports[a56_0xfefd9c(0xa7)]=new LoggerService();