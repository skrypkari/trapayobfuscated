'use strict';const a79_0x55dbed=a79_0x1fb4;(function(_0x5942cc,_0x24b368){const _0x5a17bd=a79_0x1fb4,_0x53ef19=_0x5942cc();while(!![]){try{const _0x45352=-parseInt(_0x5a17bd(0x1fc))/0x1+-parseInt(_0x5a17bd(0x1ed))/0x2*(-parseInt(_0x5a17bd(0x1ea))/0x3)+-parseInt(_0x5a17bd(0x207))/0x4+-parseInt(_0x5a17bd(0x20f))/0x5+-parseInt(_0x5a17bd(0x217))/0x6+parseInt(_0x5a17bd(0x1fa))/0x7*(-parseInt(_0x5a17bd(0x224))/0x8)+-parseInt(_0x5a17bd(0x1eb))/0x9*(-parseInt(_0x5a17bd(0x1e3))/0xa);if(_0x45352===_0x24b368)break;else _0x53ef19['push'](_0x53ef19['shift']());}catch(_0x4a6ba3){_0x53ef19['push'](_0x53ef19['shift']());}}}(a79_0x2015,0x79517));function a79_0x2015(){const _0x511c66=['logsDir','logApiCall','120bsocmh','WEBHOOK_PROCESSED','logShopWebhookSent','logWebhookReceived','loggerService','webhooks_errors','logCoinToPayStatus','COINTOPAY_ERROR','logPaymentCreated','white_domain_requests','unlinkSync','endsWith','setDate','RESPONSE','existsSync','payments_created','readdirSync','cointopay_status_changes','date','__esModule','logWhiteDomainRequest','defineProperty','30AWrrJP','SHOP_WEBHOOK_ERROR','shop_webhooks_errors','error','message','ðŸ“\x20Created\x20logs\x20directory:\x20','LoggerService','3BOnDtC','9648738hxYoqm','white_domain_errors','95478pRVIrV','WEBHOOK_ERROR','log','WEBHOOK_RECEIVED','getDate','Failed\x20to\x20write\x20','getLogStats','join','logs','.log','logWebhookError','ðŸ§¹\x20Cleaned\x20','localeCompare','169407WDWPji','\x20log:','869140QhAmLJ','COINTOPAY_STATUS_CHANGE','shop_webhooks_sent','logWhiteDomainResponse','API_CALL','path','SHOP_WEBHOOK_SENT','webhooks_processed','default','split','getLogFileName','2551696RuWcYJ','map','toISOString','\x20days)','\x20old\x20log\x20files\x20(older\x20than\x20','forEach','PAYMENT_CREATED','replace','961360REZcnz','logShopWebhookError','stringify','filter','Failed\x20to\x20clean\x20old\x20logs:','slice','REQUEST','writeLog','4228290eQXHTj','statSync','ensureLogsDirectory','sort','stack','cleanOldLogs','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','logCoinToPayError','webhooks_received','ERROR','length'];a79_0x2015=function(){return _0x511c66;};return a79_0x2015();}var __importDefault=this&&this['__importDefault']||function(_0x23c43c){const _0x5b13f0=a79_0x1fb4;return _0x23c43c&&_0x23c43c[_0x5b13f0(0x1e0)]?_0x23c43c:{'default':_0x23c43c};};function a79_0x1fb4(_0x4dd8de,_0x39851a){_0x4dd8de=_0x4dd8de-0x1d3;const _0x2015c7=a79_0x2015();let _0x1fb479=_0x2015c7[_0x4dd8de];return _0x1fb479;}Object[a79_0x55dbed(0x1e2)](exports,a79_0x55dbed(0x1e0),{'value':!![]}),exports[a79_0x55dbed(0x228)]=exports[a79_0x55dbed(0x1e9)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x55dbed(0x201)));class LoggerService{constructor(){const _0x1aa922=a79_0x55dbed;this[_0x1aa922(0x222)]=path_1['default']['join'](process['cwd'](),_0x1aa922(0x1f5)),this['ensureLogsDirectory']();}[a79_0x55dbed(0x219)](){const _0x288af9=a79_0x55dbed;!fs_1[_0x288af9(0x204)][_0x288af9(0x1db)](this['logsDir'])&&(fs_1[_0x288af9(0x204)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x288af9(0x1ef)](_0x288af9(0x1e8)+this[_0x288af9(0x222)]));}[a79_0x55dbed(0x206)](_0x2ab5b2){const _0x40dac8=a79_0x55dbed,_0x27abbb=new Date()[_0x40dac8(0x209)]()[_0x40dac8(0x205)]('T')[0x0];return path_1[_0x40dac8(0x204)][_0x40dac8(0x1f4)](this[_0x40dac8(0x222)],_0x2ab5b2+'_'+_0x27abbb+'.log');}['writeLog'](_0x1ec368,_0x3db817){const _0x3446f2=a79_0x55dbed;try{const _0x545939=new Date()[_0x3446f2(0x209)](),_0x2db546={'timestamp':_0x545939,..._0x3db817},_0x1e538a=JSON[_0x3446f2(0x211)](_0x2db546)+'\x0a',_0x53c98f=this[_0x3446f2(0x206)](_0x1ec368);fs_1[_0x3446f2(0x204)]['appendFileSync'](_0x53c98f,_0x1e538a,'utf8');}catch(_0x4f1c94){console[_0x3446f2(0x1e6)](_0x3446f2(0x1f2)+_0x1ec368+_0x3446f2(0x1fb),_0x4f1c94);}}[a79_0x55dbed(0x1e1)](_0x29d342,_0x221bfc,_0x564c5f,_0x31f922){const _0x5d9512=a79_0x55dbed;this[_0x5d9512(0x216)](_0x5d9512(0x1d6),{'type':_0x5d9512(0x215),'gateway':_0x29d342,'endpoint':_0x221bfc,'method':_0x564c5f,'data':_0x31f922});}[a79_0x55dbed(0x1ff)](_0x55427f,_0x2c33ac,_0x2e6c51,_0x4bffc6,_0x2c5846){const _0x3b4fd6=a79_0x55dbed;this['writeLog']('white_domain_responses',{'type':_0x3b4fd6(0x1da),'gateway':_0x55427f,'endpoint':_0x2c33ac,'status':_0x2e6c51,'responseTime':_0x2c5846,'data':_0x4bffc6});}['logWhiteDomainError'](_0x5b9fc6,_0x1fcd7b,_0x52fffe){const _0x5a3736=a79_0x55dbed;this[_0x5a3736(0x216)](_0x5a3736(0x1ec),{'type':_0x5a3736(0x220),'gateway':_0x5b9fc6,'endpoint':_0x1fcd7b,'error':_0x52fffe instanceof Error?{'message':_0x52fffe[_0x5a3736(0x1e7)],'stack':_0x52fffe[_0x5a3736(0x21b)]}:_0x52fffe});}[a79_0x55dbed(0x227)](_0x23e3a1,_0x25a939,_0x4ab8b1){const _0x49e7bc=a79_0x55dbed;this['writeLog'](_0x49e7bc(0x21f),{'type':_0x49e7bc(0x1f0),'gateway':_0x23e3a1,'headers':_0x4ab8b1,'data':_0x25a939});}['logWebhookProcessed'](_0x56a270,_0x194eae,_0x599fbe,_0x59e04f,_0x4b13ca){const _0x325e84=a79_0x55dbed;this[_0x325e84(0x216)](_0x325e84(0x203),{'type':_0x325e84(0x225),'gateway':_0x56a270,'paymentId':_0x194eae,'oldStatus':_0x599fbe,'newStatus':_0x59e04f,'originalData':_0x4b13ca});}[a79_0x55dbed(0x1f7)](_0x23bc15,_0x5a53c6,_0x5284d2){const _0x58f0af=a79_0x55dbed;this[_0x58f0af(0x216)](_0x58f0af(0x229),{'type':_0x58f0af(0x1ee),'gateway':_0x23bc15,'error':_0x5a53c6 instanceof Error?{'message':_0x5a53c6[_0x58f0af(0x1e7)],'stack':_0x5a53c6[_0x58f0af(0x21b)]}:_0x5a53c6,'originalData':_0x5284d2});}[a79_0x55dbed(0x1d3)](_0x63ed57){const _0x5afb6b=a79_0x55dbed;this[_0x5afb6b(0x216)](_0x5afb6b(0x1de),{'type':_0x5afb6b(0x1fd),..._0x63ed57});}[a79_0x55dbed(0x21e)](_0x675c56){const _0x3fce52=a79_0x55dbed;this['writeLog']('cointopay_errors',{'type':_0x3fce52(0x1d4),..._0x675c56});}[a79_0x55dbed(0x226)](_0x1362b7,_0x2050c8,_0x85c64f,_0xf59eea,_0x491093,_0x236308){const _0x4af626=a79_0x55dbed;this[_0x4af626(0x216)](_0x4af626(0x1fe),{'type':_0x4af626(0x202),'shopId':_0x1362b7,'webhookUrl':_0x2050c8,'event':_0x85c64f,'status':_0xf59eea,'responseTime':_0x491093,'payload':_0x236308});}[a79_0x55dbed(0x210)](_0x44fe4e,_0x192b8c,_0x28dd0c,_0x3139b0,_0x59fd43){const _0x5eb811=a79_0x55dbed;this[_0x5eb811(0x216)](_0x5eb811(0x1e5),{'type':_0x5eb811(0x1e4),'shopId':_0x44fe4e,'webhookUrl':_0x192b8c,'event':_0x28dd0c,'error':_0x3139b0 instanceof Error?{'message':_0x3139b0[_0x5eb811(0x1e7)],'stack':_0x3139b0[_0x5eb811(0x21b)]}:_0x3139b0,'payload':_0x59fd43});}[a79_0x55dbed(0x1d5)](_0x4e8f2a,_0x586c8b,_0x552af3,_0x3d2fd3,_0xb2393f){const _0x49a0c6=a79_0x55dbed;this[_0x49a0c6(0x216)](_0x49a0c6(0x1dc),{'type':_0x49a0c6(0x20d),'gateway':_0x4e8f2a,'paymentId':_0x586c8b,'shopId':_0x552af3,'amount':_0x3d2fd3,'currency':_0xb2393f});}[a79_0x55dbed(0x223)](_0x542f37,_0x3b15f5,_0x2ec3b6,_0x58d808,_0x4d6aa7){const _0x3ffdcf=a79_0x55dbed;this['writeLog']('api_calls',{'type':_0x3ffdcf(0x200),'endpoint':_0x542f37,'method':_0x3b15f5,'userId':_0x2ec3b6,'userRole':_0x58d808,'requestData':_0x4d6aa7});}[a79_0x55dbed(0x1f3)](){const _0x577c2e=a79_0x55dbed;try{const _0x3dd0d6=fs_1[_0x577c2e(0x204)][_0x577c2e(0x1dd)](this['logsDir']),_0x2c75ff=_0x3dd0d6[_0x577c2e(0x212)](_0x29beae=>_0x29beae['endsWith'](_0x577c2e(0x1f6))),_0x136549=[...new Set(_0x2c75ff[_0x577c2e(0x208)](_0x2d4a53=>_0x2d4a53['split']('_')[0x0]))],_0xed892f=_0x2c75ff[_0x577c2e(0x208)](_0x4b6d72=>{const _0x22bbef=_0x577c2e,_0x2c4b94=path_1[_0x22bbef(0x204)][_0x22bbef(0x1f4)](this[_0x22bbef(0x222)],_0x4b6d72),_0x3044d9=fs_1[_0x22bbef(0x204)][_0x22bbef(0x218)](_0x2c4b94),[_0x2cf40c,_0x34d1fb]=_0x4b6d72[_0x22bbef(0x20e)](_0x22bbef(0x1f6),'')[_0x22bbef(0x205)]('_');return{'type':_0x2cf40c,'date':_0x34d1fb,'size':_0x3044d9['size']};})[_0x577c2e(0x21a)]((_0x487a3d,_0x3124c0)=>_0x3124c0['date'][_0x577c2e(0x1f9)](_0x487a3d[_0x577c2e(0x1df)]));return{'totalFiles':_0x2c75ff[_0x577c2e(0x221)],'logTypes':_0x136549,'latestLogs':_0xed892f[_0x577c2e(0x214)](0x0,0xa)};}catch(_0x150340){return console[_0x577c2e(0x1e6)]('Failed\x20to\x20get\x20log\x20stats:',_0x150340),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a79_0x55dbed(0x21c)](_0x3c2e28=0x1e){const _0xf5fdfb=a79_0x55dbed;try{const _0x1de6a7=fs_1[_0xf5fdfb(0x204)][_0xf5fdfb(0x1dd)](this[_0xf5fdfb(0x222)]),_0x76818f=new Date();_0x76818f[_0xf5fdfb(0x1d9)](_0x76818f[_0xf5fdfb(0x1f1)]()-_0x3c2e28);let _0x331c86=0x0;_0x1de6a7[_0xf5fdfb(0x20c)](_0x35a497=>{const _0x71fb8e=_0xf5fdfb;if(!_0x35a497[_0x71fb8e(0x1d8)](_0x71fb8e(0x1f6)))return;const _0x54baa3=path_1['default']['join'](this[_0x71fb8e(0x222)],_0x35a497),_0x179471=fs_1[_0x71fb8e(0x204)]['statSync'](_0x54baa3);_0x179471['mtime']<_0x76818f&&(fs_1[_0x71fb8e(0x204)][_0x71fb8e(0x1d7)](_0x54baa3),_0x331c86++,console[_0x71fb8e(0x1ef)](_0x71fb8e(0x21d)+_0x35a497));}),console['log'](_0xf5fdfb(0x1f8)+_0x331c86+_0xf5fdfb(0x20b)+_0x3c2e28+_0xf5fdfb(0x20a));}catch(_0x137934){console[_0xf5fdfb(0x1e6)](_0xf5fdfb(0x213),_0x137934);}}}exports[a79_0x55dbed(0x1e9)]=LoggerService,exports['loggerService']=new LoggerService();