'use strict';const a59_0x5b0329=a59_0x1b2e;function a59_0x1b2e(_0x27c75e,_0x3d465f){const _0x3d54dd=a59_0x3d54();return a59_0x1b2e=function(_0x1b2e02,_0x59bea7){_0x1b2e02=_0x1b2e02-0xc3;let _0x11e040=_0x3d54dd[_0x1b2e02];return _0x11e040;},a59_0x1b2e(_0x27c75e,_0x3d465f);}(function(_0x1ded48,_0x15053a){const _0x24eff8=a59_0x1b2e,_0x3b6d46=_0x1ded48();while(!![]){try{const _0x5b0053=parseInt(_0x24eff8(0xf1))/0x1*(-parseInt(_0x24eff8(0x10f))/0x2)+parseInt(_0x24eff8(0xea))/0x3+-parseInt(_0x24eff8(0xde))/0x4*(-parseInt(_0x24eff8(0xfd))/0x5)+parseInt(_0x24eff8(0xf0))/0x6*(-parseInt(_0x24eff8(0xe7))/0x7)+parseInt(_0x24eff8(0xf9))/0x8*(parseInt(_0x24eff8(0xdf))/0x9)+-parseInt(_0x24eff8(0xf8))/0xa*(parseInt(_0x24eff8(0xd2))/0xb)+parseInt(_0x24eff8(0xd1))/0xc;if(_0x5b0053===_0x15053a)break;else _0x3b6d46['push'](_0x3b6d46['shift']());}catch(_0x2102ba){_0x3b6d46['push'](_0x3b6d46['shift']());}}}(a59_0x3d54,0xeb241));var __importDefault=this&&this[a59_0x5b0329(0xd6)]||function(_0xde1d91){const _0x388412=a59_0x5b0329;return _0xde1d91&&_0xde1d91[_0x388412(0xf2)]?_0xde1d91:{'default':_0xde1d91};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a59_0x5b0329(0x107)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x5b0329(0xed)));function a59_0x3d54(){const _0x2bffaa=['cointopay_status_changes','logsDir','size','white_domain_requests','statSync','webhooks_received','29055072xugPMB','348370KUMRQz','date','logCoinToPayError','getLogFileName','__importDefault','stringify','map','localeCompare','logWhiteDomainError','white_domain_responses','logShopWebhookError','appendFileSync','105372tJgISM','2394531KPfiDk','payments_created','mkdirSync','toISOString','logWebhookError','webhooks_processed','📁\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20clean\x20old\x20logs:','448210FQpQJb','utf8','WEBHOOK_ERROR','2347785CrAcYF','default','readdirSync','path','🧹\x20Cleaned\x20','cwd','150PvAxVs','16BIAyst','__esModule','getDate','PAYMENT_CREATED','logWhiteDomainResponse','unlinkSync','getLogStats','190elajYu','8rrKtjI','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logApiCall','REQUEST','65ovQxme','message','stack','Failed\x20to\x20get\x20log\x20stats:','logCoinToPayStatus','webhooks_errors','\x20days)','logWhiteDomainRequest','setDate','replace','loggerService','log','shop_webhooks_errors','logs','join','filter','.log','writeLog','80844NgyLsp','WEBHOOK_RECEIVED','existsSync','endsWith','white_domain_errors','error','ensureLogsDirectory','ERROR','mtime','LoggerService'];a59_0x3d54=function(){return _0x2bffaa;};return a59_0x3d54();}class LoggerService{constructor(){const _0x5f505f=a59_0x5b0329;this[_0x5f505f(0xcc)]=path_1['default'][_0x5f505f(0x10b)](process[_0x5f505f(0xef)](),_0x5f505f(0x10a)),this['ensureLogsDirectory']();}[a59_0x5b0329(0xc7)](){const _0x3b0818=a59_0x5b0329;!fs_1[_0x3b0818(0xeb)][_0x3b0818(0xc3)](this['logsDir'])&&(fs_1['default'][_0x3b0818(0xe1)](this[_0x3b0818(0xcc)],{'recursive':!![]}),console[_0x3b0818(0x108)](_0x3b0818(0xe5)+this[_0x3b0818(0xcc)]));}['getLogFileName'](_0x5afbeb){const _0x26c6c=a59_0x5b0329,_0x3cd53d=new Date()[_0x26c6c(0xe2)]()['split']('T')[0x0];return path_1[_0x26c6c(0xeb)][_0x26c6c(0x10b)](this[_0x26c6c(0xcc)],_0x5afbeb+'_'+_0x3cd53d+_0x26c6c(0x10d));}['writeLog'](_0x40a614,_0x4b1ebd){const _0x24563a=a59_0x5b0329;try{const _0x45eca1=new Date()[_0x24563a(0xe2)](),_0x533988={'timestamp':_0x45eca1,..._0x4b1ebd},_0x3f1b17=JSON[_0x24563a(0xd7)](_0x533988)+'\x0a',_0x2b76b5=this[_0x24563a(0xd5)](_0x40a614);fs_1['default'][_0x24563a(0xdd)](_0x2b76b5,_0x3f1b17,_0x24563a(0xe8));}catch(_0x583db1){console['error']('Failed\x20to\x20write\x20'+_0x40a614+'\x20log:',_0x583db1);}}[a59_0x5b0329(0x104)](_0x57c6c5,_0x21e127,_0xb735a7,_0xe6a2a4){const _0x14b0a7=a59_0x5b0329;this['writeLog'](_0x14b0a7(0xce),{'type':_0x14b0a7(0xfc),'gateway':_0x57c6c5,'endpoint':_0x21e127,'method':_0xb735a7,'data':_0xe6a2a4});}[a59_0x5b0329(0xf5)](_0x27e8de,_0x2d632e,_0x2f10f5,_0x27cefe,_0x312c36){const _0x3bcf23=a59_0x5b0329;this[_0x3bcf23(0x10e)](_0x3bcf23(0xdb),{'type':'RESPONSE','gateway':_0x27e8de,'endpoint':_0x2d632e,'status':_0x2f10f5,'responseTime':_0x312c36,'data':_0x27cefe});}[a59_0x5b0329(0xda)](_0x50bf0f,_0x5397ed,_0x383247){const _0x518cd7=a59_0x5b0329;this[_0x518cd7(0x10e)](_0x518cd7(0xc5),{'type':_0x518cd7(0xc8),'gateway':_0x50bf0f,'endpoint':_0x5397ed,'error':_0x383247 instanceof Error?{'message':_0x383247[_0x518cd7(0xfe)],'stack':_0x383247['stack']}:_0x383247});}['logWebhookReceived'](_0x57fc74,_0x6bbf8c,_0x5672c5){const _0x5389bf=a59_0x5b0329;this['writeLog'](_0x5389bf(0xd0),{'type':_0x5389bf(0x110),'gateway':_0x57fc74,'headers':_0x5672c5,'data':_0x6bbf8c});}['logWebhookProcessed'](_0x31830d,_0x1bc635,_0x168c87,_0x3d8dd2,_0x52a7fe){const _0x4295bc=a59_0x5b0329;this[_0x4295bc(0x10e)](_0x4295bc(0xe4),{'type':'WEBHOOK_PROCESSED','gateway':_0x31830d,'paymentId':_0x1bc635,'oldStatus':_0x168c87,'newStatus':_0x3d8dd2,'originalData':_0x52a7fe});}[a59_0x5b0329(0xe3)](_0x43297c,_0x2cc538,_0x4d6842){const _0x394b2a=a59_0x5b0329;this[_0x394b2a(0x10e)](_0x394b2a(0x102),{'type':_0x394b2a(0xe9),'gateway':_0x43297c,'error':_0x2cc538 instanceof Error?{'message':_0x2cc538[_0x394b2a(0xfe)],'stack':_0x2cc538[_0x394b2a(0xff)]}:_0x2cc538,'originalData':_0x4d6842});}[a59_0x5b0329(0x101)](_0x20f473){const _0x10c69f=a59_0x5b0329;this[_0x10c69f(0x10e)](_0x10c69f(0xcb),{'type':'COINTOPAY_STATUS_CHANGE',..._0x20f473});}[a59_0x5b0329(0xd4)](_0x51dcc7){const _0x2b4f78=a59_0x5b0329;this[_0x2b4f78(0x10e)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x51dcc7});}['logShopWebhookSent'](_0x56b770,_0x480a42,_0x138950,_0x37603a,_0x301201,_0x5d3f9d){const _0x3f44b3=a59_0x5b0329;this[_0x3f44b3(0x10e)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x56b770,'webhookUrl':_0x480a42,'event':_0x138950,'status':_0x37603a,'responseTime':_0x301201,'payload':_0x5d3f9d});}[a59_0x5b0329(0xdc)](_0x239b34,_0x1dd71c,_0x540c41,_0x627d5b,_0x170a57){const _0xdd96c8=a59_0x5b0329;this['writeLog'](_0xdd96c8(0x109),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x239b34,'webhookUrl':_0x1dd71c,'event':_0x540c41,'error':_0x627d5b instanceof Error?{'message':_0x627d5b[_0xdd96c8(0xfe)],'stack':_0x627d5b[_0xdd96c8(0xff)]}:_0x627d5b,'payload':_0x170a57});}['logPaymentCreated'](_0x11e183,_0x322331,_0x5553bf,_0x13cee3,_0x5e367a){const _0xa95ffe=a59_0x5b0329;this[_0xa95ffe(0x10e)](_0xa95ffe(0xe0),{'type':_0xa95ffe(0xf4),'gateway':_0x11e183,'paymentId':_0x322331,'shopId':_0x5553bf,'amount':_0x13cee3,'currency':_0x5e367a});}[a59_0x5b0329(0xfb)](_0x1db7a9,_0x598e09,_0x494c4f,_0x5e0b6f,_0xcb3c63){const _0xf09193=a59_0x5b0329;this[_0xf09193(0x10e)]('api_calls',{'type':'API_CALL','endpoint':_0x1db7a9,'method':_0x598e09,'userId':_0x494c4f,'userRole':_0x5e0b6f,'requestData':_0xcb3c63});}[a59_0x5b0329(0xf7)](){const _0x219b30=a59_0x5b0329;try{const _0x99b4fe=fs_1[_0x219b30(0xeb)][_0x219b30(0xec)](this[_0x219b30(0xcc)]),_0x343724=_0x99b4fe[_0x219b30(0x10c)](_0x21d8ce=>_0x21d8ce['endsWith'](_0x219b30(0x10d))),_0x11d46=[...new Set(_0x343724[_0x219b30(0xd8)](_0x57b3a4=>_0x57b3a4['split']('_')[0x0]))],_0x1c2615=_0x343724[_0x219b30(0xd8)](_0x311148=>{const _0x471f05=_0x219b30,_0xc5980f=path_1['default'][_0x471f05(0x10b)](this[_0x471f05(0xcc)],_0x311148),_0x4263ac=fs_1['default'][_0x471f05(0xcf)](_0xc5980f),[_0x1177e1,_0x29d663]=_0x311148[_0x471f05(0x106)]('.log','')['split']('_');return{'type':_0x1177e1,'date':_0x29d663,'size':_0x4263ac[_0x471f05(0xcd)]};})['sort']((_0x1d3a7b,_0x52599f)=>_0x52599f[_0x219b30(0xd3)][_0x219b30(0xd9)](_0x1d3a7b[_0x219b30(0xd3)]));return{'totalFiles':_0x343724['length'],'logTypes':_0x11d46,'latestLogs':_0x1c2615['slice'](0x0,0xa)};}catch(_0x43ce0e){return console[_0x219b30(0xc6)](_0x219b30(0x100),_0x43ce0e),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x35cdcc=0x1e){const _0x3f6af8=a59_0x5b0329;try{const _0x2ed7ae=fs_1[_0x3f6af8(0xeb)][_0x3f6af8(0xec)](this[_0x3f6af8(0xcc)]),_0x28a698=new Date();_0x28a698[_0x3f6af8(0x105)](_0x28a698[_0x3f6af8(0xf3)]()-_0x35cdcc);let _0x9a603d=0x0;_0x2ed7ae['forEach'](_0x4aecb4=>{const _0x1bbfd1=_0x3f6af8;if(!_0x4aecb4[_0x1bbfd1(0xc4)](_0x1bbfd1(0x10d)))return;const _0x50ccd7=path_1['default'][_0x1bbfd1(0x10b)](this[_0x1bbfd1(0xcc)],_0x4aecb4),_0x59090e=fs_1[_0x1bbfd1(0xeb)][_0x1bbfd1(0xcf)](_0x50ccd7);_0x59090e[_0x1bbfd1(0xc9)]<_0x28a698&&(fs_1[_0x1bbfd1(0xeb)][_0x1bbfd1(0xf6)](_0x50ccd7),_0x9a603d++,console[_0x1bbfd1(0x108)](_0x1bbfd1(0xfa)+_0x4aecb4));}),console[_0x3f6af8(0x108)](_0x3f6af8(0xee)+_0x9a603d+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x35cdcc+_0x3f6af8(0x103));}catch(_0x3d004c){console[_0x3f6af8(0xc6)](_0x3f6af8(0xe6),_0x3d004c);}}}exports[a59_0x5b0329(0xca)]=LoggerService,exports[a59_0x5b0329(0x107)]=new LoggerService();