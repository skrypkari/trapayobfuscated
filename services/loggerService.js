'use strict';function a79_0x5621(_0x100fd4,_0x59c3dd){_0x100fd4=_0x100fd4-0x129;const _0x5ce1f4=a79_0x5ce1();let _0x562102=_0x5ce1f4[_0x100fd4];return _0x562102;}function a79_0x5ce1(){const _0x4e3538=['Failed\x20to\x20write\x20','sort','unlinkSync','COINTOPAY_ERROR','path','join','\x20days)','logsDir','965JeCcLg','ensureLogsDirectory','api_calls','1JrdhND','logShopWebhookError','861144YAXwtU','logWhiteDomainResponse','logApiCall','forEach','LoggerService','length','logs','.log','PAYMENT_CREATED','ERROR','split','SHOP_WEBHOOK_SENT','API_CALL','logWhiteDomainError','getLogFileName','__esModule','logShopWebhookSent','1948080VOiGBW','readdirSync','mkdirSync','cointopay_errors','logWebhookProcessed','stringify','REQUEST','Failed\x20to\x20get\x20log\x20stats:','2204gsIYdo','3912412KbYrTd','message','writeLog','webhooks_errors','WEBHOOK_ERROR','date','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','toISOString','Failed\x20to\x20clean\x20old\x20logs:','error','appendFileSync','white_domain_responses','slice','logCoinToPayStatus','localeCompare','6224958pFWRYI','map','stack','payments_created','WEBHOOK_PROCESSED','logWebhookReceived','ðŸ§¹\x20Cleaned\x20','logCoinToPayError','cointopay_status_changes','existsSync','replace','default','shop_webhooks_errors','715918BLqFLd','endsWith','\x20old\x20log\x20files\x20(older\x20than\x20','filter','webhooks_processed','statSync','10LQkuyG','2499540LtcOsR','log','loggerService','__importDefault','WEBHOOK_RECEIVED'];a79_0x5ce1=function(){return _0x4e3538;};return a79_0x5ce1();}const a79_0x2ecaa3=a79_0x5621;(function(_0x1923f2,_0x3966f0){const _0x131a8e=a79_0x5621,_0x2ac0f6=_0x1923f2();while(!![]){try{const _0x4f939f=-parseInt(_0x131a8e(0x173))/0x1*(parseInt(_0x131a8e(0x15c))/0x2)+-parseInt(_0x131a8e(0x175))/0x3+-parseInt(_0x131a8e(0x13f))/0x4*(parseInt(_0x131a8e(0x170))/0x5)+-parseInt(_0x131a8e(0x163))/0x6+parseInt(_0x131a8e(0x140))/0x7+parseInt(_0x131a8e(0x137))/0x8+parseInt(_0x131a8e(0x14f))/0x9*(parseInt(_0x131a8e(0x162))/0xa);if(_0x4f939f===_0x3966f0)break;else _0x2ac0f6['push'](_0x2ac0f6['shift']());}catch(_0x3dc9cd){_0x2ac0f6['push'](_0x2ac0f6['shift']());}}}(a79_0x5ce1,0x4fa04));var __importDefault=this&&this[a79_0x2ecaa3(0x166)]||function(_0x5b599f){return _0x5b599f&&_0x5b599f['__esModule']?_0x5b599f:{'default':_0x5b599f};};Object['defineProperty'](exports,a79_0x2ecaa3(0x135),{'value':!![]}),exports[a79_0x2ecaa3(0x165)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x2ecaa3(0x16c)));class LoggerService{constructor(){const _0x475bad=a79_0x2ecaa3;this[_0x475bad(0x16f)]=path_1['default'][_0x475bad(0x16d)](process['cwd'](),_0x475bad(0x12c)),this[_0x475bad(0x171)]();}[a79_0x2ecaa3(0x171)](){const _0x26237e=a79_0x2ecaa3;!fs_1[_0x26237e(0x15a)][_0x26237e(0x158)](this[_0x26237e(0x16f)])&&(fs_1['default'][_0x26237e(0x139)](this[_0x26237e(0x16f)],{'recursive':!![]}),console['log']('ðŸ“\x20Created\x20logs\x20directory:\x20'+this[_0x26237e(0x16f)]));}[a79_0x2ecaa3(0x134)](_0x2883d0){const _0x265066=a79_0x2ecaa3,_0x307a26=new Date()[_0x265066(0x147)]()[_0x265066(0x130)]('T')[0x0];return path_1[_0x265066(0x15a)][_0x265066(0x16d)](this[_0x265066(0x16f)],_0x2883d0+'_'+_0x307a26+'.log');}['writeLog'](_0x1c14f0,_0x3b99f9){const _0x1c0324=a79_0x2ecaa3;try{const _0x2abef3=new Date()['toISOString'](),_0x5e11cd={'timestamp':_0x2abef3,..._0x3b99f9},_0x1e8327=JSON[_0x1c0324(0x13c)](_0x5e11cd)+'\x0a',_0x24bd9b=this['getLogFileName'](_0x1c14f0);fs_1['default'][_0x1c0324(0x14a)](_0x24bd9b,_0x1e8327,'utf8');}catch(_0xd81fe6){console[_0x1c0324(0x149)](_0x1c0324(0x168)+_0x1c14f0+'\x20log:',_0xd81fe6);}}['logWhiteDomainRequest'](_0x437e78,_0x3f8050,_0x1b21f0,_0x46c97e){const _0x39323f=a79_0x2ecaa3;this[_0x39323f(0x142)]('white_domain_requests',{'type':_0x39323f(0x13d),'gateway':_0x437e78,'endpoint':_0x3f8050,'method':_0x1b21f0,'data':_0x46c97e});}[a79_0x2ecaa3(0x176)](_0x57abab,_0x516165,_0x5f0002,_0x4fd6a7,_0x1c81d9){const _0x36bcaf=a79_0x2ecaa3;this['writeLog'](_0x36bcaf(0x14b),{'type':'RESPONSE','gateway':_0x57abab,'endpoint':_0x516165,'status':_0x5f0002,'responseTime':_0x1c81d9,'data':_0x4fd6a7});}[a79_0x2ecaa3(0x133)](_0x3a8fba,_0x4dc00a,_0x4ad717){const _0x51481c=a79_0x2ecaa3;this[_0x51481c(0x142)]('white_domain_errors',{'type':_0x51481c(0x12f),'gateway':_0x3a8fba,'endpoint':_0x4dc00a,'error':_0x4ad717 instanceof Error?{'message':_0x4ad717['message'],'stack':_0x4ad717[_0x51481c(0x151)]}:_0x4ad717});}[a79_0x2ecaa3(0x154)](_0x40578c,_0x28924d,_0x461a23){const _0x1b810d=a79_0x2ecaa3;this['writeLog']('webhooks_received',{'type':_0x1b810d(0x167),'gateway':_0x40578c,'headers':_0x461a23,'data':_0x28924d});}[a79_0x2ecaa3(0x13b)](_0x5173ab,_0x497c80,_0x135bb9,_0x210fa1,_0x1f7cc1){const _0x350ba9=a79_0x2ecaa3;this['writeLog'](_0x350ba9(0x160),{'type':_0x350ba9(0x153),'gateway':_0x5173ab,'paymentId':_0x497c80,'oldStatus':_0x135bb9,'newStatus':_0x210fa1,'originalData':_0x1f7cc1});}['logWebhookError'](_0x32b931,_0x2ee111,_0x1c7d0e){const _0x501542=a79_0x2ecaa3;this[_0x501542(0x142)](_0x501542(0x143),{'type':_0x501542(0x144),'gateway':_0x32b931,'error':_0x2ee111 instanceof Error?{'message':_0x2ee111[_0x501542(0x141)],'stack':_0x2ee111['stack']}:_0x2ee111,'originalData':_0x1c7d0e});}[a79_0x2ecaa3(0x14d)](_0x4f0c7f){const _0x422f45=a79_0x2ecaa3;this[_0x422f45(0x142)](_0x422f45(0x157),{'type':'COINTOPAY_STATUS_CHANGE',..._0x4f0c7f});}[a79_0x2ecaa3(0x156)](_0x407e3a){const _0x4fc680=a79_0x2ecaa3;this['writeLog'](_0x4fc680(0x13a),{'type':_0x4fc680(0x16b),..._0x407e3a});}[a79_0x2ecaa3(0x136)](_0x24fcb2,_0x363c66,_0xeaaaf0,_0x325375,_0x1eefe3,_0x3762f3){const _0x3f9581=a79_0x2ecaa3;this[_0x3f9581(0x142)]('shop_webhooks_sent',{'type':_0x3f9581(0x131),'shopId':_0x24fcb2,'webhookUrl':_0x363c66,'event':_0xeaaaf0,'status':_0x325375,'responseTime':_0x1eefe3,'payload':_0x3762f3});}[a79_0x2ecaa3(0x174)](_0x170ce3,_0x31bdb4,_0x502b67,_0x4b01da,_0x4a99a3){const _0x3cab14=a79_0x2ecaa3;this[_0x3cab14(0x142)](_0x3cab14(0x15b),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x170ce3,'webhookUrl':_0x31bdb4,'event':_0x502b67,'error':_0x4b01da instanceof Error?{'message':_0x4b01da['message'],'stack':_0x4b01da[_0x3cab14(0x151)]}:_0x4b01da,'payload':_0x4a99a3});}['logPaymentCreated'](_0x197a82,_0x23ad81,_0x226d25,_0x4a336d,_0x5b4f1e){const _0x522e23=a79_0x2ecaa3;this[_0x522e23(0x142)](_0x522e23(0x152),{'type':_0x522e23(0x12e),'gateway':_0x197a82,'paymentId':_0x23ad81,'shopId':_0x226d25,'amount':_0x4a336d,'currency':_0x5b4f1e});}[a79_0x2ecaa3(0x177)](_0x5c517c,_0x218f6c,_0x3635c6,_0x51de48,_0x1d8496){const _0x5b3521=a79_0x2ecaa3;this['writeLog'](_0x5b3521(0x172),{'type':_0x5b3521(0x132),'endpoint':_0x5c517c,'method':_0x218f6c,'userId':_0x3635c6,'userRole':_0x51de48,'requestData':_0x1d8496});}['getLogStats'](){const _0x25b0de=a79_0x2ecaa3;try{const _0x317280=fs_1['default'][_0x25b0de(0x138)](this[_0x25b0de(0x16f)]),_0xab32b4=_0x317280[_0x25b0de(0x15f)](_0x2c5112=>_0x2c5112[_0x25b0de(0x15d)]('.log')),_0x3da4c1=[...new Set(_0xab32b4[_0x25b0de(0x150)](_0x3ec55c=>_0x3ec55c['split']('_')[0x0]))],_0x58cbaf=_0xab32b4[_0x25b0de(0x150)](_0x48fb6f=>{const _0x2f0588=_0x25b0de,_0x38f324=path_1[_0x2f0588(0x15a)][_0x2f0588(0x16d)](this['logsDir'],_0x48fb6f),_0x15c0b9=fs_1['default'][_0x2f0588(0x161)](_0x38f324),[_0x27b60e,_0x359bf1]=_0x48fb6f[_0x2f0588(0x159)](_0x2f0588(0x12d),'')['split']('_');return{'type':_0x27b60e,'date':_0x359bf1,'size':_0x15c0b9['size']};})[_0x25b0de(0x169)]((_0x39a38e,_0x10bbae)=>_0x10bbae[_0x25b0de(0x145)][_0x25b0de(0x14e)](_0x39a38e['date']));return{'totalFiles':_0xab32b4[_0x25b0de(0x12b)],'logTypes':_0x3da4c1,'latestLogs':_0x58cbaf[_0x25b0de(0x14c)](0x0,0xa)};}catch(_0x486f94){return console[_0x25b0de(0x149)](_0x25b0de(0x13e),_0x486f94),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x184d2a=0x1e){const _0x5cc2d8=a79_0x2ecaa3;try{const _0x3ee39f=fs_1[_0x5cc2d8(0x15a)][_0x5cc2d8(0x138)](this[_0x5cc2d8(0x16f)]),_0x2582c7=new Date();_0x2582c7['setDate'](_0x2582c7['getDate']()-_0x184d2a);let _0x58579c=0x0;_0x3ee39f[_0x5cc2d8(0x129)](_0x99bc8d=>{const _0x209246=_0x5cc2d8;if(!_0x99bc8d[_0x209246(0x15d)](_0x209246(0x12d)))return;const _0x452912=path_1[_0x209246(0x15a)][_0x209246(0x16d)](this[_0x209246(0x16f)],_0x99bc8d),_0x4e9201=fs_1['default'][_0x209246(0x161)](_0x452912);_0x4e9201['mtime']<_0x2582c7&&(fs_1[_0x209246(0x15a)][_0x209246(0x16a)](_0x452912),_0x58579c++,console[_0x209246(0x164)](_0x209246(0x146)+_0x99bc8d));}),console[_0x5cc2d8(0x164)](_0x5cc2d8(0x155)+_0x58579c+_0x5cc2d8(0x15e)+_0x184d2a+_0x5cc2d8(0x16e));}catch(_0xfacd71){console['error'](_0x5cc2d8(0x148),_0xfacd71);}}}exports[a79_0x2ecaa3(0x12a)]=LoggerService,exports[a79_0x2ecaa3(0x165)]=new LoggerService();