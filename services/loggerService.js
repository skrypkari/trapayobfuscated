'use strict';const a71_0x3754cd=a71_0xa54a;(function(_0x4881cb,_0x5cd0be){const _0x4854da=a71_0xa54a,_0x16c3d3=_0x4881cb();while(!![]){try{const _0x3c1424=-parseInt(_0x4854da(0x13f))/0x1+parseInt(_0x4854da(0x154))/0x2+-parseInt(_0x4854da(0x101))/0x3*(-parseInt(_0x4854da(0x121))/0x4)+parseInt(_0x4854da(0x150))/0x5*(parseInt(_0x4854da(0x11a))/0x6)+parseInt(_0x4854da(0x14e))/0x7*(parseInt(_0x4854da(0x151))/0x8)+parseInt(_0x4854da(0x11c))/0x9*(parseInt(_0x4854da(0x156))/0xa)+-parseInt(_0x4854da(0x120))/0xb;if(_0x3c1424===_0x5cd0be)break;else _0x16c3d3['push'](_0x16c3d3['shift']());}catch(_0xdc0ada){_0x16c3d3['push'](_0x16c3d3['shift']());}}}(a71_0x26f2,0xd1321));var __importDefault=this&&this[a71_0x3754cd(0x147)]||function(_0x3c7ef6){const _0x1a389d=a71_0x3754cd;return _0x3c7ef6&&_0x3c7ef6[_0x1a389d(0x13b)]?_0x3c7ef6:{'default':_0x3c7ef6};};Object[a71_0x3754cd(0x103)](exports,a71_0x3754cd(0x13b),{'value':!![]}),exports[a71_0x3754cd(0x114)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a71_0x3754cd(0x127)));function a71_0x26f2(){const _0x16ef80=['getDate','LoggerService','Failed\x20to\x20write\x20','__importDefault','logWhiteDomainRequest','API_CALL','ensureLogsDirectory','readdirSync','map','shop_webhooks_errors','21yFLPie','existsSync','85qYCfWe','4542872GvzIxH','split','utf8','1121292LVBXNb','logCoinToPayStatus','4270fjkEBS','getLogFileName','replace','WEBHOOK_RECEIVED','filter','SHOP_WEBHOOK_SENT','44034HOzkhP','shop_webhooks_sent','defineProperty','SHOP_WEBHOOK_ERROR','api_calls','slice','size','join','logShopWebhookError','logPaymentCreated','endsWith','cointopay_errors','COINTOPAY_STATUS_CHANGE','default','webhooks_processed','logsDir','logCoinToPayError','length','logWhiteDomainResponse','loggerService','localeCompare','cwd','COINTOPAY_ERROR','logShopWebhookSent','REQUEST','479352OmawGv','getLogStats','32517lpHyYv','logWebhookReceived','forEach','mkdirSync','57534994jYyWyV','432SVzMak','white_domain_responses','message','Failed\x20to\x20get\x20log\x20stats:','WEBHOOK_ERROR','unlinkSync','path','PAYMENT_CREATED','ðŸ§¹\x20Cleaned\x20','.log','appendFileSync','\x20old\x20log\x20files\x20(older\x20than\x20','\x20log:','error','toISOString','webhooks_errors','logWebhookError','sort','ERROR','writeLog','white_domain_requests','setDate','logWebhookProcessed','stringify','WEBHOOK_PROCESSED','\x20days)','__esModule','date','stack','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','663043xOYLDc','white_domain_errors','logs','cointopay_status_changes','log'];a71_0x26f2=function(){return _0x16ef80;};return a71_0x26f2();}function a71_0xa54a(_0x24650c,_0x534b04){_0x24650c=_0x24650c-0xff;const _0x26f28b=a71_0x26f2();let _0xa54a7e=_0x26f28b[_0x24650c];return _0xa54a7e;}class LoggerService{constructor(){const _0x41d7a5=a71_0x3754cd;this[_0x41d7a5(0x110)]=path_1[_0x41d7a5(0x10e)][_0x41d7a5(0x108)](process[_0x41d7a5(0x116)](),_0x41d7a5(0x141)),this[_0x41d7a5(0x14a)]();}['ensureLogsDirectory'](){const _0x4f8364=a71_0x3754cd;!fs_1['default'][_0x4f8364(0x14f)](this['logsDir'])&&(fs_1['default'][_0x4f8364(0x11f)](this[_0x4f8364(0x110)],{'recursive':!![]}),console[_0x4f8364(0x143)]('ðŸ“\x20Created\x20logs\x20directory:\x20'+this[_0x4f8364(0x110)]));}['getLogFileName'](_0x114d5b){const _0x210f80=a71_0x3754cd,_0x5a6746=new Date()[_0x210f80(0x12f)]()['split']('T')[0x0];return path_1[_0x210f80(0x10e)]['join'](this['logsDir'],_0x114d5b+'_'+_0x5a6746+_0x210f80(0x12a));}['writeLog'](_0x3aba90,_0x34d8d7){const _0x104aea=a71_0x3754cd;try{const _0x376513=new Date()[_0x104aea(0x12f)](),_0x20c6f1={'timestamp':_0x376513,..._0x34d8d7},_0x3fd9c1=JSON[_0x104aea(0x138)](_0x20c6f1)+'\x0a',_0x5f29ab=this[_0x104aea(0x157)](_0x3aba90);fs_1[_0x104aea(0x10e)][_0x104aea(0x12b)](_0x5f29ab,_0x3fd9c1,_0x104aea(0x153));}catch(_0x3c3f9d){console[_0x104aea(0x12e)](_0x104aea(0x146)+_0x3aba90+_0x104aea(0x12d),_0x3c3f9d);}}[a71_0x3754cd(0x148)](_0x558d21,_0x1c4b7c,_0x53c288,_0x50773e){const _0x13707f=a71_0x3754cd;this[_0x13707f(0x134)](_0x13707f(0x135),{'type':_0x13707f(0x119),'gateway':_0x558d21,'endpoint':_0x1c4b7c,'method':_0x53c288,'data':_0x50773e});}[a71_0x3754cd(0x113)](_0x27cd0f,_0x6f78e9,_0x5ef800,_0x6de63,_0x35f1d7){const _0x1f9e0c=a71_0x3754cd;this[_0x1f9e0c(0x134)](_0x1f9e0c(0x122),{'type':'RESPONSE','gateway':_0x27cd0f,'endpoint':_0x6f78e9,'status':_0x5ef800,'responseTime':_0x35f1d7,'data':_0x6de63});}['logWhiteDomainError'](_0x32a8e5,_0x582f89,_0x5473a1){const _0x16fdd0=a71_0x3754cd;this[_0x16fdd0(0x134)](_0x16fdd0(0x140),{'type':_0x16fdd0(0x133),'gateway':_0x32a8e5,'endpoint':_0x582f89,'error':_0x5473a1 instanceof Error?{'message':_0x5473a1['message'],'stack':_0x5473a1['stack']}:_0x5473a1});}[a71_0x3754cd(0x11d)](_0x3e2107,_0x2260a4,_0x3199ba){const _0x31ab89=a71_0x3754cd;this[_0x31ab89(0x134)]('webhooks_received',{'type':_0x31ab89(0x159),'gateway':_0x3e2107,'headers':_0x3199ba,'data':_0x2260a4});}[a71_0x3754cd(0x137)](_0x4429f9,_0x28ed33,_0x6f0e3e,_0x29abaf,_0x1f50ef){const _0x56c3d2=a71_0x3754cd;this[_0x56c3d2(0x134)](_0x56c3d2(0x10f),{'type':_0x56c3d2(0x139),'gateway':_0x4429f9,'paymentId':_0x28ed33,'oldStatus':_0x6f0e3e,'newStatus':_0x29abaf,'originalData':_0x1f50ef});}[a71_0x3754cd(0x131)](_0x228bc3,_0x34ce2d,_0x271a2f){const _0x4073e0=a71_0x3754cd;this[_0x4073e0(0x134)](_0x4073e0(0x130),{'type':_0x4073e0(0x125),'gateway':_0x228bc3,'error':_0x34ce2d instanceof Error?{'message':_0x34ce2d[_0x4073e0(0x123)],'stack':_0x34ce2d[_0x4073e0(0x13d)]}:_0x34ce2d,'originalData':_0x271a2f});}[a71_0x3754cd(0x155)](_0x3b1b6e){const _0x3fdc58=a71_0x3754cd;this[_0x3fdc58(0x134)](_0x3fdc58(0x142),{'type':_0x3fdc58(0x10d),..._0x3b1b6e});}[a71_0x3754cd(0x111)](_0x35e2f0){const _0x3a9026=a71_0x3754cd;this['writeLog'](_0x3a9026(0x10c),{'type':_0x3a9026(0x117),..._0x35e2f0});}[a71_0x3754cd(0x118)](_0x17de05,_0x581f47,_0x5b35dd,_0x4f4126,_0x5c6b5b,_0x52a0ea){const _0x5598b0=a71_0x3754cd;this['writeLog'](_0x5598b0(0x102),{'type':_0x5598b0(0x100),'shopId':_0x17de05,'webhookUrl':_0x581f47,'event':_0x5b35dd,'status':_0x4f4126,'responseTime':_0x5c6b5b,'payload':_0x52a0ea});}[a71_0x3754cd(0x109)](_0x598718,_0xbfdf0b,_0x5089ef,_0x55fbbd,_0x43af91){const _0xec7308=a71_0x3754cd;this['writeLog'](_0xec7308(0x14d),{'type':_0xec7308(0x104),'shopId':_0x598718,'webhookUrl':_0xbfdf0b,'event':_0x5089ef,'error':_0x55fbbd instanceof Error?{'message':_0x55fbbd[_0xec7308(0x123)],'stack':_0x55fbbd[_0xec7308(0x13d)]}:_0x55fbbd,'payload':_0x43af91});}[a71_0x3754cd(0x10a)](_0x18b9bd,_0x58f08f,_0x1e0726,_0x34dde9,_0x44dc07){const _0x462f13=a71_0x3754cd;this[_0x462f13(0x134)]('payments_created',{'type':_0x462f13(0x128),'gateway':_0x18b9bd,'paymentId':_0x58f08f,'shopId':_0x1e0726,'amount':_0x34dde9,'currency':_0x44dc07});}['logApiCall'](_0x87e879,_0x2078de,_0x2676db,_0x9ef94a,_0x61e92e){const _0xee5819=a71_0x3754cd;this[_0xee5819(0x134)](_0xee5819(0x105),{'type':_0xee5819(0x149),'endpoint':_0x87e879,'method':_0x2078de,'userId':_0x2676db,'userRole':_0x9ef94a,'requestData':_0x61e92e});}[a71_0x3754cd(0x11b)](){const _0x539345=a71_0x3754cd;try{const _0x3e6638=fs_1['default'][_0x539345(0x14b)](this['logsDir']),_0x248424=_0x3e6638[_0x539345(0xff)](_0x3058c6=>_0x3058c6[_0x539345(0x10b)](_0x539345(0x12a))),_0xb71eea=[...new Set(_0x248424['map'](_0x1b00f2=>_0x1b00f2[_0x539345(0x152)]('_')[0x0]))],_0x440353=_0x248424[_0x539345(0x14c)](_0x1df0c3=>{const _0x3784c8=_0x539345,_0x2800fa=path_1['default']['join'](this[_0x3784c8(0x110)],_0x1df0c3),_0x1dfcd0=fs_1[_0x3784c8(0x10e)]['statSync'](_0x2800fa),[_0x5f170d,_0x489bfc]=_0x1df0c3[_0x3784c8(0x158)](_0x3784c8(0x12a),'')[_0x3784c8(0x152)]('_');return{'type':_0x5f170d,'date':_0x489bfc,'size':_0x1dfcd0[_0x3784c8(0x107)]};})[_0x539345(0x132)]((_0x5d3116,_0x5994d1)=>_0x5994d1[_0x539345(0x13c)][_0x539345(0x115)](_0x5d3116['date']));return{'totalFiles':_0x248424[_0x539345(0x112)],'logTypes':_0xb71eea,'latestLogs':_0x440353[_0x539345(0x106)](0x0,0xa)};}catch(_0x74b3bf){return console[_0x539345(0x12e)](_0x539345(0x124),_0x74b3bf),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x29f6b3=0x1e){const _0x454140=a71_0x3754cd;try{const _0x22d93f=fs_1[_0x454140(0x10e)]['readdirSync'](this[_0x454140(0x110)]),_0x48b0cb=new Date();_0x48b0cb[_0x454140(0x136)](_0x48b0cb[_0x454140(0x144)]()-_0x29f6b3);let _0x438941=0x0;_0x22d93f[_0x454140(0x11e)](_0x47f489=>{const _0x34c1f0=_0x454140;if(!_0x47f489['endsWith'](_0x34c1f0(0x12a)))return;const _0x21a1bd=path_1[_0x34c1f0(0x10e)]['join'](this[_0x34c1f0(0x110)],_0x47f489),_0x1340c0=fs_1[_0x34c1f0(0x10e)]['statSync'](_0x21a1bd);_0x1340c0['mtime']<_0x48b0cb&&(fs_1[_0x34c1f0(0x10e)][_0x34c1f0(0x126)](_0x21a1bd),_0x438941++,console[_0x34c1f0(0x143)](_0x34c1f0(0x13e)+_0x47f489));}),console['log'](_0x454140(0x129)+_0x438941+_0x454140(0x12c)+_0x29f6b3+_0x454140(0x13a));}catch(_0x828e78){console[_0x454140(0x12e)]('Failed\x20to\x20clean\x20old\x20logs:',_0x828e78);}}}exports[a71_0x3754cd(0x145)]=LoggerService,exports['loggerService']=new LoggerService();