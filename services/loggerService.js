'use strict';const a49_0x1d30e6=a49_0x5ecb;(function(_0x40c5f2,_0x2c0204){const _0x1af852=a49_0x5ecb,_0x225f2a=_0x40c5f2();while(!![]){try{const _0xbf6b6a=parseInt(_0x1af852(0x13f))/0x1*(-parseInt(_0x1af852(0x108))/0x2)+-parseInt(_0x1af852(0x14a))/0x3*(-parseInt(_0x1af852(0x13c))/0x4)+-parseInt(_0x1af852(0x114))/0x5*(parseInt(_0x1af852(0x13b))/0x6)+-parseInt(_0x1af852(0x106))/0x7+-parseInt(_0x1af852(0x123))/0x8*(-parseInt(_0x1af852(0x126))/0x9)+parseInt(_0x1af852(0x10e))/0xa+parseInt(_0x1af852(0x119))/0xb;if(_0xbf6b6a===_0x2c0204)break;else _0x225f2a['push'](_0x225f2a['shift']());}catch(_0x2a0500){_0x225f2a['push'](_0x225f2a['shift']());}}}(a49_0x49e8,0x648e4));function a49_0x5ecb(_0x2071e0,_0x22ea38){const _0x49e8c1=a49_0x49e8();return a49_0x5ecb=function(_0x5ecbf9,_0x477e8a){_0x5ecbf9=_0x5ecbf9-0x103;let _0x4bf572=_0x49e8c1[_0x5ecbf9];return _0x4bf572;},a49_0x5ecb(_0x2071e0,_0x22ea38);}function a49_0x49e8(){const _0x666aa0=['existsSync','1909271gsXGkb','size','2Crljrn','mtime','\x20days)','white_domain_responses','logs','WEBHOOK_PROCESSED','516930guIqMx','setDate','logWhiteDomainRequest','statSync','shop_webhooks_errors','replace','70XaEzyu','cwd','RESPONSE','payments_created','log','6306454AfotSm','logCoinToPayStatus','COINTOPAY_ERROR','sort','join','message','shop_webhooks_sent','forEach','logsDir','Failed\x20to\x20clean\x20old\x20logs:','599928tYLVCl','PAYMENT_CREATED','toISOString','90CoLgDv','🧹\x20Cleaned\x20','.log','getLogStats','__importDefault','ensureLogsDirectory','logWebhookError','SHOP_WEBHOOK_ERROR','loggerService','logShopWebhookSent','white_domain_errors','logWebhookReceived','error','Failed\x20to\x20get\x20log\x20stats:','logPaymentCreated','logWhiteDomainError','endsWith','length','Failed\x20to\x20write\x20','date','writeLog','332124RSlRHW','2005804QsUtBq','map','default','416783vjjKEV','SHOP_WEBHOOK_SENT','split','stack','getDate','logShopWebhookError','WEBHOOK_RECEIVED','__esModule','\x20log:','API_CALL','unlinkSync','3EJKDZV','getLogFileName','localeCompare','cointopay_status_changes','cleanOldLogs','LoggerService','cointopay_errors','webhooks_processed'];a49_0x49e8=function(){return _0x666aa0;};return a49_0x49e8();}var __importDefault=this&&this[a49_0x1d30e6(0x12a)]||function(_0x445779){const _0x2d1958=a49_0x1d30e6;return _0x445779&&_0x445779[_0x2d1958(0x146)]?_0x445779:{'default':_0x445779};};Object['defineProperty'](exports,a49_0x1d30e6(0x146),{'value':!![]}),exports[a49_0x1d30e6(0x12e)]=exports[a49_0x1d30e6(0x14f)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x559cc9=a49_0x1d30e6;this[_0x559cc9(0x121)]=path_1[_0x559cc9(0x13e)][_0x559cc9(0x11d)](process[_0x559cc9(0x115)](),_0x559cc9(0x10c)),this['ensureLogsDirectory']();}[a49_0x1d30e6(0x12b)](){const _0x3b1be1=a49_0x1d30e6;!fs_1['default'][_0x3b1be1(0x105)](this[_0x3b1be1(0x121)])&&(fs_1[_0x3b1be1(0x13e)]['mkdirSync'](this[_0x3b1be1(0x121)],{'recursive':!![]}),console[_0x3b1be1(0x118)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x3b1be1(0x121)]));}[a49_0x1d30e6(0x14b)](_0xc46728){const _0x39415d=a49_0x1d30e6,_0x3ba66c=new Date()[_0x39415d(0x125)]()[_0x39415d(0x141)]('T')[0x0];return path_1['default'][_0x39415d(0x11d)](this[_0x39415d(0x121)],_0xc46728+'_'+_0x3ba66c+_0x39415d(0x128));}['writeLog'](_0x19660a,_0x2ca481){const _0x11ceae=a49_0x1d30e6;try{const _0x443135=new Date()[_0x11ceae(0x125)](),_0x468939={'timestamp':_0x443135,..._0x2ca481},_0x4a1766=JSON['stringify'](_0x468939)+'\x0a',_0x19224b=this[_0x11ceae(0x14b)](_0x19660a);fs_1[_0x11ceae(0x13e)]['appendFileSync'](_0x19224b,_0x4a1766,'utf8');}catch(_0x307486){console[_0x11ceae(0x132)](_0x11ceae(0x138)+_0x19660a+_0x11ceae(0x147),_0x307486);}}[a49_0x1d30e6(0x110)](_0x4adfd7,_0x18b015,_0xa5a7a2,_0x54d0c5){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0x4adfd7,'endpoint':_0x18b015,'method':_0xa5a7a2,'data':_0x54d0c5});}['logWhiteDomainResponse'](_0x221405,_0x2b7e3a,_0x20e684,_0x1b6067,_0x5d50e6){const _0x3529d2=a49_0x1d30e6;this[_0x3529d2(0x13a)](_0x3529d2(0x10b),{'type':_0x3529d2(0x116),'gateway':_0x221405,'endpoint':_0x2b7e3a,'status':_0x20e684,'responseTime':_0x5d50e6,'data':_0x1b6067});}[a49_0x1d30e6(0x135)](_0x34e13e,_0x490db3,_0xc1bc58){const _0x4f5744=a49_0x1d30e6;this[_0x4f5744(0x13a)](_0x4f5744(0x130),{'type':'ERROR','gateway':_0x34e13e,'endpoint':_0x490db3,'error':_0xc1bc58 instanceof Error?{'message':_0xc1bc58[_0x4f5744(0x11e)],'stack':_0xc1bc58[_0x4f5744(0x142)]}:_0xc1bc58});}[a49_0x1d30e6(0x131)](_0x4d8f09,_0xe53972,_0x21b3cc){const _0x79fa7a=a49_0x1d30e6;this[_0x79fa7a(0x13a)]('webhooks_received',{'type':_0x79fa7a(0x145),'gateway':_0x4d8f09,'headers':_0x21b3cc,'data':_0xe53972});}['logWebhookProcessed'](_0x48e490,_0x41e297,_0x133533,_0x261136,_0x1c2870){const _0x376871=a49_0x1d30e6;this[_0x376871(0x13a)](_0x376871(0x104),{'type':_0x376871(0x10d),'gateway':_0x48e490,'paymentId':_0x41e297,'oldStatus':_0x133533,'newStatus':_0x261136,'originalData':_0x1c2870});}[a49_0x1d30e6(0x12c)](_0x54a6ca,_0x6a45b0,_0x1610a9){const _0x531b30=a49_0x1d30e6;this[_0x531b30(0x13a)]('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x54a6ca,'error':_0x6a45b0 instanceof Error?{'message':_0x6a45b0[_0x531b30(0x11e)],'stack':_0x6a45b0['stack']}:_0x6a45b0,'originalData':_0x1610a9});}[a49_0x1d30e6(0x11a)](_0xbb7182){const _0x1d0afd=a49_0x1d30e6;this[_0x1d0afd(0x13a)](_0x1d0afd(0x14d),{'type':'COINTOPAY_STATUS_CHANGE',..._0xbb7182});}['logCoinToPayError'](_0x148e39){const _0x37ed3e=a49_0x1d30e6;this[_0x37ed3e(0x13a)](_0x37ed3e(0x103),{'type':_0x37ed3e(0x11b),..._0x148e39});}[a49_0x1d30e6(0x12f)](_0x4fc200,_0x2d4117,_0xdd56ca,_0x4fac3e,_0x497adf,_0x2727ef){const _0x1a2bb5=a49_0x1d30e6;this[_0x1a2bb5(0x13a)](_0x1a2bb5(0x11f),{'type':_0x1a2bb5(0x140),'shopId':_0x4fc200,'webhookUrl':_0x2d4117,'event':_0xdd56ca,'status':_0x4fac3e,'responseTime':_0x497adf,'payload':_0x2727ef});}[a49_0x1d30e6(0x144)](_0x44d6c8,_0x2841c2,_0x1a7d61,_0xf2142,_0x4d3516){const _0x402e00=a49_0x1d30e6;this['writeLog'](_0x402e00(0x112),{'type':_0x402e00(0x12d),'shopId':_0x44d6c8,'webhookUrl':_0x2841c2,'event':_0x1a7d61,'error':_0xf2142 instanceof Error?{'message':_0xf2142[_0x402e00(0x11e)],'stack':_0xf2142[_0x402e00(0x142)]}:_0xf2142,'payload':_0x4d3516});}[a49_0x1d30e6(0x134)](_0x43c59c,_0x30f0d7,_0x1900ea,_0x4d8045,_0x6ad809){const _0x5e73ca=a49_0x1d30e6;this['writeLog'](_0x5e73ca(0x117),{'type':_0x5e73ca(0x124),'gateway':_0x43c59c,'paymentId':_0x30f0d7,'shopId':_0x1900ea,'amount':_0x4d8045,'currency':_0x6ad809});}['logApiCall'](_0x598450,_0x476f18,_0x56ad00,_0x48d8df,_0x41cbad){const _0x39e185=a49_0x1d30e6;this[_0x39e185(0x13a)]('api_calls',{'type':_0x39e185(0x148),'endpoint':_0x598450,'method':_0x476f18,'userId':_0x56ad00,'userRole':_0x48d8df,'requestData':_0x41cbad});}[a49_0x1d30e6(0x129)](){const _0x15430c=a49_0x1d30e6;try{const _0x360be3=fs_1['default']['readdirSync'](this[_0x15430c(0x121)]),_0x129065=_0x360be3['filter'](_0x5138f0=>_0x5138f0[_0x15430c(0x136)](_0x15430c(0x128))),_0x5d362b=[...new Set(_0x129065[_0x15430c(0x13d)](_0x216cb8=>_0x216cb8[_0x15430c(0x141)]('_')[0x0]))],_0x327aea=_0x129065['map'](_0x54e67c=>{const _0x34959a=_0x15430c,_0x59c3af=path_1[_0x34959a(0x13e)][_0x34959a(0x11d)](this[_0x34959a(0x121)],_0x54e67c),_0x159aca=fs_1[_0x34959a(0x13e)][_0x34959a(0x111)](_0x59c3af),[_0x48a51d,_0x2ccb94]=_0x54e67c[_0x34959a(0x113)]('.log','')[_0x34959a(0x141)]('_');return{'type':_0x48a51d,'date':_0x2ccb94,'size':_0x159aca[_0x34959a(0x107)]};})[_0x15430c(0x11c)]((_0x5122b4,_0x5cda33)=>_0x5cda33[_0x15430c(0x139)][_0x15430c(0x14c)](_0x5122b4['date']));return{'totalFiles':_0x129065[_0x15430c(0x137)],'logTypes':_0x5d362b,'latestLogs':_0x327aea['slice'](0x0,0xa)};}catch(_0x2fb328){return console['error'](_0x15430c(0x133),_0x2fb328),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x1d30e6(0x14e)](_0x5ada77=0x1e){const _0x46e11d=a49_0x1d30e6;try{const _0x37a9a2=fs_1[_0x46e11d(0x13e)]['readdirSync'](this[_0x46e11d(0x121)]),_0x704e1d=new Date();_0x704e1d[_0x46e11d(0x10f)](_0x704e1d[_0x46e11d(0x143)]()-_0x5ada77);let _0x569be5=0x0;_0x37a9a2[_0x46e11d(0x120)](_0x19c5c3=>{const _0x17dc63=_0x46e11d;if(!_0x19c5c3[_0x17dc63(0x136)]('.log'))return;const _0x2960a5=path_1['default']['join'](this[_0x17dc63(0x121)],_0x19c5c3),_0x3aeda2=fs_1[_0x17dc63(0x13e)]['statSync'](_0x2960a5);_0x3aeda2[_0x17dc63(0x109)]<_0x704e1d&&(fs_1[_0x17dc63(0x13e)][_0x17dc63(0x149)](_0x2960a5),_0x569be5++,console[_0x17dc63(0x118)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x19c5c3));}),console[_0x46e11d(0x118)](_0x46e11d(0x127)+_0x569be5+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x5ada77+_0x46e11d(0x10a));}catch(_0x372c3c){console['error'](_0x46e11d(0x122),_0x372c3c);}}}exports[a49_0x1d30e6(0x14f)]=LoggerService,exports[a49_0x1d30e6(0x12e)]=new LoggerService();