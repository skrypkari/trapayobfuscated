'use strict';function a79_0x58e4(){const _0x5ba0ae=['log','ðŸ“\x20Created\x20logs\x20directory:\x20','__esModule','setDate','message','white_domain_errors','getLogFileName','1928064rDpmwh','unlinkSync','stack','logsDir','Failed\x20to\x20clean\x20old\x20logs:','795830bufAvZ','logWebhookProcessed','date','localeCompare','REQUEST','PAYMENT_CREATED','20914gChfli','API_CALL','logWebhookReceived','statSync','logWhiteDomainResponse','loggerService','2670UZDkiY','logWhiteDomainRequest','mtime','__importDefault','1624266whfHhH','split','map','ensureLogsDirectory','utf8','forEach','length','LoggerService','SHOP_WEBHOOK_SENT','defineProperty','logApiCall','error','cointopay_status_changes','join','slice','73733xeSLJb','webhooks_errors','payments_created','WEBHOOK_RECEIVED','1265469YSvoIu','webhooks_received','logs','ðŸ§¹\x20Cleaned\x20','white_domain_requests','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','white_domain_responses','logWebhookError','\x20log:','path','writeLog','13tbeAxU','shop_webhooks_errors','.log','getLogStats','24ODlUWY','logShopWebhookError','cointopay_errors','WEBHOOK_PROCESSED','COINTOPAY_STATUS_CHANGE','endsWith','readdirSync','api_calls','4iLvYud','\x20old\x20log\x20files\x20(older\x20than\x20','toISOString','1952490xqHoLD','COINTOPAY_ERROR','default'];a79_0x58e4=function(){return _0x5ba0ae;};return a79_0x58e4();}const a79_0x4b0375=a79_0x4a12;(function(_0x535537,_0x234295){const _0x8ca54c=a79_0x4a12,_0x17e671=_0x535537();while(!![]){try{const _0x522001=parseInt(_0x8ca54c(0x11c))/0x1*(parseInt(_0x8ca54c(0xf4))/0x2)+-parseInt(_0x8ca54c(0x111))/0x3*(parseInt(_0x8ca54c(0x128))/0x4)+-parseInt(_0x8ca54c(0x12b))/0x5+parseInt(_0x8ca54c(0x120))/0x6*(-parseInt(_0x8ca54c(0xee))/0x7)+-parseInt(_0x8ca54c(0xe9))/0x8+-parseInt(_0x8ca54c(0xfe))/0x9+-parseInt(_0x8ca54c(0xfa))/0xa*(-parseInt(_0x8ca54c(0x10d))/0xb);if(_0x522001===_0x234295)break;else _0x17e671['push'](_0x17e671['shift']());}catch(_0x409804){_0x17e671['push'](_0x17e671['shift']());}}}(a79_0x58e4,0x39e17));var __importDefault=this&&this[a79_0x4b0375(0xfd)]||function(_0x5adb0d){const _0x48016a=a79_0x4b0375;return _0x5adb0d&&_0x5adb0d[_0x48016a(0x130)]?_0x5adb0d:{'default':_0x5adb0d};};Object[a79_0x4b0375(0x107)](exports,a79_0x4b0375(0x130),{'value':!![]}),exports[a79_0x4b0375(0xf9)]=exports[a79_0x4b0375(0x105)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x4b0375(0x11a)));function a79_0x4a12(_0x5d9384,_0x2f1fcb){_0x5d9384=_0x5d9384-0xe6;const _0x58e409=a79_0x58e4();let _0x4a1274=_0x58e409[_0x5d9384];return _0x4a1274;}class LoggerService{constructor(){const _0x13a364=a79_0x4b0375;this[_0x13a364(0xec)]=path_1['default']['join'](process['cwd'](),_0x13a364(0x113)),this[_0x13a364(0x101)]();}['ensureLogsDirectory'](){const _0x1a5a6b=a79_0x4b0375;!fs_1['default']['existsSync'](this[_0x1a5a6b(0xec)])&&(fs_1[_0x1a5a6b(0x12d)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x1a5a6b(0x12e)](_0x1a5a6b(0x12f)+this[_0x1a5a6b(0xec)]));}[a79_0x4b0375(0xe8)](_0x758639){const _0x1e9654=a79_0x4b0375,_0x11ef93=new Date()['toISOString']()[_0x1e9654(0xff)]('T')[0x0];return path_1[_0x1e9654(0x12d)][_0x1e9654(0x10b)](this[_0x1e9654(0xec)],_0x758639+'_'+_0x11ef93+_0x1e9654(0x11e));}[a79_0x4b0375(0x11b)](_0x500492,_0x163ba6){const _0x5be2c3=a79_0x4b0375;try{const _0x5a0e9f=new Date()[_0x5be2c3(0x12a)](),_0x1720a7={'timestamp':_0x5a0e9f,..._0x163ba6},_0x4fe462=JSON['stringify'](_0x1720a7)+'\x0a',_0x1fd29c=this[_0x5be2c3(0xe8)](_0x500492);fs_1['default']['appendFileSync'](_0x1fd29c,_0x4fe462,_0x5be2c3(0x102));}catch(_0x147740){console[_0x5be2c3(0x109)]('Failed\x20to\x20write\x20'+_0x500492+_0x5be2c3(0x119),_0x147740);}}[a79_0x4b0375(0xfb)](_0x559ab4,_0xcf4581,_0x212e0,_0x15bd71){const _0x35f5a3=a79_0x4b0375;this[_0x35f5a3(0x11b)](_0x35f5a3(0x115),{'type':_0x35f5a3(0xf2),'gateway':_0x559ab4,'endpoint':_0xcf4581,'method':_0x212e0,'data':_0x15bd71});}[a79_0x4b0375(0xf8)](_0x4045b1,_0x52147b,_0x446f7c,_0x4fd536,_0x5f3318){const _0x47f14f=a79_0x4b0375;this[_0x47f14f(0x11b)](_0x47f14f(0x117),{'type':'RESPONSE','gateway':_0x4045b1,'endpoint':_0x52147b,'status':_0x446f7c,'responseTime':_0x5f3318,'data':_0x4fd536});}['logWhiteDomainError'](_0x101ef4,_0x53841d,_0x48ed7c){const _0x39892b=a79_0x4b0375;this[_0x39892b(0x11b)](_0x39892b(0xe7),{'type':'ERROR','gateway':_0x101ef4,'endpoint':_0x53841d,'error':_0x48ed7c instanceof Error?{'message':_0x48ed7c[_0x39892b(0xe6)],'stack':_0x48ed7c[_0x39892b(0xeb)]}:_0x48ed7c});}[a79_0x4b0375(0xf6)](_0x33c650,_0x30b1c2,_0xead690){const _0x3f6017=a79_0x4b0375;this['writeLog'](_0x3f6017(0x112),{'type':_0x3f6017(0x110),'gateway':_0x33c650,'headers':_0xead690,'data':_0x30b1c2});}[a79_0x4b0375(0xef)](_0x22892f,_0x599291,_0x10cfed,_0x402fe7,_0x2b7407){const _0x1c9089=a79_0x4b0375;this[_0x1c9089(0x11b)]('webhooks_processed',{'type':_0x1c9089(0x123),'gateway':_0x22892f,'paymentId':_0x599291,'oldStatus':_0x10cfed,'newStatus':_0x402fe7,'originalData':_0x2b7407});}[a79_0x4b0375(0x118)](_0xb6a946,_0x30d87f,_0x418aef){const _0x15355f=a79_0x4b0375;this[_0x15355f(0x11b)](_0x15355f(0x10e),{'type':'WEBHOOK_ERROR','gateway':_0xb6a946,'error':_0x30d87f instanceof Error?{'message':_0x30d87f[_0x15355f(0xe6)],'stack':_0x30d87f[_0x15355f(0xeb)]}:_0x30d87f,'originalData':_0x418aef});}['logCoinToPayStatus'](_0xd4a98c){const _0x4435ba=a79_0x4b0375;this[_0x4435ba(0x11b)](_0x4435ba(0x10a),{'type':_0x4435ba(0x124),..._0xd4a98c});}['logCoinToPayError'](_0x522776){const _0x28a3f3=a79_0x4b0375;this[_0x28a3f3(0x11b)](_0x28a3f3(0x122),{'type':_0x28a3f3(0x12c),..._0x522776});}['logShopWebhookSent'](_0x21d29f,_0x15a028,_0xc3edbf,_0x373d4b,_0x2150ea,_0x29d3e0){const _0x2ee764=a79_0x4b0375;this['writeLog']('shop_webhooks_sent',{'type':_0x2ee764(0x106),'shopId':_0x21d29f,'webhookUrl':_0x15a028,'event':_0xc3edbf,'status':_0x373d4b,'responseTime':_0x2150ea,'payload':_0x29d3e0});}[a79_0x4b0375(0x121)](_0x109e8e,_0x4c2e78,_0xfad9e9,_0x4d888c,_0x2d8012){const _0xd3e9ca=a79_0x4b0375;this[_0xd3e9ca(0x11b)](_0xd3e9ca(0x11d),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x109e8e,'webhookUrl':_0x4c2e78,'event':_0xfad9e9,'error':_0x4d888c instanceof Error?{'message':_0x4d888c[_0xd3e9ca(0xe6)],'stack':_0x4d888c[_0xd3e9ca(0xeb)]}:_0x4d888c,'payload':_0x2d8012});}['logPaymentCreated'](_0x468efb,_0x5de9ae,_0x24c207,_0x36f300,_0x989c92){const _0x43c5da=a79_0x4b0375;this[_0x43c5da(0x11b)](_0x43c5da(0x10f),{'type':_0x43c5da(0xf3),'gateway':_0x468efb,'paymentId':_0x5de9ae,'shopId':_0x24c207,'amount':_0x36f300,'currency':_0x989c92});}[a79_0x4b0375(0x108)](_0x5a032f,_0x39edc2,_0x57a916,_0x4f1798,_0xcbb38a){const _0x26dd51=a79_0x4b0375;this[_0x26dd51(0x11b)](_0x26dd51(0x127),{'type':_0x26dd51(0xf5),'endpoint':_0x5a032f,'method':_0x39edc2,'userId':_0x57a916,'userRole':_0x4f1798,'requestData':_0xcbb38a});}[a79_0x4b0375(0x11f)](){const _0x8aca3a=a79_0x4b0375;try{const _0x460f6a=fs_1['default'][_0x8aca3a(0x126)](this[_0x8aca3a(0xec)]),_0x4c993d=_0x460f6a['filter'](_0x2a75f5=>_0x2a75f5['endsWith']('.log')),_0x18ec2b=[...new Set(_0x4c993d['map'](_0x296a0f=>_0x296a0f['split']('_')[0x0]))],_0xf789a7=_0x4c993d[_0x8aca3a(0x100)](_0x148def=>{const _0x5e0d0e=_0x8aca3a,_0xefc971=path_1['default'][_0x5e0d0e(0x10b)](this[_0x5e0d0e(0xec)],_0x148def),_0x426705=fs_1['default']['statSync'](_0xefc971),[_0x6fd5b,_0x33cce3]=_0x148def['replace'](_0x5e0d0e(0x11e),'')[_0x5e0d0e(0xff)]('_');return{'type':_0x6fd5b,'date':_0x33cce3,'size':_0x426705['size']};})['sort']((_0x230789,_0x41c0ae)=>_0x41c0ae[_0x8aca3a(0xf0)][_0x8aca3a(0xf1)](_0x230789[_0x8aca3a(0xf0)]));return{'totalFiles':_0x4c993d[_0x8aca3a(0x104)],'logTypes':_0x18ec2b,'latestLogs':_0xf789a7[_0x8aca3a(0x10c)](0x0,0xa)};}catch(_0x382aa7){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x382aa7),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0xc58a7e=0x1e){const _0x1d3ed2=a79_0x4b0375;try{const _0x45539b=fs_1[_0x1d3ed2(0x12d)][_0x1d3ed2(0x126)](this[_0x1d3ed2(0xec)]),_0x43ae13=new Date();_0x43ae13[_0x1d3ed2(0x131)](_0x43ae13['getDate']()-_0xc58a7e);let _0x54f365=0x0;_0x45539b[_0x1d3ed2(0x103)](_0x4d829d=>{const _0x1fc688=_0x1d3ed2;if(!_0x4d829d[_0x1fc688(0x125)]('.log'))return;const _0x2bec98=path_1[_0x1fc688(0x12d)][_0x1fc688(0x10b)](this['logsDir'],_0x4d829d),_0x405725=fs_1[_0x1fc688(0x12d)][_0x1fc688(0xf7)](_0x2bec98);_0x405725[_0x1fc688(0xfc)]<_0x43ae13&&(fs_1[_0x1fc688(0x12d)][_0x1fc688(0xea)](_0x2bec98),_0x54f365++,console[_0x1fc688(0x12e)](_0x1fc688(0x116)+_0x4d829d));}),console[_0x1d3ed2(0x12e)](_0x1d3ed2(0x114)+_0x54f365+_0x1d3ed2(0x129)+_0xc58a7e+'\x20days)');}catch(_0xa93a8){console[_0x1d3ed2(0x109)](_0x1d3ed2(0xed),_0xa93a8);}}}exports[a79_0x4b0375(0x105)]=LoggerService,exports[a79_0x4b0375(0xf9)]=new LoggerService();