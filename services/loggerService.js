'use strict';const a51_0xdb3a8f=a51_0x1c0f;(function(_0x2eeec4,_0x416d9f){const _0x26beae=a51_0x1c0f,_0x171c50=_0x2eeec4();while(!![]){try{const _0x17dc43=parseInt(_0x26beae(0x1ee))/0x1+-parseInt(_0x26beae(0x1cb))/0x2*(-parseInt(_0x26beae(0x1e4))/0x3)+parseInt(_0x26beae(0x1a2))/0x4+parseInt(_0x26beae(0x1ad))/0x5+-parseInt(_0x26beae(0x1d9))/0x6+-parseInt(_0x26beae(0x1ce))/0x7+-parseInt(_0x26beae(0x1dc))/0x8;if(_0x17dc43===_0x416d9f)break;else _0x171c50['push'](_0x171c50['shift']());}catch(_0x37910b){_0x171c50['push'](_0x171c50['shift']());}}}(a51_0x1c64,0xef965));var __importDefault=this&&this[a51_0xdb3a8f(0x1f0)]||function(_0xe4fac6){const _0x3a7ebe=a51_0xdb3a8f;return _0xe4fac6&&_0xe4fac6[_0x3a7ebe(0x1bf)]?_0xe4fac6:{'default':_0xe4fac6};};function a51_0x1c0f(_0x1392ff,_0x38396a){const _0x1c64c7=a51_0x1c64();return a51_0x1c0f=function(_0x1c0faf,_0x350e7f){_0x1c0faf=_0x1c0faf-0x1a1;let _0xe4f603=_0x1c64c7[_0x1c0faf];return _0xe4f603;},a51_0x1c0f(_0x1392ff,_0x38396a);}Object[a51_0xdb3a8f(0x1b6)](exports,a51_0xdb3a8f(0x1bf),{'value':!![]}),exports[a51_0xdb3a8f(0x1ab)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0xdb3a8f(0x1b7)));function a51_0x1c64(){const _0x5b0cea=['setDate','2585328oPvVen','🧹\x20Cleaned\x20','📁\x20Created\x20logs\x20directory:\x20','mtime','split','logWebhookReceived','\x20log:','size','length','loggerService','unlinkSync','9205295dyFknv','statSync','cwd','white_domain_errors','white_domain_responses','logWhiteDomainResponse','payments_created','logs','appendFileSync','defineProperty','path','logPaymentCreated','ERROR','message','sort','🗑️\x20Deleted\x20old\x20log\x20file:\x20','webhooks_errors','stack','__esModule','API_CALL','getLogFileName','shop_webhooks_sent','cointopay_status_changes','COINTOPAY_ERROR','Failed\x20to\x20write\x20','WEBHOOK_PROCESSED','default','cleanOldLogs','writeLog','date','76166apziSb','.log','utf8','13579741kLPtac','WEBHOOK_ERROR','mkdirSync','replace','api_calls','logWhiteDomainRequest','logShopWebhookSent','logCoinToPayStatus','localeCompare','logsDir','WEBHOOK_RECEIVED','1535016ezAmiQ','error','logApiCall','12880104jlnsZL','\x20days)','existsSync','filter','RESPONSE','Failed\x20to\x20clean\x20old\x20logs:','logShopWebhookError','PAYMENT_CREATED','108FGOVbH','stringify','webhooks_received','join','log','slice','webhooks_processed','getDate','SHOP_WEBHOOK_ERROR','readdirSync','928782drkLna','getLogStats','__importDefault','map','endsWith','toISOString'];a51_0x1c64=function(){return _0x5b0cea;};return a51_0x1c64();}class LoggerService{constructor(){const _0x4bfdad=a51_0xdb3a8f;this[_0x4bfdad(0x1d7)]=path_1[_0x4bfdad(0x1c7)][_0x4bfdad(0x1e7)](process[_0x4bfdad(0x1af)](),_0x4bfdad(0x1b4)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x1dfa7b=a51_0xdb3a8f;!fs_1[_0x1dfa7b(0x1c7)][_0x1dfa7b(0x1de)](this[_0x1dfa7b(0x1d7)])&&(fs_1[_0x1dfa7b(0x1c7)][_0x1dfa7b(0x1d0)](this[_0x1dfa7b(0x1d7)],{'recursive':!![]}),console[_0x1dfa7b(0x1e8)](_0x1dfa7b(0x1a4)+this[_0x1dfa7b(0x1d7)]));}[a51_0xdb3a8f(0x1c1)](_0x17bc25){const _0x4b9b6c=a51_0xdb3a8f,_0x4d6f3c=new Date()[_0x4b9b6c(0x1f3)]()[_0x4b9b6c(0x1a6)]('T')[0x0];return path_1[_0x4b9b6c(0x1c7)][_0x4b9b6c(0x1e7)](this[_0x4b9b6c(0x1d7)],_0x17bc25+'_'+_0x4d6f3c+'.log');}['writeLog'](_0x88c8ca,_0x40f558){const _0x5bd215=a51_0xdb3a8f;try{const _0x14548a=new Date()['toISOString'](),_0x47d802={'timestamp':_0x14548a,..._0x40f558},_0x5664d=JSON[_0x5bd215(0x1e5)](_0x47d802)+'\x0a',_0x2641b8=this[_0x5bd215(0x1c1)](_0x88c8ca);fs_1[_0x5bd215(0x1c7)][_0x5bd215(0x1b5)](_0x2641b8,_0x5664d,_0x5bd215(0x1cd));}catch(_0x447a52){console[_0x5bd215(0x1da)](_0x5bd215(0x1c5)+_0x88c8ca+_0x5bd215(0x1a8),_0x447a52);}}[a51_0xdb3a8f(0x1d3)](_0x20af40,_0x5ebefa,_0xc2e4be,_0x50210c){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0x20af40,'endpoint':_0x5ebefa,'method':_0xc2e4be,'data':_0x50210c});}[a51_0xdb3a8f(0x1b2)](_0x14c228,_0x543984,_0x59e231,_0x353cff,_0x53a2d2){const _0x5f5821=a51_0xdb3a8f;this['writeLog'](_0x5f5821(0x1b1),{'type':_0x5f5821(0x1e0),'gateway':_0x14c228,'endpoint':_0x543984,'status':_0x59e231,'responseTime':_0x53a2d2,'data':_0x353cff});}['logWhiteDomainError'](_0xfd2226,_0x4362b7,_0xc9bda6){const _0x42ad28=a51_0xdb3a8f;this['writeLog'](_0x42ad28(0x1b0),{'type':_0x42ad28(0x1b9),'gateway':_0xfd2226,'endpoint':_0x4362b7,'error':_0xc9bda6 instanceof Error?{'message':_0xc9bda6[_0x42ad28(0x1ba)],'stack':_0xc9bda6[_0x42ad28(0x1be)]}:_0xc9bda6});}[a51_0xdb3a8f(0x1a7)](_0x1da02f,_0x2f0b67,_0x41bc9b){const _0x513d9e=a51_0xdb3a8f;this[_0x513d9e(0x1c9)](_0x513d9e(0x1e6),{'type':_0x513d9e(0x1d8),'gateway':_0x1da02f,'headers':_0x41bc9b,'data':_0x2f0b67});}['logWebhookProcessed'](_0x416cd2,_0x37188e,_0x1c8073,_0x23b7d0,_0x5075b6){const _0x552aa0=a51_0xdb3a8f;this[_0x552aa0(0x1c9)](_0x552aa0(0x1ea),{'type':_0x552aa0(0x1c6),'gateway':_0x416cd2,'paymentId':_0x37188e,'oldStatus':_0x1c8073,'newStatus':_0x23b7d0,'originalData':_0x5075b6});}['logWebhookError'](_0x5d668b,_0x311eaa,_0x292ee7){const _0x2ede1b=a51_0xdb3a8f;this[_0x2ede1b(0x1c9)](_0x2ede1b(0x1bd),{'type':_0x2ede1b(0x1cf),'gateway':_0x5d668b,'error':_0x311eaa instanceof Error?{'message':_0x311eaa[_0x2ede1b(0x1ba)],'stack':_0x311eaa[_0x2ede1b(0x1be)]}:_0x311eaa,'originalData':_0x292ee7});}[a51_0xdb3a8f(0x1d5)](_0x5a6be6){const _0xbfa1ec=a51_0xdb3a8f;this['writeLog'](_0xbfa1ec(0x1c3),{'type':'COINTOPAY_STATUS_CHANGE',..._0x5a6be6});}['logCoinToPayError'](_0x243f0c){const _0x25936d=a51_0xdb3a8f;this['writeLog']('cointopay_errors',{'type':_0x25936d(0x1c4),..._0x243f0c});}[a51_0xdb3a8f(0x1d4)](_0x575e60,_0x29f494,_0x2cddeb,_0x5d84ca,_0x475017,_0x18abfb){const _0xe988f2=a51_0xdb3a8f;this[_0xe988f2(0x1c9)](_0xe988f2(0x1c2),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x575e60,'webhookUrl':_0x29f494,'event':_0x2cddeb,'status':_0x5d84ca,'responseTime':_0x475017,'payload':_0x18abfb});}[a51_0xdb3a8f(0x1e2)](_0x5e6606,_0x2cce4d,_0x12fa1d,_0x4f5ac1,_0x36ee06){const _0x3f931b=a51_0xdb3a8f;this[_0x3f931b(0x1c9)]('shop_webhooks_errors',{'type':_0x3f931b(0x1ec),'shopId':_0x5e6606,'webhookUrl':_0x2cce4d,'event':_0x12fa1d,'error':_0x4f5ac1 instanceof Error?{'message':_0x4f5ac1[_0x3f931b(0x1ba)],'stack':_0x4f5ac1[_0x3f931b(0x1be)]}:_0x4f5ac1,'payload':_0x36ee06});}[a51_0xdb3a8f(0x1b8)](_0x335f06,_0x3a6d7b,_0x33687f,_0x197c15,_0x523812){const _0x54260c=a51_0xdb3a8f;this['writeLog'](_0x54260c(0x1b3),{'type':_0x54260c(0x1e3),'gateway':_0x335f06,'paymentId':_0x3a6d7b,'shopId':_0x33687f,'amount':_0x197c15,'currency':_0x523812});}[a51_0xdb3a8f(0x1db)](_0x4780db,_0x49ef67,_0x43d3f5,_0x52cdc6,_0x291c83){const _0x971a4d=a51_0xdb3a8f;this['writeLog'](_0x971a4d(0x1d2),{'type':_0x971a4d(0x1c0),'endpoint':_0x4780db,'method':_0x49ef67,'userId':_0x43d3f5,'userRole':_0x52cdc6,'requestData':_0x291c83});}[a51_0xdb3a8f(0x1ef)](){const _0x3b52d4=a51_0xdb3a8f;try{const _0x345588=fs_1[_0x3b52d4(0x1c7)][_0x3b52d4(0x1ed)](this[_0x3b52d4(0x1d7)]),_0x5d8024=_0x345588[_0x3b52d4(0x1df)](_0x20ff69=>_0x20ff69['endsWith'](_0x3b52d4(0x1cc))),_0x3b4c2f=[...new Set(_0x5d8024[_0x3b52d4(0x1f1)](_0x2de73f=>_0x2de73f['split']('_')[0x0]))],_0x31f3fe=_0x5d8024[_0x3b52d4(0x1f1)](_0x554cc9=>{const _0x339456=_0x3b52d4,_0x39b41c=path_1[_0x339456(0x1c7)]['join'](this[_0x339456(0x1d7)],_0x554cc9),_0x5096de=fs_1['default'][_0x339456(0x1ae)](_0x39b41c),[_0x21d09b,_0x454562]=_0x554cc9[_0x339456(0x1d1)](_0x339456(0x1cc),'')[_0x339456(0x1a6)]('_');return{'type':_0x21d09b,'date':_0x454562,'size':_0x5096de[_0x339456(0x1a9)]};})[_0x3b52d4(0x1bb)]((_0xc7deed,_0x244eef)=>_0x244eef[_0x3b52d4(0x1ca)][_0x3b52d4(0x1d6)](_0xc7deed[_0x3b52d4(0x1ca)]));return{'totalFiles':_0x5d8024[_0x3b52d4(0x1aa)],'logTypes':_0x3b4c2f,'latestLogs':_0x31f3fe[_0x3b52d4(0x1e9)](0x0,0xa)};}catch(_0x4df9cb){return console[_0x3b52d4(0x1da)]('Failed\x20to\x20get\x20log\x20stats:',_0x4df9cb),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0xdb3a8f(0x1c8)](_0x37c521=0x1e){const _0x4fe13e=a51_0xdb3a8f;try{const _0x33cd20=fs_1[_0x4fe13e(0x1c7)][_0x4fe13e(0x1ed)](this[_0x4fe13e(0x1d7)]),_0x47820a=new Date();_0x47820a[_0x4fe13e(0x1a1)](_0x47820a[_0x4fe13e(0x1eb)]()-_0x37c521);let _0xea92b5=0x0;_0x33cd20['forEach'](_0x1c9f6e=>{const _0x5e142d=_0x4fe13e;if(!_0x1c9f6e[_0x5e142d(0x1f2)]('.log'))return;const _0x12b477=path_1[_0x5e142d(0x1c7)]['join'](this[_0x5e142d(0x1d7)],_0x1c9f6e),_0x432b9c=fs_1[_0x5e142d(0x1c7)][_0x5e142d(0x1ae)](_0x12b477);_0x432b9c[_0x5e142d(0x1a5)]<_0x47820a&&(fs_1[_0x5e142d(0x1c7)][_0x5e142d(0x1ac)](_0x12b477),_0xea92b5++,console[_0x5e142d(0x1e8)](_0x5e142d(0x1bc)+_0x1c9f6e));}),console[_0x4fe13e(0x1e8)](_0x4fe13e(0x1a3)+_0xea92b5+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x37c521+_0x4fe13e(0x1dd));}catch(_0x433a51){console[_0x4fe13e(0x1da)](_0x4fe13e(0x1e1),_0x433a51);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();