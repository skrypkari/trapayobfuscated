'use strict';const a79_0x35caca=a79_0x5951;(function(_0x3453ce,_0x46bd36){const _0x1a4bf9=a79_0x5951,_0x77be9e=_0x3453ce();while(!![]){try{const _0x400905=parseInt(_0x1a4bf9(0xe1))/0x1+parseInt(_0x1a4bf9(0xc6))/0x2*(parseInt(_0x1a4bf9(0xb7))/0x3)+-parseInt(_0x1a4bf9(0xba))/0x4+-parseInt(_0x1a4bf9(0x94))/0x5*(parseInt(_0x1a4bf9(0xe6))/0x6)+-parseInt(_0x1a4bf9(0xb8))/0x7*(parseInt(_0x1a4bf9(0x93))/0x8)+parseInt(_0x1a4bf9(0xbe))/0x9*(parseInt(_0x1a4bf9(0xb5))/0xa)+parseInt(_0x1a4bf9(0xbb))/0xb;if(_0x400905===_0x46bd36)break;else _0x77be9e['push'](_0x77be9e['shift']());}catch(_0x4acb20){_0x77be9e['push'](_0x77be9e['shift']());}}}(a79_0x2581,0x1ba90));function a79_0x5951(_0x1aead6,_0x37727f){_0x1aead6=_0x1aead6-0x90;const _0x2581c2=a79_0x2581();let _0x59513c=_0x2581c2[_0x1aead6];return _0x59513c;}var __importDefault=this&&this[a79_0x35caca(0xe2)]||function(_0x58a201){const _0x2a892e=a79_0x35caca;return _0x58a201&&_0x58a201[_0x2a892e(0xd4)]?_0x58a201:{'default':_0x58a201};};Object[a79_0x35caca(0x9e)](exports,a79_0x35caca(0xd4),{'value':!![]}),exports[a79_0x35caca(0xaf)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x35caca(0xbc)));class LoggerService{constructor(){const _0x303259=a79_0x35caca;this['logsDir']=path_1[_0x303259(0xda)][_0x303259(0x98)](process[_0x303259(0xc2)](),'logs'),this[_0x303259(0xe4)]();}['ensureLogsDirectory'](){const _0x1b9c5d=a79_0x35caca;!fs_1['default'][_0x1b9c5d(0x9f)](this[_0x1b9c5d(0xc4)])&&(fs_1[_0x1b9c5d(0xda)][_0x1b9c5d(0xa3)](this[_0x1b9c5d(0xc4)],{'recursive':!![]}),console[_0x1b9c5d(0x9b)](_0x1b9c5d(0xd0)+this[_0x1b9c5d(0xc4)]));}['getLogFileName'](_0x14a205){const _0x397b6c=a79_0x35caca,_0x542013=new Date()[_0x397b6c(0x92)]()['split']('T')[0x0];return path_1['default'][_0x397b6c(0x98)](this[_0x397b6c(0xc4)],_0x14a205+'_'+_0x542013+'.log');}['writeLog'](_0x31c218,_0x49d1a0){const _0x500150=a79_0x35caca;try{const _0x50fdaf=new Date()[_0x500150(0x92)](),_0x52a6c9={'timestamp':_0x50fdaf,..._0x49d1a0},_0x215556=JSON[_0x500150(0x90)](_0x52a6c9)+'\x0a',_0x21f71f=this[_0x500150(0xa4)](_0x31c218);fs_1[_0x500150(0xda)][_0x500150(0xd1)](_0x21f71f,_0x215556,_0x500150(0xcf));}catch(_0x111361){console['error'](_0x500150(0xdb)+_0x31c218+_0x500150(0x99),_0x111361);}}[a79_0x35caca(0x95)](_0x346b83,_0x155a6e,_0x41c4d8,_0x930c59){const _0x2ae425=a79_0x35caca;this[_0x2ae425(0xb2)]('white_domain_requests',{'type':'REQUEST','gateway':_0x346b83,'endpoint':_0x155a6e,'method':_0x41c4d8,'data':_0x930c59});}[a79_0x35caca(0xd8)](_0x5c9cb2,_0xc779c7,_0x37063b,_0x1d973f,_0x9596d1){const _0x1e0696=a79_0x35caca;this['writeLog']('white_domain_responses',{'type':_0x1e0696(0xa0),'gateway':_0x5c9cb2,'endpoint':_0xc779c7,'status':_0x37063b,'responseTime':_0x9596d1,'data':_0x1d973f});}[a79_0x35caca(0xc5)](_0x4a06bd,_0x45fc2c,_0x47599b){const _0x200b95=a79_0x35caca;this[_0x200b95(0xb2)](_0x200b95(0xc8),{'type':'ERROR','gateway':_0x4a06bd,'endpoint':_0x45fc2c,'error':_0x47599b instanceof Error?{'message':_0x47599b[_0x200b95(0xa5)],'stack':_0x47599b[_0x200b95(0xc1)]}:_0x47599b});}[a79_0x35caca(0xde)](_0x5e68a1,_0x575125,_0x21f96a){const _0x5906c0=a79_0x35caca;this[_0x5906c0(0xb2)](_0x5906c0(0x9c),{'type':_0x5906c0(0xc7),'gateway':_0x5e68a1,'headers':_0x21f96a,'data':_0x575125});}['logWebhookProcessed'](_0x425245,_0x4bc891,_0x3a8a30,_0x51904e,_0x2062be){const _0x42346c=a79_0x35caca;this[_0x42346c(0xb2)](_0x42346c(0xce),{'type':_0x42346c(0xc3),'gateway':_0x425245,'paymentId':_0x4bc891,'oldStatus':_0x3a8a30,'newStatus':_0x51904e,'originalData':_0x2062be});}[a79_0x35caca(0xe3)](_0x334795,_0x3dbd20,_0x148d98){const _0x57a34c=a79_0x35caca;this['writeLog'](_0x57a34c(0xb0),{'type':_0x57a34c(0xa1),'gateway':_0x334795,'error':_0x3dbd20 instanceof Error?{'message':_0x3dbd20[_0x57a34c(0xa5)],'stack':_0x3dbd20[_0x57a34c(0xc1)]}:_0x3dbd20,'originalData':_0x148d98});}[a79_0x35caca(0xa7)](_0x3d5610){const _0x21c644=a79_0x35caca;this[_0x21c644(0xb2)](_0x21c644(0xab),{'type':_0x21c644(0xd6),..._0x3d5610});}[a79_0x35caca(0x9d)](_0x2ca3f7){const _0xdf1c99=a79_0x35caca;this[_0xdf1c99(0xb2)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x2ca3f7});}[a79_0x35caca(0xbd)](_0x8a8d0f,_0x42d59f,_0x451e7f,_0x1e146f,_0xf1183f,_0x152bb8){const _0x1da364=a79_0x35caca;this['writeLog'](_0x1da364(0xb1),{'type':_0x1da364(0xb3),'shopId':_0x8a8d0f,'webhookUrl':_0x42d59f,'event':_0x451e7f,'status':_0x1e146f,'responseTime':_0xf1183f,'payload':_0x152bb8});}[a79_0x35caca(0xcc)](_0x71d75a,_0x3fe85a,_0x56a14d,_0x53bd1f,_0x3e4ebe){const _0x20bcfd=a79_0x35caca;this[_0x20bcfd(0xb2)](_0x20bcfd(0xbf),{'type':_0x20bcfd(0xcb),'shopId':_0x71d75a,'webhookUrl':_0x3fe85a,'event':_0x56a14d,'error':_0x53bd1f instanceof Error?{'message':_0x53bd1f[_0x20bcfd(0xa5)],'stack':_0x53bd1f[_0x20bcfd(0xc1)]}:_0x53bd1f,'payload':_0x3e4ebe});}[a79_0x35caca(0xd7)](_0x4a96be,_0x1c4a99,_0x1e8910,_0x408ba4,_0x407045){const _0x216944=a79_0x35caca;this[_0x216944(0xb2)](_0x216944(0x96),{'type':'PAYMENT_CREATED','gateway':_0x4a96be,'paymentId':_0x1c4a99,'shopId':_0x1e8910,'amount':_0x408ba4,'currency':_0x407045});}[a79_0x35caca(0xb6)](_0x1fee06,_0x5b678c,_0x53d8c8,_0x3f2b49,_0x3b4b68){const _0x15bc4e=a79_0x35caca;this[_0x15bc4e(0xb2)](_0x15bc4e(0xad),{'type':_0x15bc4e(0xc0),'endpoint':_0x1fee06,'method':_0x5b678c,'userId':_0x53d8c8,'userRole':_0x3f2b49,'requestData':_0x3b4b68});}['getLogStats'](){const _0x4f368a=a79_0x35caca;try{const _0x54d760=fs_1['default'][_0x4f368a(0xa9)](this[_0x4f368a(0xc4)]),_0x192222=_0x54d760[_0x4f368a(0xb9)](_0x4da87d=>_0x4da87d[_0x4f368a(0xa8)](_0x4f368a(0xe0))),_0x4c5e40=[...new Set(_0x192222[_0x4f368a(0xac)](_0x20c53d=>_0x20c53d[_0x4f368a(0xdd)]('_')[0x0]))],_0x592c9f=_0x192222[_0x4f368a(0xac)](_0x4120ef=>{const _0x37775f=_0x4f368a,_0x30ad04=path_1['default'][_0x37775f(0x98)](this[_0x37775f(0xc4)],_0x4120ef),_0x174d7b=fs_1[_0x37775f(0xda)][_0x37775f(0xa6)](_0x30ad04),[_0x58cc81,_0x2ffad0]=_0x4120ef[_0x37775f(0xcd)](_0x37775f(0xe0),'')[_0x37775f(0xdd)]('_');return{'type':_0x58cc81,'date':_0x2ffad0,'size':_0x174d7b[_0x37775f(0xa2)]};})[_0x4f368a(0xb4)]((_0x14dff8,_0x46061f)=>_0x46061f[_0x4f368a(0x97)][_0x4f368a(0xd3)](_0x14dff8[_0x4f368a(0x97)]));return{'totalFiles':_0x192222[_0x4f368a(0xca)],'logTypes':_0x4c5e40,'latestLogs':_0x592c9f[_0x4f368a(0xd9)](0x0,0xa)};}catch(_0x15a539){return console['error'](_0x4f368a(0xdc),_0x15a539),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a79_0x35caca(0xe7)](_0x348cd9=0x1e){const _0x44ef49=a79_0x35caca;try{const _0x5663ce=fs_1[_0x44ef49(0xda)][_0x44ef49(0xa9)](this[_0x44ef49(0xc4)]),_0x1f889e=new Date();_0x1f889e[_0x44ef49(0xe5)](_0x1f889e['getDate']()-_0x348cd9);let _0x45968c=0x0;_0x5663ce[_0x44ef49(0xc9)](_0xc22902=>{const _0x2d2717=_0x44ef49;if(!_0xc22902[_0x2d2717(0xa8)]('.log'))return;const _0x427f6f=path_1['default']['join'](this[_0x2d2717(0xc4)],_0xc22902),_0xfb30c1=fs_1['default'][_0x2d2717(0xa6)](_0x427f6f);_0xfb30c1['mtime']<_0x1f889e&&(fs_1[_0x2d2717(0xda)][_0x2d2717(0x9a)](_0x427f6f),_0x45968c++,console[_0x2d2717(0x9b)](_0x2d2717(0xaa)+_0xc22902));}),console[_0x44ef49(0x9b)](_0x44ef49(0xd5)+_0x45968c+_0x44ef49(0xae)+_0x348cd9+'\x20days)');}catch(_0x4fc535){console[_0x44ef49(0xdf)](_0x44ef49(0x91),_0x4fc535);}}}function a79_0x2581(){const _0x365f3f=['ensureLogsDirectory','setDate','6rXRTIk','cleanOldLogs','stringify','Failed\x20to\x20clean\x20old\x20logs:','toISOString','2808canEge','534805DdJcvT','logWhiteDomainRequest','payments_created','date','join','\x20log:','unlinkSync','log','webhooks_received','logCoinToPayError','defineProperty','existsSync','RESPONSE','WEBHOOK_ERROR','size','mkdirSync','getLogFileName','message','statSync','logCoinToPayStatus','endsWith','readdirSync','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','cointopay_status_changes','map','api_calls','\x20old\x20log\x20files\x20(older\x20than\x20','loggerService','webhooks_errors','shop_webhooks_sent','writeLog','SHOP_WEBHOOK_SENT','sort','520qUraQj','logApiCall','93VROsYY','4214jFWOIV','filter','120552ubKQrK','2433728FsfgRU','path','logShopWebhookSent','13545zNMKtk','shop_webhooks_errors','API_CALL','stack','cwd','WEBHOOK_PROCESSED','logsDir','logWhiteDomainError','6722aoCNUV','WEBHOOK_RECEIVED','white_domain_errors','forEach','length','SHOP_WEBHOOK_ERROR','logShopWebhookError','replace','webhooks_processed','utf8','ðŸ“\x20Created\x20logs\x20directory:\x20','appendFileSync','LoggerService','localeCompare','__esModule','ðŸ§¹\x20Cleaned\x20','COINTOPAY_STATUS_CHANGE','logPaymentCreated','logWhiteDomainResponse','slice','default','Failed\x20to\x20write\x20','Failed\x20to\x20get\x20log\x20stats:','split','logWebhookReceived','error','.log','57998WRpeFQ','__importDefault','logWebhookError'];a79_0x2581=function(){return _0x365f3f;};return a79_0x2581();}exports[a79_0x35caca(0xd2)]=LoggerService,exports[a79_0x35caca(0xaf)]=new LoggerService();