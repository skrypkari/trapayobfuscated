'use strict';const a53_0x43dbf7=a53_0x47e9;(function(_0x58b2fb,_0x2524f6){const _0x1640dd=a53_0x47e9,_0x4d31e6=_0x58b2fb();while(!![]){try{const _0x6d6847=-parseInt(_0x1640dd(0x1a6))/0x1*(-parseInt(_0x1640dd(0x18f))/0x2)+-parseInt(_0x1640dd(0x159))/0x3*(parseInt(_0x1640dd(0x175))/0x4)+-parseInt(_0x1640dd(0x1a2))/0x5*(-parseInt(_0x1640dd(0x16a))/0x6)+-parseInt(_0x1640dd(0x187))/0x7*(-parseInt(_0x1640dd(0x164))/0x8)+-parseInt(_0x1640dd(0x19a))/0x9+-parseInt(_0x1640dd(0x15b))/0xa+parseInt(_0x1640dd(0x176))/0xb;if(_0x6d6847===_0x2524f6)break;else _0x4d31e6['push'](_0x4d31e6['shift']());}catch(_0x155e96){_0x4d31e6['push'](_0x4d31e6['shift']());}}}(a53_0x3b95,0xddf38));function a53_0x3b95(){const _0x353776=['sort','logWhiteDomainError','2157904ZHqcGb','getLogFileName','localeCompare','cointopay_status_changes','map','__esModule','12IWIuyU','WEBHOOK_ERROR','appendFileSync','writeLog','utf8','statSync','\x20old\x20log\x20files\x20(older\x20than\x20','logWebhookProcessed','logsDir','logCoinToPayError','forEach','439120FcobHv','18107265slBxST','default','webhooks_received','LoggerService','__importDefault','unlinkSync','slice','getLogStats','ensureLogsDirectory','shop_webhooks_sent','white_domain_errors','REQUEST','🗑️\x20Deleted\x20old\x20log\x20file:\x20','cwd','.log','mtime','log','35NPBidT','payments_created','replace','🧹\x20Cleaned\x20','RESPONSE','size','defineProperty','COINTOPAY_STATUS_CHANGE','540vGpnFg','logWhiteDomainResponse','white_domain_requests','📁\x20Created\x20logs\x20directory:\x20','mkdirSync','stack','getDate','Failed\x20to\x20clean\x20old\x20logs:','logs','setDate','white_domain_responses','3055644vhhhdj','webhooks_errors','Failed\x20to\x20get\x20log\x20stats:','date','logPaymentCreated','join','\x20days)','\x20log:','1426385iWmQjR','logCoinToPayStatus','SHOP_WEBHOOK_SENT','webhooks_processed','1155lLNsaL','SHOP_WEBHOOK_ERROR','error','readdirSync','split','39gQFoGh','endsWith','12014410BjLlCb','api_calls','COINTOPAY_ERROR','WEBHOOK_PROCESSED','shop_webhooks_errors','length','logWebhookReceived'];a53_0x3b95=function(){return _0x353776;};return a53_0x3b95();}var __importDefault=this&&this[a53_0x43dbf7(0x17a)]||function(_0x2d026f){const _0x50b5e6=a53_0x43dbf7;return _0x2d026f&&_0x2d026f[_0x50b5e6(0x169)]?_0x2d026f:{'default':_0x2d026f};};function a53_0x47e9(_0x298fa0,_0x2ae4ac){const _0x3b9501=a53_0x3b95();return a53_0x47e9=function(_0x47e98a,_0x20d0c8){_0x47e98a=_0x47e98a-0x158;let _0x55d173=_0x3b9501[_0x47e98a];return _0x55d173;},a53_0x47e9(_0x298fa0,_0x2ae4ac);}Object[a53_0x43dbf7(0x18d)](exports,a53_0x43dbf7(0x169),{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x6a3c36=a53_0x43dbf7;this[_0x6a3c36(0x172)]=path_1[_0x6a3c36(0x177)][_0x6a3c36(0x19f)](process[_0x6a3c36(0x183)](),_0x6a3c36(0x197)),this['ensureLogsDirectory']();}[a53_0x43dbf7(0x17e)](){const _0x28692b=a53_0x43dbf7;!fs_1[_0x28692b(0x177)]['existsSync'](this[_0x28692b(0x172)])&&(fs_1[_0x28692b(0x177)][_0x28692b(0x193)](this['logsDir'],{'recursive':!![]}),console[_0x28692b(0x186)](_0x28692b(0x192)+this[_0x28692b(0x172)]));}['getLogFileName'](_0x1f90b7){const _0x53ebde=a53_0x43dbf7,_0x9632b1=new Date()['toISOString']()['split']('T')[0x0];return path_1['default'][_0x53ebde(0x19f)](this[_0x53ebde(0x172)],_0x1f90b7+'_'+_0x9632b1+_0x53ebde(0x184));}[a53_0x43dbf7(0x16d)](_0x2940c6,_0x38e437){const _0x4e057a=a53_0x43dbf7;try{const _0x30308f=new Date()['toISOString'](),_0x5cdcd2={'timestamp':_0x30308f,..._0x38e437},_0x410e92=JSON['stringify'](_0x5cdcd2)+'\x0a',_0x2fd708=this[_0x4e057a(0x165)](_0x2940c6);fs_1[_0x4e057a(0x177)][_0x4e057a(0x16c)](_0x2fd708,_0x410e92,_0x4e057a(0x16e));}catch(_0x30fc31){console[_0x4e057a(0x1a8)]('Failed\x20to\x20write\x20'+_0x2940c6+_0x4e057a(0x1a1),_0x30fc31);}}['logWhiteDomainRequest'](_0x331102,_0x5d3576,_0x49fc8d,_0xe79c42){const _0x2207f9=a53_0x43dbf7;this[_0x2207f9(0x16d)](_0x2207f9(0x191),{'type':_0x2207f9(0x181),'gateway':_0x331102,'endpoint':_0x5d3576,'method':_0x49fc8d,'data':_0xe79c42});}[a53_0x43dbf7(0x190)](_0x5e40cb,_0x14f3d9,_0x20781e,_0x4b79db,_0x3504e7){const _0x45e3ef=a53_0x43dbf7;this[_0x45e3ef(0x16d)](_0x45e3ef(0x199),{'type':_0x45e3ef(0x18b),'gateway':_0x5e40cb,'endpoint':_0x14f3d9,'status':_0x20781e,'responseTime':_0x3504e7,'data':_0x4b79db});}[a53_0x43dbf7(0x163)](_0x48f404,_0x27e9dc,_0x134888){const _0x3753dd=a53_0x43dbf7;this[_0x3753dd(0x16d)](_0x3753dd(0x180),{'type':'ERROR','gateway':_0x48f404,'endpoint':_0x27e9dc,'error':_0x134888 instanceof Error?{'message':_0x134888['message'],'stack':_0x134888[_0x3753dd(0x194)]}:_0x134888});}[a53_0x43dbf7(0x161)](_0x257a03,_0x773f4f,_0x554fe5){const _0x315d20=a53_0x43dbf7;this[_0x315d20(0x16d)](_0x315d20(0x178),{'type':'WEBHOOK_RECEIVED','gateway':_0x257a03,'headers':_0x554fe5,'data':_0x773f4f});}[a53_0x43dbf7(0x171)](_0x50a3a2,_0x487a10,_0x4ef0bc,_0x13357d,_0x567a68){const _0x3f0b4b=a53_0x43dbf7;this['writeLog'](_0x3f0b4b(0x1a5),{'type':_0x3f0b4b(0x15e),'gateway':_0x50a3a2,'paymentId':_0x487a10,'oldStatus':_0x4ef0bc,'newStatus':_0x13357d,'originalData':_0x567a68});}['logWebhookError'](_0x3fcfcf,_0x5b3543,_0x1aaa2b){const _0x12d23c=a53_0x43dbf7;this[_0x12d23c(0x16d)](_0x12d23c(0x19b),{'type':_0x12d23c(0x16b),'gateway':_0x3fcfcf,'error':_0x5b3543 instanceof Error?{'message':_0x5b3543['message'],'stack':_0x5b3543[_0x12d23c(0x194)]}:_0x5b3543,'originalData':_0x1aaa2b});}[a53_0x43dbf7(0x1a3)](_0x1a56bb){const _0x2669a3=a53_0x43dbf7;this[_0x2669a3(0x16d)](_0x2669a3(0x167),{'type':_0x2669a3(0x18e),..._0x1a56bb});}[a53_0x43dbf7(0x173)](_0xd15280){const _0x23c6a6=a53_0x43dbf7;this[_0x23c6a6(0x16d)]('cointopay_errors',{'type':_0x23c6a6(0x15d),..._0xd15280});}['logShopWebhookSent'](_0x44b993,_0x4ec3b6,_0x3489f9,_0x5572eb,_0xcefe58,_0x40983d){const _0x2ddc6a=a53_0x43dbf7;this['writeLog'](_0x2ddc6a(0x17f),{'type':_0x2ddc6a(0x1a4),'shopId':_0x44b993,'webhookUrl':_0x4ec3b6,'event':_0x3489f9,'status':_0x5572eb,'responseTime':_0xcefe58,'payload':_0x40983d});}['logShopWebhookError'](_0x415ce6,_0x14b0fc,_0x540c20,_0x5803f2,_0x301a20){const _0x1c4753=a53_0x43dbf7;this[_0x1c4753(0x16d)](_0x1c4753(0x15f),{'type':_0x1c4753(0x1a7),'shopId':_0x415ce6,'webhookUrl':_0x14b0fc,'event':_0x540c20,'error':_0x5803f2 instanceof Error?{'message':_0x5803f2['message'],'stack':_0x5803f2[_0x1c4753(0x194)]}:_0x5803f2,'payload':_0x301a20});}[a53_0x43dbf7(0x19e)](_0x5afc90,_0x1a549f,_0x2ff294,_0x21a17d,_0x1757da){const _0x7dc414=a53_0x43dbf7;this['writeLog'](_0x7dc414(0x188),{'type':'PAYMENT_CREATED','gateway':_0x5afc90,'paymentId':_0x1a549f,'shopId':_0x2ff294,'amount':_0x21a17d,'currency':_0x1757da});}['logApiCall'](_0x48fcbf,_0x10003e,_0x1b93ec,_0x2ffa09,_0x564786){const _0x151cc3=a53_0x43dbf7;this[_0x151cc3(0x16d)](_0x151cc3(0x15c),{'type':'API_CALL','endpoint':_0x48fcbf,'method':_0x10003e,'userId':_0x1b93ec,'userRole':_0x2ffa09,'requestData':_0x564786});}[a53_0x43dbf7(0x17d)](){const _0x45ef70=a53_0x43dbf7;try{const _0x451722=fs_1[_0x45ef70(0x177)][_0x45ef70(0x1a9)](this[_0x45ef70(0x172)]),_0x3f08db=_0x451722['filter'](_0x557a05=>_0x557a05[_0x45ef70(0x15a)]('.log')),_0xe1a7d0=[...new Set(_0x3f08db[_0x45ef70(0x168)](_0x18a72d=>_0x18a72d[_0x45ef70(0x158)]('_')[0x0]))],_0x3fa008=_0x3f08db['map'](_0x566655=>{const _0x208ee7=_0x45ef70,_0x3546bd=path_1[_0x208ee7(0x177)][_0x208ee7(0x19f)](this['logsDir'],_0x566655),_0x3d14ec=fs_1[_0x208ee7(0x177)][_0x208ee7(0x16f)](_0x3546bd),[_0xe7dc74,_0x35a3a6]=_0x566655[_0x208ee7(0x189)](_0x208ee7(0x184),'')[_0x208ee7(0x158)]('_');return{'type':_0xe7dc74,'date':_0x35a3a6,'size':_0x3d14ec[_0x208ee7(0x18c)]};})[_0x45ef70(0x162)]((_0x106b5e,_0x4101db)=>_0x4101db['date'][_0x45ef70(0x166)](_0x106b5e[_0x45ef70(0x19d)]));return{'totalFiles':_0x3f08db[_0x45ef70(0x160)],'logTypes':_0xe1a7d0,'latestLogs':_0x3fa008[_0x45ef70(0x17c)](0x0,0xa)};}catch(_0x5b495b){return console[_0x45ef70(0x1a8)](_0x45ef70(0x19c),_0x5b495b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x21308e=0x1e){const _0x4c61f8=a53_0x43dbf7;try{const _0xabdd1d=fs_1['default'][_0x4c61f8(0x1a9)](this[_0x4c61f8(0x172)]),_0x560250=new Date();_0x560250[_0x4c61f8(0x198)](_0x560250[_0x4c61f8(0x195)]()-_0x21308e);let _0x3fb62d=0x0;_0xabdd1d[_0x4c61f8(0x174)](_0x5755d6=>{const _0x42a751=_0x4c61f8;if(!_0x5755d6['endsWith'](_0x42a751(0x184)))return;const _0x175f44=path_1[_0x42a751(0x177)][_0x42a751(0x19f)](this[_0x42a751(0x172)],_0x5755d6),_0x485183=fs_1[_0x42a751(0x177)][_0x42a751(0x16f)](_0x175f44);_0x485183[_0x42a751(0x185)]<_0x560250&&(fs_1[_0x42a751(0x177)][_0x42a751(0x17b)](_0x175f44),_0x3fb62d++,console[_0x42a751(0x186)](_0x42a751(0x182)+_0x5755d6));}),console[_0x4c61f8(0x186)](_0x4c61f8(0x18a)+_0x3fb62d+_0x4c61f8(0x170)+_0x21308e+_0x4c61f8(0x1a0));}catch(_0x3fd905){console[_0x4c61f8(0x1a8)](_0x4c61f8(0x196),_0x3fd905);}}}exports[a53_0x43dbf7(0x179)]=LoggerService,exports['loggerService']=new LoggerService();