'use strict';function a49_0x29af(_0x581209,_0x2c6c93){const _0x6ce233=a49_0x6ce2();return a49_0x29af=function(_0x29af5e,_0x1c436a){_0x29af5e=_0x29af5e-0xb1;let _0x302b59=_0x6ce233[_0x29af5e];return _0x302b59;},a49_0x29af(_0x581209,_0x2c6c93);}const a49_0x34c6d3=a49_0x29af;(function(_0x9567cc,_0x1b026d){const _0x49e8ff=a49_0x29af,_0x8056a7=_0x9567cc();while(!![]){try{const _0x3a6c33=parseInt(_0x49e8ff(0xbf))/0x1+-parseInt(_0x49e8ff(0xc0))/0x2+parseInt(_0x49e8ff(0xb5))/0x3*(parseInt(_0x49e8ff(0xec))/0x4)+parseInt(_0x49e8ff(0xf0))/0x5+parseInt(_0x49e8ff(0xd3))/0x6+parseInt(_0x49e8ff(0xc7))/0x7+parseInt(_0x49e8ff(0xf4))/0x8*(-parseInt(_0x49e8ff(0xcb))/0x9);if(_0x3a6c33===_0x1b026d)break;else _0x8056a7['push'](_0x8056a7['shift']());}catch(_0x216eff){_0x8056a7['push'](_0x8056a7['shift']());}}}(a49_0x6ce2,0x206ba));var __importDefault=this&&this['__importDefault']||function(_0x196f0d){const _0xdf7bce=a49_0x29af;return _0x196f0d&&_0x196f0d[_0xdf7bce(0xe5)]?_0x196f0d:{'default':_0x196f0d};};Object[a49_0x34c6d3(0xeb)](exports,a49_0x34c6d3(0xe5),{'value':!![]}),exports['loggerService']=exports[a49_0x34c6d3(0xd4)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x1e2eef=a49_0x34c6d3;this['logsDir']=path_1['default'][_0x1e2eef(0xdd)](process['cwd'](),_0x1e2eef(0xd8)),this[_0x1e2eef(0xce)]();}[a49_0x34c6d3(0xce)](){const _0x293b0e=a49_0x34c6d3;!fs_1['default'][_0x293b0e(0xef)](this['logsDir'])&&(fs_1[_0x293b0e(0xb9)][_0x293b0e(0xc5)](this[_0x293b0e(0xc6)],{'recursive':!![]}),console[_0x293b0e(0xe7)](_0x293b0e(0xbe)+this[_0x293b0e(0xc6)]));}['getLogFileName'](_0x17b2e6){const _0x2dca09=a49_0x34c6d3,_0x335882=new Date()[_0x2dca09(0xc3)]()[_0x2dca09(0xcd)]('T')[0x0];return path_1[_0x2dca09(0xb9)][_0x2dca09(0xdd)](this[_0x2dca09(0xc6)],_0x17b2e6+'_'+_0x335882+_0x2dca09(0xf6));}[a49_0x34c6d3(0xf1)](_0x5a23a9,_0x1f24a9){const _0x3431ae=a49_0x34c6d3;try{const _0x27a42c=new Date()[_0x3431ae(0xc3)](),_0x5422c9={'timestamp':_0x27a42c,..._0x1f24a9},_0x1f69ac=JSON[_0x3431ae(0xdc)](_0x5422c9)+'\x0a',_0x22c6c3=this[_0x3431ae(0xba)](_0x5a23a9);fs_1['default']['appendFileSync'](_0x22c6c3,_0x1f69ac,_0x3431ae(0xc1));}catch(_0x5027d4){console[_0x3431ae(0xb3)](_0x3431ae(0xf9)+_0x5a23a9+_0x3431ae(0xea),_0x5027d4);}}[a49_0x34c6d3(0xd1)](_0x399e40,_0x5865a0,_0x45692a,_0x4cfea5){const _0x43510f=a49_0x34c6d3;this[_0x43510f(0xf1)](_0x43510f(0xb8),{'type':'REQUEST','gateway':_0x399e40,'endpoint':_0x5865a0,'method':_0x45692a,'data':_0x4cfea5});}[a49_0x34c6d3(0xde)](_0x4a5a19,_0x25df69,_0x546929,_0x664692,_0xaceb36){const _0x3c8397=a49_0x34c6d3;this[_0x3c8397(0xf1)](_0x3c8397(0xf7),{'type':'RESPONSE','gateway':_0x4a5a19,'endpoint':_0x25df69,'status':_0x546929,'responseTime':_0xaceb36,'data':_0x664692});}['logWhiteDomainError'](_0xab54fe,_0x2360c1,_0x550229){const _0x3312b3=a49_0x34c6d3;this[_0x3312b3(0xf1)](_0x3312b3(0xb4),{'type':_0x3312b3(0xf8),'gateway':_0xab54fe,'endpoint':_0x2360c1,'error':_0x550229 instanceof Error?{'message':_0x550229[_0x3312b3(0xbc)],'stack':_0x550229[_0x3312b3(0xc9)]}:_0x550229});}['logWebhookReceived'](_0x3c4fe4,_0x31184b,_0x19a45d){const _0x3db958=a49_0x34c6d3;this[_0x3db958(0xf1)](_0x3db958(0xcf),{'type':_0x3db958(0xb7),'gateway':_0x3c4fe4,'headers':_0x19a45d,'data':_0x31184b});}[a49_0x34c6d3(0xd7)](_0xf0fa5b,_0x2f464a,_0x222dc4,_0x4f35f3,_0x6ab299){const _0x18baab=a49_0x34c6d3;this[_0x18baab(0xf1)](_0x18baab(0xf2),{'type':_0x18baab(0xe9),'gateway':_0xf0fa5b,'paymentId':_0x2f464a,'oldStatus':_0x222dc4,'newStatus':_0x4f35f3,'originalData':_0x6ab299});}[a49_0x34c6d3(0xe3)](_0x2de94b,_0x4593dc,_0x12032f){const _0x211f0f=a49_0x34c6d3;this[_0x211f0f(0xf1)]('webhooks_errors',{'type':_0x211f0f(0xc4),'gateway':_0x2de94b,'error':_0x4593dc instanceof Error?{'message':_0x4593dc['message'],'stack':_0x4593dc['stack']}:_0x4593dc,'originalData':_0x12032f});}['logCoinToPayStatus'](_0x5bd21b){const _0x38e729=a49_0x34c6d3;this['writeLog'](_0x38e729(0xdb),{'type':_0x38e729(0xc2),..._0x5bd21b});}[a49_0x34c6d3(0xd6)](_0x3596bf){this['writeLog']('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x3596bf});}[a49_0x34c6d3(0xdf)](_0x2aff3e,_0x3afda8,_0x38e09e,_0x434e6c,_0xaa355,_0x28e428){const _0x2e8788=a49_0x34c6d3;this[_0x2e8788(0xf1)](_0x2e8788(0xe1),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x2aff3e,'webhookUrl':_0x3afda8,'event':_0x38e09e,'status':_0x434e6c,'responseTime':_0xaa355,'payload':_0x28e428});}[a49_0x34c6d3(0xb1)](_0x2ea929,_0x59953d,_0x52d3b1,_0x59eea4,_0x292aeb){const _0x307258=a49_0x34c6d3;this[_0x307258(0xf1)](_0x307258(0xfa),{'type':_0x307258(0xfc),'shopId':_0x2ea929,'webhookUrl':_0x59953d,'event':_0x52d3b1,'error':_0x59eea4 instanceof Error?{'message':_0x59eea4[_0x307258(0xbc)],'stack':_0x59eea4[_0x307258(0xc9)]}:_0x59eea4,'payload':_0x292aeb});}[a49_0x34c6d3(0xcc)](_0x4d4779,_0x287455,_0xa6c9c7,_0x263c8f,_0x201101){const _0x31ffea=a49_0x34c6d3;this[_0x31ffea(0xf1)](_0x31ffea(0xe4),{'type':_0x31ffea(0xbb),'gateway':_0x4d4779,'paymentId':_0x287455,'shopId':_0xa6c9c7,'amount':_0x263c8f,'currency':_0x201101});}['logApiCall'](_0x7d4a0f,_0x3a6e62,_0x3873ee,_0x580e19,_0x10475e){const _0x48692e=a49_0x34c6d3;this[_0x48692e(0xf1)](_0x48692e(0xb2),{'type':'API_CALL','endpoint':_0x7d4a0f,'method':_0x3a6e62,'userId':_0x3873ee,'userRole':_0x580e19,'requestData':_0x10475e});}['getLogStats'](){const _0x887a92=a49_0x34c6d3;try{const _0xb7f136=fs_1['default'][_0x887a92(0xbd)](this['logsDir']),_0x465829=_0xb7f136[_0x887a92(0xe0)](_0x38d659=>_0x38d659['endsWith'](_0x887a92(0xf6))),_0x2f2c8c=[...new Set(_0x465829[_0x887a92(0xb6)](_0x4f5a16=>_0x4f5a16[_0x887a92(0xcd)]('_')[0x0]))],_0x22378c=_0x465829[_0x887a92(0xb6)](_0x1840c4=>{const _0x40b0ac=_0x887a92,_0x15c0eb=path_1[_0x40b0ac(0xb9)][_0x40b0ac(0xdd)](this[_0x40b0ac(0xc6)],_0x1840c4),_0x20575e=fs_1[_0x40b0ac(0xb9)][_0x40b0ac(0xf5)](_0x15c0eb),[_0x37b0e2,_0x3f8ba3]=_0x1840c4['replace'](_0x40b0ac(0xf6),'')[_0x40b0ac(0xcd)]('_');return{'type':_0x37b0e2,'date':_0x3f8ba3,'size':_0x20575e[_0x40b0ac(0xca)]};})['sort']((_0x47e58c,_0x1a9c1f)=>_0x1a9c1f[_0x887a92(0xd0)][_0x887a92(0xed)](_0x47e58c[_0x887a92(0xd0)]));return{'totalFiles':_0x465829['length'],'logTypes':_0x2f2c8c,'latestLogs':_0x22378c[_0x887a92(0xe8)](0x0,0xa)};}catch(_0x181f8f){return console['error'](_0x887a92(0xfb),_0x181f8f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x34c6d3(0xd5)](_0x36b73a=0x1e){const _0x41fb18=a49_0x34c6d3;try{const _0x5803ce=fs_1[_0x41fb18(0xb9)]['readdirSync'](this['logsDir']),_0x4d0398=new Date();_0x4d0398[_0x41fb18(0xd9)](_0x4d0398[_0x41fb18(0xc8)]()-_0x36b73a);let _0x394c24=0x0;_0x5803ce['forEach'](_0x2293bd=>{const _0x3433aa=_0x41fb18;if(!_0x2293bd['endsWith']('.log'))return;const _0x2a25bd=path_1[_0x3433aa(0xb9)][_0x3433aa(0xdd)](this['logsDir'],_0x2293bd),_0x15b3b2=fs_1['default'][_0x3433aa(0xf5)](_0x2a25bd);_0x15b3b2[_0x3433aa(0xf3)]<_0x4d0398&&(fs_1[_0x3433aa(0xb9)][_0x3433aa(0xd2)](_0x2a25bd),_0x394c24++,console[_0x3433aa(0xe7)](_0x3433aa(0xda)+_0x2293bd));}),console[_0x41fb18(0xe7)](_0x41fb18(0xee)+_0x394c24+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x36b73a+_0x41fb18(0xe6));}catch(_0x5a6d08){console[_0x41fb18(0xb3)]('Failed\x20to\x20clean\x20old\x20logs:',_0x5a6d08);}}}exports[a49_0x34c6d3(0xd4)]=LoggerService,exports[a49_0x34c6d3(0xe2)]=new LoggerService();function a49_0x6ce2(){const _0x140b68=['shop_webhooks_errors','Failed\x20to\x20get\x20log\x20stats:','SHOP_WEBHOOK_ERROR','logShopWebhookError','api_calls','error','white_domain_errors','15xmDvTW','map','WEBHOOK_RECEIVED','white_domain_requests','default','getLogFileName','PAYMENT_CREATED','message','readdirSync','📁\x20Created\x20logs\x20directory:\x20','42916DZhaxC','109180LwuYKL','utf8','COINTOPAY_STATUS_CHANGE','toISOString','WEBHOOK_ERROR','mkdirSync','logsDir','1050735pYLeSo','getDate','stack','size','18cSsjCS','logPaymentCreated','split','ensureLogsDirectory','webhooks_received','date','logWhiteDomainRequest','unlinkSync','959082xKNJie','LoggerService','cleanOldLogs','logCoinToPayError','logWebhookProcessed','logs','setDate','🗑️\x20Deleted\x20old\x20log\x20file:\x20','cointopay_status_changes','stringify','join','logWhiteDomainResponse','logShopWebhookSent','filter','shop_webhooks_sent','loggerService','logWebhookError','payments_created','__esModule','\x20days)','log','slice','WEBHOOK_PROCESSED','\x20log:','defineProperty','172396tLQpfL','localeCompare','🧹\x20Cleaned\x20','existsSync','507695IpsKpX','writeLog','webhooks_processed','mtime','1930072SVGZCh','statSync','.log','white_domain_responses','ERROR','Failed\x20to\x20write\x20'];a49_0x6ce2=function(){return _0x140b68;};return a49_0x6ce2();}