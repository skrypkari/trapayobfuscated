'use strict';function a53_0x3de8(_0x4897a8,_0x1f06a2){const _0x59242a=a53_0x5924();return a53_0x3de8=function(_0x3de8e0,_0x14c67b){_0x3de8e0=_0x3de8e0-0x11b;let _0x1d617c=_0x59242a[_0x3de8e0];return _0x1d617c;},a53_0x3de8(_0x4897a8,_0x1f06a2);}const a53_0x57faff=a53_0x3de8;function a53_0x5924(){const _0x2861c1=['join','logWhiteDomainResponse','unlinkSync','logsDir','logCoinToPayError','WEBHOOK_ERROR','cwd','36uWhKZj','webhooks_processed','getLogStats','ERROR','log','api_calls','size','1784700TMvXrX','setDate','logApiCall','cointopay_status_changes','COINTOPAY_STATUS_CHANGE','logShopWebhookSent','date','__esModule','loggerService','stack','writeLog','shop_webhooks_errors','SHOP_WEBHOOK_SENT','split','stringify','readdirSync','logShopWebhookError','utf8','appendFileSync','payments_created','path','logWebhookReceived','WEBHOOK_RECEIVED','\x20log:','RESPONSE','defineProperty','slice','4618656uolKdo','.log','replace','10qhVZqh','getDate','logPaymentCreated','default','endsWith','SHOP_WEBHOOK_ERROR','PAYMENT_CREATED','2893009ejBkzr','statSync','🗑️\x20Deleted\x20old\x20log\x20file:\x20','9094qKiagM','LoggerService','white_domain_requests','error','7cUBhqL','message','12498728artsVk','🧹\x20Cleaned\x20','5PfyzVG','logWebhookError','shop_webhooks_sent','map','REQUEST','filter','localeCompare','toISOString','Failed\x20to\x20get\x20log\x20stats:','ensureLogsDirectory','length','logWhiteDomainError','597712ZiDnSU','logCoinToPayStatus','API_CALL','1189320IdymoD'];a53_0x5924=function(){return _0x2861c1;};return a53_0x5924();}(function(_0x29e719,_0x2cd360){const _0xf91593=a53_0x3de8,_0x566187=_0x29e719();while(!![]){try{const _0x16a263=-parseInt(_0xf91593(0x146))/0x1*(-parseInt(_0xf91593(0x142))/0x2)+parseInt(_0xf91593(0x159))/0x3+parseInt(_0xf91593(0x168))/0x4*(-parseInt(_0xf91593(0x14a))/0x5)+-parseInt(_0xf91593(0x135))/0x6+parseInt(_0xf91593(0x13f))/0x7+-parseInt(_0xf91593(0x156))/0x8*(parseInt(_0xf91593(0x161))/0x9)+parseInt(_0xf91593(0x138))/0xa*(parseInt(_0xf91593(0x148))/0xb);if(_0x16a263===_0x2cd360)break;else _0x566187['push'](_0x566187['shift']());}catch(_0x9c2b9b){_0x566187['push'](_0x566187['shift']());}}}(a53_0x5924,0x71095));var __importDefault=this&&this['__importDefault']||function(_0x54de78){const _0x3f590d=a53_0x3de8;return _0x54de78&&_0x54de78[_0x3f590d(0x121)]?_0x54de78:{'default':_0x54de78};};Object[a53_0x57faff(0x133)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a53_0x57faff(0x143)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x57faff(0x12e)));class LoggerService{constructor(){const _0x4469be=a53_0x57faff;this[_0x4469be(0x15d)]=path_1['default'][_0x4469be(0x15a)](process[_0x4469be(0x160)](),'logs'),this['ensureLogsDirectory']();}[a53_0x57faff(0x153)](){const _0x3cb18e=a53_0x57faff;!fs_1['default']['existsSync'](this[_0x3cb18e(0x15d)])&&(fs_1['default']['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x3cb18e(0x165)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x3cb18e(0x15d)]));}['getLogFileName'](_0x4eace4){const _0x14679a=a53_0x57faff,_0xd946b3=new Date()[_0x14679a(0x151)]()[_0x14679a(0x127)]('T')[0x0];return path_1['default']['join'](this[_0x14679a(0x15d)],_0x4eace4+'_'+_0xd946b3+_0x14679a(0x136));}[a53_0x57faff(0x124)](_0x5ad246,_0x378b50){const _0x4657cb=a53_0x57faff;try{const _0x1a6b68=new Date()['toISOString'](),_0x2973f1={'timestamp':_0x1a6b68,..._0x378b50},_0x5027f6=JSON[_0x4657cb(0x128)](_0x2973f1)+'\x0a',_0x29ee41=this['getLogFileName'](_0x5ad246);fs_1[_0x4657cb(0x13b)][_0x4657cb(0x12c)](_0x29ee41,_0x5027f6,_0x4657cb(0x12b));}catch(_0x33d615){console['error']('Failed\x20to\x20write\x20'+_0x5ad246+_0x4657cb(0x131),_0x33d615);}}['logWhiteDomainRequest'](_0x53adcf,_0x2320f7,_0x42d445,_0x388b7f){const _0x3ed513=a53_0x57faff;this[_0x3ed513(0x124)](_0x3ed513(0x144),{'type':_0x3ed513(0x14e),'gateway':_0x53adcf,'endpoint':_0x2320f7,'method':_0x42d445,'data':_0x388b7f});}[a53_0x57faff(0x15b)](_0x114706,_0x4bbf4b,_0x841191,_0x4b77f3,_0xf9706c){const _0x834879=a53_0x57faff;this[_0x834879(0x124)]('white_domain_responses',{'type':_0x834879(0x132),'gateway':_0x114706,'endpoint':_0x4bbf4b,'status':_0x841191,'responseTime':_0xf9706c,'data':_0x4b77f3});}[a53_0x57faff(0x155)](_0x1cc1fa,_0x455cfc,_0x1454e1){const _0x46530d=a53_0x57faff;this[_0x46530d(0x124)]('white_domain_errors',{'type':_0x46530d(0x164),'gateway':_0x1cc1fa,'endpoint':_0x455cfc,'error':_0x1454e1 instanceof Error?{'message':_0x1454e1[_0x46530d(0x147)],'stack':_0x1454e1[_0x46530d(0x123)]}:_0x1454e1});}[a53_0x57faff(0x12f)](_0xd4e31b,_0x4331e9,_0x15f3cf){const _0x331faf=a53_0x57faff;this[_0x331faf(0x124)]('webhooks_received',{'type':_0x331faf(0x130),'gateway':_0xd4e31b,'headers':_0x15f3cf,'data':_0x4331e9});}['logWebhookProcessed'](_0x29897f,_0x535c7b,_0x3f97fa,_0x195047,_0x292c72){const _0x15841e=a53_0x57faff;this[_0x15841e(0x124)](_0x15841e(0x162),{'type':'WEBHOOK_PROCESSED','gateway':_0x29897f,'paymentId':_0x535c7b,'oldStatus':_0x3f97fa,'newStatus':_0x195047,'originalData':_0x292c72});}[a53_0x57faff(0x14b)](_0x6ebc81,_0x128d85,_0x38e355){const _0x1d03bf=a53_0x57faff;this[_0x1d03bf(0x124)]('webhooks_errors',{'type':_0x1d03bf(0x15f),'gateway':_0x6ebc81,'error':_0x128d85 instanceof Error?{'message':_0x128d85['message'],'stack':_0x128d85[_0x1d03bf(0x123)]}:_0x128d85,'originalData':_0x38e355});}[a53_0x57faff(0x157)](_0x2df770){const _0x1ba47c=a53_0x57faff;this[_0x1ba47c(0x124)](_0x1ba47c(0x11d),{'type':_0x1ba47c(0x11e),..._0x2df770});}[a53_0x57faff(0x15e)](_0x1f0467){const _0x52049b=a53_0x57faff;this[_0x52049b(0x124)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x1f0467});}[a53_0x57faff(0x11f)](_0x30ca98,_0x114479,_0x496752,_0x3052c2,_0x209d9b,_0x112a0e){const _0x42212f=a53_0x57faff;this['writeLog'](_0x42212f(0x14c),{'type':_0x42212f(0x126),'shopId':_0x30ca98,'webhookUrl':_0x114479,'event':_0x496752,'status':_0x3052c2,'responseTime':_0x209d9b,'payload':_0x112a0e});}[a53_0x57faff(0x12a)](_0x4799f8,_0x4b6654,_0x4693b0,_0x37018d,_0x40e8d6){const _0x7185cb=a53_0x57faff;this['writeLog'](_0x7185cb(0x125),{'type':_0x7185cb(0x13d),'shopId':_0x4799f8,'webhookUrl':_0x4b6654,'event':_0x4693b0,'error':_0x37018d instanceof Error?{'message':_0x37018d[_0x7185cb(0x147)],'stack':_0x37018d[_0x7185cb(0x123)]}:_0x37018d,'payload':_0x40e8d6});}[a53_0x57faff(0x13a)](_0xa8f4b1,_0xa63e65,_0x34765b,_0x1eb0e1,_0x414466){const _0x90476e=a53_0x57faff;this['writeLog'](_0x90476e(0x12d),{'type':_0x90476e(0x13e),'gateway':_0xa8f4b1,'paymentId':_0xa63e65,'shopId':_0x34765b,'amount':_0x1eb0e1,'currency':_0x414466});}[a53_0x57faff(0x11c)](_0x3e6b84,_0xd1483,_0x3c90a9,_0x494a21,_0x300435){const _0x5c73a8=a53_0x57faff;this[_0x5c73a8(0x124)](_0x5c73a8(0x166),{'type':_0x5c73a8(0x158),'endpoint':_0x3e6b84,'method':_0xd1483,'userId':_0x3c90a9,'userRole':_0x494a21,'requestData':_0x300435});}[a53_0x57faff(0x163)](){const _0x49e8cf=a53_0x57faff;try{const _0x53ad46=fs_1['default']['readdirSync'](this[_0x49e8cf(0x15d)]),_0x3ca0f5=_0x53ad46[_0x49e8cf(0x14f)](_0x5bb53d=>_0x5bb53d[_0x49e8cf(0x13c)](_0x49e8cf(0x136))),_0x3a27a7=[...new Set(_0x3ca0f5['map'](_0x24416b=>_0x24416b[_0x49e8cf(0x127)]('_')[0x0]))],_0x287c48=_0x3ca0f5[_0x49e8cf(0x14d)](_0x4a688a=>{const _0x391293=_0x49e8cf,_0x500931=path_1['default']['join'](this['logsDir'],_0x4a688a),_0x2ada86=fs_1[_0x391293(0x13b)][_0x391293(0x140)](_0x500931),[_0x5b48fa,_0x2d987d]=_0x4a688a[_0x391293(0x137)](_0x391293(0x136),'')[_0x391293(0x127)]('_');return{'type':_0x5b48fa,'date':_0x2d987d,'size':_0x2ada86[_0x391293(0x167)]};})['sort']((_0x17902e,_0x51d986)=>_0x51d986[_0x49e8cf(0x120)][_0x49e8cf(0x150)](_0x17902e[_0x49e8cf(0x120)]));return{'totalFiles':_0x3ca0f5[_0x49e8cf(0x154)],'logTypes':_0x3a27a7,'latestLogs':_0x287c48[_0x49e8cf(0x134)](0x0,0xa)};}catch(_0x4a3fb4){return console[_0x49e8cf(0x145)](_0x49e8cf(0x152),_0x4a3fb4),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x70debf=0x1e){const _0x4577a2=a53_0x57faff;try{const _0x330b5c=fs_1[_0x4577a2(0x13b)][_0x4577a2(0x129)](this['logsDir']),_0x4b5cf6=new Date();_0x4b5cf6[_0x4577a2(0x11b)](_0x4b5cf6[_0x4577a2(0x139)]()-_0x70debf);let _0x1f40ca=0x0;_0x330b5c['forEach'](_0x4a5a71=>{const _0x5c2599=_0x4577a2;if(!_0x4a5a71[_0x5c2599(0x13c)](_0x5c2599(0x136)))return;const _0x16b805=path_1[_0x5c2599(0x13b)]['join'](this[_0x5c2599(0x15d)],_0x4a5a71),_0x28a546=fs_1['default'][_0x5c2599(0x140)](_0x16b805);_0x28a546['mtime']<_0x4b5cf6&&(fs_1[_0x5c2599(0x13b)][_0x5c2599(0x15c)](_0x16b805),_0x1f40ca++,console[_0x5c2599(0x165)](_0x5c2599(0x141)+_0x4a5a71));}),console[_0x4577a2(0x165)](_0x4577a2(0x149)+_0x1f40ca+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x70debf+'\x20days)');}catch(_0x33e53b){console[_0x4577a2(0x145)]('Failed\x20to\x20clean\x20old\x20logs:',_0x33e53b);}}}exports[a53_0x57faff(0x143)]=LoggerService,exports[a53_0x57faff(0x122)]=new LoggerService();