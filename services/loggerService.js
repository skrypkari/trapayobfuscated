'use strict';function a53_0x8acb(_0x10ff1a,_0x587c63){const _0x587b09=a53_0x587b();return a53_0x8acb=function(_0x8acbc6,_0x869697){_0x8acbc6=_0x8acbc6-0x199;let _0x46c921=_0x587b09[_0x8acbc6];return _0x46c921;},a53_0x8acb(_0x10ff1a,_0x587c63);}const a53_0x19659d=a53_0x8acb;function a53_0x587b(){const _0x5388f7=['1252XwoVBw','logApiCall','localeCompare','921666ePYyea','stack','1420552ZuidJN','default','replace','getLogFileName','logShopWebhookSent','logWhiteDomainRequest','WEBHOOK_ERROR','webhooks_received','9543xHayBU','.log','white_domain_requests','join','🧹\x20Cleaned\x20','__esModule','map','\x20log:','mtime','readdirSync','logs','logWhiteDomainResponse','cwd','__importDefault','Failed\x20to\x20write\x20','forEach','mkdirSync','shop_webhooks_sent','slice','path','white_domain_errors','loggerService','logWebhookProcessed','19163331kKxRkE','payments_created','date','LoggerService','webhooks_processed','logPaymentCreated','defineProperty','error','webhooks_errors','3217400GyAwKa','existsSync','API_CALL','toISOString','unlinkSync','api_calls','message','size','log','RESPONSE','logsDir','Failed\x20to\x20clean\x20old\x20logs:','endsWith','284200weSCUm','24xDlUjq','logShopWebhookError','getDate','\x20days)','appendFileSync','statSync','PAYMENT_CREATED','writeLog','cointopay_errors','ERROR','cointopay_status_changes','stringify','white_domain_responses','cleanOldLogs','WEBHOOK_RECEIVED','COINTOPAY_ERROR','utf8','split','605717HUcKPT','getLogStats','SHOP_WEBHOOK_SENT'];a53_0x587b=function(){return _0x5388f7;};return a53_0x587b();}(function(_0x4945a5,_0x3f4266){const _0xa0365d=a53_0x8acb,_0x336f66=_0x4945a5();while(!![]){try{const _0x30b542=-parseInt(_0xa0365d(0x1a8))/0x1+parseInt(_0xa0365d(0x1aa))/0x2+parseInt(_0xa0365d(0x1b2))/0x3*(-parseInt(_0xa0365d(0x1a5))/0x4)+-parseInt(_0xa0365d(0x1d2))/0x5+-parseInt(_0xa0365d(0x1e0))/0x6*(-parseInt(_0xa0365d(0x1a2))/0x7)+-parseInt(_0xa0365d(0x1df))/0x8+parseInt(_0xa0365d(0x1c9))/0x9;if(_0x30b542===_0x3f4266)break;else _0x336f66['push'](_0x336f66['shift']());}catch(_0x562248){_0x336f66['push'](_0x336f66['shift']());}}}(a53_0x587b,0x8fe17));var __importDefault=this&&this[a53_0x19659d(0x1bf)]||function(_0x3e8e86){const _0x256bc6=a53_0x19659d;return _0x3e8e86&&_0x3e8e86[_0x256bc6(0x1b7)]?_0x3e8e86:{'default':_0x3e8e86};};Object[a53_0x19659d(0x1cf)](exports,a53_0x19659d(0x1b7),{'value':!![]}),exports[a53_0x19659d(0x1c7)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x19659d(0x1c5)));class LoggerService{constructor(){const _0x40713a=a53_0x19659d;this[_0x40713a(0x1dc)]=path_1[_0x40713a(0x1ab)][_0x40713a(0x1b5)](process[_0x40713a(0x1be)](),_0x40713a(0x1bc)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0x5dab1f=a53_0x19659d;!fs_1[_0x5dab1f(0x1ab)][_0x5dab1f(0x1d3)](this['logsDir'])&&(fs_1[_0x5dab1f(0x1ab)][_0x5dab1f(0x1c2)](this[_0x5dab1f(0x1dc)],{'recursive':!![]}),console[_0x5dab1f(0x1da)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x5dab1f(0x1dc)]));}[a53_0x19659d(0x1ad)](_0xed138d){const _0x4fc61c=a53_0x19659d,_0x255672=new Date()[_0x4fc61c(0x1d5)]()[_0x4fc61c(0x1a1)]('T')[0x0];return path_1['default'][_0x4fc61c(0x1b5)](this['logsDir'],_0xed138d+'_'+_0x255672+_0x4fc61c(0x1b3));}[a53_0x19659d(0x1e7)](_0x50d612,_0x17c02c){const _0x59fffe=a53_0x19659d;try{const _0x4ee201=new Date()['toISOString'](),_0x44caaf={'timestamp':_0x4ee201,..._0x17c02c},_0x1c8c03=JSON[_0x59fffe(0x19b)](_0x44caaf)+'\x0a',_0xca6e44=this[_0x59fffe(0x1ad)](_0x50d612);fs_1['default'][_0x59fffe(0x1e4)](_0xca6e44,_0x1c8c03,_0x59fffe(0x1a0));}catch(_0x4db30d){console[_0x59fffe(0x1d0)](_0x59fffe(0x1c0)+_0x50d612+_0x59fffe(0x1b9),_0x4db30d);}}[a53_0x19659d(0x1af)](_0x4db39a,_0x4e581e,_0x4ba973,_0x421f1a){const _0xedbde2=a53_0x19659d;this['writeLog'](_0xedbde2(0x1b4),{'type':'REQUEST','gateway':_0x4db39a,'endpoint':_0x4e581e,'method':_0x4ba973,'data':_0x421f1a});}[a53_0x19659d(0x1bd)](_0x29ffc5,_0x5364a0,_0x1fbdf9,_0x5bbb14,_0x3bad6b){const _0x5ae75e=a53_0x19659d;this[_0x5ae75e(0x1e7)](_0x5ae75e(0x19c),{'type':_0x5ae75e(0x1db),'gateway':_0x29ffc5,'endpoint':_0x5364a0,'status':_0x1fbdf9,'responseTime':_0x3bad6b,'data':_0x5bbb14});}['logWhiteDomainError'](_0x2551f5,_0x1b2b32,_0x4d0031){const _0x5735b9=a53_0x19659d;this[_0x5735b9(0x1e7)](_0x5735b9(0x1c6),{'type':_0x5735b9(0x199),'gateway':_0x2551f5,'endpoint':_0x1b2b32,'error':_0x4d0031 instanceof Error?{'message':_0x4d0031[_0x5735b9(0x1d8)],'stack':_0x4d0031[_0x5735b9(0x1a9)]}:_0x4d0031});}['logWebhookReceived'](_0x2bf8af,_0x2a7a7,_0x336b60){const _0x37d8fa=a53_0x19659d;this[_0x37d8fa(0x1e7)](_0x37d8fa(0x1b1),{'type':_0x37d8fa(0x19e),'gateway':_0x2bf8af,'headers':_0x336b60,'data':_0x2a7a7});}[a53_0x19659d(0x1c8)](_0x4d32c1,_0x557249,_0x1404e1,_0x563ec6,_0x584882){const _0x23d081=a53_0x19659d;this['writeLog'](_0x23d081(0x1cd),{'type':'WEBHOOK_PROCESSED','gateway':_0x4d32c1,'paymentId':_0x557249,'oldStatus':_0x1404e1,'newStatus':_0x563ec6,'originalData':_0x584882});}['logWebhookError'](_0x2253f1,_0x35c590,_0x3ffec7){const _0x5e2f2c=a53_0x19659d;this[_0x5e2f2c(0x1e7)](_0x5e2f2c(0x1d1),{'type':_0x5e2f2c(0x1b0),'gateway':_0x2253f1,'error':_0x35c590 instanceof Error?{'message':_0x35c590[_0x5e2f2c(0x1d8)],'stack':_0x35c590['stack']}:_0x35c590,'originalData':_0x3ffec7});}['logCoinToPayStatus'](_0x4c80c6){const _0x3c4c2c=a53_0x19659d;this[_0x3c4c2c(0x1e7)](_0x3c4c2c(0x19a),{'type':'COINTOPAY_STATUS_CHANGE',..._0x4c80c6});}['logCoinToPayError'](_0x2cc04e){const _0x2d9fb7=a53_0x19659d;this[_0x2d9fb7(0x1e7)](_0x2d9fb7(0x1e8),{'type':_0x2d9fb7(0x19f),..._0x2cc04e});}[a53_0x19659d(0x1ae)](_0x4242bb,_0xe3158,_0x2953d8,_0x32fa4e,_0x16c17c,_0xb28f56){const _0x3bc785=a53_0x19659d;this[_0x3bc785(0x1e7)](_0x3bc785(0x1c3),{'type':_0x3bc785(0x1a4),'shopId':_0x4242bb,'webhookUrl':_0xe3158,'event':_0x2953d8,'status':_0x32fa4e,'responseTime':_0x16c17c,'payload':_0xb28f56});}[a53_0x19659d(0x1e1)](_0xa248c6,_0x5bf9b9,_0x283af7,_0x50f3b5,_0x548f50){const _0x245345=a53_0x19659d;this[_0x245345(0x1e7)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0xa248c6,'webhookUrl':_0x5bf9b9,'event':_0x283af7,'error':_0x50f3b5 instanceof Error?{'message':_0x50f3b5[_0x245345(0x1d8)],'stack':_0x50f3b5['stack']}:_0x50f3b5,'payload':_0x548f50});}[a53_0x19659d(0x1ce)](_0x8a316e,_0x4c6989,_0x4eb008,_0x445a50,_0x183122){const _0x3510f9=a53_0x19659d;this[_0x3510f9(0x1e7)](_0x3510f9(0x1ca),{'type':_0x3510f9(0x1e6),'gateway':_0x8a316e,'paymentId':_0x4c6989,'shopId':_0x4eb008,'amount':_0x445a50,'currency':_0x183122});}[a53_0x19659d(0x1a6)](_0x248643,_0x376d2f,_0x23ae00,_0x6133bd,_0x2e249b){const _0x4c9e62=a53_0x19659d;this[_0x4c9e62(0x1e7)](_0x4c9e62(0x1d7),{'type':_0x4c9e62(0x1d4),'endpoint':_0x248643,'method':_0x376d2f,'userId':_0x23ae00,'userRole':_0x6133bd,'requestData':_0x2e249b});}[a53_0x19659d(0x1a3)](){const _0x4f455d=a53_0x19659d;try{const _0x259633=fs_1['default'][_0x4f455d(0x1bb)](this[_0x4f455d(0x1dc)]),_0x1dc9d8=_0x259633['filter'](_0xc5d7da=>_0xc5d7da[_0x4f455d(0x1de)](_0x4f455d(0x1b3))),_0x6bde58=[...new Set(_0x1dc9d8[_0x4f455d(0x1b8)](_0x171c83=>_0x171c83[_0x4f455d(0x1a1)]('_')[0x0]))],_0xfc1875=_0x1dc9d8[_0x4f455d(0x1b8)](_0x18ad00=>{const _0x57c367=_0x4f455d,_0x1b415d=path_1[_0x57c367(0x1ab)][_0x57c367(0x1b5)](this[_0x57c367(0x1dc)],_0x18ad00),_0x563cb8=fs_1[_0x57c367(0x1ab)][_0x57c367(0x1e5)](_0x1b415d),[_0x52e1e0,_0x54707c]=_0x18ad00[_0x57c367(0x1ac)](_0x57c367(0x1b3),'')[_0x57c367(0x1a1)]('_');return{'type':_0x52e1e0,'date':_0x54707c,'size':_0x563cb8[_0x57c367(0x1d9)]};})['sort']((_0x1195e8,_0x218b6c)=>_0x218b6c['date'][_0x4f455d(0x1a7)](_0x1195e8[_0x4f455d(0x1cb)]));return{'totalFiles':_0x1dc9d8['length'],'logTypes':_0x6bde58,'latestLogs':_0xfc1875[_0x4f455d(0x1c4)](0x0,0xa)};}catch(_0x2a01ee){return console[_0x4f455d(0x1d0)]('Failed\x20to\x20get\x20log\x20stats:',_0x2a01ee),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x19659d(0x19d)](_0x4e0c08=0x1e){const _0x40b2df=a53_0x19659d;try{const _0x162a8a=fs_1[_0x40b2df(0x1ab)][_0x40b2df(0x1bb)](this[_0x40b2df(0x1dc)]),_0x4bfb51=new Date();_0x4bfb51['setDate'](_0x4bfb51[_0x40b2df(0x1e2)]()-_0x4e0c08);let _0x5afe23=0x0;_0x162a8a[_0x40b2df(0x1c1)](_0x2ccaf5=>{const _0x39bbd8=_0x40b2df;if(!_0x2ccaf5[_0x39bbd8(0x1de)](_0x39bbd8(0x1b3)))return;const _0x2a8fad=path_1[_0x39bbd8(0x1ab)][_0x39bbd8(0x1b5)](this['logsDir'],_0x2ccaf5),_0x14166a=fs_1['default']['statSync'](_0x2a8fad);_0x14166a[_0x39bbd8(0x1ba)]<_0x4bfb51&&(fs_1['default'][_0x39bbd8(0x1d6)](_0x2a8fad),_0x5afe23++,console[_0x39bbd8(0x1da)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x2ccaf5));}),console['log'](_0x40b2df(0x1b6)+_0x5afe23+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x4e0c08+_0x40b2df(0x1e3));}catch(_0x11bf17){console[_0x40b2df(0x1d0)](_0x40b2df(0x1dd),_0x11bf17);}}}exports[a53_0x19659d(0x1cc)]=LoggerService,exports[a53_0x19659d(0x1c7)]=new LoggerService();