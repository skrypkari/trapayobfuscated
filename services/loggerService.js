'use strict';function a49_0xb629(_0x102498,_0x4e6657){const _0x112975=a49_0x1129();return a49_0xb629=function(_0xb629e9,_0x54d7bb){_0xb629e9=_0xb629e9-0xd2;let _0x39da89=_0x112975[_0xb629e9];return _0x39da89;},a49_0xb629(_0x102498,_0x4e6657);}const a49_0x2731de=a49_0xb629;(function(_0x14df84,_0x136ae0){const _0x407288=a49_0xb629,_0x40f55c=_0x14df84();while(!![]){try{const _0x125a52=parseInt(_0x407288(0x112))/0x1+parseInt(_0x407288(0x10b))/0x2*(-parseInt(_0x407288(0xfe))/0x3)+parseInt(_0x407288(0xf7))/0x4*(parseInt(_0x407288(0x10c))/0x5)+-parseInt(_0x407288(0xf1))/0x6*(-parseInt(_0x407288(0xd9))/0x7)+-parseInt(_0x407288(0x11d))/0x8*(-parseInt(_0x407288(0x124))/0x9)+-parseInt(_0x407288(0xfc))/0xa*(-parseInt(_0x407288(0xe1))/0xb)+-parseInt(_0x407288(0x104))/0xc;if(_0x125a52===_0x136ae0)break;else _0x40f55c['push'](_0x40f55c['shift']());}catch(_0x52bfe9){_0x40f55c['push'](_0x40f55c['shift']());}}}(a49_0x1129,0x661d7));var __importDefault=this&&this[a49_0x2731de(0x10e)]||function(_0x3afa0d){const _0x16f0c1=a49_0x2731de;return _0x3afa0d&&_0x3afa0d[_0x16f0c1(0xff)]?_0x3afa0d:{'default':_0x3afa0d};};function a49_0x1129(){const _0x27cea6=['2991882FprvDh','endsWith','logWhiteDomainRequest','replace','cointopay_status_changes','split','103120GNXwWU','existsSync','filter','stringify','WEBHOOK_RECEIVED','66610oOcWEF','cointopay_errors','6KRdhSN','__esModule','toISOString','utf8','webhooks_received','COINTOPAY_ERROR','14876640yTYLBG','logShopWebhookError','writeLog','LoggerService','getLogFileName','logWebhookReceived','map','252428XqqIMK','5JIABke','defineProperty','__importDefault','logsDir','.log','cwd','246625nmlxMv','API_CALL','\x20log:','🧹\x20Cleaned\x20','Failed\x20to\x20write\x20','length','message','stack','WEBHOOK_ERROR','logWebhookProcessed','logShopWebhookSent','921496skCQta','🗑️\x20Deleted\x20old\x20log\x20file:\x20','size','logWhiteDomainResponse','date','ensureLogsDirectory','path','63cxWKRX','ERROR','statSync','setDate','white_domain_requests','mtime','shop_webhooks_sent','slice','COINTOPAY_STATUS_CHANGE','default','webhooks_processed','7nRherU','Failed\x20to\x20clean\x20old\x20logs:','getDate','REQUEST','readdirSync','logs','logWhiteDomainError','logCoinToPayError','550oMJlGV','logWebhookError','mkdirSync','getLogStats','localeCompare','error','log','\x20days)','join','SHOP_WEBHOOK_ERROR','loggerService','unlinkSync','forEach','white_domain_responses','logCoinToPayStatus','white_domain_errors'];a49_0x1129=function(){return _0x27cea6;};return a49_0x1129();}Object[a49_0x2731de(0x10d)](exports,'__esModule',{'value':!![]}),exports[a49_0x2731de(0xeb)]=exports[a49_0x2731de(0x107)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x2731de(0x123)));class LoggerService{constructor(){const _0x11aeef=a49_0x2731de;this[_0x11aeef(0x10f)]=path_1[_0x11aeef(0xd7)][_0x11aeef(0xe9)](process[_0x11aeef(0x111)](),_0x11aeef(0xde)),this[_0x11aeef(0x122)]();}[a49_0x2731de(0x122)](){const _0x6c48a9=a49_0x2731de;!fs_1[_0x6c48a9(0xd7)][_0x6c48a9(0xf8)](this[_0x6c48a9(0x10f)])&&(fs_1['default'][_0x6c48a9(0xe3)](this['logsDir'],{'recursive':!![]}),console[_0x6c48a9(0xe7)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x6c48a9(0x10f)]));}['getLogFileName'](_0x56734c){const _0x5953b8=a49_0x2731de,_0x524327=new Date()[_0x5953b8(0x100)]()['split']('T')[0x0];return path_1[_0x5953b8(0xd7)][_0x5953b8(0xe9)](this[_0x5953b8(0x10f)],_0x56734c+'_'+_0x524327+_0x5953b8(0x110));}['writeLog'](_0x3358b8,_0x507005){const _0x2ef538=a49_0x2731de;try{const _0x157e72=new Date()[_0x2ef538(0x100)](),_0x45ebe5={'timestamp':_0x157e72,..._0x507005},_0x13aceb=JSON[_0x2ef538(0xfa)](_0x45ebe5)+'\x0a',_0x450d37=this[_0x2ef538(0x108)](_0x3358b8);fs_1[_0x2ef538(0xd7)]['appendFileSync'](_0x450d37,_0x13aceb,_0x2ef538(0x101));}catch(_0x5b0c4b){console[_0x2ef538(0xe6)](_0x2ef538(0x116)+_0x3358b8+_0x2ef538(0x114),_0x5b0c4b);}}[a49_0x2731de(0xf3)](_0xcabe4e,_0x1f2e10,_0x47a794,_0x743aaf){const _0x5d4ad7=a49_0x2731de;this[_0x5d4ad7(0x106)](_0x5d4ad7(0xd2),{'type':_0x5d4ad7(0xdc),'gateway':_0xcabe4e,'endpoint':_0x1f2e10,'method':_0x47a794,'data':_0x743aaf});}[a49_0x2731de(0x120)](_0x348da0,_0x2fb701,_0x2cf1b7,_0x2d2d4b,_0x5c8518){const _0x4834de=a49_0x2731de;this[_0x4834de(0x106)](_0x4834de(0xee),{'type':'RESPONSE','gateway':_0x348da0,'endpoint':_0x2fb701,'status':_0x2cf1b7,'responseTime':_0x5c8518,'data':_0x2d2d4b});}[a49_0x2731de(0xdf)](_0x7d0708,_0x4385f0,_0xe8ec41){const _0x33c131=a49_0x2731de;this[_0x33c131(0x106)](_0x33c131(0xf0),{'type':_0x33c131(0x125),'gateway':_0x7d0708,'endpoint':_0x4385f0,'error':_0xe8ec41 instanceof Error?{'message':_0xe8ec41['message'],'stack':_0xe8ec41['stack']}:_0xe8ec41});}[a49_0x2731de(0x109)](_0x31b690,_0x26ce43,_0x53f7c4){const _0x4e1901=a49_0x2731de;this[_0x4e1901(0x106)](_0x4e1901(0x102),{'type':_0x4e1901(0xfb),'gateway':_0x31b690,'headers':_0x53f7c4,'data':_0x26ce43});}[a49_0x2731de(0x11b)](_0x1df578,_0x459d89,_0x43f98d,_0x5da410,_0x49555f){const _0x4669b8=a49_0x2731de;this[_0x4669b8(0x106)](_0x4669b8(0xd8),{'type':'WEBHOOK_PROCESSED','gateway':_0x1df578,'paymentId':_0x459d89,'oldStatus':_0x43f98d,'newStatus':_0x5da410,'originalData':_0x49555f});}[a49_0x2731de(0xe2)](_0x18a7eb,_0x766a43,_0x14072a){const _0x51ec88=a49_0x2731de;this[_0x51ec88(0x106)]('webhooks_errors',{'type':_0x51ec88(0x11a),'gateway':_0x18a7eb,'error':_0x766a43 instanceof Error?{'message':_0x766a43[_0x51ec88(0x118)],'stack':_0x766a43[_0x51ec88(0x119)]}:_0x766a43,'originalData':_0x14072a});}[a49_0x2731de(0xef)](_0x30245a){const _0x539432=a49_0x2731de;this[_0x539432(0x106)](_0x539432(0xf5),{'type':_0x539432(0xd6),..._0x30245a});}[a49_0x2731de(0xe0)](_0x3caf99){const _0x344d8f=a49_0x2731de;this['writeLog'](_0x344d8f(0xfd),{'type':_0x344d8f(0x103),..._0x3caf99});}[a49_0x2731de(0x11c)](_0xbf0c66,_0x1e7012,_0x5c8717,_0xeae1ce,_0x3b40d1,_0x7ef269){const _0xc0f312=a49_0x2731de;this[_0xc0f312(0x106)](_0xc0f312(0xd4),{'type':'SHOP_WEBHOOK_SENT','shopId':_0xbf0c66,'webhookUrl':_0x1e7012,'event':_0x5c8717,'status':_0xeae1ce,'responseTime':_0x3b40d1,'payload':_0x7ef269});}[a49_0x2731de(0x105)](_0x456ec6,_0x43bd94,_0xd216c2,_0x20d7a4,_0x4e1702){const _0x45b222=a49_0x2731de;this[_0x45b222(0x106)]('shop_webhooks_errors',{'type':_0x45b222(0xea),'shopId':_0x456ec6,'webhookUrl':_0x43bd94,'event':_0xd216c2,'error':_0x20d7a4 instanceof Error?{'message':_0x20d7a4[_0x45b222(0x118)],'stack':_0x20d7a4[_0x45b222(0x119)]}:_0x20d7a4,'payload':_0x4e1702});}['logPaymentCreated'](_0x58c919,_0x3d3609,_0x22b5ac,_0x291ac1,_0x45b0dd){const _0x1e0831=a49_0x2731de;this[_0x1e0831(0x106)]('payments_created',{'type':'PAYMENT_CREATED','gateway':_0x58c919,'paymentId':_0x3d3609,'shopId':_0x22b5ac,'amount':_0x291ac1,'currency':_0x45b0dd});}['logApiCall'](_0x21d74f,_0x54fb39,_0x16076e,_0x17b53b,_0x1e946d){const _0x2f06c8=a49_0x2731de;this[_0x2f06c8(0x106)]('api_calls',{'type':_0x2f06c8(0x113),'endpoint':_0x21d74f,'method':_0x54fb39,'userId':_0x16076e,'userRole':_0x17b53b,'requestData':_0x1e946d});}[a49_0x2731de(0xe4)](){const _0x2a0d8e=a49_0x2731de;try{const _0x30ccb8=fs_1[_0x2a0d8e(0xd7)][_0x2a0d8e(0xdd)](this[_0x2a0d8e(0x10f)]),_0x567bde=_0x30ccb8[_0x2a0d8e(0xf9)](_0x4b890c=>_0x4b890c[_0x2a0d8e(0xf2)](_0x2a0d8e(0x110))),_0x172e99=[...new Set(_0x567bde[_0x2a0d8e(0x10a)](_0x163128=>_0x163128['split']('_')[0x0]))],_0x48cfae=_0x567bde['map'](_0x19905b=>{const _0x59e077=_0x2a0d8e,_0x1a2030=path_1[_0x59e077(0xd7)][_0x59e077(0xe9)](this[_0x59e077(0x10f)],_0x19905b),_0xd48d94=fs_1['default'][_0x59e077(0x126)](_0x1a2030),[_0x3bbf39,_0x409a16]=_0x19905b[_0x59e077(0xf4)](_0x59e077(0x110),'')[_0x59e077(0xf6)]('_');return{'type':_0x3bbf39,'date':_0x409a16,'size':_0xd48d94[_0x59e077(0x11f)]};})['sort']((_0x2f07e8,_0x2bc782)=>_0x2bc782['date'][_0x2a0d8e(0xe5)](_0x2f07e8[_0x2a0d8e(0x121)]));return{'totalFiles':_0x567bde[_0x2a0d8e(0x117)],'logTypes':_0x172e99,'latestLogs':_0x48cfae[_0x2a0d8e(0xd5)](0x0,0xa)};}catch(_0x1e7d06){return console[_0x2a0d8e(0xe6)]('Failed\x20to\x20get\x20log\x20stats:',_0x1e7d06),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x54981e=0x1e){const _0x7f96bc=a49_0x2731de;try{const _0x58fd21=fs_1[_0x7f96bc(0xd7)]['readdirSync'](this[_0x7f96bc(0x10f)]),_0x5dc6d0=new Date();_0x5dc6d0[_0x7f96bc(0x127)](_0x5dc6d0[_0x7f96bc(0xdb)]()-_0x54981e);let _0x2352be=0x0;_0x58fd21[_0x7f96bc(0xed)](_0x5c6b4d=>{const _0x304467=_0x7f96bc;if(!_0x5c6b4d['endsWith'](_0x304467(0x110)))return;const _0x1bfaa1=path_1['default']['join'](this[_0x304467(0x10f)],_0x5c6b4d),_0x5ed359=fs_1[_0x304467(0xd7)][_0x304467(0x126)](_0x1bfaa1);_0x5ed359[_0x304467(0xd3)]<_0x5dc6d0&&(fs_1['default'][_0x304467(0xec)](_0x1bfaa1),_0x2352be++,console['log'](_0x304467(0x11e)+_0x5c6b4d));}),console[_0x7f96bc(0xe7)](_0x7f96bc(0x115)+_0x2352be+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x54981e+_0x7f96bc(0xe8));}catch(_0x480404){console[_0x7f96bc(0xe6)](_0x7f96bc(0xda),_0x480404);}}}exports['LoggerService']=LoggerService,exports[a49_0x2731de(0xeb)]=new LoggerService();