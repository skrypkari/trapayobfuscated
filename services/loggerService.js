'use strict';const a52_0x21dc4d=a52_0x1576;(function(_0x334791,_0x450f3f){const _0x7a87cf=a52_0x1576,_0x5bf6b5=_0x334791();while(!![]){try{const _0x4936fd=parseInt(_0x7a87cf(0x128))/0x1*(-parseInt(_0x7a87cf(0xea))/0x2)+parseInt(_0x7a87cf(0xf8))/0x3*(-parseInt(_0x7a87cf(0x11a))/0x4)+parseInt(_0x7a87cf(0x114))/0x5+-parseInt(_0x7a87cf(0x118))/0x6+parseInt(_0x7a87cf(0xf4))/0x7*(-parseInt(_0x7a87cf(0x133))/0x8)+parseInt(_0x7a87cf(0x12b))/0x9*(-parseInt(_0x7a87cf(0xf3))/0xa)+parseInt(_0x7a87cf(0x111))/0xb*(parseInt(_0x7a87cf(0x110))/0xc);if(_0x4936fd===_0x450f3f)break;else _0x5bf6b5['push'](_0x5bf6b5['shift']());}catch(_0x2a215){_0x5bf6b5['push'](_0x5bf6b5['shift']());}}}(a52_0x52f4,0xae462));var __importDefault=this&&this[a52_0x21dc4d(0x107)]||function(_0x2d4338){const _0x118f28=a52_0x21dc4d;return _0x2d4338&&_0x2d4338[_0x118f28(0xe1)]?_0x2d4338:{'default':_0x2d4338};};Object[a52_0x21dc4d(0x115)](exports,a52_0x21dc4d(0xe1),{'value':!![]}),exports[a52_0x21dc4d(0x11f)]=exports['LoggerService']=void 0x0;function a52_0x52f4(){const _0x4424b9=['__importDefault','SHOP_WEBHOOK_ERROR','logWhiteDomainResponse','ensureLogsDirectory','utf8','split','toISOString','payments_created','log','12CLnXlB','24032613wEKUdn','readdirSync','webhooks_errors','1777585rNtlLG','defineProperty','\x20log:','existsSync','3641070vOxtOG','logWebhookProcessed','752nAPNdD','endsWith','SHOP_WEBHOOK_SENT','date','api_calls','loggerService','cointopay_errors','API_CALL','webhooks_processed','unlinkSync','.log','Failed\x20to\x20write\x20','shop_webhooks_errors','filter','1vbpvvc','WEBHOOK_RECEIVED','logWhiteDomainRequest','387KIZaUl','getDate','logShopWebhookError','WEBHOOK_ERROR','setDate','📁\x20Created\x20logs\x20directory:\x20','logWebhookError','ERROR','8dtYmWT','COINTOPAY_STATUS_CHANGE','\x20old\x20log\x20files\x20(older\x20than\x20','white_domain_requests','\x20days)','forEach','REQUEST','__esModule','logCoinToPayError','message','localeCompare','getLogFileName','Failed\x20to\x20clean\x20old\x20logs:','🧹\x20Cleaned\x20','PAYMENT_CREATED','statSync','407746ckqJOJ','map','default','length','stack','Failed\x20to\x20get\x20log\x20stats:','cointopay_status_changes','logShopWebhookSent','slice','49150ZbSGms','3200225xYLJpP','getLogStats','logs','🗑️\x20Deleted\x20old\x20log\x20file:\x20','5541irtdDr','logWhiteDomainError','mkdirSync','LoggerService','error','logCoinToPayStatus','stringify','join','shop_webhooks_sent','cwd','logsDir','writeLog','replace','mtime','RESPONSE'];a52_0x52f4=function(){return _0x4424b9;};return a52_0x52f4();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x46575c=a52_0x21dc4d;this[_0x46575c(0x102)]=path_1[_0x46575c(0xec)][_0x46575c(0xff)](process[_0x46575c(0x101)](),_0x46575c(0xf6)),this[_0x46575c(0x10a)]();}[a52_0x21dc4d(0x10a)](){const _0x55512b=a52_0x21dc4d;!fs_1[_0x55512b(0xec)][_0x55512b(0x117)](this[_0x55512b(0x102)])&&(fs_1['default'][_0x55512b(0xfa)](this[_0x55512b(0x102)],{'recursive':!![]}),console['log'](_0x55512b(0x130)+this['logsDir']));}[a52_0x21dc4d(0xe5)](_0x252f79){const _0x4eb722=a52_0x21dc4d,_0x43f441=new Date()[_0x4eb722(0x10d)]()[_0x4eb722(0x10c)]('T')[0x0];return path_1['default'][_0x4eb722(0xff)](this[_0x4eb722(0x102)],_0x252f79+'_'+_0x43f441+'.log');}[a52_0x21dc4d(0x103)](_0x18527a,_0x1bde6f){const _0x1df434=a52_0x21dc4d;try{const _0xb5d7ee=new Date()[_0x1df434(0x10d)](),_0x4ed55e={'timestamp':_0xb5d7ee,..._0x1bde6f},_0x191469=JSON[_0x1df434(0xfe)](_0x4ed55e)+'\x0a',_0x2b739c=this['getLogFileName'](_0x18527a);fs_1[_0x1df434(0xec)]['appendFileSync'](_0x2b739c,_0x191469,_0x1df434(0x10b));}catch(_0x55ec67){console[_0x1df434(0xfc)](_0x1df434(0x125)+_0x18527a+_0x1df434(0x116),_0x55ec67);}}[a52_0x21dc4d(0x12a)](_0x2ebdbb,_0x48dd26,_0x20bd84,_0x25d8a5){const _0x1a7f44=a52_0x21dc4d;this[_0x1a7f44(0x103)](_0x1a7f44(0x136),{'type':_0x1a7f44(0xe0),'gateway':_0x2ebdbb,'endpoint':_0x48dd26,'method':_0x20bd84,'data':_0x25d8a5});}[a52_0x21dc4d(0x109)](_0x5e88aa,_0xf55150,_0x3fbba2,_0x102669,_0x116fdd){const _0x5bbdd2=a52_0x21dc4d;this[_0x5bbdd2(0x103)]('white_domain_responses',{'type':_0x5bbdd2(0x106),'gateway':_0x5e88aa,'endpoint':_0xf55150,'status':_0x3fbba2,'responseTime':_0x116fdd,'data':_0x102669});}[a52_0x21dc4d(0xf9)](_0x215cd9,_0x36f5bf,_0x5726c1){const _0x418a01=a52_0x21dc4d;this['writeLog']('white_domain_errors',{'type':_0x418a01(0x132),'gateway':_0x215cd9,'endpoint':_0x36f5bf,'error':_0x5726c1 instanceof Error?{'message':_0x5726c1[_0x418a01(0xe3)],'stack':_0x5726c1[_0x418a01(0xee)]}:_0x5726c1});}['logWebhookReceived'](_0x4f183a,_0x577173,_0xdc281f){const _0x4a56e7=a52_0x21dc4d;this[_0x4a56e7(0x103)]('webhooks_received',{'type':_0x4a56e7(0x129),'gateway':_0x4f183a,'headers':_0xdc281f,'data':_0x577173});}[a52_0x21dc4d(0x119)](_0x2a3321,_0x255c58,_0x659c2a,_0x1f21f1,_0x265d37){const _0x48e632=a52_0x21dc4d;this[_0x48e632(0x103)](_0x48e632(0x122),{'type':'WEBHOOK_PROCESSED','gateway':_0x2a3321,'paymentId':_0x255c58,'oldStatus':_0x659c2a,'newStatus':_0x1f21f1,'originalData':_0x265d37});}[a52_0x21dc4d(0x131)](_0x30fb85,_0x41ed0f,_0xb03732){const _0x4090c0=a52_0x21dc4d;this[_0x4090c0(0x103)](_0x4090c0(0x113),{'type':_0x4090c0(0x12e),'gateway':_0x30fb85,'error':_0x41ed0f instanceof Error?{'message':_0x41ed0f['message'],'stack':_0x41ed0f[_0x4090c0(0xee)]}:_0x41ed0f,'originalData':_0xb03732});}[a52_0x21dc4d(0xfd)](_0x5b2da4){const _0x333c46=a52_0x21dc4d;this[_0x333c46(0x103)](_0x333c46(0xf0),{'type':_0x333c46(0x134),..._0x5b2da4});}[a52_0x21dc4d(0xe2)](_0x1c385e){const _0x537c3c=a52_0x21dc4d;this['writeLog'](_0x537c3c(0x120),{'type':'COINTOPAY_ERROR',..._0x1c385e});}[a52_0x21dc4d(0xf1)](_0x350fc4,_0x1839d9,_0x50af35,_0x2a45bc,_0x8b32ad,_0x593468){const _0x2f3ee1=a52_0x21dc4d;this[_0x2f3ee1(0x103)](_0x2f3ee1(0x100),{'type':_0x2f3ee1(0x11c),'shopId':_0x350fc4,'webhookUrl':_0x1839d9,'event':_0x50af35,'status':_0x2a45bc,'responseTime':_0x8b32ad,'payload':_0x593468});}[a52_0x21dc4d(0x12d)](_0x354d2d,_0x84ac69,_0x43d673,_0x20ca2b,_0x53769b){const _0x4344dc=a52_0x21dc4d;this['writeLog'](_0x4344dc(0x126),{'type':_0x4344dc(0x108),'shopId':_0x354d2d,'webhookUrl':_0x84ac69,'event':_0x43d673,'error':_0x20ca2b instanceof Error?{'message':_0x20ca2b[_0x4344dc(0xe3)],'stack':_0x20ca2b[_0x4344dc(0xee)]}:_0x20ca2b,'payload':_0x53769b});}['logPaymentCreated'](_0x5e81c5,_0x1b12ed,_0x1c5aed,_0x546ec0,_0x372b56){const _0x72aecf=a52_0x21dc4d;this['writeLog'](_0x72aecf(0x10e),{'type':_0x72aecf(0xe8),'gateway':_0x5e81c5,'paymentId':_0x1b12ed,'shopId':_0x1c5aed,'amount':_0x546ec0,'currency':_0x372b56});}['logApiCall'](_0x12bef7,_0x11e4da,_0x5aac20,_0x1adeac,_0x377e24){const _0x2da133=a52_0x21dc4d;this[_0x2da133(0x103)](_0x2da133(0x11e),{'type':_0x2da133(0x121),'endpoint':_0x12bef7,'method':_0x11e4da,'userId':_0x5aac20,'userRole':_0x1adeac,'requestData':_0x377e24});}[a52_0x21dc4d(0xf5)](){const _0x54d5ed=a52_0x21dc4d;try{const _0x1fa99b=fs_1[_0x54d5ed(0xec)][_0x54d5ed(0x112)](this[_0x54d5ed(0x102)]),_0x16dd63=_0x1fa99b[_0x54d5ed(0x127)](_0x177a12=>_0x177a12['endsWith'](_0x54d5ed(0x124))),_0x549ceb=[...new Set(_0x16dd63[_0x54d5ed(0xeb)](_0x133232=>_0x133232[_0x54d5ed(0x10c)]('_')[0x0]))],_0x311a86=_0x16dd63['map'](_0x34c8ef=>{const _0xa7f663=_0x54d5ed,_0xbcdc31=path_1[_0xa7f663(0xec)][_0xa7f663(0xff)](this['logsDir'],_0x34c8ef),_0x55bd0c=fs_1[_0xa7f663(0xec)][_0xa7f663(0xe9)](_0xbcdc31),[_0x2229d7,_0xf04375]=_0x34c8ef[_0xa7f663(0x104)](_0xa7f663(0x124),'')[_0xa7f663(0x10c)]('_');return{'type':_0x2229d7,'date':_0xf04375,'size':_0x55bd0c['size']};})['sort']((_0x3f5d21,_0x17f732)=>_0x17f732['date'][_0x54d5ed(0xe4)](_0x3f5d21[_0x54d5ed(0x11d)]));return{'totalFiles':_0x16dd63[_0x54d5ed(0xed)],'logTypes':_0x549ceb,'latestLogs':_0x311a86[_0x54d5ed(0xf2)](0x0,0xa)};}catch(_0x17813f){return console[_0x54d5ed(0xfc)](_0x54d5ed(0xef),_0x17813f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x5a5c6a=0x1e){const _0x2b80d6=a52_0x21dc4d;try{const _0x23075a=fs_1['default'][_0x2b80d6(0x112)](this['logsDir']),_0x5d577b=new Date();_0x5d577b[_0x2b80d6(0x12f)](_0x5d577b[_0x2b80d6(0x12c)]()-_0x5a5c6a);let _0x116767=0x0;_0x23075a[_0x2b80d6(0x138)](_0x561635=>{const _0x1d7aa2=_0x2b80d6;if(!_0x561635[_0x1d7aa2(0x11b)]('.log'))return;const _0x5f47df=path_1['default'][_0x1d7aa2(0xff)](this[_0x1d7aa2(0x102)],_0x561635),_0x45d4f3=fs_1[_0x1d7aa2(0xec)][_0x1d7aa2(0xe9)](_0x5f47df);_0x45d4f3[_0x1d7aa2(0x105)]<_0x5d577b&&(fs_1[_0x1d7aa2(0xec)][_0x1d7aa2(0x123)](_0x5f47df),_0x116767++,console[_0x1d7aa2(0x10f)](_0x1d7aa2(0xf7)+_0x561635));}),console[_0x2b80d6(0x10f)](_0x2b80d6(0xe7)+_0x116767+_0x2b80d6(0x135)+_0x5a5c6a+_0x2b80d6(0x137));}catch(_0x3a6e51){console[_0x2b80d6(0xfc)](_0x2b80d6(0xe6),_0x3a6e51);}}}function a52_0x1576(_0x1408e0,_0x2849d4){const _0x52f4fb=a52_0x52f4();return a52_0x1576=function(_0x157643,_0x169a10){_0x157643=_0x157643-0xe0;let _0x19a69a=_0x52f4fb[_0x157643];return _0x19a69a;},a52_0x1576(_0x1408e0,_0x2849d4);}exports[a52_0x21dc4d(0xfb)]=LoggerService,exports[a52_0x21dc4d(0x11f)]=new LoggerService();