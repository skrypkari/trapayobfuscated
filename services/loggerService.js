'use strict';const a48_0x3b96c4=a48_0x68ec;(function(_0x593480,_0x499df3){const _0xae26b1=a48_0x68ec,_0x1f2036=_0x593480();while(!![]){try{const _0xe51af9=-parseInt(_0xae26b1(0x167))/0x1+-parseInt(_0xae26b1(0x15e))/0x2+parseInt(_0xae26b1(0x139))/0x3+parseInt(_0xae26b1(0x163))/0x4*(-parseInt(_0xae26b1(0x162))/0x5)+-parseInt(_0xae26b1(0x170))/0x6+parseInt(_0xae26b1(0x12f))/0x7*(-parseInt(_0xae26b1(0x13f))/0x8)+-parseInt(_0xae26b1(0x174))/0x9*(-parseInt(_0xae26b1(0x161))/0xa);if(_0xe51af9===_0x499df3)break;else _0x1f2036['push'](_0x1f2036['shift']());}catch(_0x50ee00){_0x1f2036['push'](_0x1f2036['shift']());}}}(a48_0x4bb2,0x1d278));function a48_0x4bb2(){const _0x1eb20c=['logWhiteDomainResponse','split','RESPONSE','40xaoODm','toISOString','ERROR','WEBHOOK_RECEIVED','logWebhookProcessed','api_calls','logShopWebhookError','.log','🗑️\x20Deleted\x20old\x20log\x20file:\x20','WEBHOOK_ERROR','default','endsWith','WEBHOOK_PROCESSED','logApiCall','__esModule','SHOP_WEBHOOK_SENT','localeCompare','map','Failed\x20to\x20write\x20','length','cointopay_status_changes','stack','LoggerService','defineProperty','setDate','error','📁\x20Created\x20logs\x20directory:\x20','\x20log:','unlinkSync','message','logCoinToPayStatus','270958tArnEn','webhooks_errors','🧹\x20Cleaned\x20','5600PEHXsn','23775VdNMHC','196WBGpIs','ensureLogsDirectory','\x20old\x20log\x20files\x20(older\x20than\x20','payments_created','185756hCSKoS','shop_webhooks_errors','COINTOPAY_STATUS_CHANGE','path','logWebhookError','SHOP_WEBHOOK_ERROR','logWebhookReceived','writeLog','\x20days)','1378626ixyXbl','white_domain_requests','logsDir','PAYMENT_CREATED','15642AelIzh','readdirSync','loggerService','join','date','121282hWZpjC','size','API_CALL','__importDefault','getDate','forEach','appendFileSync','getLogStats','log','utf8','50301gkxnVJ','cleanOldLogs','webhooks_received'];a48_0x4bb2=function(){return _0x1eb20c;};return a48_0x4bb2();}function a48_0x68ec(_0x2b33cb,_0x3853dd){const _0x4bb23e=a48_0x4bb2();return a48_0x68ec=function(_0x68ec91,_0x5ee2c9){_0x68ec91=_0x68ec91-0x12e;let _0x4952b3=_0x4bb23e[_0x68ec91];return _0x4952b3;},a48_0x68ec(_0x2b33cb,_0x3853dd);}var __importDefault=this&&this[a48_0x3b96c4(0x132)]||function(_0x4f5f1b){const _0xdfed8b=a48_0x3b96c4;return _0x4f5f1b&&_0x4f5f1b[_0xdfed8b(0x14d)]?_0x4f5f1b:{'default':_0x4f5f1b};};Object[a48_0x3b96c4(0x156)](exports,a48_0x3b96c4(0x14d),{'value':!![]}),exports[a48_0x3b96c4(0x176)]=exports[a48_0x3b96c4(0x155)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x3b96c4(0x16a)));class LoggerService{constructor(){const _0x17c329=a48_0x3b96c4;this[_0x17c329(0x172)]=path_1[_0x17c329(0x149)][_0x17c329(0x177)](process['cwd'](),'logs'),this['ensureLogsDirectory']();}[a48_0x3b96c4(0x164)](){const _0x4401b1=a48_0x3b96c4;!fs_1[_0x4401b1(0x149)]['existsSync'](this[_0x4401b1(0x172)])&&(fs_1[_0x4401b1(0x149)]['mkdirSync'](this[_0x4401b1(0x172)],{'recursive':!![]}),console[_0x4401b1(0x137)](_0x4401b1(0x159)+this['logsDir']));}['getLogFileName'](_0x2458dd){const _0x4bd2da=a48_0x3b96c4,_0x5641fe=new Date()[_0x4bd2da(0x140)]()['split']('T')[0x0];return path_1['default'][_0x4bd2da(0x177)](this[_0x4bd2da(0x172)],_0x2458dd+'_'+_0x5641fe+_0x4bd2da(0x146));}[a48_0x3b96c4(0x16e)](_0x1293f1,_0x1fb3d4){const _0x5623cd=a48_0x3b96c4;try{const _0x3f22fe=new Date()[_0x5623cd(0x140)](),_0x52c281={'timestamp':_0x3f22fe,..._0x1fb3d4},_0x9091c4=JSON['stringify'](_0x52c281)+'\x0a',_0x5438e2=this['getLogFileName'](_0x1293f1);fs_1['default'][_0x5623cd(0x135)](_0x5438e2,_0x9091c4,_0x5623cd(0x138));}catch(_0xaabeac){console['error'](_0x5623cd(0x151)+_0x1293f1+_0x5623cd(0x15a),_0xaabeac);}}['logWhiteDomainRequest'](_0x29adda,_0x45fdf8,_0x4db106,_0x4faefb){const _0x3ddf1d=a48_0x3b96c4;this[_0x3ddf1d(0x16e)](_0x3ddf1d(0x171),{'type':'REQUEST','gateway':_0x29adda,'endpoint':_0x45fdf8,'method':_0x4db106,'data':_0x4faefb});}[a48_0x3b96c4(0x13c)](_0x2edb0a,_0x19ef09,_0x489fb6,_0x2b0ee0,_0x1a0c6d){const _0x18c81c=a48_0x3b96c4;this['writeLog']('white_domain_responses',{'type':_0x18c81c(0x13e),'gateway':_0x2edb0a,'endpoint':_0x19ef09,'status':_0x489fb6,'responseTime':_0x1a0c6d,'data':_0x2b0ee0});}['logWhiteDomainError'](_0x4b297b,_0x2c5c4f,_0x2ca473){const _0x49f45e=a48_0x3b96c4;this[_0x49f45e(0x16e)]('white_domain_errors',{'type':_0x49f45e(0x141),'gateway':_0x4b297b,'endpoint':_0x2c5c4f,'error':_0x2ca473 instanceof Error?{'message':_0x2ca473[_0x49f45e(0x15c)],'stack':_0x2ca473[_0x49f45e(0x154)]}:_0x2ca473});}[a48_0x3b96c4(0x16d)](_0x1b4a69,_0x4afc80,_0x177182){const _0x36ca0f=a48_0x3b96c4;this['writeLog'](_0x36ca0f(0x13b),{'type':_0x36ca0f(0x142),'gateway':_0x1b4a69,'headers':_0x177182,'data':_0x4afc80});}[a48_0x3b96c4(0x143)](_0x559111,_0x3b3023,_0x2df86e,_0x33f19e,_0x5d81fc){const _0x2b0e6e=a48_0x3b96c4;this['writeLog']('webhooks_processed',{'type':_0x2b0e6e(0x14b),'gateway':_0x559111,'paymentId':_0x3b3023,'oldStatus':_0x2df86e,'newStatus':_0x33f19e,'originalData':_0x5d81fc});}[a48_0x3b96c4(0x16b)](_0x323384,_0x1a1b16,_0x5cff63){const _0x3bd456=a48_0x3b96c4;this['writeLog'](_0x3bd456(0x15f),{'type':_0x3bd456(0x148),'gateway':_0x323384,'error':_0x1a1b16 instanceof Error?{'message':_0x1a1b16['message'],'stack':_0x1a1b16[_0x3bd456(0x154)]}:_0x1a1b16,'originalData':_0x5cff63});}[a48_0x3b96c4(0x15d)](_0x3e26ce){const _0x5dcdfb=a48_0x3b96c4;this['writeLog'](_0x5dcdfb(0x153),{'type':_0x5dcdfb(0x169),..._0x3e26ce});}['logCoinToPayError'](_0x30dbe2){const _0x5d9ab1=a48_0x3b96c4;this[_0x5d9ab1(0x16e)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x30dbe2});}['logShopWebhookSent'](_0xacaac,_0x26413d,_0x2d3f07,_0x2c3e57,_0x364ae1,_0x55b3c6){const _0x15be98=a48_0x3b96c4;this[_0x15be98(0x16e)]('shop_webhooks_sent',{'type':_0x15be98(0x14e),'shopId':_0xacaac,'webhookUrl':_0x26413d,'event':_0x2d3f07,'status':_0x2c3e57,'responseTime':_0x364ae1,'payload':_0x55b3c6});}[a48_0x3b96c4(0x145)](_0x4df964,_0x52abf6,_0x2c60ff,_0x895796,_0x17a8c5){const _0x48392d=a48_0x3b96c4;this[_0x48392d(0x16e)](_0x48392d(0x168),{'type':_0x48392d(0x16c),'shopId':_0x4df964,'webhookUrl':_0x52abf6,'event':_0x2c60ff,'error':_0x895796 instanceof Error?{'message':_0x895796[_0x48392d(0x15c)],'stack':_0x895796['stack']}:_0x895796,'payload':_0x17a8c5});}['logPaymentCreated'](_0x10a11d,_0x520883,_0x5b0957,_0x265495,_0x24a1f3){const _0x1e9cfd=a48_0x3b96c4;this['writeLog'](_0x1e9cfd(0x166),{'type':_0x1e9cfd(0x173),'gateway':_0x10a11d,'paymentId':_0x520883,'shopId':_0x5b0957,'amount':_0x265495,'currency':_0x24a1f3});}[a48_0x3b96c4(0x14c)](_0x4085b3,_0x3c3cc3,_0x9014d8,_0x47f879,_0x5db0eb){const _0x4c2a7e=a48_0x3b96c4;this[_0x4c2a7e(0x16e)](_0x4c2a7e(0x144),{'type':_0x4c2a7e(0x131),'endpoint':_0x4085b3,'method':_0x3c3cc3,'userId':_0x9014d8,'userRole':_0x47f879,'requestData':_0x5db0eb});}[a48_0x3b96c4(0x136)](){const _0xd64dbc=a48_0x3b96c4;try{const _0x54458a=fs_1[_0xd64dbc(0x149)]['readdirSync'](this['logsDir']),_0x47e2ce=_0x54458a['filter'](_0x58470d=>_0x58470d[_0xd64dbc(0x14a)](_0xd64dbc(0x146))),_0x170e5d=[...new Set(_0x47e2ce[_0xd64dbc(0x150)](_0x5bd614=>_0x5bd614['split']('_')[0x0]))],_0x380584=_0x47e2ce[_0xd64dbc(0x150)](_0x30622b=>{const _0x13c666=_0xd64dbc,_0x1c386a=path_1[_0x13c666(0x149)][_0x13c666(0x177)](this[_0x13c666(0x172)],_0x30622b),_0x24b056=fs_1[_0x13c666(0x149)]['statSync'](_0x1c386a),[_0x2f87d5,_0x59d501]=_0x30622b['replace'](_0x13c666(0x146),'')[_0x13c666(0x13d)]('_');return{'type':_0x2f87d5,'date':_0x59d501,'size':_0x24b056[_0x13c666(0x130)]};})['sort']((_0x262b03,_0x1ef972)=>_0x1ef972[_0xd64dbc(0x12e)][_0xd64dbc(0x14f)](_0x262b03[_0xd64dbc(0x12e)]));return{'totalFiles':_0x47e2ce[_0xd64dbc(0x152)],'logTypes':_0x170e5d,'latestLogs':_0x380584['slice'](0x0,0xa)};}catch(_0x40a9aa){return console[_0xd64dbc(0x158)]('Failed\x20to\x20get\x20log\x20stats:',_0x40a9aa),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x3b96c4(0x13a)](_0x28895f=0x1e){const _0x542ad1=a48_0x3b96c4;try{const _0xf8c158=fs_1[_0x542ad1(0x149)][_0x542ad1(0x175)](this[_0x542ad1(0x172)]),_0x3ab358=new Date();_0x3ab358[_0x542ad1(0x157)](_0x3ab358[_0x542ad1(0x133)]()-_0x28895f);let _0x8eab14=0x0;_0xf8c158[_0x542ad1(0x134)](_0x5e5cf7=>{const _0x35f983=_0x542ad1;if(!_0x5e5cf7[_0x35f983(0x14a)](_0x35f983(0x146)))return;const _0x282277=path_1[_0x35f983(0x149)][_0x35f983(0x177)](this['logsDir'],_0x5e5cf7),_0xb7b544=fs_1[_0x35f983(0x149)]['statSync'](_0x282277);_0xb7b544['mtime']<_0x3ab358&&(fs_1['default'][_0x35f983(0x15b)](_0x282277),_0x8eab14++,console['log'](_0x35f983(0x147)+_0x5e5cf7));}),console[_0x542ad1(0x137)](_0x542ad1(0x160)+_0x8eab14+_0x542ad1(0x165)+_0x28895f+_0x542ad1(0x16f));}catch(_0x18f2fc){console[_0x542ad1(0x158)]('Failed\x20to\x20clean\x20old\x20logs:',_0x18f2fc);}}}exports[a48_0x3b96c4(0x155)]=LoggerService,exports[a48_0x3b96c4(0x176)]=new LoggerService();