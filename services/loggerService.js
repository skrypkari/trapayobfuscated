'use strict';const a49_0x453dee=a49_0x5e7c;(function(_0x5a3007,_0x211adf){const _0x2f24f2=a49_0x5e7c,_0x1dc19d=_0x5a3007();while(!![]){try{const _0x33112d=-parseInt(_0x2f24f2(0x132))/0x1+-parseInt(_0x2f24f2(0x11d))/0x2*(parseInt(_0x2f24f2(0x115))/0x3)+parseInt(_0x2f24f2(0x145))/0x4*(parseInt(_0x2f24f2(0x104))/0x5)+parseInt(_0x2f24f2(0x100))/0x6+-parseInt(_0x2f24f2(0x117))/0x7+parseInt(_0x2f24f2(0x11c))/0x8*(-parseInt(_0x2f24f2(0x144))/0x9)+parseInt(_0x2f24f2(0x10d))/0xa*(parseInt(_0x2f24f2(0x142))/0xb);if(_0x33112d===_0x211adf)break;else _0x1dc19d['push'](_0x1dc19d['shift']());}catch(_0x58de73){_0x1dc19d['push'](_0x1dc19d['shift']());}}}(a49_0x2de3,0x3b1aa));var __importDefault=this&&this[a49_0x453dee(0x105)]||function(_0x7a7127){const _0xd80165=a49_0x453dee;return _0x7a7127&&_0x7a7127[_0xd80165(0x135)]?_0x7a7127:{'default':_0x7a7127};};Object[a49_0x453dee(0x128)](exports,a49_0x453dee(0x135),{'value':!![]}),exports[a49_0x453dee(0x138)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x453dee(0x146)));class LoggerService{constructor(){const _0x35865e=a49_0x453dee;this[_0x35865e(0xf7)]=path_1['default'][_0x35865e(0x12d)](process[_0x35865e(0x133)](),_0x35865e(0x122)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0xfca5e7=a49_0x453dee;!fs_1[_0xfca5e7(0x108)][_0xfca5e7(0x116)](this[_0xfca5e7(0xf7)])&&(fs_1[_0xfca5e7(0x108)][_0xfca5e7(0x14c)](this['logsDir'],{'recursive':!![]}),console[_0xfca5e7(0x118)](_0xfca5e7(0x14d)+this['logsDir']));}['getLogFileName'](_0x1d4df9){const _0x3807ae=a49_0x453dee,_0x93d4e=new Date()[_0x3807ae(0x12a)]()[_0x3807ae(0x149)]('T')[0x0];return path_1['default'][_0x3807ae(0x12d)](this[_0x3807ae(0xf7)],_0x1d4df9+'_'+_0x93d4e+_0x3807ae(0x12c));}['writeLog'](_0x5378b5,_0x4868a4){const _0x416dc9=a49_0x453dee;try{const _0x1e4768=new Date()['toISOString'](),_0x30b244={'timestamp':_0x1e4768,..._0x4868a4},_0x40309b=JSON[_0x416dc9(0xf5)](_0x30b244)+'\x0a',_0x235171=this[_0x416dc9(0x139)](_0x5378b5);fs_1[_0x416dc9(0x108)][_0x416dc9(0x134)](_0x235171,_0x40309b,'utf8');}catch(_0x3ce63e){console[_0x416dc9(0x113)](_0x416dc9(0x147)+_0x5378b5+_0x416dc9(0x126),_0x3ce63e);}}[a49_0x453dee(0xfc)](_0x435b10,_0x52c6c5,_0x12d929,_0x4f4bb7){const _0x51cab0=a49_0x453dee;this[_0x51cab0(0x120)](_0x51cab0(0xf9),{'type':_0x51cab0(0x136),'gateway':_0x435b10,'endpoint':_0x52c6c5,'method':_0x12d929,'data':_0x4f4bb7});}[a49_0x453dee(0x13c)](_0x1fd14f,_0x4b7f7e,_0x5c05df,_0x3058e4,_0x2255dd){const _0x7c1254=a49_0x453dee;this[_0x7c1254(0x120)](_0x7c1254(0x111),{'type':_0x7c1254(0x127),'gateway':_0x1fd14f,'endpoint':_0x4b7f7e,'status':_0x5c05df,'responseTime':_0x2255dd,'data':_0x3058e4});}[a49_0x453dee(0xf8)](_0x58a369,_0x2fcca3,_0x1ade49){const _0x42f299=a49_0x453dee;this[_0x42f299(0x120)](_0x42f299(0x11b),{'type':_0x42f299(0x13a),'gateway':_0x58a369,'endpoint':_0x2fcca3,'error':_0x1ade49 instanceof Error?{'message':_0x1ade49[_0x42f299(0x124)],'stack':_0x1ade49['stack']}:_0x1ade49});}[a49_0x453dee(0x13b)](_0x293376,_0x4f6f26,_0x3bb1a2){const _0x6497ee=a49_0x453dee;this['writeLog'](_0x6497ee(0xff),{'type':'WEBHOOK_RECEIVED','gateway':_0x293376,'headers':_0x3bb1a2,'data':_0x4f6f26});}[a49_0x453dee(0x14b)](_0xa465dd,_0xd0b51e,_0x570791,_0x4485ca,_0x933c81){const _0x3ac5ce=a49_0x453dee;this['writeLog'](_0x3ac5ce(0x10f),{'type':_0x3ac5ce(0x141),'gateway':_0xa465dd,'paymentId':_0xd0b51e,'oldStatus':_0x570791,'newStatus':_0x4485ca,'originalData':_0x933c81});}[a49_0x453dee(0x10a)](_0x1cc768,_0x5b9513,_0x206839){const _0x26d063=a49_0x453dee;this['writeLog'](_0x26d063(0x140),{'type':_0x26d063(0x114),'gateway':_0x1cc768,'error':_0x5b9513 instanceof Error?{'message':_0x5b9513[_0x26d063(0x124)],'stack':_0x5b9513[_0x26d063(0x143)]}:_0x5b9513,'originalData':_0x206839});}[a49_0x453dee(0x125)](_0x12f63c){const _0x347ce7=a49_0x453dee;this[_0x347ce7(0x120)](_0x347ce7(0xf6),{'type':_0x347ce7(0x130),..._0x12f63c});}['logCoinToPayError'](_0x5329ae){const _0x361a21=a49_0x453dee;this[_0x361a21(0x120)](_0x361a21(0x131),{'type':_0x361a21(0x11a),..._0x5329ae});}[a49_0x453dee(0x13f)](_0x28dca4,_0x5c0e38,_0x52952a,_0x4dc687,_0x5cda80,_0x287daf){const _0x234b9f=a49_0x453dee;this[_0x234b9f(0x120)]('shop_webhooks_sent',{'type':_0x234b9f(0x109),'shopId':_0x28dca4,'webhookUrl':_0x5c0e38,'event':_0x52952a,'status':_0x4dc687,'responseTime':_0x5cda80,'payload':_0x287daf});}[a49_0x453dee(0x123)](_0x1b534e,_0x497fe2,_0x57c213,_0x16c3ca,_0x2eb19b){const _0x515167=a49_0x453dee;this[_0x515167(0x120)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x1b534e,'webhookUrl':_0x497fe2,'event':_0x57c213,'error':_0x16c3ca instanceof Error?{'message':_0x16c3ca[_0x515167(0x124)],'stack':_0x16c3ca[_0x515167(0x143)]}:_0x16c3ca,'payload':_0x2eb19b});}[a49_0x453dee(0x13d)](_0x2bfaf5,_0x5cb804,_0x14f897,_0xd3207,_0x5a8cba){const _0x3b3e41=a49_0x453dee;this[_0x3b3e41(0x120)](_0x3b3e41(0x12e),{'type':_0x3b3e41(0x11f),'gateway':_0x2bfaf5,'paymentId':_0x5cb804,'shopId':_0x14f897,'amount':_0xd3207,'currency':_0x5a8cba});}['logApiCall'](_0x5dfd59,_0x1c52b8,_0x27f352,_0x55badb,_0x1e6733){const _0x2fc126=a49_0x453dee;this[_0x2fc126(0x120)](_0x2fc126(0x10e),{'type':_0x2fc126(0x14a),'endpoint':_0x5dfd59,'method':_0x1c52b8,'userId':_0x27f352,'userRole':_0x55badb,'requestData':_0x1e6733});}[a49_0x453dee(0x106)](){const _0x50e20f=a49_0x453dee;try{const _0x1d76d0=fs_1[_0x50e20f(0x108)][_0x50e20f(0xfb)](this[_0x50e20f(0xf7)]),_0x32bef1=_0x1d76d0[_0x50e20f(0x11e)](_0x293ad4=>_0x293ad4[_0x50e20f(0x10c)](_0x50e20f(0x12c))),_0x1b4500=[...new Set(_0x32bef1[_0x50e20f(0x121)](_0xea2d44=>_0xea2d44[_0x50e20f(0x149)]('_')[0x0]))],_0x1c6f2b=_0x32bef1[_0x50e20f(0x121)](_0x80c957=>{const _0x1e26e0=_0x50e20f,_0x5d5b6b=path_1[_0x1e26e0(0x108)][_0x1e26e0(0x12d)](this[_0x1e26e0(0xf7)],_0x80c957),_0x5bdafb=fs_1['default'][_0x1e26e0(0x102)](_0x5d5b6b),[_0x4df6db,_0x3c0769]=_0x80c957[_0x1e26e0(0x10b)](_0x1e26e0(0x12c),'')[_0x1e26e0(0x149)]('_');return{'type':_0x4df6db,'date':_0x3c0769,'size':_0x5bdafb[_0x1e26e0(0x13e)]};})[_0x50e20f(0x137)]((_0x3647c3,_0x2b15be)=>_0x2b15be[_0x50e20f(0xfd)]['localeCompare'](_0x3647c3[_0x50e20f(0xfd)]));return{'totalFiles':_0x32bef1['length'],'logTypes':_0x1b4500,'latestLogs':_0x1c6f2b[_0x50e20f(0x112)](0x0,0xa)};}catch(_0x6e4bde){return console[_0x50e20f(0x113)](_0x50e20f(0x12f),_0x6e4bde),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x453dee(0x119)](_0x168b48=0x1e){const _0x3f886b=a49_0x453dee;try{const _0xf3ffa9=fs_1['default']['readdirSync'](this[_0x3f886b(0xf7)]),_0x310832=new Date();_0x310832['setDate'](_0x310832[_0x3f886b(0x148)]()-_0x168b48);let _0x59ef6a=0x0;_0xf3ffa9[_0x3f886b(0x129)](_0x3ea7fa=>{const _0x4f044c=_0x3f886b;if(!_0x3ea7fa[_0x4f044c(0x10c)](_0x4f044c(0x12c)))return;const _0x1474d3=path_1[_0x4f044c(0x108)]['join'](this['logsDir'],_0x3ea7fa),_0x288764=fs_1[_0x4f044c(0x108)][_0x4f044c(0x102)](_0x1474d3);_0x288764[_0x4f044c(0xfe)]<_0x310832&&(fs_1['default'][_0x4f044c(0x103)](_0x1474d3),_0x59ef6a++,console[_0x4f044c(0x118)](_0x4f044c(0x12b)+_0x3ea7fa));}),console[_0x3f886b(0x118)](_0x3f886b(0x110)+_0x59ef6a+_0x3f886b(0xfa)+_0x168b48+_0x3f886b(0x101));}catch(_0x555e50){console[_0x3f886b(0x113)](_0x3f886b(0x14e),_0x555e50);}}}function a49_0x5e7c(_0x51a0cd,_0x1a8353){const _0x2de3eb=a49_0x2de3();return a49_0x5e7c=function(_0x5e7cbb,_0x12dafd){_0x5e7cbb=_0x5e7cbb-0xf5;let _0x1b84f3=_0x2de3eb[_0x5e7cbb];return _0x1b84f3;},a49_0x5e7c(_0x51a0cd,_0x1a8353);}function a49_0x2de3(){const _0x4fc786=['error','WEBHOOK_ERROR','383286FJCxqZ','existsSync','1395723WXjmfY','log','cleanOldLogs','COINTOPAY_ERROR','white_domain_errors','36808HvdyAF','2jZVmtg','filter','PAYMENT_CREATED','writeLog','map','logs','logShopWebhookError','message','logCoinToPayStatus','\x20log:','RESPONSE','defineProperty','forEach','toISOString','🗑️\x20Deleted\x20old\x20log\x20file:\x20','.log','join','payments_created','Failed\x20to\x20get\x20log\x20stats:','COINTOPAY_STATUS_CHANGE','cointopay_errors','65659AGrgGB','cwd','appendFileSync','__esModule','REQUEST','sort','loggerService','getLogFileName','ERROR','logWebhookReceived','logWhiteDomainResponse','logPaymentCreated','size','logShopWebhookSent','webhooks_errors','WEBHOOK_PROCESSED','2497UOWSPL','stack','531hfcFkm','112QoKZIQ','path','Failed\x20to\x20write\x20','getDate','split','API_CALL','logWebhookProcessed','mkdirSync','📁\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20clean\x20old\x20logs:','stringify','cointopay_status_changes','logsDir','logWhiteDomainError','white_domain_requests','\x20old\x20log\x20files\x20(older\x20than\x20','readdirSync','logWhiteDomainRequest','date','mtime','webhooks_received','2827866uLkvNl','\x20days)','statSync','unlinkSync','4885kSJaXY','__importDefault','getLogStats','LoggerService','default','SHOP_WEBHOOK_SENT','logWebhookError','replace','endsWith','17960IwYvKf','api_calls','webhooks_processed','🧹\x20Cleaned\x20','white_domain_responses','slice'];a49_0x2de3=function(){return _0x4fc786;};return a49_0x2de3();}exports[a49_0x453dee(0x107)]=LoggerService,exports[a49_0x453dee(0x138)]=new LoggerService();