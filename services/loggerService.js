'use strict';const a73_0x1f1fa2=a73_0xbc51;(function(_0x2dfaa4,_0x3007b5){const _0x385fb6=a73_0xbc51,_0x2ff6ee=_0x2dfaa4();while(!![]){try{const _0x26d962=-parseInt(_0x385fb6(0x1f0))/0x1+-parseInt(_0x385fb6(0x205))/0x2*(-parseInt(_0x385fb6(0x20e))/0x3)+parseInt(_0x385fb6(0x228))/0x4+-parseInt(_0x385fb6(0x23b))/0x5+parseInt(_0x385fb6(0x21b))/0x6*(-parseInt(_0x385fb6(0x1fc))/0x7)+parseInt(_0x385fb6(0x20a))/0x8*(parseInt(_0x385fb6(0x212))/0x9)+parseInt(_0x385fb6(0x22d))/0xa*(-parseInt(_0x385fb6(0x216))/0xb);if(_0x26d962===_0x3007b5)break;else _0x2ff6ee['push'](_0x2ff6ee['shift']());}catch(_0x3a37f6){_0x2ff6ee['push'](_0x2ff6ee['shift']());}}}(a73_0x3c60,0x6c084));var __importDefault=this&&this[a73_0x1f1fa2(0x222)]||function(_0x549832){const _0x384512=a73_0x1f1fa2;return _0x549832&&_0x549832[_0x384512(0x220)]?_0x549832:{'default':_0x549832};};Object[a73_0x1f1fa2(0x1e9)](exports,a73_0x1f1fa2(0x220),{'value':!![]}),exports['loggerService']=exports[a73_0x1f1fa2(0x20f)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a73_0x1f1fa2(0x1fe)));class LoggerService{constructor(){const _0x2b2da1=a73_0x1f1fa2;this['logsDir']=path_1[_0x2b2da1(0x1f2)][_0x2b2da1(0x210)](process[_0x2b2da1(0x1f4)](),_0x2b2da1(0x240)),this[_0x2b2da1(0x235)]();}['ensureLogsDirectory'](){const _0x19fbe9=a73_0x1f1fa2;!fs_1[_0x19fbe9(0x1f2)][_0x19fbe9(0x224)](this['logsDir'])&&(fs_1[_0x19fbe9(0x1f2)][_0x19fbe9(0x237)](this['logsDir'],{'recursive':!![]}),console[_0x19fbe9(0x226)](_0x19fbe9(0x20c)+this[_0x19fbe9(0x22e)]));}[a73_0x1f1fa2(0x202)](_0x4beea8){const _0x75ec27=a73_0x1f1fa2,_0x37158a=new Date()[_0x75ec27(0x22c)]()['split']('T')[0x0];return path_1['default']['join'](this[_0x75ec27(0x22e)],_0x4beea8+'_'+_0x37158a+_0x75ec27(0x201));}['writeLog'](_0x85c3be,_0x2a8fd2){const _0x38dee7=a73_0x1f1fa2;try{const _0x138aad=new Date()['toISOString'](),_0x271cd8={'timestamp':_0x138aad,..._0x2a8fd2},_0x2cdb8c=JSON[_0x38dee7(0x23a)](_0x271cd8)+'\x0a',_0x5bedd9=this['getLogFileName'](_0x85c3be);fs_1[_0x38dee7(0x1f2)][_0x38dee7(0x227)](_0x5bedd9,_0x2cdb8c,_0x38dee7(0x236));}catch(_0x57eea9){console['error'](_0x38dee7(0x218)+_0x85c3be+_0x38dee7(0x231),_0x57eea9);}}[a73_0x1f1fa2(0x21e)](_0x337f9a,_0xaf91b0,_0x5cc830,_0x1011c6){const _0x3c0acc=a73_0x1f1fa2;this[_0x3c0acc(0x206)](_0x3c0acc(0x1fb),{'type':_0x3c0acc(0x1ff),'gateway':_0x337f9a,'endpoint':_0xaf91b0,'method':_0x5cc830,'data':_0x1011c6});}[a73_0x1f1fa2(0x1fd)](_0xfad632,_0x280ee5,_0x18d718,_0x118bb6,_0x3b2c39){const _0x47ee19=a73_0x1f1fa2;this[_0x47ee19(0x206)](_0x47ee19(0x1f9),{'type':_0x47ee19(0x217),'gateway':_0xfad632,'endpoint':_0x280ee5,'status':_0x18d718,'responseTime':_0x3b2c39,'data':_0x118bb6});}[a73_0x1f1fa2(0x23e)](_0xa65b1d,_0x207765,_0x5c67e8){const _0x1ec4f2=a73_0x1f1fa2;this[_0x1ec4f2(0x206)]('white_domain_errors',{'type':_0x1ec4f2(0x213),'gateway':_0xa65b1d,'endpoint':_0x207765,'error':_0x5c67e8 instanceof Error?{'message':_0x5c67e8[_0x1ec4f2(0x239)],'stack':_0x5c67e8[_0x1ec4f2(0x234)]}:_0x5c67e8});}['logWebhookReceived'](_0x4ff207,_0x5ad1e3,_0x232e3b){const _0x5ba7ed=a73_0x1f1fa2;this[_0x5ba7ed(0x206)](_0x5ba7ed(0x204),{'type':_0x5ba7ed(0x225),'gateway':_0x4ff207,'headers':_0x232e3b,'data':_0x5ad1e3});}[a73_0x1f1fa2(0x200)](_0x51d5f5,_0xb49c4a,_0x492606,_0x58656f,_0x1b9844){const _0x1292dd=a73_0x1f1fa2;this[_0x1292dd(0x206)]('webhooks_processed',{'type':_0x1292dd(0x1ec),'gateway':_0x51d5f5,'paymentId':_0xb49c4a,'oldStatus':_0x492606,'newStatus':_0x58656f,'originalData':_0x1b9844});}[a73_0x1f1fa2(0x20d)](_0x42bd3b,_0x8d4864,_0xd81b99){const _0x3c58b2=a73_0x1f1fa2;this[_0x3c58b2(0x206)](_0x3c58b2(0x232),{'type':_0x3c58b2(0x21c),'gateway':_0x42bd3b,'error':_0x8d4864 instanceof Error?{'message':_0x8d4864['message'],'stack':_0x8d4864['stack']}:_0x8d4864,'originalData':_0xd81b99});}[a73_0x1f1fa2(0x211)](_0x10cf13){const _0x4ab8dc=a73_0x1f1fa2;this[_0x4ab8dc(0x206)](_0x4ab8dc(0x233),{'type':_0x4ab8dc(0x1f8),..._0x10cf13});}[a73_0x1f1fa2(0x20b)](_0x481672){const _0x39b992=a73_0x1f1fa2;this[_0x39b992(0x206)](_0x39b992(0x1ed),{'type':_0x39b992(0x215),..._0x481672});}[a73_0x1f1fa2(0x1fa)](_0x2f096e,_0x545802,_0x1b4ecf,_0x4888ec,_0x1231e5,_0x39db89){const _0x491ec9=a73_0x1f1fa2;this[_0x491ec9(0x206)](_0x491ec9(0x23f),{'type':_0x491ec9(0x23d),'shopId':_0x2f096e,'webhookUrl':_0x545802,'event':_0x1b4ecf,'status':_0x4888ec,'responseTime':_0x1231e5,'payload':_0x39db89});}['logShopWebhookError'](_0x552a7f,_0x21023a,_0x19e546,_0x2d212f,_0x22361c){const _0x4cf9d7=a73_0x1f1fa2;this[_0x4cf9d7(0x206)](_0x4cf9d7(0x21a),{'type':_0x4cf9d7(0x1ee),'shopId':_0x552a7f,'webhookUrl':_0x21023a,'event':_0x19e546,'error':_0x2d212f instanceof Error?{'message':_0x2d212f[_0x4cf9d7(0x239)],'stack':_0x2d212f['stack']}:_0x2d212f,'payload':_0x22361c});}[a73_0x1f1fa2(0x223)](_0x284edd,_0x254cfe,_0x3bf425,_0x1e830d,_0x461d23){const _0x2f1a07=a73_0x1f1fa2;this[_0x2f1a07(0x206)](_0x2f1a07(0x243),{'type':'PAYMENT_CREATED','gateway':_0x284edd,'paymentId':_0x254cfe,'shopId':_0x3bf425,'amount':_0x1e830d,'currency':_0x461d23});}[a73_0x1f1fa2(0x208)](_0x3f6c4f,_0x5eaf7d,_0x44036e,_0x1bba3e,_0xe95fd5){const _0x52cec3=a73_0x1f1fa2;this[_0x52cec3(0x206)](_0x52cec3(0x221),{'type':'API_CALL','endpoint':_0x3f6c4f,'method':_0x5eaf7d,'userId':_0x44036e,'userRole':_0x1bba3e,'requestData':_0xe95fd5});}[a73_0x1f1fa2(0x21d)](){const _0x24f3c9=a73_0x1f1fa2;try{const _0xcadb67=fs_1['default']['readdirSync'](this['logsDir']),_0xca306e=_0xcadb67['filter'](_0x4cce75=>_0x4cce75[_0x24f3c9(0x214)](_0x24f3c9(0x201))),_0x5265f0=[...new Set(_0xca306e['map'](_0x35aa61=>_0x35aa61[_0x24f3c9(0x22f)]('_')[0x0]))],_0x17feaa=_0xca306e['map'](_0x1fdede=>{const _0xe9068c=_0x24f3c9,_0x298842=path_1['default'][_0xe9068c(0x210)](this[_0xe9068c(0x22e)],_0x1fdede),_0x112eaf=fs_1[_0xe9068c(0x1f2)][_0xe9068c(0x23c)](_0x298842),[_0x362b63,_0x343859]=_0x1fdede[_0xe9068c(0x1f3)]('.log','')[_0xe9068c(0x22f)]('_');return{'type':_0x362b63,'date':_0x343859,'size':_0x112eaf[_0xe9068c(0x1f1)]};})[_0x24f3c9(0x209)]((_0x2c7347,_0x6bf915)=>_0x6bf915[_0x24f3c9(0x203)][_0x24f3c9(0x1ea)](_0x2c7347[_0x24f3c9(0x203)]));return{'totalFiles':_0xca306e[_0x24f3c9(0x229)],'logTypes':_0x5265f0,'latestLogs':_0x17feaa['slice'](0x0,0xa)};}catch(_0x44c72c){return console[_0x24f3c9(0x21f)](_0x24f3c9(0x1eb),_0x44c72c),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a73_0x1f1fa2(0x219)](_0x1edf8d=0x1e){const _0x50e802=a73_0x1f1fa2;try{const _0x3bdc90=fs_1[_0x50e802(0x1f2)][_0x50e802(0x22a)](this[_0x50e802(0x22e)]),_0x1b0018=new Date();_0x1b0018[_0x50e802(0x22b)](_0x1b0018[_0x50e802(0x207)]()-_0x1edf8d);let _0x3f9fbb=0x0;_0x3bdc90[_0x50e802(0x230)](_0x1f6f01=>{const _0x30f488=_0x50e802;if(!_0x1f6f01[_0x30f488(0x214)](_0x30f488(0x201)))return;const _0x461556=path_1['default'][_0x30f488(0x210)](this[_0x30f488(0x22e)],_0x1f6f01),_0x205c55=fs_1['default'][_0x30f488(0x23c)](_0x461556);_0x205c55['mtime']<_0x1b0018&&(fs_1[_0x30f488(0x1f2)][_0x30f488(0x1f7)](_0x461556),_0x3f9fbb++,console['log'](_0x30f488(0x1f6)+_0x1f6f01));}),console[_0x50e802(0x226)](_0x50e802(0x242)+_0x3f9fbb+_0x50e802(0x238)+_0x1edf8d+_0x50e802(0x1f5));}catch(_0x47bff2){console['error'](_0x50e802(0x1ef),_0x47bff2);}}}function a73_0xbc51(_0x171df8,_0xd1681d){_0x171df8=_0x171df8-0x1e9;const _0x3c60da=a73_0x3c60();let _0xbc51b5=_0x3c60da[_0x171df8];return _0xbc51b5;}function a73_0x3c60(){const _0x4f25c1=['ğŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','unlinkSync','COINTOPAY_STATUS_CHANGE','white_domain_responses','logShopWebhookSent','white_domain_requests','2382415YjUsPn','logWhiteDomainResponse','path','REQUEST','logWebhookProcessed','.log','getLogFileName','date','webhooks_received','821498GzSbFx','writeLog','getDate','logApiCall','sort','3169336tvsdNq','logCoinToPayError','ğŸ“\x20Created\x20logs\x20directory:\x20','logWebhookError','6zDgArs','LoggerService','join','logCoinToPayStatus','9qvfNWP','ERROR','endsWith','COINTOPAY_ERROR','11vpMGic','RESPONSE','Failed\x20to\x20write\x20','cleanOldLogs','shop_webhooks_errors','6myXNYg','WEBHOOK_ERROR','getLogStats','logWhiteDomainRequest','error','__esModule','api_calls','__importDefault','logPaymentCreated','existsSync','WEBHOOK_RECEIVED','log','appendFileSync','3391248vwXsrw','length','readdirSync','setDate','toISOString','2354090QhghmJ','logsDir','split','forEach','\x20log:','webhooks_errors','cointopay_status_changes','stack','ensureLogsDirectory','utf8','mkdirSync','\x20old\x20log\x20files\x20(older\x20than\x20','message','stringify','1422630yuNDmm','statSync','SHOP_WEBHOOK_SENT','logWhiteDomainError','shop_webhooks_sent','logs','loggerService','ğŸ§¹\x20Cleaned\x20','payments_created','defineProperty','localeCompare','Failed\x20to\x20get\x20log\x20stats:','WEBHOOK_PROCESSED','cointopay_errors','SHOP_WEBHOOK_ERROR','Failed\x20to\x20clean\x20old\x20logs:','762697bbbyKh','size','default','replace','cwd','\x20days)'];a73_0x3c60=function(){return _0x4f25c1;};return a73_0x3c60();}exports[a73_0x1f1fa2(0x20f)]=LoggerService,exports[a73_0x1f1fa2(0x241)]=new LoggerService();