'use strict';function a59_0x5bb3(_0x289481,_0x2b84ed){const _0x40b9ff=a59_0x40b9();return a59_0x5bb3=function(_0x5bb3ca,_0x3e7b9b){_0x5bb3ca=_0x5bb3ca-0xed;let _0x4af5b5=_0x40b9ff[_0x5bb3ca];return _0x4af5b5;},a59_0x5bb3(_0x289481,_0x2b84ed);}function a59_0x40b9(){const _0x1cf7c7=['\x20log:','618929pSJFzs','SHOP_WEBHOOK_SENT','path','logApiCall','replace','writeLog','logWebhookError','white_domain_responses','payments_created','webhooks_errors','API_CALL','__esModule','logShopWebhookError','default','.log','40NDdpkJ','84695NxxOaZ','message','logPaymentCreated','WEBHOOK_RECEIVED','cointopay_errors','appendFileSync','webhooks_received','3547122DHDqKW','Failed\x20to\x20get\x20log\x20stats:','logWhiteDomainResponse','LoggerService','logsDir','logWebhookReceived','2298646NqMXdZ','readdirSync','logWhiteDomainError','1349482aUUovD','white_domain_requests','shop_webhooks_sent','stringify','27YHiQxc','date','filter','COINTOPAY_ERROR','log','PAYMENT_CREATED','logWebhookProcessed','localeCompare','ensureLogsDirectory','join','logs','RESPONSE','Failed\x20to\x20clean\x20old\x20logs:','error','WEBHOOK_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','api_calls','mkdirSync','ERROR','7972968IefQRo','3RTeCjJ','existsSync','cleanOldLogs','loggerService','2228180yTBfpi','stack','WEBHOOK_PROCESSED','utf8','COINTOPAY_STATUS_CHANGE','statSync','getLogFileName','🗑️\x20Deleted\x20old\x20log\x20file:\x20','toISOString','cointopay_status_changes','cwd','map','mtime','forEach','REQUEST','endsWith','split'];a59_0x40b9=function(){return _0x1cf7c7;};return a59_0x40b9();}const a59_0x2b2b04=a59_0x5bb3;(function(_0x36e734,_0x61339a){const _0x24c1f0=a59_0x5bb3,_0x114259=_0x36e734();while(!![]){try{const _0x442258=parseInt(_0x24c1f0(0x11d))/0x1+parseInt(_0x24c1f0(0xef))/0x2*(parseInt(_0x24c1f0(0x107))/0x3)+parseInt(_0x24c1f0(0x12c))/0x4*(-parseInt(_0x24c1f0(0x12d))/0x5)+-parseInt(_0x24c1f0(0x134))/0x6+-parseInt(_0x24c1f0(0x13a))/0x7+parseInt(_0x24c1f0(0x106))/0x8+-parseInt(_0x24c1f0(0xf3))/0x9*(parseInt(_0x24c1f0(0x10b))/0xa);if(_0x442258===_0x61339a)break;else _0x114259['push'](_0x114259['shift']());}catch(_0xe905f9){_0x114259['push'](_0x114259['shift']());}}}(a59_0x40b9,0x82192));var __importDefault=this&&this['__importDefault']||function(_0x4eaead){const _0x382254=a59_0x5bb3;return _0x4eaead&&_0x4eaead[_0x382254(0x128)]?_0x4eaead:{'default':_0x4eaead};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a59_0x2b2b04(0x10a)]=exports[a59_0x2b2b04(0x137)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x2b2b04(0x11f)));class LoggerService{constructor(){const _0x39d5ea=a59_0x2b2b04;this[_0x39d5ea(0x138)]=path_1[_0x39d5ea(0x12a)][_0x39d5ea(0xfc)](process[_0x39d5ea(0x115)](),_0x39d5ea(0xfd)),this[_0x39d5ea(0xfb)]();}[a59_0x2b2b04(0xfb)](){const _0x146be0=a59_0x2b2b04;!fs_1[_0x146be0(0x12a)][_0x146be0(0x108)](this['logsDir'])&&(fs_1[_0x146be0(0x12a)][_0x146be0(0x104)](this[_0x146be0(0x138)],{'recursive':!![]}),console[_0x146be0(0xf7)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x146be0(0x138)]));}['getLogFileName'](_0x419a2d){const _0x230b5f=a59_0x2b2b04,_0x1e5695=new Date()['toISOString']()[_0x230b5f(0x11b)]('T')[0x0];return path_1[_0x230b5f(0x12a)][_0x230b5f(0xfc)](this[_0x230b5f(0x138)],_0x419a2d+'_'+_0x1e5695+_0x230b5f(0x12b));}[a59_0x2b2b04(0x122)](_0x541aa0,_0x2ad3a5){const _0x18714d=a59_0x2b2b04;try{const _0x1cd178=new Date()[_0x18714d(0x113)](),_0x5d4966={'timestamp':_0x1cd178,..._0x2ad3a5},_0x3719e5=JSON[_0x18714d(0xf2)](_0x5d4966)+'\x0a',_0x57683e=this[_0x18714d(0x111)](_0x541aa0);fs_1[_0x18714d(0x12a)][_0x18714d(0x132)](_0x57683e,_0x3719e5,_0x18714d(0x10e));}catch(_0x3d4915){console[_0x18714d(0x100)]('Failed\x20to\x20write\x20'+_0x541aa0+_0x18714d(0x11c),_0x3d4915);}}['logWhiteDomainRequest'](_0x3cb5de,_0x1c96b7,_0x405731,_0x3be786){const _0x3d1aea=a59_0x2b2b04;this[_0x3d1aea(0x122)](_0x3d1aea(0xf0),{'type':_0x3d1aea(0x119),'gateway':_0x3cb5de,'endpoint':_0x1c96b7,'method':_0x405731,'data':_0x3be786});}[a59_0x2b2b04(0x136)](_0x31f365,_0x51f171,_0x1d2520,_0x491c63,_0x1561f5){const _0x56351a=a59_0x2b2b04;this[_0x56351a(0x122)](_0x56351a(0x124),{'type':_0x56351a(0xfe),'gateway':_0x31f365,'endpoint':_0x51f171,'status':_0x1d2520,'responseTime':_0x1561f5,'data':_0x491c63});}[a59_0x2b2b04(0xee)](_0x2bf11b,_0x13aa19,_0x437bc0){const _0x23df59=a59_0x2b2b04;this[_0x23df59(0x122)]('white_domain_errors',{'type':_0x23df59(0x105),'gateway':_0x2bf11b,'endpoint':_0x13aa19,'error':_0x437bc0 instanceof Error?{'message':_0x437bc0[_0x23df59(0x12e)],'stack':_0x437bc0[_0x23df59(0x10c)]}:_0x437bc0});}[a59_0x2b2b04(0x139)](_0x3bc847,_0x536820,_0x3739da){const _0x528423=a59_0x2b2b04;this[_0x528423(0x122)](_0x528423(0x133),{'type':_0x528423(0x130),'gateway':_0x3bc847,'headers':_0x3739da,'data':_0x536820});}[a59_0x2b2b04(0xf9)](_0x21c745,_0x421c9e,_0x1a1ab8,_0x39f8d7,_0x39416a){const _0x2c80f2=a59_0x2b2b04;this['writeLog']('webhooks_processed',{'type':_0x2c80f2(0x10d),'gateway':_0x21c745,'paymentId':_0x421c9e,'oldStatus':_0x1a1ab8,'newStatus':_0x39f8d7,'originalData':_0x39416a});}[a59_0x2b2b04(0x123)](_0x40334d,_0xdf10b2,_0x3aaab0){const _0x2c439b=a59_0x2b2b04;this[_0x2c439b(0x122)](_0x2c439b(0x126),{'type':_0x2c439b(0x101),'gateway':_0x40334d,'error':_0xdf10b2 instanceof Error?{'message':_0xdf10b2[_0x2c439b(0x12e)],'stack':_0xdf10b2[_0x2c439b(0x10c)]}:_0xdf10b2,'originalData':_0x3aaab0});}['logCoinToPayStatus'](_0x3c40e8){const _0x17a645=a59_0x2b2b04;this['writeLog'](_0x17a645(0x114),{'type':_0x17a645(0x10f),..._0x3c40e8});}['logCoinToPayError'](_0x247d8e){const _0x3a1684=a59_0x2b2b04;this[_0x3a1684(0x122)](_0x3a1684(0x131),{'type':_0x3a1684(0xf6),..._0x247d8e});}['logShopWebhookSent'](_0x5750ce,_0x161488,_0x58e5b3,_0x4f31bc,_0x1202b1,_0x16b928){const _0xe9424f=a59_0x2b2b04;this[_0xe9424f(0x122)](_0xe9424f(0xf1),{'type':_0xe9424f(0x11e),'shopId':_0x5750ce,'webhookUrl':_0x161488,'event':_0x58e5b3,'status':_0x4f31bc,'responseTime':_0x1202b1,'payload':_0x16b928});}[a59_0x2b2b04(0x129)](_0x597929,_0x10962d,_0x1c0460,_0x20c60c,_0x2f85be){const _0x582636=a59_0x2b2b04;this[_0x582636(0x122)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x597929,'webhookUrl':_0x10962d,'event':_0x1c0460,'error':_0x20c60c instanceof Error?{'message':_0x20c60c[_0x582636(0x12e)],'stack':_0x20c60c[_0x582636(0x10c)]}:_0x20c60c,'payload':_0x2f85be});}[a59_0x2b2b04(0x12f)](_0x163ecf,_0x3b0a4c,_0x3b639e,_0x3adae6,_0x3b2a03){const _0x3e0d21=a59_0x2b2b04;this['writeLog'](_0x3e0d21(0x125),{'type':_0x3e0d21(0xf8),'gateway':_0x163ecf,'paymentId':_0x3b0a4c,'shopId':_0x3b639e,'amount':_0x3adae6,'currency':_0x3b2a03});}[a59_0x2b2b04(0x120)](_0x4b7d17,_0x5edbf6,_0x1e914c,_0x57ed7c,_0x38aacf){const _0x1af45f=a59_0x2b2b04;this['writeLog'](_0x1af45f(0x103),{'type':_0x1af45f(0x127),'endpoint':_0x4b7d17,'method':_0x5edbf6,'userId':_0x1e914c,'userRole':_0x57ed7c,'requestData':_0x38aacf});}['getLogStats'](){const _0xe5d64f=a59_0x2b2b04;try{const _0x382ae0=fs_1[_0xe5d64f(0x12a)][_0xe5d64f(0xed)](this[_0xe5d64f(0x138)]),_0x4448d9=_0x382ae0[_0xe5d64f(0xf5)](_0x3affdd=>_0x3affdd[_0xe5d64f(0x11a)](_0xe5d64f(0x12b))),_0x51390f=[...new Set(_0x4448d9[_0xe5d64f(0x116)](_0x42966f=>_0x42966f['split']('_')[0x0]))],_0x25d2d3=_0x4448d9[_0xe5d64f(0x116)](_0x12efd3=>{const _0x2670ad=_0xe5d64f,_0x9e7c23=path_1[_0x2670ad(0x12a)]['join'](this[_0x2670ad(0x138)],_0x12efd3),_0x575395=fs_1[_0x2670ad(0x12a)][_0x2670ad(0x110)](_0x9e7c23),[_0x3355a8,_0x1e046e]=_0x12efd3[_0x2670ad(0x121)](_0x2670ad(0x12b),'')[_0x2670ad(0x11b)]('_');return{'type':_0x3355a8,'date':_0x1e046e,'size':_0x575395['size']};})['sort']((_0x4e1e17,_0x9449d6)=>_0x9449d6[_0xe5d64f(0xf4)][_0xe5d64f(0xfa)](_0x4e1e17[_0xe5d64f(0xf4)]));return{'totalFiles':_0x4448d9['length'],'logTypes':_0x51390f,'latestLogs':_0x25d2d3['slice'](0x0,0xa)};}catch(_0x376f51){return console[_0xe5d64f(0x100)](_0xe5d64f(0x135),_0x376f51),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x2b2b04(0x109)](_0x500ca5=0x1e){const _0x1b10c9=a59_0x2b2b04;try{const _0x4e3538=fs_1[_0x1b10c9(0x12a)]['readdirSync'](this['logsDir']),_0x2e6d51=new Date();_0x2e6d51['setDate'](_0x2e6d51['getDate']()-_0x500ca5);let _0x3dbbdc=0x0;_0x4e3538[_0x1b10c9(0x118)](_0x49d14d=>{const _0x44bff1=_0x1b10c9;if(!_0x49d14d['endsWith'](_0x44bff1(0x12b)))return;const _0x16ba31=path_1[_0x44bff1(0x12a)]['join'](this[_0x44bff1(0x138)],_0x49d14d),_0x1599a5=fs_1[_0x44bff1(0x12a)]['statSync'](_0x16ba31);_0x1599a5[_0x44bff1(0x117)]<_0x2e6d51&&(fs_1[_0x44bff1(0x12a)]['unlinkSync'](_0x16ba31),_0x3dbbdc++,console[_0x44bff1(0xf7)](_0x44bff1(0x112)+_0x49d14d));}),console[_0x1b10c9(0xf7)]('🧹\x20Cleaned\x20'+_0x3dbbdc+_0x1b10c9(0x102)+_0x500ca5+'\x20days)');}catch(_0x4b81cd){console[_0x1b10c9(0x100)](_0x1b10c9(0xff),_0x4b81cd);}}}exports[a59_0x2b2b04(0x137)]=LoggerService,exports[a59_0x2b2b04(0x10a)]=new LoggerService();