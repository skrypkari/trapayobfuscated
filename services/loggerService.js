'use strict';const a53_0x5778be=a53_0x1486;(function(_0x233b91,_0x3a12f8){const _0x5d797f=a53_0x1486,_0x1e0bc0=_0x233b91();while(!![]){try{const _0x563c78=parseInt(_0x5d797f(0x168))/0x1+parseInt(_0x5d797f(0x178))/0x2+-parseInt(_0x5d797f(0x163))/0x3*(-parseInt(_0x5d797f(0x155))/0x4)+parseInt(_0x5d797f(0x15e))/0x5+parseInt(_0x5d797f(0x161))/0x6+parseInt(_0x5d797f(0x18d))/0x7+-parseInt(_0x5d797f(0x187))/0x8*(parseInt(_0x5d797f(0x15c))/0x9);if(_0x563c78===_0x3a12f8)break;else _0x1e0bc0['push'](_0x1e0bc0['shift']());}catch(_0x48e8ad){_0x1e0bc0['push'](_0x1e0bc0['shift']());}}}(a53_0x2308,0x6e31a));var __importDefault=this&&this[a53_0x5778be(0x16d)]||function(_0x58c4a2){const _0x5fc9b6=a53_0x5778be;return _0x58c4a2&&_0x58c4a2[_0x5fc9b6(0x1a2)]?_0x58c4a2:{'default':_0x58c4a2};};function a53_0x1486(_0x420622,_0x2ab37c){const _0x23080b=a53_0x2308();return a53_0x1486=function(_0x148681,_0x416c0c){_0x148681=_0x148681-0x153;let _0x70c09d=_0x23080b[_0x148681];return _0x70c09d;},a53_0x1486(_0x420622,_0x2ab37c);}Object[a53_0x5778be(0x188)](exports,a53_0x5778be(0x1a2),{'value':!![]}),exports[a53_0x5778be(0x162)]=exports[a53_0x5778be(0x15b)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x5778be(0x15d)));class LoggerService{constructor(){const _0x554a66=a53_0x5778be;this[_0x554a66(0x16c)]=path_1[_0x554a66(0x19f)][_0x554a66(0x169)](process['cwd'](),'logs'),this[_0x554a66(0x192)]();}[a53_0x5778be(0x192)](){const _0x358ad5=a53_0x5778be;!fs_1['default'][_0x358ad5(0x19e)](this[_0x358ad5(0x16c)])&&(fs_1[_0x358ad5(0x19f)][_0x358ad5(0x16f)](this[_0x358ad5(0x16c)],{'recursive':!![]}),console[_0x358ad5(0x189)](_0x358ad5(0x1a6)+this['logsDir']));}[a53_0x5778be(0x17a)](_0x5ef19b){const _0x3b0594=a53_0x5778be,_0x4990e7=new Date()[_0x3b0594(0x166)]()[_0x3b0594(0x153)]('T')[0x0];return path_1['default'][_0x3b0594(0x169)](this[_0x3b0594(0x16c)],_0x5ef19b+'_'+_0x4990e7+_0x3b0594(0x186));}[a53_0x5778be(0x198)](_0x575c00,_0x22fa43){const _0x55748b=a53_0x5778be;try{const _0x50a44d=new Date()[_0x55748b(0x166)](),_0xff59f6={'timestamp':_0x50a44d,..._0x22fa43},_0x5a95c7=JSON[_0x55748b(0x179)](_0xff59f6)+'\x0a',_0x3fd619=this[_0x55748b(0x17a)](_0x575c00);fs_1[_0x55748b(0x19f)][_0x55748b(0x176)](_0x3fd619,_0x5a95c7,_0x55748b(0x15a));}catch(_0x3a82fb){console['error'](_0x55748b(0x172)+_0x575c00+_0x55748b(0x16e),_0x3a82fb);}}[a53_0x5778be(0x183)](_0x225f85,_0x3c62da,_0x51dd2f,_0x38fce5){const _0x41e71b=a53_0x5778be;this[_0x41e71b(0x198)](_0x41e71b(0x17f),{'type':'REQUEST','gateway':_0x225f85,'endpoint':_0x3c62da,'method':_0x51dd2f,'data':_0x38fce5});}[a53_0x5778be(0x194)](_0x199124,_0x1c19d7,_0x48c1fb,_0x2e4792,_0x870d64){const _0x1e1dad=a53_0x5778be;this['writeLog'](_0x1e1dad(0x17e),{'type':'RESPONSE','gateway':_0x199124,'endpoint':_0x1c19d7,'status':_0x48c1fb,'responseTime':_0x870d64,'data':_0x2e4792});}['logWhiteDomainError'](_0x39c521,_0x236825,_0x21852d){const _0x39abdc=a53_0x5778be;this['writeLog']('white_domain_errors',{'type':_0x39abdc(0x173),'gateway':_0x39c521,'endpoint':_0x236825,'error':_0x21852d instanceof Error?{'message':_0x21852d[_0x39abdc(0x156)],'stack':_0x21852d[_0x39abdc(0x197)]}:_0x21852d});}[a53_0x5778be(0x15f)](_0x4bbc00,_0x3093b3,_0xd36b1d){const _0x537cf6=a53_0x5778be;this[_0x537cf6(0x198)](_0x537cf6(0x158),{'type':_0x537cf6(0x18b),'gateway':_0x4bbc00,'headers':_0xd36b1d,'data':_0x3093b3});}[a53_0x5778be(0x164)](_0x4938ba,_0x59bf41,_0x952218,_0xc0fc54,_0x467b59){const _0x47a3bc=a53_0x5778be;this['writeLog']('webhooks_processed',{'type':_0x47a3bc(0x19b),'gateway':_0x4938ba,'paymentId':_0x59bf41,'oldStatus':_0x952218,'newStatus':_0xc0fc54,'originalData':_0x467b59});}[a53_0x5778be(0x17c)](_0x48e970,_0xfa2264,_0x2ef4b8){const _0x26d218=a53_0x5778be;this[_0x26d218(0x198)]('webhooks_errors',{'type':_0x26d218(0x17d),'gateway':_0x48e970,'error':_0xfa2264 instanceof Error?{'message':_0xfa2264['message'],'stack':_0xfa2264['stack']}:_0xfa2264,'originalData':_0x2ef4b8});}[a53_0x5778be(0x185)](_0x4b439c){const _0x35c331=a53_0x5778be;this[_0x35c331(0x198)]('cointopay_status_changes',{'type':_0x35c331(0x18c),..._0x4b439c});}[a53_0x5778be(0x193)](_0x2c2608){const _0x28411c=a53_0x5778be;this['writeLog'](_0x28411c(0x191),{'type':_0x28411c(0x170),..._0x2c2608});}['logShopWebhookSent'](_0x35b14d,_0x69645f,_0x34b2cd,_0x1f368a,_0x3adc1f,_0x28f80a){const _0x460452=a53_0x5778be;this[_0x460452(0x198)](_0x460452(0x160),{'type':_0x460452(0x165),'shopId':_0x35b14d,'webhookUrl':_0x69645f,'event':_0x34b2cd,'status':_0x1f368a,'responseTime':_0x3adc1f,'payload':_0x28f80a});}[a53_0x5778be(0x16b)](_0x182b04,_0x146ebd,_0x1d1131,_0x25f91e,_0x37fd57){const _0x5f03bb=a53_0x5778be;this[_0x5f03bb(0x198)](_0x5f03bb(0x18a),{'type':_0x5f03bb(0x199),'shopId':_0x182b04,'webhookUrl':_0x146ebd,'event':_0x1d1131,'error':_0x25f91e instanceof Error?{'message':_0x25f91e[_0x5f03bb(0x156)],'stack':_0x25f91e[_0x5f03bb(0x197)]}:_0x25f91e,'payload':_0x37fd57});}['logPaymentCreated'](_0x3f55f4,_0x3a0ec5,_0x5d7198,_0x26d82b,_0x3b5550){const _0x587ac3=a53_0x5778be;this[_0x587ac3(0x198)](_0x587ac3(0x17b),{'type':_0x587ac3(0x181),'gateway':_0x3f55f4,'paymentId':_0x3a0ec5,'shopId':_0x5d7198,'amount':_0x26d82b,'currency':_0x3b5550});}['logApiCall'](_0x13aa28,_0x352625,_0x20a687,_0x3607ca,_0x4af53d){const _0x4b2c4f=a53_0x5778be;this['writeLog'](_0x4b2c4f(0x154),{'type':'API_CALL','endpoint':_0x13aa28,'method':_0x352625,'userId':_0x20a687,'userRole':_0x3607ca,'requestData':_0x4af53d});}[a53_0x5778be(0x171)](){const _0x5e0025=a53_0x5778be;try{const _0x857766=fs_1[_0x5e0025(0x19f)][_0x5e0025(0x175)](this[_0x5e0025(0x16c)]),_0x850dbb=_0x857766[_0x5e0025(0x157)](_0x596dab=>_0x596dab[_0x5e0025(0x1a3)](_0x5e0025(0x186))),_0x47ed99=[...new Set(_0x850dbb[_0x5e0025(0x196)](_0x3d45a8=>_0x3d45a8['split']('_')[0x0]))],_0x516844=_0x850dbb[_0x5e0025(0x196)](_0x1b2d13=>{const _0x18e2dd=_0x5e0025,_0x3250f1=path_1['default'][_0x18e2dd(0x169)](this[_0x18e2dd(0x16c)],_0x1b2d13),_0x182282=fs_1['default'][_0x18e2dd(0x180)](_0x3250f1),[_0x556c8b,_0x474eeb]=_0x1b2d13[_0x18e2dd(0x167)](_0x18e2dd(0x186),'')[_0x18e2dd(0x153)]('_');return{'type':_0x556c8b,'date':_0x474eeb,'size':_0x182282[_0x18e2dd(0x177)]};})[_0x5e0025(0x19c)]((_0x26e894,_0x53b73d)=>_0x53b73d[_0x5e0025(0x1a1)][_0x5e0025(0x1a4)](_0x26e894[_0x5e0025(0x1a1)]));return{'totalFiles':_0x850dbb[_0x5e0025(0x1a0)],'logTypes':_0x47ed99,'latestLogs':_0x516844[_0x5e0025(0x16a)](0x0,0xa)};}catch(_0x52722b){return console['error'](_0x5e0025(0x159),_0x52722b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x5778be(0x19d)](_0x39431b=0x1e){const _0x49b24c=a53_0x5778be;try{const _0x409164=fs_1[_0x49b24c(0x19f)]['readdirSync'](this['logsDir']),_0x5a9b29=new Date();_0x5a9b29[_0x49b24c(0x182)](_0x5a9b29[_0x49b24c(0x174)]()-_0x39431b);let _0x19ba57=0x0;_0x409164[_0x49b24c(0x190)](_0x35bdfc=>{const _0x3952ef=_0x49b24c;if(!_0x35bdfc[_0x3952ef(0x1a3)]('.log'))return;const _0x50bbf8=path_1['default'][_0x3952ef(0x169)](this[_0x3952ef(0x16c)],_0x35bdfc),_0x356af2=fs_1['default'][_0x3952ef(0x180)](_0x50bbf8);_0x356af2[_0x3952ef(0x1a7)]<_0x5a9b29&&(fs_1[_0x3952ef(0x19f)][_0x3952ef(0x184)](_0x50bbf8),_0x19ba57++,console[_0x3952ef(0x189)](_0x3952ef(0x18e)+_0x35bdfc));}),console[_0x49b24c(0x189)]('🧹\x20Cleaned\x20'+_0x19ba57+_0x49b24c(0x19a)+_0x39431b+_0x49b24c(0x1a5));}catch(_0x1c2caa){console[_0x49b24c(0x18f)](_0x49b24c(0x195),_0x1c2caa);}}}exports[a53_0x5778be(0x15b)]=LoggerService,exports['loggerService']=new LoggerService();function a53_0x2308(){const _0x27b96a=['\x20days)','📁\x20Created\x20logs\x20directory:\x20','mtime','split','api_calls','304dvypyQ','message','filter','webhooks_received','Failed\x20to\x20get\x20log\x20stats:','utf8','LoggerService','9IOpPac','path','68250LHiRqs','logWebhookReceived','shop_webhooks_sent','3570666hVXLUG','loggerService','237tuklsn','logWebhookProcessed','SHOP_WEBHOOK_SENT','toISOString','replace','621053uSOMkj','join','slice','logShopWebhookError','logsDir','__importDefault','\x20log:','mkdirSync','COINTOPAY_ERROR','getLogStats','Failed\x20to\x20write\x20','ERROR','getDate','readdirSync','appendFileSync','size','635162qOyhnI','stringify','getLogFileName','payments_created','logWebhookError','WEBHOOK_ERROR','white_domain_responses','white_domain_requests','statSync','PAYMENT_CREATED','setDate','logWhiteDomainRequest','unlinkSync','logCoinToPayStatus','.log','13057880IEkOwN','defineProperty','log','shop_webhooks_errors','WEBHOOK_RECEIVED','COINTOPAY_STATUS_CHANGE','3711330FTmSXU','🗑️\x20Deleted\x20old\x20log\x20file:\x20','error','forEach','cointopay_errors','ensureLogsDirectory','logCoinToPayError','logWhiteDomainResponse','Failed\x20to\x20clean\x20old\x20logs:','map','stack','writeLog','SHOP_WEBHOOK_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','WEBHOOK_PROCESSED','sort','cleanOldLogs','existsSync','default','length','date','__esModule','endsWith','localeCompare'];a53_0x2308=function(){return _0x27b96a;};return a53_0x2308();}