'use strict';const a51_0x4016d2=a51_0x3ec3;(function(_0x82e2ea,_0x184b52){const _0x319523=a51_0x3ec3,_0x45aa7e=_0x82e2ea();while(!![]){try{const _0x37358e=-parseInt(_0x319523(0x168))/0x1+parseInt(_0x319523(0x166))/0x2*(-parseInt(_0x319523(0x187))/0x3)+parseInt(_0x319523(0x190))/0x4+-parseInt(_0x319523(0x184))/0x5+parseInt(_0x319523(0x14f))/0x6+-parseInt(_0x319523(0x17a))/0x7+parseInt(_0x319523(0x14c))/0x8;if(_0x37358e===_0x184b52)break;else _0x45aa7e['push'](_0x45aa7e['shift']());}catch(_0x2e7acb){_0x45aa7e['push'](_0x45aa7e['shift']());}}}(a51_0x32bd,0x1ecc9));function a51_0x32bd(){const _0x476a7d=['readdirSync','Failed\x20to\x20get\x20log\x20stats:','1066933HgYkFs','🗑️\x20Deleted\x20old\x20log\x20file:\x20','sort','localeCompare','setDate','\x20log:','COINTOPAY_STATUS_CHANGE','white_domain_requests','stack','logApiCall','1143115rrEDgy','LoggerService','split','6708VdtFfS','cleanOldLogs','stringify','default','🧹\x20Cleaned\x20','utf8','payments_created','logWhiteDomainRequest','webhooks_errors','293820UqWNsy','PAYMENT_CREATED','logWhiteDomainResponse','API_CALL','getDate','defineProperty','filter','shop_webhooks_sent','REQUEST','replace','4743312kflEBV','WEBHOOK_PROCESSED','SHOP_WEBHOOK_ERROR','584178MBEdih','logWebhookReceived','map','logsDir','logWhiteDomainError','writeLog','\x20days)','size','cointopay_status_changes','toISOString','log','ensureLogsDirectory','COINTOPAY_ERROR','getLogFileName','.log','loggerService','cwd','white_domain_responses','slice','forEach','WEBHOOK_RECEIVED','logShopWebhookSent','ERROR','128TInwTu','Failed\x20to\x20write\x20','113433onoyjr','getLogStats','logWebhookError','logs','error','date','__esModule','white_domain_errors','length','message','existsSync','join','📁\x20Created\x20logs\x20directory:\x20','statSync','shop_webhooks_errors','SHOP_WEBHOOK_SENT'];a51_0x32bd=function(){return _0x476a7d;};return a51_0x32bd();}var __importDefault=this&&this['__importDefault']||function(_0x106d04){const _0x35e9b3=a51_0x3ec3;return _0x106d04&&_0x106d04[_0x35e9b3(0x16e)]?_0x106d04:{'default':_0x106d04};};Object[a51_0x4016d2(0x195)](exports,a51_0x4016d2(0x16e),{'value':!![]}),exports[a51_0x4016d2(0x15e)]=exports[a51_0x4016d2(0x185)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x3cc5f2=a51_0x4016d2;this[_0x3cc5f2(0x152)]=path_1[_0x3cc5f2(0x18a)][_0x3cc5f2(0x173)](process[_0x3cc5f2(0x15f)](),_0x3cc5f2(0x16b)),this[_0x3cc5f2(0x15a)]();}[a51_0x4016d2(0x15a)](){const _0x30091b=a51_0x4016d2;!fs_1[_0x30091b(0x18a)][_0x30091b(0x172)](this[_0x30091b(0x152)])&&(fs_1[_0x30091b(0x18a)]['mkdirSync'](this[_0x30091b(0x152)],{'recursive':!![]}),console[_0x30091b(0x159)](_0x30091b(0x174)+this[_0x30091b(0x152)]));}['getLogFileName'](_0x1bd051){const _0x475784=a51_0x4016d2,_0x1cca24=new Date()[_0x475784(0x158)]()['split']('T')[0x0];return path_1[_0x475784(0x18a)][_0x475784(0x173)](this[_0x475784(0x152)],_0x1bd051+'_'+_0x1cca24+_0x475784(0x15d));}[a51_0x4016d2(0x154)](_0x42ee5f,_0xce8e7e){const _0x106f0c=a51_0x4016d2;try{const _0x5bc5e2=new Date()[_0x106f0c(0x158)](),_0x5260d6={'timestamp':_0x5bc5e2,..._0xce8e7e},_0x46ac7f=JSON[_0x106f0c(0x189)](_0x5260d6)+'\x0a',_0x748b2=this[_0x106f0c(0x15c)](_0x42ee5f);fs_1['default']['appendFileSync'](_0x748b2,_0x46ac7f,_0x106f0c(0x18c));}catch(_0x26a933){console[_0x106f0c(0x16c)](_0x106f0c(0x167)+_0x42ee5f+_0x106f0c(0x17f),_0x26a933);}}[a51_0x4016d2(0x18e)](_0x56366b,_0x3b3888,_0x2f4351,_0x528729){const _0x238fe7=a51_0x4016d2;this[_0x238fe7(0x154)](_0x238fe7(0x181),{'type':_0x238fe7(0x198),'gateway':_0x56366b,'endpoint':_0x3b3888,'method':_0x2f4351,'data':_0x528729});}[a51_0x4016d2(0x192)](_0x54b895,_0x2d3c76,_0x5cde5a,_0x1b4f59,_0xa93205){const _0x19153a=a51_0x4016d2;this[_0x19153a(0x154)](_0x19153a(0x160),{'type':'RESPONSE','gateway':_0x54b895,'endpoint':_0x2d3c76,'status':_0x5cde5a,'responseTime':_0xa93205,'data':_0x1b4f59});}[a51_0x4016d2(0x153)](_0x274a13,_0x3e1c8c,_0x30f7a8){const _0x414b9e=a51_0x4016d2;this[_0x414b9e(0x154)](_0x414b9e(0x16f),{'type':_0x414b9e(0x165),'gateway':_0x274a13,'endpoint':_0x3e1c8c,'error':_0x30f7a8 instanceof Error?{'message':_0x30f7a8[_0x414b9e(0x171)],'stack':_0x30f7a8[_0x414b9e(0x182)]}:_0x30f7a8});}[a51_0x4016d2(0x150)](_0xbfa704,_0x2f0ae5,_0x12006a){const _0x2eaddd=a51_0x4016d2;this[_0x2eaddd(0x154)]('webhooks_received',{'type':_0x2eaddd(0x163),'gateway':_0xbfa704,'headers':_0x12006a,'data':_0x2f0ae5});}['logWebhookProcessed'](_0x5f232d,_0x4515f9,_0x533ca0,_0x161073,_0x45be3c){const _0x5b5e10=a51_0x4016d2;this[_0x5b5e10(0x154)]('webhooks_processed',{'type':_0x5b5e10(0x14d),'gateway':_0x5f232d,'paymentId':_0x4515f9,'oldStatus':_0x533ca0,'newStatus':_0x161073,'originalData':_0x45be3c});}[a51_0x4016d2(0x16a)](_0x3a32f0,_0x4e5afd,_0x315410){const _0x3228f5=a51_0x4016d2;this[_0x3228f5(0x154)](_0x3228f5(0x18f),{'type':'WEBHOOK_ERROR','gateway':_0x3a32f0,'error':_0x4e5afd instanceof Error?{'message':_0x4e5afd[_0x3228f5(0x171)],'stack':_0x4e5afd[_0x3228f5(0x182)]}:_0x4e5afd,'originalData':_0x315410});}['logCoinToPayStatus'](_0x5f9b97){const _0x226401=a51_0x4016d2;this['writeLog'](_0x226401(0x157),{'type':_0x226401(0x180),..._0x5f9b97});}['logCoinToPayError'](_0x91120f){const _0x21d844=a51_0x4016d2;this['writeLog']('cointopay_errors',{'type':_0x21d844(0x15b),..._0x91120f});}[a51_0x4016d2(0x164)](_0x4b72c6,_0x459cbf,_0x357a6c,_0x1e2e34,_0x1aaf55,_0x2b83cd){const _0x496ff9=a51_0x4016d2;this[_0x496ff9(0x154)](_0x496ff9(0x197),{'type':_0x496ff9(0x177),'shopId':_0x4b72c6,'webhookUrl':_0x459cbf,'event':_0x357a6c,'status':_0x1e2e34,'responseTime':_0x1aaf55,'payload':_0x2b83cd});}['logShopWebhookError'](_0x2a8d85,_0x4c6acc,_0x47b22b,_0x3c6dc0,_0x1b53b7){const _0x1c946e=a51_0x4016d2;this[_0x1c946e(0x154)](_0x1c946e(0x176),{'type':_0x1c946e(0x14e),'shopId':_0x2a8d85,'webhookUrl':_0x4c6acc,'event':_0x47b22b,'error':_0x3c6dc0 instanceof Error?{'message':_0x3c6dc0[_0x1c946e(0x171)],'stack':_0x3c6dc0[_0x1c946e(0x182)]}:_0x3c6dc0,'payload':_0x1b53b7});}['logPaymentCreated'](_0x14a54c,_0x26fc4b,_0x1a0ee4,_0x1375b9,_0xf9bfdb){const _0x22d189=a51_0x4016d2;this[_0x22d189(0x154)](_0x22d189(0x18d),{'type':_0x22d189(0x191),'gateway':_0x14a54c,'paymentId':_0x26fc4b,'shopId':_0x1a0ee4,'amount':_0x1375b9,'currency':_0xf9bfdb});}[a51_0x4016d2(0x183)](_0x582800,_0x1bfba1,_0xf4b6bc,_0x249508,_0x5bdfb7){const _0x7ee327=a51_0x4016d2;this[_0x7ee327(0x154)]('api_calls',{'type':_0x7ee327(0x193),'endpoint':_0x582800,'method':_0x1bfba1,'userId':_0xf4b6bc,'userRole':_0x249508,'requestData':_0x5bdfb7});}[a51_0x4016d2(0x169)](){const _0x4f4381=a51_0x4016d2;try{const _0x2bb4e6=fs_1[_0x4f4381(0x18a)][_0x4f4381(0x178)](this['logsDir']),_0x60a58e=_0x2bb4e6[_0x4f4381(0x196)](_0x3a2e8a=>_0x3a2e8a['endsWith'](_0x4f4381(0x15d))),_0x5931e7=[...new Set(_0x60a58e[_0x4f4381(0x151)](_0x2bc2f9=>_0x2bc2f9[_0x4f4381(0x186)]('_')[0x0]))],_0x4cc741=_0x60a58e[_0x4f4381(0x151)](_0x527860=>{const _0x40b4b2=_0x4f4381,_0x446c02=path_1[_0x40b4b2(0x18a)][_0x40b4b2(0x173)](this[_0x40b4b2(0x152)],_0x527860),_0x37e837=fs_1['default'][_0x40b4b2(0x175)](_0x446c02),[_0x31eed4,_0xb3ce4a]=_0x527860[_0x40b4b2(0x199)]('.log','')[_0x40b4b2(0x186)]('_');return{'type':_0x31eed4,'date':_0xb3ce4a,'size':_0x37e837[_0x40b4b2(0x156)]};})[_0x4f4381(0x17c)]((_0x27a384,_0x385abc)=>_0x385abc['date'][_0x4f4381(0x17d)](_0x27a384[_0x4f4381(0x16d)]));return{'totalFiles':_0x60a58e[_0x4f4381(0x170)],'logTypes':_0x5931e7,'latestLogs':_0x4cc741[_0x4f4381(0x161)](0x0,0xa)};}catch(_0x3a2617){return console[_0x4f4381(0x16c)](_0x4f4381(0x179),_0x3a2617),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x4016d2(0x188)](_0x2e2eff=0x1e){const _0x9f9e8e=a51_0x4016d2;try{const _0x5a102d=fs_1[_0x9f9e8e(0x18a)][_0x9f9e8e(0x178)](this[_0x9f9e8e(0x152)]),_0x22b4e9=new Date();_0x22b4e9[_0x9f9e8e(0x17e)](_0x22b4e9[_0x9f9e8e(0x194)]()-_0x2e2eff);let _0x58f175=0x0;_0x5a102d[_0x9f9e8e(0x162)](_0x3b404f=>{const _0x5da40a=_0x9f9e8e;if(!_0x3b404f['endsWith'](_0x5da40a(0x15d)))return;const _0x5b0148=path_1[_0x5da40a(0x18a)]['join'](this['logsDir'],_0x3b404f),_0x2b7b54=fs_1[_0x5da40a(0x18a)][_0x5da40a(0x175)](_0x5b0148);_0x2b7b54['mtime']<_0x22b4e9&&(fs_1[_0x5da40a(0x18a)]['unlinkSync'](_0x5b0148),_0x58f175++,console['log'](_0x5da40a(0x17b)+_0x3b404f));}),console['log'](_0x9f9e8e(0x18b)+_0x58f175+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x2e2eff+_0x9f9e8e(0x155));}catch(_0x4cd040){console[_0x9f9e8e(0x16c)]('Failed\x20to\x20clean\x20old\x20logs:',_0x4cd040);}}}function a51_0x3ec3(_0x1ff124,_0x6fd872){const _0x32bda2=a51_0x32bd();return a51_0x3ec3=function(_0x3ec383,_0x15d28b){_0x3ec383=_0x3ec383-0x14c;let _0x24fbb0=_0x32bda2[_0x3ec383];return _0x24fbb0;},a51_0x3ec3(_0x1ff124,_0x6fd872);}exports[a51_0x4016d2(0x185)]=LoggerService,exports['loggerService']=new LoggerService();