'use strict';const a49_0x1a723d=a49_0x541d;(function(_0x2599b6,_0x922dba){const _0x130652=a49_0x541d,_0xa12105=_0x2599b6();while(!![]){try{const _0x385502=parseInt(_0x130652(0xea))/0x1+-parseInt(_0x130652(0xcd))/0x2*(-parseInt(_0x130652(0xca))/0x3)+-parseInt(_0x130652(0xf4))/0x4+parseInt(_0x130652(0xe0))/0x5+parseInt(_0x130652(0xbc))/0x6*(-parseInt(_0x130652(0x109))/0x7)+parseInt(_0x130652(0xc6))/0x8*(-parseInt(_0x130652(0xe3))/0x9)+parseInt(_0x130652(0xd8))/0xa*(parseInt(_0x130652(0xdc))/0xb);if(_0x385502===_0x922dba)break;else _0xa12105['push'](_0xa12105['shift']());}catch(_0x109378){_0xa12105['push'](_0xa12105['shift']());}}}(a49_0x2315,0x8ea7e));var __importDefault=this&&this['__importDefault']||function(_0x5cbd52){const _0x3ad72f=a49_0x541d;return _0x5cbd52&&_0x5cbd52[_0x3ad72f(0xde)]?_0x5cbd52:{'default':_0x5cbd52};};Object[a49_0x1a723d(0xe9)](exports,'__esModule',{'value':!![]}),exports[a49_0x1a723d(0xfd)]=exports[a49_0x1a723d(0xf1)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x1a723d(0xbb)));function a49_0x2315(){const _0x56c11a=['3ujCWMf','default','cointopay_status_changes','589318dRAUFy','forEach','API_CALL','message','appendFileSync','\x20old\x20log\x20files\x20(older\x20than\x20','WEBHOOK_RECEIVED','PAYMENT_CREATED','mkdirSync','length','🗑️\x20Deleted\x20old\x20log\x20file:\x20','60240aJzKng','🧹\x20Cleaned\x20','webhooks_processed','getLogStats','1375MHNJuS','white_domain_responses','__esModule','logShopWebhookError','706945GPKljb','logsDir','getLogFileName','11034TVnAWY','endsWith','readdirSync','ensureLogsDirectory','.log','utf8','defineProperty','914278JfKoJZ','REQUEST','filter','replace','logWebhookProcessed','split','logCoinToPayStatus','LoggerService','existsSync','WEBHOOK_ERROR','1566704nPYEha','logWhiteDomainError','webhooks_received','error','getDate','api_calls','date','logShopWebhookSent','webhooks_errors','loggerService','SHOP_WEBHOOK_ERROR','shop_webhooks_sent','logWebhookReceived','slice','WEBHOOK_PROCESSED','white_domain_requests','size','statSync','map','logPaymentCreated','\x20log:','42YNSiMd','join','toISOString','Failed\x20to\x20write\x20','logs','logWhiteDomainResponse','path','510654cjnNPL','white_domain_errors','cleanOldLogs','COINTOPAY_ERROR','stack','unlinkSync','logApiCall','stringify','payments_created','log','4024eKTzUc','ERROR','writeLog','📁\x20Created\x20logs\x20directory:\x20'];a49_0x2315=function(){return _0x56c11a;};return a49_0x2315();}class LoggerService{constructor(){const _0x5bd84e=a49_0x1a723d;this[_0x5bd84e(0xe1)]=path_1[_0x5bd84e(0xcb)][_0x5bd84e(0x10a)](process['cwd'](),_0x5bd84e(0x10d)),this['ensureLogsDirectory']();}[a49_0x1a723d(0xe6)](){const _0x4dde6c=a49_0x1a723d;!fs_1[_0x4dde6c(0xcb)][_0x4dde6c(0xf2)](this['logsDir'])&&(fs_1[_0x4dde6c(0xcb)][_0x4dde6c(0xd5)](this[_0x4dde6c(0xe1)],{'recursive':!![]}),console[_0x4dde6c(0xc5)](_0x4dde6c(0xc9)+this['logsDir']));}[a49_0x1a723d(0xe2)](_0x26ae58){const _0x508ae1=a49_0x1a723d,_0x2cc68f=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x508ae1(0xcb)][_0x508ae1(0x10a)](this['logsDir'],_0x26ae58+'_'+_0x2cc68f+'.log');}[a49_0x1a723d(0xc8)](_0x164eb6,_0x55d4f9){const _0x4371f9=a49_0x1a723d;try{const _0x567ff1=new Date()[_0x4371f9(0x10b)](),_0x255288={'timestamp':_0x567ff1,..._0x55d4f9},_0x582d97=JSON[_0x4371f9(0xc3)](_0x255288)+'\x0a',_0x3ec7ee=this[_0x4371f9(0xe2)](_0x164eb6);fs_1[_0x4371f9(0xcb)][_0x4371f9(0xd1)](_0x3ec7ee,_0x582d97,_0x4371f9(0xe8));}catch(_0x2b7ae9){console[_0x4371f9(0xf7)](_0x4371f9(0x10c)+_0x164eb6+_0x4371f9(0x108),_0x2b7ae9);}}['logWhiteDomainRequest'](_0x4a09f6,_0x1d48ed,_0x4442b4,_0x228765){const _0x63400b=a49_0x1a723d;this[_0x63400b(0xc8)](_0x63400b(0x103),{'type':_0x63400b(0xeb),'gateway':_0x4a09f6,'endpoint':_0x1d48ed,'method':_0x4442b4,'data':_0x228765});}[a49_0x1a723d(0xba)](_0x350d0c,_0x1ddbe5,_0x12c975,_0x5eae7e,_0x41b5f6){const _0x3a5b70=a49_0x1a723d;this['writeLog'](_0x3a5b70(0xdd),{'type':'RESPONSE','gateway':_0x350d0c,'endpoint':_0x1ddbe5,'status':_0x12c975,'responseTime':_0x41b5f6,'data':_0x5eae7e});}[a49_0x1a723d(0xf5)](_0x5c5956,_0x2a925c,_0x40a60b){const _0x426b4a=a49_0x1a723d;this[_0x426b4a(0xc8)](_0x426b4a(0xbd),{'type':_0x426b4a(0xc7),'gateway':_0x5c5956,'endpoint':_0x2a925c,'error':_0x40a60b instanceof Error?{'message':_0x40a60b[_0x426b4a(0xd0)],'stack':_0x40a60b[_0x426b4a(0xc0)]}:_0x40a60b});}[a49_0x1a723d(0x100)](_0x5e3d23,_0x57c5c5,_0x1e5cf0){const _0x352ceb=a49_0x1a723d;this['writeLog'](_0x352ceb(0xf6),{'type':_0x352ceb(0xd3),'gateway':_0x5e3d23,'headers':_0x1e5cf0,'data':_0x57c5c5});}[a49_0x1a723d(0xee)](_0x2ca4d5,_0x5b6f7d,_0x37be0f,_0x4083b8,_0x442617){const _0x3acb36=a49_0x1a723d;this[_0x3acb36(0xc8)](_0x3acb36(0xda),{'type':_0x3acb36(0x102),'gateway':_0x2ca4d5,'paymentId':_0x5b6f7d,'oldStatus':_0x37be0f,'newStatus':_0x4083b8,'originalData':_0x442617});}['logWebhookError'](_0x15d810,_0x5da8af,_0x370d20){const _0x3d6b61=a49_0x1a723d;this['writeLog'](_0x3d6b61(0xfc),{'type':_0x3d6b61(0xf3),'gateway':_0x15d810,'error':_0x5da8af instanceof Error?{'message':_0x5da8af[_0x3d6b61(0xd0)],'stack':_0x5da8af['stack']}:_0x5da8af,'originalData':_0x370d20});}[a49_0x1a723d(0xf0)](_0x5ab9ed){const _0x3923d8=a49_0x1a723d;this[_0x3923d8(0xc8)](_0x3923d8(0xcc),{'type':'COINTOPAY_STATUS_CHANGE',..._0x5ab9ed});}['logCoinToPayError'](_0x848ef0){const _0xafe892=a49_0x1a723d;this[_0xafe892(0xc8)]('cointopay_errors',{'type':_0xafe892(0xbf),..._0x848ef0});}[a49_0x1a723d(0xfb)](_0x10af2a,_0x2e3648,_0x46b4e2,_0x4d7d60,_0x481a12,_0x176f05){const _0x4c9fc9=a49_0x1a723d;this[_0x4c9fc9(0xc8)](_0x4c9fc9(0xff),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x10af2a,'webhookUrl':_0x2e3648,'event':_0x46b4e2,'status':_0x4d7d60,'responseTime':_0x481a12,'payload':_0x176f05});}[a49_0x1a723d(0xdf)](_0x58b559,_0x4419c5,_0x3f64d7,_0x5b4569,_0xaf098c){const _0x4fa49c=a49_0x1a723d;this[_0x4fa49c(0xc8)]('shop_webhooks_errors',{'type':_0x4fa49c(0xfe),'shopId':_0x58b559,'webhookUrl':_0x4419c5,'event':_0x3f64d7,'error':_0x5b4569 instanceof Error?{'message':_0x5b4569[_0x4fa49c(0xd0)],'stack':_0x5b4569[_0x4fa49c(0xc0)]}:_0x5b4569,'payload':_0xaf098c});}[a49_0x1a723d(0x107)](_0x40d5e7,_0x2e83c1,_0x542cd0,_0x3db195,_0x2b4ab8){const _0x19f28c=a49_0x1a723d;this[_0x19f28c(0xc8)](_0x19f28c(0xc4),{'type':_0x19f28c(0xd4),'gateway':_0x40d5e7,'paymentId':_0x2e83c1,'shopId':_0x542cd0,'amount':_0x3db195,'currency':_0x2b4ab8});}[a49_0x1a723d(0xc2)](_0x1d20f7,_0x13a328,_0x323aed,_0x4b342c,_0x3d6d0f){const _0x398615=a49_0x1a723d;this['writeLog'](_0x398615(0xf9),{'type':_0x398615(0xcf),'endpoint':_0x1d20f7,'method':_0x13a328,'userId':_0x323aed,'userRole':_0x4b342c,'requestData':_0x3d6d0f});}[a49_0x1a723d(0xdb)](){const _0x387138=a49_0x1a723d;try{const _0x5bf028=fs_1[_0x387138(0xcb)][_0x387138(0xe5)](this[_0x387138(0xe1)]),_0x44316e=_0x5bf028[_0x387138(0xec)](_0x5ba962=>_0x5ba962[_0x387138(0xe4)](_0x387138(0xe7))),_0x178bee=[...new Set(_0x44316e[_0x387138(0x106)](_0x205697=>_0x205697[_0x387138(0xef)]('_')[0x0]))],_0x3ee219=_0x44316e[_0x387138(0x106)](_0x359634=>{const _0x5e81d1=_0x387138,_0x5685d3=path_1[_0x5e81d1(0xcb)][_0x5e81d1(0x10a)](this[_0x5e81d1(0xe1)],_0x359634),_0x3fecb3=fs_1[_0x5e81d1(0xcb)][_0x5e81d1(0x105)](_0x5685d3),[_0xf716c6,_0xcb4ac5]=_0x359634[_0x5e81d1(0xed)]('.log','')[_0x5e81d1(0xef)]('_');return{'type':_0xf716c6,'date':_0xcb4ac5,'size':_0x3fecb3[_0x5e81d1(0x104)]};})['sort']((_0x1e9bbe,_0x13de89)=>_0x13de89[_0x387138(0xfa)]['localeCompare'](_0x1e9bbe[_0x387138(0xfa)]));return{'totalFiles':_0x44316e[_0x387138(0xd6)],'logTypes':_0x178bee,'latestLogs':_0x3ee219[_0x387138(0x101)](0x0,0xa)};}catch(_0x44fe31){return console[_0x387138(0xf7)]('Failed\x20to\x20get\x20log\x20stats:',_0x44fe31),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x1a723d(0xbe)](_0x27b877=0x1e){const _0x18dc20=a49_0x1a723d;try{const _0x28dc91=fs_1[_0x18dc20(0xcb)][_0x18dc20(0xe5)](this['logsDir']),_0x40587d=new Date();_0x40587d['setDate'](_0x40587d[_0x18dc20(0xf8)]()-_0x27b877);let _0x8a3d20=0x0;_0x28dc91[_0x18dc20(0xce)](_0x4e6638=>{const _0x28bed3=_0x18dc20;if(!_0x4e6638['endsWith'](_0x28bed3(0xe7)))return;const _0x21309c=path_1[_0x28bed3(0xcb)][_0x28bed3(0x10a)](this['logsDir'],_0x4e6638),_0x52b404=fs_1[_0x28bed3(0xcb)][_0x28bed3(0x105)](_0x21309c);_0x52b404['mtime']<_0x40587d&&(fs_1[_0x28bed3(0xcb)][_0x28bed3(0xc1)](_0x21309c),_0x8a3d20++,console[_0x28bed3(0xc5)](_0x28bed3(0xd7)+_0x4e6638));}),console['log'](_0x18dc20(0xd9)+_0x8a3d20+_0x18dc20(0xd2)+_0x27b877+'\x20days)');}catch(_0x4858bd){console[_0x18dc20(0xf7)]('Failed\x20to\x20clean\x20old\x20logs:',_0x4858bd);}}}function a49_0x541d(_0x2722eb,_0x49e5ef){const _0x231516=a49_0x2315();return a49_0x541d=function(_0x541d24,_0x1e60ec){_0x541d24=_0x541d24-0xba;let _0x5bebc4=_0x231516[_0x541d24];return _0x5bebc4;},a49_0x541d(_0x2722eb,_0x49e5ef);}exports[a49_0x1a723d(0xf1)]=LoggerService,exports[a49_0x1a723d(0xfd)]=new LoggerService();