'use strict';const a53_0x566eb2=a53_0x503e;(function(_0x1e5151,_0x518bd0){const _0x388e9a=a53_0x503e,_0x227e9f=_0x1e5151();while(!![]){try{const _0x56c488=-parseInt(_0x388e9a(0xc0))/0x1+-parseInt(_0x388e9a(0xfb))/0x2*(parseInt(_0x388e9a(0xe0))/0x3)+parseInt(_0x388e9a(0xc5))/0x4+-parseInt(_0x388e9a(0xdc))/0x5+-parseInt(_0x388e9a(0xfa))/0x6*(parseInt(_0x388e9a(0xf4))/0x7)+parseInt(_0x388e9a(0xd8))/0x8*(parseInt(_0x388e9a(0xbf))/0x9)+parseInt(_0x388e9a(0xc1))/0xa*(parseInt(_0x388e9a(0x100))/0xb);if(_0x56c488===_0x518bd0)break;else _0x227e9f['push'](_0x227e9f['shift']());}catch(_0x124c8b){_0x227e9f['push'](_0x227e9f['shift']());}}}(a53_0x5a6b,0x26b4f));var __importDefault=this&&this[a53_0x566eb2(0x107)]||function(_0x36c3e0){const _0x33e32b=a53_0x566eb2;return _0x36c3e0&&_0x36c3e0[_0x33e32b(0x102)]?_0x36c3e0:{'default':_0x36c3e0};};Object[a53_0x566eb2(0xcf)](exports,a53_0x566eb2(0x102),{'value':!![]}),exports[a53_0x566eb2(0x10e)]=exports[a53_0x566eb2(0x10c)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x566eb2(0xcb)));class LoggerService{constructor(){const _0x28cd1d=a53_0x566eb2;this['logsDir']=path_1[_0x28cd1d(0xdb)][_0x28cd1d(0xff)](process[_0x28cd1d(0xe7)](),_0x28cd1d(0xce)),this['ensureLogsDirectory']();}[a53_0x566eb2(0x110)](){const _0xebd3d=a53_0x566eb2;!fs_1[_0xebd3d(0xdb)][_0xebd3d(0xc9)](this['logsDir'])&&(fs_1[_0xebd3d(0xdb)]['mkdirSync'](this['logsDir'],{'recursive':!![]}),console['log'](_0xebd3d(0xcd)+this[_0xebd3d(0xc7)]));}[a53_0x566eb2(0xe3)](_0x123301){const _0x5588e2=a53_0x566eb2,_0x1d3975=new Date()[_0x5588e2(0x112)]()[_0x5588e2(0xe5)]('T')[0x0];return path_1[_0x5588e2(0xdb)][_0x5588e2(0xff)](this['logsDir'],_0x123301+'_'+_0x1d3975+_0x5588e2(0x10a));}[a53_0x566eb2(0x104)](_0x291a51,_0x563ee8){const _0x21a20b=a53_0x566eb2;try{const _0x532a9c=new Date()[_0x21a20b(0x112)](),_0x23e2ce={'timestamp':_0x532a9c,..._0x563ee8},_0xa3f58f=JSON[_0x21a20b(0x106)](_0x23e2ce)+'\x0a',_0x2a0f46=this['getLogFileName'](_0x291a51);fs_1[_0x21a20b(0xdb)]['appendFileSync'](_0x2a0f46,_0xa3f58f,'utf8');}catch(_0x39e4ce){console[_0x21a20b(0xc3)](_0x21a20b(0x111)+_0x291a51+_0x21a20b(0xca),_0x39e4ce);}}[a53_0x566eb2(0xdf)](_0x4436d8,_0x11f9ca,_0x8e19e1,_0x3b3d67){const _0x48413c=a53_0x566eb2;this[_0x48413c(0x104)](_0x48413c(0xd0),{'type':_0x48413c(0xe2),'gateway':_0x4436d8,'endpoint':_0x11f9ca,'method':_0x8e19e1,'data':_0x3b3d67});}[a53_0x566eb2(0xf1)](_0x418e4c,_0xf5191b,_0x525548,_0x2b6aa2,_0x36de36){const _0x1284c1=a53_0x566eb2;this[_0x1284c1(0x104)](_0x1284c1(0x10d),{'type':_0x1284c1(0xf8),'gateway':_0x418e4c,'endpoint':_0xf5191b,'status':_0x525548,'responseTime':_0x36de36,'data':_0x2b6aa2});}['logWhiteDomainError'](_0x3c458b,_0x425994,_0x1dae33){const _0x51556a=a53_0x566eb2;this['writeLog'](_0x51556a(0xef),{'type':_0x51556a(0xea),'gateway':_0x3c458b,'endpoint':_0x425994,'error':_0x1dae33 instanceof Error?{'message':_0x1dae33[_0x51556a(0xf9)],'stack':_0x1dae33['stack']}:_0x1dae33});}[a53_0x566eb2(0xd6)](_0x2eef03,_0x351bb5,_0x2246c0){const _0x5ef6d8=a53_0x566eb2;this[_0x5ef6d8(0x104)](_0x5ef6d8(0xf6),{'type':_0x5ef6d8(0xc4),'gateway':_0x2eef03,'headers':_0x2246c0,'data':_0x351bb5});}['logWebhookProcessed'](_0x5d0b3b,_0x3e8b8d,_0x4bb516,_0x23c7bd,_0x25c6b1){const _0x145129=a53_0x566eb2;this[_0x145129(0x104)](_0x145129(0xd3),{'type':_0x145129(0x109),'gateway':_0x5d0b3b,'paymentId':_0x3e8b8d,'oldStatus':_0x4bb516,'newStatus':_0x23c7bd,'originalData':_0x25c6b1});}[a53_0x566eb2(0x10b)](_0x512345,_0x2f28fe,_0x25c362){const _0x1ed54c=a53_0x566eb2;this['writeLog'](_0x1ed54c(0xf2),{'type':'WEBHOOK_ERROR','gateway':_0x512345,'error':_0x2f28fe instanceof Error?{'message':_0x2f28fe['message'],'stack':_0x2f28fe[_0x1ed54c(0xd7)]}:_0x2f28fe,'originalData':_0x25c362});}[a53_0x566eb2(0x103)](_0x3992a5){const _0x365458=a53_0x566eb2;this[_0x365458(0x104)](_0x365458(0xe4),{'type':_0x365458(0xc8),..._0x3992a5});}[a53_0x566eb2(0xfc)](_0x264086){const _0x2c51fb=a53_0x566eb2;this[_0x2c51fb(0x104)](_0x2c51fb(0xde),{'type':_0x2c51fb(0xf7),..._0x264086});}[a53_0x566eb2(0xfe)](_0x30a490,_0x135e87,_0x2de08b,_0x27a5b9,_0x5a812d,_0x22f0b2){const _0xccf04f=a53_0x566eb2;this[_0xccf04f(0x104)](_0xccf04f(0xee),{'type':_0xccf04f(0x105),'shopId':_0x30a490,'webhookUrl':_0x135e87,'event':_0x2de08b,'status':_0x27a5b9,'responseTime':_0x5a812d,'payload':_0x22f0b2});}[a53_0x566eb2(0xe1)](_0x566df4,_0x26546f,_0x42ffe9,_0x3cfdea,_0x190f62){const _0xfc0ae7=a53_0x566eb2;this[_0xfc0ae7(0x104)](_0xfc0ae7(0xf3),{'type':_0xfc0ae7(0xeb),'shopId':_0x566df4,'webhookUrl':_0x26546f,'event':_0x42ffe9,'error':_0x3cfdea instanceof Error?{'message':_0x3cfdea[_0xfc0ae7(0xf9)],'stack':_0x3cfdea['stack']}:_0x3cfdea,'payload':_0x190f62});}[a53_0x566eb2(0xe9)](_0x4620fd,_0x529737,_0x3d36a2,_0x2744cb,_0x234223){const _0x108ab1=a53_0x566eb2;this[_0x108ab1(0x104)](_0x108ab1(0x10f),{'type':_0x108ab1(0xd5),'gateway':_0x4620fd,'paymentId':_0x529737,'shopId':_0x3d36a2,'amount':_0x2744cb,'currency':_0x234223});}['logApiCall'](_0x43f839,_0x155acc,_0x5cede3,_0x8cc673,_0x4a8c33){const _0x615341=a53_0x566eb2;this[_0x615341(0x104)](_0x615341(0xc6),{'type':'API_CALL','endpoint':_0x43f839,'method':_0x155acc,'userId':_0x5cede3,'userRole':_0x8cc673,'requestData':_0x4a8c33});}[a53_0x566eb2(0xfd)](){const _0x3804bf=a53_0x566eb2;try{const _0x5886cb=fs_1['default'][_0x3804bf(0xed)](this[_0x3804bf(0xc7)]),_0x4ba2ad=_0x5886cb[_0x3804bf(0x101)](_0x142178=>_0x142178['endsWith']('.log')),_0x559711=[...new Set(_0x4ba2ad['map'](_0x35fe7b=>_0x35fe7b[_0x3804bf(0xe5)]('_')[0x0]))],_0x57a83e=_0x4ba2ad[_0x3804bf(0xe8)](_0x3df682=>{const _0x4f8781=_0x3804bf,_0xbd0ecb=path_1['default']['join'](this['logsDir'],_0x3df682),_0x279abf=fs_1[_0x4f8781(0xdb)][_0x4f8781(0xc2)](_0xbd0ecb),[_0x47359d,_0x523035]=_0x3df682['replace'](_0x4f8781(0x10a),'')[_0x4f8781(0xe5)]('_');return{'type':_0x47359d,'date':_0x523035,'size':_0x279abf[_0x4f8781(0xf0)]};})[_0x3804bf(0xda)]((_0x589612,_0x106dc9)=>_0x106dc9[_0x3804bf(0xd9)]['localeCompare'](_0x589612['date']));return{'totalFiles':_0x4ba2ad['length'],'logTypes':_0x559711,'latestLogs':_0x57a83e[_0x3804bf(0xdd)](0x0,0xa)};}catch(_0x52d144){return console[_0x3804bf(0xc3)](_0x3804bf(0xd4),_0x52d144),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x566eb2(0xe6)](_0x4548ea=0x1e){const _0x5d938d=a53_0x566eb2;try{const _0x5943e1=fs_1[_0x5d938d(0xdb)][_0x5d938d(0xed)](this[_0x5d938d(0xc7)]),_0x5a7d4e=new Date();_0x5a7d4e['setDate'](_0x5a7d4e['getDate']()-_0x4548ea);let _0x537db0=0x0;_0x5943e1['forEach'](_0x595e9f=>{const _0x258d1b=_0x5d938d;if(!_0x595e9f[_0x258d1b(0xd2)](_0x258d1b(0x10a)))return;const _0x1ba8f8=path_1[_0x258d1b(0xdb)][_0x258d1b(0xff)](this[_0x258d1b(0xc7)],_0x595e9f),_0x4dad24=fs_1[_0x258d1b(0xdb)][_0x258d1b(0xc2)](_0x1ba8f8);_0x4dad24[_0x258d1b(0xf5)]<_0x5a7d4e&&(fs_1[_0x258d1b(0xdb)][_0x258d1b(0xd1)](_0x1ba8f8),_0x537db0++,console[_0x258d1b(0x108)](_0x258d1b(0xec)+_0x595e9f));}),console[_0x5d938d(0x108)]('🧹\x20Cleaned\x20'+_0x537db0+_0x5d938d(0xcc)+_0x4548ea+'\x20days)');}catch(_0x3009be){console[_0x5d938d(0xc3)]('Failed\x20to\x20clean\x20old\x20logs:',_0x3009be);}}}exports[a53_0x566eb2(0x10c)]=LoggerService,exports['loggerService']=new LoggerService();function a53_0x503e(_0x2ccc7c,_0x3b0733){const _0x5a6b34=a53_0x5a6b();return a53_0x503e=function(_0x503e29,_0x4bfd26){_0x503e29=_0x503e29-0xbf;let _0x3b3d8c=_0x5a6b34[_0x503e29];return _0x3b3d8c;},a53_0x503e(_0x2ccc7c,_0x3b0733);}function a53_0x5a6b(){const _0xfdb4ed=['Failed\x20to\x20get\x20log\x20stats:','PAYMENT_CREATED','logWebhookReceived','stack','8hmBIuQ','date','sort','default','590750HnUDaf','slice','cointopay_errors','logWhiteDomainRequest','170691smRtnK','logShopWebhookError','REQUEST','getLogFileName','cointopay_status_changes','split','cleanOldLogs','cwd','map','logPaymentCreated','ERROR','SHOP_WEBHOOK_ERROR','🗑️\x20Deleted\x20old\x20log\x20file:\x20','readdirSync','shop_webhooks_sent','white_domain_errors','size','logWhiteDomainResponse','webhooks_errors','shop_webhooks_errors','7KkIUaY','mtime','webhooks_received','COINTOPAY_ERROR','RESPONSE','message','1368876LvbsEF','4xRPBZW','logCoinToPayError','getLogStats','logShopWebhookSent','join','11QIGyJn','filter','__esModule','logCoinToPayStatus','writeLog','SHOP_WEBHOOK_SENT','stringify','__importDefault','log','WEBHOOK_PROCESSED','.log','logWebhookError','LoggerService','white_domain_responses','loggerService','payments_created','ensureLogsDirectory','Failed\x20to\x20write\x20','toISOString','2213793UishjC','114057JWWHDi','3524570vgaNac','statSync','error','WEBHOOK_RECEIVED','537024QceEzt','api_calls','logsDir','COINTOPAY_STATUS_CHANGE','existsSync','\x20log:','path','\x20old\x20log\x20files\x20(older\x20than\x20','📁\x20Created\x20logs\x20directory:\x20','logs','defineProperty','white_domain_requests','unlinkSync','endsWith','webhooks_processed'];a53_0x5a6b=function(){return _0xfdb4ed;};return a53_0x5a6b();}