'use strict';const a48_0x2d34a1=a48_0xc273;(function(_0x353994,_0xab79fe){const _0x4ecfaf=a48_0xc273,_0xdbed31=_0x353994();while(!![]){try{const _0x54036a=-parseInt(_0x4ecfaf(0x96))/0x1+-parseInt(_0x4ecfaf(0x7e))/0x2+-parseInt(_0x4ecfaf(0xa9))/0x3*(parseInt(_0x4ecfaf(0x9a))/0x4)+parseInt(_0x4ecfaf(0x80))/0x5*(-parseInt(_0x4ecfaf(0xba))/0x6)+-parseInt(_0x4ecfaf(0xb2))/0x7+parseInt(_0x4ecfaf(0x9e))/0x8*(parseInt(_0x4ecfaf(0x7d))/0x9)+parseInt(_0x4ecfaf(0x8e))/0xa;if(_0x54036a===_0xab79fe)break;else _0xdbed31['push'](_0xdbed31['shift']());}catch(_0x4fec39){_0xdbed31['push'](_0xdbed31['shift']());}}}(a48_0x4daf,0x4d16d));var __importDefault=this&&this[a48_0x2d34a1(0x82)]||function(_0x1e6394){const _0xda93f0=a48_0x2d34a1;return _0x1e6394&&_0x1e6394[_0xda93f0(0x97)]?_0x1e6394:{'default':_0x1e6394};};Object[a48_0x2d34a1(0x89)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a48_0x2d34a1(0xbc)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x2d34a1(0x94)));function a48_0xc273(_0x9272fe,_0x26bead){const _0x4daf9b=a48_0x4daf();return a48_0xc273=function(_0xc2739d,_0x4bb5f3){_0xc2739d=_0xc2739d-0x75;let _0x1ee18e=_0x4daf9b[_0xc2739d];return _0x1ee18e;},a48_0xc273(_0x9272fe,_0x26bead);}function a48_0x4daf(){const _0x1e61be=['Failed\x20to\x20get\x20log\x20stats:','ERROR','shop_webhooks_errors','defineProperty','statSync','logWhiteDomainResponse','cleanOldLogs','COINTOPAY_ERROR','20005280wKaEle','🧹\x20Cleaned\x20','logApiCall','logWhiteDomainError','COINTOPAY_STATUS_CHANGE','sort','path','PAYMENT_CREATED','481199STszYM','__esModule','default','webhooks_processed','4ktHJNK','writeLog','date','WEBHOOK_RECEIVED','195992VLChyM','payments_created','size','logWhiteDomainRequest','message','existsSync','getDate','join','WEBHOOK_PROCESSED','replace','logCoinToPayError','1661343WuBRFY','error','setDate','logWebhookError','RESPONSE','getLogFileName','logWebhookReceived','utf8','logShopWebhookError','1798972blPoRp','loggerService','webhooks_received','\x20days)','logShopWebhookSent','WEBHOOK_ERROR','filter','webhooks_errors','210fQxANh','Failed\x20to\x20clean\x20old\x20logs:','LoggerService','logsDir','ensureLogsDirectory','endsWith','log','🗑️\x20Deleted\x20old\x20log\x20file:\x20','api_calls','Failed\x20to\x20write\x20','split','.log','getLogStats','stack','toISOString','144aanSag','360728TXaaaG','readdirSync','86345kmxkeG','cwd','__importDefault','mkdirSync','cointopay_errors','shop_webhooks_sent'];a48_0x4daf=function(){return _0x1e61be;};return a48_0x4daf();}class LoggerService{constructor(){const _0x65f12b=a48_0x2d34a1;this[_0x65f12b(0xbd)]=path_1[_0x65f12b(0x98)][_0x65f12b(0xa5)](process[_0x65f12b(0x81)](),'logs'),this['ensureLogsDirectory']();}[a48_0x2d34a1(0xbe)](){const _0x5774c0=a48_0x2d34a1;!fs_1[_0x5774c0(0x98)][_0x5774c0(0xa3)](this[_0x5774c0(0xbd)])&&(fs_1['default'][_0x5774c0(0x83)](this['logsDir'],{'recursive':!![]}),console[_0x5774c0(0xc0)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x5774c0(0xbd)]));}[a48_0x2d34a1(0xae)](_0x29d243){const _0x34be76=a48_0x2d34a1,_0x347e89=new Date()[_0x34be76(0x7c)]()[_0x34be76(0x78)]('T')[0x0];return path_1[_0x34be76(0x98)][_0x34be76(0xa5)](this[_0x34be76(0xbd)],_0x29d243+'_'+_0x347e89+_0x34be76(0x79));}[a48_0x2d34a1(0x9b)](_0x4a7167,_0x254119){const _0x349ec7=a48_0x2d34a1;try{const _0x1d269f=new Date()['toISOString'](),_0x1d102d={'timestamp':_0x1d269f,..._0x254119},_0x5c3e71=JSON['stringify'](_0x1d102d)+'\x0a',_0x240e81=this[_0x349ec7(0xae)](_0x4a7167);fs_1[_0x349ec7(0x98)]['appendFileSync'](_0x240e81,_0x5c3e71,_0x349ec7(0xb0));}catch(_0x54ed7f){console[_0x349ec7(0xaa)](_0x349ec7(0x77)+_0x4a7167+'\x20log:',_0x54ed7f);}}[a48_0x2d34a1(0xa1)](_0xb978d,_0x3e8b55,_0x5d6f18,_0x14d007){this['writeLog']('white_domain_requests',{'type':'REQUEST','gateway':_0xb978d,'endpoint':_0x3e8b55,'method':_0x5d6f18,'data':_0x14d007});}[a48_0x2d34a1(0x8b)](_0x1365b,_0x596af8,_0x35ffc6,_0x2cd5a4,_0x2ba3f1){const _0x1aad7f=a48_0x2d34a1;this['writeLog']('white_domain_responses',{'type':_0x1aad7f(0xad),'gateway':_0x1365b,'endpoint':_0x596af8,'status':_0x35ffc6,'responseTime':_0x2ba3f1,'data':_0x2cd5a4});}[a48_0x2d34a1(0x91)](_0x13e496,_0x5a6096,_0x1a0dc6){const _0x51d743=a48_0x2d34a1;this[_0x51d743(0x9b)]('white_domain_errors',{'type':_0x51d743(0x87),'gateway':_0x13e496,'endpoint':_0x5a6096,'error':_0x1a0dc6 instanceof Error?{'message':_0x1a0dc6[_0x51d743(0xa2)],'stack':_0x1a0dc6[_0x51d743(0x7b)]}:_0x1a0dc6});}[a48_0x2d34a1(0xaf)](_0x4af70c,_0x4cafee,_0x28b71f){const _0x539955=a48_0x2d34a1;this[_0x539955(0x9b)](_0x539955(0xb4),{'type':_0x539955(0x9d),'gateway':_0x4af70c,'headers':_0x28b71f,'data':_0x4cafee});}['logWebhookProcessed'](_0x6b512f,_0x16689f,_0x316c5f,_0x45b958,_0x9c544c){const _0x5cad5d=a48_0x2d34a1;this[_0x5cad5d(0x9b)](_0x5cad5d(0x99),{'type':_0x5cad5d(0xa6),'gateway':_0x6b512f,'paymentId':_0x16689f,'oldStatus':_0x316c5f,'newStatus':_0x45b958,'originalData':_0x9c544c});}[a48_0x2d34a1(0xac)](_0x36c214,_0x9de9bb,_0x4ab911){const _0x1eb2c2=a48_0x2d34a1;this[_0x1eb2c2(0x9b)](_0x1eb2c2(0xb9),{'type':_0x1eb2c2(0xb7),'gateway':_0x36c214,'error':_0x9de9bb instanceof Error?{'message':_0x9de9bb[_0x1eb2c2(0xa2)],'stack':_0x9de9bb['stack']}:_0x9de9bb,'originalData':_0x4ab911});}['logCoinToPayStatus'](_0x27e804){const _0x4152bc=a48_0x2d34a1;this[_0x4152bc(0x9b)]('cointopay_status_changes',{'type':_0x4152bc(0x92),..._0x27e804});}[a48_0x2d34a1(0xa8)](_0x169e03){const _0x111984=a48_0x2d34a1;this[_0x111984(0x9b)](_0x111984(0x84),{'type':_0x111984(0x8d),..._0x169e03});}[a48_0x2d34a1(0xb6)](_0xdddeeb,_0x1f1c13,_0x41ca85,_0x46697f,_0x258f8a,_0x2f86d2){const _0x459953=a48_0x2d34a1;this['writeLog'](_0x459953(0x85),{'type':'SHOP_WEBHOOK_SENT','shopId':_0xdddeeb,'webhookUrl':_0x1f1c13,'event':_0x41ca85,'status':_0x46697f,'responseTime':_0x258f8a,'payload':_0x2f86d2});}[a48_0x2d34a1(0xb1)](_0x333980,_0x3afd0f,_0x1e5856,_0x507284,_0x21f78d){const _0x52e1eb=a48_0x2d34a1;this[_0x52e1eb(0x9b)](_0x52e1eb(0x88),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x333980,'webhookUrl':_0x3afd0f,'event':_0x1e5856,'error':_0x507284 instanceof Error?{'message':_0x507284[_0x52e1eb(0xa2)],'stack':_0x507284[_0x52e1eb(0x7b)]}:_0x507284,'payload':_0x21f78d});}['logPaymentCreated'](_0x58fe80,_0x372d2e,_0x26430f,_0x54867c,_0x152910){const _0x2dd13c=a48_0x2d34a1;this[_0x2dd13c(0x9b)](_0x2dd13c(0x9f),{'type':_0x2dd13c(0x95),'gateway':_0x58fe80,'paymentId':_0x372d2e,'shopId':_0x26430f,'amount':_0x54867c,'currency':_0x152910});}[a48_0x2d34a1(0x90)](_0x473055,_0x128b22,_0x165768,_0x4a1aab,_0x5a3112){const _0x5f5a5c=a48_0x2d34a1;this['writeLog'](_0x5f5a5c(0x76),{'type':'API_CALL','endpoint':_0x473055,'method':_0x128b22,'userId':_0x165768,'userRole':_0x4a1aab,'requestData':_0x5a3112});}[a48_0x2d34a1(0x7a)](){const _0x3706c1=a48_0x2d34a1;try{const _0x27e8d2=fs_1['default'][_0x3706c1(0x7f)](this['logsDir']),_0x449a14=_0x27e8d2[_0x3706c1(0xb8)](_0x422cab=>_0x422cab[_0x3706c1(0xbf)](_0x3706c1(0x79))),_0x2a66fb=[...new Set(_0x449a14['map'](_0x32558b=>_0x32558b['split']('_')[0x0]))],_0x4d429f=_0x449a14['map'](_0x3c8c99=>{const _0x33f9d=_0x3706c1,_0x35aa5c=path_1[_0x33f9d(0x98)][_0x33f9d(0xa5)](this[_0x33f9d(0xbd)],_0x3c8c99),_0x2980d3=fs_1[_0x33f9d(0x98)][_0x33f9d(0x8a)](_0x35aa5c),[_0xbf479a,_0x53918d]=_0x3c8c99[_0x33f9d(0xa7)]('.log','')[_0x33f9d(0x78)]('_');return{'type':_0xbf479a,'date':_0x53918d,'size':_0x2980d3[_0x33f9d(0xa0)]};})[_0x3706c1(0x93)]((_0x505df7,_0x3759d8)=>_0x3759d8['date']['localeCompare'](_0x505df7[_0x3706c1(0x9c)]));return{'totalFiles':_0x449a14['length'],'logTypes':_0x2a66fb,'latestLogs':_0x4d429f['slice'](0x0,0xa)};}catch(_0x437133){return console[_0x3706c1(0xaa)](_0x3706c1(0x86),_0x437133),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x2d34a1(0x8c)](_0x207190=0x1e){const _0x9ad01d=a48_0x2d34a1;try{const _0x2f05e0=fs_1[_0x9ad01d(0x98)][_0x9ad01d(0x7f)](this[_0x9ad01d(0xbd)]),_0x5e259d=new Date();_0x5e259d[_0x9ad01d(0xab)](_0x5e259d[_0x9ad01d(0xa4)]()-_0x207190);let _0x2bda18=0x0;_0x2f05e0['forEach'](_0x10f8e3=>{const _0x1ec28d=_0x9ad01d;if(!_0x10f8e3[_0x1ec28d(0xbf)]('.log'))return;const _0x21d808=path_1[_0x1ec28d(0x98)][_0x1ec28d(0xa5)](this[_0x1ec28d(0xbd)],_0x10f8e3),_0x5b633f=fs_1['default']['statSync'](_0x21d808);_0x5b633f['mtime']<_0x5e259d&&(fs_1[_0x1ec28d(0x98)]['unlinkSync'](_0x21d808),_0x2bda18++,console[_0x1ec28d(0xc0)](_0x1ec28d(0x75)+_0x10f8e3));}),console['log'](_0x9ad01d(0x8f)+_0x2bda18+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x207190+_0x9ad01d(0xb5));}catch(_0x498876){console[_0x9ad01d(0xaa)](_0x9ad01d(0xbb),_0x498876);}}}exports[a48_0x2d34a1(0xbc)]=LoggerService,exports[a48_0x2d34a1(0xb3)]=new LoggerService();