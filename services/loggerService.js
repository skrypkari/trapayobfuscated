'use strict';const a49_0x3ab1ee=a49_0x5a3b;(function(_0x504836,_0x1896d8){const _0x7803e6=a49_0x5a3b,_0x384104=_0x504836();while(!![]){try{const _0x13ae83=-parseInt(_0x7803e6(0x160))/0x1+parseInt(_0x7803e6(0x17c))/0x2+-parseInt(_0x7803e6(0x1a7))/0x3*(-parseInt(_0x7803e6(0x18e))/0x4)+-parseInt(_0x7803e6(0x16f))/0x5*(parseInt(_0x7803e6(0x16d))/0x6)+parseInt(_0x7803e6(0x196))/0x7*(parseInt(_0x7803e6(0x15c))/0x8)+parseInt(_0x7803e6(0x187))/0x9+parseInt(_0x7803e6(0x184))/0xa*(-parseInt(_0x7803e6(0x16e))/0xb);if(_0x13ae83===_0x1896d8)break;else _0x384104['push'](_0x384104['shift']());}catch(_0x46d0b7){_0x384104['push'](_0x384104['shift']());}}}(a49_0x4a0c,0x45ae7));var __importDefault=this&&this[a49_0x3ab1ee(0x18c)]||function(_0x29487c){const _0x34240e=a49_0x3ab1ee;return _0x29487c&&_0x29487c[_0x34240e(0x182)]?_0x29487c:{'default':_0x29487c};};function a49_0x4a0c(){const _0x5960f5=['slice','70vxAkRd','RESPONSE','join','logCoinToPayStatus','utf8','api_calls','LoggerService','sort','split','white_domain_responses','appendFileSync','log','endsWith','webhooks_processed','logs','logWhiteDomainError','webhooks_received','436749czjzFF','shop_webhooks_sent','SHOP_WEBHOOK_ERROR','defineProperty','logCoinToPayError','REQUEST','logsDir','WEBHOOK_PROCESSED','cointopay_errors','forEach','logShopWebhookError','SHOP_WEBHOOK_SENT','unlinkSync','369560HWPWWh','setDate','map','cleanOldLogs','9659oyvkfq','readdirSync','mtime','logPaymentCreated','date','logApiCall','logWhiteDomainResponse','WEBHOOK_ERROR','\x20old\x20log\x20files\x20(older\x20than\x20','size','statSync','PAYMENT_CREATED','API_CALL','474CoglAC','5835940QlFhJa','17795FQzmGg','🧹\x20Cleaned\x20','COINTOPAY_STATUS_CHANGE','ensureLogsDirectory','getLogFileName','cointopay_status_changes','message','toISOString','default','getLogStats','logWhiteDomainRequest','stringify','\x20log:','6796ipzazS','path','getDate','logWebhookError','COINTOPAY_ERROR','.log','__esModule','loggerService','10GphKyw','length','writeLog','4462596JRxBVH','filter','logWebhookReceived','white_domain_errors','🗑️\x20Deleted\x20old\x20log\x20file:\x20','__importDefault','stack','4hoXsTB','📁\x20Created\x20logs\x20directory:\x20','error','existsSync','webhooks_errors','mkdirSync','logWebhookProcessed'];a49_0x4a0c=function(){return _0x5960f5;};return a49_0x4a0c();}Object[a49_0x3ab1ee(0x1aa)](exports,a49_0x3ab1ee(0x182),{'value':!![]}),exports[a49_0x3ab1ee(0x183)]=exports['LoggerService']=void 0x0;function a49_0x5a3b(_0xcc49ec,_0x4fa9c6){const _0x4a0cbe=a49_0x4a0c();return a49_0x5a3b=function(_0x5a3b29,_0x54bdfc){_0x5a3b29=_0x5a3b29-0x155;let _0x237263=_0x4a0cbe[_0x5a3b29];return _0x237263;},a49_0x5a3b(_0xcc49ec,_0x4fa9c6);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x3ab1ee(0x17d)));class LoggerService{constructor(){const _0x1b4a47=a49_0x3ab1ee;this[_0x1b4a47(0x155)]=path_1[_0x1b4a47(0x177)][_0x1b4a47(0x198)](process['cwd'](),_0x1b4a47(0x1a4)),this[_0x1b4a47(0x172)]();}['ensureLogsDirectory'](){const _0x242bb2=a49_0x3ab1ee;!fs_1[_0x242bb2(0x177)][_0x242bb2(0x191)](this[_0x242bb2(0x155)])&&(fs_1['default'][_0x242bb2(0x193)](this['logsDir'],{'recursive':!![]}),console[_0x242bb2(0x1a1)](_0x242bb2(0x18f)+this['logsDir']));}[a49_0x3ab1ee(0x173)](_0x5f13cc){const _0x95e00c=a49_0x3ab1ee,_0x55ef88=new Date()[_0x95e00c(0x176)]()[_0x95e00c(0x19e)]('T')[0x0];return path_1[_0x95e00c(0x177)]['join'](this['logsDir'],_0x5f13cc+'_'+_0x55ef88+_0x95e00c(0x181));}[a49_0x3ab1ee(0x186)](_0x1aa9e6,_0x38456a){const _0x57a30f=a49_0x3ab1ee;try{const _0x89c0e2=new Date()['toISOString'](),_0x5b462c={'timestamp':_0x89c0e2,..._0x38456a},_0x3173b4=JSON[_0x57a30f(0x17a)](_0x5b462c)+'\x0a',_0x5ce427=this[_0x57a30f(0x173)](_0x1aa9e6);fs_1[_0x57a30f(0x177)][_0x57a30f(0x1a0)](_0x5ce427,_0x3173b4,_0x57a30f(0x19a));}catch(_0x2a0c9a){console[_0x57a30f(0x190)]('Failed\x20to\x20write\x20'+_0x1aa9e6+_0x57a30f(0x17b),_0x2a0c9a);}}[a49_0x3ab1ee(0x179)](_0x546135,_0x1778eb,_0x378534,_0x14c13b){const _0x5c98ef=a49_0x3ab1ee;this[_0x5c98ef(0x186)]('white_domain_requests',{'type':_0x5c98ef(0x1ac),'gateway':_0x546135,'endpoint':_0x1778eb,'method':_0x378534,'data':_0x14c13b});}[a49_0x3ab1ee(0x166)](_0x2a14f4,_0x1f4e0d,_0x1c776d,_0x4ff724,_0x208f08){const _0xb54dbc=a49_0x3ab1ee;this[_0xb54dbc(0x186)](_0xb54dbc(0x19f),{'type':_0xb54dbc(0x197),'gateway':_0x2a14f4,'endpoint':_0x1f4e0d,'status':_0x1c776d,'responseTime':_0x208f08,'data':_0x4ff724});}[a49_0x3ab1ee(0x1a5)](_0x3d4bbd,_0x529ce9,_0xafc03){const _0x47678c=a49_0x3ab1ee;this[_0x47678c(0x186)](_0x47678c(0x18a),{'type':'ERROR','gateway':_0x3d4bbd,'endpoint':_0x529ce9,'error':_0xafc03 instanceof Error?{'message':_0xafc03[_0x47678c(0x175)],'stack':_0xafc03['stack']}:_0xafc03});}[a49_0x3ab1ee(0x189)](_0x56d4b7,_0xb1ec2e,_0x4fa4bd){const _0xe6561f=a49_0x3ab1ee;this[_0xe6561f(0x186)](_0xe6561f(0x1a6),{'type':'WEBHOOK_RECEIVED','gateway':_0x56d4b7,'headers':_0x4fa4bd,'data':_0xb1ec2e});}[a49_0x3ab1ee(0x194)](_0x518990,_0x2dc1db,_0x552ffc,_0x323c9f,_0x1bc402){const _0xa55901=a49_0x3ab1ee;this[_0xa55901(0x186)](_0xa55901(0x1a3),{'type':_0xa55901(0x156),'gateway':_0x518990,'paymentId':_0x2dc1db,'oldStatus':_0x552ffc,'newStatus':_0x323c9f,'originalData':_0x1bc402});}[a49_0x3ab1ee(0x17f)](_0x3218c5,_0x541209,_0x331ba0){const _0x141425=a49_0x3ab1ee;this[_0x141425(0x186)](_0x141425(0x192),{'type':_0x141425(0x167),'gateway':_0x3218c5,'error':_0x541209 instanceof Error?{'message':_0x541209[_0x141425(0x175)],'stack':_0x541209[_0x141425(0x18d)]}:_0x541209,'originalData':_0x331ba0});}[a49_0x3ab1ee(0x199)](_0x28ca28){const _0x3a6b22=a49_0x3ab1ee;this['writeLog'](_0x3a6b22(0x174),{'type':_0x3a6b22(0x171),..._0x28ca28});}[a49_0x3ab1ee(0x1ab)](_0x1c6940){const _0x2c44a1=a49_0x3ab1ee;this['writeLog'](_0x2c44a1(0x157),{'type':_0x2c44a1(0x180),..._0x1c6940});}['logShopWebhookSent'](_0x2d176f,_0x53435c,_0x1cc1ee,_0x4fa820,_0x2ee97e,_0x1fdc1f){const _0x4c6a47=a49_0x3ab1ee;this[_0x4c6a47(0x186)](_0x4c6a47(0x1a8),{'type':_0x4c6a47(0x15a),'shopId':_0x2d176f,'webhookUrl':_0x53435c,'event':_0x1cc1ee,'status':_0x4fa820,'responseTime':_0x2ee97e,'payload':_0x1fdc1f});}[a49_0x3ab1ee(0x159)](_0x25ebea,_0x4cc165,_0x3a38bf,_0x18bd0f,_0x45b96f){const _0x58ec3b=a49_0x3ab1ee;this[_0x58ec3b(0x186)]('shop_webhooks_errors',{'type':_0x58ec3b(0x1a9),'shopId':_0x25ebea,'webhookUrl':_0x4cc165,'event':_0x3a38bf,'error':_0x18bd0f instanceof Error?{'message':_0x18bd0f[_0x58ec3b(0x175)],'stack':_0x18bd0f[_0x58ec3b(0x18d)]}:_0x18bd0f,'payload':_0x45b96f});}[a49_0x3ab1ee(0x163)](_0x1307de,_0xaa46f8,_0x36c409,_0x2b5f1d,_0x77ef4e){const _0x44cc80=a49_0x3ab1ee;this[_0x44cc80(0x186)]('payments_created',{'type':_0x44cc80(0x16b),'gateway':_0x1307de,'paymentId':_0xaa46f8,'shopId':_0x36c409,'amount':_0x2b5f1d,'currency':_0x77ef4e});}[a49_0x3ab1ee(0x165)](_0x410884,_0x87dd07,_0x38d315,_0x3b5e2e,_0x288417){const _0x283dc3=a49_0x3ab1ee;this[_0x283dc3(0x186)](_0x283dc3(0x19b),{'type':_0x283dc3(0x16c),'endpoint':_0x410884,'method':_0x87dd07,'userId':_0x38d315,'userRole':_0x3b5e2e,'requestData':_0x288417});}[a49_0x3ab1ee(0x178)](){const _0x48e947=a49_0x3ab1ee;try{const _0x6b41c4=fs_1[_0x48e947(0x177)][_0x48e947(0x161)](this[_0x48e947(0x155)]),_0x254e42=_0x6b41c4[_0x48e947(0x188)](_0x256927=>_0x256927[_0x48e947(0x1a2)](_0x48e947(0x181))),_0x339a40=[...new Set(_0x254e42['map'](_0x32e090=>_0x32e090[_0x48e947(0x19e)]('_')[0x0]))],_0xb38e18=_0x254e42[_0x48e947(0x15e)](_0x4a729b=>{const _0x59ad1b=_0x48e947,_0x3afac1=path_1['default'][_0x59ad1b(0x198)](this['logsDir'],_0x4a729b),_0x940fa0=fs_1[_0x59ad1b(0x177)][_0x59ad1b(0x16a)](_0x3afac1),[_0x159242,_0x42ff75]=_0x4a729b['replace']('.log','')[_0x59ad1b(0x19e)]('_');return{'type':_0x159242,'date':_0x42ff75,'size':_0x940fa0[_0x59ad1b(0x169)]};})[_0x48e947(0x19d)]((_0x287931,_0x31b9ac)=>_0x31b9ac['date']['localeCompare'](_0x287931[_0x48e947(0x164)]));return{'totalFiles':_0x254e42[_0x48e947(0x185)],'logTypes':_0x339a40,'latestLogs':_0xb38e18[_0x48e947(0x195)](0x0,0xa)};}catch(_0x43cd8e){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x43cd8e),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x3ab1ee(0x15f)](_0x24972b=0x1e){const _0x30cbd3=a49_0x3ab1ee;try{const _0x112d32=fs_1[_0x30cbd3(0x177)][_0x30cbd3(0x161)](this['logsDir']),_0x4075d9=new Date();_0x4075d9[_0x30cbd3(0x15d)](_0x4075d9[_0x30cbd3(0x17e)]()-_0x24972b);let _0x3623f9=0x0;_0x112d32[_0x30cbd3(0x158)](_0x2ef1d9=>{const _0x2b5307=_0x30cbd3;if(!_0x2ef1d9[_0x2b5307(0x1a2)](_0x2b5307(0x181)))return;const _0xf383da=path_1['default'][_0x2b5307(0x198)](this['logsDir'],_0x2ef1d9),_0x5a0935=fs_1[_0x2b5307(0x177)]['statSync'](_0xf383da);_0x5a0935[_0x2b5307(0x162)]<_0x4075d9&&(fs_1[_0x2b5307(0x177)][_0x2b5307(0x15b)](_0xf383da),_0x3623f9++,console[_0x2b5307(0x1a1)](_0x2b5307(0x18b)+_0x2ef1d9));}),console[_0x30cbd3(0x1a1)](_0x30cbd3(0x170)+_0x3623f9+_0x30cbd3(0x168)+_0x24972b+'\x20days)');}catch(_0x11d97b){console['error']('Failed\x20to\x20clean\x20old\x20logs:',_0x11d97b);}}}exports[a49_0x3ab1ee(0x19c)]=LoggerService,exports[a49_0x3ab1ee(0x183)]=new LoggerService();