'use strict';function a48_0x5549(_0xdb8b33,_0x547c4f){const _0xb72db=a48_0xb72d();return a48_0x5549=function(_0x554929,_0x52628e){_0x554929=_0x554929-0x194;let _0x437e78=_0xb72db[_0x554929];return _0x437e78;},a48_0x5549(_0xdb8b33,_0x547c4f);}function a48_0xb72d(){const _0x3d1b3f=['webhooks_processed','getLogStats','API_CALL','logWebhookError','setDate','.log','payments_created','message','PAYMENT_CREATED','1671174lhUAIJ','211315OYKmmd','320038oaclcY','logApiCall','utf8','date','endsWith','12lvtZxK','944262eBmrTd','map','forEach','logWhiteDomainError','🗑️\x20Deleted\x20old\x20log\x20file:\x20','\x20days)','logWebhookProcessed','🧹\x20Cleaned\x20','LoggerService','toISOString','275KebzYa','Failed\x20to\x20clean\x20old\x20logs:','logWhiteDomainRequest','logPaymentCreated','slice','80vCCsAy','existsSync','mtime','readdirSync','default','logWebhookReceived','white_domain_errors','length','stringify','1VYYZtt','COINTOPAY_STATUS_CHANGE','webhooks_received','cointopay_status_changes','defineProperty','appendFileSync','getLogFileName','ensureLogsDirectory','split','log','logWhiteDomainResponse','white_domain_requests','430130SJgRwC','Failed\x20to\x20write\x20','cleanOldLogs','1061459ZrYsSg','131355EvDJZD','COINTOPAY_ERROR','logShopWebhookError','white_domain_responses','\x20log:','stack','loggerService','logsDir','RESPONSE','webhooks_errors','__esModule','size','api_calls','WEBHOOK_PROCESSED','mkdirSync','writeLog','📁\x20Created\x20logs\x20directory:\x20','getDate','shop_webhooks_sent','SHOP_WEBHOOK_SENT','cointopay_errors','error','join'];a48_0xb72d=function(){return _0x3d1b3f;};return a48_0xb72d();}const a48_0x169dab=a48_0x5549;(function(_0x426915,_0x570619){const _0x21314e=a48_0x5549,_0x296754=_0x426915();while(!![]){try{const _0xbe371d=parseInt(_0x21314e(0x1b4))/0x1*(-parseInt(_0x21314e(0x196))/0x2)+-parseInt(_0x21314e(0x19c))/0x3+parseInt(_0x21314e(0x19b))/0x4*(-parseInt(_0x21314e(0x195))/0x5)+-parseInt(_0x21314e(0x194))/0x6+-parseInt(_0x21314e(0x1c3))/0x7+parseInt(_0x21314e(0x1ab))/0x8*(parseInt(_0x21314e(0x1c4))/0x9)+-parseInt(_0x21314e(0x1c0))/0xa*(-parseInt(_0x21314e(0x1a6))/0xb);if(_0xbe371d===_0x570619)break;else _0x296754['push'](_0x296754['shift']());}catch(_0x541276){_0x296754['push'](_0x296754['shift']());}}}(a48_0xb72d,0x2e46b));var __importDefault=this&&this['__importDefault']||function(_0xe308fe){const _0x17fc49=a48_0x5549;return _0xe308fe&&_0xe308fe[_0x17fc49(0x1ce)]?_0xe308fe:{'default':_0xe308fe};};Object[a48_0x169dab(0x1b8)](exports,'__esModule',{'value':!![]}),exports[a48_0x169dab(0x1ca)]=exports[a48_0x169dab(0x1a4)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x35bf7b=a48_0x169dab;this['logsDir']=path_1['default'][_0x35bf7b(0x1da)](process['cwd'](),'logs'),this[_0x35bf7b(0x1bb)]();}[a48_0x169dab(0x1bb)](){const _0xfd618e=a48_0x169dab;!fs_1[_0xfd618e(0x1af)][_0xfd618e(0x1ac)](this['logsDir'])&&(fs_1[_0xfd618e(0x1af)][_0xfd618e(0x1d2)](this['logsDir'],{'recursive':!![]}),console[_0xfd618e(0x1bd)](_0xfd618e(0x1d4)+this[_0xfd618e(0x1cb)]));}['getLogFileName'](_0x6bf1ad){const _0xacf9d5=a48_0x169dab,_0x3c97d4=new Date()[_0xacf9d5(0x1a5)]()['split']('T')[0x0];return path_1[_0xacf9d5(0x1af)][_0xacf9d5(0x1da)](this[_0xacf9d5(0x1cb)],_0x6bf1ad+'_'+_0x3c97d4+_0xacf9d5(0x1e0));}[a48_0x169dab(0x1d3)](_0x1e35a7,_0x549ae9){const _0x4e82fb=a48_0x169dab;try{const _0x5e863c=new Date()[_0x4e82fb(0x1a5)](),_0x494447={'timestamp':_0x5e863c,..._0x549ae9},_0x5067bb=JSON[_0x4e82fb(0x1b3)](_0x494447)+'\x0a',_0x13f651=this[_0x4e82fb(0x1ba)](_0x1e35a7);fs_1['default'][_0x4e82fb(0x1b9)](_0x13f651,_0x5067bb,_0x4e82fb(0x198));}catch(_0x2a96b8){console[_0x4e82fb(0x1d9)](_0x4e82fb(0x1c1)+_0x1e35a7+_0x4e82fb(0x1c8),_0x2a96b8);}}[a48_0x169dab(0x1a8)](_0x4a2970,_0x9d98c8,_0x4017d7,_0x3c4629){const _0x39daed=a48_0x169dab;this[_0x39daed(0x1d3)](_0x39daed(0x1bf),{'type':'REQUEST','gateway':_0x4a2970,'endpoint':_0x9d98c8,'method':_0x4017d7,'data':_0x3c4629});}[a48_0x169dab(0x1be)](_0x1b8f3e,_0x3aef90,_0x435d66,_0x3d0e21,_0x30182d){const _0x5466a2=a48_0x169dab;this[_0x5466a2(0x1d3)](_0x5466a2(0x1c7),{'type':_0x5466a2(0x1cc),'gateway':_0x1b8f3e,'endpoint':_0x3aef90,'status':_0x435d66,'responseTime':_0x30182d,'data':_0x3d0e21});}[a48_0x169dab(0x19f)](_0x210d24,_0x4e3043,_0x39e86f){const _0x35e7e6=a48_0x169dab;this[_0x35e7e6(0x1d3)](_0x35e7e6(0x1b1),{'type':'ERROR','gateway':_0x210d24,'endpoint':_0x4e3043,'error':_0x39e86f instanceof Error?{'message':_0x39e86f[_0x35e7e6(0x1e2)],'stack':_0x39e86f['stack']}:_0x39e86f});}[a48_0x169dab(0x1b0)](_0x2c2401,_0x425c15,_0x6da2fb){const _0x535e39=a48_0x169dab;this['writeLog'](_0x535e39(0x1b6),{'type':'WEBHOOK_RECEIVED','gateway':_0x2c2401,'headers':_0x6da2fb,'data':_0x425c15});}[a48_0x169dab(0x1a2)](_0x2a4b16,_0x66ef1f,_0x516f7b,_0x53046e,_0x1d8f44){const _0x208c8f=a48_0x169dab;this[_0x208c8f(0x1d3)](_0x208c8f(0x1db),{'type':_0x208c8f(0x1d1),'gateway':_0x2a4b16,'paymentId':_0x66ef1f,'oldStatus':_0x516f7b,'newStatus':_0x53046e,'originalData':_0x1d8f44});}[a48_0x169dab(0x1de)](_0x54f4e9,_0x2b9db0,_0x1774c8){const _0x204c45=a48_0x169dab;this[_0x204c45(0x1d3)](_0x204c45(0x1cd),{'type':'WEBHOOK_ERROR','gateway':_0x54f4e9,'error':_0x2b9db0 instanceof Error?{'message':_0x2b9db0['message'],'stack':_0x2b9db0[_0x204c45(0x1c9)]}:_0x2b9db0,'originalData':_0x1774c8});}['logCoinToPayStatus'](_0x5b8a25){const _0x574695=a48_0x169dab;this['writeLog'](_0x574695(0x1b7),{'type':_0x574695(0x1b5),..._0x5b8a25});}['logCoinToPayError'](_0x1fabf9){const _0xffde34=a48_0x169dab;this[_0xffde34(0x1d3)](_0xffde34(0x1d8),{'type':_0xffde34(0x1c5),..._0x1fabf9});}['logShopWebhookSent'](_0x535a9a,_0x368c5f,_0x5d44a4,_0x2dca1e,_0x1d8f74,_0x4e2cd1){const _0x4632c8=a48_0x169dab;this[_0x4632c8(0x1d3)](_0x4632c8(0x1d6),{'type':_0x4632c8(0x1d7),'shopId':_0x535a9a,'webhookUrl':_0x368c5f,'event':_0x5d44a4,'status':_0x2dca1e,'responseTime':_0x1d8f74,'payload':_0x4e2cd1});}[a48_0x169dab(0x1c6)](_0x431a7c,_0x220664,_0x5af5c3,_0x180ebd,_0x109d68){const _0x240436=a48_0x169dab;this[_0x240436(0x1d3)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x431a7c,'webhookUrl':_0x220664,'event':_0x5af5c3,'error':_0x180ebd instanceof Error?{'message':_0x180ebd[_0x240436(0x1e2)],'stack':_0x180ebd[_0x240436(0x1c9)]}:_0x180ebd,'payload':_0x109d68});}[a48_0x169dab(0x1a9)](_0x46de5f,_0x3ba3e0,_0x1918b7,_0x406f1d,_0x1ad7a1){const _0x2f188c=a48_0x169dab;this[_0x2f188c(0x1d3)](_0x2f188c(0x1e1),{'type':_0x2f188c(0x1e3),'gateway':_0x46de5f,'paymentId':_0x3ba3e0,'shopId':_0x1918b7,'amount':_0x406f1d,'currency':_0x1ad7a1});}[a48_0x169dab(0x197)](_0x558937,_0x14ea2f,_0x2a653e,_0x396acf,_0x4ef7ff){const _0x3cb57c=a48_0x169dab;this['writeLog'](_0x3cb57c(0x1d0),{'type':_0x3cb57c(0x1dd),'endpoint':_0x558937,'method':_0x14ea2f,'userId':_0x2a653e,'userRole':_0x396acf,'requestData':_0x4ef7ff});}[a48_0x169dab(0x1dc)](){const _0x383879=a48_0x169dab;try{const _0x3a405f=fs_1[_0x383879(0x1af)][_0x383879(0x1ae)](this[_0x383879(0x1cb)]),_0x404bea=_0x3a405f['filter'](_0x297b46=>_0x297b46[_0x383879(0x19a)](_0x383879(0x1e0))),_0x568d39=[...new Set(_0x404bea[_0x383879(0x19d)](_0x71f618=>_0x71f618[_0x383879(0x1bc)]('_')[0x0]))],_0x536429=_0x404bea[_0x383879(0x19d)](_0x3fe4e3=>{const _0x260e21=_0x383879,_0x296ef7=path_1[_0x260e21(0x1af)]['join'](this[_0x260e21(0x1cb)],_0x3fe4e3),_0x582de2=fs_1['default']['statSync'](_0x296ef7),[_0x4df781,_0xb68642]=_0x3fe4e3['replace'](_0x260e21(0x1e0),'')[_0x260e21(0x1bc)]('_');return{'type':_0x4df781,'date':_0xb68642,'size':_0x582de2[_0x260e21(0x1cf)]};})['sort']((_0x357549,_0x5d83a0)=>_0x5d83a0[_0x383879(0x199)]['localeCompare'](_0x357549['date']));return{'totalFiles':_0x404bea[_0x383879(0x1b2)],'logTypes':_0x568d39,'latestLogs':_0x536429[_0x383879(0x1aa)](0x0,0xa)};}catch(_0x41b78a){return console[_0x383879(0x1d9)]('Failed\x20to\x20get\x20log\x20stats:',_0x41b78a),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x169dab(0x1c2)](_0x5b5f34=0x1e){const _0x3e64eb=a48_0x169dab;try{const _0x4e46c0=fs_1[_0x3e64eb(0x1af)]['readdirSync'](this['logsDir']),_0x583d16=new Date();_0x583d16[_0x3e64eb(0x1df)](_0x583d16[_0x3e64eb(0x1d5)]()-_0x5b5f34);let _0x263ad3=0x0;_0x4e46c0[_0x3e64eb(0x19e)](_0x1c7db2=>{const _0x53a126=_0x3e64eb;if(!_0x1c7db2[_0x53a126(0x19a)](_0x53a126(0x1e0)))return;const _0x450254=path_1['default'][_0x53a126(0x1da)](this['logsDir'],_0x1c7db2),_0x120d36=fs_1[_0x53a126(0x1af)]['statSync'](_0x450254);_0x120d36[_0x53a126(0x1ad)]<_0x583d16&&(fs_1[_0x53a126(0x1af)]['unlinkSync'](_0x450254),_0x263ad3++,console[_0x53a126(0x1bd)](_0x53a126(0x1a0)+_0x1c7db2));}),console[_0x3e64eb(0x1bd)](_0x3e64eb(0x1a3)+_0x263ad3+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x5b5f34+_0x3e64eb(0x1a1));}catch(_0x3e3f47){console[_0x3e64eb(0x1d9)](_0x3e64eb(0x1a7),_0x3e3f47);}}}exports[a48_0x169dab(0x1a4)]=LoggerService,exports['loggerService']=new LoggerService();