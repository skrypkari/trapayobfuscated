'use strict';const a44_0x3964fd=a44_0x31b7;(function(_0x19d655,_0x2b836f){const _0x5a4088=a44_0x31b7,_0x1bffd3=_0x19d655();while(!![]){try{const _0x526a9a=-parseInt(_0x5a4088(0x1f8))/0x1*(-parseInt(_0x5a4088(0x22a))/0x2)+parseInt(_0x5a4088(0x1fe))/0x3*(parseInt(_0x5a4088(0x1eb))/0x4)+-parseInt(_0x5a4088(0x238))/0x5+parseInt(_0x5a4088(0x20d))/0x6*(-parseInt(_0x5a4088(0x20e))/0x7)+parseInt(_0x5a4088(0x212))/0x8+-parseInt(_0x5a4088(0x206))/0x9*(parseInt(_0x5a4088(0x1fd))/0xa)+-parseInt(_0x5a4088(0x203))/0xb*(parseInt(_0x5a4088(0x1f3))/0xc);if(_0x526a9a===_0x2b836f)break;else _0x1bffd3['push'](_0x1bffd3['shift']());}catch(_0x225100){_0x1bffd3['push'](_0x1bffd3['shift']());}}}(a44_0x4816,0x9e7c3));function a44_0x31b7(_0x54160d,_0x248192){const _0x4816ca=a44_0x4816();return a44_0x31b7=function(_0x31b7d3,_0x525159){_0x31b7d3=_0x31b7d3-0x1de;let _0xa9ad49=_0x4816ca[_0x31b7d3];return _0xa9ad49;},a44_0x31b7(_0x54160d,_0x248192);}function a44_0x4816(){const _0x59f4af=['PAYMENT_CREATED','date','mtime','WEBHOOK_PROCESSED','toISOString','\x20old\x20log\x20files\x20(older\x20than\x20','328528blymbf','utf8','.log','forEach','loggerService','ðŸ§¹\x20Cleaned\x20','logsDir','ERROR','12vEyIJO','unlinkSync','logWhiteDomainResponse','join','existsSync','1jhwene','payments_created','shop_webhooks_sent','__importDefault','writeLog','80090AXrXJT','3bCVjVL','webhooks_errors','length','defineProperty','cwd','8090885wjngQi','error','logShopWebhookSent','9lYIdPf','white_domain_errors','WEBHOOK_RECEIVED','COINTOPAY_STATUS_CHANGE','sort','ensureLogsDirectory','setDate','672qPmjiz','14PMxXSR','stringify','webhooks_received','\x20log:','4106088cSGZjv','Failed\x20to\x20get\x20log\x20stats:','API_CALL','RESPONSE','COINTOPAY_ERROR','path','getDate','logWebhookError','webhooks_processed','LoggerService','api_calls','Failed\x20to\x20write\x20','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','white_domain_requests','replace','logApiCall','default','cointopay_status_changes','getLogFileName','mkdirSync','readdirSync','log','REQUEST','cleanOldLogs','1742082UeudiP','\x20days)','logPaymentCreated','ðŸ“\x20Created\x20logs\x20directory:\x20','message','WEBHOOK_ERROR','stack','SHOP_WEBHOOK_ERROR','localeCompare','logCoinToPayStatus','size','endsWith','logWebhookReceived','cointopay_errors','367555jBdlyb','slice','logWebhookProcessed','split','white_domain_responses','__esModule','map','logWhiteDomainRequest','statSync','logShopWebhookError'];a44_0x4816=function(){return _0x59f4af;};return a44_0x4816();}var __importDefault=this&&this[a44_0x3964fd(0x1fb)]||function(_0x365907){const _0x2d37ec=a44_0x3964fd;return _0x365907&&_0x365907[_0x2d37ec(0x1e0)]?_0x365907:{'default':_0x365907};};Object[a44_0x3964fd(0x201)](exports,a44_0x3964fd(0x1e0),{'value':!![]}),exports[a44_0x3964fd(0x1ef)]=exports[a44_0x3964fd(0x21b)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a44_0x3964fd(0x217)));class LoggerService{constructor(){const _0x49dac9=a44_0x3964fd;this[_0x49dac9(0x1f1)]=path_1['default'][_0x49dac9(0x1f6)](process[_0x49dac9(0x202)](),'logs'),this[_0x49dac9(0x20b)]();}[a44_0x3964fd(0x20b)](){const _0x35ada8=a44_0x3964fd;!fs_1[_0x35ada8(0x222)][_0x35ada8(0x1f7)](this['logsDir'])&&(fs_1['default'][_0x35ada8(0x225)](this[_0x35ada8(0x1f1)],{'recursive':!![]}),console[_0x35ada8(0x227)](_0x35ada8(0x22d)+this['logsDir']));}['getLogFileName'](_0xbc5a69){const _0x51a7ca=a44_0x3964fd,_0x129c1d=new Date()[_0x51a7ca(0x1e9)]()['split']('T')[0x0];return path_1['default'][_0x51a7ca(0x1f6)](this['logsDir'],_0xbc5a69+'_'+_0x129c1d+_0x51a7ca(0x1ed));}[a44_0x3964fd(0x1fc)](_0x2b7626,_0x309a90){const _0x1b4111=a44_0x3964fd;try{const _0x3c955b=new Date()[_0x1b4111(0x1e9)](),_0x361f64={'timestamp':_0x3c955b,..._0x309a90},_0x55f296=JSON[_0x1b4111(0x20f)](_0x361f64)+'\x0a',_0x42c3bb=this[_0x1b4111(0x224)](_0x2b7626);fs_1[_0x1b4111(0x222)]['appendFileSync'](_0x42c3bb,_0x55f296,_0x1b4111(0x1ec));}catch(_0x4b796f){console['error'](_0x1b4111(0x21d)+_0x2b7626+_0x1b4111(0x211),_0x4b796f);}}[a44_0x3964fd(0x1e2)](_0x2963ad,_0xddffc0,_0x25b348,_0x251569){const _0x314c16=a44_0x3964fd;this[_0x314c16(0x1fc)](_0x314c16(0x21f),{'type':_0x314c16(0x228),'gateway':_0x2963ad,'endpoint':_0xddffc0,'method':_0x25b348,'data':_0x251569});}[a44_0x3964fd(0x1f5)](_0x7cb60d,_0x201048,_0x4a7d46,_0x15c762,_0x13c77b){const _0x55bb86=a44_0x3964fd;this[_0x55bb86(0x1fc)](_0x55bb86(0x1df),{'type':_0x55bb86(0x215),'gateway':_0x7cb60d,'endpoint':_0x201048,'status':_0x4a7d46,'responseTime':_0x13c77b,'data':_0x15c762});}['logWhiteDomainError'](_0x2e11ad,_0x3e9245,_0x2ad196){const _0x595865=a44_0x3964fd;this[_0x595865(0x1fc)](_0x595865(0x207),{'type':_0x595865(0x1f2),'gateway':_0x2e11ad,'endpoint':_0x3e9245,'error':_0x2ad196 instanceof Error?{'message':_0x2ad196[_0x595865(0x22e)],'stack':_0x2ad196['stack']}:_0x2ad196});}[a44_0x3964fd(0x236)](_0x54c9f8,_0x329729,_0x64253e){const _0x4a03e3=a44_0x3964fd;this['writeLog'](_0x4a03e3(0x210),{'type':_0x4a03e3(0x208),'gateway':_0x54c9f8,'headers':_0x64253e,'data':_0x329729});}[a44_0x3964fd(0x23a)](_0x2923e7,_0x522fa9,_0xff2e6a,_0x5db2e9,_0x2a37f6){const _0x15ca7a=a44_0x3964fd;this[_0x15ca7a(0x1fc)](_0x15ca7a(0x21a),{'type':_0x15ca7a(0x1e8),'gateway':_0x2923e7,'paymentId':_0x522fa9,'oldStatus':_0xff2e6a,'newStatus':_0x5db2e9,'originalData':_0x2a37f6});}[a44_0x3964fd(0x219)](_0x3e978d,_0x2f6876,_0x4e47f1){const _0x53a37e=a44_0x3964fd;this[_0x53a37e(0x1fc)](_0x53a37e(0x1ff),{'type':_0x53a37e(0x22f),'gateway':_0x3e978d,'error':_0x2f6876 instanceof Error?{'message':_0x2f6876['message'],'stack':_0x2f6876[_0x53a37e(0x230)]}:_0x2f6876,'originalData':_0x4e47f1});}[a44_0x3964fd(0x233)](_0x7b4bb2){const _0xab2ba8=a44_0x3964fd;this[_0xab2ba8(0x1fc)](_0xab2ba8(0x223),{'type':_0xab2ba8(0x209),..._0x7b4bb2});}['logCoinToPayError'](_0x4cee7e){const _0x2d01c9=a44_0x3964fd;this[_0x2d01c9(0x1fc)](_0x2d01c9(0x237),{'type':_0x2d01c9(0x216),..._0x4cee7e});}[a44_0x3964fd(0x205)](_0x1c2f65,_0x45f424,_0x35819d,_0x55e6a9,_0x570066,_0x4b0bc0){const _0x1a3fb5=a44_0x3964fd;this[_0x1a3fb5(0x1fc)](_0x1a3fb5(0x1fa),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x1c2f65,'webhookUrl':_0x45f424,'event':_0x35819d,'status':_0x55e6a9,'responseTime':_0x570066,'payload':_0x4b0bc0});}[a44_0x3964fd(0x1e4)](_0x1f57e5,_0x3a8139,_0x50052f,_0x27c229,_0x289e22){const _0x1f6775=a44_0x3964fd;this[_0x1f6775(0x1fc)]('shop_webhooks_errors',{'type':_0x1f6775(0x231),'shopId':_0x1f57e5,'webhookUrl':_0x3a8139,'event':_0x50052f,'error':_0x27c229 instanceof Error?{'message':_0x27c229[_0x1f6775(0x22e)],'stack':_0x27c229[_0x1f6775(0x230)]}:_0x27c229,'payload':_0x289e22});}[a44_0x3964fd(0x22c)](_0x3f2e8e,_0x54ec52,_0x3d3b5a,_0x2f2d65,_0xfff1){const _0x3cf2c1=a44_0x3964fd;this['writeLog'](_0x3cf2c1(0x1f9),{'type':_0x3cf2c1(0x1e5),'gateway':_0x3f2e8e,'paymentId':_0x54ec52,'shopId':_0x3d3b5a,'amount':_0x2f2d65,'currency':_0xfff1});}[a44_0x3964fd(0x221)](_0x5340e6,_0x58709b,_0x53c276,_0x351e6c,_0x438807){const _0x2fb02a=a44_0x3964fd;this[_0x2fb02a(0x1fc)](_0x2fb02a(0x21c),{'type':_0x2fb02a(0x214),'endpoint':_0x5340e6,'method':_0x58709b,'userId':_0x53c276,'userRole':_0x351e6c,'requestData':_0x438807});}['getLogStats'](){const _0x4af5fd=a44_0x3964fd;try{const _0x30e1d3=fs_1[_0x4af5fd(0x222)][_0x4af5fd(0x226)](this[_0x4af5fd(0x1f1)]),_0x785e74=_0x30e1d3['filter'](_0x51fc66=>_0x51fc66[_0x4af5fd(0x235)](_0x4af5fd(0x1ed))),_0x1fef75=[...new Set(_0x785e74[_0x4af5fd(0x1e1)](_0x320a6e=>_0x320a6e[_0x4af5fd(0x1de)]('_')[0x0]))],_0x557fa1=_0x785e74[_0x4af5fd(0x1e1)](_0x98d0ba=>{const _0x1bcab1=_0x4af5fd,_0x3c8af9=path_1['default'][_0x1bcab1(0x1f6)](this[_0x1bcab1(0x1f1)],_0x98d0ba),_0x244353=fs_1[_0x1bcab1(0x222)][_0x1bcab1(0x1e3)](_0x3c8af9),[_0x360eee,_0x35d314]=_0x98d0ba[_0x1bcab1(0x220)](_0x1bcab1(0x1ed),'')[_0x1bcab1(0x1de)]('_');return{'type':_0x360eee,'date':_0x35d314,'size':_0x244353[_0x1bcab1(0x234)]};})[_0x4af5fd(0x20a)]((_0x1fd162,_0x34d43d)=>_0x34d43d['date'][_0x4af5fd(0x232)](_0x1fd162[_0x4af5fd(0x1e6)]));return{'totalFiles':_0x785e74[_0x4af5fd(0x200)],'logTypes':_0x1fef75,'latestLogs':_0x557fa1[_0x4af5fd(0x239)](0x0,0xa)};}catch(_0x882ba8){return console['error'](_0x4af5fd(0x213),_0x882ba8),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a44_0x3964fd(0x229)](_0x4ab7a6=0x1e){const _0x2b5b1a=a44_0x3964fd;try{const _0x16500b=fs_1[_0x2b5b1a(0x222)][_0x2b5b1a(0x226)](this[_0x2b5b1a(0x1f1)]),_0x4d83b1=new Date();_0x4d83b1[_0x2b5b1a(0x20c)](_0x4d83b1[_0x2b5b1a(0x218)]()-_0x4ab7a6);let _0x59ba3d=0x0;_0x16500b[_0x2b5b1a(0x1ee)](_0x3fd0bf=>{const _0x4f5d44=_0x2b5b1a;if(!_0x3fd0bf[_0x4f5d44(0x235)](_0x4f5d44(0x1ed)))return;const _0x41426f=path_1[_0x4f5d44(0x222)][_0x4f5d44(0x1f6)](this[_0x4f5d44(0x1f1)],_0x3fd0bf),_0x2895ad=fs_1[_0x4f5d44(0x222)]['statSync'](_0x41426f);_0x2895ad[_0x4f5d44(0x1e7)]<_0x4d83b1&&(fs_1[_0x4f5d44(0x222)][_0x4f5d44(0x1f4)](_0x41426f),_0x59ba3d++,console[_0x4f5d44(0x227)](_0x4f5d44(0x21e)+_0x3fd0bf));}),console[_0x2b5b1a(0x227)](_0x2b5b1a(0x1f0)+_0x59ba3d+_0x2b5b1a(0x1ea)+_0x4ab7a6+_0x2b5b1a(0x22b));}catch(_0x570981){console[_0x2b5b1a(0x204)]('Failed\x20to\x20clean\x20old\x20logs:',_0x570981);}}}exports[a44_0x3964fd(0x21b)]=LoggerService,exports[a44_0x3964fd(0x1ef)]=new LoggerService();