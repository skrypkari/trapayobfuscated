'use strict';const a48_0x331bb3=a48_0x1505;function a48_0x5640(){const _0x2f64b3=['white_domain_errors','endsWith','Failed\x20to\x20write\x20','REQUEST','logWhiteDomainError','SHOP_WEBHOOK_ERROR','filter','logsDir','RESPONSE','WEBHOOK_RECEIVED','stack','logShopWebhookError','logCoinToPayStatus','white_domain_requests','242UGPQUG','getDate','getLogFileName','__esModule','readdirSync','\x20log:','message','logShopWebhookSent','white_domain_responses','appendFileSync','split','ensureLogsDirectory','statSync','path','__importDefault','size','replace','map','COINTOPAY_ERROR','mtime','logCoinToPayError','logWhiteDomainRequest','🗑️\x20Deleted\x20old\x20log\x20file:\x20','localeCompare','length','Failed\x20to\x20clean\x20old\x20logs:','LoggerService','11Fncgad','3wZqeQP','webhooks_processed','cointopay_errors','4307KxdbOG','cointopay_status_changes','843992nBfgon','log','🧹\x20Cleaned\x20','logPaymentCreated','api_calls','sort','84380CpUVXB','logWhiteDomainResponse','slice','WEBHOOK_ERROR','utf8','\x20old\x20log\x20files\x20(older\x20than\x20','logWebhookError','logWebhookProcessed','loggerService','5663874Mszafk','error','join','writeLog','6104585roUOgj','18FbdlAO','\x20days)','PAYMENT_CREATED','SHOP_WEBHOOK_SENT','1934572vXNHhR','WEBHOOK_PROCESSED','2570892HdlFkI','35adtQER','defineProperty','COINTOPAY_STATUS_CHANGE','default','getLogStats'];a48_0x5640=function(){return _0x2f64b3;};return a48_0x5640();}(function(_0x511184,_0x192bb2){const _0x5f29af=a48_0x1505,_0x460cef=_0x511184();while(!![]){try{const _0x4d59ee=parseInt(_0x5f29af(0xaf))/0x1*(parseInt(_0x5f29af(0xdf))/0x2)+parseInt(_0x5f29af(0xac))/0x3*(-parseInt(_0x5f29af(0xc9))/0x4)+parseInt(_0x5f29af(0xc4))/0x5+-parseInt(_0x5f29af(0xc0))/0x6+-parseInt(_0x5f29af(0xcc))/0x7*(-parseInt(_0x5f29af(0xb1))/0x8)+-parseInt(_0x5f29af(0xc5))/0x9*(parseInt(_0x5f29af(0xb7))/0xa)+parseInt(_0x5f29af(0xab))/0xb*(-parseInt(_0x5f29af(0xcb))/0xc);if(_0x4d59ee===_0x192bb2)break;else _0x460cef['push'](_0x460cef['shift']());}catch(_0x34bbbe){_0x460cef['push'](_0x460cef['shift']());}}}(a48_0x5640,0x95204));function a48_0x1505(_0x5d80ab,_0x3952e6){const _0x564066=a48_0x5640();return a48_0x1505=function(_0x15051e,_0x3e4d17){_0x15051e=_0x15051e-0xa2;let _0x1ff170=_0x564066[_0x15051e];return _0x1ff170;},a48_0x1505(_0x5d80ab,_0x3952e6);}var __importDefault=this&&this[a48_0x331bb3(0xed)]||function(_0x56a9a3){const _0x4a7648=a48_0x331bb3;return _0x56a9a3&&_0x56a9a3[_0x4a7648(0xe2)]?_0x56a9a3:{'default':_0x56a9a3};};Object[a48_0x331bb3(0xcd)](exports,a48_0x331bb3(0xe2),{'value':!![]}),exports[a48_0x331bb3(0xbf)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x331bb3(0xec)));class LoggerService{constructor(){const _0x22c3da=a48_0x331bb3;this['logsDir']=path_1[_0x22c3da(0xcf)]['join'](process['cwd'](),'logs'),this[_0x22c3da(0xea)]();}[a48_0x331bb3(0xea)](){const _0x2c2e5e=a48_0x331bb3;!fs_1['default']['existsSync'](this[_0x2c2e5e(0xd8)])&&(fs_1[_0x2c2e5e(0xcf)]['mkdirSync'](this[_0x2c2e5e(0xd8)],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x2c2e5e(0xd8)]));}[a48_0x331bb3(0xe1)](_0x37f337){const _0x53df0a=a48_0x331bb3,_0x5abc98=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x53df0a(0xcf)]['join'](this[_0x53df0a(0xd8)],_0x37f337+'_'+_0x5abc98+'.log');}[a48_0x331bb3(0xc3)](_0x53fd98,_0x5edbf7){const _0x5190e2=a48_0x331bb3;try{const _0x533f26=new Date()['toISOString'](),_0x5eb03d={'timestamp':_0x533f26,..._0x5edbf7},_0x546e00=JSON['stringify'](_0x5eb03d)+'\x0a',_0x3a0d61=this[_0x5190e2(0xe1)](_0x53fd98);fs_1[_0x5190e2(0xcf)][_0x5190e2(0xe8)](_0x3a0d61,_0x546e00,_0x5190e2(0xbb));}catch(_0x2495a9){console[_0x5190e2(0xc1)](_0x5190e2(0xd3)+_0x53fd98+_0x5190e2(0xe4),_0x2495a9);}}[a48_0x331bb3(0xa5)](_0x33f420,_0x17b9f6,_0x34b65c,_0x10fff5){const _0x3fd834=a48_0x331bb3;this[_0x3fd834(0xc3)](_0x3fd834(0xde),{'type':_0x3fd834(0xd4),'gateway':_0x33f420,'endpoint':_0x17b9f6,'method':_0x34b65c,'data':_0x10fff5});}[a48_0x331bb3(0xb8)](_0x2e7fe4,_0x18b7ff,_0x301c4c,_0x1f2cc2,_0x1f0372){const _0xa404df=a48_0x331bb3;this[_0xa404df(0xc3)](_0xa404df(0xe7),{'type':_0xa404df(0xd9),'gateway':_0x2e7fe4,'endpoint':_0x18b7ff,'status':_0x301c4c,'responseTime':_0x1f0372,'data':_0x1f2cc2});}[a48_0x331bb3(0xd5)](_0x5e1336,_0x3c6e46,_0x226444){const _0x4e38f6=a48_0x331bb3;this[_0x4e38f6(0xc3)](_0x4e38f6(0xd1),{'type':'ERROR','gateway':_0x5e1336,'endpoint':_0x3c6e46,'error':_0x226444 instanceof Error?{'message':_0x226444[_0x4e38f6(0xe5)],'stack':_0x226444['stack']}:_0x226444});}['logWebhookReceived'](_0x7252c0,_0x286cc7,_0x366b08){const _0x33a02e=a48_0x331bb3;this[_0x33a02e(0xc3)]('webhooks_received',{'type':_0x33a02e(0xda),'gateway':_0x7252c0,'headers':_0x366b08,'data':_0x286cc7});}[a48_0x331bb3(0xbe)](_0xcb9796,_0x441ac0,_0x37dfbb,_0x3f919f,_0xf09cc6){const _0xbafc0d=a48_0x331bb3;this[_0xbafc0d(0xc3)](_0xbafc0d(0xad),{'type':_0xbafc0d(0xca),'gateway':_0xcb9796,'paymentId':_0x441ac0,'oldStatus':_0x37dfbb,'newStatus':_0x3f919f,'originalData':_0xf09cc6});}[a48_0x331bb3(0xbd)](_0x12a4aa,_0x395214,_0x2288c9){const _0x48c4f4=a48_0x331bb3;this[_0x48c4f4(0xc3)]('webhooks_errors',{'type':_0x48c4f4(0xba),'gateway':_0x12a4aa,'error':_0x395214 instanceof Error?{'message':_0x395214[_0x48c4f4(0xe5)],'stack':_0x395214['stack']}:_0x395214,'originalData':_0x2288c9});}[a48_0x331bb3(0xdd)](_0x454ac5){const _0x5ef5dd=a48_0x331bb3;this[_0x5ef5dd(0xc3)](_0x5ef5dd(0xb0),{'type':_0x5ef5dd(0xce),..._0x454ac5});}[a48_0x331bb3(0xa4)](_0x410420){const _0x4acbf2=a48_0x331bb3;this[_0x4acbf2(0xc3)](_0x4acbf2(0xae),{'type':_0x4acbf2(0xa2),..._0x410420});}[a48_0x331bb3(0xe6)](_0x598104,_0x406ad5,_0x2d6dee,_0x1e4211,_0x429591,_0x41963e){const _0x10491d=a48_0x331bb3;this[_0x10491d(0xc3)]('shop_webhooks_sent',{'type':_0x10491d(0xc8),'shopId':_0x598104,'webhookUrl':_0x406ad5,'event':_0x2d6dee,'status':_0x1e4211,'responseTime':_0x429591,'payload':_0x41963e});}[a48_0x331bb3(0xdc)](_0x252063,_0x212873,_0x3a6c23,_0x25774e,_0x1ea2e8){const _0x197b4d=a48_0x331bb3;this[_0x197b4d(0xc3)]('shop_webhooks_errors',{'type':_0x197b4d(0xd6),'shopId':_0x252063,'webhookUrl':_0x212873,'event':_0x3a6c23,'error':_0x25774e instanceof Error?{'message':_0x25774e[_0x197b4d(0xe5)],'stack':_0x25774e[_0x197b4d(0xdb)]}:_0x25774e,'payload':_0x1ea2e8});}[a48_0x331bb3(0xb4)](_0x31b2cd,_0x2349ea,_0x3224c1,_0x2c68e6,_0x44db4a){const _0x1fc7a7=a48_0x331bb3;this[_0x1fc7a7(0xc3)]('payments_created',{'type':_0x1fc7a7(0xc7),'gateway':_0x31b2cd,'paymentId':_0x2349ea,'shopId':_0x3224c1,'amount':_0x2c68e6,'currency':_0x44db4a});}['logApiCall'](_0x206afd,_0xe46c47,_0x231a55,_0x5d8df7,_0x5aca07){const _0x4040a0=a48_0x331bb3;this[_0x4040a0(0xc3)](_0x4040a0(0xb5),{'type':'API_CALL','endpoint':_0x206afd,'method':_0xe46c47,'userId':_0x231a55,'userRole':_0x5d8df7,'requestData':_0x5aca07});}[a48_0x331bb3(0xd0)](){const _0x58c80b=a48_0x331bb3;try{const _0x3fe6fa=fs_1[_0x58c80b(0xcf)]['readdirSync'](this[_0x58c80b(0xd8)]),_0x5959b5=_0x3fe6fa[_0x58c80b(0xd7)](_0x1a4c3b=>_0x1a4c3b[_0x58c80b(0xd2)]('.log')),_0x41a126=[...new Set(_0x5959b5[_0x58c80b(0xf0)](_0x1e5bcd=>_0x1e5bcd[_0x58c80b(0xe9)]('_')[0x0]))],_0x46c119=_0x5959b5[_0x58c80b(0xf0)](_0x5d25b3=>{const _0x17175e=_0x58c80b,_0x44a010=path_1[_0x17175e(0xcf)][_0x17175e(0xc2)](this[_0x17175e(0xd8)],_0x5d25b3),_0x55a5ac=fs_1['default'][_0x17175e(0xeb)](_0x44a010),[_0x5569b9,_0x3e01ed]=_0x5d25b3[_0x17175e(0xef)]('.log','')[_0x17175e(0xe9)]('_');return{'type':_0x5569b9,'date':_0x3e01ed,'size':_0x55a5ac[_0x17175e(0xee)]};})[_0x58c80b(0xb6)]((_0x54bcd4,_0x4b28db)=>_0x4b28db['date'][_0x58c80b(0xa7)](_0x54bcd4['date']));return{'totalFiles':_0x5959b5[_0x58c80b(0xa8)],'logTypes':_0x41a126,'latestLogs':_0x46c119[_0x58c80b(0xb9)](0x0,0xa)};}catch(_0x5c47b9){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x5c47b9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x453c12=0x1e){const _0x27835f=a48_0x331bb3;try{const _0x330336=fs_1['default'][_0x27835f(0xe3)](this[_0x27835f(0xd8)]),_0x52e380=new Date();_0x52e380['setDate'](_0x52e380[_0x27835f(0xe0)]()-_0x453c12);let _0x3675a8=0x0;_0x330336['forEach'](_0x208893=>{const _0x146fdb=_0x27835f;if(!_0x208893[_0x146fdb(0xd2)]('.log'))return;const _0x413551=path_1[_0x146fdb(0xcf)][_0x146fdb(0xc2)](this[_0x146fdb(0xd8)],_0x208893),_0x6d29e3=fs_1[_0x146fdb(0xcf)][_0x146fdb(0xeb)](_0x413551);_0x6d29e3[_0x146fdb(0xa3)]<_0x52e380&&(fs_1[_0x146fdb(0xcf)]['unlinkSync'](_0x413551),_0x3675a8++,console[_0x146fdb(0xb2)](_0x146fdb(0xa6)+_0x208893));}),console[_0x27835f(0xb2)](_0x27835f(0xb3)+_0x3675a8+_0x27835f(0xbc)+_0x453c12+_0x27835f(0xc6));}catch(_0x1502af){console[_0x27835f(0xc1)](_0x27835f(0xa9),_0x1502af);}}}exports[a48_0x331bb3(0xaa)]=LoggerService,exports[a48_0x331bb3(0xbf)]=new LoggerService();