'use strict';const a48_0x275a2e=a48_0x1bfe;function a48_0x1bfe(_0x4a5809,_0x3eb9bf){const _0x1324bb=a48_0x1324();return a48_0x1bfe=function(_0x1bfeae,_0x21e0bb){_0x1bfeae=_0x1bfeae-0x114;let _0x556cec=_0x1324bb[_0x1bfeae];return _0x556cec;},a48_0x1bfe(_0x4a5809,_0x3eb9bf);}(function(_0x272827,_0x493230){const _0x4b80a6=a48_0x1bfe,_0x1718a4=_0x272827();while(!![]){try{const _0x2b677c=-parseInt(_0x4b80a6(0x156))/0x1*(parseInt(_0x4b80a6(0x137))/0x2)+parseInt(_0x4b80a6(0x123))/0x3+parseInt(_0x4b80a6(0x125))/0x4*(parseInt(_0x4b80a6(0x151))/0x5)+-parseInt(_0x4b80a6(0x118))/0x6+-parseInt(_0x4b80a6(0x12f))/0x7+-parseInt(_0x4b80a6(0x119))/0x8*(parseInt(_0x4b80a6(0x152))/0x9)+parseInt(_0x4b80a6(0x14e))/0xa;if(_0x2b677c===_0x493230)break;else _0x1718a4['push'](_0x1718a4['shift']());}catch(_0x556974){_0x1718a4['push'](_0x1718a4['shift']());}}}(a48_0x1324,0x9accf));function a48_0x1324(){const _0x3cb367=['readdirSync','390081SXglKf','logsDir','21324SgmKOh','mkdirSync','ERROR','loggerService','log','forEach','getLogStats','toISOString','WEBHOOK_RECEIVED','default','1747032ZBmGet','REQUEST','api_calls','split','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logWebhookError','cleanOldLogs','LoggerService','4wHMBfJ','.log','payments_created','logCoinToPayStatus','white_domain_errors','logWhiteDomainError','\x20log:','shop_webhooks_errors','length','shop_webhooks_sent','cointopay_errors','logShopWebhookError','WEBHOOK_ERROR','white_domain_responses','writeLog','WEBHOOK_PROCESSED','webhooks_received','COINTOPAY_ERROR','ensureLogsDirectory','setDate','filter','unlinkSync','message','28657930xewcJT','stringify','logWebhookReceived','160jWTuvD','24147NoWVfy','replace','logWhiteDomainResponse','logShopWebhookSent','524788zCNZnB','sort','API_CALL','map','date','SHOP_WEBHOOK_SENT','defineProperty','webhooks_processed','stack','logWebhookProcessed','error','Failed\x20to\x20clean\x20old\x20logs:','__esModule','endsWith','getDate','join','slice','statSync','white_domain_requests','5773284KnJluc','808SCeoNF','getLogFileName','\x20days)','SHOP_WEBHOOK_ERROR','logCoinToPayError','Failed\x20to\x20get\x20log\x20stats:','COINTOPAY_STATUS_CHANGE','path','existsSync'];a48_0x1324=function(){return _0x3cb367;};return a48_0x1324();}var __importDefault=this&&this['__importDefault']||function(_0x4d2240){const _0x3025c4=a48_0x1bfe;return _0x4d2240&&_0x4d2240[_0x3025c4(0x162)]?_0x4d2240:{'default':_0x4d2240};};Object[a48_0x275a2e(0x15c)](exports,a48_0x275a2e(0x162),{'value':!![]}),exports[a48_0x275a2e(0x128)]=exports[a48_0x275a2e(0x136)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x275a2e(0x120)));class LoggerService{constructor(){const _0x393377=a48_0x275a2e;this[_0x393377(0x124)]=path_1[_0x393377(0x12e)][_0x393377(0x114)](process['cwd'](),'logs'),this[_0x393377(0x149)]();}[a48_0x275a2e(0x149)](){const _0x18ba98=a48_0x275a2e;!fs_1[_0x18ba98(0x12e)][_0x18ba98(0x121)](this['logsDir'])&&(fs_1[_0x18ba98(0x12e)][_0x18ba98(0x126)](this['logsDir'],{'recursive':!![]}),console[_0x18ba98(0x129)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x18ba98(0x124)]));}[a48_0x275a2e(0x11a)](_0x898571){const _0x4eb082=a48_0x275a2e,_0x1dda06=new Date()[_0x4eb082(0x12c)]()[_0x4eb082(0x132)]('T')[0x0];return path_1[_0x4eb082(0x12e)][_0x4eb082(0x114)](this[_0x4eb082(0x124)],_0x898571+'_'+_0x1dda06+_0x4eb082(0x138));}[a48_0x275a2e(0x145)](_0x32674f,_0x7842c8){const _0x14ea15=a48_0x275a2e;try{const _0x1e2ad6=new Date()[_0x14ea15(0x12c)](),_0x4c13cf={'timestamp':_0x1e2ad6,..._0x7842c8},_0x29d048=JSON[_0x14ea15(0x14f)](_0x4c13cf)+'\x0a',_0x25577f=this[_0x14ea15(0x11a)](_0x32674f);fs_1[_0x14ea15(0x12e)]['appendFileSync'](_0x25577f,_0x29d048,'utf8');}catch(_0x295981){console[_0x14ea15(0x160)]('Failed\x20to\x20write\x20'+_0x32674f+_0x14ea15(0x13d),_0x295981);}}['logWhiteDomainRequest'](_0xd598fa,_0x54a693,_0x417cf9,_0x55bd7a){const _0x3a38c3=a48_0x275a2e;this[_0x3a38c3(0x145)](_0x3a38c3(0x117),{'type':_0x3a38c3(0x130),'gateway':_0xd598fa,'endpoint':_0x54a693,'method':_0x417cf9,'data':_0x55bd7a});}[a48_0x275a2e(0x154)](_0x1fb53b,_0x46c324,_0x1c0e31,_0x88d12d,_0x269b37){const _0x5bc664=a48_0x275a2e;this['writeLog'](_0x5bc664(0x144),{'type':'RESPONSE','gateway':_0x1fb53b,'endpoint':_0x46c324,'status':_0x1c0e31,'responseTime':_0x269b37,'data':_0x88d12d});}[a48_0x275a2e(0x13c)](_0x2340d3,_0x4d5492,_0x2c3d81){const _0x490dba=a48_0x275a2e;this['writeLog'](_0x490dba(0x13b),{'type':_0x490dba(0x127),'gateway':_0x2340d3,'endpoint':_0x4d5492,'error':_0x2c3d81 instanceof Error?{'message':_0x2c3d81[_0x490dba(0x14d)],'stack':_0x2c3d81[_0x490dba(0x15e)]}:_0x2c3d81});}[a48_0x275a2e(0x150)](_0x57e65,_0x1cf732,_0x131990){const _0x21ab4b=a48_0x275a2e;this[_0x21ab4b(0x145)](_0x21ab4b(0x147),{'type':_0x21ab4b(0x12d),'gateway':_0x57e65,'headers':_0x131990,'data':_0x1cf732});}[a48_0x275a2e(0x15f)](_0x313795,_0x42445c,_0x31a95d,_0x1cf6aa,_0x2b1ffc){const _0x63deb4=a48_0x275a2e;this[_0x63deb4(0x145)](_0x63deb4(0x15d),{'type':_0x63deb4(0x146),'gateway':_0x313795,'paymentId':_0x42445c,'oldStatus':_0x31a95d,'newStatus':_0x1cf6aa,'originalData':_0x2b1ffc});}[a48_0x275a2e(0x134)](_0x502ef6,_0x52c501,_0x2f1e5a){const _0x4995b3=a48_0x275a2e;this[_0x4995b3(0x145)]('webhooks_errors',{'type':_0x4995b3(0x143),'gateway':_0x502ef6,'error':_0x52c501 instanceof Error?{'message':_0x52c501['message'],'stack':_0x52c501[_0x4995b3(0x15e)]}:_0x52c501,'originalData':_0x2f1e5a});}[a48_0x275a2e(0x13a)](_0x22d38d){const _0xb1a869=a48_0x275a2e;this[_0xb1a869(0x145)]('cointopay_status_changes',{'type':_0xb1a869(0x11f),..._0x22d38d});}[a48_0x275a2e(0x11d)](_0x18be98){const _0x2ecdfd=a48_0x275a2e;this[_0x2ecdfd(0x145)](_0x2ecdfd(0x141),{'type':_0x2ecdfd(0x148),..._0x18be98});}[a48_0x275a2e(0x155)](_0x589cda,_0x2f1b5b,_0x23aa45,_0x312017,_0x5a973b,_0xc7f425){const _0x2cb213=a48_0x275a2e;this[_0x2cb213(0x145)](_0x2cb213(0x140),{'type':_0x2cb213(0x15b),'shopId':_0x589cda,'webhookUrl':_0x2f1b5b,'event':_0x23aa45,'status':_0x312017,'responseTime':_0x5a973b,'payload':_0xc7f425});}[a48_0x275a2e(0x142)](_0x2dd36b,_0x2c9c3f,_0x4bcd43,_0x5a1756,_0xa5ffdd){const _0x2a5fdd=a48_0x275a2e;this[_0x2a5fdd(0x145)](_0x2a5fdd(0x13e),{'type':_0x2a5fdd(0x11c),'shopId':_0x2dd36b,'webhookUrl':_0x2c9c3f,'event':_0x4bcd43,'error':_0x5a1756 instanceof Error?{'message':_0x5a1756[_0x2a5fdd(0x14d)],'stack':_0x5a1756['stack']}:_0x5a1756,'payload':_0xa5ffdd});}['logPaymentCreated'](_0x2c2042,_0x5678e1,_0x1c67af,_0xccac65,_0xa8cf07){const _0x4c034a=a48_0x275a2e;this[_0x4c034a(0x145)](_0x4c034a(0x139),{'type':'PAYMENT_CREATED','gateway':_0x2c2042,'paymentId':_0x5678e1,'shopId':_0x1c67af,'amount':_0xccac65,'currency':_0xa8cf07});}['logApiCall'](_0x12bc35,_0x39562d,_0x33b1dc,_0x1da7b1,_0x429f80){const _0x10c040=a48_0x275a2e;this[_0x10c040(0x145)](_0x10c040(0x131),{'type':_0x10c040(0x158),'endpoint':_0x12bc35,'method':_0x39562d,'userId':_0x33b1dc,'userRole':_0x1da7b1,'requestData':_0x429f80});}[a48_0x275a2e(0x12b)](){const _0x569c66=a48_0x275a2e;try{const _0x1a408f=fs_1['default'][_0x569c66(0x122)](this[_0x569c66(0x124)]),_0x2320a8=_0x1a408f[_0x569c66(0x14b)](_0x348b5c=>_0x348b5c[_0x569c66(0x163)](_0x569c66(0x138))),_0x181b64=[...new Set(_0x2320a8[_0x569c66(0x159)](_0x57805b=>_0x57805b[_0x569c66(0x132)]('_')[0x0]))],_0x2d9c26=_0x2320a8[_0x569c66(0x159)](_0x28eec4=>{const _0x38b9b8=_0x569c66,_0x1c5d45=path_1['default'][_0x38b9b8(0x114)](this['logsDir'],_0x28eec4),_0x2aa515=fs_1['default']['statSync'](_0x1c5d45),[_0x49d553,_0x9171f0]=_0x28eec4[_0x38b9b8(0x153)](_0x38b9b8(0x138),'')[_0x38b9b8(0x132)]('_');return{'type':_0x49d553,'date':_0x9171f0,'size':_0x2aa515['size']};})[_0x569c66(0x157)]((_0x46287c,_0x48586b)=>_0x48586b[_0x569c66(0x15a)]['localeCompare'](_0x46287c[_0x569c66(0x15a)]));return{'totalFiles':_0x2320a8[_0x569c66(0x13f)],'logTypes':_0x181b64,'latestLogs':_0x2d9c26[_0x569c66(0x115)](0x0,0xa)};}catch(_0x34ca6d){return console['error'](_0x569c66(0x11e),_0x34ca6d),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x275a2e(0x135)](_0x3c32b1=0x1e){const _0x2eff98=a48_0x275a2e;try{const _0x5e98ee=fs_1['default'][_0x2eff98(0x122)](this[_0x2eff98(0x124)]),_0x5b8cef=new Date();_0x5b8cef[_0x2eff98(0x14a)](_0x5b8cef[_0x2eff98(0x164)]()-_0x3c32b1);let _0x29944a=0x0;_0x5e98ee[_0x2eff98(0x12a)](_0x3eb880=>{const _0x3b12cd=_0x2eff98;if(!_0x3eb880['endsWith'](_0x3b12cd(0x138)))return;const _0x24d521=path_1[_0x3b12cd(0x12e)][_0x3b12cd(0x114)](this['logsDir'],_0x3eb880),_0x97f4ec=fs_1[_0x3b12cd(0x12e)][_0x3b12cd(0x116)](_0x24d521);_0x97f4ec['mtime']<_0x5b8cef&&(fs_1[_0x3b12cd(0x12e)][_0x3b12cd(0x14c)](_0x24d521),_0x29944a++,console['log'](_0x3b12cd(0x133)+_0x3eb880));}),console[_0x2eff98(0x129)]('🧹\x20Cleaned\x20'+_0x29944a+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x3c32b1+_0x2eff98(0x11b));}catch(_0x456d36){console[_0x2eff98(0x160)](_0x2eff98(0x161),_0x456d36);}}}exports[a48_0x275a2e(0x136)]=LoggerService,exports['loggerService']=new LoggerService();