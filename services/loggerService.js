'use strict';const a48_0x31c56e=a48_0x4456;(function(_0x69cf77,_0x17ccf0){const _0x2a5c28=a48_0x4456,_0x488516=_0x69cf77();while(!![]){try{const _0x33a1c7=-parseInt(_0x2a5c28(0x1b6))/0x1*(-parseInt(_0x2a5c28(0x1b1))/0x2)+-parseInt(_0x2a5c28(0x191))/0x3+parseInt(_0x2a5c28(0x17f))/0x4*(parseInt(_0x2a5c28(0x1c8))/0x5)+-parseInt(_0x2a5c28(0x1c6))/0x6*(parseInt(_0x2a5c28(0x1c0))/0x7)+-parseInt(_0x2a5c28(0x18f))/0x8*(-parseInt(_0x2a5c28(0x1ac))/0x9)+parseInt(_0x2a5c28(0x1ab))/0xa+-parseInt(_0x2a5c28(0x1cd))/0xb;if(_0x33a1c7===_0x17ccf0)break;else _0x488516['push'](_0x488516['shift']());}catch(_0x43b806){_0x488516['push'](_0x488516['shift']());}}}(a48_0x4c99,0xd0cbd));function a48_0x4456(_0x3782f8,_0x5e67bb){const _0x4c99b9=a48_0x4c99();return a48_0x4456=function(_0x44561c,_0x1c39a2){_0x44561c=_0x44561c-0x17e;let _0x31d1f3=_0x4c99b9[_0x44561c];return _0x31d1f3;},a48_0x4456(_0x3782f8,_0x5e67bb);}function a48_0x4c99(){const _0x36c9cc=['66cUXfRf','log','1655gSbdiE','toISOString','getLogStats','cwd','api_calls','30549728ajBnot','stringify','writeLog','PAYMENT_CREATED','17456qewGlP','Failed\x20to\x20get\x20log\x20stats:','logWhiteDomainError','length','appendFileSync','default','\x20log:','WEBHOOK_RECEIVED','ERROR','filter','endsWith','__importDefault','loggerService','utf8','setDate','__esModule','72tdQrnc','logWhiteDomainResponse','2046609IMqmGc','date','logApiCall','error','COINTOPAY_ERROR','statSync','logShopWebhookError','white_domain_requests','logs','SHOP_WEBHOOK_ERROR','defineProperty','map','.log','LoggerService','SHOP_WEBHOOK_SENT','WEBHOOK_ERROR','webhooks_received','Failed\x20to\x20write\x20','stack','ensureLogsDirectory','🗑️\x20Deleted\x20old\x20log\x20file:\x20','RESPONSE','getDate','logsDir','📁\x20Created\x20logs\x20directory:\x20','size','13846330KCOflg','1563759UuakbE','logWebhookProcessed','white_domain_responses','join','path','1100006XvoJLc','readdirSync','🧹\x20Cleaned\x20','cointopay_status_changes','message','1DYBMIP','COINTOPAY_STATUS_CHANGE','cointopay_errors','split','logPaymentCreated','localeCompare','logWebhookError','logCoinToPayStatus','REQUEST','replace','399763QtueDU','Failed\x20to\x20clean\x20old\x20logs:','\x20days)','webhooks_processed','getLogFileName','shop_webhooks_sent'];a48_0x4c99=function(){return _0x36c9cc;};return a48_0x4c99();}var __importDefault=this&&this[a48_0x31c56e(0x18a)]||function(_0xcc5c3f){const _0x3cbadc=a48_0x31c56e;return _0xcc5c3f&&_0xcc5c3f[_0x3cbadc(0x18e)]?_0xcc5c3f:{'default':_0xcc5c3f};};Object[a48_0x31c56e(0x19b)](exports,a48_0x31c56e(0x18e),{'value':!![]}),exports[a48_0x31c56e(0x18b)]=exports[a48_0x31c56e(0x19e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x31c56e(0x1b0)));class LoggerService{constructor(){const _0x30a6ac=a48_0x31c56e;this[_0x30a6ac(0x1a8)]=path_1[_0x30a6ac(0x184)]['join'](process[_0x30a6ac(0x1cb)](),_0x30a6ac(0x199)),this[_0x30a6ac(0x1a4)]();}[a48_0x31c56e(0x1a4)](){const _0x19ffe9=a48_0x31c56e;!fs_1[_0x19ffe9(0x184)]['existsSync'](this[_0x19ffe9(0x1a8)])&&(fs_1[_0x19ffe9(0x184)]['mkdirSync'](this[_0x19ffe9(0x1a8)],{'recursive':!![]}),console[_0x19ffe9(0x1c7)](_0x19ffe9(0x1a9)+this[_0x19ffe9(0x1a8)]));}[a48_0x31c56e(0x1c4)](_0x3c1dd0){const _0x2b9aa8=a48_0x31c56e,_0x23f11b=new Date()[_0x2b9aa8(0x1c9)]()[_0x2b9aa8(0x1b9)]('T')[0x0];return path_1[_0x2b9aa8(0x184)][_0x2b9aa8(0x1af)](this[_0x2b9aa8(0x1a8)],_0x3c1dd0+'_'+_0x23f11b+'.log');}[a48_0x31c56e(0x1cf)](_0x560e83,_0x1cd2d3){const _0x1538f2=a48_0x31c56e;try{const _0xe09055=new Date()['toISOString'](),_0x2b71d9={'timestamp':_0xe09055,..._0x1cd2d3},_0x42d426=JSON[_0x1538f2(0x1ce)](_0x2b71d9)+'\x0a',_0x7e27b6=this[_0x1538f2(0x1c4)](_0x560e83);fs_1['default'][_0x1538f2(0x183)](_0x7e27b6,_0x42d426,_0x1538f2(0x18c));}catch(_0x54c9f6){console[_0x1538f2(0x194)](_0x1538f2(0x1a2)+_0x560e83+_0x1538f2(0x185),_0x54c9f6);}}['logWhiteDomainRequest'](_0x2fffdd,_0x183ce2,_0x1b02b7,_0x485bfa){const _0x5b714c=a48_0x31c56e;this['writeLog'](_0x5b714c(0x198),{'type':_0x5b714c(0x1be),'gateway':_0x2fffdd,'endpoint':_0x183ce2,'method':_0x1b02b7,'data':_0x485bfa});}[a48_0x31c56e(0x190)](_0x44a421,_0x4478e2,_0x2ed66c,_0x844910,_0x1828da){const _0x48b09f=a48_0x31c56e;this['writeLog'](_0x48b09f(0x1ae),{'type':_0x48b09f(0x1a6),'gateway':_0x44a421,'endpoint':_0x4478e2,'status':_0x2ed66c,'responseTime':_0x1828da,'data':_0x844910});}[a48_0x31c56e(0x181)](_0x5df68e,_0x5236d9,_0x4a8cc9){const _0x1c043f=a48_0x31c56e;this['writeLog']('white_domain_errors',{'type':_0x1c043f(0x187),'gateway':_0x5df68e,'endpoint':_0x5236d9,'error':_0x4a8cc9 instanceof Error?{'message':_0x4a8cc9['message'],'stack':_0x4a8cc9[_0x1c043f(0x1a3)]}:_0x4a8cc9});}['logWebhookReceived'](_0x25d08a,_0x24fadb,_0x2253c7){const _0x2f0f0e=a48_0x31c56e;this[_0x2f0f0e(0x1cf)](_0x2f0f0e(0x1a1),{'type':_0x2f0f0e(0x186),'gateway':_0x25d08a,'headers':_0x2253c7,'data':_0x24fadb});}[a48_0x31c56e(0x1ad)](_0x278ff5,_0x3cbf78,_0x428aef,_0xf549c8,_0x44825a){const _0x3bd5d1=a48_0x31c56e;this[_0x3bd5d1(0x1cf)](_0x3bd5d1(0x1c3),{'type':'WEBHOOK_PROCESSED','gateway':_0x278ff5,'paymentId':_0x3cbf78,'oldStatus':_0x428aef,'newStatus':_0xf549c8,'originalData':_0x44825a});}[a48_0x31c56e(0x1bc)](_0x2101e7,_0x484df8,_0x2da5db){const _0x419bc9=a48_0x31c56e;this['writeLog']('webhooks_errors',{'type':_0x419bc9(0x1a0),'gateway':_0x2101e7,'error':_0x484df8 instanceof Error?{'message':_0x484df8[_0x419bc9(0x1b5)],'stack':_0x484df8[_0x419bc9(0x1a3)]}:_0x484df8,'originalData':_0x2da5db});}[a48_0x31c56e(0x1bd)](_0x52195f){const _0x4e3b9a=a48_0x31c56e;this['writeLog'](_0x4e3b9a(0x1b4),{'type':_0x4e3b9a(0x1b7),..._0x52195f});}['logCoinToPayError'](_0x50fe20){const _0x513df6=a48_0x31c56e;this['writeLog'](_0x513df6(0x1b8),{'type':_0x513df6(0x195),..._0x50fe20});}['logShopWebhookSent'](_0x5eb2b9,_0x3100fa,_0x53909a,_0x22fc12,_0x3671bf,_0x24c9a5){const _0x393b6f=a48_0x31c56e;this[_0x393b6f(0x1cf)](_0x393b6f(0x1c5),{'type':_0x393b6f(0x19f),'shopId':_0x5eb2b9,'webhookUrl':_0x3100fa,'event':_0x53909a,'status':_0x22fc12,'responseTime':_0x3671bf,'payload':_0x24c9a5});}[a48_0x31c56e(0x197)](_0x144c93,_0x5c23e9,_0x130ade,_0x4167c9,_0x2bf9e2){const _0x4b9200=a48_0x31c56e;this['writeLog']('shop_webhooks_errors',{'type':_0x4b9200(0x19a),'shopId':_0x144c93,'webhookUrl':_0x5c23e9,'event':_0x130ade,'error':_0x4167c9 instanceof Error?{'message':_0x4167c9[_0x4b9200(0x1b5)],'stack':_0x4167c9[_0x4b9200(0x1a3)]}:_0x4167c9,'payload':_0x2bf9e2});}[a48_0x31c56e(0x1ba)](_0xcb4868,_0x41bca3,_0x3bf6c6,_0x276cb9,_0x173f29){const _0x5e9331=a48_0x31c56e;this['writeLog']('payments_created',{'type':_0x5e9331(0x17e),'gateway':_0xcb4868,'paymentId':_0x41bca3,'shopId':_0x3bf6c6,'amount':_0x276cb9,'currency':_0x173f29});}[a48_0x31c56e(0x193)](_0x1dcbcd,_0x27c6e8,_0x18b0e1,_0x60edaa,_0xeb2509){const _0x2dc573=a48_0x31c56e;this[_0x2dc573(0x1cf)](_0x2dc573(0x1cc),{'type':'API_CALL','endpoint':_0x1dcbcd,'method':_0x27c6e8,'userId':_0x18b0e1,'userRole':_0x60edaa,'requestData':_0xeb2509});}[a48_0x31c56e(0x1ca)](){const _0x119a9a=a48_0x31c56e;try{const _0x3777fa=fs_1[_0x119a9a(0x184)][_0x119a9a(0x1b2)](this[_0x119a9a(0x1a8)]),_0x1e3114=_0x3777fa[_0x119a9a(0x188)](_0x485bcf=>_0x485bcf[_0x119a9a(0x189)](_0x119a9a(0x19d))),_0x12f1b4=[...new Set(_0x1e3114[_0x119a9a(0x19c)](_0x19f835=>_0x19f835[_0x119a9a(0x1b9)]('_')[0x0]))],_0xba0a6f=_0x1e3114['map'](_0x58cd05=>{const _0x462f97=_0x119a9a,_0x5d268c=path_1[_0x462f97(0x184)]['join'](this[_0x462f97(0x1a8)],_0x58cd05),_0x5218cb=fs_1[_0x462f97(0x184)][_0x462f97(0x196)](_0x5d268c),[_0x5d4d47,_0x2924aa]=_0x58cd05[_0x462f97(0x1bf)](_0x462f97(0x19d),'')[_0x462f97(0x1b9)]('_');return{'type':_0x5d4d47,'date':_0x2924aa,'size':_0x5218cb[_0x462f97(0x1aa)]};})['sort']((_0x58e5df,_0x1e822e)=>_0x1e822e[_0x119a9a(0x192)][_0x119a9a(0x1bb)](_0x58e5df['date']));return{'totalFiles':_0x1e3114[_0x119a9a(0x182)],'logTypes':_0x12f1b4,'latestLogs':_0xba0a6f['slice'](0x0,0xa)};}catch(_0x2be254){return console['error'](_0x119a9a(0x180),_0x2be254),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x279819=0x1e){const _0x4310fb=a48_0x31c56e;try{const _0x559577=fs_1[_0x4310fb(0x184)][_0x4310fb(0x1b2)](this[_0x4310fb(0x1a8)]),_0x445ae5=new Date();_0x445ae5[_0x4310fb(0x18d)](_0x445ae5[_0x4310fb(0x1a7)]()-_0x279819);let _0x5c7c5c=0x0;_0x559577['forEach'](_0x2702fd=>{const _0x14a470=_0x4310fb;if(!_0x2702fd[_0x14a470(0x189)](_0x14a470(0x19d)))return;const _0x9e09b3=path_1[_0x14a470(0x184)][_0x14a470(0x1af)](this['logsDir'],_0x2702fd),_0xdd9961=fs_1[_0x14a470(0x184)]['statSync'](_0x9e09b3);_0xdd9961['mtime']<_0x445ae5&&(fs_1[_0x14a470(0x184)]['unlinkSync'](_0x9e09b3),_0x5c7c5c++,console[_0x14a470(0x1c7)](_0x14a470(0x1a5)+_0x2702fd));}),console[_0x4310fb(0x1c7)](_0x4310fb(0x1b3)+_0x5c7c5c+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x279819+_0x4310fb(0x1c2));}catch(_0x17fece){console[_0x4310fb(0x194)](_0x4310fb(0x1c1),_0x17fece);}}}exports['LoggerService']=LoggerService,exports['loggerService']=new LoggerService();