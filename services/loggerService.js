'use strict';const a79_0x4d25b0=a79_0x2b69;function a79_0x2b69(_0x2a66ec,_0x977acb){_0x2a66ec=_0x2a66ec-0x1d7;const _0xd21b3e=a79_0xd21b();let _0x2b6918=_0xd21b3e[_0x2a66ec];return _0x2b6918;}(function(_0x2c25a3,_0xd2d839){const _0x25c983=a79_0x2b69,_0x1f9c85=_0x2c25a3();while(!![]){try{const _0x615c8a=-parseInt(_0x25c983(0x1d7))/0x1*(parseInt(_0x25c983(0x214))/0x2)+-parseInt(_0x25c983(0x206))/0x3+parseInt(_0x25c983(0x218))/0x4+parseInt(_0x25c983(0x221))/0x5*(-parseInt(_0x25c983(0x201))/0x6)+-parseInt(_0x25c983(0x1e4))/0x7+-parseInt(_0x25c983(0x20e))/0x8+parseInt(_0x25c983(0x1e3))/0x9;if(_0x615c8a===_0xd2d839)break;else _0x1f9c85['push'](_0x1f9c85['shift']());}catch(_0x42c4be){_0x1f9c85['push'](_0x1f9c85['shift']());}}}(a79_0xd21b,0x4367d));function a79_0xd21b(){const _0x2508d9=['cointopay_status_changes','toISOString','forEach','353435yLRmoB','statSync','logWebhookReceived','cleanOldLogs','3RygVML','filter','slice','__importDefault','\x20log:','LoggerService','PAYMENT_CREATED','logWhiteDomainResponse','log','length','SHOP_WEBHOOK_SENT','default','9260838bmnZEO','2593346KZNbCv','logShopWebhookError','API_CALL','size','split','logs','\x20days)','webhooks_received','message','path','SHOP_WEBHOOK_ERROR','setDate','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','logCoinToPayError','logsDir','payments_created','readdirSync','logPaymentCreated','endsWith','WEBHOOK_PROCESSED','.log','error','WEBHOOK_RECEIVED','utf8','date','loggerService','Failed\x20to\x20clean\x20old\x20logs:','ðŸ§¹\x20Cleaned\x20','white_domain_errors','6Dcmnlg','api_calls','Failed\x20to\x20write\x20','RESPONSE','writeLog','1031781DsLSXw','mkdirSync','logWhiteDomainRequest','getLogFileName','white_domain_responses','white_domain_requests','ensureLogsDirectory','join','2306072wvixzy','logWhiteDomainError','map','logApiCall','ERROR','logWebhookError','66882feVzCK','sort','REQUEST','COINTOPAY_STATUS_CHANGE','1683140bhLvjq','mtime','Failed\x20to\x20get\x20log\x20stats:','stack','getLogStats','webhooks_processed'];a79_0xd21b=function(){return _0x2508d9;};return a79_0xd21b();}var __importDefault=this&&this[a79_0x4d25b0(0x1da)]||function(_0x2c2916){return _0x2c2916&&_0x2c2916['__esModule']?_0x2c2916:{'default':_0x2c2916};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a79_0x4d25b0(0x1fd)]=exports[a79_0x4d25b0(0x1dc)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x4d25b0(0x1ed)));class LoggerService{constructor(){const _0x8a7f57=a79_0x4d25b0;this['logsDir']=path_1[_0x8a7f57(0x1e2)][_0x8a7f57(0x20d)](process['cwd'](),_0x8a7f57(0x1e9)),this[_0x8a7f57(0x20c)]();}[a79_0x4d25b0(0x20c)](){const _0xac5d94=a79_0x4d25b0;!fs_1[_0xac5d94(0x1e2)]['existsSync'](this[_0xac5d94(0x1f2)])&&(fs_1[_0xac5d94(0x1e2)][_0xac5d94(0x207)](this[_0xac5d94(0x1f2)],{'recursive':!![]}),console[_0xac5d94(0x1df)]('ðŸ“\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a79_0x4d25b0(0x209)](_0x31969a){const _0x13020e=a79_0x4d25b0,_0x17d8ad=new Date()['toISOString']()[_0x13020e(0x1e8)]('T')[0x0];return path_1['default'][_0x13020e(0x20d)](this[_0x13020e(0x1f2)],_0x31969a+'_'+_0x17d8ad+'.log');}['writeLog'](_0x3dc9f9,_0x2c471d){const _0xd44eb8=a79_0x4d25b0;try{const _0x5acae6=new Date()[_0xd44eb8(0x21f)](),_0x12dce0={'timestamp':_0x5acae6,..._0x2c471d},_0x367499=JSON['stringify'](_0x12dce0)+'\x0a',_0x5d2de9=this[_0xd44eb8(0x209)](_0x3dc9f9);fs_1[_0xd44eb8(0x1e2)]['appendFileSync'](_0x5d2de9,_0x367499,_0xd44eb8(0x1fb));}catch(_0x3e6bb7){console[_0xd44eb8(0x1f9)](_0xd44eb8(0x203)+_0x3dc9f9+_0xd44eb8(0x1db),_0x3e6bb7);}}[a79_0x4d25b0(0x208)](_0x35b9b7,_0x4abcde,_0x470eff,_0x22f61a){const _0x5a55f9=a79_0x4d25b0;this[_0x5a55f9(0x205)](_0x5a55f9(0x20b),{'type':_0x5a55f9(0x216),'gateway':_0x35b9b7,'endpoint':_0x4abcde,'method':_0x470eff,'data':_0x22f61a});}[a79_0x4d25b0(0x1de)](_0x3a465b,_0x37b761,_0x4373a3,_0x411e3e,_0x12602c){const _0x1143aa=a79_0x4d25b0;this['writeLog'](_0x1143aa(0x20a),{'type':_0x1143aa(0x204),'gateway':_0x3a465b,'endpoint':_0x37b761,'status':_0x4373a3,'responseTime':_0x12602c,'data':_0x411e3e});}[a79_0x4d25b0(0x20f)](_0xa12fda,_0x5d4440,_0xeeeaa4){const _0x1172cb=a79_0x4d25b0;this[_0x1172cb(0x205)](_0x1172cb(0x200),{'type':_0x1172cb(0x212),'gateway':_0xa12fda,'endpoint':_0x5d4440,'error':_0xeeeaa4 instanceof Error?{'message':_0xeeeaa4['message'],'stack':_0xeeeaa4[_0x1172cb(0x21b)]}:_0xeeeaa4});}[a79_0x4d25b0(0x223)](_0x3ec863,_0x481f69,_0x19a311){const _0x1e5465=a79_0x4d25b0;this[_0x1e5465(0x205)](_0x1e5465(0x1eb),{'type':_0x1e5465(0x1fa),'gateway':_0x3ec863,'headers':_0x19a311,'data':_0x481f69});}['logWebhookProcessed'](_0x1a8500,_0x9d7286,_0x1f1702,_0x54826b,_0x4afe64){const _0x122365=a79_0x4d25b0;this[_0x122365(0x205)](_0x122365(0x21d),{'type':_0x122365(0x1f7),'gateway':_0x1a8500,'paymentId':_0x9d7286,'oldStatus':_0x1f1702,'newStatus':_0x54826b,'originalData':_0x4afe64});}[a79_0x4d25b0(0x213)](_0x4d89b4,_0x304efa,_0x1f489c){const _0x3b1d23=a79_0x4d25b0;this[_0x3b1d23(0x205)]('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x4d89b4,'error':_0x304efa instanceof Error?{'message':_0x304efa[_0x3b1d23(0x1ec)],'stack':_0x304efa['stack']}:_0x304efa,'originalData':_0x1f489c});}['logCoinToPayStatus'](_0x37ea4d){const _0x432509=a79_0x4d25b0;this[_0x432509(0x205)](_0x432509(0x21e),{'type':_0x432509(0x217),..._0x37ea4d});}[a79_0x4d25b0(0x1f1)](_0x4ed3e7){const _0x35d9ac=a79_0x4d25b0;this[_0x35d9ac(0x205)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x4ed3e7});}['logShopWebhookSent'](_0x5c7150,_0x59c817,_0x4b38e0,_0x1d5afc,_0x45bc58,_0x36cfa2){const _0x1b1fa1=a79_0x4d25b0;this[_0x1b1fa1(0x205)]('shop_webhooks_sent',{'type':_0x1b1fa1(0x1e1),'shopId':_0x5c7150,'webhookUrl':_0x59c817,'event':_0x4b38e0,'status':_0x1d5afc,'responseTime':_0x45bc58,'payload':_0x36cfa2});}[a79_0x4d25b0(0x1e5)](_0x4c671a,_0x5fe092,_0x5e9de2,_0xb6e06b,_0x5d2373){const _0x9420a2=a79_0x4d25b0;this['writeLog']('shop_webhooks_errors',{'type':_0x9420a2(0x1ee),'shopId':_0x4c671a,'webhookUrl':_0x5fe092,'event':_0x5e9de2,'error':_0xb6e06b instanceof Error?{'message':_0xb6e06b['message'],'stack':_0xb6e06b[_0x9420a2(0x21b)]}:_0xb6e06b,'payload':_0x5d2373});}[a79_0x4d25b0(0x1f5)](_0x30b777,_0x2037e1,_0x1fa531,_0x4d7741,_0x319d8c){const _0x2ead20=a79_0x4d25b0;this[_0x2ead20(0x205)](_0x2ead20(0x1f3),{'type':_0x2ead20(0x1dd),'gateway':_0x30b777,'paymentId':_0x2037e1,'shopId':_0x1fa531,'amount':_0x4d7741,'currency':_0x319d8c});}[a79_0x4d25b0(0x211)](_0x5d1ee9,_0x32813b,_0x206b27,_0x20232b,_0x3ab5e8){const _0x42f68b=a79_0x4d25b0;this[_0x42f68b(0x205)](_0x42f68b(0x202),{'type':_0x42f68b(0x1e6),'endpoint':_0x5d1ee9,'method':_0x32813b,'userId':_0x206b27,'userRole':_0x20232b,'requestData':_0x3ab5e8});}[a79_0x4d25b0(0x21c)](){const _0x216979=a79_0x4d25b0;try{const _0x5e5846=fs_1[_0x216979(0x1e2)][_0x216979(0x1f4)](this[_0x216979(0x1f2)]),_0x1cfa5b=_0x5e5846[_0x216979(0x1d8)](_0x39b240=>_0x39b240[_0x216979(0x1f6)]('.log')),_0x4d09c1=[...new Set(_0x1cfa5b[_0x216979(0x210)](_0x2d9a0a=>_0x2d9a0a[_0x216979(0x1e8)]('_')[0x0]))],_0x12d5a3=_0x1cfa5b[_0x216979(0x210)](_0x3e9c01=>{const _0x5b0db3=_0x216979,_0x2f1098=path_1['default']['join'](this['logsDir'],_0x3e9c01),_0x5e8b92=fs_1['default'][_0x5b0db3(0x222)](_0x2f1098),[_0x17f3e1,_0x44d86e]=_0x3e9c01['replace'](_0x5b0db3(0x1f8),'')['split']('_');return{'type':_0x17f3e1,'date':_0x44d86e,'size':_0x5e8b92[_0x5b0db3(0x1e7)]};})[_0x216979(0x215)]((_0x34b6be,_0x17ce56)=>_0x17ce56[_0x216979(0x1fc)]['localeCompare'](_0x34b6be['date']));return{'totalFiles':_0x1cfa5b[_0x216979(0x1e0)],'logTypes':_0x4d09c1,'latestLogs':_0x12d5a3[_0x216979(0x1d9)](0x0,0xa)};}catch(_0x47b5cd){return console[_0x216979(0x1f9)](_0x216979(0x21a),_0x47b5cd),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a79_0x4d25b0(0x224)](_0x1d131b=0x1e){const _0x1e7cd7=a79_0x4d25b0;try{const _0x10b90a=fs_1[_0x1e7cd7(0x1e2)][_0x1e7cd7(0x1f4)](this['logsDir']),_0x3d1eda=new Date();_0x3d1eda[_0x1e7cd7(0x1ef)](_0x3d1eda['getDate']()-_0x1d131b);let _0x31effa=0x0;_0x10b90a[_0x1e7cd7(0x220)](_0x26ab38=>{const _0x17cec5=_0x1e7cd7;if(!_0x26ab38[_0x17cec5(0x1f6)](_0x17cec5(0x1f8)))return;const _0x44e279=path_1['default'][_0x17cec5(0x20d)](this[_0x17cec5(0x1f2)],_0x26ab38),_0x2f51cb=fs_1[_0x17cec5(0x1e2)][_0x17cec5(0x222)](_0x44e279);_0x2f51cb[_0x17cec5(0x219)]<_0x3d1eda&&(fs_1[_0x17cec5(0x1e2)]['unlinkSync'](_0x44e279),_0x31effa++,console[_0x17cec5(0x1df)](_0x17cec5(0x1f0)+_0x26ab38));}),console['log'](_0x1e7cd7(0x1ff)+_0x31effa+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x1d131b+_0x1e7cd7(0x1ea));}catch(_0x45f0f9){console[_0x1e7cd7(0x1f9)](_0x1e7cd7(0x1fe),_0x45f0f9);}}}exports['LoggerService']=LoggerService,exports[a79_0x4d25b0(0x1fd)]=new LoggerService();