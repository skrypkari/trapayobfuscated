'use strict';const a48_0x5924d7=a48_0x485f;(function(_0x80b79c,_0x3efa26){const _0x3df4ef=a48_0x485f,_0x5b582e=_0x80b79c();while(!![]){try{const _0x919cd1=-parseInt(_0x3df4ef(0x95))/0x1*(-parseInt(_0x3df4ef(0x92))/0x2)+-parseInt(_0x3df4ef(0xad))/0x3+-parseInt(_0x3df4ef(0xaa))/0x4+parseInt(_0x3df4ef(0x94))/0x5+-parseInt(_0x3df4ef(0x6f))/0x6+-parseInt(_0x3df4ef(0x80))/0x7+parseInt(_0x3df4ef(0xaf))/0x8*(parseInt(_0x3df4ef(0xa1))/0x9);if(_0x919cd1===_0x3efa26)break;else _0x5b582e['push'](_0x5b582e['shift']());}catch(_0x2c8c9c){_0x5b582e['push'](_0x5b582e['shift']());}}}(a48_0x4d13,0x5da05));var __importDefault=this&&this[a48_0x5924d7(0x9f)]||function(_0x263c35){const _0x170f33=a48_0x5924d7;return _0x263c35&&_0x263c35[_0x170f33(0x8a)]?_0x263c35:{'default':_0x263c35};};function a48_0x485f(_0x32dd5c,_0xdfa33c){const _0x4d13fd=a48_0x4d13();return a48_0x485f=function(_0x485f49,_0x5ec2ee){_0x485f49=_0x485f49-0x6b;let _0x150e18=_0x4d13fd[_0x485f49];return _0x150e18;},a48_0x485f(_0x32dd5c,_0xdfa33c);}Object[a48_0x5924d7(0x98)](exports,a48_0x5924d7(0x8a),{'value':!![]}),exports[a48_0x5924d7(0xa7)]=exports[a48_0x5924d7(0xa2)]=void 0x0;function a48_0x4d13(){const _0x376b8b=['__importDefault','utf8','9mBpoKh','LoggerService','appendFileSync','.log','WEBHOOK_PROCESSED','shop_webhooks_sent','loggerService','logCoinToPayError','date','2687028fWIToQ','size','logShopWebhookError','1558890xPvmJe','logApiCall','18826504TVrcyu','cleanOldLogs','payments_created','\x20old\x20log\x20files\x20(older\x20than\x20','stringify','join','logWhiteDomainError','forEach','ensureLogsDirectory','SHOP_WEBHOOK_ERROR','WEBHOOK_RECEIVED','4190892dJNZLQ','unlinkSync','map','writeLog','stack','message','toISOString','default','length','filter','white_domain_errors','localeCompare','slice','logShopWebhookSent','cointopay_errors','logWebhookError','Failed\x20to\x20clean\x20old\x20logs:','2173332QklfnP','log','API_CALL','white_domain_requests','logsDir','logWebhookReceived','cointopay_status_changes','readdirSync','🧹\x20Cleaned\x20','RESPONSE','__esModule','logPaymentCreated','🗑️\x20Deleted\x20old\x20log\x20file:\x20','logCoinToPayStatus','shop_webhooks_errors','mkdirSync','Failed\x20to\x20write\x20','path','244qFbAij','logs','727455lWfJlm','697CwjSAE','logWhiteDomainRequest','ERROR','defineProperty','\x20days)','split','getLogFileName','error','COINTOPAY_STATUS_CHANGE','logWhiteDomainResponse'];a48_0x4d13=function(){return _0x376b8b;};return a48_0x4d13();}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x5924d7(0x91)));class LoggerService{constructor(){const _0x138d9b=a48_0x5924d7;this[_0x138d9b(0x84)]=path_1['default']['join'](process['cwd'](),_0x138d9b(0x93)),this[_0x138d9b(0x6c)]();}['ensureLogsDirectory'](){const _0x35aa75=a48_0x5924d7;!fs_1[_0x35aa75(0x76)]['existsSync'](this[_0x35aa75(0x84)])&&(fs_1[_0x35aa75(0x76)][_0x35aa75(0x8f)](this[_0x35aa75(0x84)],{'recursive':!![]}),console[_0x35aa75(0x81)]('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a48_0x5924d7(0x9b)](_0x1edb88){const _0x1d1331=a48_0x5924d7,_0x396085=new Date()[_0x1d1331(0x75)]()[_0x1d1331(0x9a)]('T')[0x0];return path_1['default'][_0x1d1331(0xb4)](this['logsDir'],_0x1edb88+'_'+_0x396085+_0x1d1331(0xa4));}[a48_0x5924d7(0x72)](_0x28c60a,_0x130b52){const _0x389f77=a48_0x5924d7;try{const _0x23527d=new Date()[_0x389f77(0x75)](),_0x10316a={'timestamp':_0x23527d,..._0x130b52},_0x309385=JSON[_0x389f77(0xb3)](_0x10316a)+'\x0a',_0x31f958=this['getLogFileName'](_0x28c60a);fs_1[_0x389f77(0x76)][_0x389f77(0xa3)](_0x31f958,_0x309385,_0x389f77(0xa0));}catch(_0x1d8192){console['error'](_0x389f77(0x90)+_0x28c60a+'\x20log:',_0x1d8192);}}[a48_0x5924d7(0x96)](_0x44da7b,_0x432709,_0x5d3d42,_0x5a0f5d){const _0x3887f4=a48_0x5924d7;this[_0x3887f4(0x72)](_0x3887f4(0x83),{'type':'REQUEST','gateway':_0x44da7b,'endpoint':_0x432709,'method':_0x5d3d42,'data':_0x5a0f5d});}[a48_0x5924d7(0x9e)](_0x2158d6,_0x4cea9b,_0x20fb78,_0x255a32,_0x129e82){const _0x1c1a2d=a48_0x5924d7;this['writeLog']('white_domain_responses',{'type':_0x1c1a2d(0x89),'gateway':_0x2158d6,'endpoint':_0x4cea9b,'status':_0x20fb78,'responseTime':_0x129e82,'data':_0x255a32});}[a48_0x5924d7(0xb5)](_0x32c406,_0x453984,_0x9cee6f){const _0x284abe=a48_0x5924d7;this[_0x284abe(0x72)](_0x284abe(0x79),{'type':_0x284abe(0x97),'gateway':_0x32c406,'endpoint':_0x453984,'error':_0x9cee6f instanceof Error?{'message':_0x9cee6f[_0x284abe(0x74)],'stack':_0x9cee6f[_0x284abe(0x73)]}:_0x9cee6f});}[a48_0x5924d7(0x85)](_0x49e221,_0x173d2c,_0x374c48){const _0x42572e=a48_0x5924d7;this[_0x42572e(0x72)]('webhooks_received',{'type':_0x42572e(0x6e),'gateway':_0x49e221,'headers':_0x374c48,'data':_0x173d2c});}['logWebhookProcessed'](_0x189b9e,_0x30f3f9,_0x52a943,_0x41b42f,_0x4b9b8c){const _0xeacfb3=a48_0x5924d7;this[_0xeacfb3(0x72)]('webhooks_processed',{'type':_0xeacfb3(0xa5),'gateway':_0x189b9e,'paymentId':_0x30f3f9,'oldStatus':_0x52a943,'newStatus':_0x41b42f,'originalData':_0x4b9b8c});}[a48_0x5924d7(0x7e)](_0x4504f9,_0x452b43,_0x30f99b){const _0x2225d6=a48_0x5924d7;this[_0x2225d6(0x72)]('webhooks_errors',{'type':'WEBHOOK_ERROR','gateway':_0x4504f9,'error':_0x452b43 instanceof Error?{'message':_0x452b43[_0x2225d6(0x74)],'stack':_0x452b43['stack']}:_0x452b43,'originalData':_0x30f99b});}[a48_0x5924d7(0x8d)](_0x2479bb){const _0x331970=a48_0x5924d7;this[_0x331970(0x72)](_0x331970(0x86),{'type':_0x331970(0x9d),..._0x2479bb});}[a48_0x5924d7(0xa8)](_0x1c8d16){const _0xd15245=a48_0x5924d7;this[_0xd15245(0x72)](_0xd15245(0x7d),{'type':'COINTOPAY_ERROR',..._0x1c8d16});}[a48_0x5924d7(0x7c)](_0x4ff789,_0x292455,_0x3fa159,_0x17b360,_0x1b07ee,_0x4f02ea){const _0x369d9d=a48_0x5924d7;this[_0x369d9d(0x72)](_0x369d9d(0xa6),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x4ff789,'webhookUrl':_0x292455,'event':_0x3fa159,'status':_0x17b360,'responseTime':_0x1b07ee,'payload':_0x4f02ea});}[a48_0x5924d7(0xac)](_0x2982d5,_0x3576c6,_0x33fc74,_0x33bd90,_0x186864){const _0x3ea438=a48_0x5924d7;this['writeLog'](_0x3ea438(0x8e),{'type':_0x3ea438(0x6d),'shopId':_0x2982d5,'webhookUrl':_0x3576c6,'event':_0x33fc74,'error':_0x33bd90 instanceof Error?{'message':_0x33bd90['message'],'stack':_0x33bd90[_0x3ea438(0x73)]}:_0x33bd90,'payload':_0x186864});}[a48_0x5924d7(0x8b)](_0x50fb5d,_0x1da4b7,_0x36bcc7,_0x3bc04f,_0x265204){const _0x2c80ba=a48_0x5924d7;this[_0x2c80ba(0x72)](_0x2c80ba(0xb1),{'type':'PAYMENT_CREATED','gateway':_0x50fb5d,'paymentId':_0x1da4b7,'shopId':_0x36bcc7,'amount':_0x3bc04f,'currency':_0x265204});}[a48_0x5924d7(0xae)](_0x381b31,_0x33723d,_0x14f12d,_0x2ad08e,_0x4e0ab5){const _0x388847=a48_0x5924d7;this[_0x388847(0x72)]('api_calls',{'type':_0x388847(0x82),'endpoint':_0x381b31,'method':_0x33723d,'userId':_0x14f12d,'userRole':_0x2ad08e,'requestData':_0x4e0ab5});}['getLogStats'](){const _0x51554d=a48_0x5924d7;try{const _0x501927=fs_1[_0x51554d(0x76)][_0x51554d(0x87)](this[_0x51554d(0x84)]),_0x2ced31=_0x501927[_0x51554d(0x78)](_0x4a5fb9=>_0x4a5fb9['endsWith']('.log')),_0xb63541=[...new Set(_0x2ced31[_0x51554d(0x71)](_0x2cea36=>_0x2cea36[_0x51554d(0x9a)]('_')[0x0]))],_0x40a5cd=_0x2ced31[_0x51554d(0x71)](_0x589d8f=>{const _0x233654=_0x51554d,_0xb6e78d=path_1[_0x233654(0x76)][_0x233654(0xb4)](this[_0x233654(0x84)],_0x589d8f),_0x41cf90=fs_1[_0x233654(0x76)]['statSync'](_0xb6e78d),[_0x4926c1,_0x14c5e3]=_0x589d8f['replace'](_0x233654(0xa4),'')[_0x233654(0x9a)]('_');return{'type':_0x4926c1,'date':_0x14c5e3,'size':_0x41cf90[_0x233654(0xab)]};})['sort']((_0x840d60,_0xd2f84f)=>_0xd2f84f[_0x51554d(0xa9)][_0x51554d(0x7a)](_0x840d60[_0x51554d(0xa9)]));return{'totalFiles':_0x2ced31[_0x51554d(0x77)],'logTypes':_0xb63541,'latestLogs':_0x40a5cd[_0x51554d(0x7b)](0x0,0xa)};}catch(_0x40ea74){return console[_0x51554d(0x9c)]('Failed\x20to\x20get\x20log\x20stats:',_0x40ea74),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x5924d7(0xb0)](_0x11498c=0x1e){const _0x130923=a48_0x5924d7;try{const _0x13b586=fs_1[_0x130923(0x76)]['readdirSync'](this[_0x130923(0x84)]),_0x4e25a2=new Date();_0x4e25a2['setDate'](_0x4e25a2['getDate']()-_0x11498c);let _0x1581bf=0x0;_0x13b586[_0x130923(0x6b)](_0x3ee07d=>{const _0x29fc19=_0x130923;if(!_0x3ee07d['endsWith'](_0x29fc19(0xa4)))return;const _0x4fca43=path_1['default']['join'](this[_0x29fc19(0x84)],_0x3ee07d),_0x2af78f=fs_1[_0x29fc19(0x76)]['statSync'](_0x4fca43);_0x2af78f['mtime']<_0x4e25a2&&(fs_1[_0x29fc19(0x76)][_0x29fc19(0x70)](_0x4fca43),_0x1581bf++,console[_0x29fc19(0x81)](_0x29fc19(0x8c)+_0x3ee07d));}),console[_0x130923(0x81)](_0x130923(0x88)+_0x1581bf+_0x130923(0xb2)+_0x11498c+_0x130923(0x99));}catch(_0xd55505){console[_0x130923(0x9c)](_0x130923(0x7f),_0xd55505);}}}exports[a48_0x5924d7(0xa2)]=LoggerService,exports[a48_0x5924d7(0xa7)]=new LoggerService();