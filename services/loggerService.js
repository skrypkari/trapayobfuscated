'use strict';const a53_0x5479a4=a53_0x1e4c;function a53_0x1e4c(_0x57e2f5,_0x43b30b){const _0xcd3e7=a53_0xcd3e();return a53_0x1e4c=function(_0x1e4c81,_0x35080d){_0x1e4c81=_0x1e4c81-0x13c;let _0x3873f9=_0xcd3e7[_0x1e4c81];return _0x3873f9;},a53_0x1e4c(_0x57e2f5,_0x43b30b);}(function(_0x3e0dfe,_0x11e973){const _0x361fca=a53_0x1e4c,_0x3176e5=_0x3e0dfe();while(!![]){try{const _0x547a73=-parseInt(_0x361fca(0x164))/0x1+parseInt(_0x361fca(0x16e))/0x2+parseInt(_0x361fca(0x188))/0x3*(parseInt(_0x361fca(0x17d))/0x4)+-parseInt(_0x361fca(0x17b))/0x5+parseInt(_0x361fca(0x184))/0x6*(parseInt(_0x361fca(0x181))/0x7)+parseInt(_0x361fca(0x176))/0x8+-parseInt(_0x361fca(0x141))/0x9;if(_0x547a73===_0x11e973)break;else _0x3176e5['push'](_0x3176e5['shift']());}catch(_0x2eff5b){_0x3176e5['push'](_0x3176e5['shift']());}}}(a53_0xcd3e,0xdcc0b));var __importDefault=this&&this['__importDefault']||function(_0x4c241a){const _0x48935f=a53_0x1e4c;return _0x4c241a&&_0x4c241a[_0x48935f(0x15c)]?_0x4c241a:{'default':_0x4c241a};};Object[a53_0x5479a4(0x15d)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a53_0x5479a4(0x14b)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x5479a4(0x18b)));class LoggerService{constructor(){const _0x5622fa=a53_0x5479a4;this[_0x5622fa(0x14c)]=path_1[_0x5622fa(0x187)][_0x5622fa(0x168)](process[_0x5622fa(0x144)](),'logs'),this[_0x5622fa(0x14d)]();}[a53_0x5479a4(0x14d)](){const _0x7debf6=a53_0x5479a4;!fs_1[_0x7debf6(0x187)][_0x7debf6(0x16d)](this[_0x7debf6(0x14c)])&&(fs_1[_0x7debf6(0x187)][_0x7debf6(0x182)](this[_0x7debf6(0x14c)],{'recursive':!![]}),console[_0x7debf6(0x151)](_0x7debf6(0x185)+this['logsDir']));}[a53_0x5479a4(0x16f)](_0x2fba21){const _0x3d49b0=a53_0x5479a4,_0x48c7b4=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x3d49b0(0x187)]['join'](this[_0x3d49b0(0x14c)],_0x2fba21+'_'+_0x48c7b4+_0x3d49b0(0x145));}[a53_0x5479a4(0x13f)](_0x84d5d7,_0x48f0cb){const _0x390956=a53_0x5479a4;try{const _0x5839bc=new Date()[_0x390956(0x183)](),_0x1ab1c9={'timestamp':_0x5839bc,..._0x48f0cb},_0x1a042c=JSON['stringify'](_0x1ab1c9)+'\x0a',_0x30dff6=this[_0x390956(0x16f)](_0x84d5d7);fs_1['default'][_0x390956(0x17a)](_0x30dff6,_0x1a042c,'utf8');}catch(_0x5b894e){console[_0x390956(0x157)]('Failed\x20to\x20write\x20'+_0x84d5d7+_0x390956(0x142),_0x5b894e);}}['logWhiteDomainRequest'](_0x35f178,_0x55b85e,_0x3ab280,_0x4e4c39){const _0xffde3=a53_0x5479a4;this[_0xffde3(0x13f)](_0xffde3(0x178),{'type':'REQUEST','gateway':_0x35f178,'endpoint':_0x55b85e,'method':_0x3ab280,'data':_0x4e4c39});}['logWhiteDomainResponse'](_0x4a9d11,_0x3201e1,_0x31e700,_0x36e8a5,_0xb801c){const _0x86ea2c=a53_0x5479a4;this['writeLog'](_0x86ea2c(0x153),{'type':_0x86ea2c(0x172),'gateway':_0x4a9d11,'endpoint':_0x3201e1,'status':_0x31e700,'responseTime':_0xb801c,'data':_0x36e8a5});}[a53_0x5479a4(0x160)](_0x2df9f8,_0x2a43ab,_0x3434ae){const _0x3432b6=a53_0x5479a4;this['writeLog']('white_domain_errors',{'type':_0x3432b6(0x180),'gateway':_0x2df9f8,'endpoint':_0x2a43ab,'error':_0x3434ae instanceof Error?{'message':_0x3434ae[_0x3432b6(0x174)],'stack':_0x3434ae[_0x3432b6(0x17e)]}:_0x3434ae});}[a53_0x5479a4(0x16b)](_0x14ac67,_0xdf65e2,_0x2fd4db){const _0x344b61=a53_0x5479a4;this['writeLog'](_0x344b61(0x152),{'type':_0x344b61(0x16a),'gateway':_0x14ac67,'headers':_0x2fd4db,'data':_0xdf65e2});}['logWebhookProcessed'](_0x4d5aeb,_0x5465fa,_0xe23157,_0xaa9a6e,_0x24c7fe){const _0x4f4697=a53_0x5479a4;this[_0x4f4697(0x13f)](_0x4f4697(0x17f),{'type':_0x4f4697(0x170),'gateway':_0x4d5aeb,'paymentId':_0x5465fa,'oldStatus':_0xe23157,'newStatus':_0xaa9a6e,'originalData':_0x24c7fe});}[a53_0x5479a4(0x143)](_0x531048,_0x1adf6d,_0x14b54b){const _0x2c0cab=a53_0x5479a4;this[_0x2c0cab(0x13f)]('webhooks_errors',{'type':_0x2c0cab(0x169),'gateway':_0x531048,'error':_0x1adf6d instanceof Error?{'message':_0x1adf6d[_0x2c0cab(0x174)],'stack':_0x1adf6d[_0x2c0cab(0x17e)]}:_0x1adf6d,'originalData':_0x14b54b});}[a53_0x5479a4(0x15a)](_0x591cde){const _0x23b319=a53_0x5479a4;this[_0x23b319(0x13f)](_0x23b319(0x16c),{'type':'COINTOPAY_STATUS_CHANGE',..._0x591cde});}[a53_0x5479a4(0x163)](_0xdbe6c1){const _0x50aadb=a53_0x5479a4;this[_0x50aadb(0x13f)](_0x50aadb(0x155),{'type':'COINTOPAY_ERROR',..._0xdbe6c1});}[a53_0x5479a4(0x150)](_0x52ac3b,_0x535964,_0x539cb1,_0x60f469,_0x1ef9eb,_0x4246d9){const _0x258a3a=a53_0x5479a4;this['writeLog'](_0x258a3a(0x14f),{'type':_0x258a3a(0x147),'shopId':_0x52ac3b,'webhookUrl':_0x535964,'event':_0x539cb1,'status':_0x60f469,'responseTime':_0x1ef9eb,'payload':_0x4246d9});}[a53_0x5479a4(0x18c)](_0x4c848a,_0x3e7307,_0x215548,_0x388371,_0x28e711){const _0x3413a5=a53_0x5479a4;this[_0x3413a5(0x13f)]('shop_webhooks_errors',{'type':_0x3413a5(0x14a),'shopId':_0x4c848a,'webhookUrl':_0x3e7307,'event':_0x215548,'error':_0x388371 instanceof Error?{'message':_0x388371[_0x3413a5(0x174)],'stack':_0x388371['stack']}:_0x388371,'payload':_0x28e711});}[a53_0x5479a4(0x13c)](_0x131a83,_0x4890b1,_0x55c027,_0x4bb214,_0x4df7f2){const _0x23366b=a53_0x5479a4;this[_0x23366b(0x13f)](_0x23366b(0x167),{'type':_0x23366b(0x14e),'gateway':_0x131a83,'paymentId':_0x4890b1,'shopId':_0x55c027,'amount':_0x4bb214,'currency':_0x4df7f2});}['logApiCall'](_0x582ae1,_0x3c787a,_0x43e05f,_0xcfe5f9,_0x3f83c6){const _0x5723ad=a53_0x5479a4;this[_0x5723ad(0x13f)](_0x5723ad(0x15e),{'type':_0x5723ad(0x179),'endpoint':_0x582ae1,'method':_0x3c787a,'userId':_0x43e05f,'userRole':_0xcfe5f9,'requestData':_0x3f83c6});}['getLogStats'](){const _0x1c3c92=a53_0x5479a4;try{const _0x140dad=fs_1['default'][_0x1c3c92(0x154)](this['logsDir']),_0x3e8c27=_0x140dad[_0x1c3c92(0x146)](_0x30b087=>_0x30b087[_0x1c3c92(0x161)]('.log')),_0x5104a5=[...new Set(_0x3e8c27[_0x1c3c92(0x13e)](_0x44f648=>_0x44f648[_0x1c3c92(0x166)]('_')[0x0]))],_0x1a0bfb=_0x3e8c27[_0x1c3c92(0x13e)](_0x477ef6=>{const _0x71767a=_0x1c3c92,_0x19402a=path_1[_0x71767a(0x187)][_0x71767a(0x168)](this[_0x71767a(0x14c)],_0x477ef6),_0xbb22ea=fs_1[_0x71767a(0x187)][_0x71767a(0x15b)](_0x19402a),[_0x477721,_0x9aaa3f]=_0x477ef6[_0x71767a(0x13d)](_0x71767a(0x145),'')[_0x71767a(0x166)]('_');return{'type':_0x477721,'date':_0x9aaa3f,'size':_0xbb22ea[_0x71767a(0x140)]};})[_0x1c3c92(0x18a)]((_0x4706af,_0x15ffa3)=>_0x15ffa3[_0x1c3c92(0x15f)][_0x1c3c92(0x17c)](_0x4706af['date']));return{'totalFiles':_0x3e8c27['length'],'logTypes':_0x5104a5,'latestLogs':_0x1a0bfb[_0x1c3c92(0x171)](0x0,0xa)};}catch(_0x3359ee){return console[_0x1c3c92(0x157)](_0x1c3c92(0x149),_0x3359ee),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x5479a4(0x165)](_0x17c607=0x1e){const _0x1abf78=a53_0x5479a4;try{const _0x1c29f8=fs_1['default'][_0x1abf78(0x154)](this[_0x1abf78(0x14c)]),_0xd4d259=new Date();_0xd4d259['setDate'](_0xd4d259[_0x1abf78(0x156)]()-_0x17c607);let _0x43c8c1=0x0;_0x1c29f8[_0x1abf78(0x159)](_0x564d94=>{const _0x333e29=_0x1abf78;if(!_0x564d94[_0x333e29(0x161)]('.log'))return;const _0x342617=path_1[_0x333e29(0x187)][_0x333e29(0x168)](this[_0x333e29(0x14c)],_0x564d94),_0x5f5087=fs_1['default'][_0x333e29(0x15b)](_0x342617);_0x5f5087[_0x333e29(0x175)]<_0xd4d259&&(fs_1[_0x333e29(0x187)][_0x333e29(0x158)](_0x342617),_0x43c8c1++,console[_0x333e29(0x151)](_0x333e29(0x186)+_0x564d94));}),console[_0x1abf78(0x151)](_0x1abf78(0x148)+_0x43c8c1+_0x1abf78(0x177)+_0x17c607+_0x1abf78(0x162));}catch(_0x54b854){console[_0x1abf78(0x157)](_0x1abf78(0x189),_0x54b854);}}}function a53_0xcd3e(){const _0x1403cc=['loggerService','message','mtime','10472232XddwbH','\x20old\x20log\x20files\x20(older\x20than\x20','white_domain_requests','API_CALL','appendFileSync','8761910qZxFYF','localeCompare','8ohQPhs','stack','webhooks_processed','ERROR','1919540kukVKK','mkdirSync','toISOString','30zcgMFH','📁\x20Created\x20logs\x20directory:\x20','🗑️\x20Deleted\x20old\x20log\x20file:\x20','default','2045829juMqex','Failed\x20to\x20clean\x20old\x20logs:','sort','path','logShopWebhookError','logPaymentCreated','replace','map','writeLog','size','9669114KzdffE','\x20log:','logWebhookError','cwd','.log','filter','SHOP_WEBHOOK_SENT','🧹\x20Cleaned\x20','Failed\x20to\x20get\x20log\x20stats:','SHOP_WEBHOOK_ERROR','LoggerService','logsDir','ensureLogsDirectory','PAYMENT_CREATED','shop_webhooks_sent','logShopWebhookSent','log','webhooks_received','white_domain_responses','readdirSync','cointopay_errors','getDate','error','unlinkSync','forEach','logCoinToPayStatus','statSync','__esModule','defineProperty','api_calls','date','logWhiteDomainError','endsWith','\x20days)','logCoinToPayError','1692902nJXGqg','cleanOldLogs','split','payments_created','join','WEBHOOK_ERROR','WEBHOOK_RECEIVED','logWebhookReceived','cointopay_status_changes','existsSync','2759636yzTtIx','getLogFileName','WEBHOOK_PROCESSED','slice','RESPONSE'];a53_0xcd3e=function(){return _0x1403cc;};return a53_0xcd3e();}exports['LoggerService']=LoggerService,exports[a53_0x5479a4(0x173)]=new LoggerService();