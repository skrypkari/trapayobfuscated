'use strict';const a67_0x40ba2e=a67_0x1458;function a67_0x50ac(){const _0x1a9a25=['.log','readdirSync','join','mkdirSync','REQUEST','cwd','error','1580690bMiqBY','slice','SHOP_WEBHOOK_ERROR','logApiCall','log','logShopWebhookError','\x20log:','\x20days)','SHOP_WEBHOOK_SENT','size','ERROR','split','path','statSync','RESPONSE','endsWith','sort','ğŸ§¹\x20Cleaned\x20','logs','Failed\x20to\x20write\x20','cointopay_status_changes','LoggerService','toISOString','date','unlinkSync','Failed\x20to\x20get\x20log\x20stats:','6TlCvzF','1321440mboTVE','cleanOldLogs','default','581967ThtKJQ','logPaymentCreated','localeCompare','logWebhookProcessed','cointopay_errors','WEBHOOK_PROCESSED','8JzvlPd','stringify','defineProperty','webhooks_errors','477754itANRZ','1036588RVwYok','PAYMENT_CREATED','map','stack','utf8','110ryBjko','logCoinToPayError','filter','payments_created','getDate','white_domain_errors','shop_webhooks_errors','white_domain_responses','logWebhookReceived','4455545oIIAYt','__esModule','message','7326837YhQqQZ','12OMWdJz','logsDir','logCoinToPayStatus','forEach','WEBHOOK_ERROR','ğŸ“\x20Created\x20logs\x20directory:\x20','logWhiteDomainResponse','writeLog','logWebhookError','webhooks_processed','white_domain_requests','getLogFileName','getLogStats','loggerService','ensureLogsDirectory','replace'];a67_0x50ac=function(){return _0x1a9a25;};return a67_0x50ac();}(function(_0x5e9b7e,_0x273418){const _0x42d96b=a67_0x1458,_0x5c821c=_0x5e9b7e();while(!![]){try{const _0x54d11e=-parseInt(_0x42d96b(0x16f))/0x1+parseInt(_0x42d96b(0x16e))/0x2*(parseInt(_0x42d96b(0x181))/0x3)+parseInt(_0x42d96b(0x161))/0x4+-parseInt(_0x42d96b(0x17d))/0x5*(-parseInt(_0x42d96b(0x160))/0x6)+parseInt(_0x42d96b(0x180))/0x7+parseInt(_0x42d96b(0x16a))/0x8*(-parseInt(_0x42d96b(0x164))/0x9)+parseInt(_0x42d96b(0x146))/0xa*(-parseInt(_0x42d96b(0x174))/0xb);if(_0x54d11e===_0x273418)break;else _0x5c821c['push'](_0x5c821c['shift']());}catch(_0x3c1b70){_0x5c821c['push'](_0x5c821c['shift']());}}}(a67_0x50ac,0x8441f));var __importDefault=this&&this['__importDefault']||function(_0x2854a5){const _0x5c4cfa=a67_0x1458;return _0x2854a5&&_0x2854a5[_0x5c4cfa(0x17e)]?_0x2854a5:{'default':_0x2854a5};};Object[a67_0x40ba2e(0x16c)](exports,a67_0x40ba2e(0x17e),{'value':!![]}),exports[a67_0x40ba2e(0x13c)]=exports[a67_0x40ba2e(0x15b)]=void 0x0;function a67_0x1458(_0x2f1d46,_0x28a649){_0x2f1d46=_0x2f1d46-0x138;const _0x50aca8=a67_0x50ac();let _0x1458fb=_0x50aca8[_0x2f1d46];return _0x1458fb;}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a67_0x40ba2e(0x152)));class LoggerService{constructor(){const _0x4d8dc1=a67_0x40ba2e;this[_0x4d8dc1(0x182)]=path_1[_0x4d8dc1(0x163)]['join'](process[_0x4d8dc1(0x144)](),_0x4d8dc1(0x158)),this[_0x4d8dc1(0x13d)]();}[a67_0x40ba2e(0x13d)](){const _0x9e2414=a67_0x40ba2e;!fs_1[_0x9e2414(0x163)]['existsSync'](this[_0x9e2414(0x182)])&&(fs_1[_0x9e2414(0x163)][_0x9e2414(0x142)](this[_0x9e2414(0x182)],{'recursive':!![]}),console[_0x9e2414(0x14a)](_0x9e2414(0x186)+this[_0x9e2414(0x182)]));}[a67_0x40ba2e(0x13a)](_0x2ade46){const _0x293630=a67_0x40ba2e,_0x1b46e0=new Date()['toISOString']()[_0x293630(0x151)]('T')[0x0];return path_1[_0x293630(0x163)]['join'](this[_0x293630(0x182)],_0x2ade46+'_'+_0x1b46e0+_0x293630(0x13f));}[a67_0x40ba2e(0x188)](_0x46ee1a,_0x5b7e62){const _0x3f061c=a67_0x40ba2e;try{const _0x7591ad=new Date()[_0x3f061c(0x15c)](),_0x78132a={'timestamp':_0x7591ad,..._0x5b7e62},_0x5a2be2=JSON[_0x3f061c(0x16b)](_0x78132a)+'\x0a',_0x2ce477=this[_0x3f061c(0x13a)](_0x46ee1a);fs_1['default']['appendFileSync'](_0x2ce477,_0x5a2be2,_0x3f061c(0x173));}catch(_0x56da72){console[_0x3f061c(0x145)](_0x3f061c(0x159)+_0x46ee1a+_0x3f061c(0x14c),_0x56da72);}}['logWhiteDomainRequest'](_0x49c473,_0x5376fc,_0x460bec,_0x10a0dc){const _0xb75ab7=a67_0x40ba2e;this[_0xb75ab7(0x188)](_0xb75ab7(0x139),{'type':_0xb75ab7(0x143),'gateway':_0x49c473,'endpoint':_0x5376fc,'method':_0x460bec,'data':_0x10a0dc});}[a67_0x40ba2e(0x187)](_0x4fea22,_0x29082d,_0x4965de,_0x230362,_0x9140ac){const _0x14d63e=a67_0x40ba2e;this[_0x14d63e(0x188)](_0x14d63e(0x17b),{'type':_0x14d63e(0x154),'gateway':_0x4fea22,'endpoint':_0x29082d,'status':_0x4965de,'responseTime':_0x9140ac,'data':_0x230362});}['logWhiteDomainError'](_0x403792,_0x212aca,_0x406dcc){const _0x526928=a67_0x40ba2e;this['writeLog'](_0x526928(0x179),{'type':_0x526928(0x150),'gateway':_0x403792,'endpoint':_0x212aca,'error':_0x406dcc instanceof Error?{'message':_0x406dcc[_0x526928(0x17f)],'stack':_0x406dcc['stack']}:_0x406dcc});}[a67_0x40ba2e(0x17c)](_0x2ba46f,_0x2e8d25,_0x4dfdd9){this['writeLog']('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x2ba46f,'headers':_0x4dfdd9,'data':_0x2e8d25});}[a67_0x40ba2e(0x167)](_0x22c9d2,_0x44b790,_0x31f80d,_0x52cacd,_0x25f9f7){const _0x9d2d1b=a67_0x40ba2e;this[_0x9d2d1b(0x188)](_0x9d2d1b(0x138),{'type':_0x9d2d1b(0x169),'gateway':_0x22c9d2,'paymentId':_0x44b790,'oldStatus':_0x31f80d,'newStatus':_0x52cacd,'originalData':_0x25f9f7});}[a67_0x40ba2e(0x189)](_0x5d6ee8,_0x17d075,_0x23e95f){const _0x415a6b=a67_0x40ba2e;this[_0x415a6b(0x188)](_0x415a6b(0x16d),{'type':_0x415a6b(0x185),'gateway':_0x5d6ee8,'error':_0x17d075 instanceof Error?{'message':_0x17d075[_0x415a6b(0x17f)],'stack':_0x17d075[_0x415a6b(0x172)]}:_0x17d075,'originalData':_0x23e95f});}[a67_0x40ba2e(0x183)](_0x2c9b33){const _0x3011b3=a67_0x40ba2e;this['writeLog'](_0x3011b3(0x15a),{'type':'COINTOPAY_STATUS_CHANGE',..._0x2c9b33});}[a67_0x40ba2e(0x175)](_0x1d3c28){const _0x4d02b5=a67_0x40ba2e;this[_0x4d02b5(0x188)](_0x4d02b5(0x168),{'type':'COINTOPAY_ERROR',..._0x1d3c28});}['logShopWebhookSent'](_0x5b8eb1,_0x187cf5,_0x4c267f,_0x336357,_0x5950d9,_0x24c920){const _0x2ff478=a67_0x40ba2e;this['writeLog']('shop_webhooks_sent',{'type':_0x2ff478(0x14e),'shopId':_0x5b8eb1,'webhookUrl':_0x187cf5,'event':_0x4c267f,'status':_0x336357,'responseTime':_0x5950d9,'payload':_0x24c920});}[a67_0x40ba2e(0x14b)](_0x196155,_0x1505d3,_0x46759b,_0x4da76e,_0x16c0a6){const _0x56776a=a67_0x40ba2e;this[_0x56776a(0x188)](_0x56776a(0x17a),{'type':_0x56776a(0x148),'shopId':_0x196155,'webhookUrl':_0x1505d3,'event':_0x46759b,'error':_0x4da76e instanceof Error?{'message':_0x4da76e[_0x56776a(0x17f)],'stack':_0x4da76e[_0x56776a(0x172)]}:_0x4da76e,'payload':_0x16c0a6});}[a67_0x40ba2e(0x165)](_0x316185,_0x3771cf,_0x355cf3,_0x44af48,_0x532872){const _0x1c7562=a67_0x40ba2e;this['writeLog'](_0x1c7562(0x177),{'type':_0x1c7562(0x170),'gateway':_0x316185,'paymentId':_0x3771cf,'shopId':_0x355cf3,'amount':_0x44af48,'currency':_0x532872});}[a67_0x40ba2e(0x149)](_0x46f7d0,_0x46e446,_0x1dc736,_0x222b7f,_0x3f63a7){const _0x37f8df=a67_0x40ba2e;this[_0x37f8df(0x188)]('api_calls',{'type':'API_CALL','endpoint':_0x46f7d0,'method':_0x46e446,'userId':_0x1dc736,'userRole':_0x222b7f,'requestData':_0x3f63a7});}[a67_0x40ba2e(0x13b)](){const _0x493363=a67_0x40ba2e;try{const _0x2f7441=fs_1[_0x493363(0x163)]['readdirSync'](this[_0x493363(0x182)]),_0x52f6cb=_0x2f7441[_0x493363(0x176)](_0x2f9c39=>_0x2f9c39[_0x493363(0x155)](_0x493363(0x13f))),_0x26f819=[...new Set(_0x52f6cb[_0x493363(0x171)](_0x857f8a=>_0x857f8a['split']('_')[0x0]))],_0x844cd8=_0x52f6cb[_0x493363(0x171)](_0x354534=>{const _0x41b02e=_0x493363,_0x1edac9=path_1[_0x41b02e(0x163)]['join'](this[_0x41b02e(0x182)],_0x354534),_0x57e8a8=fs_1['default'][_0x41b02e(0x153)](_0x1edac9),[_0x5eddac,_0xf10528]=_0x354534[_0x41b02e(0x13e)](_0x41b02e(0x13f),'')[_0x41b02e(0x151)]('_');return{'type':_0x5eddac,'date':_0xf10528,'size':_0x57e8a8[_0x41b02e(0x14f)]};})[_0x493363(0x156)]((_0x3b6efa,_0x4811e1)=>_0x4811e1[_0x493363(0x15d)][_0x493363(0x166)](_0x3b6efa[_0x493363(0x15d)]));return{'totalFiles':_0x52f6cb['length'],'logTypes':_0x26f819,'latestLogs':_0x844cd8[_0x493363(0x147)](0x0,0xa)};}catch(_0xe4ea04){return console[_0x493363(0x145)](_0x493363(0x15f),_0xe4ea04),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a67_0x40ba2e(0x162)](_0xa13971=0x1e){const _0xc9efea=a67_0x40ba2e;try{const _0x5423e7=fs_1[_0xc9efea(0x163)][_0xc9efea(0x140)](this[_0xc9efea(0x182)]),_0x5d9692=new Date();_0x5d9692['setDate'](_0x5d9692[_0xc9efea(0x178)]()-_0xa13971);let _0x496be0=0x0;_0x5423e7[_0xc9efea(0x184)](_0x3f1d9c=>{const _0x9933a7=_0xc9efea;if(!_0x3f1d9c[_0x9933a7(0x155)](_0x9933a7(0x13f)))return;const _0x1434d0=path_1['default'][_0x9933a7(0x141)](this[_0x9933a7(0x182)],_0x3f1d9c),_0x300f25=fs_1['default'][_0x9933a7(0x153)](_0x1434d0);_0x300f25['mtime']<_0x5d9692&&(fs_1[_0x9933a7(0x163)][_0x9933a7(0x15e)](_0x1434d0),_0x496be0++,console[_0x9933a7(0x14a)]('ğŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x3f1d9c));}),console[_0xc9efea(0x14a)](_0xc9efea(0x157)+_0x496be0+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0xa13971+_0xc9efea(0x14d));}catch(_0x1cd8c3){console[_0xc9efea(0x145)]('Failed\x20to\x20clean\x20old\x20logs:',_0x1cd8c3);}}}exports['LoggerService']=LoggerService,exports[a67_0x40ba2e(0x13c)]=new LoggerService();