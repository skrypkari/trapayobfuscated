'use strict';function a79_0x55f5(_0x17de3f,_0x4d15bc){_0x17de3f=_0x17de3f-0x156;const _0x440ecd=a79_0x440e();let _0x55f5eb=_0x440ecd[_0x17de3f];return _0x55f5eb;}const a79_0x2af27b=a79_0x55f5;(function(_0x1e4efe,_0x3547b5){const _0x43eb26=a79_0x55f5,_0x14003d=_0x1e4efe();while(!![]){try{const _0x5b7472=-parseInt(_0x43eb26(0x193))/0x1+parseInt(_0x43eb26(0x189))/0x2*(parseInt(_0x43eb26(0x19c))/0x3)+-parseInt(_0x43eb26(0x195))/0x4+parseInt(_0x43eb26(0x184))/0x5+parseInt(_0x43eb26(0x18b))/0x6+parseInt(_0x43eb26(0x18c))/0x7+-parseInt(_0x43eb26(0x164))/0x8;if(_0x5b7472===_0x3547b5)break;else _0x14003d['push'](_0x14003d['shift']());}catch(_0x5d0e1a){_0x14003d['push'](_0x14003d['shift']());}}}(a79_0x440e,0xc0d08));function a79_0x440e(){const _0xad46f6=['logs','cwd','getLogFileName','.log','getDate','getLogStats','logWebhookProcessed','webhooks_errors','slice','logWhiteDomainResponse','logCoinToPayStatus','replace','logWhiteDomainError','COINTOPAY_ERROR','shop_webhooks_errors','white_domain_responses','map','mkdirSync','845840pyXvkE','logCoinToPayError','Failed\x20to\x20write\x20','SHOP_WEBHOOK_SENT','WEBHOOK_PROCESSED','2ZMvaoO','forEach','5926854eOlIGn','10309376eWXNaj','utf8','endsWith','writeLog','readdirSync','Failed\x20to\x20get\x20log\x20stats:','\x20old\x20log\x20files\x20(older\x20than\x20','1465267oQRyPY','existsSync','470672ISHzcT','split','stack','LoggerService','ERROR','white_domain_requests','error','2342595MWNgER','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','cointopay_errors','stringify','ðŸ§¹\x20Cleaned\x20','PAYMENT_CREATED','path','default','webhooks_received','RESPONSE','join','logsDir','sort','__importDefault','loggerService','logWebhookReceived','logShopWebhookSent','mtime','toISOString','payments_created','appendFileSync','ensureLogsDirectory','8303256vWXcff','log','message','date','unlinkSync','logPaymentCreated','logWebhookError','setDate','logWhiteDomainRequest','WEBHOOK_ERROR','size','filter','__esModule','REQUEST'];a79_0x440e=function(){return _0xad46f6;};return a79_0x440e();}var __importDefault=this&&this[a79_0x2af27b(0x15b)]||function(_0x44558f){return _0x44558f&&_0x44558f['__esModule']?_0x44558f:{'default':_0x44558f};};Object['defineProperty'](exports,a79_0x2af27b(0x170),{'value':!![]}),exports['loggerService']=exports[a79_0x2af27b(0x198)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x2af27b(0x1a2)));class LoggerService{constructor(){const _0x214da7=a79_0x2af27b;this[_0x214da7(0x159)]=path_1[_0x214da7(0x1a3)]['join'](process[_0x214da7(0x173)](),_0x214da7(0x172)),this[_0x214da7(0x163)]();}[a79_0x2af27b(0x163)](){const _0xd1745e=a79_0x2af27b;!fs_1['default'][_0xd1745e(0x194)](this[_0xd1745e(0x159)])&&(fs_1[_0xd1745e(0x1a3)][_0xd1745e(0x183)](this[_0xd1745e(0x159)],{'recursive':!![]}),console[_0xd1745e(0x165)]('ðŸ“\x20Created\x20logs\x20directory:\x20'+this[_0xd1745e(0x159)]));}[a79_0x2af27b(0x174)](_0x4f638b){const _0xa7c0f1=a79_0x2af27b,_0x48c503=new Date()[_0xa7c0f1(0x160)]()[_0xa7c0f1(0x196)]('T')[0x0];return path_1[_0xa7c0f1(0x1a3)][_0xa7c0f1(0x158)](this[_0xa7c0f1(0x159)],_0x4f638b+'_'+_0x48c503+_0xa7c0f1(0x175));}[a79_0x2af27b(0x18f)](_0x394c11,_0x3ad664){const _0x1f0d49=a79_0x2af27b;try{const _0x3ae330=new Date()[_0x1f0d49(0x160)](),_0x337da7={'timestamp':_0x3ae330,..._0x3ad664},_0x42fe1d=JSON[_0x1f0d49(0x19f)](_0x337da7)+'\x0a',_0xa530bb=this['getLogFileName'](_0x394c11);fs_1['default'][_0x1f0d49(0x162)](_0xa530bb,_0x42fe1d,_0x1f0d49(0x18d));}catch(_0x100e56){console[_0x1f0d49(0x19b)](_0x1f0d49(0x186)+_0x394c11+'\x20log:',_0x100e56);}}[a79_0x2af27b(0x16c)](_0x2f35d0,_0x46c381,_0x1d71af,_0x4158fd){const _0x24a07a=a79_0x2af27b;this[_0x24a07a(0x18f)](_0x24a07a(0x19a),{'type':_0x24a07a(0x171),'gateway':_0x2f35d0,'endpoint':_0x46c381,'method':_0x1d71af,'data':_0x4158fd});}[a79_0x2af27b(0x17b)](_0x442087,_0x4fe36f,_0x3bb9eb,_0x5b9e93,_0x355697){const _0x36b808=a79_0x2af27b;this[_0x36b808(0x18f)](_0x36b808(0x181),{'type':_0x36b808(0x157),'gateway':_0x442087,'endpoint':_0x4fe36f,'status':_0x3bb9eb,'responseTime':_0x355697,'data':_0x5b9e93});}[a79_0x2af27b(0x17e)](_0x1ac27e,_0x296b6e,_0x478767){const _0x35d83d=a79_0x2af27b;this[_0x35d83d(0x18f)]('white_domain_errors',{'type':_0x35d83d(0x199),'gateway':_0x1ac27e,'endpoint':_0x296b6e,'error':_0x478767 instanceof Error?{'message':_0x478767[_0x35d83d(0x166)],'stack':_0x478767[_0x35d83d(0x197)]}:_0x478767});}[a79_0x2af27b(0x15d)](_0x5761e7,_0x554dff,_0x16375e){const _0x5c95e5=a79_0x2af27b;this['writeLog'](_0x5c95e5(0x156),{'type':'WEBHOOK_RECEIVED','gateway':_0x5761e7,'headers':_0x16375e,'data':_0x554dff});}[a79_0x2af27b(0x178)](_0x3fa2a2,_0x5210c8,_0x505eb5,_0x2f14c3,_0xfdef36){const _0x272783=a79_0x2af27b;this['writeLog']('webhooks_processed',{'type':_0x272783(0x188),'gateway':_0x3fa2a2,'paymentId':_0x5210c8,'oldStatus':_0x505eb5,'newStatus':_0x2f14c3,'originalData':_0xfdef36});}[a79_0x2af27b(0x16a)](_0x42443f,_0xcfb6b1,_0x123e95){const _0x5e21ff=a79_0x2af27b;this[_0x5e21ff(0x18f)](_0x5e21ff(0x179),{'type':_0x5e21ff(0x16d),'gateway':_0x42443f,'error':_0xcfb6b1 instanceof Error?{'message':_0xcfb6b1[_0x5e21ff(0x166)],'stack':_0xcfb6b1[_0x5e21ff(0x197)]}:_0xcfb6b1,'originalData':_0x123e95});}[a79_0x2af27b(0x17c)](_0x46b3ff){const _0x141f63=a79_0x2af27b;this[_0x141f63(0x18f)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x46b3ff});}[a79_0x2af27b(0x185)](_0x247b6e){const _0x2ea817=a79_0x2af27b;this[_0x2ea817(0x18f)](_0x2ea817(0x19e),{'type':_0x2ea817(0x17f),..._0x247b6e});}[a79_0x2af27b(0x15e)](_0x1de888,_0x266bd4,_0x503b1a,_0x4ab52f,_0x250f88,_0x5e8488){const _0x2be1d8=a79_0x2af27b;this[_0x2be1d8(0x18f)]('shop_webhooks_sent',{'type':_0x2be1d8(0x187),'shopId':_0x1de888,'webhookUrl':_0x266bd4,'event':_0x503b1a,'status':_0x4ab52f,'responseTime':_0x250f88,'payload':_0x5e8488});}['logShopWebhookError'](_0x63a6db,_0x2e46dc,_0x202bbf,_0x591507,_0xbe68f4){const _0x5308c5=a79_0x2af27b;this[_0x5308c5(0x18f)](_0x5308c5(0x180),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x63a6db,'webhookUrl':_0x2e46dc,'event':_0x202bbf,'error':_0x591507 instanceof Error?{'message':_0x591507[_0x5308c5(0x166)],'stack':_0x591507[_0x5308c5(0x197)]}:_0x591507,'payload':_0xbe68f4});}[a79_0x2af27b(0x169)](_0x3414d4,_0x459d05,_0x43e3c2,_0x322647,_0xf64b80){const _0x24430b=a79_0x2af27b;this[_0x24430b(0x18f)](_0x24430b(0x161),{'type':_0x24430b(0x1a1),'gateway':_0x3414d4,'paymentId':_0x459d05,'shopId':_0x43e3c2,'amount':_0x322647,'currency':_0xf64b80});}['logApiCall'](_0x1c8915,_0x2793ea,_0x14e112,_0x1369dc,_0x3912ce){this['writeLog']('api_calls',{'type':'API_CALL','endpoint':_0x1c8915,'method':_0x2793ea,'userId':_0x14e112,'userRole':_0x1369dc,'requestData':_0x3912ce});}[a79_0x2af27b(0x177)](){const _0x580710=a79_0x2af27b;try{const _0x59f356=fs_1['default'][_0x580710(0x190)](this[_0x580710(0x159)]),_0x4c27ec=_0x59f356[_0x580710(0x16f)](_0x3437d4=>_0x3437d4[_0x580710(0x18e)](_0x580710(0x175))),_0x2fc658=[...new Set(_0x4c27ec['map'](_0x28bfa4=>_0x28bfa4[_0x580710(0x196)]('_')[0x0]))],_0x20a112=_0x4c27ec[_0x580710(0x182)](_0xb0538a=>{const _0x27d95a=_0x580710,_0x541009=path_1[_0x27d95a(0x1a3)][_0x27d95a(0x158)](this[_0x27d95a(0x159)],_0xb0538a),_0x45704a=fs_1[_0x27d95a(0x1a3)]['statSync'](_0x541009),[_0x1667cf,_0x5c12d4]=_0xb0538a[_0x27d95a(0x17d)](_0x27d95a(0x175),'')[_0x27d95a(0x196)]('_');return{'type':_0x1667cf,'date':_0x5c12d4,'size':_0x45704a[_0x27d95a(0x16e)]};})[_0x580710(0x15a)]((_0x35ed74,_0x27626c)=>_0x27626c[_0x580710(0x167)]['localeCompare'](_0x35ed74[_0x580710(0x167)]));return{'totalFiles':_0x4c27ec['length'],'logTypes':_0x2fc658,'latestLogs':_0x20a112[_0x580710(0x17a)](0x0,0xa)};}catch(_0x38ef54){return console[_0x580710(0x19b)](_0x580710(0x191),_0x38ef54),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x2dc250=0x1e){const _0x200fc=a79_0x2af27b;try{const _0x540665=fs_1[_0x200fc(0x1a3)]['readdirSync'](this[_0x200fc(0x159)]),_0x4a5cf2=new Date();_0x4a5cf2[_0x200fc(0x16b)](_0x4a5cf2[_0x200fc(0x176)]()-_0x2dc250);let _0x1cda2d=0x0;_0x540665[_0x200fc(0x18a)](_0x12b79a=>{const _0xdcdedc=_0x200fc;if(!_0x12b79a[_0xdcdedc(0x18e)]('.log'))return;const _0x3d85da=path_1[_0xdcdedc(0x1a3)][_0xdcdedc(0x158)](this[_0xdcdedc(0x159)],_0x12b79a),_0x3a081e=fs_1[_0xdcdedc(0x1a3)]['statSync'](_0x3d85da);_0x3a081e[_0xdcdedc(0x15f)]<_0x4a5cf2&&(fs_1[_0xdcdedc(0x1a3)][_0xdcdedc(0x168)](_0x3d85da),_0x1cda2d++,console[_0xdcdedc(0x165)](_0xdcdedc(0x19d)+_0x12b79a));}),console[_0x200fc(0x165)](_0x200fc(0x1a0)+_0x1cda2d+_0x200fc(0x192)+_0x2dc250+'\x20days)');}catch(_0x37a1b4){console[_0x200fc(0x19b)]('Failed\x20to\x20clean\x20old\x20logs:',_0x37a1b4);}}}exports[a79_0x2af27b(0x198)]=LoggerService,exports[a79_0x2af27b(0x15c)]=new LoggerService();