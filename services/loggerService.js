'use strict';const a59_0x2604be=a59_0x3f2c;function a59_0x658a(){const _0x14d559=['1077486sWNuBG','map','mkdirSync','1tgSxtu','cointopay_errors','stringify','logShopWebhookError','1629404BxEqyL','logWhiteDomainRequest','existsSync','path','toISOString','logShopWebhookSent','WEBHOOK_ERROR','message','ensureLogsDirectory','webhooks_processed','unlinkSync','readdirSync','SHOP_WEBHOOK_SENT','loggerService','localeCompare','appendFileSync','8028765wwfIgL','290yCCiHd','7OWJhlU','154428bTmPNY','\x20log:','52lSBecZ','.log','\x20days)','logCoinToPayStatus','error','forEach','mtime','endsWith','split','shop_webhooks_sent','api_calls','SHOP_WEBHOOK_ERROR','419749kQGIGl','join','logWhiteDomainResponse','length','logWebhookReceived','cwd','cleanOldLogs','log','🧹\x20Cleaned\x20','PAYMENT_CREATED','webhooks_received','COINTOPAY_ERROR','📁\x20Created\x20logs\x20directory:\x20','5985928ooigVG','RESPONSE','shop_webhooks_errors','defineProperty','3bGJIXS','1791732MHAQAn','setDate','logCoinToPayError','logWebhookProcessed','logWhiteDomainError','logWebhookError','logsDir','default','replace','logs','10stjnPI','__importDefault','COINTOPAY_STATUS_CHANGE','white_domain_requests','filter','payments_created','white_domain_errors','writeLog','Failed\x20to\x20clean\x20old\x20logs:','getLogStats','__esModule','getLogFileName','statSync','ERROR','sort','WEBHOOK_RECEIVED','\x20old\x20log\x20files\x20(older\x20than\x20','date','stack'];a59_0x658a=function(){return _0x14d559;};return a59_0x658a();}(function(_0x2e99f2,_0x24c4ef){const _0x4657fa=a59_0x3f2c,_0x45193e=_0x2e99f2();while(!![]){try{const _0x563d88=parseInt(_0x4657fa(0x236))/0x1*(parseInt(_0x4657fa(0x23a))/0x2)+-parseInt(_0x4657fa(0x215))/0x3*(parseInt(_0x4657fa(0x216))/0x4)+parseInt(_0x4657fa(0x220))/0x5*(-parseInt(_0x4657fa(0x233))/0x6)+parseInt(_0x4657fa(0x1f5))/0x7*(parseInt(_0x4657fa(0x211))/0x8)+parseInt(_0x4657fa(0x1f3))/0x9+parseInt(_0x4657fa(0x1f4))/0xa*(-parseInt(_0x4657fa(0x204))/0xb)+parseInt(_0x4657fa(0x1f6))/0xc*(parseInt(_0x4657fa(0x1f8))/0xd);if(_0x563d88===_0x24c4ef)break;else _0x45193e['push'](_0x45193e['shift']());}catch(_0x2cb73b){_0x45193e['push'](_0x45193e['shift']());}}}(a59_0x658a,0x90b9e));function a59_0x3f2c(_0x57e873,_0x59aed9){const _0x658ae6=a59_0x658a();return a59_0x3f2c=function(_0x3f2ce9,_0x2ccb6e){_0x3f2ce9=_0x3f2ce9-0x1eb;let _0x35492f=_0x658ae6[_0x3f2ce9];return _0x35492f;},a59_0x3f2c(_0x57e873,_0x59aed9);}var __importDefault=this&&this[a59_0x2604be(0x221)]||function(_0x476d1d){return _0x476d1d&&_0x476d1d['__esModule']?_0x476d1d:{'default':_0x476d1d};};Object[a59_0x2604be(0x214)](exports,a59_0x2604be(0x22a),{'value':!![]}),exports['loggerService']=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a59_0x2604be(0x23d)));class LoggerService{constructor(){const _0x23f9bc=a59_0x2604be;this[_0x23f9bc(0x21c)]=path_1[_0x23f9bc(0x21d)]['join'](process[_0x23f9bc(0x209)](),_0x23f9bc(0x21f)),this[_0x23f9bc(0x1eb)]();}[a59_0x2604be(0x1eb)](){const _0x2d797d=a59_0x2604be;!fs_1[_0x2d797d(0x21d)][_0x2d797d(0x23c)](this[_0x2d797d(0x21c)])&&(fs_1[_0x2d797d(0x21d)][_0x2d797d(0x235)](this[_0x2d797d(0x21c)],{'recursive':!![]}),console['log'](_0x2d797d(0x210)+this['logsDir']));}[a59_0x2604be(0x22b)](_0x45496b){const _0x319dcc=a59_0x2604be,_0x32f7ca=new Date()['toISOString']()[_0x319dcc(0x200)]('T')[0x0];return path_1[_0x319dcc(0x21d)][_0x319dcc(0x205)](this['logsDir'],_0x45496b+'_'+_0x32f7ca+'.log');}[a59_0x2604be(0x227)](_0x229133,_0x51bf1d){const _0x5adcee=a59_0x2604be;try{const _0xdba023=new Date()[_0x5adcee(0x23e)](),_0x805700={'timestamp':_0xdba023,..._0x51bf1d},_0x132db2=JSON[_0x5adcee(0x238)](_0x805700)+'\x0a',_0x2d115d=this[_0x5adcee(0x22b)](_0x229133);fs_1[_0x5adcee(0x21d)][_0x5adcee(0x1f2)](_0x2d115d,_0x132db2,'utf8');}catch(_0x500bc4){console[_0x5adcee(0x1fc)]('Failed\x20to\x20write\x20'+_0x229133+_0x5adcee(0x1f7),_0x500bc4);}}[a59_0x2604be(0x23b)](_0x37c8c8,_0x1ab19a,_0x35785a,_0x37834f){const _0x1dcdc4=a59_0x2604be;this[_0x1dcdc4(0x227)](_0x1dcdc4(0x223),{'type':'REQUEST','gateway':_0x37c8c8,'endpoint':_0x1ab19a,'method':_0x35785a,'data':_0x37834f});}[a59_0x2604be(0x206)](_0x58e860,_0x2114bf,_0x14d779,_0x247711,_0x389638){const _0x5e4e93=a59_0x2604be;this[_0x5e4e93(0x227)]('white_domain_responses',{'type':_0x5e4e93(0x212),'gateway':_0x58e860,'endpoint':_0x2114bf,'status':_0x14d779,'responseTime':_0x389638,'data':_0x247711});}[a59_0x2604be(0x21a)](_0x1ffc97,_0x2c99d3,_0x12bb9c){const _0x4094cd=a59_0x2604be;this[_0x4094cd(0x227)](_0x4094cd(0x226),{'type':_0x4094cd(0x22d),'gateway':_0x1ffc97,'endpoint':_0x2c99d3,'error':_0x12bb9c instanceof Error?{'message':_0x12bb9c[_0x4094cd(0x241)],'stack':_0x12bb9c[_0x4094cd(0x232)]}:_0x12bb9c});}[a59_0x2604be(0x208)](_0x3643b8,_0x567b68,_0x2ec253){const _0x39dd21=a59_0x2604be;this[_0x39dd21(0x227)](_0x39dd21(0x20e),{'type':_0x39dd21(0x22f),'gateway':_0x3643b8,'headers':_0x2ec253,'data':_0x567b68});}[a59_0x2604be(0x219)](_0x405baf,_0x5ef6bb,_0x2e4d7d,_0x5d817c,_0x39a9f5){const _0x4819db=a59_0x2604be;this[_0x4819db(0x227)](_0x4819db(0x1ec),{'type':'WEBHOOK_PROCESSED','gateway':_0x405baf,'paymentId':_0x5ef6bb,'oldStatus':_0x2e4d7d,'newStatus':_0x5d817c,'originalData':_0x39a9f5});}[a59_0x2604be(0x21b)](_0x11ff54,_0x2aa18e,_0x53f038){const _0x4898e3=a59_0x2604be;this[_0x4898e3(0x227)]('webhooks_errors',{'type':_0x4898e3(0x240),'gateway':_0x11ff54,'error':_0x2aa18e instanceof Error?{'message':_0x2aa18e[_0x4898e3(0x241)],'stack':_0x2aa18e[_0x4898e3(0x232)]}:_0x2aa18e,'originalData':_0x53f038});}[a59_0x2604be(0x1fb)](_0x220c3c){const _0x1bdad9=a59_0x2604be;this['writeLog']('cointopay_status_changes',{'type':_0x1bdad9(0x222),..._0x220c3c});}[a59_0x2604be(0x218)](_0x1717a2){const _0x5d1f24=a59_0x2604be;this['writeLog'](_0x5d1f24(0x237),{'type':_0x5d1f24(0x20f),..._0x1717a2});}[a59_0x2604be(0x23f)](_0x171d2b,_0x1242cf,_0x44ec77,_0x9d8f26,_0x3f0b8c,_0x25d18c){const _0x3cb830=a59_0x2604be;this['writeLog'](_0x3cb830(0x201),{'type':_0x3cb830(0x1ef),'shopId':_0x171d2b,'webhookUrl':_0x1242cf,'event':_0x44ec77,'status':_0x9d8f26,'responseTime':_0x3f0b8c,'payload':_0x25d18c});}[a59_0x2604be(0x239)](_0x1b73e4,_0x57cf25,_0x48ccdb,_0x283007,_0x4f4912){const _0x26b25f=a59_0x2604be;this[_0x26b25f(0x227)](_0x26b25f(0x213),{'type':_0x26b25f(0x203),'shopId':_0x1b73e4,'webhookUrl':_0x57cf25,'event':_0x48ccdb,'error':_0x283007 instanceof Error?{'message':_0x283007['message'],'stack':_0x283007[_0x26b25f(0x232)]}:_0x283007,'payload':_0x4f4912});}['logPaymentCreated'](_0x1e23c0,_0x540cc5,_0x410dad,_0x184019,_0x2fe3a7){const _0x466185=a59_0x2604be;this['writeLog'](_0x466185(0x225),{'type':_0x466185(0x20d),'gateway':_0x1e23c0,'paymentId':_0x540cc5,'shopId':_0x410dad,'amount':_0x184019,'currency':_0x2fe3a7});}['logApiCall'](_0x2c3b98,_0x5f2a84,_0x5a27ae,_0x1c443f,_0x302e3c){const _0x5d3d93=a59_0x2604be;this['writeLog'](_0x5d3d93(0x202),{'type':'API_CALL','endpoint':_0x2c3b98,'method':_0x5f2a84,'userId':_0x5a27ae,'userRole':_0x1c443f,'requestData':_0x302e3c});}[a59_0x2604be(0x229)](){const _0x1bc705=a59_0x2604be;try{const _0x36d917=fs_1['default'][_0x1bc705(0x1ee)](this[_0x1bc705(0x21c)]),_0x3ac264=_0x36d917[_0x1bc705(0x224)](_0x12979c=>_0x12979c[_0x1bc705(0x1ff)](_0x1bc705(0x1f9))),_0x2d67c3=[...new Set(_0x3ac264[_0x1bc705(0x234)](_0xfc2a20=>_0xfc2a20[_0x1bc705(0x200)]('_')[0x0]))],_0x354016=_0x3ac264[_0x1bc705(0x234)](_0x21829c=>{const _0x225d0b=_0x1bc705,_0xad1bf3=path_1['default'][_0x225d0b(0x205)](this['logsDir'],_0x21829c),_0x5f4ea4=fs_1['default']['statSync'](_0xad1bf3),[_0x3a5304,_0x5c3516]=_0x21829c[_0x225d0b(0x21e)](_0x225d0b(0x1f9),'')[_0x225d0b(0x200)]('_');return{'type':_0x3a5304,'date':_0x5c3516,'size':_0x5f4ea4['size']};})[_0x1bc705(0x22e)]((_0x3c9cc6,_0x23903c)=>_0x23903c['date'][_0x1bc705(0x1f1)](_0x3c9cc6[_0x1bc705(0x231)]));return{'totalFiles':_0x3ac264[_0x1bc705(0x207)],'logTypes':_0x2d67c3,'latestLogs':_0x354016['slice'](0x0,0xa)};}catch(_0x3dac39){return console[_0x1bc705(0x1fc)]('Failed\x20to\x20get\x20log\x20stats:',_0x3dac39),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a59_0x2604be(0x20a)](_0x2645ce=0x1e){const _0x5eda21=a59_0x2604be;try{const _0x21b827=fs_1[_0x5eda21(0x21d)]['readdirSync'](this[_0x5eda21(0x21c)]),_0x280bbf=new Date();_0x280bbf[_0x5eda21(0x217)](_0x280bbf['getDate']()-_0x2645ce);let _0x9f632=0x0;_0x21b827[_0x5eda21(0x1fd)](_0x32af89=>{const _0x1b4f21=_0x5eda21;if(!_0x32af89[_0x1b4f21(0x1ff)](_0x1b4f21(0x1f9)))return;const _0x305e45=path_1[_0x1b4f21(0x21d)]['join'](this[_0x1b4f21(0x21c)],_0x32af89),_0x2b7a97=fs_1[_0x1b4f21(0x21d)][_0x1b4f21(0x22c)](_0x305e45);_0x2b7a97[_0x1b4f21(0x1fe)]<_0x280bbf&&(fs_1[_0x1b4f21(0x21d)][_0x1b4f21(0x1ed)](_0x305e45),_0x9f632++,console[_0x1b4f21(0x20b)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x32af89));}),console[_0x5eda21(0x20b)](_0x5eda21(0x20c)+_0x9f632+_0x5eda21(0x230)+_0x2645ce+_0x5eda21(0x1fa));}catch(_0x3be11f){console[_0x5eda21(0x1fc)](_0x5eda21(0x228),_0x3be11f);}}}exports['LoggerService']=LoggerService,exports[a59_0x2604be(0x1f0)]=new LoggerService();