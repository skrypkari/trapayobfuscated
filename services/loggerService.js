'use strict';const a52_0x2dfd68=a52_0x1804;function a52_0x3f53(){const _0x71fde6=['584176dbeJtr','logsDir','date','Failed\x20to\x20write\x20','7BkYefy','COINTOPAY_ERROR','logShopWebhookError','error','cointopay_status_changes','stringify','📁\x20Created\x20logs\x20directory:\x20','3279WopDPv','path','355180gZmRZv','stack','webhooks_processed','unlinkSync','\x20old\x20log\x20files\x20(older\x20than\x20','log','WEBHOOK_PROCESSED','shop_webhooks_sent','logCoinToPayError','map','webhooks_errors','toISOString','18mIXkOV','RESPONSE','filter','logWebhookProcessed','WEBHOOK_RECEIVED','defineProperty','message','SHOP_WEBHOOK_ERROR','getDate','Failed\x20to\x20get\x20log\x20stats:','LoggerService','cleanOldLogs','split','size','mkdirSync','45FLxGqn','logShopWebhookSent','logPaymentCreated','replace','existsSync','api_calls','\x20log:','endsWith','77NaioWH','cwd','1838304yFHmEC','sort','readdirSync','localeCompare','WEBHOOK_ERROR','getLogFileName','PAYMENT_CREATED','logApiCall','786lOOBPb','7517352mbcSDU','default','getLogStats','6104905UCUzma','writeLog','statSync','slice','Failed\x20to\x20clean\x20old\x20logs:','utf8','\x20days)','payments_created','🧹\x20Cleaned\x20','ensureLogsDirectory','__esModule','loggerService','join','🗑️\x20Deleted\x20old\x20log\x20file:\x20','.log','SHOP_WEBHOOK_SENT','mtime','logWebhookReceived','1291560cnoiyi','__importDefault','setDate'];a52_0x3f53=function(){return _0x71fde6;};return a52_0x3f53();}(function(_0x3a5360,_0x542c40){const _0x11236f=a52_0x1804,_0x36fece=_0x3a5360();while(!![]){try{const _0x47fe53=-parseInt(_0x11236f(0x17e))/0x1*(parseInt(_0x11236f(0x15a))/0x2)+parseInt(_0x11236f(0x18c))/0x3*(parseInt(_0x11236f(0x173))/0x4)+-parseInt(_0x11236f(0x15e))/0x5+-parseInt(_0x11236f(0x15b))/0x6*(-parseInt(_0x11236f(0x177))/0x7)+parseInt(_0x11236f(0x152))/0x8+-parseInt(_0x11236f(0x19b))/0x9*(-parseInt(_0x11236f(0x180))/0xa)+parseInt(_0x11236f(0x1a3))/0xb*(parseInt(_0x11236f(0x170))/0xc);if(_0x47fe53===_0x542c40)break;else _0x36fece['push'](_0x36fece['shift']());}catch(_0x16c4f){_0x36fece['push'](_0x36fece['shift']());}}}(a52_0x3f53,0xbe81c));var __importDefault=this&&this[a52_0x2dfd68(0x171)]||function(_0xc233de){const _0x3c60f7=a52_0x2dfd68;return _0xc233de&&_0xc233de[_0x3c60f7(0x168)]?_0xc233de:{'default':_0xc233de};};Object[a52_0x2dfd68(0x191)](exports,a52_0x2dfd68(0x168),{'value':!![]}),exports[a52_0x2dfd68(0x169)]=exports[a52_0x2dfd68(0x196)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a52_0x2dfd68(0x17f)));function a52_0x1804(_0x2d7529,_0x3a0705){const _0x3f5372=a52_0x3f53();return a52_0x1804=function(_0x1804f8,_0x1e7190){_0x1804f8=_0x1804f8-0x152;let _0x2f7770=_0x3f5372[_0x1804f8];return _0x2f7770;},a52_0x1804(_0x2d7529,_0x3a0705);}class LoggerService{constructor(){const _0x4edda3=a52_0x2dfd68;this['logsDir']=path_1[_0x4edda3(0x15c)][_0x4edda3(0x16a)](process[_0x4edda3(0x1a4)](),'logs'),this[_0x4edda3(0x167)]();}[a52_0x2dfd68(0x167)](){const _0x8130a5=a52_0x2dfd68;!fs_1['default'][_0x8130a5(0x19f)](this['logsDir'])&&(fs_1['default'][_0x8130a5(0x19a)](this[_0x8130a5(0x174)],{'recursive':!![]}),console[_0x8130a5(0x185)](_0x8130a5(0x17d)+this[_0x8130a5(0x174)]));}[a52_0x2dfd68(0x157)](_0x5abff8){const _0x539914=a52_0x2dfd68,_0x59c8b8=new Date()[_0x539914(0x18b)]()['split']('T')[0x0];return path_1[_0x539914(0x15c)][_0x539914(0x16a)](this[_0x539914(0x174)],_0x5abff8+'_'+_0x59c8b8+_0x539914(0x16c));}[a52_0x2dfd68(0x15f)](_0x81e192,_0x34d097){const _0x5a3e1c=a52_0x2dfd68;try{const _0x53545f=new Date()[_0x5a3e1c(0x18b)](),_0x8f98af={'timestamp':_0x53545f,..._0x34d097},_0x468ae0=JSON[_0x5a3e1c(0x17c)](_0x8f98af)+'\x0a',_0x298c7b=this[_0x5a3e1c(0x157)](_0x81e192);fs_1[_0x5a3e1c(0x15c)]['appendFileSync'](_0x298c7b,_0x468ae0,_0x5a3e1c(0x163));}catch(_0x446555){console[_0x5a3e1c(0x17a)](_0x5a3e1c(0x176)+_0x81e192+_0x5a3e1c(0x1a1),_0x446555);}}['logWhiteDomainRequest'](_0x4840ef,_0x44f880,_0x208962,_0x48f150){const _0xdd8093=a52_0x2dfd68;this[_0xdd8093(0x15f)]('white_domain_requests',{'type':'REQUEST','gateway':_0x4840ef,'endpoint':_0x44f880,'method':_0x208962,'data':_0x48f150});}['logWhiteDomainResponse'](_0x38aeba,_0x148562,_0x155189,_0xe1051c,_0x1e189e){const _0x12c94f=a52_0x2dfd68;this['writeLog']('white_domain_responses',{'type':_0x12c94f(0x18d),'gateway':_0x38aeba,'endpoint':_0x148562,'status':_0x155189,'responseTime':_0x1e189e,'data':_0xe1051c});}['logWhiteDomainError'](_0x38ebc3,_0x3459b2,_0x3e40d3){const _0x304c77=a52_0x2dfd68;this[_0x304c77(0x15f)]('white_domain_errors',{'type':'ERROR','gateway':_0x38ebc3,'endpoint':_0x3459b2,'error':_0x3e40d3 instanceof Error?{'message':_0x3e40d3['message'],'stack':_0x3e40d3[_0x304c77(0x181)]}:_0x3e40d3});}[a52_0x2dfd68(0x16f)](_0x245de2,_0x475797,_0x18e597){const _0x9ca7fa=a52_0x2dfd68;this[_0x9ca7fa(0x15f)]('webhooks_received',{'type':_0x9ca7fa(0x190),'gateway':_0x245de2,'headers':_0x18e597,'data':_0x475797});}[a52_0x2dfd68(0x18f)](_0x2a4cae,_0x79b545,_0x58c8b6,_0x2d2416,_0xb0345a){const _0xffb004=a52_0x2dfd68;this[_0xffb004(0x15f)](_0xffb004(0x182),{'type':_0xffb004(0x186),'gateway':_0x2a4cae,'paymentId':_0x79b545,'oldStatus':_0x58c8b6,'newStatus':_0x2d2416,'originalData':_0xb0345a});}['logWebhookError'](_0x4f7c51,_0x7c7ffc,_0x104bbb){const _0x2a6d74=a52_0x2dfd68;this['writeLog'](_0x2a6d74(0x18a),{'type':_0x2a6d74(0x156),'gateway':_0x4f7c51,'error':_0x7c7ffc instanceof Error?{'message':_0x7c7ffc['message'],'stack':_0x7c7ffc['stack']}:_0x7c7ffc,'originalData':_0x104bbb});}['logCoinToPayStatus'](_0x49f9b3){const _0x3a479a=a52_0x2dfd68;this[_0x3a479a(0x15f)](_0x3a479a(0x17b),{'type':'COINTOPAY_STATUS_CHANGE',..._0x49f9b3});}[a52_0x2dfd68(0x188)](_0x77b43){const _0x2559d1=a52_0x2dfd68;this[_0x2559d1(0x15f)]('cointopay_errors',{'type':_0x2559d1(0x178),..._0x77b43});}[a52_0x2dfd68(0x19c)](_0x31e6b5,_0x34e22d,_0x2dc123,_0x314e07,_0x28838a,_0x1412b6){const _0x304ed2=a52_0x2dfd68;this['writeLog'](_0x304ed2(0x187),{'type':_0x304ed2(0x16d),'shopId':_0x31e6b5,'webhookUrl':_0x34e22d,'event':_0x2dc123,'status':_0x314e07,'responseTime':_0x28838a,'payload':_0x1412b6});}[a52_0x2dfd68(0x179)](_0x152915,_0x2ebdc8,_0x3b7374,_0x2fd0e7,_0x396cff){const _0x1c399f=a52_0x2dfd68;this[_0x1c399f(0x15f)]('shop_webhooks_errors',{'type':_0x1c399f(0x193),'shopId':_0x152915,'webhookUrl':_0x2ebdc8,'event':_0x3b7374,'error':_0x2fd0e7 instanceof Error?{'message':_0x2fd0e7[_0x1c399f(0x192)],'stack':_0x2fd0e7[_0x1c399f(0x181)]}:_0x2fd0e7,'payload':_0x396cff});}[a52_0x2dfd68(0x19d)](_0x793b32,_0x25cbbe,_0x4dda24,_0x16873c,_0x52288d){const _0x29d9e7=a52_0x2dfd68;this['writeLog'](_0x29d9e7(0x165),{'type':_0x29d9e7(0x158),'gateway':_0x793b32,'paymentId':_0x25cbbe,'shopId':_0x4dda24,'amount':_0x16873c,'currency':_0x52288d});}[a52_0x2dfd68(0x159)](_0x817fd5,_0x3e9f04,_0xae376c,_0x38ce54,_0x4b8bf4){const _0x3ec825=a52_0x2dfd68;this[_0x3ec825(0x15f)](_0x3ec825(0x1a0),{'type':'API_CALL','endpoint':_0x817fd5,'method':_0x3e9f04,'userId':_0xae376c,'userRole':_0x38ce54,'requestData':_0x4b8bf4});}[a52_0x2dfd68(0x15d)](){const _0x34e1b7=a52_0x2dfd68;try{const _0x3f3b62=fs_1['default'][_0x34e1b7(0x154)](this[_0x34e1b7(0x174)]),_0x550d29=_0x3f3b62[_0x34e1b7(0x18e)](_0xe11a76=>_0xe11a76['endsWith'](_0x34e1b7(0x16c))),_0x54919b=[...new Set(_0x550d29[_0x34e1b7(0x189)](_0x5ab4b5=>_0x5ab4b5['split']('_')[0x0]))],_0x3446e2=_0x550d29[_0x34e1b7(0x189)](_0x31e9c3=>{const _0x131598=_0x34e1b7,_0x40908e=path_1[_0x131598(0x15c)]['join'](this[_0x131598(0x174)],_0x31e9c3),_0x5aa3fb=fs_1[_0x131598(0x15c)][_0x131598(0x160)](_0x40908e),[_0x34abfb,_0x2a427a]=_0x31e9c3[_0x131598(0x19e)](_0x131598(0x16c),'')[_0x131598(0x198)]('_');return{'type':_0x34abfb,'date':_0x2a427a,'size':_0x5aa3fb[_0x131598(0x199)]};})[_0x34e1b7(0x153)]((_0x5acde3,_0x266dc1)=>_0x266dc1[_0x34e1b7(0x175)][_0x34e1b7(0x155)](_0x5acde3['date']));return{'totalFiles':_0x550d29['length'],'logTypes':_0x54919b,'latestLogs':_0x3446e2[_0x34e1b7(0x161)](0x0,0xa)};}catch(_0x278128){return console[_0x34e1b7(0x17a)](_0x34e1b7(0x195),_0x278128),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a52_0x2dfd68(0x197)](_0x18ee6e=0x1e){const _0x525910=a52_0x2dfd68;try{const _0x4003a0=fs_1[_0x525910(0x15c)][_0x525910(0x154)](this[_0x525910(0x174)]),_0xe4dfe6=new Date();_0xe4dfe6[_0x525910(0x172)](_0xe4dfe6[_0x525910(0x194)]()-_0x18ee6e);let _0x87cc3a=0x0;_0x4003a0['forEach'](_0x5a9f05=>{const _0x1ce31c=_0x525910;if(!_0x5a9f05[_0x1ce31c(0x1a2)](_0x1ce31c(0x16c)))return;const _0x5735a9=path_1[_0x1ce31c(0x15c)]['join'](this[_0x1ce31c(0x174)],_0x5a9f05),_0x275aac=fs_1['default'][_0x1ce31c(0x160)](_0x5735a9);_0x275aac[_0x1ce31c(0x16e)]<_0xe4dfe6&&(fs_1[_0x1ce31c(0x15c)][_0x1ce31c(0x183)](_0x5735a9),_0x87cc3a++,console[_0x1ce31c(0x185)](_0x1ce31c(0x16b)+_0x5a9f05));}),console[_0x525910(0x185)](_0x525910(0x166)+_0x87cc3a+_0x525910(0x184)+_0x18ee6e+_0x525910(0x164));}catch(_0xaced98){console[_0x525910(0x17a)](_0x525910(0x162),_0xaced98);}}}exports[a52_0x2dfd68(0x196)]=LoggerService,exports[a52_0x2dfd68(0x169)]=new LoggerService();