'use strict';function a51_0x59ab(){const _0x3f44c2=['logShopWebhookSent','unlinkSync','🧹\x20Cleaned\x20','webhooks_processed','\x20log:','WEBHOOK_ERROR','WEBHOOK_PROCESSED','error','2608506ZhuGUO','mtime','readdirSync','__esModule','cwd','utf8','API_CALL','COINTOPAY_STATUS_CHANGE','WEBHOOK_RECEIVED','endsWith','Failed\x20to\x20clean\x20old\x20logs:','.log','logPaymentCreated','toISOString','writeLog','logShopWebhookError','5011280BZyyYi','white_domain_errors','getLogFileName','2857815vnIPxv','logCoinToPayError','LoggerService','logWhiteDomainRequest','path','length','loggerService','existsSync','9434446rNmkBm','COINTOPAY_ERROR','943003mRNlPq','SHOP_WEBHOOK_SENT','white_domain_responses','webhooks_received','logWhiteDomainResponse','logsDir','logWebhookProcessed','8274564FwwHMI','cointopay_status_changes','getDate','log','\x20old\x20log\x20files\x20(older\x20than\x20','default','localeCompare','logWebhookReceived','logWebhookError','message','defineProperty','mkdirSync','Failed\x20to\x20write\x20','appendFileSync','stack','sort','webhooks_errors','join','cleanOldLogs','7836660BJPbdi','setDate','map','__importDefault','api_calls','REQUEST','stringify','🗑️\x20Deleted\x20old\x20log\x20file:\x20','shop_webhooks_errors','date','cointopay_errors','ERROR','payments_created','logCoinToPayStatus','size','statSync','SHOP_WEBHOOK_ERROR','replace','split','PAYMENT_CREATED','shop_webhooks_sent','ensureLogsDirectory'];a51_0x59ab=function(){return _0x3f44c2;};return a51_0x59ab();}const a51_0x84b5cf=a51_0x3ecf;(function(_0x3780eb,_0x9ee899){const _0x4fb4b7=a51_0x3ecf,_0x4aeb51=_0x3780eb();while(!![]){try{const _0x42fd2d=parseInt(_0x4fb4b7(0xa8))/0x1+parseInt(_0x4fb4b7(0x8b))/0x2+parseInt(_0x4fb4b7(0x9e))/0x3+-parseInt(_0x4fb4b7(0x9b))/0x4+parseInt(_0x4fb4b7(0xc2))/0x5+-parseInt(_0x4fb4b7(0xaf))/0x6+-parseInt(_0x4fb4b7(0xa6))/0x7;if(_0x42fd2d===_0x9ee899)break;else _0x4aeb51['push'](_0x4aeb51['shift']());}catch(_0x37dc2e){_0x4aeb51['push'](_0x4aeb51['shift']());}}}(a51_0x59ab,0xc042d));var __importDefault=this&&this[a51_0x84b5cf(0xc5)]||function(_0x293ed0){const _0x390341=a51_0x84b5cf;return _0x293ed0&&_0x293ed0[_0x390341(0x8e)]?_0x293ed0:{'default':_0x293ed0};};Object[a51_0x84b5cf(0xb9)](exports,a51_0x84b5cf(0x8e),{'value':!![]}),exports[a51_0x84b5cf(0xa4)]=exports[a51_0x84b5cf(0xa0)]=void 0x0;function a51_0x3ecf(_0x1caef6,_0x26d1d1){const _0x59abcc=a51_0x59ab();return a51_0x3ecf=function(_0x3ecfb9,_0x21d625){_0x3ecfb9=_0x3ecfb9-0x71;let _0x33582c=_0x59abcc[_0x3ecfb9];return _0x33582c;},a51_0x3ecf(_0x1caef6,_0x26d1d1);}const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x84b5cf(0xa2)));class LoggerService{constructor(){const _0x25a2d7=a51_0x84b5cf;this['logsDir']=path_1[_0x25a2d7(0xb4)]['join'](process[_0x25a2d7(0x8f)](),'logs'),this['ensureLogsDirectory']();}[a51_0x84b5cf(0x82)](){const _0x2667c8=a51_0x84b5cf;!fs_1[_0x2667c8(0xb4)][_0x2667c8(0xa5)](this['logsDir'])&&(fs_1['default'][_0x2667c8(0xba)](this['logsDir'],{'recursive':!![]}),console['log']('📁\x20Created\x20logs\x20directory:\x20'+this[_0x2667c8(0xad)]));}[a51_0x84b5cf(0x9d)](_0x2cb9b7){const _0x23d9b7=a51_0x84b5cf,_0x575a1a=new Date()[_0x23d9b7(0x98)]()[_0x23d9b7(0x7f)]('T')[0x0];return path_1['default'][_0x23d9b7(0xc0)](this[_0x23d9b7(0xad)],_0x2cb9b7+'_'+_0x575a1a+'.log');}[a51_0x84b5cf(0x99)](_0x45fa2f,_0x77f15f){const _0x53a074=a51_0x84b5cf;try{const _0x1091ce=new Date()['toISOString'](),_0x3697d6={'timestamp':_0x1091ce,..._0x77f15f},_0x3235bd=JSON[_0x53a074(0x73)](_0x3697d6)+'\x0a',_0xbbbcdc=this[_0x53a074(0x9d)](_0x45fa2f);fs_1[_0x53a074(0xb4)][_0x53a074(0xbc)](_0xbbbcdc,_0x3235bd,_0x53a074(0x90));}catch(_0x3e4045){console[_0x53a074(0x8a)](_0x53a074(0xbb)+_0x45fa2f+_0x53a074(0x87),_0x3e4045);}}[a51_0x84b5cf(0xa1)](_0x5c275b,_0x178153,_0xf35d29,_0x5ab45b){const _0x13696e=a51_0x84b5cf;this['writeLog']('white_domain_requests',{'type':_0x13696e(0x72),'gateway':_0x5c275b,'endpoint':_0x178153,'method':_0xf35d29,'data':_0x5ab45b});}[a51_0x84b5cf(0xac)](_0x26210a,_0x4e8c23,_0x27687b,_0x14d50e,_0x53463d){const _0x2292e9=a51_0x84b5cf;this[_0x2292e9(0x99)](_0x2292e9(0xaa),{'type':'RESPONSE','gateway':_0x26210a,'endpoint':_0x4e8c23,'status':_0x27687b,'responseTime':_0x53463d,'data':_0x14d50e});}['logWhiteDomainError'](_0x11b1f3,_0x25fe96,_0x2e3235){const _0x1b1a81=a51_0x84b5cf;this[_0x1b1a81(0x99)](_0x1b1a81(0x9c),{'type':_0x1b1a81(0x78),'gateway':_0x11b1f3,'endpoint':_0x25fe96,'error':_0x2e3235 instanceof Error?{'message':_0x2e3235[_0x1b1a81(0xb8)],'stack':_0x2e3235['stack']}:_0x2e3235});}[a51_0x84b5cf(0xb6)](_0x1cbd35,_0x235599,_0x5df7d3){const _0x5608d5=a51_0x84b5cf;this['writeLog'](_0x5608d5(0xab),{'type':_0x5608d5(0x93),'gateway':_0x1cbd35,'headers':_0x5df7d3,'data':_0x235599});}[a51_0x84b5cf(0xae)](_0x44733f,_0x22b62b,_0x178011,_0x467cd1,_0xcb342c){const _0x5d1c04=a51_0x84b5cf;this[_0x5d1c04(0x99)](_0x5d1c04(0x86),{'type':_0x5d1c04(0x89),'gateway':_0x44733f,'paymentId':_0x22b62b,'oldStatus':_0x178011,'newStatus':_0x467cd1,'originalData':_0xcb342c});}[a51_0x84b5cf(0xb7)](_0x4b0fff,_0xa78e40,_0x5f30f7){const _0x4b8b86=a51_0x84b5cf;this[_0x4b8b86(0x99)](_0x4b8b86(0xbf),{'type':_0x4b8b86(0x88),'gateway':_0x4b0fff,'error':_0xa78e40 instanceof Error?{'message':_0xa78e40[_0x4b8b86(0xb8)],'stack':_0xa78e40[_0x4b8b86(0xbd)]}:_0xa78e40,'originalData':_0x5f30f7});}[a51_0x84b5cf(0x7a)](_0x378059){const _0x20d0b5=a51_0x84b5cf;this[_0x20d0b5(0x99)](_0x20d0b5(0xb0),{'type':_0x20d0b5(0x92),..._0x378059});}[a51_0x84b5cf(0x9f)](_0x46f3a9){const _0x259b09=a51_0x84b5cf;this[_0x259b09(0x99)](_0x259b09(0x77),{'type':_0x259b09(0xa7),..._0x46f3a9});}[a51_0x84b5cf(0x83)](_0x3d5474,_0xea807f,_0x2bce6a,_0x2707af,_0x183e52,_0x5ca0b9){const _0x5063d8=a51_0x84b5cf;this[_0x5063d8(0x99)](_0x5063d8(0x81),{'type':_0x5063d8(0xa9),'shopId':_0x3d5474,'webhookUrl':_0xea807f,'event':_0x2bce6a,'status':_0x2707af,'responseTime':_0x183e52,'payload':_0x5ca0b9});}[a51_0x84b5cf(0x9a)](_0x25e759,_0x44d677,_0x509011,_0x136416,_0x5d712e){const _0x2fc918=a51_0x84b5cf;this[_0x2fc918(0x99)](_0x2fc918(0x75),{'type':_0x2fc918(0x7d),'shopId':_0x25e759,'webhookUrl':_0x44d677,'event':_0x509011,'error':_0x136416 instanceof Error?{'message':_0x136416['message'],'stack':_0x136416['stack']}:_0x136416,'payload':_0x5d712e});}[a51_0x84b5cf(0x97)](_0x1f8380,_0x5050f5,_0x3534a0,_0x2b8a6b,_0x25c428){const _0x4e2ca7=a51_0x84b5cf;this[_0x4e2ca7(0x99)](_0x4e2ca7(0x79),{'type':_0x4e2ca7(0x80),'gateway':_0x1f8380,'paymentId':_0x5050f5,'shopId':_0x3534a0,'amount':_0x2b8a6b,'currency':_0x25c428});}['logApiCall'](_0xbca2a7,_0x359b85,_0x4b972b,_0x132c63,_0x5b8bbe){const _0x180159=a51_0x84b5cf;this[_0x180159(0x99)](_0x180159(0x71),{'type':_0x180159(0x91),'endpoint':_0xbca2a7,'method':_0x359b85,'userId':_0x4b972b,'userRole':_0x132c63,'requestData':_0x5b8bbe});}['getLogStats'](){const _0x300ad4=a51_0x84b5cf;try{const _0x495e7b=fs_1['default'][_0x300ad4(0x8d)](this[_0x300ad4(0xad)]),_0xf17330=_0x495e7b['filter'](_0x18c027=>_0x18c027[_0x300ad4(0x94)](_0x300ad4(0x96))),_0x493db7=[...new Set(_0xf17330[_0x300ad4(0xc4)](_0x500d0d=>_0x500d0d[_0x300ad4(0x7f)]('_')[0x0]))],_0x375b2e=_0xf17330[_0x300ad4(0xc4)](_0x4b41d3=>{const _0x1ee641=_0x300ad4,_0x41662b=path_1['default'][_0x1ee641(0xc0)](this['logsDir'],_0x4b41d3),_0x308517=fs_1[_0x1ee641(0xb4)][_0x1ee641(0x7c)](_0x41662b),[_0x45f65e,_0x4e82ef]=_0x4b41d3[_0x1ee641(0x7e)](_0x1ee641(0x96),'')['split']('_');return{'type':_0x45f65e,'date':_0x4e82ef,'size':_0x308517[_0x1ee641(0x7b)]};})[_0x300ad4(0xbe)]((_0x329c1a,_0x464d08)=>_0x464d08['date'][_0x300ad4(0xb5)](_0x329c1a[_0x300ad4(0x76)]));return{'totalFiles':_0xf17330[_0x300ad4(0xa3)],'logTypes':_0x493db7,'latestLogs':_0x375b2e['slice'](0x0,0xa)};}catch(_0x4a8e37){return console[_0x300ad4(0x8a)]('Failed\x20to\x20get\x20log\x20stats:',_0x4a8e37),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x84b5cf(0xc1)](_0x22ff83=0x1e){const _0x3e8da3=a51_0x84b5cf;try{const _0x3eb3ba=fs_1['default'][_0x3e8da3(0x8d)](this['logsDir']),_0x475ea2=new Date();_0x475ea2[_0x3e8da3(0xc3)](_0x475ea2[_0x3e8da3(0xb1)]()-_0x22ff83);let _0x2a6aa6=0x0;_0x3eb3ba['forEach'](_0x3dd7cb=>{const _0xc47ece=_0x3e8da3;if(!_0x3dd7cb[_0xc47ece(0x94)](_0xc47ece(0x96)))return;const _0x41b4ad=path_1['default']['join'](this[_0xc47ece(0xad)],_0x3dd7cb),_0x55bcf5=fs_1[_0xc47ece(0xb4)][_0xc47ece(0x7c)](_0x41b4ad);_0x55bcf5[_0xc47ece(0x8c)]<_0x475ea2&&(fs_1[_0xc47ece(0xb4)][_0xc47ece(0x84)](_0x41b4ad),_0x2a6aa6++,console[_0xc47ece(0xb2)](_0xc47ece(0x74)+_0x3dd7cb));}),console[_0x3e8da3(0xb2)](_0x3e8da3(0x85)+_0x2a6aa6+_0x3e8da3(0xb3)+_0x22ff83+'\x20days)');}catch(_0x4c0291){console[_0x3e8da3(0x8a)](_0x3e8da3(0x95),_0x4c0291);}}}exports[a51_0x84b5cf(0xa0)]=LoggerService,exports[a51_0x84b5cf(0xa4)]=new LoggerService();