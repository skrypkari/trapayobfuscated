'use strict';const a79_0x223cea=a79_0x1f50;function a79_0x1f50(_0x2cf7d6,_0x421764){_0x2cf7d6=_0x2cf7d6-0xed;const _0x5a3961=a79_0x5a39();let _0x1f5032=_0x5a3961[_0x2cf7d6];return _0x1f5032;}(function(_0x48c79b,_0x56baeb){const _0x4d25a0=a79_0x1f50,_0x2fe3b6=_0x48c79b();while(!![]){try{const _0x345a5c=-parseInt(_0x4d25a0(0x110))/0x1*(-parseInt(_0x4d25a0(0x100))/0x2)+parseInt(_0x4d25a0(0x135))/0x3*(parseInt(_0x4d25a0(0x103))/0x4)+-parseInt(_0x4d25a0(0x117))/0x5+parseInt(_0x4d25a0(0xee))/0x6*(parseInt(_0x4d25a0(0x13d))/0x7)+-parseInt(_0x4d25a0(0x115))/0x8*(-parseInt(_0x4d25a0(0xfc))/0x9)+-parseInt(_0x4d25a0(0x101))/0xa*(-parseInt(_0x4d25a0(0x12c))/0xb)+parseInt(_0x4d25a0(0x123))/0xc*(-parseInt(_0x4d25a0(0x129))/0xd);if(_0x345a5c===_0x56baeb)break;else _0x2fe3b6['push'](_0x2fe3b6['shift']());}catch(_0x41599c){_0x2fe3b6['push'](_0x2fe3b6['shift']());}}}(a79_0x5a39,0xbb59f));var __importDefault=this&&this[a79_0x223cea(0x133)]||function(_0xc373a1){const _0x45a6bb=a79_0x223cea;return _0xc373a1&&_0xc373a1[_0x45a6bb(0x128)]?_0xc373a1:{'default':_0xc373a1};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a79_0x223cea(0x122)]=exports[a79_0x223cea(0x11f)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a79_0x223cea(0xf9)));class LoggerService{constructor(){const _0x34751f=a79_0x223cea;this['logsDir']=path_1[_0x34751f(0x13e)][_0x34751f(0x108)](process['cwd'](),_0x34751f(0xf6)),this[_0x34751f(0x13c)]();}[a79_0x223cea(0x13c)](){const _0x3064ce=a79_0x223cea;!fs_1['default'][_0x3064ce(0x105)](this['logsDir'])&&(fs_1['default'][_0x3064ce(0x11e)](this[_0x3064ce(0x10c)],{'recursive':!![]}),console[_0x3064ce(0x142)](_0x3064ce(0x125)+this[_0x3064ce(0x10c)]));}['getLogFileName'](_0x2e660d){const _0x3af509=a79_0x223cea,_0x5ca001=new Date()[_0x3af509(0x106)]()['split']('T')[0x0];return path_1[_0x3af509(0x13e)]['join'](this[_0x3af509(0x10c)],_0x2e660d+'_'+_0x5ca001+'.log');}[a79_0x223cea(0x13a)](_0x572364,_0x17bbfe){const _0x490a50=a79_0x223cea;try{const _0x3024e2=new Date()['toISOString'](),_0x486959={'timestamp':_0x3024e2,..._0x17bbfe},_0x5b8c69=JSON[_0x490a50(0x11a)](_0x486959)+'\x0a',_0x137306=this[_0x490a50(0xef)](_0x572364);fs_1[_0x490a50(0x13e)]['appendFileSync'](_0x137306,_0x5b8c69,'utf8');}catch(_0x497138){console[_0x490a50(0xff)](_0x490a50(0xf0)+_0x572364+_0x490a50(0xfd),_0x497138);}}[a79_0x223cea(0x111)](_0x490548,_0x2ebac2,_0x43d4cc,_0x5a65cd){const _0x1c2c74=a79_0x223cea;this[_0x1c2c74(0x13a)]('white_domain_requests',{'type':_0x1c2c74(0x102),'gateway':_0x490548,'endpoint':_0x2ebac2,'method':_0x43d4cc,'data':_0x5a65cd});}[a79_0x223cea(0x10d)](_0x75e2a5,_0x2e9c14,_0x9d9803,_0x4c9f2f,_0x22c125){const _0x43beea=a79_0x223cea;this[_0x43beea(0x13a)](_0x43beea(0xf8),{'type':_0x43beea(0x131),'gateway':_0x75e2a5,'endpoint':_0x2e9c14,'status':_0x9d9803,'responseTime':_0x22c125,'data':_0x4c9f2f});}[a79_0x223cea(0xf3)](_0x548c60,_0x3b39a5,_0x67206b){const _0xe31a8f=a79_0x223cea;this['writeLog'](_0xe31a8f(0x116),{'type':_0xe31a8f(0x121),'gateway':_0x548c60,'endpoint':_0x3b39a5,'error':_0x67206b instanceof Error?{'message':_0x67206b[_0xe31a8f(0x136)],'stack':_0x67206b[_0xe31a8f(0xfb)]}:_0x67206b});}['logWebhookReceived'](_0x114d02,_0x36cc16,_0x45b639){const _0x98ea2d=a79_0x223cea;this['writeLog'](_0x98ea2d(0x112),{'type':_0x98ea2d(0x132),'gateway':_0x114d02,'headers':_0x45b639,'data':_0x36cc16});}[a79_0x223cea(0x127)](_0x4ea1e3,_0x440c0d,_0x14bda1,_0x280577,_0x115189){const _0x5500b8=a79_0x223cea;this[_0x5500b8(0x13a)](_0x5500b8(0xf7),{'type':_0x5500b8(0x104),'gateway':_0x4ea1e3,'paymentId':_0x440c0d,'oldStatus':_0x14bda1,'newStatus':_0x280577,'originalData':_0x115189});}[a79_0x223cea(0xf5)](_0x35e342,_0x77b187,_0x1096b8){const _0x3aee20=a79_0x223cea;this[_0x3aee20(0x13a)]('webhooks_errors',{'type':_0x3aee20(0x109),'gateway':_0x35e342,'error':_0x77b187 instanceof Error?{'message':_0x77b187[_0x3aee20(0x136)],'stack':_0x77b187[_0x3aee20(0xfb)]}:_0x77b187,'originalData':_0x1096b8});}[a79_0x223cea(0x124)](_0x48f306){const _0x5c91ee=a79_0x223cea;this['writeLog'](_0x5c91ee(0x10f),{'type':_0x5c91ee(0x10a),..._0x48f306});}['logCoinToPayError'](_0xdedc80){const _0x495a04=a79_0x223cea;this[_0x495a04(0x13a)](_0x495a04(0x107),{'type':_0x495a04(0x13b),..._0xdedc80});}[a79_0x223cea(0x118)](_0x23b003,_0x272e64,_0x26d5a9,_0x2b7183,_0x3d548b,_0x35bda3){const _0x3e63c1=a79_0x223cea;this[_0x3e63c1(0x13a)](_0x3e63c1(0x12e),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x23b003,'webhookUrl':_0x272e64,'event':_0x26d5a9,'status':_0x2b7183,'responseTime':_0x3d548b,'payload':_0x35bda3});}[a79_0x223cea(0xfa)](_0x23e9b6,_0xd585ff,_0x580551,_0x22e48b,_0x435bc4){const _0x221e14=a79_0x223cea;this['writeLog'](_0x221e14(0x11d),{'type':_0x221e14(0x12a),'shopId':_0x23e9b6,'webhookUrl':_0xd585ff,'event':_0x580551,'error':_0x22e48b instanceof Error?{'message':_0x22e48b[_0x221e14(0x136)],'stack':_0x22e48b[_0x221e14(0xfb)]}:_0x22e48b,'payload':_0x435bc4});}[a79_0x223cea(0xfe)](_0xfbca84,_0x32b1ff,_0x4f5112,_0xfb570b,_0x20afb0){const _0x48e987=a79_0x223cea;this['writeLog']('payments_created',{'type':_0x48e987(0x138),'gateway':_0xfbca84,'paymentId':_0x32b1ff,'shopId':_0x4f5112,'amount':_0xfb570b,'currency':_0x20afb0});}[a79_0x223cea(0x12d)](_0x30fc4b,_0x4ff12c,_0x966d4a,_0x48d72d,_0x684283){const _0x26685a=a79_0x223cea;this[_0x26685a(0x13a)](_0x26685a(0x114),{'type':_0x26685a(0x140),'endpoint':_0x30fc4b,'method':_0x4ff12c,'userId':_0x966d4a,'userRole':_0x48d72d,'requestData':_0x684283});}[a79_0x223cea(0x12b)](){const _0x4d373c=a79_0x223cea;try{const _0x4c9866=fs_1['default'][_0x4d373c(0x11c)](this[_0x4d373c(0x10c)]),_0x5a32c2=_0x4c9866[_0x4d373c(0xf2)](_0x492172=>_0x492172[_0x4d373c(0x120)](_0x4d373c(0xf4))),_0x12413f=[...new Set(_0x5a32c2['map'](_0x2f7764=>_0x2f7764[_0x4d373c(0x139)]('_')[0x0]))],_0x27f535=_0x5a32c2[_0x4d373c(0x134)](_0x2823c7=>{const _0x12ccb6=_0x4d373c,_0x51b5cf=path_1[_0x12ccb6(0x13e)][_0x12ccb6(0x108)](this[_0x12ccb6(0x10c)],_0x2823c7),_0x481013=fs_1[_0x12ccb6(0x13e)][_0x12ccb6(0x10e)](_0x51b5cf),[_0x3e1f92,_0x21c056]=_0x2823c7[_0x12ccb6(0xed)]('.log','')[_0x12ccb6(0x139)]('_');return{'type':_0x3e1f92,'date':_0x21c056,'size':_0x481013[_0x12ccb6(0x137)]};})[_0x4d373c(0x141)]((_0x5cb8d6,_0x307801)=>_0x307801['date'][_0x4d373c(0x12f)](_0x5cb8d6['date']));return{'totalFiles':_0x5a32c2['length'],'logTypes':_0x12413f,'latestLogs':_0x27f535[_0x4d373c(0x10b)](0x0,0xa)};}catch(_0x48e32b){return console[_0x4d373c(0xff)](_0x4d373c(0x13f),_0x48e32b),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x18665c=0x1e){const _0x5c4d59=a79_0x223cea;try{const _0x2dc952=fs_1[_0x5c4d59(0x13e)][_0x5c4d59(0x11c)](this[_0x5c4d59(0x10c)]),_0x44d1d0=new Date();_0x44d1d0['setDate'](_0x44d1d0['getDate']()-_0x18665c);let _0x32c26e=0x0;_0x2dc952[_0x5c4d59(0x126)](_0x1dd1e0=>{const _0x113b31=_0x5c4d59;if(!_0x1dd1e0[_0x113b31(0x120)](_0x113b31(0xf4)))return;const _0x2d3e8d=path_1[_0x113b31(0x13e)]['join'](this[_0x113b31(0x10c)],_0x1dd1e0),_0x3c6f0f=fs_1[_0x113b31(0x13e)][_0x113b31(0x10e)](_0x2d3e8d);_0x3c6f0f['mtime']<_0x44d1d0&&(fs_1[_0x113b31(0x13e)][_0x113b31(0x11b)](_0x2d3e8d),_0x32c26e++,console['log'](_0x113b31(0x130)+_0x1dd1e0));}),console['log'](_0x5c4d59(0x113)+_0x32c26e+_0x5c4d59(0xf1)+_0x18665c+_0x5c4d59(0x119));}catch(_0xf1d579){console[_0x5c4d59(0xff)]('Failed\x20to\x20clean\x20old\x20logs:',_0xf1d579);}}}function a79_0x5a39(){const _0x466ec0=['stack','612nLFHgJ','\x20log:','logPaymentCreated','error','2pVlPei','294330VTvqRK','REQUEST','12rbYGxx','WEBHOOK_PROCESSED','existsSync','toISOString','cointopay_errors','join','WEBHOOK_ERROR','COINTOPAY_STATUS_CHANGE','slice','logsDir','logWhiteDomainResponse','statSync','cointopay_status_changes','587388yzdxPo','logWhiteDomainRequest','webhooks_received','ðŸ§¹\x20Cleaned\x20','api_calls','134576YMcpAM','white_domain_errors','2325970lXuWlt','logShopWebhookSent','\x20days)','stringify','unlinkSync','readdirSync','shop_webhooks_errors','mkdirSync','LoggerService','endsWith','ERROR','loggerService','444ghPqaH','logCoinToPayStatus','ðŸ“\x20Created\x20logs\x20directory:\x20','forEach','logWebhookProcessed','__esModule','530673uQMgGv','SHOP_WEBHOOK_ERROR','getLogStats','330stGmIV','logApiCall','shop_webhooks_sent','localeCompare','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','RESPONSE','WEBHOOK_RECEIVED','__importDefault','map','51621Gpzcew','message','size','PAYMENT_CREATED','split','writeLog','COINTOPAY_ERROR','ensureLogsDirectory','59941oxyyDP','default','Failed\x20to\x20get\x20log\x20stats:','API_CALL','sort','log','replace','54SPpqok','getLogFileName','Failed\x20to\x20write\x20','\x20old\x20log\x20files\x20(older\x20than\x20','filter','logWhiteDomainError','.log','logWebhookError','logs','webhooks_processed','white_domain_responses','path','logShopWebhookError'];a79_0x5a39=function(){return _0x466ec0;};return a79_0x5a39();}exports['LoggerService']=LoggerService,exports[a79_0x223cea(0x122)]=new LoggerService();