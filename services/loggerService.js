'use strict';const a44_0x1e5609=a44_0x54dc;function a44_0x4c84(){const _0xa2ab2=['__importDefault','unlinkSync','logWebhookReceived','utf8','filter','logsDir','Failed\x20to\x20clean\x20old\x20logs:','logShopWebhookSent','white_domain_errors','map','API_CALL','mtime','defineProperty','LoggerService','appendFileSync','WEBHOOK_ERROR','ðŸ§¹\x20Cleaned\x20','join','logApiCall','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','Failed\x20to\x20write\x20','api_calls','path','white_domain_requests','logPaymentCreated','ðŸ“\x20Created\x20logs\x20directory:\x20','stack','1642456afnWEO','replace','split','log','logShopWebhookError','getLogFileName','2JvZjMo','existsSync','REQUEST','webhooks_received','default','date','sort','\x20log:','getLogStats','payments_created','logWebhookError','localeCompare','forEach','loggerService','54xjUCAt','\x20days)','writeLog','1284548iYdmkq','readdirSync','shop_webhooks_errors','webhooks_errors','122920iZvgmP','logs','toISOString','webhooks_processed','WEBHOOK_PROCESSED','252IqMkYS','statSync','size','21CqoScR','SHOP_WEBHOOK_SENT','white_domain_responses','error','ensureLogsDirectory','1727430PWtXjI','29174299MoEpSV','setDate','slice','shop_webhooks_sent','logWhiteDomainError','stringify','327559tIKfxn','message','Failed\x20to\x20get\x20log\x20stats:','291912HLHcSX','SHOP_WEBHOOK_ERROR','length','logWebhookProcessed','endsWith','RESPONSE','__esModule','.log','getDate'];a44_0x4c84=function(){return _0xa2ab2;};return a44_0x4c84();}(function(_0x58f840,_0x49a26a){const _0x5e8c69=a44_0x54dc,_0x5cf539=_0x58f840();while(!![]){try{const _0x5b6a19=parseInt(_0x5e8c69(0x1e5))/0x1*(parseInt(_0x5e8c69(0x1bc))/0x2)+parseInt(_0x5e8c69(0x1e8))/0x3+parseInt(_0x5e8c69(0x1cd))/0x4+-parseInt(_0x5e8c69(0x1d1))/0x5*(parseInt(_0x5e8c69(0x1d6))/0x6)+parseInt(_0x5e8c69(0x1d9))/0x7*(-parseInt(_0x5e8c69(0x1b6))/0x8)+-parseInt(_0x5e8c69(0x1ca))/0x9*(parseInt(_0x5e8c69(0x1de))/0xa)+parseInt(_0x5e8c69(0x1df))/0xb;if(_0x5b6a19===_0x49a26a)break;else _0x5cf539['push'](_0x5cf539['shift']());}catch(_0x126395){_0x5cf539['push'](_0x5cf539['shift']());}}}(a44_0x4c84,0xae256));var __importDefault=this&&this[a44_0x1e5609(0x1f1)]||function(_0x39037a){const _0x2e7d68=a44_0x1e5609;return _0x39037a&&_0x39037a[_0x2e7d68(0x1ee)]?_0x39037a:{'default':_0x39037a};};Object[a44_0x1e5609(0x1fd)](exports,a44_0x1e5609(0x1ee),{'value':!![]}),exports['loggerService']=exports[a44_0x1e5609(0x1fe)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a44_0x1e5609(0x207)));function a44_0x54dc(_0x139b4f,_0x464825){const _0x4c8439=a44_0x4c84();return a44_0x54dc=function(_0x54dcd9,_0x4083e3){_0x54dcd9=_0x54dcd9-0x1b2;let _0x4c1253=_0x4c8439[_0x54dcd9];return _0x4c1253;},a44_0x54dc(_0x139b4f,_0x464825);}class LoggerService{constructor(){const _0x3c698c=a44_0x1e5609;this[_0x3c698c(0x1f6)]=path_1[_0x3c698c(0x1c0)][_0x3c698c(0x202)](process['cwd'](),_0x3c698c(0x1d2)),this[_0x3c698c(0x1dd)]();}['ensureLogsDirectory'](){const _0x2e1f8c=a44_0x1e5609;!fs_1[_0x2e1f8c(0x1c0)][_0x2e1f8c(0x1bd)](this[_0x2e1f8c(0x1f6)])&&(fs_1['default']['mkdirSync'](this['logsDir'],{'recursive':!![]}),console[_0x2e1f8c(0x1b9)](_0x2e1f8c(0x1b4)+this[_0x2e1f8c(0x1f6)]));}[a44_0x1e5609(0x1bb)](_0x90141f){const _0xc70dd7=a44_0x1e5609,_0x1536ca=new Date()[_0xc70dd7(0x1d3)]()[_0xc70dd7(0x1b8)]('T')[0x0];return path_1[_0xc70dd7(0x1c0)][_0xc70dd7(0x202)](this['logsDir'],_0x90141f+'_'+_0x1536ca+_0xc70dd7(0x1ef));}[a44_0x1e5609(0x1cc)](_0x12047d,_0x59a4b0){const _0x18590f=a44_0x1e5609;try{const _0x5056e7=new Date()['toISOString'](),_0x5e19f6={'timestamp':_0x5056e7,..._0x59a4b0},_0x309aca=JSON[_0x18590f(0x1e4)](_0x5e19f6)+'\x0a',_0x2b2927=this[_0x18590f(0x1bb)](_0x12047d);fs_1[_0x18590f(0x1c0)][_0x18590f(0x1ff)](_0x2b2927,_0x309aca,_0x18590f(0x1f4));}catch(_0x311342){console[_0x18590f(0x1dc)](_0x18590f(0x205)+_0x12047d+_0x18590f(0x1c3),_0x311342);}}['logWhiteDomainRequest'](_0x431c9c,_0x3ee540,_0x9a90b8,_0x37c714){const _0x561b51=a44_0x1e5609;this['writeLog'](_0x561b51(0x1b2),{'type':_0x561b51(0x1be),'gateway':_0x431c9c,'endpoint':_0x3ee540,'method':_0x9a90b8,'data':_0x37c714});}['logWhiteDomainResponse'](_0x1d8eb8,_0x162015,_0x5591ae,_0xcaf4fa,_0xd726c5){const _0x1d0177=a44_0x1e5609;this[_0x1d0177(0x1cc)](_0x1d0177(0x1db),{'type':_0x1d0177(0x1ed),'gateway':_0x1d8eb8,'endpoint':_0x162015,'status':_0x5591ae,'responseTime':_0xd726c5,'data':_0xcaf4fa});}[a44_0x1e5609(0x1e3)](_0x528ee2,_0x3e8a31,_0x1ae37c){const _0x358bd3=a44_0x1e5609;this[_0x358bd3(0x1cc)](_0x358bd3(0x1f9),{'type':'ERROR','gateway':_0x528ee2,'endpoint':_0x3e8a31,'error':_0x1ae37c instanceof Error?{'message':_0x1ae37c[_0x358bd3(0x1e6)],'stack':_0x1ae37c[_0x358bd3(0x1b5)]}:_0x1ae37c});}[a44_0x1e5609(0x1f3)](_0x5a6a8f,_0x4d9a60,_0xce8c6b){const _0x1102f9=a44_0x1e5609;this[_0x1102f9(0x1cc)](_0x1102f9(0x1bf),{'type':'WEBHOOK_RECEIVED','gateway':_0x5a6a8f,'headers':_0xce8c6b,'data':_0x4d9a60});}[a44_0x1e5609(0x1eb)](_0x36b722,_0x304115,_0xd243be,_0xe82a66,_0x3fccda){const _0x2096e7=a44_0x1e5609;this[_0x2096e7(0x1cc)](_0x2096e7(0x1d4),{'type':_0x2096e7(0x1d5),'gateway':_0x36b722,'paymentId':_0x304115,'oldStatus':_0xd243be,'newStatus':_0xe82a66,'originalData':_0x3fccda});}[a44_0x1e5609(0x1c6)](_0x5861b8,_0x415fb0,_0x237d82){const _0x3f5126=a44_0x1e5609;this[_0x3f5126(0x1cc)](_0x3f5126(0x1d0),{'type':_0x3f5126(0x200),'gateway':_0x5861b8,'error':_0x415fb0 instanceof Error?{'message':_0x415fb0[_0x3f5126(0x1e6)],'stack':_0x415fb0[_0x3f5126(0x1b5)]}:_0x415fb0,'originalData':_0x237d82});}[a44_0x1e5609(0x1f8)](_0x5cddff,_0x5917b4,_0x591774,_0x2666bc,_0x248a8d,_0x3e40dd){const _0x29b235=a44_0x1e5609;this[_0x29b235(0x1cc)](_0x29b235(0x1e2),{'type':_0x29b235(0x1da),'shopId':_0x5cddff,'webhookUrl':_0x5917b4,'event':_0x591774,'status':_0x2666bc,'responseTime':_0x248a8d,'payload':_0x3e40dd});}[a44_0x1e5609(0x1ba)](_0xdccbe7,_0x3e3054,_0x44eed8,_0x4c5102,_0x1ae35e){const _0x3c489a=a44_0x1e5609;this[_0x3c489a(0x1cc)](_0x3c489a(0x1cf),{'type':_0x3c489a(0x1e9),'shopId':_0xdccbe7,'webhookUrl':_0x3e3054,'event':_0x44eed8,'error':_0x4c5102 instanceof Error?{'message':_0x4c5102[_0x3c489a(0x1e6)],'stack':_0x4c5102['stack']}:_0x4c5102,'payload':_0x1ae35e});}[a44_0x1e5609(0x1b3)](_0x1e7fe7,_0x21b5b3,_0x38d21d,_0x3d8204,_0x520abc){const _0x26723e=a44_0x1e5609;this[_0x26723e(0x1cc)](_0x26723e(0x1c5),{'type':'PAYMENT_CREATED','gateway':_0x1e7fe7,'paymentId':_0x21b5b3,'shopId':_0x38d21d,'amount':_0x3d8204,'currency':_0x520abc});}[a44_0x1e5609(0x203)](_0x21abd8,_0x1a7cdd,_0x4f1812,_0x214f01,_0x1ee70d){const _0x403769=a44_0x1e5609;this[_0x403769(0x1cc)](_0x403769(0x206),{'type':_0x403769(0x1fb),'endpoint':_0x21abd8,'method':_0x1a7cdd,'userId':_0x4f1812,'userRole':_0x214f01,'requestData':_0x1ee70d});}[a44_0x1e5609(0x1c4)](){const _0x88f72=a44_0x1e5609;try{const _0x4ec208=fs_1[_0x88f72(0x1c0)]['readdirSync'](this[_0x88f72(0x1f6)]),_0x213fde=_0x4ec208[_0x88f72(0x1f5)](_0x3f3546=>_0x3f3546[_0x88f72(0x1ec)](_0x88f72(0x1ef))),_0xdc08ab=[...new Set(_0x213fde[_0x88f72(0x1fa)](_0x369447=>_0x369447[_0x88f72(0x1b8)]('_')[0x0]))],_0x22fa04=_0x213fde[_0x88f72(0x1fa)](_0x532e21=>{const _0x226558=_0x88f72,_0x202adf=path_1[_0x226558(0x1c0)]['join'](this['logsDir'],_0x532e21),_0x25cb24=fs_1[_0x226558(0x1c0)][_0x226558(0x1d7)](_0x202adf),[_0x21423c,_0x6732ea]=_0x532e21[_0x226558(0x1b7)](_0x226558(0x1ef),'')[_0x226558(0x1b8)]('_');return{'type':_0x21423c,'date':_0x6732ea,'size':_0x25cb24[_0x226558(0x1d8)]};})[_0x88f72(0x1c2)]((_0x487d08,_0x5ee1e8)=>_0x5ee1e8[_0x88f72(0x1c1)][_0x88f72(0x1c7)](_0x487d08[_0x88f72(0x1c1)]));return{'totalFiles':_0x213fde[_0x88f72(0x1ea)],'logTypes':_0xdc08ab,'latestLogs':_0x22fa04[_0x88f72(0x1e1)](0x0,0xa)};}catch(_0x169473){return console[_0x88f72(0x1dc)](_0x88f72(0x1e7),_0x169473),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x43674c=0x1e){const _0x958c58=a44_0x1e5609;try{const _0x8a0fdf=fs_1[_0x958c58(0x1c0)][_0x958c58(0x1ce)](this[_0x958c58(0x1f6)]),_0x57df55=new Date();_0x57df55[_0x958c58(0x1e0)](_0x57df55[_0x958c58(0x1f0)]()-_0x43674c);let _0x114dcb=0x0;_0x8a0fdf[_0x958c58(0x1c8)](_0x231b71=>{const _0x3f8162=_0x958c58;if(!_0x231b71[_0x3f8162(0x1ec)](_0x3f8162(0x1ef)))return;const _0x188a74=path_1[_0x3f8162(0x1c0)][_0x3f8162(0x202)](this[_0x3f8162(0x1f6)],_0x231b71),_0x42fb9b=fs_1[_0x3f8162(0x1c0)][_0x3f8162(0x1d7)](_0x188a74);_0x42fb9b[_0x3f8162(0x1fc)]<_0x57df55&&(fs_1['default'][_0x3f8162(0x1f2)](_0x188a74),_0x114dcb++,console[_0x3f8162(0x1b9)](_0x3f8162(0x204)+_0x231b71));}),console[_0x958c58(0x1b9)](_0x958c58(0x201)+_0x114dcb+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x43674c+_0x958c58(0x1cb));}catch(_0xe42f13){console[_0x958c58(0x1dc)](_0x958c58(0x1f7),_0xe42f13);}}}exports[a44_0x1e5609(0x1fe)]=LoggerService,exports[a44_0x1e5609(0x1c9)]=new LoggerService();