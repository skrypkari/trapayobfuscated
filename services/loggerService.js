'use strict';const a53_0x2d46d3=a53_0xcdf5;function a53_0xcdf5(_0x3af556,_0x3925cb){const _0x331afc=a53_0x331a();return a53_0xcdf5=function(_0xcdf5dc,_0x1dbcad){_0xcdf5dc=_0xcdf5dc-0x76;let _0x3ef8b8=_0x331afc[_0xcdf5dc];return _0x3ef8b8;},a53_0xcdf5(_0x3af556,_0x3925cb);}(function(_0x1c0768,_0x22bda4){const _0x239036=a53_0xcdf5,_0x307f59=_0x1c0768();while(!![]){try{const _0x232c5d=-parseInt(_0x239036(0xad))/0x1*(-parseInt(_0x239036(0xbd))/0x2)+parseInt(_0x239036(0xa2))/0x3*(-parseInt(_0x239036(0xb4))/0x4)+-parseInt(_0x239036(0x9e))/0x5*(-parseInt(_0x239036(0xba))/0x6)+parseInt(_0x239036(0x8e))/0x7+parseInt(_0x239036(0x85))/0x8*(parseInt(_0x239036(0x7b))/0x9)+-parseInt(_0x239036(0x84))/0xa*(-parseInt(_0x239036(0xb6))/0xb)+-parseInt(_0x239036(0xb0))/0xc*(parseInt(_0x239036(0x81))/0xd);if(_0x232c5d===_0x22bda4)break;else _0x307f59['push'](_0x307f59['shift']());}catch(_0x4bbe42){_0x307f59['push'](_0x307f59['shift']());}}}(a53_0x331a,0x6225a));var __importDefault=this&&this['__importDefault']||function(_0x450c93){const _0x206204=a53_0xcdf5;return _0x450c93&&_0x450c93[_0x206204(0xa9)]?_0x450c93:{'default':_0x450c93};};Object[a53_0x2d46d3(0x83)](exports,'__esModule',{'value':!![]}),exports['loggerService']=exports[a53_0x2d46d3(0xb7)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x2d46d3(0xc3)));function a53_0x331a(){const _0x32ce01=['localeCompare','white_domain_requests','78ecLxyY','statSync','logWhiteDomainResponse','2sWeSTu','webhooks_errors','date','readdirSync','stringify','Failed\x20to\x20get\x20log\x20stats:','path','PAYMENT_CREATED','logShopWebhookError','log','writeLog','logWebhookReceived','replace','cointopay_errors','size','message','853029RPBcIS','Failed\x20to\x20clean\x20old\x20logs:','shop_webhooks_sent','unlinkSync','COINTOPAY_STATUS_CHANGE','WEBHOOK_ERROR','1758679KFQHjQ','logShopWebhookSent','defineProperty','150ssJMsO','40ThADrY','filter','default','logCoinToPayStatus','.log','api_calls','utf8','cointopay_status_changes','\x20days)','5609695lDkhBB','forEach','existsSync','WEBHOOK_PROCESSED','logCoinToPayError','toISOString','logPaymentCreated','logWebhookProcessed','error','webhooks_received','cwd','SHOP_WEBHOOK_SENT','ensureLogsDirectory','COINTOPAY_ERROR','split','REQUEST','143195httRiP','white_domain_errors','length','getLogStats','3FfMFTd','logApiCall','join','\x20old\x20log\x20files\x20(older\x20than\x20','sort','slice','mkdirSync','__esModule','map','getDate','logWhiteDomainRequest','131135ZnSuCs','WEBHOOK_RECEIVED','SHOP_WEBHOOK_ERROR','144XhKEnD','RESPONSE','ERROR','logsDir','544804MmRZjU','getLogFileName','280775WZPodf','LoggerService'];a53_0x331a=function(){return _0x32ce01;};return a53_0x331a();}class LoggerService{constructor(){const _0x2a8f97=a53_0x2d46d3;this['logsDir']=path_1[_0x2a8f97(0x87)][_0x2a8f97(0xa4)](process[_0x2a8f97(0x98)](),'logs'),this['ensureLogsDirectory']();}[a53_0x2d46d3(0x9a)](){const _0x86b1ba=a53_0x2d46d3;!fs_1[_0x86b1ba(0x87)][_0x86b1ba(0x90)](this[_0x86b1ba(0xb3)])&&(fs_1['default'][_0x86b1ba(0xa8)](this[_0x86b1ba(0xb3)],{'recursive':!![]}),console[_0x86b1ba(0xc6)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x86b1ba(0xb3)]));}[a53_0x2d46d3(0xb5)](_0x26945b){const _0x318a22=a53_0x2d46d3,_0x128e83=new Date()[_0x318a22(0x93)]()[_0x318a22(0x9c)]('T')[0x0];return path_1[_0x318a22(0x87)][_0x318a22(0xa4)](this['logsDir'],_0x26945b+'_'+_0x128e83+_0x318a22(0x89));}[a53_0x2d46d3(0xc7)](_0x88248f,_0xa51e94){const _0x9e1c1d=a53_0x2d46d3;try{const _0x57ce37=new Date()[_0x9e1c1d(0x93)](),_0x2a876f={'timestamp':_0x57ce37,..._0xa51e94},_0x3e106c=JSON[_0x9e1c1d(0xc1)](_0x2a876f)+'\x0a',_0x53c101=this['getLogFileName'](_0x88248f);fs_1['default']['appendFileSync'](_0x53c101,_0x3e106c,_0x9e1c1d(0x8b));}catch(_0x5778ad){console[_0x9e1c1d(0x96)]('Failed\x20to\x20write\x20'+_0x88248f+'\x20log:',_0x5778ad);}}[a53_0x2d46d3(0xac)](_0x3f6cb7,_0x5d424,_0x327694,_0x4c4241){const _0x3996cd=a53_0x2d46d3;this['writeLog'](_0x3996cd(0xb9),{'type':_0x3996cd(0x9d),'gateway':_0x3f6cb7,'endpoint':_0x5d424,'method':_0x327694,'data':_0x4c4241});}[a53_0x2d46d3(0xbc)](_0x91dd4e,_0x3b4fb3,_0x419ab9,_0x128a45,_0x4a192d){const _0x34c25e=a53_0x2d46d3;this['writeLog']('white_domain_responses',{'type':_0x34c25e(0xb1),'gateway':_0x91dd4e,'endpoint':_0x3b4fb3,'status':_0x419ab9,'responseTime':_0x4a192d,'data':_0x128a45});}['logWhiteDomainError'](_0x298fda,_0x3d3528,_0x48a1b0){const _0x3d94df=a53_0x2d46d3;this['writeLog'](_0x3d94df(0x9f),{'type':_0x3d94df(0xb2),'gateway':_0x298fda,'endpoint':_0x3d3528,'error':_0x48a1b0 instanceof Error?{'message':_0x48a1b0[_0x3d94df(0x7a)],'stack':_0x48a1b0['stack']}:_0x48a1b0});}[a53_0x2d46d3(0x76)](_0x3c1776,_0x5f28af,_0x195cf7){const _0x97e18e=a53_0x2d46d3;this[_0x97e18e(0xc7)](_0x97e18e(0x97),{'type':_0x97e18e(0xae),'gateway':_0x3c1776,'headers':_0x195cf7,'data':_0x5f28af});}[a53_0x2d46d3(0x95)](_0x59dc7f,_0x27bf68,_0x4ce474,_0x38595d,_0xf150ce){const _0x17028a=a53_0x2d46d3;this[_0x17028a(0xc7)]('webhooks_processed',{'type':_0x17028a(0x91),'gateway':_0x59dc7f,'paymentId':_0x27bf68,'oldStatus':_0x4ce474,'newStatus':_0x38595d,'originalData':_0xf150ce});}['logWebhookError'](_0x2cdb64,_0x146d36,_0x4e7a92){const _0x2a96f0=a53_0x2d46d3;this[_0x2a96f0(0xc7)](_0x2a96f0(0xbe),{'type':_0x2a96f0(0x80),'gateway':_0x2cdb64,'error':_0x146d36 instanceof Error?{'message':_0x146d36[_0x2a96f0(0x7a)],'stack':_0x146d36['stack']}:_0x146d36,'originalData':_0x4e7a92});}[a53_0x2d46d3(0x88)](_0x4557d7){const _0x1815e1=a53_0x2d46d3;this[_0x1815e1(0xc7)](_0x1815e1(0x8c),{'type':_0x1815e1(0x7f),..._0x4557d7});}[a53_0x2d46d3(0x92)](_0xfc6f42){const _0x27a90f=a53_0x2d46d3;this[_0x27a90f(0xc7)](_0x27a90f(0x78),{'type':_0x27a90f(0x9b),..._0xfc6f42});}[a53_0x2d46d3(0x82)](_0x25a416,_0x1c4834,_0x398ccf,_0x56a1a4,_0x218361,_0x1c0459){const _0x4c68af=a53_0x2d46d3;this[_0x4c68af(0xc7)](_0x4c68af(0x7d),{'type':_0x4c68af(0x99),'shopId':_0x25a416,'webhookUrl':_0x1c4834,'event':_0x398ccf,'status':_0x56a1a4,'responseTime':_0x218361,'payload':_0x1c0459});}[a53_0x2d46d3(0xc5)](_0x53a54f,_0x59ff57,_0xad686,_0x5bd3ed,_0x86d867){const _0x19e727=a53_0x2d46d3;this[_0x19e727(0xc7)]('shop_webhooks_errors',{'type':_0x19e727(0xaf),'shopId':_0x53a54f,'webhookUrl':_0x59ff57,'event':_0xad686,'error':_0x5bd3ed instanceof Error?{'message':_0x5bd3ed[_0x19e727(0x7a)],'stack':_0x5bd3ed['stack']}:_0x5bd3ed,'payload':_0x86d867});}[a53_0x2d46d3(0x94)](_0xb01217,_0x231d98,_0x51d58c,_0x339369,_0x575251){const _0x2ddb13=a53_0x2d46d3;this[_0x2ddb13(0xc7)]('payments_created',{'type':_0x2ddb13(0xc4),'gateway':_0xb01217,'paymentId':_0x231d98,'shopId':_0x51d58c,'amount':_0x339369,'currency':_0x575251});}[a53_0x2d46d3(0xa3)](_0x4c2177,_0x2c5f84,_0x1b92e0,_0x2b7395,_0x51183a){const _0x27e1a1=a53_0x2d46d3;this[_0x27e1a1(0xc7)](_0x27e1a1(0x8a),{'type':'API_CALL','endpoint':_0x4c2177,'method':_0x2c5f84,'userId':_0x1b92e0,'userRole':_0x2b7395,'requestData':_0x51183a});}[a53_0x2d46d3(0xa1)](){const _0x1196eb=a53_0x2d46d3;try{const _0x2b3895=fs_1[_0x1196eb(0x87)][_0x1196eb(0xc0)](this[_0x1196eb(0xb3)]),_0xbadcf8=_0x2b3895[_0x1196eb(0x86)](_0x2a0081=>_0x2a0081['endsWith'](_0x1196eb(0x89))),_0x370044=[...new Set(_0xbadcf8[_0x1196eb(0xaa)](_0x24ae77=>_0x24ae77[_0x1196eb(0x9c)]('_')[0x0]))],_0x4d40c0=_0xbadcf8[_0x1196eb(0xaa)](_0x1f2243=>{const _0xf94e21=_0x1196eb,_0x369b74=path_1['default'][_0xf94e21(0xa4)](this[_0xf94e21(0xb3)],_0x1f2243),_0x499f49=fs_1[_0xf94e21(0x87)][_0xf94e21(0xbb)](_0x369b74),[_0x52f0f1,_0x49037d]=_0x1f2243[_0xf94e21(0x77)](_0xf94e21(0x89),'')[_0xf94e21(0x9c)]('_');return{'type':_0x52f0f1,'date':_0x49037d,'size':_0x499f49[_0xf94e21(0x79)]};})[_0x1196eb(0xa6)]((_0x2f8d62,_0x4cb045)=>_0x4cb045[_0x1196eb(0xbf)][_0x1196eb(0xb8)](_0x2f8d62['date']));return{'totalFiles':_0xbadcf8[_0x1196eb(0xa0)],'logTypes':_0x370044,'latestLogs':_0x4d40c0[_0x1196eb(0xa7)](0x0,0xa)};}catch(_0x3205b5){return console[_0x1196eb(0x96)](_0x1196eb(0xc2),_0x3205b5),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x17326a=0x1e){const _0xb4fdc4=a53_0x2d46d3;try{const _0x4e9039=fs_1[_0xb4fdc4(0x87)][_0xb4fdc4(0xc0)](this['logsDir']),_0x3ff444=new Date();_0x3ff444['setDate'](_0x3ff444[_0xb4fdc4(0xab)]()-_0x17326a);let _0x32a836=0x0;_0x4e9039[_0xb4fdc4(0x8f)](_0x2244de=>{const _0x3e4dd8=_0xb4fdc4;if(!_0x2244de['endsWith'](_0x3e4dd8(0x89)))return;const _0x3c1e8b=path_1[_0x3e4dd8(0x87)][_0x3e4dd8(0xa4)](this[_0x3e4dd8(0xb3)],_0x2244de),_0x5673ed=fs_1[_0x3e4dd8(0x87)][_0x3e4dd8(0xbb)](_0x3c1e8b);_0x5673ed['mtime']<_0x3ff444&&(fs_1[_0x3e4dd8(0x87)][_0x3e4dd8(0x7e)](_0x3c1e8b),_0x32a836++,console[_0x3e4dd8(0xc6)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x2244de));}),console[_0xb4fdc4(0xc6)]('🧹\x20Cleaned\x20'+_0x32a836+_0xb4fdc4(0xa5)+_0x17326a+_0xb4fdc4(0x8d));}catch(_0x296290){console[_0xb4fdc4(0x96)](_0xb4fdc4(0x7c),_0x296290);}}}exports[a53_0x2d46d3(0xb7)]=LoggerService,exports['loggerService']=new LoggerService();