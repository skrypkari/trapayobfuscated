'use strict';const a51_0x79eb35=a51_0x3bd2;(function(_0x389034,_0x20df00){const _0x35b7e3=a51_0x3bd2,_0x51e89c=_0x389034();while(!![]){try{const _0x538e57=-parseInt(_0x35b7e3(0x10f))/0x1+-parseInt(_0x35b7e3(0x12e))/0x2+parseInt(_0x35b7e3(0x122))/0x3+-parseInt(_0x35b7e3(0x15d))/0x4+parseInt(_0x35b7e3(0x115))/0x5+parseInt(_0x35b7e3(0x127))/0x6*(parseInt(_0x35b7e3(0x128))/0x7)+parseInt(_0x35b7e3(0x150))/0x8;if(_0x538e57===_0x20df00)break;else _0x51e89c['push'](_0x51e89c['shift']());}catch(_0x5bc3bd){_0x51e89c['push'](_0x51e89c['shift']());}}}(a51_0x18a1,0x5f14a));var __importDefault=this&&this[a51_0x79eb35(0x158)]||function(_0x2746b0){return _0x2746b0&&_0x2746b0['__esModule']?_0x2746b0:{'default':_0x2746b0};};Object[a51_0x79eb35(0x153)](exports,a51_0x79eb35(0x110),{'value':!![]}),exports['loggerService']=exports[a51_0x79eb35(0x10e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0xec90e1=a51_0x79eb35;this['logsDir']=path_1['default']['join'](process[_0xec90e1(0x145)](),_0xec90e1(0x13a)),this[_0xec90e1(0x15b)]();}['ensureLogsDirectory'](){const _0x1c2632=a51_0x79eb35;!fs_1[_0x1c2632(0x123)][_0x1c2632(0x136)](this[_0x1c2632(0x12a)])&&(fs_1[_0x1c2632(0x123)][_0x1c2632(0x14f)](this[_0x1c2632(0x12a)],{'recursive':!![]}),console['log'](_0x1c2632(0x118)+this['logsDir']));}[a51_0x79eb35(0x14d)](_0x1a4bc5){const _0x2f993b=a51_0x79eb35,_0x71cd3=new Date()[_0x2f993b(0x119)]()[_0x2f993b(0x157)]('T')[0x0];return path_1[_0x2f993b(0x123)][_0x2f993b(0x10d)](this['logsDir'],_0x1a4bc5+'_'+_0x71cd3+'.log');}['writeLog'](_0x3000ba,_0x1fdb20){const _0x44f404=a51_0x79eb35;try{const _0x44c926=new Date()[_0x44f404(0x119)](),_0x37ff7a={'timestamp':_0x44c926,..._0x1fdb20},_0x5637d1=JSON[_0x44f404(0x140)](_0x37ff7a)+'\x0a',_0x397f3f=this[_0x44f404(0x14d)](_0x3000ba);fs_1[_0x44f404(0x123)][_0x44f404(0x13f)](_0x397f3f,_0x5637d1,_0x44f404(0x156));}catch(_0x2968fb){console[_0x44f404(0x126)](_0x44f404(0x12f)+_0x3000ba+'\x20log:',_0x2968fb);}}[a51_0x79eb35(0x14a)](_0xae036a,_0x14f552,_0x5d5307,_0x13f0cf){const _0xfb4462=a51_0x79eb35;this[_0xfb4462(0x11d)](_0xfb4462(0x149),{'type':_0xfb4462(0x137),'gateway':_0xae036a,'endpoint':_0x14f552,'method':_0x5d5307,'data':_0x13f0cf});}[a51_0x79eb35(0x121)](_0xc0f80e,_0xd69837,_0x5218b3,_0x224dd5,_0x238601){const _0x56ea96=a51_0x79eb35;this['writeLog']('white_domain_responses',{'type':_0x56ea96(0x12b),'gateway':_0xc0f80e,'endpoint':_0xd69837,'status':_0x5218b3,'responseTime':_0x238601,'data':_0x224dd5});}[a51_0x79eb35(0x14e)](_0x4bf2a5,_0x5c8c9c,_0x43775a){const _0x313d83=a51_0x79eb35;this[_0x313d83(0x11d)]('white_domain_errors',{'type':'ERROR','gateway':_0x4bf2a5,'endpoint':_0x5c8c9c,'error':_0x43775a instanceof Error?{'message':_0x43775a[_0x313d83(0x139)],'stack':_0x43775a['stack']}:_0x43775a});}[a51_0x79eb35(0x14c)](_0x367791,_0x1389df,_0x1ec10d){const _0x137b7c=a51_0x79eb35;this[_0x137b7c(0x11d)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x367791,'headers':_0x1ec10d,'data':_0x1389df});}[a51_0x79eb35(0x132)](_0x190f24,_0x4878ab,_0x16126a,_0x73b6d1,_0xd00fe6){const _0x27437b=a51_0x79eb35;this['writeLog'](_0x27437b(0x148),{'type':_0x27437b(0x124),'gateway':_0x190f24,'paymentId':_0x4878ab,'oldStatus':_0x16126a,'newStatus':_0x73b6d1,'originalData':_0xd00fe6});}['logWebhookError'](_0x5d968c,_0x4f594a,_0x4c461b){const _0x23ee1d=a51_0x79eb35;this['writeLog'](_0x23ee1d(0x125),{'type':_0x23ee1d(0x133),'gateway':_0x5d968c,'error':_0x4f594a instanceof Error?{'message':_0x4f594a[_0x23ee1d(0x139)],'stack':_0x4f594a['stack']}:_0x4f594a,'originalData':_0x4c461b});}[a51_0x79eb35(0x112)](_0x2a62fb){const _0xa03ed0=a51_0x79eb35;this[_0xa03ed0(0x11d)]('cointopay_status_changes',{'type':_0xa03ed0(0x146),..._0x2a62fb});}[a51_0x79eb35(0x135)](_0x459882){const _0x4b8e62=a51_0x79eb35;this[_0x4b8e62(0x11d)](_0x4b8e62(0x151),{'type':_0x4b8e62(0x147),..._0x459882});}[a51_0x79eb35(0x11e)](_0x1f14b5,_0x3e3aa8,_0x38de16,_0x1f358f,_0x55876e,_0x370985){const _0x5b93a0=a51_0x79eb35;this['writeLog'](_0x5b93a0(0x114),{'type':_0x5b93a0(0x15e),'shopId':_0x1f14b5,'webhookUrl':_0x3e3aa8,'event':_0x38de16,'status':_0x1f358f,'responseTime':_0x55876e,'payload':_0x370985});}[a51_0x79eb35(0x14b)](_0x26cfb5,_0x111a3a,_0x36b8f5,_0x3bc305,_0x53df5a){const _0x2aaf91=a51_0x79eb35;this['writeLog'](_0x2aaf91(0x134),{'type':_0x2aaf91(0x120),'shopId':_0x26cfb5,'webhookUrl':_0x111a3a,'event':_0x36b8f5,'error':_0x3bc305 instanceof Error?{'message':_0x3bc305['message'],'stack':_0x3bc305[_0x2aaf91(0x138)]}:_0x3bc305,'payload':_0x53df5a});}[a51_0x79eb35(0x13e)](_0x3ff668,_0x4c4846,_0x1abe62,_0x486dbc,_0x22f098){const _0xc6c3c9=a51_0x79eb35;this['writeLog'](_0xc6c3c9(0x130),{'type':_0xc6c3c9(0x15f),'gateway':_0x3ff668,'paymentId':_0x4c4846,'shopId':_0x1abe62,'amount':_0x486dbc,'currency':_0x22f098});}[a51_0x79eb35(0x131)](_0x263f6a,_0x22da7a,_0x46e5b8,_0x1c5dc5,_0x569dac){const _0xd6a7f8=a51_0x79eb35;this['writeLog'](_0xd6a7f8(0x143),{'type':'API_CALL','endpoint':_0x263f6a,'method':_0x22da7a,'userId':_0x46e5b8,'userRole':_0x1c5dc5,'requestData':_0x569dac});}[a51_0x79eb35(0x159)](){const _0x3012c3=a51_0x79eb35;try{const _0x5e67c9=fs_1['default'][_0x3012c3(0x117)](this[_0x3012c3(0x12a)]),_0x32c4e9=_0x5e67c9['filter'](_0x496f50=>_0x496f50[_0x3012c3(0x154)](_0x3012c3(0x116))),_0x3ae936=[...new Set(_0x32c4e9[_0x3012c3(0x111)](_0x3fe513=>_0x3fe513[_0x3012c3(0x157)]('_')[0x0]))],_0x25e899=_0x32c4e9[_0x3012c3(0x111)](_0x5ed88c=>{const _0x3087b6=_0x3012c3,_0x401587=path_1[_0x3087b6(0x123)][_0x3087b6(0x10d)](this[_0x3087b6(0x12a)],_0x5ed88c),_0x59383b=fs_1[_0x3087b6(0x123)][_0x3087b6(0x15c)](_0x401587),[_0x5ca71c,_0x2ec787]=_0x5ed88c[_0x3087b6(0x155)](_0x3087b6(0x116),'')[_0x3087b6(0x157)]('_');return{'type':_0x5ca71c,'date':_0x2ec787,'size':_0x59383b[_0x3087b6(0x13d)]};})[_0x3012c3(0x13b)]((_0x2ca603,_0x5ac88e)=>_0x5ac88e[_0x3012c3(0x11c)][_0x3012c3(0x11f)](_0x2ca603[_0x3012c3(0x11c)]));return{'totalFiles':_0x32c4e9[_0x3012c3(0x13c)],'logTypes':_0x3ae936,'latestLogs':_0x25e899[_0x3012c3(0x141)](0x0,0xa)};}catch(_0x15d8cf){return console[_0x3012c3(0x126)]('Failed\x20to\x20get\x20log\x20stats:',_0x15d8cf),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x79eb35(0x152)](_0xed057f=0x1e){const _0x358f5c=a51_0x79eb35;try{const _0x4bab95=fs_1[_0x358f5c(0x123)][_0x358f5c(0x117)](this[_0x358f5c(0x12a)]),_0x596d31=new Date();_0x596d31[_0x358f5c(0x12d)](_0x596d31[_0x358f5c(0x144)]()-_0xed057f);let _0x22f207=0x0;_0x4bab95[_0x358f5c(0x142)](_0x2cf926=>{const _0x448445=_0x358f5c;if(!_0x2cf926[_0x448445(0x154)](_0x448445(0x116)))return;const _0xc83e40=path_1[_0x448445(0x123)][_0x448445(0x10d)](this[_0x448445(0x12a)],_0x2cf926),_0x1421f0=fs_1[_0x448445(0x123)][_0x448445(0x15c)](_0xc83e40);_0x1421f0[_0x448445(0x11b)]<_0x596d31&&(fs_1[_0x448445(0x123)]['unlinkSync'](_0xc83e40),_0x22f207++,console[_0x448445(0x15a)](_0x448445(0x11a)+_0x2cf926));}),console[_0x358f5c(0x15a)](_0x358f5c(0x12c)+_0x22f207+_0x358f5c(0x129)+_0xed057f+_0x358f5c(0x113));}catch(_0x292ef4){console[_0x358f5c(0x126)]('Failed\x20to\x20clean\x20old\x20logs:',_0x292ef4);}}}function a51_0x3bd2(_0x29fa42,_0x381eb4){const _0x18a18=a51_0x18a1();return a51_0x3bd2=function(_0x3bd2ad,_0x8c8b38){_0x3bd2ad=_0x3bd2ad-0x10c;let _0x4915a3=_0x18a18[_0x3bd2ad];return _0x4915a3;},a51_0x3bd2(_0x29fa42,_0x381eb4);}function a51_0x18a1(){const _0x150bb4=['join','LoggerService','55258tkuyCX','__esModule','map','logCoinToPayStatus','\x20days)','shop_webhooks_sent','1165575ixZuHW','.log','readdirSync','📁\x20Created\x20logs\x20directory:\x20','toISOString','🗑️\x20Deleted\x20old\x20log\x20file:\x20','mtime','date','writeLog','logShopWebhookSent','localeCompare','SHOP_WEBHOOK_ERROR','logWhiteDomainResponse','1359327GHmfkI','default','WEBHOOK_PROCESSED','webhooks_errors','error','6XCiIcb','330988GNgjLD','\x20old\x20log\x20files\x20(older\x20than\x20','logsDir','RESPONSE','🧹\x20Cleaned\x20','setDate','1543996oHZgzv','Failed\x20to\x20write\x20','payments_created','logApiCall','logWebhookProcessed','WEBHOOK_ERROR','shop_webhooks_errors','logCoinToPayError','existsSync','REQUEST','stack','message','logs','sort','length','size','logPaymentCreated','appendFileSync','stringify','slice','forEach','api_calls','getDate','cwd','COINTOPAY_STATUS_CHANGE','COINTOPAY_ERROR','webhooks_processed','white_domain_requests','logWhiteDomainRequest','logShopWebhookError','logWebhookReceived','getLogFileName','logWhiteDomainError','mkdirSync','3989584FsIdHP','cointopay_errors','cleanOldLogs','defineProperty','endsWith','replace','utf8','split','__importDefault','getLogStats','log','ensureLogsDirectory','statSync','62000ksVPlY','SHOP_WEBHOOK_SENT','PAYMENT_CREATED','loggerService'];a51_0x18a1=function(){return _0x150bb4;};return a51_0x18a1();}exports[a51_0x79eb35(0x10e)]=LoggerService,exports[a51_0x79eb35(0x10c)]=new LoggerService();