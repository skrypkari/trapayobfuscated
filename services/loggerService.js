'use strict';const a71_0x24ed4b=a71_0x4c43;(function(_0x17b44b,_0x29593f){const _0x819a85=a71_0x4c43,_0x51cec2=_0x17b44b();while(!![]){try{const _0x2f8cff=-parseInt(_0x819a85(0x120))/0x1*(parseInt(_0x819a85(0x100))/0x2)+parseInt(_0x819a85(0xf9))/0x3*(parseInt(_0x819a85(0xfb))/0x4)+parseInt(_0x819a85(0x112))/0x5+parseInt(_0x819a85(0xee))/0x6+-parseInt(_0x819a85(0xda))/0x7+parseInt(_0x819a85(0x12c))/0x8+parseInt(_0x819a85(0x108))/0x9;if(_0x2f8cff===_0x29593f)break;else _0x51cec2['push'](_0x51cec2['shift']());}catch(_0x485818){_0x51cec2['push'](_0x51cec2['shift']());}}}(a71_0x1291,0x33d50));var __importDefault=this&&this[a71_0x24ed4b(0xef)]||function(_0x14d71e){const _0x3c1bd0=a71_0x24ed4b;return _0x14d71e&&_0x14d71e[_0x3c1bd0(0xe1)]?_0x14d71e:{'default':_0x14d71e};};function a71_0x1291(){const _0x5c4bc6=['white_domain_requests','LoggerService','WEBHOOK_PROCESSED','PAYMENT_CREATED','__esModule','ERROR','logsDir','date','WEBHOOK_RECEIVED','logPaymentCreated','cointopay_errors','appendFileSync','REQUEST','white_domain_responses','RESPONSE','ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','getDate','1116600bJjUjX','__importDefault','WEBHOOK_ERROR','ðŸ§¹\x20Cleaned\x20','API_CALL','length','mtime','.log','loggerService','webhooks_processed','logCoinToPayStatus','214233UqEMNP','Failed\x20to\x20get\x20log\x20stats:','4qCuQeY','ensureLogsDirectory','forEach','mkdirSync','sort','726178akcZNO','\x20log:','logWhiteDomainError','webhooks_received','log','existsSync','shop_webhooks_errors','\x20old\x20log\x20files\x20(older\x20than\x20','438156OKnlNd','ðŸ“\x20Created\x20logs\x20directory:\x20','join','path','stringify','getLogFileName','logWebhookReceived','cleanOldLogs','Failed\x20to\x20clean\x20old\x20logs:','shop_webhooks_sent','1449350GyJKWH','writeLog','statSync','stack','api_calls','toISOString','payments_created','cwd','size','message','readdirSync','webhooks_errors','SHOP_WEBHOOK_ERROR','map','1WVVyZO','filter','COINTOPAY_STATUS_CHANGE','slice','unlinkSync','defineProperty','logApiCall','cointopay_status_changes','\x20days)','logWebhookError','setDate','logWhiteDomainRequest','1773000vsODLQ','logWhiteDomainResponse','default','endsWith','1696079ufNLnQ','logWebhookProcessed','error'];a71_0x1291=function(){return _0x5c4bc6;};return a71_0x1291();}function a71_0x4c43(_0x12cab5,_0x271278){_0x12cab5=_0x12cab5-0xd9;const _0x1291b9=a71_0x1291();let _0x4c43ee=_0x1291b9[_0x12cab5];return _0x4c43ee;}Object[a71_0x24ed4b(0x125)](exports,'__esModule',{'value':!![]}),exports[a71_0x24ed4b(0xf6)]=exports[a71_0x24ed4b(0xde)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a71_0x24ed4b(0x10b)));class LoggerService{constructor(){const _0xebdd08=a71_0x24ed4b;this[_0xebdd08(0xe3)]=path_1[_0xebdd08(0x12e)]['join'](process[_0xebdd08(0x119)](),'logs'),this[_0xebdd08(0xfc)]();}['ensureLogsDirectory'](){const _0x37605d=a71_0x24ed4b;!fs_1['default'][_0x37605d(0x105)](this[_0x37605d(0xe3)])&&(fs_1[_0x37605d(0x12e)][_0x37605d(0xfe)](this[_0x37605d(0xe3)],{'recursive':!![]}),console[_0x37605d(0x104)](_0x37605d(0x109)+this[_0x37605d(0xe3)]));}['getLogFileName'](_0x4e6942){const _0x2892f0=a71_0x24ed4b,_0x5207a=new Date()[_0x2892f0(0x117)]()['split']('T')[0x0];return path_1[_0x2892f0(0x12e)][_0x2892f0(0x10a)](this[_0x2892f0(0xe3)],_0x4e6942+'_'+_0x5207a+'.log');}[a71_0x24ed4b(0x113)](_0x2318b0,_0x22dcbb){const _0x4d300c=a71_0x24ed4b;try{const _0x4d9825=new Date()['toISOString'](),_0x52b884={'timestamp':_0x4d9825,..._0x22dcbb},_0x38a59b=JSON[_0x4d300c(0x10c)](_0x52b884)+'\x0a',_0x56461d=this[_0x4d300c(0x10d)](_0x2318b0);fs_1[_0x4d300c(0x12e)][_0x4d300c(0xe8)](_0x56461d,_0x38a59b,'utf8');}catch(_0x1aa067){console[_0x4d300c(0xdc)]('Failed\x20to\x20write\x20'+_0x2318b0+_0x4d300c(0x101),_0x1aa067);}}[a71_0x24ed4b(0x12b)](_0x412d10,_0x24297c,_0x513223,_0xbdf322){const _0xf42e76=a71_0x24ed4b;this['writeLog'](_0xf42e76(0xdd),{'type':_0xf42e76(0xe9),'gateway':_0x412d10,'endpoint':_0x24297c,'method':_0x513223,'data':_0xbdf322});}[a71_0x24ed4b(0x12d)](_0x21e98,_0x45ecf1,_0x478855,_0x373cf8,_0x1bbb31){const _0x1546ab=a71_0x24ed4b;this['writeLog'](_0x1546ab(0xea),{'type':_0x1546ab(0xeb),'gateway':_0x21e98,'endpoint':_0x45ecf1,'status':_0x478855,'responseTime':_0x1bbb31,'data':_0x373cf8});}[a71_0x24ed4b(0x102)](_0x93562d,_0x56805c,_0x39e6e9){const _0x46bdc7=a71_0x24ed4b;this[_0x46bdc7(0x113)]('white_domain_errors',{'type':_0x46bdc7(0xe2),'gateway':_0x93562d,'endpoint':_0x56805c,'error':_0x39e6e9 instanceof Error?{'message':_0x39e6e9[_0x46bdc7(0x11b)],'stack':_0x39e6e9[_0x46bdc7(0x115)]}:_0x39e6e9});}[a71_0x24ed4b(0x10e)](_0x578739,_0x5a5f22,_0x691a86){const _0x3ba4b2=a71_0x24ed4b;this[_0x3ba4b2(0x113)](_0x3ba4b2(0x103),{'type':_0x3ba4b2(0xe5),'gateway':_0x578739,'headers':_0x691a86,'data':_0x5a5f22});}[a71_0x24ed4b(0xdb)](_0x165be0,_0x1c9250,_0x572f5f,_0x3efb41,_0x229004){const _0xc0e7a3=a71_0x24ed4b;this[_0xc0e7a3(0x113)](_0xc0e7a3(0xf7),{'type':_0xc0e7a3(0xdf),'gateway':_0x165be0,'paymentId':_0x1c9250,'oldStatus':_0x572f5f,'newStatus':_0x3efb41,'originalData':_0x229004});}[a71_0x24ed4b(0x129)](_0x2bc80f,_0x1d9e17,_0x4fa4c5){const _0x260b99=a71_0x24ed4b;this[_0x260b99(0x113)](_0x260b99(0x11d),{'type':_0x260b99(0xf0),'gateway':_0x2bc80f,'error':_0x1d9e17 instanceof Error?{'message':_0x1d9e17['message'],'stack':_0x1d9e17[_0x260b99(0x115)]}:_0x1d9e17,'originalData':_0x4fa4c5});}[a71_0x24ed4b(0xf8)](_0xba1e72){const _0x7e7afa=a71_0x24ed4b;this[_0x7e7afa(0x113)](_0x7e7afa(0x127),{'type':_0x7e7afa(0x122),..._0xba1e72});}['logCoinToPayError'](_0x4debf3){const _0x5b28f5=a71_0x24ed4b;this[_0x5b28f5(0x113)](_0x5b28f5(0xe7),{'type':'COINTOPAY_ERROR',..._0x4debf3});}['logShopWebhookSent'](_0x6cc51a,_0x2cc2e3,_0x585ba8,_0x363296,_0x32345b,_0x1d03fd){const _0x48fd33=a71_0x24ed4b;this['writeLog'](_0x48fd33(0x111),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x6cc51a,'webhookUrl':_0x2cc2e3,'event':_0x585ba8,'status':_0x363296,'responseTime':_0x32345b,'payload':_0x1d03fd});}['logShopWebhookError'](_0x454ea7,_0x250fb0,_0x6aecb4,_0x632013,_0x3c532f){const _0x28e000=a71_0x24ed4b;this[_0x28e000(0x113)](_0x28e000(0x106),{'type':_0x28e000(0x11e),'shopId':_0x454ea7,'webhookUrl':_0x250fb0,'event':_0x6aecb4,'error':_0x632013 instanceof Error?{'message':_0x632013[_0x28e000(0x11b)],'stack':_0x632013[_0x28e000(0x115)]}:_0x632013,'payload':_0x3c532f});}[a71_0x24ed4b(0xe6)](_0x2cf861,_0x449f5b,_0x31963c,_0x5614a2,_0x475dc8){const _0x4aace8=a71_0x24ed4b;this[_0x4aace8(0x113)](_0x4aace8(0x118),{'type':_0x4aace8(0xe0),'gateway':_0x2cf861,'paymentId':_0x449f5b,'shopId':_0x31963c,'amount':_0x5614a2,'currency':_0x475dc8});}[a71_0x24ed4b(0x126)](_0x2f7833,_0x57d88a,_0x422512,_0x5dc55e,_0x563125){const _0xf456ad=a71_0x24ed4b;this[_0xf456ad(0x113)](_0xf456ad(0x116),{'type':_0xf456ad(0xf2),'endpoint':_0x2f7833,'method':_0x57d88a,'userId':_0x422512,'userRole':_0x5dc55e,'requestData':_0x563125});}['getLogStats'](){const _0xea05ba=a71_0x24ed4b;try{const _0xe9d063=fs_1['default'][_0xea05ba(0x11c)](this['logsDir']),_0x56307f=_0xe9d063[_0xea05ba(0x121)](_0xb12206=>_0xb12206[_0xea05ba(0xd9)](_0xea05ba(0xf5))),_0x42201a=[...new Set(_0x56307f[_0xea05ba(0x11f)](_0x5aa2da=>_0x5aa2da['split']('_')[0x0]))],_0x4c55f5=_0x56307f[_0xea05ba(0x11f)](_0x37b893=>{const _0x218f00=_0xea05ba,_0x338a94=path_1[_0x218f00(0x12e)]['join'](this[_0x218f00(0xe3)],_0x37b893),_0x46dc27=fs_1[_0x218f00(0x12e)][_0x218f00(0x114)](_0x338a94),[_0x2cd38d,_0xbcd82f]=_0x37b893['replace'](_0x218f00(0xf5),'')['split']('_');return{'type':_0x2cd38d,'date':_0xbcd82f,'size':_0x46dc27[_0x218f00(0x11a)]};})[_0xea05ba(0xff)]((_0x2f589d,_0x838282)=>_0x838282[_0xea05ba(0xe4)]['localeCompare'](_0x2f589d['date']));return{'totalFiles':_0x56307f[_0xea05ba(0xf3)],'logTypes':_0x42201a,'latestLogs':_0x4c55f5[_0xea05ba(0x123)](0x0,0xa)};}catch(_0x37db97){return console[_0xea05ba(0xdc)](_0xea05ba(0xfa),_0x37db97),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a71_0x24ed4b(0x10f)](_0x383652=0x1e){const _0x21cf37=a71_0x24ed4b;try{const _0x8a754b=fs_1[_0x21cf37(0x12e)][_0x21cf37(0x11c)](this['logsDir']),_0x3f3ef7=new Date();_0x3f3ef7[_0x21cf37(0x12a)](_0x3f3ef7[_0x21cf37(0xed)]()-_0x383652);let _0x1a1c0f=0x0;_0x8a754b[_0x21cf37(0xfd)](_0x57c650=>{const _0xfd0307=_0x21cf37;if(!_0x57c650['endsWith'](_0xfd0307(0xf5)))return;const _0x318221=path_1['default'][_0xfd0307(0x10a)](this[_0xfd0307(0xe3)],_0x57c650),_0x5a4c01=fs_1['default'][_0xfd0307(0x114)](_0x318221);_0x5a4c01[_0xfd0307(0xf4)]<_0x3f3ef7&&(fs_1['default'][_0xfd0307(0x124)](_0x318221),_0x1a1c0f++,console[_0xfd0307(0x104)](_0xfd0307(0xec)+_0x57c650));}),console[_0x21cf37(0x104)](_0x21cf37(0xf1)+_0x1a1c0f+_0x21cf37(0x107)+_0x383652+_0x21cf37(0x128));}catch(_0x2b81d4){console[_0x21cf37(0xdc)](_0x21cf37(0x110),_0x2b81d4);}}}exports[a71_0x24ed4b(0xde)]=LoggerService,exports[a71_0x24ed4b(0xf6)]=new LoggerService();