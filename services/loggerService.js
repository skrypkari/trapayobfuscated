'use strict';const a67_0xd255b2=a67_0xdaa2;function a67_0xdaa2(_0x4d0535,_0x1f5305){_0x4d0535=_0x4d0535-0x1db;const _0x31ff48=a67_0x31ff();let _0xdaa247=_0x31ff48[_0x4d0535];return _0xdaa247;}function a67_0x31ff(){const _0x57d7b7=['setDate','logWebhookReceived','logCoinToPayError','join','appendFileSync','toISOString','mtime','logWebhookError','logApiCall','path','logPaymentCreated','REQUEST','5843133KuJxhg','default','COINTOPAY_STATUS_CHANGE','defineProperty','forEach','stack','logShopWebhookSent','utf8','date','logWhiteDomainError','split','ensureLogsDirectory','WEBHOOK_ERROR','payments_created','cwd','Failed\x20to\x20clean\x20old\x20logs:','RESPONSE','loggerService','mkdirSync','36Nhkwof','shop_webhooks_sent','getLogStats','length','cleanOldLogs','logsDir','ERROR','white_domain_errors','existsSync','WEBHOOK_PROCESSED','stringify','2229474rvEYjD','__importDefault','LoggerService','statSync','filter','webhooks_errors','white_domain_responses','message','writeLog','replace','API_CALL','sort','167032uqEVCu','shop_webhooks_errors','8118992pMRxEU','readdirSync','WEBHOOK_RECEIVED','\x20log:','__esModule','error','16693150qGQQON','size','7VRkSVR','9400kButGn','2148470PFjmbj','ðŸ“\x20Created\x20logs\x20directory:\x20','.log','log','\x20old\x20log\x20files\x20(older\x20than\x20','Failed\x20to\x20write\x20','17rJfnbc','logShopWebhookError','logWhiteDomainResponse','ðŸ§¹\x20Cleaned\x20'];a67_0x31ff=function(){return _0x57d7b7;};return a67_0x31ff();}(function(_0x362221,_0x3488d9){const _0x1e565f=a67_0xdaa2,_0x109f7b=_0x362221();while(!![]){try{const _0x1f4e73=parseInt(_0x1e565f(0x216))/0x1*(parseInt(_0x1e565f(0x20f))/0x2)+parseInt(_0x1e565f(0x1ed))/0x3*(parseInt(_0x1e565f(0x204))/0x4)+parseInt(_0x1e565f(0x210))/0x5+-parseInt(_0x1e565f(0x1f8))/0x6*(parseInt(_0x1e565f(0x20e))/0x7)+parseInt(_0x1e565f(0x206))/0x8+parseInt(_0x1e565f(0x226))/0x9+-parseInt(_0x1e565f(0x20c))/0xa;if(_0x1f4e73===_0x3488d9)break;else _0x109f7b['push'](_0x109f7b['shift']());}catch(_0x40cb81){_0x109f7b['push'](_0x109f7b['shift']());}}}(a67_0x31ff,0x9ac33));var __importDefault=this&&this[a67_0xd255b2(0x1f9)]||function(_0x237d70){const _0x1012d9=a67_0xd255b2;return _0x237d70&&_0x237d70[_0x1012d9(0x20a)]?_0x237d70:{'default':_0x237d70};};Object[a67_0xd255b2(0x1dd)](exports,a67_0xd255b2(0x20a),{'value':!![]}),exports['loggerService']=exports[a67_0xd255b2(0x1fa)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a67_0xd255b2(0x223)));class LoggerService{constructor(){const _0x1d63ef=a67_0xd255b2;this[_0x1d63ef(0x1f2)]=path_1[_0x1d63ef(0x1db)][_0x1d63ef(0x21d)](process[_0x1d63ef(0x1e8)](),'logs'),this[_0x1d63ef(0x1e5)]();}[a67_0xd255b2(0x1e5)](){const _0x2a3de2=a67_0xd255b2;!fs_1[_0x2a3de2(0x1db)][_0x2a3de2(0x1f5)](this[_0x2a3de2(0x1f2)])&&(fs_1[_0x2a3de2(0x1db)][_0x2a3de2(0x1ec)](this[_0x2a3de2(0x1f2)],{'recursive':!![]}),console[_0x2a3de2(0x213)](_0x2a3de2(0x211)+this[_0x2a3de2(0x1f2)]));}['getLogFileName'](_0x36585a){const _0x559896=a67_0xd255b2,_0x5f26a6=new Date()[_0x559896(0x21f)]()[_0x559896(0x1e4)]('T')[0x0];return path_1['default'][_0x559896(0x21d)](this[_0x559896(0x1f2)],_0x36585a+'_'+_0x5f26a6+_0x559896(0x212));}[a67_0xd255b2(0x200)](_0x1c56c6,_0x2c9ea9){const _0x3715bb=a67_0xd255b2;try{const _0x1e8fa7=new Date()['toISOString'](),_0x494dba={'timestamp':_0x1e8fa7,..._0x2c9ea9},_0x437eb9=JSON[_0x3715bb(0x1f7)](_0x494dba)+'\x0a',_0x1e93e0=this['getLogFileName'](_0x1c56c6);fs_1['default'][_0x3715bb(0x21e)](_0x1e93e0,_0x437eb9,_0x3715bb(0x1e1));}catch(_0x3c425b){console[_0x3715bb(0x20b)](_0x3715bb(0x215)+_0x1c56c6+_0x3715bb(0x209),_0x3c425b);}}['logWhiteDomainRequest'](_0x3c03dc,_0x28bff0,_0x50a620,_0x573d5c){const _0x19712b=a67_0xd255b2;this['writeLog']('white_domain_requests',{'type':_0x19712b(0x225),'gateway':_0x3c03dc,'endpoint':_0x28bff0,'method':_0x50a620,'data':_0x573d5c});}[a67_0xd255b2(0x218)](_0x351afe,_0x1ce34b,_0x4e8d14,_0x1fe0c0,_0x2cb396){const _0x19919b=a67_0xd255b2;this[_0x19919b(0x200)](_0x19919b(0x1fe),{'type':_0x19919b(0x1ea),'gateway':_0x351afe,'endpoint':_0x1ce34b,'status':_0x4e8d14,'responseTime':_0x2cb396,'data':_0x1fe0c0});}[a67_0xd255b2(0x1e3)](_0x16608e,_0x35cdb9,_0x12b9f7){const _0x51d066=a67_0xd255b2;this['writeLog'](_0x51d066(0x1f4),{'type':_0x51d066(0x1f3),'gateway':_0x16608e,'endpoint':_0x35cdb9,'error':_0x12b9f7 instanceof Error?{'message':_0x12b9f7[_0x51d066(0x1ff)],'stack':_0x12b9f7[_0x51d066(0x1df)]}:_0x12b9f7});}[a67_0xd255b2(0x21b)](_0x37fdb8,_0x6578e2,_0x3b300f){const _0x407ae2=a67_0xd255b2;this[_0x407ae2(0x200)]('webhooks_received',{'type':_0x407ae2(0x208),'gateway':_0x37fdb8,'headers':_0x3b300f,'data':_0x6578e2});}['logWebhookProcessed'](_0x1afe73,_0x452cca,_0x419495,_0x318ecd,_0x31e1a5){const _0x5225ad=a67_0xd255b2;this[_0x5225ad(0x200)]('webhooks_processed',{'type':_0x5225ad(0x1f6),'gateway':_0x1afe73,'paymentId':_0x452cca,'oldStatus':_0x419495,'newStatus':_0x318ecd,'originalData':_0x31e1a5});}[a67_0xd255b2(0x221)](_0x5487cc,_0x5a4ffc,_0x196404){const _0x16c5f5=a67_0xd255b2;this['writeLog'](_0x16c5f5(0x1fd),{'type':_0x16c5f5(0x1e6),'gateway':_0x5487cc,'error':_0x5a4ffc instanceof Error?{'message':_0x5a4ffc[_0x16c5f5(0x1ff)],'stack':_0x5a4ffc[_0x16c5f5(0x1df)]}:_0x5a4ffc,'originalData':_0x196404});}['logCoinToPayStatus'](_0x529165){const _0x11f2b1=a67_0xd255b2;this[_0x11f2b1(0x200)]('cointopay_status_changes',{'type':_0x11f2b1(0x1dc),..._0x529165});}[a67_0xd255b2(0x21c)](_0x9b5458){const _0x1a58ef=a67_0xd255b2;this[_0x1a58ef(0x200)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x9b5458});}[a67_0xd255b2(0x1e0)](_0x59aa8d,_0x140095,_0x25dc4a,_0x540b,_0x467df3,_0x14c3da){const _0x54b92d=a67_0xd255b2;this[_0x54b92d(0x200)](_0x54b92d(0x1ee),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x59aa8d,'webhookUrl':_0x140095,'event':_0x25dc4a,'status':_0x540b,'responseTime':_0x467df3,'payload':_0x14c3da});}[a67_0xd255b2(0x217)](_0x289485,_0x3aeb70,_0x55f822,_0x298c40,_0x7bd180){const _0x5ec2dc=a67_0xd255b2;this[_0x5ec2dc(0x200)](_0x5ec2dc(0x205),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x289485,'webhookUrl':_0x3aeb70,'event':_0x55f822,'error':_0x298c40 instanceof Error?{'message':_0x298c40['message'],'stack':_0x298c40['stack']}:_0x298c40,'payload':_0x7bd180});}[a67_0xd255b2(0x224)](_0x128a30,_0x2b49fd,_0x2fc073,_0x9ba7fc,_0x92e673){const _0x462f8d=a67_0xd255b2;this[_0x462f8d(0x200)](_0x462f8d(0x1e7),{'type':'PAYMENT_CREATED','gateway':_0x128a30,'paymentId':_0x2b49fd,'shopId':_0x2fc073,'amount':_0x9ba7fc,'currency':_0x92e673});}[a67_0xd255b2(0x222)](_0x59ac5d,_0x57006d,_0x58521b,_0x4a5ecf,_0x4bde51){const _0xd1f946=a67_0xd255b2;this[_0xd1f946(0x200)]('api_calls',{'type':_0xd1f946(0x202),'endpoint':_0x59ac5d,'method':_0x57006d,'userId':_0x58521b,'userRole':_0x4a5ecf,'requestData':_0x4bde51});}[a67_0xd255b2(0x1ef)](){const _0x49802b=a67_0xd255b2;try{const _0x5961d6=fs_1[_0x49802b(0x1db)][_0x49802b(0x207)](this[_0x49802b(0x1f2)]),_0x214185=_0x5961d6[_0x49802b(0x1fc)](_0x5f56f9=>_0x5f56f9['endsWith'](_0x49802b(0x212))),_0x5f14e9=[...new Set(_0x214185['map'](_0x56b081=>_0x56b081[_0x49802b(0x1e4)]('_')[0x0]))],_0x4e24f4=_0x214185['map'](_0x4af64b=>{const _0x73928f=_0x49802b,_0xb324ad=path_1[_0x73928f(0x1db)]['join'](this[_0x73928f(0x1f2)],_0x4af64b),_0x5f4c23=fs_1[_0x73928f(0x1db)][_0x73928f(0x1fb)](_0xb324ad),[_0x3987ac,_0x2f50fe]=_0x4af64b[_0x73928f(0x201)](_0x73928f(0x212),'')[_0x73928f(0x1e4)]('_');return{'type':_0x3987ac,'date':_0x2f50fe,'size':_0x5f4c23[_0x73928f(0x20d)]};})[_0x49802b(0x203)]((_0x3b94be,_0x31e81a)=>_0x31e81a[_0x49802b(0x1e2)]['localeCompare'](_0x3b94be['date']));return{'totalFiles':_0x214185[_0x49802b(0x1f0)],'logTypes':_0x5f14e9,'latestLogs':_0x4e24f4['slice'](0x0,0xa)};}catch(_0xb7f628){return console[_0x49802b(0x20b)]('Failed\x20to\x20get\x20log\x20stats:',_0xb7f628),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a67_0xd255b2(0x1f1)](_0x612de2=0x1e){const _0x81cca2=a67_0xd255b2;try{const _0x3468f5=fs_1[_0x81cca2(0x1db)][_0x81cca2(0x207)](this[_0x81cca2(0x1f2)]),_0x148477=new Date();_0x148477[_0x81cca2(0x21a)](_0x148477['getDate']()-_0x612de2);let _0x583d37=0x0;_0x3468f5[_0x81cca2(0x1de)](_0x5d9b29=>{const _0x4d8037=_0x81cca2;if(!_0x5d9b29['endsWith']('.log'))return;const _0x137130=path_1['default'][_0x4d8037(0x21d)](this[_0x4d8037(0x1f2)],_0x5d9b29),_0x2944e8=fs_1[_0x4d8037(0x1db)]['statSync'](_0x137130);_0x2944e8[_0x4d8037(0x220)]<_0x148477&&(fs_1[_0x4d8037(0x1db)]['unlinkSync'](_0x137130),_0x583d37++,console[_0x4d8037(0x213)]('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x5d9b29));}),console[_0x81cca2(0x213)](_0x81cca2(0x219)+_0x583d37+_0x81cca2(0x214)+_0x612de2+'\x20days)');}catch(_0x26f0ac){console[_0x81cca2(0x20b)](_0x81cca2(0x1e9),_0x26f0ac);}}}exports['LoggerService']=LoggerService,exports[a67_0xd255b2(0x1eb)]=new LoggerService();