'use strict';const a49_0x270303=a49_0x4182;function a49_0x5a49(){const _0x54daa4=['ERROR','COINTOPAY_STATUS_CHANGE','webhooks_processed','logs','ensureLogsDirectory','getLogStats','utf8','split','cointopay_status_changes','WEBHOOK_PROCESSED','forEach','stringify','white_domain_errors','__importDefault','white_domain_responses','RESPONSE','size','LoggerService','API_CALL','148JnfSur','REQUEST','loggerService','.log','defineProperty','unlinkSync','cleanOldLogs','writeLog','appendFileSync','5030286ICWJqk','webhooks_errors','53256gKrlVe','491saVFEl','logsDir','\x20old\x20log\x20files\x20(older\x20than\x20','cwd','cointopay_errors','410545JTCVfc','join','webhooks_received','replace','stack','logWhiteDomainError','mkdirSync','713904sskbst','default','date','44YcyCOO','logWebhookError','message','logWebhookReceived','map','SHOP_WEBHOOK_SENT','logApiCall','logPaymentCreated','__esModule','toISOString','Failed\x20to\x20clean\x20old\x20logs:','payments_created','shop_webhooks_sent','\x20log:','📁\x20Created\x20logs\x20directory:\x20','localeCompare','path','logShopWebhookError','logCoinToPayError','log','statSync','36OqZNFG','error','COINTOPAY_ERROR','logCoinToPayStatus','filter','readdirSync','Failed\x20to\x20write\x20','getLogFileName','white_domain_requests','WEBHOOK_ERROR','🗑️\x20Deleted\x20old\x20log\x20file:\x20','mtime','464570lGQwBr','Failed\x20to\x20get\x20log\x20stats:','8569351AvkeMN','252Lbccwp','slice'];a49_0x5a49=function(){return _0x54daa4;};return a49_0x5a49();}function a49_0x4182(_0x441e9f,_0x3a25d2){const _0x5a4977=a49_0x5a49();return a49_0x4182=function(_0x4182a8,_0xd6cdd2){_0x4182a8=_0x4182a8-0x15d;let _0x4ebb16=_0x5a4977[_0x4182a8];return _0x4ebb16;},a49_0x4182(_0x441e9f,_0x3a25d2);}(function(_0x3dcc36,_0x357d0a){const _0x25ef96=a49_0x4182,_0x25d357=_0x3dcc36();while(!![]){try{const _0x5ae4e8=-parseInt(_0x25ef96(0x18b))/0x1*(-parseInt(_0x25ef96(0x17f))/0x2)+parseInt(_0x25ef96(0x188))/0x3+parseInt(_0x25ef96(0x1af))/0x4*(parseInt(_0x25ef96(0x190))/0x5)+parseInt(_0x25ef96(0x197))/0x6+-parseInt(_0x25ef96(0x169))/0x7+-parseInt(_0x25ef96(0x18a))/0x8*(parseInt(_0x25ef96(0x16a))/0x9)+parseInt(_0x25ef96(0x167))/0xa*(-parseInt(_0x25ef96(0x19a))/0xb);if(_0x5ae4e8===_0x357d0a)break;else _0x25d357['push'](_0x25d357['shift']());}catch(_0x31f918){_0x25d357['push'](_0x25d357['shift']());}}}(a49_0x5a49,0xedf34));var __importDefault=this&&this[a49_0x270303(0x179)]||function(_0x47bcd6){return _0x47bcd6&&_0x47bcd6['__esModule']?_0x47bcd6:{'default':_0x47bcd6};};Object[a49_0x270303(0x183)](exports,a49_0x270303(0x1a2),{'value':!![]}),exports['loggerService']=exports[a49_0x270303(0x17d)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x270303(0x1aa)));class LoggerService{constructor(){const _0x1ed26c=a49_0x270303;this[_0x1ed26c(0x18c)]=path_1[_0x1ed26c(0x198)][_0x1ed26c(0x191)](process[_0x1ed26c(0x18e)](),_0x1ed26c(0x16f)),this['ensureLogsDirectory']();}[a49_0x270303(0x170)](){const _0x32cbcb=a49_0x270303;!fs_1[_0x32cbcb(0x198)]['existsSync'](this[_0x32cbcb(0x18c)])&&(fs_1[_0x32cbcb(0x198)][_0x32cbcb(0x196)](this['logsDir'],{'recursive':!![]}),console['log'](_0x32cbcb(0x1a8)+this['logsDir']));}[a49_0x270303(0x162)](_0x5bdde9){const _0x19c43b=a49_0x270303,_0x154fd5=new Date()[_0x19c43b(0x1a3)]()['split']('T')[0x0];return path_1[_0x19c43b(0x198)][_0x19c43b(0x191)](this[_0x19c43b(0x18c)],_0x5bdde9+'_'+_0x154fd5+'.log');}['writeLog'](_0x5b329b,_0xedc882){const _0xcabe34=a49_0x270303;try{const _0x723703=new Date()['toISOString'](),_0x329691={'timestamp':_0x723703,..._0xedc882},_0x53b1b3=JSON[_0xcabe34(0x177)](_0x329691)+'\x0a',_0x59a145=this['getLogFileName'](_0x5b329b);fs_1[_0xcabe34(0x198)][_0xcabe34(0x187)](_0x59a145,_0x53b1b3,_0xcabe34(0x172));}catch(_0xac0a56){console[_0xcabe34(0x1b0)](_0xcabe34(0x161)+_0x5b329b+_0xcabe34(0x1a7),_0xac0a56);}}['logWhiteDomainRequest'](_0x527524,_0x4441eb,_0x2e8135,_0x1bc342){const _0xa3cdc2=a49_0x270303;this[_0xa3cdc2(0x186)](_0xa3cdc2(0x163),{'type':_0xa3cdc2(0x180),'gateway':_0x527524,'endpoint':_0x4441eb,'method':_0x2e8135,'data':_0x1bc342});}['logWhiteDomainResponse'](_0x245af4,_0x2b811b,_0x393256,_0x18f524,_0x1b5e13){const _0x1efc9a=a49_0x270303;this[_0x1efc9a(0x186)](_0x1efc9a(0x17a),{'type':_0x1efc9a(0x17b),'gateway':_0x245af4,'endpoint':_0x2b811b,'status':_0x393256,'responseTime':_0x1b5e13,'data':_0x18f524});}[a49_0x270303(0x195)](_0x3b996c,_0x56309e,_0x25a900){const _0x498401=a49_0x270303;this[_0x498401(0x186)](_0x498401(0x178),{'type':_0x498401(0x16c),'gateway':_0x3b996c,'endpoint':_0x56309e,'error':_0x25a900 instanceof Error?{'message':_0x25a900[_0x498401(0x19c)],'stack':_0x25a900[_0x498401(0x194)]}:_0x25a900});}[a49_0x270303(0x19d)](_0x4df420,_0x18148c,_0x391bc3){const _0x27219d=a49_0x270303;this['writeLog'](_0x27219d(0x192),{'type':'WEBHOOK_RECEIVED','gateway':_0x4df420,'headers':_0x391bc3,'data':_0x18148c});}['logWebhookProcessed'](_0x394ffa,_0x1a898d,_0x4cc2fb,_0x21930f,_0x7a5d3){const _0x552d96=a49_0x270303;this[_0x552d96(0x186)](_0x552d96(0x16e),{'type':_0x552d96(0x175),'gateway':_0x394ffa,'paymentId':_0x1a898d,'oldStatus':_0x4cc2fb,'newStatus':_0x21930f,'originalData':_0x7a5d3});}[a49_0x270303(0x19b)](_0x436104,_0x1ca291,_0x78fc7){const _0x48c1bf=a49_0x270303;this[_0x48c1bf(0x186)](_0x48c1bf(0x189),{'type':_0x48c1bf(0x164),'gateway':_0x436104,'error':_0x1ca291 instanceof Error?{'message':_0x1ca291[_0x48c1bf(0x19c)],'stack':_0x1ca291[_0x48c1bf(0x194)]}:_0x1ca291,'originalData':_0x78fc7});}[a49_0x270303(0x15e)](_0x4d8da6){const _0x349b53=a49_0x270303;this[_0x349b53(0x186)](_0x349b53(0x174),{'type':_0x349b53(0x16d),..._0x4d8da6});}[a49_0x270303(0x1ac)](_0x1c8019){const _0x256c45=a49_0x270303;this[_0x256c45(0x186)](_0x256c45(0x18f),{'type':_0x256c45(0x15d),..._0x1c8019});}['logShopWebhookSent'](_0x15e6a9,_0x1657da,_0x3bdb7c,_0x1ab5b4,_0x38efad,_0x4237fe){const _0x3981f3=a49_0x270303;this['writeLog'](_0x3981f3(0x1a6),{'type':_0x3981f3(0x19f),'shopId':_0x15e6a9,'webhookUrl':_0x1657da,'event':_0x3bdb7c,'status':_0x1ab5b4,'responseTime':_0x38efad,'payload':_0x4237fe});}[a49_0x270303(0x1ab)](_0x4de5b1,_0x4a2d5c,_0x37bd82,_0x2b8378,_0x5acab7){const _0x2f8360=a49_0x270303;this[_0x2f8360(0x186)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x4de5b1,'webhookUrl':_0x4a2d5c,'event':_0x37bd82,'error':_0x2b8378 instanceof Error?{'message':_0x2b8378[_0x2f8360(0x19c)],'stack':_0x2b8378[_0x2f8360(0x194)]}:_0x2b8378,'payload':_0x5acab7});}[a49_0x270303(0x1a1)](_0x592b3c,_0x32c2e0,_0x28d74f,_0x119363,_0x589555){const _0x1eb588=a49_0x270303;this[_0x1eb588(0x186)](_0x1eb588(0x1a5),{'type':'PAYMENT_CREATED','gateway':_0x592b3c,'paymentId':_0x32c2e0,'shopId':_0x28d74f,'amount':_0x119363,'currency':_0x589555});}[a49_0x270303(0x1a0)](_0x7f4430,_0x343f4f,_0x2ddf05,_0xbfdd46,_0x283443){const _0x396033=a49_0x270303;this[_0x396033(0x186)]('api_calls',{'type':_0x396033(0x17e),'endpoint':_0x7f4430,'method':_0x343f4f,'userId':_0x2ddf05,'userRole':_0xbfdd46,'requestData':_0x283443});}[a49_0x270303(0x171)](){const _0x49d20c=a49_0x270303;try{const _0x299141=fs_1[_0x49d20c(0x198)][_0x49d20c(0x160)](this[_0x49d20c(0x18c)]),_0xfd65f6=_0x299141[_0x49d20c(0x15f)](_0x3b5614=>_0x3b5614['endsWith']('.log')),_0x32df44=[...new Set(_0xfd65f6[_0x49d20c(0x19e)](_0xdf0460=>_0xdf0460[_0x49d20c(0x173)]('_')[0x0]))],_0x319d34=_0xfd65f6[_0x49d20c(0x19e)](_0x59254f=>{const _0x130734=_0x49d20c,_0x5b2277=path_1[_0x130734(0x198)]['join'](this['logsDir'],_0x59254f),_0x572c40=fs_1[_0x130734(0x198)][_0x130734(0x1ae)](_0x5b2277),[_0x4f044b,_0x7df4b8]=_0x59254f[_0x130734(0x193)](_0x130734(0x182),'')[_0x130734(0x173)]('_');return{'type':_0x4f044b,'date':_0x7df4b8,'size':_0x572c40[_0x130734(0x17c)]};})['sort']((_0x232bfc,_0x2ec7df)=>_0x2ec7df[_0x49d20c(0x199)][_0x49d20c(0x1a9)](_0x232bfc[_0x49d20c(0x199)]));return{'totalFiles':_0xfd65f6['length'],'logTypes':_0x32df44,'latestLogs':_0x319d34[_0x49d20c(0x16b)](0x0,0xa)};}catch(_0x2217aa){return console[_0x49d20c(0x1b0)](_0x49d20c(0x168),_0x2217aa),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x270303(0x185)](_0x591452=0x1e){const _0x1d6caa=a49_0x270303;try{const _0x31ef20=fs_1['default'][_0x1d6caa(0x160)](this[_0x1d6caa(0x18c)]),_0x3d3869=new Date();_0x3d3869['setDate'](_0x3d3869['getDate']()-_0x591452);let _0xb060ba=0x0;_0x31ef20[_0x1d6caa(0x176)](_0x21be54=>{const _0x25cf8a=_0x1d6caa;if(!_0x21be54['endsWith'](_0x25cf8a(0x182)))return;const _0x4fc67a=path_1[_0x25cf8a(0x198)][_0x25cf8a(0x191)](this[_0x25cf8a(0x18c)],_0x21be54),_0x47c166=fs_1[_0x25cf8a(0x198)]['statSync'](_0x4fc67a);_0x47c166[_0x25cf8a(0x166)]<_0x3d3869&&(fs_1[_0x25cf8a(0x198)][_0x25cf8a(0x184)](_0x4fc67a),_0xb060ba++,console[_0x25cf8a(0x1ad)](_0x25cf8a(0x165)+_0x21be54));}),console['log']('🧹\x20Cleaned\x20'+_0xb060ba+_0x1d6caa(0x18d)+_0x591452+'\x20days)');}catch(_0xa0a16e){console[_0x1d6caa(0x1b0)](_0x1d6caa(0x1a4),_0xa0a16e);}}}exports[a49_0x270303(0x17d)]=LoggerService,exports[a49_0x270303(0x181)]=new LoggerService();