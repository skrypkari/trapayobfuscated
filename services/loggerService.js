'use strict';const a55_0x125c6e=a55_0x5f5a;function a55_0x5f5a(_0x11a496,_0x519c0b){const _0xda3e6d=a55_0xda3e();return a55_0x5f5a=function(_0x5f5a31,_0x1bb5d8){_0x5f5a31=_0x5f5a31-0xc3;let _0x2d7298=_0xda3e6d[_0x5f5a31];return _0x2d7298;},a55_0x5f5a(_0x11a496,_0x519c0b);}function a55_0xda3e(){const _0x86d94a=['__esModule','white_domain_responses','localeCompare','SHOP_WEBHOOK_SENT','logWhiteDomainError','logsDir','12AlYiRQ','path','shop_webhooks_errors','readdirSync','size','logs','logWhiteDomainResponse','ensureLogsDirectory','payments_created','map','logShopWebhookSent','529140GdyVIq','join','12JundjW','607302zwpsKO','defineProperty','length','unlinkSync','Failed\x20to\x20get\x20log\x20stats:','API_CALL','log','stringify','webhooks_processed','WEBHOOK_PROCESSED','logPaymentCreated','getLogFileName','logCoinToPayStatus','LoggerService','COINTOPAY_ERROR','stack','WEBHOOK_ERROR','existsSync','mtime','1474575WTImEv','error','2319219DLMyld','loggerService','40649IRTjVb','🗑️\x20Deleted\x20old\x20log\x20file:\x20','default','ERROR','endsWith','logWebhookReceived','logWebhookProcessed','logWhiteDomainRequest','white_domain_errors','WEBHOOK_RECEIVED','RESPONSE','Failed\x20to\x20write\x20','replace','REQUEST','4aStmYb','webhooks_received','.log','logCoinToPayError','writeLog','logApiCall','🧹\x20Cleaned\x20','statSync','appendFileSync','cointopay_status_changes','webhooks_errors','SHOP_WEBHOOK_ERROR','filter','Failed\x20to\x20clean\x20old\x20logs:','setDate','toISOString','1813776pvHkhW','4586yTGMKb','sort','split','message'];a55_0xda3e=function(){return _0x86d94a;};return a55_0xda3e();}(function(_0x51118d,_0x18f41d){const _0x3f1416=a55_0x5f5a,_0x46c91f=_0x51118d();while(!![]){try{const _0x233b07=parseInt(_0x3f1416(0xde))/0x1*(-parseInt(_0x3f1416(0xc7))/0x2)+-parseInt(_0x3f1416(0xdf))/0x3+-parseInt(_0x3f1416(0x104))/0x4*(-parseInt(_0x3f1416(0xf2))/0x5)+parseInt(_0x3f1416(0xd1))/0x6*(parseInt(_0x3f1416(0xf6))/0x7)+-parseInt(_0x3f1416(0xc6))/0x8+parseInt(_0x3f1416(0xf4))/0x9+parseInt(_0x3f1416(0xdc))/0xa;if(_0x233b07===_0x18f41d)break;else _0x46c91f['push'](_0x46c91f['shift']());}catch(_0x3bdf19){_0x46c91f['push'](_0x46c91f['shift']());}}}(a55_0xda3e,0x272ce));var __importDefault=this&&this['__importDefault']||function(_0x4b3555){const _0x29629f=a55_0x5f5a;return _0x4b3555&&_0x4b3555[_0x29629f(0xcb)]?_0x4b3555:{'default':_0x4b3555};};Object[a55_0x125c6e(0xe0)](exports,'__esModule',{'value':!![]}),exports[a55_0x125c6e(0xf5)]=exports[a55_0x125c6e(0xec)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a55_0x125c6e(0xd2)));class LoggerService{constructor(){const _0x47a4c6=a55_0x125c6e;this[_0x47a4c6(0xd0)]=path_1[_0x47a4c6(0xf8)][_0x47a4c6(0xdd)](process['cwd'](),_0x47a4c6(0xd6)),this[_0x47a4c6(0xd8)]();}[a55_0x125c6e(0xd8)](){const _0x2b0f89=a55_0x125c6e;!fs_1[_0x2b0f89(0xf8)][_0x2b0f89(0xf0)](this['logsDir'])&&(fs_1[_0x2b0f89(0xf8)]['mkdirSync'](this[_0x2b0f89(0xd0)],{'recursive':!![]}),console[_0x2b0f89(0xe5)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0x2b0f89(0xd0)]));}[a55_0x125c6e(0xea)](_0x3679fe){const _0x1e94e2=a55_0x125c6e,_0x2f1b3f=new Date()['toISOString']()[_0x1e94e2(0xc9)]('T')[0x0];return path_1[_0x1e94e2(0xf8)][_0x1e94e2(0xdd)](this[_0x1e94e2(0xd0)],_0x3679fe+'_'+_0x2f1b3f+_0x1e94e2(0x106));}[a55_0x125c6e(0x108)](_0x1b33e7,_0x2c9a2e){const _0x474343=a55_0x125c6e;try{const _0x2445d5=new Date()[_0x474343(0xc5)](),_0x43a7c6={'timestamp':_0x2445d5,..._0x2c9a2e},_0x506ec8=JSON[_0x474343(0xe6)](_0x43a7c6)+'\x0a',_0x56d006=this['getLogFileName'](_0x1b33e7);fs_1[_0x474343(0xf8)][_0x474343(0x10c)](_0x56d006,_0x506ec8,'utf8');}catch(_0x8247be){console['error'](_0x474343(0x101)+_0x1b33e7+'\x20log:',_0x8247be);}}[a55_0x125c6e(0xfd)](_0x5513bb,_0x32ba0b,_0xd1f555,_0x25c1d4){const _0x20f13f=a55_0x125c6e;this['writeLog']('white_domain_requests',{'type':_0x20f13f(0x103),'gateway':_0x5513bb,'endpoint':_0x32ba0b,'method':_0xd1f555,'data':_0x25c1d4});}[a55_0x125c6e(0xd7)](_0xfef6af,_0x666651,_0x1efab7,_0x3a2fd1,_0x43d647){const _0x25387c=a55_0x125c6e;this[_0x25387c(0x108)](_0x25387c(0xcc),{'type':_0x25387c(0x100),'gateway':_0xfef6af,'endpoint':_0x666651,'status':_0x1efab7,'responseTime':_0x43d647,'data':_0x3a2fd1});}[a55_0x125c6e(0xcf)](_0x79e6b0,_0x21cf9c,_0x26b1b8){const _0x4b2364=a55_0x125c6e;this['writeLog'](_0x4b2364(0xfe),{'type':_0x4b2364(0xf9),'gateway':_0x79e6b0,'endpoint':_0x21cf9c,'error':_0x26b1b8 instanceof Error?{'message':_0x26b1b8['message'],'stack':_0x26b1b8[_0x4b2364(0xee)]}:_0x26b1b8});}[a55_0x125c6e(0xfb)](_0x5c1bae,_0x51197d,_0x50e6df){const _0x4702fb=a55_0x125c6e;this['writeLog'](_0x4702fb(0x105),{'type':_0x4702fb(0xff),'gateway':_0x5c1bae,'headers':_0x50e6df,'data':_0x51197d});}[a55_0x125c6e(0xfc)](_0x14b928,_0x46f0b6,_0x2fb1f9,_0x135f9a,_0x26e6a9){const _0x1c42e1=a55_0x125c6e;this[_0x1c42e1(0x108)](_0x1c42e1(0xe7),{'type':_0x1c42e1(0xe8),'gateway':_0x14b928,'paymentId':_0x46f0b6,'oldStatus':_0x2fb1f9,'newStatus':_0x135f9a,'originalData':_0x26e6a9});}['logWebhookError'](_0x236bc0,_0xab4ac3,_0x3f3a9d){const _0xe6b7c9=a55_0x125c6e;this[_0xe6b7c9(0x108)](_0xe6b7c9(0x10e),{'type':_0xe6b7c9(0xef),'gateway':_0x236bc0,'error':_0xab4ac3 instanceof Error?{'message':_0xab4ac3[_0xe6b7c9(0xca)],'stack':_0xab4ac3[_0xe6b7c9(0xee)]}:_0xab4ac3,'originalData':_0x3f3a9d});}[a55_0x125c6e(0xeb)](_0x42115e){const _0x170365=a55_0x125c6e;this[_0x170365(0x108)](_0x170365(0x10d),{'type':'COINTOPAY_STATUS_CHANGE',..._0x42115e});}[a55_0x125c6e(0x107)](_0x398d86){const _0x300f01=a55_0x125c6e;this['writeLog']('cointopay_errors',{'type':_0x300f01(0xed),..._0x398d86});}[a55_0x125c6e(0xdb)](_0x5e95fb,_0x44ec9b,_0x2f9983,_0x37b55d,_0x56decf,_0x1fdd45){const _0x5a49dc=a55_0x125c6e;this[_0x5a49dc(0x108)]('shop_webhooks_sent',{'type':_0x5a49dc(0xce),'shopId':_0x5e95fb,'webhookUrl':_0x44ec9b,'event':_0x2f9983,'status':_0x37b55d,'responseTime':_0x56decf,'payload':_0x1fdd45});}['logShopWebhookError'](_0x2dae1e,_0x1b485d,_0x43a189,_0x13c046,_0x2fb21d){const _0x1ccd58=a55_0x125c6e;this[_0x1ccd58(0x108)](_0x1ccd58(0xd3),{'type':_0x1ccd58(0x10f),'shopId':_0x2dae1e,'webhookUrl':_0x1b485d,'event':_0x43a189,'error':_0x13c046 instanceof Error?{'message':_0x13c046[_0x1ccd58(0xca)],'stack':_0x13c046[_0x1ccd58(0xee)]}:_0x13c046,'payload':_0x2fb21d});}[a55_0x125c6e(0xe9)](_0x193d11,_0x1f38d1,_0x3b657a,_0x4d5f1f,_0x320ec5){const _0x516c21=a55_0x125c6e;this[_0x516c21(0x108)](_0x516c21(0xd9),{'type':'PAYMENT_CREATED','gateway':_0x193d11,'paymentId':_0x1f38d1,'shopId':_0x3b657a,'amount':_0x4d5f1f,'currency':_0x320ec5});}[a55_0x125c6e(0x109)](_0x238de3,_0x3d6140,_0x6322a9,_0xf9d149,_0x5c5de1){const _0x5d5a21=a55_0x125c6e;this[_0x5d5a21(0x108)]('api_calls',{'type':_0x5d5a21(0xe4),'endpoint':_0x238de3,'method':_0x3d6140,'userId':_0x6322a9,'userRole':_0xf9d149,'requestData':_0x5c5de1});}['getLogStats'](){const _0x11a08e=a55_0x125c6e;try{const _0x1667a1=fs_1[_0x11a08e(0xf8)][_0x11a08e(0xd4)](this[_0x11a08e(0xd0)]),_0x2fd50e=_0x1667a1[_0x11a08e(0x110)](_0xcd69b1=>_0xcd69b1[_0x11a08e(0xfa)](_0x11a08e(0x106))),_0x26cc97=[...new Set(_0x2fd50e[_0x11a08e(0xda)](_0x8d7695=>_0x8d7695[_0x11a08e(0xc9)]('_')[0x0]))],_0x21ddbc=_0x2fd50e[_0x11a08e(0xda)](_0x5c75e3=>{const _0x120dfd=_0x11a08e,_0x544dc0=path_1[_0x120dfd(0xf8)]['join'](this[_0x120dfd(0xd0)],_0x5c75e3),_0x228418=fs_1[_0x120dfd(0xf8)][_0x120dfd(0x10b)](_0x544dc0),[_0x5e0b23,_0x59782a]=_0x5c75e3[_0x120dfd(0x102)](_0x120dfd(0x106),'')[_0x120dfd(0xc9)]('_');return{'type':_0x5e0b23,'date':_0x59782a,'size':_0x228418[_0x120dfd(0xd5)]};})[_0x11a08e(0xc8)]((_0x552ef0,_0x2e613f)=>_0x2e613f['date'][_0x11a08e(0xcd)](_0x552ef0['date']));return{'totalFiles':_0x2fd50e[_0x11a08e(0xe1)],'logTypes':_0x26cc97,'latestLogs':_0x21ddbc['slice'](0x0,0xa)};}catch(_0x319d57){return console[_0x11a08e(0xf3)](_0x11a08e(0xe3),_0x319d57),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x45230c=0x1e){const _0x3c24f8=a55_0x125c6e;try{const _0x2d34a8=fs_1[_0x3c24f8(0xf8)][_0x3c24f8(0xd4)](this[_0x3c24f8(0xd0)]),_0x5008d3=new Date();_0x5008d3[_0x3c24f8(0xc4)](_0x5008d3['getDate']()-_0x45230c);let _0x54560b=0x0;_0x2d34a8['forEach'](_0x3d83e1=>{const _0x2d3ec3=_0x3c24f8;if(!_0x3d83e1[_0x2d3ec3(0xfa)](_0x2d3ec3(0x106)))return;const _0x79808b=path_1['default'][_0x2d3ec3(0xdd)](this[_0x2d3ec3(0xd0)],_0x3d83e1),_0x60ed1e=fs_1['default'][_0x2d3ec3(0x10b)](_0x79808b);_0x60ed1e[_0x2d3ec3(0xf1)]<_0x5008d3&&(fs_1['default'][_0x2d3ec3(0xe2)](_0x79808b),_0x54560b++,console[_0x2d3ec3(0xe5)](_0x2d3ec3(0xf7)+_0x3d83e1));}),console[_0x3c24f8(0xe5)](_0x3c24f8(0x10a)+_0x54560b+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x45230c+'\x20days)');}catch(_0x96418a){console[_0x3c24f8(0xf3)](_0x3c24f8(0xc3),_0x96418a);}}}exports[a55_0x125c6e(0xec)]=LoggerService,exports[a55_0x125c6e(0xf5)]=new LoggerService();