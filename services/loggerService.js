'use strict';const a48_0x2742ff=a48_0x3217;(function(_0x23142b,_0x1dcca7){const _0x5f41ba=a48_0x3217,_0x576db6=_0x23142b();while(!![]){try{const _0x332fa4=-parseInt(_0x5f41ba(0x151))/0x1+-parseInt(_0x5f41ba(0x169))/0x2+-parseInt(_0x5f41ba(0x193))/0x3+-parseInt(_0x5f41ba(0x173))/0x4*(-parseInt(_0x5f41ba(0x19c))/0x5)+-parseInt(_0x5f41ba(0x171))/0x6+-parseInt(_0x5f41ba(0x17c))/0x7+parseInt(_0x5f41ba(0x160))/0x8*(parseInt(_0x5f41ba(0x165))/0x9);if(_0x332fa4===_0x1dcca7)break;else _0x576db6['push'](_0x576db6['shift']());}catch(_0x37f48c){_0x576db6['push'](_0x576db6['shift']());}}}(a48_0x46d2,0x5add9));function a48_0x3217(_0x2bfbac,_0x24261d){const _0x46d2e4=a48_0x46d2();return a48_0x3217=function(_0x3217fb,_0x4e1d4d){_0x3217fb=_0x3217fb-0x14c;let _0x332bd7=_0x46d2e4[_0x3217fb];return _0x332bd7;},a48_0x3217(_0x2bfbac,_0x24261d);}var __importDefault=this&&this['__importDefault']||function(_0x293218){const _0x3b130f=a48_0x3217;return _0x293218&&_0x293218[_0x3b130f(0x172)]?_0x293218:{'default':_0x293218};};function a48_0x46d2(){const _0x566a94=['logCoinToPayStatus','sort','cwd','1524636pDkIdG','SHOP_WEBHOOK_SENT','COINTOPAY_STATUS_CHANGE','mtime','ensureLogsDirectory','SHOP_WEBHOOK_ERROR','stringify','ERROR','log','30YIOsOI','replace','date','white_domain_errors','size','RESPONSE','API_CALL','\x20days)','392314cxWrao','webhooks_processed','utf8','logWebhookError','endsWith','logShopWebhookSent','logApiCall','cointopay_errors','loggerService','WEBHOOK_ERROR','Failed\x20to\x20get\x20log\x20stats:','join','logWebhookReceived','📁\x20Created\x20logs\x20directory:\x20','cleanOldLogs','6163032XRtVBB','path','length','statSync','stack','18NFKxwv','🧹\x20Cleaned\x20','WEBHOOK_RECEIVED','readdirSync','265938lzwzqS','logWhiteDomainRequest','.log','logs','existsSync','logsDir','shop_webhooks_errors','getLogFileName','619122DLpygg','__esModule','377868EWksRa','logWebhookProcessed','WEBHOOK_PROCESSED','getLogStats','api_calls','split','🗑️\x20Deleted\x20old\x20log\x20file:\x20','setDate','message','4190851JlEfvl','white_domain_requests','COINTOPAY_ERROR','slice','logShopWebhookError','cointopay_status_changes','webhooks_errors','mkdirSync','forEach','REQUEST','default','error','payments_created','defineProperty','toISOString','getDate','white_domain_responses','appendFileSync','map','writeLog'];a48_0x46d2=function(){return _0x566a94;};return a48_0x46d2();}Object[a48_0x2742ff(0x189)](exports,a48_0x2742ff(0x172),{'value':!![]}),exports[a48_0x2742ff(0x159)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x2742ff(0x161)));class LoggerService{constructor(){const _0x2ab582=a48_0x2742ff;this['logsDir']=path_1[_0x2ab582(0x186)]['join'](process[_0x2ab582(0x192)](),_0x2ab582(0x16c)),this[_0x2ab582(0x197)]();}['ensureLogsDirectory'](){const _0x47e6f6=a48_0x2742ff;!fs_1[_0x47e6f6(0x186)][_0x47e6f6(0x16d)](this[_0x47e6f6(0x16e)])&&(fs_1[_0x47e6f6(0x186)][_0x47e6f6(0x183)](this['logsDir'],{'recursive':!![]}),console['log'](_0x47e6f6(0x15e)+this[_0x47e6f6(0x16e)]));}[a48_0x2742ff(0x170)](_0x1b5eef){const _0x12d830=a48_0x2742ff,_0x477196=new Date()[_0x12d830(0x18a)]()['split']('T')[0x0];return path_1[_0x12d830(0x186)]['join'](this[_0x12d830(0x16e)],_0x1b5eef+'_'+_0x477196+'.log');}[a48_0x2742ff(0x18f)](_0x19f44c,_0x1899c7){const _0x1aa0cf=a48_0x2742ff;try{const _0x56e910=new Date()[_0x1aa0cf(0x18a)](),_0x2fbf9c={'timestamp':_0x56e910,..._0x1899c7},_0xe8dc68=JSON[_0x1aa0cf(0x199)](_0x2fbf9c)+'\x0a',_0x1bd802=this[_0x1aa0cf(0x170)](_0x19f44c);fs_1[_0x1aa0cf(0x186)][_0x1aa0cf(0x18d)](_0x1bd802,_0xe8dc68,_0x1aa0cf(0x153));}catch(_0x43b3ed){console[_0x1aa0cf(0x187)]('Failed\x20to\x20write\x20'+_0x19f44c+'\x20log:',_0x43b3ed);}}[a48_0x2742ff(0x16a)](_0x5ad7c1,_0x4add4f,_0x211cff,_0x45425a){const _0x127412=a48_0x2742ff;this['writeLog'](_0x127412(0x17d),{'type':_0x127412(0x185),'gateway':_0x5ad7c1,'endpoint':_0x4add4f,'method':_0x211cff,'data':_0x45425a});}['logWhiteDomainResponse'](_0x4fac74,_0x4b10fc,_0x20bd20,_0x164835,_0x2a2c81){const _0x1b1e5e=a48_0x2742ff;this['writeLog'](_0x1b1e5e(0x18c),{'type':_0x1b1e5e(0x14e),'gateway':_0x4fac74,'endpoint':_0x4b10fc,'status':_0x20bd20,'responseTime':_0x2a2c81,'data':_0x164835});}['logWhiteDomainError'](_0x1a4ac8,_0x4109ca,_0x389b2f){const _0x236c2a=a48_0x2742ff;this[_0x236c2a(0x18f)](_0x236c2a(0x14c),{'type':_0x236c2a(0x19a),'gateway':_0x1a4ac8,'endpoint':_0x4109ca,'error':_0x389b2f instanceof Error?{'message':_0x389b2f['message'],'stack':_0x389b2f[_0x236c2a(0x164)]}:_0x389b2f});}[a48_0x2742ff(0x15d)](_0x34afe5,_0x55ae63,_0x3bde07){const _0x23288e=a48_0x2742ff;this['writeLog']('webhooks_received',{'type':_0x23288e(0x167),'gateway':_0x34afe5,'headers':_0x3bde07,'data':_0x55ae63});}[a48_0x2742ff(0x174)](_0x580df8,_0x27046b,_0x49c77a,_0x44ed59,_0x21f6ba){const _0xc694ba=a48_0x2742ff;this[_0xc694ba(0x18f)](_0xc694ba(0x152),{'type':_0xc694ba(0x175),'gateway':_0x580df8,'paymentId':_0x27046b,'oldStatus':_0x49c77a,'newStatus':_0x44ed59,'originalData':_0x21f6ba});}[a48_0x2742ff(0x154)](_0x1c11ce,_0x382eaa,_0x2339e2){const _0x229cfa=a48_0x2742ff;this[_0x229cfa(0x18f)](_0x229cfa(0x182),{'type':_0x229cfa(0x15a),'gateway':_0x1c11ce,'error':_0x382eaa instanceof Error?{'message':_0x382eaa['message'],'stack':_0x382eaa['stack']}:_0x382eaa,'originalData':_0x2339e2});}[a48_0x2742ff(0x190)](_0x428f25){const _0x20a314=a48_0x2742ff;this[_0x20a314(0x18f)](_0x20a314(0x181),{'type':_0x20a314(0x195),..._0x428f25});}['logCoinToPayError'](_0x44019d){const _0x4cbcfb=a48_0x2742ff;this[_0x4cbcfb(0x18f)](_0x4cbcfb(0x158),{'type':_0x4cbcfb(0x17e),..._0x44019d});}[a48_0x2742ff(0x156)](_0x50dfda,_0x2ea527,_0x5c5d8a,_0x5d9b38,_0x225652,_0x3b5db7){const _0x46f00b=a48_0x2742ff;this[_0x46f00b(0x18f)]('shop_webhooks_sent',{'type':_0x46f00b(0x194),'shopId':_0x50dfda,'webhookUrl':_0x2ea527,'event':_0x5c5d8a,'status':_0x5d9b38,'responseTime':_0x225652,'payload':_0x3b5db7});}[a48_0x2742ff(0x180)](_0x3f014a,_0x456103,_0x153c3a,_0x5e14e6,_0x224f81){const _0x24722a=a48_0x2742ff;this['writeLog'](_0x24722a(0x16f),{'type':_0x24722a(0x198),'shopId':_0x3f014a,'webhookUrl':_0x456103,'event':_0x153c3a,'error':_0x5e14e6 instanceof Error?{'message':_0x5e14e6[_0x24722a(0x17b)],'stack':_0x5e14e6[_0x24722a(0x164)]}:_0x5e14e6,'payload':_0x224f81});}['logPaymentCreated'](_0x31a895,_0x4c73c3,_0x5db105,_0x3fcbe5,_0x2a7bc4){const _0x2b72c1=a48_0x2742ff;this[_0x2b72c1(0x18f)](_0x2b72c1(0x188),{'type':'PAYMENT_CREATED','gateway':_0x31a895,'paymentId':_0x4c73c3,'shopId':_0x5db105,'amount':_0x3fcbe5,'currency':_0x2a7bc4});}[a48_0x2742ff(0x157)](_0x959de8,_0x3e18a3,_0x1aa7c4,_0x53dc16,_0x356484){const _0x73c657=a48_0x2742ff;this['writeLog'](_0x73c657(0x177),{'type':_0x73c657(0x14f),'endpoint':_0x959de8,'method':_0x3e18a3,'userId':_0x1aa7c4,'userRole':_0x53dc16,'requestData':_0x356484});}[a48_0x2742ff(0x176)](){const _0x5d068=a48_0x2742ff;try{const _0x9b19ec=fs_1[_0x5d068(0x186)][_0x5d068(0x168)](this[_0x5d068(0x16e)]),_0xe102f5=_0x9b19ec['filter'](_0x59bcc1=>_0x59bcc1[_0x5d068(0x155)](_0x5d068(0x16b))),_0x675b59=[...new Set(_0xe102f5['map'](_0x5aeaec=>_0x5aeaec[_0x5d068(0x178)]('_')[0x0]))],_0x1106f3=_0xe102f5[_0x5d068(0x18e)](_0x5b4810=>{const _0x23c7cc=_0x5d068,_0x428d48=path_1[_0x23c7cc(0x186)][_0x23c7cc(0x15c)](this[_0x23c7cc(0x16e)],_0x5b4810),_0xbdebb1=fs_1[_0x23c7cc(0x186)][_0x23c7cc(0x163)](_0x428d48),[_0x5e365d,_0xe8b3bb]=_0x5b4810[_0x23c7cc(0x19d)](_0x23c7cc(0x16b),'')[_0x23c7cc(0x178)]('_');return{'type':_0x5e365d,'date':_0xe8b3bb,'size':_0xbdebb1[_0x23c7cc(0x14d)]};})[_0x5d068(0x191)]((_0x588d99,_0x1b7184)=>_0x1b7184['date']['localeCompare'](_0x588d99[_0x5d068(0x19e)]));return{'totalFiles':_0xe102f5[_0x5d068(0x162)],'logTypes':_0x675b59,'latestLogs':_0x1106f3[_0x5d068(0x17f)](0x0,0xa)};}catch(_0x1816a4){return console[_0x5d068(0x187)](_0x5d068(0x15b),_0x1816a4),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x2742ff(0x15f)](_0x4bfa33=0x1e){const _0x53b470=a48_0x2742ff;try{const _0x13c180=fs_1[_0x53b470(0x186)][_0x53b470(0x168)](this[_0x53b470(0x16e)]),_0x4b9836=new Date();_0x4b9836[_0x53b470(0x17a)](_0x4b9836[_0x53b470(0x18b)]()-_0x4bfa33);let _0x17091a=0x0;_0x13c180[_0x53b470(0x184)](_0x1846db=>{const _0x4cb238=_0x53b470;if(!_0x1846db[_0x4cb238(0x155)](_0x4cb238(0x16b)))return;const _0x2fd34f=path_1[_0x4cb238(0x186)]['join'](this[_0x4cb238(0x16e)],_0x1846db),_0x565637=fs_1[_0x4cb238(0x186)]['statSync'](_0x2fd34f);_0x565637[_0x4cb238(0x196)]<_0x4b9836&&(fs_1[_0x4cb238(0x186)]['unlinkSync'](_0x2fd34f),_0x17091a++,console['log'](_0x4cb238(0x179)+_0x1846db));}),console[_0x53b470(0x19b)](_0x53b470(0x166)+_0x17091a+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x4bfa33+_0x53b470(0x150));}catch(_0x523e29){console[_0x53b470(0x187)]('Failed\x20to\x20clean\x20old\x20logs:',_0x523e29);}}}exports['LoggerService']=LoggerService,exports[a48_0x2742ff(0x159)]=new LoggerService();