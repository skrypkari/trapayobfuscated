'use strict';const a51_0x3d5806=a51_0xae52;(function(_0xe32e63,_0x194dc0){const _0xe94945=a51_0xae52,_0x1bb645=_0xe32e63();while(!![]){try{const _0x35b84c=-parseInt(_0xe94945(0xc9))/0x1+-parseInt(_0xe94945(0x83))/0x2*(-parseInt(_0xe94945(0x91))/0x3)+parseInt(_0xe94945(0x89))/0x4+-parseInt(_0xe94945(0x92))/0x5+parseInt(_0xe94945(0x8a))/0x6*(parseInt(_0xe94945(0x9b))/0x7)+parseInt(_0xe94945(0xbb))/0x8*(-parseInt(_0xe94945(0xbc))/0x9)+parseInt(_0xe94945(0x85))/0xa;if(_0x35b84c===_0x194dc0)break;else _0x1bb645['push'](_0x1bb645['shift']());}catch(_0x1127be){_0x1bb645['push'](_0x1bb645['shift']());}}}(a51_0x12dc,0xb1006));function a51_0x12dc(){const _0x4eea0f=['528928TKtMGF','path','cointopay_status_changes','🗑️\x20Deleted\x20old\x20log\x20file:\x20','shop_webhooks_errors','SHOP_WEBHOOK_SENT','unlinkSync','API_CALL','mtime','getLogFileName','appendFileSync','readdirSync','ERROR','getLogStats','COINTOPAY_STATUS_CHANGE','1960586auiSrc','.log','3301710tAcpyL','cleanOldLogs','default','sort','4045256GncpUY','92664whJdxl','forEach','setDate','message','SHOP_WEBHOOK_ERROR','date','logsDir','3pMWxpu','2113435SqAgAI','api_calls','writeLog','mkdirSync','🧹\x20Cleaned\x20','stringify','length','logCoinToPayError','logWebhookError','175VZDaSg','endsWith','join','loggerService','cwd','Failed\x20to\x20clean\x20old\x20logs:','error','logWebhookReceived','logWhiteDomainRequest','logShopWebhookError','cointopay_errors','localeCompare','size','logShopWebhookSent','map','getDate','toISOString','logPaymentCreated','\x20old\x20log\x20files\x20(older\x20than\x20','existsSync','split','payments_created','__importDefault','__esModule','slice','webhooks_errors','\x20log:','📁\x20Created\x20logs\x20directory:\x20','filter','logs','Failed\x20to\x20write\x20','logCoinToPayStatus','216PhBxxw','343755VFGdym','defineProperty','stack','logWhiteDomainError','webhooks_received','log','PAYMENT_CREATED','WEBHOOK_PROCESSED','statSync','WEBHOOK_RECEIVED','ensureLogsDirectory','utf8','LoggerService'];a51_0x12dc=function(){return _0x4eea0f;};return a51_0x12dc();}var __importDefault=this&&this[a51_0x3d5806(0xb1)]||function(_0x48e94c){const _0x357526=a51_0x3d5806;return _0x48e94c&&_0x48e94c[_0x357526(0xb2)]?_0x48e94c:{'default':_0x48e94c};};Object[a51_0x3d5806(0xbd)](exports,a51_0x3d5806(0xb2),{'value':!![]}),exports[a51_0x3d5806(0x9e)]=exports[a51_0x3d5806(0xc8)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x3d5806(0xca)));class LoggerService{constructor(){const _0x1dbd13=a51_0x3d5806;this[_0x1dbd13(0x90)]=path_1[_0x1dbd13(0x87)]['join'](process[_0x1dbd13(0x9f)](),_0x1dbd13(0xb8)),this[_0x1dbd13(0xc6)]();}[a51_0x3d5806(0xc6)](){const _0x2ec0c0=a51_0x3d5806;!fs_1[_0x2ec0c0(0x87)][_0x2ec0c0(0xae)](this[_0x2ec0c0(0x90)])&&(fs_1[_0x2ec0c0(0x87)][_0x2ec0c0(0x95)](this[_0x2ec0c0(0x90)],{'recursive':!![]}),console['log'](_0x2ec0c0(0xb6)+this['logsDir']));}['getLogFileName'](_0x582f9a){const _0x4684f4=a51_0x3d5806,_0x22fbfa=new Date()['toISOString']()[_0x4684f4(0xaf)]('T')[0x0];return path_1[_0x4684f4(0x87)][_0x4684f4(0x9d)](this[_0x4684f4(0x90)],_0x582f9a+'_'+_0x22fbfa+_0x4684f4(0x84));}['writeLog'](_0x314463,_0x524cc0){const _0x5eaec2=a51_0x3d5806;try{const _0x40805=new Date()[_0x5eaec2(0xab)](),_0xc45f8d={'timestamp':_0x40805,..._0x524cc0},_0x4f48db=JSON[_0x5eaec2(0x97)](_0xc45f8d)+'\x0a',_0x4a725b=this[_0x5eaec2(0x7d)](_0x314463);fs_1[_0x5eaec2(0x87)][_0x5eaec2(0x7e)](_0x4a725b,_0x4f48db,_0x5eaec2(0xc7));}catch(_0x58ecf7){console['error'](_0x5eaec2(0xb9)+_0x314463+_0x5eaec2(0xb5),_0x58ecf7);}}[a51_0x3d5806(0xa3)](_0x217516,_0x175dfd,_0x37976b,_0x43de41){const _0x2d580d=a51_0x3d5806;this[_0x2d580d(0x94)]('white_domain_requests',{'type':'REQUEST','gateway':_0x217516,'endpoint':_0x175dfd,'method':_0x37976b,'data':_0x43de41});}['logWhiteDomainResponse'](_0x572869,_0x3b34a5,_0x59e9ed,_0x2d6f18,_0x1c47e5){const _0x129e20=a51_0x3d5806;this[_0x129e20(0x94)]('white_domain_responses',{'type':'RESPONSE','gateway':_0x572869,'endpoint':_0x3b34a5,'status':_0x59e9ed,'responseTime':_0x1c47e5,'data':_0x2d6f18});}[a51_0x3d5806(0xbf)](_0x3603f6,_0x436d80,_0x294e3b){const _0x8ee7c6=a51_0x3d5806;this[_0x8ee7c6(0x94)]('white_domain_errors',{'type':_0x8ee7c6(0x80),'gateway':_0x3603f6,'endpoint':_0x436d80,'error':_0x294e3b instanceof Error?{'message':_0x294e3b[_0x8ee7c6(0x8d)],'stack':_0x294e3b['stack']}:_0x294e3b});}[a51_0x3d5806(0xa2)](_0x36e469,_0x3644f7,_0x26033e){const _0x11bc2c=a51_0x3d5806;this[_0x11bc2c(0x94)](_0x11bc2c(0xc0),{'type':_0x11bc2c(0xc5),'gateway':_0x36e469,'headers':_0x26033e,'data':_0x3644f7});}['logWebhookProcessed'](_0x567734,_0x174eef,_0x648f28,_0x58bcf1,_0x235194){const _0x170025=a51_0x3d5806;this[_0x170025(0x94)]('webhooks_processed',{'type':_0x170025(0xc3),'gateway':_0x567734,'paymentId':_0x174eef,'oldStatus':_0x648f28,'newStatus':_0x58bcf1,'originalData':_0x235194});}[a51_0x3d5806(0x9a)](_0x943505,_0x70dc1a,_0x2b8d20){const _0xa335c1=a51_0x3d5806;this[_0xa335c1(0x94)](_0xa335c1(0xb4),{'type':'WEBHOOK_ERROR','gateway':_0x943505,'error':_0x70dc1a instanceof Error?{'message':_0x70dc1a['message'],'stack':_0x70dc1a[_0xa335c1(0xbe)]}:_0x70dc1a,'originalData':_0x2b8d20});}[a51_0x3d5806(0xba)](_0x3803ed){const _0x16e129=a51_0x3d5806;this[_0x16e129(0x94)](_0x16e129(0xcb),{'type':_0x16e129(0x82),..._0x3803ed});}[a51_0x3d5806(0x99)](_0x516d29){const _0x31275d=a51_0x3d5806;this[_0x31275d(0x94)](_0x31275d(0xa5),{'type':'COINTOPAY_ERROR',..._0x516d29});}[a51_0x3d5806(0xa8)](_0x3e5eaf,_0x3ac197,_0x148af7,_0x2e99d9,_0x356d7f,_0xf40d92){const _0x54c362=a51_0x3d5806;this[_0x54c362(0x94)]('shop_webhooks_sent',{'type':_0x54c362(0xce),'shopId':_0x3e5eaf,'webhookUrl':_0x3ac197,'event':_0x148af7,'status':_0x2e99d9,'responseTime':_0x356d7f,'payload':_0xf40d92});}[a51_0x3d5806(0xa4)](_0x4b949d,_0x1dc835,_0x4459d9,_0x2d2151,_0x122f37){const _0x4f43a5=a51_0x3d5806;this[_0x4f43a5(0x94)](_0x4f43a5(0xcd),{'type':_0x4f43a5(0x8e),'shopId':_0x4b949d,'webhookUrl':_0x1dc835,'event':_0x4459d9,'error':_0x2d2151 instanceof Error?{'message':_0x2d2151[_0x4f43a5(0x8d)],'stack':_0x2d2151[_0x4f43a5(0xbe)]}:_0x2d2151,'payload':_0x122f37});}[a51_0x3d5806(0xac)](_0x59daa6,_0x4647e7,_0x3c408f,_0x40027e,_0x486789){const _0x4e0643=a51_0x3d5806;this[_0x4e0643(0x94)](_0x4e0643(0xb0),{'type':_0x4e0643(0xc2),'gateway':_0x59daa6,'paymentId':_0x4647e7,'shopId':_0x3c408f,'amount':_0x40027e,'currency':_0x486789});}['logApiCall'](_0x27265f,_0x4049ad,_0x5cee61,_0x5fdb12,_0x51c423){const _0x1b9ec0=a51_0x3d5806;this['writeLog'](_0x1b9ec0(0x93),{'type':_0x1b9ec0(0x7b),'endpoint':_0x27265f,'method':_0x4049ad,'userId':_0x5cee61,'userRole':_0x5fdb12,'requestData':_0x51c423});}[a51_0x3d5806(0x81)](){const _0x4adf68=a51_0x3d5806;try{const _0x2555a1=fs_1[_0x4adf68(0x87)][_0x4adf68(0x7f)](this[_0x4adf68(0x90)]),_0x482bc8=_0x2555a1[_0x4adf68(0xb7)](_0x43174d=>_0x43174d[_0x4adf68(0x9c)](_0x4adf68(0x84))),_0xcad3d7=[...new Set(_0x482bc8[_0x4adf68(0xa9)](_0x40ec2b=>_0x40ec2b[_0x4adf68(0xaf)]('_')[0x0]))],_0x5e736e=_0x482bc8['map'](_0x2aa2e7=>{const _0x526e12=_0x4adf68,_0x47e34b=path_1[_0x526e12(0x87)][_0x526e12(0x9d)](this[_0x526e12(0x90)],_0x2aa2e7),_0x2e463f=fs_1['default'][_0x526e12(0xc4)](_0x47e34b),[_0x2d3e02,_0x5d145d]=_0x2aa2e7['replace']('.log','')['split']('_');return{'type':_0x2d3e02,'date':_0x5d145d,'size':_0x2e463f[_0x526e12(0xa7)]};})[_0x4adf68(0x88)]((_0x5e8d8c,_0x5aeb37)=>_0x5aeb37[_0x4adf68(0x8f)][_0x4adf68(0xa6)](_0x5e8d8c[_0x4adf68(0x8f)]));return{'totalFiles':_0x482bc8[_0x4adf68(0x98)],'logTypes':_0xcad3d7,'latestLogs':_0x5e736e[_0x4adf68(0xb3)](0x0,0xa)};}catch(_0x3b2bac){return console[_0x4adf68(0xa1)]('Failed\x20to\x20get\x20log\x20stats:',_0x3b2bac),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x3d5806(0x86)](_0x2044a1=0x1e){const _0x5b49e6=a51_0x3d5806;try{const _0x132de6=fs_1['default'][_0x5b49e6(0x7f)](this[_0x5b49e6(0x90)]),_0xe40fef=new Date();_0xe40fef[_0x5b49e6(0x8c)](_0xe40fef[_0x5b49e6(0xaa)]()-_0x2044a1);let _0x4e691a=0x0;_0x132de6[_0x5b49e6(0x8b)](_0x3be3d0=>{const _0x1ed30f=_0x5b49e6;if(!_0x3be3d0[_0x1ed30f(0x9c)](_0x1ed30f(0x84)))return;const _0x5a439a=path_1['default'][_0x1ed30f(0x9d)](this[_0x1ed30f(0x90)],_0x3be3d0),_0xce95b5=fs_1['default'][_0x1ed30f(0xc4)](_0x5a439a);_0xce95b5[_0x1ed30f(0x7c)]<_0xe40fef&&(fs_1[_0x1ed30f(0x87)][_0x1ed30f(0xcf)](_0x5a439a),_0x4e691a++,console[_0x1ed30f(0xc1)](_0x1ed30f(0xcc)+_0x3be3d0));}),console[_0x5b49e6(0xc1)](_0x5b49e6(0x96)+_0x4e691a+_0x5b49e6(0xad)+_0x2044a1+'\x20days)');}catch(_0x201d64){console['error'](_0x5b49e6(0xa0),_0x201d64);}}}function a51_0xae52(_0x2aad89,_0x1ce888){const _0x12dc87=a51_0x12dc();return a51_0xae52=function(_0xae5259,_0x468351){_0xae5259=_0xae5259-0x7b;let _0x386dd3=_0x12dc87[_0xae5259];return _0x386dd3;},a51_0xae52(_0x2aad89,_0x1ce888);}exports[a51_0x3d5806(0xc8)]=LoggerService,exports['loggerService']=new LoggerService();