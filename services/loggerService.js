'use strict';function a55_0x539a(_0x50b7c3,_0x3c194f){const _0x38d59e=a55_0x38d5();return a55_0x539a=function(_0x539a4d,_0x245ad0){_0x539a4d=_0x539a4d-0xeb;let _0x2f8497=_0x38d59e[_0x539a4d];return _0x2f8497;},a55_0x539a(_0x50b7c3,_0x3c194f);}const a55_0xd79238=a55_0x539a;function a55_0x38d5(){const _0x5573c2=['writeLog','join','forEach','RESPONSE','230548arohGO','mkdirSync','Failed\x20to\x20get\x20log\x20stats:','COINTOPAY_ERROR','📁\x20Created\x20logs\x20directory:\x20','setDate','PAYMENT_CREATED','webhooks_errors','stringify','\x20log:','loggerService','🧹\x20Cleaned\x20','LoggerService','toISOString','WEBHOOK_ERROR','statSync','replace','size','readdirSync','__importDefault','white_domain_requests','getDate','cwd','2721270PjKDIP','2363900dLvLtP','logWebhookError','cleanOldLogs','logWebhookProcessed','unlinkSync','WEBHOOK_PROCESSED','.log','payments_created','10DQUlEg','getLogFileName','webhooks_processed','logShopWebhookError','error','stack','logPaymentCreated','logShopWebhookSent','logWhiteDomainRequest','map','localeCompare','message','endsWith','logs','split','log','ensureLogsDirectory','286930zoBvBN','mtime','logsDir','logWhiteDomainResponse','white_domain_responses','324459fVIZiA','existsSync','COINTOPAY_STATUS_CHANGE','cointopay_status_changes','861522XsqFdz','1511604DNlhrO','API_CALL','logWebhookReceived','api_calls','path','filter','Failed\x20to\x20clean\x20old\x20logs:','date','logApiCall','shop_webhooks_sent','sort','496VrHQvG','default','Failed\x20to\x20write\x20'];a55_0x38d5=function(){return _0x5573c2;};return a55_0x38d5();}(function(_0x239748,_0x56da23){const _0x5cea55=a55_0x539a,_0x42aacc=_0x239748();while(!![]){try{const _0x3d7764=parseInt(_0x5cea55(0x11a))/0x1+parseInt(_0x5cea55(0x107))/0x2+parseInt(_0x5cea55(0x131))/0x3+parseInt(_0x5cea55(0x132))/0x4+-parseInt(_0x5cea55(0xed))/0x5*(-parseInt(_0x5cea55(0x108))/0x6)+parseInt(_0x5cea55(0xfe))/0x7+parseInt(_0x5cea55(0x113))/0x8*(-parseInt(_0x5cea55(0x103))/0x9);if(_0x3d7764===_0x56da23)break;else _0x42aacc['push'](_0x42aacc['shift']());}catch(_0x18662c){_0x42aacc['push'](_0x42aacc['shift']());}}}(a55_0x38d5,0x7284e));var __importDefault=this&&this[a55_0xd79238(0x12d)]||function(_0x34b76f){return _0x34b76f&&_0x34b76f['__esModule']?_0x34b76f:{'default':_0x34b76f};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a55_0xd79238(0x124)]=exports[a55_0xd79238(0x126)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a55_0xd79238(0x10c)));class LoggerService{constructor(){const _0x18b033=a55_0xd79238;this[_0x18b033(0x100)]=path_1['default'][_0x18b033(0x117)](process[_0x18b033(0x130)](),_0x18b033(0xfa)),this[_0x18b033(0xfd)]();}['ensureLogsDirectory'](){const _0x4cfb69=a55_0xd79238;!fs_1['default'][_0x4cfb69(0x104)](this[_0x4cfb69(0x100)])&&(fs_1[_0x4cfb69(0x114)][_0x4cfb69(0x11b)](this['logsDir'],{'recursive':!![]}),console['log'](_0x4cfb69(0x11e)+this[_0x4cfb69(0x100)]));}[a55_0xd79238(0xee)](_0x3dbd13){const _0x3dd48d=a55_0xd79238,_0x5a72d5=new Date()['toISOString']()['split']('T')[0x0];return path_1['default'][_0x3dd48d(0x117)](this[_0x3dd48d(0x100)],_0x3dbd13+'_'+_0x5a72d5+_0x3dd48d(0xeb));}[a55_0xd79238(0x116)](_0xd84220,_0xb2065e){const _0x3c4705=a55_0xd79238;try{const _0x3e4efe=new Date()[_0x3c4705(0x127)](),_0x3460f8={'timestamp':_0x3e4efe,..._0xb2065e},_0x4585fb=JSON[_0x3c4705(0x122)](_0x3460f8)+'\x0a',_0x278551=this[_0x3c4705(0xee)](_0xd84220);fs_1[_0x3c4705(0x114)]['appendFileSync'](_0x278551,_0x4585fb,'utf8');}catch(_0x1c09b8){console[_0x3c4705(0xf1)](_0x3c4705(0x115)+_0xd84220+_0x3c4705(0x123),_0x1c09b8);}}[a55_0xd79238(0xf5)](_0x1f6d48,_0x855dd8,_0x204bc3,_0x447413){const _0x3438a1=a55_0xd79238;this[_0x3438a1(0x116)](_0x3438a1(0x12e),{'type':'REQUEST','gateway':_0x1f6d48,'endpoint':_0x855dd8,'method':_0x204bc3,'data':_0x447413});}[a55_0xd79238(0x101)](_0x107faf,_0x38b57b,_0x383f68,_0x1a3291,_0x5bf6a1){const _0x32c93a=a55_0xd79238;this['writeLog'](_0x32c93a(0x102),{'type':_0x32c93a(0x119),'gateway':_0x107faf,'endpoint':_0x38b57b,'status':_0x383f68,'responseTime':_0x5bf6a1,'data':_0x1a3291});}['logWhiteDomainError'](_0x52a86a,_0x5c2b3c,_0x104350){const _0x3bace2=a55_0xd79238;this[_0x3bace2(0x116)]('white_domain_errors',{'type':'ERROR','gateway':_0x52a86a,'endpoint':_0x5c2b3c,'error':_0x104350 instanceof Error?{'message':_0x104350[_0x3bace2(0xf8)],'stack':_0x104350[_0x3bace2(0xf2)]}:_0x104350});}[a55_0xd79238(0x10a)](_0x27f874,_0x5a548b,_0x25e9fd){const _0x39fc17=a55_0xd79238;this[_0x39fc17(0x116)]('webhooks_received',{'type':'WEBHOOK_RECEIVED','gateway':_0x27f874,'headers':_0x25e9fd,'data':_0x5a548b});}[a55_0xd79238(0x135)](_0x4adc5d,_0x35702b,_0x518a60,_0x21bd03,_0x22101c){const _0x5d0560=a55_0xd79238;this[_0x5d0560(0x116)](_0x5d0560(0xef),{'type':_0x5d0560(0x137),'gateway':_0x4adc5d,'paymentId':_0x35702b,'oldStatus':_0x518a60,'newStatus':_0x21bd03,'originalData':_0x22101c});}[a55_0xd79238(0x133)](_0x500613,_0x192ab9,_0x1f3a8a){const _0x1b59f5=a55_0xd79238;this[_0x1b59f5(0x116)](_0x1b59f5(0x121),{'type':_0x1b59f5(0x128),'gateway':_0x500613,'error':_0x192ab9 instanceof Error?{'message':_0x192ab9['message'],'stack':_0x192ab9[_0x1b59f5(0xf2)]}:_0x192ab9,'originalData':_0x1f3a8a});}['logCoinToPayStatus'](_0x49a774){const _0x253428=a55_0xd79238;this[_0x253428(0x116)](_0x253428(0x106),{'type':_0x253428(0x105),..._0x49a774});}['logCoinToPayError'](_0x1f1497){const _0x2adc7b=a55_0xd79238;this['writeLog']('cointopay_errors',{'type':_0x2adc7b(0x11d),..._0x1f1497});}[a55_0xd79238(0xf4)](_0xb99d27,_0x287d96,_0xa637e8,_0x42ee84,_0x35dd55,_0x19fb04){const _0x1f68dc=a55_0xd79238;this[_0x1f68dc(0x116)](_0x1f68dc(0x111),{'type':'SHOP_WEBHOOK_SENT','shopId':_0xb99d27,'webhookUrl':_0x287d96,'event':_0xa637e8,'status':_0x42ee84,'responseTime':_0x35dd55,'payload':_0x19fb04});}[a55_0xd79238(0xf0)](_0x2b66cc,_0x422235,_0x49e013,_0x4882ea,_0x3e009d){const _0x5b6252=a55_0xd79238;this['writeLog']('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x2b66cc,'webhookUrl':_0x422235,'event':_0x49e013,'error':_0x4882ea instanceof Error?{'message':_0x4882ea[_0x5b6252(0xf8)],'stack':_0x4882ea[_0x5b6252(0xf2)]}:_0x4882ea,'payload':_0x3e009d});}[a55_0xd79238(0xf3)](_0x33f1fb,_0x4e41f7,_0x1abcb9,_0x58d585,_0x1c0e32){const _0x555a93=a55_0xd79238;this[_0x555a93(0x116)](_0x555a93(0xec),{'type':_0x555a93(0x120),'gateway':_0x33f1fb,'paymentId':_0x4e41f7,'shopId':_0x1abcb9,'amount':_0x58d585,'currency':_0x1c0e32});}[a55_0xd79238(0x110)](_0x4023e8,_0x1e516f,_0x3fd1ab,_0x4bae6c,_0x1f84fc){const _0x235827=a55_0xd79238;this['writeLog'](_0x235827(0x10b),{'type':_0x235827(0x109),'endpoint':_0x4023e8,'method':_0x1e516f,'userId':_0x3fd1ab,'userRole':_0x4bae6c,'requestData':_0x1f84fc});}['getLogStats'](){const _0x5c354b=a55_0xd79238;try{const _0x215fdd=fs_1[_0x5c354b(0x114)]['readdirSync'](this['logsDir']),_0x2ff90a=_0x215fdd[_0x5c354b(0x10d)](_0x1e91ca=>_0x1e91ca[_0x5c354b(0xf9)](_0x5c354b(0xeb))),_0x24325b=[...new Set(_0x2ff90a[_0x5c354b(0xf6)](_0x5ef4a9=>_0x5ef4a9[_0x5c354b(0xfb)]('_')[0x0]))],_0x54c8c6=_0x2ff90a[_0x5c354b(0xf6)](_0x585fb9=>{const _0x3f0e69=_0x5c354b,_0x3d5961=path_1[_0x3f0e69(0x114)]['join'](this[_0x3f0e69(0x100)],_0x585fb9),_0x584698=fs_1[_0x3f0e69(0x114)][_0x3f0e69(0x129)](_0x3d5961),[_0x48260b,_0x578a35]=_0x585fb9[_0x3f0e69(0x12a)](_0x3f0e69(0xeb),'')[_0x3f0e69(0xfb)]('_');return{'type':_0x48260b,'date':_0x578a35,'size':_0x584698[_0x3f0e69(0x12b)]};})[_0x5c354b(0x112)]((_0x14a200,_0x4aac61)=>_0x4aac61[_0x5c354b(0x10f)][_0x5c354b(0xf7)](_0x14a200[_0x5c354b(0x10f)]));return{'totalFiles':_0x2ff90a['length'],'logTypes':_0x24325b,'latestLogs':_0x54c8c6['slice'](0x0,0xa)};}catch(_0x47e546){return console['error'](_0x5c354b(0x11c),_0x47e546),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a55_0xd79238(0x134)](_0x5c559a=0x1e){const _0x303655=a55_0xd79238;try{const _0x279df3=fs_1[_0x303655(0x114)][_0x303655(0x12c)](this[_0x303655(0x100)]),_0xd92b4f=new Date();_0xd92b4f[_0x303655(0x11f)](_0xd92b4f[_0x303655(0x12f)]()-_0x5c559a);let _0x24ad5f=0x0;_0x279df3[_0x303655(0x118)](_0x625718=>{const _0x1bcdcf=_0x303655;if(!_0x625718[_0x1bcdcf(0xf9)](_0x1bcdcf(0xeb)))return;const _0x13485c=path_1['default'][_0x1bcdcf(0x117)](this['logsDir'],_0x625718),_0x5b8b35=fs_1[_0x1bcdcf(0x114)][_0x1bcdcf(0x129)](_0x13485c);_0x5b8b35[_0x1bcdcf(0xff)]<_0xd92b4f&&(fs_1[_0x1bcdcf(0x114)][_0x1bcdcf(0x136)](_0x13485c),_0x24ad5f++,console[_0x1bcdcf(0xfc)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x625718));}),console['log'](_0x303655(0x125)+_0x24ad5f+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x5c559a+'\x20days)');}catch(_0x89e665){console[_0x303655(0xf1)](_0x303655(0x10e),_0x89e665);}}}exports[a55_0xd79238(0x126)]=LoggerService,exports[a55_0xd79238(0x124)]=new LoggerService();