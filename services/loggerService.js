'use strict';function a44_0xc138(){const _0x1ec465=['logShopWebhookError','loggerService','forEach','Failed\x20to\x20clean\x20old\x20logs:','logWhiteDomainRequest','cleanOldLogs','RESPONSE','996854unbyjd','webhooks_errors','api_calls','default','4733504NEoyIe','WEBHOOK_RECEIVED','cointopay_errors','WEBHOOK_ERROR','mtime','logWhiteDomainError','toISOString','logCoinToPayError','setDate','7OMWRti','getLogStats','join','logWhiteDomainResponse','2lJCzhU','LoggerService','payments_created','stringify','PAYMENT_CREATED','readdirSync','ğŸ“\x20Created\x20logs\x20directory:\x20','REQUEST','writeLog','Failed\x20to\x20get\x20log\x20stats:','appendFileSync','unlinkSync','stack','3447726vZxmaX','mkdirSync','WEBHOOK_PROCESSED','white_domain_responses','error','.log','ğŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20','white_domain_errors','15530670irRCJK','white_domain_requests','__esModule','split','490467mEnUFK','getLogFileName','logPaymentCreated','API_CALL','__importDefault','webhooks_processed','ensureLogsDirectory','utf8','cwd','length','statSync','endsWith','ERROR','getDate','log','4720735OHMKnM','logShopWebhookSent','date','logWebhookProcessed','defineProperty','existsSync','logsDir','logCoinToPayStatus','path','map','\x20old\x20log\x20files\x20(older\x20than\x20','webhooks_received','ğŸ§¹\x20Cleaned\x20','message','slice','1941664phQuqg'];a44_0xc138=function(){return _0x1ec465;};return a44_0xc138();}const a44_0x1d3e11=a44_0x5dd8;(function(_0x1cfa12,_0x50e627){const _0x299136=a44_0x5dd8,_0x23ebdb=_0x1cfa12();while(!![]){try{const _0x37f4a6=parseInt(_0x299136(0x13f))/0x1*(parseInt(_0x299136(0x12e))/0x2)+-parseInt(_0x299136(0x108))/0x3+parseInt(_0x299136(0x126))/0x4+parseInt(_0x299136(0x117))/0x5+-parseInt(_0x299136(0xfc))/0x6*(-parseInt(_0x299136(0x13b))/0x7)+-parseInt(_0x299136(0x132))/0x8+-parseInt(_0x299136(0x104))/0x9;if(_0x37f4a6===_0x50e627)break;else _0x23ebdb['push'](_0x23ebdb['shift']());}catch(_0x3e8b22){_0x23ebdb['push'](_0x23ebdb['shift']());}}}(a44_0xc138,0x7f027));var __importDefault=this&&this[a44_0x1d3e11(0x10c)]||function(_0x2bd43f){return _0x2bd43f&&_0x2bd43f['__esModule']?_0x2bd43f:{'default':_0x2bd43f};};function a44_0x5dd8(_0x4746e2,_0x575fbe){const _0xc138a1=a44_0xc138();return a44_0x5dd8=function(_0x5dd8e6,_0x41a450){_0x5dd8e6=_0x5dd8e6-0xf5;let _0x57b35c=_0xc138a1[_0x5dd8e6];return _0x57b35c;},a44_0x5dd8(_0x4746e2,_0x575fbe);}Object[a44_0x1d3e11(0x11b)](exports,a44_0x1d3e11(0x106),{'value':!![]}),exports[a44_0x1d3e11(0x128)]=exports[a44_0x1d3e11(0x140)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a44_0x1d3e11(0x11f)));class LoggerService{constructor(){const _0xeaafd4=a44_0x1d3e11;this[_0xeaafd4(0x11d)]=path_1[_0xeaafd4(0x131)]['join'](process[_0xeaafd4(0x110)](),'logs'),this['ensureLogsDirectory']();}[a44_0x1d3e11(0x10e)](){const _0x52ed56=a44_0x1d3e11;!fs_1[_0x52ed56(0x131)][_0x52ed56(0x11c)](this[_0x52ed56(0x11d)])&&(fs_1[_0x52ed56(0x131)][_0x52ed56(0xfd)](this[_0x52ed56(0x11d)],{'recursive':!![]}),console[_0x52ed56(0x116)](_0x52ed56(0xf5)+this[_0x52ed56(0x11d)]));}[a44_0x1d3e11(0x109)](_0x3a2bf9){const _0x1621b5=a44_0x1d3e11,_0x1885da=new Date()[_0x1621b5(0x138)]()['split']('T')[0x0];return path_1[_0x1621b5(0x131)][_0x1621b5(0x13d)](this[_0x1621b5(0x11d)],_0x3a2bf9+'_'+_0x1885da+'.log');}['writeLog'](_0x46dcbd,_0x5a7081){const _0x409e78=a44_0x1d3e11;try{const _0x2562c0=new Date()[_0x409e78(0x138)](),_0x3ddad4={'timestamp':_0x2562c0,..._0x5a7081},_0x36cea8=JSON[_0x409e78(0x142)](_0x3ddad4)+'\x0a',_0x3af818=this[_0x409e78(0x109)](_0x46dcbd);fs_1[_0x409e78(0x131)][_0x409e78(0xf9)](_0x3af818,_0x36cea8,_0x409e78(0x10f));}catch(_0x35afd4){console[_0x409e78(0x100)]('Failed\x20to\x20write\x20'+_0x46dcbd+'\x20log:',_0x35afd4);}}[a44_0x1d3e11(0x12b)](_0x5eeca2,_0x32770,_0x30cf97,_0x5be287){const _0x5981d3=a44_0x1d3e11;this['writeLog'](_0x5981d3(0x105),{'type':_0x5981d3(0xf6),'gateway':_0x5eeca2,'endpoint':_0x32770,'method':_0x30cf97,'data':_0x5be287});}[a44_0x1d3e11(0x13e)](_0x2c0a3e,_0x586435,_0x2c591d,_0x12f508,_0x37d67f){const _0x76edab=a44_0x1d3e11;this['writeLog'](_0x76edab(0xff),{'type':_0x76edab(0x12d),'gateway':_0x2c0a3e,'endpoint':_0x586435,'status':_0x2c591d,'responseTime':_0x37d67f,'data':_0x12f508});}[a44_0x1d3e11(0x137)](_0x4700cc,_0x25153d,_0x22c5d1){const _0x2db967=a44_0x1d3e11;this[_0x2db967(0xf7)](_0x2db967(0x103),{'type':_0x2db967(0x114),'gateway':_0x4700cc,'endpoint':_0x25153d,'error':_0x22c5d1 instanceof Error?{'message':_0x22c5d1[_0x2db967(0x124)],'stack':_0x22c5d1[_0x2db967(0xfb)]}:_0x22c5d1});}['logWebhookReceived'](_0x95e1e,_0x2110c6,_0x2f653b){const _0x195ffc=a44_0x1d3e11;this[_0x195ffc(0xf7)](_0x195ffc(0x122),{'type':_0x195ffc(0x133),'gateway':_0x95e1e,'headers':_0x2f653b,'data':_0x2110c6});}[a44_0x1d3e11(0x11a)](_0x5e1ed8,_0x5b421b,_0x356b6c,_0x17f9f0,_0x2f4e09){const _0x28d7bd=a44_0x1d3e11;this[_0x28d7bd(0xf7)](_0x28d7bd(0x10d),{'type':_0x28d7bd(0xfe),'gateway':_0x5e1ed8,'paymentId':_0x5b421b,'oldStatus':_0x356b6c,'newStatus':_0x17f9f0,'originalData':_0x2f4e09});}['logWebhookError'](_0x2309a7,_0x26c136,_0x24ef9a){const _0x310797=a44_0x1d3e11;this['writeLog'](_0x310797(0x12f),{'type':_0x310797(0x135),'gateway':_0x2309a7,'error':_0x26c136 instanceof Error?{'message':_0x26c136[_0x310797(0x124)],'stack':_0x26c136[_0x310797(0xfb)]}:_0x26c136,'originalData':_0x24ef9a});}[a44_0x1d3e11(0x11e)](_0x141397){const _0xa6182d=a44_0x1d3e11;this[_0xa6182d(0xf7)]('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x141397});}[a44_0x1d3e11(0x139)](_0x5a3616){const _0x260f76=a44_0x1d3e11;this['writeLog'](_0x260f76(0x134),{'type':'COINTOPAY_ERROR',..._0x5a3616});}[a44_0x1d3e11(0x118)](_0x24916d,_0x39afc1,_0x1c7a31,_0x106d7a,_0x3bdc24,_0x5975e2){const _0x454f10=a44_0x1d3e11;this[_0x454f10(0xf7)]('shop_webhooks_sent',{'type':'SHOP_WEBHOOK_SENT','shopId':_0x24916d,'webhookUrl':_0x39afc1,'event':_0x1c7a31,'status':_0x106d7a,'responseTime':_0x3bdc24,'payload':_0x5975e2});}[a44_0x1d3e11(0x127)](_0xcab0f6,_0x5ec2e4,_0x26f8d4,_0x463fe8,_0x28c582){const _0x4384ea=a44_0x1d3e11;this[_0x4384ea(0xf7)]('shop_webhooks_errors',{'type':'SHOP_WEBHOOK_ERROR','shopId':_0xcab0f6,'webhookUrl':_0x5ec2e4,'event':_0x26f8d4,'error':_0x463fe8 instanceof Error?{'message':_0x463fe8[_0x4384ea(0x124)],'stack':_0x463fe8[_0x4384ea(0xfb)]}:_0x463fe8,'payload':_0x28c582});}[a44_0x1d3e11(0x10a)](_0x8fa657,_0x5d47f8,_0x532cec,_0x295ebf,_0x562e59){const _0x217641=a44_0x1d3e11;this[_0x217641(0xf7)](_0x217641(0x141),{'type':_0x217641(0x143),'gateway':_0x8fa657,'paymentId':_0x5d47f8,'shopId':_0x532cec,'amount':_0x295ebf,'currency':_0x562e59});}['logApiCall'](_0x571712,_0x2cf5d7,_0x3da5a6,_0x3e4121,_0x310f2c){const _0x390b59=a44_0x1d3e11;this[_0x390b59(0xf7)](_0x390b59(0x130),{'type':_0x390b59(0x10b),'endpoint':_0x571712,'method':_0x2cf5d7,'userId':_0x3da5a6,'userRole':_0x3e4121,'requestData':_0x310f2c});}[a44_0x1d3e11(0x13c)](){const _0x1e12f1=a44_0x1d3e11;try{const _0x36b1b5=fs_1[_0x1e12f1(0x131)][_0x1e12f1(0x144)](this[_0x1e12f1(0x11d)]),_0xdee89a=_0x36b1b5['filter'](_0x4d7bd6=>_0x4d7bd6[_0x1e12f1(0x113)](_0x1e12f1(0x101))),_0x24c9d4=[...new Set(_0xdee89a[_0x1e12f1(0x120)](_0x1086c7=>_0x1086c7[_0x1e12f1(0x107)]('_')[0x0]))],_0x3555d0=_0xdee89a[_0x1e12f1(0x120)](_0x5b33b8=>{const _0x1b7863=_0x1e12f1,_0x3ae1e4=path_1['default'][_0x1b7863(0x13d)](this[_0x1b7863(0x11d)],_0x5b33b8),_0x4dfbc7=fs_1['default'][_0x1b7863(0x112)](_0x3ae1e4),[_0x349264,_0x226d10]=_0x5b33b8['replace'](_0x1b7863(0x101),'')[_0x1b7863(0x107)]('_');return{'type':_0x349264,'date':_0x226d10,'size':_0x4dfbc7['size']};})['sort']((_0x275d41,_0x13ffc0)=>_0x13ffc0[_0x1e12f1(0x119)]['localeCompare'](_0x275d41['date']));return{'totalFiles':_0xdee89a[_0x1e12f1(0x111)],'logTypes':_0x24c9d4,'latestLogs':_0x3555d0[_0x1e12f1(0x125)](0x0,0xa)};}catch(_0x4aa266){return console[_0x1e12f1(0x100)](_0x1e12f1(0xf8),_0x4aa266),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a44_0x1d3e11(0x12c)](_0x5eb120=0x1e){const _0x6b4880=a44_0x1d3e11;try{const _0x199bb1=fs_1[_0x6b4880(0x131)]['readdirSync'](this['logsDir']),_0x2783c9=new Date();_0x2783c9[_0x6b4880(0x13a)](_0x2783c9[_0x6b4880(0x115)]()-_0x5eb120);let _0x4f092d=0x0;_0x199bb1[_0x6b4880(0x129)](_0x29cd37=>{const _0x200e1b=_0x6b4880;if(!_0x29cd37['endsWith'](_0x200e1b(0x101)))return;const _0x422d67=path_1[_0x200e1b(0x131)][_0x200e1b(0x13d)](this[_0x200e1b(0x11d)],_0x29cd37),_0x3adab6=fs_1['default'][_0x200e1b(0x112)](_0x422d67);_0x3adab6[_0x200e1b(0x136)]<_0x2783c9&&(fs_1[_0x200e1b(0x131)][_0x200e1b(0xfa)](_0x422d67),_0x4f092d++,console[_0x200e1b(0x116)](_0x200e1b(0x102)+_0x29cd37));}),console[_0x6b4880(0x116)](_0x6b4880(0x123)+_0x4f092d+_0x6b4880(0x121)+_0x5eb120+'\x20days)');}catch(_0x9d7893){console[_0x6b4880(0x100)](_0x6b4880(0x12a),_0x9d7893);}}}exports[a44_0x1d3e11(0x140)]=LoggerService,exports['loggerService']=new LoggerService();