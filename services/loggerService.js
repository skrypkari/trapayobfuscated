'use strict';const a48_0x3b725b=a48_0xf6bb;(function(_0x340cbc,_0x39b233){const _0x244984=a48_0xf6bb,_0x5a3ec9=_0x340cbc();while(!![]){try{const _0x321477=-parseInt(_0x244984(0x1be))/0x1*(parseInt(_0x244984(0x1d5))/0x2)+-parseInt(_0x244984(0x1f0))/0x3+-parseInt(_0x244984(0x1c4))/0x4*(parseInt(_0x244984(0x1d3))/0x5)+parseInt(_0x244984(0x1e0))/0x6+parseInt(_0x244984(0x1d9))/0x7+-parseInt(_0x244984(0x1e5))/0x8+parseInt(_0x244984(0x1ba))/0x9;if(_0x321477===_0x39b233)break;else _0x5a3ec9['push'](_0x5a3ec9['shift']());}catch(_0x1b6335){_0x5a3ec9['push'](_0x5a3ec9['shift']());}}}(a48_0xd31e,0x27a63));function a48_0xf6bb(_0x172c5c,_0x25f3c8){const _0xd31e6c=a48_0xd31e();return a48_0xf6bb=function(_0xf6bbb1,_0x574c75){_0xf6bbb1=_0xf6bbb1-0x1ae;let _0x4595ee=_0xd31e6c[_0xf6bbb1];return _0x4595ee;},a48_0xf6bb(_0x172c5c,_0x25f3c8);}var __importDefault=this&&this[a48_0x3b725b(0x1b7)]||function(_0x455c9f){const _0x1febc7=a48_0x3b725b;return _0x455c9f&&_0x455c9f[_0x1febc7(0x1c3)]?_0x455c9f:{'default':_0x455c9f};};Object[a48_0x3b725b(0x1b9)](exports,a48_0x3b725b(0x1c3),{'value':!![]}),exports[a48_0x3b725b(0x1e4)]=exports[a48_0x3b725b(0x1c6)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x3b725b(0x1c0)));function a48_0xd31e(){const _0x489d66=['log','logWebhookProcessed','ensureLogsDirectory','endsWith','utf8','filter','WEBHOOK_RECEIVED','getLogStats','white_domain_requests','payments_created','cwd','__importDefault','shop_webhooks_errors','defineProperty','6182136FXfWih','WEBHOOK_ERROR','webhooks_received','\x20old\x20log\x20files\x20(older\x20than\x20','8wZjDOK','getLogFileName','path','Failed\x20to\x20clean\x20old\x20logs:','white_domain_errors','__esModule','116neQZQW','COINTOPAY_STATUS_CHANGE','LoggerService','api_calls','API_CALL','logWebhookReceived','mtime','message','🗑️\x20Deleted\x20old\x20log\x20file:\x20','localeCompare','logWebhookError','white_domain_responses','logWhiteDomainRequest','webhooks_errors','stringify','27660qiKOiX','appendFileSync','79118ajEcir','cointopay_errors','error','existsSync','759304BABbZp','📁\x20Created\x20logs\x20directory:\x20','logShopWebhookError','readdirSync','toISOString','map','logApiCall','686838lYprAr','statSync','RESPONSE','PAYMENT_CREATED','loggerService','1921704iufwnJ','.log','logPaymentCreated','logWhiteDomainError','logsDir','shop_webhooks_sent','logCoinToPayStatus','writeLog','join','length','stack','90999ByvrBj','sort','logCoinToPayError','unlinkSync','default','split','logWhiteDomainResponse'];a48_0xd31e=function(){return _0x489d66;};return a48_0xd31e();}class LoggerService{constructor(){const _0x57bdac=a48_0x3b725b;this['logsDir']=path_1[_0x57bdac(0x1f4)][_0x57bdac(0x1ed)](process[_0x57bdac(0x1b6)](),'logs'),this['ensureLogsDirectory']();}[a48_0x3b725b(0x1ae)](){const _0x2957ac=a48_0x3b725b;!fs_1[_0x2957ac(0x1f4)][_0x2957ac(0x1d8)](this[_0x2957ac(0x1e9)])&&(fs_1[_0x2957ac(0x1f4)]['mkdirSync'](this[_0x2957ac(0x1e9)],{'recursive':!![]}),console['log'](_0x2957ac(0x1da)+this['logsDir']));}['getLogFileName'](_0x3d42ce){const _0x1d11ba=a48_0x3b725b,_0x535aee=new Date()[_0x1d11ba(0x1dd)]()[_0x1d11ba(0x1f5)]('T')[0x0];return path_1[_0x1d11ba(0x1f4)][_0x1d11ba(0x1ed)](this['logsDir'],_0x3d42ce+'_'+_0x535aee+_0x1d11ba(0x1e6));}[a48_0x3b725b(0x1ec)](_0x195bd7,_0x41f6dc){const _0x145e62=a48_0x3b725b;try{const _0x6f3937=new Date()[_0x145e62(0x1dd)](),_0x26e5f8={'timestamp':_0x6f3937,..._0x41f6dc},_0x24113c=JSON[_0x145e62(0x1d2)](_0x26e5f8)+'\x0a',_0x5e573f=this[_0x145e62(0x1bf)](_0x195bd7);fs_1['default'][_0x145e62(0x1d4)](_0x5e573f,_0x24113c,_0x145e62(0x1b0));}catch(_0x526d80){console[_0x145e62(0x1d7)]('Failed\x20to\x20write\x20'+_0x195bd7+'\x20log:',_0x526d80);}}[a48_0x3b725b(0x1d0)](_0x54d86b,_0xd8e7d9,_0x58b6d2,_0x133b9e){const _0x5ccd40=a48_0x3b725b;this['writeLog'](_0x5ccd40(0x1b4),{'type':'REQUEST','gateway':_0x54d86b,'endpoint':_0xd8e7d9,'method':_0x58b6d2,'data':_0x133b9e});}[a48_0x3b725b(0x1f6)](_0x3c5dc7,_0xe25f77,_0x115e00,_0x408810,_0x5ccbf5){const _0x3da6de=a48_0x3b725b;this['writeLog'](_0x3da6de(0x1cf),{'type':_0x3da6de(0x1e2),'gateway':_0x3c5dc7,'endpoint':_0xe25f77,'status':_0x115e00,'responseTime':_0x5ccbf5,'data':_0x408810});}[a48_0x3b725b(0x1e8)](_0x3cd244,_0x3f6e06,_0x43d34e){const _0x51a08e=a48_0x3b725b;this['writeLog'](_0x51a08e(0x1c2),{'type':'ERROR','gateway':_0x3cd244,'endpoint':_0x3f6e06,'error':_0x43d34e instanceof Error?{'message':_0x43d34e['message'],'stack':_0x43d34e[_0x51a08e(0x1ef)]}:_0x43d34e});}[a48_0x3b725b(0x1c9)](_0x518eec,_0x3f2375,_0x75fa1d){const _0x5978c5=a48_0x3b725b;this[_0x5978c5(0x1ec)](_0x5978c5(0x1bc),{'type':_0x5978c5(0x1b2),'gateway':_0x518eec,'headers':_0x75fa1d,'data':_0x3f2375});}[a48_0x3b725b(0x1f8)](_0x1b04d5,_0xdd9298,_0x253981,_0x2021e2,_0x71356c){this['writeLog']('webhooks_processed',{'type':'WEBHOOK_PROCESSED','gateway':_0x1b04d5,'paymentId':_0xdd9298,'oldStatus':_0x253981,'newStatus':_0x2021e2,'originalData':_0x71356c});}[a48_0x3b725b(0x1ce)](_0x473397,_0x453ffe,_0x34baa2){const _0x158a42=a48_0x3b725b;this[_0x158a42(0x1ec)](_0x158a42(0x1d1),{'type':_0x158a42(0x1bb),'gateway':_0x473397,'error':_0x453ffe instanceof Error?{'message':_0x453ffe[_0x158a42(0x1cb)],'stack':_0x453ffe[_0x158a42(0x1ef)]}:_0x453ffe,'originalData':_0x34baa2});}[a48_0x3b725b(0x1eb)](_0x341b07){const _0x4062d9=a48_0x3b725b;this[_0x4062d9(0x1ec)]('cointopay_status_changes',{'type':_0x4062d9(0x1c5),..._0x341b07});}[a48_0x3b725b(0x1f2)](_0x2d272d){const _0x34b909=a48_0x3b725b;this[_0x34b909(0x1ec)](_0x34b909(0x1d6),{'type':'COINTOPAY_ERROR',..._0x2d272d});}['logShopWebhookSent'](_0x59c8c7,_0x11beff,_0x10ec62,_0x1ad448,_0x3ae305,_0x3ec580){const _0x572ac9=a48_0x3b725b;this[_0x572ac9(0x1ec)](_0x572ac9(0x1ea),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x59c8c7,'webhookUrl':_0x11beff,'event':_0x10ec62,'status':_0x1ad448,'responseTime':_0x3ae305,'payload':_0x3ec580});}[a48_0x3b725b(0x1db)](_0x3a1adb,_0x235532,_0x525cd6,_0x3844b0,_0x47e678){const _0x5bc51f=a48_0x3b725b;this['writeLog'](_0x5bc51f(0x1b8),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0x3a1adb,'webhookUrl':_0x235532,'event':_0x525cd6,'error':_0x3844b0 instanceof Error?{'message':_0x3844b0[_0x5bc51f(0x1cb)],'stack':_0x3844b0[_0x5bc51f(0x1ef)]}:_0x3844b0,'payload':_0x47e678});}[a48_0x3b725b(0x1e7)](_0x3de51a,_0x568957,_0xb3966d,_0x5b88a5,_0x46c087){const _0x38e9f8=a48_0x3b725b;this[_0x38e9f8(0x1ec)](_0x38e9f8(0x1b5),{'type':_0x38e9f8(0x1e3),'gateway':_0x3de51a,'paymentId':_0x568957,'shopId':_0xb3966d,'amount':_0x5b88a5,'currency':_0x46c087});}[a48_0x3b725b(0x1df)](_0x5234ae,_0x53ce69,_0x389114,_0x30f6c4,_0x470f7e){const _0x24aa99=a48_0x3b725b;this[_0x24aa99(0x1ec)](_0x24aa99(0x1c7),{'type':_0x24aa99(0x1c8),'endpoint':_0x5234ae,'method':_0x53ce69,'userId':_0x389114,'userRole':_0x30f6c4,'requestData':_0x470f7e});}[a48_0x3b725b(0x1b3)](){const _0x51a218=a48_0x3b725b;try{const _0x34bd5b=fs_1[_0x51a218(0x1f4)][_0x51a218(0x1dc)](this[_0x51a218(0x1e9)]),_0x5f34bc=_0x34bd5b[_0x51a218(0x1b1)](_0x181eb7=>_0x181eb7[_0x51a218(0x1af)](_0x51a218(0x1e6))),_0x1cdddf=[...new Set(_0x5f34bc[_0x51a218(0x1de)](_0x136f88=>_0x136f88[_0x51a218(0x1f5)]('_')[0x0]))],_0x4a24dc=_0x5f34bc[_0x51a218(0x1de)](_0x461d3e=>{const _0x552e97=_0x51a218,_0x43d0fc=path_1['default']['join'](this[_0x552e97(0x1e9)],_0x461d3e),_0x5ad77b=fs_1[_0x552e97(0x1f4)][_0x552e97(0x1e1)](_0x43d0fc),[_0x1cb55d,_0x1c4d12]=_0x461d3e['replace'](_0x552e97(0x1e6),'')[_0x552e97(0x1f5)]('_');return{'type':_0x1cb55d,'date':_0x1c4d12,'size':_0x5ad77b['size']};})[_0x51a218(0x1f1)]((_0x10b79f,_0x417908)=>_0x417908['date'][_0x51a218(0x1cd)](_0x10b79f['date']));return{'totalFiles':_0x5f34bc[_0x51a218(0x1ee)],'logTypes':_0x1cdddf,'latestLogs':_0x4a24dc['slice'](0x0,0xa)};}catch(_0xa2a039){return console[_0x51a218(0x1d7)]('Failed\x20to\x20get\x20log\x20stats:',_0xa2a039),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x2ae9eb=0x1e){const _0x496ed8=a48_0x3b725b;try{const _0x31a4c3=fs_1[_0x496ed8(0x1f4)]['readdirSync'](this['logsDir']),_0x2ce9db=new Date();_0x2ce9db['setDate'](_0x2ce9db['getDate']()-_0x2ae9eb);let _0x49ba1f=0x0;_0x31a4c3['forEach'](_0x2953a6=>{const _0x863f8=_0x496ed8;if(!_0x2953a6['endsWith'](_0x863f8(0x1e6)))return;const _0x52444c=path_1[_0x863f8(0x1f4)][_0x863f8(0x1ed)](this['logsDir'],_0x2953a6),_0x104f03=fs_1[_0x863f8(0x1f4)][_0x863f8(0x1e1)](_0x52444c);_0x104f03[_0x863f8(0x1ca)]<_0x2ce9db&&(fs_1['default'][_0x863f8(0x1f3)](_0x52444c),_0x49ba1f++,console[_0x863f8(0x1f7)](_0x863f8(0x1cc)+_0x2953a6));}),console['log']('🧹\x20Cleaned\x20'+_0x49ba1f+_0x496ed8(0x1bd)+_0x2ae9eb+'\x20days)');}catch(_0x28dd1d){console[_0x496ed8(0x1d7)](_0x496ed8(0x1c1),_0x28dd1d);}}}exports['LoggerService']=LoggerService,exports[a48_0x3b725b(0x1e4)]=new LoggerService();