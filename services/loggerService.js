'use strict';const a51_0x4266c7=a51_0x3cb2;(function(_0x3a9a88,_0x5174de){const _0x2bb7db=a51_0x3cb2,_0x4a84e9=_0x3a9a88();while(!![]){try{const _0x424a14=-parseInt(_0x2bb7db(0x1bf))/0x1*(-parseInt(_0x2bb7db(0x1b9))/0x2)+parseInt(_0x2bb7db(0x19f))/0x3*(-parseInt(_0x2bb7db(0x1b7))/0x4)+-parseInt(_0x2bb7db(0x1a3))/0x5+parseInt(_0x2bb7db(0x1c8))/0x6+parseInt(_0x2bb7db(0x18d))/0x7+parseInt(_0x2bb7db(0x1cf))/0x8+-parseInt(_0x2bb7db(0x1a2))/0x9;if(_0x424a14===_0x5174de)break;else _0x4a84e9['push'](_0x4a84e9['shift']());}catch(_0x431826){_0x4a84e9['push'](_0x4a84e9['shift']());}}}(a51_0x2068,0xebc0e));var __importDefault=this&&this[a51_0x4266c7(0x18e)]||function(_0xf6853e){const _0x360195=a51_0x4266c7;return _0xf6853e&&_0xf6853e[_0x360195(0x1b0)]?_0xf6853e:{'default':_0xf6853e};};Object[a51_0x4266c7(0x1a0)](exports,a51_0x4266c7(0x1b0),{'value':!![]}),exports[a51_0x4266c7(0x1af)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x4266c7(0x192)));class LoggerService{constructor(){const _0x57780a=a51_0x4266c7;this[_0x57780a(0x19a)]=path_1[_0x57780a(0x1ce)]['join'](process['cwd'](),_0x57780a(0x1a5)),this[_0x57780a(0x198)]();}[a51_0x4266c7(0x198)](){const _0x3f622a=a51_0x4266c7;!fs_1['default'][_0x3f622a(0x1b2)](this[_0x3f622a(0x19a)])&&(fs_1[_0x3f622a(0x1ce)]['mkdirSync'](this[_0x3f622a(0x19a)],{'recursive':!![]}),console[_0x3f622a(0x1a6)](_0x3f622a(0x1be)+this[_0x3f622a(0x19a)]));}[a51_0x4266c7(0x186)](_0x203b48){const _0x3b3193=a51_0x4266c7,_0x3e1701=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x3b3193(0x1ce)][_0x3b3193(0x1ca)](this[_0x3b3193(0x19a)],_0x203b48+'_'+_0x3e1701+'.log');}[a51_0x4266c7(0x1cb)](_0x37dbf2,_0x48e84b){const _0x2ea8f0=a51_0x4266c7;try{const _0x160b10=new Date()[_0x2ea8f0(0x183)](),_0x270338={'timestamp':_0x160b10,..._0x48e84b},_0x2b4b91=JSON[_0x2ea8f0(0x1a8)](_0x270338)+'\x0a',_0x351b1b=this[_0x2ea8f0(0x186)](_0x37dbf2);fs_1[_0x2ea8f0(0x1ce)][_0x2ea8f0(0x1d1)](_0x351b1b,_0x2b4b91,_0x2ea8f0(0x1aa));}catch(_0x45ebad){console['error']('Failed\x20to\x20write\x20'+_0x37dbf2+_0x2ea8f0(0x1bd),_0x45ebad);}}[a51_0x4266c7(0x19c)](_0x2e7e3d,_0x67202d,_0xd7b7fe,_0x3ef4be){const _0x144d3a=a51_0x4266c7;this[_0x144d3a(0x1cb)](_0x144d3a(0x189),{'type':_0x144d3a(0x1bb),'gateway':_0x2e7e3d,'endpoint':_0x67202d,'method':_0xd7b7fe,'data':_0x3ef4be});}[a51_0x4266c7(0x19d)](_0x4d25d7,_0x66756e,_0x4b48a8,_0x4b3e04,_0xf2d332){const _0x4ed6a8=a51_0x4266c7;this[_0x4ed6a8(0x1cb)](_0x4ed6a8(0x188),{'type':_0x4ed6a8(0x193),'gateway':_0x4d25d7,'endpoint':_0x66756e,'status':_0x4b48a8,'responseTime':_0xf2d332,'data':_0x4b3e04});}[a51_0x4266c7(0x196)](_0x233e4b,_0x569c54,_0xe03ba){const _0xbdf264=a51_0x4266c7;this[_0xbdf264(0x1cb)](_0xbdf264(0x1c2),{'type':'ERROR','gateway':_0x233e4b,'endpoint':_0x569c54,'error':_0xe03ba instanceof Error?{'message':_0xe03ba['message'],'stack':_0xe03ba['stack']}:_0xe03ba});}[a51_0x4266c7(0x18a)](_0xf76377,_0x1c381c,_0x4c7450){const _0x11db56=a51_0x4266c7;this[_0x11db56(0x1cb)](_0x11db56(0x1ac),{'type':_0x11db56(0x1bc),'gateway':_0xf76377,'headers':_0x4c7450,'data':_0x1c381c});}['logWebhookProcessed'](_0x210556,_0x22b6cc,_0x5d7971,_0xbf9ac6,_0xad51eb){const _0x3234d0=a51_0x4266c7;this[_0x3234d0(0x1cb)](_0x3234d0(0x1b4),{'type':_0x3234d0(0x1d0),'gateway':_0x210556,'paymentId':_0x22b6cc,'oldStatus':_0x5d7971,'newStatus':_0xbf9ac6,'originalData':_0xad51eb});}[a51_0x4266c7(0x1a9)](_0x11b0b2,_0x5888e9,_0x49503a){const _0x16867f=a51_0x4266c7;this[_0x16867f(0x1cb)](_0x16867f(0x19b),{'type':_0x16867f(0x19e),'gateway':_0x11b0b2,'error':_0x5888e9 instanceof Error?{'message':_0x5888e9[_0x16867f(0x1cc)],'stack':_0x5888e9[_0x16867f(0x194)]}:_0x5888e9,'originalData':_0x49503a});}['logCoinToPayStatus'](_0x3ba340){const _0x24b647=a51_0x4266c7;this[_0x24b647(0x1cb)](_0x24b647(0x1c4),{'type':_0x24b647(0x1c6),..._0x3ba340});}['logCoinToPayError'](_0xa1596f){const _0x51ce49=a51_0x4266c7;this[_0x51ce49(0x1cb)](_0x51ce49(0x18c),{'type':_0x51ce49(0x1c1),..._0xa1596f});}[a51_0x4266c7(0x197)](_0x4cae6e,_0x36bdc5,_0x288f67,_0x4c29ca,_0x1c36ba,_0x4485d2){const _0x4df1ae=a51_0x4266c7;this[_0x4df1ae(0x1cb)](_0x4df1ae(0x18f),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x4cae6e,'webhookUrl':_0x36bdc5,'event':_0x288f67,'status':_0x4c29ca,'responseTime':_0x1c36ba,'payload':_0x4485d2});}[a51_0x4266c7(0x187)](_0x3fd514,_0x4e5f4a,_0x94539e,_0x583146,_0x433191){const _0x34e539=a51_0x4266c7;this[_0x34e539(0x1cb)]('shop_webhooks_errors',{'type':_0x34e539(0x1a4),'shopId':_0x3fd514,'webhookUrl':_0x4e5f4a,'event':_0x94539e,'error':_0x583146 instanceof Error?{'message':_0x583146[_0x34e539(0x1cc)],'stack':_0x583146['stack']}:_0x583146,'payload':_0x433191});}[a51_0x4266c7(0x1b3)](_0x2ab24e,_0xe0498,_0xb12013,_0x5acc32,_0x2cddd0){const _0x4df36d=a51_0x4266c7;this[_0x4df36d(0x1cb)](_0x4df36d(0x1ab),{'type':'PAYMENT_CREATED','gateway':_0x2ab24e,'paymentId':_0xe0498,'shopId':_0xb12013,'amount':_0x5acc32,'currency':_0x2cddd0});}['logApiCall'](_0x25efe8,_0x5dc3ed,_0x592a93,_0x58b332,_0x1f1896){const _0x2beaf0=a51_0x4266c7;this[_0x2beaf0(0x1cb)]('api_calls',{'type':'API_CALL','endpoint':_0x25efe8,'method':_0x5dc3ed,'userId':_0x592a93,'userRole':_0x58b332,'requestData':_0x1f1896});}[a51_0x4266c7(0x1c0)](){const _0x239ee=a51_0x4266c7;try{const _0x41ffbf=fs_1['default']['readdirSync'](this[_0x239ee(0x19a)]),_0x28fdd7=_0x41ffbf[_0x239ee(0x1a1)](_0x445185=>_0x445185['endsWith'](_0x239ee(0x1ba))),_0xb016e9=[...new Set(_0x28fdd7['map'](_0x319a8d=>_0x319a8d['split']('_')[0x0]))],_0x58ab9d=_0x28fdd7[_0x239ee(0x191)](_0x3ef78c=>{const _0x5e6c0f=_0x239ee,_0x446087=path_1[_0x5e6c0f(0x1ce)][_0x5e6c0f(0x1ca)](this[_0x5e6c0f(0x19a)],_0x3ef78c),_0x10b10f=fs_1[_0x5e6c0f(0x1ce)][_0x5e6c0f(0x1c7)](_0x446087),[_0x56708e,_0x5491fd]=_0x3ef78c[_0x5e6c0f(0x1c5)](_0x5e6c0f(0x1ba),'')[_0x5e6c0f(0x1c3)]('_');return{'type':_0x56708e,'date':_0x5491fd,'size':_0x10b10f['size']};})[_0x239ee(0x1d2)]((_0x58db10,_0x5b8745)=>_0x5b8745[_0x239ee(0x1cd)][_0x239ee(0x1a7)](_0x58db10['date']));return{'totalFiles':_0x28fdd7[_0x239ee(0x1c9)],'logTypes':_0xb016e9,'latestLogs':_0x58ab9d['slice'](0x0,0xa)};}catch(_0x21a51f){return console[_0x239ee(0x1b5)]('Failed\x20to\x20get\x20log\x20stats:',_0x21a51f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x25fc66=0x1e){const _0x373ff9=a51_0x4266c7;try{const _0x1a0e0e=fs_1['default'][_0x373ff9(0x190)](this[_0x373ff9(0x19a)]),_0x3cc571=new Date();_0x3cc571['setDate'](_0x3cc571[_0x373ff9(0x199)]()-_0x25fc66);let _0x5441fe=0x0;_0x1a0e0e[_0x373ff9(0x195)](_0x25cbc1=>{const _0x3f5c0c=_0x373ff9;if(!_0x25cbc1[_0x3f5c0c(0x1b8)](_0x3f5c0c(0x1ba)))return;const _0x164200=path_1[_0x3f5c0c(0x1ce)][_0x3f5c0c(0x1ca)](this[_0x3f5c0c(0x19a)],_0x25cbc1),_0x118f5e=fs_1['default'][_0x3f5c0c(0x1c7)](_0x164200);_0x118f5e[_0x3f5c0c(0x1ad)]<_0x3cc571&&(fs_1['default'][_0x3f5c0c(0x184)](_0x164200),_0x5441fe++,console[_0x3f5c0c(0x1a6)](_0x3f5c0c(0x1b6)+_0x25cbc1));}),console[_0x373ff9(0x1a6)](_0x373ff9(0x185)+_0x5441fe+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x25fc66+_0x373ff9(0x1b1));}catch(_0x2c9b2a){console[_0x373ff9(0x1b5)](_0x373ff9(0x1ae),_0x2c9b2a);}}}function a51_0x3cb2(_0x37701f,_0x25457c){const _0x2068c2=a51_0x2068();return a51_0x3cb2=function(_0x3cb2da,_0xea9fc3){_0x3cb2da=_0x3cb2da-0x183;let _0x297e0=_0x2068c2[_0x3cb2da];return _0x297e0;},a51_0x3cb2(_0x37701f,_0x25457c);}exports[a51_0x4266c7(0x18b)]=LoggerService,exports['loggerService']=new LoggerService();function a51_0x2068(){const _0x324e23=['WEBHOOK_PROCESSED','appendFileSync','sort','toISOString','unlinkSync','🧹\x20Cleaned\x20','getLogFileName','logShopWebhookError','white_domain_responses','white_domain_requests','logWebhookReceived','LoggerService','cointopay_errors','4133430ttUQnI','__importDefault','shop_webhooks_sent','readdirSync','map','path','RESPONSE','stack','forEach','logWhiteDomainError','logShopWebhookSent','ensureLogsDirectory','getDate','logsDir','webhooks_errors','logWhiteDomainRequest','logWhiteDomainResponse','WEBHOOK_ERROR','75glEsMS','defineProperty','filter','9717048ARKgBj','6010590wddphO','SHOP_WEBHOOK_ERROR','logs','log','localeCompare','stringify','logWebhookError','utf8','payments_created','webhooks_received','mtime','Failed\x20to\x20clean\x20old\x20logs:','loggerService','__esModule','\x20days)','existsSync','logPaymentCreated','webhooks_processed','error','🗑️\x20Deleted\x20old\x20log\x20file:\x20','94908PPydeK','endsWith','2BMITeJ','.log','REQUEST','WEBHOOK_RECEIVED','\x20log:','📁\x20Created\x20logs\x20directory:\x20','1695598XGmGYS','getLogStats','COINTOPAY_ERROR','white_domain_errors','split','cointopay_status_changes','replace','COINTOPAY_STATUS_CHANGE','statSync','8090754AIIxvG','length','join','writeLog','message','date','default','1648512OGOeiS'];a51_0x2068=function(){return _0x324e23;};return a51_0x2068();}