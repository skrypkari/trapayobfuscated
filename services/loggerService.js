'use strict';const a53_0x549e97=a53_0x4ab0;(function(_0x4b42a8,_0x2da6aa){const _0x88e4de=a53_0x4ab0,_0x8fb82d=_0x4b42a8();while(!![]){try{const _0x22f2fd=parseInt(_0x88e4de(0x74))/0x1*(-parseInt(_0x88e4de(0x8e))/0x2)+-parseInt(_0x88e4de(0xb8))/0x3*(-parseInt(_0x88e4de(0xc1))/0x4)+parseInt(_0x88e4de(0x8d))/0x5*(-parseInt(_0x88e4de(0xac))/0x6)+parseInt(_0x88e4de(0xc0))/0x7+-parseInt(_0x88e4de(0x7f))/0x8*(-parseInt(_0x88e4de(0x94))/0x9)+parseInt(_0x88e4de(0xad))/0xa*(-parseInt(_0x88e4de(0xa9))/0xb)+-parseInt(_0x88e4de(0x75))/0xc;if(_0x22f2fd===_0x2da6aa)break;else _0x8fb82d['push'](_0x8fb82d['shift']());}catch(_0x21881a){_0x8fb82d['push'](_0x8fb82d['shift']());}}}(a53_0x4cd4,0x935fe));function a53_0x4cd4(){const _0x5363c0=['.log','logPaymentCreated','error','white_domain_responses','readdirSync','mtime','logs','existsSync','\x20old\x20log\x20files\x20(older\x20than\x20','LoggerService','stack','\x20days)','appendFileSync','3179077KtRbwS','logsDir','join','30dgSIbO','10ldsMej','endsWith','sort','cointopay_errors','defineProperty','date','ERROR','logWhiteDomainResponse','SHOP_WEBHOOK_ERROR','webhooks_processed','🧹\x20Cleaned\x20','258jgjBvT','shop_webhooks_sent','replace','logCoinToPayStatus','Failed\x20to\x20get\x20log\x20stats:','ensureLogsDirectory','logApiCall','logWhiteDomainError','6794522hVtOIj','33408BzdXKE','shop_webhooks_errors','logWebhookProcessed','cwd','mkdirSync','94817XHskaZ','8120040WxmuVF','split','path','getLogFileName','forEach','localeCompare','setDate','Failed\x20to\x20write\x20','REQUEST','log','25832watiHb','default','cleanOldLogs','size','message','API_CALL','white_domain_requests','loggerService','statSync','filter','unlinkSync','toISOString','WEBHOOK_ERROR','webhooks_received','1035455mEfYKH','2qSdhgw','__importDefault','COINTOPAY_ERROR','COINTOPAY_STATUS_CHANGE','SHOP_WEBHOOK_SENT','logWebhookReceived','2817TbclKD','writeLog','payments_created','logShopWebhookError','__esModule','webhooks_errors','logWebhookError','logCoinToPayError'];a53_0x4cd4=function(){return _0x5363c0;};return a53_0x4cd4();}var __importDefault=this&&this[a53_0x549e97(0x8f)]||function(_0x1f2d09){const _0x5f12f9=a53_0x549e97;return _0x1f2d09&&_0x1f2d09[_0x5f12f9(0x98)]?_0x1f2d09:{'default':_0x1f2d09};};Object[a53_0x549e97(0xb1)](exports,'__esModule',{'value':!![]}),exports[a53_0x549e97(0x86)]=exports[a53_0x549e97(0xa5)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x549e97(0x77)));function a53_0x4ab0(_0x494c68,_0x4a08bd){const _0x4cd4d3=a53_0x4cd4();return a53_0x4ab0=function(_0x4ab0d0,_0x40f561){_0x4ab0d0=_0x4ab0d0-0x71;let _0x771c45=_0x4cd4d3[_0x4ab0d0];return _0x771c45;},a53_0x4ab0(_0x494c68,_0x4a08bd);}class LoggerService{constructor(){const _0x57b843=a53_0x549e97;this[_0x57b843(0xaa)]=path_1['default'][_0x57b843(0xab)](process[_0x57b843(0x72)](),_0x57b843(0xa2)),this[_0x57b843(0xbd)]();}[a53_0x549e97(0xbd)](){const _0x54c529=a53_0x549e97;!fs_1[_0x54c529(0x80)][_0x54c529(0xa3)](this[_0x54c529(0xaa)])&&(fs_1[_0x54c529(0x80)][_0x54c529(0x73)](this['logsDir'],{'recursive':!![]}),console[_0x54c529(0x7e)]('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a53_0x549e97(0x78)](_0x22f71b){const _0x194bf8=a53_0x549e97,_0x5de931=new Date()[_0x194bf8(0x8a)]()['split']('T')[0x0];return path_1[_0x194bf8(0x80)][_0x194bf8(0xab)](this['logsDir'],_0x22f71b+'_'+_0x5de931+_0x194bf8(0x9c));}[a53_0x549e97(0x95)](_0xed31da,_0x16d305){const _0x2f7704=a53_0x549e97;try{const _0x5dd0cc=new Date()[_0x2f7704(0x8a)](),_0x5c5c8d={'timestamp':_0x5dd0cc,..._0x16d305},_0x168d7a=JSON['stringify'](_0x5c5c8d)+'\x0a',_0x2fffe1=this[_0x2f7704(0x78)](_0xed31da);fs_1[_0x2f7704(0x80)][_0x2f7704(0xa8)](_0x2fffe1,_0x168d7a,'utf8');}catch(_0x3dc5ed){console['error'](_0x2f7704(0x7c)+_0xed31da+'\x20log:',_0x3dc5ed);}}['logWhiteDomainRequest'](_0x224429,_0x10771b,_0x5603d0,_0x29a17f){const _0x3e613f=a53_0x549e97;this[_0x3e613f(0x95)](_0x3e613f(0x85),{'type':_0x3e613f(0x7d),'gateway':_0x224429,'endpoint':_0x10771b,'method':_0x5603d0,'data':_0x29a17f});}[a53_0x549e97(0xb4)](_0x1b31ae,_0x24137e,_0x61cd48,_0x4878e7,_0x436e73){const _0x1c64ff=a53_0x549e97;this[_0x1c64ff(0x95)](_0x1c64ff(0x9f),{'type':'RESPONSE','gateway':_0x1b31ae,'endpoint':_0x24137e,'status':_0x61cd48,'responseTime':_0x436e73,'data':_0x4878e7});}[a53_0x549e97(0xbf)](_0x49e766,_0x4eddd7,_0xc9cd63){const _0x3ffedc=a53_0x549e97;this['writeLog']('white_domain_errors',{'type':_0x3ffedc(0xb3),'gateway':_0x49e766,'endpoint':_0x4eddd7,'error':_0xc9cd63 instanceof Error?{'message':_0xc9cd63[_0x3ffedc(0x83)],'stack':_0xc9cd63['stack']}:_0xc9cd63});}[a53_0x549e97(0x93)](_0x438ba2,_0x47b434,_0x2bea4e){const _0x43b28b=a53_0x549e97;this[_0x43b28b(0x95)](_0x43b28b(0x8c),{'type':'WEBHOOK_RECEIVED','gateway':_0x438ba2,'headers':_0x2bea4e,'data':_0x47b434});}[a53_0x549e97(0x71)](_0x374adb,_0x40272a,_0x2e9690,_0x4237fa,_0x5c1775){const _0x2ae832=a53_0x549e97;this[_0x2ae832(0x95)](_0x2ae832(0xb6),{'type':'WEBHOOK_PROCESSED','gateway':_0x374adb,'paymentId':_0x40272a,'oldStatus':_0x2e9690,'newStatus':_0x4237fa,'originalData':_0x5c1775});}[a53_0x549e97(0x9a)](_0x2b549f,_0x98ff29,_0x29aeec){const _0x2f588f=a53_0x549e97;this[_0x2f588f(0x95)](_0x2f588f(0x99),{'type':_0x2f588f(0x8b),'gateway':_0x2b549f,'error':_0x98ff29 instanceof Error?{'message':_0x98ff29[_0x2f588f(0x83)],'stack':_0x98ff29['stack']}:_0x98ff29,'originalData':_0x29aeec});}[a53_0x549e97(0xbb)](_0x4c3ac){const _0xc1e966=a53_0x549e97;this['writeLog']('cointopay_status_changes',{'type':_0xc1e966(0x91),..._0x4c3ac});}[a53_0x549e97(0x9b)](_0x1876f8){const _0x3d2d67=a53_0x549e97;this['writeLog'](_0x3d2d67(0xb0),{'type':_0x3d2d67(0x90),..._0x1876f8});}['logShopWebhookSent'](_0x4615c2,_0xad8248,_0x1fc14f,_0x7ac611,_0x25ab19,_0x2007e6){const _0x34e31f=a53_0x549e97;this[_0x34e31f(0x95)](_0x34e31f(0xb9),{'type':_0x34e31f(0x92),'shopId':_0x4615c2,'webhookUrl':_0xad8248,'event':_0x1fc14f,'status':_0x7ac611,'responseTime':_0x25ab19,'payload':_0x2007e6});}[a53_0x549e97(0x97)](_0x1c283e,_0x3f57b5,_0x3d6e5a,_0x4ba3b7,_0x1c818f){const _0x2bd25b=a53_0x549e97;this[_0x2bd25b(0x95)](_0x2bd25b(0xc2),{'type':_0x2bd25b(0xb5),'shopId':_0x1c283e,'webhookUrl':_0x3f57b5,'event':_0x3d6e5a,'error':_0x4ba3b7 instanceof Error?{'message':_0x4ba3b7[_0x2bd25b(0x83)],'stack':_0x4ba3b7[_0x2bd25b(0xa6)]}:_0x4ba3b7,'payload':_0x1c818f});}[a53_0x549e97(0x9d)](_0x11fad1,_0x289e76,_0x442f76,_0x3072af,_0x16fa04){const _0x2e8d3f=a53_0x549e97;this[_0x2e8d3f(0x95)](_0x2e8d3f(0x96),{'type':'PAYMENT_CREATED','gateway':_0x11fad1,'paymentId':_0x289e76,'shopId':_0x442f76,'amount':_0x3072af,'currency':_0x16fa04});}[a53_0x549e97(0xbe)](_0x3c680f,_0x3f12b7,_0x2611eb,_0x33d738,_0x2a5448){const _0x5d494a=a53_0x549e97;this[_0x5d494a(0x95)]('api_calls',{'type':_0x5d494a(0x84),'endpoint':_0x3c680f,'method':_0x3f12b7,'userId':_0x2611eb,'userRole':_0x33d738,'requestData':_0x2a5448});}['getLogStats'](){const _0x405101=a53_0x549e97;try{const _0x15b377=fs_1['default'][_0x405101(0xa0)](this[_0x405101(0xaa)]),_0x461bad=_0x15b377[_0x405101(0x88)](_0x2538d2=>_0x2538d2[_0x405101(0xae)](_0x405101(0x9c))),_0x25057=[...new Set(_0x461bad['map'](_0x188340=>_0x188340[_0x405101(0x76)]('_')[0x0]))],_0xb41956=_0x461bad['map'](_0x269423=>{const _0x221d53=_0x405101,_0x5932e8=path_1[_0x221d53(0x80)]['join'](this['logsDir'],_0x269423),_0x4bd8ef=fs_1[_0x221d53(0x80)][_0x221d53(0x87)](_0x5932e8),[_0x53b568,_0x1cef7f]=_0x269423[_0x221d53(0xba)](_0x221d53(0x9c),'')['split']('_');return{'type':_0x53b568,'date':_0x1cef7f,'size':_0x4bd8ef[_0x221d53(0x82)]};})[_0x405101(0xaf)]((_0x21d379,_0x480aa)=>_0x480aa[_0x405101(0xb2)][_0x405101(0x7a)](_0x21d379[_0x405101(0xb2)]));return{'totalFiles':_0x461bad['length'],'logTypes':_0x25057,'latestLogs':_0xb41956['slice'](0x0,0xa)};}catch(_0x5f28e9){return console[_0x405101(0x9e)](_0x405101(0xbc),_0x5f28e9),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a53_0x549e97(0x81)](_0x5d4c50=0x1e){const _0x239175=a53_0x549e97;try{const _0x38d0c5=fs_1['default'][_0x239175(0xa0)](this['logsDir']),_0x100ab5=new Date();_0x100ab5[_0x239175(0x7b)](_0x100ab5['getDate']()-_0x5d4c50);let _0x463811=0x0;_0x38d0c5[_0x239175(0x79)](_0x47de75=>{const _0x4488bc=_0x239175;if(!_0x47de75['endsWith'](_0x4488bc(0x9c)))return;const _0xdc0d96=path_1[_0x4488bc(0x80)][_0x4488bc(0xab)](this['logsDir'],_0x47de75),_0x23610b=fs_1['default'][_0x4488bc(0x87)](_0xdc0d96);_0x23610b[_0x4488bc(0xa1)]<_0x100ab5&&(fs_1[_0x4488bc(0x80)][_0x4488bc(0x89)](_0xdc0d96),_0x463811++,console[_0x4488bc(0x7e)]('🗑️\x20Deleted\x20old\x20log\x20file:\x20'+_0x47de75));}),console[_0x239175(0x7e)](_0x239175(0xb7)+_0x463811+_0x239175(0xa4)+_0x5d4c50+_0x239175(0xa7));}catch(_0x6ccd6){console[_0x239175(0x9e)]('Failed\x20to\x20clean\x20old\x20logs:',_0x6ccd6);}}}exports[a53_0x549e97(0xa5)]=LoggerService,exports[a53_0x549e97(0x86)]=new LoggerService();