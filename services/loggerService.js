'use strict';const a49_0x4a5cc5=a49_0x30b0;function a49_0x30b0(_0x4ab3eb,_0x52d55e){const _0x23dec4=a49_0x23de();return a49_0x30b0=function(_0x30b0a1,_0x54d074){_0x30b0a1=_0x30b0a1-0x10f;let _0x255e67=_0x23dec4[_0x30b0a1];return _0x255e67;},a49_0x30b0(_0x4ab3eb,_0x52d55e);}(function(_0x5a8d40,_0xb40a93){const _0x5d5fca=a49_0x30b0,_0x3bc8f7=_0x5a8d40();while(!![]){try{const _0x23ed45=-parseInt(_0x5d5fca(0x110))/0x1*(parseInt(_0x5d5fca(0x129))/0x2)+parseInt(_0x5d5fca(0x13d))/0x3*(-parseInt(_0x5d5fca(0x12e))/0x4)+parseInt(_0x5d5fca(0x120))/0x5*(parseInt(_0x5d5fca(0x11d))/0x6)+-parseInt(_0x5d5fca(0x11e))/0x7+parseInt(_0x5d5fca(0x144))/0x8+parseInt(_0x5d5fca(0x135))/0x9*(parseInt(_0x5d5fca(0x11f))/0xa)+parseInt(_0x5d5fca(0x11c))/0xb;if(_0x23ed45===_0xb40a93)break;else _0x3bc8f7['push'](_0x3bc8f7['shift']());}catch(_0x307cee){_0x3bc8f7['push'](_0x3bc8f7['shift']());}}}(a49_0x23de,0xce5cd));function a49_0x23de(){const _0x2b8173=['cwd','api_calls','5493908wzPFzC','cleanOldLogs','RESPONSE','getLogFileName','logShopWebhookSent','getDate','slice','9GLHMWG','logWebhookProcessed','payments_created','SHOP_WEBHOOK_ERROR','path','endsWith','ensureLogsDirectory','logCoinToPayError','3ShyUIj','writeLog','logsDir','📁\x20Created\x20logs\x20directory:\x20','Failed\x20to\x20get\x20log\x20stats:','readdirSync','logApiCall','9584328uvcMVX','error','Failed\x20to\x20write\x20','logShopWebhookError','cointopay_status_changes','logWhiteDomainResponse','white_domain_errors','LoggerService','shop_webhooks_sent','logWebhookReceived','logCoinToPayStatus','default','replace','COINTOPAY_ERROR','date','statSync','__esModule','join','🗑️\x20Deleted\x20old\x20log\x20file:\x20','API_CALL','split','size','white_domain_requests','log','getLogStats','REQUEST','WEBHOOK_RECEIVED','Failed\x20to\x20clean\x20old\x20logs:','stack','toISOString','defineProperty','968502ynuUVq','loggerService','__importDefault','logWhiteDomainError','webhooks_errors','\x20old\x20log\x20files\x20(older\x20than\x20','WEBHOOK_PROCESSED','logWebhookError','white_domain_responses','forEach','filter','message','5922719AZutWy','359886LLnoKm','1102276oskYyZ','14282950otfnpS','15funkfu','webhooks_processed','map','stringify','ERROR','WEBHOOK_ERROR','setDate','.log','mtime','2dxuwWH','\x20log:','utf8'];a49_0x23de=function(){return _0x2b8173;};return a49_0x23de();}var __importDefault=this&&this[a49_0x4a5cc5(0x112)]||function(_0x27e4da){const _0x56c493=a49_0x4a5cc5;return _0x27e4da&&_0x27e4da[_0x56c493(0x154)]?_0x27e4da:{'default':_0x27e4da};};Object[a49_0x4a5cc5(0x10f)](exports,'__esModule',{'value':!![]}),exports[a49_0x4a5cc5(0x111)]=exports[a49_0x4a5cc5(0x14b)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x4a5cc5(0x139)));class LoggerService{constructor(){const _0x2aab35=a49_0x4a5cc5;this[_0x2aab35(0x13f)]=path_1[_0x2aab35(0x14f)][_0x2aab35(0x155)](process[_0x2aab35(0x12c)](),'logs'),this[_0x2aab35(0x13b)]();}[a49_0x4a5cc5(0x13b)](){const _0x384b67=a49_0x4a5cc5;!fs_1[_0x384b67(0x14f)]['existsSync'](this[_0x384b67(0x13f)])&&(fs_1[_0x384b67(0x14f)]['mkdirSync'](this[_0x384b67(0x13f)],{'recursive':!![]}),console[_0x384b67(0x15b)](_0x384b67(0x140)+this[_0x384b67(0x13f)]));}[a49_0x4a5cc5(0x131)](_0x96af6d){const _0x53d586=a49_0x4a5cc5,_0x4ec3a7=new Date()[_0x53d586(0x161)]()['split']('T')[0x0];return path_1['default'][_0x53d586(0x155)](this[_0x53d586(0x13f)],_0x96af6d+'_'+_0x4ec3a7+_0x53d586(0x127));}[a49_0x4a5cc5(0x13e)](_0x6f3992,_0x1186c5){const _0x191d74=a49_0x4a5cc5;try{const _0x22ba8d=new Date()[_0x191d74(0x161)](),_0x492336={'timestamp':_0x22ba8d,..._0x1186c5},_0x14f8ea=JSON[_0x191d74(0x123)](_0x492336)+'\x0a',_0xf896e1=this[_0x191d74(0x131)](_0x6f3992);fs_1[_0x191d74(0x14f)]['appendFileSync'](_0xf896e1,_0x14f8ea,_0x191d74(0x12b));}catch(_0x26656a){console[_0x191d74(0x145)](_0x191d74(0x146)+_0x6f3992+_0x191d74(0x12a),_0x26656a);}}['logWhiteDomainRequest'](_0x1e8fec,_0x64d2d1,_0x442027,_0x787a7b){const _0x3ce319=a49_0x4a5cc5;this[_0x3ce319(0x13e)](_0x3ce319(0x15a),{'type':_0x3ce319(0x15d),'gateway':_0x1e8fec,'endpoint':_0x64d2d1,'method':_0x442027,'data':_0x787a7b});}[a49_0x4a5cc5(0x149)](_0x4775ba,_0x2532ca,_0x1fab31,_0x46b849,_0x16c65e){const _0x38cdf9=a49_0x4a5cc5;this['writeLog'](_0x38cdf9(0x118),{'type':_0x38cdf9(0x130),'gateway':_0x4775ba,'endpoint':_0x2532ca,'status':_0x1fab31,'responseTime':_0x16c65e,'data':_0x46b849});}[a49_0x4a5cc5(0x113)](_0x245e50,_0x439a9d,_0x29e2c6){const _0x4165f6=a49_0x4a5cc5;this['writeLog'](_0x4165f6(0x14a),{'type':_0x4165f6(0x124),'gateway':_0x245e50,'endpoint':_0x439a9d,'error':_0x29e2c6 instanceof Error?{'message':_0x29e2c6[_0x4165f6(0x11b)],'stack':_0x29e2c6[_0x4165f6(0x160)]}:_0x29e2c6});}[a49_0x4a5cc5(0x14d)](_0x834f54,_0xebbd87,_0x4b0eed){const _0x2a1c14=a49_0x4a5cc5;this['writeLog']('webhooks_received',{'type':_0x2a1c14(0x15e),'gateway':_0x834f54,'headers':_0x4b0eed,'data':_0xebbd87});}[a49_0x4a5cc5(0x136)](_0x260fc1,_0x2e32d4,_0x41ac5d,_0xa4ff68,_0x101bc8){const _0x408f21=a49_0x4a5cc5;this[_0x408f21(0x13e)](_0x408f21(0x121),{'type':_0x408f21(0x116),'gateway':_0x260fc1,'paymentId':_0x2e32d4,'oldStatus':_0x41ac5d,'newStatus':_0xa4ff68,'originalData':_0x101bc8});}[a49_0x4a5cc5(0x117)](_0x285aa9,_0x26f3f5,_0x2e6e71){const _0xef5c3f=a49_0x4a5cc5;this[_0xef5c3f(0x13e)](_0xef5c3f(0x114),{'type':_0xef5c3f(0x125),'gateway':_0x285aa9,'error':_0x26f3f5 instanceof Error?{'message':_0x26f3f5[_0xef5c3f(0x11b)],'stack':_0x26f3f5[_0xef5c3f(0x160)]}:_0x26f3f5,'originalData':_0x2e6e71});}[a49_0x4a5cc5(0x14e)](_0x194ba7){const _0x233238=a49_0x4a5cc5;this[_0x233238(0x13e)](_0x233238(0x148),{'type':'COINTOPAY_STATUS_CHANGE',..._0x194ba7});}[a49_0x4a5cc5(0x13c)](_0x2b0793){const _0x2e71ed=a49_0x4a5cc5;this[_0x2e71ed(0x13e)]('cointopay_errors',{'type':_0x2e71ed(0x151),..._0x2b0793});}[a49_0x4a5cc5(0x132)](_0x149d84,_0x587770,_0x5b1be4,_0x44ed21,_0x5df177,_0x5477b7){const _0x1211b7=a49_0x4a5cc5;this[_0x1211b7(0x13e)](_0x1211b7(0x14c),{'type':'SHOP_WEBHOOK_SENT','shopId':_0x149d84,'webhookUrl':_0x587770,'event':_0x5b1be4,'status':_0x44ed21,'responseTime':_0x5df177,'payload':_0x5477b7});}[a49_0x4a5cc5(0x147)](_0x21f311,_0x4fa961,_0xfea62c,_0x560159,_0x4e09c4){const _0x2021cc=a49_0x4a5cc5;this['writeLog']('shop_webhooks_errors',{'type':_0x2021cc(0x138),'shopId':_0x21f311,'webhookUrl':_0x4fa961,'event':_0xfea62c,'error':_0x560159 instanceof Error?{'message':_0x560159['message'],'stack':_0x560159[_0x2021cc(0x160)]}:_0x560159,'payload':_0x4e09c4});}['logPaymentCreated'](_0x536e13,_0x24dadb,_0x335c9e,_0x119ca4,_0x1636a0){const _0x30f3df=a49_0x4a5cc5;this['writeLog'](_0x30f3df(0x137),{'type':'PAYMENT_CREATED','gateway':_0x536e13,'paymentId':_0x24dadb,'shopId':_0x335c9e,'amount':_0x119ca4,'currency':_0x1636a0});}[a49_0x4a5cc5(0x143)](_0x3f8708,_0x24be29,_0x2cd8f8,_0x708fa1,_0x15f4f0){const _0x47368d=a49_0x4a5cc5;this['writeLog'](_0x47368d(0x12d),{'type':_0x47368d(0x157),'endpoint':_0x3f8708,'method':_0x24be29,'userId':_0x2cd8f8,'userRole':_0x708fa1,'requestData':_0x15f4f0});}[a49_0x4a5cc5(0x15c)](){const _0x4f942e=a49_0x4a5cc5;try{const _0x1c64d8=fs_1[_0x4f942e(0x14f)][_0x4f942e(0x142)](this[_0x4f942e(0x13f)]),_0x1fafcb=_0x1c64d8[_0x4f942e(0x11a)](_0x104feb=>_0x104feb[_0x4f942e(0x13a)]('.log')),_0x2b5306=[...new Set(_0x1fafcb['map'](_0x4b3e40=>_0x4b3e40[_0x4f942e(0x158)]('_')[0x0]))],_0x46b6cd=_0x1fafcb[_0x4f942e(0x122)](_0x4c0618=>{const _0x5da685=_0x4f942e,_0x2c67d3=path_1[_0x5da685(0x14f)][_0x5da685(0x155)](this[_0x5da685(0x13f)],_0x4c0618),_0x14cd81=fs_1['default'][_0x5da685(0x153)](_0x2c67d3),[_0x218034,_0x1b5878]=_0x4c0618[_0x5da685(0x150)](_0x5da685(0x127),'')['split']('_');return{'type':_0x218034,'date':_0x1b5878,'size':_0x14cd81[_0x5da685(0x159)]};})['sort']((_0x448ef4,_0x2f6058)=>_0x2f6058['date']['localeCompare'](_0x448ef4[_0x4f942e(0x152)]));return{'totalFiles':_0x1fafcb['length'],'logTypes':_0x2b5306,'latestLogs':_0x46b6cd[_0x4f942e(0x134)](0x0,0xa)};}catch(_0x5ae96f){return console['error'](_0x4f942e(0x141),_0x5ae96f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a49_0x4a5cc5(0x12f)](_0x1403f3=0x1e){const _0x572222=a49_0x4a5cc5;try{const _0x15eb6d=fs_1[_0x572222(0x14f)][_0x572222(0x142)](this[_0x572222(0x13f)]),_0x246a19=new Date();_0x246a19[_0x572222(0x126)](_0x246a19[_0x572222(0x133)]()-_0x1403f3);let _0xaed97d=0x0;_0x15eb6d[_0x572222(0x119)](_0x194d01=>{const _0x5f3230=_0x572222;if(!_0x194d01[_0x5f3230(0x13a)]('.log'))return;const _0x39ba28=path_1[_0x5f3230(0x14f)][_0x5f3230(0x155)](this['logsDir'],_0x194d01),_0x47eb27=fs_1[_0x5f3230(0x14f)][_0x5f3230(0x153)](_0x39ba28);_0x47eb27[_0x5f3230(0x128)]<_0x246a19&&(fs_1[_0x5f3230(0x14f)]['unlinkSync'](_0x39ba28),_0xaed97d++,console[_0x5f3230(0x15b)](_0x5f3230(0x156)+_0x194d01));}),console[_0x572222(0x15b)]('🧹\x20Cleaned\x20'+_0xaed97d+_0x572222(0x115)+_0x1403f3+'\x20days)');}catch(_0x234a61){console['error'](_0x572222(0x15f),_0x234a61);}}}exports[a49_0x4a5cc5(0x14b)]=LoggerService,exports[a49_0x4a5cc5(0x111)]=new LoggerService();