'use strict';const a71_0x5e7024=a71_0x5f16;(function(_0xec9c38,_0x7f8c2b){const _0x42e2cf=a71_0x5f16,_0x2bab6c=_0xec9c38();while(!![]){try{const _0x45e119=parseInt(_0x42e2cf(0xe5))/0x1+parseInt(_0x42e2cf(0xde))/0x2*(parseInt(_0x42e2cf(0xe7))/0x3)+parseInt(_0x42e2cf(0x121))/0x4+parseInt(_0x42e2cf(0x122))/0x5*(parseInt(_0x42e2cf(0xec))/0x6)+parseInt(_0x42e2cf(0xe1))/0x7*(-parseInt(_0x42e2cf(0x103))/0x8)+parseInt(_0x42e2cf(0x123))/0x9*(-parseInt(_0x42e2cf(0xdc))/0xa)+parseInt(_0x42e2cf(0x112))/0xb*(-parseInt(_0x42e2cf(0x124))/0xc);if(_0x45e119===_0x7f8c2b)break;else _0x2bab6c['push'](_0x2bab6c['shift']());}catch(_0x17a844){_0x2bab6c['push'](_0x2bab6c['shift']());}}}(a71_0x3d41,0xa28d8));var __importDefault=this&&this[a71_0x5e7024(0x114)]||function(_0x505e7a){const _0x835913=a71_0x5e7024;return _0x505e7a&&_0x505e7a[_0x835913(0xe9)]?_0x505e7a:{'default':_0x505e7a};};function a71_0x5f16(_0x1d9a7b,_0x2c480c){_0x1d9a7b=_0x1d9a7b-0xd7;const _0x3d41b3=a71_0x3d41();let _0x5f1660=_0x3d41b3[_0x1d9a7b];return _0x5f1660;}Object[a71_0x5e7024(0x126)](exports,a71_0x5e7024(0xe9),{'value':!![]}),exports[a71_0x5e7024(0xf4)]=exports[a71_0x5e7024(0xe6)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a71_0x5e7024(0x109)));class LoggerService{constructor(){const _0x5b40fa=a71_0x5e7024;this[_0x5b40fa(0x101)]=path_1[_0x5b40fa(0x106)][_0x5b40fa(0x111)](process[_0x5b40fa(0x125)](),_0x5b40fa(0xfb)),this[_0x5b40fa(0xf7)]();}[a71_0x5e7024(0xf7)](){const _0x31ccb5=a71_0x5e7024;!fs_1['default'][_0x31ccb5(0x10e)](this[_0x31ccb5(0x101)])&&(fs_1[_0x31ccb5(0x106)][_0x31ccb5(0xdf)](this[_0x31ccb5(0x101)],{'recursive':!![]}),console['log'](_0x31ccb5(0xf3)+this[_0x31ccb5(0x101)]));}[a71_0x5e7024(0xf6)](_0x57f506){const _0x2ae640=a71_0x5e7024,_0x46b6e1=new Date()[_0x2ae640(0xd9)]()[_0x2ae640(0x115)]('T')[0x0];return path_1[_0x2ae640(0x106)][_0x2ae640(0x111)](this[_0x2ae640(0x101)],_0x57f506+'_'+_0x46b6e1+_0x2ae640(0x104));}[a71_0x5e7024(0xd8)](_0x1d170d,_0xa63f43){const _0x2fad09=a71_0x5e7024;try{const _0x4bb249=new Date()['toISOString'](),_0x3e0a11={'timestamp':_0x4bb249,..._0xa63f43},_0x59e3e5=JSON['stringify'](_0x3e0a11)+'\x0a',_0x178bde=this['getLogFileName'](_0x1d170d);fs_1[_0x2fad09(0x106)][_0x2fad09(0x11c)](_0x178bde,_0x59e3e5,_0x2fad09(0xf2));}catch(_0x36ba06){console[_0x2fad09(0x102)]('Failed\x20to\x20write\x20'+_0x1d170d+_0x2fad09(0x11d),_0x36ba06);}}[a71_0x5e7024(0x10a)](_0x5f07f8,_0x2daeea,_0x25fd0,_0x447f21){const _0x5c63b6=a71_0x5e7024;this[_0x5c63b6(0xd8)](_0x5c63b6(0x11a),{'type':'REQUEST','gateway':_0x5f07f8,'endpoint':_0x2daeea,'method':_0x25fd0,'data':_0x447f21});}[a71_0x5e7024(0x10f)](_0x19d186,_0x33431a,_0x474164,_0x54362a,_0x4c3f02){const _0x5c8fcc=a71_0x5e7024;this[_0x5c8fcc(0xd8)]('white_domain_responses',{'type':'RESPONSE','gateway':_0x19d186,'endpoint':_0x33431a,'status':_0x474164,'responseTime':_0x4c3f02,'data':_0x54362a});}['logWhiteDomainError'](_0x3fb2c9,_0x2907b1,_0x3f377b){const _0x1e53e7=a71_0x5e7024;this[_0x1e53e7(0xd8)]('white_domain_errors',{'type':_0x1e53e7(0x110),'gateway':_0x3fb2c9,'endpoint':_0x2907b1,'error':_0x3f377b instanceof Error?{'message':_0x3f377b['message'],'stack':_0x3f377b[_0x1e53e7(0x120)]}:_0x3f377b});}[a71_0x5e7024(0x116)](_0xb5ff71,_0x33ddd6,_0x5c675c){const _0x2a62a3=a71_0x5e7024;this[_0x2a62a3(0xd8)](_0x2a62a3(0xff),{'type':'WEBHOOK_RECEIVED','gateway':_0xb5ff71,'headers':_0x5c675c,'data':_0x33ddd6});}['logWebhookProcessed'](_0x5630c6,_0x159a02,_0x5b2ac7,_0x2ee0b6,_0x21a2a4){const _0x1bb244=a71_0x5e7024;this[_0x1bb244(0xd8)](_0x1bb244(0xee),{'type':_0x1bb244(0x128),'gateway':_0x5630c6,'paymentId':_0x159a02,'oldStatus':_0x5b2ac7,'newStatus':_0x2ee0b6,'originalData':_0x21a2a4});}[a71_0x5e7024(0x107)](_0x243ceb,_0x6ed99c,_0x577479){const _0x133e94=a71_0x5e7024;this[_0x133e94(0xd8)](_0x133e94(0x10c),{'type':'WEBHOOK_ERROR','gateway':_0x243ceb,'error':_0x6ed99c instanceof Error?{'message':_0x6ed99c[_0x133e94(0xf9)],'stack':_0x6ed99c[_0x133e94(0x120)]}:_0x6ed99c,'originalData':_0x577479});}[a71_0x5e7024(0x105)](_0x1f7cfa){this['writeLog']('cointopay_status_changes',{'type':'COINTOPAY_STATUS_CHANGE',..._0x1f7cfa});}[a71_0x5e7024(0xf8)](_0x367751){const _0x2cb19a=a71_0x5e7024;this[_0x2cb19a(0xd8)](_0x2cb19a(0xe8),{'type':'COINTOPAY_ERROR',..._0x367751});}[a71_0x5e7024(0xe4)](_0x53858c,_0xfabf45,_0x2800b0,_0x1c5e77,_0x4d0fec,_0x57f7f9){const _0x1dc5f5=a71_0x5e7024;this[_0x1dc5f5(0xd8)](_0x1dc5f5(0xd7),{'type':_0x1dc5f5(0xdd),'shopId':_0x53858c,'webhookUrl':_0xfabf45,'event':_0x2800b0,'status':_0x1c5e77,'responseTime':_0x4d0fec,'payload':_0x57f7f9});}['logShopWebhookError'](_0x10c1d8,_0x153114,_0x5bdf41,_0x1a7a90,_0x577062){const _0x38515d=a71_0x5e7024;this[_0x38515d(0xd8)](_0x38515d(0x119),{'type':_0x38515d(0xfd),'shopId':_0x10c1d8,'webhookUrl':_0x153114,'event':_0x5bdf41,'error':_0x1a7a90 instanceof Error?{'message':_0x1a7a90[_0x38515d(0xf9)],'stack':_0x1a7a90[_0x38515d(0x120)]}:_0x1a7a90,'payload':_0x577062});}[a71_0x5e7024(0xfe)](_0x387554,_0x4604f2,_0x23b413,_0x31ec05,_0x2ff87f){const _0x269c55=a71_0x5e7024;this[_0x269c55(0xd8)](_0x269c55(0xea),{'type':'PAYMENT_CREATED','gateway':_0x387554,'paymentId':_0x4604f2,'shopId':_0x23b413,'amount':_0x31ec05,'currency':_0x2ff87f});}[a71_0x5e7024(0x117)](_0x566647,_0x3bb544,_0x52e8a1,_0x958f99,_0x95f5a3){const _0x26c15f=a71_0x5e7024;this[_0x26c15f(0xd8)](_0x26c15f(0x10d),{'type':'API_CALL','endpoint':_0x566647,'method':_0x3bb544,'userId':_0x52e8a1,'userRole':_0x958f99,'requestData':_0x95f5a3});}[a71_0x5e7024(0xf1)](){const _0xee15b=a71_0x5e7024;try{const _0x3a70de=fs_1['default']['readdirSync'](this['logsDir']),_0x52a0a3=_0x3a70de[_0xee15b(0x118)](_0xcdc2eb=>_0xcdc2eb[_0xee15b(0xeb)](_0xee15b(0x104))),_0x1a62ec=[...new Set(_0x52a0a3[_0xee15b(0xf5)](_0x12ed04=>_0x12ed04['split']('_')[0x0]))],_0xbe4a0e=_0x52a0a3['map'](_0x5e8121=>{const _0x126c13=_0xee15b,_0x1e081b=path_1[_0x126c13(0x106)][_0x126c13(0x111)](this['logsDir'],_0x5e8121),_0x115e55=fs_1['default'][_0x126c13(0xf0)](_0x1e081b),[_0x21fb39,_0x10c8a8]=_0x5e8121[_0x126c13(0x11e)]('.log','')[_0x126c13(0x115)]('_');return{'type':_0x21fb39,'date':_0x10c8a8,'size':_0x115e55[_0x126c13(0xfa)]};})[_0xee15b(0xfc)]((_0x1505be,_0x32727f)=>_0x32727f[_0xee15b(0x100)]['localeCompare'](_0x1505be[_0xee15b(0x100)]));return{'totalFiles':_0x52a0a3[_0xee15b(0x108)],'logTypes':_0x1a62ec,'latestLogs':_0xbe4a0e[_0xee15b(0xda)](0x0,0xa)};}catch(_0x58845f){return console[_0xee15b(0x102)](_0xee15b(0x127),_0x58845f),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}['cleanOldLogs'](_0x3b6cd2=0x1e){const _0x4c74a6=a71_0x5e7024;try{const _0x3c5182=fs_1[_0x4c74a6(0x106)][_0x4c74a6(0x113)](this['logsDir']),_0x584417=new Date();_0x584417['setDate'](_0x584417[_0x4c74a6(0xdb)]()-_0x3b6cd2);let _0x1fa9c2=0x0;_0x3c5182[_0x4c74a6(0xef)](_0x143ee1=>{const _0x2c3f4a=_0x4c74a6;if(!_0x143ee1[_0x2c3f4a(0xeb)]('.log'))return;const _0x16e7ff=path_1[_0x2c3f4a(0x106)][_0x2c3f4a(0x111)](this[_0x2c3f4a(0x101)],_0x143ee1),_0x2d0c30=fs_1[_0x2c3f4a(0x106)]['statSync'](_0x16e7ff);_0x2d0c30[_0x2c3f4a(0xed)]<_0x584417&&(fs_1['default'][_0x2c3f4a(0xe3)](_0x16e7ff),_0x1fa9c2++,console[_0x2c3f4a(0x11b)]('ðŸ—‘ï¸\x20Deleted\x20old\x20log\x20file:\x20'+_0x143ee1));}),console[_0x4c74a6(0x11b)](_0x4c74a6(0xe2)+_0x1fa9c2+_0x4c74a6(0x11f)+_0x3b6cd2+_0x4c74a6(0xe0));}catch(_0x4c26e1){console['error'](_0x4c74a6(0x10b),_0x4c26e1);}}}function a71_0x3d41(){const _0x47d9fd=['cointopay_errors','__esModule','payments_created','endsWith','30SBgMqC','mtime','webhooks_processed','forEach','statSync','getLogStats','utf8','ðŸ“\x20Created\x20logs\x20directory:\x20','loggerService','map','getLogFileName','ensureLogsDirectory','logCoinToPayError','message','size','logs','sort','SHOP_WEBHOOK_ERROR','logPaymentCreated','webhooks_received','date','logsDir','error','8JeyyCO','.log','logCoinToPayStatus','default','logWebhookError','length','path','logWhiteDomainRequest','Failed\x20to\x20clean\x20old\x20logs:','webhooks_errors','api_calls','existsSync','logWhiteDomainResponse','ERROR','join','8599503BSTLss','readdirSync','__importDefault','split','logWebhookReceived','logApiCall','filter','shop_webhooks_errors','white_domain_requests','log','appendFileSync','\x20log:','replace','\x20old\x20log\x20files\x20(older\x20than\x20','stack','973588haELku','161270LsNPOZ','9CzVUdV','12XySHia','cwd','defineProperty','Failed\x20to\x20get\x20log\x20stats:','WEBHOOK_PROCESSED','shop_webhooks_sent','writeLog','toISOString','slice','getDate','6052580cPVaSr','SHOP_WEBHOOK_SENT','2mmXqec','mkdirSync','\x20days)','1094779KXBXvQ','ðŸ§¹\x20Cleaned\x20','unlinkSync','logShopWebhookSent','1330780vRhPGj','LoggerService','1421391YhGMjF'];a71_0x3d41=function(){return _0x47d9fd;};return a71_0x3d41();}exports[a71_0x5e7024(0xe6)]=LoggerService,exports[a71_0x5e7024(0xf4)]=new LoggerService();