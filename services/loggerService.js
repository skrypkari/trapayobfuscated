'use strict';const a51_0x1827a3=a51_0x2471;(function(_0x34685e,_0x573561){const _0x354e5d=a51_0x2471,_0x275009=_0x34685e();while(!![]){try{const _0x5381c6=parseInt(_0x354e5d(0x111))/0x1+parseInt(_0x354e5d(0x136))/0x2+-parseInt(_0x354e5d(0x14f))/0x3*(parseInt(_0x354e5d(0x11b))/0x4)+parseInt(_0x354e5d(0x137))/0x5+-parseInt(_0x354e5d(0x15c))/0x6+parseInt(_0x354e5d(0x120))/0x7+parseInt(_0x354e5d(0x117))/0x8*(-parseInt(_0x354e5d(0x148))/0x9);if(_0x5381c6===_0x573561)break;else _0x275009['push'](_0x275009['shift']());}catch(_0x1cb84f){_0x275009['push'](_0x275009['shift']());}}}(a51_0x3bcb,0x50759));function a51_0x2471(_0x364b9c,_0x451af4){const _0x3bcbf6=a51_0x3bcb();return a51_0x2471=function(_0x24717f,_0x2ab93d){_0x24717f=_0x24717f-0x10a;let _0x54e28e=_0x3bcbf6[_0x24717f];return _0x54e28e;},a51_0x2471(_0x364b9c,_0x451af4);}var __importDefault=this&&this['__importDefault']||function(_0x412f02){const _0x391f3f=a51_0x2471;return _0x412f02&&_0x412f02[_0x391f3f(0x128)]?_0x412f02:{'default':_0x412f02};};Object[a51_0x1827a3(0x14c)](exports,'__esModule',{'value':!![]}),exports[a51_0x1827a3(0x11f)]=exports['LoggerService']=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x1827a3(0x12a)));function a51_0x3bcb(){const _0x3be7ec=['256881AtchMP','logs','logWhiteDomainRequest','SHOP_WEBHOOK_SENT','logWhiteDomainResponse','cointopay_status_changes','logPaymentCreated','\x20log:','utf8','statSync','Failed\x20to\x20clean\x20old\x20logs:','mtime','API_CALL','2320404XyrzQy','readdirSync','toISOString','logShopWebhookSent','Failed\x20to\x20get\x20log\x20stats:','WEBHOOK_ERROR','api_calls','split','126385TYuuYF','length','logWhiteDomainError','size','logWebhookProcessed','default','23224FDeyuc','logWebhookError','logsDir','filter','4sBrjTv','getDate','cleanOldLogs','forEach','loggerService','3479035tvXYMR','stack','cwd','logCoinToPayError','white_domain_requests','REQUEST','unlinkSync','WEBHOOK_RECEIVED','__esModule','localeCompare','path','writeLog','mkdirSync','log','🗑️\x20Deleted\x20old\x20log\x20file:\x20','PAYMENT_CREATED','existsSync','getLogFileName','logShopWebhookError','ERROR','.log','webhooks_processed','545166uhZrWM','328070rQAmHP','sort','join','Failed\x20to\x20write\x20','webhooks_errors','\x20days)','error','WEBHOOK_PROCESSED','white_domain_responses','LoggerService','endsWith','date','logWebhookReceived','🧹\x20Cleaned\x20','RESPONSE','replace','setDate','495fPWrQB','SHOP_WEBHOOK_ERROR','map','stringify','defineProperty','logCoinToPayStatus','webhooks_received'];a51_0x3bcb=function(){return _0x3be7ec;};return a51_0x3bcb();}class LoggerService{constructor(){const _0x38ca9d=a51_0x1827a3;this['logsDir']=path_1['default'][_0x38ca9d(0x139)](process[_0x38ca9d(0x122)](),_0x38ca9d(0x150)),this['ensureLogsDirectory']();}['ensureLogsDirectory'](){const _0xeac774=a51_0x1827a3;!fs_1[_0xeac774(0x116)][_0xeac774(0x130)](this[_0xeac774(0x119)])&&(fs_1[_0xeac774(0x116)][_0xeac774(0x12c)](this[_0xeac774(0x119)],{'recursive':!![]}),console[_0xeac774(0x12d)]('📁\x20Created\x20logs\x20directory:\x20'+this[_0xeac774(0x119)]));}['getLogFileName'](_0x102bd0){const _0x407355=a51_0x1827a3,_0x3bf987=new Date()[_0x407355(0x10b)]()[_0x407355(0x110)]('T')[0x0];return path_1[_0x407355(0x116)][_0x407355(0x139)](this[_0x407355(0x119)],_0x102bd0+'_'+_0x3bf987+_0x407355(0x134));}['writeLog'](_0x41579f,_0x304cb0){const _0x2d93c5=a51_0x1827a3;try{const _0x5ed519=new Date()[_0x2d93c5(0x10b)](),_0x3dcafe={'timestamp':_0x5ed519,..._0x304cb0},_0x3cc358=JSON[_0x2d93c5(0x14b)](_0x3dcafe)+'\x0a',_0x5ec83a=this[_0x2d93c5(0x131)](_0x41579f);fs_1['default']['appendFileSync'](_0x5ec83a,_0x3cc358,_0x2d93c5(0x157));}catch(_0x47c36a){console[_0x2d93c5(0x13d)](_0x2d93c5(0x13a)+_0x41579f+_0x2d93c5(0x156),_0x47c36a);}}[a51_0x1827a3(0x151)](_0x4a60d2,_0x3d369b,_0x1f7685,_0x3f5819){const _0x432459=a51_0x1827a3;this[_0x432459(0x12b)](_0x432459(0x124),{'type':_0x432459(0x125),'gateway':_0x4a60d2,'endpoint':_0x3d369b,'method':_0x1f7685,'data':_0x3f5819});}[a51_0x1827a3(0x153)](_0x696c03,_0x1f03d2,_0x46114e,_0xa1c36b,_0x3e9df1){const _0x3a018d=a51_0x1827a3;this[_0x3a018d(0x12b)](_0x3a018d(0x13f),{'type':_0x3a018d(0x145),'gateway':_0x696c03,'endpoint':_0x1f03d2,'status':_0x46114e,'responseTime':_0x3e9df1,'data':_0xa1c36b});}[a51_0x1827a3(0x113)](_0x2bb54c,_0x284dba,_0xda6cfc){const _0x262454=a51_0x1827a3;this['writeLog']('white_domain_errors',{'type':_0x262454(0x133),'gateway':_0x2bb54c,'endpoint':_0x284dba,'error':_0xda6cfc instanceof Error?{'message':_0xda6cfc['message'],'stack':_0xda6cfc[_0x262454(0x121)]}:_0xda6cfc});}[a51_0x1827a3(0x143)](_0x3329c1,_0x17a222,_0x10ea96){const _0x2bbcc2=a51_0x1827a3;this[_0x2bbcc2(0x12b)](_0x2bbcc2(0x14e),{'type':_0x2bbcc2(0x127),'gateway':_0x3329c1,'headers':_0x10ea96,'data':_0x17a222});}[a51_0x1827a3(0x115)](_0x2a3797,_0x3be86e,_0x3ee52b,_0x3be48c,_0x870dc4){const _0x1e5cd1=a51_0x1827a3;this[_0x1e5cd1(0x12b)](_0x1e5cd1(0x135),{'type':_0x1e5cd1(0x13e),'gateway':_0x2a3797,'paymentId':_0x3be86e,'oldStatus':_0x3ee52b,'newStatus':_0x3be48c,'originalData':_0x870dc4});}[a51_0x1827a3(0x118)](_0x27e66d,_0x269834,_0x5a3762){const _0x3c2d01=a51_0x1827a3;this[_0x3c2d01(0x12b)](_0x3c2d01(0x13b),{'type':_0x3c2d01(0x10e),'gateway':_0x27e66d,'error':_0x269834 instanceof Error?{'message':_0x269834['message'],'stack':_0x269834[_0x3c2d01(0x121)]}:_0x269834,'originalData':_0x5a3762});}[a51_0x1827a3(0x14d)](_0x428c10){const _0x11d829=a51_0x1827a3;this[_0x11d829(0x12b)](_0x11d829(0x154),{'type':'COINTOPAY_STATUS_CHANGE',..._0x428c10});}[a51_0x1827a3(0x123)](_0x4769c2){const _0x59f4cd=a51_0x1827a3;this[_0x59f4cd(0x12b)]('cointopay_errors',{'type':'COINTOPAY_ERROR',..._0x4769c2});}[a51_0x1827a3(0x10c)](_0x2561fc,_0x21680d,_0x2fd486,_0x2204a5,_0x581d1c,_0x3da327){const _0x5015e5=a51_0x1827a3;this[_0x5015e5(0x12b)]('shop_webhooks_sent',{'type':_0x5015e5(0x152),'shopId':_0x2561fc,'webhookUrl':_0x21680d,'event':_0x2fd486,'status':_0x2204a5,'responseTime':_0x581d1c,'payload':_0x3da327});}[a51_0x1827a3(0x132)](_0x1404ac,_0x526a9c,_0x3bc339,_0x554137,_0x2d4b83){const _0x434f1a=a51_0x1827a3;this[_0x434f1a(0x12b)]('shop_webhooks_errors',{'type':_0x434f1a(0x149),'shopId':_0x1404ac,'webhookUrl':_0x526a9c,'event':_0x3bc339,'error':_0x554137 instanceof Error?{'message':_0x554137['message'],'stack':_0x554137['stack']}:_0x554137,'payload':_0x2d4b83});}[a51_0x1827a3(0x155)](_0x55cf1b,_0x9e84f6,_0x1095ac,_0x3c900f,_0x280415){const _0x4c0868=a51_0x1827a3;this[_0x4c0868(0x12b)]('payments_created',{'type':_0x4c0868(0x12f),'gateway':_0x55cf1b,'paymentId':_0x9e84f6,'shopId':_0x1095ac,'amount':_0x3c900f,'currency':_0x280415});}['logApiCall'](_0xcdc326,_0x263561,_0x3cc777,_0x32f5e3,_0x519b5c){const _0x5dfa6e=a51_0x1827a3;this[_0x5dfa6e(0x12b)](_0x5dfa6e(0x10f),{'type':_0x5dfa6e(0x15b),'endpoint':_0xcdc326,'method':_0x263561,'userId':_0x3cc777,'userRole':_0x32f5e3,'requestData':_0x519b5c});}['getLogStats'](){const _0x37caa8=a51_0x1827a3;try{const _0x3442bc=fs_1['default']['readdirSync'](this[_0x37caa8(0x119)]),_0x466a88=_0x3442bc[_0x37caa8(0x11a)](_0x21ecb7=>_0x21ecb7[_0x37caa8(0x141)](_0x37caa8(0x134))),_0x1d50ab=[...new Set(_0x466a88[_0x37caa8(0x14a)](_0x1af31e=>_0x1af31e[_0x37caa8(0x110)]('_')[0x0]))],_0x2aff0c=_0x466a88[_0x37caa8(0x14a)](_0x306880=>{const _0x54c965=_0x37caa8,_0x3bc863=path_1[_0x54c965(0x116)]['join'](this[_0x54c965(0x119)],_0x306880),_0x2fcc37=fs_1[_0x54c965(0x116)][_0x54c965(0x158)](_0x3bc863),[_0x5ed572,_0x49dad4]=_0x306880[_0x54c965(0x146)](_0x54c965(0x134),'')['split']('_');return{'type':_0x5ed572,'date':_0x49dad4,'size':_0x2fcc37[_0x54c965(0x114)]};})[_0x37caa8(0x138)]((_0x226f35,_0x26b246)=>_0x26b246[_0x37caa8(0x142)][_0x37caa8(0x129)](_0x226f35[_0x37caa8(0x142)]));return{'totalFiles':_0x466a88[_0x37caa8(0x112)],'logTypes':_0x1d50ab,'latestLogs':_0x2aff0c['slice'](0x0,0xa)};}catch(_0x1fe2aa){return console['error'](_0x37caa8(0x10d),_0x1fe2aa),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a51_0x1827a3(0x11d)](_0x4b9717=0x1e){const _0xa1caa=a51_0x1827a3;try{const _0x1498e4=fs_1[_0xa1caa(0x116)][_0xa1caa(0x10a)](this[_0xa1caa(0x119)]),_0x10f529=new Date();_0x10f529[_0xa1caa(0x147)](_0x10f529[_0xa1caa(0x11c)]()-_0x4b9717);let _0x574519=0x0;_0x1498e4[_0xa1caa(0x11e)](_0x352634=>{const _0x9e5f9=_0xa1caa;if(!_0x352634[_0x9e5f9(0x141)]('.log'))return;const _0x3de20a=path_1['default'][_0x9e5f9(0x139)](this[_0x9e5f9(0x119)],_0x352634),_0x16fc5f=fs_1['default'][_0x9e5f9(0x158)](_0x3de20a);_0x16fc5f[_0x9e5f9(0x15a)]<_0x10f529&&(fs_1['default'][_0x9e5f9(0x126)](_0x3de20a),_0x574519++,console[_0x9e5f9(0x12d)](_0x9e5f9(0x12e)+_0x352634));}),console['log'](_0xa1caa(0x144)+_0x574519+'\x20old\x20log\x20files\x20(older\x20than\x20'+_0x4b9717+_0xa1caa(0x13c));}catch(_0x5904b1){console[_0xa1caa(0x13d)](_0xa1caa(0x159),_0x5904b1);}}}exports[a51_0x1827a3(0x140)]=LoggerService,exports[a51_0x1827a3(0x11f)]=new LoggerService();