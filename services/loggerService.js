'use strict';const a48_0x5c683a=a48_0x1645;(function(_0x3fc2fe,_0x547dcb){const _0x46e46d=a48_0x1645,_0x52ed41=_0x3fc2fe();while(!![]){try{const _0xbe4f48=-parseInt(_0x46e46d(0x213))/0x1*(-parseInt(_0x46e46d(0x20d))/0x2)+-parseInt(_0x46e46d(0x214))/0x3+parseInt(_0x46e46d(0x1e3))/0x4+parseInt(_0x46e46d(0x1fb))/0x5*(parseInt(_0x46e46d(0x1e7))/0x6)+-parseInt(_0x46e46d(0x201))/0x7*(parseInt(_0x46e46d(0x1e6))/0x8)+parseInt(_0x46e46d(0x1f1))/0x9+-parseInt(_0x46e46d(0x1e5))/0xa;if(_0xbe4f48===_0x547dcb)break;else _0x52ed41['push'](_0x52ed41['shift']());}catch(_0x4bfe8d){_0x52ed41['push'](_0x52ed41['shift']());}}}(a48_0x83a6,0x3a945));function a48_0x1645(_0x3e021e,_0x2c214b){const _0x83a6ab=a48_0x83a6();return a48_0x1645=function(_0x16458f,_0x2de5d7){_0x16458f=_0x16458f-0x1df;let _0x365cba=_0x83a6ab[_0x16458f];return _0x365cba;},a48_0x1645(_0x3e021e,_0x2c214b);}function a48_0x83a6(){const _0x42d8b9=['logsDir','logs','stack','default','split','🧹\x20Cleaned\x20','utf8','writeLog','getDate','date','COINTOPAY_ERROR','unlinkSync','white_domain_errors','webhooks_received','shop_webhooks_sent','logWhiteDomainRequest','white_domain_requests','\x20old\x20log\x20files\x20(older\x20than\x20','logCoinToPayStatus','shop_webhooks_errors','ensureLogsDirectory','Failed\x20to\x20write\x20','1134540uMsDoF','logApiCall','2053250CRaTzH','8PRqJrn','84jGqHvz','error','mkdirSync','API_CALL','statSync','RESPONSE','filter','forEach','message','readdirSync','3790332lhDyCs','log','logCoinToPayError','size','getLogStats','.log','logWebhookReceived','white_domain_responses','__importDefault','api_calls','55885GeohKE','WEBHOOK_PROCESSED','__esModule','join','Failed\x20to\x20clean\x20old\x20logs:','length','1473206OyDaHw','cointopay_errors','logWhiteDomainError','SHOP_WEBHOOK_SENT','payments_created','cwd','WEBHOOK_ERROR','loggerService','\x20days)','cointopay_status_changes','cleanOldLogs','replace','13698KqbKze','LoggerService','map','ERROR','logWhiteDomainResponse','endsWith','26PkGRcu','1150833TDCNkp','webhooks_errors','webhooks_processed','🗑️\x20Deleted\x20old\x20log\x20file:\x20','getLogFileName','PAYMENT_CREATED','stringify','logPaymentCreated'];a48_0x83a6=function(){return _0x42d8b9;};return a48_0x83a6();}var __importDefault=this&&this[a48_0x5c683a(0x1f9)]||function(_0x383e8a){const _0x237b71=a48_0x5c683a;return _0x383e8a&&_0x383e8a[_0x237b71(0x1fd)]?_0x383e8a:{'default':_0x383e8a};};Object['defineProperty'](exports,a48_0x5c683a(0x1fd),{'value':!![]}),exports[a48_0x5c683a(0x208)]=exports[a48_0x5c683a(0x20e)]=void 0x0;const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class LoggerService{constructor(){const _0x15c969=a48_0x5c683a;this['logsDir']=path_1[_0x15c969(0x21f)]['join'](process[_0x15c969(0x206)](),_0x15c969(0x21d)),this[_0x15c969(0x1e1)]();}[a48_0x5c683a(0x1e1)](){const _0x41dc01=a48_0x5c683a;!fs_1['default']['existsSync'](this['logsDir'])&&(fs_1[_0x41dc01(0x21f)][_0x41dc01(0x1e9)](this[_0x41dc01(0x21c)],{'recursive':!![]}),console[_0x41dc01(0x1f2)]('📁\x20Created\x20logs\x20directory:\x20'+this['logsDir']));}[a48_0x5c683a(0x218)](_0x52a35b){const _0x296c6f=a48_0x5c683a,_0x501816=new Date()['toISOString']()['split']('T')[0x0];return path_1[_0x296c6f(0x21f)][_0x296c6f(0x1fe)](this[_0x296c6f(0x21c)],_0x52a35b+'_'+_0x501816+_0x296c6f(0x1f6));}['writeLog'](_0x1cd706,_0x326b52){const _0x1313cf=a48_0x5c683a;try{const _0x396ebd=new Date()['toISOString'](),_0x4223ac={'timestamp':_0x396ebd,..._0x326b52},_0x2a15ab=JSON[_0x1313cf(0x21a)](_0x4223ac)+'\x0a',_0x238e2a=this[_0x1313cf(0x218)](_0x1cd706);fs_1['default']['appendFileSync'](_0x238e2a,_0x2a15ab,_0x1313cf(0x222));}catch(_0x1abeb3){console[_0x1313cf(0x1e8)](_0x1313cf(0x1e2)+_0x1cd706+'\x20log:',_0x1abeb3);}}[a48_0x5c683a(0x22b)](_0x5b50d0,_0x1e8825,_0x14f99b,_0xb7d897){const _0x53ede2=a48_0x5c683a;this[_0x53ede2(0x223)](_0x53ede2(0x22c),{'type':'REQUEST','gateway':_0x5b50d0,'endpoint':_0x1e8825,'method':_0x14f99b,'data':_0xb7d897});}[a48_0x5c683a(0x211)](_0x2a0a7e,_0x450bb0,_0x4c3a78,_0x477a91,_0x2698e0){const _0x4e7a2b=a48_0x5c683a;this['writeLog'](_0x4e7a2b(0x1f8),{'type':_0x4e7a2b(0x1ec),'gateway':_0x2a0a7e,'endpoint':_0x450bb0,'status':_0x4c3a78,'responseTime':_0x2698e0,'data':_0x477a91});}[a48_0x5c683a(0x203)](_0x2504e8,_0x47785a,_0x2bfddb){const _0x1acb1e=a48_0x5c683a;this[_0x1acb1e(0x223)](_0x1acb1e(0x228),{'type':_0x1acb1e(0x210),'gateway':_0x2504e8,'endpoint':_0x47785a,'error':_0x2bfddb instanceof Error?{'message':_0x2bfddb[_0x1acb1e(0x1ef)],'stack':_0x2bfddb[_0x1acb1e(0x21e)]}:_0x2bfddb});}[a48_0x5c683a(0x1f7)](_0x2fe997,_0xcb23d7,_0x2186aa){const _0x41509a=a48_0x5c683a;this[_0x41509a(0x223)](_0x41509a(0x229),{'type':'WEBHOOK_RECEIVED','gateway':_0x2fe997,'headers':_0x2186aa,'data':_0xcb23d7});}['logWebhookProcessed'](_0x37d26e,_0x19c6b4,_0x4d54fb,_0x4a4a59,_0x9511a3){const _0x1a8ea0=a48_0x5c683a;this[_0x1a8ea0(0x223)](_0x1a8ea0(0x216),{'type':_0x1a8ea0(0x1fc),'gateway':_0x37d26e,'paymentId':_0x19c6b4,'oldStatus':_0x4d54fb,'newStatus':_0x4a4a59,'originalData':_0x9511a3});}['logWebhookError'](_0x3d0016,_0x321cb2,_0x2ba463){const _0x4345af=a48_0x5c683a;this[_0x4345af(0x223)](_0x4345af(0x215),{'type':_0x4345af(0x207),'gateway':_0x3d0016,'error':_0x321cb2 instanceof Error?{'message':_0x321cb2[_0x4345af(0x1ef)],'stack':_0x321cb2[_0x4345af(0x21e)]}:_0x321cb2,'originalData':_0x2ba463});}[a48_0x5c683a(0x1df)](_0x4f9d97){const _0x16776d=a48_0x5c683a;this['writeLog'](_0x16776d(0x20a),{'type':'COINTOPAY_STATUS_CHANGE',..._0x4f9d97});}[a48_0x5c683a(0x1f3)](_0x19acd8){const _0x41c3f8=a48_0x5c683a;this[_0x41c3f8(0x223)](_0x41c3f8(0x202),{'type':_0x41c3f8(0x226),..._0x19acd8});}['logShopWebhookSent'](_0x12f1f9,_0x5e4a2b,_0x571711,_0x7f2085,_0x5aee77,_0x6b9d26){const _0x5dc8a6=a48_0x5c683a;this[_0x5dc8a6(0x223)](_0x5dc8a6(0x22a),{'type':_0x5dc8a6(0x204),'shopId':_0x12f1f9,'webhookUrl':_0x5e4a2b,'event':_0x571711,'status':_0x7f2085,'responseTime':_0x5aee77,'payload':_0x6b9d26});}['logShopWebhookError'](_0xb37870,_0x12238a,_0x50f745,_0x1bf545,_0x28f6e8){const _0x18c94e=a48_0x5c683a;this['writeLog'](_0x18c94e(0x1e0),{'type':'SHOP_WEBHOOK_ERROR','shopId':_0xb37870,'webhookUrl':_0x12238a,'event':_0x50f745,'error':_0x1bf545 instanceof Error?{'message':_0x1bf545[_0x18c94e(0x1ef)],'stack':_0x1bf545[_0x18c94e(0x21e)]}:_0x1bf545,'payload':_0x28f6e8});}[a48_0x5c683a(0x21b)](_0x8a63ca,_0x2ad724,_0x17212d,_0x15bc13,_0x2efc89){const _0x1c9256=a48_0x5c683a;this[_0x1c9256(0x223)](_0x1c9256(0x205),{'type':_0x1c9256(0x219),'gateway':_0x8a63ca,'paymentId':_0x2ad724,'shopId':_0x17212d,'amount':_0x15bc13,'currency':_0x2efc89});}[a48_0x5c683a(0x1e4)](_0x3dc090,_0x2337ee,_0xf646,_0x5d30f8,_0x39e7c4){const _0x4e74eb=a48_0x5c683a;this[_0x4e74eb(0x223)](_0x4e74eb(0x1fa),{'type':_0x4e74eb(0x1ea),'endpoint':_0x3dc090,'method':_0x2337ee,'userId':_0xf646,'userRole':_0x5d30f8,'requestData':_0x39e7c4});}[a48_0x5c683a(0x1f5)](){const _0x1634a6=a48_0x5c683a;try{const _0x5dd11e=fs_1[_0x1634a6(0x21f)]['readdirSync'](this[_0x1634a6(0x21c)]),_0x5610a1=_0x5dd11e[_0x1634a6(0x1ed)](_0x2a0dda=>_0x2a0dda[_0x1634a6(0x212)](_0x1634a6(0x1f6))),_0x110ba0=[...new Set(_0x5610a1[_0x1634a6(0x20f)](_0x3b54d0=>_0x3b54d0[_0x1634a6(0x220)]('_')[0x0]))],_0x342949=_0x5610a1[_0x1634a6(0x20f)](_0x166538=>{const _0x3e1748=_0x1634a6,_0x521b20=path_1['default'][_0x3e1748(0x1fe)](this[_0x3e1748(0x21c)],_0x166538),_0x4edbb8=fs_1[_0x3e1748(0x21f)]['statSync'](_0x521b20),[_0x118e4a,_0x5725e2]=_0x166538[_0x3e1748(0x20c)](_0x3e1748(0x1f6),'')[_0x3e1748(0x220)]('_');return{'type':_0x118e4a,'date':_0x5725e2,'size':_0x4edbb8[_0x3e1748(0x1f4)]};})['sort']((_0x380623,_0x4ed5c0)=>_0x4ed5c0[_0x1634a6(0x225)]['localeCompare'](_0x380623[_0x1634a6(0x225)]));return{'totalFiles':_0x5610a1[_0x1634a6(0x200)],'logTypes':_0x110ba0,'latestLogs':_0x342949['slice'](0x0,0xa)};}catch(_0x21c656){return console['error']('Failed\x20to\x20get\x20log\x20stats:',_0x21c656),{'totalFiles':0x0,'logTypes':[],'latestLogs':[]};}}[a48_0x5c683a(0x20b)](_0x490637=0x1e){const _0x3a97f0=a48_0x5c683a;try{const _0x2f55c6=fs_1[_0x3a97f0(0x21f)][_0x3a97f0(0x1f0)](this['logsDir']),_0x3f2f7d=new Date();_0x3f2f7d['setDate'](_0x3f2f7d[_0x3a97f0(0x224)]()-_0x490637);let _0x332da4=0x0;_0x2f55c6[_0x3a97f0(0x1ee)](_0x1cf73f=>{const _0x372825=_0x3a97f0;if(!_0x1cf73f[_0x372825(0x212)](_0x372825(0x1f6)))return;const _0x5c4124=path_1[_0x372825(0x21f)]['join'](this[_0x372825(0x21c)],_0x1cf73f),_0xae6e6d=fs_1['default'][_0x372825(0x1eb)](_0x5c4124);_0xae6e6d['mtime']<_0x3f2f7d&&(fs_1[_0x372825(0x21f)][_0x372825(0x227)](_0x5c4124),_0x332da4++,console[_0x372825(0x1f2)](_0x372825(0x217)+_0x1cf73f));}),console[_0x3a97f0(0x1f2)](_0x3a97f0(0x221)+_0x332da4+_0x3a97f0(0x22d)+_0x490637+_0x3a97f0(0x209));}catch(_0x16fe0e){console[_0x3a97f0(0x1e8)](_0x3a97f0(0x1ff),_0x16fe0e);}}}exports[a48_0x5c683a(0x20e)]=LoggerService,exports['loggerService']=new LoggerService();