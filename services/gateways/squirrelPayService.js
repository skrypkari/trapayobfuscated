'use strict';const a64_0x1be026=a64_0x1d8d;(function(_0x9c325a,_0x4a61cc){const _0x1ade64=a64_0x1d8d,_0x4f3f1b=_0x9c325a();while(!![]){try{const _0x4e6018=-parseInt(_0x1ade64(0x169))/0x1*(-parseInt(_0x1ade64(0x154))/0x2)+parseInt(_0x1ade64(0x16d))/0x3*(-parseInt(_0x1ade64(0x153))/0x4)+parseInt(_0x1ade64(0x15f))/0x5*(-parseInt(_0x1ade64(0x176))/0x6)+parseInt(_0x1ade64(0x174))/0x7+-parseInt(_0x1ade64(0x159))/0x8+parseInt(_0x1ade64(0x167))/0x9+parseInt(_0x1ade64(0x14e))/0xa;if(_0x4e6018===_0x4a61cc)break;else _0x4f3f1b['push'](_0x4f3f1b['shift']());}catch(_0x32fcb2){_0x4f3f1b['push'](_0x4f3f1b['shift']());}}}(a64_0x46d1,0x79e47));var __importDefault=this&&this[a64_0x1be026(0x162)]||function(_0x1db5c2){const _0x5854f7=a64_0x1be026;return _0x1db5c2&&_0x1db5c2[_0x5854f7(0x15c)]?_0x1db5c2:{'default':_0x1db5c2};};function a64_0x1d8d(_0x2ce663,_0x1a16e5){_0x2ce663=_0x2ce663-0x125;const _0x46d1fc=a64_0x46d1();let _0x1d8d3c=_0x46d1fc[_0x2ce663];return _0x1d8d3c;}Object[a64_0x1be026(0x142)](exports,a64_0x1be026(0x15c),{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a64_0x1be026(0x17e))),node_fetch_1=__importDefault(require(a64_0x1be026(0x125))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x1be026(0x16a)));function a64_0x46d1(){const _0x3ee4e5=['default','message','ðŸ”„\x20Redirect\x20URL:\x20','filter','redirect_url','config','Basic\x20','join','map','FAILED','log','friendly_message','logs','defineProperty','randomUUID','email','\x20\x20\x20Gateway\x20ID:\x20','PAID','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','failed','application/json','SquirrelPay\x20API\x20error:\x20','incomplete','/transactions/payments','status','2707470izbdwf','split','\x20\x20\x20Status:\x20','Unknown\x20error','gateway_id','32FFEeUe','2122MUpRlq','toString','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','code','ðŸ”§\x20Headers:','4438104rxwBWn','\x20||\x20','getPaymentStatus','__esModule','getBasicAuth','\x20-\x20','10RmTFmV','parse','mkdirSync','__importDefault','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','statusText','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','\x20\x20\x20UID:\x20','2272320FCdyJn','transaction','113bGARxS','path','webhookLogPath','uid','42468bacjyl','utf-8','\x20\x20\x20Last\x204:\x20','dirname','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','error','text','4694326ziVbYH','PENDING','439368xBsmtX','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','baseUrl','ðŸ“¦\x20Body:','existsSync','\x20\x20\x20Message:\x20','stringify','ðŸ‘¤\x20Customer:\x20','crypto','payment_method','shopId','appendFileSync','node-fetch','readFileSync','ðŸ”—\x20URL:\x20','isTestMode','successful','logWebhook','âœ…\x20SquirrelPay\x20Response\x20Success:','ðŸ’°\x20Amount:\x20','base64','generateRequestId','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','slice','Payment\x20failed','from','squirrel-pay','getWebhookLogs'];a64_0x46d1=function(){return _0x3ee4e5;};return a64_0x46d1();}class SquirrelPayService{constructor(_0x326169){const _0x50bd0a=a64_0x1be026;this['config']=_0x326169,this[_0x50bd0a(0x16b)]=path_1[_0x50bd0a(0x135)][_0x50bd0a(0x13c)](process['cwd'](),_0x50bd0a(0x141),'squirrel-pay-webhooks.log');const _0xea5add=path_1[_0x50bd0a(0x135)][_0x50bd0a(0x170)](this['webhookLogPath']);!fs_1[_0x50bd0a(0x135)]['existsSync'](_0xea5add)&&fs_1[_0x50bd0a(0x135)][_0x50bd0a(0x161)](_0xea5add,{'recursive':!![]});}[a64_0x1be026(0x15d)](){const _0x1957a7=a64_0x1be026,_0x4e8a05=this[_0x1957a7(0x13a)][_0x1957a7(0x180)]+':'+this['config']['secretKey'];return Buffer[_0x1957a7(0x132)](_0x4e8a05)[_0x1957a7(0x155)](_0x1957a7(0x12d));}[a64_0x1be026(0x12e)](){const _0xa46edc=a64_0x1be026;return crypto_1[_0xa46edc(0x135)][_0xa46edc(0x143)]();}async['processCardPayment'](_0x30aa4a,_0x3579d3,_0x220704,_0x1b0c47,_0xaf968b,_0x13de0d,_0x4751ed,_0xc0b63d,_0x48cbc7){const _0x79d94e=a64_0x1be026;console['log'](_0x79d94e(0x163)),console[_0x79d94e(0x13f)](_0x79d94e(0x12c)+_0x30aa4a+'\x20'+_0x3579d3),console[_0x79d94e(0x13f)]('ðŸ“\x20Description:\x20'+_0x220704),console[_0x79d94e(0x13f)](_0x79d94e(0x17d)+_0x4751ed[_0x79d94e(0x144)]+'\x20('+_0x4751ed['ip']+')');const _0x451867={'request':{'amount':_0x30aa4a,'currency':_0x3579d3,'description':_0x220704,'gate_id':parseInt(this[_0x79d94e(0x13a)][_0x79d94e(0x180)]),'return_url':_0x1b0c47,'notification_url':_0xaf968b,'credit_card':_0x13de0d,'customer':{'email':_0x4751ed[_0x79d94e(0x144)],'phone':_0x48cbc7,'birth_date':_0x4751ed['birth_date'],'billing':_0xc0b63d},'test':this[_0x79d94e(0x13a)][_0x79d94e(0x128)]}},_0x1763ff=this[_0x79d94e(0x12e)](),_0x4270a3={'Authorization':_0x79d94e(0x13b)+this[_0x79d94e(0x15d)](),'Content-Type':_0x79d94e(0x149),'Accept':_0x79d94e(0x149),'X-API-Version':'3','RequestID':_0x1763ff};try{console[_0x79d94e(0x13f)](_0x79d94e(0x177)),console[_0x79d94e(0x13f)]('ðŸ“‹\x20Request\x20ID:\x20'+_0x1763ff),console[_0x79d94e(0x13f)](_0x79d94e(0x127)+this[_0x79d94e(0x13a)][_0x79d94e(0x178)]+_0x79d94e(0x14c)),console[_0x79d94e(0x13f)](_0x79d94e(0x158),JSON[_0x79d94e(0x17c)](_0x4270a3,null,0x2)),console[_0x79d94e(0x13f)](_0x79d94e(0x179),JSON[_0x79d94e(0x17c)](_0x451867,null,0x2));const _0x14f275=await(0x0,node_fetch_1[_0x79d94e(0x135)])(this[_0x79d94e(0x13a)]['baseUrl']+_0x79d94e(0x14c),{'method':'POST','headers':_0x4270a3,'body':JSON[_0x79d94e(0x17c)](_0x451867)}),_0x5e7167=await _0x14f275[_0x79d94e(0x173)]();console[_0x79d94e(0x13f)]('ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20'+_0x14f275[_0x79d94e(0x14d)]),console[_0x79d94e(0x13f)]('ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20'+_0x5e7167);if(!_0x14f275['ok'])throw new Error(_0x79d94e(0x14a)+_0x14f275['status']+'\x20'+_0x14f275[_0x79d94e(0x164)]+_0x79d94e(0x15e)+_0x5e7167);const _0x31beea=JSON[_0x79d94e(0x160)](_0x5e7167);return console['log'](_0x79d94e(0x12b)),console[_0x79d94e(0x13f)](_0x79d94e(0x166)+_0x31beea[_0x79d94e(0x16c)]),console[_0x79d94e(0x13f)](_0x79d94e(0x150)+_0x31beea['status']),console[_0x79d94e(0x13f)]('\x20\x20\x20Code:\x20'+_0x31beea[_0x79d94e(0x157)]),console[_0x79d94e(0x13f)](_0x79d94e(0x17b)+_0x31beea[_0x79d94e(0x140)]),console[_0x79d94e(0x13f)](_0x79d94e(0x145)+_0x31beea[_0x79d94e(0x168)][_0x79d94e(0x152)]),console[_0x79d94e(0x13f)](_0x79d94e(0x16f)+_0x31beea[_0x79d94e(0x17f)]['last_4']),_0x31beea['redirect_url']&&console[_0x79d94e(0x13f)](_0x79d94e(0x137)+_0x31beea['redirect_url']),_0x31beea;}catch(_0x26438f){console[_0x79d94e(0x172)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x26438f);throw _0x26438f;}}[a64_0x1be026(0x15b)](_0x3deb9a){const _0x13080a=a64_0x1be026,_0x24196b=_0x3deb9a[_0x13080a(0x16c)],_0x47a352=_0x3deb9a[_0x13080a(0x17f)]['last_4'];console[_0x13080a(0x13f)](_0x13080a(0x165)+_0x3deb9a['status']);switch(_0x3deb9a[_0x13080a(0x14d)]){case _0x13080a(0x129):return{'status':_0x13080a(0x146),'gatewayPaymentId':_0x24196b,'cardLast4':_0x47a352};case _0x13080a(0x14b):return{'status':_0x13080a(0x175),'gatewayPaymentId':_0x24196b,'cardLast4':_0x47a352,'redirectUrl':_0x3deb9a[_0x13080a(0x139)]};case _0x13080a(0x148):const _0x417e65=_0x3deb9a[_0x13080a(0x140)]||'',_0x343ffc=_0x3deb9a[_0x13080a(0x136)]||'';let _0x195774='';if(_0x417e65&&_0x343ffc)_0x195774=_0x417e65+'\x20||\x20'+_0x343ffc;else{if(_0x417e65)_0x195774=_0x417e65;else _0x343ffc?_0x195774=_0x343ffc:_0x195774=_0x13080a(0x131);}return{'status':_0x13080a(0x13e),'failureMessage':_0x195774,'gatewayPaymentId':_0x24196b,'cardLast4':_0x47a352};default:console['warn'](_0x13080a(0x171)+_0x3deb9a[_0x13080a(0x14d)]);const _0x43d79f=_0x3deb9a['friendly_message']||'',_0x2d3db7=_0x3deb9a[_0x13080a(0x136)]||'';let _0x4931ab='';if(_0x43d79f&&_0x2d3db7)_0x4931ab=_0x43d79f+_0x13080a(0x15a)+_0x2d3db7;else{if(_0x43d79f)_0x4931ab=_0x43d79f;else _0x2d3db7?_0x4931ab=_0x2d3db7:_0x4931ab=_0x13080a(0x151);}return{'status':_0x13080a(0x13e),'failureMessage':_0x4931ab,'gatewayPaymentId':_0x24196b,'cardLast4':_0x47a352};}}[a64_0x1be026(0x12a)](_0x1e7dfc){const _0x5d3bd0=a64_0x1be026,_0x294ee9=new Date()['toISOString'](),_0x5ebe7a={'timestamp':_0x294ee9,'webhook':_0x1e7dfc,'source':_0x5d3bd0(0x133)},_0x321b76=JSON[_0x5d3bd0(0x17c)](_0x5ebe7a)+'\x0a';try{fs_1[_0x5d3bd0(0x135)][_0x5d3bd0(0x181)](this[_0x5d3bd0(0x16b)],_0x321b76),console[_0x5d3bd0(0x13f)](_0x5d3bd0(0x147)+_0x294ee9);}catch(_0x250dbf){console[_0x5d3bd0(0x172)](_0x5d3bd0(0x156),_0x250dbf);}}[a64_0x1be026(0x134)](_0x4fd5cd=0x32){const _0x45e767=a64_0x1be026;try{if(!fs_1['default'][_0x45e767(0x17a)](this[_0x45e767(0x16b)]))return[];const _0xc7f98c=fs_1[_0x45e767(0x135)][_0x45e767(0x126)](this[_0x45e767(0x16b)],_0x45e767(0x16e)),_0x31b4b9=_0xc7f98c['trim']()[_0x45e767(0x14f)]('\x0a')['filter'](_0x44cd9f=>_0x44cd9f);return _0x31b4b9[_0x45e767(0x130)](-_0x4fd5cd)[_0x45e767(0x13d)](_0x455acb=>{const _0x6f9a93=_0x45e767;try{return JSON[_0x6f9a93(0x160)](_0x455acb);}catch{return null;}})[_0x45e767(0x138)](_0x14824b=>_0x14824b!==null);}catch(_0x463d6d){return console[_0x45e767(0x172)](_0x45e767(0x12f),_0x463d6d),[];}}}exports['SquirrelPayService']=SquirrelPayService;