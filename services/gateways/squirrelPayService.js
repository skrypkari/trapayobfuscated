'use strict';const a76_0x12a84d=a76_0x3c2a;(function(_0x1e186a,_0x18da43){const _0x42267c=a76_0x3c2a,_0x529dd4=_0x1e186a();while(!![]){try{const _0x45acf8=-parseInt(_0x42267c(0x182))/0x1*(parseInt(_0x42267c(0x163))/0x2)+-parseInt(_0x42267c(0x161))/0x3*(-parseInt(_0x42267c(0x168))/0x4)+parseInt(_0x42267c(0x1bb))/0x5+parseInt(_0x42267c(0x18a))/0x6*(parseInt(_0x42267c(0x178))/0x7)+-parseInt(_0x42267c(0x188))/0x8*(-parseInt(_0x42267c(0x166))/0x9)+-parseInt(_0x42267c(0x1a0))/0xa+parseInt(_0x42267c(0x1a5))/0xb*(-parseInt(_0x42267c(0x179))/0xc);if(_0x45acf8===_0x18da43)break;else _0x529dd4['push'](_0x529dd4['shift']());}catch(_0x53245e){_0x529dd4['push'](_0x529dd4['shift']());}}}(a76_0x4ca1,0xc6832));var __importDefault=this&&this['__importDefault']||function(_0x177088){return _0x177088&&_0x177088['__esModule']?_0x177088:{'default':_0x177088};};Object[a76_0x12a84d(0x173)](exports,a76_0x12a84d(0x16d),{'value':!![]}),exports[a76_0x12a84d(0x169)]=void 0x0;function a76_0x3c2a(_0x11eb84,_0x125e2b){_0x11eb84=_0x11eb84-0x15f;const _0x4ca15e=a76_0x4ca1();let _0x3c2afa=_0x4ca15e[_0x11eb84];return _0x3c2afa;}function a76_0x4ca1(){const _0x5a92b9=['code','gateway_id','webhookLogPath','incomplete','\x20\x20\x20Message:\x20','toString','5TWqgyu','base64','getPaymentStatus','existsSync','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','mkdirSync','4280mOTmkd','\x20\x20\x20Last\x204:\x20','2117514iRWcGe','stringify','ðŸ”„\x20Redirect\x20URL:\x20','parse','secretKey','Payment\x20failed','appendFileSync','uid','getBasicAuth','dirname','log','node-fetch','ðŸ”—\x20URL:\x20','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','PAID','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','/transactions/payments','squirrel-pay-webhooks.log','last_4','slice','\x20\x20\x20Status:\x20','13170510IUHXSX','\x20-\x20','\x20\x20\x20UID:\x20','config','default','4903294tYtiqE','crypto','redirect_url','Unknown\x20error','payment_method','friendly_message','join','successful','isTestMode','ðŸ”§\x20Headers:','toISOString','from','\x20\x20\x20Gateway\x20ID:\x20','email','application/json','failed','logWebhook','âŒ\x20SquirrelPay\x20API\x20Error:','processCardPayment','SquirrelPay\x20API\x20error:\x20','POST','status','1095665hcbfnY','FAILED','ðŸ’°\x20Amount:\x20','PENDING','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','ðŸ“\x20Description:\x20','3010803cjlcTR','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','293968bTQVtm','filter','generateRequestId','17316FJsJbT','cwd','4sNUaBC','SquirrelPayService','readFileSync','\x20||\x20','text','__esModule','shopId','ðŸ“¦\x20Body:','ðŸ“‹\x20Request\x20ID:\x20','âœ…\x20SquirrelPay\x20Response\x20Success:','message','defineProperty','ðŸ‘¤\x20Customer:\x20','trim','Basic\x20','path','21byUqwL','12fQsFNd','error','baseUrl'];a76_0x4ca1=function(){return _0x5a92b9;};return a76_0x4ca1();}const crypto_1=__importDefault(require(a76_0x12a84d(0x1a6))),node_fetch_1=__importDefault(require(a76_0x12a84d(0x195))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x12a84d(0x177)));class SquirrelPayService{constructor(_0x4f659e){const _0x1ddd0e=a76_0x12a84d;this[_0x1ddd0e(0x1a3)]=_0x4f659e,this['webhookLogPath']=path_1[_0x1ddd0e(0x1a4)][_0x1ddd0e(0x1ab)](process[_0x1ddd0e(0x167)](),'logs',_0x1ddd0e(0x19c));const _0x3f23bd=path_1['default'][_0x1ddd0e(0x193)](this['webhookLogPath']);!fs_1[_0x1ddd0e(0x1a4)]['existsSync'](_0x3f23bd)&&fs_1[_0x1ddd0e(0x1a4)][_0x1ddd0e(0x187)](_0x3f23bd,{'recursive':!![]});}[a76_0x12a84d(0x192)](){const _0x588d02=a76_0x12a84d,_0x24ddec=this[_0x588d02(0x1a3)][_0x588d02(0x16e)]+':'+this[_0x588d02(0x1a3)][_0x588d02(0x18e)];return Buffer[_0x588d02(0x1b0)](_0x24ddec)[_0x588d02(0x181)](_0x588d02(0x183));}['generateRequestId'](){const _0x3a5000=a76_0x12a84d;return crypto_1[_0x3a5000(0x1a4)]['randomUUID']();}async[a76_0x12a84d(0x1b7)](_0x26b5b5,_0x50c223,_0x222ec2,_0x125821,_0x3dd7eb,_0x10c220,_0x3919cf,_0x380679,_0x4bb333){const _0x5b8130=a76_0x12a84d;console[_0x5b8130(0x194)](_0x5b8130(0x162)),console[_0x5b8130(0x194)](_0x5b8130(0x1bd)+_0x26b5b5+'\x20'+_0x50c223),console[_0x5b8130(0x194)](_0x5b8130(0x160)+_0x222ec2),console['log'](_0x5b8130(0x174)+_0x3919cf[_0x5b8130(0x1b2)]+'\x20('+_0x3919cf['ip']+')');const _0x36f1cc={'request':{'amount':_0x26b5b5,'currency':_0x50c223,'description':_0x222ec2,'gate_id':parseInt(this[_0x5b8130(0x1a3)][_0x5b8130(0x16e)]),'return_url':_0x125821,'notification_url':_0x3dd7eb,'credit_card':_0x10c220,'customer':{'email':_0x3919cf[_0x5b8130(0x1b2)],'phone':_0x4bb333,'birth_date':_0x3919cf['birth_date'],'billing':_0x380679},'test':this['config'][_0x5b8130(0x1ad)]}},_0x2db0c2=this[_0x5b8130(0x165)](),_0x23eb06={'Authorization':_0x5b8130(0x176)+this['getBasicAuth'](),'Content-Type':_0x5b8130(0x1b3),'Accept':_0x5b8130(0x1b3),'X-API-Version':'3','RequestID':_0x2db0c2};try{console[_0x5b8130(0x194)]('ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x5b8130(0x194)](_0x5b8130(0x170)+_0x2db0c2),console[_0x5b8130(0x194)](_0x5b8130(0x196)+this[_0x5b8130(0x1a3)][_0x5b8130(0x17b)]+'/transactions/payments'),console[_0x5b8130(0x194)](_0x5b8130(0x1ae),JSON[_0x5b8130(0x18b)](_0x23eb06,null,0x2)),console[_0x5b8130(0x194)](_0x5b8130(0x16f),JSON[_0x5b8130(0x18b)](_0x36f1cc,null,0x2));const _0x3defde=await(0x0,node_fetch_1[_0x5b8130(0x1a4)])(this[_0x5b8130(0x1a3)][_0x5b8130(0x17b)]+_0x5b8130(0x19b),{'method':_0x5b8130(0x1b9),'headers':_0x23eb06,'body':JSON[_0x5b8130(0x18b)](_0x36f1cc)}),_0x15745e=await _0x3defde[_0x5b8130(0x16c)]();console['log'](_0x5b8130(0x186)+_0x3defde[_0x5b8130(0x1ba)]),console[_0x5b8130(0x194)]('ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20'+_0x15745e);if(!_0x3defde['ok'])throw new Error(_0x5b8130(0x1b8)+_0x3defde[_0x5b8130(0x1ba)]+'\x20'+_0x3defde['statusText']+_0x5b8130(0x1a1)+_0x15745e);const _0x46c079=JSON[_0x5b8130(0x18d)](_0x15745e);return console[_0x5b8130(0x194)](_0x5b8130(0x171)),console['log'](_0x5b8130(0x1a2)+_0x46c079['uid']),console['log'](_0x5b8130(0x19f)+_0x46c079[_0x5b8130(0x1ba)]),console['log']('\x20\x20\x20Code:\x20'+_0x46c079[_0x5b8130(0x17c)]),console['log'](_0x5b8130(0x180)+_0x46c079[_0x5b8130(0x1aa)]),console[_0x5b8130(0x194)](_0x5b8130(0x1b1)+_0x46c079['transaction'][_0x5b8130(0x17d)]),console['log'](_0x5b8130(0x189)+_0x46c079[_0x5b8130(0x1a9)][_0x5b8130(0x19d)]),_0x46c079[_0x5b8130(0x1a7)]&&console[_0x5b8130(0x194)](_0x5b8130(0x18c)+_0x46c079[_0x5b8130(0x1a7)]),_0x46c079;}catch(_0x2807f4){console['error'](_0x5b8130(0x1b6),_0x2807f4);throw _0x2807f4;}}[a76_0x12a84d(0x184)](_0x106b62){const _0xbe00a2=a76_0x12a84d,_0x354d71=_0x106b62[_0xbe00a2(0x191)],_0x22619a=_0x106b62[_0xbe00a2(0x1a9)]['last_4'];console['log'](_0xbe00a2(0x15f)+_0x106b62[_0xbe00a2(0x1ba)]);switch(_0x106b62[_0xbe00a2(0x1ba)]){case _0xbe00a2(0x1ac):return{'status':_0xbe00a2(0x198),'gatewayPaymentId':_0x354d71,'cardLast4':_0x22619a};case _0xbe00a2(0x17f):return{'status':_0xbe00a2(0x1be),'gatewayPaymentId':_0x354d71,'cardLast4':_0x22619a,'redirectUrl':_0x106b62[_0xbe00a2(0x1a7)]};case _0xbe00a2(0x1b4):const _0x2024cf=_0x106b62[_0xbe00a2(0x1aa)]||'',_0x3c30bc=_0x106b62[_0xbe00a2(0x172)]||'';let _0x4ffcb8='';if(_0x2024cf&&_0x3c30bc)_0x4ffcb8=_0x2024cf+_0xbe00a2(0x16b)+_0x3c30bc;else{if(_0x2024cf)_0x4ffcb8=_0x2024cf;else _0x3c30bc?_0x4ffcb8=_0x3c30bc:_0x4ffcb8=_0xbe00a2(0x18f);}return{'status':_0xbe00a2(0x1bc),'failureMessage':_0x4ffcb8,'gatewayPaymentId':_0x354d71,'cardLast4':_0x22619a};default:console['warn']('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x106b62['status']);const _0x1abad9=_0x106b62[_0xbe00a2(0x1aa)]||'',_0x1ef0f1=_0x106b62[_0xbe00a2(0x172)]||'';let _0x5ca7e0='';if(_0x1abad9&&_0x1ef0f1)_0x5ca7e0=_0x1abad9+_0xbe00a2(0x16b)+_0x1ef0f1;else{if(_0x1abad9)_0x5ca7e0=_0x1abad9;else _0x1ef0f1?_0x5ca7e0=_0x1ef0f1:_0x5ca7e0=_0xbe00a2(0x1a8);}return{'status':_0xbe00a2(0x1bc),'failureMessage':_0x5ca7e0,'gatewayPaymentId':_0x354d71,'cardLast4':_0x22619a};}}[a76_0x12a84d(0x1b5)](_0x4171dd){const _0x754128=a76_0x12a84d,_0x3af993=new Date()[_0x754128(0x1af)](),_0x474843={'timestamp':_0x3af993,'webhook':_0x4171dd,'source':'squirrel-pay'},_0x568aba=JSON[_0x754128(0x18b)](_0x474843)+'\x0a';try{fs_1[_0x754128(0x1a4)][_0x754128(0x190)](this[_0x754128(0x17e)],_0x568aba),console[_0x754128(0x194)](_0x754128(0x19a)+_0x3af993);}catch(_0x3b1393){console[_0x754128(0x17a)](_0x754128(0x197),_0x3b1393);}}['getWebhookLogs'](_0x49cc9d=0x32){const _0x5e34f6=a76_0x12a84d;try{if(!fs_1['default'][_0x5e34f6(0x185)](this[_0x5e34f6(0x17e)]))return[];const _0x1a92ef=fs_1[_0x5e34f6(0x1a4)][_0x5e34f6(0x16a)](this['webhookLogPath'],'utf-8'),_0x282b1c=_0x1a92ef[_0x5e34f6(0x175)]()['split']('\x0a')[_0x5e34f6(0x164)](_0x1047b1=>_0x1047b1);return _0x282b1c[_0x5e34f6(0x19e)](-_0x49cc9d)['map'](_0x19b3d3=>{const _0x3260f2=_0x5e34f6;try{return JSON[_0x3260f2(0x18d)](_0x19b3d3);}catch{return null;}})[_0x5e34f6(0x164)](_0x6d7417=>_0x6d7417!==null);}catch(_0xeedd){return console[_0x5e34f6(0x17a)](_0x5e34f6(0x199),_0xeedd),[];}}}exports['SquirrelPayService']=SquirrelPayService;