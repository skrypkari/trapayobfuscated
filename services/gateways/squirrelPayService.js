'use strict';const a64_0x557162=a64_0x543f;function a64_0x429e(){const _0x58f611=['üì¶\x20Body:','‚úÖ\x20SquirrelPay\x20Response\x20Success:','appendFileSync','POST','50hbhTcv','config','default','‚ùå\x20SquirrelPay\x20API\x20Error:','friendly_message','logWebhook','secretKey','üì•\x20SquirrelPay\x20Response\x20Status:\x20','üìù\x20SquirrelPay\x20webhook\x20logged:\x20','redirect_url','23162282MQIwDx','üîç\x20Processing\x20SquirrelPay\x20status:\x20','incomplete','email','üìã\x20Request\x20ID:\x20','üí∞\x20Amount:\x20','/transactions/payments','\x20\x20\x20Message:\x20','FAILED','5940HUSKAj','path','getWebhookLogs','last_4','üìÑ\x20SquirrelPay\x20Response\x20Body:\x20','parse','320379jtehzw','error','logs','PAID','\x20\x20\x20UID:\x20','randomUUID','application/json','PENDING','SquirrelPayService','1084246IxLhih','SquirrelPay\x20API\x20error:\x20','warn','baseUrl','üåê\x20Making\x20request\x20to\x20SquirrelPay\x20API...','isTestMode','successful','slice','code','uid','Unknown\x20error','status','\x20\x20\x20Status:\x20','‚ö†Ô∏è\x20Unknown\x20SquirrelPay\x20status:\x20','üîÑ\x20Redirect\x20URL:\x20','üêøÔ∏è\x20SquirrelPay:\x20Processing\x20card\x20payment','stringify','3497008zSvSKa','squirrel-pay','utf-8','readFileSync','mkdirSync','4256EMWWEy','‚ùå\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','üîó\x20URL:\x20','webhookLogPath','cwd','getBasicAuth','__esModule','node-fetch','payment_method','processCardPayment','3RoWNmC','log','5BmyAnM','\x20-\x20','üë§\x20Customer:\x20','1057520wtTRjK','10014iDJyAu','generateRequestId','toString','\x20\x20\x20Code:\x20','filter','dirname','message','existsSync','map'];a64_0x429e=function(){return _0x58f611;};return a64_0x429e();}(function(_0x3f56f8,_0xcd33bc){const _0x31e411=a64_0x543f,_0x133238=_0x3f56f8();while(!![]){try{const _0x299b1c=-parseInt(_0x31e411(0x1ef))/0x1+parseInt(_0x31e411(0x1f8))/0x2*(parseInt(_0x31e411(0x218))/0x3)+-parseInt(_0x31e411(0x209))/0x4*(parseInt(_0x31e411(0x21a))/0x5)+parseInt(_0x31e411(0x21e))/0x6*(-parseInt(_0x31e411(0x20e))/0x7)+parseInt(_0x31e411(0x21d))/0x8+parseInt(_0x31e411(0x1e9))/0x9*(-parseInt(_0x31e411(0x22b))/0xa)+parseInt(_0x31e411(0x1e0))/0xb;if(_0x299b1c===_0xcd33bc)break;else _0x133238['push'](_0x133238['shift']());}catch(_0x3d0632){_0x133238['push'](_0x133238['shift']());}}}(a64_0x429e,0x8a7fc));var __importDefault=this&&this['__importDefault']||function(_0x1a7687){const _0x10add0=a64_0x543f;return _0x1a7687&&_0x1a7687[_0x10add0(0x214)]?_0x1a7687:{'default':_0x1a7687};};Object['defineProperty'](exports,a64_0x557162(0x214),{'value':!![]}),exports[a64_0x557162(0x1f7)]=void 0x0;const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require(a64_0x557162(0x215))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x557162(0x1ea)));function a64_0x543f(_0x4c01a7,_0x801e14){_0x4c01a7=_0x4c01a7-0x1da;const _0x429e14=a64_0x429e();let _0x543ff4=_0x429e14[_0x4c01a7];return _0x543ff4;}class SquirrelPayService{constructor(_0x4e0921){const _0x210e23=a64_0x557162;this[_0x210e23(0x22c)]=_0x4e0921,this[_0x210e23(0x211)]=path_1[_0x210e23(0x22d)]['join'](process[_0x210e23(0x212)](),_0x210e23(0x1f1),'squirrel-pay-webhooks.log');const _0x3d7589=path_1[_0x210e23(0x22d)][_0x210e23(0x223)](this[_0x210e23(0x211)]);!fs_1[_0x210e23(0x22d)][_0x210e23(0x225)](_0x3d7589)&&fs_1['default'][_0x210e23(0x20d)](_0x3d7589,{'recursive':!![]});}[a64_0x557162(0x213)](){const _0xbbf169=a64_0x557162,_0xe7f007=this[_0xbbf169(0x22c)]['shopId']+':'+this[_0xbbf169(0x22c)][_0xbbf169(0x1dc)];return Buffer['from'](_0xe7f007)[_0xbbf169(0x220)]('base64');}['generateRequestId'](){const _0x1ce89c=a64_0x557162;return crypto_1[_0x1ce89c(0x22d)][_0x1ce89c(0x1f4)]();}async[a64_0x557162(0x217)](_0x38d534,_0x3a1a31,_0x5ad149,_0x1147d2,_0x330d13,_0x2dff4a,_0x15152a,_0x4627c2,_0x3450b3){const _0x3c7ce5=a64_0x557162;console[_0x3c7ce5(0x219)](_0x3c7ce5(0x207)),console[_0x3c7ce5(0x219)](_0x3c7ce5(0x1e5)+_0x38d534+'\x20'+_0x3a1a31),console[_0x3c7ce5(0x219)]('üìù\x20Description:\x20'+_0x5ad149),console[_0x3c7ce5(0x219)](_0x3c7ce5(0x21c)+_0x15152a['email']+'\x20('+_0x15152a['ip']+')');const _0x4a1c89={'request':{'amount':_0x38d534,'currency':_0x3a1a31,'description':_0x5ad149,'gate_id':parseInt(this['config']['shopId']),'return_url':_0x1147d2,'notification_url':_0x330d13,'credit_card':_0x2dff4a,'customer':{'email':_0x15152a[_0x3c7ce5(0x1e3)],'phone':_0x3450b3,'birth_date':_0x15152a['birth_date'],'billing':_0x4627c2},'test':this[_0x3c7ce5(0x22c)][_0x3c7ce5(0x1fd)]}},_0x12c821=this[_0x3c7ce5(0x21f)](),_0x287212={'Authorization':'Basic\x20'+this['getBasicAuth'](),'Content-Type':_0x3c7ce5(0x1f5),'Accept':_0x3c7ce5(0x1f5),'X-API-Version':'3','RequestID':_0x12c821};try{console[_0x3c7ce5(0x219)](_0x3c7ce5(0x1fc)),console['log'](_0x3c7ce5(0x1e4)+_0x12c821),console[_0x3c7ce5(0x219)](_0x3c7ce5(0x210)+this[_0x3c7ce5(0x22c)][_0x3c7ce5(0x1fb)]+_0x3c7ce5(0x1e6)),console['log']('üîß\x20Headers:',JSON[_0x3c7ce5(0x208)](_0x287212,null,0x2)),console['log'](_0x3c7ce5(0x227),JSON[_0x3c7ce5(0x208)](_0x4a1c89,null,0x2));const _0x5e3fcc=await(0x0,node_fetch_1['default'])(this[_0x3c7ce5(0x22c)][_0x3c7ce5(0x1fb)]+_0x3c7ce5(0x1e6),{'method':_0x3c7ce5(0x22a),'headers':_0x287212,'body':JSON[_0x3c7ce5(0x208)](_0x4a1c89)}),_0x1b52b2=await _0x5e3fcc['text']();console[_0x3c7ce5(0x219)](_0x3c7ce5(0x1dd)+_0x5e3fcc[_0x3c7ce5(0x203)]),console['log'](_0x3c7ce5(0x1ed)+_0x1b52b2);if(!_0x5e3fcc['ok'])throw new Error(_0x3c7ce5(0x1f9)+_0x5e3fcc[_0x3c7ce5(0x203)]+'\x20'+_0x5e3fcc['statusText']+_0x3c7ce5(0x21b)+_0x1b52b2);const _0x177d80=JSON[_0x3c7ce5(0x1ee)](_0x1b52b2);return console['log'](_0x3c7ce5(0x228)),console['log'](_0x3c7ce5(0x1f3)+_0x177d80[_0x3c7ce5(0x201)]),console['log'](_0x3c7ce5(0x204)+_0x177d80[_0x3c7ce5(0x203)]),console[_0x3c7ce5(0x219)](_0x3c7ce5(0x221)+_0x177d80[_0x3c7ce5(0x200)]),console[_0x3c7ce5(0x219)](_0x3c7ce5(0x1e7)+_0x177d80['friendly_message']),console[_0x3c7ce5(0x219)]('\x20\x20\x20Gateway\x20ID:\x20'+_0x177d80['transaction']['gateway_id']),console[_0x3c7ce5(0x219)]('\x20\x20\x20Last\x204:\x20'+_0x177d80[_0x3c7ce5(0x216)][_0x3c7ce5(0x1ec)]),_0x177d80[_0x3c7ce5(0x1df)]&&console['log'](_0x3c7ce5(0x206)+_0x177d80['redirect_url']),_0x177d80;}catch(_0x37edf7){console[_0x3c7ce5(0x1f0)](_0x3c7ce5(0x22e),_0x37edf7);throw _0x37edf7;}}['getPaymentStatus'](_0x3e430d){const _0x36ccee=a64_0x557162,_0x4b4681=_0x3e430d['uid'],_0x533026=_0x3e430d['payment_method'][_0x36ccee(0x1ec)];console[_0x36ccee(0x219)](_0x36ccee(0x1e1)+_0x3e430d[_0x36ccee(0x203)]);switch(_0x3e430d[_0x36ccee(0x203)]){case _0x36ccee(0x1fe):return{'status':_0x36ccee(0x1f2),'gatewayPaymentId':_0x4b4681,'cardLast4':_0x533026};case _0x36ccee(0x1e2):return{'status':_0x36ccee(0x1f6),'gatewayPaymentId':_0x4b4681,'cardLast4':_0x533026,'redirectUrl':_0x3e430d[_0x36ccee(0x1df)]};case'failed':const _0x5b864d=_0x3e430d[_0x36ccee(0x1da)]||'',_0x458b8=_0x3e430d[_0x36ccee(0x224)]||'';let _0x44b8a6='';if(_0x5b864d&&_0x458b8)_0x44b8a6=_0x5b864d+'\x20||\x20'+_0x458b8;else{if(_0x5b864d)_0x44b8a6=_0x5b864d;else _0x458b8?_0x44b8a6=_0x458b8:_0x44b8a6='Payment\x20failed';}return{'status':_0x36ccee(0x1e8),'failureMessage':_0x44b8a6,'gatewayPaymentId':_0x4b4681,'cardLast4':_0x533026};default:console[_0x36ccee(0x1fa)](_0x36ccee(0x205)+_0x3e430d[_0x36ccee(0x203)]);const _0x2f4a73=_0x3e430d[_0x36ccee(0x1da)]||'',_0x2445aa=_0x3e430d[_0x36ccee(0x224)]||'';let _0x5de547='';if(_0x2f4a73&&_0x2445aa)_0x5de547=_0x2f4a73+'\x20||\x20'+_0x2445aa;else{if(_0x2f4a73)_0x5de547=_0x2f4a73;else _0x2445aa?_0x5de547=_0x2445aa:_0x5de547=_0x36ccee(0x202);}return{'status':_0x36ccee(0x1e8),'failureMessage':_0x5de547,'gatewayPaymentId':_0x4b4681,'cardLast4':_0x533026};}}[a64_0x557162(0x1db)](_0x2b5a43){const _0x37a43f=a64_0x557162,_0x2e22fc=new Date()['toISOString'](),_0x2ed94f={'timestamp':_0x2e22fc,'webhook':_0x2b5a43,'source':_0x37a43f(0x20a)},_0x2153e7=JSON['stringify'](_0x2ed94f)+'\x0a';try{fs_1[_0x37a43f(0x22d)][_0x37a43f(0x229)](this['webhookLogPath'],_0x2153e7),console['log'](_0x37a43f(0x1de)+_0x2e22fc);}catch(_0x5b1a1b){console['error'](_0x37a43f(0x20f),_0x5b1a1b);}}[a64_0x557162(0x1eb)](_0x3ee3e2=0x32){const _0x1cc5b1=a64_0x557162;try{if(!fs_1[_0x1cc5b1(0x22d)]['existsSync'](this['webhookLogPath']))return[];const _0x4d4c68=fs_1[_0x1cc5b1(0x22d)][_0x1cc5b1(0x20c)](this['webhookLogPath'],_0x1cc5b1(0x20b)),_0x18b144=_0x4d4c68['trim']()['split']('\x0a')[_0x1cc5b1(0x222)](_0x4b56ec=>_0x4b56ec);return _0x18b144[_0x1cc5b1(0x1ff)](-_0x3ee3e2)[_0x1cc5b1(0x226)](_0x44be8b=>{const _0x573d86=_0x1cc5b1;try{return JSON[_0x573d86(0x1ee)](_0x44be8b);}catch{return null;}})[_0x1cc5b1(0x222)](_0x274048=>_0x274048!==null);}catch(_0x5ee9f4){return console[_0x1cc5b1(0x1f0)]('‚ùå\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x5ee9f4),[];}}}exports[a64_0x557162(0x1f7)]=SquirrelPayService;