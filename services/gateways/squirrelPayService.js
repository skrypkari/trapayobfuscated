'use strict';const a64_0x27f2b7=a64_0x830c;function a64_0x830c(_0x4a4f95,_0x31bb34){_0x4a4f95=_0x4a4f95-0x6e;const _0x23fa02=a64_0x23fa();let _0x830ccd=_0x23fa02[_0x4a4f95];return _0x830ccd;}(function(_0x147ce1,_0x5aaca6){const _0x5948c2=a64_0x830c,_0x1a48ef=_0x147ce1();while(!![]){try{const _0x2e24ee=-parseInt(_0x5948c2(0xb4))/0x1*(-parseInt(_0x5948c2(0x82))/0x2)+parseInt(_0x5948c2(0xc8))/0x3*(-parseInt(_0x5948c2(0x91))/0x4)+parseInt(_0x5948c2(0x9f))/0x5+parseInt(_0x5948c2(0xa8))/0x6*(-parseInt(_0x5948c2(0x8c))/0x7)+-parseInt(_0x5948c2(0xa6))/0x8+parseInt(_0x5948c2(0x72))/0x9+-parseInt(_0x5948c2(0xaa))/0xa*(-parseInt(_0x5948c2(0x7e))/0xb);if(_0x2e24ee===_0x5aaca6)break;else _0x1a48ef['push'](_0x1a48ef['shift']());}catch(_0x38e27c){_0x1a48ef['push'](_0x1a48ef['shift']());}}}(a64_0x23fa,0xed748));function a64_0x23fa(){const _0x4080ed=['squirrel-pay','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','slice','base64','__esModule','filter','7tEvXWN','PENDING','path','shopId','birth_date','945732nAcPIJ','email','dirname','statusText','incomplete','payment_method','warn','redirect_url','ðŸ”—\x20URL:\x20','\x20\x20\x20Gateway\x20ID:\x20','POST','ðŸ“¦\x20Body:','toISOString','stringify','404470hRcOlG','__importDefault','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','\x20\x20\x20Last\x204:\x20','text','\x20||\x20','parse','4903656IpJvDB','gateway_id','9762318QOediP','/transactions/payments','6520utRYJX','getBasicAuth','status','processCardPayment','baseUrl','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','\x20\x20\x20UID:\x20','message','utf-8','PAID','794858igDitj','trim','webhookLogPath','application/json','Payment\x20failed','existsSync','failed','last_4','ðŸ‘¤\x20Customer:\x20','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','generateRequestId','log','toString','ðŸ“‹\x20Request\x20ID:\x20','successful','default','appendFileSync','from','\x20\x20\x20Status:\x20','logs','12NFarWj','transaction','friendly_message','FAILED','uid','getWebhookLogs','defineProperty','mkdirSync','11945322toecMY','\x20-\x20','secretKey','logWebhook','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','randomUUID','code','âŒ\x20SquirrelPay\x20API\x20Error:','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','config','SquirrelPay\x20API\x20error:\x20','join','32989gsuUSi','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','\x20\x20\x20Message:\x20','isTestMode','2kPQCeJ','getPaymentStatus','map','SquirrelPayService'];a64_0x23fa=function(){return _0x4080ed;};return a64_0x23fa();}var __importDefault=this&&this[a64_0x27f2b7(0xa0)]||function(_0x11f7b9){const _0x4195b0=a64_0x27f2b7;return _0x11f7b9&&_0x11f7b9[_0x4195b0(0x8a)]?_0x11f7b9:{'default':_0x11f7b9};};Object[a64_0x27f2b7(0x70)](exports,a64_0x27f2b7(0x8a),{'value':!![]}),exports[a64_0x27f2b7(0x85)]=void 0x0;const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x27f2b7(0x8e)));class SquirrelPayService{constructor(_0xf2bade){const _0x38525c=a64_0x27f2b7;this[_0x38525c(0x7b)]=_0xf2bade,this[_0x38525c(0xb6)]=path_1[_0x38525c(0xc3)][_0x38525c(0x7d)](process['cwd'](),_0x38525c(0xc7),'squirrel-pay-webhooks.log');const _0x51f0a3=path_1[_0x38525c(0xc3)][_0x38525c(0x93)](this[_0x38525c(0xb6)]);!fs_1[_0x38525c(0xc3)][_0x38525c(0xb9)](_0x51f0a3)&&fs_1['default'][_0x38525c(0x71)](_0x51f0a3,{'recursive':!![]});}[a64_0x27f2b7(0xab)](){const _0x3da335=a64_0x27f2b7,_0x32d09c=this['config']['shopId']+':'+this['config'][_0x3da335(0x74)];return Buffer[_0x3da335(0xc5)](_0x32d09c)[_0x3da335(0xc0)](_0x3da335(0x89));}[a64_0x27f2b7(0xbe)](){const _0x2fee30=a64_0x27f2b7;return crypto_1[_0x2fee30(0xc3)][_0x2fee30(0x77)]();}async[a64_0x27f2b7(0xad)](_0x33d5f3,_0x3caadc,_0x26767c,_0x35706a,_0xc7e5e7,_0x427dec,_0x1d7145,_0x7b3ac1,_0x166131){const _0x4b0754=a64_0x27f2b7;console[_0x4b0754(0xbf)](_0x4b0754(0xaf)),console['log']('ðŸ’°\x20Amount:\x20'+_0x33d5f3+'\x20'+_0x3caadc),console[_0x4b0754(0xbf)]('ðŸ“\x20Description:\x20'+_0x26767c),console['log'](_0x4b0754(0xbc)+_0x1d7145[_0x4b0754(0x92)]+'\x20('+_0x1d7145['ip']+')');const _0x4921d5={'request':{'amount':_0x33d5f3,'currency':_0x3caadc,'description':_0x26767c,'gate_id':parseInt(this[_0x4b0754(0x7b)][_0x4b0754(0x8f)]),'return_url':_0x35706a,'notification_url':_0xc7e5e7,'credit_card':_0x427dec,'customer':{'email':_0x1d7145[_0x4b0754(0x92)],'phone':_0x166131,'birth_date':_0x1d7145[_0x4b0754(0x90)],'billing':_0x7b3ac1},'test':this[_0x4b0754(0x7b)][_0x4b0754(0x81)]}},_0x466470=this[_0x4b0754(0xbe)](),_0x4795e3={'Authorization':'Basic\x20'+this[_0x4b0754(0xab)](),'Content-Type':_0x4b0754(0xb7),'Accept':_0x4b0754(0xb7),'X-API-Version':'3','RequestID':_0x466470};try{console[_0x4b0754(0xbf)](_0x4b0754(0x76)),console[_0x4b0754(0xbf)](_0x4b0754(0xc1)+_0x466470),console[_0x4b0754(0xbf)](_0x4b0754(0x99)+this[_0x4b0754(0x7b)]['baseUrl']+'/transactions/payments'),console[_0x4b0754(0xbf)]('ðŸ”§\x20Headers:',JSON[_0x4b0754(0x9e)](_0x4795e3,null,0x2)),console['log'](_0x4b0754(0x9c),JSON[_0x4b0754(0x9e)](_0x4921d5,null,0x2));const _0x317412=await(0x0,node_fetch_1[_0x4b0754(0xc3)])(this[_0x4b0754(0x7b)][_0x4b0754(0xae)]+_0x4b0754(0xa9),{'method':_0x4b0754(0x9b),'headers':_0x4795e3,'body':JSON['stringify'](_0x4921d5)}),_0x17f0e9=await _0x317412[_0x4b0754(0xa3)]();console[_0x4b0754(0xbf)]('ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20'+_0x317412['status']),console[_0x4b0754(0xbf)](_0x4b0754(0xa1)+_0x17f0e9);if(!_0x317412['ok'])throw new Error(_0x4b0754(0x7c)+_0x317412[_0x4b0754(0xac)]+'\x20'+_0x317412[_0x4b0754(0x94)]+_0x4b0754(0x73)+_0x17f0e9);const _0x2df1c9=JSON[_0x4b0754(0xa5)](_0x17f0e9);return console[_0x4b0754(0xbf)]('âœ…\x20SquirrelPay\x20Response\x20Success:'),console[_0x4b0754(0xbf)](_0x4b0754(0xb0)+_0x2df1c9[_0x4b0754(0x6e)]),console[_0x4b0754(0xbf)](_0x4b0754(0xc6)+_0x2df1c9[_0x4b0754(0xac)]),console['log']('\x20\x20\x20Code:\x20'+_0x2df1c9[_0x4b0754(0x78)]),console[_0x4b0754(0xbf)](_0x4b0754(0x80)+_0x2df1c9[_0x4b0754(0xca)]),console[_0x4b0754(0xbf)](_0x4b0754(0x9a)+_0x2df1c9[_0x4b0754(0xc9)][_0x4b0754(0xa7)]),console[_0x4b0754(0xbf)](_0x4b0754(0xa2)+_0x2df1c9[_0x4b0754(0x96)][_0x4b0754(0xbb)]),_0x2df1c9[_0x4b0754(0x98)]&&console[_0x4b0754(0xbf)]('ðŸ”„\x20Redirect\x20URL:\x20'+_0x2df1c9[_0x4b0754(0x98)]),_0x2df1c9;}catch(_0x874675){console['error'](_0x4b0754(0x79),_0x874675);throw _0x874675;}}[a64_0x27f2b7(0x83)](_0x537970){const _0x35b1d4=a64_0x27f2b7,_0x1adda3=_0x537970[_0x35b1d4(0x6e)],_0x962b6a=_0x537970[_0x35b1d4(0x96)][_0x35b1d4(0xbb)];console['log'](_0x35b1d4(0x7a)+_0x537970[_0x35b1d4(0xac)]);switch(_0x537970[_0x35b1d4(0xac)]){case _0x35b1d4(0xc2):return{'status':_0x35b1d4(0xb3),'gatewayPaymentId':_0x1adda3,'cardLast4':_0x962b6a};case _0x35b1d4(0x95):return{'status':_0x35b1d4(0x8d),'gatewayPaymentId':_0x1adda3,'cardLast4':_0x962b6a,'redirectUrl':_0x537970[_0x35b1d4(0x98)]};case _0x35b1d4(0xba):const _0x249dc6=_0x537970[_0x35b1d4(0xca)]||'',_0x6a0fcc=_0x537970[_0x35b1d4(0xb1)]||'';let _0x2703c0='';if(_0x249dc6&&_0x6a0fcc)_0x2703c0=_0x249dc6+_0x35b1d4(0xa4)+_0x6a0fcc;else{if(_0x249dc6)_0x2703c0=_0x249dc6;else _0x6a0fcc?_0x2703c0=_0x6a0fcc:_0x2703c0=_0x35b1d4(0xb8);}return{'status':'FAILED','failureMessage':_0x2703c0,'gatewayPaymentId':_0x1adda3,'cardLast4':_0x962b6a};default:console[_0x35b1d4(0x97)](_0x35b1d4(0x7f)+_0x537970[_0x35b1d4(0xac)]);const _0x172827=_0x537970['friendly_message']||'',_0xada478=_0x537970[_0x35b1d4(0xb1)]||'';let _0x4f77cc='';if(_0x172827&&_0xada478)_0x4f77cc=_0x172827+_0x35b1d4(0xa4)+_0xada478;else{if(_0x172827)_0x4f77cc=_0x172827;else _0xada478?_0x4f77cc=_0xada478:_0x4f77cc='Unknown\x20error';}return{'status':_0x35b1d4(0xcb),'failureMessage':_0x4f77cc,'gatewayPaymentId':_0x1adda3,'cardLast4':_0x962b6a};}}[a64_0x27f2b7(0x75)](_0x3aa093){const _0x1a58df=a64_0x27f2b7,_0x3b518e=new Date()[_0x1a58df(0x9d)](),_0x2da9d0={'timestamp':_0x3b518e,'webhook':_0x3aa093,'source':_0x1a58df(0x86)},_0x40462d=JSON[_0x1a58df(0x9e)](_0x2da9d0)+'\x0a';try{fs_1[_0x1a58df(0xc3)][_0x1a58df(0xc4)](this[_0x1a58df(0xb6)],_0x40462d),console['log']('ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x3b518e);}catch(_0x2ce917){console['error'](_0x1a58df(0x87),_0x2ce917);}}[a64_0x27f2b7(0x6f)](_0x17fc8d=0x32){const _0x2e54ba=a64_0x27f2b7;try{if(!fs_1[_0x2e54ba(0xc3)][_0x2e54ba(0xb9)](this[_0x2e54ba(0xb6)]))return[];const _0x39dd4b=fs_1['default']['readFileSync'](this['webhookLogPath'],_0x2e54ba(0xb2)),_0x3d0f2c=_0x39dd4b[_0x2e54ba(0xb5)]()['split']('\x0a')[_0x2e54ba(0x8b)](_0x17f4e0=>_0x17f4e0);return _0x3d0f2c[_0x2e54ba(0x88)](-_0x17fc8d)[_0x2e54ba(0x84)](_0x3e5010=>{const _0x2e847b=_0x2e54ba;try{return JSON[_0x2e847b(0xa5)](_0x3e5010);}catch{return null;}})[_0x2e54ba(0x8b)](_0x346c88=>_0x346c88!==null);}catch(_0xb7c170){return console['error'](_0x2e54ba(0xbd),_0xb7c170),[];}}}exports[a64_0x27f2b7(0x85)]=SquirrelPayService;