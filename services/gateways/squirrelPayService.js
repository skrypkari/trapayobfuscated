'use strict';function a64_0x330d(){const _0x4d31f4=['utf-8','generateRequestId','failed','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','readFileSync','defineProperty','trim','from','getBasicAuth','baseUrl','base64','30ViAFfN','map','__esModule','21420nWhTdt','application/json','isTestMode','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','processCardPayment','mkdirSync','1VdEqNO','birth_date','getWebhookLogs','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','path','uid','log','last_4','PENDING','4425084YERENp','Unknown\x20error','shopId','redirect_url','split','11609GgdlPz','warn','\x20\x20\x20Gateway\x20ID:\x20','1763918OioyBQ','config','default','ðŸ“\x20Description:\x20','gateway_id','16445DYyKTO','4740guRVcN','ðŸ”§\x20Headers:','Payment\x20failed','transaction','toISOString','\x20-\x20','ðŸ’°\x20Amount:\x20','logWebhook','email','node-fetch','parse','ðŸ”„\x20Redirect\x20URL:\x20','error','squirrel-pay-webhooks.log','367956ElSPWl','crypto','6yNSKTE','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','\x20||\x20','7OfyiYS','status','randomUUID','\x20\x20\x20Message:\x20','join','ðŸ”—\x20URL:\x20','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','âœ…\x20SquirrelPay\x20Response\x20Success:','/transactions/payments','toString','webhookLogPath','cwd','secretKey','statusText','2043376KvGbbC','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','\x20\x20\x20UID:\x20','PAID','POST','SquirrelPayService','friendly_message','existsSync','payment_method','3174264qUNLKQ','incomplete','filter','Basic\x20','message','stringify','âŒ\x20SquirrelPay\x20API\x20Error:','squirrel-pay'];a64_0x330d=function(){return _0x4d31f4;};return a64_0x330d();}const a64_0x21f57f=a64_0x2df1;function a64_0x2df1(_0x33bbff,_0x3be528){_0x33bbff=_0x33bbff-0x13c;const _0x330d41=a64_0x330d();let _0x2df16c=_0x330d41[_0x33bbff];return _0x2df16c;}(function(_0x34e5a3,_0x217cc2){const _0x1858ef=a64_0x2df1,_0x18477b=_0x34e5a3();while(!![]){try{const _0x542c12=parseInt(_0x1858ef(0x192))/0x1*(parseInt(_0x1858ef(0x145))/0x2)+-parseInt(_0x1858ef(0x15b))/0x3*(-parseInt(_0x1858ef(0x16c))/0x4)+-parseInt(_0x1858ef(0x188))/0x5*(parseInt(_0x1858ef(0x159))/0x6)+parseInt(_0x1858ef(0x15e))/0x7*(parseInt(_0x1858ef(0x175))/0x8)+-parseInt(_0x1858ef(0x13d))/0x9+parseInt(_0x1858ef(0x14b))/0xa*(parseInt(_0x1858ef(0x14a))/0xb)+-parseInt(_0x1858ef(0x18b))/0xc*(parseInt(_0x1858ef(0x142))/0xd);if(_0x542c12===_0x217cc2)break;else _0x18477b['push'](_0x18477b['shift']());}catch(_0xc2cbad){_0x18477b['push'](_0x18477b['shift']());}}}(a64_0x330d,0x8799f));var __importDefault=this&&this['__importDefault']||function(_0x5e6b48){const _0x79acc3=a64_0x2df1;return _0x5e6b48&&_0x5e6b48[_0x79acc3(0x18a)]?_0x5e6b48:{'default':_0x5e6b48};};Object[a64_0x21f57f(0x182)](exports,'__esModule',{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a64_0x21f57f(0x15a))),node_fetch_1=__importDefault(require(a64_0x21f57f(0x154))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x21f57f(0x196)));class SquirrelPayService{constructor(_0x4edddc){const _0xa13ce7=a64_0x21f57f;this['config']=_0x4edddc,this[_0xa13ce7(0x168)]=path_1[_0xa13ce7(0x147)][_0xa13ce7(0x162)](process[_0xa13ce7(0x169)](),'logs',_0xa13ce7(0x158));const _0x576efa=path_1[_0xa13ce7(0x147)]['dirname'](this[_0xa13ce7(0x168)]);!fs_1['default'][_0xa13ce7(0x173)](_0x576efa)&&fs_1['default'][_0xa13ce7(0x191)](_0x576efa,{'recursive':!![]});}[a64_0x21f57f(0x185)](){const _0x240f53=a64_0x21f57f,_0x2a8a61=this[_0x240f53(0x146)][_0x240f53(0x13f)]+':'+this['config'][_0x240f53(0x16a)];return Buffer[_0x240f53(0x184)](_0x2a8a61)[_0x240f53(0x167)](_0x240f53(0x187));}[a64_0x21f57f(0x17e)](){const _0x46f80f=a64_0x21f57f;return crypto_1[_0x46f80f(0x147)][_0x46f80f(0x160)]();}async[a64_0x21f57f(0x190)](_0x43f345,_0x5d551f,_0x1eaf3d,_0x57fa74,_0x382f5a,_0x10e5bb,_0x9beeda,_0x368cc8,_0xd2e968){const _0x1a6225=a64_0x21f57f;console[_0x1a6225(0x198)](_0x1a6225(0x15c)),console['log'](_0x1a6225(0x151)+_0x43f345+'\x20'+_0x5d551f),console['log'](_0x1a6225(0x148)+_0x1eaf3d),console[_0x1a6225(0x198)]('ðŸ‘¤\x20Customer:\x20'+_0x9beeda['email']+'\x20('+_0x9beeda['ip']+')');const _0x140aa8={'request':{'amount':_0x43f345,'currency':_0x5d551f,'description':_0x1eaf3d,'gate_id':parseInt(this[_0x1a6225(0x146)][_0x1a6225(0x13f)]),'return_url':_0x57fa74,'notification_url':_0x382f5a,'credit_card':_0x10e5bb,'customer':{'email':_0x9beeda[_0x1a6225(0x153)],'phone':_0xd2e968,'birth_date':_0x9beeda[_0x1a6225(0x193)],'billing':_0x368cc8},'test':this[_0x1a6225(0x146)][_0x1a6225(0x18d)]}},_0x12abf8=this['generateRequestId'](),_0x563ea7={'Authorization':_0x1a6225(0x178)+this['getBasicAuth'](),'Content-Type':_0x1a6225(0x18c),'Accept':_0x1a6225(0x18c),'X-API-Version':'3','RequestID':_0x12abf8};try{console[_0x1a6225(0x198)](_0x1a6225(0x195)),console[_0x1a6225(0x198)]('ðŸ“‹\x20Request\x20ID:\x20'+_0x12abf8),console[_0x1a6225(0x198)](_0x1a6225(0x163)+this[_0x1a6225(0x146)]['baseUrl']+'/transactions/payments'),console[_0x1a6225(0x198)](_0x1a6225(0x14c),JSON['stringify'](_0x563ea7,null,0x2)),console['log']('ðŸ“¦\x20Body:',JSON['stringify'](_0x140aa8,null,0x2));const _0x5a4139=await(0x0,node_fetch_1[_0x1a6225(0x147)])(this[_0x1a6225(0x146)][_0x1a6225(0x186)]+_0x1a6225(0x166),{'method':_0x1a6225(0x170),'headers':_0x563ea7,'body':JSON[_0x1a6225(0x17a)](_0x140aa8)}),_0x582167=await _0x5a4139['text']();console['log'](_0x1a6225(0x18e)+_0x5a4139[_0x1a6225(0x15f)]),console[_0x1a6225(0x198)](_0x1a6225(0x180)+_0x582167);if(!_0x5a4139['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x5a4139[_0x1a6225(0x15f)]+'\x20'+_0x5a4139[_0x1a6225(0x16b)]+_0x1a6225(0x150)+_0x582167);const _0x3fc49d=JSON[_0x1a6225(0x155)](_0x582167);return console['log'](_0x1a6225(0x165)),console[_0x1a6225(0x198)](_0x1a6225(0x16e)+_0x3fc49d[_0x1a6225(0x197)]),console['log']('\x20\x20\x20Status:\x20'+_0x3fc49d[_0x1a6225(0x15f)]),console[_0x1a6225(0x198)]('\x20\x20\x20Code:\x20'+_0x3fc49d['code']),console[_0x1a6225(0x198)](_0x1a6225(0x161)+_0x3fc49d[_0x1a6225(0x172)]),console[_0x1a6225(0x198)](_0x1a6225(0x144)+_0x3fc49d[_0x1a6225(0x14e)][_0x1a6225(0x149)]),console['log']('\x20\x20\x20Last\x204:\x20'+_0x3fc49d['payment_method'][_0x1a6225(0x199)]),_0x3fc49d[_0x1a6225(0x140)]&&console[_0x1a6225(0x198)](_0x1a6225(0x156)+_0x3fc49d[_0x1a6225(0x140)]),_0x3fc49d;}catch(_0x262220){console[_0x1a6225(0x157)](_0x1a6225(0x17b),_0x262220);throw _0x262220;}}['getPaymentStatus'](_0x332a27){const _0x1d0a31=a64_0x21f57f,_0x2d7965=_0x332a27[_0x1d0a31(0x197)],_0x3c5efe=_0x332a27[_0x1d0a31(0x174)][_0x1d0a31(0x199)];console[_0x1d0a31(0x198)](_0x1d0a31(0x16d)+_0x332a27[_0x1d0a31(0x15f)]);switch(_0x332a27[_0x1d0a31(0x15f)]){case'successful':return{'status':_0x1d0a31(0x16f),'gatewayPaymentId':_0x2d7965,'cardLast4':_0x3c5efe};case _0x1d0a31(0x176):return{'status':_0x1d0a31(0x13c),'gatewayPaymentId':_0x2d7965,'cardLast4':_0x3c5efe,'redirectUrl':_0x332a27[_0x1d0a31(0x140)]};case _0x1d0a31(0x17f):const _0xa46970=_0x332a27['friendly_message']||'',_0xbe2e58=_0x332a27[_0x1d0a31(0x179)]||'';let _0x6b5d3d='';if(_0xa46970&&_0xbe2e58)_0x6b5d3d=_0xa46970+_0x1d0a31(0x15d)+_0xbe2e58;else{if(_0xa46970)_0x6b5d3d=_0xa46970;else _0xbe2e58?_0x6b5d3d=_0xbe2e58:_0x6b5d3d=_0x1d0a31(0x14d);}return{'status':'FAILED','failureMessage':_0x6b5d3d,'gatewayPaymentId':_0x2d7965,'cardLast4':_0x3c5efe};default:console[_0x1d0a31(0x143)](_0x1d0a31(0x164)+_0x332a27['status']);const _0x33b92a=_0x332a27['friendly_message']||'',_0x5e59a9=_0x332a27[_0x1d0a31(0x179)]||'';let _0x24ce4d='';if(_0x33b92a&&_0x5e59a9)_0x24ce4d=_0x33b92a+_0x1d0a31(0x15d)+_0x5e59a9;else{if(_0x33b92a)_0x24ce4d=_0x33b92a;else _0x5e59a9?_0x24ce4d=_0x5e59a9:_0x24ce4d=_0x1d0a31(0x13e);}return{'status':'FAILED','failureMessage':_0x24ce4d,'gatewayPaymentId':_0x2d7965,'cardLast4':_0x3c5efe};}}[a64_0x21f57f(0x152)](_0x34b697){const _0x4b56f0=a64_0x21f57f,_0x221137=new Date()[_0x4b56f0(0x14f)](),_0x3cb584={'timestamp':_0x221137,'webhook':_0x34b697,'source':_0x4b56f0(0x17c)},_0x169d29=JSON[_0x4b56f0(0x17a)](_0x3cb584)+'\x0a';try{fs_1[_0x4b56f0(0x147)]['appendFileSync'](this[_0x4b56f0(0x168)],_0x169d29),console[_0x4b56f0(0x198)]('ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x221137);}catch(_0x3e334c){console[_0x4b56f0(0x157)]('âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:',_0x3e334c);}}[a64_0x21f57f(0x194)](_0x3ad904=0x32){const _0x32c59d=a64_0x21f57f;try{if(!fs_1[_0x32c59d(0x147)][_0x32c59d(0x173)](this[_0x32c59d(0x168)]))return[];const _0x4ee619=fs_1[_0x32c59d(0x147)][_0x32c59d(0x181)](this[_0x32c59d(0x168)],_0x32c59d(0x17d)),_0x517cb5=_0x4ee619[_0x32c59d(0x183)]()[_0x32c59d(0x141)]('\x0a')[_0x32c59d(0x177)](_0x3e3ffc=>_0x3e3ffc);return _0x517cb5['slice'](-_0x3ad904)[_0x32c59d(0x189)](_0x206f85=>{const _0x255cf3=_0x32c59d;try{return JSON[_0x255cf3(0x155)](_0x206f85);}catch{return null;}})['filter'](_0x3963ee=>_0x3963ee!==null);}catch(_0x30d946){return console['error'](_0x32c59d(0x18f),_0x30d946),[];}}}exports[a64_0x21f57f(0x171)]=SquirrelPayService;