'use strict';function a64_0x4ddc(){const _0x2272a2=['payment_method','__esModule','friendly_message','logWebhook','Unknown\x20error','150KUzbAy','944juQiDy','error','squirrel-pay-webhooks.log','config','üì¶\x20Body:','\x20-\x20','message','split','last_4','baseUrl','üìù\x20SquirrelPay\x20webhook\x20logged:\x20','816648ACJvaz','secretKey','1457260nNveAU','‚úÖ\x20SquirrelPay\x20Response\x20Success:','mkdirSync','utf-8','crypto','filter','birth_date','gateway_id','SquirrelPay\x20API\x20error:\x20','\x20\x20\x20Code:\x20','\x20\x20\x20Last\x204:\x20','application/json','successful','log','‚ö†Ô∏è\x20Unknown\x20SquirrelPay\x20status:\x20','55170VeLZmV','join','SquirrelPayService','existsSync','map','üìã\x20Request\x20ID:\x20','\x20\x20\x20Gateway\x20ID:\x20','warn','getWebhookLogs','getPaymentStatus','\x20\x20\x20Message:\x20','uid','processCardPayment','parse','code','273168GhQzQA','webhookLogPath','‚ùå\x20SquirrelPay\x20API\x20Error:','default','readFileSync','squirrel-pay','cwd','1320717lUBCXx','\x20\x20\x20Status:\x20','redirect_url','POST','üîç\x20Processing\x20SquirrelPay\x20status:\x20','toISOString','1018090hNejPn','generateRequestId','stringify','dirname','getBasicAuth','FAILED','status','121iWAsZk','incomplete','üîó\x20URL:\x20','email','27KUJrHg','trim','\x20||\x20','201580cRdqSp','/transactions/payments','randomUUID','Basic\x20','text','shopId','PENDING','logs','defineProperty','üîß\x20Headers:','__importDefault','üìù\x20Description:\x20','üë§\x20Customer:\x20','node-fetch'];a64_0x4ddc=function(){return _0x2272a2;};return a64_0x4ddc();}const a64_0xa790fa=a64_0x59d4;(function(_0x4c92c6,_0x46c29c){const _0xf73ca0=a64_0x59d4,_0xad82b4=_0x4c92c6();while(!![]){try{const _0x3ca7e2=parseInt(_0xf73ca0(0x1de))/0x1+-parseInt(_0xf73ca0(0x1b9))/0x2+parseInt(_0xf73ca0(0x1ef))/0x3*(parseInt(_0xf73ca0(0x1f2))/0x4)+parseInt(_0xf73ca0(0x205))/0x5*(parseInt(_0xf73ca0(0x1d7))/0x6)+parseInt(_0xf73ca0(0x1b7))/0x7+parseInt(_0xf73ca0(0x206))/0x8*(-parseInt(_0xf73ca0(0x1c8))/0x9)+parseInt(_0xf73ca0(0x1e4))/0xa*(-parseInt(_0xf73ca0(0x1eb))/0xb);if(_0x3ca7e2===_0x46c29c)break;else _0xad82b4['push'](_0xad82b4['shift']());}catch(_0x264286){_0xad82b4['push'](_0xad82b4['shift']());}}}(a64_0x4ddc,0xa736b));var __importDefault=this&&this[a64_0xa790fa(0x1fc)]||function(_0x55b05f){const _0x4897dd=a64_0xa790fa;return _0x55b05f&&_0x55b05f[_0x4897dd(0x201)]?_0x55b05f:{'default':_0x55b05f};};function a64_0x59d4(_0x59fe88,_0x5c9c6d){_0x59fe88=_0x59fe88-0x1b0;const _0x4ddc1a=a64_0x4ddc();let _0x59d4bf=_0x4ddc1a[_0x59fe88];return _0x59d4bf;}Object[a64_0xa790fa(0x1fa)](exports,a64_0xa790fa(0x201),{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a64_0xa790fa(0x1bd))),node_fetch_1=__importDefault(require(a64_0xa790fa(0x1ff))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0x159385){const _0x2581c2=a64_0xa790fa;this[_0x2581c2(0x209)]=_0x159385,this[_0x2581c2(0x1d8)]=path_1[_0x2581c2(0x1da)][_0x2581c2(0x1c9)](process[_0x2581c2(0x1dd)](),_0x2581c2(0x1f9),_0x2581c2(0x208));const _0x1910cb=path_1[_0x2581c2(0x1da)][_0x2581c2(0x1e7)](this[_0x2581c2(0x1d8)]);!fs_1['default'][_0x2581c2(0x1cb)](_0x1910cb)&&fs_1['default'][_0x2581c2(0x1bb)](_0x1910cb,{'recursive':!![]});}[a64_0xa790fa(0x1e8)](){const _0x2ff333=a64_0xa790fa,_0x1782d6=this[_0x2ff333(0x209)][_0x2ff333(0x1f7)]+':'+this[_0x2ff333(0x209)][_0x2ff333(0x1b8)];return Buffer['from'](_0x1782d6)['toString']('base64');}[a64_0xa790fa(0x1e5)](){const _0x548b42=a64_0xa790fa;return crypto_1[_0x548b42(0x1da)][_0x548b42(0x1f4)]();}async[a64_0xa790fa(0x1d4)](_0xdf9be9,_0x344de3,_0x34b982,_0x227c7a,_0xe44f49,_0x9a9a87,_0x1888c3,_0x220a96,_0x581574){const _0x14b03f=a64_0xa790fa;console[_0x14b03f(0x1c6)]('üêøÔ∏è\x20SquirrelPay:\x20Processing\x20card\x20payment'),console[_0x14b03f(0x1c6)]('üí∞\x20Amount:\x20'+_0xdf9be9+'\x20'+_0x344de3),console[_0x14b03f(0x1c6)](_0x14b03f(0x1fd)+_0x34b982),console[_0x14b03f(0x1c6)](_0x14b03f(0x1fe)+_0x1888c3[_0x14b03f(0x1ee)]+'\x20('+_0x1888c3['ip']+')');const _0x4b3e6e={'request':{'amount':_0xdf9be9,'currency':_0x344de3,'description':_0x34b982,'gate_id':parseInt(this[_0x14b03f(0x209)][_0x14b03f(0x1f7)]),'return_url':_0x227c7a,'notification_url':_0xe44f49,'credit_card':_0x9a9a87,'customer':{'email':_0x1888c3[_0x14b03f(0x1ee)],'phone':_0x581574,'birth_date':_0x1888c3[_0x14b03f(0x1bf)],'billing':_0x220a96},'test':this[_0x14b03f(0x209)]['isTestMode']}},_0x270d77=this[_0x14b03f(0x1e5)](),_0x2a7094={'Authorization':_0x14b03f(0x1f5)+this[_0x14b03f(0x1e8)](),'Content-Type':_0x14b03f(0x1c4),'Accept':'application/json','X-API-Version':'3','RequestID':_0x270d77};try{console[_0x14b03f(0x1c6)]('üåê\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x14b03f(0x1c6)](_0x14b03f(0x1cd)+_0x270d77),console[_0x14b03f(0x1c6)](_0x14b03f(0x1ed)+this[_0x14b03f(0x209)][_0x14b03f(0x1b5)]+_0x14b03f(0x1f3)),console['log'](_0x14b03f(0x1fb),JSON[_0x14b03f(0x1e6)](_0x2a7094,null,0x2)),console['log'](_0x14b03f(0x1b0),JSON[_0x14b03f(0x1e6)](_0x4b3e6e,null,0x2));const _0xf93a40=await(0x0,node_fetch_1[_0x14b03f(0x1da)])(this[_0x14b03f(0x209)]['baseUrl']+_0x14b03f(0x1f3),{'method':_0x14b03f(0x1e1),'headers':_0x2a7094,'body':JSON['stringify'](_0x4b3e6e)}),_0xb16c35=await _0xf93a40[_0x14b03f(0x1f6)]();console[_0x14b03f(0x1c6)]('üì•\x20SquirrelPay\x20Response\x20Status:\x20'+_0xf93a40['status']),console['log']('üìÑ\x20SquirrelPay\x20Response\x20Body:\x20'+_0xb16c35);if(!_0xf93a40['ok'])throw new Error(_0x14b03f(0x1c1)+_0xf93a40[_0x14b03f(0x1ea)]+'\x20'+_0xf93a40['statusText']+_0x14b03f(0x1b1)+_0xb16c35);const _0x32837d=JSON['parse'](_0xb16c35);return console['log'](_0x14b03f(0x1ba)),console[_0x14b03f(0x1c6)]('\x20\x20\x20UID:\x20'+_0x32837d[_0x14b03f(0x1d3)]),console[_0x14b03f(0x1c6)](_0x14b03f(0x1df)+_0x32837d[_0x14b03f(0x1ea)]),console['log'](_0x14b03f(0x1c2)+_0x32837d[_0x14b03f(0x1d6)]),console[_0x14b03f(0x1c6)](_0x14b03f(0x1d2)+_0x32837d[_0x14b03f(0x202)]),console[_0x14b03f(0x1c6)](_0x14b03f(0x1ce)+_0x32837d['transaction'][_0x14b03f(0x1c0)]),console[_0x14b03f(0x1c6)](_0x14b03f(0x1c3)+_0x32837d[_0x14b03f(0x200)][_0x14b03f(0x1b4)]),_0x32837d[_0x14b03f(0x1e0)]&&console[_0x14b03f(0x1c6)]('üîÑ\x20Redirect\x20URL:\x20'+_0x32837d['redirect_url']),_0x32837d;}catch(_0x43bae1){console[_0x14b03f(0x207)](_0x14b03f(0x1d9),_0x43bae1);throw _0x43bae1;}}[a64_0xa790fa(0x1d1)](_0x15715c){const _0x2ed925=a64_0xa790fa,_0x3930fd=_0x15715c[_0x2ed925(0x1d3)],_0x3d2a45=_0x15715c[_0x2ed925(0x200)][_0x2ed925(0x1b4)];console[_0x2ed925(0x1c6)](_0x2ed925(0x1e2)+_0x15715c[_0x2ed925(0x1ea)]);switch(_0x15715c[_0x2ed925(0x1ea)]){case _0x2ed925(0x1c5):return{'status':'PAID','gatewayPaymentId':_0x3930fd,'cardLast4':_0x3d2a45};case _0x2ed925(0x1ec):return{'status':_0x2ed925(0x1f8),'gatewayPaymentId':_0x3930fd,'cardLast4':_0x3d2a45,'redirectUrl':_0x15715c[_0x2ed925(0x1e0)]};case'failed':const _0x5d8b8a=_0x15715c[_0x2ed925(0x202)]||'',_0x42bb4b=_0x15715c[_0x2ed925(0x1b2)]||'';let _0x23ee46='';if(_0x5d8b8a&&_0x42bb4b)_0x23ee46=_0x5d8b8a+'\x20||\x20'+_0x42bb4b;else{if(_0x5d8b8a)_0x23ee46=_0x5d8b8a;else _0x42bb4b?_0x23ee46=_0x42bb4b:_0x23ee46='Payment\x20failed';}return{'status':'FAILED','failureMessage':_0x23ee46,'gatewayPaymentId':_0x3930fd,'cardLast4':_0x3d2a45};default:console[_0x2ed925(0x1cf)](_0x2ed925(0x1c7)+_0x15715c[_0x2ed925(0x1ea)]);const _0x31fb3d=_0x15715c[_0x2ed925(0x202)]||'',_0x4819ec=_0x15715c[_0x2ed925(0x1b2)]||'';let _0x47b8d6='';if(_0x31fb3d&&_0x4819ec)_0x47b8d6=_0x31fb3d+_0x2ed925(0x1f1)+_0x4819ec;else{if(_0x31fb3d)_0x47b8d6=_0x31fb3d;else _0x4819ec?_0x47b8d6=_0x4819ec:_0x47b8d6=_0x2ed925(0x204);}return{'status':_0x2ed925(0x1e9),'failureMessage':_0x47b8d6,'gatewayPaymentId':_0x3930fd,'cardLast4':_0x3d2a45};}}[a64_0xa790fa(0x203)](_0x398a24){const _0x4842ff=a64_0xa790fa,_0x3a0f07=new Date()[_0x4842ff(0x1e3)](),_0x3d1a9d={'timestamp':_0x3a0f07,'webhook':_0x398a24,'source':_0x4842ff(0x1dc)},_0x14b064=JSON[_0x4842ff(0x1e6)](_0x3d1a9d)+'\x0a';try{fs_1[_0x4842ff(0x1da)]['appendFileSync'](this[_0x4842ff(0x1d8)],_0x14b064),console['log'](_0x4842ff(0x1b6)+_0x3a0f07);}catch(_0x452d2d){console[_0x4842ff(0x207)]('‚ùå\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:',_0x452d2d);}}[a64_0xa790fa(0x1d0)](_0x4a4fb6=0x32){const _0x44d6c5=a64_0xa790fa;try{if(!fs_1[_0x44d6c5(0x1da)][_0x44d6c5(0x1cb)](this[_0x44d6c5(0x1d8)]))return[];const _0x1aa34e=fs_1[_0x44d6c5(0x1da)][_0x44d6c5(0x1db)](this[_0x44d6c5(0x1d8)],_0x44d6c5(0x1bc)),_0x3e8a67=_0x1aa34e[_0x44d6c5(0x1f0)]()[_0x44d6c5(0x1b3)]('\x0a')['filter'](_0x475257=>_0x475257);return _0x3e8a67['slice'](-_0x4a4fb6)[_0x44d6c5(0x1cc)](_0x3f2cbd=>{const _0x5d7e4f=_0x44d6c5;try{return JSON[_0x5d7e4f(0x1d5)](_0x3f2cbd);}catch{return null;}})[_0x44d6c5(0x1be)](_0x55ccee=>_0x55ccee!==null);}catch(_0x199d36){return console['error']('‚ùå\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x199d36),[];}}}exports[a64_0xa790fa(0x1ca)]=SquirrelPayService;