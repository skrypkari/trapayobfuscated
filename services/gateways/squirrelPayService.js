'use strict';const a64_0x9674b2=a64_0x139b;(function(_0x4008aa,_0x21ce42){const _0x1fb9c0=a64_0x139b,_0x5f35f5=_0x4008aa();while(!![]){try{const _0x4c8320=parseInt(_0x1fb9c0(0x137))/0x1+parseInt(_0x1fb9c0(0x134))/0x2*(parseInt(_0x1fb9c0(0x124))/0x3)+parseInt(_0x1fb9c0(0xf1))/0x4+-parseInt(_0x1fb9c0(0x128))/0x5+-parseInt(_0x1fb9c0(0xea))/0x6*(parseInt(_0x1fb9c0(0x118))/0x7)+-parseInt(_0x1fb9c0(0x106))/0x8+parseInt(_0x1fb9c0(0x131))/0x9*(parseInt(_0x1fb9c0(0xf6))/0xa);if(_0x4c8320===_0x21ce42)break;else _0x5f35f5['push'](_0x5f35f5['shift']());}catch(_0x242be3){_0x5f35f5['push'](_0x5f35f5['shift']());}}}(a64_0x2ce7,0x5fb8c));var __importDefault=this&&this[a64_0x9674b2(0x13a)]||function(_0x37c631){const _0x7b56bf=a64_0x9674b2;return _0x37c631&&_0x37c631[_0x7b56bf(0xe8)]?_0x37c631:{'default':_0x37c631};};Object['defineProperty'](exports,a64_0x9674b2(0xe8),{'value':!![]}),exports[a64_0x9674b2(0x115)]=void 0x0;function a64_0x139b(_0xdb216a,_0x14a5a7){_0xdb216a=_0xdb216a-0xdf;const _0x2ce7d3=a64_0x2ce7();let _0x139b7a=_0x2ce7d3[_0xdb216a];return _0x139b7a;}const crypto_1=__importDefault(require(a64_0x9674b2(0xe3))),node_fetch_1=__importDefault(require(a64_0x9674b2(0x12a))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x9674b2(0x13e)));class SquirrelPayService{constructor(_0x1f7b76){const _0x264830=a64_0x9674b2;this[_0x264830(0x11a)]=_0x1f7b76,this[_0x264830(0x12b)]=path_1[_0x264830(0x13b)]['join'](process[_0x264830(0xff)](),_0x264830(0xe2),_0x264830(0x119));const _0x400019=path_1['default'][_0x264830(0x125)](this[_0x264830(0x12b)]);!fs_1[_0x264830(0x13b)][_0x264830(0x120)](_0x400019)&&fs_1[_0x264830(0x13b)][_0x264830(0x11e)](_0x400019,{'recursive':!![]});}[a64_0x9674b2(0xf5)](){const _0x36803f=a64_0x9674b2,_0x51cbb3=this[_0x36803f(0x11a)][_0x36803f(0xf7)]+':'+this[_0x36803f(0x11a)]['secretKey'];return Buffer['from'](_0x51cbb3)[_0x36803f(0x127)](_0x36803f(0x116));}[a64_0x9674b2(0x109)](){const _0x13a343=a64_0x9674b2;return crypto_1['default'][_0x13a343(0x10e)]();}async[a64_0x9674b2(0xf0)](_0x52c3fd,_0x3115ed,_0x4cb8cb,_0x281f3c,_0xf1770f,_0xf91e90,_0x188c12,_0x1ccff0,_0x56d4ca){const _0x5ef5bf=a64_0x9674b2;console[_0x5ef5bf(0x104)](_0x5ef5bf(0xe7)),console[_0x5ef5bf(0x104)](_0x5ef5bf(0x11b)+_0x52c3fd+'\x20'+_0x3115ed),console[_0x5ef5bf(0x104)](_0x5ef5bf(0x114)+_0x4cb8cb),console[_0x5ef5bf(0x104)](_0x5ef5bf(0x12e)+_0x188c12[_0x5ef5bf(0xe1)]+'\x20('+_0x188c12['ip']+')');const _0x102e36={'request':{'amount':_0x52c3fd,'currency':_0x3115ed,'description':_0x4cb8cb,'gate_id':parseInt(this[_0x5ef5bf(0x11a)][_0x5ef5bf(0xf7)]),'return_url':_0x281f3c,'notification_url':_0xf1770f,'credit_card':_0xf91e90,'customer':{'email':_0x188c12[_0x5ef5bf(0xe1)],'phone':_0x56d4ca,'birth_date':_0x188c12[_0x5ef5bf(0xfd)],'billing':_0x1ccff0},'test':this['config'][_0x5ef5bf(0x121)]}},_0x5016a7=this[_0x5ef5bf(0x109)](),_0x517855={'Authorization':_0x5ef5bf(0xfa)+this['getBasicAuth'](),'Content-Type':_0x5ef5bf(0x101),'Accept':_0x5ef5bf(0x101),'X-API-Version':'3','RequestID':_0x5016a7};try{console[_0x5ef5bf(0x104)](_0x5ef5bf(0x10b)),console[_0x5ef5bf(0x104)](_0x5ef5bf(0xef)+_0x5016a7),console['log']('ğŸ”—\x20URL:\x20'+this[_0x5ef5bf(0x11a)][_0x5ef5bf(0xeb)]+_0x5ef5bf(0x105)),console['log'](_0x5ef5bf(0x100),JSON['stringify'](_0x517855,null,0x2)),console['log'](_0x5ef5bf(0x122),JSON[_0x5ef5bf(0x103)](_0x102e36,null,0x2));const _0xb55078=await(0x0,node_fetch_1[_0x5ef5bf(0x13b)])(this[_0x5ef5bf(0x11a)]['baseUrl']+_0x5ef5bf(0x105),{'method':'POST','headers':_0x517855,'body':JSON[_0x5ef5bf(0x103)](_0x102e36)}),_0x4db002=await _0xb55078[_0x5ef5bf(0xe0)]();console[_0x5ef5bf(0x104)](_0x5ef5bf(0x11d)+_0xb55078['status']),console[_0x5ef5bf(0x104)](_0x5ef5bf(0xe4)+_0x4db002);if(!_0xb55078['ok'])throw new Error(_0x5ef5bf(0xfe)+_0xb55078['status']+'\x20'+_0xb55078['statusText']+_0x5ef5bf(0x111)+_0x4db002);const _0x597241=JSON[_0x5ef5bf(0x129)](_0x4db002);return console[_0x5ef5bf(0x104)](_0x5ef5bf(0x117)),console[_0x5ef5bf(0x104)](_0x5ef5bf(0x113)+_0x597241[_0x5ef5bf(0xf3)]),console[_0x5ef5bf(0x104)](_0x5ef5bf(0x126)+_0x597241['status']),console[_0x5ef5bf(0x104)](_0x5ef5bf(0xe6)+_0x597241[_0x5ef5bf(0x10c)]),console['log'](_0x5ef5bf(0x138)+_0x597241[_0x5ef5bf(0x135)]),console[_0x5ef5bf(0x104)](_0x5ef5bf(0x102)+_0x597241[_0x5ef5bf(0xf4)][_0x5ef5bf(0xec)]),console[_0x5ef5bf(0x104)](_0x5ef5bf(0x123)+_0x597241['payment_method'][_0x5ef5bf(0xf2)]),_0x597241['redirect_url']&&console[_0x5ef5bf(0x104)](_0x5ef5bf(0x10d)+_0x597241[_0x5ef5bf(0x11c)]),_0x597241;}catch(_0x2973b1){console[_0x5ef5bf(0xe9)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x2973b1);throw _0x2973b1;}}['getPaymentStatus'](_0x1db4a5){const _0xafb1d2=a64_0x9674b2,_0x1663d2=_0x1db4a5[_0xafb1d2(0xf3)],_0x13f000=_0x1db4a5[_0xafb1d2(0x11f)][_0xafb1d2(0xf2)];console['log'](_0xafb1d2(0xed)+_0x1db4a5[_0xafb1d2(0x12f)]);switch(_0x1db4a5[_0xafb1d2(0x12f)]){case _0xafb1d2(0xdf):return{'status':'PAID','gatewayPaymentId':_0x1663d2,'cardLast4':_0x13f000};case _0xafb1d2(0x139):return{'status':_0xafb1d2(0x110),'gatewayPaymentId':_0x1663d2,'cardLast4':_0x13f000,'redirectUrl':_0x1db4a5[_0xafb1d2(0x11c)]};case'failed':const _0x2a6c2e=_0x1db4a5[_0xafb1d2(0x135)]||'',_0x3b128e=_0x1db4a5['message']||'';let _0x905e55='';if(_0x2a6c2e&&_0x3b128e)_0x905e55=_0x2a6c2e+_0xafb1d2(0x13d)+_0x3b128e;else{if(_0x2a6c2e)_0x905e55=_0x2a6c2e;else _0x3b128e?_0x905e55=_0x3b128e:_0x905e55=_0xafb1d2(0x136);}return{'status':_0xafb1d2(0x12c),'failureMessage':_0x905e55,'gatewayPaymentId':_0x1663d2,'cardLast4':_0x13f000};default:console[_0xafb1d2(0x107)](_0xafb1d2(0x132)+_0x1db4a5[_0xafb1d2(0x12f)]);const _0x1b9934=_0x1db4a5[_0xafb1d2(0x135)]||'',_0x114f0d=_0x1db4a5['message']||'';let _0x696533='';if(_0x1b9934&&_0x114f0d)_0x696533=_0x1b9934+_0xafb1d2(0x13d)+_0x114f0d;else{if(_0x1b9934)_0x696533=_0x1b9934;else _0x114f0d?_0x696533=_0x114f0d:_0x696533=_0xafb1d2(0x10a);}return{'status':_0xafb1d2(0x12c),'failureMessage':_0x696533,'gatewayPaymentId':_0x1663d2,'cardLast4':_0x13f000};}}[a64_0x9674b2(0x133)](_0x3d9764){const _0x27dc3c=a64_0x9674b2,_0x2691a7=new Date()[_0x27dc3c(0xfc)](),_0x4875cb={'timestamp':_0x2691a7,'webhook':_0x3d9764,'source':_0x27dc3c(0xee)},_0x2f691b=JSON[_0x27dc3c(0x103)](_0x4875cb)+'\x0a';try{fs_1[_0x27dc3c(0x13b)][_0x27dc3c(0x130)](this['webhookLogPath'],_0x2f691b),console['log'](_0x27dc3c(0x12d)+_0x2691a7);}catch(_0x13e52f){console[_0x27dc3c(0xe9)](_0x27dc3c(0x108),_0x13e52f);}}[a64_0x9674b2(0xf8)](_0x1b428a=0x32){const _0x1bfa70=a64_0x9674b2;try{if(!fs_1[_0x1bfa70(0x13b)][_0x1bfa70(0x120)](this['webhookLogPath']))return[];const _0x2eb0bf=fs_1[_0x1bfa70(0x13b)][_0x1bfa70(0xfb)](this['webhookLogPath'],_0x1bfa70(0xe5)),_0x19a443=_0x2eb0bf['trim']()[_0x1bfa70(0x10f)]('\x0a')['filter'](_0x4c7005=>_0x4c7005);return _0x19a443[_0x1bfa70(0xf9)](-_0x1b428a)[_0x1bfa70(0x112)](_0x2d9ba2=>{const _0x34cdc1=_0x1bfa70;try{return JSON[_0x34cdc1(0x129)](_0x2d9ba2);}catch{return null;}})[_0x1bfa70(0x13c)](_0x5d7271=>_0x5d7271!==null);}catch(_0x310df5){return console['error']('âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x310df5),[];}}}exports[a64_0x9674b2(0x115)]=SquirrelPayService;function a64_0x2ce7(){const _0x18474a=['toISOString','birth_date','SquirrelPay\x20API\x20error:\x20','cwd','ğŸ”§\x20Headers:','application/json','\x20\x20\x20Gateway\x20ID:\x20','stringify','log','/transactions/payments','6207864flpYGV','warn','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','generateRequestId','Unknown\x20error','ğŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','code','ğŸ”„\x20Redirect\x20URL:\x20','randomUUID','split','PENDING','\x20-\x20','map','\x20\x20\x20UID:\x20','ğŸ“\x20Description:\x20','SquirrelPayService','base64','âœ…\x20SquirrelPay\x20Response\x20Success:','25130mDrysR','squirrel-pay-webhooks.log','config','ğŸ’°\x20Amount:\x20','redirect_url','ğŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','mkdirSync','payment_method','existsSync','isTestMode','ğŸ“¦\x20Body:','\x20\x20\x20Last\x204:\x20','5295ojMGCA','dirname','\x20\x20\x20Status:\x20','toString','276575Lioscw','parse','node-fetch','webhookLogPath','FAILED','ğŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','ğŸ‘¤\x20Customer:\x20','status','appendFileSync','877761lwMLxF','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','logWebhook','678gqENuO','friendly_message','Payment\x20failed','168932rNFKvZ','\x20\x20\x20Message:\x20','incomplete','__importDefault','default','filter','\x20||\x20','path','successful','text','email','logs','crypto','ğŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','utf-8','\x20\x20\x20Code:\x20','ğŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','__esModule','error','1158SnCSJC','baseUrl','gateway_id','ğŸ”\x20Processing\x20SquirrelPay\x20status:\x20','squirrel-pay','ğŸ“‹\x20Request\x20ID:\x20','processCardPayment','304632mvxqpD','last_4','uid','transaction','getBasicAuth','110bABLZV','shopId','getWebhookLogs','slice','Basic\x20','readFileSync'];a64_0x2ce7=function(){return _0x18474a;};return a64_0x2ce7();}