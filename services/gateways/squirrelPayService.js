'use strict';function a76_0x46a0(){const _0x33f4da=['logWebhook','getBasicAuth','from','ðŸ‘¤\x20Customer:\x20','statusText','squirrel-pay-webhooks.log','last_4','email','stringify','\x20\x20\x20Last\x204:\x20','readFileSync','incomplete','filter','1244745eMyrzy','SquirrelPay\x20API\x20error:\x20','\x20\x20\x20UID:\x20','dirname','9293180SlcLUB','generateRequestId','âœ…\x20SquirrelPay\x20Response\x20Success:','FAILED','transaction','message','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','secretKey','friendly_message','gateway_id','ðŸ”—\x20URL:\x20','processCardPayment','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','application/json','payment_method','cwd','ðŸ“‹\x20Request\x20ID:\x20','base64','__importDefault','path','PAID','6arzEaf','3553260lAfMyO','876760DqxkFN','ðŸ“\x20Description:\x20','\x20\x20\x20Status:\x20','status','/transactions/payments','existsSync','successful','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','utf-8','redirect_url','randomUUID','default','\x20||\x20','uid','\x20-\x20','error','appendFileSync','isTestMode','log','text','toISOString','warn','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','defineProperty','code','config','join','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','Basic\x20','1946672nTtctu','24592IZAFab','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','webhookLogPath','crypto','ðŸ”§\x20Headers:','toString','__esModule','logs','âŒ\x20SquirrelPay\x20API\x20Error:','mkdirSync','node-fetch','squirrel-pay','parse','2488794DUbrqc','getPaymentStatus','804mkJYzM','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','failed','SquirrelPayService','\x20\x20\x20Gateway\x20ID:\x20','map','Unknown\x20error','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:'];a76_0x46a0=function(){return _0x33f4da;};return a76_0x46a0();}const a76_0x14c6f4=a76_0x5a76;(function(_0x31ac5d,_0x3c48ac){const _0x2f3391=a76_0x5a76,_0x4c1bbb=_0x31ac5d();while(!![]){try{const _0xea179e=-parseInt(_0x2f3391(0x90))/0x1+parseInt(_0x2f3391(0x8f))/0x2+parseInt(_0x2f3391(0xbd))/0x3*(parseInt(_0x2f3391(0xae))/0x4)+parseInt(_0x2f3391(0x78))/0x5*(-parseInt(_0x2f3391(0x8e))/0x6)+parseInt(_0x2f3391(0xbb))/0x7+-parseInt(_0x2f3391(0xad))/0x8+parseInt(_0x2f3391(0x74))/0x9;if(_0xea179e===_0x3c48ac)break;else _0x4c1bbb['push'](_0x4c1bbb['shift']());}catch(_0x511a14){_0x4c1bbb['push'](_0x4c1bbb['shift']());}}}(a76_0x46a0,0xe5593));var __importDefault=this&&this[a76_0x14c6f4(0x8b)]||function(_0x1f5ee0){return _0x1f5ee0&&_0x1f5ee0['__esModule']?_0x1f5ee0:{'default':_0x1f5ee0};};function a76_0x5a76(_0x1cba84,_0x12634c){_0x1cba84=_0x1cba84-0x6d;const _0x46a0ae=a76_0x46a0();let _0x5a766f=_0x46a0ae[_0x1cba84];return _0x5a766f;}Object[a76_0x14c6f4(0xa7)](exports,a76_0x14c6f4(0xb4),{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a76_0x14c6f4(0xb1))),node_fetch_1=__importDefault(require(a76_0x14c6f4(0xb8))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x14c6f4(0x8c)));class SquirrelPayService{constructor(_0x19825b){const _0x3be4a5=a76_0x14c6f4;this[_0x3be4a5(0xa9)]=_0x19825b,this[_0x3be4a5(0xb0)]=path_1[_0x3be4a5(0x9b)][_0x3be4a5(0xaa)](process[_0x3be4a5(0x88)](),_0x3be4a5(0xb5),_0x3be4a5(0xca));const _0x4d26ee=path_1[_0x3be4a5(0x9b)][_0x3be4a5(0x77)](this[_0x3be4a5(0xb0)]);!fs_1[_0x3be4a5(0x9b)][_0x3be4a5(0x95)](_0x4d26ee)&&fs_1[_0x3be4a5(0x9b)][_0x3be4a5(0xb7)](_0x4d26ee,{'recursive':!![]});}[a76_0x14c6f4(0xc6)](){const _0x52551a=a76_0x14c6f4,_0x3b6724=this[_0x52551a(0xa9)]['shopId']+':'+this[_0x52551a(0xa9)][_0x52551a(0x7f)];return Buffer[_0x52551a(0xc7)](_0x3b6724)[_0x52551a(0xb3)](_0x52551a(0x8a));}[a76_0x14c6f4(0x79)](){const _0x306e71=a76_0x14c6f4;return crypto_1[_0x306e71(0x9b)][_0x306e71(0x9a)]();}async[a76_0x14c6f4(0x83)](_0xacfca5,_0x4f737e,_0x35e211,_0x46681b,_0x4ab60c,_0x3f4814,_0x15cb33,_0x1b2573,_0x2d06c6){const _0x2cf9eb=a76_0x14c6f4;console[_0x2cf9eb(0xa2)](_0x2cf9eb(0xaf)),console[_0x2cf9eb(0xa2)]('ðŸ’°\x20Amount:\x20'+_0xacfca5+'\x20'+_0x4f737e),console['log'](_0x2cf9eb(0x91)+_0x35e211),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0xc8)+_0x15cb33[_0x2cf9eb(0x6e)]+'\x20('+_0x15cb33['ip']+')');const _0x22c98a={'request':{'amount':_0xacfca5,'currency':_0x4f737e,'description':_0x35e211,'gate_id':parseInt(this[_0x2cf9eb(0xa9)]['shopId']),'return_url':_0x46681b,'notification_url':_0x4ab60c,'credit_card':_0x3f4814,'customer':{'email':_0x15cb33[_0x2cf9eb(0x6e)],'phone':_0x2d06c6,'birth_date':_0x15cb33['birth_date'],'billing':_0x1b2573},'test':this[_0x2cf9eb(0xa9)][_0x2cf9eb(0xa1)]}},_0x2d9173=this['generateRequestId'](),_0x324eb2={'Authorization':_0x2cf9eb(0xac)+this[_0x2cf9eb(0xc6)](),'Content-Type':_0x2cf9eb(0x86),'Accept':_0x2cf9eb(0x86),'X-API-Version':'3','RequestID':_0x2d9173};try{console[_0x2cf9eb(0xa2)](_0x2cf9eb(0x7e)),console['log'](_0x2cf9eb(0x89)+_0x2d9173),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0x82)+this['config']['baseUrl']+_0x2cf9eb(0x94)),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0xb2),JSON['stringify'](_0x324eb2,null,0x2)),console[_0x2cf9eb(0xa2)]('ðŸ“¦\x20Body:',JSON[_0x2cf9eb(0x6f)](_0x22c98a,null,0x2));const _0x531077=await(0x0,node_fetch_1[_0x2cf9eb(0x9b)])(this[_0x2cf9eb(0xa9)]['baseUrl']+_0x2cf9eb(0x94),{'method':'POST','headers':_0x324eb2,'body':JSON['stringify'](_0x22c98a)}),_0x1d6fca=await _0x531077[_0x2cf9eb(0xa3)]();console['log'](_0x2cf9eb(0x97)+_0x531077[_0x2cf9eb(0x93)]),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0x85)+_0x1d6fca);if(!_0x531077['ok'])throw new Error(_0x2cf9eb(0x75)+_0x531077[_0x2cf9eb(0x93)]+'\x20'+_0x531077[_0x2cf9eb(0xc9)]+_0x2cf9eb(0x9e)+_0x1d6fca);const _0x5bfdc8=JSON[_0x2cf9eb(0xba)](_0x1d6fca);return console[_0x2cf9eb(0xa2)](_0x2cf9eb(0x7a)),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0x76)+_0x5bfdc8[_0x2cf9eb(0x9d)]),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0x92)+_0x5bfdc8['status']),console['log']('\x20\x20\x20Code:\x20'+_0x5bfdc8[_0x2cf9eb(0xa8)]),console[_0x2cf9eb(0xa2)]('\x20\x20\x20Message:\x20'+_0x5bfdc8[_0x2cf9eb(0x80)]),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0xc1)+_0x5bfdc8[_0x2cf9eb(0x7c)][_0x2cf9eb(0x81)]),console[_0x2cf9eb(0xa2)](_0x2cf9eb(0x70)+_0x5bfdc8[_0x2cf9eb(0x87)][_0x2cf9eb(0x6d)]),_0x5bfdc8['redirect_url']&&console['log']('ðŸ”„\x20Redirect\x20URL:\x20'+_0x5bfdc8['redirect_url']),_0x5bfdc8;}catch(_0x25dfca){console[_0x2cf9eb(0x9f)](_0x2cf9eb(0xb6),_0x25dfca);throw _0x25dfca;}}[a76_0x14c6f4(0xbc)](_0x52108d){const _0xc5acbb=a76_0x14c6f4,_0xfc19ca=_0x52108d['uid'],_0x47bc46=_0x52108d[_0xc5acbb(0x87)][_0xc5acbb(0x6d)];console[_0xc5acbb(0xa2)](_0xc5acbb(0xab)+_0x52108d[_0xc5acbb(0x93)]);switch(_0x52108d[_0xc5acbb(0x93)]){case _0xc5acbb(0x96):return{'status':_0xc5acbb(0x8d),'gatewayPaymentId':_0xfc19ca,'cardLast4':_0x47bc46};case _0xc5acbb(0x72):return{'status':'PENDING','gatewayPaymentId':_0xfc19ca,'cardLast4':_0x47bc46,'redirectUrl':_0x52108d[_0xc5acbb(0x99)]};case _0xc5acbb(0xbf):const _0x1bb8ea=_0x52108d['friendly_message']||'',_0x29d532=_0x52108d[_0xc5acbb(0x7d)]||'';let _0x34ebd8='';if(_0x1bb8ea&&_0x29d532)_0x34ebd8=_0x1bb8ea+_0xc5acbb(0x9c)+_0x29d532;else{if(_0x1bb8ea)_0x34ebd8=_0x1bb8ea;else _0x29d532?_0x34ebd8=_0x29d532:_0x34ebd8='Payment\x20failed';}return{'status':_0xc5acbb(0x7b),'failureMessage':_0x34ebd8,'gatewayPaymentId':_0xfc19ca,'cardLast4':_0x47bc46};default:console[_0xc5acbb(0xa5)](_0xc5acbb(0xbe)+_0x52108d[_0xc5acbb(0x93)]);const _0x477bc0=_0x52108d[_0xc5acbb(0x80)]||'',_0x783383=_0x52108d['message']||'';let _0x211022='';if(_0x477bc0&&_0x783383)_0x211022=_0x477bc0+'\x20||\x20'+_0x783383;else{if(_0x477bc0)_0x211022=_0x477bc0;else _0x783383?_0x211022=_0x783383:_0x211022=_0xc5acbb(0xc3);}return{'status':_0xc5acbb(0x7b),'failureMessage':_0x211022,'gatewayPaymentId':_0xfc19ca,'cardLast4':_0x47bc46};}}[a76_0x14c6f4(0xc5)](_0x177c25){const _0x531a8f=a76_0x14c6f4,_0x1a4a06=new Date()[_0x531a8f(0xa4)](),_0x56fe0a={'timestamp':_0x1a4a06,'webhook':_0x177c25,'source':_0x531a8f(0xb9)},_0x1454dc=JSON[_0x531a8f(0x6f)](_0x56fe0a)+'\x0a';try{fs_1['default'][_0x531a8f(0xa0)](this[_0x531a8f(0xb0)],_0x1454dc),console['log'](_0x531a8f(0x84)+_0x1a4a06);}catch(_0x1d6d1d){console[_0x531a8f(0x9f)](_0x531a8f(0xc4),_0x1d6d1d);}}['getWebhookLogs'](_0x32c5ed=0x32){const _0x449447=a76_0x14c6f4;try{if(!fs_1[_0x449447(0x9b)][_0x449447(0x95)](this['webhookLogPath']))return[];const _0x142a50=fs_1[_0x449447(0x9b)][_0x449447(0x71)](this[_0x449447(0xb0)],_0x449447(0x98)),_0x288508=_0x142a50['trim']()['split']('\x0a')[_0x449447(0x73)](_0x4674d6=>_0x4674d6);return _0x288508['slice'](-_0x32c5ed)[_0x449447(0xc2)](_0x4b12d5=>{const _0x163f15=_0x449447;try{return JSON[_0x163f15(0xba)](_0x4b12d5);}catch{return null;}})[_0x449447(0x73)](_0x509abc=>_0x509abc!==null);}catch(_0x37d5ee){return console['error'](_0x449447(0xa6),_0x37d5ee),[];}}}exports[a76_0x14c6f4(0xc0)]=SquirrelPayService;