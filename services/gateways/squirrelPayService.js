'use strict';const a64_0x290573=a64_0x4559;(function(_0x43ac59,_0x3729d0){const _0x200dba=a64_0x4559,_0x3dbe7b=_0x43ac59();while(!![]){try{const _0x3040e7=parseInt(_0x200dba(0x177))/0x1+-parseInt(_0x200dba(0x148))/0x2*(-parseInt(_0x200dba(0x14a))/0x3)+parseInt(_0x200dba(0x174))/0x4+-parseInt(_0x200dba(0x18c))/0x5*(parseInt(_0x200dba(0x144))/0x6)+parseInt(_0x200dba(0x168))/0x7*(parseInt(_0x200dba(0x17b))/0x8)+parseInt(_0x200dba(0x186))/0x9*(parseInt(_0x200dba(0x192))/0xa)+parseInt(_0x200dba(0x172))/0xb*(-parseInt(_0x200dba(0x16e))/0xc);if(_0x3040e7===_0x3729d0)break;else _0x3dbe7b['push'](_0x3dbe7b['shift']());}catch(_0x2a87de){_0x3dbe7b['push'](_0x3dbe7b['shift']());}}}(a64_0x4403,0x99315));function a64_0x4559(_0x47e1ff,_0x1fee78){_0x47e1ff=_0x47e1ff-0x13d;const _0x4403a6=a64_0x4403();let _0x4559e6=_0x4403a6[_0x47e1ff];return _0x4559e6;}var __importDefault=this&&this['__importDefault']||function(_0xc5af24){const _0x5cae28=a64_0x4559;return _0xc5af24&&_0xc5af24[_0x5cae28(0x160)]?_0xc5af24:{'default':_0xc5af24};};function a64_0x4403(){const _0x3d0742=['warn','PENDING','6868236tmShhU','ðŸ“\x20Description:\x20','ðŸ‘¤\x20Customer:\x20','map','11lQKWfN','dirname','799824JVmNoR','shopId','friendly_message','522806qBsVIk','redirect_url','\x20\x20\x20Gateway\x20ID:\x20','config','2244728NtHmUS','default','failed','trim','split','existsSync','\x20\x20\x20Code:\x20','getBasicAuth','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','webhookLogPath','log','9rQzgsJ','filter','secretKey','isTestMode','cwd','SquirrelPayService','160mIpDUt','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','SquirrelPay\x20API\x20error:\x20','getWebhookLogs','stringify','\x20-\x20','4358470SMVACU','birth_date','squirrel-pay-webhooks.log','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','âœ…\x20SquirrelPay\x20Response\x20Success:','uid','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','toISOString','email','ðŸ’°\x20Amount:\x20','from','Payment\x20failed','slice','defineProperty','error','84732qHOVUj','/transactions/payments','toString','crypto','212534OqElxo','\x20\x20\x20Status:\x20','6XwDuSO','processCardPayment','incomplete','POST','mkdirSync','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','FAILED','statusText','\x20\x20\x20Message:\x20','last_4','readFileSync','PAID','text','payment_method','\x20||\x20','code','ðŸ”—\x20URL:\x20','transaction','base64','status','âŒ\x20SquirrelPay\x20API\x20Error:','ðŸ“¦\x20Body:','__esModule','parse','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','Unknown\x20error','ðŸ”„\x20Redirect\x20URL:\x20','\x20\x20\x20Last\x204:\x20','generateRequestId','message','7HSfSmN','utf-8','application/json','appendFileSync'];a64_0x4403=function(){return _0x3d0742;};return a64_0x4403();}Object[a64_0x290573(0x142)](exports,a64_0x290573(0x160),{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a64_0x290573(0x147))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0x52747f){const _0x2cedc2=a64_0x290573;this[_0x2cedc2(0x17a)]=_0x52747f,this[_0x2cedc2(0x184)]=path_1[_0x2cedc2(0x17c)]['join'](process[_0x2cedc2(0x18a)](),'logs',_0x2cedc2(0x194));const _0x2acca0=path_1[_0x2cedc2(0x17c)][_0x2cedc2(0x173)](this['webhookLogPath']);!fs_1[_0x2cedc2(0x17c)][_0x2cedc2(0x180)](_0x2acca0)&&fs_1[_0x2cedc2(0x17c)][_0x2cedc2(0x14e)](_0x2acca0,{'recursive':!![]});}[a64_0x290573(0x182)](){const _0x44be39=a64_0x290573,_0x428185=this[_0x44be39(0x17a)][_0x44be39(0x175)]+':'+this[_0x44be39(0x17a)][_0x44be39(0x188)];return Buffer[_0x44be39(0x13f)](_0x428185)[_0x44be39(0x146)](_0x44be39(0x15c));}[a64_0x290573(0x166)](){const _0xf7e897=a64_0x290573;return crypto_1[_0xf7e897(0x17c)]['randomUUID']();}async[a64_0x290573(0x14b)](_0x5b8516,_0x22f35c,_0x30ea76,_0x21df63,_0x16982b,_0x2881c4,_0xab9de0,_0x5b433a,_0x4bdbac){const _0x4468c5=a64_0x290573;console[_0x4468c5(0x185)]('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console[_0x4468c5(0x185)](_0x4468c5(0x13e)+_0x5b8516+'\x20'+_0x22f35c),console[_0x4468c5(0x185)](_0x4468c5(0x16f)+_0x30ea76),console['log'](_0x4468c5(0x170)+_0xab9de0[_0x4468c5(0x13d)]+'\x20('+_0xab9de0['ip']+')');const _0x15fd0a={'request':{'amount':_0x5b8516,'currency':_0x22f35c,'description':_0x30ea76,'gate_id':parseInt(this['config'][_0x4468c5(0x175)]),'return_url':_0x21df63,'notification_url':_0x16982b,'credit_card':_0x2881c4,'customer':{'email':_0xab9de0['email'],'phone':_0x4bdbac,'birth_date':_0xab9de0[_0x4468c5(0x193)],'billing':_0x5b433a},'test':this[_0x4468c5(0x17a)][_0x4468c5(0x189)]}},_0x39567c=this[_0x4468c5(0x166)](),_0x52eb9e={'Authorization':'Basic\x20'+this[_0x4468c5(0x182)](),'Content-Type':'application/json','Accept':_0x4468c5(0x16a),'X-API-Version':'3','RequestID':_0x39567c};try{console[_0x4468c5(0x185)](_0x4468c5(0x195)),console['log']('ðŸ“‹\x20Request\x20ID:\x20'+_0x39567c),console[_0x4468c5(0x185)](_0x4468c5(0x15a)+this[_0x4468c5(0x17a)]['baseUrl']+_0x4468c5(0x145)),console[_0x4468c5(0x185)]('ðŸ”§\x20Headers:',JSON[_0x4468c5(0x190)](_0x52eb9e,null,0x2)),console[_0x4468c5(0x185)](_0x4468c5(0x15f),JSON[_0x4468c5(0x190)](_0x15fd0a,null,0x2));const _0x54f230=await(0x0,node_fetch_1[_0x4468c5(0x17c)])(this['config']['baseUrl']+_0x4468c5(0x145),{'method':_0x4468c5(0x14d),'headers':_0x52eb9e,'body':JSON[_0x4468c5(0x190)](_0x15fd0a)}),_0x428a27=await _0x54f230[_0x4468c5(0x156)]();console[_0x4468c5(0x185)](_0x4468c5(0x18d)+_0x54f230[_0x4468c5(0x15d)]),console['log'](_0x4468c5(0x14f)+_0x428a27);if(!_0x54f230['ok'])throw new Error(_0x4468c5(0x18e)+_0x54f230[_0x4468c5(0x15d)]+'\x20'+_0x54f230[_0x4468c5(0x151)]+_0x4468c5(0x191)+_0x428a27);const _0x1d5a6b=JSON[_0x4468c5(0x161)](_0x428a27);return console['log'](_0x4468c5(0x196)),console[_0x4468c5(0x185)]('\x20\x20\x20UID:\x20'+_0x1d5a6b[_0x4468c5(0x197)]),console['log'](_0x4468c5(0x149)+_0x1d5a6b['status']),console[_0x4468c5(0x185)](_0x4468c5(0x181)+_0x1d5a6b[_0x4468c5(0x159)]),console['log'](_0x4468c5(0x152)+_0x1d5a6b[_0x4468c5(0x176)]),console[_0x4468c5(0x185)](_0x4468c5(0x179)+_0x1d5a6b[_0x4468c5(0x15b)]['gateway_id']),console[_0x4468c5(0x185)](_0x4468c5(0x165)+_0x1d5a6b['payment_method'][_0x4468c5(0x153)]),_0x1d5a6b[_0x4468c5(0x178)]&&console[_0x4468c5(0x185)](_0x4468c5(0x164)+_0x1d5a6b[_0x4468c5(0x178)]),_0x1d5a6b;}catch(_0x336e54){console[_0x4468c5(0x143)](_0x4468c5(0x15e),_0x336e54);throw _0x336e54;}}['getPaymentStatus'](_0x4ecda5){const _0x303c8d=a64_0x290573,_0x57fb92=_0x4ecda5[_0x303c8d(0x197)],_0x567e4d=_0x4ecda5[_0x303c8d(0x157)][_0x303c8d(0x153)];console[_0x303c8d(0x185)](_0x303c8d(0x198)+_0x4ecda5[_0x303c8d(0x15d)]);switch(_0x4ecda5[_0x303c8d(0x15d)]){case'successful':return{'status':_0x303c8d(0x155),'gatewayPaymentId':_0x57fb92,'cardLast4':_0x567e4d};case _0x303c8d(0x14c):return{'status':_0x303c8d(0x16d),'gatewayPaymentId':_0x57fb92,'cardLast4':_0x567e4d,'redirectUrl':_0x4ecda5['redirect_url']};case _0x303c8d(0x17d):const _0x1eabc6=_0x4ecda5[_0x303c8d(0x176)]||'',_0x2e96b0=_0x4ecda5[_0x303c8d(0x167)]||'';let _0x249f0a='';if(_0x1eabc6&&_0x2e96b0)_0x249f0a=_0x1eabc6+_0x303c8d(0x158)+_0x2e96b0;else{if(_0x1eabc6)_0x249f0a=_0x1eabc6;else _0x2e96b0?_0x249f0a=_0x2e96b0:_0x249f0a=_0x303c8d(0x140);}return{'status':_0x303c8d(0x150),'failureMessage':_0x249f0a,'gatewayPaymentId':_0x57fb92,'cardLast4':_0x567e4d};default:console[_0x303c8d(0x16c)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x4ecda5['status']);const _0x1f1b81=_0x4ecda5['friendly_message']||'',_0x47a888=_0x4ecda5[_0x303c8d(0x167)]||'';let _0x1861d1='';if(_0x1f1b81&&_0x47a888)_0x1861d1=_0x1f1b81+_0x303c8d(0x158)+_0x47a888;else{if(_0x1f1b81)_0x1861d1=_0x1f1b81;else _0x47a888?_0x1861d1=_0x47a888:_0x1861d1=_0x303c8d(0x163);}return{'status':_0x303c8d(0x150),'failureMessage':_0x1861d1,'gatewayPaymentId':_0x57fb92,'cardLast4':_0x567e4d};}}['logWebhook'](_0x26e5f2){const _0x167fdf=a64_0x290573,_0x22f87d=new Date()[_0x167fdf(0x199)](),_0x5349f0={'timestamp':_0x22f87d,'webhook':_0x26e5f2,'source':'squirrel-pay'},_0x336ab8=JSON[_0x167fdf(0x190)](_0x5349f0)+'\x0a';try{fs_1[_0x167fdf(0x17c)][_0x167fdf(0x16b)](this['webhookLogPath'],_0x336ab8),console[_0x167fdf(0x185)]('ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x22f87d);}catch(_0x3e43c6){console[_0x167fdf(0x143)](_0x167fdf(0x183),_0x3e43c6);}}[a64_0x290573(0x18f)](_0x1205bd=0x32){const _0x1bcc6c=a64_0x290573;try{if(!fs_1['default'][_0x1bcc6c(0x180)](this[_0x1bcc6c(0x184)]))return[];const _0x3e4503=fs_1[_0x1bcc6c(0x17c)][_0x1bcc6c(0x154)](this[_0x1bcc6c(0x184)],_0x1bcc6c(0x169)),_0x404747=_0x3e4503[_0x1bcc6c(0x17e)]()[_0x1bcc6c(0x17f)]('\x0a')[_0x1bcc6c(0x187)](_0x2f59ef=>_0x2f59ef);return _0x404747[_0x1bcc6c(0x141)](-_0x1205bd)[_0x1bcc6c(0x171)](_0x15362c=>{try{return JSON['parse'](_0x15362c);}catch{return null;}})[_0x1bcc6c(0x187)](_0x3384cb=>_0x3384cb!==null);}catch(_0x21988d){return console[_0x1bcc6c(0x143)](_0x1bcc6c(0x162),_0x21988d),[];}}}exports[a64_0x290573(0x18b)]=SquirrelPayService;