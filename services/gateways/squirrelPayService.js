'use strict';const a76_0x55d938=a76_0x413d;(function(_0x269181,_0x1ac3bb){const _0x5c3015=a76_0x413d,_0x4149e8=_0x269181();while(!![]){try{const _0x401915=parseInt(_0x5c3015(0xb4))/0x1+parseInt(_0x5c3015(0xa3))/0x2+-parseInt(_0x5c3015(0x6a))/0x3+parseInt(_0x5c3015(0x8e))/0x4+-parseInt(_0x5c3015(0xa5))/0x5*(parseInt(_0x5c3015(0x7d))/0x6)+parseInt(_0x5c3015(0xa7))/0x7+-parseInt(_0x5c3015(0xa8))/0x8;if(_0x401915===_0x1ac3bb)break;else _0x4149e8['push'](_0x4149e8['shift']());}catch(_0x23e9ae){_0x4149e8['push'](_0x4149e8['shift']());}}}(a76_0x7b34,0xbe02d));var __importDefault=this&&this[a76_0x55d938(0xb5)]||function(_0x538694){const _0x8a5376=a76_0x55d938;return _0x538694&&_0x538694[_0x8a5376(0x73)]?_0x538694:{'default':_0x538694};};Object[a76_0x55d938(0x9b)](exports,'__esModule',{'value':!![]}),exports[a76_0x55d938(0x88)]=void 0x0;function a76_0x7b34(){const _0x37c294=['ðŸ”„\x20Redirect\x20URL:\x20','parse','appendFileSync','config','statusText','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','\x20\x20\x20Message:\x20','uid','email','defineProperty','processCardPayment','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','dirname','SquirrelPay\x20API\x20error:\x20','ðŸ”§\x20Headers:','Unknown\x20error','path','800042pWeCtI','message','680FpdJfR','logWebhook','7498190RufcNP','12642024QzCJMs','status','ðŸ“‹\x20Request\x20ID:\x20','node-fetch','log','friendly_message','filter','/transactions/payments','gateway_id','randomUUID','Basic\x20','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','1048526pVoByo','__importDefault','ðŸ“¦\x20Body:','webhookLogPath','application/json','default','successful','generateRequestId','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','ðŸ”—\x20URL:\x20','\x20||\x20','payment_method','warn','getWebhookLogs','ðŸ“\x20Description:\x20','4001145WIwLrl','PENDING','readFileSync','trim','shopId','toString','redirect_url','code','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','__esModule','getPaymentStatus','\x20\x20\x20Code:\x20','cwd','baseUrl','ðŸ’°\x20Amount:\x20','slice','\x20\x20\x20UID:\x20','failed','âŒ\x20SquirrelPay\x20API\x20Error:','1452ASvrLe','text','from','\x20\x20\x20Status:\x20','toISOString','isTestMode','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','split','FAILED','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','stringify','SquirrelPayService','PAID','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','error','utf-8','getBasicAuth','4821792QFsxJw','existsSync','map','last_4'];a76_0x7b34=function(){return _0x37c294;};return a76_0x7b34();}function a76_0x413d(_0x4dc148,_0x11b5e8){_0x4dc148=_0x4dc148-0x65;const _0x7b3486=a76_0x7b34();let _0x413d41=_0x7b3486[_0x4dc148];return _0x413d41;}const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require(a76_0x55d938(0xab))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x55d938(0xa2)));class SquirrelPayService{constructor(_0x2fabb1){const _0x1cba97=a76_0x55d938;this['config']=_0x2fabb1,this[_0x1cba97(0xb7)]=path_1[_0x1cba97(0xb9)]['join'](process[_0x1cba97(0x76)](),'logs','squirrel-pay-webhooks.log');const _0x5886f8=path_1[_0x1cba97(0xb9)][_0x1cba97(0x9e)](this[_0x1cba97(0xb7)]);!fs_1[_0x1cba97(0xb9)]['existsSync'](_0x5886f8)&&fs_1[_0x1cba97(0xb9)]['mkdirSync'](_0x5886f8,{'recursive':!![]});}['getBasicAuth'](){const _0x276cdd=a76_0x55d938,_0x2ce7c8=this[_0x276cdd(0x95)][_0x276cdd(0x6e)]+':'+this[_0x276cdd(0x95)]['secretKey'];return Buffer[_0x276cdd(0x7f)](_0x2ce7c8)[_0x276cdd(0x6f)]('base64');}[a76_0x55d938(0xbb)](){const _0xd1b66=a76_0x55d938;return crypto_1[_0xd1b66(0xb9)][_0xd1b66(0xb1)]();}async[a76_0x55d938(0x9c)](_0x4bcefc,_0x45d609,_0x2e4939,_0x535534,_0x5accc,_0x5e5d59,_0x4a617f,_0x3f6ebb,_0x2a3f2d){const _0x2ca8f0=a76_0x55d938;console[_0x2ca8f0(0xac)](_0x2ca8f0(0x97)),console[_0x2ca8f0(0xac)](_0x2ca8f0(0x78)+_0x4bcefc+'\x20'+_0x45d609),console['log'](_0x2ca8f0(0x69)+_0x2e4939),console[_0x2ca8f0(0xac)]('ðŸ‘¤\x20Customer:\x20'+_0x4a617f[_0x2ca8f0(0x9a)]+'\x20('+_0x4a617f['ip']+')');const _0x5d6c0c={'request':{'amount':_0x4bcefc,'currency':_0x45d609,'description':_0x2e4939,'gate_id':parseInt(this['config'][_0x2ca8f0(0x6e)]),'return_url':_0x535534,'notification_url':_0x5accc,'credit_card':_0x5e5d59,'customer':{'email':_0x4a617f[_0x2ca8f0(0x9a)],'phone':_0x2a3f2d,'birth_date':_0x4a617f['birth_date'],'billing':_0x3f6ebb},'test':this[_0x2ca8f0(0x95)][_0x2ca8f0(0x82)]}},_0x32e6fd=this[_0x2ca8f0(0xbb)](),_0x507171={'Authorization':_0x2ca8f0(0xb2)+this[_0x2ca8f0(0x8d)](),'Content-Type':_0x2ca8f0(0xb8),'Accept':_0x2ca8f0(0xb8),'X-API-Version':'3','RequestID':_0x32e6fd};try{console['log'](_0x2ca8f0(0x86)),console['log'](_0x2ca8f0(0xaa)+_0x32e6fd),console[_0x2ca8f0(0xac)](_0x2ca8f0(0xbd)+this[_0x2ca8f0(0x95)]['baseUrl']+_0x2ca8f0(0xaf)),console[_0x2ca8f0(0xac)](_0x2ca8f0(0xa0),JSON[_0x2ca8f0(0x87)](_0x507171,null,0x2)),console['log'](_0x2ca8f0(0xb6),JSON[_0x2ca8f0(0x87)](_0x5d6c0c,null,0x2));const _0x24ad48=await(0x0,node_fetch_1['default'])(this['config'][_0x2ca8f0(0x77)]+'/transactions/payments',{'method':'POST','headers':_0x507171,'body':JSON[_0x2ca8f0(0x87)](_0x5d6c0c)}),_0x32ac09=await _0x24ad48[_0x2ca8f0(0x7e)]();console[_0x2ca8f0(0xac)](_0x2ca8f0(0x8a)+_0x24ad48['status']),console[_0x2ca8f0(0xac)](_0x2ca8f0(0x9d)+_0x32ac09);if(!_0x24ad48['ok'])throw new Error(_0x2ca8f0(0x9f)+_0x24ad48[_0x2ca8f0(0xa9)]+'\x20'+_0x24ad48[_0x2ca8f0(0x96)]+'\x20-\x20'+_0x32ac09);const _0x435060=JSON[_0x2ca8f0(0x93)](_0x32ac09);return console['log']('âœ…\x20SquirrelPay\x20Response\x20Success:'),console[_0x2ca8f0(0xac)](_0x2ca8f0(0x7a)+_0x435060[_0x2ca8f0(0x99)]),console['log'](_0x2ca8f0(0x80)+_0x435060[_0x2ca8f0(0xa9)]),console[_0x2ca8f0(0xac)](_0x2ca8f0(0x75)+_0x435060[_0x2ca8f0(0x71)]),console['log'](_0x2ca8f0(0x98)+_0x435060[_0x2ca8f0(0xad)]),console['log']('\x20\x20\x20Gateway\x20ID:\x20'+_0x435060['transaction'][_0x2ca8f0(0xb0)]),console['log']('\x20\x20\x20Last\x204:\x20'+_0x435060['payment_method']['last_4']),_0x435060[_0x2ca8f0(0x70)]&&console[_0x2ca8f0(0xac)](_0x2ca8f0(0x92)+_0x435060[_0x2ca8f0(0x70)]),_0x435060;}catch(_0x451cc1){console['error'](_0x2ca8f0(0x7c),_0x451cc1);throw _0x451cc1;}}[a76_0x55d938(0x74)](_0x4cabc8){const _0x30b557=a76_0x55d938,_0x24db04=_0x4cabc8[_0x30b557(0x99)],_0x1301cf=_0x4cabc8[_0x30b557(0x66)][_0x30b557(0x91)];console[_0x30b557(0xac)](_0x30b557(0xb3)+_0x4cabc8[_0x30b557(0xa9)]);switch(_0x4cabc8['status']){case _0x30b557(0xba):return{'status':_0x30b557(0x89),'gatewayPaymentId':_0x24db04,'cardLast4':_0x1301cf};case'incomplete':return{'status':_0x30b557(0x6b),'gatewayPaymentId':_0x24db04,'cardLast4':_0x1301cf,'redirectUrl':_0x4cabc8[_0x30b557(0x70)]};case _0x30b557(0x7b):const _0x21609e=_0x4cabc8['friendly_message']||'',_0x36cf84=_0x4cabc8[_0x30b557(0xa4)]||'';let _0x19c1a6='';if(_0x21609e&&_0x36cf84)_0x19c1a6=_0x21609e+_0x30b557(0x65)+_0x36cf84;else{if(_0x21609e)_0x19c1a6=_0x21609e;else _0x36cf84?_0x19c1a6=_0x36cf84:_0x19c1a6='Payment\x20failed';}return{'status':_0x30b557(0x85),'failureMessage':_0x19c1a6,'gatewayPaymentId':_0x24db04,'cardLast4':_0x1301cf};default:console[_0x30b557(0x67)](_0x30b557(0xbc)+_0x4cabc8[_0x30b557(0xa9)]);const _0xd34e2a=_0x4cabc8[_0x30b557(0xad)]||'',_0x4dc5ab=_0x4cabc8['message']||'';let _0x3e24b6='';if(_0xd34e2a&&_0x4dc5ab)_0x3e24b6=_0xd34e2a+_0x30b557(0x65)+_0x4dc5ab;else{if(_0xd34e2a)_0x3e24b6=_0xd34e2a;else _0x4dc5ab?_0x3e24b6=_0x4dc5ab:_0x3e24b6=_0x30b557(0xa1);}return{'status':_0x30b557(0x85),'failureMessage':_0x3e24b6,'gatewayPaymentId':_0x24db04,'cardLast4':_0x1301cf};}}[a76_0x55d938(0xa6)](_0x30e0a0){const _0x34071c=a76_0x55d938,_0x4b9dec=new Date()[_0x34071c(0x81)](),_0x1f59a8={'timestamp':_0x4b9dec,'webhook':_0x30e0a0,'source':'squirrel-pay'},_0x673918=JSON[_0x34071c(0x87)](_0x1f59a8)+'\x0a';try{fs_1[_0x34071c(0xb9)][_0x34071c(0x94)](this[_0x34071c(0xb7)],_0x673918),console['log'](_0x34071c(0x83)+_0x4b9dec);}catch(_0x58de67){console['error']('âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:',_0x58de67);}}[a76_0x55d938(0x68)](_0x2f826c=0x32){const _0x102cfa=a76_0x55d938;try{if(!fs_1['default'][_0x102cfa(0x8f)](this[_0x102cfa(0xb7)]))return[];const _0x5502c7=fs_1[_0x102cfa(0xb9)][_0x102cfa(0x6c)](this[_0x102cfa(0xb7)],_0x102cfa(0x8c)),_0x583954=_0x5502c7[_0x102cfa(0x6d)]()[_0x102cfa(0x84)]('\x0a')[_0x102cfa(0xae)](_0x139745=>_0x139745);return _0x583954[_0x102cfa(0x79)](-_0x2f826c)[_0x102cfa(0x90)](_0x1eb21c=>{try{return JSON['parse'](_0x1eb21c);}catch{return null;}})['filter'](_0xf166c9=>_0xf166c9!==null);}catch(_0x22ac15){return console[_0x102cfa(0x8b)](_0x102cfa(0x72),_0x22ac15),[];}}}exports[a76_0x55d938(0x88)]=SquirrelPayService;