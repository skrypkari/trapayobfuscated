'use strict';const a68_0x378ccd=a68_0x1e3a;(function(_0x9bef97,_0xa80ed){const _0x21825a=a68_0x1e3a,_0x4421bc=_0x9bef97();while(!![]){try{const _0x54ace8=-parseInt(_0x21825a(0x1f2))/0x1*(parseInt(_0x21825a(0x1d9))/0x2)+-parseInt(_0x21825a(0x1d7))/0x3+parseInt(_0x21825a(0x20a))/0x4+parseInt(_0x21825a(0x1d0))/0x5+parseInt(_0x21825a(0x1e3))/0x6*(parseInt(_0x21825a(0x1ea))/0x7)+-parseInt(_0x21825a(0x1cb))/0x8+-parseInt(_0x21825a(0x1cd))/0x9*(-parseInt(_0x21825a(0x1f7))/0xa);if(_0x54ace8===_0xa80ed)break;else _0x4421bc['push'](_0x4421bc['shift']());}catch(_0x189181){_0x4421bc['push'](_0x4421bc['shift']());}}}(a68_0x5c77,0x30411));var __importDefault=this&&this[a68_0x378ccd(0x1ca)]||function(_0x235512){const _0x366ba6=a68_0x378ccd;return _0x235512&&_0x235512[_0x366ba6(0x1d6)]?_0x235512:{'default':_0x235512};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a68_0x378ccd(0x206)]=void 0x0;function a68_0x1e3a(_0x38e0dd,_0x507409){_0x38e0dd=_0x38e0dd-0x1ca;const _0x5c77a0=a68_0x5c77();let _0x1e3a6a=_0x5c77a0[_0x38e0dd];return _0x1e3a6a;}const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x378ccd(0x1f8)));function a68_0x5c77(){const _0x41cbbb=['transaction','redirect_url','stringify','email','FAILED','PENDING','Basic\x20','application/json','message','66PvhsZs','\x20\x20\x20Gateway\x20ID:\x20','uid','ðŸ“¦\x20Body:','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','incomplete','\x20\x20\x20Last\x204:\x20','136493BYUpwB','default','âœ…\x20SquirrelPay\x20Response\x20Success:','getWebhookLogs','ðŸ‘¤\x20Customer:\x20','secretKey','text','baseUrl','4579tpStmZ','PAID','map','\x20||\x20','generateRequestId','30svNCsN','path','SquirrelPay\x20API\x20error:\x20','POST','code','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','getBasicAuth','mkdirSync','logWebhook','payment_method','log','toString','friendly_message','squirrel-pay','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','SquirrelPayService','trim','cwd','toISOString','1144660OndahL','\x20\x20\x20Code:\x20','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','error','ðŸ”—\x20URL:\x20','\x20\x20\x20UID:\x20','gateway_id','\x20\x20\x20Message:\x20','statusText','ðŸ”„\x20Redirect\x20URL:\x20','existsSync','parse','from','config','randomUUID','last_4','webhookLogPath','status','appendFileSync','failed','ðŸ”§\x20Headers:','successful','utf-8','\x20-\x20','__importDefault','1551520HYyflI','ðŸ“\x20Description:\x20','371817ulGDgd','join','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','317460ybekFp','squirrel-pay-webhooks.log','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','/transactions/payments','birth_date','warn','__esModule','875751GItAde','isTestMode','2MXcKcX'];a68_0x5c77=function(){return _0x41cbbb;};return a68_0x5c77();}class SquirrelPayService{constructor(_0x5c4138){const _0x553088=a68_0x378ccd;this['config']=_0x5c4138,this[_0x553088(0x21b)]=path_1['default'][_0x553088(0x1ce)](process[_0x553088(0x208)](),'logs',_0x553088(0x1d1));const _0xda8864=path_1[_0x553088(0x1eb)]['dirname'](this['webhookLogPath']);!fs_1[_0x553088(0x1eb)][_0x553088(0x215)](_0xda8864)&&fs_1[_0x553088(0x1eb)][_0x553088(0x1fe)](_0xda8864,{'recursive':!![]});}[a68_0x378ccd(0x1fd)](){const _0x1939dd=a68_0x378ccd,_0x3b4818=this['config']['shopId']+':'+this[_0x1939dd(0x218)][_0x1939dd(0x1ef)];return Buffer[_0x1939dd(0x217)](_0x3b4818)[_0x1939dd(0x202)]('base64');}[a68_0x378ccd(0x1f6)](){const _0x88095e=a68_0x378ccd;return crypto_1[_0x88095e(0x1eb)][_0x88095e(0x219)]();}async['processCardPayment'](_0x296568,_0x27e7bb,_0x346a48,_0x3df5d2,_0x2c9fe8,_0x5c54b0,_0x452ac3,_0x1a0e22,_0x26fa8d){const _0x2141d5=a68_0x378ccd;console['log'](_0x2141d5(0x1e7)),console[_0x2141d5(0x201)]('ðŸ’°\x20Amount:\x20'+_0x296568+'\x20'+_0x27e7bb),console[_0x2141d5(0x201)](_0x2141d5(0x1cc)+_0x346a48),console[_0x2141d5(0x201)](_0x2141d5(0x1ee)+_0x452ac3[_0x2141d5(0x1dd)]+'\x20('+_0x452ac3['ip']+')');const _0x446bc5={'request':{'amount':_0x296568,'currency':_0x27e7bb,'description':_0x346a48,'gate_id':parseInt(this[_0x2141d5(0x218)]['shopId']),'return_url':_0x3df5d2,'notification_url':_0x2c9fe8,'credit_card':_0x5c54b0,'customer':{'email':_0x452ac3[_0x2141d5(0x1dd)],'phone':_0x26fa8d,'birth_date':_0x452ac3[_0x2141d5(0x1d4)],'billing':_0x1a0e22},'test':this[_0x2141d5(0x218)][_0x2141d5(0x1d8)]}},_0x4e9ef7=this[_0x2141d5(0x1f6)](),_0x2e10f0={'Authorization':_0x2141d5(0x1e0)+this['getBasicAuth'](),'Content-Type':'application/json','Accept':_0x2141d5(0x1e1),'X-API-Version':'3','RequestID':_0x4e9ef7};try{console[_0x2141d5(0x201)](_0x2141d5(0x20d)),console[_0x2141d5(0x201)]('ðŸ“‹\x20Request\x20ID:\x20'+_0x4e9ef7),console['log'](_0x2141d5(0x20f)+this[_0x2141d5(0x218)][_0x2141d5(0x1f1)]+_0x2141d5(0x1d3)),console[_0x2141d5(0x201)](_0x2141d5(0x21f),JSON[_0x2141d5(0x1dc)](_0x2e10f0,null,0x2)),console[_0x2141d5(0x201)](_0x2141d5(0x1e6),JSON[_0x2141d5(0x1dc)](_0x446bc5,null,0x2));const _0x17a19b=await(0x0,node_fetch_1[_0x2141d5(0x1eb)])(this[_0x2141d5(0x218)]['baseUrl']+_0x2141d5(0x1d3),{'method':_0x2141d5(0x1fa),'headers':_0x2e10f0,'body':JSON[_0x2141d5(0x1dc)](_0x446bc5)}),_0x5ac3de=await _0x17a19b[_0x2141d5(0x1f0)]();console[_0x2141d5(0x201)](_0x2141d5(0x1fc)+_0x17a19b['status']),console[_0x2141d5(0x201)](_0x2141d5(0x1cf)+_0x5ac3de);if(!_0x17a19b['ok'])throw new Error(_0x2141d5(0x1f9)+_0x17a19b[_0x2141d5(0x21c)]+'\x20'+_0x17a19b[_0x2141d5(0x213)]+_0x2141d5(0x222)+_0x5ac3de);const _0x1f8c7d=JSON['parse'](_0x5ac3de);return console[_0x2141d5(0x201)](_0x2141d5(0x1ec)),console[_0x2141d5(0x201)](_0x2141d5(0x210)+_0x1f8c7d[_0x2141d5(0x1e5)]),console[_0x2141d5(0x201)]('\x20\x20\x20Status:\x20'+_0x1f8c7d[_0x2141d5(0x21c)]),console['log'](_0x2141d5(0x20b)+_0x1f8c7d[_0x2141d5(0x1fb)]),console[_0x2141d5(0x201)](_0x2141d5(0x212)+_0x1f8c7d[_0x2141d5(0x203)]),console[_0x2141d5(0x201)](_0x2141d5(0x1e4)+_0x1f8c7d[_0x2141d5(0x1da)][_0x2141d5(0x211)]),console[_0x2141d5(0x201)](_0x2141d5(0x1e9)+_0x1f8c7d[_0x2141d5(0x200)]['last_4']),_0x1f8c7d[_0x2141d5(0x1db)]&&console[_0x2141d5(0x201)](_0x2141d5(0x214)+_0x1f8c7d['redirect_url']),_0x1f8c7d;}catch(_0x53982f){console[_0x2141d5(0x20e)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x53982f);throw _0x53982f;}}['getPaymentStatus'](_0x5129fa){const _0x5b51ef=a68_0x378ccd,_0x5f3458=_0x5129fa[_0x5b51ef(0x1e5)],_0x24c12e=_0x5129fa['payment_method'][_0x5b51ef(0x21a)];console['log']('ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x5129fa['status']);switch(_0x5129fa[_0x5b51ef(0x21c)]){case _0x5b51ef(0x220):return{'status':_0x5b51ef(0x1f3),'gatewayPaymentId':_0x5f3458,'cardLast4':_0x24c12e};case _0x5b51ef(0x1e8):return{'status':_0x5b51ef(0x1df),'gatewayPaymentId':_0x5f3458,'cardLast4':_0x24c12e,'redirectUrl':_0x5129fa[_0x5b51ef(0x1db)]};case _0x5b51ef(0x21e):const _0x33bbfd=_0x5129fa[_0x5b51ef(0x203)]||'',_0x46b76c=_0x5129fa[_0x5b51ef(0x1e2)]||'';let _0x1df146='';if(_0x33bbfd&&_0x46b76c)_0x1df146=_0x33bbfd+_0x5b51ef(0x1f5)+_0x46b76c;else{if(_0x33bbfd)_0x1df146=_0x33bbfd;else _0x46b76c?_0x1df146=_0x46b76c:_0x1df146='Payment\x20failed';}return{'status':_0x5b51ef(0x1de),'failureMessage':_0x1df146,'gatewayPaymentId':_0x5f3458,'cardLast4':_0x24c12e};default:console[_0x5b51ef(0x1d5)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x5129fa[_0x5b51ef(0x21c)]);const _0x1c6592=_0x5129fa[_0x5b51ef(0x203)]||'',_0x47ae7e=_0x5129fa[_0x5b51ef(0x1e2)]||'';let _0x3ec191='';if(_0x1c6592&&_0x47ae7e)_0x3ec191=_0x1c6592+_0x5b51ef(0x1f5)+_0x47ae7e;else{if(_0x1c6592)_0x3ec191=_0x1c6592;else _0x47ae7e?_0x3ec191=_0x47ae7e:_0x3ec191='Unknown\x20error';}return{'status':_0x5b51ef(0x1de),'failureMessage':_0x3ec191,'gatewayPaymentId':_0x5f3458,'cardLast4':_0x24c12e};}}[a68_0x378ccd(0x1ff)](_0x217d2a){const _0x1ccfdf=a68_0x378ccd,_0x40539c=new Date()[_0x1ccfdf(0x209)](),_0x513f9a={'timestamp':_0x40539c,'webhook':_0x217d2a,'source':_0x1ccfdf(0x204)},_0x238afc=JSON[_0x1ccfdf(0x1dc)](_0x513f9a)+'\x0a';try{fs_1[_0x1ccfdf(0x1eb)][_0x1ccfdf(0x21d)](this[_0x1ccfdf(0x21b)],_0x238afc),console[_0x1ccfdf(0x201)](_0x1ccfdf(0x1d2)+_0x40539c);}catch(_0x1bc853){console[_0x1ccfdf(0x20e)](_0x1ccfdf(0x205),_0x1bc853);}}[a68_0x378ccd(0x1ed)](_0x567611=0x32){const _0x136d91=a68_0x378ccd;try{if(!fs_1[_0x136d91(0x1eb)][_0x136d91(0x215)](this[_0x136d91(0x21b)]))return[];const _0x2e13bc=fs_1[_0x136d91(0x1eb)]['readFileSync'](this[_0x136d91(0x21b)],_0x136d91(0x221)),_0xe63360=_0x2e13bc[_0x136d91(0x207)]()['split']('\x0a')['filter'](_0x1c52e4=>_0x1c52e4);return _0xe63360['slice'](-_0x567611)[_0x136d91(0x1f4)](_0x2f81c8=>{const _0x150e96=_0x136d91;try{return JSON[_0x150e96(0x216)](_0x2f81c8);}catch{return null;}})['filter'](_0x48c51c=>_0x48c51c!==null);}catch(_0x33cedc){return console['error'](_0x136d91(0x20c),_0x33cedc),[];}}}exports[a68_0x378ccd(0x206)]=SquirrelPayService;