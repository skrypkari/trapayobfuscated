'use strict';function a72_0x2352(_0x35472e,_0x370294){_0x35472e=_0x35472e-0x188;const _0x1ba924=a72_0x1ba9();let _0x235285=_0x1ba924[_0x35472e];return _0x235285;}const a72_0x24153e=a72_0x2352;(function(_0x3b37c8,_0x3aab13){const _0x4895d1=a72_0x2352,_0x170cf6=_0x3b37c8();while(!![]){try{const _0x53adbf=-parseInt(_0x4895d1(0x1c6))/0x1*(parseInt(_0x4895d1(0x1cc))/0x2)+parseInt(_0x4895d1(0x1bc))/0x3*(parseInt(_0x4895d1(0x19f))/0x4)+-parseInt(_0x4895d1(0x188))/0x5*(-parseInt(_0x4895d1(0x18b))/0x6)+parseInt(_0x4895d1(0x1d6))/0x7*(parseInt(_0x4895d1(0x1dc))/0x8)+-parseInt(_0x4895d1(0x1a5))/0x9+parseInt(_0x4895d1(0x1ba))/0xa+-parseInt(_0x4895d1(0x1d1))/0xb;if(_0x53adbf===_0x3aab13)break;else _0x170cf6['push'](_0x170cf6['shift']());}catch(_0x43ada0){_0x170cf6['push'](_0x170cf6['shift']());}}}(a72_0x1ba9,0x44d86));var __importDefault=this&&this['__importDefault']||function(_0x1805e8){const _0x50f371=a72_0x2352;return _0x1805e8&&_0x1805e8[_0x50f371(0x1dd)]?_0x1805e8:{'default':_0x1805e8};};Object[a72_0x24153e(0x1ad)](exports,'__esModule',{'value':!![]}),exports[a72_0x24153e(0x1b7)]=void 0x0;const crypto_1=__importDefault(require(a72_0x24153e(0x18d))),node_fetch_1=__importDefault(require(a72_0x24153e(0x18c))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a72_0x24153e(0x1ca)));function a72_0x1ba9(){const _0x361e56=['‚ùå\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','974200VgnsyA','warn','2121PrqAoj','text','üêøÔ∏è\x20SquirrelPay:\x20Processing\x20card\x20payment','squirrel-pay','payment_method','üë§\x20Customer:\x20','\x20\x20\x20Status:\x20','shopId','üìù\x20Description:\x20','existsSync','1102hzrIRb','\x20\x20\x20Message:\x20','Unknown\x20error','mkdirSync','path','üîß\x20Headers:','948TDqemE','dirname','utf-8','üìù\x20SquirrelPay\x20webhook\x20logged:\x20','stringify','421377uWCkia','friendly_message','webhookLogPath','secretKey','split','7yhEaTs','default','transaction','PAID','uid','Basic\x20','2799632SQlmul','__esModule','status','error','processCardPayment','üåê\x20Making\x20request\x20to\x20SquirrelPay\x20API...','265biOxBw','\x20||\x20','logWebhook','48810qnRDGJ','node-fetch','crypto','üì¶\x20Body:','trim','getWebhookLogs','üìÑ\x20SquirrelPay\x20Response\x20Body:\x20','PENDING','from','code','email','POST','appendFileSync','log','last_4','squirrel-pay-webhooks.log','Payment\x20failed','logs','üîó\x20URL:\x20','redirect_url','1256EAIDDG','generateRequestId','readFileSync','base64','application/json','\x20\x20\x20Gateway\x20ID:\x20','2320938rttCJa','baseUrl','üì•\x20SquirrelPay\x20Response\x20Status:\x20','SquirrelPay\x20API\x20error:\x20','üí∞\x20Amount:\x20','statusText','failed','message','defineProperty','randomUUID','map','/transactions/payments','FAILED','filter','gateway_id','config','\x20\x20\x20UID:\x20','isTestMode','SquirrelPayService','parse'];a72_0x1ba9=function(){return _0x361e56;};return a72_0x1ba9();}class SquirrelPayService{constructor(_0x10fd34){const _0x6d561=a72_0x24153e;this[_0x6d561(0x1b4)]=_0x10fd34,this[_0x6d561(0x1d3)]=path_1['default']['join'](process['cwd'](),_0x6d561(0x19c),_0x6d561(0x19a));const _0x392624=path_1[_0x6d561(0x1d7)][_0x6d561(0x1cd)](this[_0x6d561(0x1d3)]);!fs_1[_0x6d561(0x1d7)][_0x6d561(0x1c5)](_0x392624)&&fs_1['default'][_0x6d561(0x1c9)](_0x392624,{'recursive':!![]});}['getBasicAuth'](){const _0x20fa42=a72_0x24153e,_0x373737=this['config'][_0x20fa42(0x1c3)]+':'+this['config'][_0x20fa42(0x1d4)];return Buffer[_0x20fa42(0x193)](_0x373737)['toString'](_0x20fa42(0x1a2));}[a72_0x24153e(0x1a0)](){const _0xac629e=a72_0x24153e;return crypto_1[_0xac629e(0x1d7)][_0xac629e(0x1ae)]();}async[a72_0x24153e(0x1e0)](_0xb921fc,_0x4a357f,_0x3a2b8c,_0x2df96a,_0xc4ea7e,_0x2f5b43,_0x5e9ee4,_0x3fb849,_0x33629a){const _0x22c36b=a72_0x24153e;console[_0x22c36b(0x198)](_0x22c36b(0x1be)),console[_0x22c36b(0x198)](_0x22c36b(0x1a9)+_0xb921fc+'\x20'+_0x4a357f),console['log'](_0x22c36b(0x1c4)+_0x3a2b8c),console[_0x22c36b(0x198)](_0x22c36b(0x1c1)+_0x5e9ee4[_0x22c36b(0x195)]+'\x20('+_0x5e9ee4['ip']+')');const _0x27dfb2={'request':{'amount':_0xb921fc,'currency':_0x4a357f,'description':_0x3a2b8c,'gate_id':parseInt(this[_0x22c36b(0x1b4)][_0x22c36b(0x1c3)]),'return_url':_0x2df96a,'notification_url':_0xc4ea7e,'credit_card':_0x2f5b43,'customer':{'email':_0x5e9ee4['email'],'phone':_0x33629a,'birth_date':_0x5e9ee4['birth_date'],'billing':_0x3fb849},'test':this[_0x22c36b(0x1b4)][_0x22c36b(0x1b6)]}},_0xa0d9d0=this['generateRequestId'](),_0x26e0fe={'Authorization':_0x22c36b(0x1db)+this['getBasicAuth'](),'Content-Type':'application/json','Accept':_0x22c36b(0x1a3),'X-API-Version':'3','RequestID':_0xa0d9d0};try{console[_0x22c36b(0x198)](_0x22c36b(0x1e1)),console[_0x22c36b(0x198)]('üìã\x20Request\x20ID:\x20'+_0xa0d9d0),console['log'](_0x22c36b(0x19d)+this['config'][_0x22c36b(0x1a6)]+_0x22c36b(0x1b0)),console['log'](_0x22c36b(0x1cb),JSON[_0x22c36b(0x1d0)](_0x26e0fe,null,0x2)),console[_0x22c36b(0x198)](_0x22c36b(0x18e),JSON[_0x22c36b(0x1d0)](_0x27dfb2,null,0x2));const _0x59daeb=await(0x0,node_fetch_1[_0x22c36b(0x1d7)])(this[_0x22c36b(0x1b4)][_0x22c36b(0x1a6)]+_0x22c36b(0x1b0),{'method':_0x22c36b(0x196),'headers':_0x26e0fe,'body':JSON[_0x22c36b(0x1d0)](_0x27dfb2)}),_0x441a44=await _0x59daeb[_0x22c36b(0x1bd)]();console[_0x22c36b(0x198)](_0x22c36b(0x1a7)+_0x59daeb['status']),console[_0x22c36b(0x198)](_0x22c36b(0x191)+_0x441a44);if(!_0x59daeb['ok'])throw new Error(_0x22c36b(0x1a8)+_0x59daeb[_0x22c36b(0x1de)]+'\x20'+_0x59daeb[_0x22c36b(0x1aa)]+'\x20-\x20'+_0x441a44);const _0x99850b=JSON[_0x22c36b(0x1b8)](_0x441a44);return console[_0x22c36b(0x198)]('‚úÖ\x20SquirrelPay\x20Response\x20Success:'),console[_0x22c36b(0x198)](_0x22c36b(0x1b5)+_0x99850b['uid']),console['log'](_0x22c36b(0x1c2)+_0x99850b['status']),console[_0x22c36b(0x198)]('\x20\x20\x20Code:\x20'+_0x99850b[_0x22c36b(0x194)]),console['log'](_0x22c36b(0x1c7)+_0x99850b[_0x22c36b(0x1d2)]),console['log'](_0x22c36b(0x1a4)+_0x99850b[_0x22c36b(0x1d8)][_0x22c36b(0x1b3)]),console[_0x22c36b(0x198)]('\x20\x20\x20Last\x204:\x20'+_0x99850b[_0x22c36b(0x1c0)][_0x22c36b(0x199)]),_0x99850b[_0x22c36b(0x19e)]&&console[_0x22c36b(0x198)]('üîÑ\x20Redirect\x20URL:\x20'+_0x99850b['redirect_url']),_0x99850b;}catch(_0x411407){console[_0x22c36b(0x1df)]('‚ùå\x20SquirrelPay\x20API\x20Error:',_0x411407);throw _0x411407;}}['getPaymentStatus'](_0x39a22d){const _0x57724a=a72_0x24153e,_0x446a5d=_0x39a22d[_0x57724a(0x1da)],_0x148b2e=_0x39a22d['payment_method'][_0x57724a(0x199)];console[_0x57724a(0x198)]('üîç\x20Processing\x20SquirrelPay\x20status:\x20'+_0x39a22d[_0x57724a(0x1de)]);switch(_0x39a22d[_0x57724a(0x1de)]){case'successful':return{'status':_0x57724a(0x1d9),'gatewayPaymentId':_0x446a5d,'cardLast4':_0x148b2e};case'incomplete':return{'status':_0x57724a(0x192),'gatewayPaymentId':_0x446a5d,'cardLast4':_0x148b2e,'redirectUrl':_0x39a22d['redirect_url']};case _0x57724a(0x1ab):const _0x35e400=_0x39a22d[_0x57724a(0x1d2)]||'',_0xd90ecb=_0x39a22d[_0x57724a(0x1ac)]||'';let _0x9f6319='';if(_0x35e400&&_0xd90ecb)_0x9f6319=_0x35e400+_0x57724a(0x189)+_0xd90ecb;else{if(_0x35e400)_0x9f6319=_0x35e400;else _0xd90ecb?_0x9f6319=_0xd90ecb:_0x9f6319=_0x57724a(0x19b);}return{'status':_0x57724a(0x1b1),'failureMessage':_0x9f6319,'gatewayPaymentId':_0x446a5d,'cardLast4':_0x148b2e};default:console[_0x57724a(0x1bb)]('‚ö†Ô∏è\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x39a22d[_0x57724a(0x1de)]);const _0x2e8f70=_0x39a22d[_0x57724a(0x1d2)]||'',_0x57053e=_0x39a22d[_0x57724a(0x1ac)]||'';let _0x330152='';if(_0x2e8f70&&_0x57053e)_0x330152=_0x2e8f70+_0x57724a(0x189)+_0x57053e;else{if(_0x2e8f70)_0x330152=_0x2e8f70;else _0x57053e?_0x330152=_0x57053e:_0x330152=_0x57724a(0x1c8);}return{'status':_0x57724a(0x1b1),'failureMessage':_0x330152,'gatewayPaymentId':_0x446a5d,'cardLast4':_0x148b2e};}}[a72_0x24153e(0x18a)](_0x5985b2){const _0x155963=a72_0x24153e,_0x5bbaf9=new Date()['toISOString'](),_0x12b698={'timestamp':_0x5bbaf9,'webhook':_0x5985b2,'source':_0x155963(0x1bf)},_0x37cdb4=JSON[_0x155963(0x1d0)](_0x12b698)+'\x0a';try{fs_1[_0x155963(0x1d7)][_0x155963(0x197)](this[_0x155963(0x1d3)],_0x37cdb4),console[_0x155963(0x198)](_0x155963(0x1cf)+_0x5bbaf9);}catch(_0x32bb49){console[_0x155963(0x1df)](_0x155963(0x1b9),_0x32bb49);}}[a72_0x24153e(0x190)](_0x5ce5eb=0x32){const _0x34bb6a=a72_0x24153e;try{if(!fs_1[_0x34bb6a(0x1d7)][_0x34bb6a(0x1c5)](this[_0x34bb6a(0x1d3)]))return[];const _0x1a698e=fs_1[_0x34bb6a(0x1d7)][_0x34bb6a(0x1a1)](this[_0x34bb6a(0x1d3)],_0x34bb6a(0x1ce)),_0x5e4ae0=_0x1a698e[_0x34bb6a(0x18f)]()[_0x34bb6a(0x1d5)]('\x0a')['filter'](_0x175087=>_0x175087);return _0x5e4ae0['slice'](-_0x5ce5eb)[_0x34bb6a(0x1af)](_0x2ecbf1=>{const _0x364327=_0x34bb6a;try{return JSON[_0x364327(0x1b8)](_0x2ecbf1);}catch{return null;}})[_0x34bb6a(0x1b2)](_0x45b22c=>_0x45b22c!==null);}catch(_0x46d0c6){return console['error']('‚ùå\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x46d0c6),[];}}}exports[a72_0x24153e(0x1b7)]=SquirrelPayService;