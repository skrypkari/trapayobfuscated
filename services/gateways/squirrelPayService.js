'use strict';const a67_0x165e12=a67_0x2be4;(function(_0xd288af,_0x3870ed){const _0x58a369=a67_0x2be4,_0x4ae4d8=_0xd288af();while(!![]){try{const _0x4e49d7=-parseInt(_0x58a369(0x15c))/0x1+parseInt(_0x58a369(0x151))/0x2*(-parseInt(_0x58a369(0x13f))/0x3)+parseInt(_0x58a369(0x114))/0x4*(-parseInt(_0x58a369(0x149))/0x5)+parseInt(_0x58a369(0x126))/0x6*(parseInt(_0x58a369(0x131))/0x7)+-parseInt(_0x58a369(0x11f))/0x8+-parseInt(_0x58a369(0x12c))/0x9+parseInt(_0x58a369(0x13d))/0xa;if(_0x4e49d7===_0x3870ed)break;else _0x4ae4d8['push'](_0x4ae4d8['shift']());}catch(_0x13b0a1){_0x4ae4d8['push'](_0x4ae4d8['shift']());}}}(a67_0x38f7,0x4eebe));function a67_0x2be4(_0x4feecb,_0x51168b){_0x4feecb=_0x4feecb-0x111;const _0x38f7ec=a67_0x38f7();let _0x2be49c=_0x38f7ec[_0x4feecb];return _0x2be49c;}var __importDefault=this&&this[a67_0x165e12(0x122)]||function(_0x2f280f){const _0x251a95=a67_0x165e12;return _0x2f280f&&_0x2f280f[_0x251a95(0x154)]?_0x2f280f:{'default':_0x2f280f};};Object[a67_0x165e12(0x125)](exports,'__esModule',{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a67_0x165e12(0x128))),node_fetch_1=__importDefault(require(a67_0x165e12(0x13b))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a67_0x165e12(0x127)));class SquirrelPayService{constructor(_0x2bc060){const _0x4a21ee=a67_0x165e12;this['config']=_0x2bc060,this['webhookLogPath']=path_1[_0x4a21ee(0x11e)][_0x4a21ee(0x115)](process[_0x4a21ee(0x12a)](),_0x4a21ee(0x166),_0x4a21ee(0x14a));const _0x56f0c2=path_1[_0x4a21ee(0x11e)][_0x4a21ee(0x137)](this[_0x4a21ee(0x150)]);!fs_1[_0x4a21ee(0x11e)]['existsSync'](_0x56f0c2)&&fs_1[_0x4a21ee(0x11e)][_0x4a21ee(0x11c)](_0x56f0c2,{'recursive':!![]});}[a67_0x165e12(0x168)](){const _0x458aaf=a67_0x165e12,_0x473b53=this['config'][_0x458aaf(0x117)]+':'+this[_0x458aaf(0x147)][_0x458aaf(0x12f)];return Buffer['from'](_0x473b53)[_0x458aaf(0x145)](_0x458aaf(0x14e));}[a67_0x165e12(0x141)](){const _0x45e7f7=a67_0x165e12;return crypto_1[_0x45e7f7(0x11e)][_0x45e7f7(0x167)]();}async[a67_0x165e12(0x136)](_0x56c731,_0x84177d,_0x22a854,_0x12f2be,_0x447e6e,_0x43ba4b,_0x2b2519,_0xf0c22e,_0x11a523){const _0x28ea94=a67_0x165e12;console[_0x28ea94(0x143)]('ğŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console['log']('ğŸ’°\x20Amount:\x20'+_0x56c731+'\x20'+_0x84177d),console[_0x28ea94(0x143)](_0x28ea94(0x163)+_0x22a854),console[_0x28ea94(0x143)](_0x28ea94(0x120)+_0x2b2519[_0x28ea94(0x152)]+'\x20('+_0x2b2519['ip']+')');const _0x5b22d6={'request':{'amount':_0x56c731,'currency':_0x84177d,'description':_0x22a854,'gate_id':parseInt(this[_0x28ea94(0x147)][_0x28ea94(0x117)]),'return_url':_0x12f2be,'notification_url':_0x447e6e,'credit_card':_0x43ba4b,'customer':{'email':_0x2b2519['email'],'phone':_0x11a523,'birth_date':_0x2b2519[_0x28ea94(0x153)],'billing':_0xf0c22e},'test':this[_0x28ea94(0x147)][_0x28ea94(0x161)]}},_0x240bf8=this['generateRequestId'](),_0xb4d9be={'Authorization':_0x28ea94(0x14b)+this[_0x28ea94(0x168)](),'Content-Type':'application/json','Accept':_0x28ea94(0x134),'X-API-Version':'3','RequestID':_0x240bf8};try{console[_0x28ea94(0x143)](_0x28ea94(0x121)),console['log'](_0x28ea94(0x15d)+_0x240bf8),console[_0x28ea94(0x143)]('ğŸ”—\x20URL:\x20'+this[_0x28ea94(0x147)][_0x28ea94(0x13e)]+_0x28ea94(0x155)),console[_0x28ea94(0x143)]('ğŸ”§\x20Headers:',JSON[_0x28ea94(0x140)](_0xb4d9be,null,0x2)),console[_0x28ea94(0x143)](_0x28ea94(0x123),JSON[_0x28ea94(0x140)](_0x5b22d6,null,0x2));const _0xeb015c=await(0x0,node_fetch_1['default'])(this['config'][_0x28ea94(0x13e)]+_0x28ea94(0x155),{'method':_0x28ea94(0x158),'headers':_0xb4d9be,'body':JSON[_0x28ea94(0x140)](_0x5b22d6)}),_0x5f0471=await _0xeb015c[_0x28ea94(0x157)]();console['log'](_0x28ea94(0x116)+_0xeb015c[_0x28ea94(0x11d)]),console[_0x28ea94(0x143)](_0x28ea94(0x15e)+_0x5f0471);if(!_0xeb015c['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0xeb015c[_0x28ea94(0x11d)]+'\x20'+_0xeb015c[_0x28ea94(0x148)]+_0x28ea94(0x138)+_0x5f0471);const _0x57a084=JSON[_0x28ea94(0x113)](_0x5f0471);return console['log']('âœ…\x20SquirrelPay\x20Response\x20Success:'),console['log'](_0x28ea94(0x165)+_0x57a084['uid']),console['log']('\x20\x20\x20Status:\x20'+_0x57a084[_0x28ea94(0x11d)]),console['log'](_0x28ea94(0x160)+_0x57a084[_0x28ea94(0x111)]),console[_0x28ea94(0x143)]('\x20\x20\x20Message:\x20'+_0x57a084['friendly_message']),console[_0x28ea94(0x143)](_0x28ea94(0x12d)+_0x57a084[_0x28ea94(0x11a)][_0x28ea94(0x118)]),console[_0x28ea94(0x143)](_0x28ea94(0x139)+_0x57a084[_0x28ea94(0x129)][_0x28ea94(0x142)]),_0x57a084[_0x28ea94(0x133)]&&console[_0x28ea94(0x143)]('ğŸ”„\x20Redirect\x20URL:\x20'+_0x57a084[_0x28ea94(0x133)]),_0x57a084;}catch(_0x11fa83){console[_0x28ea94(0x162)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x11fa83);throw _0x11fa83;}}[a67_0x165e12(0x119)](_0xd49ba1){const _0x37d193=a67_0x165e12,_0x3e3516=_0xd49ba1[_0x37d193(0x132)],_0x28eb41=_0xd49ba1[_0x37d193(0x129)][_0x37d193(0x142)];console['log']('ğŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0xd49ba1['status']);switch(_0xd49ba1[_0x37d193(0x11d)]){case _0x37d193(0x12b):return{'status':_0x37d193(0x164),'gatewayPaymentId':_0x3e3516,'cardLast4':_0x28eb41};case _0x37d193(0x112):return{'status':_0x37d193(0x124),'gatewayPaymentId':_0x3e3516,'cardLast4':_0x28eb41,'redirectUrl':_0xd49ba1['redirect_url']};case'failed':const _0x150cbc=_0xd49ba1[_0x37d193(0x169)]||'',_0x2eabe1=_0xd49ba1['message']||'';let _0xa1876c='';if(_0x150cbc&&_0x2eabe1)_0xa1876c=_0x150cbc+_0x37d193(0x14d)+_0x2eabe1;else{if(_0x150cbc)_0xa1876c=_0x150cbc;else _0x2eabe1?_0xa1876c=_0x2eabe1:_0xa1876c=_0x37d193(0x12e);}return{'status':_0x37d193(0x14c),'failureMessage':_0xa1876c,'gatewayPaymentId':_0x3e3516,'cardLast4':_0x28eb41};default:console['warn']('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0xd49ba1[_0x37d193(0x11d)]);const _0x54a87c=_0xd49ba1['friendly_message']||'',_0x256dff=_0xd49ba1[_0x37d193(0x15a)]||'';let _0x57a2b2='';if(_0x54a87c&&_0x256dff)_0x57a2b2=_0x54a87c+_0x37d193(0x14d)+_0x256dff;else{if(_0x54a87c)_0x57a2b2=_0x54a87c;else _0x256dff?_0x57a2b2=_0x256dff:_0x57a2b2='Unknown\x20error';}return{'status':_0x37d193(0x14c),'failureMessage':_0x57a2b2,'gatewayPaymentId':_0x3e3516,'cardLast4':_0x28eb41};}}[a67_0x165e12(0x144)](_0x2d1556){const _0x478974=a67_0x165e12,_0x2decd3=new Date()[_0x478974(0x159)](),_0x308f71={'timestamp':_0x2decd3,'webhook':_0x2d1556,'source':'squirrel-pay'},_0x124513=JSON[_0x478974(0x140)](_0x308f71)+'\x0a';try{fs_1['default']['appendFileSync'](this[_0x478974(0x150)],_0x124513),console['log']('ğŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x2decd3);}catch(_0x567e32){console[_0x478974(0x162)](_0x478974(0x146),_0x567e32);}}[a67_0x165e12(0x135)](_0x17bc8b=0x32){const _0x2fc2e5=a67_0x165e12;try{if(!fs_1[_0x2fc2e5(0x11e)][_0x2fc2e5(0x15b)](this['webhookLogPath']))return[];const _0x4b4534=fs_1[_0x2fc2e5(0x11e)][_0x2fc2e5(0x13c)](this[_0x2fc2e5(0x150)],_0x2fc2e5(0x156)),_0x4a86bb=_0x4b4534['trim']()[_0x2fc2e5(0x15f)]('\x0a')[_0x2fc2e5(0x130)](_0x220ea0=>_0x220ea0);return _0x4a86bb[_0x2fc2e5(0x11b)](-_0x17bc8b)['map'](_0x23d408=>{try{return JSON['parse'](_0x23d408);}catch{return null;}})[_0x2fc2e5(0x130)](_0x2821f8=>_0x2821f8!==null);}catch(_0x57ec9b){return console[_0x2fc2e5(0x162)](_0x2fc2e5(0x14f),_0x57ec9b),[];}}}exports[a67_0x165e12(0x13a)]=SquirrelPayService;function a67_0x38f7(){const _0x591030=['join','ğŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','shopId','gateway_id','getPaymentStatus','transaction','slice','mkdirSync','status','default','1491040CnktdN','ğŸ‘¤\x20Customer:\x20','ğŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','__importDefault','ğŸ“¦\x20Body:','PENDING','defineProperty','43326yKWmvg','path','crypto','payment_method','cwd','successful','3112929UHoHht','\x20\x20\x20Gateway\x20ID:\x20','Payment\x20failed','secretKey','filter','525LdbwMx','uid','redirect_url','application/json','getWebhookLogs','processCardPayment','dirname','\x20-\x20','\x20\x20\x20Last\x204:\x20','SquirrelPayService','node-fetch','readFileSync','14748160aNVYiF','baseUrl','98121MCjEOc','stringify','generateRequestId','last_4','log','logWebhook','toString','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','config','statusText','1113640mZihWe','squirrel-pay-webhooks.log','Basic\x20','FAILED','\x20||\x20','base64','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','webhookLogPath','34SSgOis','email','birth_date','__esModule','/transactions/payments','utf-8','text','POST','toISOString','message','existsSync','382121vraTIL','ğŸ“‹\x20Request\x20ID:\x20','ğŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','split','\x20\x20\x20Code:\x20','isTestMode','error','ğŸ“\x20Description:\x20','PAID','\x20\x20\x20UID:\x20','logs','randomUUID','getBasicAuth','friendly_message','code','incomplete','parse','4MhwGJx'];a67_0x38f7=function(){return _0x591030;};return a67_0x38f7();}