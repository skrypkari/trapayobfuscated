'use strict';const a68_0x30eccb=a68_0xb6c2;(function(_0xab4070,_0x42e6a7){const _0x5d59fa=a68_0xb6c2,_0x36c86a=_0xab4070();while(!![]){try{const _0x1b8614=parseInt(_0x5d59fa(0x9d))/0x1+-parseInt(_0x5d59fa(0x8e))/0x2*(-parseInt(_0x5d59fa(0xa2))/0x3)+parseInt(_0x5d59fa(0xa9))/0x4+parseInt(_0x5d59fa(0xa7))/0x5+parseInt(_0x5d59fa(0xba))/0x6+parseInt(_0x5d59fa(0xd9))/0x7+-parseInt(_0x5d59fa(0xbe))/0x8*(parseInt(_0x5d59fa(0xbb))/0x9);if(_0x1b8614===_0x42e6a7)break;else _0x36c86a['push'](_0x36c86a['shift']());}catch(_0x22f746){_0x36c86a['push'](_0x36c86a['shift']());}}}(a68_0x3d3f,0xc0476));function a68_0x3d3f(){const _0xf3138c=['üìÑ\x20SquirrelPay\x20Response\x20Body:\x20','PAID','üîó\x20URL:\x20','webhookLogPath','__importDefault','error','utf-8','last_4','default','toISOString','\x20\x20\x20Last\x204:\x20','‚ùå\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','üìù\x20SquirrelPay\x20webhook\x20logged:\x20','secretKey','join','parse','successful','SquirrelPayService','email','/transactions/payments','üí∞\x20Amount:\x20','getPaymentStatus','getBasicAuth','2179611RjDffn','üîç\x20Processing\x20SquirrelPay\x20status:\x20','\x20\x20\x20Message:\x20','transaction','SquirrelPay\x20API\x20error:\x20','squirrel-pay-webhooks.log','\x20\x20\x20Status:\x20','payment_method','logs','baseUrl','defineProperty','application/json','friendly_message','\x20||\x20','‚ùå\x20SquirrelPay\x20API\x20Error:','35596mmbjmc','\x20-\x20','üì•\x20SquirrelPay\x20Response\x20Status:\x20','gateway_id','map','trim','readFileSync','POST','from','generateRequestId','\x20\x20\x20UID:\x20','FAILED','slice','\x20\x20\x20Code:\x20','incomplete','820299OVsuJt','üêøÔ∏è\x20SquirrelPay:\x20Processing\x20card\x20payment','mkdirSync','uid','log','51MroPLj','config','toString','__esModule','base64','4207145jcRxvN','redirect_url','4419056heHcWG','code','processCardPayment','üîß\x20Headers:','existsSync','path','statusText','squirrel-pay','stringify','üìù\x20Description:\x20','status','dirname','logWebhook','shopId','getWebhookLogs','node-fetch','Basic\x20','3009678PRHiod','29565gAndjw','text','üåê\x20Making\x20request\x20to\x20SquirrelPay\x20API...','7536TvgxGN','üîÑ\x20Redirect\x20URL:\x20','üìã\x20Request\x20ID:\x20','filter'];a68_0x3d3f=function(){return _0xf3138c;};return a68_0x3d3f();}var __importDefault=this&&this[a68_0x30eccb(0xc6)]||function(_0x818b2d){const _0x3035b3=a68_0x30eccb;return _0x818b2d&&_0x818b2d[_0x3035b3(0xa5)]?_0x818b2d:{'default':_0x818b2d};};Object[a68_0x30eccb(0x89)](exports,a68_0x30eccb(0xa5),{'value':!![]}),exports[a68_0x30eccb(0xd3)]=void 0x0;const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require(a68_0x30eccb(0xb8))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x30eccb(0xae)));function a68_0xb6c2(_0x53f57e,_0x39a529){_0x53f57e=_0x53f57e-0x81;const _0x3d3fcc=a68_0x3d3f();let _0xb6c27e=_0x3d3fcc[_0x53f57e];return _0xb6c27e;}class SquirrelPayService{constructor(_0x2fb3b2){const _0x47ece6=a68_0x30eccb;this[_0x47ece6(0xa3)]=_0x2fb3b2,this[_0x47ece6(0xc5)]=path_1[_0x47ece6(0xca)][_0x47ece6(0xd0)](process['cwd'](),_0x47ece6(0x87),_0x47ece6(0x84));const _0x3fd9d9=path_1['default'][_0x47ece6(0xb4)](this['webhookLogPath']);!fs_1[_0x47ece6(0xca)][_0x47ece6(0xad)](_0x3fd9d9)&&fs_1[_0x47ece6(0xca)][_0x47ece6(0x9f)](_0x3fd9d9,{'recursive':!![]});}[a68_0x30eccb(0xd8)](){const _0xc7bda1=a68_0x30eccb,_0x294f73=this[_0xc7bda1(0xa3)][_0xc7bda1(0xb6)]+':'+this[_0xc7bda1(0xa3)][_0xc7bda1(0xcf)];return Buffer[_0xc7bda1(0x96)](_0x294f73)[_0xc7bda1(0xa4)](_0xc7bda1(0xa6));}['generateRequestId'](){const _0x319bb9=a68_0x30eccb;return crypto_1[_0x319bb9(0xca)]['randomUUID']();}async[a68_0x30eccb(0xab)](_0x423037,_0x21e4a,_0x1a0524,_0x460ac7,_0x3f835a,_0xf303a9,_0x37fb92,_0x5e6640,_0x1f8c36){const _0x27a26c=a68_0x30eccb;console[_0x27a26c(0xa1)](_0x27a26c(0x9e)),console[_0x27a26c(0xa1)](_0x27a26c(0xd6)+_0x423037+'\x20'+_0x21e4a),console[_0x27a26c(0xa1)](_0x27a26c(0xb2)+_0x1a0524),console[_0x27a26c(0xa1)]('üë§\x20Customer:\x20'+_0x37fb92[_0x27a26c(0xd4)]+'\x20('+_0x37fb92['ip']+')');const _0x4907bb={'request':{'amount':_0x423037,'currency':_0x21e4a,'description':_0x1a0524,'gate_id':parseInt(this[_0x27a26c(0xa3)][_0x27a26c(0xb6)]),'return_url':_0x460ac7,'notification_url':_0x3f835a,'credit_card':_0xf303a9,'customer':{'email':_0x37fb92[_0x27a26c(0xd4)],'phone':_0x1f8c36,'birth_date':_0x37fb92['birth_date'],'billing':_0x5e6640},'test':this[_0x27a26c(0xa3)]['isTestMode']}},_0x299c29=this[_0x27a26c(0x97)](),_0x184a63={'Authorization':_0x27a26c(0xb9)+this[_0x27a26c(0xd8)](),'Content-Type':_0x27a26c(0x8a),'Accept':'application/json','X-API-Version':'3','RequestID':_0x299c29};try{console[_0x27a26c(0xa1)](_0x27a26c(0xbd)),console[_0x27a26c(0xa1)](_0x27a26c(0xc0)+_0x299c29),console['log'](_0x27a26c(0xc4)+this[_0x27a26c(0xa3)][_0x27a26c(0x88)]+_0x27a26c(0xd5)),console[_0x27a26c(0xa1)](_0x27a26c(0xac),JSON[_0x27a26c(0xb1)](_0x184a63,null,0x2)),console[_0x27a26c(0xa1)]('üì¶\x20Body:',JSON[_0x27a26c(0xb1)](_0x4907bb,null,0x2));const _0x1b7d9b=await(0x0,node_fetch_1[_0x27a26c(0xca)])(this[_0x27a26c(0xa3)][_0x27a26c(0x88)]+_0x27a26c(0xd5),{'method':_0x27a26c(0x95),'headers':_0x184a63,'body':JSON[_0x27a26c(0xb1)](_0x4907bb)}),_0x3172be=await _0x1b7d9b[_0x27a26c(0xbc)]();console[_0x27a26c(0xa1)](_0x27a26c(0x90)+_0x1b7d9b['status']),console['log'](_0x27a26c(0xc2)+_0x3172be);if(!_0x1b7d9b['ok'])throw new Error(_0x27a26c(0x83)+_0x1b7d9b['status']+'\x20'+_0x1b7d9b[_0x27a26c(0xaf)]+_0x27a26c(0x8f)+_0x3172be);const _0x27cf93=JSON[_0x27a26c(0xd1)](_0x3172be);return console[_0x27a26c(0xa1)]('‚úÖ\x20SquirrelPay\x20Response\x20Success:'),console['log'](_0x27a26c(0x98)+_0x27cf93[_0x27a26c(0xa0)]),console[_0x27a26c(0xa1)](_0x27a26c(0x85)+_0x27cf93[_0x27a26c(0xb3)]),console[_0x27a26c(0xa1)](_0x27a26c(0x9b)+_0x27cf93[_0x27a26c(0xaa)]),console['log'](_0x27a26c(0x81)+_0x27cf93[_0x27a26c(0x8b)]),console[_0x27a26c(0xa1)]('\x20\x20\x20Gateway\x20ID:\x20'+_0x27cf93[_0x27a26c(0x82)][_0x27a26c(0x91)]),console[_0x27a26c(0xa1)](_0x27a26c(0xcc)+_0x27cf93[_0x27a26c(0x86)]['last_4']),_0x27cf93['redirect_url']&&console[_0x27a26c(0xa1)](_0x27a26c(0xbf)+_0x27cf93[_0x27a26c(0xa8)]),_0x27cf93;}catch(_0x3819a0){console[_0x27a26c(0xc7)](_0x27a26c(0x8d),_0x3819a0);throw _0x3819a0;}}[a68_0x30eccb(0xd7)](_0x575ff4){const _0x138072=a68_0x30eccb,_0x586718=_0x575ff4[_0x138072(0xa0)],_0xb73115=_0x575ff4[_0x138072(0x86)][_0x138072(0xc9)];console[_0x138072(0xa1)](_0x138072(0xda)+_0x575ff4[_0x138072(0xb3)]);switch(_0x575ff4['status']){case _0x138072(0xd2):return{'status':_0x138072(0xc3),'gatewayPaymentId':_0x586718,'cardLast4':_0xb73115};case _0x138072(0x9c):return{'status':'PENDING','gatewayPaymentId':_0x586718,'cardLast4':_0xb73115,'redirectUrl':_0x575ff4[_0x138072(0xa8)]};case'failed':const _0x5064b5=_0x575ff4['friendly_message']||'',_0xe3d0e=_0x575ff4['message']||'';let _0x3d6b96='';if(_0x5064b5&&_0xe3d0e)_0x3d6b96=_0x5064b5+_0x138072(0x8c)+_0xe3d0e;else{if(_0x5064b5)_0x3d6b96=_0x5064b5;else _0xe3d0e?_0x3d6b96=_0xe3d0e:_0x3d6b96='Payment\x20failed';}return{'status':'FAILED','failureMessage':_0x3d6b96,'gatewayPaymentId':_0x586718,'cardLast4':_0xb73115};default:console['warn']('‚ö†Ô∏è\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x575ff4['status']);const _0x447f6d=_0x575ff4[_0x138072(0x8b)]||'',_0x22939b=_0x575ff4['message']||'';let _0x75cc4d='';if(_0x447f6d&&_0x22939b)_0x75cc4d=_0x447f6d+_0x138072(0x8c)+_0x22939b;else{if(_0x447f6d)_0x75cc4d=_0x447f6d;else _0x22939b?_0x75cc4d=_0x22939b:_0x75cc4d='Unknown\x20error';}return{'status':_0x138072(0x99),'failureMessage':_0x75cc4d,'gatewayPaymentId':_0x586718,'cardLast4':_0xb73115};}}[a68_0x30eccb(0xb5)](_0x34574f){const _0x13b687=a68_0x30eccb,_0x4c5938=new Date()[_0x13b687(0xcb)](),_0xe44668={'timestamp':_0x4c5938,'webhook':_0x34574f,'source':_0x13b687(0xb0)},_0x3428e2=JSON[_0x13b687(0xb1)](_0xe44668)+'\x0a';try{fs_1[_0x13b687(0xca)]['appendFileSync'](this['webhookLogPath'],_0x3428e2),console['log'](_0x13b687(0xce)+_0x4c5938);}catch(_0xfd8cf5){console[_0x13b687(0xc7)](_0x13b687(0xcd),_0xfd8cf5);}}[a68_0x30eccb(0xb7)](_0xba3433=0x32){const _0x1fdb41=a68_0x30eccb;try{if(!fs_1[_0x1fdb41(0xca)][_0x1fdb41(0xad)](this['webhookLogPath']))return[];const _0x523fe8=fs_1[_0x1fdb41(0xca)][_0x1fdb41(0x94)](this['webhookLogPath'],_0x1fdb41(0xc8)),_0x5c198c=_0x523fe8[_0x1fdb41(0x93)]()['split']('\x0a')[_0x1fdb41(0xc1)](_0x402331=>_0x402331);return _0x5c198c[_0x1fdb41(0x9a)](-_0xba3433)[_0x1fdb41(0x92)](_0x21d1f6=>{const _0x26476a=_0x1fdb41;try{return JSON[_0x26476a(0xd1)](_0x21d1f6);}catch{return null;}})['filter'](_0x255083=>_0x255083!==null);}catch(_0x31c164){return console[_0x1fdb41(0xc7)]('‚ùå\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x31c164),[];}}}exports['SquirrelPayService']=SquirrelPayService;