'use strict';function a76_0x30ce(){const _0x34bd31=['webhookLogPath','logWebhook','toISOString','__importDefault','663260ySGbBC','âŒ\x20SquirrelPay\x20API\x20Error:','isTestMode','warn','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','email','stringify','502808PbSNLn','incomplete','existsSync','612318KizrDN','SquirrelPay\x20API\x20error:\x20','filter','logs','map','application/json','friendly_message','POST','join','message','\x20\x20\x20Gateway\x20ID:\x20','\x20\x20\x20Status:\x20','getPaymentStatus','error','default','gateway_id','parse','baseUrl','1608CVVMbY','readFileSync','PAID','code','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','\x20\x20\x20Message:\x20','\x20-\x20','node-fetch','Payment\x20failed','ðŸ“‹\x20Request\x20ID:\x20','text','failed','config','randomUUID','payment_method','\x20||\x20','Basic\x20','ðŸ”—\x20URL:\x20','ðŸ“¦\x20Body:','shopId','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','redirect_url','utf-8','4448DlKcWC','ðŸ’°\x20Amount:\x20','FAILED','squirrel-pay','toString','trim','ðŸ“\x20Description:\x20','getBasicAuth','7oCQlEy','âœ…\x20SquirrelPay\x20Response\x20Success:','slice','1726775xkGAZr','last_4','transaction','cwd','uid','successful','Unknown\x20error','log','ðŸ‘¤\x20Customer:\x20','crypto','status','birth_date','generateRequestId','__esModule','defineProperty','/transactions/payments','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','505725CtITiE','8556282KMdJqm','base64','SquirrelPayService'];a76_0x30ce=function(){return _0x34bd31;};return a76_0x30ce();}const a76_0x37a2d3=a76_0xe031;(function(_0x719d6a,_0x271eaf){const _0x4ea0fe=a76_0xe031,_0x35a664=_0x719d6a();while(!![]){try{const _0x4b976a=parseInt(_0x4ea0fe(0x13a))/0x1+-parseInt(_0x4ea0fe(0x142))/0x2+-parseInt(_0x4ea0fe(0x15e))/0x3*(-parseInt(_0x4ea0fe(0x176))/0x4)+parseInt(_0x4ea0fe(0x181))/0x5+parseInt(_0x4ea0fe(0x14c))/0x6+-parseInt(_0x4ea0fe(0x17e))/0x7*(-parseInt(_0x4ea0fe(0x149))/0x8)+-parseInt(_0x4ea0fe(0x13b))/0x9;if(_0x4b976a===_0x271eaf)break;else _0x35a664['push'](_0x35a664['shift']());}catch(_0x4efaaa){_0x35a664['push'](_0x35a664['shift']());}}}(a76_0x30ce,0x507d8));var __importDefault=this&&this[a76_0x37a2d3(0x141)]||function(_0x29fadd){const _0x123cbf=a76_0x37a2d3;return _0x29fadd&&_0x29fadd[_0x123cbf(0x136)]?_0x29fadd:{'default':_0x29fadd};};Object[a76_0x37a2d3(0x137)](exports,a76_0x37a2d3(0x136),{'value':!![]}),exports[a76_0x37a2d3(0x13d)]=void 0x0;function a76_0xe031(_0x54c4da,_0x4e936a){_0x54c4da=_0x54c4da-0x12a;const _0x30ce50=a76_0x30ce();let _0xe03180=_0x30ce50[_0x54c4da];return _0xe03180;}const crypto_1=__importDefault(require(a76_0x37a2d3(0x132))),node_fetch_1=__importDefault(require(a76_0x37a2d3(0x166))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0xada019){const _0x6019dd=a76_0x37a2d3;this['config']=_0xada019,this[_0x6019dd(0x13e)]=path_1['default'][_0x6019dd(0x154)](process[_0x6019dd(0x12c)](),_0x6019dd(0x14f),'squirrel-pay-webhooks.log');const _0x461684=path_1[_0x6019dd(0x15a)]['dirname'](this[_0x6019dd(0x13e)]);!fs_1[_0x6019dd(0x15a)][_0x6019dd(0x14b)](_0x461684)&&fs_1['default']['mkdirSync'](_0x461684,{'recursive':!![]});}[a76_0x37a2d3(0x17d)](){const _0x27385e=a76_0x37a2d3,_0x2853d8=this[_0x27385e(0x16b)][_0x27385e(0x172)]+':'+this[_0x27385e(0x16b)]['secretKey'];return Buffer['from'](_0x2853d8)[_0x27385e(0x17a)](_0x27385e(0x13c));}[a76_0x37a2d3(0x135)](){const _0xda1440=a76_0x37a2d3;return crypto_1['default'][_0xda1440(0x16c)]();}async['processCardPayment'](_0x51985e,_0x36fd24,_0x2d5ec1,_0x4a93df,_0x46f903,_0x474cc7,_0x17cd2c,_0x5ce08a,_0x292c92){const _0x2b8034=a76_0x37a2d3;console[_0x2b8034(0x130)](_0x2b8034(0x173)),console['log'](_0x2b8034(0x177)+_0x51985e+'\x20'+_0x36fd24),console[_0x2b8034(0x130)](_0x2b8034(0x17c)+_0x2d5ec1),console[_0x2b8034(0x130)](_0x2b8034(0x131)+_0x17cd2c[_0x2b8034(0x147)]+'\x20('+_0x17cd2c['ip']+')');const _0xeb201c={'request':{'amount':_0x51985e,'currency':_0x36fd24,'description':_0x2d5ec1,'gate_id':parseInt(this['config'][_0x2b8034(0x172)]),'return_url':_0x4a93df,'notification_url':_0x46f903,'credit_card':_0x474cc7,'customer':{'email':_0x17cd2c[_0x2b8034(0x147)],'phone':_0x292c92,'birth_date':_0x17cd2c[_0x2b8034(0x134)],'billing':_0x5ce08a},'test':this['config'][_0x2b8034(0x144)]}},_0x45dd05=this[_0x2b8034(0x135)](),_0xe5ebc7={'Authorization':_0x2b8034(0x16f)+this[_0x2b8034(0x17d)](),'Content-Type':_0x2b8034(0x151),'Accept':'application/json','X-API-Version':'3','RequestID':_0x45dd05};try{console['log']('ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x2b8034(0x130)](_0x2b8034(0x168)+_0x45dd05),console[_0x2b8034(0x130)](_0x2b8034(0x170)+this[_0x2b8034(0x16b)][_0x2b8034(0x15d)]+_0x2b8034(0x138)),console[_0x2b8034(0x130)]('ðŸ”§\x20Headers:',JSON[_0x2b8034(0x148)](_0xe5ebc7,null,0x2)),console['log'](_0x2b8034(0x171),JSON[_0x2b8034(0x148)](_0xeb201c,null,0x2));const _0x3b5af2=await(0x0,node_fetch_1['default'])(this[_0x2b8034(0x16b)][_0x2b8034(0x15d)]+'/transactions/payments',{'method':_0x2b8034(0x153),'headers':_0xe5ebc7,'body':JSON[_0x2b8034(0x148)](_0xeb201c)}),_0x358d38=await _0x3b5af2[_0x2b8034(0x169)]();console[_0x2b8034(0x130)](_0x2b8034(0x162)+_0x3b5af2[_0x2b8034(0x133)]),console['log']('ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20'+_0x358d38);if(!_0x3b5af2['ok'])throw new Error(_0x2b8034(0x14d)+_0x3b5af2[_0x2b8034(0x133)]+'\x20'+_0x3b5af2['statusText']+_0x2b8034(0x165)+_0x358d38);const _0x1b08bf=JSON[_0x2b8034(0x15c)](_0x358d38);return console[_0x2b8034(0x130)](_0x2b8034(0x17f)),console[_0x2b8034(0x130)]('\x20\x20\x20UID:\x20'+_0x1b08bf[_0x2b8034(0x12d)]),console['log'](_0x2b8034(0x157)+_0x1b08bf[_0x2b8034(0x133)]),console[_0x2b8034(0x130)]('\x20\x20\x20Code:\x20'+_0x1b08bf[_0x2b8034(0x161)]),console[_0x2b8034(0x130)](_0x2b8034(0x164)+_0x1b08bf[_0x2b8034(0x152)]),console[_0x2b8034(0x130)](_0x2b8034(0x156)+_0x1b08bf[_0x2b8034(0x12b)][_0x2b8034(0x15b)]),console[_0x2b8034(0x130)]('\x20\x20\x20Last\x204:\x20'+_0x1b08bf[_0x2b8034(0x16d)]['last_4']),_0x1b08bf[_0x2b8034(0x174)]&&console['log']('ðŸ”„\x20Redirect\x20URL:\x20'+_0x1b08bf[_0x2b8034(0x174)]),_0x1b08bf;}catch(_0x3950a5){console['error'](_0x2b8034(0x143),_0x3950a5);throw _0x3950a5;}}[a76_0x37a2d3(0x158)](_0x49583f){const _0x1b719a=a76_0x37a2d3,_0x2362a1=_0x49583f['uid'],_0x2f0466=_0x49583f[_0x1b719a(0x16d)][_0x1b719a(0x12a)];console['log'](_0x1b719a(0x146)+_0x49583f[_0x1b719a(0x133)]);switch(_0x49583f[_0x1b719a(0x133)]){case _0x1b719a(0x12e):return{'status':_0x1b719a(0x160),'gatewayPaymentId':_0x2362a1,'cardLast4':_0x2f0466};case _0x1b719a(0x14a):return{'status':'PENDING','gatewayPaymentId':_0x2362a1,'cardLast4':_0x2f0466,'redirectUrl':_0x49583f[_0x1b719a(0x174)]};case _0x1b719a(0x16a):const _0x326592=_0x49583f[_0x1b719a(0x152)]||'',_0x267afc=_0x49583f[_0x1b719a(0x155)]||'';let _0x190854='';if(_0x326592&&_0x267afc)_0x190854=_0x326592+_0x1b719a(0x16e)+_0x267afc;else{if(_0x326592)_0x190854=_0x326592;else _0x267afc?_0x190854=_0x267afc:_0x190854=_0x1b719a(0x167);}return{'status':'FAILED','failureMessage':_0x190854,'gatewayPaymentId':_0x2362a1,'cardLast4':_0x2f0466};default:console[_0x1b719a(0x145)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x49583f[_0x1b719a(0x133)]);const _0x26b118=_0x49583f[_0x1b719a(0x152)]||'',_0x5dfc2b=_0x49583f[_0x1b719a(0x155)]||'';let _0x5a4d95='';if(_0x26b118&&_0x5dfc2b)_0x5a4d95=_0x26b118+'\x20||\x20'+_0x5dfc2b;else{if(_0x26b118)_0x5a4d95=_0x26b118;else _0x5dfc2b?_0x5a4d95=_0x5dfc2b:_0x5a4d95=_0x1b719a(0x12f);}return{'status':_0x1b719a(0x178),'failureMessage':_0x5a4d95,'gatewayPaymentId':_0x2362a1,'cardLast4':_0x2f0466};}}[a76_0x37a2d3(0x13f)](_0x1d57f9){const _0xc1eb2a=a76_0x37a2d3,_0x301279=new Date()[_0xc1eb2a(0x140)](),_0x3cd812={'timestamp':_0x301279,'webhook':_0x1d57f9,'source':_0xc1eb2a(0x179)},_0x1afbb4=JSON['stringify'](_0x3cd812)+'\x0a';try{fs_1[_0xc1eb2a(0x15a)]['appendFileSync'](this[_0xc1eb2a(0x13e)],_0x1afbb4),console[_0xc1eb2a(0x130)](_0xc1eb2a(0x139)+_0x301279);}catch(_0x4e81dc){console[_0xc1eb2a(0x159)]('âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:',_0x4e81dc);}}['getWebhookLogs'](_0x31da33=0x32){const _0x48b312=a76_0x37a2d3;try{if(!fs_1[_0x48b312(0x15a)][_0x48b312(0x14b)](this[_0x48b312(0x13e)]))return[];const _0x19000c=fs_1[_0x48b312(0x15a)][_0x48b312(0x15f)](this[_0x48b312(0x13e)],_0x48b312(0x175)),_0x4d2c99=_0x19000c[_0x48b312(0x17b)]()['split']('\x0a')[_0x48b312(0x14e)](_0x3d8568=>_0x3d8568);return _0x4d2c99[_0x48b312(0x180)](-_0x31da33)[_0x48b312(0x150)](_0x1d5040=>{try{return JSON['parse'](_0x1d5040);}catch{return null;}})[_0x48b312(0x14e)](_0xf173fc=>_0xf173fc!==null);}catch(_0x3d55c0){return console[_0x48b312(0x159)](_0x48b312(0x163),_0x3d55c0),[];}}}exports['SquirrelPayService']=SquirrelPayService;