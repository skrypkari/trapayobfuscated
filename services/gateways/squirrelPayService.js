'use strict';const a68_0x423b86=a68_0x5a2c;(function(_0x2cc314,_0x2ac9cf){const _0x1dce43=a68_0x5a2c,_0x3a3745=_0x2cc314();while(!![]){try{const _0x12ba6d=-parseInt(_0x1dce43(0x1c6))/0x1*(parseInt(_0x1dce43(0x1b4))/0x2)+-parseInt(_0x1dce43(0x18a))/0x3+parseInt(_0x1dce43(0x186))/0x4+parseInt(_0x1dce43(0x192))/0x5+parseInt(_0x1dce43(0x197))/0x6*(-parseInt(_0x1dce43(0x1a5))/0x7)+parseInt(_0x1dce43(0x188))/0x8+parseInt(_0x1dce43(0x181))/0x9*(parseInt(_0x1dce43(0x1ab))/0xa);if(_0x12ba6d===_0x2ac9cf)break;else _0x3a3745['push'](_0x3a3745['shift']());}catch(_0xf53fed){_0x3a3745['push'](_0x3a3745['shift']());}}}(a68_0x2ae1,0xea2f9));function a68_0x2ae1(){const _0x501a37=['successful','FAILED','appendFileSync','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','friendly_message','ðŸ“\x20Description:\x20','readFileSync','config','/transactions/payments','error','trim','uid','path','incomplete','baseUrl','__esModule','secretKey','filter','utf-8','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','\x20||\x20','1187091mddOFW','generateRequestId','getBasicAuth','default','âŒ\x20SquirrelPay\x20API\x20Error:','18628LSSypT','cwd','8745168caRGBu','existsSync','2721957iOHWLj','status','map','join','\x20\x20\x20Code:\x20','getPaymentStatus','message','last_4','1935260UrPefY','logs','redirect_url','Payment\x20failed','SquirrelPayService','4898964sRtXnN','defineProperty','email','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','âœ…\x20SquirrelPay\x20Response\x20Success:','__importDefault','Unknown\x20error','logWebhook','statusText','\x20\x20\x20Message:\x20','code','webhookLogPath','failed','7GQtwGG','base64','node-fetch','squirrel-pay','PENDING','stringify','220zZXYeG','ðŸ”„\x20Redirect\x20URL:\x20','transaction','\x20\x20\x20Status:\x20','text','\x20-\x20','warn','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','shopId','8290AOUKdC','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','log','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','ðŸ”§\x20Headers:','squirrel-pay-webhooks.log','payment_method','birth_date','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','parse','ðŸ‘¤\x20Customer:\x20','crypto','POST','ðŸ“‹\x20Request\x20ID:\x20','SquirrelPay\x20API\x20error:\x20','\x20\x20\x20Gateway\x20ID:\x20','\x20\x20\x20Last\x204:\x20','gateway_id','411IvgIeN'];a68_0x2ae1=function(){return _0x501a37;};return a68_0x2ae1();}var __importDefault=this&&this[a68_0x423b86(0x19d)]||function(_0x13185b){const _0x5c1c49=a68_0x423b86;return _0x13185b&&_0x13185b[_0x5c1c49(0x17b)]?_0x13185b:{'default':_0x13185b};};Object[a68_0x423b86(0x198)](exports,a68_0x423b86(0x17b),{'value':!![]}),exports[a68_0x423b86(0x196)]=void 0x0;function a68_0x5a2c(_0x458398,_0x53d60d){_0x458398=_0x458398-0x16e;const _0x2ae1ef=a68_0x2ae1();let _0x5a2c0d=_0x2ae1ef[_0x458398];return _0x5a2c0d;}const crypto_1=__importDefault(require(a68_0x423b86(0x1bf))),node_fetch_1=__importDefault(require(a68_0x423b86(0x1a7))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x423b86(0x178)));class SquirrelPayService{constructor(_0xca5048){const _0x13e6c3=a68_0x423b86;this[_0x13e6c3(0x173)]=_0xca5048,this[_0x13e6c3(0x1a3)]=path_1[_0x13e6c3(0x184)][_0x13e6c3(0x18d)](process[_0x13e6c3(0x187)](),_0x13e6c3(0x193),_0x13e6c3(0x1b9));const _0x3bebe4=path_1[_0x13e6c3(0x184)]['dirname'](this['webhookLogPath']);!fs_1['default'][_0x13e6c3(0x189)](_0x3bebe4)&&fs_1[_0x13e6c3(0x184)]['mkdirSync'](_0x3bebe4,{'recursive':!![]});}[a68_0x423b86(0x183)](){const _0x55d3ef=a68_0x423b86,_0x2ff77f=this['config'][_0x55d3ef(0x1b3)]+':'+this[_0x55d3ef(0x173)][_0x55d3ef(0x17c)];return Buffer['from'](_0x2ff77f)['toString'](_0x55d3ef(0x1a6));}[a68_0x423b86(0x182)](){const _0x5e77e4=a68_0x423b86;return crypto_1[_0x5e77e4(0x184)]['randomUUID']();}async['processCardPayment'](_0x390bc6,_0x197fc3,_0x1d462f,_0x48b07f,_0x1dcd2e,_0x24ae00,_0x30a9f8,_0x1c258c,_0x86e22f){const _0x3b4c74=a68_0x423b86;console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1b7)),console[_0x3b4c74(0x1b6)]('ðŸ’°\x20Amount:\x20'+_0x390bc6+'\x20'+_0x197fc3),console[_0x3b4c74(0x1b6)](_0x3b4c74(0x171)+_0x1d462f),console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1be)+_0x30a9f8[_0x3b4c74(0x199)]+'\x20('+_0x30a9f8['ip']+')');const _0x574fc0={'request':{'amount':_0x390bc6,'currency':_0x197fc3,'description':_0x1d462f,'gate_id':parseInt(this[_0x3b4c74(0x173)]['shopId']),'return_url':_0x48b07f,'notification_url':_0x1dcd2e,'credit_card':_0x24ae00,'customer':{'email':_0x30a9f8[_0x3b4c74(0x199)],'phone':_0x86e22f,'birth_date':_0x30a9f8[_0x3b4c74(0x1bb)],'billing':_0x1c258c},'test':this[_0x3b4c74(0x173)]['isTestMode']}},_0x5a26c1=this[_0x3b4c74(0x182)](),_0x87b7d1={'Authorization':'Basic\x20'+this[_0x3b4c74(0x183)](),'Content-Type':'application/json','Accept':'application/json','X-API-Version':'3','RequestID':_0x5a26c1};try{console[_0x3b4c74(0x1b6)]('ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1c1)+_0x5a26c1),console['log']('ðŸ”—\x20URL:\x20'+this['config'][_0x3b4c74(0x17a)]+'/transactions/payments'),console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1b8),JSON[_0x3b4c74(0x1aa)](_0x87b7d1,null,0x2)),console[_0x3b4c74(0x1b6)]('ðŸ“¦\x20Body:',JSON['stringify'](_0x574fc0,null,0x2));const _0x1df9cc=await(0x0,node_fetch_1[_0x3b4c74(0x184)])(this['config'][_0x3b4c74(0x17a)]+_0x3b4c74(0x174),{'method':_0x3b4c74(0x1c0),'headers':_0x87b7d1,'body':JSON[_0x3b4c74(0x1aa)](_0x574fc0)}),_0x26376e=await _0x1df9cc[_0x3b4c74(0x1af)]();console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1b5)+_0x1df9cc[_0x3b4c74(0x18b)]),console['log'](_0x3b4c74(0x19b)+_0x26376e);if(!_0x1df9cc['ok'])throw new Error(_0x3b4c74(0x1c2)+_0x1df9cc[_0x3b4c74(0x18b)]+'\x20'+_0x1df9cc[_0x3b4c74(0x1a0)]+_0x3b4c74(0x1b0)+_0x26376e);const _0x4653d4=JSON[_0x3b4c74(0x1bd)](_0x26376e);return console['log'](_0x3b4c74(0x19c)),console['log']('\x20\x20\x20UID:\x20'+_0x4653d4['uid']),console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1ae)+_0x4653d4[_0x3b4c74(0x18b)]),console['log'](_0x3b4c74(0x18e)+_0x4653d4[_0x3b4c74(0x1a2)]),console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1a1)+_0x4653d4[_0x3b4c74(0x170)]),console['log'](_0x3b4c74(0x1c3)+_0x4653d4[_0x3b4c74(0x1ad)][_0x3b4c74(0x1c5)]),console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1c4)+_0x4653d4[_0x3b4c74(0x1ba)][_0x3b4c74(0x191)]),_0x4653d4[_0x3b4c74(0x194)]&&console[_0x3b4c74(0x1b6)](_0x3b4c74(0x1ac)+_0x4653d4[_0x3b4c74(0x194)]),_0x4653d4;}catch(_0x3c37b6){console[_0x3b4c74(0x175)](_0x3b4c74(0x185),_0x3c37b6);throw _0x3c37b6;}}[a68_0x423b86(0x18f)](_0x39b0ff){const _0x296160=a68_0x423b86,_0x4f1728=_0x39b0ff[_0x296160(0x177)],_0x282ecd=_0x39b0ff[_0x296160(0x1ba)]['last_4'];console[_0x296160(0x1b6)](_0x296160(0x17f)+_0x39b0ff['status']);switch(_0x39b0ff[_0x296160(0x18b)]){case _0x296160(0x1c7):return{'status':'PAID','gatewayPaymentId':_0x4f1728,'cardLast4':_0x282ecd};case _0x296160(0x179):return{'status':_0x296160(0x1a9),'gatewayPaymentId':_0x4f1728,'cardLast4':_0x282ecd,'redirectUrl':_0x39b0ff[_0x296160(0x194)]};case _0x296160(0x1a4):const _0x3adce4=_0x39b0ff[_0x296160(0x170)]||'',_0x5b9280=_0x39b0ff['message']||'';let _0x247fa5='';if(_0x3adce4&&_0x5b9280)_0x247fa5=_0x3adce4+_0x296160(0x180)+_0x5b9280;else{if(_0x3adce4)_0x247fa5=_0x3adce4;else _0x5b9280?_0x247fa5=_0x5b9280:_0x247fa5=_0x296160(0x195);}return{'status':'FAILED','failureMessage':_0x247fa5,'gatewayPaymentId':_0x4f1728,'cardLast4':_0x282ecd};default:console[_0x296160(0x1b1)](_0x296160(0x19a)+_0x39b0ff[_0x296160(0x18b)]);const _0x22ca8a=_0x39b0ff[_0x296160(0x170)]||'',_0x471a95=_0x39b0ff[_0x296160(0x190)]||'';let _0x38ace2='';if(_0x22ca8a&&_0x471a95)_0x38ace2=_0x22ca8a+_0x296160(0x180)+_0x471a95;else{if(_0x22ca8a)_0x38ace2=_0x22ca8a;else _0x471a95?_0x38ace2=_0x471a95:_0x38ace2=_0x296160(0x19e);}return{'status':_0x296160(0x1c8),'failureMessage':_0x38ace2,'gatewayPaymentId':_0x4f1728,'cardLast4':_0x282ecd};}}[a68_0x423b86(0x19f)](_0x1f23e4){const _0x52d236=a68_0x423b86,_0x1fb743=new Date()['toISOString'](),_0x10441d={'timestamp':_0x1fb743,'webhook':_0x1f23e4,'source':_0x52d236(0x1a8)},_0x2b20ae=JSON[_0x52d236(0x1aa)](_0x10441d)+'\x0a';try{fs_1[_0x52d236(0x184)][_0x52d236(0x16e)](this['webhookLogPath'],_0x2b20ae),console[_0x52d236(0x1b6)](_0x52d236(0x16f)+_0x1fb743);}catch(_0x3237c6){console[_0x52d236(0x175)](_0x52d236(0x1bc),_0x3237c6);}}['getWebhookLogs'](_0x12b69d=0x32){const _0x392e37=a68_0x423b86;try{if(!fs_1[_0x392e37(0x184)]['existsSync'](this['webhookLogPath']))return[];const _0x4a53d2=fs_1[_0x392e37(0x184)][_0x392e37(0x172)](this[_0x392e37(0x1a3)],_0x392e37(0x17e)),_0x5465fb=_0x4a53d2[_0x392e37(0x176)]()['split']('\x0a')['filter'](_0x5d14c5=>_0x5d14c5);return _0x5465fb['slice'](-_0x12b69d)[_0x392e37(0x18c)](_0x21439b=>{const _0x5b92be=_0x392e37;try{return JSON[_0x5b92be(0x1bd)](_0x21439b);}catch{return null;}})[_0x392e37(0x17d)](_0x44d7a7=>_0x44d7a7!==null);}catch(_0x22f9b7){return console['error'](_0x392e37(0x1b2),_0x22f9b7),[];}}}exports['SquirrelPayService']=SquirrelPayService;