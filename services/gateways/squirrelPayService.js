'use strict';const a72_0x1adba2=a72_0x26a6;(function(_0x29cd9a,_0x3bbf55){const _0x4c592c=a72_0x26a6,_0x5c6612=_0x29cd9a();while(!![]){try{const _0x91d160=parseInt(_0x4c592c(0xd5))/0x1*(-parseInt(_0x4c592c(0xa4))/0x2)+parseInt(_0x4c592c(0xef))/0x3+-parseInt(_0x4c592c(0xc2))/0x4*(-parseInt(_0x4c592c(0xcb))/0x5)+parseInt(_0x4c592c(0xed))/0x6*(-parseInt(_0x4c592c(0x9a))/0x7)+parseInt(_0x4c592c(0xf0))/0x8*(parseInt(_0x4c592c(0xba))/0x9)+-parseInt(_0x4c592c(0xa2))/0xa+parseInt(_0x4c592c(0xbb))/0xb;if(_0x91d160===_0x3bbf55)break;else _0x5c6612['push'](_0x5c6612['shift']());}catch(_0x9dbeef){_0x5c6612['push'](_0x5c6612['shift']());}}}(a72_0x164f,0xc8f07));function a72_0x26a6(_0xad4528,_0x38a12a){_0xad4528=_0xad4528-0x96;const _0x164f3b=a72_0x164f();let _0x26a636=_0x164f3b[_0xad4528];return _0x26a636;}var __importDefault=this&&this['__importDefault']||function(_0x335515){const _0x68c1da=a72_0x26a6;return _0x335515&&_0x335515[_0x68c1da(0xe6)]?_0x335515:{'default':_0x335515};};function a72_0x164f(){const _0x25b455=['ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','SquirrelPayService','randomUUID','PENDING','ðŸ”§\x20Headers:','3252213mAoZyE','15985882TeiMlI','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','squirrel-pay-webhooks.log','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','PAID','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','getWebhookLogs','240428xplUJn','log','status','logWebhook','\x20\x20\x20Message:\x20','Unknown\x20error','logs','crypto','isTestMode','50DoHapm','message','baseUrl','ðŸ”„\x20Redirect\x20URL:\x20','filter','webhookLogPath','map','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','statusText','appendFileSync','1CkaQkq','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','\x20\x20\x20Status:\x20','POST','\x20\x20\x20Code:\x20','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','secretKey','âŒ\x20SquirrelPay\x20API\x20Error:','squirrel-pay','getBasicAuth','join','text','ðŸ“¦\x20Body:','mkdirSync','defineProperty','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','config','__esModule','email','base64','successful','\x20\x20\x20UID:\x20','error','last_4','3561714mAQyhO','ðŸ“\x20Description:\x20','2012217vgcJOs','8nFUrRV','code','getPaymentStatus','payment_method','ðŸ“‹\x20Request\x20ID:\x20','7rdwPIL','cwd','application/json','readFileSync','default','stringify','FAILED','path','1996880SjcAwv','processCardPayment','2940148gdKNAZ','\x20\x20\x20Gateway\x20ID:\x20','âœ…\x20SquirrelPay\x20Response\x20Success:','slice','split','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','trim','ðŸ‘¤\x20Customer:\x20','\x20-\x20','/transactions/payments','\x20\x20\x20Last\x204:\x20','node-fetch','parse','ðŸ”—\x20URL:\x20','shopId','redirect_url','\x20||\x20'];a72_0x164f=function(){return _0x25b455;};return a72_0x164f();}Object[a72_0x1adba2(0xe3)](exports,a72_0x1adba2(0xe6),{'value':!![]}),exports[a72_0x1adba2(0xb6)]=void 0x0;const crypto_1=__importDefault(require(a72_0x1adba2(0xc9))),node_fetch_1=__importDefault(require(a72_0x1adba2(0xaf))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a72_0x1adba2(0xa1)));class SquirrelPayService{constructor(_0xa4d77){const _0x186667=a72_0x1adba2;this[_0x186667(0xe5)]=_0xa4d77,this[_0x186667(0xd0)]=path_1[_0x186667(0x9e)][_0x186667(0xdf)](process[_0x186667(0x9b)](),_0x186667(0xc8),_0x186667(0xbd));const _0x4cef3c=path_1[_0x186667(0x9e)]['dirname'](this['webhookLogPath']);!fs_1[_0x186667(0x9e)]['existsSync'](_0x4cef3c)&&fs_1[_0x186667(0x9e)][_0x186667(0xe2)](_0x4cef3c,{'recursive':!![]});}[a72_0x1adba2(0xde)](){const _0x12bd8a=a72_0x1adba2,_0x3e85f9=this['config'][_0x12bd8a(0xb2)]+':'+this[_0x12bd8a(0xe5)][_0x12bd8a(0xdb)];return Buffer['from'](_0x3e85f9)['toString'](_0x12bd8a(0xe8));}['generateRequestId'](){const _0x5b7a27=a72_0x1adba2;return crypto_1[_0x5b7a27(0x9e)][_0x5b7a27(0xb7)]();}async[a72_0x1adba2(0xa3)](_0xed14bb,_0x82214a,_0x21ee43,_0x2debfe,_0x3206ab,_0x146b64,_0x358d82,_0xe01b01,_0x28f0f7){const _0x3332f1=a72_0x1adba2;console[_0x3332f1(0xc3)](_0x3332f1(0xda)),console[_0x3332f1(0xc3)]('ðŸ’°\x20Amount:\x20'+_0xed14bb+'\x20'+_0x82214a),console[_0x3332f1(0xc3)](_0x3332f1(0xee)+_0x21ee43),console[_0x3332f1(0xc3)](_0x3332f1(0xab)+_0x358d82[_0x3332f1(0xe7)]+'\x20('+_0x358d82['ip']+')');const _0x5aa558={'request':{'amount':_0xed14bb,'currency':_0x82214a,'description':_0x21ee43,'gate_id':parseInt(this[_0x3332f1(0xe5)][_0x3332f1(0xb2)]),'return_url':_0x2debfe,'notification_url':_0x3206ab,'credit_card':_0x146b64,'customer':{'email':_0x358d82['email'],'phone':_0x28f0f7,'birth_date':_0x358d82['birth_date'],'billing':_0xe01b01},'test':this[_0x3332f1(0xe5)][_0x3332f1(0xca)]}},_0x5115da=this['generateRequestId'](),_0x3f8a6b={'Authorization':'Basic\x20'+this['getBasicAuth'](),'Content-Type':_0x3332f1(0x9c),'Accept':_0x3332f1(0x9c),'X-API-Version':'3','RequestID':_0x5115da};try{console[_0x3332f1(0xc3)](_0x3332f1(0xe4)),console['log'](_0x3332f1(0x99)+_0x5115da),console[_0x3332f1(0xc3)](_0x3332f1(0xb1)+this[_0x3332f1(0xe5)][_0x3332f1(0xcd)]+_0x3332f1(0xad)),console[_0x3332f1(0xc3)](_0x3332f1(0xb9),JSON[_0x3332f1(0x9f)](_0x3f8a6b,null,0x2)),console[_0x3332f1(0xc3)](_0x3332f1(0xe1),JSON[_0x3332f1(0x9f)](_0x5aa558,null,0x2));const _0x26f1e6=await(0x0,node_fetch_1[_0x3332f1(0x9e)])(this[_0x3332f1(0xe5)]['baseUrl']+_0x3332f1(0xad),{'method':_0x3332f1(0xd8),'headers':_0x3f8a6b,'body':JSON[_0x3332f1(0x9f)](_0x5aa558)}),_0x4c5c95=await _0x26f1e6[_0x3332f1(0xe0)]();console[_0x3332f1(0xc3)](_0x3332f1(0xd6)+_0x26f1e6[_0x3332f1(0xc4)]),console[_0x3332f1(0xc3)](_0x3332f1(0xc0)+_0x4c5c95);if(!_0x26f1e6['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x26f1e6[_0x3332f1(0xc4)]+'\x20'+_0x26f1e6[_0x3332f1(0xd3)]+_0x3332f1(0xac)+_0x4c5c95);const _0x142d9e=JSON['parse'](_0x4c5c95);return console['log'](_0x3332f1(0xa6)),console['log'](_0x3332f1(0xea)+_0x142d9e['uid']),console[_0x3332f1(0xc3)](_0x3332f1(0xd7)+_0x142d9e[_0x3332f1(0xc4)]),console[_0x3332f1(0xc3)](_0x3332f1(0xd9)+_0x142d9e[_0x3332f1(0x96)]),console['log'](_0x3332f1(0xc6)+_0x142d9e['friendly_message']),console[_0x3332f1(0xc3)](_0x3332f1(0xa5)+_0x142d9e['transaction']['gateway_id']),console['log'](_0x3332f1(0xae)+_0x142d9e[_0x3332f1(0x98)]['last_4']),_0x142d9e[_0x3332f1(0xb3)]&&console[_0x3332f1(0xc3)](_0x3332f1(0xce)+_0x142d9e[_0x3332f1(0xb3)]),_0x142d9e;}catch(_0x50585e){console[_0x3332f1(0xeb)](_0x3332f1(0xdc),_0x50585e);throw _0x50585e;}}[a72_0x1adba2(0x97)](_0x17233c){const _0x49a155=a72_0x1adba2,_0x2993f1=_0x17233c['uid'],_0x3e9695=_0x17233c[_0x49a155(0x98)][_0x49a155(0xec)];console[_0x49a155(0xc3)](_0x49a155(0xb5)+_0x17233c[_0x49a155(0xc4)]);switch(_0x17233c[_0x49a155(0xc4)]){case _0x49a155(0xe9):return{'status':_0x49a155(0xbf),'gatewayPaymentId':_0x2993f1,'cardLast4':_0x3e9695};case'incomplete':return{'status':_0x49a155(0xb8),'gatewayPaymentId':_0x2993f1,'cardLast4':_0x3e9695,'redirectUrl':_0x17233c[_0x49a155(0xb3)]};case'failed':const _0x472d0d=_0x17233c['friendly_message']||'',_0x3e376c=_0x17233c[_0x49a155(0xcc)]||'';let _0x873bab='';if(_0x472d0d&&_0x3e376c)_0x873bab=_0x472d0d+_0x49a155(0xb4)+_0x3e376c;else{if(_0x472d0d)_0x873bab=_0x472d0d;else _0x3e376c?_0x873bab=_0x3e376c:_0x873bab='Payment\x20failed';}return{'status':_0x49a155(0xa0),'failureMessage':_0x873bab,'gatewayPaymentId':_0x2993f1,'cardLast4':_0x3e9695};default:console['warn'](_0x49a155(0xbe)+_0x17233c[_0x49a155(0xc4)]);const _0xf6de46=_0x17233c['friendly_message']||'',_0x5e022d=_0x17233c['message']||'';let _0x13e44a='';if(_0xf6de46&&_0x5e022d)_0x13e44a=_0xf6de46+'\x20||\x20'+_0x5e022d;else{if(_0xf6de46)_0x13e44a=_0xf6de46;else _0x5e022d?_0x13e44a=_0x5e022d:_0x13e44a=_0x49a155(0xc7);}return{'status':'FAILED','failureMessage':_0x13e44a,'gatewayPaymentId':_0x2993f1,'cardLast4':_0x3e9695};}}[a72_0x1adba2(0xc5)](_0x10d181){const _0x457146=a72_0x1adba2,_0x6e4299=new Date()['toISOString'](),_0xc35789={'timestamp':_0x6e4299,'webhook':_0x10d181,'source':_0x457146(0xdd)},_0x10056a=JSON[_0x457146(0x9f)](_0xc35789)+'\x0a';try{fs_1[_0x457146(0x9e)][_0x457146(0xd4)](this[_0x457146(0xd0)],_0x10056a),console[_0x457146(0xc3)](_0x457146(0xa9)+_0x6e4299);}catch(_0x520096){console[_0x457146(0xeb)](_0x457146(0xd2),_0x520096);}}[a72_0x1adba2(0xc1)](_0xeb13a=0x32){const _0x432631=a72_0x1adba2;try{if(!fs_1[_0x432631(0x9e)]['existsSync'](this['webhookLogPath']))return[];const _0x49e568=fs_1[_0x432631(0x9e)][_0x432631(0x9d)](this['webhookLogPath'],'utf-8'),_0x479485=_0x49e568[_0x432631(0xaa)]()[_0x432631(0xa8)]('\x0a')[_0x432631(0xcf)](_0x3e6f72=>_0x3e6f72);return _0x479485[_0x432631(0xa7)](-_0xeb13a)[_0x432631(0xd1)](_0x4cbf10=>{const _0x279bff=_0x432631;try{return JSON[_0x279bff(0xb0)](_0x4cbf10);}catch{return null;}})[_0x432631(0xcf)](_0xef67c4=>_0xef67c4!==null);}catch(_0x13f5c1){return console[_0x432631(0xeb)](_0x432631(0xbc),_0x13f5c1),[];}}}exports[a72_0x1adba2(0xb6)]=SquirrelPayService;