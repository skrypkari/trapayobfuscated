'use strict';const a64_0x311ad9=a64_0x4f4d;(function(_0x520682,_0x952f5){const _0x50d647=a64_0x4f4d,_0x769bc0=_0x520682();while(!![]){try{const _0x23807f=-parseInt(_0x50d647(0x201))/0x1+-parseInt(_0x50d647(0x1cc))/0x2*(-parseInt(_0x50d647(0x1e9))/0x3)+parseInt(_0x50d647(0x1f0))/0x4+parseInt(_0x50d647(0x1b9))/0x5*(parseInt(_0x50d647(0x1dc))/0x6)+parseInt(_0x50d647(0x1ba))/0x7*(-parseInt(_0x50d647(0x1c6))/0x8)+parseInt(_0x50d647(0x1ee))/0x9*(parseInt(_0x50d647(0x1e2))/0xa)+parseInt(_0x50d647(0x1c3))/0xb*(-parseInt(_0x50d647(0x1e1))/0xc);if(_0x23807f===_0x952f5)break;else _0x769bc0['push'](_0x769bc0['shift']());}catch(_0x3b6143){_0x769bc0['push'](_0x769bc0['shift']());}}}(a64_0xbfc7,0x77bf2));function a64_0xbfc7(){const _0x26d084=['PENDING','Payment\x20failed','POST','\x20\x20\x20Gateway\x20ID:\x20','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','Basic\x20','stringify','log','ðŸ’°\x20Amount:\x20','âŒ\x20SquirrelPay\x20API\x20Error:','566664ZknduF','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','dirname','getWebhookLogs','status','167364IjyAAY','10hzZQlJ','split','logWebhook','from','filter','warn','\x20\x20\x20Code:\x20','456YSQgGb','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','application/json','map','message','3213477QSiplV','cwd','2906856XyXJzk','/transactions/payments','transaction','uid','code','redirect_url','parse','squirrel-pay','failed','getBasicAuth','successful','default','ðŸ”—\x20URL:\x20','gateway_id','statusText','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','join','491658UASMUJ','isTestMode','SquirrelPayService','shopId','config','\x20||\x20','utf-8','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','baseUrl','friendly_message','getPaymentStatus','\x20\x20\x20Status:\x20','incomplete','ðŸ“¦\x20Body:','__esModule','45wKItDe','35yrfaHZ','ðŸ”„\x20Redirect\x20URL:\x20','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','error','slice','toISOString','__importDefault','\x20-\x20','webhookLogPath','649gwpkQr','node-fetch','\x20\x20\x20UID:\x20','471088bNhzwp','processCardPayment','ðŸ“\x20Description:\x20','FAILED','crypto','email','2180ZTfZve','mkdirSync','ðŸ“‹\x20Request\x20ID:\x20','ðŸ‘¤\x20Customer:\x20','payment_method','base64'];a64_0xbfc7=function(){return _0x26d084;};return a64_0xbfc7();}var __importDefault=this&&this[a64_0x311ad9(0x1c0)]||function(_0x278c0a){const _0x284a02=a64_0x311ad9;return _0x278c0a&&_0x278c0a[_0x284a02(0x1b8)]?_0x278c0a:{'default':_0x278c0a};};function a64_0x4f4d(_0x27f141,_0x444543){_0x27f141=_0x27f141-0x1b7;const _0xbfc755=a64_0xbfc7();let _0x4f4d58=_0xbfc755[_0x27f141];return _0x4f4d58;}Object['defineProperty'](exports,a64_0x311ad9(0x1b8),{'value':!![]}),exports[a64_0x311ad9(0x203)]=void 0x0;const crypto_1=__importDefault(require(a64_0x311ad9(0x1ca))),node_fetch_1=__importDefault(require(a64_0x311ad9(0x1c4))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0x3a98e8){const _0x7d5dca=a64_0x311ad9;this['config']=_0x3a98e8,this[_0x7d5dca(0x1c2)]=path_1['default'][_0x7d5dca(0x200)](process[_0x7d5dca(0x1ef)](),'logs','squirrel-pay-webhooks.log');const _0x4567eb=path_1[_0x7d5dca(0x1fb)][_0x7d5dca(0x1de)](this[_0x7d5dca(0x1c2)]);!fs_1[_0x7d5dca(0x1fb)]['existsSync'](_0x4567eb)&&fs_1['default'][_0x7d5dca(0x1cd)](_0x4567eb,{'recursive':!![]});}[a64_0x311ad9(0x1f9)](){const _0x29b2cf=a64_0x311ad9,_0xeb82c1=this[_0x29b2cf(0x205)][_0x29b2cf(0x204)]+':'+this['config']['secretKey'];return Buffer[_0x29b2cf(0x1e5)](_0xeb82c1)['toString'](_0x29b2cf(0x1d1));}['generateRequestId'](){return crypto_1['default']['randomUUID']();}async[a64_0x311ad9(0x1c7)](_0x575be1,_0x3a28db,_0x54798b,_0x30aed0,_0x2871a3,_0x16e1b0,_0x15c5e4,_0xcf1cc,_0x53511e){const _0x9dc94d=a64_0x311ad9;console[_0x9dc94d(0x1d9)]('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console['log'](_0x9dc94d(0x1da)+_0x575be1+'\x20'+_0x3a28db),console['log'](_0x9dc94d(0x1c8)+_0x54798b),console[_0x9dc94d(0x1d9)](_0x9dc94d(0x1cf)+_0x15c5e4['email']+'\x20('+_0x15c5e4['ip']+')');const _0x127e57={'request':{'amount':_0x575be1,'currency':_0x3a28db,'description':_0x54798b,'gate_id':parseInt(this[_0x9dc94d(0x205)][_0x9dc94d(0x204)]),'return_url':_0x30aed0,'notification_url':_0x2871a3,'credit_card':_0x16e1b0,'customer':{'email':_0x15c5e4[_0x9dc94d(0x1cb)],'phone':_0x53511e,'birth_date':_0x15c5e4['birth_date'],'billing':_0xcf1cc},'test':this[_0x9dc94d(0x205)][_0x9dc94d(0x202)]}},_0x23df26=this['generateRequestId'](),_0x1b169a={'Authorization':_0x9dc94d(0x1d7)+this['getBasicAuth'](),'Content-Type':_0x9dc94d(0x1eb),'Accept':_0x9dc94d(0x1eb),'X-API-Version':'3','RequestID':_0x23df26};try{console['log'](_0x9dc94d(0x1dd)),console[_0x9dc94d(0x1d9)](_0x9dc94d(0x1ce)+_0x23df26),console[_0x9dc94d(0x1d9)](_0x9dc94d(0x1fc)+this[_0x9dc94d(0x205)][_0x9dc94d(0x209)]+_0x9dc94d(0x1f1)),console[_0x9dc94d(0x1d9)]('ðŸ”§\x20Headers:',JSON[_0x9dc94d(0x1d8)](_0x1b169a,null,0x2)),console[_0x9dc94d(0x1d9)](_0x9dc94d(0x1b7),JSON['stringify'](_0x127e57,null,0x2));const _0x33c711=await(0x0,node_fetch_1[_0x9dc94d(0x1fb)])(this['config']['baseUrl']+_0x9dc94d(0x1f1),{'method':_0x9dc94d(0x1d4),'headers':_0x1b169a,'body':JSON[_0x9dc94d(0x1d8)](_0x127e57)}),_0x173ac0=await _0x33c711['text']();console[_0x9dc94d(0x1d9)]('ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20'+_0x33c711[_0x9dc94d(0x1e0)]),console[_0x9dc94d(0x1d9)]('ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20'+_0x173ac0);if(!_0x33c711['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x33c711[_0x9dc94d(0x1e0)]+'\x20'+_0x33c711[_0x9dc94d(0x1fe)]+_0x9dc94d(0x1c1)+_0x173ac0);const _0x2460ba=JSON[_0x9dc94d(0x1f6)](_0x173ac0);return console[_0x9dc94d(0x1d9)]('âœ…\x20SquirrelPay\x20Response\x20Success:'),console[_0x9dc94d(0x1d9)](_0x9dc94d(0x1c5)+_0x2460ba[_0x9dc94d(0x1f3)]),console['log'](_0x9dc94d(0x20c)+_0x2460ba[_0x9dc94d(0x1e0)]),console['log'](_0x9dc94d(0x1e8)+_0x2460ba[_0x9dc94d(0x1f4)]),console[_0x9dc94d(0x1d9)]('\x20\x20\x20Message:\x20'+_0x2460ba[_0x9dc94d(0x20a)]),console['log'](_0x9dc94d(0x1d5)+_0x2460ba[_0x9dc94d(0x1f2)][_0x9dc94d(0x1fd)]),console[_0x9dc94d(0x1d9)]('\x20\x20\x20Last\x204:\x20'+_0x2460ba['payment_method']['last_4']),_0x2460ba[_0x9dc94d(0x1f5)]&&console[_0x9dc94d(0x1d9)](_0x9dc94d(0x1bb)+_0x2460ba[_0x9dc94d(0x1f5)]),_0x2460ba;}catch(_0x4b9653){console[_0x9dc94d(0x1bd)](_0x9dc94d(0x1db),_0x4b9653);throw _0x4b9653;}}[a64_0x311ad9(0x20b)](_0x2c7daf){const _0x11754b=a64_0x311ad9,_0x4c859f=_0x2c7daf[_0x11754b(0x1f3)],_0x4f16a0=_0x2c7daf[_0x11754b(0x1d0)]['last_4'];console[_0x11754b(0x1d9)](_0x11754b(0x1ea)+_0x2c7daf[_0x11754b(0x1e0)]);switch(_0x2c7daf['status']){case _0x11754b(0x1fa):return{'status':'PAID','gatewayPaymentId':_0x4c859f,'cardLast4':_0x4f16a0};case _0x11754b(0x20d):return{'status':_0x11754b(0x1d2),'gatewayPaymentId':_0x4c859f,'cardLast4':_0x4f16a0,'redirectUrl':_0x2c7daf[_0x11754b(0x1f5)]};case _0x11754b(0x1f8):const _0x4c6217=_0x2c7daf[_0x11754b(0x20a)]||'',_0x2acfcf=_0x2c7daf[_0x11754b(0x1ed)]||'';let _0x518d45='';if(_0x4c6217&&_0x2acfcf)_0x518d45=_0x4c6217+_0x11754b(0x206)+_0x2acfcf;else{if(_0x4c6217)_0x518d45=_0x4c6217;else _0x2acfcf?_0x518d45=_0x2acfcf:_0x518d45=_0x11754b(0x1d3);}return{'status':_0x11754b(0x1c9),'failureMessage':_0x518d45,'gatewayPaymentId':_0x4c859f,'cardLast4':_0x4f16a0};default:console[_0x11754b(0x1e7)](_0x11754b(0x208)+_0x2c7daf[_0x11754b(0x1e0)]);const _0x346534=_0x2c7daf[_0x11754b(0x20a)]||'',_0x5f071d=_0x2c7daf[_0x11754b(0x1ed)]||'';let _0x39bf51='';if(_0x346534&&_0x5f071d)_0x39bf51=_0x346534+_0x11754b(0x206)+_0x5f071d;else{if(_0x346534)_0x39bf51=_0x346534;else _0x5f071d?_0x39bf51=_0x5f071d:_0x39bf51='Unknown\x20error';}return{'status':_0x11754b(0x1c9),'failureMessage':_0x39bf51,'gatewayPaymentId':_0x4c859f,'cardLast4':_0x4f16a0};}}[a64_0x311ad9(0x1e4)](_0x2bc183){const _0x2c3d80=a64_0x311ad9,_0x1bc42f=new Date()[_0x2c3d80(0x1bf)](),_0x169c37={'timestamp':_0x1bc42f,'webhook':_0x2bc183,'source':_0x2c3d80(0x1f7)},_0xee33e4=JSON['stringify'](_0x169c37)+'\x0a';try{fs_1[_0x2c3d80(0x1fb)]['appendFileSync'](this[_0x2c3d80(0x1c2)],_0xee33e4),console[_0x2c3d80(0x1d9)](_0x2c3d80(0x1bc)+_0x1bc42f);}catch(_0x3742ff){console[_0x2c3d80(0x1bd)](_0x2c3d80(0x1d6),_0x3742ff);}}[a64_0x311ad9(0x1df)](_0x4a769c=0x32){const _0x149dc8=a64_0x311ad9;try{if(!fs_1['default']['existsSync'](this[_0x149dc8(0x1c2)]))return[];const _0x45dc41=fs_1['default']['readFileSync'](this['webhookLogPath'],_0x149dc8(0x207)),_0x517777=_0x45dc41['trim']()[_0x149dc8(0x1e3)]('\x0a')[_0x149dc8(0x1e6)](_0x3137aa=>_0x3137aa);return _0x517777[_0x149dc8(0x1be)](-_0x4a769c)[_0x149dc8(0x1ec)](_0x190177=>{const _0x4ae578=_0x149dc8;try{return JSON[_0x4ae578(0x1f6)](_0x190177);}catch{return null;}})['filter'](_0x75d812=>_0x75d812!==null);}catch(_0x38359b){return console[_0x149dc8(0x1bd)](_0x149dc8(0x1ff),_0x38359b),[];}}}exports['SquirrelPayService']=SquirrelPayService;