'use strict';const a68_0x38db63=a68_0x1390;(function(_0x118aea,_0x3cf0f2){const _0x55300e=a68_0x1390,_0x208d2d=_0x118aea();while(!![]){try{const _0x508555=parseInt(_0x55300e(0x115))/0x1*(parseInt(_0x55300e(0x166))/0x2)+parseInt(_0x55300e(0x14a))/0x3*(-parseInt(_0x55300e(0x118))/0x4)+-parseInt(_0x55300e(0x14d))/0x5*(-parseInt(_0x55300e(0x151))/0x6)+parseInt(_0x55300e(0x13a))/0x7*(-parseInt(_0x55300e(0x11d))/0x8)+parseInt(_0x55300e(0x174))/0x9+parseInt(_0x55300e(0x125))/0xa*(parseInt(_0x55300e(0x140))/0xb)+-parseInt(_0x55300e(0x133))/0xc*(parseInt(_0x55300e(0x14c))/0xd);if(_0x508555===_0x3cf0f2)break;else _0x208d2d['push'](_0x208d2d['shift']());}catch(_0x7fffd9){_0x208d2d['push'](_0x208d2d['shift']());}}}(a68_0x16a6,0xc503a));var __importDefault=this&&this[a68_0x38db63(0x159)]||function(_0x512427){const _0x9f7061=a68_0x38db63;return _0x512427&&_0x512427[_0x9f7061(0x121)]?_0x512427:{'default':_0x512427};};function a68_0x1390(_0x56bb0e,_0x4adfa4){_0x56bb0e=_0x56bb0e-0x115;const _0x16a6df=a68_0x16a6();let _0x139060=_0x16a6df[_0x56bb0e];return _0x139060;}Object[a68_0x38db63(0x11f)](exports,a68_0x38db63(0x121),{'value':!![]}),exports[a68_0x38db63(0x134)]=void 0x0;const crypto_1=__importDefault(require(a68_0x38db63(0x129))),node_fetch_1=__importDefault(require(a68_0x38db63(0x128))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x38db63(0x13c)));function a68_0x16a6(){const _0x3f4eb8=['failed','split','application/json','2658LuPuVM','default','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','payment_method','baseUrl','squirrel-pay','webhookLogPath','__importDefault','POST','isTestMode','âœ…\x20SquirrelPay\x20Response\x20Success:','appendFileSync','stringify','randomUUID','Payment\x20failed','friendly_message','transaction','\x20-\x20','\x20\x20\x20Last\x204:\x20','squirrel-pay-webhooks.log','18mPenmh','redirect_url','status','\x20||\x20','filter','successful','toString','warn','error','ðŸ”§\x20Headers:','parse','code','\x20\x20\x20Code:\x20','email','10113291bPrQvx','logWebhook','ðŸ“\x20Description:\x20','153739hIjckM','incomplete','Basic\x20','786404qQCIen','mkdirSync','uid','/transactions/payments','existsSync','1688072jJNiPZ','getBasicAuth','defineProperty','from','__esModule','dirname','last_4','slice','427940UKpelP','FAILED','getWebhookLogs','node-fetch','crypto','PENDING','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','log','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','cwd','ðŸ‘¤\x20Customer:\x20','processCardPayment','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','utf-8','8876220OzZARI','SquirrelPayService','message','trim','secretKey','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','42uzHxxV','\x20\x20\x20UID:\x20','path','generateRequestId','config','ðŸ’°\x20Amount:\x20','253UiQcXB','\x20\x20\x20Gateway\x20ID:\x20','SquirrelPay\x20API\x20error:\x20','\x20\x20\x20Status:\x20','ðŸ”„\x20Redirect\x20URL:\x20','shopId','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','Unknown\x20error','readFileSync','ðŸ“¦\x20Body:','3wwEsTK','text','26bJTHkC','2905DQjFJw'];a68_0x16a6=function(){return _0x3f4eb8;};return a68_0x16a6();}class SquirrelPayService{constructor(_0x3a8ebc){const _0x420192=a68_0x38db63;this['config']=_0x3a8ebc,this[_0x420192(0x158)]=path_1[_0x420192(0x152)]['join'](process[_0x420192(0x12e)](),'logs',_0x420192(0x165));const _0x83dfa9=path_1[_0x420192(0x152)][_0x420192(0x122)](this['webhookLogPath']);!fs_1['default'][_0x420192(0x11c)](_0x83dfa9)&&fs_1[_0x420192(0x152)][_0x420192(0x119)](_0x83dfa9,{'recursive':!![]});}[a68_0x38db63(0x11e)](){const _0x327684=a68_0x38db63,_0x41769a=this[_0x327684(0x13e)]['shopId']+':'+this[_0x327684(0x13e)][_0x327684(0x137)];return Buffer[_0x327684(0x120)](_0x41769a)[_0x327684(0x16c)]('base64');}[a68_0x38db63(0x13d)](){const _0x453620=a68_0x38db63;return crypto_1[_0x453620(0x152)][_0x453620(0x15f)]();}async[a68_0x38db63(0x130)](_0x3a883f,_0x395d01,_0x2bd176,_0x55a511,_0x531c0a,_0x249003,_0x588aa8,_0x3af6c4,_0x27b468){const _0x21aed5=a68_0x38db63;console[_0x21aed5(0x12c)](_0x21aed5(0x138)),console[_0x21aed5(0x12c)](_0x21aed5(0x13f)+_0x3a883f+'\x20'+_0x395d01),console[_0x21aed5(0x12c)](_0x21aed5(0x176)+_0x2bd176),console['log'](_0x21aed5(0x12f)+_0x588aa8[_0x21aed5(0x173)]+'\x20('+_0x588aa8['ip']+')');const _0x4da8ec={'request':{'amount':_0x3a883f,'currency':_0x395d01,'description':_0x2bd176,'gate_id':parseInt(this[_0x21aed5(0x13e)][_0x21aed5(0x145)]),'return_url':_0x55a511,'notification_url':_0x531c0a,'credit_card':_0x249003,'customer':{'email':_0x588aa8[_0x21aed5(0x173)],'phone':_0x27b468,'birth_date':_0x588aa8['birth_date'],'billing':_0x3af6c4},'test':this[_0x21aed5(0x13e)][_0x21aed5(0x15b)]}},_0x48b4fc=this['generateRequestId'](),_0x440149={'Authorization':_0x21aed5(0x117)+this[_0x21aed5(0x11e)](),'Content-Type':_0x21aed5(0x150),'Accept':_0x21aed5(0x150),'X-API-Version':'3','RequestID':_0x48b4fc};try{console[_0x21aed5(0x12c)](_0x21aed5(0x153)),console['log']('ðŸ“‹\x20Request\x20ID:\x20'+_0x48b4fc),console[_0x21aed5(0x12c)]('ðŸ”—\x20URL:\x20'+this[_0x21aed5(0x13e)][_0x21aed5(0x156)]+_0x21aed5(0x11b)),console[_0x21aed5(0x12c)](_0x21aed5(0x16f),JSON[_0x21aed5(0x15e)](_0x440149,null,0x2)),console['log'](_0x21aed5(0x149),JSON[_0x21aed5(0x15e)](_0x4da8ec,null,0x2));const _0x9999ff=await(0x0,node_fetch_1[_0x21aed5(0x152)])(this[_0x21aed5(0x13e)][_0x21aed5(0x156)]+_0x21aed5(0x11b),{'method':_0x21aed5(0x15a),'headers':_0x440149,'body':JSON[_0x21aed5(0x15e)](_0x4da8ec)}),_0x1f2da7=await _0x9999ff[_0x21aed5(0x14b)]();console[_0x21aed5(0x12c)](_0x21aed5(0x154)+_0x9999ff['status']),console[_0x21aed5(0x12c)](_0x21aed5(0x146)+_0x1f2da7);if(!_0x9999ff['ok'])throw new Error(_0x21aed5(0x142)+_0x9999ff[_0x21aed5(0x168)]+'\x20'+_0x9999ff['statusText']+_0x21aed5(0x163)+_0x1f2da7);const _0x9583b1=JSON[_0x21aed5(0x170)](_0x1f2da7);return console[_0x21aed5(0x12c)](_0x21aed5(0x15c)),console[_0x21aed5(0x12c)](_0x21aed5(0x13b)+_0x9583b1[_0x21aed5(0x11a)]),console[_0x21aed5(0x12c)](_0x21aed5(0x143)+_0x9583b1['status']),console[_0x21aed5(0x12c)](_0x21aed5(0x172)+_0x9583b1[_0x21aed5(0x171)]),console[_0x21aed5(0x12c)]('\x20\x20\x20Message:\x20'+_0x9583b1['friendly_message']),console[_0x21aed5(0x12c)](_0x21aed5(0x141)+_0x9583b1[_0x21aed5(0x162)]['gateway_id']),console[_0x21aed5(0x12c)](_0x21aed5(0x164)+_0x9583b1[_0x21aed5(0x155)][_0x21aed5(0x123)]),_0x9583b1['redirect_url']&&console[_0x21aed5(0x12c)](_0x21aed5(0x144)+_0x9583b1[_0x21aed5(0x167)]),_0x9583b1;}catch(_0x2f2721){console[_0x21aed5(0x16e)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x2f2721);throw _0x2f2721;}}['getPaymentStatus'](_0x37e48d){const _0x1b7f7d=a68_0x38db63,_0x395fac=_0x37e48d[_0x1b7f7d(0x11a)],_0x1607e1=_0x37e48d[_0x1b7f7d(0x155)][_0x1b7f7d(0x123)];console[_0x1b7f7d(0x12c)]('ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x37e48d[_0x1b7f7d(0x168)]);switch(_0x37e48d[_0x1b7f7d(0x168)]){case _0x1b7f7d(0x16b):return{'status':'PAID','gatewayPaymentId':_0x395fac,'cardLast4':_0x1607e1};case _0x1b7f7d(0x116):return{'status':_0x1b7f7d(0x12a),'gatewayPaymentId':_0x395fac,'cardLast4':_0x1607e1,'redirectUrl':_0x37e48d[_0x1b7f7d(0x167)]};case _0x1b7f7d(0x14e):const _0x421b5f=_0x37e48d[_0x1b7f7d(0x161)]||'',_0x482c49=_0x37e48d[_0x1b7f7d(0x135)]||'';let _0x9b9fb4='';if(_0x421b5f&&_0x482c49)_0x9b9fb4=_0x421b5f+_0x1b7f7d(0x169)+_0x482c49;else{if(_0x421b5f)_0x9b9fb4=_0x421b5f;else _0x482c49?_0x9b9fb4=_0x482c49:_0x9b9fb4=_0x1b7f7d(0x160);}return{'status':'FAILED','failureMessage':_0x9b9fb4,'gatewayPaymentId':_0x395fac,'cardLast4':_0x1607e1};default:console[_0x1b7f7d(0x16d)](_0x1b7f7d(0x131)+_0x37e48d[_0x1b7f7d(0x168)]);const _0x1f29f7=_0x37e48d[_0x1b7f7d(0x161)]||'',_0x35618a=_0x37e48d['message']||'';let _0x163946='';if(_0x1f29f7&&_0x35618a)_0x163946=_0x1f29f7+'\x20||\x20'+_0x35618a;else{if(_0x1f29f7)_0x163946=_0x1f29f7;else _0x35618a?_0x163946=_0x35618a:_0x163946=_0x1b7f7d(0x147);}return{'status':_0x1b7f7d(0x126),'failureMessage':_0x163946,'gatewayPaymentId':_0x395fac,'cardLast4':_0x1607e1};}}[a68_0x38db63(0x175)](_0x262581){const _0x2894b4=a68_0x38db63,_0x5db4c4=new Date()['toISOString'](),_0x5e6748={'timestamp':_0x5db4c4,'webhook':_0x262581,'source':_0x2894b4(0x157)},_0x58f586=JSON[_0x2894b4(0x15e)](_0x5e6748)+'\x0a';try{fs_1[_0x2894b4(0x152)][_0x2894b4(0x15d)](this[_0x2894b4(0x158)],_0x58f586),console[_0x2894b4(0x12c)](_0x2894b4(0x12b)+_0x5db4c4);}catch(_0x250c4f){console[_0x2894b4(0x16e)](_0x2894b4(0x12d),_0x250c4f);}}[a68_0x38db63(0x127)](_0x4589e4=0x32){const _0x8a1b1c=a68_0x38db63;try{if(!fs_1[_0x8a1b1c(0x152)]['existsSync'](this['webhookLogPath']))return[];const _0x56f463=fs_1[_0x8a1b1c(0x152)][_0x8a1b1c(0x148)](this[_0x8a1b1c(0x158)],_0x8a1b1c(0x132)),_0x5cbdd2=_0x56f463[_0x8a1b1c(0x136)]()[_0x8a1b1c(0x14f)]('\x0a')[_0x8a1b1c(0x16a)](_0x52c17e=>_0x52c17e);return _0x5cbdd2[_0x8a1b1c(0x124)](-_0x4589e4)['map'](_0x2d4759=>{const _0x38c215=_0x8a1b1c;try{return JSON[_0x38c215(0x170)](_0x2d4759);}catch{return null;}})['filter'](_0x3a79ef=>_0x3a79ef!==null);}catch(_0x4d07cd){return console[_0x8a1b1c(0x16e)](_0x8a1b1c(0x139),_0x4d07cd),[];}}}exports[a68_0x38db63(0x134)]=SquirrelPayService;