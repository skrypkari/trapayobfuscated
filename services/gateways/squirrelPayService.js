'use strict';const a70_0x130efb=a70_0x1b8f;(function(_0x572506,_0x1f3b36){const _0x260e64=a70_0x1b8f,_0x4ea741=_0x572506();while(!![]){try{const _0x111aae=parseInt(_0x260e64(0x1ab))/0x1*(parseInt(_0x260e64(0x173))/0x2)+parseInt(_0x260e64(0x199))/0x3+parseInt(_0x260e64(0x1b5))/0x4+parseInt(_0x260e64(0x19c))/0x5*(-parseInt(_0x260e64(0x172))/0x6)+parseInt(_0x260e64(0x1a8))/0x7+-parseInt(_0x260e64(0x179))/0x8+-parseInt(_0x260e64(0x190))/0x9*(-parseInt(_0x260e64(0x18c))/0xa);if(_0x111aae===_0x1f3b36)break;else _0x4ea741['push'](_0x4ea741['shift']());}catch(_0x3aff3c){_0x4ea741['push'](_0x4ea741['shift']());}}}(a70_0x37ea,0x29da5));function a70_0x1b8f(_0x413d2e,_0x1df961){_0x413d2e=_0x413d2e-0x168;const _0x37eac2=a70_0x37ea();let _0x1b8f8d=_0x37eac2[_0x413d2e];return _0x1b8f8d;}function a70_0x37ea(){const _0x420e76=['\x20\x20\x20UID:\x20','ðŸ‘¤\x20Customer:\x20','secretKey','split','FAILED','498sBdKQs','13978tsDerj','âœ…\x20SquirrelPay\x20Response\x20Success:','warn','mkdirSync','from','email','2251072qwfmJV','/transactions/payments','getWebhookLogs','uid','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','SquirrelPayService','webhookLogPath','log','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','code','randomUUID','\x20\x20\x20Code:\x20','existsSync','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','error','logs','redirect_url','10BPiJlr','generateRequestId','message','config','1698867gmEpMP','__esModule','Unknown\x20error','filter','statusText','last_4','\x20-\x20','application/json','\x20\x20\x20Gateway\x20ID:\x20','12498WMOIXf','squirrel-pay-webhooks.log','squirrel-pay','19435UPlhnz','âŒ\x20SquirrelPay\x20API\x20Error:','friendly_message','payment_method','default','ðŸ”§\x20Headers:','map','toISOString','getPaymentStatus','ðŸ“‹\x20Request\x20ID:\x20','successful','shopId','2147719yZzSPW','stringify','trim','32ZIfAfF','baseUrl','status','ðŸ’°\x20Amount:\x20','\x20\x20\x20Message:\x20','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','path','processCardPayment','appendFileSync','utf-8','208160LptJYp','\x20||\x20','parse','ðŸ“¦\x20Body:','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','text','\x20\x20\x20Last\x204:\x20','join','transaction','POST','getBasicAuth','crypto','__importDefault','birth_date','PENDING','ðŸ“\x20Description:\x20','toString','\x20\x20\x20Status:\x20','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:'];a70_0x37ea=function(){return _0x420e76;};return a70_0x37ea();}var __importDefault=this&&this[a70_0x130efb(0x1c1)]||function(_0x13c131){const _0x1eb4c1=a70_0x130efb;return _0x13c131&&_0x13c131[_0x1eb4c1(0x191)]?_0x13c131:{'default':_0x13c131};};Object['defineProperty'](exports,a70_0x130efb(0x191),{'value':!![]}),exports[a70_0x130efb(0x17e)]=void 0x0;const crypto_1=__importDefault(require(a70_0x130efb(0x1c0))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a70_0x130efb(0x1b1)));class SquirrelPayService{constructor(_0x290d26){const _0x22e4de=a70_0x130efb;this[_0x22e4de(0x18f)]=_0x290d26,this['webhookLogPath']=path_1[_0x22e4de(0x1a0)][_0x22e4de(0x1bc)](process['cwd'](),_0x22e4de(0x18a),_0x22e4de(0x19a));const _0x10d25e=path_1[_0x22e4de(0x1a0)]['dirname'](this[_0x22e4de(0x17f)]);!fs_1[_0x22e4de(0x1a0)]['existsSync'](_0x10d25e)&&fs_1[_0x22e4de(0x1a0)][_0x22e4de(0x176)](_0x10d25e,{'recursive':!![]});}[a70_0x130efb(0x1bf)](){const _0x301135=a70_0x130efb,_0x1b6b68=this[_0x301135(0x18f)][_0x301135(0x1a7)]+':'+this[_0x301135(0x18f)][_0x301135(0x16f)];return Buffer[_0x301135(0x177)](_0x1b6b68)[_0x301135(0x16a)]('base64');}[a70_0x130efb(0x18d)](){const _0x1b80b9=a70_0x130efb;return crypto_1['default'][_0x1b80b9(0x183)]();}async[a70_0x130efb(0x1b2)](_0x4e14c1,_0x133f48,_0x497278,_0x266bc7,_0x14f67a,_0xc7dc6e,_0x31b303,_0x3515d6,_0x3d5e9e){const _0x2520cc=a70_0x130efb;console[_0x2520cc(0x180)]('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console[_0x2520cc(0x180)](_0x2520cc(0x1ae)+_0x4e14c1+'\x20'+_0x133f48),console['log'](_0x2520cc(0x169)+_0x497278),console[_0x2520cc(0x180)](_0x2520cc(0x16e)+_0x31b303[_0x2520cc(0x178)]+'\x20('+_0x31b303['ip']+')');const _0x189adf={'request':{'amount':_0x4e14c1,'currency':_0x133f48,'description':_0x497278,'gate_id':parseInt(this[_0x2520cc(0x18f)]['shopId']),'return_url':_0x266bc7,'notification_url':_0x14f67a,'credit_card':_0xc7dc6e,'customer':{'email':_0x31b303['email'],'phone':_0x3d5e9e,'birth_date':_0x31b303[_0x2520cc(0x1c2)],'billing':_0x3515d6},'test':this[_0x2520cc(0x18f)]['isTestMode']}},_0x5a0b34=this[_0x2520cc(0x18d)](),_0x16d6d2={'Authorization':'Basic\x20'+this[_0x2520cc(0x1bf)](),'Content-Type':_0x2520cc(0x197),'Accept':_0x2520cc(0x197),'X-API-Version':'3','RequestID':_0x5a0b34};try{console['log'](_0x2520cc(0x17d)),console[_0x2520cc(0x180)](_0x2520cc(0x1a5)+_0x5a0b34),console['log']('ðŸ”—\x20URL:\x20'+this[_0x2520cc(0x18f)][_0x2520cc(0x1ac)]+_0x2520cc(0x17a)),console[_0x2520cc(0x180)](_0x2520cc(0x1a1),JSON[_0x2520cc(0x1a9)](_0x16d6d2,null,0x2)),console[_0x2520cc(0x180)](_0x2520cc(0x1b8),JSON[_0x2520cc(0x1a9)](_0x189adf,null,0x2));const _0x594963=await(0x0,node_fetch_1[_0x2520cc(0x1a0)])(this[_0x2520cc(0x18f)]['baseUrl']+_0x2520cc(0x17a),{'method':_0x2520cc(0x1be),'headers':_0x16d6d2,'body':JSON[_0x2520cc(0x1a9)](_0x189adf)}),_0x4a959b=await _0x594963[_0x2520cc(0x1ba)]();console[_0x2520cc(0x180)](_0x2520cc(0x1b9)+_0x594963['status']),console['log'](_0x2520cc(0x188)+_0x4a959b);if(!_0x594963['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x594963[_0x2520cc(0x1ad)]+'\x20'+_0x594963[_0x2520cc(0x194)]+_0x2520cc(0x196)+_0x4a959b);const _0x2cba15=JSON[_0x2520cc(0x1b7)](_0x4a959b);return console['log'](_0x2520cc(0x174)),console['log'](_0x2520cc(0x16d)+_0x2cba15[_0x2520cc(0x17c)]),console[_0x2520cc(0x180)](_0x2520cc(0x16b)+_0x2cba15[_0x2520cc(0x1ad)]),console[_0x2520cc(0x180)](_0x2520cc(0x184)+_0x2cba15[_0x2520cc(0x182)]),console[_0x2520cc(0x180)](_0x2520cc(0x1af)+_0x2cba15[_0x2520cc(0x19e)]),console['log'](_0x2520cc(0x198)+_0x2cba15[_0x2520cc(0x1bd)]['gateway_id']),console[_0x2520cc(0x180)](_0x2520cc(0x1bb)+_0x2cba15[_0x2520cc(0x19f)][_0x2520cc(0x195)]),_0x2cba15['redirect_url']&&console[_0x2520cc(0x180)]('ðŸ”„\x20Redirect\x20URL:\x20'+_0x2cba15[_0x2520cc(0x18b)]),_0x2cba15;}catch(_0x475353){console[_0x2520cc(0x189)](_0x2520cc(0x19d),_0x475353);throw _0x475353;}}[a70_0x130efb(0x1a4)](_0x3f7205){const _0x128756=a70_0x130efb,_0x18133b=_0x3f7205[_0x128756(0x17c)],_0x4f3ee9=_0x3f7205[_0x128756(0x19f)][_0x128756(0x195)];console[_0x128756(0x180)](_0x128756(0x1b0)+_0x3f7205[_0x128756(0x1ad)]);switch(_0x3f7205[_0x128756(0x1ad)]){case _0x128756(0x1a6):return{'status':'PAID','gatewayPaymentId':_0x18133b,'cardLast4':_0x4f3ee9};case'incomplete':return{'status':_0x128756(0x168),'gatewayPaymentId':_0x18133b,'cardLast4':_0x4f3ee9,'redirectUrl':_0x3f7205[_0x128756(0x18b)]};case'failed':const _0x21f84c=_0x3f7205[_0x128756(0x19e)]||'',_0x5e848d=_0x3f7205[_0x128756(0x18e)]||'';let _0x2c824b='';if(_0x21f84c&&_0x5e848d)_0x2c824b=_0x21f84c+_0x128756(0x1b6)+_0x5e848d;else{if(_0x21f84c)_0x2c824b=_0x21f84c;else _0x5e848d?_0x2c824b=_0x5e848d:_0x2c824b='Payment\x20failed';}return{'status':'FAILED','failureMessage':_0x2c824b,'gatewayPaymentId':_0x18133b,'cardLast4':_0x4f3ee9};default:console[_0x128756(0x175)](_0x128756(0x186)+_0x3f7205['status']);const _0x81d4=_0x3f7205[_0x128756(0x19e)]||'',_0x5d9121=_0x3f7205[_0x128756(0x18e)]||'';let _0x5808c8='';if(_0x81d4&&_0x5d9121)_0x5808c8=_0x81d4+'\x20||\x20'+_0x5d9121;else{if(_0x81d4)_0x5808c8=_0x81d4;else _0x5d9121?_0x5808c8=_0x5d9121:_0x5808c8=_0x128756(0x192);}return{'status':_0x128756(0x171),'failureMessage':_0x5808c8,'gatewayPaymentId':_0x18133b,'cardLast4':_0x4f3ee9};}}['logWebhook'](_0x564880){const _0x6ab38c=a70_0x130efb,_0x29301d=new Date()[_0x6ab38c(0x1a3)](),_0x2e133c={'timestamp':_0x29301d,'webhook':_0x564880,'source':_0x6ab38c(0x19b)},_0x255867=JSON[_0x6ab38c(0x1a9)](_0x2e133c)+'\x0a';try{fs_1['default'][_0x6ab38c(0x1b3)](this[_0x6ab38c(0x17f)],_0x255867),console[_0x6ab38c(0x180)](_0x6ab38c(0x181)+_0x29301d);}catch(_0x3dc8eb){console[_0x6ab38c(0x189)](_0x6ab38c(0x187),_0x3dc8eb);}}[a70_0x130efb(0x17b)](_0x3a22d2=0x32){const _0x4009bf=a70_0x130efb;try{if(!fs_1[_0x4009bf(0x1a0)][_0x4009bf(0x185)](this[_0x4009bf(0x17f)]))return[];const _0x44c82a=fs_1[_0x4009bf(0x1a0)]['readFileSync'](this['webhookLogPath'],_0x4009bf(0x1b4)),_0xb4d67=_0x44c82a[_0x4009bf(0x1aa)]()[_0x4009bf(0x170)]('\x0a')[_0x4009bf(0x193)](_0x383cf3=>_0x383cf3);return _0xb4d67['slice'](-_0x3a22d2)[_0x4009bf(0x1a2)](_0x252027=>{const _0x36ebbf=_0x4009bf;try{return JSON[_0x36ebbf(0x1b7)](_0x252027);}catch{return null;}})[_0x4009bf(0x193)](_0x585d22=>_0x585d22!==null);}catch(_0x47098e){return console[_0x4009bf(0x189)](_0x4009bf(0x16c),_0x47098e),[];}}}exports['SquirrelPayService']=SquirrelPayService;