'use strict';const a68_0x7568c6=a68_0x3b53;(function(_0x2b6f6b,_0x20ce28){const _0xa03c7e=a68_0x3b53,_0x449f91=_0x2b6f6b();while(!![]){try{const _0x12eeff=-parseInt(_0xa03c7e(0x1e7))/0x1*(parseInt(_0xa03c7e(0x1e0))/0x2)+parseInt(_0xa03c7e(0x1f6))/0x3+parseInt(_0xa03c7e(0x1b5))/0x4*(parseInt(_0xa03c7e(0x1e1))/0x5)+parseInt(_0xa03c7e(0x1da))/0x6*(parseInt(_0xa03c7e(0x1c4))/0x7)+-parseInt(_0xa03c7e(0x1dd))/0x8+parseInt(_0xa03c7e(0x1fb))/0x9*(parseInt(_0xa03c7e(0x1d6))/0xa)+parseInt(_0xa03c7e(0x1c9))/0xb*(-parseInt(_0xa03c7e(0x1ce))/0xc);if(_0x12eeff===_0x20ce28)break;else _0x449f91['push'](_0x449f91['shift']());}catch(_0xda83c1){_0x449f91['push'](_0x449f91['shift']());}}}(a68_0x3260,0xc2e30));var __importDefault=this&&this[a68_0x7568c6(0x1d3)]||function(_0x1e70e8){const _0xe110df=a68_0x7568c6;return _0x1e70e8&&_0x1e70e8[_0xe110df(0x1d2)]?_0x1e70e8:{'default':_0x1e70e8};};Object[a68_0x7568c6(0x1ed)](exports,a68_0x7568c6(0x1d2),{'value':!![]}),exports[a68_0x7568c6(0x1e3)]=void 0x0;const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require(a68_0x7568c6(0x1df))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0x1735ab){const _0x4f0e90=a68_0x7568c6;this[_0x4f0e90(0x1fc)]=_0x1735ab,this[_0x4f0e90(0x1ba)]=path_1['default'][_0x4f0e90(0x1b9)](process[_0x4f0e90(0x1ee)](),_0x4f0e90(0x1f8),'squirrel-pay-webhooks.log');const _0x49cc74=path_1[_0x4f0e90(0x1c3)][_0x4f0e90(0x1de)](this[_0x4f0e90(0x1ba)]);!fs_1[_0x4f0e90(0x1c3)][_0x4f0e90(0x1cd)](_0x49cc74)&&fs_1['default']['mkdirSync'](_0x49cc74,{'recursive':!![]});}[a68_0x7568c6(0x1be)](){const _0x2f8841=a68_0x7568c6,_0xdbf735=this[_0x2f8841(0x1fc)][_0x2f8841(0x1b4)]+':'+this[_0x2f8841(0x1fc)][_0x2f8841(0x1d0)];return Buffer[_0x2f8841(0x1fa)](_0xdbf735)['toString'](_0x2f8841(0x1a9));}['generateRequestId'](){const _0x51bba7=a68_0x7568c6;return crypto_1['default'][_0x51bba7(0x1bb)]();}async[a68_0x7568c6(0x1f2)](_0x261002,_0x469ee1,_0x2a386e,_0x253f7d,_0x5162f3,_0x2668d4,_0x125872,_0x2f8c7d,_0x5de30d){const _0x4f2eee=a68_0x7568c6;console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1b0)),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1ea)+_0x261002+'\x20'+_0x469ee1),console[_0x4f2eee(0x1c8)]('ğŸ“\x20Description:\x20'+_0x2a386e),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1cb)+_0x125872[_0x4f2eee(0x1ab)]+'\x20('+_0x125872['ip']+')');const _0x10b533={'request':{'amount':_0x261002,'currency':_0x469ee1,'description':_0x2a386e,'gate_id':parseInt(this[_0x4f2eee(0x1fc)][_0x4f2eee(0x1b4)]),'return_url':_0x253f7d,'notification_url':_0x5162f3,'credit_card':_0x2668d4,'customer':{'email':_0x125872[_0x4f2eee(0x1ab)],'phone':_0x5de30d,'birth_date':_0x125872[_0x4f2eee(0x1f9)],'billing':_0x2f8c7d},'test':this['config']['isTestMode']}},_0x77cc8f=this[_0x4f2eee(0x1b3)](),_0x428582={'Authorization':'Basic\x20'+this['getBasicAuth'](),'Content-Type':'application/json','Accept':_0x4f2eee(0x1eb),'X-API-Version':'3','RequestID':_0x77cc8f};try{console['log'](_0x4f2eee(0x1b2)),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1d8)+_0x77cc8f),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1cc)+this[_0x4f2eee(0x1fc)][_0x4f2eee(0x1b8)]+'/transactions/payments'),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1ad),JSON['stringify'](_0x428582,null,0x2)),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1f0),JSON[_0x4f2eee(0x1f7)](_0x10b533,null,0x2));const _0x5bfc49=await(0x0,node_fetch_1['default'])(this[_0x4f2eee(0x1fc)][_0x4f2eee(0x1b8)]+_0x4f2eee(0x1a3),{'method':_0x4f2eee(0x1f5),'headers':_0x428582,'body':JSON[_0x4f2eee(0x1f7)](_0x10b533)}),_0x5de2bf=await _0x5bfc49[_0x4f2eee(0x1b6)]();console['log'](_0x4f2eee(0x1a5)+_0x5bfc49[_0x4f2eee(0x1d7)]),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1ca)+_0x5de2bf);if(!_0x5bfc49['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x5bfc49[_0x4f2eee(0x1d7)]+'\x20'+_0x5bfc49[_0x4f2eee(0x1ec)]+_0x4f2eee(0x1c0)+_0x5de2bf);const _0x39dd1b=JSON['parse'](_0x5de2bf);return console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1a8)),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1a4)+_0x39dd1b['uid']),console[_0x4f2eee(0x1c8)]('\x20\x20\x20Status:\x20'+_0x39dd1b[_0x4f2eee(0x1d7)]),console[_0x4f2eee(0x1c8)]('\x20\x20\x20Code:\x20'+_0x39dd1b[_0x4f2eee(0x1e9)]),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1e5)+_0x39dd1b[_0x4f2eee(0x1ac)]),console[_0x4f2eee(0x1c8)](_0x4f2eee(0x1c5)+_0x39dd1b['transaction'][_0x4f2eee(0x1bc)]),console[_0x4f2eee(0x1c8)]('\x20\x20\x20Last\x204:\x20'+_0x39dd1b['payment_method']['last_4']),_0x39dd1b['redirect_url']&&console[_0x4f2eee(0x1c8)]('ğŸ”„\x20Redirect\x20URL:\x20'+_0x39dd1b[_0x4f2eee(0x1bd)]),_0x39dd1b;}catch(_0x5ca5b3){console[_0x4f2eee(0x1db)](_0x4f2eee(0x1ef),_0x5ca5b3);throw _0x5ca5b3;}}[a68_0x7568c6(0x1f1)](_0x5f44eb){const _0x4d63c4=a68_0x7568c6,_0x1fb5f8=_0x5f44eb[_0x4d63c4(0x1c1)],_0x501630=_0x5f44eb[_0x4d63c4(0x1f3)]['last_4'];console[_0x4d63c4(0x1c8)]('ğŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x5f44eb[_0x4d63c4(0x1d7)]);switch(_0x5f44eb[_0x4d63c4(0x1d7)]){case'successful':return{'status':_0x4d63c4(0x1b1),'gatewayPaymentId':_0x1fb5f8,'cardLast4':_0x501630};case _0x4d63c4(0x1e6):return{'status':'PENDING','gatewayPaymentId':_0x1fb5f8,'cardLast4':_0x501630,'redirectUrl':_0x5f44eb['redirect_url']};case _0x4d63c4(0x1e8):const _0x5566fa=_0x5f44eb[_0x4d63c4(0x1ac)]||'',_0x2715cc=_0x5f44eb[_0x4d63c4(0x1d4)]||'';let _0x23adaf='';if(_0x5566fa&&_0x2715cc)_0x23adaf=_0x5566fa+_0x4d63c4(0x1cf)+_0x2715cc;else{if(_0x5566fa)_0x23adaf=_0x5566fa;else _0x2715cc?_0x23adaf=_0x2715cc:_0x23adaf=_0x4d63c4(0x1c7);}return{'status':_0x4d63c4(0x1c6),'failureMessage':_0x23adaf,'gatewayPaymentId':_0x1fb5f8,'cardLast4':_0x501630};default:console[_0x4d63c4(0x1a7)](_0x4d63c4(0x1aa)+_0x5f44eb[_0x4d63c4(0x1d7)]);const _0xbb5bff=_0x5f44eb[_0x4d63c4(0x1ac)]||'',_0x1809bf=_0x5f44eb[_0x4d63c4(0x1d4)]||'';let _0x26b1b6='';if(_0xbb5bff&&_0x1809bf)_0x26b1b6=_0xbb5bff+_0x4d63c4(0x1cf)+_0x1809bf;else{if(_0xbb5bff)_0x26b1b6=_0xbb5bff;else _0x1809bf?_0x26b1b6=_0x1809bf:_0x26b1b6=_0x4d63c4(0x1dc);}return{'status':_0x4d63c4(0x1c6),'failureMessage':_0x26b1b6,'gatewayPaymentId':_0x1fb5f8,'cardLast4':_0x501630};}}[a68_0x7568c6(0x1af)](_0x39586e){const _0x44bb99=a68_0x7568c6,_0xfdd466=new Date()[_0x44bb99(0x1d9)](),_0x906b74={'timestamp':_0xfdd466,'webhook':_0x39586e,'source':_0x44bb99(0x1f4)},_0x1b4063=JSON['stringify'](_0x906b74)+'\x0a';try{fs_1['default'][_0x44bb99(0x1a6)](this[_0x44bb99(0x1ba)],_0x1b4063),console[_0x44bb99(0x1c8)]('ğŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0xfdd466);}catch(_0x577837){console['error'](_0x44bb99(0x1e2),_0x577837);}}['getWebhookLogs'](_0x12e0a5=0x32){const _0x145237=a68_0x7568c6;try{if(!fs_1[_0x145237(0x1c3)][_0x145237(0x1cd)](this['webhookLogPath']))return[];const _0x3c6c37=fs_1[_0x145237(0x1c3)][_0x145237(0x1bf)](this['webhookLogPath'],'utf-8'),_0x42bbfb=_0x3c6c37[_0x145237(0x1d1)]()[_0x145237(0x1d5)]('\x0a')[_0x145237(0x1e4)](_0x4470cd=>_0x4470cd);return _0x42bbfb['slice'](-_0x12e0a5)[_0x145237(0x1c2)](_0x36a1c9=>{const _0x23cb3f=_0x145237;try{return JSON[_0x23cb3f(0x1b7)](_0x36a1c9);}catch{return null;}})[_0x145237(0x1e4)](_0x32be65=>_0x32be65!==null);}catch(_0x3ef4c1){return console[_0x145237(0x1db)](_0x145237(0x1ae),_0x3ef4c1),[];}}}exports[a68_0x7568c6(0x1e3)]=SquirrelPayService;function a68_0x3b53(_0x58c97b,_0x43a64e){_0x58c97b=_0x58c97b-0x1a3;const _0x32604b=a68_0x3260();let _0x3b53c2=_0x32604b[_0x58c97b];return _0x3b53c2;}function a68_0x3260(){const _0x19019e=['error','Unknown\x20error','12733024dNnSrQ','dirname','node-fetch','13966PCSiRh','4535fZTWbY','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','SquirrelPayService','filter','\x20\x20\x20Message:\x20','incomplete','100yjossB','failed','code','ğŸ’°\x20Amount:\x20','application/json','statusText','defineProperty','cwd','âŒ\x20SquirrelPay\x20API\x20Error:','ğŸ“¦\x20Body:','getPaymentStatus','processCardPayment','payment_method','squirrel-pay','POST','938121RdIvon','stringify','logs','birth_date','from','13466367TUwqoJ','config','/transactions/payments','\x20\x20\x20UID:\x20','ğŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','appendFileSync','warn','âœ…\x20SquirrelPay\x20Response\x20Success:','base64','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','email','friendly_message','ğŸ”§\x20Headers:','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','logWebhook','ğŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','PAID','ğŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','generateRequestId','shopId','6244KJNBjM','text','parse','baseUrl','join','webhookLogPath','randomUUID','gateway_id','redirect_url','getBasicAuth','readFileSync','\x20-\x20','uid','map','default','7yzYdzn','\x20\x20\x20Gateway\x20ID:\x20','FAILED','Payment\x20failed','log','11PgRFDt','ğŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','ğŸ‘¤\x20Customer:\x20','ğŸ”—\x20URL:\x20','existsSync','7453812FeyQDx','\x20||\x20','secretKey','trim','__esModule','__importDefault','message','split','10IarDDv','status','ğŸ“‹\x20Request\x20ID:\x20','toISOString','2907228IYnltN'];a68_0x3260=function(){return _0x19019e;};return a68_0x3260();}