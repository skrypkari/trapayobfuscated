'use strict';const a76_0x4686da=a76_0x596f;(function(_0x4afe88,_0x4f4079){const _0x418262=a76_0x596f,_0x26dffd=_0x4afe88();while(!![]){try{const _0x1dbb4d=parseInt(_0x418262(0x22f))/0x1*(-parseInt(_0x418262(0x22e))/0x2)+-parseInt(_0x418262(0x21d))/0x3+-parseInt(_0x418262(0x228))/0x4*(-parseInt(_0x418262(0x227))/0x5)+-parseInt(_0x418262(0x213))/0x6+parseInt(_0x418262(0x1f7))/0x7*(-parseInt(_0x418262(0x1f8))/0x8)+parseInt(_0x418262(0x217))/0x9*(parseInt(_0x418262(0x1f0))/0xa)+parseInt(_0x418262(0x216))/0xb;if(_0x1dbb4d===_0x4f4079)break;else _0x26dffd['push'](_0x26dffd['shift']());}catch(_0xe6a3a0){_0x26dffd['push'](_0x26dffd['shift']());}}}(a76_0x2a95,0xb622f));var __importDefault=this&&this['__importDefault']||function(_0x48575e){const _0x516de3=a76_0x596f;return _0x48575e&&_0x48575e[_0x516de3(0x221)]?_0x48575e:{'default':_0x48575e};};function a76_0x2a95(){const _0x58bbc7=['base64','getBasicAuth','377080ZxqnIC','2jjwBez','âœ…\x20SquirrelPay\x20Response\x20Success:','secretKey','last_4','processCardPayment','ðŸ”„\x20Redirect\x20URL:\x20','slice','toISOString','join','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','split','redirect_url','path','logWebhook','SquirrelPayService','toString','trim','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','config','crypto','text','statusText','POST','\x20\x20\x20Status:\x20','30CgrNRT','squirrel-pay','dirname','Basic\x20','status','message','ðŸ”—\x20URL:\x20','294wpYcKB','213704hivUbx','error','incomplete','baseUrl','ðŸ“¦\x20Body:','mkdirSync','isTestMode','âŒ\x20SquirrelPay\x20API\x20Error:','transaction','successful','failed','defineProperty','parse','shopId','generateRequestId','getWebhookLogs','log','uid','birth_date','webhookLogPath','code','filter','\x20-\x20','payment_method','ðŸ’°\x20Amount:\x20','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','ðŸ“\x20Description:\x20','2021868hahTyl','default','ðŸ“‹\x20Request\x20ID:\x20','29937842VsKIUr','1606158LsIuNQ','email','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','/transactions/payments','\x20\x20\x20Gateway\x20ID:\x20','utf-8','4265856eohoRB','stringify','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','\x20||\x20','__esModule','Payment\x20failed','randomUUID','\x20\x20\x20UID:\x20','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','FAILED','1244965UpUIBu','12Oamknc','ðŸ‘¤\x20Customer:\x20','PENDING','map'];a76_0x2a95=function(){return _0x58bbc7;};return a76_0x2a95();}function a76_0x596f(_0x4629c5,_0xf1a181){_0x4629c5=_0x4629c5-0x1dd;const _0x2a95af=a76_0x2a95();let _0x596fe5=_0x2a95af[_0x4629c5];return _0x596fe5;}Object[a76_0x4686da(0x203)](exports,a76_0x4686da(0x221),{'value':!![]}),exports[a76_0x4686da(0x1e6)]=void 0x0;const crypto_1=__importDefault(require(a76_0x4686da(0x1eb))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x4686da(0x1e4)));class SquirrelPayService{constructor(_0x42d449){const _0x191d4f=a76_0x4686da;this[_0x191d4f(0x1ea)]=_0x42d449,this[_0x191d4f(0x20b)]=path_1['default'][_0x191d4f(0x1e0)](process['cwd'](),'logs','squirrel-pay-webhooks.log');const _0x5c1575=path_1[_0x191d4f(0x214)][_0x191d4f(0x1f2)](this['webhookLogPath']);!fs_1[_0x191d4f(0x214)]['existsSync'](_0x5c1575)&&fs_1[_0x191d4f(0x214)][_0x191d4f(0x1fd)](_0x5c1575,{'recursive':!![]});}[a76_0x4686da(0x22d)](){const _0xcc134b=a76_0x4686da,_0x929525=this[_0xcc134b(0x1ea)][_0xcc134b(0x205)]+':'+this['config'][_0xcc134b(0x231)];return Buffer['from'](_0x929525)[_0xcc134b(0x1e7)](_0xcc134b(0x22c));}['generateRequestId'](){const _0xc02dcc=a76_0x4686da;return crypto_1[_0xc02dcc(0x214)][_0xc02dcc(0x223)]();}async[a76_0x4686da(0x233)](_0x158592,_0x3047b7,_0x3d4267,_0x5af742,_0x3b8223,_0xe1f5cd,_0x59a09d,_0x4d1254,_0x341c62){const _0x33c2e5=a76_0x4686da;console[_0x33c2e5(0x208)](_0x33c2e5(0x219)),console['log'](_0x33c2e5(0x210)+_0x158592+'\x20'+_0x3047b7),console[_0x33c2e5(0x208)](_0x33c2e5(0x212)+_0x3d4267),console[_0x33c2e5(0x208)](_0x33c2e5(0x229)+_0x59a09d[_0x33c2e5(0x218)]+'\x20('+_0x59a09d['ip']+')');const _0x5565b4={'request':{'amount':_0x158592,'currency':_0x3047b7,'description':_0x3d4267,'gate_id':parseInt(this[_0x33c2e5(0x1ea)][_0x33c2e5(0x205)]),'return_url':_0x5af742,'notification_url':_0x3b8223,'credit_card':_0xe1f5cd,'customer':{'email':_0x59a09d[_0x33c2e5(0x218)],'phone':_0x341c62,'birth_date':_0x59a09d[_0x33c2e5(0x20a)],'billing':_0x4d1254},'test':this[_0x33c2e5(0x1ea)][_0x33c2e5(0x1fe)]}},_0x511f79=this[_0x33c2e5(0x206)](),_0x5ae874={'Authorization':_0x33c2e5(0x1f3)+this[_0x33c2e5(0x22d)](),'Content-Type':'application/json','Accept':'application/json','X-API-Version':'3','RequestID':_0x511f79};try{console['log'](_0x33c2e5(0x1e1)),console[_0x33c2e5(0x208)](_0x33c2e5(0x215)+_0x511f79),console[_0x33c2e5(0x208)](_0x33c2e5(0x1f6)+this['config'][_0x33c2e5(0x1fb)]+_0x33c2e5(0x21a)),console[_0x33c2e5(0x208)]('ðŸ”§\x20Headers:',JSON[_0x33c2e5(0x21e)](_0x5ae874,null,0x2)),console[_0x33c2e5(0x208)](_0x33c2e5(0x1fc),JSON[_0x33c2e5(0x21e)](_0x5565b4,null,0x2));const _0x3c422a=await(0x0,node_fetch_1[_0x33c2e5(0x214)])(this['config'][_0x33c2e5(0x1fb)]+_0x33c2e5(0x21a),{'method':_0x33c2e5(0x1ee),'headers':_0x5ae874,'body':JSON[_0x33c2e5(0x21e)](_0x5565b4)}),_0xe6d680=await _0x3c422a[_0x33c2e5(0x1ec)]();console[_0x33c2e5(0x208)](_0x33c2e5(0x225)+_0x3c422a[_0x33c2e5(0x1f4)]),console[_0x33c2e5(0x208)]('ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20'+_0xe6d680);if(!_0x3c422a['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x3c422a[_0x33c2e5(0x1f4)]+'\x20'+_0x3c422a[_0x33c2e5(0x1ed)]+_0x33c2e5(0x20e)+_0xe6d680);const _0x1a84e1=JSON[_0x33c2e5(0x204)](_0xe6d680);return console[_0x33c2e5(0x208)](_0x33c2e5(0x230)),console['log'](_0x33c2e5(0x224)+_0x1a84e1['uid']),console[_0x33c2e5(0x208)](_0x33c2e5(0x1ef)+_0x1a84e1[_0x33c2e5(0x1f4)]),console[_0x33c2e5(0x208)]('\x20\x20\x20Code:\x20'+_0x1a84e1[_0x33c2e5(0x20c)]),console[_0x33c2e5(0x208)]('\x20\x20\x20Message:\x20'+_0x1a84e1['friendly_message']),console[_0x33c2e5(0x208)](_0x33c2e5(0x21b)+_0x1a84e1[_0x33c2e5(0x200)]['gateway_id']),console[_0x33c2e5(0x208)]('\x20\x20\x20Last\x204:\x20'+_0x1a84e1[_0x33c2e5(0x20f)][_0x33c2e5(0x232)]),_0x1a84e1['redirect_url']&&console[_0x33c2e5(0x208)](_0x33c2e5(0x1dd)+_0x1a84e1[_0x33c2e5(0x1e3)]),_0x1a84e1;}catch(_0x1cd823){console['error'](_0x33c2e5(0x1ff),_0x1cd823);throw _0x1cd823;}}['getPaymentStatus'](_0x975699){const _0x3bd739=a76_0x4686da,_0x200020=_0x975699[_0x3bd739(0x209)],_0x5ad607=_0x975699[_0x3bd739(0x20f)][_0x3bd739(0x232)];console['log'](_0x3bd739(0x211)+_0x975699['status']);switch(_0x975699[_0x3bd739(0x1f4)]){case _0x3bd739(0x201):return{'status':'PAID','gatewayPaymentId':_0x200020,'cardLast4':_0x5ad607};case _0x3bd739(0x1fa):return{'status':_0x3bd739(0x22a),'gatewayPaymentId':_0x200020,'cardLast4':_0x5ad607,'redirectUrl':_0x975699['redirect_url']};case _0x3bd739(0x202):const _0x118f33=_0x975699['friendly_message']||'',_0x2553b8=_0x975699[_0x3bd739(0x1f5)]||'';let _0x1f611f='';if(_0x118f33&&_0x2553b8)_0x1f611f=_0x118f33+'\x20||\x20'+_0x2553b8;else{if(_0x118f33)_0x1f611f=_0x118f33;else _0x2553b8?_0x1f611f=_0x2553b8:_0x1f611f=_0x3bd739(0x222);}return{'status':'FAILED','failureMessage':_0x1f611f,'gatewayPaymentId':_0x200020,'cardLast4':_0x5ad607};default:console['warn'](_0x3bd739(0x1e9)+_0x975699[_0x3bd739(0x1f4)]);const _0x3bd0e2=_0x975699['friendly_message']||'',_0x48800a=_0x975699[_0x3bd739(0x1f5)]||'';let _0x460423='';if(_0x3bd0e2&&_0x48800a)_0x460423=_0x3bd0e2+_0x3bd739(0x220)+_0x48800a;else{if(_0x3bd0e2)_0x460423=_0x3bd0e2;else _0x48800a?_0x460423=_0x48800a:_0x460423='Unknown\x20error';}return{'status':_0x3bd739(0x226),'failureMessage':_0x460423,'gatewayPaymentId':_0x200020,'cardLast4':_0x5ad607};}}[a76_0x4686da(0x1e5)](_0x4a1205){const _0x3d73c8=a76_0x4686da,_0x46783c=new Date()[_0x3d73c8(0x1df)](),_0x5e0913={'timestamp':_0x46783c,'webhook':_0x4a1205,'source':_0x3d73c8(0x1f1)},_0x21d589=JSON['stringify'](_0x5e0913)+'\x0a';try{fs_1['default']['appendFileSync'](this[_0x3d73c8(0x20b)],_0x21d589),console[_0x3d73c8(0x208)]('ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x46783c);}catch(_0x5373d9){console['error']('âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:',_0x5373d9);}}[a76_0x4686da(0x207)](_0xef8b8=0x32){const _0x1a2bbf=a76_0x4686da;try{if(!fs_1[_0x1a2bbf(0x214)]['existsSync'](this[_0x1a2bbf(0x20b)]))return[];const _0x2a2846=fs_1[_0x1a2bbf(0x214)]['readFileSync'](this[_0x1a2bbf(0x20b)],_0x1a2bbf(0x21c)),_0x2fc132=_0x2a2846[_0x1a2bbf(0x1e8)]()[_0x1a2bbf(0x1e2)]('\x0a')[_0x1a2bbf(0x20d)](_0x558202=>_0x558202);return _0x2fc132[_0x1a2bbf(0x1de)](-_0xef8b8)[_0x1a2bbf(0x22b)](_0x4cb1a0=>{const _0x293c49=_0x1a2bbf;try{return JSON[_0x293c49(0x204)](_0x4cb1a0);}catch{return null;}})['filter'](_0x3071a2=>_0x3071a2!==null);}catch(_0x2f573f){return console[_0x1a2bbf(0x1f9)](_0x1a2bbf(0x21f),_0x2f573f),[];}}}exports['SquirrelPayService']=SquirrelPayService;