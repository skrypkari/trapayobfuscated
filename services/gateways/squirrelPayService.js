'use strict';const a64_0x5f0f99=a64_0x5d14;(function(_0x438d45,_0x32656c){const _0x48f5a9=a64_0x5d14,_0x5ccc67=_0x438d45();while(!![]){try{const _0x11ecf1=-parseInt(_0x48f5a9(0x160))/0x1+parseInt(_0x48f5a9(0x140))/0x2+-parseInt(_0x48f5a9(0x144))/0x3+parseInt(_0x48f5a9(0x15d))/0x4+-parseInt(_0x48f5a9(0x110))/0x5*(parseInt(_0x48f5a9(0x13c))/0x6)+-parseInt(_0x48f5a9(0x113))/0x7+parseInt(_0x48f5a9(0x152))/0x8;if(_0x11ecf1===_0x32656c)break;else _0x5ccc67['push'](_0x5ccc67['shift']());}catch(_0x89fa29){_0x5ccc67['push'](_0x5ccc67['shift']());}}}(a64_0x3062,0xb190c));var __importDefault=this&&this['__importDefault']||function(_0x3891cc){const _0x2b6203=a64_0x5d14;return _0x3891cc&&_0x3891cc[_0x2b6203(0x141)]?_0x3891cc:{'default':_0x3891cc};};Object[a64_0x5f0f99(0x11b)](exports,a64_0x5f0f99(0x141),{'value':!![]}),exports['SquirrelPayService']=void 0x0;function a64_0x5d14(_0x3cb1bb,_0x96e1c2){_0x3cb1bb=_0x3cb1bb-0x10d;const _0x306287=a64_0x3062();let _0x5d140d=_0x306287[_0x3cb1bb];return _0x5d140d;}const crypto_1=__importDefault(require(a64_0x5f0f99(0x150))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x5f0f99(0x13b)));function a64_0x3062(){const _0x578af5=['stringify','squirrel-pay-webhooks.log','defineProperty','toISOString','join','getWebhookLogs','warn','dirname','uid','Basic\x20','payment_method','friendly_message','‚ùå\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','üìù\x20Description:\x20','webhookLogPath','SquirrelPay\x20API\x20error:\x20','cwd','üêøÔ∏è\x20SquirrelPay:\x20Processing\x20card\x20payment','failed','logs','slice','\x20\x20\x20UID:\x20','/transactions/payments','successful','üí∞\x20Amount:\x20','generateRequestId','last_4','isTestMode','SquirrelPayService','PENDING','utf-8','error','üîç\x20Processing\x20SquirrelPay\x20status:\x20','\x20\x20\x20Message:\x20','path','18kJSVqC','config','\x20\x20\x20Status:\x20','üîß\x20Headers:','1186860diPKNZ','__esModule','shopId','default','831333taOAqN','üìù\x20SquirrelPay\x20webhook\x20logged:\x20','POST','\x20\x20\x20Gateway\x20ID:\x20','Unknown\x20error','split','message','incomplete','getBasicAuth','FAILED','transaction','trim','crypto','email','25969824zULwrF','birth_date','üì•\x20SquirrelPay\x20Response\x20Status:\x20','existsSync','toString','map','status','processCardPayment','\x20||\x20','redirect_url','‚ùå\x20SquirrelPay\x20API\x20Error:','459100BIkzCK','Payment\x20failed','log','1428785UJtXdD','mkdirSync','getPaymentStatus','üîó\x20URL:\x20','squirrel-pay','\x20\x20\x20Last\x204:\x20','statusText','code','üìã\x20Request\x20ID:\x20','gateway_id','1814565HswPCY','parse','text','3027430FUrjMY','from','‚ö†Ô∏è\x20Unknown\x20SquirrelPay\x20status:\x20','filter','randomUUID','üìÑ\x20SquirrelPay\x20Response\x20Body:\x20'];a64_0x3062=function(){return _0x578af5;};return a64_0x3062();}class SquirrelPayService{constructor(_0x19c1ff){const _0x54f245=a64_0x5f0f99;this['config']=_0x19c1ff,this[_0x54f245(0x127)]=path_1['default'][_0x54f245(0x11d)](process[_0x54f245(0x129)](),_0x54f245(0x12c),_0x54f245(0x11a));const _0x405bb5=path_1[_0x54f245(0x143)][_0x54f245(0x120)](this[_0x54f245(0x127)]);!fs_1[_0x54f245(0x143)][_0x54f245(0x155)](_0x405bb5)&&fs_1[_0x54f245(0x143)][_0x54f245(0x161)](_0x405bb5,{'recursive':!![]});}[a64_0x5f0f99(0x14c)](){const _0x3e15c2=a64_0x5f0f99,_0x56de6c=this[_0x3e15c2(0x13d)]['shopId']+':'+this[_0x3e15c2(0x13d)]['secretKey'];return Buffer[_0x3e15c2(0x114)](_0x56de6c)[_0x3e15c2(0x156)]('base64');}[a64_0x5f0f99(0x132)](){const _0x38d0e4=a64_0x5f0f99;return crypto_1[_0x38d0e4(0x143)][_0x38d0e4(0x117)]();}async[a64_0x5f0f99(0x159)](_0xfe2f02,_0x596ef3,_0x4db44b,_0x285134,_0x335ed6,_0xed6668,_0xdba176,_0x17ecc5,_0x2b656f){const _0x32d496=a64_0x5f0f99;console[_0x32d496(0x15f)](_0x32d496(0x12a)),console['log'](_0x32d496(0x131)+_0xfe2f02+'\x20'+_0x596ef3),console['log'](_0x32d496(0x126)+_0x4db44b),console[_0x32d496(0x15f)]('üë§\x20Customer:\x20'+_0xdba176[_0x32d496(0x151)]+'\x20('+_0xdba176['ip']+')');const _0x3fc451={'request':{'amount':_0xfe2f02,'currency':_0x596ef3,'description':_0x4db44b,'gate_id':parseInt(this['config'][_0x32d496(0x142)]),'return_url':_0x285134,'notification_url':_0x335ed6,'credit_card':_0xed6668,'customer':{'email':_0xdba176['email'],'phone':_0x2b656f,'birth_date':_0xdba176[_0x32d496(0x153)],'billing':_0x17ecc5},'test':this[_0x32d496(0x13d)][_0x32d496(0x134)]}},_0x307ad4=this[_0x32d496(0x132)](),_0x12950b={'Authorization':_0x32d496(0x122)+this['getBasicAuth'](),'Content-Type':'application/json','Accept':'application/json','X-API-Version':'3','RequestID':_0x307ad4};try{console[_0x32d496(0x15f)]('üåê\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x32d496(0x15f)](_0x32d496(0x10e)+_0x307ad4),console[_0x32d496(0x15f)](_0x32d496(0x163)+this[_0x32d496(0x13d)]['baseUrl']+_0x32d496(0x12f)),console[_0x32d496(0x15f)](_0x32d496(0x13f),JSON[_0x32d496(0x119)](_0x12950b,null,0x2)),console['log']('üì¶\x20Body:',JSON[_0x32d496(0x119)](_0x3fc451,null,0x2));const _0x310152=await(0x0,node_fetch_1['default'])(this[_0x32d496(0x13d)]['baseUrl']+_0x32d496(0x12f),{'method':_0x32d496(0x146),'headers':_0x12950b,'body':JSON[_0x32d496(0x119)](_0x3fc451)}),_0xc8ecf5=await _0x310152[_0x32d496(0x112)]();console[_0x32d496(0x15f)](_0x32d496(0x154)+_0x310152[_0x32d496(0x158)]),console[_0x32d496(0x15f)](_0x32d496(0x118)+_0xc8ecf5);if(!_0x310152['ok'])throw new Error(_0x32d496(0x128)+_0x310152[_0x32d496(0x158)]+'\x20'+_0x310152[_0x32d496(0x166)]+'\x20-\x20'+_0xc8ecf5);const _0x5934a3=JSON[_0x32d496(0x111)](_0xc8ecf5);return console[_0x32d496(0x15f)]('‚úÖ\x20SquirrelPay\x20Response\x20Success:'),console['log'](_0x32d496(0x12e)+_0x5934a3[_0x32d496(0x121)]),console[_0x32d496(0x15f)](_0x32d496(0x13e)+_0x5934a3[_0x32d496(0x158)]),console[_0x32d496(0x15f)]('\x20\x20\x20Code:\x20'+_0x5934a3[_0x32d496(0x10d)]),console[_0x32d496(0x15f)](_0x32d496(0x13a)+_0x5934a3[_0x32d496(0x124)]),console[_0x32d496(0x15f)](_0x32d496(0x147)+_0x5934a3[_0x32d496(0x14e)][_0x32d496(0x10f)]),console[_0x32d496(0x15f)](_0x32d496(0x165)+_0x5934a3[_0x32d496(0x123)][_0x32d496(0x133)]),_0x5934a3[_0x32d496(0x15b)]&&console[_0x32d496(0x15f)]('üîÑ\x20Redirect\x20URL:\x20'+_0x5934a3[_0x32d496(0x15b)]),_0x5934a3;}catch(_0x2d3e6d){console[_0x32d496(0x138)](_0x32d496(0x15c),_0x2d3e6d);throw _0x2d3e6d;}}[a64_0x5f0f99(0x162)](_0x5b011c){const _0x27f917=a64_0x5f0f99,_0x241a57=_0x5b011c['uid'],_0x16b6af=_0x5b011c['payment_method']['last_4'];console['log'](_0x27f917(0x139)+_0x5b011c[_0x27f917(0x158)]);switch(_0x5b011c['status']){case _0x27f917(0x130):return{'status':'PAID','gatewayPaymentId':_0x241a57,'cardLast4':_0x16b6af};case _0x27f917(0x14b):return{'status':_0x27f917(0x136),'gatewayPaymentId':_0x241a57,'cardLast4':_0x16b6af,'redirectUrl':_0x5b011c[_0x27f917(0x15b)]};case _0x27f917(0x12b):const _0x23dfc7=_0x5b011c[_0x27f917(0x124)]||'',_0x3986df=_0x5b011c[_0x27f917(0x14a)]||'';let _0x105f58='';if(_0x23dfc7&&_0x3986df)_0x105f58=_0x23dfc7+_0x27f917(0x15a)+_0x3986df;else{if(_0x23dfc7)_0x105f58=_0x23dfc7;else _0x3986df?_0x105f58=_0x3986df:_0x105f58=_0x27f917(0x15e);}return{'status':_0x27f917(0x14d),'failureMessage':_0x105f58,'gatewayPaymentId':_0x241a57,'cardLast4':_0x16b6af};default:console[_0x27f917(0x11f)](_0x27f917(0x115)+_0x5b011c[_0x27f917(0x158)]);const _0x1e1c12=_0x5b011c[_0x27f917(0x124)]||'',_0x43114f=_0x5b011c[_0x27f917(0x14a)]||'';let _0x4553b1='';if(_0x1e1c12&&_0x43114f)_0x4553b1=_0x1e1c12+_0x27f917(0x15a)+_0x43114f;else{if(_0x1e1c12)_0x4553b1=_0x1e1c12;else _0x43114f?_0x4553b1=_0x43114f:_0x4553b1=_0x27f917(0x148);}return{'status':'FAILED','failureMessage':_0x4553b1,'gatewayPaymentId':_0x241a57,'cardLast4':_0x16b6af};}}['logWebhook'](_0x3edf93){const _0x3445d1=a64_0x5f0f99,_0x5cbecf=new Date()[_0x3445d1(0x11c)](),_0x298941={'timestamp':_0x5cbecf,'webhook':_0x3edf93,'source':_0x3445d1(0x164)},_0xc405b5=JSON[_0x3445d1(0x119)](_0x298941)+'\x0a';try{fs_1[_0x3445d1(0x143)]['appendFileSync'](this[_0x3445d1(0x127)],_0xc405b5),console['log'](_0x3445d1(0x145)+_0x5cbecf);}catch(_0x52bc1f){console['error'](_0x3445d1(0x125),_0x52bc1f);}}[a64_0x5f0f99(0x11e)](_0x45b3a5=0x32){const _0x1936e4=a64_0x5f0f99;try{if(!fs_1[_0x1936e4(0x143)]['existsSync'](this[_0x1936e4(0x127)]))return[];const _0x3ffed7=fs_1['default']['readFileSync'](this[_0x1936e4(0x127)],_0x1936e4(0x137)),_0x40f7cc=_0x3ffed7[_0x1936e4(0x14f)]()[_0x1936e4(0x149)]('\x0a')[_0x1936e4(0x116)](_0x953cbb=>_0x953cbb);return _0x40f7cc[_0x1936e4(0x12d)](-_0x45b3a5)[_0x1936e4(0x157)](_0x4d4bed=>{try{return JSON['parse'](_0x4d4bed);}catch{return null;}})[_0x1936e4(0x116)](_0x459e39=>_0x459e39!==null);}catch(_0x404d12){return console['error']('‚ùå\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x404d12),[];}}}exports[a64_0x5f0f99(0x135)]=SquirrelPayService;