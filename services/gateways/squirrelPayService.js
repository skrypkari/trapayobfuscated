'use strict';function a70_0x5632(_0x5f4a49,_0x3d106c){_0x5f4a49=_0x5f4a49-0x71;const _0x351932=a70_0x3519();let _0x563239=_0x351932[_0x5f4a49];return _0x563239;}function a70_0x3519(){const _0x293215=['uid','SquirrelPayService','Payment\x20failed','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','squirrel-pay-webhooks.log','6eRNYIS','__esModule','\x20\x20\x20UID:\x20','\x20||\x20','cwd','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','ðŸ‘¤\x20Customer:\x20','split','status','mkdirSync','1221437JrDNLP','base64','payment_method','warn','POST','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','filter','6388080ksRHIP','dirname','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','map','successful','default','\x20\x20\x20Last\x204:\x20','ðŸ“‹\x20Request\x20ID:\x20','baseUrl','incomplete','secretKey','shopId','PENDING','âœ…\x20SquirrelPay\x20Response\x20Success:','843374iAxuBE','last_4','statusText','redirect_url','ðŸ“¦\x20Body:','node-fetch','logs','email','\x20\x20\x20Status:\x20','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','1731412mIFlRO','parse','defineProperty','\x20\x20\x20Message:\x20','Basic\x20','\x20\x20\x20Gateway\x20ID:\x20','__importDefault','isTestMode','crypto','/transactions/payments','existsSync','\x20-\x20','ðŸ”—\x20URL:\x20','getWebhookLogs','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','generateRequestId','stringify','readFileSync','getPaymentStatus','processCardPayment','log','config','utf-8','path','birth_date','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','Unknown\x20error','code','appendFileSync','logWebhook','FAILED','PAID','text','webhookLogPath','toISOString','transaction','ðŸ”„\x20Redirect\x20URL:\x20','2812899IpEoaj','ðŸ”§\x20Headers:','5220hZYOHw','4XNAdpc','2689395fFxLXg','friendly_message','SquirrelPay\x20API\x20error:\x20','78858uVTJzf','error','message'];a70_0x3519=function(){return _0x293215;};return a70_0x3519();}const a70_0x5d21bf=a70_0x5632;(function(_0x54e478,_0xc2f62b){const _0x1a4dc7=a70_0x5632,_0x1a9c4c=_0x54e478();while(!![]){try{const _0x49ab0d=-parseInt(_0x1a4dc7(0x89))/0x1+-parseInt(_0x1a4dc7(0x93))/0x2+-parseInt(_0x1a4dc7(0xb8))/0x3+-parseInt(_0x1a4dc7(0xbb))/0x4*(parseInt(_0x1a4dc7(0xbc))/0x5)+parseInt(_0x1a4dc7(0xc7))/0x6*(parseInt(_0x1a4dc7(0x74))/0x7)+-parseInt(_0x1a4dc7(0x7b))/0x8+-parseInt(_0x1a4dc7(0xbf))/0x9*(-parseInt(_0x1a4dc7(0xba))/0xa);if(_0x49ab0d===_0xc2f62b)break;else _0x1a9c4c['push'](_0x1a9c4c['shift']());}catch(_0x1672cf){_0x1a9c4c['push'](_0x1a9c4c['shift']());}}}(a70_0x3519,0xbace1));var __importDefault=this&&this[a70_0x5d21bf(0x99)]||function(_0x1591cd){return _0x1591cd&&_0x1591cd['__esModule']?_0x1591cd:{'default':_0x1591cd};};Object[a70_0x5d21bf(0x95)](exports,a70_0x5d21bf(0xc8),{'value':!![]}),exports[a70_0x5d21bf(0xc3)]=void 0x0;const crypto_1=__importDefault(require(a70_0x5d21bf(0x9b))),node_fetch_1=__importDefault(require(a70_0x5d21bf(0x8e))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a70_0x5d21bf(0xaa)));class SquirrelPayService{constructor(_0x2bd8b2){const _0x4e21e0=a70_0x5d21bf;this['config']=_0x2bd8b2,this[_0x4e21e0(0xb4)]=path_1['default']['join'](process[_0x4e21e0(0xcb)](),_0x4e21e0(0x8f),_0x4e21e0(0xc6));const _0xb1be04=path_1['default'][_0x4e21e0(0x7c)](this[_0x4e21e0(0xb4)]);!fs_1[_0x4e21e0(0x80)][_0x4e21e0(0x9d)](_0xb1be04)&&fs_1[_0x4e21e0(0x80)][_0x4e21e0(0x73)](_0xb1be04,{'recursive':!![]});}['getBasicAuth'](){const _0x584b44=a70_0x5d21bf,_0x38d6b6=this[_0x584b44(0xa8)][_0x584b44(0x86)]+':'+this[_0x584b44(0xa8)][_0x584b44(0x85)];return Buffer['from'](_0x38d6b6)['toString'](_0x584b44(0x75));}[a70_0x5d21bf(0xa2)](){const _0x98f343=a70_0x5d21bf;return crypto_1[_0x98f343(0x80)]['randomUUID']();}async[a70_0x5d21bf(0xa6)](_0x51c169,_0x1cfd3b,_0x286e9d,_0x4cc6cc,_0x2d83eb,_0x500eaa,_0x125a81,_0x2b0536,_0x3e0dce){const _0x1304b1=a70_0x5d21bf;console['log']('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console[_0x1304b1(0xa7)]('ðŸ’°\x20Amount:\x20'+_0x51c169+'\x20'+_0x1cfd3b),console[_0x1304b1(0xa7)]('ðŸ“\x20Description:\x20'+_0x286e9d),console[_0x1304b1(0xa7)](_0x1304b1(0xcd)+_0x125a81['email']+'\x20('+_0x125a81['ip']+')');const _0x1554a6={'request':{'amount':_0x51c169,'currency':_0x1cfd3b,'description':_0x286e9d,'gate_id':parseInt(this[_0x1304b1(0xa8)]['shopId']),'return_url':_0x4cc6cc,'notification_url':_0x2d83eb,'credit_card':_0x500eaa,'customer':{'email':_0x125a81[_0x1304b1(0x90)],'phone':_0x3e0dce,'birth_date':_0x125a81[_0x1304b1(0xab)],'billing':_0x2b0536},'test':this[_0x1304b1(0xa8)][_0x1304b1(0x9a)]}},_0x5da0e1=this['generateRequestId'](),_0x1db577={'Authorization':_0x1304b1(0x97)+this['getBasicAuth'](),'Content-Type':'application/json','Accept':'application/json','X-API-Version':'3','RequestID':_0x5da0e1};try{console[_0x1304b1(0xa7)]('ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x1304b1(0xa7)](_0x1304b1(0x82)+_0x5da0e1),console['log'](_0x1304b1(0x9f)+this[_0x1304b1(0xa8)][_0x1304b1(0x83)]+_0x1304b1(0x9c)),console[_0x1304b1(0xa7)](_0x1304b1(0xb9),JSON[_0x1304b1(0xa3)](_0x1db577,null,0x2)),console[_0x1304b1(0xa7)](_0x1304b1(0x8d),JSON[_0x1304b1(0xa3)](_0x1554a6,null,0x2));const _0x1757a0=await(0x0,node_fetch_1['default'])(this[_0x1304b1(0xa8)][_0x1304b1(0x83)]+_0x1304b1(0x9c),{'method':_0x1304b1(0x78),'headers':_0x1db577,'body':JSON[_0x1304b1(0xa3)](_0x1554a6)}),_0xfee6f1=await _0x1757a0[_0x1304b1(0xb3)]();console[_0x1304b1(0xa7)](_0x1304b1(0xcc)+_0x1757a0[_0x1304b1(0x72)]),console[_0x1304b1(0xa7)](_0x1304b1(0x79)+_0xfee6f1);if(!_0x1757a0['ok'])throw new Error(_0x1304b1(0xbe)+_0x1757a0[_0x1304b1(0x72)]+'\x20'+_0x1757a0[_0x1304b1(0x8b)]+_0x1304b1(0x9e)+_0xfee6f1);const _0x175217=JSON[_0x1304b1(0x94)](_0xfee6f1);return console[_0x1304b1(0xa7)](_0x1304b1(0x88)),console[_0x1304b1(0xa7)](_0x1304b1(0xc9)+_0x175217[_0x1304b1(0xc2)]),console[_0x1304b1(0xa7)](_0x1304b1(0x91)+_0x175217[_0x1304b1(0x72)]),console['log']('\x20\x20\x20Code:\x20'+_0x175217[_0x1304b1(0xae)]),console[_0x1304b1(0xa7)](_0x1304b1(0x96)+_0x175217[_0x1304b1(0xbd)]),console[_0x1304b1(0xa7)](_0x1304b1(0x98)+_0x175217[_0x1304b1(0xb6)]['gateway_id']),console[_0x1304b1(0xa7)](_0x1304b1(0x81)+_0x175217[_0x1304b1(0x76)][_0x1304b1(0x8a)]),_0x175217[_0x1304b1(0x8c)]&&console[_0x1304b1(0xa7)](_0x1304b1(0xb7)+_0x175217['redirect_url']),_0x175217;}catch(_0x330afc){console['error']('âŒ\x20SquirrelPay\x20API\x20Error:',_0x330afc);throw _0x330afc;}}[a70_0x5d21bf(0xa5)](_0x460527){const _0x4fa75a=a70_0x5d21bf,_0x460778=_0x460527[_0x4fa75a(0xc2)],_0x251a8d=_0x460527[_0x4fa75a(0x76)]['last_4'];console[_0x4fa75a(0xa7)](_0x4fa75a(0x7d)+_0x460527['status']);switch(_0x460527[_0x4fa75a(0x72)]){case _0x4fa75a(0x7f):return{'status':_0x4fa75a(0xb2),'gatewayPaymentId':_0x460778,'cardLast4':_0x251a8d};case _0x4fa75a(0x84):return{'status':_0x4fa75a(0x87),'gatewayPaymentId':_0x460778,'cardLast4':_0x251a8d,'redirectUrl':_0x460527[_0x4fa75a(0x8c)]};case'failed':const _0x1a98ec=_0x460527[_0x4fa75a(0xbd)]||'',_0x2669b6=_0x460527[_0x4fa75a(0xc1)]||'';let _0x83db11='';if(_0x1a98ec&&_0x2669b6)_0x83db11=_0x1a98ec+_0x4fa75a(0xca)+_0x2669b6;else{if(_0x1a98ec)_0x83db11=_0x1a98ec;else _0x2669b6?_0x83db11=_0x2669b6:_0x83db11=_0x4fa75a(0xc4);}return{'status':_0x4fa75a(0xb1),'failureMessage':_0x83db11,'gatewayPaymentId':_0x460778,'cardLast4':_0x251a8d};default:console[_0x4fa75a(0x77)](_0x4fa75a(0xac)+_0x460527['status']);const _0x76f916=_0x460527[_0x4fa75a(0xbd)]||'',_0x59918b=_0x460527['message']||'';let _0x553b9f='';if(_0x76f916&&_0x59918b)_0x553b9f=_0x76f916+_0x4fa75a(0xca)+_0x59918b;else{if(_0x76f916)_0x553b9f=_0x76f916;else _0x59918b?_0x553b9f=_0x59918b:_0x553b9f=_0x4fa75a(0xad);}return{'status':'FAILED','failureMessage':_0x553b9f,'gatewayPaymentId':_0x460778,'cardLast4':_0x251a8d};}}[a70_0x5d21bf(0xb0)](_0x329662){const _0x4f9ed7=a70_0x5d21bf,_0x570a7f=new Date()[_0x4f9ed7(0xb5)](),_0x1d7138={'timestamp':_0x570a7f,'webhook':_0x329662,'source':'squirrel-pay'},_0x2e5c12=JSON[_0x4f9ed7(0xa3)](_0x1d7138)+'\x0a';try{fs_1[_0x4f9ed7(0x80)][_0x4f9ed7(0xaf)](this[_0x4f9ed7(0xb4)],_0x2e5c12),console[_0x4f9ed7(0xa7)](_0x4f9ed7(0xa1)+_0x570a7f);}catch(_0x136211){console[_0x4f9ed7(0xc0)](_0x4f9ed7(0x92),_0x136211);}}[a70_0x5d21bf(0xa0)](_0x133cb0=0x32){const _0x4ef7e9=a70_0x5d21bf;try{if(!fs_1[_0x4ef7e9(0x80)][_0x4ef7e9(0x9d)](this[_0x4ef7e9(0xb4)]))return[];const _0x560738=fs_1[_0x4ef7e9(0x80)][_0x4ef7e9(0xa4)](this[_0x4ef7e9(0xb4)],_0x4ef7e9(0xa9)),_0x1f9dab=_0x560738['trim']()[_0x4ef7e9(0x71)]('\x0a')['filter'](_0x38a492=>_0x38a492);return _0x1f9dab['slice'](-_0x133cb0)[_0x4ef7e9(0x7e)](_0x300992=>{try{return JSON['parse'](_0x300992);}catch{return null;}})[_0x4ef7e9(0x7a)](_0x71f441=>_0x71f441!==null);}catch(_0x56476d){return console[_0x4ef7e9(0xc0)](_0x4ef7e9(0xc5),_0x56476d),[];}}}exports[a70_0x5d21bf(0xc3)]=SquirrelPayService;