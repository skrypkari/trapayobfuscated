'use strict';const a76_0x534b17=a76_0x56ce;(function(_0x45ded8,_0x1d0122){const _0x48fb7c=a76_0x56ce,_0x512a39=_0x45ded8();while(!![]){try{const _0x46c56f=parseInt(_0x48fb7c(0xff))/0x1*(-parseInt(_0x48fb7c(0xfc))/0x2)+parseInt(_0x48fb7c(0x114))/0x3*(parseInt(_0x48fb7c(0x11b))/0x4)+parseInt(_0x48fb7c(0x144))/0x5+parseInt(_0x48fb7c(0x117))/0x6*(-parseInt(_0x48fb7c(0x127))/0x7)+parseInt(_0x48fb7c(0xfe))/0x8+parseInt(_0x48fb7c(0x11a))/0x9*(-parseInt(_0x48fb7c(0x10c))/0xa)+parseInt(_0x48fb7c(0x13a))/0xb*(parseInt(_0x48fb7c(0x107))/0xc);if(_0x46c56f===_0x1d0122)break;else _0x512a39['push'](_0x512a39['shift']());}catch(_0xf40a6a){_0x512a39['push'](_0x512a39['shift']());}}}(a76_0x3f1f,0x2d7d0));function a76_0x3f1f(){const _0x215757=['PENDING','map','__esModule','toString','existsSync','ðŸ“\x20Description:\x20','split','3iuoJSQ','logWebhook','webhookLogPath','87702KUCPIP','incomplete','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','45WjHUTF','628104wrzXGQ','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','baseUrl','processCardPayment','default','last_4','__importDefault','email','path','shopId','\x20||\x20','/transactions/payments','133guOvFu','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','log','parse','ðŸ“‹\x20Request\x20ID:\x20','slice','error','toISOString','POST','getWebhookLogs','\x20\x20\x20Gateway\x20ID:\x20','squirrel-pay','\x20\x20\x20Code:\x20','ðŸ”—\x20URL:\x20','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','filter','utf-8','uid','squirrel-pay-webhooks.log','660xjPZwe','node-fetch','PAID','application/json','SquirrelPay\x20API\x20error:\x20','warn','isTestMode','generateRequestId','dirname','randomUUID','1549765ueIzrg','Payment\x20failed','statusText','payment_method','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','successful','Unknown\x20error','logs','crypto','\x20\x20\x20Message:\x20','\x20\x20\x20UID:\x20','status','ðŸ”„\x20Redirect\x20URL:\x20','214658NwjNcc','redirect_url','210016ppjxvx','2SDwOTh','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','message','stringify','ðŸ‘¤\x20Customer:\x20','SquirrelPayService','config','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','95712FVzEet','getBasicAuth','âœ…\x20SquirrelPay\x20Response\x20Success:','\x20\x20\x20Last\x204:\x20','FAILED','586180AeZdcU'];a76_0x3f1f=function(){return _0x215757;};return a76_0x3f1f();}function a76_0x56ce(_0x572ba4,_0x35fafe){_0x572ba4=_0x572ba4-0xfa;const _0x3f1ff5=a76_0x3f1f();let _0x56ce73=_0x3f1ff5[_0x572ba4];return _0x56ce73;}var __importDefault=this&&this[a76_0x534b17(0x121)]||function(_0x3cd451){const _0x21475a=a76_0x534b17;return _0x3cd451&&_0x3cd451[_0x21475a(0x10f)]?_0x3cd451:{'default':_0x3cd451};};Object['defineProperty'](exports,a76_0x534b17(0x10f),{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a76_0x534b17(0x14d))),node_fetch_1=__importDefault(require(a76_0x534b17(0x13b))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x534b17(0x123)));class SquirrelPayService{constructor(_0x2db7c6){const _0x12e6aa=a76_0x534b17;this[_0x12e6aa(0x105)]=_0x2db7c6,this[_0x12e6aa(0x116)]=path_1['default']['join'](process['cwd'](),_0x12e6aa(0x14c),_0x12e6aa(0x139));const _0x1c685b=path_1[_0x12e6aa(0x11f)][_0x12e6aa(0x142)](this[_0x12e6aa(0x116)]);!fs_1[_0x12e6aa(0x11f)][_0x12e6aa(0x111)](_0x1c685b)&&fs_1['default']['mkdirSync'](_0x1c685b,{'recursive':!![]});}[a76_0x534b17(0x108)](){const _0x1d3c61=a76_0x534b17,_0x23892e=this[_0x1d3c61(0x105)][_0x1d3c61(0x124)]+':'+this[_0x1d3c61(0x105)]['secretKey'];return Buffer['from'](_0x23892e)[_0x1d3c61(0x110)]('base64');}[a76_0x534b17(0x141)](){const _0x11c6ca=a76_0x534b17;return crypto_1[_0x11c6ca(0x11f)][_0x11c6ca(0x143)]();}async[a76_0x534b17(0x11e)](_0x338133,_0x3d0639,_0x461375,_0x27ac0f,_0x3b9a5a,_0x41b3bf,_0x1bdea6,_0x3e1aba,_0x1bb755){const _0x186f0b=a76_0x534b17;console[_0x186f0b(0x129)]('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console['log']('ðŸ’°\x20Amount:\x20'+_0x338133+'\x20'+_0x3d0639),console[_0x186f0b(0x129)](_0x186f0b(0x112)+_0x461375),console['log'](_0x186f0b(0x103)+_0x1bdea6[_0x186f0b(0x122)]+'\x20('+_0x1bdea6['ip']+')');const _0x5a5ed4={'request':{'amount':_0x338133,'currency':_0x3d0639,'description':_0x461375,'gate_id':parseInt(this[_0x186f0b(0x105)]['shopId']),'return_url':_0x27ac0f,'notification_url':_0x3b9a5a,'credit_card':_0x41b3bf,'customer':{'email':_0x1bdea6[_0x186f0b(0x122)],'phone':_0x1bb755,'birth_date':_0x1bdea6['birth_date'],'billing':_0x3e1aba},'test':this['config'][_0x186f0b(0x140)]}},_0xd802d8=this[_0x186f0b(0x141)](),_0x5e1612={'Authorization':'Basic\x20'+this[_0x186f0b(0x108)](),'Content-Type':_0x186f0b(0x13d),'Accept':_0x186f0b(0x13d),'X-API-Version':'3','RequestID':_0xd802d8};try{console['log'](_0x186f0b(0x106)),console['log'](_0x186f0b(0x12b)+_0xd802d8),console[_0x186f0b(0x129)](_0x186f0b(0x134)+this[_0x186f0b(0x105)]['baseUrl']+_0x186f0b(0x126)),console['log']('ðŸ”§\x20Headers:',JSON['stringify'](_0x5e1612,null,0x2)),console['log']('ðŸ“¦\x20Body:',JSON[_0x186f0b(0x102)](_0x5a5ed4,null,0x2));const _0x241110=await(0x0,node_fetch_1[_0x186f0b(0x11f)])(this[_0x186f0b(0x105)][_0x186f0b(0x11d)]+_0x186f0b(0x126),{'method':_0x186f0b(0x12f),'headers':_0x5e1612,'body':JSON[_0x186f0b(0x102)](_0x5a5ed4)}),_0x2aa49a=await _0x241110['text']();console['log'](_0x186f0b(0x119)+_0x241110[_0x186f0b(0xfa)]),console[_0x186f0b(0x129)](_0x186f0b(0x100)+_0x2aa49a);if(!_0x241110['ok'])throw new Error(_0x186f0b(0x13e)+_0x241110[_0x186f0b(0xfa)]+'\x20'+_0x241110[_0x186f0b(0x146)]+'\x20-\x20'+_0x2aa49a);const _0x4ae854=JSON['parse'](_0x2aa49a);return console[_0x186f0b(0x129)](_0x186f0b(0x109)),console[_0x186f0b(0x129)](_0x186f0b(0x14f)+_0x4ae854[_0x186f0b(0x138)]),console[_0x186f0b(0x129)]('\x20\x20\x20Status:\x20'+_0x4ae854[_0x186f0b(0xfa)]),console['log'](_0x186f0b(0x133)+_0x4ae854['code']),console['log'](_0x186f0b(0x14e)+_0x4ae854['friendly_message']),console[_0x186f0b(0x129)](_0x186f0b(0x131)+_0x4ae854['transaction']['gateway_id']),console['log'](_0x186f0b(0x10a)+_0x4ae854['payment_method']['last_4']),_0x4ae854[_0x186f0b(0xfd)]&&console[_0x186f0b(0x129)](_0x186f0b(0xfb)+_0x4ae854['redirect_url']),_0x4ae854;}catch(_0x16ec65){console[_0x186f0b(0x12d)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x16ec65);throw _0x16ec65;}}['getPaymentStatus'](_0x881515){const _0x35d688=a76_0x534b17,_0x5c5cc9=_0x881515[_0x35d688(0x138)],_0x494efa=_0x881515[_0x35d688(0x147)][_0x35d688(0x120)];console[_0x35d688(0x129)](_0x35d688(0x135)+_0x881515[_0x35d688(0xfa)]);switch(_0x881515['status']){case _0x35d688(0x14a):return{'status':_0x35d688(0x13c),'gatewayPaymentId':_0x5c5cc9,'cardLast4':_0x494efa};case _0x35d688(0x118):return{'status':_0x35d688(0x10d),'gatewayPaymentId':_0x5c5cc9,'cardLast4':_0x494efa,'redirectUrl':_0x881515[_0x35d688(0xfd)]};case'failed':const _0x57ae73=_0x881515['friendly_message']||'',_0x4d1026=_0x881515[_0x35d688(0x101)]||'';let _0x241481='';if(_0x57ae73&&_0x4d1026)_0x241481=_0x57ae73+_0x35d688(0x125)+_0x4d1026;else{if(_0x57ae73)_0x241481=_0x57ae73;else _0x4d1026?_0x241481=_0x4d1026:_0x241481=_0x35d688(0x145);}return{'status':_0x35d688(0x10b),'failureMessage':_0x241481,'gatewayPaymentId':_0x5c5cc9,'cardLast4':_0x494efa};default:console[_0x35d688(0x13f)](_0x35d688(0x148)+_0x881515[_0x35d688(0xfa)]);const _0x43bfd6=_0x881515['friendly_message']||'',_0x29c126=_0x881515[_0x35d688(0x101)]||'';let _0x30ed41='';if(_0x43bfd6&&_0x29c126)_0x30ed41=_0x43bfd6+'\x20||\x20'+_0x29c126;else{if(_0x43bfd6)_0x30ed41=_0x43bfd6;else _0x29c126?_0x30ed41=_0x29c126:_0x30ed41=_0x35d688(0x14b);}return{'status':_0x35d688(0x10b),'failureMessage':_0x30ed41,'gatewayPaymentId':_0x5c5cc9,'cardLast4':_0x494efa};}}[a76_0x534b17(0x115)](_0x424511){const _0x1a3311=a76_0x534b17,_0x5560f2=new Date()[_0x1a3311(0x12e)](),_0x5857f4={'timestamp':_0x5560f2,'webhook':_0x424511,'source':_0x1a3311(0x132)},_0x2dc4a5=JSON['stringify'](_0x5857f4)+'\x0a';try{fs_1['default']['appendFileSync'](this['webhookLogPath'],_0x2dc4a5),console[_0x1a3311(0x129)](_0x1a3311(0x128)+_0x5560f2);}catch(_0x3e2992){console[_0x1a3311(0x12d)](_0x1a3311(0x149),_0x3e2992);}}[a76_0x534b17(0x130)](_0x3dcd0a=0x32){const _0x52930b=a76_0x534b17;try{if(!fs_1[_0x52930b(0x11f)][_0x52930b(0x111)](this[_0x52930b(0x116)]))return[];const _0x2d7cf9=fs_1[_0x52930b(0x11f)]['readFileSync'](this['webhookLogPath'],_0x52930b(0x137)),_0x529049=_0x2d7cf9['trim']()[_0x52930b(0x113)]('\x0a')[_0x52930b(0x136)](_0x40bf22=>_0x40bf22);return _0x529049[_0x52930b(0x12c)](-_0x3dcd0a)[_0x52930b(0x10e)](_0x4d7319=>{const _0x7d8e51=_0x52930b;try{return JSON[_0x7d8e51(0x12a)](_0x4d7319);}catch{return null;}})[_0x52930b(0x136)](_0x9f9192=>_0x9f9192!==null);}catch(_0x5186ae){return console[_0x52930b(0x12d)](_0x52930b(0x11c),_0x5186ae),[];}}}exports[a76_0x534b17(0x104)]=SquirrelPayService;