'use strict';function a64_0xa2ed(_0xd33c63,_0x5a5f50){_0xd33c63=_0xd33c63-0x16f;const _0x470148=a64_0x4701();let _0xa2ed37=_0x470148[_0xd33c63];return _0xa2ed37;}const a64_0x1f1191=a64_0xa2ed;(function(_0x2ace26,_0x54ff28){const _0x4f4070=a64_0xa2ed,_0x447cd2=_0x2ace26();while(!![]){try{const _0xd5fe9e=parseInt(_0x4f4070(0x1c8))/0x1+parseInt(_0x4f4070(0x1bc))/0x2*(-parseInt(_0x4f4070(0x190))/0x3)+parseInt(_0x4f4070(0x184))/0x4*(parseInt(_0x4f4070(0x1b0))/0x5)+parseInt(_0x4f4070(0x1c9))/0x6+-parseInt(_0x4f4070(0x174))/0x7*(-parseInt(_0x4f4070(0x1bb))/0x8)+-parseInt(_0x4f4070(0x18d))/0x9+parseInt(_0x4f4070(0x19e))/0xa;if(_0xd5fe9e===_0x54ff28)break;else _0x447cd2['push'](_0x447cd2['shift']());}catch(_0x3e8e7f){_0x447cd2['push'](_0x447cd2['shift']());}}}(a64_0x4701,0xd0092));var __importDefault=this&&this[a64_0x1f1191(0x19d)]||function(_0x160f77){const _0xf43d7=a64_0x1f1191;return _0x160f77&&_0x160f77[_0xf43d7(0x179)]?_0x160f77:{'default':_0x160f77};};Object[a64_0x1f1191(0x1a9)](exports,a64_0x1f1191(0x179),{'value':!![]}),exports[a64_0x1f1191(0x1b8)]=void 0x0;const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require(a64_0x1f1191(0x1a1))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x1f1191(0x17a)));class SquirrelPayService{constructor(_0x5bdff5){const _0x533dde=a64_0x1f1191;this[_0x533dde(0x1ac)]=_0x5bdff5,this[_0x533dde(0x18e)]=path_1['default']['join'](process[_0x533dde(0x18c)](),_0x533dde(0x1b7),_0x533dde(0x1c7));const _0x3a37fd=path_1['default'][_0x533dde(0x1b6)](this[_0x533dde(0x18e)]);!fs_1[_0x533dde(0x198)][_0x533dde(0x176)](_0x3a37fd)&&fs_1[_0x533dde(0x198)][_0x533dde(0x177)](_0x3a37fd,{'recursive':!![]});}[a64_0x1f1191(0x1c4)](){const _0x5c9a2a=a64_0x1f1191,_0x51b138=this[_0x5c9a2a(0x1ac)][_0x5c9a2a(0x1ce)]+':'+this['config'][_0x5c9a2a(0x1be)];return Buffer[_0x5c9a2a(0x1cc)](_0x51b138)[_0x5c9a2a(0x1c6)](_0x5c9a2a(0x1c1));}[a64_0x1f1191(0x1bd)](){const _0x5919ad=a64_0x1f1191;return crypto_1['default'][_0x5919ad(0x1a5)]();}async[a64_0x1f1191(0x191)](_0x414c6b,_0x34c9e6,_0x26a6ab,_0x388b66,_0x5bc2e8,_0x142895,_0x4ae7db,_0x59cd82,_0x237424){const _0x23adde=a64_0x1f1191;console['log'](_0x23adde(0x18b)),console['log'](_0x23adde(0x181)+_0x414c6b+'\x20'+_0x34c9e6),console[_0x23adde(0x1a7)](_0x23adde(0x1a3)+_0x26a6ab),console[_0x23adde(0x1a7)](_0x23adde(0x178)+_0x4ae7db[_0x23adde(0x180)]+'\x20('+_0x4ae7db['ip']+')');const _0x2532d8={'request':{'amount':_0x414c6b,'currency':_0x34c9e6,'description':_0x26a6ab,'gate_id':parseInt(this[_0x23adde(0x1ac)]['shopId']),'return_url':_0x388b66,'notification_url':_0x5bc2e8,'credit_card':_0x142895,'customer':{'email':_0x4ae7db['email'],'phone':_0x237424,'birth_date':_0x4ae7db[_0x23adde(0x19b)],'billing':_0x59cd82},'test':this[_0x23adde(0x1ac)][_0x23adde(0x17c)]}},_0x1a4dba=this['generateRequestId'](),_0x58c2c7={'Authorization':_0x23adde(0x1bf)+this[_0x23adde(0x1c4)](),'Content-Type':_0x23adde(0x173),'Accept':'application/json','X-API-Version':'3','RequestID':_0x1a4dba};try{console['log']('ğŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x23adde(0x1a7)](_0x23adde(0x1a0)+_0x1a4dba),console['log']('ğŸ”—\x20URL:\x20'+this[_0x23adde(0x1ac)][_0x23adde(0x171)]+_0x23adde(0x1a8)),console[_0x23adde(0x1a7)](_0x23adde(0x175),JSON['stringify'](_0x58c2c7,null,0x2)),console[_0x23adde(0x1a7)](_0x23adde(0x189),JSON[_0x23adde(0x1b9)](_0x2532d8,null,0x2));const _0x5a54cf=await(0x0,node_fetch_1[_0x23adde(0x198)])(this[_0x23adde(0x1ac)]['baseUrl']+_0x23adde(0x1a8),{'method':_0x23adde(0x185),'headers':_0x58c2c7,'body':JSON[_0x23adde(0x1b9)](_0x2532d8)}),_0x3b26ba=await _0x5a54cf[_0x23adde(0x1c3)]();console[_0x23adde(0x1a7)](_0x23adde(0x1a4)+_0x5a54cf[_0x23adde(0x1ae)]),console[_0x23adde(0x1a7)](_0x23adde(0x16f)+_0x3b26ba);if(!_0x5a54cf['ok'])throw new Error(_0x23adde(0x1b4)+_0x5a54cf[_0x23adde(0x1ae)]+'\x20'+_0x5a54cf[_0x23adde(0x170)]+_0x23adde(0x192)+_0x3b26ba);const _0x3ac445=JSON[_0x23adde(0x194)](_0x3b26ba);return console['log'](_0x23adde(0x1cd)),console[_0x23adde(0x1a7)]('\x20\x20\x20UID:\x20'+_0x3ac445[_0x23adde(0x187)]),console['log'](_0x23adde(0x19f)+_0x3ac445[_0x23adde(0x1ae)]),console['log'](_0x23adde(0x18f)+_0x3ac445[_0x23adde(0x19c)]),console[_0x23adde(0x1a7)](_0x23adde(0x18a)+_0x3ac445['friendly_message']),console[_0x23adde(0x1a7)](_0x23adde(0x1ca)+_0x3ac445['transaction'][_0x23adde(0x1af)]),console[_0x23adde(0x1a7)](_0x23adde(0x197)+_0x3ac445[_0x23adde(0x1b5)][_0x23adde(0x1a6)]),_0x3ac445[_0x23adde(0x1ab)]&&console[_0x23adde(0x1a7)]('ğŸ”„\x20Redirect\x20URL:\x20'+_0x3ac445['redirect_url']),_0x3ac445;}catch(_0x4d2042){console[_0x23adde(0x1b2)](_0x23adde(0x186),_0x4d2042);throw _0x4d2042;}}[a64_0x1f1191(0x183)](_0x1f04d2){const _0x4658f6=a64_0x1f1191,_0x310826=_0x1f04d2['uid'],_0x471483=_0x1f04d2['payment_method'][_0x4658f6(0x1a6)];console['log'](_0x4658f6(0x188)+_0x1f04d2[_0x4658f6(0x1ae)]);switch(_0x1f04d2[_0x4658f6(0x1ae)]){case _0x4658f6(0x1c2):return{'status':_0x4658f6(0x1b3),'gatewayPaymentId':_0x310826,'cardLast4':_0x471483};case _0x4658f6(0x1aa):return{'status':_0x4658f6(0x195),'gatewayPaymentId':_0x310826,'cardLast4':_0x471483,'redirectUrl':_0x1f04d2[_0x4658f6(0x1ab)]};case _0x4658f6(0x1b1):const _0x4f2d4f=_0x1f04d2['friendly_message']||'',_0x3ab6d4=_0x1f04d2[_0x4658f6(0x17f)]||'';let _0x308267='';if(_0x4f2d4f&&_0x3ab6d4)_0x308267=_0x4f2d4f+_0x4658f6(0x1ba)+_0x3ab6d4;else{if(_0x4f2d4f)_0x308267=_0x4f2d4f;else _0x3ab6d4?_0x308267=_0x3ab6d4:_0x308267='Payment\x20failed';}return{'status':_0x4658f6(0x19a),'failureMessage':_0x308267,'gatewayPaymentId':_0x310826,'cardLast4':_0x471483};default:console[_0x4658f6(0x1cb)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x1f04d2[_0x4658f6(0x1ae)]);const _0x4754b1=_0x1f04d2['friendly_message']||'',_0x9ad0b7=_0x1f04d2[_0x4658f6(0x17f)]||'';let _0x23d9f1='';if(_0x4754b1&&_0x9ad0b7)_0x23d9f1=_0x4754b1+'\x20||\x20'+_0x9ad0b7;else{if(_0x4754b1)_0x23d9f1=_0x4754b1;else _0x9ad0b7?_0x23d9f1=_0x9ad0b7:_0x23d9f1=_0x4658f6(0x172);}return{'status':_0x4658f6(0x19a),'failureMessage':_0x23d9f1,'gatewayPaymentId':_0x310826,'cardLast4':_0x471483};}}['logWebhook'](_0x511453){const _0x1f30d3=a64_0x1f1191,_0x586251=new Date()[_0x1f30d3(0x17e)](),_0x461d4a={'timestamp':_0x586251,'webhook':_0x511453,'source':_0x1f30d3(0x199)},_0xfbe405=JSON['stringify'](_0x461d4a)+'\x0a';try{fs_1['default'][_0x1f30d3(0x193)](this[_0x1f30d3(0x18e)],_0xfbe405),console[_0x1f30d3(0x1a7)]('ğŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x586251);}catch(_0xe5b043){console[_0x1f30d3(0x1b2)](_0x1f30d3(0x17b),_0xe5b043);}}[a64_0x1f1191(0x196)](_0x5f4c0b=0x32){const _0x13d7e3=a64_0x1f1191;try{if(!fs_1['default'][_0x13d7e3(0x176)](this[_0x13d7e3(0x18e)]))return[];const _0x321199=fs_1['default'][_0x13d7e3(0x1c0)](this[_0x13d7e3(0x18e)],_0x13d7e3(0x1a2)),_0x41d34e=_0x321199[_0x13d7e3(0x1c5)]()['split']('\x0a')[_0x13d7e3(0x17d)](_0x57b93d=>_0x57b93d);return _0x41d34e[_0x13d7e3(0x1ad)](-_0x5f4c0b)[_0x13d7e3(0x182)](_0x4b4787=>{try{return JSON['parse'](_0x4b4787);}catch{return null;}})[_0x13d7e3(0x17d)](_0x2868aa=>_0x2868aa!==null);}catch(_0x271c36){return console['error']('âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x271c36),[];}}}exports[a64_0x1f1191(0x1b8)]=SquirrelPayService;function a64_0x4701(){const _0x31284d=['\x20||\x20','224LBnyPF','14158YJPLvn','generateRequestId','secretKey','Basic\x20','readFileSync','base64','successful','text','getBasicAuth','trim','toString','squirrel-pay-webhooks.log','145015PCKBmM','2976078gqWVrp','\x20\x20\x20Gateway\x20ID:\x20','warn','from','âœ…\x20SquirrelPay\x20Response\x20Success:','shopId','ğŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','statusText','baseUrl','Unknown\x20error','application/json','15757uAxvHD','ğŸ”§\x20Headers:','existsSync','mkdirSync','ğŸ‘¤\x20Customer:\x20','__esModule','path','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','isTestMode','filter','toISOString','message','email','ğŸ’°\x20Amount:\x20','map','getPaymentStatus','3340rifmuQ','POST','âŒ\x20SquirrelPay\x20API\x20Error:','uid','ğŸ”\x20Processing\x20SquirrelPay\x20status:\x20','ğŸ“¦\x20Body:','\x20\x20\x20Message:\x20','ğŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','cwd','157950BvqioP','webhookLogPath','\x20\x20\x20Code:\x20','537KdqAEa','processCardPayment','\x20-\x20','appendFileSync','parse','PENDING','getWebhookLogs','\x20\x20\x20Last\x204:\x20','default','squirrel-pay','FAILED','birth_date','code','__importDefault','8123440LDpjIA','\x20\x20\x20Status:\x20','ğŸ“‹\x20Request\x20ID:\x20','node-fetch','utf-8','ğŸ“\x20Description:\x20','ğŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','randomUUID','last_4','log','/transactions/payments','defineProperty','incomplete','redirect_url','config','slice','status','gateway_id','3715LNDOEd','failed','error','PAID','SquirrelPay\x20API\x20error:\x20','payment_method','dirname','logs','SquirrelPayService','stringify'];a64_0x4701=function(){return _0x31284d;};return a64_0x4701();}