'use strict';const a70_0x26da1d=a70_0x12f4;(function(_0x5dbe30,_0xd4a87b){const _0x29ef70=a70_0x12f4,_0xffd59a=_0x5dbe30();while(!![]){try{const _0x2cc401=-parseInt(_0x29ef70(0x220))/0x1*(-parseInt(_0x29ef70(0x1e5))/0x2)+-parseInt(_0x29ef70(0x219))/0x3+parseInt(_0x29ef70(0x20f))/0x4*(parseInt(_0x29ef70(0x211))/0x5)+-parseInt(_0x29ef70(0x1f8))/0x6*(parseInt(_0x29ef70(0x20a))/0x7)+parseInt(_0x29ef70(0x1f5))/0x8+-parseInt(_0x29ef70(0x1dd))/0x9+parseInt(_0x29ef70(0x210))/0xa;if(_0x2cc401===_0xd4a87b)break;else _0xffd59a['push'](_0xffd59a['shift']());}catch(_0x1bd264){_0xffd59a['push'](_0xffd59a['shift']());}}}(a70_0x384e,0x99ac7));var __importDefault=this&&this['__importDefault']||function(_0x1e80b6){const _0x17f70c=a70_0x12f4;return _0x1e80b6&&_0x1e80b6[_0x17f70c(0x1ed)]?_0x1e80b6:{'default':_0x1e80b6};};function a70_0x12f4(_0xf8be83,_0x4f6e57){_0xf8be83=_0xf8be83-0x1d8;const _0x384ecc=a70_0x384e();let _0x12f45d=_0x384ecc[_0xf8be83];return _0x12f45d;}Object['defineProperty'](exports,a70_0x26da1d(0x1ed),{'value':!![]}),exports[a70_0x26da1d(0x1e1)]=void 0x0;function a70_0x384e(){const _0x122700=['âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','application/json','/transactions/payments','âœ…\x20SquirrelPay\x20Response\x20Success:','split','appendFileSync','crypto','1509296qKaoTj','error','POST','846012riIFIp','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','Basic\x20','code','readFileSync','stringify','warn','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','friendly_message','\x20\x20\x20Gateway\x20ID:\x20','text','utf-8','uid','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','\x20||\x20','ðŸ‘¤\x20Customer:\x20','parse','getBasicAuth','35pVYdFd','squirrel-pay-webhooks.log','path','baseUrl','successful','3436164tnoHNV','13381970tNsqmp','5PHzUam','\x20\x20\x20Status:\x20','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','map','ðŸ“‹\x20Request\x20ID:\x20','ðŸ”§\x20Headers:','\x20-\x20','slice','2064240xrzRSI','ðŸ’°\x20Amount:\x20','default','webhookLogPath','\x20\x20\x20Last\x204:\x20','randomUUID','filter','9183EcjxMW','redirect_url','âŒ\x20SquirrelPay\x20API\x20Error:','ðŸ“\x20Description:\x20','status','ðŸ”—\x20URL:\x20','logWebhook','payment_method','last_4','toString','isTestMode','shopId','base64','generateRequestId','SquirrelPay\x20API\x20error:\x20','dirname','log','11039085CdGfZX','transaction','\x20\x20\x20Code:\x20','ðŸ“¦\x20Body:','SquirrelPayService','message','cwd','email','188BSOCXQ','trim','config','gateway_id','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','\x20\x20\x20Message:\x20','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','toISOString','__esModule'];a70_0x384e=function(){return _0x122700;};return a70_0x384e();}const crypto_1=__importDefault(require(a70_0x26da1d(0x1f4))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a70_0x26da1d(0x20c)));class SquirrelPayService{constructor(_0x2e35fc){const _0x2b1db2=a70_0x26da1d;this[_0x2b1db2(0x1e7)]=_0x2e35fc,this['webhookLogPath']=path_1[_0x2b1db2(0x21b)]['join'](process[_0x2b1db2(0x1e3)](),'logs',_0x2b1db2(0x20b));const _0x3b766d=path_1[_0x2b1db2(0x21b)][_0x2b1db2(0x1db)](this[_0x2b1db2(0x21c)]);!fs_1['default']['existsSync'](_0x3b766d)&&fs_1[_0x2b1db2(0x21b)]['mkdirSync'](_0x3b766d,{'recursive':!![]});}[a70_0x26da1d(0x209)](){const _0xce929c=a70_0x26da1d,_0x16735c=this[_0xce929c(0x1e7)][_0xce929c(0x22b)]+':'+this['config']['secretKey'];return Buffer['from'](_0x16735c)[_0xce929c(0x229)](_0xce929c(0x1d8));}[a70_0x26da1d(0x1d9)](){const _0x7aebe4=a70_0x26da1d;return crypto_1['default'][_0x7aebe4(0x21e)]();}async['processCardPayment'](_0x39e26e,_0x50e323,_0x537348,_0x1ccdcc,_0x1bca55,_0xe097e7,_0x25a063,_0x92266b,_0x56e144){const _0x203c1f=a70_0x26da1d;console[_0x203c1f(0x1dc)]('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console[_0x203c1f(0x1dc)](_0x203c1f(0x21a)+_0x39e26e+'\x20'+_0x50e323),console['log'](_0x203c1f(0x223)+_0x537348),console[_0x203c1f(0x1dc)](_0x203c1f(0x207)+_0x25a063[_0x203c1f(0x1e4)]+'\x20('+_0x25a063['ip']+')');const _0x2c5f2e={'request':{'amount':_0x39e26e,'currency':_0x50e323,'description':_0x537348,'gate_id':parseInt(this['config'][_0x203c1f(0x22b)]),'return_url':_0x1ccdcc,'notification_url':_0x1bca55,'credit_card':_0xe097e7,'customer':{'email':_0x25a063[_0x203c1f(0x1e4)],'phone':_0x56e144,'birth_date':_0x25a063['birth_date'],'billing':_0x92266b},'test':this['config'][_0x203c1f(0x22a)]}},_0x398cd7=this[_0x203c1f(0x1d9)](),_0x1a8ef7={'Authorization':_0x203c1f(0x1fa)+this[_0x203c1f(0x209)](),'Content-Type':_0x203c1f(0x1ef),'Accept':_0x203c1f(0x1ef),'X-API-Version':'3','RequestID':_0x398cd7};try{console[_0x203c1f(0x1dc)](_0x203c1f(0x1f9)),console['log'](_0x203c1f(0x215)+_0x398cd7),console['log'](_0x203c1f(0x225)+this[_0x203c1f(0x1e7)]['baseUrl']+_0x203c1f(0x1f0)),console['log'](_0x203c1f(0x216),JSON[_0x203c1f(0x1fd)](_0x1a8ef7,null,0x2)),console[_0x203c1f(0x1dc)](_0x203c1f(0x1e0),JSON[_0x203c1f(0x1fd)](_0x2c5f2e,null,0x2));const _0x5be079=await(0x0,node_fetch_1[_0x203c1f(0x21b)])(this['config'][_0x203c1f(0x20d)]+_0x203c1f(0x1f0),{'method':_0x203c1f(0x1f7),'headers':_0x1a8ef7,'body':JSON['stringify'](_0x2c5f2e)}),_0x4de1bc=await _0x5be079[_0x203c1f(0x202)]();console['log'](_0x203c1f(0x213)+_0x5be079['status']),console[_0x203c1f(0x1dc)](_0x203c1f(0x1ff)+_0x4de1bc);if(!_0x5be079['ok'])throw new Error(_0x203c1f(0x1da)+_0x5be079[_0x203c1f(0x224)]+'\x20'+_0x5be079['statusText']+_0x203c1f(0x217)+_0x4de1bc);const _0x3408c0=JSON[_0x203c1f(0x208)](_0x4de1bc);return console[_0x203c1f(0x1dc)](_0x203c1f(0x1f1)),console[_0x203c1f(0x1dc)]('\x20\x20\x20UID:\x20'+_0x3408c0[_0x203c1f(0x204)]),console[_0x203c1f(0x1dc)](_0x203c1f(0x212)+_0x3408c0['status']),console[_0x203c1f(0x1dc)](_0x203c1f(0x1df)+_0x3408c0[_0x203c1f(0x1fb)]),console[_0x203c1f(0x1dc)](_0x203c1f(0x1ea)+_0x3408c0[_0x203c1f(0x200)]),console['log'](_0x203c1f(0x201)+_0x3408c0[_0x203c1f(0x1de)][_0x203c1f(0x1e8)]),console[_0x203c1f(0x1dc)](_0x203c1f(0x21d)+_0x3408c0[_0x203c1f(0x227)][_0x203c1f(0x228)]),_0x3408c0[_0x203c1f(0x221)]&&console[_0x203c1f(0x1dc)]('ðŸ”„\x20Redirect\x20URL:\x20'+_0x3408c0['redirect_url']),_0x3408c0;}catch(_0x55a6f7){console[_0x203c1f(0x1f6)](_0x203c1f(0x222),_0x55a6f7);throw _0x55a6f7;}}['getPaymentStatus'](_0x3da7bb){const _0x1a51e4=a70_0x26da1d,_0x492c9f=_0x3da7bb['uid'],_0xe38d58=_0x3da7bb[_0x1a51e4(0x227)][_0x1a51e4(0x228)];console[_0x1a51e4(0x1dc)](_0x1a51e4(0x1eb)+_0x3da7bb['status']);switch(_0x3da7bb[_0x1a51e4(0x224)]){case _0x1a51e4(0x20e):return{'status':'PAID','gatewayPaymentId':_0x492c9f,'cardLast4':_0xe38d58};case'incomplete':return{'status':'PENDING','gatewayPaymentId':_0x492c9f,'cardLast4':_0xe38d58,'redirectUrl':_0x3da7bb[_0x1a51e4(0x221)]};case'failed':const _0x3a666e=_0x3da7bb[_0x1a51e4(0x200)]||'',_0x5f14ed=_0x3da7bb[_0x1a51e4(0x1e2)]||'';let _0x24eec4='';if(_0x3a666e&&_0x5f14ed)_0x24eec4=_0x3a666e+'\x20||\x20'+_0x5f14ed;else{if(_0x3a666e)_0x24eec4=_0x3a666e;else _0x5f14ed?_0x24eec4=_0x5f14ed:_0x24eec4='Payment\x20failed';}return{'status':'FAILED','failureMessage':_0x24eec4,'gatewayPaymentId':_0x492c9f,'cardLast4':_0xe38d58};default:console[_0x1a51e4(0x1fe)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x3da7bb[_0x1a51e4(0x224)]);const _0x244467=_0x3da7bb['friendly_message']||'',_0xd87d0e=_0x3da7bb[_0x1a51e4(0x1e2)]||'';let _0x27976f='';if(_0x244467&&_0xd87d0e)_0x27976f=_0x244467+_0x1a51e4(0x206)+_0xd87d0e;else{if(_0x244467)_0x27976f=_0x244467;else _0xd87d0e?_0x27976f=_0xd87d0e:_0x27976f='Unknown\x20error';}return{'status':'FAILED','failureMessage':_0x27976f,'gatewayPaymentId':_0x492c9f,'cardLast4':_0xe38d58};}}[a70_0x26da1d(0x226)](_0x5ca5fa){const _0x7be7ed=a70_0x26da1d,_0xeeaaa=new Date()[_0x7be7ed(0x1ec)](),_0x2bd181={'timestamp':_0xeeaaa,'webhook':_0x5ca5fa,'source':'squirrel-pay'},_0x3ec1be=JSON[_0x7be7ed(0x1fd)](_0x2bd181)+'\x0a';try{fs_1[_0x7be7ed(0x21b)][_0x7be7ed(0x1f3)](this[_0x7be7ed(0x21c)],_0x3ec1be),console[_0x7be7ed(0x1dc)](_0x7be7ed(0x1e9)+_0xeeaaa);}catch(_0x4caf07){console[_0x7be7ed(0x1f6)](_0x7be7ed(0x205),_0x4caf07);}}['getWebhookLogs'](_0x494ac7=0x32){const _0x4eedcb=a70_0x26da1d;try{if(!fs_1[_0x4eedcb(0x21b)]['existsSync'](this['webhookLogPath']))return[];const _0x572650=fs_1[_0x4eedcb(0x21b)][_0x4eedcb(0x1fc)](this['webhookLogPath'],_0x4eedcb(0x203)),_0x1891bd=_0x572650[_0x4eedcb(0x1e6)]()[_0x4eedcb(0x1f2)]('\x0a')['filter'](_0x28a34d=>_0x28a34d);return _0x1891bd[_0x4eedcb(0x218)](-_0x494ac7)[_0x4eedcb(0x214)](_0x1b895b=>{const _0x5e412d=_0x4eedcb;try{return JSON[_0x5e412d(0x208)](_0x1b895b);}catch{return null;}})[_0x4eedcb(0x21f)](_0x4f1529=>_0x4f1529!==null);}catch(_0x407f54){return console[_0x4eedcb(0x1f6)](_0x4eedcb(0x1ee),_0x407f54),[];}}}exports[a70_0x26da1d(0x1e1)]=SquirrelPayService;