'use strict';function a64_0xb6b8(_0x3e70bb,_0x4375d2){_0x3e70bb=_0x3e70bb-0x100;const _0x12c309=a64_0x12c3();let _0xb6b8c2=_0x12c309[_0x3e70bb];return _0xb6b8c2;}const a64_0x1d4c6a=a64_0xb6b8;(function(_0xc8d584,_0xf22d1d){const _0x1bbd2f=a64_0xb6b8,_0x2a9087=_0xc8d584();while(!![]){try{const _0x111e54=-parseInt(_0x1bbd2f(0x10c))/0x1+parseInt(_0x1bbd2f(0x103))/0x2+parseInt(_0x1bbd2f(0x10e))/0x3+parseInt(_0x1bbd2f(0x159))/0x4+-parseInt(_0x1bbd2f(0x130))/0x5*(-parseInt(_0x1bbd2f(0x14b))/0x6)+parseInt(_0x1bbd2f(0x108))/0x7+-parseInt(_0x1bbd2f(0x136))/0x8*(parseInt(_0x1bbd2f(0x11f))/0x9);if(_0x111e54===_0xf22d1d)break;else _0x2a9087['push'](_0x2a9087['shift']());}catch(_0x150fb4){_0x2a9087['push'](_0x2a9087['shift']());}}}(a64_0x12c3,0x85d46));var __importDefault=this&&this['__importDefault']||function(_0x4006e5){return _0x4006e5&&_0x4006e5['__esModule']?_0x4006e5:{'default':_0x4006e5};};Object[a64_0x1d4c6a(0x133)](exports,a64_0x1d4c6a(0x158),{'value':!![]}),exports[a64_0x1d4c6a(0x13f)]=void 0x0;const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require(a64_0x1d4c6a(0x119))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x1d4c6a(0x101)));class SquirrelPayService{constructor(_0x228107){const _0x5e506b=a64_0x1d4c6a;this[_0x5e506b(0x14f)]=_0x228107,this['webhookLogPath']=path_1['default'][_0x5e506b(0x139)](process[_0x5e506b(0x125)](),'logs',_0x5e506b(0x110));const _0x33372c=path_1[_0x5e506b(0x151)]['dirname'](this['webhookLogPath']);!fs_1['default'][_0x5e506b(0x140)](_0x33372c)&&fs_1[_0x5e506b(0x151)][_0x5e506b(0x145)](_0x33372c,{'recursive':!![]});}['getBasicAuth'](){const _0x3a9a4d=a64_0x1d4c6a,_0x5ede01=this[_0x3a9a4d(0x14f)][_0x3a9a4d(0x143)]+':'+this[_0x3a9a4d(0x14f)][_0x3a9a4d(0x102)];return Buffer[_0x3a9a4d(0x116)](_0x5ede01)[_0x3a9a4d(0x11d)](_0x3a9a4d(0x14a));}[a64_0x1d4c6a(0x115)](){const _0xde919b=a64_0x1d4c6a;return crypto_1[_0xde919b(0x151)][_0xde919b(0x112)]();}async['processCardPayment'](_0x1e5259,_0x5c0fdc,_0x438dd6,_0x565194,_0x1a8d8d,_0x5027ac,_0x5aadb7,_0x4d2708,_0x5044fc){const _0x26e538=a64_0x1d4c6a;console['log'](_0x26e538(0x11b)),console[_0x26e538(0x13d)](_0x26e538(0x144)+_0x1e5259+'\x20'+_0x5c0fdc),console[_0x26e538(0x13d)](_0x26e538(0x153)+_0x438dd6),console['log'](_0x26e538(0x121)+_0x5aadb7[_0x26e538(0x132)]+'\x20('+_0x5aadb7['ip']+')');const _0xd7bb31={'request':{'amount':_0x1e5259,'currency':_0x5c0fdc,'description':_0x438dd6,'gate_id':parseInt(this[_0x26e538(0x14f)][_0x26e538(0x143)]),'return_url':_0x565194,'notification_url':_0x1a8d8d,'credit_card':_0x5027ac,'customer':{'email':_0x5aadb7[_0x26e538(0x132)],'phone':_0x5044fc,'birth_date':_0x5aadb7['birth_date'],'billing':_0x4d2708},'test':this[_0x26e538(0x14f)][_0x26e538(0x156)]}},_0x46c8ef=this['generateRequestId'](),_0x5422b4={'Authorization':_0x26e538(0x126)+this[_0x26e538(0x122)](),'Content-Type':_0x26e538(0x10d),'Accept':_0x26e538(0x10d),'X-API-Version':'3','RequestID':_0x46c8ef};try{console[_0x26e538(0x13d)]('ğŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x26e538(0x13d)](_0x26e538(0x15a)+_0x46c8ef),console[_0x26e538(0x13d)](_0x26e538(0x146)+this[_0x26e538(0x14f)][_0x26e538(0x11a)]+_0x26e538(0x155)),console['log'](_0x26e538(0x14c),JSON[_0x26e538(0x118)](_0x5422b4,null,0x2)),console['log']('ğŸ“¦\x20Body:',JSON['stringify'](_0xd7bb31,null,0x2));const _0x4ca0bd=await(0x0,node_fetch_1[_0x26e538(0x151)])(this[_0x26e538(0x14f)][_0x26e538(0x11a)]+_0x26e538(0x155),{'method':_0x26e538(0x152),'headers':_0x5422b4,'body':JSON['stringify'](_0xd7bb31)}),_0x559a43=await _0x4ca0bd[_0x26e538(0x142)]();console['log'](_0x26e538(0x149)+_0x4ca0bd['status']),console['log'](_0x26e538(0x104)+_0x559a43);if(!_0x4ca0bd['ok'])throw new Error(_0x26e538(0x12a)+_0x4ca0bd[_0x26e538(0x105)]+'\x20'+_0x4ca0bd['statusText']+'\x20-\x20'+_0x559a43);const _0x1fca43=JSON[_0x26e538(0x13b)](_0x559a43);return console['log'](_0x26e538(0x128)),console[_0x26e538(0x13d)](_0x26e538(0x13a)+_0x1fca43[_0x26e538(0x127)]),console['log'](_0x26e538(0x113)+_0x1fca43[_0x26e538(0x105)]),console[_0x26e538(0x13d)](_0x26e538(0x12d)+_0x1fca43['code']),console[_0x26e538(0x13d)](_0x26e538(0x12f)+_0x1fca43[_0x26e538(0x148)]),console[_0x26e538(0x13d)]('\x20\x20\x20Gateway\x20ID:\x20'+_0x1fca43[_0x26e538(0x157)][_0x26e538(0x13c)]),console['log'](_0x26e538(0x11e)+_0x1fca43[_0x26e538(0x131)][_0x26e538(0x141)]),_0x1fca43[_0x26e538(0x11c)]&&console[_0x26e538(0x13d)](_0x26e538(0x134)+_0x1fca43[_0x26e538(0x11c)]),_0x1fca43;}catch(_0x123267){console[_0x26e538(0x13e)](_0x26e538(0x14d),_0x123267);throw _0x123267;}}['getPaymentStatus'](_0x40c530){const _0x251794=a64_0x1d4c6a,_0x3d80ce=_0x40c530[_0x251794(0x127)],_0x1752da=_0x40c530['payment_method'][_0x251794(0x141)];console[_0x251794(0x13d)](_0x251794(0x106)+_0x40c530[_0x251794(0x105)]);switch(_0x40c530['status']){case'successful':return{'status':_0x251794(0x107),'gatewayPaymentId':_0x3d80ce,'cardLast4':_0x1752da};case _0x251794(0x100):return{'status':_0x251794(0x154),'gatewayPaymentId':_0x3d80ce,'cardLast4':_0x1752da,'redirectUrl':_0x40c530['redirect_url']};case'failed':const _0x56c0be=_0x40c530[_0x251794(0x148)]||'',_0x50ee84=_0x40c530[_0x251794(0x123)]||'';let _0x109df4='';if(_0x56c0be&&_0x50ee84)_0x109df4=_0x56c0be+_0x251794(0x114)+_0x50ee84;else{if(_0x56c0be)_0x109df4=_0x56c0be;else _0x50ee84?_0x109df4=_0x50ee84:_0x109df4=_0x251794(0x135);}return{'status':'FAILED','failureMessage':_0x109df4,'gatewayPaymentId':_0x3d80ce,'cardLast4':_0x1752da};default:console['warn'](_0x251794(0x138)+_0x40c530[_0x251794(0x105)]);const _0x5c6aae=_0x40c530['friendly_message']||'',_0x1faaf4=_0x40c530[_0x251794(0x123)]||'';let _0x3738ec='';if(_0x5c6aae&&_0x1faaf4)_0x3738ec=_0x5c6aae+_0x251794(0x114)+_0x1faaf4;else{if(_0x5c6aae)_0x3738ec=_0x5c6aae;else _0x1faaf4?_0x3738ec=_0x1faaf4:_0x3738ec=_0x251794(0x12c);}return{'status':_0x251794(0x129),'failureMessage':_0x3738ec,'gatewayPaymentId':_0x3d80ce,'cardLast4':_0x1752da};}}[a64_0x1d4c6a(0x124)](_0x37fb54){const _0x26b631=a64_0x1d4c6a,_0x53d47e=new Date()['toISOString'](),_0x26eee4={'timestamp':_0x53d47e,'webhook':_0x37fb54,'source':_0x26b631(0x137)},_0xc9d237=JSON[_0x26b631(0x118)](_0x26eee4)+'\x0a';try{fs_1[_0x26b631(0x151)][_0x26b631(0x150)](this[_0x26b631(0x120)],_0xc9d237),console['log']('ğŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x53d47e);}catch(_0x126e6b){console[_0x26b631(0x13e)](_0x26b631(0x109),_0x126e6b);}}[a64_0x1d4c6a(0x10a)](_0x567d87=0x32){const _0x3321bf=a64_0x1d4c6a;try{if(!fs_1['default']['existsSync'](this['webhookLogPath']))return[];const _0x50d3c4=fs_1[_0x3321bf(0x151)][_0x3321bf(0x117)](this['webhookLogPath'],_0x3321bf(0x12b)),_0x22b6f5=_0x50d3c4[_0x3321bf(0x111)]()[_0x3321bf(0x147)]('\x0a')[_0x3321bf(0x12e)](_0x49d24c=>_0x49d24c);return _0x22b6f5[_0x3321bf(0x14e)](-_0x567d87)[_0x3321bf(0x10f)](_0x55d646=>{const _0x1fa072=_0x3321bf;try{return JSON[_0x1fa072(0x13b)](_0x55d646);}catch{return null;}})[_0x3321bf(0x12e)](_0x2b6cc3=>_0x2b6cc3!==null);}catch(_0x2ab272){return console['error'](_0x3321bf(0x10b),_0x2ab272),[];}}}exports[a64_0x1d4c6a(0x13f)]=SquirrelPayService;function a64_0x12c3(){const _0x2c1bc9=['ğŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','redirect_url','toString','\x20\x20\x20Last\x204:\x20','171ZvDUJR','webhookLogPath','ğŸ‘¤\x20Customer:\x20','getBasicAuth','message','logWebhook','cwd','Basic\x20','uid','âœ…\x20SquirrelPay\x20Response\x20Success:','FAILED','SquirrelPay\x20API\x20error:\x20','utf-8','Unknown\x20error','\x20\x20\x20Code:\x20','filter','\x20\x20\x20Message:\x20','11215cyVQMS','payment_method','email','defineProperty','ğŸ”„\x20Redirect\x20URL:\x20','Payment\x20failed','997856PhxnmV','squirrel-pay','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','join','\x20\x20\x20UID:\x20','parse','gateway_id','log','error','SquirrelPayService','existsSync','last_4','text','shopId','ğŸ’°\x20Amount:\x20','mkdirSync','ğŸ”—\x20URL:\x20','split','friendly_message','ğŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','base64','2724cbBglC','ğŸ”§\x20Headers:','âŒ\x20SquirrelPay\x20API\x20Error:','slice','config','appendFileSync','default','POST','ğŸ“\x20Description:\x20','PENDING','/transactions/payments','isTestMode','transaction','__esModule','23740TpWJSM','ğŸ“‹\x20Request\x20ID:\x20','incomplete','path','secretKey','1759770oAgalZ','ğŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','status','ğŸ”\x20Processing\x20SquirrelPay\x20status:\x20','PAID','2153172bNPFEO','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','getWebhookLogs','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','137375HJpsVC','application/json','2531133vVCzqt','map','squirrel-pay-webhooks.log','trim','randomUUID','\x20\x20\x20Status:\x20','\x20||\x20','generateRequestId','from','readFileSync','stringify','node-fetch','baseUrl'];a64_0x12c3=function(){return _0x2c1bc9;};return a64_0x12c3();}