'use strict';const a76_0x1c1169=a76_0x5148;function a76_0x5eca(){const _0x1679dc=['mkdirSync','\x20||\x20','getWebhookLogs','warn','shopId','secretKey','__esModule','crypto','appendFileSync','statusText','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','ðŸ‘¤\x20Customer:\x20','parse','\x20\x20\x20Last\x204:\x20','FAILED','1921050WvxYul','squirrel-pay','getPaymentStatus','text','status','application/json','trim','birth_date','friendly_message','slice','from','defineProperty','12mQSrok','logWebhook','redirect_url','payment_method','stringify','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','Unknown\x20error','getBasicAuth','1225090ZOFAvn','\x20\x20\x20UID:\x20','\x20\x20\x20Message:\x20','11vPoGKU','failed','uid','Payment\x20failed','map','join','SquirrelPay\x20API\x20error:\x20','POST','toString','email','219276kdeuYT','existsSync','1700700AetgVX','44UpmxXn','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','SquirrelPayService','PAID','ðŸ“¦\x20Body:','baseUrl','readFileSync','gateway_id','Basic\x20','webhookLogPath','__importDefault','24885kJjTdR','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','8kEMpFh','log','dirname','message','logs','default','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','\x20\x20\x20Code:\x20','111395eaddQw','\x20\x20\x20Status:\x20','ðŸ“‹\x20Request\x20ID:\x20','57869XvxCUN','error','cwd','config','ðŸ”—\x20URL:\x20','ðŸ’°\x20Amount:\x20','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','successful','generateRequestId','path','âœ…\x20SquirrelPay\x20Response\x20Success:','filter','randomUUID','/transactions/payments','ðŸ“\x20Description:\x20','processCardPayment'];a76_0x5eca=function(){return _0x1679dc;};return a76_0x5eca();}function a76_0x5148(_0x1ba265,_0x1a0d6e){_0x1ba265=_0x1ba265-0x1e8;const _0x5eca75=a76_0x5eca();let _0x514851=_0x5eca75[_0x1ba265];return _0x514851;}(function(_0x38da77,_0x5c7085){const _0x4ade6f=a76_0x5148,_0x56f121=_0x38da77();while(!![]){try{const _0x15093d=-parseInt(_0x4ade6f(0x22d))/0x1*(parseInt(_0x4ade6f(0x20a))/0x2)+-parseInt(_0x4ade6f(0x21f))/0x3+-parseInt(_0x4ade6f(0x222))/0x4*(parseInt(_0x4ade6f(0x238))/0x5)+parseInt(_0x4ade6f(0x221))/0x6+-parseInt(_0x4ade6f(0x23b))/0x7*(parseInt(_0x4ade6f(0x230))/0x8)+parseInt(_0x4ade6f(0x1fe))/0x9+-parseInt(_0x4ade6f(0x212))/0xa*(-parseInt(_0x4ade6f(0x215))/0xb);if(_0x15093d===_0x5c7085)break;else _0x56f121['push'](_0x56f121['shift']());}catch(_0x310286){_0x56f121['push'](_0x56f121['shift']());}}}(a76_0x5eca,0x23137));var __importDefault=this&&this[a76_0x1c1169(0x22c)]||function(_0x1faa5f){return _0x1faa5f&&_0x1faa5f['__esModule']?_0x1faa5f:{'default':_0x1faa5f};};Object[a76_0x1c1169(0x209)](exports,a76_0x1c1169(0x1f4),{'value':!![]}),exports[a76_0x1c1169(0x224)]=void 0x0;const crypto_1=__importDefault(require(a76_0x1c1169(0x1f5))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x1c1169(0x244)));class SquirrelPayService{constructor(_0x2d2046){const _0x47641f=a76_0x1c1169;this[_0x47641f(0x23e)]=_0x2d2046,this[_0x47641f(0x22b)]=path_1[_0x47641f(0x235)][_0x47641f(0x21a)](process[_0x47641f(0x23d)](),_0x47641f(0x234),'squirrel-pay-webhooks.log');const _0xe465d6=path_1['default'][_0x47641f(0x232)](this[_0x47641f(0x22b)]);!fs_1[_0x47641f(0x235)][_0x47641f(0x220)](_0xe465d6)&&fs_1[_0x47641f(0x235)][_0x47641f(0x1ee)](_0xe465d6,{'recursive':!![]});}[a76_0x1c1169(0x211)](){const _0x2eb097=a76_0x1c1169,_0x8263cb=this[_0x2eb097(0x23e)][_0x2eb097(0x1f2)]+':'+this[_0x2eb097(0x23e)][_0x2eb097(0x1f3)];return Buffer[_0x2eb097(0x208)](_0x8263cb)[_0x2eb097(0x21d)]('base64');}[a76_0x1c1169(0x243)](){const _0xe9f8f0=a76_0x1c1169;return crypto_1[_0xe9f8f0(0x235)][_0xe9f8f0(0x1ea)]();}async[a76_0x1c1169(0x1ed)](_0x30ecdc,_0x54e0da,_0x3432bc,_0x1f4c3c,_0x56f965,_0x962bfc,_0x2f4764,_0x42b868,_0x34a11d){const _0x4c0e76=a76_0x1c1169;console[_0x4c0e76(0x231)](_0x4c0e76(0x223)),console[_0x4c0e76(0x231)](_0x4c0e76(0x240)+_0x30ecdc+'\x20'+_0x54e0da),console['log'](_0x4c0e76(0x1ec)+_0x3432bc),console[_0x4c0e76(0x231)](_0x4c0e76(0x1fa)+_0x2f4764[_0x4c0e76(0x21e)]+'\x20('+_0x2f4764['ip']+')');const _0xb65c37={'request':{'amount':_0x30ecdc,'currency':_0x54e0da,'description':_0x3432bc,'gate_id':parseInt(this[_0x4c0e76(0x23e)][_0x4c0e76(0x1f2)]),'return_url':_0x1f4c3c,'notification_url':_0x56f965,'credit_card':_0x962bfc,'customer':{'email':_0x2f4764[_0x4c0e76(0x21e)],'phone':_0x34a11d,'birth_date':_0x2f4764[_0x4c0e76(0x205)],'billing':_0x42b868},'test':this[_0x4c0e76(0x23e)]['isTestMode']}},_0x545d54=this[_0x4c0e76(0x243)](),_0x4bd6de={'Authorization':_0x4c0e76(0x22a)+this[_0x4c0e76(0x211)](),'Content-Type':_0x4c0e76(0x203),'Accept':_0x4c0e76(0x203),'X-API-Version':'3','RequestID':_0x545d54};try{console[_0x4c0e76(0x231)](_0x4c0e76(0x241)),console[_0x4c0e76(0x231)](_0x4c0e76(0x23a)+_0x545d54),console[_0x4c0e76(0x231)](_0x4c0e76(0x23f)+this[_0x4c0e76(0x23e)][_0x4c0e76(0x227)]+_0x4c0e76(0x1eb)),console[_0x4c0e76(0x231)]('ðŸ”§\x20Headers:',JSON[_0x4c0e76(0x20e)](_0x4bd6de,null,0x2)),console['log'](_0x4c0e76(0x226),JSON['stringify'](_0xb65c37,null,0x2));const _0x4c66ef=await(0x0,node_fetch_1['default'])(this[_0x4c0e76(0x23e)][_0x4c0e76(0x227)]+'/transactions/payments',{'method':_0x4c0e76(0x21c),'headers':_0x4bd6de,'body':JSON['stringify'](_0xb65c37)}),_0x1b104f=await _0x4c66ef[_0x4c0e76(0x201)]();console[_0x4c0e76(0x231)](_0x4c0e76(0x22f)+_0x4c66ef['status']),console['log'](_0x4c0e76(0x20f)+_0x1b104f);if(!_0x4c66ef['ok'])throw new Error(_0x4c0e76(0x21b)+_0x4c66ef[_0x4c0e76(0x202)]+'\x20'+_0x4c66ef[_0x4c0e76(0x1f7)]+'\x20-\x20'+_0x1b104f);const _0x9529a=JSON[_0x4c0e76(0x1fb)](_0x1b104f);return console[_0x4c0e76(0x231)](_0x4c0e76(0x1e8)),console[_0x4c0e76(0x231)](_0x4c0e76(0x213)+_0x9529a[_0x4c0e76(0x217)]),console[_0x4c0e76(0x231)](_0x4c0e76(0x239)+_0x9529a[_0x4c0e76(0x202)]),console['log'](_0x4c0e76(0x237)+_0x9529a['code']),console[_0x4c0e76(0x231)](_0x4c0e76(0x214)+_0x9529a[_0x4c0e76(0x206)]),console['log']('\x20\x20\x20Gateway\x20ID:\x20'+_0x9529a['transaction'][_0x4c0e76(0x229)]),console[_0x4c0e76(0x231)](_0x4c0e76(0x1fc)+_0x9529a[_0x4c0e76(0x20d)]['last_4']),_0x9529a[_0x4c0e76(0x20c)]&&console[_0x4c0e76(0x231)]('ðŸ”„\x20Redirect\x20URL:\x20'+_0x9529a[_0x4c0e76(0x20c)]),_0x9529a;}catch(_0x988ef9){console[_0x4c0e76(0x23c)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x988ef9);throw _0x988ef9;}}[a76_0x1c1169(0x200)](_0x576a9a){const _0x3e9c7c=a76_0x1c1169,_0x332766=_0x576a9a['uid'],_0x2d0a2d=_0x576a9a['payment_method']['last_4'];console[_0x3e9c7c(0x231)](_0x3e9c7c(0x1f9)+_0x576a9a[_0x3e9c7c(0x202)]);switch(_0x576a9a[_0x3e9c7c(0x202)]){case _0x3e9c7c(0x242):return{'status':_0x3e9c7c(0x225),'gatewayPaymentId':_0x332766,'cardLast4':_0x2d0a2d};case'incomplete':return{'status':'PENDING','gatewayPaymentId':_0x332766,'cardLast4':_0x2d0a2d,'redirectUrl':_0x576a9a[_0x3e9c7c(0x20c)]};case _0x3e9c7c(0x216):const _0x156e79=_0x576a9a['friendly_message']||'',_0x4cac28=_0x576a9a[_0x3e9c7c(0x233)]||'';let _0x31c077='';if(_0x156e79&&_0x4cac28)_0x31c077=_0x156e79+_0x3e9c7c(0x1ef)+_0x4cac28;else{if(_0x156e79)_0x31c077=_0x156e79;else _0x4cac28?_0x31c077=_0x4cac28:_0x31c077=_0x3e9c7c(0x218);}return{'status':_0x3e9c7c(0x1fd),'failureMessage':_0x31c077,'gatewayPaymentId':_0x332766,'cardLast4':_0x2d0a2d};default:console[_0x3e9c7c(0x1f1)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x576a9a['status']);const _0x5597b7=_0x576a9a[_0x3e9c7c(0x206)]||'',_0x529e8a=_0x576a9a[_0x3e9c7c(0x233)]||'';let _0x9a8c50='';if(_0x5597b7&&_0x529e8a)_0x9a8c50=_0x5597b7+_0x3e9c7c(0x1ef)+_0x529e8a;else{if(_0x5597b7)_0x9a8c50=_0x5597b7;else _0x529e8a?_0x9a8c50=_0x529e8a:_0x9a8c50=_0x3e9c7c(0x210);}return{'status':_0x3e9c7c(0x1fd),'failureMessage':_0x9a8c50,'gatewayPaymentId':_0x332766,'cardLast4':_0x2d0a2d};}}[a76_0x1c1169(0x20b)](_0x5b23ae){const _0x1e5d2d=a76_0x1c1169,_0x13e1d4=new Date()['toISOString'](),_0x2c58ba={'timestamp':_0x13e1d4,'webhook':_0x5b23ae,'source':_0x1e5d2d(0x1ff)},_0x13590f=JSON[_0x1e5d2d(0x20e)](_0x2c58ba)+'\x0a';try{fs_1[_0x1e5d2d(0x235)][_0x1e5d2d(0x1f6)](this[_0x1e5d2d(0x22b)],_0x13590f),console['log'](_0x1e5d2d(0x236)+_0x13e1d4);}catch(_0x13348b){console['error'](_0x1e5d2d(0x22e),_0x13348b);}}[a76_0x1c1169(0x1f0)](_0x3bcc88=0x32){const _0x36d34a=a76_0x1c1169;try{if(!fs_1[_0x36d34a(0x235)][_0x36d34a(0x220)](this['webhookLogPath']))return[];const _0x1391c5=fs_1[_0x36d34a(0x235)][_0x36d34a(0x228)](this[_0x36d34a(0x22b)],'utf-8'),_0x1372ac=_0x1391c5[_0x36d34a(0x204)]()['split']('\x0a')['filter'](_0x2cc7a9=>_0x2cc7a9);return _0x1372ac[_0x36d34a(0x207)](-_0x3bcc88)[_0x36d34a(0x219)](_0xa8c25d=>{const _0x52eeb8=_0x36d34a;try{return JSON[_0x52eeb8(0x1fb)](_0xa8c25d);}catch{return null;}})[_0x36d34a(0x1e9)](_0x218bfa=>_0x218bfa!==null);}catch(_0x2edb22){return console[_0x36d34a(0x23c)](_0x36d34a(0x1f8),_0x2edb22),[];}}}exports[a76_0x1c1169(0x224)]=SquirrelPayService;