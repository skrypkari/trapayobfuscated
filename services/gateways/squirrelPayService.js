'use strict';const a68_0x4133ef=a68_0x4dc5;(function(_0x2fd061,_0x32b61c){const _0x110d47=a68_0x4dc5,_0x2423ef=_0x2fd061();while(!![]){try{const _0x26ecad=-parseInt(_0x110d47(0xba))/0x1*(-parseInt(_0x110d47(0xdf))/0x2)+-parseInt(_0x110d47(0xb8))/0x3*(-parseInt(_0x110d47(0xd9))/0x4)+-parseInt(_0x110d47(0xc0))/0x5+parseInt(_0x110d47(0xd0))/0x6*(parseInt(_0x110d47(0xe8))/0x7)+parseInt(_0x110d47(0xf2))/0x8*(-parseInt(_0x110d47(0xf9))/0x9)+parseInt(_0x110d47(0xb3))/0xa*(-parseInt(_0x110d47(0xb7))/0xb)+parseInt(_0x110d47(0xc5))/0xc;if(_0x26ecad===_0x32b61c)break;else _0x2423ef['push'](_0x2423ef['shift']());}catch(_0x39f107){_0x2423ef['push'](_0x2423ef['shift']());}}}(a68_0x202b,0xa710b));var __importDefault=this&&this[a68_0x4133ef(0xd1)]||function(_0x1678f8){return _0x1678f8&&_0x1678f8['__esModule']?_0x1678f8:{'default':_0x1678f8};};Object['defineProperty'](exports,a68_0x4133ef(0xab),{'value':!![]}),exports[a68_0x4133ef(0xad)]=void 0x0;function a68_0x4dc5(_0x3fae1d,_0x3bbc6d){_0x3fae1d=_0x3fae1d-0x9e;const _0x202b4f=a68_0x202b();let _0x4dc54e=_0x202b4f[_0x3fae1d];return _0x4dc54e;}function a68_0x202b(){const _0x634459=['275902ozMOrf','277545jcROXu','ðŸ’°\x20Amount:\x20','11RMVPLL','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','\x20\x20\x20Last\x204:\x20','logWebhook','warn','last_4','5940640TmlqhI','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','split','shopId','transaction','36682740XFZBeO','ðŸ“\x20Description:\x20','secretKey','appendFileSync','config','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','log','map','from','âŒ\x20SquirrelPay\x20API\x20Error:','randomUUID','2376024iYbsfP','__importDefault','path','dirname','ðŸ“‹\x20Request\x20ID:\x20','PAID','parse','stringify','incomplete','4CZOvcE','\x20-\x20','getBasicAuth','\x20\x20\x20Code:\x20','toISOString','cwd','99406ohqXfZ','text','utf-8','/transactions/payments','âœ…\x20SquirrelPay\x20Response\x20Success:','payment_method','webhookLogPath','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','ðŸ‘¤\x20Customer:\x20','7gNtxEq','friendly_message','PENDING','ðŸ”—\x20URL:\x20','birth_date','statusText','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','code','successful','ðŸ”§\x20Headers:','4163464zIFeec','baseUrl','node-fetch','squirrel-pay','ðŸ”„\x20Redirect\x20URL:\x20','squirrel-pay-webhooks.log','default','18aXdbyT','FAILED','message','toString','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','mkdirSync','Payment\x20failed','getPaymentStatus','generateRequestId','join','crypto','failed','Unknown\x20error','\x20\x20\x20Message:\x20','redirect_url','uid','__esModule','error','SquirrelPayService','getWebhookLogs','email','Basic\x20','processCardPayment','status','470aQqlrG','filter','existsSync','\x20||\x20'];a68_0x202b=function(){return _0x634459;};return a68_0x202b();}const crypto_1=__importDefault(require(a68_0x4133ef(0xa5))),node_fetch_1=__importDefault(require(a68_0x4133ef(0xf4))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x4133ef(0xd2)));class SquirrelPayService{constructor(_0xd83570){const _0x4fd55b=a68_0x4133ef;this[_0x4fd55b(0xc9)]=_0xd83570,this['webhookLogPath']=path_1[_0x4fd55b(0xf8)][_0x4fd55b(0xa4)](process[_0x4fd55b(0xde)](),'logs',_0x4fd55b(0xf7));const _0x4116e5=path_1['default'][_0x4fd55b(0xd3)](this['webhookLogPath']);!fs_1['default'][_0x4fd55b(0xb5)](_0x4116e5)&&fs_1[_0x4fd55b(0xf8)][_0x4fd55b(0xa0)](_0x4116e5,{'recursive':!![]});}[a68_0x4133ef(0xdb)](){const _0x3dc935=a68_0x4133ef,_0x20105e=this['config'][_0x3dc935(0xc3)]+':'+this[_0x3dc935(0xc9)][_0x3dc935(0xc7)];return Buffer[_0x3dc935(0xcd)](_0x20105e)[_0x3dc935(0x9e)]('base64');}[a68_0x4133ef(0xa3)](){const _0x4bb760=a68_0x4133ef;return crypto_1[_0x4bb760(0xf8)][_0x4bb760(0xcf)]();}async[a68_0x4133ef(0xb1)](_0x38c2a7,_0x3f5cb9,_0x4f4aee,_0x360192,_0x48cec6,_0x241921,_0x5a8c08,_0x1083cc,_0x293539){const _0x54777d=a68_0x4133ef;console[_0x54777d(0xcb)](_0x54777d(0xca)),console[_0x54777d(0xcb)](_0x54777d(0xb9)+_0x38c2a7+'\x20'+_0x3f5cb9),console[_0x54777d(0xcb)](_0x54777d(0xc6)+_0x4f4aee),console['log'](_0x54777d(0xe7)+_0x5a8c08['email']+'\x20('+_0x5a8c08['ip']+')');const _0x2dc2d0={'request':{'amount':_0x38c2a7,'currency':_0x3f5cb9,'description':_0x4f4aee,'gate_id':parseInt(this[_0x54777d(0xc9)][_0x54777d(0xc3)]),'return_url':_0x360192,'notification_url':_0x48cec6,'credit_card':_0x241921,'customer':{'email':_0x5a8c08[_0x54777d(0xaf)],'phone':_0x293539,'birth_date':_0x5a8c08[_0x54777d(0xec)],'billing':_0x1083cc},'test':this[_0x54777d(0xc9)]['isTestMode']}},_0x2e3ef8=this[_0x54777d(0xa3)](),_0x58f460={'Authorization':_0x54777d(0xb0)+this[_0x54777d(0xdb)](),'Content-Type':'application/json','Accept':'application/json','X-API-Version':'3','RequestID':_0x2e3ef8};try{console[_0x54777d(0xcb)](_0x54777d(0xe6)),console['log'](_0x54777d(0xd4)+_0x2e3ef8),console['log'](_0x54777d(0xeb)+this[_0x54777d(0xc9)][_0x54777d(0xf3)]+'/transactions/payments'),console[_0x54777d(0xcb)](_0x54777d(0xf1),JSON[_0x54777d(0xd7)](_0x58f460,null,0x2)),console[_0x54777d(0xcb)]('ðŸ“¦\x20Body:',JSON[_0x54777d(0xd7)](_0x2dc2d0,null,0x2));const _0x560ca3=await(0x0,node_fetch_1[_0x54777d(0xf8)])(this[_0x54777d(0xc9)][_0x54777d(0xf3)]+_0x54777d(0xe2),{'method':'POST','headers':_0x58f460,'body':JSON['stringify'](_0x2dc2d0)}),_0x5ed092=await _0x560ca3[_0x54777d(0xe0)]();console[_0x54777d(0xcb)]('ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20'+_0x560ca3[_0x54777d(0xb2)]),console[_0x54777d(0xcb)](_0x54777d(0xee)+_0x5ed092);if(!_0x560ca3['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x560ca3[_0x54777d(0xb2)]+'\x20'+_0x560ca3[_0x54777d(0xed)]+_0x54777d(0xda)+_0x5ed092);const _0x2f7ffe=JSON[_0x54777d(0xd6)](_0x5ed092);return console[_0x54777d(0xcb)](_0x54777d(0xe3)),console['log']('\x20\x20\x20UID:\x20'+_0x2f7ffe[_0x54777d(0xaa)]),console[_0x54777d(0xcb)]('\x20\x20\x20Status:\x20'+_0x2f7ffe[_0x54777d(0xb2)]),console[_0x54777d(0xcb)](_0x54777d(0xdc)+_0x2f7ffe[_0x54777d(0xef)]),console[_0x54777d(0xcb)](_0x54777d(0xa8)+_0x2f7ffe[_0x54777d(0xe9)]),console['log']('\x20\x20\x20Gateway\x20ID:\x20'+_0x2f7ffe[_0x54777d(0xc4)]['gateway_id']),console[_0x54777d(0xcb)](_0x54777d(0xbc)+_0x2f7ffe[_0x54777d(0xe4)]['last_4']),_0x2f7ffe[_0x54777d(0xa9)]&&console['log'](_0x54777d(0xf6)+_0x2f7ffe['redirect_url']),_0x2f7ffe;}catch(_0x21a41d){console[_0x54777d(0xac)](_0x54777d(0xce),_0x21a41d);throw _0x21a41d;}}[a68_0x4133ef(0xa2)](_0x48d58c){const _0x3e2cac=a68_0x4133ef,_0x40967a=_0x48d58c[_0x3e2cac(0xaa)],_0x33fe82=_0x48d58c[_0x3e2cac(0xe4)][_0x3e2cac(0xbf)];console['log']('ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x48d58c[_0x3e2cac(0xb2)]);switch(_0x48d58c[_0x3e2cac(0xb2)]){case _0x3e2cac(0xf0):return{'status':_0x3e2cac(0xd5),'gatewayPaymentId':_0x40967a,'cardLast4':_0x33fe82};case _0x3e2cac(0xd8):return{'status':_0x3e2cac(0xea),'gatewayPaymentId':_0x40967a,'cardLast4':_0x33fe82,'redirectUrl':_0x48d58c['redirect_url']};case _0x3e2cac(0xa6):const _0x1504ae=_0x48d58c[_0x3e2cac(0xe9)]||'',_0xbd10a4=_0x48d58c[_0x3e2cac(0xfb)]||'';let _0x2391b5='';if(_0x1504ae&&_0xbd10a4)_0x2391b5=_0x1504ae+_0x3e2cac(0xb6)+_0xbd10a4;else{if(_0x1504ae)_0x2391b5=_0x1504ae;else _0xbd10a4?_0x2391b5=_0xbd10a4:_0x2391b5=_0x3e2cac(0xa1);}return{'status':'FAILED','failureMessage':_0x2391b5,'gatewayPaymentId':_0x40967a,'cardLast4':_0x33fe82};default:console[_0x3e2cac(0xbe)](_0x3e2cac(0xc1)+_0x48d58c[_0x3e2cac(0xb2)]);const _0x28a471=_0x48d58c[_0x3e2cac(0xe9)]||'',_0x519e79=_0x48d58c['message']||'';let _0x5b5262='';if(_0x28a471&&_0x519e79)_0x5b5262=_0x28a471+'\x20||\x20'+_0x519e79;else{if(_0x28a471)_0x5b5262=_0x28a471;else _0x519e79?_0x5b5262=_0x519e79:_0x5b5262=_0x3e2cac(0xa7);}return{'status':_0x3e2cac(0xfa),'failureMessage':_0x5b5262,'gatewayPaymentId':_0x40967a,'cardLast4':_0x33fe82};}}[a68_0x4133ef(0xbd)](_0x437565){const _0x55e274=a68_0x4133ef,_0xfa7802=new Date()[_0x55e274(0xdd)](),_0x38683f={'timestamp':_0xfa7802,'webhook':_0x437565,'source':_0x55e274(0xf5)},_0x1e4fc7=JSON[_0x55e274(0xd7)](_0x38683f)+'\x0a';try{fs_1[_0x55e274(0xf8)][_0x55e274(0xc8)](this[_0x55e274(0xe5)],_0x1e4fc7),console[_0x55e274(0xcb)](_0x55e274(0x9f)+_0xfa7802);}catch(_0x2d4665){console['error']('âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:',_0x2d4665);}}[a68_0x4133ef(0xae)](_0xd82dfa=0x32){const _0x1626f7=a68_0x4133ef;try{if(!fs_1['default'][_0x1626f7(0xb5)](this['webhookLogPath']))return[];const _0x24b59f=fs_1[_0x1626f7(0xf8)]['readFileSync'](this[_0x1626f7(0xe5)],_0x1626f7(0xe1)),_0x4abdec=_0x24b59f['trim']()[_0x1626f7(0xc2)]('\x0a')['filter'](_0x34a1a9=>_0x34a1a9);return _0x4abdec['slice'](-_0xd82dfa)[_0x1626f7(0xcc)](_0x233e85=>{const _0x4bfb11=_0x1626f7;try{return JSON[_0x4bfb11(0xd6)](_0x233e85);}catch{return null;}})[_0x1626f7(0xb4)](_0x39d3a2=>_0x39d3a2!==null);}catch(_0x4cbbda){return console[_0x1626f7(0xac)](_0x1626f7(0xbb),_0x4cbbda),[];}}}exports[a68_0x4133ef(0xad)]=SquirrelPayService;