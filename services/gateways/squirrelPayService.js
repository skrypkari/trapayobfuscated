'use strict';function a76_0x2359(_0x276938,_0xac79b6){_0x276938=_0x276938-0xfb;const _0x35d080=a76_0x35d0();let _0x23591f=_0x35d080[_0x276938];return _0x23591f;}const a76_0x2f906e=a76_0x2359;(function(_0x13253e,_0x5d851d){const _0x5f3725=a76_0x2359,_0x4f53f1=_0x13253e();while(!![]){try{const _0x2766be=-parseInt(_0x5f3725(0x119))/0x1+-parseInt(_0x5f3725(0x121))/0x2+parseInt(_0x5f3725(0x100))/0x3*(parseInt(_0x5f3725(0x10b))/0x4)+parseInt(_0x5f3725(0x131))/0x5*(-parseInt(_0x5f3725(0x117))/0x6)+-parseInt(_0x5f3725(0x104))/0x7*(parseInt(_0x5f3725(0x139))/0x8)+-parseInt(_0x5f3725(0x141))/0x9+parseInt(_0x5f3725(0x133))/0xa*(parseInt(_0x5f3725(0x135))/0xb);if(_0x2766be===_0x5d851d)break;else _0x4f53f1['push'](_0x4f53f1['shift']());}catch(_0x4dcda9){_0x4f53f1['push'](_0x4f53f1['shift']());}}}(a76_0x35d0,0x45c36));var __importDefault=this&&this['__importDefault']||function(_0x3eb9a9){const _0x12e371=a76_0x2359;return _0x3eb9a9&&_0x3eb9a9[_0x12e371(0x110)]?_0x3eb9a9:{'default':_0x3eb9a9};};function a76_0x35d0(){const _0x4059aa=['failed','PAID','ðŸ“\x20Description:\x20','444JIoOqq','getBasicAuth','code','birth_date','successful','__esModule','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','parse','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','map','error','Payment\x20failed','832698IQZEGu','toISOString','552543MBOaum','/transactions/payments','warn','cwd','processCardPayment','\x20\x20\x20UID:\x20','payment_method','gateway_id','107378yBGUez','transaction','node-fetch','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','SquirrelPayService','FAILED','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','toString','logWebhook','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','log','default','incomplete','\x20||\x20','redirect_url','webhookLogPath','15QfFmWS','split','520DRyjIo','friendly_message','293931htcJYd','shopId','statusText','existsSync','8aPlpvy','message','email','ðŸ”§\x20Headers:','ðŸ“‹\x20Request\x20ID:\x20','baseUrl','randomUUID','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','2556072ryuEve','\x20-\x20','âŒ\x20SquirrelPay\x20API\x20Error:','slice','secretKey','ðŸ”„\x20Redirect\x20URL:\x20','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','defineProperty','config','generateRequestId','stringify','status','application/json','last_4','ðŸ’°\x20Amount:\x20','filter','Unknown\x20error','\x20\x20\x20Code:\x20','squirrel-pay-webhooks.log','text','10458yWMnXz','dirname','ðŸ“¦\x20Body:','\x20\x20\x20Status:\x20','1288693tTAGME','\x20\x20\x20Last\x204:\x20','logs','\x20\x20\x20Message:\x20'];a76_0x35d0=function(){return _0x4059aa;};return a76_0x35d0();}Object[a76_0x2f906e(0x148)](exports,a76_0x2f906e(0x110),{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require('crypto')),node_fetch_1=__importDefault(require(a76_0x2f906e(0x123))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0x8c35){const _0x2b03a5=a76_0x2f906e;this[_0x2b03a5(0x149)]=_0x8c35,this[_0x2b03a5(0x130)]=path_1[_0x2b03a5(0x12c)]['join'](process[_0x2b03a5(0x11c)](),_0x2b03a5(0x106),_0x2b03a5(0xfe));const _0x59468d=path_1[_0x2b03a5(0x12c)][_0x2b03a5(0x101)](this[_0x2b03a5(0x130)]);!fs_1[_0x2b03a5(0x12c)]['existsSync'](_0x59468d)&&fs_1[_0x2b03a5(0x12c)]['mkdirSync'](_0x59468d,{'recursive':!![]});}[a76_0x2f906e(0x10c)](){const _0x27b724=a76_0x2f906e,_0x3e5d03=this[_0x27b724(0x149)][_0x27b724(0x136)]+':'+this['config'][_0x27b724(0x145)];return Buffer['from'](_0x3e5d03)[_0x27b724(0x128)]('base64');}[a76_0x2f906e(0x14a)](){const _0x342bad=a76_0x2f906e;return crypto_1[_0x342bad(0x12c)][_0x342bad(0x13f)]();}async[a76_0x2f906e(0x11d)](_0x24cb54,_0x2cb42e,_0x1fca69,_0x5ce95f,_0x4a8927,_0x398a60,_0x33723d,_0x3994bd,_0x3fdafd){const _0x4b3054=a76_0x2f906e;console[_0x4b3054(0x12b)]('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console[_0x4b3054(0x12b)](_0x4b3054(0x14f)+_0x24cb54+'\x20'+_0x2cb42e),console['log'](_0x4b3054(0x10a)+_0x1fca69),console[_0x4b3054(0x12b)]('ðŸ‘¤\x20Customer:\x20'+_0x33723d[_0x4b3054(0x13b)]+'\x20('+_0x33723d['ip']+')');const _0x135bdb={'request':{'amount':_0x24cb54,'currency':_0x2cb42e,'description':_0x1fca69,'gate_id':parseInt(this[_0x4b3054(0x149)][_0x4b3054(0x136)]),'return_url':_0x5ce95f,'notification_url':_0x4a8927,'credit_card':_0x398a60,'customer':{'email':_0x33723d[_0x4b3054(0x13b)],'phone':_0x3fdafd,'birth_date':_0x33723d[_0x4b3054(0x10e)],'billing':_0x3994bd},'test':this[_0x4b3054(0x149)]['isTestMode']}},_0x287b36=this[_0x4b3054(0x14a)](),_0x3f529d={'Authorization':'Basic\x20'+this[_0x4b3054(0x10c)](),'Content-Type':'application/json','Accept':_0x4b3054(0x14d),'X-API-Version':'3','RequestID':_0x287b36};try{console['log'](_0x4b3054(0x113)),console[_0x4b3054(0x12b)](_0x4b3054(0x13d)+_0x287b36),console[_0x4b3054(0x12b)]('ðŸ”—\x20URL:\x20'+this[_0x4b3054(0x149)][_0x4b3054(0x13e)]+_0x4b3054(0x11a)),console[_0x4b3054(0x12b)](_0x4b3054(0x13c),JSON[_0x4b3054(0x14b)](_0x3f529d,null,0x2)),console['log'](_0x4b3054(0x102),JSON[_0x4b3054(0x14b)](_0x135bdb,null,0x2));const _0x3c07ee=await(0x0,node_fetch_1['default'])(this[_0x4b3054(0x149)][_0x4b3054(0x13e)]+_0x4b3054(0x11a),{'method':'POST','headers':_0x3f529d,'body':JSON[_0x4b3054(0x14b)](_0x135bdb)}),_0x3b0bff=await _0x3c07ee[_0x4b3054(0xff)]();console[_0x4b3054(0x12b)](_0x4b3054(0x127)+_0x3c07ee[_0x4b3054(0x14c)]),console[_0x4b3054(0x12b)](_0x4b3054(0x147)+_0x3b0bff);if(!_0x3c07ee['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x3c07ee[_0x4b3054(0x14c)]+'\x20'+_0x3c07ee[_0x4b3054(0x137)]+_0x4b3054(0x142)+_0x3b0bff);const _0x511b77=JSON[_0x4b3054(0x112)](_0x3b0bff);return console[_0x4b3054(0x12b)]('âœ…\x20SquirrelPay\x20Response\x20Success:'),console['log'](_0x4b3054(0x11e)+_0x511b77['uid']),console['log'](_0x4b3054(0x103)+_0x511b77['status']),console[_0x4b3054(0x12b)](_0x4b3054(0xfd)+_0x511b77[_0x4b3054(0x10d)]),console[_0x4b3054(0x12b)](_0x4b3054(0x107)+_0x511b77['friendly_message']),console[_0x4b3054(0x12b)]('\x20\x20\x20Gateway\x20ID:\x20'+_0x511b77[_0x4b3054(0x122)][_0x4b3054(0x120)]),console[_0x4b3054(0x12b)](_0x4b3054(0x105)+_0x511b77[_0x4b3054(0x11f)][_0x4b3054(0x14e)]),_0x511b77[_0x4b3054(0x12f)]&&console[_0x4b3054(0x12b)](_0x4b3054(0x146)+_0x511b77[_0x4b3054(0x12f)]),_0x511b77;}catch(_0x568401){console['error'](_0x4b3054(0x143),_0x568401);throw _0x568401;}}['getPaymentStatus'](_0x3f2073){const _0x5a535d=a76_0x2f906e,_0x40a22e=_0x3f2073['uid'],_0x48d542=_0x3f2073['payment_method']['last_4'];console['log'](_0x5a535d(0x12a)+_0x3f2073['status']);switch(_0x3f2073['status']){case _0x5a535d(0x10f):return{'status':_0x5a535d(0x109),'gatewayPaymentId':_0x40a22e,'cardLast4':_0x48d542};case _0x5a535d(0x12d):return{'status':'PENDING','gatewayPaymentId':_0x40a22e,'cardLast4':_0x48d542,'redirectUrl':_0x3f2073['redirect_url']};case _0x5a535d(0x108):const _0x55a36d=_0x3f2073['friendly_message']||'',_0x3b7ca2=_0x3f2073['message']||'';let _0x5b9e13='';if(_0x55a36d&&_0x3b7ca2)_0x5b9e13=_0x55a36d+_0x5a535d(0x12e)+_0x3b7ca2;else{if(_0x55a36d)_0x5b9e13=_0x55a36d;else _0x3b7ca2?_0x5b9e13=_0x3b7ca2:_0x5b9e13=_0x5a535d(0x116);}return{'status':_0x5a535d(0x126),'failureMessage':_0x5b9e13,'gatewayPaymentId':_0x40a22e,'cardLast4':_0x48d542};default:console[_0x5a535d(0x11b)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x3f2073[_0x5a535d(0x14c)]);const _0x1b1b54=_0x3f2073[_0x5a535d(0x134)]||'',_0x3339af=_0x3f2073[_0x5a535d(0x13a)]||'';let _0x335990='';if(_0x1b1b54&&_0x3339af)_0x335990=_0x1b1b54+_0x5a535d(0x12e)+_0x3339af;else{if(_0x1b1b54)_0x335990=_0x1b1b54;else _0x3339af?_0x335990=_0x3339af:_0x335990=_0x5a535d(0xfc);}return{'status':_0x5a535d(0x126),'failureMessage':_0x335990,'gatewayPaymentId':_0x40a22e,'cardLast4':_0x48d542};}}[a76_0x2f906e(0x129)](_0x25f22b){const _0x350627=a76_0x2f906e,_0x3b0230=new Date()[_0x350627(0x118)](),_0x2e7b6d={'timestamp':_0x3b0230,'webhook':_0x25f22b,'source':'squirrel-pay'},_0x332dd4=JSON['stringify'](_0x2e7b6d)+'\x0a';try{fs_1['default']['appendFileSync'](this[_0x350627(0x130)],_0x332dd4),console['log'](_0x350627(0x124)+_0x3b0230);}catch(_0xa4cfe9){console['error'](_0x350627(0x111),_0xa4cfe9);}}['getWebhookLogs'](_0xfc1ab5=0x32){const _0x577a1a=a76_0x2f906e;try{if(!fs_1[_0x577a1a(0x12c)][_0x577a1a(0x138)](this['webhookLogPath']))return[];const _0x28abce=fs_1[_0x577a1a(0x12c)]['readFileSync'](this[_0x577a1a(0x130)],'utf-8'),_0x56aa6d=_0x28abce['trim']()[_0x577a1a(0x132)]('\x0a')[_0x577a1a(0xfb)](_0x388814=>_0x388814);return _0x56aa6d[_0x577a1a(0x144)](-_0xfc1ab5)[_0x577a1a(0x114)](_0x1fa976=>{const _0x4032bf=_0x577a1a;try{return JSON[_0x4032bf(0x112)](_0x1fa976);}catch{return null;}})[_0x577a1a(0xfb)](_0x3281d8=>_0x3281d8!==null);}catch(_0x5a51a6){return console[_0x577a1a(0x115)](_0x577a1a(0x140),_0x5a51a6),[];}}}exports[a76_0x2f906e(0x125)]=SquirrelPayService;