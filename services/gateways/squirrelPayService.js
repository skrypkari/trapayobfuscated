'use strict';const a64_0x4a4175=a64_0x1785;function a64_0x53bb(){const _0x1f500c=['\x20\x20\x20Code:\x20','code','PAID','transaction','crypto','status','FAILED','\x20\x20\x20Status:\x20','text','readFileSync','POST','utf-8','ðŸ”„\x20Redirect\x20URL:\x20','error','ðŸ”—\x20URL:\x20','email','uid','filter','1259691aeADXx','9978WhdQDk','isTestMode','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','306950JCZqrS','randomUUID','7741BQAham','warn','stringify','PENDING','cwd','SquirrelPay\x20API\x20error:\x20','baseUrl','\x20\x20\x20Gateway\x20ID:\x20','successful','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','4CxHxHr','ðŸ“\x20Description:\x20','parse','ðŸ”§\x20Headers:','\x20||\x20','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','node-fetch','join','Basic\x20','__esModule','from','log','âœ…\x20SquirrelPay\x20Response\x20Success:','2410387qedwku','8758935ADLant','/transactions/payments','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','default','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','last_4','message','existsSync','43525128HMymCS','secretKey','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','defineProperty','webhookLogPath','414PGYCEp','trim','application/json','getBasicAuth','getPaymentStatus','birth_date','base64','redirect_url','payment_method','407vdPEzf','shopId','2440QjzxZE','SquirrelPayService','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','config','ðŸ‘¤\x20Customer:\x20','squirrel-pay','\x20-\x20','8RwcfUd','logs','gateway_id','split','friendly_message','âŒ\x20SquirrelPay\x20API\x20Error:','generateRequestId'];a64_0x53bb=function(){return _0x1f500c;};return a64_0x53bb();}(function(_0x3c89de,_0x3cde17){const _0x16ae25=a64_0x1785,_0x43abf6=_0x3c89de();while(!![]){try{const _0x210760=parseInt(_0x16ae25(0xbd))/0x1*(parseInt(_0x16ae25(0xe2))/0x2)+-parseInt(_0x16ae25(0xb7))/0x3*(-parseInt(_0x16ae25(0xc7))/0x4)+-parseInt(_0x16ae25(0xed))/0x5*(-parseInt(_0x16ae25(0xb8))/0x6)+-parseInt(_0x16ae25(0xd4))/0x7*(parseInt(_0x16ae25(0xf4))/0x8)+parseInt(_0x16ae25(0xd5))/0x9+parseInt(_0x16ae25(0xbb))/0xa*(parseInt(_0x16ae25(0xeb))/0xb)+-parseInt(_0x16ae25(0xdd))/0xc;if(_0x210760===_0x3cde17)break;else _0x43abf6['push'](_0x43abf6['shift']());}catch(_0x2f3653){_0x43abf6['push'](_0x43abf6['shift']());}}}(a64_0x53bb,0xed23b));function a64_0x1785(_0x4c04a5,_0x4dccbd){_0x4c04a5=_0x4c04a5-0x9f;const _0x53bb2d=a64_0x53bb();let _0x178544=_0x53bb2d[_0x4c04a5];return _0x178544;}var __importDefault=this&&this['__importDefault']||function(_0x4fe352){return _0x4fe352&&_0x4fe352['__esModule']?_0x4fe352:{'default':_0x4fe352};};Object[a64_0x4a4175(0xe0)](exports,a64_0x4a4175(0xd0),{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a64_0x4a4175(0xa9))),node_fetch_1=__importDefault(require(a64_0x4a4175(0xcd))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0x261c34){const _0x3dda99=a64_0x4a4175;this['config']=_0x261c34,this[_0x3dda99(0xe1)]=path_1[_0x3dda99(0xd8)][_0x3dda99(0xce)](process[_0x3dda99(0xc1)](),_0x3dda99(0x9f),'squirrel-pay-webhooks.log');const _0x5cf0c7=path_1[_0x3dda99(0xd8)]['dirname'](this['webhookLogPath']);!fs_1[_0x3dda99(0xd8)][_0x3dda99(0xdc)](_0x5cf0c7)&&fs_1[_0x3dda99(0xd8)]['mkdirSync'](_0x5cf0c7,{'recursive':!![]});}[a64_0x4a4175(0xe5)](){const _0x2314c4=a64_0x4a4175,_0x3d8742=this[_0x2314c4(0xf0)][_0x2314c4(0xec)]+':'+this[_0x2314c4(0xf0)][_0x2314c4(0xde)];return Buffer[_0x2314c4(0xd1)](_0x3d8742)['toString'](_0x2314c4(0xe8));}[a64_0x4a4175(0xa4)](){const _0x192b0e=a64_0x4a4175;return crypto_1[_0x192b0e(0xd8)][_0x192b0e(0xbc)]();}async['processCardPayment'](_0x463e74,_0x45a0a4,_0x564e8b,_0x1389e2,_0x770c2e,_0x39f03a,_0x473732,_0x2b4806,_0x3841d0){const _0x185b25=a64_0x4a4175;console['log'](_0x185b25(0xd7)),console[_0x185b25(0xd2)]('ðŸ’°\x20Amount:\x20'+_0x463e74+'\x20'+_0x45a0a4),console[_0x185b25(0xd2)](_0x185b25(0xc8)+_0x564e8b),console[_0x185b25(0xd2)](_0x185b25(0xf1)+_0x473732['email']+'\x20('+_0x473732['ip']+')');const _0x2615ca={'request':{'amount':_0x463e74,'currency':_0x45a0a4,'description':_0x564e8b,'gate_id':parseInt(this[_0x185b25(0xf0)][_0x185b25(0xec)]),'return_url':_0x1389e2,'notification_url':_0x770c2e,'credit_card':_0x39f03a,'customer':{'email':_0x473732[_0x185b25(0xb4)],'phone':_0x3841d0,'birth_date':_0x473732[_0x185b25(0xe7)],'billing':_0x2b4806},'test':this[_0x185b25(0xf0)][_0x185b25(0xb9)]}},_0x4adffc=this[_0x185b25(0xa4)](),_0x386a81={'Authorization':_0x185b25(0xcf)+this[_0x185b25(0xe5)](),'Content-Type':_0x185b25(0xe4),'Accept':_0x185b25(0xe4),'X-API-Version':'3','RequestID':_0x4adffc};try{console[_0x185b25(0xd2)]('ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x185b25(0xd2)]('ðŸ“‹\x20Request\x20ID:\x20'+_0x4adffc),console[_0x185b25(0xd2)](_0x185b25(0xb3)+this[_0x185b25(0xf0)][_0x185b25(0xc3)]+_0x185b25(0xd6)),console[_0x185b25(0xd2)](_0x185b25(0xca),JSON[_0x185b25(0xbf)](_0x386a81,null,0x2)),console['log']('ðŸ“¦\x20Body:',JSON[_0x185b25(0xbf)](_0x2615ca,null,0x2));const _0x10e606=await(0x0,node_fetch_1[_0x185b25(0xd8)])(this[_0x185b25(0xf0)][_0x185b25(0xc3)]+_0x185b25(0xd6),{'method':_0x185b25(0xaf),'headers':_0x386a81,'body':JSON[_0x185b25(0xbf)](_0x2615ca)}),_0x5236c8=await _0x10e606[_0x185b25(0xad)]();console[_0x185b25(0xd2)](_0x185b25(0xdf)+_0x10e606['status']),console['log'](_0x185b25(0xcc)+_0x5236c8);if(!_0x10e606['ok'])throw new Error(_0x185b25(0xc2)+_0x10e606[_0x185b25(0xaa)]+'\x20'+_0x10e606['statusText']+_0x185b25(0xf3)+_0x5236c8);const _0x3111ed=JSON[_0x185b25(0xc9)](_0x5236c8);return console[_0x185b25(0xd2)](_0x185b25(0xd3)),console['log']('\x20\x20\x20UID:\x20'+_0x3111ed['uid']),console['log'](_0x185b25(0xac)+_0x3111ed['status']),console[_0x185b25(0xd2)](_0x185b25(0xa5)+_0x3111ed[_0x185b25(0xa6)]),console[_0x185b25(0xd2)]('\x20\x20\x20Message:\x20'+_0x3111ed[_0x185b25(0xa2)]),console[_0x185b25(0xd2)](_0x185b25(0xc4)+_0x3111ed[_0x185b25(0xa8)][_0x185b25(0xa0)]),console[_0x185b25(0xd2)]('\x20\x20\x20Last\x204:\x20'+_0x3111ed[_0x185b25(0xea)][_0x185b25(0xda)]),_0x3111ed[_0x185b25(0xe9)]&&console['log'](_0x185b25(0xb1)+_0x3111ed[_0x185b25(0xe9)]),_0x3111ed;}catch(_0x56e733){console[_0x185b25(0xb2)](_0x185b25(0xa3),_0x56e733);throw _0x56e733;}}[a64_0x4a4175(0xe6)](_0x224c36){const _0x377878=a64_0x4a4175,_0x247bd6=_0x224c36[_0x377878(0xb5)],_0x3de512=_0x224c36[_0x377878(0xea)][_0x377878(0xda)];console[_0x377878(0xd2)](_0x377878(0xc6)+_0x224c36['status']);switch(_0x224c36[_0x377878(0xaa)]){case _0x377878(0xc5):return{'status':_0x377878(0xa7),'gatewayPaymentId':_0x247bd6,'cardLast4':_0x3de512};case'incomplete':return{'status':_0x377878(0xc0),'gatewayPaymentId':_0x247bd6,'cardLast4':_0x3de512,'redirectUrl':_0x224c36['redirect_url']};case'failed':const _0x4bd30a=_0x224c36[_0x377878(0xa2)]||'',_0x53f887=_0x224c36[_0x377878(0xdb)]||'';let _0x4d64b2='';if(_0x4bd30a&&_0x53f887)_0x4d64b2=_0x4bd30a+'\x20||\x20'+_0x53f887;else{if(_0x4bd30a)_0x4d64b2=_0x4bd30a;else _0x53f887?_0x4d64b2=_0x53f887:_0x4d64b2='Payment\x20failed';}return{'status':_0x377878(0xab),'failureMessage':_0x4d64b2,'gatewayPaymentId':_0x247bd6,'cardLast4':_0x3de512};default:console[_0x377878(0xbe)](_0x377878(0xba)+_0x224c36['status']);const _0x427d6d=_0x224c36[_0x377878(0xa2)]||'',_0x1ed61f=_0x224c36[_0x377878(0xdb)]||'';let _0x10cebc='';if(_0x427d6d&&_0x1ed61f)_0x10cebc=_0x427d6d+_0x377878(0xcb)+_0x1ed61f;else{if(_0x427d6d)_0x10cebc=_0x427d6d;else _0x1ed61f?_0x10cebc=_0x1ed61f:_0x10cebc='Unknown\x20error';}return{'status':'FAILED','failureMessage':_0x10cebc,'gatewayPaymentId':_0x247bd6,'cardLast4':_0x3de512};}}['logWebhook'](_0x57d57e){const _0x2b77e3=a64_0x4a4175,_0x25c7b6=new Date()['toISOString'](),_0x2900e7={'timestamp':_0x25c7b6,'webhook':_0x57d57e,'source':_0x2b77e3(0xf2)},_0xdd69d=JSON[_0x2b77e3(0xbf)](_0x2900e7)+'\x0a';try{fs_1['default']['appendFileSync'](this[_0x2b77e3(0xe1)],_0xdd69d),console[_0x2b77e3(0xd2)]('ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x25c7b6);}catch(_0x4c62bd){console[_0x2b77e3(0xb2)](_0x2b77e3(0xef),_0x4c62bd);}}['getWebhookLogs'](_0x2a8502=0x32){const _0x28d6a8=a64_0x4a4175;try{if(!fs_1['default'][_0x28d6a8(0xdc)](this['webhookLogPath']))return[];const _0x1a55a0=fs_1['default'][_0x28d6a8(0xae)](this[_0x28d6a8(0xe1)],_0x28d6a8(0xb0)),_0x328cfc=_0x1a55a0[_0x28d6a8(0xe3)]()[_0x28d6a8(0xa1)]('\x0a')[_0x28d6a8(0xb6)](_0x55a61c=>_0x55a61c);return _0x328cfc['slice'](-_0x2a8502)['map'](_0x131f22=>{const _0x52da52=_0x28d6a8;try{return JSON[_0x52da52(0xc9)](_0x131f22);}catch{return null;}})[_0x28d6a8(0xb6)](_0x64b775=>_0x64b775!==null);}catch(_0x4531fd){return console[_0x28d6a8(0xb2)](_0x28d6a8(0xd9),_0x4531fd),[];}}}exports[a64_0x4a4175(0xee)]=SquirrelPayService;