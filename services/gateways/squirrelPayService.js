'use strict';const a76_0x3243b6=a76_0x196a;(function(_0x19f4b,_0x585fb6){const _0x201a4d=a76_0x196a,_0x43f80c=_0x19f4b();while(!![]){try{const _0x40ab67=-parseInt(_0x201a4d(0x15b))/0x1*(parseInt(_0x201a4d(0x199))/0x2)+-parseInt(_0x201a4d(0x195))/0x3*(-parseInt(_0x201a4d(0x179))/0x4)+-parseInt(_0x201a4d(0x157))/0x5*(-parseInt(_0x201a4d(0x166))/0x6)+-parseInt(_0x201a4d(0x19e))/0x7+-parseInt(_0x201a4d(0x189))/0x8*(-parseInt(_0x201a4d(0x153))/0x9)+parseInt(_0x201a4d(0x15e))/0xa+-parseInt(_0x201a4d(0x171))/0xb;if(_0x40ab67===_0x585fb6)break;else _0x43f80c['push'](_0x43f80c['shift']());}catch(_0xc6599e){_0x43f80c['push'](_0x43f80c['shift']());}}}(a76_0x3e0d,0x4f357));function a76_0x196a(_0x13584d,_0xdbf0d0){_0x13584d=_0x13584d-0x149;const _0x3e0d21=a76_0x3e0d();let _0x196a7e=_0x3e0d21[_0x13584d];return _0x196a7e;}function a76_0x3e0d(){const _0x463a0e=['code','‚ùå\x20SquirrelPay\x20API\x20Error:','default','\x20\x20\x20Code:\x20','redirect_url','\x20\x20\x20Gateway\x20ID:\x20','processCardPayment','webhookLogPath','483hUogHh','isTestMode','FAILED','split','8AusoEz','join','transaction','path','text','1017632jAVtHs','gateway_id','üì•\x20SquirrelPay\x20Response\x20Status:\x20','squirrel-pay-webhooks.log','config','üìù\x20SquirrelPay\x20webhook\x20logged:\x20','message','baseUrl','defineProperty','\x20\x20\x20Message:\x20','mkdirSync','\x20\x20\x20UID:\x20','\x20-\x20','friendly_message','existsSync','email','last_4','PENDING','getBasicAuth','68931qiepWQ','incomplete','uid','squirrel-pay','39675rfiApj','parse','shopId','üë§\x20Customer:\x20','29061HsAkWs','readFileSync','__importDefault','856830VvWZrG','trim','randomUUID','\x20\x20\x20Status:\x20','filter','üìã\x20Request\x20ID:\x20','application/json','üì¶\x20Body:','138zzlSAR','appendFileSync','stringify','crypto','POST','error','logs','warn','from','getPaymentStatus','üìù\x20Description:\x20','5662525cHxAWD','SquirrelPayService','secretKey','‚ö†Ô∏è\x20Unknown\x20SquirrelPay\x20status:\x20','base64','Basic\x20','üêøÔ∏è\x20SquirrelPay:\x20Processing\x20card\x20payment','Payment\x20failed','14788vQFUZr','birth_date','\x20||\x20','‚ùå\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','dirname','üîç\x20Processing\x20SquirrelPay\x20status:\x20','üí∞\x20Amount:\x20','PAID','üîß\x20Headers:','status','/transactions/payments','toISOString','getWebhookLogs','__esModule','log','generateRequestId','248GybEHJ','Unknown\x20error','üîÑ\x20Redirect\x20URL:\x20','\x20\x20\x20Last\x204:\x20'];a76_0x3e0d=function(){return _0x463a0e;};return a76_0x3e0d();}var __importDefault=this&&this[a76_0x3243b6(0x15d)]||function(_0xa69908){return _0xa69908&&_0xa69908['__esModule']?_0xa69908:{'default':_0xa69908};};Object[a76_0x3243b6(0x1a6)](exports,a76_0x3243b6(0x186),{'value':!![]}),exports[a76_0x3243b6(0x172)]=void 0x0;const crypto_1=__importDefault(require(a76_0x3243b6(0x169))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x3243b6(0x19c)));class SquirrelPayService{constructor(_0x3ca0a5){const _0x463747=a76_0x3243b6;this['config']=_0x3ca0a5,this[_0x463747(0x194)]=path_1[_0x463747(0x18f)][_0x463747(0x19a)](process['cwd'](),_0x463747(0x16c),_0x463747(0x1a1));const _0x491695=path_1[_0x463747(0x18f)][_0x463747(0x17d)](this[_0x463747(0x194)]);!fs_1[_0x463747(0x18f)][_0x463747(0x14e)](_0x491695)&&fs_1[_0x463747(0x18f)][_0x463747(0x14a)](_0x491695,{'recursive':!![]});}[a76_0x3243b6(0x152)](){const _0x516167=a76_0x3243b6,_0xb72718=this['config'][_0x516167(0x159)]+':'+this['config'][_0x516167(0x173)];return Buffer[_0x516167(0x16e)](_0xb72718)['toString'](_0x516167(0x175));}[a76_0x3243b6(0x188)](){const _0x4bf5a3=a76_0x3243b6;return crypto_1['default'][_0x4bf5a3(0x160)]();}async[a76_0x3243b6(0x193)](_0x186bca,_0xac018d,_0x308131,_0x4d7e68,_0x4df58d,_0x57cc19,_0x48c7fc,_0x40f995,_0x2749c2){const _0x5b7c98=a76_0x3243b6;console[_0x5b7c98(0x187)](_0x5b7c98(0x177)),console[_0x5b7c98(0x187)](_0x5b7c98(0x17f)+_0x186bca+'\x20'+_0xac018d),console[_0x5b7c98(0x187)](_0x5b7c98(0x170)+_0x308131),console[_0x5b7c98(0x187)](_0x5b7c98(0x15a)+_0x48c7fc[_0x5b7c98(0x14f)]+'\x20('+_0x48c7fc['ip']+')');const _0x5dc475={'request':{'amount':_0x186bca,'currency':_0xac018d,'description':_0x308131,'gate_id':parseInt(this[_0x5b7c98(0x1a2)][_0x5b7c98(0x159)]),'return_url':_0x4d7e68,'notification_url':_0x4df58d,'credit_card':_0x57cc19,'customer':{'email':_0x48c7fc[_0x5b7c98(0x14f)],'phone':_0x2749c2,'birth_date':_0x48c7fc[_0x5b7c98(0x17a)],'billing':_0x40f995},'test':this[_0x5b7c98(0x1a2)][_0x5b7c98(0x196)]}},_0x3f6ab8=this[_0x5b7c98(0x188)](),_0x5041aa={'Authorization':_0x5b7c98(0x176)+this[_0x5b7c98(0x152)](),'Content-Type':_0x5b7c98(0x164),'Accept':_0x5b7c98(0x164),'X-API-Version':'3','RequestID':_0x3f6ab8};try{console[_0x5b7c98(0x187)]('üåê\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console['log'](_0x5b7c98(0x163)+_0x3f6ab8),console[_0x5b7c98(0x187)]('üîó\x20URL:\x20'+this['config'][_0x5b7c98(0x1a5)]+_0x5b7c98(0x183)),console[_0x5b7c98(0x187)](_0x5b7c98(0x181),JSON['stringify'](_0x5041aa,null,0x2)),console['log'](_0x5b7c98(0x165),JSON['stringify'](_0x5dc475,null,0x2));const _0x2fae0e=await(0x0,node_fetch_1['default'])(this['config'][_0x5b7c98(0x1a5)]+'/transactions/payments',{'method':_0x5b7c98(0x16a),'headers':_0x5041aa,'body':JSON['stringify'](_0x5dc475)}),_0x47492c=await _0x2fae0e[_0x5b7c98(0x19d)]();console[_0x5b7c98(0x187)](_0x5b7c98(0x1a0)+_0x2fae0e[_0x5b7c98(0x182)]),console[_0x5b7c98(0x187)]('üìÑ\x20SquirrelPay\x20Response\x20Body:\x20'+_0x47492c);if(!_0x2fae0e['ok'])throw new Error('SquirrelPay\x20API\x20error:\x20'+_0x2fae0e[_0x5b7c98(0x182)]+'\x20'+_0x2fae0e['statusText']+_0x5b7c98(0x14c)+_0x47492c);const _0x51faf6=JSON[_0x5b7c98(0x158)](_0x47492c);return console[_0x5b7c98(0x187)]('‚úÖ\x20SquirrelPay\x20Response\x20Success:'),console['log'](_0x5b7c98(0x14b)+_0x51faf6[_0x5b7c98(0x155)]),console['log'](_0x5b7c98(0x161)+_0x51faf6[_0x5b7c98(0x182)]),console[_0x5b7c98(0x187)](_0x5b7c98(0x190)+_0x51faf6[_0x5b7c98(0x18d)]),console[_0x5b7c98(0x187)](_0x5b7c98(0x149)+_0x51faf6[_0x5b7c98(0x14d)]),console['log'](_0x5b7c98(0x192)+_0x51faf6[_0x5b7c98(0x19b)][_0x5b7c98(0x19f)]),console[_0x5b7c98(0x187)](_0x5b7c98(0x18c)+_0x51faf6['payment_method'][_0x5b7c98(0x150)]),_0x51faf6[_0x5b7c98(0x191)]&&console[_0x5b7c98(0x187)](_0x5b7c98(0x18b)+_0x51faf6[_0x5b7c98(0x191)]),_0x51faf6;}catch(_0x59519b){console[_0x5b7c98(0x16b)](_0x5b7c98(0x18e),_0x59519b);throw _0x59519b;}}[a76_0x3243b6(0x16f)](_0xbfdc69){const _0x1ed604=a76_0x3243b6,_0x3bb286=_0xbfdc69['uid'],_0x8c9252=_0xbfdc69['payment_method'][_0x1ed604(0x150)];console[_0x1ed604(0x187)](_0x1ed604(0x17e)+_0xbfdc69[_0x1ed604(0x182)]);switch(_0xbfdc69[_0x1ed604(0x182)]){case'successful':return{'status':_0x1ed604(0x180),'gatewayPaymentId':_0x3bb286,'cardLast4':_0x8c9252};case _0x1ed604(0x154):return{'status':_0x1ed604(0x151),'gatewayPaymentId':_0x3bb286,'cardLast4':_0x8c9252,'redirectUrl':_0xbfdc69['redirect_url']};case'failed':const _0x41afd1=_0xbfdc69[_0x1ed604(0x14d)]||'',_0x264962=_0xbfdc69[_0x1ed604(0x1a4)]||'';let _0x2da08d='';if(_0x41afd1&&_0x264962)_0x2da08d=_0x41afd1+_0x1ed604(0x17b)+_0x264962;else{if(_0x41afd1)_0x2da08d=_0x41afd1;else _0x264962?_0x2da08d=_0x264962:_0x2da08d=_0x1ed604(0x178);}return{'status':_0x1ed604(0x197),'failureMessage':_0x2da08d,'gatewayPaymentId':_0x3bb286,'cardLast4':_0x8c9252};default:console[_0x1ed604(0x16d)](_0x1ed604(0x174)+_0xbfdc69[_0x1ed604(0x182)]);const _0x578cdb=_0xbfdc69['friendly_message']||'',_0x5191a4=_0xbfdc69[_0x1ed604(0x1a4)]||'';let _0x47d320='';if(_0x578cdb&&_0x5191a4)_0x47d320=_0x578cdb+_0x1ed604(0x17b)+_0x5191a4;else{if(_0x578cdb)_0x47d320=_0x578cdb;else _0x5191a4?_0x47d320=_0x5191a4:_0x47d320=_0x1ed604(0x18a);}return{'status':'FAILED','failureMessage':_0x47d320,'gatewayPaymentId':_0x3bb286,'cardLast4':_0x8c9252};}}['logWebhook'](_0x586510){const _0x1e4005=a76_0x3243b6,_0x145c8f=new Date()[_0x1e4005(0x184)](),_0x1e5ac6={'timestamp':_0x145c8f,'webhook':_0x586510,'source':_0x1e4005(0x156)},_0x4d457a=JSON[_0x1e4005(0x168)](_0x1e5ac6)+'\x0a';try{fs_1['default'][_0x1e4005(0x167)](this['webhookLogPath'],_0x4d457a),console[_0x1e4005(0x187)](_0x1e4005(0x1a3)+_0x145c8f);}catch(_0x595e85){console[_0x1e4005(0x16b)](_0x1e4005(0x17c),_0x595e85);}}[a76_0x3243b6(0x185)](_0x524e85=0x32){const _0xb2cd44=a76_0x3243b6;try{if(!fs_1[_0xb2cd44(0x18f)][_0xb2cd44(0x14e)](this['webhookLogPath']))return[];const _0x1bd6ac=fs_1[_0xb2cd44(0x18f)][_0xb2cd44(0x15c)](this[_0xb2cd44(0x194)],'utf-8'),_0xcf5072=_0x1bd6ac[_0xb2cd44(0x15f)]()[_0xb2cd44(0x198)]('\x0a')['filter'](_0x327907=>_0x327907);return _0xcf5072['slice'](-_0x524e85)['map'](_0x33f961=>{try{return JSON['parse'](_0x33f961);}catch{return null;}})[_0xb2cd44(0x162)](_0x407b26=>_0x407b26!==null);}catch(_0x161666){return console[_0xb2cd44(0x16b)]('‚ùå\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:',_0x161666),[];}}}exports[a76_0x3243b6(0x172)]=SquirrelPayService;