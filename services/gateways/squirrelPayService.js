'use strict';const a76_0x294087=a76_0x5dcd;(function(_0x2f169f,_0x13938c){const _0x4247e5=a76_0x5dcd,_0x21a745=_0x2f169f();while(!![]){try{const _0x3fc1b9=-parseInt(_0x4247e5(0x23d))/0x1+-parseInt(_0x4247e5(0x208))/0x2+-parseInt(_0x4247e5(0x1fc))/0x3*(-parseInt(_0x4247e5(0x1f6))/0x4)+parseInt(_0x4247e5(0x210))/0x5+-parseInt(_0x4247e5(0x207))/0x6*(-parseInt(_0x4247e5(0x20d))/0x7)+-parseInt(_0x4247e5(0x205))/0x8+parseInt(_0x4247e5(0x224))/0x9*(-parseInt(_0x4247e5(0x221))/0xa);if(_0x3fc1b9===_0x13938c)break;else _0x21a745['push'](_0x21a745['shift']());}catch(_0x1a4cd9){_0x21a745['push'](_0x21a745['shift']());}}}(a76_0x4f6b,0x7df36));function a76_0x4f6b(){const _0x11374a=['Unknown\x20error','filter','existsSync','appendFileSync','4ewvlCK','shopId','baseUrl','uid','ðŸ”§\x20Headers:','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','1294569LcqikP','ðŸ“‹\x20Request\x20ID:\x20','ðŸ‘¤\x20Customer:\x20','isTestMode','getWebhookLogs','stringify','incomplete','FAILED','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','3010696vlsZHH','config','14466CMUCVO','242432EkTWuE','SquirrelPayService','map','secretKey','\x20-\x20','1316SpGATx','code','getBasicAuth','1360970lStqfA','\x20\x20\x20Message:\x20','generateRequestId','slice','text','friendly_message','mkdirSync','successful','trim','node-fetch','redirect_url','status','log','ðŸ’°\x20Amount:\x20','__esModule','ðŸ”—\x20URL:\x20','\x20\x20\x20Code:\x20','162170mqahwZ','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','from','36AiMJmm','getPaymentStatus','toString','statusText','readFileSync','Basic\x20','PENDING','webhookLogPath','last_4','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','ðŸ”„\x20Redirect\x20URL:\x20','processCardPayment','failed','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','\x20||\x20','randomUUID','utf-8','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','\x20\x20\x20Gateway\x20ID:\x20','base64','logWebhook','ðŸ“¦\x20Body:','SquirrelPay\x20API\x20error:\x20','crypto','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','78670bEGrhD','POST','ðŸ“\x20Description:\x20','transaction','error','split','email','default','ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20','toISOString','logs','payment_method','PAID','application/json'];a76_0x4f6b=function(){return _0x11374a;};return a76_0x4f6b();}var __importDefault=this&&this['__importDefault']||function(_0x1c814b){const _0x4ad129=a76_0x5dcd;return _0x1c814b&&_0x1c814b[_0x4ad129(0x21e)]?_0x1c814b:{'default':_0x1c814b};};Object['defineProperty'](exports,a76_0x294087(0x21e),{'value':!![]}),exports[a76_0x294087(0x209)]=void 0x0;const crypto_1=__importDefault(require(a76_0x294087(0x23b))),node_fetch_1=__importDefault(require(a76_0x294087(0x219))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));class SquirrelPayService{constructor(_0x5b8776){const _0x444076=a76_0x294087;this['config']=_0x5b8776,this[_0x444076(0x22b)]=path_1[_0x444076(0x244)]['join'](process['cwd'](),_0x444076(0x247),'squirrel-pay-webhooks.log');const _0x498322=path_1[_0x444076(0x244)]['dirname'](this[_0x444076(0x22b)]);!fs_1['default'][_0x444076(0x1f4)](_0x498322)&&fs_1[_0x444076(0x244)][_0x444076(0x216)](_0x498322,{'recursive':!![]});}[a76_0x294087(0x20f)](){const _0x3a101a=a76_0x294087,_0x12fe8b=this[_0x3a101a(0x206)][_0x3a101a(0x1f7)]+':'+this['config'][_0x3a101a(0x20b)];return Buffer[_0x3a101a(0x223)](_0x12fe8b)[_0x3a101a(0x226)](_0x3a101a(0x237));}[a76_0x294087(0x212)](){const _0x56bfc7=a76_0x294087;return crypto_1[_0x56bfc7(0x244)][_0x56bfc7(0x233)]();}async[a76_0x294087(0x22f)](_0x2988e3,_0x5327c7,_0x14c4d8,_0x366ccb,_0x2bc527,_0x58d4d4,_0x16d301,_0x3e8eff,_0x4ab844){const _0x2c256b=a76_0x294087;console[_0x2c256b(0x21c)](_0x2c256b(0x231)),console[_0x2c256b(0x21c)](_0x2c256b(0x21d)+_0x2988e3+'\x20'+_0x5327c7),console[_0x2c256b(0x21c)](_0x2c256b(0x23f)+_0x14c4d8),console[_0x2c256b(0x21c)](_0x2c256b(0x1fe)+_0x16d301[_0x2c256b(0x243)]+'\x20('+_0x16d301['ip']+')');const _0x50a22e={'request':{'amount':_0x2988e3,'currency':_0x5327c7,'description':_0x14c4d8,'gate_id':parseInt(this['config'][_0x2c256b(0x1f7)]),'return_url':_0x366ccb,'notification_url':_0x2bc527,'credit_card':_0x58d4d4,'customer':{'email':_0x16d301[_0x2c256b(0x243)],'phone':_0x4ab844,'birth_date':_0x16d301['birth_date'],'billing':_0x3e8eff},'test':this[_0x2c256b(0x206)][_0x2c256b(0x1ff)]}},_0xd17399=this[_0x2c256b(0x212)](),_0xb99b05={'Authorization':_0x2c256b(0x229)+this[_0x2c256b(0x20f)](),'Content-Type':_0x2c256b(0x24a),'Accept':_0x2c256b(0x24a),'X-API-Version':'3','RequestID':_0xd17399};try{console[_0x2c256b(0x21c)]('ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...'),console[_0x2c256b(0x21c)](_0x2c256b(0x1fd)+_0xd17399),console[_0x2c256b(0x21c)](_0x2c256b(0x21f)+this[_0x2c256b(0x206)][_0x2c256b(0x1f8)]+'/transactions/payments'),console[_0x2c256b(0x21c)](_0x2c256b(0x1fa),JSON[_0x2c256b(0x201)](_0xb99b05,null,0x2)),console['log'](_0x2c256b(0x239),JSON[_0x2c256b(0x201)](_0x50a22e,null,0x2));const _0x4a13f6=await(0x0,node_fetch_1[_0x2c256b(0x244)])(this[_0x2c256b(0x206)][_0x2c256b(0x1f8)]+'/transactions/payments',{'method':_0x2c256b(0x23e),'headers':_0xb99b05,'body':JSON[_0x2c256b(0x201)](_0x50a22e)}),_0x409767=await _0x4a13f6[_0x2c256b(0x214)]();console[_0x2c256b(0x21c)](_0x2c256b(0x1fb)+_0x4a13f6[_0x2c256b(0x21b)]),console[_0x2c256b(0x21c)](_0x2c256b(0x222)+_0x409767);if(!_0x4a13f6['ok'])throw new Error(_0x2c256b(0x23a)+_0x4a13f6[_0x2c256b(0x21b)]+'\x20'+_0x4a13f6[_0x2c256b(0x227)]+_0x2c256b(0x20c)+_0x409767);const _0x31ce89=JSON['parse'](_0x409767);return console[_0x2c256b(0x21c)]('âœ…\x20SquirrelPay\x20Response\x20Success:'),console[_0x2c256b(0x21c)]('\x20\x20\x20UID:\x20'+_0x31ce89[_0x2c256b(0x1f9)]),console[_0x2c256b(0x21c)]('\x20\x20\x20Status:\x20'+_0x31ce89[_0x2c256b(0x21b)]),console['log'](_0x2c256b(0x220)+_0x31ce89[_0x2c256b(0x20e)]),console[_0x2c256b(0x21c)](_0x2c256b(0x211)+_0x31ce89['friendly_message']),console[_0x2c256b(0x21c)](_0x2c256b(0x236)+_0x31ce89[_0x2c256b(0x240)]['gateway_id']),console[_0x2c256b(0x21c)]('\x20\x20\x20Last\x204:\x20'+_0x31ce89[_0x2c256b(0x248)][_0x2c256b(0x22c)]),_0x31ce89[_0x2c256b(0x21a)]&&console['log'](_0x2c256b(0x22e)+_0x31ce89[_0x2c256b(0x21a)]),_0x31ce89;}catch(_0x3d1b76){console[_0x2c256b(0x241)]('âŒ\x20SquirrelPay\x20API\x20Error:',_0x3d1b76);throw _0x3d1b76;}}[a76_0x294087(0x225)](_0x275f83){const _0x4e0f24=a76_0x294087,_0x38a797=_0x275f83['uid'],_0x1d293b=_0x275f83['payment_method'][_0x4e0f24(0x22c)];console['log'](_0x4e0f24(0x245)+_0x275f83['status']);switch(_0x275f83[_0x4e0f24(0x21b)]){case _0x4e0f24(0x217):return{'status':_0x4e0f24(0x249),'gatewayPaymentId':_0x38a797,'cardLast4':_0x1d293b};case _0x4e0f24(0x202):return{'status':_0x4e0f24(0x22a),'gatewayPaymentId':_0x38a797,'cardLast4':_0x1d293b,'redirectUrl':_0x275f83[_0x4e0f24(0x21a)]};case _0x4e0f24(0x230):const _0x4a3985=_0x275f83[_0x4e0f24(0x215)]||'',_0x16962b=_0x275f83['message']||'';let _0x343258='';if(_0x4a3985&&_0x16962b)_0x343258=_0x4a3985+_0x4e0f24(0x232)+_0x16962b;else{if(_0x4a3985)_0x343258=_0x4a3985;else _0x16962b?_0x343258=_0x16962b:_0x343258='Payment\x20failed';}return{'status':_0x4e0f24(0x203),'failureMessage':_0x343258,'gatewayPaymentId':_0x38a797,'cardLast4':_0x1d293b};default:console['warn'](_0x4e0f24(0x235)+_0x275f83['status']);const _0x1e38bc=_0x275f83['friendly_message']||'',_0x3895e1=_0x275f83['message']||'';let _0x52041b='';if(_0x1e38bc&&_0x3895e1)_0x52041b=_0x1e38bc+_0x4e0f24(0x232)+_0x3895e1;else{if(_0x1e38bc)_0x52041b=_0x1e38bc;else _0x3895e1?_0x52041b=_0x3895e1:_0x52041b=_0x4e0f24(0x24b);}return{'status':_0x4e0f24(0x203),'failureMessage':_0x52041b,'gatewayPaymentId':_0x38a797,'cardLast4':_0x1d293b};}}[a76_0x294087(0x238)](_0x3dead7){const _0x1dabec=a76_0x294087,_0x2784d1=new Date()[_0x1dabec(0x246)](),_0x18562a={'timestamp':_0x2784d1,'webhook':_0x3dead7,'source':'squirrel-pay'},_0x3d384d=JSON[_0x1dabec(0x201)](_0x18562a)+'\x0a';try{fs_1[_0x1dabec(0x244)][_0x1dabec(0x1f5)](this[_0x1dabec(0x22b)],_0x3d384d),console[_0x1dabec(0x21c)](_0x1dabec(0x22d)+_0x2784d1);}catch(_0x186674){console[_0x1dabec(0x241)](_0x1dabec(0x204),_0x186674);}}[a76_0x294087(0x200)](_0x1e6153=0x32){const _0x40c21d=a76_0x294087;try{if(!fs_1[_0x40c21d(0x244)][_0x40c21d(0x1f4)](this[_0x40c21d(0x22b)]))return[];const _0x10b478=fs_1[_0x40c21d(0x244)][_0x40c21d(0x228)](this['webhookLogPath'],_0x40c21d(0x234)),_0x1f934b=_0x10b478[_0x40c21d(0x218)]()[_0x40c21d(0x242)]('\x0a')[_0x40c21d(0x24c)](_0xff8bd3=>_0xff8bd3);return _0x1f934b[_0x40c21d(0x213)](-_0x1e6153)[_0x40c21d(0x20a)](_0x781366=>{try{return JSON['parse'](_0x781366);}catch{return null;}})['filter'](_0x20437e=>_0x20437e!==null);}catch(_0x561324){return console[_0x40c21d(0x241)](_0x40c21d(0x23c),_0x561324),[];}}}function a76_0x5dcd(_0xf9bd47,_0x2e0e5d){_0xf9bd47=_0xf9bd47-0x1f4;const _0x4f6b8e=a76_0x4f6b();let _0x5dcdb1=_0x4f6b8e[_0xf9bd47];return _0x5dcdb1;}exports['SquirrelPayService']=SquirrelPayService;