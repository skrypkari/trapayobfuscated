'use strict';const a68_0x117009=a68_0x2ba5;(function(_0x369560,_0xa25bc7){const _0x49939f=a68_0x2ba5,_0x2aa66e=_0x369560();while(!![]){try{const _0x28db8d=parseInt(_0x49939f(0x1c2))/0x1*(parseInt(_0x49939f(0x1c7))/0x2)+parseInt(_0x49939f(0x1b1))/0x3*(parseInt(_0x49939f(0x1bc))/0x4)+parseInt(_0x49939f(0x17a))/0x5+parseInt(_0x49939f(0x18e))/0x6*(-parseInt(_0x49939f(0x19c))/0x7)+parseInt(_0x49939f(0x19f))/0x8*(-parseInt(_0x49939f(0x1bb))/0x9)+parseInt(_0x49939f(0x1b0))/0xa+-parseInt(_0x49939f(0x1c0))/0xb*(parseInt(_0x49939f(0x1d6))/0xc);if(_0x28db8d===_0xa25bc7)break;else _0x2aa66e['push'](_0x2aa66e['shift']());}catch(_0x54b961){_0x2aa66e['push'](_0x2aa66e['shift']());}}}(a68_0x3bdd,0x68dee));function a68_0x2ba5(_0x4962a2,_0x569c94){_0x4962a2=_0x4962a2-0x176;const _0x3bdd58=a68_0x3bdd();let _0x2ba5c3=_0x3bdd58[_0x4962a2];return _0x2ba5c3;}function a68_0x3bdd(){const _0x448022=['\x20-\x20','existsSync','appendFileSync','failed','2HqMfVJ','ðŸ“‹\x20Request\x20ID:\x20','error','base64','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','warn','from','squirrel-pay','Payment\x20failed','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','filter','secretKey','ðŸ‘¤\x20Customer:\x20','log','ðŸ”„\x20Redirect\x20URL:\x20','60kGbfJb','ðŸ”§\x20Headers:','status','POST','Unknown\x20error','shopId','2891815xmxIud','\x20\x20\x20Last\x204:\x20','trim','friendly_message','dirname','SquirrelPay\x20API\x20error:\x20','SquirrelPayService','\x20\x20\x20Message:\x20','\x20\x20\x20Gateway\x20ID:\x20','\x20||\x20','generateRequestId','path','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','readFileSync','isTestMode','application/json','successful','parse','stringify','logWebhook','132foqFro','toString','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','logs','slice','uid','payment_method','config','node-fetch','getBasicAuth','default','__importDefault','crypto','squirrel-pay-webhooks.log','173908ExdWSv','__esModule','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','3672VzNfJp','ðŸ“\x20Description:\x20','baseUrl','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','map','incomplete','ðŸ”—\x20URL:\x20','randomUUID','gateway_id','ðŸ“¦\x20Body:','code','message','/transactions/payments','processCardPayment','FAILED','redirect_url','âŒ\x20SquirrelPay\x20API\x20Error:','5864040QcbqKR','30uKLOAI','transaction','\x20\x20\x20UID:\x20','ðŸ’°\x20Amount:\x20','email','join','last_4','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','split','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','297sjMrrd','236812bkUxGj','\x20\x20\x20Code:\x20','defineProperty','webhookLogPath','1842962upEXlQ','statusText','72178pQBFSB'];a68_0x3bdd=function(){return _0x448022;};return a68_0x3bdd();}var __importDefault=this&&this[a68_0x117009(0x199)]||function(_0x2cf9f8){const _0x315b84=a68_0x117009;return _0x2cf9f8&&_0x2cf9f8[_0x315b84(0x19d)]?_0x2cf9f8:{'default':_0x2cf9f8};};Object[a68_0x117009(0x1be)](exports,a68_0x117009(0x19d),{'value':!![]}),exports[a68_0x117009(0x180)]=void 0x0;const crypto_1=__importDefault(require(a68_0x117009(0x19a))),node_fetch_1=__importDefault(require(a68_0x117009(0x196))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x117009(0x185)));class SquirrelPayService{constructor(_0x30d1b0){const _0x363c0a=a68_0x117009;this['config']=_0x30d1b0,this[_0x363c0a(0x1bf)]=path_1[_0x363c0a(0x198)][_0x363c0a(0x1b6)](process['cwd'](),_0x363c0a(0x191),_0x363c0a(0x19b));const _0x53ca99=path_1[_0x363c0a(0x198)][_0x363c0a(0x17e)](this['webhookLogPath']);!fs_1[_0x363c0a(0x198)][_0x363c0a(0x1c4)](_0x53ca99)&&fs_1[_0x363c0a(0x198)]['mkdirSync'](_0x53ca99,{'recursive':!![]});}['getBasicAuth'](){const _0x3d8bda=a68_0x117009,_0x265d47=this[_0x3d8bda(0x195)][_0x3d8bda(0x179)]+':'+this[_0x3d8bda(0x195)][_0x3d8bda(0x1d2)];return Buffer[_0x3d8bda(0x1cd)](_0x265d47)[_0x3d8bda(0x18f)](_0x3d8bda(0x1ca));}[a68_0x117009(0x184)](){const _0x29c79a=a68_0x117009;return crypto_1[_0x29c79a(0x198)][_0x29c79a(0x1a6)]();}async[a68_0x117009(0x1ac)](_0x3c76e9,_0x3249f2,_0x42bc28,_0x21bf5d,_0x279564,_0x23b179,_0x312414,_0x3ad5c8,_0x10fd0a){const _0x33b18c=a68_0x117009;console[_0x33b18c(0x1d4)](_0x33b18c(0x186)),console['log'](_0x33b18c(0x1b4)+_0x3c76e9+'\x20'+_0x3249f2),console[_0x33b18c(0x1d4)](_0x33b18c(0x1a0)+_0x42bc28),console[_0x33b18c(0x1d4)](_0x33b18c(0x1d3)+_0x312414[_0x33b18c(0x1b5)]+'\x20('+_0x312414['ip']+')');const _0x207856={'request':{'amount':_0x3c76e9,'currency':_0x3249f2,'description':_0x42bc28,'gate_id':parseInt(this[_0x33b18c(0x195)][_0x33b18c(0x179)]),'return_url':_0x21bf5d,'notification_url':_0x279564,'credit_card':_0x23b179,'customer':{'email':_0x312414['email'],'phone':_0x10fd0a,'birth_date':_0x312414['birth_date'],'billing':_0x3ad5c8},'test':this[_0x33b18c(0x195)][_0x33b18c(0x188)]}},_0x4c1099=this['generateRequestId'](),_0x24ebcb={'Authorization':'Basic\x20'+this[_0x33b18c(0x197)](),'Content-Type':_0x33b18c(0x189),'Accept':_0x33b18c(0x189),'X-API-Version':'3','RequestID':_0x4c1099};try{console['log'](_0x33b18c(0x1a2)),console[_0x33b18c(0x1d4)](_0x33b18c(0x1c8)+_0x4c1099),console[_0x33b18c(0x1d4)](_0x33b18c(0x1a5)+this['config'][_0x33b18c(0x1a1)]+_0x33b18c(0x1ab)),console[_0x33b18c(0x1d4)](_0x33b18c(0x1d7),JSON[_0x33b18c(0x18c)](_0x24ebcb,null,0x2)),console[_0x33b18c(0x1d4)](_0x33b18c(0x1a8),JSON[_0x33b18c(0x18c)](_0x207856,null,0x2));const _0x39c5c4=await(0x0,node_fetch_1[_0x33b18c(0x198)])(this['config']['baseUrl']+'/transactions/payments',{'method':_0x33b18c(0x177),'headers':_0x24ebcb,'body':JSON[_0x33b18c(0x18c)](_0x207856)}),_0x12505b=await _0x39c5c4['text']();console[_0x33b18c(0x1d4)](_0x33b18c(0x1b8)+_0x39c5c4[_0x33b18c(0x176)]),console[_0x33b18c(0x1d4)](_0x33b18c(0x1cb)+_0x12505b);if(!_0x39c5c4['ok'])throw new Error(_0x33b18c(0x17f)+_0x39c5c4[_0x33b18c(0x176)]+'\x20'+_0x39c5c4[_0x33b18c(0x1c1)]+_0x33b18c(0x1c3)+_0x12505b);const _0x1c7eb3=JSON[_0x33b18c(0x18b)](_0x12505b);return console[_0x33b18c(0x1d4)]('âœ…\x20SquirrelPay\x20Response\x20Success:'),console[_0x33b18c(0x1d4)](_0x33b18c(0x1b3)+_0x1c7eb3['uid']),console[_0x33b18c(0x1d4)]('\x20\x20\x20Status:\x20'+_0x1c7eb3[_0x33b18c(0x176)]),console[_0x33b18c(0x1d4)](_0x33b18c(0x1bd)+_0x1c7eb3[_0x33b18c(0x1a9)]),console['log'](_0x33b18c(0x181)+_0x1c7eb3[_0x33b18c(0x17d)]),console[_0x33b18c(0x1d4)](_0x33b18c(0x182)+_0x1c7eb3[_0x33b18c(0x1b2)][_0x33b18c(0x1a7)]),console['log'](_0x33b18c(0x17b)+_0x1c7eb3['payment_method'][_0x33b18c(0x1b7)]),_0x1c7eb3['redirect_url']&&console[_0x33b18c(0x1d4)](_0x33b18c(0x1d5)+_0x1c7eb3[_0x33b18c(0x1ae)]),_0x1c7eb3;}catch(_0x49e6fa){console['error'](_0x33b18c(0x1af),_0x49e6fa);throw _0x49e6fa;}}['getPaymentStatus'](_0x2fb40f){const _0x229b44=a68_0x117009,_0x10b316=_0x2fb40f[_0x229b44(0x193)],_0x1b0efc=_0x2fb40f[_0x229b44(0x194)][_0x229b44(0x1b7)];console[_0x229b44(0x1d4)]('ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x2fb40f[_0x229b44(0x176)]);switch(_0x2fb40f[_0x229b44(0x176)]){case _0x229b44(0x18a):return{'status':'PAID','gatewayPaymentId':_0x10b316,'cardLast4':_0x1b0efc};case _0x229b44(0x1a4):return{'status':'PENDING','gatewayPaymentId':_0x10b316,'cardLast4':_0x1b0efc,'redirectUrl':_0x2fb40f[_0x229b44(0x1ae)]};case _0x229b44(0x1c6):const _0x26224e=_0x2fb40f['friendly_message']||'',_0x31e6ef=_0x2fb40f[_0x229b44(0x1aa)]||'';let _0x3b4fff='';if(_0x26224e&&_0x31e6ef)_0x3b4fff=_0x26224e+_0x229b44(0x183)+_0x31e6ef;else{if(_0x26224e)_0x3b4fff=_0x26224e;else _0x31e6ef?_0x3b4fff=_0x31e6ef:_0x3b4fff=_0x229b44(0x1cf);}return{'status':_0x229b44(0x1ad),'failureMessage':_0x3b4fff,'gatewayPaymentId':_0x10b316,'cardLast4':_0x1b0efc};default:console[_0x229b44(0x1cc)](_0x229b44(0x1d0)+_0x2fb40f[_0x229b44(0x176)]);const _0x1b381b=_0x2fb40f[_0x229b44(0x17d)]||'',_0x5986d6=_0x2fb40f[_0x229b44(0x1aa)]||'';let _0xc83ab0='';if(_0x1b381b&&_0x5986d6)_0xc83ab0=_0x1b381b+_0x229b44(0x183)+_0x5986d6;else{if(_0x1b381b)_0xc83ab0=_0x1b381b;else _0x5986d6?_0xc83ab0=_0x5986d6:_0xc83ab0=_0x229b44(0x178);}return{'status':'FAILED','failureMessage':_0xc83ab0,'gatewayPaymentId':_0x10b316,'cardLast4':_0x1b0efc};}}[a68_0x117009(0x18d)](_0xcf0aba){const _0x21db1b=a68_0x117009,_0x1d6903=new Date()['toISOString'](),_0x46c297={'timestamp':_0x1d6903,'webhook':_0xcf0aba,'source':_0x21db1b(0x1ce)},_0x1be5d2=JSON['stringify'](_0x46c297)+'\x0a';try{fs_1[_0x21db1b(0x198)][_0x21db1b(0x1c5)](this[_0x21db1b(0x1bf)],_0x1be5d2),console[_0x21db1b(0x1d4)](_0x21db1b(0x190)+_0x1d6903);}catch(_0x3ee1fe){console[_0x21db1b(0x1c9)](_0x21db1b(0x19e),_0x3ee1fe);}}['getWebhookLogs'](_0x2bcf57=0x32){const _0x1672d7=a68_0x117009;try{if(!fs_1['default'][_0x1672d7(0x1c4)](this['webhookLogPath']))return[];const _0x38cadf=fs_1[_0x1672d7(0x198)][_0x1672d7(0x187)](this['webhookLogPath'],'utf-8'),_0x2fd273=_0x38cadf[_0x1672d7(0x17c)]()[_0x1672d7(0x1b9)]('\x0a')[_0x1672d7(0x1d1)](_0x323db4=>_0x323db4);return _0x2fd273[_0x1672d7(0x192)](-_0x2bcf57)[_0x1672d7(0x1a3)](_0x5a2306=>{const _0x2fbdd3=_0x1672d7;try{return JSON[_0x2fbdd3(0x18b)](_0x5a2306);}catch{return null;}})[_0x1672d7(0x1d1)](_0x1c7688=>_0x1c7688!==null);}catch(_0x188261){return console[_0x1672d7(0x1c9)](_0x1672d7(0x1ba),_0x188261),[];}}}exports[a68_0x117009(0x180)]=SquirrelPayService;