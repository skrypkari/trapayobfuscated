'use strict';const a64_0x28da52=a64_0x4c0e;function a64_0x5c79(){const _0x4512cd=['PAID','from','getPaymentStatus','__importDefault','POST','map','logs','birth_date','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','3301375Gjvrkr','secretKey','config','redirect_url','stringify','generateRequestId','squirrel-pay','warn','randomUUID','SquirrelPay\x20API\x20error:\x20','\x20\x20\x20Message:\x20','2721048pBCKXU','code','filter','application/json','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','payment_method','Unknown\x20error','798748vcNmbV','transaction','utf-8','statusText','1249750smuxWZ','incomplete','baseUrl','webhookLogPath','PENDING','__esModule','dirname','371140dzmEaG','parse','ðŸ”§\x20Headers:','âœ…\x20SquirrelPay\x20Response\x20Success:','log','message','last_4','cwd','âŒ\x20SquirrelPay\x20API\x20Error:','1861374eaZqfX','default','SquirrelPayService','base64','FAILED','\x20\x20\x20Last\x204:\x20','gateway_id','toISOString','processCardPayment','ðŸ’°\x20Amount:\x20','error','trim','\x20||\x20','split','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','defineProperty','\x20\x20\x20Status:\x20','2281027YNryZW','friendly_message','crypto','ðŸ”—\x20URL:\x20','text','node-fetch','getBasicAuth','successful','ðŸ“¦\x20Body:','status','\x20\x20\x20Code:\x20','email','ðŸ“\x20Description:\x20','\x20\x20\x20Gateway\x20ID:\x20','6xkxZDX','\x20-\x20','/transactions/payments','toString','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','\x20\x20\x20UID:\x20','appendFileSync','existsSync','Payment\x20failed','shopId','getWebhookLogs'];a64_0x5c79=function(){return _0x4512cd;};return a64_0x5c79();}(function(_0x4883c1,_0x2d3a8e){const _0x32f54b=a64_0x4c0e,_0x252523=_0x4883c1();while(!![]){try{const _0x2236c6=parseInt(_0x32f54b(0x141))/0x1+-parseInt(_0x32f54b(0x13a))/0x2+parseInt(_0x32f54b(0x169))/0x3*(parseInt(_0x32f54b(0x136))/0x4)+parseInt(_0x32f54b(0x124))/0x5+parseInt(_0x32f54b(0x14a))/0x6+-parseInt(_0x32f54b(0x15b))/0x7+-parseInt(_0x32f54b(0x12f))/0x8;if(_0x2236c6===_0x2d3a8e)break;else _0x252523['push'](_0x252523['shift']());}catch(_0x186cbf){_0x252523['push'](_0x252523['shift']());}}}(a64_0x5c79,0x6de67));var __importDefault=this&&this[a64_0x28da52(0x11e)]||function(_0x186208){const _0x4942aa=a64_0x28da52;return _0x186208&&_0x186208[_0x4942aa(0x13f)]?_0x186208:{'default':_0x186208};};Object[a64_0x28da52(0x159)](exports,'__esModule',{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a64_0x28da52(0x15d))),node_fetch_1=__importDefault(require(a64_0x28da52(0x160))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path'));function a64_0x4c0e(_0x3d6101,_0x47838e){_0x3d6101=_0x3d6101-0x11c;const _0x5c7952=a64_0x5c79();let _0x4c0eb3=_0x5c7952[_0x3d6101];return _0x4c0eb3;}class SquirrelPayService{constructor(_0x12cfd9){const _0x2a7520=a64_0x28da52;this['config']=_0x12cfd9,this[_0x2a7520(0x13d)]=path_1[_0x2a7520(0x14b)]['join'](process[_0x2a7520(0x148)](),_0x2a7520(0x121),'squirrel-pay-webhooks.log');const _0x4792f9=path_1[_0x2a7520(0x14b)][_0x2a7520(0x140)](this['webhookLogPath']);!fs_1[_0x2a7520(0x14b)][_0x2a7520(0x170)](_0x4792f9)&&fs_1[_0x2a7520(0x14b)]['mkdirSync'](_0x4792f9,{'recursive':!![]});}[a64_0x28da52(0x161)](){const _0x5e06b2=a64_0x28da52,_0x7b43fd=this[_0x5e06b2(0x126)][_0x5e06b2(0x172)]+':'+this[_0x5e06b2(0x126)][_0x5e06b2(0x125)];return Buffer[_0x5e06b2(0x11c)](_0x7b43fd)[_0x5e06b2(0x16c)](_0x5e06b2(0x14d));}['generateRequestId'](){const _0x510f10=a64_0x28da52;return crypto_1[_0x510f10(0x14b)][_0x510f10(0x12c)]();}async[a64_0x28da52(0x152)](_0x14c6bb,_0x36f232,_0x53e2ba,_0x5a4884,_0x11d20c,_0x3e112c,_0xba03e1,_0x1543a9,_0x3ceba3){const _0x276821=a64_0x28da52;console[_0x276821(0x145)]('ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment'),console[_0x276821(0x145)](_0x276821(0x153)+_0x14c6bb+'\x20'+_0x36f232),console[_0x276821(0x145)](_0x276821(0x167)+_0x53e2ba),console[_0x276821(0x145)]('ðŸ‘¤\x20Customer:\x20'+_0xba03e1[_0x276821(0x166)]+'\x20('+_0xba03e1['ip']+')');const _0x53e008={'request':{'amount':_0x14c6bb,'currency':_0x36f232,'description':_0x53e2ba,'gate_id':parseInt(this[_0x276821(0x126)][_0x276821(0x172)]),'return_url':_0x5a4884,'notification_url':_0x11d20c,'credit_card':_0x3e112c,'customer':{'email':_0xba03e1[_0x276821(0x166)],'phone':_0x3ceba3,'birth_date':_0xba03e1[_0x276821(0x122)],'billing':_0x1543a9},'test':this[_0x276821(0x126)]['isTestMode']}},_0x5b0647=this[_0x276821(0x129)](),_0xba359b={'Authorization':'Basic\x20'+this[_0x276821(0x161)](),'Content-Type':_0x276821(0x132),'Accept':_0x276821(0x132),'X-API-Version':'3','RequestID':_0x5b0647};try{console[_0x276821(0x145)](_0x276821(0x16d)),console[_0x276821(0x145)]('ðŸ“‹\x20Request\x20ID:\x20'+_0x5b0647),console[_0x276821(0x145)](_0x276821(0x15e)+this[_0x276821(0x126)][_0x276821(0x13c)]+_0x276821(0x16b)),console['log'](_0x276821(0x143),JSON[_0x276821(0x128)](_0xba359b,null,0x2)),console[_0x276821(0x145)](_0x276821(0x163),JSON[_0x276821(0x128)](_0x53e008,null,0x2));const _0x410221=await(0x0,node_fetch_1['default'])(this['config']['baseUrl']+'/transactions/payments',{'method':_0x276821(0x11f),'headers':_0xba359b,'body':JSON[_0x276821(0x128)](_0x53e008)}),_0x407f66=await _0x410221[_0x276821(0x15f)]();console[_0x276821(0x145)](_0x276821(0x133)+_0x410221[_0x276821(0x164)]),console[_0x276821(0x145)]('ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20'+_0x407f66);if(!_0x410221['ok'])throw new Error(_0x276821(0x12d)+_0x410221[_0x276821(0x164)]+'\x20'+_0x410221[_0x276821(0x139)]+_0x276821(0x16a)+_0x407f66);const _0x3c7e7a=JSON[_0x276821(0x142)](_0x407f66);return console[_0x276821(0x145)](_0x276821(0x144)),console['log'](_0x276821(0x16e)+_0x3c7e7a['uid']),console[_0x276821(0x145)](_0x276821(0x15a)+_0x3c7e7a[_0x276821(0x164)]),console[_0x276821(0x145)](_0x276821(0x165)+_0x3c7e7a[_0x276821(0x130)]),console[_0x276821(0x145)](_0x276821(0x12e)+_0x3c7e7a[_0x276821(0x15c)]),console[_0x276821(0x145)](_0x276821(0x168)+_0x3c7e7a[_0x276821(0x137)][_0x276821(0x150)]),console[_0x276821(0x145)](_0x276821(0x14f)+_0x3c7e7a[_0x276821(0x134)][_0x276821(0x147)]),_0x3c7e7a[_0x276821(0x127)]&&console['log']('ðŸ”„\x20Redirect\x20URL:\x20'+_0x3c7e7a[_0x276821(0x127)]),_0x3c7e7a;}catch(_0x1b455f){console[_0x276821(0x154)](_0x276821(0x149),_0x1b455f);throw _0x1b455f;}}[a64_0x28da52(0x11d)](_0x1b104a){const _0xa7d548=a64_0x28da52,_0x5a1075=_0x1b104a['uid'],_0x3265a8=_0x1b104a[_0xa7d548(0x134)][_0xa7d548(0x147)];console[_0xa7d548(0x145)]('ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x1b104a[_0xa7d548(0x164)]);switch(_0x1b104a[_0xa7d548(0x164)]){case _0xa7d548(0x162):return{'status':_0xa7d548(0x174),'gatewayPaymentId':_0x5a1075,'cardLast4':_0x3265a8};case _0xa7d548(0x13b):return{'status':_0xa7d548(0x13e),'gatewayPaymentId':_0x5a1075,'cardLast4':_0x3265a8,'redirectUrl':_0x1b104a[_0xa7d548(0x127)]};case'failed':const _0x3cbc47=_0x1b104a[_0xa7d548(0x15c)]||'',_0x2fe3c9=_0x1b104a[_0xa7d548(0x146)]||'';let _0x244aeb='';if(_0x3cbc47&&_0x2fe3c9)_0x244aeb=_0x3cbc47+'\x20||\x20'+_0x2fe3c9;else{if(_0x3cbc47)_0x244aeb=_0x3cbc47;else _0x2fe3c9?_0x244aeb=_0x2fe3c9:_0x244aeb=_0xa7d548(0x171);}return{'status':_0xa7d548(0x14e),'failureMessage':_0x244aeb,'gatewayPaymentId':_0x5a1075,'cardLast4':_0x3265a8};default:console[_0xa7d548(0x12b)](_0xa7d548(0x158)+_0x1b104a[_0xa7d548(0x164)]);const _0x4af7e1=_0x1b104a[_0xa7d548(0x15c)]||'',_0x234efe=_0x1b104a[_0xa7d548(0x146)]||'';let _0x407e77='';if(_0x4af7e1&&_0x234efe)_0x407e77=_0x4af7e1+_0xa7d548(0x156)+_0x234efe;else{if(_0x4af7e1)_0x407e77=_0x4af7e1;else _0x234efe?_0x407e77=_0x234efe:_0x407e77=_0xa7d548(0x135);}return{'status':_0xa7d548(0x14e),'failureMessage':_0x407e77,'gatewayPaymentId':_0x5a1075,'cardLast4':_0x3265a8};}}['logWebhook'](_0x38589f){const _0x21e623=a64_0x28da52,_0x4f0a08=new Date()[_0x21e623(0x151)](),_0x46bc01={'timestamp':_0x4f0a08,'webhook':_0x38589f,'source':_0x21e623(0x12a)},_0x2d3bf6=JSON[_0x21e623(0x128)](_0x46bc01)+'\x0a';try{fs_1['default'][_0x21e623(0x16f)](this[_0x21e623(0x13d)],_0x2d3bf6),console[_0x21e623(0x145)]('ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20'+_0x4f0a08);}catch(_0x5c342d){console[_0x21e623(0x154)]('âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:',_0x5c342d);}}[a64_0x28da52(0x173)](_0x4729d7=0x32){const _0xefbc71=a64_0x28da52;try{if(!fs_1['default'][_0xefbc71(0x170)](this['webhookLogPath']))return[];const _0x145ddc=fs_1[_0xefbc71(0x14b)]['readFileSync'](this[_0xefbc71(0x13d)],_0xefbc71(0x138)),_0x27caf7=_0x145ddc[_0xefbc71(0x155)]()[_0xefbc71(0x157)]('\x0a')['filter'](_0x10ceb7=>_0x10ceb7);return _0x27caf7['slice'](-_0x4729d7)[_0xefbc71(0x120)](_0x3f9e26=>{const _0xb3c95=_0xefbc71;try{return JSON[_0xb3c95(0x142)](_0x3f9e26);}catch{return null;}})[_0xefbc71(0x131)](_0x23f409=>_0x23f409!==null);}catch(_0x48fedf){return console[_0xefbc71(0x154)](_0xefbc71(0x123),_0x48fedf),[];}}}exports[a64_0x28da52(0x14c)]=SquirrelPayService;