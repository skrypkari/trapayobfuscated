'use strict';const a76_0x5a4f2c=a76_0x4860;(function(_0x18b9f0,_0x1581e8){const _0x262067=a76_0x4860,_0x5790db=_0x18b9f0();while(!![]){try{const _0x5c31bb=-parseInt(_0x262067(0x17a))/0x1*(parseInt(_0x262067(0x167))/0x2)+parseInt(_0x262067(0x16e))/0x3*(-parseInt(_0x262067(0x188))/0x4)+-parseInt(_0x262067(0x146))/0x5+parseInt(_0x262067(0x15d))/0x6*(-parseInt(_0x262067(0x195))/0x7)+-parseInt(_0x262067(0x152))/0x8+parseInt(_0x262067(0x15b))/0x9*(parseInt(_0x262067(0x174))/0xa)+-parseInt(_0x262067(0x18a))/0xb*(-parseInt(_0x262067(0x15a))/0xc);if(_0x5c31bb===_0x1581e8)break;else _0x5790db['push'](_0x5790db['shift']());}catch(_0x557f17){_0x5790db['push'](_0x5790db['shift']());}}}(a76_0x5bf3,0x668d1));var __importDefault=this&&this[a76_0x5a4f2c(0x165)]||function(_0x480ade){const _0x225bb8=a76_0x5a4f2c;return _0x480ade&&_0x480ade[_0x225bb8(0x169)]?_0x480ade:{'default':_0x480ade};};Object[a76_0x5a4f2c(0x160)](exports,'__esModule',{'value':!![]}),exports[a76_0x5a4f2c(0x170)]=void 0x0;const crypto_1=__importDefault(require(a76_0x5a4f2c(0x145))),node_fetch_1=__importDefault(require(a76_0x5a4f2c(0x185))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x5a4f2c(0x149)));class SquirrelPayService{constructor(_0x3c717e){const _0x478d00=a76_0x5a4f2c;this[_0x478d00(0x144)]=_0x3c717e,this[_0x478d00(0x184)]=path_1[_0x478d00(0x186)][_0x478d00(0x14f)](process[_0x478d00(0x163)](),_0x478d00(0x16b),'squirrel-pay-webhooks.log');const _0x77832a=path_1[_0x478d00(0x186)]['dirname'](this[_0x478d00(0x184)]);!fs_1[_0x478d00(0x186)][_0x478d00(0x157)](_0x77832a)&&fs_1[_0x478d00(0x186)][_0x478d00(0x193)](_0x77832a,{'recursive':!![]});}[a76_0x5a4f2c(0x17c)](){const _0x18c0b1=a76_0x5a4f2c,_0x126b85=this[_0x18c0b1(0x144)][_0x18c0b1(0x172)]+':'+this[_0x18c0b1(0x144)][_0x18c0b1(0x142)];return Buffer['from'](_0x126b85)['toString'](_0x18c0b1(0x196));}[a76_0x5a4f2c(0x17b)](){const _0x504545=a76_0x5a4f2c;return crypto_1[_0x504545(0x186)][_0x504545(0x178)]();}async[a76_0x5a4f2c(0x18b)](_0x196a71,_0x22c0fa,_0xffef8b,_0x17e36a,_0x4fa38c,_0x49e5b5,_0x23669c,_0x59b615,_0x145b4d){const _0x360a42=a76_0x5a4f2c;console[_0x360a42(0x16d)](_0x360a42(0x151)),console[_0x360a42(0x16d)]('ğŸ’°\x20Amount:\x20'+_0x196a71+'\x20'+_0x22c0fa),console['log'](_0x360a42(0x197)+_0xffef8b),console[_0x360a42(0x16d)]('ğŸ‘¤\x20Customer:\x20'+_0x23669c['email']+'\x20('+_0x23669c['ip']+')');const _0x86cbdc={'request':{'amount':_0x196a71,'currency':_0x22c0fa,'description':_0xffef8b,'gate_id':parseInt(this[_0x360a42(0x144)]['shopId']),'return_url':_0x17e36a,'notification_url':_0x4fa38c,'credit_card':_0x49e5b5,'customer':{'email':_0x23669c['email'],'phone':_0x145b4d,'birth_date':_0x23669c['birth_date'],'billing':_0x59b615},'test':this['config']['isTestMode']}},_0xae7be=this[_0x360a42(0x17b)](),_0x108099={'Authorization':_0x360a42(0x14e)+this[_0x360a42(0x17c)](),'Content-Type':_0x360a42(0x180),'Accept':_0x360a42(0x180),'X-API-Version':'3','RequestID':_0xae7be};try{console['log'](_0x360a42(0x15c)),console['log'](_0x360a42(0x191)+_0xae7be),console['log']('ğŸ”—\x20URL:\x20'+this['config'][_0x360a42(0x143)]+_0x360a42(0x166)),console[_0x360a42(0x16d)]('ğŸ”§\x20Headers:',JSON['stringify'](_0x108099,null,0x2)),console[_0x360a42(0x16d)](_0x360a42(0x175),JSON['stringify'](_0x86cbdc,null,0x2));const _0x612c5f=await(0x0,node_fetch_1[_0x360a42(0x186)])(this['config'][_0x360a42(0x143)]+_0x360a42(0x166),{'method':_0x360a42(0x162),'headers':_0x108099,'body':JSON[_0x360a42(0x17e)](_0x86cbdc)}),_0x417774=await _0x612c5f[_0x360a42(0x168)]();console[_0x360a42(0x16d)]('ğŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20'+_0x612c5f['status']),console[_0x360a42(0x16d)]('ğŸ“„\x20SquirrelPay\x20Response\x20Body:\x20'+_0x417774);if(!_0x612c5f['ok'])throw new Error(_0x360a42(0x194)+_0x612c5f[_0x360a42(0x15f)]+'\x20'+_0x612c5f[_0x360a42(0x148)]+_0x360a42(0x14d)+_0x417774);const _0x2b50c6=JSON[_0x360a42(0x17d)](_0x417774);return console['log'](_0x360a42(0x18e)),console[_0x360a42(0x16d)]('\x20\x20\x20UID:\x20'+_0x2b50c6[_0x360a42(0x16a)]),console[_0x360a42(0x16d)](_0x360a42(0x155)+_0x2b50c6[_0x360a42(0x15f)]),console['log'](_0x360a42(0x18d)+_0x2b50c6['code']),console[_0x360a42(0x16d)](_0x360a42(0x179)+_0x2b50c6[_0x360a42(0x18c)]),console['log'](_0x360a42(0x164)+_0x2b50c6[_0x360a42(0x187)][_0x360a42(0x18f)]),console[_0x360a42(0x16d)](_0x360a42(0x159)+_0x2b50c6[_0x360a42(0x190)][_0x360a42(0x171)]),_0x2b50c6[_0x360a42(0x154)]&&console['log'](_0x360a42(0x153)+_0x2b50c6['redirect_url']),_0x2b50c6;}catch(_0x514e90){console[_0x360a42(0x199)](_0x360a42(0x177),_0x514e90);throw _0x514e90;}}[a76_0x5a4f2c(0x158)](_0x55a59d){const _0x575943=a76_0x5a4f2c,_0x513561=_0x55a59d['uid'],_0x4c7d54=_0x55a59d[_0x575943(0x190)][_0x575943(0x171)];console[_0x575943(0x16d)]('ğŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x55a59d['status']);switch(_0x55a59d[_0x575943(0x15f)]){case _0x575943(0x189):return{'status':_0x575943(0x15e),'gatewayPaymentId':_0x513561,'cardLast4':_0x4c7d54};case _0x575943(0x176):return{'status':_0x575943(0x16f),'gatewayPaymentId':_0x513561,'cardLast4':_0x4c7d54,'redirectUrl':_0x55a59d[_0x575943(0x154)]};case'failed':const _0x256692=_0x55a59d[_0x575943(0x18c)]||'',_0x3a6323=_0x55a59d['message']||'';let _0x36e883='';if(_0x256692&&_0x3a6323)_0x36e883=_0x256692+_0x575943(0x14c)+_0x3a6323;else{if(_0x256692)_0x36e883=_0x256692;else _0x3a6323?_0x36e883=_0x3a6323:_0x36e883=_0x575943(0x19a);}return{'status':_0x575943(0x17f),'failureMessage':_0x36e883,'gatewayPaymentId':_0x513561,'cardLast4':_0x4c7d54};default:console[_0x575943(0x156)]('âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20'+_0x55a59d[_0x575943(0x15f)]);const _0x11fb42=_0x55a59d[_0x575943(0x18c)]||'',_0xb91fcd=_0x55a59d['message']||'';let _0x5b755c='';if(_0x11fb42&&_0xb91fcd)_0x5b755c=_0x11fb42+_0x575943(0x14c)+_0xb91fcd;else{if(_0x11fb42)_0x5b755c=_0x11fb42;else _0xb91fcd?_0x5b755c=_0xb91fcd:_0x5b755c='Unknown\x20error';}return{'status':_0x575943(0x17f),'failureMessage':_0x5b755c,'gatewayPaymentId':_0x513561,'cardLast4':_0x4c7d54};}}[a76_0x5a4f2c(0x161)](_0x269bc4){const _0x2c7b3f=a76_0x5a4f2c,_0x2b48d5=new Date()['toISOString'](),_0x983447={'timestamp':_0x2b48d5,'webhook':_0x269bc4,'source':'squirrel-pay'},_0x321183=JSON['stringify'](_0x983447)+'\x0a';try{fs_1['default']['appendFileSync'](this['webhookLogPath'],_0x321183),console[_0x2c7b3f(0x16d)](_0x2c7b3f(0x150)+_0x2b48d5);}catch(_0x4ad369){console[_0x2c7b3f(0x199)](_0x2c7b3f(0x182),_0x4ad369);}}[a76_0x5a4f2c(0x183)](_0x39a46f=0x32){const _0x2b55ea=a76_0x5a4f2c;try{if(!fs_1['default'][_0x2b55ea(0x157)](this['webhookLogPath']))return[];const _0x2efe6=fs_1[_0x2b55ea(0x186)][_0x2b55ea(0x14a)](this['webhookLogPath'],_0x2b55ea(0x181)),_0x585a7b=_0x2efe6[_0x2b55ea(0x14b)]()[_0x2b55ea(0x198)]('\x0a')['filter'](_0x365a01=>_0x365a01);return _0x585a7b[_0x2b55ea(0x173)](-_0x39a46f)[_0x2b55ea(0x192)](_0x444b18=>{const _0x40a1a8=_0x2b55ea;try{return JSON[_0x40a1a8(0x17d)](_0x444b18);}catch{return null;}})[_0x2b55ea(0x16c)](_0x5bfeb5=>_0x5bfeb5!==null);}catch(_0x460189){return console[_0x2b55ea(0x199)](_0x2b55ea(0x147),_0x460189),[];}}}exports['SquirrelPayService']=SquirrelPayService;function a76_0x4860(_0x230cfb,_0x3f2231){_0x230cfb=_0x230cfb-0x142;const _0x5bf3e2=a76_0x5bf3();let _0x486054=_0x5bf3e2[_0x230cfb];return _0x486054;}function a76_0x5bf3(){const _0x4aa6f6=['filter','log','287526BqSUXO','PENDING','SquirrelPayService','last_4','shopId','slice','10rAhKtm','ğŸ“¦\x20Body:','incomplete','âŒ\x20SquirrelPay\x20API\x20Error:','randomUUID','\x20\x20\x20Message:\x20','2997Aaeqlw','generateRequestId','getBasicAuth','parse','stringify','FAILED','application/json','utf-8','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','getWebhookLogs','webhookLogPath','node-fetch','default','transaction','4hGrLbU','successful','2058991FRtVCI','processCardPayment','friendly_message','\x20\x20\x20Code:\x20','âœ…\x20SquirrelPay\x20Response\x20Success:','gateway_id','payment_method','ğŸ“‹\x20Request\x20ID:\x20','map','mkdirSync','SquirrelPay\x20API\x20error:\x20','224kiXiYa','base64','ğŸ“\x20Description:\x20','split','error','Payment\x20failed','secretKey','baseUrl','config','crypto','2048685MGCgxT','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','statusText','path','readFileSync','trim','\x20||\x20','\x20-\x20','Basic\x20','join','ğŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','ğŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','851696UhCTyH','ğŸ”„\x20Redirect\x20URL:\x20','redirect_url','\x20\x20\x20Status:\x20','warn','existsSync','getPaymentStatus','\x20\x20\x20Last\x204:\x20','108bzFkHU','1292526PIYJEZ','ğŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','83532KlXYJv','PAID','status','defineProperty','logWebhook','POST','cwd','\x20\x20\x20Gateway\x20ID:\x20','__importDefault','/transactions/payments','234cTaQyP','text','__esModule','uid','logs'];a76_0x5bf3=function(){return _0x4aa6f6;};return a76_0x5bf3();}