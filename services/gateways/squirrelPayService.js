'use strict';const a70_0x27f657=a70_0x5740;(function(_0x4551e2,_0x54bebb){const _0xb60018=a70_0x5740,_0xcc5385=_0x4551e2();while(!![]){try{const _0x2bc4b1=parseInt(_0xb60018(0x17e))/0x1*(-parseInt(_0xb60018(0x16c))/0x2)+parseInt(_0xb60018(0x1a6))/0x3*(parseInt(_0xb60018(0x1b5))/0x4)+-parseInt(_0xb60018(0x185))/0x5*(parseInt(_0xb60018(0x17b))/0x6)+-parseInt(_0xb60018(0x16e))/0x7*(parseInt(_0xb60018(0x18b))/0x8)+parseInt(_0xb60018(0x198))/0x9+parseInt(_0xb60018(0x170))/0xa*(-parseInt(_0xb60018(0x1a5))/0xb)+parseInt(_0xb60018(0x1ac))/0xc*(parseInt(_0xb60018(0x1b0))/0xd);if(_0x2bc4b1===_0x54bebb)break;else _0xcc5385['push'](_0xcc5385['shift']());}catch(_0x2f34b2){_0xcc5385['push'](_0xcc5385['shift']());}}}(a70_0x1bc9,0xf15df));var __importDefault=this&&this[a70_0x27f657(0x174)]||function(_0x2056e7){const _0x22ad08=a70_0x27f657;return _0x2056e7&&_0x2056e7[_0x22ad08(0x1ba)]?_0x2056e7:{'default':_0x2056e7};};Object[a70_0x27f657(0x1b2)](exports,'__esModule',{'value':!![]}),exports['SquirrelPayService']=void 0x0;const crypto_1=__importDefault(require(a70_0x27f657(0x1a3))),node_fetch_1=__importDefault(require('node-fetch')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a70_0x27f657(0x186)));class SquirrelPayService{constructor(_0x2ce17a){const _0x5aadd6=a70_0x27f657;this[_0x5aadd6(0x1c8)]=_0x2ce17a,this['webhookLogPath']=path_1[_0x5aadd6(0x191)][_0x5aadd6(0x1b9)](process['cwd'](),_0x5aadd6(0x1c1),'squirrel-pay-webhooks.log');const _0x3e2272=path_1['default'][_0x5aadd6(0x19c)](this[_0x5aadd6(0x1a4)]);!fs_1[_0x5aadd6(0x191)]['existsSync'](_0x3e2272)&&fs_1['default'][_0x5aadd6(0x1ae)](_0x3e2272,{'recursive':!![]});}[a70_0x27f657(0x192)](){const _0x580a9f=a70_0x27f657,_0x55de87=this[_0x580a9f(0x1c8)][_0x580a9f(0x1a1)]+':'+this[_0x580a9f(0x1c8)]['secretKey'];return Buffer[_0x580a9f(0x196)](_0x55de87)[_0x580a9f(0x18d)](_0x580a9f(0x1c0));}[a70_0x27f657(0x1bf)](){const _0x4c5e08=a70_0x27f657;return crypto_1[_0x4c5e08(0x191)][_0x4c5e08(0x1be)]();}async['processCardPayment'](_0x47c9d5,_0x2e43fa,_0x409385,_0x569116,_0x56aea4,_0x348625,_0x17de5e,_0x31a1b9,_0x398877){const _0x4649a1=a70_0x27f657;console[_0x4649a1(0x1bc)](_0x4649a1(0x1c3)),console['log'](_0x4649a1(0x1b8)+_0x47c9d5+'\x20'+_0x2e43fa),console['log']('ğŸ“\x20Description:\x20'+_0x409385),console[_0x4649a1(0x1bc)](_0x4649a1(0x1a2)+_0x17de5e[_0x4649a1(0x1b4)]+'\x20('+_0x17de5e['ip']+')');const _0x22f0b2={'request':{'amount':_0x47c9d5,'currency':_0x2e43fa,'description':_0x409385,'gate_id':parseInt(this[_0x4649a1(0x1c8)][_0x4649a1(0x1a1)]),'return_url':_0x569116,'notification_url':_0x56aea4,'credit_card':_0x348625,'customer':{'email':_0x17de5e[_0x4649a1(0x1b4)],'phone':_0x398877,'birth_date':_0x17de5e[_0x4649a1(0x17c)],'billing':_0x31a1b9},'test':this['config'][_0x4649a1(0x19d)]}},_0x303f2b=this['generateRequestId'](),_0x775bfa={'Authorization':'Basic\x20'+this[_0x4649a1(0x192)](),'Content-Type':_0x4649a1(0x1c2),'Accept':'application/json','X-API-Version':'3','RequestID':_0x303f2b};try{console[_0x4649a1(0x1bc)](_0x4649a1(0x1af)),console[_0x4649a1(0x1bc)](_0x4649a1(0x1ab)+_0x303f2b),console[_0x4649a1(0x1bc)](_0x4649a1(0x1c4)+this[_0x4649a1(0x1c8)]['baseUrl']+_0x4649a1(0x183)),console[_0x4649a1(0x1bc)]('ğŸ”§\x20Headers:',JSON['stringify'](_0x775bfa,null,0x2)),console[_0x4649a1(0x1bc)](_0x4649a1(0x188),JSON[_0x4649a1(0x171)](_0x22f0b2,null,0x2));const _0x4e95e4=await(0x0,node_fetch_1[_0x4649a1(0x191)])(this[_0x4649a1(0x1c8)]['baseUrl']+_0x4649a1(0x183),{'method':_0x4649a1(0x194),'headers':_0x775bfa,'body':JSON[_0x4649a1(0x171)](_0x22f0b2)}),_0x11227d=await _0x4e95e4[_0x4649a1(0x1ca)]();console[_0x4649a1(0x1bc)](_0x4649a1(0x180)+_0x4e95e4[_0x4649a1(0x193)]),console['log'](_0x4649a1(0x1a8)+_0x11227d);if(!_0x4e95e4['ok'])throw new Error(_0x4649a1(0x179)+_0x4e95e4[_0x4649a1(0x193)]+'\x20'+_0x4e95e4['statusText']+_0x4649a1(0x177)+_0x11227d);const _0x40347b=JSON[_0x4649a1(0x1c9)](_0x11227d);return console[_0x4649a1(0x1bc)]('âœ…\x20SquirrelPay\x20Response\x20Success:'),console[_0x4649a1(0x1bc)](_0x4649a1(0x1b3)+_0x40347b['uid']),console[_0x4649a1(0x1bc)](_0x4649a1(0x189)+_0x40347b[_0x4649a1(0x193)]),console[_0x4649a1(0x1bc)]('\x20\x20\x20Code:\x20'+_0x40347b[_0x4649a1(0x18e)]),console[_0x4649a1(0x1bc)](_0x4649a1(0x190)+_0x40347b[_0x4649a1(0x1a0)]),console['log'](_0x4649a1(0x195)+_0x40347b[_0x4649a1(0x187)][_0x4649a1(0x16b)]),console[_0x4649a1(0x1bc)](_0x4649a1(0x19e)+_0x40347b[_0x4649a1(0x1a7)][_0x4649a1(0x19a)]),_0x40347b[_0x4649a1(0x1b7)]&&console[_0x4649a1(0x1bc)](_0x4649a1(0x1c6)+_0x40347b[_0x4649a1(0x1b7)]),_0x40347b;}catch(_0x422bd4){console[_0x4649a1(0x1aa)](_0x4649a1(0x18f),_0x422bd4);throw _0x422bd4;}}[a70_0x27f657(0x197)](_0x329835){const _0x20ff2a=a70_0x27f657,_0x2b3504=_0x329835[_0x20ff2a(0x19f)],_0x126978=_0x329835['payment_method'][_0x20ff2a(0x19a)];console['log'](_0x20ff2a(0x175)+_0x329835[_0x20ff2a(0x193)]);switch(_0x329835[_0x20ff2a(0x193)]){case _0x20ff2a(0x1bd):return{'status':_0x20ff2a(0x19b),'gatewayPaymentId':_0x2b3504,'cardLast4':_0x126978};case _0x20ff2a(0x1b1):return{'status':_0x20ff2a(0x184),'gatewayPaymentId':_0x2b3504,'cardLast4':_0x126978,'redirectUrl':_0x329835['redirect_url']};case _0x20ff2a(0x18c):const _0x5f05ed=_0x329835[_0x20ff2a(0x1a0)]||'',_0x41dbbb=_0x329835[_0x20ff2a(0x1ad)]||'';let _0x374c3d='';if(_0x5f05ed&&_0x41dbbb)_0x374c3d=_0x5f05ed+_0x20ff2a(0x1b6)+_0x41dbbb;else{if(_0x5f05ed)_0x374c3d=_0x5f05ed;else _0x41dbbb?_0x374c3d=_0x41dbbb:_0x374c3d='Payment\x20failed';}return{'status':_0x20ff2a(0x18a),'failureMessage':_0x374c3d,'gatewayPaymentId':_0x2b3504,'cardLast4':_0x126978};default:console[_0x20ff2a(0x16d)](_0x20ff2a(0x178)+_0x329835['status']);const _0x1a51e8=_0x329835[_0x20ff2a(0x1a0)]||'',_0x480b97=_0x329835['message']||'';let _0x2e5e6a='';if(_0x1a51e8&&_0x480b97)_0x2e5e6a=_0x1a51e8+_0x20ff2a(0x1b6)+_0x480b97;else{if(_0x1a51e8)_0x2e5e6a=_0x1a51e8;else _0x480b97?_0x2e5e6a=_0x480b97:_0x2e5e6a=_0x20ff2a(0x1c7);}return{'status':_0x20ff2a(0x18a),'failureMessage':_0x2e5e6a,'gatewayPaymentId':_0x2b3504,'cardLast4':_0x126978};}}[a70_0x27f657(0x176)](_0x59a79f){const _0xaa0fae=a70_0x27f657,_0x5832d5=new Date()['toISOString'](),_0x48446c={'timestamp':_0x5832d5,'webhook':_0x59a79f,'source':'squirrel-pay'},_0x3e5e2e=JSON[_0xaa0fae(0x171)](_0x48446c)+'\x0a';try{fs_1[_0xaa0fae(0x191)][_0xaa0fae(0x17a)](this['webhookLogPath'],_0x3e5e2e),console[_0xaa0fae(0x1bc)](_0xaa0fae(0x1a9)+_0x5832d5);}catch(_0x214935){console[_0xaa0fae(0x1aa)](_0xaa0fae(0x17d),_0x214935);}}[a70_0x27f657(0x181)](_0x1f00f7=0x32){const _0x4de4b4=a70_0x27f657;try{if(!fs_1[_0x4de4b4(0x191)][_0x4de4b4(0x1c5)](this[_0x4de4b4(0x1a4)]))return[];const _0x184280=fs_1[_0x4de4b4(0x191)]['readFileSync'](this[_0x4de4b4(0x1a4)],_0x4de4b4(0x1bb)),_0x100e39=_0x184280[_0x4de4b4(0x199)]()[_0x4de4b4(0x182)]('\x0a')[_0x4de4b4(0x172)](_0x2445cc=>_0x2445cc);return _0x100e39[_0x4de4b4(0x173)](-_0x1f00f7)[_0x4de4b4(0x16f)](_0x566672=>{const _0x40d98b=_0x4de4b4;try{return JSON[_0x40d98b(0x1c9)](_0x566672);}catch{return null;}})[_0x4de4b4(0x172)](_0x168e42=>_0x168e42!==null);}catch(_0x5cb579){return console[_0x4de4b4(0x1aa)](_0x4de4b4(0x17f),_0x5cb579),[];}}}exports['SquirrelPayService']=SquirrelPayService;function a70_0x5740(_0x7d9231,_0x382f00){_0x7d9231=_0x7d9231-0x16b;const _0x1bc9aa=a70_0x1bc9();let _0x5740e5=_0x1bc9aa[_0x7d9231];return _0x5740e5;}function a70_0x1bc9(){const _0xb90aed=['warn','175GiUYQx','map','336470pvHQox','stringify','filter','slice','__importDefault','ğŸ”\x20Processing\x20SquirrelPay\x20status:\x20','logWebhook','\x20-\x20','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','SquirrelPay\x20API\x20error:\x20','appendFileSync','1182QSsLCg','birth_date','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','3421UkDHcL','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','ğŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','getWebhookLogs','split','/transactions/payments','PENDING','28125jbvKTC','path','transaction','ğŸ“¦\x20Body:','\x20\x20\x20Status:\x20','FAILED','494416YrUwYH','failed','toString','code','âŒ\x20SquirrelPay\x20API\x20Error:','\x20\x20\x20Message:\x20','default','getBasicAuth','status','POST','\x20\x20\x20Gateway\x20ID:\x20','from','getPaymentStatus','3250431ZosvAq','trim','last_4','PAID','dirname','isTestMode','\x20\x20\x20Last\x204:\x20','uid','friendly_message','shopId','ğŸ‘¤\x20Customer:\x20','crypto','webhookLogPath','605jfdgnF','117801JilreQ','payment_method','ğŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','ğŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','error','ğŸ“‹\x20Request\x20ID:\x20','48lMigSJ','message','mkdirSync','ğŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','11079237TfIUcM','incomplete','defineProperty','\x20\x20\x20UID:\x20','email','196CnTMbd','\x20||\x20','redirect_url','ğŸ’°\x20Amount:\x20','join','__esModule','utf-8','log','successful','randomUUID','generateRequestId','base64','logs','application/json','ğŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','ğŸ”—\x20URL:\x20','existsSync','ğŸ”„\x20Redirect\x20URL:\x20','Unknown\x20error','config','parse','text','gateway_id','118Uecsvj'];a70_0x1bc9=function(){return _0xb90aed;};return a70_0x1bc9();}