'use strict';const a76_0x4c07d6=a76_0x4b75;function a76_0x4b75(_0x452ce2,_0x33e8d4){_0x452ce2=_0x452ce2-0x10d;const _0x4ed4db=a76_0x4ed4();let _0x4b7529=_0x4ed4db[_0x452ce2];return _0x4b7529;}(function(_0x2b9551,_0x1e0c57){const _0x21de5b=a76_0x4b75,_0x154da8=_0x2b9551();while(!![]){try{const _0xd017c3=parseInt(_0x21de5b(0x13d))/0x1*(-parseInt(_0x21de5b(0x143))/0x2)+-parseInt(_0x21de5b(0x124))/0x3*(parseInt(_0x21de5b(0x11c))/0x4)+-parseInt(_0x21de5b(0x139))/0x5*(-parseInt(_0x21de5b(0x140))/0x6)+parseInt(_0x21de5b(0x142))/0x7*(-parseInt(_0x21de5b(0x13f))/0x8)+-parseInt(_0x21de5b(0x14a))/0x9*(-parseInt(_0x21de5b(0x11d))/0xa)+-parseInt(_0x21de5b(0x149))/0xb+parseInt(_0x21de5b(0x133))/0xc;if(_0xd017c3===_0x1e0c57)break;else _0x154da8['push'](_0x154da8['shift']());}catch(_0x1a5a05){_0x154da8['push'](_0x154da8['shift']());}}}(a76_0x4ed4,0x6d919));var __importDefault=this&&this[a76_0x4c07d6(0x12b)]||function(_0x4c7941){const _0x356f12=a76_0x4c07d6;return _0x4c7941&&_0x4c7941[_0x356f12(0x145)]?_0x4c7941:{'default':_0x4c7941};};function a76_0x4ed4(){const _0x22214a=['FAILED','\x20\x20\x20Message:\x20','1390105iVRXex','squirrel-pay-webhooks.log','ðŸ¿ï¸\x20SquirrelPay:\x20Processing\x20card\x20payment','payment_method','9RWAeTN','\x20||\x20','6682472GrLAZh','6ZZDtPk','redirect_url','7CkYabN','24286xtnJey','gateway_id','__esModule','ðŸ”§\x20Headers:','appendFileSync','email','450483cifqOe','9rVInHN','uid','failed','getBasicAuth','last_4','successful','node-fetch','webhookLogPath','ðŸŒ\x20Making\x20request\x20to\x20SquirrelPay\x20API...','birth_date','parse','toString','PENDING','stringify','ðŸ“\x20Description:\x20','ðŸ”„\x20Redirect\x20URL:\x20','toISOString','ðŸ“¥\x20SquirrelPay\x20Response\x20Status:\x20','incomplete','generateRequestId','PAID','default','\x20\x20\x20Status:\x20','baseUrl','ðŸ“„\x20SquirrelPay\x20Response\x20Body:\x20','SquirrelPay\x20API\x20error:\x20','message','statusText','shopId','crypto','Payment\x20failed','log','POST','path','join','transaction','ðŸ“\x20SquirrelPay\x20webhook\x20logged:\x20','status','/transactions/payments','ðŸ“¦\x20Body:','1600044oXNeBB','5214010kDvuIU','defineProperty','existsSync','config','getWebhookLogs','processCardPayment','ðŸ“‹\x20Request\x20ID:\x20','3HFKQZh','readFileSync','âŒ\x20Failed\x20to\x20log\x20SquirrelPay\x20webhook:','warn','dirname','âš ï¸\x20Unknown\x20SquirrelPay\x20status:\x20','text','__importDefault','filter','mkdirSync','SquirrelPayService','ðŸ”—\x20URL:\x20','error','friendly_message','âŒ\x20SquirrelPay\x20API\x20Error:','12419172aAXpqh','from','âŒ\x20Failed\x20to\x20read\x20SquirrelPay\x20webhook\x20logs:','logWebhook'];a76_0x4ed4=function(){return _0x22214a;};return a76_0x4ed4();}Object[a76_0x4c07d6(0x11e)](exports,a76_0x4c07d6(0x145),{'value':!![]}),exports[a76_0x4c07d6(0x12e)]=void 0x0;const crypto_1=__importDefault(require(a76_0x4c07d6(0x111))),node_fetch_1=__importDefault(require(a76_0x4c07d6(0x150))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a76_0x4c07d6(0x115)));class SquirrelPayService{constructor(_0x596cb4){const _0x4ad552=a76_0x4c07d6;this[_0x4ad552(0x120)]=_0x596cb4,this[_0x4ad552(0x151)]=path_1[_0x4ad552(0x15f)][_0x4ad552(0x116)](process['cwd'](),'logs',_0x4ad552(0x13a));const _0x31de3a=path_1[_0x4ad552(0x15f)][_0x4ad552(0x128)](this['webhookLogPath']);!fs_1['default']['existsSync'](_0x31de3a)&&fs_1['default'][_0x4ad552(0x12d)](_0x31de3a,{'recursive':!![]});}[a76_0x4c07d6(0x14d)](){const _0xe6417c=a76_0x4c07d6,_0x47251c=this['config'][_0xe6417c(0x110)]+':'+this[_0xe6417c(0x120)]['secretKey'];return Buffer[_0xe6417c(0x134)](_0x47251c)[_0xe6417c(0x155)]('base64');}[a76_0x4c07d6(0x15d)](){const _0x5da68c=a76_0x4c07d6;return crypto_1[_0x5da68c(0x15f)]['randomUUID']();}async[a76_0x4c07d6(0x122)](_0x1882aa,_0x5a7fe3,_0x23fbcb,_0x5f2093,_0x2a1b9b,_0x3bbc0d,_0x264662,_0x5711d5,_0x1b6745){const _0x11945f=a76_0x4c07d6;console['log'](_0x11945f(0x13b)),console[_0x11945f(0x113)]('ðŸ’°\x20Amount:\x20'+_0x1882aa+'\x20'+_0x5a7fe3),console['log'](_0x11945f(0x158)+_0x23fbcb),console['log']('ðŸ‘¤\x20Customer:\x20'+_0x264662[_0x11945f(0x148)]+'\x20('+_0x264662['ip']+')');const _0x57fee0={'request':{'amount':_0x1882aa,'currency':_0x5a7fe3,'description':_0x23fbcb,'gate_id':parseInt(this['config']['shopId']),'return_url':_0x5f2093,'notification_url':_0x2a1b9b,'credit_card':_0x3bbc0d,'customer':{'email':_0x264662[_0x11945f(0x148)],'phone':_0x1b6745,'birth_date':_0x264662[_0x11945f(0x153)],'billing':_0x5711d5},'test':this[_0x11945f(0x120)]['isTestMode']}},_0x354cee=this[_0x11945f(0x15d)](),_0x2300ca={'Authorization':'Basic\x20'+this['getBasicAuth'](),'Content-Type':'application/json','Accept':'application/json','X-API-Version':'3','RequestID':_0x354cee};try{console[_0x11945f(0x113)](_0x11945f(0x152)),console[_0x11945f(0x113)](_0x11945f(0x123)+_0x354cee),console[_0x11945f(0x113)](_0x11945f(0x12f)+this[_0x11945f(0x120)]['baseUrl']+'/transactions/payments'),console[_0x11945f(0x113)](_0x11945f(0x146),JSON[_0x11945f(0x157)](_0x2300ca,null,0x2)),console[_0x11945f(0x113)](_0x11945f(0x11b),JSON[_0x11945f(0x157)](_0x57fee0,null,0x2));const _0x3d8edd=await(0x0,node_fetch_1[_0x11945f(0x15f)])(this['config'][_0x11945f(0x161)]+_0x11945f(0x11a),{'method':_0x11945f(0x114),'headers':_0x2300ca,'body':JSON['stringify'](_0x57fee0)}),_0x254e29=await _0x3d8edd[_0x11945f(0x12a)]();console['log'](_0x11945f(0x15b)+_0x3d8edd[_0x11945f(0x119)]),console[_0x11945f(0x113)](_0x11945f(0x162)+_0x254e29);if(!_0x3d8edd['ok'])throw new Error(_0x11945f(0x10d)+_0x3d8edd['status']+'\x20'+_0x3d8edd[_0x11945f(0x10f)]+'\x20-\x20'+_0x254e29);const _0x13a669=JSON[_0x11945f(0x154)](_0x254e29);return console['log']('âœ…\x20SquirrelPay\x20Response\x20Success:'),console[_0x11945f(0x113)]('\x20\x20\x20UID:\x20'+_0x13a669[_0x11945f(0x14b)]),console[_0x11945f(0x113)](_0x11945f(0x160)+_0x13a669[_0x11945f(0x119)]),console[_0x11945f(0x113)]('\x20\x20\x20Code:\x20'+_0x13a669['code']),console['log'](_0x11945f(0x138)+_0x13a669[_0x11945f(0x131)]),console[_0x11945f(0x113)]('\x20\x20\x20Gateway\x20ID:\x20'+_0x13a669[_0x11945f(0x117)][_0x11945f(0x144)]),console['log']('\x20\x20\x20Last\x204:\x20'+_0x13a669['payment_method'][_0x11945f(0x14e)]),_0x13a669[_0x11945f(0x141)]&&console[_0x11945f(0x113)](_0x11945f(0x159)+_0x13a669[_0x11945f(0x141)]),_0x13a669;}catch(_0x57dce5){console[_0x11945f(0x130)](_0x11945f(0x132),_0x57dce5);throw _0x57dce5;}}['getPaymentStatus'](_0x50414a){const _0x2e96ad=a76_0x4c07d6,_0x4ec730=_0x50414a[_0x2e96ad(0x14b)],_0x4972b8=_0x50414a[_0x2e96ad(0x13c)][_0x2e96ad(0x14e)];console[_0x2e96ad(0x113)]('ðŸ”\x20Processing\x20SquirrelPay\x20status:\x20'+_0x50414a[_0x2e96ad(0x119)]);switch(_0x50414a[_0x2e96ad(0x119)]){case _0x2e96ad(0x14f):return{'status':_0x2e96ad(0x15e),'gatewayPaymentId':_0x4ec730,'cardLast4':_0x4972b8};case _0x2e96ad(0x15c):return{'status':_0x2e96ad(0x156),'gatewayPaymentId':_0x4ec730,'cardLast4':_0x4972b8,'redirectUrl':_0x50414a['redirect_url']};case _0x2e96ad(0x14c):const _0x1991c8=_0x50414a['friendly_message']||'',_0x4f761d=_0x50414a[_0x2e96ad(0x10e)]||'';let _0x49bce8='';if(_0x1991c8&&_0x4f761d)_0x49bce8=_0x1991c8+_0x2e96ad(0x13e)+_0x4f761d;else{if(_0x1991c8)_0x49bce8=_0x1991c8;else _0x4f761d?_0x49bce8=_0x4f761d:_0x49bce8=_0x2e96ad(0x112);}return{'status':'FAILED','failureMessage':_0x49bce8,'gatewayPaymentId':_0x4ec730,'cardLast4':_0x4972b8};default:console[_0x2e96ad(0x127)](_0x2e96ad(0x129)+_0x50414a[_0x2e96ad(0x119)]);const _0x2db654=_0x50414a[_0x2e96ad(0x131)]||'',_0x31736f=_0x50414a[_0x2e96ad(0x10e)]||'';let _0x2ae098='';if(_0x2db654&&_0x31736f)_0x2ae098=_0x2db654+_0x2e96ad(0x13e)+_0x31736f;else{if(_0x2db654)_0x2ae098=_0x2db654;else _0x31736f?_0x2ae098=_0x31736f:_0x2ae098='Unknown\x20error';}return{'status':_0x2e96ad(0x137),'failureMessage':_0x2ae098,'gatewayPaymentId':_0x4ec730,'cardLast4':_0x4972b8};}}[a76_0x4c07d6(0x136)](_0x48017b){const _0x1002cc=a76_0x4c07d6,_0x481cee=new Date()[_0x1002cc(0x15a)](),_0x24f8bd={'timestamp':_0x481cee,'webhook':_0x48017b,'source':'squirrel-pay'},_0x2b6781=JSON[_0x1002cc(0x157)](_0x24f8bd)+'\x0a';try{fs_1[_0x1002cc(0x15f)][_0x1002cc(0x147)](this[_0x1002cc(0x151)],_0x2b6781),console[_0x1002cc(0x113)](_0x1002cc(0x118)+_0x481cee);}catch(_0x4f98b5){console[_0x1002cc(0x130)](_0x1002cc(0x126),_0x4f98b5);}}[a76_0x4c07d6(0x121)](_0x1858a2=0x32){const _0x37c18c=a76_0x4c07d6;try{if(!fs_1[_0x37c18c(0x15f)][_0x37c18c(0x11f)](this[_0x37c18c(0x151)]))return[];const _0x1d1731=fs_1[_0x37c18c(0x15f)][_0x37c18c(0x125)](this['webhookLogPath'],'utf-8'),_0x16d1b5=_0x1d1731['trim']()['split']('\x0a')[_0x37c18c(0x12c)](_0x452a92=>_0x452a92);return _0x16d1b5['slice'](-_0x1858a2)['map'](_0x4e0cd7=>{const _0x42f043=_0x37c18c;try{return JSON[_0x42f043(0x154)](_0x4e0cd7);}catch{return null;}})['filter'](_0x125905=>_0x125905!==null);}catch(_0xaee54){return console[_0x37c18c(0x130)](_0x37c18c(0x135),_0xaee54),[];}}}exports[a76_0x4c07d6(0x12e)]=SquirrelPayService;