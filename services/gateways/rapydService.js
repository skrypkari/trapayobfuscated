'use strict';function a50_0xddae(){const _0x19f3ba=['https://tesoft.uk/gateway/rapyd/','Full\x20Error\x20Data:','failureCode','205518QmGgts','üá¨üáß\x20Country:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Processing\x20Rapyd\x20webhook:','6oXKsCE','\x20->\x20EUR:','Redirect\x20URL:','RapydService','type','2806040mzolqH','currency','gb_visa_card','Error\x20message:','ERR','application/json','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','\x20(always\x20GB\x20for\x20Rapyd)',',\x20failureMessage=','TesSoft\x20Payment\x20System/1.0','logWhiteDomainRequest',',\x20body:\x20','requested_currency','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','PENDING','POST','now','text','stack','EUR','\x20\x20\x20expiration:\x20','Status\x20Text:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','failure_code','rapyd','Error\x20Code:','ORDER:\x20','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','json','toISOString','gb_mastercard_card','):\x20','logWhiteDomainResponse','Error\x20details:','failure_message','merchant_reference_id','message','https://tesoft.uk/gateway/fail.php?id=','EXP','NEW','HTTP\x20','URL:','157500dyfJko','Response\x20Body:','PAID','===\x20RAPYD\x20SUCCESS\x20===','Response\x20Time:','\x20\x20\x20fixed_side:\x20buy','Error\x20Message:','Response\x20data:','last4','CLO','paymentMethod','GET','8TQCjbh','HTTP\x20Status:','stringify','headers','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Rapyd\x20payment\x20verification\x20error:','582mCfMdc','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/success.php?id=','none','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Parsed\x20Result:','Failed\x20to\x20parse\x20JSON\x20response:','paid','data','FAILED','buy','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20error!\x20status:\x20','\x20(GB\x20-\x20Britain)','953323gANOnl','log','fixed_side','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','/v1/hosted/payment_links','error','error_code','status','amount','\x20\x20\x20requested_currency:\x20EUR','PAYMENT_EXPIRED','logWhiteDomainError','Request\x20Body\x20(Updated\x20Format):','Missing\x20id\x20or\x20redirect_url\x20in\x20response','createPaymentLink','Unknown\x20error','loggerService','payment_method_type','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','../loggerService','PAYMENT_CANCELED','7892xdtsNC','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','CAN','fromEntries','EXPIRED','errorCode','Unknown\x20error\x20from\x20Rapyd\x20API','SUCCESS','parse','1610505CZYWWG','4504743EEMGXx','ACT','verifyPayment','toUpperCase','Payment\x20Link\x20ID:','expiration','redirect_url','/v1/hosted/payment_links/'];a50_0xddae=function(){return _0x19f3ba;};return a50_0xddae();}function a50_0x8b5a(_0x4b9549,_0x18cab3){const _0xddaeb=a50_0xddae();return a50_0x8b5a=function(_0x8b5a6a,_0x5c630b){_0x8b5a6a=_0x8b5a6a-0xa8;let _0xcbf39a=_0xddaeb[_0x8b5a6a];return _0xcbf39a;},a50_0x8b5a(_0x4b9549,_0x18cab3);}const a50_0x4233e0=a50_0x8b5a;(function(_0x5d4102,_0x33f462){const _0x3045f8=a50_0x8b5a,_0x2309ed=_0x5d4102();while(!![]){try{const _0x17ed12=parseInt(_0x3045f8(0xea))/0x1+-parseInt(_0x3045f8(0x11d))/0x2+-parseInt(_0x3045f8(0xb2))/0x3*(parseInt(_0x3045f8(0xd5))/0x4)+parseInt(_0x3045f8(0xde))/0x5*(-parseInt(_0x3045f8(0xee))/0x6)+-parseInt(_0x3045f8(0xc0))/0x7*(-parseInt(_0x3045f8(0xac))/0x8)+parseInt(_0x3045f8(0xdf))/0x9+parseInt(_0x3045f8(0xf3))/0xa;if(_0x17ed12===_0x33f462)break;else _0x2309ed['push'](_0x2309ed['shift']());}catch(_0x5c159f){_0x2309ed['push'](_0x2309ed['shift']());}}}(a50_0xddae,0x52d19));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a50_0x4233e0(0xf1)]=void 0x0;const loggerService_1=require(a50_0x4233e0(0xd3));class RapydService{constructor(){const _0x1b5b3d=a50_0x4233e0;this['apiUrl']=_0x1b5b3d(0xe7),console[_0x1b5b3d(0xc1)](_0x1b5b3d(0xbd));}async[a50_0x4233e0(0xce)](_0x12ca4e){const _0x9c36dd=a50_0x4233e0,{orderId:_0x2c00e0,orderName:_0x49a137,amount:_0x404fbb,currency:_0x51f750,usage:_0x136e5b,maxPayments:_0xf1d71b,successUrl:_0x5ab5df,failUrl:_0x4df854}=_0x12ca4e,_0x1fe247=_0x51f750[_0x9c36dd(0xe2)](),_0xd45f24='GB';console[_0x9c36dd(0xc1)](_0x9c36dd(0xd6));const _0x18194d=_0x9c36dd(0xb4)+_0x2c00e0,_0x23c03b=_0x9c36dd(0x118)+_0x2c00e0,_0x5432bd={'amount':_0x404fbb,'currency':_0x1fe247,'cancel_checkout_url':_0x23c03b,'complete_checkout_url':_0x18194d,'complete_payment_url':_0x18194d,'merchant_reference_id':_0x2c00e0,'description':_0x9c36dd(0x10d)+_0x2c00e0,'country':'GB','payment_method_types_include':[_0x9c36dd(0xf5),_0x9c36dd(0x111)],'custom_elements':{'display_description':!![]}};if(_0x1fe247!==_0x9c36dd(0x106)){const _0x5e2e21=Math['floor'](Date[_0x9c36dd(0x103)]()/0x3e8)+0x1e*0x3c;_0x5432bd[_0x9c36dd(0xc2)]=_0x9c36dd(0xbc),_0x5432bd[_0x9c36dd(0xff)]='EUR',_0x5432bd[_0x9c36dd(0xe4)]=_0x5e2e21,console['log'](_0x9c36dd(0x10e)+_0x1fe247+_0x9c36dd(0xef)),console[_0x9c36dd(0xc1)](_0x9c36dd(0x122)),console['log'](_0x9c36dd(0xc9)),console[_0x9c36dd(0xc1)](_0x9c36dd(0x107)+_0x5e2e21+'\x20('+new Date(_0x5e2e21*0x3e8)[_0x9c36dd(0x110)]()+')');}const _0x41a542=Date[_0x9c36dd(0x103)]();try{console[_0x9c36dd(0xc1)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x9c36dd(0xc1)](_0x9c36dd(0x11c),this['apiUrl']),console['log'](_0x9c36dd(0xcc),JSON[_0x9c36dd(0xae)](_0x5432bd,null,0x2)),console[_0x9c36dd(0xc1)](_0x9c36dd(0xeb)+_0xd45f24+_0x9c36dd(0xfa)),console[_0x9c36dd(0xc1)](_0x9c36dd(0x100)),loggerService_1[_0x9c36dd(0xd0)][_0x9c36dd(0xfd)]('rapyd',_0x9c36dd(0xc4),_0x9c36dd(0x102),_0x5432bd);const _0x4d7bdb=await fetch(this['apiUrl'],{'method':_0x9c36dd(0x102),'headers':{'Content-Type':_0x9c36dd(0xf8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x9c36dd(0xae)](_0x5432bd)}),_0x6f618d=Date[_0x9c36dd(0x103)]()-_0x41a542;console[_0x9c36dd(0xc1)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x9c36dd(0xc1)]('Status:',_0x4d7bdb[_0x9c36dd(0xc7)]),console[_0x9c36dd(0xc1)](_0x9c36dd(0x108),_0x4d7bdb['statusText']),console[_0x9c36dd(0xc1)]('Headers:',Object[_0x9c36dd(0xd8)](_0x4d7bdb[_0x9c36dd(0xaf)]['entries']())),console['log'](_0x9c36dd(0x121),_0x6f618d+'ms');const _0xd4fd4d=await _0x4d7bdb[_0x9c36dd(0x104)]();console['log']('Raw\x20Response\x20Body:',_0xd4fd4d);if(!_0x4d7bdb['ok']){console[_0x9c36dd(0xc5)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x9c36dd(0xc5)](_0x9c36dd(0xad),_0x4d7bdb[_0x9c36dd(0xc7)]),console[_0x9c36dd(0xc5)](_0x9c36dd(0x11e),_0xd4fd4d),loggerService_1[_0x9c36dd(0xd0)][_0x9c36dd(0x113)](_0x9c36dd(0x10b),'/v1/hosted/payment_links',_0x4d7bdb['status'],_0xd4fd4d,_0x6f618d),loggerService_1[_0x9c36dd(0xd0)][_0x9c36dd(0xcb)]('rapyd',_0x9c36dd(0xc4),_0x9c36dd(0x11b)+_0x4d7bdb[_0x9c36dd(0xc7)]+':\x20'+_0xd4fd4d);throw new Error(_0x9c36dd(0xbe)+_0x4d7bdb[_0x9c36dd(0xc7)]+_0x9c36dd(0xfe)+_0xd4fd4d);}let _0x597a7d;try{_0x597a7d=JSON[_0x9c36dd(0xdd)](_0xd4fd4d);}catch(_0x5cbb1a){console[_0x9c36dd(0xc5)](_0x9c36dd(0xb8),_0x5cbb1a),loggerService_1['loggerService']['logWhiteDomainError'](_0x9c36dd(0x10b),_0x9c36dd(0xc4),'JSON\x20Parse\x20Error:\x20'+_0x5cbb1a);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0xd4fd4d);}console[_0x9c36dd(0xc1)](_0x9c36dd(0xc3)),console[_0x9c36dd(0xc1)](_0x9c36dd(0xb7),JSON[_0x9c36dd(0xae)](_0x597a7d,null,0x2)),loggerService_1[_0x9c36dd(0xd0)][_0x9c36dd(0x113)](_0x9c36dd(0x10b),_0x9c36dd(0xc4),_0x4d7bdb[_0x9c36dd(0xc7)],_0x597a7d,_0x6f618d);if(_0x597a7d['status']?.[_0x9c36dd(0xc7)]!=='SUCCESS'){const _0x58cee0=_0x597a7d[_0x9c36dd(0xc7)]?.[_0x9c36dd(0x117)]||_0x9c36dd(0xdb),_0x1e2d82=_0x597a7d[_0x9c36dd(0xc7)]?.[_0x9c36dd(0xc6)]||'UNKNOWN';console[_0x9c36dd(0xc5)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x9c36dd(0xc5)](_0x9c36dd(0x10c),_0x1e2d82),console['error'](_0x9c36dd(0x123),_0x58cee0),console[_0x9c36dd(0xc5)](_0x9c36dd(0xe8),_0x597a7d['status']),loggerService_1[_0x9c36dd(0xd0)][_0x9c36dd(0xcb)](_0x9c36dd(0x10b),_0x9c36dd(0xc4),'Business\x20Error\x20('+_0x1e2d82+_0x9c36dd(0x112)+_0x58cee0);throw new Error('Rapyd\x20API\x20error\x20('+_0x1e2d82+_0x9c36dd(0x112)+_0x58cee0);}if(!_0x597a7d[_0x9c36dd(0xba)]?.['id']||!_0x597a7d[_0x9c36dd(0xba)]?.[_0x9c36dd(0xe5)]){console[_0x9c36dd(0xc5)](_0x9c36dd(0xb3)),console[_0x9c36dd(0xc5)](_0x9c36dd(0xcd)),console[_0x9c36dd(0xc5)](_0x9c36dd(0x124),_0x597a7d['data']),loggerService_1[_0x9c36dd(0xd0)][_0x9c36dd(0xcb)](_0x9c36dd(0x10b),'/v1/hosted/payment_links',_0x9c36dd(0xb0));throw new Error(_0x9c36dd(0xf9));}return console[_0x9c36dd(0xc1)](_0x9c36dd(0x120)),console[_0x9c36dd(0xc1)](_0x9c36dd(0xe3),_0x597a7d[_0x9c36dd(0xba)]['id']),console[_0x9c36dd(0xc1)](_0x9c36dd(0xf0),_0x597a7d[_0x9c36dd(0xba)]['redirect_url']),console[_0x9c36dd(0xc1)]('üá¨üáß\x20Country\x20used:\x20'+_0xd45f24+_0x9c36dd(0xbf)),console[_0x9c36dd(0xc1)](_0x9c36dd(0x100)),{'gateway_payment_id':_0x597a7d['data']['id'],'payment_url':_0x597a7d[_0x9c36dd(0xba)][_0x9c36dd(0xe5)]};}catch(_0xb64308){console[_0x9c36dd(0xc5)](_0x9c36dd(0xb6)),console['error'](_0x9c36dd(0x114),_0xb64308),loggerService_1[_0x9c36dd(0xd0)][_0x9c36dd(0xcb)](_0x9c36dd(0x10b),'/v1/hosted/payment_links',_0xb64308);if(_0xb64308 instanceof Error){console[_0x9c36dd(0xc5)](_0x9c36dd(0xf6),_0xb64308['message']),console[_0x9c36dd(0xc5)]('Error\x20stack:',_0xb64308[_0x9c36dd(0x105)]);throw new Error(_0x9c36dd(0x109)+_0xb64308[_0x9c36dd(0x117)]);}throw new Error(_0x9c36dd(0xec));}}async[a50_0x4233e0(0xe1)](_0x1a847a){const _0x41515a=a50_0x4233e0,_0x5b0af6=Date['now']();try{loggerService_1[_0x41515a(0xd0)][_0x41515a(0xfd)]('rapyd',_0x41515a(0xe6)+_0x1a847a,'GET',{});const _0x34954b=await fetch(this['apiUrl']+'/'+_0x1a847a,{'method':_0x41515a(0xab),'headers':{'Content-Type':_0x41515a(0xf8),'User-Agent':_0x41515a(0xfc)}}),_0x4a01dc=Date[_0x41515a(0x103)]()-_0x5b0af6;if(!_0x34954b['ok']){const _0xa6625a=await _0x34954b[_0x41515a(0x104)]();loggerService_1[_0x41515a(0xd0)][_0x41515a(0x113)](_0x41515a(0x10b),_0x41515a(0xe6)+_0x1a847a,_0x34954b['status'],_0xa6625a,_0x4a01dc);throw new Error(_0x41515a(0xbe)+_0x34954b[_0x41515a(0xc7)]);}const _0x3e8520=await _0x34954b[_0x41515a(0x10f)]();loggerService_1[_0x41515a(0xd0)][_0x41515a(0x113)](_0x41515a(0x10b),_0x41515a(0xe6)+_0x1a847a,_0x34954b['status'],_0x3e8520,_0x4a01dc);if(_0x3e8520[_0x41515a(0xc7)]?.[_0x41515a(0xc7)]!==_0x41515a(0xdc)){loggerService_1['loggerService'][_0x41515a(0xcb)](_0x41515a(0x10b),_0x41515a(0xe6)+_0x1a847a,'Rapyd\x20API\x20error:\x20'+(_0x3e8520['status']?.[_0x41515a(0x117)]||_0x41515a(0xcf)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x3e8520[_0x41515a(0xc7)]?.[_0x41515a(0x117)]||'Unknown\x20error'));}let _0x2a9620=_0x41515a(0x101);if(_0x3e8520[_0x41515a(0xba)]?.['status'])switch(_0x3e8520['data'][_0x41515a(0xc7)][_0x41515a(0xe2)]()){case _0x41515a(0xa9):_0x2a9620='PAID';break;case'CAN':_0x2a9620='FAILED';break;case _0x41515a(0x119):_0x2a9620=_0x41515a(0xd9);break;case'ERR':_0x2a9620=_0x41515a(0xbb);break;case _0x41515a(0x11a):case _0x41515a(0xe0):default:_0x2a9620=_0x41515a(0x101);break;}return{'status':_0x2a9620,'amount':_0x3e8520[_0x41515a(0xba)]?.[_0x41515a(0xc8)],'currency':_0x3e8520['data']?.['currency']};}catch(_0x3699f3){console[_0x41515a(0xc5)](_0x41515a(0xb1),_0x3699f3),loggerService_1['loggerService']['logWhiteDomainError'](_0x41515a(0x10b),_0x41515a(0xe6)+_0x1a847a,_0x3699f3);throw new Error(_0x41515a(0xd2)+(_0x3699f3 instanceof Error?_0x3699f3[_0x41515a(0x117)]:_0x41515a(0xcf)));}}async['processWebhook'](_0x3d1ce3){const _0x3c7d25=a50_0x4233e0;console['log'](_0x3c7d25(0xed),_0x3d1ce3);let _0x8f528c=_0x3c7d25(0x101),_0x54f317;_0x3d1ce3['data']?.[_0x3c7d25(0x115)]&&(_0x54f317=_0x3d1ce3[_0x3c7d25(0xba)][_0x3c7d25(0x115)],console[_0x3c7d25(0xc1)]('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x54f317));switch(_0x3d1ce3[_0x3c7d25(0xf2)]?.['toUpperCase']()){case'PAYMENT_COMPLETED':_0x3d1ce3[_0x3c7d25(0xba)]?.[_0x3c7d25(0xb9)]===!![]&&_0x3d1ce3[_0x3c7d25(0xba)]?.[_0x3c7d25(0xc7)]===_0x3c7d25(0xa9)?_0x8f528c=_0x3c7d25(0x11f):_0x8f528c=_0x3c7d25(0x101);break;case _0x3c7d25(0xd4):_0x8f528c=_0x3c7d25(0xbb);break;case _0x3c7d25(0xca):_0x8f528c=_0x3c7d25(0xd9);break;case'PAYMENT_FAILED':_0x8f528c=_0x3c7d25(0xbb);!_0x54f317&&_0x3d1ce3['data']?.['failure_message']&&(_0x54f317=_0x3d1ce3[_0x3c7d25(0xba)][_0x3c7d25(0x115)]);break;default:switch(_0x3d1ce3[_0x3c7d25(0xba)]?.[_0x3c7d25(0xc7)]?.[_0x3c7d25(0xe2)]()){case'CLO':_0x3d1ce3['data']?.[_0x3c7d25(0xb9)]===!![]?_0x8f528c='PAID':_0x8f528c='FAILED';break;case _0x3c7d25(0xd7):_0x8f528c=_0x3c7d25(0xbb);break;case _0x3c7d25(0x119):_0x8f528c=_0x3c7d25(0xd9);break;case _0x3c7d25(0xf7):_0x8f528c=_0x3c7d25(0xbb);!_0x54f317&&_0x3d1ce3[_0x3c7d25(0xba)]?.[_0x3c7d25(0x115)]&&(_0x54f317=_0x3d1ce3['data'][_0x3c7d25(0x115)]);break;case _0x3c7d25(0x11a):case _0x3c7d25(0xe0):default:_0x8f528c=_0x3c7d25(0x101);break;}break;}const _0x450204={};return _0x3d1ce3[_0x3c7d25(0xba)]?.['payment_method_data']?.[_0x3c7d25(0xa8)]&&(_0x450204['cardLast4']=_0x3d1ce3['data']['payment_method_data'][_0x3c7d25(0xa8)]),_0x3d1ce3['data']?.['payment_method_type']&&(_0x450204[_0x3c7d25(0xaa)]=_0x3d1ce3[_0x3c7d25(0xba)][_0x3c7d25(0xd1)]),_0x3d1ce3['data']?.[_0x3c7d25(0xc6)]&&(_0x450204[_0x3c7d25(0xda)]=_0x3d1ce3[_0x3c7d25(0xba)][_0x3c7d25(0xc6)]),_0x3d1ce3[_0x3c7d25(0xba)]?.[_0x3c7d25(0x10a)]&&(_0x450204[_0x3c7d25(0xe9)]=_0x3d1ce3[_0x3c7d25(0xba)][_0x3c7d25(0x10a)]),console[_0x3c7d25(0xc1)]('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x8f528c+_0x3c7d25(0xfb)+(_0x54f317||_0x3c7d25(0xb5))),{'paymentId':_0x3d1ce3['data']?.[_0x3c7d25(0x116)]||'','status':_0x8f528c,'amount':_0x3d1ce3[_0x3c7d25(0xba)]?.[_0x3c7d25(0xc8)],'currency':_0x3d1ce3[_0x3c7d25(0xba)]?.[_0x3c7d25(0xf4)],'failureMessage':_0x54f317,'additionalInfo':_0x450204};}}exports[a50_0x4233e0(0xf1)]=RapydService;