'use strict';const a75_0x5c3816=a75_0x5ca3;(function(_0x59ce42,_0x518591){const _0x3088ed=a75_0x5ca3,_0xc4b478=_0x59ce42();while(!![]){try{const _0x193b8a=parseInt(_0x3088ed(0xce))/0x1+parseInt(_0x3088ed(0xf3))/0x2+parseInt(_0x3088ed(0x92))/0x3+-parseInt(_0x3088ed(0xaa))/0x4+-parseInt(_0x3088ed(0x88))/0x5+parseInt(_0x3088ed(0x86))/0x6+-parseInt(_0x3088ed(0x89))/0x7;if(_0x193b8a===_0x518591)break;else _0xc4b478['push'](_0xc4b478['shift']());}catch(_0x11835e){_0xc4b478['push'](_0xc4b478['shift']());}}}(a75_0x3753,0xcbc65));function a75_0x3753(){const _0x5c3585=['6881765mQPavL','2983064YPpvEO','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','processWebhook','Error\x20stack:','apiUrl','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','cardholder_name','logWhiteDomainRequest','../loggerService','777594fdiUSa','toUpperCase','Error\x20Message:','../binLookupService','NEW','statusText','cardCountry','SUCCESS','createPaymentLink','bin_details','cardBrand','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','amount','Raw\x20Response\x20Body:','RapydService','üí≥\x20Adding\x20cardholder\x20name:\x20','paymentMethod','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','\x20(always\x20GB\x20for\x20Rapyd)','JSON\x20Parse\x20Error:\x20','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','failureCode','text','CLO','3656020EcdRnL','Rapyd\x20payment\x20verification\x20error:','üîç\x20Rapyd\x20BIN\x20detected:\x20','email','PAYMENT_EXPIRED','fromEntries','Payment\x20System/1.0','gb_visa_card','Response\x20Time:','headers','currency','data','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','cardIssuer','ORDER:\x20','üìä\x20Rapyd\x20BIN\x20lookup\x20result:','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','paid','cardBin','loggerService','verifyPayment','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','https://tesoft.uk/gateway/rapyd/','EXP','/v1/hosted/payment_links/','HTTP\x20error!\x20status:\x20','\x20\x20\x20fixed_side:\x20buy','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','requested_currency','json','cardBinStatus','Request\x20Body\x20(Updated\x20Format):','üí•\x20Rapyd\x20failure\x20message:\x20','URL:','POST','error','362867UFPAvj','payment_method_data','parse','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','gb_mastercard_card','Status:','now','\x20->\x20EUR:','floor','message','status','rapyd','TESOFT\x20','HTTP\x20Status:',',\x20failureMessage=','buy','Missing\x20id\x20or\x20redirect_url\x20in\x20response','/v1/hosted/payment_links','Redirect\x20URL:','https://tesoft.uk/gateway/success.php?id=','redirect_url','Rapyd\x20API\x20error:\x20','brand','error_code','PAYMENT_FAILED','none','EUR','cardCategory','log','payment_method_type','Error\x20Code:','expiration','Rapyd\x20API\x20error\x20(','logWhiteDomainError','bin_number','GET','Error\x20message:','3141384jTngfi','):\x20',',\x20body:\x20','stringify','PAID','ERR','FAILED','üá¨üáß\x20Country:\x20','PAYMENT_CANCELED','EXPIRED','binLookupService','===\x20RAPYD\x20API\x20ERROR\x20===','Response\x20data:','last4','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','merchant_reference_id','PENDING','custom_elements','address','split','Parsed\x20Result:','cardType','Unknown\x20error','type','CAN','application/json','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','logWhiteDomainResponse','\x20\x20\x20requested_currency:\x20EUR','Payment\x20Link\x20ID:','8150484jgPhMH','failure_message'];a75_0x3753=function(){return _0x5c3585;};return a75_0x3753();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a75_0x5c3816(0xa0)]=void 0x0;function a75_0x5ca3(_0x514f18,_0x49fa54){_0x514f18=_0x514f18-0x86;const _0x37530d=a75_0x3753();let _0x5ca369=_0x37530d[_0x514f18];return _0x5ca369;}const loggerService_1=require(a75_0x5c3816(0x91)),binLookupService_1=require(a75_0x5c3816(0x95));class RapydService{constructor(){const _0x2d5655=a75_0x5c3816;this[_0x2d5655(0x8d)]=_0x2d5655(0xc0),console[_0x2d5655(0xea)](_0x2d5655(0xd1));}async[a75_0x5c3816(0x9a)](_0x372349){const _0x24b9c4=a75_0x5c3816,{orderId:_0x4d81e3,orderName:_0x1eb27d,amount:_0x15b47f,currency:_0x1ea455,usage:_0x58d0cf,maxPayments:_0x4e1845,successUrl:_0x92e429,failUrl:_0x494c9c,customerName:_0x417e15,customerEmail:_0x54888b}=_0x372349,_0x17adfa=_0x1ea455[_0x24b9c4(0x93)](),_0x47fc19='GB';console['log']('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x53f7bc=_0x24b9c4(0xe1)+_0x4d81e3,_0x452a0c='https://tesoft.uk/gateway/fail.php?id='+_0x4d81e3,_0x288d72={'amount':_0x15b47f,'currency':_0x17adfa,'payment_method_options':{'3d_required':![]},'cancel_checkout_url':_0x452a0c,'complete_checkout_url':_0x53f7bc,'complete_payment_url':_0x53f7bc,'merchant_reference_id':_0x4d81e3,'description':_0x24b9c4(0xb8)+_0x4d81e3,'statement_descriptor':_0x24b9c4(0xda)+(_0x4d81e3[_0x24b9c4(0x106)]('-')[0x1]||_0x4d81e3),'country':'GB','payment_method_types_include':[_0x24b9c4(0xb1),_0x24b9c4(0xd2)],'custom_elements':{'display_description':!![],'billing_address_collect':!![],'required_customer_fields':['name',_0x24b9c4(0xad),'phone_number',_0x24b9c4(0x105)]}};_0x417e15&&(_0x288d72[_0x24b9c4(0x104)][_0x24b9c4(0x8f)]=_0x417e15,console[_0x24b9c4(0xea)](_0x24b9c4(0xa1)+_0x417e15));if(_0x17adfa!==_0x24b9c4(0xe8)){const _0x476a9f=Math[_0x24b9c4(0xd6)](Date['now']()/0x3e8)+0x1e*0x3c;_0x288d72['fixed_side']=_0x24b9c4(0xdd),_0x288d72[_0x24b9c4(0xc6)]=_0x24b9c4(0xe8),_0x288d72[_0x24b9c4(0xed)]=_0x476a9f,console[_0x24b9c4(0xea)](_0x24b9c4(0xba)+_0x17adfa+_0x24b9c4(0xd5)),console[_0x24b9c4(0xea)](_0x24b9c4(0xc4)),console[_0x24b9c4(0xea)](_0x24b9c4(0x10f)),console[_0x24b9c4(0xea)]('\x20\x20\x20expiration:\x20'+_0x476a9f+'\x20('+new Date(_0x476a9f*0x3e8)['toISOString']()+')');}const _0x11ffec=Date['now']();try{console[_0x24b9c4(0xea)](_0x24b9c4(0xa3)),console[_0x24b9c4(0xea)](_0x24b9c4(0xcb),this[_0x24b9c4(0x8d)]),console[_0x24b9c4(0xea)](_0x24b9c4(0xc9),JSON[_0x24b9c4(0xf6)](_0x288d72,null,0x2)),console[_0x24b9c4(0xea)](_0x24b9c4(0xfa)+_0x47fc19+_0x24b9c4(0xa4)),console[_0x24b9c4(0xea)](_0x24b9c4(0x8e)),loggerService_1['loggerService'][_0x24b9c4(0x90)](_0x24b9c4(0xd9),_0x24b9c4(0xdf),_0x24b9c4(0xcc),_0x288d72);const _0x216c9f=await fetch(this[_0x24b9c4(0x8d)],{'method':'POST','headers':{'Content-Type':_0x24b9c4(0x10c),'User-Agent':_0x24b9c4(0xb0)},'body':JSON[_0x24b9c4(0xf6)](_0x288d72)}),_0x572465=Date[_0x24b9c4(0xd4)]()-_0x11ffec;console['log'](_0x24b9c4(0xbf)),console['log'](_0x24b9c4(0xd3),_0x216c9f[_0x24b9c4(0xd8)]),console[_0x24b9c4(0xea)]('Status\x20Text:',_0x216c9f[_0x24b9c4(0x97)]),console[_0x24b9c4(0xea)]('Headers:',Object[_0x24b9c4(0xaf)](_0x216c9f[_0x24b9c4(0xb3)]['entries']())),console[_0x24b9c4(0xea)](_0x24b9c4(0xb2),_0x572465+'ms');const _0x1f3f56=await _0x216c9f[_0x24b9c4(0xa8)]();console['log'](_0x24b9c4(0x9f),_0x1f3f56);if(!_0x216c9f['ok']){console[_0x24b9c4(0xcd)](_0x24b9c4(0xfe)),console[_0x24b9c4(0xcd)](_0x24b9c4(0xdb),_0x216c9f[_0x24b9c4(0xd8)]),console[_0x24b9c4(0xcd)]('Response\x20Body:',_0x1f3f56),loggerService_1[_0x24b9c4(0xbd)][_0x24b9c4(0x10e)]('rapyd',_0x24b9c4(0xdf),_0x216c9f[_0x24b9c4(0xd8)],_0x1f3f56,_0x572465),loggerService_1[_0x24b9c4(0xbd)]['logWhiteDomainError'](_0x24b9c4(0xd9),'/v1/hosted/payment_links','HTTP\x20'+_0x216c9f['status']+':\x20'+_0x1f3f56);throw new Error(_0x24b9c4(0xc3)+_0x216c9f[_0x24b9c4(0xd8)]+_0x24b9c4(0xf5)+_0x1f3f56);}let _0x17bb87;try{_0x17bb87=JSON[_0x24b9c4(0xd0)](_0x1f3f56);}catch(_0x3d04a6){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x3d04a6),loggerService_1[_0x24b9c4(0xbd)][_0x24b9c4(0xef)]('rapyd','/v1/hosted/payment_links',_0x24b9c4(0xa5)+_0x3d04a6);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x1f3f56);}console['log'](_0x24b9c4(0xb6)),console[_0x24b9c4(0xea)](_0x24b9c4(0x107),JSON['stringify'](_0x17bb87,null,0x2)),loggerService_1[_0x24b9c4(0xbd)][_0x24b9c4(0x10e)](_0x24b9c4(0xd9),_0x24b9c4(0xdf),_0x216c9f[_0x24b9c4(0xd8)],_0x17bb87,_0x572465);if(_0x17bb87[_0x24b9c4(0xd8)]?.[_0x24b9c4(0xd8)]!==_0x24b9c4(0x99)){const _0x52f877=_0x17bb87[_0x24b9c4(0xd8)]?.[_0x24b9c4(0xd7)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x1e1f1e=_0x17bb87['status']?.[_0x24b9c4(0xe5)]||'UNKNOWN';console[_0x24b9c4(0xcd)](_0x24b9c4(0xa6)),console[_0x24b9c4(0xcd)](_0x24b9c4(0xec),_0x1e1f1e),console[_0x24b9c4(0xcd)](_0x24b9c4(0x94),_0x52f877),console[_0x24b9c4(0xcd)]('Full\x20Error\x20Data:',_0x17bb87[_0x24b9c4(0xd8)]),loggerService_1[_0x24b9c4(0xbd)][_0x24b9c4(0xef)](_0x24b9c4(0xd9),'/v1/hosted/payment_links','Business\x20Error\x20('+_0x1e1f1e+_0x24b9c4(0xf4)+_0x52f877);throw new Error(_0x24b9c4(0xee)+_0x1e1f1e+'):\x20'+_0x52f877);}if(!_0x17bb87['data']?.['id']||!_0x17bb87[_0x24b9c4(0xb5)]?.[_0x24b9c4(0xe2)]){console[_0x24b9c4(0xcd)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x24b9c4(0xcd)](_0x24b9c4(0xde)),console[_0x24b9c4(0xcd)](_0x24b9c4(0xff),_0x17bb87[_0x24b9c4(0xb5)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x24b9c4(0xd9),_0x24b9c4(0xdf),_0x24b9c4(0x9d));throw new Error(_0x24b9c4(0x101));}return console[_0x24b9c4(0xea)]('===\x20RAPYD\x20SUCCESS\x20==='),console['log'](_0x24b9c4(0x110),_0x17bb87[_0x24b9c4(0xb5)]['id']),console[_0x24b9c4(0xea)](_0x24b9c4(0xe0),_0x17bb87[_0x24b9c4(0xb5)][_0x24b9c4(0xe2)]),console[_0x24b9c4(0xea)]('üá¨üáß\x20Country\x20used:\x20'+_0x47fc19+'\x20(GB\x20-\x20Britain)'),console[_0x24b9c4(0xea)](_0x24b9c4(0x8e)),{'gateway_payment_id':_0x17bb87[_0x24b9c4(0xb5)]['id'],'payment_url':_0x17bb87[_0x24b9c4(0xb5)][_0x24b9c4(0xe2)]};}catch(_0x2617f0){console[_0x24b9c4(0xcd)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x24b9c4(0xcd)]('Error\x20details:',_0x2617f0),loggerService_1[_0x24b9c4(0xbd)][_0x24b9c4(0xef)](_0x24b9c4(0xd9),_0x24b9c4(0xdf),_0x2617f0);if(_0x2617f0 instanceof Error){console[_0x24b9c4(0xcd)](_0x24b9c4(0xf2),_0x2617f0[_0x24b9c4(0xd7)]),console['error'](_0x24b9c4(0x8c),_0x2617f0['stack']);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x2617f0['message']);}throw new Error(_0x24b9c4(0x8a));}}async[a75_0x5c3816(0xbe)](_0x31405d){const _0x10cab6=a75_0x5c3816,_0x24cadb=Date[_0x10cab6(0xd4)]();try{loggerService_1['loggerService'][_0x10cab6(0x90)](_0x10cab6(0xd9),_0x10cab6(0xc2)+_0x31405d,_0x10cab6(0xf1),{});const _0x5c563a=await fetch(this['apiUrl']+'/'+_0x31405d,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x17eac0=Date[_0x10cab6(0xd4)]()-_0x24cadb;if(!_0x5c563a['ok']){const _0x1e1413=await _0x5c563a['text']();loggerService_1['loggerService'][_0x10cab6(0x10e)]('rapyd',_0x10cab6(0xc2)+_0x31405d,_0x5c563a[_0x10cab6(0xd8)],_0x1e1413,_0x17eac0);throw new Error(_0x10cab6(0xc3)+_0x5c563a[_0x10cab6(0xd8)]);}const _0x592b49=await _0x5c563a[_0x10cab6(0xc7)]();loggerService_1[_0x10cab6(0xbd)][_0x10cab6(0x10e)](_0x10cab6(0xd9),_0x10cab6(0xc2)+_0x31405d,_0x5c563a[_0x10cab6(0xd8)],_0x592b49,_0x17eac0);if(_0x592b49[_0x10cab6(0xd8)]?.['status']!=='SUCCESS'){loggerService_1[_0x10cab6(0xbd)][_0x10cab6(0xef)](_0x10cab6(0xd9),_0x10cab6(0xc2)+_0x31405d,_0x10cab6(0xe3)+(_0x592b49[_0x10cab6(0xd8)]?.['message']||_0x10cab6(0x109)));throw new Error(_0x10cab6(0xe3)+(_0x592b49['status']?.['message']||_0x10cab6(0x109)));}let _0x55a4b0=_0x10cab6(0x103);if(_0x592b49['data']?.[_0x10cab6(0xd8)])switch(_0x592b49[_0x10cab6(0xb5)][_0x10cab6(0xd8)][_0x10cab6(0x93)]()){case'CLO':_0x55a4b0=_0x10cab6(0xf7);break;case _0x10cab6(0x10b):_0x55a4b0=_0x10cab6(0xf9);break;case _0x10cab6(0xc1):_0x55a4b0=_0x10cab6(0xfc);break;case _0x10cab6(0xf8):_0x55a4b0=_0x10cab6(0xf9);break;case _0x10cab6(0x96):case'ACT':default:_0x55a4b0=_0x10cab6(0x103);break;}return{'status':_0x55a4b0,'amount':_0x592b49['data']?.[_0x10cab6(0x9e)],'currency':_0x592b49[_0x10cab6(0xb5)]?.[_0x10cab6(0xb4)]};}catch(_0x6b6c33){console[_0x10cab6(0xcd)](_0x10cab6(0xab),_0x6b6c33),loggerService_1['loggerService'][_0x10cab6(0xef)]('rapyd','/v1/hosted/payment_links/'+_0x31405d,_0x6b6c33);throw new Error(_0x10cab6(0xc5)+(_0x6b6c33 instanceof Error?_0x6b6c33[_0x10cab6(0xd7)]:_0x10cab6(0x109)));}}async[a75_0x5c3816(0x8b)](_0x3433f6){const _0x2865cc=a75_0x5c3816;console['log']('Processing\x20Rapyd\x20webhook:',_0x3433f6);let _0x2300fc=_0x2865cc(0x103),_0x588241;_0x3433f6['data']?.[_0x2865cc(0x87)]&&(_0x588241=_0x3433f6[_0x2865cc(0xb5)]['failure_message'],console[_0x2865cc(0xea)](_0x2865cc(0xca)+_0x588241));switch(_0x3433f6[_0x2865cc(0x10a)]?.['toUpperCase']()){case'PAYMENT_COMPLETED':_0x3433f6[_0x2865cc(0xb5)]?.[_0x2865cc(0xbb)]===!![]&&_0x3433f6[_0x2865cc(0xb5)]?.[_0x2865cc(0xd8)]===_0x2865cc(0xa9)?_0x2300fc=_0x2865cc(0xf7):_0x2300fc=_0x2865cc(0x103);break;case _0x2865cc(0xfb):_0x2300fc=_0x2865cc(0xf9);break;case _0x2865cc(0xae):_0x2300fc=_0x2865cc(0xfc);break;case _0x2865cc(0xe6):_0x2300fc=_0x2865cc(0xf9);!_0x588241&&_0x3433f6['data']?.[_0x2865cc(0x87)]&&(_0x588241=_0x3433f6['data'][_0x2865cc(0x87)]);break;default:switch(_0x3433f6[_0x2865cc(0xb5)]?.[_0x2865cc(0xd8)]?.['toUpperCase']()){case _0x2865cc(0xa9):_0x3433f6[_0x2865cc(0xb5)]?.['paid']===!![]?_0x2300fc='PAID':_0x2300fc=_0x2865cc(0xf9);break;case'CAN':_0x2300fc='FAILED';break;case _0x2865cc(0xc1):_0x2300fc='EXPIRED';break;case _0x2865cc(0xf8):_0x2300fc=_0x2865cc(0xf9);!_0x588241&&_0x3433f6[_0x2865cc(0xb5)]?.[_0x2865cc(0x87)]&&(_0x588241=_0x3433f6[_0x2865cc(0xb5)][_0x2865cc(0x87)]);break;case'NEW':case'ACT':default:_0x2300fc='PENDING';break;}break;}const _0x4c8c03={};_0x3433f6[_0x2865cc(0xb5)]?.[_0x2865cc(0xcf)]?.[_0x2865cc(0x100)]&&(_0x4c8c03['cardLast4']=_0x3433f6[_0x2865cc(0xb5)][_0x2865cc(0xcf)][_0x2865cc(0x100)]);_0x3433f6[_0x2865cc(0xb5)]?.['payment_method_data']?.[_0x2865cc(0x9b)]?.[_0x2865cc(0xe4)]&&(_0x4c8c03[_0x2865cc(0x9c)]=_0x3433f6[_0x2865cc(0xb5)][_0x2865cc(0xcf)]['bin_details'][_0x2865cc(0xe4)],console[_0x2865cc(0xea)]('üí≥\x20Card\x20brand\x20from\x20bin_details:\x20'+_0x4c8c03[_0x2865cc(0x9c)]));_0x3433f6[_0x2865cc(0xb5)]?.['payment_method_type']&&(_0x4c8c03[_0x2865cc(0xa2)]=_0x3433f6[_0x2865cc(0xb5)][_0x2865cc(0xeb)]);_0x3433f6[_0x2865cc(0xb5)]?.['error_code']&&(_0x4c8c03['errorCode']=_0x3433f6[_0x2865cc(0xb5)]['error_code']);_0x3433f6[_0x2865cc(0xb5)]?.['failure_code']&&(_0x4c8c03[_0x2865cc(0xa7)]=_0x3433f6[_0x2865cc(0xb5)]['failure_code']);if(_0x3433f6[_0x2865cc(0xb5)]?.['payment_method_data']?.[_0x2865cc(0x9b)]?.[_0x2865cc(0xf0)]){const _0x3205ff=_0x3433f6[_0x2865cc(0xb5)][_0x2865cc(0xcf)]['bin_details'][_0x2865cc(0xf0)];console['log'](_0x2865cc(0xac)+_0x3205ff);try{const _0x3645db=await binLookupService_1[_0x2865cc(0xfd)]['lookupBin'](_0x3205ff);console[_0x2865cc(0xea)](_0x2865cc(0xb9),_0x3645db),_0x4c8c03[_0x2865cc(0xbc)]=_0x3205ff,_0x4c8c03[_0x2865cc(0xc8)]=_0x3645db[_0x2865cc(0xc8)],_0x4c8c03[_0x2865cc(0x108)]=_0x3645db[_0x2865cc(0x108)],_0x4c8c03[_0x2865cc(0xe9)]=_0x3645db[_0x2865cc(0xe9)],_0x4c8c03['cardCountry']=_0x3645db[_0x2865cc(0x98)],_0x4c8c03[_0x2865cc(0xb7)]=_0x3645db[_0x2865cc(0xb7)];}catch(_0x459bf2){console['error']('‚ùå\x20Error\x20looking\x20up\x20Rapyd\x20BIN:',_0x459bf2),_0x4c8c03[_0x2865cc(0xbc)]=_0x3205ff;}}return console[_0x2865cc(0xea)](_0x2865cc(0x10d)+_0x2300fc+_0x2865cc(0xdc)+(_0x588241||_0x2865cc(0xe7))),{'paymentId':_0x3433f6[_0x2865cc(0xb5)]?.[_0x2865cc(0x102)]||'','status':_0x2300fc,'amount':_0x3433f6['data']?.[_0x2865cc(0x9e)],'currency':_0x3433f6[_0x2865cc(0xb5)]?.[_0x2865cc(0xb4)],'failureMessage':_0x588241,'additionalInfo':_0x4c8c03};}}exports[a75_0x5c3816(0xa0)]=RapydService;