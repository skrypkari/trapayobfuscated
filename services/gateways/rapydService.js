'use strict';const a42_0x3586bb=a42_0x1046;function a42_0x37fb(){const _0x176ed1=['Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','application/json','createPaymentLink','message','Full\x20Error\x20Data:','logWhiteDomainRequest','Request\x20Body\x20(Updated\x20Format):','RapydService','defineProperty','https://tesoft.uk/gateway/success.php?id=','Rapyd\x20API\x20error\x20(','gb_visa_card','92396RAlDgn','payment_method_data','logWhiteDomainError','verifyPayment','toUpperCase','error','Rapyd\x20payment\x20verification\x20error:','Response\x20data:','6aLFRYS','__esModule','json','type','Rapyd\x20API\x20error:\x20','status','data','Error\x20message:','last4','24bWIUpS','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','../loggerService','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','HTTP\x20Status:','52451168xpECBw','cardLast4','payment_method_type','rapyd','parse','):\x20','redirect_url','Redirect\x20URL:','text','\x20(always\x20GB\x20for\x20Rapyd)','log','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error\x20from\x20Rapyd\x20API','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','POST','EXPIRED','/v1/hosted/payment_links/','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','963460qhjRRr','HTTP\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Error\x20Message:','now','PENDING','PAYMENT_EXPIRED','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','failure_message','5753377bhZzUR','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','ORDER:\x20','\x20(GB\x20-\x20Britain)','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','ERR','SUCCESS','amount','TesSoft\x20Payment\x20System/1.0','PAYMENT_CANCELED','stack','URL:','UNKNOWN','headers','285980rVmQfz','FAILED','failureCode','gb_mastercard_card','failure_code','===\x20RAPYD\x20SUCCESS\x20===','Payment\x20Link\x20ID:','/v1/hosted/payment_links','Error\x20details:','PAYMENT_FAILED','CAN','loggerService','https://tesoft.uk/gateway/fail.php?id=','28XcmDck','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','entries','Headers:','8909944mnPGUS','currency','HTTP\x20error!\x20status:\x20','Status:','132720YujMQU','Parsed\x20Result:','81daFuQQ','apiUrl','Response\x20Body:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','https://tesoft.uk/gateway/rapyd/','Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainResponse','ACT','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Missing\x20id\x20or\x20redirect_url\x20in\x20response','merchant_reference_id','Error\x20stack:','errorCode','EXP','paymentMethod','üá¨üáß\x20Country:\x20','PAYMENT_COMPLETED','PAID','GET','Status\x20Text:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','stringify','Business\x20Error\x20(','Raw\x20Response\x20Body:','error_code','CLO','paid','NEW'];a42_0x37fb=function(){return _0x176ed1;};return a42_0x37fb();}(function(_0x3a6d5e,_0x490757){const _0x263c19=a42_0x1046,_0x9dba9=_0x3a6d5e();while(!![]){try{const _0x1483d6=-parseInt(_0x263c19(0x227))/0x1+-parseInt(_0x263c19(0x1e7))/0x2*(parseInt(_0x263c19(0x1f8))/0x3)+parseInt(_0x263c19(0x234))/0x4*(-parseInt(_0x263c19(0x20f))/0x5)+parseInt(_0x263c19(0x1ef))/0x6*(-parseInt(_0x263c19(0x219))/0x7)+-parseInt(_0x263c19(0x238))/0x8+parseInt(_0x263c19(0x1be))/0x9*(-parseInt(_0x263c19(0x1bc))/0xa)+parseInt(_0x263c19(0x1fd))/0xb;if(_0x1483d6===_0x490757)break;else _0x9dba9['push'](_0x9dba9['shift']());}catch(_0x1299e5){_0x9dba9['push'](_0x9dba9['shift']());}}}(a42_0x37fb,0xad0aa));Object[a42_0x3586bb(0x1e3)](exports,a42_0x3586bb(0x1f0),{'value':!![]}),exports[a42_0x3586bb(0x1e2)]=void 0x0;const loggerService_1=require(a42_0x3586bb(0x1fa));class RapydService{constructor(){const _0x530878=a42_0x3586bb;this[_0x530878(0x1bf)]=_0x530878(0x1c2),console[_0x530878(0x207)](_0x530878(0x208));}async[a42_0x3586bb(0x1dd)](_0x3cc5ac){const _0x3ad14b=a42_0x3586bb,{orderId:_0x12bc22,orderName:_0x185783,amount:_0x2e4922,currency:_0x242d42,usage:_0x4a4e13,maxPayments:_0x2093ff,successUrl:_0x26055b,failUrl:_0x3699be}=_0x3cc5ac,_0xaad069=_0x242d42[_0x3ad14b(0x1eb)](),_0x113c17='GB';console['log'](_0x3ad14b(0x20a));const _0x3378c7=_0x3ad14b(0x1e4)+_0x12bc22,_0x5c5eb6=_0x3ad14b(0x233)+_0x12bc22,_0x56eefc={'amount':_0x2e4922,'currency':_0xaad069,'cancel_checkout_url':_0x5c5eb6,'complete_checkout_url':_0x3378c7,'complete_payment_url':_0x3378c7,'merchant_reference_id':_0x12bc22,'description':_0x3ad14b(0x21b)+_0x12bc22,'country':'GB','payment_method_types_include':[_0x3ad14b(0x1e6),_0x3ad14b(0x22a)],'custom_elements':{'display_description':!![]}},_0x3bfa70=Date[_0x3ad14b(0x213)]();try{console['log'](_0x3ad14b(0x20e)),console[_0x3ad14b(0x207)](_0x3ad14b(0x224),this[_0x3ad14b(0x1bf)]),console['log'](_0x3ad14b(0x1e1),JSON['stringify'](_0x56eefc,null,0x2)),console[_0x3ad14b(0x207)](_0x3ad14b(0x1ce)+_0x113c17+_0x3ad14b(0x206)),console[_0x3ad14b(0x207)](_0x3ad14b(0x1c7)),loggerService_1[_0x3ad14b(0x232)][_0x3ad14b(0x1e0)]('rapyd',_0x3ad14b(0x22e),'POST',_0x56eefc);const _0x573147=await fetch(this[_0x3ad14b(0x1bf)],{'method':_0x3ad14b(0x20b),'headers':{'Content-Type':_0x3ad14b(0x1dc),'User-Agent':_0x3ad14b(0x221)},'body':JSON[_0x3ad14b(0x1d4)](_0x56eefc)}),_0x6d7b47=Date[_0x3ad14b(0x213)]()-_0x3bfa70;console['log'](_0x3ad14b(0x1c1)),console['log'](_0x3ad14b(0x23b),_0x573147['status']),console[_0x3ad14b(0x207)](_0x3ad14b(0x1d2),_0x573147['statusText']),console[_0x3ad14b(0x207)](_0x3ad14b(0x237),Object[_0x3ad14b(0x217)](_0x573147[_0x3ad14b(0x226)][_0x3ad14b(0x236)]())),console[_0x3ad14b(0x207)]('Response\x20Time:',_0x6d7b47+'ms');const _0x2b331a=await _0x573147[_0x3ad14b(0x205)]();console[_0x3ad14b(0x207)](_0x3ad14b(0x1d6),_0x2b331a);if(!_0x573147['ok']){console[_0x3ad14b(0x1ec)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console['error'](_0x3ad14b(0x1fc),_0x573147[_0x3ad14b(0x1f4)]),console['error'](_0x3ad14b(0x1c0),_0x2b331a),loggerService_1[_0x3ad14b(0x232)][_0x3ad14b(0x1c5)]('rapyd',_0x3ad14b(0x22e),_0x573147[_0x3ad14b(0x1f4)],_0x2b331a,_0x6d7b47),loggerService_1[_0x3ad14b(0x232)][_0x3ad14b(0x1e9)]('rapyd',_0x3ad14b(0x22e),_0x3ad14b(0x210)+_0x573147[_0x3ad14b(0x1f4)]+':\x20'+_0x2b331a);throw new Error(_0x3ad14b(0x23a)+_0x573147[_0x3ad14b(0x1f4)]+',\x20body:\x20'+_0x2b331a);}let _0x109e5f;try{_0x109e5f=JSON[_0x3ad14b(0x201)](_0x2b331a);}catch(_0x10efb8){console[_0x3ad14b(0x1ec)](_0x3ad14b(0x1c4),_0x10efb8),loggerService_1['loggerService'][_0x3ad14b(0x1e9)](_0x3ad14b(0x200),_0x3ad14b(0x22e),'JSON\x20Parse\x20Error:\x20'+_0x10efb8);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x2b331a);}console[_0x3ad14b(0x207)](_0x3ad14b(0x21a)),console[_0x3ad14b(0x207)](_0x3ad14b(0x1bd),JSON[_0x3ad14b(0x1d4)](_0x109e5f,null,0x2)),loggerService_1[_0x3ad14b(0x232)][_0x3ad14b(0x1c5)]('rapyd',_0x3ad14b(0x22e),_0x573147['status'],_0x109e5f,_0x6d7b47);if(_0x109e5f[_0x3ad14b(0x1f4)]?.['status']!==_0x3ad14b(0x21f)){const _0x52a501=_0x109e5f['status']?.[_0x3ad14b(0x1de)]||_0x3ad14b(0x209),_0x296c1c=_0x109e5f['status']?.[_0x3ad14b(0x1d7)]||_0x3ad14b(0x225);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3ad14b(0x1ec)]('Error\x20Code:',_0x296c1c),console[_0x3ad14b(0x1ec)](_0x3ad14b(0x212),_0x52a501),console[_0x3ad14b(0x1ec)](_0x3ad14b(0x1df),_0x109e5f[_0x3ad14b(0x1f4)]),loggerService_1[_0x3ad14b(0x232)][_0x3ad14b(0x1e9)](_0x3ad14b(0x200),_0x3ad14b(0x22e),_0x3ad14b(0x1d5)+_0x296c1c+_0x3ad14b(0x202)+_0x52a501);throw new Error(_0x3ad14b(0x1e5)+_0x296c1c+_0x3ad14b(0x202)+_0x52a501);}if(!_0x109e5f[_0x3ad14b(0x1f5)]?.['id']||!_0x109e5f['data']?.[_0x3ad14b(0x203)]){console['error'](_0x3ad14b(0x216)),console[_0x3ad14b(0x1ec)](_0x3ad14b(0x1c8)),console[_0x3ad14b(0x1ec)](_0x3ad14b(0x1ee),_0x109e5f[_0x3ad14b(0x1f5)]),loggerService_1[_0x3ad14b(0x232)][_0x3ad14b(0x1e9)](_0x3ad14b(0x200),_0x3ad14b(0x22e),_0x3ad14b(0x1db));throw new Error(_0x3ad14b(0x1d3));}return console[_0x3ad14b(0x207)](_0x3ad14b(0x22c)),console[_0x3ad14b(0x207)](_0x3ad14b(0x22d),_0x109e5f[_0x3ad14b(0x1f5)]['id']),console[_0x3ad14b(0x207)](_0x3ad14b(0x204),_0x109e5f[_0x3ad14b(0x1f5)][_0x3ad14b(0x203)]),console[_0x3ad14b(0x207)]('üá¨üáß\x20Country\x20used:\x20'+_0x113c17+_0x3ad14b(0x21c)),console[_0x3ad14b(0x207)](_0x3ad14b(0x1c7)),{'gateway_payment_id':_0x109e5f[_0x3ad14b(0x1f5)]['id'],'payment_url':_0x109e5f[_0x3ad14b(0x1f5)][_0x3ad14b(0x203)]};}catch(_0x127aec){console[_0x3ad14b(0x1ec)](_0x3ad14b(0x21d)),console[_0x3ad14b(0x1ec)](_0x3ad14b(0x22f),_0x127aec),loggerService_1[_0x3ad14b(0x232)][_0x3ad14b(0x1e9)]('rapyd',_0x3ad14b(0x22e),_0x127aec);if(_0x127aec instanceof Error){console[_0x3ad14b(0x1ec)](_0x3ad14b(0x1f6),_0x127aec[_0x3ad14b(0x1de)]),console['error'](_0x3ad14b(0x1ca),_0x127aec[_0x3ad14b(0x223)]);throw new Error(_0x3ad14b(0x211)+_0x127aec[_0x3ad14b(0x1de)]);}throw new Error(_0x3ad14b(0x1f9));}}async[a42_0x3586bb(0x1ea)](_0xb1bfc9){const _0x583611=a42_0x3586bb,_0x468d71=Date[_0x583611(0x213)]();try{loggerService_1[_0x583611(0x232)][_0x583611(0x1e0)]('rapyd',_0x583611(0x20d)+_0xb1bfc9,_0x583611(0x1d1),{});const _0x2ed72a=await fetch(this['apiUrl']+'/'+_0xb1bfc9,{'method':_0x583611(0x1d1),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2e7071=Date[_0x583611(0x213)]()-_0x468d71;if(!_0x2ed72a['ok']){const _0x4db5f0=await _0x2ed72a[_0x583611(0x205)]();loggerService_1['loggerService'][_0x583611(0x1c5)](_0x583611(0x200),'/v1/hosted/payment_links/'+_0xb1bfc9,_0x2ed72a[_0x583611(0x1f4)],_0x4db5f0,_0x2e7071);throw new Error(_0x583611(0x23a)+_0x2ed72a['status']);}const _0x3bdf3e=await _0x2ed72a[_0x583611(0x1f1)]();loggerService_1['loggerService'][_0x583611(0x1c5)](_0x583611(0x200),_0x583611(0x20d)+_0xb1bfc9,_0x2ed72a['status'],_0x3bdf3e,_0x2e7071);if(_0x3bdf3e[_0x583611(0x1f4)]?.['status']!==_0x583611(0x21f)){loggerService_1[_0x583611(0x232)][_0x583611(0x1e9)](_0x583611(0x200),_0x583611(0x20d)+_0xb1bfc9,_0x583611(0x1f3)+(_0x3bdf3e['status']?.[_0x583611(0x1de)]||_0x583611(0x1c3)));throw new Error(_0x583611(0x1f3)+(_0x3bdf3e[_0x583611(0x1f4)]?.[_0x583611(0x1de)]||_0x583611(0x1c3)));}let _0x2f890a=_0x583611(0x214);if(_0x3bdf3e[_0x583611(0x1f5)]?.[_0x583611(0x1f4)])switch(_0x3bdf3e['data'][_0x583611(0x1f4)][_0x583611(0x1eb)]()){case _0x583611(0x1d8):_0x2f890a=_0x583611(0x1d0);break;case'CAN':_0x2f890a=_0x583611(0x228);break;case _0x583611(0x1cc):_0x2f890a='EXPIRED';break;case _0x583611(0x21e):_0x2f890a=_0x583611(0x228);break;case _0x583611(0x1da):case _0x583611(0x1c6):default:_0x2f890a=_0x583611(0x214);break;}return{'status':_0x2f890a,'amount':_0x3bdf3e[_0x583611(0x1f5)]?.['amount'],'currency':_0x3bdf3e[_0x583611(0x1f5)]?.[_0x583611(0x239)]};}catch(_0x6dd81e){console[_0x583611(0x1ec)](_0x583611(0x1ed),_0x6dd81e),loggerService_1[_0x583611(0x232)][_0x583611(0x1e9)](_0x583611(0x200),_0x583611(0x20d)+_0xb1bfc9,_0x6dd81e);throw new Error(_0x583611(0x1fb)+(_0x6dd81e instanceof Error?_0x6dd81e['message']:_0x583611(0x1c3)));}}async['processWebhook'](_0x32d348){const _0x1652b9=a42_0x3586bb;console[_0x1652b9(0x207)]('Processing\x20Rapyd\x20webhook:',_0x32d348);let _0x5bf1ac='PENDING',_0x43bd06;_0x32d348['data']?.[_0x1652b9(0x218)]&&(_0x43bd06=_0x32d348[_0x1652b9(0x1f5)][_0x1652b9(0x218)],console['log']('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x43bd06));switch(_0x32d348[_0x1652b9(0x1f2)]?.[_0x1652b9(0x1eb)]()){case _0x1652b9(0x1cf):_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x1d9)]===!![]&&_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x1f4)]===_0x1652b9(0x1d8)?_0x5bf1ac=_0x1652b9(0x1d0):_0x5bf1ac=_0x1652b9(0x214);break;case _0x1652b9(0x222):_0x5bf1ac='FAILED';break;case _0x1652b9(0x215):_0x5bf1ac=_0x1652b9(0x20c);break;case _0x1652b9(0x230):_0x5bf1ac='FAILED';!_0x43bd06&&_0x32d348['data']?.[_0x1652b9(0x218)]&&(_0x43bd06=_0x32d348[_0x1652b9(0x1f5)][_0x1652b9(0x218)]);break;default:switch(_0x32d348[_0x1652b9(0x1f5)]?.['status']?.[_0x1652b9(0x1eb)]()){case _0x1652b9(0x1d8):_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x1d9)]===!![]?_0x5bf1ac=_0x1652b9(0x1d0):_0x5bf1ac=_0x1652b9(0x228);break;case _0x1652b9(0x231):_0x5bf1ac=_0x1652b9(0x228);break;case _0x1652b9(0x1cc):_0x5bf1ac=_0x1652b9(0x20c);break;case _0x1652b9(0x21e):_0x5bf1ac='FAILED';!_0x43bd06&&_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x218)]&&(_0x43bd06=_0x32d348[_0x1652b9(0x1f5)]['failure_message']);break;case _0x1652b9(0x1da):case _0x1652b9(0x1c6):default:_0x5bf1ac=_0x1652b9(0x214);break;}break;}const _0x1467f4={};return _0x32d348['data']?.[_0x1652b9(0x1e8)]?.[_0x1652b9(0x1f7)]&&(_0x1467f4[_0x1652b9(0x1fe)]=_0x32d348['data']['payment_method_data'][_0x1652b9(0x1f7)]),_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x1ff)]&&(_0x1467f4[_0x1652b9(0x1cd)]=_0x32d348[_0x1652b9(0x1f5)][_0x1652b9(0x1ff)]),_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x1d7)]&&(_0x1467f4[_0x1652b9(0x1cb)]=_0x32d348[_0x1652b9(0x1f5)][_0x1652b9(0x1d7)]),_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x22b)]&&(_0x1467f4[_0x1652b9(0x229)]=_0x32d348['data']['failure_code']),console[_0x1652b9(0x207)](_0x1652b9(0x235)+_0x5bf1ac+',\x20failureMessage='+(_0x43bd06||'none')),{'paymentId':_0x32d348[_0x1652b9(0x1f5)]?.[_0x1652b9(0x1c9)]||'','status':_0x5bf1ac,'amount':_0x32d348['data']?.[_0x1652b9(0x220)],'currency':_0x32d348[_0x1652b9(0x1f5)]?.['currency'],'failureMessage':_0x43bd06,'additionalInfo':_0x1467f4};}}function a42_0x1046(_0x587037,_0x3a99e8){const _0x37fb62=a42_0x37fb();return a42_0x1046=function(_0x1046fa,_0x181797){_0x1046fa=_0x1046fa-0x1bc;let _0x1ab807=_0x37fb62[_0x1046fa];return _0x1ab807;},a42_0x1046(_0x587037,_0x3a99e8);}exports['RapydService']=RapydService;