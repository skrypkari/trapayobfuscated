'use strict';const a45_0xce0d74=a45_0xd4b7;(function(_0x3cfe6b,_0x394f4e){const _0x3a1ee0=a45_0xd4b7,_0x16a865=_0x3cfe6b();while(!![]){try{const _0x2af24d=-parseInt(_0x3a1ee0(0x11b))/0x1+-parseInt(_0x3a1ee0(0x179))/0x2+parseInt(_0x3a1ee0(0x160))/0x3*(parseInt(_0x3a1ee0(0x174))/0x4)+-parseInt(_0x3a1ee0(0x17e))/0x5*(-parseInt(_0x3a1ee0(0x112))/0x6)+-parseInt(_0x3a1ee0(0x170))/0x7*(parseInt(_0x3a1ee0(0x116))/0x8)+-parseInt(_0x3a1ee0(0x14c))/0x9+parseInt(_0x3a1ee0(0x110))/0xa;if(_0x2af24d===_0x394f4e)break;else _0x16a865['push'](_0x16a865['shift']());}catch(_0xe3223a){_0x16a865['push'](_0x16a865['shift']());}}}(a45_0x34ed,0xa290d));Object[a45_0xce0d74(0x11d)](exports,'__esModule',{'value':!![]}),exports[a45_0xce0d74(0x12a)]=void 0x0;function a45_0xd4b7(_0x25b5bd,_0x158e84){const _0x34ed48=a45_0x34ed();return a45_0xd4b7=function(_0xd4b75a,_0x295f3f){_0xd4b75a=_0xd4b75a-0x10d;let _0x22800b=_0x34ed48[_0xd4b75a];return _0x22800b;},a45_0xd4b7(_0x25b5bd,_0x158e84);}const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x4f9015=a45_0xce0d74;this[_0x4f9015(0x10d)]='https://tesoft.uk/gateway/rapyd/',console[_0x4f9015(0x121)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a45_0xce0d74(0x141)](_0x19ddf0){const _0x43a140=a45_0xce0d74,{orderId:_0x35604c,orderName:_0x42d9aa,amount:_0x4808d1,currency:_0x2437b7,usage:_0x40f622,maxPayments:_0x21617b,successUrl:_0x4d473c,failUrl:_0x3854c4}=_0x19ddf0,_0x38fda0=_0x2437b7[_0x43a140(0x135)](),_0x7c2938='GB';console[_0x43a140(0x121)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x8a727d=_0x43a140(0x156)+_0x35604c,_0xbdfc4d=_0x43a140(0x15c)+_0x35604c,_0x561300={'amount':_0x4808d1,'currency':_0x38fda0,'cancel_checkout_url':_0xbdfc4d,'complete_checkout_url':_0x8a727d,'complete_payment_url':_0x8a727d,'merchant_reference_id':_0x35604c,'description':_0x43a140(0x152)+_0x35604c,'country':'GB','payment_method_types_include':['gb_visa_card',_0x43a140(0x15b)],'custom_elements':{'display_description':!![]}},_0x594868=Date['now']();try{console[_0x43a140(0x121)](_0x43a140(0x17f)),console['log']('URL:',this[_0x43a140(0x10d)]),console['log'](_0x43a140(0x122),JSON[_0x43a140(0x163)](_0x561300,null,0x2)),console[_0x43a140(0x121)](_0x43a140(0x12d)+_0x7c2938+_0x43a140(0x143)),console[_0x43a140(0x121)](_0x43a140(0x155)),loggerService_1[_0x43a140(0x15e)][_0x43a140(0x137)](_0x43a140(0x169),_0x43a140(0x158),'POST',_0x561300);const _0x346294=await fetch(this[_0x43a140(0x10d)],{'method':'POST','headers':{'Content-Type':_0x43a140(0x118),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x43a140(0x163)](_0x561300)}),_0x4c3cfc=Date[_0x43a140(0x154)]()-_0x594868;console[_0x43a140(0x121)](_0x43a140(0x10e)),console[_0x43a140(0x121)]('Status:',_0x346294[_0x43a140(0x114)]),console[_0x43a140(0x121)](_0x43a140(0x138),_0x346294[_0x43a140(0x16d)]),console[_0x43a140(0x121)](_0x43a140(0x17a),Object[_0x43a140(0x14b)](_0x346294['headers'][_0x43a140(0x111)]())),console['log'](_0x43a140(0x17d),_0x4c3cfc+'ms');const _0x3c42ef=await _0x346294['text']();console['log'](_0x43a140(0x147),_0x3c42ef);if(!_0x346294['ok']){console[_0x43a140(0x176)](_0x43a140(0x128)),console['error'](_0x43a140(0x14e),_0x346294['status']),console['error']('Response\x20Body:',_0x3c42ef),loggerService_1['loggerService'][_0x43a140(0x172)]('rapyd',_0x43a140(0x158),_0x346294[_0x43a140(0x114)],_0x3c42ef,_0x4c3cfc),loggerService_1[_0x43a140(0x15e)][_0x43a140(0x177)](_0x43a140(0x169),'/v1/hosted/payment_links',_0x43a140(0x130)+_0x346294[_0x43a140(0x114)]+':\x20'+_0x3c42ef);throw new Error(_0x43a140(0x11f)+_0x346294[_0x43a140(0x114)]+_0x43a140(0x178)+_0x3c42ef);}let _0x4941ed;try{_0x4941ed=JSON[_0x43a140(0x16e)](_0x3c42ef);}catch(_0x3959e3){console[_0x43a140(0x176)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3959e3),loggerService_1[_0x43a140(0x15e)][_0x43a140(0x177)]('rapyd',_0x43a140(0x158),_0x43a140(0x140)+_0x3959e3);throw new Error(_0x43a140(0x157)+_0x3c42ef);}console[_0x43a140(0x121)](_0x43a140(0x15f)),console['log'](_0x43a140(0x16a),JSON[_0x43a140(0x163)](_0x4941ed,null,0x2)),loggerService_1[_0x43a140(0x15e)]['logWhiteDomainResponse'](_0x43a140(0x169),'/v1/hosted/payment_links',_0x346294[_0x43a140(0x114)],_0x4941ed,_0x4c3cfc);if(_0x4941ed[_0x43a140(0x114)]?.[_0x43a140(0x114)]!==_0x43a140(0x16c)){const _0x367e5b=_0x4941ed[_0x43a140(0x114)]?.[_0x43a140(0x14d)]||_0x43a140(0x145),_0x58c43f=_0x4941ed[_0x43a140(0x114)]?.[_0x43a140(0x124)]||_0x43a140(0x168);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x43a140(0x176)]('Error\x20Code:',_0x58c43f),console[_0x43a140(0x176)](_0x43a140(0x127),_0x367e5b),console[_0x43a140(0x176)](_0x43a140(0x146),_0x4941ed[_0x43a140(0x114)]),loggerService_1[_0x43a140(0x15e)][_0x43a140(0x177)](_0x43a140(0x169),_0x43a140(0x158),_0x43a140(0x10f)+_0x58c43f+_0x43a140(0x151)+_0x367e5b);throw new Error(_0x43a140(0x159)+_0x58c43f+_0x43a140(0x151)+_0x367e5b);}if(!_0x4941ed[_0x43a140(0x17b)]?.['id']||!_0x4941ed[_0x43a140(0x17b)]?.['redirect_url']){console[_0x43a140(0x176)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x43a140(0x176)]('Response\x20data:',_0x4941ed[_0x43a140(0x17b)]),loggerService_1[_0x43a140(0x15e)][_0x43a140(0x177)]('rapyd','/v1/hosted/payment_links',_0x43a140(0x13b));throw new Error(_0x43a140(0x15d));}return console['log'](_0x43a140(0x165)),console['log']('Payment\x20Link\x20ID:',_0x4941ed['data']['id']),console[_0x43a140(0x121)](_0x43a140(0x115),_0x4941ed[_0x43a140(0x17b)][_0x43a140(0x120)]),console[_0x43a140(0x121)](_0x43a140(0x12e)+_0x7c2938+'\x20(GB\x20-\x20Britain)'),console[_0x43a140(0x121)](_0x43a140(0x155)),{'gateway_payment_id':_0x4941ed[_0x43a140(0x17b)]['id'],'payment_url':_0x4941ed['data'][_0x43a140(0x120)]};}catch(_0x3b6c9e){console['error']('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x43a140(0x176)](_0x43a140(0x123),_0x3b6c9e),loggerService_1[_0x43a140(0x15e)][_0x43a140(0x177)](_0x43a140(0x169),_0x43a140(0x158),_0x3b6c9e);if(_0x3b6c9e instanceof Error){console[_0x43a140(0x176)](_0x43a140(0x15a),_0x3b6c9e[_0x43a140(0x14d)]),console[_0x43a140(0x176)](_0x43a140(0x11c),_0x3b6c9e[_0x43a140(0x13f)]);throw new Error(_0x43a140(0x171)+_0x3b6c9e['message']);}throw new Error(_0x43a140(0x166));}}async['verifyPayment'](_0x4422eb){const _0x399dfb=a45_0xce0d74,_0x201011=Date[_0x399dfb(0x154)]();try{loggerService_1[_0x399dfb(0x15e)][_0x399dfb(0x137)](_0x399dfb(0x169),_0x399dfb(0x162)+_0x4422eb,_0x399dfb(0x164),{});const _0x42462b=await fetch(this[_0x399dfb(0x10d)]+'/'+_0x4422eb,{'method':_0x399dfb(0x164),'headers':{'Content-Type':_0x399dfb(0x118),'User-Agent':_0x399dfb(0x167)}}),_0x1af05d=Date['now']()-_0x201011;if(!_0x42462b['ok']){const _0x47bb48=await _0x42462b[_0x399dfb(0x12c)]();loggerService_1[_0x399dfb(0x15e)]['logWhiteDomainResponse'](_0x399dfb(0x169),_0x399dfb(0x162)+_0x4422eb,_0x42462b['status'],_0x47bb48,_0x1af05d);throw new Error(_0x399dfb(0x11f)+_0x42462b[_0x399dfb(0x114)]);}const _0x2cd20b=await _0x42462b[_0x399dfb(0x12b)]();loggerService_1[_0x399dfb(0x15e)]['logWhiteDomainResponse'](_0x399dfb(0x169),_0x399dfb(0x162)+_0x4422eb,_0x42462b[_0x399dfb(0x114)],_0x2cd20b,_0x1af05d);if(_0x2cd20b[_0x399dfb(0x114)]?.['status']!==_0x399dfb(0x16c)){loggerService_1[_0x399dfb(0x15e)]['logWhiteDomainError']('rapyd',_0x399dfb(0x162)+_0x4422eb,_0x399dfb(0x11a)+(_0x2cd20b[_0x399dfb(0x114)]?.[_0x399dfb(0x14d)]||_0x399dfb(0x13d)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x2cd20b[_0x399dfb(0x114)]?.['message']||_0x399dfb(0x13d)));}let _0x198d87=_0x399dfb(0x117);if(_0x2cd20b['data']?.['status'])switch(_0x2cd20b[_0x399dfb(0x17b)][_0x399dfb(0x114)][_0x399dfb(0x135)]()){case'CLO':_0x198d87=_0x399dfb(0x133);break;case _0x399dfb(0x148):_0x198d87=_0x399dfb(0x119);break;case'EXP':_0x198d87=_0x399dfb(0x139);break;case _0x399dfb(0x134):_0x198d87=_0x399dfb(0x119);break;case'NEW':case _0x399dfb(0x131):default:_0x198d87=_0x399dfb(0x117);break;}return{'status':_0x198d87,'amount':_0x2cd20b[_0x399dfb(0x17b)]?.['amount'],'currency':_0x2cd20b[_0x399dfb(0x17b)]?.[_0x399dfb(0x113)]};}catch(_0x262deb){console[_0x399dfb(0x176)](_0x399dfb(0x161),_0x262deb),loggerService_1[_0x399dfb(0x15e)]['logWhiteDomainError'](_0x399dfb(0x169),_0x399dfb(0x162)+_0x4422eb,_0x262deb);throw new Error(_0x399dfb(0x149)+(_0x262deb instanceof Error?_0x262deb[_0x399dfb(0x14d)]:'Unknown\x20error'));}}async[a45_0xce0d74(0x16b)](_0x2ba7c5){const _0x184a59=a45_0xce0d74;console[_0x184a59(0x121)](_0x184a59(0x153),_0x2ba7c5);let _0x47ad97=_0x184a59(0x117),_0x377a40;_0x2ba7c5[_0x184a59(0x17b)]?.[_0x184a59(0x14a)]&&(_0x377a40=_0x2ba7c5[_0x184a59(0x17b)][_0x184a59(0x14a)],console[_0x184a59(0x121)]('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x377a40));switch(_0x2ba7c5['type']?.['toUpperCase']()){case _0x184a59(0x142):_0x2ba7c5[_0x184a59(0x17b)]?.['paid']===!![]&&_0x2ba7c5['data']?.[_0x184a59(0x114)]===_0x184a59(0x13e)?_0x47ad97=_0x184a59(0x133):_0x47ad97=_0x184a59(0x117);break;case _0x184a59(0x144):_0x47ad97=_0x184a59(0x119);break;case _0x184a59(0x173):_0x47ad97='EXPIRED';break;case _0x184a59(0x13c):_0x47ad97=_0x184a59(0x119);!_0x377a40&&_0x2ba7c5[_0x184a59(0x17b)]?.[_0x184a59(0x14a)]&&(_0x377a40=_0x2ba7c5[_0x184a59(0x17b)][_0x184a59(0x14a)]);break;default:switch(_0x2ba7c5[_0x184a59(0x17b)]?.[_0x184a59(0x114)]?.[_0x184a59(0x135)]()){case'CLO':_0x2ba7c5[_0x184a59(0x17b)]?.[_0x184a59(0x12f)]===!![]?_0x47ad97=_0x184a59(0x133):_0x47ad97=_0x184a59(0x119);break;case _0x184a59(0x148):_0x47ad97=_0x184a59(0x119);break;case'EXP':_0x47ad97=_0x184a59(0x139);break;case _0x184a59(0x134):_0x47ad97=_0x184a59(0x119);!_0x377a40&&_0x2ba7c5[_0x184a59(0x17b)]?.[_0x184a59(0x14a)]&&(_0x377a40=_0x2ba7c5['data'][_0x184a59(0x14a)]);break;case _0x184a59(0x136):case _0x184a59(0x131):default:_0x47ad97='PENDING';break;}break;}const _0x33fb67={};return _0x2ba7c5[_0x184a59(0x17b)]?.['payment_method_data']?.[_0x184a59(0x175)]&&(_0x33fb67[_0x184a59(0x129)]=_0x2ba7c5['data'][_0x184a59(0x17c)][_0x184a59(0x175)]),_0x2ba7c5['data']?.[_0x184a59(0x125)]&&(_0x33fb67['paymentMethod']=_0x2ba7c5[_0x184a59(0x17b)][_0x184a59(0x125)]),_0x2ba7c5['data']?.['error_code']&&(_0x33fb67['errorCode']=_0x2ba7c5[_0x184a59(0x17b)][_0x184a59(0x124)]),_0x2ba7c5['data']?.['failure_code']&&(_0x33fb67[_0x184a59(0x16f)]=_0x2ba7c5[_0x184a59(0x17b)][_0x184a59(0x126)]),console[_0x184a59(0x121)](_0x184a59(0x11e)+_0x47ad97+_0x184a59(0x150)+(_0x377a40||_0x184a59(0x14f))),{'paymentId':_0x2ba7c5[_0x184a59(0x17b)]?.[_0x184a59(0x132)]||'','status':_0x47ad97,'amount':_0x2ba7c5['data']?.[_0x184a59(0x13a)],'currency':_0x2ba7c5['data']?.[_0x184a59(0x113)],'failureMessage':_0x377a40,'additionalInfo':_0x33fb67};}}function a45_0x34ed(){const _0x4451ba=['merchant_reference_id','PAID','ERR','toUpperCase','NEW','logWhiteDomainRequest','Status\x20Text:','EXPIRED','amount','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','PAYMENT_FAILED','Unknown\x20error','CLO','stack','JSON\x20Parse\x20Error:\x20','createPaymentLink','PAYMENT_COMPLETED','\x20(always\x20GB\x20for\x20Rapyd)','PAYMENT_CANCELED','Unknown\x20error\x20from\x20Rapyd\x20API','Full\x20Error\x20Data:','Raw\x20Response\x20Body:','CAN','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','failure_message','fromEntries','10188315SFUllo','message','HTTP\x20Status:','none',',\x20failureMessage=','):\x20','ORDER:\x20','Processing\x20Rapyd\x20webhook:','now','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','https://tesoft.uk/gateway/success.php?id=','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','/v1/hosted/payment_links','Rapyd\x20API\x20error\x20(','Error\x20message:','gb_mastercard_card','https://tesoft.uk/gateway/fail.php?id=','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','loggerService','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','3BylKdr','Rapyd\x20payment\x20verification\x20error:','/v1/hosted/payment_links/','stringify','GET','===\x20RAPYD\x20SUCCESS\x20===','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','TesSoft\x20Payment\x20System/1.0','UNKNOWN','rapyd','Parsed\x20Result:','processWebhook','SUCCESS','statusText','parse','failureCode','543683qTAVlK','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','logWhiteDomainResponse','PAYMENT_EXPIRED','196064zcNBUB','last4','error','logWhiteDomainError',',\x20body:\x20','980318JdJPnz','Headers:','data','payment_method_data','Response\x20Time:','145wmcbXa','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','apiUrl','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Business\x20Error\x20(','25566070uCrKsE','entries','160122BPmKeL','currency','status','Redirect\x20URL:','64geOARU','PENDING','application/json','FAILED','Rapyd\x20API\x20error:\x20','470131RElpmV','Error\x20stack:','defineProperty','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','HTTP\x20error!\x20status:\x20','redirect_url','log','Request\x20Body\x20(Updated\x20Format):','Error\x20details:','error_code','payment_method_type','failure_code','Error\x20Message:','===\x20RAPYD\x20API\x20ERROR\x20===','cardLast4','RapydService','json','text','üá¨üáß\x20Country:\x20','üá¨üáß\x20Country\x20used:\x20','paid','HTTP\x20','ACT'];a45_0x34ed=function(){return _0x4451ba;};return a45_0x34ed();}exports['RapydService']=RapydService;