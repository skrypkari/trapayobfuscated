'use strict';const a42_0x59ffe6=a42_0x57c2;function a42_0x2107(){const _0x5e6dde=['Rapyd\x20API\x20error\x20(','PAID','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','stringify','üá¨üáß\x20Country:\x20','application/json','headers','Full\x20Error\x20Data:','currency','2GKLTOM','Error\x20details:','RapydService','URL:','PENDING','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','\x20(GB\x20-\x20Britain)','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Response\x20Body:','119358coggzG','Raw\x20Response\x20Body:','22hYHAzo','logWhiteDomainError','Rapyd\x20API\x20error:\x20','json','196jyPbQc','redirect_url','apiUrl','defineProperty','POST','rapyd','Response\x20data:','EXP','SUCCESS','Processing\x20Rapyd\x20webhook:','Redirect\x20URL:','../loggerService','Request\x20Body\x20(Updated\x20Format):','6IWercC','https://tesoft.uk/gateway/success.php?id=','HTTP\x20error!\x20status:\x20','logWhiteDomainResponse','fromEntries','1021251MrMKvs','Headers:','ACT','Error\x20Message:','13GweHbZ','ORDER:\x20','merchant_reference_id','createPaymentLink','loggerService','8bOPlQV','):\x20','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Missing\x20id\x20or\x20redirect_url\x20in\x20response','1589436qypSyy','https://tesoft.uk/gateway/rapyd/','error','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','üá¨üáß\x20Country\x20used:\x20','FAILED','Unknown\x20error\x20from\x20Rapyd\x20API','CAN','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','gb_visa_card','text','Error\x20message:','status','TesSoft\x20Payment\x20System/1.0','502955iCPfYO','Error\x20stack:','Unknown\x20error','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','842470KCXBrN','message','log','data','gb_mastercard_card','===\x20RAPYD\x20API\x20ERROR\x20===','/v1/hosted/payment_links/','/v1/hosted/payment_links','Status\x20Text:','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','UNKNOWN','CLO','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','GET','toUpperCase','PAYMENT_CANCELED','11406UEkpWx','HTTP\x20','parse','41818wySRzg','JSON\x20Parse\x20Error:\x20','ERR','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','NEW','now','amount','Payment\x20Link\x20ID:'];a42_0x2107=function(){return _0x5e6dde;};return a42_0x2107();}(function(_0x472d5d,_0x2ba913){const _0x428e9c=a42_0x57c2,_0x4734f0=_0x472d5d();while(!![]){try{const _0x47678a=-parseInt(_0x428e9c(0x1a4))/0x1*(parseInt(_0x428e9c(0x1b5))/0x2)+parseInt(_0x428e9c(0x1a1))/0x3*(parseInt(_0x428e9c(0x1c4))/0x4)+-parseInt(_0x428e9c(0x18d))/0x5*(-parseInt(_0x428e9c(0x16c))/0x6)+-parseInt(_0x428e9c(0x171))/0x7+-parseInt(_0x428e9c(0x17a))/0x8*(parseInt(_0x428e9c(0x1be))/0x9)+-parseInt(_0x428e9c(0x191))/0xa*(-parseInt(_0x428e9c(0x1c0))/0xb)+parseInt(_0x428e9c(0x17f))/0xc*(-parseInt(_0x428e9c(0x175))/0xd);if(_0x47678a===_0x2ba913)break;else _0x4734f0['push'](_0x4734f0['shift']());}catch(_0x55e5b9){_0x4734f0['push'](_0x4734f0['shift']());}}}(a42_0x2107,0x1dc65));Object[a42_0x59ffe6(0x1c7)](exports,'__esModule',{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require(a42_0x59ffe6(0x16a));function a42_0x57c2(_0x4b2e96,_0x2f4fa8){const _0x210798=a42_0x2107();return a42_0x57c2=function(_0x57c257,_0x5e08da){_0x57c257=_0x57c257-0x163;let _0x17f20f=_0x210798[_0x57c257];return _0x17f20f;},a42_0x57c2(_0x4b2e96,_0x2f4fa8);}class RapydService{constructor(){const _0x3147b7=a42_0x59ffe6;this['apiUrl']=_0x3147b7(0x180),console[_0x3147b7(0x193)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a42_0x59ffe6(0x178)](_0x44a6c4){const _0x2a723d=a42_0x59ffe6,{orderId:_0xbb6c8a,orderName:_0x857d8,amount:_0x52c4eb,currency:_0x49e5d2,usage:_0x5609d0,maxPayments:_0x4063ad,successUrl:_0x52d968,failUrl:_0x52e463}=_0x44a6c4,_0x5bb2ec=_0x49e5d2[_0x2a723d(0x19f)](),_0x3e91db='GB';console[_0x2a723d(0x193)](_0x2a723d(0x190));const _0x4bbfd1=_0x2a723d(0x16d)+_0xbb6c8a,_0x2f7d50='https://tesoft.uk/gateway/fail.php?id='+_0xbb6c8a,_0x314ade={'amount':_0x52c4eb,'currency':_0x5bb2ec,'cancel_checkout_url':_0x2f7d50,'complete_checkout_url':_0x4bbfd1,'complete_payment_url':_0x4bbfd1,'merchant_reference_id':_0xbb6c8a,'description':_0x2a723d(0x176)+_0xbb6c8a,'country':'GB','payment_method_types_include':[_0x2a723d(0x188),_0x2a723d(0x195)],'custom_elements':{'display_description':!![]}},_0x1b85ae=Date[_0x2a723d(0x1a9)]();try{console[_0x2a723d(0x193)](_0x2a723d(0x182)),console['log'](_0x2a723d(0x1b8),this[_0x2a723d(0x1c6)]),console[_0x2a723d(0x193)](_0x2a723d(0x16b),JSON['stringify'](_0x314ade,null,0x2)),console[_0x2a723d(0x193)](_0x2a723d(0x1b0)+_0x3e91db+'\x20(always\x20GB\x20for\x20Rapyd)'),console['log'](_0x2a723d(0x19a)),loggerService_1[_0x2a723d(0x179)]['logWhiteDomainRequest'](_0x2a723d(0x164),_0x2a723d(0x198),_0x2a723d(0x163),_0x314ade);const _0x33c88d=await fetch(this[_0x2a723d(0x1c6)],{'method':'POST','headers':{'Content-Type':_0x2a723d(0x1b1),'User-Agent':_0x2a723d(0x18c)},'body':JSON[_0x2a723d(0x1af)](_0x314ade)}),_0x316f76=Date['now']()-_0x1b85ae;console['log']('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2a723d(0x193)]('Status:',_0x33c88d[_0x2a723d(0x18b)]),console[_0x2a723d(0x193)](_0x2a723d(0x199),_0x33c88d['statusText']),console['log'](_0x2a723d(0x172),Object[_0x2a723d(0x170)](_0x33c88d[_0x2a723d(0x1b2)]['entries']())),console[_0x2a723d(0x193)]('Response\x20Time:',_0x316f76+'ms');const _0x514116=await _0x33c88d[_0x2a723d(0x189)]();console[_0x2a723d(0x193)](_0x2a723d(0x1bf),_0x514116);if(!_0x33c88d['ok']){console[_0x2a723d(0x181)](_0x2a723d(0x196)),console[_0x2a723d(0x181)]('HTTP\x20Status:',_0x33c88d['status']),console[_0x2a723d(0x181)](_0x2a723d(0x1bd),_0x514116),loggerService_1[_0x2a723d(0x179)][_0x2a723d(0x16f)](_0x2a723d(0x164),_0x2a723d(0x198),_0x33c88d[_0x2a723d(0x18b)],_0x514116,_0x316f76),loggerService_1[_0x2a723d(0x179)][_0x2a723d(0x1c1)]('rapyd',_0x2a723d(0x198),_0x2a723d(0x1a2)+_0x33c88d[_0x2a723d(0x18b)]+':\x20'+_0x514116);throw new Error('HTTP\x20error!\x20status:\x20'+_0x33c88d['status']+',\x20body:\x20'+_0x514116);}let _0x2ec154;try{_0x2ec154=JSON[_0x2a723d(0x1a3)](_0x514116);}catch(_0x33d360){console[_0x2a723d(0x181)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x33d360),loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x2a723d(0x198),_0x2a723d(0x1a5)+_0x33d360);throw new Error(_0x2a723d(0x17c)+_0x514116);}console[_0x2a723d(0x193)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x2a723d(0x193)]('Parsed\x20Result:',JSON[_0x2a723d(0x1af)](_0x2ec154,null,0x2)),loggerService_1[_0x2a723d(0x179)]['logWhiteDomainResponse'](_0x2a723d(0x164),_0x2a723d(0x198),_0x33c88d[_0x2a723d(0x18b)],_0x2ec154,_0x316f76);if(_0x2ec154[_0x2a723d(0x18b)]?.['status']!==_0x2a723d(0x167)){const _0x2cae4d=_0x2ec154['status']?.[_0x2a723d(0x192)]||_0x2a723d(0x185),_0x951e73=_0x2ec154[_0x2a723d(0x18b)]?.['error_code']||_0x2a723d(0x19b);console[_0x2a723d(0x181)](_0x2a723d(0x187)),console[_0x2a723d(0x181)]('Error\x20Code:',_0x951e73),console[_0x2a723d(0x181)](_0x2a723d(0x174),_0x2cae4d),console['error'](_0x2a723d(0x1b3),_0x2ec154[_0x2a723d(0x18b)]),loggerService_1[_0x2a723d(0x179)][_0x2a723d(0x1c1)](_0x2a723d(0x164),_0x2a723d(0x198),'Business\x20Error\x20('+_0x951e73+_0x2a723d(0x17b)+_0x2cae4d);throw new Error(_0x2a723d(0x1ac)+_0x951e73+_0x2a723d(0x17b)+_0x2cae4d);}if(!_0x2ec154[_0x2a723d(0x194)]?.['id']||!_0x2ec154[_0x2a723d(0x194)]?.[_0x2a723d(0x1c5)]){console['error'](_0x2a723d(0x19d)),console[_0x2a723d(0x181)](_0x2a723d(0x17e)),console[_0x2a723d(0x181)](_0x2a723d(0x165),_0x2ec154['data']),loggerService_1[_0x2a723d(0x179)][_0x2a723d(0x1c1)](_0x2a723d(0x164),_0x2a723d(0x198),_0x2a723d(0x1ae));throw new Error(_0x2a723d(0x17d));}return console[_0x2a723d(0x193)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x2a723d(0x193)](_0x2a723d(0x1ab),_0x2ec154[_0x2a723d(0x194)]['id']),console[_0x2a723d(0x193)](_0x2a723d(0x169),_0x2ec154['data']['redirect_url']),console[_0x2a723d(0x193)](_0x2a723d(0x183)+_0x3e91db+_0x2a723d(0x1bb)),console[_0x2a723d(0x193)](_0x2a723d(0x19a)),{'gateway_payment_id':_0x2ec154[_0x2a723d(0x194)]['id'],'payment_url':_0x2ec154[_0x2a723d(0x194)][_0x2a723d(0x1c5)]};}catch(_0x49d26a){console[_0x2a723d(0x181)](_0x2a723d(0x1bc)),console['error'](_0x2a723d(0x1b6),_0x49d26a),loggerService_1[_0x2a723d(0x179)]['logWhiteDomainError'](_0x2a723d(0x164),_0x2a723d(0x198),_0x49d26a);if(_0x49d26a instanceof Error){console[_0x2a723d(0x181)](_0x2a723d(0x18a),_0x49d26a['message']),console[_0x2a723d(0x181)](_0x2a723d(0x18e),_0x49d26a['stack']);throw new Error(_0x2a723d(0x1ba)+_0x49d26a['message']);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x5432bd){const _0x57262f=a42_0x59ffe6,_0x57dd78=Date[_0x57262f(0x1a9)]();try{loggerService_1[_0x57262f(0x179)]['logWhiteDomainRequest'](_0x57262f(0x164),_0x57262f(0x197)+_0x5432bd,_0x57262f(0x19e),{});const _0x4956ed=await fetch(this[_0x57262f(0x1c6)]+'/'+_0x5432bd,{'method':_0x57262f(0x19e),'headers':{'Content-Type':_0x57262f(0x1b1),'User-Agent':_0x57262f(0x18c)}}),_0x4660ad=Date[_0x57262f(0x1a9)]()-_0x57dd78;if(!_0x4956ed['ok']){const _0x547886=await _0x4956ed[_0x57262f(0x189)]();loggerService_1['loggerService']['logWhiteDomainResponse']('rapyd',_0x57262f(0x197)+_0x5432bd,_0x4956ed[_0x57262f(0x18b)],_0x547886,_0x4660ad);throw new Error(_0x57262f(0x16e)+_0x4956ed[_0x57262f(0x18b)]);}const _0x482504=await _0x4956ed[_0x57262f(0x1c3)]();loggerService_1[_0x57262f(0x179)]['logWhiteDomainResponse'](_0x57262f(0x164),'/v1/hosted/payment_links/'+_0x5432bd,_0x4956ed[_0x57262f(0x18b)],_0x482504,_0x4660ad);if(_0x482504[_0x57262f(0x18b)]?.[_0x57262f(0x18b)]!=='SUCCESS'){loggerService_1[_0x57262f(0x179)][_0x57262f(0x1c1)](_0x57262f(0x164),_0x57262f(0x197)+_0x5432bd,'Rapyd\x20API\x20error:\x20'+(_0x482504['status']?.[_0x57262f(0x192)]||'Unknown\x20error'));throw new Error(_0x57262f(0x1c2)+(_0x482504[_0x57262f(0x18b)]?.[_0x57262f(0x192)]||_0x57262f(0x18f)));}let _0x52ee65=_0x57262f(0x1b9);if(_0x482504[_0x57262f(0x194)]?.['status'])switch(_0x482504[_0x57262f(0x194)][_0x57262f(0x18b)][_0x57262f(0x19f)]()){case'CLO':_0x52ee65=_0x57262f(0x1ad);break;case _0x57262f(0x186):_0x52ee65='FAILED';break;case _0x57262f(0x166):_0x52ee65='EXPIRED';break;case'ERR':_0x52ee65=_0x57262f(0x184);break;case _0x57262f(0x1a8):case _0x57262f(0x173):default:_0x52ee65='PENDING';break;}return{'status':_0x52ee65,'amount':_0x482504[_0x57262f(0x194)]?.['amount'],'currency':_0x482504[_0x57262f(0x194)]?.['currency']};}catch(_0xd5023b){console[_0x57262f(0x181)]('Rapyd\x20payment\x20verification\x20error:',_0xd5023b),loggerService_1[_0x57262f(0x179)]['logWhiteDomainError'](_0x57262f(0x164),'/v1/hosted/payment_links/'+_0x5432bd,_0xd5023b);throw new Error(_0x57262f(0x1a7)+(_0xd5023b instanceof Error?_0xd5023b['message']:_0x57262f(0x18f)));}}async['processWebhook'](_0x38dfe1){const _0x4abd51=a42_0x59ffe6;console['log'](_0x4abd51(0x168),_0x38dfe1);let _0x5362ad=_0x4abd51(0x1b9);switch(_0x38dfe1['type']?.[_0x4abd51(0x19f)]()){case'PAYMENT_COMPLETED':_0x38dfe1[_0x4abd51(0x194)]?.['paid']===!![]&&_0x38dfe1[_0x4abd51(0x194)]?.['status']===_0x4abd51(0x19c)?_0x5362ad=_0x4abd51(0x1ad):_0x5362ad=_0x4abd51(0x1b9);break;case _0x4abd51(0x1a0):_0x5362ad=_0x4abd51(0x184);break;case'PAYMENT_EXPIRED':_0x5362ad='EXPIRED';break;case'PAYMENT_FAILED':_0x5362ad=_0x4abd51(0x184);break;default:switch(_0x38dfe1[_0x4abd51(0x194)]?.[_0x4abd51(0x18b)]?.[_0x4abd51(0x19f)]()){case'CLO':_0x38dfe1[_0x4abd51(0x194)]?.['paid']===!![]?_0x5362ad=_0x4abd51(0x1ad):_0x5362ad='FAILED';break;case _0x4abd51(0x186):_0x5362ad=_0x4abd51(0x184);break;case'EXP':_0x5362ad='EXPIRED';break;case _0x4abd51(0x1a6):_0x5362ad=_0x4abd51(0x184);break;case'NEW':case _0x4abd51(0x173):default:_0x5362ad=_0x4abd51(0x1b9);break;}break;}return{'paymentId':_0x38dfe1[_0x4abd51(0x194)]?.[_0x4abd51(0x177)]||'','status':_0x5362ad,'amount':_0x38dfe1[_0x4abd51(0x194)]?.[_0x4abd51(0x1aa)],'currency':_0x38dfe1['data']?.[_0x4abd51(0x1b4)]};}}exports[a42_0x59ffe6(0x1b7)]=RapydService;