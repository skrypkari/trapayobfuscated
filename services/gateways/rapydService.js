'use strict';const a46_0xc92125=a46_0x217d;(function(_0x1272a5,_0x149fdb){const _0x3103c9=a46_0x217d,_0x1261c2=_0x1272a5();while(!![]){try{const _0x503b0a=-parseInt(_0x3103c9(0xd8))/0x1*(-parseInt(_0x3103c9(0xee))/0x2)+-parseInt(_0x3103c9(0xb9))/0x3*(parseInt(_0x3103c9(0xf3))/0x4)+parseInt(_0x3103c9(0xc6))/0x5+-parseInt(_0x3103c9(0xa2))/0x6*(-parseInt(_0x3103c9(0xf7))/0x7)+parseInt(_0x3103c9(0xeb))/0x8*(parseInt(_0x3103c9(0xff))/0x9)+parseInt(_0x3103c9(0x10a))/0xa*(parseInt(_0x3103c9(0xfb))/0xb)+-parseInt(_0x3103c9(0xfd))/0xc;if(_0x503b0a===_0x149fdb)break;else _0x1261c2['push'](_0x1261c2['shift']());}catch(_0x2a05ff){_0x1261c2['push'](_0x1261c2['shift']());}}}(a46_0x8da6,0xb3e00));function a46_0x217d(_0x1a773c,_0x5ad755){const _0x8da607=a46_0x8da6();return a46_0x217d=function(_0x217df6,_0x470327){_0x217df6=_0x217df6-0x9f;let _0xef64d6=_0x8da607[_0x217df6];return _0xef64d6;},a46_0x217d(_0x1a773c,_0x5ad755);}Object[a46_0xc92125(0x10d)](exports,'__esModule',{'value':!![]}),exports[a46_0xc92125(0xfe)]=void 0x0;const loggerService_1=require(a46_0xc92125(0xbc));class RapydService{constructor(){const _0x5e01a2=a46_0xc92125;this['apiUrl']=_0x5e01a2(0xea),console[_0x5e01a2(0x110)](_0x5e01a2(0xa9));}async[a46_0xc92125(0xf4)](_0x13945e){const _0x2e0f39=a46_0xc92125,{orderId:_0x3c4ef1,orderName:_0x57ea28,amount:_0x265b46,currency:_0x117ff9,usage:_0x3179a2,maxPayments:_0x433653,successUrl:_0x298f45,failUrl:_0xeea53}=_0x13945e,_0x7d2019=_0x117ff9[_0x2e0f39(0xdc)](),_0x1c35a9='GB';console['log'](_0x2e0f39(0xd6));const _0x544e96=_0x2e0f39(0xac)+_0x3c4ef1,_0x2538f7='https://tesoft.uk/gateway/fail.php?id='+_0x3c4ef1,_0x4ab9f4={'amount':_0x265b46,'currency':_0x7d2019,'cancel_checkout_url':_0x2538f7,'complete_checkout_url':_0x544e96,'complete_payment_url':_0x544e96,'merchant_reference_id':_0x3c4ef1,'description':_0x2e0f39(0xc0)+_0x3c4ef1,'country':'GB','payment_method_types_include':[_0x2e0f39(0x111),_0x2e0f39(0x9f)],'custom_elements':{'display_description':!![]}},_0x317b8e=Date[_0x2e0f39(0xd9)]();try{console[_0x2e0f39(0x110)](_0x2e0f39(0x107)),console[_0x2e0f39(0x110)](_0x2e0f39(0xa8),this[_0x2e0f39(0xb1)]),console[_0x2e0f39(0x110)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x2e0f39(0xde)](_0x4ab9f4,null,0x2)),console[_0x2e0f39(0x110)](_0x2e0f39(0x10c)+_0x1c35a9+_0x2e0f39(0xd2)),console['log'](_0x2e0f39(0xae)),loggerService_1[_0x2e0f39(0xe7)][_0x2e0f39(0xfc)](_0x2e0f39(0xad),_0x2e0f39(0x10e),_0x2e0f39(0x108),_0x4ab9f4);const _0xe27565=await fetch(this[_0x2e0f39(0xb1)],{'method':_0x2e0f39(0x108),'headers':{'Content-Type':_0x2e0f39(0xb8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2e0f39(0xde)](_0x4ab9f4)}),_0x536123=Date[_0x2e0f39(0xd9)]()-_0x317b8e;console[_0x2e0f39(0x110)](_0x2e0f39(0xc7)),console[_0x2e0f39(0x110)](_0x2e0f39(0x101),_0xe27565['status']),console[_0x2e0f39(0x110)](_0x2e0f39(0xc1),_0xe27565[_0x2e0f39(0xf5)]),console[_0x2e0f39(0x110)](_0x2e0f39(0xf0),Object[_0x2e0f39(0xc4)](_0xe27565[_0x2e0f39(0x112)][_0x2e0f39(0x103)]())),console[_0x2e0f39(0x110)](_0x2e0f39(0xe2),_0x536123+'ms');const _0x2eb679=await _0xe27565[_0x2e0f39(0xa1)]();console[_0x2e0f39(0x110)](_0x2e0f39(0xe6),_0x2eb679);if(!_0xe27565['ok']){console['error']('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x2e0f39(0xc2)](_0x2e0f39(0xa4),_0xe27565['status']),console[_0x2e0f39(0xc2)]('Response\x20Body:',_0x2eb679),loggerService_1[_0x2e0f39(0xe7)][_0x2e0f39(0xa0)](_0x2e0f39(0xad),_0x2e0f39(0x10e),_0xe27565[_0x2e0f39(0xdf)],_0x2eb679,_0x536123),loggerService_1['loggerService'][_0x2e0f39(0xc9)]('rapyd',_0x2e0f39(0x10e),_0x2e0f39(0xd5)+_0xe27565['status']+':\x20'+_0x2eb679);throw new Error('HTTP\x20error!\x20status:\x20'+_0xe27565[_0x2e0f39(0xdf)]+',\x20body:\x20'+_0x2eb679);}let _0x28a3b0;try{_0x28a3b0=JSON[_0x2e0f39(0xc3)](_0x2eb679);}catch(_0x1eaed1){console[_0x2e0f39(0xc2)](_0x2e0f39(0xf2),_0x1eaed1),loggerService_1[_0x2e0f39(0xe7)][_0x2e0f39(0xc9)](_0x2e0f39(0xad),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x1eaed1);throw new Error(_0x2e0f39(0xe8)+_0x2eb679);}console[_0x2e0f39(0x110)](_0x2e0f39(0xfa)),console['log'](_0x2e0f39(0xdd),JSON[_0x2e0f39(0xde)](_0x28a3b0,null,0x2)),loggerService_1['loggerService'][_0x2e0f39(0xa0)](_0x2e0f39(0xad),_0x2e0f39(0x10e),_0xe27565[_0x2e0f39(0xdf)],_0x28a3b0,_0x536123);if(_0x28a3b0[_0x2e0f39(0xdf)]?.[_0x2e0f39(0xdf)]!=='SUCCESS'){const _0x7dde5d=_0x28a3b0[_0x2e0f39(0xdf)]?.['message']||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x11a735=_0x28a3b0[_0x2e0f39(0xdf)]?.[_0x2e0f39(0x113)]||_0x2e0f39(0xa6);console[_0x2e0f39(0xc2)](_0x2e0f39(0xe0)),console[_0x2e0f39(0xc2)](_0x2e0f39(0xda),_0x11a735),console[_0x2e0f39(0xc2)](_0x2e0f39(0xc8),_0x7dde5d),console[_0x2e0f39(0xc2)](_0x2e0f39(0xe4),_0x28a3b0[_0x2e0f39(0xdf)]),loggerService_1[_0x2e0f39(0xe7)][_0x2e0f39(0xc9)](_0x2e0f39(0xad),'/v1/hosted/payment_links',_0x2e0f39(0xba)+_0x11a735+_0x2e0f39(0xe1)+_0x7dde5d);throw new Error(_0x2e0f39(0xd1)+_0x11a735+'):\x20'+_0x7dde5d);}if(!_0x28a3b0[_0x2e0f39(0x10b)]?.['id']||!_0x28a3b0['data']?.['redirect_url']){console['error']('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2e0f39(0xc2)](_0x2e0f39(0xcb)),console[_0x2e0f39(0xc2)]('Response\x20data:',_0x28a3b0['data']),loggerService_1[_0x2e0f39(0xe7)][_0x2e0f39(0xc9)](_0x2e0f39(0xad),_0x2e0f39(0x10e),_0x2e0f39(0xce));throw new Error(_0x2e0f39(0xe3));}return console['log']('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x2e0f39(0x110)](_0x2e0f39(0xcf),_0x28a3b0[_0x2e0f39(0x10b)]['id']),console[_0x2e0f39(0x110)]('Redirect\x20URL:',_0x28a3b0[_0x2e0f39(0x10b)]['redirect_url']),console[_0x2e0f39(0x110)]('🇬🇧\x20Country\x20used:\x20'+_0x1c35a9+_0x2e0f39(0xa3)),console[_0x2e0f39(0x110)]('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x28a3b0[_0x2e0f39(0x10b)]['id'],'payment_url':_0x28a3b0[_0x2e0f39(0x10b)][_0x2e0f39(0x102)]};}catch(_0x21ff3e){console[_0x2e0f39(0xc2)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x21ff3e),loggerService_1[_0x2e0f39(0xe7)]['logWhiteDomainError']('rapyd',_0x2e0f39(0x10e),_0x21ff3e);if(_0x21ff3e instanceof Error){console['error'](_0x2e0f39(0xbe),_0x21ff3e[_0x2e0f39(0x115)]),console[_0x2e0f39(0xc2)](_0x2e0f39(0x109),_0x21ff3e[_0x2e0f39(0x114)]);throw new Error(_0x2e0f39(0xb2)+_0x21ff3e[_0x2e0f39(0x115)]);}throw new Error(_0x2e0f39(0x10f));}}async['verifyPayment'](_0x4bb5e2){const _0x2ce52c=a46_0xc92125,_0x2e2723=Date['now']();try{loggerService_1['loggerService'][_0x2ce52c(0xfc)](_0x2ce52c(0xad),_0x2ce52c(0xd4)+_0x4bb5e2,_0x2ce52c(0xbb),{});const _0x3d2068=await fetch(this[_0x2ce52c(0xb1)]+'/'+_0x4bb5e2,{'method':_0x2ce52c(0xbb),'headers':{'Content-Type':'application/json','User-Agent':_0x2ce52c(0x106)}}),_0x332bd4=Date[_0x2ce52c(0xd9)]()-_0x2e2723;if(!_0x3d2068['ok']){const _0x513944=await _0x3d2068[_0x2ce52c(0xa1)]();loggerService_1[_0x2ce52c(0xe7)][_0x2ce52c(0xa0)](_0x2ce52c(0xad),'/v1/hosted/payment_links/'+_0x4bb5e2,_0x3d2068[_0x2ce52c(0xdf)],_0x513944,_0x332bd4);throw new Error(_0x2ce52c(0xd3)+_0x3d2068[_0x2ce52c(0xdf)]);}const _0x17faf9=await _0x3d2068[_0x2ce52c(0xaa)]();loggerService_1[_0x2ce52c(0xe7)]['logWhiteDomainResponse'](_0x2ce52c(0xad),'/v1/hosted/payment_links/'+_0x4bb5e2,_0x3d2068[_0x2ce52c(0xdf)],_0x17faf9,_0x332bd4);if(_0x17faf9[_0x2ce52c(0xdf)]?.[_0x2ce52c(0xdf)]!=='SUCCESS'){loggerService_1[_0x2ce52c(0xe7)][_0x2ce52c(0xc9)](_0x2ce52c(0xad),'/v1/hosted/payment_links/'+_0x4bb5e2,_0x2ce52c(0xe5)+(_0x17faf9['status']?.[_0x2ce52c(0x115)]||_0x2ce52c(0xa7)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x17faf9[_0x2ce52c(0xdf)]?.[_0x2ce52c(0x115)]||_0x2ce52c(0xa7)));}let _0x252f9c=_0x2ce52c(0xcc);if(_0x17faf9[_0x2ce52c(0x10b)]?.[_0x2ce52c(0xdf)])switch(_0x17faf9[_0x2ce52c(0x10b)][_0x2ce52c(0xdf)]['toUpperCase']()){case _0x2ce52c(0xb3):_0x252f9c='PAID';break;case _0x2ce52c(0x105):_0x252f9c=_0x2ce52c(0xaf);break;case _0x2ce52c(0xd7):_0x252f9c=_0x2ce52c(0xec);break;case _0x2ce52c(0xef):_0x252f9c=_0x2ce52c(0xaf);break;case _0x2ce52c(0xcd):case'ACT':default:_0x252f9c=_0x2ce52c(0xcc);break;}return{'status':_0x252f9c,'amount':_0x17faf9[_0x2ce52c(0x10b)]?.[_0x2ce52c(0xb6)],'currency':_0x17faf9[_0x2ce52c(0x10b)]?.[_0x2ce52c(0xd0)]};}catch(_0x1edbd9){console[_0x2ce52c(0xc2)]('Rapyd\x20payment\x20verification\x20error:',_0x1edbd9),loggerService_1[_0x2ce52c(0xe7)]['logWhiteDomainError'](_0x2ce52c(0xad),_0x2ce52c(0xd4)+_0x4bb5e2,_0x1edbd9);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x1edbd9 instanceof Error?_0x1edbd9[_0x2ce52c(0x115)]:_0x2ce52c(0xa7)));}}async[a46_0xc92125(0xab)](_0x57084f){const _0x4e4db7=a46_0xc92125;console['log']('Processing\x20Rapyd\x20webhook:',_0x57084f);let _0x510c26=_0x4e4db7(0xcc),_0x18320b;_0x57084f[_0x4e4db7(0x10b)]?.['failure_message']&&(_0x18320b=_0x57084f['data']['failure_message'],console['log'](_0x4e4db7(0xb0)+_0x18320b));switch(_0x57084f[_0x4e4db7(0xed)]?.[_0x4e4db7(0xdc)]()){case _0x4e4db7(0xf6):_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xb7)]===!![]&&_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xdf)]==='CLO'?_0x510c26='PAID':_0x510c26='PENDING';break;case _0x4e4db7(0xf1):_0x510c26=_0x4e4db7(0xaf);break;case _0x4e4db7(0x100):_0x510c26=_0x4e4db7(0xec);break;case _0x4e4db7(0xca):_0x510c26=_0x4e4db7(0xaf);!_0x18320b&&_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xbd)]&&(_0x18320b=_0x57084f[_0x4e4db7(0x10b)][_0x4e4db7(0xbd)]);break;default:switch(_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xdf)]?.[_0x4e4db7(0xdc)]()){case _0x4e4db7(0xb3):_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xb7)]===!![]?_0x510c26='PAID':_0x510c26='FAILED';break;case _0x4e4db7(0x105):_0x510c26='FAILED';break;case _0x4e4db7(0xd7):_0x510c26=_0x4e4db7(0xec);break;case _0x4e4db7(0xef):_0x510c26=_0x4e4db7(0xaf);!_0x18320b&&_0x57084f[_0x4e4db7(0x10b)]?.['failure_message']&&(_0x18320b=_0x57084f[_0x4e4db7(0x10b)][_0x4e4db7(0xbd)]);break;case _0x4e4db7(0xcd):case _0x4e4db7(0xbf):default:_0x510c26=_0x4e4db7(0xcc);break;}break;}const _0x1b98c7={};return _0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xb4)]?.['last4']&&(_0x1b98c7[_0x4e4db7(0xdb)]=_0x57084f[_0x4e4db7(0x10b)][_0x4e4db7(0xb4)][_0x4e4db7(0x104)]),_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xc5)]&&(_0x1b98c7[_0x4e4db7(0xb5)]=_0x57084f[_0x4e4db7(0x10b)]['payment_method_type']),_0x57084f[_0x4e4db7(0x10b)]?.['error_code']&&(_0x1b98c7['errorCode']=_0x57084f[_0x4e4db7(0x10b)]['error_code']),_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xf9)]&&(_0x1b98c7[_0x4e4db7(0xa5)]=_0x57084f[_0x4e4db7(0x10b)]['failure_code']),console[_0x4e4db7(0x110)]('🔄\x20Rapyd\x20webhook\x20processed:\x20status='+_0x510c26+',\x20failureMessage='+(_0x18320b||_0x4e4db7(0xe9))),{'paymentId':_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xf8)]||'','status':_0x510c26,'amount':_0x57084f[_0x4e4db7(0x10b)]?.[_0x4e4db7(0xb6)],'currency':_0x57084f['data']?.[_0x4e4db7(0xd0)],'failureMessage':_0x18320b,'additionalInfo':_0x1b98c7};}}exports[a46_0xc92125(0xfe)]=RapydService;function a46_0x8da6(){const _0x248015=['CAN','TesSoft\x20Payment\x20System/1.0','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','POST','Error\x20stack:','111030QBJzSB','data','🇬🇧\x20Country:\x20','defineProperty','/v1/hosted/payment_links','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','log','gb_visa_card','headers','error_code','stack','message','gb_mastercard_card','logWhiteDomainResponse','text','798vKBGlp','\x20(GB\x20-\x20Britain)','HTTP\x20Status:','failureCode','UNKNOWN','Unknown\x20error','URL:','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','json','processWebhook','https://tesoft.uk/gateway/success.php?id=','rapyd','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','FAILED','💥\x20Rapyd\x20failure\x20message:\x20','apiUrl','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','CLO','payment_method_data','paymentMethod','amount','paid','application/json','672864lKURkR','Business\x20Error\x20(','GET','../loggerService','failure_message','Error\x20message:','ACT','ORDER:\x20','Status\x20Text:','error','parse','fromEntries','payment_method_type','5214975fKUiXI','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20Message:','logWhiteDomainError','PAYMENT_FAILED','Missing\x20id\x20or\x20redirect_url\x20in\x20response','PENDING','NEW','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Payment\x20Link\x20ID:','currency','Rapyd\x20API\x20error\x20(','\x20(always\x20GB\x20for\x20Rapyd)','HTTP\x20error!\x20status:\x20','/v1/hosted/payment_links/','HTTP\x20','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','EXP','6BLfkpH','now','Error\x20Code:','cardLast4','toUpperCase','Parsed\x20Result:','stringify','status','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','):\x20','Response\x20Time:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Full\x20Error\x20Data:','Rapyd\x20API\x20error:\x20','Raw\x20Response\x20Body:','loggerService','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','none','https://tesoft.uk/gateway/rapyd/','632wsbhco','EXPIRED','type','342094wsYVFl','ERR','Headers:','PAYMENT_CANCELED','Failed\x20to\x20parse\x20JSON\x20response:','20dvpakk','createPaymentLink','statusText','PAYMENT_COMPLETED','51247Nwiaow','merchant_reference_id','failure_code','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','1243McZaiE','logWhiteDomainRequest','29463360OTIjfB','RapydService','1809ijtEeS','PAYMENT_EXPIRED','Status:','redirect_url','entries','last4'];a46_0x8da6=function(){return _0x248015;};return a46_0x8da6();}