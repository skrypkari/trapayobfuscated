'use strict';const a46_0x4f63a9=a46_0x4e0e;(function(_0x3018cd,_0x382759){const _0x30f9e0=a46_0x4e0e,_0x5b35a0=_0x3018cd();while(!![]){try{const _0x5398d6=parseInt(_0x30f9e0(0x164))/0x1*(-parseInt(_0x30f9e0(0x1a4))/0x2)+parseInt(_0x30f9e0(0x198))/0x3+parseInt(_0x30f9e0(0x191))/0x4*(parseInt(_0x30f9e0(0x166))/0x5)+-parseInt(_0x30f9e0(0x14e))/0x6+-parseInt(_0x30f9e0(0x1ab))/0x7+-parseInt(_0x30f9e0(0x182))/0x8+parseInt(_0x30f9e0(0x197))/0x9;if(_0x5398d6===_0x382759)break;else _0x5b35a0['push'](_0x5b35a0['shift']());}catch(_0x26ecd4){_0x5b35a0['push'](_0x5b35a0['shift']());}}}(a46_0x83b0,0x2cd0c));function a46_0x4e0e(_0x1c70c4,_0x4b8a2e){const _0x83b057=a46_0x83b0();return a46_0x4e0e=function(_0x4e0e61,_0xa7c42){_0x4e0e61=_0x4e0e61-0x13f;let _0x3f432a=_0x83b057[_0x4e0e61];return _0x3f432a;},a46_0x4e0e(_0x1c70c4,_0x4b8a2e);}Object['defineProperty'](exports,a46_0x4f63a9(0x196),{'value':!![]}),exports[a46_0x4f63a9(0x169)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x2ee3b9=a46_0x4f63a9;this[_0x2ee3b9(0x194)]=_0x2ee3b9(0x144),console[_0x2ee3b9(0x14f)](_0x2ee3b9(0x17e));}async[a46_0x4f63a9(0x145)](_0x190e70){const _0x19b754=a46_0x4f63a9,{orderId:_0x384784,orderName:_0x281bc2,amount:_0x4ef581,currency:_0x3aa513,usage:_0x221e98,maxPayments:_0x39abeb,successUrl:_0x2ff96f,failUrl:_0x45d7ab}=_0x190e70,_0x19fec0=_0x3aa513[_0x19b754(0x160)](),_0x1c1c6c='GB';console[_0x19b754(0x14f)]('🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x2bd5b3=_0x19b754(0x14c)+_0x384784,_0x393424='https://tesoft.uk/gateway/fail.php?id='+_0x384784,_0x27f3ea={'amount':_0x4ef581,'currency':_0x19fec0,'cancel_checkout_url':_0x393424,'complete_checkout_url':_0x2bd5b3,'complete_payment_url':_0x2bd5b3,'merchant_reference_id':_0x384784,'description':_0x19b754(0x15d)+_0x384784,'country':'GB','payment_method_types_include':['gb_visa_card','gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x41edd1=Date[_0x19b754(0x153)]();try{console['log'](_0x19b754(0x154)),console[_0x19b754(0x14f)]('URL:',this[_0x19b754(0x194)]),console[_0x19b754(0x14f)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x19b754(0x175)](_0x27f3ea,null,0x2)),console[_0x19b754(0x14f)](_0x19b754(0x174)+_0x1c1c6c+_0x19b754(0x183)),console[_0x19b754(0x14f)]('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x19b754(0x16d)]['logWhiteDomainRequest'](_0x19b754(0x186),_0x19b754(0x19d),_0x19b754(0x17d),_0x27f3ea);const _0x146b2e=await fetch(this[_0x19b754(0x194)],{'method':_0x19b754(0x17d),'headers':{'Content-Type':_0x19b754(0x140),'User-Agent':_0x19b754(0x173)},'body':JSON['stringify'](_0x27f3ea)}),_0x490d9b=Date[_0x19b754(0x153)]()-_0x41edd1;console[_0x19b754(0x14f)](_0x19b754(0x1a3)),console['log'](_0x19b754(0x14b),_0x146b2e[_0x19b754(0x16e)]),console[_0x19b754(0x14f)](_0x19b754(0x15c),_0x146b2e[_0x19b754(0x185)]),console[_0x19b754(0x14f)](_0x19b754(0x146),Object['fromEntries'](_0x146b2e['headers']['entries']())),console['log'](_0x19b754(0x165),_0x490d9b+'ms');const _0x1308f1=await _0x146b2e[_0x19b754(0x14d)]();console[_0x19b754(0x14f)](_0x19b754(0x13f),_0x1308f1);if(!_0x146b2e['ok']){console[_0x19b754(0x14a)](_0x19b754(0x167)),console[_0x19b754(0x14a)](_0x19b754(0x16f),_0x146b2e[_0x19b754(0x16e)]),console[_0x19b754(0x14a)](_0x19b754(0x17b),_0x1308f1),loggerService_1[_0x19b754(0x16d)]['logWhiteDomainResponse'](_0x19b754(0x186),_0x19b754(0x19d),_0x146b2e['status'],_0x1308f1,_0x490d9b),loggerService_1[_0x19b754(0x16d)][_0x19b754(0x18d)]('rapyd',_0x19b754(0x19d),_0x19b754(0x187)+_0x146b2e['status']+':\x20'+_0x1308f1);throw new Error(_0x19b754(0x18b)+_0x146b2e[_0x19b754(0x16e)]+',\x20body:\x20'+_0x1308f1);}let _0x279c64;try{_0x279c64=JSON[_0x19b754(0x161)](_0x1308f1);}catch(_0x582183){console[_0x19b754(0x14a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x582183),loggerService_1[_0x19b754(0x16d)][_0x19b754(0x18d)](_0x19b754(0x186),_0x19b754(0x19d),_0x19b754(0x162)+_0x582183);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x1308f1);}console['log'](_0x19b754(0x188)),console[_0x19b754(0x14f)](_0x19b754(0x178),JSON[_0x19b754(0x175)](_0x279c64,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x19b754(0x186),_0x19b754(0x19d),_0x146b2e['status'],_0x279c64,_0x490d9b);if(_0x279c64['status']?.[_0x19b754(0x16e)]!==_0x19b754(0x199)){const _0x15b8a3=_0x279c64['status']?.[_0x19b754(0x195)]||_0x19b754(0x190),_0x12082b=_0x279c64[_0x19b754(0x16e)]?.['error_code']||_0x19b754(0x19c);console[_0x19b754(0x14a)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x19b754(0x14a)]('Error\x20Code:',_0x12082b),console['error'](_0x19b754(0x142),_0x15b8a3),console[_0x19b754(0x14a)]('Full\x20Error\x20Data:',_0x279c64['status']),loggerService_1[_0x19b754(0x16d)][_0x19b754(0x18d)](_0x19b754(0x186),_0x19b754(0x19d),'Business\x20Error\x20('+_0x12082b+'):\x20'+_0x15b8a3);throw new Error('Rapyd\x20API\x20error\x20('+_0x12082b+_0x19b754(0x181)+_0x15b8a3);}if(!_0x279c64[_0x19b754(0x147)]?.['id']||!_0x279c64[_0x19b754(0x147)]?.[_0x19b754(0x19a)]){console[_0x19b754(0x14a)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x19b754(0x14a)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x19b754(0x14a)]('Response\x20data:',_0x279c64['data']),loggerService_1[_0x19b754(0x16d)][_0x19b754(0x18d)]('rapyd',_0x19b754(0x19d),_0x19b754(0x1a9));throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x19b754(0x14f)](_0x19b754(0x176)),console[_0x19b754(0x14f)](_0x19b754(0x192),_0x279c64[_0x19b754(0x147)]['id']),console[_0x19b754(0x14f)](_0x19b754(0x15a),_0x279c64[_0x19b754(0x147)][_0x19b754(0x19a)]),console['log'](_0x19b754(0x179)+_0x1c1c6c+_0x19b754(0x1a2)),console['log'](_0x19b754(0x180)),{'gateway_payment_id':_0x279c64[_0x19b754(0x147)]['id'],'payment_url':_0x279c64[_0x19b754(0x147)][_0x19b754(0x19a)]};}catch(_0x25c22f){console[_0x19b754(0x14a)](_0x19b754(0x17a)),console['error'](_0x19b754(0x16a),_0x25c22f),loggerService_1[_0x19b754(0x16d)][_0x19b754(0x18d)](_0x19b754(0x186),_0x19b754(0x19d),_0x25c22f);if(_0x25c22f instanceof Error){console[_0x19b754(0x14a)](_0x19b754(0x193),_0x25c22f['message']),console[_0x19b754(0x14a)](_0x19b754(0x1a0),_0x25c22f['stack']);throw new Error(_0x19b754(0x151)+_0x25c22f['message']);}throw new Error(_0x19b754(0x1aa));}}async[a46_0x4f63a9(0x1a6)](_0x48ae11){const _0x5c3082=a46_0x4f63a9,_0x402319=Date[_0x5c3082(0x153)]();try{loggerService_1[_0x5c3082(0x16d)][_0x5c3082(0x158)](_0x5c3082(0x186),'/v1/hosted/payment_links/'+_0x48ae11,_0x5c3082(0x155),{});const _0x37c4e1=await fetch(this[_0x5c3082(0x194)]+'/'+_0x48ae11,{'method':_0x5c3082(0x155),'headers':{'Content-Type':_0x5c3082(0x140),'User-Agent':_0x5c3082(0x173)}}),_0x1e26c3=Date[_0x5c3082(0x153)]()-_0x402319;if(!_0x37c4e1['ok']){const _0x33d47d=await _0x37c4e1[_0x5c3082(0x14d)]();loggerService_1[_0x5c3082(0x16d)]['logWhiteDomainResponse'](_0x5c3082(0x186),_0x5c3082(0x189)+_0x48ae11,_0x37c4e1[_0x5c3082(0x16e)],_0x33d47d,_0x1e26c3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x37c4e1[_0x5c3082(0x16e)]);}const _0x4b174a=await _0x37c4e1[_0x5c3082(0x143)]();loggerService_1['loggerService'][_0x5c3082(0x184)](_0x5c3082(0x186),_0x5c3082(0x189)+_0x48ae11,_0x37c4e1[_0x5c3082(0x16e)],_0x4b174a,_0x1e26c3);if(_0x4b174a[_0x5c3082(0x16e)]?.[_0x5c3082(0x16e)]!==_0x5c3082(0x199)){loggerService_1[_0x5c3082(0x16d)][_0x5c3082(0x18d)](_0x5c3082(0x186),'/v1/hosted/payment_links/'+_0x48ae11,_0x5c3082(0x18a)+(_0x4b174a[_0x5c3082(0x16e)]?.[_0x5c3082(0x195)]||_0x5c3082(0x17f)));throw new Error(_0x5c3082(0x18a)+(_0x4b174a[_0x5c3082(0x16e)]?.[_0x5c3082(0x195)]||_0x5c3082(0x17f)));}let _0x1ab9f7=_0x5c3082(0x148);if(_0x4b174a[_0x5c3082(0x147)]?.[_0x5c3082(0x16e)])switch(_0x4b174a['data'][_0x5c3082(0x16e)][_0x5c3082(0x160)]()){case'CLO':_0x1ab9f7=_0x5c3082(0x15e);break;case _0x5c3082(0x16c):_0x1ab9f7=_0x5c3082(0x163);break;case _0x5c3082(0x19e):_0x1ab9f7=_0x5c3082(0x159);break;case _0x5c3082(0x19f):_0x1ab9f7=_0x5c3082(0x163);break;case _0x5c3082(0x157):case _0x5c3082(0x168):default:_0x1ab9f7='PENDING';break;}return{'status':_0x1ab9f7,'amount':_0x4b174a[_0x5c3082(0x147)]?.[_0x5c3082(0x152)],'currency':_0x4b174a[_0x5c3082(0x147)]?.[_0x5c3082(0x172)]};}catch(_0x1b832b){console[_0x5c3082(0x14a)]('Rapyd\x20payment\x20verification\x20error:',_0x1b832b),loggerService_1[_0x5c3082(0x16d)][_0x5c3082(0x18d)](_0x5c3082(0x186),'/v1/hosted/payment_links/'+_0x48ae11,_0x1b832b);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x1b832b instanceof Error?_0x1b832b[_0x5c3082(0x195)]:_0x5c3082(0x17f)));}}async[a46_0x4f63a9(0x18f)](_0x303f76){const _0x2f8792=a46_0x4f63a9;console[_0x2f8792(0x14f)]('Processing\x20Rapyd\x20webhook:',_0x303f76);let _0x1f108f=_0x2f8792(0x148),_0x2da7cd;_0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x150)]&&(_0x2da7cd=_0x303f76['data']['failure_message'],console['log'](_0x2f8792(0x1a1)+_0x2da7cd));switch(_0x303f76[_0x2f8792(0x141)]?.[_0x2f8792(0x160)]()){case'PAYMENT_COMPLETED':_0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x18c)]===!![]&&_0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x16e)]===_0x2f8792(0x19b)?_0x1f108f='PAID':_0x1f108f='PENDING';break;case _0x2f8792(0x16b):_0x1f108f='FAILED';break;case _0x2f8792(0x156):_0x1f108f=_0x2f8792(0x159);break;case _0x2f8792(0x17c):_0x1f108f='FAILED';!_0x2da7cd&&_0x303f76['data']?.[_0x2f8792(0x150)]&&(_0x2da7cd=_0x303f76[_0x2f8792(0x147)][_0x2f8792(0x150)]);break;default:switch(_0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x16e)]?.[_0x2f8792(0x160)]()){case'CLO':_0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x18c)]===!![]?_0x1f108f=_0x2f8792(0x15e):_0x1f108f=_0x2f8792(0x163);break;case _0x2f8792(0x16c):_0x1f108f='FAILED';break;case _0x2f8792(0x19e):_0x1f108f=_0x2f8792(0x159);break;case _0x2f8792(0x19f):_0x1f108f=_0x2f8792(0x163);!_0x2da7cd&&_0x303f76[_0x2f8792(0x147)]?.['failure_message']&&(_0x2da7cd=_0x303f76['data'][_0x2f8792(0x150)]);break;case _0x2f8792(0x157):case'ACT':default:_0x1f108f=_0x2f8792(0x148);break;}break;}const _0x28c014={};return _0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x1a5)]?.[_0x2f8792(0x15f)]&&(_0x28c014[_0x2f8792(0x171)]=_0x303f76[_0x2f8792(0x147)]['payment_method_data'][_0x2f8792(0x15f)]),_0x303f76[_0x2f8792(0x147)]?.['payment_method_type']&&(_0x28c014[_0x2f8792(0x177)]=_0x303f76[_0x2f8792(0x147)]['payment_method_type']),_0x303f76['data']?.[_0x2f8792(0x1a8)]&&(_0x28c014[_0x2f8792(0x15b)]=_0x303f76[_0x2f8792(0x147)]['error_code']),_0x303f76[_0x2f8792(0x147)]?.['failure_code']&&(_0x28c014['failureCode']=_0x303f76[_0x2f8792(0x147)][_0x2f8792(0x149)]),console[_0x2f8792(0x14f)](_0x2f8792(0x170)+_0x1f108f+_0x2f8792(0x18e)+(_0x2da7cd||_0x2f8792(0x1a7))),{'paymentId':_0x303f76['data']?.['merchant_reference_id']||'','status':_0x1f108f,'amount':_0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x152)],'currency':_0x303f76[_0x2f8792(0x147)]?.[_0x2f8792(0x172)],'failureMessage':_0x2da7cd,'additionalInfo':_0x28c014};}}exports[a46_0x4f63a9(0x169)]=RapydService;function a46_0x83b0(){const _0x115268=['now','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','GET','PAYMENT_EXPIRED','NEW','logWhiteDomainRequest','EXPIRED','Redirect\x20URL:','errorCode','Status\x20Text:','ORDER:\x20','PAID','last4','toUpperCase','parse','JSON\x20Parse\x20Error:\x20','FAILED','37003ZDsEaq','Response\x20Time:','5VDpGhF','===\x20RAPYD\x20API\x20ERROR\x20===','ACT','RapydService','Error\x20details:','PAYMENT_CANCELED','CAN','loggerService','status','HTTP\x20Status:','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','cardLast4','currency','TesSoft\x20Payment\x20System/1.0','🇬🇧\x20Country:\x20','stringify','===\x20RAPYD\x20SUCCESS\x20===','paymentMethod','Parsed\x20Result:','🇬🇧\x20Country\x20used:\x20','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Response\x20Body:','PAYMENT_FAILED','POST','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','):\x20','505336wtiVpd','\x20(always\x20GB\x20for\x20Rapyd)','logWhiteDomainResponse','statusText','rapyd','HTTP\x20','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','/v1/hosted/payment_links/','Rapyd\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','paid','logWhiteDomainError',',\x20failureMessage=','processWebhook','Unknown\x20error\x20from\x20Rapyd\x20API','141952UlmpiE','Payment\x20Link\x20ID:','Error\x20message:','apiUrl','message','__esModule','3462849eoceex','727935JDeEgr','SUCCESS','redirect_url','CLO','UNKNOWN','/v1/hosted/payment_links','EXP','ERR','Error\x20stack:','💥\x20Rapyd\x20failure\x20message:\x20','\x20(GB\x20-\x20Britain)','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','10gAAVgi','payment_method_data','verifyPayment','none','error_code','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','1298325kOQAmK','Raw\x20Response\x20Body:','application/json','type','Error\x20Message:','json','https://tesoft.uk/gateway/rapyd/','createPaymentLink','Headers:','data','PENDING','failure_code','error','Status:','https://tesoft.uk/gateway/success.php?id=','text','274038KQXRlw','log','failure_message','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','amount'];a46_0x83b0=function(){return _0x115268;};return a46_0x83b0();}