'use strict';const a52_0xbef9ce=a52_0x4ebd;function a52_0x4ebd(_0x6e539e,_0x65a746){const _0x4ca3e6=a52_0x4ca3();return a52_0x4ebd=function(_0x4ebd16,_0xaa9b83){_0x4ebd16=_0x4ebd16-0x1f4;let _0x413d62=_0x4ca3e6[_0x4ebd16];return _0x413d62;},a52_0x4ebd(_0x6e539e,_0x65a746);}function a52_0x4ca3(){const _0x139d81=[',\x20body:\x20','Request\x20Body\x20(Updated\x20Format):','💥\x20Rapyd\x20failure\x20message:\x20','Response\x20data:','):\x20','none','730NsRdrm','4560UjQxyI','NEW','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Headers:','Business\x20Error\x20(','\x20(always\x20GB\x20for\x20Rapyd)','833KMeTyT','message','EXPIRED','UNKNOWN','error_code','paymentMethod','PENDING','Processing\x20Rapyd\x20webhook:','HTTP\x20','fixed_side','statusText','2duJJzx','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','defineProperty','JSON\x20Parse\x20Error:\x20','logWhiteDomainRequest','203976ZVtDLe','currency','last4','Response\x20Body:','failureCode','https://tesoft.uk/gateway/rapyd/','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status\x20Text:','\x20\x20\x20fixed_side:\x20buy','/v1/hosted/payment_links/','1554310AcmATc','POST','text','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','/v1/hosted/payment_links','PAYMENT_FAILED','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Error\x20Code:','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Missing\x20id\x20or\x20redirect_url\x20in\x20response','failure_code','ORDER:\x20','URL:','Error\x20Message:','ERR','parse','PAID','toUpperCase','toISOString','application/json','processWebhook','CAN','Full\x20Error\x20Data:','apiUrl','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','failure_message','FAILED','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','redirect_url','\x20(GB\x20-\x20Britain)','GET','7578YqgosY','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','CLO','amount','PAYMENT_CANCELED','Rapyd\x20payment\x20verification\x20error:','data','payment_method_data','cardLast4','SUCCESS','loggerService','log','__esModule','createPaymentLink','logWhiteDomainError','EUR','paid','1107576sSMVvB','rapyd','Payment\x20Link\x20ID:','512xebLhH','logWhiteDomainResponse','Failed\x20to\x20parse\x20JSON\x20response:','stringify','===\x20RAPYD\x20API\x20ERROR\x20===','payment_method_type','===\x20RAPYD\x20SUCCESS\x20===','Status:','gb_mastercard_card','Error\x20details:','Rapyd\x20API\x20error:\x20','PAYMENT_COMPLETED','ACT','entries','🇬🇧\x20Country\x20used:\x20','type','Unknown\x20error','now','4352988gkrAzw','fromEntries','floor','status','11ySkMOT','🇬🇧\x20Country:\x20','Raw\x20Response\x20Body:','headers','PAYMENT_EXPIRED','error','EXP','merchant_reference_id','Unknown\x20error\x20from\x20Rapyd\x20API','Redirect\x20URL:','9996FTgrxD'];a52_0x4ca3=function(){return _0x139d81;};return a52_0x4ca3();}(function(_0x50b3af,_0x5bb37e){const _0x1a5ad3=a52_0x4ebd,_0x412f76=_0x50b3af();while(!![]){try{const _0x370e64=parseInt(_0x1a5ad3(0x21e))/0x1*(-parseInt(_0x1a5ad3(0x219))/0x2)+-parseInt(_0x1a5ad3(0x200))/0x3*(parseInt(_0x1a5ad3(0x25e))/0x4)+parseInt(_0x1a5ad3(0x228))/0x5+parseInt(_0x1a5ad3(0x25b))/0x6+parseInt(_0x1a5ad3(0x20e))/0x7*(parseInt(_0x1a5ad3(0x208))/0x8)+parseInt(_0x1a5ad3(0x24a))/0x9*(-parseInt(_0x1a5ad3(0x207))/0xa)+-parseInt(_0x1a5ad3(0x1f6))/0xb*(-parseInt(_0x1a5ad3(0x270))/0xc);if(_0x370e64===_0x5bb37e)break;else _0x412f76['push'](_0x412f76['shift']());}catch(_0x3a2d3d){_0x412f76['push'](_0x412f76['shift']());}}}(a52_0x4ca3,0x39273));Object[a52_0xbef9ce(0x21b)](exports,a52_0xbef9ce(0x256),{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x3642a2=a52_0xbef9ce;this[_0x3642a2(0x242)]=_0x3642a2(0x223),console[_0x3642a2(0x255)](_0x3642a2(0x224));}async[a52_0xbef9ce(0x257)](_0x5663ec){const _0x309f54=a52_0xbef9ce,{orderId:_0x73a9cd,orderName:_0xcad4b0,amount:_0xf94675,currency:_0x2ed51a,usage:_0x28501d,maxPayments:_0x38fbbf,successUrl:_0x39522d,failUrl:_0x401761}=_0x5663ec,_0x1e5de3=_0x2ed51a[_0x309f54(0x23c)](),_0x317736='GB';console['log'](_0x309f54(0x24b));const _0x67ceea='https://tesoft.uk/gateway/success.php?id='+_0x73a9cd,_0x608cf5='https://tesoft.uk/gateway/fail.php?id='+_0x73a9cd,_0x202483={'amount':_0xf94675,'currency':_0x1e5de3,'cancel_checkout_url':_0x608cf5,'complete_checkout_url':_0x67ceea,'complete_payment_url':_0x67ceea,'merchant_reference_id':_0x73a9cd,'description':_0x309f54(0x236)+_0x73a9cd,'country':'GB','payment_method_types_include':['gb_visa_card',_0x309f54(0x266)],'custom_elements':{'display_description':!![]}};if(_0x1e5de3!==_0x309f54(0x259)){const _0x4bedf9=Math[_0x309f54(0x1f4)](Date[_0x309f54(0x26f)]()/0x3e8)+0x1e*0x3c;_0x202483[_0x309f54(0x217)]='buy',_0x202483['requested_currency']=_0x309f54(0x259),_0x202483['expiration']=_0x4bedf9,console[_0x309f54(0x255)](_0x309f54(0x230)+_0x1e5de3+'\x20->\x20EUR:'),console[_0x309f54(0x255)](_0x309f54(0x226)),console[_0x309f54(0x255)]('\x20\x20\x20requested_currency:\x20EUR'),console['log']('\x20\x20\x20expiration:\x20'+_0x4bedf9+'\x20('+new Date(_0x4bedf9*0x3e8)[_0x309f54(0x23d)]()+')');}const _0x541166=Date[_0x309f54(0x26f)]();try{console[_0x309f54(0x255)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x309f54(0x255)](_0x309f54(0x237),this[_0x309f54(0x242)]),console[_0x309f54(0x255)](_0x309f54(0x202),JSON[_0x309f54(0x261)](_0x202483,null,0x2)),console[_0x309f54(0x255)](_0x309f54(0x1f7)+_0x317736+_0x309f54(0x20d)),console[_0x309f54(0x255)](_0x309f54(0x20a)),loggerService_1[_0x309f54(0x254)][_0x309f54(0x21d)](_0x309f54(0x25c),'/v1/hosted/payment_links',_0x309f54(0x229),_0x202483);const _0x3ffafa=await fetch(this[_0x309f54(0x242)],{'method':_0x309f54(0x229),'headers':{'Content-Type':'application/json','User-Agent':_0x309f54(0x22e)},'body':JSON['stringify'](_0x202483)}),_0x218810=Date[_0x309f54(0x26f)]()-_0x541166;console[_0x309f54(0x255)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x309f54(0x255)](_0x309f54(0x265),_0x3ffafa[_0x309f54(0x1f5)]),console[_0x309f54(0x255)](_0x309f54(0x225),_0x3ffafa[_0x309f54(0x218)]),console['log'](_0x309f54(0x20b),Object[_0x309f54(0x271)](_0x3ffafa[_0x309f54(0x1f9)][_0x309f54(0x26b)]())),console['log']('Response\x20Time:',_0x218810+'ms');const _0x370d8d=await _0x3ffafa[_0x309f54(0x22a)]();console[_0x309f54(0x255)](_0x309f54(0x1f8),_0x370d8d);if(!_0x3ffafa['ok']){console[_0x309f54(0x1fb)](_0x309f54(0x262)),console[_0x309f54(0x1fb)]('HTTP\x20Status:',_0x3ffafa[_0x309f54(0x1f5)]),console[_0x309f54(0x1fb)](_0x309f54(0x221),_0x370d8d),loggerService_1['loggerService'][_0x309f54(0x25f)]('rapyd',_0x309f54(0x22c),_0x3ffafa[_0x309f54(0x1f5)],_0x370d8d,_0x218810),loggerService_1[_0x309f54(0x254)][_0x309f54(0x258)]('rapyd',_0x309f54(0x22c),_0x309f54(0x216)+_0x3ffafa[_0x309f54(0x1f5)]+':\x20'+_0x370d8d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3ffafa[_0x309f54(0x1f5)]+_0x309f54(0x201)+_0x370d8d);}let _0xe27fe5;try{_0xe27fe5=JSON[_0x309f54(0x23a)](_0x370d8d);}catch(_0x3d884e){console[_0x309f54(0x1fb)](_0x309f54(0x260),_0x3d884e),loggerService_1['loggerService'][_0x309f54(0x258)](_0x309f54(0x25c),_0x309f54(0x22c),_0x309f54(0x21c)+_0x3d884e);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x370d8d);}console[_0x309f54(0x255)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x309f54(0x255)]('Parsed\x20Result:',JSON[_0x309f54(0x261)](_0xe27fe5,null,0x2)),loggerService_1[_0x309f54(0x254)]['logWhiteDomainResponse'](_0x309f54(0x25c),_0x309f54(0x22c),_0x3ffafa['status'],_0xe27fe5,_0x218810);if(_0xe27fe5[_0x309f54(0x1f5)]?.[_0x309f54(0x1f5)]!==_0x309f54(0x253)){const _0xbbf2fd=_0xe27fe5[_0x309f54(0x1f5)]?.[_0x309f54(0x20f)]||_0x309f54(0x1fe),_0x497f61=_0xe27fe5[_0x309f54(0x1f5)]?.[_0x309f54(0x212)]||_0x309f54(0x211);console[_0x309f54(0x1fb)](_0x309f54(0x233)),console['error'](_0x309f54(0x232),_0x497f61),console[_0x309f54(0x1fb)](_0x309f54(0x238),_0xbbf2fd),console[_0x309f54(0x1fb)](_0x309f54(0x241),_0xe27fe5[_0x309f54(0x1f5)]),loggerService_1[_0x309f54(0x254)]['logWhiteDomainError'](_0x309f54(0x25c),_0x309f54(0x22c),_0x309f54(0x20c)+_0x497f61+_0x309f54(0x205)+_0xbbf2fd);throw new Error('Rapyd\x20API\x20error\x20('+_0x497f61+_0x309f54(0x205)+_0xbbf2fd);}if(!_0xe27fe5['data']?.['id']||!_0xe27fe5[_0x309f54(0x250)]?.[_0x309f54(0x247)]){console[_0x309f54(0x1fb)](_0x309f54(0x243)),console['error'](_0x309f54(0x234)),console[_0x309f54(0x1fb)](_0x309f54(0x204),_0xe27fe5['data']),loggerService_1['loggerService'][_0x309f54(0x258)]('rapyd','/v1/hosted/payment_links','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x309f54(0x22f));}return console['log'](_0x309f54(0x264)),console[_0x309f54(0x255)](_0x309f54(0x25d),_0xe27fe5[_0x309f54(0x250)]['id']),console[_0x309f54(0x255)](_0x309f54(0x1ff),_0xe27fe5[_0x309f54(0x250)][_0x309f54(0x247)]),console[_0x309f54(0x255)](_0x309f54(0x26c)+_0x317736+_0x309f54(0x248)),console['log'](_0x309f54(0x20a)),{'gateway_payment_id':_0xe27fe5['data']['id'],'payment_url':_0xe27fe5[_0x309f54(0x250)][_0x309f54(0x247)]};}catch(_0x5e631e){console[_0x309f54(0x1fb)](_0x309f54(0x246)),console[_0x309f54(0x1fb)](_0x309f54(0x267),_0x5e631e),loggerService_1[_0x309f54(0x254)][_0x309f54(0x258)](_0x309f54(0x25c),_0x309f54(0x22c),_0x5e631e);if(_0x5e631e instanceof Error){console['error']('Error\x20message:',_0x5e631e[_0x309f54(0x20f)]),console['error']('Error\x20stack:',_0x5e631e['stack']);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x5e631e[_0x309f54(0x20f)]);}throw new Error(_0x309f54(0x21a));}}async['verifyPayment'](_0x236044){const _0x4b5ed6=a52_0xbef9ce,_0xfa5ea7=Date[_0x4b5ed6(0x26f)]();try{loggerService_1[_0x4b5ed6(0x254)]['logWhiteDomainRequest'](_0x4b5ed6(0x25c),'/v1/hosted/payment_links/'+_0x236044,_0x4b5ed6(0x249),{});const _0x29bc75=await fetch(this[_0x4b5ed6(0x242)]+'/'+_0x236044,{'method':_0x4b5ed6(0x249),'headers':{'Content-Type':_0x4b5ed6(0x23e),'User-Agent':_0x4b5ed6(0x22e)}}),_0x206358=Date[_0x4b5ed6(0x26f)]()-_0xfa5ea7;if(!_0x29bc75['ok']){const _0xdb8de2=await _0x29bc75[_0x4b5ed6(0x22a)]();loggerService_1[_0x4b5ed6(0x254)][_0x4b5ed6(0x25f)](_0x4b5ed6(0x25c),_0x4b5ed6(0x227)+_0x236044,_0x29bc75['status'],_0xdb8de2,_0x206358);throw new Error('HTTP\x20error!\x20status:\x20'+_0x29bc75[_0x4b5ed6(0x1f5)]);}const _0x53b162=await _0x29bc75['json']();loggerService_1[_0x4b5ed6(0x254)][_0x4b5ed6(0x25f)](_0x4b5ed6(0x25c),_0x4b5ed6(0x227)+_0x236044,_0x29bc75[_0x4b5ed6(0x1f5)],_0x53b162,_0x206358);if(_0x53b162['status']?.[_0x4b5ed6(0x1f5)]!==_0x4b5ed6(0x253)){loggerService_1[_0x4b5ed6(0x254)][_0x4b5ed6(0x258)](_0x4b5ed6(0x25c),_0x4b5ed6(0x227)+_0x236044,'Rapyd\x20API\x20error:\x20'+(_0x53b162[_0x4b5ed6(0x1f5)]?.['message']||_0x4b5ed6(0x26e)));throw new Error(_0x4b5ed6(0x268)+(_0x53b162[_0x4b5ed6(0x1f5)]?.[_0x4b5ed6(0x20f)]||'Unknown\x20error'));}let _0x24636b=_0x4b5ed6(0x214);if(_0x53b162[_0x4b5ed6(0x250)]?.[_0x4b5ed6(0x1f5)])switch(_0x53b162['data']['status'][_0x4b5ed6(0x23c)]()){case _0x4b5ed6(0x24c):_0x24636b='PAID';break;case _0x4b5ed6(0x240):_0x24636b=_0x4b5ed6(0x245);break;case _0x4b5ed6(0x1fc):_0x24636b=_0x4b5ed6(0x210);break;case _0x4b5ed6(0x239):_0x24636b=_0x4b5ed6(0x245);break;case _0x4b5ed6(0x209):case _0x4b5ed6(0x26a):default:_0x24636b=_0x4b5ed6(0x214);break;}return{'status':_0x24636b,'amount':_0x53b162['data']?.[_0x4b5ed6(0x24d)],'currency':_0x53b162['data']?.[_0x4b5ed6(0x21f)]};}catch(_0x17453d){console[_0x4b5ed6(0x1fb)](_0x4b5ed6(0x24f),_0x17453d),loggerService_1['loggerService'][_0x4b5ed6(0x258)](_0x4b5ed6(0x25c),_0x4b5ed6(0x227)+_0x236044,_0x17453d);throw new Error(_0x4b5ed6(0x231)+(_0x17453d instanceof Error?_0x17453d[_0x4b5ed6(0x20f)]:_0x4b5ed6(0x26e)));}}async[a52_0xbef9ce(0x23f)](_0x43495f){const _0x919a6b=a52_0xbef9ce;console[_0x919a6b(0x255)](_0x919a6b(0x215),_0x43495f);let _0x21590b=_0x919a6b(0x214),_0x2ea193;_0x43495f[_0x919a6b(0x250)]?.['failure_message']&&(_0x2ea193=_0x43495f['data']['failure_message'],console[_0x919a6b(0x255)](_0x919a6b(0x203)+_0x2ea193));switch(_0x43495f[_0x919a6b(0x26d)]?.[_0x919a6b(0x23c)]()){case _0x919a6b(0x269):_0x43495f['data']?.[_0x919a6b(0x25a)]===!![]&&_0x43495f[_0x919a6b(0x250)]?.[_0x919a6b(0x1f5)]===_0x919a6b(0x24c)?_0x21590b=_0x919a6b(0x23b):_0x21590b=_0x919a6b(0x214);break;case _0x919a6b(0x24e):_0x21590b=_0x919a6b(0x245);break;case _0x919a6b(0x1fa):_0x21590b=_0x919a6b(0x210);break;case _0x919a6b(0x22d):_0x21590b=_0x919a6b(0x245);!_0x2ea193&&_0x43495f['data']?.[_0x919a6b(0x244)]&&(_0x2ea193=_0x43495f[_0x919a6b(0x250)]['failure_message']);break;default:switch(_0x43495f['data']?.[_0x919a6b(0x1f5)]?.[_0x919a6b(0x23c)]()){case'CLO':_0x43495f[_0x919a6b(0x250)]?.[_0x919a6b(0x25a)]===!![]?_0x21590b=_0x919a6b(0x23b):_0x21590b=_0x919a6b(0x245);break;case _0x919a6b(0x240):_0x21590b='FAILED';break;case _0x919a6b(0x1fc):_0x21590b=_0x919a6b(0x210);break;case'ERR':_0x21590b=_0x919a6b(0x245);!_0x2ea193&&_0x43495f[_0x919a6b(0x250)]?.[_0x919a6b(0x244)]&&(_0x2ea193=_0x43495f[_0x919a6b(0x250)]['failure_message']);break;case _0x919a6b(0x209):case _0x919a6b(0x26a):default:_0x21590b=_0x919a6b(0x214);break;}break;}const _0x95f88={};return _0x43495f[_0x919a6b(0x250)]?.[_0x919a6b(0x251)]?.[_0x919a6b(0x220)]&&(_0x95f88[_0x919a6b(0x252)]=_0x43495f[_0x919a6b(0x250)][_0x919a6b(0x251)]['last4']),_0x43495f[_0x919a6b(0x250)]?.['payment_method_type']&&(_0x95f88[_0x919a6b(0x213)]=_0x43495f[_0x919a6b(0x250)][_0x919a6b(0x263)]),_0x43495f[_0x919a6b(0x250)]?.[_0x919a6b(0x212)]&&(_0x95f88['errorCode']=_0x43495f[_0x919a6b(0x250)]['error_code']),_0x43495f['data']?.['failure_code']&&(_0x95f88[_0x919a6b(0x222)]=_0x43495f['data'][_0x919a6b(0x235)]),console[_0x919a6b(0x255)](_0x919a6b(0x22b)+_0x21590b+',\x20failureMessage='+(_0x2ea193||_0x919a6b(0x206))),{'paymentId':_0x43495f[_0x919a6b(0x250)]?.[_0x919a6b(0x1fd)]||'','status':_0x21590b,'amount':_0x43495f[_0x919a6b(0x250)]?.[_0x919a6b(0x24d)],'currency':_0x43495f['data']?.['currency'],'failureMessage':_0x2ea193,'additionalInfo':_0x95f88};}}exports['RapydService']=RapydService;