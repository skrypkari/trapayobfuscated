'use strict';const a67_0x9b93ac=a67_0x334b;function a67_0x334b(_0x34b608,_0x3b1367){_0x34b608=_0x34b608-0x198;const _0x2093a9=a67_0x2093();let _0x334b34=_0x2093a9[_0x34b608];return _0x334b34;}function a67_0x2093(){const _0x1bed0a=['HTTP\x20error!\x20status:\x20','Unknown\x20error\x20from\x20Rapyd\x20API','logWhiteDomainResponse','RapydService','__esModule','paymentMethod','logWhiteDomainRequest','15044690yhZTlc','buy','Headers:','PAYMENT_CANCELED','Raw\x20Response\x20Body:','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','228XGiVMq','stringify','UNKNOWN','name','toUpperCase','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','error_code','\x20\x20\x20requested_currency:\x20EUR','last4','Request\x20Body\x20(Updated\x20Format):','Error\x20Message:','\x20(GB\x20-\x20Britain)','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','TESOFT\x20','paid','):\x20','currency','type','PAYMENT_COMPLETED','POST','üí•\x20Rapyd\x20failure\x20message:\x20','GET','stack','Response\x20Time:','/v1/hosted/payment_links/','loggerService','1360530JQULhX','8XfYCpJ','split','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','redirect_url','defineProperty','failure_message','log','toISOString','apiUrl','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','28ulLvft','EXPIRED','ERR',',\x20failureMessage=','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','errorCode','URL:','Unknown\x20error','FAILED','error','https://tesoft.uk/gateway/fail.php?id=','SUCCESS','102430iEsElX','logWhiteDomainError','PAYMENT_FAILED',',\x20body:\x20','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','191826qvVYLC','\x20(always\x20GB\x20for\x20Rapyd)','address','Rapyd\x20API\x20error\x20(','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','NEW','Parsed\x20Result:','application/json','createPaymentLink','json','PENDING','../loggerService','2059842FadDHg','Response\x20Body:','JSON\x20Parse\x20Error:\x20','Rapyd\x20API\x20error:\x20','\x20->\x20EUR:','Business\x20Error\x20(','email','cardholder_name','Redirect\x20URL:','https://tesoft.uk/gateway/rapyd/','Error\x20Code:','Rapyd\x20payment\x20verification\x20error:','floor','CLO','EUR','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Failed\x20to\x20parse\x20JSON\x20response:','1346544ClWKdj','ORDER:\x20','6136392oobkTZ','cardLast4','expiration','CAN','9kZIaYg','failureCode','entries','PAYMENT_EXPIRED','ACT','üí≥\x20Adding\x20cardholder\x20name:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','rapyd','===\x20RAPYD\x20API\x20ERROR\x20===','headers','Payment\x20System/1.0','33opEGMO','now','message','PAID','status','fromEntries','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','payment_method_data','payment_method_type','Processing\x20Rapyd\x20webhook:','statusText','requested_currency','https://tesoft.uk/gateway/success.php?id=','===\x20RAPYD\x20SUCCESS\x20===','failure_code','data','/v1/hosted/payment_links','Error\x20details:','merchant_reference_id','Error\x20message:','fixed_side'];a67_0x2093=function(){return _0x1bed0a;};return a67_0x2093();}(function(_0x1ecede,_0x5b26c2){const _0x2eb388=a67_0x334b,_0x36eb28=_0x1ecede();while(!![]){try{const _0x4044c9=parseInt(_0x2eb388(0x1f1))/0x1+parseInt(_0x2eb388(0x1d5))/0x2+-parseInt(_0x2eb388(0x1fd))/0x3*(-parseInt(_0x2eb388(0x1d6))/0x4)+-parseInt(_0x2eb388(0x1ec))/0x5*(parseInt(_0x2eb388(0x1bb))/0x6)+parseInt(_0x2eb388(0x1e0))/0x7*(-parseInt(_0x2eb388(0x20e))/0x8)+-parseInt(_0x2eb388(0x214))/0x9*(-parseInt(_0x2eb388(0x1b5))/0xa)+-parseInt(_0x2eb388(0x199))/0xb*(parseInt(_0x2eb388(0x210))/0xc);if(_0x4044c9===_0x5b26c2)break;else _0x36eb28['push'](_0x36eb28['shift']());}catch(_0x55e127){_0x36eb28['push'](_0x36eb28['shift']());}}}(a67_0x2093,0xba82e));Object[a67_0x9b93ac(0x1da)](exports,a67_0x9b93ac(0x1b2),{'value':!![]}),exports[a67_0x9b93ac(0x1b1)]=void 0x0;const loggerService_1=require(a67_0x9b93ac(0x1fc));class RapydService{constructor(){const _0x181dd4=a67_0x9b93ac;this['apiUrl']=_0x181dd4(0x206),console[_0x181dd4(0x1dc)](_0x181dd4(0x19f));}async[a67_0x9b93ac(0x1f9)](_0x50cb71){const _0x569153=a67_0x9b93ac,{orderId:_0x6d34a0,orderName:_0x4bc142,amount:_0x33eeb8,currency:_0xd6ec85,usage:_0x45e522,maxPayments:_0x22ec59,successUrl:_0x1adbeb,failUrl:_0xb3131c,customerName:_0x232106,customerEmail:_0x49b61c}=_0x50cb71,_0x25a4d1=_0xd6ec85['toUpperCase'](),_0x14e9f8='GB';console['log']('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x5d2174=_0x569153(0x1a5)+_0x6d34a0,_0x4ba87d=_0x569153(0x1ea)+_0x6d34a0,_0x2d1eb8={'amount':_0x33eeb8,'currency':_0x25a4d1,'payment_method_options':{'3d_required':![]},'cancel_checkout_url':_0x4ba87d,'complete_checkout_url':_0x5d2174,'complete_payment_url':_0x5d2174,'merchant_reference_id':_0x6d34a0,'description':_0x569153(0x20f)+_0x6d34a0,'statement_descriptor':_0x569153(0x1c8)+(_0x6d34a0[_0x569153(0x1d7)]('-')[0x1]||_0x6d34a0),'country':'GB','payment_method_types_include':['gb_visa_card','gb_mastercard_card'],'custom_elements':{'display_description':!![],'billing_address_collect':!![],'required_customer_fields':[_0x569153(0x1be),_0x569153(0x203),'phone_number',_0x569153(0x1f3)]}};_0x232106&&(_0x2d1eb8['custom_elements'][_0x569153(0x204)]=_0x232106,console['log'](_0x569153(0x219)+_0x232106));if(_0x25a4d1!==_0x569153(0x20b)){const _0x5e6be3=Math[_0x569153(0x209)](Date[_0x569153(0x19a)]()/0x3e8)+0x1e*0x3c;_0x2d1eb8[_0x569153(0x1ad)]=_0x569153(0x1b6),_0x2d1eb8[_0x569153(0x1a4)]=_0x569153(0x20b),_0x2d1eb8[_0x569153(0x212)]=_0x5e6be3,console['log'](_0x569153(0x1d8)+_0x25a4d1+_0x569153(0x201)),console[_0x569153(0x1dc)]('\x20\x20\x20fixed_side:\x20buy'),console['log'](_0x569153(0x1c2)),console[_0x569153(0x1dc)]('\x20\x20\x20expiration:\x20'+_0x5e6be3+'\x20('+new Date(_0x5e6be3*0x3e8)[_0x569153(0x1dd)]()+')');}const _0x22f98e=Date[_0x569153(0x19a)]();try{console[_0x569153(0x1dc)](_0x569153(0x1e4)),console[_0x569153(0x1dc)](_0x569153(0x1e6),this[_0x569153(0x1de)]),console['log'](_0x569153(0x1c4),JSON[_0x569153(0x1bc)](_0x2d1eb8,null,0x2)),console[_0x569153(0x1dc)]('üá¨üáß\x20Country:\x20'+_0x14e9f8+_0x569153(0x1f2)),console[_0x569153(0x1dc)](_0x569153(0x1ba)),loggerService_1[_0x569153(0x1d4)]['logWhiteDomainRequest'](_0x569153(0x21c),_0x569153(0x1a9),_0x569153(0x1ce),_0x2d1eb8);const _0x54ee16=await fetch(this[_0x569153(0x1de)],{'method':'POST','headers':{'Content-Type':_0x569153(0x1f8),'User-Agent':_0x569153(0x198)},'body':JSON['stringify'](_0x2d1eb8)}),_0x1ef43b=Date['now']()-_0x22f98e;console[_0x569153(0x1dc)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x569153(0x1dc)]('Status:',_0x54ee16[_0x569153(0x19d)]),console['log']('Status\x20Text:',_0x54ee16[_0x569153(0x1a3)]),console[_0x569153(0x1dc)](_0x569153(0x1b7),Object[_0x569153(0x19e)](_0x54ee16[_0x569153(0x21e)][_0x569153(0x216)]())),console[_0x569153(0x1dc)](_0x569153(0x1d2),_0x1ef43b+'ms');const _0x331a39=await _0x54ee16['text']();console[_0x569153(0x1dc)](_0x569153(0x1b9),_0x331a39);if(!_0x54ee16['ok']){console[_0x569153(0x1e9)](_0x569153(0x21d)),console[_0x569153(0x1e9)]('HTTP\x20Status:',_0x54ee16[_0x569153(0x19d)]),console[_0x569153(0x1e9)](_0x569153(0x1fe),_0x331a39),loggerService_1['loggerService'][_0x569153(0x1b0)](_0x569153(0x21c),_0x569153(0x1a9),_0x54ee16[_0x569153(0x19d)],_0x331a39,_0x1ef43b),loggerService_1[_0x569153(0x1d4)][_0x569153(0x1ed)](_0x569153(0x21c),_0x569153(0x1a9),'HTTP\x20'+_0x54ee16[_0x569153(0x19d)]+':\x20'+_0x331a39);throw new Error(_0x569153(0x1ae)+_0x54ee16['status']+_0x569153(0x1ef)+_0x331a39);}let _0x2c4609;try{_0x2c4609=JSON['parse'](_0x331a39);}catch(_0x50572f){console['error'](_0x569153(0x20d),_0x50572f),loggerService_1[_0x569153(0x1d4)][_0x569153(0x1ed)](_0x569153(0x21c),_0x569153(0x1a9),_0x569153(0x1ff)+_0x50572f);throw new Error(_0x569153(0x1c7)+_0x331a39);}console['log'](_0x569153(0x1f0)),console[_0x569153(0x1dc)](_0x569153(0x1f7),JSON[_0x569153(0x1bc)](_0x2c4609,null,0x2)),loggerService_1[_0x569153(0x1d4)]['logWhiteDomainResponse'](_0x569153(0x21c),_0x569153(0x1a9),_0x54ee16['status'],_0x2c4609,_0x1ef43b);if(_0x2c4609[_0x569153(0x19d)]?.[_0x569153(0x19d)]!==_0x569153(0x1eb)){const _0x102ff6=_0x2c4609['status']?.['message']||_0x569153(0x1af),_0x4fe078=_0x2c4609[_0x569153(0x19d)]?.[_0x569153(0x1c1)]||_0x569153(0x1bd);console[_0x569153(0x1e9)](_0x569153(0x1df)),console['error'](_0x569153(0x207),_0x4fe078),console['error'](_0x569153(0x1c5),_0x102ff6),console[_0x569153(0x1e9)]('Full\x20Error\x20Data:',_0x2c4609[_0x569153(0x19d)]),loggerService_1[_0x569153(0x1d4)][_0x569153(0x1ed)](_0x569153(0x21c),_0x569153(0x1a9),_0x569153(0x202)+_0x4fe078+_0x569153(0x1ca)+_0x102ff6);throw new Error(_0x569153(0x1f4)+_0x4fe078+_0x569153(0x1ca)+_0x102ff6);}if(!_0x2c4609['data']?.['id']||!_0x2c4609[_0x569153(0x1a8)]?.[_0x569153(0x1d9)]){console[_0x569153(0x1e9)](_0x569153(0x21b)),console[_0x569153(0x1e9)](_0x569153(0x20c)),console[_0x569153(0x1e9)]('Response\x20data:',_0x2c4609[_0x569153(0x1a8)]),loggerService_1['loggerService'][_0x569153(0x1ed)](_0x569153(0x21c),'/v1/hosted/payment_links',_0x569153(0x1f5));throw new Error(_0x569153(0x1c0));}return console['log'](_0x569153(0x1a6)),console[_0x569153(0x1dc)]('Payment\x20Link\x20ID:',_0x2c4609['data']['id']),console[_0x569153(0x1dc)](_0x569153(0x205),_0x2c4609[_0x569153(0x1a8)][_0x569153(0x1d9)]),console[_0x569153(0x1dc)]('üá¨üáß\x20Country\x20used:\x20'+_0x14e9f8+_0x569153(0x1c6)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x2c4609[_0x569153(0x1a8)]['id'],'payment_url':_0x2c4609['data'][_0x569153(0x1d9)]};}catch(_0x442e22){console['error']('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x569153(0x1e9)](_0x569153(0x1aa),_0x442e22),loggerService_1['loggerService'][_0x569153(0x1ed)]('rapyd','/v1/hosted/payment_links',_0x442e22);if(_0x442e22 instanceof Error){console[_0x569153(0x1e9)](_0x569153(0x1ac),_0x442e22[_0x569153(0x19b)]),console[_0x569153(0x1e9)]('Error\x20stack:',_0x442e22[_0x569153(0x1d1)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x442e22[_0x569153(0x19b)]);}throw new Error(_0x569153(0x21a));}}async['verifyPayment'](_0x29a1b5){const _0x3f146c=a67_0x9b93ac,_0x5833b7=Date[_0x3f146c(0x19a)]();try{loggerService_1[_0x3f146c(0x1d4)][_0x3f146c(0x1b4)](_0x3f146c(0x21c),_0x3f146c(0x1d3)+_0x29a1b5,'GET',{});const _0x1b3cd8=await fetch(this[_0x3f146c(0x1de)]+'/'+_0x29a1b5,{'method':_0x3f146c(0x1d0),'headers':{'Content-Type':_0x3f146c(0x1f8),'User-Agent':_0x3f146c(0x198)}}),_0x16ea3a=Date[_0x3f146c(0x19a)]()-_0x5833b7;if(!_0x1b3cd8['ok']){const _0x276abe=await _0x1b3cd8['text']();loggerService_1[_0x3f146c(0x1d4)][_0x3f146c(0x1b0)]('rapyd',_0x3f146c(0x1d3)+_0x29a1b5,_0x1b3cd8[_0x3f146c(0x19d)],_0x276abe,_0x16ea3a);throw new Error(_0x3f146c(0x1ae)+_0x1b3cd8[_0x3f146c(0x19d)]);}const _0x165ecf=await _0x1b3cd8[_0x3f146c(0x1fa)]();loggerService_1[_0x3f146c(0x1d4)][_0x3f146c(0x1b0)](_0x3f146c(0x21c),'/v1/hosted/payment_links/'+_0x29a1b5,_0x1b3cd8[_0x3f146c(0x19d)],_0x165ecf,_0x16ea3a);if(_0x165ecf['status']?.[_0x3f146c(0x19d)]!==_0x3f146c(0x1eb)){loggerService_1[_0x3f146c(0x1d4)]['logWhiteDomainError'](_0x3f146c(0x21c),'/v1/hosted/payment_links/'+_0x29a1b5,_0x3f146c(0x200)+(_0x165ecf[_0x3f146c(0x19d)]?.[_0x3f146c(0x19b)]||_0x3f146c(0x1e7)));throw new Error(_0x3f146c(0x200)+(_0x165ecf[_0x3f146c(0x19d)]?.['message']||_0x3f146c(0x1e7)));}let _0x5d0623='PENDING';if(_0x165ecf['data']?.['status'])switch(_0x165ecf[_0x3f146c(0x1a8)]['status'][_0x3f146c(0x1bf)]()){case _0x3f146c(0x20a):_0x5d0623=_0x3f146c(0x19c);break;case _0x3f146c(0x213):_0x5d0623=_0x3f146c(0x1e8);break;case'EXP':_0x5d0623='EXPIRED';break;case _0x3f146c(0x1e2):_0x5d0623='FAILED';break;case'NEW':case _0x3f146c(0x218):default:_0x5d0623='PENDING';break;}return{'status':_0x5d0623,'amount':_0x165ecf[_0x3f146c(0x1a8)]?.['amount'],'currency':_0x165ecf[_0x3f146c(0x1a8)]?.['currency']};}catch(_0x43051a){console[_0x3f146c(0x1e9)](_0x3f146c(0x208),_0x43051a),loggerService_1[_0x3f146c(0x1d4)]['logWhiteDomainError'](_0x3f146c(0x21c),_0x3f146c(0x1d3)+_0x29a1b5,_0x43051a);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x43051a instanceof Error?_0x43051a[_0x3f146c(0x19b)]:'Unknown\x20error'));}}async['processWebhook'](_0x2a334e){const _0x599dbf=a67_0x9b93ac;console['log'](_0x599dbf(0x1a2),_0x2a334e);let _0x1165b0=_0x599dbf(0x1fb),_0x2c9269;_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x1db)]&&(_0x2c9269=_0x2a334e['data'][_0x599dbf(0x1db)],console[_0x599dbf(0x1dc)](_0x599dbf(0x1cf)+_0x2c9269));switch(_0x2a334e[_0x599dbf(0x1cc)]?.[_0x599dbf(0x1bf)]()){case _0x599dbf(0x1cd):_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x1c9)]===!![]&&_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x19d)]==='CLO'?_0x1165b0=_0x599dbf(0x19c):_0x1165b0=_0x599dbf(0x1fb);break;case _0x599dbf(0x1b8):_0x1165b0=_0x599dbf(0x1e8);break;case _0x599dbf(0x217):_0x1165b0='EXPIRED';break;case _0x599dbf(0x1ee):_0x1165b0=_0x599dbf(0x1e8);!_0x2c9269&&_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x1db)]&&(_0x2c9269=_0x2a334e[_0x599dbf(0x1a8)]['failure_message']);break;default:switch(_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x19d)]?.[_0x599dbf(0x1bf)]()){case'CLO':_0x2a334e[_0x599dbf(0x1a8)]?.['paid']===!![]?_0x1165b0='PAID':_0x1165b0=_0x599dbf(0x1e8);break;case _0x599dbf(0x213):_0x1165b0=_0x599dbf(0x1e8);break;case'EXP':_0x1165b0=_0x599dbf(0x1e1);break;case _0x599dbf(0x1e2):_0x1165b0=_0x599dbf(0x1e8);!_0x2c9269&&_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x1db)]&&(_0x2c9269=_0x2a334e[_0x599dbf(0x1a8)]['failure_message']);break;case _0x599dbf(0x1f6):case _0x599dbf(0x218):default:_0x1165b0=_0x599dbf(0x1fb);break;}break;}const _0xd714d1={};return _0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x1a0)]?.[_0x599dbf(0x1c3)]&&(_0xd714d1[_0x599dbf(0x211)]=_0x2a334e[_0x599dbf(0x1a8)]['payment_method_data']['last4']),_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x1a1)]&&(_0xd714d1[_0x599dbf(0x1b3)]=_0x2a334e['data'][_0x599dbf(0x1a1)]),_0x2a334e[_0x599dbf(0x1a8)]?.['error_code']&&(_0xd714d1[_0x599dbf(0x1e5)]=_0x2a334e[_0x599dbf(0x1a8)][_0x599dbf(0x1c1)]),_0x2a334e[_0x599dbf(0x1a8)]?.['failure_code']&&(_0xd714d1[_0x599dbf(0x215)]=_0x2a334e[_0x599dbf(0x1a8)][_0x599dbf(0x1a7)]),console[_0x599dbf(0x1dc)]('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x1165b0+_0x599dbf(0x1e3)+(_0x2c9269||'none')),{'paymentId':_0x2a334e[_0x599dbf(0x1a8)]?.[_0x599dbf(0x1ab)]||'','status':_0x1165b0,'amount':_0x2a334e[_0x599dbf(0x1a8)]?.['amount'],'currency':_0x2a334e['data']?.[_0x599dbf(0x1cb)],'failureMessage':_0x2c9269,'additionalInfo':_0xd714d1};}}exports[a67_0x9b93ac(0x1b1)]=RapydService;