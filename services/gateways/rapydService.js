'use strict';function a46_0x4285(_0x15efe5,_0x2e4f09){const _0x3b5779=a46_0x3b57();return a46_0x4285=function(_0x4285f3,_0x4c1092){_0x4285f3=_0x4285f3-0xa0;let _0x27bb11=_0x3b5779[_0x4285f3];return _0x27bb11;},a46_0x4285(_0x15efe5,_0x2e4f09);}function a46_0x3b57(){const _0x240c5a=['stack','apiUrl','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','241189pSrSoi','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','PAYMENT_CANCELED','Error\x20message:','errorCode','15948rrnNjK','Error\x20details:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','none','Rapyd\x20API\x20error:\x20','statusText','https://tesoft.uk/gateway/fail.php?id=',',\x20body:\x20','TesSoft\x20Payment\x20System/1.0','UNKNOWN','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','processWebhook','\x20(always\x20GB\x20for\x20Rapyd)','failureCode','log','stringify','error_code','52976emcuAm','NEW','179274fIBCEq','entries','HTTP\x20error!\x20status:\x20','status','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','\x20(GB\x20-\x20Britain)','Error\x20stack:','CAN','logWhiteDomainRequest','https://tesoft.uk/gateway/rapyd/','3456153jRsUEu','/v1/hosted/payment_links/','üá¨üáß\x20Country\x20used:\x20','üí•\x20Rapyd\x20failure\x20message:\x20','POST','payment_method_data','logWhiteDomainError','ERR','loggerService','error','__esModule','gb_visa_card','rapyd','PAYMENT_COMPLETED','7381zNEHFk','ORDER:\x20','CLO','Status\x20Text:','JSON\x20Parse\x20Error:\x20','text','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Response\x20Body:','paymentMethod','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','now','Unknown\x20error\x20from\x20Rapyd\x20API','65BjozWO','Response\x20Time:','SUCCESS','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','/v1/hosted/payment_links','===\x20RAPYD\x20API\x20ERROR\x20===','Status:','defineProperty','Unknown\x20error','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','135800zjOvzM','redirect_url','failure_message','cardLast4','üá¨üáß\x20Country:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','PAID','currency','PAYMENT_FAILED','PAYMENT_EXPIRED','===\x20RAPYD\x20SUCCESS\x20===','RapydService','Parsed\x20Result:','PENDING','verifyPayment','data','fromEntries','application/json','parse','10neCanC','merchant_reference_id','Failed\x20to\x20parse\x20JSON\x20response:','GET','logWhiteDomainResponse','gb_mastercard_card','FAILED','1108429hYLtTA','last4','paid','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Headers:','EXP','Full\x20Error\x20Data:','failure_code','Error\x20Code:','ACT','message','HTTP\x20Status:','Missing\x20id\x20or\x20redirect_url\x20in\x20response','135QhDJVg','2Tiybsq','payment_method_type','type','toUpperCase','Rapyd\x20API\x20error\x20(','Request\x20Body\x20(Updated\x20Format):','Error\x20Message:','EXPIRED','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'];a46_0x3b57=function(){return _0x240c5a;};return a46_0x3b57();}const a46_0x3ea953=a46_0x4285;(function(_0x549da7,_0x17474a){const _0x2b1385=a46_0x4285,_0x3fbde6=_0x549da7();while(!![]){try{const _0x1a0bfa=parseInt(_0x2b1385(0x11b))/0x1*(parseInt(_0x2b1385(0x10d))/0x2)+parseInt(_0x2b1385(0x10c))/0x3*(-parseInt(_0x2b1385(0xb5))/0x4)+parseInt(_0x2b1385(0xdb))/0x5*(-parseInt(_0x2b1385(0xb7))/0x6)+-parseInt(_0x2b1385(0xff))/0x7+parseInt(_0x2b1385(0xe5))/0x8+parseInt(_0x2b1385(0xc1))/0x9*(parseInt(_0x2b1385(0xf8))/0xa)+-parseInt(_0x2b1385(0xcf))/0xb*(-parseInt(_0x2b1385(0xa4))/0xc);if(_0x1a0bfa===_0x17474a)break;else _0x3fbde6['push'](_0x3fbde6['shift']());}catch(_0x1add50){_0x3fbde6['push'](_0x3fbde6['shift']());}}}(a46_0x3b57,0x5f812));Object[a46_0x3ea953(0xe2)](exports,a46_0x3ea953(0xcb),{'value':!![]}),exports[a46_0x3ea953(0xf0)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x5aad4a=a46_0x3ea953;this['apiUrl']=_0x5aad4a(0xc0),console[_0x5aad4a(0xb2)](_0x5aad4a(0x117));}async['createPaymentLink'](_0x4071f8){const _0x145618=a46_0x3ea953,{orderId:_0x4fe983,orderName:_0x2e5b30,amount:_0xc013a,currency:_0x5c4158,usage:_0xac4560,maxPayments:_0x29e451,successUrl:_0x56dcf2,failUrl:_0x2ea91f}=_0x4071f8,_0x1fcd66=_0x5c4158[_0x145618(0x110)](),_0x167214='GB';console[_0x145618(0xb2)](_0x145618(0x102));const _0x5f14ab='https://tesoft.uk/gateway/success.php?id='+_0x4fe983,_0x1e3248=_0x145618(0xaa)+_0x4fe983,_0x5f041b={'amount':_0xc013a,'currency':_0x1fcd66,'cancel_checkout_url':_0x1e3248,'complete_checkout_url':_0x5f14ab,'complete_payment_url':_0x5f14ab,'merchant_reference_id':_0x4fe983,'description':_0x145618(0xd0)+_0x4fe983,'country':'GB','payment_method_types_include':[_0x145618(0xcc),_0x145618(0xfd)],'custom_elements':{'display_description':!![]}},_0x5ae7e2=Date[_0x145618(0xd9)]();try{console[_0x145618(0xb2)](_0x145618(0xa6)),console[_0x145618(0xb2)]('URL:',this[_0x145618(0x119)]),console[_0x145618(0xb2)](_0x145618(0x112),JSON[_0x145618(0xb3)](_0x5f041b,null,0x2)),console['log'](_0x145618(0xe9)+_0x167214+_0x145618(0xb0)),console[_0x145618(0xb2)](_0x145618(0xa0)),loggerService_1[_0x145618(0xc9)][_0x145618(0xbf)](_0x145618(0xcd),_0x145618(0xdf),_0x145618(0xc5),_0x5f041b);const _0x5805f6=await fetch(this[_0x145618(0x119)],{'method':'POST','headers':{'Content-Type':_0x145618(0xf6),'User-Agent':_0x145618(0xac)},'body':JSON[_0x145618(0xb3)](_0x5f041b)}),_0x4b6f9f=Date['now']()-_0x5ae7e2;console['log'](_0x145618(0xd5)),console['log'](_0x145618(0xe1),_0x5805f6[_0x145618(0xba)]),console['log'](_0x145618(0xd2),_0x5805f6[_0x145618(0xa9)]),console[_0x145618(0xb2)](_0x145618(0x103),Object[_0x145618(0xf5)](_0x5805f6['headers'][_0x145618(0xb8)]())),console[_0x145618(0xb2)](_0x145618(0xdc),_0x4b6f9f+'ms');const _0x55060d=await _0x5805f6[_0x145618(0xd4)]();console[_0x145618(0xb2)]('Raw\x20Response\x20Body:',_0x55060d);if(!_0x5805f6['ok']){console[_0x145618(0xca)](_0x145618(0xe0)),console['error'](_0x145618(0x10a),_0x5805f6[_0x145618(0xba)]),console[_0x145618(0xca)](_0x145618(0xd6),_0x55060d),loggerService_1[_0x145618(0xc9)][_0x145618(0xfc)](_0x145618(0xcd),_0x145618(0xdf),_0x5805f6[_0x145618(0xba)],_0x55060d,_0x4b6f9f),loggerService_1[_0x145618(0xc9)]['logWhiteDomainError'](_0x145618(0xcd),'/v1/hosted/payment_links','HTTP\x20'+_0x5805f6[_0x145618(0xba)]+':\x20'+_0x55060d);throw new Error(_0x145618(0xb9)+_0x5805f6[_0x145618(0xba)]+_0x145618(0xab)+_0x55060d);}let _0x154bd0;try{_0x154bd0=JSON[_0x145618(0xf7)](_0x55060d);}catch(_0x4bb5c6){console['error'](_0x145618(0xfa),_0x4bb5c6),loggerService_1[_0x145618(0xc9)]['logWhiteDomainError'](_0x145618(0xcd),_0x145618(0xdf),_0x145618(0xd3)+_0x4bb5c6);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x55060d);}console['log'](_0x145618(0x11a)),console[_0x145618(0xb2)](_0x145618(0xf1),JSON['stringify'](_0x154bd0,null,0x2)),loggerService_1[_0x145618(0xc9)][_0x145618(0xfc)]('rapyd',_0x145618(0xdf),_0x5805f6[_0x145618(0xba)],_0x154bd0,_0x4b6f9f);if(_0x154bd0['status']?.[_0x145618(0xba)]!==_0x145618(0xdd)){const _0x283f19=_0x154bd0['status']?.[_0x145618(0x109)]||_0x145618(0xda),_0x91a54=_0x154bd0[_0x145618(0xba)]?.[_0x145618(0xb4)]||_0x145618(0xad);console[_0x145618(0xca)](_0x145618(0x115)),console[_0x145618(0xca)](_0x145618(0x107),_0x91a54),console[_0x145618(0xca)](_0x145618(0x113),_0x283f19),console[_0x145618(0xca)](_0x145618(0x105),_0x154bd0[_0x145618(0xba)]),loggerService_1['loggerService'][_0x145618(0xc7)](_0x145618(0xcd),_0x145618(0xdf),'Business\x20Error\x20('+_0x91a54+'):\x20'+_0x283f19);throw new Error(_0x145618(0x111)+_0x91a54+'):\x20'+_0x283f19);}if(!_0x154bd0[_0x145618(0xf4)]?.['id']||!_0x154bd0['data']?.[_0x145618(0xe6)]){console['error'](_0x145618(0xbb)),console[_0x145618(0xca)](_0x145618(0x10b)),console[_0x145618(0xca)]('Response\x20data:',_0x154bd0[_0x145618(0xf4)]),loggerService_1[_0x145618(0xc9)][_0x145618(0xc7)](_0x145618(0xcd),_0x145618(0xdf),_0x145618(0xe4));throw new Error(_0x145618(0xde));}return console[_0x145618(0xb2)](_0x145618(0xef)),console[_0x145618(0xb2)]('Payment\x20Link\x20ID:',_0x154bd0[_0x145618(0xf4)]['id']),console[_0x145618(0xb2)]('Redirect\x20URL:',_0x154bd0[_0x145618(0xf4)][_0x145618(0xe6)]),console[_0x145618(0xb2)](_0x145618(0xc3)+_0x167214+_0x145618(0xbc)),console[_0x145618(0xb2)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x154bd0['data']['id'],'payment_url':_0x154bd0[_0x145618(0xf4)][_0x145618(0xe6)]};}catch(_0x50763a){console[_0x145618(0xca)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x145618(0xca)](_0x145618(0xa5),_0x50763a),loggerService_1[_0x145618(0xc9)]['logWhiteDomainError'](_0x145618(0xcd),_0x145618(0xdf),_0x50763a);if(_0x50763a instanceof Error){console[_0x145618(0xca)](_0x145618(0xa2),_0x50763a[_0x145618(0x109)]),console['error'](_0x145618(0xbd),_0x50763a[_0x145618(0x118)]);throw new Error(_0x145618(0xea)+_0x50763a[_0x145618(0x109)]);}throw new Error(_0x145618(0x116));}}async[a46_0x3ea953(0xf3)](_0x3048aa){const _0x22953e=a46_0x3ea953,_0x41a759=Date[_0x22953e(0xd9)]();try{loggerService_1[_0x22953e(0xc9)][_0x22953e(0xbf)](_0x22953e(0xcd),'/v1/hosted/payment_links/'+_0x3048aa,_0x22953e(0xfb),{});const _0x2cfb1e=await fetch(this[_0x22953e(0x119)]+'/'+_0x3048aa,{'method':_0x22953e(0xfb),'headers':{'Content-Type':_0x22953e(0xf6),'User-Agent':_0x22953e(0xac)}}),_0x41ad0d=Date[_0x22953e(0xd9)]()-_0x41a759;if(!_0x2cfb1e['ok']){const _0x3c4bc4=await _0x2cfb1e[_0x22953e(0xd4)]();loggerService_1['loggerService'][_0x22953e(0xfc)](_0x22953e(0xcd),_0x22953e(0xc2)+_0x3048aa,_0x2cfb1e[_0x22953e(0xba)],_0x3c4bc4,_0x41ad0d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2cfb1e[_0x22953e(0xba)]);}const _0x36736e=await _0x2cfb1e['json']();loggerService_1['loggerService'][_0x22953e(0xfc)](_0x22953e(0xcd),_0x22953e(0xc2)+_0x3048aa,_0x2cfb1e[_0x22953e(0xba)],_0x36736e,_0x41ad0d);if(_0x36736e['status']?.[_0x22953e(0xba)]!==_0x22953e(0xdd)){loggerService_1['loggerService'][_0x22953e(0xc7)](_0x22953e(0xcd),_0x22953e(0xc2)+_0x3048aa,_0x22953e(0xa8)+(_0x36736e[_0x22953e(0xba)]?.['message']||'Unknown\x20error'));throw new Error(_0x22953e(0xa8)+(_0x36736e[_0x22953e(0xba)]?.[_0x22953e(0x109)]||_0x22953e(0xe3)));}let _0x2accbd='PENDING';if(_0x36736e[_0x22953e(0xf4)]?.[_0x22953e(0xba)])switch(_0x36736e['data'][_0x22953e(0xba)][_0x22953e(0x110)]()){case _0x22953e(0xd1):_0x2accbd=_0x22953e(0xeb);break;case _0x22953e(0xbe):_0x2accbd='FAILED';break;case _0x22953e(0x104):_0x2accbd=_0x22953e(0x114);break;case _0x22953e(0xc8):_0x2accbd='FAILED';break;case _0x22953e(0xb6):case _0x22953e(0x108):default:_0x2accbd=_0x22953e(0xf2);break;}return{'status':_0x2accbd,'amount':_0x36736e[_0x22953e(0xf4)]?.['amount'],'currency':_0x36736e[_0x22953e(0xf4)]?.[_0x22953e(0xec)]};}catch(_0x5b6591){console[_0x22953e(0xca)]('Rapyd\x20payment\x20verification\x20error:',_0x5b6591),loggerService_1[_0x22953e(0xc9)]['logWhiteDomainError']('rapyd','/v1/hosted/payment_links/'+_0x3048aa,_0x5b6591);throw new Error(_0x22953e(0xd8)+(_0x5b6591 instanceof Error?_0x5b6591[_0x22953e(0x109)]:_0x22953e(0xe3)));}}async[a46_0x3ea953(0xaf)](_0x266853){const _0x190c05=a46_0x3ea953;console[_0x190c05(0xb2)]('Processing\x20Rapyd\x20webhook:',_0x266853);let _0x5e140c=_0x190c05(0xf2),_0x4932ed;_0x266853[_0x190c05(0xf4)]?.[_0x190c05(0xe7)]&&(_0x4932ed=_0x266853[_0x190c05(0xf4)][_0x190c05(0xe7)],console[_0x190c05(0xb2)](_0x190c05(0xc4)+_0x4932ed));switch(_0x266853[_0x190c05(0x10f)]?.[_0x190c05(0x110)]()){case _0x190c05(0xce):_0x266853[_0x190c05(0xf4)]?.['paid']===!![]&&_0x266853['data']?.[_0x190c05(0xba)]===_0x190c05(0xd1)?_0x5e140c='PAID':_0x5e140c=_0x190c05(0xf2);break;case _0x190c05(0xa1):_0x5e140c=_0x190c05(0xfe);break;case _0x190c05(0xee):_0x5e140c=_0x190c05(0x114);break;case _0x190c05(0xed):_0x5e140c=_0x190c05(0xfe);!_0x4932ed&&_0x266853[_0x190c05(0xf4)]?.['failure_message']&&(_0x4932ed=_0x266853[_0x190c05(0xf4)][_0x190c05(0xe7)]);break;default:switch(_0x266853[_0x190c05(0xf4)]?.[_0x190c05(0xba)]?.[_0x190c05(0x110)]()){case _0x190c05(0xd1):_0x266853['data']?.[_0x190c05(0x101)]===!![]?_0x5e140c=_0x190c05(0xeb):_0x5e140c=_0x190c05(0xfe);break;case _0x190c05(0xbe):_0x5e140c=_0x190c05(0xfe);break;case'EXP':_0x5e140c='EXPIRED';break;case _0x190c05(0xc8):_0x5e140c=_0x190c05(0xfe);!_0x4932ed&&_0x266853['data']?.[_0x190c05(0xe7)]&&(_0x4932ed=_0x266853[_0x190c05(0xf4)][_0x190c05(0xe7)]);break;case _0x190c05(0xb6):case _0x190c05(0x108):default:_0x5e140c=_0x190c05(0xf2);break;}break;}const _0x3c7306={};return _0x266853['data']?.[_0x190c05(0xc6)]?.['last4']&&(_0x3c7306[_0x190c05(0xe8)]=_0x266853[_0x190c05(0xf4)][_0x190c05(0xc6)][_0x190c05(0x100)]),_0x266853['data']?.[_0x190c05(0x10e)]&&(_0x3c7306[_0x190c05(0xd7)]=_0x266853[_0x190c05(0xf4)][_0x190c05(0x10e)]),_0x266853['data']?.['error_code']&&(_0x3c7306[_0x190c05(0xa3)]=_0x266853[_0x190c05(0xf4)][_0x190c05(0xb4)]),_0x266853[_0x190c05(0xf4)]?.[_0x190c05(0x106)]&&(_0x3c7306[_0x190c05(0xb1)]=_0x266853[_0x190c05(0xf4)]['failure_code']),console['log'](_0x190c05(0xae)+_0x5e140c+',\x20failureMessage='+(_0x4932ed||_0x190c05(0xa7))),{'paymentId':_0x266853[_0x190c05(0xf4)]?.[_0x190c05(0xf9)]||'','status':_0x5e140c,'amount':_0x266853[_0x190c05(0xf4)]?.['amount'],'currency':_0x266853[_0x190c05(0xf4)]?.['currency'],'failureMessage':_0x4932ed,'additionalInfo':_0x3c7306};}}exports[a46_0x3ea953(0xf0)]=RapydService;