'use strict';function a42_0x871c(){const _0x526678=['currency','logWhiteDomainResponse','===\x20RAPYD\x20API\x20ERROR\x20===','Parsed\x20Result:','/v1/hosted/payment_links','loggerService','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','SUCCESS','Response\x20Time:','PAYMENT_CANCELED','URL:','stack','error_code','284052GPkjaL','requested_currency','verifyPayment','redirect_url',',\x20body:\x20','Missing\x20id\x20or\x20redirect_url\x20in\x20response','6gdymfW','ERR','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','1282150RKooyO','Unknown\x20error','createPaymentLink','15231240mzgOhe','Failed\x20to\x20parse\x20JSON\x20response:','rapyd','Status:','json','status','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','headers','CLO','EXPIRED','Error\x20Message:','Rapyd\x20API\x20error\x20(','Response\x20data:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Redirect\x20URL:','üá¨üáß\x20Country:\x20','Rapyd\x20API\x20error:\x20','logWhiteDomainRequest','https://tesoft.uk/gateway/success.php?id=','Error\x20message:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','stringify','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','data','6980970PRcvzi','entries','parse','HTTP\x20error!\x20status:\x20','PAID','Status\x20Text:','apiUrl','RapydService','192EYsoUI','now','Rapyd\x20payment\x20verification\x20error:','log','UNKNOWN','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','https://tesoft.uk/gateway/fail.php?id=','toUpperCase','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','message','https://tesoft.uk/gateway/rapyd/','Unknown\x20error\x20from\x20Rapyd\x20API','paid','PENDING','ACT','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','/v1/hosted/payment_links/','TesSoft\x20Payment\x20System/1.0','4475808pTKlXJ','EXP','GET','processWebhook','error','Payment\x20Link\x20ID:','PAYMENT_EXPIRED','Headers:','gb_visa_card','JSON\x20Parse\x20Error:\x20','11zhWgsH','Business\x20Error\x20(','defineProperty','):\x20','===\x20RAPYD\x20SUCCESS\x20===','70yXVIUX','PAYMENT_FAILED','491209bfGCWn','HTTP\x20','__esModule','201698xvQvrU','merchant_reference_id','Full\x20Error\x20Data:','CAN','Raw\x20Response\x20Body:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','logWhiteDomainError','application/json','EUR','Response\x20Body:','FAILED','NEW'];a42_0x871c=function(){return _0x526678;};return a42_0x871c();}const a42_0x438084=a42_0x5cda;(function(_0x170895,_0x27b5c4){const _0x3dcce6=a42_0x5cda,_0x1808f5=_0x170895();while(!![]){try{const _0xacd01=parseInt(_0x3dcce6(0x216))/0x1+-parseInt(_0x3dcce6(0x23b))/0x2*(parseInt(_0x3dcce6(0x238))/0x3)+-parseInt(_0x3dcce6(0x232))/0x4*(-parseInt(_0x3dcce6(0x214))/0x5)+-parseInt(_0x3dcce6(0x25e))/0x6*(parseInt(_0x3dcce6(0x219))/0x7)+parseInt(_0x3dcce6(0x23e))/0x8+parseInt(_0x3dcce6(0x205))/0x9+parseInt(_0x3dcce6(0x256))/0xa*(-parseInt(_0x3dcce6(0x20f))/0xb);if(_0xacd01===_0x27b5c4)break;else _0x1808f5['push'](_0x1808f5['shift']());}catch(_0x2fd5a9){_0x1808f5['push'](_0x1808f5['shift']());}}}(a42_0x871c,0xf04f9));Object[a42_0x438084(0x211)](exports,a42_0x438084(0x218),{'value':!![]}),exports[a42_0x438084(0x25d)]=void 0x0;const loggerService_1=require('../loggerService');function a42_0x5cda(_0x1a861a,_0x4fce85){const _0x871c06=a42_0x871c();return a42_0x5cda=function(_0x5cda9f,_0x1180ee){_0x5cda9f=_0x5cda9f-0x1f3;let _0x2d135f=_0x871c06[_0x5cda9f];return _0x2d135f;},a42_0x5cda(_0x1a861a,_0x4fce85);}class RapydService{constructor(){const _0x5af36c=a42_0x438084;this[_0x5af36c(0x25c)]=_0x5af36c(0x1fd),console[_0x5af36c(0x1f4)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a42_0x438084(0x23d)](_0x40d0fd){const _0x4e2748=a42_0x438084,{orderId:_0x32bd44,orderName:_0x335efb,amount:_0x3280f7,currency:_0x23f3d9,usage:_0x44f0c8,maxPayments:_0x4aee81,successUrl:_0x6b8e03,failUrl:_0x21a736}=_0x40d0fd,_0x2d32de=_0x23f3d9['toUpperCase'](),_0x3f889d='GB';console[_0x4e2748(0x1f4)](_0x4e2748(0x254));const _0x3e7788=_0x4e2748(0x250)+_0x32bd44,_0x428b6f=_0x4e2748(0x1f8)+_0x32bd44,_0x4e9a8c={'amount':_0x3280f7,'currency':_0x2d32de,'cancel_checkout_url':_0x428b6f,'complete_checkout_url':_0x3e7788,'complete_payment_url':_0x3e7788,'merchant_reference_id':_0x32bd44,'description':'ORDER:\x20'+_0x32bd44,'country':'GB','payment_method_types_include':[_0x4e2748(0x20d),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}};_0x2d32de!==_0x4e2748(0x221)&&(_0x4e9a8c[_0x4e2748(0x233)]='EUR',_0x4e9a8c['fixed_side']='sell');const _0x493cb0=Date[_0x4e2748(0x25f)]();try{console[_0x4e2748(0x1f4)](_0x4e2748(0x252)),console[_0x4e2748(0x1f4)](_0x4e2748(0x22f),this[_0x4e2748(0x25c)]),console[_0x4e2748(0x1f4)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x4e2748(0x253)](_0x4e9a8c,null,0x2)),console[_0x4e2748(0x1f4)](_0x4e2748(0x24d)+_0x3f889d+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x4e2748(0x1f4)](_0x4e2748(0x1f6)),loggerService_1[_0x4e2748(0x22a)][_0x4e2748(0x24f)](_0x4e2748(0x240),_0x4e2748(0x229),'POST',_0x4e9a8c);const _0x58862b=await fetch(this[_0x4e2748(0x25c)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x4e2748(0x204)},'body':JSON[_0x4e2748(0x253)](_0x4e9a8c)}),_0x504519=Date[_0x4e2748(0x25f)]()-_0x493cb0;console[_0x4e2748(0x1f4)](_0x4e2748(0x1f7)),console['log'](_0x4e2748(0x241),_0x58862b['status']),console[_0x4e2748(0x1f4)](_0x4e2748(0x25b),_0x58862b['statusText']),console[_0x4e2748(0x1f4)](_0x4e2748(0x20c),Object[_0x4e2748(0x1fb)](_0x58862b[_0x4e2748(0x245)][_0x4e2748(0x257)]())),console[_0x4e2748(0x1f4)](_0x4e2748(0x22d),_0x504519+'ms');const _0x4908b2=await _0x58862b['text']();console['log'](_0x4e2748(0x21d),_0x4908b2);if(!_0x58862b['ok']){console['error'](_0x4e2748(0x227)),console[_0x4e2748(0x209)]('HTTP\x20Status:',_0x58862b['status']),console[_0x4e2748(0x209)](_0x4e2748(0x222),_0x4908b2),loggerService_1['loggerService'][_0x4e2748(0x226)](_0x4e2748(0x240),_0x4e2748(0x229),_0x58862b[_0x4e2748(0x243)],_0x4908b2,_0x504519),loggerService_1[_0x4e2748(0x22a)][_0x4e2748(0x21f)](_0x4e2748(0x240),'/v1/hosted/payment_links',_0x4e2748(0x217)+_0x58862b[_0x4e2748(0x243)]+':\x20'+_0x4908b2);throw new Error(_0x4e2748(0x259)+_0x58862b['status']+_0x4e2748(0x236)+_0x4908b2);}let _0x32b4c5;try{_0x32b4c5=JSON[_0x4e2748(0x258)](_0x4908b2);}catch(_0x57e10d){console[_0x4e2748(0x209)](_0x4e2748(0x23f),_0x57e10d),loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x4e2748(0x229),_0x4e2748(0x20e)+_0x57e10d);throw new Error(_0x4e2748(0x23a)+_0x4908b2);}console[_0x4e2748(0x1f4)](_0x4e2748(0x22b)),console[_0x4e2748(0x1f4)](_0x4e2748(0x228),JSON[_0x4e2748(0x253)](_0x32b4c5,null,0x2)),loggerService_1[_0x4e2748(0x22a)][_0x4e2748(0x226)](_0x4e2748(0x240),_0x4e2748(0x229),_0x58862b['status'],_0x32b4c5,_0x504519);if(_0x32b4c5[_0x4e2748(0x243)]?.[_0x4e2748(0x243)]!==_0x4e2748(0x22c)){const _0x183cd9=_0x32b4c5[_0x4e2748(0x243)]?.[_0x4e2748(0x1fc)]||_0x4e2748(0x1fe),_0x28aaa2=_0x32b4c5['status']?.[_0x4e2748(0x231)]||_0x4e2748(0x1f5);console[_0x4e2748(0x209)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4e2748(0x209)]('Error\x20Code:',_0x28aaa2),console[_0x4e2748(0x209)](_0x4e2748(0x248),_0x183cd9),console[_0x4e2748(0x209)](_0x4e2748(0x21b),_0x32b4c5[_0x4e2748(0x243)]),loggerService_1[_0x4e2748(0x22a)][_0x4e2748(0x21f)](_0x4e2748(0x240),_0x4e2748(0x229),_0x4e2748(0x210)+_0x28aaa2+_0x4e2748(0x212)+_0x183cd9);throw new Error(_0x4e2748(0x249)+_0x28aaa2+'):\x20'+_0x183cd9);}if(!_0x32b4c5[_0x4e2748(0x255)]?.['id']||!_0x32b4c5[_0x4e2748(0x255)]?.[_0x4e2748(0x235)]){console[_0x4e2748(0x209)](_0x4e2748(0x1fa)),console[_0x4e2748(0x209)](_0x4e2748(0x237)),console[_0x4e2748(0x209)](_0x4e2748(0x24a),_0x32b4c5[_0x4e2748(0x255)]),loggerService_1[_0x4e2748(0x22a)]['logWhiteDomainError'](_0x4e2748(0x240),_0x4e2748(0x229),_0x4e2748(0x244));throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x4e2748(0x1f4)](_0x4e2748(0x213)),console[_0x4e2748(0x1f4)](_0x4e2748(0x20a),_0x32b4c5['data']['id']),console['log'](_0x4e2748(0x24c),_0x32b4c5[_0x4e2748(0x255)][_0x4e2748(0x235)]),console[_0x4e2748(0x1f4)]('üá¨üáß\x20Country\x20used:\x20'+_0x3f889d+'\x20(GB\x20-\x20Britain)'),console[_0x4e2748(0x1f4)](_0x4e2748(0x1f6)),{'gateway_payment_id':_0x32b4c5[_0x4e2748(0x255)]['id'],'payment_url':_0x32b4c5[_0x4e2748(0x255)][_0x4e2748(0x235)]};}catch(_0x4c5df2){console[_0x4e2748(0x209)](_0x4e2748(0x202)),console[_0x4e2748(0x209)]('Error\x20details:',_0x4c5df2),loggerService_1[_0x4e2748(0x22a)][_0x4e2748(0x21f)](_0x4e2748(0x240),_0x4e2748(0x229),_0x4c5df2);if(_0x4c5df2 instanceof Error){console[_0x4e2748(0x209)](_0x4e2748(0x251),_0x4c5df2['message']),console[_0x4e2748(0x209)]('Error\x20stack:',_0x4c5df2[_0x4e2748(0x230)]);throw new Error(_0x4e2748(0x21e)+_0x4c5df2[_0x4e2748(0x1fc)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a42_0x438084(0x234)](_0x2ce21b){const _0xcb95d8=a42_0x438084,_0xffe17d=Date[_0xcb95d8(0x25f)]();try{loggerService_1['loggerService'][_0xcb95d8(0x24f)](_0xcb95d8(0x240),_0xcb95d8(0x203)+_0x2ce21b,_0xcb95d8(0x207),{});const _0x4d44f0=await fetch(this[_0xcb95d8(0x25c)]+'/'+_0x2ce21b,{'method':_0xcb95d8(0x207),'headers':{'Content-Type':_0xcb95d8(0x220),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x177f81=Date['now']()-_0xffe17d;if(!_0x4d44f0['ok']){const _0x1aef2c=await _0x4d44f0['text']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0xcb95d8(0x240),_0xcb95d8(0x203)+_0x2ce21b,_0x4d44f0[_0xcb95d8(0x243)],_0x1aef2c,_0x177f81);throw new Error(_0xcb95d8(0x259)+_0x4d44f0[_0xcb95d8(0x243)]);}const _0x54acc7=await _0x4d44f0[_0xcb95d8(0x242)]();loggerService_1[_0xcb95d8(0x22a)][_0xcb95d8(0x226)]('rapyd','/v1/hosted/payment_links/'+_0x2ce21b,_0x4d44f0['status'],_0x54acc7,_0x177f81);if(_0x54acc7[_0xcb95d8(0x243)]?.[_0xcb95d8(0x243)]!==_0xcb95d8(0x22c)){loggerService_1[_0xcb95d8(0x22a)]['logWhiteDomainError'](_0xcb95d8(0x240),_0xcb95d8(0x203)+_0x2ce21b,_0xcb95d8(0x24e)+(_0x54acc7['status']?.[_0xcb95d8(0x1fc)]||'Unknown\x20error'));throw new Error(_0xcb95d8(0x24e)+(_0x54acc7[_0xcb95d8(0x243)]?.[_0xcb95d8(0x1fc)]||'Unknown\x20error'));}let _0x352d08=_0xcb95d8(0x200);if(_0x54acc7[_0xcb95d8(0x255)]?.[_0xcb95d8(0x243)])switch(_0x54acc7[_0xcb95d8(0x255)][_0xcb95d8(0x243)][_0xcb95d8(0x1f9)]()){case _0xcb95d8(0x246):_0x352d08=_0xcb95d8(0x25a);break;case _0xcb95d8(0x21c):_0x352d08=_0xcb95d8(0x223);break;case _0xcb95d8(0x206):_0x352d08=_0xcb95d8(0x247);break;case _0xcb95d8(0x239):_0x352d08=_0xcb95d8(0x223);break;case _0xcb95d8(0x224):case _0xcb95d8(0x201):default:_0x352d08=_0xcb95d8(0x200);break;}return{'status':_0x352d08,'amount':_0x54acc7['data']?.['amount'],'currency':_0x54acc7[_0xcb95d8(0x255)]?.[_0xcb95d8(0x225)]};}catch(_0x1055e1){console['error'](_0xcb95d8(0x1f3),_0x1055e1),loggerService_1['loggerService'][_0xcb95d8(0x21f)]('rapyd','/v1/hosted/payment_links/'+_0x2ce21b,_0x1055e1);throw new Error(_0xcb95d8(0x24b)+(_0x1055e1 instanceof Error?_0x1055e1[_0xcb95d8(0x1fc)]:_0xcb95d8(0x23c)));}}async[a42_0x438084(0x208)](_0x360b0a){const _0x2dacfc=a42_0x438084;console[_0x2dacfc(0x1f4)]('Processing\x20Rapyd\x20webhook:',_0x360b0a);let _0x2fbd4e=_0x2dacfc(0x200);switch(_0x360b0a['type']?.[_0x2dacfc(0x1f9)]()){case'PAYMENT_COMPLETED':_0x360b0a[_0x2dacfc(0x255)]?.['paid']===!![]&&_0x360b0a['data']?.[_0x2dacfc(0x243)]===_0x2dacfc(0x246)?_0x2fbd4e=_0x2dacfc(0x25a):_0x2fbd4e=_0x2dacfc(0x200);break;case _0x2dacfc(0x22e):_0x2fbd4e='FAILED';break;case _0x2dacfc(0x20b):_0x2fbd4e=_0x2dacfc(0x247);break;case _0x2dacfc(0x215):_0x2fbd4e='FAILED';break;default:switch(_0x360b0a[_0x2dacfc(0x255)]?.[_0x2dacfc(0x243)]?.['toUpperCase']()){case'CLO':_0x360b0a[_0x2dacfc(0x255)]?.[_0x2dacfc(0x1ff)]===!![]?_0x2fbd4e=_0x2dacfc(0x25a):_0x2fbd4e=_0x2dacfc(0x223);break;case'CAN':_0x2fbd4e=_0x2dacfc(0x223);break;case'EXP':_0x2fbd4e=_0x2dacfc(0x247);break;case'ERR':_0x2fbd4e='FAILED';break;case _0x2dacfc(0x224):case _0x2dacfc(0x201):default:_0x2fbd4e=_0x2dacfc(0x200);break;}break;}return{'paymentId':_0x360b0a[_0x2dacfc(0x255)]?.[_0x2dacfc(0x21a)]||'','status':_0x2fbd4e,'amount':_0x360b0a['data']?.['amount'],'currency':_0x360b0a[_0x2dacfc(0x255)]?.[_0x2dacfc(0x225)]};}}exports[a42_0x438084(0x25d)]=RapydService;