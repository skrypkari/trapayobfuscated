'use strict';const a42_0x4cff42=a42_0x3c1f;(function(_0x521541,_0x5de4ef){const _0x5e9018=a42_0x3c1f,_0x18f9de=_0x521541();while(!![]){try{const _0x1fecdc=parseInt(_0x5e9018(0x216))/0x1*(-parseInt(_0x5e9018(0x1fc))/0x2)+parseInt(_0x5e9018(0x1f5))/0x3*(-parseInt(_0x5e9018(0x20b))/0x4)+parseInt(_0x5e9018(0x20d))/0x5+parseInt(_0x5e9018(0x23a))/0x6*(parseInt(_0x5e9018(0x245))/0x7)+parseInt(_0x5e9018(0x217))/0x8+-parseInt(_0x5e9018(0x219))/0x9*(parseInt(_0x5e9018(0x23e))/0xa)+parseInt(_0x5e9018(0x230))/0xb;if(_0x1fecdc===_0x5de4ef)break;else _0x18f9de['push'](_0x18f9de['shift']());}catch(_0x487452){_0x18f9de['push'](_0x18f9de['shift']());}}}(a42_0xfdfa,0x2f38c));function a42_0x3c1f(_0x427200,_0x52f59b){const _0xfdfab2=a42_0xfdfa();return a42_0x3c1f=function(_0x3c1ff5,_0x163d30){_0x3c1ff5=_0x3c1ff5-0x1e3;let _0xd0235=_0xfdfab2[_0x3c1ff5];return _0xd0235;},a42_0x3c1f(_0x427200,_0x52f59b);}function a42_0xfdfa(){const _0xe6d26c=['JSON\x20Parse\x20Error:\x20','type','GET','ORDER:\x20','merchant_reference_id','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','4458Rzvgef','application/json','message','PAYMENT_FAILED','410osGezj','Unknown\x20error\x20from\x20Rapyd\x20API','CAN','Error\x20message:','error','status','log','3409tGbQpI','CLO','parse','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','entries','Parsed\x20Result:','\x20(always\x20GB\x20for\x20Rapyd)','logWhiteDomainResponse','/v1/hosted/payment_links/','gb_mastercard_card','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===',',\x20body:\x20','https://tesoft.uk/gateway/rapyd/','logWhiteDomainError','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Status\x20Text:','/v1/hosted/payment_links','HTTP\x20Status:','defineProperty','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','stack','PAYMENT_CANCELED','redirect_url','paid','\x20(GB\x20-\x20Britain)','ERR','rapyd','Response\x20data:','Processing\x20Rapyd\x20webhook:','fromEntries','Headers:','39eHkksR','https://tesoft.uk/gateway/fail.php?id=','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Raw\x20Response\x20Body:','Unknown\x20error','headers','102062BCxiMl','PENDING','__esModule','EXP','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Status:','SUCCESS','apiUrl','===\x20RAPYD\x20SUCCESS\x20===','stringify','RapydService','data','amount','ACT','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','72484JuVxMv','Response\x20Body:','392715JvvoQX','PAID','HTTP\x20','Payment\x20Link\x20ID:','loggerService','EXPIRED','UNKNOWN','HTTP\x20error!\x20status:\x20','Rapyd\x20payment\x20verification\x20error:','7AZULBc','2760528VDYVBS','PAYMENT_EXPIRED','14733RHNdJX','json','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','toUpperCase','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','createPaymentLink','processWebhook','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','now','):\x20','logWhiteDomainRequest','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Rapyd\x20API\x20error:\x20','Rapyd\x20API\x20error\x20(','error_code','currency','Request\x20Body\x20(Updated\x20Format):','Redirect\x20URL:','Response\x20Time:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','FAILED','746647PFypeH','Error\x20stack:','üá¨üáß\x20Country\x20used:\x20','POST'];a42_0xfdfa=function(){return _0xe6d26c;};return a42_0xfdfa();}Object[a42_0x4cff42(0x1e8)](exports,a42_0x4cff42(0x1fe),{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x5c5ae1=a42_0x4cff42;this['apiUrl']=_0x5c5ae1(0x251),console[_0x5c5ae1(0x244)](_0x5c5ae1(0x239));}async[a42_0x4cff42(0x21f)](_0x573467){const _0x2a83c9=a42_0x4cff42,{orderId:_0x1075a1,orderName:_0x4b4dd0,amount:_0x186691,currency:_0x2e4b1d,usage:_0x1c1205,maxPayments:_0x104699,successUrl:_0x2eb24d,failUrl:_0x360f49}=_0x573467,_0x23546e=_0x2e4b1d[_0x2a83c9(0x21d)](),_0x5ae2ce='GB';console[_0x2a83c9(0x244)](_0x2a83c9(0x226));const _0x4c3c30='https://tesoft.uk/gateway/success.php?id='+_0x1075a1,_0x53e070=_0x2a83c9(0x1f6)+_0x1075a1,_0x22ef73={'amount':_0x186691,'currency':_0x23546e,'cancel_checkout_url':_0x53e070,'complete_checkout_url':_0x4c3c30,'complete_payment_url':_0x4c3c30,'merchant_reference_id':_0x1075a1,'description':_0x2a83c9(0x237)+_0x1075a1,'country':'GB','payment_method_types_include':['gb_visa_card',_0x2a83c9(0x24e)],'custom_elements':{'display_description':!![]}},_0x364655=Date[_0x2a83c9(0x222)]();try{console['log'](_0x2a83c9(0x248)),console[_0x2a83c9(0x244)]('URL:',this[_0x2a83c9(0x203)]),console[_0x2a83c9(0x244)](_0x2a83c9(0x22b),JSON['stringify'](_0x22ef73,null,0x2)),console[_0x2a83c9(0x244)]('üá¨üáß\x20Country:\x20'+_0x5ae2ce+_0x2a83c9(0x24b)),console[_0x2a83c9(0x244)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x2a83c9(0x211)]['logWhiteDomainRequest'](_0x2a83c9(0x1f0),_0x2a83c9(0x1e6),'POST',_0x22ef73);const _0x51d341=await fetch(this['apiUrl'],{'method':_0x2a83c9(0x233),'headers':{'Content-Type':_0x2a83c9(0x23b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2a83c9(0x205)](_0x22ef73)}),_0x3d2fcb=Date[_0x2a83c9(0x222)]()-_0x364655;console[_0x2a83c9(0x244)](_0x2a83c9(0x21c)),console['log'](_0x2a83c9(0x201),_0x51d341[_0x2a83c9(0x243)]),console[_0x2a83c9(0x244)](_0x2a83c9(0x1e5),_0x51d341['statusText']),console[_0x2a83c9(0x244)](_0x2a83c9(0x1f4),Object[_0x2a83c9(0x1f3)](_0x51d341[_0x2a83c9(0x1fb)][_0x2a83c9(0x249)]())),console[_0x2a83c9(0x244)](_0x2a83c9(0x22d),_0x3d2fcb+'ms');const _0xbd8e90=await _0x51d341['text']();console[_0x2a83c9(0x244)](_0x2a83c9(0x1f9),_0xbd8e90);if(!_0x51d341['ok']){console[_0x2a83c9(0x242)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x2a83c9(0x242)](_0x2a83c9(0x1e7),_0x51d341[_0x2a83c9(0x243)]),console['error'](_0x2a83c9(0x20c),_0xbd8e90),loggerService_1['loggerService'][_0x2a83c9(0x24c)](_0x2a83c9(0x1f0),_0x2a83c9(0x1e6),_0x51d341['status'],_0xbd8e90,_0x3d2fcb),loggerService_1[_0x2a83c9(0x211)][_0x2a83c9(0x1e3)](_0x2a83c9(0x1f0),'/v1/hosted/payment_links',_0x2a83c9(0x20f)+_0x51d341[_0x2a83c9(0x243)]+':\x20'+_0xbd8e90);throw new Error(_0x2a83c9(0x214)+_0x51d341[_0x2a83c9(0x243)]+_0x2a83c9(0x250)+_0xbd8e90);}let _0x3a6cb2;try{_0x3a6cb2=JSON[_0x2a83c9(0x247)](_0xbd8e90);}catch(_0x2667e1){console[_0x2a83c9(0x242)](_0x2a83c9(0x1f7),_0x2667e1),loggerService_1['loggerService'][_0x2a83c9(0x1e3)]('rapyd',_0x2a83c9(0x1e6),_0x2a83c9(0x234)+_0x2667e1);throw new Error(_0x2a83c9(0x21e)+_0xbd8e90);}console[_0x2a83c9(0x244)](_0x2a83c9(0x20a)),console[_0x2a83c9(0x244)](_0x2a83c9(0x24a),JSON[_0x2a83c9(0x205)](_0x3a6cb2,null,0x2)),loggerService_1[_0x2a83c9(0x211)][_0x2a83c9(0x24c)]('rapyd','/v1/hosted/payment_links',_0x51d341['status'],_0x3a6cb2,_0x3d2fcb);if(_0x3a6cb2[_0x2a83c9(0x243)]?.[_0x2a83c9(0x243)]!==_0x2a83c9(0x202)){const _0x469828=_0x3a6cb2[_0x2a83c9(0x243)]?.[_0x2a83c9(0x23c)]||_0x2a83c9(0x23f),_0x12d532=_0x3a6cb2['status']?.[_0x2a83c9(0x229)]||_0x2a83c9(0x213);console['error'](_0x2a83c9(0x221)),console['error']('Error\x20Code:',_0x12d532),console['error']('Error\x20Message:',_0x469828),console[_0x2a83c9(0x242)]('Full\x20Error\x20Data:',_0x3a6cb2[_0x2a83c9(0x243)]),loggerService_1[_0x2a83c9(0x211)][_0x2a83c9(0x1e3)](_0x2a83c9(0x1f0),_0x2a83c9(0x1e6),'Business\x20Error\x20('+_0x12d532+_0x2a83c9(0x223)+_0x469828);throw new Error(_0x2a83c9(0x228)+_0x12d532+'):\x20'+_0x469828);}if(!_0x3a6cb2[_0x2a83c9(0x207)]?.['id']||!_0x3a6cb2[_0x2a83c9(0x207)]?.['redirect_url']){console['error'](_0x2a83c9(0x24f)),console[_0x2a83c9(0x242)](_0x2a83c9(0x1e4)),console[_0x2a83c9(0x242)](_0x2a83c9(0x1f1),_0x3a6cb2[_0x2a83c9(0x207)]),loggerService_1[_0x2a83c9(0x211)][_0x2a83c9(0x1e3)](_0x2a83c9(0x1f0),_0x2a83c9(0x1e6),_0x2a83c9(0x200));throw new Error(_0x2a83c9(0x1f8));}return console[_0x2a83c9(0x244)](_0x2a83c9(0x204)),console[_0x2a83c9(0x244)](_0x2a83c9(0x210),_0x3a6cb2[_0x2a83c9(0x207)]['id']),console['log'](_0x2a83c9(0x22c),_0x3a6cb2['data']['redirect_url']),console[_0x2a83c9(0x244)](_0x2a83c9(0x232)+_0x5ae2ce+_0x2a83c9(0x1ee)),console[_0x2a83c9(0x244)](_0x2a83c9(0x21b)),{'gateway_payment_id':_0x3a6cb2[_0x2a83c9(0x207)]['id'],'payment_url':_0x3a6cb2[_0x2a83c9(0x207)][_0x2a83c9(0x1ec)]};}catch(_0x9ac67d){console[_0x2a83c9(0x242)](_0x2a83c9(0x22e)),console['error']('Error\x20details:',_0x9ac67d),loggerService_1['loggerService'][_0x2a83c9(0x1e3)]('rapyd',_0x2a83c9(0x1e6),_0x9ac67d);if(_0x9ac67d instanceof Error){console['error'](_0x2a83c9(0x241),_0x9ac67d[_0x2a83c9(0x23c)]),console[_0x2a83c9(0x242)](_0x2a83c9(0x231),_0x9ac67d[_0x2a83c9(0x1ea)]);throw new Error(_0x2a83c9(0x225)+_0x9ac67d['message']);}throw new Error(_0x2a83c9(0x1e9));}}async['verifyPayment'](_0x488d8e){const _0x1261d2=a42_0x4cff42,_0xa90a5a=Date[_0x1261d2(0x222)]();try{loggerService_1['loggerService'][_0x1261d2(0x224)]('rapyd',_0x1261d2(0x24d)+_0x488d8e,'GET',{});const _0x379bff=await fetch(this[_0x1261d2(0x203)]+'/'+_0x488d8e,{'method':_0x1261d2(0x236),'headers':{'Content-Type':_0x1261d2(0x23b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x1e803b=Date[_0x1261d2(0x222)]()-_0xa90a5a;if(!_0x379bff['ok']){const _0x5d14f4=await _0x379bff['text']();loggerService_1[_0x1261d2(0x211)][_0x1261d2(0x24c)](_0x1261d2(0x1f0),_0x1261d2(0x24d)+_0x488d8e,_0x379bff[_0x1261d2(0x243)],_0x5d14f4,_0x1e803b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x379bff['status']);}const _0x28a793=await _0x379bff[_0x1261d2(0x21a)]();loggerService_1[_0x1261d2(0x211)][_0x1261d2(0x24c)](_0x1261d2(0x1f0),_0x1261d2(0x24d)+_0x488d8e,_0x379bff[_0x1261d2(0x243)],_0x28a793,_0x1e803b);if(_0x28a793['status']?.[_0x1261d2(0x243)]!==_0x1261d2(0x202)){loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x1261d2(0x24d)+_0x488d8e,'Rapyd\x20API\x20error:\x20'+(_0x28a793[_0x1261d2(0x243)]?.[_0x1261d2(0x23c)]||_0x1261d2(0x1fa)));throw new Error(_0x1261d2(0x227)+(_0x28a793[_0x1261d2(0x243)]?.[_0x1261d2(0x23c)]||_0x1261d2(0x1fa)));}let _0x410a34=_0x1261d2(0x1fd);if(_0x28a793[_0x1261d2(0x207)]?.['status'])switch(_0x28a793[_0x1261d2(0x207)][_0x1261d2(0x243)][_0x1261d2(0x21d)]()){case'CLO':_0x410a34='PAID';break;case _0x1261d2(0x240):_0x410a34=_0x1261d2(0x22f);break;case _0x1261d2(0x1ff):_0x410a34='EXPIRED';break;case _0x1261d2(0x1ef):_0x410a34='FAILED';break;case'NEW':case'ACT':default:_0x410a34=_0x1261d2(0x1fd);break;}return{'status':_0x410a34,'amount':_0x28a793['data']?.[_0x1261d2(0x208)],'currency':_0x28a793[_0x1261d2(0x207)]?.[_0x1261d2(0x22a)]};}catch(_0x117a49){console[_0x1261d2(0x242)](_0x1261d2(0x215),_0x117a49),loggerService_1[_0x1261d2(0x211)][_0x1261d2(0x1e3)](_0x1261d2(0x1f0),_0x1261d2(0x24d)+_0x488d8e,_0x117a49);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x117a49 instanceof Error?_0x117a49[_0x1261d2(0x23c)]:_0x1261d2(0x1fa)));}}async[a42_0x4cff42(0x220)](_0x259816){const _0x16c088=a42_0x4cff42;console[_0x16c088(0x244)](_0x16c088(0x1f2),_0x259816);let _0x374beb='PENDING';switch(_0x259816[_0x16c088(0x235)]?.[_0x16c088(0x21d)]()){case'PAYMENT_COMPLETED':_0x259816['data']?.[_0x16c088(0x1ed)]===!![]&&_0x259816[_0x16c088(0x207)]?.[_0x16c088(0x243)]==='CLO'?_0x374beb=_0x16c088(0x20e):_0x374beb=_0x16c088(0x1fd);break;case _0x16c088(0x1eb):_0x374beb=_0x16c088(0x22f);break;case _0x16c088(0x218):_0x374beb=_0x16c088(0x212);break;case _0x16c088(0x23d):_0x374beb=_0x16c088(0x22f);break;default:switch(_0x259816[_0x16c088(0x207)]?.[_0x16c088(0x243)]?.[_0x16c088(0x21d)]()){case _0x16c088(0x246):_0x259816[_0x16c088(0x207)]?.[_0x16c088(0x1ed)]===!![]?_0x374beb=_0x16c088(0x20e):_0x374beb=_0x16c088(0x22f);break;case _0x16c088(0x240):_0x374beb='FAILED';break;case _0x16c088(0x1ff):_0x374beb='EXPIRED';break;case'ERR':_0x374beb='FAILED';break;case'NEW':case _0x16c088(0x209):default:_0x374beb=_0x16c088(0x1fd);break;}break;}return{'paymentId':_0x259816['data']?.[_0x16c088(0x238)]||'','status':_0x374beb,'amount':_0x259816[_0x16c088(0x207)]?.[_0x16c088(0x208)],'currency':_0x259816[_0x16c088(0x207)]?.['currency']};}}exports[a42_0x4cff42(0x206)]=RapydService;