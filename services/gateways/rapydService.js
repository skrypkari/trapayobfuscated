'use strict';const a49_0x49e5ab=a49_0x4b0a;(function(_0x561cc0,_0x400170){const _0x45a853=a49_0x4b0a,_0x13f822=_0x561cc0();while(!![]){try{const _0xcbf67=-parseInt(_0x45a853(0x145))/0x1*(parseInt(_0x45a853(0x195))/0x2)+parseInt(_0x45a853(0x16b))/0x3*(-parseInt(_0x45a853(0x172))/0x4)+parseInt(_0x45a853(0x132))/0x5+-parseInt(_0x45a853(0x167))/0x6+parseInt(_0x45a853(0x199))/0x7+-parseInt(_0x45a853(0x133))/0x8*(parseInt(_0x45a853(0x13e))/0x9)+parseInt(_0x45a853(0x19f))/0xa;if(_0xcbf67===_0x400170)break;else _0x13f822['push'](_0x13f822['shift']());}catch(_0x28ffa6){_0x13f822['push'](_0x13f822['shift']());}}}(a49_0x4447,0x90576));function a49_0x4b0a(_0x1c7c8a,_0x5adbf6){const _0x444757=a49_0x4447();return a49_0x4b0a=function(_0x4b0a80,_0x287cee){_0x4b0a80=_0x4b0a80-0x12e;let _0x2fe16f=_0x444757[_0x4b0a80];return _0x2fe16f;},a49_0x4b0a(_0x1c7c8a,_0x5adbf6);}Object[a49_0x49e5ab(0x197)](exports,'__esModule',{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x526628=a49_0x49e5ab;this[_0x526628(0x190)]=_0x526628(0x184),console[_0x526628(0x136)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a49_0x49e5ab(0x135)](_0x9817cc){const _0x327340=a49_0x49e5ab,{orderId:_0x59a74c,orderName:_0x2c8992,amount:_0x8ada37,currency:_0x1466fe,usage:_0x3536dd,maxPayments:_0x2162e8,successUrl:_0x22f32a,failUrl:_0x5fcc26}=_0x9817cc,_0x16bb5a=_0x1466fe[_0x327340(0x182)](),_0x503be5='GB';console[_0x327340(0x136)](_0x327340(0x179));const _0x8cef69='https://tesoft.uk/gateway/success.php?id='+_0x59a74c,_0x286013=_0x327340(0x16e)+_0x59a74c,_0x857523={'amount':_0x8ada37,'currency':_0x16bb5a,'cancel_checkout_url':_0x286013,'complete_checkout_url':_0x8cef69,'complete_payment_url':_0x8cef69,'merchant_reference_id':_0x59a74c,'description':_0x327340(0x14a)+_0x59a74c,'country':'GB','payment_method_types_include':[_0x327340(0x13c),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}};if(_0x16bb5a!==_0x327340(0x1a3)){const _0x4236fd=Math[_0x327340(0x15e)](Date[_0x327340(0x19e)]()/0x3e8)+0x1e*0x3c;_0x857523[_0x327340(0x15c)]='buy',_0x857523['requested_currency']=_0x327340(0x1a3),_0x857523[_0x327340(0x142)]=_0x4236fd,console[_0x327340(0x136)]('üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20'+_0x16bb5a+_0x327340(0x17a)),console[_0x327340(0x136)](_0x327340(0x18b)),console['log'](_0x327340(0x17d)),console[_0x327340(0x136)](_0x327340(0x13b)+_0x4236fd+'\x20('+new Date(_0x4236fd*0x3e8)['toISOString']()+')');}const _0x2ad8ed=Date[_0x327340(0x19e)]();try{console[_0x327340(0x136)](_0x327340(0x17c)),console[_0x327340(0x136)](_0x327340(0x140),this['apiUrl']),console[_0x327340(0x136)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x327340(0x14f)](_0x857523,null,0x2)),console[_0x327340(0x136)]('üá¨üáß\x20Country:\x20'+_0x503be5+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x327340(0x136)](_0x327340(0x157)),loggerService_1[_0x327340(0x171)][_0x327340(0x15d)](_0x327340(0x154),_0x327340(0x144),_0x327340(0x143),_0x857523);const _0x3a371e=await fetch(this[_0x327340(0x190)],{'method':'POST','headers':{'Content-Type':_0x327340(0x1a2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x327340(0x14f)](_0x857523)}),_0x50b7e6=Date[_0x327340(0x19e)]()-_0x2ad8ed;console[_0x327340(0x136)](_0x327340(0x187)),console[_0x327340(0x136)]('Status:',_0x3a371e[_0x327340(0x194)]),console[_0x327340(0x136)](_0x327340(0x174),_0x3a371e[_0x327340(0x12e)]),console['log']('Headers:',Object['fromEntries'](_0x3a371e[_0x327340(0x146)][_0x327340(0x160)]())),console[_0x327340(0x136)]('Response\x20Time:',_0x50b7e6+'ms');const _0x3ee53e=await _0x3a371e[_0x327340(0x189)]();console[_0x327340(0x136)](_0x327340(0x165),_0x3ee53e);if(!_0x3a371e['ok']){console[_0x327340(0x16d)](_0x327340(0x139)),console[_0x327340(0x16d)]('HTTP\x20Status:',_0x3a371e[_0x327340(0x194)]),console[_0x327340(0x16d)]('Response\x20Body:',_0x3ee53e),loggerService_1['loggerService'][_0x327340(0x166)](_0x327340(0x154),_0x327340(0x144),_0x3a371e[_0x327340(0x194)],_0x3ee53e,_0x50b7e6),loggerService_1[_0x327340(0x171)][_0x327340(0x162)](_0x327340(0x154),_0x327340(0x144),'HTTP\x20'+_0x3a371e[_0x327340(0x194)]+':\x20'+_0x3ee53e);throw new Error(_0x327340(0x147)+_0x3a371e['status']+_0x327340(0x188)+_0x3ee53e);}let _0xafc60;try{_0xafc60=JSON['parse'](_0x3ee53e);}catch(_0x1d8a7c){console[_0x327340(0x16d)](_0x327340(0x19d),_0x1d8a7c),loggerService_1[_0x327340(0x171)][_0x327340(0x162)](_0x327340(0x154),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x1d8a7c);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x3ee53e);}console['log'](_0x327340(0x168)),console[_0x327340(0x136)](_0x327340(0x196),JSON[_0x327340(0x14f)](_0xafc60,null,0x2)),loggerService_1['loggerService'][_0x327340(0x166)]('rapyd','/v1/hosted/payment_links',_0x3a371e['status'],_0xafc60,_0x50b7e6);if(_0xafc60['status']?.[_0x327340(0x194)]!==_0x327340(0x185)){const _0x553bf1=_0xafc60[_0x327340(0x194)]?.[_0x327340(0x13d)]||_0x327340(0x18f),_0x1be3f7=_0xafc60[_0x327340(0x194)]?.['error_code']||_0x327340(0x198);console[_0x327340(0x16d)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x327340(0x16d)]('Error\x20Code:',_0x1be3f7),console[_0x327340(0x16d)](_0x327340(0x169),_0x553bf1),console['error'](_0x327340(0x18a),_0xafc60[_0x327340(0x194)]),loggerService_1[_0x327340(0x171)][_0x327340(0x162)](_0x327340(0x154),'/v1/hosted/payment_links',_0x327340(0x18d)+_0x1be3f7+_0x327340(0x180)+_0x553bf1);throw new Error('Rapyd\x20API\x20error\x20('+_0x1be3f7+_0x327340(0x180)+_0x553bf1);}if(!_0xafc60[_0x327340(0x19c)]?.['id']||!_0xafc60[_0x327340(0x19c)]?.[_0x327340(0x17b)]){console[_0x327340(0x16d)](_0x327340(0x161)),console[_0x327340(0x16d)](_0x327340(0x137)),console[_0x327340(0x16d)](_0x327340(0x164),_0xafc60[_0x327340(0x19c)]),loggerService_1['loggerService'][_0x327340(0x162)](_0x327340(0x154),'/v1/hosted/payment_links',_0x327340(0x16f));throw new Error(_0x327340(0x1a1));}return console[_0x327340(0x136)](_0x327340(0x19b)),console[_0x327340(0x136)](_0x327340(0x12f),_0xafc60[_0x327340(0x19c)]['id']),console['log'](_0x327340(0x148),_0xafc60['data'][_0x327340(0x17b)]),console[_0x327340(0x136)]('üá¨üáß\x20Country\x20used:\x20'+_0x503be5+_0x327340(0x14c)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0xafc60['data']['id'],'payment_url':_0xafc60[_0x327340(0x19c)]['redirect_url']};}catch(_0x196dbd){console[_0x327340(0x16d)](_0x327340(0x186)),console[_0x327340(0x16d)](_0x327340(0x138),_0x196dbd),loggerService_1[_0x327340(0x171)][_0x327340(0x162)](_0x327340(0x154),'/v1/hosted/payment_links',_0x196dbd);if(_0x196dbd instanceof Error){console['error'](_0x327340(0x16a),_0x196dbd[_0x327340(0x13d)]),console[_0x327340(0x16d)](_0x327340(0x176),_0x196dbd['stack']);throw new Error(_0x327340(0x151)+_0x196dbd[_0x327340(0x13d)]);}throw new Error(_0x327340(0x155));}}async['verifyPayment'](_0x5a1476){const _0x231ccd=a49_0x49e5ab,_0x5238e3=Date[_0x231ccd(0x19e)]();try{loggerService_1[_0x231ccd(0x171)][_0x231ccd(0x15d)](_0x231ccd(0x154),_0x231ccd(0x15a)+_0x5a1476,_0x231ccd(0x141),{});const _0x58d82d=await fetch(this[_0x231ccd(0x190)]+'/'+_0x5a1476,{'method':_0x231ccd(0x141),'headers':{'Content-Type':_0x231ccd(0x1a2),'User-Agent':_0x231ccd(0x175)}}),_0x34e18d=Date[_0x231ccd(0x19e)]()-_0x5238e3;if(!_0x58d82d['ok']){const _0x1132dd=await _0x58d82d[_0x231ccd(0x189)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x231ccd(0x154),_0x231ccd(0x15a)+_0x5a1476,_0x58d82d[_0x231ccd(0x194)],_0x1132dd,_0x34e18d);throw new Error(_0x231ccd(0x147)+_0x58d82d[_0x231ccd(0x194)]);}const _0x584926=await _0x58d82d[_0x231ccd(0x177)]();loggerService_1[_0x231ccd(0x171)][_0x231ccd(0x166)](_0x231ccd(0x154),_0x231ccd(0x15a)+_0x5a1476,_0x58d82d[_0x231ccd(0x194)],_0x584926,_0x34e18d);if(_0x584926[_0x231ccd(0x194)]?.[_0x231ccd(0x194)]!==_0x231ccd(0x185)){loggerService_1['loggerService'][_0x231ccd(0x162)](_0x231ccd(0x154),_0x231ccd(0x15a)+_0x5a1476,_0x231ccd(0x14e)+(_0x584926[_0x231ccd(0x194)]?.[_0x231ccd(0x13d)]||'Unknown\x20error'));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x584926[_0x231ccd(0x194)]?.[_0x231ccd(0x13d)]||_0x231ccd(0x149)));}let _0x29c28=_0x231ccd(0x192);if(_0x584926[_0x231ccd(0x19c)]?.[_0x231ccd(0x194)])switch(_0x584926['data']['status'][_0x231ccd(0x182)]()){case _0x231ccd(0x15f):_0x29c28='PAID';break;case _0x231ccd(0x158):_0x29c28=_0x231ccd(0x131);break;case _0x231ccd(0x19a):_0x29c28=_0x231ccd(0x13a);break;case _0x231ccd(0x1a4):_0x29c28=_0x231ccd(0x131);break;case _0x231ccd(0x17e):case _0x231ccd(0x1a0):default:_0x29c28=_0x231ccd(0x192);break;}return{'status':_0x29c28,'amount':_0x584926['data']?.[_0x231ccd(0x156)],'currency':_0x584926[_0x231ccd(0x19c)]?.[_0x231ccd(0x183)]};}catch(_0x4c8f0b){console[_0x231ccd(0x16d)](_0x231ccd(0x173),_0x4c8f0b),loggerService_1[_0x231ccd(0x171)][_0x231ccd(0x162)](_0x231ccd(0x154),_0x231ccd(0x15a)+_0x5a1476,_0x4c8f0b);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x4c8f0b instanceof Error?_0x4c8f0b[_0x231ccd(0x13d)]:_0x231ccd(0x149)));}}async[a49_0x49e5ab(0x18e)](_0xfdf848){const _0x2827e9=a49_0x49e5ab;console[_0x2827e9(0x136)]('Processing\x20Rapyd\x20webhook:',_0xfdf848);let _0x4dedf0='PENDING',_0x189a28;_0xfdf848[_0x2827e9(0x19c)]?.['failure_message']&&(_0x189a28=_0xfdf848[_0x2827e9(0x19c)]['failure_message'],console[_0x2827e9(0x136)](_0x2827e9(0x170)+_0x189a28));switch(_0xfdf848[_0x2827e9(0x193)]?.[_0x2827e9(0x182)]()){case'PAYMENT_COMPLETED':_0xfdf848[_0x2827e9(0x19c)]?.['paid']===!![]&&_0xfdf848['data']?.['status']===_0x2827e9(0x15f)?_0x4dedf0='PAID':_0x4dedf0=_0x2827e9(0x192);break;case _0x2827e9(0x18c):_0x4dedf0=_0x2827e9(0x131);break;case _0x2827e9(0x16c):_0x4dedf0=_0x2827e9(0x13a);break;case _0x2827e9(0x130):_0x4dedf0='FAILED';!_0x189a28&&_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x14d)]&&(_0x189a28=_0xfdf848['data'][_0x2827e9(0x14d)]);break;default:switch(_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x194)]?.['toUpperCase']()){case'CLO':_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x152)]===!![]?_0x4dedf0=_0x2827e9(0x163):_0x4dedf0=_0x2827e9(0x131);break;case'CAN':_0x4dedf0=_0x2827e9(0x131);break;case'EXP':_0x4dedf0='EXPIRED';break;case _0x2827e9(0x1a4):_0x4dedf0='FAILED';!_0x189a28&&_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x14d)]&&(_0x189a28=_0xfdf848[_0x2827e9(0x19c)][_0x2827e9(0x14d)]);break;case'NEW':case'ACT':default:_0x4dedf0=_0x2827e9(0x192);break;}break;}const _0x4163c0={};return _0xfdf848['data']?.[_0x2827e9(0x15b)]?.['last4']&&(_0x4163c0[_0x2827e9(0x150)]=_0xfdf848[_0x2827e9(0x19c)][_0x2827e9(0x15b)][_0x2827e9(0x178)]),_0xfdf848['data']?.[_0x2827e9(0x14b)]&&(_0x4163c0['paymentMethod']=_0xfdf848[_0x2827e9(0x19c)][_0x2827e9(0x14b)]),_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x153)]&&(_0x4163c0[_0x2827e9(0x159)]=_0xfdf848[_0x2827e9(0x19c)][_0x2827e9(0x153)]),_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x134)]&&(_0x4163c0[_0x2827e9(0x191)]=_0xfdf848[_0x2827e9(0x19c)][_0x2827e9(0x134)]),console[_0x2827e9(0x136)]('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x4dedf0+',\x20failureMessage='+(_0x189a28||_0x2827e9(0x181))),{'paymentId':_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x17f)]||'','status':_0x4dedf0,'amount':_0xfdf848[_0x2827e9(0x19c)]?.[_0x2827e9(0x156)],'currency':_0xfdf848[_0x2827e9(0x19c)]?.['currency'],'failureMessage':_0x189a28,'additionalInfo':_0x4163c0};}}function a49_0x4447(){const _0x13b5f7=['message','1161801fijFfX','RapydService','URL:','GET','expiration','POST','/v1/hosted/payment_links','291YqPJee','headers','HTTP\x20error!\x20status:\x20','Redirect\x20URL:','Unknown\x20error','ORDER:\x20','payment_method_type','\x20(GB\x20-\x20Britain)','failure_message','Rapyd\x20API\x20error:\x20','stringify','cardLast4','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','paid','error_code','rapyd','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','amount','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','CAN','errorCode','/v1/hosted/payment_links/','payment_method_data','fixed_side','logWhiteDomainRequest','floor','CLO','entries','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','PAID','Response\x20data:','Raw\x20Response\x20Body:','logWhiteDomainResponse','576588kvmgKD','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','Error\x20Message:','Error\x20message:','3351804gVtXjl','PAYMENT_EXPIRED','error','https://tesoft.uk/gateway/fail.php?id=','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','üí•\x20Rapyd\x20failure\x20message:\x20','loggerService','4OnbsZb','Rapyd\x20payment\x20verification\x20error:','Status\x20Text:','TesSoft\x20Payment\x20System/1.0','Error\x20stack:','json','last4','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','\x20->\x20EUR:','redirect_url','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','\x20\x20\x20requested_currency:\x20EUR','NEW','merchant_reference_id','):\x20','none','toUpperCase','currency','https://tesoft.uk/gateway/rapyd/','SUCCESS','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===',',\x20body:\x20','text','Full\x20Error\x20Data:','\x20\x20\x20fixed_side:\x20buy','PAYMENT_CANCELED','Business\x20Error\x20(','processWebhook','Unknown\x20error\x20from\x20Rapyd\x20API','apiUrl','failureCode','PENDING','type','status','382ciWgXE','Parsed\x20Result:','defineProperty','UNKNOWN','7419209gcqALj','EXP','===\x20RAPYD\x20SUCCESS\x20===','data','Failed\x20to\x20parse\x20JSON\x20response:','now','2993470qzUAJA','ACT','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','application/json','EUR','ERR','statusText','Payment\x20Link\x20ID:','PAYMENT_FAILED','FAILED','3150120zxUlVB','8xXgMtH','failure_code','createPaymentLink','log','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Error\x20details:','===\x20RAPYD\x20API\x20ERROR\x20===','EXPIRED','\x20\x20\x20expiration:\x20','gb_visa_card'];a49_0x4447=function(){return _0x13b5f7;};return a49_0x4447();}exports[a49_0x49e5ab(0x13f)]=RapydService;