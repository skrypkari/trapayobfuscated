'use strict';const a42_0x432c4e=a42_0x27e6;(function(_0x10bd35,_0x410d7f){const _0x59e513=a42_0x27e6,_0xe05fd0=_0x10bd35();while(!![]){try{const _0x11daf4=-parseInt(_0x59e513(0x138))/0x1*(parseInt(_0x59e513(0xfb))/0x2)+-parseInt(_0x59e513(0x13f))/0x3+-parseInt(_0x59e513(0xe0))/0x4+parseInt(_0x59e513(0x139))/0x5+-parseInt(_0x59e513(0xe4))/0x6+parseInt(_0x59e513(0xfe))/0x7+-parseInt(_0x59e513(0xe6))/0x8*(-parseInt(_0x59e513(0x133))/0x9);if(_0x11daf4===_0x410d7f)break;else _0xe05fd0['push'](_0xe05fd0['shift']());}catch(_0x1468f4){_0xe05fd0['push'](_0xe05fd0['shift']());}}}(a42_0x205c,0x369f4));function a42_0x205c(){const _0x32cda8=['===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Raw\x20Response\x20Body:','error_code','paid','merchant_reference_id','PAID','NEW','/v1/hosted/payment_links','logWhiteDomainResponse','Error\x20stack:','now','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','../loggerService','entries','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20Code:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Parsed\x20Result:','parse','):\x20','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/success.php?id=','FAILED','amount','\x20(always\x20GB\x20for\x20Rapyd)','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','===\x20RAPYD\x20API\x20ERROR\x20===','Redirect\x20URL:','ACT','Unknown\x20error','HTTP\x20error!\x20status:\x20','HTTP\x20','apiUrl','PENDING','application/json','statusText','Status\x20Text:','Failed\x20to\x20parse\x20JSON\x20response:','PAYMENT_EXPIRED','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','26388ushvZn','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','EXPIRED','currency','Unknown\x20error\x20from\x20Rapyd\x20API','21240RENIIG','1983695QqzWSB','text','stack','Rapyd\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','Processing\x20Rapyd\x20webhook:','1036914bdexGo','Headers:','toUpperCase','UNKNOWN','1039044RmksrP','Error\x20details:','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','/v1/hosted/payment_links/','2659428GAAjwp','Response\x20Body:','2968XAVeRB','GET','ERR','headers','POST','message','\x20(GB\x20-\x20Britain)','data','Response\x20data:','createPaymentLink','verifyPayment','logWhiteDomainRequest','type','logWhiteDomainError','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','processWebhook','CLO','RapydService','log','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','üá¨üáß\x20Country\x20used:\x20','40WzOhNh','rapyd','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','1488606XiQxxe','===\x20RAPYD\x20SUCCESS\x20===','EXP','Rapyd\x20payment\x20verification\x20error:','loggerService','error','SUCCESS','stringify','redirect_url','URL:','status','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url'];a42_0x205c=function(){return _0x32cda8;};return a42_0x205c();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a42_0x432c4e(0xf7)]=void 0x0;function a42_0x27e6(_0x22a46d,_0x202989){const _0x205cba=a42_0x205c();return a42_0x27e6=function(_0x27e607,_0x1b618f){_0x27e607=_0x27e607-0xde;let _0xc58258=_0x205cba[_0x27e607];return _0xc58258;},a42_0x27e6(_0x22a46d,_0x202989);}const loggerService_1=require(a42_0x432c4e(0x116));class RapydService{constructor(){const _0x10cf7c=a42_0x432c4e;this[_0x10cf7c(0x12b)]='https://tesoft.uk/gateway/rapyd/',console['log'](_0x10cf7c(0x118));}async[a42_0x432c4e(0xef)](_0x5e7873){const _0x2652fd=a42_0x432c4e,{orderId:_0x1833bd,orderName:_0x5efd21,amount:_0x52ad30,currency:_0x4f2f02,usage:_0x40a2a6,maxPayments:_0x3c8502,successUrl:_0x29173f,failUrl:_0x49e8a2}=_0x5e7873,_0x235a86=_0x4f2f02[_0x2652fd(0xde)](),_0x2bac52='GB';console['log'](_0x2652fd(0xf9));const _0x20846e=_0x2652fd(0x120)+_0x1833bd,_0x5ad594='https://tesoft.uk/gateway/fail.php?id='+_0x1833bd,_0x387dbe={'amount':_0x52ad30,'cancel_checkout_url':_0x5ad594,'complete_checkout_url':_0x20846e,'complete_payment_url':_0x20846e,'merchant_reference_id':_0x1833bd,'description':'ORDER:\x20'+_0x1833bd,'payment_method_types_include':['gb_visa_card','gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x365e5e=Date['now']();try{console[_0x2652fd(0xf8)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x2652fd(0xf8)](_0x2652fd(0x107),this[_0x2652fd(0x12b)]),console[_0x2652fd(0xf8)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x2652fd(0x105)](_0x387dbe,null,0x2)),console[_0x2652fd(0xf8)]('üá¨üáß\x20Country:\x20'+_0x2bac52+_0x2652fd(0x123)),console['log'](_0x2652fd(0xf4)),loggerService_1[_0x2652fd(0x102)][_0x2652fd(0xf1)](_0x2652fd(0xfc),'/v1/hosted/payment_links',_0x2652fd(0xea),_0x387dbe);const _0x3086e0=await fetch(this[_0x2652fd(0x12b)],{'method':_0x2652fd(0xea),'headers':{'Content-Type':'application/json','User-Agent':_0x2652fd(0x13d)},'body':JSON[_0x2652fd(0x105)](_0x387dbe)}),_0x1f45e2=Date[_0x2652fd(0x114)]()-_0x365e5e;console[_0x2652fd(0xf8)](_0x2652fd(0x11a)),console['log']('Status:',_0x3086e0['status']),console['log'](_0x2652fd(0x12f),_0x3086e0[_0x2652fd(0x12e)]),console['log'](_0x2652fd(0x140),Object['fromEntries'](_0x3086e0[_0x2652fd(0xe9)][_0x2652fd(0x117)]())),console['log']('Response\x20Time:',_0x1f45e2+'ms');const _0x1497b7=await _0x3086e0[_0x2652fd(0x13a)]();console[_0x2652fd(0xf8)](_0x2652fd(0x10b),_0x1497b7);if(!_0x3086e0['ok']){console['error'](_0x2652fd(0x125)),console[_0x2652fd(0x103)]('HTTP\x20Status:',_0x3086e0[_0x2652fd(0x108)]),console['error'](_0x2652fd(0xe5),_0x1497b7),loggerService_1['loggerService'][_0x2652fd(0x112)](_0x2652fd(0xfc),_0x2652fd(0x111),_0x3086e0[_0x2652fd(0x108)],_0x1497b7,_0x1f45e2),loggerService_1[_0x2652fd(0x102)][_0x2652fd(0xf3)]('rapyd',_0x2652fd(0x111),_0x2652fd(0x12a)+_0x3086e0[_0x2652fd(0x108)]+':\x20'+_0x1497b7);throw new Error(_0x2652fd(0x129)+_0x3086e0[_0x2652fd(0x108)]+',\x20body:\x20'+_0x1497b7);}let _0x344b6b;try{_0x344b6b=JSON[_0x2652fd(0x11d)](_0x1497b7);}catch(_0x529cb2){console[_0x2652fd(0x103)](_0x2652fd(0x130),_0x529cb2),loggerService_1[_0x2652fd(0x102)]['logWhiteDomainError'](_0x2652fd(0xfc),_0x2652fd(0x111),_0x2652fd(0x11f)+_0x529cb2);throw new Error(_0x2652fd(0x134)+_0x1497b7);}console[_0x2652fd(0xf8)](_0x2652fd(0xe2)),console[_0x2652fd(0xf8)](_0x2652fd(0x11c),JSON[_0x2652fd(0x105)](_0x344b6b,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2652fd(0xfc),_0x2652fd(0x111),_0x3086e0[_0x2652fd(0x108)],_0x344b6b,_0x1f45e2);if(_0x344b6b[_0x2652fd(0x108)]?.[_0x2652fd(0x108)]!==_0x2652fd(0x104)){const _0x67e0b5=_0x344b6b['status']?.[_0x2652fd(0xeb)]||_0x2652fd(0x137),_0x39b16c=_0x344b6b[_0x2652fd(0x108)]?.[_0x2652fd(0x10c)]||_0x2652fd(0xdf);console[_0x2652fd(0x103)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2652fd(0x103)](_0x2652fd(0x119),_0x39b16c),console['error']('Error\x20Message:',_0x67e0b5),console[_0x2652fd(0x103)]('Full\x20Error\x20Data:',_0x344b6b[_0x2652fd(0x108)]),loggerService_1[_0x2652fd(0x102)][_0x2652fd(0xf3)](_0x2652fd(0xfc),_0x2652fd(0x111),'Business\x20Error\x20('+_0x39b16c+_0x2652fd(0x11e)+_0x67e0b5);throw new Error('Rapyd\x20API\x20error\x20('+_0x39b16c+_0x2652fd(0x11e)+_0x67e0b5);}if(!_0x344b6b['data']?.['id']||!_0x344b6b[_0x2652fd(0xed)]?.[_0x2652fd(0x106)]){console[_0x2652fd(0x103)](_0x2652fd(0x10a)),console[_0x2652fd(0x103)](_0x2652fd(0x11b)),console[_0x2652fd(0x103)](_0x2652fd(0xee),_0x344b6b[_0x2652fd(0xed)]),loggerService_1[_0x2652fd(0x102)][_0x2652fd(0xf3)](_0x2652fd(0xfc),_0x2652fd(0x111),_0x2652fd(0x115));throw new Error(_0x2652fd(0x109));}return console[_0x2652fd(0xf8)](_0x2652fd(0xff)),console[_0x2652fd(0xf8)]('Payment\x20Link\x20ID:',_0x344b6b[_0x2652fd(0xed)]['id']),console[_0x2652fd(0xf8)](_0x2652fd(0x126),_0x344b6b['data'][_0x2652fd(0x106)]),console[_0x2652fd(0xf8)](_0x2652fd(0xfa)+_0x2bac52+_0x2652fd(0xec)),console[_0x2652fd(0xf8)](_0x2652fd(0xf4)),{'gateway_payment_id':_0x344b6b[_0x2652fd(0xed)]['id'],'payment_url':_0x344b6b[_0x2652fd(0xed)][_0x2652fd(0x106)]};}catch(_0x83d509){console[_0x2652fd(0x103)](_0x2652fd(0xfd)),console[_0x2652fd(0x103)](_0x2652fd(0xe1),_0x83d509),loggerService_1['loggerService']['logWhiteDomainError'](_0x2652fd(0xfc),'/v1/hosted/payment_links',_0x83d509);if(_0x83d509 instanceof Error){console[_0x2652fd(0x103)]('Error\x20message:',_0x83d509[_0x2652fd(0xeb)]),console[_0x2652fd(0x103)](_0x2652fd(0x113),_0x83d509[_0x2652fd(0x13b)]);throw new Error(_0x2652fd(0x124)+_0x83d509[_0x2652fd(0xeb)]);}throw new Error(_0x2652fd(0x132));}}async[a42_0x432c4e(0xf0)](_0x3c806b){const _0x476665=a42_0x432c4e,_0x51003e=Date[_0x476665(0x114)]();try{loggerService_1[_0x476665(0x102)][_0x476665(0xf1)](_0x476665(0xfc),_0x476665(0xe3)+_0x3c806b,_0x476665(0xe7),{});const _0x5e35d1=await fetch(this['apiUrl']+'/'+_0x3c806b,{'method':_0x476665(0xe7),'headers':{'Content-Type':_0x476665(0x12d),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4046cd=Date[_0x476665(0x114)]()-_0x51003e;if(!_0x5e35d1['ok']){const _0x4aab02=await _0x5e35d1['text']();loggerService_1[_0x476665(0x102)][_0x476665(0x112)](_0x476665(0xfc),_0x476665(0xe3)+_0x3c806b,_0x5e35d1['status'],_0x4aab02,_0x4046cd);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5e35d1[_0x476665(0x108)]);}const _0x257039=await _0x5e35d1['json']();loggerService_1[_0x476665(0x102)][_0x476665(0x112)](_0x476665(0xfc),_0x476665(0xe3)+_0x3c806b,_0x5e35d1[_0x476665(0x108)],_0x257039,_0x4046cd);if(_0x257039[_0x476665(0x108)]?.[_0x476665(0x108)]!=='SUCCESS'){loggerService_1[_0x476665(0x102)][_0x476665(0xf3)](_0x476665(0xfc),_0x476665(0xe3)+_0x3c806b,_0x476665(0x13c)+(_0x257039[_0x476665(0x108)]?.['message']||_0x476665(0x128)));throw new Error(_0x476665(0x13c)+(_0x257039[_0x476665(0x108)]?.[_0x476665(0xeb)]||_0x476665(0x128)));}let _0x51058d=_0x476665(0x12c);if(_0x257039[_0x476665(0xed)]?.['status'])switch(_0x257039[_0x476665(0xed)][_0x476665(0x108)][_0x476665(0xde)]()){case _0x476665(0xf6):_0x51058d=_0x476665(0x10f);break;case'CAN':_0x51058d=_0x476665(0x121);break;case _0x476665(0x100):_0x51058d='EXPIRED';break;case _0x476665(0xe8):_0x51058d=_0x476665(0x121);break;case _0x476665(0x110):case _0x476665(0x127):default:_0x51058d=_0x476665(0x12c);break;}return{'status':_0x51058d,'amount':_0x257039[_0x476665(0xed)]?.['amount'],'currency':_0x257039['data']?.['currency']};}catch(_0x59e057){console[_0x476665(0x103)](_0x476665(0x101),_0x59e057),loggerService_1[_0x476665(0x102)]['logWhiteDomainError'](_0x476665(0xfc),'/v1/hosted/payment_links/'+_0x3c806b,_0x59e057);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x59e057 instanceof Error?_0x59e057[_0x476665(0xeb)]:_0x476665(0x128)));}}async[a42_0x432c4e(0xf5)](_0x21146a){const _0x242df7=a42_0x432c4e;console[_0x242df7(0xf8)](_0x242df7(0x13e),_0x21146a);let _0x313fce='PENDING';switch(_0x21146a[_0x242df7(0xf2)]?.[_0x242df7(0xde)]()){case'PAYMENT_COMPLETED':_0x21146a['data']?.['paid']===!![]&&_0x21146a[_0x242df7(0xed)]?.['status']==='CLO'?_0x313fce=_0x242df7(0x10f):_0x313fce=_0x242df7(0x12c);break;case'PAYMENT_CANCELED':_0x313fce=_0x242df7(0x121);break;case _0x242df7(0x131):_0x313fce=_0x242df7(0x135);break;case'PAYMENT_FAILED':_0x313fce=_0x242df7(0x121);break;default:switch(_0x21146a[_0x242df7(0xed)]?.[_0x242df7(0x108)]?.[_0x242df7(0xde)]()){case _0x242df7(0xf6):_0x21146a[_0x242df7(0xed)]?.[_0x242df7(0x10d)]===!![]?_0x313fce=_0x242df7(0x10f):_0x313fce=_0x242df7(0x121);break;case'CAN':_0x313fce=_0x242df7(0x121);break;case _0x242df7(0x100):_0x313fce=_0x242df7(0x135);break;case _0x242df7(0xe8):_0x313fce='FAILED';break;case _0x242df7(0x110):case _0x242df7(0x127):default:_0x313fce=_0x242df7(0x12c);break;}break;}return{'paymentId':_0x21146a[_0x242df7(0xed)]?.[_0x242df7(0x10e)]||'','status':_0x313fce,'amount':_0x21146a[_0x242df7(0xed)]?.[_0x242df7(0x122)],'currency':_0x21146a['data']?.[_0x242df7(0x136)]};}}exports['RapydService']=RapydService;