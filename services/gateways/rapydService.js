'use strict';const a48_0x33a823=a48_0x276e;(function(_0x17d571,_0x59aa34){const _0x28f4ee=a48_0x276e,_0x9d4d29=_0x17d571();while(!![]){try{const _0x440332=parseInt(_0x28f4ee(0x139))/0x1+-parseInt(_0x28f4ee(0x13a))/0x2+parseInt(_0x28f4ee(0x177))/0x3*(parseInt(_0x28f4ee(0x174))/0x4)+parseInt(_0x28f4ee(0x10c))/0x5+parseInt(_0x28f4ee(0x133))/0x6+parseInt(_0x28f4ee(0x163))/0x7+-parseInt(_0x28f4ee(0x17a))/0x8*(parseInt(_0x28f4ee(0x146))/0x9);if(_0x440332===_0x59aa34)break;else _0x9d4d29['push'](_0x9d4d29['shift']());}catch(_0x27b921){_0x9d4d29['push'](_0x9d4d29['shift']());}}}(a48_0x2c9d,0xbc43c));function a48_0x276e(_0x9a59b8,_0x9c27d3){const _0x2c9d35=a48_0x2c9d();return a48_0x276e=function(_0x276e1e,_0x261720){_0x276e1e=_0x276e1e-0x109;let _0x15545a=_0x2c9d35[_0x276e1e];return _0x15545a;},a48_0x276e(_0x9a59b8,_0x9c27d3);}Object['defineProperty'](exports,a48_0x33a823(0x12c),{'value':!![]}),exports[a48_0x33a823(0x172)]=void 0x0;function a48_0x2c9d(){const _0x22c1d3=['EXP','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','NEW','loggerService','1864555AAFFRx','payment_method_type','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','amount','logWhiteDomainError','Unknown\x20error','now','PAYMENT_EXPIRED','🇬🇧\x20Country:\x20','PAYMENT_COMPLETED','🇬🇧\x20Country\x20used:\x20','GET','redirect_url','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','UNKNOWN','TesSoft\x20Payment\x20System/1.0','Parsed\x20Result:','):\x20','../loggerService','fixed_side','ERR','HTTP\x20Status:',',\x20failureMessage=','Payment\x20Link\x20ID:','Status\x20Text:','Error\x20stack:','HTTP\x20error!\x20status:\x20','message','createPaymentLink','failure_code','headers','expiration','__esModule','paymentMethod','ORDER:\x20','failureCode','\x20(GB\x20-\x20Britain)','CAN','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','8831376shquBJ','Processing\x20Rapyd\x20webhook:','PAYMENT_FAILED','application/json','toUpperCase','Response\x20Body:','738302bJcmRx','1908612EOAAkN','error_code','Error\x20Message:','\x20\x20\x20expiration:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20Time:','/v1/hosted/payment_links/','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','log','statusText','\x20\x20\x20requested_currency:\x20EUR','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','9YAiYob','https://tesoft.uk/gateway/fail.php?id=','apiUrl','\x20(always\x20GB\x20for\x20Rapyd)','logWhiteDomainResponse','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','POST','Unknown\x20error\x20from\x20Rapyd\x20API','data','HTTP\x20','json','status','https://tesoft.uk/gateway/success.php?id=','Redirect\x20URL:','ACT','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','\x20\x20\x20fixed_side:\x20buy','PENDING','type','PAYMENT_CANCELED','URL:','SUCCESS','processWebhook','EUR','rapyd','FAILED','Rapyd\x20API\x20error\x20(','cardLast4','stringify','7565383RLGnMv','text','toISOString','logWhiteDomainRequest','requested_currency','Rapyd\x20API\x20error:\x20','payment_method_data','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','PAID','Raw\x20Response\x20Body:','last4','parse','floor','verifyPayment','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','RapydService','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','5156usaSJe','Response\x20data:','failure_message','2223oXsDbb','merchant_reference_id','error','23148712Odkkju','CLO','buy','/v1/hosted/payment_links','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===',',\x20body:\x20'];a48_0x2c9d=function(){return _0x22c1d3;};return a48_0x2c9d();}const loggerService_1=require(a48_0x33a823(0x11e));class RapydService{constructor(){const _0x5940f5=a48_0x33a823;this['apiUrl']='https://tesoft.uk/gateway/rapyd/',console[_0x5940f5(0x142)](_0x5940f5(0x145));}async[a48_0x33a823(0x128)](_0x34bc2b){const _0x2f3adf=a48_0x33a823,{orderId:_0x33c086,orderName:_0x459c90,amount:_0x48b10a,currency:_0x44ac4d,usage:_0x5b63b3,maxPayments:_0x5bcfc,successUrl:_0x2def37,failUrl:_0x479385}=_0x34bc2b,_0x34b75d=_0x44ac4d[_0x2f3adf(0x137)](),_0x1e376c='GB';console[_0x2f3adf(0x142)](_0x2f3adf(0x132));const _0x41c66f=_0x2f3adf(0x152)+_0x33c086,_0x62638d=_0x2f3adf(0x147)+_0x33c086,_0x508bf7={'amount':_0x48b10a,'currency':_0x34b75d,'cancel_checkout_url':_0x62638d,'complete_checkout_url':_0x41c66f,'complete_payment_url':_0x41c66f,'merchant_reference_id':_0x33c086,'description':_0x2f3adf(0x12e)+_0x33c086,'country':'GB','payment_method_types_include':['gb_visa_card','gb_mastercard_card'],'custom_elements':{'display_description':!![]}};if(_0x34b75d!=='EUR'){const _0x5a2986=Math[_0x2f3adf(0x16f)](Date[_0x2f3adf(0x112)]()/0x3e8)+0x1e*0x3c;_0x508bf7[_0x2f3adf(0x11f)]=_0x2f3adf(0x17c),_0x508bf7[_0x2f3adf(0x167)]=_0x2f3adf(0x15d),_0x508bf7[_0x2f3adf(0x12b)]=_0x5a2986,console[_0x2f3adf(0x142)](_0x2f3adf(0x16a)+_0x34b75d+'\x20->\x20EUR:'),console[_0x2f3adf(0x142)](_0x2f3adf(0x156)),console[_0x2f3adf(0x142)](_0x2f3adf(0x144)),console['log'](_0x2f3adf(0x13d)+_0x5a2986+'\x20('+new Date(_0x5a2986*0x3e8)[_0x2f3adf(0x165)]()+')');}const _0x1369ba=Date[_0x2f3adf(0x112)]();try{console[_0x2f3adf(0x142)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x2f3adf(0x142)](_0x2f3adf(0x15a),this['apiUrl']),console['log']('Request\x20Body\x20(Updated\x20Format):',JSON[_0x2f3adf(0x162)](_0x508bf7,null,0x2)),console[_0x2f3adf(0x142)](_0x2f3adf(0x114)+_0x1e376c+_0x2f3adf(0x149)),console[_0x2f3adf(0x142)](_0x2f3adf(0x173)),loggerService_1[_0x2f3adf(0x10b)][_0x2f3adf(0x166)]('rapyd',_0x2f3adf(0x17d),_0x2f3adf(0x14c),_0x508bf7);const _0x1d0206=await fetch(this[_0x2f3adf(0x148)],{'method':'POST','headers':{'Content-Type':_0x2f3adf(0x136),'User-Agent':_0x2f3adf(0x11b)},'body':JSON[_0x2f3adf(0x162)](_0x508bf7)}),_0x2ca2d4=Date[_0x2f3adf(0x112)]()-_0x1369ba;console['log'](_0x2f3adf(0x119)),console[_0x2f3adf(0x142)]('Status:',_0x1d0206[_0x2f3adf(0x151)]),console[_0x2f3adf(0x142)](_0x2f3adf(0x124),_0x1d0206[_0x2f3adf(0x143)]),console[_0x2f3adf(0x142)]('Headers:',Object['fromEntries'](_0x1d0206[_0x2f3adf(0x12a)]['entries']())),console['log'](_0x2f3adf(0x13f),_0x2ca2d4+'ms');const _0x28413=await _0x1d0206['text']();console[_0x2f3adf(0x142)](_0x2f3adf(0x16c),_0x28413);if(!_0x1d0206['ok']){console[_0x2f3adf(0x179)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console['error'](_0x2f3adf(0x121),_0x1d0206['status']),console[_0x2f3adf(0x179)](_0x2f3adf(0x138),_0x28413),loggerService_1[_0x2f3adf(0x10b)][_0x2f3adf(0x14a)](_0x2f3adf(0x15e),_0x2f3adf(0x17d),_0x1d0206[_0x2f3adf(0x151)],_0x28413,_0x2ca2d4),loggerService_1[_0x2f3adf(0x10b)][_0x2f3adf(0x110)]('rapyd',_0x2f3adf(0x17d),_0x2f3adf(0x14f)+_0x1d0206['status']+':\x20'+_0x28413);throw new Error(_0x2f3adf(0x126)+_0x1d0206[_0x2f3adf(0x151)]+_0x2f3adf(0x180)+_0x28413);}let _0x2d86f4;try{_0x2d86f4=JSON[_0x2f3adf(0x16e)](_0x28413);}catch(_0x58f7fe){console[_0x2f3adf(0x179)](_0x2f3adf(0x13e),_0x58f7fe),loggerService_1[_0x2f3adf(0x10b)][_0x2f3adf(0x110)]('rapyd',_0x2f3adf(0x17d),'JSON\x20Parse\x20Error:\x20'+_0x58f7fe);throw new Error(_0x2f3adf(0x141)+_0x28413);}console[_0x2f3adf(0x142)](_0x2f3adf(0x109)),console[_0x2f3adf(0x142)](_0x2f3adf(0x11c),JSON[_0x2f3adf(0x162)](_0x2d86f4,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2f3adf(0x15e),_0x2f3adf(0x17d),_0x1d0206[_0x2f3adf(0x151)],_0x2d86f4,_0x2ca2d4);if(_0x2d86f4['status']?.[_0x2f3adf(0x151)]!==_0x2f3adf(0x15b)){const _0x5d394d=_0x2d86f4['status']?.['message']||_0x2f3adf(0x14d),_0x5a987c=_0x2d86f4[_0x2f3adf(0x151)]?.[_0x2f3adf(0x13b)]||_0x2f3adf(0x11a);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2f3adf(0x179)]('Error\x20Code:',_0x5a987c),console[_0x2f3adf(0x179)](_0x2f3adf(0x13c),_0x5d394d),console[_0x2f3adf(0x179)]('Full\x20Error\x20Data:',_0x2d86f4[_0x2f3adf(0x151)]),loggerService_1['loggerService']['logWhiteDomainError']('rapyd','/v1/hosted/payment_links','Business\x20Error\x20('+_0x5a987c+_0x2f3adf(0x11d)+_0x5d394d);throw new Error(_0x2f3adf(0x160)+_0x5a987c+'):\x20'+_0x5d394d);}if(!_0x2d86f4[_0x2f3adf(0x14e)]?.['id']||!_0x2d86f4[_0x2f3adf(0x14e)]?.[_0x2f3adf(0x118)]){console[_0x2f3adf(0x179)](_0x2f3adf(0x17f)),console[_0x2f3adf(0x179)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console['error'](_0x2f3adf(0x175),_0x2d86f4[_0x2f3adf(0x14e)]),loggerService_1[_0x2f3adf(0x10b)]['logWhiteDomainError']('rapyd',_0x2f3adf(0x17d),_0x2f3adf(0x17e));throw new Error(_0x2f3adf(0x171));}return console['log']('===\x20RAPYD\x20SUCCESS\x20==='),console['log'](_0x2f3adf(0x123),_0x2d86f4[_0x2f3adf(0x14e)]['id']),console[_0x2f3adf(0x142)](_0x2f3adf(0x153),_0x2d86f4[_0x2f3adf(0x14e)][_0x2f3adf(0x118)]),console[_0x2f3adf(0x142)](_0x2f3adf(0x116)+_0x1e376c+_0x2f3adf(0x130)),console[_0x2f3adf(0x142)]('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x2d86f4[_0x2f3adf(0x14e)]['id'],'payment_url':_0x2d86f4[_0x2f3adf(0x14e)][_0x2f3adf(0x118)]};}catch(_0x2d0de5){console[_0x2f3adf(0x179)](_0x2f3adf(0x14b)),console['error']('Error\x20details:',_0x2d0de5),loggerService_1[_0x2f3adf(0x10b)][_0x2f3adf(0x110)]('rapyd','/v1/hosted/payment_links',_0x2d0de5);if(_0x2d0de5 instanceof Error){console[_0x2f3adf(0x179)]('Error\x20message:',_0x2d0de5[_0x2f3adf(0x127)]),console[_0x2f3adf(0x179)](_0x2f3adf(0x125),_0x2d0de5['stack']);throw new Error(_0x2f3adf(0x155)+_0x2d0de5[_0x2f3adf(0x127)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a48_0x33a823(0x170)](_0x484efc){const _0x386f2c=a48_0x33a823,_0x1786df=Date[_0x386f2c(0x112)]();try{loggerService_1['loggerService'][_0x386f2c(0x166)](_0x386f2c(0x15e),'/v1/hosted/payment_links/'+_0x484efc,_0x386f2c(0x117),{});const _0x221946=await fetch(this[_0x386f2c(0x148)]+'/'+_0x484efc,{'method':_0x386f2c(0x117),'headers':{'Content-Type':'application/json','User-Agent':_0x386f2c(0x11b)}}),_0x7f7a08=Date[_0x386f2c(0x112)]()-_0x1786df;if(!_0x221946['ok']){const _0x53ce0b=await _0x221946[_0x386f2c(0x164)]();loggerService_1[_0x386f2c(0x10b)][_0x386f2c(0x14a)]('rapyd',_0x386f2c(0x140)+_0x484efc,_0x221946[_0x386f2c(0x151)],_0x53ce0b,_0x7f7a08);throw new Error(_0x386f2c(0x126)+_0x221946[_0x386f2c(0x151)]);}const _0x5f1966=await _0x221946[_0x386f2c(0x150)]();loggerService_1[_0x386f2c(0x10b)][_0x386f2c(0x14a)](_0x386f2c(0x15e),_0x386f2c(0x140)+_0x484efc,_0x221946[_0x386f2c(0x151)],_0x5f1966,_0x7f7a08);if(_0x5f1966['status']?.[_0x386f2c(0x151)]!==_0x386f2c(0x15b)){loggerService_1[_0x386f2c(0x10b)][_0x386f2c(0x110)](_0x386f2c(0x15e),_0x386f2c(0x140)+_0x484efc,_0x386f2c(0x168)+(_0x5f1966['status']?.[_0x386f2c(0x127)]||_0x386f2c(0x111)));throw new Error(_0x386f2c(0x168)+(_0x5f1966[_0x386f2c(0x151)]?.[_0x386f2c(0x127)]||'Unknown\x20error'));}let _0x8f084a=_0x386f2c(0x157);if(_0x5f1966[_0x386f2c(0x14e)]?.[_0x386f2c(0x151)])switch(_0x5f1966[_0x386f2c(0x14e)][_0x386f2c(0x151)]['toUpperCase']()){case _0x386f2c(0x17b):_0x8f084a='PAID';break;case _0x386f2c(0x131):_0x8f084a='FAILED';break;case _0x386f2c(0x181):_0x8f084a='EXPIRED';break;case'ERR':_0x8f084a=_0x386f2c(0x15f);break;case _0x386f2c(0x10a):case _0x386f2c(0x154):default:_0x8f084a=_0x386f2c(0x157);break;}return{'status':_0x8f084a,'amount':_0x5f1966['data']?.[_0x386f2c(0x10f)],'currency':_0x5f1966[_0x386f2c(0x14e)]?.['currency']};}catch(_0x206488){console['error']('Rapyd\x20payment\x20verification\x20error:',_0x206488),loggerService_1[_0x386f2c(0x10b)][_0x386f2c(0x110)](_0x386f2c(0x15e),'/v1/hosted/payment_links/'+_0x484efc,_0x206488);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x206488 instanceof Error?_0x206488[_0x386f2c(0x127)]:'Unknown\x20error'));}}async[a48_0x33a823(0x15c)](_0x4e1967){const _0x5359e4=a48_0x33a823;console[_0x5359e4(0x142)](_0x5359e4(0x134),_0x4e1967);let _0x2712bd=_0x5359e4(0x157),_0x5a6540;_0x4e1967['data']?.[_0x5359e4(0x176)]&&(_0x5a6540=_0x4e1967['data'][_0x5359e4(0x176)],console[_0x5359e4(0x142)]('💥\x20Rapyd\x20failure\x20message:\x20'+_0x5a6540));switch(_0x4e1967[_0x5359e4(0x158)]?.[_0x5359e4(0x137)]()){case _0x5359e4(0x115):_0x4e1967[_0x5359e4(0x14e)]?.['paid']===!![]&&_0x4e1967[_0x5359e4(0x14e)]?.['status']===_0x5359e4(0x17b)?_0x2712bd=_0x5359e4(0x16b):_0x2712bd=_0x5359e4(0x157);break;case _0x5359e4(0x159):_0x2712bd=_0x5359e4(0x15f);break;case _0x5359e4(0x113):_0x2712bd='EXPIRED';break;case _0x5359e4(0x135):_0x2712bd=_0x5359e4(0x15f);!_0x5a6540&&_0x4e1967[_0x5359e4(0x14e)]?.[_0x5359e4(0x176)]&&(_0x5a6540=_0x4e1967[_0x5359e4(0x14e)][_0x5359e4(0x176)]);break;default:switch(_0x4e1967[_0x5359e4(0x14e)]?.[_0x5359e4(0x151)]?.[_0x5359e4(0x137)]()){case _0x5359e4(0x17b):_0x4e1967[_0x5359e4(0x14e)]?.['paid']===!![]?_0x2712bd='PAID':_0x2712bd=_0x5359e4(0x15f);break;case'CAN':_0x2712bd=_0x5359e4(0x15f);break;case'EXP':_0x2712bd='EXPIRED';break;case _0x5359e4(0x120):_0x2712bd=_0x5359e4(0x15f);!_0x5a6540&&_0x4e1967[_0x5359e4(0x14e)]?.[_0x5359e4(0x176)]&&(_0x5a6540=_0x4e1967['data'][_0x5359e4(0x176)]);break;case _0x5359e4(0x10a):case _0x5359e4(0x154):default:_0x2712bd=_0x5359e4(0x157);break;}break;}const _0x42c69d={};return _0x4e1967['data']?.['payment_method_data']?.[_0x5359e4(0x16d)]&&(_0x42c69d[_0x5359e4(0x161)]=_0x4e1967[_0x5359e4(0x14e)][_0x5359e4(0x169)]['last4']),_0x4e1967[_0x5359e4(0x14e)]?.[_0x5359e4(0x10d)]&&(_0x42c69d[_0x5359e4(0x12d)]=_0x4e1967[_0x5359e4(0x14e)][_0x5359e4(0x10d)]),_0x4e1967['data']?.[_0x5359e4(0x13b)]&&(_0x42c69d['errorCode']=_0x4e1967[_0x5359e4(0x14e)][_0x5359e4(0x13b)]),_0x4e1967[_0x5359e4(0x14e)]?.[_0x5359e4(0x129)]&&(_0x42c69d[_0x5359e4(0x12f)]=_0x4e1967[_0x5359e4(0x14e)]['failure_code']),console[_0x5359e4(0x142)](_0x5359e4(0x10e)+_0x2712bd+_0x5359e4(0x122)+(_0x5a6540||'none')),{'paymentId':_0x4e1967['data']?.[_0x5359e4(0x178)]||'','status':_0x2712bd,'amount':_0x4e1967[_0x5359e4(0x14e)]?.[_0x5359e4(0x10f)],'currency':_0x4e1967[_0x5359e4(0x14e)]?.['currency'],'failureMessage':_0x5a6540,'additionalInfo':_0x42c69d};}}exports['RapydService']=RapydService;