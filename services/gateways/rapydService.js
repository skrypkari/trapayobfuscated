'use strict';const a41_0x27a9bc=a41_0x49d9;(function(_0x11b8d2,_0x32b8f0){const _0x38b46b=a41_0x49d9,_0x18dd4d=_0x11b8d2();while(!![]){try{const _0x571bcd=parseInt(_0x38b46b(0x15d))/0x1*(parseInt(_0x38b46b(0x12c))/0x2)+parseInt(_0x38b46b(0x111))/0x3*(-parseInt(_0x38b46b(0x12f))/0x4)+parseInt(_0x38b46b(0x110))/0x5*(parseInt(_0x38b46b(0x176))/0x6)+parseInt(_0x38b46b(0x10e))/0x7+-parseInt(_0x38b46b(0x13c))/0x8+-parseInt(_0x38b46b(0x128))/0x9*(parseInt(_0x38b46b(0x151))/0xa)+parseInt(_0x38b46b(0x16d))/0xb;if(_0x571bcd===_0x32b8f0)break;else _0x18dd4d['push'](_0x18dd4d['shift']());}catch(_0x1f8748){_0x18dd4d['push'](_0x18dd4d['shift']());}}}(a41_0x1b88,0xaacc7));Object[a41_0x27a9bc(0x15e)](exports,a41_0x27a9bc(0x154),{'value':!![]}),exports[a41_0x27a9bc(0x118)]=void 0x0;function a41_0x49d9(_0x523961,_0x2e006f){const _0x1b88f2=a41_0x1b88();return a41_0x49d9=function(_0x49d995,_0x326e21){_0x49d995=_0x49d995-0x10c;let _0x34d279=_0x1b88f2[_0x49d995];return _0x34d279;},a41_0x49d9(_0x523961,_0x2e006f);}const loggerService_1=require(a41_0x27a9bc(0x14d));function a41_0x1b88(){const _0x53efa4=['12MIuwDG','Error\x20stack:','NEW','TesSoft\x20Payment\x20System/1.0','HTTP\x20Status:','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Payment\x20Link\x20ID:','createPaymentLink','paid','CAN','Raw\x20Response\x20Body:','logWhiteDomainError','loggerService','5851424grnMgl','Rapyd\x20API\x20error:\x20','https://tesoft.uk/gateway/rapyd/','error_code','ACT','PENDING','Processing\x20Rapyd\x20webhook:','POST','stringify','Response\x20Body:','stack','PAYMENT_FAILED','üá¨üáß\x20Country:\x20',',\x20body:\x20','):\x20','\x20(GB\x20-\x20Britain)','redirect_url','../loggerService','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','Headers:','1300870iQmAOJ','headers','GET','__esModule','SUCCESS','/v1/hosted/payment_links/','PAYMENT_EXPIRED','application/json','Rapyd\x20API\x20error\x20(','toUpperCase','PAID','processWebhook','270782jseSSa','defineProperty','entries','text','logWhiteDomainResponse','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','EXPIRED','Rapyd\x20payment\x20verification\x20error:','EXP','currency','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','error','Unknown\x20error','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','https://tesoft.uk/gateway/success.php?id=','log','5075895stIwQt','\x20(always\x20GB\x20for\x20Rapyd)','PAYMENT_COMPLETED','message','Error\x20Code:','merchant_reference_id','Request\x20Body\x20(Updated\x20Format):','ERR','Unknown\x20error\x20from\x20Rapyd\x20API','6038724NLOdgx','Business\x20Error\x20(','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','4376750tJSkcM','ORDER:\x20','5yiuxim','282477itxbFV','amount','now','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','URL:','Redirect\x20URL:','UNKNOWN','RapydService','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainRequest','fromEntries','gb_mastercard_card','/v1/hosted/payment_links','Response\x20data:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','rapyd','apiUrl','data','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','Error\x20details:','CLO','status','FAILED','45qKdgEx','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Status:','===\x20RAPYD\x20SUCCESS\x20===','2wNJLaL','type','parse'];a41_0x1b88=function(){return _0x53efa4;};return a41_0x1b88();}class RapydService{constructor(){const _0x23d2fa=a41_0x27a9bc;this['apiUrl']=_0x23d2fa(0x13e),console[_0x23d2fa(0x16c)](_0x23d2fa(0x16a));}async[a41_0x27a9bc(0x136)](_0x30baba){const _0x1f4822=a41_0x27a9bc,{orderId:_0x14fec5,orderName:_0x52f9b6,amount:_0x506b36,currency:_0x1dda1c,usage:_0x1eca69,maxPayments:_0x55cd89,successUrl:_0x196faa,failUrl:_0x4f2e5a}=_0x30baba,_0x128c17=_0x1dda1c['toUpperCase'](),_0x5889cd='GB';console[_0x1f4822(0x16c)](_0x1f4822(0x14e));const _0x15d315=_0x1f4822(0x16b)+_0x14fec5,_0xf3c705='https://tesoft.uk/gateway/fail.php?id='+_0x14fec5,_0x201d1b={'amount':_0x506b36,'cancel_checkout_url':_0xf3c705,'complete_checkout_url':_0x15d315,'complete_payment_url':_0x15d315,'merchant_reference_id':_0x14fec5,'description':_0x1f4822(0x10f)+_0x14fec5,'payment_method_types_include':['gb_visa_card',_0x1f4822(0x11c)],'custom_elements':{'display_description':!![]}},_0x2ca093=Date['now']();try{console[_0x1f4822(0x16c)](_0x1f4822(0x14f)),console['log'](_0x1f4822(0x115),this[_0x1f4822(0x121)]),console[_0x1f4822(0x16c)](_0x1f4822(0x173),JSON[_0x1f4822(0x144)](_0x201d1b,null,0x2)),console[_0x1f4822(0x16c)](_0x1f4822(0x148)+_0x5889cd+_0x1f4822(0x16e)),console[_0x1f4822(0x16c)](_0x1f4822(0x10d)),loggerService_1['loggerService'][_0x1f4822(0x11a)]('rapyd',_0x1f4822(0x11d),'POST',_0x201d1b);const _0x4f5b73=await fetch(this[_0x1f4822(0x121)],{'method':_0x1f4822(0x143),'headers':{'Content-Type':_0x1f4822(0x158),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1f4822(0x144)](_0x201d1b)}),_0x102e8c=Date[_0x1f4822(0x113)]()-_0x2ca093;console[_0x1f4822(0x16c)](_0x1f4822(0x11f)),console[_0x1f4822(0x16c)](_0x1f4822(0x12a),_0x4f5b73[_0x1f4822(0x126)]),console['log']('Status\x20Text:',_0x4f5b73['statusText']),console[_0x1f4822(0x16c)](_0x1f4822(0x150),Object[_0x1f4822(0x11b)](_0x4f5b73[_0x1f4822(0x152)][_0x1f4822(0x15f)]())),console[_0x1f4822(0x16c)]('Response\x20Time:',_0x102e8c+'ms');const _0x17f021=await _0x4f5b73[_0x1f4822(0x160)]();console[_0x1f4822(0x16c)](_0x1f4822(0x139),_0x17f021);if(!_0x4f5b73['ok']){console['error']('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x1f4822(0x168)](_0x1f4822(0x133),_0x4f5b73[_0x1f4822(0x126)]),console['error'](_0x1f4822(0x145),_0x17f021),loggerService_1[_0x1f4822(0x13b)][_0x1f4822(0x161)](_0x1f4822(0x120),_0x1f4822(0x11d),_0x4f5b73[_0x1f4822(0x126)],_0x17f021,_0x102e8c),loggerService_1[_0x1f4822(0x13b)]['logWhiteDomainError'](_0x1f4822(0x120),_0x1f4822(0x11d),'HTTP\x20'+_0x4f5b73[_0x1f4822(0x126)]+':\x20'+_0x17f021);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4f5b73[_0x1f4822(0x126)]+_0x1f4822(0x149)+_0x17f021);}let _0x3b9fb2;try{_0x3b9fb2=JSON[_0x1f4822(0x12e)](_0x17f021);}catch(_0x3de850){console[_0x1f4822(0x168)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3de850),loggerService_1[_0x1f4822(0x13b)]['logWhiteDomainError']('rapyd',_0x1f4822(0x11d),'JSON\x20Parse\x20Error:\x20'+_0x3de850);throw new Error(_0x1f4822(0x123)+_0x17f021);}console[_0x1f4822(0x16c)](_0x1f4822(0x114)),console[_0x1f4822(0x16c)]('Parsed\x20Result:',JSON[_0x1f4822(0x144)](_0x3b9fb2,null,0x2)),loggerService_1[_0x1f4822(0x13b)][_0x1f4822(0x161)](_0x1f4822(0x120),_0x1f4822(0x11d),_0x4f5b73[_0x1f4822(0x126)],_0x3b9fb2,_0x102e8c);if(_0x3b9fb2['status']?.[_0x1f4822(0x126)]!==_0x1f4822(0x155)){const _0x49499d=_0x3b9fb2[_0x1f4822(0x126)]?.['message']||_0x1f4822(0x175),_0x26de66=_0x3b9fb2['status']?.[_0x1f4822(0x13f)]||_0x1f4822(0x117);console[_0x1f4822(0x168)](_0x1f4822(0x119)),console[_0x1f4822(0x168)](_0x1f4822(0x171),_0x26de66),console[_0x1f4822(0x168)]('Error\x20Message:',_0x49499d),console[_0x1f4822(0x168)]('Full\x20Error\x20Data:',_0x3b9fb2['status']),loggerService_1['loggerService']['logWhiteDomainError'](_0x1f4822(0x120),_0x1f4822(0x11d),_0x1f4822(0x10c)+_0x26de66+_0x1f4822(0x14a)+_0x49499d);throw new Error(_0x1f4822(0x159)+_0x26de66+_0x1f4822(0x14a)+_0x49499d);}if(!_0x3b9fb2[_0x1f4822(0x122)]?.['id']||!_0x3b9fb2[_0x1f4822(0x122)]?.[_0x1f4822(0x14c)]){console[_0x1f4822(0x168)](_0x1f4822(0x167)),console[_0x1f4822(0x168)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console['error'](_0x1f4822(0x11e),_0x3b9fb2[_0x1f4822(0x122)]),loggerService_1['loggerService'][_0x1f4822(0x13a)](_0x1f4822(0x120),_0x1f4822(0x11d),_0x1f4822(0x134));throw new Error(_0x1f4822(0x162));}return console[_0x1f4822(0x16c)](_0x1f4822(0x12b)),console[_0x1f4822(0x16c)](_0x1f4822(0x135),_0x3b9fb2[_0x1f4822(0x122)]['id']),console['log'](_0x1f4822(0x116),_0x3b9fb2[_0x1f4822(0x122)][_0x1f4822(0x14c)]),console[_0x1f4822(0x16c)]('üá¨üáß\x20Country\x20used:\x20'+_0x5889cd+_0x1f4822(0x14b)),console[_0x1f4822(0x16c)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x3b9fb2[_0x1f4822(0x122)]['id'],'payment_url':_0x3b9fb2[_0x1f4822(0x122)][_0x1f4822(0x14c)]};}catch(_0xc0df14){console[_0x1f4822(0x168)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x1f4822(0x168)](_0x1f4822(0x124),_0xc0df14),loggerService_1[_0x1f4822(0x13b)][_0x1f4822(0x13a)](_0x1f4822(0x120),_0x1f4822(0x11d),_0xc0df14);if(_0xc0df14 instanceof Error){console[_0x1f4822(0x168)]('Error\x20message:',_0xc0df14[_0x1f4822(0x170)]),console[_0x1f4822(0x168)](_0x1f4822(0x130),_0xc0df14[_0x1f4822(0x146)]);throw new Error(_0x1f4822(0x129)+_0xc0df14[_0x1f4822(0x170)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x185223){const _0x182222=a41_0x27a9bc,_0x5a28de=Date[_0x182222(0x113)]();try{loggerService_1[_0x182222(0x13b)]['logWhiteDomainRequest'](_0x182222(0x120),_0x182222(0x156)+_0x185223,_0x182222(0x153),{});const _0x2b8f3f=await fetch(this[_0x182222(0x121)]+'/'+_0x185223,{'method':_0x182222(0x153),'headers':{'Content-Type':_0x182222(0x158),'User-Agent':_0x182222(0x132)}}),_0x517db1=Date[_0x182222(0x113)]()-_0x5a28de;if(!_0x2b8f3f['ok']){const _0x4aa396=await _0x2b8f3f[_0x182222(0x160)]();loggerService_1[_0x182222(0x13b)][_0x182222(0x161)]('rapyd',_0x182222(0x156)+_0x185223,_0x2b8f3f['status'],_0x4aa396,_0x517db1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2b8f3f['status']);}const _0x156497=await _0x2b8f3f['json']();loggerService_1['loggerService'][_0x182222(0x161)](_0x182222(0x120),'/v1/hosted/payment_links/'+_0x185223,_0x2b8f3f[_0x182222(0x126)],_0x156497,_0x517db1);if(_0x156497[_0x182222(0x126)]?.[_0x182222(0x126)]!==_0x182222(0x155)){loggerService_1[_0x182222(0x13b)][_0x182222(0x13a)](_0x182222(0x120),_0x182222(0x156)+_0x185223,_0x182222(0x13d)+(_0x156497[_0x182222(0x126)]?.[_0x182222(0x170)]||_0x182222(0x169)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x156497[_0x182222(0x126)]?.[_0x182222(0x170)]||_0x182222(0x169)));}let _0x1b1297='PENDING';if(_0x156497[_0x182222(0x122)]?.[_0x182222(0x126)])switch(_0x156497[_0x182222(0x122)][_0x182222(0x126)][_0x182222(0x15a)]()){case _0x182222(0x125):_0x1b1297=_0x182222(0x15b);break;case'CAN':_0x1b1297='FAILED';break;case _0x182222(0x165):_0x1b1297=_0x182222(0x163);break;case _0x182222(0x174):_0x1b1297=_0x182222(0x127);break;case _0x182222(0x131):case _0x182222(0x140):default:_0x1b1297=_0x182222(0x141);break;}return{'status':_0x1b1297,'amount':_0x156497[_0x182222(0x122)]?.[_0x182222(0x112)],'currency':_0x156497[_0x182222(0x122)]?.[_0x182222(0x166)]};}catch(_0x2a1f37){console[_0x182222(0x168)](_0x182222(0x164),_0x2a1f37),loggerService_1[_0x182222(0x13b)][_0x182222(0x13a)](_0x182222(0x120),_0x182222(0x156)+_0x185223,_0x2a1f37);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x2a1f37 instanceof Error?_0x2a1f37[_0x182222(0x170)]:_0x182222(0x169)));}}async[a41_0x27a9bc(0x15c)](_0x3e9aa7){const _0x553321=a41_0x27a9bc;console[_0x553321(0x16c)](_0x553321(0x142),_0x3e9aa7);let _0x410133=_0x553321(0x141);switch(_0x3e9aa7[_0x553321(0x12d)]?.[_0x553321(0x15a)]()){case _0x553321(0x16f):_0x3e9aa7[_0x553321(0x122)]?.[_0x553321(0x137)]===!![]&&_0x3e9aa7[_0x553321(0x122)]?.[_0x553321(0x126)]===_0x553321(0x125)?_0x410133='PAID':_0x410133=_0x553321(0x141);break;case'PAYMENT_CANCELED':_0x410133=_0x553321(0x127);break;case _0x553321(0x157):_0x410133=_0x553321(0x163);break;case _0x553321(0x147):_0x410133=_0x553321(0x127);break;default:switch(_0x3e9aa7[_0x553321(0x122)]?.[_0x553321(0x126)]?.[_0x553321(0x15a)]()){case _0x553321(0x125):_0x3e9aa7[_0x553321(0x122)]?.['paid']===!![]?_0x410133=_0x553321(0x15b):_0x410133=_0x553321(0x127);break;case _0x553321(0x138):_0x410133=_0x553321(0x127);break;case _0x553321(0x165):_0x410133=_0x553321(0x163);break;case _0x553321(0x174):_0x410133=_0x553321(0x127);break;case _0x553321(0x131):case _0x553321(0x140):default:_0x410133=_0x553321(0x141);break;}break;}return{'paymentId':_0x3e9aa7['data']?.[_0x553321(0x172)]||'','status':_0x410133,'amount':_0x3e9aa7[_0x553321(0x122)]?.['amount'],'currency':_0x3e9aa7[_0x553321(0x122)]?.[_0x553321(0x166)]};}}exports[a41_0x27a9bc(0x118)]=RapydService;