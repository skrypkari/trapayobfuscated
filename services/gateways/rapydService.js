'use strict';const a53_0x17c7b3=a53_0x1c73;(function(_0xbeb518,_0x461b3c){const _0x23703f=a53_0x1c73,_0xe85b7a=_0xbeb518();while(!![]){try{const _0x16871c=parseInt(_0x23703f(0x9e))/0x1*(parseInt(_0x23703f(0xf5))/0x2)+parseInt(_0x23703f(0xc7))/0x3*(parseInt(_0x23703f(0xb6))/0x4)+-parseInt(_0x23703f(0xc4))/0x5*(-parseInt(_0x23703f(0xed))/0x6)+-parseInt(_0x23703f(0xfe))/0x7+parseInt(_0x23703f(0xd5))/0x8+parseInt(_0x23703f(0x9a))/0x9*(-parseInt(_0x23703f(0xeb))/0xa)+parseInt(_0x23703f(0xc0))/0xb*(parseInt(_0x23703f(0xa8))/0xc);if(_0x16871c===_0x461b3c)break;else _0xe85b7a['push'](_0xe85b7a['shift']());}catch(_0x21ba99){_0xe85b7a['push'](_0xe85b7a['shift']());}}}(a53_0x3a71,0x9953b));Object[a53_0x17c7b3(0xec)](exports,'__esModule',{'value':!![]}),exports[a53_0x17c7b3(0xe2)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x1ca08f=a53_0x17c7b3;this['apiUrl']='https://tesoft.uk/gateway/rapyd/',console[_0x1ca08f(0xa2)](_0x1ca08f(0xc6));}async['createPaymentLink'](_0x43c779){const _0x189bf0=a53_0x17c7b3,{orderId:_0x32aa3a,orderName:_0x34b080,amount:_0x37c703,currency:_0x5b118f,usage:_0x4e378b,maxPayments:_0x312ba4,successUrl:_0xfe49b0,failUrl:_0x15dff7}=_0x43c779,_0x44dc85=_0x5b118f['toUpperCase'](),_0x4e9700='GB';console[_0x189bf0(0xa2)](_0x189bf0(0xa7));const _0x4fb244=_0x189bf0(0xaa)+_0x32aa3a,_0x5cb012=_0x189bf0(0xf6)+_0x32aa3a,_0x3e0209={'amount':_0x37c703,'currency':_0x44dc85,'cancel_checkout_url':_0x5cb012,'complete_checkout_url':_0x4fb244,'complete_payment_url':_0x4fb244,'merchant_reference_id':_0x32aa3a,'description':_0x189bf0(0xf4)+_0x32aa3a,'country':'GB','payment_method_types_include':['gb_visa_card',_0x189bf0(0xbd)],'custom_elements':{'display_description':!![]}};if(_0x44dc85!=='EUR'){const _0x5e81a9=Math['floor'](Date[_0x189bf0(0xf8)]()/0x3e8)+0x1e*0x3c;_0x3e0209[_0x189bf0(0xa3)]='buy',_0x3e0209[_0x189bf0(0xe5)]=_0x189bf0(0x98),_0x3e0209[_0x189bf0(0xd8)]=_0x5e81a9,console[_0x189bf0(0xa2)](_0x189bf0(0xfc)+_0x44dc85+_0x189bf0(0x9d)),console[_0x189bf0(0xa2)](_0x189bf0(0xca)),console['log'](_0x189bf0(0xfa)),console[_0x189bf0(0xa2)]('\x20\x20\x20expiration:\x20'+_0x5e81a9+'\x20('+new Date(_0x5e81a9*0x3e8)[_0x189bf0(0x107)]()+')');}const _0x2adaa8=Date[_0x189bf0(0xf8)]();try{console[_0x189bf0(0xa2)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x189bf0(0xa2)]('URL:',this[_0x189bf0(0xd7)]),console[_0x189bf0(0xa2)](_0x189bf0(0xf2),JSON['stringify'](_0x3e0209,null,0x2)),console[_0x189bf0(0xa2)](_0x189bf0(0xa9)+_0x4e9700+_0x189bf0(0xf0)),console[_0x189bf0(0xa2)]('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x189bf0(0xc8)][_0x189bf0(0x100)](_0x189bf0(0x101),_0x189bf0(0xc2),'POST',_0x3e0209);const _0xb346e1=await fetch(this['apiUrl'],{'method':_0x189bf0(0xcc),'headers':{'Content-Type':'application/json','User-Agent':_0x189bf0(0xc9)},'body':JSON[_0x189bf0(0xae)](_0x3e0209)}),_0x423290=Date[_0x189bf0(0xf8)]()-_0x2adaa8;console[_0x189bf0(0xa2)](_0x189bf0(0x103)),console[_0x189bf0(0xa2)]('Status:',_0xb346e1[_0x189bf0(0xa1)]),console[_0x189bf0(0xa2)]('Status\x20Text:',_0xb346e1[_0x189bf0(0xd2)]),console[_0x189bf0(0xa2)]('Headers:',Object[_0x189bf0(0xa5)](_0xb346e1['headers'][_0x189bf0(0x9f)]())),console[_0x189bf0(0xa2)](_0x189bf0(0xb7),_0x423290+'ms');const _0x2f2018=await _0xb346e1[_0x189bf0(0xf3)]();console[_0x189bf0(0xa2)]('Raw\x20Response\x20Body:',_0x2f2018);if(!_0xb346e1['ok']){console[_0x189bf0(0xa0)](_0x189bf0(0xb0)),console['error']('HTTP\x20Status:',_0xb346e1[_0x189bf0(0xa1)]),console[_0x189bf0(0xa0)](_0x189bf0(0xd9),_0x2f2018),loggerService_1[_0x189bf0(0xc8)]['logWhiteDomainResponse'](_0x189bf0(0x101),'/v1/hosted/payment_links',_0xb346e1[_0x189bf0(0xa1)],_0x2f2018,_0x423290),loggerService_1['loggerService']['logWhiteDomainError'](_0x189bf0(0x101),_0x189bf0(0xc2),_0x189bf0(0xfd)+_0xb346e1[_0x189bf0(0xa1)]+':\x20'+_0x2f2018);throw new Error('HTTP\x20error!\x20status:\x20'+_0xb346e1['status']+_0x189bf0(0xc1)+_0x2f2018);}let _0x5236ac;try{_0x5236ac=JSON[_0x189bf0(0xb3)](_0x2f2018);}catch(_0x2cd387){console[_0x189bf0(0xa0)](_0x189bf0(0xd6),_0x2cd387),loggerService_1[_0x189bf0(0xc8)]['logWhiteDomainError']('rapyd',_0x189bf0(0xc2),_0x189bf0(0x99)+_0x2cd387);throw new Error(_0x189bf0(0xe0)+_0x2f2018);}console[_0x189bf0(0xa2)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x189bf0(0xa2)]('Parsed\x20Result:',JSON[_0x189bf0(0xae)](_0x5236ac,null,0x2)),loggerService_1['loggerService'][_0x189bf0(0xe4)](_0x189bf0(0x101),_0x189bf0(0xc2),_0xb346e1[_0x189bf0(0xa1)],_0x5236ac,_0x423290);if(_0x5236ac[_0x189bf0(0xa1)]?.[_0x189bf0(0xa1)]!==_0x189bf0(0x10d)){const _0xb7f6a5=_0x5236ac['status']?.[_0x189bf0(0xce)]||_0x189bf0(0xad),_0x4a55fd=_0x5236ac[_0x189bf0(0xa1)]?.[_0x189bf0(0xba)]||_0x189bf0(0xb1);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x189bf0(0xa0)](_0x189bf0(0xe3),_0x4a55fd),console['error'](_0x189bf0(0xef),_0xb7f6a5),console[_0x189bf0(0xa0)](_0x189bf0(0xac),_0x5236ac[_0x189bf0(0xa1)]),loggerService_1[_0x189bf0(0xc8)]['logWhiteDomainError'](_0x189bf0(0x101),_0x189bf0(0xc2),_0x189bf0(0xd4)+_0x4a55fd+'):\x20'+_0xb7f6a5);throw new Error(_0x189bf0(0xbc)+_0x4a55fd+'):\x20'+_0xb7f6a5);}if(!_0x5236ac['data']?.['id']||!_0x5236ac[_0x189bf0(0xaf)]?.[_0x189bf0(0xd3)]){console[_0x189bf0(0xa0)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x189bf0(0xa0)](_0x189bf0(0xe8)),console[_0x189bf0(0xa0)](_0x189bf0(0x106),_0x5236ac[_0x189bf0(0xaf)]),loggerService_1[_0x189bf0(0xc8)][_0x189bf0(0x97)](_0x189bf0(0x101),_0x189bf0(0xc2),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x189bf0(0xa2)](_0x189bf0(0xe7)),console[_0x189bf0(0xa2)](_0x189bf0(0xf9),_0x5236ac[_0x189bf0(0xaf)]['id']),console['log']('Redirect\x20URL:',_0x5236ac[_0x189bf0(0xaf)][_0x189bf0(0xd3)]),console['log'](_0x189bf0(0xc3)+_0x4e9700+_0x189bf0(0x10c)),console[_0x189bf0(0xa2)](_0x189bf0(0x109)),{'gateway_payment_id':_0x5236ac[_0x189bf0(0xaf)]['id'],'payment_url':_0x5236ac['data'][_0x189bf0(0xd3)]};}catch(_0xca8d24){console[_0x189bf0(0xa0)](_0x189bf0(0x9c)),console['error']('Error\x20details:',_0xca8d24),loggerService_1[_0x189bf0(0xc8)][_0x189bf0(0x97)](_0x189bf0(0x101),_0x189bf0(0xc2),_0xca8d24);if(_0xca8d24 instanceof Error){console[_0x189bf0(0xa0)](_0x189bf0(0xa6),_0xca8d24['message']),console[_0x189bf0(0xa0)](_0x189bf0(0xda),_0xca8d24[_0x189bf0(0xde)]);throw new Error(_0x189bf0(0xdf)+_0xca8d24[_0x189bf0(0xce)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x10afa9){const _0x2bdd20=a53_0x17c7b3,_0x1342b9=Date[_0x2bdd20(0xf8)]();try{loggerService_1[_0x2bdd20(0xc8)][_0x2bdd20(0x100)](_0x2bdd20(0x101),_0x2bdd20(0xdb)+_0x10afa9,_0x2bdd20(0xff),{});const _0x1e0701=await fetch(this['apiUrl']+'/'+_0x10afa9,{'method':'GET','headers':{'Content-Type':_0x2bdd20(0x10b),'User-Agent':_0x2bdd20(0xc9)}}),_0x3b212b=Date[_0x2bdd20(0xf8)]()-_0x1342b9;if(!_0x1e0701['ok']){const _0x601195=await _0x1e0701[_0x2bdd20(0xf3)]();loggerService_1[_0x2bdd20(0xc8)][_0x2bdd20(0xe4)](_0x2bdd20(0x101),_0x2bdd20(0xdb)+_0x10afa9,_0x1e0701[_0x2bdd20(0xa1)],_0x601195,_0x3b212b);throw new Error(_0x2bdd20(0xc5)+_0x1e0701[_0x2bdd20(0xa1)]);}const _0x2b09e3=await _0x1e0701[_0x2bdd20(0xee)]();loggerService_1['loggerService'][_0x2bdd20(0xe4)](_0x2bdd20(0x101),'/v1/hosted/payment_links/'+_0x10afa9,_0x1e0701['status'],_0x2b09e3,_0x3b212b);if(_0x2b09e3[_0x2bdd20(0xa1)]?.[_0x2bdd20(0xa1)]!==_0x2bdd20(0x10d)){loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x2bdd20(0xdb)+_0x10afa9,'Rapyd\x20API\x20error:\x20'+(_0x2b09e3[_0x2bdd20(0xa1)]?.['message']||'Unknown\x20error'));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x2b09e3[_0x2bdd20(0xa1)]?.[_0x2bdd20(0xce)]||_0x2bdd20(0xdc)));}let _0x36883d=_0x2bdd20(0xbf);if(_0x2b09e3['data']?.[_0x2bdd20(0xa1)])switch(_0x2b09e3[_0x2bdd20(0xaf)][_0x2bdd20(0xa1)][_0x2bdd20(0xb8)]()){case _0x2bdd20(0xb4):_0x36883d='PAID';break;case'CAN':_0x36883d=_0x2bdd20(0xea);break;case _0x2bdd20(0xb5):_0x36883d=_0x2bdd20(0xd1);break;case _0x2bdd20(0xbe):_0x36883d='FAILED';break;case'NEW':case _0x2bdd20(0xfb):default:_0x36883d=_0x2bdd20(0xbf);break;}return{'status':_0x36883d,'amount':_0x2b09e3[_0x2bdd20(0xaf)]?.['amount'],'currency':_0x2b09e3[_0x2bdd20(0xaf)]?.['currency']};}catch(_0x5e21ea){console['error'](_0x2bdd20(0xb9),_0x5e21ea),loggerService_1['loggerService'][_0x2bdd20(0x97)]('rapyd','/v1/hosted/payment_links/'+_0x10afa9,_0x5e21ea);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x5e21ea instanceof Error?_0x5e21ea[_0x2bdd20(0xce)]:'Unknown\x20error'));}}async[a53_0x17c7b3(0xe9)](_0x2806b3){const _0x150c6e=a53_0x17c7b3;console['log'](_0x150c6e(0xe1),_0x2806b3);let _0x5865f7='PENDING',_0x1928f9;_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0xcb)]&&(_0x1928f9=_0x2806b3[_0x150c6e(0xaf)]['failure_message'],console[_0x150c6e(0xa2)]('💥\x20Rapyd\x20failure\x20message:\x20'+_0x1928f9));switch(_0x2806b3[_0x150c6e(0x108)]?.[_0x150c6e(0xb8)]()){case'PAYMENT_COMPLETED':_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0xf7)]===!![]&&_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0xa1)]===_0x150c6e(0xb4)?_0x5865f7=_0x150c6e(0xbb):_0x5865f7=_0x150c6e(0xbf);break;case _0x150c6e(0xcd):_0x5865f7='FAILED';break;case'PAYMENT_EXPIRED':_0x5865f7=_0x150c6e(0xd1);break;case'PAYMENT_FAILED':_0x5865f7='FAILED';!_0x1928f9&&_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0xcb)]&&(_0x1928f9=_0x2806b3[_0x150c6e(0xaf)]['failure_message']);break;default:switch(_0x2806b3['data']?.[_0x150c6e(0xa1)]?.[_0x150c6e(0xb8)]()){case _0x150c6e(0xb4):_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0xf7)]===!![]?_0x5865f7=_0x150c6e(0xbb):_0x5865f7='FAILED';break;case _0x150c6e(0xdd):_0x5865f7=_0x150c6e(0xea);break;case'EXP':_0x5865f7='EXPIRED';break;case _0x150c6e(0xbe):_0x5865f7='FAILED';!_0x1928f9&&_0x2806b3['data']?.['failure_message']&&(_0x1928f9=_0x2806b3[_0x150c6e(0xaf)][_0x150c6e(0xcb)]);break;case _0x150c6e(0xab):case _0x150c6e(0xfb):default:_0x5865f7=_0x150c6e(0xbf);break;}break;}const _0x5e7069={};return _0x2806b3[_0x150c6e(0xaf)]?.['payment_method_data']?.['last4']&&(_0x5e7069[_0x150c6e(0x102)]=_0x2806b3[_0x150c6e(0xaf)]['payment_method_data']['last4']),_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0xcf)]&&(_0x5e7069[_0x150c6e(0xb2)]=_0x2806b3['data']['payment_method_type']),_0x2806b3['data']?.['error_code']&&(_0x5e7069['errorCode']=_0x2806b3[_0x150c6e(0xaf)]['error_code']),_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0x105)]&&(_0x5e7069[_0x150c6e(0x9b)]=_0x2806b3[_0x150c6e(0xaf)][_0x150c6e(0x105)]),console['log'](_0x150c6e(0xd0)+_0x5865f7+_0x150c6e(0xe6)+(_0x1928f9||_0x150c6e(0xa4))),{'paymentId':_0x2806b3['data']?.[_0x150c6e(0xf1)]||'','status':_0x5865f7,'amount':_0x2806b3['data']?.[_0x150c6e(0x10a)],'currency':_0x2806b3[_0x150c6e(0xaf)]?.[_0x150c6e(0x104)],'failureMessage':_0x1928f9,'additionalInfo':_0x5e7069};}}function a53_0x1c73(_0x597e30,_0x591d20){const _0x3a71e1=a53_0x3a71();return a53_0x1c73=function(_0x1c73d4,_0x57b2b5){_0x1c73d4=_0x1c73d4-0x97;let _0x6b51fc=_0x3a71e1[_0x1c73d4];return _0x6b51fc;},a53_0x1c73(_0x597e30,_0x591d20);}exports[a53_0x17c7b3(0xe2)]=RapydService;function a53_0x3a71(){const _0x1e5acb=['statusText','redirect_url','Business\x20Error\x20(','7471136GTTCpQ','Failed\x20to\x20parse\x20JSON\x20response:','apiUrl','expiration','Response\x20Body:','Error\x20stack:','/v1/hosted/payment_links/','Unknown\x20error','CAN','stack','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','Processing\x20Rapyd\x20webhook:','RapydService','Error\x20Code:','logWhiteDomainResponse','requested_currency',',\x20failureMessage=','===\x20RAPYD\x20SUCCESS\x20===','Missing\x20id\x20or\x20redirect_url\x20in\x20response','processWebhook','FAILED','2945330zwNTZP','defineProperty','3480pwfEPL','json','Error\x20Message:','\x20(always\x20GB\x20for\x20Rapyd)','merchant_reference_id','Request\x20Body\x20(Updated\x20Format):','text','ORDER:\x20','19332eZApuF','https://tesoft.uk/gateway/fail.php?id=','paid','now','Payment\x20Link\x20ID:','\x20\x20\x20requested_currency:\x20EUR','ACT','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','HTTP\x20','7423955BptHLB','GET','logWhiteDomainRequest','rapyd','cardLast4','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','currency','failure_code','Response\x20data:','toISOString','type','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','amount','application/json','\x20(GB\x20-\x20Britain)','SUCCESS','logWhiteDomainError','EUR','JSON\x20Parse\x20Error:\x20','27RygRES','failureCode','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','\x20->\x20EUR:','40WSEQME','entries','error','status','log','fixed_side','none','fromEntries','Error\x20message:','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','12THbqdy','🇬🇧\x20Country:\x20','https://tesoft.uk/gateway/success.php?id=','NEW','Full\x20Error\x20Data:','Unknown\x20error\x20from\x20Rapyd\x20API','stringify','data','===\x20RAPYD\x20API\x20ERROR\x20===','UNKNOWN','paymentMethod','parse','CLO','EXP','36eGAiaC','Response\x20Time:','toUpperCase','Rapyd\x20payment\x20verification\x20error:','error_code','PAID','Rapyd\x20API\x20error\x20(','gb_mastercard_card','ERR','PENDING','8382627rSZlHF',',\x20body:\x20','/v1/hosted/payment_links','🇬🇧\x20Country\x20used:\x20','3490uFWMSV','HTTP\x20error!\x20status:\x20','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','28254WgYcSf','loggerService','Payment\x20System/1.0','\x20\x20\x20fixed_side:\x20buy','failure_message','POST','PAYMENT_CANCELED','message','payment_method_type','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','EXPIRED'];a53_0x3a71=function(){return _0x1e5acb;};return a53_0x3a71();}