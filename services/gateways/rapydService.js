'use strict';function a45_0x2b92(_0x30fd63,_0x5e91f2){const _0x395f1c=a45_0x395f();return a45_0x2b92=function(_0x2b92cf,_0x2789d4){_0x2b92cf=_0x2b92cf-0x11b;let _0xf91306=_0x395f1c[_0x2b92cf];return _0xf91306;},a45_0x2b92(_0x30fd63,_0x5e91f2);}const a45_0x12f91b=a45_0x2b92;(function(_0x308bfb,_0x1d1870){const _0x1af4fa=a45_0x2b92,_0x3ef13a=_0x308bfb();while(!![]){try{const _0x2bc5fa=-parseInt(_0x1af4fa(0x15e))/0x1*(-parseInt(_0x1af4fa(0x125))/0x2)+parseInt(_0x1af4fa(0x12d))/0x3+-parseInt(_0x1af4fa(0x167))/0x4+parseInt(_0x1af4fa(0x156))/0x5+-parseInt(_0x1af4fa(0x17b))/0x6+-parseInt(_0x1af4fa(0x11b))/0x7*(parseInt(_0x1af4fa(0x182))/0x8)+parseInt(_0x1af4fa(0x147))/0x9;if(_0x2bc5fa===_0x1d1870)break;else _0x3ef13a['push'](_0x3ef13a['shift']());}catch(_0x52dbf3){_0x3ef13a['push'](_0x3ef13a['shift']());}}}(a45_0x395f,0xc5313));function a45_0x395f(){const _0x57fde8=['none','createPaymentLink','PAYMENT_COMPLETED','ACT','Error\x20Code:','failureCode',',\x20body:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','headers','stack','logWhiteDomainResponse','Rapyd\x20API\x20error:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','error_code','NEW','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','application/json','loggerService',',\x20failureMessage=','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','PAID','apiUrl','data','4813749jSfETk','PAYMENT_FAILED','Payment\x20Link\x20ID:','failure_code','redirect_url','):\x20','Request\x20Body\x20(Updated\x20Format):','status','payment_method_data','log','payment_method_type','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','paymentMethod','TesSoft\x20Payment\x20System/1.0','EXPIRED','1632575AtkJaO','Unknown\x20error','HTTP\x20','===\x20RAPYD\x20SUCCESS\x20===','===\x20RAPYD\x20API\x20ERROR\x20===','HTTP\x20Status:','RapydService','ORDER:\x20','1vBEPbV','üá¨üáß\x20Country:\x20','Redirect\x20URL:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','merchant_reference_id','__esModule','PAYMENT_EXPIRED','fromEntries','json','1395400eCImEY','parse','PENDING','type','gb_visa_card','Response\x20data:','/v1/hosted/payment_links/','\x20(GB\x20-\x20Britain)','Full\x20Error\x20Data:','entries','last4','Missing\x20id\x20or\x20redirect_url\x20in\x20response','rapyd','SUCCESS','PAYMENT_CANCELED','error','HTTP\x20error!\x20status:\x20','statusText','Error\x20Message:','https://tesoft.uk/gateway/rapyd/','1530744MdVwIu','text','now','logWhiteDomainRequest','Error\x20stack:','cardLast4','message','888296bGwNyA','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','Error\x20message:','verifyPayment','amount','currency','URL:','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','CLO','https://tesoft.uk/gateway/success.php?id=','Status\x20Text:','Raw\x20Response\x20Body:','toUpperCase','/v1/hosted/payment_links','gb_mastercard_card','Status:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','UNKNOWN','56DLKhpz','CAN','Failed\x20to\x20parse\x20JSON\x20response:','ERR','failure_message','stringify','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','logWhiteDomainError','https://tesoft.uk/gateway/fail.php?id=','Parsed\x20Result:','727214hdQHzu','Business\x20Error\x20(','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','POST','FAILED','GET','processWebhook','../loggerService','3224958wjZVHa','EXP','defineProperty'];a45_0x395f=function(){return _0x57fde8;};return a45_0x395f();}Object[a45_0x12f91b(0x12f)](exports,a45_0x12f91b(0x163),{'value':!![]}),exports[a45_0x12f91b(0x15c)]=void 0x0;const loggerService_1=require(a45_0x12f91b(0x12c));class RapydService{constructor(){const _0x260890=a45_0x12f91b;this[_0x260890(0x145)]=_0x260890(0x17a),console[_0x260890(0x150)](_0x260890(0x161));}async[a45_0x12f91b(0x131)](_0x9a0d8f){const _0x3fc6fe=a45_0x12f91b,{orderId:_0xeb3323,orderName:_0x1d1a06,amount:_0x777a1b,currency:_0x4e0b5b,usage:_0x261057,maxPayments:_0x3d0596,successUrl:_0x5d8519,failUrl:_0x1739a2}=_0x9a0d8f,_0x35d4d0=_0x4e0b5b['toUpperCase'](),_0x595669='GB';console['log'](_0x3fc6fe(0x127));const _0x19bbfd=_0x3fc6fe(0x18b)+_0xeb3323,_0x34eee5=_0x3fc6fe(0x123)+_0xeb3323,_0x22f6ce={'amount':_0x777a1b,'currency':_0x35d4d0,'cancel_checkout_url':_0x34eee5,'complete_checkout_url':_0x19bbfd,'complete_payment_url':_0x19bbfd,'merchant_reference_id':_0xeb3323,'description':_0x3fc6fe(0x15d)+_0xeb3323,'country':'GB','payment_method_types_include':[_0x3fc6fe(0x16b),_0x3fc6fe(0x190)],'custom_elements':{'display_description':!![]}},_0x162083=Date['now']();try{console['log'](_0x3fc6fe(0x183)),console[_0x3fc6fe(0x150)](_0x3fc6fe(0x188),this[_0x3fc6fe(0x145)]),console[_0x3fc6fe(0x150)](_0x3fc6fe(0x14d),JSON['stringify'](_0x22f6ce,null,0x2)),console[_0x3fc6fe(0x150)](_0x3fc6fe(0x15f)+_0x595669+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x3fc6fe(0x150)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x3fc6fe(0x141)]['logWhiteDomainRequest'](_0x3fc6fe(0x173),_0x3fc6fe(0x18f),_0x3fc6fe(0x128),_0x22f6ce);const _0x1807f1=await fetch(this[_0x3fc6fe(0x145)],{'method':_0x3fc6fe(0x128),'headers':{'Content-Type':_0x3fc6fe(0x140),'User-Agent':_0x3fc6fe(0x154)},'body':JSON['stringify'](_0x22f6ce)}),_0x4cd7ba=Date[_0x3fc6fe(0x17d)]()-_0x162083;console[_0x3fc6fe(0x150)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x3fc6fe(0x150)](_0x3fc6fe(0x191),_0x1807f1[_0x3fc6fe(0x14e)]),console[_0x3fc6fe(0x150)](_0x3fc6fe(0x18c),_0x1807f1[_0x3fc6fe(0x178)]),console[_0x3fc6fe(0x150)]('Headers:',Object[_0x3fc6fe(0x165)](_0x1807f1[_0x3fc6fe(0x138)][_0x3fc6fe(0x170)]())),console['log']('Response\x20Time:',_0x4cd7ba+'ms');const _0x17ce0e=await _0x1807f1['text']();console[_0x3fc6fe(0x150)](_0x3fc6fe(0x18d),_0x17ce0e);if(!_0x1807f1['ok']){console['error'](_0x3fc6fe(0x15a)),console[_0x3fc6fe(0x176)](_0x3fc6fe(0x15b),_0x1807f1[_0x3fc6fe(0x14e)]),console[_0x3fc6fe(0x176)]('Response\x20Body:',_0x17ce0e),loggerService_1[_0x3fc6fe(0x141)][_0x3fc6fe(0x13a)]('rapyd',_0x3fc6fe(0x18f),_0x1807f1['status'],_0x17ce0e,_0x4cd7ba),loggerService_1[_0x3fc6fe(0x141)][_0x3fc6fe(0x122)]('rapyd',_0x3fc6fe(0x18f),_0x3fc6fe(0x158)+_0x1807f1[_0x3fc6fe(0x14e)]+':\x20'+_0x17ce0e);throw new Error(_0x3fc6fe(0x177)+_0x1807f1[_0x3fc6fe(0x14e)]+_0x3fc6fe(0x136)+_0x17ce0e);}let _0xeb04fd;try{_0xeb04fd=JSON[_0x3fc6fe(0x168)](_0x17ce0e);}catch(_0x26725f){console['error'](_0x3fc6fe(0x11d),_0x26725f),loggerService_1[_0x3fc6fe(0x141)][_0x3fc6fe(0x122)](_0x3fc6fe(0x173),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x26725f);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x17ce0e);}console[_0x3fc6fe(0x150)](_0x3fc6fe(0x121)),console['log'](_0x3fc6fe(0x124),JSON[_0x3fc6fe(0x120)](_0xeb04fd,null,0x2)),loggerService_1[_0x3fc6fe(0x141)][_0x3fc6fe(0x13a)](_0x3fc6fe(0x173),_0x3fc6fe(0x18f),_0x1807f1['status'],_0xeb04fd,_0x4cd7ba);if(_0xeb04fd['status']?.[_0x3fc6fe(0x14e)]!==_0x3fc6fe(0x174)){const _0x512a6c=_0xeb04fd['status']?.[_0x3fc6fe(0x181)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x2c445a=_0xeb04fd[_0x3fc6fe(0x14e)]?.[_0x3fc6fe(0x13d)]||_0x3fc6fe(0x193);console[_0x3fc6fe(0x176)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3fc6fe(0x176)](_0x3fc6fe(0x134),_0x2c445a),console[_0x3fc6fe(0x176)](_0x3fc6fe(0x179),_0x512a6c),console[_0x3fc6fe(0x176)](_0x3fc6fe(0x16f),_0xeb04fd[_0x3fc6fe(0x14e)]),loggerService_1['loggerService'][_0x3fc6fe(0x122)]('rapyd',_0x3fc6fe(0x18f),_0x3fc6fe(0x126)+_0x2c445a+_0x3fc6fe(0x14c)+_0x512a6c);throw new Error('Rapyd\x20API\x20error\x20('+_0x2c445a+'):\x20'+_0x512a6c);}if(!_0xeb04fd[_0x3fc6fe(0x146)]?.['id']||!_0xeb04fd[_0x3fc6fe(0x146)]?.['redirect_url']){console[_0x3fc6fe(0x176)](_0x3fc6fe(0x13f)),console[_0x3fc6fe(0x176)](_0x3fc6fe(0x172)),console[_0x3fc6fe(0x176)](_0x3fc6fe(0x16c),_0xeb04fd[_0x3fc6fe(0x146)]),loggerService_1[_0x3fc6fe(0x141)][_0x3fc6fe(0x122)](_0x3fc6fe(0x173),_0x3fc6fe(0x18f),_0x3fc6fe(0x189));throw new Error(_0x3fc6fe(0x143));}return console['log'](_0x3fc6fe(0x159)),console[_0x3fc6fe(0x150)](_0x3fc6fe(0x149),_0xeb04fd[_0x3fc6fe(0x146)]['id']),console['log'](_0x3fc6fe(0x160),_0xeb04fd[_0x3fc6fe(0x146)][_0x3fc6fe(0x14b)]),console[_0x3fc6fe(0x150)]('üá¨üáß\x20Country\x20used:\x20'+_0x595669+_0x3fc6fe(0x16e)),console[_0x3fc6fe(0x150)](_0x3fc6fe(0x152)),{'gateway_payment_id':_0xeb04fd[_0x3fc6fe(0x146)]['id'],'payment_url':_0xeb04fd[_0x3fc6fe(0x146)][_0x3fc6fe(0x14b)]};}catch(_0x348c82){console[_0x3fc6fe(0x176)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x3fc6fe(0x176)]('Error\x20details:',_0x348c82),loggerService_1[_0x3fc6fe(0x141)][_0x3fc6fe(0x122)](_0x3fc6fe(0x173),_0x3fc6fe(0x18f),_0x348c82);if(_0x348c82 instanceof Error){console[_0x3fc6fe(0x176)](_0x3fc6fe(0x184),_0x348c82[_0x3fc6fe(0x181)]),console[_0x3fc6fe(0x176)](_0x3fc6fe(0x17f),_0x348c82[_0x3fc6fe(0x139)]);throw new Error(_0x3fc6fe(0x13c)+_0x348c82[_0x3fc6fe(0x181)]);}throw new Error(_0x3fc6fe(0x137));}}async[a45_0x12f91b(0x185)](_0x75d49b){const _0x1873ef=a45_0x12f91b,_0x46e39d=Date[_0x1873ef(0x17d)]();try{loggerService_1[_0x1873ef(0x141)][_0x1873ef(0x17e)](_0x1873ef(0x173),_0x1873ef(0x16d)+_0x75d49b,_0x1873ef(0x12a),{});const _0x4d9a74=await fetch(this[_0x1873ef(0x145)]+'/'+_0x75d49b,{'method':_0x1873ef(0x12a),'headers':{'Content-Type':_0x1873ef(0x140),'User-Agent':_0x1873ef(0x154)}}),_0xead939=Date[_0x1873ef(0x17d)]()-_0x46e39d;if(!_0x4d9a74['ok']){const _0x918658=await _0x4d9a74[_0x1873ef(0x17c)]();loggerService_1[_0x1873ef(0x141)]['logWhiteDomainResponse'](_0x1873ef(0x173),'/v1/hosted/payment_links/'+_0x75d49b,_0x4d9a74[_0x1873ef(0x14e)],_0x918658,_0xead939);throw new Error(_0x1873ef(0x177)+_0x4d9a74['status']);}const _0x492f32=await _0x4d9a74[_0x1873ef(0x166)]();loggerService_1[_0x1873ef(0x141)][_0x1873ef(0x13a)](_0x1873ef(0x173),_0x1873ef(0x16d)+_0x75d49b,_0x4d9a74[_0x1873ef(0x14e)],_0x492f32,_0xead939);if(_0x492f32[_0x1873ef(0x14e)]?.[_0x1873ef(0x14e)]!==_0x1873ef(0x174)){loggerService_1[_0x1873ef(0x141)][_0x1873ef(0x122)](_0x1873ef(0x173),'/v1/hosted/payment_links/'+_0x75d49b,_0x1873ef(0x13b)+(_0x492f32[_0x1873ef(0x14e)]?.['message']||_0x1873ef(0x157)));throw new Error(_0x1873ef(0x13b)+(_0x492f32[_0x1873ef(0x14e)]?.[_0x1873ef(0x181)]||_0x1873ef(0x157)));}let _0x432fd6=_0x1873ef(0x169);if(_0x492f32[_0x1873ef(0x146)]?.[_0x1873ef(0x14e)])switch(_0x492f32[_0x1873ef(0x146)]['status'][_0x1873ef(0x18e)]()){case _0x1873ef(0x18a):_0x432fd6=_0x1873ef(0x144);break;case _0x1873ef(0x11c):_0x432fd6=_0x1873ef(0x129);break;case _0x1873ef(0x12e):_0x432fd6=_0x1873ef(0x155);break;case _0x1873ef(0x11e):_0x432fd6='FAILED';break;case'NEW':case _0x1873ef(0x133):default:_0x432fd6=_0x1873ef(0x169);break;}return{'status':_0x432fd6,'amount':_0x492f32[_0x1873ef(0x146)]?.[_0x1873ef(0x186)],'currency':_0x492f32[_0x1873ef(0x146)]?.[_0x1873ef(0x187)]};}catch(_0x3c90f2){console[_0x1873ef(0x176)]('Rapyd\x20payment\x20verification\x20error:',_0x3c90f2),loggerService_1[_0x1873ef(0x141)][_0x1873ef(0x122)](_0x1873ef(0x173),_0x1873ef(0x16d)+_0x75d49b,_0x3c90f2);throw new Error(_0x1873ef(0x192)+(_0x3c90f2 instanceof Error?_0x3c90f2[_0x1873ef(0x181)]:'Unknown\x20error'));}}async[a45_0x12f91b(0x12b)](_0x10289d){const _0x370a96=a45_0x12f91b;console[_0x370a96(0x150)]('Processing\x20Rapyd\x20webhook:',_0x10289d);let _0x15a640=_0x370a96(0x169),_0x4bff28;_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x11f)]&&(_0x4bff28=_0x10289d[_0x370a96(0x146)]['failure_message'],console[_0x370a96(0x150)]('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x4bff28));switch(_0x10289d[_0x370a96(0x16a)]?.[_0x370a96(0x18e)]()){case _0x370a96(0x132):_0x10289d['data']?.['paid']===!![]&&_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x14e)]===_0x370a96(0x18a)?_0x15a640='PAID':_0x15a640='PENDING';break;case _0x370a96(0x175):_0x15a640=_0x370a96(0x129);break;case _0x370a96(0x164):_0x15a640=_0x370a96(0x155);break;case _0x370a96(0x148):_0x15a640=_0x370a96(0x129);!_0x4bff28&&_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x11f)]&&(_0x4bff28=_0x10289d['data'][_0x370a96(0x11f)]);break;default:switch(_0x10289d['data']?.[_0x370a96(0x14e)]?.['toUpperCase']()){case'CLO':_0x10289d[_0x370a96(0x146)]?.['paid']===!![]?_0x15a640=_0x370a96(0x144):_0x15a640='FAILED';break;case _0x370a96(0x11c):_0x15a640='FAILED';break;case _0x370a96(0x12e):_0x15a640=_0x370a96(0x155);break;case'ERR':_0x15a640=_0x370a96(0x129);!_0x4bff28&&_0x10289d['data']?.[_0x370a96(0x11f)]&&(_0x4bff28=_0x10289d[_0x370a96(0x146)]['failure_message']);break;case _0x370a96(0x13e):case _0x370a96(0x133):default:_0x15a640=_0x370a96(0x169);break;}break;}const _0x2cca94={};return _0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x14f)]?.[_0x370a96(0x171)]&&(_0x2cca94[_0x370a96(0x180)]=_0x10289d[_0x370a96(0x146)]['payment_method_data'][_0x370a96(0x171)]),_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x151)]&&(_0x2cca94[_0x370a96(0x153)]=_0x10289d['data'][_0x370a96(0x151)]),_0x10289d['data']?.[_0x370a96(0x13d)]&&(_0x2cca94['errorCode']=_0x10289d['data'][_0x370a96(0x13d)]),_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x14a)]&&(_0x2cca94[_0x370a96(0x135)]=_0x10289d[_0x370a96(0x146)][_0x370a96(0x14a)]),console[_0x370a96(0x150)]('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x15a640+_0x370a96(0x142)+(_0x4bff28||_0x370a96(0x130))),{'paymentId':_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x162)]||'','status':_0x15a640,'amount':_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x186)],'currency':_0x10289d[_0x370a96(0x146)]?.[_0x370a96(0x187)],'failureMessage':_0x4bff28,'additionalInfo':_0x2cca94};}}exports[a45_0x12f91b(0x15c)]=RapydService;