'use strict';function a45_0x7b90(){const _0xb82e2e=['Error\x20Code:','rapyd','TesSoft\x20Payment\x20System/1.0','entries','/v1/hosted/payment_links/','Rapyd\x20payment\x20verification\x20error:','Parsed\x20Result:','Raw\x20Response\x20Body:','PAYMENT_FAILED','Request\x20Body\x20(Updated\x20Format):','Business\x20Error\x20(','ACT','__esModule','Full\x20Error\x20Data:','logWhiteDomainRequest','Payment\x20Link\x20ID:','logWhiteDomainError','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','status','stack','UNKNOWN','Unknown\x20error\x20from\x20Rapyd\x20API','log','PAID','GET','226675fTPJls','HTTP\x20Status:','2712000LEDryI','none','Error\x20Message:','text','payment_method_data','/v1/hosted/payment_links','CLO','Error\x20message:','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','statusText','paid','stringify',',\x20body:\x20','Redirect\x20URL:','amount','üí•\x20Rapyd\x20failure\x20message:\x20','gb_visa_card','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Response\x20Time:','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','1uNdCnY','üá¨üáß\x20Country\x20used:\x20','message','type','logWhiteDomainResponse','../loggerService','paymentMethod','parse','failure_message','590UwOZxN','payment_method_type','14xnvxIU','Response\x20Body:','PAYMENT_EXPIRED','currency','EXP','cardLast4','PAYMENT_COMPLETED','\x20(always\x20GB\x20for\x20Rapyd)','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','headers','gb_mastercard_card','POST','ERR','error','ORDER:\x20','error_code','NEW','Headers:','redirect_url','Status:','https://tesoft.uk/gateway/rapyd/','loggerService','Unknown\x20error','toUpperCase','129231TaEnho','CAN','verifyPayment','PAYMENT_CANCELED','JSON\x20Parse\x20Error:\x20','üá¨üáß\x20Country:\x20','\x20(GB\x20-\x20Britain)','data','1592648LNlGHk','createPaymentLink','application/json','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','now','RapydService','===\x20RAPYD\x20API\x20ERROR\x20===','apiUrl',',\x20failureMessage=','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','https://tesoft.uk/gateway/fail.php?id=','904906MOaSBT','last4','Failed\x20to\x20parse\x20JSON\x20response:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','processWebhook','):\x20','Rapyd\x20API\x20error:\x20','2084676XqxUhw','SUCCESS','defineProperty','FAILED','EXPIRED','PENDING','982596avSiYr','HTTP\x20error!\x20status:\x20','merchant_reference_id','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='];a45_0x7b90=function(){return _0xb82e2e;};return a45_0x7b90();}const a45_0x730434=a45_0x25e9;(function(_0x5d885d,_0x406a21){const _0x32b97a=a45_0x25e9,_0x5580d5=_0x5d885d();while(!![]){try{const _0x15d22a=-parseInt(_0x32b97a(0x18f))/0x1*(parseInt(_0x32b97a(0x14f))/0x2)+parseInt(_0x32b97a(0x156))/0x3+parseInt(_0x32b97a(0x143))/0x4+parseInt(_0x32b97a(0x179))/0x5+-parseInt(_0x32b97a(0x15c))/0x6+parseInt(_0x32b97a(0x19a))/0x7*(parseInt(_0x32b97a(0x17b))/0x8)+parseInt(_0x32b97a(0x1b2))/0x9*(-parseInt(_0x32b97a(0x198))/0xa);if(_0x15d22a===_0x406a21)break;else _0x5580d5['push'](_0x5580d5['shift']());}catch(_0x40a037){_0x5580d5['push'](_0x5580d5['shift']());}}}(a45_0x7b90,0x562dd));Object[a45_0x730434(0x158)](exports,a45_0x730434(0x16c),{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require(a45_0x730434(0x194));function a45_0x25e9(_0xdacfb2,_0x496726){const _0x7b90b5=a45_0x7b90();return a45_0x25e9=function(_0x25e98c,_0x663845){_0x25e98c=_0x25e98c-0x140;let _0x323008=_0x7b90b5[_0x25e98c];return _0x323008;},a45_0x25e9(_0xdacfb2,_0x496726);}class RapydService{constructor(){const _0xf806e9=a45_0x730434;this['apiUrl']=_0xf806e9(0x1ae),console[_0xf806e9(0x176)](_0xf806e9(0x14c));}async[a45_0x730434(0x144)](_0x230da8){const _0x389a65=a45_0x730434,{orderId:_0x9d4b07,orderName:_0x2f0429,amount:_0x35360f,currency:_0xff4e1a,usage:_0x26d537,maxPayments:_0x109a25,successUrl:_0x4426fc,failUrl:_0x495340}=_0x230da8,_0x3299d2=_0xff4e1a[_0x389a65(0x1b1)](),_0x4b52d0='GB';console[_0x389a65(0x176)](_0x389a65(0x183));const _0x2f4e46='https://tesoft.uk/gateway/success.php?id='+_0x9d4b07,_0x179e5a=_0x389a65(0x14e)+_0x9d4b07,_0x338ab1={'amount':_0x35360f,'currency':_0x3299d2,'cancel_checkout_url':_0x179e5a,'complete_checkout_url':_0x2f4e46,'complete_payment_url':_0x2f4e46,'merchant_reference_id':_0x9d4b07,'description':_0x389a65(0x1a8)+_0x9d4b07,'country':'GB','payment_method_types_include':[_0x389a65(0x18b),_0x389a65(0x1a4)],'custom_elements':{'display_description':!![]}},_0x8fca1b=Date[_0x389a65(0x147)]();try{console['log'](_0x389a65(0x152)),console['log']('URL:',this['apiUrl']),console[_0x389a65(0x176)](_0x389a65(0x169),JSON[_0x389a65(0x186)](_0x338ab1,null,0x2)),console[_0x389a65(0x176)](_0x389a65(0x140)+_0x4b52d0+_0x389a65(0x1a1)),console[_0x389a65(0x176)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x16e)](_0x389a65(0x161),_0x389a65(0x180),'POST',_0x338ab1);const _0x2794bc=await fetch(this[_0x389a65(0x14a)],{'method':_0x389a65(0x1a5),'headers':{'Content-Type':_0x389a65(0x145),'User-Agent':_0x389a65(0x162)},'body':JSON[_0x389a65(0x186)](_0x338ab1)}),_0x4062fd=Date[_0x389a65(0x147)]()-_0x8fca1b;console[_0x389a65(0x176)](_0x389a65(0x15f)),console[_0x389a65(0x176)](_0x389a65(0x1ad),_0x2794bc[_0x389a65(0x172)]),console[_0x389a65(0x176)]('Status\x20Text:',_0x2794bc[_0x389a65(0x184)]),console['log'](_0x389a65(0x1ab),Object['fromEntries'](_0x2794bc[_0x389a65(0x1a3)][_0x389a65(0x163)]())),console[_0x389a65(0x176)](_0x389a65(0x18d),_0x4062fd+'ms');const _0x24153f=await _0x2794bc['text']();console['log'](_0x389a65(0x167),_0x24153f);if(!_0x2794bc['ok']){console['error'](_0x389a65(0x149)),console['error'](_0x389a65(0x17a),_0x2794bc[_0x389a65(0x172)]),console[_0x389a65(0x1a7)](_0x389a65(0x19b),_0x24153f),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x193)](_0x389a65(0x161),_0x389a65(0x180),_0x2794bc[_0x389a65(0x172)],_0x24153f,_0x4062fd),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x170)](_0x389a65(0x161),_0x389a65(0x180),'HTTP\x20'+_0x2794bc[_0x389a65(0x172)]+':\x20'+_0x24153f);throw new Error(_0x389a65(0x15d)+_0x2794bc[_0x389a65(0x172)]+_0x389a65(0x187)+_0x24153f);}let _0x5448cb;try{_0x5448cb=JSON[_0x389a65(0x196)](_0x24153f);}catch(_0x5237ba){console[_0x389a65(0x1a7)](_0x389a65(0x151),_0x5237ba),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x170)](_0x389a65(0x161),_0x389a65(0x180),_0x389a65(0x1b6)+_0x5237ba);throw new Error(_0x389a65(0x146)+_0x24153f);}console[_0x389a65(0x176)](_0x389a65(0x171)),console[_0x389a65(0x176)](_0x389a65(0x166),JSON[_0x389a65(0x186)](_0x5448cb,null,0x2)),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x193)](_0x389a65(0x161),_0x389a65(0x180),_0x2794bc[_0x389a65(0x172)],_0x5448cb,_0x4062fd);if(_0x5448cb[_0x389a65(0x172)]?.[_0x389a65(0x172)]!==_0x389a65(0x157)){const _0x3bb14c=_0x5448cb[_0x389a65(0x172)]?.[_0x389a65(0x191)]||_0x389a65(0x175),_0x21c321=_0x5448cb[_0x389a65(0x172)]?.[_0x389a65(0x1a9)]||_0x389a65(0x174);console[_0x389a65(0x1a7)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x389a65(0x160),_0x21c321),console[_0x389a65(0x1a7)](_0x389a65(0x17d),_0x3bb14c),console[_0x389a65(0x1a7)](_0x389a65(0x16d),_0x5448cb[_0x389a65(0x172)]),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x170)](_0x389a65(0x161),_0x389a65(0x180),_0x389a65(0x16a)+_0x21c321+_0x389a65(0x154)+_0x3bb14c);throw new Error('Rapyd\x20API\x20error\x20('+_0x21c321+'):\x20'+_0x3bb14c);}if(!_0x5448cb[_0x389a65(0x142)]?.['id']||!_0x5448cb[_0x389a65(0x142)]?.['redirect_url']){console[_0x389a65(0x1a7)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x389a65(0x1a7)](_0x389a65(0x18c)),console[_0x389a65(0x1a7)]('Response\x20data:',_0x5448cb[_0x389a65(0x142)]),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x170)]('rapyd',_0x389a65(0x180),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x389a65(0x14d));}return console[_0x389a65(0x176)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x389a65(0x176)](_0x389a65(0x16f),_0x5448cb['data']['id']),console[_0x389a65(0x176)](_0x389a65(0x188),_0x5448cb['data'][_0x389a65(0x1ac)]),console[_0x389a65(0x176)](_0x389a65(0x190)+_0x4b52d0+_0x389a65(0x141)),console[_0x389a65(0x176)](_0x389a65(0x18e)),{'gateway_payment_id':_0x5448cb[_0x389a65(0x142)]['id'],'payment_url':_0x5448cb[_0x389a65(0x142)]['redirect_url']};}catch(_0x10d7c2){console[_0x389a65(0x1a7)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x389a65(0x1a7)]('Error\x20details:',_0x10d7c2),loggerService_1[_0x389a65(0x1af)][_0x389a65(0x170)](_0x389a65(0x161),_0x389a65(0x180),_0x10d7c2);if(_0x10d7c2 instanceof Error){console[_0x389a65(0x1a7)](_0x389a65(0x182),_0x10d7c2['message']),console['error']('Error\x20stack:',_0x10d7c2[_0x389a65(0x173)]);throw new Error(_0x389a65(0x1a2)+_0x10d7c2[_0x389a65(0x191)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x730434(0x1b4)](_0x1e2e51){const _0x3d602d=a45_0x730434,_0x58d739=Date[_0x3d602d(0x147)]();try{loggerService_1[_0x3d602d(0x1af)]['logWhiteDomainRequest'](_0x3d602d(0x161),'/v1/hosted/payment_links/'+_0x1e2e51,'GET',{});const _0x4eee9c=await fetch(this[_0x3d602d(0x14a)]+'/'+_0x1e2e51,{'method':_0x3d602d(0x178),'headers':{'Content-Type':_0x3d602d(0x145),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x3522d8=Date[_0x3d602d(0x147)]()-_0x58d739;if(!_0x4eee9c['ok']){const _0x2859bc=await _0x4eee9c[_0x3d602d(0x17e)]();loggerService_1[_0x3d602d(0x1af)][_0x3d602d(0x193)](_0x3d602d(0x161),'/v1/hosted/payment_links/'+_0x1e2e51,_0x4eee9c[_0x3d602d(0x172)],_0x2859bc,_0x3522d8);throw new Error(_0x3d602d(0x15d)+_0x4eee9c[_0x3d602d(0x172)]);}const _0x25eb92=await _0x4eee9c['json']();loggerService_1[_0x3d602d(0x1af)][_0x3d602d(0x193)](_0x3d602d(0x161),_0x3d602d(0x164)+_0x1e2e51,_0x4eee9c[_0x3d602d(0x172)],_0x25eb92,_0x3522d8);if(_0x25eb92[_0x3d602d(0x172)]?.[_0x3d602d(0x172)]!=='SUCCESS'){loggerService_1['loggerService'][_0x3d602d(0x170)](_0x3d602d(0x161),'/v1/hosted/payment_links/'+_0x1e2e51,'Rapyd\x20API\x20error:\x20'+(_0x25eb92['status']?.[_0x3d602d(0x191)]||_0x3d602d(0x1b0)));throw new Error(_0x3d602d(0x155)+(_0x25eb92[_0x3d602d(0x172)]?.[_0x3d602d(0x191)]||_0x3d602d(0x1b0)));}let _0x47e41b=_0x3d602d(0x15b);if(_0x25eb92['data']?.[_0x3d602d(0x172)])switch(_0x25eb92[_0x3d602d(0x142)]['status'][_0x3d602d(0x1b1)]()){case _0x3d602d(0x181):_0x47e41b=_0x3d602d(0x177);break;case _0x3d602d(0x1b3):_0x47e41b='FAILED';break;case'EXP':_0x47e41b=_0x3d602d(0x15a);break;case _0x3d602d(0x1a6):_0x47e41b='FAILED';break;case'NEW':case'ACT':default:_0x47e41b=_0x3d602d(0x15b);break;}return{'status':_0x47e41b,'amount':_0x25eb92[_0x3d602d(0x142)]?.[_0x3d602d(0x189)],'currency':_0x25eb92[_0x3d602d(0x142)]?.[_0x3d602d(0x19d)]};}catch(_0x266bc6){console[_0x3d602d(0x1a7)](_0x3d602d(0x165),_0x266bc6),loggerService_1[_0x3d602d(0x1af)][_0x3d602d(0x170)](_0x3d602d(0x161),_0x3d602d(0x164)+_0x1e2e51,_0x266bc6);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x266bc6 instanceof Error?_0x266bc6[_0x3d602d(0x191)]:_0x3d602d(0x1b0)));}}async[a45_0x730434(0x153)](_0xedbc36){const _0x52639c=a45_0x730434;console[_0x52639c(0x176)]('Processing\x20Rapyd\x20webhook:',_0xedbc36);let _0x3f5ab1=_0x52639c(0x15b),_0x20de4e;_0xedbc36[_0x52639c(0x142)]?.[_0x52639c(0x197)]&&(_0x20de4e=_0xedbc36[_0x52639c(0x142)][_0x52639c(0x197)],console[_0x52639c(0x176)](_0x52639c(0x18a)+_0x20de4e));switch(_0xedbc36[_0x52639c(0x192)]?.[_0x52639c(0x1b1)]()){case _0x52639c(0x1a0):_0xedbc36[_0x52639c(0x142)]?.[_0x52639c(0x185)]===!![]&&_0xedbc36['data']?.[_0x52639c(0x172)]==='CLO'?_0x3f5ab1=_0x52639c(0x177):_0x3f5ab1=_0x52639c(0x15b);break;case _0x52639c(0x1b5):_0x3f5ab1=_0x52639c(0x159);break;case _0x52639c(0x19c):_0x3f5ab1='EXPIRED';break;case _0x52639c(0x168):_0x3f5ab1=_0x52639c(0x159);!_0x20de4e&&_0xedbc36[_0x52639c(0x142)]?.[_0x52639c(0x197)]&&(_0x20de4e=_0xedbc36['data'][_0x52639c(0x197)]);break;default:switch(_0xedbc36['data']?.['status']?.[_0x52639c(0x1b1)]()){case'CLO':_0xedbc36['data']?.[_0x52639c(0x185)]===!![]?_0x3f5ab1=_0x52639c(0x177):_0x3f5ab1='FAILED';break;case _0x52639c(0x1b3):_0x3f5ab1=_0x52639c(0x159);break;case _0x52639c(0x19e):_0x3f5ab1=_0x52639c(0x15a);break;case _0x52639c(0x1a6):_0x3f5ab1=_0x52639c(0x159);!_0x20de4e&&_0xedbc36[_0x52639c(0x142)]?.[_0x52639c(0x197)]&&(_0x20de4e=_0xedbc36[_0x52639c(0x142)][_0x52639c(0x197)]);break;case _0x52639c(0x1aa):case _0x52639c(0x16b):default:_0x3f5ab1=_0x52639c(0x15b);break;}break;}const _0x463aee={};return _0xedbc36[_0x52639c(0x142)]?.['payment_method_data']?.[_0x52639c(0x150)]&&(_0x463aee[_0x52639c(0x19f)]=_0xedbc36[_0x52639c(0x142)][_0x52639c(0x17f)][_0x52639c(0x150)]),_0xedbc36[_0x52639c(0x142)]?.[_0x52639c(0x199)]&&(_0x463aee[_0x52639c(0x195)]=_0xedbc36['data']['payment_method_type']),_0xedbc36[_0x52639c(0x142)]?.[_0x52639c(0x1a9)]&&(_0x463aee['errorCode']=_0xedbc36['data']['error_code']),_0xedbc36['data']?.['failure_code']&&(_0x463aee['failureCode']=_0xedbc36[_0x52639c(0x142)]['failure_code']),console['log']('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x3f5ab1+_0x52639c(0x14b)+(_0x20de4e||_0x52639c(0x17c))),{'paymentId':_0xedbc36['data']?.[_0x52639c(0x15e)]||'','status':_0x3f5ab1,'amount':_0xedbc36[_0x52639c(0x142)]?.['amount'],'currency':_0xedbc36['data']?.[_0x52639c(0x19d)],'failureMessage':_0x20de4e,'additionalInfo':_0x463aee};}}exports[a45_0x730434(0x148)]=RapydService;