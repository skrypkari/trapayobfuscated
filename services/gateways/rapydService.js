'use strict';const a49_0x2f4feb=a49_0x4441;(function(_0x1ec5b8,_0xc82e08){const _0x50f858=a49_0x4441,_0x27ccfc=_0x1ec5b8();while(!![]){try{const _0x206e0d=parseInt(_0x50f858(0x1d3))/0x1+-parseInt(_0x50f858(0x1b1))/0x2+parseInt(_0x50f858(0x198))/0x3+parseInt(_0x50f858(0x1c7))/0x4+parseInt(_0x50f858(0x1f5))/0x5*(parseInt(_0x50f858(0x1bf))/0x6)+-parseInt(_0x50f858(0x1e7))/0x7*(-parseInt(_0x50f858(0x19c))/0x8)+-parseInt(_0x50f858(0x1a6))/0x9;if(_0x206e0d===_0xc82e08)break;else _0x27ccfc['push'](_0x27ccfc['shift']());}catch(_0x5650d2){_0x27ccfc['push'](_0x27ccfc['shift']());}}}(a49_0x1db3,0x74ea5));function a49_0x1db3(){const _0xe09527=['üá¨üáß\x20Country\x20used:\x20','failure_message','apiUrl','ORDER:\x20','paymentMethod','cardLast4','paid','359788SPRsHm','currency','EUR','error','Unknown\x20error','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','PAYMENT_EXPIRED','Error\x20Message:','rapyd','Headers:','Rapyd\x20payment\x20verification\x20error:','FAILED','481696pdwpHt','\x20(GB\x20-\x20Britain)','text','PAYMENT_FAILED','GET','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','none','application/json','Error\x20details:','stringify','type','\x20\x20\x20expiration:\x20','Status:','loggerService','data','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===',',\x20body:\x20','/v1/hosted/payment_links/','JSON\x20Parse\x20Error:\x20','/v1/hosted/payment_links','4033064fcCubM','Raw\x20Response\x20Body:','URL:','Response\x20Time:','Rapyd\x20API\x20error:\x20','HTTP\x20Status:','POST','toISOString','requested_currency','EXPIRED','Business\x20Error\x20(','\x20\x20\x20requested_currency:\x20EUR','toUpperCase','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','145oAWrxT','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','verifyPayment','SUCCESS','ACT','logWhiteDomainResponse','):\x20','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','payment_method_data','merchant_reference_id','https://tesoft.uk/gateway/success.php?id=','Error\x20stack:','logWhiteDomainRequest','Rapyd\x20API\x20error\x20(','PENDING','parse','entries','Redirect\x20URL:','\x20->\x20EUR:','message','now','Error\x20message:','NEW','Processing\x20Rapyd\x20webhook:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','processWebhook','failureCode','Response\x20data:','HTTP\x20','1135230qpKRCJ','EXP','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainError','8yGAnaX','payment_method_type','createPaymentLink','floor','failure_code','Failed\x20to\x20parse\x20JSON\x20response:','buy','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','log','CAN','7716285FzgVDh','status','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','Error\x20Code:','fixed_side','ERR','PAYMENT_CANCELED','\x20(always\x20GB\x20for\x20Rapyd)','RapydService','errorCode','HTTP\x20error!\x20status:\x20','597410LVnBjp','redirect_url','defineProperty','gb_visa_card','expiration','PAID','stack','üá¨üáß\x20Country:\x20','error_code','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','üí•\x20Rapyd\x20failure\x20message:\x20','CLO','headers','json','22500GjPlOb'];a49_0x1db3=function(){return _0xe09527;};return a49_0x1db3();}Object[a49_0x2f4feb(0x1b3)](exports,'__esModule',{'value':!![]}),exports[a49_0x2f4feb(0x1ae)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x42a388=a49_0x2f4feb;this['apiUrl']='https://tesoft.uk/gateway/rapyd/',console['log'](_0x42a388(0x193));}async[a49_0x2f4feb(0x19e)](_0x3df63d){const _0x46f2bb=a49_0x2f4feb,{orderId:_0x4106c7,orderName:_0x24ecab,amount:_0x69a7b8,currency:_0x2da168,usage:_0x130a8b,maxPayments:_0x4eb311,successUrl:_0x5a114b,failUrl:_0x16d66b}=_0x3df63d,_0x574cb3=_0x2da168['toUpperCase'](),_0x2894e1='GB';console[_0x46f2bb(0x1a4)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x57eaaf=_0x46f2bb(0x185)+_0x4106c7,_0x3f3e2e='https://tesoft.uk/gateway/fail.php?id='+_0x4106c7,_0x35c801={'amount':_0x69a7b8,'currency':_0x574cb3,'cancel_checkout_url':_0x3f3e2e,'complete_checkout_url':_0x57eaaf,'complete_payment_url':_0x57eaaf,'merchant_reference_id':_0x4106c7,'description':_0x46f2bb(0x1c3)+_0x4106c7,'country':'GB','payment_method_types_include':[_0x46f2bb(0x1b4),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}};if(_0x574cb3!==_0x46f2bb(0x1c9)){const _0xd39210=Math[_0x46f2bb(0x19f)](Date['now']()/0x3e8)+0x1e*0x3c;_0x35c801[_0x46f2bb(0x1aa)]=_0x46f2bb(0x1a2),_0x35c801[_0x46f2bb(0x1ef)]='EUR',_0x35c801[_0x46f2bb(0x1b5)]=_0xd39210,console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1d8)+_0x574cb3+_0x46f2bb(0x18d)),console[_0x46f2bb(0x1a4)]('\x20\x20\x20fixed_side:\x20buy'),console['log'](_0x46f2bb(0x1f2)),console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1de)+_0xd39210+'\x20('+new Date(_0xd39210*0x3e8)[_0x46f2bb(0x1ee)]()+')');}const _0xdab31d=Date['now']();try{console['log'](_0x46f2bb(0x1fd)),console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1e9),this[_0x46f2bb(0x1c2)]),console[_0x46f2bb(0x1a4)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x46f2bb(0x1dc)](_0x35c801,null,0x2)),console['log'](_0x46f2bb(0x1b8)+_0x2894e1+_0x46f2bb(0x1ad)),console[_0x46f2bb(0x1a4)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x46f2bb(0x1e0)][_0x46f2bb(0x187)](_0x46f2bb(0x1cf),_0x46f2bb(0x1e6),_0x46f2bb(0x1ed),_0x35c801);const _0x164f34=await fetch(this[_0x46f2bb(0x1c2)],{'method':_0x46f2bb(0x1ed),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x46f2bb(0x1dc)](_0x35c801)}),_0x23d87d=Date[_0x46f2bb(0x18f)]()-_0xdab31d;console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1e2)),console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1df),_0x164f34[_0x46f2bb(0x1a7)]),console[_0x46f2bb(0x1a4)]('Status\x20Text:',_0x164f34['statusText']),console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1d0),Object['fromEntries'](_0x164f34[_0x46f2bb(0x1bd)][_0x46f2bb(0x18b)]())),console['log'](_0x46f2bb(0x1ea),_0x23d87d+'ms');const _0x2efbf8=await _0x164f34[_0x46f2bb(0x1d5)]();console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1e8),_0x2efbf8);if(!_0x164f34['ok']){console[_0x46f2bb(0x1ca)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x46f2bb(0x1ca)](_0x46f2bb(0x1ec),_0x164f34[_0x46f2bb(0x1a7)]),console['error']('Response\x20Body:',_0x2efbf8),loggerService_1[_0x46f2bb(0x1e0)][_0x46f2bb(0x1fb)]('rapyd',_0x46f2bb(0x1e6),_0x164f34[_0x46f2bb(0x1a7)],_0x2efbf8,_0x23d87d),loggerService_1['loggerService'][_0x46f2bb(0x19b)](_0x46f2bb(0x1cf),_0x46f2bb(0x1e6),_0x46f2bb(0x197)+_0x164f34[_0x46f2bb(0x1a7)]+':\x20'+_0x2efbf8);throw new Error(_0x46f2bb(0x1b0)+_0x164f34[_0x46f2bb(0x1a7)]+_0x46f2bb(0x1e3)+_0x2efbf8);}let _0x79c88f;try{_0x79c88f=JSON[_0x46f2bb(0x18a)](_0x2efbf8);}catch(_0x37e24d){console[_0x46f2bb(0x1ca)](_0x46f2bb(0x1a1),_0x37e24d),loggerService_1[_0x46f2bb(0x1e0)][_0x46f2bb(0x19b)](_0x46f2bb(0x1cf),_0x46f2bb(0x1e6),_0x46f2bb(0x1e5)+_0x37e24d);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x2efbf8);}console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1f6)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x79c88f,null,0x2)),loggerService_1['loggerService'][_0x46f2bb(0x1fb)](_0x46f2bb(0x1cf),_0x46f2bb(0x1e6),_0x164f34[_0x46f2bb(0x1a7)],_0x79c88f,_0x23d87d);if(_0x79c88f[_0x46f2bb(0x1a7)]?.[_0x46f2bb(0x1a7)]!=='SUCCESS'){const _0x16927c=_0x79c88f[_0x46f2bb(0x1a7)]?.[_0x46f2bb(0x18e)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x4400c2=_0x79c88f['status']?.[_0x46f2bb(0x1b9)]||'UNKNOWN';console[_0x46f2bb(0x1ca)](_0x46f2bb(0x19a)),console[_0x46f2bb(0x1ca)](_0x46f2bb(0x1a9),_0x4400c2),console[_0x46f2bb(0x1ca)](_0x46f2bb(0x1ce),_0x16927c),console[_0x46f2bb(0x1ca)]('Full\x20Error\x20Data:',_0x79c88f[_0x46f2bb(0x1a7)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x46f2bb(0x1cf),_0x46f2bb(0x1e6),_0x46f2bb(0x1f1)+_0x4400c2+_0x46f2bb(0x1fc)+_0x16927c);throw new Error(_0x46f2bb(0x188)+_0x4400c2+_0x46f2bb(0x1fc)+_0x16927c);}if(!_0x79c88f[_0x46f2bb(0x1e1)]?.['id']||!_0x79c88f[_0x46f2bb(0x1e1)]?.[_0x46f2bb(0x1b2)]){console[_0x46f2bb(0x1ca)](_0x46f2bb(0x1f4)),console[_0x46f2bb(0x1ca)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console['error'](_0x46f2bb(0x196),_0x79c88f['data']),loggerService_1[_0x46f2bb(0x1e0)]['logWhiteDomainError'](_0x46f2bb(0x1cf),_0x46f2bb(0x1e6),_0x46f2bb(0x1ba));throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x46f2bb(0x1a4)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x46f2bb(0x1a4)]('Payment\x20Link\x20ID:',_0x79c88f[_0x46f2bb(0x1e1)]['id']),console[_0x46f2bb(0x1a4)](_0x46f2bb(0x18c),_0x79c88f['data'][_0x46f2bb(0x1b2)]),console[_0x46f2bb(0x1a4)](_0x46f2bb(0x1c0)+_0x2894e1+_0x46f2bb(0x1d4)),console[_0x46f2bb(0x1a4)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x79c88f[_0x46f2bb(0x1e1)]['id'],'payment_url':_0x79c88f[_0x46f2bb(0x1e1)][_0x46f2bb(0x1b2)]};}catch(_0x176b00){console[_0x46f2bb(0x1ca)](_0x46f2bb(0x1a3)),console['error'](_0x46f2bb(0x1db),_0x176b00),loggerService_1[_0x46f2bb(0x1e0)]['logWhiteDomainError'](_0x46f2bb(0x1cf),'/v1/hosted/payment_links',_0x176b00);if(_0x176b00 instanceof Error){console[_0x46f2bb(0x1ca)](_0x46f2bb(0x190),_0x176b00[_0x46f2bb(0x18e)]),console[_0x46f2bb(0x1ca)](_0x46f2bb(0x186),_0x176b00[_0x46f2bb(0x1b7)]);throw new Error(_0x46f2bb(0x1f7)+_0x176b00[_0x46f2bb(0x18e)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a49_0x2f4feb(0x1f8)](_0x1d5290){const _0x436d33=a49_0x2f4feb,_0x181c56=Date['now']();try{loggerService_1[_0x436d33(0x1e0)][_0x436d33(0x187)](_0x436d33(0x1cf),'/v1/hosted/payment_links/'+_0x1d5290,'GET',{});const _0x693b5f=await fetch(this[_0x436d33(0x1c2)]+'/'+_0x1d5290,{'method':_0x436d33(0x1d7),'headers':{'Content-Type':_0x436d33(0x1da),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x28cd7b=Date['now']()-_0x181c56;if(!_0x693b5f['ok']){const _0xc6b385=await _0x693b5f['text']();loggerService_1[_0x436d33(0x1e0)]['logWhiteDomainResponse']('rapyd',_0x436d33(0x1e4)+_0x1d5290,_0x693b5f[_0x436d33(0x1a7)],_0xc6b385,_0x28cd7b);throw new Error(_0x436d33(0x1b0)+_0x693b5f[_0x436d33(0x1a7)]);}const _0x583609=await _0x693b5f[_0x436d33(0x1be)]();loggerService_1['loggerService']['logWhiteDomainResponse']('rapyd',_0x436d33(0x1e4)+_0x1d5290,_0x693b5f[_0x436d33(0x1a7)],_0x583609,_0x28cd7b);if(_0x583609[_0x436d33(0x1a7)]?.['status']!==_0x436d33(0x1f9)){loggerService_1['loggerService'][_0x436d33(0x19b)](_0x436d33(0x1cf),_0x436d33(0x1e4)+_0x1d5290,'Rapyd\x20API\x20error:\x20'+(_0x583609['status']?.[_0x436d33(0x18e)]||_0x436d33(0x1cb)));throw new Error(_0x436d33(0x1eb)+(_0x583609[_0x436d33(0x1a7)]?.['message']||'Unknown\x20error'));}let _0x1930d8='PENDING';if(_0x583609[_0x436d33(0x1e1)]?.['status'])switch(_0x583609[_0x436d33(0x1e1)][_0x436d33(0x1a7)][_0x436d33(0x1f3)]()){case _0x436d33(0x1bc):_0x1930d8=_0x436d33(0x1b6);break;case _0x436d33(0x1a5):_0x1930d8=_0x436d33(0x1d2);break;case'EXP':_0x1930d8=_0x436d33(0x1f0);break;case _0x436d33(0x1ab):_0x1930d8=_0x436d33(0x1d2);break;case _0x436d33(0x191):case _0x436d33(0x1fa):default:_0x1930d8='PENDING';break;}return{'status':_0x1930d8,'amount':_0x583609[_0x436d33(0x1e1)]?.['amount'],'currency':_0x583609[_0x436d33(0x1e1)]?.[_0x436d33(0x1c8)]};}catch(_0x266287){console[_0x436d33(0x1ca)](_0x436d33(0x1d1),_0x266287),loggerService_1[_0x436d33(0x1e0)][_0x436d33(0x19b)](_0x436d33(0x1cf),_0x436d33(0x1e4)+_0x1d5290,_0x266287);throw new Error(_0x436d33(0x1cc)+(_0x266287 instanceof Error?_0x266287[_0x436d33(0x18e)]:_0x436d33(0x1cb)));}}async[a49_0x2f4feb(0x194)](_0x4f2af2){const _0x34c6f7=a49_0x2f4feb;console[_0x34c6f7(0x1a4)](_0x34c6f7(0x192),_0x4f2af2);let _0x4f7bb8='PENDING',_0x1fcddb;_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1c1)]&&(_0x1fcddb=_0x4f2af2[_0x34c6f7(0x1e1)]['failure_message'],console['log'](_0x34c6f7(0x1bb)+_0x1fcddb));switch(_0x4f2af2[_0x34c6f7(0x1dd)]?.['toUpperCase']()){case'PAYMENT_COMPLETED':_0x4f2af2['data']?.[_0x34c6f7(0x1c6)]===!![]&&_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1a7)]===_0x34c6f7(0x1bc)?_0x4f7bb8=_0x34c6f7(0x1b6):_0x4f7bb8=_0x34c6f7(0x189);break;case _0x34c6f7(0x1ac):_0x4f7bb8=_0x34c6f7(0x1d2);break;case _0x34c6f7(0x1cd):_0x4f7bb8=_0x34c6f7(0x1f0);break;case _0x34c6f7(0x1d6):_0x4f7bb8=_0x34c6f7(0x1d2);!_0x1fcddb&&_0x4f2af2[_0x34c6f7(0x1e1)]?.['failure_message']&&(_0x1fcddb=_0x4f2af2[_0x34c6f7(0x1e1)][_0x34c6f7(0x1c1)]);break;default:switch(_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1a7)]?.[_0x34c6f7(0x1f3)]()){case _0x34c6f7(0x1bc):_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1c6)]===!![]?_0x4f7bb8=_0x34c6f7(0x1b6):_0x4f7bb8=_0x34c6f7(0x1d2);break;case'CAN':_0x4f7bb8=_0x34c6f7(0x1d2);break;case _0x34c6f7(0x199):_0x4f7bb8='EXPIRED';break;case _0x34c6f7(0x1ab):_0x4f7bb8='FAILED';!_0x1fcddb&&_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1c1)]&&(_0x1fcddb=_0x4f2af2['data']['failure_message']);break;case _0x34c6f7(0x191):case _0x34c6f7(0x1fa):default:_0x4f7bb8='PENDING';break;}break;}const _0x4bf400={};return _0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1fe)]?.['last4']&&(_0x4bf400[_0x34c6f7(0x1c5)]=_0x4f2af2[_0x34c6f7(0x1e1)]['payment_method_data']['last4']),_0x4f2af2['data']?.[_0x34c6f7(0x19d)]&&(_0x4bf400[_0x34c6f7(0x1c4)]=_0x4f2af2[_0x34c6f7(0x1e1)][_0x34c6f7(0x19d)]),_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1b9)]&&(_0x4bf400[_0x34c6f7(0x1af)]=_0x4f2af2[_0x34c6f7(0x1e1)]['error_code']),_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1a0)]&&(_0x4bf400[_0x34c6f7(0x195)]=_0x4f2af2[_0x34c6f7(0x1e1)][_0x34c6f7(0x1a0)]),console[_0x34c6f7(0x1a4)](_0x34c6f7(0x1a8)+_0x4f7bb8+',\x20failureMessage='+(_0x1fcddb||_0x34c6f7(0x1d9))),{'paymentId':_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1ff)]||'','status':_0x4f7bb8,'amount':_0x4f2af2[_0x34c6f7(0x1e1)]?.['amount'],'currency':_0x4f2af2[_0x34c6f7(0x1e1)]?.[_0x34c6f7(0x1c8)],'failureMessage':_0x1fcddb,'additionalInfo':_0x4bf400};}}function a49_0x4441(_0x22e7ce,_0x2489d9){const _0x1db386=a49_0x1db3();return a49_0x4441=function(_0x4441c2,_0x124e93){_0x4441c2=_0x4441c2-0x185;let _0x2c0015=_0x1db386[_0x4441c2];return _0x2c0015;},a49_0x4441(_0x22e7ce,_0x2489d9);}exports[a49_0x2f4feb(0x1ae)]=RapydService;