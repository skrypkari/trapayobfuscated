'use strict';const a42_0x15774b=a42_0xd273;(function(_0x22c830,_0x4d2c2e){const _0x121c68=a42_0xd273,_0x1e5458=_0x22c830();while(!![]){try{const _0x439aff=parseInt(_0x121c68(0x162))/0x1*(parseInt(_0x121c68(0x100))/0x2)+-parseInt(_0x121c68(0x120))/0x3*(-parseInt(_0x121c68(0x151))/0x4)+-parseInt(_0x121c68(0x123))/0x5*(parseInt(_0x121c68(0x10f))/0x6)+-parseInt(_0x121c68(0x154))/0x7+-parseInt(_0x121c68(0x113))/0x8*(parseInt(_0x121c68(0x140))/0x9)+-parseInt(_0x121c68(0x12e))/0xa+parseInt(_0x121c68(0x124))/0xb*(parseInt(_0x121c68(0x12f))/0xc);if(_0x439aff===_0x4d2c2e)break;else _0x1e5458['push'](_0x1e5458['shift']());}catch(_0x2f157d){_0x1e5458['push'](_0x1e5458['shift']());}}}(a42_0x3209,0xf27f8));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a42_0x15774b(0x14c)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x2e4895=a42_0x15774b;this[_0x2e4895(0x156)]='https://tesoft.uk/gateway/rapyd/',console[_0x2e4895(0x104)](_0x2e4895(0x11d));}async[a42_0x15774b(0x10a)](_0x20d5f5){const _0x18ad1d=a42_0x15774b,{orderId:_0x4a16f0,orderName:_0x3967a2,amount:_0x4f8854,currency:_0x4357da,usage:_0x402bce,maxPayments:_0x472eca,successUrl:_0x293c69,failUrl:_0x19b3ad}=_0x20d5f5,_0x17af5d=_0x4357da[_0x18ad1d(0x10e)](),_0x42d506='GB';console[_0x18ad1d(0x104)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x160741=_0x18ad1d(0x147)+_0x4a16f0,_0x5b884d=_0x18ad1d(0x11f)+_0x4a16f0,_0x275b17={'amount':_0x4f8854,'currency':_0x17af5d,'cancel_checkout_url':_0x5b884d,'complete_checkout_url':_0x160741,'complete_payment_url':_0x160741,'merchant_reference_id':_0x4a16f0,'description':'ORDER:\x20'+_0x4a16f0,'country':'GB','payment_method_types_include':['gb_visa_card','gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x18f452=Date[_0x18ad1d(0x115)]();try{console['log'](_0x18ad1d(0x133)),console[_0x18ad1d(0x104)](_0x18ad1d(0x15a),this['apiUrl']),console[_0x18ad1d(0x104)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x18ad1d(0x10d)](_0x275b17,null,0x2)),console['log'](_0x18ad1d(0x15b)+_0x42d506+_0x18ad1d(0x13a)),console[_0x18ad1d(0x104)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x18ad1d(0x161)]['logWhiteDomainRequest']('rapyd',_0x18ad1d(0x142),_0x18ad1d(0x11a),_0x275b17);const _0x3b9da5=await fetch(this[_0x18ad1d(0x156)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x18ad1d(0x122)},'body':JSON['stringify'](_0x275b17)}),_0x186277=Date[_0x18ad1d(0x115)]()-_0x18f452;console[_0x18ad1d(0x104)](_0x18ad1d(0x103)),console[_0x18ad1d(0x104)]('Status:',_0x3b9da5[_0x18ad1d(0x139)]),console['log'](_0x18ad1d(0x152),_0x3b9da5[_0x18ad1d(0x109)]),console[_0x18ad1d(0x104)](_0x18ad1d(0x15d),Object[_0x18ad1d(0x15e)](_0x3b9da5[_0x18ad1d(0x13d)][_0x18ad1d(0x108)]())),console[_0x18ad1d(0x104)](_0x18ad1d(0xfe),_0x186277+'ms');const _0x31b443=await _0x3b9da5[_0x18ad1d(0x11e)]();console[_0x18ad1d(0x104)](_0x18ad1d(0x13f),_0x31b443);if(!_0x3b9da5['ok']){console[_0x18ad1d(0x135)](_0x18ad1d(0x137)),console[_0x18ad1d(0x135)](_0x18ad1d(0x12c),_0x3b9da5['status']),console[_0x18ad1d(0x135)](_0x18ad1d(0x119),_0x31b443),loggerService_1['loggerService']['logWhiteDomainResponse']('rapyd',_0x18ad1d(0x142),_0x3b9da5[_0x18ad1d(0x139)],_0x31b443,_0x186277),loggerService_1[_0x18ad1d(0x161)][_0x18ad1d(0x12d)](_0x18ad1d(0x166),_0x18ad1d(0x142),_0x18ad1d(0x164)+_0x3b9da5[_0x18ad1d(0x139)]+':\x20'+_0x31b443);throw new Error(_0x18ad1d(0x13c)+_0x3b9da5[_0x18ad1d(0x139)]+',\x20body:\x20'+_0x31b443);}let _0x54fdab;try{_0x54fdab=JSON['parse'](_0x31b443);}catch(_0x1a0498){console['error'](_0x18ad1d(0x131),_0x1a0498),loggerService_1[_0x18ad1d(0x161)][_0x18ad1d(0x12d)](_0x18ad1d(0x166),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x1a0498);throw new Error(_0x18ad1d(0x106)+_0x31b443);}console[_0x18ad1d(0x104)](_0x18ad1d(0x132)),console[_0x18ad1d(0x104)](_0x18ad1d(0x107),JSON['stringify'](_0x54fdab,null,0x2)),loggerService_1[_0x18ad1d(0x161)][_0x18ad1d(0x127)](_0x18ad1d(0x166),_0x18ad1d(0x142),_0x3b9da5[_0x18ad1d(0x139)],_0x54fdab,_0x186277);if(_0x54fdab[_0x18ad1d(0x139)]?.[_0x18ad1d(0x139)]!==_0x18ad1d(0x138)){const _0x4dca7e=_0x54fdab['status']?.[_0x18ad1d(0x121)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x1bccd2=_0x54fdab['status']?.['error_code']||'UNKNOWN';console[_0x18ad1d(0x135)](_0x18ad1d(0x157)),console['error'](_0x18ad1d(0x15f),_0x1bccd2),console[_0x18ad1d(0x135)](_0x18ad1d(0x130),_0x4dca7e),console[_0x18ad1d(0x135)](_0x18ad1d(0x126),_0x54fdab[_0x18ad1d(0x139)]),loggerService_1[_0x18ad1d(0x161)]['logWhiteDomainError'](_0x18ad1d(0x166),_0x18ad1d(0x142),_0x18ad1d(0x110)+_0x1bccd2+_0x18ad1d(0x146)+_0x4dca7e);throw new Error('Rapyd\x20API\x20error\x20('+_0x1bccd2+_0x18ad1d(0x146)+_0x4dca7e);}if(!_0x54fdab[_0x18ad1d(0x12b)]?.['id']||!_0x54fdab[_0x18ad1d(0x12b)]?.[_0x18ad1d(0x158)]){console[_0x18ad1d(0x135)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x18ad1d(0x135)](_0x18ad1d(0x14f),_0x54fdab[_0x18ad1d(0x12b)]),loggerService_1[_0x18ad1d(0x161)]['logWhiteDomainError']('rapyd',_0x18ad1d(0x142),_0x18ad1d(0x136));throw new Error(_0x18ad1d(0x116));}return console[_0x18ad1d(0x104)](_0x18ad1d(0x114)),console['log'](_0x18ad1d(0x111),_0x54fdab[_0x18ad1d(0x12b)]['id']),console['log'](_0x18ad1d(0x159),_0x54fdab[_0x18ad1d(0x12b)]['redirect_url']),console[_0x18ad1d(0x104)]('üá¨üáß\x20Country\x20used:\x20'+_0x42d506+_0x18ad1d(0x149)),console['log'](_0x18ad1d(0x134)),{'gateway_payment_id':_0x54fdab[_0x18ad1d(0x12b)]['id'],'payment_url':_0x54fdab[_0x18ad1d(0x12b)][_0x18ad1d(0x158)]};}catch(_0xbb92bb){console['error'](_0x18ad1d(0x10c)),console[_0x18ad1d(0x135)](_0x18ad1d(0x165),_0xbb92bb),loggerService_1[_0x18ad1d(0x161)][_0x18ad1d(0x12d)](_0x18ad1d(0x166),_0x18ad1d(0x142),_0xbb92bb);if(_0xbb92bb instanceof Error){console[_0x18ad1d(0x135)](_0x18ad1d(0x15c),_0xbb92bb[_0x18ad1d(0x121)]),console[_0x18ad1d(0x135)](_0x18ad1d(0x101),_0xbb92bb[_0x18ad1d(0x117)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0xbb92bb[_0x18ad1d(0x121)]);}throw new Error(_0x18ad1d(0x143));}}async[a42_0x15774b(0x129)](_0x2bdee6){const _0x17d039=a42_0x15774b,_0x2c97db=Date[_0x17d039(0x115)]();try{loggerService_1[_0x17d039(0x161)][_0x17d039(0x11b)]('rapyd',_0x17d039(0xff)+_0x2bdee6,_0x17d039(0x14a),{});const _0x29a2e6=await fetch(this[_0x17d039(0x156)]+'/'+_0x2bdee6,{'method':_0x17d039(0x14a),'headers':{'Content-Type':_0x17d039(0x167),'User-Agent':_0x17d039(0x122)}}),_0x3b756d=Date[_0x17d039(0x115)]()-_0x2c97db;if(!_0x29a2e6['ok']){const _0x52b317=await _0x29a2e6['text']();loggerService_1[_0x17d039(0x161)][_0x17d039(0x127)](_0x17d039(0x166),_0x17d039(0xff)+_0x2bdee6,_0x29a2e6[_0x17d039(0x139)],_0x52b317,_0x3b756d);throw new Error(_0x17d039(0x13c)+_0x29a2e6['status']);}const _0x579b4c=await _0x29a2e6[_0x17d039(0x11c)]();loggerService_1[_0x17d039(0x161)]['logWhiteDomainResponse'](_0x17d039(0x166),_0x17d039(0xff)+_0x2bdee6,_0x29a2e6[_0x17d039(0x139)],_0x579b4c,_0x3b756d);if(_0x579b4c[_0x17d039(0x139)]?.['status']!=='SUCCESS'){loggerService_1[_0x17d039(0x161)]['logWhiteDomainError']('rapyd',_0x17d039(0xff)+_0x2bdee6,_0x17d039(0x14e)+(_0x579b4c['status']?.[_0x17d039(0x121)]||_0x17d039(0x145)));throw new Error(_0x17d039(0x14e)+(_0x579b4c[_0x17d039(0x139)]?.['message']||'Unknown\x20error'));}let _0x33039c=_0x17d039(0x105);if(_0x579b4c[_0x17d039(0x12b)]?.[_0x17d039(0x139)])switch(_0x579b4c['data']['status']['toUpperCase']()){case _0x17d039(0x118):_0x33039c=_0x17d039(0x128);break;case _0x17d039(0x102):_0x33039c=_0x17d039(0x14d);break;case _0x17d039(0x155):_0x33039c='EXPIRED';break;case _0x17d039(0x13b):_0x33039c=_0x17d039(0x14d);break;case _0x17d039(0x141):case _0x17d039(0x12a):default:_0x33039c=_0x17d039(0x105);break;}return{'status':_0x33039c,'amount':_0x579b4c[_0x17d039(0x12b)]?.[_0x17d039(0x163)],'currency':_0x579b4c[_0x17d039(0x12b)]?.[_0x17d039(0x150)]};}catch(_0xda81c3){console['error'](_0x17d039(0x125),_0xda81c3),loggerService_1[_0x17d039(0x161)]['logWhiteDomainError'](_0x17d039(0x166),_0x17d039(0xff)+_0x2bdee6,_0xda81c3);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0xda81c3 instanceof Error?_0xda81c3['message']:_0x17d039(0x145)));}}async['processWebhook'](_0x10ab88){const _0x5d23b5=a42_0x15774b;console['log'](_0x5d23b5(0x10b),_0x10ab88);let _0x16ea2d=_0x5d23b5(0x105);switch(_0x10ab88[_0x5d23b5(0x148)]?.[_0x5d23b5(0x10e)]()){case _0x5d23b5(0x160):_0x10ab88[_0x5d23b5(0x12b)]?.[_0x5d23b5(0x13e)]===!![]&&_0x10ab88[_0x5d23b5(0x12b)]?.[_0x5d23b5(0x139)]===_0x5d23b5(0x118)?_0x16ea2d=_0x5d23b5(0x128):_0x16ea2d='PENDING';break;case _0x5d23b5(0x112):_0x16ea2d=_0x5d23b5(0x14d);break;case'PAYMENT_EXPIRED':_0x16ea2d='EXPIRED';break;case _0x5d23b5(0x14b):_0x16ea2d=_0x5d23b5(0x14d);break;default:switch(_0x10ab88[_0x5d23b5(0x12b)]?.[_0x5d23b5(0x139)]?.['toUpperCase']()){case'CLO':_0x10ab88['data']?.['paid']===!![]?_0x16ea2d=_0x5d23b5(0x128):_0x16ea2d='FAILED';break;case _0x5d23b5(0x102):_0x16ea2d=_0x5d23b5(0x14d);break;case _0x5d23b5(0x155):_0x16ea2d=_0x5d23b5(0x153);break;case'ERR':_0x16ea2d=_0x5d23b5(0x14d);break;case _0x5d23b5(0x141):case'ACT':default:_0x16ea2d=_0x5d23b5(0x105);break;}break;}return{'paymentId':_0x10ab88[_0x5d23b5(0x12b)]?.[_0x5d23b5(0x144)]||'','status':_0x16ea2d,'amount':_0x10ab88[_0x5d23b5(0x12b)]?.[_0x5d23b5(0x163)],'currency':_0x10ab88[_0x5d23b5(0x12b)]?.[_0x5d23b5(0x150)]};}}function a42_0xd273(_0x260982,_0x4e3bcc){const _0x3209df=a42_0x3209();return a42_0xd273=function(_0xd2734,_0x341b6c){_0xd2734=_0xd2734-0xfe;let _0x2fe222=_0x3209df[_0xd2734];return _0x2fe222;},a42_0xd273(_0x260982,_0x4e3bcc);}function a42_0x3209(){const _0x1f1ccc=['Error\x20stack:','CAN','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','log','PENDING','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','Parsed\x20Result:','entries','statusText','createPaymentLink','Processing\x20Rapyd\x20webhook:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','stringify','toUpperCase','6VWWjNn','Business\x20Error\x20(','Payment\x20Link\x20ID:','PAYMENT_CANCELED','10624248DkhodD','===\x20RAPYD\x20SUCCESS\x20===','now','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','stack','CLO','Response\x20Body:','POST','logWhiteDomainRequest','json','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','text','https://tesoft.uk/gateway/fail.php?id=','1329444WuWKRo','message','TesSoft\x20Payment\x20System/1.0','2062700VGMDDO','88LKvves','Rapyd\x20payment\x20verification\x20error:','Full\x20Error\x20Data:','logWhiteDomainResponse','PAID','verifyPayment','ACT','data','HTTP\x20Status:','logWhiteDomainError','6393070QzPbgt','2523504xbgqYg','Error\x20Message:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','error','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','===\x20RAPYD\x20API\x20ERROR\x20===','SUCCESS','status','\x20(always\x20GB\x20for\x20Rapyd)','ERR','HTTP\x20error!\x20status:\x20','headers','paid','Raw\x20Response\x20Body:','9uXPliT','NEW','/v1/hosted/payment_links','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','merchant_reference_id','Unknown\x20error','):\x20','https://tesoft.uk/gateway/success.php?id=','type','\x20(GB\x20-\x20Britain)','GET','PAYMENT_FAILED','RapydService','FAILED','Rapyd\x20API\x20error:\x20','Response\x20data:','currency','8JEmgby','Status\x20Text:','EXPIRED','3015866bEbgRe','EXP','apiUrl','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','redirect_url','Redirect\x20URL:','URL:','üá¨üáß\x20Country:\x20','Error\x20message:','Headers:','fromEntries','Error\x20Code:','PAYMENT_COMPLETED','loggerService','74aVwVlb','amount','HTTP\x20','Error\x20details:','rapyd','application/json','Response\x20Time:','/v1/hosted/payment_links/','33388CxMfsS'];a42_0x3209=function(){return _0x1f1ccc;};return a42_0x3209();}exports[a42_0x15774b(0x14c)]=RapydService;