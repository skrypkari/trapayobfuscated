'use strict';const a46_0x18d375=a46_0x3b4e;(function(_0x520a94,_0x705c4b){const _0x307620=a46_0x3b4e,_0x33a23f=_0x520a94();while(!![]){try{const _0x3e5141=parseInt(_0x307620(0x1aa))/0x1*(parseInt(_0x307620(0x1fb))/0x2)+parseInt(_0x307620(0x1fc))/0x3*(-parseInt(_0x307620(0x1d8))/0x4)+-parseInt(_0x307620(0x1c5))/0x5+-parseInt(_0x307620(0x1fe))/0x6*(-parseInt(_0x307620(0x1fd))/0x7)+-parseInt(_0x307620(0x1f7))/0x8+-parseInt(_0x307620(0x1c1))/0x9*(parseInt(_0x307620(0x1b1))/0xa)+parseInt(_0x307620(0x1ee))/0xb*(parseInt(_0x307620(0x1a3))/0xc);if(_0x3e5141===_0x705c4b)break;else _0x33a23f['push'](_0x33a23f['shift']());}catch(_0x216f92){_0x33a23f['push'](_0x33a23f['shift']());}}}(a46_0x11cb,0x573e2));Object[a46_0x18d375(0x18c)](exports,a46_0x18d375(0x1ec),{'value':!![]}),exports[a46_0x18d375(0x1b9)]=void 0x0;function a46_0x11cb(){const _0x12d7df=['üí•\x20Rapyd\x20failure\x20message:\x20','\x20(always\x20GB\x20for\x20Rapyd)','logWhiteDomainRequest','Response\x20Body:','3216TjmJxX','Error\x20Code:','ORDER:\x20','CAN','toUpperCase','Unknown\x20error\x20from\x20Rapyd\x20API','type','367214XNlSPM','Status\x20Text:','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','PAYMENT_COMPLETED','Payment\x20Link\x20ID:','Response\x20data:','10xYMSFm','now','GET','loggerService','Business\x20Error\x20(','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','ACT','Rapyd\x20API\x20error:\x20','RapydService','failure_code','POST','Error\x20Message:','Full\x20Error\x20Data:','Raw\x20Response\x20Body:','FAILED','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','5778081wQlauu','failureCode','Error\x20stack:','Rapyd\x20payment\x20verification\x20error:','2471070zsGzhW','gb_mastercard_card','../loggerService','amount','PAYMENT_EXPIRED','logWhiteDomainError','Unknown\x20error','TesSoft\x20Payment\x20System/1.0','text','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===',',\x20failureMessage=','processWebhook','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','NEW','PAID','ERR','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','===\x20RAPYD\x20SUCCESS\x20===','4OMdMft','errorCode','gb_visa_card','error','redirect_url','fromEntries','error_code','PENDING','UNKNOWN','application/json','apiUrl','Response\x20Time:','last4','payment_method_type',',\x20body:\x20','EXP','EXPIRED','entries','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Rapyd\x20API\x20error\x20(','__esModule','/v1/hosted/payment_links','67595ZbiLAr','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','currency','Redirect\x20URL:','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Status:','\x20(GB\x20-\x20Britain)','HTTP\x20error!\x20status:\x20','5285472TVTbHF','logWhiteDomainResponse','payment_method_data','HTTP\x20','2EuKIIT','1319847UFhLOI','224WwhtiM','108774Whbtpd','paid','data','defineProperty','https://tesoft.uk/gateway/fail.php?id=','rapyd','log','SUCCESS','parse','failure_message','status','message','headers','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','):\x20','createPaymentLink','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','/v1/hosted/payment_links/','Failed\x20to\x20parse\x20JSON\x20response:','PAYMENT_CANCELED','CLO'];a46_0x11cb=function(){return _0x12d7df;};return a46_0x11cb();}function a46_0x3b4e(_0xa6c916,_0x19349f){const _0x11cb2e=a46_0x11cb();return a46_0x3b4e=function(_0x3b4e29,_0x12197d){_0x3b4e29=_0x3b4e29-0x18a;let _0x11a3d0=_0x11cb2e[_0x3b4e29];return _0x11a3d0;},a46_0x3b4e(_0xa6c916,_0x19349f);}const loggerService_1=require(a46_0x18d375(0x1c7));class RapydService{constructor(){const _0x12d428=a46_0x18d375;this[_0x12d428(0x1e2)]='https://tesoft.uk/gateway/rapyd/',console[_0x12d428(0x18f)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a46_0x18d375(0x199)](_0x554808){const _0x20cf2e=a46_0x18d375,{orderId:_0x1bbe51,orderName:_0x1217c2,amount:_0x4ed3ee,currency:_0x2f65a8,usage:_0x18c38a,maxPayments:_0x660ec5,successUrl:_0x4fc928,failUrl:_0x455e43}=_0x554808,_0x31fa9c=_0x2f65a8[_0x20cf2e(0x1a7)](),_0x131580='GB';console[_0x20cf2e(0x18f)](_0x20cf2e(0x1ea));const _0x1afc7c='https://tesoft.uk/gateway/success.php?id='+_0x1bbe51,_0xd122ce=_0x20cf2e(0x18d)+_0x1bbe51,_0x285c95={'amount':_0x4ed3ee,'currency':_0x31fa9c,'cancel_checkout_url':_0xd122ce,'complete_checkout_url':_0x1afc7c,'complete_payment_url':_0x1afc7c,'merchant_reference_id':_0x1bbe51,'description':_0x20cf2e(0x1a5)+_0x1bbe51,'country':'GB','payment_method_types_include':[_0x20cf2e(0x1da),_0x20cf2e(0x1c6)],'custom_elements':{'display_description':!![]}},_0x8d0ea1=Date[_0x20cf2e(0x1b2)]();try{console['log'](_0x20cf2e(0x1f0)),console[_0x20cf2e(0x18f)]('URL:',this[_0x20cf2e(0x1e2)]),console[_0x20cf2e(0x18f)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x20cf2e(0x1ad)](_0x285c95,null,0x2)),console[_0x20cf2e(0x18f)]('üá¨üáß\x20Country:\x20'+_0x131580+_0x20cf2e(0x1a0)),console['log'](_0x20cf2e(0x1d1)),loggerService_1['loggerService'][_0x20cf2e(0x1a1)](_0x20cf2e(0x18e),_0x20cf2e(0x1ed),_0x20cf2e(0x1bb),_0x285c95);const _0x49258a=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x20cf2e(0x1e1),'User-Agent':_0x20cf2e(0x1cc)},'body':JSON[_0x20cf2e(0x1ad)](_0x285c95)}),_0x3e6eb4=Date[_0x20cf2e(0x1b2)]()-_0x8d0ea1;console['log'](_0x20cf2e(0x1ce)),console['log'](_0x20cf2e(0x1f4),_0x49258a[_0x20cf2e(0x193)]),console[_0x20cf2e(0x18f)](_0x20cf2e(0x1ab),_0x49258a['statusText']),console[_0x20cf2e(0x18f)]('Headers:',Object[_0x20cf2e(0x1dd)](_0x49258a[_0x20cf2e(0x195)][_0x20cf2e(0x1e9)]())),console[_0x20cf2e(0x18f)](_0x20cf2e(0x1e3),_0x3e6eb4+'ms');const _0x26b32e=await _0x49258a['text']();console[_0x20cf2e(0x18f)](_0x20cf2e(0x1be),_0x26b32e);if(!_0x49258a['ok']){console[_0x20cf2e(0x1db)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x49258a[_0x20cf2e(0x193)]),console[_0x20cf2e(0x1db)](_0x20cf2e(0x1a2),_0x26b32e),loggerService_1[_0x20cf2e(0x1b4)][_0x20cf2e(0x1f8)](_0x20cf2e(0x18e),_0x20cf2e(0x1ed),_0x49258a[_0x20cf2e(0x193)],_0x26b32e,_0x3e6eb4),loggerService_1['loggerService']['logWhiteDomainError'](_0x20cf2e(0x18e),_0x20cf2e(0x1ed),_0x20cf2e(0x1fa)+_0x49258a[_0x20cf2e(0x193)]+':\x20'+_0x26b32e);throw new Error(_0x20cf2e(0x1f6)+_0x49258a['status']+_0x20cf2e(0x1e6)+_0x26b32e);}let _0x229c81;try{_0x229c81=JSON[_0x20cf2e(0x191)](_0x26b32e);}catch(_0x591a21){console[_0x20cf2e(0x1db)](_0x20cf2e(0x19c),_0x591a21),loggerService_1[_0x20cf2e(0x1b4)][_0x20cf2e(0x1ca)](_0x20cf2e(0x18e),_0x20cf2e(0x1ed),_0x20cf2e(0x196)+_0x591a21);throw new Error(_0x20cf2e(0x1b6)+_0x26b32e);}console[_0x20cf2e(0x18f)](_0x20cf2e(0x1ef)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x229c81,null,0x2)),loggerService_1[_0x20cf2e(0x1b4)]['logWhiteDomainResponse'](_0x20cf2e(0x18e),_0x20cf2e(0x1ed),_0x49258a[_0x20cf2e(0x193)],_0x229c81,_0x3e6eb4);if(_0x229c81[_0x20cf2e(0x193)]?.['status']!=='SUCCESS'){const _0x1d2f50=_0x229c81[_0x20cf2e(0x193)]?.['message']||_0x20cf2e(0x1a8),_0x1c0a74=_0x229c81[_0x20cf2e(0x193)]?.['error_code']||_0x20cf2e(0x1e0);console[_0x20cf2e(0x1db)](_0x20cf2e(0x1d6)),console[_0x20cf2e(0x1db)](_0x20cf2e(0x1a4),_0x1c0a74),console[_0x20cf2e(0x1db)](_0x20cf2e(0x1bc),_0x1d2f50),console[_0x20cf2e(0x1db)](_0x20cf2e(0x1bd),_0x229c81[_0x20cf2e(0x193)]),loggerService_1['loggerService'][_0x20cf2e(0x1ca)](_0x20cf2e(0x18e),'/v1/hosted/payment_links',_0x20cf2e(0x1b5)+_0x1c0a74+_0x20cf2e(0x198)+_0x1d2f50);throw new Error(_0x20cf2e(0x1eb)+_0x1c0a74+_0x20cf2e(0x198)+_0x1d2f50);}if(!_0x229c81['data']?.['id']||!_0x229c81[_0x20cf2e(0x18b)]?.[_0x20cf2e(0x1dc)]){console[_0x20cf2e(0x1db)](_0x20cf2e(0x1ac)),console[_0x20cf2e(0x1db)](_0x20cf2e(0x1f3)),console['error'](_0x20cf2e(0x1b0),_0x229c81['data']),loggerService_1[_0x20cf2e(0x1b4)][_0x20cf2e(0x1ca)](_0x20cf2e(0x18e),_0x20cf2e(0x1ed),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x20cf2e(0x19a));}return console['log'](_0x20cf2e(0x1d7)),console['log'](_0x20cf2e(0x1af),_0x229c81['data']['id']),console[_0x20cf2e(0x18f)](_0x20cf2e(0x1f2),_0x229c81[_0x20cf2e(0x18b)][_0x20cf2e(0x1dc)]),console[_0x20cf2e(0x18f)]('üá¨üáß\x20Country\x20used:\x20'+_0x131580+_0x20cf2e(0x1f5)),console[_0x20cf2e(0x18f)](_0x20cf2e(0x1d1)),{'gateway_payment_id':_0x229c81['data']['id'],'payment_url':_0x229c81[_0x20cf2e(0x18b)][_0x20cf2e(0x1dc)]};}catch(_0x108919){console[_0x20cf2e(0x1db)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x20cf2e(0x1db)]('Error\x20details:',_0x108919),loggerService_1[_0x20cf2e(0x1b4)][_0x20cf2e(0x1ca)](_0x20cf2e(0x18e),_0x20cf2e(0x1ed),_0x108919);if(_0x108919 instanceof Error){console[_0x20cf2e(0x1db)]('Error\x20message:',_0x108919[_0x20cf2e(0x194)]),console[_0x20cf2e(0x1db)](_0x20cf2e(0x1c3),_0x108919['stack']);throw new Error(_0x20cf2e(0x197)+_0x108919[_0x20cf2e(0x194)]);}throw new Error(_0x20cf2e(0x1d5));}}async['verifyPayment'](_0x31962e){const _0x51050d=a46_0x18d375,_0x384d03=Date[_0x51050d(0x1b2)]();try{loggerService_1['loggerService'][_0x51050d(0x1a1)](_0x51050d(0x18e),_0x51050d(0x19b)+_0x31962e,_0x51050d(0x1b3),{});const _0x55479f=await fetch(this[_0x51050d(0x1e2)]+'/'+_0x31962e,{'method':'GET','headers':{'Content-Type':_0x51050d(0x1e1),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x28f458=Date[_0x51050d(0x1b2)]()-_0x384d03;if(!_0x55479f['ok']){const _0xe883c2=await _0x55479f[_0x51050d(0x1cd)]();loggerService_1[_0x51050d(0x1b4)][_0x51050d(0x1f8)]('rapyd',_0x51050d(0x19b)+_0x31962e,_0x55479f[_0x51050d(0x193)],_0xe883c2,_0x28f458);throw new Error(_0x51050d(0x1f6)+_0x55479f[_0x51050d(0x193)]);}const _0x4dbaa1=await _0x55479f['json']();loggerService_1['loggerService'][_0x51050d(0x1f8)](_0x51050d(0x18e),_0x51050d(0x19b)+_0x31962e,_0x55479f[_0x51050d(0x193)],_0x4dbaa1,_0x28f458);if(_0x4dbaa1['status']?.['status']!==_0x51050d(0x190)){loggerService_1[_0x51050d(0x1b4)][_0x51050d(0x1ca)](_0x51050d(0x18e),'/v1/hosted/payment_links/'+_0x31962e,_0x51050d(0x1b8)+(_0x4dbaa1[_0x51050d(0x193)]?.[_0x51050d(0x194)]||'Unknown\x20error'));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x4dbaa1['status']?.['message']||_0x51050d(0x1cb)));}let _0x1d5d9b='PENDING';if(_0x4dbaa1[_0x51050d(0x18b)]?.['status'])switch(_0x4dbaa1['data'][_0x51050d(0x193)][_0x51050d(0x1a7)]()){case _0x51050d(0x19e):_0x1d5d9b='PAID';break;case _0x51050d(0x1a6):_0x1d5d9b=_0x51050d(0x1bf);break;case _0x51050d(0x1e7):_0x1d5d9b='EXPIRED';break;case _0x51050d(0x1d4):_0x1d5d9b=_0x51050d(0x1bf);break;case _0x51050d(0x1d2):case _0x51050d(0x1b7):default:_0x1d5d9b=_0x51050d(0x1df);break;}return{'status':_0x1d5d9b,'amount':_0x4dbaa1[_0x51050d(0x18b)]?.[_0x51050d(0x1c8)],'currency':_0x4dbaa1[_0x51050d(0x18b)]?.[_0x51050d(0x1f1)]};}catch(_0x28154a){console['error'](_0x51050d(0x1c4),_0x28154a),loggerService_1[_0x51050d(0x1b4)][_0x51050d(0x1ca)](_0x51050d(0x18e),'/v1/hosted/payment_links/'+_0x31962e,_0x28154a);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x28154a instanceof Error?_0x28154a['message']:_0x51050d(0x1cb)));}}async[a46_0x18d375(0x1d0)](_0x4845cd){const _0x575193=a46_0x18d375;console[_0x575193(0x18f)]('Processing\x20Rapyd\x20webhook:',_0x4845cd);let _0x26adb4=_0x575193(0x1df),_0x59a952;_0x4845cd[_0x575193(0x18b)]?.[_0x575193(0x192)]&&(_0x59a952=_0x4845cd[_0x575193(0x18b)][_0x575193(0x192)],console[_0x575193(0x18f)](_0x575193(0x19f)+_0x59a952));switch(_0x4845cd[_0x575193(0x1a9)]?.['toUpperCase']()){case _0x575193(0x1ae):_0x4845cd[_0x575193(0x18b)]?.[_0x575193(0x18a)]===!![]&&_0x4845cd['data']?.[_0x575193(0x193)]===_0x575193(0x19e)?_0x26adb4='PAID':_0x26adb4=_0x575193(0x1df);break;case _0x575193(0x19d):_0x26adb4=_0x575193(0x1bf);break;case _0x575193(0x1c9):_0x26adb4=_0x575193(0x1e8);break;case'PAYMENT_FAILED':_0x26adb4='FAILED';!_0x59a952&&_0x4845cd[_0x575193(0x18b)]?.['failure_message']&&(_0x59a952=_0x4845cd[_0x575193(0x18b)][_0x575193(0x192)]);break;default:switch(_0x4845cd[_0x575193(0x18b)]?.[_0x575193(0x193)]?.[_0x575193(0x1a7)]()){case _0x575193(0x19e):_0x4845cd[_0x575193(0x18b)]?.['paid']===!![]?_0x26adb4=_0x575193(0x1d3):_0x26adb4=_0x575193(0x1bf);break;case _0x575193(0x1a6):_0x26adb4='FAILED';break;case'EXP':_0x26adb4=_0x575193(0x1e8);break;case'ERR':_0x26adb4=_0x575193(0x1bf);!_0x59a952&&_0x4845cd['data']?.[_0x575193(0x192)]&&(_0x59a952=_0x4845cd['data']['failure_message']);break;case'NEW':case'ACT':default:_0x26adb4=_0x575193(0x1df);break;}break;}const _0x1c5709={};return _0x4845cd[_0x575193(0x18b)]?.[_0x575193(0x1f9)]?.['last4']&&(_0x1c5709['cardLast4']=_0x4845cd[_0x575193(0x18b)]['payment_method_data'][_0x575193(0x1e4)]),_0x4845cd[_0x575193(0x18b)]?.[_0x575193(0x1e5)]&&(_0x1c5709['paymentMethod']=_0x4845cd['data'][_0x575193(0x1e5)]),_0x4845cd['data']?.[_0x575193(0x1de)]&&(_0x1c5709[_0x575193(0x1d9)]=_0x4845cd[_0x575193(0x18b)][_0x575193(0x1de)]),_0x4845cd['data']?.[_0x575193(0x1ba)]&&(_0x1c5709[_0x575193(0x1c2)]=_0x4845cd['data'][_0x575193(0x1ba)]),console[_0x575193(0x18f)](_0x575193(0x1c0)+_0x26adb4+_0x575193(0x1cf)+(_0x59a952||'none')),{'paymentId':_0x4845cd['data']?.['merchant_reference_id']||'','status':_0x26adb4,'amount':_0x4845cd[_0x575193(0x18b)]?.[_0x575193(0x1c8)],'currency':_0x4845cd[_0x575193(0x18b)]?.[_0x575193(0x1f1)],'failureMessage':_0x59a952,'additionalInfo':_0x1c5709};}}exports[a46_0x18d375(0x1b9)]=RapydService;