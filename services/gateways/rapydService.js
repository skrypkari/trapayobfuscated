'use strict';const a42_0x561e52=a42_0xb2e7;(function(_0x2817d8,_0x1cc724){const _0x1c4d6f=a42_0xb2e7,_0x28dc04=_0x2817d8();while(!![]){try{const _0x18cc93=-parseInt(_0x1c4d6f(0x1bd))/0x1*(-parseInt(_0x1c4d6f(0x17f))/0x2)+-parseInt(_0x1c4d6f(0x1a9))/0x3*(-parseInt(_0x1c4d6f(0x1ae))/0x4)+parseInt(_0x1c4d6f(0x191))/0x5+-parseInt(_0x1c4d6f(0x17b))/0x6*(parseInt(_0x1c4d6f(0x1ef))/0x7)+parseInt(_0x1c4d6f(0x1d4))/0x8+parseInt(_0x1c4d6f(0x1b1))/0x9+-parseInt(_0x1c4d6f(0x1b0))/0xa;if(_0x18cc93===_0x1cc724)break;else _0x28dc04['push'](_0x28dc04['shift']());}catch(_0x56091b){_0x28dc04['push'](_0x28dc04['shift']());}}}(a42_0x81ac,0x5518b));Object[a42_0x561e52(0x197)](exports,a42_0x561e52(0x1ca),{'value':!![]}),exports[a42_0x561e52(0x1da)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x59a546=a42_0x561e52;this['apiUrl']=_0x59a546(0x1d6),console[_0x59a546(0x1a1)](_0x59a546(0x1ab));}async[a42_0x561e52(0x1d9)](_0x2ab1f4){const _0xdcf478=a42_0x561e52,{orderId:_0x5a1ce9,orderName:_0x1ebd0b,amount:_0x46492d,currency:_0x30625f,usage:_0x1a14cc,maxPayments:_0x210558,successUrl:_0xfb42b1,failUrl:_0x5300fb}=_0x2ab1f4,_0x3f248f=_0x30625f['toUpperCase'](),_0x4a1ccf='GB';console[_0xdcf478(0x1a1)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0xde7c09=_0xdcf478(0x184)+_0x5a1ce9,_0x232f4b=_0xdcf478(0x1cc)+_0x5a1ce9,_0x86bd42={'amount':_0x46492d,'currency':_0x3f248f,'cancel_checkout_url':_0x232f4b,'complete_checkout_url':_0xde7c09,'complete_payment_url':_0xde7c09,'merchant_reference_id':_0x5a1ce9,'description':_0xdcf478(0x186)+_0x5a1ce9,'country':'GB','payment_method_types_include':[_0xdcf478(0x1d3),_0xdcf478(0x190)],'custom_elements':{'display_description':!![]}},_0x312a73=Date[_0xdcf478(0x19c)]();try{console[_0xdcf478(0x1a1)](_0xdcf478(0x179)),console['log'](_0xdcf478(0x1c5),this[_0xdcf478(0x1bb)]),console[_0xdcf478(0x1a1)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0xdcf478(0x1ac)](_0x86bd42,null,0x2)),console[_0xdcf478(0x1a1)](_0xdcf478(0x1d1)+_0x4a1ccf+_0xdcf478(0x1cf)),console[_0xdcf478(0x1a1)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0xdcf478(0x199)]['logWhiteDomainRequest'](_0xdcf478(0x1e5),_0xdcf478(0x1a3),'POST',_0x86bd42);const _0x1c4a6a=await fetch(this[_0xdcf478(0x1bb)],{'method':_0xdcf478(0x18d),'headers':{'Content-Type':'application/json','User-Agent':_0xdcf478(0x188)},'body':JSON[_0xdcf478(0x1ac)](_0x86bd42)}),_0x22275d=Date[_0xdcf478(0x19c)]()-_0x312a73;console[_0xdcf478(0x1a1)](_0xdcf478(0x1c7)),console[_0xdcf478(0x1a1)](_0xdcf478(0x1c2),_0x1c4a6a['status']),console[_0xdcf478(0x1a1)](_0xdcf478(0x1b2),_0x1c4a6a[_0xdcf478(0x1a5)]),console[_0xdcf478(0x1a1)]('Headers:',Object[_0xdcf478(0x198)](_0x1c4a6a[_0xdcf478(0x1be)][_0xdcf478(0x1e1)]())),console['log'](_0xdcf478(0x19f),_0x22275d+'ms');const _0x3c5669=await _0x1c4a6a[_0xdcf478(0x189)]();console['log']('Raw\x20Response\x20Body:',_0x3c5669);if(!_0x1c4a6a['ok']){console[_0xdcf478(0x1dd)](_0xdcf478(0x1a0)),console['error'](_0xdcf478(0x1b5),_0x1c4a6a['status']),console[_0xdcf478(0x1dd)](_0xdcf478(0x1db),_0x3c5669),loggerService_1['loggerService'][_0xdcf478(0x1ad)]('rapyd',_0xdcf478(0x1a3),_0x1c4a6a['status'],_0x3c5669,_0x22275d),loggerService_1[_0xdcf478(0x199)][_0xdcf478(0x1c9)]('rapyd',_0xdcf478(0x1a3),_0xdcf478(0x1d7)+_0x1c4a6a['status']+':\x20'+_0x3c5669);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1c4a6a[_0xdcf478(0x1aa)]+_0xdcf478(0x18e)+_0x3c5669);}let _0x5acf29;try{_0x5acf29=JSON['parse'](_0x3c5669);}catch(_0x2b1dc9){console[_0xdcf478(0x1dd)](_0xdcf478(0x1df),_0x2b1dc9),loggerService_1[_0xdcf478(0x199)][_0xdcf478(0x1c9)](_0xdcf478(0x1e5),_0xdcf478(0x1a3),_0xdcf478(0x18f)+_0x2b1dc9);throw new Error(_0xdcf478(0x1e3)+_0x3c5669);}console[_0xdcf478(0x1a1)](_0xdcf478(0x1dc)),console['log'](_0xdcf478(0x1e0),JSON[_0xdcf478(0x1ac)](_0x5acf29,null,0x2)),loggerService_1[_0xdcf478(0x199)][_0xdcf478(0x1ad)](_0xdcf478(0x1e5),_0xdcf478(0x1a3),_0x1c4a6a['status'],_0x5acf29,_0x22275d);if(_0x5acf29[_0xdcf478(0x1aa)]?.[_0xdcf478(0x1aa)]!==_0xdcf478(0x1ce)){const _0x7ba850=_0x5acf29[_0xdcf478(0x1aa)]?.[_0xdcf478(0x181)]||_0xdcf478(0x1f0),_0x26a4cb=_0x5acf29[_0xdcf478(0x1aa)]?.['error_code']||_0xdcf478(0x19a);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0xdcf478(0x19d),_0x26a4cb),console[_0xdcf478(0x1dd)](_0xdcf478(0x1e9),_0x7ba850),console['error'](_0xdcf478(0x1ee),_0x5acf29['status']),loggerService_1['loggerService'][_0xdcf478(0x1c9)](_0xdcf478(0x1e5),_0xdcf478(0x1a3),_0xdcf478(0x1bc)+_0x26a4cb+_0xdcf478(0x192)+_0x7ba850);throw new Error(_0xdcf478(0x1ed)+_0x26a4cb+_0xdcf478(0x192)+_0x7ba850);}if(!_0x5acf29[_0xdcf478(0x1e4)]?.['id']||!_0x5acf29[_0xdcf478(0x1e4)]?.[_0xdcf478(0x18c)]){console[_0xdcf478(0x1dd)](_0xdcf478(0x17d)),console[_0xdcf478(0x1dd)](_0xdcf478(0x182)),console[_0xdcf478(0x1dd)]('Response\x20data:',_0x5acf29[_0xdcf478(0x1e4)]),loggerService_1['loggerService'][_0xdcf478(0x1c9)](_0xdcf478(0x1e5),_0xdcf478(0x1a3),_0xdcf478(0x1ba));throw new Error(_0xdcf478(0x1cb));}return console['log'](_0xdcf478(0x178)),console['log'](_0xdcf478(0x1c3),_0x5acf29['data']['id']),console['log'](_0xdcf478(0x1b3),_0x5acf29[_0xdcf478(0x1e4)][_0xdcf478(0x18c)]),console[_0xdcf478(0x1a1)]('üá¨üáß\x20Country\x20used:\x20'+_0x4a1ccf+_0xdcf478(0x1b6)),console[_0xdcf478(0x1a1)](_0xdcf478(0x187)),{'gateway_payment_id':_0x5acf29['data']['id'],'payment_url':_0x5acf29[_0xdcf478(0x1e4)][_0xdcf478(0x18c)]};}catch(_0x48867b){console['error']('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0xdcf478(0x1dd)](_0xdcf478(0x1d8),_0x48867b),loggerService_1[_0xdcf478(0x199)]['logWhiteDomainError']('rapyd','/v1/hosted/payment_links',_0x48867b);if(_0x48867b instanceof Error){console[_0xdcf478(0x1dd)](_0xdcf478(0x1d0),_0x48867b[_0xdcf478(0x181)]),console['error'](_0xdcf478(0x1c0),_0x48867b['stack']);throw new Error(_0xdcf478(0x195)+_0x48867b[_0xdcf478(0x181)]);}throw new Error(_0xdcf478(0x1eb));}}async['verifyPayment'](_0xf5673){const _0x2bda26=a42_0x561e52,_0x366aee=Date[_0x2bda26(0x19c)]();try{loggerService_1['loggerService'][_0x2bda26(0x19b)](_0x2bda26(0x1e5),_0x2bda26(0x1b8)+_0xf5673,'GET',{});const _0x5aeb01=await fetch(this[_0x2bda26(0x1bb)]+'/'+_0xf5673,{'method':'GET','headers':{'Content-Type':_0x2bda26(0x19e),'User-Agent':_0x2bda26(0x188)}}),_0x5a28a0=Date[_0x2bda26(0x19c)]()-_0x366aee;if(!_0x5aeb01['ok']){const _0x2a063a=await _0x5aeb01[_0x2bda26(0x189)]();loggerService_1[_0x2bda26(0x199)][_0x2bda26(0x1ad)](_0x2bda26(0x1e5),_0x2bda26(0x1b8)+_0xf5673,_0x5aeb01['status'],_0x2a063a,_0x5a28a0);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5aeb01[_0x2bda26(0x1aa)]);}const _0x2f7edb=await _0x5aeb01[_0x2bda26(0x1a4)]();loggerService_1[_0x2bda26(0x199)][_0x2bda26(0x1ad)](_0x2bda26(0x1e5),_0x2bda26(0x1b8)+_0xf5673,_0x5aeb01['status'],_0x2f7edb,_0x5a28a0);if(_0x2f7edb[_0x2bda26(0x1aa)]?.[_0x2bda26(0x1aa)]!=='SUCCESS'){loggerService_1[_0x2bda26(0x199)][_0x2bda26(0x1c9)]('rapyd',_0x2bda26(0x1b8)+_0xf5673,_0x2bda26(0x1de)+(_0x2f7edb[_0x2bda26(0x1aa)]?.[_0x2bda26(0x181)]||'Unknown\x20error'));throw new Error(_0x2bda26(0x1de)+(_0x2f7edb[_0x2bda26(0x1aa)]?.[_0x2bda26(0x181)]||_0x2bda26(0x1b4)));}let _0x2fd42b=_0x2bda26(0x1c6);if(_0x2f7edb[_0x2bda26(0x1e4)]?.[_0x2bda26(0x1aa)])switch(_0x2f7edb[_0x2bda26(0x1e4)][_0x2bda26(0x1aa)][_0x2bda26(0x185)]()){case _0x2bda26(0x17e):_0x2fd42b=_0x2bda26(0x194);break;case _0x2bda26(0x1e8):_0x2fd42b=_0x2bda26(0x1a2);break;case'EXP':_0x2fd42b=_0x2bda26(0x183);break;case _0x2bda26(0x1d2):_0x2fd42b=_0x2bda26(0x1a2);break;case _0x2bda26(0x180):case _0x2bda26(0x196):default:_0x2fd42b='PENDING';break;}return{'status':_0x2fd42b,'amount':_0x2f7edb[_0x2bda26(0x1e4)]?.[_0x2bda26(0x1d5)],'currency':_0x2f7edb[_0x2bda26(0x1e4)]?.[_0x2bda26(0x1a7)]};}catch(_0x1ccbcf){console['error']('Rapyd\x20payment\x20verification\x20error:',_0x1ccbcf),loggerService_1[_0x2bda26(0x199)][_0x2bda26(0x1c9)](_0x2bda26(0x1e5),_0x2bda26(0x1b8)+_0xf5673,_0x1ccbcf);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x1ccbcf instanceof Error?_0x1ccbcf[_0x2bda26(0x181)]:'Unknown\x20error'));}}async[a42_0x561e52(0x1b9)](_0x1fd558){const _0x42a995=a42_0x561e52;console['log'](_0x42a995(0x1a6),_0x1fd558);let _0x478662=_0x42a995(0x1c6),_0x5e40f5;_0x1fd558['data']?.[_0x42a995(0x1c1)]&&(_0x5e40f5=_0x1fd558[_0x42a995(0x1e4)][_0x42a995(0x1c1)],console[_0x42a995(0x1a1)]('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x5e40f5));switch(_0x1fd558[_0x42a995(0x1c8)]?.['toUpperCase']()){case'PAYMENT_COMPLETED':_0x1fd558[_0x42a995(0x1e4)]?.['paid']===!![]&&_0x1fd558['data']?.[_0x42a995(0x1aa)]===_0x42a995(0x17e)?_0x478662='PAID':_0x478662=_0x42a995(0x1c6);break;case _0x42a995(0x1ec):_0x478662=_0x42a995(0x1a2);break;case _0x42a995(0x1e6):_0x478662=_0x42a995(0x183);break;case'PAYMENT_FAILED':_0x478662='FAILED';!_0x5e40f5&&_0x1fd558['data']?.['failure_message']&&(_0x5e40f5=_0x1fd558[_0x42a995(0x1e4)][_0x42a995(0x1c1)]);break;default:switch(_0x1fd558[_0x42a995(0x1e4)]?.[_0x42a995(0x1aa)]?.[_0x42a995(0x185)]()){case _0x42a995(0x17e):_0x1fd558[_0x42a995(0x1e4)]?.[_0x42a995(0x1cd)]===!![]?_0x478662=_0x42a995(0x194):_0x478662='FAILED';break;case'CAN':_0x478662=_0x42a995(0x1a2);break;case _0x42a995(0x1e2):_0x478662='EXPIRED';break;case _0x42a995(0x1d2):_0x478662=_0x42a995(0x1a2);!_0x5e40f5&&_0x1fd558['data']?.['failure_message']&&(_0x5e40f5=_0x1fd558['data'][_0x42a995(0x1c1)]);break;case _0x42a995(0x180):case _0x42a995(0x196):default:_0x478662=_0x42a995(0x1c6);break;}break;}const _0x5541d1={};return _0x1fd558['data']?.[_0x42a995(0x1bf)]?.[_0x42a995(0x1ea)]&&(_0x5541d1[_0x42a995(0x18b)]=_0x1fd558['data'][_0x42a995(0x1bf)]['last4']),_0x1fd558[_0x42a995(0x1e4)]?.[_0x42a995(0x1a8)]&&(_0x5541d1[_0x42a995(0x17c)]=_0x1fd558['data'][_0x42a995(0x1a8)]),_0x1fd558[_0x42a995(0x1e4)]?.[_0x42a995(0x17a)]&&(_0x5541d1[_0x42a995(0x1e7)]=_0x1fd558[_0x42a995(0x1e4)]['error_code']),_0x1fd558[_0x42a995(0x1e4)]?.[_0x42a995(0x1af)]&&(_0x5541d1['failureCode']=_0x1fd558[_0x42a995(0x1e4)]['failure_code']),console['log'](_0x42a995(0x193)+_0x478662+_0x42a995(0x18a)+(_0x5e40f5||_0x42a995(0x1c4))),{'paymentId':_0x1fd558['data']?.[_0x42a995(0x1b7)]||'','status':_0x478662,'amount':_0x1fd558['data']?.[_0x42a995(0x1d5)],'currency':_0x1fd558[_0x42a995(0x1e4)]?.[_0x42a995(0x1a7)],'failureMessage':_0x5e40f5,'additionalInfo':_0x5541d1};}}function a42_0xb2e7(_0x5c9d25,_0x173044){const _0x81ac27=a42_0x81ac();return a42_0xb2e7=function(_0xb2e774,_0x152a53){_0xb2e774=_0xb2e774-0x178;let _0x3df1d4=_0x81ac27[_0xb2e774];return _0x3df1d4;},a42_0xb2e7(_0x5c9d25,_0x173044);}function a42_0x81ac(){const _0x24ff4a=['amount','https://tesoft.uk/gateway/rapyd/','HTTP\x20','Error\x20details:','createPaymentLink','RapydService','Response\x20Body:','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','error','Rapyd\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Parsed\x20Result:','entries','EXP','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','data','rapyd','PAYMENT_EXPIRED','errorCode','CAN','Error\x20Message:','last4','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','PAYMENT_CANCELED','Rapyd\x20API\x20error\x20(','Full\x20Error\x20Data:','108409DToQHl','Unknown\x20error\x20from\x20Rapyd\x20API','===\x20RAPYD\x20SUCCESS\x20===','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','error_code','174MPndyr','paymentMethod','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CLO','382772kPwgwt','NEW','message','Missing\x20id\x20or\x20redirect_url\x20in\x20response','EXPIRED','https://tesoft.uk/gateway/success.php?id=','toUpperCase','ORDER:\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','TesSoft\x20Payment\x20System/1.0','text',',\x20failureMessage=','cardLast4','redirect_url','POST',',\x20body:\x20','JSON\x20Parse\x20Error:\x20','gb_mastercard_card','178850geRteZ','):\x20','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','PAID','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','ACT','defineProperty','fromEntries','loggerService','UNKNOWN','logWhiteDomainRequest','now','Error\x20Code:','application/json','Response\x20Time:','===\x20RAPYD\x20API\x20ERROR\x20===','log','FAILED','/v1/hosted/payment_links','json','statusText','Processing\x20Rapyd\x20webhook:','currency','payment_method_type','3PvIomq','status','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stringify','logWhiteDomainResponse','2501864qoTHvy','failure_code','12343090rHTeyo','4846032uSrVxM','Status\x20Text:','Redirect\x20URL:','Unknown\x20error','HTTP\x20Status:','\x20(GB\x20-\x20Britain)','merchant_reference_id','/v1/hosted/payment_links/','processWebhook','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','apiUrl','Business\x20Error\x20(','3uDvctQ','headers','payment_method_data','Error\x20stack:','failure_message','Status:','Payment\x20Link\x20ID:','none','URL:','PENDING','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','type','logWhiteDomainError','__esModule','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','https://tesoft.uk/gateway/fail.php?id=','paid','SUCCESS','\x20(always\x20GB\x20for\x20Rapyd)','Error\x20message:','üá¨üáß\x20Country:\x20','ERR','gb_visa_card','2065160xtgxMs'];a42_0x81ac=function(){return _0x24ff4a;};return a42_0x81ac();}exports[a42_0x561e52(0x1da)]=RapydService;