'use strict';const a45_0x4fd6c0=a45_0x3459;function a45_0x3459(_0x23d57f,_0x405aa1){const _0x2d987d=a45_0x2d98();return a45_0x3459=function(_0x34595c,_0xdd24a8){_0x34595c=_0x34595c-0x77;let _0x16636f=_0x2d987d[_0x34595c];return _0x16636f;},a45_0x3459(_0x23d57f,_0x405aa1);}(function(_0x1de655,_0x31e2e1){const _0x508a62=a45_0x3459,_0x4addcf=_0x1de655();while(!![]){try{const _0x287afa=parseInt(_0x508a62(0xb7))/0x1*(-parseInt(_0x508a62(0x8e))/0x2)+-parseInt(_0x508a62(0xa1))/0x3*(-parseInt(_0x508a62(0xaf))/0x4)+parseInt(_0x508a62(0xbe))/0x5+-parseInt(_0x508a62(0xc5))/0x6+parseInt(_0x508a62(0xe4))/0x7+-parseInt(_0x508a62(0xb9))/0x8*(parseInt(_0x508a62(0xd6))/0x9)+-parseInt(_0x508a62(0xad))/0xa*(-parseInt(_0x508a62(0xe3))/0xb);if(_0x287afa===_0x31e2e1)break;else _0x4addcf['push'](_0x4addcf['shift']());}catch(_0x56c1fc){_0x4addcf['push'](_0x4addcf['shift']());}}}(a45_0x2d98,0xc7f1f));Object['defineProperty'](exports,a45_0x4fd6c0(0xaa),{'value':!![]}),exports['RapydService']=void 0x0;function a45_0x2d98(){const _0x30a82a=['redirect_url','PENDING','1598531qrlAct','839167TzyaxG','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Rapyd\x20payment\x20verification\x20error:','POST','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','EXPIRED','CAN','EXP','PAYMENT_FAILED','failure_message','RapydService','TesSoft\x20Payment\x20System/1.0','SUCCESS','Redirect\x20URL:','Error\x20Message:','statusText','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Code:','errorCode','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','https://tesoft.uk/gateway/rapyd/','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Headers:','failure_code','../loggerService','Raw\x20Response\x20Body:','log','none','logWhiteDomainResponse','1208062BKtGLT','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','):\x20','Parsed\x20Result:','HTTP\x20','amount','Status\x20Text:','text',',\x20failureMessage=','Full\x20Error\x20Data:','apiUrl','paymentMethod','error','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','ACT','logWhiteDomainRequest','headers','ORDER:\x20','Response\x20Body:','256107TKwLBi','UNKNOWN','GET','üá¨üáß\x20Country:\x20','parse','Error\x20details:','PAYMENT_COMPLETED','üá¨üáß\x20Country\x20used:\x20',',\x20body:\x20','__esModule','FAILED','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','30iCfHos','üí•\x20Rapyd\x20failure\x20message:\x20','52RiZjaG','type','last4','Rapyd\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','PAID','Unknown\x20error','status','1UFHLpT','/v1/hosted/payment_links','40IFnqWQ','loggerService','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','URL:','verifyPayment','3199975VKJXjU','===\x20RAPYD\x20API\x20ERROR\x20===','/v1/hosted/payment_links/','application/json','===\x20RAPYD\x20SUCCESS\x20===','Request\x20Body\x20(Updated\x20Format):','logWhiteDomainError','1726680miXRBp','error_code','PAYMENT_EXPIRED','Unknown\x20error\x20from\x20Rapyd\x20API','CLO','Processing\x20Rapyd\x20webhook:','ERR','message','toUpperCase','\x20(GB\x20-\x20Britain)','currency','data','Response\x20Time:','now','PAYMENT_CANCELED','gb_visa_card','rapyd','1070730haEfXZ','Error\x20stack:','fromEntries','Response\x20data:','stack','HTTP\x20Status:','createPaymentLink','Business\x20Error\x20(','payment_method_data','stringify','===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='];a45_0x2d98=function(){return _0x30a82a;};return a45_0x2d98();}const loggerService_1=require(a45_0x4fd6c0(0x89));class RapydService{constructor(){const _0x4b50c3=a45_0x4fd6c0;this[_0x4b50c3(0x98)]=_0x4b50c3(0x85),console[_0x4b50c3(0x8b)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a45_0x4fd6c0(0xdc)](_0x43ca16){const _0x58b74a=a45_0x4fd6c0,{orderId:_0x12d8a2,orderName:_0x29d21b,amount:_0x39a641,currency:_0x2a23d9,usage:_0x683d3b,maxPayments:_0x47314c,successUrl:_0x40d2cd,failUrl:_0x280631}=_0x43ca16,_0x4fd8cb=_0x2a23d9[_0x58b74a(0xcd)](),_0x884f34='GB';console[_0x58b74a(0x8b)](_0x58b74a(0x8f));const _0x5ed9cd='https://tesoft.uk/gateway/success.php?id='+_0x12d8a2,_0x1134c2='https://tesoft.uk/gateway/fail.php?id='+_0x12d8a2,_0x3b801d={'amount':_0x39a641,'currency':_0x4fd8cb,'cancel_checkout_url':_0x1134c2,'complete_checkout_url':_0x5ed9cd,'complete_payment_url':_0x5ed9cd,'merchant_reference_id':_0x12d8a2,'description':_0x58b74a(0x9f)+_0x12d8a2,'country':'GB','payment_method_types_include':[_0x58b74a(0xd4),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x51bccf=Date[_0x58b74a(0xd2)]();try{console[_0x58b74a(0x8b)](_0x58b74a(0x82)),console[_0x58b74a(0x8b)](_0x58b74a(0xbc),this['apiUrl']),console[_0x58b74a(0x8b)](_0x58b74a(0xc3),JSON[_0x58b74a(0xdf)](_0x3b801d,null,0x2)),console[_0x58b74a(0x8b)](_0x58b74a(0xa4)+_0x884f34+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x58b74a(0x8b)](_0x58b74a(0xac)),loggerService_1[_0x58b74a(0xba)][_0x58b74a(0x9d)]('rapyd','/v1/hosted/payment_links',_0x58b74a(0xe7),_0x3b801d);const _0x579b71=await fetch(this['apiUrl'],{'method':_0x58b74a(0xe7),'headers':{'Content-Type':'application/json','User-Agent':_0x58b74a(0x7a)},'body':JSON[_0x58b74a(0xdf)](_0x3b801d)}),_0x1ac2a6=Date[_0x58b74a(0xd2)]()-_0x51bccf;console[_0x58b74a(0x8b)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x58b74a(0x8b)]('Status:',_0x579b71[_0x58b74a(0xb6)]),console['log'](_0x58b74a(0x94),_0x579b71[_0x58b74a(0x7e)]),console[_0x58b74a(0x8b)](_0x58b74a(0x87),Object[_0x58b74a(0xd8)](_0x579b71[_0x58b74a(0x9e)]['entries']())),console[_0x58b74a(0x8b)](_0x58b74a(0xd1),_0x1ac2a6+'ms');const _0x546905=await _0x579b71['text']();console[_0x58b74a(0x8b)](_0x58b74a(0x8a),_0x546905);if(!_0x579b71['ok']){console[_0x58b74a(0x9a)](_0x58b74a(0xbf)),console['error'](_0x58b74a(0xdb),_0x579b71[_0x58b74a(0xb6)]),console[_0x58b74a(0x9a)](_0x58b74a(0xa0),_0x546905),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x58b74a(0xd5),'/v1/hosted/payment_links',_0x579b71['status'],_0x546905,_0x1ac2a6),loggerService_1[_0x58b74a(0xba)]['logWhiteDomainError'](_0x58b74a(0xd5),'/v1/hosted/payment_links',_0x58b74a(0x92)+_0x579b71['status']+':\x20'+_0x546905);throw new Error('HTTP\x20error!\x20status:\x20'+_0x579b71[_0x58b74a(0xb6)]+_0x58b74a(0xa9)+_0x546905);}let _0x2daab7;try{_0x2daab7=JSON[_0x58b74a(0xa5)](_0x546905);}catch(_0x325d7d){console[_0x58b74a(0x9a)](_0x58b74a(0xb3),_0x325d7d),loggerService_1[_0x58b74a(0xba)]['logWhiteDomainError'](_0x58b74a(0xd5),_0x58b74a(0xb8),'JSON\x20Parse\x20Error:\x20'+_0x325d7d);throw new Error(_0x58b74a(0xe8)+_0x546905);}console['log'](_0x58b74a(0xe0)),console[_0x58b74a(0x8b)](_0x58b74a(0x91),JSON[_0x58b74a(0xdf)](_0x2daab7,null,0x2)),loggerService_1[_0x58b74a(0xba)][_0x58b74a(0x8d)]('rapyd',_0x58b74a(0xb8),_0x579b71[_0x58b74a(0xb6)],_0x2daab7,_0x1ac2a6);if(_0x2daab7[_0x58b74a(0xb6)]?.[_0x58b74a(0xb6)]!==_0x58b74a(0x7b)){const _0x9d2d34=_0x2daab7[_0x58b74a(0xb6)]?.[_0x58b74a(0xcc)]||_0x58b74a(0xc8),_0x510bfa=_0x2daab7[_0x58b74a(0xb6)]?.[_0x58b74a(0xc6)]||_0x58b74a(0xa2);console[_0x58b74a(0x9a)](_0x58b74a(0x83)),console[_0x58b74a(0x9a)](_0x58b74a(0x80),_0x510bfa),console['error'](_0x58b74a(0x7d),_0x9d2d34),console['error'](_0x58b74a(0x97),_0x2daab7[_0x58b74a(0xb6)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x58b74a(0xd5),'/v1/hosted/payment_links',_0x58b74a(0xdd)+_0x510bfa+_0x58b74a(0x90)+_0x9d2d34);throw new Error('Rapyd\x20API\x20error\x20('+_0x510bfa+_0x58b74a(0x90)+_0x9d2d34);}if(!_0x2daab7['data']?.['id']||!_0x2daab7['data']?.[_0x58b74a(0xe1)]){console[_0x58b74a(0x9a)](_0x58b74a(0x7f)),console[_0x58b74a(0x9a)](_0x58b74a(0x86)),console[_0x58b74a(0x9a)](_0x58b74a(0xd9),_0x2daab7[_0x58b74a(0xd0)]),loggerService_1[_0x58b74a(0xba)][_0x58b74a(0xc4)](_0x58b74a(0xd5),'/v1/hosted/payment_links','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x58b74a(0x8b)](_0x58b74a(0xc2)),console['log']('Payment\x20Link\x20ID:',_0x2daab7[_0x58b74a(0xd0)]['id']),console[_0x58b74a(0x8b)](_0x58b74a(0x7c),_0x2daab7[_0x58b74a(0xd0)][_0x58b74a(0xe1)]),console['log'](_0x58b74a(0xa8)+_0x884f34+_0x58b74a(0xce)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x2daab7['data']['id'],'payment_url':_0x2daab7[_0x58b74a(0xd0)][_0x58b74a(0xe1)]};}catch(_0x1db0d9){console[_0x58b74a(0x9a)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console['error'](_0x58b74a(0xa6),_0x1db0d9),loggerService_1[_0x58b74a(0xba)][_0x58b74a(0xc4)](_0x58b74a(0xd5),_0x58b74a(0xb8),_0x1db0d9);if(_0x1db0d9 instanceof Error){console[_0x58b74a(0x9a)]('Error\x20message:',_0x1db0d9[_0x58b74a(0xcc)]),console[_0x58b74a(0x9a)](_0x58b74a(0xd7),_0x1db0d9[_0x58b74a(0xda)]);throw new Error(_0x58b74a(0xe5)+_0x1db0d9[_0x58b74a(0xcc)]);}throw new Error(_0x58b74a(0xbb));}}async[a45_0x4fd6c0(0xbd)](_0x1ed8a1){const _0x2dcded=a45_0x4fd6c0,_0x324327=Date[_0x2dcded(0xd2)]();try{loggerService_1[_0x2dcded(0xba)][_0x2dcded(0x9d)](_0x2dcded(0xd5),'/v1/hosted/payment_links/'+_0x1ed8a1,_0x2dcded(0xa3),{});const _0x56a823=await fetch(this[_0x2dcded(0x98)]+'/'+_0x1ed8a1,{'method':_0x2dcded(0xa3),'headers':{'Content-Type':_0x2dcded(0xc1),'User-Agent':_0x2dcded(0x7a)}}),_0x31866b=Date[_0x2dcded(0xd2)]()-_0x324327;if(!_0x56a823['ok']){const _0x6c2966=await _0x56a823[_0x2dcded(0x95)]();loggerService_1[_0x2dcded(0xba)][_0x2dcded(0x8d)](_0x2dcded(0xd5),_0x2dcded(0xc0)+_0x1ed8a1,_0x56a823[_0x2dcded(0xb6)],_0x6c2966,_0x31866b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x56a823['status']);}const _0x320c39=await _0x56a823['json']();loggerService_1[_0x2dcded(0xba)][_0x2dcded(0x8d)](_0x2dcded(0xd5),'/v1/hosted/payment_links/'+_0x1ed8a1,_0x56a823['status'],_0x320c39,_0x31866b);if(_0x320c39[_0x2dcded(0xb6)]?.['status']!==_0x2dcded(0x7b)){loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x2dcded(0xc0)+_0x1ed8a1,_0x2dcded(0xb2)+(_0x320c39['status']?.[_0x2dcded(0xcc)]||_0x2dcded(0xb5)));throw new Error(_0x2dcded(0xb2)+(_0x320c39[_0x2dcded(0xb6)]?.[_0x2dcded(0xcc)]||'Unknown\x20error'));}let _0x4cde99=_0x2dcded(0xe2);if(_0x320c39['data']?.[_0x2dcded(0xb6)])switch(_0x320c39['data'][_0x2dcded(0xb6)][_0x2dcded(0xcd)]()){case'CLO':_0x4cde99=_0x2dcded(0xb4);break;case _0x2dcded(0xea):_0x4cde99='FAILED';break;case _0x2dcded(0xeb):_0x4cde99=_0x2dcded(0xe9);break;case'ERR':_0x4cde99=_0x2dcded(0xab);break;case'NEW':case _0x2dcded(0x9c):default:_0x4cde99=_0x2dcded(0xe2);break;}return{'status':_0x4cde99,'amount':_0x320c39['data']?.[_0x2dcded(0x93)],'currency':_0x320c39['data']?.[_0x2dcded(0xcf)]};}catch(_0x4aacf2){console['error'](_0x2dcded(0xe6),_0x4aacf2),loggerService_1[_0x2dcded(0xba)][_0x2dcded(0xc4)](_0x2dcded(0xd5),_0x2dcded(0xc0)+_0x1ed8a1,_0x4aacf2);throw new Error(_0x2dcded(0x84)+(_0x4aacf2 instanceof Error?_0x4aacf2['message']:_0x2dcded(0xb5)));}}async['processWebhook'](_0x14d4a5){const _0x141789=a45_0x4fd6c0;console[_0x141789(0x8b)](_0x141789(0xca),_0x14d4a5);let _0x58d44c=_0x141789(0xe2),_0x54c63d;_0x14d4a5['data']?.['failure_message']&&(_0x54c63d=_0x14d4a5[_0x141789(0xd0)][_0x141789(0x78)],console[_0x141789(0x8b)](_0x141789(0xae)+_0x54c63d));switch(_0x14d4a5[_0x141789(0xb0)]?.[_0x141789(0xcd)]()){case _0x141789(0xa7):_0x14d4a5['data']?.['paid']===!![]&&_0x14d4a5[_0x141789(0xd0)]?.[_0x141789(0xb6)]==='CLO'?_0x58d44c=_0x141789(0xb4):_0x58d44c=_0x141789(0xe2);break;case _0x141789(0xd3):_0x58d44c=_0x141789(0xab);break;case _0x141789(0xc7):_0x58d44c='EXPIRED';break;case _0x141789(0x77):_0x58d44c=_0x141789(0xab);!_0x54c63d&&_0x14d4a5[_0x141789(0xd0)]?.[_0x141789(0x78)]&&(_0x54c63d=_0x14d4a5[_0x141789(0xd0)][_0x141789(0x78)]);break;default:switch(_0x14d4a5['data']?.[_0x141789(0xb6)]?.[_0x141789(0xcd)]()){case _0x141789(0xc9):_0x14d4a5[_0x141789(0xd0)]?.['paid']===!![]?_0x58d44c=_0x141789(0xb4):_0x58d44c=_0x141789(0xab);break;case _0x141789(0xea):_0x58d44c=_0x141789(0xab);break;case _0x141789(0xeb):_0x58d44c=_0x141789(0xe9);break;case _0x141789(0xcb):_0x58d44c=_0x141789(0xab);!_0x54c63d&&_0x14d4a5[_0x141789(0xd0)]?.[_0x141789(0x78)]&&(_0x54c63d=_0x14d4a5[_0x141789(0xd0)]['failure_message']);break;case'NEW':case _0x141789(0x9c):default:_0x58d44c=_0x141789(0xe2);break;}break;}const _0x153bd8={};return _0x14d4a5[_0x141789(0xd0)]?.[_0x141789(0xde)]?.['last4']&&(_0x153bd8['cardLast4']=_0x14d4a5[_0x141789(0xd0)]['payment_method_data'][_0x141789(0xb1)]),_0x14d4a5['data']?.['payment_method_type']&&(_0x153bd8[_0x141789(0x99)]=_0x14d4a5['data']['payment_method_type']),_0x14d4a5['data']?.[_0x141789(0xc6)]&&(_0x153bd8[_0x141789(0x81)]=_0x14d4a5[_0x141789(0xd0)][_0x141789(0xc6)]),_0x14d4a5[_0x141789(0xd0)]?.[_0x141789(0x88)]&&(_0x153bd8['failureCode']=_0x14d4a5[_0x141789(0xd0)][_0x141789(0x88)]),console['log'](_0x141789(0x9b)+_0x58d44c+_0x141789(0x96)+(_0x54c63d||_0x141789(0x8c))),{'paymentId':_0x14d4a5[_0x141789(0xd0)]?.['merchant_reference_id']||'','status':_0x58d44c,'amount':_0x14d4a5[_0x141789(0xd0)]?.['amount'],'currency':_0x14d4a5[_0x141789(0xd0)]?.['currency'],'failureMessage':_0x54c63d,'additionalInfo':_0x153bd8};}}exports[a45_0x4fd6c0(0x79)]=RapydService;