'use strict';const a45_0x529e27=a45_0xd913;(function(_0x32e77f,_0x1aa554){const _0x2d7992=a45_0xd913,_0x97b4ae=_0x32e77f();while(!![]){try{const _0x523835=-parseInt(_0x2d7992(0xd2))/0x1*(-parseInt(_0x2d7992(0x76))/0x2)+parseInt(_0x2d7992(0xd9))/0x3*(-parseInt(_0x2d7992(0x6f))/0x4)+-parseInt(_0x2d7992(0xdf))/0x5*(-parseInt(_0x2d7992(0x7e))/0x6)+parseInt(_0x2d7992(0x7d))/0x7*(-parseInt(_0x2d7992(0xda))/0x8)+-parseInt(_0x2d7992(0xc2))/0x9*(-parseInt(_0x2d7992(0xd0))/0xa)+-parseInt(_0x2d7992(0xd7))/0xb+parseInt(_0x2d7992(0xb2))/0xc;if(_0x523835===_0x1aa554)break;else _0x97b4ae['push'](_0x97b4ae['shift']());}catch(_0xd033e8){_0x97b4ae['push'](_0x97b4ae['shift']());}}}(a45_0x4b37,0xac943));Object[a45_0x529e27(0xe1)](exports,a45_0x529e27(0x7b),{'value':!![]}),exports[a45_0x529e27(0x87)]=void 0x0;function a45_0xd913(_0x83d20,_0x4545b1){const _0x4b3798=a45_0x4b37();return a45_0xd913=function(_0xd913e7,_0x403ed2){_0xd913e7=_0xd913e7-0x6e;let _0x21d0ce=_0x4b3798[_0xd913e7];return _0x21d0ce;},a45_0xd913(_0x83d20,_0x4545b1);}function a45_0x4b37(){const _0x3bf8c1=['Parsed\x20Result:','):\x20','cardLast4','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','HTTP\x20','SUCCESS','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','FAILED','RapydService','logWhiteDomainError','URL:','HTTP\x20error!\x20status:\x20','failureCode','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','entries','GET','text','log','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','stringify','Raw\x20Response\x20Body:','\x20(always\x20GB\x20for\x20Rapyd)','gb_visa_card','PENDING','error','failure_message','logWhiteDomainResponse','application/json','/v1/hosted/payment_links','payment_method_type','fromEntries','Status\x20Text:','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Request\x20Body\x20(Updated\x20Format):','===\x20RAPYD\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/fail.php?id=','apiUrl','headers','parse','Error\x20message:','Status:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','data','amount','Error\x20Code:','last4','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','../loggerService','status','PAYMENT_CANCELED','14322672hCwydh','redirect_url','POST','Payment\x20Link\x20ID:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Headers:','Response\x20data:','Unknown\x20error\x20from\x20Rapyd\x20API','error_code','errorCode','ERR','logWhiteDomainRequest','currency','stack','Rapyd\x20payment\x20verification\x20error:','603bYAqrV','Business\x20Error\x20(',',\x20body:\x20','Response\x20Body:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','payment_method_data','PAYMENT_EXPIRED','Error\x20stack:','===\x20RAPYD\x20SUCCESS\x20===','Rapyd\x20API\x20error\x20(','EXPIRED','https://tesoft.uk/gateway/rapyd/','toUpperCase','createPaymentLink','24970roFMWr','CAN','197bsJhqQ','failure_code','üá¨üáß\x20Country:\x20','paid','now','11820930FeJwem','type','3160263kEHXFH','1254328AfUBuX','PAID','PAYMENT_FAILED','/v1/hosted/payment_links/','EXP','1030yKFEjB','üí•\x20Rapyd\x20failure\x20message:\x20','defineProperty','Error\x20Message:','loggerService','merchant_reference_id','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Rapyd\x20API\x20error:\x20','Response\x20Time:','json','ORDER:\x20','4zvdpNo','https://tesoft.uk/gateway/success.php?id=','message','statusText','Processing\x20Rapyd\x20webhook:','paymentMethod','Unknown\x20error','6502huPTKJ','verifyPayment','CLO','gb_mastercard_card','none','__esModule','rapyd','14npzrdP','33414zKkDDB'];a45_0x4b37=function(){return _0x3bf8c1;};return a45_0x4b37();}const loggerService_1=require(a45_0x529e27(0xaf));class RapydService{constructor(){const _0x110d28=a45_0x529e27;this[_0x110d28(0xa4)]=_0x110d28(0xcd),console[_0x110d28(0x90)](_0x110d28(0xb6));}async[a45_0x529e27(0xcf)](_0x30694a){const _0x5cc60c=a45_0x529e27,{orderId:_0x2093b1,orderName:_0x446645,amount:_0x56339b,currency:_0xa67b0d,usage:_0x40b3bb,maxPayments:_0x4d470c,successUrl:_0x5e4e81,failUrl:_0x1b28b1}=_0x30694a,_0x250f74=_0xa67b0d['toUpperCase'](),_0x11ff32='GB';console['log'](_0x5cc60c(0x8c));const _0xb08099=_0x5cc60c(0x70)+_0x2093b1,_0x2e87ed=_0x5cc60c(0xa3)+_0x2093b1,_0x33cc9b={'amount':_0x56339b,'currency':_0x250f74,'cancel_checkout_url':_0x2e87ed,'complete_checkout_url':_0xb08099,'complete_payment_url':_0xb08099,'merchant_reference_id':_0x2093b1,'description':_0x5cc60c(0x6e)+_0x2093b1,'country':'GB','payment_method_types_include':[_0x5cc60c(0x96),_0x5cc60c(0x79)],'custom_elements':{'display_description':!![]}},_0x5116e1=Date[_0x5cc60c(0xd6)]();try{console[_0x5cc60c(0x90)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x5cc60c(0x90)](_0x5cc60c(0x89),this[_0x5cc60c(0xa4)]),console['log'](_0x5cc60c(0xa1),JSON[_0x5cc60c(0x93)](_0x33cc9b,null,0x2)),console[_0x5cc60c(0x90)](_0x5cc60c(0xd4)+_0x11ff32+_0x5cc60c(0x95)),console[_0x5cc60c(0x90)](_0x5cc60c(0xe8)),loggerService_1[_0x5cc60c(0xe3)][_0x5cc60c(0xbe)](_0x5cc60c(0x7c),'/v1/hosted/payment_links',_0x5cc60c(0xb4),_0x33cc9b);const _0x4d9c8d=await fetch(this[_0x5cc60c(0xa4)],{'method':'POST','headers':{'Content-Type':_0x5cc60c(0x9b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x33cc9b)}),_0xbc3633=Date[_0x5cc60c(0xd6)]()-_0x5116e1;console['log'](_0x5cc60c(0xae)),console['log'](_0x5cc60c(0xa8),_0x4d9c8d[_0x5cc60c(0xb0)]),console[_0x5cc60c(0x90)](_0x5cc60c(0x9f),_0x4d9c8d[_0x5cc60c(0x72)]),console[_0x5cc60c(0x90)](_0x5cc60c(0xb8),Object[_0x5cc60c(0x9e)](_0x4d9c8d[_0x5cc60c(0xa5)][_0x5cc60c(0x8d)]())),console[_0x5cc60c(0x90)](_0x5cc60c(0xea),_0xbc3633+'ms');const _0x452485=await _0x4d9c8d[_0x5cc60c(0x8f)]();console['log'](_0x5cc60c(0x94),_0x452485);if(!_0x4d9c8d['ok']){console[_0x5cc60c(0x98)](_0x5cc60c(0xa2)),console[_0x5cc60c(0x98)]('HTTP\x20Status:',_0x4d9c8d[_0x5cc60c(0xb0)]),console[_0x5cc60c(0x98)](_0x5cc60c(0xc5),_0x452485),loggerService_1[_0x5cc60c(0xe3)][_0x5cc60c(0x9a)](_0x5cc60c(0x7c),_0x5cc60c(0x9c),_0x4d9c8d[_0x5cc60c(0xb0)],_0x452485,_0xbc3633),loggerService_1[_0x5cc60c(0xe3)][_0x5cc60c(0x88)](_0x5cc60c(0x7c),_0x5cc60c(0x9c),_0x5cc60c(0x83)+_0x4d9c8d[_0x5cc60c(0xb0)]+':\x20'+_0x452485);throw new Error(_0x5cc60c(0x8a)+_0x4d9c8d[_0x5cc60c(0xb0)]+_0x5cc60c(0xc4)+_0x452485);}let _0x3f4f25;try{_0x3f4f25=JSON[_0x5cc60c(0xa6)](_0x452485);}catch(_0x579405){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x579405),loggerService_1[_0x5cc60c(0xe3)][_0x5cc60c(0x88)](_0x5cc60c(0x7c),_0x5cc60c(0x9c),'JSON\x20Parse\x20Error:\x20'+_0x579405);throw new Error(_0x5cc60c(0x82)+_0x452485);}console[_0x5cc60c(0x90)](_0x5cc60c(0x92)),console[_0x5cc60c(0x90)](_0x5cc60c(0x7f),JSON[_0x5cc60c(0x93)](_0x3f4f25,null,0x2)),loggerService_1[_0x5cc60c(0xe3)]['logWhiteDomainResponse'](_0x5cc60c(0x7c),'/v1/hosted/payment_links',_0x4d9c8d[_0x5cc60c(0xb0)],_0x3f4f25,_0xbc3633);if(_0x3f4f25[_0x5cc60c(0xb0)]?.[_0x5cc60c(0xb0)]!==_0x5cc60c(0x84)){const _0x5ebc91=_0x3f4f25[_0x5cc60c(0xb0)]?.[_0x5cc60c(0x71)]||_0x5cc60c(0xba),_0x2e2cbd=_0x3f4f25[_0x5cc60c(0xb0)]?.[_0x5cc60c(0xbb)]||'UNKNOWN';console[_0x5cc60c(0x98)](_0x5cc60c(0x85)),console[_0x5cc60c(0x98)](_0x5cc60c(0xac),_0x2e2cbd),console[_0x5cc60c(0x98)](_0x5cc60c(0xe2),_0x5ebc91),console['error']('Full\x20Error\x20Data:',_0x3f4f25['status']),loggerService_1['loggerService']['logWhiteDomainError'](_0x5cc60c(0x7c),'/v1/hosted/payment_links',_0x5cc60c(0xc3)+_0x2e2cbd+'):\x20'+_0x5ebc91);throw new Error(_0x5cc60c(0xcb)+_0x2e2cbd+_0x5cc60c(0x80)+_0x5ebc91);}if(!_0x3f4f25[_0x5cc60c(0xaa)]?.['id']||!_0x3f4f25[_0x5cc60c(0xaa)]?.[_0x5cc60c(0xb3)]){console[_0x5cc60c(0x98)](_0x5cc60c(0xb7)),console['error'](_0x5cc60c(0xa0)),console[_0x5cc60c(0x98)](_0x5cc60c(0xb9),_0x3f4f25[_0x5cc60c(0xaa)]),loggerService_1['loggerService'][_0x5cc60c(0x88)]('rapyd',_0x5cc60c(0x9c),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x5cc60c(0xe5));}return console[_0x5cc60c(0x90)](_0x5cc60c(0xca)),console[_0x5cc60c(0x90)](_0x5cc60c(0xb5),_0x3f4f25['data']['id']),console['log']('Redirect\x20URL:',_0x3f4f25[_0x5cc60c(0xaa)]['redirect_url']),console['log']('üá¨üáß\x20Country\x20used:\x20'+_0x11ff32+'\x20(GB\x20-\x20Britain)'),console['log'](_0x5cc60c(0xe8)),{'gateway_payment_id':_0x3f4f25[_0x5cc60c(0xaa)]['id'],'payment_url':_0x3f4f25[_0x5cc60c(0xaa)]['redirect_url']};}catch(_0x3fa2de){console[_0x5cc60c(0x98)](_0x5cc60c(0xa9)),console[_0x5cc60c(0x98)]('Error\x20details:',_0x3fa2de),loggerService_1[_0x5cc60c(0xe3)][_0x5cc60c(0x88)](_0x5cc60c(0x7c),_0x5cc60c(0x9c),_0x3fa2de);if(_0x3fa2de instanceof Error){console[_0x5cc60c(0x98)](_0x5cc60c(0xa7),_0x3fa2de[_0x5cc60c(0x71)]),console[_0x5cc60c(0x98)](_0x5cc60c(0xc9),_0x3fa2de[_0x5cc60c(0xc0)]);throw new Error(_0x5cc60c(0xe7)+_0x3fa2de['message']);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x529e27(0x77)](_0x2d58fa){const _0x527d45=a45_0x529e27,_0x5898ed=Date[_0x527d45(0xd6)]();try{loggerService_1['loggerService'][_0x527d45(0xbe)]('rapyd',_0x527d45(0xdd)+_0x2d58fa,_0x527d45(0x8e),{});const _0x3c17dc=await fetch(this['apiUrl']+'/'+_0x2d58fa,{'method':'GET','headers':{'Content-Type':_0x527d45(0x9b),'User-Agent':_0x527d45(0xe6)}}),_0x575709=Date[_0x527d45(0xd6)]()-_0x5898ed;if(!_0x3c17dc['ok']){const _0x29439b=await _0x3c17dc[_0x527d45(0x8f)]();loggerService_1[_0x527d45(0xe3)]['logWhiteDomainResponse']('rapyd',_0x527d45(0xdd)+_0x2d58fa,_0x3c17dc['status'],_0x29439b,_0x575709);throw new Error(_0x527d45(0x8a)+_0x3c17dc[_0x527d45(0xb0)]);}const _0x1379e9=await _0x3c17dc[_0x527d45(0xeb)]();loggerService_1['loggerService'][_0x527d45(0x9a)]('rapyd','/v1/hosted/payment_links/'+_0x2d58fa,_0x3c17dc[_0x527d45(0xb0)],_0x1379e9,_0x575709);if(_0x1379e9[_0x527d45(0xb0)]?.[_0x527d45(0xb0)]!==_0x527d45(0x84)){loggerService_1[_0x527d45(0xe3)][_0x527d45(0x88)](_0x527d45(0x7c),'/v1/hosted/payment_links/'+_0x2d58fa,_0x527d45(0xe9)+(_0x1379e9['status']?.[_0x527d45(0x71)]||_0x527d45(0x75)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x1379e9[_0x527d45(0xb0)]?.[_0x527d45(0x71)]||_0x527d45(0x75)));}let _0x392871=_0x527d45(0x97);if(_0x1379e9[_0x527d45(0xaa)]?.['status'])switch(_0x1379e9[_0x527d45(0xaa)][_0x527d45(0xb0)][_0x527d45(0xce)]()){case _0x527d45(0x78):_0x392871=_0x527d45(0xdb);break;case _0x527d45(0xd1):_0x392871=_0x527d45(0x86);break;case _0x527d45(0xde):_0x392871=_0x527d45(0xcc);break;case _0x527d45(0xbd):_0x392871=_0x527d45(0x86);break;case'NEW':case'ACT':default:_0x392871='PENDING';break;}return{'status':_0x392871,'amount':_0x1379e9['data']?.['amount'],'currency':_0x1379e9[_0x527d45(0xaa)]?.[_0x527d45(0xbf)]};}catch(_0x1c7eaf){console[_0x527d45(0x98)](_0x527d45(0xc1),_0x1c7eaf),loggerService_1[_0x527d45(0xe3)][_0x527d45(0x88)](_0x527d45(0x7c),'/v1/hosted/payment_links/'+_0x2d58fa,_0x1c7eaf);throw new Error(_0x527d45(0xc6)+(_0x1c7eaf instanceof Error?_0x1c7eaf['message']:_0x527d45(0x75)));}}async['processWebhook'](_0x3c603a){const _0x332c41=a45_0x529e27;console['log'](_0x332c41(0x73),_0x3c603a);let _0x494417=_0x332c41(0x97),_0x9c604c;_0x3c603a[_0x332c41(0xaa)]?.['failure_message']&&(_0x9c604c=_0x3c603a['data'][_0x332c41(0x99)],console[_0x332c41(0x90)](_0x332c41(0xe0)+_0x9c604c));switch(_0x3c603a[_0x332c41(0xd8)]?.[_0x332c41(0xce)]()){case'PAYMENT_COMPLETED':_0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0xd5)]===!![]&&_0x3c603a['data']?.[_0x332c41(0xb0)]===_0x332c41(0x78)?_0x494417='PAID':_0x494417=_0x332c41(0x97);break;case _0x332c41(0xb1):_0x494417=_0x332c41(0x86);break;case _0x332c41(0xc8):_0x494417=_0x332c41(0xcc);break;case _0x332c41(0xdc):_0x494417=_0x332c41(0x86);!_0x9c604c&&_0x3c603a['data']?.[_0x332c41(0x99)]&&(_0x9c604c=_0x3c603a[_0x332c41(0xaa)]['failure_message']);break;default:switch(_0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0xb0)]?.[_0x332c41(0xce)]()){case _0x332c41(0x78):_0x3c603a[_0x332c41(0xaa)]?.['paid']===!![]?_0x494417=_0x332c41(0xdb):_0x494417=_0x332c41(0x86);break;case _0x332c41(0xd1):_0x494417=_0x332c41(0x86);break;case _0x332c41(0xde):_0x494417=_0x332c41(0xcc);break;case'ERR':_0x494417=_0x332c41(0x86);!_0x9c604c&&_0x3c603a[_0x332c41(0xaa)]?.['failure_message']&&(_0x9c604c=_0x3c603a[_0x332c41(0xaa)][_0x332c41(0x99)]);break;case'NEW':case'ACT':default:_0x494417=_0x332c41(0x97);break;}break;}const _0xed8f32={};return _0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0xc7)]?.[_0x332c41(0xad)]&&(_0xed8f32[_0x332c41(0x81)]=_0x3c603a[_0x332c41(0xaa)]['payment_method_data'][_0x332c41(0xad)]),_0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0x9d)]&&(_0xed8f32[_0x332c41(0x74)]=_0x3c603a[_0x332c41(0xaa)][_0x332c41(0x9d)]),_0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0xbb)]&&(_0xed8f32[_0x332c41(0xbc)]=_0x3c603a[_0x332c41(0xaa)][_0x332c41(0xbb)]),_0x3c603a['data']?.['failure_code']&&(_0xed8f32[_0x332c41(0x8b)]=_0x3c603a['data'][_0x332c41(0xd3)]),console[_0x332c41(0x90)](_0x332c41(0x91)+_0x494417+',\x20failureMessage='+(_0x9c604c||_0x332c41(0x7a))),{'paymentId':_0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0xe4)]||'','status':_0x494417,'amount':_0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0xab)],'currency':_0x3c603a[_0x332c41(0xaa)]?.[_0x332c41(0xbf)],'failureMessage':_0x9c604c,'additionalInfo':_0xed8f32};}}exports[a45_0x529e27(0x87)]=RapydService;