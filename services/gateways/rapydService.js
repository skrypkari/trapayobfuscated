'use strict';const a48_0x3f3758=a48_0x4a40;(function(_0x2a8ac2,_0x4b02d9){const _0x52aa0d=a48_0x4a40,_0xca4e8c=_0x2a8ac2();while(!![]){try{const _0x5e7c7d=parseInt(_0x52aa0d(0xca))/0x1+-parseInt(_0x52aa0d(0xd2))/0x2+-parseInt(_0x52aa0d(0x107))/0x3+-parseInt(_0x52aa0d(0xc3))/0x4+parseInt(_0x52aa0d(0xec))/0x5*(-parseInt(_0x52aa0d(0x10b))/0x6)+-parseInt(_0x52aa0d(0x129))/0x7+parseInt(_0x52aa0d(0x120))/0x8*(parseInt(_0x52aa0d(0x12d))/0x9);if(_0x5e7c7d===_0x4b02d9)break;else _0xca4e8c['push'](_0xca4e8c['shift']());}catch(_0x20e11f){_0xca4e8c['push'](_0xca4e8c['shift']());}}}(a48_0x3ebe,0x64d45));Object[a48_0x3f3758(0xf1)](exports,a48_0x3f3758(0xde),{'value':!![]}),exports[a48_0x3f3758(0x131)]=void 0x0;function a48_0x4a40(_0x1b55c2,_0x3c8191){const _0x3ebecf=a48_0x3ebe();return a48_0x4a40=function(_0x4a405f,_0x4c61da){_0x4a405f=_0x4a405f-0xbe;let _0x2d93c=_0x3ebecf[_0x4a405f];return _0x2d93c;},a48_0x4a40(_0x1b55c2,_0x3c8191);}const loggerService_1=require('../loggerService');function a48_0x3ebe(){const _0x367704=['Redirect\x20URL:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','673422pMMzoO','merchant_reference_id','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','paid','227274rUHKYC','SUCCESS','Payment\x20Link\x20ID:','log','logWhiteDomainResponse','fixed_side','\x20\x20\x20expiration:\x20','paymentMethod','Processing\x20Rapyd\x20webhook:','Missing\x20id\x20or\x20redirect_url\x20in\x20response','requested_currency','🇬🇧\x20Country:\x20','Response\x20Body:','ACT','currency','gb_visa_card','PAID','===\x20RAPYD\x20SUCCESS\x20===','/v1/hosted/payment_links/','/v1/hosted/payment_links','https://tesoft.uk/gateway/fail.php?id=','378712FBPReE','Raw\x20Response\x20Body:','toUpperCase','logWhiteDomainError','PAYMENT_EXPIRED','EUR','ERR','errorCode','Parsed\x20Result:','3790696skBnKB','redirect_url','Unknown\x20error','\x20\x20\x20fixed_side:\x20buy','405vyflEh','Business\x20Error\x20(','error','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','RapydService','failureCode','floor','loggerService','\x20\x20\x20requested_currency:\x20EUR',',\x20failureMessage=','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','json','UNKNOWN','message','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PENDING','verifyPayment','failure_message','https://tesoft.uk/gateway/success.php?id=','stack','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','statusText','CAN','898760hxCQDC','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PAYMENT_FAILED','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20RAPYD\x20API\x20ERROR\x20===','type','Failed\x20to\x20parse\x20JSON\x20response:','303833qERXpU','gb_mastercard_card','logWhiteDomainRequest','):\x20','Status\x20Text:','apiUrl','expiration','HTTP\x20error!\x20status:\x20','772912AVzSwd','POST','Rapyd\x20payment\x20verification\x20error:','URL:','rapyd','\x20->\x20EUR:','cardLast4','PAYMENT_CANCELED','text','Error\x20message:','now','Rapyd\x20API\x20error\x20(','__esModule','EXPIRED','application/json','stringify','status','Status:','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','EXP','Unknown\x20error\x20from\x20Rapyd\x20API','payment_method_type','error_code','failure_code','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','85pfvHmj','CLO','TesSoft\x20Payment\x20System/1.0','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','💥\x20Rapyd\x20failure\x20message:\x20','defineProperty','Rapyd\x20API\x20error:\x20','buy','FAILED','\x20(GB\x20-\x20Britain)','data','amount','Headers:','Response\x20data:','entries','\x20(always\x20GB\x20for\x20Rapyd)','Full\x20Error\x20Data:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','payment_method_data','https://tesoft.uk/gateway/rapyd/','last4','toISOString','PAYMENT_COMPLETED','HTTP\x20Status:','Error\x20Message:'];a48_0x3ebe=function(){return _0x367704;};return a48_0x3ebe();}class RapydService{constructor(){const _0x42234c=a48_0x3f3758;this[_0x42234c(0xcf)]=_0x42234c(0xff),console[_0x42234c(0x10e)](_0x42234c(0x13b));}async['createPaymentLink'](_0xec3c17){const _0xd9e94e=a48_0x3f3758,{orderId:_0x44a05d,orderName:_0x1e469d,amount:_0x16bce0,currency:_0x480ce1,usage:_0x4472b7,maxPayments:_0x40eced,successUrl:_0x5ab312,failUrl:_0x374419}=_0xec3c17,_0x38211a=_0x480ce1[_0xd9e94e(0x122)](),_0x531e61='GB';console[_0xd9e94e(0x10e)](_0xd9e94e(0xef));const _0x4f310f=_0xd9e94e(0xbe)+_0x44a05d,_0x1dbd85=_0xd9e94e(0x11f)+_0x44a05d,_0x4dce04={'amount':_0x16bce0,'currency':_0x38211a,'cancel_checkout_url':_0x1dbd85,'complete_checkout_url':_0x4f310f,'complete_payment_url':_0x4f310f,'merchant_reference_id':_0x44a05d,'description':'ORDER:\x20'+_0x44a05d,'country':'GB','payment_method_types_include':[_0xd9e94e(0x11a),_0xd9e94e(0xcb)],'custom_elements':{'display_description':!![]}};if(_0x38211a!==_0xd9e94e(0x125)){const _0x479d21=Math[_0xd9e94e(0x133)](Date['now']()/0x3e8)+0x1e*0x3c;_0x4dce04[_0xd9e94e(0x110)]=_0xd9e94e(0xf3),_0x4dce04[_0xd9e94e(0x115)]=_0xd9e94e(0x125),_0x4dce04[_0xd9e94e(0xd0)]=_0x479d21,console['log'](_0xd9e94e(0xe5)+_0x38211a+_0xd9e94e(0xd7)),console[_0xd9e94e(0x10e)](_0xd9e94e(0x12c)),console[_0xd9e94e(0x10e)](_0xd9e94e(0x135)),console[_0xd9e94e(0x10e)](_0xd9e94e(0x111)+_0x479d21+'\x20('+new Date(_0x479d21*0x3e8)[_0xd9e94e(0x101)]()+')');}const _0x165884=Date[_0xd9e94e(0xdc)]();try{console[_0xd9e94e(0x10e)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0xd9e94e(0x10e)](_0xd9e94e(0xd5),this[_0xd9e94e(0xcf)]),console[_0xd9e94e(0x10e)]('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x4dce04,null,0x2)),console[_0xd9e94e(0x10e)](_0xd9e94e(0x116)+_0x531e61+_0xd9e94e(0xfb)),console[_0xd9e94e(0x10e)](_0xd9e94e(0x109)),loggerService_1[_0xd9e94e(0x134)]['logWhiteDomainRequest'](_0xd9e94e(0xd6),'/v1/hosted/payment_links',_0xd9e94e(0xd3),_0x4dce04);const _0x59d046=await fetch(this[_0xd9e94e(0xcf)],{'method':'POST','headers':{'Content-Type':_0xd9e94e(0xe0),'User-Agent':_0xd9e94e(0xee)},'body':JSON[_0xd9e94e(0xe1)](_0x4dce04)}),_0x143147=Date[_0xd9e94e(0xdc)]()-_0x165884;console[_0xd9e94e(0x10e)](_0xd9e94e(0xc4)),console[_0xd9e94e(0x10e)](_0xd9e94e(0xe3),_0x59d046[_0xd9e94e(0xe2)]),console[_0xd9e94e(0x10e)](_0xd9e94e(0xce),_0x59d046[_0xd9e94e(0xc1)]),console[_0xd9e94e(0x10e)](_0xd9e94e(0xf8),Object['fromEntries'](_0x59d046['headers'][_0xd9e94e(0xfa)]())),console['log']('Response\x20Time:',_0x143147+'ms');const _0x16e03b=await _0x59d046[_0xd9e94e(0xda)]();console['log'](_0xd9e94e(0x121),_0x16e03b);if(!_0x59d046['ok']){console[_0xd9e94e(0x12f)](_0xd9e94e(0xc7)),console[_0xd9e94e(0x12f)](_0xd9e94e(0x103),_0x59d046[_0xd9e94e(0xe2)]),console[_0xd9e94e(0x12f)](_0xd9e94e(0x117),_0x16e03b),loggerService_1['loggerService'][_0xd9e94e(0x10f)](_0xd9e94e(0xd6),_0xd9e94e(0x11e),_0x59d046[_0xd9e94e(0xe2)],_0x16e03b,_0x143147),loggerService_1['loggerService'][_0xd9e94e(0x123)](_0xd9e94e(0xd6),_0xd9e94e(0x11e),'HTTP\x20'+_0x59d046[_0xd9e94e(0xe2)]+':\x20'+_0x16e03b);throw new Error(_0xd9e94e(0xd1)+_0x59d046['status']+',\x20body:\x20'+_0x16e03b);}let _0x26ee1e;try{_0x26ee1e=JSON['parse'](_0x16e03b);}catch(_0x420d9e){console[_0xd9e94e(0x12f)](_0xd9e94e(0xc9),_0x420d9e),loggerService_1[_0xd9e94e(0x134)][_0xd9e94e(0x123)](_0xd9e94e(0xd6),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x420d9e);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x16e03b);}console[_0xd9e94e(0x10e)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console['log'](_0xd9e94e(0x128),JSON[_0xd9e94e(0xe1)](_0x26ee1e,null,0x2)),loggerService_1['loggerService'][_0xd9e94e(0x10f)](_0xd9e94e(0xd6),_0xd9e94e(0x11e),_0x59d046['status'],_0x26ee1e,_0x143147);if(_0x26ee1e[_0xd9e94e(0xe2)]?.[_0xd9e94e(0xe2)]!==_0xd9e94e(0x10c)){const _0x36a3e9=_0x26ee1e[_0xd9e94e(0xe2)]?.[_0xd9e94e(0x13a)]||_0xd9e94e(0xe7),_0x4a82a6=_0x26ee1e[_0xd9e94e(0xe2)]?.[_0xd9e94e(0xe9)]||_0xd9e94e(0x139);console[_0xd9e94e(0x12f)](_0xd9e94e(0xe4)),console[_0xd9e94e(0x12f)]('Error\x20Code:',_0x4a82a6),console[_0xd9e94e(0x12f)](_0xd9e94e(0x104),_0x36a3e9),console[_0xd9e94e(0x12f)](_0xd9e94e(0xfc),_0x26ee1e['status']),loggerService_1['loggerService'][_0xd9e94e(0x123)]('rapyd',_0xd9e94e(0x11e),_0xd9e94e(0x12e)+_0x4a82a6+'):\x20'+_0x36a3e9);throw new Error(_0xd9e94e(0xdd)+_0x4a82a6+_0xd9e94e(0xcd)+_0x36a3e9);}if(!_0x26ee1e['data']?.['id']||!_0x26ee1e[_0xd9e94e(0xf6)]?.[_0xd9e94e(0x12a)]){console[_0xd9e94e(0x12f)](_0xd9e94e(0xc6)),console[_0xd9e94e(0x12f)](_0xd9e94e(0x114)),console[_0xd9e94e(0x12f)](_0xd9e94e(0xf9),_0x26ee1e[_0xd9e94e(0xf6)]),loggerService_1[_0xd9e94e(0x134)][_0xd9e94e(0x123)]('rapyd',_0xd9e94e(0x11e),_0xd9e94e(0x130));throw new Error(_0xd9e94e(0x106));}return console[_0xd9e94e(0x10e)](_0xd9e94e(0x11c)),console[_0xd9e94e(0x10e)](_0xd9e94e(0x10d),_0x26ee1e[_0xd9e94e(0xf6)]['id']),console[_0xd9e94e(0x10e)](_0xd9e94e(0x105),_0x26ee1e[_0xd9e94e(0xf6)][_0xd9e94e(0x12a)]),console[_0xd9e94e(0x10e)]('🇬🇧\x20Country\x20used:\x20'+_0x531e61+_0xd9e94e(0xf5)),console[_0xd9e94e(0x10e)]('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x26ee1e['data']['id'],'payment_url':_0x26ee1e[_0xd9e94e(0xf6)]['redirect_url']};}catch(_0x16330e){console[_0xd9e94e(0x12f)](_0xd9e94e(0x137)),console[_0xd9e94e(0x12f)]('Error\x20details:',_0x16330e),loggerService_1[_0xd9e94e(0x134)]['logWhiteDomainError'](_0xd9e94e(0xd6),_0xd9e94e(0x11e),_0x16330e);if(_0x16330e instanceof Error){console[_0xd9e94e(0x12f)](_0xd9e94e(0xdb),_0x16330e['message']),console[_0xd9e94e(0x12f)]('Error\x20stack:',_0x16330e[_0xd9e94e(0xbf)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x16330e['message']);}throw new Error(_0xd9e94e(0xc0));}}async[a48_0x3f3758(0x13d)](_0x4feb66){const _0x2dd244=a48_0x3f3758,_0x1e30b4=Date[_0x2dd244(0xdc)]();try{loggerService_1[_0x2dd244(0x134)][_0x2dd244(0xcc)]('rapyd',_0x2dd244(0x11d)+_0x4feb66,'GET',{});const _0x4a7500=await fetch(this[_0x2dd244(0xcf)]+'/'+_0x4feb66,{'method':'GET','headers':{'Content-Type':_0x2dd244(0xe0),'User-Agent':_0x2dd244(0xee)}}),_0x535f2a=Date['now']()-_0x1e30b4;if(!_0x4a7500['ok']){const _0x31d3a0=await _0x4a7500[_0x2dd244(0xda)]();loggerService_1['loggerService'][_0x2dd244(0x10f)](_0x2dd244(0xd6),_0x2dd244(0x11d)+_0x4feb66,_0x4a7500[_0x2dd244(0xe2)],_0x31d3a0,_0x535f2a);throw new Error(_0x2dd244(0xd1)+_0x4a7500[_0x2dd244(0xe2)]);}const _0x5c7ee8=await _0x4a7500[_0x2dd244(0x138)]();loggerService_1[_0x2dd244(0x134)]['logWhiteDomainResponse'](_0x2dd244(0xd6),_0x2dd244(0x11d)+_0x4feb66,_0x4a7500[_0x2dd244(0xe2)],_0x5c7ee8,_0x535f2a);if(_0x5c7ee8[_0x2dd244(0xe2)]?.['status']!=='SUCCESS'){loggerService_1[_0x2dd244(0x134)][_0x2dd244(0x123)]('rapyd',_0x2dd244(0x11d)+_0x4feb66,_0x2dd244(0xf2)+(_0x5c7ee8[_0x2dd244(0xe2)]?.[_0x2dd244(0x13a)]||'Unknown\x20error'));throw new Error(_0x2dd244(0xf2)+(_0x5c7ee8['status']?.[_0x2dd244(0x13a)]||_0x2dd244(0x12b)));}let _0x4c5834=_0x2dd244(0x13c);if(_0x5c7ee8[_0x2dd244(0xf6)]?.[_0x2dd244(0xe2)])switch(_0x5c7ee8['data'][_0x2dd244(0xe2)]['toUpperCase']()){case _0x2dd244(0xed):_0x4c5834=_0x2dd244(0x11b);break;case _0x2dd244(0xc2):_0x4c5834=_0x2dd244(0xf4);break;case _0x2dd244(0xe6):_0x4c5834=_0x2dd244(0xdf);break;case _0x2dd244(0x126):_0x4c5834=_0x2dd244(0xf4);break;case'NEW':case _0x2dd244(0x118):default:_0x4c5834=_0x2dd244(0x13c);break;}return{'status':_0x4c5834,'amount':_0x5c7ee8['data']?.[_0x2dd244(0xf7)],'currency':_0x5c7ee8[_0x2dd244(0xf6)]?.[_0x2dd244(0x119)]};}catch(_0x11395b){console[_0x2dd244(0x12f)](_0x2dd244(0xd4),_0x11395b),loggerService_1[_0x2dd244(0x134)][_0x2dd244(0x123)](_0x2dd244(0xd6),_0x2dd244(0x11d)+_0x4feb66,_0x11395b);throw new Error(_0x2dd244(0xfd)+(_0x11395b instanceof Error?_0x11395b[_0x2dd244(0x13a)]:'Unknown\x20error'));}}async['processWebhook'](_0xae0ad1){const _0x121bcc=a48_0x3f3758;console[_0x121bcc(0x10e)](_0x121bcc(0x113),_0xae0ad1);let _0x8dc840=_0x121bcc(0x13c),_0x3ea69a;_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0x13e)]&&(_0x3ea69a=_0xae0ad1[_0x121bcc(0xf6)][_0x121bcc(0x13e)],console['log'](_0x121bcc(0xf0)+_0x3ea69a));switch(_0xae0ad1[_0x121bcc(0xc8)]?.[_0x121bcc(0x122)]()){case _0x121bcc(0x102):_0xae0ad1[_0x121bcc(0xf6)]?.['paid']===!![]&&_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0xe2)]===_0x121bcc(0xed)?_0x8dc840=_0x121bcc(0x11b):_0x8dc840='PENDING';break;case _0x121bcc(0xd9):_0x8dc840=_0x121bcc(0xf4);break;case _0x121bcc(0x124):_0x8dc840=_0x121bcc(0xdf);break;case _0x121bcc(0xc5):_0x8dc840='FAILED';!_0x3ea69a&&_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0x13e)]&&(_0x3ea69a=_0xae0ad1[_0x121bcc(0xf6)][_0x121bcc(0x13e)]);break;default:switch(_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0xe2)]?.[_0x121bcc(0x122)]()){case _0x121bcc(0xed):_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0x10a)]===!![]?_0x8dc840=_0x121bcc(0x11b):_0x8dc840='FAILED';break;case _0x121bcc(0xc2):_0x8dc840=_0x121bcc(0xf4);break;case _0x121bcc(0xe6):_0x8dc840=_0x121bcc(0xdf);break;case'ERR':_0x8dc840=_0x121bcc(0xf4);!_0x3ea69a&&_0xae0ad1['data']?.[_0x121bcc(0x13e)]&&(_0x3ea69a=_0xae0ad1['data'][_0x121bcc(0x13e)]);break;case'NEW':case _0x121bcc(0x118):default:_0x8dc840='PENDING';break;}break;}const _0x3d232b={};return _0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0xfe)]?.['last4']&&(_0x3d232b[_0x121bcc(0xd8)]=_0xae0ad1[_0x121bcc(0xf6)][_0x121bcc(0xfe)][_0x121bcc(0x100)]),_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0xe8)]&&(_0x3d232b[_0x121bcc(0x112)]=_0xae0ad1[_0x121bcc(0xf6)][_0x121bcc(0xe8)]),_0xae0ad1['data']?.[_0x121bcc(0xe9)]&&(_0x3d232b[_0x121bcc(0x127)]=_0xae0ad1[_0x121bcc(0xf6)][_0x121bcc(0xe9)]),_0xae0ad1['data']?.[_0x121bcc(0xea)]&&(_0x3d232b[_0x121bcc(0x132)]=_0xae0ad1[_0x121bcc(0xf6)][_0x121bcc(0xea)]),console[_0x121bcc(0x10e)](_0x121bcc(0xeb)+_0x8dc840+_0x121bcc(0x136)+(_0x3ea69a||'none')),{'paymentId':_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0x108)]||'','status':_0x8dc840,'amount':_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0xf7)],'currency':_0xae0ad1[_0x121bcc(0xf6)]?.[_0x121bcc(0x119)],'failureMessage':_0x3ea69a,'additionalInfo':_0x3d232b};}}exports[a48_0x3f3758(0x131)]=RapydService;