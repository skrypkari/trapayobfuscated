'use strict';const a45_0x6f5a67=a45_0x5a2c;(function(_0x4ce494,_0x333b5e){const _0x4f60a7=a45_0x5a2c,_0x355a52=_0x4ce494();while(!![]){try{const _0x32503a=parseInt(_0x4f60a7(0x165))/0x1+parseInt(_0x4f60a7(0x182))/0x2*(-parseInt(_0x4f60a7(0x173))/0x3)+parseInt(_0x4f60a7(0x145))/0x4+parseInt(_0x4f60a7(0x127))/0x5*(parseInt(_0x4f60a7(0x132))/0x6)+-parseInt(_0x4f60a7(0x136))/0x7*(parseInt(_0x4f60a7(0x12b))/0x8)+parseInt(_0x4f60a7(0x147))/0x9+-parseInt(_0x4f60a7(0x157))/0xa;if(_0x32503a===_0x333b5e)break;else _0x355a52['push'](_0x355a52['shift']());}catch(_0x3ae7c8){_0x355a52['push'](_0x355a52['shift']());}}}(a45_0x41bd,0xbcfa5));function a45_0x5a2c(_0x4e6ad5,_0x589bf2){const _0x41bd18=a45_0x41bd();return a45_0x5a2c=function(_0x5a2cff,_0x3d1b7e){_0x5a2cff=_0x5a2cff-0x118;let _0x1cc561=_0x41bd18[_0x5a2cff];return _0x1cc561;},a45_0x5a2c(_0x4e6ad5,_0x589bf2);}function a45_0x41bd(){const _0x12342a=['Error\x20stack:','HTTP\x20error!\x20status:\x20','errorCode','logWhiteDomainError','PAYMENT_COMPLETED','merchant_reference_id','error_code','payment_method_data','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','loggerService','failure_message','Response\x20Time:','defineProperty','Redirect\x20URL:','202380JPUyfx','last4','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Unknown\x20error','64wNDtVQ','logWhiteDomainResponse','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','FAILED','none','gb_mastercard_card','error','162bqjkgC','type','cardLast4','URL:','1345645YIixwj','paid','/v1/hosted/payment_links','Error\x20Message:','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Response\x20data:','PAYMENT_FAILED','failure_code','UNKNOWN','Status:','processWebhook','payment_method_type','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','json','paymentMethod','3022476GoFDZO','Error\x20message:','9626625weAWmU','verifyPayment','HTTP\x20','now','../loggerService','Failed\x20to\x20parse\x20JSON\x20response:','CAN','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20Code:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','TesSoft\x20Payment\x20System/1.0','üá¨üáß\x20Country\x20used:\x20','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Rapyd\x20payment\x20verification\x20error:','https://tesoft.uk/gateway/fail.php?id=','Response\x20Body:','10852490tklTsB','Payment\x20Link\x20ID:','data','CLO','rapyd','status','\x20(always\x20GB\x20for\x20Rapyd)','redirect_url','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','RapydService','GET','PAYMENT_EXPIRED','Rapyd\x20API\x20error:\x20','HTTP\x20Status:','866440mkQXJl','PAYMENT_CANCELED','apiUrl','SUCCESS','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','toUpperCase','===\x20RAPYD\x20SUCCESS\x20===','PAID','===\x20RAPYD\x20API\x20ERROR\x20===','fromEntries','NEW',',\x20failureMessage=',',\x20body:\x20','18TJhSBI','ERR','createPaymentLink','message','POST','log','entries','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','/v1/hosted/payment_links/','PENDING','Parsed\x20Result:','\x20(GB\x20-\x20Britain)','application/json','Business\x20Error\x20(','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','129118VTdzGL','https://tesoft.uk/gateway/success.php?id=','gb_visa_card','stack','amount','üí•\x20Rapyd\x20failure\x20message:\x20','statusText','text','EXPIRED','headers','Unknown\x20error\x20from\x20Rapyd\x20API'];a45_0x41bd=function(){return _0x12342a;};return a45_0x41bd();}Object[a45_0x6f5a67(0x125)](exports,'__esModule',{'value':!![]}),exports[a45_0x6f5a67(0x160)]=void 0x0;const loggerService_1=require(a45_0x6f5a67(0x14b));class RapydService{constructor(){const _0x3edabc=a45_0x6f5a67;this[_0x3edabc(0x167)]='https://tesoft.uk/gateway/rapyd/',console[_0x3edabc(0x178)](_0x3edabc(0x142));}async[a45_0x6f5a67(0x175)](_0x2cd6b4){const _0x348566=a45_0x6f5a67,{orderId:_0x101962,orderName:_0x3a98e2,amount:_0x51e3fe,currency:_0x3f66e1,usage:_0x248470,maxPayments:_0x1f80ad,successUrl:_0x31f271,failUrl:_0x2f5afa}=_0x2cd6b4,_0x1e474a=_0x3f66e1[_0x348566(0x16b)](),_0x44eeec='GB';console[_0x348566(0x178)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0xd8da93=_0x348566(0x183)+_0x101962,_0x322aaa=_0x348566(0x155)+_0x101962,_0x18e484={'amount':_0x51e3fe,'currency':_0x1e474a,'cancel_checkout_url':_0x322aaa,'complete_checkout_url':_0xd8da93,'complete_payment_url':_0xd8da93,'merchant_reference_id':_0x101962,'description':'ORDER:\x20'+_0x101962,'country':'GB','payment_method_types_include':[_0x348566(0x184),_0x348566(0x130)],'custom_elements':{'display_description':!![]}},_0x59f748=Date['now']();try{console[_0x348566(0x178)](_0x348566(0x121)),console['log'](_0x348566(0x135),this[_0x348566(0x167)]),console[_0x348566(0x178)]('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x18e484,null,0x2)),console[_0x348566(0x178)]('üá¨üáß\x20Country:\x20'+_0x44eeec+_0x348566(0x15d)),console[_0x348566(0x178)](_0x348566(0x15f)),loggerService_1[_0x348566(0x122)]['logWhiteDomainRequest'](_0x348566(0x15b),_0x348566(0x138),_0x348566(0x177),_0x18e484);const _0x591063=await fetch(this[_0x348566(0x167)],{'method':_0x348566(0x177),'headers':{'Content-Type':_0x348566(0x17f),'User-Agent':_0x348566(0x151)},'body':JSON[_0x348566(0x16a)](_0x18e484)}),_0x38eaba=Date[_0x348566(0x14a)]()-_0x59f748;console[_0x348566(0x178)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x348566(0x178)](_0x348566(0x13f),_0x591063[_0x348566(0x15c)]),console[_0x348566(0x178)]('Status\x20Text:',_0x591063[_0x348566(0x188)]),console[_0x348566(0x178)]('Headers:',Object[_0x348566(0x16f)](_0x591063[_0x348566(0x18b)][_0x348566(0x179)]())),console[_0x348566(0x178)](_0x348566(0x124),_0x38eaba+'ms');const _0x4d3450=await _0x591063[_0x348566(0x189)]();console[_0x348566(0x178)]('Raw\x20Response\x20Body:',_0x4d3450);if(!_0x591063['ok']){console[_0x348566(0x131)](_0x348566(0x16e)),console[_0x348566(0x131)](_0x348566(0x164),_0x591063['status']),console[_0x348566(0x131)](_0x348566(0x156),_0x4d3450),loggerService_1[_0x348566(0x122)][_0x348566(0x12c)]('rapyd','/v1/hosted/payment_links',_0x591063['status'],_0x4d3450,_0x38eaba),loggerService_1['loggerService'][_0x348566(0x11c)](_0x348566(0x15b),_0x348566(0x138),_0x348566(0x149)+_0x591063[_0x348566(0x15c)]+':\x20'+_0x4d3450);throw new Error(_0x348566(0x11a)+_0x591063[_0x348566(0x15c)]+_0x348566(0x172)+_0x4d3450);}let _0x686136;try{_0x686136=JSON['parse'](_0x4d3450);}catch(_0x5cee60){console[_0x348566(0x131)](_0x348566(0x14c),_0x5cee60),loggerService_1[_0x348566(0x122)]['logWhiteDomainError']('rapyd',_0x348566(0x138),'JSON\x20Parse\x20Error:\x20'+_0x5cee60);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x4d3450);}console[_0x348566(0x178)](_0x348566(0x17a)),console[_0x348566(0x178)](_0x348566(0x17d),JSON[_0x348566(0x16a)](_0x686136,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x348566(0x15b),_0x348566(0x138),_0x591063['status'],_0x686136,_0x38eaba);if(_0x686136[_0x348566(0x15c)]?.[_0x348566(0x15c)]!==_0x348566(0x168)){const _0x1c8a3e=_0x686136[_0x348566(0x15c)]?.[_0x348566(0x176)]||_0x348566(0x118),_0x29acd9=_0x686136[_0x348566(0x15c)]?.[_0x348566(0x11f)]||_0x348566(0x13e);console['error'](_0x348566(0x14e)),console['error'](_0x348566(0x14f),_0x29acd9),console[_0x348566(0x131)](_0x348566(0x139),_0x1c8a3e),console[_0x348566(0x131)]('Full\x20Error\x20Data:',_0x686136[_0x348566(0x15c)]),loggerService_1[_0x348566(0x122)][_0x348566(0x11c)]('rapyd',_0x348566(0x138),_0x348566(0x180)+_0x29acd9+'):\x20'+_0x1c8a3e);throw new Error('Rapyd\x20API\x20error\x20('+_0x29acd9+'):\x20'+_0x1c8a3e);}if(!_0x686136[_0x348566(0x159)]?.['id']||!_0x686136[_0x348566(0x159)]?.['redirect_url']){console[_0x348566(0x131)](_0x348566(0x169)),console[_0x348566(0x131)](_0x348566(0x13a)),console['error'](_0x348566(0x13b),_0x686136[_0x348566(0x159)]),loggerService_1[_0x348566(0x122)][_0x348566(0x11c)](_0x348566(0x15b),_0x348566(0x138),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x348566(0x153));}return console[_0x348566(0x178)](_0x348566(0x16c)),console[_0x348566(0x178)](_0x348566(0x158),_0x686136['data']['id']),console[_0x348566(0x178)](_0x348566(0x126),_0x686136[_0x348566(0x159)][_0x348566(0x15e)]),console[_0x348566(0x178)](_0x348566(0x152)+_0x44eeec+_0x348566(0x17e)),console[_0x348566(0x178)](_0x348566(0x15f)),{'gateway_payment_id':_0x686136[_0x348566(0x159)]['id'],'payment_url':_0x686136[_0x348566(0x159)][_0x348566(0x15e)]};}catch(_0x144bae){console['error'](_0x348566(0x150)),console[_0x348566(0x131)]('Error\x20details:',_0x144bae),loggerService_1[_0x348566(0x122)][_0x348566(0x11c)](_0x348566(0x15b),_0x348566(0x138),_0x144bae);if(_0x144bae instanceof Error){console[_0x348566(0x131)](_0x348566(0x146),_0x144bae[_0x348566(0x176)]),console[_0x348566(0x131)](_0x348566(0x119),_0x144bae[_0x348566(0x185)]);throw new Error(_0x348566(0x129)+_0x144bae['message']);}throw new Error(_0x348566(0x12d));}}async[a45_0x6f5a67(0x148)](_0x285eb5){const _0x2ac6fb=a45_0x6f5a67,_0x33e213=Date[_0x2ac6fb(0x14a)]();try{loggerService_1[_0x2ac6fb(0x122)]['logWhiteDomainRequest'](_0x2ac6fb(0x15b),'/v1/hosted/payment_links/'+_0x285eb5,_0x2ac6fb(0x161),{});const _0x42d877=await fetch(this[_0x2ac6fb(0x167)]+'/'+_0x285eb5,{'method':_0x2ac6fb(0x161),'headers':{'Content-Type':_0x2ac6fb(0x17f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x30dadd=Date['now']()-_0x33e213;if(!_0x42d877['ok']){const _0x46fb90=await _0x42d877[_0x2ac6fb(0x189)]();loggerService_1[_0x2ac6fb(0x122)][_0x2ac6fb(0x12c)](_0x2ac6fb(0x15b),_0x2ac6fb(0x17b)+_0x285eb5,_0x42d877[_0x2ac6fb(0x15c)],_0x46fb90,_0x30dadd);throw new Error(_0x2ac6fb(0x11a)+_0x42d877['status']);}const _0x25b519=await _0x42d877[_0x2ac6fb(0x143)]();loggerService_1[_0x2ac6fb(0x122)][_0x2ac6fb(0x12c)](_0x2ac6fb(0x15b),_0x2ac6fb(0x17b)+_0x285eb5,_0x42d877[_0x2ac6fb(0x15c)],_0x25b519,_0x30dadd);if(_0x25b519[_0x2ac6fb(0x15c)]?.[_0x2ac6fb(0x15c)]!==_0x2ac6fb(0x168)){loggerService_1[_0x2ac6fb(0x122)][_0x2ac6fb(0x11c)](_0x2ac6fb(0x15b),'/v1/hosted/payment_links/'+_0x285eb5,_0x2ac6fb(0x163)+(_0x25b519['status']?.[_0x2ac6fb(0x176)]||_0x2ac6fb(0x12a)));throw new Error(_0x2ac6fb(0x163)+(_0x25b519[_0x2ac6fb(0x15c)]?.[_0x2ac6fb(0x176)]||'Unknown\x20error'));}let _0x1ef848=_0x2ac6fb(0x17c);if(_0x25b519[_0x2ac6fb(0x159)]?.[_0x2ac6fb(0x15c)])switch(_0x25b519[_0x2ac6fb(0x159)]['status'][_0x2ac6fb(0x16b)]()){case _0x2ac6fb(0x15a):_0x1ef848='PAID';break;case _0x2ac6fb(0x14d):_0x1ef848=_0x2ac6fb(0x12e);break;case'EXP':_0x1ef848=_0x2ac6fb(0x18a);break;case'ERR':_0x1ef848='FAILED';break;case'NEW':case'ACT':default:_0x1ef848=_0x2ac6fb(0x17c);break;}return{'status':_0x1ef848,'amount':_0x25b519['data']?.[_0x2ac6fb(0x186)],'currency':_0x25b519['data']?.['currency']};}catch(_0x50e82){console[_0x2ac6fb(0x131)](_0x2ac6fb(0x154),_0x50e82),loggerService_1[_0x2ac6fb(0x122)]['logWhiteDomainError'](_0x2ac6fb(0x15b),_0x2ac6fb(0x17b)+_0x285eb5,_0x50e82);throw new Error(_0x2ac6fb(0x181)+(_0x50e82 instanceof Error?_0x50e82[_0x2ac6fb(0x176)]:_0x2ac6fb(0x12a)));}}async[a45_0x6f5a67(0x140)](_0x237d89){const _0x1c5242=a45_0x6f5a67;console[_0x1c5242(0x178)]('Processing\x20Rapyd\x20webhook:',_0x237d89);let _0x396914=_0x1c5242(0x17c),_0x23ead3;_0x237d89[_0x1c5242(0x159)]?.['failure_message']&&(_0x23ead3=_0x237d89['data'][_0x1c5242(0x123)],console['log'](_0x1c5242(0x187)+_0x23ead3));switch(_0x237d89[_0x1c5242(0x133)]?.[_0x1c5242(0x16b)]()){case _0x1c5242(0x11d):_0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x137)]===!![]&&_0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x15c)]===_0x1c5242(0x15a)?_0x396914=_0x1c5242(0x16d):_0x396914=_0x1c5242(0x17c);break;case _0x1c5242(0x166):_0x396914=_0x1c5242(0x12e);break;case _0x1c5242(0x162):_0x396914='EXPIRED';break;case _0x1c5242(0x13c):_0x396914=_0x1c5242(0x12e);!_0x23ead3&&_0x237d89[_0x1c5242(0x159)]?.['failure_message']&&(_0x23ead3=_0x237d89['data']['failure_message']);break;default:switch(_0x237d89['data']?.[_0x1c5242(0x15c)]?.[_0x1c5242(0x16b)]()){case _0x1c5242(0x15a):_0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x137)]===!![]?_0x396914=_0x1c5242(0x16d):_0x396914=_0x1c5242(0x12e);break;case _0x1c5242(0x14d):_0x396914=_0x1c5242(0x12e);break;case'EXP':_0x396914=_0x1c5242(0x18a);break;case _0x1c5242(0x174):_0x396914=_0x1c5242(0x12e);!_0x23ead3&&_0x237d89['data']?.['failure_message']&&(_0x23ead3=_0x237d89[_0x1c5242(0x159)][_0x1c5242(0x123)]);break;case _0x1c5242(0x170):case'ACT':default:_0x396914=_0x1c5242(0x17c);break;}break;}const _0x565b1d={};return _0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x120)]?.[_0x1c5242(0x128)]&&(_0x565b1d[_0x1c5242(0x134)]=_0x237d89['data']['payment_method_data'][_0x1c5242(0x128)]),_0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x141)]&&(_0x565b1d[_0x1c5242(0x144)]=_0x237d89['data'][_0x1c5242(0x141)]),_0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x11f)]&&(_0x565b1d[_0x1c5242(0x11b)]=_0x237d89[_0x1c5242(0x159)][_0x1c5242(0x11f)]),_0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x13d)]&&(_0x565b1d['failureCode']=_0x237d89[_0x1c5242(0x159)][_0x1c5242(0x13d)]),console['log']('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x396914+_0x1c5242(0x171)+(_0x23ead3||_0x1c5242(0x12f))),{'paymentId':_0x237d89[_0x1c5242(0x159)]?.[_0x1c5242(0x11e)]||'','status':_0x396914,'amount':_0x237d89['data']?.[_0x1c5242(0x186)],'currency':_0x237d89[_0x1c5242(0x159)]?.['currency'],'failureMessage':_0x23ead3,'additionalInfo':_0x565b1d};}}exports['RapydService']=RapydService;