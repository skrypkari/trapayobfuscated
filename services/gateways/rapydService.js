'use strict';function a46_0x3419(){const _0x503268=['494248tLnqZK','now','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','ERR','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','failure_message','===\x20RAPYD\x20API\x20ERROR\x20===','597524hRXXGS','749148odFmZV','last4','NEW','üá¨üáß\x20Country\x20used:\x20','):\x20','Response\x20Body:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20','SUCCESS','37572RkKHRl','PENDING','https://tesoft.uk/gateway/success.php?id=','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','1176370WMuBZU','Headers:','CLO','PAYMENT_COMPLETED','failureCode','PAYMENT_CANCELED','ACT','RapydService','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','89269qyHtOl','text','processWebhook','loggerService','===\x20RAPYD\x20SUCCESS\x20===','POST','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','Unknown\x20error','Processing\x20Rapyd\x20webhook:','logWhiteDomainRequest','Error\x20Message:','Redirect\x20URL:','HTTP\x20error!\x20status:\x20','üá¨üáß\x20Country:\x20','log','/v1/hosted/payment_links','EXPIRED','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Error\x20stack:','ORDER:\x20','Failed\x20to\x20parse\x20JSON\x20response:','PAID','üí•\x20Rapyd\x20failure\x20message:\x20','paymentMethod','Status:','FAILED','Rapyd\x20payment\x20verification\x20error:','error','parse','1177lnPqvi','45hFGQnm','PAYMENT_EXPIRED','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Full\x20Error\x20Data:','message','Business\x20Error\x20(','gb_mastercard_card','5DUKZeQ','__esModule','Error\x20message:','status','headers','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Rapyd\x20API\x20error:\x20','Request\x20Body\x20(Updated\x20Format):','99654vDWosi','currency','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20',',\x20body:\x20','Status\x20Text:','\x20(GB\x20-\x20Britain)','failure_code','TesSoft\x20Payment\x20System/1.0','toUpperCase','error_code','Error\x20details:','CAN','7fxsiIV','errorCode','application/json','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','4hVhjiP','redirect_url','logWhiteDomainError','PAYMENT_FAILED','data','Response\x20data:','payment_method_type','statusText','GET','paid','stack','URL:','apiUrl','amount','/v1/hosted/payment_links/','type','rapyd','logWhiteDomainResponse','https://tesoft.uk/gateway/rapyd/','HTTP\x20Status:','Raw\x20Response\x20Body:','UNKNOWN','cardLast4','stringify','merchant_reference_id','fromEntries','EXP','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'];a46_0x3419=function(){return _0x503268;};return a46_0x3419();}const a46_0x2945a8=a46_0x1759;function a46_0x1759(_0x346a8d,_0x43ae0f){const _0x3419ca=a46_0x3419();return a46_0x1759=function(_0x1759a3,_0xcc64e1){_0x1759a3=_0x1759a3-0xcc;let _0xaf608f=_0x3419ca[_0x1759a3];return _0xaf608f;},a46_0x1759(_0x346a8d,_0x43ae0f);}(function(_0x298df0,_0x53e991){const _0x8b5ba0=a46_0x1759,_0x5241a1=_0x298df0();while(!![]){try{const _0x493f51=-parseInt(_0x8b5ba0(0x142))/0x1*(-parseInt(_0x8b5ba0(0x107))/0x2)+parseInt(_0x8b5ba0(0x12c))/0x3+-parseInt(_0x8b5ba0(0x12b))/0x4*(parseInt(_0x8b5ba0(0xee))/0x5)+parseInt(_0x8b5ba0(0xf6))/0x6*(-parseInt(_0x8b5ba0(0x102))/0x7)+-parseInt(_0x8b5ba0(0x124))/0x8*(parseInt(_0x8b5ba0(0xe7))/0x9)+-parseInt(_0x8b5ba0(0x139))/0xa+parseInt(_0x8b5ba0(0xe6))/0xb*(parseInt(_0x8b5ba0(0x135))/0xc);if(_0x493f51===_0x53e991)break;else _0x5241a1['push'](_0x5241a1['shift']());}catch(_0x460d82){_0x5241a1['push'](_0x5241a1['shift']());}}}(a46_0x3419,0x29af3));Object['defineProperty'](exports,a46_0x2945a8(0xef),{'value':!![]}),exports[a46_0x2945a8(0x140)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0xd03735=a46_0x2945a8;this[_0xd03735(0x113)]=_0xd03735(0x119),console[_0xd03735(0xd7)](_0xd03735(0x123));}async['createPaymentLink'](_0x5ad3da){const _0x54a975=a46_0x2945a8,{orderId:_0x2176fb,orderName:_0x5ba55a,amount:_0x26e4ac,currency:_0x173f74,usage:_0x178b70,maxPayments:_0x3a9c50,successUrl:_0x517c0f,failUrl:_0x1733da}=_0x5ad3da,_0x330432=_0x173f74[_0x54a975(0xfe)](),_0x22a416='GB';console[_0x54a975(0xd7)](_0x54a975(0x141));const _0x3e378d=_0x54a975(0x137)+_0x2176fb,_0x3b4914='https://tesoft.uk/gateway/fail.php?id='+_0x2176fb,_0x5cba68={'amount':_0x26e4ac,'currency':_0x330432,'cancel_checkout_url':_0x3b4914,'complete_checkout_url':_0x3e378d,'complete_payment_url':_0x3e378d,'merchant_reference_id':_0x2176fb,'description':_0x54a975(0xdc)+_0x2176fb,'country':'GB','payment_method_types_include':['gb_visa_card',_0x54a975(0xed)],'custom_elements':{'display_description':!![]}},_0x2d588a=Date[_0x54a975(0x125)]();try{console[_0x54a975(0xd7)](_0x54a975(0x105)),console[_0x54a975(0xd7)](_0x54a975(0x112),this[_0x54a975(0x113)]),console['log'](_0x54a975(0xf5),JSON['stringify'](_0x5cba68,null,0x2)),console[_0x54a975(0xd7)](_0x54a975(0xd6)+_0x22a416+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x54a975(0xd7)](_0x54a975(0xf3)),loggerService_1['loggerService'][_0x54a975(0xd2)](_0x54a975(0x117),_0x54a975(0xd8),_0x54a975(0xce),_0x5cba68);const _0x19eebe=await fetch(this[_0x54a975(0x113)],{'method':_0x54a975(0xce),'headers':{'Content-Type':'application/json','User-Agent':_0x54a975(0xfd)},'body':JSON['stringify'](_0x5cba68)}),_0x30960e=Date[_0x54a975(0x125)]()-_0x2d588a;console[_0x54a975(0xd7)](_0x54a975(0x132)),console[_0x54a975(0xd7)](_0x54a975(0xe1),_0x19eebe[_0x54a975(0xf1)]),console['log'](_0x54a975(0xfa),_0x19eebe[_0x54a975(0x10e)]),console[_0x54a975(0xd7)](_0x54a975(0x13a),Object[_0x54a975(0x120)](_0x19eebe[_0x54a975(0xf2)]['entries']())),console['log']('Response\x20Time:',_0x30960e+'ms');const _0x2671d3=await _0x19eebe[_0x54a975(0x143)]();console[_0x54a975(0xd7)](_0x54a975(0x11b),_0x2671d3);if(!_0x19eebe['ok']){console[_0x54a975(0xe4)](_0x54a975(0x12a)),console[_0x54a975(0xe4)](_0x54a975(0x11a),_0x19eebe[_0x54a975(0xf1)]),console['error'](_0x54a975(0x131),_0x2671d3),loggerService_1['loggerService'][_0x54a975(0x118)](_0x54a975(0x117),_0x54a975(0xd8),_0x19eebe[_0x54a975(0xf1)],_0x2671d3,_0x30960e),loggerService_1[_0x54a975(0xcc)][_0x54a975(0x109)](_0x54a975(0x117),_0x54a975(0xd8),_0x54a975(0x133)+_0x19eebe[_0x54a975(0xf1)]+':\x20'+_0x2671d3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x19eebe[_0x54a975(0xf1)]+_0x54a975(0xf9)+_0x2671d3);}let _0x23ea26;try{_0x23ea26=JSON[_0x54a975(0xe5)](_0x2671d3);}catch(_0x4785fd){console['error'](_0x54a975(0xdd),_0x4785fd),loggerService_1['loggerService'][_0x54a975(0x109)](_0x54a975(0x117),_0x54a975(0xd8),'JSON\x20Parse\x20Error:\x20'+_0x4785fd);throw new Error(_0x54a975(0xf8)+_0x2671d3);}console['log'](_0x54a975(0xcf)),console[_0x54a975(0xd7)]('Parsed\x20Result:',JSON[_0x54a975(0x11e)](_0x23ea26,null,0x2)),loggerService_1[_0x54a975(0xcc)][_0x54a975(0x118)](_0x54a975(0x117),_0x54a975(0xd8),_0x19eebe[_0x54a975(0xf1)],_0x23ea26,_0x30960e);if(_0x23ea26[_0x54a975(0xf1)]?.[_0x54a975(0xf1)]!==_0x54a975(0x134)){const _0x49fd2d=_0x23ea26['status']?.['message']||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x2b6138=_0x23ea26[_0x54a975(0xf1)]?.[_0x54a975(0xff)]||_0x54a975(0x11c);console['error'](_0x54a975(0x138)),console[_0x54a975(0xe4)]('Error\x20Code:',_0x2b6138),console['error'](_0x54a975(0xd3),_0x49fd2d),console[_0x54a975(0xe4)](_0x54a975(0xea),_0x23ea26[_0x54a975(0xf1)]),loggerService_1[_0x54a975(0xcc)][_0x54a975(0x109)](_0x54a975(0x117),_0x54a975(0xd8),_0x54a975(0xec)+_0x2b6138+_0x54a975(0x130)+_0x49fd2d);throw new Error('Rapyd\x20API\x20error\x20('+_0x2b6138+_0x54a975(0x130)+_0x49fd2d);}if(!_0x23ea26[_0x54a975(0x10b)]?.['id']||!_0x23ea26['data']?.[_0x54a975(0x108)]){console[_0x54a975(0xe4)](_0x54a975(0x106)),console['error'](_0x54a975(0xe9)),console['error'](_0x54a975(0x10c),_0x23ea26[_0x54a975(0x10b)]),loggerService_1[_0x54a975(0xcc)][_0x54a975(0x109)]('rapyd',_0x54a975(0xd8),_0x54a975(0x126));throw new Error(_0x54a975(0x122));}return console[_0x54a975(0xd7)](_0x54a975(0xcd)),console['log']('Payment\x20Link\x20ID:',_0x23ea26['data']['id']),console[_0x54a975(0xd7)](_0x54a975(0xd4),_0x23ea26['data'][_0x54a975(0x108)]),console[_0x54a975(0xd7)](_0x54a975(0x12f)+_0x22a416+_0x54a975(0xfb)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x23ea26['data']['id'],'payment_url':_0x23ea26[_0x54a975(0x10b)]['redirect_url']};}catch(_0x1d81a2){console[_0x54a975(0xe4)](_0x54a975(0xda)),console['error'](_0x54a975(0x100),_0x1d81a2),loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x54a975(0xd8),_0x1d81a2);if(_0x1d81a2 instanceof Error){console[_0x54a975(0xe4)](_0x54a975(0xf0),_0x1d81a2[_0x54a975(0xeb)]),console[_0x54a975(0xe4)](_0x54a975(0xdb),_0x1d81a2[_0x54a975(0x111)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x1d81a2[_0x54a975(0xeb)]);}throw new Error(_0x54a975(0x128));}}async['verifyPayment'](_0x246f15){const _0x1ded48=a46_0x2945a8,_0x47216d=Date[_0x1ded48(0x125)]();try{loggerService_1['loggerService'][_0x1ded48(0xd2)](_0x1ded48(0x117),'/v1/hosted/payment_links/'+_0x246f15,_0x1ded48(0x10f),{});const _0x5b1286=await fetch(this[_0x1ded48(0x113)]+'/'+_0x246f15,{'method':_0x1ded48(0x10f),'headers':{'Content-Type':_0x1ded48(0x104),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0xbd534a=Date[_0x1ded48(0x125)]()-_0x47216d;if(!_0x5b1286['ok']){const _0xe0d301=await _0x5b1286[_0x1ded48(0x143)]();loggerService_1[_0x1ded48(0xcc)]['logWhiteDomainResponse'](_0x1ded48(0x117),_0x1ded48(0x115)+_0x246f15,_0x5b1286[_0x1ded48(0xf1)],_0xe0d301,_0xbd534a);throw new Error(_0x1ded48(0xd5)+_0x5b1286[_0x1ded48(0xf1)]);}const _0x348dcd=await _0x5b1286['json']();loggerService_1[_0x1ded48(0xcc)][_0x1ded48(0x118)](_0x1ded48(0x117),'/v1/hosted/payment_links/'+_0x246f15,_0x5b1286[_0x1ded48(0xf1)],_0x348dcd,_0xbd534a);if(_0x348dcd[_0x1ded48(0xf1)]?.[_0x1ded48(0xf1)]!==_0x1ded48(0x134)){loggerService_1[_0x1ded48(0xcc)][_0x1ded48(0x109)](_0x1ded48(0x117),_0x1ded48(0x115)+_0x246f15,_0x1ded48(0xf4)+(_0x348dcd['status']?.['message']||_0x1ded48(0xd0)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x348dcd[_0x1ded48(0xf1)]?.[_0x1ded48(0xeb)]||_0x1ded48(0xd0)));}let _0x15f2ab=_0x1ded48(0x136);if(_0x348dcd[_0x1ded48(0x10b)]?.['status'])switch(_0x348dcd['data']['status'][_0x1ded48(0xfe)]()){case _0x1ded48(0x13b):_0x15f2ab=_0x1ded48(0xde);break;case _0x1ded48(0x101):_0x15f2ab='FAILED';break;case _0x1ded48(0x121):_0x15f2ab=_0x1ded48(0xd9);break;case _0x1ded48(0x127):_0x15f2ab=_0x1ded48(0xe2);break;case _0x1ded48(0x12e):case _0x1ded48(0x13f):default:_0x15f2ab=_0x1ded48(0x136);break;}return{'status':_0x15f2ab,'amount':_0x348dcd[_0x1ded48(0x10b)]?.[_0x1ded48(0x114)],'currency':_0x348dcd[_0x1ded48(0x10b)]?.[_0x1ded48(0xf7)]};}catch(_0x4a8c41){console[_0x1ded48(0xe4)](_0x1ded48(0xe3),_0x4a8c41),loggerService_1[_0x1ded48(0xcc)][_0x1ded48(0x109)](_0x1ded48(0x117),_0x1ded48(0x115)+_0x246f15,_0x4a8c41);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x4a8c41 instanceof Error?_0x4a8c41['message']:_0x1ded48(0xd0)));}}async[a46_0x2945a8(0x144)](_0x3fe727){const _0x1c3683=a46_0x2945a8;console['log'](_0x1c3683(0xd1),_0x3fe727);let _0x47b538='PENDING',_0xbb6672;_0x3fe727[_0x1c3683(0x10b)]?.['failure_message']&&(_0xbb6672=_0x3fe727['data'][_0x1c3683(0x129)],console[_0x1c3683(0xd7)](_0x1c3683(0xdf)+_0xbb6672));switch(_0x3fe727[_0x1c3683(0x116)]?.['toUpperCase']()){case _0x1c3683(0x13c):_0x3fe727['data']?.[_0x1c3683(0x110)]===!![]&&_0x3fe727[_0x1c3683(0x10b)]?.['status']==='CLO'?_0x47b538='PAID':_0x47b538=_0x1c3683(0x136);break;case _0x1c3683(0x13e):_0x47b538=_0x1c3683(0xe2);break;case _0x1c3683(0xe8):_0x47b538=_0x1c3683(0xd9);break;case _0x1c3683(0x10a):_0x47b538=_0x1c3683(0xe2);!_0xbb6672&&_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0x129)]&&(_0xbb6672=_0x3fe727[_0x1c3683(0x10b)]['failure_message']);break;default:switch(_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0xf1)]?.[_0x1c3683(0xfe)]()){case'CLO':_0x3fe727['data']?.[_0x1c3683(0x110)]===!![]?_0x47b538=_0x1c3683(0xde):_0x47b538=_0x1c3683(0xe2);break;case _0x1c3683(0x101):_0x47b538='FAILED';break;case _0x1c3683(0x121):_0x47b538=_0x1c3683(0xd9);break;case'ERR':_0x47b538=_0x1c3683(0xe2);!_0xbb6672&&_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0x129)]&&(_0xbb6672=_0x3fe727['data'][_0x1c3683(0x129)]);break;case _0x1c3683(0x12e):case'ACT':default:_0x47b538=_0x1c3683(0x136);break;}break;}const _0xe1d34={};return _0x3fe727[_0x1c3683(0x10b)]?.['payment_method_data']?.['last4']&&(_0xe1d34[_0x1c3683(0x11d)]=_0x3fe727[_0x1c3683(0x10b)]['payment_method_data'][_0x1c3683(0x12d)]),_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0x10d)]&&(_0xe1d34[_0x1c3683(0xe0)]=_0x3fe727[_0x1c3683(0x10b)][_0x1c3683(0x10d)]),_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0xff)]&&(_0xe1d34[_0x1c3683(0x103)]=_0x3fe727[_0x1c3683(0x10b)]['error_code']),_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0xfc)]&&(_0xe1d34[_0x1c3683(0x13d)]=_0x3fe727[_0x1c3683(0x10b)]['failure_code']),console['log']('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x47b538+',\x20failureMessage='+(_0xbb6672||'none')),{'paymentId':_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0x11f)]||'','status':_0x47b538,'amount':_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0x114)],'currency':_0x3fe727[_0x1c3683(0x10b)]?.[_0x1c3683(0xf7)],'failureMessage':_0xbb6672,'additionalInfo':_0xe1d34};}}exports[a46_0x2945a8(0x140)]=RapydService;