'use strict';const a45_0x181ed8=a45_0x15e8;(function(_0x5587e4,_0x2e041c){const _0x41122d=a45_0x15e8,_0x57f01d=_0x5587e4();while(!![]){try{const _0x34578d=-parseInt(_0x41122d(0x7e))/0x1+-parseInt(_0x41122d(0xc2))/0x2*(-parseInt(_0x41122d(0x8f))/0x3)+parseInt(_0x41122d(0xe7))/0x4*(-parseInt(_0x41122d(0xc3))/0x5)+parseInt(_0x41122d(0xc1))/0x6+-parseInt(_0x41122d(0xb3))/0x7+-parseInt(_0x41122d(0xdb))/0x8*(parseInt(_0x41122d(0xe3))/0x9)+parseInt(_0x41122d(0x90))/0xa;if(_0x34578d===_0x2e041c)break;else _0x57f01d['push'](_0x57f01d['shift']());}catch(_0x3cfa26){_0x57f01d['push'](_0x57f01d['shift']());}}}(a45_0x2745,0xd28a8));Object[a45_0x181ed8(0xeb)](exports,a45_0x181ed8(0xbc),{'value':!![]}),exports[a45_0x181ed8(0x9d)]=void 0x0;function a45_0x15e8(_0x78e8fe,_0x152c7d){const _0x27453c=a45_0x2745();return a45_0x15e8=function(_0x15e8e9,_0x4ca22f){_0x15e8e9=_0x15e8e9-0x79;let _0x40da31=_0x27453c[_0x15e8e9];return _0x40da31;},a45_0x15e8(_0x78e8fe,_0x152c7d);}const loggerService_1=require(a45_0x181ed8(0xca));class RapydService{constructor(){const _0x2bf3db=a45_0x181ed8;this[_0x2bf3db(0xc6)]=_0x2bf3db(0xec),console[_0x2bf3db(0x84)](_0x2bf3db(0xc0));}async[a45_0x181ed8(0xd0)](_0x521090){const _0x23750e=a45_0x181ed8,{orderId:_0x1f3052,orderName:_0x239370,amount:_0x47b0cc,currency:_0x500ad6,usage:_0x3fc1d9,maxPayments:_0xe0c947,successUrl:_0x265d2e,failUrl:_0x21f271}=_0x521090,_0x232d1f=_0x500ad6[_0x23750e(0x7d)](),_0x304e71='GB';console[_0x23750e(0x84)](_0x23750e(0x8b));const _0x5c382c=_0x23750e(0xdc)+_0x1f3052,_0x578067='https://tesoft.uk/gateway/fail.php?id='+_0x1f3052,_0x5df8f5={'amount':_0x47b0cc,'currency':_0x232d1f,'cancel_checkout_url':_0x578067,'complete_checkout_url':_0x5c382c,'complete_payment_url':_0x5c382c,'merchant_reference_id':_0x1f3052,'description':_0x23750e(0xcf)+_0x1f3052,'country':'GB','payment_method_types_include':[_0x23750e(0x91),_0x23750e(0x8c)],'custom_elements':{'display_description':!![]}},_0x61a205=Date[_0x23750e(0xce)]();try{console[_0x23750e(0x84)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x23750e(0x84)](_0x23750e(0x9a),this[_0x23750e(0xc6)]),console[_0x23750e(0x84)](_0x23750e(0xad),JSON[_0x23750e(0xea)](_0x5df8f5,null,0x2)),console[_0x23750e(0x84)](_0x23750e(0x85)+_0x304e71+_0x23750e(0xed)),console[_0x23750e(0x84)](_0x23750e(0xbf)),loggerService_1[_0x23750e(0x8e)][_0x23750e(0x89)](_0x23750e(0x92),'/v1/hosted/payment_links',_0x23750e(0xbe),_0x5df8f5);const _0xaa525b=await fetch(this[_0x23750e(0xc6)],{'method':_0x23750e(0xbe),'headers':{'Content-Type':_0x23750e(0xb2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x5df8f5)}),_0x107684=Date[_0x23750e(0xce)]()-_0x61a205;console['log'](_0x23750e(0xa2)),console[_0x23750e(0x84)](_0x23750e(0xa9),_0xaa525b['status']),console[_0x23750e(0x84)](_0x23750e(0xe9),_0xaa525b[_0x23750e(0xb5)]),console['log'](_0x23750e(0x7b),Object[_0x23750e(0xe5)](_0xaa525b[_0x23750e(0x9c)][_0x23750e(0xac)]())),console['log'](_0x23750e(0xba),_0x107684+'ms');const _0x53e69e=await _0xaa525b[_0x23750e(0xe6)]();console[_0x23750e(0x84)](_0x23750e(0xcd),_0x53e69e);if(!_0xaa525b['ok']){console[_0x23750e(0xa3)](_0x23750e(0xbb)),console[_0x23750e(0xa3)](_0x23750e(0xa6),_0xaa525b['status']),console[_0x23750e(0xa3)](_0x23750e(0x8d),_0x53e69e),loggerService_1[_0x23750e(0x8e)]['logWhiteDomainResponse'](_0x23750e(0x92),_0x23750e(0x88),_0xaa525b[_0x23750e(0xd7)],_0x53e69e,_0x107684),loggerService_1[_0x23750e(0x8e)]['logWhiteDomainError'](_0x23750e(0x92),_0x23750e(0x88),_0x23750e(0x7a)+_0xaa525b[_0x23750e(0xd7)]+':\x20'+_0x53e69e);throw new Error(_0x23750e(0x98)+_0xaa525b[_0x23750e(0xd7)]+_0x23750e(0xe4)+_0x53e69e);}let _0x54ab10;try{_0x54ab10=JSON['parse'](_0x53e69e);}catch(_0x16a2be){console[_0x23750e(0xa3)](_0x23750e(0x79),_0x16a2be),loggerService_1['loggerService'][_0x23750e(0xa1)](_0x23750e(0x92),'/v1/hosted/payment_links',_0x23750e(0xc9)+_0x16a2be);throw new Error(_0x23750e(0x83)+_0x53e69e);}console[_0x23750e(0x84)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x23750e(0x84)](_0x23750e(0x97),JSON[_0x23750e(0xea)](_0x54ab10,null,0x2)),loggerService_1[_0x23750e(0x8e)][_0x23750e(0xe0)](_0x23750e(0x92),_0x23750e(0x88),_0xaa525b['status'],_0x54ab10,_0x107684);if(_0x54ab10[_0x23750e(0xd7)]?.['status']!==_0x23750e(0xd1)){const _0x5f2bfa=_0x54ab10[_0x23750e(0xd7)]?.[_0x23750e(0xa8)]||_0x23750e(0x87),_0x2f11e0=_0x54ab10[_0x23750e(0xd7)]?.[_0x23750e(0xbd)]||_0x23750e(0xab);console['error'](_0x23750e(0xcc)),console[_0x23750e(0xa3)]('Error\x20Code:',_0x2f11e0),console[_0x23750e(0xa3)](_0x23750e(0x7f),_0x5f2bfa),console['error'](_0x23750e(0xc8),_0x54ab10[_0x23750e(0xd7)]),loggerService_1[_0x23750e(0x8e)]['logWhiteDomainError'](_0x23750e(0x92),_0x23750e(0x88),'Business\x20Error\x20('+_0x2f11e0+_0x23750e(0xe1)+_0x5f2bfa);throw new Error(_0x23750e(0xe2)+_0x2f11e0+_0x23750e(0xe1)+_0x5f2bfa);}if(!_0x54ab10[_0x23750e(0xdf)]?.['id']||!_0x54ab10[_0x23750e(0xdf)]?.['redirect_url']){console[_0x23750e(0xa3)](_0x23750e(0xa7)),console[_0x23750e(0xa3)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console['error']('Response\x20data:',_0x54ab10[_0x23750e(0xdf)]),loggerService_1['loggerService'][_0x23750e(0xa1)](_0x23750e(0x92),_0x23750e(0x88),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x23750e(0x84)](_0x23750e(0xd6)),console[_0x23750e(0x84)](_0x23750e(0x81),_0x54ab10[_0x23750e(0xdf)]['id']),console[_0x23750e(0x84)]('Redirect\x20URL:',_0x54ab10[_0x23750e(0xdf)][_0x23750e(0xaa)]),console[_0x23750e(0x84)](_0x23750e(0xc4)+_0x304e71+'\x20(GB\x20-\x20Britain)'),console[_0x23750e(0x84)]('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x54ab10[_0x23750e(0xdf)]['id'],'payment_url':_0x54ab10[_0x23750e(0xdf)]['redirect_url']};}catch(_0x1e4477){console['error'](_0x23750e(0xd2)),console[_0x23750e(0xa3)]('Error\x20details:',_0x1e4477),loggerService_1[_0x23750e(0x8e)]['logWhiteDomainError']('rapyd',_0x23750e(0x88),_0x1e4477);if(_0x1e4477 instanceof Error){console[_0x23750e(0xa3)](_0x23750e(0xb1),_0x1e4477['message']),console[_0x23750e(0xa3)](_0x23750e(0xa0),_0x1e4477[_0x23750e(0x96)]);throw new Error(_0x23750e(0x95)+_0x1e4477['message']);}throw new Error(_0x23750e(0xaf));}}async[a45_0x181ed8(0x80)](_0xacc656){const _0x5285ed=a45_0x181ed8,_0x59d9a8=Date[_0x5285ed(0xce)]();try{loggerService_1[_0x5285ed(0x8e)][_0x5285ed(0x89)](_0x5285ed(0x92),'/v1/hosted/payment_links/'+_0xacc656,_0x5285ed(0xe8),{});const _0x518aa8=await fetch(this[_0x5285ed(0xc6)]+'/'+_0xacc656,{'method':_0x5285ed(0xe8),'headers':{'Content-Type':'application/json','User-Agent':_0x5285ed(0xd9)}}),_0x429a31=Date[_0x5285ed(0xce)]()-_0x59d9a8;if(!_0x518aa8['ok']){const _0x340379=await _0x518aa8[_0x5285ed(0xe6)]();loggerService_1[_0x5285ed(0x8e)][_0x5285ed(0xe0)](_0x5285ed(0x92),_0x5285ed(0x99)+_0xacc656,_0x518aa8[_0x5285ed(0xd7)],_0x340379,_0x429a31);throw new Error('HTTP\x20error!\x20status:\x20'+_0x518aa8['status']);}const _0x2ffff9=await _0x518aa8['json']();loggerService_1[_0x5285ed(0x8e)][_0x5285ed(0xe0)](_0x5285ed(0x92),_0x5285ed(0x99)+_0xacc656,_0x518aa8[_0x5285ed(0xd7)],_0x2ffff9,_0x429a31);if(_0x2ffff9[_0x5285ed(0xd7)]?.[_0x5285ed(0xd7)]!==_0x5285ed(0xd1)){loggerService_1[_0x5285ed(0x8e)][_0x5285ed(0xa1)](_0x5285ed(0x92),'/v1/hosted/payment_links/'+_0xacc656,_0x5285ed(0xb0)+(_0x2ffff9[_0x5285ed(0xd7)]?.[_0x5285ed(0xa8)]||_0x5285ed(0xa4)));throw new Error(_0x5285ed(0xb0)+(_0x2ffff9[_0x5285ed(0xd7)]?.[_0x5285ed(0xa8)]||_0x5285ed(0xa4)));}let _0x58fb82='PENDING';if(_0x2ffff9['data']?.[_0x5285ed(0xd7)])switch(_0x2ffff9[_0x5285ed(0xdf)][_0x5285ed(0xd7)][_0x5285ed(0x7d)]()){case'CLO':_0x58fb82=_0x5285ed(0xd8);break;case _0x5285ed(0x9b):_0x58fb82=_0x5285ed(0xa5);break;case _0x5285ed(0xdd):_0x58fb82=_0x5285ed(0xde);break;case'ERR':_0x58fb82=_0x5285ed(0xa5);break;case'NEW':case _0x5285ed(0xd4):default:_0x58fb82=_0x5285ed(0xb8);break;}return{'status':_0x58fb82,'amount':_0x2ffff9[_0x5285ed(0xdf)]?.[_0x5285ed(0xc7)],'currency':_0x2ffff9['data']?.['currency']};}catch(_0x25e259){console[_0x5285ed(0xa3)](_0x5285ed(0xd3),_0x25e259),loggerService_1['loggerService']['logWhiteDomainError'](_0x5285ed(0x92),_0x5285ed(0x99)+_0xacc656,_0x25e259);throw new Error(_0x5285ed(0xb7)+(_0x25e259 instanceof Error?_0x25e259[_0x5285ed(0xa8)]:_0x5285ed(0xa4)));}}async['processWebhook'](_0x5f36b5){const _0x2f356f=a45_0x181ed8;console['log'](_0x2f356f(0xc5),_0x5f36b5);let _0x4c091e=_0x2f356f(0xb8),_0x51766d;_0x5f36b5[_0x2f356f(0xdf)]?.[_0x2f356f(0xcb)]&&(_0x51766d=_0x5f36b5['data'][_0x2f356f(0xcb)],console[_0x2f356f(0x84)](_0x2f356f(0xd5)+_0x51766d));switch(_0x5f36b5['type']?.[_0x2f356f(0x7d)]()){case'PAYMENT_COMPLETED':_0x5f36b5['data']?.['paid']===!![]&&_0x5f36b5['data']?.['status']===_0x2f356f(0xb6)?_0x4c091e=_0x2f356f(0xd8):_0x4c091e=_0x2f356f(0xb8);break;case _0x2f356f(0x9e):_0x4c091e=_0x2f356f(0xa5);break;case _0x2f356f(0xb9):_0x4c091e=_0x2f356f(0xde);break;case _0x2f356f(0x9f):_0x4c091e=_0x2f356f(0xa5);!_0x51766d&&_0x5f36b5['data']?.[_0x2f356f(0xcb)]&&(_0x51766d=_0x5f36b5[_0x2f356f(0xdf)]['failure_message']);break;default:switch(_0x5f36b5['data']?.['status']?.[_0x2f356f(0x7d)]()){case _0x2f356f(0xb6):_0x5f36b5[_0x2f356f(0xdf)]?.[_0x2f356f(0x86)]===!![]?_0x4c091e=_0x2f356f(0xd8):_0x4c091e=_0x2f356f(0xa5);break;case _0x2f356f(0x9b):_0x4c091e=_0x2f356f(0xa5);break;case _0x2f356f(0xdd):_0x4c091e='EXPIRED';break;case'ERR':_0x4c091e=_0x2f356f(0xa5);!_0x51766d&&_0x5f36b5[_0x2f356f(0xdf)]?.[_0x2f356f(0xcb)]&&(_0x51766d=_0x5f36b5['data']['failure_message']);break;case _0x2f356f(0xda):case _0x2f356f(0xd4):default:_0x4c091e=_0x2f356f(0xb8);break;}break;}const _0x14b743={};return _0x5f36b5['data']?.['payment_method_data']?.[_0x2f356f(0x82)]&&(_0x14b743['cardLast4']=_0x5f36b5[_0x2f356f(0xdf)][_0x2f356f(0xae)][_0x2f356f(0x82)]),_0x5f36b5[_0x2f356f(0xdf)]?.[_0x2f356f(0x94)]&&(_0x14b743['paymentMethod']=_0x5f36b5[_0x2f356f(0xdf)]['payment_method_type']),_0x5f36b5[_0x2f356f(0xdf)]?.[_0x2f356f(0xbd)]&&(_0x14b743['errorCode']=_0x5f36b5[_0x2f356f(0xdf)][_0x2f356f(0xbd)]),_0x5f36b5['data']?.[_0x2f356f(0xb4)]&&(_0x14b743[_0x2f356f(0x8a)]=_0x5f36b5[_0x2f356f(0xdf)][_0x2f356f(0xb4)]),console[_0x2f356f(0x84)]('🔄\x20Rapyd\x20webhook\x20processed:\x20status='+_0x4c091e+',\x20failureMessage='+(_0x51766d||_0x2f356f(0x93))),{'paymentId':_0x5f36b5[_0x2f356f(0xdf)]?.[_0x2f356f(0x7c)]||'','status':_0x4c091e,'amount':_0x5f36b5[_0x2f356f(0xdf)]?.[_0x2f356f(0xc7)],'currency':_0x5f36b5['data']?.['currency'],'failureMessage':_0x51766d,'additionalInfo':_0x14b743};}}exports[a45_0x181ed8(0x9d)]=RapydService;function a45_0x2745(){const _0x2357c0=['Payment\x20Link\x20ID:','last4','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','log','🇬🇧\x20Country:\x20','paid','Unknown\x20error\x20from\x20Rapyd\x20API','/v1/hosted/payment_links','logWhiteDomainRequest','failureCode','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','gb_mastercard_card','Response\x20Body:','loggerService','18OLPYUY','27500910FxAJvc','gb_visa_card','rapyd','none','payment_method_type','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','stack','Parsed\x20Result:','HTTP\x20error!\x20status:\x20','/v1/hosted/payment_links/','URL:','CAN','headers','RapydService','PAYMENT_CANCELED','PAYMENT_FAILED','Error\x20stack:','logWhiteDomainError','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','error','Unknown\x20error','FAILED','HTTP\x20Status:','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','message','Status:','redirect_url','UNKNOWN','entries','Request\x20Body\x20(Updated\x20Format):','payment_method_data','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Rapyd\x20API\x20error:\x20','Error\x20message:','application/json','9256324IuxfpA','failure_code','statusText','CLO','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','PENDING','PAYMENT_EXPIRED','Response\x20Time:','===\x20RAPYD\x20API\x20ERROR\x20===','__esModule','error_code','POST','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','6888714RUmLlo','571366gOkKSG','23635LWfLgW','🇬🇧\x20Country\x20used:\x20','Processing\x20Rapyd\x20webhook:','apiUrl','amount','Full\x20Error\x20Data:','JSON\x20Parse\x20Error:\x20','../loggerService','failure_message','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Raw\x20Response\x20Body:','now','ORDER:\x20','createPaymentLink','SUCCESS','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Rapyd\x20payment\x20verification\x20error:','ACT','💥\x20Rapyd\x20failure\x20message:\x20','===\x20RAPYD\x20SUCCESS\x20===','status','PAID','TesSoft\x20Payment\x20System/1.0','NEW','9904ZAWLVs','https://tesoft.uk/gateway/success.php?id=','EXP','EXPIRED','data','logWhiteDomainResponse','):\x20','Rapyd\x20API\x20error\x20(','6354UUzPkz',',\x20body:\x20','fromEntries','text','1088LQjgmz','GET','Status\x20Text:','stringify','defineProperty','https://tesoft.uk/gateway/rapyd/','\x20(always\x20GB\x20for\x20Rapyd)','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20','Headers:','merchant_reference_id','toUpperCase','1267828mZQsHe','Error\x20Message:','verifyPayment'];a45_0x2745=function(){return _0x2357c0;};return a45_0x2745();}