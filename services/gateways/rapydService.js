'use strict';function a46_0x5ba4(){const _0x4e7e20=['HTTP\x20','JSON\x20Parse\x20Error:\x20','ERR','10344oLnhYb',',\x20failureMessage=','EXP','ORDER:\x20','EXPIRED','amount','Business\x20Error\x20(','/v1/hosted/payment_links/','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Payment\x20Link\x20ID:','https://tesoft.uk/gateway/rapyd/','error','paymentMethod','failure_message','HTTP\x20error!\x20status:\x20','):\x20','\x20(always\x20GB\x20for\x20Rapyd)','json','Error\x20message:','PAYMENT_FAILED','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','URL:','https://tesoft.uk/gateway/fail.php?id=',',\x20body:\x20','3325Czmjiv','headers','üí•\x20Rapyd\x20failure\x20message:\x20','verifyPayment','UNKNOWN','Rapyd\x20API\x20error:\x20','stringify','277542YLCpvD','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20stack:','1019151Xvjbul','CAN','Status\x20Text:','Error\x20Message:','Request\x20Body\x20(Updated\x20Format):','Full\x20Error\x20Data:','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','\x20(GB\x20-\x20Britain)','__esModule','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','5092kYGEds','logWhiteDomainError','last4','defineProperty','Status:','https://tesoft.uk/gateway/success.php?id=','üá¨üáß\x20Country:\x20','none','createPaymentLink','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','entries','paid','Error\x20Code:','ACT','===\x20RAPYD\x20API\x20ERROR\x20===','data','/v1/hosted/payment_links','log','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','367821sxEZfN','toUpperCase','Rapyd\x20payment\x20verification\x20error:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','statusText','gb_visa_card','RapydService','message','Processing\x20Rapyd\x20webhook:','üá¨üáß\x20Country\x20used:\x20','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','merchant_reference_id','NEW','application/json','text','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','status','failure_code','payment_method_data','CLO','Raw\x20Response\x20Body:','Error\x20details:','type','GET','gb_mastercard_card','PAID','1195046pMUiuQ','logWhiteDomainResponse','loggerService','SUCCESS','TesSoft\x20Payment\x20System/1.0','POST','now','PAYMENT_EXPIRED','2779LagvBP','logWhiteDomainRequest','apiUrl','stack','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','parse','FAILED','rapyd','redirect_url','PENDING','payment_method_type','error_code','processWebhook','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','484134EOWVIG','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','cardLast4','Unknown\x20error'];a46_0x5ba4=function(){return _0x4e7e20;};return a46_0x5ba4();}const a46_0x49a7c1=a46_0x37fa;(function(_0x397598,_0x422999){const _0x34c696=a46_0x37fa,_0x3839bf=_0x397598();while(!![]){try{const _0x3d64c8=-parseInt(_0x34c696(0x157))/0x1+-parseInt(_0x34c696(0x141))/0x2+parseInt(_0x34c696(0x10a))/0x3+parseInt(_0x34c696(0x114))/0x4*(parseInt(_0x34c696(0x100))/0x5)+parseInt(_0x34c696(0x107))/0x6+-parseInt(_0x34c696(0x149))/0x7*(-parseInt(_0x34c696(0x15e))/0x8)+-parseInt(_0x34c696(0x127))/0x9;if(_0x3d64c8===_0x422999)break;else _0x3839bf['push'](_0x3839bf['shift']());}catch(_0x2ce1dc){_0x3839bf['push'](_0x3839bf['shift']());}}}(a46_0x5ba4,0x982d2));Object[a46_0x49a7c1(0x117)](exports,a46_0x49a7c1(0x112),{'value':!![]}),exports[a46_0x49a7c1(0x12d)]=void 0x0;const loggerService_1=require('../loggerService');function a46_0x37fa(_0x25f212,_0x1392be){const _0x5ba499=a46_0x5ba4();return a46_0x37fa=function(_0x37fae5,_0x1874f7){_0x37fae5=_0x37fae5-0xfd;let _0x4ca53b=_0x5ba499[_0x37fae5];return _0x4ca53b;},a46_0x37fa(_0x25f212,_0x1392be);}class RapydService{constructor(){const _0x4f9363=a46_0x49a7c1;this[_0x4f9363(0x14b)]=_0x4f9363(0x168),console[_0x4f9363(0x125)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a46_0x49a7c1(0x11c)](_0xb57e5d){const _0x14a64a=a46_0x49a7c1,{orderId:_0x278f36,orderName:_0x23318b,amount:_0x254537,currency:_0x4ea81d,usage:_0x4fd0ff,maxPayments:_0x14e108,successUrl:_0x1ea84a,failUrl:_0x533fe2}=_0xb57e5d,_0x369101=_0x4ea81d['toUpperCase'](),_0x3db04e='GB';console['log'](_0x14a64a(0x172));const _0x2fe755=_0x14a64a(0x119)+_0x278f36,_0x53bfde=_0x14a64a(0xfe)+_0x278f36,_0x5c4951={'amount':_0x254537,'currency':_0x369101,'cancel_checkout_url':_0x53bfde,'complete_checkout_url':_0x2fe755,'complete_payment_url':_0x2fe755,'merchant_reference_id':_0x278f36,'description':_0x14a64a(0x161)+_0x278f36,'country':'GB','payment_method_types_include':[_0x14a64a(0x12c),_0x14a64a(0x13f)],'custom_elements':{'display_description':!![]}},_0x3e445a=Date[_0x14a64a(0x147)]();try{console[_0x14a64a(0x125)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x14a64a(0x125)](_0x14a64a(0xfd),this['apiUrl']),console[_0x14a64a(0x125)](_0x14a64a(0x10e),JSON['stringify'](_0x5c4951,null,0x2)),console[_0x14a64a(0x125)](_0x14a64a(0x11a)+_0x3db04e+_0x14a64a(0x16e)),console[_0x14a64a(0x125)](_0x14a64a(0x126)),loggerService_1[_0x14a64a(0x143)][_0x14a64a(0x14a)](_0x14a64a(0x150),_0x14a64a(0x124),_0x14a64a(0x146),_0x5c4951);const _0x6489e0=await fetch(this[_0x14a64a(0x14b)],{'method':_0x14a64a(0x146),'headers':{'Content-Type':_0x14a64a(0x134),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x5c4951)}),_0x180d0e=Date[_0x14a64a(0x147)]()-_0x3e445a;console['log'](_0x14a64a(0x156)),console['log'](_0x14a64a(0x118),_0x6489e0['status']),console['log'](_0x14a64a(0x10c),_0x6489e0[_0x14a64a(0x12b)]),console['log']('Headers:',Object['fromEntries'](_0x6489e0[_0x14a64a(0x101)][_0x14a64a(0x11e)]())),console[_0x14a64a(0x125)]('Response\x20Time:',_0x180d0e+'ms');const _0x5d3634=await _0x6489e0[_0x14a64a(0x135)]();console['log'](_0x14a64a(0x13b),_0x5d3634);if(!_0x6489e0['ok']){console[_0x14a64a(0x169)](_0x14a64a(0x122)),console[_0x14a64a(0x169)]('HTTP\x20Status:',_0x6489e0[_0x14a64a(0x137)]),console[_0x14a64a(0x169)]('Response\x20Body:',_0x5d3634),loggerService_1[_0x14a64a(0x143)][_0x14a64a(0x142)](_0x14a64a(0x150),_0x14a64a(0x124),_0x6489e0[_0x14a64a(0x137)],_0x5d3634,_0x180d0e),loggerService_1[_0x14a64a(0x143)][_0x14a64a(0x115)]('rapyd',_0x14a64a(0x124),_0x14a64a(0x15b)+_0x6489e0[_0x14a64a(0x137)]+':\x20'+_0x5d3634);throw new Error('HTTP\x20error!\x20status:\x20'+_0x6489e0[_0x14a64a(0x137)]+_0x14a64a(0xff)+_0x5d3634);}let _0x2fbf66;try{_0x2fbf66=JSON[_0x14a64a(0x14e)](_0x5d3634);}catch(_0x3fdbbf){console['error'](_0x14a64a(0x108),_0x3fdbbf),loggerService_1[_0x14a64a(0x143)][_0x14a64a(0x115)](_0x14a64a(0x150),'/v1/hosted/payment_links',_0x14a64a(0x15c)+_0x3fdbbf);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x5d3634);}console[_0x14a64a(0x125)](_0x14a64a(0x131)),console[_0x14a64a(0x125)]('Parsed\x20Result:',JSON[_0x14a64a(0x106)](_0x2fbf66,null,0x2)),loggerService_1[_0x14a64a(0x143)][_0x14a64a(0x142)]('rapyd',_0x14a64a(0x124),_0x6489e0['status'],_0x2fbf66,_0x180d0e);if(_0x2fbf66[_0x14a64a(0x137)]?.[_0x14a64a(0x137)]!==_0x14a64a(0x144)){const _0x1b9ae5=_0x2fbf66[_0x14a64a(0x137)]?.[_0x14a64a(0x12e)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x14f6c6=_0x2fbf66[_0x14a64a(0x137)]?.[_0x14a64a(0x154)]||_0x14a64a(0x104);console[_0x14a64a(0x169)](_0x14a64a(0x14d)),console[_0x14a64a(0x169)](_0x14a64a(0x120),_0x14f6c6),console[_0x14a64a(0x169)](_0x14a64a(0x10d),_0x1b9ae5),console[_0x14a64a(0x169)](_0x14a64a(0x10f),_0x2fbf66['status']),loggerService_1['loggerService'][_0x14a64a(0x115)]('rapyd',_0x14a64a(0x124),_0x14a64a(0x164)+_0x14f6c6+_0x14a64a(0x16d)+_0x1b9ae5);throw new Error('Rapyd\x20API\x20error\x20('+_0x14f6c6+'):\x20'+_0x1b9ae5);}if(!_0x2fbf66[_0x14a64a(0x123)]?.['id']||!_0x2fbf66[_0x14a64a(0x123)]?.[_0x14a64a(0x151)]){console['error'](_0x14a64a(0x11d)),console['error'](_0x14a64a(0x166)),console[_0x14a64a(0x169)]('Response\x20data:',_0x2fbf66[_0x14a64a(0x123)]),loggerService_1[_0x14a64a(0x143)]['logWhiteDomainError']('rapyd',_0x14a64a(0x124),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x14a64a(0x136));}return console[_0x14a64a(0x125)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x14a64a(0x125)](_0x14a64a(0x167),_0x2fbf66[_0x14a64a(0x123)]['id']),console[_0x14a64a(0x125)]('Redirect\x20URL:',_0x2fbf66[_0x14a64a(0x123)][_0x14a64a(0x151)]),console[_0x14a64a(0x125)](_0x14a64a(0x130)+_0x3db04e+_0x14a64a(0x111)),console[_0x14a64a(0x125)](_0x14a64a(0x126)),{'gateway_payment_id':_0x2fbf66[_0x14a64a(0x123)]['id'],'payment_url':_0x2fbf66[_0x14a64a(0x123)][_0x14a64a(0x151)]};}catch(_0x448a77){console[_0x14a64a(0x169)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x14a64a(0x169)](_0x14a64a(0x13c),_0x448a77),loggerService_1['loggerService']['logWhiteDomainError']('rapyd','/v1/hosted/payment_links',_0x448a77);if(_0x448a77 instanceof Error){console['error'](_0x14a64a(0x170),_0x448a77[_0x14a64a(0x12e)]),console[_0x14a64a(0x169)](_0x14a64a(0x109),_0x448a77[_0x14a64a(0x14c)]);throw new Error(_0x14a64a(0x158)+_0x448a77['message']);}throw new Error(_0x14a64a(0x113));}}async[a46_0x49a7c1(0x103)](_0x1037f7){const _0x5220d9=a46_0x49a7c1,_0x5ebabf=Date[_0x5220d9(0x147)]();try{loggerService_1[_0x5220d9(0x143)]['logWhiteDomainRequest'](_0x5220d9(0x150),_0x5220d9(0x165)+_0x1037f7,'GET',{});const _0x207e48=await fetch(this['apiUrl']+'/'+_0x1037f7,{'method':_0x5220d9(0x13e),'headers':{'Content-Type':_0x5220d9(0x134),'User-Agent':_0x5220d9(0x145)}}),_0x1abb71=Date['now']()-_0x5ebabf;if(!_0x207e48['ok']){const _0x406437=await _0x207e48[_0x5220d9(0x135)]();loggerService_1[_0x5220d9(0x143)]['logWhiteDomainResponse'](_0x5220d9(0x150),_0x5220d9(0x165)+_0x1037f7,_0x207e48['status'],_0x406437,_0x1abb71);throw new Error(_0x5220d9(0x16c)+_0x207e48[_0x5220d9(0x137)]);}const _0x54ee19=await _0x207e48[_0x5220d9(0x16f)]();loggerService_1[_0x5220d9(0x143)][_0x5220d9(0x142)](_0x5220d9(0x150),_0x5220d9(0x165)+_0x1037f7,_0x207e48[_0x5220d9(0x137)],_0x54ee19,_0x1abb71);if(_0x54ee19[_0x5220d9(0x137)]?.[_0x5220d9(0x137)]!=='SUCCESS'){loggerService_1[_0x5220d9(0x143)]['logWhiteDomainError'](_0x5220d9(0x150),'/v1/hosted/payment_links/'+_0x1037f7,_0x5220d9(0x105)+(_0x54ee19[_0x5220d9(0x137)]?.[_0x5220d9(0x12e)]||_0x5220d9(0x15a)));throw new Error(_0x5220d9(0x105)+(_0x54ee19[_0x5220d9(0x137)]?.[_0x5220d9(0x12e)]||_0x5220d9(0x15a)));}let _0x56d00c=_0x5220d9(0x152);if(_0x54ee19[_0x5220d9(0x123)]?.[_0x5220d9(0x137)])switch(_0x54ee19[_0x5220d9(0x123)][_0x5220d9(0x137)][_0x5220d9(0x128)]()){case _0x5220d9(0x13a):_0x56d00c=_0x5220d9(0x140);break;case _0x5220d9(0x10b):_0x56d00c=_0x5220d9(0x14f);break;case'EXP':_0x56d00c=_0x5220d9(0x162);break;case _0x5220d9(0x15d):_0x56d00c=_0x5220d9(0x14f);break;case'NEW':case _0x5220d9(0x121):default:_0x56d00c='PENDING';break;}return{'status':_0x56d00c,'amount':_0x54ee19[_0x5220d9(0x123)]?.[_0x5220d9(0x163)],'currency':_0x54ee19['data']?.['currency']};}catch(_0x3ea336){console['error'](_0x5220d9(0x129),_0x3ea336),loggerService_1['loggerService'][_0x5220d9(0x115)](_0x5220d9(0x150),'/v1/hosted/payment_links/'+_0x1037f7,_0x3ea336);throw new Error(_0x5220d9(0x12a)+(_0x3ea336 instanceof Error?_0x3ea336[_0x5220d9(0x12e)]:_0x5220d9(0x15a)));}}async[a46_0x49a7c1(0x155)](_0x42d7ad){const _0x77194e=a46_0x49a7c1;console['log'](_0x77194e(0x12f),_0x42d7ad);let _0x10129='PENDING',_0x58ea3f;_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x16b)]&&(_0x58ea3f=_0x42d7ad['data'][_0x77194e(0x16b)],console[_0x77194e(0x125)](_0x77194e(0x102)+_0x58ea3f));switch(_0x42d7ad[_0x77194e(0x13d)]?.[_0x77194e(0x128)]()){case'PAYMENT_COMPLETED':_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x11f)]===!![]&&_0x42d7ad[_0x77194e(0x123)]?.['status']===_0x77194e(0x13a)?_0x10129=_0x77194e(0x140):_0x10129='PENDING';break;case'PAYMENT_CANCELED':_0x10129=_0x77194e(0x14f);break;case _0x77194e(0x148):_0x10129='EXPIRED';break;case _0x77194e(0x171):_0x10129=_0x77194e(0x14f);!_0x58ea3f&&_0x42d7ad['data']?.[_0x77194e(0x16b)]&&(_0x58ea3f=_0x42d7ad[_0x77194e(0x123)][_0x77194e(0x16b)]);break;default:switch(_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x137)]?.[_0x77194e(0x128)]()){case'CLO':_0x42d7ad['data']?.[_0x77194e(0x11f)]===!![]?_0x10129='PAID':_0x10129=_0x77194e(0x14f);break;case _0x77194e(0x10b):_0x10129=_0x77194e(0x14f);break;case _0x77194e(0x160):_0x10129=_0x77194e(0x162);break;case _0x77194e(0x15d):_0x10129=_0x77194e(0x14f);!_0x58ea3f&&_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x16b)]&&(_0x58ea3f=_0x42d7ad[_0x77194e(0x123)]['failure_message']);break;case _0x77194e(0x133):case _0x77194e(0x121):default:_0x10129=_0x77194e(0x152);break;}break;}const _0x4318f2={};return _0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x139)]?.[_0x77194e(0x116)]&&(_0x4318f2[_0x77194e(0x159)]=_0x42d7ad['data'][_0x77194e(0x139)][_0x77194e(0x116)]),_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x153)]&&(_0x4318f2[_0x77194e(0x16a)]=_0x42d7ad[_0x77194e(0x123)]['payment_method_type']),_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x154)]&&(_0x4318f2['errorCode']=_0x42d7ad['data'][_0x77194e(0x154)]),_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x138)]&&(_0x4318f2['failureCode']=_0x42d7ad['data'][_0x77194e(0x138)]),console[_0x77194e(0x125)](_0x77194e(0x110)+_0x10129+_0x77194e(0x15f)+(_0x58ea3f||_0x77194e(0x11b))),{'paymentId':_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x132)]||'','status':_0x10129,'amount':_0x42d7ad[_0x77194e(0x123)]?.[_0x77194e(0x163)],'currency':_0x42d7ad['data']?.['currency'],'failureMessage':_0x58ea3f,'additionalInfo':_0x4318f2};}}exports['RapydService']=RapydService;