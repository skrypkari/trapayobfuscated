'use strict';const a46_0x15433d=a46_0x570c;function a46_0x3b07(){const _0x3a8ee5=['last4','paid','gb_visa_card',',\x20body:\x20','data','Error\x20details:','üí•\x20Rapyd\x20failure\x20message:\x20','TesSoft\x20Payment\x20System/1.0','statusText',',\x20failureMessage=','528327mOAENh','message','üá¨üáß\x20Country\x20used:\x20','Status\x20Text:','toUpperCase','):\x20','Full\x20Error\x20Data:','NEW','redirect_url','HTTP\x20error!\x20status:\x20','EXPIRED','payment_method_type','Error\x20message:','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','https://tesoft.uk/gateway/success.php?id=','Error\x20Code:','createPaymentLink','CLO','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','/v1/hosted/payment_links/','POST','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','ACT','loggerService','failure_code','Unknown\x20error','stringify','GET','210920jcdMuM','HTTP\x20Status:','failure_message','Response\x20Time:','Rapyd\x20API\x20error\x20(','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','logWhiteDomainError','../loggerService','now','verifyPayment','payment_method_data','application/json','errorCode','log','/v1/hosted/payment_links','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','10467dHNuYm','Processing\x20Rapyd\x20webhook:','status','rapyd','entries','PAYMENT_COMPLETED','üá¨üáß\x20Country:\x20','Error\x20Message:','Request\x20Body\x20(Updated\x20Format):','logWhiteDomainRequest','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Missing\x20id\x20or\x20redirect_url\x20in\x20response','RapydService','https://tesoft.uk/gateway/fail.php?id=','PENDING','PAID','merchant_reference_id','1025980iVVgdk','logWhiteDomainResponse','HTTP\x20','CAN','headers','FAILED','EXP','===\x20RAPYD\x20SUCCESS\x20===','parse','\x20(GB\x20-\x20Britain)','currency','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','paymentMethod','Response\x20data:','apiUrl','Error\x20stack:','Parsed\x20Result:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','gb_mastercard_card','json','text','Unknown\x20error\x20from\x20Rapyd\x20API','Business\x20Error\x20(','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','ERR','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','__esModule','1999330tWNXWL','Rapyd\x20API\x20error:\x20','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Raw\x20Response\x20Body:','14DTSZGu','error_code','PAYMENT_CANCELED','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','388400gSZXUi','1705158XGrYgi','fromEntries','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','error','amount','\x20(always\x20GB\x20for\x20Rapyd)','ORDER:\x20','6KXrESk','URL:','9lMvptC'];a46_0x3b07=function(){return _0x3a8ee5;};return a46_0x3b07();}function a46_0x570c(_0xbc0d98,_0x3517cc){const _0x3b0746=a46_0x3b07();return a46_0x570c=function(_0x570c1c,_0x310e18){_0x570c1c=_0x570c1c-0x10a;let _0x50337e=_0x3b0746[_0x570c1c];return _0x50337e;},a46_0x570c(_0xbc0d98,_0x3517cc);}(function(_0x4dac63,_0x21009c){const _0xd48fe0=a46_0x570c,_0x3b10cd=_0x4dac63();while(!![]){try{const _0x4adfe7=parseInt(_0xd48fe0(0x165))/0x1*(parseInt(_0xd48fe0(0x120))/0x2)+parseInt(_0xd48fe0(0x139))/0x3+-parseInt(_0xd48fe0(0x176))/0x4+parseInt(_0xd48fe0(0x124))/0x5*(parseInt(_0xd48fe0(0x12c))/0x6)+parseInt(_0xd48fe0(0x125))/0x7+parseInt(_0xd48fe0(0x155))/0x8*(parseInt(_0xd48fe0(0x12e))/0x9)+-parseInt(_0xd48fe0(0x11c))/0xa;if(_0x4adfe7===_0x21009c)break;else _0x3b10cd['push'](_0x3b10cd['shift']());}catch(_0x5ccb7d){_0x3b10cd['push'](_0x3b10cd['shift']());}}}(a46_0x3b07,0x2252d));Object['defineProperty'](exports,a46_0x15433d(0x11b),{'value':!![]}),exports[a46_0x15433d(0x171)]=void 0x0;const loggerService_1=require(a46_0x15433d(0x15c));class RapydService{constructor(){const _0x50c593=a46_0x15433d;this[_0x50c593(0x10e)]='https://tesoft.uk/gateway/rapyd/',console[_0x50c593(0x162)](_0x50c593(0x11a));}async[a46_0x15433d(0x149)](_0x5e9f68){const _0x247203=a46_0x15433d,{orderId:_0x2b1d0f,orderName:_0x3abebc,amount:_0x28bd76,currency:_0x37e5d6,usage:_0x4c7817,maxPayments:_0x396600,successUrl:_0x437cf6,failUrl:_0x14545}=_0x5e9f68,_0x439a25=_0x37e5d6[_0x247203(0x13d)](),_0x4f8359='GB';console['log'](_0x247203(0x123));const _0x5c8f76=_0x247203(0x147)+_0x2b1d0f,_0x15251f=_0x247203(0x172)+_0x2b1d0f,_0x4185cc={'amount':_0x28bd76,'currency':_0x439a25,'cancel_checkout_url':_0x15251f,'complete_checkout_url':_0x5c8f76,'complete_payment_url':_0x5c8f76,'merchant_reference_id':_0x2b1d0f,'description':_0x247203(0x12b)+_0x2b1d0f,'country':'GB','payment_method_types_include':[_0x247203(0x131),_0x247203(0x112)],'custom_elements':{'display_description':!![]}},_0x3f108d=Date[_0x247203(0x15d)]();try{console[_0x247203(0x162)](_0x247203(0x14e)),console[_0x247203(0x162)](_0x247203(0x12d),this[_0x247203(0x10e)]),console[_0x247203(0x162)](_0x247203(0x16d),JSON[_0x247203(0x153)](_0x4185cc,null,0x2)),console[_0x247203(0x162)](_0x247203(0x16b)+_0x4f8359+_0x247203(0x12a)),console[_0x247203(0x162)](_0x247203(0x15a)),loggerService_1[_0x247203(0x150)]['logWhiteDomainRequest'](_0x247203(0x168),_0x247203(0x163),_0x247203(0x14d),_0x4185cc);const _0x558325=await fetch(this['apiUrl'],{'method':_0x247203(0x14d),'headers':{'Content-Type':_0x247203(0x160),'User-Agent':_0x247203(0x136)},'body':JSON[_0x247203(0x153)](_0x4185cc)}),_0x4b53a3=Date['now']()-_0x3f108d;console[_0x247203(0x162)](_0x247203(0x111)),console[_0x247203(0x162)]('Status:',_0x558325[_0x247203(0x167)]),console[_0x247203(0x162)](_0x247203(0x13c),_0x558325[_0x247203(0x137)]),console[_0x247203(0x162)]('Headers:',Object[_0x247203(0x126)](_0x558325[_0x247203(0x17a)][_0x247203(0x169)]())),console[_0x247203(0x162)](_0x247203(0x158),_0x4b53a3+'ms');const _0x3aff30=await _0x558325[_0x247203(0x114)]();console[_0x247203(0x162)](_0x247203(0x11f),_0x3aff30);if(!_0x558325['ok']){console[_0x247203(0x128)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x247203(0x128)](_0x247203(0x156),_0x558325[_0x247203(0x167)]),console['error']('Response\x20Body:',_0x3aff30),loggerService_1[_0x247203(0x150)]['logWhiteDomainResponse'](_0x247203(0x168),_0x247203(0x163),_0x558325[_0x247203(0x167)],_0x3aff30,_0x4b53a3),loggerService_1[_0x247203(0x150)][_0x247203(0x15b)]('rapyd',_0x247203(0x163),_0x247203(0x178)+_0x558325[_0x247203(0x167)]+':\x20'+_0x3aff30);throw new Error(_0x247203(0x142)+_0x558325[_0x247203(0x167)]+_0x247203(0x132)+_0x3aff30);}let _0xe1a49c;try{_0xe1a49c=JSON[_0x247203(0x17e)](_0x3aff30);}catch(_0x3dca18){console['error'](_0x247203(0x117),_0x3dca18),loggerService_1[_0x247203(0x150)]['logWhiteDomainError'](_0x247203(0x168),_0x247203(0x163),'JSON\x20Parse\x20Error:\x20'+_0x3dca18);throw new Error(_0x247203(0x14b)+_0x3aff30);}console[_0x247203(0x162)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x247203(0x162)](_0x247203(0x110),JSON[_0x247203(0x153)](_0xe1a49c,null,0x2)),loggerService_1['loggerService'][_0x247203(0x177)](_0x247203(0x168),_0x247203(0x163),_0x558325[_0x247203(0x167)],_0xe1a49c,_0x4b53a3);if(_0xe1a49c[_0x247203(0x167)]?.[_0x247203(0x167)]!=='SUCCESS'){const _0xc047fb=_0xe1a49c[_0x247203(0x167)]?.[_0x247203(0x13a)]||_0x247203(0x115),_0x70585d=_0xe1a49c['status']?.[_0x247203(0x121)]||'UNKNOWN';console[_0x247203(0x128)](_0x247203(0x16f)),console['error'](_0x247203(0x148),_0x70585d),console[_0x247203(0x128)](_0x247203(0x16c),_0xc047fb),console[_0x247203(0x128)](_0x247203(0x13f),_0xe1a49c['status']),loggerService_1[_0x247203(0x150)][_0x247203(0x15b)](_0x247203(0x168),_0x247203(0x163),_0x247203(0x116)+_0x70585d+_0x247203(0x13e)+_0xc047fb);throw new Error(_0x247203(0x159)+_0x70585d+'):\x20'+_0xc047fb);}if(!_0xe1a49c['data']?.['id']||!_0xe1a49c[_0x247203(0x133)]?.['redirect_url']){console[_0x247203(0x128)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x247203(0x128)](_0x247203(0x170)),console[_0x247203(0x128)](_0x247203(0x10d),_0xe1a49c[_0x247203(0x133)]),loggerService_1[_0x247203(0x150)][_0x247203(0x15b)](_0x247203(0x168),_0x247203(0x163),_0x247203(0x10b));throw new Error(_0x247203(0x11e));}return console['log'](_0x247203(0x17d)),console[_0x247203(0x162)]('Payment\x20Link\x20ID:',_0xe1a49c[_0x247203(0x133)]['id']),console[_0x247203(0x162)]('Redirect\x20URL:',_0xe1a49c[_0x247203(0x133)][_0x247203(0x141)]),console[_0x247203(0x162)](_0x247203(0x13b)+_0x4f8359+_0x247203(0x17f)),console['log'](_0x247203(0x15a)),{'gateway_payment_id':_0xe1a49c['data']['id'],'payment_url':_0xe1a49c[_0x247203(0x133)][_0x247203(0x141)]};}catch(_0x481071){console[_0x247203(0x128)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x247203(0x128)](_0x247203(0x134),_0x481071),loggerService_1[_0x247203(0x150)]['logWhiteDomainError'](_0x247203(0x168),_0x247203(0x163),_0x481071);if(_0x481071 instanceof Error){console['error'](_0x247203(0x145),_0x481071[_0x247203(0x13a)]),console[_0x247203(0x128)](_0x247203(0x10f),_0x481071['stack']);throw new Error(_0x247203(0x127)+_0x481071['message']);}throw new Error(_0x247203(0x164));}}async[a46_0x15433d(0x15e)](_0x559b45){const _0x562e5e=a46_0x15433d,_0x1736ca=Date['now']();try{loggerService_1['loggerService'][_0x562e5e(0x16e)]('rapyd','/v1/hosted/payment_links/'+_0x559b45,'GET',{});const _0x33e74d=await fetch(this[_0x562e5e(0x10e)]+'/'+_0x559b45,{'method':_0x562e5e(0x154),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x235599=Date[_0x562e5e(0x15d)]()-_0x1736ca;if(!_0x33e74d['ok']){const _0x7095e1=await _0x33e74d[_0x562e5e(0x114)]();loggerService_1['loggerService'][_0x562e5e(0x177)]('rapyd','/v1/hosted/payment_links/'+_0x559b45,_0x33e74d[_0x562e5e(0x167)],_0x7095e1,_0x235599);throw new Error(_0x562e5e(0x142)+_0x33e74d['status']);}const _0xa17b91=await _0x33e74d[_0x562e5e(0x113)]();loggerService_1[_0x562e5e(0x150)][_0x562e5e(0x177)](_0x562e5e(0x168),'/v1/hosted/payment_links/'+_0x559b45,_0x33e74d['status'],_0xa17b91,_0x235599);if(_0xa17b91[_0x562e5e(0x167)]?.['status']!=='SUCCESS'){loggerService_1['loggerService'][_0x562e5e(0x15b)](_0x562e5e(0x168),_0x562e5e(0x14c)+_0x559b45,'Rapyd\x20API\x20error:\x20'+(_0xa17b91[_0x562e5e(0x167)]?.[_0x562e5e(0x13a)]||_0x562e5e(0x152)));throw new Error(_0x562e5e(0x11d)+(_0xa17b91[_0x562e5e(0x167)]?.[_0x562e5e(0x13a)]||_0x562e5e(0x152)));}let _0xc89cf8=_0x562e5e(0x173);if(_0xa17b91['data']?.[_0x562e5e(0x167)])switch(_0xa17b91[_0x562e5e(0x133)]['status'][_0x562e5e(0x13d)]()){case _0x562e5e(0x14a):_0xc89cf8=_0x562e5e(0x174);break;case _0x562e5e(0x179):_0xc89cf8=_0x562e5e(0x17b);break;case _0x562e5e(0x17c):_0xc89cf8='EXPIRED';break;case'ERR':_0xc89cf8=_0x562e5e(0x17b);break;case _0x562e5e(0x140):case _0x562e5e(0x14f):default:_0xc89cf8=_0x562e5e(0x173);break;}return{'status':_0xc89cf8,'amount':_0xa17b91['data']?.[_0x562e5e(0x129)],'currency':_0xa17b91[_0x562e5e(0x133)]?.['currency']};}catch(_0x572b90){console[_0x562e5e(0x128)]('Rapyd\x20payment\x20verification\x20error:',_0x572b90),loggerService_1[_0x562e5e(0x150)][_0x562e5e(0x15b)]('rapyd',_0x562e5e(0x14c)+_0x559b45,_0x572b90);throw new Error(_0x562e5e(0x118)+(_0x572b90 instanceof Error?_0x572b90[_0x562e5e(0x13a)]:'Unknown\x20error'));}}async['processWebhook'](_0x278845){const _0x4d4927=a46_0x15433d;console[_0x4d4927(0x162)](_0x4d4927(0x166),_0x278845);let _0x53d4e3=_0x4d4927(0x173),_0x1ad51f;_0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x157)]&&(_0x1ad51f=_0x278845[_0x4d4927(0x133)]['failure_message'],console[_0x4d4927(0x162)](_0x4d4927(0x135)+_0x1ad51f));switch(_0x278845['type']?.[_0x4d4927(0x13d)]()){case _0x4d4927(0x16a):_0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x130)]===!![]&&_0x278845['data']?.[_0x4d4927(0x167)]===_0x4d4927(0x14a)?_0x53d4e3=_0x4d4927(0x174):_0x53d4e3=_0x4d4927(0x173);break;case _0x4d4927(0x122):_0x53d4e3=_0x4d4927(0x17b);break;case'PAYMENT_EXPIRED':_0x53d4e3='EXPIRED';break;case'PAYMENT_FAILED':_0x53d4e3=_0x4d4927(0x17b);!_0x1ad51f&&_0x278845[_0x4d4927(0x133)]?.['failure_message']&&(_0x1ad51f=_0x278845[_0x4d4927(0x133)]['failure_message']);break;default:switch(_0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x167)]?.[_0x4d4927(0x13d)]()){case'CLO':_0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x130)]===!![]?_0x53d4e3=_0x4d4927(0x174):_0x53d4e3=_0x4d4927(0x17b);break;case'CAN':_0x53d4e3=_0x4d4927(0x17b);break;case _0x4d4927(0x17c):_0x53d4e3=_0x4d4927(0x143);break;case _0x4d4927(0x119):_0x53d4e3=_0x4d4927(0x17b);!_0x1ad51f&&_0x278845[_0x4d4927(0x133)]?.['failure_message']&&(_0x1ad51f=_0x278845[_0x4d4927(0x133)][_0x4d4927(0x157)]);break;case _0x4d4927(0x140):case _0x4d4927(0x14f):default:_0x53d4e3='PENDING';break;}break;}const _0x1a2cf5={};return _0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x15f)]?.[_0x4d4927(0x12f)]&&(_0x1a2cf5['cardLast4']=_0x278845['data']['payment_method_data']['last4']),_0x278845[_0x4d4927(0x133)]?.['payment_method_type']&&(_0x1a2cf5[_0x4d4927(0x10c)]=_0x278845['data'][_0x4d4927(0x144)]),_0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x121)]&&(_0x1a2cf5[_0x4d4927(0x161)]=_0x278845[_0x4d4927(0x133)][_0x4d4927(0x121)]),_0x278845[_0x4d4927(0x133)]?.['failure_code']&&(_0x1a2cf5['failureCode']=_0x278845[_0x4d4927(0x133)][_0x4d4927(0x151)]),console[_0x4d4927(0x162)](_0x4d4927(0x146)+_0x53d4e3+_0x4d4927(0x138)+(_0x1ad51f||'none')),{'paymentId':_0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x175)]||'','status':_0x53d4e3,'amount':_0x278845[_0x4d4927(0x133)]?.['amount'],'currency':_0x278845[_0x4d4927(0x133)]?.[_0x4d4927(0x10a)],'failureMessage':_0x1ad51f,'additionalInfo':_0x1a2cf5};}}exports[a46_0x15433d(0x171)]=RapydService;