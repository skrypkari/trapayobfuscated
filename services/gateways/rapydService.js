'use strict';const a63_0x20a930=a63_0x32bc;function a63_0x194e(){const _0x2f36d=['FAILED','/v1/hosted/payment_links/','type','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','JSON\x20Parse\x20Error:\x20','last4','parse','https://tesoft.uk/gateway/fail.php?id=','):\x20','gb_mastercard_card','merchant_reference_id','2029416QVqpMI','ðŸŒ\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PAYMENT_FAILED','Error\x20Code:','fromEntries','status','ðŸ‡¬ðŸ‡§\x20Country:\x20','logWhiteDomainRequest','253832SIxpmD','Response\x20data:','Error\x20details:','headers','processWebhook','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','payment_method_type','===\x20RAPYD\x20SUCCESS\x20===','SUCCESS','fixed_side','entries','ACT','Processing\x20Rapyd\x20webhook:','===\x20RAPYD\x20API\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','log','buy','none','data','\x20->\x20EUR:','UNKNOWN','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','ðŸ”„\x20Rapyd\x20webhook\x20processed:\x20status=','GET','1405065hHcyYs','\x20\x20\x20expiration:\x20','EXP','https://tesoft.uk/gateway/rapyd/','defineProperty','payment_method_data','logWhiteDomainError','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20Text:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','ðŸ’¥\x20Rapyd\x20failure\x20message:\x20','POST','redirect_url','/v1/hosted/payment_links','\x20(GB\x20-\x20Britain)','ðŸ’³\x20Adding\x20cardholder\x20name:\x20','Headers:','https://tesoft.uk/gateway/success.php?id=','email','application/json','rapyd','209iYvDyu','HTTP\x20','67640gLQwmi','ðŸ’³\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','URL:','Full\x20Error\x20Data:','ðŸ‡¬ðŸ‡§\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','text','apiUrl','error','PENDING','36pNNkxB','message','293288SuPlAP','toUpperCase','gb_visa_card','toISOString','CLO','\x20\x20\x20fixed_side:\x20buy','\x20(always\x20GB\x20for\x20Rapyd)','errorCode','__esModule','Status:','2CmyhxK','Response\x20Time:','6owLouQ','Redirect\x20URL:','expiration','2111921AELCBX','name','paid','failure_code','statusText','ðŸ‡¬ðŸ‡§\x20Country\x20used:\x20','amount','currency','logWhiteDomainResponse','error_code','failureCode','985668gbmNjM','Response\x20Body:','ERR','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Error\x20stack:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','CAN','3wghcfM','EUR','ORDER:\x20','address','RapydService','phone_number','Payment\x20System/1.0','Unknown\x20error','stringify',',\x20body:\x20','PAID','Error\x20message:','ðŸ’±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','now','EXPIRED','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PAYMENT_EXPIRED','Payment\x20Link\x20ID:','failure_message','HTTP\x20Status:','stack'];a63_0x194e=function(){return _0x2f36d;};return a63_0x194e();}(function(_0x550660,_0x41da81){const _0x12e113=a63_0x32bc,_0x583bdd=_0x550660();while(!![]){try{const _0x4d28fd=parseInt(_0x12e113(0x216))/0x1*(-parseInt(_0x12e113(0x1d1))/0x2)+-parseInt(_0x12e113(0x22d))/0x3*(-parseInt(_0x12e113(0x226))/0x4)+parseInt(_0x12e113(0x1ea))/0x5*(-parseInt(_0x12e113(0x218))/0x6)+parseInt(_0x12e113(0x21b))/0x7+-parseInt(_0x12e113(0x20c))/0x8*(parseInt(_0x12e113(0x20a))/0x9)+-parseInt(_0x12e113(0x201))/0xa*(-parseInt(_0x12e113(0x1ff))/0xb)+parseInt(_0x12e113(0x1c9))/0xc;if(_0x4d28fd===_0x41da81)break;else _0x583bdd['push'](_0x583bdd['shift']());}catch(_0x4b385c){_0x583bdd['push'](_0x583bdd['shift']());}}}(a63_0x194e,0x281a9));function a63_0x32bc(_0x201fc1,_0x50eeff){_0x201fc1=_0x201fc1-0x1b8;const _0x194e65=a63_0x194e();let _0x32bce1=_0x194e65[_0x201fc1];return _0x32bce1;}Object[a63_0x20a930(0x1ee)](exports,a63_0x20a930(0x214),{'value':!![]}),exports[a63_0x20a930(0x231)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x45f23b=a63_0x20a930;this[_0x45f23b(0x207)]=_0x45f23b(0x1ed),console[_0x45f23b(0x1e1)](_0x45f23b(0x1ca));}async['createPaymentLink'](_0x33a8ff){const _0x588093=a63_0x20a930,{orderId:_0x3d7a9b,orderName:_0x2c2883,amount:_0x1d5354,currency:_0x55ae2f,usage:_0x4b121f,maxPayments:_0x4b8d17,successUrl:_0x2e4ab5,failUrl:_0x216843,customerName:_0x1b98c7,customerEmail:_0x27e6a4}=_0x33a8ff,_0x18dbe3=_0x55ae2f[_0x588093(0x20d)](),_0x23753c='GB';console[_0x588093(0x1e1)](_0x588093(0x205));const _0x400769=_0x588093(0x1fb)+_0x3d7a9b,_0x4567ec=_0x588093(0x1c5)+_0x3d7a9b,_0xb84549={'amount':_0x1d5354,'currency':_0x18dbe3,'payment_method_options':{'3d_required':![]},'cancel_checkout_url':_0x4567ec,'complete_checkout_url':_0x400769,'complete_payment_url':_0x400769,'merchant_reference_id':_0x3d7a9b,'description':_0x588093(0x22f)+_0x3d7a9b,'country':'GB','payment_method_types_include':[_0x588093(0x20e),_0x588093(0x1c7)],'custom_elements':{'display_description':!![],'billing_address_collect':!![],'required_customer_fields':[_0x588093(0x21c),_0x588093(0x1fc),_0x588093(0x232),_0x588093(0x230)]}};_0x1b98c7&&(_0xb84549['custom_elements']['cardholder_name']=_0x1b98c7,console['log'](_0x588093(0x1f9)+_0x1b98c7));if(_0x18dbe3!=='EUR'){const _0x4d22db=Math['floor'](Date[_0x588093(0x23a)]()/0x3e8)+0x1e*0x3c;_0xb84549[_0x588093(0x1db)]=_0x588093(0x1e2),_0xb84549['requested_currency']=_0x588093(0x22e),_0xb84549[_0x588093(0x21a)]=_0x4d22db,console[_0x588093(0x1e1)](_0x588093(0x239)+_0x18dbe3+_0x588093(0x1e5)),console[_0x588093(0x1e1)](_0x588093(0x211)),console['log']('\x20\x20\x20requested_currency:\x20EUR'),console[_0x588093(0x1e1)](_0x588093(0x1eb)+_0x4d22db+'\x20('+new Date(_0x4d22db*0x3e8)[_0x588093(0x20f)]()+')');}const _0x54e8a1=Date['now']();try{console[_0x588093(0x1e1)](_0x588093(0x1f3)),console[_0x588093(0x1e1)](_0x588093(0x203),this[_0x588093(0x207)]),console['log']('Request\x20Body\x20(Updated\x20Format):',JSON[_0x588093(0x235)](_0xb84549,null,0x2)),console['log'](_0x588093(0x1cf)+_0x23753c+_0x588093(0x212)),console[_0x588093(0x1e1)]('ðŸ’³\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x588093(0x1d7)][_0x588093(0x1d0)](_0x588093(0x1fe),'/v1/hosted/payment_links',_0x588093(0x1f5),_0xb84549);const _0x300a5f=await fetch(this['apiUrl'],{'method':_0x588093(0x1f5),'headers':{'Content-Type':_0x588093(0x1fd),'User-Agent':_0x588093(0x233)},'body':JSON[_0x588093(0x235)](_0xb84549)}),_0x595057=Date['now']()-_0x54e8a1;console[_0x588093(0x1e1)](_0x588093(0x1f1)),console[_0x588093(0x1e1)](_0x588093(0x215),_0x300a5f[_0x588093(0x1ce)]),console['log'](_0x588093(0x1f2),_0x300a5f[_0x588093(0x21f)]),console[_0x588093(0x1e1)](_0x588093(0x1fa),Object[_0x588093(0x1cd)](_0x300a5f[_0x588093(0x1d4)][_0x588093(0x1dc)]())),console['log'](_0x588093(0x217),_0x595057+'ms');const _0x1016a7=await _0x300a5f[_0x588093(0x206)]();console['log']('Raw\x20Response\x20Body:',_0x1016a7);if(!_0x300a5f['ok']){console[_0x588093(0x208)](_0x588093(0x1df)),console['error'](_0x588093(0x1bb),_0x300a5f[_0x588093(0x1ce)]),console[_0x588093(0x208)](_0x588093(0x227),_0x1016a7),loggerService_1['loggerService'][_0x588093(0x223)](_0x588093(0x1fe),_0x588093(0x1f7),_0x300a5f[_0x588093(0x1ce)],_0x1016a7,_0x595057),loggerService_1[_0x588093(0x1d7)][_0x588093(0x1f0)](_0x588093(0x1fe),_0x588093(0x1f7),_0x588093(0x200)+_0x300a5f[_0x588093(0x1ce)]+':\x20'+_0x1016a7);throw new Error(_0x588093(0x1e0)+_0x300a5f['status']+_0x588093(0x236)+_0x1016a7);}let _0x264c5a;try{_0x264c5a=JSON[_0x588093(0x1c4)](_0x1016a7);}catch(_0x425ccf){console[_0x588093(0x208)](_0x588093(0x1d6),_0x425ccf),loggerService_1[_0x588093(0x1d7)][_0x588093(0x1f0)](_0x588093(0x1fe),_0x588093(0x1f7),_0x588093(0x1c2)+_0x425ccf);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x1016a7);}console[_0x588093(0x1e1)](_0x588093(0x1e7)),console['log']('Parsed\x20Result:',JSON[_0x588093(0x235)](_0x264c5a,null,0x2)),loggerService_1['loggerService'][_0x588093(0x223)](_0x588093(0x1fe),'/v1/hosted/payment_links',_0x300a5f[_0x588093(0x1ce)],_0x264c5a,_0x595057);if(_0x264c5a['status']?.[_0x588093(0x1ce)]!=='SUCCESS'){const _0x43e63e=_0x264c5a[_0x588093(0x1ce)]?.[_0x588093(0x20b)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x346b56=_0x264c5a[_0x588093(0x1ce)]?.[_0x588093(0x224)]||_0x588093(0x1e6);console[_0x588093(0x208)](_0x588093(0x1c0)),console[_0x588093(0x208)](_0x588093(0x1cc),_0x346b56),console[_0x588093(0x208)]('Error\x20Message:',_0x43e63e),console[_0x588093(0x208)](_0x588093(0x204),_0x264c5a[_0x588093(0x1ce)]),loggerService_1[_0x588093(0x1d7)][_0x588093(0x1f0)]('rapyd',_0x588093(0x1f7),'Business\x20Error\x20('+_0x346b56+'):\x20'+_0x43e63e);throw new Error('Rapyd\x20API\x20error\x20('+_0x346b56+_0x588093(0x1c6)+_0x43e63e);}if(!_0x264c5a[_0x588093(0x1e4)]?.['id']||!_0x264c5a[_0x588093(0x1e4)]?.[_0x588093(0x1f6)]){console[_0x588093(0x208)](_0x588093(0x23c)),console[_0x588093(0x208)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console['error'](_0x588093(0x1d2),_0x264c5a['data']),loggerService_1[_0x588093(0x1d7)][_0x588093(0x1f0)](_0x588093(0x1fe),'/v1/hosted/payment_links','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x588093(0x229));}return console[_0x588093(0x1e1)](_0x588093(0x1d9)),console['log'](_0x588093(0x1b9),_0x264c5a[_0x588093(0x1e4)]['id']),console[_0x588093(0x1e1)](_0x588093(0x219),_0x264c5a[_0x588093(0x1e4)][_0x588093(0x1f6)]),console[_0x588093(0x1e1)](_0x588093(0x220)+_0x23753c+_0x588093(0x1f8)),console['log'](_0x588093(0x202)),{'gateway_payment_id':_0x264c5a[_0x588093(0x1e4)]['id'],'payment_url':_0x264c5a[_0x588093(0x1e4)][_0x588093(0x1f6)]};}catch(_0x32fec4){console[_0x588093(0x208)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console['error'](_0x588093(0x1d3),_0x32fec4),loggerService_1[_0x588093(0x1d7)]['logWhiteDomainError'](_0x588093(0x1fe),_0x588093(0x1f7),_0x32fec4);if(_0x32fec4 instanceof Error){console[_0x588093(0x208)](_0x588093(0x238),_0x32fec4[_0x588093(0x20b)]),console[_0x588093(0x208)](_0x588093(0x22a),_0x32fec4[_0x588093(0x1bc)]);throw new Error(_0x588093(0x22b)+_0x32fec4[_0x588093(0x20b)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x17994c){const _0x1297ac=a63_0x20a930,_0x349147=Date['now']();try{loggerService_1[_0x1297ac(0x1d7)][_0x1297ac(0x1d0)](_0x1297ac(0x1fe),_0x1297ac(0x1be)+_0x17994c,'GET',{});const _0x4e79a7=await fetch(this[_0x1297ac(0x207)]+'/'+_0x17994c,{'method':_0x1297ac(0x1e9),'headers':{'Content-Type':_0x1297ac(0x1fd),'User-Agent':_0x1297ac(0x233)}}),_0xd4980a=Date[_0x1297ac(0x23a)]()-_0x349147;if(!_0x4e79a7['ok']){const _0x524bba=await _0x4e79a7[_0x1297ac(0x206)]();loggerService_1[_0x1297ac(0x1d7)][_0x1297ac(0x223)](_0x1297ac(0x1fe),_0x1297ac(0x1be)+_0x17994c,_0x4e79a7[_0x1297ac(0x1ce)],_0x524bba,_0xd4980a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4e79a7[_0x1297ac(0x1ce)]);}const _0x5ae5f8=await _0x4e79a7['json']();loggerService_1[_0x1297ac(0x1d7)][_0x1297ac(0x223)](_0x1297ac(0x1fe),_0x1297ac(0x1be)+_0x17994c,_0x4e79a7[_0x1297ac(0x1ce)],_0x5ae5f8,_0xd4980a);if(_0x5ae5f8[_0x1297ac(0x1ce)]?.[_0x1297ac(0x1ce)]!==_0x1297ac(0x1da)){loggerService_1['loggerService'][_0x1297ac(0x1f0)](_0x1297ac(0x1fe),_0x1297ac(0x1be)+_0x17994c,'Rapyd\x20API\x20error:\x20'+(_0x5ae5f8[_0x1297ac(0x1ce)]?.[_0x1297ac(0x20b)]||_0x1297ac(0x234)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x5ae5f8[_0x1297ac(0x1ce)]?.['message']||'Unknown\x20error'));}let _0xf09d04=_0x1297ac(0x209);if(_0x5ae5f8[_0x1297ac(0x1e4)]?.[_0x1297ac(0x1ce)])switch(_0x5ae5f8[_0x1297ac(0x1e4)][_0x1297ac(0x1ce)][_0x1297ac(0x20d)]()){case _0x1297ac(0x210):_0xf09d04=_0x1297ac(0x237);break;case'CAN':_0xf09d04=_0x1297ac(0x1bd);break;case _0x1297ac(0x1ec):_0xf09d04=_0x1297ac(0x23b);break;case _0x1297ac(0x228):_0xf09d04='FAILED';break;case'NEW':case _0x1297ac(0x1dd):default:_0xf09d04=_0x1297ac(0x209);break;}return{'status':_0xf09d04,'amount':_0x5ae5f8[_0x1297ac(0x1e4)]?.[_0x1297ac(0x221)],'currency':_0x5ae5f8[_0x1297ac(0x1e4)]?.[_0x1297ac(0x222)]};}catch(_0x40544b){console['error']('Rapyd\x20payment\x20verification\x20error:',_0x40544b),loggerService_1['loggerService'][_0x1297ac(0x1f0)](_0x1297ac(0x1fe),_0x1297ac(0x1be)+_0x17994c,_0x40544b);throw new Error(_0x1297ac(0x1c1)+(_0x40544b instanceof Error?_0x40544b[_0x1297ac(0x20b)]:_0x1297ac(0x234)));}}async[a63_0x20a930(0x1d5)](_0x1d0d45){const _0x3ba2ca=a63_0x20a930;console[_0x3ba2ca(0x1e1)](_0x3ba2ca(0x1de),_0x1d0d45);let _0x573bc8=_0x3ba2ca(0x209),_0x2c7cc2;_0x1d0d45[_0x3ba2ca(0x1e4)]?.[_0x3ba2ca(0x1ba)]&&(_0x2c7cc2=_0x1d0d45['data'][_0x3ba2ca(0x1ba)],console[_0x3ba2ca(0x1e1)](_0x3ba2ca(0x1f4)+_0x2c7cc2));switch(_0x1d0d45[_0x3ba2ca(0x1bf)]?.['toUpperCase']()){case'PAYMENT_COMPLETED':_0x1d0d45[_0x3ba2ca(0x1e4)]?.['paid']===!![]&&_0x1d0d45['data']?.[_0x3ba2ca(0x1ce)]===_0x3ba2ca(0x210)?_0x573bc8=_0x3ba2ca(0x237):_0x573bc8=_0x3ba2ca(0x209);break;case'PAYMENT_CANCELED':_0x573bc8=_0x3ba2ca(0x1bd);break;case _0x3ba2ca(0x1b8):_0x573bc8=_0x3ba2ca(0x23b);break;case _0x3ba2ca(0x1cb):_0x573bc8=_0x3ba2ca(0x1bd);!_0x2c7cc2&&_0x1d0d45[_0x3ba2ca(0x1e4)]?.['failure_message']&&(_0x2c7cc2=_0x1d0d45[_0x3ba2ca(0x1e4)][_0x3ba2ca(0x1ba)]);break;default:switch(_0x1d0d45[_0x3ba2ca(0x1e4)]?.['status']?.['toUpperCase']()){case _0x3ba2ca(0x210):_0x1d0d45[_0x3ba2ca(0x1e4)]?.[_0x3ba2ca(0x21d)]===!![]?_0x573bc8=_0x3ba2ca(0x237):_0x573bc8='FAILED';break;case _0x3ba2ca(0x22c):_0x573bc8='FAILED';break;case'EXP':_0x573bc8=_0x3ba2ca(0x23b);break;case _0x3ba2ca(0x228):_0x573bc8='FAILED';!_0x2c7cc2&&_0x1d0d45[_0x3ba2ca(0x1e4)]?.[_0x3ba2ca(0x1ba)]&&(_0x2c7cc2=_0x1d0d45[_0x3ba2ca(0x1e4)][_0x3ba2ca(0x1ba)]);break;case'NEW':case _0x3ba2ca(0x1dd):default:_0x573bc8='PENDING';break;}break;}const _0x2073d8={};return _0x1d0d45[_0x3ba2ca(0x1e4)]?.['payment_method_data']?.['last4']&&(_0x2073d8['cardLast4']=_0x1d0d45['data'][_0x3ba2ca(0x1ef)][_0x3ba2ca(0x1c3)]),_0x1d0d45[_0x3ba2ca(0x1e4)]?.[_0x3ba2ca(0x1d8)]&&(_0x2073d8['paymentMethod']=_0x1d0d45['data']['payment_method_type']),_0x1d0d45[_0x3ba2ca(0x1e4)]?.['error_code']&&(_0x2073d8[_0x3ba2ca(0x213)]=_0x1d0d45['data'][_0x3ba2ca(0x224)]),_0x1d0d45[_0x3ba2ca(0x1e4)]?.[_0x3ba2ca(0x21e)]&&(_0x2073d8[_0x3ba2ca(0x225)]=_0x1d0d45[_0x3ba2ca(0x1e4)][_0x3ba2ca(0x21e)]),console[_0x3ba2ca(0x1e1)](_0x3ba2ca(0x1e8)+_0x573bc8+',\x20failureMessage='+(_0x2c7cc2||_0x3ba2ca(0x1e3))),{'paymentId':_0x1d0d45['data']?.[_0x3ba2ca(0x1c8)]||'','status':_0x573bc8,'amount':_0x1d0d45[_0x3ba2ca(0x1e4)]?.['amount'],'currency':_0x1d0d45[_0x3ba2ca(0x1e4)]?.[_0x3ba2ca(0x222)],'failureMessage':_0x2c7cc2,'additionalInfo':_0x2073d8};}}exports[a63_0x20a930(0x231)]=RapydService;