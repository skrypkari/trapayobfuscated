'use strict';const a48_0x5c1f06=a48_0x2826;(function(_0x90a48a,_0xf93f60){const _0xc4703d=a48_0x2826,_0x3599f4=_0x90a48a();while(!![]){try{const _0x41cd64=-parseInt(_0xc4703d(0xf3))/0x1*(parseInt(_0xc4703d(0xdf))/0x2)+parseInt(_0xc4703d(0x131))/0x3*(-parseInt(_0xc4703d(0x12f))/0x4)+parseInt(_0xc4703d(0x130))/0x5+parseInt(_0xc4703d(0x107))/0x6+parseInt(_0xc4703d(0xfc))/0x7*(-parseInt(_0xc4703d(0xd0))/0x8)+parseInt(_0xc4703d(0xe4))/0x9*(-parseInt(_0xc4703d(0xd7))/0xa)+parseInt(_0xc4703d(0xc7))/0xb;if(_0x41cd64===_0xf93f60)break;else _0x3599f4['push'](_0x3599f4['shift']());}catch(_0xd39bf4){_0x3599f4['push'](_0x3599f4['shift']());}}}(a48_0x1239,0x999c3));Object[a48_0x5c1f06(0xf9)](exports,'__esModule',{'value':!![]}),exports[a48_0x5c1f06(0xf0)]=void 0x0;function a48_0x2826(_0x4ebe0f,_0x274524){const _0x12392e=a48_0x1239();return a48_0x2826=function(_0x282678,_0x55932f){_0x282678=_0x282678-0xc5;let _0x18a11a=_0x12392e[_0x282678];return _0x18a11a;},a48_0x2826(_0x4ebe0f,_0x274524);}function a48_0x1239(){const _0x2f4c59=['FAILED','redirect_url','defineProperty','cardLast4','buy','475636MwbqUv','paid','Unknown\x20error','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','loggerService','https://tesoft.uk/gateway/success.php?id=','Error\x20Message:','payment_method_data','fromEntries','requested_currency','/v1/hosted/payment_links','1550082dWMeFZ','text','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','merchant_reference_id','ERR','Parsed\x20Result:','PAID','EXPIRED','payment_method_type','Status:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','💥\x20Rapyd\x20failure\x20message:\x20','logWhiteDomainResponse','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','headers','failure_message','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','GET','Response\x20Time:','CLO','Rapyd\x20API\x20error:\x20','Raw\x20Response\x20Body:','verifyPayment','PAYMENT_CANCELED','now','message','HTTP\x20','🇬🇧\x20Country:\x20','\x20(GB\x20-\x20Britain)','===\x20RAPYD\x20API\x20ERROR\x20===','PAYMENT_COMPLETED','Status\x20Text:','SUCCESS','\x20\x20\x20requested_currency:\x20EUR','POST','Unknown\x20error\x20from\x20Rapyd\x20API','Error\x20message:','):\x20','gb_mastercard_card','error','16288EDrQcR','1410110VgkTDH','741TIsIvG','error_code','logWhiteDomainRequest','NEW','Missing\x20id\x20or\x20redirect_url\x20in\x20response','JSON\x20Parse\x20Error:\x20','logWhiteDomainError','status','PAYMENT_FAILED',',\x20body:\x20','statusText','failure_code','entries','Error\x20details:','stringify','43105315NbMYCV','last4','Response\x20Body:','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','failureCode','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','ORDER:\x20','type','120InAKGa','Redirect\x20URL:','Error\x20stack:','PAYMENT_EXPIRED','currency','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','TesSoft\x20Payment\x20System/1.0','2138470CrDqne','ACT','data','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','rapyd','stack','90STMQeG','🇬🇧\x20Country\x20used:\x20','https://tesoft.uk/gateway/rapyd/','expiration','apiUrl','36iGZDfz','EUR','application/json','PENDING','HTTP\x20error!\x20status:\x20','Business\x20Error\x20(','CAN','errorCode','Error\x20Code:','parse','fixed_side','toISOString','RapydService','log','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','21099XoNVpe','createPaymentLink','/v1/hosted/payment_links/','UNKNOWN'];a48_0x1239=function(){return _0x2f4c59;};return a48_0x1239();}const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x348fe4=a48_0x5c1f06;this[_0x348fe4(0xe3)]=_0x348fe4(0xe1),console[_0x348fe4(0xf1)](_0x348fe4(0x114));}async[a48_0x5c1f06(0xf4)](_0x5baeb3){const _0x3d67b0=a48_0x5c1f06,{orderId:_0x2d718d,orderName:_0xc32131,amount:_0x8684f3,currency:_0x5f0bf9,usage:_0x3bb3ec,maxPayments:_0x450692,successUrl:_0x5d70e9,failUrl:_0x42671c}=_0x5baeb3,_0x859cb2=_0x5f0bf9['toUpperCase'](),_0x1ea726='GB';console[_0x3d67b0(0xf1)]('🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x35fcf8=_0x3d67b0(0x101)+_0x2d718d,_0x29a0ab='https://tesoft.uk/gateway/fail.php?id='+_0x2d718d,_0x25c853={'amount':_0x8684f3,'currency':_0x859cb2,'cancel_checkout_url':_0x29a0ab,'complete_checkout_url':_0x35fcf8,'complete_payment_url':_0x35fcf8,'merchant_reference_id':_0x2d718d,'description':_0x3d67b0(0xce)+_0x2d718d,'country':'GB','payment_method_types_include':['gb_visa_card',_0x3d67b0(0x12d)],'custom_elements':{'display_description':!![]}};if(_0x859cb2!==_0x3d67b0(0xe5)){const _0x4a7bb6=Math['floor'](Date[_0x3d67b0(0x11f)]()/0x3e8)+0x1e*0x3c;_0x25c853[_0x3d67b0(0xee)]=_0x3d67b0(0xfb),_0x25c853[_0x3d67b0(0x105)]=_0x3d67b0(0xe5),_0x25c853[_0x3d67b0(0xe2)]=_0x4a7bb6,console[_0x3d67b0(0xf1)]('💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20'+_0x859cb2+'\x20->\x20EUR:'),console['log']('\x20\x20\x20fixed_side:\x20buy'),console[_0x3d67b0(0xf1)](_0x3d67b0(0x128)),console['log']('\x20\x20\x20expiration:\x20'+_0x4a7bb6+'\x20('+new Date(_0x4a7bb6*0x3e8)[_0x3d67b0(0xef)]()+')');}const _0x11a10e=Date['now']();try{console[_0x3d67b0(0xf1)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x3d67b0(0xf1)]('URL:',this[_0x3d67b0(0xe3)]),console[_0x3d67b0(0xf1)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x3d67b0(0xc6)](_0x25c853,null,0x2)),console[_0x3d67b0(0xf1)](_0x3d67b0(0x122)+_0x1ea726+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x3d67b0(0xf1)](_0x3d67b0(0x117)),loggerService_1[_0x3d67b0(0x100)]['logWhiteDomainRequest'](_0x3d67b0(0xdd),_0x3d67b0(0x106),_0x3d67b0(0x129),_0x25c853);const _0x307f44=await fetch(this[_0x3d67b0(0xe3)],{'method':_0x3d67b0(0x129),'headers':{'Content-Type':_0x3d67b0(0xe6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3d67b0(0xc6)](_0x25c853)}),_0x556585=Date['now']()-_0x11a10e;console[_0x3d67b0(0xf1)](_0x3d67b0(0xf2)),console['log'](_0x3d67b0(0x110),_0x307f44[_0x3d67b0(0x138)]),console[_0x3d67b0(0xf1)](_0x3d67b0(0x126),_0x307f44[_0x3d67b0(0x13b)]),console[_0x3d67b0(0xf1)]('Headers:',Object[_0x3d67b0(0x104)](_0x307f44[_0x3d67b0(0x115)][_0x3d67b0(0x13d)]())),console['log'](_0x3d67b0(0x119),_0x556585+'ms');const _0x484e2e=await _0x307f44[_0x3d67b0(0x108)]();console[_0x3d67b0(0xf1)](_0x3d67b0(0x11c),_0x484e2e);if(!_0x307f44['ok']){console[_0x3d67b0(0x12e)](_0x3d67b0(0x124)),console[_0x3d67b0(0x12e)]('HTTP\x20Status:',_0x307f44['status']),console['error'](_0x3d67b0(0xc9),_0x484e2e),loggerService_1[_0x3d67b0(0x100)]['logWhiteDomainResponse']('rapyd',_0x3d67b0(0x106),_0x307f44[_0x3d67b0(0x138)],_0x484e2e,_0x556585),loggerService_1[_0x3d67b0(0x100)]['logWhiteDomainError'](_0x3d67b0(0xdd),_0x3d67b0(0x106),_0x3d67b0(0x121)+_0x307f44[_0x3d67b0(0x138)]+':\x20'+_0x484e2e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x307f44[_0x3d67b0(0x138)]+_0x3d67b0(0x13a)+_0x484e2e);}let _0xc869eb;try{_0xc869eb=JSON[_0x3d67b0(0xed)](_0x484e2e);}catch(_0x4a6e3c){console[_0x3d67b0(0x12e)](_0x3d67b0(0xcc),_0x4a6e3c),loggerService_1['loggerService'][_0x3d67b0(0x137)]('rapyd',_0x3d67b0(0x106),_0x3d67b0(0x136)+_0x4a6e3c);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x484e2e);}console['log'](_0x3d67b0(0xca)),console[_0x3d67b0(0xf1)](_0x3d67b0(0x10c),JSON[_0x3d67b0(0xc6)](_0xc869eb,null,0x2)),loggerService_1[_0x3d67b0(0x100)][_0x3d67b0(0x113)](_0x3d67b0(0xdd),_0x3d67b0(0x106),_0x307f44[_0x3d67b0(0x138)],_0xc869eb,_0x556585);if(_0xc869eb['status']?.['status']!==_0x3d67b0(0x127)){const _0x2d0f42=_0xc869eb[_0x3d67b0(0x138)]?.['message']||_0x3d67b0(0x12a),_0x280317=_0xc869eb['status']?.['error_code']||_0x3d67b0(0xf6);console[_0x3d67b0(0x12e)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3d67b0(0x12e)](_0x3d67b0(0xec),_0x280317),console['error'](_0x3d67b0(0x102),_0x2d0f42),console[_0x3d67b0(0x12e)]('Full\x20Error\x20Data:',_0xc869eb[_0x3d67b0(0x138)]),loggerService_1['loggerService'][_0x3d67b0(0x137)](_0x3d67b0(0xdd),'/v1/hosted/payment_links',_0x3d67b0(0xe9)+_0x280317+'):\x20'+_0x2d0f42);throw new Error('Rapyd\x20API\x20error\x20('+_0x280317+_0x3d67b0(0x12c)+_0x2d0f42);}if(!_0xc869eb['data']?.['id']||!_0xc869eb[_0x3d67b0(0xd9)]?.['redirect_url']){console['error'](_0x3d67b0(0xda)),console[_0x3d67b0(0x12e)](_0x3d67b0(0x135)),console['error']('Response\x20data:',_0xc869eb[_0x3d67b0(0xd9)]),loggerService_1[_0x3d67b0(0x100)][_0x3d67b0(0x137)]('rapyd',_0x3d67b0(0x106),_0x3d67b0(0xdc));throw new Error(_0x3d67b0(0xdb));}return console[_0x3d67b0(0xf1)]('===\x20RAPYD\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0xc869eb[_0x3d67b0(0xd9)]['id']),console['log'](_0x3d67b0(0xd1),_0xc869eb[_0x3d67b0(0xd9)][_0x3d67b0(0xf8)]),console[_0x3d67b0(0xf1)](_0x3d67b0(0xe0)+_0x1ea726+_0x3d67b0(0x123)),console[_0x3d67b0(0xf1)](_0x3d67b0(0x117)),{'gateway_payment_id':_0xc869eb['data']['id'],'payment_url':_0xc869eb[_0x3d67b0(0xd9)][_0x3d67b0(0xf8)]};}catch(_0x1d65be){console[_0x3d67b0(0x12e)](_0x3d67b0(0x111)),console[_0x3d67b0(0x12e)](_0x3d67b0(0xc5),_0x1d65be),loggerService_1[_0x3d67b0(0x100)]['logWhiteDomainError'](_0x3d67b0(0xdd),_0x3d67b0(0x106),_0x1d65be);if(_0x1d65be instanceof Error){console['error'](_0x3d67b0(0x12b),_0x1d65be['message']),console['error'](_0x3d67b0(0xd2),_0x1d65be[_0x3d67b0(0xde)]);throw new Error(_0x3d67b0(0xd5)+_0x1d65be['message']);}throw new Error(_0x3d67b0(0xff));}}async[a48_0x5c1f06(0x11d)](_0x1862b9){const _0x5cedc8=a48_0x5c1f06,_0x3e47ee=Date[_0x5cedc8(0x11f)]();try{loggerService_1['loggerService'][_0x5cedc8(0x133)](_0x5cedc8(0xdd),_0x5cedc8(0xf5)+_0x1862b9,_0x5cedc8(0x118),{});const _0x236b9c=await fetch(this[_0x5cedc8(0xe3)]+'/'+_0x1862b9,{'method':_0x5cedc8(0x118),'headers':{'Content-Type':_0x5cedc8(0xe6),'User-Agent':_0x5cedc8(0xd6)}}),_0x439494=Date[_0x5cedc8(0x11f)]()-_0x3e47ee;if(!_0x236b9c['ok']){const _0x35efdd=await _0x236b9c['text']();loggerService_1[_0x5cedc8(0x100)][_0x5cedc8(0x113)](_0x5cedc8(0xdd),_0x5cedc8(0xf5)+_0x1862b9,_0x236b9c[_0x5cedc8(0x138)],_0x35efdd,_0x439494);throw new Error(_0x5cedc8(0xe8)+_0x236b9c['status']);}const _0x54caf8=await _0x236b9c['json']();loggerService_1['loggerService'][_0x5cedc8(0x113)](_0x5cedc8(0xdd),_0x5cedc8(0xf5)+_0x1862b9,_0x236b9c[_0x5cedc8(0x138)],_0x54caf8,_0x439494);if(_0x54caf8[_0x5cedc8(0x138)]?.[_0x5cedc8(0x138)]!==_0x5cedc8(0x127)){loggerService_1[_0x5cedc8(0x100)][_0x5cedc8(0x137)]('rapyd',_0x5cedc8(0xf5)+_0x1862b9,_0x5cedc8(0x11b)+(_0x54caf8[_0x5cedc8(0x138)]?.[_0x5cedc8(0x120)]||_0x5cedc8(0xfe)));throw new Error(_0x5cedc8(0x11b)+(_0x54caf8[_0x5cedc8(0x138)]?.[_0x5cedc8(0x120)]||_0x5cedc8(0xfe)));}let _0x4baffc=_0x5cedc8(0xe7);if(_0x54caf8['data']?.[_0x5cedc8(0x138)])switch(_0x54caf8[_0x5cedc8(0xd9)][_0x5cedc8(0x138)]['toUpperCase']()){case'CLO':_0x4baffc=_0x5cedc8(0x10d);break;case _0x5cedc8(0xea):_0x4baffc=_0x5cedc8(0xf7);break;case'EXP':_0x4baffc=_0x5cedc8(0x10e);break;case _0x5cedc8(0x10b):_0x4baffc=_0x5cedc8(0xf7);break;case _0x5cedc8(0x134):case _0x5cedc8(0xd8):default:_0x4baffc='PENDING';break;}return{'status':_0x4baffc,'amount':_0x54caf8[_0x5cedc8(0xd9)]?.['amount'],'currency':_0x54caf8['data']?.['currency']};}catch(_0x52d9ac){console['error']('Rapyd\x20payment\x20verification\x20error:',_0x52d9ac),loggerService_1[_0x5cedc8(0x100)][_0x5cedc8(0x137)](_0x5cedc8(0xdd),_0x5cedc8(0xf5)+_0x1862b9,_0x52d9ac);throw new Error(_0x5cedc8(0xcd)+(_0x52d9ac instanceof Error?_0x52d9ac[_0x5cedc8(0x120)]:_0x5cedc8(0xfe)));}}async['processWebhook'](_0x5e685f){const _0x293e00=a48_0x5c1f06;console[_0x293e00(0xf1)]('Processing\x20Rapyd\x20webhook:',_0x5e685f);let _0x9fb54a=_0x293e00(0xe7),_0x353b35;_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0x116)]&&(_0x353b35=_0x5e685f[_0x293e00(0xd9)][_0x293e00(0x116)],console['log'](_0x293e00(0x112)+_0x353b35));switch(_0x5e685f[_0x293e00(0xcf)]?.['toUpperCase']()){case _0x293e00(0x125):_0x5e685f['data']?.[_0x293e00(0xfd)]===!![]&&_0x5e685f['data']?.[_0x293e00(0x138)]===_0x293e00(0x11a)?_0x9fb54a=_0x293e00(0x10d):_0x9fb54a=_0x293e00(0xe7);break;case _0x293e00(0x11e):_0x9fb54a=_0x293e00(0xf7);break;case _0x293e00(0xd3):_0x9fb54a='EXPIRED';break;case _0x293e00(0x139):_0x9fb54a=_0x293e00(0xf7);!_0x353b35&&_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0x116)]&&(_0x353b35=_0x5e685f[_0x293e00(0xd9)][_0x293e00(0x116)]);break;default:switch(_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0x138)]?.['toUpperCase']()){case _0x293e00(0x11a):_0x5e685f['data']?.[_0x293e00(0xfd)]===!![]?_0x9fb54a=_0x293e00(0x10d):_0x9fb54a=_0x293e00(0xf7);break;case _0x293e00(0xea):_0x9fb54a=_0x293e00(0xf7);break;case'EXP':_0x9fb54a=_0x293e00(0x10e);break;case _0x293e00(0x10b):_0x9fb54a=_0x293e00(0xf7);!_0x353b35&&_0x5e685f[_0x293e00(0xd9)]?.['failure_message']&&(_0x353b35=_0x5e685f[_0x293e00(0xd9)]['failure_message']);break;case _0x293e00(0x134):case _0x293e00(0xd8):default:_0x9fb54a=_0x293e00(0xe7);break;}break;}const _0x486105={};return _0x5e685f[_0x293e00(0xd9)]?.['payment_method_data']?.[_0x293e00(0xc8)]&&(_0x486105[_0x293e00(0xfa)]=_0x5e685f[_0x293e00(0xd9)][_0x293e00(0x103)]['last4']),_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0x10f)]&&(_0x486105['paymentMethod']=_0x5e685f[_0x293e00(0xd9)][_0x293e00(0x10f)]),_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0x132)]&&(_0x486105[_0x293e00(0xeb)]=_0x5e685f['data'][_0x293e00(0x132)]),_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0x13c)]&&(_0x486105[_0x293e00(0xcb)]=_0x5e685f['data'][_0x293e00(0x13c)]),console[_0x293e00(0xf1)](_0x293e00(0x109)+_0x9fb54a+',\x20failureMessage='+(_0x353b35||'none')),{'paymentId':_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0x10a)]||'','status':_0x9fb54a,'amount':_0x5e685f['data']?.['amount'],'currency':_0x5e685f[_0x293e00(0xd9)]?.[_0x293e00(0xd4)],'failureMessage':_0x353b35,'additionalInfo':_0x486105};}}exports['RapydService']=RapydService;