'use strict';function a71_0x4777(_0xbe17f7,_0x54665d){_0xbe17f7=_0xbe17f7-0x116;const _0x23a936=a71_0x23a9();let _0x4777b9=_0x23a936[_0xbe17f7];return _0x4777b9;}const a71_0x18aece=a71_0x4777;(function(_0x3f85e6,_0x343297){const _0x1a8763=a71_0x4777,_0x31b0ec=_0x3f85e6();while(!![]){try{const _0x228a36=parseInt(_0x1a8763(0x133))/0x1*(parseInt(_0x1a8763(0x1a3))/0x2)+parseInt(_0x1a8763(0x1a6))/0x3*(parseInt(_0x1a8763(0x124))/0x4)+-parseInt(_0x1a8763(0x161))/0x5*(-parseInt(_0x1a8763(0x15b))/0x6)+-parseInt(_0x1a8763(0x155))/0x7+parseInt(_0x1a8763(0x119))/0x8*(-parseInt(_0x1a8763(0x156))/0x9)+parseInt(_0x1a8763(0x15e))/0xa+-parseInt(_0x1a8763(0x19c))/0xb;if(_0x228a36===_0x343297)break;else _0x31b0ec['push'](_0x31b0ec['shift']());}catch(_0x45cfec){_0x31b0ec['push'](_0x31b0ec['shift']());}}}(a71_0x23a9,0xb5f3f));function a71_0x23a9(){const _0x55c09b=['Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','verifyPayment','/v1/hosted/payment_links/','ERR','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','amount','stringify','3503116IdrNbH','Rapyd\x20API\x20error\x20(','âŒ\x20Error\x20looking\x20up\x20Rapyd\x20BIN:','../loggerService','):\x20','Failed\x20to\x20parse\x20JSON\x20response:','payment_method_data','last4',',\x20failureMessage=','cardCountry','\x20(always\x20GB\x20for\x20Rapyd)','headers','status','failure_message','requested_currency','9jPlRUt','PAID','https://tesoft.uk/gateway/fail.php?id=','../binLookupService','HTTP\x20','processWebhook','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','UNKNOWN','HTTP\x20Status:','data','Unknown\x20error\x20from\x20Rapyd\x20API','Full\x20Error\x20Data:','===\x20RAPYD\x20API\x20ERROR\x20===','FAILED','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Business\x20Error\x20(','Response\x20Body:','PAYMENT_FAILED','lookupBin','cardIssuer','ðŸ”\x20Rapyd\x20BIN\x20detected:\x20','ðŸŒ\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','RapydService','\x20(GB\x20-\x20Britain)','redirect_url','application/json','rapyd','Error\x20details:','expiration','parse','gb_mastercard_card','message','https://tesoft.uk/gateway/rapyd/','error_code','5212788xuBXKg','94455CAgDuH','currency','cardBinStatus','failure_code','loggerService','30KOwBDn','paid','Rapyd\x20API\x20error:\x20','5795380klyVcR','errorCode','ðŸ’¥\x20Rapyd\x20failure\x20message:\x20','1101945rHypQG','Payment\x20Link\x20ID:','PAYMENT_CANCELED','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','gb_visa_card','type','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','now','address','\x20\x20\x20expiration:\x20','name','logWhiteDomainError','Response\x20Time:','bin_number','split','EXP','cardType',',\x20body:\x20','bin_details','stack','ðŸ’³\x20Adding\x20cardholder\x20name:\x20','json','ACT','Rapyd\x20payment\x20verification\x20error:','apiUrl','logWhiteDomainRequest','ðŸ“Š\x20Rapyd\x20BIN\x20lookup\x20result:','CLO','GET','Error\x20stack:','CAN','ðŸ’±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','PENDING','createPaymentLink','EXPIRED','log','Missing\x20id\x20or\x20redirect_url\x20in\x20response','buy','Processing\x20Rapyd\x20webhook:','\x20\x20\x20fixed_side:\x20buy','ORDER:\x20','cardholder_name','toUpperCase','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','payment_method_type','text','failureCode','POST','/v1/hosted/payment_links','Unknown\x20error','Error\x20Message:','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','brand','NEW','ðŸ’³\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','cardBin','JSON\x20Parse\x20Error:\x20','defineProperty','8957113rSpHIw','SUCCESS','logWhiteDomainResponse','ðŸ‡¬ðŸ‡§\x20Country:\x20','__esModule','PAYMENT_EXPIRED','binLookupService','88372oZSXwz','error','Payment\x20System/1.0','3lvbcyq','===\x20RAPYD\x20SUCCESS\x20===','Error\x20message:','PAYMENT_COMPLETED','email','ðŸ‡¬ðŸ‡§\x20Country\x20used:\x20','Status:','https://tesoft.uk/gateway/success.php?id=','EUR','none','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','cardBrand','496FvNIfi','Raw\x20Response\x20Body:','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='];a71_0x23a9=function(){return _0x55c09b;};return a71_0x23a9();}Object[a71_0x18aece(0x19b)](exports,a71_0x18aece(0x1a0),{'value':!![]}),exports[a71_0x18aece(0x149)]=void 0x0;const loggerService_1=require(a71_0x18aece(0x127)),binLookupService_1=require(a71_0x18aece(0x136));class RapydService{constructor(){const _0x1ba016=a71_0x18aece;this[_0x1ba016(0x17a)]=_0x1ba016(0x153),console[_0x1ba016(0x185)](_0x1ba016(0x148));}async[a71_0x18aece(0x183)](_0x7b4b5f){const _0x5dea87=a71_0x18aece,{orderId:_0x4ec037,orderName:_0x28ed59,amount:_0x302a93,currency:_0x361b18,usage:_0x2619e0,maxPayments:_0x32b087,successUrl:_0x15bd8a,failUrl:_0x3870e7,customerName:_0x210f76,customerEmail:_0x482dd2}=_0x7b4b5f,_0x5df31a=_0x361b18[_0x5dea87(0x18c)](),_0x5504af='GB';console['log']('ðŸ‡¬ðŸ‡§\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x2e1477=_0x5dea87(0x1ad)+_0x4ec037,_0x43ce0e=_0x5dea87(0x135)+_0x4ec037,_0x5f591a={'amount':_0x302a93,'currency':_0x5df31a,'payment_method_options':{'3d_required':![]},'cancel_checkout_url':_0x43ce0e,'complete_checkout_url':_0x2e1477,'complete_payment_url':_0x2e1477,'merchant_reference_id':_0x4ec037,'description':_0x5dea87(0x18a)+_0x4ec037,'statement_descriptor':'TESOFT\x20'+(_0x4ec037[_0x5dea87(0x170)]('-')[0x1]||_0x4ec037),'country':'GB','payment_method_types_include':[_0x5dea87(0x166),_0x5dea87(0x151)],'custom_elements':{'display_description':!![],'billing_address_collect':!![],'required_customer_fields':[_0x5dea87(0x16c),_0x5dea87(0x1aa),'phone_number',_0x5dea87(0x16a)]}};_0x210f76&&(_0x5f591a['custom_elements'][_0x5dea87(0x18b)]=_0x210f76,console[_0x5dea87(0x185)](_0x5dea87(0x176)+_0x210f76));if(_0x5df31a!==_0x5dea87(0x1ae)){const _0x55a63a=Math['floor'](Date[_0x5dea87(0x169)]()/0x3e8)+0x1e*0x3c;_0x5f591a['fixed_side']=_0x5dea87(0x187),_0x5f591a[_0x5dea87(0x132)]='EUR',_0x5f591a[_0x5dea87(0x14f)]=_0x55a63a,console['log'](_0x5dea87(0x181)+_0x5df31a+'\x20->\x20EUR:'),console[_0x5dea87(0x185)](_0x5dea87(0x189)),console[_0x5dea87(0x185)]('\x20\x20\x20requested_currency:\x20EUR'),console[_0x5dea87(0x185)](_0x5dea87(0x16b)+_0x55a63a+'\x20('+new Date(_0x55a63a*0x3e8)['toISOString']()+')');}const _0x3810d5=Date[_0x5dea87(0x169)]();try{console[_0x5dea87(0x185)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x5dea87(0x185)]('URL:',this[_0x5dea87(0x17a)]),console[_0x5dea87(0x185)]('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x5f591a,null,0x2)),console[_0x5dea87(0x185)](_0x5dea87(0x19f)+_0x5504af+_0x5dea87(0x12e)),console[_0x5dea87(0x185)](_0x5dea87(0x198)),loggerService_1[_0x5dea87(0x15a)][_0x5dea87(0x17b)](_0x5dea87(0x14d),_0x5dea87(0x192),_0x5dea87(0x191),_0x5f591a);const _0x5162a8=await fetch(this[_0x5dea87(0x17a)],{'method':'POST','headers':{'Content-Type':_0x5dea87(0x14c),'User-Agent':_0x5dea87(0x1a5)},'body':JSON['stringify'](_0x5f591a)}),_0x20e446=Date['now']()-_0x3810d5;console['log'](_0x5dea87(0x168)),console[_0x5dea87(0x185)](_0x5dea87(0x1ac),_0x5162a8[_0x5dea87(0x130)]),console[_0x5dea87(0x185)]('Status\x20Text:',_0x5162a8['statusText']),console['log']('Headers:',Object['fromEntries'](_0x5162a8[_0x5dea87(0x12f)]['entries']())),console[_0x5dea87(0x185)](_0x5dea87(0x16e),_0x20e446+'ms');const _0x1aea87=await _0x5162a8[_0x5dea87(0x18f)]();console['log'](_0x5dea87(0x11a),_0x1aea87);if(!_0x5162a8['ok']){console['error'](_0x5dea87(0x13f)),console[_0x5dea87(0x1a4)](_0x5dea87(0x13b),_0x5162a8['status']),console[_0x5dea87(0x1a4)](_0x5dea87(0x143),_0x1aea87),loggerService_1['loggerService'][_0x5dea87(0x19e)](_0x5dea87(0x14d),_0x5dea87(0x192),_0x5162a8[_0x5dea87(0x130)],_0x1aea87,_0x20e446),loggerService_1[_0x5dea87(0x15a)][_0x5dea87(0x16d)](_0x5dea87(0x14d),_0x5dea87(0x192),_0x5dea87(0x137)+_0x5162a8[_0x5dea87(0x130)]+':\x20'+_0x1aea87);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5162a8[_0x5dea87(0x130)]+_0x5dea87(0x173)+_0x1aea87);}let _0x9fce39;try{_0x9fce39=JSON[_0x5dea87(0x150)](_0x1aea87);}catch(_0x5c8735){console[_0x5dea87(0x1a4)](_0x5dea87(0x129),_0x5c8735),loggerService_1[_0x5dea87(0x15a)]['logWhiteDomainError'](_0x5dea87(0x14d),_0x5dea87(0x192),_0x5dea87(0x19a)+_0x5c8735);throw new Error(_0x5dea87(0x165)+_0x1aea87);}console[_0x5dea87(0x185)](_0x5dea87(0x195)),console['log']('Parsed\x20Result:',JSON[_0x5dea87(0x123)](_0x9fce39,null,0x2)),loggerService_1[_0x5dea87(0x15a)][_0x5dea87(0x19e)](_0x5dea87(0x14d),_0x5dea87(0x192),_0x5162a8[_0x5dea87(0x130)],_0x9fce39,_0x20e446);if(_0x9fce39[_0x5dea87(0x130)]?.['status']!==_0x5dea87(0x19d)){const _0x506b8c=_0x9fce39['status']?.[_0x5dea87(0x152)]||_0x5dea87(0x13d),_0x44e0fe=_0x9fce39[_0x5dea87(0x130)]?.['error_code']||_0x5dea87(0x13a);console[_0x5dea87(0x1a4)](_0x5dea87(0x164)),console[_0x5dea87(0x1a4)]('Error\x20Code:',_0x44e0fe),console[_0x5dea87(0x1a4)](_0x5dea87(0x194),_0x506b8c),console[_0x5dea87(0x1a4)](_0x5dea87(0x13e),_0x9fce39[_0x5dea87(0x130)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x5dea87(0x14d),'/v1/hosted/payment_links',_0x5dea87(0x142)+_0x44e0fe+'):\x20'+_0x506b8c);throw new Error(_0x5dea87(0x125)+_0x44e0fe+_0x5dea87(0x128)+_0x506b8c);}if(!_0x9fce39[_0x5dea87(0x13c)]?.['id']||!_0x9fce39['data']?.[_0x5dea87(0x14b)]){console['error'](_0x5dea87(0x11b)),console['error'](_0x5dea87(0x186)),console[_0x5dea87(0x1a4)]('Response\x20data:',_0x9fce39[_0x5dea87(0x13c)]),loggerService_1['loggerService'][_0x5dea87(0x16d)](_0x5dea87(0x14d),_0x5dea87(0x192),_0x5dea87(0x141));throw new Error(_0x5dea87(0x18d));}return console['log'](_0x5dea87(0x1a7)),console[_0x5dea87(0x185)](_0x5dea87(0x162),_0x9fce39[_0x5dea87(0x13c)]['id']),console['log']('Redirect\x20URL:',_0x9fce39[_0x5dea87(0x13c)][_0x5dea87(0x14b)]),console[_0x5dea87(0x185)](_0x5dea87(0x1ab)+_0x5504af+_0x5dea87(0x14a)),console[_0x5dea87(0x185)](_0x5dea87(0x198)),{'gateway_payment_id':_0x9fce39[_0x5dea87(0x13c)]['id'],'payment_url':_0x9fce39['data']['redirect_url']};}catch(_0x1c09ab){console[_0x5dea87(0x1a4)](_0x5dea87(0x117)),console[_0x5dea87(0x1a4)](_0x5dea87(0x14e),_0x1c09ab),loggerService_1[_0x5dea87(0x15a)]['logWhiteDomainError']('rapyd',_0x5dea87(0x192),_0x1c09ab);if(_0x1c09ab instanceof Error){console['error'](_0x5dea87(0x1a8),_0x1c09ab[_0x5dea87(0x152)]),console[_0x5dea87(0x1a4)](_0x5dea87(0x17f),_0x1c09ab[_0x5dea87(0x175)]);throw new Error(_0x5dea87(0x11c)+_0x1c09ab[_0x5dea87(0x152)]);}throw new Error(_0x5dea87(0x121));}}async[a71_0x18aece(0x11e)](_0x53a97b){const _0x28488e=a71_0x18aece,_0x1bf480=Date[_0x28488e(0x169)]();try{loggerService_1['loggerService'][_0x28488e(0x17b)](_0x28488e(0x14d),_0x28488e(0x11f)+_0x53a97b,'GET',{});const _0x1bab8b=await fetch(this[_0x28488e(0x17a)]+'/'+_0x53a97b,{'method':_0x28488e(0x17e),'headers':{'Content-Type':'application/json','User-Agent':_0x28488e(0x1a5)}}),_0x3638b2=Date[_0x28488e(0x169)]()-_0x1bf480;if(!_0x1bab8b['ok']){const _0x32753e=await _0x1bab8b[_0x28488e(0x18f)]();loggerService_1[_0x28488e(0x15a)][_0x28488e(0x19e)](_0x28488e(0x14d),_0x28488e(0x11f)+_0x53a97b,_0x1bab8b[_0x28488e(0x130)],_0x32753e,_0x3638b2);throw new Error(_0x28488e(0x11d)+_0x1bab8b[_0x28488e(0x130)]);}const _0x1efb0f=await _0x1bab8b[_0x28488e(0x177)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x28488e(0x14d),'/v1/hosted/payment_links/'+_0x53a97b,_0x1bab8b[_0x28488e(0x130)],_0x1efb0f,_0x3638b2);if(_0x1efb0f[_0x28488e(0x130)]?.[_0x28488e(0x130)]!==_0x28488e(0x19d)){loggerService_1[_0x28488e(0x15a)]['logWhiteDomainError'](_0x28488e(0x14d),'/v1/hosted/payment_links/'+_0x53a97b,_0x28488e(0x15d)+(_0x1efb0f[_0x28488e(0x130)]?.['message']||'Unknown\x20error'));throw new Error(_0x28488e(0x15d)+(_0x1efb0f['status']?.[_0x28488e(0x152)]||_0x28488e(0x193)));}let _0x249e3e=_0x28488e(0x182);if(_0x1efb0f[_0x28488e(0x13c)]?.[_0x28488e(0x130)])switch(_0x1efb0f[_0x28488e(0x13c)][_0x28488e(0x130)][_0x28488e(0x18c)]()){case _0x28488e(0x17d):_0x249e3e='PAID';break;case _0x28488e(0x180):_0x249e3e=_0x28488e(0x140);break;case _0x28488e(0x171):_0x249e3e=_0x28488e(0x184);break;case _0x28488e(0x120):_0x249e3e='FAILED';break;case _0x28488e(0x197):case _0x28488e(0x178):default:_0x249e3e='PENDING';break;}return{'status':_0x249e3e,'amount':_0x1efb0f['data']?.[_0x28488e(0x122)],'currency':_0x1efb0f[_0x28488e(0x13c)]?.[_0x28488e(0x157)]};}catch(_0x16baaf){console[_0x28488e(0x1a4)](_0x28488e(0x179),_0x16baaf),loggerService_1[_0x28488e(0x15a)][_0x28488e(0x16d)](_0x28488e(0x14d),_0x28488e(0x11f)+_0x53a97b,_0x16baaf);throw new Error(_0x28488e(0x139)+(_0x16baaf instanceof Error?_0x16baaf['message']:_0x28488e(0x193)));}}async[a71_0x18aece(0x138)](_0x422c4f){const _0x4b3882=a71_0x18aece;console['log'](_0x4b3882(0x188),_0x422c4f);let _0x25bf25=_0x4b3882(0x182),_0x39b70a;_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x131)]&&(_0x39b70a=_0x422c4f[_0x4b3882(0x13c)][_0x4b3882(0x131)],console['log'](_0x4b3882(0x160)+_0x39b70a));switch(_0x422c4f[_0x4b3882(0x167)]?.[_0x4b3882(0x18c)]()){case _0x4b3882(0x1a9):_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x15c)]===!![]&&_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x130)]===_0x4b3882(0x17d)?_0x25bf25=_0x4b3882(0x134):_0x25bf25=_0x4b3882(0x182);break;case _0x4b3882(0x163):_0x25bf25='FAILED';break;case _0x4b3882(0x1a1):_0x25bf25='EXPIRED';break;case _0x4b3882(0x144):_0x25bf25=_0x4b3882(0x140);!_0x39b70a&&_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x131)]&&(_0x39b70a=_0x422c4f[_0x4b3882(0x13c)]['failure_message']);break;default:switch(_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x130)]?.['toUpperCase']()){case'CLO':_0x422c4f['data']?.[_0x4b3882(0x15c)]===!![]?_0x25bf25='PAID':_0x25bf25=_0x4b3882(0x140);break;case'CAN':_0x25bf25=_0x4b3882(0x140);break;case _0x4b3882(0x171):_0x25bf25=_0x4b3882(0x184);break;case _0x4b3882(0x120):_0x25bf25=_0x4b3882(0x140);!_0x39b70a&&_0x422c4f[_0x4b3882(0x13c)]?.['failure_message']&&(_0x39b70a=_0x422c4f[_0x4b3882(0x13c)][_0x4b3882(0x131)]);break;case'NEW':case'ACT':default:_0x25bf25='PENDING';break;}break;}const _0x17989e={};_0x422c4f['data']?.[_0x4b3882(0x12a)]?.[_0x4b3882(0x12b)]&&(_0x17989e['cardLast4']=_0x422c4f[_0x4b3882(0x13c)]['payment_method_data'][_0x4b3882(0x12b)]);_0x422c4f[_0x4b3882(0x13c)]?.['payment_method_data']?.[_0x4b3882(0x174)]?.[_0x4b3882(0x196)]&&(_0x17989e[_0x4b3882(0x118)]=_0x422c4f[_0x4b3882(0x13c)][_0x4b3882(0x12a)][_0x4b3882(0x174)][_0x4b3882(0x196)],console[_0x4b3882(0x185)]('ðŸ’³\x20Card\x20brand\x20from\x20bin_details:\x20'+_0x17989e[_0x4b3882(0x118)]));_0x422c4f[_0x4b3882(0x13c)]?.['payment_method_type']&&(_0x17989e['paymentMethod']=_0x422c4f[_0x4b3882(0x13c)][_0x4b3882(0x18e)]);_0x422c4f['data']?.[_0x4b3882(0x154)]&&(_0x17989e[_0x4b3882(0x15f)]=_0x422c4f[_0x4b3882(0x13c)][_0x4b3882(0x154)]);_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x159)]&&(_0x17989e[_0x4b3882(0x190)]=_0x422c4f['data'][_0x4b3882(0x159)]);if(_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x12a)]?.[_0x4b3882(0x174)]?.[_0x4b3882(0x16f)]){const _0x575f6c=_0x422c4f[_0x4b3882(0x13c)][_0x4b3882(0x12a)][_0x4b3882(0x174)][_0x4b3882(0x16f)];console[_0x4b3882(0x185)](_0x4b3882(0x147)+_0x575f6c);try{const _0x32ea74=await binLookupService_1[_0x4b3882(0x1a2)][_0x4b3882(0x145)](_0x575f6c);console[_0x4b3882(0x185)](_0x4b3882(0x17c),_0x32ea74),_0x17989e[_0x4b3882(0x199)]=_0x575f6c,_0x17989e[_0x4b3882(0x158)]=_0x32ea74[_0x4b3882(0x158)],_0x17989e[_0x4b3882(0x172)]=_0x32ea74[_0x4b3882(0x172)],_0x17989e['cardCategory']=_0x32ea74['cardCategory'],_0x17989e['cardCountry']=_0x32ea74[_0x4b3882(0x12d)],_0x17989e[_0x4b3882(0x146)]=_0x32ea74[_0x4b3882(0x146)];}catch(_0xf3f981){console['error'](_0x4b3882(0x126),_0xf3f981),_0x17989e['cardBin']=_0x575f6c;}}return console['log']('ðŸ”„\x20Rapyd\x20webhook\x20processed:\x20status='+_0x25bf25+_0x4b3882(0x12c)+(_0x39b70a||_0x4b3882(0x116))),{'paymentId':_0x422c4f[_0x4b3882(0x13c)]?.['merchant_reference_id']||'','status':_0x25bf25,'amount':_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x122)],'currency':_0x422c4f[_0x4b3882(0x13c)]?.[_0x4b3882(0x157)],'failureMessage':_0x39b70a,'additionalInfo':_0x17989e};}}exports[a71_0x18aece(0x149)]=RapydService;