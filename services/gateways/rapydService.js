'use strict';const a50_0x366b63=a50_0x3453;(function(_0x28e19b,_0x5d42ba){const _0xb5a566=a50_0x3453,_0x18e890=_0x28e19b();while(!![]){try{const _0x54e584=parseInt(_0xb5a566(0x21e))/0x1+-parseInt(_0xb5a566(0x1db))/0x2*(parseInt(_0xb5a566(0x20a))/0x3)+-parseInt(_0xb5a566(0x1f8))/0x4+parseInt(_0xb5a566(0x219))/0x5*(-parseInt(_0xb5a566(0x1dd))/0x6)+parseInt(_0xb5a566(0x1aa))/0x7*(-parseInt(_0xb5a566(0x1ef))/0x8)+parseInt(_0xb5a566(0x1f6))/0x9+parseInt(_0xb5a566(0x1c4))/0xa;if(_0x54e584===_0x5d42ba)break;else _0x18e890['push'](_0x18e890['shift']());}catch(_0x5c02d1){_0x18e890['push'](_0x18e890['shift']());}}}(a50_0x4f28,0xc8498));function a50_0x4f28(){const _0xd0d28a=['Status\x20Text:','HTTP\x20error!\x20status:\x20','882410TLfaYw','apiUrl','7732644TBjoky','Unknown\x20error','paid','ORDER:\x20','UNKNOWN','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','/v1/hosted/payment_links','payment_method_data','PAYMENT_EXPIRED','entries','CAN','Rapyd\x20API\x20error:\x20','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','amount','gb_mastercard_card','currency','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Raw\x20Response\x20Body:','3144iVApzu','Headers:','Rapyd\x20API\x20error\x20(','gb_visa_card','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','HTTP\x20','HTTP\x20Status:','8406189vNrKHl','SUCCESS','2563420BuOyym','Rapyd\x20payment\x20verification\x20error:','fromEntries','Parsed\x20Result:','PAYMENT_FAILED','GET','Processing\x20Rapyd\x20webhook:','Redirect\x20URL:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','data','https://tesoft.uk/gateway/rapyd/','loggerService','__esModule','\x20(GB\x20-\x20Britain)','Error\x20message:','PAID','Full\x20Error\x20Data:','ERR','9HmtbkY','logWhiteDomainError','none','error_code','\x20\x20\x20requested_currency:\x20EUR','expiration','POST','parse','Missing\x20id\x20or\x20redirect_url\x20in\x20response','EUR','CLO','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','buy','status','payment_method_type','5zMqprh','üá¨üáß\x20Country\x20used:\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','failure_code','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','419891wQgMGZ','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','Error\x20Code:','Business\x20Error\x20(','text','Response\x20Body:','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED','/v1/hosted/payment_links/',',\x20failureMessage=','PENDING','===\x20RAPYD\x20SUCCESS\x20===','message','\x20->\x20EUR:','20755bllMzj','logWhiteDomainResponse','Request\x20Body\x20(Updated\x20Format):','FAILED','):\x20','application/json','NEW','processWebhook','now','merchant_reference_id','TesSoft\x20Payment\x20System/1.0','Unknown\x20error\x20from\x20Rapyd\x20API','https://tesoft.uk/gateway/success.php?id=','error','log','type','json','Error\x20Message:','errorCode','RapydService','Response\x20Time:','redirect_url','EXP','URL:','stack','defineProperty','38849530lnzure','fixed_side','üí•\x20Rapyd\x20failure\x20message:\x20','failure_message','statusText','Status:','https://tesoft.uk/gateway/fail.php?id=','toUpperCase','Error\x20stack:','===\x20RAPYD\x20API\x20ERROR\x20===','stringify','logWhiteDomainRequest','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','floor','ACT','PAYMENT_CANCELED','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','rapyd','requested_currency','toISOString','JSON\x20Parse\x20Error:\x20'];a50_0x4f28=function(){return _0xd0d28a;};return a50_0x4f28();}Object[a50_0x366b63(0x1c3)](exports,a50_0x366b63(0x204),{'value':!![]}),exports[a50_0x366b63(0x1bd)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x12625f=a50_0x366b63;this[_0x12625f(0x1dc)]=_0x12625f(0x202),console[_0x12625f(0x1b8)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x1069e2){const _0x55cf4c=a50_0x366b63,{orderId:_0x56909e,orderName:_0xc061fa,amount:_0x44eaad,currency:_0x217cec,usage:_0x4c0931,maxPayments:_0x416590,successUrl:_0x5d8fb6,failUrl:_0x43c73a}=_0x1069e2,_0x59b36c=_0x217cec[_0x55cf4c(0x1cb)](),_0x1c0bbd='GB';console['log']('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x10918d=_0x55cf4c(0x1b6)+_0x56909e,_0x3d3e7a=_0x55cf4c(0x1ca)+_0x56909e,_0x4fe79b={'amount':_0x44eaad,'currency':_0x59b36c,'cancel_checkout_url':_0x3d3e7a,'complete_checkout_url':_0x10918d,'complete_payment_url':_0x10918d,'merchant_reference_id':_0x56909e,'description':_0x55cf4c(0x1e0)+_0x56909e,'country':'GB','payment_method_types_include':[_0x55cf4c(0x1f2),_0x55cf4c(0x1eb)],'custom_elements':{'display_description':!![]}};if(_0x59b36c!=='EUR'){const _0x2278a7=Math[_0x55cf4c(0x1d1)](Date[_0x55cf4c(0x1b2)]()/0x3e8)+0x1e*0x3c;_0x4fe79b[_0x55cf4c(0x1c5)]=_0x55cf4c(0x216),_0x4fe79b[_0x55cf4c(0x1d6)]=_0x55cf4c(0x213),_0x4fe79b[_0x55cf4c(0x20f)]=_0x2278a7,console[_0x55cf4c(0x1b8)](_0x55cf4c(0x21f)+_0x59b36c+_0x55cf4c(0x1a9)),console[_0x55cf4c(0x1b8)]('\x20\x20\x20fixed_side:\x20buy'),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x20e)),console['log']('\x20\x20\x20expiration:\x20'+_0x2278a7+'\x20('+new Date(_0x2278a7*0x3e8)[_0x55cf4c(0x1d7)]()+')');}const _0x2ec9cf=Date['now']();try{console['log']('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1c1),this[_0x55cf4c(0x1dc)]),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1ac),JSON[_0x55cf4c(0x1ce)](_0x4fe79b,null,0x2)),console[_0x55cf4c(0x1b8)]('üá¨üáß\x20Country:\x20'+_0x1c0bbd+'\x20(always\x20GB\x20for\x20Rapyd)'),console['log'](_0x55cf4c(0x21b)),loggerService_1[_0x55cf4c(0x203)][_0x55cf4c(0x1cf)](_0x55cf4c(0x1d5),_0x55cf4c(0x1e3),_0x55cf4c(0x210),_0x4fe79b);const _0x47536b=await fetch(this[_0x55cf4c(0x1dc)],{'method':_0x55cf4c(0x210),'headers':{'Content-Type':_0x55cf4c(0x1af),'User-Agent':_0x55cf4c(0x1b4)},'body':JSON[_0x55cf4c(0x1ce)](_0x4fe79b)}),_0x203d0e=Date[_0x55cf4c(0x1b2)]()-_0x2ec9cf;console['log'](_0x55cf4c(0x215)),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1c9),_0x47536b[_0x55cf4c(0x217)]),console['log'](_0x55cf4c(0x1d9),_0x47536b[_0x55cf4c(0x1c8)]),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1f0),Object[_0x55cf4c(0x1fa)](_0x47536b['headers'][_0x55cf4c(0x1e6)]())),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1be),_0x203d0e+'ms');const _0x3e04c9=await _0x47536b[_0x55cf4c(0x1a0)]();console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1ee),_0x3e04c9);if(!_0x47536b['ok']){console[_0x55cf4c(0x1b7)](_0x55cf4c(0x1cd)),console[_0x55cf4c(0x1b7)](_0x55cf4c(0x1f5),_0x47536b['status']),console[_0x55cf4c(0x1b7)](_0x55cf4c(0x1a1),_0x3e04c9),loggerService_1[_0x55cf4c(0x203)]['logWhiteDomainResponse']('rapyd',_0x55cf4c(0x1e3),_0x47536b[_0x55cf4c(0x217)],_0x3e04c9,_0x203d0e),loggerService_1[_0x55cf4c(0x203)]['logWhiteDomainError'](_0x55cf4c(0x1d5),_0x55cf4c(0x1e3),_0x55cf4c(0x1f4)+_0x47536b[_0x55cf4c(0x217)]+':\x20'+_0x3e04c9);throw new Error('HTTP\x20error!\x20status:\x20'+_0x47536b[_0x55cf4c(0x217)]+',\x20body:\x20'+_0x3e04c9);}let _0x66994;try{_0x66994=JSON[_0x55cf4c(0x211)](_0x3e04c9);}catch(_0xb0afb2){console[_0x55cf4c(0x1b7)](_0x55cf4c(0x1a2),_0xb0afb2),loggerService_1[_0x55cf4c(0x203)][_0x55cf4c(0x20b)](_0x55cf4c(0x1d5),_0x55cf4c(0x1e3),_0x55cf4c(0x1d8)+_0xb0afb2);throw new Error(_0x55cf4c(0x21d)+_0x3e04c9);}console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1e2)),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1fb),JSON[_0x55cf4c(0x1ce)](_0x66994,null,0x2)),loggerService_1[_0x55cf4c(0x203)]['logWhiteDomainResponse'](_0x55cf4c(0x1d5),'/v1/hosted/payment_links',_0x47536b[_0x55cf4c(0x217)],_0x66994,_0x203d0e);if(_0x66994[_0x55cf4c(0x217)]?.['status']!=='SUCCESS'){const _0x44ae7d=_0x66994['status']?.[_0x55cf4c(0x1a8)]||_0x55cf4c(0x1b5),_0x31af79=_0x66994[_0x55cf4c(0x217)]?.[_0x55cf4c(0x20d)]||_0x55cf4c(0x1e1);console[_0x55cf4c(0x1b7)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x55cf4c(0x1b7)](_0x55cf4c(0x220),_0x31af79),console[_0x55cf4c(0x1b7)](_0x55cf4c(0x1bb),_0x44ae7d),console[_0x55cf4c(0x1b7)](_0x55cf4c(0x208),_0x66994[_0x55cf4c(0x217)]),loggerService_1[_0x55cf4c(0x203)][_0x55cf4c(0x20b)]('rapyd','/v1/hosted/payment_links',_0x55cf4c(0x221)+_0x31af79+_0x55cf4c(0x1ae)+_0x44ae7d);throw new Error(_0x55cf4c(0x1f1)+_0x31af79+_0x55cf4c(0x1ae)+_0x44ae7d);}if(!_0x66994[_0x55cf4c(0x201)]?.['id']||!_0x66994['data']?.[_0x55cf4c(0x1bf)]){console[_0x55cf4c(0x1b7)](_0x55cf4c(0x1d4)),console['error'](_0x55cf4c(0x212)),console[_0x55cf4c(0x1b7)]('Response\x20data:',_0x66994[_0x55cf4c(0x201)]),loggerService_1[_0x55cf4c(0x203)]['logWhiteDomainError']('rapyd',_0x55cf4c(0x1e3),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x55cf4c(0x1f3));}return console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1a7)),console[_0x55cf4c(0x1b8)]('Payment\x20Link\x20ID:',_0x66994[_0x55cf4c(0x201)]['id']),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x1ff),_0x66994[_0x55cf4c(0x201)][_0x55cf4c(0x1bf)]),console[_0x55cf4c(0x1b8)](_0x55cf4c(0x21a)+_0x1c0bbd+_0x55cf4c(0x205)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x66994[_0x55cf4c(0x201)]['id'],'payment_url':_0x66994[_0x55cf4c(0x201)][_0x55cf4c(0x1bf)]};}catch(_0x38e57b){console[_0x55cf4c(0x1b7)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x55cf4c(0x1b7)]('Error\x20details:',_0x38e57b),loggerService_1['loggerService']['logWhiteDomainError'](_0x55cf4c(0x1d5),'/v1/hosted/payment_links',_0x38e57b);if(_0x38e57b instanceof Error){console[_0x55cf4c(0x1b7)](_0x55cf4c(0x206),_0x38e57b[_0x55cf4c(0x1a8)]),console['error'](_0x55cf4c(0x1cc),_0x38e57b[_0x55cf4c(0x1c2)]);throw new Error(_0x55cf4c(0x200)+_0x38e57b[_0x55cf4c(0x1a8)]);}throw new Error(_0x55cf4c(0x1ed));}}async['verifyPayment'](_0x2ba4a8){const _0xffedc9=a50_0x366b63,_0x28e24f=Date[_0xffedc9(0x1b2)]();try{loggerService_1['loggerService'][_0xffedc9(0x1cf)](_0xffedc9(0x1d5),_0xffedc9(0x1a4)+_0x2ba4a8,_0xffedc9(0x1fd),{});const _0x121042=await fetch(this[_0xffedc9(0x1dc)]+'/'+_0x2ba4a8,{'method':_0xffedc9(0x1fd),'headers':{'Content-Type':_0xffedc9(0x1af),'User-Agent':_0xffedc9(0x1b4)}}),_0x1c6376=Date['now']()-_0x28e24f;if(!_0x121042['ok']){const _0x1c6bf3=await _0x121042['text']();loggerService_1[_0xffedc9(0x203)][_0xffedc9(0x1ab)](_0xffedc9(0x1d5),_0xffedc9(0x1a4)+_0x2ba4a8,_0x121042[_0xffedc9(0x217)],_0x1c6bf3,_0x1c6376);throw new Error(_0xffedc9(0x1da)+_0x121042['status']);}const _0x5a6aa6=await _0x121042[_0xffedc9(0x1ba)]();loggerService_1['loggerService'][_0xffedc9(0x1ab)](_0xffedc9(0x1d5),'/v1/hosted/payment_links/'+_0x2ba4a8,_0x121042[_0xffedc9(0x217)],_0x5a6aa6,_0x1c6376);if(_0x5a6aa6[_0xffedc9(0x217)]?.[_0xffedc9(0x217)]!==_0xffedc9(0x1f7)){loggerService_1['loggerService'][_0xffedc9(0x20b)](_0xffedc9(0x1d5),'/v1/hosted/payment_links/'+_0x2ba4a8,_0xffedc9(0x1e8)+(_0x5a6aa6[_0xffedc9(0x217)]?.['message']||'Unknown\x20error'));throw new Error(_0xffedc9(0x1e8)+(_0x5a6aa6[_0xffedc9(0x217)]?.[_0xffedc9(0x1a8)]||_0xffedc9(0x1de)));}let _0x44390a=_0xffedc9(0x1a6);if(_0x5a6aa6[_0xffedc9(0x201)]?.[_0xffedc9(0x217)])switch(_0x5a6aa6[_0xffedc9(0x201)][_0xffedc9(0x217)][_0xffedc9(0x1cb)]()){case _0xffedc9(0x214):_0x44390a=_0xffedc9(0x207);break;case'CAN':_0x44390a=_0xffedc9(0x1ad);break;case _0xffedc9(0x1c0):_0x44390a=_0xffedc9(0x1a3);break;case _0xffedc9(0x209):_0x44390a=_0xffedc9(0x1ad);break;case _0xffedc9(0x1b0):case _0xffedc9(0x1d2):default:_0x44390a=_0xffedc9(0x1a6);break;}return{'status':_0x44390a,'amount':_0x5a6aa6[_0xffedc9(0x201)]?.[_0xffedc9(0x1ea)],'currency':_0x5a6aa6[_0xffedc9(0x201)]?.[_0xffedc9(0x1ec)]};}catch(_0x5f19a2){console[_0xffedc9(0x1b7)](_0xffedc9(0x1f9),_0x5f19a2),loggerService_1[_0xffedc9(0x203)][_0xffedc9(0x20b)](_0xffedc9(0x1d5),_0xffedc9(0x1a4)+_0x2ba4a8,_0x5f19a2);throw new Error(_0xffedc9(0x1e9)+(_0x5f19a2 instanceof Error?_0x5f19a2['message']:_0xffedc9(0x1de)));}}async[a50_0x366b63(0x1b1)](_0x4021de){const _0x482dc4=a50_0x366b63;console[_0x482dc4(0x1b8)](_0x482dc4(0x1fe),_0x4021de);let _0x1f3c7e=_0x482dc4(0x1a6),_0x5167dd;_0x4021de['data']?.['failure_message']&&(_0x5167dd=_0x4021de[_0x482dc4(0x201)][_0x482dc4(0x1c7)],console[_0x482dc4(0x1b8)](_0x482dc4(0x1c6)+_0x5167dd));switch(_0x4021de[_0x482dc4(0x1b9)]?.[_0x482dc4(0x1cb)]()){case'PAYMENT_COMPLETED':_0x4021de[_0x482dc4(0x201)]?.['paid']===!![]&&_0x4021de[_0x482dc4(0x201)]?.[_0x482dc4(0x217)]==='CLO'?_0x1f3c7e=_0x482dc4(0x207):_0x1f3c7e='PENDING';break;case _0x482dc4(0x1d3):_0x1f3c7e=_0x482dc4(0x1ad);break;case _0x482dc4(0x1e5):_0x1f3c7e=_0x482dc4(0x1a3);break;case _0x482dc4(0x1fc):_0x1f3c7e=_0x482dc4(0x1ad);!_0x5167dd&&_0x4021de[_0x482dc4(0x201)]?.['failure_message']&&(_0x5167dd=_0x4021de[_0x482dc4(0x201)][_0x482dc4(0x1c7)]);break;default:switch(_0x4021de[_0x482dc4(0x201)]?.['status']?.[_0x482dc4(0x1cb)]()){case _0x482dc4(0x214):_0x4021de['data']?.[_0x482dc4(0x1df)]===!![]?_0x1f3c7e='PAID':_0x1f3c7e=_0x482dc4(0x1ad);break;case _0x482dc4(0x1e7):_0x1f3c7e=_0x482dc4(0x1ad);break;case _0x482dc4(0x1c0):_0x1f3c7e='EXPIRED';break;case _0x482dc4(0x209):_0x1f3c7e=_0x482dc4(0x1ad);!_0x5167dd&&_0x4021de['data']?.[_0x482dc4(0x1c7)]&&(_0x5167dd=_0x4021de[_0x482dc4(0x201)][_0x482dc4(0x1c7)]);break;case _0x482dc4(0x1b0):case _0x482dc4(0x1d2):default:_0x1f3c7e='PENDING';break;}break;}const _0x5f283d={};return _0x4021de[_0x482dc4(0x201)]?.[_0x482dc4(0x1e4)]?.['last4']&&(_0x5f283d['cardLast4']=_0x4021de[_0x482dc4(0x201)][_0x482dc4(0x1e4)]['last4']),_0x4021de[_0x482dc4(0x201)]?.[_0x482dc4(0x218)]&&(_0x5f283d['paymentMethod']=_0x4021de['data'][_0x482dc4(0x218)]),_0x4021de[_0x482dc4(0x201)]?.['error_code']&&(_0x5f283d[_0x482dc4(0x1bc)]=_0x4021de[_0x482dc4(0x201)]['error_code']),_0x4021de[_0x482dc4(0x201)]?.[_0x482dc4(0x21c)]&&(_0x5f283d['failureCode']=_0x4021de['data']['failure_code']),console[_0x482dc4(0x1b8)](_0x482dc4(0x1d0)+_0x1f3c7e+_0x482dc4(0x1a5)+(_0x5167dd||_0x482dc4(0x20c))),{'paymentId':_0x4021de[_0x482dc4(0x201)]?.[_0x482dc4(0x1b3)]||'','status':_0x1f3c7e,'amount':_0x4021de['data']?.[_0x482dc4(0x1ea)],'currency':_0x4021de['data']?.[_0x482dc4(0x1ec)],'failureMessage':_0x5167dd,'additionalInfo':_0x5f283d};}}function a50_0x3453(_0x3dc50e,_0x58c6f1){const _0x4f289f=a50_0x4f28();return a50_0x3453=function(_0x3453ff,_0xfb414c){_0x3453ff=_0x3453ff-0x1a0;let _0x20e6e2=_0x4f289f[_0x3453ff];return _0x20e6e2;},a50_0x3453(_0x3dc50e,_0x58c6f1);}exports[a50_0x366b63(0x1bd)]=RapydService;