'use strict';const a45_0x47eeb1=a45_0x11d6;(function(_0x2bd047,_0x2e2c83){const _0x5d3a8d=a45_0x11d6,_0x1ca3f0=_0x2bd047();while(!![]){try{const _0x4d42d7=parseInt(_0x5d3a8d(0xcb))/0x1+parseInt(_0x5d3a8d(0x83))/0x2+-parseInt(_0x5d3a8d(0x93))/0x3*(-parseInt(_0x5d3a8d(0xbf))/0x4)+-parseInt(_0x5d3a8d(0xcc))/0x5*(-parseInt(_0x5d3a8d(0xa0))/0x6)+parseInt(_0x5d3a8d(0xbd))/0x7+parseInt(_0x5d3a8d(0xa9))/0x8+-parseInt(_0x5d3a8d(0x92))/0x9;if(_0x4d42d7===_0x2e2c83)break;else _0x1ca3f0['push'](_0x1ca3f0['shift']());}catch(_0x3e37b2){_0x1ca3f0['push'](_0x1ca3f0['shift']());}}}(a45_0xea5d,0xa6cc3));Object['defineProperty'](exports,a45_0x47eeb1(0x74),{'value':!![]}),exports['RapydService']=void 0x0;function a45_0x11d6(_0x1582c8,_0x117f90){const _0xea5d2e=a45_0xea5d();return a45_0x11d6=function(_0x11d67b,_0x17f30c){_0x11d67b=_0x11d67b-0x69;let _0x4d6a97=_0xea5d2e[_0x11d67b];return _0x4d6a97;},a45_0x11d6(_0x1582c8,_0x117f90);}function a45_0xea5d(){const _0x1e9318=['merchant_reference_id','headers','errorCode','error_code','CAN','loggerService','3914918tVClWU','Error\x20Message:','124RIfCzn','logWhiteDomainRequest','now','ORDER:\x20','EXPIRED','message','PAYMENT_CANCELED','Rapyd\x20API\x20error:\x20','\x20(always\x20GB\x20for\x20Rapyd)','last4','HTTP\x20error!\x20status:\x20','statusText','215709vixEcM','10nyUAXB','TesSoft\x20Payment\x20System/1.0','redirect_url','https://tesoft.uk/gateway/rapyd/','Error\x20stack:','PAYMENT_EXPIRED','Response\x20Time:','Error\x20details:','gb_visa_card','Error\x20message:','parse','Missing\x20id\x20or\x20redirect_url\x20in\x20response','üá¨üáß\x20Country:\x20','stack','HTTP\x20Status:','Response\x20data:','currency',',\x20failureMessage=','NEW','apiUrl','üá¨üáß\x20Country\x20used:\x20','Status:','SUCCESS','Raw\x20Response\x20Body:','POST','status','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','__esModule','\x20(GB\x20-\x20Britain)','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Processing\x20Rapyd\x20webhook:','EXP','Headers:','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','RapydService','/v1/hosted/payment_links','stringify','text','HTTP\x20','PAYMENT_COMPLETED','paid','cardLast4','2105536hIqEpA','rapyd','Rapyd\x20API\x20error\x20(','PAID','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','üí•\x20Rapyd\x20failure\x20message:\x20','createPaymentLink','gb_mastercard_card','JSON\x20Parse\x20Error:\x20','error','verifyPayment','Error\x20Code:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','CLO','21454767SltWCK','8385eVfMCE','logWhiteDomainResponse','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','entries','paymentMethod','amount','ERR','Unknown\x20error','PENDING','failure_code','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','):\x20','application/json','2035422RNMLHD','payment_method_type','Request\x20Body\x20(Updated\x20Format):','data','type','PAYMENT_FAILED',',\x20body:\x20','Payment\x20Link\x20ID:','FAILED','3793568ZWmDvY','logWhiteDomainError','toUpperCase','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','payment_method_data','log','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Response\x20Body:','/v1/hosted/payment_links/','failure_message','ACT','https://tesoft.uk/gateway/success.php?id=','Status\x20Text:','GET'];a45_0xea5d=function(){return _0x1e9318;};return a45_0xea5d();}const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x2321ab=a45_0x47eeb1;this['apiUrl']=_0x2321ab(0xcf),console['log'](_0x2321ab(0x8f));}async[a45_0x47eeb1(0x89)](_0x558a6e){const _0x4926f6=a45_0x47eeb1,{orderId:_0x5b806c,orderName:_0xe9a9d,amount:_0x2ddffe,currency:_0x1e02ad,usage:_0x357284,maxPayments:_0xef0100,successUrl:_0x200122,failUrl:_0x464632}=_0x558a6e,_0x327864=_0x1e02ad[_0x4926f6(0xab)](),_0x5d090b='GB';console['log'](_0x4926f6(0x90));const _0x3c8645=_0x4926f6(0xb4)+_0x5b806c,_0x27b1b4='https://tesoft.uk/gateway/fail.php?id='+_0x5b806c,_0x417cb3={'amount':_0x2ddffe,'currency':_0x327864,'cancel_checkout_url':_0x27b1b4,'complete_checkout_url':_0x3c8645,'complete_payment_url':_0x3c8645,'merchant_reference_id':_0x5b806c,'description':_0x4926f6(0xc2)+_0x5b806c,'country':'GB','payment_method_types_include':[_0x4926f6(0xd4),_0x4926f6(0x8a)],'custom_elements':{'display_description':!![]}},_0x231bbe=Date['now']();try{console[_0x4926f6(0xae)](_0x4926f6(0x9d)),console['log']('URL:',this['apiUrl']),console[_0x4926f6(0xae)](_0x4926f6(0xa2),JSON['stringify'](_0x417cb3,null,0x2)),console['log'](_0x4926f6(0xd8)+_0x5d090b+_0x4926f6(0xc7)),console[_0x4926f6(0xae)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x4926f6(0xbc)][_0x4926f6(0xc0)](_0x4926f6(0x84),_0x4926f6(0x7c),_0x4926f6(0x71),_0x417cb3);const _0x109c07=await fetch(this[_0x4926f6(0x6c)],{'method':_0x4926f6(0x71),'headers':{'Content-Type':_0x4926f6(0x9f),'User-Agent':_0x4926f6(0xcd)},'body':JSON[_0x4926f6(0x7d)](_0x417cb3)}),_0x1cab59=Date['now']()-_0x231bbe;console[_0x4926f6(0xae)](_0x4926f6(0x73)),console[_0x4926f6(0xae)](_0x4926f6(0x6e),_0x109c07[_0x4926f6(0x72)]),console[_0x4926f6(0xae)](_0x4926f6(0xb5),_0x109c07[_0x4926f6(0xca)]),console[_0x4926f6(0xae)](_0x4926f6(0x79),Object['fromEntries'](_0x109c07[_0x4926f6(0xb8)][_0x4926f6(0x96)]())),console[_0x4926f6(0xae)](_0x4926f6(0xd2),_0x1cab59+'ms');const _0x52010=await _0x109c07[_0x4926f6(0x7e)]();console[_0x4926f6(0xae)](_0x4926f6(0x70),_0x52010);if(!_0x109c07['ok']){console[_0x4926f6(0x8c)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x4926f6(0x8c)](_0x4926f6(0xda),_0x109c07['status']),console[_0x4926f6(0x8c)](_0x4926f6(0xb0),_0x52010),loggerService_1['loggerService'][_0x4926f6(0x94)]('rapyd',_0x4926f6(0x7c),_0x109c07['status'],_0x52010,_0x1cab59),loggerService_1[_0x4926f6(0xbc)][_0x4926f6(0xaa)]('rapyd',_0x4926f6(0x7c),_0x4926f6(0x7f)+_0x109c07[_0x4926f6(0x72)]+':\x20'+_0x52010);throw new Error(_0x4926f6(0xc9)+_0x109c07[_0x4926f6(0x72)]+_0x4926f6(0xa6)+_0x52010);}let _0x44c35f;try{_0x44c35f=JSON[_0x4926f6(0xd6)](_0x52010);}catch(_0x3c395c){console[_0x4926f6(0x8c)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3c395c),loggerService_1[_0x4926f6(0xbc)][_0x4926f6(0xaa)]('rapyd',_0x4926f6(0x7c),_0x4926f6(0x8b)+_0x3c395c);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x52010);}console[_0x4926f6(0xae)](_0x4926f6(0x87)),console[_0x4926f6(0xae)]('Parsed\x20Result:',JSON[_0x4926f6(0x7d)](_0x44c35f,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4926f6(0x84),'/v1/hosted/payment_links',_0x109c07[_0x4926f6(0x72)],_0x44c35f,_0x1cab59);if(_0x44c35f[_0x4926f6(0x72)]?.[_0x4926f6(0x72)]!==_0x4926f6(0x6f)){const _0x3f9fb8=_0x44c35f[_0x4926f6(0x72)]?.[_0x4926f6(0xc4)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x433635=_0x44c35f[_0x4926f6(0x72)]?.[_0x4926f6(0xba)]||'UNKNOWN';console['error'](_0x4926f6(0xac)),console[_0x4926f6(0x8c)](_0x4926f6(0x8e),_0x433635),console[_0x4926f6(0x8c)](_0x4926f6(0xbe),_0x3f9fb8),console[_0x4926f6(0x8c)]('Full\x20Error\x20Data:',_0x44c35f['status']),loggerService_1[_0x4926f6(0xbc)][_0x4926f6(0xaa)](_0x4926f6(0x84),_0x4926f6(0x7c),'Business\x20Error\x20('+_0x433635+_0x4926f6(0x9e)+_0x3f9fb8);throw new Error(_0x4926f6(0x85)+_0x433635+_0x4926f6(0x9e)+_0x3f9fb8);}if(!_0x44c35f['data']?.['id']||!_0x44c35f['data']?.[_0x4926f6(0xce)]){console['error'](_0x4926f6(0x95)),console[_0x4926f6(0x8c)](_0x4926f6(0xd7)),console[_0x4926f6(0x8c)](_0x4926f6(0xdb),_0x44c35f[_0x4926f6(0xa3)]),loggerService_1[_0x4926f6(0xbc)][_0x4926f6(0xaa)](_0x4926f6(0x84),_0x4926f6(0x7c),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x4926f6(0xae)]('===\x20RAPYD\x20SUCCESS\x20==='),console['log'](_0x4926f6(0xa7),_0x44c35f[_0x4926f6(0xa3)]['id']),console[_0x4926f6(0xae)]('Redirect\x20URL:',_0x44c35f[_0x4926f6(0xa3)][_0x4926f6(0xce)]),console['log'](_0x4926f6(0x6d)+_0x5d090b+_0x4926f6(0x75)),console[_0x4926f6(0xae)](_0x4926f6(0xaf)),{'gateway_payment_id':_0x44c35f[_0x4926f6(0xa3)]['id'],'payment_url':_0x44c35f[_0x4926f6(0xa3)][_0x4926f6(0xce)]};}catch(_0x2c63f9){console[_0x4926f6(0x8c)](_0x4926f6(0x76)),console[_0x4926f6(0x8c)](_0x4926f6(0xd3),_0x2c63f9),loggerService_1[_0x4926f6(0xbc)][_0x4926f6(0xaa)](_0x4926f6(0x84),'/v1/hosted/payment_links',_0x2c63f9);if(_0x2c63f9 instanceof Error){console[_0x4926f6(0x8c)](_0x4926f6(0xd5),_0x2c63f9[_0x4926f6(0xc4)]),console[_0x4926f6(0x8c)](_0x4926f6(0xd0),_0x2c63f9[_0x4926f6(0xd9)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x2c63f9['message']);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x47eeb1(0x8d)](_0x14392c){const _0x469774=a45_0x47eeb1,_0x116f00=Date['now']();try{loggerService_1['loggerService'][_0x469774(0xc0)](_0x469774(0x84),_0x469774(0xb1)+_0x14392c,_0x469774(0xb6),{});const _0xe63b70=await fetch(this['apiUrl']+'/'+_0x14392c,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x469774(0xcd)}}),_0x4bcb98=Date[_0x469774(0xc1)]()-_0x116f00;if(!_0xe63b70['ok']){const _0x1a1531=await _0xe63b70['text']();loggerService_1[_0x469774(0xbc)][_0x469774(0x94)](_0x469774(0x84),'/v1/hosted/payment_links/'+_0x14392c,_0xe63b70['status'],_0x1a1531,_0x4bcb98);throw new Error(_0x469774(0xc9)+_0xe63b70['status']);}const _0x5c1a98=await _0xe63b70['json']();loggerService_1['loggerService'][_0x469774(0x94)](_0x469774(0x84),_0x469774(0xb1)+_0x14392c,_0xe63b70[_0x469774(0x72)],_0x5c1a98,_0x4bcb98);if(_0x5c1a98[_0x469774(0x72)]?.[_0x469774(0x72)]!==_0x469774(0x6f)){loggerService_1[_0x469774(0xbc)][_0x469774(0xaa)]('rapyd',_0x469774(0xb1)+_0x14392c,'Rapyd\x20API\x20error:\x20'+(_0x5c1a98[_0x469774(0x72)]?.[_0x469774(0xc4)]||_0x469774(0x9a)));throw new Error(_0x469774(0xc6)+(_0x5c1a98[_0x469774(0x72)]?.['message']||_0x469774(0x9a)));}let _0x2b96b5=_0x469774(0x9b);if(_0x5c1a98[_0x469774(0xa3)]?.[_0x469774(0x72)])switch(_0x5c1a98[_0x469774(0xa3)]['status'][_0x469774(0xab)]()){case _0x469774(0x91):_0x2b96b5=_0x469774(0x86);break;case _0x469774(0xbb):_0x2b96b5=_0x469774(0xa8);break;case _0x469774(0x78):_0x2b96b5=_0x469774(0xc3);break;case _0x469774(0x99):_0x2b96b5='FAILED';break;case _0x469774(0x6b):case _0x469774(0xb3):default:_0x2b96b5=_0x469774(0x9b);break;}return{'status':_0x2b96b5,'amount':_0x5c1a98[_0x469774(0xa3)]?.['amount'],'currency':_0x5c1a98[_0x469774(0xa3)]?.[_0x469774(0x69)]};}catch(_0x432702){console[_0x469774(0x8c)]('Rapyd\x20payment\x20verification\x20error:',_0x432702),loggerService_1[_0x469774(0xbc)][_0x469774(0xaa)](_0x469774(0x84),_0x469774(0xb1)+_0x14392c,_0x432702);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x432702 instanceof Error?_0x432702[_0x469774(0xc4)]:_0x469774(0x9a)));}}async['processWebhook'](_0x364af9){const _0x300985=a45_0x47eeb1;console[_0x300985(0xae)](_0x300985(0x77),_0x364af9);let _0x564675='PENDING',_0x4aab85;_0x364af9[_0x300985(0xa3)]?.[_0x300985(0xb2)]&&(_0x4aab85=_0x364af9[_0x300985(0xa3)]['failure_message'],console['log'](_0x300985(0x88)+_0x4aab85));switch(_0x364af9[_0x300985(0xa4)]?.[_0x300985(0xab)]()){case _0x300985(0x80):_0x364af9[_0x300985(0xa3)]?.[_0x300985(0x81)]===!![]&&_0x364af9[_0x300985(0xa3)]?.[_0x300985(0x72)]==='CLO'?_0x564675=_0x300985(0x86):_0x564675=_0x300985(0x9b);break;case _0x300985(0xc5):_0x564675=_0x300985(0xa8);break;case _0x300985(0xd1):_0x564675=_0x300985(0xc3);break;case _0x300985(0xa5):_0x564675='FAILED';!_0x4aab85&&_0x364af9[_0x300985(0xa3)]?.[_0x300985(0xb2)]&&(_0x4aab85=_0x364af9[_0x300985(0xa3)][_0x300985(0xb2)]);break;default:switch(_0x364af9[_0x300985(0xa3)]?.[_0x300985(0x72)]?.[_0x300985(0xab)]()){case _0x300985(0x91):_0x364af9[_0x300985(0xa3)]?.[_0x300985(0x81)]===!![]?_0x564675=_0x300985(0x86):_0x564675=_0x300985(0xa8);break;case _0x300985(0xbb):_0x564675=_0x300985(0xa8);break;case'EXP':_0x564675=_0x300985(0xc3);break;case _0x300985(0x99):_0x564675=_0x300985(0xa8);!_0x4aab85&&_0x364af9[_0x300985(0xa3)]?.['failure_message']&&(_0x4aab85=_0x364af9['data'][_0x300985(0xb2)]);break;case'NEW':case _0x300985(0xb3):default:_0x564675='PENDING';break;}break;}const _0x277e8a={};return _0x364af9[_0x300985(0xa3)]?.[_0x300985(0xad)]?.['last4']&&(_0x277e8a[_0x300985(0x82)]=_0x364af9[_0x300985(0xa3)][_0x300985(0xad)][_0x300985(0xc8)]),_0x364af9[_0x300985(0xa3)]?.[_0x300985(0xa1)]&&(_0x277e8a[_0x300985(0x97)]=_0x364af9[_0x300985(0xa3)]['payment_method_type']),_0x364af9[_0x300985(0xa3)]?.[_0x300985(0xba)]&&(_0x277e8a[_0x300985(0xb9)]=_0x364af9['data']['error_code']),_0x364af9[_0x300985(0xa3)]?.['failure_code']&&(_0x277e8a['failureCode']=_0x364af9[_0x300985(0xa3)][_0x300985(0x9c)]),console[_0x300985(0xae)](_0x300985(0x7a)+_0x564675+_0x300985(0x6a)+(_0x4aab85||'none')),{'paymentId':_0x364af9[_0x300985(0xa3)]?.[_0x300985(0xb7)]||'','status':_0x564675,'amount':_0x364af9[_0x300985(0xa3)]?.[_0x300985(0x98)],'currency':_0x364af9[_0x300985(0xa3)]?.[_0x300985(0x69)],'failureMessage':_0x4aab85,'additionalInfo':_0x277e8a};}}exports[a45_0x47eeb1(0x7b)]=RapydService;