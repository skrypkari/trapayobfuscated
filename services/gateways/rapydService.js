'use strict';function a48_0x38e2(_0x4cb4de,_0x1b48f1){const _0x25b168=a48_0x25b1();return a48_0x38e2=function(_0x38e283,_0x2bc4b4){_0x38e283=_0x38e283-0x180;let _0x2aab1b=_0x25b168[_0x38e283];return _0x2aab1b;},a48_0x38e2(_0x4cb4de,_0x1b48f1);}const a48_0x37cba3=a48_0x38e2;(function(_0x34b630,_0x414ce1){const _0x5aa0b4=a48_0x38e2,_0x390ccc=_0x34b630();while(!![]){try{const _0x11d9c2=-parseInt(_0x5aa0b4(0x1f2))/0x1+-parseInt(_0x5aa0b4(0x189))/0x2+-parseInt(_0x5aa0b4(0x19e))/0x3*(parseInt(_0x5aa0b4(0x195))/0x4)+parseInt(_0x5aa0b4(0x1dc))/0x5*(parseInt(_0x5aa0b4(0x1c2))/0x6)+-parseInt(_0x5aa0b4(0x197))/0x7+parseInt(_0x5aa0b4(0x1d8))/0x8*(parseInt(_0x5aa0b4(0x1d9))/0x9)+parseInt(_0x5aa0b4(0x1aa))/0xa*(parseInt(_0x5aa0b4(0x202))/0xb);if(_0x11d9c2===_0x414ce1)break;else _0x390ccc['push'](_0x390ccc['shift']());}catch(_0x1d1259){_0x390ccc['push'](_0x390ccc['shift']());}}}(a48_0x25b1,0x7bcb7));function a48_0x25b1(){const _0x2dbfc8=['Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','🇬🇧\x20Country:\x20','json','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','PAYMENT_COMPLETED','error','Unknown\x20error','redirect_url','defineProperty','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','status','data','11xJSsJH','ERR','payment_method_data','Unknown\x20error\x20from\x20Rapyd\x20API','💥\x20Rapyd\x20failure\x20message:\x20','headers','paid','JSON\x20Parse\x20Error:\x20','Response\x20Body:','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Error\x20Message:','Rapyd\x20API\x20error\x20(','cardLast4','now','1529658MzxnTq','Error\x20details:','statusText','application/json','loggerService','stack','Rapyd\x20payment\x20verification\x20error:','CLO','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Response\x20Time:','fromEntries','1045324dWtBDH','toISOString','6022275YTEyVi','floor','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','payment_method_type','logWhiteDomainRequest','failure_message','Request\x20Body\x20(Updated\x20Format):','9YrDLSv','ORDER:\x20','Rapyd\x20API\x20error:\x20','logWhiteDomainResponse','apiUrl','Payment\x20Link\x20ID:','\x20\x20\x20expiration:\x20','Redirect\x20URL:','buy','/v1/hosted/payment_links/','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Headers:','23343410oCLAXb','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','expiration','CAN','Full\x20Error\x20Data:','SUCCESS','currency','toUpperCase','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','logWhiteDomainError','error_code','HTTP\x20Status:','/v1/hosted/payment_links','):\x20','__esModule','rapyd','Status\x20Text:','Error\x20message:','amount','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','TesSoft\x20Payment\x20System/1.0','RapydService','\x20(always\x20GB\x20for\x20Rapyd)','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','119748rkRUtf','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Response\x20data:','ACT','EUR','Error\x20stack:','failure_code','Business\x20Error\x20(','===\x20RAPYD\x20API\x20ERROR\x20===',',\x20body:\x20','URL:','Error\x20Code:','HTTP\x20error!\x20status:\x20','log','https://tesoft.uk/gateway/success.php?id=','PENDING','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','entries','merchant_reference_id','requested_currency','\x20->\x20EUR:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','8gQqtAs','4773519zYVUrp','POST','processWebhook','25XaQguY','EXP','Parsed\x20Result:','PAID','Missing\x20id\x20or\x20redirect_url\x20in\x20response','GET','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','gb_visa_card','https://tesoft.uk/gateway/fail.php?id=','EXPIRED','FAILED','PAYMENT_CANCELED','\x20(GB\x20-\x20Britain)','message','createPaymentLink','NEW','HTTP\x20','UNKNOWN','last4','stringify','\x20\x20\x20fixed_side:\x20buy','parse','48312iuCcfo','🇬🇧\x20Country\x20used:\x20','text','\x20\x20\x20requested_currency:\x20EUR'];a48_0x25b1=function(){return _0x2dbfc8;};return a48_0x25b1();}Object[a48_0x37cba3(0x1fe)](exports,a48_0x37cba3(0x1b8),{'value':!![]}),exports[a48_0x37cba3(0x1bf)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x5f5965=a48_0x37cba3;this[_0x5f5965(0x1a2)]='https://tesoft.uk/gateway/rapyd/',console[_0x5f5965(0x1cf)](_0x5f5965(0x191));}async[a48_0x37cba3(0x1ea)](_0x324f08){const _0x6ce014=a48_0x37cba3,{orderId:_0x1f5044,orderName:_0x1576fd,amount:_0x26a9b6,currency:_0x2e9259,usage:_0x23e54d,maxPayments:_0x12804c,successUrl:_0x37429b,failUrl:_0x3e3d2d}=_0x324f08,_0x4687a9=_0x2e9259[_0x6ce014(0x1b1)](),_0x6b7f91='GB';console[_0x6ce014(0x1cf)](_0x6ce014(0x184));const _0x520b10=_0x6ce014(0x1d0)+_0x1f5044,_0x1e2cb2=_0x6ce014(0x1e4)+_0x1f5044,_0x5a7270={'amount':_0x26a9b6,'currency':_0x4687a9,'cancel_checkout_url':_0x1e2cb2,'complete_checkout_url':_0x520b10,'complete_payment_url':_0x520b10,'merchant_reference_id':_0x1f5044,'description':_0x6ce014(0x19f)+_0x1f5044,'country':'GB','payment_method_types_include':[_0x6ce014(0x1e3),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}};if(_0x4687a9!=='EUR'){const _0x5332c5=Math[_0x6ce014(0x198)](Date[_0x6ce014(0x188)]()/0x3e8)+0x1e*0x3c;_0x5a7270['fixed_side']=_0x6ce014(0x1a6),_0x5a7270[_0x6ce014(0x1d5)]=_0x6ce014(0x1c6),_0x5a7270[_0x6ce014(0x1ac)]=_0x5332c5,console[_0x6ce014(0x1cf)]('💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20'+_0x4687a9+_0x6ce014(0x1d6)),console[_0x6ce014(0x1cf)](_0x6ce014(0x1f0)),console[_0x6ce014(0x1cf)](_0x6ce014(0x1f5)),console[_0x6ce014(0x1cf)](_0x6ce014(0x1a4)+_0x5332c5+'\x20('+new Date(_0x5332c5*0x3e8)[_0x6ce014(0x196)]()+')');}const _0x4ce94b=Date['now']();try{console[_0x6ce014(0x1cf)](_0x6ce014(0x1bd)),console[_0x6ce014(0x1cf)](_0x6ce014(0x1cc),this[_0x6ce014(0x1a2)]),console['log'](_0x6ce014(0x19d),JSON['stringify'](_0x5a7270,null,0x2)),console[_0x6ce014(0x1cf)](_0x6ce014(0x1f7)+_0x6b7f91+_0x6ce014(0x1c0)),console[_0x6ce014(0x1cf)](_0x6ce014(0x199)),loggerService_1['loggerService'][_0x6ce014(0x19b)]('rapyd',_0x6ce014(0x1b6),_0x6ce014(0x1da),_0x5a7270);const _0x3d8125=await fetch(this['apiUrl'],{'method':_0x6ce014(0x1da),'headers':{'Content-Type':_0x6ce014(0x18c),'User-Agent':_0x6ce014(0x1be)},'body':JSON[_0x6ce014(0x1ef)](_0x5a7270)}),_0x47f3c2=Date[_0x6ce014(0x188)]()-_0x4ce94b;console['log'](_0x6ce014(0x1d2)),console[_0x6ce014(0x1cf)]('Status:',_0x3d8125['status']),console[_0x6ce014(0x1cf)](_0x6ce014(0x1ba),_0x3d8125[_0x6ce014(0x18b)]),console[_0x6ce014(0x1cf)](_0x6ce014(0x1a9),Object[_0x6ce014(0x194)](_0x3d8125[_0x6ce014(0x180)][_0x6ce014(0x1d3)]())),console[_0x6ce014(0x1cf)](_0x6ce014(0x193),_0x47f3c2+'ms');const _0x6e6cb2=await _0x3d8125[_0x6ce014(0x1f4)]();console[_0x6ce014(0x1cf)]('Raw\x20Response\x20Body:',_0x6e6cb2);if(!_0x3d8125['ok']){console['error'](_0x6ce014(0x1ca)),console['error'](_0x6ce014(0x1b5),_0x3d8125[_0x6ce014(0x200)]),console[_0x6ce014(0x1fb)](_0x6ce014(0x183),_0x6e6cb2),loggerService_1[_0x6ce014(0x18d)][_0x6ce014(0x1a1)](_0x6ce014(0x1b9),_0x6ce014(0x1b6),_0x3d8125[_0x6ce014(0x200)],_0x6e6cb2,_0x47f3c2),loggerService_1[_0x6ce014(0x18d)][_0x6ce014(0x1b3)]('rapyd',_0x6ce014(0x1b6),_0x6ce014(0x1ec)+_0x3d8125[_0x6ce014(0x200)]+':\x20'+_0x6e6cb2);throw new Error(_0x6ce014(0x1ce)+_0x3d8125[_0x6ce014(0x200)]+_0x6ce014(0x1cb)+_0x6e6cb2);}let _0x561aa3;try{_0x561aa3=JSON[_0x6ce014(0x1f1)](_0x6e6cb2);}catch(_0x335d98){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x335d98),loggerService_1[_0x6ce014(0x18d)]['logWhiteDomainError'](_0x6ce014(0x1b9),'/v1/hosted/payment_links',_0x6ce014(0x182)+_0x335d98);throw new Error(_0x6ce014(0x1e2)+_0x6e6cb2);}console[_0x6ce014(0x1cf)](_0x6ce014(0x1f9)),console[_0x6ce014(0x1cf)](_0x6ce014(0x1de),JSON[_0x6ce014(0x1ef)](_0x561aa3,null,0x2)),loggerService_1[_0x6ce014(0x18d)][_0x6ce014(0x1a1)]('rapyd',_0x6ce014(0x1b6),_0x3d8125[_0x6ce014(0x200)],_0x561aa3,_0x47f3c2);if(_0x561aa3[_0x6ce014(0x200)]?.[_0x6ce014(0x200)]!==_0x6ce014(0x1af)){const _0x56ec1a=_0x561aa3[_0x6ce014(0x200)]?.[_0x6ce014(0x1e9)]||_0x6ce014(0x205),_0x2623ef=_0x561aa3[_0x6ce014(0x200)]?.[_0x6ce014(0x1b4)]||_0x6ce014(0x1ed);console['error'](_0x6ce014(0x1a8)),console[_0x6ce014(0x1fb)](_0x6ce014(0x1cd),_0x2623ef),console[_0x6ce014(0x1fb)](_0x6ce014(0x185),_0x56ec1a),console['error'](_0x6ce014(0x1ae),_0x561aa3[_0x6ce014(0x200)]),loggerService_1[_0x6ce014(0x18d)][_0x6ce014(0x1b3)](_0x6ce014(0x1b9),'/v1/hosted/payment_links',_0x6ce014(0x1c9)+_0x2623ef+_0x6ce014(0x1b7)+_0x56ec1a);throw new Error(_0x6ce014(0x186)+_0x2623ef+_0x6ce014(0x1b7)+_0x56ec1a);}if(!_0x561aa3[_0x6ce014(0x201)]?.['id']||!_0x561aa3[_0x6ce014(0x201)]?.[_0x6ce014(0x1fd)]){console[_0x6ce014(0x1fb)](_0x6ce014(0x1c1)),console[_0x6ce014(0x1fb)](_0x6ce014(0x1e0)),console[_0x6ce014(0x1fb)](_0x6ce014(0x1c4),_0x561aa3[_0x6ce014(0x201)]),loggerService_1[_0x6ce014(0x18d)]['logWhiteDomainError'](_0x6ce014(0x1b9),_0x6ce014(0x1b6),_0x6ce014(0x1c3));throw new Error(_0x6ce014(0x192));}return console[_0x6ce014(0x1cf)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x6ce014(0x1cf)](_0x6ce014(0x1a3),_0x561aa3['data']['id']),console['log'](_0x6ce014(0x1a5),_0x561aa3[_0x6ce014(0x201)][_0x6ce014(0x1fd)]),console[_0x6ce014(0x1cf)](_0x6ce014(0x1f3)+_0x6b7f91+_0x6ce014(0x1e8)),console['log']('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x561aa3['data']['id'],'payment_url':_0x561aa3[_0x6ce014(0x201)][_0x6ce014(0x1fd)]};}catch(_0x48e74a){console['error'](_0x6ce014(0x1d7)),console['error'](_0x6ce014(0x18a),_0x48e74a),loggerService_1['loggerService']['logWhiteDomainError'](_0x6ce014(0x1b9),'/v1/hosted/payment_links',_0x48e74a);if(_0x48e74a instanceof Error){console[_0x6ce014(0x1fb)](_0x6ce014(0x1bb),_0x48e74a['message']),console['error'](_0x6ce014(0x1c7),_0x48e74a[_0x6ce014(0x18e)]);throw new Error(_0x6ce014(0x1ab)+_0x48e74a[_0x6ce014(0x1e9)]);}throw new Error(_0x6ce014(0x1f6));}}async['verifyPayment'](_0x413075){const _0x1c8367=a48_0x37cba3,_0x3cdc37=Date['now']();try{loggerService_1[_0x1c8367(0x18d)][_0x1c8367(0x19b)](_0x1c8367(0x1b9),'/v1/hosted/payment_links/'+_0x413075,'GET',{});const _0x3025ec=await fetch(this[_0x1c8367(0x1a2)]+'/'+_0x413075,{'method':_0x1c8367(0x1e1),'headers':{'Content-Type':_0x1c8367(0x18c),'User-Agent':_0x1c8367(0x1be)}}),_0x2b7f32=Date['now']()-_0x3cdc37;if(!_0x3025ec['ok']){const _0x5163aa=await _0x3025ec['text']();loggerService_1[_0x1c8367(0x18d)][_0x1c8367(0x1a1)](_0x1c8367(0x1b9),'/v1/hosted/payment_links/'+_0x413075,_0x3025ec[_0x1c8367(0x200)],_0x5163aa,_0x2b7f32);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3025ec[_0x1c8367(0x200)]);}const _0x39f455=await _0x3025ec[_0x1c8367(0x1f8)]();loggerService_1[_0x1c8367(0x18d)][_0x1c8367(0x1a1)](_0x1c8367(0x1b9),_0x1c8367(0x1a7)+_0x413075,_0x3025ec[_0x1c8367(0x200)],_0x39f455,_0x2b7f32);if(_0x39f455['status']?.[_0x1c8367(0x200)]!==_0x1c8367(0x1af)){loggerService_1[_0x1c8367(0x18d)][_0x1c8367(0x1b3)](_0x1c8367(0x1b9),'/v1/hosted/payment_links/'+_0x413075,_0x1c8367(0x1a0)+(_0x39f455[_0x1c8367(0x200)]?.['message']||_0x1c8367(0x1fc)));throw new Error(_0x1c8367(0x1a0)+(_0x39f455['status']?.['message']||_0x1c8367(0x1fc)));}let _0x4d494f=_0x1c8367(0x1d1);if(_0x39f455['data']?.['status'])switch(_0x39f455[_0x1c8367(0x201)][_0x1c8367(0x200)][_0x1c8367(0x1b1)]()){case _0x1c8367(0x190):_0x4d494f=_0x1c8367(0x1df);break;case _0x1c8367(0x1ad):_0x4d494f=_0x1c8367(0x1e6);break;case'EXP':_0x4d494f='EXPIRED';break;case _0x1c8367(0x203):_0x4d494f=_0x1c8367(0x1e6);break;case _0x1c8367(0x1eb):case'ACT':default:_0x4d494f=_0x1c8367(0x1d1);break;}return{'status':_0x4d494f,'amount':_0x39f455[_0x1c8367(0x201)]?.['amount'],'currency':_0x39f455[_0x1c8367(0x201)]?.[_0x1c8367(0x1b0)]};}catch(_0x55e83c){console[_0x1c8367(0x1fb)](_0x1c8367(0x18f),_0x55e83c),loggerService_1['loggerService'][_0x1c8367(0x1b3)](_0x1c8367(0x1b9),_0x1c8367(0x1a7)+_0x413075,_0x55e83c);throw new Error(_0x1c8367(0x1ff)+(_0x55e83c instanceof Error?_0x55e83c[_0x1c8367(0x1e9)]:_0x1c8367(0x1fc)));}}async[a48_0x37cba3(0x1db)](_0x56d3a3){const _0x3881f9=a48_0x37cba3;console[_0x3881f9(0x1cf)]('Processing\x20Rapyd\x20webhook:',_0x56d3a3);let _0x53622e='PENDING',_0x486698;_0x56d3a3['data']?.['failure_message']&&(_0x486698=_0x56d3a3[_0x3881f9(0x201)][_0x3881f9(0x19c)],console[_0x3881f9(0x1cf)](_0x3881f9(0x206)+_0x486698));switch(_0x56d3a3['type']?.[_0x3881f9(0x1b1)]()){case _0x3881f9(0x1fa):_0x56d3a3[_0x3881f9(0x201)]?.[_0x3881f9(0x181)]===!![]&&_0x56d3a3[_0x3881f9(0x201)]?.[_0x3881f9(0x200)]===_0x3881f9(0x190)?_0x53622e=_0x3881f9(0x1df):_0x53622e=_0x3881f9(0x1d1);break;case _0x3881f9(0x1e7):_0x53622e=_0x3881f9(0x1e6);break;case'PAYMENT_EXPIRED':_0x53622e=_0x3881f9(0x1e5);break;case'PAYMENT_FAILED':_0x53622e=_0x3881f9(0x1e6);!_0x486698&&_0x56d3a3['data']?.['failure_message']&&(_0x486698=_0x56d3a3['data'][_0x3881f9(0x19c)]);break;default:switch(_0x56d3a3[_0x3881f9(0x201)]?.[_0x3881f9(0x200)]?.[_0x3881f9(0x1b1)]()){case'CLO':_0x56d3a3['data']?.[_0x3881f9(0x181)]===!![]?_0x53622e='PAID':_0x53622e=_0x3881f9(0x1e6);break;case'CAN':_0x53622e='FAILED';break;case _0x3881f9(0x1dd):_0x53622e='EXPIRED';break;case'ERR':_0x53622e='FAILED';!_0x486698&&_0x56d3a3[_0x3881f9(0x201)]?.[_0x3881f9(0x19c)]&&(_0x486698=_0x56d3a3[_0x3881f9(0x201)][_0x3881f9(0x19c)]);break;case'NEW':case _0x3881f9(0x1c5):default:_0x53622e=_0x3881f9(0x1d1);break;}break;}const _0x37964a={};return _0x56d3a3['data']?.[_0x3881f9(0x204)]?.[_0x3881f9(0x1ee)]&&(_0x37964a[_0x3881f9(0x187)]=_0x56d3a3['data'][_0x3881f9(0x204)][_0x3881f9(0x1ee)]),_0x56d3a3[_0x3881f9(0x201)]?.[_0x3881f9(0x19a)]&&(_0x37964a['paymentMethod']=_0x56d3a3['data'][_0x3881f9(0x19a)]),_0x56d3a3['data']?.['error_code']&&(_0x37964a['errorCode']=_0x56d3a3['data'][_0x3881f9(0x1b4)]),_0x56d3a3['data']?.[_0x3881f9(0x1c8)]&&(_0x37964a['failureCode']=_0x56d3a3[_0x3881f9(0x201)][_0x3881f9(0x1c8)]),console[_0x3881f9(0x1cf)](_0x3881f9(0x1b2)+_0x53622e+',\x20failureMessage='+(_0x486698||'none')),{'paymentId':_0x56d3a3[_0x3881f9(0x201)]?.[_0x3881f9(0x1d4)]||'','status':_0x53622e,'amount':_0x56d3a3[_0x3881f9(0x201)]?.[_0x3881f9(0x1bc)],'currency':_0x56d3a3[_0x3881f9(0x201)]?.['currency'],'failureMessage':_0x486698,'additionalInfo':_0x37964a};}}exports[a48_0x37cba3(0x1bf)]=RapydService;