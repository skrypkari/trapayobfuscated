'use strict';const a48_0x2b2c2e=a48_0x18e6;function a48_0x18e6(_0x884dcf,_0x1d10f2){const _0x17ed9a=a48_0x17ed();return a48_0x18e6=function(_0x18e68e,_0xa89e88){_0x18e68e=_0x18e68e-0x147;let _0x7ebf0f=_0x17ed9a[_0x18e68e];return _0x7ebf0f;},a48_0x18e6(_0x884dcf,_0x1d10f2);}function a48_0x17ed(){const _0x37e498=['Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','HTTP\x20Status:','PAYMENT_COMPLETED','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Status\x20Text:','log','__esModule','merchant_reference_id','Unknown\x20error\x20from\x20Rapyd\x20API','last4','Response\x20data:','639108BKVsye','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','RapydService','currency','rapyd','CAN','4HDEYAM','Error\x20Code:','HTTP\x20','/v1/hosted/payment_links/','failure_code','gb_visa_card','payment_method_type','5700vmlggv','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','EXP','logWhiteDomainRequest','2853180qwDPPz',',\x20failureMessage=','ORDER:\x20','https://tesoft.uk/gateway/rapyd/','\x20(GB\x20-\x20Britain)','verifyPayment','1478264QXfdoP','\x20(always\x20GB\x20for\x20Rapyd)','Unknown\x20error','stringify','Processing\x20Rapyd\x20webhook:','Error\x20details:','ERR','Response\x20Time:','/v1/hosted/payment_links','TesSoft\x20Payment\x20System/1.0','Rapyd\x20API\x20error:\x20','payment_method_data','EXPIRED','status','FAILED','fromEntries','ACT','URL:','CLO','GET','createPaymentLink','failure_message','toISOString','\x20\x20\x20fixed_side:\x20buy','data','amount','error_code','logWhiteDomainError','now','json','message','PAYMENT_EXPIRED','\x20\x20\x20requested_currency:\x20EUR','error','type','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','1181618zHbfoD','errorCode','logWhiteDomainResponse','305611EhPJoT','apiUrl','Missing\x20id\x20or\x20redirect_url\x20in\x20response','failureCode','expiration','redirect_url','https://tesoft.uk/gateway/fail.php?id=','UNKNOWN','2828GanYrQ','Rapyd\x20payment\x20verification\x20error:','processWebhook','text','loggerService','headers','toUpperCase','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','https://tesoft.uk/gateway/success.php?id=','EUR','Full\x20Error\x20Data:','🇬🇧\x20Country:\x20','SUCCESS','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20message:','Error\x20stack:','Rapyd\x20API\x20error\x20(','===\x20RAPYD\x20API\x20ERROR\x20===','681635WgGRvt','paid','PENDING','PAID','):\x20','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','Response\x20Body:','statusText','POST','Status:','Failed\x20to\x20parse\x20JSON\x20response:','cardLast4','Headers:','requested_currency','entries'];a48_0x17ed=function(){return _0x37e498;};return a48_0x17ed();}(function(_0x138a94,_0x3b0cc6){const _0x4ee2a4=a48_0x18e6,_0x4570ff=_0x138a94();while(!![]){try{const _0x33fe6f=parseInt(_0x4ee2a4(0x18f))/0x1+-parseInt(_0x4ee2a4(0x18c))/0x2+parseInt(_0x4ee2a4(0x151))/0x3*(parseInt(_0x4ee2a4(0x157))/0x4)+parseInt(_0x4ee2a4(0x1a9))/0x5+-parseInt(_0x4ee2a4(0x15e))/0x6*(-parseInt(_0x4ee2a4(0x197))/0x7)+parseInt(_0x4ee2a4(0x168))/0x8+-parseInt(_0x4ee2a4(0x162))/0x9;if(_0x33fe6f===_0x3b0cc6)break;else _0x4570ff['push'](_0x4570ff['shift']());}catch(_0x2e668d){_0x4570ff['push'](_0x4570ff['shift']());}}}(a48_0x17ed,0x4d150));Object['defineProperty'](exports,a48_0x2b2c2e(0x14c),{'value':!![]}),exports[a48_0x2b2c2e(0x153)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0xf0f93a=a48_0x2b2c2e;this[_0xf0f93a(0x190)]=_0xf0f93a(0x165),console[_0xf0f93a(0x14b)]('🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a48_0x2b2c2e(0x17c)](_0x139456){const _0xef180b=a48_0x2b2c2e,{orderId:_0x551d65,orderName:_0x4d71a7,amount:_0x33d28f,currency:_0x538e28,usage:_0x1b07d6,maxPayments:_0x1d6a33,successUrl:_0x12e0fd,failUrl:_0x2f027b}=_0x139456,_0x5e675c=_0x538e28['toUpperCase'](),_0x12c8f6='GB';console[_0xef180b(0x14b)](_0xef180b(0x152));const _0x185701=_0xef180b(0x19f)+_0x551d65,_0x137c88=_0xef180b(0x195)+_0x551d65,_0x2c5dde={'amount':_0x33d28f,'currency':_0x5e675c,'cancel_checkout_url':_0x137c88,'complete_checkout_url':_0x185701,'complete_payment_url':_0x185701,'merchant_reference_id':_0x551d65,'description':_0xef180b(0x164)+_0x551d65,'country':'GB','payment_method_types_include':[_0xef180b(0x15c),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}};if(_0x5e675c!==_0xef180b(0x1a0)){const _0x7ca375=Math['floor'](Date[_0xef180b(0x184)]()/0x3e8)+0x1e*0x3c;_0x2c5dde['fixed_side']='buy',_0x2c5dde[_0xef180b(0x1b8)]=_0xef180b(0x1a0),_0x2c5dde[_0xef180b(0x193)]=_0x7ca375,console['log']('💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20'+_0x5e675c+'\x20->\x20EUR:'),console[_0xef180b(0x14b)](_0xef180b(0x17f)),console[_0xef180b(0x14b)](_0xef180b(0x188)),console[_0xef180b(0x14b)]('\x20\x20\x20expiration:\x20'+_0x7ca375+'\x20('+new Date(_0x7ca375*0x3e8)[_0xef180b(0x17e)]()+')');}const _0x126bdc=Date[_0xef180b(0x184)]();try{console[_0xef180b(0x14b)](_0xef180b(0x1ae)),console[_0xef180b(0x14b)](_0xef180b(0x179),this[_0xef180b(0x190)]),console['log']('Request\x20Body\x20(Updated\x20Format):',JSON[_0xef180b(0x16b)](_0x2c5dde,null,0x2)),console['log'](_0xef180b(0x1a2)+_0x12c8f6+_0xef180b(0x169)),console[_0xef180b(0x14b)](_0xef180b(0x15f)),loggerService_1[_0xef180b(0x19b)][_0xef180b(0x161)]('rapyd',_0xef180b(0x170),_0xef180b(0x1b3),_0x2c5dde);const _0x218b7d=await fetch(this['apiUrl'],{'method':_0xef180b(0x1b3),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xef180b(0x16b)](_0x2c5dde)}),_0x238aca=Date[_0xef180b(0x184)]()-_0x126bdc;console['log'](_0xef180b(0x1a4)),console[_0xef180b(0x14b)](_0xef180b(0x1b4),_0x218b7d[_0xef180b(0x175)]),console[_0xef180b(0x14b)](_0xef180b(0x14a),_0x218b7d[_0xef180b(0x1b2)]),console[_0xef180b(0x14b)](_0xef180b(0x1b7),Object[_0xef180b(0x177)](_0x218b7d[_0xef180b(0x19c)][_0xef180b(0x1b9)]())),console['log'](_0xef180b(0x16f),_0x238aca+'ms');const _0x42731a=await _0x218b7d[_0xef180b(0x19a)]();console[_0xef180b(0x14b)]('Raw\x20Response\x20Body:',_0x42731a);if(!_0x218b7d['ok']){console['error'](_0xef180b(0x1a8)),console['error'](_0xef180b(0x147),_0x218b7d[_0xef180b(0x175)]),console[_0xef180b(0x189)](_0xef180b(0x1b1),_0x42731a),loggerService_1['loggerService'][_0xef180b(0x18e)](_0xef180b(0x155),_0xef180b(0x170),_0x218b7d[_0xef180b(0x175)],_0x42731a,_0x238aca),loggerService_1[_0xef180b(0x19b)]['logWhiteDomainError']('rapyd',_0xef180b(0x170),_0xef180b(0x159)+_0x218b7d[_0xef180b(0x175)]+':\x20'+_0x42731a);throw new Error(_0xef180b(0x1b0)+_0x218b7d[_0xef180b(0x175)]+',\x20body:\x20'+_0x42731a);}let _0x35d03f;try{_0x35d03f=JSON['parse'](_0x42731a);}catch(_0x225aec){console[_0xef180b(0x189)](_0xef180b(0x1b5),_0x225aec),loggerService_1[_0xef180b(0x19b)][_0xef180b(0x183)](_0xef180b(0x155),_0xef180b(0x170),'JSON\x20Parse\x20Error:\x20'+_0x225aec);throw new Error(_0xef180b(0x1ba)+_0x42731a);}console[_0xef180b(0x14b)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0xef180b(0x16b)](_0x35d03f,null,0x2)),loggerService_1[_0xef180b(0x19b)][_0xef180b(0x18e)](_0xef180b(0x155),_0xef180b(0x170),_0x218b7d[_0xef180b(0x175)],_0x35d03f,_0x238aca);if(_0x35d03f[_0xef180b(0x175)]?.[_0xef180b(0x175)]!==_0xef180b(0x1a3)){const _0x648e76=_0x35d03f[_0xef180b(0x175)]?.[_0xef180b(0x186)]||_0xef180b(0x14e),_0x5e8dd8=_0x35d03f[_0xef180b(0x175)]?.['error_code']||_0xef180b(0x196);console[_0xef180b(0x189)](_0xef180b(0x18b)),console['error'](_0xef180b(0x158),_0x5e8dd8),console[_0xef180b(0x189)]('Error\x20Message:',_0x648e76),console[_0xef180b(0x189)](_0xef180b(0x1a1),_0x35d03f['status']),loggerService_1['loggerService']['logWhiteDomainError'](_0xef180b(0x155),_0xef180b(0x170),'Business\x20Error\x20('+_0x5e8dd8+_0xef180b(0x1ad)+_0x648e76);throw new Error(_0xef180b(0x1a7)+_0x5e8dd8+'):\x20'+_0x648e76);}if(!_0x35d03f[_0xef180b(0x180)]?.['id']||!_0x35d03f[_0xef180b(0x180)]?.[_0xef180b(0x194)]){console[_0xef180b(0x189)](_0xef180b(0x1af)),console[_0xef180b(0x189)](_0xef180b(0x191)),console[_0xef180b(0x189)](_0xef180b(0x150),_0x35d03f[_0xef180b(0x180)]),loggerService_1[_0xef180b(0x19b)]['logWhiteDomainError'](_0xef180b(0x155),_0xef180b(0x170),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0xef180b(0x149));}return console[_0xef180b(0x14b)]('===\x20RAPYD\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0x35d03f['data']['id']),console['log']('Redirect\x20URL:',_0x35d03f[_0xef180b(0x180)][_0xef180b(0x194)]),console[_0xef180b(0x14b)]('🇬🇧\x20Country\x20used:\x20'+_0x12c8f6+_0xef180b(0x166)),console[_0xef180b(0x14b)](_0xef180b(0x15f)),{'gateway_payment_id':_0x35d03f[_0xef180b(0x180)]['id'],'payment_url':_0x35d03f[_0xef180b(0x180)][_0xef180b(0x194)]};}catch(_0x78ac5e){console[_0xef180b(0x189)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0xef180b(0x189)](_0xef180b(0x16d),_0x78ac5e),loggerService_1[_0xef180b(0x19b)][_0xef180b(0x183)](_0xef180b(0x155),_0xef180b(0x170),_0x78ac5e);if(_0x78ac5e instanceof Error){console['error'](_0xef180b(0x1a5),_0x78ac5e['message']),console[_0xef180b(0x189)](_0xef180b(0x1a6),_0x78ac5e['stack']);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x78ac5e['message']);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a48_0x2b2c2e(0x167)](_0x218c48){const _0x1a5a87=a48_0x2b2c2e,_0x17c865=Date[_0x1a5a87(0x184)]();try{loggerService_1[_0x1a5a87(0x19b)][_0x1a5a87(0x161)](_0x1a5a87(0x155),_0x1a5a87(0x15a)+_0x218c48,_0x1a5a87(0x17b),{});const _0x2d4584=await fetch(this['apiUrl']+'/'+_0x218c48,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x1a5a87(0x171)}}),_0x19ff77=Date['now']()-_0x17c865;if(!_0x2d4584['ok']){const _0x45b07d=await _0x2d4584['text']();loggerService_1['loggerService'][_0x1a5a87(0x18e)](_0x1a5a87(0x155),_0x1a5a87(0x15a)+_0x218c48,_0x2d4584['status'],_0x45b07d,_0x19ff77);throw new Error(_0x1a5a87(0x1b0)+_0x2d4584[_0x1a5a87(0x175)]);}const _0x136dec=await _0x2d4584[_0x1a5a87(0x185)]();loggerService_1[_0x1a5a87(0x19b)][_0x1a5a87(0x18e)]('rapyd',_0x1a5a87(0x15a)+_0x218c48,_0x2d4584['status'],_0x136dec,_0x19ff77);if(_0x136dec['status']?.['status']!=='SUCCESS'){loggerService_1[_0x1a5a87(0x19b)]['logWhiteDomainError'](_0x1a5a87(0x155),_0x1a5a87(0x15a)+_0x218c48,_0x1a5a87(0x172)+(_0x136dec[_0x1a5a87(0x175)]?.['message']||_0x1a5a87(0x16a)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x136dec[_0x1a5a87(0x175)]?.[_0x1a5a87(0x186)]||'Unknown\x20error'));}let _0x2a6d2c=_0x1a5a87(0x1ab);if(_0x136dec[_0x1a5a87(0x180)]?.[_0x1a5a87(0x175)])switch(_0x136dec[_0x1a5a87(0x180)][_0x1a5a87(0x175)][_0x1a5a87(0x19d)]()){case _0x1a5a87(0x17a):_0x2a6d2c=_0x1a5a87(0x1ac);break;case _0x1a5a87(0x156):_0x2a6d2c=_0x1a5a87(0x176);break;case _0x1a5a87(0x160):_0x2a6d2c='EXPIRED';break;case _0x1a5a87(0x16e):_0x2a6d2c=_0x1a5a87(0x176);break;case'NEW':case'ACT':default:_0x2a6d2c='PENDING';break;}return{'status':_0x2a6d2c,'amount':_0x136dec[_0x1a5a87(0x180)]?.['amount'],'currency':_0x136dec[_0x1a5a87(0x180)]?.[_0x1a5a87(0x154)]};}catch(_0x5d28ba){console[_0x1a5a87(0x189)](_0x1a5a87(0x198),_0x5d28ba),loggerService_1[_0x1a5a87(0x19b)][_0x1a5a87(0x183)]('rapyd',_0x1a5a87(0x15a)+_0x218c48,_0x5d28ba);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x5d28ba instanceof Error?_0x5d28ba[_0x1a5a87(0x186)]:_0x1a5a87(0x16a)));}}async[a48_0x2b2c2e(0x199)](_0x4313b8){const _0xe54e6d=a48_0x2b2c2e;console[_0xe54e6d(0x14b)](_0xe54e6d(0x16c),_0x4313b8);let _0x2ab429=_0xe54e6d(0x1ab),_0x35d419;_0x4313b8['data']?.[_0xe54e6d(0x17d)]&&(_0x35d419=_0x4313b8['data']['failure_message'],console[_0xe54e6d(0x14b)]('💥\x20Rapyd\x20failure\x20message:\x20'+_0x35d419));switch(_0x4313b8[_0xe54e6d(0x18a)]?.[_0xe54e6d(0x19d)]()){case _0xe54e6d(0x148):_0x4313b8['data']?.[_0xe54e6d(0x1aa)]===!![]&&_0x4313b8['data']?.[_0xe54e6d(0x175)]===_0xe54e6d(0x17a)?_0x2ab429='PAID':_0x2ab429=_0xe54e6d(0x1ab);break;case'PAYMENT_CANCELED':_0x2ab429=_0xe54e6d(0x176);break;case _0xe54e6d(0x187):_0x2ab429='EXPIRED';break;case'PAYMENT_FAILED':_0x2ab429=_0xe54e6d(0x176);!_0x35d419&&_0x4313b8[_0xe54e6d(0x180)]?.[_0xe54e6d(0x17d)]&&(_0x35d419=_0x4313b8['data'][_0xe54e6d(0x17d)]);break;default:switch(_0x4313b8['data']?.[_0xe54e6d(0x175)]?.[_0xe54e6d(0x19d)]()){case'CLO':_0x4313b8['data']?.['paid']===!![]?_0x2ab429=_0xe54e6d(0x1ac):_0x2ab429=_0xe54e6d(0x176);break;case _0xe54e6d(0x156):_0x2ab429=_0xe54e6d(0x176);break;case _0xe54e6d(0x160):_0x2ab429=_0xe54e6d(0x174);break;case _0xe54e6d(0x16e):_0x2ab429=_0xe54e6d(0x176);!_0x35d419&&_0x4313b8[_0xe54e6d(0x180)]?.['failure_message']&&(_0x35d419=_0x4313b8['data'][_0xe54e6d(0x17d)]);break;case'NEW':case _0xe54e6d(0x178):default:_0x2ab429=_0xe54e6d(0x1ab);break;}break;}const _0x24c3ef={};return _0x4313b8['data']?.['payment_method_data']?.[_0xe54e6d(0x14f)]&&(_0x24c3ef[_0xe54e6d(0x1b6)]=_0x4313b8[_0xe54e6d(0x180)][_0xe54e6d(0x173)][_0xe54e6d(0x14f)]),_0x4313b8[_0xe54e6d(0x180)]?.[_0xe54e6d(0x15d)]&&(_0x24c3ef['paymentMethod']=_0x4313b8['data'][_0xe54e6d(0x15d)]),_0x4313b8['data']?.[_0xe54e6d(0x182)]&&(_0x24c3ef[_0xe54e6d(0x18d)]=_0x4313b8['data'][_0xe54e6d(0x182)]),_0x4313b8[_0xe54e6d(0x180)]?.[_0xe54e6d(0x15b)]&&(_0x24c3ef[_0xe54e6d(0x192)]=_0x4313b8['data'][_0xe54e6d(0x15b)]),console[_0xe54e6d(0x14b)](_0xe54e6d(0x19e)+_0x2ab429+_0xe54e6d(0x163)+(_0x35d419||'none')),{'paymentId':_0x4313b8[_0xe54e6d(0x180)]?.[_0xe54e6d(0x14d)]||'','status':_0x2ab429,'amount':_0x4313b8[_0xe54e6d(0x180)]?.[_0xe54e6d(0x181)],'currency':_0x4313b8[_0xe54e6d(0x180)]?.[_0xe54e6d(0x154)],'failureMessage':_0x35d419,'additionalInfo':_0x24c3ef};}}exports[a48_0x2b2c2e(0x153)]=RapydService;