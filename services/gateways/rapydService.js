'use strict';const a45_0x181319=a45_0x3933;(function(_0x44dc08,_0x1d3707){const _0x531ad6=a45_0x3933,_0x15461e=_0x44dc08();while(!![]){try{const _0x8e067=-parseInt(_0x531ad6(0xb8))/0x1+parseInt(_0x531ad6(0xcf))/0x2+-parseInt(_0x531ad6(0xad))/0x3+-parseInt(_0x531ad6(0xcc))/0x4*(-parseInt(_0x531ad6(0xe7))/0x5)+-parseInt(_0x531ad6(0xa6))/0x6*(parseInt(_0x531ad6(0xab))/0x7)+parseInt(_0x531ad6(0xa8))/0x8*(-parseInt(_0x531ad6(0xb4))/0x9)+parseInt(_0x531ad6(0x97))/0xa;if(_0x8e067===_0x1d3707)break;else _0x15461e['push'](_0x15461e['shift']());}catch(_0x3d4b38){_0x15461e['push'](_0x15461e['shift']());}}}(a45_0x1b1a,0x7b85c));function a45_0x1b1a(){const _0x59bd2e=['URL:','Failed\x20to\x20parse\x20JSON\x20response:','Processing\x20Rapyd\x20webhook:','merchant_reference_id','entries','json',',\x20failureMessage=','loggerService','text','ERR','processWebhook','HTTP\x20Status:','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Parsed\x20Result:','RapydService','Response\x20Time:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','error','last4','logWhiteDomainError','Error\x20message:','rapyd','üí•\x20Rapyd\x20failure\x20message:\x20','Request\x20Body\x20(Updated\x20Format):','21475390PPYaXa','EXPIRED','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','stack','message','EXP','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','payment_method_type','defineProperty','PAYMENT_CANCELED','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','logWhiteDomainRequest','PAYMENT_FAILED','JSON\x20Parse\x20Error:\x20','824238bTSpXz','===\x20RAPYD\x20SUCCESS\x20===','6488qQjoBf','TesSoft\x20Payment\x20System/1.0','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','35EFPfBM','POST','2164011NCxTQN','statusText','Error\x20Code:','Error\x20Message:','https://tesoft.uk/gateway/fail.php?id=','ORDER:\x20','none','9252FzGgUw','errorCode','createPaymentLink','now','378580UXojvQ','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Unknown\x20error','headers','PAID','/v1/hosted/payment_links/','):\x20','failure_message','GET','Headers:','https://tesoft.uk/gateway/rapyd/','application/json','FAILED','paymentMethod','HTTP\x20error!\x20status:\x20','failure_code','CLO','gb_mastercard_card','data','apiUrl','4ejlaRK','Missing\x20id\x20or\x20redirect_url\x20in\x20response','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','1676934vmEoJv','\x20(always\x20GB\x20for\x20Rapyd)','PAYMENT_COMPLETED','Business\x20Error\x20(','PENDING','payment_method_data','Rapyd\x20API\x20error:\x20','\x20(GB\x20-\x20Britain)','https://tesoft.uk/gateway/success.php?id=','Status\x20Text:','Error\x20stack:','Status:','currency','NEW',',\x20body:\x20','Payment\x20Link\x20ID:','Response\x20data:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','error_code','log','CAN','logWhiteDomainResponse','ACT','amount','702160fUIUGG','paid','UNKNOWN','/v1/hosted/payment_links','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','status','gb_visa_card','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','SUCCESS','type','PAYMENT_EXPIRED','../loggerService','stringify','toUpperCase','redirect_url','Rapyd\x20payment\x20verification\x20error:'];a45_0x1b1a=function(){return _0x59bd2e;};return a45_0x1b1a();}Object[a45_0x181319(0x9f)](exports,'__esModule',{'value':!![]}),exports[a45_0x181319(0x8d)]=void 0x0;const loggerService_1=require(a45_0x181319(0x7a));function a45_0x3933(_0x1ab771,_0x5baa16){const _0x1b1a07=a45_0x1b1a();return a45_0x3933=function(_0x393379,_0x33a34c){_0x393379=_0x393379-0x79;let _0x395967=_0x1b1a07[_0x393379];return _0x395967;},a45_0x3933(_0x1ab771,_0x5baa16);}class RapydService{constructor(){const _0x40633f=a45_0x181319;this[_0x40633f(0xcb)]=_0x40633f(0xc2),console['log']('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a45_0x181319(0xb6)](_0x467bd1){const _0x4ec5e7=a45_0x181319,{orderId:_0x29c4bb,orderName:_0x24e1f3,amount:_0x29bd5f,currency:_0xe5d554,usage:_0x538456,maxPayments:_0x23abca,successUrl:_0xdb1fc9,failUrl:_0x38f5ee}=_0x467bd1,_0x4bef4b=_0xe5d554[_0x4ec5e7(0x7c)](),_0x8cf308='GB';console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xaa));const _0xf99506=_0x4ec5e7(0xd7)+_0x29c4bb,_0x44ac29=_0x4ec5e7(0xb1)+_0x29c4bb,_0xe4cb7={'amount':_0x29bd5f,'currency':_0x4bef4b,'cancel_checkout_url':_0x44ac29,'complete_checkout_url':_0xf99506,'complete_payment_url':_0xf99506,'merchant_reference_id':_0x29c4bb,'description':_0x4ec5e7(0xb2)+_0x29c4bb,'country':'GB','payment_method_types_include':[_0x4ec5e7(0xed),_0x4ec5e7(0xc9)],'custom_elements':{'display_description':!![]}},_0x1e3820=Date[_0x4ec5e7(0xb7)]();try{console['log'](_0x4ec5e7(0xeb)),console['log'](_0x4ec5e7(0x7f),this['apiUrl']),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0x96),JSON[_0x4ec5e7(0x7b)](_0xe4cb7,null,0x2)),console[_0x4ec5e7(0xe2)]('üá¨üáß\x20Country:\x20'+_0x8cf308+_0x4ec5e7(0xd0)),console['log'](_0x4ec5e7(0x9d)),loggerService_1['loggerService'][_0x4ec5e7(0xa3)]('rapyd','/v1/hosted/payment_links',_0x4ec5e7(0xac),_0xe4cb7);const _0x30d3c3=await fetch(this[_0x4ec5e7(0xcb)],{'method':_0x4ec5e7(0xac),'headers':{'Content-Type':_0x4ec5e7(0xc3),'User-Agent':_0x4ec5e7(0xa9)},'body':JSON[_0x4ec5e7(0x7b)](_0xe4cb7)}),_0x2c0c5c=Date[_0x4ec5e7(0xb7)]()-_0x1e3820;console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xce)),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xda),_0x30d3c3[_0x4ec5e7(0xec)]),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xd8),_0x30d3c3[_0x4ec5e7(0xae)]),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xc1),Object['fromEntries'](_0x30d3c3[_0x4ec5e7(0xbb)][_0x4ec5e7(0x83)]())),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0x8e),_0x2c0c5c+'ms');const _0x3e1c74=await _0x30d3c3[_0x4ec5e7(0x87)]();console['log']('Raw\x20Response\x20Body:',_0x3e1c74);if(!_0x30d3c3['ok']){console[_0x4ec5e7(0x90)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x4ec5e7(0x90)](_0x4ec5e7(0x8a),_0x30d3c3[_0x4ec5e7(0xec)]),console[_0x4ec5e7(0x90)]('Response\x20Body:',_0x3e1c74),loggerService_1[_0x4ec5e7(0x86)][_0x4ec5e7(0xe4)](_0x4ec5e7(0x94),_0x4ec5e7(0xea),_0x30d3c3['status'],_0x3e1c74,_0x2c0c5c),loggerService_1['loggerService'][_0x4ec5e7(0x92)](_0x4ec5e7(0x94),'/v1/hosted/payment_links','HTTP\x20'+_0x30d3c3[_0x4ec5e7(0xec)]+':\x20'+_0x3e1c74);throw new Error(_0x4ec5e7(0xc6)+_0x30d3c3['status']+_0x4ec5e7(0xdd)+_0x3e1c74);}let _0x5b3865;try{_0x5b3865=JSON['parse'](_0x3e1c74);}catch(_0x3fa996){console[_0x4ec5e7(0x90)](_0x4ec5e7(0x80),_0x3fa996),loggerService_1[_0x4ec5e7(0x86)][_0x4ec5e7(0x92)](_0x4ec5e7(0x94),_0x4ec5e7(0xea),_0x4ec5e7(0xa5)+_0x3fa996);throw new Error(_0x4ec5e7(0x99)+_0x3e1c74);}console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xee)),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0x8c),JSON[_0x4ec5e7(0x7b)](_0x5b3865,null,0x2)),loggerService_1[_0x4ec5e7(0x86)][_0x4ec5e7(0xe4)](_0x4ec5e7(0x94),_0x4ec5e7(0xea),_0x30d3c3['status'],_0x5b3865,_0x2c0c5c);if(_0x5b3865['status']?.[_0x4ec5e7(0xec)]!==_0x4ec5e7(0xef)){const _0x5eab5f=_0x5b3865[_0x4ec5e7(0xec)]?.[_0x4ec5e7(0x9b)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x379060=_0x5b3865['status']?.[_0x4ec5e7(0xe1)]||_0x4ec5e7(0xe9);console[_0x4ec5e7(0x90)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4ec5e7(0x90)](_0x4ec5e7(0xaf),_0x379060),console['error'](_0x4ec5e7(0xb0),_0x5eab5f),console[_0x4ec5e7(0x90)]('Full\x20Error\x20Data:',_0x5b3865[_0x4ec5e7(0xec)]),loggerService_1[_0x4ec5e7(0x86)]['logWhiteDomainError'](_0x4ec5e7(0x94),_0x4ec5e7(0xea),_0x4ec5e7(0xd2)+_0x379060+_0x4ec5e7(0xbe)+_0x5eab5f);throw new Error('Rapyd\x20API\x20error\x20('+_0x379060+_0x4ec5e7(0xbe)+_0x5eab5f);}if(!_0x5b3865[_0x4ec5e7(0xca)]?.['id']||!_0x5b3865['data']?.[_0x4ec5e7(0x7d)]){console['error'](_0x4ec5e7(0x8b)),console[_0x4ec5e7(0x90)](_0x4ec5e7(0xcd)),console[_0x4ec5e7(0x90)](_0x4ec5e7(0xdf),_0x5b3865[_0x4ec5e7(0xca)]),loggerService_1[_0x4ec5e7(0x86)]['logWhiteDomainError']('rapyd','/v1/hosted/payment_links',_0x4ec5e7(0xa2));throw new Error(_0x4ec5e7(0xb9));}return console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xa7)),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0xde),_0x5b3865[_0x4ec5e7(0xca)]['id']),console[_0x4ec5e7(0xe2)]('Redirect\x20URL:',_0x5b3865[_0x4ec5e7(0xca)][_0x4ec5e7(0x7d)]),console[_0x4ec5e7(0xe2)]('üá¨üáß\x20Country\x20used:\x20'+_0x8cf308+_0x4ec5e7(0xd6)),console[_0x4ec5e7(0xe2)](_0x4ec5e7(0x9d)),{'gateway_payment_id':_0x5b3865[_0x4ec5e7(0xca)]['id'],'payment_url':_0x5b3865['data'][_0x4ec5e7(0x7d)]};}catch(_0xe43af3){console['error']('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0xe43af3),loggerService_1[_0x4ec5e7(0x86)][_0x4ec5e7(0x92)](_0x4ec5e7(0x94),_0x4ec5e7(0xea),_0xe43af3);if(_0xe43af3 instanceof Error){console[_0x4ec5e7(0x90)](_0x4ec5e7(0x93),_0xe43af3['message']),console[_0x4ec5e7(0x90)](_0x4ec5e7(0xd9),_0xe43af3[_0x4ec5e7(0x9a)]);throw new Error(_0x4ec5e7(0xe0)+_0xe43af3['message']);}throw new Error(_0x4ec5e7(0x8f));}}async['verifyPayment'](_0x317288){const _0x4ce7eb=a45_0x181319,_0x5c2ecd=Date[_0x4ce7eb(0xb7)]();try{loggerService_1[_0x4ce7eb(0x86)][_0x4ce7eb(0xa3)](_0x4ce7eb(0x94),_0x4ce7eb(0xbd)+_0x317288,'GET',{});const _0xc6bbf6=await fetch(this[_0x4ce7eb(0xcb)]+'/'+_0x317288,{'method':_0x4ce7eb(0xc0),'headers':{'Content-Type':_0x4ce7eb(0xc3),'User-Agent':_0x4ce7eb(0xa9)}}),_0x1131d2=Date[_0x4ce7eb(0xb7)]()-_0x5c2ecd;if(!_0xc6bbf6['ok']){const _0x39a374=await _0xc6bbf6[_0x4ce7eb(0x87)]();loggerService_1[_0x4ce7eb(0x86)][_0x4ce7eb(0xe4)](_0x4ce7eb(0x94),_0x4ce7eb(0xbd)+_0x317288,_0xc6bbf6['status'],_0x39a374,_0x1131d2);throw new Error(_0x4ce7eb(0xc6)+_0xc6bbf6['status']);}const _0x3981eb=await _0xc6bbf6[_0x4ce7eb(0x84)]();loggerService_1[_0x4ce7eb(0x86)][_0x4ce7eb(0xe4)](_0x4ce7eb(0x94),_0x4ce7eb(0xbd)+_0x317288,_0xc6bbf6[_0x4ce7eb(0xec)],_0x3981eb,_0x1131d2);if(_0x3981eb['status']?.[_0x4ce7eb(0xec)]!==_0x4ce7eb(0xef)){loggerService_1['loggerService'][_0x4ce7eb(0x92)](_0x4ce7eb(0x94),_0x4ce7eb(0xbd)+_0x317288,_0x4ce7eb(0xd5)+(_0x3981eb[_0x4ce7eb(0xec)]?.['message']||_0x4ce7eb(0xba)));throw new Error(_0x4ce7eb(0xd5)+(_0x3981eb[_0x4ce7eb(0xec)]?.[_0x4ce7eb(0x9b)]||_0x4ce7eb(0xba)));}let _0xaadfe0='PENDING';if(_0x3981eb[_0x4ce7eb(0xca)]?.[_0x4ce7eb(0xec)])switch(_0x3981eb[_0x4ce7eb(0xca)][_0x4ce7eb(0xec)][_0x4ce7eb(0x7c)]()){case _0x4ce7eb(0xc8):_0xaadfe0=_0x4ce7eb(0xbc);break;case _0x4ce7eb(0xe3):_0xaadfe0='FAILED';break;case _0x4ce7eb(0x9c):_0xaadfe0=_0x4ce7eb(0x98);break;case _0x4ce7eb(0x88):_0xaadfe0=_0x4ce7eb(0xc4);break;case _0x4ce7eb(0xdc):case'ACT':default:_0xaadfe0=_0x4ce7eb(0xd3);break;}return{'status':_0xaadfe0,'amount':_0x3981eb[_0x4ce7eb(0xca)]?.['amount'],'currency':_0x3981eb[_0x4ce7eb(0xca)]?.[_0x4ce7eb(0xdb)]};}catch(_0x3eeb0d){console['error'](_0x4ce7eb(0x7e),_0x3eeb0d),loggerService_1['loggerService'][_0x4ce7eb(0x92)]('rapyd',_0x4ce7eb(0xbd)+_0x317288,_0x3eeb0d);throw new Error(_0x4ce7eb(0xa1)+(_0x3eeb0d instanceof Error?_0x3eeb0d[_0x4ce7eb(0x9b)]:_0x4ce7eb(0xba)));}}async[a45_0x181319(0x89)](_0x5e86cc){const _0x2d8a94=a45_0x181319;console[_0x2d8a94(0xe2)](_0x2d8a94(0x81),_0x5e86cc);let _0x4b504e=_0x2d8a94(0xd3),_0x297730;_0x5e86cc[_0x2d8a94(0xca)]?.['failure_message']&&(_0x297730=_0x5e86cc['data'][_0x2d8a94(0xbf)],console['log'](_0x2d8a94(0x95)+_0x297730));switch(_0x5e86cc[_0x2d8a94(0xf0)]?.[_0x2d8a94(0x7c)]()){case _0x2d8a94(0xd1):_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0xe8)]===!![]&&_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0xec)]==='CLO'?_0x4b504e='PAID':_0x4b504e=_0x2d8a94(0xd3);break;case _0x2d8a94(0xa0):_0x4b504e='FAILED';break;case _0x2d8a94(0x79):_0x4b504e='EXPIRED';break;case _0x2d8a94(0xa4):_0x4b504e=_0x2d8a94(0xc4);!_0x297730&&_0x5e86cc['data']?.[_0x2d8a94(0xbf)]&&(_0x297730=_0x5e86cc[_0x2d8a94(0xca)][_0x2d8a94(0xbf)]);break;default:switch(_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0xec)]?.['toUpperCase']()){case'CLO':_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0xe8)]===!![]?_0x4b504e=_0x2d8a94(0xbc):_0x4b504e=_0x2d8a94(0xc4);break;case'CAN':_0x4b504e=_0x2d8a94(0xc4);break;case _0x2d8a94(0x9c):_0x4b504e=_0x2d8a94(0x98);break;case _0x2d8a94(0x88):_0x4b504e='FAILED';!_0x297730&&_0x5e86cc['data']?.[_0x2d8a94(0xbf)]&&(_0x297730=_0x5e86cc[_0x2d8a94(0xca)]['failure_message']);break;case _0x2d8a94(0xdc):case _0x2d8a94(0xe5):default:_0x4b504e='PENDING';break;}break;}const _0x521963={};return _0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0xd4)]?.[_0x2d8a94(0x91)]&&(_0x521963['cardLast4']=_0x5e86cc['data'][_0x2d8a94(0xd4)][_0x2d8a94(0x91)]),_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0x9e)]&&(_0x521963[_0x2d8a94(0xc5)]=_0x5e86cc[_0x2d8a94(0xca)]['payment_method_type']),_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0xe1)]&&(_0x521963[_0x2d8a94(0xb5)]=_0x5e86cc['data'][_0x2d8a94(0xe1)]),_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0xc7)]&&(_0x521963['failureCode']=_0x5e86cc[_0x2d8a94(0xca)][_0x2d8a94(0xc7)]),console['log']('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x4b504e+_0x2d8a94(0x85)+(_0x297730||_0x2d8a94(0xb3))),{'paymentId':_0x5e86cc[_0x2d8a94(0xca)]?.[_0x2d8a94(0x82)]||'','status':_0x4b504e,'amount':_0x5e86cc['data']?.[_0x2d8a94(0xe6)],'currency':_0x5e86cc[_0x2d8a94(0xca)]?.['currency'],'failureMessage':_0x297730,'additionalInfo':_0x521963};}}exports[a45_0x181319(0x8d)]=RapydService;