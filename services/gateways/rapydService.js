'use strict';const a45_0x574fe7=a45_0x5b0b;(function(_0x7d517a,_0x24f1ec){const _0x331d95=a45_0x5b0b,_0x3cf9d8=_0x7d517a();while(!![]){try{const _0x23d0a3=parseInt(_0x331d95(0x1c7))/0x1+parseInt(_0x331d95(0x1f8))/0x2+parseInt(_0x331d95(0x1e0))/0x3+parseInt(_0x331d95(0x1e1))/0x4+parseInt(_0x331d95(0x1f1))/0x5+parseInt(_0x331d95(0x1d6))/0x6+parseInt(_0x331d95(0x1cf))/0x7*(-parseInt(_0x331d95(0x219))/0x8);if(_0x23d0a3===_0x24f1ec)break;else _0x3cf9d8['push'](_0x3cf9d8['shift']());}catch(_0x2c5016){_0x3cf9d8['push'](_0x3cf9d8['shift']());}}}(a45_0x22e3,0x55174));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a45_0x574fe7(0x1d0)]=void 0x0;function a45_0x22e3(){const _0x4e5a83=['fromEntries','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','POST','gb_visa_card','parse','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','payment_method_type','Business\x20Error\x20(','stack','/v1/hosted/payment_links/','paymentMethod','396877hJwQSE','error_code','entries','ACT','Response\x20Body:','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url',',\x20body:\x20','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','35RCxZVF','RapydService','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','error','PENDING','Missing\x20id\x20or\x20redirect_url\x20in\x20response','1939332SvPgpA','Status\x20Text:','CLO','logWhiteDomainResponse','PAYMENT_FAILED','HTTP\x20','PAYMENT_EXPIRED','üí•\x20Rapyd\x20failure\x20message:\x20','Response\x20data:','\x20(GB\x20-\x20Britain)','1420914MVaZox','1121628RZRByy','amount','Rapyd\x20API\x20error:\x20','json','ORDER:\x20','Headers:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','NEW','Full\x20Error\x20Data:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','failure_code','loggerService','type','toUpperCase','log','Failed\x20to\x20parse\x20JSON\x20response:','853545yUMssr','currency','Unknown\x20error\x20from\x20Rapyd\x20API','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','data','ERR','JSON\x20Parse\x20Error:\x20','1011058aswzdl','HTTP\x20error!\x20status:\x20','Error\x20message:','UNKNOWN','EXP','last4','Error\x20Code:','Rapyd\x20API\x20error\x20(','CAN','FAILED','https://tesoft.uk/gateway/rapyd/','statusText','redirect_url','now','Redirect\x20URL:','Raw\x20Response\x20Body:','logWhiteDomainError','URL:','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Unknown\x20error','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','Rapyd\x20payment\x20verification\x20error:','createPaymentLink','failure_message','üá¨üáß\x20Country:\x20','):\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','apiUrl','logWhiteDomainRequest','payment_method_data','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','EXPIRED','2882960bOTobr','SUCCESS','Error\x20details:','PAID','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','verifyPayment','cardLast4','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','rapyd','/v1/hosted/payment_links','\x20(always\x20GB\x20for\x20Rapyd)','text','message','Error\x20stack:','status','stringify','PAYMENT_COMPLETED','headers','paid','TesSoft\x20Payment\x20System/1.0','Payment\x20Link\x20ID:','Parsed\x20Result:'];a45_0x22e3=function(){return _0x4e5a83;};return a45_0x22e3();}const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x4b2c3c=a45_0x574fe7;this['apiUrl']=_0x4b2c3c(0x202),console[_0x4b2c3c(0x1ef)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a45_0x574fe7(0x20f)](_0x272f4b){const _0x1d0613=a45_0x574fe7,{orderId:_0x399aab,orderName:_0x33c6d3,amount:_0x3892a7,currency:_0x26dcab,usage:_0x480f8a,maxPayments:_0x4fd2c9,successUrl:_0x484171,failUrl:_0x2e3730}=_0x272f4b,_0x3cc1a8=_0x26dcab['toUpperCase'](),_0x171b7f='GB';console['log'](_0x1d0613(0x20a));const _0x398c1f='https://tesoft.uk/gateway/success.php?id='+_0x399aab,_0x19bbc7='https://tesoft.uk/gateway/fail.php?id='+_0x399aab,_0x6f1694={'amount':_0x3892a7,'currency':_0x3cc1a8,'cancel_checkout_url':_0x19bbc7,'complete_checkout_url':_0x398c1f,'complete_payment_url':_0x398c1f,'merchant_reference_id':_0x399aab,'description':_0x1d0613(0x1e5)+_0x399aab,'country':'GB','payment_method_types_include':[_0x1d0613(0x1bf),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x234920=Date[_0x1d0613(0x205)]();try{console['log'](_0x1d0613(0x220)),console[_0x1d0613(0x1ef)](_0x1d0613(0x209),this['apiUrl']),console[_0x1d0613(0x1ef)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x1d0613(0x228)](_0x6f1694,null,0x2)),console[_0x1d0613(0x1ef)](_0x1d0613(0x211)+_0x171b7f+_0x1d0613(0x223)),console[_0x1d0613(0x1ef)](_0x1d0613(0x20c)),loggerService_1[_0x1d0613(0x1ec)][_0x1d0613(0x215)](_0x1d0613(0x221),_0x1d0613(0x222),_0x1d0613(0x1be),_0x6f1694);const _0x3b0891=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x1d0613(0x1b9)},'body':JSON[_0x1d0613(0x228)](_0x6f1694)}),_0x139c61=Date['now']()-_0x234920;console[_0x1d0613(0x1ef)](_0x1d0613(0x21d)),console[_0x1d0613(0x1ef)]('Status:',_0x3b0891[_0x1d0613(0x227)]),console['log'](_0x1d0613(0x1d7),_0x3b0891[_0x1d0613(0x203)]),console['log'](_0x1d0613(0x1e6),Object[_0x1d0613(0x1bc)](_0x3b0891[_0x1d0613(0x22a)][_0x1d0613(0x1c9)]())),console[_0x1d0613(0x1ef)]('Response\x20Time:',_0x139c61+'ms');const _0x4a8120=await _0x3b0891[_0x1d0613(0x224)]();console[_0x1d0613(0x1ef)](_0x1d0613(0x207),_0x4a8120);if(!_0x3b0891['ok']){console[_0x1d0613(0x1d3)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x1d0613(0x1d3)]('HTTP\x20Status:',_0x3b0891[_0x1d0613(0x227)]),console['error'](_0x1d0613(0x1cb),_0x4a8120),loggerService_1[_0x1d0613(0x1ec)][_0x1d0613(0x1d9)]('rapyd',_0x1d0613(0x222),_0x3b0891[_0x1d0613(0x227)],_0x4a8120,_0x139c61),loggerService_1[_0x1d0613(0x1ec)][_0x1d0613(0x208)](_0x1d0613(0x221),'/v1/hosted/payment_links',_0x1d0613(0x1db)+_0x3b0891[_0x1d0613(0x227)]+':\x20'+_0x4a8120);throw new Error(_0x1d0613(0x1f9)+_0x3b0891['status']+_0x1d0613(0x1cd)+_0x4a8120);}let _0x2be189;try{_0x2be189=JSON[_0x1d0613(0x1c0)](_0x4a8120);}catch(_0x14c983){console[_0x1d0613(0x1d3)](_0x1d0613(0x1f0),_0x14c983),loggerService_1['loggerService'][_0x1d0613(0x208)](_0x1d0613(0x221),_0x1d0613(0x222),_0x1d0613(0x1f7)+_0x14c983);throw new Error(_0x1d0613(0x1ce)+_0x4a8120);}console['log'](_0x1d0613(0x1f4)),console[_0x1d0613(0x1ef)](_0x1d0613(0x1bb),JSON[_0x1d0613(0x228)](_0x2be189,null,0x2)),loggerService_1[_0x1d0613(0x1ec)]['logWhiteDomainResponse'](_0x1d0613(0x221),'/v1/hosted/payment_links',_0x3b0891['status'],_0x2be189,_0x139c61);if(_0x2be189[_0x1d0613(0x227)]?.['status']!==_0x1d0613(0x21a)){const _0x22466c=_0x2be189[_0x1d0613(0x227)]?.[_0x1d0613(0x225)]||_0x1d0613(0x1f3),_0x35efbc=_0x2be189['status']?.[_0x1d0613(0x1c8)]||_0x1d0613(0x1fb);console[_0x1d0613(0x1d3)](_0x1d0613(0x217)),console[_0x1d0613(0x1d3)](_0x1d0613(0x1fe),_0x35efbc),console[_0x1d0613(0x1d3)](_0x1d0613(0x1d2),_0x22466c),console[_0x1d0613(0x1d3)](_0x1d0613(0x1e9),_0x2be189[_0x1d0613(0x227)]),loggerService_1['loggerService'][_0x1d0613(0x208)](_0x1d0613(0x221),'/v1/hosted/payment_links',_0x1d0613(0x1c3)+_0x35efbc+_0x1d0613(0x212)+_0x22466c);throw new Error(_0x1d0613(0x1ff)+_0x35efbc+_0x1d0613(0x212)+_0x22466c);}if(!_0x2be189[_0x1d0613(0x1f5)]?.['id']||!_0x2be189['data']?.[_0x1d0613(0x204)]){console['error'](_0x1d0613(0x1d1)),console[_0x1d0613(0x1d3)](_0x1d0613(0x1d5)),console[_0x1d0613(0x1d3)](_0x1d0613(0x1de),_0x2be189[_0x1d0613(0x1f5)]),loggerService_1[_0x1d0613(0x1ec)][_0x1d0613(0x208)](_0x1d0613(0x221),_0x1d0613(0x222),_0x1d0613(0x1cc));throw new Error(_0x1d0613(0x1e7));}return console[_0x1d0613(0x1ef)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x1d0613(0x1ef)](_0x1d0613(0x1ba),_0x2be189[_0x1d0613(0x1f5)]['id']),console[_0x1d0613(0x1ef)](_0x1d0613(0x206),_0x2be189['data'][_0x1d0613(0x204)]),console['log']('üá¨üáß\x20Country\x20used:\x20'+_0x171b7f+_0x1d0613(0x1df)),console[_0x1d0613(0x1ef)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x2be189[_0x1d0613(0x1f5)]['id'],'payment_url':_0x2be189[_0x1d0613(0x1f5)][_0x1d0613(0x204)]};}catch(_0x366d63){console[_0x1d0613(0x1d3)](_0x1d0613(0x1bd)),console['error'](_0x1d0613(0x21b),_0x366d63),loggerService_1['loggerService']['logWhiteDomainError'](_0x1d0613(0x221),_0x1d0613(0x222),_0x366d63);if(_0x366d63 instanceof Error){console[_0x1d0613(0x1d3)](_0x1d0613(0x1fa),_0x366d63['message']),console['error'](_0x1d0613(0x226),_0x366d63[_0x1d0613(0x1c4)]);throw new Error(_0x1d0613(0x1c1)+_0x366d63['message']);}throw new Error(_0x1d0613(0x213));}}async[a45_0x574fe7(0x21e)](_0x1f769e){const _0x552fc4=a45_0x574fe7,_0x2bdc37=Date[_0x552fc4(0x205)]();try{loggerService_1[_0x552fc4(0x1ec)][_0x552fc4(0x215)](_0x552fc4(0x221),_0x552fc4(0x1c5)+_0x1f769e,'GET',{});const _0x2386c7=await fetch(this[_0x552fc4(0x214)]+'/'+_0x1f769e,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x120db8=Date[_0x552fc4(0x205)]()-_0x2bdc37;if(!_0x2386c7['ok']){const _0x1da342=await _0x2386c7[_0x552fc4(0x224)]();loggerService_1[_0x552fc4(0x1ec)][_0x552fc4(0x1d9)]('rapyd',_0x552fc4(0x1c5)+_0x1f769e,_0x2386c7[_0x552fc4(0x227)],_0x1da342,_0x120db8);throw new Error(_0x552fc4(0x1f9)+_0x2386c7[_0x552fc4(0x227)]);}const _0x5946d1=await _0x2386c7[_0x552fc4(0x1e4)]();loggerService_1['loggerService'][_0x552fc4(0x1d9)]('rapyd','/v1/hosted/payment_links/'+_0x1f769e,_0x2386c7['status'],_0x5946d1,_0x120db8);if(_0x5946d1[_0x552fc4(0x227)]?.[_0x552fc4(0x227)]!=='SUCCESS'){loggerService_1['loggerService'][_0x552fc4(0x208)](_0x552fc4(0x221),_0x552fc4(0x1c5)+_0x1f769e,_0x552fc4(0x1e3)+(_0x5946d1[_0x552fc4(0x227)]?.['message']||_0x552fc4(0x20b)));throw new Error(_0x552fc4(0x1e3)+(_0x5946d1[_0x552fc4(0x227)]?.[_0x552fc4(0x225)]||_0x552fc4(0x20b)));}let _0x1bbdd1=_0x552fc4(0x1d4);if(_0x5946d1[_0x552fc4(0x1f5)]?.[_0x552fc4(0x227)])switch(_0x5946d1[_0x552fc4(0x1f5)][_0x552fc4(0x227)][_0x552fc4(0x1ee)]()){case _0x552fc4(0x1d8):_0x1bbdd1=_0x552fc4(0x21c);break;case'CAN':_0x1bbdd1='FAILED';break;case'EXP':_0x1bbdd1=_0x552fc4(0x218);break;case'ERR':_0x1bbdd1='FAILED';break;case _0x552fc4(0x1e8):case _0x552fc4(0x1ca):default:_0x1bbdd1=_0x552fc4(0x1d4);break;}return{'status':_0x1bbdd1,'amount':_0x5946d1[_0x552fc4(0x1f5)]?.[_0x552fc4(0x1e2)],'currency':_0x5946d1['data']?.[_0x552fc4(0x1f2)]};}catch(_0x5090f2){console[_0x552fc4(0x1d3)](_0x552fc4(0x20e),_0x5090f2),loggerService_1[_0x552fc4(0x1ec)][_0x552fc4(0x208)]('rapyd',_0x552fc4(0x1c5)+_0x1f769e,_0x5090f2);throw new Error(_0x552fc4(0x1ea)+(_0x5090f2 instanceof Error?_0x5090f2[_0x552fc4(0x225)]:'Unknown\x20error'));}}async['processWebhook'](_0x125fe3){const _0x4e0eec=a45_0x574fe7;console['log']('Processing\x20Rapyd\x20webhook:',_0x125fe3);let _0x247f49=_0x4e0eec(0x1d4),_0xb76fb7;_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x210)]&&(_0xb76fb7=_0x125fe3[_0x4e0eec(0x1f5)][_0x4e0eec(0x210)],console[_0x4e0eec(0x1ef)](_0x4e0eec(0x1dd)+_0xb76fb7));switch(_0x125fe3[_0x4e0eec(0x1ed)]?.['toUpperCase']()){case _0x4e0eec(0x229):_0x125fe3[_0x4e0eec(0x1f5)]?.['paid']===!![]&&_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x227)]===_0x4e0eec(0x1d8)?_0x247f49='PAID':_0x247f49=_0x4e0eec(0x1d4);break;case'PAYMENT_CANCELED':_0x247f49=_0x4e0eec(0x201);break;case _0x4e0eec(0x1dc):_0x247f49=_0x4e0eec(0x218);break;case _0x4e0eec(0x1da):_0x247f49='FAILED';!_0xb76fb7&&_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x210)]&&(_0xb76fb7=_0x125fe3[_0x4e0eec(0x1f5)][_0x4e0eec(0x210)]);break;default:switch(_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x227)]?.[_0x4e0eec(0x1ee)]()){case _0x4e0eec(0x1d8):_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x22b)]===!![]?_0x247f49='PAID':_0x247f49=_0x4e0eec(0x201);break;case _0x4e0eec(0x200):_0x247f49=_0x4e0eec(0x201);break;case _0x4e0eec(0x1fc):_0x247f49='EXPIRED';break;case _0x4e0eec(0x1f6):_0x247f49=_0x4e0eec(0x201);!_0xb76fb7&&_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x210)]&&(_0xb76fb7=_0x125fe3[_0x4e0eec(0x1f5)][_0x4e0eec(0x210)]);break;case _0x4e0eec(0x1e8):case _0x4e0eec(0x1ca):default:_0x247f49=_0x4e0eec(0x1d4);break;}break;}const _0x2dd33b={};return _0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x216)]?.[_0x4e0eec(0x1fd)]&&(_0x2dd33b[_0x4e0eec(0x21f)]=_0x125fe3[_0x4e0eec(0x1f5)][_0x4e0eec(0x216)]['last4']),_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x1c2)]&&(_0x2dd33b[_0x4e0eec(0x1c6)]=_0x125fe3[_0x4e0eec(0x1f5)][_0x4e0eec(0x1c2)]),_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x1c8)]&&(_0x2dd33b['errorCode']=_0x125fe3[_0x4e0eec(0x1f5)][_0x4e0eec(0x1c8)]),_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x1eb)]&&(_0x2dd33b['failureCode']=_0x125fe3[_0x4e0eec(0x1f5)][_0x4e0eec(0x1eb)]),console[_0x4e0eec(0x1ef)](_0x4e0eec(0x20d)+_0x247f49+',\x20failureMessage='+(_0xb76fb7||'none')),{'paymentId':_0x125fe3['data']?.['merchant_reference_id']||'','status':_0x247f49,'amount':_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x1e2)],'currency':_0x125fe3[_0x4e0eec(0x1f5)]?.[_0x4e0eec(0x1f2)],'failureMessage':_0xb76fb7,'additionalInfo':_0x2dd33b};}}function a45_0x5b0b(_0x372da8,_0x3433d0){const _0x22e3a7=a45_0x22e3();return a45_0x5b0b=function(_0x5b0b67,_0x432636){_0x5b0b67=_0x5b0b67-0x1b9;let _0x53bb6f=_0x22e3a7[_0x5b0b67];return _0x53bb6f;},a45_0x5b0b(_0x372da8,_0x3433d0);}exports['RapydService']=RapydService;