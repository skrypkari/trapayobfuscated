'use strict';function a50_0x106a(_0x808d8,_0x432fa3){const _0x2a877a=a50_0x2a87();return a50_0x106a=function(_0x106a6b,_0x11fe9a){_0x106a6b=_0x106a6b-0x13d;let _0x105517=_0x2a877a[_0x106a6b];return _0x105517;},a50_0x106a(_0x808d8,_0x432fa3);}const a50_0x463d69=a50_0x106a;(function(_0x3eed60,_0x2c5228){const _0xc12f55=a50_0x106a,_0x33516b=_0x3eed60();while(!![]){try{const _0x1de8c9=-parseInt(_0xc12f55(0x19b))/0x1*(-parseInt(_0xc12f55(0x145))/0x2)+parseInt(_0xc12f55(0x18c))/0x3*(parseInt(_0xc12f55(0x14d))/0x4)+-parseInt(_0xc12f55(0x18b))/0x5+-parseInt(_0xc12f55(0x1ac))/0x6+parseInt(_0xc12f55(0x1b2))/0x7*(parseInt(_0xc12f55(0x1b8))/0x8)+parseInt(_0xc12f55(0x191))/0x9+parseInt(_0xc12f55(0x181))/0xa;if(_0x1de8c9===_0x2c5228)break;else _0x33516b['push'](_0x33516b['shift']());}catch(_0xa42e06){_0x33516b['push'](_0x33516b['shift']());}}}(a50_0x2a87,0x8ece9));Object[a50_0x463d69(0x163)](exports,a50_0x463d69(0x160),{'value':!![]}),exports[a50_0x463d69(0x183)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x3d6cca=a50_0x463d69;this[_0x3d6cca(0x1a8)]=_0x3d6cca(0x165),console[_0x3d6cca(0x13f)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a50_0x463d69(0x15c)](_0x174f6b){const _0x490274=a50_0x463d69,{orderId:_0x4f40b7,orderName:_0x1fb460,amount:_0x5849e3,currency:_0x34d893,usage:_0x5dbe29,maxPayments:_0x423130,successUrl:_0x2b1f2d,failUrl:_0x11abb}=_0x174f6b,_0x3ad1d9=_0x34d893[_0x490274(0x195)](),_0x69f9b5='GB';console[_0x490274(0x13f)](_0x490274(0x1ae));const _0x4a2bd8=_0x490274(0x1b1)+_0x4f40b7,_0x31950b=_0x490274(0x190)+_0x4f40b7,_0x37c0ad={'amount':_0x5849e3,'currency':_0x3ad1d9,'cancel_checkout_url':_0x31950b,'complete_checkout_url':_0x4a2bd8,'complete_payment_url':_0x4a2bd8,'merchant_reference_id':_0x4f40b7,'description':_0x490274(0x17d)+_0x4f40b7,'country':'GB','payment_method_types_include':[_0x490274(0x16b),_0x490274(0x162)],'custom_elements':{'display_description':!![]}};if(_0x3ad1d9!==_0x490274(0x182)){const _0x112669=Math[_0x490274(0x19c)](Date[_0x490274(0x176)]()/0x3e8)+0x1e*0x3c;_0x37c0ad[_0x490274(0x159)]=_0x490274(0x19f),_0x37c0ad['requested_currency']=_0x490274(0x182),_0x37c0ad[_0x490274(0x1b6)]=_0x112669,console[_0x490274(0x13f)]('üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20'+_0x3ad1d9+_0x490274(0x15e)),console['log'](_0x490274(0x152)),console[_0x490274(0x13f)](_0x490274(0x1a9)),console['log']('\x20\x20\x20expiration:\x20'+_0x112669+'\x20('+new Date(_0x112669*0x3e8)['toISOString']()+')');}const _0x240f9c=Date[_0x490274(0x176)]();try{console[_0x490274(0x13f)](_0x490274(0x173)),console['log'](_0x490274(0x1b7),this[_0x490274(0x1a8)]),console[_0x490274(0x13f)](_0x490274(0x1b4),JSON[_0x490274(0x143)](_0x37c0ad,null,0x2)),console[_0x490274(0x13f)]('üá¨üáß\x20Country:\x20'+_0x69f9b5+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x490274(0x13f)](_0x490274(0x187)),loggerService_1[_0x490274(0x197)]['logWhiteDomainRequest'](_0x490274(0x1b9),_0x490274(0x171),_0x490274(0x19e),_0x37c0ad);const _0x14712a=await fetch(this[_0x490274(0x1a8)],{'method':_0x490274(0x19e),'headers':{'Content-Type':'application/json','User-Agent':_0x490274(0x18a)},'body':JSON[_0x490274(0x143)](_0x37c0ad)}),_0x3f1ce4=Date[_0x490274(0x176)]()-_0x240f9c;console[_0x490274(0x13f)](_0x490274(0x14e)),console[_0x490274(0x13f)](_0x490274(0x13e),_0x14712a[_0x490274(0x17f)]),console['log'](_0x490274(0x14b),_0x14712a[_0x490274(0x16a)]),console[_0x490274(0x13f)]('Headers:',Object[_0x490274(0x169)](_0x14712a[_0x490274(0x180)][_0x490274(0x1b5)]())),console['log'](_0x490274(0x185),_0x3f1ce4+'ms');const _0x3eda63=await _0x14712a[_0x490274(0x19a)]();console[_0x490274(0x13f)](_0x490274(0x16d),_0x3eda63);if(!_0x14712a['ok']){console[_0x490274(0x153)](_0x490274(0x172)),console[_0x490274(0x153)](_0x490274(0x18f),_0x14712a[_0x490274(0x17f)]),console[_0x490274(0x153)]('Response\x20Body:',_0x3eda63),loggerService_1['loggerService'][_0x490274(0x148)]('rapyd',_0x490274(0x171),_0x14712a[_0x490274(0x17f)],_0x3eda63,_0x3f1ce4),loggerService_1[_0x490274(0x197)][_0x490274(0x17c)](_0x490274(0x1b9),_0x490274(0x171),'HTTP\x20'+_0x14712a['status']+':\x20'+_0x3eda63);throw new Error(_0x490274(0x1ab)+_0x14712a[_0x490274(0x17f)]+_0x490274(0x170)+_0x3eda63);}let _0x417c76;try{_0x417c76=JSON[_0x490274(0x178)](_0x3eda63);}catch(_0x1e603b){console[_0x490274(0x153)](_0x490274(0x15f),_0x1e603b),loggerService_1[_0x490274(0x197)]['logWhiteDomainError'](_0x490274(0x1b9),_0x490274(0x171),_0x490274(0x17e)+_0x1e603b);throw new Error(_0x490274(0x196)+_0x3eda63);}console[_0x490274(0x13f)](_0x490274(0x1a4)),console[_0x490274(0x13f)](_0x490274(0x158),JSON['stringify'](_0x417c76,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x490274(0x1b9),_0x490274(0x171),_0x14712a['status'],_0x417c76,_0x3f1ce4);if(_0x417c76[_0x490274(0x17f)]?.['status']!=='SUCCESS'){const _0x598d3d=_0x417c76[_0x490274(0x17f)]?.[_0x490274(0x1a3)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x4bfc78=_0x417c76[_0x490274(0x17f)]?.[_0x490274(0x18e)]||_0x490274(0x161);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x490274(0x1a1),_0x4bfc78),console[_0x490274(0x153)]('Error\x20Message:',_0x598d3d),console[_0x490274(0x153)](_0x490274(0x1b0),_0x417c76['status']),loggerService_1[_0x490274(0x197)]['logWhiteDomainError'](_0x490274(0x1b9),'/v1/hosted/payment_links',_0x490274(0x15a)+_0x4bfc78+'):\x20'+_0x598d3d);throw new Error(_0x490274(0x1ad)+_0x4bfc78+_0x490274(0x192)+_0x598d3d);}if(!_0x417c76['data']?.['id']||!_0x417c76[_0x490274(0x149)]?.[_0x490274(0x15b)]){console[_0x490274(0x153)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x490274(0x153)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x490274(0x153)]('Response\x20data:',_0x417c76[_0x490274(0x149)]),loggerService_1[_0x490274(0x197)][_0x490274(0x17c)]('rapyd',_0x490274(0x171),_0x490274(0x175));throw new Error(_0x490274(0x1a0));}return console[_0x490274(0x13f)](_0x490274(0x146)),console[_0x490274(0x13f)]('Payment\x20Link\x20ID:',_0x417c76[_0x490274(0x149)]['id']),console[_0x490274(0x13f)]('Redirect\x20URL:',_0x417c76['data'][_0x490274(0x15b)]),console[_0x490274(0x13f)](_0x490274(0x1a2)+_0x69f9b5+_0x490274(0x1a7)),console[_0x490274(0x13f)](_0x490274(0x187)),{'gateway_payment_id':_0x417c76[_0x490274(0x149)]['id'],'payment_url':_0x417c76['data'][_0x490274(0x15b)]};}catch(_0x141726){console[_0x490274(0x153)](_0x490274(0x157)),console[_0x490274(0x153)](_0x490274(0x188),_0x141726),loggerService_1[_0x490274(0x197)][_0x490274(0x17c)](_0x490274(0x1b9),_0x490274(0x171),_0x141726);if(_0x141726 instanceof Error){console['error'](_0x490274(0x1b3),_0x141726[_0x490274(0x1a3)]),console[_0x490274(0x153)](_0x490274(0x199),_0x141726['stack']);throw new Error(_0x490274(0x140)+_0x141726[_0x490274(0x1a3)]);}throw new Error(_0x490274(0x1a6));}}async['verifyPayment'](_0xae08e3){const _0x1a0b7a=a50_0x463d69,_0x47e14e=Date['now']();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x1a0b7a(0x1b9),_0x1a0b7a(0x13d)+_0xae08e3,'GET',{});const _0x554c68=await fetch(this[_0x1a0b7a(0x1a8)]+'/'+_0xae08e3,{'method':_0x1a0b7a(0x150),'headers':{'Content-Type':_0x1a0b7a(0x193),'User-Agent':_0x1a0b7a(0x18a)}}),_0x588788=Date['now']()-_0x47e14e;if(!_0x554c68['ok']){const _0x9b19a=await _0x554c68[_0x1a0b7a(0x19a)]();loggerService_1[_0x1a0b7a(0x197)][_0x1a0b7a(0x148)](_0x1a0b7a(0x1b9),'/v1/hosted/payment_links/'+_0xae08e3,_0x554c68[_0x1a0b7a(0x17f)],_0x9b19a,_0x588788);throw new Error(_0x1a0b7a(0x1ab)+_0x554c68[_0x1a0b7a(0x17f)]);}const _0x4d32ee=await _0x554c68[_0x1a0b7a(0x179)]();loggerService_1[_0x1a0b7a(0x197)][_0x1a0b7a(0x148)](_0x1a0b7a(0x1b9),_0x1a0b7a(0x13d)+_0xae08e3,_0x554c68[_0x1a0b7a(0x17f)],_0x4d32ee,_0x588788);if(_0x4d32ee['status']?.[_0x1a0b7a(0x17f)]!==_0x1a0b7a(0x164)){loggerService_1['loggerService'][_0x1a0b7a(0x17c)](_0x1a0b7a(0x1b9),_0x1a0b7a(0x13d)+_0xae08e3,'Rapyd\x20API\x20error:\x20'+(_0x4d32ee[_0x1a0b7a(0x17f)]?.[_0x1a0b7a(0x1a3)]||_0x1a0b7a(0x147)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x4d32ee['status']?.['message']||_0x1a0b7a(0x147)));}let _0x531b9b=_0x1a0b7a(0x167);if(_0x4d32ee[_0x1a0b7a(0x149)]?.['status'])switch(_0x4d32ee[_0x1a0b7a(0x149)][_0x1a0b7a(0x17f)][_0x1a0b7a(0x195)]()){case'CLO':_0x531b9b=_0x1a0b7a(0x1a5);break;case _0x1a0b7a(0x1af):_0x531b9b=_0x1a0b7a(0x14c);break;case _0x1a0b7a(0x16c):_0x531b9b=_0x1a0b7a(0x141);break;case _0x1a0b7a(0x177):_0x531b9b=_0x1a0b7a(0x14c);break;case _0x1a0b7a(0x16f):case _0x1a0b7a(0x194):default:_0x531b9b='PENDING';break;}return{'status':_0x531b9b,'amount':_0x4d32ee['data']?.[_0x1a0b7a(0x14a)],'currency':_0x4d32ee[_0x1a0b7a(0x149)]?.[_0x1a0b7a(0x18d)]};}catch(_0x1d48af){console['error'](_0x1a0b7a(0x151),_0x1d48af),loggerService_1[_0x1a0b7a(0x197)][_0x1a0b7a(0x17c)](_0x1a0b7a(0x1b9),_0x1a0b7a(0x13d)+_0xae08e3,_0x1d48af);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x1d48af instanceof Error?_0x1d48af[_0x1a0b7a(0x1a3)]:'Unknown\x20error'));}}async[a50_0x463d69(0x166)](_0x4974b4){const _0x4b7590=a50_0x463d69;console[_0x4b7590(0x13f)](_0x4b7590(0x144),_0x4974b4);let _0x280dc2=_0x4b7590(0x167),_0x2ee1ef;_0x4974b4[_0x4b7590(0x149)]?.['failure_message']&&(_0x2ee1ef=_0x4974b4[_0x4b7590(0x149)]['failure_message'],console[_0x4b7590(0x13f)]('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x2ee1ef));switch(_0x4974b4[_0x4b7590(0x189)]?.[_0x4b7590(0x195)]()){case _0x4b7590(0x184):_0x4974b4[_0x4b7590(0x149)]?.[_0x4b7590(0x186)]===!![]&&_0x4974b4[_0x4b7590(0x149)]?.['status']===_0x4b7590(0x15d)?_0x280dc2=_0x4b7590(0x1a5):_0x280dc2=_0x4b7590(0x167);break;case'PAYMENT_CANCELED':_0x280dc2='FAILED';break;case _0x4b7590(0x17b):_0x280dc2=_0x4b7590(0x141);break;case _0x4b7590(0x16e):_0x280dc2=_0x4b7590(0x14c);!_0x2ee1ef&&_0x4974b4[_0x4b7590(0x149)]?.[_0x4b7590(0x174)]&&(_0x2ee1ef=_0x4974b4[_0x4b7590(0x149)][_0x4b7590(0x174)]);break;default:switch(_0x4974b4[_0x4b7590(0x149)]?.[_0x4b7590(0x17f)]?.[_0x4b7590(0x195)]()){case _0x4b7590(0x15d):_0x4974b4['data']?.[_0x4b7590(0x186)]===!![]?_0x280dc2=_0x4b7590(0x1a5):_0x280dc2=_0x4b7590(0x14c);break;case _0x4b7590(0x1af):_0x280dc2=_0x4b7590(0x14c);break;case _0x4b7590(0x16c):_0x280dc2='EXPIRED';break;case'ERR':_0x280dc2=_0x4b7590(0x14c);!_0x2ee1ef&&_0x4974b4[_0x4b7590(0x149)]?.[_0x4b7590(0x174)]&&(_0x2ee1ef=_0x4974b4[_0x4b7590(0x149)]['failure_message']);break;case _0x4b7590(0x16f):case _0x4b7590(0x194):default:_0x280dc2=_0x4b7590(0x167);break;}break;}const _0x1ff6c1={};return _0x4974b4[_0x4b7590(0x149)]?.[_0x4b7590(0x156)]?.['last4']&&(_0x1ff6c1[_0x4b7590(0x1aa)]=_0x4974b4[_0x4b7590(0x149)][_0x4b7590(0x156)][_0x4b7590(0x198)]),_0x4974b4['data']?.['payment_method_type']&&(_0x1ff6c1[_0x4b7590(0x155)]=_0x4974b4[_0x4b7590(0x149)][_0x4b7590(0x142)]),_0x4974b4[_0x4b7590(0x149)]?.[_0x4b7590(0x18e)]&&(_0x1ff6c1['errorCode']=_0x4974b4['data'][_0x4b7590(0x18e)]),_0x4974b4['data']?.['failure_code']&&(_0x1ff6c1[_0x4b7590(0x17a)]=_0x4974b4[_0x4b7590(0x149)][_0x4b7590(0x19d)]),console[_0x4b7590(0x13f)]('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x280dc2+_0x4b7590(0x168)+(_0x2ee1ef||_0x4b7590(0x154))),{'paymentId':_0x4974b4['data']?.[_0x4b7590(0x14f)]||'','status':_0x280dc2,'amount':_0x4974b4[_0x4b7590(0x149)]?.['amount'],'currency':_0x4974b4['data']?.[_0x4b7590(0x18d)],'failureMessage':_0x2ee1ef,'additionalInfo':_0x1ff6c1};}}function a50_0x2a87(){const _0x2be3bb=['floor','failure_code','POST','buy','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Error\x20Code:','üá¨üáß\x20Country\x20used:\x20','message','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','PAID','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','\x20(GB\x20-\x20Britain)','apiUrl','\x20\x20\x20requested_currency:\x20EUR','cardLast4','HTTP\x20error!\x20status:\x20','6904764txuWFk','Rapyd\x20API\x20error\x20(','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','CAN','Full\x20Error\x20Data:','https://tesoft.uk/gateway/success.php?id=','21LNCKTd','Error\x20message:','Request\x20Body\x20(Updated\x20Format):','entries','expiration','URL:','1173032oOqCCS','rapyd','/v1/hosted/payment_links/','Status:','log','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','EXPIRED','payment_method_type','stringify','Processing\x20Rapyd\x20webhook:','196774zYEDCJ','===\x20RAPYD\x20SUCCESS\x20===','Unknown\x20error','logWhiteDomainResponse','data','amount','Status\x20Text:','FAILED','114336yVpkmU','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','merchant_reference_id','GET','Rapyd\x20payment\x20verification\x20error:','\x20\x20\x20fixed_side:\x20buy','error','none','paymentMethod','payment_method_data','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Parsed\x20Result:','fixed_side','Business\x20Error\x20(','redirect_url','createPaymentLink','CLO','\x20->\x20EUR:','Failed\x20to\x20parse\x20JSON\x20response:','__esModule','UNKNOWN','gb_mastercard_card','defineProperty','SUCCESS','https://tesoft.uk/gateway/rapyd/','processWebhook','PENDING',',\x20failureMessage=','fromEntries','statusText','gb_visa_card','EXP','Raw\x20Response\x20Body:','PAYMENT_FAILED','NEW',',\x20body:\x20','/v1/hosted/payment_links','===\x20RAPYD\x20API\x20ERROR\x20===','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','failure_message','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','now','ERR','parse','json','failureCode','PAYMENT_EXPIRED','logWhiteDomainError','ORDER:\x20','JSON\x20Parse\x20Error:\x20','status','headers','9006460xTrYMW','EUR','RapydService','PAYMENT_COMPLETED','Response\x20Time:','paid','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Error\x20details:','type','TesSoft\x20Payment\x20System/1.0','5522855NENEDM','108eXGvMJ','currency','error_code','HTTP\x20Status:','https://tesoft.uk/gateway/fail.php?id=','2465739bXLCyu','):\x20','application/json','ACT','toUpperCase','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','loggerService','last4','Error\x20stack:','text','2aswLnP'];a50_0x2a87=function(){return _0x2be3bb;};return a50_0x2a87();}exports['RapydService']=RapydService;