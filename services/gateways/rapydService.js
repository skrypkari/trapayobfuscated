'use strict';const a48_0x3a9dae=a48_0x4481;function a48_0x5802(){const _0x4bb748=['HTTP\x20Status:','Status\x20Text:','üá¨üáß\x20Country\x20used:\x20','redirect_url','https://tesoft.uk/gateway/rapyd/','currency','URL:','NEW','none','fromEntries','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','PAYMENT_EXPIRED','Parsed\x20Result:','logWhiteDomainResponse','error_code','statusText','https://tesoft.uk/gateway/fail.php?id=','__esModule','json','application/json','12117882dozErB','\x20\x20\x20fixed_side:\x20buy','Error\x20message:','buy','2136uwQuxR','920PMhGyB','EUR','merchant_reference_id','Unknown\x20error\x20from\x20Rapyd\x20API','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','processWebhook','Error\x20Message:','failureCode','amount','logWhiteDomainRequest','\x20\x20\x20requested_currency:\x20EUR',',\x20body:\x20','message','CLO','Rapyd\x20API\x20error:\x20','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','17192745QElAhu','headers','requested_currency','\x20(GB\x20-\x20Britain)','ACT','paid','POST','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','floor','EXPIRED','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','paymentMethod','1348715kPOkNq','16jTIsep','PENDING','last4','CAN','https://tesoft.uk/gateway/success.php?id=','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','parse','\x20->\x20EUR:','status','toUpperCase','stack','):\x20','Headers:','RapydService','failure_message','data','Status:','Raw\x20Response\x20Body:','/v1/hosted/payment_links','now','Redirect\x20URL:','EXP','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','rapyd',',\x20failureMessage=','/v1/hosted/payment_links/','HTTP\x20error!\x20status:\x20','GET','\x20\x20\x20expiration:\x20','verifyPayment','Failed\x20to\x20parse\x20JSON\x20response:','10083780cthNap','ORDER:\x20','ERR','gb_visa_card','apiUrl','Error\x20Code:','payment_method_type','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','type','stringify','SUCCESS','failure_code','PAID','Response\x20Time:','üá¨üáß\x20Country:\x20','Full\x20Error\x20Data:','9599504SrMjTM','===\x20RAPYD\x20SUCCESS\x20===','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','===\x20RAPYD\x20API\x20ERROR\x20===','log','text','logWhiteDomainError','PAYMENT_CANCELED','TesSoft\x20Payment\x20System/1.0','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','error','Rapyd\x20API\x20error\x20(','FAILED','../loggerService','1331048eHSodv','UNKNOWN','loggerService','Unknown\x20error','Processing\x20Rapyd\x20webhook:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','errorCode'];a48_0x5802=function(){return _0x4bb748;};return a48_0x5802();}function a48_0x4481(_0x3d23d7,_0x1ce3d7){const _0x5802a8=a48_0x5802();return a48_0x4481=function(_0x44810d,_0x5e19e6){_0x44810d=_0x44810d-0x1d6;let _0x3159f5=_0x5802a8[_0x44810d];return _0x3159f5;},a48_0x4481(_0x3d23d7,_0x1ce3d7);}(function(_0x37a3d6,_0x5c2e60){const _0x586916=a48_0x4481,_0x2b6c45=_0x37a3d6();while(!![]){try{const _0x2e069d=parseInt(_0x586916(0x241))/0x1+parseInt(_0x586916(0x1e7))/0x2*(parseInt(_0x586916(0x1e6))/0x3)+-parseInt(_0x586916(0x204))/0x4*(parseInt(_0x586916(0x203))/0x5)+parseInt(_0x586916(0x223))/0x6+parseInt(_0x586916(0x1e2))/0x7+-parseInt(_0x586916(0x233))/0x8+-parseInt(_0x586916(0x1f7))/0x9;if(_0x2e069d===_0x5c2e60)break;else _0x2b6c45['push'](_0x2b6c45['shift']());}catch(_0x43454b){_0x2b6c45['push'](_0x2b6c45['shift']());}}}(a48_0x5802,0xd71d5));Object['defineProperty'](exports,a48_0x3a9dae(0x1df),{'value':!![]}),exports[a48_0x3a9dae(0x211)]=void 0x0;const loggerService_1=require(a48_0x3a9dae(0x240));class RapydService{constructor(){const _0x3de0cd=a48_0x3a9dae;this[_0x3de0cd(0x227)]=_0x3de0cd(0x24c),console[_0x3de0cd(0x237)](_0x3de0cd(0x22a));}async['createPaymentLink'](_0x5ad1ec){const _0x1db5ae=a48_0x3a9dae,{orderId:_0x2f004d,orderName:_0x497f5f,amount:_0x2bc144,currency:_0x2cd67f,usage:_0x17da71,maxPayments:_0x1f3e9e,successUrl:_0x56239e,failUrl:_0x50188c}=_0x5ad1ec,_0xf59dd0=_0x2cd67f[_0x1db5ae(0x20d)](),_0x5b725e='GB';console['log'](_0x1db5ae(0x21a));const _0x2b522e=_0x1db5ae(0x208)+_0x2f004d,_0x34f98e=_0x1db5ae(0x1de)+_0x2f004d,_0x12b338={'amount':_0x2bc144,'currency':_0xf59dd0,'cancel_checkout_url':_0x34f98e,'complete_checkout_url':_0x2b522e,'complete_payment_url':_0x2b522e,'merchant_reference_id':_0x2f004d,'description':_0x1db5ae(0x224)+_0x2f004d,'country':'GB','payment_method_types_include':[_0x1db5ae(0x226),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}};if(_0xf59dd0!=='EUR'){const _0x9a5b14=Math[_0x1db5ae(0x1ff)](Date[_0x1db5ae(0x217)]()/0x3e8)+0x1e*0x3c;_0x12b338['fixed_side']=_0x1db5ae(0x1e5),_0x12b338[_0x1db5ae(0x1f9)]=_0x1db5ae(0x1e8),_0x12b338['expiration']=_0x9a5b14,console[_0x1db5ae(0x237)]('üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20'+_0xf59dd0+_0x1db5ae(0x20b)),console[_0x1db5ae(0x237)](_0x1db5ae(0x1e3)),console[_0x1db5ae(0x237)](_0x1db5ae(0x1f1)),console[_0x1db5ae(0x237)](_0x1db5ae(0x220)+_0x9a5b14+'\x20('+new Date(_0x9a5b14*0x3e8)['toISOString']()+')');}const _0x2cf3cc=Date[_0x1db5ae(0x217)]();try{console['log']('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x1db5ae(0x237)](_0x1db5ae(0x24e),this[_0x1db5ae(0x227)]),console['log']('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x12b338,null,0x2)),console[_0x1db5ae(0x237)](_0x1db5ae(0x231)+_0x5b725e+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x1db5ae(0x237)](_0x1db5ae(0x1d8)),loggerService_1[_0x1db5ae(0x243)][_0x1db5ae(0x1f0)](_0x1db5ae(0x21b),_0x1db5ae(0x216),_0x1db5ae(0x1fd),_0x12b338);const _0x47eee5=await fetch(this[_0x1db5ae(0x227)],{'method':_0x1db5ae(0x1fd),'headers':{'Content-Type':_0x1db5ae(0x1e1),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1db5ae(0x22c)](_0x12b338)}),_0x48f451=Date[_0x1db5ae(0x217)]()-_0x2cf3cc;console[_0x1db5ae(0x237)](_0x1db5ae(0x1fe)),console['log'](_0x1db5ae(0x214),_0x47eee5[_0x1db5ae(0x20c)]),console['log'](_0x1db5ae(0x249),_0x47eee5[_0x1db5ae(0x1dd)]),console[_0x1db5ae(0x237)](_0x1db5ae(0x210),Object[_0x1db5ae(0x1d7)](_0x47eee5[_0x1db5ae(0x1f8)]['entries']())),console[_0x1db5ae(0x237)](_0x1db5ae(0x230),_0x48f451+'ms');const _0x263f23=await _0x47eee5[_0x1db5ae(0x238)]();console[_0x1db5ae(0x237)](_0x1db5ae(0x215),_0x263f23);if(!_0x47eee5['ok']){console[_0x1db5ae(0x23d)](_0x1db5ae(0x236)),console[_0x1db5ae(0x23d)](_0x1db5ae(0x248),_0x47eee5[_0x1db5ae(0x20c)]),console[_0x1db5ae(0x23d)]('Response\x20Body:',_0x263f23),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1db5ae(0x21b),_0x1db5ae(0x216),_0x47eee5[_0x1db5ae(0x20c)],_0x263f23,_0x48f451),loggerService_1['loggerService'][_0x1db5ae(0x239)](_0x1db5ae(0x21b),'/v1/hosted/payment_links','HTTP\x20'+_0x47eee5[_0x1db5ae(0x20c)]+':\x20'+_0x263f23);throw new Error(_0x1db5ae(0x21e)+_0x47eee5['status']+_0x1db5ae(0x1f2)+_0x263f23);}let _0x44b64b;try{_0x44b64b=JSON[_0x1db5ae(0x20a)](_0x263f23);}catch(_0x55c1d8){console[_0x1db5ae(0x23d)](_0x1db5ae(0x222),_0x55c1d8),loggerService_1[_0x1db5ae(0x243)][_0x1db5ae(0x239)](_0x1db5ae(0x21b),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x55c1d8);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x263f23);}console[_0x1db5ae(0x237)](_0x1db5ae(0x1eb)),console['log'](_0x1db5ae(0x1da),JSON[_0x1db5ae(0x22c)](_0x44b64b,null,0x2)),loggerService_1[_0x1db5ae(0x243)][_0x1db5ae(0x1db)](_0x1db5ae(0x21b),_0x1db5ae(0x216),_0x47eee5['status'],_0x44b64b,_0x48f451);if(_0x44b64b[_0x1db5ae(0x20c)]?.[_0x1db5ae(0x20c)]!==_0x1db5ae(0x22d)){const _0x84cd8f=_0x44b64b['status']?.[_0x1db5ae(0x1f3)]||_0x1db5ae(0x1ea),_0x2b4ba4=_0x44b64b[_0x1db5ae(0x20c)]?.[_0x1db5ae(0x1dc)]||_0x1db5ae(0x242);console[_0x1db5ae(0x23d)](_0x1db5ae(0x23c)),console[_0x1db5ae(0x23d)](_0x1db5ae(0x228),_0x2b4ba4),console[_0x1db5ae(0x23d)](_0x1db5ae(0x1ed),_0x84cd8f),console[_0x1db5ae(0x23d)](_0x1db5ae(0x232),_0x44b64b['status']),loggerService_1[_0x1db5ae(0x243)]['logWhiteDomainError'](_0x1db5ae(0x21b),_0x1db5ae(0x216),'Business\x20Error\x20('+_0x2b4ba4+_0x1db5ae(0x20f)+_0x84cd8f);throw new Error(_0x1db5ae(0x23e)+_0x2b4ba4+_0x1db5ae(0x20f)+_0x84cd8f);}if(!_0x44b64b[_0x1db5ae(0x213)]?.['id']||!_0x44b64b[_0x1db5ae(0x213)]?.[_0x1db5ae(0x24b)]){console[_0x1db5ae(0x23d)](_0x1db5ae(0x1f6)),console[_0x1db5ae(0x23d)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x1db5ae(0x23d)]('Response\x20data:',_0x44b64b['data']),loggerService_1[_0x1db5ae(0x243)][_0x1db5ae(0x239)]('rapyd',_0x1db5ae(0x216),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x1db5ae(0x237)](_0x1db5ae(0x234)),console[_0x1db5ae(0x237)]('Payment\x20Link\x20ID:',_0x44b64b[_0x1db5ae(0x213)]['id']),console[_0x1db5ae(0x237)](_0x1db5ae(0x218),_0x44b64b[_0x1db5ae(0x213)][_0x1db5ae(0x24b)]),console[_0x1db5ae(0x237)](_0x1db5ae(0x24a)+_0x5b725e+_0x1db5ae(0x1fa)),console[_0x1db5ae(0x237)](_0x1db5ae(0x1d8)),{'gateway_payment_id':_0x44b64b[_0x1db5ae(0x213)]['id'],'payment_url':_0x44b64b['data'][_0x1db5ae(0x24b)]};}catch(_0x512047){console[_0x1db5ae(0x23d)](_0x1db5ae(0x209)),console[_0x1db5ae(0x23d)]('Error\x20details:',_0x512047),loggerService_1[_0x1db5ae(0x243)][_0x1db5ae(0x239)](_0x1db5ae(0x21b),_0x1db5ae(0x216),_0x512047);if(_0x512047 instanceof Error){console[_0x1db5ae(0x23d)](_0x1db5ae(0x1e4),_0x512047['message']),console[_0x1db5ae(0x23d)]('Error\x20stack:',_0x512047[_0x1db5ae(0x20e)]);throw new Error(_0x1db5ae(0x246)+_0x512047[_0x1db5ae(0x1f3)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a48_0x3a9dae(0x221)](_0x138557){const _0x350a7a=a48_0x3a9dae,_0x55633c=Date[_0x350a7a(0x217)]();try{loggerService_1[_0x350a7a(0x243)][_0x350a7a(0x1f0)](_0x350a7a(0x21b),_0x350a7a(0x21d)+_0x138557,_0x350a7a(0x21f),{});const _0x4e739a=await fetch(this['apiUrl']+'/'+_0x138557,{'method':_0x350a7a(0x21f),'headers':{'Content-Type':'application/json','User-Agent':_0x350a7a(0x23b)}}),_0xdcb4ed=Date[_0x350a7a(0x217)]()-_0x55633c;if(!_0x4e739a['ok']){const _0x5c552a=await _0x4e739a[_0x350a7a(0x238)]();loggerService_1[_0x350a7a(0x243)][_0x350a7a(0x1db)](_0x350a7a(0x21b),_0x350a7a(0x21d)+_0x138557,_0x4e739a[_0x350a7a(0x20c)],_0x5c552a,_0xdcb4ed);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4e739a[_0x350a7a(0x20c)]);}const _0x175439=await _0x4e739a[_0x350a7a(0x1e0)]();loggerService_1[_0x350a7a(0x243)][_0x350a7a(0x1db)]('rapyd','/v1/hosted/payment_links/'+_0x138557,_0x4e739a[_0x350a7a(0x20c)],_0x175439,_0xdcb4ed);if(_0x175439[_0x350a7a(0x20c)]?.[_0x350a7a(0x20c)]!==_0x350a7a(0x22d)){loggerService_1[_0x350a7a(0x243)][_0x350a7a(0x239)](_0x350a7a(0x21b),'/v1/hosted/payment_links/'+_0x138557,_0x350a7a(0x1f5)+(_0x175439[_0x350a7a(0x20c)]?.[_0x350a7a(0x1f3)]||_0x350a7a(0x244)));throw new Error(_0x350a7a(0x1f5)+(_0x175439[_0x350a7a(0x20c)]?.['message']||_0x350a7a(0x244)));}let _0x2bc970=_0x350a7a(0x205);if(_0x175439[_0x350a7a(0x213)]?.[_0x350a7a(0x20c)])switch(_0x175439[_0x350a7a(0x213)][_0x350a7a(0x20c)][_0x350a7a(0x20d)]()){case _0x350a7a(0x1f4):_0x2bc970=_0x350a7a(0x22f);break;case _0x350a7a(0x207):_0x2bc970=_0x350a7a(0x23f);break;case _0x350a7a(0x219):_0x2bc970=_0x350a7a(0x200);break;case _0x350a7a(0x225):_0x2bc970=_0x350a7a(0x23f);break;case _0x350a7a(0x24f):case _0x350a7a(0x1fb):default:_0x2bc970=_0x350a7a(0x205);break;}return{'status':_0x2bc970,'amount':_0x175439['data']?.[_0x350a7a(0x1ef)],'currency':_0x175439['data']?.[_0x350a7a(0x24d)]};}catch(_0x258b54){console[_0x350a7a(0x23d)]('Rapyd\x20payment\x20verification\x20error:',_0x258b54),loggerService_1[_0x350a7a(0x243)][_0x350a7a(0x239)](_0x350a7a(0x21b),_0x350a7a(0x21d)+_0x138557,_0x258b54);throw new Error(_0x350a7a(0x201)+(_0x258b54 instanceof Error?_0x258b54['message']:'Unknown\x20error'));}}async[a48_0x3a9dae(0x1ec)](_0x49921a){const _0x1f3d62=a48_0x3a9dae;console[_0x1f3d62(0x237)](_0x1f3d62(0x245),_0x49921a);let _0x27ab01=_0x1f3d62(0x205),_0x1a0e14;_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x212)]&&(_0x1a0e14=_0x49921a['data']['failure_message'],console[_0x1f3d62(0x237)]('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x1a0e14));switch(_0x49921a[_0x1f3d62(0x22b)]?.[_0x1f3d62(0x20d)]()){case'PAYMENT_COMPLETED':_0x49921a[_0x1f3d62(0x213)]?.['paid']===!![]&&_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x20c)]===_0x1f3d62(0x1f4)?_0x27ab01=_0x1f3d62(0x22f):_0x27ab01='PENDING';break;case _0x1f3d62(0x23a):_0x27ab01=_0x1f3d62(0x23f);break;case _0x1f3d62(0x1d9):_0x27ab01=_0x1f3d62(0x200);break;case'PAYMENT_FAILED':_0x27ab01=_0x1f3d62(0x23f);!_0x1a0e14&&_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x212)]&&(_0x1a0e14=_0x49921a[_0x1f3d62(0x213)][_0x1f3d62(0x212)]);break;default:switch(_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x20c)]?.['toUpperCase']()){case _0x1f3d62(0x1f4):_0x49921a['data']?.[_0x1f3d62(0x1fc)]===!![]?_0x27ab01=_0x1f3d62(0x22f):_0x27ab01='FAILED';break;case _0x1f3d62(0x207):_0x27ab01='FAILED';break;case'EXP':_0x27ab01=_0x1f3d62(0x200);break;case _0x1f3d62(0x225):_0x27ab01=_0x1f3d62(0x23f);!_0x1a0e14&&_0x49921a[_0x1f3d62(0x213)]?.['failure_message']&&(_0x1a0e14=_0x49921a[_0x1f3d62(0x213)]['failure_message']);break;case'NEW':case'ACT':default:_0x27ab01=_0x1f3d62(0x205);break;}break;}const _0x1d3364={};return _0x49921a[_0x1f3d62(0x213)]?.['payment_method_data']?.[_0x1f3d62(0x206)]&&(_0x1d3364['cardLast4']=_0x49921a[_0x1f3d62(0x213)]['payment_method_data']['last4']),_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x229)]&&(_0x1d3364[_0x1f3d62(0x202)]=_0x49921a[_0x1f3d62(0x213)][_0x1f3d62(0x229)]),_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x1dc)]&&(_0x1d3364[_0x1f3d62(0x247)]=_0x49921a[_0x1f3d62(0x213)][_0x1f3d62(0x1dc)]),_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x22e)]&&(_0x1d3364[_0x1f3d62(0x1ee)]=_0x49921a[_0x1f3d62(0x213)][_0x1f3d62(0x22e)]),console[_0x1f3d62(0x237)](_0x1f3d62(0x235)+_0x27ab01+_0x1f3d62(0x21c)+(_0x1a0e14||_0x1f3d62(0x1d6))),{'paymentId':_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x1e9)]||'','status':_0x27ab01,'amount':_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x1ef)],'currency':_0x49921a[_0x1f3d62(0x213)]?.[_0x1f3d62(0x24d)],'failureMessage':_0x1a0e14,'additionalInfo':_0x1d3364};}}exports[a48_0x3a9dae(0x211)]=RapydService;