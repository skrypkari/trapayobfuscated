'use strict';function a50_0x1ac1(){const _0x30c45f=['7iebuCU','Response\x20data:','2718930APwIOi','52304eVcYkz','\x20\x20\x20fixed_side:\x20buy','json','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','paid',',\x20body:\x20','HTTP\x20','Request\x20Body\x20(Updated\x20Format):','\x20(always\x20GB\x20for\x20Rapyd)','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','/v1/hosted/payment_links','85rCNSpl','NEW','üí•\x20Rapyd\x20failure\x20message:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','rapyd','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','POST','log','Error\x20stack:','failure_code','===\x20RAPYD\x20SUCCESS\x20===','ORDER:\x20','Response\x20Time:','data','parse','HTTP\x20error!\x20status:\x20','gb_mastercard_card','gb_visa_card','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','headers','error_code','Status:','4327872KmCmOl','EUR','last4','JSON\x20Parse\x20Error:\x20','FAILED','Status\x20Text:','status','Error\x20message:','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','ERR','buy','PAID','apiUrl','GET','statusText','\x20->\x20EUR:','RapydService','Full\x20Error\x20Data:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','cardLast4','https://tesoft.uk/gateway/success.php?id=','merchant_reference_id','defineProperty','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','44eHciQS','142148txCOrp','paymentMethod','üá¨üáß\x20Country\x20used:\x20','payment_method_type','/v1/hosted/payment_links/','Error\x20Code:','logWhiteDomainResponse','PAYMENT_FAILED','CLO','Redirect\x20URL:','20Suqbwa','2290491JBoNEE','failure_message','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainError','toUpperCase','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','stringify','URL:','verifyPayment','text','986724PpScnr','redirect_url','Business\x20Error\x20(','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20Message:','payment_method_data','TesSoft\x20Payment\x20System/1.0','expiration','__esModule','1263765gekcEe','Response\x20Body:','Rapyd\x20API\x20error\x20(','===\x20RAPYD\x20API\x20ERROR\x20===','Payment\x20Link\x20ID:','CAN','ACT','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','now','Headers:','SUCCESS','\x20\x20\x20expiration:\x20','stack','none','UNKNOWN','6PWeSGC','loggerService','Processing\x20Rapyd\x20webhook:','EXP','requested_currency','error','errorCode','floor','amount','message','currency','PAYMENT_COMPLETED','application/json','Unknown\x20error','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','toISOString','PAYMENT_EXPIRED','Parsed\x20Result:','PENDING','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','EXPIRED','Raw\x20Response\x20Body:'];a50_0x1ac1=function(){return _0x30c45f;};return a50_0x1ac1();}const a50_0x275959=a50_0x40cf;(function(_0x233a39,_0x1c404d){const _0x2bf264=a50_0x40cf,_0x22fba0=_0x233a39();while(!![]){try{const _0x913089=-parseInt(_0x2bf264(0x12f))/0x1*(-parseInt(_0x2bf264(0x102))/0x2)+-parseInt(_0x2bf264(0x120))/0x3+-parseInt(_0x2bf264(0xc7))/0x4*(-parseInt(_0x2bf264(0xd2))/0x5)+parseInt(_0x2bf264(0xc6))/0x6+-parseInt(_0x2bf264(0xc4))/0x7*(parseInt(_0x2bf264(0xe8))/0x8)+-parseInt(_0x2bf264(0x10d))/0x9*(-parseInt(_0x2bf264(0x10c))/0xa)+-parseInt(_0x2bf264(0x101))/0xb*(parseInt(_0x2bf264(0x117))/0xc);if(_0x913089===_0x1c404d)break;else _0x22fba0['push'](_0x22fba0['shift']());}catch(_0x4b0542){_0x22fba0['push'](_0x22fba0['shift']());}}}(a50_0x1ac1,0x4e0fe));Object[a50_0x275959(0xff)](exports,a50_0x275959(0x11f),{'value':!![]}),exports[a50_0x275959(0xf9)]=void 0x0;function a50_0x40cf(_0x1b4348,_0x391fee){const _0x1ac19b=a50_0x1ac1();return a50_0x40cf=function(_0x40cf20,_0x10e212){_0x40cf20=_0x40cf20-0xbc;let _0x11cd4b=_0x1ac19b[_0x40cf20];return _0x11cd4b;},a50_0x40cf(_0x1b4348,_0x391fee);}const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x8e5b40=a50_0x275959;this[_0x8e5b40(0xf5)]='https://tesoft.uk/gateway/rapyd/',console[_0x8e5b40(0xd9)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0xd64a77){const _0x233a5a=a50_0x275959,{orderId:_0x476b1f,orderName:_0xa22a78,amount:_0x4f31f0,currency:_0xdefbe,usage:_0x5b312d,maxPayments:_0x22d045,successUrl:_0x302c1d,failUrl:_0x51a5a9}=_0xd64a77,_0x6ae3fa=_0xdefbe[_0x233a5a(0x111)](),_0x36bb83='GB';console[_0x233a5a(0xd9)](_0x233a5a(0x100));const _0x19a440=_0x233a5a(0xfd)+_0x476b1f,_0x42d70a='https://tesoft.uk/gateway/fail.php?id='+_0x476b1f,_0x57ff1={'amount':_0x4f31f0,'currency':_0x6ae3fa,'cancel_checkout_url':_0x42d70a,'complete_checkout_url':_0x19a440,'complete_payment_url':_0x19a440,'merchant_reference_id':_0x476b1f,'description':_0x233a5a(0xdd)+_0x476b1f,'country':'GB','payment_method_types_include':[_0x233a5a(0xe3),_0x233a5a(0xe2)],'custom_elements':{'display_description':!![]}};if(_0x6ae3fa!==_0x233a5a(0xe9)){const _0x3ce0fe=Math[_0x233a5a(0x136)](Date['now']()/0x3e8)+0x1e*0x3c;_0x57ff1['fixed_side']=_0x233a5a(0xf3),_0x57ff1[_0x233a5a(0x133)]=_0x233a5a(0xe9),_0x57ff1[_0x233a5a(0x11e)]=_0x3ce0fe,console['log'](_0x233a5a(0xf0)+_0x6ae3fa+_0x233a5a(0xf8)),console['log'](_0x233a5a(0xc8)),console[_0x233a5a(0xd9)]('\x20\x20\x20requested_currency:\x20EUR'),console[_0x233a5a(0xd9)](_0x233a5a(0x12b)+_0x3ce0fe+'\x20('+new Date(_0x3ce0fe*0x3e8)[_0x233a5a(0xbc)]()+')');}const _0x3c93a4=Date[_0x233a5a(0x128)]();try{console[_0x233a5a(0xd9)](_0x233a5a(0xfb)),console[_0x233a5a(0xd9)](_0x233a5a(0x114),this[_0x233a5a(0xf5)]),console[_0x233a5a(0xd9)](_0x233a5a(0xce),JSON[_0x233a5a(0x113)](_0x57ff1,null,0x2)),console[_0x233a5a(0xd9)]('üá¨üáß\x20Country:\x20'+_0x36bb83+_0x233a5a(0xcf)),console[_0x233a5a(0xd9)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x233a5a(0x130)]['logWhiteDomainRequest']('rapyd','/v1/hosted/payment_links','POST',_0x57ff1);const _0x2cdf67=await fetch(this[_0x233a5a(0xf5)],{'method':_0x233a5a(0xd8),'headers':{'Content-Type':_0x233a5a(0x13b),'User-Agent':_0x233a5a(0x11d)},'body':JSON['stringify'](_0x57ff1)}),_0x516215=Date[_0x233a5a(0x128)]()-_0x3c93a4;console[_0x233a5a(0xd9)](_0x233a5a(0x11a)),console['log'](_0x233a5a(0xe7),_0x2cdf67['status']),console[_0x233a5a(0xd9)](_0x233a5a(0xed),_0x2cdf67[_0x233a5a(0xf7)]),console[_0x233a5a(0xd9)](_0x233a5a(0x129),Object['fromEntries'](_0x2cdf67[_0x233a5a(0xe5)]['entries']())),console[_0x233a5a(0xd9)](_0x233a5a(0xde),_0x516215+'ms');const _0x28f4ac=await _0x2cdf67['text']();console[_0x233a5a(0xd9)](_0x233a5a(0xc3),_0x28f4ac);if(!_0x2cdf67['ok']){console['error'](_0x233a5a(0x123)),console[_0x233a5a(0x134)]('HTTP\x20Status:',_0x2cdf67[_0x233a5a(0xee)]),console[_0x233a5a(0x134)](_0x233a5a(0x121),_0x28f4ac),loggerService_1[_0x233a5a(0x130)][_0x233a5a(0x108)](_0x233a5a(0xd6),'/v1/hosted/payment_links',_0x2cdf67[_0x233a5a(0xee)],_0x28f4ac,_0x516215),loggerService_1[_0x233a5a(0x130)][_0x233a5a(0x110)]('rapyd',_0x233a5a(0xd1),_0x233a5a(0xcd)+_0x2cdf67[_0x233a5a(0xee)]+':\x20'+_0x28f4ac);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2cdf67[_0x233a5a(0xee)]+_0x233a5a(0xcc)+_0x28f4ac);}let _0x74ef33;try{_0x74ef33=JSON[_0x233a5a(0xe0)](_0x28f4ac);}catch(_0x4cb5af){console[_0x233a5a(0x134)](_0x233a5a(0x10f),_0x4cb5af),loggerService_1[_0x233a5a(0x130)]['logWhiteDomainError'](_0x233a5a(0xd6),'/v1/hosted/payment_links',_0x233a5a(0xeb)+_0x4cb5af);throw new Error(_0x233a5a(0xd0)+_0x28f4ac);}console['log']('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x233a5a(0xd9)](_0x233a5a(0xbe),JSON['stringify'](_0x74ef33,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x233a5a(0xd6),'/v1/hosted/payment_links',_0x2cdf67[_0x233a5a(0xee)],_0x74ef33,_0x516215);if(_0x74ef33[_0x233a5a(0xee)]?.['status']!==_0x233a5a(0x12a)){const _0x28260d=_0x74ef33[_0x233a5a(0xee)]?.[_0x233a5a(0x138)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x4144bd=_0x74ef33[_0x233a5a(0xee)]?.[_0x233a5a(0xe6)]||_0x233a5a(0x12e);console['error'](_0x233a5a(0xe4)),console['error'](_0x233a5a(0x107),_0x4144bd),console['error'](_0x233a5a(0x11b),_0x28260d),console[_0x233a5a(0x134)](_0x233a5a(0xfa),_0x74ef33[_0x233a5a(0xee)]),loggerService_1['loggerService'][_0x233a5a(0x110)]('rapyd',_0x233a5a(0xd1),_0x233a5a(0x119)+_0x4144bd+'):\x20'+_0x28260d);throw new Error(_0x233a5a(0x122)+_0x4144bd+'):\x20'+_0x28260d);}if(!_0x74ef33['data']?.['id']||!_0x74ef33[_0x233a5a(0xdf)]?.['redirect_url']){console[_0x233a5a(0x134)](_0x233a5a(0xd7)),console[_0x233a5a(0x134)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x233a5a(0x134)](_0x233a5a(0xc5),_0x74ef33[_0x233a5a(0xdf)]),loggerService_1[_0x233a5a(0x130)][_0x233a5a(0x110)](_0x233a5a(0xd6),'/v1/hosted/payment_links',_0x233a5a(0xd5));throw new Error(_0x233a5a(0xca));}return console['log'](_0x233a5a(0xdc)),console[_0x233a5a(0xd9)](_0x233a5a(0x124),_0x74ef33[_0x233a5a(0xdf)]['id']),console['log'](_0x233a5a(0x10b),_0x74ef33[_0x233a5a(0xdf)][_0x233a5a(0x118)]),console[_0x233a5a(0xd9)](_0x233a5a(0x104)+_0x36bb83+'\x20(GB\x20-\x20Britain)'),console[_0x233a5a(0xd9)](_0x233a5a(0xf1)),{'gateway_payment_id':_0x74ef33['data']['id'],'payment_url':_0x74ef33[_0x233a5a(0xdf)]['redirect_url']};}catch(_0x46bf96){console[_0x233a5a(0x134)](_0x233a5a(0x112)),console[_0x233a5a(0x134)]('Error\x20details:',_0x46bf96),loggerService_1['loggerService'][_0x233a5a(0x110)](_0x233a5a(0xd6),_0x233a5a(0xd1),_0x46bf96);if(_0x46bf96 instanceof Error){console[_0x233a5a(0x134)](_0x233a5a(0xef),_0x46bf96['message']),console[_0x233a5a(0x134)](_0x233a5a(0xda),_0x46bf96[_0x233a5a(0x12c)]);throw new Error(_0x233a5a(0x127)+_0x46bf96['message']);}throw new Error(_0x233a5a(0xc0));}}async[a50_0x275959(0x115)](_0x76672b){const _0x4d5a54=a50_0x275959,_0x145144=Date[_0x4d5a54(0x128)]();try{loggerService_1[_0x4d5a54(0x130)]['logWhiteDomainRequest'](_0x4d5a54(0xd6),'/v1/hosted/payment_links/'+_0x76672b,_0x4d5a54(0xf6),{});const _0x3d7c37=await fetch(this[_0x4d5a54(0xf5)]+'/'+_0x76672b,{'method':_0x4d5a54(0xf6),'headers':{'Content-Type':_0x4d5a54(0x13b),'User-Agent':_0x4d5a54(0x11d)}}),_0x3925cc=Date[_0x4d5a54(0x128)]()-_0x145144;if(!_0x3d7c37['ok']){const _0x32c7ca=await _0x3d7c37[_0x4d5a54(0x116)]();loggerService_1[_0x4d5a54(0x130)][_0x4d5a54(0x108)](_0x4d5a54(0xd6),_0x4d5a54(0x106)+_0x76672b,_0x3d7c37[_0x4d5a54(0xee)],_0x32c7ca,_0x3925cc);throw new Error(_0x4d5a54(0xe1)+_0x3d7c37['status']);}const _0xd78638=await _0x3d7c37[_0x4d5a54(0xc9)]();loggerService_1[_0x4d5a54(0x130)][_0x4d5a54(0x108)](_0x4d5a54(0xd6),_0x4d5a54(0x106)+_0x76672b,_0x3d7c37[_0x4d5a54(0xee)],_0xd78638,_0x3925cc);if(_0xd78638['status']?.[_0x4d5a54(0xee)]!==_0x4d5a54(0x12a)){loggerService_1[_0x4d5a54(0x130)][_0x4d5a54(0x110)](_0x4d5a54(0xd6),_0x4d5a54(0x106)+_0x76672b,'Rapyd\x20API\x20error:\x20'+(_0xd78638[_0x4d5a54(0xee)]?.['message']||_0x4d5a54(0x13c)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0xd78638[_0x4d5a54(0xee)]?.['message']||_0x4d5a54(0x13c)));}let _0x5e5356=_0x4d5a54(0xbf);if(_0xd78638[_0x4d5a54(0xdf)]?.[_0x4d5a54(0xee)])switch(_0xd78638[_0x4d5a54(0xdf)][_0x4d5a54(0xee)]['toUpperCase']()){case _0x4d5a54(0x10a):_0x5e5356=_0x4d5a54(0xf4);break;case _0x4d5a54(0x125):_0x5e5356=_0x4d5a54(0xec);break;case'EXP':_0x5e5356=_0x4d5a54(0xc2);break;case'ERR':_0x5e5356=_0x4d5a54(0xec);break;case'NEW':case _0x4d5a54(0x126):default:_0x5e5356=_0x4d5a54(0xbf);break;}return{'status':_0x5e5356,'amount':_0xd78638[_0x4d5a54(0xdf)]?.[_0x4d5a54(0x137)],'currency':_0xd78638[_0x4d5a54(0xdf)]?.['currency']};}catch(_0x4d44f1){console[_0x4d5a54(0x134)]('Rapyd\x20payment\x20verification\x20error:',_0x4d44f1),loggerService_1[_0x4d5a54(0x130)][_0x4d5a54(0x110)](_0x4d5a54(0xd6),'/v1/hosted/payment_links/'+_0x76672b,_0x4d44f1);throw new Error(_0x4d5a54(0x13d)+(_0x4d44f1 instanceof Error?_0x4d44f1[_0x4d5a54(0x138)]:_0x4d5a54(0x13c)));}}async['processWebhook'](_0x5b6fa6){const _0x9beb90=a50_0x275959;console[_0x9beb90(0xd9)](_0x9beb90(0x131),_0x5b6fa6);let _0x310a21='PENDING',_0x4a1dd0;_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0x10e)]&&(_0x4a1dd0=_0x5b6fa6[_0x9beb90(0xdf)][_0x9beb90(0x10e)],console[_0x9beb90(0xd9)](_0x9beb90(0xd4)+_0x4a1dd0));switch(_0x5b6fa6['type']?.[_0x9beb90(0x111)]()){case _0x9beb90(0x13a):_0x5b6fa6['data']?.['paid']===!![]&&_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0xee)]===_0x9beb90(0x10a)?_0x310a21=_0x9beb90(0xf4):_0x310a21=_0x9beb90(0xbf);break;case'PAYMENT_CANCELED':_0x310a21=_0x9beb90(0xec);break;case _0x9beb90(0xbd):_0x310a21=_0x9beb90(0xc2);break;case _0x9beb90(0x109):_0x310a21=_0x9beb90(0xec);!_0x4a1dd0&&_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0x10e)]&&(_0x4a1dd0=_0x5b6fa6[_0x9beb90(0xdf)][_0x9beb90(0x10e)]);break;default:switch(_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0xee)]?.[_0x9beb90(0x111)]()){case _0x9beb90(0x10a):_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0xcb)]===!![]?_0x310a21=_0x9beb90(0xf4):_0x310a21=_0x9beb90(0xec);break;case _0x9beb90(0x125):_0x310a21=_0x9beb90(0xec);break;case _0x9beb90(0x132):_0x310a21=_0x9beb90(0xc2);break;case _0x9beb90(0xf2):_0x310a21=_0x9beb90(0xec);!_0x4a1dd0&&_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0x10e)]&&(_0x4a1dd0=_0x5b6fa6['data']['failure_message']);break;case _0x9beb90(0xd3):case'ACT':default:_0x310a21='PENDING';break;}break;}const _0x39d29e={};return _0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0x11c)]?.[_0x9beb90(0xea)]&&(_0x39d29e[_0x9beb90(0xfc)]=_0x5b6fa6['data'][_0x9beb90(0x11c)][_0x9beb90(0xea)]),_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0x105)]&&(_0x39d29e[_0x9beb90(0x103)]=_0x5b6fa6[_0x9beb90(0xdf)][_0x9beb90(0x105)]),_0x5b6fa6['data']?.['error_code']&&(_0x39d29e[_0x9beb90(0x135)]=_0x5b6fa6[_0x9beb90(0xdf)][_0x9beb90(0xe6)]),_0x5b6fa6[_0x9beb90(0xdf)]?.['failure_code']&&(_0x39d29e['failureCode']=_0x5b6fa6[_0x9beb90(0xdf)][_0x9beb90(0xdb)]),console[_0x9beb90(0xd9)](_0x9beb90(0xc1)+_0x310a21+',\x20failureMessage='+(_0x4a1dd0||_0x9beb90(0x12d))),{'paymentId':_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0xfe)]||'','status':_0x310a21,'amount':_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0x137)],'currency':_0x5b6fa6[_0x9beb90(0xdf)]?.[_0x9beb90(0x139)],'failureMessage':_0x4a1dd0,'additionalInfo':_0x39d29e};}}exports[a50_0x275959(0xf9)]=RapydService;